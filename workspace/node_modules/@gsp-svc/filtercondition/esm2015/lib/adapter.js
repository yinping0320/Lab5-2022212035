/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { FilterEntityType } from "./schema";
import { GSPElementDataType, GSPElementObjectType } from "@gsp-bef/gsp-cm-metadata";
import { PropertyEntity, PropertyDataType } from "./property-entity";
import { NavigationProperty, NavigationType } from "./navigation-property-entity";
import { NewDataType, NewEntityType, NewProperty, NewNavigationProperty, NewNavigationType } from "./NewSchema";
export class Adapter {
    /**
     * @param {?} commonObject
     * @return {?}
     */
    convertCO(commonObject) {
        /** @type {?} */
        let entityTypes = [];
        entityTypes.push(this.adaptCO(commonObject, entityTypes));
        return entityTypes;
    }
    /**
     * CO转化递归方法
     * @private
     * @param {?} gspCO 待转化gspCO
     * @param {?} entityTypes 从gspCO提取的所有主从表
     * @return {?}
     */
    adaptCO(gspCO, entityTypes) {
        /** @type {?} */
        let entityType = new FilterEntityType();
        entityType.name = gspCO.Code;
        entityType.displayName = gspCO.Name;
        //每个属性转化
        if ((gspCO.ContainElements) && gspCO.ContainElements.length != 0) {
            gspCO.ContainElements.forEach((/**
             * @param {?} element
             * @return {?}
             */
            element => {
                if (!element.IsUdt && element.ObjectType != GSPElementObjectType.Association) {
                    /** @type {?} */
                    let property = new PropertyEntity();
                    property.name = element.Code;
                    property.displayName = element.Name;
                    property.propertyDataType = this.convertPropertyDataType(element.MDataType);
                    entityType.properties.push(property);
                }
            }));
        }
        ;
        //子表转化为导航属性
        if ((gspCO.ContainChildObjects) && gspCO.ContainChildObjects.length != 0) {
            gspCO.ContainChildObjects.forEach((/**
             * @param {?} childObject
             * @return {?}
             */
            childObject => {
                /** @type {?} */
                let naviproperty = new NavigationProperty();
                naviproperty.displayName = childObject.Name;
                naviproperty.name = childObject.Code + "s";
                naviproperty.navigationEntity = childObject.Code;
                naviproperty.navigationType = NavigationType.EntityType;
                entityType.navigationProperties.push(naviproperty);
                entityTypes.push(this.adaptCO(childObject, entityTypes));
            }));
        }
        ;
        return entityType;
    }
    /**
     * 属性数据类型转换
     * @private
     * @param {?} dataType
     * @return {?}
     */
    convertPropertyDataType(dataType) {
        switch (dataType) {
            case GSPElementDataType.String:
            case GSPElementDataType.Text:
                return PropertyDataType.String;
            case GSPElementDataType.Integer:
                return PropertyDataType.Int32;
            case GSPElementDataType.Decimal:
                return PropertyDataType.Decimal;
            case GSPElementDataType.DateTime:
            case GSPElementDataType.Date:
                return PropertyDataType.DateTime;
            case GSPElementDataType.Boolean:
                return PropertyDataType.Boolean;
            case GSPElementDataType.Binary:
                return PropertyDataType.Array;
            default: return null;
        }
    }
    //=====================================转换CO---->NewSchema===================================
    /**
     * \@description 将CO转化为NewEntityType[]
     * @param {?} co 待转换CO
     * @return {?} NewEntityType[] NewEntityType[]
     */
    convertCOOfNewSchema(co) {
        /** @type {?} */
        let types = [];
        types.push(this.adaptCOOfNewSchema(co, types));
        return types;
    }
    /**
     * \@description 将CO转化为NewEntityType[]
     * @param {?} co 待转换CO
     * @param {?} types 数组:EntityType[]
     * @return {?} NewEntityType[] NewEntityType[]
     */
    adaptCOOfNewSchema(co, types) {
        /** @type {?} */
        let type = new NewEntityType();
        type.code = co.Code;
        type.name = co.Name;
        //一般属性转化
        if (co.ContainElements && co.ContainElements.length > 0) {
            co.ContainElements.forEach((/**
             * @param {?} ele
             * @return {?}
             */
            ele => {
                if (!ele.IsUdt && ele.ObjectType != GSPElementObjectType.Association) {
                    /** @type {?} */
                    let pro = new NewProperty();
                    pro.code = ele.Code;
                    pro.name = ele.Name;
                    pro.dataType = this.convertCOEleTypeProType(ele.MDataType);
                    type.properties.push(pro);
                }
            }));
        }
        //导航属性转化
        if (co.ContainChildObjects && co.ContainChildObjects.length > 0) {
            co.ContainChildObjects.forEach((/**
             * @param {?} obj
             * @return {?}
             */
            obj => {
                /** @type {?} */
                let naPro = new NewNavigationProperty();
                naPro.code = obj.Code + "s";
                naPro.name = obj.Name;
                naPro.navigationName = obj.ID;
                naPro.navigationType = NewNavigationType.EntityType;
                naPro.relationShip = "";
                type.navigationProperties.push(naPro);
                types.push(this.adaptCOOfNewSchema((/** @type {?} */ (obj)), types));
            }));
        }
        return type;
    }
    /**
     * \@description 将BE定义的字段类型转换为统一Schema的字段类型
     * @param {?} dataType BE定义的属性类型
     * @return {?} NewDataType 统一Schema的属性类型
     */
    convertCOEleTypeProType(dataType) {
        /** @type {?} */
        let type = NewDataType.String;
        switch (dataType) {
            case GSPElementDataType.String:
            case GSPElementDataType.Text:
                type = NewDataType.String;
                break;
            case GSPElementDataType.Integer:
                type = NewDataType.Integer;
                break;
            case GSPElementDataType.Decimal:
                type = NewDataType.Decimal;
                break;
            case GSPElementDataType.DateTime:
                type = NewDataType.DateTime;
                break;
            case GSPElementDataType.Date:
                type = NewDataType.Date;
                break;
            case GSPElementDataType.Boolean:
                type = NewDataType.Boolean;
                break;
            case GSPElementDataType.Binary:
                type = NewDataType.Byte;
                break;
        }
        return type;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYWRhcHRlci5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0Bnc3Atc3ZjL2ZpbHRlcmNvbmRpdGlvbi8iLCJzb3VyY2VzIjpbImxpYi9hZGFwdGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSxVQUFVLENBQUM7QUFDNUMsT0FBTyxFQUFxQyxrQkFBa0IsRUFBRSxvQkFBb0IsRUFBRSxNQUFNLDBCQUEwQixDQUFDO0FBQ3ZILE9BQU8sRUFBRSxjQUFjLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUNyRSxPQUFPLEVBQUUsa0JBQWtCLEVBQUUsY0FBYyxFQUFFLE1BQU0sOEJBQThCLENBQUM7QUFDbEYsT0FBTyxFQUFFLFdBQVcsRUFBRSxhQUFhLEVBQUUsV0FBVyxFQUFFLHFCQUFxQixFQUFFLGlCQUFpQixFQUFFLE1BQU0sYUFBYSxDQUFDO0FBRWhILE1BQU0sT0FBTyxPQUFPOzs7OztJQUNULFNBQVMsQ0FBQyxZQUE2Qjs7WUFDdEMsV0FBVyxHQUF1QixFQUFFO1FBQ3hDLFdBQVcsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxZQUFZLEVBQUUsV0FBVyxDQUFDLENBQUMsQ0FBQztRQUMxRCxPQUFPLFdBQVcsQ0FBQztJQUN2QixDQUFDOzs7Ozs7OztJQU1PLE9BQU8sQ0FBQyxLQUF1QixFQUFFLFdBQStCOztZQUNoRSxVQUFVLEdBQUcsSUFBSSxnQkFBZ0IsRUFBRTtRQUN2QyxVQUFVLENBQUMsSUFBSSxHQUFHLEtBQUssQ0FBQyxJQUFJLENBQUM7UUFDN0IsVUFBVSxDQUFDLFdBQVcsR0FBRyxLQUFLLENBQUMsSUFBSSxDQUFDO1FBQ3BDLFFBQVE7UUFDUixJQUFJLENBQUMsS0FBSyxDQUFDLGVBQWUsQ0FBQyxJQUFJLEtBQUssQ0FBQyxlQUFlLENBQUMsTUFBTSxJQUFJLENBQUMsRUFBRTtZQUM5RCxLQUFLLENBQUMsZUFBZSxDQUFDLE9BQU87Ozs7WUFB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U0FDYjtRQUNELE9BQU8sSUFBSSxDQUFDO0lBQ2hCLENBQUM7Q0FFSiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEZpbHRlckVudGl0eVR5cGUgfSBmcm9tIFwiLi9zY2hlbWFcIjtcclxuaW1wb3J0IHsgR1NQQ29tbW9uT2JqZWN0LCBJR1NQQ29tbW9uT2JqZWN0LCBHU1BFbGVtZW50RGF0YVR5cGUsIEdTUEVsZW1lbnRPYmplY3RUeXBlIH0gZnJvbSBcIkBnc3AtYmVmL2dzcC1jbS1tZXRhZGF0YVwiO1xyXG5pbXBvcnQgeyBQcm9wZXJ0eUVudGl0eSwgUHJvcGVydHlEYXRhVHlwZSB9IGZyb20gXCIuL3Byb3BlcnR5LWVudGl0eVwiO1xyXG5pbXBvcnQgeyBOYXZpZ2F0aW9uUHJvcGVydHksIE5hdmlnYXRpb25UeXBlIH0gZnJvbSBcIi4vbmF2aWdhdGlvbi1wcm9wZXJ0eS1lbnRpdHlcIjtcclxuaW1wb3J0IHsgTmV3RGF0YVR5cGUsIE5ld0VudGl0eVR5cGUsIE5ld1Byb3BlcnR5LCBOZXdOYXZpZ2F0aW9uUHJvcGVydHksIE5ld05hdmlnYXRpb25UeXBlIH0gZnJvbSBcIi4vTmV3U2NoZW1hXCI7XHJcblxyXG5leHBvcnQgY2xhc3MgQWRhcHRlciB7XHJcbiAgICBwdWJsaWMgY29udmVydENPKGNvbW1vbk9iamVjdDogR1NQQ29tbW9uT2JqZWN0KTogRmlsdGVyRW50aXR5VHlwZVtdIHtcclxuICAgICAgICBsZXQgZW50aXR5VHlwZXM6IEZpbHRlckVudGl0eVR5cGVbXSA9IFtdO1xyXG4gICAgICAgIGVudGl0eVR5cGVzLnB1c2godGhpcy5hZGFwdENPKGNvbW1vbk9iamVjdCwgZW50aXR5VHlwZXMpKTtcclxuICAgICAgICByZXR1cm4gZW50aXR5VHlwZXM7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIENP6L2s5YyW6YCS5b2S5pa55rOVXHJcbiAgICAgKiBAcGFyYW0gZ3NwQ08g5b6F6L2s5YyWZ3NwQ09cclxuICAgICAqIEBwYXJhbSBlbnRpdHlUeXBlcyDku45nc3BDT+aPkOWPlueahOaJgOacieS4u+S7juihqFxyXG4gICAgICovXHJcbiAgICBwcml2YXRlIGFkYXB0Q08oZ3NwQ086IElHU1BDb21tb25PYmplY3QsIGVudGl0eVR5cGVzOiBGaWx0ZXJFbnRpdHlUeXBlW10pOiBGaWx0ZXJFbnRpdHlUeXBlIHtcclxuICAgICAgICBsZXQgZW50aXR5VHlwZSA9IG5ldyBGaWx0ZXJFbnRpdHlUeXBlKCk7XHJcbiAgICAgICAgZW50aXR5VHlwZS5uYW1lID0gZ3NwQ08uQ29kZTtcclxuICAgICAgICBlbnRpdHlUeXBlLmRpc3BsYXlOYW1lID0gZ3NwQ08uTmFtZTtcclxuICAgICAgICAvL+avj+S4quWxnuaAp+i9rOWMllxyXG4gICAgICAgIGlmICgoZ3NwQ08uQ29udGFpbkVsZW1lbnRzKSAmJiBnc3BDTy5Db250YWluRWxlbWVudHMubGVuZ3RoICE9IDApIHtcclxuICAgICAgICAgICAgZ3NwQ08uQ29udGFpbkVsZW1lbnRzLmZvckVhY2goZWxlbWVudCA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAoIWVsZW1lbnQuSXNVZHQgJiYgZWxlbWVudC5PYmplY3RUeXBlICE9IEdTUEVsZW1lbnRPYmplY3RUeXBlLkFzc29jaWF0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IHByb3BlcnR5ID0gbmV3IFByb3BlcnR5RW50aXR5KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgcHJvcGVydHkubmFtZSA9IGVsZW1lbnQuQ29kZTtcclxuICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0eS5kaXNwbGF5TmFtZSA9IGVsZW1lbnQuTmFtZTtcclxuICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0eS5wcm9wZXJ0eURhdGFUeXBlID0gdGhpcy5jb252ZXJ0UHJvcGVydHlEYXRhVHlwZShlbGVtZW50Lk1EYXRhVHlwZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgZW50aXR5VHlwZS5wcm9wZXJ0aWVzLnB1c2gocHJvcGVydHkpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIC8v5a2Q6KGo6L2s5YyW5Li65a+86Iiq5bGe5oCnXHJcbiAgICAgICAgaWYgKChnc3BDTy5Db250YWluQ2hpbGRPYmplY3RzKSAmJiBnc3BDTy5Db250YWluQ2hpbGRPYmplY3RzLmxlbmd0aCAhPSAwKSB7XHJcbiAgICAgICAgICAgIGdzcENPLkNvbnRhaW5DaGlsZE9iamVjdHMuZm9yRWFjaChjaGlsZE9iamVjdCA9PiB7XHJcbiAgICAgICAgICAgICAgICBsZXQgbmF2aXByb3BlcnR5ID0gbmV3IE5hdmlnYXRpb25Qcm9wZXJ0eSgpO1xyXG4gICAgICAgICAgICAgICAgbmF2aXByb3BlcnR5LmRpc3BsYXlOYW1lID0gY2hpbGRPYmplY3QuTmFtZTtcclxuICAgICAgICAgICAgICAgIG5hdmlwcm9wZXJ0eS5uYW1lID0gY2hpbGRPYmplY3QuQ29kZSArIFwic1wiO1xyXG4gICAgICAgICAgICAgICAgbmF2aXByb3BlcnR5Lm5hdmlnYXRpb25FbnRpdHkgPSBjaGlsZE9iamVjdC5Db2RlO1xyXG4gICAgICAgICAgICAgICAgbmF2aXByb3BlcnR5Lm5hdmlnYXRpb25UeXBlID0gTmF2aWdhdGlvblR5cGUuRW50aXR5VHlwZTtcclxuICAgICAgICAgICAgICAgIGVudGl0eVR5cGUubmF2aWdhdGlvblByb3BlcnRpZXMucHVzaChuYXZpcHJvcGVydHkpO1xyXG4gICAgICAgICAgICAgICAgZW50aXR5VHlwZXMucHVzaCh0aGlzLmFkYXB0Q08oY2hpbGRPYmplY3QsIGVudGl0eVR5cGVzKSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgcmV0dXJuIGVudGl0eVR5cGU7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIOWxnuaAp+aVsOaNruexu+Wei+i9rOaNolxyXG4gICAgICovXHJcbiAgICBwcml2YXRlIGNvbnZlcnRQcm9wZXJ0eURhdGFUeXBlKGRhdGFUeXBlOiBHU1BFbGVtZW50RGF0YVR5cGUpOiBQcm9wZXJ0eURhdGFUeXBlIHtcclxuICAgICAgICBzd2l0Y2ggKGRhdGFUeXBlKSB7XHJcbiAgICAgICAgICAgIGNhc2UgR1NQRWxlbWVudERhdGFUeXBlLlN0cmluZzpcclxuICAgICAgICAgICAgY2FzZSBHU1BFbGVtZW50RGF0YVR5cGUuVGV4dDpcclxuICAgICAgICAgICAgICAgIHJldHVybiBQcm9wZXJ0eURhdGFUeXBlLlN0cmluZztcclxuICAgICAgICAgICAgY2FzZSBHU1BFbGVtZW50RGF0YVR5cGUuSW50ZWdlcjpcclxuICAgICAgICAgICAgICAgIHJldHVybiBQcm9wZXJ0eURhdGFUeXBlLkludDMyO1xyXG4gICAgICAgICAgICBjYXNlIEdTUEVsZW1lbnREYXRhVHlwZS5EZWNpbWFsOlxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIFByb3BlcnR5RGF0YVR5cGUuRGVjaW1hbDtcclxuICAgICAgICAgICAgY2FzZSBHU1BFbGVtZW50RGF0YVR5cGUuRGF0ZVRpbWU6XHJcbiAgICAgICAgICAgIGNhc2UgR1NQRWxlbWVudERhdGFUeXBlLkRhdGU6XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gUHJvcGVydHlEYXRhVHlwZS5EYXRlVGltZTtcclxuICAgICAgICAgICAgY2FzZSBHU1BFbGVtZW50RGF0YVR5cGUuQm9vbGVhbjpcclxuICAgICAgICAgICAgICAgIHJldHVybiBQcm9wZXJ0eURhdGFUeXBlLkJvb2xlYW47XHJcbiAgICAgICAgICAgIGNhc2UgR1NQRWxlbWVudERhdGFUeXBlLkJpbmFyeTpcclxuICAgICAgICAgICAgICAgIHJldHVybiBQcm9wZXJ0eURhdGFUeXBlLkFycmF5O1xyXG4gICAgICAgICAgICBkZWZhdWx0OiByZXR1cm4gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLy89PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT096L2s5o2iQ08tLS0tPk5ld1NjaGVtYT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBAZGVzY3JpcHRpb24g5bCGQ0/ovazljJbkuLpOZXdFbnRpdHlUeXBlW11cclxuICAgICAqIEBwYXJhbSBjbyDlvoXovazmjaJDT1xyXG4gICAgICogQHJldHVybnMgTmV3RW50aXR5VHlwZVtdIE5ld0VudGl0eVR5cGVbXVxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgY29udmVydENPT2ZOZXdTY2hlbWEoY286IEdTUENvbW1vbk9iamVjdCk6IE5ld0VudGl0eVR5cGVbXSB7XHJcbiAgICAgICAgbGV0IHR5cGVzOiBOZXdFbnRpdHlUeXBlW10gPSBbXTtcclxuICAgICAgICB0eXBlcy5wdXNoKHRoaXMuYWRhcHRDT09mTmV3U2NoZW1hKGNvLCB0eXBlcykpO1xyXG4gICAgICAgIHJldHVybiB0eXBlcztcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEBkZXNjcmlwdGlvbiDlsIZDT+i9rOWMluS4uk5ld0VudGl0eVR5cGVbXVxyXG4gICAgICogQHBhcmFtIGNvIOW+hei9rOaNokNPXHJcbiAgICAgKiBAcGFyYW0gdHlwZXMg5pWw57uEOkVudGl0eVR5cGVbXVxyXG4gICAgICogQHJldHVybnMgTmV3RW50aXR5VHlwZVtdIE5ld0VudGl0eVR5cGVbXVxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgYWRhcHRDT09mTmV3U2NoZW1hKGNvOiBHU1BDb21tb25PYmplY3QsIHR5cGVzOiBOZXdFbnRpdHlUeXBlW10pOiBOZXdFbnRpdHlUeXBlIHtcclxuICAgICAgICBsZXQgdHlwZSA9IG5ldyBOZXdFbnRpdHlUeXBlKCk7XHJcbiAgICAgICAgdHlwZS5jb2RlID0gY28uQ29kZTtcclxuICAgICAgICB0eXBlLm5hbWUgPSBjby5OYW1lO1xyXG4gICAgICAgIC8v5LiA6Iis5bGe5oCn6L2s5YyWXHJcbiAgICAgICAgaWYgKGNvLkNvbnRhaW5FbGVtZW50cyAmJiBjby5Db250YWluRWxlbWVudHMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICBjby5Db250YWluRWxlbWVudHMuZm9yRWFjaChlbGUgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKCFlbGUuSXNVZHQgJiYgZWxlLk9iamVjdFR5cGUgIT0gR1NQRWxlbWVudE9iamVjdFR5cGUuQXNzb2NpYXRpb24pIHtcclxuICAgICAgICAgICAgICAgICAgICBsZXQgcHJvID0gbmV3IE5ld1Byb3BlcnR5KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgcHJvLmNvZGUgPSBlbGUuQ29kZTtcclxuICAgICAgICAgICAgICAgICAgICBwcm8ubmFtZSA9IGVsZS5OYW1lO1xyXG4gICAgICAgICAgICAgICAgICAgIHByby5kYXRhVHlwZSA9IHRoaXMuY29udmVydENPRWxlVHlwZVByb1R5cGUoZWxlLk1EYXRhVHlwZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgdHlwZS5wcm9wZXJ0aWVzLnB1c2gocHJvKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8v5a+86Iiq5bGe5oCn6L2s5YyWXHJcbiAgICAgICAgaWYgKGNvLkNvbnRhaW5DaGlsZE9iamVjdHMgJiYgY28uQ29udGFpbkNoaWxkT2JqZWN0cy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgIGNvLkNvbnRhaW5DaGlsZE9iamVjdHMuZm9yRWFjaChvYmogPT4ge1xyXG4gICAgICAgICAgICAgICAgbGV0IG5hUHJvID0gbmV3IE5ld05hdmlnYXRpb25Qcm9wZXJ0eSgpO1xyXG4gICAgICAgICAgICAgICAgbmFQcm8uY29kZSA9IG9iai5Db2RlICsgXCJzXCI7XHJcbiAgICAgICAgICAgICAgICBuYVByby5uYW1lID0gb2JqLk5hbWU7XHJcbiAgICAgICAgICAgICAgICBuYVByby5uYXZpZ2F0aW9uTmFtZSA9IG9iai5JRDtcclxuICAgICAgICAgICAgICAgIG5hUHJvLm5hdmlnYXRpb25UeXBlID0gTmV3TmF2aWdhdGlvblR5cGUuRW50aXR5VHlwZTtcclxuICAgICAgICAgICAgICAgIG5hUHJvLnJlbGF0aW9uU2hpcCA9IFwiXCI7XHJcbiAgICAgICAgICAgICAgICB0eXBlLm5hdmlnYXRpb25Qcm9wZXJ0aWVzLnB1c2gobmFQcm8pO1xyXG4gICAgICAgICAgICAgICAgdHlwZXMucHVzaCh0aGlzLmFkYXB0Q09PZk5ld1NjaGVtYShvYmogYXMgR1NQQ29tbW9uT2JqZWN0LCB0eXBlcykpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHR5cGU7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBAZGVzY3JpcHRpb24g5bCGQkXlrprkuYnnmoTlrZfmrrXnsbvlnovovazmjaLkuLrnu5/kuIBTY2hlbWHnmoTlrZfmrrXnsbvlnotcclxuICAgICAqIEBwYXJhbSBkYXRhVHlwZSBCReWumuS5ieeahOWxnuaAp+exu+Wei1xyXG4gICAgICogQHJldHVybnMgTmV3RGF0YVR5cGUg57uf5LiAU2NoZW1h55qE5bGe5oCn57G75Z6LXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBjb252ZXJ0Q09FbGVUeXBlUHJvVHlwZShkYXRhVHlwZTogR1NQRWxlbWVudERhdGFUeXBlKTogTmV3RGF0YVR5cGUge1xyXG4gICAgICAgIGxldCB0eXBlID0gTmV3RGF0YVR5cGUuU3RyaW5nO1xyXG4gICAgICAgIHN3aXRjaCAoZGF0YVR5cGUpIHtcclxuICAgICAgICAgICAgY2FzZSBHU1BFbGVtZW50RGF0YVR5cGUuU3RyaW5nOlxyXG4gICAgICAgICAgICBjYXNlIEdTUEVsZW1lbnREYXRhVHlwZS5UZXh0OlxyXG4gICAgICAgICAgICAgICAgdHlwZSA9IE5ld0RhdGFUeXBlLlN0cmluZztcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlIEdTUEVsZW1lbnREYXRhVHlwZS5JbnRlZ2VyOlxyXG4gICAgICAgICAgICAgICAgdHlwZSA9IE5ld0RhdGFUeXBlLkludGVnZXI7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSBHU1BFbGVtZW50RGF0YVR5cGUuRGVjaW1hbDpcclxuICAgICAgICAgICAgICAgIHR5cGUgPSBOZXdEYXRhVHlwZS5EZWNpbWFsO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgR1NQRWxlbWVudERhdGFUeXBlLkRhdGVUaW1lOlxyXG4gICAgICAgICAgICAgICAgdHlwZSA9IE5ld0RhdGFUeXBlLkRhdGVUaW1lO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgR1NQRWxlbWVudERhdGFUeXBlLkRhdGU6XHJcbiAgICAgICAgICAgICAgICB0eXBlID0gTmV3RGF0YVR5cGUuRGF0ZTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlIEdTUEVsZW1lbnREYXRhVHlwZS5Cb29sZWFuOlxyXG4gICAgICAgICAgICAgICAgdHlwZSA9IE5ld0RhdGFUeXBlLkJvb2xlYW47XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSBHU1BFbGVtZW50RGF0YVR5cGUuQmluYXJ5OlxyXG4gICAgICAgICAgICAgICAgdHlwZSA9IE5ld0RhdGFUeXBlLkJ5dGU7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHR5cGU7XHJcbiAgICB9XHJcblxyXG59Il19
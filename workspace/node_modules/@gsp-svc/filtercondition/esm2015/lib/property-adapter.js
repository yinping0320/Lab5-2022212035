/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { FilterInjectedType } from "./injected-entity";
import { NavigationType } from "./navigation-property-entity";
import { PropertyDataType } from ".";
import { NewDataType, NewNavigationType } from "./NewSchema";
export class PropertyAdapter {
    /**
     * 属性适配器，注入多级实体转化为Array
     * @param {?} injectedEntity 注入的实体
     * @param {?} schemaMap 注入的schema
     * @return {?}
     */
    adapter(injectedEntity, schemaMap) {
        //根据注入schema名得到schema
        /** @type {?} */
        let schema = schemaMap.get(injectedEntity.schemaName);
        //根据注入类型分别进行转化
        switch (injectedEntity.injectedType) {
            case FilterInjectedType.EntitySet:
                {
                    /** @type {?} */
                    let entitySet = schema.entitySets.find((/**
                     * @param {?} entitySet
                     * @return {?}
                     */
                    entitySet => entitySet.name == injectedEntity.name));
                    return this.convertEntitySet(entitySet, schema);
                }
            case FilterInjectedType.EntityType:
                {
                    /** @type {?} */
                    let entityType = schema.entityTypes.find((/**
                     * @param {?} entityType
                     * @return {?}
                     */
                    entityType => entityType.name == injectedEntity.name));
                    return this.convertEntityType(entityType, schema);
                }
            default: break;
        }
    }
    /**
     * 将实体类转化成Arrray
     * @param {?} entityType 被转换的实体类
     * @param {?} schema
     * @return {?}
     */
    convertEntityType(entityType, schema) {
        /** @type {?} */
        let propertyList = Array();
        //常规属性转化
        entityType.properties.forEach((/**
         * @param {?} property
         * @return {?}
         */
        property => {
            /** @type {?} */
            let propertyListItem = {
                text: property.displayName,
                propertyDataType: property.propertyDataType,
                value: property.name,
                parentItem: null
            };
            propertyList.push(propertyListItem);
        }));
        //导航属性转化
        entityType.navigationProperties.forEach((/**
         * @param {?} navigationProperty
         * @return {?}
         */
        navigationProperty => {
            //根据导航属性类型进行转化
            switch (navigationProperty.navigationType) {
                //若导航属性为EntitySet
                case NavigationType.EntitySet:
                    {
                        //根据导航属性名找到schema中的EntitySet
                        /** @type {?} */
                        let entitySet = schema.entitySets.find((/**
                         * @param {?} entitySet
                         * @return {?}
                         */
                        entitySet => entitySet.name == navigationProperty.navigationEntity));
                        //子实体集转化为Array
                        this.convertEntitySet(entitySet, schema).forEach((/**
                         * @param {?} element
                         * @return {?}
                         */
                        element => {
                            //若子实体中的每个属性父项不为空，则在父项名前添加该导航属性名，例如OrderItem前加Order为Orders.OrderItem
                            if (element.parentItem != null) {
                                element.parentItem = navigationProperty.name + "." + element.parentItem;
                            }
                            //若父项为空，则设置该属性父项为导航属性名
                            else {
                                element.parentItem = navigationProperty.name;
                            }
                            //设置该属性的显示名称
                            element.text = navigationProperty.displayName + "." + element.text;
                            propertyList.push(element);
                        }));
                    }
                    break;
                //若导航属性类型为EntityType
                case NavigationType.EntityType:
                    {
                        //根据导航属性名找到schema中的EntityType
                        /** @type {?} */
                        let entityType = schema.entityTypes.find((/**
                         * @param {?} entityType
                         * @return {?}
                         */
                        entityType => entityType.name == navigationProperty.navigationEntity));
                        //子实体转化为Array
                        this.convertEntityType(entityType, schema).forEach((/**
                         * @param {?} element
                         * @return {?}
                         */
                        element => {
                            //若子实体中的每个属性父项不为空，则在父项名前添加该导航属性名，例如OrderItem前加Order为Order.OrderItem
                            if (element.parentItem != null) {
                                element.parentItem = navigationProperty.name + "." + element.parentItem;
                            }
                            //若父项为空，则设置该属性父项为导航属性名
                            else {
                                element.parentItem = navigationProperty.name;
                            }
                            //设置该属性的显示名称
                            element.text = navigationProperty.displayName + "." + element.text;
                            propertyList.push(element);
                        }));
                    }
                    break;
            }
        }));
        return propertyList;
    }
    /**
     * 实体集转化为属性列表
     * @param {?} entitySet 待转化实体集
     * @param {?} schema 所在schema
     * @return {?}
     */
    convertEntitySet(entitySet, schema) {
        /** @type {?} */
        let propertyList = Array();
        /** @type {?} */
        let entityType = schema.entityTypes.find((/**
         * @param {?} entityType
         * @return {?}
         */
        entityType => entityType.name == entitySet.entityTypeName));
        entityType.properties.forEach((/**
         * @param {?} property
         * @return {?}
         */
        property => {
            /** @type {?} */
            let propertyListItem = {
                text: property.displayName,
                propertyDataType: property.propertyDataType,
                value: property.name,
                parentItem: null
            };
            propertyList.push(propertyListItem);
        }));
        if (entityType.navigationProperties.length != 0) {
            //导航属性转化
            entityType.navigationProperties.forEach((/**
             * @param {?} navigationProperty
             * @return {?}
             */
            navigationProperty => {
                switch (navigationProperty.navigationType) {
                    case NavigationType.EntitySet:
                        {
                            /** @type {?} */
                            let entitySet = schema.entitySets.find((/**
                             * @param {?} entitySet
                             * @return {?}
                             */
                            entitySet => entitySet.name == navigationProperty.navigationEntity));
                            this.convertEntitySet(entitySet, schema).forEach((/**
                             * @param {?} element
                             * @return {?}
                             */
                            element => {
                                if (element.parentItem != null) {
                                    element.parentItem = navigationProperty.name + "." + element.parentItem;
                                }
                                else {
                                    element.parentItem = navigationProperty.name;
                                }
                                element.text = navigationProperty.displayName + "." + element.text;
                                propertyList.push(element);
                            }));
                        }
                        break;
                    case NavigationType.EntityType:
                        {
                            /** @type {?} */
                            let entityType = schema.entityTypes.find((/**
                             * @param {?} entityType
                             * @return {?}
                             */
                            entityType => entityType.name == navigationProperty.navigationEntity));
                            this.convertEntityType(entityType, schema).forEach((/**
                             * @param {?} element
                             * @return {?}
                             */
                            element => {
                                if (element.parentItem != null) {
                                    element.parentItem = navigationProperty.name + "." + element.parentItem;
                                }
                                else {
                                    element.parentItem = navigationProperty.name;
                                }
                                element.text = navigationProperty.displayName + "." + element.text;
                                propertyList.push(element);
                            }));
                        }
                        break;
                }
            }));
        }
        return propertyList;
    }
    //==========================分割线（NewSchema）============================================
    /**
     *
     * @param {?} injectedEntity
     * @param {?} newSchemaMap
     * @return {?}
     */
    adapterOfNewSchema(injectedEntity, newSchemaMap) {
        //injectedEntity.schemaName找到Schema
        /** @type {?} */
        let schema = newSchemaMap.get(injectedEntity.schemaName);
        //injectedEntity.injectedType确定找sets还是types
        switch (injectedEntity.injectedType) {
            case FilterInjectedType.EntitySet: {
                /** @type {?} */
                let set = schema.entitySets.find((/**
                 * @param {?} set
                 * @return {?}
                 */
                set => set.code == injectedEntity.name));
                return this.convertNewEntitySet(set, schema);
            }
            case FilterInjectedType.EntityType: {
                /** @type {?} */
                let type = schema.entityTypes.find((/**
                 * @param {?} type
                 * @return {?}
                 */
                type => type.code == injectedEntity.name));
                return this.convertNewEntityType(type, schema);
            }
            default:
                break;
        }
    }
    /**
     * \@description 转换EntityType
     * @param {?} type NewEntityType
     * @param {?} schema NewSchema
     * @return {?}
     */
    convertNewEntityType(type, schema) {
        /** @type {?} */
        let propertyList = Array();
        //property转换
        type.properties.forEach((/**
         * @param {?} pro
         * @return {?}
         */
        pro => {
            /** @type {?} */
            let propertyListItem = {
                value: pro.code,
                text: pro.name,
                propertyDataType: this.convertNewDataType2PropertyDataType(pro.dataType),
                parentItem: null
            };
            propertyList.push(propertyListItem);
        }));
        //navigationProperty转换
        type.navigationProperties.forEach((/**
         * @param {?} naPro
         * @return {?}
         */
        naPro => {
            switch (naPro.navigationType) {
                case NewNavigationType.EntitySet:
                    {
                        /** @type {?} */
                        let naProSet = schema.entitySets.find((/**
                         * @param {?} naProSet
                         * @return {?}
                         */
                        naProSet => naProSet.code == naPro.navigationName));
                        this.convertNewEntitySet(naProSet, schema).forEach((/**
                         * @param {?} ele
                         * @return {?}
                         */
                        ele => {
                            if (ele.parentItem != null) {
                                ele.parentItem = naPro.code + "." + ele.parentItem;
                            }
                            else {
                                ele.parentItem = naPro.code;
                            }
                            ele.text = naPro.name + "." + ele.text;
                            propertyList.push(ele);
                        }));
                    }
                    break;
                case NewNavigationType.EntityType:
                    {
                        /** @type {?} */
                        let naProType = schema.entityTypes.find((/**
                         * @param {?} naProType
                         * @return {?}
                         */
                        naProType => naProType.code == naPro.navigationName));
                        this.convertNewEntityType(naProType, schema).forEach((/**
                         * @param {?} ele
                         * @return {?}
                         */
                        ele => {
                            if (ele.parentItem != null) {
                                ele.parentItem = naPro.code + "." + ele.parentItem;
                            }
                            else {
                                ele.parentItem = naPro.code;
                            }
                            ele.text = naPro.name + "." + ele.text;
                            propertyList.push(ele);
                        }));
                    }
                    break;
            }
        }));
        return propertyList;
    }
    /**
     * @param {?} set
     * @param {?} schema
     * @return {?}
     */
    convertNewEntitySet(set, schema) {
        /** @type {?} */
        let propertyList = Array();
        /** @type {?} */
        let type = schema.entityTypes.find((/**
         * @param {?} type
         * @return {?}
         */
        type => type.code == set.entityType));
        type.properties.forEach((/**
         * @param {?} pro
         * @return {?}
         */
        pro => {
            /** @type {?} */
            let propertyListItem = {
                value: pro.code,
                text: pro.name,
                propertyDataType: this.convertNewDataType2PropertyDataType(pro.dataType),
                parentItem: null
            };
            propertyList.push(propertyListItem);
        }));
        if (type.navigationProperties.length != 0) {
            type.navigationProperties.forEach((/**
             * @param {?} naPro
             * @return {?}
             */
            naPro => {
                switch (naPro.navigationType) {
                    case NewNavigationType.EntitySet:
                        {
                            /** @type {?} */
                            let naProSet = schema.entitySets.find((/**
                             * @param {?} naProSet
                             * @return {?}
                             */
                            naProSet => naProSet.code == naPro.navigationName));
                            this.convertNewEntitySet(naProSet, schema).forEach((/**
                             * @param {?} ele
                             * @return {?}
                             */
                            ele => {
                                if (ele.parentItem != null) {
                                    ele.parentItem = naPro.code + "." + ele.parentItem;
                                }
                                else {
                                    ele.parentItem = naPro.code;
                                }
                                ele.text = naPro.name + "." + ele.text;
                                propertyList.push(ele);
                            }));
                        }
                        break;
                    case NewNavigationType.EntityType:
                        {
                            /** @type {?} */
                            let naProType = schema.entityTypes.find((/**
                             * @param {?} naProType
                             * @return {?}
                             */
                            naProType => naProType.code == naPro.navigationName));
                            this.convertNewEntityType(naProType, schema).forEach((/**
                             * @param {?} ele
                             * @return {?}
                             */
                            ele => {
                                if (ele.parentItem != null) {
                                    ele.parentItem = naPro.code + "." + ele.parentItem;
                                }
                                else {
                                    ele.parentItem = naPro.code;
                                }
                                ele.text = naPro.name + "." + ele.text;
                                propertyList.push(ele);
                            }));
                        }
                        break;
                }
            }));
        }
        return propertyList;
    }
    /**
     *
     * @param {?} newType 统一Schema的属性
     * @return {?}
     */
    convertNewDataType2PropertyDataType(newType) {
        /** @type {?} */
        let type = PropertyDataType.String;
        switch (newType) {
            case NewDataType.Boolean:
                type = PropertyDataType.Boolean;
                break;
            case NewDataType.Byte:
                type = PropertyDataType.Byte;
                break;
            case NewDataType.Date:
                type = PropertyDataType.DateTime;
                break;
            case NewDataType.DateTime:
                type = PropertyDataType.DateTime;
                break;
            case NewDataType.Decimal:
                type = PropertyDataType.Decimal;
                break;
            case NewDataType.Integer:
                type = PropertyDataType.Int32;
                break;
            case NewDataType.String:
                type = PropertyDataType.String;
                break;
        }
        return type;
    }
}
if (false) {
    /** @type {?} */
    PropertyAdapter.prototype.entityName;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHJvcGVydHktYWRhcHRlci5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0Bnc3Atc3ZjL2ZpbHRlcmNvbmRpdGlvbi8iLCJzb3VyY2VzIjpbImxpYi9wcm9wZXJ0eS1hZGFwdGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQXdCLGtCQUFrQixFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFFN0UsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLDhCQUE4QixDQUFDO0FBQzlELE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLEdBQUcsQ0FBQztBQUNyQyxPQUFPLEVBQUUsV0FBVyxFQUErQixpQkFBaUIsRUFBYSxNQUFNLGFBQWEsQ0FBQztBQUVyRyxNQUFNLE9BQU8sZUFBZTs7Ozs7OztJQU94QixPQUFPLENBQUMsY0FBb0MsRUFBRSxTQUEwQzs7O1lBRWhGLE1BQU0sR0FBRyxTQUFTLENBQUMsR0FBRyxDQUFDLGNBQWMsQ0FBQyxVQUFVLENBQUM7UUFDckQsY0FBYztRQUNkLFFBQVEsY0FBYyxDQUFDLFlBQVksRUFBRTtZQUNqQyxLQUFLLGtCQUFrQixDQUFDLFNBQVM7Z0JBQzdCOzt3QkFDUSxTQUFTLEdBQUcsTUFBTSxDQUFDLFVBQVUsQ0FBQyxJQUFJOzs7O29CQUFDLFNBQVMsQ0FBQyxFQUFFLENBQUMsU0FBUyxDQUFDLElBQUksSUFBSSxjQUFjLENBQUMsSUFBSSxFQUFDO29CQUMxRixPQUFPLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxTQUFTLEVBQUUsTUFBTSxDQUFDLENBQUM7aUJBQ25EO1lBQ0wsS0FBSyxrQkFBa0IsQ0FBQyxVQUFVO2dCQUM5Qjs7d0JBQ1EsVUFBVSxHQUFHLE1BQU0sQ0FBQyxXQUFXLENBQUMsSUFBSTs7OztvQkFBQyxVQUFVLENBQUMsRUFBRSxDQUFDLFVBQVUsQ0FBQyxJQUFJLElBQUksY0FBYyxDQUFDLElBQUksRUFBQztvQkFDOUYsT0FBTyxJQUFJLENBQUMsaUJBQWlCLENBQUMsVUFBVSxFQUFFLE1B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SSxHQUFHLGdCQUFnQixDQUFDLFFBQVEsQ0FBQztnQkFDakMsTUFBTTtZQUNWLEtBQUssV0FBVyxDQUFDLE9BQU87Z0JBQ3BCLElBQUksR0FBRyxnQkFBZ0IsQ0FBQyxPQUFPLENBQUM7Z0JBQ2hDLE1BQU07WUFDVixLQUFLLFdBQVcsQ0FBQyxPQUFPO2dCQUNwQixJQUFJLEdBQUcsZ0JBQWdCLENBQUMsS0FBSyxDQUFDO2dCQUM5QixNQUFNO1lBQ1YsS0FBSyxXQUFXLENBQUMsTUFBTTtnQkFDbkIsSUFBSSxHQUFHLGdCQUFnQixDQUFDLE1BQU0sQ0FBQztnQkFDL0IsTUFBTTtTQUNiO1FBQ0QsT0FBTyxJQUFJLENBQUM7SUFDaEIsQ0FBQztDQUVKOzs7SUEzVEcscUNBQW1CIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRmlsdGVySW5qZWN0ZWRFbnRpdHksIEZpbHRlckluamVjdGVkVHlwZSB9IGZyb20gXCIuL2luamVjdGVkLWVudGl0eVwiO1xyXG5pbXBvcnQgeyBGaWx0ZXJFbnRpdHlTY2hlbWEsIEZpbHRlckVudGl0eVR5cGUsIEZpbHRlckVudGl0eVNldCB9IGZyb20gXCIuL3NjaGVtYVwiO1xyXG5pbXBvcnQgeyBOYXZpZ2F0aW9uVHlwZSB9IGZyb20gXCIuL25hdmlnYXRpb24tcHJvcGVydHktZW50aXR5XCI7XHJcbmltcG9ydCB7IFByb3BlcnR5RGF0YVR5cGUgfSBmcm9tIFwiLlwiO1xyXG5pbXBvcnQgeyBOZXdEYXRhVHlwZSwgTmV3RW50aXR5U2V0LCBOZXdFbnRpdHlUeXBlLCBOZXdOYXZpZ2F0aW9uVHlwZSwgTmV3U2NoZW1hIH0gZnJvbSBcIi4vTmV3U2NoZW1hXCI7XHJcblxyXG5leHBvcnQgY2xhc3MgUHJvcGVydHlBZGFwdGVyIHtcclxuICAgIGVudGl0eU5hbWU6IHN0cmluZztcclxuICAgIC8qKlxyXG4gICAgICog5bGe5oCn6YCC6YWN5Zmo77yM5rOo5YWl5aSa57qn5a6e5L2T6L2s5YyW5Li6QXJyYXlcclxuICAgICAqIEBwYXJhbSBpbmplY3RlZEVudGl0eSDms6jlhaXnmoTlrp7kvZNcclxuICAgICAqIEBwYXJhbSBzY2hlbWFNYXAg5rOo5YWl55qEc2NoZW1hXHJcbiAgICAgKi9cclxuICAgIGFkYXB0ZXIoaW5qZWN0ZWRFbnRpdHk6IEZpbHRlckluamVjdGVkRW50aXR5LCBzY2hlbWFNYXA6IE1hcDxzdHJpbmcsIEZpbHRlckVudGl0eVNjaGVtYT4pIHtcclxuICAgICAgICAvL+agueaNruazqOWFpXNjaGVtYeWQjeW+l+WIsHNjaGVtYVxyXG4gICAgICAgIGxldCBzY2hlbWEgPSBzY2hlbWFNYXAuZ2V0KGluamVjdGVkRW50aXR5LnNjaGVtYU5hbWUpO1xyXG4gICAgICAgIC8v5qC55o2u5rOo5YWl57G75Z6L5YiG5Yir6L+b6KGM6L2s5YyWXHJcbiAgICAgICAgc3dpdGNoIChpbmplY3RlZEVudGl0eS5pbmplY3RlZFR5cGUpIHtcclxuICAgICAgICAgICAgY2FzZSBGaWx0ZXJJbmplY3RlZFR5cGUuRW50aXR5U2V0OlxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCBlbnRpdHlTZXQgPSBzY2hlbWEuZW50aXR5U2V0cy5maW5kKGVudGl0eVNldCA9PiBlbnRpdHlTZXQubmFtZSA9PSBpbmplY3RlZEVudGl0eS5uYW1lKTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5jb252ZXJ0RW50aXR5U2V0KGVudGl0eVNldCwgc2NoZW1hKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY2FzZSBGaWx0ZXJJbmplY3RlZFR5cGUuRW50aXR5VHlwZTpcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBsZXQgZW50aXR5VHlwZSA9IHNjaGVtYS5lbnRpdHlUeXBlcy5maW5kKGVudGl0eVR5cGUgPT4gZW50aXR5VHlwZS5uYW1lID09IGluamVjdGVkRW50aXR5Lm5hbWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmNvbnZlcnRFbnRpdHlUeXBlKGVudGl0eVR5cGUsIHNjaGVtYSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGRlZmF1bHQ6IGJyZWFrO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICog5bCG5a6e5L2T57G76L2s5YyW5oiQQXJycmF5XHJcbiAgICAgKiBAcGFyYW0gZW50aXR5VHlwZSDooqvovazmjaLnmoTlrp7kvZPnsbtcclxuICAgICAqL1xyXG4gICAgY29udmVydEVudGl0eVR5cGUoZW50aXR5VHlwZTogRmlsdGVyRW50aXR5VHlwZSwgc2NoZW1hOiBGaWx0ZXJFbnRpdHlTY2hlbWEpOiBhbnkge1xyXG4gICAgICAgIGxldCBwcm9wZXJ0eUxpc3QgPSBBcnJheTx7IHRleHQ6IHN0cmluZywgcHJvcGVydHlEYXRhVHlwZTogUHJvcGVydHlEYXRhVHlwZSwgdmFsdWU6IHN0cmluZywgcGFyZW50SXRlbTogc3RyaW5nIH0+KCk7XHJcbiAgICAgICAgLy/luLjop4TlsZ7mgKfovazljJZcclxuICAgICAgICBlbnRpdHlUeXBlLnByb3BlcnRpZXMuZm9yRWFjaChwcm9wZXJ0eSA9PiB7XHJcbiAgICAgICAgICAgIGxldCBwcm9wZXJ0eUxpc3RJdGVtID1cclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgdGV4dDogcHJvcGVydHkuZGlzcGxheU5hbWUsXHJcbiAgICAgICAgICAgICAgICBwcm9wZXJ0eURhdGFUeXBlOiBwcm9wZXJ0eS5wcm9wZXJ0eURhdGFUeXBlLFxyXG4gICAgICAgICAgICAgICAgdmFsdWU6IHByb3BlcnR5Lm5hbWUsXHJcbiAgICAgICAgICAgICAgICBwYXJlbnRJdGVtOiBudWxsXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIHByb3BlcnR5TGlzdC5wdXNoKHByb3BlcnR5TGlzdEl0ZW0pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIC8v5a+86Iiq5bGe5oCn6L2s5YyWXHJcbiAgICAgICAgZW50aXR5VHlwZS5uYXZpZ2F0aW9uUHJvcGVydGllcy5mb3JFYWNoKG5hdmlnYXRpb25Qcm9wZXJ0eSA9PiB7XHJcbiAgICAgICAgICAgIC8v5qC55o2u5a+86Iiq5bGe5oCn57G75Z6L6L+b6KGM6L2s5YyWXHJcbiAgICAgICAgICAgIHN3aXRjaCAobmF2aWdhdGlvblByb3BlcnR5Lm5hdmlnYXRpb25UeXBlKSB7XHJcbiAgICAgICAgICAgICAgICAvL+iLpeWvvOiIquWxnuaAp+S4ukVudGl0eVNldFxyXG4gICAgICAgICAgICAgICAgY2FzZSBOYXZpZ2F0aW9uVHlwZS5FbnRpdHlTZXQ6XHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL+agueaNruWvvOiIquWxnuaAp+WQjeaJvuWIsHNjaGVtYeS4reeahEVudGl0eVNldFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgZW50aXR5U2V0ID0gc2NoZW1hLmVudGl0eVNldHMuZmluZChlbnRpdHlTZXQgPT4gZW50aXR5U2V0Lm5hbWUgPT0gbmF2aWdhdGlvblByb3BlcnR5Lm5hdmlnYXRpb25FbnRpdHkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL+WtkOWunuS9k+mbhui9rOWMluS4ukFycmF5XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY29udmVydEVudGl0eVNldChlbnRpdHlTZXQsIHNjaGVtYSkuZm9yRWFjaChlbGVtZW50ID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8v6Iul5a2Q5a6e5L2T5Lit55qE5q+P5Liq5bGe5oCn54i26aG55LiN5Li656m677yM5YiZ5Zyo54i26aG55ZCN5YmN5re75Yqg6K+l5a+86Iiq5bGe5oCn5ZCN77yM5L6L5aaCT3JkZXJJdGVt5YmN5YqgT3JkZXLkuLpPcmRlcnMuT3JkZXJJdGVtXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZWxlbWVudC5wYXJlbnRJdGVtICE9IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50LnBhcmVudEl0ZW0gPSBuYXZpZ2F0aW9uUHJvcGVydHkubmFtZSArIFwiLlwiICsgZWxlbWVudC5wYXJlbnRJdGVtO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy/oi6XniLbpobnkuLrnqbrvvIzliJnorr7nva7or6XlsZ7mgKfniLbpobnkuLrlr7zoiKrlsZ7mgKflkI1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQucGFyZW50SXRlbSA9IG5hdmlnYXRpb25Qcm9wZXJ0eS5uYW1lO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy/orr7nva7or6XlsZ7mgKfnmoTmmL7npLrlkI3np7BcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQudGV4dCA9IG5hdmlnYXRpb25Qcm9wZXJ0eS5kaXNwbGF5TmFtZSArIFwiLlwiICsgZWxlbWVudC50ZXh0O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvcGVydHlMaXN0LnB1c2goZWxlbWVudCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAvL+iLpeWvvOiIquWxnuaAp+exu+Wei+S4ukVudGl0eVR5cGVcclxuICAgICAgICAgICAgICAgIGNhc2UgTmF2aWdhdGlvblR5cGUuRW50aXR5VHlwZTpcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8v5qC55o2u5a+86Iiq5bGe5oCn5ZCN5om+5Yiwc2NoZW1h5Lit55qERW50aXR5VHlwZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgZW50aXR5VHlwZSA9IHNjaGVtYS5lbnRpdHlUeXBlcy5maW5kKGVudGl0eVR5cGUgPT4gZW50aXR5VHlwZS5uYW1lID09IG5hdmlnYXRpb25Qcm9wZXJ0eS5uYXZpZ2F0aW9uRW50aXR5KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy/lrZDlrp7kvZPovazljJbkuLpBcnJheVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbnZlcnRFbnRpdHlUeXBlKGVudGl0eVR5cGUsIHNjaGVtYSkuZm9yRWFjaChlbGVtZW50ID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8v6Iul5a2Q5a6e5L2T5Lit55qE5q+P5Liq5bGe5oCn54i26aG55LiN5Li656m677yM5YiZ5Zyo54i26aG55ZCN5YmN5re75Yqg6K+l5a+86Iiq5bGe5oCn5ZCN77yM5L6L5aaCT3JkZXJJdGVt5YmN5YqgT3JkZXLkuLpPcmRlci5PcmRlckl0ZW1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlbGVtZW50LnBhcmVudEl0ZW0gIT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQucGFyZW50SXRlbSA9IG5hdmlnYXRpb25Qcm9wZXJ0eS5uYW1lICsgXCIuXCIgKyBlbGVtZW50LnBhcmVudEl0ZW07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL+iLpeeItumhueS4uuepuu+8jOWImeiuvue9ruivpeWxnuaAp+eItumhueS4uuWvvOiIquWxnuaAp+WQjVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5wYXJlbnRJdGVtID0gbmF2aWdhdGlvblByb3BlcnR5Lm5hbWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL+iuvue9ruivpeWxnuaAp+eahOaYvuekuuWQjeensFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudC50ZXh0ID0gbmF2aWdhdGlvblByb3BlcnR5LmRpc3BsYXlOYW1lICsgXCIuXCIgKyBlbGVtZW50LnRleHQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0eUxpc3QucHVzaChlbGVtZW50KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgcmV0dXJuIHByb3BlcnR5TGlzdDtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICog5a6e5L2T6ZuG6L2s5YyW5Li65bGe5oCn5YiX6KGoXHJcbiAgICAgKiBAcGFyYW0gZW50aXR5U2V0IOW+hei9rOWMluWunuS9k+mbhlxyXG4gICAgICogQHBhcmFtIHNjaGVtYSDmiYDlnKhzY2hlbWFcclxuICAgICAqL1xyXG4gICAgY29udmVydEVudGl0eVNldChlbnRpdHlTZXQ6IEZpbHRlckVudGl0eVNldCwgc2NoZW1hOiBGaWx0ZXJFbnRpdHlTY2hlbWEpOiBhbnkge1xyXG4gICAgICAgIGxldCBwcm9wZXJ0eUxpc3QgPSBBcnJheTx7IHRleHQ6IHN0cmluZywgcHJvcGVydHlEYXRhVHlwZTogUHJvcGVydHlEYXRhVHlwZSwgdmFsdWU6IHN0cmluZyB9PigpO1xyXG4gICAgICAgIGxldCBlbnRpdHlUeXBlID0gc2NoZW1hLmVudGl0eVR5cGVzLmZpbmQoZW50aXR5VHlwZSA9PiBlbnRpdHlUeXBlLm5hbWUgPT0gZW50aXR5U2V0LmVudGl0eVR5cGVOYW1lKTtcclxuXHJcbiAgICAgICAgZW50aXR5VHlwZS5wcm9wZXJ0aWVzLmZvckVhY2gocHJvcGVydHkgPT4ge1xyXG4gICAgICAgICAgICBsZXQgcHJvcGVydHlMaXN0SXRlbSA9XHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHRleHQ6IHByb3BlcnR5LmRpc3BsYXlOYW1lLFxyXG4gICAgICAgICAgICAgICAgcHJvcGVydHlEYXRhVHlwZTogcHJvcGVydHkucHJvcGVydHlEYXRhVHlwZSxcclxuICAgICAgICAgICAgICAgIHZhbHVlOiBwcm9wZXJ0eS5uYW1lLFxyXG4gICAgICAgICAgICAgICAgcGFyZW50SXRlbTogbnVsbFxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICBwcm9wZXJ0eUxpc3QucHVzaChwcm9wZXJ0eUxpc3RJdGVtKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICBpZiAoZW50aXR5VHlwZS5uYXZpZ2F0aW9uUHJvcGVydGllcy5sZW5ndGggIT0gMCkge1xyXG4gICAgICAgICAgICAvL+WvvOiIquWxnuaAp+i9rOWMllxyXG4gICAgICAgICAgICBlbnRpdHlUeXBlLm5hdmlnYXRpb25Qcm9wZXJ0aWVzLmZvckVhY2gobmF2aWdhdGlvblByb3BlcnR5ID0+IHtcclxuXHJcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKG5hdmlnYXRpb25Qcm9wZXJ0eS5uYXZpZ2F0aW9uVHlwZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgTmF2aWdhdGlvblR5cGUuRW50aXR5U2V0OlxyXG4gICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgZW50aXR5U2V0ID0gc2NoZW1hLmVudGl0eVNldHMuZmluZChlbnRpdHlTZXQgPT4gZW50aXR5U2V0Lm5hbWUgPT0gbmF2aWdhdGlvblByb3BlcnR5Lm5hdmlnYXRpb25FbnRpdHkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jb252ZXJ0RW50aXR5U2V0KGVudGl0eVNldCwgc2NoZW1hKS5mb3JFYWNoKGVsZW1lbnQgPT4ge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZWxlbWVudC5wYXJlbnRJdGVtICE9IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5wYXJlbnRJdGVtID0gbmF2aWdhdGlvblByb3BlcnR5Lm5hbWUgKyBcIi5cIiArIGVsZW1lbnQucGFyZW50SXRlbTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQucGFyZW50SXRlbSA9IG5hdmlnYXRpb25Qcm9wZXJ0eS5uYW1lO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50LnRleHQgPSBuYXZpZ2F0aW9uUHJvcGVydHkuZGlzcGxheU5hbWUgKyBcIi5cIiArIGVsZW1lbnQudGV4dDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0eUxpc3QucHVzaChlbGVtZW50KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgTmF2aWdhdGlvblR5cGUuRW50aXR5VHlwZTpcclxuICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGVudGl0eVR5cGUgPSBzY2hlbWEuZW50aXR5VHlwZXMuZmluZChlbnRpdHlUeXBlID0+IGVudGl0eVR5cGUubmFtZSA9PSBuYXZpZ2F0aW9uUHJvcGVydHkubmF2aWdhdGlvbkVudGl0eSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbnZlcnRFbnRpdHlUeXBlKGVudGl0eVR5cGUsIHNjaGVtYSkuZm9yRWFjaChlbGVtZW50ID0+IHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGVsZW1lbnQucGFyZW50SXRlbSAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQucGFyZW50SXRlbSA9IG5hdmlnYXRpb25Qcm9wZXJ0eS5uYW1lICsgXCIuXCIgKyBlbGVtZW50LnBhcmVudEl0ZW07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50LnBhcmVudEl0ZW0gPSBuYXZpZ2F0aW9uUHJvcGVydHkubmFtZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudC50ZXh0ID0gbmF2aWdhdGlvblByb3BlcnR5LmRpc3BsYXlOYW1lICsgXCIuXCIgKyBlbGVtZW50LnRleHQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvcGVydHlMaXN0LnB1c2goZWxlbWVudCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBwcm9wZXJ0eUxpc3Q7XHJcbiAgICB9XHJcblxyXG4gICAgLy89PT09PT09PT09PT09PT09PT09PT09PT09PeWIhuWJsue6v++8iE5ld1NjaGVtYe+8iT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XHJcbiAgICAvKipcclxuICAgICAqIFxyXG4gICAgICogQHBhcmFtIGluamVjdGVkRW50aXR5IFxyXG4gICAgICogQHBhcmFtIG5ld1NjaGVtYU1hcCBcclxuICAgICAqL1xyXG4gICAgcHVibGljIGFkYXB0ZXJPZk5ld1NjaGVtYShpbmplY3RlZEVudGl0eTogRmlsdGVySW5qZWN0ZWRFbnRpdHksIG5ld1NjaGVtYU1hcDogTWFwPHN0cmluZywgTmV3U2NoZW1hPikge1xyXG4gICAgICAgIC8vaW5qZWN0ZWRFbnRpdHkuc2NoZW1hTmFtZeaJvuWIsFNjaGVtYVxyXG4gICAgICAgIGxldCBzY2hlbWEgPSBuZXdTY2hlbWFNYXAuZ2V0KGluamVjdGVkRW50aXR5LnNjaGVtYU5hbWUpO1xyXG5cclxuICAgICAgICAvL2luamVjdGVkRW50aXR5LmluamVjdGVkVHlwZeehruWumuaJvnNldHPov5jmmK90eXBlc1xyXG4gICAgICAgIHN3aXRjaCAoaW5qZWN0ZWRFbnRpdHkuaW5qZWN0ZWRUeXBlKSB7XHJcbiAgICAgICAgICAgIGNhc2UgRmlsdGVySW5qZWN0ZWRUeXBlLkVudGl0eVNldDoge1xyXG4gICAgICAgICAgICAgICAgbGV0IHNldCA9IHNjaGVtYS5lbnRpdHlTZXRzLmZpbmQoc2V0ID0+IHNldC5jb2RlID09IGluamVjdGVkRW50aXR5Lm5hbWUpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuY29udmVydE5ld0VudGl0eVNldChzZXQsIHNjaGVtYSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY2FzZSBGaWx0ZXJJbmplY3RlZFR5cGUuRW50aXR5VHlwZToge1xyXG4gICAgICAgICAgICAgICAgbGV0IHR5cGUgPSBzY2hlbWEuZW50aXR5VHlwZXMuZmluZCh0eXBlID0+IHR5cGUuY29kZSA9PSBpbmplY3RlZEVudGl0eS5uYW1lKTtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmNvbnZlcnROZXdFbnRpdHlUeXBlKHR5cGUsIHNjaGVtYSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEBkZXNjcmlwdGlvbiDovazmjaJFbnRpdHlUeXBlXHJcbiAgICAgKiBAcGFyYW0gdHlwZSBOZXdFbnRpdHlUeXBlXHJcbiAgICAgKiBAcGFyYW0gc2NoZW1hIE5ld1NjaGVtYVxyXG4gICAgICogQHJldHVybnMgXHJcbiAgICAgKi9cclxuICAgIGNvbnZlcnROZXdFbnRpdHlUeXBlKHR5cGU6IE5ld0VudGl0eVR5cGUsIHNjaGVtYTogTmV3U2NoZW1hKTogYW55IHtcclxuICAgICAgICBsZXQgcHJvcGVydHlMaXN0ID0gQXJyYXk8eyB0ZXh0OiBzdHJpbmcsIHByb3BlcnR5RGF0YVR5cGU6IFByb3BlcnR5RGF0YVR5cGUsIHZhbHVlOiBzdHJpbmcsIHBhcmVudEl0ZW06IHN0cmluZyB9PigpO1xyXG4gICAgICAgIC8vcHJvcGVydHnovazmjaJcclxuICAgICAgICB0eXBlLnByb3BlcnRpZXMuZm9yRWFjaChwcm8gPT4ge1xyXG4gICAgICAgICAgICBsZXQgcHJvcGVydHlMaXN0SXRlbSA9XHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHZhbHVlOiBwcm8uY29kZSxcclxuICAgICAgICAgICAgICAgIHRleHQ6IHByby5uYW1lLFxyXG4gICAgICAgICAgICAgICAgcHJvcGVydHlEYXRhVHlwZTogdGhpcy5jb252ZXJ0TmV3RGF0YVR5cGUyUHJvcGVydHlEYXRhVHlwZShwcm8uZGF0YVR5cGUpLFxyXG4gICAgICAgICAgICAgICAgcGFyZW50SXRlbTogbnVsbFxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICBwcm9wZXJ0eUxpc3QucHVzaChwcm9wZXJ0eUxpc3RJdGVtKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICAvL25hdmlnYXRpb25Qcm9wZXJ0eei9rOaNolxyXG4gICAgICAgIHR5cGUubmF2aWdhdGlvblByb3BlcnRpZXMuZm9yRWFjaChuYVBybyA9PiB7XHJcbiAgICAgICAgICAgIHN3aXRjaCAobmFQcm8ubmF2aWdhdGlvblR5cGUpIHtcclxuICAgICAgICAgICAgICAgIGNhc2UgTmV3TmF2aWdhdGlvblR5cGUuRW50aXR5U2V0OlxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IG5hUHJvU2V0ID0gc2NoZW1hLmVudGl0eVNldHMuZmluZChuYVByb1NldCA9PiBuYVByb1NldC5jb2RlID09IG5hUHJvLm5hdmlnYXRpb25OYW1lKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jb252ZXJ0TmV3RW50aXR5U2V0KG5hUHJvU2V0LCBzY2hlbWEpLmZvckVhY2goZWxlID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlbGUucGFyZW50SXRlbSAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxlLnBhcmVudEl0ZW0gPSBuYVByby5jb2RlICsgXCIuXCIgKyBlbGUucGFyZW50SXRlbTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxlLnBhcmVudEl0ZW0gPSBuYVByby5jb2RlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxlLnRleHQgPSBuYVByby5uYW1lICsgXCIuXCIgKyBlbGUudGV4dDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb3BlcnR5TGlzdC5wdXNoKGVsZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgTmV3TmF2aWdhdGlvblR5cGUuRW50aXR5VHlwZTpcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBuYVByb1R5cGUgPSBzY2hlbWEuZW50aXR5VHlwZXMuZmluZChuYVByb1R5cGUgPT4gbmFQcm9UeXBlLmNvZGUgPT0gbmFQcm8ubmF2aWdhdGlvbk5hbWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbnZlcnROZXdFbnRpdHlUeXBlKG5hUHJvVHlwZSwgc2NoZW1hKS5mb3JFYWNoKGVsZSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZWxlLnBhcmVudEl0ZW0gIT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsZS5wYXJlbnRJdGVtID0gbmFQcm8uY29kZSArIFwiLlwiICsgZWxlLnBhcmVudEl0ZW07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsZS5wYXJlbnRJdGVtID0gbmFQcm8uY29kZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsZS50ZXh0ID0gbmFQcm8ubmFtZSArIFwiLlwiICsgZWxlLnRleHQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0eUxpc3QucHVzaChlbGUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KVxyXG4gICAgICAgIHJldHVybiBwcm9wZXJ0eUxpc3Q7XHJcbiAgICB9XHJcblxyXG5cclxuICAgIGNvbnZlcnROZXdFbnRpdHlTZXQoc2V0OiBOZXdFbnRpdHlTZXQsIHNjaGVtYTogTmV3U2NoZW1hKTogYW55IHtcclxuICAgICAgICBsZXQgcHJvcGVydHlMaXN0ID0gQXJyYXk8eyB0ZXh0OiBzdHJpbmcsIHByb3BlcnR5RGF0YVR5cGU6IFByb3BlcnR5RGF0YVR5cGUsIHZhbHVlOiBzdHJpbmcsIHBhcmVudEl0ZW06IHN0cmluZyB9PigpO1xyXG4gICAgICAgIGxldCB0eXBlID0gc2NoZW1hLmVudGl0eVR5cGVzLmZpbmQodHlwZSA9PiB0eXBlLmNvZGUgPT0gc2V0LmVudGl0eVR5cGUpO1xyXG4gICAgICAgIHR5cGUucHJvcGVydGllcy5mb3JFYWNoKHBybyA9PiB7XHJcbiAgICAgICAgICAgIGxldCBwcm9wZXJ0eUxpc3RJdGVtID1cclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgdmFsdWU6IHByby5jb2RlLFxyXG4gICAgICAgICAgICAgICAgdGV4dDogcHJvLm5hbWUsXHJcbiAgICAgICAgICAgICAgICBwcm9wZXJ0eURhdGFUeXBlOiB0aGlzLmNvbnZlcnROZXdEYXRhVHlwZTJQcm9wZXJ0eURhdGFUeXBlKHByby5kYXRhVHlwZSksXHJcbiAgICAgICAgICAgICAgICBwYXJlbnRJdGVtOiBudWxsXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIHByb3BlcnR5TGlzdC5wdXNoKHByb3BlcnR5TGlzdEl0ZW0pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIGlmICh0eXBlLm5hdmlnYXRpb25Qcm9wZXJ0aWVzLmxlbmd0aCAhPSAwKSB7XHJcbiAgICAgICAgICAgIHR5cGUubmF2aWdhdGlvblByb3BlcnRpZXMuZm9yRWFjaChuYVBybyA9PiB7XHJcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKG5hUHJvLm5hdmlnYXRpb25UeXBlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBOZXdOYXZpZ2F0aW9uVHlwZS5FbnRpdHlTZXQ6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBuYVByb1NldCA9IHNjaGVtYS5lbnRpdHlTZXRzLmZpbmQobmFQcm9TZXQgPT4gbmFQcm9TZXQuY29kZSA9PSBuYVByby5uYXZpZ2F0aW9uTmFtZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbnZlcnROZXdFbnRpdHlTZXQobmFQcm9TZXQsIHNjaGVtYSkuZm9yRWFjaChlbGUgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZWxlLnBhcmVudEl0ZW0gIT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxlLnBhcmVudEl0ZW0gPSBuYVByby5jb2RlICsgXCIuXCIgKyBlbGUucGFyZW50SXRlbTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsZS5wYXJlbnRJdGVtID0gbmFQcm8uY29kZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGUudGV4dCA9IG5hUHJvLm5hbWUgKyBcIi5cIiArIGVsZS50ZXh0O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0eUxpc3QucHVzaChlbGUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBOZXdOYXZpZ2F0aW9uVHlwZS5FbnRpdHlUeXBlOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgbmFQcm9UeXBlID0gc2NoZW1hLmVudGl0eVR5cGVzLmZpbmQobmFQcm9UeXBlID0+IG5hUHJvVHlwZS5jb2RlID09IG5hUHJvLm5hdmlnYXRpb25OYW1lKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY29udmVydE5ld0VudGl0eVR5cGUobmFQcm9UeXBlLCBzY2hlbWEpLmZvckVhY2goZWxlID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZWxlLnBhcmVudEl0ZW0gIT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGUucGFyZW50SXRlbSA9IG5hUHJvLmNvZGUgKyBcIi5cIiArIGVsZS5wYXJlbnRJdGVtO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsZS5wYXJlbnRJdGVtID0gbmFQcm8uY29kZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxlLnRleHQgPSBuYVByby5uYW1lICsgXCIuXCIgKyBlbGUudGV4dDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0eUxpc3QucHVzaChlbGUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBwcm9wZXJ0eUxpc3Q7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBcclxuICAgICAqIEBwYXJhbSBuZXdUeXBlIOe7n+S4gFNjaGVtYeeahOWxnuaAp1xyXG4gICAgICogQHJldHVybnMgXHJcbiAgICAgKi9cclxuICAgIGNvbnZlcnROZXdEYXRhVHlwZTJQcm9wZXJ0eURhdGFUeXBlKG5ld1R5cGU6IE5ld0RhdGFUeXBlKTogUHJvcGVydHlEYXRhVHlwZSB7XHJcbiAgICAgICAgbGV0IHR5cGUgPSBQcm9wZXJ0eURhdGFUeXBlLlN0cmluZztcclxuICAgICAgICBzd2l0Y2ggKG5ld1R5cGUpIHtcclxuICAgICAgICAgICAgY2FzZSBOZXdEYXRhVHlwZS5Cb29sZWFuOlxyXG4gICAgICAgICAgICAgICAgdHlwZSA9IFByb3BlcnR5RGF0YVR5cGUuQm9vbGVhbjtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlIE5ld0RhdGFUeXBlLkJ5dGU6XHJcbiAgICAgICAgICAgICAgICB0eXBlID0gUHJvcGVydHlEYXRhVHlwZS5CeXRlO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgTmV3RGF0YVR5cGUuRGF0ZTpcclxuICAgICAgICAgICAgICAgIHR5cGUgPSBQcm9wZXJ0eURhdGFUeXBlLkRhdGVUaW1lO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgTmV3RGF0YVR5cGUuRGF0ZVRpbWU6XHJcbiAgICAgICAgICAgICAgICB0eXBlID0gUHJvcGVydHlEYXRhVHlwZS5EYXRlVGltZTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlIE5ld0RhdGFUeXBlLkRlY2ltYWw6XHJcbiAgICAgICAgICAgICAgICB0eXBlID0gUHJvcGVydHlEYXRhVHlwZS5EZWNpbWFsO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgTmV3RGF0YVR5cGUuSW50ZWdlcjpcclxuICAgICAgICAgICAgICAgIHR5cGUgPSBQcm9wZXJ0eURhdGFUeXBlLkludDMyO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgTmV3RGF0YVR5cGUuU3RyaW5nOlxyXG4gICAgICAgICAgICAgICAgdHlwZSA9IFByb3BlcnR5RGF0YVR5cGUuU3RyaW5nO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB0eXBlO1xyXG4gICAgfVxyXG5cclxufSJdfQ==
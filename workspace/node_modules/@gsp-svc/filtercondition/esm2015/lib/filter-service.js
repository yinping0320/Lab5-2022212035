/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Injectable, Injector, ApplicationRef, ComponentFactoryResolver } from "@angular/core";
import { FilterConditionComponent } from "./filter-condition/filter-condition.component";
import { Schema } from "@gsp-svc/expression";
import { InjectedEntity } from "@gsp-svc/expression";
import { FilterInjectedEntity, FilterInjectedType } from "./injected-entity";
import { PropertyAdapter } from "./property-adapter";
import { Adapter } from "./adapter";
import { BsModalService } from '@farris/ui-modal';
import { HttpClient } from "@angular/common/http";
/**
 * 过滤表达式服务类
 * @author linchang 2018/12/10
 */
export class FilterService {
    /**
     * @param {?} injector
     * @param {?} applicationRef
     * @param {?} compFactRes
     * @param {?} http
     */
    constructor(injector, applicationRef, compFactRes, http) {
        this.injector = injector;
        this.applicationRef = applicationRef;
        this.compFactRes = compFactRes;
        this.http = http;
        this.i = 0;
        this.adapter = new Adapter();
        //属性列表
        this.propertyList = [];
        //预置计算表达式变量
        this.contextEntity = [];
        this.expressionText = null;
        this.expressionSchema = Array();
        this.expressionInjectedEntities = [];
        this.expressionCDT = [];
        //预置条件表达式变量
        this.filterExpressionString = null; //过滤表达式序列化串
        //过滤表达式序列化串
        this.schemaMap = new Map();
        this.newSchemaMap = new Map(); //过滤表达式添加NewSchema
        this.exprWinWidth = 850;
        this.modalService = this.injector.get(BsModalService);
    }
    // 创建表达式
    /**
     * @return {?}
     */
    buildExpression() {
        /** @type {?} */
        let that = this;
        return new Promise((/**
         * @param {?} resolve
         * @return {?}
         */
        function (resolve) {
            /** @type {?} */
            const compFactory = that.compFactRes.resolveComponentFactory(FilterConditionComponent);
            /** @type {?} */
            const compRef = compFactory.create(that.injector);
            compRef.instance.propertyList = that.propertyList;
            compRef.instance.contextEntity = that.contextEntity;
            compRef.instance.expressionCDT = that.expressionCDT;
            compRef.instance.expressionSchema = that.expressionSchema;
            compRef.instance.expressionText = that.expressionText;
            compRef.instance.expressionInjectedEntities = that.expressionInjectedEntities;
            compRef.instance.filterExpressionString = that.filterExpressionString;
            compRef.instance.schemaMap = that.schemaMap;
            //===================组件加入newSchemaMap===============
            compRef.instance.newSchemaMap = that.newSchemaMap;
            //=====================================================    
            compRef.instance.exprWinWidth = that.exprWinWidth;
            that.localePipe = compRef.instance.localePipe;
            /** @type {?} */
            const dialog = that.modalService.show(compRef, {
                title: that.localePipe.transform("WindowTitle"),
                width: 1010,
                height: 550,
                showButtons: false
            });
            compRef.instance.closed.subscribe((/**
             * @param {?} $event
             * @return {?}
             */
            $event => dialog.close()));
            compRef.instance.result.subscribe((/**
             * @param {?} expressionContent
             * @return {?}
             */
            (expressionContent) => {
                return resolve(expressionContent);
            }));
        }));
    }
    /**
     *  预置属性列表
     * @param {?} name 属性语义
     * @param {?} displayName 展示名称
     * @param {?} propertyDataType 属性数据类型
     * @return {?}
     */
    addProperty(name, displayName, propertyDataType) {
        /** @type {?} */
        let propertyEntity = {
            text: displayName,
            propertyDataType: propertyDataType,
            value: name,
            parentItem: null
        };
        this.propertyList = this.propertyList.filter((/**
         * @param {?} item
         * @return {?}
         */
        item => item.value !== name));
        this.propertyList.push(propertyEntity);
    }
    /**
     * 添加上下文变量
     * @param {?} contextEntity 上下文变量
     * @return {?}
     */
    addExpressionContext(contextEntity) {
        this.contextEntity = this.contextEntity.filter((/**
         * @param {?} item
         * @return {?}
         */
        item => item.key !== contextEntity.key));
        this.contextEntity.push(contextEntity);
    }
    /**
     * 预置表达式默认显示
     * @param {?} text 预置文本
     * @return {?}
     */
    addExpressionText(text) {
        this.expressionText = text;
    }
    /**
     * 预置Schema
     * @param {?} name schema名称
     * @param {?} schema schema实体
     * @return {?}
     */
    addExpressionSchema(name, schema) {
        this.expressionSchema = this.expressionSchema.filter((/**
         * @param {?} item
         * @return {?}
         */
        item => item.name !== name));
        this.expressionSchema.push({ name, schema });
    }
    /**
     * 预置注册实体
     * @author linchang 2018/12/10
     * @param {?} name 注册实体名
     * @param {?} schemaName 所在schema的名
     * @param {?} typeNameInSchema 在schema中名称
     * @param {?} injectedType 注册的类型
     * @return {?}
     */
    addExpressionInjectedEntity(name, schemaName, typeNameInSchema, injectedType) {
        //构造注入实体对象
        /** @type {?} */
        let injectedEntity = new InjectedEntity();
        injectedEntity.name = name;
        injectedEntity.schemaName = schemaName;
        injectedEntity.injectedName = typeNameInSchema;
        injectedEntity.injectedType = injectedType;
        this.expressionInjectedEntities.push(injectedEntity);
    }
    /**
     * 预置CDT
     * @param {?} gspCDTs 预置的CDT集合
     * @return {?}
     */
    addExpressionCDT(gspCDTs) {
        this.expressionCDT = gspCDTs;
    }
    /**
     * 预置过滤条件表达式
     * @param {?} filterExpression 预置的过滤表达式串
     * @return {?}
     */
    addFilterCondition(filterExpression) {
        this.filterExpressionString = filterExpression;
    }
    /**
     * 预置schema
     * @param {?} name schema名,默认为CO
     * @param {?} filterSchema schema实体
     * @return {?}
     */
    addSchema(name, filterSchema) {
        if (filterSchema == null) {
            alert("Schema Cannot Null");
        }
        else
            this.schemaMap.set(name, filterSchema);
    }
    /**
     * 添加注入实体
     * @param {?} name 注入实体在schema中的名称
     * @param {?} schemaName 注入实体所在的schema名
     * @param {?=} injectedType 注入类型，不填默认为EntityType
     * @return {?}
     */
    addInjectedEntity(name, schemaName, injectedType = FilterInjectedType.EntityType) {
        this.injectedEntity = new FilterInjectedEntity();
        this.injectedEntity.name = name;
        this.injectedEntity.schemaName = schemaName;
        this.injectedEntity.injectedType = injectedType;
        /** @type {?} */
        let propertyAdapter = new PropertyAdapter();
        this.propertyList = propertyAdapter.adapter(this.injectedEntity, this.schemaMap);
    }
    /**
     * 添加GSPCommonObject
     * @param {?} commonObject 待转化CO
     * @return {?}
     */
    addCommonObject(commonObject) {
        /** @type {?} */
        let schema;
        //若schemaMap中存在CO的schema
        if (this.schemaMap.get("CommonObject")) {
            schema = this.schemaMap.get("CommonObject");
        }
        else
            schema = new Schema;
        //将每一个CO转化为schema内部结构中的entityType
        /** @type {?} */
        let entityTypes = this.adapter.convertCO(commonObject);
        entityTypes.forEach((/**
         * @param {?} entityType
         * @return {?}
         */
        entityType => {
            schema.entityTypes = schema.entityTypes.filter((/**
             * @param {?} item
             * @return {?}
             */
            item => item.name !== entityType.name));
            schema.entityTypes.push(entityType);
        }));
        //将合并后的schema放入内部上下文实体中
        this.addSchema("CommonObject", schema);
    }
    /**
     * 设置计算表达式弹出框宽度
     * @param {?} exprWinWidth
     * @return {?}
     */
    addExprWinWidth(exprWinWidth) {
        this.exprWinWidth = exprWinWidth;
    }
    //======================华丽分割线之统一结构Schema============================================================
    /**
     * \@description 向newSchemaMap中添加NewSchema
     * @param {?} name Map中的key值
     * @param {?} schema Map的value
     * @return {?}
     */
    addNewSchema(name, schema) {
        if (name != null && name != "" && schema != null) {
            this.newSchemaMap.set(name, schema);
        }
        else {
            alert("Name or Schema is null !");
        }
    }
    /**
     * 添加注入实体
     * @param {?} name 注入实体在schema中的名称
     * @param {?} schemaName 注入实体所在的schema名
     * @param {?=} injectedType 注入类型，默认为EntityType
     * @return {?}
     */
    addInjectedEntityOfNewSchema(name, schemaName, injectedType = FilterInjectedType.EntityType) {
        this.injectedEntity = new FilterInjectedEntity();
        this.injectedEntity.name = name;
        this.injectedEntity.schemaName = schemaName;
        this.injectedEntity.injectedType = injectedType;
        /** @type {?} */
        let propertyAdapter = new PropertyAdapter();
        this.propertyList = propertyAdapter.adapterOfNewSchema(this.injectedEntity, this.newSchemaMap);
    }
}
FilterService.decorators = [
    { type: Injectable }
];
/** @nocollapse */
FilterService.ctorParameters = () => [
    { type: Injector },
    { type: ApplicationRef },
    { type: ComponentFactoryResolver },
    { type: HttpClient }
];
if (false) {
    /** @type {?} */
    FilterService.prototype.i;
    /** @type {?} */
    FilterService.prototype.adapter;
    /** @type {?} */
    FilterService.prototype.propertyList;
    /** @type {?} */
    FilterService.prototype.contextEntity;
    /** @type {?} */
    FilterService.prototype.expressionText;
    /** @type {?} */
    FilterService.prototype.expressionSchema;
    /** @type {?} */
    FilterService.prototype.expressionInjectedEntities;
    /** @type {?} */
    FilterService.prototype.expressionCDT;
    /** @type {?} */
    FilterService.prototype.filterExpressionString;
    /** @type {?} */
    FilterService.prototype.schemaMap;
    /** @type {?} */
    FilterService.prototype.newSchemaMap;
    /** @type {?} */
    FilterService.prototype.injectedEntity;
    /** @type {?} */
    FilterService.prototype.exprWinWidth;
    /** @type {?} */
    FilterService.prototype.localePipe;
    /** @type {?} */
    FilterService.prototype.localeId;
    /**
     * @type {?}
     * @private
     */
    FilterService.prototype.modalService;
    /** @type {?} */
    FilterService.prototype.simpleModalConfig;
    /**
     * @type {?}
     * @private
     */
    FilterService.prototype.injector;
    /**
     * @type {?}
     * @private
     */
    FilterService.prototype.applicationRef;
    /**
     * @type {?}
     * @private
     */
    FilterService.prototype.compFactRes;
    /**
     * @type {?}
     * @private
     */
    FilterService.prototype.http;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmlsdGVyLXNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZ3NwLXN2Yy9maWx0ZXJjb25kaXRpb24vIiwic291cmNlcyI6WyJsaWIvZmlsdGVyLXNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsUUFBUSxFQUFFLGNBQWMsRUFBRSx3QkFBd0IsRUFBcUIsTUFBTSxlQUFlLENBQUM7QUFDbEgsT0FBTyxFQUFFLHdCQUF3QixFQUFFLE1BQU0sK0NBQStDLENBQUM7QUFJekYsT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQzdDLE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUVyRCxPQUFPLEVBQUUsb0JBQW9CLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUU3RSxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sb0JBQW9CLENBQUM7QUFFckQsT0FBTyxFQUFFLE9BQU8sRUFBRSxNQUFNLFdBQVcsQ0FBQztBQUNwQyxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sa0JBQWtCLENBQUM7QUFJbEQsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLHNCQUFzQixDQUFDOzs7OztBQU1sRCxNQUFNLE9BQU8sYUFBYTs7Ozs7OztJQXFCdEIsWUFDWSxRQUFrQixFQUNsQixjQUE4QixFQUM5QixXQUFxQyxFQUNyQyxJQUFnQjtRQUhoQixhQUFRLEdBQVIsUUFBUSxDQUFVO1FBQ2xCLG1CQUFjLEdBQWQsY0FBYyxDQUFnQjtRQUM5QixnQkFBVyxHQUFYLFdBQVcsQ0FBMEI7UUFDckMsU0FBSSxHQUFKLElBQUksQ0FBWTtRQXhCNUIsTUFBQyxHQUFXLENBQUMsQ0FBQztRQUNkLFlBQU8sR0FBWSxJQUFJLE9BQU8sRUFBRSxDQUFDOztRQUVqQyxpQkFBWSxHQUFtRyxFQUFFLENBQUM7O1FBRWxILGtCQUFhLEdBQWdCLEVBQUUsQ0FBQztRQUNoQyxt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QWMsR0FBRyxJQUFJLG9CQUFvQixFQUFFLENBQUM7UUFDakQsSUFBSSxDQUFDLGNBQWMsQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDO1FBQ2hDLElBQUksQ0FBQyxjQUFjLENBQUMsVUFBVSxHQUFHLFVBQVUsQ0FBQztRQUM1QyxJQUFJLENBQUMsY0FBYyxDQUFDLFlBQVksR0FBRyxZQUFZLENBQUM7O1lBQzVDLGVBQWUsR0FBRyxJQUFJLGVBQWUsRUFBRTtRQUMzQyxJQUFJLENBQUMsWUFBWSxHQUFHLGVBQWUsQ0FBQyxrQkFBa0IsQ0FBQyxJQUFJLENBQUMsY0FBYyxFQUFFLElBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQztJQUNuRyxDQUFDOzs7WUExTkosVUFBVTs7OztZQXRCVSxRQUFRO1lBQUUsY0FBYztZQUFFLHdCQUF3QjtZQWlCOUQsVUFBVTs7OztJQU9mLDBCQUFjOztJQUNkLGdDQUFpQzs7SUFFakMscUNBQWtIOztJQUVsSCxzQ0FBZ0M7O0lBQ2hDLHVDQUE4Qjs7SUFDOUIseUNBQTZEOztJQUM3RCxtREFBa0Q7O0lBQ2xELHNDQUF3Qzs7SUFFeEMsK0NBQXNDOztJQUN0QyxrQ0FBa0Q7O0lBQ2xELHFDQUE0Qzs7SUFDNUMsdUNBQXFDOztJQUNyQyxxQ0FBMkI7O0lBQzNCLG1DQUFzQzs7SUFDdEMsaUNBQWlCOzs7OztJQUNqQixxQ0FBcUM7O0lBQ3JDLDBDQUFrQjs7Ozs7SUFFZCxpQ0FBMEI7Ozs7O0lBQzFCLHVDQUFzQzs7Ozs7SUFDdEMsb0NBQTZDOzs7OztJQUM3Qyw2QkFBd0IiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlLCBJbmplY3RvciwgQXBwbGljYXRpb25SZWYsIENvbXBvbmVudEZhY3RvcnlSZXNvbHZlciwgTE9DQUxFX0lELCBJbmplY3QgfSBmcm9tIFwiQGFuZ3VsYXIvY29yZVwiO1xyXG5pbXBvcnQgeyBGaWx0ZXJDb25kaXRpb25Db21wb25lbnQgfSBmcm9tIFwiLi9maWx0ZXItY29uZGl0aW9uL2ZpbHRlci1jb25kaXRpb24uY29tcG9uZW50XCI7XHJcbmltcG9ydCB7IEdzcENvbW1vbkRhdGFUeXBlIH0gZnJvbSBcIkBnc3AtYmVmL2dzcC1jbS1tZXRhZGF0YVwiO1xyXG5pbXBvcnQgeyBHU1BDb21tb25PYmplY3QgfSBmcm9tIFwiQGdzcC1iZWYvZ3NwLWNtLW1ldGFkYXRhXCI7XHJcbmltcG9ydCB7IFZhckVudGl0eSB9IGZyb20gXCJAZ3NwLXN2Yy9leHByZXNzaW9uXCI7XHJcbmltcG9ydCB7IFNjaGVtYSB9IGZyb20gXCJAZ3NwLXN2Yy9leHByZXNzaW9uXCI7XHJcbmltcG9ydCB7IEluamVjdGVkRW50aXR5IH0gZnJvbSBcIkBnc3Atc3ZjL2V4cHJlc3Npb25cIjtcclxuaW1wb3J0IHsgSW5qZWN0ZWRUeXBlIH0gZnJvbSAnQGdzcC1zdmMvZXhwcmVzc2lvbic7XHJcbmltcG9ydCB7IEZpbHRlckluamVjdGVkRW50aXR5LCBGaWx0ZXJJbmplY3RlZFR5cGUgfSBmcm9tIFwiLi9pbmplY3RlZC1lbnRpdHlcIjtcclxuaW1wb3J0IHsgRmlsdGVyRW50aXR5U2NoZW1hIH0gZnJvbSBcIi4vc2NoZW1hXCI7XHJcbmltcG9ydCB7IFByb3BlcnR5QWRhcHRlciB9IGZyb20gXCIuL3Byb3BlcnR5LWFkYXB0ZXJcIjtcclxuaW1wb3J0IHsgUHJvcGVydHlEYXRhVHlwZSB9IGZyb20gXCIuL3Byb3BlcnR5LWVudGl0eVwiO1xyXG5pbXBvcnQgeyBBZGFwdGVyIH0gZnJvbSBcIi4vYWRhcHRlclwiO1xyXG5pbXBvcnQgeyBCc01vZGFsU2VydmljZSB9IGZyb20gJ0BmYXJyaXMvdWktbW9kYWwnO1xyXG5pbXBvcnQgeyBGaWx0ZXJDb25kaXRpb25Mb2NhbGVQaXBlIH0gZnJvbSAnLi9maWx0ZXItY29uZGl0aW9uLWxvY2FsZS5waXBlJztcclxuaW1wb3J0IHsgTmV3U2NoZW1hIH0gZnJvbSBcIi4vTmV3U2NoZW1hXCI7XHJcbmltcG9ydCB7IE9ic2VydmFibGUgfSBmcm9tIFwicnhqc1wiO1xyXG5pbXBvcnQgeyBIdHRwQ2xpZW50IH0gZnJvbSBcIkBhbmd1bGFyL2NvbW1vbi9odHRwXCI7XHJcbi8qKlxyXG4gKiDov4fmu6Tooajovr7lvI/mnI3liqHnsbtcclxuICogQGF1dGhvciBsaW5jaGFuZyAyMDE4LzEyLzEwXHJcbiAqL1xyXG5ASW5qZWN0YWJsZSgpXHJcbmV4cG9ydCBjbGFzcyBGaWx0ZXJTZXJ2aWNlIHtcclxuICAgIGk6IG51bWJlciA9IDA7XHJcbiAgICBhZGFwdGVyOiBBZGFwdGVyID0gbmV3IEFkYXB0ZXIoKTtcclxuICAgIC8v5bGe5oCn5YiX6KGoXHJcbiAgICBwcm9wZXJ0eUxpc3Q6IEFycmF5PHsgdGV4dDogc3RyaW5nLCBwcm9wZXJ0eURhdGFUeXBlOiBQcm9wZXJ0eURhdGFUeXBlLCB2YWx1ZTogc3RyaW5nLCBwYXJlbnRJdGVtOiBzdHJpbmcgfT4gPSBbXTtcclxuICAgIC8v6aKE572u6K6h566X6KGo6L6+5byP5Y+Y6YePXHJcbiAgICBjb250ZXh0RW50aXR5OiBWYXJFbnRpdHlbXSA9IFtdO1xyXG4gICAgZXhwcmVzc2lvblRleHQ6IHN0cmluZyA9IG51bGw7XHJcbiAgICBleHByZXNzaW9uU2NoZW1hID0gQXJyYXk8eyBuYW1lOiBzdHJpbmcsIHNjaGVtYTogU2NoZW1hIH0+KCk7XHJcbiAgICBleHByZXNzaW9uSW5qZWN0ZWRFbnRpdGllczogSW5qZWN0ZWRFbnRpdHlbXSA9IFtdO1xyXG4gICAgZXhwcmVzc2lvbkNEVDogR3NwQ29tbW9uRGF0YVR5cGVbXSA9IFtdO1xyXG4gICAgLy/pooTnva7mnaHku7booajovr7lvI/lj5jph49cclxuICAgIGZpbHRlckV4cHJlc3Npb25TdHJpbmc6IHN0cmluZyA9IG51bGw7Ly/ov4fmu6Tooajovr7lvI/luo/liJfljJbkuLJcclxuICAgIHNjaGVtYU1hcCA9IG5ldyBNYXA8c3RyaW5nLCBGaWx0ZXJFbnRpdHlTY2hlbWE+KCk7XHJcbiAgICBuZXdTY2hlbWFNYXAgPSBuZXcgTWFwPHN0cmluZywgTmV3U2NoZW1hPigpOyAgICAgICAgICAgICAgICAgICAgICAgICAvL+i/h+a7pOihqOi+vuW8j+a3u+WKoE5ld1NjaGVtYVxyXG4gICAgaW5qZWN0ZWRFbnRpdHk6IEZpbHRlckluamVjdGVkRW50aXR5O1xyXG4gICAgZXhwcldpbldpZHRoOiBudW1iZXIgPSA4NTA7XHJcbiAgICBsb2NhbGVQaXBlOiBGaWx0ZXJDb25kaXRpb25Mb2NhbGVQaXBlO1xyXG4gICAgbG9jYWxlSWQ6IHN0cmluZztcclxuICAgIHByaXZhdGUgbW9kYWxTZXJ2aWNlOiBCc01vZGFsU2VydmljZTtcclxuICAgIHNpbXBsZU1vZGFsQ29uZmlnO1xyXG4gICAgY29uc3RydWN0b3IoXHJcbiAgICAgICAgcHJpdmF0ZSBpbmplY3RvcjogSW5qZWN0b3IsXHJcbiAgICAgICAgcHJpdmF0ZSBhcHBsaWNhdGlvblJlZjogQXBwbGljYXRpb25SZWYsXHJcbiAgICAgICAgcHJpdmF0ZSBjb21wRmFjdFJlczogQ29tcG9uZW50RmFjdG9yeVJlc29sdmVyLFxyXG4gICAgICAgIHByaXZhdGUgaHR0cDogSHR0cENsaWVudFxyXG4gICAgKSB7XHJcbiAgICAgICAgdGhpcy5tb2RhbFNlcnZpY2UgPSB0aGlzLmluamVjdG9yLmdldChCc01vZGFsU2VydmljZSk7XHJcbiAgICB9XHJcbiAgICAvLyDliJvlu7rooajovr7lvI9cclxuICAgIHB1YmxpYyBidWlsZEV4cHJlc3Npb24oKSB7XHJcbiAgICAgICAgbGV0IHRoYXQgPSB0aGlzO1xyXG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShcclxuICAgICAgICAgICAgZnVuY3Rpb24gKHJlc29sdmUpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGNvbXBGYWN0b3J5ID0gdGhhdC5jb21wRmFjdFJlcy5yZXNvbHZlQ29tcG9uZW50RmFjdG9yeShGaWx0ZXJDb25kaXRpb25Db21wb25lbnQpO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgY29tcFJlZiA9IGNvbXBGYWN0b3J5LmNyZWF0ZSh0aGF0LmluamVjdG9yKTtcclxuICAgICAgICAgICAgICAgIGNvbXBSZWYuaW5zdGFuY2UucHJvcGVydHlMaXN0ID0gdGhhdC5wcm9wZXJ0eUxpc3Q7XHJcbiAgICAgICAgICAgICAgICBjb21wUmVmLmluc3RhbmNlLmNvbnRleHRFbnRpdHkgPSB0aGF0LmNvbnRleHRFbnRpdHk7XHJcbiAgICAgICAgICAgICAgICBjb21wUmVmLmluc3RhbmNlLmV4cHJlc3Npb25DRFQgPSB0aGF0LmV4cHJlc3Npb25DRFQ7XHJcbiAgICAgICAgICAgICAgICBjb21wUmVmLmluc3RhbmNlLmV4cHJlc3Npb25TY2hlbWEgPSB0aGF0LmV4cHJlc3Npb25TY2hlbWE7XHJcbiAgICAgICAgICAgICAgICBjb21wUmVmLmluc3RhbmNlLmV4cHJlc3Npb25UZXh0ID0gdGhhdC5leHByZXNzaW9uVGV4dDtcclxuICAgICAgICAgICAgICAgIGNvbXBSZWYuaW5zdGFuY2UuZXhwcmVzc2lvbkluamVjdGVkRW50aXRpZXMgPSB0aGF0LmV4cHJlc3Npb25JbmplY3RlZEVudGl0aWVzO1xyXG4gICAgICAgICAgICAgICAgY29tcFJlZi5pbnN0YW5jZS5maWx0ZXJFeHByZXNzaW9uU3RyaW5nID0gdGhhdC5maWx0ZXJFeHByZXNzaW9uU3RyaW5nO1xyXG4gICAgICAgICAgICAgICAgY29tcFJlZi5pbnN0YW5jZS5zY2hlbWFNYXAgPSB0aGF0LnNjaGVtYU1hcDtcclxuICAgICAgICAgICAgICAgIC8vPT09PT09PT09PT09PT09PT09Pee7hOS7tuWKoOWFpW5ld1NjaGVtYU1hcD09PT09PT09PT09PT09PVxyXG4gICAgICAgICAgICAgICAgY29tcFJlZi5pbnN0YW5jZS5uZXdTY2hlbWFNYXAgPSB0aGF0Lm5ld1NjaGVtYU1hcDtcclxuICAgICAgICAgICAgICAgIC8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gICAgXHJcbiAgICAgICAgICAgICAgICBjb21wUmVmLmluc3RhbmNlLmV4cHJXaW5XaWR0aCA9IHRoYXQuZXhwcldpbldpZHRoO1xyXG4gICAgICAgICAgICAgICAgdGhhdC5sb2NhbGVQaXBlID0gY29tcFJlZi5pbnN0YW5jZS5sb2NhbGVQaXBlO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgZGlhbG9nID0gdGhhdC5tb2RhbFNlcnZpY2Uuc2hvdyhjb21wUmVmLCB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGl0bGU6IHRoYXQubG9jYWxlUGlwZS50cmFuc2Zvcm0oXCJXaW5kb3dUaXRsZVwiKSxcclxuICAgICAgICAgICAgICAgICAgICB3aWR0aDogMTAxMCxcclxuICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IDU1MCxcclxuICAgICAgICAgICAgICAgICAgICBzaG93QnV0dG9uczogZmFsc2VcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgY29tcFJlZi5pbnN0YW5jZS5jbG9zZWQuc3Vic2NyaWJlKCRldmVudCA9PiBkaWFsb2cuY2xvc2UoKSk7XHJcbiAgICAgICAgICAgICAgICBjb21wUmVmLmluc3RhbmNlLnJlc3VsdC5zdWJzY3JpYmUoKGV4cHJlc3Npb25Db250ZW50KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc29sdmUoZXhwcmVzc2lvbkNvbnRlbnQpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqICDpooTnva7lsZ7mgKfliJfooahcclxuICAgICAqIEBwYXJhbSBuYW1lIOWxnuaAp+ivreS5iVxyXG4gICAgICogQHBhcmFtIGRpc3BsYXlOYW1lIOWxleekuuWQjeensFxyXG4gICAgICogQHBhcmFtIHByb3BlcnR5RGF0YVR5cGUg5bGe5oCn5pWw5o2u57G75Z6LXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBhZGRQcm9wZXJ0eShuYW1lOiBzdHJpbmcsIGRpc3BsYXlOYW1lOiBzdHJpbmcsIHByb3BlcnR5RGF0YVR5cGU6IFByb3BlcnR5RGF0YVR5cGUpOiB2b2lkIHtcclxuICAgICAgICBsZXQgcHJvcGVydHlFbnRpdHkgPVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdGV4dDogZGlzcGxheU5hbWUsXHJcbiAgICAgICAgICAgIHByb3BlcnR5RGF0YVR5cGU6IHByb3BlcnR5RGF0YVR5cGUsXHJcbiAgICAgICAgICAgIHZhbHVlOiBuYW1lLFxyXG4gICAgICAgICAgICBwYXJlbnRJdGVtOiBudWxsXHJcbiAgICAgICAgfTtcclxuICAgICAgICB0aGlzLnByb3BlcnR5TGlzdCA9IHRoaXMucHJvcGVydHlMaXN0LmZpbHRlcihpdGVtID0+IGl0ZW0udmFsdWUgIT09IG5hbWUpO1xyXG4gICAgICAgIHRoaXMucHJvcGVydHlMaXN0LnB1c2gocHJvcGVydHlFbnRpdHkpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5re75Yqg5LiK5LiL5paH5Y+Y6YePXHJcbiAgICAgKiBAcGFyYW0gY29udGV4dEVudGl0eSDkuIrkuIvmloflj5jph49cclxuICAgICAqL1xyXG4gICAgcHVibGljIGFkZEV4cHJlc3Npb25Db250ZXh0KGNvbnRleHRFbnRpdHk6IFZhckVudGl0eSk6IHZvaWQge1xyXG4gICAgICAgIHRoaXMuY29udGV4dEVudGl0eSA9IHRoaXMuY29udGV4dEVudGl0eS5maWx0ZXIoaXRlbSA9PiBpdGVtLmtleSAhPT0gY29udGV4dEVudGl0eS5rZXkpO1xyXG4gICAgICAgIHRoaXMuY29udGV4dEVudGl0eS5wdXNoKGNvbnRleHRFbnRpdHkpO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiDpooTnva7ooajovr7lvI/pu5jorqTmmL7npLpcclxuICAgICAqIEBwYXJhbSB0ZXh0IOmihOe9ruaWh+acrFxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgYWRkRXhwcmVzc2lvblRleHQodGV4dDogc3RyaW5nKTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy5leHByZXNzaW9uVGV4dCA9IHRleHQ7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIOmihOe9rlNjaGVtYVxyXG4gICAgICogQHBhcmFtIG5hbWUgc2NoZW1h5ZCN56ewXHJcbiAgICAgKiBAcGFyYW0gc2NoZW1hIHNjaGVtYeWunuS9k1xyXG4gICAgICovXHJcbiAgICBwdWJsaWMgYWRkRXhwcmVzc2lvblNjaGVtYShuYW1lOiBzdHJpbmcsIHNjaGVtYTogU2NoZW1hKTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy5leHByZXNzaW9uU2NoZW1hID0gdGhpcy5leHByZXNzaW9uU2NoZW1hLmZpbHRlcihpdGVtID0+IGl0ZW0ubmFtZSAhPT0gbmFtZSk7XHJcbiAgICAgICAgdGhpcy5leHByZXNzaW9uU2NoZW1hLnB1c2goeyBuYW1lLCBzY2hlbWEgfSk7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIOmihOe9ruazqOWGjOWunuS9k1xyXG4gICAgICogQHBhcmFtIG5hbWUg5rOo5YaM5a6e5L2T5ZCNXHJcbiAgICAgKiBAcGFyYW0gc2NoZW1hTmFtZSDmiYDlnKhzY2hlbWHnmoTlkI1cclxuICAgICAqIEBwYXJhbSB0eXBlTmFtZUluU2NoZW1hIOWcqHNjaGVtYeS4reWQjeensFxyXG4gICAgICogQHBhcmFtIGluamVjdGVkVHlwZSDms6jlhoznmoTnsbvlnotcclxuICAgICAqIEBhdXRob3IgbGluY2hhbmcgMjAxOC8xMi8xMFxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgYWRkRXhwcmVzc2lvbkluamVjdGVkRW50aXR5KG5hbWU6IHN0cmluZywgc2NoZW1hTmFtZTogc3RyaW5nLCB0eXBlTmFtZUluU2NoZW1hOiBzdHJpbmcsIGluamVjdGVkVHlwZTogSW5qZWN0ZWRUeXBlKTogdm9pZCB7XHJcbiAgICAgICAgLy/mnoTpgKDms6jlhaXlrp7kvZPlr7nosaFcclxuICAgICAgICBsZXQgaW5qZWN0ZWRFbnRpdHkgPSBuZXcgSW5qZWN0ZWRFbnRpdHkoKTtcclxuICAgICAgICBpbmplY3RlZEVudGl0eS5uYW1lID0gbmFtZTtcclxuICAgICAgICBpbmplY3RlZEVudGl0eS5zY2hlbWFOYW1lID0gc2NoZW1hTmFtZTtcclxuICAgICAgICBpbmplY3RlZEVudGl0eS5pbmplY3RlZE5hbWUgPSB0eXBlTmFtZUluU2NoZW1hO1xyXG4gICAgICAgIGluamVjdGVkRW50aXR5LmluamVjdGVkVHlwZSA9IGluamVjdGVkVHlwZTtcclxuICAgICAgICB0aGlzLmV4cHJlc3Npb25JbmplY3RlZEVudGl0aWVzLnB1c2goaW5qZWN0ZWRFbnRpdHkpO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiDpooTnva5DRFRcclxuICAgICAqIEBwYXJhbSBnc3BDRFRzIOmihOe9rueahENEVOmbhuWQiFxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgYWRkRXhwcmVzc2lvbkNEVChnc3BDRFRzOiBHc3BDb21tb25EYXRhVHlwZVtdKTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy5leHByZXNzaW9uQ0RUID0gZ3NwQ0RUcztcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICog6aKE572u6L+H5ruk5p2h5Lu26KGo6L6+5byPXHJcbiAgICAgKiBAcGFyYW0gZmlsdGVyRXhwcmVzc2lvbiDpooTnva7nmoTov4fmu6Tooajovr7lvI/kuLJcclxuICAgICAqL1xyXG4gICAgcHVibGljIGFkZEZpbHRlckNvbmRpdGlvbihmaWx0ZXJFeHByZXNzaW9uOiBzdHJpbmcpIHtcclxuICAgICAgICB0aGlzLmZpbHRlckV4cHJlc3Npb25TdHJpbmcgPSBmaWx0ZXJFeHByZXNzaW9uO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiDpooTnva5zY2hlbWFcclxuICAgICAqIEBwYXJhbSBuYW1lIHNjaGVtYeWQjSzpu5jorqTkuLpDT1xyXG4gICAgICogQHBhcmFtIGZpbHRlclNjaGVtYSBzY2hlbWHlrp7kvZNcclxuICAgICAqL1xyXG4gICAgcHVibGljIGFkZFNjaGVtYShuYW1lOiBzdHJpbmcsIGZpbHRlclNjaGVtYTogRmlsdGVyRW50aXR5U2NoZW1hKSB7XHJcbiAgICAgICAgaWYgKGZpbHRlclNjaGVtYSA9PSBudWxsKSB7XHJcbiAgICAgICAgICAgIGFsZXJ0KFwiU2NoZW1hIENhbm5vdCBOdWxsXCIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHRoaXMuc2NoZW1hTWFwLnNldChuYW1lLCBmaWx0ZXJTY2hlbWEpO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiDmt7vliqDms6jlhaXlrp7kvZNcclxuICAgICAqIEBwYXJhbSBuYW1lIOazqOWFpeWunuS9k+WcqHNjaGVtYeS4reeahOWQjeensFxyXG4gICAgICogQHBhcmFtIHNjaGVtYU5hbWUg5rOo5YWl5a6e5L2T5omA5Zyo55qEc2NoZW1h5ZCNXHJcbiAgICAgKiBAcGFyYW0gaW5qZWN0ZWRUeXBlIOazqOWFpeexu+Wei++8jOS4jeWhq+m7mOiupOS4ukVudGl0eVR5cGVcclxuICAgICAqL1xyXG4gICAgcHVibGljIGFkZEluamVjdGVkRW50aXR5KG5hbWU6IHN0cmluZywgc2NoZW1hTmFtZTogc3RyaW5nLCBpbmplY3RlZFR5cGU6IEZpbHRlckluamVjdGVkVHlwZSA9IEZpbHRlckluamVjdGVkVHlwZS5FbnRpdHlUeXBlKSB7XHJcbiAgICAgICAgdGhpcy5pbmplY3RlZEVudGl0eSA9IG5ldyBGaWx0ZXJJbmplY3RlZEVudGl0eSgpO1xyXG4gICAgICAgIHRoaXMuaW5qZWN0ZWRFbnRpdHkubmFtZSA9IG5hbWU7XHJcbiAgICAgICAgdGhpcy5pbmplY3RlZEVudGl0eS5zY2hlbWFOYW1lID0gc2NoZW1hTmFtZTtcclxuICAgICAgICB0aGlzLmluamVjdGVkRW50aXR5LmluamVjdGVkVHlwZSA9IGluamVjdGVkVHlwZTtcclxuICAgICAgICBsZXQgcHJvcGVydHlBZGFwdGVyID0gbmV3IFByb3BlcnR5QWRhcHRlcigpO1xyXG4gICAgICAgIHRoaXMucHJvcGVydHlMaXN0ID0gcHJvcGVydHlBZGFwdGVyLmFkYXB0ZXIodGhpcy5pbmplY3RlZEVudGl0eSwgdGhpcy5zY2hlbWFNYXApO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiDmt7vliqBHU1BDb21tb25PYmplY3RcclxuICAgICAqIEBwYXJhbSBjb21tb25PYmplY3Qg5b6F6L2s5YyWQ09cclxuICAgICAqL1xyXG4gICAgcHVibGljIGFkZENvbW1vbk9iamVjdChjb21tb25PYmplY3Q6IEdTUENvbW1vbk9iamVjdCk6IHZvaWQge1xyXG4gICAgICAgIGxldCBzY2hlbWE7XHJcbiAgICAgICAgLy/oi6VzY2hlbWFNYXDkuK3lrZjlnKhDT+eahHNjaGVtYVxyXG4gICAgICAgIGlmICh0aGlzLnNjaGVtYU1hcC5nZXQoXCJDb21tb25PYmplY3RcIikpIHtcclxuICAgICAgICAgICAgc2NoZW1hID0gdGhpcy5zY2hlbWFNYXAuZ2V0KFwiQ29tbW9uT2JqZWN0XCIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHNjaGVtYSA9IG5ldyBTY2hlbWE7XHJcbiAgICAgICAgLy/lsIbmr4/kuIDkuKpDT+i9rOWMluS4unNjaGVtYeWGhemDqOe7k+aehOS4reeahGVudGl0eVR5cGVcclxuICAgICAgICBsZXQgZW50aXR5VHlwZXMgPSB0aGlzLmFkYXB0ZXIuY29udmVydENPKGNvbW1vbk9iamVjdCk7XHJcbiAgICAgICAgZW50aXR5VHlwZXMuZm9yRWFjaChlbnRpdHlUeXBlID0+IHtcclxuICAgICAgICAgICAgc2NoZW1hLmVudGl0eVR5cGVzID0gc2NoZW1hLmVudGl0eVR5cGVzLmZpbHRlcihpdGVtID0+IGl0ZW0ubmFtZSAhPT0gZW50aXR5VHlwZS5uYW1lKTtcclxuICAgICAgICAgICAgc2NoZW1hLmVudGl0eVR5cGVzLnB1c2goZW50aXR5VHlwZSk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIC8v5bCG5ZCI5bm25ZCO55qEc2NoZW1h5pS+5YWl5YaF6YOo5LiK5LiL5paH5a6e5L2T5LitXHJcbiAgICAgICAgdGhpcy5hZGRTY2hlbWEoXCJDb21tb25PYmplY3RcIiwgc2NoZW1hKTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICog6K6+572u6K6h566X6KGo6L6+5byP5by55Ye65qGG5a695bqmXHJcbiAgICAgKiBAcGFyYW0gZXhwcldpbldpZHRoIFxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgYWRkRXhwcldpbldpZHRoKGV4cHJXaW5XaWR0aDogbnVtYmVyKSB7XHJcbiAgICAgICAgdGhpcy5leHByV2luV2lkdGggPSBleHByV2luV2lkdGg7XHJcblxyXG4gICAgfVxyXG5cclxuICAgIC8vPT09PT09PT09PT09PT09PT09PT09PeWNjuS4veWIhuWJsue6v+S5i+e7n+S4gOe7k+aehFNjaGVtYT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogQGRlc2NyaXB0aW9uIOWQkW5ld1NjaGVtYU1hcOS4rea3u+WKoE5ld1NjaGVtYVxyXG4gICAgICogQHBhcmFtIG5hbWUgTWFw5Lit55qEa2V55YC8XHJcbiAgICAgKiBAcGFyYW0gc2NoZW1hIE1hcOeahHZhbHVlXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBhZGROZXdTY2hlbWEobmFtZTogc3RyaW5nLCBzY2hlbWE6IE5ld1NjaGVtYSkge1xyXG4gICAgICAgIGlmIChuYW1lICE9IG51bGwgJiYgbmFtZSAhPSBcIlwiICYmIHNjaGVtYSAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgIHRoaXMubmV3U2NoZW1hTWFwLnNldChuYW1lLCBzY2hlbWEpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGFsZXJ0KFwiTmFtZSBvciBTY2hlbWEgaXMgbnVsbCAhXCIpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOa3u+WKoOazqOWFpeWunuS9k1xyXG4gICAgICogQHBhcmFtIG5hbWUg5rOo5YWl5a6e5L2T5Zyoc2NoZW1h5Lit55qE5ZCN56ewXHJcbiAgICAgKiBAcGFyYW0gc2NoZW1hTmFtZSDms6jlhaXlrp7kvZPmiYDlnKjnmoRzY2hlbWHlkI1cclxuICAgICAqIEBwYXJhbSBpbmplY3RlZFR5cGUg5rOo5YWl57G75Z6L77yM6buY6K6k5Li6RW50aXR5VHlwZVxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgYWRkSW5qZWN0ZWRFbnRpdHlPZk5ld1NjaGVtYShuYW1lOiBzdHJpbmcsIHNjaGVtYU5hbWU6IHN0cmluZywgaW5qZWN0ZWRUeXBlOiBGaWx0ZXJJbmplY3RlZFR5cGUgPSBGaWx0ZXJJbmplY3RlZFR5cGUuRW50aXR5VHlwZSkge1xyXG4gICAgICAgIHRoaXMuaW5qZWN0ZWRFbnRpdHkgPSBuZXcgRmlsdGVySW5qZWN0ZWRFbnRpdHkoKTtcclxuICAgICAgICB0aGlzLmluamVjdGVkRW50aXR5Lm5hbWUgPSBuYW1lO1xyXG4gICAgICAgIHRoaXMuaW5qZWN0ZWRFbnRpdHkuc2NoZW1hTmFtZSA9IHNjaGVtYU5hbWU7XHJcbiAgICAgICAgdGhpcy5pbmplY3RlZEVudGl0eS5pbmplY3RlZFR5cGUgPSBpbmplY3RlZFR5cGU7XHJcbiAgICAgICAgbGV0IHByb3BlcnR5QWRhcHRlciA9IG5ldyBQcm9wZXJ0eUFkYXB0ZXIoKTtcclxuICAgICAgICB0aGlzLnByb3BlcnR5TGlzdCA9IHByb3BlcnR5QWRhcHRlci5hZGFwdGVyT2ZOZXdTY2hlbWEodGhpcy5pbmplY3RlZEVudGl0eSwgdGhpcy5uZXdTY2hlbWFNYXApO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICAvLz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XHJcbn0iXX0=
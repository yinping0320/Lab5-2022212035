/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input, ViewChild } from '@angular/core';
import { StorageType } from '../file-list-mobile/entity/storagetype';
import { FileListService } from '../service/file-list.service';
import { UnifileInfo } from './entity/unifileinfo';
import { LoadingService } from '@farris/ui-loading';
import { MessagerService } from '@farris/ui-messager';
import { GspFileViewType } from '../file-list-mobile/entity/gspfileviewtype';
import { ImageViewerComponent } from '../image-viewer/image-viewer/image-viewer.component';
import { DocViewerComponent } from '../doc-viewer/doc-viewer/doc-viewer.component';
import { OfdViewerComponent } from '../ofd-viewer/ofd-viewer/ofd-viewer.component';
import { PdfViewerComponent } from '../pdf-viewer/pdf-viewer/pdf-viewer.component';
import { PdfViewOptions } from '../pdf-viewer/entitires/pdfviewoptions';
import { UrlFileInfo } from './entity/urlfileinfo';
import { CostomFileInfo } from './entity/customfileinfo';
export class GspViewerComponent {
    /**
     * @param {?} listService
     * @param {?} msgService
     * @param {?} loadService
     */
    constructor(listService, msgService, loadService) {
        this.listService = listService;
        this.msgService = msgService;
        this.loadService = loadService;
        this.viewOptions = new PdfViewOptions;
        this.isImage = true;
        this.isOfd = true;
        this.isPdf = true;
        //srcList: string[] = [];
        this.isDocShow = false;
        this.isOfdShow = false;
        this.isPdfShow = false;
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.viewFile(this.filePath, this.metadataId, this.rootId, this.fileType, this.fileName, this.serviceUnit, this.params);
    }
    /**
     * @param {?} changes
     * @return {?}
     */
    ngOnChanges(changes) {
        this.viewFile(this.filePath, this.metadataId, this.rootId, this.fileType, this.fileName, this.serviceUnit, this.params);
    }
    /**
     * @param {?} filePath
     * @param {?} metadataId
     * @param {?} rootId
     * @param {?} fileType
     * @param {?} fileName
     * @param {?} suName
     * @param {?} params
     * @return {?}
     */
    viewFile(filePath, metadataId, rootId, fileType, fileName, suName, params) {
        if (fileType == StorageType.UniFile) {
            /** @type {?} */
            let info = new UnifileInfo;
            info.metadataId = metadataId;
            info.rootId = rootId;
            filePath = JSON.stringify(info);
        }
        if (fileType == StorageType.Url) {
            /** @type {?} */
            let info = new UrlFileInfo;
            info.fileUrl = filePath;
            info.fileName = fileName;
            filePath = JSON.stringify(info);
        }
        if (fileType == StorageType.Customer) {
            /** @type {?} */
            let info = new CostomFileInfo;
            info.suName = suName;
            info.param = params;
            filePath = JSON.stringify(info);
        }
        /** @type {?} */
        const loading = this.loadService.show({
            message: '拼命的请求中'
        });
        this.listService.getViewFile(filePath, fileType).subscribe((/**
         * @param {?} res
         * @return {?}
         */
        res => {
            loading.close();
            if (res.error != null) {
                this.msgService.warning('获取预览文件失败' + res.error.Message);
            }
            else {
                this.file = res;
                this.fileChange();
            }
        }));
    }
    /**
     * @return {?}
     */
    fileChange() {
        //this.file=src;
        this.isImage = this.file.fileType == GspFileViewType.Image || this.file.fileType == 'Image';
        this.isOfd = this.file.fileType == GspFileViewType.Ofd || this.file.fileType == 'Ofd';
        this.isPdf = this.file.fileType == GspFileViewType.Pdf || this.file.fileType == 'Pdf';
        if (this.isImage) {
            this.isDocShow = false;
            this.isOfdShow = false; //this.imageChange(this.file.fileUrl);
            return;
        }
        else if (this.isOfd) {
            //this.file.fileUrl="/platform/runtime/dfs/images/file.jpg";
            if (this.isOfdShow)
                this.ofdChange(this.file.filePath);
            else {
                this.isDocShow = false;
                this.isOfdShow = true;
                this.isPdfShow = false;
            }
        }
        else if (this.isPdf) {
            if (this.isPdfShow)
                this.pdfChange(this.file.filePath);
            else {
                this.isDocShow = false;
                this.isOfdShow = false;
                this.isPdfShow = true;
            }
        }
        else {
            if (this.isDocShow)
                this.docChange(this.file.filePath);
            else {
                this.isDocShow = true;
                this.isOfdShow = false;
                this.isPdfShow = false;
            }
        }
    }
    /**
     * @param {?} url
     * @return {?}
     */
    imageChange(url) {
        this.imageUrl = url;
        this.imageViewer.imageChange(url);
    }
    /**
     * @param {?} filePath
     * @return {?}
     */
    docChange(filePath) {
        this.docPath = filePath;
        this.docViewer.docChange(filePath);
    }
    /**
     * @param {?} filePath
     * @return {?}
     */
    pdfChange(filePath) {
        //this.docPath = filePath;
        this.pdfViewer.pdfChange(filePath);
    }
    /**
     * @param {?} filePath
     * @return {?}
     */
    ofdChange(filePath) {
        this.ofdViewer.fileChange(filePath);
    }
}
GspViewerComponent.decorators = [
    { type: Component, args: [{
                selector: 'gsp-viewer',
                template: "<div class=\"f-page\">\n    <div *ngIf='isImage&&!isOfd&&!isPdf'>\n        <app-image-viewer [imageUrl]=\"file.fileUrl\"></app-image-viewer>\n    </div>\n    <div *ngIf='!isImage&&!isOfd&&!isPdf'>\n        <app-doc-viewer [filePath]=\"file.filePath\"></app-doc-viewer>\n    </div>\n    <div *ngIf='!isImage&&isOfd&&!isPdf'>\n        <app-ofd-viewer [filePath]=\"file.filePath\"></app-ofd-viewer>\n    </div>\n    <div *ngIf='!isImage&&!isOfd&&isPdf' class=\"f-utils-fill\" style=\"height: 100%\">\n        <app-pdf-viewer [pdfUrl]=\"file.filePath\" [viewOptions]=\"viewOptions\"></app-pdf-viewer>\n    </div>\n</div>",
                styles: [""]
            }] }
];
/** @nocollapse */
GspViewerComponent.ctorParameters = () => [
    { type: FileListService },
    { type: MessagerService },
    { type: LoadingService }
];
GspViewerComponent.propDecorators = {
    filePath: [{ type: Input }],
    metadataId: [{ type: Input }],
    rootId: [{ type: Input }],
    fileName: [{ type: Input }],
    fileType: [{ type: Input }],
    viewOptions: [{ type: Input }],
    serviceUnit: [{ type: Input }],
    params: [{ type: Input }],
    imageViewer: [{ type: ViewChild, args: [ImageViewerComponent,] }],
    docViewer: [{ type: ViewChild, args: [DocViewerComponent,] }],
    ofdViewer: [{ type: ViewChild, args: [OfdViewerComponent,] }],
    pdfViewer: [{ type: ViewChild, args: [PdfViewerComponent,] }]
};
if (false) {
    /** @type {?} */
    GspViewerComponent.prototype.filePath;
    /** @type {?} */
    GspViewerComponent.prototype.metadataId;
    /** @type {?} */
    GspViewerComponent.prototype.rootId;
    /** @type {?} */
    GspViewerComponent.prototype.fileName;
    /** @type {?} */
    GspViewerComponent.prototype.fileType;
    /** @type {?} */
    GspViewerComponent.prototype.viewOptions;
    /** @type {?} */
    GspViewerComponent.prototype.serviceUnit;
    /** @type {?} */
    GspViewerComponent.prototype.params;
    /** @type {?} */
    GspViewerComponent.prototype.file;
    /** @type {?} */
    GspViewerComponent.prototype.isImage;
    /** @type {?} */
    GspViewerComponent.prototype.isOfd;
    /** @type {?} */
    GspViewerComponent.prototype.isPdf;
    /** @type {?} */
    GspViewerComponent.prototype.imageUrl;
    /** @type {?} */
    GspViewerComponent.prototype.docPath;
    /** @type {?} */
    GspViewerComponent.prototype.isDocShow;
    /** @type {?} */
    GspViewerComponent.prototype.isOfdShow;
    /** @type {?} */
    GspViewerComponent.prototype.isPdfShow;
    /** @type {?} */
    GspViewerComponent.prototype.imageViewer;
    /** @type {?} */
    GspViewerComponent.prototype.docViewer;
    /** @type {?} */
    GspViewerComponent.prototype.ofdViewer;
    /** @type {?} */
    GspViewerComponent.prototype.pdfViewer;
    /**
     * @type {?}
     * @private
     */
    GspViewerComponent.prototype.listService;
    /**
     * @type {?}
     * @private
     */
    GspViewerComponent.prototype.msgService;
    /**
     * @type {?}
     * @private
     */
    GspViewerComponent.prototype.loadService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ3NwLXZpZXdlci5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZ3NwLXN2Yy9maWxlLXZpZXdlci8iLCJzb3VyY2VzIjpbImxpYi9nc3Atdmlld2VyL2dzcC12aWV3ZXIuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFVLEtBQUssRUFBNEIsU0FBUyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzlGLE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSx3Q0FBd0MsQ0FBQztBQUNyRSxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sOEJBQThCLENBQUM7QUFDL0QsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBQ25ELE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQztBQUNwRCxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDdEQsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLDRDQUE0QyxDQUFDO0FBQzdFLE9BQU8sRUFBRSxvQkFBb0IsRUFBRSxNQUFNLHFEQUFxRCxDQUFDO0FBQzNGLE9BQU8sRUFBRSxrQkFBa0IsRUFBRSxNQUFNLCtDQUErQyxDQUFDO0FBQ25GLE9BQU8sRUFBRSxrQkFBa0IsRUFBRSxNQUFNLCtDQUErQyxDQUFDO0FBQ25GLE9BQU8sRUFBRSxrQkFBa0IsRUFBRSxNQUFNLCtDQUErQyxDQUFDO0FBQ25GLE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSx3Q0FBd0MsQ0FBQztBQUN4RSxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFDbkQsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLHlCQUF5QixDQUFDO0FBT3pELE1BQU0sT0FBTyxrQkFBa0I7Ozs7OztJQTRCN0IsWUFBb0IsV0FBNEIsRUFBVSxVQUEyQixFQUFVLFdBQTJCO1FBQXRHLGdCQUFXLEdBQVgsV0FBVyxDQUFpQjtRQUFVLGVB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Q0wsS0FBSzswQkFDTCxLQUFLO3FCQUNMLEtBQUs7MEJBY0wsU0FBUyxTQUFDLG9CQUFvQjt3QkFDOUIsU0FBUyxTQUFDLGtCQUFrQjt3QkFDNUIsU0FBUyxTQUFDLGtCQUFrQjt3QkFDNUIsU0FBUyxTQUFDLGtCQUFrQjs7OztJQXhCN0Isc0NBQTBCOztJQUMxQix3Q0FBNEI7O0lBQzVCLG9DQUF3Qjs7SUFDeEIsc0NBQTBCOztJQUMxQixzQ0FBK0I7O0lBQy9CLHlDQUEwRDs7SUFDMUQseUNBQTZCOztJQUM3QixvQ0FBd0I7O0lBRXhCLGtDQUFVOztJQUNWLHFDQUF3Qjs7SUFDeEIsbUNBQXNCOztJQUN0QixtQ0FBc0I7O0lBQ3RCLHNDQUFpQjs7SUFDakIscUNBQWdCOztJQUdoQix1Q0FBa0I7O0lBQ2xCLHVDQUFrQjs7SUFDbEIsdUNBQWtCOztJQUVsQix5Q0FBbUU7O0lBQ25FLHVDQUE2RDs7SUFDN0QsdUNBQTZEOztJQUM3RCx1Q0FBNkQ7Ozs7O0lBRWpELHlDQUFvQzs7Ozs7SUFBRSx3Q0FBbUM7Ozs7O0lBQUUseUNBQW1DIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBPbkluaXQsIElucHV0LCBPbkNoYW5nZXMsIFNpbXBsZUNoYW5nZXMsIFZpZXdDaGlsZCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgU3RvcmFnZVR5cGUgfSBmcm9tICcuLi9maWxlLWxpc3QtbW9iaWxlL2VudGl0eS9zdG9yYWdldHlwZSc7XG5pbXBvcnQgeyBGaWxlTGlzdFNlcnZpY2UgfSBmcm9tICcuLi9zZXJ2aWNlL2ZpbGUtbGlzdC5zZXJ2aWNlJztcbmltcG9ydCB7IFVuaWZpbGVJbmZvIH0gZnJvbSAnLi9lbnRpdHkvdW5pZmlsZWluZm8nO1xuaW1wb3J0IHsgTG9hZGluZ1NlcnZpY2UgfSBmcm9tICdAZmFycmlzL3VpLWxvYWRpbmcnO1xuaW1wb3J0IHsgTWVzc2FnZXJTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy91aS1tZXNzYWdlcic7XG5pbXBvcnQgeyBHc3BGaWxlVmlld1R5cGUgfSBmcm9tICcuLi9maWxlLWxpc3QtbW9iaWxlL2VudGl0eS9nc3BmaWxldmlld3R5cGUnO1xuaW1wb3J0IHsgSW1hZ2VWaWV3ZXJDb21wb25lbnQgfSBmcm9tICcuLi9pbWFnZS12aWV3ZXIvaW1hZ2Utdmlld2VyL2ltYWdlLXZpZXdlci5jb21wb25lbnQnO1xuaW1wb3J0IHsgRG9jVmlld2VyQ29tcG9uZW50IH0gZnJvbSAnLi4vZG9jLXZpZXdlci9kb2Mtdmlld2VyL2RvYy12aWV3ZXIuY29tcG9uZW50JztcbmltcG9ydCB7IE9mZFZpZXdlckNvbXBvbmVudCB9IGZyb20gJy4uL29mZC12aWV3ZXIvb2ZkLXZpZXdlci9vZmQtdmlld2VyLmNvbXBvbmVudCc7XG5pbXBvcnQgeyBQZGZWaWV3ZXJDb21wb25lbnQgfSBmcm9tICcuLi9wZGYtdmlld2VyL3BkZi12aWV3ZXIvcGRmLXZpZXdlci5jb21wb25lbnQnO1xuaW1wb3J0IHsgUGRmVmlld09wdGlvbnMgfSBmcm9tICcuLi9wZGYtdmlld2VyL2VudGl0aXJlcy9wZGZ2aWV3b3B0aW9ucyc7XG5pbXBvcnQgeyBVcmxGaWxlSW5mbyB9IGZyb20gJy4vZW50aXR5L3VybGZpbGVpbmZvJztcbmltcG9ydCB7IENvc3RvbUZpbGVJbmZvIH0gZnJvbSAnLi9lbnRpdHkvY3VzdG9tZmlsZWluZm8nO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdnc3Atdmlld2VyJyxcbiAgdGVtcGxhdGVVcmw6ICcuL2dzcC12aWV3ZXIuY29tcG9uZW50Lmh0bWwnLFxuICBzdHlsZVVybHM6IFsnLi9nc3Atdmlld2VyLmNvbXBvbmVudC5jc3MnXVxufSlcbmV4cG9ydCBjbGFzcyBHc3BWaWV3ZXJDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIE9uQ2hhbmdlcyB7XG5cbiAgQElucHV0KCkgZmlsZVBhdGg6IHN0cmluZztcbiAgQElucHV0KCkgbWV0YWRhdGFJZDogc3RyaW5nO1xuICBASW5wdXQoKSByb290SWQ6IHN0cmluZztcbiAgQElucHV0KCkgZmlsZU5hbWU6IHN0cmluZztcbiAgQElucHV0KCkgZmlsZVR5cGU6IFN0b3JhZ2VUeXBlO1xuICBASW5wdXQoKSB2aWV3T3B0aW9uczogUGRmVmlld09wdGlvbnMgPSBuZXcgUGRmVmlld09wdGlvbnM7XG4gIEBJbnB1dCgpIHNlcnZpY2VVbml0OiBzdHJpbmc7XG4gIEBJbnB1dCgpIHBhcmFtczogc3RyaW5nO1xuXG4gIGZpbGU6IGFueTtcbiAgaXNJbWFnZTogYm9vbGVhbiA9IHRydWU7XG4gIGlzT2ZkOiBib29sZWFuID0gdHJ1ZTtcbiAgaXNQZGY6IGJvb2xlYW4gPSB0cnVlO1xuICBpbWFnZVVybDogc3RyaW5nO1xuICBkb2NQYXRoOiBzdHJpbmc7XG4gIC8vc3JjTGlzdDogc3RyaW5nW10gPSBbXTtcblxuICBpc0RvY1Nob3cgPSBmYWxzZTtcbiAgaXNPZmRTaG93ID0gZmFsc2U7XG4gIGlzUGRmU2hvdyA9IGZhbHNlO1xuXG4gIEBWaWV3Q2hpbGQoSW1hZ2VWaWV3ZXJDb21wb25lbnQpIGltYWdlVmlld2VyOiBJbWFnZVZpZXdlckNvbXBvbmVudDtcbiAgQFZpZXdDaGlsZChEb2NWaWV3ZXJDb21wb25lbnQpIGRvY1ZpZXdlcjogRG9jVmlld2VyQ29tcG9uZW50O1xuICBAVmlld0NoaWxkKE9mZFZpZXdlckNvbXBvbmVudCkgb2ZkVmlld2VyOiBPZmRWaWV3ZXJDb21wb25lbnQ7XG4gIEBWaWV3Q2hpbGQoUGRmVmlld2VyQ29tcG9uZW50KSBwZGZWaWV3ZXI6IFBkZlZpZXdlckNvbXBvbmVudDtcblxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIGxpc3RTZXJ2aWNlOiBGaWxlTGlzdFNlcnZpY2UsIHByaXZhdGUgbXNnU2VydmljZTogTWVzc2FnZXJTZXJ2aWNlLCBwcml2YXRlIGxvYWRTZXJ2aWNlOiBMb2FkaW5nU2VydmljZSkgeyB9XG5cbiAgbmdPbkluaXQoKSB7XG4gICAgdGhpcy52aWV3RmlsZSh0aGlzLmZpbGVQYXRoLCB0aGlzLm1ldGFkYXRhSWQsIHRoaXMucm9vdElkLCB0aGlzLmZpbGVUeXBlLCB0aGlzLmZpbGVOYW1lLCB0aGlzLnNlcnZpY2VVbml0LCB0aGlzLnBhcmFtcyk7XG4gIH1cblxuICBuZ09uQ2hhbmdlcyhjaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKSB7XG4gICAgdGhpcy52aWV3RmlsZSh0aGlzLmZpbGVQYXRoLCB0aGlzLm1ldGFkYXRhSWQsIHRoaXMucm9vdElkLCB0aGlzLmZpbGVUeXBlLCB0aGlzLmZpbGVOYW1lLCB0aGlzLnNlcnZpY2VVbml0LCB0aGlzLnBhcmFtcyk7XG4gIH1cblxuICB2aWV3RmlsZShmaWxlUGF0aDogc3RyaW5nLCBtZXRhZGF0YUlkOiBzdHJpbmcsIHJvb3RJZDogc3RyaW5nLCBmaWxlVHlwZTogU3RvcmFnZVR5cGUsIGZpbGVOYW1lOiBzdHJpbmcsIHN1TmFtZTogc3RyaW5nLCBwYXJhbXM6IHN0cmluZykge1xuICAgIGlmIChmaWxlVHlwZSA9PSBTdG9yYWdlVHlwZS5VbmlGaWxlKSB7XG4gICAgICBsZXQgaW5mbyA9IG5ldyBVbmlmaWxlSW5mbztcbiAgICAgIGluZm8ubWV0YWRhdGFJZCA9IG1ldGFkYXRhSWQ7XG4gICAgICBpbmZvLnJvb3RJZCA9IHJvb3RJZDtcbiAgICAgIGZpbGVQYXRoID0gSlNPTi5zdHJpbmdpZnkoaW5mbyk7XG4gICAgfVxuICAgIGlmIChmaWxlVHlwZSA9PSBTdG9yYWdlVHlwZS5VcmwpIHtcbiAgICAgIGxldCBpbmZvID0gbmV3IFVybEZpbGVJbmZvO1xuICAgICAgaW5mby5maWxlVXJsID0gZmlsZVBhdGg7XG4gICAgICBpbmZvLmZpbGVOYW1lID0gZmlsZU5hbWU7XG4gICAgICBmaWxlUGF0aCA9IEpTT04uc3RyaW5naWZ5KGluZm8pO1xuICAgIH1cbiAgICBpZiAoZmlsZVR5cGUgPT0gU3RvcmFnZVR5cGUuQ3VzdG9tZXIpIHtcbiAgICAgIGxldCBpbmZvID0gbmV3IENvc3RvbUZpbGVJbmZvO1xuICAgICAgaW5mby5zdU5hbWUgPSBzdU5hbWU7XG4gICAgICBpbmZvLnBhcmFtID0gcGFyYW1zO1xuICAgICAgZmlsZVBhdGggPSBKU09OLnN0cmluZ2lmeShpbmZvKTtcbiAgICB9XG5cbiAgICBjb25zdCBsb2FkaW5nID0gdGhpcy5sb2FkU2VydmljZS5zaG93KHtcbiAgICAgIG1lc3NhZ2U6ICfmi7zlkb3nmoTor7fmsYLkuK0nXG4gICAgfSk7XG5cbiAgICB0aGlzLmxpc3RTZXJ2aWNlLmdldFZpZXdGaWxlKGZpbGVQYXRoLCBmaWxlVHlwZSkuc3Vic2NyaWJlKFxuICAgICAgcmVzID0+IHtcbiAgICAgICAgbG9hZGluZy5jbG9zZSgpO1xuICAgICAgICBpZiAocmVzLmVycm9yICE9IG51bGwpIHtcbiAgICAgICAgICB0aGlzLm1zZ1NlcnZpY2Uud2FybmluZygn6I635Y+W6aKE6KeI5paH5Lu25aSx6LSlJyArIHJlcy5lcnJvci5NZXNzYWdlKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aGlzLmZpbGUgPSByZXM7XG5cbiAgICAgICAgICB0aGlzLmZpbGVDaGFuZ2UoKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICk7XG4gIH1cblxuICBmaWxlQ2hhbmdlKCkge1xuICAgIC8vdGhpcy5maWxlPXNyYztcbiAgICB0aGlzLmlzSW1hZ2UgPSB0aGlzLmZpbGUuZmlsZVR5cGUgPT0gR3NwRmlsZVZpZXdUeXBlLkltYWdlIHx8IHRoaXMuZmlsZS5maWxlVHlwZSA9PSAnSW1hZ2UnO1xuICAgIHRoaXMuaXNPZmQgPSB0aGlzLmZpbGUuZmlsZVR5cGUgPT0gR3NwRmlsZVZpZXdUeXBlLk9mZCB8fCB0aGlzLmZpbGUuZmlsZVR5cGUgPT0gJ09mZCc7XG4gICAgdGhpcy5pc1BkZiA9IHRoaXMuZmlsZS5maWxlVHlwZSA9PSBHc3BGaWxlVmlld1R5cGUuUGRmIHx8IHRoaXMuZmlsZS5maWxlVHlwZSA9PSAnUGRmJztcbiAgICBpZiAodGhpcy5pc0ltYWdlKSB7XG4gICAgICB0aGlzLmlzRG9jU2hvdyA9IGZhbHNlO1xuICAgICAgdGhpcy5pc09mZFNob3cgPSBmYWxzZTsgIC8vdGhpcy5pbWFnZUNoYW5nZSh0aGlzLmZpbGUuZmlsZVVybCk7XG4gICAgICByZXR1cm47XG4gICAgfSBlbHNlIGlmICh0aGlzLmlzT2ZkKSB7XG4gICAgICAvL3RoaXMuZmlsZS5maWxlVXJsPVwiL3BsYXRmb3JtL3J1bnRpbWUvZGZzL2ltYWdlcy9maWxlLmpwZ1wiO1xuICAgICAgaWYgKHRoaXMuaXNPZmRTaG93KVxuICAgICAgICB0aGlzLm9mZENoYW5nZSh0aGlzLmZpbGUuZmlsZVBhdGgpO1xuICAgICAgZWxzZSB7XG4gICAgICAgIHRoaXMuaXNEb2NTaG93ID0gZmFsc2U7XG4gICAgICAgIHRoaXMuaXNPZmRTaG93ID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5pc1BkZlNob3cgPSBmYWxzZTtcbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKHRoaXMuaXNQZGYpIHtcbiAgICAgIGlmICh0aGlzLmlzUGRmU2hvdylcbiAgICAgICAgdGhpcy5wZGZDaGFuZ2UodGhpcy5maWxlLmZpbGVQYXRoKTtcbiAgICAgIGVsc2Uge1xuICAgICAgICB0aGlzLmlzRG9jU2hvdyA9IGZhbHNlO1xuICAgICAgICB0aGlzLmlzT2ZkU2hvdyA9IGZhbHNlO1xuICAgICAgICB0aGlzLmlzUGRmU2hvdyA9IHRydWU7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmICh0aGlzLmlzRG9jU2hvdylcbiAgICAgICAgdGhpcy5kb2NDaGFuZ2UodGhpcy5maWxlLmZpbGVQYXRoKTtcbiAgICAgIGVsc2Uge1xuICAgICAgICB0aGlzLmlzRG9jU2hvdyA9IHRydWU7XG4gICAgICAgIHRoaXMuaXNPZmRTaG93ID0gZmFsc2U7XG4gICAgICAgIHRoaXMuaXNQZGZTaG93ID0gZmFsc2U7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgaW1hZ2VDaGFuZ2UodXJsOiBhbnkpIHtcbiAgICB0aGlzLmltYWdlVXJsID0gdXJsO1xuICAgIHRoaXMuaW1hZ2VWaWV3ZXIuaW1hZ2VDaGFuZ2UodXJsKTtcbiAgfVxuXG4gIGRvY0NoYW5nZShmaWxlUGF0aDogc3RyaW5nKSB7XG4gICAgdGhpcy5kb2NQYXRoID0gZmlsZVBhdGg7XG4gICAgdGhpcy5kb2NWaWV3ZXIuZG9jQ2hhbmdlKGZpbGVQYXRoKTtcbiAgfVxuXG4gIHBkZkNoYW5nZShmaWxlUGF0aDogc3RyaW5nKSB7XG4gICAgLy90aGlzLmRvY1BhdGggPSBmaWxlUGF0aDtcbiAgICB0aGlzLnBkZlZpZXdlci5wZGZDaGFuZ2UoZmlsZVBhdGgpO1xuICB9XG5cbiAgb2ZkQ2hhbmdlKGZpbGVQYXRoOiBzdHJpbmcpIHtcbiAgICB0aGlzLm9mZFZpZXdlci5maWxlQ2hhbmdlKGZpbGVQYXRoKTtcbiAgfVxufVxuIl19
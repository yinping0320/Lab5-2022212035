/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Injectable, Injector, ComponentFactoryResolver } from '@angular/core';
//import { FileUploadComponent } from './upload/file-upload/file-upload.component';
import { BsModalService } from '@farris/ui-modal';
import { FileListComponent } from './file-list/file-list/file-list.component';
import { FileListService } from './service/file-list.service';
import { MessagerService } from '@farris/ui-messager';
import { CloudprintService, PrintType, FileType, OutputType } from "@gsp-svc/cloudprint";
import { PdfViewOptions } from './pdf-viewer/entitires/pdfviewoptions';
import { AppService } from '@gsp-sys/rtf-common';
import { UUID } from 'angular2-uuid';
//import { UploadLimit } from './upload/entity/uploadlimit';
export class FileViewerService {
    /**
     * @param {?} modalService
     * @param {?} componentFactoryResolver
     * @param {?} injector
     * @param {?} fileListService
     * @param {?} msgService
     * @param {?} cloudprintService
     * @param {?} appService
     */
    constructor(modalService, componentFactoryResolver, injector, fileListService, msgService, cloudprintService, appService) {
        this.modalService = modalService;
        this.componentFactoryResolver = componentFactoryResolver;
        this.injector = injector;
        this.fileListService = fileListService;
        this.msgService = msgService;
        this.cloudprintService = cloudprintService;
        this.appService = appService;
        this.windowWidth = window.innerWidth;
        this.windowHeigth = window.innerHeight;
    }
    //fileInfoList: UploadFileInfo[] = [];
    /**
     * @param {?} formId
     * @param {?} rootId
     * @param {?=} viewOptions
     * @return {?}
     */
    viewerFormFile(formId, rootId, viewOptions = new PdfViewOptions) {
        return new Promise((/**
         * @param {?} resolve
         * @return {?}
         */
        resolve => {
            /** @type {?} */
            var viewerFactory = this.componentFactoryResolver.resolveComponentFactory(FileListComponent);
            /** @type {?} */
            var viewerRef = viewerFactory.create(this.injector);
            viewerRef.instance.rootId = rootId;
            viewerRef.instance.formId = formId;
            this.dlg = this.modalService.show(viewerRef, {
                title: '',
                width: document.scrollingElement.clientWidth - 20,
                height: document.scrollingElement.clientWidth - 20,
                showButtons: false,
                showMaxButton: false,
                resizable: false
            });
            this.dlg.content.viewOptions = viewOptions;
            // this.dlg.content.formId = formId;
            // this.dlg.content.rootId = rootId;
        }));
    }
    /**
     * @param {?} metadataIdList
     * @param {?} rootId
     * @param {?=} viewOptions
     * @return {?}
     */
    viewerFileList(metadataIdList, rootId, viewOptions = new PdfViewOptions) {
        return new Promise((/**
         * @param {?} resolve
         * @return {?}
         */
        resolve => {
            /** @type {?} */
            var viewerFactory = this.componentFactoryResolver.resolveComponentFactory(FileListComponent);
            /** @type {?} */
            var viewerRef = viewerFactory.create(this.injector);
            viewerRef.instance.rootId = rootId;
            viewerRef.instance.metadataIdList = metadataIdList;
            this.dlg = this.modalService.show(viewerRef, {
                title: '',
                width: document.scrollingElement.clientWidth - 20,
                height: document.scrollingElement.clientWidth - 20,
                showButtons: false,
                showMaxButton: false,
                resizable: false,
                opened: (/**
                 * @return {?}
                 */
                () => {
                    setTimeout((/**
                     * @return {?}
                     */
                    () => {
                        this.dlg.dialog.changeDetectorRef['_appRef'].tick();
                    }), 500);
                })
            });
            this.dlg.content.viewOptions = viewOptions;
            // this.dlg.content.metadataIdList = metadataIdList;
            // this.dlg.content.rootId = rootId;
        }));
    }
    /**
     * @param {?} formId
     * @param {?} rootId
     * @param {?} metadataId
     * @param {?=} viewOptions
     * @return {?}
     */
    viewerFormFileWithIndex(formId, rootId, metadataId, viewOptions = new PdfViewOptions) {
        return new Promise((/**
         * @param {?} resolve
         * @return {?}
         */
        resolve => {
            /** @type {?} */
            var viewerFactory = this.componentFactoryResolver.resolveComponentFactory(FileListComponent);
            /** @type {?} */
            var viewerRef = viewerFactory.create(this.injector);
            viewerRef.instance.rootId = rootId;
            viewerRef.instance.formId = formId;
            viewerRef.instance.metadataId = metadataId;
            this.dlg = this.modalService.show(viewerRef, {
                title: '',
                width: document.scrollingElement.clientWidth - 20,
                height: document.scrollingElement.clientWidth - 20,
                showButtons: false,
                showMaxButton: false,
                resizable: false,
                opened: (/**
                 * @return {?}
                 */
                () => {
                    setTimeout((/**
                     * @return {?}
                     */
                    () => {
                        this.dlg.dialog.changeDetectorRef['_appRef'].tick();
                    }), 500);
                })
            });
            this.dlg.content.viewOptions = viewOptions;
            // this.dlg.content.formId = formId;
            // this.dlg.content.rootId = rootId;
        }));
    }
    /**
     * @param {?} metadataIdList
     * @param {?} rootId
     * @param {?} metadataId
     * @param {?=} viewOptions
     * @return {?}
     */
    viewerFileListWithIndex(metadataIdList, rootId, metadataId, viewOptions = new PdfViewOptions) {
        return new Promise((/**
         * @param {?} resolve
         * @return {?}
         */
        resolve => {
            /** @type {?} */
            var viewerFactory = this.componentFactoryResolver.resolveComponentFactory(FileListComponent);
            /** @type {?} */
            var viewerRef = viewerFactory.create(this.injector);
            viewerRef.instance.rootId = rootId;
            viewerRef.instance.metadataIdList = metadataIdList;
            viewerRef.instance.metadataId = metadataId;
            this.dlg = this.modalService.show(viewerRef, {
                title: '',
                width: document.scrollingElement.clientWidth - 20,
                height: document.scrollingElement.clientWidth - 20,
                showButtons: false,
                showMaxButton: false,
                resizable: false,
                opened: (/**
                 * @return {?}
                 */
                () => {
                    setTimeout((/**
                     * @return {?}
                     */
                    () => {
                        this.dlg.dialog.changeDetectorRef['_appRef'].tick();
                    }), 500);
                })
            });
            this.dlg.content.viewOptions = viewOptions;
            // this.dlg.content.metadataIdList = metadataIdList;
            // this.dlg.content.rootId = rootId;
        }));
    }
    /**
     * @param {?} metadataIdList
     * @param {?} rootId
     * @return {?}
     */
    mergeAndViewPdfFiles(metadataIdList, rootId) {
        this.fileListService.getMergedFile(metadataIdList, rootId).subscribe((/**
         * @param {?} res
         * @return {?}
         */
        res => {
            if (res.error != null) {
                this.msgService.error(res.error.Message);
            }
            else {
                /** @type {?} */
                let options = {
                    OutputType: OutputType.PRINT,
                    FileType: FileType.Pdf,
                    Path: '',
                    DeviceId: '',
                    printType: PrintType.Form
                };
                this.cloudprintService.openRendedViewer4Attachment("tab", res, options);
            }
        }));
    }
    /**
     * @param {?} formId
     * @param {?} rootId
     * @param {?=} viewOptions
     * @return {?}
     */
    viewerFormFileInpage(formId, rootId, viewOptions = new PdfViewOptions) {
        this.viewerFormFileWithIndexInPage(formId, rootId, null, viewOptions);
    }
    /**
     * @param {?} metadataIdList
     * @param {?} rootId
     * @param {?=} viewOptions
     * @return {?}
     */
    viewerFileListInPage(metadataIdList, rootId, viewOptions = new PdfViewOptions) {
        this.viewerFileListWithIndexInPage(metadataIdList, rootId, null, viewOptions);
    }
    /**
     * @param {?} formId
     * @param {?} rootId
     * @param {?} metadataId
     * @param {?=} viewOptions
     * @return {?}
     */
    viewerFormFileWithIndexInPage(formId, rootId, metadataId, viewOptions = new PdfViewOptions) {
        this.appService.openAppByOptions({
            appType: 'app',
            funcId: '',
            tabName: '文档在线预览',
            appId: '6ccb476b-f2ba-df8f-6f47-d37d100c56e2',
            appEntrance: 'docviewertab',
            tabId: UUID.UUID(),
            entityParams: {
                formId: formId,
                rootId: rootId,
                metadataId: metadataId,
                viewOptions: viewOptions
            },
        });
    }
    /**
     * @param {?} metadataIdList
     * @param {?} rootId
     * @param {?} metadataId
     * @param {?=} viewOptions
     * @return {?}
     */
    viewerFileListWithIndexInPage(metadataIdList, rootId, metadataId, viewOptions = new PdfViewOptions) {
        this.appService.openAppByOptions({
            appType: 'app',
            funcId: '',
            tabName: '文档在线预览',
            appId: '6ccb476b-f2ba-df8f-6f47-d37d100c56e2',
            appEntrance: 'docviewertab',
            tabId: UUID.UUID(),
            entityParams: {
                metadataIdList: metadataIdList,
                rootId: rootId,
                metadataId: metadataId,
                viewOptions: viewOptions
            },
        });
    }
}
FileViewerService.decorators = [
    { type: Injectable }
];
/** @nocollapse */
FileViewerService.ctorParameters = () => [
    { type: BsModalService },
    { type: ComponentFactoryResolver },
    { type: Injector },
    { type: FileListService },
    { type: MessagerService },
    { type: CloudprintService },
    { type: AppService }
];
if (false) {
    /** @type {?} */
    FileViewerService.prototype.dlg;
    /** @type {?} */
    FileViewerService.prototype.windowWidth;
    /** @type {?} */
    FileViewerService.prototype.windowHeigth;
    /**
     * @type {?}
     * @private
     */
    FileViewerService.prototype.modalService;
    /**
     * @type {?}
     * @private
     */
    FileViewerService.prototype.componentFactoryResolver;
    /**
     * @type {?}
     * @private
     */
    FileViewerService.prototype.injector;
    /**
     * @type {?}
     * @private
     */
    FileViewerService.prototype.fileListService;
    /**
     * @type {?}
     * @private
     */
    FileViewerService.prototype.msgService;
    /**
     * @type {?}
     * @private
     */
    FileViewerService.prototype.cloudprintService;
    /**
     * @type {?}
     * @private
     */
    FileViewerService.prototype.appService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmlsZXZpZXdlci5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGdzcC1zdmMvZmlsZS12aWV3ZXIvIiwic291cmNlcyI6WyJsaWIvZmlsZXZpZXdlci5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLFFBQVEsRUFBRSx3QkFBd0IsRUFBRSxNQUFNLGVBQWUsQ0FBQzs7QUFFL0UsT0FBTyxFQUFFLGNBQWMsRUFBYyxNQUFNLGtCQUFrQixDQUFDO0FBRzlELE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLDJDQUEyQyxDQUFDO0FBQzlFLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSw2QkFBNkIsQ0FBQztBQUM5RCxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDdEQsT0FBTyxFQUFFLGlCQUFpQixFQUFFLFNBQVMsRUFBRSxRQUFRLEVBQUUsVUFBVSxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDekYsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLHVDQUF1QyxDQUFDO0FBQ3ZFLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUNqRCxPQUFPLEVBQUUsSUFBSSxFQUFFLE1BQU0sZUFBZSxDQUFDOztBQU1yQyxNQUFNLE9BQU8saUJBQWlCOzs7Ozs7Ozs7O0lBQzFCLFlBQW9CLFlBQTRCLEVBQVUsd0JBQWtELEVBQVUsUUFBa0IsRUFDNUgsZUFBZ0MsRUFBVSxVQUEyQixFQUFVLGlCQUFvQyxFQUFVLFVBQXNCO1FBRDNJLGlCQUFZLEdBQVosWUFBWSxDQUFnQjtRQUFVLDZCQUF3QixHQUF4Qix3QkFBd0IsQ0FBMEI7UUFBVSxhQUFRLEdBQVIsUUFBUSxDQUFVO1FBQzVILG9CQUFlLEdBQWYsZUFBZSxDQUFpQjtRQUFVLGVBQVUsR0FBVixVQUFVLENBQWlCO1FBQVUsc0JBQWlCLEdBQWpCLGlCQUFpQixDQUFtQjtRQUFVLGVBQVUsR0FBVixVQUFV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QUUsdUNBQThCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSwgSW5qZWN0b3IsIENvbXBvbmVudEZhY3RvcnlSZXNvbHZlciB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG4vL2ltcG9ydCB7IEZpbGVVcGxvYWRDb21wb25lbnQgfSBmcm9tICcuL3VwbG9hZC9maWxlLXVwbG9hZC9maWxlLXVwbG9hZC5jb21wb25lbnQnO1xyXG5pbXBvcnQgeyBCc01vZGFsU2VydmljZSwgQnNNb2RhbFJlZiB9IGZyb20gJ0BmYXJyaXMvdWktbW9kYWwnO1xyXG4vL2ltcG9ydCB7IFVwbG9hZEZpbGVJbmZvIH0gZnJvbSAnLi91cGxvYWQvZW50aXR5L3VwbG9hZGZpbGVpbmZvJztcclxuaW1wb3J0IHsgT2JzZXJ2YWJsZSwgb2YgfSBmcm9tICdyeGpzJztcclxuaW1wb3J0IHsgRmlsZUxpc3RDb21wb25lbnQgfSBmcm9tICcuL2ZpbGUtbGlzdC9maWxlLWxpc3QvZmlsZS1saXN0LmNvbXBvbmVudCc7XHJcbmltcG9ydCB7IEZpbGVMaXN0U2VydmljZSB9IGZyb20gJy4vc2VydmljZS9maWxlLWxpc3Quc2VydmljZSc7XHJcbmltcG9ydCB7IE1lc3NhZ2VyU2VydmljZSB9IGZyb20gJ0BmYXJyaXMvdWktbWVzc2FnZXInO1xyXG5pbXBvcnQgeyBDbG91ZHByaW50U2VydmljZSwgUHJpbnRUeXBlLCBGaWxlVHlwZSwgT3V0cHV0VHlwZSB9IGZyb20gXCJAZ3NwLXN2Yy9jbG91ZHByaW50XCI7XHJcbmltcG9ydCB7IFBkZlZpZXdPcHRpb25zIH0gZnJvbSAnLi9wZGYtdmlld2VyL2VudGl0aXJlcy9wZGZ2aWV3b3B0aW9ucyc7XHJcbmltcG9ydCB7IEFwcFNlcnZpY2UgfSBmcm9tICdAZ3NwLXN5cy9ydGYtY29tbW9uJztcclxuaW1wb3J0IHsgVVVJRCB9IGZyb20gJ2FuZ3VsYXIyLXV1aWQnO1xyXG4vL2ltcG9ydCB7IFVwbG9hZExpbWl0IH0gZnJvbSAnLi91cGxvYWQvZW50aXR5L3VwbG9hZGxpbWl0JztcclxuXHJcblxyXG5cclxuQEluamVjdGFibGUoKVxyXG5leHBvcnQgY2xhc3MgRmlsZVZpZXdlclNlcnZpY2Uge1xyXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBtb2RhbFNlcnZpY2U6IEJzTW9kYWxTZXJ2aWNlLCBwcml2YXRlIGNvbXBvbmVudEZhY3RvcnlSZXNvbHZlcjogQ29tcG9uZW50RmFjdG9yeVJlc29sdmVyLCBwcml2YXRlIGluamVjdG9yOiBJbmplY3RvcixcclxuICAgICAgICBwcml2YXRlIGZpbGVMaXN0U2VydmljZTogRmlsZUxpc3RTZXJ2aWNlLCBwcml2YXRlIG1zZ1NlcnZpY2U6IE1lc3NhZ2VyU2VydmljZSwgcHJpdmF0ZSBjbG91ZHByaW50U2VydmljZTogQ2xvdWRwcmludFNlcnZpY2UsIHByaXZhdGUgYXBwU2VydmljZTogQXBwU2VydmljZSkgeyB9XHJcblxyXG4gICAgZGxnOiBCc01vZGFsUmVmO1xyXG5cclxuICAgIHdpbmRvd1dpZHRoOiBudW1iZXIgPSB3aW5kb3cuaW5uZXJXaWR0aDtcclxuICAgIHdpbmRvd0hlaWd0aDogbnVtYmVyID0gd2luZG93LmlubmVySGVpZ2h0O1xyXG5cclxuICAgIC8vZmlsZUluZm9MaXN0OiBVcGxvYWRGaWxlSW5mb1tdID0gW107XHJcblxyXG4gICAgdmlld2VyRm9ybUZpbGUoZm9ybUlkOiBzdHJpbmcsIHJvb3RJZDogc3RyaW5nLCB2aWV3T3B0aW9uczogUGRmVmlld09wdGlvbnMgPSBuZXcgUGRmVmlld09wdGlvbnMpIHtcclxuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UocmVzb2x2ZSA9PiB7XHJcblxyXG4gICAgICAgICAgICB2YXIgdmlld2VyRmFjdG9yeSA9IHRoaXMuY29tcG9uZW50RmFjdG9yeVJlc29sdmVyLnJlc29sdmVDb21wb25lbnRGYWN0b3J5KEZpbGVMaXN0Q29tcG9uZW50KTtcclxuICAgICAgICAgICAgdmFyIHZpZXdlclJlZiA9IHZpZXdlckZhY3RvcnkuY3JlYXRlKHRoaXMuaW5qZWN0b3IpO1xyXG5cclxuICAgICAgICAgICAgdmlld2VyUmVmLmluc3RhbmNlLnJvb3RJZCA9IHJvb3RJZDtcclxuICAgICAgICAgICAgdmlld2VyUmVmLmluc3RhbmNlLmZvcm1JZCA9IGZvcm1JZDtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuZGxnID0gdGhpcy5tb2RhbFNlcnZpY2Uuc2hvdyh2aWV3ZXJSZWYsIHtcclxuICAgICAgICAgICAgICAgIHRpdGxlOiAnJyxcclxuICAgICAgICAgICAgICAgIHdpZHRoOiBkb2N1bWVudC5zY3JvbGxpbmdFbGVtZW50LmNsaWVudFdpZHRoIC0gMjAsXHJcbiAgICAgICAgICAgICAgICBoZWlnaHQ6IGRvY3VtZW50LnNjcm9sbGluZ0VsZW1lbnQuY2xpZW50V2lkdGggLSAyMCxcclxuICAgICAgICAgICAgICAgIHNob3dCdXR0b25zOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgIHNob3dNYXhCdXR0b246IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgcmVzaXphYmxlOiBmYWxzZVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgdGhpcy5kbGcuY29udGVudC52aWV3T3B0aW9ucyA9IHZpZXdPcHRpb25zO1xyXG4gICAgICAgICAgICAvLyB0aGlzLmRsZy5jb250ZW50LmZvcm1JZCA9IGZvcm1JZDtcclxuICAgICAgICAgICAgLy8gdGhpcy5kbGcuY29udGVudC5yb290SWQgPSByb290SWQ7XHJcbiAgICAgICAgfSlcclxuICAgIH1cclxuXHJcbiAgICB2aWV3ZXJGaWxlTGlzdChtZXRhZGF0YUlkTGlzdDogc3RyaW5nW10sIHJvb3RJZDogc3RyaW5nLCB2aWV3T3B0aW9uczogUGRmVmlld09wdGlvbnMgPSBuZXcgUGRmVmlld09wdGlvbnMpIHtcclxuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UocmVzb2x2ZSA9PiB7XHJcbiAgICAgICAgICAgIHZhciB2aWV3ZXJGYWN0b3J5ID0gdGhpcy5jb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIucmVzb2x2ZUNvbXBvbmVudEZhY3RvcnkoRmlsZUxpc3RDb21wb25lbnQpO1xyXG4gICAgICAgICAgICB2YXIgdmlld2VyUmVmID0gdmlld2VyRmFjdG9yeS5jcmVhdGUodGhpcy5pbmplY3Rvcik7XHJcblxyXG4gICAgICAgICAgICB2aWV3ZXJSZWYuaW5zdGFuY2Uucm9vdElkID0gcm9vdElkO1xyXG4gICAgICAgICAgICB2aWV3ZXJSZWYuaW5zdGFuY2UubWV0YWRhdGFJZExpc3QgPSBtZXRhZGF0YUlkTGlzdDtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuZGxnID0gdGhpcy5tb2RhbFNlcnZpY2Uuc2hvdyh2aWV3ZXJSZWYsIHtcclxuICAgICAgICAgICAgICAgIHRpdGxlOiAnJyxcclxuICAgICAgICAgICAgICAgIHdpZHRoOiBkb2N1bWVudC5zY3JvbGxpbmdFbGVtZW50LmNsaWVudFdpZHRoIC0gMjAsXHJcbiAgICAgICAgICAgICAgICBoZWlnaHQ6IGRvY3VtZW50LnNjcm9sbGluZ0VsZW1lbnQuY2xpZW50V2lkdGggLSAyMCxcclxuXHJcbiAgICAgICAgICAgICAgICBzaG93QnV0dG9uczogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICBzaG93TWF4QnV0dG9uOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgIHJlc2l6YWJsZTogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICBvcGVuZWQ6ICgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kbGcuZGlhbG9nLmNoYW5nZURldGVjdG9yUmVmWydfYXBwUmVmJ10udGljaygpXHJcbiAgICAgICAgICAgICAgICAgICAgfSwgNTAwKVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgdGhpcy5kbGcuY29udGVudC52aWV3T3B0aW9ucyA9IHZpZXdPcHRpb25zO1xyXG4gICAgICAgICAgICAvLyB0aGlzLmRsZy5jb250ZW50Lm1ldGFkYXRhSWRMaXN0ID0gbWV0YWRhdGFJZExpc3Q7XHJcbiAgICAgICAgICAgIC8vIHRoaXMuZGxnLmNvbnRlbnQucm9vdElkID0gcm9vdElkO1xyXG4gICAgICAgIH0pXHJcbiAgICB9XHJcblxyXG5cclxuICAgIHZpZXdlckZvcm1GaWxlV2l0aEluZGV4KGZvcm1JZDogc3RyaW5nLCByb290SWQ6IHN0cmluZywgbWV0YWRhdGFJZDogc3RyaW5nLCB2aWV3T3B0aW9uczogUGRmVmlld09wdGlvbnMgPSBuZXcgUGRmVmlld09wdGlvbnMpIHtcclxuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UocmVzb2x2ZSA9PiB7XHJcblxyXG4gICAgICAgICAgICB2YXIgdmlld2VyRmFjdG9yeSA9IHRoaXMuY29tcG9uZW50RmFjdG9yeVJlc29sdmVyLnJlc29sdmVDb21wb25lbnRGYWN0b3J5KEZpbGVMaXN0Q29tcG9uZW50KTtcclxuICAgICAgICAgICAgdmFyIHZpZXdlclJlZiA9IHZpZXdlckZhY3RvcnkuY3JlYXRlKHRoaXMuaW5qZWN0b3IpO1xyXG5cclxuICAgICAgICAgICAgdmlld2VyUmVmLmluc3RhbmNlLnJvb3RJZCA9IHJvb3RJZDtcclxuICAgICAgICAgICAgdmlld2VyUmVmLmluc3RhbmNlLmZvcm1JZCA9IGZvcm1JZDtcclxuICAgICAgICAgICAgdmlld2VyUmVmLmluc3RhbmNlLm1ldGFkYXRhSWQgPSBtZXRhZGF0YUlkO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5kbGcgPSB0aGlzLm1vZGFsU2VydmljZS5zaG93KHZpZXdlclJlZiwge1xyXG4gICAgICAgICAgICAgICAgdGl0bGU6ICcnLFxyXG5cclxuICAgICAgICAgICAgICAgIHdpZHRoOiBkb2N1bWVudC5zY3JvbGxpbmdFbGVtZW50LmNsaWVudFdpZHRoIC0gMjAsXHJcbiAgICAgICAgICAgICAgICBoZWlnaHQ6IGRvY3VtZW50LnNjcm9sbGluZ0VsZW1lbnQuY2xpZW50V2lkdGggLSAyMCxcclxuICAgICAgICAgICAgICAgIHNob3dCdXR0b25zOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgIHNob3dNYXhCdXR0b246IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgcmVzaXphYmxlOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgIG9wZW5lZDogKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRsZy5kaWFsb2cuY2hhbmdlRGV0ZWN0b3JSZWZbJ19hcHBSZWYnXS50aWNrKClcclxuICAgICAgICAgICAgICAgICAgICB9LCA1MDApXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB0aGlzLmRsZy5jb250ZW50LnZpZXdPcHRpb25zID0gdmlld09wdGlvbnM7XHJcbiAgICAgICAgICAgIC8vIHRoaXMuZGxnLmNvbnRlbnQuZm9ybUlkID0gZm9ybUlkO1xyXG4gICAgICAgICAgICAvLyB0aGlzLmRsZy5jb250ZW50LnJvb3RJZCA9IHJvb3RJZDtcclxuICAgICAgICB9KVxyXG4gICAgfVxyXG5cclxuICAgIHZpZXdlckZpbGVMaXN0V2l0aEluZGV4KG1ldGFkYXRhSWRMaXN0OiBzdHJpbmdbXSwgcm9vdElkOiBzdHJpbmcsIG1ldGFkYXRhSWQ6IHN0cmluZywgdmlld09wdGlvbnM6IFBkZlZpZXdPcHRpb25zID0gbmV3IFBkZlZpZXdPcHRpb25zKSB7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKHJlc29sdmUgPT4ge1xyXG4gICAgICAgICAgICB2YXIgdmlld2VyRmFjdG9yeSA9IHRoaXMuY29tcG9uZW50RmFjdG9yeVJlc29sdmVyLnJlc29sdmVDb21wb25lbnRGYWN0b3J5KEZpbGVMaXN0Q29tcG9uZW50KTtcclxuICAgICAgICAgICAgdmFyIHZpZXdlclJlZiA9IHZpZXdlckZhY3RvcnkuY3JlYXRlKHRoaXMuaW5qZWN0b3IpO1xyXG5cclxuICAgICAgICAgICAgdmlld2VyUmVmLmluc3RhbmNlLnJvb3RJZCA9IHJvb3RJZDtcclxuICAgICAgICAgICAgdmlld2VyUmVmLmluc3RhbmNlLm1ldGFkYXRhSWRMaXN0ID0gbWV0YWRhdGFJZExpc3Q7XHJcbiAgICAgICAgICAgIHZpZXdlclJlZi5pbnN0YW5jZS5tZXRhZGF0YUlkID0gbWV0YWRhdGFJZDtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuZGxnID0gdGhpcy5tb2RhbFNlcnZpY2Uuc2hvdyh2aWV3ZXJSZWYsIHtcclxuICAgICAgICAgICAgICAgIHRpdGxlOiAnJyxcclxuICAgICAgICAgICAgICAgIHdpZHRoOiBkb2N1bWVudC5zY3JvbGxpbmdFbGVtZW50LmNsaWVudFdpZHRoIC0gMjAsXHJcbiAgICAgICAgICAgICAgICBoZWlnaHQ6IGRvY3VtZW50LnNjcm9sbGluZ0VsZW1lbnQuY2xpZW50V2lkdGggLSAyMCxcclxuXHJcbiAgICAgICAgICAgICAgICBzaG93QnV0dG9uczogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICBzaG93TWF4QnV0dG9uOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgIHJlc2l6YWJsZTogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICBvcGVuZWQ6ICgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kbGcuZGlhbG9nLmNoYW5nZURldGVjdG9yUmVmWydfYXBwUmVmJ10udGljaygpXHJcbiAgICAgICAgICAgICAgICAgICAgfSwgNTAwKVxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIHRoaXMuZGxnLmNvbnRlbnQudmlld09wdGlvbnMgPSB2aWV3T3B0aW9ucztcclxuICAgICAgICAgICAgLy8gdGhpcy5kbGcuY29udGVudC5tZXRhZGF0YUlkTGlzdCA9IG1ldGFkYXRhSWRMaXN0O1xyXG4gICAgICAgICAgICAvLyB0aGlzLmRsZy5jb250ZW50LnJvb3RJZCA9IHJvb3RJZDtcclxuICAgICAgICB9KVxyXG4gICAgfVxyXG5cclxuXHJcbiAgICBtZXJnZUFuZFZpZXdQZGZGaWxlcyhtZXRhZGF0YUlkTGlzdDogc3RyaW5nW10sIHJvb3RJZDogc3RyaW5nKSB7XHJcbiAgICAgICAgdGhpcy5maWxlTGlzdFNlcnZpY2UuZ2V0TWVyZ2VkRmlsZShtZXRhZGF0YUlkTGlzdCwgcm9vdElkKS5zdWJzY3JpYmUocmVzID0+IHtcclxuICAgICAgICAgICAgaWYgKHJlcy5lcnJvciAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLm1zZ1NlcnZpY2UuZXJyb3IocmVzLmVycm9yLk1lc3NhZ2UpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgbGV0IG9wdGlvbnMgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgT3V0cHV0VHlwZTogT3V0cHV0VHlwZS5QUklOVCxcclxuICAgICAgICAgICAgICAgICAgICBGaWxlVHlwZTogRmlsZVR5cGUuUGRmLFxyXG4gICAgICAgICAgICAgICAgICAgIFBhdGg6ICcnLFxyXG4gICAgICAgICAgICAgICAgICAgIERldmljZUlkOiAnJyxcclxuICAgICAgICAgICAgICAgICAgICBwcmludFR5cGU6IFByaW50VHlwZS5Gb3JtXHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jbG91ZHByaW50U2VydmljZS5vcGVuUmVuZGVkVmlld2VyNEF0dGFjaG1lbnQoXCJ0YWJcIiwgcmVzLCBvcHRpb25zKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pXHJcbiAgICB9XHJcblxyXG5cclxuICAgIHZpZXdlckZvcm1GaWxlSW5wYWdlKGZvcm1JZDogc3RyaW5nLCByb290SWQ6IHN0cmluZywgdmlld09wdGlvbnM6IFBkZlZpZXdPcHRpb25zID0gbmV3IFBkZlZpZXdPcHRpb25zKSB7XHJcbiAgICAgICAgdGhpcy52aWV3ZXJGb3JtRmlsZVdpdGhJbmRleEluUGFnZShmb3JtSWQsIHJvb3RJZCwgbnVsbCwgdmlld09wdGlvbnMpO1xyXG4gICAgfVxyXG5cclxuICAgIHZpZXdlckZpbGVMaXN0SW5QYWdlKG1ldGFkYXRhSWRMaXN0OiBzdHJpbmdbXSwgcm9vdElkOiBzdHJpbmcsIHZpZXdPcHRpb25zOiBQZGZWaWV3T3B0aW9ucyA9IG5ldyBQZGZWaWV3T3B0aW9ucykge1xyXG4gICAgICAgIHRoaXMudmlld2VyRmlsZUxpc3RXaXRoSW5kZXhJblBhZ2UobWV0YWRhdGFJZExpc3QsIHJvb3RJZCwgbnVsbCwgdmlld09wdGlvbnMpO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICB2aWV3ZXJGb3JtRmlsZVdpdGhJbmRleEluUGFnZShmb3JtSWQ6IHN0cmluZywgcm9vdElkOiBzdHJpbmcsIG1ldGFkYXRhSWQ6IHN0cmluZywgdmlld09wdGlvbnM6IFBkZlZpZXdPcHRpb25zID0gbmV3IFBkZlZpZXdPcHRpb25zKSB7XHJcbiAgICAgICAgdGhpcy5hcHBTZXJ2aWNlLm9wZW5BcHBCeU9wdGlvbnMoe1xyXG4gICAgICAgICAgICBhcHBUeXBlOiAnYXBwJyxcclxuICAgICAgICAgICAgZnVuY0lkOiAnJyxcclxuICAgICAgICAgICAgdGFiTmFtZTogJ+aWh+aho+WcqOe6v+mihOiniCcsXHJcbiAgICAgICAgICAgIGFwcElkOiAnNmNjYjQ3NmItZjJiYS1kZjhmLTZmNDctZDM3ZDEwMGM1NmUyJyxcclxuICAgICAgICAgICAgYXBwRW50cmFuY2U6ICdkb2N2aWV3ZXJ0YWInLFxyXG4gICAgICAgICAgICB0YWJJZDogVVVJRC5VVUlEKCksXHJcbiAgICAgICAgICAgIGVudGl0eVBhcmFtczoge1xyXG4gICAgICAgICAgICAgICAgZm9ybUlkOiBmb3JtSWQsXHJcbiAgICAgICAgICAgICAgICByb290SWQ6IHJvb3RJZCxcclxuICAgICAgICAgICAgICAgIG1ldGFkYXRhSWQ6IG1ldGFkYXRhSWQsXHJcbiAgICAgICAgICAgICAgICB2aWV3T3B0aW9uczogdmlld09wdGlvbnNcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICB2aWV3ZXJGaWxlTGlzdFdpdGhJbmRleEluUGFnZShtZXRhZGF0YUlkTGlzdDogc3RyaW5nW10sIHJvb3RJZDogc3RyaW5nLCBtZXRhZGF0YUlkOiBzdHJpbmcsIHZpZXdPcHRpb25zOiBQZGZWaWV3T3B0aW9ucyA9IG5ldyBQZGZWaWV3T3B0aW9ucykge1xyXG4gICAgICAgIHRoaXMuYXBwU2VydmljZS5vcGVuQXBwQnlPcHRpb25zKHtcclxuICAgICAgICAgICAgYXBwVHlwZTogJ2FwcCcsXHJcbiAgICAgICAgICAgIGZ1bmNJZDogJycsXHJcbiAgICAgICAgICAgIHRhYk5hbWU6ICfmlofmoaPlnKjnur/pooTop4gnLFxyXG4gICAgICAgICAgICBhcHBJZDogJzZjY2I0NzZiLWYyYmEtZGY4Zi02ZjQ3LWQzN2QxMDBjNTZlMicsXHJcbiAgICAgICAgICAgIGFwcEVudHJhbmNlOiAnZG9jdmlld2VydGFiJyxcclxuICAgICAgICAgICAgdGFiSWQ6IFVVSUQuVVVJRCgpLFxyXG4gICAgICAgICAgICBlbnRpdHlQYXJhbXM6IHtcclxuICAgICAgICAgICAgICAgIG1ldGFkYXRhSWRMaXN0OiBtZXRhZGF0YUlkTGlzdCxcclxuICAgICAgICAgICAgICAgIHJvb3RJZDogcm9vdElkLFxyXG4gICAgICAgICAgICAgICAgbWV0YWRhdGFJZDogbWV0YWRhdGFJZCxcclxuICAgICAgICAgICAgICAgIHZpZXdPcHRpb25zOiB2aWV3T3B0aW9uc1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxufSJdfQ==
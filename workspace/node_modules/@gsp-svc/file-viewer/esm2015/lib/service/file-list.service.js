/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Injectable } from '@angular/core';
import { HttpService } from '@ecp-caf/caf-common';
import { catchError, tap } from 'rxjs/operators';
import { HttpClient } from '@angular/common/http';
import { of } from 'rxjs';
import { StorageType } from '../file-list-mobile/entity/storagetype';
import { ViewFileRequest } from '../file-list-mobile/entity/viewfilerequest';
import { UnifileListInfo } from '../file-list-mobile/entity/unifilelistinfo';
import { MergePdfRequest } from '../pdf-viewer/entitires/mergepdfrequest';
import * as i0 from "@angular/core";
import * as i1 from "@ecp-caf/caf-common";
import * as i2 from "@angular/common/http";
export class FileListService {
    /**
     * @param {?} http
     * @param {?} httpClient
     */
    constructor(http, httpClient) {
        this.http = http;
        this.httpClient = httpClient;
    }
    /**
     * @param {?} filePath
     * @param {?} storageType
     * @return {?}
     */
    getViewFile(filePath, storageType) {
        /** @type {?} */
        let url = "/api/runtime/dfs/v1.0/fileviewer/file";
        /** @type {?} */
        let viewRequest = new ViewFileRequest;
        viewRequest.storageType = storageType;
        viewRequest.filePath = filePath;
        /** @type {?} */
        let body = viewRequest;
        return this.http.request('Post', url, this.setHeader({ body })).pipe(tap((/**
         * @param {?} res
         * @return {?}
         */
        res => { })), catchError((/**
         * @param {?} error
         * @return {?}
         */
        (error) => {
            return of(error);
        })));
    }
    /**
     * @param {?} formId
     * @param {?} rootId
     * @return {?}
     */
    getFormFileList(formId, rootId) {
        /** @type {?} */
        let url = "/api/runtime/dfs/v1.0/fileviewer/filelist";
        /** @type {?} */
        let unifileInfo = new UnifileListInfo;
        unifileInfo.formId = formId;
        unifileInfo.rootId = rootId;
        /** @type {?} */
        let viewRequest = new ViewFileRequest;
        viewRequest.storageType = StorageType.UniFile;
        viewRequest.filePath = JSON.stringify(unifileInfo);
        /** @type {?} */
        let body = viewRequest;
        return this.http.request('Post', url, this.setHeader({ body })).pipe(tap((/**
         * @param {?} res
         * @return {?}
         */
        res => { })), catchError((/**
         * @param {?} error
         * @return {?}
         */
        (error) => {
            return of(error);
        })));
    }
    /**
     * @param {?} options
     * @return {?}
     */
    setHeader(options) {
        options.headers = {
            'Content-Type': 'application/json'
        };
        return options;
    }
    /**
     * @param {?} idList
     * @param {?=} rootId
     * @return {?}
     */
    getFileList(idList, rootId = "") {
        /** @type {?} */
        let url = "/api/runtime/dfs/v1.0/fileviewer/filelist";
        /** @type {?} */
        let unifileInfo = new UnifileListInfo;
        unifileInfo.metadataIdList = idList;
        unifileInfo.rootId = rootId;
        /** @type {?} */
        let viewRequest = new ViewFileRequest;
        viewRequest.storageType = StorageType.UniFile;
        viewRequest.filePath = JSON.stringify(unifileInfo);
        /** @type {?} */
        let body = viewRequest;
        return this.http.request('Post', url, this.setHeader({ body })).pipe(tap((/**
         * @param {?} res
         * @return {?}
         */
        res => { })), catchError((/**
         * @param {?} error
         * @return {?}
         */
        (error) => {
            return of(error);
        })));
    }
    /**
     * @param {?} idList
     * @param {?} rootId
     * @return {?}
     */
    getMergedFile(idList, rootId) {
        /** @type {?} */
        let url = "/api/runtime/dfs/v1.0/doc/mergepdf";
        /** @type {?} */
        let httpOptions = {};
        httpOptions['responseType'] = "blob";
        /** @type {?} */
        let body = new MergePdfRequest;
        body.metadataIdList = idList;
        body.rootId = rootId;
        body.token = this.getToken(this.mergeString(idList[0], rootId));
        return this.httpClient.post(url, body, httpOptions).pipe(tap((/**
         * @param {?} res
         * @return {?}
         */
        res => { })), catchError((/**
         * @param {?} error
         * @return {?}
         */
        (error) => {
            return of(error);
        })));
    }
    /**
     * @private
     * @param {?} str
     * @param {?} str1
     * @return {?}
     */
    mergeString(str, str1) {
        /** @type {?} */
        let min = str.length < str1.length ? str.length : str1.length;
        /** @type {?} */
        let res = "";
        /** @type {?} */
        let i = 0;
        for (i = 0; i < min; i++) {
            res += str.substring(i, i + 1);
            res += str1.substring(i, i + 1);
        }
        res += str.length < str1.length ? str1.substring(i) : str.substring(i);
        return res;
    }
    /**
     * @private
     * @param {?} str
     * @return {?}
     */
    getToken(str) {
        /** @type {?} */
        let array = [1, 2, 3];
        if (str.length > 24)
            str = str.substring(0, 24);
        /** @type {?} */
        let length = Math.floor(str.length / 3);
        /** @type {?} */
        let str1 = str.substring(0, length);
        /** @type {?} */
        let str2 = str.substring(length, 2 * length);
        /** @type {?} */
        let str3 = str.substring(2 * length, 3 * length);
        /** @type {?} */
        let randomArray = [];
        /** @type {?} */
        var random = Math.ceil(Math.random() * 3);
        randomArray.push(array[random - 1]);
        array.splice(random - 1, 1);
        random = Math.ceil(Math.random() * 2);
        randomArray.push(array[random - 1]);
        array.splice(random - 1, 1);
        randomArray.push(array[0]);
        /** @type {?} */
        let timeStamp = Math.round(new Date().getTime() / 1000) + "";
        return timeStamp.substring(0, 5) + "times" + randomArray[0] + "" + randomArray[1] + "" + randomArray[2] + this.switchStr(str1, str2, str3, randomArray[0]) + this.switchStr(str1, str2, str3, randomArray[1]) + this.switchStr(str1, str2, str3, randomArray[2]) + "times" + timeStamp.substring(5);
    }
    /**
     * @private
     * @param {?} str1
     * @param {?} str2
     * @param {?} str3
     * @param {?} i
     * @return {?}
     */
    switchStr(str1, str2, str3, i) {
        switch (i) {
            case 1: return str1;
            case 2: return str2;
            case 3: return str3;
        }
    }
}
FileListService.decorators = [
    { type: Injectable, args: [{
                providedIn: 'root'
            },] }
];
/** @nocollapse */
FileListService.ctorParameters = () => [
    { type: HttpService },
    { type: HttpClient }
];
/** @nocollapse */ FileListService.ngInjectableDef = i0.defineInjectable({ factory: function FileListService_Factory() { return new FileListService(i0.inject(i1.HttpService), i0.inject(i2.HttpClient)); }, token: FileListService, providedIn: "root" });
if (false) {
    /**
     * @type {?}
     * @private
     */
    FileListService.prototype.http;
    /**
     * @type {?}
     * @private
     */
    FileListService.prototype.httpClient;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmlsZS1saXN0LnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZ3NwLXN2Yy9maWxlLXZpZXdlci8iLCJzb3VyY2VzIjpbImxpYi9zZXJ2aWNlL2ZpbGUtbGlzdC5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzNDLE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUNsRCxPQUFPLEVBQUUsVUFBVSxFQUFFLEdBQUcsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ2pELE9BQU8sRUFBcUIsVUFBVSxFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFDckUsT0FBTyxFQUFFLEVBQUUsRUFBYyxNQUFNLE1BQU0sQ0FBQztBQUN0QyxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sd0NBQXdDLENBQUM7QUFDckUsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLDRDQUE0QyxDQUFDO0FBQzdFLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSw0Q0FBNEMsQ0FBQztBQUM3RSxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0seUNBQXlDLENBQUM7Ozs7QUFNMUUsTUFBTSxPQUFPLGVBQWU7Ozs7O0lBRTFCLFlBQW9CLElBQWlCLEVBQVUsVUFBc0I7UUFBakQsU0FBSSxHQUFKLElBQUksQ0FBYTtRQUFVLGVBQVUsR0FBVixVQUFVLENBQVk7SUFBSSxDQUFDOzs7Ozs7SUFFMUUsV0FBVyxDQUFDLFFBQWdCLEVBQUUsV0FBd0I7O1lBQ2hELEdBQUcsR0FBRyx1Q0FBdUM7O1lBRTdDLFdBQVcsR0FBRyxJQUFJLGVBQWU7UUFDckMsV0FBVyxDQUFDLFdBQVcsR0FBRyxXQUFXLENBQUM7UUFDdEMsV0FBVyxDQUFDLFFBQVEsR0FBRyxRQUFRLENBQUM7O1lBRTVCLElBQUksR0FBRyxXQUFXO1FBRXRCLE9BQU8sSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsTUFBTSxF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bXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBIdHRwU2VydmljZSB9IGZyb20gJ0BlY3AtY2FmL2NhZi1jb21tb24nO1xuaW1wb3J0IHsgY2F0Y2hFcnJvciwgdGFwIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuaW1wb3J0IHsgSHR0cEVycm9yUmVzcG9uc2UsIEh0dHBDbGllbnQgfSBmcm9tICdAYW5ndWxhci9jb21tb24vaHR0cCc7XG5pbXBvcnQgeyBvZiwgT2JzZXJ2YWJsZSB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgU3RvcmFnZVR5cGUgfSBmcm9tICcuLi9maWxlLWxpc3QtbW9iaWxlL2VudGl0eS9zdG9yYWdldHlwZSc7XG5pbXBvcnQgeyBWaWV3RmlsZVJlcXVlc3QgfSBmcm9tICcuLi9maWxlLWxpc3QtbW9iaWxlL2VudGl0eS92aWV3ZmlsZXJlcXVlc3QnO1xuaW1wb3J0IHsgVW5pZmlsZUxpc3RJbmZvIH0gZnJvbSAnLi4vZmlsZS1saXN0LW1vYmlsZS9lbnRpdHkvdW5pZmlsZWxpc3RpbmZvJztcbmltcG9ydCB7IE1lcmdlUGRmUmVxdWVzdCB9IGZyb20gJy4uL3BkZi12aWV3ZXIvZW50aXRpcmVzL21lcmdlcGRmcmVxdWVzdCc7XG5cblxuQEluamVjdGFibGUoe1xuICBwcm92aWRlZEluOiAncm9vdCdcbn0pXG5leHBvcnQgY2xhc3MgRmlsZUxpc3RTZXJ2aWNlIHtcblxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIGh0dHA6IEh0dHBTZXJ2aWNlLCBwcml2YXRlIGh0dHBDbGllbnQ6IEh0dHBDbGllbnQpIHsgfVxuXG4gIGdldFZpZXdGaWxlKGZpbGVQYXRoOiBzdHJpbmcsIHN0b3JhZ2VUeXBlOiBTdG9yYWdlVHlwZSk6IE9ic2VydmFibGU8YW55PiB7XG4gICAgbGV0IHVybCA9IFwiL2FwaS9ydW50aW1lL2Rmcy92MS4wL2ZpbGV2aWV3ZXIvZmlsZVwiO1xuXG4gICAgbGV0IHZpZXdSZXF1ZXN0ID0gbmV3IFZpZXdGaWxlUmVxdWVzdDtcbiAgICB2aWV3UmVxdWVzdC5zdG9yYWdlVHlwZSA9IHN0b3JhZ2VUeXBlO1xuICAgIHZpZXdSZXF1ZXN0LmZpbGVQYXRoID0gZmlsZVBhdGg7XG5cbiAgICBsZXQgYm9keSA9IHZpZXdSZXF1ZXN0O1xuXG4gICAgcmV0dXJuIHRoaXMuaHR0cC5yZXF1ZXN0KCdQb3N0JywgdXJsLCB0aGlzLnNldEhlYWRlcih7IGJvZHkgfSkpLnBpcGUoXG4gICAgICB0YXAocmVzID0+IHsgfSksXG4gICAgICBjYXRjaEVycm9yKChlcnJvcjogSHR0cEVycm9yUmVzcG9uc2UpID0+IHtcbiAgICAgICAgcmV0dXJuIG9mKGVycm9yKTtcbiAgICAgIH0pKTtcbiAgfVxuXG4gIGdldEZvcm1GaWxlTGlzdChmb3JtSWQ6IHN0cmluZywgcm9vdElkOiBzdHJpbmcpOiBPYnNlcnZhYmxlPGFueT4ge1xuICAgIGxldCB1cmwgPSBcIi9hcGkvcnVudGltZS9kZnMvdjEuMC9maWxldmlld2VyL2ZpbGVsaXN0XCI7XG5cbiAgICBsZXQgdW5pZmlsZUluZm8gPSBuZXcgVW5pZmlsZUxpc3RJbmZvO1xuICAgIHVuaWZpbGVJbmZvLmZvcm1JZCA9IGZvcm1JZDtcbiAgICB1bmlmaWxlSW5mby5yb290SWQgPSByb290SWQ7XG5cbiAgICBsZXQgdmlld1JlcXVlc3QgPSBuZXcgVmlld0ZpbGVSZXF1ZXN0O1xuICAgIHZpZXdSZXF1ZXN0LnN0b3JhZ2VUeXBlID0gU3RvcmFnZVR5cGUuVW5pRmlsZTtcbiAgICB2aWV3UmVxdWVzdC5maWxlUGF0aCA9IEpTT04uc3RyaW5naWZ5KHVuaWZpbGVJbmZvKTtcbiAgICBsZXQgYm9keSA9IHZpZXdSZXF1ZXN0O1xuXG4gICAgcmV0dXJuIHRoaXMuaHR0cC5yZXF1ZXN0KCdQb3N0JywgdXJsLCB0aGlzLnNldEhlYWRlcih7IGJvZHkgfSkpLnBpcGUoXG4gICAgICB0YXAocmVzID0+IHsgfSksXG4gICAgICBjYXRjaEVycm9yKChlcnJvcjogSHR0cEVycm9yUmVzcG9uc2UpID0+IHtcbiAgICAgICAgcmV0dXJuIG9mKGVycm9yKTtcbiAgICAgIH0pKTtcblxuICB9XG5cbiAgc2V0SGVhZGVyKG9wdGlvbnM6IGFueSkge1xuXG4gICAgb3B0aW9ucy5oZWFkZXJzID0ge1xuICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJ1xuICAgIH07XG4gICAgcmV0dXJuIG9wdGlvbnM7XG4gIH1cblxuICBnZXRGaWxlTGlzdChpZExpc3Q6IHN0cmluZ1tdLCByb290SWQ6IHN0cmluZyA9IFwiXCIpOiBPYnNlcnZhYmxlPGFueT4ge1xuICAgIGxldCB1cmwgPSBcIi9hcGkvcnVudGltZS9kZnMvdjEuMC9maWxldmlld2VyL2ZpbGVsaXN0XCI7XG5cbiAgICBsZXQgdW5pZmlsZUluZm8gPSBuZXcgVW5pZmlsZUxpc3RJbmZvO1xuICAgIHVuaWZpbGVJbmZvLm1ldGFkYXRhSWRMaXN0ID0gaWRMaXN0O1xuICAgIHVuaWZpbGVJbmZvLnJvb3RJZCA9IHJvb3RJZDtcblxuICAgIGxldCB2aWV3UmVxdWVzdCA9IG5ldyBWaWV3RmlsZVJlcXVlc3Q7XG4gICAgdmlld1JlcXVlc3Quc3RvcmFnZVR5cGUgPSBTdG9yYWdlVHlwZS5VbmlGaWxlO1xuICAgIHZpZXdSZXF1ZXN0LmZpbGVQYXRoID0gSlNPTi5zdHJpbmdpZnkodW5pZmlsZUluZm8pO1xuICAgIGxldCBib2R5ID0gdmlld1JlcXVlc3Q7XG5cbiAgICByZXR1cm4gdGhpcy5odHRwLnJlcXVlc3QoJ1Bvc3QnLCB1cmwsIHRoaXMuc2V0SGVhZGVyKHsgYm9keSB9KSkucGlwZShcbiAgICAgIHRhcChyZXMgPT4geyB9KSxcbiAgICAgIGNhdGNoRXJyb3IoKGVycm9yOiBIdHRwRXJyb3JSZXNwb25zZSkgPT4ge1xuICAgICAgICByZXR1cm4gb2YoZXJyb3IpO1xuICAgICAgfSkpO1xuICB9XG5cbiAgZ2V0TWVyZ2VkRmlsZShpZExpc3Q6IHN0cmluZ1tdLCByb290SWQ6IHN0cmluZyk6IE9ic2VydmFibGU8YW55PiB7XG4gICAgbGV0IHVybCA9IFwiL2FwaS9ydW50aW1lL2Rmcy92MS4wL2RvYy9tZXJnZXBkZlwiO1xuXG4gICAgbGV0IGh0dHBPcHRpb25zID0ge307XG4gICAgaHR0cE9wdGlvbnNbJ3Jlc3BvbnNlVHlwZSddID0gXCJibG9iXCI7XG5cbiAgICBsZXQgYm9keTogTWVyZ2VQZGZSZXF1ZXN0ID0gbmV3IE1lcmdlUGRmUmVxdWVzdDtcblxuICAgIGJvZHkubWV0YWRhdGFJZExpc3QgPSBpZExpc3Q7XG4gICAgYm9keS5yb290SWQgPSByb290SWQ7XG4gICAgYm9keS50b2tlbiA9IHRoaXMuZ2V0VG9rZW4odGhpcy5tZXJnZVN0cmluZyhpZExpc3RbMF0sIHJvb3RJZCkpO1xuXG4gICAgcmV0dXJuIHRoaXMuaHR0cENsaWVudC5wb3N0KHVybCwgYm9keSwgaHR0cE9wdGlvbnMpLnBpcGUoXG4gICAgICB0YXAocmVzID0+IHsgfSksXG4gICAgICBjYXRjaEVycm9yKChlcnJvcjogSHR0cEVycm9yUmVzcG9uc2UpID0+IHtcbiAgICAgICAgcmV0dXJuIG9mKGVycm9yKTtcbiAgICAgIH0pKTtcbiAgfVxuXG5cblxuICBwcml2YXRlIG1lcmdlU3RyaW5nKHN0cjogc3RyaW5nLCBzdHIxOiBzdHJpbmcpOiBzdHJpbmcge1xuICAgIGxldCBtaW4gPSBzdHIubGVuZ3RoIDwgc3RyMS5sZW5ndGggPyBzdHIubGVuZ3RoIDogc3RyMS5sZW5ndGg7XG4gICAgbGV0IHJlczogc3RyaW5nID0gXCJcIjtcbiAgICBsZXQgaSA9IDA7XG4gICAgZm9yIChpID0gMDsgaSA8IG1pbjsgaSsrKSB7XG4gICAgICByZXMgKz0gc3RyLnN1YnN0cmluZyhpLCBpICsgMSk7XG4gICAgICByZXMgKz0gc3RyMS5zdWJzdHJpbmcoaSwgaSArIDEpO1xuICAgIH1cbiAgICByZXMgKz0gc3RyLmxlbmd0aCA8IHN0cjEubGVuZ3RoID8gc3RyMS5zdWJzdHJpbmcoaSkgOiBzdHIuc3Vic3RyaW5nKGkpO1xuICAgIHJldHVybiByZXM7XG4gIH1cblxuICBwcml2YXRlIGdldFRva2VuKHN0cjogc3RyaW5nKTogc3RyaW5nIHtcbiAgICBsZXQgYXJyYXkgPSBbMSwgMiwgM107XG4gICAgaWYgKHN0ci5sZW5ndGggPiAyNClcbiAgICAgIHN0ciA9IHN0ci5zdWJzdHJpbmcoMCwgMjQpO1xuICAgIGxldCBsZW5ndGggPSBNYXRoLmZsb29yKHN0ci5sZW5ndGggLyAzKTtcbiAgICBsZXQgc3RyMSA9IHN0ci5zdWJzdHJpbmcoMCwgbGVuZ3RoKTtcbiAgICBsZXQgc3RyMiA9IHN0ci5zdWJzdHJpbmcobGVuZ3RoLCAyICogbGVuZ3RoKTtcbiAgICBsZXQgc3RyMyA9IHN0ci5zdWJzdHJpbmcoMiAqIGxlbmd0aCwgMyAqIGxlbmd0aCk7XG4gICAgbGV0IHJhbmRvbUFycmF5ID0gW107XG4gICAgdmFyIHJhbmRvbSA9IE1hdGguY2VpbChNYXRoLnJhbmRvbSgpICogMyk7XG4gICAgcmFuZG9tQXJyYXkucHVzaChhcnJheVtyYW5kb20gLSAxXSk7XG4gICAgYXJyYXkuc3BsaWNlKHJhbmRvbSAtIDEsIDEpO1xuICAgIHJhbmRvbSA9IE1hdGguY2VpbChNYXRoLnJhbmRvbSgpICogMik7XG4gICAgcmFuZG9tQXJyYXkucHVzaChhcnJheVtyYW5kb20gLSAxXSk7XG4gICAgYXJyYXkuc3BsaWNlKHJhbmRvbSAtIDEsIDEpO1xuICAgIHJhbmRvbUFycmF5LnB1c2goYXJyYXlbMF0pO1xuICAgIGxldCB0aW1lU3RhbXA6IHN0cmluZyA9IE1hdGgucm91bmQobmV3IERhdGUoKS5nZXRUaW1lKCkgLyAxMDAwKSArIFwiXCI7XG5cbiAgICByZXR1cm4gdGltZVN0YW1wLnN1YnN0cmluZygwLCA1KSArIFwidGltZXNcIiArIHJhbmRvbUFycmF5WzBdICsgXCJcIiArIHJhbmRvbUFycmF5WzFdICsgXCJcIiArIHJhbmRvbUFycmF5WzJdICsgdGhpcy5zd2l0Y2hTdHIoc3RyMSwgc3RyMiwgc3RyMywgcmFuZG9tQXJyYXlbMF0pICsgdGhpcy5zd2l0Y2hTdHIoc3RyMSwgc3RyMiwgc3RyMywgcmFuZG9tQXJyYXlbMV0pICsgdGhpcy5zd2l0Y2hTdHIoc3RyMSwgc3RyMiwgc3RyMywgcmFuZG9tQXJyYXlbMl0pICsgXCJ0aW1lc1wiICsgdGltZVN0YW1wLnN1YnN0cmluZyg1KTtcbiAgfVxuXG4gIHByaXZhdGUgc3dpdGNoU3RyKHN0cjE6IHN0cmluZywgc3RyMjogc3RyaW5nLCBzdHIzOiBzdHJpbmcsIGk6IG51bWJlcik6IHN0cmluZyB7XG4gICAgc3dpdGNoIChpKSB7XG4gICAgICBjYXNlIDE6IHJldHVybiBzdHIxO1xuICAgICAgY2FzZSAyOiByZXR1cm4gc3RyMjtcbiAgICAgIGNhc2UgMzogcmV0dXJuIHN0cjM7XG4gICAgfVxuICB9XG5cblxuXG59XG4iXX0=
/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Injectable } from '@angular/core';
import { HttpService } from '@ecp-caf/caf-common';
import { catchError, tap } from 'rxjs/operators';
import { HttpClient } from '@angular/common/http';
import { of } from 'rxjs';
import { StorageType } from '../file-list-mobile/entity/storagetype';
import { ViewFileRequest } from '../file-list-mobile/entity/viewfilerequest';
import { UnifileListInfo } from '../file-list-mobile/entity/unifilelistinfo';
import { MergePdfRequest } from '../pdf-viewer/entitires/mergepdfrequest';
import * as i0 from "@angular/core";
import * as i1 from "@ecp-caf/caf-common";
import * as i2 from "@angular/common/http";
var FileListService = /** @class */ (function () {
    function FileListService(http, httpClient) {
        this.http = http;
        this.httpClient = httpClient;
    }
    /**
     * @param {?} filePath
     * @param {?} storageType
     * @return {?}
     */
    FileListService.prototype.getViewFile = /**
     * @param {?} filePath
     * @param {?} storageType
     * @return {?}
     */
    function (filePath, storageType) {
        /** @type {?} */
        var url = "/api/runtime/dfs/v1.0/fileviewer/file";
        /** @type {?} */
        var viewRequest = new ViewFileRequest;
        viewRequest.storageType = storageType;
        viewRequest.filePath = filePath;
        /** @type {?} */
        var body = viewRequest;
        return this.http.request('Post', url, this.setHeader({ body: body })).pipe(tap((/**
         * @param {?} res
         * @return {?}
         */
        function (res) { })), catchError((/**
         * @param {?} error
         * @return {?}
         */
        function (error) {
            return of(error);
        })));
    };
    /**
     * @param {?} formId
     * @param {?} rootId
     * @return {?}
     */
    FileListService.prototype.getFormFileList = /**
     * @param {?} formId
     * @param {?} rootId
     * @return {?}
     */
    function (formId, rootId) {
        /** @type {?} */
        var url = "/api/runtime/dfs/v1.0/fileviewer/filelist";
        /** @type {?} */
        var unifileInfo = new UnifileListInfo;
        unifileInfo.formId = formId;
        unifileInfo.rootId = rootId;
        /** @type {?} */
        var viewRequest = new ViewFileRequest;
        viewRequest.storageType = StorageType.UniFile;
        viewRequest.filePath = JSON.stringify(unifileInfo);
        /** @type {?} */
        var body = viewRequest;
        return this.http.request('Post', url, this.setHeader({ body: body })).pipe(tap((/**
         * @param {?} res
         * @return {?}
         */
        function (res) { })), catchError((/**
         * @param {?} error
         * @return {?}
         */
        function (error) {
            return of(error);
        })));
    };
    /**
     * @param {?} options
     * @return {?}
     */
    FileListService.prototype.setHeader = /**
     * @param {?} options
     * @return {?}
     */
    function (options) {
        options.headers = {
            'Content-Type': 'application/json'
        };
        return options;
    };
    /**
     * @param {?} idList
     * @param {?=} rootId
     * @return {?}
     */
    FileListService.prototype.getFileList = /**
     * @param {?} idList
     * @param {?=} rootId
     * @return {?}
     */
    function (idList, rootId) {
        if (rootId === void 0) { rootId = ""; }
        /** @type {?} */
        var url = "/api/runtime/dfs/v1.0/fileviewer/filelist";
        /** @type {?} */
        var unifileInfo = new UnifileListInfo;
        unifileInfo.metadataIdList = idList;
        unifileInfo.rootId = rootId;
        /** @type {?} */
        var viewRequest = new ViewFileRequest;
        viewRequest.storageType = StorageType.UniFile;
        viewRequest.filePath = JSON.stringify(unifileInfo);
        /** @type {?} */
        var body = viewRequest;
        return this.http.request('Post', url, this.setHeader({ body: body })).pipe(tap((/**
         * @param {?} res
         * @return {?}
         */
        function (res) { })), catchError((/**
         * @param {?} error
         * @return {?}
         */
        function (error) {
            return of(error);
        })));
    };
    /**
     * @param {?} idList
     * @param {?} rootId
     * @return {?}
     */
    FileListService.prototype.getMergedFile = /**
     * @param {?} idList
     * @param {?} rootId
     * @return {?}
     */
    function (idList, rootId) {
        /** @type {?} */
        var url = "/api/runtime/dfs/v1.0/doc/mergepdf";
        /** @type {?} */
        var httpOptions = {};
        httpOptions['responseType'] = "blob";
        /** @type {?} */
        var body = new MergePdfRequest;
        body.metadataIdList = idList;
        body.rootId = rootId;
        body.token = this.getToken(this.mergeString(idList[0], rootId));
        return this.httpClient.post(url, body, httpOptions).pipe(tap((/**
         * @param {?} res
         * @return {?}
         */
        function (res) { })), catchError((/**
         * @param {?} error
         * @return {?}
         */
        function (error) {
            return of(error);
        })));
    };
    /**
     * @private
     * @param {?} str
     * @param {?} str1
     * @return {?}
     */
    FileListService.prototype.mergeString = /**
     * @private
     * @param {?} str
     * @param {?} str1
     * @return {?}
     */
    function (str, str1) {
        /** @type {?} */
        var min = str.length < str1.length ? str.length : str1.length;
        /** @type {?} */
        var res = "";
        /** @type {?} */
        var i = 0;
        for (i = 0; i < min; i++) {
            res += str.substring(i, i + 1);
            res += str1.substring(i, i + 1);
        }
        res += str.length < str1.length ? str1.substring(i) : str.substring(i);
        return res;
    };
    /**
     * @private
     * @param {?} str
     * @return {?}
     */
    FileListService.prototype.getToken = /**
     * @private
     * @param {?} str
     * @return {?}
     */
    function (str) {
        /** @type {?} */
        var array = [1, 2, 3];
        if (str.length > 24)
            str = str.substring(0, 24);
        /** @type {?} */
        var length = Math.floor(str.length / 3);
        /** @type {?} */
        var str1 = str.substring(0, length);
        /** @type {?} */
        var str2 = str.substring(length, 2 * length);
        /** @type {?} */
        var str3 = str.substring(2 * length, 3 * length);
        /** @type {?} */
        var randomArray = [];
        /** @type {?} */
        var random = Math.ceil(Math.random() * 3);
        randomArray.push(array[random - 1]);
        array.splice(random - 1, 1);
        random = Math.ceil(Math.random() * 2);
        randomArray.push(array[random - 1]);
        array.splice(random - 1, 1);
        randomArray.push(array[0]);
        /** @type {?} */
        var timeStamp = Math.round(new Date().getTime() / 1000) + "";
        return timeStamp.substring(0, 5) + "times" + randomArray[0] + "" + randomArray[1] + "" + randomArray[2] + this.switchStr(str1, str2, str3, randomArray[0]) + this.switchStr(str1, str2, str3, randomArray[1]) + this.switchStr(str1, str2, str3, randomArray[2]) + "times" + timeStamp.substring(5);
    };
    /**
     * @private
     * @param {?} str1
     * @param {?} str2
     * @param {?} str3
     * @param {?} i
     * @return {?}
     */
    FileListService.prototype.switchStr = /**
     * @private
     * @param {?} str1
     * @param {?} str2
     * @param {?} str3
     * @param {?} i
     * @return {?}
     */
    function (str1, str2, str3, i) {
        switch (i) {
            case 1: return str1;
            case 2: return str2;
            case 3: return str3;
        }
    };
    FileListService.decorators = [
        { type: Injectable, args: [{
                    providedIn: 'root'
                },] }
    ];
    /** @nocollapse */
    FileListService.ctorParameters = function () { return [
        { type: HttpService },
        { type: HttpClient }
    ]; };
    /** @nocollapse */ FileListService.ngInjectableDef = i0.defineInjectable({ factory: function FileListService_Factory() { return new FileListService(i0.inject(i1.HttpService), i0.inject(i2.HttpClient)); }, token: FileListService, providedIn: "root" });
    return FileListService;
}());
export { FileListService };
if (false) {
    /**
     * @type {?}
     * @private
     */
    FileListService.prototype.http;
    /**
     * @type {?}
     * @private
     */
    FileListService.prototype.httpClient;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmlsZS1saXN0LnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZ3NwLXN2Yy9maWxlLXZpZXdlci8iLCJzb3VyY2VzIjpbImxpYi9zZXJ2aWNlL2ZpbGUtbGlzdC5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzNDLE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUNsRCxPQUFPLEVBQUUsVUFBVSxFQUFFLEdBQUcsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ2pELE9BQU8sRUFBcUIsVUFBVSxFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFDckUsT0FBTyxFQUFFLEVBQUUsRUFBYyxNQUFNLE1BQU0sQ0FBQztBQUN0QyxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sd0NBQXdDLENBQUM7QUFDckUsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLDRDQUE0QyxDQUFDO0FBQzdFLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSw0Q0FBNEMsQ0FBQztBQUM3RSxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0seUNBQXlDLENBQUM7Ozs7QUFHMUU7SUFLRSx5QkFBb0IsSUFBaUIsRUFBVSxVQUFzQjtRQUFqRCxTQUFJLEdBQUosSUFBSSxDQUFhO1FBQVUsZUFBVSxHQUFWLFVBQVUsQ0FBWTtJQUFJLENBQUM7Ozs7OztJQUUxRSxxQ0FBVzs7Ozs7SUFBWCxVQUFZLFFBQWdCLEVBQUUsV0FBd0I7O1lBQ2hELEdBQUcsR0FBRyx1Q0FBdUM7O1lBRTdDLFdBQVcsR0FBRyxJQUFJLGVBQWU7UUFDckMsV0FBVyxDQUFDLFdBQVcsR0FBRyxXQUFXLENBQUM7UUFDdEMsV0FBVyxDQUFDLFFBQVEsR0FBRyxRQUFRLENBQUM7O1lBRTVCLElBQUksR0FBRyxXQUFXO1FBRXRCLE9BQU8sSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsTUFBTSxFQUFFLEdBQUcs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QWlKQyxBQXRJRCxJQXNJQztTQW5JWSxlQUFlOzs7Ozs7SUFFZCwrQkFBeUI7Ozs7O0lBQUUscUNBQThCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgSHR0cFNlcnZpY2UgfSBmcm9tICdAZWNwLWNhZi9jYWYtY29tbW9uJztcbmltcG9ydCB7IGNhdGNoRXJyb3IsIHRhcCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7IEh0dHBFcnJvclJlc3BvbnNlLCBIdHRwQ2xpZW50IH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uL2h0dHAnO1xuaW1wb3J0IHsgb2YsIE9ic2VydmFibGUgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IFN0b3JhZ2VUeXBlIH0gZnJvbSAnLi4vZmlsZS1saXN0LW1vYmlsZS9lbnRpdHkvc3RvcmFnZXR5cGUnO1xuaW1wb3J0IHsgVmlld0ZpbGVSZXF1ZXN0IH0gZnJvbSAnLi4vZmlsZS1saXN0LW1vYmlsZS9lbnRpdHkvdmlld2ZpbGVyZXF1ZXN0JztcbmltcG9ydCB7IFVuaWZpbGVMaXN0SW5mbyB9IGZyb20gJy4uL2ZpbGUtbGlzdC1tb2JpbGUvZW50aXR5L3VuaWZpbGVsaXN0aW5mbyc7XG5pbXBvcnQgeyBNZXJnZVBkZlJlcXVlc3QgfSBmcm9tICcuLi9wZGYtdmlld2VyL2VudGl0aXJlcy9tZXJnZXBkZnJlcXVlc3QnO1xuXG5cbkBJbmplY3RhYmxlKHtcbiAgcHJvdmlkZWRJbjogJ3Jvb3QnXG59KVxuZXhwb3J0IGNsYXNzIEZpbGVMaXN0U2VydmljZSB7XG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSBodHRwOiBIdHRwU2VydmljZSwgcHJpdmF0ZSBodHRwQ2xpZW50OiBIdHRwQ2xpZW50KSB7IH1cblxuICBnZXRWaWV3RmlsZShmaWxlUGF0aDogc3RyaW5nLCBzdG9yYWdlVHlwZTogU3RvcmFnZVR5cGUpOiBPYnNlcnZhYmxlPGFueT4ge1xuICAgIGxldCB1cmwgPSBcIi9hcGkvcnVudGltZS9kZnMvdjEuMC9maWxldmlld2VyL2ZpbGVcIjtcblxuICAgIGxldCB2aWV3UmVxdWVzdCA9IG5ldyBWaWV3RmlsZVJlcXVlc3Q7XG4gICAgdmlld1JlcXVlc3Quc3RvcmFnZVR5cGUgPSBzdG9yYWdlVHlwZTtcbiAgICB2aWV3UmVxdWVzdC5maWxlUGF0aCA9IGZpbGVQYXRoO1xuXG4gICAgbGV0IGJvZHkgPSB2aWV3UmVxdWVzdDtcblxuICAgIHJldHVybiB0aGlzLmh0dHAucmVxdWVzdCgnUG9zdCcsIHVybCwgdGhpcy5zZXRIZWFkZXIoeyBib2R5IH0pKS5waXBlKFxuICAgICAgdGFwKHJlcyA9PiB7IH0pLFxuICAgICAgY2F0Y2hFcnJvcigoZXJyb3I6IEh0dHBFcnJvclJlc3BvbnNlKSA9PiB7XG4gICAgICAgIHJldHVybiBvZihlcnJvcik7XG4gICAgICB9KSk7XG4gIH1cblxuICBnZXRGb3JtRmlsZUxpc3QoZm9ybUlkOiBzdHJpbmcsIHJvb3RJZDogc3RyaW5nKTogT2JzZXJ2YWJsZTxhbnk+IHtcbiAgICBsZXQgdXJsID0gXCIvYXBpL3J1bnRpbWUvZGZzL3YxLjAvZmlsZXZpZXdlci9maWxlbGlzdFwiO1xuXG4gICAgbGV0IHVuaWZpbGVJbmZvID0gbmV3IFVuaWZpbGVMaXN0SW5mbztcbiAgICB1bmlmaWxlSW5mby5mb3JtSWQgPSBmb3JtSWQ7XG4gICAgdW5pZmlsZUluZm8ucm9vdElkID0gcm9vdElkO1xuXG4gICAgbGV0IHZpZXdSZXF1ZXN0ID0gbmV3IFZpZXdGaWxlUmVxdWVzdDtcbiAgICB2aWV3UmVxdWVzdC5zdG9yYWdlVHlwZSA9IFN0b3JhZ2VUeXBlLlVuaUZpbGU7XG4gICAgdmlld1JlcXVlc3QuZmlsZVBhdGggPSBKU09OLnN0cmluZ2lmeSh1bmlmaWxlSW5mbyk7XG4gICAgbGV0IGJvZHkgPSB2aWV3UmVxdWVzdDtcblxuICAgIHJldHVybiB0aGlzLmh0dHAucmVxdWVzdCgnUG9zdCcsIHVybCwgdGhpcy5zZXRIZWFkZXIoeyBib2R5IH0pKS5waXBlKFxuICAgICAgdGFwKHJlcyA9PiB7IH0pLFxuICAgICAgY2F0Y2hFcnJvcigoZXJyb3I6IEh0dHBFcnJvclJlc3BvbnNlKSA9PiB7XG4gICAgICAgIHJldHVybiBvZihlcnJvcik7XG4gICAgICB9KSk7XG5cbiAgfVxuXG4gIHNldEhlYWRlcihvcHRpb25zOiBhbnkpIHtcblxuICAgIG9wdGlvbnMuaGVhZGVycyA9IHtcbiAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbidcbiAgICB9O1xuICAgIHJldHVybiBvcHRpb25zO1xuICB9XG5cbiAgZ2V0RmlsZUxpc3QoaWRMaXN0OiBzdHJpbmdbXSwgcm9vdElkOiBzdHJpbmcgPSBcIlwiKTogT2JzZXJ2YWJsZTxhbnk+IHtcbiAgICBsZXQgdXJsID0gXCIvYXBpL3J1bnRpbWUvZGZzL3YxLjAvZmlsZXZpZXdlci9maWxlbGlzdFwiO1xuXG4gICAgbGV0IHVuaWZpbGVJbmZvID0gbmV3IFVuaWZpbGVMaXN0SW5mbztcbiAgICB1bmlmaWxlSW5mby5tZXRhZGF0YUlkTGlzdCA9IGlkTGlzdDtcbiAgICB1bmlmaWxlSW5mby5yb290SWQgPSByb290SWQ7XG5cbiAgICBsZXQgdmlld1JlcXVlc3QgPSBuZXcgVmlld0ZpbGVSZXF1ZXN0O1xuICAgIHZpZXdSZXF1ZXN0LnN0b3JhZ2VUeXBlID0gU3RvcmFnZVR5cGUuVW5pRmlsZTtcbiAgICB2aWV3UmVxdWVzdC5maWxlUGF0aCA9IEpTT04uc3RyaW5naWZ5KHVuaWZpbGVJbmZvKTtcbiAgICBsZXQgYm9keSA9IHZpZXdSZXF1ZXN0O1xuXG4gICAgcmV0dXJuIHRoaXMuaHR0cC5yZXF1ZXN0KCdQb3N0JywgdXJsLCB0aGlzLnNldEhlYWRlcih7IGJvZHkgfSkpLnBpcGUoXG4gICAgICB0YXAocmVzID0+IHsgfSksXG4gICAgICBjYXRjaEVycm9yKChlcnJvcjogSHR0cEVycm9yUmVzcG9uc2UpID0+IHtcbiAgICAgICAgcmV0dXJuIG9mKGVycm9yKTtcbiAgICAgIH0pKTtcbiAgfVxuXG4gIGdldE1lcmdlZEZpbGUoaWRMaXN0OiBzdHJpbmdbXSwgcm9vdElkOiBzdHJpbmcpOiBPYnNlcnZhYmxlPGFueT4ge1xuICAgIGxldCB1cmwgPSBcIi9hcGkvcnVudGltZS9kZnMvdjEuMC9kb2MvbWVyZ2VwZGZcIjtcblxuICAgIGxldCBodHRwT3B0aW9ucyA9IHt9O1xuICAgIGh0dHBPcHRpb25zWydyZXNwb25zZVR5cGUnXSA9IFwiYmxvYlwiO1xuXG4gICAgbGV0IGJvZHk6IE1lcmdlUGRmUmVxdWVzdCA9IG5ldyBNZXJnZVBkZlJlcXVlc3Q7XG5cbiAgICBib2R5Lm1ldGFkYXRhSWRMaXN0ID0gaWRMaXN0O1xuICAgIGJvZHkucm9vdElkID0gcm9vdElkO1xuICAgIGJvZHkudG9rZW4gPSB0aGlzLmdldFRva2VuKHRoaXMubWVyZ2VTdHJpbmcoaWRMaXN0WzBdLCByb290SWQpKTtcblxuICAgIHJldHVybiB0aGlzLmh0dHBDbGllbnQucG9zdCh1cmwsIGJvZHksIGh0dHBPcHRpb25zKS5waXBlKFxuICAgICAgdGFwKHJlcyA9PiB7IH0pLFxuICAgICAgY2F0Y2hFcnJvcigoZXJyb3I6IEh0dHBFcnJvclJlc3BvbnNlKSA9PiB7XG4gICAgICAgIHJldHVybiBvZihlcnJvcik7XG4gICAgICB9KSk7XG4gIH1cblxuXG5cbiAgcHJpdmF0ZSBtZXJnZVN0cmluZyhzdHI6IHN0cmluZywgc3RyMTogc3RyaW5nKTogc3RyaW5nIHtcbiAgICBsZXQgbWluID0gc3RyLmxlbmd0aCA8IHN0cjEubGVuZ3RoID8gc3RyLmxlbmd0aCA6IHN0cjEubGVuZ3RoO1xuICAgIGxldCByZXM6IHN0cmluZyA9IFwiXCI7XG4gICAgbGV0IGkgPSAwO1xuICAgIGZvciAoaSA9IDA7IGkgPCBtaW47IGkrKykge1xuICAgICAgcmVzICs9IHN0ci5zdWJzdHJpbmcoaSwgaSArIDEpO1xuICAgICAgcmVzICs9IHN0cjEuc3Vic3RyaW5nKGksIGkgKyAxKTtcbiAgICB9XG4gICAgcmVzICs9IHN0ci5sZW5ndGggPCBzdHIxLmxlbmd0aCA/IHN0cjEuc3Vic3RyaW5nKGkpIDogc3RyLnN1YnN0cmluZyhpKTtcbiAgICByZXR1cm4gcmVzO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRUb2tlbihzdHI6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgbGV0IGFycmF5ID0gWzEsIDIsIDNdO1xuICAgIGlmIChzdHIubGVuZ3RoID4gMjQpXG4gICAgICBzdHIgPSBzdHIuc3Vic3RyaW5nKDAsIDI0KTtcbiAgICBsZXQgbGVuZ3RoID0gTWF0aC5mbG9vcihzdHIubGVuZ3RoIC8gMyk7XG4gICAgbGV0IHN0cjEgPSBzdHIuc3Vic3RyaW5nKDAsIGxlbmd0aCk7XG4gICAgbGV0IHN0cjIgPSBzdHIuc3Vic3RyaW5nKGxlbmd0aCwgMiAqIGxlbmd0aCk7XG4gICAgbGV0IHN0cjMgPSBzdHIuc3Vic3RyaW5nKDIgKiBsZW5ndGgsIDMgKiBsZW5ndGgpO1xuICAgIGxldCByYW5kb21BcnJheSA9IFtdO1xuICAgIHZhciByYW5kb20gPSBNYXRoLmNlaWwoTWF0aC5yYW5kb20oKSAqIDMpO1xuICAgIHJhbmRvbUFycmF5LnB1c2goYXJyYXlbcmFuZG9tIC0gMV0pO1xuICAgIGFycmF5LnNwbGljZShyYW5kb20gLSAxLCAxKTtcbiAgICByYW5kb20gPSBNYXRoLmNlaWwoTWF0aC5yYW5kb20oKSAqIDIpO1xuICAgIHJhbmRvbUFycmF5LnB1c2goYXJyYXlbcmFuZG9tIC0gMV0pO1xuICAgIGFycmF5LnNwbGljZShyYW5kb20gLSAxLCAxKTtcbiAgICByYW5kb21BcnJheS5wdXNoKGFycmF5WzBdKTtcbiAgICBsZXQgdGltZVN0YW1wOiBzdHJpbmcgPSBNYXRoLnJvdW5kKG5ldyBEYXRlKCkuZ2V0VGltZSgpIC8gMTAwMCkgKyBcIlwiO1xuXG4gICAgcmV0dXJuIHRpbWVTdGFtcC5zdWJzdHJpbmcoMCwgNSkgKyBcInRpbWVzXCIgKyByYW5kb21BcnJheVswXSArIFwiXCIgKyByYW5kb21BcnJheVsxXSArIFwiXCIgKyByYW5kb21BcnJheVsyXSArIHRoaXMuc3dpdGNoU3RyKHN0cjEsIHN0cjIsIHN0cjMsIHJhbmRvbUFycmF5WzBdKSArIHRoaXMuc3dpdGNoU3RyKHN0cjEsIHN0cjIsIHN0cjMsIHJhbmRvbUFycmF5WzFdKSArIHRoaXMuc3dpdGNoU3RyKHN0cjEsIHN0cjIsIHN0cjMsIHJhbmRvbUFycmF5WzJdKSArIFwidGltZXNcIiArIHRpbWVTdGFtcC5zdWJzdHJpbmcoNSk7XG4gIH1cblxuICBwcml2YXRlIHN3aXRjaFN0cihzdHIxOiBzdHJpbmcsIHN0cjI6IHN0cmluZywgc3RyMzogc3RyaW5nLCBpOiBudW1iZXIpOiBzdHJpbmcge1xuICAgIHN3aXRjaCAoaSkge1xuICAgICAgY2FzZSAxOiByZXR1cm4gc3RyMTtcbiAgICAgIGNhc2UgMjogcmV0dXJuIHN0cjI7XG4gICAgICBjYXNlIDM6IHJldHVybiBzdHIzO1xuICAgIH1cbiAgfVxuXG5cblxufVxuIl19
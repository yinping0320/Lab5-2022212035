/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Injectable, Injector, ComponentFactoryResolver } from '@angular/core';
//import { FileUploadComponent } from './upload/file-upload/file-upload.component';
import { BsModalService } from '@farris/ui-modal';
import { FileListComponent } from './file-list/file-list/file-list.component';
import { FileListService } from './service/file-list.service';
import { MessagerService } from '@farris/ui-messager';
import { CloudprintService, PrintType, FileType, OutputType } from "@gsp-svc/cloudprint";
import { PdfViewOptions } from './pdf-viewer/entitires/pdfviewoptions';
import { AppService } from '@gsp-sys/rtf-common';
import { UUID } from 'angular2-uuid';
//import { UploadLimit } from './upload/entity/uploadlimit';
var FileViewerService = /** @class */ (function () {
    function FileViewerService(modalService, componentFactoryResolver, injector, fileListService, msgService, cloudprintService, appService) {
        this.modalService = modalService;
        this.componentFactoryResolver = componentFactoryResolver;
        this.injector = injector;
        this.fileListService = fileListService;
        this.msgService = msgService;
        this.cloudprintService = cloudprintService;
        this.appService = appService;
        this.windowWidth = window.innerWidth;
        this.windowHeigth = window.innerHeight;
    }
    //fileInfoList: UploadFileInfo[] = [];
    //fileInfoList: UploadFileInfo[] = [];
    /**
     * @param {?} formId
     * @param {?} rootId
     * @param {?=} viewOptions
     * @return {?}
     */
    FileViewerService.prototype.viewerFormFile = 
    //fileInfoList: UploadFileInfo[] = [];
    /**
     * @param {?} formId
     * @param {?} rootId
     * @param {?=} viewOptions
     * @return {?}
     */
    function (formId, rootId, viewOptions) {
        var _this = this;
        if (viewOptions === void 0) { viewOptions = new PdfViewOptions; }
        return new Promise((/**
         * @param {?} resolve
         * @return {?}
         */
        function (resolve) {
            /** @type {?} */
            var viewerFactory = _this.componentFactoryResolver.resolveComponentFactory(FileListComponent);
            /** @type {?} */
            var viewerRef = viewerFactory.create(_this.injector);
            viewerRef.instance.rootId = rootId;
            viewerRef.instance.formId = formId;
            _this.dlg = _this.modalService.show(viewerRef, {
                title: '',
                width: document.scrollingElement.clientWidth - 20,
                height: document.scrollingElement.clientWidth - 20,
                showButtons: false,
                showMaxButton: false,
                resizable: false
            });
            _this.dlg.content.viewOptions = viewOptions;
            // this.dlg.content.formId = formId;
            // this.dlg.content.rootId = rootId;
        }));
    };
    /**
     * @param {?} metadataIdList
     * @param {?} rootId
     * @param {?=} viewOptions
     * @return {?}
     */
    FileViewerService.prototype.viewerFileList = /**
     * @param {?} metadataIdList
     * @param {?} rootId
     * @param {?=} viewOptions
     * @return {?}
     */
    function (metadataIdList, rootId, viewOptions) {
        var _this = this;
        if (viewOptions === void 0) { viewOptions = new PdfViewOptions; }
        return new Promise((/**
         * @param {?} resolve
         * @return {?}
         */
        function (resolve) {
            /** @type {?} */
            var viewerFactory = _this.componentFactoryResolver.resolveComponentFactory(FileListComponent);
            /** @type {?} */
            var viewerRef = viewerFactory.create(_this.injector);
            viewerRef.instance.rootId = rootId;
            viewerRef.instance.metadataIdList = metadataIdList;
            _this.dlg = _this.modalService.show(viewerRef, {
                title: '',
                width: document.scrollingElement.clientWidth - 20,
                height: document.scrollingElement.clientWidth - 20,
                showButtons: false,
                showMaxButton: false,
                resizable: false,
                opened: (/**
                 * @return {?}
                 */
                function () {
                    setTimeout((/**
                     * @return {?}
                     */
                    function () {
                        _this.dlg.dialog.changeDetectorRef['_appRef'].tick();
                    }), 500);
                })
            });
            _this.dlg.content.viewOptions = viewOptions;
            // this.dlg.content.metadataIdList = metadataIdList;
            // this.dlg.content.rootId = rootId;
        }));
    };
    /**
     * @param {?} formId
     * @param {?} rootId
     * @param {?} metadataId
     * @param {?=} viewOptions
     * @return {?}
     */
    FileViewerService.prototype.viewerFormFileWithIndex = /**
     * @param {?} formId
     * @param {?} rootId
     * @param {?} metadataId
     * @param {?=} viewOptions
     * @return {?}
     */
    function (formId, rootId, metadataId, viewOptions) {
        var _this = this;
        if (viewOptions === void 0) { viewOptions = new PdfViewOptions; }
        return new Promise((/**
         * @param {?} resolve
         * @return {?}
         */
        function (resolve) {
            /** @type {?} */
            var viewerFactory = _this.componentFactoryResolver.resolveComponentFactory(FileListComponent);
            /** @type {?} */
            var viewerRef = viewerFactory.create(_this.injector);
            viewerRef.instance.rootId = rootId;
            viewerRef.instance.formId = formId;
            viewerRef.instance.metadataId = metadataId;
            _this.dlg = _this.modalService.show(viewerRef, {
                title: '',
                width: document.scrollingElement.clientWidth - 20,
                height: document.scrollingElement.clientWidth - 20,
                showButtons: false,
                showMaxButton: false,
                resizable: false,
                opened: (/**
                 * @return {?}
                 */
                function () {
                    setTimeout((/**
                     * @return {?}
                     */
                    function () {
                        _this.dlg.dialog.changeDetectorRef['_appRef'].tick();
                    }), 500);
                })
            });
            _this.dlg.content.viewOptions = viewOptions;
            // this.dlg.content.formId = formId;
            // this.dlg.content.rootId = rootId;
        }));
    };
    /**
     * @param {?} metadataIdList
     * @param {?} rootId
     * @param {?} metadataId
     * @param {?=} viewOptions
     * @return {?}
     */
    FileViewerService.prototype.viewerFileListWithIndex = /**
     * @param {?} metadataIdList
     * @param {?} rootId
     * @param {?} metadataId
     * @param {?=} viewOptions
     * @return {?}
     */
    function (metadataIdList, rootId, metadataId, viewOptions) {
        var _this = this;
        if (viewOptions === void 0) { viewOptions = new PdfViewOptions; }
        return new Promise((/**
         * @param {?} resolve
         * @return {?}
         */
        function (resolve) {
            /** @type {?} */
            var viewerFactory = _this.componentFactoryResolver.resolveComponentFactory(FileListComponent);
            /** @type {?} */
            var viewerRef = viewerFactory.create(_this.injector);
            viewerRef.instance.rootId = rootId;
            viewerRef.instance.metadataIdList = metadataIdList;
            viewerRef.instance.metadataId = metadataId;
            _this.dlg = _this.modalService.show(viewerRef, {
                title: '',
                width: document.scrollingElement.clientWidth - 20,
                height: document.scrollingElement.clientWidth - 20,
                showButtons: false,
                showMaxButton: false,
                resizable: false,
                opened: (/**
                 * @return {?}
                 */
                function () {
                    setTimeout((/**
                     * @return {?}
                     */
                    function () {
                        _this.dlg.dialog.changeDetectorRef['_appRef'].tick();
                    }), 500);
                })
            });
            _this.dlg.content.viewOptions = viewOptions;
            // this.dlg.content.metadataIdList = metadataIdList;
            // this.dlg.content.rootId = rootId;
        }));
    };
    /**
     * @param {?} metadataIdList
     * @param {?} rootId
     * @return {?}
     */
    FileViewerService.prototype.mergeAndViewPdfFiles = /**
     * @param {?} metadataIdList
     * @param {?} rootId
     * @return {?}
     */
    function (metadataIdList, rootId) {
        var _this = this;
        this.fileListService.getMergedFile(metadataIdList, rootId).subscribe((/**
         * @param {?} res
         * @return {?}
         */
        function (res) {
            if (res.error != null) {
                _this.msgService.error(res.error.Message);
            }
            else {
                /** @type {?} */
                var options = {
                    OutputType: OutputType.PRINT,
                    FileType: FileType.Pdf,
                    Path: '',
                    DeviceId: '',
                    printType: PrintType.Form
                };
                _this.cloudprintService.openRendedViewer4Attachment("tab", res, options);
            }
        }));
    };
    /**
     * @param {?} formId
     * @param {?} rootId
     * @param {?=} viewOptions
     * @return {?}
     */
    FileViewerService.prototype.viewerFormFileInpage = /**
     * @param {?} formId
     * @param {?} rootId
     * @param {?=} viewOptions
     * @return {?}
     */
    function (formId, rootId, viewOptions) {
        if (viewOptions === void 0) { viewOptions = new PdfViewOptions; }
        this.viewerFormFileWithIndexInPage(formId, rootId, null, viewOptions);
    };
    /**
     * @param {?} metadataIdList
     * @param {?} rootId
     * @param {?=} viewOptions
     * @return {?}
     */
    FileViewerService.prototype.viewerFileListInPage = /**
     * @param {?} metadataIdList
     * @param {?} rootId
     * @param {?=} viewOptions
     * @return {?}
     */
    function (metadataIdList, rootId, viewOptions) {
        if (viewOptions === void 0) { viewOptions = new PdfViewOptions; }
        this.viewerFileListWithIndexInPage(metadataIdList, rootId, null, viewOptions);
    };
    /**
     * @param {?} formId
     * @param {?} rootId
     * @param {?} metadataId
     * @param {?=} viewOptions
     * @return {?}
     */
    FileViewerService.prototype.viewerFormFileWithIndexInPage = /**
     * @param {?} formId
     * @param {?} rootId
     * @param {?} metadataId
     * @param {?=} viewOptions
     * @return {?}
     */
    function (formId, rootId, metadataId, viewOptions) {
        if (viewOptions === void 0) { viewOptions = new PdfViewOptions; }
        this.appService.openAppByOptions({
            appType: 'app',
            funcId: '',
            tabName: '文档在线预览',
            appId: '6ccb476b-f2ba-df8f-6f47-d37d100c56e2',
            appEntrance: 'docviewertab',
            tabId: UUID.UUID(),
            entityParams: {
                formId: formId,
                rootId: rootId,
                metadataId: metadataId,
                viewOptions: viewOptions
            },
        });
    };
    /**
     * @param {?} metadataIdList
     * @param {?} rootId
     * @param {?} metadataId
     * @param {?=} viewOptions
     * @return {?}
     */
    FileViewerService.prototype.viewerFileListWithIndexInPage = /**
     * @param {?} metadataIdList
     * @param {?} rootId
     * @param {?} metadataId
     * @param {?=} viewOptions
     * @return {?}
     */
    function (metadataIdList, rootId, metadataId, viewOptions) {
        if (viewOptions === void 0) { viewOptions = new PdfViewOptions; }
        this.appService.openAppByOptions({
            appType: 'app',
            funcId: '',
            tabName: '文档在线预览',
            appId: '6ccb476b-f2ba-df8f-6f47-d37d100c56e2',
            appEntrance: 'docviewertab',
            tabId: UUID.UUID(),
            entityParams: {
                metadataIdList: metadataIdList,
                rootId: rootId,
                metadataId: metadataId,
                viewOptions: viewOptions
            },
        });
    };
    FileViewerService.decorators = [
        { type: Injectable }
    ];
    /** @nocollapse */
    FileViewerService.ctorParameters = function () { return [
        { type: BsModalService },
        { type: ComponentFactoryResolver },
        { type: Injector },
        { type: FileListService },
        { type: MessagerService },
        { type: CloudprintService },
        { type: AppService }
    ]; };
    return FileViewerService;
}());
export { FileViewerService };
if (false) {
    /** @type {?} */
    FileViewerService.prototype.dlg;
    /** @type {?} */
    FileViewerService.prototype.windowWidth;
    /** @type {?} */
    FileViewerService.prototype.windowHeigth;
    /**
     * @type {?}
     * @private
     */
    FileViewerService.prototype.modalService;
    /**
     * @type {?}
     * @private
     */
    FileViewerService.prototype.componentFactoryResolver;
    /**
     * @type {?}
     * @private
     */
    FileViewerService.prototype.injector;
    /**
     * @type {?}
     * @private
     */
    FileViewerService.prototype.fileListService;
    /**
     * @type {?}
     * @private
     */
    FileViewerService.prototype.msgService;
    /**
     * @type {?}
     * @private
     */
    FileViewerService.prototype.cloudprintService;
    /**
     * @type {?}
     * @private
     */
    FileViewerService.prototype.appService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmlsZXZpZXdlci5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGdzcC1zdmMvZmlsZS12aWV3ZXIvIiwic291cmNlcyI6WyJsaWIvZmlsZXZpZXdlci5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLFFBQVEsRUFBRSx3QkFBd0IsRUFBRSxNQUFNLGVBQWUsQ0FBQzs7QUFFL0UsT0FBTyxFQUFFLGNBQWMsRUFBYyxNQUFNLGtCQUFrQixDQUFDO0FBRzlELE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLDJDQUEyQyxDQUFDO0FBQzlFLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSw2QkFBNkIsQ0FBQztBQUM5RCxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDdEQsT0FBTyxFQUFFLGlCQUFpQixFQUFFLFNBQVMsRUFBRSxRQUFRLEVBQUUsVUFBVSxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDekYsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLHVDQUF1QyxDQUFDO0FBQ3ZFLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUNqRCxPQUFPLEVBQUUsSUFBSSxFQUFFLE1BQU0sZUFBZSxDQUFDOztBQUtyQztJQUVJLDJCQUFvQixZQUE0QixFQUFVLHdCQUFrRCxFQUFVLFFBQWtCLEVBQzVILGVBQWdDLEVBQVUsVUFBMkIsRUFBVSxpQkFBb0MsRUFBVSxVQUFzQjtRQUQzSSxpQkFBWSxHQUFaLFlBQVksQ0FBZ0I7UUFBVSw2QkFBd0IsR0FBeEIsd0JBQXdCLENBQTBCO1FBQVUsYUFBUSxHQUFSLFFBQVEsQ0FBVTtRQUM1SCxvQkFBZSxHQUFmLGVBQWUsQ0FBaUI7UUFBVSxlQUFVLEdBQVYsVUFBVSxDQUFpQjtRQUFVLHNCQUFpQixHQUFqQixpQkFBaUIsQ0FBbUI7UUFBVSxlQUFVLEdBQVYsVUFBVSxDQUFZO1FBSS9KLGdCQUFXLEdBQVcsTUFB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VUFBVTs7OztnQkFkRixjQUFjO2dCQUZRLHdCQUF3QjtnQkFBbEMsUUFBUTtnQkFNcEIsZUFBZTtnQkFDZixlQUFlO2dCQUNmLGlCQUFpQjtnQkFFakIsVUFBVTs7SUFnTW5CLHdCQUFDO0NBQUEsQUExTEQsSUEwTEM7U0F6TFksaUJBQWlCOzs7SUFJMUIsZ0NBQWdCOztJQUVoQix3Q0FBd0M7O0lBQ3hDLHlDQUEwQzs7Ozs7SUFOOUIseUNBQW9DOzs7OztJQUFFLHFEQUEwRDs7Ozs7SUFBRSxxQ0FBMEI7Ozs7O0lBQ3BJLDRDQUF3Qzs7Ozs7SUFBRSx1Q0FBbUM7Ozs7O0lBQUUsOENBQTRDOzs7OztJQUFFLHVDQUE4QiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUsIEluamVjdG9yLCBDb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuLy9pbXBvcnQgeyBGaWxlVXBsb2FkQ29tcG9uZW50IH0gZnJvbSAnLi91cGxvYWQvZmlsZS11cGxvYWQvZmlsZS11cGxvYWQuY29tcG9uZW50JztcclxuaW1wb3J0IHsgQnNNb2RhbFNlcnZpY2UsIEJzTW9kYWxSZWYgfSBmcm9tICdAZmFycmlzL3VpLW1vZGFsJztcclxuLy9pbXBvcnQgeyBVcGxvYWRGaWxlSW5mbyB9IGZyb20gJy4vdXBsb2FkL2VudGl0eS91cGxvYWRmaWxlaW5mbyc7XHJcbmltcG9ydCB7IE9ic2VydmFibGUsIG9mIH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7IEZpbGVMaXN0Q29tcG9uZW50IH0gZnJvbSAnLi9maWxlLWxpc3QvZmlsZS1saXN0L2ZpbGUtbGlzdC5jb21wb25lbnQnO1xyXG5pbXBvcnQgeyBGaWxlTGlzdFNlcnZpY2UgfSBmcm9tICcuL3NlcnZpY2UvZmlsZS1saXN0LnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBNZXNzYWdlclNlcnZpY2UgfSBmcm9tICdAZmFycmlzL3VpLW1lc3NhZ2VyJztcclxuaW1wb3J0IHsgQ2xvdWRwcmludFNlcnZpY2UsIFByaW50VHlwZSwgRmlsZVR5cGUsIE91dHB1dFR5cGUgfSBmcm9tIFwiQGdzcC1zdmMvY2xvdWRwcmludFwiO1xyXG5pbXBvcnQgeyBQZGZWaWV3T3B0aW9ucyB9IGZyb20gJy4vcGRmLXZpZXdlci9lbnRpdGlyZXMvcGRmdmlld29wdGlvbnMnO1xyXG5pbXBvcnQgeyBBcHBTZXJ2aWNlIH0gZnJvbSAnQGdzcC1zeXMvcnRmLWNvbW1vbic7XHJcbmltcG9ydCB7IFVVSUQgfSBmcm9tICdhbmd1bGFyMi11dWlkJztcclxuLy9pbXBvcnQgeyBVcGxvYWRMaW1pdCB9IGZyb20gJy4vdXBsb2FkL2VudGl0eS91cGxvYWRsaW1pdCc7XHJcblxyXG5cclxuXHJcbkBJbmplY3RhYmxlKClcclxuZXhwb3J0IGNsYXNzIEZpbGVWaWV3ZXJTZXJ2aWNlIHtcclxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgbW9kYWxTZXJ2aWNlOiBCc01vZGFsU2VydmljZSwgcHJpdmF0ZSBjb21wb25lbnRGYWN0b3J5UmVzb2x2ZXI6IENvbXBvbmVudEZhY3RvcnlSZXNvbHZlciwgcHJpdmF0ZSBpbmplY3RvcjogSW5qZWN0b3IsXHJcbiAgICAgICAgcHJpdmF0ZSBmaWxlTGlzdFNlcnZpY2U6IEZpbGVMaXN0U2VydmljZSwgcHJpdmF0ZSBtc2dTZXJ2aWNlOiBNZXNzYWdlclNlcnZpY2UsIHByaXZhdGUgY2xvdWRwcmludFNlcnZpY2U6IENsb3VkcHJpbnRTZXJ2aWNlLCBwcml2YXRlIGFwcFNlcnZpY2U6IEFwcFNlcnZpY2UpIHsgfVxyXG5cclxuICAgIGRsZzogQnNNb2RhbFJlZjtcclxuXHJcbiAgICB3aW5kb3dXaWR0aDogbnVtYmVyID0gd2luZG93LmlubmVyV2lkdGg7XHJcbiAgICB3aW5kb3dIZWlndGg6IG51bWJlciA9IHdpbmRvdy5pbm5lckhlaWdodDtcclxuXHJcbiAgICAvL2ZpbGVJbmZvTGlzdDogVXBsb2FkRmlsZUluZm9bXSA9IFtdO1xyXG5cclxuICAgIHZpZXdlckZvcm1GaWxlKGZvcm1JZDogc3RyaW5nLCByb290SWQ6IHN0cmluZywgdmlld09wdGlvbnM6IFBkZlZpZXdPcHRpb25zID0gbmV3IFBkZlZpZXdPcHRpb25zKSB7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKHJlc29sdmUgPT4ge1xyXG5cclxuICAgICAgICAgICAgdmFyIHZpZXdlckZhY3RvcnkgPSB0aGlzLmNvbXBvbmVudEZhY3RvcnlSZXNvbHZlci5yZXNvbHZlQ29tcG9uZW50RmFjdG9yeShGaWxlTGlzdENvbXBvbmVudCk7XHJcbiAgICAgICAgICAgIHZhciB2aWV3ZXJSZWYgPSB2aWV3ZXJGYWN0b3J5LmNyZWF0ZSh0aGlzLmluamVjdG9yKTtcclxuXHJcbiAgICAgICAgICAgIHZpZXdlclJlZi5pbnN0YW5jZS5yb290SWQgPSByb290SWQ7XHJcbiAgICAgICAgICAgIHZpZXdlclJlZi5pbnN0YW5jZS5mb3JtSWQgPSBmb3JtSWQ7XHJcblxyXG4gICAgICAgICAgICB0aGlzLmRsZyA9IHRoaXMubW9kYWxTZXJ2aWNlLnNob3codmlld2VyUmVmLCB7XHJcbiAgICAgICAgICAgICAgICB0aXRsZTogJycsXHJcbiAgICAgICAgICAgICAgICB3aWR0aDogZG9jdW1lbnQuc2Nyb2xsaW5nRWxlbWVudC5jbGllbnRXaWR0aCAtIDIwLFxyXG4gICAgICAgICAgICAgICAgaGVpZ2h0OiBkb2N1bWVudC5zY3JvbGxpbmdFbGVtZW50LmNsaWVudFdpZHRoIC0gMjAsXHJcbiAgICAgICAgICAgICAgICBzaG93QnV0dG9uczogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICBzaG93TWF4QnV0dG9uOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgIHJlc2l6YWJsZTogZmFsc2VcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIHRoaXMuZGxnLmNvbnRlbnQudmlld09wdGlvbnMgPSB2aWV3T3B0aW9ucztcclxuICAgICAgICAgICAgLy8gdGhpcy5kbGcuY29udGVudC5mb3JtSWQgPSBmb3JtSWQ7XHJcbiAgICAgICAgICAgIC8vIHRoaXMuZGxnLmNvbnRlbnQucm9vdElkID0gcm9vdElkO1xyXG4gICAgICAgIH0pXHJcbiAgICB9XHJcblxyXG4gICAgdmlld2VyRmlsZUxpc3QobWV0YWRhdGFJZExpc3Q6IHN0cmluZ1tdLCByb290SWQ6IHN0cmluZywgdmlld09wdGlvbnM6IFBkZlZpZXdPcHRpb25zID0gbmV3IFBkZlZpZXdPcHRpb25zKSB7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKHJlc29sdmUgPT4ge1xyXG4gICAgICAgICAgICB2YXIgdmlld2VyRmFjdG9yeSA9IHRoaXMuY29tcG9uZW50RmFjdG9yeVJlc29sdmVyLnJlc29sdmVDb21wb25lbnRGYWN0b3J5KEZpbGVMaXN0Q29tcG9uZW50KTtcclxuICAgICAgICAgICAgdmFyIHZpZXdlclJlZiA9IHZpZXdlckZhY3RvcnkuY3JlYXRlKHRoaXMuaW5qZWN0b3IpO1xyXG5cclxuICAgICAgICAgICAgdmlld2VyUmVmLmluc3RhbmNlLnJvb3RJZCA9IHJvb3RJZDtcclxuICAgICAgICAgICAgdmlld2VyUmVmLmluc3RhbmNlLm1ldGFkYXRhSWRMaXN0ID0gbWV0YWRhdGFJZExpc3Q7XHJcblxyXG4gICAgICAgICAgICB0aGlzLmRsZyA9IHRoaXMubW9kYWxTZXJ2aWNlLnNob3codmlld2VyUmVmLCB7XHJcbiAgICAgICAgICAgICAgICB0aXRsZTogJycsXHJcbiAgICAgICAgICAgICAgICB3aWR0aDogZG9jdW1lbnQuc2Nyb2xsaW5nRWxlbWVudC5jbGllbnRXaWR0aCAtIDIwLFxyXG4gICAgICAgICAgICAgICAgaGVpZ2h0OiBkb2N1bWVudC5zY3JvbGxpbmdFbGVtZW50LmNsaWVudFdpZHRoIC0gMjAsXHJcblxyXG4gICAgICAgICAgICAgICAgc2hvd0J1dHRvbnM6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgc2hvd01heEJ1dHRvbjogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICByZXNpemFibGU6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgb3BlbmVkOiAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZGxnLmRpYWxvZy5jaGFuZ2VEZXRlY3RvclJlZlsnX2FwcFJlZiddLnRpY2soKVxyXG4gICAgICAgICAgICAgICAgICAgIH0sIDUwMClcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIHRoaXMuZGxnLmNvbnRlbnQudmlld09wdGlvbnMgPSB2aWV3T3B0aW9ucztcclxuICAgICAgICAgICAgLy8gdGhpcy5kbGcuY29udGVudC5tZXRhZGF0YUlkTGlzdCA9IG1ldGFkYXRhSWRMaXN0O1xyXG4gICAgICAgICAgICAvLyB0aGlzLmRsZy5jb250ZW50LnJvb3RJZCA9IHJvb3RJZDtcclxuICAgICAgICB9KVxyXG4gICAgfVxyXG5cclxuXHJcbiAgICB2aWV3ZXJGb3JtRmlsZVdpdGhJbmRleChmb3JtSWQ6IHN0cmluZywgcm9vdElkOiBzdHJpbmcsIG1ldGFkYXRhSWQ6IHN0cmluZywgdmlld09wdGlvbnM6IFBkZlZpZXdPcHRpb25zID0gbmV3IFBkZlZpZXdPcHRpb25zKSB7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKHJlc29sdmUgPT4ge1xyXG5cclxuICAgICAgICAgICAgdmFyIHZpZXdlckZhY3RvcnkgPSB0aGlzLmNvbXBvbmVudEZhY3RvcnlSZXNvbHZlci5yZXNvbHZlQ29tcG9uZW50RmFjdG9yeShGaWxlTGlzdENvbXBvbmVudCk7XHJcbiAgICAgICAgICAgIHZhciB2aWV3ZXJSZWYgPSB2aWV3ZXJGYWN0b3J5LmNyZWF0ZSh0aGlzLmluamVjdG9yKTtcclxuXHJcbiAgICAgICAgICAgIHZpZXdlclJlZi5pbnN0YW5jZS5yb290SWQgPSByb290SWQ7XHJcbiAgICAgICAgICAgIHZpZXdlclJlZi5pbnN0YW5jZS5mb3JtSWQgPSBmb3JtSWQ7XHJcbiAgICAgICAgICAgIHZpZXdlclJlZi5pbnN0YW5jZS5tZXRhZGF0YUlkID0gbWV0YWRhdGFJZDtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuZGxnID0gdGhpcy5tb2RhbFNlcnZpY2Uuc2hvdyh2aWV3ZXJSZWYsIHtcclxuICAgICAgICAgICAgICAgIHRpdGxlOiAnJyxcclxuXHJcbiAgICAgICAgICAgICAgICB3aWR0aDogZG9jdW1lbnQuc2Nyb2xsaW5nRWxlbWVudC5jbGllbnRXaWR0aCAtIDIwLFxyXG4gICAgICAgICAgICAgICAgaGVpZ2h0OiBkb2N1bWVudC5zY3JvbGxpbmdFbGVtZW50LmNsaWVudFdpZHRoIC0gMjAsXHJcbiAgICAgICAgICAgICAgICBzaG93QnV0dG9uczogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICBzaG93TWF4QnV0dG9uOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgIHJlc2l6YWJsZTogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICBvcGVuZWQ6ICgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kbGcuZGlhbG9nLmNoYW5nZURldGVjdG9yUmVmWydfYXBwUmVmJ10udGljaygpXHJcbiAgICAgICAgICAgICAgICAgICAgfSwgNTAwKVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgdGhpcy5kbGcuY29udGVudC52aWV3T3B0aW9ucyA9IHZpZXdPcHRpb25zO1xyXG4gICAgICAgICAgICAvLyB0aGlzLmRsZy5jb250ZW50LmZvcm1JZCA9IGZvcm1JZDtcclxuICAgICAgICAgICAgLy8gdGhpcy5kbGcuY29udGVudC5yb290SWQgPSByb290SWQ7XHJcbiAgICAgICAgfSlcclxuICAgIH1cclxuXHJcbiAgICB2aWV3ZXJGaWxlTGlzdFdpdGhJbmRleChtZXRhZGF0YUlkTGlzdDogc3RyaW5nW10sIHJvb3RJZDogc3RyaW5nLCBtZXRhZGF0YUlkOiBzdHJpbmcsIHZpZXdPcHRpb25zOiBQZGZWaWV3T3B0aW9ucyA9IG5ldyBQZGZWaWV3T3B0aW9ucykge1xyXG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHtcclxuICAgICAgICAgICAgdmFyIHZpZXdlckZhY3RvcnkgPSB0aGlzLmNvbXBvbmVudEZhY3RvcnlSZXNvbHZlci5yZXNvbHZlQ29tcG9uZW50RmFjdG9yeShGaWxlTGlzdENvbXBvbmVudCk7XHJcbiAgICAgICAgICAgIHZhciB2aWV3ZXJSZWYgPSB2aWV3ZXJGYWN0b3J5LmNyZWF0ZSh0aGlzLmluamVjdG9yKTtcclxuXHJcbiAgICAgICAgICAgIHZpZXdlclJlZi5pbnN0YW5jZS5yb290SWQgPSByb290SWQ7XHJcbiAgICAgICAgICAgIHZpZXdlclJlZi5pbnN0YW5jZS5tZXRhZGF0YUlkTGlzdCA9IG1ldGFkYXRhSWRMaXN0O1xyXG4gICAgICAgICAgICB2aWV3ZXJSZWYuaW5zdGFuY2UubWV0YWRhdGFJZCA9IG1ldGFkYXRhSWQ7XHJcblxyXG4gICAgICAgICAgICB0aGlzLmRsZyA9IHRoaXMubW9kYWxTZXJ2aWNlLnNob3codmlld2VyUmVmLCB7XHJcbiAgICAgICAgICAgICAgICB0aXRsZTogJycsXHJcbiAgICAgICAgICAgICAgICB3aWR0aDogZG9jdW1lbnQuc2Nyb2xsaW5nRWxlbWVudC5jbGllbnRXaWR0aCAtIDIwLFxyXG4gICAgICAgICAgICAgICAgaGVpZ2h0OiBkb2N1bWVudC5zY3JvbGxpbmdFbGVtZW50LmNsaWVudFdpZHRoIC0gMjAsXHJcblxyXG4gICAgICAgICAgICAgICAgc2hvd0J1dHRvbnM6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgc2hvd01heEJ1dHRvbjogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICByZXNpemFibGU6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgb3BlbmVkOiAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZGxnLmRpYWxvZy5jaGFuZ2VEZXRlY3RvclJlZlsnX2FwcFJlZiddLnRpY2soKVxyXG4gICAgICAgICAgICAgICAgICAgIH0sIDUwMClcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB0aGlzLmRsZy5jb250ZW50LnZpZXdPcHRpb25zID0gdmlld09wdGlvbnM7XHJcbiAgICAgICAgICAgIC8vIHRoaXMuZGxnLmNvbnRlbnQubWV0YWRhdGFJZExpc3QgPSBtZXRhZGF0YUlkTGlzdDtcclxuICAgICAgICAgICAgLy8gdGhpcy5kbGcuY29udGVudC5yb290SWQgPSByb290SWQ7XHJcbiAgICAgICAgfSlcclxuICAgIH1cclxuXHJcblxyXG4gICAgbWVyZ2VBbmRWaWV3UGRmRmlsZXMobWV0YWRhdGFJZExpc3Q6IHN0cmluZ1tdLCByb290SWQ6IHN0cmluZykge1xyXG4gICAgICAgIHRoaXMuZmlsZUxpc3RTZXJ2aWNlLmdldE1lcmdlZEZpbGUobWV0YWRhdGFJZExpc3QsIHJvb3RJZCkuc3Vic2NyaWJlKHJlcyA9PiB7XHJcbiAgICAgICAgICAgIGlmIChyZXMuZXJyb3IgIT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5tc2dTZXJ2aWNlLmVycm9yKHJlcy5lcnJvci5NZXNzYWdlKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGxldCBvcHRpb25zID0ge1xyXG4gICAgICAgICAgICAgICAgICAgIE91dHB1dFR5cGU6IE91dHB1dFR5cGUuUFJJTlQsXHJcbiAgICAgICAgICAgICAgICAgICAgRmlsZVR5cGU6IEZpbGVUeXBlLlBkZixcclxuICAgICAgICAgICAgICAgICAgICBQYXRoOiAnJyxcclxuICAgICAgICAgICAgICAgICAgICBEZXZpY2VJZDogJycsXHJcbiAgICAgICAgICAgICAgICAgICAgcHJpbnRUeXBlOiBQcmludFR5cGUuRm9ybVxyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgIHRoaXMuY2xvdWRwcmludFNlcnZpY2Uub3BlblJlbmRlZFZpZXdlcjRBdHRhY2htZW50KFwidGFiXCIsIHJlcywgb3B0aW9ucyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KVxyXG4gICAgfVxyXG5cclxuXHJcbiAgICB2aWV3ZXJGb3JtRmlsZUlucGFnZShmb3JtSWQ6IHN0cmluZywgcm9vdElkOiBzdHJpbmcsIHZpZXdPcHRpb25zOiBQZGZWaWV3T3B0aW9ucyA9IG5ldyBQZGZWaWV3T3B0aW9ucykge1xyXG4gICAgICAgIHRoaXMudmlld2VyRm9ybUZpbGVXaXRoSW5kZXhJblBhZ2UoZm9ybUlkLCByb290SWQsIG51bGwsIHZpZXdPcHRpb25zKTtcclxuICAgIH1cclxuXHJcbiAgICB2aWV3ZXJGaWxlTGlzdEluUGFnZShtZXRhZGF0YUlkTGlzdDogc3RyaW5nW10sIHJvb3RJZDogc3RyaW5nLCB2aWV3T3B0aW9uczogUGRmVmlld09wdGlvbnMgPSBuZXcgUGRmVmlld09wdGlvbnMpIHtcclxuICAgICAgICB0aGlzLnZpZXdlckZpbGVMaXN0V2l0aEluZGV4SW5QYWdlKG1ldGFkYXRhSWRMaXN0LCByb290SWQsIG51bGwsIHZpZXdPcHRpb25zKTtcclxuICAgIH1cclxuXHJcblxyXG4gICAgdmlld2VyRm9ybUZpbGVXaXRoSW5kZXhJblBhZ2UoZm9ybUlkOiBzdHJpbmcsIHJvb3RJZDogc3RyaW5nLCBtZXRhZGF0YUlkOiBzdHJpbmcsIHZpZXdPcHRpb25zOiBQZGZWaWV3T3B0aW9ucyA9IG5ldyBQZGZWaWV3T3B0aW9ucykge1xyXG4gICAgICAgIHRoaXMuYXBwU2VydmljZS5vcGVuQXBwQnlPcHRpb25zKHtcclxuICAgICAgICAgICAgYXBwVHlwZTogJ2FwcCcsXHJcbiAgICAgICAgICAgIGZ1bmNJZDogJycsXHJcbiAgICAgICAgICAgIHRhYk5hbWU6ICfmlofmoaPlnKjnur/pooTop4gnLFxyXG4gICAgICAgICAgICBhcHBJZDogJzZjY2I0NzZiLWYyYmEtZGY4Zi02ZjQ3LWQzN2QxMDBjNTZlMicsXHJcbiAgICAgICAgICAgIGFwcEVudHJhbmNlOiAnZG9jdmlld2VydGFiJyxcclxuICAgICAgICAgICAgdGFiSWQ6IFVVSUQuVVVJRCgpLFxyXG4gICAgICAgICAgICBlbnRpdHlQYXJhbXM6IHtcclxuICAgICAgICAgICAgICAgIGZvcm1JZDogZm9ybUlkLFxyXG4gICAgICAgICAgICAgICAgcm9vdElkOiByb290SWQsXHJcbiAgICAgICAgICAgICAgICBtZXRhZGF0YUlkOiBtZXRhZGF0YUlkLFxyXG4gICAgICAgICAgICAgICAgdmlld09wdGlvbnM6IHZpZXdPcHRpb25zXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgdmlld2VyRmlsZUxpc3RXaXRoSW5kZXhJblBhZ2UobWV0YWRhdGFJZExpc3Q6IHN0cmluZ1tdLCByb290SWQ6IHN0cmluZywgbWV0YWRhdGFJZDogc3RyaW5nLCB2aWV3T3B0aW9uczogUGRmVmlld09wdGlvbnMgPSBuZXcgUGRmVmlld09wdGlvbnMpIHtcclxuICAgICAgICB0aGlzLmFwcFNlcnZpY2Uub3BlbkFwcEJ5T3B0aW9ucyh7XHJcbiAgICAgICAgICAgIGFwcFR5cGU6ICdhcHAnLFxyXG4gICAgICAgICAgICBmdW5jSWQ6ICcnLFxyXG4gICAgICAgICAgICB0YWJOYW1lOiAn5paH5qGj5Zyo57q/6aKE6KeIJyxcclxuICAgICAgICAgICAgYXBwSWQ6ICc2Y2NiNDc2Yi1mMmJhLWRmOGYtNmY0Ny1kMzdkMTAwYzU2ZTInLFxyXG4gICAgICAgICAgICBhcHBFbnRyYW5jZTogJ2RvY3ZpZXdlcnRhYicsXHJcbiAgICAgICAgICAgIHRhYklkOiBVVUlELlVVSUQoKSxcclxuICAgICAgICAgICAgZW50aXR5UGFyYW1zOiB7XHJcbiAgICAgICAgICAgICAgICBtZXRhZGF0YUlkTGlzdDogbWV0YWRhdGFJZExpc3QsXHJcbiAgICAgICAgICAgICAgICByb290SWQ6IHJvb3RJZCxcclxuICAgICAgICAgICAgICAgIG1ldGFkYXRhSWQ6IG1ldGFkYXRhSWQsXHJcbiAgICAgICAgICAgICAgICB2aWV3T3B0aW9uczogdmlld09wdGlvbnNcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbn0iXX0=
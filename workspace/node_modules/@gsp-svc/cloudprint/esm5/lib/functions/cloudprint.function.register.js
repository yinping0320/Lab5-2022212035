/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Injectable } from '@angular/core';
import { PrintFunctionsOfFiltervalue } from './cloudprint.function.filtervalue';
import { PrintFunctionsOfFormat } from './cloudprint.function.format';
import { Subject } from 'rxjs';
import { HttpClient } from '@angular/common/http';
import { PrintFunctionsOfConvert } from './cloudprint.function.convert';
var CloudprintFunctionRegister = /** @class */ (function () {
    function CloudprintFunctionRegister(http) {
        this.http = http;
        this.httpoptions = {};
        this.httpoptions['headers'] = {
            SessionId: '',
            'Content-Type': 'application/json'
        };
    }
    /**
     * 初始化自定义函数
     */
    /**
     * 初始化自定义函数
     * @param {?} configUrl
     * @return {?}
     */
    CloudprintFunctionRegister.prototype.initCustomFunction = /**
     * 初始化自定义函数
     * @param {?} configUrl
     * @return {?}
     */
    function (configUrl) {
        var _this = this;
        // 内置函数-数值过滤
        /** @type {?} */
        var funcs = new PrintFunctionsOfFiltervalue();
        // 内置函数-格式化
        /** @type {?} */
        var funcFormat = new PrintFunctionsOfFormat();
        // 内置函数-格式化
        /** @type {?} */
        var funcConvert = new PrintFunctionsOfConvert();
        // 这里默认的GSP内置函数分组为GSP
        if (Stimulsoft.Report.Dictionary.StiFunctions.getFunctions('IGixFucs').length === 0) {
            // tslint:disable-next-line:forin
            for (var f in funcs) {
                /** @type {?} */
                var func = funcs[f];
                Stimulsoft.Report.Dictionary.StiFunctions.addFunction(func.Category, func.GroupFunctionName, func.FunctionName, func.Description, func.TypeOfFunction, func.ReturnType, func.ReturnDescription, func.ArgumentTypes, func.ArgumentNames, func.ArgumentDescriptions, func.Function);
            }
            // tslint:disable-next-line:forin
            for (var f in funcFormat) {
                /** @type {?} */
                var func = funcFormat[f];
                Stimulsoft.Report.Dictionary.StiFunctions.addFunction(func.Category, func.GroupFunctionName, func.FunctionName, func.Description, func.TypeOfFunction, func.ReturnType, func.ReturnDescription, func.ArgumentTypes, func.ArgumentNames, func.ArgumentDescriptions, func.Function);
            }
            // tslint:disable-next-line:forin
            for (var f in funcConvert) {
                /** @type {?} */
                var func = funcConvert[f];
                Stimulsoft.Report.Dictionary.StiFunctions.addFunction(func.Category, func.GroupFunctionName, func.FunctionName, func.Description, func.TypeOfFunction, func.ReturnType, func.ReturnDescription, func.ArgumentTypes, func.ArgumentNames, func.ArgumentDescriptions, func.Function);
            }
        }
        // 自定义函数todo:最终自定义函数从后台取配置文件里的解析
        return this.http.get(configUrl, this.httpoptions).toPromise()
            .then((/**
         * @param {?} data
         * @return {?}
         */
        function (data) {
            if (data && data.length > 0) {
                return _this.addJsFuncPlugins(-1, data)
                    .then((/**
                 * @return {?}
                 */
                function () {
                    if (!data) {
                        return;
                    }
                    /** @type {?} */
                    var allFuncs = [];
                    // tslint:disable-next-line:forin
                    if (data.length > 0) {
                        for (var i in data) {
                            allFuncs.push(window[((/** @type {?} */ (data[i]))).key]);
                        }
                    }
                    if (Stimulsoft.Report.Dictionary.StiFunctions.getFunctions('CustomFucs').length === 0 && allFuncs.length > 0) {
                        // tslint:disable-next-line:forin
                        for (var f in allFuncs) {
                            /** @type {?} */
                            var item = allFuncs[f];
                            // tslint:disable-next-line:forin
                            for (var f2 in item) {
                                /** @type {?} */
                                var func = item[f2];
                                Stimulsoft.Report.Dictionary.StiFunctions.addFunction('CustomFucs', func.GroupFunctionName, func.FunctionName, func.Description, func.TypeOfFunction, func.ReturnType, func.ReturnDescription, func.ArgumentTypes, func.ArgumentNames, func.ArgumentDescriptions, func.Function);
                            }
                        }
                    }
                }));
            }
        }));
    };
    /**
     * 添加js业务函数插件
     */
    /**
     * 添加js业务函数插件
     * @private
     * @param {?} i
     * @param {?} data
     * @return {?}
     */
    CloudprintFunctionRegister.prototype.addJsFuncPlugins = /**
     * 添加js业务函数插件
     * @private
     * @param {?} i
     * @param {?} data
     * @return {?}
     */
    function (i, data) {
        if (!data && data.length == 0) {
            /** @type {?} */
            var sub = new Subject();
            sub.complete(); // 没有这句话toPromise()里的内容不跑
            return sub.toPromise();
        }
        /** @type {?} */
        var loader = window['System'];
        if (i < data.length - 1) {
            i++;
            this.addJsFuncPlugins(i, data);
        }
        return loader.import(data[i].path);
    };
    CloudprintFunctionRegister.decorators = [
        { type: Injectable }
    ];
    /** @nocollapse */
    CloudprintFunctionRegister.ctorParameters = function () { return [
        { type: HttpClient }
    ]; };
    return CloudprintFunctionRegister;
}());
export { CloudprintFunctionRegister };
if (false) {
    /**
     * @type {?}
     * @private
     */
    CloudprintFunctionRegister.prototype.httpoptions;
    /**
     * @type {?}
     * @private
     */
    CloudprintFunctionRegister.prototype.http;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2xvdWRwcmludC5mdW5jdGlvbi5yZWdpc3Rlci5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0Bnc3Atc3ZjL2Nsb3VkcHJpbnQvIiwic291cmNlcyI6WyJsaWIvZnVuY3Rpb25zL2Nsb3VkcHJpbnQuZnVuY3Rpb24ucmVnaXN0ZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDM0MsT0FBTyxFQUFFLDJCQUEyQixFQUFFLE1BQU0sbUNBQW1DLENBQUM7QUFDaEYsT0FBTyxFQUFFLHNCQUFzQixFQUFFLE1BQU0sOEJBQThCLENBQUM7QUFDdEUsT0FBTyxFQUFFLE9BQU8sRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUMvQixPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFDbEQsT0FBTyxFQUFFLHVCQUF1QixFQUFFLE1BQU0sK0JBQStCLENBQUM7QUFNeEU7SUFLRSxvQ0FBb0IsSUFBZ0I7UUFBaEIsU0FBSSxHQUFKLElBQUksQ0FBWTtRQUY1QixnQkFBVyxHQUFHLEVBQUUsQ0FBQztRQUd2QixJQUFJLENBQUMsV0FBVyxDQUFDLFNBQVMsQ0FBQyxHQUFHO1lBQzVCLFNBQVMsRUFBQyxFQUFFO1lBQ1osY0FBYyxFQUFDLGtCQUFrQjtTQUNsQyxDQUFDO0lBQ0osQ0FBQztJQUVEOztPQUVHOzs7Ozs7SUFDSSx1REFBa0I7Ozs7O0lBQXpCLFVBQTBCLFNBQVM7UUFBbkMsaUJBOEdDOzs7WUEzR08sS0FBSyxHQUFHLElBQUksMkJBQTJCLEVBQUU7OztZQUV6QyxVQUFVLEdBQUcsSUFBSSxzQkFBc0IsRUFBRTs7O1lBRXpDLFdBQVcsR0FBRyxJQUFJLHVCQUF1QixFQUFFO1FBRWpELHFCQUFxQjtRQUNyQixJQUFJLFVBQVUsQ0FBQyxNQUFNLENBQUMsVUFBVSxDQUFDLFlBQVksQ0FBQyxZQUFZLENBQUMsVUFBVSxDQUFDLENBQUMsTUFBTSxLQUFLLENBQUMsRUFBRTtZ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QUFFLENBQUM7WUFDSixJQUFJLENBQUMsZ0JBQWdCLENBQUMsQ0FBQyxFQUFFLElBQUksQ0FBQyxDQUFDO1NBQ2hDO1FBQ0QsT0FBTyxNQUFNLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUNyQyxDQUFDOztnQkEvSUYsVUFBVTs7OztnQkFQRixVQUFVOztJQXdKbkIsaUNBQUM7Q0FBQSxBQWpKRCxJQWlKQztTQWhKWSwwQkFBMEI7Ozs7OztJQUVyQyxpREFBeUI7Ozs7O0lBRWIsMENBQXdCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBQcmludEZ1bmN0aW9uc09mRmlsdGVydmFsdWUgfSBmcm9tICcuL2Nsb3VkcHJpbnQuZnVuY3Rpb24uZmlsdGVydmFsdWUnO1xyXG5pbXBvcnQgeyBQcmludEZ1bmN0aW9uc09mRm9ybWF0IH0gZnJvbSAnLi9jbG91ZHByaW50LmZ1bmN0aW9uLmZvcm1hdCc7XHJcbmltcG9ydCB7IFN1YmplY3QgfSBmcm9tICdyeGpzJztcclxuaW1wb3J0IHsgSHR0cENsaWVudCB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbi9odHRwJztcclxuaW1wb3J0IHsgUHJpbnRGdW5jdGlvbnNPZkNvbnZlcnQgfSBmcm9tICcuL2Nsb3VkcHJpbnQuZnVuY3Rpb24uY29udmVydCc7XHJcblxyXG5cclxuLy8g5byV5YWlU3RpbXVsc29mdOeahGpz5bqTXHJcbmRlY2xhcmUgdmFyIFN0aW11bHNvZnQ7XHJcblxyXG5ASW5qZWN0YWJsZSgpXHJcbmV4cG9ydCBjbGFzcyBDbG91ZHByaW50RnVuY3Rpb25SZWdpc3RlciB7XHJcblxyXG4gIHByaXZhdGUgaHR0cG9wdGlvbnMgPSB7fTtcclxuXHJcbiAgY29uc3RydWN0b3IocHJpdmF0ZSBodHRwOiBIdHRwQ2xpZW50KSB7IFxyXG4gICAgdGhpcy5odHRwb3B0aW9uc1snaGVhZGVycyddID0ge1xyXG4gICAgICBTZXNzaW9uSWQ6JycsXHJcbiAgICAgICdDb250ZW50LVR5cGUnOidhcHBsaWNhdGlvbi9qc29uJ1xyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOWIneWni+WMluiHquWumuS5ieWHveaVsFxyXG4gICAqL1xyXG4gIHB1YmxpYyBpbml0Q3VzdG9tRnVuY3Rpb24oY29uZmlnVXJsKSB7XHJcblxyXG4gICAgLy8g5YaF572u5Ye95pWwLeaVsOWAvOi/h+a7pFxyXG4gICAgY29uc3QgZnVuY3MgPSBuZXcgUHJpbnRGdW5jdGlvbnNPZkZpbHRlcnZhbHVlKCk7XHJcbiAgICAvLyDlhoXnva7lh73mlbAt5qC85byP5YyWXHJcbiAgICBjb25zdCBmdW5jRm9ybWF0ID0gbmV3IFByaW50RnVuY3Rpb25zT2ZGb3JtYXQoKTtcclxuICAgIC8vIOWGhee9ruWHveaVsC3moLzlvI/ljJZcclxuICAgIGNvbnN0IGZ1bmNDb252ZXJ0ID0gbmV3IFByaW50RnVuY3Rpb25zT2ZDb252ZXJ0KCk7XHJcblxyXG4gICAgLy8g6L+Z6YeM6buY6K6k55qER1NQ5YaF572u5Ye95pWw5YiG57uE5Li6R1NQXHJcbiAgICBpZiAoU3RpbXVsc29mdC5SZXBvcnQuRGljdGlvbmFyeS5TdGlGdW5jdGlvbnMuZ2V0RnVuY3Rpb25zKCdJR2l4RnVjcycpLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpmb3JpblxyXG4gICAgICAgIGZvciAoY29uc3QgZiBpbiBmdW5jcykge1xyXG4gICAgICAgICAgICBjb25zdCBmdW5jID0gZnVuY3NbZl07XHJcbiAgICAgICAgICAgIFN0aW11bHNvZnQuUmVwb3J0LkRpY3Rpb25hcnkuU3RpRnVuY3Rpb25zLmFkZEZ1bmN0aW9uKFxyXG4gICAgICAgICAgICAgIGZ1bmMuQ2F0ZWdvcnksXHJcbiAgICAgICAgICAgICAgZnVuYy5Hcm91cEZ1bmN0aW9uTmFtZSxcclxuICAgICAgICAgICAgICBmdW5jLkZ1bmN0aW9uTmFtZSxcclxuICAgICAgICAgICAgICBmdW5jLkRlc2NyaXB0aW9uLFxyXG4gICAgICAgICAgICAgIGZ1bmMuVHlwZU9mRnVuY3Rpb24sXHJcbiAgICAgICAgICAgICAgZnVuYy5SZXR1cm5UeXBlLFxyXG4gICAgICAgICAgICAgIGZ1bmMuUmV0dXJuRGVzY3JpcHRpb24sXHJcbiAgICAgICAgICAgICAgZnVuYy5Bcmd1bWVudFR5cGVzLFxyXG4gICAgICAgICAgICAgIGZ1bmMuQXJndW1lbnROYW1lcyxcclxuICAgICAgICAgICAgICBmdW5jLkFyZ3VtZW50RGVzY3JpcHRpb25zLFxyXG4gICAgICAgICAgICAgIGZ1bmMuRnVuY3Rpb25cclxuICAgICAgICAgICAgICApO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOmZvcmluXHJcbiAgICAgICAgZm9yIChjb25zdCBmIGluIGZ1bmNGb3JtYXQpIHtcclxuICAgICAgICAgIGNvbnN0IGZ1bmMgPSBmdW5jRm9ybWF0W2ZdO1xyXG4gICAgICAgICAgU3RpbXVsc29mdC5SZXBvcnQuRGljdGlvbmFyeS5TdGlGdW5jdGlvbnMuYWRkRnVuY3Rpb24oXHJcbiAgICAgICAgICAgIGZ1bmMuQ2F0ZWdvcnksXHJcbiAgICAgICAgICAgIGZ1bmMuR3JvdXBGdW5jdGlvbk5hbWUsXHJcbiAgICAgICAgICAgIGZ1bmMuRnVuY3Rpb25OYW1lLFxyXG4gICAgICAgICAgICBmdW5jLkRlc2NyaXB0aW9uLFxyXG4gICAgICAgICAgICBmdW5jLlR5cGVPZkZ1bmN0aW9uLFxyXG4gICAgICAgICAgICBmdW5jLlJldHVyblR5cGUsXHJcbiAgICAgICAgICAgIGZ1bmMuUmV0dXJuRGVzY3JpcHRpb24sXHJcbiAgICAgICAgICAgIGZ1bmMuQXJndW1lbnRUeXBlcyxcclxuICAgICAgICAgICAgZnVuYy5Bcmd1bWVudE5hbWVzLFxyXG4gICAgICAgICAgICBmdW5jLkFyZ3VtZW50RGVzY3JpcHRpb25zLFxyXG4gICAgICAgICAgICBmdW5jLkZ1bmN0aW9uKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpmb3JpblxyXG4gICAgICAgIGZvciAoY29uc3QgZiBpbiBmdW5jQ29udmVydCkge1xyXG4gICAgICAgICAgY29uc3QgZnVuYyA9IGZ1bmNDb252ZXJ0W2ZdO1xyXG4gICAgICAgICAgU3RpbXVsc29mdC5SZXBvcnQuRGljdGlvbmFyeS5TdGlGdW5jdGlvbnMuYWRkRnVuY3Rpb24oXHJcbiAgICAgICAgICAgIGZ1bmMuQ2F0ZWdvcnksXHJcbiAgICAgICAgICAgIGZ1bmMuR3JvdXBGdW5jdGlvbk5hbWUsXHJcbiAgICAgICAgICAgIGZ1bmMuRnVuY3Rpb25OYW1lLFxyXG4gICAgICAgICAgICBmdW5jLkRlc2NyaXB0aW9uLFxyXG4gICAgICAgICAgICBmdW5jLlR5cGVPZkZ1bmN0aW9uLFxyXG4gICAgICAgICAgICBmdW5jLlJldHVyblR5cGUsXHJcbiAgICAgICAgICAgIGZ1bmMuUmV0dXJuRGVzY3JpcHRpb24sXHJcbiAgICAgICAgICAgIGZ1bmMuQXJndW1lbnRUeXBlcyxcclxuICAgICAgICAgICAgZnVuYy5Bcmd1bWVudE5hbWVzLFxyXG4gICAgICAgICAgICBmdW5jLkFyZ3VtZW50RGVzY3JpcHRpb25zLFxyXG4gICAgICAgICAgICBmdW5jLkZ1bmN0aW9uKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG5cclxuICAgIC8vIOiHquWumuS5ieWHveaVsHRvZG865pyA57uI6Ieq5a6a5LmJ5Ye95pWw5LuO5ZCO5Y+w5Y+W6YWN572u5paH5Lu26YeM55qE6Kej5p6QXHJcbiAgICByZXR1cm4gdGhpcy5odHRwLmdldChjb25maWdVcmwsdGhpcy5odHRwb3B0aW9ucykudG9Qcm9taXNlKClcclxuICAgIC50aGVuKChkYXRhOltdKSA9PiB7XHJcbiAgICAgIGlmKGRhdGEgJiYgZGF0YS5sZW5ndGg+MCl7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuYWRkSnNGdW5jUGx1Z2lucygtMSwgZGF0YSlcclxuICAgICAgICAudGhlbigoKSA9PiB7XHJcbiAgICAgICAgICBpZiAoIWRhdGEpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgY29uc3QgYWxsRnVuY3MgPSBbXTtcclxuICAgICAgICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpmb3JpblxyXG4gICAgICAgICAgaWYoZGF0YS5sZW5ndGg+MCl7XHJcbiAgICAgICAgICAgIGZvciAoY29uc3QgaSBpbiBkYXRhKSB7XHJcbiAgICAgICAgICAgICAgYWxsRnVuY3MucHVzaCh3aW5kb3dbKGRhdGFbaV0gYXMgYW55KS5rZXldKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfVxyXG5cclxuICBcclxuICAgICAgICAgIFxyXG4gICAgICAgICAgaWYgKFN0aW11bHNvZnQuUmVwb3J0LkRpY3Rpb25hcnkuU3RpRnVuY3Rpb25zLmdldEZ1bmN0aW9ucygnQ3VzdG9tRnVjcycpLmxlbmd0aCA9PT0gMCAmJiBhbGxGdW5jcy5sZW5ndGg+MCkge1xyXG4gICAgICAgICAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6Zm9yaW5cclxuICAgICAgICAgICAgZm9yIChjb25zdCBmIGluIGFsbEZ1bmNzKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBpdGVtID0gYWxsRnVuY3NbZl07XHJcbiAgICAgICAgICAgICAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6Zm9yaW5cclxuICAgICAgICAgICAgICAgIGZvciAoY29uc3QgZjIgaW4gaXRlbSkge1xyXG4gICAgICAgICAgICAgICAgICBjb25zdCBmdW5jID0gaXRlbVtmMl07XHJcbiAgICAgICAgICAgICAgICAgIFN0aW11bHNvZnQuUmVwb3J0LkRpY3Rpb25hcnkuU3RpRnVuY3Rpb25zLmFkZEZ1bmN0aW9uKFxyXG4gICAgICAgICAgICAgICAgICAgICdDdXN0b21GdWNzJyxcclxuICAgICAgICAgICAgICAgICAgICBmdW5jLkdyb3VwRnVuY3Rpb25OYW1lLFxyXG4gICAgICAgICAgICAgICAgICAgIGZ1bmMuRnVuY3Rpb25OYW1lLFxyXG4gICAgICAgICAgICAgICAgICAgIGZ1bmMuRGVzY3JpcHRpb24sXHJcbiAgICAgICAgICAgICAgICAgICAgZnVuYy5UeXBlT2ZGdW5jdGlvbixcclxuICAgICAgICAgICAgICAgICAgICBmdW5jLlJldHVyblR5cGUsXHJcbiAgICAgICAgICAgICAgICAgICAgZnVuYy5SZXR1cm5EZXNjcmlwdGlvbixcclxuICAgICAgICAgICAgICAgICAgICBmdW5jLkFyZ3VtZW50VHlwZXMsXHJcbiAgICAgICAgICAgICAgICAgICAgZnVuYy5Bcmd1bWVudE5hbWVzLFxyXG4gICAgICAgICAgICAgICAgICAgIGZ1bmMuQXJndW1lbnREZXNjcmlwdGlvbnMsXHJcbiAgICAgICAgICAgICAgICAgICAgZnVuYy5GdW5jdGlvbik7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH1cclxuXHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOa3u+WKoGpz5Lia5Yqh5Ye95pWw5o+S5Lu2XHJcbiAgICovXHJcbiAgcHJpdmF0ZSBhZGRKc0Z1bmNQbHVnaW5zKGksIGRhdGEpIHtcclxuICAgIGlmICghZGF0YSAmJiBkYXRhLmxlbmd0aD09MCkge1xyXG4gICAgICBjb25zdCBzdWIgPSBuZXcgU3ViamVjdDxhbnk+KCk7XHJcbiAgICAgIHN1Yi5jb21wbGV0ZSgpOyAvLyDmsqHmnInov5nlj6Xor510b1Byb21pc2UoKemHjOeahOWGheWuueS4jei3kVxyXG4gICAgICByZXR1cm4gc3ViLnRvUHJvbWlzZSgpO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IGxvYWRlciA9IHdpbmRvd1snU3lzdGVtJ107XHJcbiAgICBpZiAoaSA8IGRhdGEubGVuZ3RoIC0gMSkge1xyXG4gICAgICBpKys7XHJcbiAgICAgIHRoaXMuYWRkSnNGdW5jUGx1Z2lucyhpLCBkYXRhKTtcclxuICAgIH1cclxuICAgIHJldHVybiBsb2FkZXIuaW1wb3J0KGRhdGFbaV0ucGF0aCk7XHJcbiAgfVxyXG5cclxufVxyXG4iXX0=
/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input, Inject, forwardRef, ElementRef } from '@angular/core';
import { CloudprintviewerService } from './cloudprint-viewer.service';
import { PrintEntity } from '../entitys/printEntity';
import { NotifyService } from '@farris/ui-notify';
import { Utils } from '../utils/cloudprint.utils';
import { CloudprintFunctionRegister } from '../functions/cloudprint.function.register';
import { PrintFormatService } from '../services/printFormatService';
import { LanguageService } from '@ecp-caf/caf-common';
import { OutputParam } from '../entitys/outputoptions/outputParam';
import { CloudprintService } from '../cloudprint.service';
import { LoadingService } from '@farris/ui-loading';
export class CloudprintViewerComponent {
    // private server: CloudprintviewerService,
    /**
     * @param {?} server
     * @param {?} formatSrv
     * @param {?} notifyService
     * @param {?} functionRegister
     * @param {?} langservice
     * @param {?} loadSrv
     * @param {?} elementRef
     * @param {?} printSrv
     */
    constructor(server, formatSrv, notifyService, functionRegister, langservice, loadSrv, elementRef, printSrv) {
        this.server = server;
        this.formatSrv = formatSrv;
        this.notifyService = notifyService;
        this.functionRegister = functionRegister;
        this.langservice = langservice;
        this.loadSrv = loadSrv;
        this.elementRef = elementRef;
        this.printSrv = printSrv;
        /**
         * 打印参数实体
         */
        this.printEntity = new PrintEntity();
        Stimulsoft.Base.StiLicense.key = '6vJhGtLLLz2GNviWmUTrhSqnOItdDwjBylQzQcAOiHmUA7xxS8GDDAme3ObyU+jZAO9YGs0yUwkFhPz4MWHZaEdiyH' +
            'ffzbOBGSAkqiNry5YZGU/0ZeiKWcHEB38tgR/zaXp8v+ktUiBOl5B2Dll4y33a3osXfKmsg7lHgK/JYlcS08G7Nggu' +
            'H8vVnzvNulyD1uv6QdfRDQOP/FfeKHq3M70ZPvUspYpkCzGqP4nJJ5ktST13+f3E90Y0n1BkbAbYCI3JqheM988LYP' +
            '2lmJ5mAzuV5t3ILzfUehp6/HIy8LPbzzVlU22X9I1t2xY6W1qsi/pKaXeAfJ0T5x/CUbywJ9JyKaTMwIUhDqUVIrle' +
            'QbFvNFUrLznXCcd55QNngQjoC6Wx9CZ9ryjdPdp0dMfCC0exZXtQW0IR+lWjD9pdUkYPJWn5eACs0ToahpEvdwlW76' +
            'eL5ufNRT6xYjBqlGQ/9VuV5LD9EROLqHxpucBoNPLl7s8ealNcm5seZjuR1iSiOPcqd05m3ellOoxBzSLWaB/sNMWT' +
            'AOhBIWNv7dPOcq8KuAfwaJCkV3WTbQAhX2XJ';
        this.printEntity.isUseMetaData = true;
        this.formatSrv.printEntity = this.printEntity;
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.docTitle = document.title;
        // 初始化Viewer;
        this.initViewer();
        console.log('组件初始：加载预览器成功');
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        this.printEntity.onExitEvent.emit();
        console.log('组件销毁');
    }
    /**
     * 设置PrintEntity参数
     * \@description 如果外界new新的PrintEntity，则需要调用该方法同步service的entity
     *              外界没有new新的PrintEntity，则不需要调用该方法
     *
     * 如下代码是cloudprint.service.ts里的代码，在cloudprint.service.ts有新的printEntity，
     *           所以需要调用setPrintEntity来同步
     *           this.designercomponentRef.instance.setPrintEntity(this.printEntity)
     *
     * @param {?} entity
     * @return {?}
     */
    setPrintEntity(entity) {
        this.printEntity = entity;
        // this.server.printEntity = this.printEntity;
        this.formatSrv.printEntity = this.printEntity;
    }
    /**
     * 初始化Viewer
     * @private
     * @return {?}
     */
    initViewer() {
        // 加载数据
        /** @type {?} */
        const self = this;
        document.title = this.docTitle;
        this.loadSrv.show({
            message: 'loading...',
        });
        // 如果是后端渲染的合适，则前台直接使用
        /** @type {?} */
        const rendedFormat = this.printEntity.rendedFormat;
        /** @type {?} */
        const ret = this.renderPdf(rendedFormat);
        if (ret && ret.then) {
            ret.then((/**
             * @return {?}
             */
            () => {
                this.loadSrv.close();
            }));
        }
        else {
            this.loadSrv.close();
        }
    }
    /**
     * @private
     * @param {?} rendedFormat
     * @return {?}
     */
    renderPdf(rendedFormat) {
        /** @type {?} */
        const self = this;
        if (rendedFormat) { //有渲染的结果则直接展示
            //有渲染的结果则直接展示
            /** @type {?} */
            const ele = document.getElementById('viewer');
            // ele.hidden = true;
            Utils.renderPdfByByte(rendedFormat, ele);
        }
        else { //没有渲染的结果则通过后端渲染后展示
            this.outputParam.prnOutputOps.printJob = false;
            if (this.outputParam.prnSourceOptions.length > 1) {
                if (this.outputParam.isFilter) {
                    return this.formatSrv.printMultiByFilter((/** @type {?} */ (this.outputParam.prnSourceOptions)), this.outputParam.prnOutputOps, null, 'CloudPrint')
                        .then((/**
                     * @param {?} data
                     * @return {?}
                     */
                    (data) => {
                        /** @type {?} */
                        const b = new Blob([data]);
                        /** @type {?} */
                        const reader = new FileReader();
                        reader.readAsArrayBuffer(b);
                        reader.onload = (/**
                         * @param {?} e
                         * @return {?}
                         */
                        function (e) {
                            self.renderPdf((/** @type {?} */ (reader.result)));
                        });
                    }));
                }
                else {
                    return this.formatSrv.printMultiById((/** @type {?} */ (this.outputParam.prnSourceOptions)), this.outputParam.prnOutputOps, null, 'CloudPrint')
                        .then((/**
                     * @param {?} data
                     * @return {?}
                     */
                    (data) => {
                        /** @type {?} */
                        const b = new Blob([data]);
                        /** @type {?} */
                        const reader = new FileReader();
                        reader.readAsArrayBuffer(b);
                        reader.onload = (/**
                         * @param {?} e
                         * @return {?}
                         */
                        function (e) {
                            self.renderPdf((/** @type {?} */ (reader.result)));
                        });
                    }));
                }
            }
            else {
                if (this.outputParam.isFilter) {
                    return this.formatSrv.printSingleByFilter((/** @type {?} */ (this.outputParam.prnSourceOptions[0])), this.outputParam.prnOutputOps, null, 'CloudPrint')
                        .then((/**
                     * @param {?} data
                     * @return {?}
                     */
                    (data) => {
                        /** @type {?} */
                        const b = new Blob([data]);
                        /** @type {?} */
                        const reader = new FileReader();
                        reader.readAsArrayBuffer(b);
                        reader.onload = (/**
                         * @param {?} e
                         * @return {?}
                         */
                        function (e) {
                            self.renderPdf((/** @type {?} */ (reader.result)));
                        });
                    }));
                }
                else {
                    return this.formatSrv.printSingleById((/** @type {?} */ (this.outputParam.prnSourceOptions[0])), this.outputParam.prnOutputOps, null, 'CloudPrint')
                        .then((/**
                     * @param {?} data
                     * @return {?}
                     */
                    (data) => {
                        /** @type {?} */
                        const b = new Blob([data]);
                        /** @type {?} */
                        const reader = new FileReader();
                        reader.readAsArrayBuffer(b);
                        reader.onload = (/**
                         * @param {?} e
                         * @return {?}
                         */
                        function (e) {
                            self.renderPdf((/** @type {?} */ (reader.result)));
                        });
                    }));
                }
            }
        }
    }
    /**
     * 直接打印
     * @return {?}
     */
    printDirect() {
        /** @type {?} */
        const ele = document.getElementById('viewer');
        /** @type {?} */
        const iframe = (/** @type {?} */ (ele.firstChild));
        iframe.contentWindow.print();
        /** @type {?} */
        const sourceopslist = this.outputParam.prnSourceOptions;
        /** @type {?} */
        let su = [];
        /** @type {?} */
        let id = [];
        /** @type {?} */
        let billcate = [];
        /** @type {?} */
        let biztype = [];
        /** @type {?} */
        let source = [];
        /** @type {?} */
        let entityfilter = [];
        /** @type {?} */
        let dataid = [];
        /** @type {?} */
        let isfilter = [];
        sourceopslist.forEach((/**
         * @param {?} x
         * @return {?}
         */
        x => {
            su.push(x.ServiceUnit);
            id.push(x.FormatId);
            source.push(x.SourceId);
            isfilter.push(this.outputParam.isFilter);
            if (this.outputParam.isFilter) {
                entityfilter.push(JSON.stringify(((/** @type {?} */ (x))).EntityFilter));
            }
            else {
                dataid.push(((/** @type {?} */ (x))).DataIds);
            }
            billcate.push(x.billCategoryId);
            biztype.push(x.bizTypeId);
        }));
        /** @type {?} */
        const data = {
            formatid: id,
            sourceid: source,
            entityfilter: entityfilter,
            dataid: dataid,
            isfilter: isfilter,
            su: su,
            billcategory: billcate,
            biztype: biztype
        };
        this.formatSrv.sendPrintEvent(data, "CloudPrint");
    }
    /**
     * 盒子后台打印
     * @return {?}
     */
    printBox() {
        /** @type {?} */
        const self = this;
        self.outputParam.prnOutputOps.printJob = true;
        if (self.outputParam.prnSourceOptions.length > 1) {
            if (self.outputParam.isFilter) {
                return self.printSrv.printMultiByFilter4Job((/** @type {?} */ (self.outputParam.prnSourceOptions)), self.outputParam.prnOutputOps);
            }
            else {
                return self.printSrv.printMultiById4Job((/** @type {?} */ (self.outputParam.prnSourceOptions)), self.outputParam.prnOutputOps);
            }
        }
        else {
            if (self.outputParam.isFilter) {
                return self.printSrv.printSingleByFilter4Job((/** @type {?} */ (self.outputParam.prnSourceOptions[0])), self.outputParam.prnOutputOps);
            }
            else {
                return self.printSrv.printSingleById4Job((/** @type {?} */ (self.outputParam.prnSourceOptions[0])), self.outputParam.prnOutputOps);
            }
        }
    }
}
CloudprintViewerComponent.decorators = [
    { type: Component, args: [{
                selector: 'app-cloudprint-viewer',
                template: "<!-- <div class=\"f-page f-page-navigate f-page-is-grid-grid\">\r\n    <div class=\"f-page-header\">\r\n        <nav class=\"f-page-header-base\">    \r\n            <div class=\"f-title\">\r\n                <span class=\"f-title-icon f-text-orna-bill\">\r\n                    <i class=\"f-icon f-icon-page-title-administer\"></i>\r\n                </span>\r\n                <h4 class=\"farris-form-title mr-auto\">\u6253\u5370\u9884\u89C8</h4>\r\n            </div>\r\n            <f-response-toolbar\r\n                class=\"col-7 f-toolbar\"\r\n                [datas]=\"toolbarData\"\r\n                (rtClickEvent)=\"responseToolbarClick($event)\">\r\n            </f-response-toolbar>\r\n        </nav>\r\n    </div>\r\n    \r\n    <section class=\"f-page-main\">\r\n        <div style=\"overflow:auto;height: 100%;width: 100%\">\r\n            <div id=\"viewer\"  style=\"height:100%\"></div>\r\n        </div>\r\n    </section>    \r\n</div> -->\r\n\r\n<div class=\"f-page f-page-is-managelist\">\r\n    <div class=\"f-page-main\">\r\n      <farris-section class=\"f-section-grid f-section-in-managelist\" [showHeader]=\"false\">\r\n        <div class=\"f-section-header\" style=\"padding: 0px;margin: 0px\">\r\n          <div class=\"f-title\">\r\n            <h5 class=\"f-title__title\">{{'printview' | locale}}</h5>\r\n          </div>\r\n          <div class=\"f-toolbar\">\r\n            <div id=\"operate\" style=\"text-align: right;padding: 10px;min-width: 300px;\">\r\n                <farris-button style=\"padding: 3px\" (click)=\"printDirect()\">\r\n                    <span>{{'PrintWithoutPreview' | locale}}</span>\r\n                </farris-button>\r\n                <farris-button *ngIf=\"isRemotePrint\" [type]=\"'secondary'\" style=\"padding: 3px\" (click)=\"printBox()\">\r\n                    <span>{{'PrintWithBox' | locale}}</span>\r\n                </farris-button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n  \r\n        <div class=\"f-section-content\">\r\n          <div class=\"f-component-grid\">\r\n            <div style=\"overflow:auto;height: 100%;width: 100%\">\r\n                <div id=\"viewer\"  style=\"height:100%\"></div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </farris-section>\r\n    </div>\r\n  </div>\r\n\r\n",
                styles: [""]
            }] }
];
/** @nocollapse */
CloudprintViewerComponent.ctorParameters = () => [
    { type: CloudprintviewerService },
    { type: PrintFormatService },
    { type: NotifyService },
    { type: CloudprintFunctionRegister },
    { type: LanguageService },
    { type: LoadingService },
    { type: ElementRef },
    { type: CloudprintService, decorators: [{ type: Inject, args: [forwardRef((/**
                     * @return {?}
                     */
                    () => CloudprintService)),] }] }
];
CloudprintViewerComponent.propDecorators = {
    outputParam: [{ type: Input }],
    isRemotePrint: [{ type: Input }]
};
if (false) {
    /** @type {?} */
    CloudprintViewerComponent.prototype.outputParam;
    /** @type {?} */
    CloudprintViewerComponent.prototype.isRemotePrint;
    /**
     * 预览器对象
     * @type {?}
     * @private
     */
    CloudprintViewerComponent.prototype.viewer;
    /** @type {?} */
    CloudprintViewerComponent.prototype.localpipe;
    /**
     * @type {?}
     * @private
     */
    CloudprintViewerComponent.prototype.docTitle;
    /**
     * 打印参数实体
     * @type {?}
     */
    CloudprintViewerComponent.prototype.printEntity;
    /**
     * @type {?}
     * @private
     */
    CloudprintViewerComponent.prototype.server;
    /**
     * @type {?}
     * @private
     */
    CloudprintViewerComponent.prototype.formatSrv;
    /**
     * @type {?}
     * @private
     */
    CloudprintViewerComponent.prototype.notifyService;
    /**
     * @type {?}
     * @private
     */
    CloudprintViewerComponent.prototype.functionRegister;
    /**
     * @type {?}
     * @private
     */
    CloudprintViewerComponent.prototype.langservice;
    /**
     * @type {?}
     * @private
     */
    CloudprintViewerComponent.prototype.loadSrv;
    /**
     * @type {?}
     * @private
     */
    CloudprintViewerComponent.prototype.elementRef;
    /**
     * @type {?}
     * @private
     */
    CloudprintViewerComponent.prototype.printSrv;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2xvdWRwcmludC12aWV3ZXIuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGdzcC1zdmMvY2xvdWRwcmludC8iLCJzb3VyY2VzIjpbImxpYi9jbG91ZHByaW50LXZpZXdlci9jbG91ZHByaW50LXZpZXdlci5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQXFCLEtBQUssRUFBRSxNQUFNLEVBQUUsVUFBVSxFQUFFLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUNwRyxPQUFPLEVBQUUsdUJBQXVCLEVBQUUsTUFBTSw2QkFBNkIsQ0FBQztBQUN0RSxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sd0JBQXdCLENBQUM7QUFDckQsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBQ2xELE9BQU8sRUFBRSxLQUFLLEVBQUUsTUFBTSwyQkFBMkIsQ0FBQztBQUNsRCxPQUFPLEVBQUUsMEJBQTBCLEVBQUUsTUFBTSwyQ0FBMkMsQ0FBQztBQUV2RixPQUFPLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSxnQ0FBZ0MsQ0FBQztBQUNwRSxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFFdEQsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLHNDQUFzQyxDQUFDO0FBRW5FLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLHVCQUF1QixDQUFDO0FBQzFELE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQztBQWdCcEQsTUFBTSxPQUFPLHlCQUF5Qjs7Ozs7Ozs7Ozs7O0lBY3BDLFlBQW9CLE1BQStCLEVBQy9CLFNBQTZCLEVBQzdCLGFBQTRCLEVBQzVCLGdCQUE0QyxFQUM1QyxXQUEyQixFQUMzQixPQUF1QixFQUN2QixVQUFzQixFQUVzQixRQUEyQjtRQVJ2RSxXQUFNLEdBQU4sTUFBTSxDQUF5QjtRQUMvQixjQUFTLEdBQVQsU0FBUyxDQUFvQjtR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LFFBQVEsQ0FBQyx1QkFBdUIsQ0FBQyxtQkFBQSxJQUFJLENBQUMsV0FBVyxDQUFDLGdCQUFnQixDQUFDLENBQUMsQ0FBQyxFQUF1QixFQUFFLElBQUksQ0FBQyxXQUFXLENBQUMsWUFBWSxDQUFDLENBQUM7YUFDMUk7aUJBQU07Z0JBQ0wsT0FBTyxJQUFJLENBQUMsUUFBUSxDQUFDLG1CQUFtQixDQUFDLG1CQUFBLElBQUksQ0FBQyxXQUFXLENBQUMsZ0JBQWdCLENBQUMsQ0FBQyxDQUFDLEVBQWlCLEVBQUUsSUFBSSxDQUFDLFdBQVcsQ0FBQyxZQUFZLENBQUMsQ0FBQzthQUNoSTtTQUNGO0lBQ0gsQ0FBQzs7O1lBeE5GLFNBQVMsU0FBQztnQkFDVCxRQUFRLEVBQUUsdUJBQXVCO2dCQUNqQyxpeUVBQWlEOzthQU9sRDs7OztZQTNCUSx1QkFBdUI7WUFNdkIsa0JBQWtCO1lBSmxCLGFBQWE7WUFFYiwwQkFBMEI7WUFHMUIsZUFBZTtZQUtmLGNBQWM7WUFiMkMsVUFBVTtZQVluRSxpQkFBaUIsdUJBdUNYLE1BQU0sU0FBQyxVQUFVOzs7b0JBQUMsR0FBRyxFQUFFLENBQUMsaUJBQWlCLEVBQUM7OzswQkFwQnRELEtBQUs7NEJBQ0wsS0FBSzs7OztJQUROLGdEQUEwQzs7SUFDMUMsa0RBQW1DOzs7Ozs7SUFHbkMsMkNBQW9COztJQUNwQiw4Q0FBeUI7Ozs7O0lBRXpCLDZDQUF5Qjs7Ozs7SUFFekIsZ0RBQWdDOzs7OztJQUdwQiwyQ0FBdUM7Ozs7O0lBQ3ZDLDhDQUFxQzs7Ozs7SUFDckMsa0RBQW9DOzs7OztJQUNwQyxxREFBb0Q7Ozs7O0lBQ3BELGdEQUFtQzs7Ozs7SUFDbkMsNENBQStCOzs7OztJQUMvQiwrQ0FBOEI7Ozs7O0lBRTlCLDZDQUErRSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgT25Jbml0LCBPbkRlc3Ryb3ksIElucHV0LCBJbmplY3QsIGZvcndhcmRSZWYsIEVsZW1lbnRSZWYgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgQ2xvdWRwcmludHZpZXdlclNlcnZpY2UgfSBmcm9tICcuL2Nsb3VkcHJpbnQtdmlld2VyLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBQcmludEVudGl0eSB9IGZyb20gJy4uL2VudGl0eXMvcHJpbnRFbnRpdHknO1xyXG5pbXBvcnQgeyBOb3RpZnlTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy91aS1ub3RpZnknO1xyXG5pbXBvcnQgeyBVdGlscyB9IGZyb20gJy4uL3V0aWxzL2Nsb3VkcHJpbnQudXRpbHMnO1xyXG5pbXBvcnQgeyBDbG91ZHByaW50RnVuY3Rpb25SZWdpc3RlciB9IGZyb20gJy4uL2Z1bmN0aW9ucy9jbG91ZHByaW50LmZ1bmN0aW9uLnJlZ2lzdGVyJztcclxuaW1wb3J0IHsgVXJscyB9IGZyb20gJy4uL3V0aWxzL2Nsb3VkcHJpbnQuVXJscyc7XHJcbmltcG9ydCB7IFByaW50Rm9ybWF0U2VydmljZSB9IGZyb20gJy4uL3NlcnZpY2VzL3ByaW50Rm9ybWF0U2VydmljZSc7XHJcbmltcG9ydCB7IExhbmd1YWdlU2VydmljZSB9IGZyb20gJ0BlY3AtY2FmL2NhZi1jb21tb24nO1xyXG5pbXBvcnQgeyBTb3VyY2VGaWx0ZXJPcHRpb25zIH0gZnJvbSAnLi4vZW50aXR5cy9kYXRhc291cmNlb3B0aW9ucy9zb3VyY2VGaWx0ZXJPcHRpb25zJztcclxuaW1wb3J0IHsgT3V0cHV0UGFyYW0gfSBmcm9tICcuLi9lbnRpdHlzL291dHB1dG9wdGlvbnMvb3V0cHV0UGFyYW0nO1xyXG5pbXBvcnQgeyBTb3VyY2VPcHRpb25zIH0gZnJvbSAnLi4vZW50aXR5cy9kYXRhc291cmNlb3B0aW9ucy9zb3VyY2VPcHRpb25zJztcclxuaW1wb3J0IHsgQ2xvdWRwcmludFNlcnZpY2UgfSBmcm9tICcuLi9jbG91ZHByaW50LnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBMb2FkaW5nU2VydmljZSB9IGZyb20gJ0BmYXJyaXMvdWktbG9hZGluZyc7XHJcbmltcG9ydCB7IExvY2FsTGFuZ1BpcGUgfSBmcm9tICcuLi9sb2NhbC5waXBlJztcclxuXHJcbi8vIOW8leWFpVN0aW11bHNvZnTnmoRqc+W6k1xyXG5kZWNsYXJlIHZhciBTdGltdWxzb2Z0O1xyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgc2VsZWN0b3I6ICdhcHAtY2xvdWRwcmludC12aWV3ZXInLFxyXG4gIHRlbXBsYXRlVXJsOiAnLi9jbG91ZHByaW50LXZpZXdlci5jb21wb25lbnQuaHRtbCcsXHJcbiAgc3R5bGVVcmxzOiBbJy4vY2xvdWRwcmludC12aWV3ZXIuY29tcG9uZW50LmNzcyddLFxyXG4gIC8vIHByb3ZpZGVyczogW1xyXG4gIC8vICAgQ2xvdWRwcmludHZpZXdlclNlcnZpY2UsXHJcbiAgLy8gICBOb3RpZnlTZXJ2aWNlLFxyXG4gIC8vICAgTGFuZ3VhZ2VTZXJ2aWNlXHJcbiAgLy8gXSxcclxufSlcclxuZXhwb3J0IGNsYXNzIENsb3VkcHJpbnRWaWV3ZXJDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIE9uRGVzdHJveSB7XHJcblxyXG4gIEBJbnB1dCgpIHB1YmxpYyBvdXRwdXRQYXJhbSA6IE91dHB1dFBhcmFtO1xyXG4gIEBJbnB1dCgpIHB1YmxpYyBpc1JlbW90ZVByaW50OiBhbnk7XHJcblxyXG4gIC8qKiDpooTop4jlmajlr7nosaEgKi9cclxuICBwcml2YXRlIHZpZXdlcjogYW55O1xyXG4gIGxvY2FscGlwZTogTG9jYWxMYW5nUGlwZTtcclxuXHJcbiAgcHJpdmF0ZSBkb2NUaXRsZTogc3RyaW5nO1xyXG4gIC8qKiDmiZPljbDlj4LmlbDlrp7kvZMgKi9cclxuICBwcmludEVudGl0eSA9IG5ldyBQcmludEVudGl0eSgpO1xyXG5cclxuICAvLyBwcml2YXRlIHNlcnZlcjogQ2xvdWRwcmludHZpZXdlclNlcnZpY2UsXHJcbiAgY29uc3RydWN0b3IocHJpdmF0ZSBzZXJ2ZXI6IENsb3VkcHJpbnR2aWV3ZXJTZXJ2aWNlLFxyXG4gICAgICAgICAgICAgIHByaXZhdGUgZm9ybWF0U3J2OiBQcmludEZvcm1hdFNlcnZpY2UsXHJcbiAgICAgICAgICAgICAgcHJpdmF0ZSBub3RpZnlTZXJ2aWNlOiBOb3RpZnlTZXJ2aWNlLFxyXG4gICAgICAgICAgICAgIHByaXZhdGUgZnVuY3Rpb25SZWdpc3RlcjogQ2xvdWRwcmludEZ1bmN0aW9uUmVnaXN0ZXIsXHJcbiAgICAgICAgICAgICAgcHJpdmF0ZSBsYW5nc2VydmljZTpMYW5ndWFnZVNlcnZpY2UsXHJcbiAgICAgICAgICAgICAgcHJpdmF0ZSBsb2FkU3J2OiBMb2FkaW5nU2VydmljZSxcclxuICAgICAgICAgICAgICBwcml2YXRlIGVsZW1lbnRSZWY6IEVsZW1lbnRSZWYsXHJcbiAgICAgICAgICAgICAgLy9ASW5qZWN0KGZvcndhcmRSZWYoKCkgPT4gQ2xvdWRwcmludFNlcnZpY2UpKeeahOWOn+WboO+8mmh0dHBzOi8vc3RhY2tvdmVyZmxvdy5jb20vcXVlc3Rpb25zLzM3OTk3ODI0L2V4Y2VwdGlvbi1jYW50LXJlc29sdmUtYWxsLXBhcmFtZXRlcnMjXHJcbiAgICAgICAgICAgICAgQEluamVjdChmb3J3YXJkUmVmKCgpID0+IENsb3VkcHJpbnRTZXJ2aWNlKSlwcml2YXRlIHByaW50U3J2OiBDbG91ZHByaW50U2VydmljZSkge1xyXG5cclxuXHJcbiAgICAgIFN0aW11bHNvZnQuQmFzZS5TdGlMaWNlbnNlLmtleSA9ICc2dkpoR3RMTEx6MkdOdmlXbVVUcmhTcW5PSXRkRHdqQnlsUXpRY0FPaUhtVUE3eHhTOEdEREFtZTNPYnlVK2paQU85WUdzMHlVd2tGaFB6NE1XSFphRWRpeUgnICsgXHJcbiAgICAgICAgJ2ZmemJPQkdTQWtxaU5yeTVZWkdVLzBaZWlLV2NIRUIzOHRnUi96YVhwOHYra3RVaUJPbDVCMkRsbDR5MzNhM29zWGZLbXNnN2xIZ0svSllsY1MwOEc3TmdndScgKyBcclxuICAgICAgICAnSDh2Vm56dk51bHlEMXV2NlFkZlJEUU9QL0ZmZUtIcTNNNzBaUHZVc3BZcGtDekdxUDRuSko1a3RTVDEzK2YzRTkwWTBuMUJrYkFiWUNJM0pxaGVNOTg4TFlQJyArIFxyXG4gICAgICAgICcybG1KNW1BenVWNXQzSUx6ZlVlaHA2L0hJeThMUGJ6elZsVTIyWDlJMXQyeFk2VzFxc2kvcEthWGVBZkowVDV4L0NVYnl3SjlKeUthVE13SVVoRHFVVklybGUnICsgXHJcbiAgICAgICAgJ1FiRnZORlVyTHpuWENjZDU1UU5uZ1Fqb0M2V3g5Q1o5cnlqZFBkcDBkTWZDQzBleFpYdFFXMElSK2xXakQ5cGRVa1lQSlduNWVBQ3MwVG9haHBFdmR3bFc3NicgKyBcclxuICAgICAgICAnZUw1dWZOUlQ2eFlqQnFsR1EvOVZ1VjVMRDlFUk9McUh4cHVjQm9OUExsN3M4ZWFsTmNtNXNlWmp1UjFpU2lPUGNxZDA1bTNlbGxPb3hCelNMV2FCL3NOTVdUJyArIFxyXG4gICAgICAgICdBT2hCSVdOdjdkUE9jcThLdUFmd2FKQ2tWM1dUYlFBaFgyWEonO1xyXG4gICAgICBcclxuICAgICAgdGhpcy5wcmludEVudGl0eS5pc1VzZU1ldGFEYXRhID0gdHJ1ZTtcclxuICAgICAgdGhpcy5mb3JtYXRTcnYucHJpbnRFbnRpdHkgPSB0aGlzLnByaW50RW50aXR5O1xyXG4gIH1cclxuXHJcbiAgbmdPbkluaXQoKSB7XHJcbiAgICB0aGlzLmRvY1RpdGxlID0gZG9jdW1lbnQudGl0bGU7XHJcbiAgICAvLyDliJ3lp4vljJZWaWV3ZXI7XHJcbiAgICB0aGlzLmluaXRWaWV3ZXIoKTtcclxuXHJcbiAgICBjb25zb2xlLmxvZygn57uE5Lu25Yid5aeL77ya5Yqg6L296aKE6KeI5Zmo5oiQ5YqfJyk7XHJcbiAgfVxyXG5cclxuICBuZ09uRGVzdHJveSgpIHtcclxuICAgIHRoaXMucHJpbnRFbnRpdHkub25FeGl0RXZlbnQuZW1pdCgpO1xyXG5cclxuICAgIGNvbnNvbGUubG9nKCfnu4Tku7bplIDmr4EnKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOiuvue9rlByaW50RW50aXR55Y+C5pWwXHJcbiAgICogQGRlc2NyaXB0aW9uIOWmguaenOWklueVjG5ld+aWsOeahFByaW50RW50aXR577yM5YiZ6ZyA6KaB6LCD55So6K+l5pa55rOV5ZCM5q2lc2VydmljZeeahGVudGl0eVxyXG4gICAqICAgICAgICAgICAgICDlpJbnlYzmsqHmnIluZXfmlrDnmoRQcmludEVudGl0ee+8jOWImeS4jemcgOimgeiwg+eUqOivpeaWueazlVxyXG4gICAqXHJcbiAgICog5aaC5LiL5Luj56CB5pivY2xvdWRwcmludC5zZXJ2aWNlLnRz6YeM55qE5Luj56CB77yM5ZyoY2xvdWRwcmludC5zZXJ2aWNlLnRz5pyJ5paw55qEcHJpbnRFbnRpdHnvvIxcclxuICAgKiAgICAgICAgICAg5omA5Lul6ZyA6KaB6LCD55Soc2V0UHJpbnRFbnRpdHnmnaXlkIzmraVcclxuICAgKiAgICAgICAgICAgdGhpcy5kZXNpZ25lcmNvbXBvbmVudFJlZi5pbnN0YW5jZS5zZXRQcmludEVudGl0eSh0aGlzLnByaW50RW50aXR5KVxyXG4gICAqXHJcbiAgICovXHJcbiAgc2V0UHJpbnRFbnRpdHkoZW50aXR5KSB7XHJcbiAgICB0aGlzLnByaW50RW50aXR5ID0gZW50aXR5O1xyXG4gICAgLy8gdGhpcy5zZXJ2ZXIucHJpbnRFbnRpdHkgPSB0aGlzLnByaW50RW50aXR5O1xyXG4gICAgdGhpcy5mb3JtYXRTcnYucHJpbnRFbnRpdHkgPSB0aGlzLnByaW50RW50aXR5O1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5Yid5aeL5YyWVmlld2VyXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBpbml0Vmlld2VyKCk6IHZvaWQge1xyXG4gICAgLy8g5Yqg6L295pWw5o2uXHJcbiAgICBjb25zdCBzZWxmID0gdGhpcztcclxuICAgIGRvY3VtZW50LnRpdGxlID0gdGhpcy5kb2NUaXRsZTtcclxuICAgIHRoaXMubG9hZFNydi5zaG93KHtcclxuICAgICAgbWVzc2FnZTogJ2xvYWRpbmcuLi4nLFxyXG4gICAgfSk7XHJcbiAgICAvLyDlpoLmnpzmmK/lkI7nq6/muLLmn5PnmoTlkIjpgILvvIzliJnliY3lj7Dnm7TmjqXkvb/nlKhcclxuICAgIGNvbnN0IHJlbmRlZEZvcm1hdCA9IHRoaXMucHJpbnRFbnRpdHkucmVuZGVkRm9ybWF0O1xyXG4gICAgY29uc3QgcmV0ID0gdGhpcy5yZW5kZXJQZGYocmVuZGVkRm9ybWF0KTtcclxuICAgIGlmKHJldCAmJiByZXQudGhlbil7XHJcbiAgICAgIHJldC50aGVuKCgpPT57XHJcbiAgICAgICAgdGhpcy5sb2FkU3J2LmNsb3NlKCk7XHJcbiAgICAgIH0pO1xyXG4gICAgfWVsc2V7XHJcbiAgICAgIHRoaXMubG9hZFNydi5jbG9zZSgpO1xyXG4gICAgfVxyXG5cclxuICB9XHJcblxyXG4gIHByaXZhdGUgcmVuZGVyUGRmKHJlbmRlZEZvcm1hdCl7XHJcbiAgICBjb25zdCBzZWxmID0gdGhpcztcclxuXHJcbiAgICBpZiAocmVuZGVkRm9ybWF0KSB7Ly/mnInmuLLmn5PnmoTnu5PmnpzliJnnm7TmjqXlsZXnpLpcclxuICAgICAgY29uc3QgZWxlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3ZpZXdlcicpO1xyXG4gICAgICAvLyBlbGUuaGlkZGVuID0gdHJ1ZTtcclxuICAgICAgVXRpbHMucmVuZGVyUGRmQnlCeXRlKHJlbmRlZEZvcm1hdCxlbGUpO1xyXG5cclxuICAgIH0gZWxzZSB7Ly/msqHmnInmuLLmn5PnmoTnu5PmnpzliJnpgJrov4flkI7nq6/muLLmn5PlkI7lsZXnpLpcclxuICAgICAgdGhpcy5vdXRwdXRQYXJhbS5wcm5PdXRwdXRPcHMucHJpbnRKb2IgPSBmYWxzZTtcclxuICAgICAgaWYgKHRoaXMub3V0cHV0UGFyYW0ucHJuU291cmNlT3B0aW9ucy5sZW5ndGggPiAxKSB7XHJcbiAgICAgICAgaWYgKHRoaXMub3V0cHV0UGFyYW0uaXNGaWx0ZXIpIHtcclxuICAgICAgICAgIHJldHVybiB0aGlzLmZvcm1hdFNydi5wcmludE11bHRpQnlGaWx0ZXIodGhpcy5vdXRwdXRQYXJhbS5wcm5Tb3VyY2VPcHRpb25zIGFzIEFycmF5PFNvdXJjZUZpbHRlck9wdGlvbnM+LCB0aGlzLm91dHB1dFBhcmFtLnBybk91dHB1dE9wcywgbnVsbCwnQ2xvdWRQcmludCcpXHJcbiAgICAgICAgICAudGhlbigoZGF0YSk9PntcclxuICAgICAgICAgICAgY29uc3QgYiA9IG5ldyBCbG9iKFtkYXRhXSk7XHJcbiAgICAgICAgICAgIGNvbnN0IHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7XHJcbiAgICAgICAgICAgIHJlYWRlci5yZWFkQXNBcnJheUJ1ZmZlcihiKTtcclxuICAgICAgICAgICAgcmVhZGVyLm9ubG9hZCA9IGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgICAgICAgICAgc2VsZi5yZW5kZXJQZGYocmVhZGVyLnJlc3VsdCBhcyBhbnkpO1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHJldHVybiB0aGlzLmZvcm1hdFNydi5wcmludE11bHRpQnlJZCh0aGlzLm91dHB1dFBhcmFtLnByblNvdXJjZU9wdGlvbnMgYXMgQXJyYXk8U291cmNlT3B0aW9ucz4sIHRoaXMub3V0cHV0UGFyYW0ucHJuT3V0cHV0T3BzLCBudWxsLCdDbG91ZFByaW50JylcclxuICAgICAgICAgIC50aGVuKChkYXRhKT0+e1xyXG4gICAgICAgICAgICBjb25zdCBiID0gbmV3IEJsb2IoW2RhdGFdKTtcclxuICAgICAgICAgICAgY29uc3QgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTtcclxuICAgICAgICAgICAgcmVhZGVyLnJlYWRBc0FycmF5QnVmZmVyKGIpO1xyXG4gICAgICAgICAgICByZWFkZXIub25sb2FkID0gZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICAgICAgICBzZWxmLnJlbmRlclBkZihyZWFkZXIucmVzdWx0IGFzIGFueSk7XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgaWYgKHRoaXMub3V0cHV0UGFyYW0uaXNGaWx0ZXIpIHtcclxuICAgICAgICAgIHJldHVybiB0aGlzLmZvcm1hdFNydi5wcmludFNpbmdsZUJ5RmlsdGVyKHRoaXMub3V0cHV0UGFyYW0ucHJuU291cmNlT3B0aW9uc1swXSBhcyBTb3VyY2VGaWx0ZXJPcHRpb25zLCB0aGlzLm91dHB1dFBhcmFtLnBybk91dHB1dE9wcywgbnVsbCwnQ2xvdWRQcmludCcpXHJcbiAgICAgICAgICAudGhlbigoZGF0YSk9PntcclxuICAgICAgICAgICAgY29uc3QgYiA9IG5ldyBCbG9iKFtkYXRhXSk7XHJcbiAgICAgICAgICAgIGNvbnN0IHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7XHJcbiAgICAgICAgICAgIHJlYWRlci5yZWFkQXNBcnJheUJ1ZmZlcihiKTtcclxuICAgICAgICAgICAgcmVhZGVyLm9ubG9hZCA9IGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgICAgICAgICAgc2VsZi5yZW5kZXJQZGYocmVhZGVyLnJlc3VsdCBhcyBhbnkpO1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHJldHVybiB0aGlzLmZvcm1hdFNydi5wcmludFNpbmdsZUJ5SWQodGhpcy5vdXRwdXRQYXJhbS5wcm5Tb3VyY2VPcHRpb25zWzBdIGFzIFNvdXJjZU9wdGlvbnMsIHRoaXMub3V0cHV0UGFyYW0ucHJuT3V0cHV0T3BzLCBudWxsLCdDbG91ZFByaW50JylcclxuICAgICAgICAgIC50aGVuKChkYXRhKT0+e1xyXG4gICAgICAgICAgICBjb25zdCBiID0gbmV3IEJsb2IoW2RhdGFdKTtcclxuICAgICAgICAgICAgY29uc3QgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTtcclxuICAgICAgICAgICAgcmVhZGVyLnJlYWRBc0FycmF5QnVmZmVyKGIpO1xyXG4gICAgICAgICAgICByZWFkZXIub25sb2FkID0gZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICAgICAgICBzZWxmLnJlbmRlclBkZihyZWFkZXIucmVzdWx0IGFzIGFueSk7XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKiDnm7TmjqXmiZPljbAgKi9cclxuICBwcmludERpcmVjdCgpe1xyXG4gICAgY29uc3QgZWxlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3ZpZXdlcicpO1xyXG4gICAgY29uc3QgaWZyYW1lID0gZWxlLmZpcnN0Q2hpbGQgYXMgYW55O1xyXG4gICAgaWZyYW1lLmNvbnRlbnRXaW5kb3cucHJpbnQoKTtcclxuXHJcbiAgICBjb25zdCBzb3VyY2VvcHNsaXN0ID0gdGhpcy5vdXRwdXRQYXJhbS5wcm5Tb3VyY2VPcHRpb25zO1xyXG4gICAgbGV0IHN1PVtdO1xyXG4gICAgbGV0IGlkPVtdO1xyXG4gICAgbGV0IGJpbGxjYXRlPVtdO1xyXG4gICAgbGV0IGJpenR5cGU9W107XHJcbiAgICBsZXQgc291cmNlPVtdO1xyXG4gICAgbGV0IGVudGl0eWZpbHRlcj1bXTtcclxuICAgIGxldCBkYXRhaWQ9W107XHJcbiAgICBsZXQgaXNmaWx0ZXI9W107XHJcbiAgICBzb3VyY2VvcHNsaXN0LmZvckVhY2goeD0+e1xyXG4gICAgICBzdS5wdXNoKHguU2VydmljZVVuaXQpO1xyXG4gICAgICBpZC5wdXNoKHguRm9ybWF0SWQpO1xyXG4gICAgICBzb3VyY2UucHVzaCh4LlNvdXJjZUlkKTtcclxuICAgICAgaXNmaWx0ZXIucHVzaCh0aGlzLm91dHB1dFBhcmFtLmlzRmlsdGVyKTtcclxuICAgICAgaWYodGhpcy5vdXRwdXRQYXJhbS5pc0ZpbHRlcil7XHJcbiAgICAgICAgZW50aXR5ZmlsdGVyLnB1c2goSlNPTi5zdHJpbmdpZnkoKHggYXMgU291cmNlRmlsdGVyT3B0aW9ucykuRW50aXR5RmlsdGVyKSk7XHJcbiAgICAgIH1lbHNle1xyXG4gICAgICAgIGRhdGFpZC5wdXNoKCh4IGFzIFNvdXJjZU9wdGlvbnMpLkRhdGFJZHMpO1xyXG4gICAgICB9XHJcbiAgICAgIGJpbGxjYXRlLnB1c2goeC5iaWxsQ2F0ZWdvcnlJZCk7XHJcbiAgICAgIGJpenR5cGUucHVzaCh4LmJpelR5cGVJZCk7XHJcbiAgICB9KTtcclxuICAgIGNvbnN0IGRhdGEgPSB7XHJcbiAgICAgIGZvcm1hdGlkOmlkLFxyXG4gICAgICBzb3VyY2VpZDpzb3VyY2UsXHJcbiAgICAgIGVudGl0eWZpbHRlcjplbnRpdHlmaWx0ZXIsXHJcbiAgICAgIGRhdGFpZDpkYXRhaWQsXHJcbiAgICAgIGlzZmlsdGVyOmlzZmlsdGVyLFxyXG4gICAgICBzdTpzdSxcclxuICAgICAgYmlsbGNhdGVnb3J5OmJpbGxjYXRlLFxyXG4gICAgICBiaXp0eXBlOmJpenR5cGVcclxuICAgIH07XHJcbiAgICB0aGlzLmZvcm1hdFNydi5zZW5kUHJpbnRFdmVudChkYXRhLFwiQ2xvdWRQcmludFwiKTtcclxuICB9XHJcblxyXG4gIC8qKiDnm5LlrZDlkI7lj7DmiZPljbAgKi9cclxuICBwcmludEJveCgpe1xyXG4gICAgY29uc3Qgc2VsZiA9IHRoaXM7XHJcbiAgICBzZWxmLm91dHB1dFBhcmFtLnBybk91dHB1dE9wcy5wcmludEpvYiA9IHRydWU7XHJcbiAgICBpZiAoc2VsZi5vdXRwdXRQYXJhbS5wcm5Tb3VyY2VPcHRpb25zLmxlbmd0aCA+IDEpIHtcclxuICAgICAgaWYgKHNlbGYub3V0cHV0UGFyYW0uaXNGaWx0ZXIpIHtcclxuICAgICAgICByZXR1cm4gc2VsZi5wcmludFNydi5wcmludE11bHRpQnlGaWx0ZXI0Sm9iKHNlbGYub3V0cHV0UGFyYW0ucHJuU291cmNlT3B0aW9ucyBhcyBBcnJheTxTb3VyY2VGaWx0ZXJPcHRpb25zPiwgc2VsZi5vdXRwdXRQYXJhbS5wcm5PdXRwdXRPcHMpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHJldHVybiBzZWxmLnByaW50U3J2LnByaW50TXVsdGlCeUlkNEpvYihzZWxmLm91dHB1dFBhcmFtLnByblNvdXJjZU9wdGlvbnMgYXMgQXJyYXk8U291cmNlT3B0aW9ucz4sIHNlbGYub3V0cHV0UGFyYW0ucHJuT3V0cHV0T3BzKTtcclxuICAgICAgfVxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgaWYgKHNlbGYub3V0cHV0UGFyYW0uaXNGaWx0ZXIpIHtcclxuICAgICAgICByZXR1cm4gc2VsZi5wcmludFNydi5wcmludFNpbmdsZUJ5RmlsdGVyNEpvYihzZWxmLm91dHB1dFBhcmFtLnByblNvdXJjZU9wdGlvbnNbMF0gYXMgU291cmNlRmlsdGVyT3B0aW9ucywgc2VsZi5vdXRwdXRQYXJhbS5wcm5PdXRwdXRPcHMpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHJldHVybiBzZWxmLnByaW50U3J2LnByaW50U2luZ2xlQnlJZDRKb2Ioc2VsZi5vdXRwdXRQYXJhbS5wcm5Tb3VyY2VPcHRpb25zWzBdIGFzIFNvdXJjZU9wdGlvbnMsIHNlbGYub3V0cHV0UGFyYW0ucHJuT3V0cHV0T3BzKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxufVxyXG4iXX0=
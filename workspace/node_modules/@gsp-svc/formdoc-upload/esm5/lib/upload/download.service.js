/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Injectable } from '@angular/core';
var DownloadService = /** @class */ (function () {
    function DownloadService() {
    }
    /**
     * @param {?} metadataId
     * @param {?} rootId
     * @return {?}
     */
    DownloadService.prototype.getDownloadUrl = /**
     * @param {?} metadataId
     * @param {?} rootId
     * @return {?}
     */
    function (metadataId, rootId) {
        return "/api/runtime/dfs/v1.0/doc/filecontent?metadataid=" + metadataId + "&rootid=" + rootId + "&token=" + this.getToken(this.mergeString(metadataId, rootId));
    };
    /**
     * @param {?} metadataId
     * @param {?} rootId
     * @return {?}
     */
    DownloadService.prototype.getStreamDownloadUrl = /**
     * @param {?} metadataId
     * @param {?} rootId
     * @return {?}
     */
    function (metadataId, rootId) {
        return "/api/runtime/dfs/v1.0/formdoc/stream?metadataid=" + metadataId + "&rootid=" + rootId + "&token=" + this.getToken(this.mergeString(metadataId, rootId));
    };
    /**
     * @param {?} metadataIdList
     * @param {?} rootId
     * @return {?}
     */
    DownloadService.prototype.getMultipleDownloadUrl = /**
     * @param {?} metadataIdList
     * @param {?} rootId
     * @return {?}
     */
    function (metadataIdList, rootId) {
        /** @type {?} */
        var list = JSON.parse(metadataIdList);
        return "/api/runtime/dfs/v1.0/doc/multiple/download?metadataidlist=" + metadataIdList + "&rootid=" + rootId + "&token=" + this.getToken(this.mergeString(list[0], rootId));
    };
    /**
     * @param {?} metadataIdList
     * @param {?} rootId
     * @param {?} zipName
     * @return {?}
     */
    DownloadService.prototype.getMultipleDownloadUrlWithName = /**
     * @param {?} metadataIdList
     * @param {?} rootId
     * @param {?} zipName
     * @return {?}
     */
    function (metadataIdList, rootId, zipName) {
        /** @type {?} */
        var list = JSON.parse(metadataIdList);
        if (zipName == null || zipName == "")
            zipName = 'unifile.zip';
        if (!zipName.endsWith(".zip"))
            zipName += '.zip';
        return "/api/runtime/dfs/v1.0/doc/compress/download?metadataidlist=" + metadataIdList + "&rootid=" + rootId + "&token=" + this.getToken(this.mergeString(list[0], rootId)) + "&zipName=" + encodeURIComponent(zipName);
    };
    /**
     * @param {?} metadataId
     * @param {?} rootId
     * @param {?} version
     * @return {?}
     */
    DownloadService.prototype.getHistoryDownloadUrl = /**
     * @param {?} metadataId
     * @param {?} rootId
     * @param {?} version
     * @return {?}
     */
    function (metadataId, rootId, version) {
        //let list:string[]=JSON.parse(metadataIdList);
        return "/api/runtime/dfs/v1.0/doc/historycontent?metadataid=" + metadataId + "&rootid=" + rootId + "&version=" + version + "&token=" + this.getToken(this.mergeString(metadataId, rootId));
    };
    /**
     * @private
     * @param {?} str
     * @param {?} str1
     * @return {?}
     */
    DownloadService.prototype.mergeString = /**
     * @private
     * @param {?} str
     * @param {?} str1
     * @return {?}
     */
    function (str, str1) {
        /** @type {?} */
        var min = str.length < str1.length ? str.length : str1.length;
        /** @type {?} */
        var res = "";
        /** @type {?} */
        var i = 0;
        for (i = 0; i < min; i++) {
            res += str.substring(i, i + 1);
            res += str1.substring(i, i + 1);
        }
        res += str.length < str1.length ? str1.substring(i) : str.substring(i);
        return res;
    };
    /**
     * @private
     * @param {?} str
     * @return {?}
     */
    DownloadService.prototype.getToken = /**
     * @private
     * @param {?} str
     * @return {?}
     */
    function (str) {
        /** @type {?} */
        var array = [1, 2, 3];
        if (str.length > 24)
            str = str.substring(0, 24);
        /** @type {?} */
        var length = Math.floor(str.length / 3);
        /** @type {?} */
        var str1 = str.substring(0, length);
        /** @type {?} */
        var str2 = str.substring(length, 2 * length);
        /** @type {?} */
        var str3 = str.substring(2 * length, 3 * length);
        /** @type {?} */
        var randomArray = [];
        /** @type {?} */
        var random = Math.ceil(Math.random() * 3);
        randomArray.push(array[random - 1]);
        array.splice(random - 1, 1);
        random = Math.ceil(Math.random() * 2);
        randomArray.push(array[random - 1]);
        array.splice(random - 1, 1);
        randomArray.push(array[0]);
        /** @type {?} */
        var timeStamp = Math.round(new Date().getTime() / 1000) + "";
        return timeStamp.substring(0, 5) + "times" + randomArray[0] + "" + randomArray[1] + "" + randomArray[2] + this.switchStr(str1, str2, str3, randomArray[0]) + this.switchStr(str1, str2, str3, randomArray[1]) + this.switchStr(str1, str2, str3, randomArray[2]) + "times" + timeStamp.substring(5);
    };
    /**
     * @private
     * @param {?} str1
     * @param {?} str2
     * @param {?} str3
     * @param {?} i
     * @return {?}
     */
    DownloadService.prototype.switchStr = /**
     * @private
     * @param {?} str1
     * @param {?} str2
     * @param {?} str3
     * @param {?} i
     * @return {?}
     */
    function (str1, str2, str3, i) {
        switch (i) {
            case 1: return str1;
            case 2: return str2;
            case 3: return str3;
        }
    };
    DownloadService.decorators = [
        { type: Injectable }
    ];
    /** @nocollapse */
    DownloadService.ctorParameters = function () { return []; };
    return DownloadService;
}());
export { DownloadService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZG93bmxvYWQuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0Bnc3Atc3ZjL2Zvcm1kb2MtdXBsb2FkLyIsInNvdXJjZXMiOlsibGliL3VwbG9hZC9kb3dubG9hZC5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBRzNDO0lBR0U7SUFBZ0IsQ0FBQzs7Ozs7O0lBRWpCLHdDQUFjOzs7OztJQUFkLFVBQWUsVUFBa0IsRUFBRSxNQUFjO1FBQy9DLE9BQU8sbURBQW1ELEdBQUcsVUFBVSxHQUFHLFVBQVUsR0FBRyxNQUFNLEdBQUcsU0FBUyxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxVQUFVLEVBQUUsTUFBTSxDQUFDLENBQUMsQ0FBQztJQUNsSyxDQUFDOzs7Ozs7SUFHRCw4Q0FBb0I7Ozs7O0lBQXBCLFVBQXFCLFVBQWtCLEVBQUUsTUFBYztRQUNyRCxPQUFPLGtEQUFrRCxHQUFHLFVBQVUsR0FBRyxVQUFVLEdBQUcsTUFBTSxHQUFHLFNBQVMsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsVUFBVSxFQUFFLE1BQU0sQ0FBQyxDQUFDLENBQUM7SUFDakssQ0FBQzs7Ozs7O0lBRUQsZ0RBQXNCOzs7OztJQUF0QixVQUF1QixjQUFzQixFQUFFLE1BQWM7O1lBQ3ZELElBQUksR0FBYSxJQUFJLENBQUMsS0FBSyxDQUFDLGNBQWMsQ0FBQztRQUMvQyxPQUFPLDZEQUE2RCxHQUFHLGNBQWMsR0FBRyxVQUFVLEdBQUcsTUFBTSxHQUFHLFNBQVMsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLE1BQU0sQ0FBQyxDQUFDLENBQUM7SUFDN0ssQ0FBQzs7Ozs7OztJQUVELHdEQUE4Qjs7Ozs7O0lBQTlCLFVBQStCLGNBQXNC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QUFDLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDcEMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBQzVCLE1BQU0sR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsR0FBRyxDQUFDLENBQUMsQ0FBQztRQUN0QyxXQUFXLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUNwQyxLQUFLLENBQUMsTUFBTSxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFDNUIsV0FBVyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQzs7WUFDdkIsU0FBUyxHQUFXLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxJQUFJLEVBQUUsQ0FBQyxPQUFPLEVBQUUsR0FBRyxJQUFJLENBQUMsR0FBRyxFQUFFO1FBRXBFLE9BQU8sU0FBUyxDQUFDLFNBQVMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEdBQUcsT0FBTyxHQUFHLFdBQVcsQ0FBQyxDQUFDLENBQUMsR0FBRyxFQUFFLEdBQUcsV0FBVyxDQUFDLENBQUMsQ0FBQyxHQUFHLEVBQUUsR0FBRyxXQUFXLENBQUMsQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxXQUFXLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLFdBQVcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsV0FBVyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsT0FBTyxHQUFHLFNBQVMsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDdFMsQ0FBQzs7Ozs7Ozs7O0lBRU8sbUNBQVM7Ozs7Ozs7O0lBQWpCLFVBQWtCLElBQVksRUFBRSxJQUFZLEVBQUUsSUFBWSxFQUFFLENBQVM7UUFDbkUsUUFBUSxDQUFDLEVBQUU7WUFDVCxLQUFLLENBQUMsQ0FBQyxDQUFDLE9BQU8sSUFBSSxDQUFDO1lBQ3BCLEtBQUssQ0FBQyxDQUFDLENBQUMsT0FBTyxJQUFJLENBQUM7WUFDcEIsS0FBSyxDQUFDLENBQUMsQ0FBQyxPQUFPLElBQUksQ0FBQztTQUNyQjtJQUNILENBQUM7O2dCQTdFRixVQUFVOzs7O0lBZ0ZYLHNCQUFDO0NBQUEsQUFoRkQsSUFnRkM7U0EvRVksZUFBZSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuXHJcblxyXG5ASW5qZWN0YWJsZSgpXHJcbmV4cG9ydCBjbGFzcyBEb3dubG9hZFNlcnZpY2Uge1xyXG5cclxuICBjb25zdHJ1Y3RvcigpIHsgfVxyXG5cclxuICBnZXREb3dubG9hZFVybChtZXRhZGF0YUlkOiBzdHJpbmcsIHJvb3RJZDogc3RyaW5nKSB7XHJcbiAgICByZXR1cm4gXCIvYXBpL3J1bnRpbWUvZGZzL3YxLjAvZG9jL2ZpbGVjb250ZW50P21ldGFkYXRhaWQ9XCIgKyBtZXRhZGF0YUlkICsgXCImcm9vdGlkPVwiICsgcm9vdElkICsgXCImdG9rZW49XCIgKyB0aGlzLmdldFRva2VuKHRoaXMubWVyZ2VTdHJpbmcobWV0YWRhdGFJZCwgcm9vdElkKSk7XHJcbiAgfVxyXG5cclxuXHJcbiAgZ2V0U3RyZWFtRG93bmxvYWRVcmwobWV0YWRhdGFJZDogc3RyaW5nLCByb290SWQ6IHN0cmluZykge1xyXG4gICAgcmV0dXJuIFwiL2FwaS9ydW50aW1lL2Rmcy92MS4wL2Zvcm1kb2Mvc3RyZWFtP21ldGFkYXRhaWQ9XCIgKyBtZXRhZGF0YUlkICsgXCImcm9vdGlkPVwiICsgcm9vdElkICsgXCImdG9rZW49XCIgKyB0aGlzLmdldFRva2VuKHRoaXMubWVyZ2VTdHJpbmcobWV0YWRhdGFJZCwgcm9vdElkKSk7XHJcbiAgfVxyXG5cclxuICBnZXRNdWx0aXBsZURvd25sb2FkVXJsKG1ldGFkYXRhSWRMaXN0OiBzdHJpbmcsIHJvb3RJZDogc3RyaW5nKSB7XHJcbiAgICBsZXQgbGlzdDogc3RyaW5nW10gPSBKU09OLnBhcnNlKG1ldGFkYXRhSWRMaXN0KTtcclxuICAgIHJldHVybiBcIi9hcGkvcnVudGltZS9kZnMvdjEuMC9kb2MvbXVsdGlwbGUvZG93bmxvYWQ/bWV0YWRhdGFpZGxpc3Q9XCIgKyBtZXRhZGF0YUlkTGlzdCArIFwiJnJvb3RpZD1cIiArIHJvb3RJZCArIFwiJnRva2VuPVwiICsgdGhpcy5nZXRUb2tlbih0aGlzLm1lcmdlU3RyaW5nKGxpc3RbMF0sIHJvb3RJZCkpO1xyXG4gIH1cclxuXHJcbiAgZ2V0TXVsdGlwbGVEb3dubG9hZFVybFdpdGhOYW1lKG1ldGFkYXRhSWRMaXN0OiBzdHJpbmcsIHJvb3RJZDogc3RyaW5nLCB6aXBOYW1lOiBzdHJpbmcpIHtcclxuICAgIGxldCBsaXN0OiBzdHJpbmdbXSA9IEpTT04ucGFyc2UobWV0YWRhdGFJZExpc3QpO1xyXG4gICAgaWYgKHppcE5hbWUgPT0gbnVsbCB8fCB6aXBOYW1lID09IFwiXCIpXHJcbiAgICAgIHppcE5hbWUgPSAndW5pZmlsZS56aXAnO1xyXG4gICAgaWYgKCF6aXBOYW1lLmVuZHNXaXRoKFwiLnppcFwiKSlcclxuICAgICAgemlwTmFtZSArPSAnLnppcCc7XHJcblxyXG5cclxuXHJcbiAgICByZXR1cm4gXCIvYXBpL3J1bnRpbWUvZGZzL3YxLjAvZG9jL2NvbXByZXNzL2Rvd25sb2FkP21ldGFkYXRhaWRsaXN0PVwiICsgbWV0YWRhdGFJZExpc3QgKyBcIiZyb290aWQ9XCIgKyByb290SWQgKyBcIiZ0b2tlbj1cIiArIHRoaXMuZ2V0VG9rZW4odGhpcy5tZXJnZVN0cmluZyhsaXN0WzBdLCByb290SWQpKSArIFwiJnppcE5hbWU9XCIgKyBlbmNvZGVVUklDb21wb25lbnQoemlwTmFtZSk7XHJcbiAgfVxyXG5cclxuICBnZXRIaXN0b3J5RG93bmxvYWRVcmwobWV0YWRhdGFJZDogc3RyaW5nLCByb290SWQ6IHN0cmluZywgdmVyc2lvbjogc3RyaW5nKSB7XHJcbiAgICAvL2xldCBsaXN0OnN0cmluZ1tdPUpTT04ucGFyc2UobWV0YWRhdGFJZExpc3QpO1xyXG4gICAgcmV0dXJuIFwiL2FwaS9ydW50aW1lL2Rmcy92MS4wL2RvYy9oaXN0b3J5Y29udGVudD9tZXRhZGF0YWlkPVwiICsgbWV0YWRhdGFJZCArIFwiJnJvb3RpZD1cIiArIHJvb3RJZCArIFwiJnZlcnNpb249XCIgKyB2ZXJzaW9uICsgXCImdG9rZW49XCIgKyB0aGlzLmdldFRva2VuKHRoaXMubWVyZ2VTdHJpbmcobWV0YWRhdGFJZCwgcm9vdElkKSk7XHJcbiAgfVxyXG5cclxuXHJcblxyXG4gIHByaXZhdGUgbWVyZ2VTdHJpbmcoc3RyOiBzdHJpbmcsIHN0cjE6IHN0cmluZyk6IHN0cmluZyB7XHJcbiAgICBsZXQgbWluID0gc3RyLmxlbmd0aCA8IHN0cjEubGVuZ3RoID8gc3RyLmxlbmd0aCA6IHN0cjEubGVuZ3RoO1xyXG4gICAgbGV0IHJlczogc3RyaW5nID0gXCJcIjtcclxuICAgIGxldCBpID0gMDtcclxuICAgIGZvciAoaSA9IDA7IGkgPCBtaW47IGkrKykge1xyXG4gICAgICByZXMgKz0gc3RyLnN1YnN0cmluZyhpLCBpICsgMSk7XHJcbiAgICAgIHJlcyArPSBzdHIxLnN1YnN0cmluZyhpLCBpICsgMSk7XHJcbiAgICB9XHJcbiAgICByZXMgKz0gc3RyLmxlbmd0aCA8IHN0cjEubGVuZ3RoID8gc3RyMS5zdWJzdHJpbmcoaSkgOiBzdHIuc3Vic3RyaW5nKGkpO1xyXG4gICAgcmV0dXJuIHJlcztcclxuICB9XHJcblxyXG4gIHByaXZhdGUgZ2V0VG9rZW4oc3RyOiBzdHJpbmcpOiBzdHJpbmcge1xyXG4gICAgbGV0IGFycmF5ID0gWzEsIDIsIDNdO1xyXG4gICAgaWYgKHN0ci5sZW5ndGggPiAyNClcclxuICAgICAgc3RyID0gc3RyLnN1YnN0cmluZygwLCAyNCk7XHJcbiAgICBsZXQgbGVuZ3RoID0gTWF0aC5mbG9vcihzdHIubGVuZ3RoIC8gMyk7XHJcbiAgICBsZXQgc3RyMSA9IHN0ci5zdWJzdHJpbmcoMCwgbGVuZ3RoKTtcclxuICAgIGxldCBzdHIyID0gc3RyLnN1YnN0cmluZyhsZW5ndGgsIDIgKiBsZW5ndGgpO1xyXG4gICAgbGV0IHN0cjMgPSBzdHIuc3Vic3RyaW5nKDIgKiBsZW5ndGgsIDMgKiBsZW5ndGgpO1xyXG4gICAgbGV0IHJhbmRvbUFycmF5ID0gW107XHJcbiAgICB2YXIgcmFuZG9tID0gTWF0aC5jZWlsKE1hdGgucmFuZG9tKCkgKiAzKTtcclxuICAgIHJhbmRvbUFycmF5LnB1c2goYXJyYXlbcmFuZG9tIC0gMV0pO1xyXG4gICAgYXJyYXkuc3BsaWNlKHJhbmRvbSAtIDEsIDEpO1xyXG4gICAgcmFuZG9tID0gTWF0aC5jZWlsKE1hdGgucmFuZG9tKCkgKiAyKTtcclxuICAgIHJhbmRvbUFycmF5LnB1c2goYXJyYXlbcmFuZG9tIC0gMV0pO1xyXG4gICAgYXJyYXkuc3BsaWNlKHJhbmRvbSAtIDEsIDEpO1xyXG4gICAgcmFuZG9tQXJyYXkucHVzaChhcnJheVswXSk7XHJcbiAgICBsZXQgdGltZVN0YW1wOiBzdHJpbmcgPSBNYXRoLnJvdW5kKG5ldyBEYXRlKCkuZ2V0VGltZSgpIC8gMTAwMCkgKyBcIlwiO1xyXG5cclxuICAgIHJldHVybiB0aW1lU3RhbXAuc3Vic3RyaW5nKDAsIDUpICsgXCJ0aW1lc1wiICsgcmFuZG9tQXJyYXlbMF0gKyBcIlwiICsgcmFuZG9tQXJyYXlbMV0gKyBcIlwiICsgcmFuZG9tQXJyYXlbMl0gKyB0aGlzLnN3aXRjaFN0cihzdHIxLCBzdHIyLCBzdHIzLCByYW5kb21BcnJheVswXSkgKyB0aGlzLnN3aXRjaFN0cihzdHIxLCBzdHIyLCBzdHIzLCByYW5kb21BcnJheVsxXSkgKyB0aGlzLnN3aXRjaFN0cihzdHIxLCBzdHIyLCBzdHIzLCByYW5kb21BcnJheVsyXSkgKyBcInRpbWVzXCIgKyB0aW1lU3RhbXAuc3Vic3RyaW5nKDUpO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBzd2l0Y2hTdHIoc3RyMTogc3RyaW5nLCBzdHIyOiBzdHJpbmcsIHN0cjM6IHN0cmluZywgaTogbnVtYmVyKTogc3RyaW5nIHtcclxuICAgIHN3aXRjaCAoaSkge1xyXG4gICAgICBjYXNlIDE6IHJldHVybiBzdHIxO1xyXG4gICAgICBjYXNlIDI6IHJldHVybiBzdHIyO1xyXG4gICAgICBjYXNlIDM6IHJldHVybiBzdHIzO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcblxyXG59XHJcbiJdfQ==
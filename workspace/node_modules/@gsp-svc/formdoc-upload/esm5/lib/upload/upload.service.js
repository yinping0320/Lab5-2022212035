/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Injectable } from '@angular/core';
import { HttpService } from '@ecp-caf/caf-common';
import { catchError, tap } from 'rxjs/operators';
import { HttpClient } from '@angular/common/http';
import { GspFormRemoveListEntity } from './entity/gspformremovelistentity';
import { of } from 'rxjs/observable/of';
import { GspFormDocOperateEntity } from './entity/gspformdocoperateentity';
import { ChangeInstanceRequest } from './entity/changeinstancerequest';
import { OperatingModes } from './entity/operatingmodes';
import { CopyFileRequest } from './entity/copyfilerequest';
var UploadService = /** @class */ (function () {
    function UploadService(http, httpclient) {
        this.http = http;
        this.httpclient = httpclient;
    }
    /**
     * @param {?} docListInfo
     * @param {?} rootId
     * @return {?}
     */
    UploadService.prototype.uploadList = /**
     * @param {?} docListInfo
     * @param {?} rootId
     * @return {?}
     */
    function (docListInfo, rootId) {
        /** @type {?} */
        var url;
        docListInfo.rootId = rootId;
        url = "/api/runtime/dfs/v1.0/formdoc/list";
        //url = "/api/runtime/dfs/v1.0/formdoc/list";
        return this.http.post(url, docListInfo).pipe(tap((/**
         * @param {?} res
         * @return {?}
         */
        function (res) { })), catchError((/**
         * @param {?} error
         * @return {?}
         */
        function (error) {
            return of(error);
        })));
    };
    /**
     * @param {?} metadataIdList
     * @param {?} rootId
     * @return {?}
     */
    UploadService.prototype.commit = /**
     * @param {?} metadataIdList
     * @param {?} rootId
     * @return {?}
     */
    function (metadataIdList, rootId) {
        /** @type {?} */
        var url;
        /** @type {?} */
        var entity = new GspFormDocOperateEntity;
        entity.metadataIdList = metadataIdList;
        entity.rootId = rootId;
        url = "/api/runtime/dfs/v1.0/formdoc/commit";
        //url = "http://localhost:5000/api/runtime/dfs/v1.0/formdoc/commit";
        return this.http.post(url, entity).pipe();
    };
    /**
     * @param {?} metadataIdList
     * @param {?} rootId
     * @return {?}
     */
    UploadService.prototype.cancel = /**
     * @param {?} metadataIdList
     * @param {?} rootId
     * @return {?}
     */
    function (metadataIdList, rootId) {
        /** @type {?} */
        var url;
        /** @type {?} */
        var entity = new GspFormDocOperateEntity;
        entity.metadataIdList = metadataIdList;
        entity.rootId = rootId;
        url = "/api/runtime/dfs/v1.0/formdoc/cancel";
        //url = "http://localhost:5000/api/runtime/dfs/v1.0/formdoc/cancel";
        //localStorage.setItem("SessionId","huoliang");
        return this.http.put(url, entity).pipe();
    };
    /**
     * @param {?} idList
     * @param {?} rootId
     * @return {?}
     */
    UploadService.prototype.removeList = /**
     * @param {?} idList
     * @param {?} rootId
     * @return {?}
     */
    function (idList, rootId) {
        /** @type {?} */
        var url;
        //url = "http://localhost:5000/api/runtime/dfs/v1.0/formdoc/list";
        url = "/api/runtime/dfs/v1.0/formdoc/list";
        /** @type {?} */
        var idListInfo = new GspFormRemoveListEntity;
        idListInfo.metadataIdList = idList;
        idListInfo.mode = OperatingModes.Temp;
        idListInfo.rootId = rootId;
        return this.http.delete(url, idListInfo).pipe();
    };
    /**
     * @param {?} metadataId
     * @param {?} rootId
     * @return {?}
     */
    UploadService.prototype.getFile = /**
     * @param {?} metadataId
     * @param {?} rootId
     * @return {?}
     */
    function (metadataId, rootId) {
        /** @type {?} */
        var url;
        if (rootId == "")
            url = "/api/runtime/dfs/v1.0/formdoc/file/" + metadataId;
        else
            url = "/api/runtime/dfs/v1.0/formdoc/file/" + metadataId + "/" + rootId;
        return this.http.get(url).pipe(tap((/**
         * @param {?} res
         * @return {?}
         */
        function (res) { })), catchError((/**
         * @param {?} error
         * @return {?}
         */
        function (error) {
            return of(error);
        })));
    };
    /**
     * @param {?} docInfo
     * @return {?}
     */
    UploadService.prototype.uploadFile = /**
     * @param {?} docInfo
     * @return {?}
     */
    function (docInfo) {
        /** @type {?} */
        var url = "/api/runtime/dfs/v1.0/formdoc";
        //url = "/api/runtime/dfs/v1.0/formdoc/list";
        return this.http.post(url, docInfo).pipe(tap((/**
         * @param {?} res
         * @return {?}
         */
        function (res) { })), catchError((/**
         * @param {?} error
         * @return {?}
         */
        function (error) {
            return of(error);
        })));
    };
    /**
     * @param {?} formdata
     * @return {?}
     */
    UploadService.prototype.uploadSliceFile = /**
     * @param {?} formdata
     * @return {?}
     */
    function (formdata) {
        /** @type {?} */
        var url = "/api/runtime/dfs/v1.0/formdoc/slice";
        //url = "/api/runtime/dfs/v1.0/formdoc/list";
        return this.httpclient.post(url, formdata).pipe(tap((/**
         * @param {?} res
         * @return {?}
         */
        function (res) { })), catchError((/**
         * @param {?} error
         * @return {?}
         */
        function (error) {
            return of(error);
        })));
    };
    /**
     * @return {?}
     */
    UploadService.prototype.getStorageExtensionInfo = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var url = "/api/runtime/dfs/v1.0/storagestrategy/extension";
        //url = "/api/runtime/dfs/v1.0/formdoc/list";
        return this.http.get(url).pipe(tap((/**
         * @param {?} res
         * @return {?}
         */
        function (res) { })), catchError((/**
         * @param {?} error
         * @return {?}
         */
        function (error) {
            return of(error);
        })));
    };
    /**
     * @param {?} baseInfo
     * @return {?}
     */
    UploadService.prototype.getSecurityInfoList = /**
     * @param {?} baseInfo
     * @return {?}
     */
    function (baseInfo) {
        /** @type {?} */
        var url = "/api/runtime/dfs/v1.0/storagestrategy/security";
        url = url + "?id=" + baseInfo.securityId + "&level=" + baseInfo.securityLevel;
        return this.http.get(url).pipe(tap((/**
         * @param {?} res
         * @return {?}
         */
        function (res) { })), catchError((/**
         * @param {?} error
         * @return {?}
         */
        function (error) {
            return of(error);
        })));
    };
    /**
     * @param {?} storageInfoList
     * @param {?} rootId
     * @return {?}
     */
    UploadService.prototype.changeStorageInstance = /**
     * @param {?} storageInfoList
     * @param {?} rootId
     * @return {?}
     */
    function (storageInfoList, rootId) {
        /** @type {?} */
        var url = "/api/runtime/dfs/v1.0/formdoc/changeinstance";
        /** @type {?} */
        var request = new ChangeInstanceRequest;
        request.fileInfoList = storageInfoList;
        request.rootId = rootId;
        return this.http.post(url, request).pipe(tap((/**
         * @param {?} res
         * @return {?}
         */
        function (res) { })), catchError((/**
         * @param {?} error
         * @return {?}
         */
        function (error) {
            return of(error);
        })));
    };
    /**
     * @param {?} metadataId
     * @param {?} rootId
     * @param {?} path
     * @return {?}
     */
    UploadService.prototype.copyFile = /**
     * @param {?} metadataId
     * @param {?} rootId
     * @param {?} path
     * @return {?}
     */
    function (metadataId, rootId, path) {
        /** @type {?} */
        var url = "/api/runtime/dfs/v1.0/formdoc/copy";
        /** @type {?} */
        var request = new CopyFileRequest;
        request.metadataId = metadataId;
        request.rootId = rootId;
        request.path = path;
        return this.httpclient.post(url, request, { responseType: 'text' }).pipe(tap((/**
         * @param {?} res
         * @return {?}
         */
        function (res) { })));
    };
    /**
     * @param {?} uploadFileInfoList
     * @param {?} rootId
     * @return {?}
     */
    UploadService.prototype.saveSecurityInfo = /**
     * @param {?} uploadFileInfoList
     * @param {?} rootId
     * @return {?}
     */
    function (uploadFileInfoList, rootId) {
        /** @type {?} */
        var url = "/api/runtime/dfs/v1.0/doc/exproperty";
        /** @type {?} */
        var reqList = [];
        uploadFileInfoList.forEach((/**
         * @param {?} element
         * @return {?}
         */
        function (element) {
            /** @type {?} */
            var request = { id: element.metadataId, rootId: rootId, exProperty: JSON.stringify(element.securityInfo) };
            reqList.push(request);
        }));
        return this.http.post(url, reqList).pipe(tap((/**
         * @param {?} res
         * @return {?}
         */
        function (res) { })), catchError((/**
         * @param {?} error
         * @return {?}
         */
        function (error) {
            return of(error);
        })));
    };
    /**
     * @param {?} formId
     * @param {?} rootId
     * @return {?}
     */
    UploadService.prototype.getUploadedFileInfoList = /**
     * @param {?} formId
     * @param {?} rootId
     * @return {?}
     */
    function (formId, rootId) {
        /** @type {?} */
        var url = "/api/runtime/dfs/v1.0/formdoc/uploadedfile/infolist" + "?formid=" + formId + "&rootid=" + rootId;
        //url = "/api/runtime/dfs/v1.0/formdoc/list";
        return this.http.get(url).pipe(tap((/**
         * @param {?} res
         * @return {?}
         */
        function (res) { })), catchError((/**
         * @param {?} error
         * @return {?}
         */
        function (error) {
            return of(error);
        })));
    };
    /**
     * @param {?} rootId
     * @return {?}
     */
    UploadService.prototype.getUploadInfo = /**
     * @param {?} rootId
     * @return {?}
     */
    function (rootId) {
        /** @type {?} */
        var url = "/api/runtime/dfs/v1.0/rootsetting/info?id=" + rootId;
        return this.http.get(url).pipe(tap((/**
         * @param {?} res
         * @return {?}
         */
        function (res) { })), catchError((/**
         * @param {?} error
         * @return {?}
         */
        function (error) {
            return of(error);
        })));
    };
    UploadService.decorators = [
        { type: Injectable }
    ];
    /** @nocollapse */
    UploadService.ctorParameters = function () { return [
        { type: HttpService },
        { type: HttpClient }
    ]; };
    return UploadService;
}());
export { UploadService };
if (false) {
    /**
     * @type {?}
     * @private
     */
    UploadService.prototype.http;
    /**
     * @type {?}
     * @private
     */
    UploadService.prototype.httpclient;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXBsb2FkLnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZ3NwLXN2Yy9mb3JtZG9jLXVwbG9hZC8iLCJzb3VyY2VzIjpbImxpYi91cGxvYWQvdXBsb2FkLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFHM0MsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQ2xELE9BQU8sRUFBRSxVQUFVLEVBQUUsR0FBRyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDakQsT0FBTyxFQUFFLFVBQVUsRUFBcUIsTUFBTSxzQkFBc0IsQ0FBQztBQUNyRSxPQUFPLEVBQUUsdUJBQXVCLEVBQUUsTUFBTSxrQ0FBa0MsQ0FBQztBQUMzRSxPQUFPLEVBQUUsRUFBRSxFQUFFLE1BQU0sb0JBQW9CLENBQUM7QUFDeEMsT0FBTyxFQUFFLHVCQUF1QixFQUFFLE1BQU0sa0NBQWtDLENBQUM7QUFJM0UsT0FBTyxFQUFFLHFCQUFxQixFQUFFLE1BQU0sZ0NBQWdDLENBQUM7QUFDdkUsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLHlCQUF5QixDQUFDO0FBSXpELE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQztBQUkzRDtJQUdFLHVCQUFvQixJQUFpQixFQUFVLFVBQXNCO1FBQWpELFNBQUksR0FBSixJQUFJLENBQWE7UUFBVSxlQUFVLEdBQVYsVUFBVSxDQUFZO0lBQUksQ0FBQzs7Ozs7O0lBRTFFLGtDQUFVOzs7OztJQUFWLFVBQVcsV0FBb0MsRUFBRSxNQUFjOztZQUN6RCxHQUFHO1FBQ1AsV0FBVyxDQUFDLE1BQU0sR0FBRyxNQUFNLENBQUM7UUFFNUIsR0FBRyxHQUFHLG9DQUFvQyxDQUFDO1FBQzNDLDZDQUE2QztRQUU3QyxPQUFPLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsRUFBRSxXQUFXLENBQUMsQ0FBQyxJQUFJ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QyxLQUF3QjtZQUNsQyxPQUFPLEVBQUUsQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUNuQixDQUFDLEVBQUMsQ0FBQyxDQUFDO0lBQ1IsQ0FBQzs7Z0JBOUtGLFVBQVU7Ozs7Z0JBbEJGLFdBQVc7Z0JBRVgsVUFBVTs7SUFvTm5CLG9CQUFDO0NBQUEsQUFwTUQsSUFvTUM7U0FuTVksYUFBYTs7Ozs7O0lBRVosNkJBQXlCOzs7OztJQUFFLG1DQUE4QiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgT2JzZXJ2YWJsZSB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQgeyBHc3BGb3JtVXBsb2FkTGlzdEVudGl0eSB9IGZyb20gJy4vZW50aXR5L2dzcGZvcm11cGxvYWRsaXN0ZW50aXR5JztcclxuaW1wb3J0IHsgSHR0cFNlcnZpY2UgfSBmcm9tICdAZWNwLWNhZi9jYWYtY29tbW9uJztcclxuaW1wb3J0IHsgY2F0Y2hFcnJvciwgdGFwIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xyXG5pbXBvcnQgeyBIdHRwQ2xpZW50LCBIdHRwRXJyb3JSZXNwb25zZSB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbi9odHRwJztcclxuaW1wb3J0IHsgR3NwRm9ybVJlbW92ZUxpc3RFbnRpdHkgfSBmcm9tICcuL2VudGl0eS9nc3Bmb3JtcmVtb3ZlbGlzdGVudGl0eSc7XHJcbmltcG9ydCB7IG9mIH0gZnJvbSAncnhqcy9vYnNlcnZhYmxlL29mJztcclxuaW1wb3J0IHsgR3NwRm9ybURvY09wZXJhdGVFbnRpdHkgfSBmcm9tICcuL2VudGl0eS9nc3Bmb3JtZG9jb3BlcmF0ZWVudGl0eSc7XHJcblxyXG5pbXBvcnQgeyBHc3BGb3JtVXBsb2FkRW50aXR5IH0gZnJvbSAnLi9lbnRpdHkvZ3NwZm9ybXVwbG9hZGVudGl0eSc7XHJcbmltcG9ydCB7IEV4U3RvcmFnZUZpbGVJbmZvIH0gZnJvbSAnLi9lbnRpdHkvZXh0ZW5zaW9uc3RvcmFnZWZpbGVpbmZvJztcclxuaW1wb3J0IHsgQ2hhbmdlSW5zdGFuY2VSZXF1ZXN0IH0gZnJvbSAnLi9lbnRpdHkvY2hhbmdlaW5zdGFuY2VyZXF1ZXN0JztcclxuaW1wb3J0IHsgT3BlcmF0aW5nTW9kZXMgfSBmcm9tICcuL2VudGl0eS9vcGVyYXRpbmdtb2Rlcyc7XHJcbmltcG9ydCB7IEdzcERvY1NlY3VyaXR5QmFzZUluZm8gfSBmcm9tICcuL2VudGl0eS9nc3Bkb2NzZWN1cml0eWJhc2VpbmZvJztcclxuaW1wb3J0IHsgVXBsb2FkRmlsZUluZm8gfSBmcm9tICcuL2VudGl0eS91cGxvYWRmaWxlaW5mbyc7XHJcbmltcG9ydCB7IEV4UHJvcGVydHlSZXF1ZXN0IH0gZnJvbSAnLi9lbnRpdHkvZXhwcm9wZXJ0eXJlcXVlc3QnO1xyXG5pbXBvcnQgeyBDb3B5RmlsZVJlcXVlc3QgfSBmcm9tICcuL2VudGl0eS9jb3B5ZmlsZXJlcXVlc3QnO1xyXG5cclxuXHJcblxyXG5ASW5qZWN0YWJsZSgpXHJcbmV4cG9ydCBjbGFzcyBVcGxvYWRTZXJ2aWNlIHtcclxuXHJcbiAgY29uc3RydWN0b3IocHJpdmF0ZSBodHRwOiBIdHRwU2VydmljZSwgcHJpdmF0ZSBodHRwY2xpZW50OiBIdHRwQ2xpZW50KSB7IH1cclxuXHJcbiAgdXBsb2FkTGlzdChkb2NMaXN0SW5mbzogR3NwRm9ybVVwbG9hZExpc3RFbnRpdHksIHJvb3RJZDogc3RyaW5nKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgIGxldCB1cmw7XHJcbiAgICBkb2NMaXN0SW5mby5yb290SWQgPSByb290SWQ7XHJcblxyXG4gICAgdXJsID0gXCIvYXBpL3J1bnRpbWUvZGZzL3YxLjAvZm9ybWRvYy9saXN0XCI7XHJcbiAgICAvL3VybCA9IFwiL2FwaS9ydW50aW1lL2Rmcy92MS4wL2Zvcm1kb2MvbGlzdFwiO1xyXG5cclxuICAgIHJldHVybiB0aGlzLmh0dHAucG9zdCh1cmwsIGRvY0xpc3RJbmZvKS5waXBlKFxyXG4gICAgICB0YXAocmVzID0+IHsgfSksXHJcbiAgICAgIGNhdGNoRXJyb3IoKGVycm9yOiBIdHRwRXJyb3JSZXNwb25zZSkgPT4ge1xyXG4gICAgICAgIHJldHVybiBvZihlcnJvcik7XHJcbiAgICAgIH0pKTtcclxuICB9XHJcblxyXG5cclxuICBjb21taXQobWV0YWRhdGFJZExpc3Q6IHN0cmluZ1tdLCByb290SWQ6IHN0cmluZyk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICBsZXQgdXJsO1xyXG4gICAgbGV0IGVudGl0eTogR3NwRm9ybURvY09wZXJhdGVFbnRpdHkgPSBuZXcgR3NwRm9ybURvY09wZXJhdGVFbnRpdHk7XHJcbiAgICBlbnRpdHkubWV0YWRhdGFJZExpc3QgPSBtZXRhZGF0YUlkTGlzdDtcclxuICAgIGVudGl0eS5yb290SWQgPSByb290SWQ7XHJcbiAgICB1cmwgPSBcIi9hcGkvcnVudGltZS9kZnMvdjEuMC9mb3JtZG9jL2NvbW1pdFwiO1xyXG4gICAgLy91cmwgPSBcImh0dHA6Ly9sb2NhbGhvc3Q6NTAwMC9hcGkvcnVudGltZS9kZnMvdjEuMC9mb3JtZG9jL2NvbW1pdFwiO1xyXG5cclxuICAgIHJldHVybiB0aGlzLmh0dHAucG9zdCh1cmwsIGVudGl0eSkucGlwZSgpO1xyXG4gIH1cclxuXHJcbiAgY2FuY2VsKG1ldGFkYXRhSWRMaXN0OiBzdHJpbmdbXSwgcm9vdElkOiBzdHJpbmcpOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgbGV0IHVybDtcclxuICAgIGxldCBlbnRpdHk6IEdzcEZvcm1Eb2NPcGVyYXRlRW50aXR5ID0gbmV3IEdzcEZvcm1Eb2NPcGVyYXRlRW50aXR5O1xyXG4gICAgZW50aXR5Lm1ldGFkYXRhSWRMaXN0ID0gbWV0YWRhdGFJZExpc3Q7XHJcbiAgICBlbnRpdHkucm9vdElkID0gcm9vdElkO1xyXG4gICAgdXJsID0gXCIvYXBpL3J1bnRpbWUvZGZzL3YxLjAvZm9ybWRvYy9jYW5jZWxcIjtcclxuICAgIC8vdXJsID0gXCJodHRwOi8vbG9jYWxob3N0OjUwMDAvYXBpL3J1bnRpbWUvZGZzL3YxLjAvZm9ybWRvYy9jYW5jZWxcIjtcclxuICAgIC8vbG9jYWxTdG9yYWdlLnNldEl0ZW0oXCJTZXNzaW9uSWRcIixcImh1b2xpYW5nXCIpO1xyXG4gICAgcmV0dXJuIHRoaXMuaHR0cC5wdXQodXJsLCBlbnRpdHkpLnBpcGUoKTtcclxuICB9XHJcblxyXG4gIHJlbW92ZUxpc3QoaWRMaXN0OiBzdHJpbmdbXSwgcm9vdElkOiBzdHJpbmcpIHtcclxuICAgIGxldCB1cmw7XHJcbiAgICAvL3VybCA9IFwiaHR0cDovL2xvY2FsaG9zdDo1MDAwL2FwaS9ydW50aW1lL2Rmcy92MS4wL2Zvcm1kb2MvbGlzdFwiO1xyXG4gICAgdXJsID0gXCIvYXBpL3J1bnRpbWUvZGZzL3YxLjAvZm9ybWRvYy9saXN0XCI7XHJcbiAgICB2YXIgaWRMaXN0SW5mbyA9IG5ldyBHc3BGb3JtUmVtb3ZlTGlzdEVudGl0eTtcclxuICAgIGlkTGlzdEluZm8ubWV0YWRhdGFJZExpc3QgPSBpZExpc3Q7XHJcbiAgICBpZExpc3RJbmZvLm1vZGUgPSBPcGVyYXRpbmdNb2Rlcy5UZW1wO1xyXG4gICAgaWRMaXN0SW5mby5yb290SWQgPSByb290SWQ7XHJcbiAgICByZXR1cm4gdGhpcy5odHRwLmRlbGV0ZSh1cmwsIGlkTGlzdEluZm8pLnBpcGUoKTtcclxuICB9XHJcblxyXG4gIGdldEZpbGUobWV0YWRhdGFJZDogc3RyaW5nLCByb290SWQ6IHN0cmluZykge1xyXG5cclxuICAgIGxldCB1cmw7XHJcbiAgICBpZiAocm9vdElkID09IFwiXCIpXHJcbiAgICAgIHVybCA9IFwiL2FwaS9ydW50aW1lL2Rmcy92MS4wL2Zvcm1kb2MvZmlsZS9cIiArIG1ldGFkYXRhSWQ7XHJcbiAgICBlbHNlXHJcbiAgICAgIHVybCA9IFwiL2FwaS9ydW50aW1lL2Rmcy92MS4wL2Zvcm1kb2MvZmlsZS9cIiArIG1ldGFkYXRhSWQgKyBcIi9cIiArIHJvb3RJZDtcclxuICAgIHJldHVybiB0aGlzLmh0dHAuZ2V0KHVybCkucGlwZSh0YXAocmVzID0+IHsgfSksXHJcbiAgICAgIGNhdGNoRXJyb3IoKGVycm9yOiBIdHRwRXJyb3JSZXNwb25zZSkgPT4ge1xyXG4gICAgICAgIHJldHVybiBvZihlcnJvcik7XHJcbiAgICAgIH0pKTtcclxuXHJcbiAgfVxyXG5cclxuICB1cGxvYWRGaWxlKGRvY0luZm86IEdzcEZvcm1VcGxvYWRFbnRpdHkpOiBPYnNlcnZhYmxlPGFueT4ge1xyXG5cclxuICAgIGxldCB1cmwgPSBcIi9hcGkvcnVudGltZS9kZnMvdjEuMC9mb3JtZG9jXCI7XHJcbiAgICAvL3VybCA9IFwiL2FwaS9ydW50aW1lL2Rmcy92MS4wL2Zvcm1kb2MvbGlzdFwiO1xyXG5cclxuICAgIHJldHVybiB0aGlzLmh0dHAucG9zdCh1cmwsIGRvY0luZm8pLnBpcGUoXHJcbiAgICAgIHRhcChyZXMgPT4geyB9KSxcclxuICAgICAgY2F0Y2hFcnJvcigoZXJyb3I6IEh0dHBFcnJvclJlc3BvbnNlKSA9PiB7XHJcbiAgICAgICAgcmV0dXJuIG9mKGVycm9yKTtcclxuICAgICAgfSkpO1xyXG4gIH1cclxuXHJcbiAgdXBsb2FkU2xpY2VGaWxlKGZvcm1kYXRhOiBGb3JtRGF0YSk6IE9ic2VydmFibGU8YW55PiB7XHJcblxyXG4gICAgbGV0IHVybCA9IFwiL2FwaS9ydW50aW1lL2Rmcy92MS4wL2Zvcm1kb2Mvc2xpY2VcIjtcclxuICAgIC8vdXJsID0gXCIvYXBpL3J1bnRpbWUvZGZzL3YxLjAvZm9ybWRvYy9saXN0XCI7XHJcblxyXG4gICAgcmV0dXJuIHRoaXMuaHR0cGNsaWVudC5wb3N0KHVybCwgZm9ybWRhdGEpLnBpcGUoXHJcbiAgICAgIHRhcChyZXMgPT4geyB9KSxcclxuICAgICAgY2F0Y2hFcnJvcigoZXJyb3I6IEh0dHBFcnJvclJlc3BvbnNlKSA9PiB7XHJcbiAgICAgICAgcmV0dXJuIG9mKGVycm9yKTtcclxuICAgICAgfSkpO1xyXG4gIH1cclxuXHJcblxyXG4gIGdldFN0b3JhZ2VFeHRlbnNpb25JbmZvKCk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICBsZXQgdXJsID0gXCIvYXBpL3J1bnRpbWUvZGZzL3YxLjAvc3RvcmFnZXN0cmF0ZWd5L2V4dGVuc2lvblwiO1xyXG4gICAgLy91cmwgPSBcIi9hcGkvcnVudGltZS9kZnMvdjEuMC9mb3JtZG9jL2xpc3RcIjtcclxuXHJcbiAgICByZXR1cm4gdGhpcy5odHRwLmdldCh1cmwpLnBpcGUoXHJcbiAgICAgIHRhcChyZXMgPT4geyB9KSxcclxuICAgICAgY2F0Y2hFcnJvcigoZXJyb3I6IEh0dHBFcnJvclJlc3BvbnNlKSA9PiB7XHJcbiAgICAgICAgcmV0dXJuIG9mKGVycm9yKTtcclxuICAgICAgfSkpO1xyXG4gIH1cclxuXHJcbiAgZ2V0U2VjdXJpdHlJbmZvTGlzdChiYXNlSW5mbzogR3NwRG9jU2VjdXJpdHlCYXNlSW5mbyk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICBsZXQgdXJsID0gXCIvYXBpL3J1bnRpbWUvZGZzL3YxLjAvc3RvcmFnZXN0cmF0ZWd5L3NlY3VyaXR5XCI7XHJcbiAgICB1cmwgPSB1cmwgKyBcIj9pZD1cIiArIGJhc2VJbmZvLnNlY3VyaXR5SWQgKyBcIiZsZXZlbD1cIiArIGJhc2VJbmZvLnNlY3VyaXR5TGV2ZWw7XHJcblxyXG4gICAgcmV0dXJuIHRoaXMuaHR0cC5nZXQodXJsKS5waXBlKFxyXG4gICAgICB0YXAocmVzID0+IHsgfSksXHJcbiAgICAgIGNhdGNoRXJyb3IoKGVycm9yOiBIdHRwRXJyb3JSZXNwb25zZSkgPT4ge1xyXG4gICAgICAgIHJldHVybiBvZihlcnJvcik7XHJcbiAgICAgIH0pKTtcclxuICB9XHJcblxyXG4gIGNoYW5nZVN0b3JhZ2VJbnN0YW5jZShzdG9yYWdlSW5mb0xpc3Q6IEV4U3RvcmFnZUZpbGVJbmZvW10sIHJvb3RJZDogc3RyaW5nKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgIGxldCB1cmwgPSBcIi9hcGkvcnVudGltZS9kZnMvdjEuMC9mb3JtZG9jL2NoYW5nZWluc3RhbmNlXCI7XHJcbiAgICBsZXQgcmVxdWVzdDogQ2hhbmdlSW5zdGFuY2VSZXF1ZXN0ID0gbmV3IENoYW5nZUluc3RhbmNlUmVxdWVzdDtcclxuICAgIHJlcXVlc3QuZmlsZUluZm9MaXN0ID0gc3RvcmFnZUluZm9MaXN0O1xyXG4gICAgcmVxdWVzdC5yb290SWQgPSByb290SWQ7XHJcbiAgICByZXR1cm4gdGhpcy5odHRwLnBvc3QodXJsLCByZXF1ZXN0KS5waXBlKFxyXG4gICAgICB0YXAocmVzID0+IHsgfSksXHJcbiAgICAgIGNhdGNoRXJyb3IoKGVycm9yOiBIdHRwRXJyb3JSZXNwb25zZSkgPT4ge1xyXG4gICAgICAgIHJldHVybiBvZihlcnJvcik7XHJcbiAgICAgIH0pKTtcclxuICB9XHJcblxyXG4gIGNvcHlGaWxlKG1ldGFkYXRhSWQ6IHN0cmluZywgcm9vdElkOiBzdHJpbmcsIHBhdGg6IHN0cmluZyk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICBsZXQgdXJsID0gXCIvYXBpL3J1bnRpbWUvZGZzL3YxLjAvZm9ybWRvYy9jb3B5XCI7XHJcbiAgICBsZXQgcmVxdWVzdDogQ29weUZpbGVSZXF1ZXN0ID0gbmV3IENvcHlGaWxlUmVxdWVzdDtcclxuICAgIHJlcXVlc3QubWV0YWRhdGFJZCA9IG1ldGFkYXRhSWQ7XHJcbiAgICByZXF1ZXN0LnJvb3RJZCA9IHJvb3RJZDtcclxuICAgIHJlcXVlc3QucGF0aCA9IHBhdGg7XHJcbiAgICByZXR1cm4gdGhpcy5odHRwY2xpZW50LnBvc3QodXJsLCByZXF1ZXN0LHtyZXNwb25zZVR5cGU6ICd0ZXh0J30pLnBpcGUoXHJcbiAgICAgIHRhcChyZXMgPT4geyB9KSxcclxuICAgICAgLy8gY2F0Y2hFcnJvcigoZXJyb3I6IEh0dHBFcnJvclJlc3BvbnNlKSA9PiB7XHJcbiAgICAgIC8vICAgcmV0dXJuIG9mKGVycm9yKTtcclxuICAgICAgLy8gfSlcclxuICAgICAgKTtcclxuICB9XHJcblxyXG4gIHNhdmVTZWN1cml0eUluZm8odXBsb2FkRmlsZUluZm9MaXN0OiBVcGxvYWRGaWxlSW5mb1tdLCByb290SWQ6IHN0cmluZyk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICBsZXQgdXJsID0gXCIvYXBpL3J1bnRpbWUvZGZzL3YxLjAvZG9jL2V4cHJvcGVydHlcIjtcclxuICAgIGxldCByZXFMaXN0OiBFeFByb3BlcnR5UmVxdWVzdFtdID0gW107XHJcbiAgICB1cGxvYWRGaWxlSW5mb0xpc3QuZm9yRWFjaChlbGVtZW50ID0+IHtcclxuICAgICAgbGV0IHJlcXVlc3Q6IEV4UHJvcGVydHlSZXF1ZXN0ID0geyBpZDogZWxlbWVudC5tZXRhZGF0YUlkLCByb290SWQ6IHJvb3RJZCwgZXhQcm9wZXJ0eTogSlNPTi5zdHJpbmdpZnkoZWxlbWVudC5zZWN1cml0eUluZm8pIH07XHJcbiAgICAgIHJlcUxpc3QucHVzaChyZXF1ZXN0KTtcclxuICAgIH0pXHJcbiAgICByZXR1cm4gdGhpcy5odHRwLnBvc3QodXJsLCByZXFMaXN0KS5waXBlKFxyXG4gICAgICB0YXAocmVzID0+IHsgfSksXHJcbiAgICAgIGNhdGNoRXJyb3IoKGVycm9yOiBIdHRwRXJyb3JSZXNwb25zZSkgPT4ge1xyXG4gICAgICAgIHJldHVybiBvZihlcnJvcik7XHJcbiAgICAgIH0pKVxyXG4gIH1cclxuXHJcblxyXG4gIGdldFVwbG9hZGVkRmlsZUluZm9MaXN0KGZvcm1JZDogc3RyaW5nLCByb290SWQ6IHN0cmluZyk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICBsZXQgdXJsID0gXCIvYXBpL3J1bnRpbWUvZGZzL3YxLjAvZm9ybWRvYy91cGxvYWRlZGZpbGUvaW5mb2xpc3RcIiArIFwiP2Zvcm1pZD1cIiArIGZvcm1JZCArIFwiJnJvb3RpZD1cIiArIHJvb3RJZDtcclxuICAgIC8vdXJsID0gXCIvYXBpL3J1bnRpbWUvZGZzL3YxLjAvZm9ybWRvYy9saXN0XCI7XHJcblxyXG4gICAgcmV0dXJuIHRoaXMuaHR0cC5nZXQodXJsKS5waXBlKFxyXG4gICAgICB0YXAocmVzID0+IHsgfSksXHJcbiAgICAgIGNhdGNoRXJyb3IoKGVycm9yOiBIdHRwRXJyb3JSZXNwb25zZSkgPT4ge1xyXG4gICAgICAgIHJldHVybiBvZihlcnJvcik7XHJcbiAgICAgIH0pKTtcclxuICB9XHJcblxyXG4gICAgZ2V0VXBsb2FkSW5mbyhyb290SWQ6IHN0cmluZyk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICBsZXQgdXJsID0gXCIvYXBpL3J1bnRpbWUvZGZzL3YxLjAvcm9vdHNldHRpbmcvaW5mbz9pZD1cIiArIHJvb3RJZDtcclxuXHJcbiAgICByZXR1cm4gdGhpcy5odHRwLmdldCh1cmwpLnBpcGUoXHJcbiAgICAgIHRhcChyZXMgPT4geyB9KSxcclxuICAgICAgY2F0Y2hFcnJvcigoZXJyb3I6IEh0dHBFcnJvclJlc3BvbnNlKSA9PiB7XHJcbiAgICAgICAgcmV0dXJuIG9mKGVycm9yKTtcclxuICAgICAgfSkpO1xyXG4gIH1cclxuXHJcbiAgLy8gZ2V0Um9vdFNldHRpbmcocm9vdElkOiBzdHJpbmcpOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gIC8vICAgbGV0IHVybCA9IFwiL2FwaS9ydW50aW1lL2Rmcy92MS4wL3Jvb3RzZXR0aW5nL1wiICsgcm9vdElkO1xyXG5cclxuICAvLyAgIHJldHVybiB0aGlzLmh0dHAuZ2V0KHVybCkucGlwZShcclxuICAvLyAgICAgdGFwKHJlcyA9PiB7IH0pLFxyXG4gIC8vICAgICBjYXRjaEVycm9yKChlcnJvcjogSHR0cEVycm9yUmVzcG9uc2UpID0+IHtcclxuICAvLyAgICAgICByZXR1cm4gb2YoZXJyb3IpO1xyXG4gIC8vICAgICB9KSk7XHJcbiAgLy8gfVxyXG5cclxuICAvLyBnZXRWYWxpZGF0aW9uKGlkOiBzdHJpbmcpOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gIC8vICAgbGV0IHVybCA9IFwiL2FwaS9ydW50aW1lL2Rmcy92MS4wL3ZhbGlkYXRpb24vXCIgKyBpZDtcclxuXHJcbiAgLy8gICByZXR1cm4gdGhpcy5odHRwLmdldCh1cmwpLnBpcGUoXHJcbiAgLy8gICAgIHRhcChyZXMgPT4geyB9KSxcclxuICAvLyAgICAgY2F0Y2hFcnJvcigoZXJyb3I6IEh0dHBFcnJvclJlc3BvbnNlKSA9PiB7XHJcbiAgLy8gICAgICAgcmV0dXJuIG9mKGVycm9yKTtcclxuICAvLyAgICAgfSkpO1xyXG4gIC8vIH1cclxuXHJcbn1cclxuIl19
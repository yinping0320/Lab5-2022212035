!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@farris/ui-dialog"),require("@angular/common"),require("rxjs/observable/of"),require("rxjs/operators"),require("angular2-uuid"),require("@angular/platform-browser"),require("@farris/ui-messager"),require("@farris/ui-loading"),require("@farris/ui-progress"),require("@angular/forms"),require("@farris/ui-combo-list"),require("@farris/ui-forms"),require("@ecp-caf/caf-common"),require("@angular/core"),require("@farris/ui-modal"),require("rxjs"),require("@angular/common/http"),require("@farris/ui-notify")):"function"==typeof define&&define.amd?define("@gsp-svc/formdoc-upload",["exports","@farris/ui-dialog","@angular/common","rxjs/observable/of","rxjs/operators","angular2-uuid","@angular/platform-browser","@farris/ui-messager","@farris/ui-loading","@farris/ui-progress","@angular/forms","@farris/ui-combo-list","@farris/ui-forms","@ecp-caf/caf-common","@angular/core","@farris/ui-modal","rxjs","@angular/common/http","@farris/ui-notify"],t):t((e["gsp-svc"]=e["gsp-svc"]||{},e["gsp-svc"]["formdoc-upload"]={}),e.uiDialog,e.ng.common,e.rxjs["observable/of"],e.rxjs.operators,e.angular2Uuid,e.ng.platformBrowser,e.uiMessager,e.uiLoading,e.uiProgress,e.ng.forms,e.uiComboList,e.uiForms,e.cafCommon,e.ng.core,e.uiModal,e.rxjs,e.ng.common.http,e.uiNotify)}(this,function(e,t,i,n,l,p,s,o,a,r,d,c,u,f,h,m,g,y,x){"use strict";var v=function(){function e(){}return e.decorators=[{type:h.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[]},e.ngInjectableDef=h.defineInjectable({factory:function(){return new e},token:e,providedIn:"root"}),e}(),b=function(){function e(){}return e.prototype.ngOnInit=function(){},e.decorators=[{type:h.Component,args:[{selector:"lib-formdoc-upload",template:"\n    <p>\n      formdoc-upload works!\n    </p>\n  "}]}],e.ctorParameters=function(){return[]},e}(),I=localStorage.getItem("languageCode")||"zh-CHS",F=function(){function e(){}return e.decorators=[{type:h.NgModule,args:[{declarations:[b],imports:[y.HttpClientModule],exports:[b],providers:[f.LanguageService,f.HttpService,f.CacheService,f.SessionService,{provide:h.LOCALE_ID,useValue:I}]}]}],e}(),S={Word:0,Excel:1,Powerpoint:2,Pdf:3,Txt:4,Image:5,Other:6};S[S.Word]="Word",S[S.Excel]="Excel",S[S.Powerpoint]="Powerpoint",S[S.Pdf]="Pdf",S[S.Txt]="Txt",S[S.Image]="Image",S[S.Other]="Other";var w={Formal:0,Temp:1};w[w.Formal]="Formal",w[w.Temp]="Temp";var L=function te(){},k=function ie(){},C=function oe(){},N=function ne(){},U=function(){function e(e,t){this.http=e,this.httpclient=t}return e.prototype.uploadList=function(e,t){return e.rootId=t,"/api/runtime/dfs/v1.0/formdoc/list",this.http.post("/api/runtime/dfs/v1.0/formdoc/list",e).pipe(l.tap(function(e){}),l.catchError(function(e){return n.of(e)}))},e.prototype.commit=function(e,t){var i=new k;return i.metadataIdList=e,i.rootId=t,"/api/runtime/dfs/v1.0/formdoc/commit",this.http.post("/api/runtime/dfs/v1.0/formdoc/commit",i).pipe()},e.prototype.cancel=function(e,t){var i=new k;return i.metadataIdList=e,i.rootId=t,"/api/runtime/dfs/v1.0/formdoc/cancel",this.http.put("/api/runtime/dfs/v1.0/formdoc/cancel",i).pipe()},e.prototype.removeList=function(e,t){var i=new L;return i.metadataIdList=e,i.mode=w.Temp,i.rootId=t,this.http["delete"]("/api/runtime/dfs/v1.0/formdoc/list",i).pipe()},e.prototype.getFile=function(e,t){var i;return i=""==t?"/api/runtime/dfs/v1.0/formdoc/file/"+e:"/api/runtime/dfs/v1.0/formdoc/file/"+e+"/"+t,this.http.get(i).pipe(l.tap(function(e){}),l.catchError(function(e){return n.of(e)}))},e.prototype.uploadFile=function(e){return this.http.post("/api/runtime/dfs/v1.0/formdoc",e).pipe(l.tap(function(e){}),l.catchError(function(e){return n.of(e)}))},e.prototype.uploadSliceFile=function(e){return this.httpclient.post("/api/runtime/dfs/v1.0/formdoc/slice",e).pipe(l.tap(function(e){}),l.catchError(function(e){return n.of(e)}))},e.prototype.getStorageExtensionInfo=function(){return this.http.get("/api/runtime/dfs/v1.0/storagestrategy/extension").pipe(l.tap(function(e){}),l.catchError(function(e){return n.of(e)}))},e.prototype.getSecurityInfoList=function(e){var t="/api/runtime/dfs/v1.0/storagestrategy/security";return t=t+"?id="+e.securityId+"&level="+e.securityLevel,this.http.get(t).pipe(l.tap(function(e){}),l.catchError(function(e){return n.of(e)}))},e.prototype.changeStorageInstance=function(e,t){var i=new C;return i.fileInfoList=e,i.rootId=t,this.http.post("/api/runtime/dfs/v1.0/formdoc/changeinstance",i).pipe(l.tap(function(e){}),l.catchError(function(e){return n.of(e)}))},e.prototype.copyFile=function(e,t,i){var o=new N;return o.metadataId=e,o.rootId=t,o.path=i,this.httpclient.post("/api/runtime/dfs/v1.0/formdoc/copy",o,{responseType:"text"}).pipe(l.tap(function(e){}))},e.prototype.saveSecurityInfo=function(e,i){var o=[];return e.forEach(function(e){var t={id:e.metadataId,rootId:i,exProperty:JSON.stringify(e.securityInfo)};o.push(t)}),this.http.post("/api/runtime/dfs/v1.0/doc/exproperty",o).pipe(l.tap(function(e){}),l.catchError(function(e){return n.of(e)}))},e.prototype.getUploadedFileInfoList=function(e,t){var i="/api/runtime/dfs/v1.0/formdoc/uploadedfile/infolist?formid="+e+"&rootid="+t;return this.http.get(i).pipe(l.tap(function(e){}),l.catchError(function(e){return n.of(e)}))},e.prototype.getUploadInfo=function(e){var t="/api/runtime/dfs/v1.0/rootsetting/info?id="+e;return this.http.get(t).pipe(l.tap(function(e){}),l.catchError(function(e){return n.of(e)}))},e.decorators=[{type:h.Injectable}],e.ctorParameters=function(){return[{type:f.HttpService},{type:y.HttpClient}]},e}(),M=function le(){},z=function se(){},O={New:0,Update:1};O[O.New]="New",O[O.Update]="Update";var T={"zh-CHS":{uploadFile:"上传文件",uploading:"正在上传文件……",selectedCount:"已选择文件数量：",limitCount:"超出系统限制数量：",rechooseFile:",重新选择上传文件。",save:"保存",cancel:"取消",haveSameName:"已上传过同名文件: ",rename:"重命名",replace:"替换",sizeZero:"文件大小为0",sizeMax:"文件大小超出限制",uploadFailure:"上传失败",uploadSucceed:"上传成功",wait:"等一下，文档正在上传。",saveTo:"正在将文件保存到","delete":"删除",selectAll:"全选",selectNull:"全不选",detail:"详情",fileName:"文件名",state:"状态",operation:"操作",size:"大小",close:"关闭",loading:"拼命加载中",mismatchChunkSize:"文档分片上传部分丢失，请重新上传，如果多次上传失败，请联系管理员。"},"en-US":{uploadFile:"Upload File",uploading:"File Uploading……",selectedCount:"Selected files count：",limitCount:"System limit count：",rechooseFile:",Reselect upload file.",save:"Save",cancel:"Cancel",haveSameName:"A file with the same name has been uploaded: ",rename:"Rename",replace:"Replace",sizeZero:"File size is 0",sizeMax:"File size beyond limit",uploadFailure:"Upload failed",uploadSucceed:"Upload successfully",wait:"Wait a minute, the file is uploading.",saveTo:"Saving file to","delete":"Delete",selectAll:"Select all",selectNull:"Not at all",detail:"Details",fileName:"Filename",state:"State",operation:"Operation",size:"Size",close:"Close",loading:"Loading",mismatchChunkSize:"The partial upload of document shards is missing. Please upload again. If multiple uploads fail, please contact the administrator."},en:{uploadFile:"Upload File",uploading:"File Uploading……",selectedCount:"Selected files count：",limitCount:"System limit count：",rechooseFile:",Reselect upload file.",save:"Save",cancel:"Cancel",haveSameName:"A file with the same name has been uploaded: ",rename:"Rename",replace:"Replace",sizeZero:"File size is 0",sizeMax:"File size beyond limit",uploadFailure:"Upload failed",uploadSucceed:"Upload successfully",wait:"Wait a minute, the file is uploading.",saveTo:"Saving file to","delete":"Delete",selectAll:"Select all",selectNull:"Not at all",detail:"Details",fileName:"Filename",state:"State",operation:"Operation",size:"Size",close:"Close",loading:"Loading",mismatchChunkSize:"The partial upload of document shards is missing. Please upload again. If multiple uploads fail, please contact the administrator."},"zh-CHT":{uploadFile:"上傳文件",uploading:"正在上傳文件……",selectedCount:"已選擇文件數量：",limitCount:"超出系統限制數量：",rechooseFile:",重新選擇上傳文件。",save:"保存",cancel:"取消",haveSameName:"已上傳過同名文件: ",rename:"重命名",replace:"替換",sizeZero:"文件大小為0",sizeMax:"文件大小超出限制",uploadFailure:"上傳失敗",uploadSucceed:"上傳成功",wait:"等一下，文件正在上傳。",saveTo:"正在將文件保存到","delete":"删除",selectAll:"全選",selectNull:"全不選",detail:"詳情",fileName:"文件名",state:"狀態",operation:"操作",size:"大小",close:"關閉",loading:"拼命加載中",mismatchChunkSize:"文檔分片上傳部分遺失，請重新上傳，如果多次上傳失敗，請聯系管理員。"}},D=function(){function e(e){this.defaultLang="zh-CHS",this.langCode=localStorage.getItem("languageCode")||e||this.defaultLang,this.lang=T[this.langCode]||T[this.defaultLang]}return e.prototype.transform=function(e){return this.lang[e]||e},e.decorators=[{type:h.Pipe,args:[{name:"locale"}]}],e.ctorParameters=function(){return[{type:String,decorators:[{type:h.Inject,args:[h.LOCALE_ID]}]}]},e}(),E=function ae(){},P=function re(){},A=function pe(){},_=function de(){},R=function(){function e(e,t,i,o){this.msgService=e,this.uploadService=t,this.loadService=i,this.injector=o,this.files=[],this.metadataIdList=[],this.uploadFileInfoList=[],this.errFileList=[],this.errTypeList=[],this.nullFileList=[],this.beyondFileList=[],this.showType=0,this.mouseOn=!1,this.bufferSize=5242880,this.selectedFileCount=0,this.uploadIconAddress="/platform/runtime/dfs/images/upload.svg",this.uploadLittleIconAddress="/platform/runtime/dfs/images/uploadIcon.svg",this.hasSelectedFile=!1,this.fileAllSelected=!1,this.uploadProcess={width:"0%"},this.fileTotalChunk={},this.requestArray=new Array,this.requestBodyArray=new Array,this.uploadedChunk={},this.uploadedProcess={},this.defaultPropertyName="",this.propertiesNames=[],this.securityInfoList=[],this.queueListStyle={width:"480px"},this.dropListValue="",this.uploadedFileTotal=0,this.haveExtensionProperty=!1,this.haveSecurityInfo=!1,this.uploadedFileInfoList=[],this.oldUploadedFileList=[],this.sameNameAllowed=!0,this.maxFileSize=0,this.checkboxPos={top:"0px"},this.fileType="*",this.fileCount=0,this.oldIdList=[],this.securityInfo=null,this.totalLoad=null,this.exStorageFileList=[],this.injector&&(this.httpclient=this.injector.get(y.HttpClient),this.localeid=localStorage.getItem("languageCode")||this.injector.get(h.LOCALE_ID),this.localepipe=new D(this.localeid))}return e.prototype.ngOnInit=function(){var i=this;0<=navigator.userAgent.indexOf("Firefox")&&(this.checkboxPos.top="14px"),null!=this.securityInfo&&this.uploadService.getSecurityInfoList(this.securityInfo).subscribe(function(e){i.haveSecurityInfo=!0;var t=0;e.forEach(function(e){i.securityInfoList.push({id:t.toString(),securityId:e.securityId,securityLevel:e.securityLevel,name:e.name}),t++})}),this.uploadService.getStorageExtensionInfo().subscribe(function(e){if(null!=e&&null==e.error){i.storageExtension=e,i.defaultPropertyName=i.storageExtension.defaultPropertyName,i.propertiesNames.push({id:"0",name:i.storageExtension.defaultPropertyName});var t=0;i.storageExtension.extensionPropertyNameList.forEach(function(e){i.propertiesNames.push({id:(++t).toString(),name:e})}),i.queueListStyle.width="380px",i.haveExtensionProperty=!0}}),this.uploadService.getUploadInfo(this.rootId).subscribe(function(e){null!=e&&null==e.error&&(i.sameNameAllowed=e.sameNameAllowed,i.maxFileSize=parseInt(JSON.parse(e.validateConfiguration).maxFileSize),i.allowedMultiUpload=e.allowedMultiUpload,i.sameNameAllowed||i.uploadService.getUploadedFileInfoList(i.formId,i.rootId).subscribe(function(e){null!=e&&null==e.error&&(i.uploadedFileInfoList=e,i.oldUploadedFileList=JSON.parse(JSON.stringify(e)))}))}),null!=this.oldIdList&&this.oldIdList.length,this.radioButtonGroupValue="showByGroup"},e.prototype.showLoading=function(){this.hasSelectedFile=!0},e.prototype.fileSelected=function(e){var a=this;if(this.hasSelectedFile=!0,this.selectedFiles=document.querySelector("#file"),0<this.fileCount&&this.selectedFiles.files.length+this.files.length>this.fileCount){var t=this.selectedFiles.files.length+this.files.length;this.msgService.warning(this.localepipe.transform("selectedCount")+t+this.localepipe.transform("limitCount")+this.fileCount+this.localepipe.transform("rechooseFile"))}else{for(var i=function(e){var n=o.selectedFiles.files[e],l=p.UUID.UUID();if(0==n.size)return o.nullFileList.push(n.name),"continue";if(null!=o.maxFileSize&&0<o.maxFileSize&&n.size>1e3*o.maxFileSize)return o.beyondFileList.push(n.name),"continue";if(!o.sameNameAllowed&&null!=o.uploadedFileInfoList.find(function(e){return e.fileName==n.name})){var s=o.msgService.show("warning",o.localepipe.transform("haveSameName")+n.name,{initialState:{buttons:[{text:o.localepipe.transform("rename"),cls:"btn btn-secondary",handle:function(){for(var t,e=n.name,i=!0,o=1;i;)t=e.substring(0,e.lastIndexOf("."))+"("+o+")"+e.substring(e.lastIndexOf(".")),null!=a.uploadedFileInfoList.find(function(e){return e.fileName==t})?o++:i=!1;a.uploadFile(l,n,t),s.close()}},{text:o.localepipe.transform("replace"),cls:"btn btn-secondary",handle:function(){l=a.uploadedFileInfoList.find(function(e){return e.fileName==n.name}).metadataId,a.uploadFile(l,n,n.name,O.Update),a.uploadedFileTotal--,a.oldUploadedFileList.find(function(e){return e.fileName==n.name})&&(a.uploadedFileTotal++,a.uploadedFileInfoList.splice(a.uploadedFileInfoList.indexOf(a.uploadedFileInfoList.filter(function(e){return e.fileName==n.name})[0]),1)),s.close()}},{text:o.localepipe.transform("cancel"),cls:"btn btn-secondary",handle:function(){s.close()}}]}});return"continue"}o.uploadFile(l,n,n.name)},o=this,n=0;n<this.selectedFiles.files.length;n++)i(n);if(0<this.errFileList.length){var l=this.listToString(this.errFileList);this.msgService.warning(this.localepipe.transform("haveSameName")+l+this.localepipe.transform("rechooseFile")),this.errFileList=[]}if(0<this.nullFileList.length){var s=this.listToString(this.nullFileList);s=s.substring(0,s.length-1),this.msgService.warning(s+this.localepipe.transform("sizeZero")+this.localepipe.transform("rechooseFile")),this.nullFileList=[]}if(0<this.beyondFileList.length){var r=this.listToString(this.beyondFileList);r=r.substring(0,r.length-1),this.msgService.warning(r+this.localepipe.transform("sizeMax")+this.maxFileSize+"KB"+this.localepipe.transform("rechooseFile")),this.beyondFileList=[]}this.files=this.files.slice(),this.fileAllSelected=!1,e.target.value=""}},e.prototype.showErrorMessage=function(e){this.msgService.error(this.localepipe.transform("uploadFailure")+e.errorMessage)},e.prototype.handleFileInfo=function(e,t,i){var o;o={id:e,name:i,type:t.type,source:"",size:this.getFileSize(t.size),fileSize:t.size,picListDisplayName:this.getPicListDisplayName(i),queueListDisplayName:this.getQueueDisplayName(i),hasUploaded:!1,mouseOn:!1,selectd:!1,isUploading:!0,uploadResult:!1,uploadProcess:0,errorMessage:"",extensionDropListId:0,extensionName:"",securityDropListId:0,securityInfo:this.securityInfoList[0]},null!=this.storageExtension&&(o.extensionName=this.defaultPropertyName);var n=t.type;return n.includes("tiff")?this.addDocInfo(t,o,S.Other):n.includes("image")?this.addDocInfo(t,o,S.Image):n.includes("word")?this.addDocInfo(t,o,S.Word):n.includes("pdf")?this.addDocInfo(t,o,S.Pdf):n.includes("plain")?this.addDocInfo(t,o,S.Txt):n.includes("sheet")||n.includes("excel")?this.addDocInfo(t,o,S.Excel):n.includes("powerpoint")||n.includes("presentation")?this.addDocInfo(t,o,S.Powerpoint):this.addDocInfo(t,o,S.Other),o},e.prototype.uploadFile=function(p,d,e,t){var c=this;void 0===t&&(t=O.New);var u=this.handleFileInfo(p,d,e),f=new M;if(f.metadataId=p,f.fileName=u.name,f.fileSize=u.size,f.state=t,f.securityInfo=this.securityInfoList[0],this.allowedMultiUpload){var i=new E;i.path=this.formId,i.metadataId=p,i.rootId=this.rootId,i.size=u.fileSize,i.fileName=e,this.initMultiUpload(i).subscribe(function(e){if(null!=e.error)c.files[c.files.indexOf(u)].uploadResult=!1,c.files[c.files.indexOf(u)].isUploading=!1,c.files[c.files.indexOf(u)].errorMessage=e.error.Message;else{var i=e.uploadId,t=Math.ceil(d.size/c.bufferSize),o=0,n=[];for(c.fileTotalChunk[p]=t,c.uploadedChunk[p]=0;o<t;){var l=Math.min((o+1)*c.bufferSize,d.size),s=d.slice(o*c.bufferSize,l),a=new _;a.metadataId=p,a.rootId=c.rootId,a.uploadId=i,a.index=o,a.total=t,a.size=s.size;var r=new FormData;r.append("multiRequest",JSON.stringify(a)),r.append("file",s),c.multiUpload(r).subscribe(function(e){if(null!=e.error)c.files[c.files.indexOf(u)].uploadResult=!1,c.files[c.files.indexOf(u)].isUploading=!1,c.files[c.files.indexOf(u)].errorMessage=e.error.Message;else if(n.push(e.result),c.uploadedChunk[p]++,c.files[c.files.indexOf(u)].uploadProcess=Number.parseInt((c.uploadedChunk[p]/c.fileTotalChunk[p]*100).toFixed(0)),c.uploadedChunk[p]==c.fileTotalChunk[p])if(n.length==c.fileTotalChunk[p]){var t=new P;t.metadataId=p,t.partList=n,t.rootId=c.rootId,t.uploadId=i,t.size=u.fileSize,c.haveExtensionProperty&&(t.exPropertyName=c.defaultPropertyName),c.completeMultiUpload(t).subscribe(function(e){200!=e.status?(c.files[c.files.indexOf(u)].uploadResult=!1,c.files[c.files.indexOf(u)].isUploading=!1,c.files[c.files.indexOf(u)].errorMessage=e.error.Message):(c.files[c.files.indexOf(u)].uploadResult=!0,c.files[c.files.indexOf(u)].isUploading=!1,c.uploadFileInfoList=c.uploadFileInfoList.concat(f),c.uploadedFileInfoList=c.uploadedFileInfoList.concat(f),c.uploadedFileTotal++)})}else c.files[c.files.indexOf(u)].uploadResult=!1,c.files[c.files.indexOf(u)].isUploading=!1,c.files[c.files.indexOf(u)].errorMessage=c.localepipe.transform("mismatchChunkSize")}),o+=1}}})}else{var o=new A;o.formId=this.formId,o.metadataId=p,o.mode=w.Temp,o.rootId=this.rootId,o.size=d.size,o.fileName=e,this.haveExtensionProperty&&(o.exPropertyName=this.defaultPropertyName);var n=new FormData;n.append("uploadEntity",JSON.stringify(o)),n.append("file",d),this.uploadSingleFile(n).subscribe(function(e){null!=e?(c.files[c.files.indexOf(u)].uploadResult=!1,c.files[c.files.indexOf(u)].isUploading=!1,c.files[c.files.indexOf(u)].errorMessage=e.error.Message):(c.files[c.files.indexOf(u)].uploadResult=!0,c.files[c.files.indexOf(u)].isUploading=!1,c.uploadFileInfoList=c.uploadFileInfoList.concat(f),c.uploadedFileInfoList=c.uploadedFileInfoList.concat(f),c.uploadedFileTotal++)})}var l=-1;this.files.forEach(function(e){e.name==u.name&&-1==l&&(l=c.files.indexOf(e))}),-1!=l&&l!=this.files.length-1&&(this.files.splice(l,1),this.uploadFileInfoList.splice(l,1),this.uploadedFileInfoList.splice(l,1))},e.prototype.uploadSingleFile=function(e){return this.httpclient.post("/api/runtime/dfs/v1.0/formdoc/single",e).pipe(l.tap(function(e){}),l.catchError(function(e){return g.of(e)}))},e.prototype.uploadSliceFile=function(e){return this.httpclient.post("/api/runtime/dfs/v1.0/formdoc/slice",e).pipe(l.tap(function(e){}),l.catchError(function(e){return g.of(e)}))},e.prototype.initMultiUpload=function(e){return this.httpclient.post("/api/runtime/dfs/v1.0/formdoc/multi/init",e).pipe(l.tap(function(e){}),l.catchError(function(e){return g.of(e)}))},e.prototype.multiUpload=function(e){return this.httpclient.post("/api/runtime/dfs/v1.0/formdoc/multi/upload",e).pipe(l.tap(function(e){}),l.catchError(function(e){return g.of(e)}))},e.prototype.completeMultiUpload=function(e){return this.httpclient.post("/api/runtime/dfs/v1.0/formdoc/multi/complete",e).pipe(l.tap(function(e){}),l.catchError(function(e){return g.of(e)}))},e.prototype.selectAllFile=function(){this.fileAllSelected?(this.files.forEach(function(e){e.selectd=!1}),this.fileAllSelected=!1,this.selectedFileCount=0):(this.files.forEach(function(e){e.selectd=!0}),this.fileAllSelected=!0,this.selectedFileCount=this.files.length)},e.prototype.checkoutSelectFile=function(e){e.selectd=!e.selectd,e.selectd?this.selectedFileCount++:this.selectedFileCount--,this.selectedFileCount==this.files.length?this.fileAllSelected=!0:this.fileAllSelected=!1},e.prototype.listDeleteFile=function(t){if(t.selectd&&this.selectedFileCount--,this.files.splice(this.files.indexOf(t),1),t.uploadResult){var e=[];e.push(t.id),this.uploadService.cancel(e,this.rootId).subscribe(),this.uploadFileInfoList.splice(this.uploadFileInfoList.indexOf(this.uploadFileInfoList.filter(function(e){return e.fileName==t.name})[0]),1),this.uploadedFileInfoList.splice(this.uploadedFileInfoList.indexOf(this.uploadedFileInfoList.filter(function(e){return e.fileName==t.name})[0]),1),this.uploadedFileTotal--}0==this.selectedFileCount&&(this.fileAllSelected=!1)},e.prototype.listMultipleDeleteFile=function(){var e=this,t=[];this.files.forEach(function(e){document.getElementById(e.name).checked&&t.push(e)});var i=[];t.forEach(function(t){i.push(t.id),e.files.splice(e.files.indexOf(t),1),t.uploadResult&&(e.uploadFileInfoList.splice(e.uploadFileInfoList.indexOf(e.uploadFileInfoList.filter(function(e){return e.fileName==t.name})[0]),1),e.uploadedFileInfoList.splice(e.uploadedFileInfoList.indexOf(e.uploadedFileInfoList.filter(function(e){return e.fileName==t.name})[0]),1),e.uploadedFileTotal--)}),this.uploadService.cancel(i,this.rootId).subscribe();var o=document.getElementById("allCheckBox");null!=o&&(o.checked=!1),this.selectedFileCount=0,this.fileAllSelected=!1},e.prototype.getPicListDisplayName=function(e){return e.length<=10?e:e.substring(0,2)+"…"+e.substring(e.lastIndexOf(".")-2)},e.prototype.getQueueDisplayName=function(e){return e},e.prototype.addDocInfo=function(e,o,t){var n=this;switch(t){case S.Word:o.source="/platform/runtime/dfs/images/word.png",this.files.push(o);break;case S.Pdf:o.source="/platform/runtime/dfs/images/pdf.png",this.files.push(o);break;case S.Excel:o.source="/platform/runtime/dfs/images/excel.png",this.files.push(o);break;case S.Txt:o.source="/platform/runtime/dfs/images/txt.png",this.files.push(o);break;case S.Powerpoint:o.source="/platform/runtime/dfs/images/ppt.png",this.files.push(o);break;case S.Other:o.source="/platform/runtime/dfs/images/file.png",this.files.push(o);break;case S.Image:var l=new FileReader;l.readAsDataURL(e),l.onload=function(e){var t=l.result;null!=n.injector&&(t=n.injector.get(s.DomSanitizer).bypassSecurityTrustResourceUrl(t));o.source=t,n.files.push(o);var i=-1;n.files.forEach(function(e){e.name==o.name&&-1==i&&(i=n.files.indexOf(e))}),-1!=i&&i!=n.files.length-1&&(n.files.splice(i,1),n.uploadFileInfoList.splice(i,1),n.uploadedFileInfoList.splice(i,1))}}},e.prototype.listToString=function(e){for(var t="",i=0;i<e.length;i++)t+=e[i]+",";return t},e.prototype.securityChange=function(e,t){t.securityInfo=e.data,this.uploadFileInfoList.filter(function(e){return e.metadataId=t.id})[0].securityInfo=e.data},e.prototype.typeChange=function(e,t){t.extensionName=e.data.name;var i=new z;t.extensionName==this.storageExtension.defaultPropertyName?0<this.exStorageFileList.filter(function(e){return e.metadataId==t.id}).length&&this.exStorageFileList.splice(this.exStorageFileList.findIndex(function(e){return e.metadataId==t.id}),1):0<this.exStorageFileList.filter(function(e){return e.metadataId==t.id}).length?(i=this.exStorageFileList.filter(function(e){return e.metadataId==t.id})[0]).exPropertyName=t.extensionName:(i.metadataId=t.id,i.exPropertyName=t.extensionName,this.exStorageFileList.push(i))},e.prototype.upload=function(){var t=this;if(this.uploadedFileTotal!=this.files.filter(function(e){return e.isUploading||e.uploadResult}).length)return this.msgService.warning(this.localepipe.transform("wait")),g.of(!1);if(this.haveSecurityInfo&&this.uploadService.saveSecurityInfo(this.uploadFileInfoList,this.rootId).subscribe(),null==this.storageExtension)return g.of(this.uploadFileInfoList);if(0==this.exStorageFileList.length)return g.of(this.uploadFileInfoList);var i=this.loadService.show({message:this.localepipe.transform("saveTo")+this.storageExtension.extensionName});return this.uploadService.changeStorageInstance(this.exStorageFileList,this.rootId).pipe(l.map(function(e){return i.close(),t.uploadFileInfoList}))},e.prototype.cancel=function(){var t=this;0!=this.uploadFileInfoList.length&&(this.uploadFileInfoList.forEach(function(e){t.metadataIdList.push(e.metadataId)}),this.uploadService.cancel(this.metadataIdList,this.rootId).subscribe())},e.prototype.getUploadFileInfoList=function(){return this.uploadFileInfoList},e.prototype["delete"]=function(t){this.files.splice(this.files.indexOf(t),1),t.uploadResult&&this.uploadedFileTotal--,0<this.exStorageFileList.filter(function(e){return e.metadataId==t.id}).length&&this.exStorageFileList.splice(this.exStorageFileList.findIndex(function(e){return e.metadataId==t.id}),1)},e.prototype.getFileSize=function(e){return e<102400?(e/1024).toFixed(1)+"K":e<1048576?(e/1024).toFixed(0)+"K":e<104857600?(e/1024/1024).toFixed(1)+"M":e<1073741824?(e/1024/1024).toFixed(0)+"M":(e/1024/1024/1024).toFixed(1)+"G"},e.prototype.showByGroup=function(){this.showType=0},e.prototype.showByList=function(){this.showType=1,0!=this.selectedFileCount&&this.selectedFileCount==this.files.length&&(this.fileAllSelected=!0)},e.prototype.mouseOver=function(e){e.mouseOn=!0},e.prototype.mouseOut=function(e){e.mouseOn=!1},e.decorators=[{type:h.Component,args:[{selector:"app-file-upload",template:'<div *ngIf="hasSelectedFile">\n\n    <div class="farris-header" style="height: 50px; width: 100%">\n        <div class="btn btn-secondary upload_button">\n            <img [src]="uploadLittleIconAddress">\n            <span>{{\'uploadFile\' | locale}} </span>\n            <input type="file" (focus)="showLoading()" (change)="fileSelected($event)" id="file" multiple="multiple"\n                title="" [accept]="fileType">\n        </div>\n\n\n        <button *ngIf="showType==0 && !fileAllSelected && files.length >0 " style="padding-left: 20px"\n            class="btn-link btn ng-star-inserted" (click)="selectAllFile()">{{\'selectAll\' | locale}}</button>\n        <button *ngIf="showType==0 && fileAllSelected  && files.length >0 " style="padding-left: 20px"\n            class="btn-link btn ng-star-inserted" (click)="selectAllFile()">{{\'selectNull\' | locale}}</button>\n        <button *ngIf="showType==0 && selectedFileCount>0" style="padding-left: 20px"\n            class="btn-link btn ng-star-inserted" (click)="listMultipleDeleteFile()">{{\'delete\' | locale}}</button>\n\n        <button *ngIf="showType==1 && selectedFileCount>0" style="padding-left: 20px"\n            class="btn-link btn ng-star-inserted" (click)="listMultipleDeleteFile()">{{\'delete\' | locale}}</button>\n\n        <farris-radio-group class="button_group_upload" [(model)]="radioButtonGroupValue" [horizontal]="false">\n            <farris-radio-button [label]="\'showByGroup\'" (click)="showByGroup()">\n                <span  class="f-icon f-icon-sudoku-new"> </span>\n            </farris-radio-button>\n            <farris-radio-button [label]="\'showByList\'" (click)="showByList()">\n                <span  class="f-icon f-icon-page-title-define"> </span>\n            </farris-radio-button>\n\n        </farris-radio-group>\n\n        \x3c!-- <kendo-buttongroup [selection]="\'single\'" class="button_group_upload "\n            style="background-color: #ffffff; color: #388FFF;border: 1px solid #ddd;" look="flat">\n            <button kendoButton [selected]="true" [toggleable]="true"\n                [imageUrl]="\'/platform/runtime/dfs/images/piclist.png\'" (click)="showByGroup()"></button>\n            <button kendoButton [toggleable]="true" [imageUrl]="\'/platform/runtime/dfs/images/queuelist.png\'"\n                (click)="showByList()"></button>\n        </kendo-buttongroup> --\x3e\n\n\n    </div>\n\n    \x3c!-- <div class="progress" style="height: 12px;">\n    <div class="progress-bar" role="progressbar" [ngStyle]="uploadProcess"></div>\n  </div> --\x3e\n\n    <div class="pic_list" *ngIf="showType==0">\n        <ul *ngFor="let file of files">\n            <li (mouseenter)="mouseOver(file)" (mouseleave)="mouseOut(file)">\n                <div *ngIf="file.isUploading">\n                    <farris-progress [type]="\'circle\'" [percent]="file.uploadProcess" [strokeLinecap]="\'square\'"\n                        [status]="\'active\'"></farris-progress>\n                </div>\n\n                <table *ngIf="!file.uploadResult && !file.isUploading"\n                    style="margin: 0 auto; border: 1px solid #ddd; width: 135px; height: 160px;">\n                    <tr style="margin: 0 auto ; height: 80px;">\n                        <td style="text-align: center"><span class="f-icon f-icon-warn"></span></td>\n                    </tr>\n                    <tr style="margin: 0 auto ; height: 30px;">\n                        <td style="text-align: center"> {{\'uploadFailure\' | locale}} </td>\n                    </tr>\n                    <tr>\n                        <td style="text-align: center"><button style="margin: 0 auto ; height: 20px; "\n                                class="btn-link btn ng-star-inserted" (click)="showErrorMessage(file)">{{\'detail\' |\n                                locale}}</button></td>\n                    </tr>\n                </table>\n                <div *ngIf="!file.isUploading && file.uploadResult" style="border: 1px solid #ddd;">\n                    <img [src]=\'file.source\'>\n                    <div *ngIf="haveExtensionProperty"\n                        style="width: 133px; height: 25px; background-color: white; position: absolute;bottom: 0; ">\n\n                        <div style="width: 100px;height: 25px;position:absolute;margin: 0 17px;">\n                            <farris-combo-list [(ngModel)]="file.extensionDropListId" [data]="propertiesNames"\n                                [idField]="\'id\'" [textField]="\'name\'" (selectChange)="typeChange($event,file)"\n                                [enableClear]="false">\n                                \x3c!-- <ng-template #itemTemp let-item>\n                                    <div class="combo-list">\n                                        <span [class]="\'combo-list-circle combo-list-\'+item.state"></span>\n                                        <span class="combo-list-label">{{item.label}}</span>\n                                    </div>\n                                </ng-template> --\x3e\n                            </farris-combo-list>\n                        </div>\n                    </div>\n                    <div *ngIf="haveSecurityInfo"\n                        style="width: 133px; height: 25px; background-color: white; position: absolute;bottom: 0; ">\n\n                        <div style="width: 100px;height: 25px;position:absolute;margin: 0 17px;">\n                            <farris-combo-list [(ngModel)]="file.extensionDropListId" [data]="securityInfoList"\n                                [idField]="\'id\'" [textField]="\'name\'" (selectChange)="securityChange($event,file)"\n                                [enableClear]="false">\n                                \x3c!-- <ng-template #itemTemp let-item>\n                                    <div class="combo-list">\n                                        <span [class]="\'combo-list-circle combo-list-\'+item.state"></span>\n                                        <span class="combo-list-label">{{item.label}}</span>\n                                    </div>\n                                </ng-template> --\x3e\n                            </farris-combo-list>\n                        </div>\n                    </div>\n                </div>\n                <table *ngIf="!file.isUploading">\n                    <tr style="height: 20px">\n                        <td style="width: 15px; vertical-align: middle; text-align: center">\n                            \x3c!-- <input type="checkbox" [id]="file.name" (click)="checkoutSelectFile(file.name)">  --\x3e\n                            <div class="farris-input-wrap" style="height: 20px" (click)="checkoutSelectFile(file)">\n                                <div class="custom-control custom-checkbox" style="margin: 4px 0 0;height: 20px;"\n                                    [ngStyle]="checkboxPos">\n                                    <input class="custom-control-input" type="checkbox" [id]="file.name"\n                                        [(ngModel)]="file.selectd">\n                                    <label class="custom-control-label"\n                                        style="padding: 0 0 10px 0; position: relative; top: -8px;"></label>\n                                </div>\n                            </div>\n                        </td>\n                        <td style="width: 120px; vertical-align: middle; text-align: center" [title]="file.name">\n                            {{file.picListDisplayName}}</td>\n                    </tr>\n                </table>\n                \x3c!-- <span>{{file.picListDisplayName}}</span> --\x3e\n                \x3c!-- <p class="filename">{{file.picListDisplayName}}</p> --\x3e\n                <button *ngIf="!file.isUploading && file.mouseOn"\n                    style="position: absolute; top: 0; right: 0px; width: 24px; height: 24px; border: none;"\n                    (click)="listDeleteFile(file)">\n                    <span style="position: relative;  right: 2px; " class="f-icon f-icon-delete"> </span>\n                </button>\n                \x3c!-- <button *ngIf="file.hasUploaded" class="k-primary" kendoButton [icon]="\'check\'" [disabled]="true"></button> --\x3e\n            </li>\n        </ul>\n        <br>\n    </div>\n\n    <div class="queue_list" *ngIf="showType==1">\n        <table>\n            <tr style="height: 50px; table-layout:fixed;">\n                <th style="width: 40px; vertical-align: middle; text-align: center">\n                    \x3c!-- <input type="checkbox" id="allCheckBox" (click)="selectAllFile()"> --\x3e\n                    <div class="farris-input-wrap" (click)="selectAllFile()">\n                        <div class="custom-control custom-checkbox" style="margin: 4px 0 0">\n                            <input class="custom-control-input" type="checkbox" id="allCheckBox"\n                                [(ngModel)]="fileAllSelected">\n                            <label class="custom-control-label" style="padding: 0"></label>\n                        </div>\n                    </div>\n                </th>\n                <th style="vertical-align: middle" [ngStyle]="queueListStyle">{{\'fileName\' | locale}}</th>\n                <th style="width: 100px; vertical-align: middle">{{\'size\' | locale}}</th>\n                <th style="width: 170px; vertical-align: middle; text-align: center">{{\'state\' | locale}}</th>\n                <th *ngIf="haveExtensionProperty" style="width: 100px; vertical-align: middle; text-align: center">\n                    {{storageExtension.extensionName}}\n                </th>\n                <th style="width: 140px; vertical-align: middle; text-align: center">{{\'operation\' | locale}}</th>\n            </tr>\n        </table>\n        <div style="height: 370px; overflow: auto;">\n            <table>\n                <tr *ngFor="let file of files" style="height: 40px">\n                    <td colspan="5" *ngIf="file.isUploading">\n                        \x3c!-- <div style="width:100%; display: table-cell; vertical-align: middle; text-align: center; "> --\x3e\n                        <div style="width: 500px;margin:0 auto">\n                            <farris-progress [percent]="file.uploadProcess" [status]="\'active\'">\n                            </farris-progress>\n                        </div>\n\n                    </td>\n                    <td *ngIf="!file.isUploading" style=" width: 40px; vertical-align: middle; text-align: center">\n                        \x3c!-- <input type="checkbox" [id]="file.name" (click)="checkoutSelectFile(file.name)"> --\x3e\n                        <div class="farris-input-wrap" (click)="checkoutSelectFile(file)">\n                            <div class="custom-control custom-checkbox" style="margin: 4px 0 0">\n                                <input class="custom-control-input" type="checkbox" [id]="file.name"\n                                    [(ngModel)]="file.selectd">\n                                <label class="custom-control-label" style="padding: 0"></label>\n                            </div>\n                        </div>\n                    </td>\n                    <td *ngIf="!file.isUploading" style="vertical-align: middle" [ngStyle]="queueListStyle">\n                        {{file.queueListDisplayName}}</td>\n                    <td *ngIf="!file.isUploading" style="width: 100px; vertical-align: middle">{{file.size}}</td>\n                    <td *ngIf="!file.isUploading" style="text-align: center; width: 170px; vertical-align: middle;">\n                        <table *ngIf="!file.uploadResult" style="margin: 0 auto">\n                            <tr style="margin: 0 auto">\n                                <td><span class="f-icon f-icon-error"></span></td>\n                                <td> {{\'uploadFailure\' | locale}} </td>\n                                <td><button style="height: 24px" class="btn-link btn ng-star-inserted"\n                                        (click)="showErrorMessage(file)">{{\'detail\' | locale}}</button></td>\n                            </tr>\n                        </table>\n                        \x3c!-- <span *ngIf="!file.uploadResult"><span class="f-icon f-icon-error"></span> 上传失败 <button\n              class="btn-link btn ng-star-inserted" (click)="showErrorMessage(file)">详情</button></span> --\x3e\n                        <span *ngIf="file.uploadResult"><span class="f-icon f-icon-success"></span> {{\'uploadSucceed\' |\n                            locale}}</span>\n                    </td>\n                    <td *ngIf="!file.isUploading&&haveExtensionProperty"\n                        style="text-align: center; width: 100px; vertical-align: middle;">\n                        <farris-combo-list [(ngModel)]="file.extensionDropListId" [data]="propertiesNames"\n                            [idField]="\'id\'" [textField]="\'name\'" (selectChange)="typeChange($event,file)"\n                            [enableClear]="false">\n                            \x3c!-- <ng-template #itemTemp let-item>\n                                    <div class="combo-list">\n                                        <span [class]="\'combo-list-circle combo-list-\'+item.state"></span>\n                                        <span class="combo-list-label">{{item.label}}</span>\n                                    </div>\n                                </ng-template> --\x3e\n                        </farris-combo-list>\n                    </td>\n                    <td *ngIf="!file.isUploading&&haveSecurityInfo"\n                        style="text-align: center; width: 100px; vertical-align: middle;">\n                        <farris-combo-list [(ngModel)]="file.extensionDropListId" [data]="securityInfoList"\n                            [idField]="\'id\'" [textField]="\'name\'" (selectChange)="securityChange($event,file)"\n                            [enableClear]="false">\n                            \x3c!-- <ng-template #itemTemp let-item>\n                            <div class="combo-list">\n                                <span [class]="\'combo-list-circle combo-list-\'+item.state"></span>\n                                <span class="combo-list-label">{{item.label}}</span>\n                            </div>\n                        </ng-template> --\x3e\n                        </farris-combo-list>\n                    </td>\n\n                    <td *ngIf="!file.isUploading" style="text-align: center; width: 140px; vertical-align: middle;">\n                        \x3c!-- <button *ngIf="file.uploadResult" class="btn-link btn ng-star-inserted" (click)="retryUploadFile(file.name)">重试</button> --\x3e\n                        <button class="btn-link btn ng-star-inserted" style="margin: 0 auto"\n                            (click)="listDeleteFile(file)">{{\'delete\' | locale}}</button>\n                    </td>\n\n                </tr>\n            </table>\n        </div>\n    </div>\n</div>\n\n<div *ngIf="!hasSelectedFile" class=\'home_page\'>\n    <img [src]="uploadIconAddress">\n    <div>\n        <span class="btn btn-primary btn-lg">{{\'uploadFile\' | locale}} </span>\n        <input type="file" (change)="fileSelected($event)" id="file" multiple="multiple" title="" [accept]="fileType">\n        \x3c!-- <input type="file" (focus)="showLoading()" (change)="fileSelected($event)" id="file" multiple="multiple" title="" [accept]="fileType"> --\x3e\n    </div>\n</div>',styles:[".home_page{text-align:center}.home_page img{position:absolute;top:180px;margin-left:-35px;width:70px;height:56px}.home_page div{position:absolute;left:50%;top:255px;margin-left:-75px;width:150px;height:32px;overflow:hidden}.home_page div span{width:150px;height:32px;position:absolute;z-index:10;left:0}.home_page div input{position:absolute;left:0;top:0;opacity:0;filter:'alpha(opacity=0)';z-index:11}.upload_button{width:110px;height:32px;overflow:hidden}.upload_button span{position:relative;right:-4px;top:4px;width:56px;height:22px;font-size:14px}.upload_button input{height:32px;width:110px;position:absolute;left:22px;top:12px;opacity:0;filter:'alpha(opacity=0)';overflow:hidden}.upload_button img{position:relative;left:-6px;top:3px;width:14px;height:14px}.button_group_upload{position:absolute;right:18px;top:12px;height:26px;width:90px}.button_group_upload button{height:26px;width:26px}.fileinput-button{position:absolute;right:60px;bottom:40px;overflow:hidden;width:24px;height:24px;border-radius:12px;transform:scale(2.5);-ms-transform:scale(2.5);-moz-transform:scale(2.5);-webkit-transform:scale(2.5);-o-transform:scale(2.5);color:#0686fd}.fileinput-button input{position:absolute;left:0;top:0;opacity:0;filter:'alpha(opacity=0)'}.pic-droplist{height:24px;color:#e0e1e2;background-color:#e0e1e2}.pic-droplist input-group{display:table-cell;width:100px;text-align:center;border:0}.pic-droplist input-group div{border:0}.pic-droplist input-group div div,.pic-droplist input-group div input{background-color:#e0e1e2}.pic_list{padding:0;height:415px;overflow-y:auto;overflow-x:hidden}.pic_list ul{padding:0;list-style:none;width:100%;margin:20px 0 0 20px}.pic_list ul li{height:179px;width:135px;margin:8px 0 8px 12px;float:left;overflow:hidden;align-items:center;position:relative}.pic_list ul li div{width:135px;height:159px;margin:auto;display:table-cell;vertical-align:middle;text-align:center;position:relative}.pic_list ul li div img{max-width:120px;max-height:118px;align-items:center;margin:auto;vertical-align:middle;text-align:center}.pic_list ul li span.filename{width:100px;text-align:center;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.queue_list{display:block;height:420px;overflow-y:auto}.file_list{list-style:none;margin:0;padding:0;overflow-x:hidden;overflow-y:auto}.file_list li{height:50px;line-height:35px;font-size:16px;position:relative}.file_list li button{float:right;top:6px;right:10px;width:20px}.file_list li p.title{padding:0 0 0 6px;margin:0 210px 0 0}.file_list li p.size{position:absolute;width:100px;top:0;right:100px}"]}]}],e.ctorParameters=function(){return[{type:o.MessagerService},{type:U},{type:a.LoadingService},{type:h.Injector}]},e.propDecorators={formId:[{type:h.Input}],rootId:[{type:h.Input}],fileType:[{type:h.Input}],fileCount:[{type:h.Input}],oldIdList:[{type:h.Input}],securityInfo:[{type:h.Input}],opCell:[{type:h.ViewChild,args:["opCell"]}]},e}(),q=function(){function e(){}return e.prototype.getDownloadUrl=function(e,t){return"/api/runtime/dfs/v1.0/doc/filecontent?metadataid="+e+"&rootid="+t+"&token="+this.getToken(this.mergeString(e,t))},e.prototype.getStreamDownloadUrl=function(e,t){return"/api/runtime/dfs/v1.0/formdoc/stream?metadataid="+e+"&rootid="+t+"&token="+this.getToken(this.mergeString(e,t))},e.prototype.getMultipleDownloadUrl=function(e,t){var i=JSON.parse(e);return"/api/runtime/dfs/v1.0/doc/multiple/download?metadataidlist="+e+"&rootid="+t+"&token="+this.getToken(this.mergeString(i[0],t))},e.prototype.getMultipleDownloadUrlWithName=function(e,t,i){var o=JSON.parse(e);return null!=i&&""!=i||(i="unifile.zip"),i.endsWith(".zip")||(i+=".zip"),"/api/runtime/dfs/v1.0/doc/compress/download?metadataidlist="+e+"&rootid="+t+"&token="+this.getToken(this.mergeString(o[0],t))+"&zipName="+encodeURIComponent(i)},e.prototype.getHistoryDownloadUrl=function(e,t,i){return"/api/runtime/dfs/v1.0/doc/historycontent?metadataid="+e+"&rootid="+t+"&version="+i+"&token="+this.getToken(this.mergeString(e,t))},e.prototype.mergeString=function(e,t){var i=e.length<t.length?e.length:t.length,o="",n=0;for(n=0;n<i;n++)o+=e.substring(n,n+1),o+=t.substring(n,n+1);return o+=e.length<t.length?t.substring(n):e.substring(n)},e.prototype.getToken=function(e){var t=[1,2,3];24<e.length&&(e=e.substring(0,24));var i=Math.floor(e.length/3),o=e.substring(0,i),n=e.substring(i,2*i),l=e.substring(2*i,3*i),s=[],a=Math.ceil(3*Math.random());s.push(t[a-1]),t.splice(a-1,1),a=Math.ceil(2*Math.random()),s.push(t[a-1]),t.splice(a-1,1),s.push(t[0]);var r=Math.round((new Date).getTime()/1e3)+"";return r.substring(0,5)+"times"+s[0]+s[1]+s[2]+this.switchStr(o,n,l,s[0])+this.switchStr(o,n,l,s[1])+this.switchStr(o,n,l,s[2])+"times"+r.substring(5)},e.prototype.switchStr=function(e,t,i,o){switch(o){case 1:return e;case 2:return t;case 3:return i}},e.decorators=[{type:h.Injectable}],e.ctorParameters=function(){return[]},e}(),j=localStorage.getItem("languageCode")||"zh-CHS",B=function(){function e(){}return e.decorators=[{type:h.NgModule,args:[{declarations:[R,D],imports:[i.CommonModule,x.NotifyModule,o.MessagerModule.forRoot(),a.LoadingModule.forRoot(),r.ProgressModule,d.FormsModule,u.FarrisFormsModule,c.ComboListModule,y.HttpClientModule],exports:[R],entryComponents:[R],providers:[U,q,f.LanguageService,f.HttpService,f.CacheService,f.SessionService,{provide:h.LOCALE_ID,useValue:j}]}]}],e}(),G=B,H=function(){function e(e){this.modalService=e,this.metadataIdList=[]}return e.prototype.ngOnInit=function(){},e.prototype.showDialog=function(){var e=this;this.dlg=this.modalService.show(R,{title:"选择文件",width:800,height:500,buttons:[{text:"上传",cls:"k-button k-button-icontext k-primary",iconCls:"k-icon k-i-check",handle:function(){e.fileUpload.upload(),e.dlg.close()}},{text:"关闭",cls:"k-button k-button-icontext",iconCls:"k-icon k-i-close",handle:function(){e.fileUpload.cancel(),e.dlg.close()}}],showButtons:!0}),this.dlg.content.formId=this.formId},e.decorators=[{type:h.Component,args:[{selector:"app-uploaddialog",template:"\n",styles:[""]}]}],e.ctorParameters=function(){return[{type:m.BsModalService}]},e.propDecorators={formId:[{type:h.Input}],fileUpload:[{type:h.ViewChild,args:[R]}]},e}(),W=function(){function e(e,t,i){this.modalService=e,this.componentFactoryResolver=t,this.injector=i,this.fileInfoList=[],this.injector&&(this.modalService=this.injector.get(m.BsModalService),this.localeid=localStorage.getItem("languageCode")||this.injector.get(h.LOCALE_ID),this.localpipe=new D(this.localeid))}return e.prototype.showDialog=function(i,o){var n=this,l=0;return new Promise(function(t){var e=n.componentFactoryResolver.resolveComponentFactory(R).create(n.injector);e.instance.rootId=o,e.instance.formId=i,n.dlg=n.modalService.show(e,{title:n.localpipe.transform("uploadFile"),width:950,height:570,buttons:[{text:n.localpipe.transform("save"),cls:"k-button k-button-icontext k-primary",handle:function(){n.dlg.content.upload().subscribe(function(e){e&&(t(e),l=1,n.dlg.close())})}},{text:n.localpipe.transform("close"),cls:"k-button k-button-icontext",handle:function(){n.dlg.close()}}],showButtons:!0,showMaxButton:!1,beforeClose:function(){return 0==l&&n.dlg.content.cancel(),g.of(!0)}})})},e.prototype.uploadFile=function(e,t,i){return void 0===i&&(i=[]),this.uploadFileWithLimit(e,t,null,i)},e.prototype.uploadFileWithLimit=function(i,o,n,l){var s=this;void 0===l&&(l=[]);var a=0;return new Promise(function(t){var e=s.componentFactoryResolver.resolveComponentFactory(R).create(s.injector);null!=n&&(e.instance.fileCount=n.fileCount,e.instance.securityInfo=n.securityInfo,null!=n.fileType&&""!=n.fileType&&(e.instance.fileType=n.fileType)),e.instance.rootId=o,e.instance.formId=i,e.instance.oldIdList=l,s.dlg=s.modalService.show(e,{title:s.localpipe.transform("uploadFile"),width:950,height:570,buttons:[{text:s.localpipe.transform("save"),cls:"k-button k-button-icontext k-primary",handle:function(){s.dlg.content.upload().subscribe(function(e){e&&(t(e),a=1,s.dlg.close())})}},{text:s.localpipe.transform("close"),cls:"k-button k-button-icontext",handle:function(){s.dlg.close()}}],showButtons:!0,showMaxButton:!1,beforeClose:function(){return 0==a&&s.dlg.content.cancel(),g.of(!0)}})})},e.decorators=[{type:h.Injectable}],e.ctorParameters=function(){return[{type:m.BsModalService},{type:h.ComponentFactoryResolver},{type:h.Injector}]},e}(),J=function(){function e(){}return e.decorators=[{type:h.NgModule,args:[{declarations:[H],imports:[i.CommonModule,t.FarrisDialogModule,o.MessagerModule.forRoot(),B,x.NotifyModule.forRoot(),y.HttpClientModule],exports:[H,R],entryComponents:[H,R],providers:[m.BsModalService,f.HttpService,W,U]}]}],e}(),V=function ce(){this.fileType="*",this.fileCount=0,this.securityInfo=null},$=function ue(){},Z=function fe(){},K=function he(){},Q=function me(){},X=function ge(){},Y=function ye(){},ee=function xe(){};e.FormdocUploadService=v,e.FormdocUploadComponent=b,e.FormdocUploadModule=F,e.UploadDialogMoudle=J,e.UploadDialogComponent=H,e.UploadDialogService=W,e.UploadService=U,e.DownloadService=q,e.FileUploadComponent=R,e.UploadFileInfo=M,e.UploadModule=B,e.ɵa=G,e.UploadLimit=V,e.GspFormDocOperateEntity=k,e.GspFormRemoveListEntity=L,e.GspFormUploadListEntity=$,e.GspFormDocInfo=Z,e.GspDocMetaProperty=K,e.GspFormUploadEntity=Q,e.FileInfo=X,e.OperatingModes=w,e.FileState=O,e.GspDocSecurityBaseInfo=Y,e.SecurityEntity=ee,e.ExStorageFileInfo=z,e.CopyFileRequest=N,e.ɵb=D,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=gsp-svc-formdoc-upload.umd.min.js.map
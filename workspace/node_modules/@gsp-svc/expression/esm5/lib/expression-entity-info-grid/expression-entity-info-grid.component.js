/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Component, Input, Output, EventEmitter } from '@angular/core';
import { Property } from '../schema';
import { CurrentNode } from '../currentNode';
import { ExpressionEditorLocalePipe } from '../expression-editor-locale.pipe';
import { NewProperty } from '../i18n/NewSchema';
var ExpressionEntityInfoGridComponent = /** @class */ (function () {
    function ExpressionEntityInfoGridComponent() {
        this.schema = new Map();
        this.newSchemaMap = new Map(); //统一Schema
        //统一Schema
        this.choseEntityTableName = new CurrentNode;
        this.selectSchemaRow = new EventEmitter();
        this.dbclickInsert = new EventEmitter();
        this.selectString = "";
        this.items = [];
        this.columns = [];
        //初始化i18n标识
        this.localeId = localStorage.getItem('languageCode');
        this.localePipe = new ExpressionEditorLocalePipe(this.localeId);
    }
    /**
     * @return {?}
     */
    ExpressionEntityInfoGridComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
    };
    /**
     * @return {?}
     */
    ExpressionEntityInfoGridComponent.prototype.ngOnChanges = /**
     * @return {?}
     */
    function () {
        var _this = this;
        // this.columns = [{ field: 'name', title: this.localePipe.transform("EntityPropList"), filter: true }];
        /** @type {?} */
        var schemaName = this.choseEntityTableName.schema;
        /** @type {?} */
        var parentName = this.choseEntityTableName.parentName;
        /** @type {?} */
        var tableId = this.choseEntityTableName.id;
        /** @type {?} */
        var tableName = this.choseEntityTableName.name;
        /** @type {?} */
        var schemaItem;
        if (this.newSchemaMap && this.newSchemaMap.size > 0) {
            //统一Schema
            this.columns = [{ field: 'code', title: this.localePipe.transform("EntityPropList"), filter: true }];
            this.items = [];
            schemaItem = this.newSchemaMap.get(schemaName);
            if (schemaItem) {
                /** @type {?} */
                var entityType = schemaItem.entityTypes.find((/**
                 * @param {?} entitytype
                 * @return {?}
                 */
                function (entitytype) { return (entitytype.code == tableName) || (entitytype.code == ""); }));
                if (!entityType) {
                    /** @type {?} */
                    var entitySet_1 = schemaItem.entitySets.find((/**
                     * @param {?} entityset
                     * @return {?}
                     */
                    function (entityset) { return entityset.code == tableName; }));
                    if (entitySet_1) {
                        entityType = schemaItem.entityTypes.find((/**
                         * @param {?} entitytype
                         * @return {?}
                         */
                        function (entitytype) { return entitytype.code == entitySet_1.entityType; }));
                    }
                }
                this.items = tslib_1.__spread(entityType.properties);
                entityType.navigationProperties.forEach((/**
                 * @param {?} item
                 * @return {?}
                 */
                function (item) {
                    /** @type {?} */
                    var property = new NewProperty;
                    property.code = item.code;
                    property.name = "";
                    property.dataType = item.navigationType.toString();
                    property.nullable = false;
                    property.defaultValue = null;
                    _this.items.push(property);
                    _this.items = Array.from(_this.items);
                }));
                this.selectString = parentName + "." + entityType.name;
            }
        }
        else {
            //旧的Schema
            this.columns = [{ field: 'name', title: this.localePipe.transform("EntityPropList"), filter: true }];
            this.items = [];
            schemaItem = this.schema.get(schemaName);
            if (schemaItem) {
                /** @type {?} */
                var entityType = schemaItem.entityTypes.find((/**
                 * @param {?} entitytype
                 * @return {?}
                 */
                function (entitytype) { return (entitytype.id == tableId && entitytype.name == tableName) || (entitytype.id == "" && entitytype.name == tableName); }));
                if (entityType) {
                    this.items = tslib_1.__spread(entityType.properties);
                    entityType.navigationProperties.forEach((/**
                     * @param {?} item
                     * @return {?}
                     */
                    function (item) {
                        /** @type {?} */
                        var property = new Property;
                        property.name = item.name;
                        property.type = item.type.toString();
                        property.description = item.description;
                        _this.items.push(property);
                    }));
                    this.selectString = parentName + "." + entityType.name;
                }
                else {
                    /** @type {?} */
                    var entitySet_2 = schemaItem.entitySets.find((/**
                     * @param {?} entityset
                     * @return {?}
                     */
                    function (entityset) { return entityset.name == tableName; }));
                    if (entitySet_2) {
                        /** @type {?} */
                        var eType = schemaItem.entityTypes.find((/**
                         * @param {?} entitytype
                         * @return {?}
                         */
                        function (entitytype) { return entitytype.name == entitySet_2.entityType; }));
                        this.items = tslib_1.__spread(eType.properties);
                        eType.navigationProperties.forEach((/**
                         * @param {?} item
                         * @return {?}
                         */
                        function (item) {
                            /** @type {?} */
                            var property = new Property;
                            property.name = item.name;
                            property.type = item.type.toString();
                            property.description = item.description;
                            _this.items.push(property);
                        }));
                        this.selectString = parentName + "." + entitySet_2.name + ".[0]";
                    }
                }
            }
        }
    };
    //数据：子组件双击插入              (farris双击事件，调整)
    //数据：子组件双击插入              (farris双击事件，调整)
    /**
     * @param {?} $event
     * @return {?}
     */
    ExpressionEntityInfoGridComponent.prototype.ondblclickRow = 
    //数据：子组件双击插入              (farris双击事件，调整)
    /**
     * @param {?} $event
     * @return {?}
     */
    function ($event) {
        //this.dbclickInsert.emit(this.selectString+"."+$event.rowData.name);
        if (this.newSchemaMap && this.newSchemaMap.size > 0) {
            this.dbclickInsert.emit($event.rowData.data.code);
        }
        else if (this.schema && this.schema.size > 0) {
            this.dbclickInsert.emit($event.rowData.data.name);
        }
    };
    /**
     * @param {?} $event
     * @return {?}
     */
    ExpressionEntityInfoGridComponent.prototype.selectRowChange = /**
     * @param {?} $event
     * @return {?}
     */
    function ($event) {
        this.selectSchemaRow.emit($event.data);
    };
    ExpressionEntityInfoGridComponent.decorators = [
        { type: Component, args: [{
                    selector: 'app-expression-entity-info-grid',
                    template: "<farris-datagrid\r\n[idField]=\"'name'\"\r\n[height]=\"268\"\r\n[columns]=\"columns\" \r\n[data]=\"items\"\r\n[fit]=\"true\"\r\n[fitColumns]=\"true\"\r\n[striped]=\"false\"\r\n[showHeader]=\"true\"\r\n[pagination]=\"false\"\r\n[enableFilterRow]=\"true\"\r\n(dblclickRow)=\"ondblclickRow($event)\"\r\n(selectChanged)=\"selectRowChange($event)\"\r\n>\r\n</farris-datagrid>",
                    styles: [""]
                }] }
    ];
    /** @nocollapse */
    ExpressionEntityInfoGridComponent.ctorParameters = function () { return []; };
    ExpressionEntityInfoGridComponent.propDecorators = {
        schema: [{ type: Input }],
        newSchemaMap: [{ type: Input }],
        choseEntityTableName: [{ type: Input }],
        selectSchemaRow: [{ type: Output }],
        dbclickInsert: [{ type: Output }]
    };
    return ExpressionEntityInfoGridComponent;
}());
export { ExpressionEntityInfoGridComponent };
if (false) {
    /**
     * @type {?}
     * @private
     */
    ExpressionEntityInfoGridComponent.prototype.localeId;
    /**
     * @type {?}
     * @private
     */
    ExpressionEntityInfoGridComponent.prototype.localePipe;
    /** @type {?} */
    ExpressionEntityInfoGridComponent.prototype.schema;
    /** @type {?} */
    ExpressionEntityInfoGridComponent.prototype.newSchemaMap;
    /** @type {?} */
    ExpressionEntityInfoGridComponent.prototype.choseEntityTableName;
    /** @type {?} */
    ExpressionEntityInfoGridComponent.prototype.selectSchemaRow;
    /** @type {?} */
    ExpressionEntityInfoGridComponent.prototype.dbclickInsert;
    /** @type {?} */
    ExpressionEntityInfoGridComponent.prototype.selectString;
    /** @type {?} */
    ExpressionEntityInfoGridComponent.prototype.items;
    /** @type {?} */
    ExpressionEntityInfoGridComponent.prototype.columns;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZXhwcmVzc2lvbi1lbnRpdHktaW5mby1ncmlkLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0Bnc3Atc3ZjL2V4cHJlc3Npb24vIiwic291cmNlcyI6WyJsaWIvZXhwcmVzc2lvbi1lbnRpdHktaW5mby1ncmlkL2V4cHJlc3Npb24tZW50aXR5LWluZm8tZ3JpZC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFVLEtBQUssRUFBRSxNQUFNLEVBQUUsWUFBWSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQy9FLE9BQU8sRUFBVSxRQUFRLEVBQUUsTUFBTSxXQUFXLENBQUM7QUFDN0MsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQzdDLE9BQU8sRUFBRSwwQkFBMEIsRUFBRSxNQUFNLGtDQUFrQyxDQUFDO0FBQzlFLE9BQU8sRUFBRSxXQUFXLEVBQWEsTUFBTSxtQkFBbUIsQ0FBQztBQUUzRDtJQW1CRTtRQVJTLFdBQU0sR0FBRyxJQUFJLEdBQUcsRUFBa0IsQ0FBQztRQUNuQyxpQkFBWSxHQUFHLElBQUksR0FBRyxFQUFxQixDQUFDLENBQUcsVUFBVTs7UUFDekQseUJBQW9CLEdBQUcsSUFBSSxXQUFXLENBQUM7UUFDdEMsb0JBQWUsR0FBRyxJQUFJLFlBQVksRUFBRSxDQUFDO1FBQ3JDLGtCQUFhLEdBQUcsSUFBSSxZQUFZLEVBQUUsQ0FBQztRQUM3QyxpQkFBWSxHQUFXLEVBQUUsQ0FBQztRQUMxQixVQUFLLEdBQUMsRUFBRSxDQUFDO1FBQ1QsWUFBTyxHQUFHLEVBQUUsQ0FBQztRQUVYLFdBQVc7UUFDWCxJQUFJLENBQUMsUUFBUSxHQUFHLFlBQVksQ0FBQyxPQUFPLENBQUMsY0FBYyxDQUFDLENBQUM7UUFDckQsSUFBSSxDQUFDLFVBQVUsR0FBRyxJQUFJLDBCQUEwQixDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQztJQUNsRSxDQUFDOzs7O0lBRUQs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Q0FBQyxFQUFFO1lBQzlDLElBQUksQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1NBQ25EO0lBQ0gsQ0FBQzs7Ozs7SUFDRCwyREFBZTs7OztJQUFmLFVBQWdCLE1BQU07UUFDcEIsSUFBSSxDQUFDLGVBQWUsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQ3pDLENBQUM7O2dCQTVHRixTQUFTLFNBQUM7b0JBQ1QsUUFBUSxFQUFFLGlDQUFpQztvQkFDM0MsOFhBQTJEOztpQkFFNUQ7Ozs7O3lCQU9FLEtBQUs7K0JBQ0wsS0FBSzt1Q0FDTCxLQUFLO2tDQUNMLE1BQU07Z0NBQ04sTUFBTTs7SUE4RlQsd0NBQUM7Q0FBQSxBQTdHRCxJQTZHQztTQXhHWSxpQ0FBaUM7Ozs7OztJQUc1QyxxREFBeUI7Ozs7O0lBQ3pCLHVEQUErQzs7SUFFL0MsbURBQTRDOztJQUM1Qyx5REFBcUQ7O0lBQ3JELGlFQUFnRDs7SUFDaEQsNERBQStDOztJQUMvQywwREFBNkM7O0lBQzdDLHlEQUEwQjs7SUFDMUIsa0RBQVM7O0lBQ1Qsb0RBQWEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIE9uSW5pdCwgSW5wdXQsIE91dHB1dCwgRXZlbnRFbWl0dGVyIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IFNjaGVtYSwgUHJvcGVydHkgfSBmcm9tICcuLi9zY2hlbWEnO1xyXG5pbXBvcnQgeyBDdXJyZW50Tm9kZSB9IGZyb20gJy4uL2N1cnJlbnROb2RlJztcclxuaW1wb3J0IHsgRXhwcmVzc2lvbkVkaXRvckxvY2FsZVBpcGUgfSBmcm9tICcuLi9leHByZXNzaW9uLWVkaXRvci1sb2NhbGUucGlwZSc7XHJcbmltcG9ydCB7IE5ld1Byb3BlcnR5LCBOZXdTY2hlbWEgfSBmcm9tICcuLi9pMThuL05ld1NjaGVtYSc7XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICBzZWxlY3RvcjogJ2FwcC1leHByZXNzaW9uLWVudGl0eS1pbmZvLWdyaWQnLFxyXG4gIHRlbXBsYXRlVXJsOiAnLi9leHByZXNzaW9uLWVudGl0eS1pbmZvLWdyaWQuY29tcG9uZW50Lmh0bWwnLFxyXG4gIHN0eWxlVXJsczogWycuL2V4cHJlc3Npb24tZW50aXR5LWluZm8tZ3JpZC5jb21wb25lbnQuY3NzJ11cclxufSlcclxuZXhwb3J0IGNsYXNzIEV4cHJlc3Npb25FbnRpdHlJbmZvR3JpZENvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCB7XHJcblxyXG4gIC8v5a6a5LmJaTE4buagh+ivhlxyXG4gIHByaXZhdGUgbG9jYWxlSWQ6IHN0cmluZztcclxuICBwcml2YXRlIGxvY2FsZVBpcGU6IEV4cHJlc3Npb25FZGl0b3JMb2NhbGVQaXBlO1xyXG5cclxuICBASW5wdXQoKSBzY2hlbWEgPSBuZXcgTWFwPHN0cmluZywgU2NoZW1hPigpO1xyXG4gIEBJbnB1dCgpIG5ld1NjaGVtYU1hcCA9IG5ldyBNYXA8c3RyaW5nLCBOZXdTY2hlbWE+KCk7ICAgLy/nu5/kuIBTY2hlbWFcclxuICBASW5wdXQoKSBjaG9zZUVudGl0eVRhYmxlTmFtZSA9IG5ldyBDdXJyZW50Tm9kZTtcclxuICBAT3V0cHV0KCkgc2VsZWN0U2NoZW1hUm93ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG4gIEBPdXRwdXQoKSBkYmNsaWNrSW5zZXJ0ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG4gIHNlbGVjdFN0cmluZzogc3RyaW5nID0gXCJcIjtcclxuICBpdGVtcz1bXTtcclxuICBjb2x1bW5zID0gW107XHJcbiAgY29uc3RydWN0b3IoKSB7XHJcbiAgICAvL+WIneWni+WMlmkxOG7moIfor4ZcclxuICAgIHRoaXMubG9jYWxlSWQgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnbGFuZ3VhZ2VDb2RlJyk7XHJcbiAgICB0aGlzLmxvY2FsZVBpcGUgPSBuZXcgRXhwcmVzc2lvbkVkaXRvckxvY2FsZVBpcGUodGhpcy5sb2NhbGVJZCk7XHJcbiAgfVxyXG5cclxuICBuZ09uSW5pdCgpIHtcclxuICB9XHJcbiAgbmdPbkNoYW5nZXMoKTogdm9pZCB7XHJcbiAgICAvLyB0aGlzLmNvbHVtbnMgPSBbeyBmaWVsZDogJ25hbWUnLCB0aXRsZTogdGhpcy5sb2NhbGVQaXBlLnRyYW5zZm9ybShcIkVudGl0eVByb3BMaXN0XCIpLCBmaWx0ZXI6IHRydWUgfV07XHJcbiAgICBsZXQgc2NoZW1hTmFtZSA9IHRoaXMuY2hvc2VFbnRpdHlUYWJsZU5hbWUuc2NoZW1hO1xyXG4gICAgbGV0IHBhcmVudE5hbWUgPSB0aGlzLmNob3NlRW50aXR5VGFibGVOYW1lLnBhcmVudE5hbWU7XHJcbiAgICBsZXQgdGFibGVJZCA9IHRoaXMuY2hvc2VFbnRpdHlUYWJsZU5hbWUuaWQ7XHJcbiAgICBsZXQgdGFibGVOYW1lID0gdGhpcy5jaG9zZUVudGl0eVRhYmxlTmFtZS5uYW1lO1xyXG4gICAgbGV0IHNjaGVtYUl0ZW07XHJcbiAgICBpZiAodGhpcy5uZXdTY2hlbWFNYXAgJiYgdGhpcy5uZXdTY2hlbWFNYXAuc2l6ZSA+IDApIHtcclxuICAgICAgLy/nu5/kuIBTY2hlbWFcclxuICAgICAgdGhpcy5jb2x1bW5zID0gW3sgZmllbGQ6ICdjb2RlJywgdGl0bGU6IHRoaXMubG9jYWxlUGlwZS50cmFuc2Zvcm0oXCJFbnRpdHlQcm9wTGlzdFwiKSwgZmlsdGVyOiB0cnVlIH1dO1xyXG4gICAgICB0aGlzLml0ZW1zID0gW107XHJcbiAgICAgIHNjaGVtYUl0ZW0gPSB0aGlzLm5ld1NjaGVtYU1hcC5nZXQoc2NoZW1hTmFtZSk7XHJcbiAgICAgIGlmIChzY2hlbWFJdGVtKSB7XHJcbiAgICAgICAgbGV0IGVudGl0eVR5cGUgPSBzY2hlbWFJdGVtLmVudGl0eVR5cGVzLmZpbmQoZW50aXR5dHlwZSA9PiAoZW50aXR5dHlwZS5jb2RlID09IHRhYmxlTmFtZSApIHx8IChlbnRpdHl0eXBlLmNvZGUgPT0gXCJcIikpO1xyXG4gICAgICAgIGlmICghZW50aXR5VHlwZSkge1xyXG4gICAgICAgICAgbGV0IGVudGl0eVNldCA9IHNjaGVtYUl0ZW0uZW50aXR5U2V0cy5maW5kKGVudGl0eXNldCA9PiBlbnRpdHlzZXQuY29kZSA9PSB0YWJsZU5hbWUpO1xyXG4gICAgICAgICAgaWYgKGVudGl0eVNldCkge1xyXG4gICAgICAgICAgICBlbnRpdHlUeXBlID0gc2NoZW1hSXRlbS5lbnRpdHlUeXBlcy5maW5kKGVudGl0eXR5cGUgPT4gZW50aXR5dHlwZS5jb2RlID09IGVudGl0eVNldC5lbnRpdHlUeXBlKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5pdGVtcyA9IFsuLi5lbnRpdHlUeXBlLnByb3BlcnRpZXNdO1xyXG4gICAgICAgIGVudGl0eVR5cGUubmF2aWdhdGlvblByb3BlcnRpZXMuZm9yRWFjaChpdGVtID0+IHtcclxuICAgICAgICAgIGxldCBwcm9wZXJ0eSA9IG5ldyBOZXdQcm9wZXJ0eTtcclxuICAgICAgICAgIHByb3BlcnR5LmNvZGUgPSBpdGVtLmNvZGU7XHJcbiAgICAgICAgICBwcm9wZXJ0eS5uYW1lID0gXCJcIjtcclxuICAgICAgICAgIHByb3BlcnR5LmRhdGFUeXBlID0gaXRlbS5uYXZpZ2F0aW9uVHlwZS50b1N0cmluZygpO1xyXG4gICAgICAgICAgcHJvcGVydHkubnVsbGFibGUgPSBmYWxzZTtcclxuICAgICAgICAgIHByb3BlcnR5LmRlZmF1bHRWYWx1ZSA9IG51bGw7XHJcbiAgICAgICAgICB0aGlzLml0ZW1zLnB1c2gocHJvcGVydHkpO1xyXG4gICAgICAgICAgdGhpcy5pdGVtcyA9IEFycmF5LmZyb20odGhpcy5pdGVtcyk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgdGhpcy5zZWxlY3RTdHJpbmcgPSBwYXJlbnROYW1lICsgXCIuXCIgKyBlbnRpdHlUeXBlLm5hbWU7XHJcbiAgICAgIH1cclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIC8v5pen55qEU2NoZW1hXHJcbiAgICAgIHRoaXMuY29sdW1ucyA9IFt7IGZpZWxkOiAnbmFtZScsIHRpdGxlOiB0aGlzLmxvY2FsZVBpcGUudHJhbnNmb3JtKFwiRW50aXR5UHJvcExpc3RcIiksIGZpbHRlcjogdHJ1ZSB9XTtcclxuICAgICAgdGhpcy5pdGVtcyA9IFtdO1xyXG4gICAgICBzY2hlbWFJdGVtID0gdGhpcy5zY2hlbWEuZ2V0KHNjaGVtYU5hbWUpO1xyXG4gICAgICBpZiAoc2NoZW1hSXRlbSkge1xyXG4gICAgICAgIGxldCBlbnRpdHlUeXBlID0gc2NoZW1hSXRlbS5lbnRpdHlUeXBlcy5maW5kKGVudGl0eXR5cGUgPT4gKGVudGl0eXR5cGUuaWQgPT0gdGFibGVJZCAmJiBlbnRpdHl0eXBlLm5hbWUgPT0gdGFibGVOYW1lKSB8fCAoZW50aXR5dHlwZS5pZCA9PSBcIlwiICYmIGVudGl0eXR5cGUubmFtZSA9PSB0YWJsZU5hbWUpKTtcclxuICAgICAgICBpZiAoZW50aXR5VHlwZSkge1xyXG4gICAgICAgICAgdGhpcy5pdGVtcyA9IFsuLi5lbnRpdHlUeXBlLnByb3BlcnRpZXNdO1xyXG4gICAgICAgICAgZW50aXR5VHlwZS5uYXZpZ2F0aW9uUHJvcGVydGllcy5mb3JFYWNoKGl0ZW0gPT4ge1xyXG4gICAgICAgICAgICBsZXQgcHJvcGVydHkgPSBuZXcgUHJvcGVydHk7XHJcbiAgICAgICAgICAgIHByb3BlcnR5Lm5hbWUgPSBpdGVtLm5hbWU7XHJcbiAgICAgICAgICAgIHByb3BlcnR5LnR5cGUgPSBpdGVtLnR5cGUudG9TdHJpbmcoKTtcclxuICAgICAgICAgICAgcHJvcGVydHkuZGVzY3JpcHRpb24gPSBpdGVtLmRlc2NyaXB0aW9uO1xyXG4gICAgICAgICAgICB0aGlzLml0ZW1zLnB1c2gocHJvcGVydHkpO1xyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgICB0aGlzLnNlbGVjdFN0cmluZyA9IHBhcmVudE5hbWUgKyBcIi5cIiArIGVudGl0eVR5cGUubmFtZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICBsZXQgZW50aXR5U2V0ID0gc2NoZW1hSXRlbS5lbnRpdHlTZXRzLmZpbmQoZW50aXR5c2V0ID0+IGVudGl0eXNldC5uYW1lID09IHRhYmxlTmFtZSk7XHJcbiAgICAgICAgICBpZiAoZW50aXR5U2V0KSB7XHJcbiAgICAgICAgICAgIGxldCBlVHlwZSA9IHNjaGVtYUl0ZW0uZW50aXR5VHlwZXMuZmluZChlbnRpdHl0eXBlID0+IGVudGl0eXR5cGUubmFtZSA9PSBlbnRpdHlTZXQuZW50aXR5VHlwZSk7XHJcbiAgICAgICAgICAgIHRoaXMuaXRlbXMgPSBbLi4uZVR5cGUucHJvcGVydGllc107XHJcbiAgICAgICAgICAgIGVUeXBlLm5hdmlnYXRpb25Qcm9wZXJ0aWVzLmZvckVhY2goaXRlbSA9PiB7XHJcbiAgICAgICAgICAgICAgbGV0IHByb3BlcnR5ID0gbmV3IFByb3BlcnR5O1xyXG4gICAgICAgICAgICAgIHByb3BlcnR5Lm5hbWUgPSBpdGVtLm5hbWU7XHJcbiAgICAgICAgICAgICAgcHJvcGVydHkudHlwZSA9IGl0ZW0udHlwZS50b1N0cmluZygpO1xyXG4gICAgICAgICAgICAgIHByb3BlcnR5LmRlc2NyaXB0aW9uID0gaXRlbS5kZXNjcmlwdGlvbjtcclxuICAgICAgICAgICAgICB0aGlzLml0ZW1zLnB1c2gocHJvcGVydHkpO1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICB0aGlzLnNlbGVjdFN0cmluZyA9IHBhcmVudE5hbWUgKyBcIi5cIiArIGVudGl0eVNldC5uYW1lICsgXCIuWzBdXCI7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvL+aVsOaNru+8muWtkOe7hOS7tuWPjOWHu+aPkuWFpSAgICAgICAgICAgICAgKGZhcnJpc+WPjOWHu+S6i+S7tu+8jOiwg+aVtClcclxuICBvbmRibGNsaWNrUm93KCRldmVudCkge1xyXG4gICAgLy90aGlzLmRiY2xpY2tJbnNlcnQuZW1pdCh0aGlzLnNlbGVjdFN0cmluZytcIi5cIiskZXZlbnQucm93RGF0YS5uYW1lKTtcclxuICAgIGlmICh0aGlzLm5ld1NjaGVtYU1hcCAmJiB0aGlzLm5ld1NjaGVtYU1hcC5zaXplID4gMCkge1xyXG4gICAgICB0aGlzLmRiY2xpY2tJbnNlcnQuZW1pdCgkZXZlbnQucm93RGF0YS5kYXRhLmNvZGUpO1xyXG4gICAgfSBlbHNlIGlmICh0aGlzLnNjaGVtYSAmJiB0aGlzLnNjaGVtYS5zaXplID4gMCkge1xyXG4gICAgICB0aGlzLmRiY2xpY2tJbnNlcnQuZW1pdCgkZXZlbnQucm93RGF0YS5kYXRhLm5hbWUpO1xyXG4gICAgfVxyXG4gIH1cclxuICBzZWxlY3RSb3dDaGFuZ2UoJGV2ZW50KSB7XHJcbiAgICB0aGlzLnNlbGVjdFNjaGVtYVJvdy5lbWl0KCRldmVudC5kYXRhKTtcclxuICB9XHJcbn1cclxuIl19
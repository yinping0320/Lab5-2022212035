/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, ViewChild, Input, Injector, Output, EventEmitter } from '@angular/core';
import { DatagridComponent } from '@farris/ui-datagrid';
import { ExpressionEventService } from '../expression-event-service';
import { FuncOnEntity } from './funcentitys';
import { HttpClient } from "@angular/common/http";
import { FunctionI18nResources } from '../i18n/FunctionI18nResource';
import { ExpressionEditorLocalePipe } from '../expression-editor-locale.pipe';
var ExprFuncGridComponent = /** @class */ (function () {
    function ExprFuncGridComponent(eventService, injector, http) {
        this.eventService = eventService;
        this.injector = injector;
        this.http = http;
        this.currentFuncTabType = "String";
        this.funcExtend = [];
        this.selectFuncRow = new EventEmitter();
        this.dbclickInsert = new EventEmitter();
        this.items = [];
        this.standardFunctions = []; //规范函数
        //规范函数
        this.allFunctions = []; //所有函数，包含不规范
        //所有函数，包含不规范
        this.deprecatedFunctions = [
            "StringSubstring", "StringLength", "StringReplace", "StringToUpper", "StringToLower", "StringIndexOf", "StringLastIndexOf", "StringTrimStart", "StringTrimEnd", "StringTrim", "StringAdd",
            "Round", "BankerRound",
            "getComputeJsonData",
            "ToDecimal", "ToSingle"
        ]; //函数调整，一些函数由于命名不规范而不使用，并为这些函数提供规范命名的实现。为了支持已经保存的表达式，不规范命名函数将会保留，但是会被过滤掉
        //函数调整，一些函数由于命名不规范而不使用，并为这些函数提供规范命名的实现。为了支持已经保存的表达式，不规范命名函数将会保留，但是会被过滤掉
        this.columns = [];
        // if(this.injector)
        // {
        // this.http=this.injector.get(HttpClient);
        //初始化i18n标识
        this.localeId = localStorage.getItem('languageCode');
        this.localePipe = new ExpressionEditorLocalePipe(this.localeId);
        // }
    }
    /**
     * @return {?}
     */
    ExprFuncGridComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.eventService.subClearFuncSelect().subscribe((/**
         * @return {?}
         */
        function () {
            _this.dg.clearAll();
        }));
        this.columns = [
            { field: 'name', title: this.localePipe.transform("FunctionSemanticName"), width: 180 },
            { field: 'key', title: this.localePipe.transform("FunctionName"), width: 180 },
            { field: 'param', title: this.localePipe.transform("FunctionParameter"), width: 250 }
        ];
        //获取i18n函数资源；过滤不规范命名函数
        this.allFunctions = FunctionI18nResources[this.localeId] || FunctionI18nResources["zh-CHS"];
        for (var i = 0; i < this.allFunctions.length; i++) {
            if (!this.deprecatedFunctions.includes(this.allFunctions[i].key)) {
                this.standardFunctions.push(this.allFunctions[i]);
            }
        }
        switch (this.currentFuncTabType) {
            case "String":
                this.findFunctionByType("String");
                break;
            case "DateTime":
                this.findFunctionByType("DateTime");
                break;
            case "Aggregate":
                this.findFunctionByType("Aggregate");
                break;
            case "Translate":
                this.findFunctionByType("Translate");
                break;
            case "Estimate":
                this.findFunctionByType("Estimate");
                break;
            case "Math":
                this.findFunctionByType("Math");
                break;
            case "Analytical":
                this.findFunctionByType("Analytical");
                break;
            case "Advanced":
                this.findFunctionByType("Advanced");
                break;
            case "Extend":
                this.findFunctionByType("Extend");
                break;
        }
        /** @type {?} */
        var itmeList = [];
        /**
         * 封装提供给表达式编辑器
         * 1：Advanced使用key,不使用name
         */
        this.items.forEach((/**
         * @param {?} funcitem
         * @return {?}
         */
        function (funcitem) {
            /** @type {?} */
            var func = new FuncOnEntity;
            if (funcitem.type == "Advanced") {
                func.name = funcitem.key;
            }
            else {
                func.name = funcitem.name;
            }
            func.key = funcitem.key;
            func.params = funcitem.params;
            func.type = funcitem.type;
            func.className = funcitem.className;
            func.description = funcitem.description;
            func.param = "(";
            for (var i = 0; i < funcitem.params.length - 1; i++) {
                // func.param = func.param + funcitem.params[i].name + ":" + funcitem.params[i].type + ",";
                func.param = func.param + funcitem.params[i].key + ",";
            }
            if (funcitem.params.length != 0) {
                // func.param = func.param + funcitem.params[funcitem.params.length - 1].name + ":" + funcitem.params[funcitem.params.length - 1].type + ")";
                func.param = func.param + funcitem.params[funcitem.params.length - 1].key + ")";
            }
            else
                func.param = func.param + ")";
            itmeList.push(func);
        }));
        this.items = itmeList;
    };
    /**
     * @return {?}
     */
    ExprFuncGridComponent.prototype.ngOnChanges = /**
     * @return {?}
     */
    function () {
    };
    /**
     * @param {?} $event
     * @return {?}
     */
    ExprFuncGridComponent.prototype.ondblclickRow = /**
     * @param {?} $event
     * @return {?}
     */
    function ($event) {
        this.dbclickInsert.emit($event.rowData);
    };
    /**
     * @param {?} $event
     * @return {?}
     */
    ExprFuncGridComponent.prototype.selectRowChange = /**
     * @param {?} $event
     * @return {?}
     */
    function ($event) {
        this.selectFuncRow.emit($event.data);
    };
    /**
     * @param {?} type
     * @return {?}
     */
    ExprFuncGridComponent.prototype.findFunctionByType = /**
     * @param {?} type
     * @return {?}
     */
    function (type) {
        var _this = this;
        this.items = [];
        this.standardFunctions.forEach((/**
         * @param {?} element
         * @return {?}
         */
        function (element) {
            if (element.type == type) {
                _this.items.push(element);
            }
            ;
        }));
    };
    ExprFuncGridComponent.decorators = [
        { type: Component, args: [{
                    selector: 'app-expr-func-grid',
                    template: "<div style=\"height: 100%;width: 100%;\">\r\n<farris-datagrid #dg\r\n[idField]=\"'key'\"\r\n[columns]=\"columns\" \r\n[data]=\"items\"\r\n[fit]=\"true\"\r\n[fitColumns]=\"false\"\r\n[striped]=\"false\"\r\n[showHeader]=\"true\"\r\n[headerHeight]=\"30\"\r\n[pagination]=\"false\"\r\n(dblclickRow)=\"ondblclickRow($event)\"\r\n(selectChanged)=\"selectRowChange($event)\"\r\n>\r\n</farris-datagrid>\r\n</div>\r\n",
                    styles: [""]
                }] }
    ];
    /** @nocollapse */
    ExprFuncGridComponent.ctorParameters = function () { return [
        { type: ExpressionEventService },
        { type: Injector },
        { type: HttpClient }
    ]; };
    ExprFuncGridComponent.propDecorators = {
        dg: [{ type: ViewChild, args: ['dg',] }],
        currentFuncTabType: [{ type: Input }],
        funcExtend: [{ type: Input }],
        selectFuncRow: [{ type: Output }],
        dbclickInsert: [{ type: Output }]
    };
    return ExprFuncGridComponent;
}());
export { ExprFuncGridComponent };
if (false) {
    /**
     * @type {?}
     * @private
     */
    ExprFuncGridComponent.prototype.localeId;
    /**
     * @type {?}
     * @private
     */
    ExprFuncGridComponent.prototype.localePipe;
    /** @type {?} */
    ExprFuncGridComponent.prototype.dg;
    /** @type {?} */
    ExprFuncGridComponent.prototype.currentFuncTabType;
    /** @type {?} */
    ExprFuncGridComponent.prototype.funcExtend;
    /** @type {?} */
    ExprFuncGridComponent.prototype.selectFuncRow;
    /** @type {?} */
    ExprFuncGridComponent.prototype.dbclickInsert;
    /** @type {?} */
    ExprFuncGridComponent.prototype.items;
    /** @type {?} */
    ExprFuncGridComponent.prototype.standardFunctions;
    /** @type {?} */
    ExprFuncGridComponent.prototype.allFunctions;
    /** @type {?} */
    ExprFuncGridComponent.prototype.deprecatedFunctions;
    /** @type {?} */
    ExprFuncGridComponent.prototype.columns;
    /**
     * @type {?}
     * @private
     */
    ExprFuncGridComponent.prototype.eventService;
    /**
     * @type {?}
     * @private
     */
    ExprFuncGridComponent.prototype.injector;
    /** @type {?} */
    ExprFuncGridComponent.prototype.http;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZXhwci1mdW5jLWdyaWQuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGdzcC1zdmMvZXhwcmVzc2lvbi8iLCJzb3VyY2VzIjpbImxpYi9leHByLWZ1bmMtZ3JpZC9leHByLWZ1bmMtZ3JpZC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQVUsU0FBUyxFQUFFLEtBQUssRUFBWSxRQUFRLEVBQUUsTUFBTSxFQUFXLFlBQVksRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUV2SCxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUN4RCxPQUFPLEVBQUUsc0JBQXNCLEVBQUUsTUFBTSw2QkFBNkIsQ0FBQztBQUNyRSxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzdDLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUNsRCxPQUFPLEVBQUUscUJBQXFCLEVBQUUsTUFBTSw4QkFBOEIsQ0FBQztBQUNyRSxPQUFPLEVBQUUsMEJBQTBCLEVBQUUsTUFBTSxrQ0FBa0MsQ0FBQztBQUU5RTtJQVdFLCtCQUFvQixZQUFvQyxFQUFTLFFBQWtCLEVBQVEsSUFBaUI7UUFBeEYsaUJBQVksR0FBWixZQUFZLENBQXdCO1FBQVMsYUFBUSxHQUFSLFFBQVEsQ0FBVTtRQUFRLFNBQUksR0FBSixJQUFJLENBQWE7UUFXbkcsdUJBQWtCLEdBQVEsUUFBUSxDQUFDO1FBQ25DLGVBQVUsR0FBbUIsRUFBRSxDQUFDO1FBQy9CLGtCQUFhLEdBQUcsSUFBSSxZQUFZLEVBQUUsQ0FBQztRQUNuQyxrQkFBYSxHQUFHLElBQUksWUFBWSxFQUFFLENBQUM7UUFDN0MsVUFBSyxHQUFrQixFQUFFLENBQUM7UUFFMUIsc0JBQWlCLEdBQUcsRUFBRSxDQUFDLENBQUssTUFBTTs7UUFDbEMsaUJBQVksR0FBRyxFQUFFLENBQUMsQ0FBVSxZQUFZOztRQUN4Qyx3QkFB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Q0FBQztJQUNMLENBQUM7O2dCQTVIRixTQUFTLFNBQUM7b0JBQ1QsUUFBUSxFQUFFLG9CQUFvQjtvQkFDOUIsb2FBQThDOztpQkFFL0M7Ozs7Z0JBVlEsc0JBQXNCO2dCQUh5QixRQUFRO2dCQUt2RCxVQUFVOzs7cUJBd0JoQixTQUFTLFNBQUMsSUFBSTtxQ0FFZCxLQUFLOzZCQUNMLEtBQUs7Z0NBQ0wsTUFBTTtnQ0FDTixNQUFNOztJQW9HVCw0QkFBQztDQUFBLEFBN0hELElBNkhDO1NBeEhZLHFCQUFxQjs7Ozs7O0lBR2hDLHlDQUEwQjs7Ozs7SUFDMUIsMkNBQWlEOztJQVdqRCxtQ0FBc0M7O0lBRXRDLG1EQUE0Qzs7SUFDNUMsMkNBQXlDOztJQUN6Qyw4Q0FBNkM7O0lBQzdDLDhDQUE2Qzs7SUFDN0Msc0NBQTBCOztJQUUxQixrREFBdUI7O0lBQ3ZCLDZDQUFrQjs7SUFDbEIsb0RBS0U7O0lBQ0Ysd0NBQWE7Ozs7O0lBekJELDZDQUE0Qzs7Ozs7SUFBQyx5Q0FBMEI7O0lBQUMscUNBQXdCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBPbkluaXQsIFZpZXdDaGlsZCwgSW5wdXQsIE9uQ2hhbmdlcyxJbmplY3RvciwgT3V0cHV0LE9wdGlvbmFsLCBFdmVudEVtaXR0ZXIgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgRnVuY3Rpb25FbnRpdHksRnVuY3Rpb25FbnRpdHlzIH0gZnJvbSAnLi4vZnVuY2VudGl0eSc7XHJcbmltcG9ydCB7IERhdGFncmlkQ29tcG9uZW50IH0gZnJvbSAnQGZhcnJpcy91aS1kYXRhZ3JpZCc7XHJcbmltcG9ydCB7IEV4cHJlc3Npb25FdmVudFNlcnZpY2UgfSBmcm9tICcuLi9leHByZXNzaW9uLWV2ZW50LXNlcnZpY2UnO1xyXG5pbXBvcnQgeyBGdW5jT25FbnRpdHkgfSBmcm9tICcuL2Z1bmNlbnRpdHlzJztcclxuaW1wb3J0IHsgSHR0cENsaWVudCB9IGZyb20gXCJAYW5ndWxhci9jb21tb24vaHR0cFwiO1xyXG5pbXBvcnQgeyBGdW5jdGlvbkkxOG5SZXNvdXJjZXMgfSBmcm9tICcuLi9pMThuL0Z1bmN0aW9uSTE4blJlc291cmNlJztcclxuaW1wb3J0IHsgRXhwcmVzc2lvbkVkaXRvckxvY2FsZVBpcGUgfSBmcm9tICcuLi9leHByZXNzaW9uLWVkaXRvci1sb2NhbGUucGlwZSc7XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICBzZWxlY3RvcjogJ2FwcC1leHByLWZ1bmMtZ3JpZCcsXHJcbiAgdGVtcGxhdGVVcmw6ICcuL2V4cHItZnVuYy1ncmlkLmNvbXBvbmVudC5odG1sJyxcclxuICBzdHlsZVVybHM6IFsnLi9leHByLWZ1bmMtZ3JpZC5jb21wb25lbnQuY3NzJ11cclxufSlcclxuZXhwb3J0IGNsYXNzIEV4cHJGdW5jR3JpZENvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCxPbkNoYW5nZXMge1xyXG5cclxuICAvL+WumuS5iWkxOG7moIfor4ZcclxuICBwcml2YXRlIGxvY2FsZUlkIDogc3RyaW5nO1xyXG4gIHByaXZhdGUgbG9jYWxlUGlwZSA6ICBFeHByZXNzaW9uRWRpdG9yTG9jYWxlUGlwZTtcclxuXHJcbiAgY29uc3RydWN0b3IocHJpdmF0ZSBldmVudFNlcnZpY2U6IEV4cHJlc3Npb25FdmVudFNlcnZpY2UscHJpdmF0ZSBpbmplY3RvcjogSW5qZWN0b3IscHVibGljIGh0dHAgOiBIdHRwQ2xpZW50KXtcclxuICAgIC8vIGlmKHRoaXMuaW5qZWN0b3IpXHJcbiAgICAvLyB7XHJcbiAgICAgIC8vIHRoaXMuaHR0cD10aGlzLmluamVjdG9yLmdldChIdHRwQ2xpZW50KTtcclxuICAgICAgLy/liJ3lp4vljJZpMThu5qCH6K+GXHJcbiAgICAgIHRoaXMubG9jYWxlSWQgPSAgbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2xhbmd1YWdlQ29kZScpO1xyXG4gICAgICB0aGlzLmxvY2FsZVBpcGUgPSBuZXcgRXhwcmVzc2lvbkVkaXRvckxvY2FsZVBpcGUodGhpcy5sb2NhbGVJZCk7XHJcbiAgICAvLyB9XHJcbiAgfVxyXG4gIEBWaWV3Q2hpbGQoJ2RnJykgZGc6RGF0YWdyaWRDb21wb25lbnQ7XHJcblxyXG4gIEBJbnB1dCgpIGN1cnJlbnRGdW5jVGFiVHlwZTpzdHJpbmc9XCJTdHJpbmdcIjtcclxuICBASW5wdXQoKSBmdW5jRXh0ZW5kOiBGdW5jdGlvbkVudGl0eVtdPVtdO1xyXG4gIEBPdXRwdXQoKSBzZWxlY3RGdW5jUm93ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG4gIEBPdXRwdXQoKSBkYmNsaWNrSW5zZXJ0ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG4gIGl0ZW1zOkZ1bmN0aW9uRW50aXR5W109W107XHJcblxyXG4gIHN0YW5kYXJkRnVuY3Rpb25zID0gW107ICAgICAvL+inhOiMg+WHveaVsFxyXG4gIGFsbEZ1bmN0aW9ucyA9IFtdOyAgICAgICAgICAvL+aJgOacieWHveaVsO+8jOWMheWQq+S4jeinhOiMg1xyXG4gIGRlcHJlY2F0ZWRGdW5jdGlvbnMgPSBbXHJcbiAgICBcIlN0cmluZ1N1YnN0cmluZ1wiLCBcIlN0cmluZ0xlbmd0aFwiLCBcIlN0cmluZ1JlcGxhY2VcIiwgXCJTdHJpbmdUb1VwcGVyXCIsIFwiU3RyaW5nVG9Mb3dlclwiLFwiU3RyaW5nSW5kZXhPZlwiLCBcIlN0cmluZ0xhc3RJbmRleE9mXCIsIFwiU3RyaW5nVHJpbVN0YXJ0XCIsIFwiU3RyaW5nVHJpbUVuZFwiLCBcIlN0cmluZ1RyaW1cIixcIlN0cmluZ0FkZFwiLFxyXG4gICAgXCJSb3VuZFwiLCBcIkJhbmtlclJvdW5kXCIsXHJcbiAgICBcImdldENvbXB1dGVKc29uRGF0YVwiLFxyXG4gICAgXCJUb0RlY2ltYWxcIiwgXCJUb1NpbmdsZVwiXHJcbiAgXTsgICAgICAgICAgICAgICAgICAgICAgICAgIC8v5Ye95pWw6LCD5pW077yM5LiA5Lqb5Ye95pWw55Sx5LqO5ZG95ZCN5LiN6KeE6IyD6ICM5LiN5L2/55So77yM5bm25Li66L+Z5Lqb5Ye95pWw5o+Q5L6b6KeE6IyD5ZG95ZCN55qE5a6e546w44CC5Li65LqG5pSv5oyB5bey57uP5L+d5a2Y55qE6KGo6L6+5byP77yM5LiN6KeE6IyD5ZG95ZCN5Ye95pWw5bCG5Lya5L+d55WZ77yM5L2G5piv5Lya6KKr6L+H5ruk5o6JXHJcbiAgY29sdW1ucyA9IFtdO1xyXG4gIG5nT25Jbml0KCkge1xyXG4gICAgdGhpcy5ldmVudFNlcnZpY2Uuc3ViQ2xlYXJGdW5jU2VsZWN0KCkuc3Vic2NyaWJlKCgpPT57XHJcbiAgICAgIHRoaXMuZGcuY2xlYXJBbGwoKTtcclxuICAgIH0pXHJcbiAgICB0aGlzLmNvbHVtbnMgPSBbXHJcbiAgICAgIHsgZmllbGQ6ICduYW1lJywgdGl0bGU6IHRoaXMubG9jYWxlUGlwZS50cmFuc2Zvcm0oXCJGdW5jdGlvblNlbWFudGljTmFtZVwiKSx3aWR0aDoxODB9LFxyXG4gICAgICB7IGZpZWxkOiAna2V5JywgdGl0bGU6IHRoaXMubG9jYWxlUGlwZS50cmFuc2Zvcm0oXCJGdW5jdGlvbk5hbWVcIiksd2lkdGg6MTgwfSxcclxuICAgICAgeyBmaWVsZDogJ3BhcmFtJywgdGl0bGU6IHRoaXMubG9jYWxlUGlwZS50cmFuc2Zvcm0oXCJGdW5jdGlvblBhcmFtZXRlclwiKSx3aWR0aDoyNTB9XHJcbiAgICBdO1xyXG4gICAgLy/ojrflj5ZpMThu5Ye95pWw6LWE5rqQ77yb6L+H5ruk5LiN6KeE6IyD5ZG95ZCN5Ye95pWwXHJcbiAgICB0aGlzLmFsbEZ1bmN0aW9ucyA9IEZ1bmN0aW9uSTE4blJlc291cmNlc1t0aGlzLmxvY2FsZUlkXSB8fCBGdW5jdGlvbkkxOG5SZXNvdXJjZXNbXCJ6aC1DSFNcIl07XHJcbiAgICBmb3IobGV0IGk9MDtpPHRoaXMuYWxsRnVuY3Rpb25zLmxlbmd0aDtpKyspe1xyXG4gICAgICBpZighdGhpcy5kZXByZWNhdGVkRnVuY3Rpb25zLmluY2x1ZGVzKHRoaXMuYWxsRnVuY3Rpb25zW2ldLmtleSkpe1xyXG4gICAgICAgIHRoaXMuc3RhbmRhcmRGdW5jdGlvbnMucHVzaCh0aGlzLmFsbEZ1bmN0aW9uc1tpXSk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAgIHN3aXRjaCh0aGlzLmN1cnJlbnRGdW5jVGFiVHlwZSlcclxuICAgICAge1xyXG4gICAgICAgIGNhc2UgXCJTdHJpbmdcIjpcclxuICAgICAgICAgIHRoaXMuZmluZEZ1bmN0aW9uQnlUeXBlKFwiU3RyaW5nXCIpO2JyZWFrO1xyXG4gICAgICAgIGNhc2UgXCJEYXRlVGltZVwiOlxyXG4gICAgICAgICAgdGhpcy5maW5kRnVuY3Rpb25CeVR5cGUoXCJEYXRlVGltZVwiKTticmVhaztcclxuICAgICAgICBjYXNlIFwiQWdncmVnYXRlXCI6XHJcbiAgICAgICAgICB0aGlzLmZpbmRGdW5jdGlvbkJ5VHlwZShcIkFnZ3JlZ2F0ZVwiKTticmVhaztcclxuICAgICAgICBjYXNlIFwiVHJhbnNsYXRlXCI6XHJcbiAgICAgICAgICB0aGlzLmZpbmRGdW5jdGlvbkJ5VHlwZShcIlRyYW5zbGF0ZVwiKTticmVhaztcclxuICAgICAgICBjYXNlIFwiRXN0aW1hdGVcIjpcclxuICAgICAgICAgIHRoaXMuZmluZEZ1bmN0aW9uQnlUeXBlKFwiRXN0aW1hdGVcIik7YnJlYWs7XHJcbiAgICAgICAgY2FzZSBcIk1hdGhcIjpcclxuICAgICAgICAgIHRoaXMuZmluZEZ1bmN0aW9uQnlUeXBlKFwiTWF0aFwiKTticmVhaztcclxuICAgICAgICBjYXNlIFwiQW5hbHl0aWNhbFwiOlxyXG4gICAgICAgICAgdGhpcy5maW5kRnVuY3Rpb25CeVR5cGUoXCJBbmFseXRpY2FsXCIpO2JyZWFrO1xyXG4gICAgICAgIGNhc2UgXCJBZHZhbmNlZFwiOlxyXG4gICAgICAgICAgdGhpcy5maW5kRnVuY3Rpb25CeVR5cGUoXCJBZHZhbmNlZFwiKTticmVhaztcclxuICAgICAgICBjYXNlIFwiRXh0ZW5kXCI6XHJcbiAgICAgICAgICB0aGlzLmZpbmRGdW5jdGlvbkJ5VHlwZShcIkV4dGVuZFwiKTticmVhaztcclxuICAgICAgfVxyXG4gICAgICBsZXQgaXRtZUxpc3QgPSBbXTtcclxuICAgICAgLyoqXHJcbiAgICAgICAqIOWwgeijheaPkOS+m+e7meihqOi+vuW8j+e8lui+keWZqFxyXG4gICAgICAgKiAx77yaQWR2YW5jZWTkvb/nlKhrZXks5LiN5L2/55SobmFtZVxyXG4gICAgICAgKi9cclxuICAgICAgdGhpcy5pdGVtcy5mb3JFYWNoKGZ1bmNpdGVtID0+IHtcclxuICAgICAgICBsZXQgZnVuYyA9IG5ldyBGdW5jT25FbnRpdHk7XHJcbiAgICAgICAgaWYoZnVuY2l0ZW0udHlwZT09XCJBZHZhbmNlZFwiKXtcclxuICAgICAgICAgIGZ1bmMubmFtZSA9IGZ1bmNpdGVtLmtleTtcclxuICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgIGZ1bmMubmFtZSA9IGZ1bmNpdGVtLm5hbWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGZ1bmMua2V5ID0gZnVuY2l0ZW0ua2V5O1xyXG4gICAgICAgIGZ1bmMucGFyYW1zID0gZnVuY2l0ZW0ucGFyYW1zO1xyXG4gICAgICAgIGZ1bmMudHlwZSA9IGZ1bmNpdGVtLnR5cGU7XHJcbiAgICAgICAgZnVuYy5jbGFzc05hbWUgPSBmdW5jaXRlbS5jbGFzc05hbWU7XHJcbiAgICAgICAgZnVuYy5kZXNjcmlwdGlvbiA9IGZ1bmNpdGVtLmRlc2NyaXB0aW9uO1xyXG4gICAgICAgIGZ1bmMucGFyYW0gPSBcIihcIjsgICAgICBcclxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGZ1bmNpdGVtLnBhcmFtcy5sZW5ndGggLSAxOyBpKyspIHtcclxuICAgICAgICAgIC8vIGZ1bmMucGFyYW0gPSBmdW5jLnBhcmFtICsgZnVuY2l0ZW0ucGFyYW1zW2ldLm5hbWUgKyBcIjpcIiArIGZ1bmNpdGVtLnBhcmFtc1tpXS50eXBlICsgXCIsXCI7XHJcbiAgICAgICAgICBmdW5jLnBhcmFtID0gZnVuYy5wYXJhbSArIGZ1bmNpdGVtLnBhcmFtc1tpXS5rZXkgKyBcIixcIjtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYoZnVuY2l0ZW0ucGFyYW1zLmxlbmd0aCE9MClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAvLyBmdW5jLnBhcmFtID0gZnVuYy5wYXJhbSArIGZ1bmNpdGVtLnBhcmFtc1tmdW5jaXRlbS5wYXJhbXMubGVuZ3RoIC0gMV0ubmFtZSArIFwiOlwiICsgZnVuY2l0ZW0ucGFyYW1zW2Z1bmNpdGVtLnBhcmFtcy5sZW5ndGggLSAxXS50eXBlICsgXCIpXCI7XHJcbiAgICAgICAgICBmdW5jLnBhcmFtID0gZnVuYy5wYXJhbSArIGZ1bmNpdGVtLnBhcmFtc1tmdW5jaXRlbS5wYXJhbXMubGVuZ3RoIC0gMV0ua2V5ICArIFwiKVwiO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGZ1bmMucGFyYW0gPSBmdW5jLnBhcmFtICsgXCIpXCI7XHJcbiAgICAgICAgaXRtZUxpc3QucHVzaChmdW5jKTtcclxuICAgICAgfSk7XHJcbiAgICAgIHRoaXMuaXRlbXMgPSBpdG1lTGlzdDtcclxuICAgIH1cclxuICBuZ09uQ2hhbmdlcygpOiB2b2lkIHtcclxuICB9XHJcbiAgb25kYmxjbGlja1JvdygkZXZlbnQpXHJcbiAge1xyXG4gICAgdGhpcy5kYmNsaWNrSW5zZXJ0LmVtaXQoJGV2ZW50LnJvd0RhdGEpO1xyXG4gIH1cclxuICBzZWxlY3RSb3dDaGFuZ2UoJGV2ZW50KVxyXG4gIHtcclxuICAgIHRoaXMuc2VsZWN0RnVuY1Jvdy5lbWl0KCRldmVudC5kYXRhKTtcclxuICB9XHJcbiAgZmluZEZ1bmN0aW9uQnlUeXBlKHR5cGU6c3RyaW5nKXtcclxuICAgIHRoaXMuaXRlbXM9W107XHJcbiAgICB0aGlzLnN0YW5kYXJkRnVuY3Rpb25zLmZvckVhY2goZWxlbWVudD0+e1xyXG4gICAgICBpZihlbGVtZW50LnR5cGU9PXR5cGUpe1xyXG4gICAgICAgIHRoaXMuaXRlbXMucHVzaChlbGVtZW50KTtcclxuICAgICAgfTtcclxuICAgIH0pO1xyXG4gIH1cclxufVxyXG4iXX0=
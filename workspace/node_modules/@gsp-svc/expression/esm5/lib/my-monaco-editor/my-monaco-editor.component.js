/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, ElementRef, EventEmitter, Input, Output, ViewChild } from '@angular/core';
import { forwardRef, Inject, NgZone } from '@angular/core';
import { NG_VALUE_ACCESSOR } from '@angular/forms';
import { pick } from 'lodash-es';
import { MY_MONACO_EDITOR_CONFIG } from './editorconfig';
import { CodeEditorEventService } from './my-monaco-editor-services/monaco-editor.event.service';
import { CODE_EDITOR_EVENTS } from './my-monaco-editor-services/events';
import { ExpressionEventService } from '../expression-event-service';
/** @type {?} */
var loadedMonaco = false;
/** @type {?} */
var loadPromise;
// 自定义输入控件:1.封装ControlValueAccessor
// https://code-examples.net/zh-CN/q/2154761
/** @type {?} */
export var CODE_EDITOR_INPUT_VALUE_ACCESSOR = {
    // https://blog.csdn.net/wangdan_2013/article/details/81314959
    provide: NG_VALUE_ACCESSOR,
    //
    useExisting: forwardRef((/**
     * @return {?}
     */
    function () { return MyMonacoEditorComponent; })),
    //
    multi: true //
};
/** @type {?} */
var monacoConfig = {
    baseUrl: 'assets',
    defaultOptions: { scrollBeyondLastLine: false }
};
var ɵ0 = monacoConfig;
var MyMonacoEditorComponent = /** @class */ (function () {
    // 注入AngularMonacoEditorConfig，在创建Editor实例时设置config
    function MyMonacoEditorComponent(zone, config, codeEditorEventService, eventService) {
        var _this = this;
        this.zone = zone;
        this.config = config;
        this.codeEditorEventService = codeEditorEventService;
        this.eventService = eventService;
        this._value = '';
        //ControlValueAccessor提供的事件回调
        this.onChangeHandler = (/**
         * @param {?} _
         * @return {?}
         */
        function (_) {
            _this.codeEditorEventService.fireEvent({
                eventName: CODE_EDITOR_EVENTS.onChange,
                target: _this,
                data: _
            });
        });
        //ControlValueAccessor提供的事件回调
        this.onTouchedHandler = (/**
         * @return {?}
         */
        function () {
            _this.codeEditorEventService.fireEvent({
                eventName: CODE_EDITOR_EVENTS.onTouched,
                target: _this
            });
        });
        // 初始化自定义事件
        /** @type {?} */
        var self = this;
        codeEditorEventService.eventNames.forEach((/**
         * @param {?} name
         * @return {?}
         */
        function (name) {
            // 创建自定义事件，此处作用等效于: @Output() onInit = new EventEmitter<any>() 
            self[name] = new EventEmitter();
            /** @type {?} */
            var eventPair = pick(self, name);
            codeEditorEventService.addEvent(eventPair);
        }));
    }
    Object.defineProperty(MyMonacoEditorComponent.prototype, "options", {
        get: /**
         * @return {?}
         */
        function () {
            return this._options;
        },
        set: /**
         * @param {?} options
         * @return {?}
         */
        function (options) {
            // 默认options(this.config.defaultOptions) + 自定义options(options)
            this._options = Object.assign({}, this.config.defaultOptions, options);
            if (this._editor) {
                this._editor.dispose();
                this.initMonaco(options);
            }
        },
        enumerable: true,
        configurable: true
    });
    //在光标处插入表达式的方法
    //在光标处插入表达式的方法
    /**
     * @param {?} insertWord
     * @return {?}
     */
    MyMonacoEditorComponent.prototype.insertWord = 
    //在光标处插入表达式的方法
    /**
     * @param {?} insertWord
     * @return {?}
     */
    function (insertWord) {
        if (insertWord && insertWord != undefined && insertWord != "") {
            /** @type {?} */
            var p = {
                lineNumber: 1,
                column: 1
            };
            if (this._editor) {
                p = this._editor.getPosition();
            }
            /** @type {?} */
            var range = new monaco.Range(p.lineNumber, p.column, p.lineNumber, p.column);
            /** @type {?} */
            var id = { major: 1, minor: 1 };
            /** @type {?} */
            var text = insertWord;
            /** @type {?} */
            var op = { identifier: id, range: range, text: text, forceMoveMarkers: true };
            this._editor.executeEdits("my-source", [op]);
        }
    };
    /**
     * @return {?}
     */
    MyMonacoEditorComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        if (loadedMonaco) {
            // Wait until monaco editor is available
            loadPromise.then((/**
             * @return {?}
             */
            function () {
                _this.initMonaco(_this.options);
            }));
        }
        else {
            loadedMonaco = true;
            loadPromise = new Promise((/**
             * @param {?} resolve
             * @return {?}
             */
            function (resolve) {
                // const baseUrl = this.config.baseUrl || '/assets';
                /** @type {?} */
                var baseUrl = '/platform/common/web/caf';
                // if (typeof((<any>window).monaco) === 'object') {
                //   resolve();
                //   return;
                // }
                /** @type {?} */
                var onGotAmdLoader = (/**
                 * @return {?}
                 */
                function () {
                    // Load monaco
                    ((/** @type {?} */ (window))).require.config({ paths: { 'vs': baseUrl + "/monaco/vs" } });
                    ((/** @type {?} */ (window))).require(['vs/editor/editor.main'], (/**
                     * @return {?}
                     */
                    function () {
                        _this.onMonacoLoad();
                        _this.initMonaco(_this.options);
                        resolve();
                    }));
                });
                // Load AMD loader if necessary
                if (!((/** @type {?} */ (window))).require) {
                    /** @type {?} */
                    var loaderScript = document.createElement('script');
                    loaderScript.type = 'text/javascript';
                    loaderScript.src = baseUrl + "/monaco/vs/loader.js";
                    loaderScript.onload = onGotAmdLoader;
                    document.body.appendChild(loaderScript);
                }
                else {
                    onGotAmdLoader();
                }
            }));
        }
        //在光标处插入表达式事件订阅
        /** @type {?} */
        var temp = this;
        this.eventService.currentExpression().subscribe((/**
         * @param {?} insertexpression
         * @return {?}
         */
        function (insertexpression) {
            if (temp._editor != undefined) {
                temp.insertWord(insertexpression);
            }
        }));
        this.eventService.clearExpression().subscribe((/**
         * @return {?}
         */
        function () {
            if (temp._editor != undefined) {
                temp._editor.setValue("");
            }
        }));
    };
    /**
     * @private
     * @return {?}
     */
    MyMonacoEditorComponent.prototype.onMonacoLoad = /**
     * @private
     * @return {?}
     */
    function () {
        /** @type {?} */
        var id = "foo.json";
        monaco.languages.json.jsonDefaults.setDiagnosticsOptions({
            validate: true,
            schemas: [{
                    uri: "http://myserver/foo-schema.json",
                    fileMatch: [id],
                    schema: {
                        type: "object",
                        properties: {
                            p1: {
                                enum: ["v1", "v2"]
                            },
                            p2: {
                                $ref: "http://myserver/bar-schema.json"
                            }
                        }
                    }
                }, {
                    uri: "http://myserver/bar-schema.json",
                    fileMatch: [id],
                    schema: {
                        type: "object",
                        properties: {
                            q1: {
                                enum: ["x1", "x2"]
                            }
                        }
                    }
                }]
        });
    };
    /**
     * @return {?}
     */
    MyMonacoEditorComponent.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        // if (this._windowResizeSubscription) {
        //   this._windowResizeSubscription.unsubscribe();
        // }
        if (this._editor) {
            this._editor.dispose();
            this._editor = undefined;
        }
    };
    /**
     * @protected
     * @param {?} options
     * @return {?}
     */
    MyMonacoEditorComponent.prototype.initMonaco = /**
     * @protected
     * @param {?} options
     * @return {?}
     */
    function (options) {
        var _this = this;
        debugger;
        console.log("Init the custom monaco code editor.");
        // const hasModel = !!options.model;
        /** @type {?} */
        var hasModel = false;
        // if (hasModel) {
        //   options.model = monaco.editor.createModel(options.model.value, options.model.language, options.model.uri);
        // }
        this._editor = monaco.editor.create(this._editorComponent.nativeElement, options);
        if (!hasModel) {
            this._editor.setValue(this._value);
        }
        // monaco editor -> outside component
        this._editor.onDidChangeModelContent((/**
         * @return {?}
         */
        function () { return _this.onChangeModelContentHandler(); }));
        this._editor.onDidBlurEditorText((/**
         * @return {?}
         */
        function () { return _this.onBlurEditorTextHandler(); }));
        // refresh layout on resize event.
        // if (this._windowResizeSubscription) {
        //   this._windowResizeSubscription.unsubscribe();
        // }
        // this._windowResizeSubscription = fromEvent(window, 'resize').subscribe(() => this._editor.layout());
        this.codeEditorEventService.fireEvent({
            eventName: CODE_EDITOR_EVENTS.onInit,
            target: this,
            editor: this._editor
        });
    };
    /**
     * @return {?}
     */
    MyMonacoEditorComponent.prototype.onChangeModelContentHandler = /**
     * @return {?}
     */
    function () {
        var _this = this;
        /** @type {?} */
        var _value = this._editor.getValue();
        // monaco editor -> outside component
        // https://github.com/JTangming/tm/issues/4 ngZone详解
        this.zone.run((/**
         * @return {?}
         */
        function () { return _this.value = _value; })); // value is not propagated to parent when executing outside zone.
        // console.log("write from the monaco:" + this._value);
    };
    /**
     * @return {?}
     */
    MyMonacoEditorComponent.prototype.onBlurEditorTextHandler = /**
     * @return {?}
     */
    function () {
        this.onTouchedHandler();
    };
    Object.defineProperty(MyMonacoEditorComponent.prototype, "value", {
        //get accessor
        get: 
        //get accessor
        /**
         * @return {?}
         */
        function () {
            return this._value;
        },
        //set accessor including call the onchange callback
        set: 
        //set accessor including call the onchange callback
        /**
         * @param {?} v
         * @return {?}
         */
        function (v) {
            if (v !== this.value) { // 注意这种写法，值得学习
                this._value = v;
            }
            this.onChangeHandler(this.value); //在属性修饰器里调用onchangeHandler方法
        },
        enumerable: true,
        configurable: true
    });
    ;
    /**
     * @return {?}
     */
    MyMonacoEditorComponent.prototype.localEditor = /**
     * @return {?}
     */
    function () {
        this.writeValue('test');
    };
    // 自定义输入控件:3.2 implements ControlValueAccesso
    // outside component -> monaco editor
    //From ControlValueAccessor interface
    // 自定义输入控件:3.2 implements ControlValueAccesso
    // outside component -> monaco editor
    //From ControlValueAccessor interface
    /**
     * @param {?} value
     * @return {?}
     */
    MyMonacoEditorComponent.prototype.writeValue = 
    // 自定义输入控件:3.2 implements ControlValueAccesso
    // outside component -> monaco editor
    //From ControlValueAccessor interface
    /**
     * @param {?} value
     * @return {?}
     */
    function (value) {
        var _this = this;
        this.value = value || '';
        // Fix for value change while dispose in process.
        setTimeout((/**
         * @return {?}
         */
        function () {
            if (_this._editor /*&& !this.options.model*/) {
                _this._editor.setValue(_this._value);
                // console.log("write to the editor:" + this._value);
            }
        }));
    };
    //From ControlValueAccessor interface
    //From ControlValueAccessor interface
    /**
     * @param {?} fn
     * @return {?}
     */
    MyMonacoEditorComponent.prototype.registerOnChange = 
    //From ControlValueAccessor interface
    /**
     * @param {?} fn
     * @return {?}
     */
    function (fn) {
        this.onChangeHandler(this);
    };
    //From ControlValueAccessor interface
    //From ControlValueAccessor interface
    /**
     * @param {?} fn
     * @return {?}
     */
    MyMonacoEditorComponent.prototype.registerOnTouched = 
    //From ControlValueAccessor interface
    /**
     * @param {?} fn
     * @return {?}
     */
    function (fn) {
        this.onTouchedHandler();
    };
    MyMonacoEditorComponent.decorators = [
        { type: Component, args: [{
                    selector: 'app-my-monaco-editor',
                    template: "<div class=\"editor h-100\" #codeEditor></div>",
                    // 自定义输入控件:2.引入依赖服务ControlValueAccessor
                    providers: [CODE_EDITOR_INPUT_VALUE_ACCESSOR,
                        CodeEditorEventService,
                        {
                            provide: MY_MONACO_EDITOR_CONFIG,
                            useValue: ɵ0
                        }
                    ],
                    styles: [":host{display:block;height:100%}"]
                }] }
    ];
    /** @nocollapse */
    MyMonacoEditorComponent.ctorParameters = function () { return [
        { type: NgZone },
        { type: undefined, decorators: [{ type: Inject, args: [MY_MONACO_EDITOR_CONFIG,] }] },
        { type: CodeEditorEventService },
        { type: ExpressionEventService }
    ]; };
    MyMonacoEditorComponent.propDecorators = {
        _editorComponent: [{ type: ViewChild, args: ['codeEditor',] }],
        onInit: [{ type: Output }],
        onChange: [{ type: Output }],
        onTouched: [{ type: Output }],
        options: [{ type: Input, args: ['options',] }]
    };
    return MyMonacoEditorComponent;
}());
export { MyMonacoEditorComponent };
if (false) {
    /**
     * @type {?}
     * @protected
     */
    MyMonacoEditorComponent.prototype._editor;
    /**
     * @type {?}
     * @private
     */
    MyMonacoEditorComponent.prototype._options;
    /** @type {?} */
    MyMonacoEditorComponent.prototype._editorComponent;
    /** @type {?} */
    MyMonacoEditorComponent.prototype.onInit;
    /** @type {?} */
    MyMonacoEditorComponent.prototype.onChange;
    /** @type {?} */
    MyMonacoEditorComponent.prototype.onTouched;
    /**
     * @type {?}
     * @private
     */
    MyMonacoEditorComponent.prototype._value;
    /** @type {?} */
    MyMonacoEditorComponent.prototype.onChangeHandler;
    /** @type {?} */
    MyMonacoEditorComponent.prototype.onTouchedHandler;
    /**
     * @type {?}
     * @private
     */
    MyMonacoEditorComponent.prototype.zone;
    /**
     * @type {?}
     * @private
     */
    MyMonacoEditorComponent.prototype.config;
    /**
     * @type {?}
     * @private
     */
    MyMonacoEditorComponent.prototype.codeEditorEventService;
    /**
     * @type {?}
     * @private
     */
    MyMonacoEditorComponent.prototype.eventService;
    /* Skipping unhandled member: ;*/
}
export { ɵ0 };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibXktbW9uYWNvLWVkaXRvci5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZ3NwLXN2Yy9leHByZXNzaW9uLyIsInNvdXJjZXMiOlsibGliL215LW1vbmFjby1lZGl0b3IvbXktbW9uYWNvLWVkaXRvci5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQVUsVUFBVSxFQUFFLFlBQVksRUFBRSxLQUFLLEVBQWEsTUFBTSxFQUFFLFNBQVMsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUNqSCxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sRUFBRSxNQUFNLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDM0QsT0FBTyxFQUF3QixpQkFBaUIsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ3pFLE9BQU8sRUFBRSxJQUFJLEVBQUUsTUFBTSxXQUFXLENBQUM7QUFDakMsT0FBTyxFQUFFLHVCQUF1QixFQUF3QixNQUFNLGdCQUFnQixDQUFDO0FBQy9FLE9BQU8sRUFBRSxzQkFBc0IsRUFBRSxNQUFNLHlEQUF5RCxDQUFDO0FBQ2pHLE9BQU8sRUFBRSxrQkFBa0IsRUFBRSxNQUFNLG9DQUFvQyxDQUFDO0FBQ3hFLE9BQU8sRUFBRSxzQkFBc0IsRUFBRSxNQUFNLDZCQUE2QixDQUFDOztJQUlqRSxZQUFZLEdBQVksS0FBSzs7SUFDN0IsV0FBMEI7Ozs7QUFJOUIsTUFBTSxLQUFPLGdDQUFnQyxHQUFROztJQUVuRCxPQUFPLEVBQUUsaUJBQWlCOztJQUMxQixXQUFXLEVBQUUsVUFBVTs7O0lBQUMsY0FBTSxPQUFBLHVCQUF1QixFQUF2QixDQUF1QixFQUFDOztJQUN0RCxLQUFLLEVBQUUsSUFBSSxDQUFBLEVBQUU7Q0FDZDs7SUFDSyxZQUFZLEdBQXlCO0lBQ3pDLE9BQU8sRUFBRSxRQUFRO0lBQ2pCLGNBQWMsRUFBRSxFQUFFLG9CQUFvQixFQUFFLEtBQUssRUFBRTtDQUNoRDtTQVVlLFlBQVk7QUFUNUI7SUE2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Ozs7SUFDdkIsMkNBQXNCOztJQUd0QixtREFBc0Q7O0lBQ3RELHlDQUFpQjs7SUFDakIsMkNBQW1COztJQUNuQiw0Q0FBb0I7Ozs7O0lBZ01wQix5Q0FBNEI7O0lBZ0Q1QixrREFNRTs7SUFHRixtREFLRTs7Ozs7SUF6TlUsdUNBQW9COzs7OztJQUFFLHlDQUFxRTs7Ozs7SUFBRSx5REFBc0Q7Ozs7O0lBQUUsK0NBQTRDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBPbkluaXQsIEVsZW1lbnRSZWYsIEV2ZW50RW1pdHRlciwgSW5wdXQsIE9uRGVzdHJveSwgT3V0cHV0LCBWaWV3Q2hpbGQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgZm9yd2FyZFJlZiwgSW5qZWN0LCBOZ1pvbmUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgQ29udHJvbFZhbHVlQWNjZXNzb3IsIE5HX1ZBTFVFX0FDQ0VTU09SIH0gZnJvbSAnQGFuZ3VsYXIvZm9ybXMnO1xyXG5pbXBvcnQgeyBwaWNrIH0gZnJvbSAnbG9kYXNoLWVzJztcclxuaW1wb3J0IHsgTVlfTU9OQUNPX0VESVRPUl9DT05GSUcsIE15TW9uYWNvRWRpdG9yQ29uZmlnIH0gZnJvbSAnLi9lZGl0b3Jjb25maWcnO1xyXG5pbXBvcnQgeyBDb2RlRWRpdG9yRXZlbnRTZXJ2aWNlIH0gZnJvbSAnLi9teS1tb25hY28tZWRpdG9yLXNlcnZpY2VzL21vbmFjby1lZGl0b3IuZXZlbnQuc2VydmljZSc7XHJcbmltcG9ydCB7IENPREVfRURJVE9SX0VWRU5UUyB9IGZyb20gJy4vbXktbW9uYWNvLWVkaXRvci1zZXJ2aWNlcy9ldmVudHMnO1xyXG5pbXBvcnQgeyBFeHByZXNzaW9uRXZlbnRTZXJ2aWNlIH0gZnJvbSAnLi4vZXhwcmVzc2lvbi1ldmVudC1zZXJ2aWNlJztcclxuXHJcbmRlY2xhcmUgY29uc3QgbW9uYWNvOiBhbnk7XHJcblxyXG5sZXQgbG9hZGVkTW9uYWNvOiBib29sZWFuID0gZmFsc2U7XHJcbmxldCBsb2FkUHJvbWlzZTogUHJvbWlzZTx2b2lkPjtcclxuXHJcbi8vIOiHquWumuS5iei+k+WFpeaOp+S7tjoxLuWwgeijhUNvbnRyb2xWYWx1ZUFjY2Vzc29yXHJcbi8vIGh0dHBzOi8vY29kZS1leGFtcGxlcy5uZXQvemgtQ04vcS8yMTU0NzYxXHJcbmV4cG9ydCBjb25zdCBDT0RFX0VESVRPUl9JTlBVVF9WQUxVRV9BQ0NFU1NPUjogYW55ID0ge1xyXG4gIC8vIGh0dHBzOi8vYmxvZy5jc2RuLm5ldC93YW5nZGFuXzIwMTMvYXJ0aWNsZS9kZXRhaWxzLzgxMzE0OTU5XHJcbiAgcHJvdmlkZTogTkdfVkFMVUVfQUNDRVNTT1IsLy9cclxuICB1c2VFeGlzdGluZzogZm9yd2FyZFJlZigoKSA9PiBNeU1vbmFjb0VkaXRvckNvbXBvbmVudCksLy9cclxuICBtdWx0aTogdHJ1ZS8vXHJcbn07XHJcbmNvbnN0IG1vbmFjb0NvbmZpZzogTXlNb25hY29FZGl0b3JDb25maWcgPSB7XHJcbiAgYmFzZVVybDogJ2Fzc2V0cycsXHJcbiAgZGVmYXVsdE9wdGlvbnM6IHsgc2Nyb2xsQmV5b25kTGFzdExpbmU6IGZhbHNlIH1cclxufTtcclxuQENvbXBvbmVudCh7XHJcbiAgc2VsZWN0b3I6ICdhcHAtbXktbW9uYWNvLWVkaXRvcicsXHJcbiAgdGVtcGxhdGVVcmw6ICcuL215LW1vbmFjby1lZGl0b3IuY29tcG9uZW50Lmh0bWwnLFxyXG4gIHN0eWxlVXJsczogWycuL215LW1vbmFjby1lZGl0b3IuY29tcG9uZW50LmNzcyddLFxyXG4gIC8vIOiHquWumuS5iei+k+WFpeaOp+S7tjoyLuW8leWFpeS+nei1luacjeWKoUNvbnRyb2xWYWx1ZUFjY2Vzc29yXHJcbiAgcHJvdmlkZXJzOiBbQ09ERV9FRElUT1JfSU5QVVRfVkFMVUVfQUNDRVNTT1IsXHJcbiAgICBDb2RlRWRpdG9yRXZlbnRTZXJ2aWNlLFxyXG4gICAge1xyXG4gICAgICBwcm92aWRlOiBNWV9NT05BQ09fRURJVE9SX0NPTkZJRyxcclxuICAgICAgdXNlVmFsdWU6IG1vbmFjb0NvbmZpZ1xyXG4gICAgfVxyXG4gIF1cclxufSlcclxuXHJcbi8vIOiHquWumuS5iei+k+WFpeaOp+S7tiA8LT4gTW9uYWNvIEVkdG9yXHJcblxyXG4vLyDoh6rlrprkuYnovpPlhaXmjqfku7Y6My4xIGltcGxlbWVudHMgQ29udHJvbFZhbHVlQWNjZXNzb3IgXHJcbmV4cG9ydCBjbGFzcyBNeU1vbmFjb0VkaXRvckNvbXBvbmVudCBpbXBsZW1lbnRzIENvbnRyb2xWYWx1ZUFjY2Vzc29yLCBPbkRlc3Ryb3ksIE9uSW5pdCB7XHJcbiAgcHJvdGVjdGVkIF9lZGl0b3I6IGFueTtcclxuICBwcml2YXRlIF9vcHRpb25zOiBhbnk7XHJcbiAgLy8gcHJvdGVjdGVkIF93aW5kb3dSZXNpemVTdWJzY3JpcHRpb246IFN1YnNjcmlwdGlvbjtcclxuXHJcbiAgQFZpZXdDaGlsZCgnY29kZUVkaXRvcicpIF9lZGl0b3JDb21wb25lbnQ6IEVsZW1lbnRSZWY7IC8v5Yqo5oCB5re75Yqg5Luj56CB57yW6L6R5ZmoXHJcbiAgQE91dHB1dCgpIG9uSW5pdDtcclxuICBAT3V0cHV0KCkgb25DaGFuZ2U7XHJcbiAgQE91dHB1dCgpIG9uVG91Y2hlZDtcclxuXHJcbiAgQElucHV0KCdvcHRpb25zJylcclxuICBzZXQgb3B0aW9ucyhvcHRpb25zOiBhbnkpIHtcclxuICAgIC8vIOm7mOiupG9wdGlvbnModGhpcy5jb25maWcuZGVmYXVsdE9wdGlvbnMpICsg6Ieq5a6a5LmJb3B0aW9ucyhvcHRpb25zKVxyXG4gICAgdGhpcy5fb3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oe30sIHRoaXMuY29uZmlnLmRlZmF1bHRPcHRpb25zLCBvcHRpb25zKTtcclxuICAgIGlmICh0aGlzLl9lZGl0b3IpIHtcclxuICAgICAgdGhpcy5fZWRpdG9yLmRpc3Bvc2UoKTtcclxuICAgICAgdGhpcy5pbml0TW9uYWNvKG9wdGlvbnMpO1xyXG4gICAgfVxyXG4gIH1cclxuICBnZXQgb3B0aW9ucygpOiBhbnkge1xyXG4gICAgcmV0dXJuIHRoaXMuX29wdGlvbnM7XHJcbiAgfVxyXG5cclxuICAvL+WcqOWFieagh+WkhOaPkuWFpeihqOi+vuW8j+eahOaWueazlVxyXG4gIGluc2VydFdvcmQoaW5zZXJ0V29yZDogc3RyaW5nKSB7XHJcbiAgICBpZiAoaW5zZXJ0V29yZCAmJiBpbnNlcnRXb3JkICE9IHVuZGVmaW5lZCAmJiBpbnNlcnRXb3JkICE9IFwiXCIpIHtcclxuICAgICAgbGV0IHAgPSB7XHJcbiAgICAgICAgbGluZU51bWJlcjogMSxcclxuICAgICAgICBjb2x1bW46IDFcclxuICAgICAgfTtcclxuICAgICAgaWYgKHRoaXMuX2VkaXRvcikge1xyXG4gICAgICAgIHAgPSB0aGlzLl9lZGl0b3IuZ2V0UG9zaXRpb24oKTtcclxuICAgICAgfVxyXG4gICAgICBsZXQgcmFuZ2UgPSBuZXcgbW9uYWNvLlJhbmdlKHAubGluZU51bWJlcixcclxuICAgICAgICBwLmNvbHVtbixcclxuICAgICAgICBwLmxpbmVOdW1iZXIsXHJcbiAgICAgICAgcC5jb2x1bW4pO1xyXG4gICAgICBsZXQgaWQgPSB7IG1ham9yOiAxLCBtaW5vcjogMSB9O1xyXG4gICAgICBsZXQgdGV4dCA9IGluc2VydFdvcmQ7XHJcbiAgICAgIGxldCBvcCA9IHsgaWRlbnRpZmllcjogaWQsIHJhbmdlOiByYW5nZSwgdGV4dDogdGV4dCwgZm9yY2VNb3ZlTWFya2VyczogdHJ1ZSB9O1xyXG4gICAgICB0aGlzLl9lZGl0b3IuZXhlY3V0ZUVkaXRzKFwibXktc291cmNlXCIsIFtvcF0pO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLy8g5rOo5YWlQW5ndWxhck1vbmFjb0VkaXRvckNvbmZpZ++8jOWcqOWIm+W7ukVkaXRvcuWunuS+i+aXtuiuvue9rmNvbmZpZ1xyXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgem9uZTogTmdab25lLCBASW5qZWN0KE1ZX01PTkFDT19FRElUT1JfQ09ORklHKSBwcml2YXRlIGNvbmZpZzogTXlNb25hY29FZGl0b3JDb25maWcsIHByaXZhdGUgY29kZUVkaXRvckV2ZW50U2VydmljZTogQ29kZUVkaXRvckV2ZW50U2VydmljZSwgcHJpdmF0ZSBldmVudFNlcnZpY2U6IEV4cHJlc3Npb25FdmVudFNlcnZpY2UpIHtcclxuXHJcbiAgICAvLyDliJ3lp4vljJboh6rlrprkuYnkuovku7ZcclxuICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xyXG4gICAgY29kZUVkaXRvckV2ZW50U2VydmljZS5ldmVudE5hbWVzLmZvckVhY2goKG5hbWUpID0+IHtcclxuICAgICAgLy8g5Yib5bu66Ieq5a6a5LmJ5LqL5Lu277yM5q2k5aSE5L2c55So562J5pWI5LqOOiBAT3V0cHV0KCkgb25Jbml0ID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCkgXHJcbiAgICAgIHNlbGZbbmFtZV0gPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcclxuICAgICAgY29uc3QgZXZlbnRQYWlyID0gcGljayhzZWxmLCBuYW1lKTtcclxuICAgICAgY29kZUVkaXRvckV2ZW50U2VydmljZS5hZGRFdmVudChldmVudFBhaXIpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBuZ09uSW5pdCgpOiB2b2lkIHtcclxuICAgIGlmIChsb2FkZWRNb25hY28pIHtcclxuICAgICAgLy8gV2FpdCB1bnRpbCBtb25hY28gZWRpdG9yIGlzIGF2YWlsYWJsZVxyXG4gICAgICBsb2FkUHJvbWlzZS50aGVuKCgpID0+IHtcclxuICAgICAgICB0aGlzLmluaXRNb25hY28odGhpcy5vcHRpb25zKTtcclxuICAgICAgfSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBsb2FkZWRNb25hY28gPSB0cnVlO1xyXG4gICAgICBsb2FkUHJvbWlzZSA9IG5ldyBQcm9taXNlPHZvaWQ+KChyZXNvbHZlOiBhbnkpID0+IHtcclxuICAgICAgICAvLyBjb25zdCBiYXNlVXJsID0gdGhpcy5jb25maWcuYmFzZVVybCB8fCAnL2Fzc2V0cyc7XHJcbiAgICAgICAgY29uc3QgYmFzZVVybCA9ICcvcGxhdGZvcm0vY29tbW9uL3dlYi9jYWYnO1xyXG4gICAgICAgIC8vIGlmICh0eXBlb2YoKDxhbnk+d2luZG93KS5tb25hY28pID09PSAnb2JqZWN0Jykge1xyXG4gICAgICAgIC8vICAgcmVzb2x2ZSgpO1xyXG4gICAgICAgIC8vICAgcmV0dXJuO1xyXG4gICAgICAgIC8vIH1cclxuICAgICAgICBjb25zdCBvbkdvdEFtZExvYWRlcjogYW55ID0gKCkgPT4ge1xyXG4gICAgICAgICAgLy8gTG9hZCBtb25hY29cclxuICAgICAgICAgICg8YW55PndpbmRvdykucmVxdWlyZS5jb25maWcoeyBwYXRoczogeyAndnMnOiBgJHtiYXNlVXJsfS9tb25hY28vdnNgIH0gfSk7XHJcbiAgICAgICAgICAoPGFueT53aW5kb3cpLnJlcXVpcmUoWyd2cy9lZGl0b3IvZWRpdG9yLm1haW4nXSwgKCkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLm9uTW9uYWNvTG9hZCgpO1xyXG4gICAgICAgICAgICB0aGlzLmluaXRNb25hY28odGhpcy5vcHRpb25zKTtcclxuICAgICAgICAgICAgcmVzb2x2ZSgpO1xyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgLy8gTG9hZCBBTUQgbG9hZGVyIGlmIG5lY2Vzc2FyeVxyXG4gICAgICAgIGlmICghKDxhbnk+d2luZG93KS5yZXF1aXJlKSB7XHJcbiAgICAgICAgICBjb25zdCBsb2FkZXJTY3JpcHQ6IEhUTUxTY3JpcHRFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc2NyaXB0Jyk7XHJcbiAgICAgICAgICBsb2FkZXJTY3JpcHQudHlwZSA9ICd0ZXh0L2phdmFzY3JpcHQnO1xyXG4gICAgICAgICAgbG9hZGVyU2NyaXB0LnNyYyA9IGAke2Jhc2VVcmx9L21vbmFjby92cy9sb2FkZXIuanNgO1xyXG4gICAgICAgICAgbG9hZGVyU2NyaXB0Lm9ubG9hZCA9IG9uR290QW1kTG9hZGVyO1xyXG4gICAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChsb2FkZXJTY3JpcHQpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICBvbkdvdEFtZExvYWRlcigpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICAvL+WcqOWFieagh+WkhOaPkuWFpeihqOi+vuW8j+S6i+S7tuiuoumYhVxyXG4gICAgbGV0IHRlbXAgPSB0aGlzO1xyXG4gICAgdGhpcy5ldmVudFNlcnZpY2UuY3VycmVudEV4cHJlc3Npb24oKS5zdWJzY3JpYmUoKGluc2VydGV4cHJlc3Npb246IGFueSkgPT4ge1xyXG4gICAgICBpZiAodGVtcC5fZWRpdG9yICE9IHVuZGVmaW5lZCkge1xyXG4gICAgICAgIHRlbXAuaW5zZXJ0V29yZChpbnNlcnRleHByZXNzaW9uKVxyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICAgIHRoaXMuZXZlbnRTZXJ2aWNlLmNsZWFyRXhwcmVzc2lvbigpLnN1YnNjcmliZSgoKSA9PiB7XHJcbiAgICAgIGlmICh0ZW1wLl9lZGl0b3IgIT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgdGVtcC5fZWRpdG9yLnNldFZhbHVlKFwiXCIpXHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBvbk1vbmFjb0xvYWQoKTogdm9pZCB7XHJcbiAgICBjb25zdCBpZCA9IFwiZm9vLmpzb25cIjtcclxuICAgIG1vbmFjby5sYW5ndWFnZXMuanNvbi5qc29uRGVmYXVsdHMuc2V0RGlhZ25vc3RpY3NPcHRpb25zKHtcclxuICAgICAgdmFsaWRhdGU6IHRydWUsXHJcbiAgICAgIHNjaGVtYXM6IFt7XHJcbiAgICAgICAgdXJpOiBcImh0dHA6Ly9teXNlcnZlci9mb28tc2NoZW1hLmpzb25cIixcclxuICAgICAgICBmaWxlTWF0Y2g6IFtpZF0sXHJcbiAgICAgICAgc2NoZW1hOiB7XHJcbiAgICAgICAgICB0eXBlOiBcIm9iamVjdFwiLFxyXG4gICAgICAgICAgcHJvcGVydGllczoge1xyXG4gICAgICAgICAgICBwMToge1xyXG4gICAgICAgICAgICAgIGVudW06IFtcInYxXCIsIFwidjJcIl1cclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgcDI6IHtcclxuICAgICAgICAgICAgICAkcmVmOiBcImh0dHA6Ly9teXNlcnZlci9iYXItc2NoZW1hLmpzb25cIlxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICB9LCB7XHJcbiAgICAgICAgdXJpOiBcImh0dHA6Ly9teXNlcnZlci9iYXItc2NoZW1hLmpzb25cIixcclxuICAgICAgICBmaWxlTWF0Y2g6IFtpZF0sXHJcbiAgICAgICAgc2NoZW1hOiB7XHJcbiAgICAgICAgICB0eXBlOiBcIm9iamVjdFwiLFxyXG4gICAgICAgICAgcHJvcGVydGllczoge1xyXG4gICAgICAgICAgICBxMToge1xyXG4gICAgICAgICAgICAgIGVudW06IFtcIngxXCIsIFwieDJcIl1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgfV1cclxuICAgIH0pXHJcbiAgfVxyXG5cclxuICBuZ09uRGVzdHJveSgpIHtcclxuICAgIC8vIGlmICh0aGlzLl93aW5kb3dSZXNpemVTdWJzY3JpcHRpb24pIHtcclxuICAgIC8vICAgdGhpcy5fd2luZG93UmVzaXplU3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XHJcbiAgICAvLyB9XHJcbiAgICBpZiAodGhpcy5fZWRpdG9yKSB7XHJcbiAgICAgIHRoaXMuX2VkaXRvci5kaXNwb3NlKCk7XHJcbiAgICAgIHRoaXMuX2VkaXRvciA9IHVuZGVmaW5lZDtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHByb3RlY3RlZCBpbml0TW9uYWNvKG9wdGlvbnM6IGFueSk6IHZvaWQge1xyXG4gICAgZGVidWdnZXI7XHJcbiAgICBjb25zb2xlLmxvZyhcIkluaXQgdGhlIGN1c3RvbSBtb25hY28gY29kZSBlZGl0b3IuXCIpO1xyXG5cclxuICAgIC8vIGNvbnN0IGhhc01vZGVsID0gISFvcHRpb25zLm1vZGVsO1xyXG4gICAgY29uc3QgaGFzTW9kZWwgPSBmYWxzZTtcclxuXHJcbiAgICAvLyBpZiAoaGFzTW9kZWwpIHtcclxuICAgIC8vICAgb3B0aW9ucy5tb2RlbCA9IG1vbmFjby5lZGl0b3IuY3JlYXRlTW9kZWwob3B0aW9ucy5tb2RlbC52YWx1ZSwgb3B0aW9ucy5tb2RlbC5sYW5ndWFnZSwgb3B0aW9ucy5tb2RlbC51cmkpO1xyXG4gICAgLy8gfVxyXG5cclxuICAgIHRoaXMuX2VkaXRvciA9IG1vbmFjby5lZGl0b3IuY3JlYXRlKHRoaXMuX2VkaXRvckNvbXBvbmVudC5uYXRpdmVFbGVtZW50LCBvcHRpb25zKTtcclxuXHJcbiAgICBpZiAoIWhhc01vZGVsKSB7XHJcbiAgICAgIHRoaXMuX2VkaXRvci5zZXRWYWx1ZSh0aGlzLl92YWx1ZSk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gbW9uYWNvIGVkaXRvciAtPiBvdXRzaWRlIGNvbXBvbmVudFxyXG4gICAgdGhpcy5fZWRpdG9yLm9uRGlkQ2hhbmdlTW9kZWxDb250ZW50KCgpID0+IHRoaXMub25DaGFuZ2VNb2RlbENvbnRlbnRIYW5kbGVyKCkpO1xyXG5cclxuICAgIHRoaXMuX2VkaXRvci5vbkRpZEJsdXJFZGl0b3JUZXh0KCgpID0+IHRoaXMub25CbHVyRWRpdG9yVGV4dEhhbmRsZXIoKSk7XHJcblxyXG4gICAgLy8gcmVmcmVzaCBsYXlvdXQgb24gcmVzaXplIGV2ZW50LlxyXG4gICAgLy8gaWYgKHRoaXMuX3dpbmRvd1Jlc2l6ZVN1YnNjcmlwdGlvbikge1xyXG4gICAgLy8gICB0aGlzLl93aW5kb3dSZXNpemVTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcclxuICAgIC8vIH1cclxuICAgIC8vIHRoaXMuX3dpbmRvd1Jlc2l6ZVN1YnNjcmlwdGlvbiA9IGZyb21FdmVudCh3aW5kb3csICdyZXNpemUnKS5zdWJzY3JpYmUoKCkgPT4gdGhpcy5fZWRpdG9yLmxheW91dCgpKTtcclxuXHJcbiAgICB0aGlzLmNvZGVFZGl0b3JFdmVudFNlcnZpY2UuZmlyZUV2ZW50KHtcclxuICAgICAgZXZlbnROYW1lOiBDT0RFX0VESVRPUl9FVkVOVFMub25Jbml0LFxyXG4gICAgICB0YXJnZXQ6IHRoaXMsXHJcbiAgICAgIGVkaXRvcjogdGhpcy5fZWRpdG9yXHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIG9uQ2hhbmdlTW9kZWxDb250ZW50SGFuZGxlcigpIHtcclxuICAgIGNvbnN0IF92YWx1ZSA9IHRoaXMuX2VkaXRvci5nZXRWYWx1ZSgpO1xyXG5cclxuICAgIC8vIG1vbmFjbyBlZGl0b3IgLT4gb3V0c2lkZSBjb21wb25lbnRcclxuICAgIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9KVGFuZ21pbmcvdG0vaXNzdWVzLzQgbmdab25l6K+m6KejXHJcbiAgICB0aGlzLnpvbmUucnVuKCgpID0+IHRoaXMudmFsdWUgPSBfdmFsdWUpOy8vIHZhbHVlIGlzIG5vdCBwcm9wYWdhdGVkIHRvIHBhcmVudCB3aGVuIGV4ZWN1dGluZyBvdXRzaWRlIHpvbmUuXHJcbiAgICAvLyBjb25zb2xlLmxvZyhcIndyaXRlIGZyb20gdGhlIG1vbmFjbzpcIiArIHRoaXMuX3ZhbHVlKTtcclxuICB9XHJcblxyXG4gIG9uQmx1ckVkaXRvclRleHRIYW5kbGVyKCkge1xyXG5cclxuICAgIHRoaXMub25Ub3VjaGVkSGFuZGxlcigpO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBfdmFsdWU6IHN0cmluZyA9ICcnO1xyXG5cclxuICAvL2dldCBhY2Nlc3NvclxyXG4gIGdldCB2YWx1ZSgpOiBhbnkge1xyXG4gICAgcmV0dXJuIHRoaXMuX3ZhbHVlO1xyXG4gIH07XHJcblxyXG4gIC8vc2V0IGFjY2Vzc29yIGluY2x1ZGluZyBjYWxsIHRoZSBvbmNoYW5nZSBjYWxsYmFja1xyXG4gIHNldCB2YWx1ZSh2OiBhbnkpIHtcclxuICAgIGlmICh2ICE9PSB0aGlzLnZhbHVlKSB7Ly8g5rOo5oSP6L+Z56eN5YaZ5rOV77yM5YC85b6X5a2m5LmgXHJcbiAgICAgIHRoaXMuX3ZhbHVlID0gdjtcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLm9uQ2hhbmdlSGFuZGxlcih0aGlzLnZhbHVlKTsvL+WcqOWxnuaAp+S/rumlsOWZqOmHjOiwg+eUqG9uY2hhbmdlSGFuZGxlcuaWueazlVxyXG4gIH1cclxuXHJcbiAgbG9jYWxFZGl0b3IoKSB7Ly9EZW1vOiBvdXRzaWRlIGNvbXBvbmVudCAtPiBtb25hY28gZWRpdG9yXHJcbiAgICB0aGlzLndyaXRlVmFsdWUoJ3Rlc3QnKTtcclxuICB9XHJcblxyXG4gIC8vIOiHquWumuS5iei+k+WFpeaOp+S7tjozLjIgaW1wbGVtZW50cyBDb250cm9sVmFsdWVBY2Nlc3NvXHJcblxyXG4gIC8vIG91dHNpZGUgY29tcG9uZW50IC0+IG1vbmFjbyBlZGl0b3JcclxuXHJcbiAgLy9Gcm9tIENvbnRyb2xWYWx1ZUFjY2Vzc29yIGludGVyZmFjZVxyXG4gIHdyaXRlVmFsdWUodmFsdWU6IGFueSkge1xyXG4gICAgdGhpcy52YWx1ZSA9IHZhbHVlIHx8ICcnO1xyXG5cclxuICAgIC8vIEZpeCBmb3IgdmFsdWUgY2hhbmdlIHdoaWxlIGRpc3Bvc2UgaW4gcHJvY2Vzcy5cclxuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICBpZiAodGhpcy5fZWRpdG9yIC8qJiYgIXRoaXMub3B0aW9ucy5tb2RlbCovKSB7XHJcbiAgICAgICAgdGhpcy5fZWRpdG9yLnNldFZhbHVlKHRoaXMuX3ZhbHVlKTtcclxuICAgICAgICAvLyBjb25zb2xlLmxvZyhcIndyaXRlIHRvIHRoZSBlZGl0b3I6XCIgKyB0aGlzLl92YWx1ZSk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLy9Gcm9tIENvbnRyb2xWYWx1ZUFjY2Vzc29yIGludGVyZmFjZVxyXG4gIHJlZ2lzdGVyT25DaGFuZ2UoZm46IGFueSkge1xyXG4gICAgdGhpcy5vbkNoYW5nZUhhbmRsZXIodGhpcyk7XHJcbiAgfVxyXG5cclxuICAvL0Zyb20gQ29udHJvbFZhbHVlQWNjZXNzb3IgaW50ZXJmYWNlXHJcbiAgcmVnaXN0ZXJPblRvdWNoZWQoZm46IGFueSkge1xyXG4gICAgdGhpcy5vblRvdWNoZWRIYW5kbGVyKCk7XHJcbiAgfVxyXG5cclxuICAvL0NvbnRyb2xWYWx1ZUFjY2Vzc29y5o+Q5L6b55qE5LqL5Lu25Zue6LCDXHJcbiAgb25DaGFuZ2VIYW5kbGVyID0gKF86IGFueSkgPT4geyAvL1Byb3BhZ2F0ZSBDaGFuZ2UgdG8gb3V0c2lkZVxyXG4gICAgdGhpcy5jb2RlRWRpdG9yRXZlbnRTZXJ2aWNlLmZpcmVFdmVudCh7XHJcbiAgICAgIGV2ZW50TmFtZTogQ09ERV9FRElUT1JfRVZFTlRTLm9uQ2hhbmdlLFxyXG4gICAgICB0YXJnZXQ6IHRoaXMsXHJcbiAgICAgIGRhdGE6IF9cclxuICAgIH0pO1xyXG4gIH07XHJcblxyXG4gIC8vQ29udHJvbFZhbHVlQWNjZXNzb3Lmj5DkvpvnmoTkuovku7blm57osINcclxuICBvblRvdWNoZWRIYW5kbGVyID0gKCkgPT4ge1xyXG4gICAgdGhpcy5jb2RlRWRpdG9yRXZlbnRTZXJ2aWNlLmZpcmVFdmVudCh7XHJcbiAgICAgIGV2ZW50TmFtZTogQ09ERV9FRElUT1JfRVZFTlRTLm9uVG91Y2hlZCxcclxuICAgICAgdGFyZ2V0OiB0aGlzXHJcbiAgICB9KTtcclxuICB9O1xyXG59Il19
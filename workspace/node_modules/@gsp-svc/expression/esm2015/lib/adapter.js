/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { GSPElementDataType } from "@gsp-bef/gsp-cm-metadata";
import { EntityType, Property, NavigationProperty, NavigationType } from "./schema";
import { NewDataType, NewEntityType, NewNavigationProperty, NewNavigationType, NewProperty } from "./i18n/NewSchema";
/**
 * 适配器类(目前支持CDT、CO)
 * 功能：将CDT、CO转化为内部Schema中的EntityType
 */
export class Adapter {
    /**
     * 将CDT转化为entityType方法
     * @param {?} gspCDT 待转化的CDT
     * @return {?}
     */
    convertCDT(gspCDT) {
        /** @type {?} */
        let entityType = new EntityType();
        entityType.name = gspCDT.Code;
        entityType.key = null;
        entityType.id = gspCDT.Code;
        entityType.description = gspCDT.Name;
        gspCDT.ContainElements.forEach((/**
         * @param {?} element
         * @return {?}
         */
        element => {
            /** @type {?} */
            let property = new Property();
            property.name = element.Code;
            property.type = element.MDataType;
            property.description = element.Name;
            entityType.properties.push(property);
        }));
        entityType.navigationProperties = [];
        return entityType;
    }
    /**
     * 将CO转化为entityType方法
     * @param {?} gspCO 待转化的CO
     * @return {?}
     */
    convertCO(gspCO) {
        /** @type {?} */
        let entityTypes = [];
        entityTypes.push(this.adaptCO(gspCO, entityTypes));
        return entityTypes;
    }
    /**
     * CO转化递归方法
     * @private
     * @param {?} gspCO 待转化gspCO
     * @param {?} entityTypes 从gspCO提取的所有主从表
     * @return {?}
     */
    adaptCO(gspCO, entityTypes) {
        /** @type {?} */
        let entityType = new EntityType();
        entityType.name = gspCO.Code;
        entityType.key = null;
        entityType.id = gspCO.Code;
        entityType.description = gspCO.Name;
        //每个属性转化
        if (gspCO.ContainElements.length != 0) {
            gspCO.ContainElements.forEach((/**
             * @param {?} element
             * @return {?}
             */
            element => {
                /** @type {?} */
                let property = new Property();
                property.name = element.Code;
                property.type = element.MDataType;
                property.description = element.Name;
                entityType.properties.push(property);
            }));
        }
        ;
        //子表转化为导航属性
        if (gspCO.ContainChildObjects.length != 0) {
            gspCO.ContainChildObjects.forEach((/**
             * @param {?} childObject
             * @return {?}
             */
            childObject => {
                /** @type {?} */
                let naviproperty = new NavigationProperty();
                naviproperty.description = childObject.Name;
                naviproperty.name = childObject.Code + "s";
                naviproperty.navigationId = childObject.Code + "s";
                naviproperty.type = NavigationType.EntitySet;
                entityType.navigationProperties.push(naviproperty);
                entityTypes.push(this.adaptCO(childObject, entityTypes));
            }));
        }
        ;
        return entityType;
    }
    //======================将CO转换为NewEntityType===============================================
    /**
     * \@description 将CDT转换为NewEntityType
     * @param {?} gspCDT 待转换CDT
     * @return {?} NewEntityType
     */
    convertCDTOfNewSchema(gspCDT) {
        /** @type {?} */
        let entityType = new NewEntityType();
        entityType.code = gspCDT.Code;
        entityType.name = gspCDT.Name;
        gspCDT.ContainElements.forEach((/**
         * @param {?} element
         * @return {?}
         */
        element => {
            /** @type {?} */
            let property = new NewProperty();
            property.code = element.Code;
            property.name = element.Name;
            property.dataType = this.convertMDataType(element.MDataType);
            entityType.properties.push(property);
        }));
        entityType.navigationProperties = [];
        return entityType;
    }
    /**
     * \@description 将CO转化为newEntityType方法
     * @param {?} gspCO 待转化的CO
     * @return {?} NewEntityType[] NewEntityType[]
     */
    convertCOOfNewSchema(gspCO) {
        /** @type {?} */
        let entityTypes = [];
        entityTypes.push(this.adaptCOOfNewSchema(gspCO, entityTypes));
        return entityTypes;
    }
    /**
     * CO转化递归方法
     * @private
     * @param {?} gspCO 待转化gspCO
     * @param {?} entityTypes 从gspCO提取的所有主从表
     * @return {?}
     */
    adaptCOOfNewSchema(gspCO, entityTypes) {
        /** @type {?} */
        let entityType = new NewEntityType();
        entityType.code = gspCO.Code;
        entityType.name = gspCO.Name;
        //每个属性转化
        if (gspCO.ContainElements.length != 0) {
            gspCO.ContainElements.forEach((/**
             * @param {?} element
             * @return {?}
             */
            element => {
                /** @type {?} */
                let property = new NewProperty();
                property.code = element.Code;
                property.name = element.Name;
                property.dataType = this.convertMDataType(element.MDataType);
                entityType.properties.push(property);
            }));
        }
        ;
        //子表转化为导航属性
        if (gspCO.ContainChildObjects.length != 0) {
            gspCO.ContainChildObjects.forEach((/**
             * @param {?} childObject
             * @return {?}
             */
            childObject => {
                /** @type {?} */
                let naviproperty = new NewNavigationProperty();
                naviproperty.code = childObject.Code + "s";
                naviproperty.name = childObject.Name;
                naviproperty.navigationName = childObject.Code;
                naviproperty.navigationType = NewNavigationType.EntitySet;
                entityType.navigationProperties.push(naviproperty);
                entityTypes.push(this.adaptCOOfNewSchema(childObject, entityTypes));
            }));
        }
        ;
        return entityType;
    }
    /**
     * \@description （字段类型转换）BE类型转换为Schema类型
     * @private
     * @param {?} type BE类型
     * @return {?} NewDataType
     */
    convertMDataType(type) {
        switch (type) {
            case GSPElementDataType.String:
                return NewDataType.String;
            case GSPElementDataType.Integer:
                return NewDataType.Integer;
            case GSPElementDataType.Binary:
                return NewDataType.Byte;
            case GSPElementDataType.Boolean:
                return NewDataType.Boolean;
            case GSPElementDataType.Date:
                return NewDataType.Date;
            case GSPElementDataType.DateTime:
                return NewDataType.DateTime;
            case GSPElementDataType.Decimal:
                return NewDataType.Decimal;
            case GSPElementDataType.Text:
                return NewDataType.String;
            default:
                return NewDataType.String;
        }
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYWRhcHRlci5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0Bnc3Atc3ZjL2V4cHJlc3Npb24vIiwic291cmNlcyI6WyJsaWIvYWRhcHRlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFxQixrQkFBa0IsRUFBd0IsTUFBTSwwQkFBMEIsQ0FBQztBQUN2RyxPQUFPLEVBQUUsVUFBVSxFQUFFLFFBQVEsRUFBRSxrQkFBa0IsRUFBRSxjQUFjLEVBQUUsTUFBTSxVQUFVLENBQUM7QUFFcEYsT0FBTyxFQUFFLFdBQVcsRUFBRSxhQUFhLEVBQUUscUJBQXFCLEVBQUUsaUJBQWlCLEVBQUUsV0FBVyxFQUFFLE1BQU0sa0JBQWtCLENBQUM7Ozs7O0FBS3JILE1BQU0sT0FBTyxPQUFPOzs7Ozs7SUFNVCxVQUFVLENBQUMsTUFBeUI7O1lBQ25DLFVBQVUsR0FBRyxJQUFJLFVBQVUsRUFBRTtRQUNqQyxVQUFVLENBQUMsSUFBSSxHQUFHLE1BQU0sQ0FBQyxJQUFJLENBQUM7UUFDOUIsVUFBVSxDQUFDLEdBQUcsR0FBRyxJQUFJLENBQUM7UUFDdEIsVUFBVSxDQUFDLEVBQUUsR0FBRyxNQUFNLENBQUMsSUFBSSxDQUFDO1FBQzVCLFVBQVUsQ0FBQyxXQUFXLEdBQUcsTUFBTSxDQUFDLElBQUksQ0FBQztRQUNyQyxNQUFNLENBQUMsZUFBZSxDQUFDLE9BQU87Ozs7UUFBQyxPQUFPLENBQUMsRUFBRTs7Z0JBQ2pDLFFBQVEsR0FBRyxJQUFJLFFBQVEsRUFBRTtZQUM3QixRQUFRLENBQUMsSUFBSSxHQUFHLE9BQU8sQ0FBQyxJQUFJLENBQUM7WUFDN0IsUUFBUSxDQUFDLElBQUksR0FBRyxPQUFPLENBQUMsU0FBUyxDQUFDO1lBQ2xDLFFBQVEsQ0FBQyxXQUFXLEdBQUcsT0FBTyxDQUFDLElBQUksQ0FBQztZQUNwQyxVQUFVLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUN6QyxDQUFDLEVBQUMsQ0FBQztRQUNILFVBQVUs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QVE7Z0JBQzVCLE9BQU8sV0FBVyxDQUFDLFFBQVEsQ0FBQztZQUNoQyxLQUFLLGtCQUFrQixDQUFDLE9BQU87Z0JBQzNCLE9BQU8sV0FBVyxDQUFDLE9BQU8sQ0FBQztZQUMvQixLQUFLLGtCQUFrQixDQUFDLElBQUk7Z0JBQ3hCLE9BQU8sV0FBVyxDQUFDLE1BQU0sQ0FBQztZQUM5QjtnQkFDSSxPQUFPLFdBQVcsQ0FBQyxNQUFNLENBQUM7U0FDakM7SUFDTCxDQUFDO0NBRUoiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBHc3BDb21tb25EYXRhVHlwZSwgR1NQRWxlbWVudERhdGFUeXBlLCBHU1BFbGVtZW50T2JqZWN0VHlwZSB9IGZyb20gXCJAZ3NwLWJlZi9nc3AtY20tbWV0YWRhdGFcIjtcclxuaW1wb3J0IHsgRW50aXR5VHlwZSwgUHJvcGVydHksIE5hdmlnYXRpb25Qcm9wZXJ0eSwgTmF2aWdhdGlvblR5cGUgfSBmcm9tIFwiLi9zY2hlbWFcIjtcclxuaW1wb3J0IHsgR1NQQ29tbW9uT2JqZWN0LCBJR1NQQ29tbW9uT2JqZWN0IH0gZnJvbSBcIkBnc3AtYmVmL2dzcC1jbS1tZXRhZGF0YVwiO1xyXG5pbXBvcnQgeyBOZXdEYXRhVHlwZSwgTmV3RW50aXR5VHlwZSwgTmV3TmF2aWdhdGlvblByb3BlcnR5LCBOZXdOYXZpZ2F0aW9uVHlwZSwgTmV3UHJvcGVydHkgfSBmcm9tIFwiLi9pMThuL05ld1NjaGVtYVwiO1xyXG4vKipcclxuICog6YCC6YWN5Zmo57G7KOebruWJjeaUr+aMgUNEVOOAgUNPKVxyXG4gKiDlip/og73vvJrlsIZDRFTjgIFDT+i9rOWMluS4uuWGhemDqFNjaGVtYeS4reeahEVudGl0eVR5cGVcclxuICovXHJcbmV4cG9ydCBjbGFzcyBBZGFwdGVyIHtcclxuXHJcbiAgICAvKipcclxuICAgICAqIOWwhkNEVOi9rOWMluS4umVudGl0eVR5cGXmlrnms5VcclxuICAgICAqIEBwYXJhbSBnc3BDRFQg5b6F6L2s5YyW55qEQ0RUXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBjb252ZXJ0Q0RUKGdzcENEVDogR3NwQ29tbW9uRGF0YVR5cGUpOiBFbnRpdHlUeXBlIHtcclxuICAgICAgICBsZXQgZW50aXR5VHlwZSA9IG5ldyBFbnRpdHlUeXBlKCk7XHJcbiAgICAgICAgZW50aXR5VHlwZS5uYW1lID0gZ3NwQ0RULkNvZGU7XHJcbiAgICAgICAgZW50aXR5VHlwZS5rZXkgPSBudWxsO1xyXG4gICAgICAgIGVudGl0eVR5cGUuaWQgPSBnc3BDRFQuQ29kZTtcclxuICAgICAgICBlbnRpdHlUeXBlLmRlc2NyaXB0aW9uID0gZ3NwQ0RULk5hbWU7XHJcbiAgICAgICAgZ3NwQ0RULkNvbnRhaW5FbGVtZW50cy5mb3JFYWNoKGVsZW1lbnQgPT4ge1xyXG4gICAgICAgICAgICBsZXQgcHJvcGVydHkgPSBuZXcgUHJvcGVydHkoKTtcclxuICAgICAgICAgICAgcHJvcGVydHkubmFtZSA9IGVsZW1lbnQuQ29kZTtcclxuICAgICAgICAgICAgcHJvcGVydHkudHlwZSA9IGVsZW1lbnQuTURhdGFUeXBlO1xyXG4gICAgICAgICAgICBwcm9wZXJ0eS5kZXNjcmlwdGlvbiA9IGVsZW1lbnQuTmFtZTtcclxuICAgICAgICAgICAgZW50aXR5VHlwZS5wcm9wZXJ0aWVzLnB1c2gocHJvcGVydHkpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIGVudGl0eVR5cGUubmF2aWdhdGlvblByb3BlcnRpZXMgPSBbXTtcclxuICAgICAgICByZXR1cm4gZW50aXR5VHlwZTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICog5bCGQ0/ovazljJbkuLplbnRpdHlUeXBl5pa55rOVXHJcbiAgICAgKiBAcGFyYW0gZ3NwQ08g5b6F6L2s5YyW55qEQ09cclxuICAgICAqL1xyXG4gICAgcHVibGljIGNvbnZlcnRDTyhnc3BDTzogR1NQQ29tbW9uT2JqZWN0KTogRW50aXR5VHlwZVtdIHtcclxuICAgICAgICBsZXQgZW50aXR5VHlwZXM6IEVudGl0eVR5cGVbXSA9IFtdO1xyXG4gICAgICAgIGVudGl0eVR5cGVzLnB1c2godGhpcy5hZGFwdENPKGdzcENPLCBlbnRpdHlUeXBlcykpO1xyXG4gICAgICAgIHJldHVybiBlbnRpdHlUeXBlcztcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogQ0/ovazljJbpgJLlvZLmlrnms5VcclxuICAgICAqIEBwYXJhbSBnc3BDTyDlvoXovazljJZnc3BDT1xyXG4gICAgICogQHBhcmFtIGVudGl0eVR5cGVzIOS7jmdzcENP5o+Q5Y+W55qE5omA5pyJ5Li75LuO6KGoXHJcbiAgICAgKi9cclxuICAgIHByaXZhdGUgYWRhcHRDTyhnc3BDTzogSUdTUENvbW1vbk9iamVjdCwgZW50aXR5VHlwZXM6IEVudGl0eVR5cGVbXSk6IEVudGl0eVR5cGUge1xyXG4gICAgICAgIGxldCBlbnRpdHlUeXBlID0gbmV3IEVudGl0eVR5cGUoKTtcclxuICAgICAgICBlbnRpdHlUeXBlLm5hbWUgPSBnc3BDTy5Db2RlO1xyXG4gICAgICAgIGVudGl0eVR5cGUua2V5ID0gbnVsbDtcclxuICAgICAgICBlbnRpdHlUeXBlLmlkID0gZ3NwQ08uQ29kZTtcclxuICAgICAgICBlbnRpdHlUeXBlLmRlc2NyaXB0aW9uID0gZ3NwQ08uTmFtZTtcclxuICAgICAgICAvL+avj+S4quWxnuaAp+i9rOWMllxyXG4gICAgICAgIGlmIChnc3BDTy5Db250YWluRWxlbWVudHMubGVuZ3RoICE9IDApIHtcclxuICAgICAgICAgICAgZ3NwQ08uQ29udGFpbkVsZW1lbnRzLmZvckVhY2goZWxlbWVudCA9PiB7XHJcbiAgICAgICAgICAgICAgICBsZXQgcHJvcGVydHkgPSBuZXcgUHJvcGVydHkoKTtcclxuICAgICAgICAgICAgICAgIHByb3BlcnR5Lm5hbWUgPSBlbGVtZW50LkNvZGU7XHJcbiAgICAgICAgICAgICAgICBwcm9wZXJ0eS50eXBlID0gZWxlbWVudC5NRGF0YVR5cGU7XHJcbiAgICAgICAgICAgICAgICBwcm9wZXJ0eS5kZXNjcmlwdGlvbiA9IGVsZW1lbnQuTmFtZTtcclxuICAgICAgICAgICAgICAgIGVudGl0eVR5cGUucHJvcGVydGllcy5wdXNoKHByb3BlcnR5KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICAvL+WtkOihqOi9rOWMluS4uuWvvOiIquWxnuaAp1xyXG4gICAgICAgIGlmIChnc3BDTy5Db250YWluQ2hpbGRPYmplY3RzLmxlbmd0aCAhPSAwKSB7XHJcbiAgICAgICAgICAgIGdzcENPLkNvbnRhaW5DaGlsZE9iamVjdHMuZm9yRWFjaChjaGlsZE9iamVjdCA9PiB7XHJcbiAgICAgICAgICAgICAgICBsZXQgbmF2aXByb3BlcnR5ID0gbmV3IE5hdmlnYXRpb25Qcm9wZXJ0eSgpO1xyXG4gICAgICAgICAgICAgICAgbmF2aXByb3BlcnR5LmRlc2NyaXB0aW9uID0gY2hpbGRPYmplY3QuTmFtZTtcclxuICAgICAgICAgICAgICAgIG5hdmlwcm9wZXJ0eS5uYW1lID0gY2hpbGRPYmplY3QuQ29kZSArIFwic1wiO1xyXG4gICAgICAgICAgICAgICAgbmF2aXByb3BlcnR5Lm5hdmlnYXRpb25JZCA9IGNoaWxkT2JqZWN0LkNvZGUgKyBcInNcIjtcclxuICAgICAgICAgICAgICAgIG5hdmlwcm9wZXJ0eS50eXBlID0gTmF2aWdhdGlvblR5cGUuRW50aXR5U2V0O1xyXG4gICAgICAgICAgICAgICAgZW50aXR5VHlwZS5uYXZpZ2F0aW9uUHJvcGVydGllcy5wdXNoKG5hdmlwcm9wZXJ0eSk7XHJcbiAgICAgICAgICAgICAgICBlbnRpdHlUeXBlcy5wdXNoKHRoaXMuYWRhcHRDTyhjaGlsZE9iamVjdCwgZW50aXR5VHlwZXMpKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICByZXR1cm4gZW50aXR5VHlwZTtcclxuICAgIH1cclxuXHJcbiAgICAvLz09PT09PT09PT09PT09PT09PT09PT3lsIZDT+i9rOaNouS4uk5ld0VudGl0eVR5cGU9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogQGRlc2NyaXB0aW9uIOWwhkNEVOi9rOaNouS4uk5ld0VudGl0eVR5cGVcclxuICAgICAqIEBwYXJhbSBnc3BDRFQg5b6F6L2s5o2iQ0RUXHJcbiAgICAgKiBAcmV0dXJucyBOZXdFbnRpdHlUeXBlXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBjb252ZXJ0Q0RUT2ZOZXdTY2hlbWEoZ3NwQ0RUOiBHc3BDb21tb25EYXRhVHlwZSk6IE5ld0VudGl0eVR5cGUge1xyXG4gICAgICAgIGxldCBlbnRpdHlUeXBlID0gbmV3IE5ld0VudGl0eVR5cGUoKTtcclxuICAgICAgICBlbnRpdHlUeXBlLmNvZGUgPSBnc3BDRFQuQ29kZTtcclxuICAgICAgICBlbnRpdHlUeXBlLm5hbWUgPSBnc3BDRFQuTmFtZTtcclxuICAgICAgICBnc3BDRFQuQ29udGFpbkVsZW1lbnRzLmZvckVhY2goZWxlbWVudCA9PiB7XHJcbiAgICAgICAgICAgIGxldCBwcm9wZXJ0eSA9IG5ldyBOZXdQcm9wZXJ0eSgpO1xyXG4gICAgICAgICAgICBwcm9wZXJ0eS5jb2RlID0gZWxlbWVudC5Db2RlO1xyXG4gICAgICAgICAgICBwcm9wZXJ0eS5uYW1lID0gZWxlbWVudC5OYW1lO1xyXG4gICAgICAgICAgICBwcm9wZXJ0eS5kYXRhVHlwZSA9IHRoaXMuY29udmVydE1EYXRhVHlwZShlbGVtZW50Lk1EYXRhVHlwZSk7XHJcbiAgICAgICAgICAgIGVudGl0eVR5cGUucHJvcGVydGllcy5wdXNoKHByb3BlcnR5KTtcclxuICAgICAgICB9KTtcclxuICAgICAgICBlbnRpdHlUeXBlLm5hdmlnYXRpb25Qcm9wZXJ0aWVzID0gW107XHJcbiAgICAgICAgcmV0dXJuIGVudGl0eVR5cGU7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAqIEBkZXNjcmlwdGlvbiDlsIZDT+i9rOWMluS4um5ld0VudGl0eVR5cGXmlrnms5VcclxuICAgICogQHBhcmFtIGdzcENPIOW+hei9rOWMlueahENPXHJcbiAgICAqIEByZXR1cm5zIE5ld0VudGl0eVR5cGVbXSBOZXdFbnRpdHlUeXBlW11cclxuICAgICovXHJcbiAgICBwdWJsaWMgY29udmVydENPT2ZOZXdTY2hlbWEoZ3NwQ086IEdTUENvbW1vbk9iamVjdCk6IE5ld0VudGl0eVR5cGVbXSB7XHJcbiAgICAgICAgbGV0IGVudGl0eVR5cGVzOiBOZXdFbnRpdHlUeXBlW10gPSBbXTtcclxuICAgICAgICBlbnRpdHlUeXBlcy5wdXNoKHRoaXMuYWRhcHRDT09mTmV3U2NoZW1hKGdzcENPLCBlbnRpdHlUeXBlcykpO1xyXG4gICAgICAgIHJldHVybiBlbnRpdHlUeXBlcztcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgKiBDT+i9rOWMlumAkuW9kuaWueazlVxyXG4gICAgKiBAcGFyYW0gZ3NwQ08g5b6F6L2s5YyWZ3NwQ09cclxuICAgICogQHBhcmFtIGVudGl0eVR5cGVzIOS7jmdzcENP5o+Q5Y+W55qE5omA5pyJ5Li75LuO6KGoXHJcbiAgICAqL1xyXG4gICAgcHJpdmF0ZSBhZGFwdENPT2ZOZXdTY2hlbWEoZ3NwQ086IElHU1BDb21tb25PYmplY3QsIGVudGl0eVR5cGVzOiBOZXdFbnRpdHlUeXBlW10pOiBOZXdFbnRpdHlUeXBlIHtcclxuICAgICAgICBsZXQgZW50aXR5VHlwZSA9IG5ldyBOZXdFbnRpdHlUeXBlKCk7XHJcbiAgICAgICAgZW50aXR5VHlwZS5jb2RlID0gZ3NwQ08uQ29kZTtcclxuICAgICAgICBlbnRpdHlUeXBlLm5hbWUgPSBnc3BDTy5OYW1lO1xyXG4gICAgICAgIC8v5q+P5Liq5bGe5oCn6L2s5YyWXHJcbiAgICAgICAgaWYgKGdzcENPLkNvbnRhaW5FbGVtZW50cy5sZW5ndGggIT0gMCkge1xyXG4gICAgICAgICAgICBnc3BDTy5Db250YWluRWxlbWVudHMuZm9yRWFjaChlbGVtZW50ID0+IHtcclxuICAgICAgICAgICAgICAgIGxldCBwcm9wZXJ0eSA9IG5ldyBOZXdQcm9wZXJ0eSgpO1xyXG4gICAgICAgICAgICAgICAgcHJvcGVydHkuY29kZSA9IGVsZW1lbnQuQ29kZTtcclxuICAgICAgICAgICAgICAgIHByb3BlcnR5Lm5hbWUgPSBlbGVtZW50Lk5hbWU7XHJcbiAgICAgICAgICAgICAgICBwcm9wZXJ0eS5kYXRhVHlwZSA9IHRoaXMuY29udmVydE1EYXRhVHlwZShlbGVtZW50Lk1EYXRhVHlwZSk7XHJcbiAgICAgICAgICAgICAgICBlbnRpdHlUeXBlLnByb3BlcnRpZXMucHVzaChwcm9wZXJ0eSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgLy/lrZDooajovazljJbkuLrlr7zoiKrlsZ7mgKdcclxuICAgICAgICBpZiAoZ3NwQ08uQ29udGFpbkNoaWxkT2JqZWN0cy5sZW5ndGggIT0gMCkge1xyXG4gICAgICAgICAgICBnc3BDTy5Db250YWluQ2hpbGRPYmplY3RzLmZvckVhY2goY2hpbGRPYmplY3QgPT4ge1xyXG4gICAgICAgICAgICAgICAgbGV0IG5hdmlwcm9wZXJ0eSA9IG5ldyBOZXdOYXZpZ2F0aW9uUHJvcGVydHkoKTtcclxuICAgICAgICAgICAgICAgIG5hdmlwcm9wZXJ0eS5jb2RlID0gY2hpbGRPYmplY3QuQ29kZSArIFwic1wiO1xyXG4gICAgICAgICAgICAgICAgbmF2aXByb3BlcnR5Lm5hbWUgPSBjaGlsZE9iamVjdC5OYW1lO1xyXG4gICAgICAgICAgICAgICAgbmF2aXByb3BlcnR5Lm5hdmlnYXRpb25OYW1lID0gY2hpbGRPYmplY3QuQ29kZTtcclxuICAgICAgICAgICAgICAgIG5hdmlwcm9wZXJ0eS5uYXZpZ2F0aW9uVHlwZSA9IE5ld05hdmlnYXRpb25UeXBlLkVudGl0eVNldDtcclxuICAgICAgICAgICAgICAgIGVudGl0eVR5cGUubmF2aWdhdGlvblByb3BlcnRpZXMucHVzaChuYXZpcHJvcGVydHkpO1xyXG4gICAgICAgICAgICAgICAgZW50aXR5VHlwZXMucHVzaCh0aGlzLmFkYXB0Q09PZk5ld1NjaGVtYShjaGlsZE9iamVjdCwgZW50aXR5VHlwZXMpKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICByZXR1cm4gZW50aXR5VHlwZTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEBkZXNjcmlwdGlvbiDvvIjlrZfmrrXnsbvlnovovazmjaLvvIlCReexu+Wei+i9rOaNouS4ulNjaGVtYeexu+Wei1xyXG4gICAgICogQHBhcmFtIHR5cGUgQkXnsbvlnotcclxuICAgICAqIEByZXR1cm5zIE5ld0RhdGFUeXBlXHJcbiAgICAgKi9cclxuICAgIHByaXZhdGUgY29udmVydE1EYXRhVHlwZSh0eXBlOiBHU1BFbGVtZW50RGF0YVR5cGUpOiBOZXdEYXRhVHlwZSB7XHJcbiAgICAgICAgc3dpdGNoICh0eXBlKSB7XHJcbiAgICAgICAgICAgIGNhc2UgR1NQRWxlbWVudERhdGFUeXBlLlN0cmluZzpcclxuICAgICAgICAgICAgICAgIHJldHVybiBOZXdEYXRhVHlwZS5TdHJpbmc7XHJcbiAgICAgICAgICAgIGNhc2UgR1NQRWxlbWVudERhdGFUeXBlLkludGVnZXI6XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gTmV3RGF0YVR5cGUuSW50ZWdlcjtcclxuICAgICAgICAgICAgY2FzZSBHU1BFbGVtZW50RGF0YVR5cGUuQmluYXJ5OlxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIE5ld0RhdGFUeXBlLkJ5dGU7XHJcbiAgICAgICAgICAgIGNhc2UgR1NQRWxlbWVudERhdGFUeXBlLkJvb2xlYW46XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gTmV3RGF0YVR5cGUuQm9vbGVhbjtcclxuICAgICAgICAgICAgY2FzZSBHU1BFbGVtZW50RGF0YVR5cGUuRGF0ZTpcclxuICAgICAgICAgICAgICAgIHJldHVybiBOZXdEYXRhVHlwZS5EYXRlO1xyXG4gICAgICAgICAgICBjYXNlIEdTUEVsZW1lbnREYXRhVHlwZS5EYXRlVGltZTpcclxuICAgICAgICAgICAgICAgIHJldHVybiBOZXdEYXRhVHlwZS5EYXRlVGltZTtcclxuICAgICAgICAgICAgY2FzZSBHU1BFbGVtZW50RGF0YVR5cGUuRGVjaW1hbDpcclxuICAgICAgICAgICAgICAgIHJldHVybiBOZXdEYXRhVHlwZS5EZWNpbWFsO1xyXG4gICAgICAgICAgICBjYXNlIEdTUEVsZW1lbnREYXRhVHlwZS5UZXh0OlxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIE5ld0RhdGFUeXBlLlN0cmluZztcclxuICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgIHJldHVybiBOZXdEYXRhVHlwZS5TdHJpbmc7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxufSJdfQ==
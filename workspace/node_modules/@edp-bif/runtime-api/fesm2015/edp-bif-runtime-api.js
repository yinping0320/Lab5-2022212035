import mxgraphFactory from 'mxgraph';
import { TranslateService } from '@ngx-translate/core';
import { TreeModule } from '@farris/ui-tree';
import { FarrisCommonModule } from '@farris/ui-common';
import { DatagridEditorsModule, EditorProviders } from '@farris/ui-datagrid-editors';
import { TreeTableModule } from '@farris/ui-treetable';
import { InputGroupModule } from '@farris/ui-input-group';
import { LanguageTextboxModule } from '@farris/ui-language-textbox';
import { NumberSpinnerModule } from '@farris/ui-number-spinner';
import { SwitchModule } from '@farris/ui-switch';
import { catchError, map, switchMap } from 'rxjs/operators';
import { CommonModule } from '@angular/common';
import { HttpClient, HttpClientModule } from '@angular/common/http';
import { AppType, FrameworkService, FrmEventBus, FuncsService, LoadingService as LoadingService$1, AppService } from '@gsp-sys/rtf-common';
import { HttpService, CacheService, SessionService } from '@ecp-caf/caf-common';
import { AngularDraggableModule } from '@farris/ui-draggable';
import { TextModule } from '@farris/ui-text';
import { FarrisSectionModule } from '@farris/ui-section';
import { FarrisDialogModule } from '@farris/ui-dialog';
import { RtSlimBillCreationProcessEntityEx, JointQueryMode, BpmnModelJsonHelper as BpmnModelJsonHelper$1, FormSettings, GeneralTextEntity, BillTrackingSettings, JointQueryParameterType, BillTrackingDataShownMode, fullPathPrefix } from '@edp-bif/common-api';
import { DatagridModule } from '@farris/ui-datagrid';
import { LoadingService, LoadingModule } from '@farris/ui-loading';
import { BsModalService, ModalModule } from '@farris/ui-modal';
import { NotifyModule, NotifyService } from '@farris/ui-notify';
import { FormsModule } from '@angular/forms';
import { of, Subject, Observable, from, throwError } from 'rxjs';
import { FormCreationRuleExecutorArgs, RpcCreationRuleExecutorResult, FormCreateResult, FormUpdateResult, FormBillCreationProcessExecutorResult, FormCreateArgs, FormUpdateArgs } from '@edp-aif/runtime-api';
export { FormBillCreationProcessExecutorResult, FormCreationRuleExecutorArgs, FormCreateArgs, FormCreateResult, FormUpdateArgs, FormUpdateResult, RpcCreationRuleExecutorResult, RpcCreationMappingResult, MappingAssociation, RpcMappingResult } from '@edp-aif/runtime-api';
import { JsonConvertableImpl, BpmnModelJsonHelper, BillSchema, BillData, DataType, PushCreationMode } from '@edp-aif/common-api';
import { MessagerService, MessagerModule } from '@farris/ui-messager';
import { Repository, FrameContext, ViewModel, BindingData, Entity } from '@farris/devkit';
import { RuntimeFrameworkService, NavigationService, StateMachineService, CardDataService } from '@farris/command-services';
import { InjectionToken, Pipe, Inject, LOCALE_ID, ComponentFactoryResolver, Injectable, Injector, NgModuleFactoryLoader, Optional, ComponentRef, ReflectiveInjector, Component, ElementRef, ViewChild, NgModule, SystemJsNgModuleLoader, Output, EventEmitter, Input, ViewContainerRef, ChangeDetectorRef, ChangeDetectionStrategy, ApplicationRef, Directive } from '@angular/core';

/**
 * @fileoverview added by tsickle
 * Generated from: lib/ref/mxgraph/mxgraphFactory.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
window['mxBasePath'] = window['mxBasePath'] || "/platform/runtime/common/web/@edp-pmf/mxgraph";
window['mxLoadResources'] = window['mxLoadResources'] || undefined;
window['mxForceIncludes'] = window['mxForceIncludes'] || undefined;
window['mxResourceExtension'] = window['mxResourceExtension'] || undefined;
window['mxLoadStylesheets'] = window['mxLoadStylesheets'] || undefined;
window['imageBasePath'] = window['imageBasePath'] || undefined;
window['mxLanguage'] = window['mxLanguage'] || undefined;
window['mxDefaultLanguage'] = window['mxDefaultLanguage'] || undefined;
window['mxLanguages'] = window['mxLanguages'] || undefined;
// declare global {
//     var mxBasePath;
//     var mxLoadResources;
//     var mxForceIncludes;
//     var mxResourceExtension;
//     var mxLoadStylesheets;
//     var mxBasePath;
//     var imageBasePath;
//     var mxLanguage;
//     var mxDefaultLanguage;
//     var mxLanguages;
// }
// declare const require:any;
// const mxgraphFactory = require("/platform/common/web/mxgraph/build.js");
/** @type {?} */
const mxgraph = mxgraphFactory({});

/**
 * @fileoverview added by tsickle
 * Generated from: lib/ref/mxgraph/Editor.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/**
 * Editor
 * @type {?}
 */
const mxDefaultKeyHandlerType = mxgraph.mxDefaultKeyHandler;
/** @type {?} */
const mxDefaultPopupMenuType = mxgraph.mxDefaultPopupMenu;
/** @type {?} */
const mxDefaultToolbarType = mxgraph.mxDefaultToolbar;
/** @type {?} */
const mxEditorType = mxgraph.mxEditor;

/**
 * @fileoverview added by tsickle
 * Generated from: lib/ref/mxgraph/Handler.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/**
 * Handler
 * @type {?}
 */
const mxCellHighlightType = mxgraph.mxCellHighlight;
/** @type {?} */
const mxCellMarkerType = mxgraph.mxCellMarker;
/** @type {?} */
const mxCellTrackerType = mxgraph.mxCellTracker;
/** @type {?} */
const mxConnectionHandlerType = mxgraph.mxConnectionHandler;
/** @type {?} */
const mxConstraintHandlerType = mxgraph.mxConstraintHandler;
/** @type {?} */
const mxEdgeHandlerType = mxgraph.mxEdgeHandler;
/** @type {?} */
const mxEdgeSegmentHandlerType = mxgraph.mxEdgeSegmentHandler;
/** @type {?} */
const mxElbowEdgeHandlerType = mxgraph.mxElbowEdgeHandler;
/** @type {?} */
const mxGraphHandlerType = mxgraph.mxGraphHandler;
/** @type {?} */
const mxHandleType = mxgraph.mxHandle;
/** @type {?} */
const mxKeyHandlerType = mxgraph.mxKeyHandler;
/** @type {?} */
const mxPanningHandlerType = mxgraph.mxPanningHandler;
/** @type {?} */
const mxPopupMenuHandlerType = mxgraph.mxPopupMenuHandler;
/** @type {?} */
const mxRubberbandType = mxgraph.mxRubberband;
/** @type {?} */
const mxSelectionCellsHandlerType = mxgraph.mxSelectionCellsHandler;
/** @type {?} */
const mxTooltipHandlerType = mxgraph.mxTooltipHandler;
/** @type {?} */
const mxVertexHandlerType = mxgraph.mxVertexHandler;

/**
 * @fileoverview added by tsickle
 * Generated from: lib/ref/mxgraph/IO.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/**
 * IO
 * @type {?}
 */
const mxCellCodecType = mxgraph.mxCellCodec;
/** @type {?} */
const mxChildChangeCodecType = mxgraph.mxChildChangeCodec;
/** @type {?} */
const mxDefaultKeyHandlerCodecType = mxgraph.mxDefaultKeyHandlerCodec;
/** @type {?} */
const mxDefaultPopupMenuCodecType = mxgraph.mxDefaultPopupMenuCodec;
/** @type {?} */
const mxDefaultToolbarCodecType = mxgraph.mxDefaultToolbarCodec;
/** @type {?} */
const mxEditorCodecType = mxgraph.mxEditorCodec;
/** @type {?} */
const mxGenericChangeCodecType = mxgraph.mxGenericChangeCodec;
/** @type {?} */
const mxGraphCodecType = mxgraph.mxGraphCodec;
/** @type {?} */
const mxGraphViewCodecType = mxgraph.mxGraphViewCodec;
/** @type {?} */
const mxModelCodecType = mxgraph.mxModelCodec;
/** @type {?} */
const mxObjectCodecType = mxgraph.mxObjectCodec;
/** @type {?} */
const mxRootChangeCodecType = mxgraph.mxRootChangeCodec;
/** @type {?} */
const mxStylesheetCodecType = mxgraph.mxStylesheetCodec;
/** @type {?} */
const mxTerminalChangeCodecType = mxgraph.mxTerminalChangeCodec;

/**
 * @fileoverview added by tsickle
 * Generated from: lib/ref/mxgraph/Layout.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/**
 * Layout
 * @type {?}
 */
const mxCircleLayoutType = mxgraph.mxCircleLayout;
/** @type {?} */
const mxCompactTreeLayoutType = mxgraph.mxCompactTreeLayout;
/** @type {?} */
const mxCompositeLayoutType = mxgraph.mxCompositeLayout;
/** @type {?} */
const mxEdgeLabelLayoutType = mxgraph.mxEdgeLabelLayout;
/** @type {?} */
const mxFastOrganicLayoutType = mxgraph.mxFastOrganicLayout;
/** @type {?} */
const mxGraphLayoutType = mxgraph.mxGraphLayout;
/** @type {?} */
const mxParallelEdgeLayoutType = mxgraph.mxParallelEdgeLayout;
/** @type {?} */
const mxPartitionLayoutType = mxgraph.mxPartitionLayout;
/** @type {?} */
const mxRadialTreeLayoutType = mxgraph.mxRadialTreeLayout;
/** @type {?} */
const mxStackLayoutType = mxgraph.mxStackLayout;
/**
 * Layout Hierarchical
 * @type {?}
 */
const mxHierarchicalLayoutType = mxgraph.mxHierarchicalLayout;
/** @type {?} */
const mxSwimlaneLayoutType = mxgraph.mxSwimlaneLayout;
/**
 * Layout Hierarchical Model
 * @type {?}
 */
const mxGraphAbstractHierarchyCellType = mxgraph.mxGraphAbstractHierarchyCell;
/** @type {?} */
const mxGraphHierarchyEdgeType = mxgraph.mxGraphHierarchyEdge;
/** @type {?} */
const mxGraphHierarchyModelType = mxgraph.mxGraphHierarchyModel;
/** @type {?} */
const mxGraphHierarchyNodeType = mxgraph.mxGraphHierarchyNode;
/** @type {?} */
const mxSwimlaneModelType = mxgraph.mxSwimlaneModel;
/**
 * Layout Hierarchical Stage
 * @type {?}
 */
const mxCoordinateAssignmentType = mxgraph.mxCoordinateAssignment;
/** @type {?} */
const mxHierarchicalLayoutStageType = mxgraph.mxHierarchicalLayoutStage;
/** @type {?} */
const mxMedianHybridCrossingReductionType = mxgraph.mxMedianHybridCrossingReduction;
/** @type {?} */
const mxMinimumCycleRemoverType = mxgraph.mxMinimumCycleRemover;
/** @type {?} */
const mxSwimlaneOrderingType = mxgraph.mxSwimlaneOrdering;

/**
 * @fileoverview added by tsickle
 * Generated from: lib/ref/mxgraph/Model.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/**
 * Model
 * @type {?}
 */
const mxCellType = mxgraph.mxCell;
/** @type {?} */
const mxCellPathType = mxgraph.mxCellPath;
/** @type {?} */
const mxGeometryType = mxgraph.mxGeometry;
/** @type {?} */
const mxGraphModelType = mxgraph.mxGraphModel;

/**
 * @fileoverview added by tsickle
 * Generated from: lib/ref/mxgraph/Others.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/**
 * Others
 * @type {?}
 */
const renderingHintType = mxgraph.renderingHint;

/**
 * @fileoverview added by tsickle
 * Generated from: lib/ref/mxgraph/Shape.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/**
 * Shape
 * @type {?}
 */
const mxActorType = mxgraph.mxActor;
/** @type {?} */
const mxArrowType = mxgraph.mxArrow;
/** @type {?} */
const mxArrowConnectorType = mxgraph.mxArrowConnector;
/** @type {?} */
const mxCloudType = mxgraph.mxCloud;
/** @type {?} */
const mxConnectorType = mxgraph.mxConnector;
/** @type {?} */
const mxCylinderType = mxgraph.mxCylinder;
/** @type {?} */
const mxDoubleEllipseType = mxgraph.mxDoubleEllipse;
/** @type {?} */
const mxEllipseType = mxgraph.mxEllipse;
/** @type {?} */
const mxHexagonType = mxgraph.mxHexagon;
/** @type {?} */
const mxImageShapeType = mxgraph.mxImageShape;
/** @type {?} */
const mxLabelType = mxgraph.mxLabel;
/** @type {?} */
const mxLineType = mxgraph.mxLine;
/** @type {?} */
const mxMarkerType = mxgraph.mxMarker;
/** @type {?} */
const mxPolylineType = mxgraph.mxPolyline;
/** @type {?} */
const mxRectangleShapeType = mxgraph.mxRectangleShape;
/** @type {?} */
const mxRhombusType = mxgraph.mxRhombus;
/** @type {?} */
const mxShapeType = mxgraph.mxShape;
/** @type {?} */
const mxStencilType = mxgraph.mxStencil;
/** @type {?} */
const mxStencilRegistryType = mxgraph.mxStencilRegistry;
/** @type {?} */
const mxSwimlaneType = mxgraph.mxSwimlane;
/** @type {?} */
const mxTextType = mxgraph.mxText;
/** @type {?} */
const mxTriangleType = mxgraph.mxTriangle;

/**
 * @fileoverview added by tsickle
 * Generated from: lib/ref/mxgraph/Util.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/**
 * Util
 * @type {?}
 */
const mxAbstractCanvas2DType = mxgraph.mxAbstractCanvas2D;
/** @type {?} */
const mxAnimationType = mxgraph.mxAnimation;
/** @type {?} */
const mxAutoSaveManagerType = mxgraph.mxAutoSaveManager;
/** @type {?} */
const mxClipboardType = mxgraph.mxClipboard;
/** @type {?} */
const mxConstantsType = mxgraph.mxConstants;
/** @type {?} */
const mxDictionaryType = mxgraph.mxDictionary;
/** @type {?} */
const mxDivResizerType = mxgraph.mxDivResizer;
/** @type {?} */
const mxDragSourceType = mxgraph.mxDragSource;
/** @type {?} */
const mxEffectsType = mxgraph.mxEffects;
/** @type {?} */
const mxEventType = mxgraph.mxEvent;
/** @type {?} */
const mxEventObjectType = mxgraph.mxEventObject;
/** @type {?} */
const mxEventSourceType = mxgraph.mxEventSource;
/** @type {?} */
const mxFormType = mxgraph.mxForm;
/** @type {?} */
const mxGuideType = mxgraph.mxGuide;
/** @type {?} */
const mxImageType = mxgraph.mxImage;
/** @type {?} */
const mxImageBundleType = mxgraph.mxImageBundle;
/** @type {?} */
const mxImageExportType = mxgraph.mxImageExport;
/** @type {?} */
const mxLogType = mxgraph.mxLog;
/** @type {?} */
const mxMorphingType = mxgraph.mxMorphing;
/** @type {?} */
const mxMouseEventType = mxgraph.mxMouseEvent;
/** @type {?} */
const mxObjectIdentityType = mxgraph.mxObjectIdentity;
/** @type {?} */
const mxPanningManagerType = mxgraph.mxPanningManager;
/** @type {?} */
const mxPointType = mxgraph.mxPoint;
/** @type {?} */
const mxPopupMenuType = mxgraph.mxPopupMenu;
/** @type {?} */
const mxRectangleType = mxgraph.mxRectangle;
/** @type {?} */
const mxResourcesType = mxgraph.mxResources;
/** @type {?} */
const mxSvgCanvas2DType = mxgraph.mxSvgCanvas2D;
/** @type {?} */
const mxToolbarType = mxgraph.mxToolbar;
/** @type {?} */
const mxUndoableEditType = mxgraph.mxUndoableEdit;
/** @type {?} */
const mxUndoManagerType = mxgraph.mxUndoManager;
/** @type {?} */
const mxUrlConverterType = mxgraph.mxUrlConverter;
/** @type {?} */
const mxUtilsType = mxgraph.mxUtils;
/** @type {?} */
const mxVmlCanvas2DType = mxgraph.mxVmlCanvas2D;
/** @type {?} */
const mxWindowType = mxgraph.mxWindow;
/** @type {?} */
const mxXmlCanvas2DType = mxgraph.mxXmlCanvas2D;
/** @type {?} */
const mxXmlRequestType = mxgraph.mxXmlRequest;

/**
 * @fileoverview added by tsickle
 * Generated from: lib/ref/mxgraph/View.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/**
 * View
 * @type {?}
 */
const mxCellEditorType = mxgraph.mxCellEditor;
/** @type {?} */
const mxCellOverlayType = mxgraph.mxCellOverlay;
/** @type {?} */
const mxCellRendererType = mxgraph.mxCellRenderer;
/** @type {?} */
const mxCellStateType = mxgraph.mxCellState;
/** @type {?} */
const mxCellStatePreviewType = mxgraph.mxCellStatePreview;
/** @type {?} */
const mxConnectionConstraintType = mxgraph.mxConnectionConstraint;
/** @type {?} */
const mxEdgeStyleType = mxgraph.mxEdgeStyle;
/** @type {?} */
const mxGraphType = mxgraph.mxGraph;
/** @type {?} */
const mxGraphSelectionModelType = mxgraph.mxGraphSelectionModel;
/** @type {?} */
const mxGraphViewType = mxgraph.mxGraphView;
/** @type {?} */
const mxLayoutManagerType = mxgraph.mxLayoutManager;
/** @type {?} */
const mxMultiplicityType = mxgraph.mxMultiplicity;
/** @type {?} */
const mxOutlineType = mxgraph.mxOutline;
/** @type {?} */
const mxPerimeterType = mxgraph.mxPerimeter;
/** @type {?} */
const mxPrintPreviewType = mxgraph.mxPrintPreview;
/** @type {?} */
const mxStyleRegistryType = mxgraph.mxStyleRegistry;
/** @type {?} */
const mxStylesheetType = mxgraph.mxStylesheet;
/** @type {?} */
const mxSwimlaneManagerType = mxgraph.mxSwimlaneManager;
/** @type {?} */
const mxTemporaryCellStatesType = mxgraph.mxTemporaryCellStates;

/**
 * @fileoverview added by tsickle
 * Generated from: lib/ref/mxgraph/mxClient.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/**
 * mxClient
 * @type {?}
 */
const mxClientType = mxgraph.mxClient;

/**
 * @fileoverview added by tsickle
 * Generated from: lib/ref/mxgraph/mxgraph-types.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
var MxGraphNS$1;
(function (MxGraphNS) {
})(MxGraphNS$1 || (MxGraphNS$1 = {}));

/**
 * @fileoverview added by tsickle
 * Generated from: lib/ref/mxgraph/index.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */

/**
 * @fileoverview added by tsickle
 * Generated from: lib/ref/index.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */

/**
 * @fileoverview added by tsickle
 * Generated from: lib/entity/data/BillData.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
class BillData$1 extends JsonConvertableImpl {
    /**
     * @protected
     * @return {?}
     */
    ResetBeforeLoadFrom() {
        super.ResetBeforeLoadFrom();
        this.name = null;
        this.value = null;
    }
    /**
     * @return {?}
     */
    ConvertToJsonObject() {
        /** @type {?} */
        let obj = super.ConvertToJsonObject();
        BpmnModelJsonHelper.SetAttributeValue(obj, "name", this.name);
        BpmnModelJsonHelper.SetAttributeValue(obj, "value", this.value);
        return obj;
    }
    /**
     * @param {?} obj
     * @return {?}
     */
    LoadFromJsonObject(obj) {
        super.LoadFromJsonObject(obj);
        this.name = BpmnModelJsonHelper.GetAttributeValueAsString(obj, "name");
        this.value = BpmnModelJsonHelper.GetAttributeValueAsString(obj, "value");
    }
}

/**
 * @fileoverview added by tsickle
 * Generated from: lib/entity/data/index.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */

/**
 * @fileoverview added by tsickle
 * Generated from: lib/entity/form-rest/ManualCreationMode.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/** @enum {string} */
const ManualCreationMode = {
    Push: "Push",
    Pull: "Pull",
    SpecificPush: "SpecificPush",
    SpecificPull: "SpecificPull",
};

/**
 * @fileoverview added by tsickle
 * Generated from: lib/entity/form-rest/FormBillCreationProcessExecutorArgs.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
class FormBillCreationProcessExecutorArgs extends FormCreationRuleExecutorArgs {
    constructor() {
        super(...arguments);
        /**
         * sourceVoEntityDatas和sourceVoEntityDataIds设置其一即可，优先使用sourceVoEntityDatas，若为空则根据sourceVoEntityDataIds查询
         */
        this.sourceVoEntityDataIds = [];
    }
    /**
     * @protected
     * @return {?}
     */
    ResetBeforeLoadFrom() {
        super.ResetBeforeLoadFrom();
        this.billCreationProcessId = null;
        this.creationRuleInstanceId = null;
    }
    /**
     * @return {?}
     */
    ConvertToJsonObject() {
        /** @type {?} */
        let obj = super.ConvertToJsonObject();
        BpmnModelJsonHelper.SetAttributeValue(obj, "billCreationProcessId", this.billCreationProcessId);
        BpmnModelJsonHelper.SetAttributeValue(obj, "creationRuleInstanceId", this.creationRuleInstanceId);
        BpmnModelJsonHelper.SetAttributeValue(obj, "manualCreationMode", this.manualCreationMode);
        BpmnModelJsonHelper.SetAttributeValue(obj, "sourceVoEntityDataIds", BpmnModelJsonHelper.StringListToJson(this.sourceVoEntityDataIds));
        return obj;
    }
    /**
     * @param {?} obj
     * @return {?}
     */
    LoadFromJsonObject(obj) {
        super.LoadFromJsonObject(obj);
        this.billCreationProcessId = BpmnModelJsonHelper.GetAttributeValueAsString(obj, "billCreationProcessId");
        this.creationRuleInstanceId = BpmnModelJsonHelper.GetAttributeValueAsString(obj, "creationRuleInstanceId");
        this.manualCreationMode = ManualCreationMode[BpmnModelJsonHelper.GetAttributeValueAsString(obj, "creationRuleInstanceId")];
        this.sourceVoEntityDataIds = BpmnModelJsonHelper.StringListFromJson(BpmnModelJsonHelper.GetAttributeValue(obj, "sourceVoEntityDataIds"));
    }
}

/**
 * @fileoverview added by tsickle
 * Generated from: lib/entity/form-rest/FormGetBillCreationProcessEntityExArgs.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
class FormGetBillCreationProcessEntityExArgs extends JsonConvertableImpl {
    /**
     * @protected
     * @return {?}
     */
    ResetBeforeLoadFrom() {
        super.ResetBeforeLoadFrom();
        this.upBillVoId = null;
        this.downBillVoId = null;
        this.manualCreationMode = null;
    }
    /**
     * @return {?}
     */
    ConvertToJsonObject() {
        /** @type {?} */
        let obj = super.ConvertToJsonObject();
        BpmnModelJsonHelper.SetAttributeValue(obj, "upBillVoId", this.upBillVoId);
        BpmnModelJsonHelper.SetAttributeValue(obj, "downBillVoId", this.downBillVoId);
        BpmnModelJsonHelper.SetAttributeValue(obj, "manualCreationMode", this.manualCreationMode);
        return obj;
    }
    /**
     * @param {?} obj
     * @return {?}
     */
    LoadFromJsonObject(obj) {
        super.LoadFromJsonObject(obj);
        this.upBillVoId = BpmnModelJsonHelper.GetAttributeValueAsString(obj, "upBillVoId");
        this.downBillVoId = BpmnModelJsonHelper.GetAttributeValueAsString(obj, "downBillVoId");
        this.manualCreationMode = ManualCreationMode[BpmnModelJsonHelper.GetAttributeValueAsString(obj, "manualCreationMode")];
    }
}

/**
 * @fileoverview added by tsickle
 * Generated from: lib/entity/form-rest/FormGetBillCreationProcessEntityExResult.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
class FormGetBillCreationProcessEntityExResult extends JsonConvertableImpl {
    /**
     * @protected
     * @return {?}
     */
    ResetBeforeLoadFrom() {
        super.ResetBeforeLoadFrom();
        this.billCreationProcessEntityExes = new Array();
    }
    /**
     * @return {?}
     */
    ConvertToJsonObject() {
        /** @type {?} */
        let obj = super.ConvertToJsonObject();
        BpmnModelJsonHelper.SetAttributeValue(obj, "billCreationProcessEntityExes", this.billCreationProcessEntityExes);
        return obj;
    }
    /**
     * @param {?} obj
     * @return {?}
     */
    LoadFromJsonObject(obj) {
        super.LoadFromJsonObject(obj);
        this.billCreationProcessEntityExes = BpmnModelJsonHelper.GetAttributeValueAsList(obj, "billCreationProcessEntityExes", RtSlimBillCreationProcessEntityEx);
    }
}

/**
 * @fileoverview added by tsickle
 * Generated from: lib/entity/form-rest/GeneralTextIdWithDataId.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
class GeneralTextIdWithDataId extends JsonConvertableImpl {
    /**
     * @protected
     * @return {?}
     */
    ResetBeforeLoadFrom() {
        super.ResetBeforeLoadFrom();
        this.generalTextId = null;
        this.dataId = null;
    }
    /**
     * @return {?}
     */
    ConvertToJsonObject() {
        /** @type {?} */
        let obj = super.ConvertToJsonObject();
        BpmnModelJsonHelper.SetAttributeValue(obj, "generalTextId", this.generalTextId);
        BpmnModelJsonHelper.SetAttributeValue(obj, "dataId", this.dataId);
        return obj;
    }
    /**
     * @param {?} obj
     * @return {?}
     */
    LoadFromJsonObject(obj) {
        super.LoadFromJsonObject(obj);
        this.generalTextId = BpmnModelJsonHelper.GetAttributeValueAsString(obj, "generalTextId");
        this.dataId = BpmnModelJsonHelper.GetAttributeValueAsString(obj, "dataId");
    }
}

/**
 * @fileoverview added by tsickle
 * Generated from: lib/entity/form-rest/index.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */

/**
 * @fileoverview added by tsickle
 * Generated from: lib/entity/tracking/BillDetailInfo.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
class BillDetailInfo extends JsonConvertableImpl {
    constructor() {
        super(...arguments);
        this.detailIds = [];
    }
    /**
     * @protected
     * @return {?}
     */
    ResetBeforeLoadFrom() {
        super.ResetBeforeLoadFrom();
        this.detailCode = null;
        this.detailIds = [];
    }
    /**
     * @return {?}
     */
    ConvertToJsonObject() {
        /** @type {?} */
        let obj = super.ConvertToJsonObject();
        BpmnModelJsonHelper.SetAttributeValue(obj, "detailCode", this.detailCode);
        BpmnModelJsonHelper.SetAttributeValue(obj, "detailIds", BpmnModelJsonHelper.StringListToJson(this.detailIds));
        return obj;
    }
    /**
     * @param {?} obj
     * @return {?}
     */
    LoadFromJsonObject(obj) {
        super.LoadFromJsonObject(obj);
        this.detailCode = BpmnModelJsonHelper.GetAttributeValueAsString(obj, "detailCode");
        this.detailIds = BpmnModelJsonHelper.StringListFromJson(BpmnModelJsonHelper.GetAttributeValueAsString(obj, "detailIds"));
    }
}

/**
 * @fileoverview added by tsickle
 * Generated from: lib/entity/tracking/BillItemInfo.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
class BillItemInfo extends JsonConvertableImpl {
    constructor() {
        super(...arguments);
        this.billDetailInfos = [];
    }
    /**
     * @protected
     * @return {?}
     */
    ResetBeforeLoadFrom() {
        super.ResetBeforeLoadFrom();
        this.itemId = null;
        this.billDetailInfos = [];
    }
    /**
     * @return {?}
     */
    ConvertToJsonObject() {
        /** @type {?} */
        let obj = super.ConvertToJsonObject();
        BpmnModelJsonHelper.SetAttributeValue(obj, "itemId", this.itemId);
        BpmnModelJsonHelper.SetAttributeValue(obj, "billDetailInfos", this.billDetailInfos);
        return obj;
    }
    /**
     * @param {?} obj
     * @return {?}
     */
    LoadFromJsonObject(obj) {
        super.LoadFromJsonObject(obj);
        this.itemId = BpmnModelJsonHelper.GetAttributeValueAsString(obj, "itemId");
        this.billDetailInfos = BpmnModelJsonHelper.GetAttributeValueAsList(obj, "billDetailInfos", BillDetailInfo);
    }
}

/**
 * @fileoverview added by tsickle
 * Generated from: lib/entity/tracking/BillChildInfo.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
class BillChildInfo extends JsonConvertableImpl {
    constructor() {
        super(...arguments);
        this.billItemInfos = [];
    }
    /**
     * @protected
     * @return {?}
     */
    ResetBeforeLoadFrom() {
        super.ResetBeforeLoadFrom();
        this.itemCode = null;
        this.billItemInfos = [];
    }
    /**
     * @return {?}
     */
    ConvertToJsonObject() {
        /** @type {?} */
        let obj = super.ConvertToJsonObject();
        BpmnModelJsonHelper.SetAttributeValue(obj, "itemCode", this.itemCode);
        BpmnModelJsonHelper.SetAttributeValue(obj, "billItemInfos", this.billItemInfos);
        return obj;
    }
    /**
     * @param {?} obj
     * @return {?}
     */
    LoadFromJsonObject(obj) {
        super.LoadFromJsonObject(obj);
        this.itemCode = BpmnModelJsonHelper.GetAttributeValueAsString(obj, "itemCode");
        this.billItemInfos = BpmnModelJsonHelper.GetAttributeValueAsList(obj, "billItemInfos", BillItemInfo);
    }
}

/**
 * @fileoverview added by tsickle
 * Generated from: lib/entity/tracking/TrackingMappingAssociation.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
class TrackingMappingAssociation extends JsonConvertableImpl {
    /**
     * @protected
     * @return {?}
     */
    ResetBeforeLoadFrom() {
        super.ResetBeforeLoadFrom();
        this.upBillTableCodePath = null;
        this.upBillDataIdPath = null;
        this.downBillTableCodePath = null;
        this.downBillDataIdPath = null;
    }
    /**
     * @return {?}
     */
    ConvertToJsonObject() {
        /** @type {?} */
        let obj = super.ConvertToJsonObject();
        BpmnModelJsonHelper.SetAttributeValue(obj, "upBillTableCodePath", this.upBillTableCodePath);
        BpmnModelJsonHelper.SetAttributeValue(obj, "upBillDataIdPath", this.upBillDataIdPath);
        BpmnModelJsonHelper.SetAttributeValue(obj, "downBillTableCodePath", this.downBillTableCodePath);
        BpmnModelJsonHelper.SetAttributeValue(obj, "downBillDataIdPath", this.downBillDataIdPath);
        return obj;
    }
    /**
     * @param {?} obj
     * @return {?}
     */
    LoadFromJsonObject(obj) {
        super.LoadFromJsonObject(obj);
        this.upBillTableCodePath = BpmnModelJsonHelper.GetAttributeValueAsString(obj, "upBillTableCodePath");
        this.upBillDataIdPath = BpmnModelJsonHelper.GetAttributeValueAsString(obj, "upBillDataIdPath");
        this.downBillTableCodePath = BpmnModelJsonHelper.GetAttributeValueAsString(obj, "downBillTableCodePath");
        this.downBillDataIdPath = BpmnModelJsonHelper.GetAttributeValueAsString(obj, "downBillDataIdPath");
    }
}

/**
 * @fileoverview added by tsickle
 * Generated from: lib/entity/tracking/BillDataInfo.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
class BillDataInfo extends JsonConvertableImpl {
    constructor() {
        super(...arguments);
        this.billChildInfos = [];
    }
    /**
     * @protected
     * @return {?}
     */
    ResetBeforeLoadFrom() {
        super.ResetBeforeLoadFrom();
        this.dataId = null;
        this.caption = null;
        this.summary = null;
        this.canContinueTracking = false;
        this.trackingMappingAssociations = null;
        this.billChildInfos = [];
        this.curYear = null;
    }
    /**
     * @return {?}
     */
    ConvertToJsonObject() {
        /** @type {?} */
        let obj = super.ConvertToJsonObject();
        BpmnModelJsonHelper.SetAttributeValue(obj, "dataId", this.dataId);
        BpmnModelJsonHelper.SetAttributeValue(obj, "caption", this.caption);
        BpmnModelJsonHelper.SetAttributeValue(obj, "summary", this.summary);
        BpmnModelJsonHelper.SetAttributeValue(obj, "canContinueTracking", this.canContinueTracking);
        BpmnModelJsonHelper.SetAttributeValue(obj, "trackingMappingAssociations", this.trackingMappingAssociations);
        BpmnModelJsonHelper.SetAttributeValue(obj, "billChildInfos", this.billChildInfos);
        BpmnModelJsonHelper.SetAttributeValue(obj, "curYear", this.curYear);
        return obj;
    }
    /**
     * @param {?} obj
     * @return {?}
     */
    LoadFromJsonObject(obj) {
        super.LoadFromJsonObject(obj);
        this.dataId = BpmnModelJsonHelper.GetAttributeValueAsString(obj, "dataId");
        this.caption = BpmnModelJsonHelper.GetAttributeValueAsString(obj, "caption");
        this.summary = BpmnModelJsonHelper.GetAttributeValueAsString(obj, "summary");
        this.canContinueTracking = BpmnModelJsonHelper.GetAttributeValueAsBoolean(obj, "canContinueTracking");
        this.trackingMappingAssociations = BpmnModelJsonHelper.GetAttributeValueAsList(obj, "trackingMappingAssociations", TrackingMappingAssociation);
        this.billChildInfos = BpmnModelJsonHelper.GetAttributeValueAsList(obj, "billChildInfos", BillChildInfo);
        this.curYear = BpmnModelJsonHelper.GetAttributeValueAsString(obj, "curYear");
    }
}

/**
 * @fileoverview added by tsickle
 * Generated from: lib/entity/tracking/BillInfo.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
class BillInfo extends JsonConvertableImpl {
    constructor() {
        super(...arguments);
        this.billDataInfos = [];
        this.jointQueryMode = JointQueryMode.DEFAULT;
    }
    /**
     * @protected
     * @return {?}
     */
    ResetBeforeLoadFrom() {
        super.ResetBeforeLoadFrom();
        this.billTrackingSettings = null;
        this.schemaId = null;
        this.suCode = null;
        this.documentTypeId = null;
        this.bizKind = null;
        this.bizType = null;
        this.billDataInfos = [];
        this.jointQueryMode = JointQueryMode.DEFAULT;
        this.jointQueryParameters = null;
        this.trackingSourceType = null;
    }
    /**
     * @return {?}
     */
    ConvertToJsonObject() {
        /** @type {?} */
        let obj = super.ConvertToJsonObject();
        BpmnModelJsonHelper.SetAttributeValue(obj, "billTrackingSettings", this.billTrackingSettings);
        BpmnModelJsonHelper.SetAttributeValue(obj, "schemaId", this.schemaId);
        BpmnModelJsonHelper.SetAttributeValue(obj, "suCode", this.suCode);
        BpmnModelJsonHelper.SetAttributeValue(obj, "documentTypeId", this.documentTypeId);
        BpmnModelJsonHelper.SetAttributeValue(obj, "bizKind", this.bizKind);
        BpmnModelJsonHelper.SetAttributeValue(obj, "bizType", this.bizType);
        BpmnModelJsonHelper.SetAttributeValue(obj, "billDataInfos", this.billDataInfos);
        BpmnModelJsonHelper.SetAttributeValue(obj, "jointQueryMode", this.jointQueryMode);
        BpmnModelJsonHelper.SetAttributeValue(obj, "jointQueryParameters", this.jointQueryParameters);
        BpmnModelJsonHelper.SetAttributeValue(obj, "trackingSourceType", this.trackingSourceType);
        return obj;
    }
    /**
     * @param {?} obj
     * @return {?}
     */
    LoadFromJsonObject(obj) {
        super.LoadFromJsonObject(obj);
        this.billTrackingSettings = BpmnModelJsonHelper.GetAttributeValueAsString(obj, "billTrackingSettings");
        this.schemaId = BpmnModelJsonHelper.GetAttributeValueAsString(obj, "schemaId");
        this.suCode = BpmnModelJsonHelper.GetAttributeValueAsString(obj, "suCode");
        this.documentTypeId = BpmnModelJsonHelper.GetAttributeValueAsString(obj, "documentTypeId");
        this.bizKind = BpmnModelJsonHelper.GetAttributeValueAsString(obj, "bizKind");
        this.bizType = BpmnModelJsonHelper.GetAttributeValueAsString(obj, "bizType");
        this.billDataInfos = BpmnModelJsonHelper.GetAttributeValueAsList(obj, "billDataInfos", BillDataInfo);
        this.jointQueryMode = JointQueryMode[BpmnModelJsonHelper.GetAttributeValueAsString(obj, "jointQueryMode")];
        this.jointQueryParameters = BpmnModelJsonHelper.GetAttributeValueAsString(obj, "jointQueryParameters");
        this.trackingSourceType = BpmnModelJsonHelper.GetAttributeValueAsString(obj, "trackingSourceType");
    }
}

/**
 * @fileoverview added by tsickle
 * Generated from: lib/entity/tracking/CanTrackingInfo.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/**
 * 此类在graph组件中需要硬转为BillInfo对象，故增减字段时需要同步修改data-service中的build方法
 * @see { BillTrackerDataService }
 */
class CanTrackingInfo extends JsonConvertableImpl {
    constructor() {
        super(...arguments);
        this.billChildInfos = [];
        this.jointQueryMode = JointQueryMode.DEFAULT;
    }
    /**
     * @protected
     * @return {?}
     */
    ResetBeforeLoadFrom() {
        super.ResetBeforeLoadFrom();
        this.canUpTracking = false;
        this.canDownTracking = false;
        this.documentTypeId = null;
        this.bizKind = null;
        this.bizType = null;
        this.dataId = null;
        this.caption = null;
        this.summary = null;
        this.suCode = null;
        this.schemaId = null;
        this.billChildInfos = [];
        this.jointQueryMode = JointQueryMode.DEFAULT;
        this.jointQueryParameters = null;
        this.trackingSourceType = null;
        this.curYear = null;
    }
    /**
     * @return {?}
     */
    ConvertToJsonObject() {
        /** @type {?} */
        let obj = super.ConvertToJsonObject();
        BpmnModelJsonHelper.SetAttributeValue(obj, "canUpTracking", this.canUpTracking);
        BpmnModelJsonHelper.SetAttributeValue(obj, "canDownTracking", this.canDownTracking);
        BpmnModelJsonHelper.SetAttributeValue(obj, "documentTypeId", this.documentTypeId);
        BpmnModelJsonHelper.SetAttributeValue(obj, "bizKind", this.bizKind);
        BpmnModelJsonHelper.SetAttributeValue(obj, "bizType", this.bizType);
        BpmnModelJsonHelper.SetAttributeValue(obj, "dataId", this.dataId);
        BpmnModelJsonHelper.SetAttributeValue(obj, "caption", this.caption);
        BpmnModelJsonHelper.SetAttributeValue(obj, "summary", this.summary);
        BpmnModelJsonHelper.SetAttributeValue(obj, "suCode", this.suCode);
        BpmnModelJsonHelper.SetAttributeValue(obj, "schemaId", this.schemaId);
        BpmnModelJsonHelper.SetAttributeValue(obj, "billChildInfos", this.billChildInfos);
        BpmnModelJsonHelper.SetAttributeValue(obj, "jointQueryMode", this.jointQueryMode);
        BpmnModelJsonHelper.SetAttributeValue(obj, "jointQueryParameters", this.jointQueryParameters);
        BpmnModelJsonHelper.SetAttributeValue(obj, "trackingSourceType", this.trackingSourceType);
        BpmnModelJsonHelper.SetAttributeValue(obj, "curYear", this.curYear);
        return obj;
    }
    /**
     * @param {?} obj
     * @return {?}
     */
    LoadFromJsonObject(obj) {
        super.LoadFromJsonObject(obj);
        this.canUpTracking = BpmnModelJsonHelper.GetAttributeValueAsBoolean(obj, "canUpTracking");
        this.canDownTracking = BpmnModelJsonHelper.GetAttributeValueAsBoolean(obj, "canDownTracking");
        this.documentTypeId = BpmnModelJsonHelper.GetAttributeValueAsString(obj, "documentTypeId");
        this.bizKind = BpmnModelJsonHelper.GetAttributeValueAsString(obj, "bizKind");
        this.bizType = BpmnModelJsonHelper.GetAttributeValueAsString(obj, "bizType");
        this.dataId = BpmnModelJsonHelper.GetAttributeValueAsString(obj, "dataId");
        this.caption = BpmnModelJsonHelper.GetAttributeValueAsString(obj, "caption");
        this.summary = BpmnModelJsonHelper.GetAttributeValueAsString(obj, "summary");
        this.suCode = BpmnModelJsonHelper.GetAttributeValueAsString(obj, "suCode");
        this.schemaId = BpmnModelJsonHelper.GetAttributeValueAsString(obj, "schemaId");
        this.billChildInfos = BpmnModelJsonHelper.GetAttributeValueAsList(obj, "billChildInfos", BillChildInfo);
        this.jointQueryMode = JointQueryMode[BpmnModelJsonHelper.GetAttributeValueAsString(obj, "jointQueryMode")];
        this.jointQueryParameters = BpmnModelJsonHelper.GetAttributeValueAsString(obj, "jointQueryParameters");
        this.trackingSourceType = BpmnModelJsonHelper.GetAttributeValueAsString(obj, "trackingSourceType");
        this.curYear = BpmnModelJsonHelper.GetAttributeValueAsString(obj, "curYear");
    }
}

/**
 * @fileoverview added by tsickle
 * Generated from: lib/entity/tracking/DownBillInfo.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
class DownBillInfo extends BillInfo {
}

/**
 * @fileoverview added by tsickle
 * Generated from: lib/entity/tracking/GetBillsInfoArgs.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
class GetBillsInfoArgs extends JsonConvertableImpl {
    constructor() {
        super(...arguments);
        this.billChildInfos = [];
    }
    /**
     * @protected
     * @return {?}
     */
    ResetBeforeLoadFrom() {
        super.ResetBeforeLoadFrom();
        this.documentTypeId = null;
        this.bizKind = null;
        this.bizType = null;
        this.billDataId = null;
        this.billChildInfos = [];
        this.curYear = null;
    }
    /**
     * @return {?}
     */
    ConvertToJsonObject() {
        /** @type {?} */
        let obj = super.ConvertToJsonObject();
        BpmnModelJsonHelper.SetAttributeValue(obj, "documentTypeId", this.documentTypeId);
        BpmnModelJsonHelper.SetAttributeValue(obj, "bizKind", this.bizKind);
        BpmnModelJsonHelper.SetAttributeValue(obj, "bizType", this.bizType);
        BpmnModelJsonHelper.SetAttributeValue(obj, "billDataId", this.billDataId);
        BpmnModelJsonHelper.SetAttributeValue(obj, "billChildInfos", this.billChildInfos);
        BpmnModelJsonHelper.SetAttributeValue(obj, "curYear", this.curYear);
        return obj;
    }
    /**
     * @param {?} obj
     * @return {?}
     */
    LoadFromJsonObject(obj) {
        super.LoadFromJsonObject(obj);
        this.documentTypeId = BpmnModelJsonHelper.GetAttributeValueAsString(obj, "documentTypeId");
        this.bizKind = BpmnModelJsonHelper.GetAttributeValueAsString(obj, "bizKind");
        this.bizType = BpmnModelJsonHelper.GetAttributeValueAsString(obj, "bizType");
        this.billDataId = BpmnModelJsonHelper.GetAttributeValueAsString(obj, "billDataId");
        this.billChildInfos = BpmnModelJsonHelper.GetAttributeValueAsList(obj, "billChildInfos", BillChildInfo);
        this.curYear = BpmnModelJsonHelper.GetAttributeValueAsString(obj, "curYear");
    }
}

/**
 * @fileoverview added by tsickle
 * Generated from: lib/entity/tracking/GetDownBillsInfoArgs.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
class GetDownBillsInfoArgs extends GetBillsInfoArgs {
}

/**
 * @fileoverview added by tsickle
 * Generated from: lib/entity/tracking/GetUpBillsInfoArgs.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
class GetUpBillsInfoArgs extends GetBillsInfoArgs {
}

/**
 * @fileoverview added by tsickle
 * Generated from: lib/entity/tracking/TrackingHelper.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
class TrackingHelper {
    /**
     * @param {?} originalDownBillInfos
     * @param {?} downBillInfos
     * @return {?}
     */
    static concatDownBillInfos(originalDownBillInfos, downBillInfos) {
        if (originalDownBillInfos == null) {
            originalDownBillInfos = new Array();
        }
        if (downBillInfos == null || downBillInfos.length == 0) {
            return originalDownBillInfos;
        }
        /** @type {?} */
        let originalVoIds = new Array();
        originalDownBillInfos.forEach((/**
         * @param {?} info
         * @return {?}
         */
        info => originalVoIds.push(info.schemaId)));
        for (let downBillInfo of downBillInfos) {
            //是否存在某类单据
            if (originalVoIds.includes(downBillInfo.schemaId)) {
                for (let oldDownBillInfo of originalDownBillInfos) {
                    if (oldDownBillInfo.schemaId == downBillInfo.schemaId) {
                        /** @type {?} */
                        let oldBillDataInfos = oldDownBillInfo.billDataInfos;
                        /** @type {?} */
                        let dataIds = new Array();
                        oldBillDataInfos.forEach((/**
                         * @param {?} dataInfo
                         * @return {?}
                         */
                        dataInfo => dataIds.push(dataInfo.dataId)));
                        for (let billDataInfo of downBillInfo.billDataInfos) {
                            //是否存在某张单据
                            if (dataIds.includes(billDataInfo.dataId)) {
                                for (let oldBillDataInfo of oldBillDataInfos) {
                                    if (oldBillDataInfo.dataId == billDataInfo.dataId) {
                                        /** @type {?} */
                                        let oldAssociations = oldBillDataInfo.trackingMappingAssociations;
                                        for (let association of billDataInfo.trackingMappingAssociations) {
                                            /** @type {?} */
                                            let i = 0;
                                            for (let association1 of oldAssociations) {
                                                //是否存在某条记录
                                                if (!(association.downBillDataIdPath == association1.downBillDataIdPath) ||
                                                    !(association.downBillTableCodePath == association1.downBillTableCodePath) ||
                                                    !(association.upBillDataIdPath == association1.upBillDataIdPath) ||
                                                    !(association.upBillTableCodePath == association1.upBillTableCodePath)) {
                                                    i++;
                                                }
                                            }
                                            if (i == oldAssociations.length) {
                                                oldAssociations.push(association);
                                            }
                                        }
                                    }
                                }
                            }
                            else {
                                oldBillDataInfos.push(billDataInfo);
                            }
                        }
                    }
                }
            }
            else {
                originalVoIds.push(downBillInfo.schemaId);
                originalDownBillInfos.push(downBillInfo);
            }
        }
        return originalDownBillInfos;
    }
    /**
     * @param {?} originalUpBillInfos
     * @param {?} upBillInfos
     * @return {?}
     */
    static concatUpBillInfos(originalUpBillInfos, upBillInfos) {
        if (originalUpBillInfos == null) {
            originalUpBillInfos = new Array();
        }
        if (upBillInfos == null || upBillInfos.length == 0) {
            return originalUpBillInfos;
        }
        /** @type {?} */
        let originalVoIds = new Array();
        originalUpBillInfos.forEach((/**
         * @param {?} info
         * @return {?}
         */
        info => {
            originalVoIds.push(info.schemaId);
        }));
        for (let upBillInfo of upBillInfos) {
            //是否存在某类单据
            if (originalVoIds.includes(upBillInfo.schemaId)) {
                for (let oldUpBillInfo of originalUpBillInfos) {
                    if (oldUpBillInfo.schemaId == upBillInfo.schemaId) {
                        /** @type {?} */
                        let oldBillDataInfos = oldUpBillInfo.billDataInfos;
                        /** @type {?} */
                        let dataIds = new Array();
                        oldBillDataInfos.forEach((/**
                         * @param {?} dataInfo
                         * @return {?}
                         */
                        dataInfo => dataIds.push(dataInfo.dataId)));
                        for (let billDataInfo of upBillInfo.billDataInfos) {
                            //是否存在某张单据
                            if (dataIds.includes(billDataInfo.dataId)) {
                                for (let oldBillDataInfo of oldBillDataInfos) {
                                    if (oldBillDataInfo.dataId == billDataInfo.dataId) {
                                        /** @type {?} */
                                        let oldAssociations = oldBillDataInfo.trackingMappingAssociations;
                                        for (let association of billDataInfo.trackingMappingAssociations) {
                                            /** @type {?} */
                                            let i = 0;
                                            for (let association1 of oldAssociations) {
                                                //是否存在某条记录
                                                if (!(association.downBillDataIdPath == association1.downBillDataIdPath) ||
                                                    !(association.downBillTableCodePath == association1.downBillTableCodePath) ||
                                                    !(association.upBillDataIdPath == association1.upBillDataIdPath) ||
                                                    !(association.upBillTableCodePath == association1.upBillTableCodePath)) {
                                                    i++;
                                                }
                                            }
                                            if (i == oldAssociations.length) {
                                                oldAssociations.push(association);
                                            }
                                        }
                                    }
                                }
                            }
                            else {
                                oldBillDataInfos.push(billDataInfo);
                            }
                        }
                    }
                }
            }
            else {
                originalVoIds.push(upBillInfo.schemaId);
                originalUpBillInfos.push(upBillInfo);
            }
        }
        return originalUpBillInfos;
    }
}

/**
 * @fileoverview added by tsickle
 * Generated from: lib/entity/tracking/UpBillInfo.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
class UpBillInfo extends BillInfo {
}

/**
 * @fileoverview added by tsickle
 * Generated from: lib/entity/tracking/typeToFormat.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/** @enum {string} */
const TypeToFormat = {
    DEFAULT: "DEFAULT",
    DATE: "DATE",
    DECIMAL: "DECIMAL",
    STRING: "STRING",
};

/**
 * @fileoverview added by tsickle
 * Generated from: lib/entity/tracking/FieldsWithOrder.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
class FieldsWithOrder extends JsonConvertableImpl {
    constructor() {
        super(...arguments);
        /**
         * 数据类型
         */
        this.typeToFormat = TypeToFormat.DEFAULT;
    }
    /**
     * @protected
     * @return {?}
     */
    ResetBeforeLoadFrom() {
        super.ResetBeforeLoadFrom();
        this.order = 0;
        this.fieldName = null;
        this.fieldPath = null;
        this.name = null;
        this.customName = null;
        this.colI18nValues = null;
        this.typeToFormat = TypeToFormat.DEFAULT;
        this.formatInfo = null;
        this.version = 0;
    }
    /**
     * @return {?}
     */
    ConvertToJsonObject() {
        /** @type {?} */
        let obj = super.ConvertToJsonObject();
        BpmnModelJsonHelper.SetAttributeValue(obj, "order", this.order);
        BpmnModelJsonHelper.SetAttributeValue(obj, "name", this.name);
        BpmnModelJsonHelper.SetAttributeValue(obj, "fieldName", this.fieldName);
        BpmnModelJsonHelper.SetAttributeValue(obj, "fieldPath", this.fieldPath);
        BpmnModelJsonHelper.SetAttributeValue(obj, "customName", this.customName);
        BpmnModelJsonHelper.SetAttributeValue(obj, "colI18nValues", this.colI18nValues);
        BpmnModelJsonHelper.SetAttributeValue(obj, "typeToFormat", this.typeToFormat);
        BpmnModelJsonHelper.SetAttributeValue(obj, "formatInfo", this.formatInfo);
        BpmnModelJsonHelper.SetAttributeValue(obj, "version", this.version);
        return obj;
    }
    /**
     * @param {?} obj
     * @return {?}
     */
    LoadFromJsonObject(obj) {
        super.LoadFromJsonObject(obj);
        this.order = BpmnModelJsonHelper.GetAttributeValueAsNumber(obj, "order");
        this.name = BpmnModelJsonHelper.GetAttributeValueAsString(obj, "name");
        this.fieldName = BpmnModelJsonHelper.GetAttributeValueAsString(obj, "fieldName");
        this.fieldPath = BpmnModelJsonHelper.GetAttributeValueAsString(obj, "fieldPath");
        this.customName = BpmnModelJsonHelper.GetAttributeValueAsString(obj, "customName");
        this.colI18nValues = BpmnModelJsonHelper.GetAttributeValueAsString(obj, "colI18nValues");
        this.typeToFormat = TypeToFormat[BpmnModelJsonHelper.GetAttributeValueAsString(obj, "typeToFormat")];
        this.formatInfo = BpmnModelJsonHelper.GetAttributeValueAsString(obj, "formatInfo");
        this.version = BpmnModelJsonHelper.GetAttributeValueAsNumber(obj, "version");
    }
}

/**
 * @fileoverview added by tsickle
 * Generated from: lib/entity/tracking/SummaryFieldsInfo.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
class SummaryFieldsInfo extends JsonConvertableImpl {
    constructor() {
        super(...arguments);
        this.fields = [];
        this.childFieldInfos = [];
    }
    /**
     * @protected
     * @return {?}
     */
    ResetBeforeLoadFrom() {
        super.ResetBeforeLoadFrom();
        this.code = null;
        this.fields = [];
        this.childFieldInfos = [];
    }
    /**
     * @return {?}
     */
    ConvertToJsonObject() {
        /** @type {?} */
        let obj = super.ConvertToJsonObject();
        BpmnModelJsonHelper.SetAttributeValue(obj, "code", this.code);
        BpmnModelJsonHelper.SetAttributeValue(obj, "fields", this.fields);
        BpmnModelJsonHelper.SetAttributeValue(obj, "childFieldInfos", this.childFieldInfos);
        return obj;
    }
    /**
     * @param {?} obj
     * @return {?}
     */
    LoadFromJsonObject(obj) {
        super.LoadFromJsonObject(obj);
        this.code = BpmnModelJsonHelper.GetAttributeValueAsString(obj, "code");
        this.fields = BpmnModelJsonHelper.GetAttributeValueAsList(obj, "fields", FieldsWithOrder);
        this.childFieldInfos = BpmnModelJsonHelper.GetAttributeValueAsList(obj, "childFieldInfos", SummaryFieldsInfo);
    }
}

/**
 * @fileoverview added by tsickle
 * Generated from: lib/entity/tracking/FieldNameAndValue.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
class FieldNameAndValue extends JsonConvertableImpl {
    /**
     * @protected
     * @return {?}
     */
    ResetBeforeLoadFrom() {
        super.ResetBeforeLoadFrom();
        this.name = null;
        this.value = null;
    }
    /**
     * @return {?}
     */
    ConvertToJsonObject() {
        /** @type {?} */
        let obj = super.ConvertToJsonObject();
        BpmnModelJsonHelper.SetAttributeValue(obj, "name", this.name);
        BpmnModelJsonHelper.SetAttributeValue(obj, "value", this.value);
        return obj;
    }
    /**
     * @param {?} obj
     * @return {?}
     */
    LoadFromJsonObject(obj) {
        super.LoadFromJsonObject(obj);
        this.name = BpmnModelJsonHelper.GetAttributeValueAsString(obj, "name");
        this.value = BpmnModelJsonHelper.GetAttributeValueAsString(obj, "value");
    }
}

/**
 * @fileoverview added by tsickle
 * Generated from: lib/entity/tracking/DateTypeFormatInfo.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
class DateTypeFormatInfo extends JsonConvertableImpl {
    /**
     * @protected
     * @return {?}
     */
    ResetBeforeLoadFrom() {
        super.ResetBeforeLoadFrom();
        this.displayFormat = null;
    }
    /**
     * @return {?}
     */
    ConvertToJsonObject() {
        /** @type {?} */
        let obj = super.ConvertToJsonObject();
        BpmnModelJsonHelper.SetAttributeValue(obj, "displayFormat", this.displayFormat);
        return obj;
    }
    /**
     * @param {?} obj
     * @return {?}
     */
    LoadFromJsonObject(obj) {
        super.LoadFromJsonObject(obj);
        this.displayFormat = BpmnModelJsonHelper.GetAttributeValueAsString(obj, "displayFormat");
    }
}

/**
 * @fileoverview added by tsickle
 * Generated from: lib/entity/tracking/ScaleMode.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/** @enum {string} */
const ScaleMode = {
    DEFAULT: "DEFAULT",
    NUMBER: "NUMBER",
    FIELD: "FIELD",
    EXPRESSION: "EXPRESSION",
};

/**
 * @fileoverview added by tsickle
 * Generated from: lib/entity/tracking/DecimalTypeFormatInfo.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
class DecimalTypeFormatInfo extends JsonConvertableImpl {
    constructor() {
        super(...arguments);
        this.scaleMode = ScaleMode.DEFAULT;
    }
    /**
     * @protected
     * @return {?}
     */
    ResetBeforeLoadFrom() {
        super.ResetBeforeLoadFrom();
        this.scale = 0;
        this.scaleMode = ScaleMode.DEFAULT;
        this.fieldPath = null;
        this.version = 0;
    }
    /**
     * @return {?}
     */
    ConvertToJsonObject() {
        /** @type {?} */
        let obj = super.ConvertToJsonObject();
        BpmnModelJsonHelper.SetAttributeValue(obj, "scale", this.scale);
        BpmnModelJsonHelper.SetAttributeValue(obj, "scale", this.scale);
        BpmnModelJsonHelper.SetAttributeValue(obj, "scaleMode", this.scaleMode);
        BpmnModelJsonHelper.SetAttributeValue(obj, "fieldPath", this.fieldPath);
        BpmnModelJsonHelper.SetAttributeValue(obj, "version", this.version);
        return obj;
    }
    /**
     * @param {?} obj
     * @return {?}
     */
    LoadFromJsonObject(obj) {
        super.LoadFromJsonObject(obj);
        this.scale = BpmnModelJsonHelper.GetAttributeValueAsNumber(obj, "scale");
        /** @type {?} */
        const scaleMode = BpmnModelJsonHelper.GetAttributeValueAsString(obj, "scaleMode");
        this.scaleMode = scaleMode == null ? ScaleMode.DEFAULT : ScaleMode[scaleMode];
        this.fieldPath = BpmnModelJsonHelper.GetAttributeValueAsString(obj, "fieldPath");
        this.version = BpmnModelJsonHelper.GetAttributeValueAsNumber(obj, "version");
    }
}

/**
 * @fileoverview added by tsickle
 * Generated from: lib/entity/tracking/typeToFormat.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/** @enum {string} */
const TypeToFormat$1 = {
    DEFAULT: "DEFAULT",
    DATE: "DATE",
    DECIMAL: "DECIMAL",
    STRING: "STRING",
};

/**
 * @fileoverview added by tsickle
 * Generated from: lib/entity/tracking/JointQueryParameterContent.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
class JointQueryParameterContent extends JsonConvertableImpl {
    /**
     * @protected
     * @return {?}
     */
    ResetBeforeLoadFrom() {
        super.ResetBeforeLoadFrom();
        this.parameterCode = null;
    }
    /**
     * @return {?}
     */
    ConvertToJsonObject() {
        /** @type {?} */
        let obj = super.ConvertToJsonObject();
        BpmnModelJsonHelper.SetAttributeValue(obj, "parameterCode", this.parameterCode);
        return obj;
    }
    /**
     * @param {?} obj
     * @return {?}
     */
    LoadFromJsonObject(obj) {
        super.LoadFromJsonObject(obj);
        this.parameterCode = BpmnModelJsonHelper.GetAttributeValueAsString(obj, "parameterCode");
    }
}

/**
 * @fileoverview added by tsickle
 * Generated from: lib/entity/tracking/ExpressionJointQueryParameterContent.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
class ExpressionJointQueryParameterContent extends JointQueryParameterContent {
    /**
     * @protected
     * @return {?}
     */
    ResetBeforeLoadFrom() {
        super.ResetBeforeLoadFrom();
        this.expressionContent = null;
    }
    /**
     * @return {?}
     */
    ConvertToJsonObject() {
        /** @type {?} */
        let obj = super.ConvertToJsonObject();
        BpmnModelJsonHelper.SetAttributeValue(obj, "expressionContent", this.expressionContent);
        return obj;
    }
    /**
     * @param {?} obj
     * @return {?}
     */
    LoadFromJsonObject(obj) {
        super.LoadFromJsonObject(obj);
        this.expressionContent = BpmnModelJsonHelper.GetAttributeValueAsString(obj, "expressionContent");
    }
}

/**
 * @fileoverview added by tsickle
 * Generated from: lib/entity/tracking/FieldJointQueryParameterContent.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
class FieldJointQueryParameterContent extends JointQueryParameterContent {
    /**
     * @protected
     * @return {?}
     */
    ResetBeforeLoadFrom() {
        super.ResetBeforeLoadFrom();
        this.fieldContent = null;
    }
    /**
     * @return {?}
     */
    ConvertToJsonObject() {
        /** @type {?} */
        let obj = super.ConvertToJsonObject();
        BpmnModelJsonHelper.SetAttributeValue(obj, "fieldContent", this.fieldContent);
        return obj;
    }
    /**
     * @param {?} obj
     * @return {?}
     */
    LoadFromJsonObject(obj) {
        super.LoadFromJsonObject(obj);
        this.fieldContent = BpmnModelJsonHelper.GetAttributeValueAsString(obj, "fieldContent");
    }
}

/**
 * @fileoverview added by tsickle
 * Generated from: lib/entity/tracking/JointQueryParameterMode.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/** @enum {string} */
const JointQueryParameterMode = {
    FIELD: "FIELD",
    EXPRESSION: "EXPRESSION",
    COMPONENT: "COMPONENT",
};

/**
 * @fileoverview added by tsickle
 * Generated from: lib/entity/tracking/JointQueryParameterResult.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
class JointQueryParameterResult extends JsonConvertableImpl {
    /**
     * @protected
     * @return {?}
     */
    ResetBeforeLoadFrom() {
        super.ResetBeforeLoadFrom();
        this.code = null;
        this.value = null;
    }
    /**
     * @return {?}
     */
    ConvertToJsonObject() {
        /** @type {?} */
        let obj = super.ConvertToJsonObject();
        BpmnModelJsonHelper.SetAttributeValue(obj, "code", this.code);
        BpmnModelJsonHelper.SetAttributeValue(obj, "value", this.value);
        return obj;
    }
    /**
     * @param {?} obj
     * @return {?}
     */
    LoadFromJsonObject(obj) {
        super.LoadFromJsonObject(obj);
        this.code = BpmnModelJsonHelper.GetAttributeValueAsString(obj, "code");
        this.value = BpmnModelJsonHelper.GetAttributeValueAsString(obj, "value");
    }
}

/**
 * @fileoverview added by tsickle
 * Generated from: lib/entity/tracking/JointQueryParametersContent.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
class JointQueryParametersContent extends JsonConvertableImpl {
    constructor() {
        super(...arguments);
        this.jointQueryParameterMode = JointQueryParameterMode.FIELD;
    }
    /**
     * @protected
     * @return {?}
     */
    ResetBeforeLoadFrom() {
        super.ResetBeforeLoadFrom();
        this.jointQueryParameterMode = JointQueryParameterMode.FIELD;
        this.content = null;
    }
    /**
     * @return {?}
     */
    ConvertToJsonObject() {
        /** @type {?} */
        let obj = super.ConvertToJsonObject();
        BpmnModelJsonHelper.SetAttributeValue(obj, "jointQueryParameterMode", this.jointQueryParameterMode);
        BpmnModelJsonHelper.SetAttributeValue(obj, "content", this.content);
        return obj;
    }
    /**
     * @param {?} obj
     * @return {?}
     */
    LoadFromJsonObject(obj) {
        super.LoadFromJsonObject(obj);
        this.jointQueryParameterMode = JointQueryParameterMode[BpmnModelJsonHelper.GetAttributeValueAsString(obj, "jointQueryParameterMode")];
        this.content = BpmnModelJsonHelper.GetAttributeValueAsString(obj, "content");
    }
}

/**
 * @fileoverview added by tsickle
 * Generated from: lib/entity/tracking/SimpleValueMappingInfo.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
class SimpleValueMappingInfo extends JsonConvertableImpl {
    /**
     * @protected
     * @return {?}
     */
    ResetBeforeLoadFrom() {
        super.ResetBeforeLoadFrom();
        this.displayValue = null;
        this.actualValue = null;
    }
    /**
     * @return {?}
     */
    ConvertToJsonObject() {
        /** @type {?} */
        let obj = super.ConvertToJsonObject();
        BpmnModelJsonHelper.SetAttributeValue(obj, "displayValue", this.displayValue);
        BpmnModelJsonHelper.SetAttributeValue(obj, "actualValue", this.actualValue);
        return obj;
    }
    /**
     * @param {?} obj
     * @return {?}
     */
    LoadFromJsonObject(obj) {
        super.LoadFromJsonObject(obj);
        this.displayValue = BpmnModelJsonHelper.GetAttributeValueAsString(obj, "displayValue");
        this.actualValue = BpmnModelJsonHelper.GetAttributeValueAsString(obj, "actualValue");
    }
}

/**
 * @fileoverview added by tsickle
 * Generated from: lib/entity/tracking/StringDisplayMode.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/** @enum {string} */
const StringDisplayMode = {
    SIMPLEVALUEMAPPING: "SIMPLEVALUEMAPPING",
};

/**
 * @fileoverview added by tsickle
 * Generated from: lib/entity/tracking/StringTypeFormatInfo.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
class StringTypeFormatInfo extends JsonConvertableImpl {
    constructor() {
        super(...arguments);
        this.stringDisplayMode = StringDisplayMode.SIMPLEVALUEMAPPING;
        this.simpleValueMappingInfos = [];
    }
    /**
     * @protected
     * @return {?}
     */
    ResetBeforeLoadFrom() {
        super.ResetBeforeLoadFrom();
        this.stringDisplayMode = StringDisplayMode.SIMPLEVALUEMAPPING;
        this.simpleValueMappingInfos = [];
    }
    /**
     * @return {?}
     */
    ConvertToJsonObject() {
        /** @type {?} */
        let obj = super.ConvertToJsonObject();
        BpmnModelJsonHelper.SetAttributeValue(obj, "stringDisplayMode", this.stringDisplayMode);
        BpmnModelJsonHelper.SetAttributeValue(obj, "simpleValueMappingInfos", this.simpleValueMappingInfos);
        return obj;
    }
    /**
     * @param {?} obj
     * @return {?}
     */
    LoadFromJsonObject(obj) {
        super.LoadFromJsonObject(obj);
        this.stringDisplayMode = StringDisplayMode[BpmnModelJsonHelper.GetAttributeValueAsString(obj, "stringDisplayMode")];
        this.simpleValueMappingInfos = BpmnModelJsonHelper.GetAttributeValueAsList(obj, "simpleValueMappingInfos", SimpleValueMappingInfo);
    }
}

/**
 * @fileoverview added by tsickle
 * Generated from: lib/entity/tracking/Exceptions.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
class Exceptions {
}
Exceptions.SCALE_FIELD_VALUE_IS_NAN = "scale field value is NaN";

/**
 * @fileoverview added by tsickle
 * Generated from: lib/entity/tracking/index.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */

/**
 * @fileoverview added by tsickle
 * Generated from: lib/entity/index.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */

/**
 * @fileoverview added by tsickle
 * Generated from: lib/bif-manual-creation/base/index.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */

/**
 * @fileoverview added by tsickle
 * Generated from: lib/bif-manual-creation/config/bif-form-constants.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/** @type {?} */
const BIF_UISTATE_KEY_OPEN_TYPE = "abdbaec8-0bbe-4894-acee-b8d493bc4e1c";
/** @type {?} */
const BIF_UISTATE_KEY_CREATION_RESULT = "5eb32009-1d86-43df-96c8-8d685aea4e66";

/**
 * @fileoverview added by tsickle
 * Generated from: lib/bif-manual-creation/config/module.config.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
class ModuleConfig {
}

/**
 * @fileoverview added by tsickle
 * Generated from: lib/bif-manual-creation/config/selector-args-injector.config.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/** @type {?} */
const SELECTOR_ARGS_INJECTOR = new InjectionToken("SELECTOR_ARGS_INJECTOR");
/** @type {?} */
const DEFAULT_SELECTOR_ARGS = {
    upBillVoId: null,
    downBillVoId: null,
    manaualCreationMode: null
};

/**
 * @fileoverview added by tsickle
 * Generated from: lib/bif-manual-creation/config/index.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */

/**
 * @fileoverview added by tsickle
 * Generated from: lib/bif-manual-creation/args/PushTaskArgs.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
class PushTaskArgs extends JsonConvertableImpl {
    /**
     * @protected
     * @return {?}
     */
    ResetBeforeLoadFrom() {
        super.ResetBeforeLoadFrom();
        this.suCode = null;
        this.creationRuleExecutorResult = null;
    }
    /**
     * @return {?}
     */
    ConvertToJsonObject() {
        /** @type {?} */
        let obj = super.ConvertToJsonObject();
        BpmnModelJsonHelper.SetAttributeValue(obj, "suCode", this.suCode);
        BpmnModelJsonHelper.SetAttributeValue(obj, "creationRuleExecutorResult", this.creationRuleExecutorResult);
        return obj;
    }
    /**
     * @param {?} obj
     * @return {?}
     */
    LoadFromJsonObject(obj) {
        super.LoadFromJsonObject(obj);
        this.suCode = BpmnModelJsonHelper.GetAttributeValueAsString(obj, "suCode");
        this.creationRuleExecutorResult = BpmnModelJsonHelper.GetAttributeValueAsJsonSerializable(obj, "creationRuleExecutorResult", RpcCreationRuleExecutorResult);
    }
}

/**
 * @fileoverview added by tsickle
 * Generated from: lib/bif-manual-creation/args/GetEntityDatasArgs.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
class GetEntityDatasArgs extends JsonConvertableImpl {
    /**
     * @protected
     * @return {?}
     */
    ResetBeforeLoadFrom() {
        super.ResetBeforeLoadFrom();
        this.voId = null;
        this.dataId = null;
        this.suCode = null;
    }
    /**
     * @return {?}
     */
    ConvertToJsonObject() {
        /** @type {?} */
        let obj = super.ConvertToJsonObject();
        BpmnModelJsonHelper.SetAttributeValue(obj, "schemaId", this.voId);
        BpmnModelJsonHelper.SetAttributeValue(obj, "dataId", this.dataId);
        BpmnModelJsonHelper.SetAttributeValue(obj, "suCode", this.suCode);
        return obj;
    }
    /**
     * @param {?} obj
     * @return {?}
     */
    LoadFromJsonObject(obj) {
        super.LoadFromJsonObject(obj);
        this.voId = BpmnModelJsonHelper.GetAttributeValueAsString(obj, "schemaId");
        this.dataId = BpmnModelJsonHelper.GetAttributeValueAsString(obj, "dataId");
        this.suCode = BpmnModelJsonHelper.GetAttributeValueAsString(obj, "suCode");
    }
}

/**
 * @fileoverview added by tsickle
 * Generated from: lib/bif-manual-creation/args/index.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */

/**
 * @fileoverview added by tsickle
 * Generated from: lib/bif-manual-creation/index.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */

/**
 * @fileoverview added by tsickle
 * Generated from: lib/bif-manual-creation/i18n/lang.resource.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/** @type {?} */
const LANG_RESOURCES = {
    "zh-CHS": {
        "confirm": "确定",
        "cancel": "取消",
        "emptyResult": "查询结果为空",
        "upstreamBill": "上游单据",
        "downstreamBill": "下游单据",
        "selectUpstreamBill": "请选择上游单据",
        "selectDownstreamBill": "请选择下游单据",
        "selectCreationProcess": "请选择生单流程",
        "processDesciption": "流程描述",
        "creationProcessSelector": "生单流程",
        "upstreamBillSelector": "上游单据",
        "creationExecutionError": "生单流程执行错误",
        "creationResultEmpty": "生单结果为空",
        "pushTaskCenterSuccess": "推送至任务中心",
        "pushTaskCenterFailed": "推送任务中心失败",
        "entitiesCantBeEmpty": "参数【参与生单的上游单据ID列表或实体列表】不可为空",
        "creationResultCantBeEmpty": "参数【生单结果】不可为空",
        "dataIdCantBeEmpty": "参数【单据Id】不可为空",
        "voIdCantBeEmpty": "参数【VO Id】不可为空",
        "suCodeCantBeEmpty": "参数【SU编号】不可为空",
        "processIdCantBeEmpty": "参数【生单流程Id】不可为空",
        "sourceVoIdCantBeEmpty": "参数【上游单据视图对象Id】不可为空",
        "targetVoIdCantBeEmpty": "参数【下游单据视图对象Id】不可为空",
        "processCode": "流程编号",
        "processName": "流程名称",
        "all": "全部",
        "noDefaultUpBillSelector": "请确认生单流程中【集成场景】启用了【人工拉式生单】场景，并且【单据配置】-【拉式生单配置】-【上游应用入口】或【URL】不为空",
        "pleaseSelectOneCreationProcess": "请选择一条生单流程",
    },
    "en": {
        "confirm": "confirm",
        "cancel": "cancel",
        "emptyResult": "The result is empty",
        "upstreamBill": "Upstream bill",
        "downstreamBill": "Downstream bill",
        "selectUpstreamBill": "Select upstream bill",
        "selectDownstreamBill": "Select downstream bill",
        "selectCreationProcess": "Select creation process",
        "processDesciption": "Desciption",
        "creationProcessSelector": "Creation Process",
        "upstreamBillSelector": "Upstream Bill Selector",
        "creationExecutionError": "Creation Process Execution Error",
        "creationResultEmpty": "Creation result is empty",
        "pushTaskCenterSuccess": "Success to push data to task center",
        "pushTaskCenterFailed": "Failed to push data to task center",
        "entitiesCantBeEmpty": "The parameter \"entities\" can't be empty",
        "dataIdCantBeEmpty": "The parameter \"dataId\" can't be empty",
        "voIdCantBeEmpty": "The parameter \"voId\" can't be empty",
        "suCodeCantBeEmpty": "The parameter \"suCode\" can't be empty",
        "processIdCantBeEmpty": "The parameter \"processId\" can't be empty",
        "sourceVoIdCantBeEmpty": "The parameter \"sourceVoId\" can't be empty",
        "targetVoIdCantBeEmpty": "The parameter \"targetVoId\" can't be empty",
        "processCode": "Process Code",
        "processName": "Process Name",
        "all": "All",
        "noDefaultUpBillSelector": "Please ensure that the creation process configed [Manual Pull] in [integration scene], and configed [Up App Entrance] correctly.",
        "pleaseSelectOneCreationProcess": "Please select on creation process",
    },
    "zh-CHT": {
        "confirm": "確定",
        "cancel": "取消",
        "emptyResult": "查詢結果為空",
        "upstreamBill": "上遊單據",
        "downstreamBill": "下遊單據",
        "selectUpstreamBill": "請選擇上遊單據",
        "selectDownstreamBill": "請選擇下遊單據",
        "selectCreationProcess": "請選擇生單流程",
        "processDesciption": "流程描述",
        "creationProcessSelector": "生單流程",
        "upstreamBillSelector": "上遊單據選擇",
        "creationExecutionError": "生單規則執行錯誤",
        "creationResultEmpty": "生單結果為空",
        "pushTaskCenterSuccess": "推送至任務中心",
        "pushTaskCenterFailed": "推送任務中心失敗",
        "entitiesCantBeEmpty": "參與生單的上遊單據ID列表或實體列表不可爲空",
        "dataIdCantBeEmpty": "參數【單據Id】不可爲空",
        "voIdCantBeEmpty": "參數【VO Id】不可爲空",
        "suCodeCantBeEmpty": "參數【SU編號】不可爲空",
        "processIdCantBeEmpty": "參數【生單流程Id】不可爲空",
        "sourceVoIdCantBeEmpty": "參數【上遊單據視圖對象Id】不可爲空",
        "targetVoIdCantBeEmpty": "參數【下遊單據視圖對象Id】不可爲空",
        "processCode": "流程編號",
        "processName": "流程名稱",
        "all": "全部",
        "noDefaultUpBillSelector": "請確認生單流程中【集成場景】啓用了【人工拉式生單】場景，並且【單據配置】-【拉式生單配置】-【上遊應用入口】或【URL】不爲空",
        "pleaseSelectOneCreationProcess": "請選擇壹條生單流程",
    }
};

/**
 * @fileoverview added by tsickle
 * Generated from: lib/bif-manual-creation/pipe/locale.pipe.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
class LocalePipe {
    /**
     * @param {?} localeId
     */
    constructor(localeId) {
        this.langCode = localeId || "zh-CHS";
        this.lang = LANG_RESOURCES[this.langCode];
    }
    /**
     * @param {?} name
     * @return {?}
     */
    transform(name) {
        return this.lang[name] || name;
    }
    /**
     * @param {?} name
     * @return {?}
     */
    instant(name) {
        return this.transform(name);
    }
}
LocalePipe.decorators = [
    { type: Pipe, args: [{ name: 'locale' },] }
];
/** @nocollapse */
LocalePipe.ctorParameters = () => [
    { type: String, decorators: [{ type: Inject, args: [LOCALE_ID,] }] }
];

/**
 * @fileoverview added by tsickle
 * Generated from: lib/bif-manual-creation/service/bif-data.service.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
class BifDataService {
    /**
     * @param {?} httpClient
     * @param {?} repository
     * @param {?} injector
     * @param {?} cfr
     * @param {?} loader
     * @param {?} modal
     * @param {?} messager
     * @param {?} frameContext
     * @param {?} localeId
     * @param {?} runtimeFrameworkService
     * @param {?} localePipe
     * @param {?} httpService
     */
    constructor(httpClient, repository, injector, cfr, loader, modal, messager, frameContext, localeId, runtimeFrameworkService, localePipe, httpService) {
        this.httpClient = httpClient;
        this.injector = injector;
        this.cfr = cfr;
        this.loader = loader;
        this.modal = modal;
        this.messager = messager;
        this.frameContext = frameContext;
        this.localeId = localeId;
        this.runtimeFrameworkService = runtimeFrameworkService;
        this.localePipe = localePipe;
        this.httpService = httpService;
        this.getBillCreationProcessEntityExByIdUrl = "/api/runtime/aif/v1.0/manualcreationbill/getbillcreationprocessentityex";
        this.getBillCreationProcessEntityExByIdMethod = "GET";
        this.getBillCreationProcessEntityExUrl = "/api/runtime/aif/v1.0/manualcreationbill/getbillcreationprocessentityexes";
        this.getBillCreationProcessEntityExMethod = "POST";
        this.executeBillCreationProcessUrl = "/api/runtime/aif/v1.0/manualcreationbill/executebillcreationprocess";
        this.executeBillCreationProcessMethod = "POST";
        this.formCreateUrl = "/api/runtime/aif/v1.0/form/create";
        this.formCreateMethod = "POST";
        this.formUpdateUrl = "/api/runtime/aif/v1.0/form/update";
        this.formUpdateMethod = "POST";
        this.generalTextUrl = "/api/runtime/aif/v1.0/generaltext";
        this.generalTextMethod = "GET";
        this.generalTextCreationMethod = "POST";
        this.pushTaskUrl = "/api/runtime/aif/v1.0/manualcreationbill/pushtask";
        this.pushTaskMethod = "POST";
        this.getEntityDatasUrl = "/api/runtime/aif/v1.0/manualcreationbill/getentitydatas";
        this.getEntityDatasMethod = "POST";
        this.repository = (/** @type {?} */ (repository));
        this.injector = this.injector != null ? this.injector : this.repository.appContext.injector;
        this.cfr = this.cfr != null ? this.cfr : this.injector.get(ComponentFactoryResolver, null);
        this.loader = this.loader != null ? this.loader : this.injector.get(NgModuleFactoryLoader, null);
        this.modal = this.modal != null ? this.modal : this.injector.get(BsModalService, null);
        this.messager = this.messager != null ? this.messager : this.injector.get(MessagerService, null);
        this.frameContext = this.frameContext != null ? this.frameContext : this.injector.get(FrameContext, null);
        this.localeId = this.localeId != null ? this.localeId : this.injector.get(LOCALE_ID, localStorage.getItem('languageCode') || 'zh-CHS');
        this.runtimeFrameworkService = this.runtimeFrameworkService != null ? this.runtimeFrameworkService : this.injector.get(RuntimeFrameworkService, null);
        this.localePipe = this.localePipe != null ? this.localePipe : this.injector.get(LocalePipe, new LocalePipe(this.localeId));
        this.httpService = this.httpService != null ? this.httpService : this.injector.get(HttpService, null);
    }
    /**
     * 根据上游 VO Id获取单据流生单流程实体列表。
     *
     * @param {?} upBillVoId 上游 VO Id。
     * @return {?} 符合条件的单据流生单流程实体列表。
     */
    getSlimBillCreationProcessEntityExesByUpBillVoId4Push(upBillVoId) {
        /** @type {?} */
        const args = new FormGetBillCreationProcessEntityExArgs();
        args.upBillVoId = upBillVoId;
        args.manualCreationMode = ManualCreationMode.Push;
        return this.getSlimBillCreationProcessEntityExes(args).pipe(map((/**
         * @param {?} res
         * @return {?}
         */
        (res) => {
            return res.billCreationProcessEntityExes;
        })));
    }
    /**
     * 根据下游 VO Id获取单据流生单流程实体列表。
     *
     * @param {?} downBillVoId 下游 VO Id。
     * @return {?} 符合条件的单据流生单流程实体列表。
     */
    getSlimBillCreationProcessEntityExesByDownBillVoId4Pull(downBillVoId) {
        /** @type {?} */
        const args = new FormGetBillCreationProcessEntityExArgs();
        args.downBillVoId = downBillVoId;
        args.manualCreationMode = ManualCreationMode.Pull;
        return this.getSlimBillCreationProcessEntityExes(args).pipe(map((/**
         * @param {?} res
         * @return {?}
         */
        (res) => {
            return res.billCreationProcessEntityExes;
        })), catchError((/**
         * @param {?} err
         * @return {?}
         */
        (err) => {
            try {
                if (typeof err.error == "string") {
                    err.error = JSON.parse(err.error);
                }
            }
            catch (e) {
            }
            throw err;
        })));
    }
    /**
     * 根据上游 VO Id和下游 VO Id获取单据流生单流程实体列表。
     *
     * @param {?} upBillVoId 上游 VO Id。
     * @param {?} downBillVoId 下游 VO Id。
     * @return {?} 符合条件的单据流生单流程实体列表。
     */
    getSlimBillCreationProcessEntityExesByUpBillVoIdAndDownBillVoId4SpecificPush(upBillVoId, downBillVoId) {
        /** @type {?} */
        const args = new FormGetBillCreationProcessEntityExArgs();
        args.upBillVoId = upBillVoId;
        args.downBillVoId = downBillVoId;
        args.manualCreationMode = ManualCreationMode.SpecificPush;
        return this.getSlimBillCreationProcessEntityExes(args).pipe(map((/**
         * @param {?} res
         * @return {?}
         */
        (res) => {
            return res.billCreationProcessEntityExes;
        })), catchError((/**
         * @param {?} err
         * @return {?}
         */
        (err) => {
            try {
                if (typeof err.error == "string") {
                    err.error = JSON.parse(err.error);
                }
            }
            catch (e) {
            }
            throw err;
        })));
    }
    /**
     * 根据上游 VO Id和下游 VO Id获取单据流生单流程实体列表。
     *
     * @param {?} upBillVoId 上游 VO Id。
     * @param {?} downBillVoId 下游 VO Id。
     * @return {?} 符合条件的单据流生单流程实体列表。
     */
    getSlimBillCreationProcessEntityExesByUpBillVoIdAndDownBillVoId4SpecificPull(upBillVoId, downBillVoId) {
        /** @type {?} */
        const args = new FormGetBillCreationProcessEntityExArgs();
        args.upBillVoId = upBillVoId;
        args.downBillVoId = downBillVoId;
        args.manualCreationMode = ManualCreationMode.SpecificPull;
        return this.getSlimBillCreationProcessEntityExes(args).pipe(map((/**
         * @param {?} res
         * @return {?}
         */
        (res) => {
            return res.billCreationProcessEntityExes;
        })), catchError((/**
         * @param {?} err
         * @return {?}
         */
        (err) => {
            try {
                if (typeof err.error == "string") {
                    err.error = JSON.parse(err.error);
                }
            }
            catch (e) {
            }
            throw err;
        })));
    }
    /**
     * 获取单据流生单流程实体
     * @param {?} processId
     * @return {?}
     */
    getSlimBillCreationProcessEntityExById(processId) {
        /** @type {?} */
        let getCreationRuleById$ = null;
        if (this.httpService != null) {
            getCreationRuleById$ = (/** @type {?} */ (this.httpService.request(this.getBillCreationProcessEntityExByIdMethod, `${this.getBillCreationProcessEntityExByIdUrl}/${processId}`, {})));
        }
        else {
            getCreationRuleById$ = this.repository.proxy.request(`${this.getBillCreationProcessEntityExByIdUrl}/${processId}`, this.getBillCreationProcessEntityExByIdMethod, null);
        }
        return getCreationRuleById$;
    }
    /**
     * 获取表单配置实体
     * @param {?} formSettingsId
     * @return {?}
     */
    getFormSettingsById(formSettingsId) {
        if (formSettingsId == null || formSettingsId.trim() == "") {
            throw "FormSettingsId为空";
        }
        /** @type {?} */
        let formSettings$ = null;
        if (this.httpService != null) {
            formSettings$ = (/** @type {?} */ (this.httpService.request(this.generalTextMethod, `${this.generalTextUrl}/${formSettingsId}`, { responseType: "text" })));
        }
        else {
            formSettings$ = this.repository.proxy.request(`${this.generalTextUrl}/${formSettingsId}`, this.generalTextMethod, null, { responseType: "text" });
        }
        return formSettings$.pipe(map((/**
         * @param {?} data
         * @return {?}
         */
        (data) => {
            /** @type {?} */
            const generateText = new GeneralTextEntity();
            generateText.LoadFromJson(data);
            /** @type {?} */
            const formSettings = new FormSettings();
            formSettings.LoadFromJson(generateText.text);
            return formSettings;
        })), catchError((/**
         * @param {?} err
         * @return {?}
         */
        (err) => {
            try {
                if (typeof err.error == "string") {
                    err.error = JSON.parse(err.error);
                }
            }
            catch (e) {
            }
            throw err;
        })));
    }
    /**
     * 获取生单结果实体
     * @param {?} creationResultId
     * @return {?}
     */
    getCreationResultById(creationResultId) {
        if (creationResultId == null || creationResultId.trim() == "") {
            throw "creationResultId为空";
        }
        /** @type {?} */
        let creationResult$ = null;
        if (this.httpService != null) {
            creationResult$ = (/** @type {?} */ (this.httpService.request(this.generalTextMethod, `${this.generalTextUrl}/${creationResultId}`, { responseType: "text" })));
        }
        else {
            creationResult$ = this.repository.proxy.request(`${this.generalTextUrl}/${creationResultId}`, this.generalTextMethod, null, { responseType: "text" });
        }
        return creationResult$.pipe(map((/**
         * @param {?} data
         * @return {?}
         */
        (data) => {
            /** @type {?} */
            const generateText = new GeneralTextEntity();
            generateText.LoadFromJson(data);
            /** @type {?} */
            const creationResult = new FormBillCreationProcessExecutorResult();
            creationResult.LoadFromJson(generateText.text);
            return creationResult;
        })), catchError((/**
         * @param {?} err
         * @return {?}
         */
        (err) => {
            try {
                if (typeof err.error == "string") {
                    err.error = JSON.parse(err.error);
                }
            }
            catch (e) {
            }
            throw err;
        })));
    }
    /**
     * 生单结果存入中间表
     * @param {?} creationResult
     * @return {?}
     */
    addFormBillCreationProcessExecutorResult(creationResult) {
        if (creationResult == null) {
            throw "参数creationResult不可为空";
        }
        if (typeof creationResult == "string") {
            if (creationResult == "") {
                throw "参数creationResult不可为空";
            }
            /** @type {?} */
            const temp = new FormBillCreationProcessExecutorResult();
            temp.LoadFromJson(creationResult);
            creationResult = temp;
        }
        if ((creationResult instanceof FormBillCreationProcessExecutorResult) == false) {
            /** @type {?} */
            const res = new FormBillCreationProcessExecutorResult();
            res.LoadFromJsonObject(creationResult);
            creationResult = res;
        }
        if (creationResult.conditionResult.conditionExecutionResult == false) {
            this.messager.error(creationResult.conditionResult.message || this.localePipe.transform("creationExecutionError"));
            return;
        }
        if (creationResult.creationRuleExecutorResult == null || creationResult.creationRuleExecutorResult.mappingResults == null || creationResult.creationRuleExecutorResult.mappingResults.length == 0) {
            this.messager.error(this.localePipe.transform("creationResultEmpty"));
            return;
        }
        /** @type {?} */
        const body = creationResult.ConvertToJson();
        /** @type {?} */
        const options = {
            body: body,
            responseType: "text"
        };
        /** @type {?} */
        let creationResult$ = null;
        if (this.httpService != null) {
            creationResult$ = (/** @type {?} */ (this.httpService.request(this.generalTextCreationMethod, `${this.generalTextUrl}`, options)));
        }
        else {
            creationResult$ = this.repository.proxy.request(`${this.generalTextUrl}`, this.generalTextCreationMethod, null, options);
        }
        return creationResult$.pipe(map((/**
         * @param {?} data
         * @return {?}
         */
        (data) => {
            /** @type {?} */
            const texts = (/** @type {?} */ (BpmnModelJsonHelper$1.FromJson(data, GeneralTextIdWithDataId)));
            return texts;
        })), catchError((/**
         * @param {?} err
         * @return {?}
         */
        (err) => {
            try {
                if (typeof err.error == "string") {
                    err.error = JSON.parse(err.error);
                }
            }
            catch (e) {
            }
            throw err;
        })));
    }
    /**
     * 执行单据流生单流程
     * @param {?} args
     * @return {?}
     */
    executeBillCreationProcess(args) {
        if (args.manualCreationMode == null) {
            throw "manualCreationMode不可为空";
        }
        /** @type {?} */
        const body = args.ConvertToJson();
        /** @type {?} */
        const options = {
            body: body,
            responseType: "text"
        };
        /** @type {?} */
        let executeCreationRule$ = null;
        if (this.httpService != null) {
            executeCreationRule$ = this.httpService.request(this.executeBillCreationProcessMethod, this.executeBillCreationProcessUrl, options);
        }
        else {
            executeCreationRule$ = this.repository.proxy.request(this.executeBillCreationProcessUrl, this.executeBillCreationProcessMethod, null, options);
        }
        return executeCreationRule$.pipe(map((/**
         * @param {?} data
         * @return {?}
         */
        (data) => {
            /** @type {?} */
            const res = new FormBillCreationProcessExecutorResult();
            res.LoadFromJson(data);
            return res;
        })), catchError((/**
         * @param {?} err
         * @return {?}
         */
        (err) => {
            try {
                if (typeof err.error == "string") {
                    err.error = JSON.parse(err.error);
                }
            }
            catch (e) {
            }
            throw err;
        })));
    }
    /**
     * 创建单据
     * @param {?} args
     * @return {?}
     */
    createEntityDatas(args) {
        /** @type {?} */
        const body = args.ConvertToJson();
        /** @type {?} */
        const options = {
            body: body,
            responseType: 'text'
        };
        /** @type {?} */
        const create$ = this.repository.proxy.request(this.formCreateUrl, this.formCreateMethod, null, options);
        return create$.pipe(switchMap((/**
         * @param {?} res
         * @return {?}
         */
        (res) => {
            /** @type {?} */
            const result = new FormCreateResult();
            result.LoadFromJson(res);
            /** @type {?} */
            const entities = result.entityDataList.map((/**
             * @param {?} entityStr
             * @return {?}
             */
            (entityStr) => {
                /** @type {?} */
                const newEntity = this.repository.buildEntity(JSON.parse(entityStr));
                this.appendInitialData(newEntity, newEntity);
                return newEntity;
            }));
            /** @type {?} */
            let origin = this.repository.entityCollection.getAllEntities();
            if (origin == null || origin.length == 0) {
                this.repository.entityCollection.loadEntities(entities);
            }
            else {
                this.repository.entityCollection.addEntities(entities);
            }
            return of(result);
        })), catchError((/**
         * @param {?} err
         * @return {?}
         */
        (err) => {
            try {
                if (typeof err.error == "string") {
                    err.error = JSON.parse(err.error);
                }
            }
            catch (e) {
            }
            throw err;
        })));
    }
    /**
     * 修改单据
     * @param {?} args 表单更新参数
     * @return {?}
     */
    updateEntityDatas(args) {
        /** @type {?} */
        const body = args.ConvertToJson();
        /** @type {?} */
        const options = {
            body: body,
            responseType: "text"
        };
        /** @type {?} */
        const update$ = this.repository.proxy.request(this.formUpdateUrl, this.formUpdateMethod, null, options);
        return update$.pipe(map((/**
         * @param {?} data
         * @return {?}
         */
        (data) => {
            /** @type {?} */
            const res = new FormUpdateResult();
            res.LoadFromJson(data);
            return res;
        })), catchError((/**
         * @param {?} err
         * @return {?}
         */
        (err) => {
            try {
                if (typeof err.error == "string") {
                    err.error = JSON.parse(err.error);
                }
            }
            catch (e) {
            }
            throw err;
        })));
    }
    /**
     * 将生单结果推送至任务中心
     * @param {?} args 推送任务中心参数
     * @return {?}
     */
    pushTaskCenter(args) {
        /** @type {?} */
        const body = args.ConvertToJson();
        /** @type {?} */
        const options = {
            body: body,
            responseType: "text"
        };
        /** @type {?} */
        let update$ = null;
        if (this.httpService != null) {
            update$ = this.httpService.request(this.pushTaskMethod, this.pushTaskUrl, options);
        }
        else {
            update$ = this.repository.proxy.request(this.pushTaskUrl, this.pushTaskMethod, null, options);
        }
        return update$.pipe(catchError((/**
         * @param {?} err
         * @return {?}
         */
        (err) => {
            try {
                if (typeof err.error == "string") {
                    err.error = JSON.parse(err.error);
                }
            }
            catch (e) {
            }
            throw err;
        })));
    }
    /**
     * 获取VO序列化数据
     * @param {?} args
     * @return {?}
     */
    getEntityDatas(args) {
        /** @type {?} */
        const body = args.ConvertToJson();
        /** @type {?} */
        const options = {
            body: body,
            responseType: "text"
        };
        /** @type {?} */
        let datas$ = null;
        if (this.httpService != null) {
            datas$ = this.httpService.request(this.getEntityDatasMethod, this.getEntityDatasUrl, options);
        }
        else {
            datas$ = this.repository.proxy.request(this.getEntityDatasUrl, this.getEntityDatasMethod, null, options);
        }
        return datas$.pipe(catchError((/**
         * @param {?} err
         * @return {?}
         */
        (err) => {
            try {
                if (typeof err.error == "string") {
                    err.error = JSON.parse(err.error);
                }
            }
            catch (e) {
            }
            throw err;
        })));
    }
    /**
     * 查询单据生单流程扩展实体
     * @private
     * @param {?} args 查询参数
     * @return {?}
     */
    getSlimBillCreationProcessEntityExes(args) {
        if (args == null) {
            throw "args不可为空";
        }
        if (typeof args == "string") {
            if (args == "") {
                throw "args不可为空";
            }
            /** @type {?} */
            const temp = new FormGetBillCreationProcessEntityExArgs();
            temp.LoadFromJson(args);
            args = temp;
        }
        /** @type {?} */
        const options = { body: args.ConvertToJson(), responseType: "text" };
        /** @type {?} */
        let getEntity$ = null;
        if (this.httpService != null) {
            getEntity$ = this.httpService.request(this.getBillCreationProcessEntityExMethod, this.getBillCreationProcessEntityExUrl, options);
        }
        else {
            getEntity$ = this.repository.proxy.request(this.getBillCreationProcessEntityExUrl, this.getBillCreationProcessEntityExMethod, null, options);
        }
        return getEntity$.pipe(map((/**
         * @param {?} data
         * @return {?}
         */
        (data) => {
            /** @type {?} */
            const result = new FormGetBillCreationProcessEntityExResult();
            result.LoadFromJson(data);
            return result;
        })), catchError((/**
         * @param {?} err
         * @return {?}
         */
        (err) => {
            try {
                if (typeof err.error == "string") {
                    err.error = JSON.parse(err.error);
                }
            }
            catch (e) {
            }
            throw err;
        })));
    }
    /**
     * 参考farris/bef EntityUtil实现
     * @private
     * @param {?} entity
     * @param {?} initialData
     * @return {?}
     */
    appendInitialData(entity, initialData) {
        /** @type {?} */
        const data = Object.assign({}, initialData);
        delete data.id;
        delete data.parentID;
        entity['initialData'] = data;
    }
}
BifDataService.decorators = [
    { type: Injectable }
];
/** @nocollapse */
BifDataService.ctorParameters = () => [
    { type: HttpClient },
    { type: Repository },
    { type: Injector, decorators: [{ type: Optional }] },
    { type: ComponentFactoryResolver, decorators: [{ type: Optional }] },
    { type: NgModuleFactoryLoader, decorators: [{ type: Optional }] },
    { type: BsModalService, decorators: [{ type: Optional }] },
    { type: MessagerService, decorators: [{ type: Optional }] },
    { type: FrameContext, decorators: [{ type: Optional }] },
    { type: String, decorators: [{ type: Optional }, { type: Inject, args: [LOCALE_ID,] }] },
    { type: RuntimeFrameworkService, decorators: [{ type: Optional }] },
    { type: LocalePipe, decorators: [{ type: Optional }] },
    { type: HttpService, decorators: [{ type: Optional }] }
];

/**
 * @fileoverview added by tsickle
 * Generated from: lib/bif-manual-creation/service/bif-data-selector.service.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
class AbstractBifDataSelectorService {
    constructor() {
        /**
         * 实体数据Subject
         */
        this.subject4EntityDatas = new Subject();
    }
}
AbstractBifDataSelectorService.decorators = [
    { type: Injectable }
];
class DefaultBifDataSelectorService extends AbstractBifDataSelectorService {
    /**
     * @param {?} frameContext
     * @param {?} viewModel
     * @param {?} cfr
     * @param {?} injector
     */
    constructor(frameContext, viewModel, cfr, injector) {
        super();
        this.frameContext = frameContext;
        this.viewModel = viewModel;
        this.cfr = cfr;
        this.injector = injector;
        /**
         * 实体数据Subject
         */
        this.subject4EntityDatas = new Subject();
        /**
         * 点击弹窗“确定”按钮操作
         */
        this.clickOk4BifSelector = (/**
         * @return {?}
         */
        () => {
            //发送选中的来源单据实体列表并关闭模态框
            this.viewModel.frameContext.repository.getById(this.viewModel.bindingData.getObject().id).subscribe((/**
             * @param {?} e
             * @return {?}
             */
            (e) => {
                this.subject4EntityDatas.next([e]);
                this.subject4EntityDatas.complete();
                this.bsModalRef4BifSelector.close();
            }));
        });
        /**
         * 点击弹窗“取消”按钮操作
         */
        this.clickClose4BifSelector = (/**
         * @return {?}
         */
        () => {
            this.subject4EntityDatas.complete();
            this.bsModalRef4BifSelector.close();
        });
    }
}
DefaultBifDataSelectorService.decorators = [
    { type: Injectable }
];
/** @nocollapse */
DefaultBifDataSelectorService.ctorParameters = () => [
    { type: FrameContext },
    { type: ViewModel },
    { type: ComponentFactoryResolver },
    { type: Injector }
];

/**
 * @fileoverview added by tsickle
 * Generated from: lib/bif-manual-creation/service/abstract-ui-service.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/**
 * @abstract
 */
class AbstractUiService {
    /**
     * @param {?} frameContext
     * @param {?} modalService
     * @param {?} messager
     * @param {?} injector
     * @param {?} cfr
     * @param {?} loader
     * @param {?} localeId
     * @param {?} runtimeFrameworkService
     */
    constructor(frameContext, modalService, messager, injector, cfr, loader, localeId, runtimeFrameworkService) {
        this.frameContext = frameContext;
        this.modalService = modalService;
        this.messager = messager;
        this.injector = injector;
        this.cfr = cfr;
        this.loader = loader;
        this.localeId = localeId;
        /**
         * 内置模态框配置
         */
        this.defaultModalOptions = {
            title: null,
            width: 900,
            height: 500,
            buttons: null,
            showButtons: null,
        };
        this.runtimeFrameworkService = runtimeFrameworkService || injector.get(RuntimeFrameworkService);
        this.localePipe = new LocalePipe(localeId);
    }
    /**
     * @protected
     * @param {?} args
     * @param {?} type
     * @param {?=} modalOptions
     * @param {?=} customSelectorModuleUrl
     * @param {?=} extParams
     * @return {?}
     */
    openBillCreationProcessSelector(args, type, modalOptions, customSelectorModuleUrl, extParams) {
        if (typeof modalOptions == "string") {
            if (modalOptions == "") {
                throw "modalOptions不可为空";
            }
            modalOptions = JSON.parse(modalOptions);
        }
        modalOptions = modalOptions == null ? this.defaultModalOptions : modalOptions;
        modalOptions.title = modalOptions.title == null ? this.localePipe.transform("creationProcessSelector") : modalOptions.title;
        /** @type {?} */
        let cmpR = null;
        if (customSelectorModuleUrl == null || customSelectorModuleUrl.trim() == "") {
            /** @type {?} */
            let cmpF = this.cfr.resolveComponentFactory(type);
            /** @type {?} */
            let inj = ReflectiveInjector.resolveAndCreate([
                { provide: SELECTOR_ARGS_INJECTOR, useValue: args.ConvertToJsonObject() },
                LoadingService,
            ], this.injector);
            cmpR = cmpF.create(inj);
            this.configModalButtons(modalOptions, cmpR);
            cmpR.instance.bsModalRef4BifSelector = this.modalService.show(cmpR, modalOptions);
            return cmpR.instance.subject4CreationProcess.asObservable();
        }
        else {
            return from(this.loader.load(customSelectorModuleUrl)).pipe(switchMap((/**
             * @param {?} moduleFactory
             * @return {?}
             */
            (moduleFactory) => {
                /** @type {?} */
                const moduleRef = moduleFactory.create(this.frameContext.root.injector);
                /** @type {?} */
                const cmpR$ = moduleRef.instance.createCreationProcessSelector(this.frameContext.root.injector, extParams);
                if (cmpR$ instanceof Observable) {
                    return cmpR$.pipe(switchMap((/**
                     * @param {?} componentRef
                     * @return {?}
                     */
                    (componentRef) => {
                        cmpR = componentRef;
                        this.configModalButtons(modalOptions, cmpR);
                        cmpR.instance.bsModalRef4BifSelector = this.modalService.show(cmpR, modalOptions);
                        return cmpR.instance.subject4CreationProcess.asObservable();
                    })));
                }
                else if (cmpR$ instanceof ComponentRef) {
                    cmpR = cmpR$;
                    this.configModalButtons(modalOptions, cmpR);
                    cmpR.instance.bsModalRef4BifSelector = this.modalService.show(cmpR, modalOptions);
                    return cmpR.instance.subject4CreationProcess.asObservable();
                }
            })));
        }
    }
    /**
     * 配置模态框按钮事件
     * @protected
     * @param {?} modalOptions
     * @param {?} cmpR
     * @return {?}
     */
    configModalButtons(modalOptions, cmpR) {
        modalOptions.buttons = [
            {
                text: this.localePipe.transform("confirm"),
                cls: "btn btn-primary",
                handle: cmpR.instance.clickOk4BifSelector,
            },
            {
                text: this.localePipe.transform("cancel"),
                cls: "btn btn-secondary",
                handle: cmpR.instance.clickClose4BifSelector,
            }
        ];
        modalOptions.showButtons = true;
    }
}
/** @nocollapse */
AbstractUiService.ctorParameters = () => [
    { type: FrameContext },
    { type: BsModalService },
    { type: MessagerService },
    { type: Injector },
    { type: ComponentFactoryResolver },
    { type: NgModuleFactoryLoader },
    { type: String, decorators: [{ type: Inject, args: [LOCALE_ID,] }] },
    { type: RuntimeFrameworkService, decorators: [{ type: Optional }] }
];

/**
 * @fileoverview added by tsickle
 * Generated from: lib/bif-manual-creation/components/push-selector/push-selector.component.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
class PushSelectorComponent {
    /**
     * @param {?} args
     * @param {?} dataService
     * @param {?} localeId
     * @param {?} loading
     * @param {?} elementRef
     * @param {?} inj
     * @param {?} cfr
     * @param {?} messagerService
     */
    constructor(args, dataService, localeId, loading, elementRef, inj, cfr, messagerService) {
        this.dataService = dataService;
        this.loading = loading;
        this.elementRef = elementRef;
        this.inj = inj;
        this.cfr = cfr;
        this.messagerService = messagerService;
        this.ttData = [];
        this.ttIdField = 'voId';
        this.ttSearchFields = [];
        this.dgData = [];
        this.dgIdField = 'id';
        this.procData = [];
        this.bsModalRef4BifSelector = null;
        this.subject4CreationProcess = new Subject();
        this.clickOk4BifSelector = (/**
         * @return {?}
         */
        () => {
            if (this.selectedEntity == null) {
                this.messagerService.error(this.localePipe.instant("pleaseSelectOneCreationProcess"));
                return;
            }
            this.subject4CreationProcess.next(this.selectedEntity);
            this.subject4CreationProcess.complete();
            this.bsModalRef4BifSelector.close();
        });
        this.clickClose4BifSelector = (/**
         * @return {?}
         */
        () => {
            this.bsModalRef4BifSelector.close();
        });
        this.args = new FormGetBillCreationProcessEntityExArgs();
        this.args.LoadFromJsonObject(args);
        this.localePipe = new LocalePipe(localeId);
        if (inj == null) {
            /** @type {?} */
            const refInj = ReflectiveInjector.resolveAndCreate([
                MessagerService,
            ]);
            this.inj = refInj;
        }
        this.cfr = cfr || this.inj.get(ComponentFactoryResolver);
        this.messagerService = messagerService || this.inj.get(MessagerService, null);
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.ttDataRoot = {
            id: "*",
            data: {
                voId: "*",
                voName: this.localePipe.instant("all"),
            },
            parent: null,
            expanded: true,
            children: [],
        };
        this.ttData = [this.ttDataRoot];
        this.configTtColumns();
        this.configDgColumns();
        this.configTtEvents();
        this.configDgEvents();
        this.loadItems();
    }
    /**
     * @private
     * @return {?}
     */
    loadItems() {
        this.loading.show({ container: this.elementRef });
        /** @type {?} */
        let list$ = null;
        if (this.args.downBillVoId == null) {
            list$ = this.dataService.getSlimBillCreationProcessEntityExesByUpBillVoId4Push(this.args.upBillVoId);
        }
        else {
            list$ = this.dataService.getSlimBillCreationProcessEntityExesByUpBillVoIdAndDownBillVoId4SpecificPush(this.args.upBillVoId, this.args.downBillVoId);
        }
        list$.subscribe((/**
         * @param {?} result
         * @return {?}
         */
        (result) => {
            this.loading.close();
            this.procData = result || [];
            this.dgData = [...this.procData];
            // 组织VO树
            /** @type {?} */
            const voList = [];
            this.procData.forEach((/**
             * @param {?} it
             * @return {?}
             */
            it => {
                if (voList.some((/**
                 * @param {?} vo
                 * @return {?}
                 */
                vo => vo.voId == it.downBillVoId)) == false) {
                    voList.push({
                        voId: it.downBillVoId,
                        voName: it.downBillVoName,
                    });
                }
            }));
            this.ttDataRoot.children = voList.map((/**
             * @param {?} it
             * @return {?}
             */
            it => {
                return {
                    id: it.voId,
                    data: {
                        voId: it.voId,
                        voName: it.voName,
                    },
                    expanded: true,
                };
            }));
            this.ttData = [this.ttDataRoot];
            // 默认选中第一条
            if (this.dgData && this.dgData.length > 0) {
                this.selectedEntity = this.dgData[0];
                setTimeout((/**
                 * @return {?}
                 */
                () => {
                    this.dg.clearSelections();
                    this.dg.selectRow(this.dgData[0].id);
                }), 0);
            }
        }), (/**
         * @param {?} err
         * @return {?}
         */
        (err) => {
            this.loading.close();
            throw err;
        }));
    }
    /**
     * @return {?}
     */
    configTtColumns() {
        this.ttCols = [
            {
                field: 'voName', title: this.localePipe.instant('downstreamBill'), width: 120,
            },
        ];
    }
    /**
     * @return {?}
     */
    configDgColumns() {
        this.dgCols = [
            { field: "code", title: this.localePipe.transform("processCode"), width: 120, sortable: true },
            {
                field: "name", title: this.localePipe.transform("processName"), width: 250, sortable: true,
            },
        ];
    }
    /**
     * @return {?}
     */
    configTtEvents() {
        this.tt.nodeSelected.subscribe((/**
         * @param {?} ctx
         * @return {?}
         */
        (ctx) => {
            //ctx:{inidex;instance;node:{data}}
            if (ctx.node.id == "*") {
                this.dgData = [...this.procData];
            }
            else {
                this.dgData = [...this.procData.filter((/**
                     * @param {?} it
                     * @return {?}
                     */
                    it => it.downBillVoId == ctx.node.data.voId))];
            }
            if (this.dgData && this.dgData.length > 0) {
                this.selectedEntity = this.dgData[0];
                setTimeout((/**
                 * @return {?}
                 */
                () => {
                    this.dg.clearSelections();
                    this.dg.selectRow(this.dgData[0].id);
                }), 0);
            }
        }));
    }
    /**
     * @return {?}
     */
    configDgEvents() {
        this.dg.selectChanged.subscribe((/**
         * @param {?} row
         * @return {?}
         */
        (row) => {
            this.selectedEntity = row.data;
        }));
    }
}
PushSelectorComponent.decorators = [
    { type: Component, args: [{
                selector: 'lib-bif-push-selector',
                template: "<div class=\"g-main\" style=\"padding-left: 24px; padding-right: 24px;\">\r\n  <div class=\"d-flex flex-row\"\r\n    style=\"height: 100%; width: 100%; border: 1px solid #E9ECF3; box-shadow: 0 2px 6px 0 rgb(31 35 41 / 6%); border-radius: 6px;\">\r\n    <div class=\"d-flex flex-column\" style=\"width: 200px;\" ngResizable rzAspectRatio=\"true\" [rzHandles]=\"'e'\">\r\n      <farris-treetable #tt class=\"f-utils-fill-flex-column\" [data]=\"ttData\" [columns]=\"ttCols\" [idField]=\"ttIdField\"\r\n        [fit]=\"true\" [showHeader]=\"true\" [fixedHeader]=\"true\" [singleSelect]=\"true\">\r\n      </farris-treetable>\r\n    </div>\r\n\r\n    <div class=\"f-utils-fill-flex-row\" style=\"padding-left: 15px;\">\r\n      <div class=\"d-flex flex-column\" style=\"width: 100%;\">\r\n        <div class=\"f-utils-fill-flex-column\">\r\n          <farris-datagrid #dg [fit]=\"true\" [fitColumns]=\"true\" [data]=\"dgData\" [columns]=\"dgCols\" [idField]=\"dgIdField\"\r\n            [showHeader]=\"true\" [showBorder]=\"true\" [striped]=\"true\" [pagination]=\"false\" [showLineNumber]=\"true\">\r\n          </farris-datagrid>\r\n        </div>\r\n        <div class=\"form-group\" style=\"\">\r\n          <div>{{ 'processDesciption' | locale }}</div>\r\n          <textarea readonly class=\"form-control\" name=\"description\" rows=\"3\"\r\n            [ngModel]=\"selectedEntity&&selectedEntity.description\"></textarea>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</div>\r\n",
                styles: [""]
            }] }
];
/** @nocollapse */
PushSelectorComponent.ctorParameters = () => [
    { type: undefined, decorators: [{ type: Inject, args: [SELECTOR_ARGS_INJECTOR,] }] },
    { type: BifDataService },
    { type: String, decorators: [{ type: Inject, args: [LOCALE_ID,] }] },
    { type: LoadingService },
    { type: ElementRef },
    { type: Injector, decorators: [{ type: Optional }] },
    { type: ComponentFactoryResolver, decorators: [{ type: Optional }] },
    { type: MessagerService, decorators: [{ type: Optional }] }
];
PushSelectorComponent.propDecorators = {
    tt: [{ type: ViewChild, args: ['tt',] }],
    dg: [{ type: ViewChild, args: ['dg',] }]
};

/**
 * @fileoverview added by tsickle
 * Generated from: lib/utils/BrowserUtil.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/**
 * @return {?}
 */
function judgeBrowserType() {
    /** @type {?} */
    const browser = {
        type: "Unknown",
        IEVersion: undefined,
    };
    /** @type {?} */
    let userAgent = navigator.userAgent;
    //取得浏览器的userAgent字符串 
    /** @type {?} */
    let isOpera = userAgent.indexOf("Opera") > -1;
    //判断是否Opera浏览器 
    /** @type {?} */
    let isIE = userAgent.indexOf("compatible") > -1 && userAgent.indexOf("MSIE") > -1 && !isOpera;
    isIE = isIE || (!!window['ActiveXObject'] || "ActiveXObject" in window); //新版IE11判断是否为IE浏览器
    //新版IE11判断是否为IE浏览器
    /** @type {?} */
    let isEdge = userAgent.indexOf("Windows NT 6.1; Trident/7.0;") > -1 && !isIE;
    //判断是否IE的Edge浏览器 
    /** @type {?} */
    let isFF = userAgent.indexOf("Firefox") > -1;
    //判断是否Firefox浏览器 
    /** @type {?} */
    let isSafari = userAgent.indexOf("Safari") > -1 && userAgent.indexOf("Chrome") == -1;
    //判断是否Safari浏览器 
    /** @type {?} */
    let isChrome = userAgent.indexOf("Chrome") > -1 && userAgent.indexOf("Safari") > -1;
    if (isIE) {
        browser.type = "IE";
        if (navigator.userAgent != null && !!navigator.userAgent.match(/Trident\/7\./)) {
            browser.IEVersion = "IE11";
        }
        else {
            /** @type {?} */
            let reIE = new RegExp("MSIE (\\d+\\.\\d+);");
            reIE.test(userAgent);
            /** @type {?} */
            let fIEVersion = parseFloat(RegExp["$1"]);
            if (fIEVersion == 7) {
                browser.IEVersion = "IE7";
            }
            else if (fIEVersion == 8) {
                browser.IEVersion = "IE8";
            }
            else if (fIEVersion == 9) {
                browser.IEVersion = "IE9";
            }
            else if (fIEVersion == 10) {
                browser.IEVersion = "IE10";
            }
            else if (fIEVersion == 11) {
                browser.IEVersion = "IE11";
            }
            else {
                //IE版本过低 
                browser.IEVersion = "Unknown";
            }
        }
    } //isIE end 
    if (isFF) {
        browser.type = "FF";
    }
    if (isOpera) {
        browser.type = "Opera";
    }
    if (isSafari) {
        browser.type = "Safari";
    }
    if (isChrome) {
        browser.type = "Chrome";
    }
    if (isEdge) {
        browser.type = "Edge";
    }
    return browser;
}

/**
 * @fileoverview added by tsickle
 * Generated from: lib/bif-manual-creation/service/bif-source-ui.service.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
class BifSourceUiService extends AbstractUiService {
    /**
     * @param {?} navigationService
     * @param {?} frameContext
     * @param {?} modalService
     * @param {?} messager
     * @param {?} injector
     * @param {?} cfr
     * @param {?} loader
     * @param {?} localeId
     * @param {?} runtimeFrameworkService
     */
    constructor(navigationService, frameContext, modalService, messager, injector, cfr, loader, localeId, runtimeFrameworkService) {
        super(frameContext, modalService, messager, injector, cfr, loader, localeId, runtimeFrameworkService);
        this.navigationService = navigationService;
        this.frameContext = frameContext;
        this.modalService = modalService;
        this.messager = messager;
        this.injector = injector;
        this.cfr = cfr;
        this.loader = loader;
        this.localeId = localeId;
        this.uiStateKeyCreationResult = BIF_UISTATE_KEY_CREATION_RESULT;
    }
    /**
     * 下推时打开生单规则选择器
     * @param {?} upBillVoId
     * @param {?=} bizFlowchartId
     * @param {?=} modalOptions
     * @param {?=} customSelectorModuleUrl
     * @param {?=} extParams
     * @return {?}
     */
    openBillCreationProcessSelector4Push(upBillVoId, bizFlowchartId, modalOptions, customSelectorModuleUrl, extParams) {
        /** @type {?} */
        const args = new FormGetBillCreationProcessEntityExArgs();
        args.upBillVoId = upBillVoId;
        args.manualCreationMode = ManualCreationMode.Push;
        return this.openBillCreationProcessSelector(args, PushSelectorComponent, modalOptions, customSelectorModuleUrl, extParams);
    }
    /**
     * 特定下推时打开生单规则选择器
     * @param {?} upBillVoId
     * @param {?} downBillVoId
     * @param {?=} bizFlowchartId
     * @param {?=} modalOptions
     * @param {?=} customSelectorModuleUrl
     * @param {?=} extParams
     * @return {?}
     */
    openBillCreationProcessSelector4SpecificPush(upBillVoId, downBillVoId, bizFlowchartId, modalOptions, customSelectorModuleUrl, extParams) {
        /** @type {?} */
        const args = new FormGetBillCreationProcessEntityExArgs();
        args.upBillVoId = upBillVoId;
        args.downBillVoId = downBillVoId;
        args.manualCreationMode = ManualCreationMode.SpecificPush;
        // args.bizFlowchartId = bizFlowchartId;
        return this.openBillCreationProcessSelector(args, PushSelectorComponent, modalOptions, customSelectorModuleUrl, extParams);
    }
    /**
     * \@Deprecated 已弃用，请使用{\@link openTargetApp}
     * 打开下游单据制单界面
     * @param {?} formSettings
     * @param {?} creationResult
     * @param {?=} extParams
     * @return {?}
     */
    openTargetForm(formSettings, creationResult, extParams) {
        if (formSettings == null) {
            throw "参数formSettings不可为空";
        }
        if (creationResult == null) {
            throw "参数creationResult不可为空";
        }
        if (typeof creationResult == "string") {
            if (creationResult == "") {
                throw "参数creationResult不可为空";
            }
            /** @type {?} */
            const temp = new FormBillCreationProcessExecutorResult();
            temp.LoadFromJson(creationResult);
            creationResult = temp;
        }
        if ((creationResult instanceof FormBillCreationProcessExecutorResult) == false) {
            /** @type {?} */
            const res = new FormBillCreationProcessExecutorResult();
            res.LoadFromJsonObject(creationResult);
            creationResult = res;
        }
        if (creationResult.conditionResult.conditionExecutionResult == false) {
            this.messager.error(creationResult.conditionResult.message || this.localePipe.transform("creationExecutionError"));
            return;
        }
        if (creationResult.creationRuleExecutorResult == null || creationResult.creationRuleExecutorResult.mappingResults == null || creationResult.creationRuleExecutorResult.mappingResults.length == 0) {
            this.messager.error(this.localePipe.transform("creationResultEmpty"));
            return;
        }
        else if (creationResult.creationRuleExecutorResult.mappingResults.length == 1) {
            // 从表单配置中取下游卡片加载命令
            /** @type {?} */
            const action = formSettings.targetCardAppLoadCmd;
            if (action != null && action != "") {
                if (extParams == null) {
                    extParams = {
                        action: action
                    };
                }
                else {
                    extParams["action"] = extParams["action"] != null && extParams["action"] != "" ? extParams["action"] : action;
                }
            }
            //只有一条数据则打开卡片
            this.openApp(creationResult.creationRuleExecutorResult.mappingResults[0].associations[0].tarRootDataId, formSettings.targetCardAppId, formSettings.targetCardAppEntrance, creationResult, extParams, false);
        }
        else {
            if (formSettings.targetListAppId != null) {
                // 多条数据且配置批量编辑界面
                throw "暂不支持打开批量编辑界面";
                this.openApp(creationResult.creationRuleExecutorResult.mappingResults[0].associations[0].tarRootDataId, formSettings.targetListAppId, formSettings.targetListAppEntrance, creationResult, extParams, false);
            }
            else {
                //有多条数据但未配置批量编辑界面则打开多个卡片
                for (let mappingResult of creationResult.creationRuleExecutorResult.mappingResults) {
                    /** @type {?} */
                    let singleRes = new FormBillCreationProcessExecutorResult();
                    singleRes.conditionResult = creationResult.conditionResult;
                    singleRes.creationRuleExecutorResult = new RpcCreationRuleExecutorResult();
                    singleRes.creationRuleExecutorResult.bizFlowchartId = creationResult.creationRuleExecutorResult.bizFlowchartId;
                    singleRes.creationRuleExecutorResult.creationRuleId = creationResult.creationRuleExecutorResult.creationRuleId;
                    singleRes.creationRuleExecutorResult.creationRuleInstanceId = creationResult.creationRuleExecutorResult.creationRuleInstanceId;
                    singleRes.creationRuleExecutorResult.mappingResults = [mappingResult];
                    // 从表单配置中取下游卡片加载命令
                    /** @type {?} */
                    const action = formSettings.targetCardAppLoadCmd;
                    if (action != null && action != "") {
                        if (extParams == null) {
                            extParams = {
                                action: action
                            };
                        }
                        else {
                            extParams["action"] = extParams["action"] != null && extParams["action"] != "" ? extParams["action"] : action;
                        }
                    }
                    this.openApp(mappingResult.associations[0].tarRootDataId, formSettings.targetCardAppId, formSettings.targetCardAppEntrance, singleRes, extParams, false);
                }
            }
        }
    }
    /**
     * \@Deprecated
     * @private
     * @param {?} tabId
     * @param {?} appId
     * @param {?} appEntrance
     * @param {?} creationResult
     * @param {?=} extParams
     * @param {?=} reload
     * @param {?=} tabName
     * @param {?=} enableRefresh
     * @param {?=} destructuring
     * @return {?}
     */
    openApp(tabId, appId, appEntrance, creationResult, extParams, reload, tabName, enableRefresh, destructuring) {
        extParams = extParams == null ? {} : extParams;
        /** @type {?} */
        const browser = judgeBrowserType();
        if (browser.type == "IE" && browser.IEVersion == "IE11") {
            //IE11浏览器将生成结果转换为字符串存在top.localStorage，Id为tabId
            // console.log(tabId);
            window.top.localStorage.setItem(tabId, creationResult.ConvertToJson());
            this.navigationService.openApp(tabId, appId, appEntrance, extParams, reload, tabName, enableRefresh, destructuring);
        }
        else {
            this.navigationService.openApp(tabId, appId, appEntrance, this.buildRouteParams(creationResult, extParams), reload, tabName, enableRefresh, destructuring);
        }
    }
    /**
     * \@Deprecated
     * @private
     * @param {?} creationResult
     * @param {?} extParams
     * @return {?}
     */
    buildRouteParams(creationResult, extParams) {
        /** @type {?} */
        const params = extParams;
        params[this.uiStateKeyCreationResult] = creationResult.ConvertToJson();
        if (params["action"] == null || params["action"] == "") {
            params["action"] = "rootviewmodelbifLoad1";
        }
        return params;
    }
    /**
     * 打开下游单据制单界面
     * @param {?} formSettings
     * @param {?} conditionResult
     * @param {?} textIdWithDataIds
     * @param {?=} extParams
     * @return {?}
     */
    openTargetApp(formSettings, conditionResult, textIdWithDataIds, extParams) {
        if (formSettings == null) {
            throw "参数formSettings不可为空";
        }
        if (textIdWithDataIds == null) {
            throw "参数creationResult不可为空";
        }
        if (typeof textIdWithDataIds == "string") {
            if (textIdWithDataIds == "") {
                throw "参数creationResult不可为空";
            }
            textIdWithDataIds = (/** @type {?} */ (BpmnModelJsonHelper.FromJson(textIdWithDataIds, GeneralTextIdWithDataId)));
        }
        if (conditionResult.conditionExecutionResult == false) {
            this.messager.error(conditionResult.message || this.localePipe.transform("creationExecutionError"));
            return;
        }
        if (textIdWithDataIds == null || textIdWithDataIds.length == null || textIdWithDataIds.length <= 0) {
            this.messager.error(this.localePipe.transform("creationResultEmpty"));
            return;
        }
        else if (textIdWithDataIds.length == 1) {
            // 从表单配置中取下游卡片加载命令
            /** @type {?} */
            const action = formSettings.targetCardAppLoadCmd;
            if (action != null && action != "") {
                if (extParams == null) {
                    extParams = {
                        action: action
                    };
                }
                else {
                    extParams["action"] = extParams["action"] != null && extParams["action"] != "" ? extParams["action"] : action;
                }
            }
            //只有一条数据则打开卡片
            this.openAppWithGeneralText(textIdWithDataIds[0].dataId, formSettings.targetCardAppId, formSettings.targetCardAppEntrance, textIdWithDataIds[0].generalTextId, extParams, false);
        }
        else {
            if (formSettings.targetListAppId != null) {
                // 多条数据且配置批量编辑界面
                throw "暂不支持打开批量编辑界面";
            }
            else {
                //有多条数据但未配置批量编辑界面则打开多个卡片
                for (let item of textIdWithDataIds) {
                    // 从表单配置中取下游卡片加载命令
                    /** @type {?} */
                    const action = formSettings.targetCardAppLoadCmd;
                    if (action != null && action != "") {
                        if (extParams == null) {
                            extParams = {
                                action: action
                            };
                        }
                        else {
                            extParams["action"] = extParams["action"] != null && extParams["action"] != "" ? extParams["action"] : action;
                        }
                    }
                    this.openAppWithGeneralText(item.dataId, formSettings.targetCardAppId, formSettings.targetCardAppEntrance, item.generalTextId, extParams, false);
                }
            }
        }
    }
    /**
     * @private
     * @param {?} tabId
     * @param {?} appId
     * @param {?} appEntrance
     * @param {?} textId
     * @param {?=} extParams
     * @param {?=} reload
     * @param {?=} tabName
     * @param {?=} enableRefresh
     * @param {?=} destructuring
     * @return {?}
     */
    openAppWithGeneralText(tabId, appId, appEntrance, textId, extParams, reload, tabName, enableRefresh, destructuring) {
        extParams = extParams == null ? {} : extParams;
        /** @type {?} */
        const browser = judgeBrowserType();
        if (browser.type == "IE" && browser.IEVersion == "IE11") {
            //IE11浏览器将生成结果转换为字符串存在top.localStorage，Id为tabId
            window.top.localStorage.setItem(tabId, textId);
            this.navigationService.openApp(tabId, appId, appEntrance, this.buildRouteParamsWithGeneralText(textId, extParams), reload, tabName, enableRefresh, destructuring);
        }
        else {
            this.navigationService.openApp(tabId, appId, appEntrance, this.buildRouteParamsWithGeneralText(textId, extParams), reload, tabName, enableRefresh, destructuring);
        }
    }
    /**
     *
     * @private
     * @param {?} textId
     * @param {?} extParams
     * @return {?}
     */
    buildRouteParamsWithGeneralText(textId, extParams) {
        /** @type {?} */
        const params = extParams;
        params[this.uiStateKeyCreationResult] = textId;
        if (params["action"] == null || params["action"] == "") {
            params["action"] = "rootviewmodelbifLoad1";
        }
        return params;
    }
}
BifSourceUiService.decorators = [
    { type: Injectable }
];
/** @nocollapse */
BifSourceUiService.ctorParameters = () => [
    { type: NavigationService },
    { type: FrameContext },
    { type: BsModalService },
    { type: MessagerService },
    { type: Injector },
    { type: ComponentFactoryResolver },
    { type: NgModuleFactoryLoader },
    { type: String, decorators: [{ type: Inject, args: [LOCALE_ID,] }] },
    { type: RuntimeFrameworkService, decorators: [{ type: Optional }] }
];

/**
 * @fileoverview added by tsickle
 * Generated from: lib/bif-manual-creation/components/pull-selector/pull-selector.component.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
class PullSelectorComponent {
    /**
     * @param {?} args
     * @param {?} dataService
     * @param {?} localeId
     * @param {?} loading
     * @param {?} elementRef
     * @param {?} inj
     * @param {?} cfr
     * @param {?} messagerService
     */
    constructor(args, dataService, localeId, loading, elementRef, inj, cfr, messagerService) {
        this.dataService = dataService;
        this.loading = loading;
        this.elementRef = elementRef;
        this.inj = inj;
        this.cfr = cfr;
        this.messagerService = messagerService;
        this.ttData = [];
        this.ttIdField = 'voId';
        this.ttSearchFields = [];
        this.dgData = [];
        this.dgIdField = 'id';
        this.procData = [];
        this.scene = "Pull";
        this.bsModalRef4BifSelector = null;
        this.subject4CreationProcess = new Subject();
        this.clickOk4BifSelector = (/**
         * @return {?}
         */
        () => {
            if (this.selectedEntity == null) {
                this.messagerService.error(this.localePipe.instant("pleaseSelectOneCreationProcess"));
                return;
            }
            this.subject4CreationProcess.next(this.selectedEntity);
            this.subject4CreationProcess.complete();
            this.bsModalRef4BifSelector.close();
        });
        this.clickClose4BifSelector = (/**
         * @return {?}
         */
        () => {
            this.bsModalRef4BifSelector.close();
        });
        this.args = new FormGetBillCreationProcessEntityExArgs();
        this.args.LoadFromJsonObject(args);
        this.localePipe = new LocalePipe(localeId);
        if (inj == null) {
            /** @type {?} */
            const refInj = ReflectiveInjector.resolveAndCreate([
                MessagerService,
            ]);
            this.inj = refInj;
        }
        this.cfr = cfr || this.inj.get(ComponentFactoryResolver);
        this.messagerService = messagerService || this.inj.get(MessagerService, null);
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.ttDataRoot = {
            id: "*",
            data: {
                voId: "*",
                voName: this.localePipe.instant("all"),
            },
            parent: null,
            expanded: true,
            children: [],
        };
        this.ttData = [this.ttDataRoot];
        this.configTtColumns();
        this.configDgColumns();
        this.configTtEvents();
        this.configDgEvents();
        this.loadItems();
    }
    /**
     * @private
     * @return {?}
     */
    loadItems() {
        this.loading.show({ container: this.elementRef });
        /** @type {?} */
        let list$ = null;
        if (this.args.upBillVoId == null) {
            list$ = this.dataService.getSlimBillCreationProcessEntityExesByDownBillVoId4Pull(this.args.downBillVoId);
        }
        else {
            list$ = this.dataService.getSlimBillCreationProcessEntityExesByUpBillVoIdAndDownBillVoId4SpecificPull(this.args.upBillVoId, this.args.downBillVoId);
        }
        list$.subscribe((/**
         * @param {?} result
         * @return {?}
         */
        (result) => {
            this.loading.close();
            this.procData = result || [];
            this.dgData = [...this.procData];
            // 组织VO树
            /** @type {?} */
            const voList = [];
            this.procData.forEach((/**
             * @param {?} it
             * @return {?}
             */
            it => {
                if (voList.some((/**
                 * @param {?} vo
                 * @return {?}
                 */
                vo => vo.voId == it.upBillVoId)) == false) {
                    voList.push({
                        voId: it.upBillVoId,
                        voName: it.upBillVoName,
                    });
                }
            }));
            this.ttDataRoot.children = voList.map((/**
             * @param {?} it
             * @return {?}
             */
            it => {
                return {
                    id: it.voId,
                    data: {
                        voId: it.voId,
                        voName: it.voName,
                    },
                    expanded: true,
                };
            }));
            this.ttData = [this.ttDataRoot];
            // 默认选中第一条
            if (this.dgData && this.dgData.length > 0) {
                this.selectedEntity = this.dgData[0];
                setTimeout((/**
                 * @return {?}
                 */
                () => {
                    this.dg.clearSelections();
                    this.dg.selectRow(this.dgData[0].id);
                }), 0);
            }
        }), (/**
         * @param {?} err
         * @return {?}
         */
        (err) => {
            this.loading.close();
            throw err;
        }));
    }
    /**
     * @return {?}
     */
    configTtColumns() {
        this.ttCols = [
            {
                field: 'voName', title: this.localePipe.instant('upstreamBill'), width: 120,
            },
        ];
    }
    /**
     * @return {?}
     */
    configDgColumns() {
        this.dgCols = [
            { field: "code", title: this.localePipe.transform("processCode"), width: 120, sortable: true },
            {
                field: "name", title: this.localePipe.transform("processName"), width: 250, sortable: true,
            },
        ];
    }
    /**
     * @return {?}
     */
    configTtEvents() {
        this.tt.nodeSelected.subscribe((/**
         * @param {?} ctx
         * @return {?}
         */
        (ctx) => {
            //ctx:{inidex;instance;node:{data}}
            if (ctx.node.id == "*") {
                this.dgData = [...this.procData];
            }
            else {
                this.dgData = [...this.procData.filter((/**
                     * @param {?} it
                     * @return {?}
                     */
                    it => it.upBillVoId == ctx.node.data.voId))];
            }
            if (this.dgData && this.dgData.length > 0) {
                this.selectedEntity = this.dgData[0];
                setTimeout((/**
                 * @return {?}
                 */
                () => {
                    this.dg.clearSelections();
                    this.dg.selectRow(this.dgData[0].id);
                }), 0);
            }
        }));
    }
    /**
     * @return {?}
     */
    configDgEvents() {
        this.dg.selectChanged.subscribe((/**
         * @param {?} row
         * @return {?}
         */
        (row) => {
            this.selectedEntity = row.data;
        }));
    }
}
PullSelectorComponent.decorators = [
    { type: Component, args: [{
                selector: 'lib-bif-pull-selector',
                template: "<div class=\"g-main\" style=\"padding-left: 24px; padding-right: 24px;\">\r\n  <div class=\"d-flex flex-row\"\r\n    style=\"height: 100%; width: 100%; border: 1px solid #E9ECF3; box-shadow: 0 2px 6px 0 rgb(31 35 41 / 6%); border-radius: 6px;\">\r\n    <div class=\"d-flex flex-column\" style=\"width: 200px;\" ngResizable rzAspectRatio=\"true\" [rzHandles]=\"'e'\">\r\n      <farris-treetable #tt class=\"f-utils-fill-flex-column\" [data]=\"ttData\" [columns]=\"ttCols\" [idField]=\"ttIdField\"\r\n        [fit]=\"true\" [showHeader]=\"true\" [fixedHeader]=\"true\" [singleSelect]=\"true\">\r\n      </farris-treetable>\r\n    </div>\r\n\r\n    <div class=\"f-utils-fill-flex-row\" style=\"padding-left: 15px;\">\r\n      <div class=\"d-flex flex-column\" style=\"width: 100%;\">\r\n        <div class=\"f-utils-fill-flex-column\">\r\n          <farris-datagrid #dg [fit]=\"true\" [fitColumns]=\"true\" [data]=\"dgData\" [columns]=\"dgCols\" [idField]=\"dgIdField\"\r\n            [showHeader]=\"true\" [showBorder]=\"true\" [striped]=\"true\" [pagination]=\"false\" [showLineNumber]=\"true\">\r\n          </farris-datagrid>\r\n        </div>\r\n        <div class=\"form-group\" style=\"\">\r\n          <div>{{ 'processDesciption' | locale }}</div>\r\n          <textarea readonly class=\"form-control\" name=\"description\" rows=\"3\"\r\n            [ngModel]=\"selectedEntity&&selectedEntity.description\"></textarea>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</div>\r\n",
                styles: [""]
            }] }
];
/** @nocollapse */
PullSelectorComponent.ctorParameters = () => [
    { type: undefined, decorators: [{ type: Inject, args: [SELECTOR_ARGS_INJECTOR,] }] },
    { type: BifDataService },
    { type: String, decorators: [{ type: Inject, args: [LOCALE_ID,] }] },
    { type: LoadingService },
    { type: ElementRef },
    { type: Injector, decorators: [{ type: Optional }] },
    { type: ComponentFactoryResolver, decorators: [{ type: Optional }] },
    { type: MessagerService, decorators: [{ type: Optional }] }
];
PullSelectorComponent.propDecorators = {
    tt: [{ type: ViewChild, args: ['tt',] }],
    dg: [{ type: ViewChild, args: ['dg',] }]
};

/**
 * @fileoverview added by tsickle
 * Generated from: lib/utils/ObjectUtils.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/**
 * @param {?} str
 * @return {?}
 */
function canJSONParse(str) {
    try {
        if (typeof JSON.parse(str) == "object") {
            return true;
        }
    }
    catch (e) {
    }
    return false;
}

/**
 * @fileoverview added by tsickle
 * Generated from: lib/bif-manual-creation/service/bif-target-ui.service.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
class BifTargetUiService extends AbstractUiService {
    /**
     * @param {?} dataService
     * @param {?} frameContext
     * @param {?} modalService
     * @param {?} messager
     * @param {?} injector
     * @param {?} cfr
     * @param {?} loader
     * @param {?} localeId
     * @param {?} runtimeFrameworkService
     */
    constructor(dataService, frameContext, modalService, messager, injector, cfr, loader, localeId, runtimeFrameworkService) {
        super(frameContext, modalService, messager, injector, cfr, loader, localeId, runtimeFrameworkService);
        this.dataService = dataService;
        this.frameContext = frameContext;
        this.modalService = modalService;
        this.messager = messager;
        this.injector = injector;
        this.cfr = cfr;
        this.loader = loader;
        this.localeId = localeId;
        this.uiStateKeyCreationResult = BIF_UISTATE_KEY_CREATION_RESULT;
    }
    /**
     * 参照时打开生单规则选择器
     * @param {?} downVoId
     * @param {?=} bizFlowchartId
     * @param {?=} modalOptions
     * @param {?=} customSelectorModuleUrl
     * @param {?=} extParams
     * @return {?}
     */
    openBillCreationProcessSelector4Pull(downVoId, bizFlowchartId, modalOptions, customSelectorModuleUrl, extParams) {
        /** @type {?} */
        const args = new FormGetBillCreationProcessEntityExArgs();
        args.downBillVoId = downVoId;
        args.manualCreationMode = ManualCreationMode.Pull;
        // args.bizFlowchartId = bizFlowchartId;
        return this.openBillCreationProcessSelector(args, PullSelectorComponent, modalOptions, customSelectorModuleUrl, extParams);
    }
    /**
     * 特定参照时打开生单规则选择器
     * @param {?} upBillVoId
     * @param {?} downVoId
     * @param {?=} bizFlowchartId
     * @param {?=} modalOptions
     * @param {?=} customSelectorModuleUrl
     * @param {?=} extParams
     * @return {?}
     */
    openBillCreationProcessSelector4SpecificPull(upBillVoId, downVoId, bizFlowchartId, modalOptions, customSelectorModuleUrl, extParams) {
        /** @type {?} */
        const args = new FormGetBillCreationProcessEntityExArgs();
        args.upBillVoId = upBillVoId;
        args.downBillVoId = downVoId;
        args.manualCreationMode = ManualCreationMode.SpecificPull;
        // args.bizFlowchartId = bizFlowchartId;
        return this.openBillCreationProcessSelector(args, PullSelectorComponent, modalOptions, customSelectorModuleUrl, extParams);
    }
    /**
     * 打开来源单据选择器
     * @param {?=} formSettings
     * @param {?=} modalOptions
     * @param {?=} extParams
     * @return {?}
     */
    openSourceDataSelector4Pull(formSettings, modalOptions, extParams) {
        modalOptions = modalOptions == null ? this.defaultModalOptions : modalOptions;
        modalOptions.title = modalOptions.title == null ? this.localePipe.transform("sourceDataSelector") : modalOptions.title;
        /** @type {?} */
        let cmpR = null;
        if (formSettings == null || formSettings.sourceDataSelectorModuleUrl == null) // 没有配置时加载默认通用单据选择器
         {
            this.messager.error(this.localePipe.instant("noDefaultUpBillSelector"));
            throw "暂无默认实现，请使用自定义来源单据选择器。请确保生单流程中【集成场景】启用了【人工拉式生单】场景，并且【单据配置】-【拉式生单配置】-【上游应用入口】或【URL】不为空";
            // let cmpF: ComponentFactory<SourceDataSelectorComponent> = this.cfr.resolveComponentFactory(SourceDataSelectorComponent);
            // let inj: Injector = Injector.create([
            // ], this.injector);
            // cmpR = cmpF.create(inj);
            // this.configModalButtons(modalOptions, cmpR);
            // cmpR.instance.bsModalRef4AifSelector = this.modalService.show(cmpR, modalOptions);
            // return cmpR.instance.subject4EntityDatas.asObservable();
        }
        else //加载自定义来源单据选择器
         {
            // return from(System.import(formSettings.sourceDataSelectorModuleUrl.substring(0, formSettings.sourceDataSelectorModuleUrl.indexOf("#")) + ".js")).pipe(
            /** @type {?} */
            let moduleF$ = null;
            if (formSettings.sourceDataSelectorAppId != null) //配置appId时
             {
                moduleF$ = from(System.import(formSettings.sourceDataSelectorModuleUrl.toLowerCase()).then((/**
                 * @param {?} m
                 * @return {?}
                 */
                m => m))).pipe(switchMap((/**
                 * @param {?} m
                 * @return {?}
                 */
                (m) => {
                    for (let key in m) {
                        return of(m[key]);
                    }
                    return of(null);
                })));
            }
            else //只配置url时
             {
                moduleF$ = from(this.loader.load(formSettings.sourceDataSelectorModuleUrl));
            }
            return moduleF$.pipe(switchMap((/**
             * @param {?} moduleFactory
             * @return {?}
             */
            (moduleFactory) => {
                /** @type {?} */
                const moduleRef = moduleFactory.create(this.frameContext.root.injector);
                if (moduleRef.instance.createSourceDataSelector && moduleRef.instance.createSourceDataSelector instanceof Function) //module上定义createSourceDataSelector方法
                 {
                    /** @type {?} */
                    const cmpR$ = moduleRef.instance.createSourceDataSelector(this.frameContext.root.injector, null, extParams);
                    if (cmpR$ instanceof Observable) {
                        return cmpR$.pipe(switchMap((/**
                         * @param {?} componentRef
                         * @return {?}
                         */
                        (componentRef) => {
                            cmpR = componentRef;
                            this.configModalButtons(modalOptions, cmpR);
                            cmpR.instance.bsModalRef4BifSelector = this.modalService.show(cmpR, modalOptions);
                            return cmpR.instance.subject4EntityDatas.asObservable();
                        })));
                    }
                    else if (cmpR$ instanceof ComponentRef) {
                        cmpR = cmpR$;
                        this.configModalButtons(modalOptions, cmpR);
                        cmpR.instance.bsModalRef4BifSelector = this.modalService.show(cmpR, modalOptions);
                        return cmpR.instance.subject4EntityDatas.asObservable();
                    }
                }
                else //module上未定义时尝试寻找RootComponent类
                 {
                    /** @type {?} */
                    const translate = moduleRef.injector.get(TranslateService);
                    return translate.getTranslation(this.localeId).pipe(switchMap((/**
                     * @param {?} data
                     * @return {?}
                     */
                    (data) => {
                        translate.setTranslation(this.localeId, data);
                        translate.defaultLang = this.localeId;
                        translate.currentLang = this.localeId;
                        return this.getEntityData(moduleRef, formSettings, modalOptions, extParams);
                    })), catchError((/**
                     * @param {?} err
                     * @return {?}
                     */
                    (err) => {
                        console.error(err);
                        return this.getEntityData(moduleRef, formSettings, modalOptions, extParams);
                    })));
                }
            })));
        }
    }
    /**
     * \@Deprecated 已弃用，请使用{\@link getCreationResult}
     * 获取传到根组件UIState上的生单规则执行器结果
     * @return {?}
     */
    getFormBillCreationProcessExecutorResult() {
        //取得tabId为[AppId]_[AppEntrance]_[tabId]
        /** @type {?} */
        let tabId = this.runtimeFrameworkService.tabId || this.getQueryString("tabId") || "";
        /** @type {?} */
        let dataId = tabId.substr(tabId.length - 36)
        // console.log(tabId);
        // console.log(dataId);
        ;
        // console.log(tabId);
        // console.log(dataId);
        /** @type {?} */
        const browser = judgeBrowserType();
        //IE11浏览器从localStorage取值后并删除, 并存入UIState
        if (browser.type == "IE" && browser.IEVersion == "IE11") {
            /** @type {?} */
            const tmp = window.top.localStorage.getItem(dataId);
            window.top.localStorage.removeItem(dataId);
            this.frameContext.root.uiState.setPropertyValue(this.uiStateKeyCreationResult, tmp);
        }
        /** @type {?} */
        let resTemp = this.frameContext.root.uiState[this.uiStateKeyCreationResult];
        if (resTemp == null) {
            throw "FormBillCreationProcessExecutorResult is null";
        }
        /** @type {?} */
        const result = new FormBillCreationProcessExecutorResult();
        if (typeof resTemp == "string") {
            result.LoadFromJson(resTemp);
        }
        else if (typeof resTemp == "object") {
            result.LoadFromJsonObject(resTemp);
        }
        else {
            throw "不合法的类型";
        }
        return result;
    }
    /**
     * @param {?} name
     * @return {?}
     */
    getQueryString(name) {
        /** @type {?} */
        let reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i");
        /** @type {?} */
        let r = window.location.search.substr(1).match(reg);
        if (r != null) {
            return unescape(r[2]);
        }
        return null;
    }
    /**
     * 获取传到根组件UIState上的生单规则执行器结果
     * @return {?}
     */
    getCreationResult() {
        //取得tabId为[AppId]_[AppEntrance]_[tabId]
        /** @type {?} */
        let tabId = this.runtimeFrameworkService.tabId || this.getQueryString("tabId") || "";
        /** @type {?} */
        let dataId = tabId.substr(tabId.length - 36)
        // console.log(tabId);
        // console.log(dataId);
        ;
        // console.log(tabId);
        // console.log(dataId);
        /** @type {?} */
        const browser = judgeBrowserType();
        //IE11浏览器从localStorage取值后并删除, 并存入UIState
        if (browser.type == "IE" && browser.IEVersion == "IE11") {
            /** @type {?} */
            const tmp = window.top.localStorage.getItem(dataId);
            window.top.localStorage.removeItem(dataId);
            this.frameContext.root.uiState.setPropertyValue(this.uiStateKeyCreationResult, tmp);
        }
        /** @type {?} */
        let resTemp = this.frameContext.root.uiState[this.uiStateKeyCreationResult];
        if (resTemp == null) {
            throw "FormBillCreationProcessExecutorResult is null";
        }
        /** @type {?} */
        const result = new FormBillCreationProcessExecutorResult();
        if (typeof resTemp == "string") {
            // 兼容原直接传递生单数据场景
            if (canJSONParse(resTemp)) {
                result.LoadFromJson(resTemp);
                return of(result);
            }
            else {
                /** @type {?} */
                const resultTextId = resTemp;
                return this.dataService.getCreationResultById(resultTextId);
            }
        }
        else if (typeof resTemp == "object") {
            result.LoadFromJsonObject(resTemp);
            return of(result);
        }
        else {
            throw "不合法的类型";
        }
    }
    /**
     * 配置模态框按钮事件
     * @protected
     * @param {?} modalOptions
     * @param {?} service
     * @return {?}
     */
    configModalButtonsByService(modalOptions, service) {
        modalOptions.buttons = [
            {
                text: this.localePipe.transform("confirm"),
                cls: "btn btn-primary",
                handle: service.clickOk4BifSelector,
            },
            {
                text: this.localePipe.transform("cancel"),
                cls: "btn btn-secondary",
                handle: service.clickClose4BifSelector,
            }
        ];
        modalOptions.showButtons = true;
    }
    /**
     * @protected
     * @param {?} moduleRef
     * @param {?=} formSettings
     * @param {?=} modalOptions
     * @param {?=} extParams
     * @return {?}
     */
    getEntityData(moduleRef, formSettings, modalOptions, extParams) {
        /** @type {?} */
        let cmpF = null;
        /** @type {?} */
        let cmpR = null;
        /** @type {?} */
        let bootstrapComponentSelector = "app-rootcomponent";
        /** @type {?} */
        let bootstrapComponent = null;
        /** @type {?} */
        let facMap = moduleRef.componentFactoryResolver['_factories'];
        /** @type {?} */
        let subject4EntityDatas = null;
        if (extParams && extParams.bootstrapComponentSelector) //指定了根组件selector
         {
            bootstrapComponentSelector = extParams.bootstrapComponentSelector;
            facMap.forEach((/**
             * @param {?} value
             * @param {?} key
             * @param {?} map
             * @return {?}
             */
            (value, key, map$$1) => {
                /** @type {?} */
                const selector = value.selector;
                if (bootstrapComponentSelector == selector) {
                    cmpF = moduleRef.componentFactoryResolver.resolveComponentFactory((/** @type {?} */ (key)));
                    cmpR = cmpF.create(moduleRef.injector);
                }
            }));
        }
        else //未指定根组件selector
         {
            bootstrapComponent = moduleRef['_bootstrapComponents'][0];
            if (bootstrapComponent) //先找bootstrapComponent数组有无组件
             {
                cmpF = moduleRef.componentFactoryResolver.resolveComponentFactory(bootstrapComponent);
                cmpR = (/** @type {?} */ (cmpF.create(moduleRef.injector)));
            }
            else //没有则从facMap中查找默认的app-rootcomponent
             {
                facMap.forEach((/**
                 * @param {?} value
                 * @param {?} key
                 * @param {?} map
                 * @return {?}
                 */
                (value, key, map$$1) => {
                    /** @type {?} */
                    const selector = value.selector;
                    if (bootstrapComponentSelector == selector) {
                        cmpF = moduleRef.componentFactoryResolver.resolveComponentFactory((/** @type {?} */ (key)));
                        cmpR = cmpF.create(moduleRef.injector);
                    }
                }));
            }
        }
        if (cmpR && cmpR.instance && cmpR.instance.viewModel && cmpR.instance.viewModel.uiState) {
            cmpR.instance.viewModel.uiState.setPropertyValue("action", "Load1");
            cmpR.instance.viewModel.uiState.setPropertyValue('DEVKIT_DIALOG', true);
        }
        /** @type {?} */
        const dataSelectorService = cmpR.injector.get(AbstractBifDataSelectorService, null);
        if (dataSelectorService != null) // 有AbstractBifDataSelectorService的provider时
         {
            this.configModalButtonsByService(modalOptions, dataSelectorService);
            dataSelectorService.bsModalRef4BifSelector = this.modalService.show(cmpR, modalOptions);
            subject4EntityDatas = dataSelectorService.subject4EntityDatas.asObservable();
        }
        else //没有则从组件上寻找相应属性
         {
            this.configModalButtons(modalOptions, cmpR);
            cmpR.instance.bsModalRef4BifSelector = this.modalService.show(cmpR, modalOptions);
            subject4EntityDatas = cmpR.instance.subject4EntityDatas.asObservable();
        }
        // 此处用于解决任务中心直接打开来源单据帮助时不执行初始化加载命令的问题
        if (cmpR && cmpR.instance && cmpR.instance.viewModel) {
            if (extParams && extParams.loadCommand) {
                /** @type {?} */
                const loadCommand = extParams.loadCommand;
                /** @type {?} */
                const cmdFunc = cmpR.instance.viewModel[loadCommand];
                if (cmdFunc) {
                    /** @type {?} */
                    let args = undefined;
                    if (extParams && extParams.loadParams) {
                        if (Array.isArray(extParams.loadParams)) {
                            args = extParams.loadParams;
                        }
                        else {
                            args = [extParams.loadParams];
                        }
                    }
                    cmdFunc.apply(cmpR.instance.viewModel, args);
                }
            }
        }
        return subject4EntityDatas;
    }
}
BifTargetUiService.decorators = [
    { type: Injectable }
];
/** @nocollapse */
BifTargetUiService.ctorParameters = () => [
    { type: BifDataService },
    { type: FrameContext },
    { type: BsModalService },
    { type: MessagerService },
    { type: Injector },
    { type: ComponentFactoryResolver },
    { type: NgModuleFactoryLoader },
    { type: String, decorators: [{ type: Inject, args: [LOCALE_ID,] }] },
    { type: RuntimeFrameworkService, decorators: [{ type: Optional }] }
];

/**
 * @fileoverview added by tsickle
 * Generated from: lib/bif-manual-creation/bif-manual-creation.module.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
const ɵ0 = localStorage.getItem('languageCode') || 'zh-CHS', ɵ1 = {};
class BifManualCreationModule {
    /**
     * @param {?=} config
     * @return {?}
     */
    static forRoot(config) {
        /** @type {?} */
        const providers = [
            { provide: ModuleConfig, useValue: config || {} },
            BifDataService,
            BifSourceUiService,
            BifTargetUiService,
        ];
        return {
            ngModule: BifManualCreationModule,
            providers: providers
        };
    }
}
BifManualCreationModule.decorators = [
    { type: NgModule, args: [{
                declarations: [
                    PushSelectorComponent,
                    PullSelectorComponent,
                    LocalePipe,
                ],
                imports: [
                    CommonModule,
                    FormsModule,
                    HttpClientModule,
                    ModalModule.forRoot(),
                    AngularDraggableModule,
                    FarrisCommonModule.forRoot(),
                    DatagridEditorsModule,
                    DatagridModule.forRoot([
                        ...EditorProviders
                    ]),
                    TreeModule,
                    TreeTableModule,
                    LoadingModule.forRoot({
                        message: 'Loading...'
                    }),
                    NotifyModule.forRoot(),
                    MessagerModule.forRoot({
                        width: 550,
                        height: 450
                    }),
                    InputGroupModule,
                    LanguageTextboxModule,
                    NumberSpinnerModule,
                    SwitchModule,
                    FarrisSectionModule,
                ],
                providers: [
                    { provide: LOCALE_ID, useValue: ɵ0 },
                    { provide: ModuleConfig, useValue: ɵ1 },
                    { provide: NgModuleFactoryLoader, useClass: SystemJsNgModuleLoader },
                    BifDataService,
                    BifSourceUiService,
                    BifTargetUiService,
                ],
                exports: [
                    PushSelectorComponent,
                    PullSelectorComponent
                ],
                entryComponents: [
                    PushSelectorComponent,
                    PullSelectorComponent
                ],
            },] }
];

/**
 * @fileoverview added by tsickle
 * Generated from: lib/bill-tracker/args/CanTrackingResult.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
class CanTrackingResult extends CanTrackingInfo {
    /**
     * @protected
     * @return {?}
     */
    ResetBeforeLoadFrom() {
        super.ResetBeforeLoadFrom();
        this.billTrackingSettings = null;
        this.voName = null;
    }
    /**
     * @return {?}
     */
    ConvertToJsonObject() {
        /** @type {?} */
        let obj = super.ConvertToJsonObject();
        BpmnModelJsonHelper.SetAttributeValue(obj, "billTrackingSettings", this.billTrackingSettings);
        BpmnModelJsonHelper.SetAttributeValue(obj, "voName", this.voName);
        return obj;
    }
    /**
     * @param {?} obj
     * @return {?}
     */
    LoadFromJsonObject(obj) {
        super.LoadFromJsonObject(obj);
        this.billTrackingSettings = BpmnModelJsonHelper.GetAttributeValueAsString(obj, "billTrackingSettings");
        this.voName = BpmnModelJsonHelper.GetAttributeValueAsString(obj, "voName");
    }
}

/**
 * @fileoverview added by tsickle
 * Generated from: lib/bill-tracker/args/GetChildrenEntityDataArgs.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
class GetChildrenEntityDataArgs extends JsonConvertableImpl {
    /**
     * @protected
     * @return {?}
     */
    ResetBeforeLoadFrom() {
        super.ResetBeforeLoadFrom();
        this.voId = null;
        this.voMetadataId = null;
        this.suCode = null;
        this.nodeCodes = null;
        this.hierachyIdList = null;
    }
    /**
     * @return {?}
     */
    ConvertToJsonObject() {
        /** @type {?} */
        let obj = super.ConvertToJsonObject();
        BpmnModelJsonHelper.SetAttributeValue(obj, "voId", this.voId);
        BpmnModelJsonHelper.SetAttributeValue(obj, "voMetadataId", this.voMetadataId);
        BpmnModelJsonHelper.SetAttributeValue(obj, "suCode", this.suCode);
        BpmnModelJsonHelper.SetAttributeValue(obj, "nodeCodes", BpmnModelJsonHelper.StringListToJson(this.nodeCodes));
        BpmnModelJsonHelper.SetAttributeValue(obj, "hierachyIdList", BpmnModelJsonHelper.StringListToJson(this.hierachyIdList));
        return obj;
    }
    /**
     * @param {?} obj
     * @return {?}
     */
    LoadFromJsonObject(obj) {
        super.LoadFromJsonObject(obj);
        this.voId = BpmnModelJsonHelper.GetAttributeValueAsString(obj, "voId");
        this.voMetadataId = BpmnModelJsonHelper.GetAttributeValueAsString(obj, "voMetadataId");
        this.suCode = BpmnModelJsonHelper.GetAttributeValueAsString(obj, "suCode");
        this.nodeCodes = BpmnModelJsonHelper.StringListFromJson(BpmnModelJsonHelper.GetAttributeValueAsString(obj, "nodeCodes"));
        this.hierachyIdList = BpmnModelJsonHelper.StringListFromJson(BpmnModelJsonHelper.GetAttributeValueAsString(obj, "hierachyIdList"));
    }
}

/**
 * @fileoverview added by tsickle
 * Generated from: lib/bill-tracker/args/DownBillInfoResult.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
class DownBillInfoResult extends DownBillInfo {
    /**
     * @protected
     * @return {?}
     */
    ResetBeforeLoadFrom() {
        super.ResetBeforeLoadFrom();
        this.voName = null;
    }
    /**
     * @return {?}
     */
    ConvertToJsonObject() {
        /** @type {?} */
        let obj = super.ConvertToJsonObject();
        BpmnModelJsonHelper.SetAttributeValue(obj, "voName", this.voName);
        return obj;
    }
    /**
     * @param {?} obj
     * @return {?}
     */
    LoadFromJsonObject(obj) {
        super.LoadFromJsonObject(obj);
        this.voName = BpmnModelJsonHelper.GetAttributeValueAsString(obj, "voName");
    }
}

/**
 * @fileoverview added by tsickle
 * Generated from: lib/bill-tracker/args/EntityDataResult.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
class EntityDataResult extends JsonConvertableImpl {
    /**
     * @protected
     * @return {?}
     */
    ResetBeforeLoadFrom() {
        super.ResetBeforeLoadFrom();
        this.billSchema = null;
        this.billData = null;
    }
    /**
     * @return {?}
     */
    ConvertToJsonObject() {
        /** @type {?} */
        let obj = super.ConvertToJsonObject();
        BpmnModelJsonHelper.SetAttributeValue(obj, "billSchema", this.billSchema);
        BpmnModelJsonHelper.SetAttributeValue(obj, "billData", this.billData);
        return obj;
    }
    /**
     * @param {?} obj
     * @return {?}
     */
    LoadFromJsonObject(obj) {
        super.LoadFromJsonObject(obj);
        this.billSchema = BpmnModelJsonHelper.GetAttributeValueAsJsonSerializable(obj, "billSchema", BillSchema);
        this.billData = BpmnModelJsonHelper.GetAttributeValueAsJsonSerializable(obj, "billData", BillData);
    }
}

/**
 * @fileoverview added by tsickle
 * Generated from: lib/bill-tracker/args/GetEntityDataArgs.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
class GetEntityDataArgs extends JsonConvertableImpl {
    constructor() {
        super(...arguments);
        this.billChildInfos = [];
    }
    /**
     * @protected
     * @return {?}
     */
    ResetBeforeLoadFrom() {
        super.ResetBeforeLoadFrom();
        this.schemaId = null;
        this.dataId = null;
        this.suCode = null;
        this.voMetadataId = null;
        this.billChildInfos = [];
        this.trackingSourceType = null;
        this.curYear = null;
        this.documentTypeId = null;
    }
    /**
     * @return {?}
     */
    ConvertToJsonObject() {
        /** @type {?} */
        let obj = super.ConvertToJsonObject();
        BpmnModelJsonHelper.SetAttributeValue(obj, "schemaId", this.schemaId);
        BpmnModelJsonHelper.SetAttributeValue(obj, "dataId", this.dataId);
        BpmnModelJsonHelper.SetAttributeValue(obj, "suCode", this.suCode);
        BpmnModelJsonHelper.SetAttributeValue(obj, "voMetadataId", this.voMetadataId);
        BpmnModelJsonHelper.SetAttributeValue(obj, "billChildInfos", this.billChildInfos);
        BpmnModelJsonHelper.SetAttributeValue(obj, "trackingSourceType", this.trackingSourceType);
        BpmnModelJsonHelper.SetAttributeValue(obj, "curYear", this.curYear);
        BpmnModelJsonHelper.SetAttributeValue(obj, "documentTypeId", this.documentTypeId);
        return obj;
    }
    /**
     * @param {?} obj
     * @return {?}
     */
    LoadFromJsonObject(obj) {
        super.LoadFromJsonObject(obj);
        this.schemaId = BpmnModelJsonHelper.GetAttributeValueAsString(obj, "schemaId");
        this.dataId = BpmnModelJsonHelper.GetAttributeValueAsString(obj, "dataId");
        this.suCode = BpmnModelJsonHelper.GetAttributeValueAsString(obj, "suCode");
        this.voMetadataId = BpmnModelJsonHelper.GetAttributeValueAsString(obj, "voMetadataId");
        this.billChildInfos = BpmnModelJsonHelper.GetAttributeValueAsList(obj, "billChildInfos", BillChildInfo);
        this.trackingSourceType = BpmnModelJsonHelper.GetAttributeValueAsString(obj, "trackingSourceType");
        this.curYear = BpmnModelJsonHelper.GetAttributeValueAsString(obj, "curYear");
        this.documentTypeId = BpmnModelJsonHelper.GetAttributeValueAsString(obj, "documentTypeId");
    }
}

/**
 * @fileoverview added by tsickle
 * Generated from: lib/bill-tracker/args/GetMainEntityDataArgs.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
class GetMainEntityDataArgs extends GetEntityDataArgs {
}

/**
 * @fileoverview added by tsickle
 * Generated from: lib/bill-tracker/args/UpBillInfoResult.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
class UpBillInfoResult extends UpBillInfo {
    /**
     * @protected
     * @return {?}
     */
    ResetBeforeLoadFrom() {
        super.ResetBeforeLoadFrom();
        this.voName = null;
    }
    /**
     * @return {?}
     */
    ConvertToJsonObject() {
        /** @type {?} */
        let obj = super.ConvertToJsonObject();
        BpmnModelJsonHelper.SetAttributeValue(obj, "voName", this.voName);
        return obj;
    }
    /**
     * @param {?} obj
     * @return {?}
     */
    LoadFromJsonObject(obj) {
        super.LoadFromJsonObject(obj);
        this.voName = BpmnModelJsonHelper.GetAttributeValueAsString(obj, "voName");
    }
}

/**
 * @fileoverview added by tsickle
 * Generated from: lib/bill-tracker/args/GetJointQueryParametersArgs.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
class GetJointQueryParametersArgs extends JsonConvertableImpl {
    constructor() {
        super(...arguments);
        this.contents = [];
    }
    /**
     * @protected
     * @return {?}
     */
    ResetBeforeLoadFrom() {
        super.ResetBeforeLoadFrom();
        this.trackingSourceType = null;
        this.suCode = null;
        this.schemaId = null;
        this.dataId = null;
        this.contents = [];
        this.curYear = null;
    }
    /**
     * @return {?}
     */
    ConvertToJsonObject() {
        /** @type {?} */
        let obj = super.ConvertToJsonObject();
        BpmnModelJsonHelper.SetAttributeValue(obj, "trackingSourceType", this.trackingSourceType);
        BpmnModelJsonHelper.SetAttributeValue(obj, "suCode", this.suCode);
        BpmnModelJsonHelper.SetAttributeValue(obj, "schemaId", this.schemaId);
        BpmnModelJsonHelper.SetAttributeValue(obj, "dataId", this.dataId);
        BpmnModelJsonHelper.SetAttributeValue(obj, "contents", this.contents);
        BpmnModelJsonHelper.SetAttributeValue(obj, "curYear", this.curYear);
        return obj;
    }
    /**
     * @param {?} obj
     * @return {?}
     */
    LoadFromJsonObject(obj) {
        super.LoadFromJsonObject(obj);
        this.trackingSourceType = BpmnModelJsonHelper.GetAttributeValueAsString(obj, "trackingSourceType");
        this.suCode = BpmnModelJsonHelper.GetAttributeValueAsString(obj, "suCode");
        this.schemaId = BpmnModelJsonHelper.GetAttributeValueAsString(obj, "schemaId");
        this.dataId = BpmnModelJsonHelper.GetAttributeValueAsString(obj, "dataId");
        this.contents = BpmnModelJsonHelper.GetAttributeValueAsList(obj, "contents", JointQueryParametersContent);
        this.curYear = BpmnModelJsonHelper.GetAttributeValueAsString(obj, "curYear");
    }
}

/**
 * @fileoverview added by tsickle
 * Generated from: lib/bill-tracker/args/index.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */

/**
 * @fileoverview added by tsickle
 * Generated from: lib/bill-tracker/base/index.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */

/**
 * @fileoverview added by tsickle
 * Generated from: lib/bill-tracker/config/bill-tracker-args.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
class BillTrackerArgs {
    constructor() {
        this.getBillsInfoArgs = null;
        this.canTrackingResult = null;
        this.direction = null;
        this.graphOptions = null;
        this.gridOptions = null;
    }
}
BillTrackerArgs.decorators = [
    { type: Injectable }
];
/** @nocollapse */
BillTrackerArgs.ctorParameters = () => [];

/**
 * @fileoverview added by tsickle
 * Generated from: lib/bill-tracker/config/bill-tracker-constant.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
class BillTrackerConstant {
}
BillTrackerConstant.IMAGE_PATH = "/platform/runtime/common/web/@edp-bif/runtime-api/images";
BillTrackerConstant.DEFAULT_FUNC_ID = "DefaultBillTracker";
BillTrackerConstant.DEFAULT_APP_ID = "BillIntegrationFrameworkRT";
BillTrackerConstant.DEFAULT_APP_ENTRANCE = "default-bill-tracker";
BillTrackerConstant.BILL_VIEWER_FUNC_ID = "BifBillViewer";
BillTrackerConstant.BILL_VIEWER_APP_ID = "BillIntegrationFrameworkRT";
BillTrackerConstant.BILL_VIEWER_APP_ENTRANCE = "bif-bill-viewer";
BillTrackerConstant.BILL_VIEWER_PARAM_CODE_CUSTOM_TAB_NAME = "__tab_name__";

/**
 * @fileoverview added by tsickle
 * Generated from: lib/bill-tracker/config/bill-tracker-module.config.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
class BillTrackerModuleConfig {
}

/**
 * @fileoverview added by tsickle
 * Generated from: lib/bill-tracker/config/bill-tracker-direction.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/** @enum {string} */
const BillTrackerDirection = {
    Down: "Down",
    Up: "Up",
    Both: "Both",
};

/**
 * @fileoverview added by tsickle
 * Generated from: lib/bill-tracker/config/bill-tracker-graph-options.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/**
 * 单据追踪图流程图配置
 */
class BillTrackerGraphOptions {
    constructor() {
        /**
         * 节点宽度
         */
        this.nodeWidth = 100;
        /**
         * 节点高度
         */
        this.nodeHeight = 60;
        /**
         * 上查/下查/上折/下折按钮宽度
         */
        this.overlayWidth = 10;
        /**
         * 上查/下查/上折/下折按钮高度
         */
        this.overlayHeight = 10;
        /**
         * 显示直接关联的下游单据
         */
        this.showDownBills = true;
        /**
         * 显示直接关联的上游单据
         */
        this.showUpBills = true;
    }
}

/**
 * @fileoverview added by tsickle
 * Generated from: lib/bill-tracker/config/bill-tracker-grid-options.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/**
 * 单据追踪数据表配置
 */
class BillTrackerGridOptions {
    constructor() {
        /**
         * 是否显示入口节点数据
         */
        this.showEntryData = true;
        /**
         * 数据区默认高度
         */
        this.defaultHeight = 180;
    }
}

/**
 * @fileoverview added by tsickle
 * Generated from: lib/bill-tracker/config/index.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */

/**
 * @fileoverview added by tsickle
 * Generated from: lib/bill-tracker/mxgraph-ext/GraphView.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
class GraphView extends mxGraphViewType {
    /**
     * @param {?} graph
     */
    constructor(graph) {
        super(graph);
        this.gridSteps = 4;
        this.minGridSize = 4;
        this.gridImage = (mxClientType.IS_SVG) ? 'data:image/gif;base64,R0lGODlhCgAKAJEAAAAAAP///8zMzP///yH5BAEAAAMALAAAAAAKAAoAAAIJ1I6py+0Po2wFADs=' : BillTrackerConstant.IMAGE_PATH + '/grid.gif';
        this.gridColor = '#e0e0e0';
    }
    /**
     * @param {?=} cell
     * @return {?}
     */
    validate(cell) {
        /** @type {?} */
        let graph = (/** @type {?} */ (this.graph));
        if (graph != null && graph.container != null && mxUtilsType.hasScrollbars(graph.container)) {
            /** @type {?} */
            let pad = graph.getPagePadding();
            /** @type {?} */
            let size = graph.getPageSize();
            /** @type {?} */
            let tx = this.translate.x;
            /** @type {?} */
            let ty = this.translate.y;
            this.translate.x = pad.x / this.scale - (this.x0 || 0) * size.width;
            this.translate.y = pad.y / this.scale - (this.y0 || 0) * size.height;
        }
        super.validate(cell);
    }
    /**
     * @return {?}
     */
    getBackgroundPageBounds() {
        /** @type {?} */
        let graph = (/** @type {?} */ (this.graph));
        /** @type {?} */
        let layout = graph.getPageLayout();
        /** @type {?} */
        let page = graph.getPageSize();
        return new mxRectangleType(this.scale * (this.translate.x + layout.x * page.width), this.scale * (this.translate.y + layout.y * page.height), this.scale * layout.width * page.width, this.scale * layout.height * page.height);
    }
}

/**
 * @fileoverview added by tsickle
 * Generated from: lib/bill-tracker/mxgraph-ext/shapes/BillNodeShape.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
class BillNodeShape extends mxRectangleShapeType {
    /**
     * @param {?} bounds
     * @param {?} fill
     * @param {?} stroke
     * @param {?=} strokewidth
     */
    constructor(bounds, fill, stroke, strokewidth) {
        bounds = bounds ? bounds : new mxRectangleType(0, 0, 0, 0);
        fill = fill ? fill : "none";
        stroke = stroke ? stroke : "#000000";
        strokewidth = strokewidth ? strokewidth : undefined;
        super(bounds, fill, stroke, strokewidth);
    }
    /**
     * @param {?} container
     * @return {?}
     */
    init(container) {
        super.init(container);
        this.fill = "none";
        this.stroke = "#000000";
    }
}

/**
 * @fileoverview added by tsickle
 * Generated from: lib/bill-tracker/mxgraph-ext/shapes/BillAssociationLine.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
class BillAssociationLine extends mxLineType {
    /**
     * @param {?} bounds
     * @param {?} stroke
     * @param {?} strokewidth
     */
    constructor(bounds, stroke, strokewidth) {
        super(bounds, stroke, strokewidth);
    }
}

/**
 * @fileoverview added by tsickle
 * Generated from: lib/bill-tracker/mxgraph-ext/Events.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
class Events {
}
Events.RESET_GRAPH_VIEW = "resetGraphView";
Events.CLICK_FIRST_SUMMARY = "clickFirstSummary";
Events.BILL_CELLS_ADDED_AND_MOVED = "billCellsAddedAndMoved";

/**
 * @fileoverview added by tsickle
 * Generated from: lib/bill-tracker/mxgraph-ext/BillCell.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
class BillCell extends mxCellType {
    /**
     * @param {?} billDataInfo
     * @param {?} billInfo
     * @param {?} entry
     * @param {?=} geometry
     * @param {?=} style
     */
    constructor(billDataInfo, billInfo, entry, geometry, style) {
        super(null, geometry, style);
        this.THUMB_SCALE = 0.6;
        this.billDataInfo = billDataInfo;
        this.billInfo = billInfo;
        /** @type {?} */
        let bts = new BillTrackingSettings();
        if (billInfo && billInfo.billTrackingSettings) {
            bts.LoadFromJson(billInfo.billTrackingSettings);
        }
        this.entry = entry;
        // this.value = this.billDataInfo.caption || bts.billNodeName || this.billInfo.voName || this.billDataInfo.dataId || this.billDataInfo.summary;
    }
    /**
     * @return {?}
     */
    getCaption() {
        /** @type {?} */
        let label = null;
        /** @type {?} */
        let bts = new BillTrackingSettings();
        if (this.billInfo && this.billInfo.billTrackingSettings) {
            bts.LoadFromJson(this.billInfo.billTrackingSettings);
        }
        label = this.billDataInfo.caption || bts.billNodeName || this.billInfo.voName || this.billDataInfo.dataId || this.billDataInfo.summary;
        return label;
    }
    /**
     * @return {?}
     */
    buildHtmlTooltip() {
        /** @type {?} */
        const tooltipHtml = `\
            <span>${this.billDataInfo.dataId}</span>\
        `;
        return tooltipHtml;
    }
    /**
     * 样式类在graph组件中定义
     * @param {?} graph
     * @return {?}
     */
    buildHtmlLabel(graph) {
        return this.buildHtmlLabelByDOM(graph);
    }
    /**
     * 通过操纵dom元素方式创建html
     * @private
     * @param {?} graph
     * @return {?}
     */
    buildHtmlLabelByDOM(graph) {
        /** @type {?} */
        const scale = graph.view.scale;
        /** @type {?} */
        const state = graph.view.getState(this);
        /** @type {?} */
        const width = this.geometry.width;
        /** @type {?} */
        const height = this.geometry.height;
        /** @type {?} */
        let bts = new BillTrackingSettings();
        if (this.billInfo && this.billInfo.billTrackingSettings) {
            bts.LoadFromJson(this.billInfo.billTrackingSettings);
        }
        /** @type {?} */
        const title = this.billDataInfo.caption || bts.billNodeName || this.billInfo.voName || this.billDataInfo.dataId || this.billDataInfo.summary;
        /** @type {?} */
        const isEntry = this.entry;
        // 节点框架
        /** @type {?} */
        const divNodeRoot = document.createElement("div");
        divNodeRoot.classList.add("bif-cell-node");
        divNodeRoot.style.width = width + "px";
        divNodeRoot.style.height = height + "px";
        if (isEntry) {
            // 当前节点标识
            /** @type {?} */
            const divNodeCurrent = document.createElement("div");
            divNodeRoot.appendChild(divNodeCurrent);
            divNodeCurrent.classList.add("bif-cell-node-current");
            /** @type {?} */
            const spanCurrent = document.createElement("span");
            divNodeCurrent.appendChild(spanCurrent);
            spanCurrent.classList.add("bif-cell-node-current-text");
            spanCurrent.innerHTML = graph && graph.localePipe && graph.localePipe.transform("currentNode") || "当前";
        }
        // 当比例小到指定值后仅显示单据名
        if (scale < this.THUMB_SCALE) {
            // // 使用图片+标题
            // const divNodeThumb = document.createElement("div");
            // divNodeRoot.appendChild(divNodeThumb);
            // divNodeThumb.classList.add("bif-cell-node-thumb");
            // const divNodeThumbImg = document.createElement("div");
            // divNodeThumb.appendChild(divNodeThumbImg);
            // divNodeThumbImg.classList.add("bif-cell-node-thumb-img-container");
            // const img = document.createElement("img");
            // divNodeThumbImg.appendChild(img);
            // img.classList.add("bif-cell-node-thumb-img");
            // img.src = "/platform/runtime/common/web/@edp-bif/runtime-api/images/non-entry-bill.png";
            // const divNodeThumbTitle = document.createElement("div");
            // divNodeThumb.appendChild(divNodeThumbTitle);
            // divNodeThumbTitle.classList.add("bif-cell-node-thumb-title");
            // const divNodeThumbTitleText = document.createElement("div");
            // divNodeThumbTitle.appendChild(divNodeThumbTitleText);
            // divNodeThumbTitleText.classList.add("bif-cell-node-thumb-title-text");
            // divNodeThumbTitleText.innerHTML = title;
            // // 判断是否需添加点击事件
            // const jqm = this.billInfo.jointQueryMode;
            // const jqp: JointQueryParameters = JSON.parse(this.billInfo.jointQueryParameters);
            // if ((jqm == JointQueryMode.APP && jqp.funcId) || (jqm == JointQueryMode.URL && jqp.url)) {
            //     divNodeThumbTitleText.classList.add("bif-cell-node-title-link");
            //     mxEvent.addListener(divNodeThumbTitleText, "click", () => {
            //         graph.fireEvent(new mxEventObject(Events.CLICK_FIRST_SUMMARY, "cell", this));
            //         event.stopPropagation();
            //         return false;
            //     });
            // }
            // 使用标题
            // 节点标题
            /** @type {?} */
            const divNodeTitleOnly = document.createElement("div");
            divNodeRoot.appendChild(divNodeTitleOnly);
            divNodeTitleOnly.classList.add("bif-cell-node-title-only");
            /** @type {?} */
            const divNodeTitleOnlyText = document.createElement("div");
            divNodeTitleOnly.appendChild(divNodeTitleOnlyText);
            divNodeTitleOnlyText.classList.add("bif-cell-node-title-only-text");
            divNodeTitleOnlyText.innerHTML = title;
            // 判断是否需添加点击事件
            /** @type {?} */
            const jqm = this.billInfo.jointQueryMode;
            /** @type {?} */
            const jqp = JSON.parse(this.billInfo.jointQueryParameters);
            if ((jqm == JointQueryMode.APP && jqp.funcId) || (jqm == JointQueryMode.URL && jqp.url)) {
                divNodeTitleOnlyText.classList.add("bif-cell-node-title-link");
                mxEventType.addListener(divNodeTitleOnlyText, "click", (/**
                 * @return {?}
                 */
                () => {
                    graph.fireEvent(new mxEventObjectType(Events.CLICK_FIRST_SUMMARY, "cell", this));
                    event.stopPropagation();
                    return false;
                }));
            }
        }
        else {
            // 节点主内容
            /** @type {?} */
            const divNodeMain = document.createElement("div");
            divNodeRoot.appendChild(divNodeMain);
            divNodeMain.classList.add("bif-cell-node-main");
            // 节点标题
            /** @type {?} */
            const divNodeTitle = document.createElement("div");
            divNodeMain.appendChild(divNodeTitle);
            divNodeTitle.classList.add("bif-cell-node-title");
            /** @type {?} */
            const divNodeTitleText = document.createElement("div");
            divNodeTitle.appendChild(divNodeTitleText);
            divNodeTitleText.classList.add("bif-cell-node-title-text");
            divNodeTitleText.innerHTML = title;
            divNodeTitleText.title = title;
            // 节点摘要
            /** @type {?} */
            const divNodeSummaryList = document.createElement("div");
            divNodeMain.appendChild(divNodeSummaryList);
            divNodeSummaryList.classList.add("bif-cell-node-summary-list");
            // 46是标题栏高度
            divNodeSummaryList.style.minHeight = (height - 46) + "px";
            try {
                /** @type {?} */
                const fieldNameAndValues = BpmnModelJsonHelper.FromJson(this.billDataInfo.summary, FieldNameAndValue);
                fieldNameAndValues && fieldNameAndValues.forEach((/**
                 * @param {?} fv
                 * @param {?} idx
                 * @return {?}
                 */
                (fv, idx) => {
                    /** @type {?} */
                    const divNodeSummary = document.createElement("div");
                    divNodeSummaryList.appendChild(divNodeSummary);
                    divNodeSummary.classList.add("bif-cell-node-summary");
                    /** @type {?} */
                    const divNodeSummaryCaption = document.createElement("div");
                    divNodeSummary.appendChild(divNodeSummaryCaption);
                    divNodeSummaryCaption.classList.add("bif-cell-node-summary-caption");
                    /** @type {?} */
                    const divNodeSummaryCaptionText = document.createElement("div");
                    divNodeSummaryCaption.appendChild(divNodeSummaryCaptionText);
                    divNodeSummaryCaptionText.classList.add("bif-cell-node-summary-caption-text");
                    divNodeSummaryCaptionText.title = fv.name;
                    divNodeSummaryCaptionText.innerHTML = fv.name;
                    /** @type {?} */
                    const divNodeSummaryValue = document.createElement("div");
                    divNodeSummary.appendChild(divNodeSummaryValue);
                    divNodeSummaryValue.classList.add("bif-cell-node-summary-value");
                    /** @type {?} */
                    const divNodeSummaryValueText = document.createElement("div");
                    divNodeSummaryValue.appendChild(divNodeSummaryValueText);
                    divNodeSummaryValueText.classList.add("bif-cell-node-summary-value-text");
                    divNodeSummaryValueText.title = fv.value;
                    divNodeSummaryValueText.innerText = fv.value;
                    if (idx == 0) {
                        // 判断是否需添加点击事件
                        /** @type {?} */
                        const jqm = this.billInfo.jointQueryMode;
                        /** @type {?} */
                        const jqp = JSON.parse(this.billInfo.jointQueryParameters);
                        if ((jqm == JointQueryMode.APP && jqp.funcId) || (jqm == JointQueryMode.URL && jqp.url)) {
                            divNodeSummaryValueText.classList.add("bif-cell-node-title-link", "bif-cell-node-title-link-color");
                            mxEventType.addListener(divNodeSummaryValueText, "click", (/**
                             * @return {?}
                             */
                            () => {
                                graph.fireEvent(new mxEventObjectType(Events.CLICK_FIRST_SUMMARY, "cell", this));
                                event.stopPropagation();
                                return false;
                            }));
                        }
                    }
                }));
            }
            catch (e) {
                console.error(e);
            }
            // 操作按钮
            /** @type {?} */
            const divNodeBtnGroup = document.createElement("div");
            divNodeMain.appendChild(divNodeBtnGroup);
            divNodeBtnGroup.classList.add("bif-cell-node-btn-group", "bif-cell-node-btn-group-control");
            // 详情按钮
            /** @type {?} */
            const imgView = document.createElement("img");
            divNodeBtnGroup.appendChild(imgView);
            imgView.src = BillTrackerConstant.IMAGE_PATH + "/view.svg";
            imgView.title = graph.localePipe.transform("viewBill");
            imgView.classList.add("bif-cell-node-btn");
            // 点击按钮触发选中事件
            imgView.addEventListener("click", (/**
             * @return {?}
             */
            () => {
                graph.setSelectionCell(this);
            }));
            // 不是当前节点时添加更多按钮
            if (isEntry == false) {
                // 更多按钮
                /** @type {?} */
                const imgMore = document.createElement("img");
                divNodeBtnGroup.appendChild(imgMore);
                imgMore.src = BillTrackerConstant.IMAGE_PATH + "/more.svg";
                imgMore.title = graph.localePipe.transform("more");
                imgMore.classList.add("bif-cell-node-btn");
                mxEventType.addListener(imgMore, mxEventType.CLICK, (/**
                 * @param {?} evt
                 * @return {?}
                 */
                (evt) => {
                    /** @type {?} */
                    const offset = mxUtilsType.getOffset(imgMore);
                    // 移除more hover效果
                    divNodeBtnGroup.classList.remove("bif-cell-node-btn-group-control");
                    // 重写隐藏菜单方法
                    /** @type {?} */
                    const hideMenu = graph.ngComp.morePopupMenu.hideMenu;
                    graph.ngComp.morePopupMenu.hideMenu = (/**
                     * @return {?}
                     */
                    function () {
                        hideMenu.apply(this, arguments);
                        // 重新添加hover效果
                        divNodeBtnGroup.classList.add("bif-cell-node-btn-group-control");
                    });
                    // 弹出菜单
                    graph.ngComp.morePopupMenu.popup(offset.x, offset.y + imgMore.offsetHeight, this, evt);
                    // 更新当前打开菜单对象
                    graph.ngComp.currentMenu = graph.ngComp.morePopupMenu;
                }));
            }
        }
        return divNodeRoot;
    }
    /**
     * 通过模板字符串方式创建html
     * @private
     * @param {?} graph
     * @return {?}
     */
    buildHtmlLabelByTemplateText(graph) {
        /** @type {?} */
        const state = graph.view.getState(this);
        /** @type {?} */
        const width = state && state.width ? state.width : this.geometry.width;
        /** @type {?} */
        const height = state && state.height ? state.height : this.geometry.height;
        /** @type {?} */
        let bts = new BillTrackingSettings();
        if (this.billInfo && this.billInfo.billTrackingSettings) {
            bts.LoadFromJson(this.billInfo.billTrackingSettings);
        }
        /** @type {?} */
        const title = this.billDataInfo.caption || bts.billNodeName || this.billInfo.voName || this.billDataInfo.dataId || this.billDataInfo.summary;
        /** @type {?} */
        const titleBackground = this.entry ? "rgba(86,160,255,0.08)" : "#FFFFFF";
        /** @type {?} */
        let summaryHtml = "";
        try {
            /** @type {?} */
            const fieldNameAndValues = BpmnModelJsonHelper.FromJson(this.billDataInfo.summary, FieldNameAndValue);
            fieldNameAndValues && fieldNameAndValues.forEach((/**
             * @param {?} fv
             * @param {?} idx
             * @return {?}
             */
            (fv, idx) => {
                /** @type {?} */
                let valueText = idx == 0 ? `<a href='javascript:void(0);'>${fv.value}</a>` : fv.value;
                summaryHtml += `\
                        <div class="bif-cell-node-summary">\
                            <div class="bif-cell-node-summary-caption">\
                                <div class="bif-cell-node-summary-caption-text" title="${fv.name}">${fv.name}</div>\
                            </div>\
                            <div class="bif-cell-node-summary-value">\
                                <div class="bif-cell-node-summary-value-text" title="${fv.value}">${valueText}</div>\
                            </div>\
                        </div>\
                    `;
            }));
        }
        catch (e) {
            console.error(e);
        }
        /** @type {?} */
        const html = `\
            <div class="bif-cell-node" style="width:${width}px;">\
                <div class="bif-cell-node-main" style="background: ${titleBackground};">\
                    <div class="bif-cell-node-title">\
                        <div class="bif-cell-node-title-text">${title}</div>\
                    </div>\
                    <div class="bif-cell-node-summary-list" style="min-height: ${height - 30}px;">\
                        ${summaryHtml}\
                    </div>\
                </div>\
            </div>\
        `;
        return html;
    }
}

/**
 * @fileoverview added by tsickle
 * Generated from: lib/bill-tracker/utils/Base64.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
class Base64 {
    /**
     * @param {?} input
     * @param {?} binary
     * @return {?}
     */
    static encode(input, binary) {
        binary = (binary != null) ? binary : false;
        /** @type {?} */
        let output = "";
        /** @type {?} */
        let chr1;
        /** @type {?} */
        let chr2;
        /** @type {?} */
        let chr3;
        /** @type {?} */
        let enc1;
        /** @type {?} */
        let enc2;
        /** @type {?} */
        let enc3;
        /** @type {?} */
        let enc4;
        /** @type {?} */
        let i = 0;
        if (!binary) {
            input = Base64._utf8_encode(input);
        }
        while (i < input.length) {
            chr1 = input.charCodeAt(i++);
            chr2 = input.charCodeAt(i++);
            chr3 = input.charCodeAt(i++);
            enc1 = chr1 >> 2;
            enc2 = ((chr1 & 3) << 4) | (chr2 >> 4);
            enc3 = ((chr2 & 15) << 2) | (chr3 >> 6);
            enc4 = chr3 & 63;
            if (isNaN(chr2)) {
                enc3 = enc4 = 64;
            }
            else if (isNaN(chr3)) {
                enc4 = 64;
            }
            output = output +
                Base64._keyStr.charAt(enc1) + Base64._keyStr.charAt(enc2) +
                Base64._keyStr.charAt(enc3) + Base64._keyStr.charAt(enc4);
        }
        return output;
    }
    /**
     * @param {?} string
     * @return {?}
     */
    static _utf8_encode(string) {
        string = string.replace(/\r\n/g, "\n");
        /** @type {?} */
        let utftext = "";
        for (let n = 0; n < string.length; n++) {
            /** @type {?} */
            let c = string.charCodeAt(n);
            if (c < 128) {
                utftext += String.fromCharCode(c);
            }
            else if ((c > 127) && (c < 2048)) {
                utftext += String.fromCharCode((c >> 6) | 192);
                utftext += String.fromCharCode((c & 63) | 128);
            }
            else {
                utftext += String.fromCharCode((c >> 12) | 224);
                utftext += String.fromCharCode(((c >> 6) & 63) | 128);
                utftext += String.fromCharCode((c & 63) | 128);
            }
        }
        return utftext;
    }
    /**
     * @param {?} input
     * @param {?} binary
     * @return {?}
     */
    static decode(input, binary) {
        binary = (binary != null) ? binary : false;
        /** @type {?} */
        let output = "";
        /** @type {?} */
        let chr1;
        /** @type {?} */
        let chr2;
        /** @type {?} */
        let chr3;
        /** @type {?} */
        let enc1;
        /** @type {?} */
        let enc2;
        /** @type {?} */
        let enc3;
        /** @type {?} */
        let enc4;
        /** @type {?} */
        let i = 0;
        input = input.replace(/[^A-Za-z0-9\+\/\=]/g, "");
        while (i < input.length) {
            enc1 = this._keyStr.indexOf(input.charAt(i++));
            enc2 = this._keyStr.indexOf(input.charAt(i++));
            enc3 = this._keyStr.indexOf(input.charAt(i++));
            enc4 = this._keyStr.indexOf(input.charAt(i++));
            chr1 = (enc1 << 2) | (enc2 >> 4);
            chr2 = ((enc2 & 15) << 4) | (enc3 >> 2);
            chr3 = ((enc3 & 3) << 6) | enc4;
            output = output + String.fromCharCode(chr1);
            if (enc3 != 64) {
                output = output + String.fromCharCode(chr2);
            }
            if (enc4 != 64) {
                output = output + String.fromCharCode(chr3);
            }
        }
        if (!binary) {
            output = Base64._utf8_decode(output);
        }
        return output;
    }
    /**
     * @param {?} utftext
     * @return {?}
     */
    static _utf8_decode(utftext) {
        /** @type {?} */
        let string = "";
        /** @type {?} */
        let i = 0;
        /** @type {?} */
        let c = 0;
        /** @type {?} */
        let c2 = 0;
        /** @type {?} */
        let c3 = 0;
        while (i < utftext.length) {
            c = utftext.charCodeAt(i);
            if (c < 128) {
                string += String.fromCharCode(c);
                i++;
            }
            else if ((c > 191) && (c < 224)) {
                c2 = utftext.charCodeAt(i + 1);
                string += String.fromCharCode(((c & 31) << 6) | (c2 & 63));
                i += 2;
            }
            else {
                c2 = utftext.charCodeAt(i + 1);
                c3 = utftext.charCodeAt(i + 2);
                string += String.fromCharCode(((c & 15) << 12) | ((c2 & 63) << 6) | (c3 & 63));
                i += 3;
            }
        }
        return string;
    }
}
Base64._keyStr = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";

/**
 * @fileoverview added by tsickle
 * Generated from: lib/bill-tracker/mxgraph-ext/VertexHandler.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
class VertexHandler extends mxVertexHandlerType {
    /**
     * @param {?} state
     */
    constructor(state) {
        super(state);
    }
    /**
     * 选中框随节点大小变化
     * @param {?} state
     * @return {?}
     */
    getSelectionBounds(state) {
        return super.getSelectionBounds(state);
    }
    /**
     * 仅显示四个角的调整大小图片
     * @return {?}
     */
    redrawHandles() {
        super.redrawHandles();
        if (this.sizers != null && this.sizers.length > 7) {
            this.sizers[1].node.style.display = 'none';
            this.sizers[3].node.style.display = 'none';
            this.sizers[4].node.style.display = 'none';
            this.sizers[6].node.style.display = 'none';
        }
    }
    /**
     * 创建圆角矩形选中框
     * @param {?} bounds
     * @return {?}
     */
    createSelectionShape(bounds) {
        if (this.state.cell instanceof BillCell) {
            /** @type {?} */
            let shape = new mxRectangleShapeType(mxRectangleType.fromRectangle(bounds), null, this.getSelectionColor());
            shape.strokewidth = this.getSelectionStrokeWidth();
            shape.isDashed = this.isSelectionDashed();
            shape.isRounded = true;
            shape.style = shape.style || [];
            // todo: 直接使用4°并不合理，只是视觉上看起来像，放大至足够大还是有问题
            shape.style[mxConstantsType.STYLE_ARCSIZE] = 4 * this.state.view.scale;
            return shape;
        }
        return super.createSelectionShape(bounds);
    }
}

/**
 * @fileoverview added by tsickle
 * Generated from: lib/bill-tracker/mxgraph-ext/Styles.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
class Styles {
}
Styles.STYLE_BILL_NODE_NAME = "billNode";
Styles.STYLE_BILL_NODE_ENTRY_NAME = "billNodeEntry";
Styles.STYLE_BILL_ASSOCIATION_NAME = "billAssociation";

/**
 * @fileoverview added by tsickle
 * Generated from: lib/bill-tracker/mxgraph-ext/Graph.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
mxCellRendererType.registerShape("billNodeShape", BillNodeShape);
mxCellRendererType.registerShape("billAssociationLine", BillAssociationLine);
class Graph extends mxGraphType {
    /**
     * @param {?=} container
     * @param {?=} model
     * @param {?=} renderHint
     * @param {?=} stylesheet
     */
    constructor(container, model, renderHint, stylesheet) {
        super(container, model, renderHint, stylesheet);
        this.background = '#ffffff';
        // this.newBTS = newBTS;
        this.autoScroll = false;
        this.autoExtend = true;
        this.setCellsResizable(false);
        this.setCellsEditable(false);
        this.setTooltips(false);
        this.setHtmlLabels(true);
        // 节点标签支持拖动
        this.setVertexLabelsMovable(false);
        // 设置不可有悬空连线
        this.setAllowDanglingEdges(false);
        // 定义内置样式
        this.defineInnerStylesNewBTS();
        // 支持画布拖动
        this.setPanning(true);
        this.panningHandler.useLeftButtonForPanning = true;
        this.container.style.cursor = 'grab';
        this.scrollTileSize = new mxRectangleType(0, 0, 400, 400);
        this.addListener(Events.RESET_GRAPH_VIEW, this.resetGraphView);
    }
    /**
     * @return {?}
     */
    createGraphView() {
        return new GraphView(this);
    }
    /**
     * @param {?} state
     * @return {?}
     */
    createVertexHandler(state) {
        return new VertexHandler(state);
    }
    /**
     * @return {?}
     */
    getPagePadding() {
        return new mxPointType(Math.max(0, Math.round(this.container.offsetWidth - 34)), Math.max(0, Math.round(this.container.offsetHeight - 34)));
    }
    /**
     * @return {?}
     */
    getPageSize() {
        return (this.pageVisible) ? new mxRectangleType(0, 0, this.pageFormat.width * this.pageScale, this.pageFormat.height * this.pageScale) : this.getScrollTileSize();
    }
    /**
     * @return {?}
     */
    getPageLayout() {
        /** @type {?} */
        let size = (this.pageVisible) ? this.getPageSize() : this.getScrollTileSize();
        /** @type {?} */
        let bounds = this.getGraphBounds();
        if (bounds.width == 0 || bounds.height == 0) {
            return new mxRectangleType(0, 0, 1, 1);
        }
        else {
            // Computes untransformed graph bounds
            /** @type {?} */
            let x = Math.ceil(bounds.x / this.view.scale - this.view.translate.x);
            /** @type {?} */
            let y = Math.ceil(bounds.y / this.view.scale - this.view.translate.y);
            /** @type {?} */
            let w = Math.floor(bounds.width / this.view.scale);
            /** @type {?} */
            let h = Math.floor(bounds.height / this.view.scale);
            /** @type {?} */
            let x0 = Math.floor(x / size.width);
            /** @type {?} */
            let y0 = Math.floor(y / size.height);
            /** @type {?} */
            let w0 = Math.ceil((x + w) / size.width) - x0;
            /** @type {?} */
            let h0 = Math.ceil((y + h) / size.height) - y0;
            return new mxRectangleType(x0, y0, w0, h0);
        }
    }
    /**
     * @return {?}
     */
    getScrollTileSize() {
        if (this.scrollTileSize == null) {
            this.scrollTileSize = new mxRectangleType(0, 0, 400, 600);
        }
        return this.scrollTileSize;
    }
    /**
     * @param {?} bounds
     * @param {?} width
     * @param {?} height
     * @return {?}
     */
    getPreferredPageSize(bounds, width, height) {
        //scrollTileSize有值后再调用重载实现
        /** @type {?} */
        let pages = this.getPageLayout();
        /** @type {?} */
        let size = this.getPageSize();
        return new mxRectangleType(0, 0, pages.width * size.width, pages.height * size.height);
    }
    /**
     * @return {?}
     */
    sizeDidChange() {
        if (this.container != null && mxUtilsType.hasScrollbars(this.container)) {
            /** @type {?} */
            let pages = this.getPageLayout();
            /** @type {?} */
            let pad = this.getPagePadding();
            /** @type {?} */
            let size = this.getPageSize();
            // Updates the minimum graph size
            /** @type {?} */
            let minw = Math.ceil(2 * pad.x / this.view.scale + pages.width * size.width);
            /** @type {?} */
            let minh = Math.ceil(2 * pad.y / this.view.scale + pages.height * size.height);
            /** @type {?} */
            let min = this.minimumGraphSize;
            // LATER: Fix flicker of scrollbar size in IE quirks mode
            // after delayed call in window.resize event handler
            if (min == null || min.width != minw || min.height != minh) {
                this.minimumGraphSize = new mxRectangleType(0, 0, minw, minh);
            }
            // Updates auto-translate to include padding and graph size
            /** @type {?} */
            let dx = pad.x / this.view.scale - pages.x * size.width;
            /** @type {?} */
            let dy = pad.y / this.view.scale - pages.y * size.height;
            if (!this.autoTranslate && (this.view.translate.x != dx || this.view.translate.y != dy)) {
                this.autoTranslate = true;
                this.view.x0 = pages.x;
                this.view.y0 = pages.y;
                // NOTE: THIS INVOKES THIS METHOD AGAIN. UNFORTUNATELY THERE IS NO WAY AROUND THIS SINCE THE
                // BOUNDS ARE KNOWN AFTER THE VALIDATION AND SETTING THE TRANSLATE TRIGGERS A REVALIDATION.
                // SHOULD MOVE TRANSLATE/SCALE TO VIEW.
                /** @type {?} */
                let tx = this.view.translate.x;
                /** @type {?} */
                let ty = this.view.translate.y;
                this.view.setTranslate(dx, dy);
                this.container.scrollLeft += (dx - tx) * this.view.scale;
                this.container.scrollTop += (dy - ty) * this.view.scale;
                this.autoTranslate = false;
                return;
            }
            //super.sizeDidChange.apply(this, arguments);
            super.sizeDidChange();
        }
    }
    /**
     * @return {?}
     */
    resetGraphView() {
        /** @type {?} */
        let bounds = this.getGraphBounds();
        /** @type {?} */
        let dataRegionHeight = 0;
        if (this.gridOptions.showEntryData) {
            if (typeof this.gridOptions.defaultHeight == "string") {
                dataRegionHeight = 0;
            }
            else {
                dataRegionHeight = this.gridOptions.defaultHeight;
            }
        }
        /** @type {?} */
        let s = Math.min(this.container.clientWidth / bounds.width, (this.container.clientHeight - dataRegionHeight - 20) / bounds.height);
        // 设定最大为1倍
        s = s >= 1 ? 1 : s;
        // 设定最小为0.6倍
        s = s <= 0.6 ? 0.6 : s;
        this.zoomTo(s, true);
        bounds = this.getGraphBounds();
        /** @type {?} */
        let width = Math.max(bounds.width, this.scrollTileSize.width * this.view.scale);
        /** @type {?} */
        let height = Math.max(bounds.height, this.scrollTileSize.height * this.view.scale);
        // this.container.scrollTop = Math.floor(Math.max(0, bounds.y - Math.max(20, (this.container.clientHeight - height) / 4)));
        // this.container.scrollLeft = Math.floor(Math.max(0, bounds.x - Math.max(0, (this.container.clientWidth - width) / 2)));
        this.container.scrollTop = Math.floor(Math.max(0, bounds.y - (this.container.clientHeight - bounds.height) / 2 + 79));
        this.container.scrollLeft = Math.floor(Math.max(0, bounds.x - (this.container.clientWidth - bounds.width) / 2));
    }
    /**
     * @param {?} parent
     * @param {?} id
     * @param {?} billDataInfo
     * @param {?} billInfo
     * @param {?} entry
     * @param {?} x
     * @param {?} y
     * @param {?} width
     * @param {?} height
     * @param {?=} style
     * @param {?=} relative
     * @return {?}
     */
    insertBillCell(parent, id, billDataInfo, billInfo, entry, x, y, width, height, style, relative) {
        /** @type {?} */
        let billCell = this.createBillCell(parent, id, billDataInfo, billInfo, entry, x, y, width, height, style, relative);
        return (/** @type {?} */ (this.addCell(billCell, parent)));
    }
    /**
     * @param {?} parent
     * @param {?} id
     * @param {?} billDataInfo
     * @param {?} billInfo
     * @param {?} entry
     * @param {?} x
     * @param {?} y
     * @param {?} width
     * @param {?} height
     * @param {?=} style
     * @param {?=} relative
     * @return {?}
     */
    createBillCell(parent, id, billDataInfo, billInfo, entry, x, y, width, height, style, relative) {
        /** @type {?} */
        let geometry = new mxGeometryType(x, y, width, height);
        geometry.relative = (relative != null) ? relative : false;
        /** @type {?} */
        let billCell = new BillCell(billDataInfo, billInfo, entry, geometry, style);
        billCell.setId(id);
        billCell.setVertex(true);
        billCell.setConnectable(true);
        return billCell;
    }
    /**
     * @param {?} cell
     * @return {?}
     */
    getTooltipForCell(cell) {
        if (cell instanceof BillCell) {
            return cell.buildHtmlTooltip();
        }
        return super.getTooltipForCell(cell);
    }
    /**
     * @param {?} cell
     * @return {?}
     */
    getLabel(cell) {
        if (cell instanceof BillCell) {
            // if (this.newBTS) {
            return super.getLabel(cell);
            // } else {
            //     return cell.getCaption();
            // }
        }
        return super.getLabel(cell);
    }
    /**
     * @param {?} cell
     * @return {?}
     */
    convertValueToString(cell) {
        if (cell instanceof BillCell) {
            return cell.buildHtmlLabel(this);
        }
        else {
            return super.convertValueToString(cell);
        }
    }
    /**
     * @private
     * @return {?}
     */
    defineInnerStylesNewBTS() {
        //定义单据节点样式
        /** @type {?} */
        let style = Object.assign({}, this.getStylesheet().getDefaultVertexStyle());
        style[mxConstantsType.STYLE_FILLCOLOR] = 'none';
        style[mxConstantsType.STYLE_STROKE_OPACITY] = '0';
        style[mxConstantsType.STYLE_STROKEWIDTH] = '1';
        style[mxConstantsType.STYLE_FONTCOLOR] = 'black';
        style[mxConstantsType.STYLE_FONTSIZE] = '12';
        style[mxConstantsType.STYLE_FONTSTYLE] = '1';
        style[mxConstantsType.STYLE_ROUNDED] = '1';
        style[mxConstantsType.STYLE_SPACING] = 8;
        style[mxConstantsType.STYLE_WHITE_SPACE] = 'wrap';
        // 图片拉伸
        style[mxConstantsType.STYLE_IMAGE_ASPECT] = '0';
        //节点标签显示于节点下方
        style[mxConstantsType.STYLE_PERIMETER] = mxPerimeterType.RectanglePerimeter;
        style[mxConstantsType.STYLE_ALIGN] = mxConstantsType.ALIGN_CENTER;
        style[mxConstantsType.STYLE_VERTICAL_ALIGN] = mxConstantsType.ALIGN_MIDDLE;
        this.getStylesheet().putCellStyle(Styles.STYLE_BILL_NODE_NAME, style);
        //定义开始查询节点样式
        style = Object.assign({}, style);
        this.getStylesheet().putCellStyle(Styles.STYLE_BILL_NODE_ENTRY_NAME, style);
        //定义单据关联连线样式
        style = Object.assign({}, this.getStylesheet().getDefaultEdgeStyle());
        style[mxConstantsType.STYLE_SHAPE] = mxConstantsType.SHAPE_CONNECTOR;
        style[mxConstantsType.STYLE_STROKECOLOR] = '#2A87FF';
        style[mxConstantsType.STYLE_ENDARROW] = mxConstantsType.ARROW_CLASSIC;
        style[mxConstantsType.STYLE_VERTICAL_ALIGN] = mxConstantsType.ALIGN_MIDDLE;
        style[mxConstantsType.STYLE_ALIGN] = mxConstantsType.ALIGN_CENTER;
        style[mxConstantsType.STYLE_EDGE] = mxConstantsType.EDGESTYLE_ELBOW;
        style[mxConstantsType.STYLE_ELBOW] = mxConstantsType.ELBOW_HORIZONTAL;
        style[mxConstantsType.STYLE_STROKEWIDTH] = 1.8;
        style[mxConstantsType.STYLE_DASHED] = 1;
        style[mxConstantsType.STYLE_OPACITY] = 80;
        this.getStylesheet().putCellStyle(Styles.STYLE_BILL_ASSOCIATION_NAME, style);
    }
    /**
     * @param {?} cell
     * @param {?} evt
     * @return {?}
     */
    selectCellForEvent(cell, evt) {
        super.selectCellForEvent(cell, evt);
    }
    /**
     * @return {?}
     */
    createCellRenderer() {
        /** @type {?} */
        const render = super.createCellRenderer();
        // 重写label事件判断方法，解决点击节点操作按钮时如果出现loading则按钮消失的问题
        // note：此改动会使点击节点操作按钮时不触发节点选中事件
        // note: 此改动后，点击节点摘要超链接的监听器中主动触发选中事件
        /** @type {?} */
        const oldIsLabelEvent = render.isLabelEvent;
        render.isLabelEvent = (/**
         * @param {?} state
         * @param {?} evt
         * @return {?}
         */
        (state, evt) => {
            if (state.cell instanceof BillCell) {
                if (evt && evt.target
                    && ((/** @type {?} */ (evt.target))).classList
                    && ((/** @type {?} */ (evt.target))).classList.value
                    && (((/** @type {?} */ (evt.target))).classList.value.includes("bif-cell-node-title-link bif-cell-node-title-link-color")
                        || ((/** @type {?} */ (evt.target))).classList.value.includes("bif-cell-node-btn"))) {
                    return false;
                }
                else {
                    return oldIsLabelEvent.apply(render, [state, evt]);
                }
            }
            return oldIsLabelEvent.apply(render, [state, evt]);
        });
        return render;
    }
    /**
     * @param {?} w
     * @param {?} h
     * @param {?} data
     * @return {?}
     */
    static createSvgImage(w, h, data) {
        /** @type {?} */
        var tmp = unescape(encodeURIComponent('<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">' +
            '<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="' + w + 'px" height="' + h + 'px" ' +
            'version="1.1">' + data + '</svg>'));
        return new mxImageType('data:image/svg+xml;base64,' + ((window.btoa) ? btoa(tmp) : Base64.encode(tmp, true)), w, h);
    }
    /**
     * @return {?}
     */
    destroy() {
        super.destroy();
        this.selectEventEmitter = null;
    }
}
// newBTS: boolean = false;
Graph.handleFill = '#29b6f2';

/**
 * @fileoverview added by tsickle
 * Generated from: lib/bill-tracker/mxgraph-ext/shapes/index.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */

/**
 * @fileoverview added by tsickle
 * Generated from: lib/bill-tracker/mxgraph-ext/CompactTreeLayout.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
class CompactTreeLayout extends mxCompactTreeLayoutType {
    /**
     * @param {?} graph
     * @param {?=} horizontal
     * @param {?=} invert
     */
    constructor(graph, horizontal, invert) {
        super(graph, horizontal, invert);
        this.useBoundingBox = false;
    }
    /**
     * @param {?} cell
     * @param {?} parent
     * @return {?}
     */
    dfs(cell, parent) {
        /** @type {?} */
        let id = mxCellPathType.create(cell);
        /** @type {?} */
        let node = null;
        if (cell != null && this.visited[id] == null && !this.isVertexIgnored(cell)) {
            this.visited[id] = cell;
            node = this.createNode(cell);
            /** @type {?} */
            let model = this.graph.getModel();
            /** @type {?} */
            let prev = null;
            /** @type {?} */
            let out = this.graph.getEdges(cell, parent, this.invert, !this.invert, false, true);
            /** @type {?} */
            let view = this.graph.getView();
            if (this.sortEdges) {
                this.sortOutgoingEdges(cell, out);
            }
            for (let i = 0; i < out.length; i++) {
                /** @type {?} */
                let edge = out[i];
                if (!this.isEdgeIgnored(edge)) {
                    // Resets the points on the traversed edge
                    if (this.resetEdges) {
                        this.setEdgePoints(edge, null);
                    }
                    if (this.edgeRouting) {
                        this.setEdgeStyleEnabled(edge, false);
                        this.setEdgePoints(edge, null);
                    }
                    // Checks if terminal in same swimlane
                    /** @type {?} */
                    let state = view.getState(edge);
                    /** @type {?} */
                    let target = (state != null) ? state.getVisibleTerminal(this.invert) : view.getVisibleTerminal(edge, this.invert);
                    /** @type {?} */
                    let tmp = this.dfs(target, parent);
                    if (tmp != null && model.getGeometry(target) != null) {
                        if (prev == null) {
                            node.child = tmp;
                        }
                        else {
                            prev.next = tmp;
                        }
                        prev = tmp;
                    }
                }
            }
        }
        return node;
    }
    /**
     * @param {?} target
     * @param {?} edges
     * @return {?}
     */
    sortIngoingEdges(target, edges) {
        /** @type {?} */
        let lookup = new mxDictionaryType();
        edges.sort((/**
         * @param {?} e1
         * @param {?} e2
         * @return {?}
         */
        function (e1, e2) {
            /** @type {?} */
            let start1 = e1.getTerminal(e1.getTerminal(true) == target);
            // let end1 = e1.getTerminal(e1.getTerminal(true) == target);
            /** @type {?} */
            let p1 = lookup.get(start1);
            if (p1 == null) {
                p1 = mxCellPathType.create(start1).split(mxCellPathType.PATH_SEPARATOR);
                lookup.put(start1, p1);
            }
            /** @type {?} */
            let start2 = e2.getTerminal(e2.getTerminal(true) == target);
            /** @type {?} */
            let p2 = lookup.get(start2);
            if (p2 == null) {
                p2 = mxCellPathType.create(start2).split(mxCellPathType.PATH_SEPARATOR);
                lookup.put(start2, p2);
            }
            return mxCellPathType.compare(p1, p2);
        }));
    }
    /**
     * @param {?} parent
     * @param {?} root
     * @return {?}
     */
    execute(parent, root) {
        this.parent = parent;
        /** @type {?} */
        let model = this.graph.getModel();
        if (root == null) {
            // Takes the parent as the root if it has outgoing edges
            if (this.graph.getEdges(parent, model.getParent(parent), this.invert, !this.invert, false).length > 0) {
                this.root = parent;
            }
            // Tries to find a suitable root in the parent's
            // children
            else {
                /** @type {?} */
                let roots = this.graph.findTreeRoots(parent, true, this.invert);
                if (roots.length > 0) {
                    for (let i = 0; i < roots.length; i++) {
                        if (!this.isVertexIgnored(roots[i]) &&
                            this.graph.getEdges(roots[i], null, this.invert, !this.invert, false).length > 0) {
                            this.root = roots[i];
                            break;
                        }
                    }
                }
            }
        }
        else {
            this.root = root;
        }
        if (this.root != null) {
            if (this.resizeParent) {
                this.parentsChanged = new Object();
            }
            else {
                this.parentsChanged = null;
            }
            //  Maintaining parent location
            this.parentX = null;
            this.parentY = null;
            if (parent != this.root && model.isVertex(parent) != null && this.maintainParentLocation) {
                /** @type {?} */
                let geo = this.graph.getCellGeometry(parent);
                if (geo != null) {
                    this.parentX = geo.x;
                    this.parentY = geo.y;
                }
            }
            model.beginUpdate();
            try {
                this.visited = {};
                this.node = this.dfs(this.root, parent);
                if (this.alignRanks) {
                    this.maxRankHeight = [];
                    this.findRankHeights(this.node, 0);
                    this.setCellHeights(this.node, 0);
                }
                if (this.node != null) {
                    this.layout(this.node);
                    /** @type {?} */
                    let x0 = this.graph.gridSize;
                    /** @type {?} */
                    let y0 = x0;
                    if (!this.moveTree) {
                        /** @type {?} */
                        let g = this.getVertexBounds(this.root);
                        if (g != null) {
                            x0 = g.x;
                            y0 = g.y;
                        }
                    }
                    /** @type {?} */
                    let bounds = null;
                    if (this.isHorizontal()) {
                        bounds = this.horizontalLayout(this.node, x0, y0);
                    }
                    else {
                        bounds = this.verticalLayout(this.node, null, x0, y0);
                    }
                    if (bounds != null) {
                        /** @type {?} */
                        let dx = 0;
                        /** @type {?} */
                        let dy = 0;
                        // if (bounds.x < 0) {
                        //     dx = Math.abs(x0 - bounds.x);
                        // }
                        // if (bounds.y < 0) {
                        //     dy = Math.abs(y0 - bounds.y);
                        // }
                        if (bounds.x > 0) {
                            dx = -1 * Math.abs(x0 - bounds.x);
                        }
                        if (bounds.y > 0) {
                            dy = -1 * Math.abs(y0 - bounds.y);
                        }
                        if (dx != 0 || dy != 0) {
                            this.moveNode(this.node, dx, dy);
                        }
                        if (this.resizeParent) {
                            this.adjustParents();
                        }
                        if (this.edgeRouting) {
                            // Iterate through all edges setting their positions
                            this.localEdgeProcessing(this.node);
                        }
                    }
                    // Maintaining parent location
                    if (this.parentX != null && this.parentY != null) {
                        /** @type {?} */
                        let geo = this.graph.getCellGeometry(parent);
                        if (geo != null) {
                            geo = geo.clone();
                            geo.x = this.parentX;
                            geo.y = this.parentY;
                            model.setGeometry(parent, geo);
                        }
                    }
                }
            }
            finally {
                model.endUpdate();
            }
        }
    }
    /**
     * @param {?} node
     * @param {?} x0
     * @param {?} y0
     * @param {?=} bounds
     * @return {?}
     */
    horizontalLayout(node, x0, y0, bounds) {
        node.x += x0 + node.offsetX;
        node.y += y0 + node.offsetY;
        bounds = this.apply(node, bounds);
        /** @type {?} */
        let child = node.child;
        if (child != null) {
            bounds = this.horizontalLayout(child, node.x, node.y, bounds);
            /** @type {?} */
            let siblingOffset = node.y + child.offsetY;
            /** @type {?} */
            let s = child.next;
            while (s != null) {
                bounds = this.horizontalLayout(s, node.x + child.offsetX, siblingOffset, bounds);
                siblingOffset += s.offsetY;
                s = s.next;
            }
        }
        return bounds;
    }
}

/**
 * @fileoverview added by tsickle
 * Generated from: lib/bill-tracker/mxgraph-ext/RevertCompactTreeLayout.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
class RevertCompactTreeLayout extends mxCompactTreeLayoutType {
    /**
     * @param {?} graph
     * @param {?=} horizontal
     * @param {?=} invert
     */
    constructor(graph, horizontal, invert) {
        super(graph, horizontal, invert);
        this.useBoundingBox = false;
    }
    /**
     * @param {?} cell
     * @param {?} parent
     * @return {?}
     */
    dfs(cell, parent) {
        /** @type {?} */
        let id = mxCellPathType.create(cell);
        /** @type {?} */
        let node = null;
        if (cell != null && this.visited[id] == null && !this.isVertexIgnored(cell)) {
            this.visited[id] = cell;
            node = this.createNode(cell);
            /** @type {?} */
            let model = this.graph.getModel();
            /** @type {?} */
            let prev = null;
            // let out = this.graph.getEdges(cell, parent, this.invert, !this.invert, false, true);
            /** @type {?} */
            let ins = this.graph.getEdges(cell, parent, !this.invert, this.invert, false, true);
            /** @type {?} */
            let view = this.graph.getView();
            if (this.sortEdges) {
                // this.sortOutgoingEdges(cell, out);
                this.sortIngoingEdges(cell, ins);
            }
            for (let i = 0; i < ins.length; i++) {
                /** @type {?} */
                let edge = ins[i];
                if (!this.isEdgeIgnored(edge)) {
                    // Resets the points on the traversed edge
                    if (this.resetEdges) {
                        this.setEdgePoints(edge, null);
                    }
                    if (this.edgeRouting) {
                        this.setEdgeStyleEnabled(edge, false);
                        this.setEdgePoints(edge, null);
                    }
                    // Checks if terminal in same swimlane
                    /** @type {?} */
                    let state = view.getState(edge);
                    // let target = (state != null) ? state.getVisibleTerminal(this.invert) : view.getVisibleTerminal(edge, this.invert);
                    /** @type {?} */
                    let source = (state != null) ? state.getVisibleTerminal(!this.invert) : view.getVisibleTerminal(edge, !this.invert);
                    /** @type {?} */
                    let tmp = this.dfs(source, parent);
                    if (tmp != null && model.getGeometry(source) != null) {
                        if (prev == null) {
                            node.child = tmp;
                        }
                        else {
                            prev.next = tmp;
                        }
                        prev = tmp;
                    }
                }
            }
        }
        return node;
    }
    /**
     * @param {?} target
     * @param {?} edges
     * @return {?}
     */
    sortIngoingEdges(target, edges) {
        /** @type {?} */
        let lookup = new mxDictionaryType();
        edges.sort((/**
         * @param {?} e1
         * @param {?} e2
         * @return {?}
         */
        function (e1, e2) {
            /** @type {?} */
            let start1 = e1.getTerminal(e1.getTerminal(true) == target);
            // let end1 = e1.getTerminal(e1.getTerminal(true) == target);
            /** @type {?} */
            let p1 = lookup.get(start1);
            if (p1 == null) {
                p1 = mxCellPathType.create(start1).split(mxCellPathType.PATH_SEPARATOR);
                lookup.put(start1, p1);
            }
            /** @type {?} */
            let start2 = e2.getTerminal(e2.getTerminal(true) == target);
            /** @type {?} */
            let p2 = lookup.get(start2);
            if (p2 == null) {
                p2 = mxCellPathType.create(start2).split(mxCellPathType.PATH_SEPARATOR);
                lookup.put(start2, p2);
            }
            return mxCellPathType.compare(p1, p2);
        }));
    }
    /**
     * @param {?} parent
     * @param {?} dest
     * @return {?}
     */
    execute(parent, dest) {
        this.parent = parent;
        /** @type {?} */
        let model = this.graph.getModel();
        if (dest == null) {
            // Takes the parent as the root if it has outgoing edges
            if (this.graph.getEdges(parent, model.getParent(parent), !this.invert, this.invert, false).length > 0) {
                this.root = parent;
            }
            // Tries to find a suitable root in the parent's
            // children
            else {
                /** @type {?} */
                let dests = this.graph.findTreeRoots(parent, true, true);
                if (dests.length > 0) {
                    for (let i = 0; i < dests.length; i++) {
                        if (!this.isVertexIgnored(dests[i]) &&
                            this.graph.getEdges(dests[i], null, !this.invert, this.invert, false).length > 0) {
                            this.root = dests[i];
                            break;
                        }
                    }
                }
            }
        }
        else {
            this.root = dest;
        }
        if (this.root != null) {
            if (this.resizeParent) {
                this.parentsChanged = new Object();
            }
            else {
                this.parentsChanged = null;
            }
            //  Maintaining parent location
            this.parentX = null;
            this.parentY = null;
            if (parent != this.root && model.isVertex(parent) != null && this.maintainParentLocation) {
                /** @type {?} */
                let geo = this.graph.getCellGeometry(parent);
                if (geo != null) {
                    this.parentX = geo.x;
                    this.parentY = geo.y;
                }
            }
            model.beginUpdate();
            try {
                this.visited = {};
                this.node = this.dfs(this.root, parent);
                if (this.alignRanks) {
                    this.maxRankHeight = [];
                    this.findRankHeights(this.node, 0);
                    this.setCellHeights(this.node, 0);
                }
                if (this.node != null) {
                    this.layout(this.node);
                    /** @type {?} */
                    let x0 = this.graph.gridSize;
                    /** @type {?} */
                    let y0 = x0;
                    if (!this.moveTree) {
                        /** @type {?} */
                        let g = this.getVertexBounds(this.root);
                        if (g != null) {
                            x0 = g.x;
                            y0 = g.y;
                        }
                    }
                    /** @type {?} */
                    let bounds = null;
                    if (this.isHorizontal()) {
                        bounds = this.horizontalLayout(this.node, -x0, y0);
                    }
                    else {
                        bounds = this.verticalLayout(this.node, null, x0, y0);
                    }
                    if (bounds != null) {
                        /** @type {?} */
                        let dx = 0;
                        /** @type {?} */
                        let dy = 0;
                        if (bounds.x > 0) {
                            dx = -1 * Math.abs(x0 - bounds.x);
                        }
                        if (bounds.y > 0) {
                            dy = -1 * Math.abs(y0 - bounds.y);
                        }
                        if (dx != 0 || dy != 0) {
                            this.moveNode(this.node, dx, dy);
                        }
                        if (this.resizeParent) {
                            this.adjustParents();
                        }
                        if (this.edgeRouting) {
                            // Iterate through all edges setting their positions
                            this.localEdgeProcessing(this.node);
                        }
                    }
                    // Maintaining parent location
                    if (this.parentX != null && this.parentY != null) {
                        /** @type {?} */
                        let geo = this.graph.getCellGeometry(parent);
                        if (geo != null) {
                            geo = geo.clone();
                            geo.x = this.parentX;
                            geo.y = this.parentY;
                            model.setGeometry(parent, geo);
                        }
                    }
                }
            }
            finally {
                model.endUpdate();
            }
        }
    }
    /**
     * @param {?} node
     * @param {?} x0
     * @param {?} y0
     * @param {?=} bounds
     * @return {?}
     */
    horizontalLayout(node, x0, y0, bounds) {
        node.x += x0 - node.offsetX;
        node.y += y0 + node.offsetY;
        bounds = this.apply(node, bounds);
        /** @type {?} */
        var child = node.child;
        if (child != null) {
            bounds = this.horizontalLayout(child, node.x, node.y, bounds);
            /** @type {?} */
            var siblingOffset = node.y + child.offsetY;
            /** @type {?} */
            var s = child.next;
            while (s != null) {
                bounds = this.horizontalLayout(s, node.x - child.offsetX, siblingOffset, bounds);
                siblingOffset += s.offsetY;
                s = s.next;
            }
        }
        return bounds;
    }
}

/**
 * @fileoverview added by tsickle
 * Generated from: lib/bill-tracker/mxgraph-ext/CellOverlayState.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/** @enum {string} */
const CellOverlayState = {
    Search: "Search",
    Fold: "Fold",
};

/**
 * @fileoverview added by tsickle
 * Generated from: lib/bill-tracker/mxgraph-ext/CellOverlay.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
class CellOverlay extends mxCellOverlayType {
    /**
     * @param {?} image
     * @param {?=} tooltip
     * @param {?=} align
     * @param {?=} verticalAlign
     * @param {?=} offset
     * @param {?=} cursor
     * @param {?=} state
     */
    constructor(image, tooltip, align, verticalAlign, offset, cursor, state) {
        super(image, tooltip, align, verticalAlign, offset, cursor);
        this.state = state || CellOverlayState.Search;
    }
}

/**
 * @fileoverview added by tsickle
 * Generated from: lib/bill-tracker/mxgraph-ext/Outline.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
class Outline extends mxOutlineType {
    /**
     * @param {?} source
     * @param {?=} container
     */
    constructor(source, container) {
        super(source, container);
    }
    /**
     * @param {?} container
     * @return {?}
     */
    createGraph(container) {
        /** @type {?} */
        const graph = new mxGraphType(container, this.source.getModel(), this.graphRenderHint);
        graph.foldingEnabled = false;
        graph.autoScroll = false;
        // 深拷贝并扩展source的stylesheet
        this.extendStyleSheets(graph, this.source);
        return graph;
    }
    /**
     * 深拷贝并扩展source的stylesheet
     * 默认设定样式节点无填充色，在缩略图中添加填充色
     * @param {?} graph
     * @param {?} source
     * @return {?}
     */
    extendStyleSheets(graph, source) {
        /** @type {?} */
        let style = Object.assign({}, source.getStylesheet().getCellStyle(Styles.STYLE_BILL_NODE_NAME, source.getStylesheet().getDefaultVertexStyle()));
        style[mxConstantsType.STYLE_FILLCOLOR] = '#2A87FF';
        graph.getStylesheet().putCellStyle(Styles.STYLE_BILL_NODE_NAME, style);
        style = Object.assign({}, source.getStylesheet().getCellStyle(Styles.STYLE_BILL_NODE_ENTRY_NAME, source.getStylesheet().getDefaultVertexStyle()));
        style[mxConstantsType.STYLE_FILLCOLOR] = '#F5A144';
        graph.getStylesheet().putCellStyle(Styles.STYLE_BILL_NODE_ENTRY_NAME, style);
        style = Object.assign({}, source.getStylesheet().getCellStyle(Styles.STYLE_BILL_ASSOCIATION_NAME, source.getStylesheet().getDefaultEdgeStyle()));
        graph.getStylesheet().putCellStyle(Styles.STYLE_BILL_ASSOCIATION_NAME, style);
    }
}

/**
 * @fileoverview added by tsickle
 * Generated from: lib/bill-tracker/mxgraph-ext/index.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */

/**
 * @fileoverview added by tsickle
 * Generated from: lib/bill-tracker/index.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */

/**
 * @fileoverview added by tsickle
 * Generated from: lib/bill-tracker/services/bill-tracker-data.service.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
class BillTrackerDataService {
    /**
     * @param {?} httpService
     * @param {?} httpClient
     */
    constructor(httpService, httpClient) {
        this.httpService = httpService;
        this.httpClient = httpClient;
        this.baseUrl = "/api/runtime/aif/v1.0/billtracking";
        this.canTrackingUrl = this.baseUrl + "/cantracking";
        this.canTrackingMethod = "POST";
        this.getDownBillsInfoUrl = this.baseUrl + "/getdownbillsinfo";
        this.getDownBillsInfoMethod = "POST";
        this.getUpBillsInfoUrl = this.baseUrl + "/getupbillsinfo";
        this.getUpBillsInfoMethod = "POST";
        this.getEntityDataUrl = this.baseUrl + "/getentitydata";
        this.getEntityDataMethod = "POST";
        this.jointQueryParserUrl = "/api/runtime/aif/v1.0/jointquery";
        this.jointQueryParserMethod = "POST";
    }
    /**
     * @param {?} args
     * @return {?}
     */
    getJointQueryParameters(args) {
        /** @type {?} */
        const body = args.ConvertToJson();
        /** @type {?} */
        const opt = this.httpService.setHeader({ body: body });
        return this.httpService.request(this.jointQueryParserMethod, this.jointQueryParserUrl, opt).pipe(switchMap((/**
         * @param {?} res
         * @return {?}
         */
        (res) => {
            /** @type {?} */
            let obj = res;
            /** @type {?} */
            const results = (/** @type {?} */ (BpmnModelJsonHelper.FromJson(obj.value, JointQueryParameterResult)));
            return of(results);
        })), catchError((/**
         * @param {?} err
         * @return {?}
         */
        (err) => {
            try {
                if (typeof err.error == "string") {
                    err.error = JSON.parse(err.error);
                }
            }
            catch (e) {
            }
            throw err;
        })));
    }
    /**
     * @param {?} args
     * @return {?}
     */
    canTracking(args) {
        /** @type {?} */
        const opt = this.httpService.setHeader({ body: args.ConvertToJson(), responseType: "text" });
        return this.httpService.request(this.canTrackingMethod, this.canTrackingUrl, opt).pipe(switchMap((/**
         * @param {?} res
         * @return {?}
         */
        (res) => {
            /** @type {?} */
            let result = new CanTrackingResult();
            result.LoadFromJson(res);
            return of(result);
        })), catchError((/**
         * @param {?} err
         * @return {?}
         */
        (err) => {
            try {
                if (typeof err.error == "string") {
                    err.error = JSON.parse(err.error);
                }
            }
            catch (e) {
            }
            throw err;
        })));
    }
    /**
     * @param {?} args
     * @return {?}
     */
    getDownBillsInfo(args) {
        /** @type {?} */
        const opt = this.httpService.setHeader({ body: args.ConvertToJson(), responseType: "text" });
        return this.httpService.request(this.getDownBillsInfoMethod, this.getDownBillsInfoUrl, opt).pipe(switchMap((/**
         * @param {?} res
         * @return {?}
         */
        (res) => {
            /** @type {?} */
            let result = BpmnModelJsonHelper.FromJson(res, DownBillInfoResult);
            return of(result);
        })), catchError((/**
         * @param {?} err
         * @return {?}
         */
        (err) => {
            try {
                if (typeof err.error == "string") {
                    err.error = JSON.parse(err.error);
                }
            }
            catch (e) {
            }
            throw err;
        })));
    }
    /**
     * @param {?} args
     * @return {?}
     */
    getUpBillsInfo(args) {
        /** @type {?} */
        const opt = this.httpService.setHeader({ body: args.ConvertToJson(), responseType: "text" });
        return this.httpService.request(this.getUpBillsInfoMethod, this.getUpBillsInfoUrl, opt).pipe(switchMap((/**
         * @param {?} res
         * @return {?}
         */
        (res) => {
            /** @type {?} */
            let result = BpmnModelJsonHelper.FromJson(res, UpBillInfoResult);
            return of(result);
        })), catchError((/**
         * @param {?} err
         * @return {?}
         */
        (err) => {
            try {
                if (typeof err.error == "string") {
                    err.error = JSON.parse(err.error);
                }
            }
            catch (e) {
            }
            throw err;
        })));
    }
    /**
     * @param {?} args
     * @return {?}
     */
    getEntityData(args) {
        /** @type {?} */
        const opt = this.httpService.setHeader({ body: args.ConvertToJson(), responseType: "text" });
        return this.httpService.request(this.getEntityDataMethod, this.getEntityDataUrl, opt).pipe(switchMap((/**
         * @param {?} res
         * @return {?}
         */
        (res) => {
            /** @type {?} */
            const result = new EntityDataResult();
            result.LoadFromJson(res);
            return of(result);
        })), catchError((/**
         * @param {?} err
         * @return {?}
         */
        (err) => {
            try {
                if (typeof err.error == "string") {
                    err.error = JSON.parse(err.error);
                }
            }
            catch (e) {
            }
            throw err;
        })));
    }
    /**
     * @param {?} canTrackingResult
     * @return {?}
     */
    buildEntryBillInfo(canTrackingResult) {
        /** @type {?} */
        const info = new DownBillInfoResult();
        info.schemaId = canTrackingResult.schemaId;
        info.suCode = canTrackingResult.suCode;
        info.voName = canTrackingResult.voName;
        info.billTrackingSettings = canTrackingResult.billTrackingSettings;
        info.bizKind = canTrackingResult.bizKind;
        info.bizType = canTrackingResult.bizType;
        info.jointQueryMode = canTrackingResult.jointQueryMode;
        info.jointQueryParameters = canTrackingResult.jointQueryParameters;
        info.trackingSourceType = canTrackingResult.trackingSourceType;
        /** @type {?} */
        const dataInfo = new BillDataInfo();
        dataInfo.caption = canTrackingResult.caption;
        dataInfo.dataId = canTrackingResult.dataId;
        dataInfo.summary = canTrackingResult.summary;
        dataInfo.trackingMappingAssociations = [];
        dataInfo.billChildInfos = canTrackingResult.billChildInfos;
        dataInfo.curYear = canTrackingResult.curYear;
        info.billDataInfos = [dataInfo];
        info.documentTypeId = canTrackingResult.documentTypeId;
        return info;
    }
    /**
     * @param {?} cell
     * @return {?}
     */
    buildGetBillsInfoArgs(cell) {
        /** @type {?} */
        const args = new GetBillsInfoArgs();
        args.billDataId = cell.billDataInfo.dataId;
        args.documentTypeId = cell.billInfo.documentTypeId;
        args.bizKind = cell.billInfo.bizKind;
        args.bizType = cell.billInfo.bizType;
        args.billChildInfos = cell.billDataInfo.billChildInfos;
        args.curYear = cell.billDataInfo.curYear;
        return args;
    }
    /**
     * @param {?} cell
     * @return {?}
     */
    buildGetUpBillsInfoArgs(cell) {
        /** @type {?} */
        const args = new GetUpBillsInfoArgs();
        args.LoadFromJsonObject(this.buildGetBillsInfoArgs(cell).ConvertToJsonObject());
        return args;
    }
    /**
     * @param {?} cell
     * @return {?}
     */
    buildGetDownBillsInfoArgs(cell) {
        /** @type {?} */
        const args = new GetDownBillsInfoArgs();
        args.LoadFromJsonObject(this.buildGetBillsInfoArgs(cell).ConvertToJsonObject());
        return args;
    }
    /**
     * @param {?} billInfo
     * @param {?} billDataInfo
     * @return {?}
     */
    buildGetMainEntityDataArgs(billInfo, billDataInfo) {
        /** @type {?} */
        const args = new GetMainEntityDataArgs();
        args.dataId = billDataInfo.dataId;
        args.suCode = billInfo.suCode;
        args.schemaId = billInfo.schemaId;
        args.trackingSourceType = billInfo.trackingSourceType;
        args.billChildInfos = billDataInfo.billChildInfos;
        args.curYear = billDataInfo.curYear;
        args.documentTypeId = billInfo.documentTypeId;
        return args;
    }
    /**
     * @param {?} jointQueryParameters
     * @return {?}
     */
    hasDynamicParams(jointQueryParameters) {
        if (!jointQueryParameters.params) {
            return false;
        }
        // 添加自定义参数
        if (Array.isArray(jointQueryParameters.params)) {
            return jointQueryParameters.params.find((/**
             * @param {?} p
             * @return {?}
             */
            (p) => p.type != JointQueryParameterType.Constant)) != null;
        }
        else {
            return false;
        }
    }
    /**
     * 构造联查参数解析器参数
     * @param {?} jointQueryParameters
     * @param {?} billInfo
     * @param {?} billDataInfo
     * @return {?}
     */
    buildGetJointQueryParametersArgs(jointQueryParameters, billInfo, billDataInfo) {
        /** @type {?} */
        const args = new GetJointQueryParametersArgs();
        args.dataId = billDataInfo.dataId;
        args.suCode = billInfo.suCode;
        args.schemaId = billInfo.schemaId;
        args.trackingSourceType = billInfo.trackingSourceType;
        args.curYear = billDataInfo.curYear;
        args.contents = [];
        if (Array.isArray(jointQueryParameters.params)) {
            jointQueryParameters.params.forEach((/**
             * @param {?} it
             * @return {?}
             */
            it => {
                if (it.type == JointQueryParameterType.Constant) {
                    return;
                }
                /** @type {?} */
                const jointQueryParametersContent = new JointQueryParametersContent();
                if (it.type == JointQueryParameterType.Field) {
                    jointQueryParametersContent.jointQueryParameterMode = JointQueryParameterMode.FIELD;
                    /** @type {?} */
                    const content = new FieldJointQueryParameterContent();
                    content.parameterCode = it.code;
                    content.fieldContent = it.value;
                    jointQueryParametersContent.content = content.ConvertToJson();
                }
                else if (it.type == JointQueryParameterType.Expression) {
                    jointQueryParametersContent.jointQueryParameterMode = JointQueryParameterMode.EXPRESSION;
                    /** @type {?} */
                    const content = new ExpressionJointQueryParameterContent();
                    content.parameterCode = it.code;
                    content.expressionContent = it.value;
                    jointQueryParametersContent.content = content.ConvertToJson();
                }
                args.contents.push(jointQueryParametersContent);
            }));
        }
        return args;
    }
}
BillTrackerDataService.decorators = [
    { type: Injectable }
];
/** @nocollapse */
BillTrackerDataService.ctorParameters = () => [
    { type: HttpService },
    { type: HttpClient }
];

/**
 * @fileoverview added by tsickle
 * Generated from: lib/bill-tracker/i18n/lang.resource.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/** @type {?} */
const BILL_TRACKER_LANG_RESOURCES = {
    "zh-CHS": {
        "billTracker": "单据追踪",
        "noAssoBill": "没有关联的业务单据",
        "modalOptionsCantBeEmpty": "模态框配置不可为空",
        "downSearch": "下查",
        "upSearch": "上查",
        "folder": "折叠",
        "caption": "标题",
        "summary": "摘要",
        "basicInfo": "基本信息",
        "lineNumber": "序号",
        "childData": "明细",
        "selectOneFirst": "请先选择一条数据",
        "noChildData": "没有明细数据",
        "zoomIn": "放大（Ctrl+滚轮）",
        "zoomOut": "缩小（Ctrl+滚轮）",
        "zoomReset": "还原",
        "print": "打印",
        "expandUp": "向上展开",
        "expandUpAll": "向上展开全部",
        "expandDown": "向下展开",
        "expandDownAll": "向下展开全部",
        "loading": "正在加载",
        "yes": "是",
        "no": "否",
        "currentNode": "当前",
        "goOnTracking": "穿透追踪",
        "setAsCurrent": "设为当前",
        "viewBill": "查看详情",
        "more": "更多",
        "tabNameLengthIsTooLong": "页签名称超长，取前200个字符显示",
        "scaleFieldCantBeCastToInteger": "精度字段无法被转换为整型",
        "trackerArgsCantBeEmpty": "参数【单据Id或者单据查询参数】不可为空",
    },
    "en": {
        "billTracker": "Bill Tracker",
        "noAssoBill": "There is no associated business bill.",
        "modalOptionsCantBeEmpty": "Modal options cant be empty",
        "downSearch": "Down search",
        "upSearch": "Up search",
        "folder": "Folder",
        "caption": "Caption",
        "summary": "Summary",
        "basicInfo": "Basic Information",
        "lineNumber": "No",
        "childData": "Detail",
        "selectOneFirst": "Please select an item at first",
        "noChildData": "No detail data",
        "zoomIn": "Zoom In(Ctrl+MouseWheel)",
        "zoomOut": "Zoom Out(Ctrl+MouseWheel)",
        "zoomReset": "Zoom Reset",
        "print": "Print",
        "expandUp": "Expand Upward",
        "expandUpAll": "Expand All Upward",
        "expandDown": "Expand Downward",
        "expandDownAll": "Expand All Downward",
        "loading": "Loading...",
        "yes": "Yes",
        "no": "No",
        "currentNode": "Entry",
        "goOnTracking": "Go on",
        "setAsCurrent": "Set as current",
        "viewBill": "View Detail",
        "more": "More",
        "tabNameLengthIsTooLong": "The tab name is too long and displayed with the first 200 characters",
        "scaleFieldCantBeCastToInteger": "Precision field cannot be converted to integers",
        "trackerArgsCantBeEmpty": "The parameter \"args\" can't be empty",
    },
    "zh-CHT": {
        "billTracker": "單據追蹤",
        "noAssoBill": "沒有關聯的業務單據",
        "modalOptionsCantBeEmpty": "模態框配置不可為空",
        "downSearch": "下查",
        "upSearch": "上查",
        "folder": "折疊",
        "caption": "標題",
        "summary": "摘要",
        "basicInfo": "基本信息",
        "lineNumber": "序號",
        "childData": "明細",
        "selectOneFirst": "請先選擇壹條數據",
        "noChildData": "沒有明細數據",
        "zoomIn": "放大（Ctrl+滾輪）",
        "zoomOut": "縮小（Ctrl+滾輪）",
        "zoomReset": "還原",
        "print": "打印",
        "expandUp": "向上展開",
        "expandUpAll": "向上展開全部",
        "expandDown": "向下展開",
        "expandDownAll": "向下展開全部",
        "loading": "正在加載",
        "yes": "是",
        "no": "否",
        "currentNode": "當前",
        "goOnTracking": "穿透追蹤",
        "setAsCurrent": "設爲當前",
        "viewBill": "查看詳情",
        "more": "更多",
        "tabNameLengthIsTooLong": "頁簽名稱超長，取前200個字符顯示",
        "scaleFieldCantBeCastToInteger": "精度字段無法被轉換爲整型",
        "trackerArgsCantBeEmpty": "參數【單據Id或者單據查詢參數】不可爲空",
    }
};

/**
 * @fileoverview added by tsickle
 * Generated from: lib/bill-tracker/pipe/bill-tracker-locale.pipe.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
class BillTrackerLocalePipe {
    /**
     * @param {?} localeId
     */
    constructor(localeId) {
        this.defaultLang = "zh-CHS";
        this.langCode = localeId || this.defaultLang;
        this.lang = BILL_TRACKER_LANG_RESOURCES[this.langCode] || BILL_TRACKER_LANG_RESOURCES[this.defaultLang];
    }
    /**
     * @param {?} name
     * @return {?}
     */
    transform(name) {
        return this.lang[name] || name;
    }
}
BillTrackerLocalePipe.decorators = [
    { type: Pipe, args: [{ name: 'billTrackerLocale' },] }
];
/** @nocollapse */
BillTrackerLocalePipe.ctorParameters = () => [
    { type: String, decorators: [{ type: Inject, args: [LOCALE_ID,] }] }
];

/**
 * @fileoverview added by tsickle
 * Generated from: lib/entity/tracking/cell-data/CellData.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
class CellData {
    constructor() {
        this.diagramInfo = {
            x: null,
            y: null,
            width: null,
            height: null,
            extProps: {}
        };
    }
}

/**
 * @fileoverview added by tsickle
 * Generated from: lib/entity/tracking/cell-data/EntryCellData.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
class EntryCellData extends CellData {
    constructor() {
        super(...arguments);
        this.ups = [];
        this.downs = [];
    }
}

/**
 * @fileoverview added by tsickle
 * Generated from: lib/entity/tracking/cell-data/UpCellData.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
class UpCellData extends CellData {
    constructor() {
        super(...arguments);
        this.ups = [];
    }
}

/**
 * @fileoverview added by tsickle
 * Generated from: lib/entity/tracking/cell-data/DownCellData.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
class DownCellData extends CellData {
    constructor() {
        super(...arguments);
        this.downs = [];
    }
}

/**
 * @fileoverview added by tsickle
 * Generated from: lib/bill-tracker/services/bill-tracker-data-info.service.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
class BillTrackerDataInfoService {
    /**
     * 判断BillTrackingSettings是旧版还是新版
     * @param {?} bts
     * @return {?}
     */
    isNewBTS(bts) {
        if (typeof bts == "string") {
            /** @type {?} */
            const temp = new BillTrackingSettings();
            temp.LoadFromJson(bts);
            bts = temp;
        }
        return bts != null && bts.version === "1.0";
    }
    /**
     * @param {?} rows
     * @param {?} shownFields
     * @param {?} wholeFields
     * @param {?} idField
     * @return {?}
     */
    extractDataRows(rows, shownFields, wholeFields, idField) {
        /** @type {?} */
        let frows = [];
        for (let row of rows) {
            /** @type {?} */
            let obj = {};
            obj[idField] = row.dataId;
            // 先解析其他类型字段
            /** @type {?} */
            const decimalFFs = [];
            shownFields.forEach((/**
             * @param {?} f
             * @return {?}
             */
            f => {
                if (f.dataType == DataType.Decimal) {
                    decimalFFs.push(f);
                }
                else {
                    obj[f.fieldPath] = this.getFieldValue(f, row.GetFieldMap(), wholeFields);
                }
            }));
            // 再解析浮点型字段
            decimalFFs.forEach((/**
             * @param {?} f
             * @return {?}
             */
            f => {
                obj[f.fieldPath] = this.getFieldValue(f, row.GetFieldMap(), wholeFields);
            }));
            frows.push(obj);
        }
        return frows;
    }
    /**
     * @param {?} field
     * @return {?}
     */
    extractCaptionPath(field) {
        /** @type {?} */
        let s = field.caption;
        /** @type {?} */
        let tmp = (/** @type {?} */ (field));
        while (tmp.attachedField != null) {
            s = tmp.attachedField.caption + "." + s;
            tmp = (/** @type {?} */ (tmp.attachedField));
        }
        return s;
    }
    /**
     * @param {?} field
     * @return {?}
     */
    extractFieldPath(field) {
        /** @type {?} */
        let s = field.fieldName;
        /** @type {?} */
        let tmp = (/** @type {?} */ (field));
        while (tmp.attachedField != null) {
            s = tmp.attachedField.fieldName + "." + s;
            tmp = (/** @type {?} */ (tmp.attachedField));
        }
        return s;
    }
    /**
     *
     * @param {?} fields 子字段列表
     * @param {?} selectedFields 用户自定义展示字段列表
     * @param {?} showCustomFields 是否按用户自定义字段显示
     * @return {?}
     */
    extractFFields(fields, selectedFields, showCustomFields) {
        /** @type {?} */
        let ffields = [];
        fields.forEach((/**
         * @param {?} f
         * @return {?}
         */
        f => {
            f.show = true;
            //枚举或者枚举型单值UDT时默认取Name
            if (f.fieldType == "Enum" || f.fieldType == "EnumSingleUdt") {
                /** @type {?} */
                const tempFPath = this.extractFieldPath(f);
                /** @type {?} */
                let sf = null;
                if (showCustomFields) {
                    // 如果字段不在已配置字段列表中则跳过
                    sf = selectedFields.find((/**
                     * @param {?} sfield
                     * @return {?}
                     */
                    (sfield) => sfield.fieldPath == tempFPath));
                    if (sf == null) {
                        f.show = false;
                    }
                }
                f = (/** @type {?} */ (this.setExtendProps(f, sf, tempFPath + ".Name")));
                ffields.push(f);
            }
            else if (f.GetSubFieldList() != null && f.GetSubFieldList().length > 0) {
                ffields.push(...this.extractFFields(f.GetSubFieldList(), selectedFields, showCustomFields));
            }
            else {
                /** @type {?} */
                const tempFPath = this.extractFieldPath(f);
                /** @type {?} */
                let sf = null;
                if (showCustomFields) {
                    // 如果字段不在已配置字段列表中则跳过
                    sf = selectedFields.find((/**
                     * @param {?} sfield
                     * @return {?}
                     */
                    (sfield) => sfield.fieldPath == tempFPath));
                    if (sf == null) {
                        f.show = false;
                    }
                }
                f = (/** @type {?} */ (this.setExtendProps(f, sf, tempFPath)));
                ffields.push(f);
            }
        }));
        return ffields;
    }
    /**
     * 判定有子数据的条件为：子表可显示，且子表有数据
     * @param {?} row
     * @param {?} billInfo
     * @return {?}
     */
    hasChildData(row, billInfo) {
        /** @type {?} */
        let hasChildData = false;
        /** @type {?} */
        const schema = this.getBillTrackerSchema(billInfo);
        /** @type {?} */
        let children = row.GetChildTableList();
        for (let c of children) {
            /** @type {?} */
            let tableShow = false;
            /** @type {?} */
            let hasRows = false;
            /** @type {?} */
            let table = schema && schema[c.tableName];
            if (table != null && table.show != null) {
                tableShow = table.show;
            }
            else {
                // 兼容无show属性情形
                tableShow = true;
            }
            if (c.GetRowList() && c.GetRowList().length > 0) {
                hasRows = true;
            }
            hasChildData = tableShow && hasRows;
            if (hasChildData == true) {
                break;
            }
        }
        return hasChildData;
    }
    /**
     * @param {?} f
     * @param {?} rdfm
     * @param {?=} wholeFields
     * @return {?}
     */
    getFieldValue(f, rdfm, wholeFields) {
        /** @type {?} */
        let fields = f.fieldPath ? f.fieldPath.split(".") : [f.fieldName];
        /** @type {?} */
        let bdf = fields && rdfm[fields[0]];
        for (let i = 1; bdf != null && i < fields.length; i++) {
            /** @type {?} */
            const temp = bdf.GetSubFieldMap();
            if (temp == null) {
                break;
            }
            bdf = temp[fields[i]];
        }
        /** @type {?} */
        const textValue = bdf ? bdf.GetTextValue() : "";
        if (textValue == null) {
            return null;
        }
        if (f.dataType == DataType.String) {
            if (f.formatInfo != null) {
                /** @type {?} */
                const stringMapFormatter = f.formatInfo.stringMapFormatter;
                if (stringMapFormatter != null) {
                    /** @type {?} */
                    const v = stringMapFormatter[textValue] || textValue;
                    f.fieldValue = v;
                    return v;
                }
                else {
                    f.fieldValue = textValue;
                    return textValue || "";
                }
            }
            else {
                f.fieldValue = textValue;
                return textValue || "";
            }
        }
        else if (f.dataType == DataType.Decimal) {
            /** @type {?} */
            let scale = f.scale;
            if (f.formatInfo != null) {
                if (f.formatInfo.scale != null) {
                    scale = f.formatInfo.scale;
                }
                if (f.formatInfo.enableScaleExpression) {
                    if (f.formatInfo.scaleExpression != null) {
                        /** @type {?} */
                        const scaleField = this.getFieldInFields(wholeFields, f.formatInfo.scaleExpression);
                        /** @type {?} */
                        const tmp = scaleField && parseInt(String(this.getFieldValue(scaleField, rdfm)));
                        // const tmp = parseInt(this.getFieldValueInFieldsWithValue(extactedFields, f.formatInfo.scaleExpression));
                        if (tmp != null) {
                            if (isNaN(tmp)) {
                                throw Exceptions.SCALE_FIELD_VALUE_IS_NAN;
                            }
                            scale = tmp;
                        }
                    }
                }
            }
            f.fieldValue = parseFloat(String(textValue));
            if (scale < 0) {
                scale = 0;
            }
            else if (scale > 100) {
                scale = 100;
            }
            /** @type {?} */
            let dec = parseFloat(String(textValue)).toFixed(scale).toString();
            return dec || "";
        }
        else if (f.dataType == DataType.Boolean) {
            if (textValue == "") {
                f.fieldValue = null;
                return textValue;
            }
            f.fieldValue = (/** @type {?} */ (JSON.parse(textValue)));
            return (/** @type {?} */ (JSON.parse(textValue)));
        }
        else if (f.dataType == DataType.DateTime) {
            /** @type {?} */
            let date = BpmnModelJsonHelper.DateTimeFromString(textValue);
            /** @type {?} */
            let formatter = "yyyy-MM-dd";
            formatter = f.formatInfo && f.formatInfo.dateFormatter || "yyyy-MM-dd";
            // if (f.fieldType == "DateTime") {
            //     formatter = f.formatInfo && f.formatInfo.dateFormatter || "yyyy-MM-dd HH:mm:ss.SSS";
            // } else if (f.fieldType == "Date") {
            //     formatter = f.formatInfo && f.formatInfo.dateFormatter || "yyyy-MM-dd";
            // } else {
            //     formatter = f.formatInfo && f.formatInfo.dateFormatter || "yyyy-MM-dd";
            // }
            f.fieldValue = date;
            return this.dateFormat(date, formatter);
        }
        else {
            f.fieldValue = textValue;
            return textValue || "";
        }
    }
    /**
     * 根据fullPath在字段列表中查找目标字段
     * @param {?} fields
     * @param {?} fullPath
     * @return {?}
     */
    getFieldInFields(fields, fullPath) {
        /** @type {?} */
        let v = null;
        for (let fv of fields) {
            /** @type {?} */
            const curFv = (/** @type {?} */ (fv));
            // 查找根字段
            /** @type {?} */
            let tmpFv = fv;
            while (tmpFv.attachedField) {
                tmpFv = tmpFv.attachedField;
            }
            /** @type {?} */
            const rootFv = (/** @type {?} */ (tmpFv));
            // 更新fullPath
            curFv.fullPath = fullPathPrefix + rootFv.attachedTable.tableName + "." + curFv.fieldPath;
            // 对比当前字段fullPath与目标fullPath
            if (fullPath == curFv.fullPath) {
                v = curFv;
                break;
            }
            // 递归查找子字段
            /** @type {?} */
            const subFlds = curFv.GetSubFieldList();
            if (subFlds && subFlds.length > 0) {
                v = this.getFieldInFields(subFlds, fullPath);
                if (v != null) {
                    break;
                }
            }
        }
        return v;
    }
    /**
     * @param {?} fieldsWithValue
     * @param {?} fullPath
     * @return {?}
     */
    getFieldValueInFieldsWithValue(fieldsWithValue, fullPath) {
        /** @type {?} */
        let v = null;
        for (let fv of fieldsWithValue) {
            while (fv.attachedField) {
                fv = fv.attachedField;
            }
            /** @type {?} */
            const rootFv = (/** @type {?} */ (fv));
            rootFv.fullPath = fullPathPrefix + rootFv.attachedTable.tableName + "." + rootFv.fieldPath;
            if (fullPath == rootFv.fullPath) {
                v = rootFv.fieldValue;
                break;
            }
        }
        return v;
    }
    /**
     * @param {?} billInfo
     * @param {?} schemaTable
     * @param {?} dataTable
     * @param {?=} filterFields
     * @return {?}
     */
    getBasicInfoFieldsWithValue(billInfo, schemaTable, dataTable, filterFields = true) {
        /** @type {?} */
        const fieldsWithValue = [];
        // 单据追踪配置
        /** @type {?} */
        let bts = new BillTrackingSettings();
        if (billInfo && billInfo.billTrackingSettings) {
            bts.LoadFromJson(billInfo.billTrackingSettings);
        }
        /** @type {?} */
        const schema = this.getBillTrackerSchema(billInfo);
        /** @type {?} */
        let selectedFields = schema && schema[schemaTable.tableName] && schema[schemaTable.tableName].fields;
        selectedFields = selectedFields ? selectedFields : [];
        /** @type {?} */
        let showCustomFields = bts.billTrackingDataShownMode === BillTrackingDataShownMode.CUSTOMFIELD;
        // 所有字段
        /** @type {?} */
        const fs = schemaTable.getFieldList();
        /** @type {?} */
        const r = dataTable.GetRowList()[0];
        // 主表字段
        /** @type {?} */
        const rdfm = r.GetFieldMap();
        // 提取展示字段
        /** @type {?} */
        const ffs = this.extractFFields(fs, selectedFields, showCustomFields);
        // 获取字段值
        // 先解析其他类型字段
        /** @type {?} */
        const decimalFfs = [];
        ffs.forEach((/**
         * @param {?} ff
         * @return {?}
         */
        ff => {
            if (ff.dataType == DataType.Decimal) {
                decimalFfs.push(ff);
            }
            else {
                ff.fieldValue = this.getFieldValue(ff, rdfm);
            }
        }));
        // 再解析浮点数字段
        decimalFfs.forEach((/**
         * @param {?} ff
         * @return {?}
         */
        ff => {
            ff.fieldValue = this.getFieldValue(ff, rdfm, fs);
        }));
        fieldsWithValue.push(...ffs);
        return fieldsWithValue;
    }
    /**
     * @param {?} f
     * @param {?} sf
     * @param {?} fieldPath
     * @param {?=} rdfm
     * @return {?}
     */
    setExtendProps(f, sf, fieldPath, rdfm) {
        f.captionPath = this.extractCaptionPath(f);
        f.fieldPath = fieldPath;
        if (sf) {
            f.displayName = sf.displayName;
            f.i18nCols = sf.i18nCols;
            f.formatInfo = sf.formatInfo;
            f.order = sf.order;
        }
        if (rdfm) {
            f.fieldValue = this.getFieldValue(f, rdfm);
        }
        return f;
    }
    /**
     * 字段列表按order属性排序
     * @param {?} fieldsWithValue
     * @return {?}
     */
    sortFieldsByOrder(fieldsWithValue) {
        return fieldsWithValue.sort((/**
         * @param {?} a
         * @param {?} b
         * @return {?}
         */
        (a, b) => {
            if (a.order != null && b.order != null) {
                return a.order - b.order;
            }
            else if (a.order != null && b.order == null) {
                return -1;
            }
            else if (a.order == null && b.order != null) {
                return 1;
            }
            else {
                return 0;
            }
        }));
    }
    /**
     * @param {?} date
     * @param {?} fmt
     * @return {?}
     */
    dateFormat(date, fmt) {
        /** @type {?} */
        let ret;
        /** @type {?} */
        const opt = {
            "y+": date.getUTCFullYear().toString(),
            // 年
            "M+": (date.getUTCMonth() + 1).toString(),
            // 月
            "d+": date.getUTCDate().toString(),
            // 日
            "H+": date.getUTCHours().toString(),
            // 时
            "m+": date.getUTCMinutes().toString(),
            // 分
            "s+": date.getUTCSeconds().toString(),
            // 秒
            "S+": date.getUTCMilliseconds().toString(),
        };
        for (let k in opt) {
            ret = new RegExp("(" + k + ")").exec(fmt);
            if (ret) {
                if (!String.prototype.padStart) {
                    fmt = fmt.replace(ret[1], (ret[1].length == 1) ? (opt[k]) : (this.myPadStart(opt[k], ret[1].length, "0")));
                }
                else {
                    fmt = fmt.replace(ret[1], (ret[1].length == 1) ? (opt[k]) : (opt[k].padStart(ret[1].length, "0")));
                }
            }
        }
        return fmt;
    }
    /**
     * @param {?} src
     * @param {?} targetLength
     * @param {?} padString
     * @return {?}
     */
    myPadStart(src, targetLength, padString) {
        targetLength = targetLength >> 0; //floor if number or convert non-number to 0;
        padString = String(typeof padString !== 'undefined' ? padString : ' ');
        if (src.length > targetLength) {
            return String(src);
        }
        else {
            targetLength = targetLength - src.length;
            if (targetLength > padString.length) {
                padString += padString.repeat(targetLength / padString.length); //append to original to ensure we are longer than needed
            }
            return padString.slice(0, targetLength) + String(src);
        }
    }
    /**
     * 解析字段名称
     * @param {?} f
     * @param {?=} langCode
     * @return {?}
     */
    getFieldLabel(f, langCode) {
        return (langCode && f.i18nCols && f.i18nCols.colI18nValues.displayName &&
            f.i18nCols.colI18nValues.displayName[langCode]) || f.displayName || f.captionPath || f.caption;
    }
    /**
     * 解析表名称
     * @param {?} billInfo
     * @param {?} schemaTable
     * @param {?=} langCode
     * @return {?}
     */
    getTableLabel(billInfo, schemaTable, langCode) {
        /** @type {?} */
        const schema = this.getBillTrackerSchema(billInfo);
        /** @type {?} */
        let table = schema && schema[schemaTable.tableName];
        if (table != null) {
            /** @type {?} */
            const i18nCols = table.i18nCols;
            /** @type {?} */
            const tmp = (langCode && i18nCols && i18nCols.colI18nValues.displayName && i18nCols.colI18nValues.displayName[langCode]) || table.displayName || table.caption || table.code;
            return tmp;
        }
        else {
            return schemaTable.caption;
        }
    }
    /**
     * 获取解析可展示子表
     * @param {?} billInfo
     * @param {?} schemaTable
     * @return {?}
     */
    getChildTables(billInfo, schemaTable) {
        /** @type {?} */
        let result = [];
        /** @type {?} */
        const schema = this.getBillTrackerSchema(billInfo);
        /** @type {?} */
        const children = schemaTable.GetChildTableList();
        children && children.forEach((/**
         * @param {?} child
         * @return {?}
         */
        (child) => {
            /** @type {?} */
            let trackerTable = schema && schema[child.tableName];
            if (trackerTable != null && trackerTable.show != null) {
                if (trackerTable.show == true) {
                    child.order = trackerTable.order;
                    result.push(child);
                }
            }
            else {
                // 兼容无show属性情形
                result.push(child);
            }
        }));
        result = this.sortTablesByOrder(result);
        return result;
    }
    /**
     * 表按sort字段排序
     * @param {?} schemaTables
     * @return {?}
     */
    sortTablesByOrder(schemaTables) {
        return schemaTables.sort((/**
         * @param {?} a
         * @param {?} b
         * @return {?}
         */
        (a, b) => {
            if (a.order != null && b.order != null) {
                return a.order - b.order;
            }
            else if (a.order != null && b.order == null) {
                return -1;
            }
            else if (a.order == null && b.order != null) {
                return 1;
            }
            else {
                return 0;
            }
        }));
    }
    /**
     * 解析billTrackerSchema
     * @param {?} billInfo
     * @return {?}
     */
    getBillTrackerSchema(billInfo) {
        /** @type {?} */
        let bts = new BillTrackingSettings();
        if (billInfo && billInfo.billTrackingSettings) {
            bts.LoadFromJson(billInfo.billTrackingSettings);
        }
        /** @type {?} */
        let fieldContent = bts.customFieldContent;
        /** @type {?} */
        let fieldConfig = fieldContent && (typeof fieldContent == "object" ? fieldContent : JSON.parse(fieldContent));
        /** @type {?} */
        let schema = fieldConfig && fieldConfig.schema;
        return schema;
    }
}
BillTrackerDataInfoService.decorators = [
    { type: Injectable }
];

/**
 * @fileoverview added by tsickle
 * Generated from: lib/bill-tracker/config/bill-tracker-cell-css.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/**
 * 预置弹出菜单样式
 * @type {?}
 */
const billTrackerPopupMenuCss = `
body div.mxPopupMenu {
  -webkit-box-shadow: 3px 3px 6px #C0C0C0;
  -moz-box-shadow: 3px 3px 6px #C0C0C0;
  box-shadow: 3px 3px 6px #C0C0C0;
  background: white;
  position: absolute;
  border: 3px solid #e7e7e7;
  padding: 3px;
}
body table.mxPopupMenu {
  border-collapse: collapse;
  margin: 0px;
}
body tr.mxPopupMenuItem {
  color: black;
  cursor: default;
}
body td.mxPopupMenuItem {
  padding: 6px 60px 6px 30px;
  font-family: Arial;
  font-size: 10pt;
}
body td.mxPopupMenuIcon {
  background-color: white;
  padding: 0px;
}
body tr.mxPopupMenuItemHover {
  background-color: #eeeeee;
  color: black;
}
table.mxPopupMenu hr {
  border-top: solid 1px #cccccc;
}
table.mxPopupMenu tr {
  font-size: 4pt;
}
`;
/**
 * 预置节点样式类
 * @type {?}
 */
const billTrackerCellCss = `
.bif-cell-node {
    position: relative;
    height: 100%;
    font-weight: normal;
    font-family: PingFangSC-Regular;
    display:block;
    text-align: left;
}
.bif-cell-node-main {
    height: 100%;
    background: #FFFFFF;
    border: 1px solid rgba(230,233,240,1);
    box-shadow: 0px 2px 10px 0px rgba(3,18,51,0.08);
    border-radius: 8px;
    border-left-width: 4px;
    border-left-color: #2A87FF;
}
.bif-cell-node-current {
    position: absolute;
    right: 0;
    top: 0;
    width: 50px;
    height: 28px;
    background-image: linear-gradient(39deg, #F5A144 0%, #FFC527 100%);
    box-shadow: 0px 2px 6px 0px rgba(245,161,68,0.4);
    border-radius: 0px 8px 0px 64px;
    color: white;
    text-align: center;
}
.bif-cell-node-current-text {
    display: block;
    margin: auto;
    line-height: 28px;
}
.bif-cell-node-title {
    padding-left:19px;
    padding-right:12px;
    padding-top: 16px;
    padding-bottom: 6px;
}
.bif-cell-node-title-text {
    font-size: 16px;
    color: #2D2F33;
    letter-spacing: 0;
    line-height: 24px;
    font-weight: 400;
    white-space: normal;
    text-overflow: ellipsis;
    overflow: hidden;
    word-break: break-all;
    display: -webkit-box;
    -webkit-box-orient: vertical;
    -webkit-line-clamp: 1;
}
.bif-cell-node-summary-list {

}
.bif-cell-node-summary {
    display: flex;
    padding-left: 19px;
    padding-right:12px;
    font-size: 13px;
    color: #5A5E66;
    line-height: 24px;
    font-weight: 400;
}
.bif-cell-node-summary-caption {
    letter-spacing: 0;
    margin-right: 4px;
    width: 65px;
    min-width: 65px;
    text-align: right;
}
.bif-cell-node-summary-caption-text {
    white-space: normal;
    text-overflow: ellipsis;
    overflow: hidden;
    word-break: break-all;
    display: -webkit-box;
    -webkit-box-orient: vertical;
    -webkit-line-clamp: 1;
}
.bif-cell-node-summary-value {

}
.bif-cell-node-summary-value-text {
    font-family: PingFangSC-Regular,HelveticaNeue,Helvetica,Arial,sans-serif;
    color: rgba(0,0,0,0.85);
    text-align: left;
    white-space: normal;
    display: -webkit-box;
    -webkit-box-orient: vertical;
    overflow: hidden;
    -webkit-line-clamp: 1;
    word-break: break-all;
    overflow: hidden;
    text-overflow: ellipsis;
}
.bif-cell-node-title-link {
}
.bif-cell-node-title-link:hover {
    text-decoration: underline;
    cursor: pointer;
}
.bif-cell-node-title-link-color {
    color: #56A0FF;
}
.bif-cell-node-title-only {
    justify-content: center;
    height: 100%;
    display: flex;
    align-items: center;
    border: 1px solid rgb(193,195,199,1);
}
.bif-cell-node-title-only-text {
    font-size: xx-large;
}
.bif-cell-node-thumb {
    height: 100%;
    background: #FFFFFF;
}
.bif-cell-node-thumb-img-container {
    height: 80%;
}
.bif-cell-node-thumb-img {
    height: 100%;
    width: 100%;
}
.bif-cell-node-thumb-title {
    height: 20%;
    display: flex;
    justify-content: center;
    display: flex;
    align-items: center;
}
.bif-cell-node-thumb-title-text {
    font-size: x-large;
}
.bif-cell-node-btn-group {
    position: absolute;
    bottom: 16px;
    right: 16px;
}
.bif-cell-node-btn {
    width: 22px;
    height: 22px;
    margin-left: 8px;
    cursor: pointer;
}
.bif-cell-node .bif-cell-node-btn-group-control {
    display: none;
}
.bif-cell-node:hover .bif-cell-node-btn-group-control {
    display: unset;
}
`;

/**
 * @fileoverview added by tsickle
 * Generated from: lib/bill-tracker/utils/addCustomCSS.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/**
 * 向head中添加样式类
 * @param {?} cssText
 * @return {?}
 */
function addCustomCSS(cssText) {
    /** @type {?} */
    let style = (/** @type {?} */ (document.createElement('style')));
    //创建一个style元素
    /** @type {?} */
    let head = document.head || document.getElementsByTagName('head')[0];
    style.type = 'text/css'; //这里必须显示设置style元素的type属性为text/css，否则在ie中不起作用
    if (style.styleSheet) { //IE
        //IE
        /** @type {?} */
        let func = (/**
         * @return {?}
         */
        function () {
            try { //防止IE中stylesheet数量超过限制而发生错误
                style.styleSheet.cssText = cssText;
            }
            catch (e) {
            }
        })
        //如果当前styleSheet还不能用，则放到异步中则行
        ;
        //如果当前styleSheet还不能用，则放到异步中则行
        if (style.styleSheet.disabled) {
            setTimeout(func, 10);
        }
        else {
            func();
        }
    }
    else { //w3c
        //w3c
        //w3c浏览器中只要创建文本节点插入到style元素中就行了
        /** @type {?} */
        let textNode = document.createTextNode(cssText);
        style.appendChild(textNode);
    }
    head.appendChild(style); //把创建的style元素插入到head中    
}

/**
 * @fileoverview added by tsickle
 * Generated from: lib/bill-tracker/components/bill-tracker-graph/bill-tracker-graph.component.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
// 在head中添加节点样式
addCustomCSS(billTrackerCellCss);
// 在head中添加弹出菜单样式
addCustomCSS(billTrackerPopupMenuCss);
class BillTrackerGraphComponent {
    /**
     * @param {?} args
     * @param {?} localeId
     * @param {?} dataService
     * @param {?} notify
     * @param {?} messager
     * @param {?} loading
     * @param {?} modal
     * @param {?} vcr
     * @param {?} inj
     * @param {?} cfr
     * @param {?} cdr
     */
    constructor(args, localeId, dataService, notify, messager, loading, modal, vcr, inj, cfr, cdr) {
        this.dataService = dataService;
        this.notify = notify;
        this.messager = messager;
        this.loading = loading;
        this.modal = modal;
        this.vcr = vcr;
        this.inj = inj;
        this.cfr = cfr;
        this.cdr = cdr;
        this.selectEventEmitter = new EventEmitter();
        this.stateChangeEventEmitter = new EventEmitter();
        this.hspace = 80;
        this.vspace = 28;
        this.defaultWidth = 250;
        this.defaultHeight = 138;
        this.nodeWidth = this.defaultWidth;
        this.nodeHeight = this.defaultHeight;
        this.defaultNonEntryImage = (!mxClientType.IS_SVG) ? BillTrackerConstant.IMAGE_PATH + '/non-entry-bill.png' : BillTrackerConstant.IMAGE_PATH + '/non-entry-bill.svg';
        this.defaultEntryImage = (!mxClientType.IS_SVG) ? BillTrackerConstant.IMAGE_PATH + '/entry-bill.png' : BillTrackerConstant.IMAGE_PATH + '/entry-bill.svg';
        this.defaultOverlayWidth = 26;
        this.defaultOverlayHeight = 26;
        this.overlayWidth = this.defaultOverlayWidth;
        this.overlayHeight = this.defaultOverlayHeight;
        this.defaultUpSearchImage = new mxImageType(BillTrackerConstant.IMAGE_PATH + '/tracker-plus.svg', this.overlayWidth, this.overlayHeight);
        this.defaultDownSearchImage = new mxImageType(BillTrackerConstant.IMAGE_PATH + '/tracker-plus.svg', this.overlayWidth, this.overlayHeight);
        this.defaultUpFolderImage = new mxImageType(BillTrackerConstant.IMAGE_PATH + '/tracker-minus.svg', this.overlayWidth, this.overlayHeight);
        this.defaultDownFolderImage = new mxImageType(BillTrackerConstant.IMAGE_PATH + '/tracker-minus.svg', this.overlayWidth, this.overlayHeight);
        this.upSearchImage = this.defaultUpSearchImage;
        this.downSearchImage = this.defaultDownSearchImage;
        this.upFolderImage = this.defaultUpFolderImage;
        this.downFolderImage = this.defaultDownFolderImage;
        this.upSearchOffset = new mxPointType(-50, 0);
        this.downSearchOffset = new mxPointType(50, 0);
        /**
         * 正在加载中的单据节点请求数
         */
        this.numCellsAddingReq = 0;
        this.localePipe = new BillTrackerLocalePipe(localeId);
        this.dataInfoService = new BillTrackerDataInfoService();
        this.billTrackerArgs = args;
        this.originBillTrackerArgs = this.billTrackerArgs;
        /** @type {?} */
        const graphOptions = this.billTrackerArgs.graphOptions;
        this.graphOptions = graphOptions;
        /** @type {?} */
        const gridOptions = this.billTrackerArgs.gridOptions;
        this.gridOptions = gridOptions;
        this.upSearchImage = graphOptions && graphOptions.upSearchImage ? new mxImageType(graphOptions.upSearchImage, this.overlayWidth, this.overlayHeight) : this.upSearchImage;
        this.downSearchImage = graphOptions && graphOptions.downSearchImage ? new mxImageType(graphOptions.downSearchImage, this.overlayWidth, this.overlayHeight) : this.downSearchImage;
        this.upFolderImage = graphOptions && graphOptions.upFolderImage ? new mxImageType(graphOptions.upFolderImage, this.overlayWidth, this.overlayHeight) : this.upFolderImage;
        this.downFolderImage = graphOptions && graphOptions.downFolderImage ? new mxImageType(graphOptions.downFolderImage, this.overlayWidth, this.overlayHeight) : this.downFolderImage;
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.graph = this.createGraph();
        this.createLayout(this.graph);
        this.layoutManager = new mxLayoutManagerType(this.graph);
        this.outline = new Outline(this.graph, this.mxOutlineContainer.nativeElement);
        // 创建节点“更多”按钮弹出菜单
        this.morePopupMenu = new mxPopupMenuType((/**
         * @param {?} menu
         * @param {?} cell
         * @param {?} evt
         * @return {?}
         */
        (menu, cell, evt) => {
            // 继续追踪
            menu.addItem(this.localePipe.transform("goOnTracking"), null, (/**
             * @return {?}
             */
            () => {
                this.goOnTrack(cell);
            }));
            // // 设为当前
            // menu.addItem(this.localePipe.transform("setAsCurrent"), null, () => {
            //   this.setAsCurrent(cell);
            // });
        }));
    }
    /**
     * @return {?}
     */
    ngAfterViewInit() {
    }
    /**
     * @param {?=} sizeDidChange
     * @return {?}
     */
    refresh(sizeDidChange = true) {
        if (sizeDidChange && this.graph != null) {
            this.graph.sizeDidChange();
        }
    }
    /**
     * @return {?}
     */
    paint() {
        this.paintGraph(this.graph);
    }
    /**
     * @param {?} modalRef
     * @return {?}
     */
    setModalRef(modalRef) {
        this.modalRef = modalRef;
        if (this.modalRef != null) {
            this.modalRef.dialog.instance.closed.subscribe((/**
             * @param {?} evt
             * @return {?}
             */
            (evt) => {
                this.graph && this.graph.destroy();
            }));
            // todo: 临时解决弹窗模式下先刷新出入口节点问题
            /** @type {?} */
            let flag = 0;
            this.modalRef.dialog.instance.resized.subscribe((/**
             * @param {?} evt
             * @return {?}
             */
            (evt) => {
                if (flag >= 2) {
                    this.refresh();
                }
                flag++;
            }));
        }
    }
    /**
     * @return {?}
     */
    createGraph() {
        //启用mxGuide
        mxGraphHandlerType.prototype.guidesEnabled = true;
        //禁用mxgraph容器内上下文菜单
        mxEventType.disableContextMenu(this.mxContainerER.nativeElement);
        mxGraphHandlerType.prototype.scrollOnMove = false;
        mxGraphHandlerType.prototype.scaleGrid = true;
        //修改节点选中后处理器图片及填充色
        mxConstantsType.HANDLE_FILLCOLOR = '#29b6f2';
        mxHandleType.prototype.createShape = (/**
         * @param {?} html
         * @return {?}
         */
        function (html) {
            /** @type {?} */
            const bounds = new mxEllipseType(0, 0, mxConstantsType.HANDLE_SIZE, mxConstantsType.HANDLE_SIZE);
            return new mxEllipseType(bounds, mxConstantsType.HANDLE_FILLCOLOR, mxConstantsType.HANDLE_STROKECOLOR);
        });
        mxVertexHandlerType.prototype.handleImage = (!mxClientType.IS_SVG) ? new mxImageType(BillTrackerConstant.IMAGE_PATH + '/handle-main.png', mxConstantsType.HANDLE_SIZE, mxConstantsType.HANDLE_SIZE) : Graph.createSvgImage(18, 18, '<circle cx="9" cy="9" r="3" stroke="#fff" fill="' + Graph.handleFill + '" stroke-width="1"/>');
        mxConstantsType.DEFAULT_VALID_COLOR = '#FFFFFF';
        mxConstantsType.HIGHLIGHT_STROKEWIDTH = 1;
        //修改mxGuide默认配置
        mxConstantsType.GUIDE_COLOR = '#0088cf';
        mxGuideType.prototype.createGuideShape = (/**
         * @param {?} horizontal
         * @return {?}
         */
        (horizontal) => new mxPolylineType([], mxConstantsType.GUIDE_COLOR, mxConstantsType.GUIDE_STROKEWIDTH));
        //设置节点选中线框宽度
        mxConstantsType.VERTEX_SELECTION_STROKEWIDTH = 1;
        mxConstantsType.VERTEX_SELECTION_COLOR = '#3E8DFF';
        mxConstantsType.VERTEX_SELECTION_DASHED = false;
        //修改线宽
        mxConnectionHandlerType.prototype.getEdgeWidth = (/**
         * @param {?} valid
         * @return {?}
         */
        (valid) => 1);
        mxConstantsType.VALID_COLOR = '#00CD66';
        //创建mxGraph
        /** @type {?} */
        const graph = new Graph(this.mxContainerER.nativeElement, undefined, undefined, undefined);
        graph.localePipe = this.localePipe;
        graph.graphOptions = this.graphOptions;
        graph.gridOptions = this.gridOptions;
        //添加自定义监听器
        this.addListener(graph);
        graph.ngComp = this;
        return graph;
    }
    /**
     * @param {?} graph
     * @return {?}
     */
    createLayout(graph) {
        /** @type {?} */
        const upLayout = new RevertCompactTreeLayout(graph, true);
        upLayout.levelDistance = this.hspace;
        upLayout.edgeRouting = false;
        upLayout.resetEdges = false;
        this.upLayout = upLayout;
        /** @type {?} */
        const downLayout = new CompactTreeLayout(graph, true);
        downLayout.levelDistance = this.hspace;
        downLayout.edgeRouting = false;
        downLayout.resetEdges = true;
        this.downLayout = downLayout;
    }
    /**
     * @param {?} graph
     * @return {?}
     */
    addListener(graph) {
        /** @type {?} */
        const autoAdjustHandler = (/**
         * @return {?}
         */
        () => {
            window.setTimeout((/**
             * @return {?}
             */
            () => {
                if (this.graph != null) {
                    this.refresh();
                }
            }), 0);
        });
        mxEventType.addListener(window, 'resize', autoAdjustHandler);
        /** @type {?} */
        const wheelResizeHandler = (/**
         * @param {?} evt
         * @param {?} up
         * @return {?}
         */
        (evt, up) => {
            // window下Ctrl按下，Mac下Command按下
            if (mxEventType.isControlDown(evt) || (mxClientType.IS_MAC && evt.metaKey)) {
                if (up) {
                    this.zoomIn();
                }
                else {
                    this.zoomOut();
                }
                mxEventType.consume(evt);
                return false;
            }
        });
        mxEventType.addMouseWheelListener(wheelResizeHandler, this.mxContainerER.nativeElement);
        graph.selectEventEmitter = this.selectEventEmitter;
        graph.getSelectionModel().addListener(mxEventType.CHANGE, (/**
         * @param {?} sender
         * @param {?} evt
         * @return {?}
         */
        (sender, evt) => {
            if (!(sender instanceof mxGraphSelectionModelType)) {
                return;
            }
            /** @type {?} */
            let selectionModel = sender;
            //若未选中节点或者选中节点数不为1
            if (selectionModel.cells == null || selectionModel.cells.length != 1) {
                this.selectEventEmitter.emit(null);
                return;
            }
            /** @type {?} */
            let selectedCell = selectionModel.cells[0];
            //选中的是边
            if (selectedCell.edge || !selectedCell.vertex) {
                return;
            }
            this.selectEventEmitter.emit(selectedCell);
        }));
        graph.addListener(Events.CLICK_FIRST_SUMMARY, (/**
         * @param {?} serder
         * @param {?} evt
         * @return {?}
         */
        (serder, evt) => {
            /** @type {?} */
            const cell = evt.getProperty("cell");
            this.stateChangeEventEmitter.emit({
                type: Events.CLICK_FIRST_SUMMARY,
                data: cell
            });
            // 点击超链接时主动触发节点选中事件
            graph.setSelectionCell(cell);
        }));
        // 定义全局事件处理器，点击空白处隐藏弹出菜单
        /** @type {?} */
        const gestureHandler = (/**
         * @param {?} evt
         * @return {?}
         */
        (evt) => {
            if (this.currentMenu != null && mxEventType.getSource(evt) != this.currentMenu.div) {
                this.hideCurrentMenu();
            }
        });
        mxEventType.addGestureListeners(document, gestureHandler);
    }
    /**
     * 隐藏当前菜单
     * @return {?}
     */
    hideCurrentMenu() {
        if (this.currentMenu != null) {
            this.currentMenu.hideMenu();
            this.resetCurrentMenu();
        }
    }
    /**
     * 重置当前菜单
     * @return {?}
     */
    resetCurrentMenu() {
        this.currentMenu = null;
        this.currentMenuElt = null;
    }
    /**
     * @param {?} graph
     * @return {?}
     */
    paintGraph(graph) {
        graph.getModel().beginUpdate();
        this.entry = this.paintEntry(graph);
        this.afterPaintGraph(this.graph, this.entry);
        graph.getModel().endUpdate();
    }
    /**
     * @param {?} graph
     * @return {?}
     */
    repaintGraph(graph) {
        graph.getModel().beginUpdate();
        graph.removeCells(graph.getChildCells(graph.getDefaultParent()));
        this.paintGraph(graph);
        graph.getModel().endUpdate();
    }
    /**
     * @param {?} graph
     * @param {?} entry
     * @return {?}
     */
    afterPaintGraph(graph, entry) {
        if (entry == null) {
            return;
        }
        // 默认选中入口节点
        if (this.billTrackerArgs.gridOptions.showEntryData) {
            graph.setSelectionCell(this.entry);
        }
        // 默认展示一层？
        /** @type {?} */
        const canTrackingResult = this.billTrackerArgs.canTrackingResult;
        if (this.billTrackerArgs.graphOptions.showDownBills == true) {
            canTrackingResult.canDownTracking && this.entry.downCellOverlay && this.entry.downCellOverlay.fireEvent(new mxEventObjectType(mxEventType.CLICK, "resetView", true));
        }
        if (this.billTrackerArgs.graphOptions.showUpBills == true) {
            canTrackingResult.canUpTracking && this.entry.upCellOverlay && this.entry.upCellOverlay.fireEvent(new mxEventObjectType(mxEventType.CLICK, "resetView", true));
        }
    }
    /**
     * @param {?} graph
     * @return {?}
     */
    paintEntry(graph) {
        /** @type {?} */
        let entry = null;
        if (this.billTrackerArgs == null || this.billTrackerArgs.canTrackingResult == null) {
            return entry;
        }
        /** @type {?} */
        const canTrackingResult = this.billTrackerArgs.canTrackingResult;
        /** @type {?} */
        const info = this.dataService.buildEntryBillInfo(canTrackingResult);
        /** @type {?} */
        const dataInfo = info.billDataInfos[0];
        /** @type {?} */
        let bts = new BillTrackingSettings();
        bts.LoadFromJson(canTrackingResult.billTrackingSettings);
        /** @type {?} */
        const parent = graph.getDefaultParent();
        graph.getModel().beginUpdate();
        try {
            /** @type {?} */
            let x0 = 0;
            /** @type {?} */
            let y0 = 0;
            /** @type {?} */
            let bts = new BillTrackingSettings();
            if (info && info.billTrackingSettings) {
                bts.LoadFromJson(info.billTrackingSettings);
            }
            /** @type {?} */
            let customStyle = "";
            entry = graph.insertBillCell(parent, null, dataInfo, info, true, x0, y0, this.nodeWidth, this.nodeHeight, `billNode;billNodeEntry;${customStyle}`);
            /** @type {?} */
            let geometry = graph.getModel().getGeometry(entry);
            /** @type {?} */
            let size = graph.getPreferredSizeForCell(entry);
            this.entryCellData = new EntryCellData();
            this.setCellData(this.entryCellData, entry);
            this.entryCellData.canTrackingResult = canTrackingResult;
            entry.data = this.entryCellData;
            // 添加上查下查按钮
            if (canTrackingResult.canDownTracking) {
                /** @type {?} */
                const overlay = this.addDownOverlay(graph, entry);
                entry.downCellOverlay = overlay;
            }
            if (canTrackingResult.canUpTracking) {
                /** @type {?} */
                const overlay = this.addUpOverlay(graph, entry);
                entry.upCellOverlay = overlay;
            }
            this.upParent = parent.clone();
            this.downParent = parent.clone();
            graph.addCells([this.upParent, this.downParent], parent);
        }
        finally {
            graph.getModel().endUpdate();
        }
        return entry;
    }
    /**
     * @param {?} graph
     * @param {?} cell
     * @return {?}
     */
    addUpOverlay(graph, cell) {
        /** @type {?} */
        let upSearch = new CellOverlay(this.upSearchImage, this.localePipe.transform("upSearch"), mxConstantsType.ALIGN_LEFT, mxConstantsType.ALIGN_MIDDLE, this.upSearchOffset, "hand");
        upSearch.state = CellOverlayState.Search;
        /** @type {?} */
        const upSearchHandler = (/**
         * @param {?} sender
         * @param {?} evt
         * @return {?}
         */
        (sender, evt) => {
            /** @type {?} */
            const resetView = evt.getProperty("resetView");
            /** @type {?} */
            const showLoading = evt.getProperty("showLoading") != null ? evt.getProperty("showLoading") : true;
            graph.getModel().beginUpdate();
            this.addUpAssoCell(graph, cell, resetView, showLoading);
            upSearch.removeListener(upSearchHandler);
            upSearch.tooltip = this.localePipe.transform("folder");
            upSearch.image = this.upFolderImage;
            upSearch.state = CellOverlayState.Fold;
            upSearch.addListener(mxEventType.CLICK, upFolderHandler);
            graph.removeCellOverlay(cell, upSearch);
            graph.addCellOverlay(cell, upSearch);
            graph.getModel().endUpdate();
        });
        /** @type {?} */
        const upFolderHandler = (/**
         * @param {?} sender
         * @param {?} evt
         * @return {?}
         */
        (sender, evt) => {
            graph.getModel().beginUpdate();
            this.removeAssoCell(graph, cell, BillTrackerDirection.Up);
            upSearch.removeListener(upFolderHandler);
            upSearch.tooltip = this.localePipe.transform("upSearch");
            upSearch.image = this.upSearchImage;
            upSearch.state = CellOverlayState.Search;
            upSearch.addListener(mxEventType.CLICK, upSearchHandler);
            graph.removeCellOverlay(cell, upSearch);
            graph.addCellOverlay(cell, upSearch);
            graph.model.endUpdate();
        });
        upSearch.addListener(mxEventType.CLICK, upSearchHandler);
        graph.removeCellOverlay(cell, upSearch);
        graph.addCellOverlay(cell, upSearch);
        return upSearch;
    }
    /**
     * @param {?} graph
     * @param {?} cell
     * @return {?}
     */
    addDownOverlay(graph, cell) {
        /** @type {?} */
        let downSearch = new CellOverlay(this.downSearchImage, this.localePipe.transform("downSearch"), mxConstantsType.ALIGN_RIGHT, mxConstantsType.ALIGN_MIDDLE, this.downSearchOffset, "hand");
        downSearch.state = CellOverlayState.Search;
        /** @type {?} */
        const downSearchHandler = (/**
         * @param {?} sender
         * @param {?} evt
         * @return {?}
         */
        (sender, evt) => {
            /** @type {?} */
            const resetView = evt.getProperty("resetView");
            /** @type {?} */
            const showLoading = evt.getProperty("showLoading") != null ? evt.getProperty("showLoading") : true;
            graph.getModel().beginUpdate();
            this.addDownAssoCell(graph, cell, resetView, showLoading);
            downSearch.image = this.downFolderImage;
            downSearch.tooltip = this.localePipe.transform("folder");
            downSearch.state = CellOverlayState.Fold;
            downSearch.removeListener(downSearchHandler);
            downSearch.addListener(mxEventType.CLICK, downFolderHandler);
            graph.removeCellOverlay(cell, downSearch);
            graph.addCellOverlay(cell, downSearch);
            // graph.refresh(cell);
            graph.getModel().endUpdate();
        });
        /** @type {?} */
        const downFolderHandler = (/**
         * @param {?} sender
         * @param {?} evt
         * @return {?}
         */
        (sender, evt) => {
            graph.getModel().beginUpdate();
            this.removeAssoCell(graph, cell, BillTrackerDirection.Down);
            downSearch.image = this.downSearchImage;
            downSearch.tooltip = this.localePipe.transform("downSearch");
            downSearch.state = CellOverlayState.Search;
            downSearch.removeListener(downFolderHandler);
            downSearch.addListener(mxEventType.CLICK, downSearchHandler);
            graph.removeCellOverlay(cell, downSearch);
            graph.addCellOverlay(cell, downSearch);
            // graph.refresh(cell);
            graph.getModel().endUpdate();
        });
        downSearch.addListener(mxEventType.CLICK, downSearchHandler);
        graph.removeCellOverlay(cell, downSearch);
        graph.addCellOverlay(cell, downSearch);
        return downSearch;
    }
    /**
     * @param {?} graph
     * @param {?} cell
     * @param {?=} resetView
     * @param {?=} showLoading
     * @return {?}
     */
    addUpAssoCell(graph, cell, resetView = false, showLoading = true) {
        graph.getModel().beginUpdate();
        /** @type {?} */
        const args = this.dataService.buildGetUpBillsInfoArgs(cell);
        /** @type {?} */
        const l = showLoading && (this.loading.clearAll(), this.loading.show({ message: this.localePipe.transform("loading") }));
        this.numCellsAddingReq++;
        this.dataService.getUpBillsInfo(args).subscribe((/**
         * @param {?} infos
         * @return {?}
         */
        (infos) => {
            /** @type {?} */
            let parent = graph.getDefaultParent();
            /** @type {?} */
            let newCells = [];
            // graph.getModel().beginUpdate();
            try {
                for (let info of infos) {
                    for (let dataInfo of info.billDataInfos) {
                        /** @type {?} */
                        let billCell = null;
                        /** @type {?} */
                        let bts = new BillTrackingSettings();
                        if (info && info.billTrackingSettings) {
                            bts.LoadFromJson(info.billTrackingSettings);
                        }
                        /** @type {?} */
                        let customStyle = "";
                        billCell = graph.insertBillCell(this.upParent, null, dataInfo, info, false, cell.geometry.x - this.hspace, cell.geometry.y, this.nodeWidth, this.nodeHeight, `billNode;${customStyle}`);
                        newCells.push(billCell);
                    }
                }
                this.calCellsPosition(graph, cell, newCells, BillTrackerDirection.Up);
                for (let nc of newCells) {
                    if (nc.billDataInfo.canContinueTracking) {
                        /** @type {?} */
                        const ol = this.addUpOverlay(graph, nc);
                        nc.upCellOverlay = ol;
                    }
                    graph.insertEdge(parent, null, '', nc, cell, "billAssociation;");
                }
                /** @type {?} */
                const oldGeo = this.entry.getGeometry().clone();
                this.upLayout.execute(this.upParent, this.entry);
                /** @type {?} */
                const newGeo = this.entry.getGeometry().clone();
                /** @type {?} */
                const dx = oldGeo.x - newGeo.x;
                /** @type {?} */
                const dy = oldGeo.y - newGeo.y;
                this.restoreEntryPosition(graph, this.entry, dx, dy);
                /** @type {?} */
                const cellData = (/** @type {?} */ (cell.data));
                cellData.ups.length = 0;
                for (let nc of newCells) {
                    /** @type {?} */
                    const cd = new UpCellData();
                    this.setCellData(cd, nc);
                    nc.data = cd;
                    cd.down = cellData;
                    cellData.ups.push(cd);
                }
            }
            finally {
                graph.getModel().endUpdate();
            }
            // 重绘画布大小
            resetView && graph.fireEvent(new mxEventObjectType(Events.RESET_GRAPH_VIEW));
            this.numCellsAddingReq--;
            // 自定义单据节点插入并移位后事件
            this.graph.fireEvent(new mxEventObjectType(Events.BILL_CELLS_ADDED_AND_MOVED, 'cells', newCells, 'parent', this.upParent));
            l && l.close();
        }), (/**
         * @param {?} err
         * @return {?}
         */
        (err) => {
            this.numCellsAddingReq--;
            l && l.close();
            this.messager.currentId == -1 && this.messager.error(err.error == null ? err.message : (err.error.Message || err.error.message || err.message));
            throw err;
        }));
    }
    /**
     * @param {?} graph
     * @param {?} cell
     * @param {?=} resetView
     * @param {?=} showLoading
     * @return {?}
     */
    addDownAssoCell(graph, cell, resetView = false, showLoading = true) {
        graph.getModel().beginUpdate();
        /** @type {?} */
        const args = this.dataService.buildGetDownBillsInfoArgs(cell);
        /** @type {?} */
        const l = showLoading && (this.loading.clearAll(), this.loading.show({ message: this.localePipe.transform("loading") }));
        this.numCellsAddingReq++;
        this.dataService.getDownBillsInfo(args).subscribe((/**
         * @param {?} infos
         * @return {?}
         */
        (infos) => {
            /** @type {?} */
            let model = graph.getModel();
            /** @type {?} */
            let parent = graph.getDefaultParent();
            /** @type {?} */
            let newCells = [];
            // graph.getModel().beginUpdate();
            try {
                for (let info of infos) {
                    for (let dataInfo of info.billDataInfos) {
                        /** @type {?} */
                        let billCell = null;
                        /** @type {?} */
                        let bts = new BillTrackingSettings();
                        if (info && info.billTrackingSettings) {
                            bts.LoadFromJson(info.billTrackingSettings);
                        }
                        /** @type {?} */
                        let customStyle = "";
                        billCell = graph.insertBillCell(this.downParent, null, dataInfo, info, false, cell.geometry.x + this.hspace, cell.geometry.y, this.nodeWidth, this.nodeHeight, `billNode;${customStyle}`);
                        newCells.push(billCell);
                    }
                }
                this.calCellsPosition(graph, cell, newCells, BillTrackerDirection.Down);
                for (let nc of newCells) {
                    if (nc.billDataInfo.canContinueTracking) {
                        /** @type {?} */
                        const ol = this.addDownOverlay(graph, nc);
                        nc.downCellOverlay = ol;
                    }
                    graph.insertEdge(parent, null, '', cell, nc, "billAssociation;");
                }
                /** @type {?} */
                const oldGeo = this.entry.getGeometry().clone();
                this.downLayout.execute(this.downParent, this.entry);
                /** @type {?} */
                const newGeo = this.entry.getGeometry().clone();
                /** @type {?} */
                const dx = oldGeo.x - newGeo.x;
                /** @type {?} */
                const dy = oldGeo.y - newGeo.y;
                this.restoreEntryPosition(graph, this.entry, dx, dy);
                /** @type {?} */
                const cellData = (/** @type {?} */ (cell.data));
                cellData.downs.length = 0;
                for (let nc of newCells) {
                    /** @type {?} */
                    const cd = new DownCellData();
                    this.setCellData(cd, nc);
                    nc.data = cd;
                    cd.up = cellData;
                    cellData.downs.push(cd);
                }
            }
            finally {
                graph.getModel().endUpdate();
            }
            // 重绘画布大小
            resetView && graph.fireEvent(new mxEventObjectType(Events.RESET_GRAPH_VIEW));
            this.numCellsAddingReq--;
            // 自定义单据节点插入并移位后事件
            this.graph.fireEvent(new mxEventObjectType(Events.BILL_CELLS_ADDED_AND_MOVED, 'cells', newCells, 'parent', this.downParent));
            l && l.close();
        }), (/**
         * @param {?} err
         * @return {?}
         */
        (err) => {
            this.numCellsAddingReq--;
            l && l.close();
            this.messager.currentId == -1 && this.messager.error(err.error == null ? err.message : (err.error.Message || err.error.message || err.message));
            throw err;
        }));
    }
    /**
     * @param {?} graph
     * @param {?} cell
     * @param {?} dir
     * @return {?}
     */
    removeAssoCell(graph, cell, dir) {
        /** @type {?} */
        const model = graph.getModel();
        /** @type {?} */
        const parent = graph.getDefaultParent();
        graph.getModel().beginUpdate();
        try {
            /** @type {?} */
            let assoCells = [];
            if (dir == BillTrackerDirection.Down) {
                /** @type {?} */
                let edges = model.getOutgoingEdges(cell);
                /** @type {?} */
                let i = 0;
                while (edges && edges.length > 0 && i < edges.length) {
                    if (edges[i].target && edges[i].target != this.entry) {
                        assoCells.push((/** @type {?} */ (edges[i].target)));
                        edges.push(...model.getOutgoingEdges(edges[i].target));
                    }
                    i++;
                }
            }
            else if (dir == BillTrackerDirection.Up) {
                /** @type {?} */
                let edges = model.getIncomingEdges(cell);
                /** @type {?} */
                let i = 0;
                while (edges && edges.length > 0 && i < edges.length) {
                    if (edges[i].source && edges[i].source != this.entry) {
                        assoCells.push((/** @type {?} */ (edges[i].source)));
                        edges.push(...model.getIncomingEdges(edges[i].source));
                    }
                    i++;
                }
            }
            if (dir == BillTrackerDirection.Down) {
                ((/** @type {?} */ (cell.data))).downs.length = 0;
            }
            else if (dir == BillTrackerDirection.Up) {
                ((/** @type {?} */ (cell.data))).ups.length = 0;
            }
            graph.removeCells(assoCells);
            /** @type {?} */
            const oldGeo = this.entry.getGeometry().clone();
            this.upLayout.execute(this.upParent, this.entry);
            /** @type {?} */
            const newGeo = this.entry.getGeometry().clone();
            /** @type {?} */
            const dx = oldGeo.x - newGeo.x;
            /** @type {?} */
            const dy = oldGeo.y - newGeo.y;
            this.restoreEntryPosition(graph, this.entry, dx, dy);
            /** @type {?} */
            const oldGeo2 = this.entry.getGeometry().clone();
            this.downLayout.execute(this.downParent, this.entry);
            /** @type {?} */
            const newGeo2 = this.entry.getGeometry().clone();
            /** @type {?} */
            const dx2 = oldGeo2.x - newGeo2.x;
            /** @type {?} */
            const dy2 = oldGeo2.y - newGeo2.y;
            this.restoreEntryPosition(graph, this.entry, dx2, dy2);
        }
        finally {
            graph.getModel().endUpdate();
        }
    }
    /**
     * @param {?} graph
     * @param {?} entry
     * @param {?} dx
     * @param {?} dy
     * @return {?}
     */
    restoreEntryPosition(graph, entry, dx, dy) {
        graph.getModel().beginUpdate();
        try {
            /** @type {?} */
            let vertices = null;
            vertices = [entry, ...graph.getChildCells(this.upParent, true, false), ...graph.getChildCells(this.downParent, true, false)];
            graph.moveCells(vertices, dx, dy);
        }
        finally {
            graph.getModel().endUpdate();
        }
    }
    /**
     * @param {?} graph
     * @param {?} cell
     * @param {?} newCells
     * @param {?} dir
     * @return {?}
     */
    calCellsPosition(graph, cell, newCells, dir) {
        if (dir == BillTrackerDirection.Down) {
            this.resetDownCellsPosition(graph, cell, newCells);
        }
        else if (dir == BillTrackerDirection.Up) {
            this.resetUpCellsPosition(graph, cell, newCells);
        }
    }
    /**
     * @param {?} graph
     * @param {?} cell
     * @param {?} newCells
     * @return {?}
     */
    resetDownCellsPosition(graph, cell, newCells) {
        graph.getModel().beginUpdate();
        try {
            /** @type {?} */
            let targets = graph.getOutgoingEdges(cell).map((/**
             * @param {?} edge
             * @return {?}
             */
            edge => edge.target));
            /** @type {?} */
            let deals = targets;
            //按纵坐标从大到小排序
            /** @type {?} */
            let temp = deals.sort((/**
             * @param {?} c1
             * @param {?} c2
             * @return {?}
             */
            (c1, c2) => c1.geometry && c2.geometry ? c2.geometry.y - c1.geometry.y : Number.MIN_VALUE));
            //最小纵坐标
            /** @type {?} */
            let minY = temp.length > 0 ? temp[temp.length - 1].geometry.y : cell.geometry.y;
            //最大纵坐标
            /** @type {?} */
            let maxY = temp.length > 0 ? temp[0].geometry.y : cell.geometry.y;
            //依次修改新插入节点的纵坐标
            for (let i = 0; i < newCells.length; i++) {
                maxY = deals.length > 0 ? maxY + this.vspace : maxY;
                graph.translateCell(newCells[i], 0, maxY - newCells[i].geometry.y);
                deals.push(newCells[i]);
            }
            /** @type {?} */
            let midY = (maxY + minY) / 2;
            /** @type {?} */
            let diffY = cell.geometry.y - midY;
            //依次修改所有点纵坐标
            deals.forEach((/**
             * @param {?} c
             * @return {?}
             */
            c => {
                graph.translateCell(c, 0, diffY);
            }));
            minY += diffY;
            maxY += diffY;
            midY += diffY;
            // 将<=midY的节点全部上移至minY-diffY,>=midY下移至maxY + diffY
            for (let key in graph.model.cells) {
                if (graph.model.cells[key] == graph.model.root || graph.model.cells[key].geometry == null || graph.model.cells[key].edge == true) {
                    continue;
                }
                if (graph.model.cells[key] == cell || newCells.indexOf((/** @type {?} */ (graph.model.cells[key]))) != -1) {
                    continue;
                }
                if (graph.model.cells[key] == this.entry) {
                    continue;
                }
                if (graph.model.cells[key].geometry.x < this.entry.geometry.x) {
                    continue;
                }
                /** @type {?} */
                const c = graph.model.cells[key];
                /** @type {?} */
                let geo = c.geometry;
                graph.translateCell(c, 0, geo.y <= cell.geometry.y ? minY - (cell.geometry.y - geo.y) - geo.y : maxY + (geo.y - cell.geometry.y) - geo.y);
            }
        }
        finally {
            graph.getModel().endUpdate();
        }
    }
    /**
     * @param {?} graph
     * @param {?} cell
     * @param {?} newCells
     * @return {?}
     */
    resetUpCellsPosition(graph, cell, newCells) {
        graph.getModel().beginUpdate();
        try {
            /** @type {?} */
            let sources = graph.getIncomingEdges(cell).map((/**
             * @param {?} edge
             * @return {?}
             */
            edge => edge.source));
            /** @type {?} */
            let deals = sources;
            //按纵坐标从大到小排序
            /** @type {?} */
            let temp = deals.sort((/**
             * @param {?} c1
             * @param {?} c2
             * @return {?}
             */
            (c1, c2) => c1.geometry && c2.geometry ? c2.geometry.y - c1.geometry.y : Number.MIN_VALUE));
            //最小纵坐标
            /** @type {?} */
            let minY = temp.length > 0 ? temp[temp.length - 1].geometry.y : cell.geometry.y;
            //最大纵坐标
            /** @type {?} */
            let maxY = temp.length > 0 ? temp[0].geometry.y : cell.geometry.y;
            //依次修改新插入节点的纵坐标
            for (let i = 0; i < newCells.length; i++) {
                maxY = deals.length > 0 ? maxY + this.vspace : maxY;
                graph.translateCell(newCells[i], 0, maxY - newCells[i].geometry.y);
                deals.push(newCells[i]);
            }
            /** @type {?} */
            let midY = (maxY + minY) / 2;
            /** @type {?} */
            let diffY = cell.geometry.y - midY;
            //依次修改所有点纵坐标
            deals.forEach((/**
             * @param {?} c
             * @return {?}
             */
            c => {
                graph.translateCell(c, 0, diffY);
            }));
            minY += diffY;
            maxY += diffY;
            midY += diffY;
            // 将<=midY的节点全部上移至minY-diffY,>=midY下移至maxY + diffY
            for (let key in graph.model.cells) {
                if (graph.model.cells[key] == graph.model.root || graph.model.cells[key].geometry == null || graph.model.cells[key].edge == true) {
                    continue;
                }
                if (graph.model.cells[key] == cell || newCells.indexOf((/** @type {?} */ (graph.model.cells[key]))) != -1) {
                    continue;
                }
                if (graph.model.cells[key] == this.entry) {
                    continue;
                }
                if (graph.model.cells[key].geometry.x > this.entry.geometry.x) {
                    continue;
                }
                /** @type {?} */
                const c = graph.model.cells[key];
                /** @type {?} */
                let geo = c.geometry;
                graph.translateCell(c, 0, geo.y <= cell.geometry.y ? minY - (cell.geometry.y - geo.y) - geo.y : maxY + (geo.y - cell.geometry.y) - geo.y);
            }
        }
        finally {
            graph.getModel().endUpdate();
        }
    }
    /**
     * @param {?} cellData
     * @param {?} cell
     * @return {?}
     */
    setCellData(cellData, cell) {
        cellData.billInfo = cell.billInfo;
        cellData.billDataInfo = cell.billDataInfo;
        cellData.visible = true;
        cellData.diagramInfo.x = cell.geometry.x;
        cellData.diagramInfo.y = cell.geometry.y;
        cellData.diagramInfo.width = cell.geometry.width;
        cellData.diagramInfo.height = cell.geometry.height;
        cellData.diagramInfo.extProps = {
            style: cell.style
        };
    }
    /**
     * @return {?}
     */
    zoomOut() {
        this.graph.zoomOut();
    }
    /**
     * @return {?}
     */
    zoomIn() {
        this.graph.zoomIn();
    }
    /**
     * @return {?}
     */
    zoomActual() {
        this.graph.zoomActual();
    }
    /**
     * @return {?}
     */
    getZoomScale() {
        return Math.round(this.graph.view.scale * 100);
    }
    /**
     * @return {?}
     */
    print() {
        /** @type {?} */
        const preview = new mxPrintPreviewType(this.graph, 1);
        preview.printOverlays = true;
        preview.printControls = true;
        preview.printBackgroundImage = true;
        preview.open(billTrackerCellCss);
    }
    /**
     * @param {?} direction
     * @param {?=} all
     * @return {?}
     */
    expand(direction, all = false) {
        if (all) {
            this.expandAll(direction);
            return;
        }
        if (direction == BillTrackerDirection.Up) {
            /** @type {?} */
            const cells = [this.entry];
            this.upParent.children && cells.push(...this.upParent.children);
            cells.forEach((/**
             * @param {?} cell
             * @return {?}
             */
            (cell) => {
                if (cell.upCellOverlay && cell.upCellOverlay.state == CellOverlayState.Search) {
                    cell.upCellOverlay.fireEvent(new mxEventObjectType(mxEventType.CLICK));
                }
            }));
        }
        else if (direction == BillTrackerDirection.Down) {
            /** @type {?} */
            const cells = [this.entry];
            this.downParent.children && cells.push(...this.downParent.children);
            cells.forEach((/**
             * @param {?} cell
             * @return {?}
             */
            (cell) => {
                if (cell.downCellOverlay && cell.downCellOverlay.state == CellOverlayState.Search) {
                    cell.downCellOverlay.fireEvent(new mxEventObjectType(mxEventType.CLICK));
                }
            }));
        }
    }
    /**
     * @param {?} direction
     * @return {?}
     */
    expandAll(direction) {
        if (direction != BillTrackerDirection.Up && direction != BillTrackerDirection.Down) {
            return;
        }
        // 单据节点添加并移位后事件监听器
        /** @type {?} */
        let afterBillCellsAddedAndMoved = null;
        if (direction == BillTrackerDirection.Up) {
            afterBillCellsAddedAndMoved = (/**
             * @return {?}
             */
            () => {
                /** @type {?} */
                const cells = [this.entry];
                this.upParent.children && cells.push(...this.upParent.children);
                /** @type {?} */
                const canTrackUpCells = cells.filter((/**
                 * @param {?} cell
                 * @return {?}
                 */
                (cell) => {
                    return cell.upCellOverlay && cell.upCellOverlay.state == CellOverlayState.Search;
                }));
                // 没有可上查节点且没有正在执行的上查请求时删除监听器
                if (canTrackUpCells == null || canTrackUpCells.length == 0) {
                    if (this.numCellsAddingReq === 0) {
                        // console.log("移除监听器");
                        l && l.close();
                        this.graph.removeListener(afterBillCellsAddedAndMoved);
                        // console.timeEnd("ExpandAll");
                    }
                }
                else {
                    canTrackUpCells.forEach((/**
                     * @param {?} cell
                     * @return {?}
                     */
                    (cell) => {
                        if (cell.upCellOverlay && cell.upCellOverlay.state == CellOverlayState.Search) {
                            cell.upCellOverlay.fireEvent(new mxEventObjectType(mxEventType.CLICK, "showLoading", false));
                        }
                    }));
                }
            });
        }
        else if (direction == BillTrackerDirection.Down) {
            afterBillCellsAddedAndMoved = (/**
             * @return {?}
             */
            () => {
                /** @type {?} */
                const cells = [this.entry];
                this.downParent.children && cells.push(...this.downParent.children);
                /** @type {?} */
                const canTrackDownCells = cells.filter((/**
                 * @param {?} cell
                 * @return {?}
                 */
                (cell) => {
                    return cell.downCellOverlay && cell.downCellOverlay.state == CellOverlayState.Search;
                }));
                // 没有可下查节点且没有正在执行的下查请求时删除监听器
                if (canTrackDownCells == null || canTrackDownCells.length == 0) {
                    if (this.numCellsAddingReq === 0) {
                        // console.log("移除监听器");
                        l && l.close();
                        this.graph.removeListener(afterBillCellsAddedAndMoved);
                        // console.timeEnd("ExpandAll");
                    }
                }
                else {
                    canTrackDownCells.forEach((/**
                     * @param {?} cell
                     * @return {?}
                     */
                    (cell) => {
                        if (cell.downCellOverlay && cell.downCellOverlay.state == CellOverlayState.Search) {
                            cell.downCellOverlay.fireEvent(new mxEventObjectType(mxEventType.CLICK, "showLoading", false));
                        }
                    }));
                }
            });
        }
        // console.time("ExpandAll");
        // 添加监听器
        // console.log("添加监听器");
        this.graph.addListener("billCellsAddedAndMoved", afterBillCellsAddedAndMoved);
        // 直接触发一次展开事件
        /** @type {?} */
        const l = this.loading.show({ message: this.localePipe.transform("loading") });
        afterBillCellsAddedAndMoved();
    }
    /**
     * 继续追踪
     * @param {?} cell
     * @return {?}
     */
    goOnTrack(cell) {
        /** @type {?} */
        const billTrackerUiService = this.inj.get(BillTrackerUiService);
        // 构造查询参数
        /** @type {?} */
        let args = new GetBillsInfoArgs();
        args.billDataId = cell.billDataInfo.dataId;
        args.curYear = cell.billDataInfo.curYear;
        args.bizKind = cell.billInfo.bizKind;
        args.bizType = cell.billInfo.bizType;
        args.documentTypeId = cell.billInfo.documentTypeId;
        // args.billChildInfos = cell.billDataInfo.billChildInfos;
        // // 如果又回到了最原始的当前节点
        // if (cell.billDataInfo.dataId == this.originBillTrackerArgs.getBillsInfoArgs.billDataId) {
        //   args = this.originBillTrackerArgs.getBillsInfoArgs;
        // }
        /** @type {?} */
        const modalOptions = {
            title: this.localePipe.transform("billTracker"),
        };
        /** @type {?} */
        const graphOptions = {
            // // 上查结果节点没有下查按钮，继续追踪时默认下查
            // showDownBills: cell.downCellOverlay == null,
            // // 下查结果节点没有上查按钮，继续追踪时默认上查
            // showUpBills: cell.upCellOverlay == null,
            showDownBills: true,
            showUpBills: true,
        };
        /** @type {?} */
        const gridOptions = {
        // // 此选项仅控制首次打开时行为
        // showEntryData: false,
        // // 数据区高度1px相当于不显示
        // defaultHeight: 1,
        };
        billTrackerUiService.openDefaultBillTrackerApp(args, graphOptions, gridOptions);
        // billTrackerUiService.openDefaultBillTrackerDialog(args, false, modalOptions, graphOptions, gridOptions).subscribe();
    }
    /**
     * 设为当前
     * @param {?} cell
     * @return {?}
     */
    setAsCurrent(cell) {
        /** @type {?} */
        let args = this.dataService.buildGetBillsInfoArgs(cell);
        // // 如果又回到了最原始的当前节点
        // if (cell.billDataInfo.dataId == this.originBillTrackerArgs.getBillsInfoArgs.billDataId) {
        //   args = this.originBillTrackerArgs.getBillsInfoArgs;
        // }
        /** @type {?} */
        const downArgs = new GetDownBillsInfoArgs();
        downArgs.documentTypeId = args.documentTypeId;
        downArgs.billDataId = args.billDataId;
        downArgs.bizKind = args.bizKind;
        downArgs.bizType = args.bizType;
        // downArgs.billChildInfos = args.billChildInfos;
        downArgs.curYear = args.curYear;
        this.loading.show({ message: this.localePipe.transform("loading") });
        this.dataService.canTracking(downArgs).subscribe((/**
         * @param {?} res
         * @return {?}
         */
        (res) => {
            this.loading.close();
            if (!res.canDownTracking && !res.canUpTracking) {
                this.messager.info(this.localePipe.transform("noAssoBill"));
                return;
            }
            /** @type {?} */
            const billTrackerArgs = new BillTrackerArgs();
            billTrackerArgs.canTrackingResult = res;
            billTrackerArgs.getBillsInfoArgs = args;
            billTrackerArgs.graphOptions = this.billTrackerArgs.graphOptions;
            billTrackerArgs.gridOptions = this.billTrackerArgs.gridOptions;
            this.billTrackerArgs = billTrackerArgs;
            this.repaintGraph(this.graph);
        }), (/**
         * @param {?} err
         * @return {?}
         */
        (err) => {
            this.loading.close();
            //todo 确定异常结构, 目前采用兼容取值方式
            this.messager.error(err.error == null ? err.message : (err.error.Message || err.error.message || err.message));
            throw err;
        }));
    }
}
BillTrackerGraphComponent.decorators = [
    { type: Component, args: [{
                selector: 'lib-bill-tracker-graph',
                template: "<div #mxContainer id=\"mx-container\" class=\"mx-container-ng\">\r\n\r\n</div>\r\n\r\n<div #mxOutlineContainer id=\"mx-outline-container\" class=\"mx-outline-container\" [style.top]=\"modalRef?'50px':null\">\r\n\r\n</div>",
                styles: [".mx-container-ng{position:absolute;top:0;left:0;bottom:0;right:0;cursor:default;overflow:auto;padding-right:16px;padding-bottom:16px;margin:4px}.mx-outline-container{z-index:1;position:absolute;overflow:hidden;top:20px;right:20px;width:160px;height:120px;background:#fff;border:1px solid #d3d3d3}"]
            }] }
];
/** @nocollapse */
BillTrackerGraphComponent.ctorParameters = () => [
    { type: BillTrackerArgs },
    { type: String, decorators: [{ type: Inject, args: [LOCALE_ID,] }] },
    { type: BillTrackerDataService },
    { type: NotifyService },
    { type: MessagerService },
    { type: LoadingService },
    { type: BsModalService },
    { type: ViewContainerRef },
    { type: Injector },
    { type: ComponentFactoryResolver },
    { type: ChangeDetectorRef }
];
BillTrackerGraphComponent.propDecorators = {
    mxContainerER: [{ type: ViewChild, args: ["mxContainer",] }],
    mxOutlineContainer: [{ type: ViewChild, args: ["mxOutlineContainer",] }],
    selectEventEmitter: [{ type: Output, args: ["select",] }],
    stateChangeEventEmitter: [{ type: Output, args: ["stateChange",] }],
    billTrackerArgs: [{ type: Input, args: ["billTrackerArgs",] }]
};

/**
 * @fileoverview added by tsickle
 * Generated from: lib/bill-tracker/components/basic-table/BillFrontField.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
class BillFrontField {
}

/**
 * @fileoverview added by tsickle
 * Generated from: lib/bill-tracker/components/basic-table/BillFrontDataRow.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
class BillFrontDataRow {
}

/**
 * @fileoverview added by tsickle
 * Generated from: lib/bill-tracker/components/basic-table/basic-table.component.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
class BasicTableComponent {
    /**
     * @param {?} viewContainerRef
     * @param {?} inj
     * @param {?} cfr
     * @param {?} cdr
     */
    constructor(viewContainerRef, inj, cfr, cdr) {
        this.viewContainerRef = viewContainerRef;
        this.inj = inj;
        this.cfr = cfr;
        this.cdr = cdr;
    }
    /**
     * @return {?}
     */
    ngOnInit() {
    }
    /**
     * @param {?} item
     * @param {?} evt
     * @return {?}
     */
    clickHandler(item, evt) {
        item['expanded'] = !item['expanded'];
    }
    /**
     * @param {?} res
     * @return {?}
     */
    showMainTable(res) {
        this.showTable(res.billSchema.mainTable, res.billData.mainTable);
    }
    /**
     * @param {?} schemaTable
     * @param {?} dataTable
     * @return {?}
     */
    showTable(schemaTable, dataTable) {
        this.billSchemaTable = schemaTable;
        this.billDataTable = dataTable;
        this.loadData(schemaTable.getFieldList(), dataTable.GetRowList());
        this.cdr.detectChanges();
    }
    /**
     * @param {?} billSchemaFields
     * @param {?} billDataRows
     * @return {?}
     */
    loadData(billSchemaFields, billDataRows) {
        this.fields = billSchemaFields;
        this.rows = billDataRows;
        /** @type {?} */
        let bts = new BillTrackingSettings();
        if (this.billInfo && this.billInfo.billTrackingSettings) {
            bts.LoadFromJson(this.billInfo.billTrackingSettings);
        }
        if (bts.billTrackingDataShownMode == BillTrackingDataShownMode.CUSTOMFIELD) {
            this.ffields = this.extractFFieldsWithCustomFields(billSchemaFields, bts.customFieldContent);
            this.frows = this.extractFRows(billDataRows, this.ffields);
        }
        else {
            this.ffields = this.extractFFields(billSchemaFields);
            this.frows = this.extractFRows(billDataRows, this.ffields);
        }
    }
    /**
     * 默认展示方式
     * @private
     * @param {?} fields
     * @return {?}
     */
    extractFFields(fields) {
        /** @type {?} */
        let ffields = [];
        for (let field of fields) {
            //枚举或者枚举型单值UDT时默认取Name
            if (field.fieldType == "Enum" || field.fieldType == "EnumSingleUdt") {
                /** @type {?} */
                let ff = new BillFrontField();
                ff.fieldName = field.fieldName;
                ff.dataType = field.dataType;
                ff.caption = field.caption;
                ff.fieldType = field.fieldType;
                ff.length = field.length;
                ff.precision = field.precision;
                ff.scale = field.scale;
                ff.captionPath = this.extractCaptionPath(field);
                ff.fieldPath = this.extractFieldPath(field) + ".Name";
                ffields.push(ff);
            }
            else if (field.GetSubFieldList() != null && field.GetSubFieldList().length > 0) {
                ffields.push(...this.extractFSubFields(field.GetSubFieldList()));
            }
            else {
                /** @type {?} */
                let ff = new BillFrontField();
                ff.fieldName = field.fieldName;
                ff.dataType = field.dataType;
                ff.caption = field.caption;
                ff.fieldType = field.fieldType;
                ff.length = field.length;
                ff.precision = field.precision;
                ff.scale = field.scale;
                ff.captionPath = this.extractCaptionPath(field);
                ff.fieldPath = this.extractFieldPath(field);
                ffields.push(ff);
            }
        }
        return ffields;
    }
    /**
     * @private
     * @param {?} fields
     * @param {?=} parentField
     * @return {?}
     */
    extractFSubFields(fields, parentField) {
        /** @type {?} */
        let ffields = [];
        for (let field of fields) {
            //枚举或者枚举型单值UDT时默认取Name
            if (field.fieldType == "Enum" || field.fieldType == "EnumSingleUdt") {
                /** @type {?} */
                let ff = new BillFrontField();
                ff.fieldName = field.fieldName;
                ff.dataType = field.dataType;
                ff.caption = field.caption;
                ff.fieldType = field.fieldType;
                ff.length = field.length;
                ff.precision = field.precision;
                ff.scale = field.scale;
                ff.captionPath = this.extractCaptionPath(field);
                ff.fieldPath = this.extractFieldPath(field) + ".Name";
                ffields.push(ff);
            }
            else if (field.GetSubFieldList() != null && field.GetSubFieldList().length > 0) {
                ffields.push(...this.extractFSubFields(field.GetSubFieldList()));
            }
            else {
                /** @type {?} */
                let ff = new BillFrontField();
                ff.fieldName = field.fieldName;
                ff.dataType = field.dataType;
                ff.caption = field.caption;
                ff.fieldType = field.fieldType;
                ff.length = field.length;
                ff.precision = field.precision;
                ff.scale = field.scale;
                ff.captionPath = this.extractCaptionPath(field);
                ff.fieldPath = this.extractFieldPath(field);
                ffields.push(ff);
            }
        }
        return ffields;
    }
    /**
     * 自定义字段展示方式
     * @private
     * @param {?} fields
     * @param {?} fieldContent
     * @return {?}
     */
    extractFFieldsWithCustomFields(fields, fieldContent) {
        // 表code
        /** @type {?} */
        const tableCode = this.billSchemaTable.tableName;
        // 单据追踪配置
        /** @type {?} */
        let bts = new BillTrackingSettings();
        if (this.billInfo && this.billInfo.billTrackingSettings) {
            bts.LoadFromJson(this.billInfo.billTrackingSettings);
        }
        /** @type {?} */
        let fieldConfig = typeof fieldContent == "object" ? fieldContent : JSON.parse(fieldContent);
        /** @type {?} */
        let ffields = [];
        for (let field of fields) {
            // 字段ID
            /** @type {?} */
            const fieldPath = this.extractFieldPath(field);
            /** @type {?} */
            let sf = null;
            for (let k in fieldConfig.schema) {
                if (k == 'selectedAll') {
                    continue;
                }
                if (k == tableCode) {
                    /** @type {?} */
                    const s = fieldConfig.schema[k];
                    sf = s && s.fields.find((/**
                     * @param {?} elt
                     * @return {?}
                     */
                    (elt) => elt.fieldPath == fieldPath));
                    break;
                }
            }
            if (sf == null) {
                continue;
            }
            //枚举或者枚举型单值UDT时默认取Name
            if (field.fieldType == "Enum" || field.fieldType == "EnumSingleUdt") {
                /** @type {?} */
                let ff = new BillFrontField();
                ff.fieldName = field.fieldName;
                ff.dataType = field.dataType;
                ff.caption = field.caption;
                ff.fieldType = field.fieldType;
                ff.length = field.length;
                ff.precision = field.precision;
                ff.scale = field.scale;
                ff.captionPath = sf.displayName || field.caption;
                ff.fieldPath = this.extractFieldPath(field) + ".Name";
                ffields.push(ff);
            }
            else if (field.GetSubFieldList() != null && field.GetSubFieldList().length > 0) {
                ffields.push(...this.extractFSubFieldsWithCustomFields(field.GetSubFieldList(), fieldContent, field));
            }
            else {
                /** @type {?} */
                let ff = new BillFrontField();
                ff.fieldName = field.fieldName;
                ff.dataType = field.dataType;
                ff.caption = field.caption;
                ff.fieldType = field.fieldType;
                ff.length = field.length;
                ff.precision = field.precision;
                ff.scale = field.scale;
                ff.captionPath = sf.displayName || field.caption;
                ff.fieldPath = this.extractFieldPath(field);
                ffields.push(ff);
            }
        }
        return ffields;
    }
    /**
     * @private
     * @param {?} fields
     * @param {?} fieldContent
     * @param {?=} parentField
     * @return {?}
     */
    extractFSubFieldsWithCustomFields(fields, fieldContent, parentField) {
        // 表编号
        /** @type {?} */
        const tableCode = this.billSchemaTable.tableName;
        // 单据追踪配置
        /** @type {?} */
        let bts = new BillTrackingSettings();
        if (this.billInfo && this.billInfo.billTrackingSettings) {
            bts.LoadFromJson(this.billInfo.billTrackingSettings);
        }
        /** @type {?} */
        let fieldConfig = typeof fieldContent == "object" ? fieldContent : JSON.parse(fieldContent);
        /** @type {?} */
        let ffields = [];
        for (let field of fields) {
            // 字段ID
            /** @type {?} */
            const fieldPath = this.extractFieldPath(field);
            /** @type {?} */
            let sf = null;
            for (let k in fieldConfig.schema) {
                if (k == 'selectedAll') {
                    continue;
                }
                if (k == tableCode) {
                    /** @type {?} */
                    const s = fieldConfig.schema[k];
                    sf = s && s.fields.find((/**
                     * @param {?} elt
                     * @return {?}
                     */
                    (elt) => elt.fieldPath == fieldPath));
                    break;
                }
            }
            if (sf == null) {
                continue;
            }
            //枚举或者枚举型单值UDT时默认取Name
            if (field.fieldType == "Enum" || field.fieldType == "EnumSingleUdt") {
                /** @type {?} */
                let ff = new BillFrontField();
                ff.fieldName = field.fieldName;
                ff.dataType = field.dataType;
                ff.caption = field.caption;
                ff.fieldType = field.fieldType;
                ff.length = field.length;
                ff.precision = field.precision;
                ff.scale = field.scale;
                ff.captionPath = sf.displayName || field.caption;
                ff.fieldPath = this.extractFieldPath(field) + ".Name";
                ffields.push(ff);
            }
            else if (field.GetSubFieldList() != null && field.GetSubFieldList().length > 0) {
                ffields.push(...this.extractFSubFieldsWithCustomFields(field.GetSubFieldList(), fieldContent, field));
            }
            else {
                /** @type {?} */
                let ff = new BillFrontField();
                ff.fieldName = field.fieldName;
                ff.dataType = field.dataType;
                ff.caption = field.caption;
                ff.fieldType = field.fieldType;
                ff.length = field.length;
                ff.precision = field.precision;
                ff.scale = field.scale;
                ff.captionPath = sf.displayName || field.caption;
                ff.fieldPath = this.extractFieldPath(field);
                ffields.push(ff);
            }
        }
        return ffields;
    }
    /**
     * @private
     * @param {?} field
     * @return {?}
     */
    extractCaptionPath(field) {
        /** @type {?} */
        let s = field.caption;
        /** @type {?} */
        let tmp = (/** @type {?} */ (field));
        while (tmp.attachedField != null) {
            s = tmp.attachedField.caption + "." + s;
            tmp = (/** @type {?} */ (tmp.attachedField));
        }
        return s;
    }
    /**
     * @private
     * @param {?} field
     * @return {?}
     */
    extractFieldPath(field) {
        /** @type {?} */
        let s = field.fieldName;
        /** @type {?} */
        let tmp = (/** @type {?} */ (field));
        while (tmp.attachedField != null) {
            s = tmp.attachedField.fieldName + "." + s;
            tmp = (/** @type {?} */ (tmp.attachedField));
        }
        return s;
    }
    /**
     * @private
     * @param {?} rows
     * @param {?} ffields
     * @return {?}
     */
    extractFRows(rows, ffields) {
        /** @type {?} */
        let frows = [];
        for (let row of rows) {
            /** @type {?} */
            let fr = new BillFrontDataRow();
            fr.expanded = row.GetChildTableList().length == 0 ? null : row.attachedTable && row.attachedTable.attachedRow == null ? true : false;
            fr.hasChildren = this.hasChildren(row);
            fr.data = {};
            for (let ff of ffields) {
                fr.data[ff.fieldPath] = this.extractFieldPathValue(row.GetFieldMap(), ff.fieldPath);
            }
            frows.push(fr);
        }
        return frows;
    }
    /**
     * @param {?} row
     * @return {?}
     */
    hasChildren(row) {
        /** @type {?} */
        let flag = row.GetChildTableList() && row.GetChildTableList().length > 0;
        if (flag) {
            /** @type {?} */
            let cf = false;
            for (let ct of row.GetChildTableList()) {
                if (ct.GetRowList() && ct.GetRowList().length > 0) {
                    cf = true;
                    break;
                }
            }
            flag = cf;
        }
        return flag;
    }
    /**
     * @param {?} billDataFieldMap
     * @param {?} fieldPath
     * @return {?}
     */
    extractFieldPathValue(billDataFieldMap, fieldPath) {
        /** @type {?} */
        let fields = fieldPath.split(".");
        /** @type {?} */
        let bdf = billDataFieldMap[fields[0]];
        for (let i = 1; bdf != null && i < fields.length; i++) {
            /** @type {?} */
            const temp = bdf.GetSubFieldMap();
            if (temp == null) {
                break;
            }
            bdf = temp[fields[i]];
        }
        return bdf ? bdf.GetTextValue() : "";
    }
    /**
     * @param {?} obj
     * @param {?} ffield
     * @return {?}
     */
    getShownText(obj, ffield) {
        if (obj[ffield.fieldPath] == null) {
            return "";
        }
        if (ffield.dataType == DataType.String) {
            return obj[ffield.fieldPath] || "";
        }
        else if (ffield.dataType == DataType.Decimal) {
            /** @type {?} */
            let dec = parseFloat(String(obj[ffield.fieldPath])).toFixed(ffield.scale).toString();
            return dec || "";
        }
        else if (ffield.dataType == DataType.DateTime) {
            /** @type {?} */
            let date = BpmnModelJsonHelper.DateTimeFromString(obj[ffield.fieldPath]);
            if (ffield.fieldType == "DateTime") {
                return this.dateFormat(date, "yyyy-MM-dd HH:mm:ss.SSS");
            }
            else if (ffield.fieldType == "Date") {
                return this.dateFormat(date, "yyyy-MM-dd");
            }
            else {
                return this.dateFormat(date, "yyyy-MM-dd");
            }
        }
        else {
            return obj[ffield.fieldPath] || "";
        }
    }
    /**
     * @param {?} obj
     * @return {?}
     */
    isObject(obj) {
        return typeof (obj) == "object";
    }
    /**
     * @param {?} obj
     * @return {?}
     */
    isArray(obj) {
        return Array.isArray(obj);
    }
    /**
     * @private
     * @param {?} date
     * @param {?} fmt
     * @return {?}
     */
    dateFormat(date, fmt) {
        /** @type {?} */
        let ret;
        /** @type {?} */
        const opt = {
            "y+": date.getUTCFullYear().toString(),
            // 年
            "M+": (date.getUTCMonth() + 1).toString(),
            // 月
            "d+": date.getUTCDate().toString(),
            // 日
            "H+": date.getUTCHours().toString(),
            // 时
            "m+": date.getUTCMinutes().toString(),
            // 分
            "s+": date.getUTCSeconds().toString(),
            // 秒
            "S+": date.getUTCMilliseconds().toString(),
        };
        for (let k in opt) {
            ret = new RegExp("(" + k + ")").exec(fmt);
            if (ret) {
                if (!String.prototype.padStart) {
                    fmt = fmt.replace(ret[1], (ret[1].length == 1) ? (opt[k]) : (this.myPadStart(opt[k], ret[1].length, "0")));
                }
                else {
                    fmt = fmt.replace(ret[1], (ret[1].length == 1) ? (opt[k]) : (opt[k].padStart(ret[1].length, "0")));
                }
            }
        }
        return fmt;
    }
    /**
     * @private
     * @param {?} src
     * @param {?} targetLength
     * @param {?} padString
     * @return {?}
     */
    myPadStart(src, targetLength, padString) {
        targetLength = targetLength >> 0; //floor if number or convert non-number to 0;
        padString = String(typeof padString !== 'undefined' ? padString : ' ');
        if (src.length > targetLength) {
            return String(src);
        }
        else {
            targetLength = targetLength - src.length;
            if (targetLength > padString.length) {
                padString += padString.repeat(targetLength / padString.length); //append to original to ensure we are longer than needed
            }
            return padString.slice(0, targetLength) + String(src);
        }
    }
}
BasicTableComponent.decorators = [
    { type: Component, args: [{
                selector: "app-basic-table",
                template: "<table class=\"table table-striped table-hover text-nowrap\" [ngStyle]=\"{'margin-left': isMain ? null : '24px'}\"\r\n    style=\"min-width: 100%; width: auto;\" *ngIf=\"ffields && ffields.length > 0 && frows && frows.length > 0\">\r\n    <thead class=\"thead-light\">\r\n        <tr>\r\n            <th style=\"width: 40px;\"><span></span></th>\r\n            <th *ngFor=\"let ffield of ffields\">\r\n                <span>{{ffield.captionPath}}</span>\r\n            </th>\r\n        </tr>\r\n    </thead>\r\n    <tbody>\r\n        <ng-container *ngFor=\"let frow of frows;let rowIdx = index;\">\r\n            <tr #tr>\r\n                <td>\r\n                    <span *ngIf=\"frow.hasChildren\" style=\"cursor:pointer;\" (click)=\"clickHandler(frow, $event)\"\r\n                        [ngClass]=\"{'k-icon': true, 'k-i-plus-outline': !frow.expanded, 'k-i-minus-outline': frow.expanded}\"></span>\r\n                </td>\r\n                <ng-container *ngFor=\"let ffield of ffields\">\r\n                    <td>\r\n                        <span>{{getShownText(frow.data, ffield)}}</span>\r\n                        <span *ngIf=\"ffield.showMore\" class=\"f-icon f-icon-more\"></span>\r\n                    </td>\r\n                </ng-container>\r\n            </tr>\r\n            <tr *ngIf=\"frow.expanded&&frow.hasChildren\">\r\n                <td [attr.colspan]=\"tr.cells.length\">\r\n                    <ng-container appChildRowTable [parentRow]=\"rows[rowIdx]\" [parentSchemaTable]=\"billSchemaTable\"\r\n                        [parentDataTable]=\"billDataTable\" [billInfo]=\"billInfo\" [expanded]=\"frow.expanded\"\r\n                        [colspan]=\"tr.cells.length\">\r\n                    </ng-container>\r\n                </td>\r\n            </tr>\r\n        </ng-container>\r\n    </tbody>\r\n    <tfoot>\r\n    </tfoot>\r\n</table>",
                changeDetection: ChangeDetectionStrategy.OnPush,
                styles: ["./basic-table.component.css"]
            }] }
];
/** @nocollapse */
BasicTableComponent.ctorParameters = () => [
    { type: ViewContainerRef },
    { type: Injector },
    { type: ComponentFactoryResolver },
    { type: ChangeDetectorRef }
];
BasicTableComponent.propDecorators = {
    childTrTable: [{ type: ViewChild, args: ["childTrTable",] }],
    childTrTableVCR: [{ type: ViewChild, args: ["childTrTable", { read: ViewContainerRef },] }]
};

/**
 * @fileoverview added by tsickle
 * Generated from: lib/bill-tracker/services/bill-tracker-internal-ui.service.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
class BillTrackerInternalUiService {
    /**
     * @param {?} framework
     * @param {?} messager
     * @param {?} loading
     * @param {?} localeId
     * @param {?} dataService
     * @param {?} dataInfoService
     * @param {?} modalService
     * @param {?} cfr
     * @param {?} injector
     * @param {?} localePipe
     */
    constructor(framework, messager, loading, localeId, dataService, dataInfoService, modalService, cfr, injector, localePipe) {
        this.framework = framework;
        this.messager = messager;
        this.loading = loading;
        this.dataService = dataService;
        this.dataInfoService = dataInfoService;
        this.modalService = modalService;
        this.cfr = cfr;
        this.injector = injector;
        this.localePipe = localePipe;
    }
    /**
     * @param {?} billInfo
     * @param {?} billDataInfo
     * @return {?}
     */
    openBillDetail(billInfo, billDataInfo) {
        /** @type {?} */
        const jointQueryMode = billInfo.jointQueryMode;
        /** @type {?} */
        const jointQueryParameters = JSON.parse(billInfo.jointQueryParameters);
        /** @type {?} */
        const id = billDataInfo.dataId;
        if (this.dataService.hasDynamicParams(jointQueryParameters)) {
            /** @type {?} */
            const args = this.dataService.buildGetJointQueryParametersArgs(jointQueryParameters, billInfo, billDataInfo);
            /** @type {?} */
            const l = this.loading.show({ message: this.localePipe.transform("loading") });
            this.dataService.getJointQueryParameters(args).subscribe((/**
             * @param {?} results
             * @return {?}
             */
            (results) => {
                l.close();
                if (jointQueryMode == JointQueryMode.APP) {
                    this.openMenu(jointQueryParameters, id, results);
                }
                else if (jointQueryMode == JointQueryMode.URL) {
                    this.openUrl(jointQueryParameters, id, results);
                }
            }), (/**
             * @param {?} err
             * @return {?}
             */
            (err) => {
                l.close();
                //todo 确定异常结构, 目前采用兼容取值方式
                this.messager.error(err.error == null ? err.message : (err.error.Message || err.error.message || err.message));
                throw err;
            }));
        }
        else {
            if (jointQueryMode == JointQueryMode.APP) {
                this.openMenu(jointQueryParameters, id);
            }
            else if (jointQueryMode == JointQueryMode.URL) {
                this.openUrl(jointQueryParameters, id);
            }
        }
    }
    /**
     * @param {?} billInfo
     * @param {?} billDataInfo
     * @param {?} fieldsWithValue
     * @return {?}
     */
    openBillDetailWithFields(billInfo, billDataInfo, fieldsWithValue) {
        /** @type {?} */
        const id = billDataInfo.dataId;
        /** @type {?} */
        const jointQueryMode = billInfo.jointQueryMode;
        /** @type {?} */
        const jointQueryParameters = JSON.parse(billInfo.jointQueryParameters);
        if (this.dataService.hasDynamicParams(jointQueryParameters)) {
            /** @type {?} */
            const l = this.loading.show({ message: this.localePipe.transform("loading") });
            /** @type {?} */
            const args = this.dataService.buildGetJointQueryParametersArgs(jointQueryParameters, billInfo, billDataInfo);
            this.dataService.getJointQueryParameters(args).subscribe((/**
             * @param {?} results
             * @return {?}
             */
            (results) => {
                l.close();
                if (jointQueryMode == JointQueryMode.APP) {
                    this.openMenu(jointQueryParameters, id, results);
                }
                else if (jointQueryMode == JointQueryMode.URL) {
                    this.openUrl(jointQueryParameters, id, results);
                }
            }), (/**
             * @param {?} err
             * @return {?}
             */
            (err) => {
                l.close();
                //todo 确定异常结构, 目前采用兼容取值方式
                this.messager.error(err.error == null ? err.message : (err.error.Message || err.error.message || err.message));
                throw err;
            }));
        }
        else {
            if (jointQueryMode == JointQueryMode.APP) {
                this.openMenu(jointQueryParameters, id);
            }
            else if (jointQueryMode == JointQueryMode.URL) {
                this.openUrl(jointQueryParameters, id);
            }
        }
    }
    /**
     * 直接打开菜单
     * @param {?} jointQueryParameters
     * @param {?} id
     * @param {?=} jqpr
     * @return {?}
     */
    openMenu(jointQueryParameters, id, jqpr) {
        /** @type {?} */
        const entityParams = {};
        entityParams["id"] = id;
        entityParams["action"] = "LoadAndView1";
        /** @type {?} */
        const map$$1 = new Map();
        map$$1.set("id", id);
        map$$1.set("action", "LoadAndView1");
        this.buildOpenMenuParams(jointQueryParameters, map$$1, entityParams, jqpr);
        // 从entityParam取自定义tab名，然后删除此属性防止带入url
        /** @type {?} */
        let tabName = entityParams && entityParams[BillTrackerConstant.BILL_VIEWER_PARAM_CODE_CUSTOM_TAB_NAME];
        if (entityParams && entityParams[BillTrackerConstant.BILL_VIEWER_PARAM_CODE_CUSTOM_TAB_NAME]) {
            delete entityParams[BillTrackerConstant.BILL_VIEWER_PARAM_CODE_CUSTOM_TAB_NAME];
            map$$1.delete(BillTrackerConstant.BILL_VIEWER_PARAM_CODE_CUSTOM_TAB_NAME);
        }
        /** @type {?} */
        const WEB_FORM_ROUTE_PARAMS = encodeURIComponent(JSON.stringify(entityParams));
        map$$1.set("WEB_FORM_ROUTE_PARAMS", WEB_FORM_ROUTE_PARAMS);
        /** @type {?} */
        const opts = {
            appType: AppType.Menu,
            funcId: jointQueryParameters.funcId,
            appEntrance: null,
            appId: null,
            tabId: id,
            entityParams: entityParams,
            queryStringParams: map$$1,
        };
        if (tabName) {
            // 页签名称超长时给出提醒并仅取前200个字符
            if (tabName.length > 200) {
                this.messager.warning(this.localePipe.transform("tabNameLengthIsTooLong"));
                tabName = tabName.substring(0, 200);
            }
            opts.tabName = tabName;
        }
        this.framework.openMenu(opts);
    }
    /**
     * 借助单据查看容器打开url
     * @param {?} jointQueryParameters
     * @param {?} id
     * @param {?=} jqpr
     * @return {?}
     */
    openUrl(jointQueryParameters, id, jqpr) {
        // console.log("open default container for url");
        // console.log("open default container for url");
        /** @type {?} */
        let url = this.appendQueryParam(jointQueryParameters.url, "id", id);
        url = this.appendQueryParam(url, "action", 'LoadAndView1');
        // 用于填充cvft，否则服务器端控制台报错
        /** @type {?} */
        const timestamp = new Date().getTime().toString();
        url = this.appendQueryParam(url, "cvft", timestamp);
        // 添加自定义参数
        if (Array.isArray(jointQueryParameters.params)) {
            jointQueryParameters.params.forEach((/**
             * @param {?} p
             * @return {?}
             */
            p => {
                /** @type {?} */
                let value = p.value;
                if (p.type == JointQueryParameterType.Field || p.type == JointQueryParameterType.Expression) {
                    /** @type {?} */
                    const r = jqpr.find((/**
                     * @param {?} it
                     * @return {?}
                     */
                    it => it.code == p.code));
                    value = r && r.value;
                }
                url = this.appendQueryParam(url, p.code, value);
            }));
        }
        else {
            // 兼容key-value格式params
            Object.keys(jointQueryParameters.params).forEach((/**
             * @param {?} k
             * @return {?}
             */
            (k) => {
                url = this.appendQueryParam(url, k, jointQueryParameters.params[k]);
            }));
        }
        /** @type {?} */
        const entityParams = jointQueryParameters.params || {};
        entityParams["id"] = id;
        entityParams["url"] = url;
        entityParams["action"] = "LoadAndView1";
        /** @type {?} */
        const map$$1 = new Map();
        map$$1.set("url", url);
        map$$1.set("id", id);
        map$$1.set("action", "LoadAndView1");
        this.buildOpenMenuParams(jointQueryParameters, map$$1, undefined, jqpr);
        /** @type {?} */
        const opts = {
            appType: AppType.Menu,
            funcId: BillTrackerConstant.BILL_VIEWER_FUNC_ID,
            appEntrance: null,
            appId: null,
            tabId: id,
            entityParams: entityParams,
            queryStringParams: map$$1,
        };
        this.framework.openMenu(opts);
    }
    /**
     * @param {?} jointQueryParameters
     * @param {?} map
     * @param {?=} entityParams
     * @param {?=} jqpr
     * @return {?}
     */
    buildOpenMenuParams(jointQueryParameters, map$$1, entityParams = {}, jqpr) {
        // 添加自定义参数
        if (Array.isArray(jointQueryParameters.params)) {
            jointQueryParameters.params.forEach((/**
             * @param {?} p
             * @return {?}
             */
            p => {
                /** @type {?} */
                let value = p.value;
                if (p.type == JointQueryParameterType.Field || p.type == JointQueryParameterType.Expression) {
                    if (jqpr) {
                        /** @type {?} */
                        const r = jqpr.find((/**
                         * @param {?} it
                         * @return {?}
                         */
                        it => it.code == p.code));
                        value = r.value;
                    }
                }
                entityParams[p.code] = value;
                map$$1.set(p.code, value);
            }));
        }
        else {
            // 兼容key-value格式params
            Object.keys(jointQueryParameters.params).forEach((/**
             * @param {?} k
             * @return {?}
             */
            (k) => {
                entityParams[k] = jointQueryParameters.params[k];
                map$$1.set(k, jointQueryParameters.params[k]);
            }));
        }
    }
    /**
     * @param {?} url
     * @param {?} k
     * @param {?} v
     * @return {?}
     */
    appendQueryParam(url, k, v) {
        /** @type {?} */
        let idx = url.indexOf('?');
        if (idx < 0) {
            url += '?';
        }
        idx = url.indexOf('?');
        if (url.indexOf(k, idx) > -1) {
            /** @type {?} */
            let re1 = eval('/(\\?)(' + k + '=)([^&]*)/gi');
            url = url.replace(re1, '?' + k + '=' + v);
            /** @type {?} */
            let re2 = eval('/(&)(' + k + '=)([^&]*)/gi');
            url = url.replace(re2, '&' + k + '=' + v);
        }
        else {
            /** @type {?} */
            let paraStr = k + '=' + v;
            if (idx < 0)
                url += '?';
            else if (idx >= 0 && idx != url.length - 1)
                url += '&';
            url = url + paraStr;
        }
        return url;
    }
}
BillTrackerInternalUiService.decorators = [
    { type: Injectable }
];
/** @nocollapse */
BillTrackerInternalUiService.ctorParameters = () => [
    { type: FrameworkService },
    { type: MessagerService },
    { type: LoadingService },
    { type: String, decorators: [{ type: Inject, args: [LOCALE_ID,] }] },
    { type: BillTrackerDataService },
    { type: BillTrackerDataInfoService },
    { type: BsModalService },
    { type: ComponentFactoryResolver },
    { type: Injector },
    { type: BillTrackerLocalePipe }
];

/**
 * @fileoverview added by tsickle
 * Generated from: lib/bill-tracker/components/basic-info/basic-info.component.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
class BasicInfoComponent {
    /**
     * @param {?} framework
     * @param {?} dataInfoService
     * @param {?} notify
     * @param {?} messager
     * @param {?} loading
     * @param {?} modal
     * @param {?} localePipe
     * @param {?} vcr
     * @param {?} inj
     * @param {?} cfr
     * @param {?} cdr
     * @param {?} localeId
     */
    constructor(framework, dataInfoService, notify, messager, loading, modal, localePipe, vcr, inj, cfr, cdr, localeId) {
        this.framework = framework;
        this.dataInfoService = dataInfoService;
        this.notify = notify;
        this.messager = messager;
        this.loading = loading;
        this.modal = modal;
        this.localePipe = localePipe;
        this.vcr = vcr;
        this.inj = inj;
        this.cfr = cfr;
        this.cdr = cdr;
        this.localeId = localeId;
        this.fieldsWithValue = [];
        this.childSchemaTables = [];
        this.childDataTableMap = {};
        this.dataType = DataType;
        this.secTitle = "";
        this.localeId = localeId || this.inj.get(LOCALE_ID);
        /** @type {?} */
        const inject = ReflectiveInjector.resolveAndCreate([
            BillTrackerInternalUiService
        ], this.inj);
        this.internalUiService = inject.get(BillTrackerInternalUiService, null);
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        // 设置section标题
        this.secTitle = this.localePipe.transform("basicInfo");
        // 表名解析
        this.secTitle = this.dataInfoService.getTableLabel(this.billInfo, this.schemaTable, this.localeId);
        // 获取带值的字段信息
        try {
            this.fieldsWithValue = this.dataInfoService.getBasicInfoFieldsWithValue(this.billInfo, this.schemaTable, this.dataTable);
        }
        catch (error) {
            this.fieldsWithValue = [];
            if (error == Exceptions.SCALE_FIELD_VALUE_IS_NAN) {
                this.messager.error(this.localePipe.transform("scaleFieldCantBeCastToInteger"));
            }
            throw error;
        }
        // 按order排序
        this.fieldsWithValue = this.dataInfoService.sortFieldsByOrder(this.fieldsWithValue);
        //主表数据
        /** @type {?} */
        const r = this.dataTable.GetRowList()[0];
        // 子表列表
        this.childSchemaTables = this.dataInfoService.getChildTables(this.billInfo, this.schemaTable);
        this.childDataTableMap = r.GetChildTableMap();
        if (this.billInfo.jointQueryParameters != null) {
            /** @type {?} */
            const jointQueryParameters = JSON.parse(this.billInfo.jointQueryParameters);
            this.hasLink = (this.billInfo.jointQueryMode == JointQueryMode.APP && jointQueryParameters.funcId != null)
                || (this.billInfo.jointQueryMode == JointQueryMode.URL && jointQueryParameters.url != null);
        }
        else {
            this.hasLink = false;
        }
    }
    /**
     * @return {?}
     */
    clickLink() {
        this.internalUiService.openBillDetailWithFields(this.billInfo, this.billDataInfo, this.fieldsWithValue);
        event.stopPropagation();
        return false;
    }
}
BasicInfoComponent.decorators = [
    { type: Component, args: [{
                selector: "lib-bill-tracker-main-table",
                template: "<farris-section class=\"f-section-form f-section-in-mainsubcard\" [mainTitle]=\"secTitle\">\r\n  <div class=\"f-form-layout farris-form farris-form-controls-inline\">\r\n    <ng-container *ngFor=\"let field of fieldsWithValue; let i = index\">\r\n      <div class=\"col-12 col-md-6 col-xl-3 col-el-2\" *ngIf=\"field.show\">\r\n        <!-- \u4EC5\u663E\u793Ashow\u5C5E\u6027\u4E3Atrue\u7684\u5B57\u6BB5 -->\r\n        <!-- <div class=\"farris-group-wrap\" *ngIf=\"!(hasLink && i==0); else linkTemp\"> -->\r\n        <div class=\"farris-group-wrap\">\r\n          <!-- \u975E\u5E03\u5C14\u503C\u4F7F\u7528\u6587\u672C\u6846 -->\r\n          <div class=\"form-group farris-form-group\" *ngIf=\"field.dataType!=dataType.Boolean\">\r\n            <label class=\"col-form-label\">\r\n              <span class=\"farris-label-text\" title=\"{{field | billTrackerFieldLabel}}\">\r\n                {{field | billTrackerFieldLabel}}\r\n              </span>\r\n            </label>\r\n            <div class=\"farris-input-wrap\">\r\n              <div class=\"f-component-text\" *ngIf=\"field.dataType!=dataType.Boolean\">\r\n                <span class=\"f-form-control-text\" title=\"{{field.fieldValue}}\"\r\n                  [ngStyle]=\"{'text-align': field.dataType == dataType.Integer || field.dataType == dataType.Decimal ? 'right':null}\">\r\n                  {{field.fieldValue}}\r\n                </span>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          <!-- \u5E03\u5C14\u503C\u4F7F\u7528\u590D\u9009\u6846 -->\r\n          <div class=\"form-group farris-form-group\" *ngIf=\"field.dataType==dataType.Boolean\">\r\n            <label class=\"col-form-label\">\r\n              <span class=\"farris-label-text\" title=\"{{field | billTrackerFieldLabel}}\">\r\n                {{field | billTrackerFieldLabel}}\r\n              </span>\r\n            </label>\r\n            <div class=\"farris-input-wrap\">\r\n              <div class=\"custom-control custom-checkbox\">\r\n                <input class=\"custom-control-input\" type=\"checkbox\" readonly [checked]=\"field.fieldValue\" />\r\n                <label class=\"custom-control-label\"></label>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <!-- \u6709\u8054\u67E5\u914D\u7F6E\u65F6\uFF0C\u9ED8\u8BA4\u53D6\u7B2C\u4E00\u4E2A\u5B57\u6BB5\u4F5C\u4E3A\u8D85\u94FE\u63A5 -->\r\n        <!-- <ng-template #linkTemp> -->\r\n        <!-- <div class=\"farris-group-wrap\"> -->\r\n        <!-- \u975E\u5E03\u5C14\u503C\u94FE\u63A5\u5728value\u4E0A -->\r\n        <!-- <div class=\"form-group farris-form-group\" *ngIf=\"field.dataType!=dataType.Boolean\">\r\n                            <label class=\"col-form-label\">\r\n                                <span class=\"farris-label-text\" title=\"{{field | billTrackerFieldLabel}}\">\r\n                                    {{field | billTrackerFieldLabel}}\r\n                                </span>\r\n                            </label>\r\n                            <div class=\"farris-input-wrap\">\r\n                                <div class=\"f-component-text\">\r\n                                    <span class=\"f-form-control-text\" title=\"{{field.fieldValue}}\">\r\n                                        <a href=\"javascript:void(0);\" (click)=\"clickLink()\">{{field.fieldValue}}</a>\r\n                                    </span>\r\n                                </div>\r\n                            </div>\r\n                        </div> -->\r\n\r\n        <!-- \u5E03\u5C14\u503C\u94FE\u63A5\u5728label\u4E0A -->\r\n        <!-- <div class=\"form-group farris-form-group\" *ngIf=\"field.dataType==dataType.Boolean\">\r\n                            <label class=\"col-form-label\">\r\n                                <span class=\"farris-label-text\" title=\"{{field | billTrackerFieldLabel}}\">\r\n                                    <a href=\"javascript:void(0);\" (click)=\"clickLink()\">\r\n                                        {{field | billTrackerFieldLabel}}\r\n                                    </a>\r\n                                </span>\r\n                            </label>\r\n                            <div class=\"farris-input-wrap\">\r\n                                <div class=\"farris-input-wrap\">\r\n                                    <div class=\"custom-control custom-checkbox\">\r\n                                        <input class=\"custom-control-input\" type=\"checkbox\" readonly\r\n                                            [checked]=\"field.fieldValue\" />\r\n                                        <label class=\"custom-control-label\"></label>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        </div> -->\r\n        <!-- </div> -->\r\n        <!-- </ng-template> -->\r\n      </div>\r\n    </ng-container>\r\n  </div>\r\n</farris-section>\r\n<lib-bill-tracker-child-info-list [childSchemaTables]=\"childSchemaTables\" [childDataTableMap]=\"childDataTableMap\"\r\n  [billInfo]=\"billInfo\">\r\n</lib-bill-tracker-child-info-list>\r\n"
            }] }
];
/** @nocollapse */
BasicInfoComponent.ctorParameters = () => [
    { type: FrameworkService },
    { type: BillTrackerDataInfoService },
    { type: NotifyService },
    { type: MessagerService },
    { type: LoadingService },
    { type: BsModalService },
    { type: BillTrackerLocalePipe },
    { type: ViewContainerRef },
    { type: Injector },
    { type: ComponentFactoryResolver },
    { type: ChangeDetectorRef },
    { type: String, decorators: [{ type: Optional }, { type: Inject, args: [LOCALE_ID,] }] }
];
BasicInfoComponent.propDecorators = {
    schemaTable: [{ type: Input, args: ["schemaTable",] }],
    dataTable: [{ type: Input, args: ["dataTable",] }],
    billInfo: [{ type: Input, args: ["billInfo",] }],
    billDataInfo: [{ type: Input, args: ["billDataInfo",] }]
};

/**
 * @fileoverview added by tsickle
 * Generated from: lib/bill-tracker/components/bill-tracker-data/bill-tracker-data.component.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
class BillTrackerDataComponent {
    /**
     * @param {?} notify
     * @param {?} messager
     * @param {?} loading
     * @param {?} modal
     * @param {?} dataService
     * @param {?} inj
     * @param {?} cfr
     * @param {?} cdf
     * @param {?} loader
     * @param {?} localeId
     * @param {?} vcr
     * @param {?} er
     */
    constructor(notify, messager, loading, modal, dataService, inj, cfr, cdf, loader, localeId, vcr, er) {
        this.notify = notify;
        this.messager = messager;
        this.loading = loading;
        this.modal = modal;
        this.dataService = dataService;
        this.inj = inj;
        this.cfr = cfr;
        this.cdf = cdf;
        this.loader = loader;
        this.dataInfoService = new BillTrackerDataInfoService();
        this.localeId = localeId || this.inj.get(LOCALE_ID, null) || 'zh-CHS';
        this.localePipe = new BillTrackerLocalePipe(localeId);
        this.vcr = vcr || this.inj.get(ViewContainerRef, null);
        this.er = er || this.inj.get(ElementRef, null);
    }
    /**
     * @return {?}
     */
    ngOnInit() {
    }
    /**
     * @return {?}
     */
    ngAfterViewInit() {
    }
    /**
     * @return {?}
     */
    clearDataRegion() {
        this.dataRegion.clear();
    }
    /**
     * @param {?} args
     * @param {?=} billInfo
     * @param {?=} billDataInfo
     * @param {?=} res
     * @return {?}
     */
    showDataGrid(args, billInfo, billDataInfo, res) {
        // 单据追踪配置
        /** @type {?} */
        let bts = new BillTrackingSettings();
        if (billInfo && billInfo.billTrackingSettings) {
            bts.LoadFromJson(billInfo.billTrackingSettings);
        }
        if (bts.billTrackingDataShownMode == BillTrackingDataShownMode.CUSTOMFORM) {
            this.showCustomForm(args, billInfo, billDataInfo);
        }
        else {
            this.showGeneralForm(args, billInfo, billDataInfo, res);
        }
    }
    /**
     * 打开通用表单
     * @private
     * @param {?} args
     * @param {?=} billInfo
     * @param {?=} billDataInfo
     * @param {?=} res
     * @param {?=} newBTS
     * @return {?}
     */
    showGeneralForm(args, billInfo, billDataInfo, res, newBTS) {
        if (res != null) {
            this.createDataComp(res, billInfo, billDataInfo);
        }
        else {
            /** @type {?} */
            const l = this.loading.show({ message: this.localePipe.transform("loading") });
            this.dataService.getEntityData(args).subscribe((/**
             * @param {?} res
             * @return {?}
             */
            (res) => {
                this.createDataComp(res, billInfo, billDataInfo);
                l.close();
            }), (/**
             * @param {?} err
             * @return {?}
             */
            (err) => {
                l.close();
                this.messager.error(err.error == null ? err.message : (err.error.Message || err.error.message || err.message));
                throw err;
            }));
        }
    }
    /**
     * 打开自定义表单
     * @private
     * @param {?} args
     * @param {?=} billInfo
     * @param {?=} billDataInfo
     * @return {?}
     */
    showCustomForm(args, billInfo, billDataInfo) {
        /** @type {?} */
        let bts = new BillTrackingSettings();
        if (billInfo && billInfo.billTrackingSettings) {
            bts.LoadFromJson(billInfo.billTrackingSettings);
        }
        /** @type {?} */
        let formContent = JSON.parse(bts.customFormContent);
        /** @type {?} */
        let moduleF$ = null;
        if (formContent.form.endsWith(".js")) {
            // url格式为[js路径]时
            moduleF$ = from(System.import(formContent.form.toLowerCase()).then((/**
             * @param {?} m
             * @return {?}
             */
            m => m))).pipe(switchMap((/**
             * @param {?} m
             * @return {?}
             */
            (m) => {
                for (let key in m) {
                    return of(m[key]);
                }
                return of(null);
            })));
        }
        else {
            // url格式为[js路径#模块名]时
            moduleF$ = from(this.loader.load(formContent.form));
        }
        moduleF$.subscribe((/**
         * @param {?} moduleFactory
         * @return {?}
         */
        (moduleFactory) => {
            /** @type {?} */
            const moduleRef = moduleFactory.create(this.inj);
            /** @type {?} */
            let cmpR$ = moduleRef.instance.createDataShownComponent(this.inj, args);
            if (cmpR$ instanceof ComponentRef) {
                cmpR$ = of(cmpR$);
            }
            cmpR$.subscribe((/**
             * @param {?} cmpR
             * @return {?}
             */
            (cmpR) => {
                // 重置滚动条
                /** @type {?} */
                const elt = (/** @type {?} */ (this.dataRegion.element.nativeElement.parentElement));
                elt.scrollTo({ left: 0 });
                this.dataRegion.clear();
                this.dataRegion.insert(cmpR.hostView);
            }));
        }));
    }
    /**
     * 创建通用表组件
     * @param {?} res
     * @param {?} billInfo
     * @param {?} billDataInfo
     * @return {?}
     */
    createDataComp(res, billInfo, billDataInfo) {
        /** @type {?} */
        const newBTS = this.dataInfoService.isNewBTS(billInfo.billTrackingSettings);
        // if (newBTS) {
        try {
            this.createNewDataComp(res, billInfo, billDataInfo);
        }
        catch (e) {
            // 重置滚动条
            /** @type {?} */
            const elt = (/** @type {?} */ (this.dataRegion.element.nativeElement.parentElement));
            elt && elt.scrollTo({ left: 0 });
            this.dataRegion.clear();
            /** @type {?} */
            const cmf = this.cfr.resolveComponentFactory(BasicTableComponent);
            /** @type {?} */
            const cmpR = this.dataRegion.createComponent(cmf);
            cmpR.instance.billInfo = billInfo;
            cmpR.instance.isMain = true;
            cmpR.instance.showMainTable(res);
            this.dataRegion.insert(cmpR.hostView);
        }
        // }
    }
    /**
     * 创建通用表组件
     * @param {?} res
     * @param {?=} billInfo
     * @param {?=} billDataInfo
     * @return {?}
     */
    createNewDataComp(res, billInfo, billDataInfo) {
        // 重置滚动条
        /** @type {?} */
        const elt = (/** @type {?} */ (this.dataRegion.element.nativeElement.parentElement));
        elt && elt.scrollTo({ left: 0 });
        this.dataRegion.clear();
        /** @type {?} */
        const cmf = this.cfr.resolveComponentFactory(BasicInfoComponent);
        /** @type {?} */
        const cmpR = this.dataRegion.createComponent(cmf);
        cmpR.instance.schemaTable = res.billSchema.mainTable;
        cmpR.instance.dataTable = res.billData.mainTable;
        cmpR.instance.billInfo = billInfo;
        cmpR.instance.billDataInfo = billDataInfo;
        this.dataRegion.insert(cmpR.hostView);
    }
}
BillTrackerDataComponent.decorators = [
    { type: Component, args: [{
                selector: 'lib-bill-tracker-data',
                template: "<div style=\"\">\r\n    <ng-container #dataRegion></ng-container>\r\n</div>",
                styles: [""]
            }] }
];
/** @nocollapse */
BillTrackerDataComponent.ctorParameters = () => [
    { type: NotifyService },
    { type: MessagerService },
    { type: LoadingService },
    { type: BsModalService },
    { type: BillTrackerDataService },
    { type: Injector },
    { type: ComponentFactoryResolver },
    { type: ChangeDetectorRef },
    { type: NgModuleFactoryLoader },
    { type: String, decorators: [{ type: Inject, args: [LOCALE_ID,] }] },
    { type: ViewContainerRef, decorators: [{ type: Optional }] },
    { type: ElementRef, decorators: [{ type: Optional }] }
];
BillTrackerDataComponent.propDecorators = {
    dataRegion: [{ type: ViewChild, args: ["dataRegion", { read: ViewContainerRef },] }]
};

/**
 * @fileoverview added by tsickle
 * Generated from: lib/bill-tracker/components/bill-tracker/bill-tracker.component.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
class BillTrackerComponent {
    /**
     * @param {?} args
     * @param {?} localeId
     * @param {?} dataService
     * @param {?} notify
     * @param {?} messager
     * @param {?} loading
     * @param {?} modal
     * @param {?} cdf
     * @param {?} vcr
     * @param {?} appr
     * @param {?} inj
     * @param {?} cfr
     */
    constructor(args, localeId, dataService, notify, messager, loading, modal, cdf, vcr, appr, inj, cfr) {
        this.localeId = localeId;
        this.dataService = dataService;
        this.notify = notify;
        this.messager = messager;
        this.loading = loading;
        this.modal = modal;
        this.cdf = cdf;
        this.vcr = vcr;
        this.appr = appr;
        this.inj = inj;
        this.cfr = cfr;
        this.defaultDataWrapperHeight = 180;
        this.dataWrapperHeight = 180;
        this.showData = false;
        this.dataFullScreen = false;
        this.billTrackerArgs = args;
        this.dataInfoService = new BillTrackerDataInfoService();
        this.newBTS = this.dataInfoService.isNewBTS(this.billTrackerArgs.canTrackingResult.billTrackingSettings);
        /** @type {?} */
        const inject = ReflectiveInjector.resolveAndCreate([
            BillTrackerInternalUiService
        ], this.inj);
        this.internalUiService = inject.get(BillTrackerInternalUiService, null);
        this.defaultDataWrapperHeight = args && args.gridOptions && args.gridOptions.defaultHeight ? args.gridOptions.defaultHeight : this.defaultDataWrapperHeight;
        this.dataWrapperHeight = this.defaultDataWrapperHeight;
    }
    /**
     * @return {?}
     */
    ngOnInit() {
    }
    /**
     * @return {?}
     */
    ngAfterViewInit() {
        setTimeout((/**
         * @return {?}
         */
        () => {
            this.paintGraph();
        }), 0);
    }
    /**
     * @return {?}
     */
    paintGraph() {
        this.billGraph.paint();
        this.graphZoomScale = this.billGraph.getZoomScale();
        this.billGraph.graph.view.addListener(mxEventType.SCALE, (/**
         * @param {?} sender
         * @param {?} evt
         * @return {?}
         */
        (sender, evt) => {
            // console.log(sender, evt);
            this.graphZoomScale = this.billGraph.getZoomScale();
        }));
    }
    /**
     * @param {?} cell
     * @return {?}
     */
    selectHandler(cell) {
        if (cell) {
            /** @type {?} */
            const billInfo = cell.billInfo;
            /** @type {?} */
            const billDataInfo = cell.billDataInfo;
            if (billInfo == this.lastBillInfo && billDataInfo == this.lastBillDataInfo && this.showData == true) {
                return;
            }
            /** @type {?} */
            const args = this.dataService.buildGetMainEntityDataArgs(billInfo, billDataInfo);
            this.billData.showDataGrid(args, billInfo, billDataInfo, null);
            // 重置滚动条
            this.divDataWrapperER.nativeElement.scrollTo({ top: 0 });
            this.showData = true;
            this.lastBillInfo = billInfo;
            this.lastBillDataInfo = billDataInfo;
        }
        else {
            this.billData.clearDataRegion();
            this.showData = false;
        }
    }
    /**
     * @param {?} evt
     * @return {?}
     */
    stateChangeHandler(evt) {
        if (evt.type == Events.CLICK_FIRST_SUMMARY) {
            this.openBillDetail(evt.data);
        }
    }
    /**
     * @param {?} modalRef
     * @return {?}
     */
    setModalRef(modalRef) {
        this.modalRef = modalRef;
        if (this.billGraph != null) {
            this.billGraph.setModalRef(modalRef);
        }
    }
    /**
     * @param {?} evt
     * @return {?}
     */
    resetGraphHeight(evt) {
        ((/** @type {?} */ (evt.host))).style.top = '';
        ((/** @type {?} */ (evt.host))).style.left = '';
        this.graphContainerER.nativeElement.style.height = `${this.mainContainerER.nativeElement.clientHeight - evt.size.height}px`;
        setTimeout((/**
         * @return {?}
         */
        () => {
            this.billGraph.refresh();
        }));
    }
    /**
     * @return {?}
     */
    expandDataRegion() {
        this.dataFullScreen = true;
        this.divDataWrapperER.nativeElement.style.height = '100%';
        this.divDataWrapperER.nativeElement.style.top = '0';
    }
    /**
     * @return {?}
     */
    collapseDataRegion() {
        this.dataFullScreen = false;
        this.dataWrapperHeight = this.defaultDataWrapperHeight;
        this.divDataWrapperER.nativeElement.style.height = this.dataWrapperHeight + "px";
        this.divDataWrapperER.nativeElement.style.top = null;
    }
    /**
     * @param {?} evt
     * @return {?}
     */
    onRzResized(evt) {
        if (evt.position.top < 0) {
            this.divDataWrapperER.nativeElement.style.top = '0';
            this.divDataWrapperER.nativeElement.style.height = '100%';
            this.dataFullScreen = true;
        }
    }
    /**
     * @return {?}
     */
    graphZoomIn() {
        this.billGraph.zoomIn();
    }
    /**
     * @return {?}
     */
    graphZoomOut() {
        this.billGraph.zoomOut();
    }
    /**
     * @return {?}
     */
    graphZoomActual() {
        this.billGraph.zoomActual();
    }
    /**
     * @return {?}
     */
    graphPrint() {
        this.billGraph.print();
    }
    /**
     * @param {?} direction
     * @param {?=} all
     * @return {?}
     */
    graphExpand(direction, all = false) {
        this.billGraph.expand(direction, all);
    }
    /**
     * @return {?}
     */
    graphExpandUpAll() {
        this.graphExpand(BillTrackerDirection.Up, true);
    }
    /**
     * @return {?}
     */
    graphExpandUp() {
        this.graphExpand(BillTrackerDirection.Up, false);
    }
    /**
     * @return {?}
     */
    graphExpandDown() {
        this.graphExpand(BillTrackerDirection.Down, false);
    }
    /**
     * @return {?}
     */
    graphExpandDownAll() {
        this.graphExpand(BillTrackerDirection.Down, true);
    }
    /**
     * @param {?} cell
     * @return {?}
     */
    openBillDetail(cell) {
        this.internalUiService.openBillDetail(cell.billInfo, cell.billDataInfo);
    }
}
BillTrackerComponent.decorators = [
    { type: Component, args: [{
                selector: 'lib-bill-tracker',
                template: "<div class=\"g-main\" style=\"height: 100%; background-color: #ffffff;\" #mainContainer>\r\n  <div class=\"bill-tracker-toolbar-wrapper\" *ngIf=\"modalRef!=null\">\r\n    <button class=\"btn btn-secondary bill-tracker-toolbar-btn mr-1\" (click)=\"graphExpandUpAll()\">\r\n      {{'expandUpAll'|billTrackerLocale}}\r\n    </button>\r\n    <button class=\"btn btn-secondary bill-tracker-toolbar-btn mr-1\" (click)=\"graphExpandUp()\">\r\n      {{'expandUp'|billTrackerLocale}}\r\n    </button>\r\n    <button class=\"btn btn-secondary bill-tracker-toolbar-btn mr-1\" (click)=\"graphExpandDown()\">\r\n      {{'expandDown'|billTrackerLocale}}\r\n    </button>\r\n    <button class=\"btn btn-secondary bill-tracker-toolbar-btn mr-1\" (click)=\"graphExpandDownAll()\">\r\n      {{'expandDownAll'|billTrackerLocale}}\r\n    </button>\r\n    <div class=\"bill-tracker-toolbar-icon\" (click)=\"graphZoomOut()\">\r\n      <i class=\"f-icon f-icon-minus\" title=\"{{'zoomOut' | billTrackerLocale}}\"></i>\r\n    </div>\r\n    <div class=\"bill-tracker-toolbar-input\">\r\n      <input *ngIf=\"false\" type=\"text\" style=\"border: 0; width: 30px; text-align: right;\" readonly\r\n        [(ngModel)]=\"graphZoomScale\">\r\n      <span style=\"border: 0; width: 30px; text-align: right;\">{{graphZoomScale}}</span>\r\n      <span>%</span>\r\n    </div>\r\n    <div class=\"bill-tracker-toolbar-icon\" (click)=\"graphZoomIn()\">\r\n      <i class=\"f-icon f-icon-add\" title=\"{{'zoomIn' | billTrackerLocale}}\"></i>\r\n    </div>\r\n    <div class=\"bill-tracker-toolbar-icon\" (click)=\"graphZoomActual()\">\r\n      <i class=\"f-icon f-icon-reset\" title=\"{{'zoomReset' | billTrackerLocale}}\"></i>\r\n    </div>\r\n    <div class=\"bill-tracker-toolbar-icon\" (click)=\"graphPrint()\" *ngIf=\"false\">\r\n      <i class=\"f-icon f-icon-print\" title=\"{{'print' | billTrackerLocale}}\"></i>\r\n    </div>\r\n  </div>\r\n  <div class=\"bill-tracker-graph-wrapper\" #graphContainer>\r\n    <lib-bill-tracker-graph #billGraph [billTrackerArgs]=\"billTrackerArgs\" (select)=\"selectHandler($event)\"\r\n      (stateChange)=\"stateChangeHandler($event)\">\r\n    </lib-bill-tracker-graph>\r\n  </div>\r\n</div>\r\n<!-- todo: \u5206\u5272\u6761\u6682\u672A\u52A0\u6700\u5927\u9AD8\u5EA6\u9650\u5236 -->\r\n<div #divDataWrapper class=\"bill-tracker-data-wrapper\" [style.height]=\"dataWrapperHeight + 'px'\"\r\n  [style.display]=\"showData ? null : 'none'\" ngResizable rzAspectRatio=\"false\" [rzHandles]=\"'n'\" [rzMinHeight]=\"40\"\r\n  (rzStop)=\"onRzResized($event)\">\r\n  <div class=\"bill-tracker-divider-wrapper\">\r\n    <div class=\"bill-tracker-divider bill-tracker-divider-transparent bill-tracker-divider-img\">\r\n    </div>\r\n  </div>\r\n  <div class=\"bill-tracker-fold-container\">\r\n    <div class=\"bill-tracker-fold-wrapper\">\r\n      <div class=\"bill-tracker-fold-icon\">\r\n        <i class=\"f-icon f-icon-arrow-seek-up\" *ngIf=\"dataFullScreen==false\" (click)=\"expandDataRegion()\"></i>\r\n        <i class=\"f-icon f-icon-arrow-seek-down\" *ngIf=\"dataFullScreen==true\" (click)=\"collapseDataRegion()\"></i>\r\n      </div>\r\n    </div>\r\n  </div>\r\n  <div #divDataTable class=\"bill-tracker-data-table-wrapper\">\r\n    <lib-bill-tracker-data #billData></lib-bill-tracker-data>\r\n  </div>\r\n</div>\r\n",
                providers: [
                    BillTrackerDataService
                ],
                changeDetection: ChangeDetectionStrategy.Default,
                styles: [".bill-tracker-divider{position:relative;height:5px}.bill-tracker-divider-transparent:before{content:\"\";position:absolute;top:1px;left:0;width:100%;height:2px;background-color:#e9ecf3}.bill-tracker-divider-transparent:hover:before{content:\"\";position:absolute;top:1px;left:0;width:100%;height:2px;background-color:#3f65ff}.bill-tracker-divider-img:after{content:\"\";position:absolute;top:-1px;left:50%;width:60px;height:5px;background-image:url(/platform/runtime/common/web/@edp-bif/runtime-api/images/separator.svg);background-repeat:no-repeat}.bill-tracker-divider-img:hover:after{content:\"\";position:absolute;top:-1px;left:50%;width:60px;height:5px;background-image:url(/platform/runtime/common/web/@edp-bif/runtime-api/images/separator-hover.svg);background-repeat:no-repeat}.bill-tracker-graph-wrapper{height:100%;position:relative}.bill-tracker-data-wrapper{z-index:2;overflow-y:auto;position:absolute;left:0;width:100%;bottom:0;height:200px;background-color:#fff;overflow:hidden}.bill-tracker-data-wrapper .ng-resizable-handle.ng-resizable-n{height:10px}.bill-tracker-data-table-wrapper{position:relative;width:100%;padding-top:6px;height:100%;overflow:auto}.bill-tracker-fold-wrapper{z-index:1;position:absolute;right:1rem;top:0;width:2rem;height:2rem}.bill-tracker-fold-icon{display:inline-flex;width:1.5em;height:1.5em;line-height:1.5em;text-align:center;color:#848c9a;background:#fff;border-radius:1.5em;border:1px solid #e9ecf3;justify-content:center;align-items:center;flex-shrink:0;overflow:hidden;margin:.5em .5em 0 0}.bill-tracker-fold-icon:hover{background-image:linear-gradient(214deg,#3f65ff 0,#4d9aff 100%);box-shadow:0 3px 8px 0 rgba(78,148,255,.4);color:#fff}.bill-tracker-toolbar-wrapper{z-index:1;position:absolute;right:0;top:0;display:flex;margin-right:14px;margin-top:14px;background-color:#fff}.bill-tracker-toolbar-icon{background:#fff;width:22px;height:22px;line-height:22px;text-align:center;color:#595d63;border:1px solid #e8ebf2;box-shadow:0 2px 6px 0 rgba(31,35,41,.06);border-radius:22px;justify-content:center;align-items:center;flex-shrink:0;overflow:hidden}.bill-tracker-toolbar-icon:hover{background-image:linear-gradient(214deg,#3f65ff 0,#4d9aff 100%);box-shadow:0 3px 8px 0 rgba(78,148,255,.4);color:#fff}.bill-tracker-toolbar-btn:hover{background-color:#fff}.bill-tracker-fold-container{position:fixed;height:2rem;width:100%;z-index:1}"]
            }] }
];
/** @nocollapse */
BillTrackerComponent.ctorParameters = () => [
    { type: BillTrackerArgs },
    { type: String, decorators: [{ type: Inject, args: [LOCALE_ID,] }] },
    { type: BillTrackerDataService },
    { type: NotifyService },
    { type: MessagerService },
    { type: LoadingService },
    { type: BsModalService },
    { type: ChangeDetectorRef },
    { type: ViewContainerRef },
    { type: ApplicationRef },
    { type: Injector, decorators: [{ type: Optional }] },
    { type: ComponentFactoryResolver, decorators: [{ type: Optional }] }
];
BillTrackerComponent.propDecorators = {
    billGraph: [{ type: ViewChild, args: ["billGraph",] }],
    billGraphVCR: [{ type: ViewChild, args: ["billGraph", { read: ViewContainerRef },] }],
    mainContainerER: [{ type: ViewChild, args: ["mainContainer",] }],
    graphContainerER: [{ type: ViewChild, args: ["graphContainer",] }],
    billData: [{ type: ViewChild, args: ["billData",] }],
    billDataVCR: [{ type: ViewChild, args: ["billData", { read: ViewContainerRef },] }],
    divDataTableER: [{ type: ViewChild, args: ["divDataTable",] }],
    divDataWrapperER: [{ type: ViewChild, args: ["divDataWrapper",] }],
    billTrackerArgs: [{ type: Input, args: ["billTrackerArgs",] }]
};

/**
 * @fileoverview added by tsickle
 * Generated from: lib/bill-tracker/services/bill-tracker-ui.service.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
class BillTrackerUiService {
    /**
     * @param {?} frameworkService
     * @param {?} messager
     * @param {?} loading
     * @param {?} localeId
     * @param {?} dataService
     * @param {?} modalService
     * @param {?} cfr
     * @param {?} injector
     */
    constructor(frameworkService, messager, loading, localeId, dataService, modalService, cfr, injector) {
        this.frameworkService = frameworkService;
        this.messager = messager;
        this.loading = loading;
        this.dataService = dataService;
        this.modalService = modalService;
        this.cfr = cfr;
        this.injector = injector;
        /**
         * 内置模态框配置
         */
        this.defaultModalOptions = {
            title: null,
            width: 1100,
            height: 480,
            buttons: null,
            showButtons: null,
        };
        this.localePipe = new BillTrackerLocalePipe(localeId);
    }
    /**
     * 打开单据追踪弹窗
     * todo: spa模式下，弹窗在body中，位于最上层，打开联查时会盖住新tab页，此问题待解决
     * @param {?} args 单据追踪参数
     * @param {?=} maximized 是否最大化弹窗
     * @param {?=} modalOptions 弹窗配置
     * @param {?=} graphOptions 追踪图配置
     * @param {?=} gridOptions 数据表配置
     * @return {?}
     */
    openDefaultBillTrackerDialog(args, maximized = true, modalOptions, graphOptions, gridOptions) {
        if (typeof modalOptions == "string") {
            if (modalOptions == "") {
                this.messager.info(this.localePipe.transform("modalOptionsCantBeEmpty"));
                return of(null);
            }
            modalOptions = JSON.parse(modalOptions);
        }
        /** @type {?} */
        let modalOpts = {
            title: this.localePipe.transform("billTracker")
        };
        modalOpts = Object.assign(modalOpts, this.defaultModalOptions, modalOptions);
        if (typeof graphOptions == "string") {
            if (graphOptions != "") {
                graphOptions = JSON.parse(graphOptions);
            }
            else {
                graphOptions = null;
            }
        }
        if (typeof gridOptions == "string") {
            if (gridOptions != "") {
                gridOptions = JSON.parse(gridOptions);
            }
            else {
                gridOptions = null;
            }
        }
        /** @type {?} */
        const downArgs = new GetDownBillsInfoArgs();
        downArgs.billDataId = args.billDataId;
        downArgs.documentTypeId = args.documentTypeId;
        downArgs.bizKind = args.bizKind;
        downArgs.bizType = args.bizType;
        downArgs.billChildInfos = args.billChildInfos;
        downArgs.curYear = args.curYear;
        this.loading.show({ message: this.localePipe.transform("loading") });
        return this.dataService.canTracking(downArgs).pipe(switchMap((/**
         * @param {?} res
         * @return {?}
         */
        (res) => {
            if (!res.canDownTracking && !res.canUpTracking) {
                this.messager.info(this.localePipe.transform("noAssoBill"));
                this.loading.close();
                return of(null);
            }
            /** @type {?} */
            const billTrackerArgs = new BillTrackerArgs();
            billTrackerArgs.canTrackingResult = res;
            billTrackerArgs.getBillsInfoArgs = args;
            /** @type {?} */
            let graphOpt = new BillTrackerGraphOptions();
            graphOpt = Object.assign(graphOpt, graphOptions);
            billTrackerArgs.graphOptions = graphOpt;
            /** @type {?} */
            let gridOpt = new BillTrackerGridOptions();
            gridOpt = Object.assign(gridOpt, gridOptions);
            billTrackerArgs.gridOptions = gridOpt;
            /** @type {?} */
            const cmpR = this.createBillTrackerComponent(billTrackerArgs);
            this.loading.close();
            /** @type {?} */
            const modalRef = this.modalService.show(cmpR, modalOpts);
            if (maximized) {
                modalRef.dialog.instance.maxDialog();
            }
            cmpR.instance.setModalRef(modalRef);
            return of(cmpR.instance);
        })), catchError((/**
         * @param {?} err
         * @return {?}
         */
        (err) => {
            this.loading.close();
            //todo 确定异常结构, 目前采用兼容取值方式
            this.messager.error(err.error == null ? err.message : (err.error.Message || err.error.message || err.message));
            throw err;
        })));
    }
    /**
     * 打开单据追踪应用
     * @param {?} args 单据追踪参数
     * @param {?=} graphOptions 追踪图配置
     * @param {?=} gridOptions 数据表配置
     * @return {?}
     */
    openDefaultBillTrackerApp(args, graphOptions, gridOptions) {
        if (typeof graphOptions == "string") {
            if (graphOptions == "") {
                this.messager.info(this.localePipe.transform("modalOptionsCantBeEmpty"));
                return;
            }
            graphOptions = JSON.parse(graphOptions);
        }
        if (typeof gridOptions == "string") {
            if (gridOptions == "") {
                this.messager.info(this.localePipe.transform("modalOptionsCantBeEmpty"));
                return;
            }
            gridOptions = JSON.parse(gridOptions);
        }
        /** @type {?} */
        const downArgs = new GetDownBillsInfoArgs();
        downArgs.documentTypeId = args.documentTypeId;
        downArgs.billDataId = args.billDataId;
        downArgs.bizKind = args.bizKind;
        downArgs.bizType = args.bizType;
        downArgs.billChildInfos = args.billChildInfos;
        downArgs.curYear = args.curYear;
        this.loading.show({ message: this.localePipe.transform("loading") });
        this.dataService.canTracking(downArgs).subscribe((/**
         * @param {?} res
         * @return {?}
         */
        (res) => {
            if (!res.canDownTracking && !res.canUpTracking) {
                this.messager.info(this.localePipe.transform("noAssoBill"));
                this.loading.close();
                return;
            }
            /** @type {?} */
            const billTrackerArgs = new BillTrackerArgs();
            // warning：如果存在特殊字符或者长度超长，可能会打开空白的单据追踪应用
            billTrackerArgs.canTrackingResult = res;
            billTrackerArgs.getBillsInfoArgs = args;
            /** @type {?} */
            let graphOpt = new BillTrackerGraphOptions();
            graphOpt = Object.assign(graphOpt, graphOptions);
            billTrackerArgs.graphOptions = graphOpt;
            /** @type {?} */
            let gridOpt = new BillTrackerGridOptions();
            gridOpt = Object.assign(gridOpt, gridOptions);
            billTrackerArgs.gridOptions = gridOpt;
            /** @type {?} */
            const opt = {
                appId: BillTrackerConstant.DEFAULT_APP_ID,
                appEntrance: BillTrackerConstant.DEFAULT_APP_ENTRANCE,
                funcId: BillTrackerConstant.DEFAULT_FUNC_ID,
                tabId: "billTracker" + Date.now(),
                tabName: this.localePipe.transform("billTracker"),
                appType: AppType.App,
                entityParams: billTrackerArgs,
                queryStringParams: this.buildQueryMap(billTrackerArgs),
                isReload: undefined,
            };
            this.frameworkService.openMenu(opt);
            this.loading.close();
        }), (/**
         * @param {?} err
         * @return {?}
         */
        (err) => {
            this.loading.close();
            //todo 确定异常结构, 目前采用兼容取值方式
            this.messager.error(err.error == null ? err.message : (err.error.Message || err.error.message || err.message));
            throw err;
        }));
    }
    /**
     * 创建单据追踪组件
     * @param {?} billTrackerArgs 单据追踪参数
     * @param {?=} cfr ComponentFactoryResolver
     * @param {?=} injector Injector
     * @param {?=} custProviders 自定义Provider
     * @return {?}
     */
    createBillTrackerComponent(billTrackerArgs, cfr, injector, custProviders) {
        cfr = cfr == null ? this.cfr : cfr;
        injector = injector == null ? this.injector : injector;
        custProviders = custProviders == null || Array.isArray(custProviders) == false ? [] : custProviders;
        /** @type {?} */
        const inj = ReflectiveInjector.resolveAndCreate([
            { provide: BillTrackerArgs, useValue: billTrackerArgs },
            ...custProviders
        ], injector);
        /** @type {?} */
        const cmpF = cfr.resolveComponentFactory(BillTrackerComponent);
        /** @type {?} */
        const cmpR = cmpF.create(inj);
        return cmpR;
    }
    /**
     * 能否继续追踪
     * @param {?} args
     * @return {?}
     */
    canTracking(args) {
        return this.dataService.canTracking(args);
    }
    /**
     * 获取下游单据信息
     * @param {?} args
     * @return {?}
     */
    getDownBillsInfo(args) {
        return this.dataService.getDownBillsInfo(args);
    }
    /**
     * 获取上游单据信息
     * @param {?} args
     * @return {?}
     */
    getUpBillsInfo(args) {
        return this.dataService.getUpBillsInfo(args);
    }
    /**
     * 查询实体数据
     * @param {?} args
     * @return {?}
     */
    getEntityData(args) {
        return this.dataService.getEntityData(args);
    }
    /**
     * @private
     * @param {?} billTrackerArgs
     * @return {?}
     */
    buildQueryMap(billTrackerArgs) {
        /** @type {?} */
        let map$$1 = new Map();
        for (let key in billTrackerArgs) {
            /** @type {?} */
            let value = billTrackerArgs[key];
            if (typeof value == "object") {
                value = value && JSON.stringify(value);
            }
            // url编码后base64加密，避免url中出现特殊字符
            // 在default-bill-tracker中解码时应先atob在decodeURIComponent
            map$$1.set(key, btoa(encodeURIComponent(value)));
        }
        return map$$1;
    }
}
BillTrackerUiService.decorators = [
    { type: Injectable }
];
/** @nocollapse */
BillTrackerUiService.ctorParameters = () => [
    { type: FrameworkService },
    { type: MessagerService },
    { type: LoadingService },
    { type: String, decorators: [{ type: Inject, args: [LOCALE_ID,] }] },
    { type: BillTrackerDataService },
    { type: BsModalService },
    { type: ComponentFactoryResolver },
    { type: Injector }
];

/**
 * @fileoverview added by tsickle
 * Generated from: lib/bill-tracker/components/basic-table/child-row-table.directive.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
class ChildRowTableDirective {
    /**
     * @param {?} cfr
     * @param {?} vcRef
     * @param {?} cdr
     */
    constructor(cfr, vcRef, cdr) {
        this.cfr = cfr;
        this.vcRef = vcRef;
        this.cdr = cdr;
        this.hasChildren = new EventEmitter();
    }
    /**
     * @param {?} val
     * @return {?}
     */
    set expanded(val) {
        this._expanded = val;
        if (val) {
            this.showChildTable();
        }
        else {
            this.clearChildTable();
        }
    }
    /**
     * @return {?}
     */
    get expanded() {
        return this._expanded;
    }
    /**
     * @return {?}
     */
    showChildTable() {
        if (this.parentRow == null) {
            return;
        }
        this.clearChildTable();
        /** @type {?} */
        const cmpF = this.cfr.resolveComponentFactory(BasicTableComponent);
        for (let childTable of this.parentRow.GetChildTableList()) {
            /** @type {?} */
            const cmpR = this.vcRef.createComponent(cmpF);
            cmpR.instance.billInfo = this.billInfo;
            cmpR.instance.isMain = false;
            cmpR.instance.showTable(this.parentSchemaTable.GetChildTableMap()[childTable.tableName], childTable);
            this.vcRef.insert(cmpR.hostView);
        }
        this.cdr.markForCheck();
    }
    /**
     * @return {?}
     */
    clearChildTable() {
        this.vcRef.clear();
    }
}
ChildRowTableDirective.decorators = [
    { type: Directive, args: [{
                selector: '[appChildRowTable]'
            },] }
];
/** @nocollapse */
ChildRowTableDirective.ctorParameters = () => [
    { type: ComponentFactoryResolver },
    { type: ViewContainerRef },
    { type: ChangeDetectorRef }
];
ChildRowTableDirective.propDecorators = {
    billInfo: [{ type: Input, args: ["billInfo",] }],
    colspan: [{ type: Input, args: ["colspan",] }],
    parentRow: [{ type: Input, args: ["parentRow",] }],
    parentSchemaTable: [{ type: Input, args: ["parentSchemaTable",] }],
    parentDataTable: [{ type: Input, args: ["parentDataTable",] }],
    expanded: [{ type: Input, args: ["expanded",] }],
    hasChildren: [{ type: Output, args: ["hasChildren",] }]
};

/**
 * @fileoverview added by tsickle
 * Generated from: lib/bill-tracker/components/child-info-list/child-info-list.component.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
class ChildInfoListComponent {
    /**
     * @param {?} dataInfoService
     * @param {?} notify
     * @param {?} messager
     * @param {?} loading
     * @param {?} modal
     * @param {?} localePipe
     * @param {?} vcr
     * @param {?} inj
     * @param {?} cfr
     * @param {?} cdr
     */
    constructor(dataInfoService, notify, messager, loading, modal, localePipe, vcr, inj, cfr, cdr) {
        this.dataInfoService = dataInfoService;
        this.notify = notify;
        this.messager = messager;
        this.loading = loading;
        this.modal = modal;
        this.localePipe = localePipe;
        this.vcr = vcr;
        this.inj = inj;
        this.cfr = cfr;
        this.cdr = cdr;
    }
    /**
     * @return {?}
     */
    ngOnInit() {
    }
}
ChildInfoListComponent.decorators = [
    { type: Component, args: [{
                selector: "lib-bill-tracker-child-info-list",
                template: "<ng-container *ngFor=\"let childTable of childSchemaTables\">\r\n    <lib-bill-tracker-child-info [schemaTable]=\"childTable\" [dataTable]=\"childDataTableMap[childTable.tableName]\"\r\n        [billInfo]=\"billInfo\">\r\n    </lib-bill-tracker-child-info>\r\n</ng-container>"
            }] }
];
/** @nocollapse */
ChildInfoListComponent.ctorParameters = () => [
    { type: BillTrackerDataInfoService },
    { type: NotifyService },
    { type: MessagerService },
    { type: LoadingService },
    { type: BsModalService },
    { type: BillTrackerLocalePipe },
    { type: ViewContainerRef },
    { type: Injector },
    { type: ComponentFactoryResolver },
    { type: ChangeDetectorRef }
];
ChildInfoListComponent.propDecorators = {
    childSchemaTables: [{ type: Input, args: ["childSchemaTables",] }],
    childDataTableMap: [{ type: Input, args: ["childDataTableMap",] }],
    billInfo: [{ type: Input, args: ["billInfo",] }]
};

/**
 * @fileoverview added by tsickle
 * Generated from: lib/bill-tracker/components/child-info/child-info.component.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
class ChildInfoComponent {
    /**
     * @param {?} notify
     * @param {?} messager
     * @param {?} loading
     * @param {?} modal
     * @param {?} dataInfoService
     * @param {?} localePipe
     * @param {?} vcr
     * @param {?} inj
     * @param {?} cfr
     * @param {?} cdr
     * @param {?} localeId
     */
    constructor(notify, messager, loading, modal, dataInfoService, localePipe, vcr, inj, cfr, cdr, localeId) {
        this.notify = notify;
        this.messager = messager;
        this.loading = loading;
        this.modal = modal;
        this.dataInfoService = dataInfoService;
        this.localePipe = localePipe;
        this.vcr = vcr;
        this.inj = inj;
        this.cfr = cfr;
        this.cdr = cdr;
        this.localeId = localeId;
        this.secTitle = null;
        this.showDetail = false;
        this.dgCols = [];
        this.dgData = [];
        this.dgLineNumberTitle = this.localePipe.transform("lineNumber");
        this.dgIdField = "bifDgId0d63";
        this.localeId = localeId || this.inj.get(LOCALE_ID);
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        // 设置section标题
        this.secTitle = this.localePipe.transform("basicInfo");
        // 表名解析
        this.secTitle = this.dataInfoService.getTableLabel(this.billInfo, this.schemaTable, this.localeId);
        // 单据追踪配置
        /** @type {?} */
        let bts = new BillTrackingSettings();
        if (this.billInfo && this.billInfo.billTrackingSettings) {
            bts.LoadFromJson(this.billInfo.billTrackingSettings);
        }
        // 字段解析
        /** @type {?} */
        let fieldContent = bts.customFieldContent;
        /** @type {?} */
        let fieldConfig = fieldContent && (typeof fieldContent == "object" ? fieldContent : JSON.parse(fieldContent));
        /** @type {?} */
        let selectedFields = fieldConfig && fieldConfig.schema && fieldConfig.schema[this.schemaTable.tableName] && fieldConfig.schema[this.schemaTable.tableName].fields;
        selectedFields = selectedFields ? selectedFields : [];
        /** @type {?} */
        let showCustomFields = bts.billTrackingDataShownMode === BillTrackingDataShownMode.CUSTOMFIELD;
        /** @type {?} */
        const fs = this.schemaTable.getFieldList();
        // 提取字段
        /** @type {?} */
        let ffs = this.dataInfoService.extractFFields(fs, selectedFields, showCustomFields);
        // 筛选显示列
        ffs = ffs.filter((/**
         * @param {?} f
         * @return {?}
         */
        f => f.show));
        // 按order排序
        ffs = this.dataInfoService.sortFieldsByOrder(ffs);
        // 创建显示列
        this.dgCols = [];
        ffs.forEach((/**
         * @param {?} f
         * @return {?}
         */
        (f) => {
            /** @type {?} */
            let c = {
                field: f.fieldPath || f.fieldName,
                title: this.dataInfoService.getFieldLabel(f, this.localeId),
                width: 120
            };
            if (f.dataType == DataType.Boolean) {
                c.formatter = (/**
                 * @param {?} value
                 * @param {?} rowData
                 * @param {?} rowIndex
                 * @return {?}
                 */
                (value, rowData, rowIndex) => {
                    if (value == true) {
                        return this.localePipe.transform("yes");
                    }
                    else if (value == false) {
                        return this.localePipe.transform("no");
                    }
                    else {
                        return "-";
                    }
                });
            }
            if (f.dataType == DataType.Integer || f.dataType == DataType.Decimal) {
                c.halign = "right";
                c.align = "right";
            }
            this.dgCols.push(c);
        }));
        // 构建行数据
        /** @type {?} */
        const rows = this.dataTable ? this.dataTable.GetRowList() : [];
        try {
            this.dgData = [...this.dataInfoService.extractDataRows(rows, ffs, fs, this.dgIdField)];
        }
        catch (error) {
            this.dgData = [];
            if (error == Exceptions.SCALE_FIELD_VALUE_IS_NAN) {
                this.messager.error(this.localePipe.transform("scaleFieldCantBeCastToInteger"));
            }
            throw error;
        }
        if (this.dgData.length > 0) {
            setTimeout((/**
             * @return {?}
             */
            () => {
                this.dg && this.dg.selectRow(this.dgData[0][this.dgIdField]);
            }), 500);
        }
    }
    /**
     * @param {?} row
     * @return {?}
     */
    selectChanged(row) {
        /** @type {?} */
        const r = this.dataTable ? this.dataTable.GetRowMap()[row.id] : null;
        this.showDetail = r != null && this.dataInfoService.hasChildData(r, this.billInfo);
        this.cdr.detectChanges();
    }
    /**
     * @return {?}
     */
    viewChildData() {
        if (this.dg.selectedRow == null) {
            this.notify.warning(this.localePipe.transform("selectOneFirst"));
            return;
        }
        /** @type {?} */
        const row = this.dataTable ? this.dataTable.GetRowMap()[this.dg.selectedRow.id] : null;
        if (row == null || !this.dataInfoService.hasChildData(row, this.billInfo)) {
            this.notify.info(this.localePipe.transform("noChildData"));
            return;
        }
        /** @type {?} */
        const cmpF = this.cfr.resolveComponentFactory(ChildInfoListComponent);
        /** @type {?} */
        const cmpR = cmpF.create(this.inj, []);
        // 获取子表列表
        /** @type {?} */
        const childSchemaTables = this.dataInfoService.getChildTables(this.billInfo, this.schemaTable);
        cmpR.instance.childSchemaTables = childSchemaTables;
        cmpR.instance.childDataTableMap = row.GetChildTableMap();
        cmpR.instance.billInfo = this.billInfo;
        /** @type {?} */
        const bsModalRef = this.modal.show(cmpR, {
            title: this.localePipe.transform("childData"),
            width: 900,
            height: 600,
            showButtons: false,
        });
        cmpR.instance.bsModalRef = bsModalRef;
    }
}
ChildInfoComponent.decorators = [
    { type: Component, args: [{
                selector: "lib-bill-tracker-child-info",
                template: "<div class=\"f-struct-wrapper\" *ngIf=\"dgCols&&dgCols.length>0&&dgData&&dgData.length>0\">\r\n    <farris-section class=\"f-section-tabs f-section-in-mainsubcard\" [mainTitle]=\"secTitle\">\r\n        <ng-template farrisSectionToolbar [toolbarCls]=\"'section-test-toolbar'\">\r\n            <button class=\"btn btn-secondary f-btn-ml\" *ngIf=\"showDetail\" (click)=\"viewChildData()\">\r\n                {{ \"childData\" | billTrackerLocale}}\r\n            </button>\r\n        </ng-template>\r\n        <div class=\"\">\r\n            <div class=\"f-utils-fill\">\r\n                <farris-datagrid #dg [data]=\"dgData\" [idField]=\"dgIdField\" [fields]=\"dgCols\" [showLineNumber]=\"true\"\r\n                    [striped]=\"true\" [virtualized]=\"false\" [pagination]=\"false\" [virtualizedAsyncLoad]=\"false\"\r\n                    [multiSelect]=\"false\" [fit]=\"true\" [showCheckbox]=\"false\" [showAllCheckbox]=\"false\"\r\n                    [lineNumberTitle]=\"dgLineNumberTitle\" [mergeCell]=\"false\" [showBorder]=\"true\"\r\n                    [checkOnSelect]=\"false\" [selectOnCheck]=\"false\" [nowrap]=\"true\" [autoFitColumns]=\"true\"\r\n                    [fitColumns]=\"true\" [autoHeight]=\"false\" (selectChanged)=\"selectChanged($event)\">\r\n                </farris-datagrid>\r\n            </div>\r\n        </div>\r\n    </farris-section>\r\n</div>"
            }] }
];
/** @nocollapse */
ChildInfoComponent.ctorParameters = () => [
    { type: NotifyService },
    { type: MessagerService },
    { type: LoadingService },
    { type: BsModalService },
    { type: BillTrackerDataInfoService },
    { type: BillTrackerLocalePipe },
    { type: ViewContainerRef },
    { type: Injector },
    { type: ComponentFactoryResolver },
    { type: ChangeDetectorRef },
    { type: String, decorators: [{ type: Optional }, { type: Inject, args: [LOCALE_ID,] }] }
];
ChildInfoComponent.propDecorators = {
    schemaTable: [{ type: Input, args: ["schemaTable",] }],
    dataTable: [{ type: Input, args: ["dataTable",] }],
    billInfo: [{ type: Input, args: ["billInfo",] }],
    dg: [{ type: ViewChild, args: ["dg",] }]
};

/**
 * @fileoverview added by tsickle
 * Generated from: lib/bill-tracker/pipe/bill-tracker-field-label.pipe.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
class BillTrackerFieldLabelPipe {
    /**
     * @param {?} dataInfoService
     * @param {?} localeId
     */
    constructor(dataInfoService, localeId) {
        this.dataInfoService = dataInfoService;
        this.localeId = localeId;
    }
    /**
     * @param {?} f
     * @param {?=} langCode
     * @return {?}
     */
    transform(f, langCode) {
        return this.dataInfoService.getFieldLabel(f, langCode || this.localeId);
    }
}
BillTrackerFieldLabelPipe.decorators = [
    { type: Pipe, args: [{ name: 'billTrackerFieldLabel' },] }
];
/** @nocollapse */
BillTrackerFieldLabelPipe.ctorParameters = () => [
    { type: BillTrackerDataInfoService },
    { type: String, decorators: [{ type: Inject, args: [LOCALE_ID,] }] }
];

/**
 * @fileoverview added by tsickle
 * Generated from: lib/bill-tracker/bill-tracker.module.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
const ɵ0$1 = localStorage.getItem('languageCode') || 'zh-CHS', ɵ1$1 = {};
class BillTrackerModule {
    /**
     * @param {?=} config
     * @return {?}
     */
    static forRoot(config) {
        return {
            ngModule: BillTrackerModule,
            providers: [
                { provide: BillTrackerModuleConfig, useValue: config || {} },
            ]
        };
    }
}
BillTrackerModule.decorators = [
    { type: NgModule, args: [{
                declarations: [
                    BillTrackerComponent,
                    BillTrackerGraphComponent,
                    BillTrackerDataComponent,
                    BasicTableComponent,
                    ChildRowTableDirective,
                    BillTrackerLocalePipe,
                    BasicInfoComponent,
                    ChildInfoComponent,
                    ChildInfoListComponent,
                    BillTrackerFieldLabelPipe,
                ],
                imports: [
                    CommonModule,
                    HttpClientModule,
                    FormsModule,
                    AngularDraggableModule,
                    MessagerModule.forRoot(),
                    LoadingModule.forRoot(),
                    NotifyModule,
                    TextModule,
                    FarrisSectionModule,
                    DatagridModule.forRoot(),
                    FarrisDialogModule,
                ],
                providers: [
                    { provide: LOCALE_ID, useValue: ɵ0$1 },
                    { provide: BillTrackerModuleConfig, useValue: ɵ1$1 },
                    { provide: NgModuleFactoryLoader, useClass: SystemJsNgModuleLoader },
                    CacheService,
                    SessionService,
                    HttpService,
                    FrmEventBus,
                    FuncsService,
                    LoadingService$1,
                    AppService,
                    FrameworkService,
                    BillTrackerDataService,
                    BillTrackerUiService,
                    BillTrackerInternalUiService,
                    BillTrackerLocalePipe,
                    BillTrackerDataInfoService,
                ],
                bootstrap: [BillTrackerComponent],
                exports: [
                    BillTrackerComponent,
                    BillTrackerDataComponent,
                ],
                entryComponents: [
                    BillTrackerComponent,
                    BillTrackerDataComponent,
                    BasicTableComponent,
                    BasicInfoComponent,
                    ChildInfoComponent,
                    ChildInfoListComponent,
                ]
            },] }
];

/**
 * @fileoverview added by tsickle
 * Generated from: lib/webcmp/bif-bill-tracker.webcmp.service.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/**
 * 单据追踪web构件服务类
 */
class BifBillTrackerWebCmpService {
    /**
     * @param {?} trackerUiService
     * @param {?} bindingData
     * @param {?} viewModel
     * @param {?} frameContext
     * @param {?} inj
     * @param {?} cfr
     * @param {?} localeId
     * @param {?} messagerService
     */
    constructor(trackerUiService, bindingData, viewModel, frameContext, inj, cfr, localeId, messagerService) {
        this.trackerUiService = trackerUiService;
        this.bindingData = bindingData;
        this.viewModel = viewModel;
        this.frameContext = frameContext;
        this.inj = inj;
        this.cfr = cfr;
        this.localeId = localeId;
        this.messagerService = messagerService;
        if (inj == null) {
            /** @type {?} */
            const refInj = ReflectiveInjector.resolveAndCreate([], this.frameContext && this.frameContext.injector);
            this.inj = refInj;
        }
        this.cfr = cfr || this.inj.get(ComponentFactoryResolver);
        this.localeId = localeId || this.inj.get(LOCALE_ID, null) || 'zh-CHS';
        this.messagerService = messagerService || this.inj.get(MessagerService, null);
        this.localePipe = this.trackerUiService && this.trackerUiService.localePipe || new BillTrackerLocalePipe(localeId);
    }
    /**
     * 打开单据追踪弹窗
     * @param {?} args 单据Id或者单据查询参数
     * @param {?=} maximized 是否最大化弹窗
     * @param {?=} modalOptions 弹窗配置
     * @param {?=} graphOptions 单据追踪图配置
     * @param {?=} gridOptions 单据追踪数据表配置
     * @return {?} billTrackerComponent 单据追踪组件 \@type { Observable<BillTrackerComponent> }
     */
    openDialog(args, maximized, modalOptions, graphOptions, gridOptions) {
        if (args == null || args == "" || ((/** @type {?} */ (args))).trim && ((/** @type {?} */ (args))).trim() == "") {
            this.messagerService.error(this.localePipe.transform("trackerArgsCantBeEmpty"));
            throw "参数args不可为空";
        }
        if (typeof args == "string" && canJSONParse((/** @type {?} */ (args)))) {
            args = JSON.parse((/** @type {?} */ (args)));
        }
        else {
            args = (/** @type {?} */ (args));
        }
        maximized = (/** @type {?} */ (maximized)) === "" || maximized == null ? undefined : maximized;
        if (maximized != null && typeof maximized != "boolean") {
            if (maximized == "false") {
                maximized = false;
            }
            else if (maximized == "true") {
                maximized = true;
            }
            else {
                maximized = undefined;
            }
        }
        modalOptions = (/** @type {?} */ (modalOptions)) === "" || modalOptions == null ? undefined : modalOptions;
        graphOptions = (/** @type {?} */ (graphOptions)) === "" || graphOptions == null ? undefined : graphOptions;
        gridOptions = (/** @type {?} */ (gridOptions)) === "" || gridOptions == null ? undefined : gridOptions;
        /** @type {?} */
        const argz = new GetBillsInfoArgs();
        if (typeof args == "string") {
            argz.billDataId = args;
        }
        else {
            argz.LoadFromJsonObject(args);
        }
        return this.trackerUiService.openDefaultBillTrackerDialog(argz, maximized, modalOptions, graphOptions, gridOptions);
    }
    /**
     * 打开单据追踪App
     * @param {?} args 单据Id或者单据查询参数
     * @param {?=} graphOptions 单据追踪图配置
     * @param {?=} gridOptions 单据追踪数据表配置
     * @return {?}
     */
    openApp(args, graphOptions, gridOptions) {
        if (args == null || args == "" || ((/** @type {?} */ (args))).trim && ((/** @type {?} */ (args))).trim() == "") {
            this.messagerService.error(this.localePipe.transform("trackerArgsCantBeEmpty"));
            throw "参数args不可为空";
        }
        if (typeof args == "string" && canJSONParse((/** @type {?} */ (args)))) {
            args = JSON.parse((/** @type {?} */ (args)));
        }
        else {
            args = (/** @type {?} */ (args));
        }
        graphOptions = (/** @type {?} */ (graphOptions)) === "" || graphOptions == null ? undefined : graphOptions;
        gridOptions = (/** @type {?} */ (gridOptions)) === "" || gridOptions == null ? undefined : gridOptions;
        /** @type {?} */
        const argz = new GetBillsInfoArgs();
        if (typeof args == "string") {
            argz.billDataId = args;
        }
        else {
            argz.LoadFromJsonObject(args);
        }
        this.trackerUiService.openDefaultBillTrackerApp(argz, graphOptions, gridOptions);
    }
}
BifBillTrackerWebCmpService.decorators = [
    { type: Injectable }
];
/** @nocollapse */
BifBillTrackerWebCmpService.ctorParameters = () => [
    { type: BillTrackerUiService },
    { type: BindingData, decorators: [{ type: Optional }] },
    { type: ViewModel, decorators: [{ type: Optional }] },
    { type: FrameContext, decorators: [{ type: Optional }] },
    { type: Injector, decorators: [{ type: Optional }] },
    { type: ComponentFactoryResolver, decorators: [{ type: Optional }] },
    { type: String, decorators: [{ type: Inject, args: [LOCALE_ID,] }] },
    { type: MessagerService, decorators: [{ type: Optional }] }
];

/**
 * @fileoverview added by tsickle
 * Generated from: lib/webcmp/EntityParamUtils.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
class EntityParamUtils {
    /**
     * 构造sourceVoEntityDataIds和sourceVoEntityDatas参数
     * @param {?} entities 参与生单的上游单据ID列表或实体列表
     * @return {?}
     */
    static buildSourceVoEntityData(entities) {
        /** @type {?} */
        let sourceVoEntityDataIds = null;
        /** @type {?} */
        let sourceVoEntityDatas = null;
        // 判断entities是不是全为ID字符串
        // 不存在非字符串类型或者可以JSON.parse的元素时
        if (!entities.some((/**
         * @param {?} it
         * @return {?}
         */
        (it) => ((typeof it) != "string") || (canJSONParse(it))))) {
            sourceVoEntityDataIds = (/** @type {?} */ (entities));
            sourceVoEntityDatas = null;
        }
        else {
            sourceVoEntityDataIds = null;
            sourceVoEntityDatas = entities.map((/**
             * @param {?} item
             * @return {?}
             */
            item => {
                if (item instanceof Entity) {
                    // 如果是Entity
                    return JSON.stringify(((/** @type {?} */ (item))).toJSON(false, true));
                }
                else if (item["__type__"] == "BindingObject") {
                    //如果来自BindingData
                    /** @type {?} */
                    const bindingObject = (/** @type {?} */ (item));
                    return JSON.stringify(bindingObject.toJSON({ useFullMultiLangProperty: true }));
                }
                else if (((/** @type {?} */ (item))).toJSON != null) {
                    /** @type {?} */
                    const e = (/** @type {?} */ (item));
                    return JSON.stringify(((/** @type {?} */ (e))).toJSON(false, true));
                }
                else {
                    /** @type {?} */
                    const e = item;
                    return JSON.stringify(e);
                }
            }));
        }
        return {
            sourceVoEntityDataIds: sourceVoEntityDataIds,
            sourceVoEntityDatas: sourceVoEntityDatas,
        };
    }
}

/**
 * @fileoverview added by tsickle
 * Generated from: lib/webcmp/bif-manual-creation-data.webcmp.service.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/**
 * 手工生单数据服务类
 */
class BifManualCreationDataWebCmpService {
    /**
     * @param {?} dataService
     * @param {?} bindingData
     * @param {?} messagerService
     * @param {?} viewModel
     * @param {?} frameContext
     */
    constructor(dataService, bindingData, messagerService, viewModel, frameContext) {
        this.dataService = dataService;
        this.bindingData = bindingData;
        this.messagerService = messagerService;
        this.viewModel = viewModel;
        this.frameContext = frameContext;
        this.localePipe = new LocalePipe(this.dataService && this.dataService.localeId || 'zh-CHS');
    }
    /**
     * 根据生单流程Id查找指定的生单流程
     * @param {?} processId 单据流生单流程 Id
     * @return {?} creationProcess 生单流程 \@type { Observable<IRtSlimBillCreationProcessEntityEx> }
     */
    getSlimBillCreationProcessEntityExById(processId) {
        if (processId == null || processId == "" || processId.trim() == "") {
            this.messagerService.error(this.localePipe.transform("processIdCantBeEmpty"));
            throw "参数processId不可为空";
        }
        return this.dataService.getSlimBillCreationProcessEntityExById(processId);
    }
    /**
     * 查询表单配置
     * @param {?} formSettingsId 表单配置Id
     * @return {?} formSettings 表单配置 \@type { Observable<FormSettings> }
     */
    getFormSettingsById(formSettingsId) {
        return this.dataService.getFormSettingsById(formSettingsId);
    }
    /**
     * 执行生单流程
     * @param {?} entities 参与生单的上游单据ID列表或实体列表
     * @param {?} creationProcessId 单据流生单流程 Id
     * @param {?} creationRuleId 生单规则Id（生单流程实体中记录）
     * @param {?} targetDataIds
     * @param {?} manualCreationMode
     * @return {?} creationResult 生单结果 \@type { Observable<FormBillCreationProcessExecutorResult> }
     */
    executeBillCreationProcess(entities, creationProcessId, creationRuleId, targetDataIds, manualCreationMode) {
        if (entities == null || ((/** @type {?} */ (entities))) == "") {
            this.messagerService.error(this.localePipe.transform("entitiesCantBeEmpty"));
            throw "参数entities不可为空";
        }
        if (entities instanceof Map) {
            entities = Array.from(entities.values());
        }
        entities = Array.isArray(entities) ? entities : [entities];
        manualCreationMode = manualCreationMode ? manualCreationMode : ManualCreationMode.Push;
        const { sourceVoEntityDatas, sourceVoEntityDataIds } = EntityParamUtils.buildSourceVoEntityData(entities);
        //创建执行生单流程参数对象
        /** @type {?} */
        const args = new FormBillCreationProcessExecutorArgs();
        args.billCreationProcessId = creationProcessId;
        args.creationRuleId = creationRuleId;
        //FormCreationRuleExecutorArgs的sourceVoEntityDatas属性为前端实体序列化后的字符串列表
        //sourceVoEntityDatas列表中的每个字符串，在结构上应与单据流定义中所选中的上游视图对象一致。
        args.sourceVoEntityDatas = sourceVoEntityDatas;
        args.sourceVoEntityDataIds = sourceVoEntityDataIds;
        //下推过程中不存在目标主表单据Id，所以targetVoDataIds为空列表。
        args.targetVoDataIds = targetDataIds;
        args.manualCreationMode = manualCreationMode;
        return this.dataService.executeBillCreationProcess(args);
    }
    /**
     * 创建实体数据（RetrieveDefault至缓存）
     * @param {?} formVoId 表单绑定VO Id
     * @param {?} res 生单流程执行结果
     * @return {?} formCreateResult 创建实体数据返回结果 \@type { Observable<FormCreateResult> }
     */
    createEntityDatas(formVoId, res) {
        /** @type {?} */
        const args = new FormCreateArgs();
        args.formVoId = formVoId;
        //获取生单流程执行结果
        args.rpcCreationRuleExecutorResult = res.creationRuleExecutorResult.ConvertToJson();
        //创建实体数据
        return this.dataService.createEntityDatas(args);
    }
    /**
     * 更新实体数据
     * @param {?} res 生单流程执行结果
     * @return {?} formUpdateResult 更新实体数据返回结果 \@type { Observable<FormUpdateResult> }
     */
    updateEntityDatas(res) {
        /** @type {?} */
        const args = new FormUpdateArgs();
        //Mapping执行条件判断结果为true时才会执行生单流程得到生单结果
        if (res.conditionResult.conditionExecutionResult == true) {
            //生单结果不为空
            if (res.creationRuleExecutorResult && res.creationRuleExecutorResult.mappingResults && res.creationRuleExecutorResult.mappingResults.length > 0) {
                args.rpcCreationRuleExecutorResult = res.creationRuleExecutorResult.ConvertToJson();
                return this.dataService.updateEntityDatas(args);
            }
            else {
                return throwError("creationRuleExecutorResult is empty!");
            }
        }
        else {
            return throwError("conditionExecutionResult is false!");
        }
    }
    /**
     * 推送任务中心
     * @param {?} res 生单流程执行结果
     * @return {?} formUpdateResult 更新实体数据返回结果 \@type { Observable<FormUpdateResult> }
     */
    pushTaskCenter(res) {
        /** @type {?} */
        const args = new PushTaskArgs();
        //Mapping执行条件判断结果为true时才会执行生单流程得到生单结果
        if (res.conditionResult.conditionExecutionResult == true) {
            //生单结果不为空
            if (res.creationRuleExecutorResult && res.creationRuleExecutorResult.mappingResults && res.creationRuleExecutorResult.mappingResults.length > 0) {
                if (res.pushCreationMode == PushCreationMode.TASKCENTER) {
                    args.suCode = res.downBillSuCode;
                    args.creationRuleExecutorResult = res.creationRuleExecutorResult;
                    return this.dataService.pushTaskCenter(args);
                }
                else {
                    return throwError("creationRuleExecutorResult can't be pushed to task center!");
                }
            }
            else {
                return throwError("creationRuleExecutorResult is empty!");
            }
        }
        else {
            return throwError("conditionExecutionResult is false!");
        }
    }
    /**
     * 查询生单结果
     * @param {?} creationResultId 生单结果id
     * @return {?}
     */
    getCreationResultById(creationResultId) {
        return this.dataService.getCreationResultById(creationResultId);
    }
    /**
     * 暂存生单结果
     * @param {?} creationResult
     * @return {?}
     */
    addFormBillCreationProcessExecutorResult(creationResult) {
        if (creationResult == null) {
            this.messagerService.error(this.localePipe.transform("creationResultCantBeEmpty"));
            throw "参数creationResult不可为空";
        }
        if (typeof creationResult == "string") {
            if (creationResult == "") {
                this.messagerService.error(this.localePipe.transform("creationResultCantBeEmpty"));
                throw "参数creationResult不可为空";
            }
            /** @type {?} */
            const temp = new FormBillCreationProcessExecutorResult();
            temp.LoadFromJson(creationResult);
            creationResult = temp;
        }
        if ((creationResult instanceof FormBillCreationProcessExecutorResult) == false) {
            /** @type {?} */
            const res = new FormBillCreationProcessExecutorResult();
            res.LoadFromJsonObject(creationResult);
            creationResult = res;
        }
        return this.dataService.addFormBillCreationProcessExecutorResult(creationResult);
    }
    /**
       * 获取VO序列化数据
       */
    /**
     * 获取VO序列化数据
     * @param {?} dataId
     * @param {?} voId
     * @param {?} suCode
     * @return {?}
     */
    getEntityDatas(dataId, voId, suCode) {
        if (dataId == null) {
            this.messagerService.error(this.localePipe.transform("dataIdCantBeEmpty"));
            throw "参数dataId不可为空";
        }
        if (voId == null) {
            this.messagerService.error(this.localePipe.transform("voIdCantBeEmpty"));
            throw "参数voId不可为空";
        }
        if (suCode == null) {
            this.messagerService.error(this.localePipe.transform("suCodeCantBeEmpty"));
            throw "参数suCode不可为空";
        }
        /** @type {?} */
        const args = new GetEntityDatasArgs();
        args.dataId = dataId;
        args.suCode = suCode;
        args.voId = voId;
        return this.dataService.getEntityDatas(args);
    }
}
BifManualCreationDataWebCmpService.decorators = [
    { type: Injectable }
];
/** @nocollapse */
BifManualCreationDataWebCmpService.ctorParameters = () => [
    { type: BifDataService },
    { type: BindingData },
    { type: MessagerService },
    { type: ViewModel, decorators: [{ type: Optional }] },
    { type: FrameContext, decorators: [{ type: Optional }] }
];

/**
 * @fileoverview added by tsickle
 * Generated from: lib/webcmp/bif-manual-creation-source.webcmp.service.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/**
 * 手工生单来源端服务类
 */
class BifManualCreationSourceWebCmpService {
    /**
     * @param {?} sourceUiService
     * @param {?} dataService
     * @param {?} bindingData
     * @param {?} messagerService
     * @param {?} viewModel
     * @param {?} frameContext
     */
    constructor(sourceUiService, dataService, bindingData, messagerService, viewModel, frameContext) {
        this.sourceUiService = sourceUiService;
        this.dataService = dataService;
        this.bindingData = bindingData;
        this.messagerService = messagerService;
        this.viewModel = viewModel;
        this.frameContext = frameContext;
        this.localePipe = new LocalePipe(this.sourceUiService && this.sourceUiService.localeId || 'zh-CHS');
    }
    /**
     * 下推，根据来源VO Id打开生单流程选择器并执行选中的生单流程
     *
     * @param {?} sourceVoId 单据流来源视图对象 Id
     * @param {?} entities 参与生单的上游单据ID列表或实体列表
     * @param {?=} targetCommand 目标单据'单据流加载'命令的编号
     * @param {?=} bizFlowchartId 业务场景图Id
     * @param {?=} modalOptions 弹窗配置
     * @param {?=} customSelectorModuleUrl 自定义选择器url
     * @param {?=} extParams1 打开生单流程选择器弹窗扩展参数
     * @param {?=} extParams2 打开目标单据制单界面扩展参数
     * @return {?}
     */
    pushBySourceVoId(sourceVoId, entities, targetCommand, bizFlowchartId, modalOptions, customSelectorModuleUrl, extParams1, extParams2) {
        if (sourceVoId == null || sourceVoId == "" || sourceVoId.trim && sourceVoId.trim() == "") {
            this.messagerService.error(this.localePipe.transform("sourceVoIdCantBeEmpty"));
            throw "参数sourceVoId不可为空";
        }
        // 参数为空时尝试从根组件BindingData上取id，获取后仍为空则报错
        if (entities == null || ((/** @type {?} */ (entities))) == "") {
            try {
                entities = this.frameContext.root.bindingData.getObject().id;
            }
            catch (e) {
            }
            if (entities == null || ((/** @type {?} */ (entities))) == "") {
                this.messagerService.error(this.localePipe.transform("entitiesCantBeEmpty"));
                throw "参数entities不可为空";
            }
        }
        if (entities instanceof Map) {
            entities = Array.from(entities.values());
        }
        entities = Array.isArray(entities) ? entities : [entities];
        bizFlowchartId = bizFlowchartId === "" || bizFlowchartId == null ? undefined : bizFlowchartId;
        modalOptions = (/** @type {?} */ (modalOptions)) === "" || modalOptions == null ? undefined : modalOptions;
        customSelectorModuleUrl = customSelectorModuleUrl === "" || customSelectorModuleUrl == null ? undefined : customSelectorModuleUrl;
        extParams1 = extParams1 === "" || extParams1 == null ? undefined : extParams1;
        extParams2 = extParams2 === "" || extParams2 == null ? undefined : extParams2;
        const { sourceVoEntityDatas, sourceVoEntityDataIds } = EntityParamUtils.buildSourceVoEntityData(entities);
        //打开生单流程选择器
        this.sourceUiService.openBillCreationProcessSelector4Push(sourceVoId, bizFlowchartId, modalOptions, customSelectorModuleUrl, extParams1).subscribe((/**
         * @param {?} cp
         * @return {?}
         */
        (cp) => {
            //查询表单配置
            this.dataService.getFormSettingsById(cp.formSettingsId).subscribe((/**
             * @param {?} formSettings
             * @return {?}
             */
            (formSettings) => {
                //创建执行生单流程参数对象
                /** @type {?} */
                const args = new FormBillCreationProcessExecutorArgs();
                args.billCreationProcessId = cp.id;
                args.creationRuleId = cp.creationRuleId;
                //FormCreationRuleExecutorArgs的sourceVoEntityDatas属性为前端实体序列化后的字符串列表
                //sourceVoEntityDatas列表中的每个字符串，在结构上应与单据流定义中所选中的上游视图对象一致。
                args.sourceVoEntityDatas = sourceVoEntityDatas;
                args.sourceVoEntityDataIds = sourceVoEntityDataIds;
                //下推过程中不存在目标主表单据Id，所以targetVoDataIds为空列表。
                args.targetVoDataIds = [];
                args.manualCreationMode = ManualCreationMode.Push;
                //执行生单流程
                this.dataService.executeBillCreationProcess(args).subscribe((/**
                 * @param {?} result
                 * @return {?}
                 */
                (result) => {
                    //Mapping执行条件判断结果为true时才会执行生单流程得到生单结果
                    if (result.conditionResult.conditionExecutionResult == true) {
                        //生单结果不为空
                        if (result.creationRuleExecutorResult && result.creationRuleExecutorResult.mappingResults && result.creationRuleExecutorResult.mappingResults.length > 0) {
                            if (result.pushCreationMode == null || result.pushCreationMode == PushCreationMode.CREATION) {
                                this.dataService.addFormBillCreationProcessExecutorResult(result).subscribe((/**
                                 * @param {?} res
                                 * @return {?}
                                 */
                                (res) => {
                                    //打开目标单据制单界面
                                    this.sourceUiService.openTargetApp(formSettings, result.conditionResult, res, Object.assign({ action: targetCommand }, extParams2));
                                }), (/**
                                 * @param {?} err
                                 * @return {?}
                                 */
                                (err) => {
                                    this.messagerService.error(err.error == null ? err.message : (err.error.Message || err.error.message || err.message));
                                }));
                            }
                            else if (result.pushCreationMode == PushCreationMode.TASKCENTER) {
                                //推送任务中心
                                /** @type {?} */
                                const pushTaskArgs = new PushTaskArgs();
                                pushTaskArgs.suCode = result.downBillSuCode;
                                pushTaskArgs.creationRuleExecutorResult = result.creationRuleExecutorResult;
                                this.dataService.pushTaskCenter(pushTaskArgs).subscribe((/**
                                 * @return {?}
                                 */
                                () => {
                                    this.messagerService.success(this.localePipe.transform("pushTaskCenterSuccess"));
                                }), (/**
                                 * @param {?} err
                                 * @return {?}
                                 */
                                (err) => {
                                    this.messagerService.error((err.error == null ? err.message : (err.error.innerMessage || err.error.Message || err.error.message || err.message)) || this.localePipe.transform("pushTaskCenterFailed"));
                                }));
                            }
                        }
                        else {
                            this.messagerService.error(this.localePipe.transform("creationResultEmpty"));
                        }
                    }
                    else {
                        //为false时可得到配置的错误提示信息
                        this.messagerService.error(result.conditionResult.message || this.localePipe.transform("creationExecutionError"));
                    }
                }), (/**
                 * @param {?} err
                 * @return {?}
                 */
                (err) => {
                    this.messagerService.error(err.error == null ? err.message : (err.error.Message || err.error.message || err.message));
                }));
            }), (/**
             * @param {?} err
             * @return {?}
             */
            (err) => {
                this.messagerService.error(err.error == null ? err.message : (err.error.Message || err.error.message || err.message));
            }));
        }), (/**
         * @param {?} err
         * @return {?}
         */
        (err) => {
            this.messagerService.error(err.error == null ? err.message : (err.error.Message || err.error.message || err.message));
        }));
    }
    /**
     * 特定下推，根据来源VO Id和目标VO Id打开生单流程选择器并执行选中的生单流程
     *
     * @param {?} sourceVoId 单据流来源视图对象 Id
     * @param {?} targetVoId 单据流目标视图对象 Id
     * @param {?} entities 参与生单的上游单据ID列表或实体列表
     * @param {?=} targetCommand 目标单据'单据流加载'命令的编号
     * @param {?=} bizFlowchartId 业务场景图Id
     * @param {?=} modalOptions 弹窗配置
     * @param {?=} customSelectorModuleUrl 自定义选择器url
     * @param {?=} extParams1 打开生单流程选择器弹窗扩展参数
     * @param {?=} extParams2 打开目标单据制单界面扩展参数
     * @return {?}
     */
    pushBySourceVoIdAndTargetVoId(sourceVoId, targetVoId, entities, targetCommand, bizFlowchartId, modalOptions, customSelectorModuleUrl, extParams1, extParams2) {
        if (sourceVoId == null || sourceVoId == "" || sourceVoId.trim && sourceVoId.trim() == "") {
            this.messagerService.error(this.localePipe.transform("sourceVoIdCantBeEmpty"));
            throw "参数sourceVoId不可为空";
        }
        if (targetVoId == null || targetVoId == "" || targetVoId.trim && targetVoId.trim() == "") {
            this.messagerService.error(this.localePipe.transform("targetVoIdVoIdCantBeEmpty"));
            throw "参数targetVoId不可为空";
        }
        if (entities == null || ((/** @type {?} */ (entities))) == "") {
            this.messagerService.error(this.localePipe.transform("entitiesCantBeEmpty"));
            throw "参数entities不可为空";
        }
        if (entities instanceof Map) {
            entities = Array.from(entities.values());
        }
        entities = Array.isArray(entities) ? entities : [entities];
        bizFlowchartId = bizFlowchartId === "" || bizFlowchartId == null ? undefined : bizFlowchartId;
        modalOptions = (/** @type {?} */ (modalOptions)) === "" || modalOptions == null ? undefined : modalOptions;
        customSelectorModuleUrl = customSelectorModuleUrl === "" || customSelectorModuleUrl == null ? undefined : customSelectorModuleUrl;
        extParams1 = extParams1 === "" || extParams1 == null ? undefined : extParams1;
        extParams2 = extParams2 === "" || extParams2 == null ? undefined : extParams2;
        const { sourceVoEntityDatas, sourceVoEntityDataIds } = EntityParamUtils.buildSourceVoEntityData(entities);
        //打开生单流程选择器
        this.sourceUiService.openBillCreationProcessSelector4SpecificPush(sourceVoId, targetVoId, bizFlowchartId, modalOptions, customSelectorModuleUrl, extParams1).subscribe((/**
         * @param {?} cp
         * @return {?}
         */
        (cp) => {
            //查询表单配置
            this.dataService.getFormSettingsById(cp.formSettingsId).subscribe((/**
             * @param {?} formSettings
             * @return {?}
             */
            (formSettings) => {
                //创建执行生单流程参数对象
                /** @type {?} */
                const args = new FormBillCreationProcessExecutorArgs();
                args.billCreationProcessId = cp.id;
                args.creationRuleId = cp.creationRuleId;
                //FormCreationRuleExecutorArgs的sourceVoEntityDatas属性为前端实体序列化后的字符串列表
                //sourceVoEntityDatas列表中的每个字符串，在结构上应与单据流定义中所选中的上游视图对象一致。
                args.sourceVoEntityDatas = sourceVoEntityDatas;
                args.sourceVoEntityDataIds = sourceVoEntityDataIds;
                //下推过程中不存在目标主表单据Id，所以targetVoDataIds为空列表。
                args.targetVoDataIds = [];
                args.manualCreationMode = ManualCreationMode.SpecificPush;
                //执行生单流程
                this.dataService.executeBillCreationProcess(args).subscribe((/**
                 * @param {?} result
                 * @return {?}
                 */
                (result) => {
                    //Mapping执行条件判断结果为true时才会执行生单流程得到生单结果
                    if (result.conditionResult.conditionExecutionResult == true) {
                        //生单结果不为空
                        if (result.creationRuleExecutorResult && result.creationRuleExecutorResult.mappingResults && result.creationRuleExecutorResult.mappingResults.length > 0) {
                            if (result.pushCreationMode == null || result.pushCreationMode == PushCreationMode.CREATION) {
                                this.dataService.addFormBillCreationProcessExecutorResult(result).subscribe((/**
                                 * @param {?} res
                                 * @return {?}
                                 */
                                (res) => {
                                    //打开目标单据制单界面
                                    this.sourceUiService.openTargetApp(formSettings, result.conditionResult, res, Object.assign({ action: targetCommand }, extParams2));
                                }), (/**
                                 * @param {?} err
                                 * @return {?}
                                 */
                                (err) => {
                                    this.messagerService.error(err.error == null ? err.message : (err.error.Message || err.error.message || err.message));
                                }));
                            }
                            else if (result.pushCreationMode == PushCreationMode.TASKCENTER) {
                                //推送任务中心
                                /** @type {?} */
                                const pushTaskArgs = new PushTaskArgs();
                                pushTaskArgs.suCode = result.downBillSuCode;
                                pushTaskArgs.creationRuleExecutorResult = result.creationRuleExecutorResult;
                                this.dataService.pushTaskCenter(pushTaskArgs).subscribe((/**
                                 * @return {?}
                                 */
                                () => {
                                    this.messagerService.success(this.localePipe.transform("pushTaskCenterSuccess"));
                                }), (/**
                                 * @param {?} err
                                 * @return {?}
                                 */
                                (err) => {
                                    this.messagerService.error((err.error == null ? err.message : (err.error.innerMessage || err.error.Message || err.error.message || err.message)) || this.localePipe.transform("pushTaskCenterFailed"));
                                }));
                            }
                        }
                        else {
                            this.messagerService.error(this.localePipe.transform("creationResultEmpty"));
                        }
                    }
                    else {
                        //为false时可得到配置的错误提示信息
                        this.messagerService.error(result.conditionResult.message || this.localePipe.transform("creationExecutionError"));
                    }
                }), (/**
                 * @param {?} err
                 * @return {?}
                 */
                (err) => {
                    this.messagerService.error(err.error == null ? err.message : (err.error.Message || err.error.message || err.message));
                }));
            }), (/**
             * @param {?} err
             * @return {?}
             */
            (err) => {
                this.messagerService.error(err.error == null ? err.message : (err.error.Message || err.error.message || err.message));
            }));
        }), (/**
         * @param {?} err
         * @return {?}
         */
        (err) => {
            this.messagerService.error(err.error == null ? err.message : (err.error.Message || err.error.message || err.message));
        }));
    }
    /**
     * 特定下推，根据生单流程ID执行选中的生单流程
     *
     * @param {?} processId 单据流生单流程 Id
     * @param {?} entities 参与生单的上游单据ID列表或实体列表
     * @param {?=} targetCommand 目标单据'单据流加载'命令的编号
     * @param {?=} extParams 打开目标单据制单界面扩展参数
     * @return {?}
     */
    pushByCreationProcessId(processId, entities, targetCommand, extParams) {
        if (processId == null || processId == "" || processId.trim() == "") {
            this.messagerService.error(this.localePipe.transform("processIdCantBeEmpty"));
            throw "参数processId不可为空";
        }
        if (entities == null || ((/** @type {?} */ (entities))) == "") {
            this.messagerService.error(this.localePipe.transform("entitiesCantBeEmpty"));
            throw "参数entities不可为空";
        }
        if (entities instanceof Map) {
            entities = Array.from(entities.values());
        }
        entities = Array.isArray(entities) ? entities : [entities];
        extParams = extParams === "" || extParams == null ? undefined : extParams;
        const { sourceVoEntityDatas, sourceVoEntityDataIds } = EntityParamUtils.buildSourceVoEntityData(entities);
        //查找生单流程
        this.dataService.getSlimBillCreationProcessEntityExById(processId).subscribe((/**
         * @param {?} cp
         * @return {?}
         */
        (cp) => {
            //查询表单配置
            this.dataService.getFormSettingsById(cp.formSettingsId).subscribe((/**
             * @param {?} formSettings
             * @return {?}
             */
            (formSettings) => {
                //创建执行生单流程参数对象
                /** @type {?} */
                const args = new FormBillCreationProcessExecutorArgs();
                args.billCreationProcessId = cp.id;
                args.creationRuleId = cp.creationRuleId;
                //FormCreationRuleExecutorArgs的sourceVoEntityDatas属性为前端实体序列化后的字符串列表
                //sourceVoEntityDatas列表中的每个字符串，在结构上应与单据流定义中所选中的上游视图对象一致。
                args.sourceVoEntityDatas = sourceVoEntityDatas;
                args.sourceVoEntityDataIds = sourceVoEntityDataIds;
                //下推过程中不存在目标主表单据Id，所以targetVoDataIds为空列表。
                args.targetVoDataIds = [];
                args.manualCreationMode = ManualCreationMode.SpecificPush;
                //执行生单流程
                this.dataService.executeBillCreationProcess(args).subscribe((/**
                 * @param {?} result
                 * @return {?}
                 */
                (result) => {
                    //Mapping执行条件判断结果为true时才会执行生单流程得到生单结果
                    if (result.conditionResult.conditionExecutionResult == true) {
                        //生单结果不为空
                        if (result.creationRuleExecutorResult && result.creationRuleExecutorResult.mappingResults && result.creationRuleExecutorResult.mappingResults.length > 0) {
                            if (result.pushCreationMode == null || result.pushCreationMode == PushCreationMode.CREATION) {
                                this.dataService.addFormBillCreationProcessExecutorResult(result).subscribe((/**
                                 * @param {?} res
                                 * @return {?}
                                 */
                                (res) => {
                                    //打开目标单据制单界面
                                    this.sourceUiService.openTargetApp(formSettings, result.conditionResult, res, Object.assign({ action: targetCommand }, extParams));
                                }), (/**
                                 * @param {?} err
                                 * @return {?}
                                 */
                                (err) => {
                                    this.messagerService.error(err.error == null ? err.message : (err.error.Message || err.error.message || err.message));
                                }));
                            }
                            else if (result.pushCreationMode == PushCreationMode.TASKCENTER) {
                                //推送任务中心
                                /** @type {?} */
                                const pushTaskArgs = new PushTaskArgs();
                                pushTaskArgs.suCode = result.downBillSuCode;
                                pushTaskArgs.creationRuleExecutorResult = result.creationRuleExecutorResult;
                                this.dataService.pushTaskCenter(pushTaskArgs).subscribe((/**
                                 * @return {?}
                                 */
                                () => {
                                    this.messagerService.success(this.localePipe.transform("pushTaskCenterSuccess"));
                                }), (/**
                                 * @param {?} err
                                 * @return {?}
                                 */
                                (err) => {
                                    this.messagerService.error((err.error == null ? err.message : (err.error.innerMessage || err.error.Message || err.error.message || err.message)) || this.localePipe.transform("pushTaskCenterFailed"));
                                }));
                            }
                        }
                        else {
                            this.messagerService.error(this.localePipe.transform("creationResultEmpty"));
                        }
                    }
                    else {
                        //为false时可得到配置的错误提示信息
                        this.messagerService.error(result.conditionResult.message || this.localePipe.transform("creationExecutionError"));
                    }
                }), (/**
                 * @param {?} err
                 * @return {?}
                 */
                (err) => {
                    this.messagerService.error(err.error == null ? err.message : (err.error.Message || err.error.message || err.message));
                }));
            }), (/**
             * @param {?} err
             * @return {?}
             */
            (err) => {
                this.messagerService.error(err.error == null ? err.message : (err.error.Message || err.error.message || err.message));
            }));
        }), (/**
         * @param {?} err
         * @return {?}
         */
        (err) => {
            this.messagerService.error(err.error == null ? err.message : (err.error.Message || err.error.message || err.message));
        }));
    }
    /**
     * 根据来源VO Id打开生单流程选择器选择生单流程
     * @param {?} sourceVoId 来源VO Id
     * @param {?=} bizFlowchartId 业务场景图Id
     * @param {?=} modalOptions 模态框配置
     * @param {?=} customSelectorModuleUrl 自定义选择器Url
     * @param {?=} extParams 扩展参数
     * @return {?} creationProcess 生单流程 \@type { Observable<IRtSlimBillCreationProcessEntityEx> }
     */
    openBillCreationProcessSelector4Push(sourceVoId, bizFlowchartId, modalOptions, customSelectorModuleUrl, extParams) {
        if (sourceVoId == null || sourceVoId == "" || sourceVoId.trim && sourceVoId.trim() == "") {
            this.messagerService.error(this.localePipe.transform("sourceVoIdCantBeEmpty"));
            throw "参数sourceVoId不可为空";
        }
        bizFlowchartId = bizFlowchartId === "" || bizFlowchartId == null ? undefined : bizFlowchartId;
        modalOptions = (/** @type {?} */ (modalOptions)) === "" || modalOptions == null ? undefined : modalOptions;
        customSelectorModuleUrl = customSelectorModuleUrl === "" || customSelectorModuleUrl == null ? undefined : customSelectorModuleUrl;
        extParams = extParams === "" || extParams == null ? undefined : extParams;
        return this.sourceUiService.openBillCreationProcessSelector4Push(sourceVoId, bizFlowchartId, modalOptions, customSelectorModuleUrl, extParams);
    }
    /**
     * 根据来源VO Id和目标VO Id打开生单流程选择器选择生单流程
     * @param {?} sourceVoId 来源VO Id
     * @param {?} targetVoId 目标VO Id
     * @param {?=} bizFlowchartId 业务场景图Id
     * @param {?=} modalOptions 模态框配置
     * @param {?=} customSelectorModuleUrl 自定义选择器Url
     * @param {?=} extParams 扩展参数
     * @return {?} creationProcess 生单流程 \@type { Observable<IRtSlimBillCreationProcessEntityEx> }
     */
    openBillCreationProcessSelector4SpecificPush(sourceVoId, targetVoId, bizFlowchartId, modalOptions, customSelectorModuleUrl, extParams) {
        if (sourceVoId == null || sourceVoId == "" || sourceVoId.trim && sourceVoId.trim() == "") {
            this.messagerService.error(this.localePipe.transform("sourceVoIdCantBeEmpty"));
            throw "参数sourceVoId不可为空";
        }
        if (targetVoId == null || targetVoId == "" || targetVoId.trim && targetVoId.trim() == "") {
            this.messagerService.error(this.localePipe.transform("targetVoIdVoIdCantBeEmpty"));
            throw "参数targetVoId不可为空";
        }
        bizFlowchartId = bizFlowchartId === "" || bizFlowchartId == null ? undefined : bizFlowchartId;
        modalOptions = (/** @type {?} */ (modalOptions)) === "" || modalOptions == null ? undefined : modalOptions;
        customSelectorModuleUrl = customSelectorModuleUrl === "" || customSelectorModuleUrl == null ? undefined : customSelectorModuleUrl;
        extParams = extParams === "" || extParams == null ? undefined : extParams;
        //打开生单流程选择器
        return this.sourceUiService.openBillCreationProcessSelector4SpecificPush(sourceVoId, targetVoId, bizFlowchartId, modalOptions, customSelectorModuleUrl, extParams);
    }
    /**
     * \@Deprecated 已弃用，请使用 {\@link openTargetApp }
     * 打开目标单据制单界面
     * @param {?} formSettings 表单配置
     * @param {?} result 生单流程执行结果
     * @param {?=} targetCommand 目标表单命令
     * @param {?=} extParams 扩展参数
     * @return {?}
     */
    openTargetForm(formSettings, result, targetCommand, extParams) {
        this.sourceUiService.openTargetForm(formSettings, result, Object.assign({ action: targetCommand }, extParams));
    }
    /**
     * 打开目标单据制单界面
     * @param {?} formSettings 表单配置
     * @param {?} conditionResult 执行条件计算结果
     * @param {?} textIdWithDataIds
     * @param {?=} targetCommand 目标表单命令
     * @param {?=} extParams 扩展参数
     * @return {?}
     */
    openTargetApp(formSettings, conditionResult, textIdWithDataIds, targetCommand, extParams) {
        this.sourceUiService.openTargetApp(formSettings, conditionResult, textIdWithDataIds, Object.assign({ action: targetCommand }, extParams));
    }
}
BifManualCreationSourceWebCmpService.decorators = [
    { type: Injectable }
];
/** @nocollapse */
BifManualCreationSourceWebCmpService.ctorParameters = () => [
    { type: BifSourceUiService },
    { type: BifDataService },
    { type: BindingData },
    { type: MessagerService },
    { type: ViewModel, decorators: [{ type: Optional }] },
    { type: FrameContext, decorators: [{ type: Optional }] }
];

/**
 * @fileoverview added by tsickle
 * Generated from: lib/webcmp/bif-manual-creation-target.webcmp.service.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/**
 * 手工生单目标端服务类
 */
class BifManualCreationTargetWebCmpService {
    /**
     * @param {?} dataService
     * @param {?} targetUiService
     * @param {?} stateMachineService
     * @param {?} bindingData
     * @param {?} messagerService
     * @param {?} cardDataService
     * @param {?} viewModel
     * @param {?} frameContext
     */
    constructor(dataService, targetUiService, stateMachineService, bindingData, messagerService, cardDataService, viewModel, frameContext) {
        this.dataService = dataService;
        this.targetUiService = targetUiService;
        this.stateMachineService = stateMachineService;
        this.bindingData = bindingData;
        this.messagerService = messagerService;
        this.cardDataService = cardDataService;
        this.viewModel = viewModel;
        this.frameContext = frameContext;
        this.localePipe = new LocalePipe(this.targetUiService && this.targetUiService.localeId || 'zh-CHS');
    }
    /**
     * 加载单据流生单流程执行后数据
     * @param {?} formVoId 表单绑定视图对象 Id
     * @return {?}
     */
    bifLoad(formVoId) {
        /** @type {?} */
        const args = new FormCreateArgs();
        args.formVoId = formVoId;
        //获取生单流程执行结果
        this.targetUiService.getCreationResult().subscribe((/**
         * @param {?} res
         * @return {?}
         */
        res => {
            args.rpcCreationRuleExecutorResult = res.creationRuleExecutorResult.ConvertToJson();
            //创建实体数据
            this.dataService.createEntityDatas(args).subscribe((/**
             * @param {?} result
             * @return {?}
             */
            (result) => {
                //切换状态机至 “新增”
                this.stateMachineService.transit("Create");
            }), (/**
             * @param {?} err
             * @return {?}
             */
            (err) => {
                this.messagerService.error(err.error == null ? err.message : (err.error.Message || err.error.message || err.message));
            }));
        }));
    }
    /**
     * 参照，根据目标VO Id打开生单流程选择器并执行选中的生单流程
     *
     * @param {?} targetVoId 单据流目标视图对象 Id
     * @param {?=} targetDataIds 目标单据主表Id列表
     * @param {?=} bizFlowchartId 业务场景图Id
     * @param {?=} modalOptions1 生单流程选择器模态框配置
     * @param {?=} customSelectorModuleUrl 生单流程选择器自定义选择器url
     * @param {?=} modalOptions2 来源单据选择器模态框配置
     * @param {?=} extParams1 打开生单流程选择器弹窗扩展参数
     * @param {?=} extParams2 打开来源单据选择器扩展参数
     * @return {?}
     */
    referByTargetVoId(targetVoId, targetDataIds, bizFlowchartId, modalOptions1, customSelectorModuleUrl, modalOptions2, extParams1, extParams2) {
        if (targetVoId == null || targetVoId == "" || targetVoId.trim && targetVoId.trim() == "") {
            this.messagerService.error(this.localePipe.transform("targetVoIdVoIdCantBeEmpty"));
            throw "参数targetVoId不可为空";
        }
        bizFlowchartId = bizFlowchartId === "" || bizFlowchartId == null ? undefined : bizFlowchartId;
        targetDataIds = (/** @type {?} */ (targetDataIds)) === "" || targetDataIds == null ? [this.bindingData.getObject().id] : targetDataIds;
        modalOptions1 = (/** @type {?} */ (modalOptions1)) === "" || modalOptions1 == null ? undefined : modalOptions1;
        customSelectorModuleUrl = customSelectorModuleUrl === "" || customSelectorModuleUrl == null ? undefined : customSelectorModuleUrl;
        modalOptions2 = (/** @type {?} */ (modalOptions2)) === "" || modalOptions2 == null ? {
            title: this.localePipe.transform("selectUpstreamBill"),
            width: 1100,
            height: 550,
        } : modalOptions2;
        extParams1 = extParams1 === "" || extParams1 == null ? undefined : extParams1;
        extParams2 = (/** @type {?} */ (extParams2)) === "" || extParams2 == null ? undefined : extParams2;
        //更新表单现有变更集
        this.cardDataService.update().subscribe((/**
         * @return {?}
         */
        () => {
            //打开生单流程选择器
            this.targetUiService.openBillCreationProcessSelector4Pull(targetVoId, bizFlowchartId, modalOptions1, customSelectorModuleUrl, extParams1).subscribe((/**
             * @param {?} cp
             * @return {?}
             */
            (cp) => {
                //获取表单配置
                this.dataService.getFormSettingsById(cp.formSettingsId).subscribe((/**
                 * @param {?} formSettings
                 * @return {?}
                 */
                (formSettings) => {
                    //打开来源单据选择器模态框
                    this.targetUiService.openSourceDataSelector4Pull(formSettings, modalOptions2, extParams2).subscribe((/**
                     * @param {?} entities
                     * @return {?}
                     */
                    (entities) => {
                        //构造生单流程执行参数实体
                        /** @type {?} */
                        const args = new FormBillCreationProcessExecutorArgs();
                        args.billCreationProcessId = cp.id;
                        args.creationRuleId = cp.creationRuleId;
                        // //FormBillCreationProcessExecutorArgs的sourceVoEntityDatas属性为前端实体序列化后的字符串列表
                        // //sourceVoEntityDatas列表中的每个字符串，在结构上应与单据流定义中所选中的上游视图对象一致。
                        // args.sourceVoEntityDatas = entities.map(item => {
                        //   if (item instanceof Entity) {
                        //     // 如果是Entity
                        //     return JSON.stringify((item as any).toJSON(false, true));
                        //   } else if (item["__type__"] == "BindingObject") {
                        //     //如果来自BindingData
                        //     const bindingObject = item as BindingObject;
                        //     return JSON.stringify(bindingObject.toJSON({ useFullMultiLangProperty: true }));
                        //   } else {
                        //     const e = item as Entity;
                        //     return JSON.stringify((e as any).toJSON(false, true));
                        //   }
                        // });
                        args.sourceVoEntityDatas = null;
                        // 默认使用ID列表
                        args.sourceVoEntityDataIds = entities.map((/**
                         * @param {?} it
                         * @return {?}
                         */
                        (it) => it.id || it.primaryValue));
                        args.targetVoDataIds = targetDataIds;
                        args.manualCreationMode = ManualCreationMode.Pull;
                        //执行生单流程
                        this.dataService.executeBillCreationProcess(args).subscribe((/**
                         * @param {?} result
                         * @return {?}
                         */
                        (result) => {
                            /** @type {?} */
                            const args = new FormUpdateArgs();
                            //Mapping执行条件判断结果为true时才会执行生单流程得到生单结果
                            if (result.conditionResult.conditionExecutionResult == true) {
                                //生单结果不为空
                                if (result.creationRuleExecutorResult && result.creationRuleExecutorResult.mappingResults && result.creationRuleExecutorResult.mappingResults.length > 0) {
                                    args.rpcCreationRuleExecutorResult = result.creationRuleExecutorResult.ConvertToJson();
                                    //更新表单数据
                                    this.dataService.updateEntityDatas(args).subscribe((/**
                                     * @param {?} res
                                     * @return {?}
                                     */
                                    (res) => {
                                        //重新加载表单数据
                                        this.cardDataService.load(targetDataIds[0]).subscribe();
                                    }), (/**
                                     * @param {?} err
                                     * @return {?}
                                     */
                                    (err) => {
                                        this.messagerService.error(err.error == null ? err.message : (err.error.Message || err.error.message || err.message));
                                    }));
                                }
                                else {
                                    this.messagerService.error(this.localePipe.transform("creationResultEmpty"));
                                }
                            }
                            else {
                                //为false时可得到配置的错误提示信息
                                this.messagerService.error(result.conditionResult.message || this.localePipe.transform("creationExecutionError"));
                            }
                        }), (/**
                         * @param {?} err
                         * @return {?}
                         */
                        (err) => {
                            this.messagerService.error(err.error == null ? err.message : (err.error.Message || err.error.message || err.message));
                        }));
                    }), (/**
                     * @param {?} err
                     * @return {?}
                     */
                    (err) => {
                        this.messagerService.error(err.error == null ? err.message : (err.error.Message || err.error.message || err.message));
                    }));
                }), (/**
                 * @param {?} err
                 * @return {?}
                 */
                (err) => {
                    this.messagerService.error(err.error == null ? err.message : (err.error.Message || err.error.message || err.message));
                }));
            }), (/**
             * @param {?} err
             * @return {?}
             */
            (err) => {
                this.messagerService.error(err.error == null ? err.message : (err.error.Message || err.error.message || err.message));
            }));
        }), (/**
         * @param {?} err
         * @return {?}
         */
        (err) => {
            this.messagerService.error(err.error == null ? err.message : (err.error.Message || err.error.message || err.message));
        }));
    }
    /**
     * 特定参照，根据来源VO Id和目标VO Id打开生单流程选择器并执行选中的生单流程
     *
     * @param {?} sourceVoId 单据流来源视图对象 Id
     * @param {?} targetVoId 单据流目标视图对象 Id
     * @param {?=} targetDataIds 目标单据主表Id列表
     * @param {?=} bizFlowchartId 业务场景图Id
     * @param {?=} modalOptions1 生单流程选择器模态框配置
     * @param {?=} customSelectorModuleUrl 生单流程选择器自定义选择器url
     * @param {?=} modalOptions2 来源单据选择器模态框配置
     * @param {?=} extParams1 打开生单流程选择器弹窗扩展参数
     * @param {?=} extParams2 打开来源单据选择器扩展参数
     * @return {?}
     */
    referBySourceVoIdAndTargetVoId(sourceVoId, targetVoId, targetDataIds, bizFlowchartId, modalOptions1, customSelectorModuleUrl, modalOptions2, extParams1, extParams2) {
        if (sourceVoId == null || sourceVoId == "" || sourceVoId.trim && sourceVoId.trim() == "") {
            this.messagerService.error(this.localePipe.transform("sourceVoIdCantBeEmpty"));
            throw "参数sourceVoId不可为空";
        }
        if (targetVoId == null || targetVoId == "" || targetVoId.trim && targetVoId.trim() == "") {
            this.messagerService.error(this.localePipe.transform("targetVoIdVoIdCantBeEmpty"));
            throw "参数targetVoId不可为空";
        }
        bizFlowchartId = bizFlowchartId === "" || bizFlowchartId == null ? undefined : bizFlowchartId;
        targetDataIds = (/** @type {?} */ (targetDataIds)) === "" || targetDataIds == null ? [this.bindingData.getObject().id] : targetDataIds;
        modalOptions1 = (/** @type {?} */ (modalOptions1)) === "" || modalOptions1 == null ? undefined : modalOptions1;
        customSelectorModuleUrl = customSelectorModuleUrl === "" || customSelectorModuleUrl == null ? undefined : customSelectorModuleUrl;
        modalOptions2 = (/** @type {?} */ (modalOptions2)) === "" || modalOptions2 == null ? {
            title: this.localePipe.transform("selectUpstreamBill"),
            width: 1100,
            height: 550,
        } : modalOptions2;
        extParams1 = extParams1 === "" || extParams1 == null ? undefined : extParams1;
        extParams2 = (/** @type {?} */ (extParams2)) === "" || extParams2 == null ? undefined : extParams2;
        //更新表单现有变更集
        this.cardDataService.update().subscribe((/**
         * @return {?}
         */
        () => {
            //打开生单流程选择器
            this.targetUiService.openBillCreationProcessSelector4SpecificPull(sourceVoId, targetVoId, bizFlowchartId, modalOptions1, customSelectorModuleUrl, extParams1).subscribe((/**
             * @param {?} cp
             * @return {?}
             */
            (cp) => {
                //获取表单配置
                this.dataService.getFormSettingsById(cp.formSettingsId).subscribe((/**
                 * @param {?} formSettings
                 * @return {?}
                 */
                (formSettings) => {
                    //打开来源单据选择器模态框
                    this.targetUiService.openSourceDataSelector4Pull(formSettings, modalOptions2, extParams2).subscribe((/**
                     * @param {?} entities
                     * @return {?}
                     */
                    (entities) => {
                        //构造生单流程执行参数实体
                        /** @type {?} */
                        const args = new FormBillCreationProcessExecutorArgs();
                        args.billCreationProcessId = cp.id;
                        args.creationRuleId = cp.creationRuleId;
                        // //FormBillCreationProcessExecutorArgs的sourceVoEntityDatas属性为前端实体序列化后的字符串列表
                        // //sourceVoEntityDatas列表中的每个字符串，在结构上应与单据流定义中所选中的上游视图对象一致。
                        // args.sourceVoEntityDatas = entities.map(item => {
                        //   if (item instanceof Entity) {
                        //     // 如果是Entity
                        //     return JSON.stringify((item as any).toJSON(false, true));
                        //   } else if (item["__type__"] == "BindingObject") {
                        //     //如果来自BindingData
                        //     const bindingObject = item as BindingObject;
                        //     return JSON.stringify(bindingObject.toJSON({ useFullMultiLangProperty: true }));
                        //   } else {
                        //     const e = item as Entity;
                        //     return JSON.stringify((e as any).toJSON(false, true));
                        //   }
                        // });
                        args.sourceVoEntityDatas = null;
                        // 默认使用ID列表
                        args.sourceVoEntityDataIds = entities.map((/**
                         * @param {?} it
                         * @return {?}
                         */
                        (it) => it.id || it.primaryValue));
                        args.targetVoDataIds = targetDataIds;
                        args.manualCreationMode = ManualCreationMode.SpecificPull;
                        //执行生单流程
                        this.dataService.executeBillCreationProcess(args).subscribe((/**
                         * @param {?} result
                         * @return {?}
                         */
                        (result) => {
                            /** @type {?} */
                            const args = new FormUpdateArgs();
                            //Mapping执行条件判断结果为true时才会执行生单流程得到生单结果
                            if (result.conditionResult.conditionExecutionResult == true) {
                                //生单结果不为空
                                if (result.creationRuleExecutorResult && result.creationRuleExecutorResult.mappingResults && result.creationRuleExecutorResult.mappingResults.length > 0) {
                                    args.rpcCreationRuleExecutorResult = result.creationRuleExecutorResult.ConvertToJson();
                                    //更新表单数据
                                    this.dataService.updateEntityDatas(args).subscribe((/**
                                     * @param {?} res
                                     * @return {?}
                                     */
                                    (res) => {
                                        //重新加载表单数据
                                        this.cardDataService.load(targetDataIds[0]).subscribe();
                                    }), (/**
                                     * @param {?} err
                                     * @return {?}
                                     */
                                    (err) => {
                                        this.messagerService.error(err.error == null ? err.message : (err.error.Message || err.error.message || err.message));
                                    }));
                                }
                                else {
                                    this.messagerService.error(this.localePipe.transform("creationResultEmpty"));
                                }
                            }
                            else {
                                //为false时可得到配置的错误提示信息
                                this.messagerService.error(result.conditionResult.message || this.localePipe.transform("creationExecutionError"));
                            }
                        }), (/**
                         * @param {?} err
                         * @return {?}
                         */
                        (err) => {
                            this.messagerService.error(err.error == null ? err.message : (err.error.Message || err.error.message || err.message));
                        }));
                    }), (/**
                     * @param {?} err
                     * @return {?}
                     */
                    (err) => {
                        this.messagerService.error(err.error == null ? err.message : (err.error.Message || err.error.message || err.message));
                    }));
                }), (/**
                 * @param {?} err
                 * @return {?}
                 */
                (err) => {
                    this.messagerService.error(err.error == null ? err.message : (err.error.Message || err.error.message || err.message));
                }));
            }), (/**
             * @param {?} err
             * @return {?}
             */
            (err) => {
                this.messagerService.error(err.error == null ? err.message : (err.error.Message || err.error.message || err.message));
            }));
        }), (/**
         * @param {?} err
         * @return {?}
         */
        (err) => {
            this.messagerService.error(err.error == null ? err.message : (err.error.Message || err.error.message || err.message));
        }));
    }
    /**
     * 特定参照，根据生单流程ID执行选中的生单流程
     *
     * @param {?} processId 单据流生单流程 Id
     * @param {?=} targetDataIds 目标单据主表Id列表
     * @param {?=} modalOptions 来源单据选择器模态框配置
     * @param {?=} extParams 打开来源单据选择器扩展参数
     * @return {?}
     */
    referByCreationProcessId(processId, targetDataIds, modalOptions, extParams) {
        if (processId == null || processId == "" || processId.trim() == "") {
            this.messagerService.error(this.localePipe.transform("processIdCantBeEmpty"));
            throw "参数processId不可为空";
        }
        targetDataIds = (/** @type {?} */ (targetDataIds)) === "" || targetDataIds == null ? [this.bindingData.getObject().id] : targetDataIds;
        modalOptions = (/** @type {?} */ (modalOptions)) === "" || modalOptions == null ? {
            title: this.localePipe.transform("selectUpstreamBill"),
            width: 1100,
            height: 550,
        } : modalOptions;
        extParams = (/** @type {?} */ (extParams)) === "" || extParams == null ? undefined : extParams;
        //更新表单现有变更集
        this.cardDataService.update().subscribe((/**
         * @return {?}
         */
        () => {
            //打开生单流程选择器
            this.dataService.getSlimBillCreationProcessEntityExById(processId).subscribe((/**
             * @param {?} cp
             * @return {?}
             */
            (cp) => {
                //获取表单配置
                this.dataService.getFormSettingsById(cp.formSettingsId).subscribe((/**
                 * @param {?} formSettings
                 * @return {?}
                 */
                (formSettings) => {
                    //打开来源单据选择器模态框
                    this.targetUiService.openSourceDataSelector4Pull(formSettings, modalOptions, extParams).subscribe((/**
                     * @param {?} entities
                     * @return {?}
                     */
                    (entities) => {
                        //构造生单流程执行参数实体
                        /** @type {?} */
                        const args = new FormBillCreationProcessExecutorArgs();
                        args.billCreationProcessId = cp.id;
                        args.creationRuleId = cp.creationRuleId;
                        // //FormBillCreationProcessExecutorArgs的sourceVoEntityDatas属性为前端实体序列化后的字符串列表
                        // //sourceVoEntityDatas列表中的每个字符串，在结构上应与单据流定义中所选中的上游视图对象一致。
                        // args.sourceVoEntityDatas = entities.map(item => {
                        //   if (item instanceof Entity) {
                        //     // 如果是Entity
                        //     return JSON.stringify((item as any).toJSON(false, true));
                        //   } else if (item["__type__"] == "BindingObject") {
                        //     //如果来自BindingData
                        //     const bindingObject = item as BindingObject;
                        //     return JSON.stringify(bindingObject.toJSON({ useFullMultiLangProperty: true }));
                        //   } else {
                        //     const e = item as Entity;
                        //     return JSON.stringify((e as any).toJSON(false, true));
                        //   }
                        // });
                        args.sourceVoEntityDatas = null;
                        // 默认使用ID列表
                        args.sourceVoEntityDataIds = entities.map((/**
                         * @param {?} it
                         * @return {?}
                         */
                        (it) => it.id || it.primaryValue));
                        args.targetVoDataIds = targetDataIds;
                        args.manualCreationMode = ManualCreationMode.SpecificPull;
                        //执行生单流程
                        this.dataService.executeBillCreationProcess(args).subscribe((/**
                         * @param {?} result
                         * @return {?}
                         */
                        (result) => {
                            /** @type {?} */
                            const args = new FormUpdateArgs();
                            //Mapping执行条件判断结果为true时才会执行生单流程得到生单结果
                            if (result.conditionResult.conditionExecutionResult == true) {
                                //生单结果不为空
                                if (result.creationRuleExecutorResult && result.creationRuleExecutorResult.mappingResults && result.creationRuleExecutorResult.mappingResults.length > 0) {
                                    args.rpcCreationRuleExecutorResult = result.creationRuleExecutorResult.ConvertToJson();
                                    //更新表单数据
                                    this.dataService.updateEntityDatas(args).subscribe((/**
                                     * @param {?} res
                                     * @return {?}
                                     */
                                    (res) => {
                                        //重新加载表单数据
                                        this.cardDataService.load(targetDataIds[0]).subscribe();
                                    }), (/**
                                     * @param {?} err
                                     * @return {?}
                                     */
                                    (err) => {
                                        this.messagerService.error(err.error == null ? err.message : (err.error.Message || err.error.message || err.message));
                                    }));
                                }
                                else {
                                    this.messagerService.error(this.localePipe.transform("creationResultEmpty"));
                                }
                            }
                            else {
                                //为false时可得到配置的错误提示信息
                                this.messagerService.error(result.conditionResult.message || this.localePipe.transform("creationExecutionError"));
                            }
                        }), (/**
                         * @param {?} err
                         * @return {?}
                         */
                        (err) => {
                            this.messagerService.error(err.error == null ? err.message : (err.error.Message || err.error.message || err.message));
                        }));
                    }), (/**
                     * @param {?} err
                     * @return {?}
                     */
                    (err) => {
                        this.messagerService.error(err.error == null ? err.message : (err.error.Message || err.error.message || err.message));
                    }));
                }), (/**
                 * @param {?} err
                 * @return {?}
                 */
                (err) => {
                    this.messagerService.error(err.error == null ? err.message : (err.error.Message || err.error.message || err.message));
                }));
            }), (/**
             * @param {?} err
             * @return {?}
             */
            (err) => {
                this.messagerService.error(err.error == null ? err.message : (err.error.Message || err.error.message || err.message));
            }));
        }), (/**
         * @param {?} err
         * @return {?}
         */
        (err) => {
            this.messagerService.error(err.error == null ? err.message : (err.error.Message || err.error.message || err.message));
        }));
    }
    /**
     * \@Deprecated 已弃用，请使用 {\@link getCreationResult }
     * 获取来源界面传入的生单流程执行结果
     * @return {?} creationResult 生单流程执行结果 \@type { FormBillCreationProcessExecutorResult }
     */
    getFormBillCreationProcessExecutorResult() {
        return this.targetUiService.getFormBillCreationProcessExecutorResult();
    }
    /**
     * 根据目标VO Id打开生单流程选择器查找生单流程
     * @param {?} targetVoId 目标VO Id
     * @param {?=} bizFlowchartId 业务场景图Id
     * @param {?=} modalOptions 模态框配置
     * @param {?=} customSelectorModuleUrl 自定义选择器Url
     * @param {?=} extParams 扩展参数
     * @return {?} creationProcess 生单流程 \@type { Observable<IRtSlimBillCreationProcessEntityEx> }
     */
    openBillCreationProcessSelector4Pull(targetVoId, bizFlowchartId, modalOptions, customSelectorModuleUrl, extParams) {
        if (targetVoId == null || targetVoId == "" || targetVoId.trim && targetVoId.trim() == "") {
            this.messagerService.error(this.localePipe.transform("targetVoIdVoIdCantBeEmpty"));
            throw "参数targetVoId不可为空";
        }
        bizFlowchartId = bizFlowchartId === "" || bizFlowchartId == null ? undefined : bizFlowchartId;
        modalOptions = (/** @type {?} */ (modalOptions)) === "" || modalOptions == null ? undefined : modalOptions;
        customSelectorModuleUrl = customSelectorModuleUrl === "" || customSelectorModuleUrl == null ? undefined : customSelectorModuleUrl;
        extParams = extParams === "" || extParams == null ? undefined : extParams;
        //打开生单流程选择器
        return this.targetUiService.openBillCreationProcessSelector4Pull(targetVoId, bizFlowchartId, modalOptions, customSelectorModuleUrl, extParams);
    }
    /**
     * 根据来源VO Id和目标VO Id打开生单流程选择器查找生单流程
     * @param {?} sourceVoId 来源VO Id
     * @param {?} targetVoId 目标VO Id
     * @param {?=} bizFlowchartId 业务场景图Id
     * @param {?=} modalOptions 模态框配置
     * @param {?=} customSelectorModuleUrl 自定义选择器Url
     * @param {?=} extParams 扩展参数
     * @return {?} creationProcess 生单流程 \@type { Observable<IRtSlimBillCreationProcessEntityEx> }
     */
    openBillCreationProcessSelector4SpecificPull(sourceVoId, targetVoId, bizFlowchartId, modalOptions, customSelectorModuleUrl, extParams) {
        if (sourceVoId == null || sourceVoId == "" || sourceVoId.trim && sourceVoId.trim() == "") {
            this.messagerService.error(this.localePipe.transform("sourceVoIdCantBeEmpty"));
            throw "参数sourceVoId不可为空";
        }
        if (targetVoId == null || targetVoId == "" || targetVoId.trim && targetVoId.trim() == "") {
            this.messagerService.error(this.localePipe.transform("targetVoIdVoIdCantBeEmpty"));
            throw "参数targetVoId不可为空";
        }
        bizFlowchartId = bizFlowchartId === "" || bizFlowchartId == null ? undefined : bizFlowchartId;
        modalOptions = (/** @type {?} */ (modalOptions)) === "" || modalOptions == null ? undefined : modalOptions;
        customSelectorModuleUrl = customSelectorModuleUrl === "" || customSelectorModuleUrl == null ? undefined : customSelectorModuleUrl;
        extParams = (/** @type {?} */ (extParams)) === "" || extParams == null ? undefined : extParams;
        return this.targetUiService.openBillCreationProcessSelector4SpecificPull(sourceVoId, targetVoId, bizFlowchartId, modalOptions, customSelectorModuleUrl, extParams);
    }
    /**
     * 打开来源单据选择器选择数据
     * @param {?} formSettings 表单配置
     * @param {?=} modalOptions 模态框配置
     * @param {?=} extParams 扩展参数
     * @return {?} entities 数据列表 \@type { Observable<Entity[]> }
     */
    openSourceDataSelector4Pull(formSettings, modalOptions, extParams) {
        modalOptions = (/** @type {?} */ (modalOptions)) === "" || modalOptions == null ? {
            title: this.localePipe.transform("selectUpstreamBill"),
            width: 1100,
            height: 550,
        } : modalOptions;
        extParams = (/** @type {?} */ (extParams)) === "" || extParams == null ? undefined : extParams;
        //打开来源单据选择器模态框
        return this.targetUiService.openSourceDataSelector4Pull(formSettings, modalOptions, extParams);
    }
    /**
     * 获取传到根组件UIState上的生单规则执行器结果
     * @return {?} creationResult 生单流程执行结果 \@type { FormBillCreationProcessExecutorResult }
     */
    getCreationResult() {
        return this.targetUiService.getCreationResult();
    }
}
BifManualCreationTargetWebCmpService.decorators = [
    { type: Injectable }
];
/** @nocollapse */
BifManualCreationTargetWebCmpService.ctorParameters = () => [
    { type: BifDataService },
    { type: BifTargetUiService },
    { type: StateMachineService },
    { type: BindingData },
    { type: MessagerService },
    { type: CardDataService },
    { type: ViewModel, decorators: [{ type: Optional }] },
    { type: FrameContext, decorators: [{ type: Optional }] }
];

/**
 * @fileoverview added by tsickle
 * Generated from: lib/webcmp/providers.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/**
 * 因为BifDataService,BifSourceUiService,BifTargetUiService所依赖的\@farris/devkit相关
 * 服务类如FrameContext、BindingData、Repository等均在RootComponent上提供，因此直接在模
 * 块上注册BIF_MANUAL_CREATION_PROVIDERS也无法获取到上述服务类，因此
 * BIF_MANUAL_CREATION_PROVIDERS只能在RootComponent上注册。
 * @type {?}
 */
const BIF_MANUAL_CREATION_PROVIDERS = [
    BifDataService,
    BifSourceUiService,
    BifTargetUiService,
    { provide: AbstractBifDataSelectorService, useClass: DefaultBifDataSelectorService },
    BifManualCreationDataWebCmpService,
    BifManualCreationSourceWebCmpService,
    BifManualCreationTargetWebCmpService,
];
/**
 * 同理，如果后续BIF_BILL_TRACKER_PROVIDERS中服务类需要使用\@farris/devkit时，也只能在
 * root-component上注册
 * @type {?}
 */
const BIF_BILL_TRACKER_PROVIDERS = [
    BillTrackerUiService,
    BifBillTrackerWebCmpService,
];
/** @type {?} */
const BIF_DEVKIT_PROVIDERS = [
    ...BIF_MANUAL_CREATION_PROVIDERS,
    ...BIF_BILL_TRACKER_PROVIDERS,
];

/**
 * @fileoverview added by tsickle
 * Generated from: lib/webcmp/bif-bill-tracker-webcmp.module.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
class BifBillTrackerWebCmpModule {
    /**
     * @return {?}
     */
    static forRoot() {
        return {
            ngModule: BifBillTrackerWebCmpModule,
            providers: [
            // ...BIF_BILL_TRACKER_PROVIDERS,
            ]
        };
    }
}
BifBillTrackerWebCmpModule.decorators = [
    { type: NgModule, args: [{
                providers: [
                    ...BIF_BILL_TRACKER_PROVIDERS,
                ],
            },] }
];

/**
 * @fileoverview added by tsickle
 * Generated from: lib/webcmp/bif-manual-creation-webcmp.module.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
class BifManualCreationWebCmpModule {
    /**
     * @return {?}
     */
    static forRoot() {
        return {
            ngModule: BifManualCreationWebCmpModule,
            providers: [
            // ...BIF_MANUAL_CREATION_PROVIDERS,
            ]
        };
    }
}
BifManualCreationWebCmpModule.decorators = [
    { type: NgModule, args: [{
                providers: [
                    ...BIF_MANUAL_CREATION_PROVIDERS,
                ],
            },] }
];

/**
 * @fileoverview added by tsickle
 * Generated from: public-api.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */

/**
 * @fileoverview added by tsickle
 * Generated from: edp-bif-runtime-api.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */

export { BifDataService, AbstractBifDataSelectorService, DefaultBifDataSelectorService, BifSourceUiService, BifTargetUiService, PushSelectorComponent, PullSelectorComponent, BifManualCreationModule, BillTrackerArgs, BillTrackerUiService, BillTrackerComponent, BillTrackerModule, BifBillTrackerWebCmpService, BifManualCreationDataWebCmpService, BifManualCreationSourceWebCmpService, BifManualCreationTargetWebCmpService, BifBillTrackerWebCmpModule, BifManualCreationWebCmpModule, mxDefaultKeyHandlerType as mxDefaultKeyHandler, mxDefaultPopupMenuType as mxDefaultPopupMenu, mxDefaultToolbarType as mxDefaultToolbar, mxEditorType as mxEditor, mxCellHighlightType as mxCellHighlight, mxCellMarkerType as mxCellMarker, mxCellTrackerType as mxCellTracker, mxConnectionHandlerType as mxConnectionHandler, mxConstraintHandlerType as mxConstraintHandler, mxEdgeHandlerType as mxEdgeHandler, mxEdgeSegmentHandlerType as mxEdgeSegmentHandler, mxElbowEdgeHandlerType as mxElbowEdgeHandler, mxGraphHandlerType as mxGraphHandler, mxHandleType as mxHandle, mxKeyHandlerType as mxKeyHandler, mxPanningHandlerType as mxPanningHandler, mxPopupMenuHandlerType as mxPopupMenuHandler, mxRubberbandType as mxRubberband, mxSelectionCellsHandlerType as mxSelectionCellsHandler, mxTooltipHandlerType as mxTooltipHandler, mxVertexHandlerType as mxVertexHandler, mxCellCodecType as mxCellCodec, mxChildChangeCodecType as mxChildChangeCodec, mxDefaultKeyHandlerCodecType as mxDefaultKeyHandlerCodec, mxDefaultPopupMenuCodecType as mxDefaultPopupMenuCodec, mxDefaultToolbarCodecType as mxDefaultToolbarCodec, mxEditorCodecType as mxEditorCodec, mxGenericChangeCodecType as mxGenericChangeCodec, mxGraphCodecType as mxGraphCodec, mxGraphViewCodecType as mxGraphViewCodec, mxModelCodecType as mxModelCodec, mxObjectCodecType as mxObjectCodec, mxRootChangeCodecType as mxRootChangeCodec, mxStylesheetCodecType as mxStylesheetCodec, mxTerminalChangeCodecType as mxTerminalChangeCodec, mxCircleLayoutType as mxCircleLayout, mxCompactTreeLayoutType as mxCompactTreeLayout, mxCompositeLayoutType as mxCompositeLayout, mxEdgeLabelLayoutType as mxEdgeLabelLayout, mxFastOrganicLayoutType as mxFastOrganicLayout, mxGraphLayoutType as mxGraphLayout, mxParallelEdgeLayoutType as mxParallelEdgeLayout, mxPartitionLayoutType as mxPartitionLayout, mxRadialTreeLayoutType as mxRadialTreeLayout, mxStackLayoutType as mxStackLayout, mxHierarchicalLayoutType as mxHierarchicalLayout, mxSwimlaneLayoutType as mxSwimlaneLayout, mxGraphAbstractHierarchyCellType as mxGraphAbstractHierarchyCell, mxGraphHierarchyEdgeType as mxGraphHierarchyEdge, mxGraphHierarchyModelType as mxGraphHierarchyModel, mxGraphHierarchyNodeType as mxGraphHierarchyNode, mxSwimlaneModelType as mxSwimlaneModel, mxCoordinateAssignmentType as mxCoordinateAssignment, mxHierarchicalLayoutStageType as mxHierarchicalLayoutStage, mxMedianHybridCrossingReductionType as mxMedianHybridCrossingReduction, mxMinimumCycleRemoverType as mxMinimumCycleRemover, mxSwimlaneOrderingType as mxSwimlaneOrdering, mxCellType as mxCell, mxCellPathType as mxCellPath, mxGeometryType as mxGeometry, mxGraphModelType as mxGraphModel, renderingHintType as renderingHint, mxActorType as mxActor, mxArrowType as mxArrow, mxArrowConnectorType as mxArrowConnector, mxCloudType as mxCloud, mxConnectorType as mxConnector, mxCylinderType as mxCylinder, mxDoubleEllipseType as mxDoubleEllipse, mxEllipseType as mxEllipse, mxHexagonType as mxHexagon, mxImageShapeType as mxImageShape, mxLabelType as mxLabel, mxLineType as mxLine, mxMarkerType as mxMarker, mxPolylineType as mxPolyline, mxRectangleShapeType as mxRectangleShape, mxRhombusType as mxRhombus, mxShapeType as mxShape, mxStencilType as mxStencil, mxStencilRegistryType as mxStencilRegistry, mxSwimlaneType as mxSwimlane, mxTextType as mxText, mxTriangleType as mxTriangle, mxAbstractCanvas2DType as mxAbstractCanvas2D, mxAnimationType as mxAnimation, mxAutoSaveManagerType as mxAutoSaveManager, mxClipboardType as mxClipboard, mxConstantsType as mxConstants, mxDictionaryType as mxDictionary, mxDivResizerType as mxDivResizer, mxDragSourceType as mxDragSource, mxEffectsType as mxEffects, mxEventType as mxEvent, mxEventObjectType as mxEventObject, mxEventSourceType as mxEventSource, mxFormType as mxForm, mxGuideType as mxGuide, mxImageType as mxImage, mxImageBundleType as mxImageBundle, mxImageExportType as mxImageExport, mxLogType as mxLog, mxMorphingType as mxMorphing, mxMouseEventType as mxMouseEvent, mxObjectIdentityType as mxObjectIdentity, mxPanningManagerType as mxPanningManager, mxPointType as mxPoint, mxPopupMenuType as mxPopupMenu, mxRectangleType as mxRectangle, mxResourcesType as mxResources, mxSvgCanvas2DType as mxSvgCanvas2D, mxToolbarType as mxToolbar, mxUndoableEditType as mxUndoableEdit, mxUndoManagerType as mxUndoManager, mxUrlConverterType as mxUrlConverter, mxUtilsType as mxUtils, mxVmlCanvas2DType as mxVmlCanvas2D, mxWindowType as mxWindow, mxXmlCanvas2DType as mxXmlCanvas2D, mxXmlRequestType as mxXmlRequest, mxCellEditorType as mxCellEditor, mxCellOverlayType as mxCellOverlay, mxCellRendererType as mxCellRenderer, mxCellStateType as mxCellState, mxCellStatePreviewType as mxCellStatePreview, mxConnectionConstraintType as mxConnectionConstraint, mxEdgeStyleType as mxEdgeStyle, mxGraphType as mxGraph, mxGraphSelectionModelType as mxGraphSelectionModel, mxGraphViewType as mxGraphView, mxLayoutManagerType as mxLayoutManager, mxMultiplicityType as mxMultiplicity, mxOutlineType as mxOutline, mxPerimeterType as mxPerimeter, mxPrintPreviewType as mxPrintPreview, mxStyleRegistryType as mxStyleRegistry, mxStylesheetType as mxStylesheet, mxSwimlaneManagerType as mxSwimlaneManager, mxTemporaryCellStatesType as mxTemporaryCellStates, mxClientType as mxClient, mxgraph, MxGraphNS$1 as MxGraphNS, BillData$1 as BillData, FormBillCreationProcessExecutorArgs, FormGetBillCreationProcessEntityExArgs, FormGetBillCreationProcessEntityExResult, ManualCreationMode, GeneralTextIdWithDataId, BillDataInfo, BillInfo, CanTrackingInfo, DownBillInfo, GetBillsInfoArgs, GetDownBillsInfoArgs, GetUpBillsInfoArgs, TrackingHelper, TrackingMappingAssociation, UpBillInfo, BillChildInfo, BillDetailInfo, BillItemInfo, FieldsWithOrder, SummaryFieldsInfo, FieldNameAndValue, DateTypeFormatInfo, DecimalTypeFormatInfo, TypeToFormat$1 as TypeToFormat, ScaleMode, ExpressionJointQueryParameterContent, FieldJointQueryParameterContent, JointQueryParameterContent, JointQueryParameterMode, JointQueryParameterResult, JointQueryParametersContent, SimpleValueMappingInfo, StringDisplayMode, StringTypeFormatInfo, Exceptions, BIF_UISTATE_KEY_CREATION_RESULT, BIF_UISTATE_KEY_OPEN_TYPE, ModuleConfig, SELECTOR_ARGS_INJECTOR, DEFAULT_SELECTOR_ARGS, PushTaskArgs, GetEntityDatasArgs, CanTrackingResult, GetChildrenEntityDataArgs, DownBillInfoResult, EntityDataResult, GetEntityDataArgs, GetMainEntityDataArgs, UpBillInfoResult, GetJointQueryParametersArgs, BillTrackerConstant, BillTrackerModuleConfig, BillTrackerDirection, BillTrackerGraphOptions, BillTrackerGridOptions, Graph, GraphView, BillNodeShape, BillAssociationLine, CompactTreeLayout, RevertCompactTreeLayout, VertexHandler, Events, BillCell, CellOverlay, CellOverlayState, Outline, Styles, BIF_MANUAL_CREATION_PROVIDERS, BIF_BILL_TRACKER_PROVIDERS, BIF_DEVKIT_PROVIDERS, ModuleConfig as ɵe, SELECTOR_ARGS_INJECTOR as ɵd, LocalePipe as ɵa, AbstractUiService as ɵb, BasicInfoComponent as ɵl, BasicTableComponent as ɵi, ChildRowTableDirective as ɵj, BillTrackerDataComponent as ɵh, BillTrackerGraphComponent as ɵg, ChildInfoListComponent as ɵo, ChildInfoComponent as ɵn, BillTrackerModuleConfig as ɵq, BillTrackerFieldLabelPipe as ɵp, BillTrackerLocalePipe as ɵk, BillTrackerDataInfoService as ɵm, BillTrackerDataService as ɵf, BillTrackerInternalUiService as ɵr };

//# sourceMappingURL=edp-bif-runtime-api.js.map
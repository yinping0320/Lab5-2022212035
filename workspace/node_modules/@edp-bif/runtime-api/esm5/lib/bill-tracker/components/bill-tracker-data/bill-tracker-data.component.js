/**
 * @fileoverview added by tsickle
 * Generated from: lib/bill-tracker/components/bill-tracker-data/bill-tracker-data.component.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, ComponentFactoryResolver, Injector, ViewContainerRef, ViewChild, ComponentRef, NgModuleFactoryLoader, ChangeDetectorRef, Optional, LOCALE_ID, Inject, ElementRef } from '@angular/core';
import { BasicTableComponent } from '../basic-table/basic-table.component';
import { BillTrackerDataService } from '../../services/bill-tracker-data.service';
import { LoadingService } from '@farris/ui-loading';
import { MessagerService } from '@farris/ui-messager';
import { BillTrackingSettings, BillTrackingDataShownMode } from '@edp-bif/common-api';
import { from, of } from 'rxjs';
import { switchMap } from 'rxjs/operators';
import { BasicInfoComponent } from '../basic-info/basic-info.component';
import { NotifyService } from '@farris/ui-notify';
import { BsModalService } from '@farris/ui-modal';
import { BillTrackerDataInfoService } from '../../services/bill-tracker-data-info.service';
import { BillTrackerLocalePipe } from '../../pipe/bill-tracker-locale.pipe';
var BillTrackerDataComponent = /** @class */ (function () {
    function BillTrackerDataComponent(notify, messager, loading, modal, dataService, inj, cfr, cdf, loader, localeId, vcr, er) {
        this.notify = notify;
        this.messager = messager;
        this.loading = loading;
        this.modal = modal;
        this.dataService = dataService;
        this.inj = inj;
        this.cfr = cfr;
        this.cdf = cdf;
        this.loader = loader;
        this.dataInfoService = new BillTrackerDataInfoService();
        this.localeId = localeId || this.inj.get(LOCALE_ID, null) || 'zh-CHS';
        this.localePipe = new BillTrackerLocalePipe(localeId);
        this.vcr = vcr || this.inj.get(ViewContainerRef, null);
        this.er = er || this.inj.get(ElementRef, null);
    }
    /**
     * @return {?}
     */
    BillTrackerDataComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
    };
    /**
     * @return {?}
     */
    BillTrackerDataComponent.prototype.ngAfterViewInit = /**
     * @return {?}
     */
    function () {
    };
    /**
     * @return {?}
     */
    BillTrackerDataComponent.prototype.clearDataRegion = /**
     * @return {?}
     */
    function () {
        this.dataRegion.clear();
    };
    /**
     * @param {?} args
     * @param {?=} billInfo
     * @param {?=} billDataInfo
     * @param {?=} res
     * @return {?}
     */
    BillTrackerDataComponent.prototype.showDataGrid = /**
     * @param {?} args
     * @param {?=} billInfo
     * @param {?=} billDataInfo
     * @param {?=} res
     * @return {?}
     */
    function (args, billInfo, billDataInfo, res) {
        // 单据追踪配置
        /** @type {?} */
        var bts = new BillTrackingSettings();
        if (billInfo && billInfo.billTrackingSettings) {
            bts.LoadFromJson(billInfo.billTrackingSettings);
        }
        if (bts.billTrackingDataShownMode == BillTrackingDataShownMode.CUSTOMFORM) {
            this.showCustomForm(args, billInfo, billDataInfo);
        }
        else {
            this.showGeneralForm(args, billInfo, billDataInfo, res);
        }
    };
    /**
     * 打开通用表单
     * @param args
     * @param billInfo
     * @param res
     */
    /**
     * 打开通用表单
     * @private
     * @param {?} args
     * @param {?=} billInfo
     * @param {?=} billDataInfo
     * @param {?=} res
     * @param {?=} newBTS
     * @return {?}
     */
    BillTrackerDataComponent.prototype.showGeneralForm = /**
     * 打开通用表单
     * @private
     * @param {?} args
     * @param {?=} billInfo
     * @param {?=} billDataInfo
     * @param {?=} res
     * @param {?=} newBTS
     * @return {?}
     */
    function (args, billInfo, billDataInfo, res, newBTS) {
        var _this = this;
        if (res != null) {
            this.createDataComp(res, billInfo, billDataInfo);
        }
        else {
            /** @type {?} */
            var l_1 = this.loading.show({ message: this.localePipe.transform("loading") });
            this.dataService.getEntityData(args).subscribe((/**
             * @param {?} res
             * @return {?}
             */
            function (res) {
                _this.createDataComp(res, billInfo, billDataInfo);
                l_1.close();
            }), (/**
             * @param {?} err
             * @return {?}
             */
            function (err) {
                l_1.close();
                _this.messager.error(err.error == null ? err.message : (err.error.Message || err.error.message || err.message));
                throw err;
            }));
        }
    };
    /**
     * 打开自定义表单
     * @param args
     * @param billInfo
     */
    /**
     * 打开自定义表单
     * @private
     * @param {?} args
     * @param {?=} billInfo
     * @param {?=} billDataInfo
     * @return {?}
     */
    BillTrackerDataComponent.prototype.showCustomForm = /**
     * 打开自定义表单
     * @private
     * @param {?} args
     * @param {?=} billInfo
     * @param {?=} billDataInfo
     * @return {?}
     */
    function (args, billInfo, billDataInfo) {
        var _this = this;
        /** @type {?} */
        var bts = new BillTrackingSettings();
        if (billInfo && billInfo.billTrackingSettings) {
            bts.LoadFromJson(billInfo.billTrackingSettings);
        }
        /** @type {?} */
        var formContent = JSON.parse(bts.customFormContent);
        /** @type {?} */
        var moduleF$ = null;
        if (formContent.form.endsWith(".js")) {
            // url格式为[js路径]时
            moduleF$ = from(System.import(formContent.form.toLowerCase()).then((/**
             * @param {?} m
             * @return {?}
             */
            function (m) { return m; }))).pipe(switchMap((/**
             * @param {?} m
             * @return {?}
             */
            function (m) {
                for (var key in m) {
                    return of(m[key]);
                }
                return of(null);
            })));
        }
        else {
            // url格式为[js路径#模块名]时
            moduleF$ = from(this.loader.load(formContent.form));
        }
        moduleF$.subscribe((/**
         * @param {?} moduleFactory
         * @return {?}
         */
        function (moduleFactory) {
            /** @type {?} */
            var moduleRef = moduleFactory.create(_this.inj);
            /** @type {?} */
            var cmpR$ = moduleRef.instance.createDataShownComponent(_this.inj, args);
            if (cmpR$ instanceof ComponentRef) {
                cmpR$ = of(cmpR$);
            }
            cmpR$.subscribe((/**
             * @param {?} cmpR
             * @return {?}
             */
            function (cmpR) {
                // 重置滚动条
                /** @type {?} */
                var elt = (/** @type {?} */ (_this.dataRegion.element.nativeElement.parentElement));
                elt.scrollTo({ left: 0 });
                _this.dataRegion.clear();
                _this.dataRegion.insert(cmpR.hostView);
            }));
        }));
    };
    /**
   * 创建通用表组件
   * @param res
   * @param billInfo
   */
    /**
     * 创建通用表组件
     * @param {?} res
     * @param {?} billInfo
     * @param {?} billDataInfo
     * @return {?}
     */
    BillTrackerDataComponent.prototype.createDataComp = /**
     * 创建通用表组件
     * @param {?} res
     * @param {?} billInfo
     * @param {?} billDataInfo
     * @return {?}
     */
    function (res, billInfo, billDataInfo) {
        /** @type {?} */
        var newBTS = this.dataInfoService.isNewBTS(billInfo.billTrackingSettings);
        // if (newBTS) {
        try {
            this.createNewDataComp(res, billInfo, billDataInfo);
        }
        catch (e) {
            // 重置滚动条
            /** @type {?} */
            var elt = (/** @type {?} */ (this.dataRegion.element.nativeElement.parentElement));
            elt && elt.scrollTo({ left: 0 });
            this.dataRegion.clear();
            /** @type {?} */
            var cmf = this.cfr.resolveComponentFactory(BasicTableComponent);
            /** @type {?} */
            var cmpR = this.dataRegion.createComponent(cmf);
            cmpR.instance.billInfo = billInfo;
            cmpR.instance.isMain = true;
            cmpR.instance.showMainTable(res);
            this.dataRegion.insert(cmpR.hostView);
        }
        // }
    };
    /**
   * 创建通用表组件
   * @param res
   * @param billInfo
   */
    /**
     * 创建通用表组件
     * @param {?} res
     * @param {?=} billInfo
     * @param {?=} billDataInfo
     * @return {?}
     */
    BillTrackerDataComponent.prototype.createNewDataComp = /**
     * 创建通用表组件
     * @param {?} res
     * @param {?=} billInfo
     * @param {?=} billDataInfo
     * @return {?}
     */
    function (res, billInfo, billDataInfo) {
        // 重置滚动条
        /** @type {?} */
        var elt = (/** @type {?} */ (this.dataRegion.element.nativeElement.parentElement));
        elt && elt.scrollTo({ left: 0 });
        this.dataRegion.clear();
        /** @type {?} */
        var cmf = this.cfr.resolveComponentFactory(BasicInfoComponent);
        /** @type {?} */
        var cmpR = this.dataRegion.createComponent(cmf);
        cmpR.instance.schemaTable = res.billSchema.mainTable;
        cmpR.instance.dataTable = res.billData.mainTable;
        cmpR.instance.billInfo = billInfo;
        cmpR.instance.billDataInfo = billDataInfo;
        this.dataRegion.insert(cmpR.hostView);
    };
    BillTrackerDataComponent.decorators = [
        { type: Component, args: [{
                    selector: 'lib-bill-tracker-data',
                    template: "<div style=\"\">\r\n    <ng-container #dataRegion></ng-container>\r\n</div>",
                    styles: [""]
                }] }
    ];
    /** @nocollapse */
    BillTrackerDataComponent.ctorParameters = function () { return [
        { type: NotifyService },
        { type: MessagerService },
        { type: LoadingService },
        { type: BsModalService },
        { type: BillTrackerDataService },
        { type: Injector },
        { type: ComponentFactoryResolver },
        { type: ChangeDetectorRef },
        { type: NgModuleFactoryLoader },
        { type: String, decorators: [{ type: Inject, args: [LOCALE_ID,] }] },
        { type: ViewContainerRef, decorators: [{ type: Optional }] },
        { type: ElementRef, decorators: [{ type: Optional }] }
    ]; };
    BillTrackerDataComponent.propDecorators = {
        dataRegion: [{ type: ViewChild, args: ["dataRegion", { read: ViewContainerRef },] }]
    };
    return BillTrackerDataComponent;
}());
export { BillTrackerDataComponent };
if (false) {
    /** @type {?} */
    BillTrackerDataComponent.prototype.dataRegion;
    /** @type {?} */
    BillTrackerDataComponent.prototype.dataInfoService;
    /** @type {?} */
    BillTrackerDataComponent.prototype.localePipe;
    /** @type {?} */
    BillTrackerDataComponent.prototype.localeId;
    /** @type {?} */
    BillTrackerDataComponent.prototype.vcr;
    /** @type {?} */
    BillTrackerDataComponent.prototype.er;
    /** @type {?} */
    BillTrackerDataComponent.prototype.notify;
    /** @type {?} */
    BillTrackerDataComponent.prototype.messager;
    /** @type {?} */
    BillTrackerDataComponent.prototype.loading;
    /** @type {?} */
    BillTrackerDataComponent.prototype.modal;
    /** @type {?} */
    BillTrackerDataComponent.prototype.dataService;
    /** @type {?} */
    BillTrackerDataComponent.prototype.inj;
    /** @type {?} */
    BillTrackerDataComponent.prototype.cfr;
    /** @type {?} */
    BillTrackerDataComponent.prototype.cdf;
    /** @type {?} */
    BillTrackerDataComponent.prototype.loader;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmlsbC10cmFja2VyLWRhdGEuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGVkcC1iaWYvcnVudGltZS1hcGkvIiwic291cmNlcyI6WyJsaWIvYmlsbC10cmFja2VyL2NvbXBvbmVudHMvYmlsbC10cmFja2VyLWRhdGEvYmlsbC10cmFja2VyLWRhdGEuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsT0FBTyxFQUFFLFNBQVMsRUFBVSx3QkFBd0IsRUFBRSxRQUFRLEVBQWlCLGdCQUFnQixFQUFFLFNBQVMsRUFBRSxZQUFZLEVBQUUscUJBQXFCLEVBQW1CLGlCQUFpQixFQUFFLFFBQVEsRUFBRSxTQUFTLEVBQUUsTUFBTSxFQUFFLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUNwUCxPQUFPLEVBQUUsbUJBQW1CLEVBQUUsTUFBTSxzQ0FBc0MsQ0FBQztBQUMzRSxPQUFPLEVBQUUsc0JBQXNCLEVBQUUsTUFBTSwwQ0FBMEMsQ0FBQztBQUVsRixPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sb0JBQW9CLENBQUM7QUFDcEQsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBR3RELE9BQU8sRUFBRSxvQkFBb0IsRUFBRSx5QkFBeUIsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQ3RGLE9BQU8sRUFBRSxJQUFJLEVBQUUsRUFBRSxFQUFjLE1BQU0sTUFBTSxDQUFDO0FBQzVDLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUczQyxPQUFPLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSxvQ0FBb0MsQ0FBQztBQUN4RSxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFDbEQsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLGtCQUFrQixDQUFDO0FBQ2xELE9BQU8sRUFBRSwwQkFBMEIsRUFBRSxNQUFNLCtDQUErQyxDQUFDO0FBQzNGLE9BQU8sRUFBRSxxQkFBcUIs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OztJQW1MckQsK0JBQUM7Q0FBQSxBQTFMRCxJQTBMQztTQXJMWSx3QkFBd0I7OztJQUVuQyw4Q0FDNkI7O0lBQzdCLG1EQUE0Qzs7SUFDNUMsOENBQWtDOztJQUNsQyw0Q0FBaUI7O0lBQ2pCLHVDQUFzQjs7SUFDdEIsc0NBQStCOztJQUc3QiwwQ0FBNEI7O0lBQzVCLDRDQUFnQzs7SUFDaEMsMkNBQThCOztJQUM5Qix5Q0FBNEI7O0lBQzVCLCtDQUEwQzs7SUFDMUMsdUNBQW9COztJQUNwQix1Q0FBb0M7O0lBQ3BDLHVDQUE2Qjs7SUFDN0IsMENBQW9DIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBPbkluaXQsIENvbXBvbmVudEZhY3RvcnlSZXNvbHZlciwgSW5qZWN0b3IsIEFmdGVyVmlld0luaXQsIFZpZXdDb250YWluZXJSZWYsIFZpZXdDaGlsZCwgQ29tcG9uZW50UmVmLCBOZ01vZHVsZUZhY3RvcnlMb2FkZXIsIE5nTW9kdWxlRmFjdG9yeSwgQ2hhbmdlRGV0ZWN0b3JSZWYsIE9wdGlvbmFsLCBMT0NBTEVfSUQsIEluamVjdCwgRWxlbWVudFJlZiB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBCYXNpY1RhYmxlQ29tcG9uZW50IH0gZnJvbSAnLi4vYmFzaWMtdGFibGUvYmFzaWMtdGFibGUuY29tcG9uZW50JztcclxuaW1wb3J0IHsgQmlsbFRyYWNrZXJEYXRhU2VydmljZSB9IGZyb20gJy4uLy4uL3NlcnZpY2VzL2JpbGwtdHJhY2tlci1kYXRhLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBHZXRNYWluRW50aXR5RGF0YUFyZ3MgfSBmcm9tICcuLi8uLi9hcmdzL0dldE1haW5FbnRpdHlEYXRhQXJncyc7XHJcbmltcG9ydCB7IExvYWRpbmdTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy91aS1sb2FkaW5nJztcclxuaW1wb3J0IHsgTWVzc2FnZXJTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy91aS1tZXNzYWdlcic7XHJcbmltcG9ydCB7IEVudGl0eURhdGFSZXN1bHQgfSBmcm9tICcuLi8uLi9hcmdzL0VudGl0eURhdGFSZXN1bHQnO1xyXG5pbXBvcnQgeyBCaWxsSW5mbyB9IGZyb20gJy4uLy4uLy4uL2VudGl0eS90cmFja2luZy9CaWxsSW5mbyc7XHJcbmltcG9ydCB7IEJpbGxUcmFja2luZ1NldHRpbmdzLCBCaWxsVHJhY2tpbmdEYXRhU2hvd25Nb2RlIH0gZnJvbSAnQGVkcC1iaWYvY29tbW9uLWFwaSc7XHJcbmltcG9ydCB7IGZyb20sIG9mLCBPYnNlcnZhYmxlIH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7IHN3aXRjaE1hcCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcclxuaW1wb3J0IHsgSUJpbGxUcmFja2VyRGF0YVNob3duTW9kdWxlIH0gZnJvbSAnLi4vLi4vYmFzZS9JQmlsbFRyYWNrZXJEYXRhU2hvd25Nb2R1bGUnO1xyXG5pbXBvcnQgeyBJQmlsbFRyYWNrZXJEYXRhU2hvd25Db21wb25lbnQgfSBmcm9tICcuLi8uLi9iYXNlL0lCaWxsVHJhY2tlckRhdGFTaG93bkNvbXBvbmVudCc7XHJcbmltcG9ydCB7IEJhc2ljSW5mb0NvbXBvbmVudCB9IGZyb20gJy4uL2Jhc2ljLWluZm8vYmFzaWMtaW5mby5jb21wb25lbnQnO1xyXG5pbXBvcnQgeyBOb3RpZnlTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy91aS1ub3RpZnknO1xyXG5pbXBvcnQgeyBCc01vZGFsU2VydmljZSB9IGZyb20gJ0BmYXJyaXMvdWktbW9kYWwnO1xyXG5pbXBvcnQgeyBCaWxsVHJhY2tlckRhdGFJbmZvU2VydmljZSB9IGZyb20gJy4uLy4uL3NlcnZpY2VzL2JpbGwtdHJhY2tlci1kYXRhLWluZm8uc2VydmljZSc7XHJcbmltcG9ydCB7IEJpbGxUcmFja2VyTG9jYWxlUGlwZSB9IGZyb20gJy4uLy4uL3BpcGUvYmlsbC10cmFja2VyLWxvY2FsZS5waXBlJztcclxuaW1wb3J0IHsgQmlsbERhdGFJbmZvIH0gZnJvbSAnLi4vLi4vLi4vZW50aXR5L3RyYWNraW5nL0JpbGxEYXRhSW5mbyc7XHJcblxyXG5kZWNsYXJlIHZhciBTeXN0ZW06IGFueTtcclxuXHJcbkBDb21wb25lbnQoe1xyXG4gIHNlbGVjdG9yOiAnbGliLWJpbGwtdHJhY2tlci1kYXRhJyxcclxuICB0ZW1wbGF0ZVVybDogJy4vYmlsbC10cmFja2VyLWRhdGEuY29tcG9uZW50Lmh0bWwnLFxyXG4gIHN0eWxlVXJsczogWycuL2JpbGwtdHJhY2tlci1kYXRhLmNvbXBvbmVudC5jc3MnXVxyXG59KVxyXG5leHBvcnQgY2xhc3MgQmlsbFRyYWNrZXJEYXRhQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBBZnRlclZpZXdJbml0IHtcclxuXHJcbiAgQFZpZXdDaGlsZChcImRhdGFSZWdpb25cIiwgeyByZWFkOiBWaWV3Q29udGFpbmVyUmVmIH0pXHJcbiAgZGF0YVJlZ2lvbjogVmlld0NvbnRhaW5lclJlZjtcclxuICBkYXRhSW5mb1NlcnZpY2U6IEJpbGxUcmFja2VyRGF0YUluZm9TZXJ2aWNlO1xyXG4gIGxvY2FsZVBpcGU6IEJpbGxUcmFja2VyTG9jYWxlUGlwZTtcclxuICBsb2NhbGVJZDogc3RyaW5nO1xyXG4gIHZjcjogVmlld0NvbnRhaW5lclJlZjtcclxuICBlcjogRWxlbWVudFJlZjxIVE1MRGl2RWxlbWVudD47XHJcblxyXG4gIGNvbnN0cnVjdG9yKFxyXG4gICAgcHVibGljIG5vdGlmeTogTm90aWZ5U2VydmljZSxcclxuICAgIHB1YmxpYyBtZXNzYWdlcjogTWVzc2FnZXJTZXJ2aWNlLFxyXG4gICAgcHVibGljIGxvYWRpbmc6IExvYWRpbmdTZXJ2aWNlLFxyXG4gICAgcHVibGljIG1vZGFsOiBCc01vZGFsU2VydmljZSxcclxuICAgIHB1YmxpYyBkYXRhU2VydmljZTogQmlsbFRyYWNrZXJEYXRhU2VydmljZSxcclxuICAgIHB1YmxpYyBpbmo6IEluamVjdG9yLFxyXG4gICAgcHVibGljIGNmcjogQ29tcG9uZW50RmFjdG9yeVJlc29sdmVyLFxyXG4gICAgcHVibGljIGNkZjogQ2hhbmdlRGV0ZWN0b3JSZWYsXHJcbiAgICBwdWJsaWMgbG9hZGVyOiBOZ01vZHVsZUZhY3RvcnlMb2FkZXIsXHJcbiAgICBASW5qZWN0KExPQ0FMRV9JRCkgbG9jYWxlSWQ6IHN0cmluZyxcclxuICAgIEBPcHRpb25hbCgpIHZjcjogVmlld0NvbnRhaW5lclJlZixcclxuICAgIEBPcHRpb25hbCgpIGVyOiBFbGVtZW50UmVmLFxyXG4gICkge1xyXG4gICAgdGhpcy5kYXRhSW5mb1NlcnZpY2UgPSBuZXcgQmlsbFRyYWNrZXJEYXRhSW5mb1NlcnZpY2UoKTtcclxuICAgIHRoaXMubG9jYWxlSWQgPSBsb2NhbGVJZCB8fCB0aGlzLmluai5nZXQoTE9DQUxFX0lELCBudWxsKSB8fCAnemgtQ0hTJztcclxuICAgIHRoaXMubG9jYWxlUGlwZSA9IG5ldyBCaWxsVHJhY2tlckxvY2FsZVBpcGUobG9jYWxlSWQpO1xyXG4gICAgdGhpcy52Y3IgPSB2Y3IgfHwgdGhpcy5pbmouZ2V0KFZpZXdDb250YWluZXJSZWYsIG51bGwpO1xyXG4gICAgdGhpcy5lciA9IGVyIHx8IHRoaXMuaW5qLmdldChFbGVtZW50UmVmLCBudWxsKTtcclxuICB9XHJcblxyXG4gIG5nT25Jbml0KCkge1xyXG5cclxuICB9XHJcblxyXG4gIG5nQWZ0ZXJWaWV3SW5pdCgpOiB2b2lkIHtcclxuXHJcbiAgfVxyXG5cclxuICBwdWJsaWMgY2xlYXJEYXRhUmVnaW9uKCk6IHZvaWQge1xyXG4gICAgdGhpcy5kYXRhUmVnaW9uLmNsZWFyKCk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgc2hvd0RhdGFHcmlkKGFyZ3M6IEdldE1haW5FbnRpdHlEYXRhQXJncywgYmlsbEluZm8/OiBCaWxsSW5mbywgYmlsbERhdGFJbmZvPzogQmlsbERhdGFJbmZvLCByZXM/OiBFbnRpdHlEYXRhUmVzdWx0KTogdm9pZCB7XHJcbiAgICAvLyDljZXmja7ov73ouKrphY3nva5cclxuICAgIGxldCBidHM6IEJpbGxUcmFja2luZ1NldHRpbmdzID0gbmV3IEJpbGxUcmFja2luZ1NldHRpbmdzKCk7XHJcbiAgICBpZiAoYmlsbEluZm8gJiYgYmlsbEluZm8uYmlsbFRyYWNraW5nU2V0dGluZ3MpIHtcclxuICAgICAgYnRzLkxvYWRGcm9tSnNvbihiaWxsSW5mby5iaWxsVHJhY2tpbmdTZXR0aW5ncyk7XHJcbiAgICB9XHJcbiAgICBpZiAoYnRzLmJpbGxUcmFja2luZ0RhdGFTaG93bk1vZGUgPT0gQmlsbFRyYWNraW5nRGF0YVNob3duTW9kZS5DVVNUT01GT1JNKSB7XHJcbiAgICAgIHRoaXMuc2hvd0N1c3RvbUZvcm0oYXJncywgYmlsbEluZm8sIGJpbGxEYXRhSW5mbyk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLnNob3dHZW5lcmFsRm9ybShhcmdzLCBiaWxsSW5mbywgYmlsbERhdGFJbmZvLCByZXMpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5omT5byA6YCa55So6KGo5Y2VXHJcbiAgICogQHBhcmFtIGFyZ3NcclxuICAgKiBAcGFyYW0gYmlsbEluZm9cclxuICAgKiBAcGFyYW0gcmVzXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBzaG93R2VuZXJhbEZvcm0oYXJnczogR2V0TWFpbkVudGl0eURhdGFBcmdzLCBiaWxsSW5mbz86IEJpbGxJbmZvLCBiaWxsRGF0YUluZm8/OiBCaWxsRGF0YUluZm8sIHJlcz86IEVudGl0eURhdGFSZXN1bHQsIG5ld0JUUz86IGJvb2xlYW4pIHtcclxuICAgIGlmIChyZXMgIT0gbnVsbCkge1xyXG4gICAgICB0aGlzLmNyZWF0ZURhdGFDb21wKHJlcywgYmlsbEluZm8sIGJpbGxEYXRhSW5mbyk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBjb25zdCBsID0gdGhpcy5sb2FkaW5nLnNob3coeyBtZXNzYWdlOiB0aGlzLmxvY2FsZVBpcGUudHJhbnNmb3JtKFwibG9hZGluZ1wiKSB9KTtcclxuICAgICAgdGhpcy5kYXRhU2VydmljZS5nZXRFbnRpdHlEYXRhKGFyZ3MpLnN1YnNjcmliZShcclxuICAgICAgICAocmVzOiBFbnRpdHlEYXRhUmVzdWx0KSA9PiB7XHJcbiAgICAgICAgICB0aGlzLmNyZWF0ZURhdGFDb21wKHJlcywgYmlsbEluZm8sIGJpbGxEYXRhSW5mbyk7XHJcbiAgICAgICAgICBsLmNsb3NlKCk7XHJcbiAgICAgICAgfSxcclxuICAgICAgICAoZXJyKSA9PiB7XHJcbiAgICAgICAgICBsLmNsb3NlKCk7XHJcbiAgICAgICAgICB0aGlzLm1lc3NhZ2VyLmVycm9yKGVyci5lcnJvciA9PSBudWxsID8gZXJyLm1lc3NhZ2UgOiAoZXJyLmVycm9yLk1lc3NhZ2UgfHwgZXJyLmVycm9yLm1lc3NhZ2UgfHwgZXJyLm1lc3NhZ2UpKTtcclxuICAgICAgICAgIHRocm93IGVycjtcclxuICAgICAgICB9XHJcbiAgICAgICk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDmiZPlvIDoh6rlrprkuYnooajljZVcclxuICAgKiBAcGFyYW0gYXJnc1xyXG4gICAqIEBwYXJhbSBiaWxsSW5mb1xyXG4gICAqL1xyXG4gIHByaXZhdGUgc2hvd0N1c3RvbUZvcm0oYXJnczogR2V0TWFpbkVudGl0eURhdGFBcmdzLCBiaWxsSW5mbz86IEJpbGxJbmZvLCBiaWxsRGF0YUluZm8/OiBCaWxsRGF0YUluZm8pIHtcclxuICAgIGxldCBidHM6IEJpbGxUcmFja2luZ1NldHRpbmdzID0gbmV3IEJpbGxUcmFja2luZ1NldHRpbmdzKCk7XHJcbiAgICBpZiAoYmlsbEluZm8gJiYgYmlsbEluZm8uYmlsbFRyYWNraW5nU2V0dGluZ3MpIHtcclxuICAgICAgYnRzLkxvYWRGcm9tSnNvbihiaWxsSW5mby5iaWxsVHJhY2tpbmdTZXR0aW5ncyk7XHJcbiAgICB9XHJcbiAgICBsZXQgZm9ybUNvbnRlbnQgPSBKU09OLnBhcnNlKGJ0cy5jdXN0b21Gb3JtQ29udGVudCk7XHJcblxyXG4gICAgbGV0IG1vZHVsZUYkID0gbnVsbDtcclxuICAgIGlmIChmb3JtQ29udGVudC5mb3JtLmVuZHNXaXRoKFwiLmpzXCIpKSB7XHJcbiAgICAgIC8vIHVybOagvOW8j+S4ultqc+i3r+W+hF3ml7ZcclxuICAgICAgbW9kdWxlRiQgPSBmcm9tKFN5c3RlbS5pbXBvcnQoZm9ybUNvbnRlbnQuZm9ybS50b0xvd2VyQ2FzZSgpKS50aGVuKG0gPT4gbSkpLnBpcGUoXHJcbiAgICAgICAgc3dpdGNoTWFwKFxyXG4gICAgICAgICAgKG06IHsgW2tleTogc3RyaW5nXTogTmdNb2R1bGVGYWN0b3J5PElCaWxsVHJhY2tlckRhdGFTaG93bk1vZHVsZT4gfSkgPT4ge1xyXG4gICAgICAgICAgICBmb3IgKGxldCBrZXkgaW4gbSkge1xyXG4gICAgICAgICAgICAgIHJldHVybiBvZihtW2tleV0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBvZihudWxsKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICApXHJcbiAgICAgICk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAvLyB1cmzmoLzlvI/kuLpbanPot6/lvoQj5qih5Z2X5ZCNXeaXtlxyXG4gICAgICBtb2R1bGVGJCA9IGZyb20odGhpcy5sb2FkZXIubG9hZChmb3JtQ29udGVudC5mb3JtKSk7XHJcbiAgICB9XHJcblxyXG4gICAgbW9kdWxlRiQuc3Vic2NyaWJlKFxyXG4gICAgICAobW9kdWxlRmFjdG9yeTogTmdNb2R1bGVGYWN0b3J5PElCaWxsVHJhY2tlckRhdGFTaG93bk1vZHVsZT4pID0+IHtcclxuICAgICAgICBjb25zdCBtb2R1bGVSZWYgPSBtb2R1bGVGYWN0b3J5LmNyZWF0ZSh0aGlzLmluaik7XHJcblxyXG4gICAgICAgIGxldCBjbXBSJCA9IG1vZHVsZVJlZi5pbnN0YW5jZS5jcmVhdGVEYXRhU2hvd25Db21wb25lbnQodGhpcy5pbmosIGFyZ3MpO1xyXG4gICAgICAgIGlmIChjbXBSJCBpbnN0YW5jZW9mIENvbXBvbmVudFJlZikge1xyXG4gICAgICAgICAgY21wUiQgPSBvZihjbXBSJCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNtcFIkLnN1YnNjcmliZShcclxuICAgICAgICAgIChjbXBSOiBDb21wb25lbnRSZWY8SUJpbGxUcmFja2VyRGF0YVNob3duQ29tcG9uZW50PikgPT4ge1xyXG4gICAgICAgICAgICAvLyDph43nva7mu5rliqjmnaFcclxuICAgICAgICAgICAgY29uc3QgZWx0ID0gdGhpcy5kYXRhUmVnaW9uLmVsZW1lbnQubmF0aXZlRWxlbWVudC5wYXJlbnRFbGVtZW50IGFzIEhUTUxFbGVtZW50O1xyXG4gICAgICAgICAgICBlbHQuc2Nyb2xsVG8oeyBsZWZ0OiAwIH0pO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5kYXRhUmVnaW9uLmNsZWFyKCk7XHJcbiAgICAgICAgICAgIHRoaXMuZGF0YVJlZ2lvbi5pbnNlcnQoY21wUi5ob3N0Vmlldyk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgKTtcclxuICAgICAgfVxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gKiDliJvlu7rpgJrnlKjooajnu4Tku7ZcclxuICogQHBhcmFtIHJlc1xyXG4gKiBAcGFyYW0gYmlsbEluZm9cclxuICovXHJcbiAgY3JlYXRlRGF0YUNvbXAocmVzOiBFbnRpdHlEYXRhUmVzdWx0LCBiaWxsSW5mbzogQmlsbEluZm8sIGJpbGxEYXRhSW5mbzogQmlsbERhdGFJbmZvKSB7XHJcbiAgICBjb25zdCBuZXdCVFMgPSB0aGlzLmRhdGFJbmZvU2VydmljZS5pc05ld0JUUyhiaWxsSW5mby5iaWxsVHJhY2tpbmdTZXR0aW5ncyk7XHJcbiAgICAvLyBpZiAobmV3QlRTKSB7XHJcbiAgICB0cnkge1xyXG4gICAgICB0aGlzLmNyZWF0ZU5ld0RhdGFDb21wKHJlcywgYmlsbEluZm8sIGJpbGxEYXRhSW5mbyk7XHJcbiAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgIC8vIOmHjee9rua7muWKqOadoVxyXG4gICAgICBjb25zdCBlbHQgPSB0aGlzLmRhdGFSZWdpb24uZWxlbWVudC5uYXRpdmVFbGVtZW50LnBhcmVudEVsZW1lbnQgYXMgSFRNTEVsZW1lbnQ7XHJcbiAgICAgIGVsdCAmJiBlbHQuc2Nyb2xsVG8oeyBsZWZ0OiAwIH0pO1xyXG5cclxuICAgICAgdGhpcy5kYXRhUmVnaW9uLmNsZWFyKCk7XHJcbiAgICAgIGNvbnN0IGNtZiA9IHRoaXMuY2ZyLnJlc29sdmVDb21wb25lbnRGYWN0b3J5KEJhc2ljVGFibGVDb21wb25lbnQpO1xyXG4gICAgICBjb25zdCBjbXBSOiBDb21wb25lbnRSZWY8QmFzaWNUYWJsZUNvbXBvbmVudD4gPSB0aGlzLmRhdGFSZWdpb24uY3JlYXRlQ29tcG9uZW50KGNtZik7XHJcbiAgICAgIGNtcFIuaW5zdGFuY2UuYmlsbEluZm8gPSBiaWxsSW5mbztcclxuICAgICAgY21wUi5pbnN0YW5jZS5pc01haW4gPSB0cnVlO1xyXG4gICAgICBjbXBSLmluc3RhbmNlLnNob3dNYWluVGFibGUocmVzKTtcclxuXHJcbiAgICAgIHRoaXMuZGF0YVJlZ2lvbi5pbnNlcnQoY21wUi5ob3N0Vmlldyk7XHJcbiAgICB9XHJcbiAgICAvLyB9XHJcblxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAqIOWIm+W7uumAmueUqOihqOe7hOS7tlxyXG4gKiBAcGFyYW0gcmVzXHJcbiAqIEBwYXJhbSBiaWxsSW5mb1xyXG4gKi9cclxuICBjcmVhdGVOZXdEYXRhQ29tcChyZXM6IEVudGl0eURhdGFSZXN1bHQsIGJpbGxJbmZvPzogQmlsbEluZm8sIGJpbGxEYXRhSW5mbz86IEJpbGxEYXRhSW5mbykge1xyXG4gICAgLy8g6YeN572u5rua5Yqo5p2hXHJcbiAgICBjb25zdCBlbHQgPSB0aGlzLmRhdGFSZWdpb24uZWxlbWVudC5uYXRpdmVFbGVtZW50LnBhcmVudEVsZW1lbnQgYXMgSFRNTEVsZW1lbnQ7XHJcbiAgICBlbHQgJiYgZWx0LnNjcm9sbFRvKHsgbGVmdDogMCB9KTtcclxuXHJcbiAgICB0aGlzLmRhdGFSZWdpb24uY2xlYXIoKTtcclxuICAgIGNvbnN0IGNtZiA9IHRoaXMuY2ZyLnJlc29sdmVDb21wb25lbnRGYWN0b3J5KEJhc2ljSW5mb0NvbXBvbmVudCk7XHJcbiAgICBjb25zdCBjbXBSOiBDb21wb25lbnRSZWY8QmFzaWNJbmZvQ29tcG9uZW50PiA9IHRoaXMuZGF0YVJlZ2lvbi5jcmVhdGVDb21wb25lbnQoY21mKTtcclxuICAgIGNtcFIuaW5zdGFuY2Uuc2NoZW1hVGFibGUgPSByZXMuYmlsbFNjaGVtYS5tYWluVGFibGU7XHJcbiAgICBjbXBSLmluc3RhbmNlLmRhdGFUYWJsZSA9IHJlcy5iaWxsRGF0YS5tYWluVGFibGU7XHJcbiAgICBjbXBSLmluc3RhbmNlLmJpbGxJbmZvID0gYmlsbEluZm87XHJcbiAgICBjbXBSLmluc3RhbmNlLmJpbGxEYXRhSW5mbyA9IGJpbGxEYXRhSW5mbztcclxuXHJcbiAgICB0aGlzLmRhdGFSZWdpb24uaW5zZXJ0KGNtcFIuaG9zdFZpZXcpO1xyXG4gIH1cclxufVxyXG4iXX0=
/**
 * @fileoverview added by tsickle
 * Generated from: lib/bill-tracker/components/child-info/child-info.component.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { ChangeDetectorRef, Component, ComponentFactoryResolver, Inject, Injector, Input, LOCALE_ID, Optional, ViewChild, ViewContainerRef } from "@angular/core";
import { BillDataTable, BillSchemaTable, DataType } from "@edp-aif/common-api";
import { BillTrackingDataShownMode, BillTrackingSettings } from "@edp-bif/common-api";
import { DatagridComponent } from "@farris/ui-datagrid";
import { LoadingService } from "@farris/ui-loading";
import { MessagerService } from "@farris/ui-messager";
import { BsModalService } from "@farris/ui-modal";
import { NotifyService } from "@farris/ui-notify";
import { BillInfo } from "../../../entity/tracking/BillInfo";
import { BillTrackerLocalePipe } from "../../pipe/bill-tracker-locale.pipe";
import { BillTrackerDataInfoService } from "../../services/bill-tracker-data-info.service";
import { ChildInfoListComponent } from "../child-info-list/child-info-list.component";
import { Exceptions } from "../../../entity/tracking/Exceptions";
var ChildInfoComponent = /** @class */ (function () {
    function ChildInfoComponent(notify, messager, loading, modal, dataInfoService, localePipe, vcr, inj, cfr, cdr, localeId) {
        this.notify = notify;
        this.messager = messager;
        this.loading = loading;
        this.modal = modal;
        this.dataInfoService = dataInfoService;
        this.localePipe = localePipe;
        this.vcr = vcr;
        this.inj = inj;
        this.cfr = cfr;
        this.cdr = cdr;
        this.localeId = localeId;
        this.secTitle = null;
        this.showDetail = false;
        this.dgCols = [];
        this.dgData = [];
        this.dgLineNumberTitle = this.localePipe.transform("lineNumber");
        this.dgIdField = "bifDgId0d63";
        this.localeId = localeId || this.inj.get(LOCALE_ID);
    }
    /**
     * @return {?}
     */
    ChildInfoComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        // 设置section标题
        this.secTitle = this.localePipe.transform("basicInfo");
        // 表名解析
        this.secTitle = this.dataInfoService.getTableLabel(this.billInfo, this.schemaTable, this.localeId);
        // 单据追踪配置
        /** @type {?} */
        var bts = new BillTrackingSettings();
        if (this.billInfo && this.billInfo.billTrackingSettings) {
            bts.LoadFromJson(this.billInfo.billTrackingSettings);
        }
        // 字段解析
        /** @type {?} */
        var fieldContent = bts.customFieldContent;
        /** @type {?} */
        var fieldConfig = fieldContent && (typeof fieldContent == "object" ? fieldContent : JSON.parse(fieldContent));
        /** @type {?} */
        var selectedFields = fieldConfig && fieldConfig.schema && fieldConfig.schema[this.schemaTable.tableName] && fieldConfig.schema[this.schemaTable.tableName].fields;
        selectedFields = selectedFields ? selectedFields : [];
        /** @type {?} */
        var showCustomFields = bts.billTrackingDataShownMode === BillTrackingDataShownMode.CUSTOMFIELD;
        /** @type {?} */
        var fs = this.schemaTable.getFieldList();
        // 提取字段
        /** @type {?} */
        var ffs = this.dataInfoService.extractFFields(fs, selectedFields, showCustomFields);
        // 筛选显示列
        ffs = ffs.filter((/**
         * @param {?} f
         * @return {?}
         */
        function (f) { return f.show; }));
        // 按order排序
        ffs = this.dataInfoService.sortFieldsByOrder(ffs);
        // 创建显示列
        this.dgCols = [];
        ffs.forEach((/**
         * @param {?} f
         * @return {?}
         */
        function (f) {
            /** @type {?} */
            var c = {
                field: f.fieldPath || f.fieldName,
                title: _this.dataInfoService.getFieldLabel(f, _this.localeId),
                width: 120
            };
            if (f.dataType == DataType.Boolean) {
                c.formatter = (/**
                 * @param {?} value
                 * @param {?} rowData
                 * @param {?} rowIndex
                 * @return {?}
                 */
                function (value, rowData, rowIndex) {
                    if (value == true) {
                        return _this.localePipe.transform("yes");
                    }
                    else if (value == false) {
                        return _this.localePipe.transform("no");
                    }
                    else {
                        return "-";
                    }
                });
            }
            if (f.dataType == DataType.Integer || f.dataType == DataType.Decimal) {
                c.halign = "right";
                c.align = "right";
            }
            _this.dgCols.push(c);
        }));
        // 构建行数据
        /** @type {?} */
        var rows = this.dataTable ? this.dataTable.GetRowList() : [];
        try {
            this.dgData = tslib_1.__spread(this.dataInfoService.extractDataRows(rows, ffs, fs, this.dgIdField));
        }
        catch (error) {
            this.dgData = [];
            if (error == Exceptions.SCALE_FIELD_VALUE_IS_NAN) {
                this.messager.error(this.localePipe.transform("scaleFieldCantBeCastToInteger"));
            }
            throw error;
        }
        if (this.dgData.length > 0) {
            setTimeout((/**
             * @return {?}
             */
            function () {
                _this.dg && _this.dg.selectRow(_this.dgData[0][_this.dgIdField]);
            }), 500);
        }
    };
    /**
     * @param {?} row
     * @return {?}
     */
    ChildInfoComponent.prototype.selectChanged = /**
     * @param {?} row
     * @return {?}
     */
    function (row) {
        /** @type {?} */
        var r = this.dataTable ? this.dataTable.GetRowMap()[row.id] : null;
        this.showDetail = r != null && this.dataInfoService.hasChildData(r, this.billInfo);
        this.cdr.detectChanges();
    };
    /**
     * @return {?}
     */
    ChildInfoComponent.prototype.viewChildData = /**
     * @return {?}
     */
    function () {
        if (this.dg.selectedRow == null) {
            this.notify.warning(this.localePipe.transform("selectOneFirst"));
            return;
        }
        /** @type {?} */
        var row = this.dataTable ? this.dataTable.GetRowMap()[this.dg.selectedRow.id] : null;
        if (row == null || !this.dataInfoService.hasChildData(row, this.billInfo)) {
            this.notify.info(this.localePipe.transform("noChildData"));
            return;
        }
        /** @type {?} */
        var cmpF = this.cfr.resolveComponentFactory(ChildInfoListComponent);
        /** @type {?} */
        var cmpR = cmpF.create(this.inj, []);
        // 获取子表列表
        /** @type {?} */
        var childSchemaTables = this.dataInfoService.getChildTables(this.billInfo, this.schemaTable);
        cmpR.instance.childSchemaTables = childSchemaTables;
        cmpR.instance.childDataTableMap = row.GetChildTableMap();
        cmpR.instance.billInfo = this.billInfo;
        /** @type {?} */
        var bsModalRef = this.modal.show(cmpR, {
            title: this.localePipe.transform("childData"),
            width: 900,
            height: 600,
            showButtons: false,
        });
        cmpR.instance.bsModalRef = bsModalRef;
    };
    ChildInfoComponent.decorators = [
        { type: Component, args: [{
                    selector: "lib-bill-tracker-child-info",
                    template: "<div class=\"f-struct-wrapper\" *ngIf=\"dgCols&&dgCols.length>0&&dgData&&dgData.length>0\">\r\n    <farris-section class=\"f-section-tabs f-section-in-mainsubcard\" [mainTitle]=\"secTitle\">\r\n        <ng-template farrisSectionToolbar [toolbarCls]=\"'section-test-toolbar'\">\r\n            <button class=\"btn btn-secondary f-btn-ml\" *ngIf=\"showDetail\" (click)=\"viewChildData()\">\r\n                {{ \"childData\" | billTrackerLocale}}\r\n            </button>\r\n        </ng-template>\r\n        <div class=\"\">\r\n            <div class=\"f-utils-fill\">\r\n                <farris-datagrid #dg [data]=\"dgData\" [idField]=\"dgIdField\" [fields]=\"dgCols\" [showLineNumber]=\"true\"\r\n                    [striped]=\"true\" [virtualized]=\"false\" [pagination]=\"false\" [virtualizedAsyncLoad]=\"false\"\r\n                    [multiSelect]=\"false\" [fit]=\"true\" [showCheckbox]=\"false\" [showAllCheckbox]=\"false\"\r\n                    [lineNumberTitle]=\"dgLineNumberTitle\" [mergeCell]=\"false\" [showBorder]=\"true\"\r\n                    [checkOnSelect]=\"false\" [selectOnCheck]=\"false\" [nowrap]=\"true\" [autoFitColumns]=\"true\"\r\n                    [fitColumns]=\"true\" [autoHeight]=\"false\" (selectChanged)=\"selectChanged($event)\">\r\n                </farris-datagrid>\r\n            </div>\r\n        </div>\r\n    </farris-section>\r\n</div>"
                }] }
    ];
    /** @nocollapse */
    ChildInfoComponent.ctorParameters = function () { return [
        { type: NotifyService },
        { type: MessagerService },
        { type: LoadingService },
        { type: BsModalService },
        { type: BillTrackerDataInfoService },
        { type: BillTrackerLocalePipe },
        { type: ViewContainerRef },
        { type: Injector },
        { type: ComponentFactoryResolver },
        { type: ChangeDetectorRef },
        { type: String, decorators: [{ type: Optional }, { type: Inject, args: [LOCALE_ID,] }] }
    ]; };
    ChildInfoComponent.propDecorators = {
        schemaTable: [{ type: Input, args: ["schemaTable",] }],
        dataTable: [{ type: Input, args: ["dataTable",] }],
        billInfo: [{ type: Input, args: ["billInfo",] }],
        dg: [{ type: ViewChild, args: ["dg",] }]
    };
    return ChildInfoComponent;
}());
export { ChildInfoComponent };
if (false) {
    /** @type {?} */
    ChildInfoComponent.prototype.schemaTable;
    /** @type {?} */
    ChildInfoComponent.prototype.dataTable;
    /** @type {?} */
    ChildInfoComponent.prototype.billInfo;
    /** @type {?} */
    ChildInfoComponent.prototype.secTitle;
    /** @type {?} */
    ChildInfoComponent.prototype.showDetail;
    /** @type {?} */
    ChildInfoComponent.prototype.dg;
    /** @type {?} */
    ChildInfoComponent.prototype.dgCols;
    /** @type {?} */
    ChildInfoComponent.prototype.dgData;
    /** @type {?} */
    ChildInfoComponent.prototype.dgLineNumberTitle;
    /** @type {?} */
    ChildInfoComponent.prototype.dgIdField;
    /** @type {?} */
    ChildInfoComponent.prototype.notify;
    /** @type {?} */
    ChildInfoComponent.prototype.messager;
    /** @type {?} */
    ChildInfoComponent.prototype.loading;
    /** @type {?} */
    ChildInfoComponent.prototype.modal;
    /** @type {?} */
    ChildInfoComponent.prototype.dataInfoService;
    /** @type {?} */
    ChildInfoComponent.prototype.localePipe;
    /** @type {?} */
    ChildInfoComponent.prototype.vcr;
    /** @type {?} */
    ChildInfoComponent.prototype.inj;
    /** @type {?} */
    ChildInfoComponent.prototype.cfr;
    /** @type {?} */
    ChildInfoComponent.prototype.cdr;
    /** @type {?} */
    ChildInfoComponent.prototype.localeId;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2hpbGQtaW5mby5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZWRwLWJpZi9ydW50aW1lLWFwaS8iLCJzb3VyY2VzIjpbImxpYi9iaWxsLXRyYWNrZXIvY29tcG9uZW50cy9jaGlsZC1pbmZvL2NoaWxkLWluZm8uY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxTQUFTLEVBQUUsd0JBQXdCLEVBQUUsTUFBTSxFQUFFLFFBQVEsRUFBRSxLQUFLLEVBQUUsU0FBUyxFQUFVLFFBQVEsRUFBRSxTQUFTLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDMUssT0FBTyxFQUFFLGFBQWEsRUFBNEQsZUFBZSxFQUFFLFFBQVEsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQ3pJLE9BQU8sRUFBaUMseUJBQXlCLEVBQUUsb0JBQW9CLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUNySCxPQUFPLEVBQWMsaUJBQWlCLEVBQWUsTUFBTSxxQkFBcUIsQ0FBQztBQUNqRixPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sb0JBQW9CLENBQUM7QUFDcEQsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQ3RELE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQztBQUNsRCxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFDbEQsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLG1DQUFtQyxDQUFDO0FBQzdELE9BQU8sRUFBRSxxQkFBcUIsRUFBRSxNQUFNLHFDQUFxQyxDQUFDO0FBQzVFLE9BQU8sRUFBRSwwQkFBMEIsRUFBRSxNQUFNLCtDQUErQyxDQUFDO0FBQzNGLE9BQU8sRUFBRSxzQkFBc0IsRUFBRSxNQUFNLDhDQUE4QyxDQUFDO0FBQ3RGLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxxQ0FBcUMsQ0FBQztBQUVqRTtJQTBC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Q0FBZ0M7O0lBQ2hDLHFDQUE4Qjs7SUFDOUIsbUNBQTRCOztJQUM1Qiw2Q0FBa0Q7O0lBQ2xELHdDQUF3Qzs7SUFDeEMsaUNBQTRCOztJQUM1QixpQ0FBb0I7O0lBQ3BCLGlDQUFvQzs7SUFDcEMsaUNBQTZCOztJQUM3QixzQ0FBc0QiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDaGFuZ2VEZXRlY3RvclJlZiwgQ29tcG9uZW50LCBDb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIsIEluamVjdCwgSW5qZWN0b3IsIElucHV0LCBMT0NBTEVfSUQsIE9uSW5pdCwgT3B0aW9uYWwsIFZpZXdDaGlsZCwgVmlld0NvbnRhaW5lclJlZiB9IGZyb20gXCJAYW5ndWxhci9jb3JlXCI7XHJcbmltcG9ydCB7IEJpbGxEYXRhVGFibGUsIEJpbGxTY2hlbWFGaWVsZCwgQmlsbFNjaGVtYUZpZWxkQmFzZSwgQmlsbFNjaGVtYVN1YkZpZWxkLCBCaWxsU2NoZW1hVGFibGUsIERhdGFUeXBlIH0gZnJvbSBcIkBlZHAtYWlmL2NvbW1vbi1hcGlcIjtcclxuaW1wb3J0IHsgQmlsbFRyYWNrZXJTY2hlbWFGaWVsZENvbnRlbnQsIEJpbGxUcmFja2luZ0RhdGFTaG93bk1vZGUsIEJpbGxUcmFja2luZ1NldHRpbmdzIH0gZnJvbSBcIkBlZHAtYmlmL2NvbW1vbi1hcGlcIjtcclxuaW1wb3J0IHsgRGF0YUNvbHVtbiwgRGF0YWdyaWRDb21wb25lbnQsIFNlbGVjdGVkUm93IH0gZnJvbSBcIkBmYXJyaXMvdWktZGF0YWdyaWRcIjtcclxuaW1wb3J0IHsgTG9hZGluZ1NlcnZpY2UgfSBmcm9tIFwiQGZhcnJpcy91aS1sb2FkaW5nXCI7XHJcbmltcG9ydCB7IE1lc3NhZ2VyU2VydmljZSB9IGZyb20gXCJAZmFycmlzL3VpLW1lc3NhZ2VyXCI7XHJcbmltcG9ydCB7IEJzTW9kYWxTZXJ2aWNlIH0gZnJvbSBcIkBmYXJyaXMvdWktbW9kYWxcIjtcclxuaW1wb3J0IHsgTm90aWZ5U2VydmljZSB9IGZyb20gXCJAZmFycmlzL3VpLW5vdGlmeVwiO1xyXG5pbXBvcnQgeyBCaWxsSW5mbyB9IGZyb20gXCIuLi8uLi8uLi9lbnRpdHkvdHJhY2tpbmcvQmlsbEluZm9cIjtcclxuaW1wb3J0IHsgQmlsbFRyYWNrZXJMb2NhbGVQaXBlIH0gZnJvbSBcIi4uLy4uL3BpcGUvYmlsbC10cmFja2VyLWxvY2FsZS5waXBlXCI7XHJcbmltcG9ydCB7IEJpbGxUcmFja2VyRGF0YUluZm9TZXJ2aWNlIH0gZnJvbSBcIi4uLy4uL3NlcnZpY2VzL2JpbGwtdHJhY2tlci1kYXRhLWluZm8uc2VydmljZVwiO1xyXG5pbXBvcnQgeyBDaGlsZEluZm9MaXN0Q29tcG9uZW50IH0gZnJvbSBcIi4uL2NoaWxkLWluZm8tbGlzdC9jaGlsZC1pbmZvLWxpc3QuY29tcG9uZW50XCI7XHJcbmltcG9ydCB7IEV4Y2VwdGlvbnMgfSBmcm9tIFwiLi4vLi4vLi4vZW50aXR5L3RyYWNraW5nL0V4Y2VwdGlvbnNcIjtcclxuXHJcbkBDb21wb25lbnQoe1xyXG4gIHNlbGVjdG9yOiBcImxpYi1iaWxsLXRyYWNrZXItY2hpbGQtaW5mb1wiLFxyXG4gIHRlbXBsYXRlVXJsOiBcIi4vY2hpbGQtaW5mby5jb21wb25lbnQuaHRtbFwiLFxyXG4gIHN0eWxlVXJsczogW11cclxufSlcclxuZXhwb3J0IGNsYXNzIENoaWxkSW5mb0NvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCB7XHJcbiAgQElucHV0KFwic2NoZW1hVGFibGVcIilcclxuICBwdWJsaWMgc2NoZW1hVGFibGU6IEJpbGxTY2hlbWFUYWJsZTtcclxuXHJcbiAgQElucHV0KFwiZGF0YVRhYmxlXCIpXHJcbiAgcHVibGljIGRhdGFUYWJsZTogQmlsbERhdGFUYWJsZTtcclxuXHJcbiAgQElucHV0KFwiYmlsbEluZm9cIilcclxuICBwdWJsaWMgYmlsbEluZm86IEJpbGxJbmZvO1xyXG5cclxuICBzZWNUaXRsZSA9IG51bGw7XHJcblxyXG4gIHNob3dEZXRhaWwgPSBmYWxzZTtcclxuXHJcbiAgQFZpZXdDaGlsZChcImRnXCIpXHJcbiAgZGc6IERhdGFncmlkQ29tcG9uZW50O1xyXG4gIGRnQ29scyA9IFtdO1xyXG4gIGRnRGF0YSA9IFtdO1xyXG4gIGRnTGluZU51bWJlclRpdGxlID0gdGhpcy5sb2NhbGVQaXBlLnRyYW5zZm9ybShcImxpbmVOdW1iZXJcIik7XHJcbiAgZGdJZEZpZWxkID0gXCJiaWZEZ0lkMGQ2M1wiO1xyXG5cclxuICBjb25zdHJ1Y3RvcihcclxuICAgIHB1YmxpYyBub3RpZnk6IE5vdGlmeVNlcnZpY2UsXHJcbiAgICBwdWJsaWMgbWVzc2FnZXI6IE1lc3NhZ2VyU2VydmljZSxcclxuICAgIHB1YmxpYyBsb2FkaW5nOiBMb2FkaW5nU2VydmljZSxcclxuICAgIHB1YmxpYyBtb2RhbDogQnNNb2RhbFNlcnZpY2UsXHJcbiAgICBwdWJsaWMgZGF0YUluZm9TZXJ2aWNlOiBCaWxsVHJhY2tlckRhdGFJbmZvU2VydmljZSxcclxuICAgIHB1YmxpYyBsb2NhbGVQaXBlOiBCaWxsVHJhY2tlckxvY2FsZVBpcGUsXHJcbiAgICBwdWJsaWMgdmNyOiBWaWV3Q29udGFpbmVyUmVmLFxyXG4gICAgcHVibGljIGluajogSW5qZWN0b3IsXHJcbiAgICBwdWJsaWMgY2ZyOiBDb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIsXHJcbiAgICBwdWJsaWMgY2RyOiBDaGFuZ2VEZXRlY3RvclJlZixcclxuICAgIEBPcHRpb25hbCgpIEBJbmplY3QoTE9DQUxFX0lEKSBwdWJsaWMgbG9jYWxlSWQ6IHN0cmluZyxcclxuICApIHtcclxuICAgIHRoaXMubG9jYWxlSWQgPSBsb2NhbGVJZCB8fCB0aGlzLmluai5nZXQoTE9DQUxFX0lEKTtcclxuICB9XHJcblxyXG4gIG5nT25Jbml0KCk6IHZvaWQge1xyXG4gICAgLy8g6K6+572uc2VjdGlvbuagh+mimFxyXG4gICAgdGhpcy5zZWNUaXRsZSA9IHRoaXMubG9jYWxlUGlwZS50cmFuc2Zvcm0oXCJiYXNpY0luZm9cIik7XHJcbiAgICAvLyDooajlkI3op6PmnpBcclxuICAgIHRoaXMuc2VjVGl0bGUgPSB0aGlzLmRhdGFJbmZvU2VydmljZS5nZXRUYWJsZUxhYmVsKHRoaXMuYmlsbEluZm8sIHRoaXMuc2NoZW1hVGFibGUsIHRoaXMubG9jYWxlSWQpO1xyXG5cclxuICAgIC8vIOWNleaNrui/vei4qumFjee9rlxyXG4gICAgbGV0IGJ0czogQmlsbFRyYWNraW5nU2V0dGluZ3MgPSBuZXcgQmlsbFRyYWNraW5nU2V0dGluZ3MoKTtcclxuICAgIGlmICh0aGlzLmJpbGxJbmZvICYmIHRoaXMuYmlsbEluZm8uYmlsbFRyYWNraW5nU2V0dGluZ3MpIHtcclxuICAgICAgYnRzLkxvYWRGcm9tSnNvbih0aGlzLmJpbGxJbmZvLmJpbGxUcmFja2luZ1NldHRpbmdzKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyDlrZfmrrXop6PmnpBcclxuICAgIGxldCBmaWVsZENvbnRlbnQgPSBidHMuY3VzdG9tRmllbGRDb250ZW50O1xyXG4gICAgbGV0IGZpZWxkQ29uZmlnOiBCaWxsVHJhY2tlclNjaGVtYUZpZWxkQ29udGVudCA9IGZpZWxkQ29udGVudCAmJiAodHlwZW9mIGZpZWxkQ29udGVudCA9PSBcIm9iamVjdFwiID8gZmllbGRDb250ZW50IDogSlNPTi5wYXJzZShmaWVsZENvbnRlbnQpKTtcclxuICAgIGxldCBzZWxlY3RlZEZpZWxkcyA9IGZpZWxkQ29uZmlnICYmIGZpZWxkQ29uZmlnLnNjaGVtYSAmJiBmaWVsZENvbmZpZy5zY2hlbWFbdGhpcy5zY2hlbWFUYWJsZS50YWJsZU5hbWVdICYmIGZpZWxkQ29uZmlnLnNjaGVtYVt0aGlzLnNjaGVtYVRhYmxlLnRhYmxlTmFtZV0uZmllbGRzO1xyXG4gICAgc2VsZWN0ZWRGaWVsZHMgPSBzZWxlY3RlZEZpZWxkcyA/IHNlbGVjdGVkRmllbGRzIDogW107XHJcbiAgICBsZXQgc2hvd0N1c3RvbUZpZWxkcyA9IGJ0cy5iaWxsVHJhY2tpbmdEYXRhU2hvd25Nb2RlID09PSBCaWxsVHJhY2tpbmdEYXRhU2hvd25Nb2RlLkNVU1RPTUZJRUxEO1xyXG5cclxuICAgIGNvbnN0IGZzID0gdGhpcy5zY2hlbWFUYWJsZS5nZXRGaWVsZExpc3QoKTtcclxuICAgIC8vIOaPkOWPluWtl+autVxyXG4gICAgbGV0IGZmcyA9IHRoaXMuZGF0YUluZm9TZXJ2aWNlLmV4dHJhY3RGRmllbGRzKGZzLCBzZWxlY3RlZEZpZWxkcywgc2hvd0N1c3RvbUZpZWxkcyk7XHJcbiAgICAvLyDnrZvpgInmmL7npLrliJdcclxuICAgIGZmcyA9IGZmcy5maWx0ZXIoZiA9PiBmLnNob3cpO1xyXG4gICAgLy8g5oyJb3JkZXLmjpLluo9cclxuICAgIGZmcyA9IHRoaXMuZGF0YUluZm9TZXJ2aWNlLnNvcnRGaWVsZHNCeU9yZGVyKGZmcyk7XHJcblxyXG4gICAgLy8g5Yib5bu65pi+56S65YiXXHJcbiAgICB0aGlzLmRnQ29scyA9IFtdO1xyXG4gICAgZmZzLmZvckVhY2goKGY6IEJpbGxTY2hlbWFGaWVsZCB8IEJpbGxTY2hlbWFTdWJGaWVsZCkgPT4ge1xyXG4gICAgICBsZXQgYzogRGF0YUNvbHVtbiA9IHtcclxuICAgICAgICBmaWVsZDogZi5maWVsZFBhdGggfHwgZi5maWVsZE5hbWUsXHJcbiAgICAgICAgdGl0bGU6IHRoaXMuZGF0YUluZm9TZXJ2aWNlLmdldEZpZWxkTGFiZWwoZiwgdGhpcy5sb2NhbGVJZCksXHJcbiAgICAgICAgd2lkdGg6IDEyMFxyXG4gICAgICB9O1xyXG4gICAgICBpZiAoZi5kYXRhVHlwZSA9PSBEYXRhVHlwZS5Cb29sZWFuKSB7XHJcbiAgICAgICAgYy5mb3JtYXR0ZXIgPSAodmFsdWU6IGJvb2xlYW4sIHJvd0RhdGEsIHJvd0luZGV4KSA9PiB7XHJcbiAgICAgICAgICBpZiAodmFsdWUgPT0gdHJ1ZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5sb2NhbGVQaXBlLnRyYW5zZm9ybShcInllc1wiKTtcclxuICAgICAgICAgIH0gZWxzZSBpZiAodmFsdWUgPT0gZmFsc2UpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMubG9jYWxlUGlwZS50cmFuc2Zvcm0oXCJub1wiKTtcclxuICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiBcIi1cIjtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgICAgaWYgKGYuZGF0YVR5cGUgPT0gRGF0YVR5cGUuSW50ZWdlciB8fCBmLmRhdGFUeXBlID09IERhdGFUeXBlLkRlY2ltYWwpIHtcclxuICAgICAgICBjLmhhbGlnbiA9IFwicmlnaHRcIjtcclxuICAgICAgICBjLmFsaWduID0gXCJyaWdodFwiO1xyXG4gICAgICB9XHJcbiAgICAgIHRoaXMuZGdDb2xzLnB1c2goYyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICAvLyDmnoTlu7rooYzmlbDmja5cclxuICAgIGNvbnN0IHJvd3MgPSB0aGlzLmRhdGFUYWJsZSA/IHRoaXMuZGF0YVRhYmxlLkdldFJvd0xpc3QoKSA6IFtdO1xyXG4gICAgdHJ5IHtcclxuICAgICAgdGhpcy5kZ0RhdGEgPSBbLi4udGhpcy5kYXRhSW5mb1NlcnZpY2UuZXh0cmFjdERhdGFSb3dzKHJvd3MsIGZmcywgZnMsIHRoaXMuZGdJZEZpZWxkKV07XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICB0aGlzLmRnRGF0YSA9IFtdO1xyXG4gICAgICBpZiAoZXJyb3IgPT0gRXhjZXB0aW9ucy5TQ0FMRV9GSUVMRF9WQUxVRV9JU19OQU4pIHtcclxuICAgICAgICB0aGlzLm1lc3NhZ2VyLmVycm9yKHRoaXMubG9jYWxlUGlwZS50cmFuc2Zvcm0oXCJzY2FsZUZpZWxkQ2FudEJlQ2FzdFRvSW50ZWdlclwiKSk7XHJcbiAgICAgIH1cclxuICAgICAgdGhyb3cgZXJyb3I7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHRoaXMuZGdEYXRhLmxlbmd0aCA+IDApIHtcclxuICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgdGhpcy5kZyAmJiB0aGlzLmRnLnNlbGVjdFJvdyh0aGlzLmRnRGF0YVswXVt0aGlzLmRnSWRGaWVsZF0pO1xyXG4gICAgICB9LCA1MDApO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgc2VsZWN0Q2hhbmdlZChyb3c6IFNlbGVjdGVkUm93KSB7XHJcbiAgICBjb25zdCByID0gdGhpcy5kYXRhVGFibGUgPyB0aGlzLmRhdGFUYWJsZS5HZXRSb3dNYXAoKVtyb3cuaWRdIDogbnVsbDtcclxuICAgIHRoaXMuc2hvd0RldGFpbCA9IHIgIT0gbnVsbCAmJiB0aGlzLmRhdGFJbmZvU2VydmljZS5oYXNDaGlsZERhdGEociwgdGhpcy5iaWxsSW5mbyk7XHJcbiAgICB0aGlzLmNkci5kZXRlY3RDaGFuZ2VzKCk7XHJcbiAgfVxyXG5cclxuICB2aWV3Q2hpbGREYXRhKCkge1xyXG4gICAgaWYgKHRoaXMuZGcuc2VsZWN0ZWRSb3cgPT0gbnVsbCkge1xyXG4gICAgICB0aGlzLm5vdGlmeS53YXJuaW5nKHRoaXMubG9jYWxlUGlwZS50cmFuc2Zvcm0oXCJzZWxlY3RPbmVGaXJzdFwiKSk7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCByb3cgPSB0aGlzLmRhdGFUYWJsZSA/IHRoaXMuZGF0YVRhYmxlLkdldFJvd01hcCgpW3RoaXMuZGcuc2VsZWN0ZWRSb3cuaWRdIDogbnVsbDtcclxuICAgIGlmIChyb3cgPT0gbnVsbCB8fCAhdGhpcy5kYXRhSW5mb1NlcnZpY2UuaGFzQ2hpbGREYXRhKHJvdywgdGhpcy5iaWxsSW5mbykpIHtcclxuICAgICAgdGhpcy5ub3RpZnkuaW5mbyh0aGlzLmxvY2FsZVBpcGUudHJhbnNmb3JtKFwibm9DaGlsZERhdGFcIikpO1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgY21wRiA9IHRoaXMuY2ZyLnJlc29sdmVDb21wb25lbnRGYWN0b3J5KENoaWxkSW5mb0xpc3RDb21wb25lbnQpO1xyXG4gICAgY29uc3QgY21wUiA9IGNtcEYuY3JlYXRlKHRoaXMuaW5qLCBbXSk7XHJcbiAgICAvLyDojrflj5blrZDooajliJfooahcclxuICAgIGNvbnN0IGNoaWxkU2NoZW1hVGFibGVzID0gdGhpcy5kYXRhSW5mb1NlcnZpY2UuZ2V0Q2hpbGRUYWJsZXModGhpcy5iaWxsSW5mbywgdGhpcy5zY2hlbWFUYWJsZSk7XHJcbiAgICBjbXBSLmluc3RhbmNlLmNoaWxkU2NoZW1hVGFibGVzID0gY2hpbGRTY2hlbWFUYWJsZXM7XHJcbiAgICBjbXBSLmluc3RhbmNlLmNoaWxkRGF0YVRhYmxlTWFwID0gcm93LkdldENoaWxkVGFibGVNYXAoKTtcclxuICAgIGNtcFIuaW5zdGFuY2UuYmlsbEluZm8gPSB0aGlzLmJpbGxJbmZvO1xyXG4gICAgY29uc3QgYnNNb2RhbFJlZiA9IHRoaXMubW9kYWwuc2hvdyhjbXBSLCB7XHJcbiAgICAgIHRpdGxlOiB0aGlzLmxvY2FsZVBpcGUudHJhbnNmb3JtKFwiY2hpbGREYXRhXCIpLFxyXG4gICAgICB3aWR0aDogOTAwLFxyXG4gICAgICBoZWlnaHQ6IDYwMCxcclxuICAgICAgc2hvd0J1dHRvbnM6IGZhbHNlLFxyXG4gICAgfSk7XHJcbiAgICBjbXBSLmluc3RhbmNlLmJzTW9kYWxSZWYgPSBic01vZGFsUmVmO1xyXG4gIH1cclxufVxyXG4iXX0=
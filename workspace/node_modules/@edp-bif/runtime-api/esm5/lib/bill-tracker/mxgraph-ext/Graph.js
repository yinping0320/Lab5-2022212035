/**
 * @fileoverview added by tsickle
 * Generated from: lib/bill-tracker/mxgraph-ext/Graph.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { GraphView } from './GraphView';
import { BillNodeShape } from './shapes/BillNodeShape';
import { BillAssociationLine } from './shapes/BillAssociationLine';
import { mxCellRenderer, mxUtils, mxGraph, mxPoint, mxRectangle, mxGeometry, mxConstants, mxImage, mxPerimeter } from "../../ref/mxgraph";
import { BillCell } from './BillCell';
import { Base64 } from '../utils/Base64';
import { VertexHandler } from './VertexHandler';
import { Events } from './Events';
import { Styles } from './Styles';
mxCellRenderer.registerShape("billNodeShape", BillNodeShape);
mxCellRenderer.registerShape("billAssociationLine", BillAssociationLine);
var Graph = /** @class */ (function (_super) {
    tslib_1.__extends(Graph, _super);
    function Graph(container, model, renderHint, stylesheet) {
        var _this = _super.call(this, container, model, renderHint, stylesheet) || this;
        _this.background = '#ffffff';
        // this.newBTS = newBTS;
        _this.autoScroll = false;
        _this.autoExtend = true;
        _this.setCellsResizable(false);
        _this.setCellsEditable(false);
        _this.setTooltips(false);
        _this.setHtmlLabels(true);
        // 节点标签支持拖动
        _this.setVertexLabelsMovable(false);
        // 设置不可有悬空连线
        _this.setAllowDanglingEdges(false);
        // 定义内置样式
        _this.defineInnerStylesNewBTS();
        // 支持画布拖动
        _this.setPanning(true);
        _this.panningHandler.useLeftButtonForPanning = true;
        _this.container.style.cursor = 'grab';
        _this.scrollTileSize = new mxRectangle(0, 0, 400, 400);
        _this.addListener(Events.RESET_GRAPH_VIEW, _this.resetGraphView);
        return _this;
    }
    /**
     * @return {?}
     */
    Graph.prototype.createGraphView = /**
     * @return {?}
     */
    function () {
        return new GraphView(this);
    };
    /**
     * @param {?} state
     * @return {?}
     */
    Graph.prototype.createVertexHandler = /**
     * @param {?} state
     * @return {?}
     */
    function (state) {
        return new VertexHandler(state);
    };
    /**
     * @return {?}
     */
    Graph.prototype.getPagePadding = /**
     * @return {?}
     */
    function () {
        return new mxPoint(Math.max(0, Math.round(this.container.offsetWidth - 34)), Math.max(0, Math.round(this.container.offsetHeight - 34)));
    };
    /**
     * @return {?}
     */
    Graph.prototype.getPageSize = /**
     * @return {?}
     */
    function () {
        return (this.pageVisible) ? new mxRectangle(0, 0, this.pageFormat.width * this.pageScale, this.pageFormat.height * this.pageScale) : this.getScrollTileSize();
    };
    /**
     * @return {?}
     */
    Graph.prototype.getPageLayout = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var size = (this.pageVisible) ? this.getPageSize() : this.getScrollTileSize();
        /** @type {?} */
        var bounds = this.getGraphBounds();
        if (bounds.width == 0 || bounds.height == 0) {
            return new mxRectangle(0, 0, 1, 1);
        }
        else {
            // Computes untransformed graph bounds
            /** @type {?} */
            var x = Math.ceil(bounds.x / this.view.scale - this.view.translate.x);
            /** @type {?} */
            var y = Math.ceil(bounds.y / this.view.scale - this.view.translate.y);
            /** @type {?} */
            var w = Math.floor(bounds.width / this.view.scale);
            /** @type {?} */
            var h = Math.floor(bounds.height / this.view.scale);
            /** @type {?} */
            var x0 = Math.floor(x / size.width);
            /** @type {?} */
            var y0 = Math.floor(y / size.height);
            /** @type {?} */
            var w0 = Math.ceil((x + w) / size.width) - x0;
            /** @type {?} */
            var h0 = Math.ceil((y + h) / size.height) - y0;
            return new mxRectangle(x0, y0, w0, h0);
        }
    };
    /**
     * @return {?}
     */
    Graph.prototype.getScrollTileSize = /**
     * @return {?}
     */
    function () {
        if (this.scrollTileSize == null) {
            this.scrollTileSize = new mxRectangle(0, 0, 400, 600);
        }
        return this.scrollTileSize;
    };
    /**
     * @param {?} bounds
     * @param {?} width
     * @param {?} height
     * @return {?}
     */
    Graph.prototype.getPreferredPageSize = /**
     * @param {?} bounds
     * @param {?} width
     * @param {?} height
     * @return {?}
     */
    function (bounds, width, height) {
        //scrollTileSize有值后再调用重载实现
        /** @type {?} */
        var pages = this.getPageLayout();
        /** @type {?} */
        var size = this.getPageSize();
        return new mxRectangle(0, 0, pages.width * size.width, pages.height * size.height);
    };
    /**
     * @return {?}
     */
    Graph.prototype.sizeDidChange = /**
     * @return {?}
     */
    function () {
        if (this.container != null && mxUtils.hasScrollbars(this.container)) {
            /** @type {?} */
            var pages = this.getPageLayout();
            /** @type {?} */
            var pad = this.getPagePadding();
            /** @type {?} */
            var size = this.getPageSize();
            // Updates the minimum graph size
            /** @type {?} */
            var minw = Math.ceil(2 * pad.x / this.view.scale + pages.width * size.width);
            /** @type {?} */
            var minh = Math.ceil(2 * pad.y / this.view.scale + pages.height * size.height);
            /** @type {?} */
            var min = this.minimumGraphSize;
            // LATER: Fix flicker of scrollbar size in IE quirks mode
            // after delayed call in window.resize event handler
            if (min == null || min.width != minw || min.height != minh) {
                this.minimumGraphSize = new mxRectangle(0, 0, minw, minh);
            }
            // Updates auto-translate to include padding and graph size
            /** @type {?} */
            var dx = pad.x / this.view.scale - pages.x * size.width;
            /** @type {?} */
            var dy = pad.y / this.view.scale - pages.y * size.height;
            if (!this.autoTranslate && (this.view.translate.x != dx || this.view.translate.y != dy)) {
                this.autoTranslate = true;
                this.view.x0 = pages.x;
                this.view.y0 = pages.y;
                // NOTE: THIS INVOKES THIS METHOD AGAIN. UNFORTUNATELY THERE IS NO WAY AROUND THIS SINCE THE
                // BOUNDS ARE KNOWN AFTER THE VALIDATION AND SETTING THE TRANSLATE TRIGGERS A REVALIDATION.
                // SHOULD MOVE TRANSLATE/SCALE TO VIEW.
                /** @type {?} */
                var tx = this.view.translate.x;
                /** @type {?} */
                var ty = this.view.translate.y;
                this.view.setTranslate(dx, dy);
                this.container.scrollLeft += (dx - tx) * this.view.scale;
                this.container.scrollTop += (dy - ty) * this.view.scale;
                this.autoTranslate = false;
                return;
            }
            //super.sizeDidChange.apply(this, arguments);
            _super.prototype.sizeDidChange.call(this);
        }
    };
    /**
     * @return {?}
     */
    Graph.prototype.resetGraphView = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var bounds = this.getGraphBounds();
        /** @type {?} */
        var dataRegionHeight = 0;
        if (this.gridOptions.showEntryData) {
            if (typeof this.gridOptions.defaultHeight == "string") {
                dataRegionHeight = 0;
            }
            else {
                dataRegionHeight = this.gridOptions.defaultHeight;
            }
        }
        /** @type {?} */
        var s = Math.min(this.container.clientWidth / bounds.width, (this.container.clientHeight - dataRegionHeight - 20) / bounds.height);
        // 设定最大为1倍
        s = s >= 1 ? 1 : s;
        // 设定最小为0.6倍
        s = s <= 0.6 ? 0.6 : s;
        this.zoomTo(s, true);
        bounds = this.getGraphBounds();
        /** @type {?} */
        var width = Math.max(bounds.width, this.scrollTileSize.width * this.view.scale);
        /** @type {?} */
        var height = Math.max(bounds.height, this.scrollTileSize.height * this.view.scale);
        // this.container.scrollTop = Math.floor(Math.max(0, bounds.y - Math.max(20, (this.container.clientHeight - height) / 4)));
        // this.container.scrollLeft = Math.floor(Math.max(0, bounds.x - Math.max(0, (this.container.clientWidth - width) / 2)));
        this.container.scrollTop = Math.floor(Math.max(0, bounds.y - (this.container.clientHeight - bounds.height) / 2 + 79));
        this.container.scrollLeft = Math.floor(Math.max(0, bounds.x - (this.container.clientWidth - bounds.width) / 2));
    };
    /**
     * @param {?} parent
     * @param {?} id
     * @param {?} billDataInfo
     * @param {?} billInfo
     * @param {?} entry
     * @param {?} x
     * @param {?} y
     * @param {?} width
     * @param {?} height
     * @param {?=} style
     * @param {?=} relative
     * @return {?}
     */
    Graph.prototype.insertBillCell = /**
     * @param {?} parent
     * @param {?} id
     * @param {?} billDataInfo
     * @param {?} billInfo
     * @param {?} entry
     * @param {?} x
     * @param {?} y
     * @param {?} width
     * @param {?} height
     * @param {?=} style
     * @param {?=} relative
     * @return {?}
     */
    function (parent, id, billDataInfo, billInfo, entry, x, y, width, height, style, relative) {
        /** @type {?} */
        var billCell = this.createBillCell(parent, id, billDataInfo, billInfo, entry, x, y, width, height, style, relative);
        return (/** @type {?} */ (this.addCell(billCell, parent)));
    };
    /**
     * @param {?} parent
     * @param {?} id
     * @param {?} billDataInfo
     * @param {?} billInfo
     * @param {?} entry
     * @param {?} x
     * @param {?} y
     * @param {?} width
     * @param {?} height
     * @param {?=} style
     * @param {?=} relative
     * @return {?}
     */
    Graph.prototype.createBillCell = /**
     * @param {?} parent
     * @param {?} id
     * @param {?} billDataInfo
     * @param {?} billInfo
     * @param {?} entry
     * @param {?} x
     * @param {?} y
     * @param {?} width
     * @param {?} height
     * @param {?=} style
     * @param {?=} relative
     * @return {?}
     */
    function (parent, id, billDataInfo, billInfo, entry, x, y, width, height, style, relative) {
        /** @type {?} */
        var geometry = new mxGeometry(x, y, width, height);
        geometry.relative = (relative != null) ? relative : false;
        /** @type {?} */
        var billCell = new BillCell(billDataInfo, billInfo, entry, geometry, style);
        billCell.setId(id);
        billCell.setVertex(true);
        billCell.setConnectable(true);
        return billCell;
    };
    /**
     * @param {?} cell
     * @return {?}
     */
    Graph.prototype.getTooltipForCell = /**
     * @param {?} cell
     * @return {?}
     */
    function (cell) {
        if (cell instanceof BillCell) {
            return cell.buildHtmlTooltip();
        }
        return _super.prototype.getTooltipForCell.call(this, cell);
    };
    /**
     * @param {?} cell
     * @return {?}
     */
    Graph.prototype.getLabel = /**
     * @param {?} cell
     * @return {?}
     */
    function (cell) {
        if (cell instanceof BillCell) {
            // if (this.newBTS) {
            return _super.prototype.getLabel.call(this, cell);
            // } else {
            //     return cell.getCaption();
            // }
        }
        return _super.prototype.getLabel.call(this, cell);
    };
    /**
     * @param {?} cell
     * @return {?}
     */
    Graph.prototype.convertValueToString = /**
     * @param {?} cell
     * @return {?}
     */
    function (cell) {
        if (cell instanceof BillCell) {
            return cell.buildHtmlLabel(this);
        }
        else {
            return _super.prototype.convertValueToString.call(this, cell);
        }
    };
    /**
     * @private
     * @return {?}
     */
    Graph.prototype.defineInnerStylesNewBTS = /**
     * @private
     * @return {?}
     */
    function () {
        //定义单据节点样式
        /** @type {?} */
        var style = Object.assign({}, this.getStylesheet().getDefaultVertexStyle());
        style[mxConstants.STYLE_FILLCOLOR] = 'none';
        style[mxConstants.STYLE_STROKE_OPACITY] = '0';
        style[mxConstants.STYLE_STROKEWIDTH] = '1';
        style[mxConstants.STYLE_FONTCOLOR] = 'black';
        style[mxConstants.STYLE_FONTSIZE] = '12';
        style[mxConstants.STYLE_FONTSTYLE] = '1';
        style[mxConstants.STYLE_ROUNDED] = '1';
        style[mxConstants.STYLE_SPACING] = 8;
        style[mxConstants.STYLE_WHITE_SPACE] = 'wrap';
        // 图片拉伸
        style[mxConstants.STYLE_IMAGE_ASPECT] = '0';
        //节点标签显示于节点下方
        style[mxConstants.STYLE_PERIMETER] = mxPerimeter.RectanglePerimeter;
        style[mxConstants.STYLE_ALIGN] = mxConstants.ALIGN_CENTER;
        style[mxConstants.STYLE_VERTICAL_ALIGN] = mxConstants.ALIGN_MIDDLE;
        this.getStylesheet().putCellStyle(Styles.STYLE_BILL_NODE_NAME, style);
        //定义开始查询节点样式
        style = Object.assign({}, style);
        this.getStylesheet().putCellStyle(Styles.STYLE_BILL_NODE_ENTRY_NAME, style);
        //定义单据关联连线样式
        style = Object.assign({}, this.getStylesheet().getDefaultEdgeStyle());
        style[mxConstants.STYLE_SHAPE] = mxConstants.SHAPE_CONNECTOR;
        style[mxConstants.STYLE_STROKECOLOR] = '#2A87FF';
        style[mxConstants.STYLE_ENDARROW] = mxConstants.ARROW_CLASSIC;
        style[mxConstants.STYLE_VERTICAL_ALIGN] = mxConstants.ALIGN_MIDDLE;
        style[mxConstants.STYLE_ALIGN] = mxConstants.ALIGN_CENTER;
        style[mxConstants.STYLE_EDGE] = mxConstants.EDGESTYLE_ELBOW;
        style[mxConstants.STYLE_ELBOW] = mxConstants.ELBOW_HORIZONTAL;
        style[mxConstants.STYLE_STROKEWIDTH] = 1.8;
        style[mxConstants.STYLE_DASHED] = 1;
        style[mxConstants.STYLE_OPACITY] = 80;
        this.getStylesheet().putCellStyle(Styles.STYLE_BILL_ASSOCIATION_NAME, style);
    };
    /**
     * @param {?} cell
     * @param {?} evt
     * @return {?}
     */
    Graph.prototype.selectCellForEvent = /**
     * @param {?} cell
     * @param {?} evt
     * @return {?}
     */
    function (cell, evt) {
        _super.prototype.selectCellForEvent.call(this, cell, evt);
    };
    /**
     * @return {?}
     */
    Graph.prototype.createCellRenderer = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var render = _super.prototype.createCellRenderer.call(this);
        // 重写label事件判断方法，解决点击节点操作按钮时如果出现loading则按钮消失的问题
        // note：此改动会使点击节点操作按钮时不触发节点选中事件
        // note: 此改动后，点击节点摘要超链接的监听器中主动触发选中事件
        /** @type {?} */
        var oldIsLabelEvent = render.isLabelEvent;
        render.isLabelEvent = (/**
         * @param {?} state
         * @param {?} evt
         * @return {?}
         */
        function (state, evt) {
            if (state.cell instanceof BillCell) {
                if (evt && evt.target
                    && ((/** @type {?} */ (evt.target))).classList
                    && ((/** @type {?} */ (evt.target))).classList.value
                    && (((/** @type {?} */ (evt.target))).classList.value.includes("bif-cell-node-title-link bif-cell-node-title-link-color")
                        || ((/** @type {?} */ (evt.target))).classList.value.includes("bif-cell-node-btn"))) {
                    return false;
                }
                else {
                    return oldIsLabelEvent.apply(render, [state, evt]);
                }
            }
            return oldIsLabelEvent.apply(render, [state, evt]);
        });
        return render;
    };
    /**
     * @param {?} w
     * @param {?} h
     * @param {?} data
     * @return {?}
     */
    Graph.createSvgImage = /**
     * @param {?} w
     * @param {?} h
     * @param {?} data
     * @return {?}
     */
    function (w, h, data) {
        /** @type {?} */
        var tmp = unescape(encodeURIComponent('<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">' +
            '<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="' + w + 'px" height="' + h + 'px" ' +
            'version="1.1">' + data + '</svg>'));
        return new mxImage('data:image/svg+xml;base64,' + ((window.btoa) ? btoa(tmp) : Base64.encode(tmp, true)), w, h);
    };
    /**
     * @return {?}
     */
    Graph.prototype.destroy = /**
     * @return {?}
     */
    function () {
        _super.prototype.destroy.call(this);
        this.selectEventEmitter = null;
    };
    // newBTS: boolean = false;
    Graph.handleFill = '#29b6f2';
    return Graph;
}(mxGraph));
export { Graph };
if (false) {
    /** @type {?} */
    Graph.handleFill;
    /** @type {?} */
    Graph.prototype.selectEventEmitter;
    /** @type {?} */
    Graph.prototype.scrollTileSize;
    /** @type {?} */
    Graph.prototype.autoTranslate;
    /** @type {?} */
    Graph.prototype.view;
    /** @type {?} */
    Graph.prototype.background;
    /** @type {?} */
    Graph.prototype.graphOptions;
    /** @type {?} */
    Graph.prototype.gridOptions;
    /** @type {?} */
    Graph.prototype.localePipe;
    /** @type {?} */
    Graph.prototype.ngComp;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiR3JhcGguanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZWRwLWJpZi9ydW50aW1lLWFwaS8iLCJzb3VyY2VzIjpbImxpYi9iaWxsLXRyYWNrZXIvbXhncmFwaC1leHQvR3JhcGgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUEsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLGFBQWEsQ0FBQztBQUN4QyxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sd0JBQXdCLENBQUM7QUFDdkQsT0FBTyxFQUFFLG1CQUFtQixFQUFFLE1BQU0sOEJBQThCLENBQUM7QUFDbkUsT0FBTyxFQUFFLGNBQWMsRUFBRSxPQUFPLEVBQUUsT0FBTyxFQUFFLE9BQU8sRUFBRSxXQUFXLEVBQUUsVUFBVSxFQUFhLFdBQVcsRUFBRSxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFDckosT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLFlBQVksQ0FBQztBQUl0QyxPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFDekMsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQ2hELE9BQU8sRUFBRSxNQUFNLEVBQUUsTUFBTSxVQUFVLENBQUM7QUFDbEMsT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLFVBQVUsQ0FBQztBQU9sQyxjQUFjLENBQUMsYUFBYSxDQUFDLGVBQWUsRUFBRSxhQUFhLENBQUMsQ0FBQztBQUM3RCxjQUFjLENBQUMsYUFBYSxDQUFDLHFCQUFxQixFQUFFLG1CQUFtQixDQUFDLENBQUM7QUFFekU7SUFBMkIsaUNBQU87SUFjaEMsZUFBWSxTQUFVLEVBQUUsS0FBTSxFQUFFLFVBQVcsRUFBRSxVQUFXO1FBQXhELFlBQ0Usa0JBQU0sU0FBUyxFQUFFLEtBQUssRUFBRSxVQUFVLEVBQUUsVUFBVSxDQUFDLFNBd0JoRDtRQWxDRCxnQkFBVSxHQUFXLFNBQVMsQ0FBQztRQVk3Qix3QkFBd0I7UUFFeEIsS0FBSSxD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aEIsSUFBSSxDQUFDLGtCQUFrQixHQUFHLElBQUksQ0FBQztJQUNqQyxDQUFDOztJQXRTTSxnQkFBVSxHQUFHLFNBQVMsQ0FBQztJQXVTaEMsWUFBQztDQUFBLEFBL1NELENBQTJCLE9BQU8sR0ErU2pDO1NBL1NZLEtBQUs7OztJQVFoQixpQkFBOEI7O0lBUDlCLG1DQUFzQzs7SUFDdEMsK0JBQXNDOztJQUN0Qyw4QkFBdUI7O0lBQ3ZCLHFCQUFnQjs7SUFDaEIsMkJBQStCOztJQUkvQiw2QkFBc0M7O0lBQ3RDLDRCQUFvQzs7SUFDcEMsMkJBQWtDOztJQUNsQyx1QkFBa0MiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBHcmFwaFZpZXcgfSBmcm9tICcuL0dyYXBoVmlldyc7XHJcbmltcG9ydCB7IEJpbGxOb2RlU2hhcGUgfSBmcm9tICcuL3NoYXBlcy9CaWxsTm9kZVNoYXBlJztcclxuaW1wb3J0IHsgQmlsbEFzc29jaWF0aW9uTGluZSB9IGZyb20gJy4vc2hhcGVzL0JpbGxBc3NvY2lhdGlvbkxpbmUnO1xyXG5pbXBvcnQgeyBteENlbGxSZW5kZXJlciwgbXhVdGlscywgbXhHcmFwaCwgbXhQb2ludCwgbXhSZWN0YW5nbGUsIG14R2VvbWV0cnksIE14R3JhcGhOUywgbXhDb25zdGFudHMsIG14SW1hZ2UsIG14UGVyaW1ldGVyIH0gZnJvbSBcIi4uLy4uL3JlZi9teGdyYXBoXCI7XHJcbmltcG9ydCB7IEJpbGxDZWxsIH0gZnJvbSAnLi9CaWxsQ2VsbCc7XHJcbmltcG9ydCB7IEJpbGxEYXRhSW5mbyB9IGZyb20gJy4uLy4uL2VudGl0eS90cmFja2luZy9CaWxsRGF0YUluZm8nO1xyXG5pbXBvcnQgeyBEb3duQmlsbEluZm9SZXN1bHQgfSBmcm9tICcuLi9hcmdzL0Rvd25CaWxsSW5mb1Jlc3VsdCc7XHJcbmltcG9ydCB7IFVwQmlsbEluZm9SZXN1bHQgfSBmcm9tICcuLi9hcmdzL1VwQmlsbEluZm9SZXN1bHQnO1xyXG5pbXBvcnQgeyBCYXNlNjQgfSBmcm9tICcuLi91dGlscy9CYXNlNjQnO1xyXG5pbXBvcnQgeyBWZXJ0ZXhIYW5kbGVyIH0gZnJvbSAnLi9WZXJ0ZXhIYW5kbGVyJztcclxuaW1wb3J0IHsgRXZlbnRzIH0gZnJvbSAnLi9FdmVudHMnO1xyXG5pbXBvcnQgeyBTdHlsZXMgfSBmcm9tICcuL1N0eWxlcyc7XHJcbmltcG9ydCB7IEJpbGxUcmFja2VyR3JhcGhPcHRpb25zIH0gZnJvbSAnLi4vY29uZmlnL2JpbGwtdHJhY2tlci1ncmFwaC1vcHRpb25zJztcclxuaW1wb3J0IHsgQmlsbFRyYWNrZXJHcmlkT3B0aW9ucyB9IGZyb20gJy4uL2NvbmZpZy9iaWxsLXRyYWNrZXItZ3JpZC1vcHRpb25zJztcclxuaW1wb3J0IHsgQmlsbFRyYWNrZXJMb2NhbGVQaXBlIH0gZnJvbSAnLi4vcGlwZS9iaWxsLXRyYWNrZXItbG9jYWxlLnBpcGUnO1xyXG5pbXBvcnQgeyBFdmVudEVtaXR0ZXIgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgQmlsbFRyYWNrZXJHcmFwaENvbXBvbmVudCB9IGZyb20gJy4uL2NvbXBvbmVudHMvYmlsbC10cmFja2VyLWdyYXBoL2JpbGwtdHJhY2tlci1ncmFwaC5jb21wb25lbnQnO1xyXG5cclxubXhDZWxsUmVuZGVyZXIucmVnaXN0ZXJTaGFwZShcImJpbGxOb2RlU2hhcGVcIiwgQmlsbE5vZGVTaGFwZSk7XHJcbm14Q2VsbFJlbmRlcmVyLnJlZ2lzdGVyU2hhcGUoXCJiaWxsQXNzb2NpYXRpb25MaW5lXCIsIEJpbGxBc3NvY2lhdGlvbkxpbmUpO1xyXG5cclxuZXhwb3J0IGNsYXNzIEdyYXBoIGV4dGVuZHMgbXhHcmFwaCB7XHJcbiAgc2VsZWN0RXZlbnRFbWl0dGVyOiBFdmVudEVtaXR0ZXI8YW55PjtcclxuICBzY3JvbGxUaWxlU2l6ZTogTXhHcmFwaE5TLm14UmVjdGFuZ2xlO1xyXG4gIGF1dG9UcmFuc2xhdGU6IGJvb2xlYW47XHJcbiAgdmlldzogR3JhcGhWaWV3O1xyXG4gIGJhY2tncm91bmQ6IHN0cmluZyA9ICcjZmZmZmZmJztcclxuICAvLyBuZXdCVFM6IGJvb2xlYW4gPSBmYWxzZTtcclxuXHJcbiAgc3RhdGljIGhhbmRsZUZpbGwgPSAnIzI5YjZmMic7XHJcbiAgZ3JhcGhPcHRpb25zOiBCaWxsVHJhY2tlckdyYXBoT3B0aW9ucztcclxuICBncmlkT3B0aW9uczogQmlsbFRyYWNrZXJHcmlkT3B0aW9ucztcclxuICBsb2NhbGVQaXBlOiBCaWxsVHJhY2tlckxvY2FsZVBpcGU7XHJcbiAgbmdDb21wOiBCaWxsVHJhY2tlckdyYXBoQ29tcG9uZW50O1xyXG5cclxuICBjb25zdHJ1Y3Rvcihjb250YWluZXI/LCBtb2RlbD8sIHJlbmRlckhpbnQ/LCBzdHlsZXNoZWV0Pykge1xyXG4gICAgc3VwZXIoY29udGFpbmVyLCBtb2RlbCwgcmVuZGVySGludCwgc3R5bGVzaGVldCk7XHJcblxyXG4gICAgLy8gdGhpcy5uZXdCVFMgPSBuZXdCVFM7XHJcblxyXG4gICAgdGhpcy5hdXRvU2Nyb2xsID0gZmFsc2U7XHJcbiAgICB0aGlzLmF1dG9FeHRlbmQgPSB0cnVlO1xyXG4gICAgdGhpcy5zZXRDZWxsc1Jlc2l6YWJsZShmYWxzZSk7XHJcbiAgICB0aGlzLnNldENlbGxzRWRpdGFibGUoZmFsc2UpO1xyXG4gICAgdGhpcy5zZXRUb29sdGlwcyhmYWxzZSk7XHJcbiAgICB0aGlzLnNldEh0bWxMYWJlbHModHJ1ZSk7XHJcbiAgICAvLyDoioLngrnmoIfnrb7mlK/mjIHmi5bliqhcclxuICAgIHRoaXMuc2V0VmVydGV4TGFiZWxzTW92YWJsZShmYWxzZSk7XHJcbiAgICAvLyDorr7nva7kuI3lj6/mnInmgqznqbrov57nur9cclxuICAgIHRoaXMuc2V0QWxsb3dEYW5nbGluZ0VkZ2VzKGZhbHNlKTtcclxuICAgIC8vIOWumuS5ieWGhee9ruagt+W8j1xyXG4gICAgdGhpcy5kZWZpbmVJbm5lclN0eWxlc05ld0JUUygpO1xyXG4gICAgLy8g5pSv5oyB55S75biD5ouW5YqoXHJcbiAgICB0aGlzLnNldFBhbm5pbmcodHJ1ZSk7XHJcbiAgICB0aGlzLnBhbm5pbmdIYW5kbGVyLnVzZUxlZnRCdXR0b25Gb3JQYW5uaW5nID0gdHJ1ZTtcclxuICAgIHRoaXMuY29udGFpbmVyLnN0eWxlLmN1cnNvciA9ICdncmFiJztcclxuXHJcbiAgICB0aGlzLnNjcm9sbFRpbGVTaXplID0gbmV3IG14UmVjdGFuZ2xlKDAsIDAsIDQwMCwgNDAwKTtcclxuICAgIHRoaXMuYWRkTGlzdGVuZXIoRXZlbnRzLlJFU0VUX0dSQVBIX1ZJRVcsIHRoaXMucmVzZXRHcmFwaFZpZXcpO1xyXG5cclxuICB9XHJcblxyXG4gIGNyZWF0ZUdyYXBoVmlldygpIHtcclxuICAgIHJldHVybiBuZXcgR3JhcGhWaWV3KHRoaXMpO1xyXG4gIH1cclxuXHJcbiAgY3JlYXRlVmVydGV4SGFuZGxlcihzdGF0ZSkge1xyXG4gICAgcmV0dXJuIG5ldyBWZXJ0ZXhIYW5kbGVyKHN0YXRlKTtcclxuICB9XHJcblxyXG4gIGdldFBhZ2VQYWRkaW5nKCkge1xyXG4gICAgcmV0dXJuIG5ldyBteFBvaW50KE1hdGgubWF4KDAsIE1hdGgucm91bmQodGhpcy5jb250YWluZXIub2Zmc2V0V2lkdGggLSAzNCkpLFxyXG4gICAgICBNYXRoLm1heCgwLCBNYXRoLnJvdW5kKHRoaXMuY29udGFpbmVyLm9mZnNldEhlaWdodCAtIDM0KSkpO1xyXG4gIH1cclxuXHJcbiAgZ2V0UGFnZVNpemUoKSB7XHJcbiAgICByZXR1cm4gKHRoaXMucGFnZVZpc2libGUpID8gbmV3IG14UmVjdGFuZ2xlKDAsIDAsIHRoaXMucGFnZUZvcm1hdC53aWR0aCAqIHRoaXMucGFnZVNjYWxlLCB0aGlzLnBhZ2VGb3JtYXQuaGVpZ2h0ICogdGhpcy5wYWdlU2NhbGUpIDogdGhpcy5nZXRTY3JvbGxUaWxlU2l6ZSgpO1xyXG5cclxuICB9XHJcblxyXG4gIGdldFBhZ2VMYXlvdXQoKSB7XHJcbiAgICBsZXQgc2l6ZSA9ICh0aGlzLnBhZ2VWaXNpYmxlKSA/IHRoaXMuZ2V0UGFnZVNpemUoKSA6IHRoaXMuZ2V0U2Nyb2xsVGlsZVNpemUoKTtcclxuICAgIGxldCBib3VuZHMgPSB0aGlzLmdldEdyYXBoQm91bmRzKCk7XHJcblxyXG4gICAgaWYgKGJvdW5kcy53aWR0aCA9PSAwIHx8IGJvdW5kcy5oZWlnaHQgPT0gMCkge1xyXG4gICAgICByZXR1cm4gbmV3IG14UmVjdGFuZ2xlKDAsIDAsIDEsIDEpO1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgIC8vIENvbXB1dGVzIHVudHJhbnNmb3JtZWQgZ3JhcGggYm91bmRzXHJcbiAgICAgIGxldCB4ID0gTWF0aC5jZWlsKGJvdW5kcy54IC8gdGhpcy52aWV3LnNjYWxlIC0gdGhpcy52aWV3LnRyYW5zbGF0ZS54KTtcclxuICAgICAgbGV0IHkgPSBNYXRoLmNlaWwoYm91bmRzLnkgLyB0aGlzLnZpZXcuc2NhbGUgLSB0aGlzLnZpZXcudHJhbnNsYXRlLnkpO1xyXG4gICAgICBsZXQgdyA9IE1hdGguZmxvb3IoYm91bmRzLndpZHRoIC8gdGhpcy52aWV3LnNjYWxlKTtcclxuICAgICAgbGV0IGggPSBNYXRoLmZsb29yKGJvdW5kcy5oZWlnaHQgLyB0aGlzLnZpZXcuc2NhbGUpO1xyXG5cclxuICAgICAgbGV0IHgwID0gTWF0aC5mbG9vcih4IC8gc2l6ZS53aWR0aCk7XHJcbiAgICAgIGxldCB5MCA9IE1hdGguZmxvb3IoeSAvIHNpemUuaGVpZ2h0KTtcclxuICAgICAgbGV0IHcwID0gTWF0aC5jZWlsKCh4ICsgdykgLyBzaXplLndpZHRoKSAtIHgwO1xyXG4gICAgICBsZXQgaDAgPSBNYXRoLmNlaWwoKHkgKyBoKSAvIHNpemUuaGVpZ2h0KSAtIHkwO1xyXG5cclxuICAgICAgcmV0dXJuIG5ldyBteFJlY3RhbmdsZSh4MCwgeTAsIHcwLCBoMCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBnZXRTY3JvbGxUaWxlU2l6ZSgpIHtcclxuICAgIGlmICh0aGlzLnNjcm9sbFRpbGVTaXplID09IG51bGwpIHtcclxuICAgICAgdGhpcy5zY3JvbGxUaWxlU2l6ZSA9IG5ldyBteFJlY3RhbmdsZSgwLCAwLCA0MDAsIDYwMCk7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHRoaXMuc2Nyb2xsVGlsZVNpemU7XHJcbiAgfVxyXG5cclxuICBnZXRQcmVmZXJyZWRQYWdlU2l6ZShib3VuZHMsIHdpZHRoLCBoZWlnaHQpIHtcclxuICAgIC8vc2Nyb2xsVGlsZVNpemXmnInlgLzlkI7lho3osIPnlKjph43ovb3lrp7njrBcclxuICAgIGxldCBwYWdlcyA9IHRoaXMuZ2V0UGFnZUxheW91dCgpO1xyXG4gICAgbGV0IHNpemUgPSB0aGlzLmdldFBhZ2VTaXplKCk7XHJcblxyXG4gICAgcmV0dXJuIG5ldyBteFJlY3RhbmdsZSgwLCAwLCBwYWdlcy53aWR0aCAqIHNpemUud2lkdGgsIHBhZ2VzLmhlaWdodCAqIHNpemUuaGVpZ2h0KTtcclxuICB9XHJcblxyXG4gIHNpemVEaWRDaGFuZ2UoKSB7XHJcbiAgICBpZiAodGhpcy5jb250YWluZXIgIT0gbnVsbCAmJiBteFV0aWxzLmhhc1Njcm9sbGJhcnModGhpcy5jb250YWluZXIpKSB7XHJcbiAgICAgIGxldCBwYWdlcyA9IHRoaXMuZ2V0UGFnZUxheW91dCgpO1xyXG4gICAgICBsZXQgcGFkID0gdGhpcy5nZXRQYWdlUGFkZGluZygpO1xyXG4gICAgICBsZXQgc2l6ZSA9IHRoaXMuZ2V0UGFnZVNpemUoKTtcclxuXHJcbiAgICAgIC8vIFVwZGF0ZXMgdGhlIG1pbmltdW0gZ3JhcGggc2l6ZVxyXG4gICAgICBsZXQgbWludyA9IE1hdGguY2VpbCgyICogcGFkLnggLyB0aGlzLnZpZXcuc2NhbGUgKyBwYWdlcy53aWR0aCAqIHNpemUud2lkdGgpO1xyXG4gICAgICBsZXQgbWluaCA9IE1hdGguY2VpbCgyICogcGFkLnkgLyB0aGlzLnZpZXcuc2NhbGUgKyBwYWdlcy5oZWlnaHQgKiBzaXplLmhlaWdodCk7XHJcblxyXG4gICAgICBsZXQgbWluID0gdGhpcy5taW5pbXVtR3JhcGhTaXplO1xyXG5cclxuICAgICAgLy8gTEFURVI6IEZpeCBmbGlja2VyIG9mIHNjcm9sbGJhciBzaXplIGluIElFIHF1aXJrcyBtb2RlXHJcbiAgICAgIC8vIGFmdGVyIGRlbGF5ZWQgY2FsbCBpbiB3aW5kb3cucmVzaXplIGV2ZW50IGhhbmRsZXJcclxuICAgICAgaWYgKG1pbiA9PSBudWxsIHx8IG1pbi53aWR0aCAhPSBtaW53IHx8IG1pbi5oZWlnaHQgIT0gbWluaCkge1xyXG4gICAgICAgIHRoaXMubWluaW11bUdyYXBoU2l6ZSA9IG5ldyBteFJlY3RhbmdsZSgwLCAwLCBtaW53LCBtaW5oKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gVXBkYXRlcyBhdXRvLXRyYW5zbGF0ZSB0byBpbmNsdWRlIHBhZGRpbmcgYW5kIGdyYXBoIHNpemVcclxuICAgICAgbGV0IGR4ID0gcGFkLnggLyB0aGlzLnZpZXcuc2NhbGUgLSBwYWdlcy54ICogc2l6ZS53aWR0aDtcclxuICAgICAgbGV0IGR5ID0gcGFkLnkgLyB0aGlzLnZpZXcuc2NhbGUgLSBwYWdlcy55ICogc2l6ZS5oZWlnaHQ7XHJcblxyXG4gICAgICBpZiAoIXRoaXMuYXV0b1RyYW5zbGF0ZSAmJiAodGhpcy52aWV3LnRyYW5zbGF0ZS54ICE9IGR4IHx8IHRoaXMudmlldy50cmFuc2xhdGUueSAhPSBkeSkpIHtcclxuICAgICAgICB0aGlzLmF1dG9UcmFuc2xhdGUgPSB0cnVlO1xyXG4gICAgICAgIHRoaXMudmlldy54MCA9IHBhZ2VzLng7XHJcbiAgICAgICAgdGhpcy52aWV3LnkwID0gcGFnZXMueTtcclxuXHJcbiAgICAgICAgLy8gTk9URTogVEhJUyBJTlZPS0VTIFRISVMgTUVUSE9EIEFHQUlOLiBVTkZPUlRVTkFURUxZIFRIRVJFIElTIE5PIFdBWSBBUk9VTkQgVEhJUyBTSU5DRSBUSEVcclxuICAgICAgICAvLyBCT1VORFMgQVJFIEtOT1dOIEFGVEVSIFRIRSBWQUxJREFUSU9OIEFORCBTRVRUSU5HIFRIRSBUUkFOU0xBVEUgVFJJR0dFUlMgQSBSRVZBTElEQVRJT04uXHJcbiAgICAgICAgLy8gU0hPVUxEIE1PVkUgVFJBTlNMQVRFL1NDQUxFIFRPIFZJRVcuXHJcbiAgICAgICAgbGV0IHR4ID0gdGhpcy52aWV3LnRyYW5zbGF0ZS54O1xyXG4gICAgICAgIGxldCB0eSA9IHRoaXMudmlldy50cmFuc2xhdGUueTtcclxuXHJcbiAgICAgICAgdGhpcy52aWV3LnNldFRyYW5zbGF0ZShkeCwgZHkpO1xyXG4gICAgICAgIHRoaXMuY29udGFpbmVyLnNjcm9sbExlZnQgKz0gKGR4IC0gdHgpICogdGhpcy52aWV3LnNjYWxlO1xyXG4gICAgICAgIHRoaXMuY29udGFpbmVyLnNjcm9sbFRvcCArPSAoZHkgLSB0eSkgKiB0aGlzLnZpZXcuc2NhbGU7XHJcblxyXG4gICAgICAgIHRoaXMuYXV0b1RyYW5zbGF0ZSA9IGZhbHNlO1xyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfVxyXG5cclxuICAgICAgLy9zdXBlci5zaXplRGlkQ2hhbmdlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XHJcbiAgICAgIHN1cGVyLnNpemVEaWRDaGFuZ2UoKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHJlc2V0R3JhcGhWaWV3KCkge1xyXG4gICAgbGV0IGJvdW5kcyA9IHRoaXMuZ2V0R3JhcGhCb3VuZHMoKTtcclxuICAgIGxldCBkYXRhUmVnaW9uSGVpZ2h0ID0gMDtcclxuICAgIGlmICh0aGlzLmdyaWRPcHRpb25zLnNob3dFbnRyeURhdGEpIHtcclxuICAgICAgaWYgKHR5cGVvZiB0aGlzLmdyaWRPcHRpb25zLmRlZmF1bHRIZWlnaHQgPT0gXCJzdHJpbmdcIikge1xyXG4gICAgICAgIGRhdGFSZWdpb25IZWlnaHQgPSAwO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGRhdGFSZWdpb25IZWlnaHQgPSB0aGlzLmdyaWRPcHRpb25zLmRlZmF1bHRIZWlnaHQ7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIGxldCBzID0gTWF0aC5taW4odGhpcy5jb250YWluZXIuY2xpZW50V2lkdGggLyBib3VuZHMud2lkdGgsICh0aGlzLmNvbnRhaW5lci5jbGllbnRIZWlnaHQgLSBkYXRhUmVnaW9uSGVpZ2h0IC0gMjApIC8gYm91bmRzLmhlaWdodCk7XHJcbiAgICAvLyDorr7lrprmnIDlpKfkuLox5YCNXHJcbiAgICBzID0gcyA+PSAxID8gMSA6IHM7XHJcbiAgICAvLyDorr7lrprmnIDlsI/kuLowLjblgI1cclxuICAgIHMgPSBzIDw9IDAuNiA/IDAuNiA6IHM7XHJcbiAgICB0aGlzLnpvb21UbyhzLCB0cnVlKTtcclxuXHJcbiAgICBib3VuZHMgPSB0aGlzLmdldEdyYXBoQm91bmRzKCk7XHJcbiAgICBsZXQgd2lkdGggPSBNYXRoLm1heChib3VuZHMud2lkdGgsIHRoaXMuc2Nyb2xsVGlsZVNpemUud2lkdGggKiB0aGlzLnZpZXcuc2NhbGUpO1xyXG4gICAgbGV0IGhlaWdodCA9IE1hdGgubWF4KGJvdW5kcy5oZWlnaHQsIHRoaXMuc2Nyb2xsVGlsZVNpemUuaGVpZ2h0ICogdGhpcy52aWV3LnNjYWxlKTtcclxuICAgIC8vIHRoaXMuY29udGFpbmVyLnNjcm9sbFRvcCA9IE1hdGguZmxvb3IoTWF0aC5tYXgoMCwgYm91bmRzLnkgLSBNYXRoLm1heCgyMCwgKHRoaXMuY29udGFpbmVyLmNsaWVudEhlaWdodCAtIGhlaWdodCkgLyA0KSkpO1xyXG4gICAgLy8gdGhpcy5jb250YWluZXIuc2Nyb2xsTGVmdCA9IE1hdGguZmxvb3IoTWF0aC5tYXgoMCwgYm91bmRzLnggLSBNYXRoLm1heCgwLCAodGhpcy5jb250YWluZXIuY2xpZW50V2lkdGggLSB3aWR0aCkgLyAyKSkpO1xyXG4gICAgdGhpcy5jb250YWluZXIuc2Nyb2xsVG9wID0gTWF0aC5mbG9vcihNYXRoLm1heCgwLCBib3VuZHMueSAtICh0aGlzLmNvbnRhaW5lci5jbGllbnRIZWlnaHQgLSBib3VuZHMuaGVpZ2h0KSAvIDIgKyA3OSkpO1xyXG4gICAgdGhpcy5jb250YWluZXIuc2Nyb2xsTGVmdCA9IE1hdGguZmxvb3IoTWF0aC5tYXgoMCwgYm91bmRzLnggLSAodGhpcy5jb250YWluZXIuY2xpZW50V2lkdGggLSBib3VuZHMud2lkdGgpIC8gMikpO1xyXG4gIH1cclxuXHJcbiAgaW5zZXJ0QmlsbENlbGwocGFyZW50LCBpZCwgYmlsbERhdGFJbmZvOiBCaWxsRGF0YUluZm8sIGJpbGxJbmZvOiBEb3duQmlsbEluZm9SZXN1bHQgfCBVcEJpbGxJbmZvUmVzdWx0LCBlbnRyeTogYm9vbGVhbiwgeCwgeSwgd2lkdGgsIGhlaWdodCwgc3R5bGU/LCByZWxhdGl2ZT86IGJvb2xlYW4pOiBCaWxsQ2VsbCB7XHJcbiAgICBsZXQgYmlsbENlbGwgPSB0aGlzLmNyZWF0ZUJpbGxDZWxsKHBhcmVudCwgaWQsIGJpbGxEYXRhSW5mbywgYmlsbEluZm8sIGVudHJ5LCB4LCB5LCB3aWR0aCwgaGVpZ2h0LCBzdHlsZSwgcmVsYXRpdmUpO1xyXG5cclxuICAgIHJldHVybiB0aGlzLmFkZENlbGwoYmlsbENlbGwsIHBhcmVudCkgYXMgQmlsbENlbGw7XHJcbiAgfVxyXG5cclxuICBjcmVhdGVCaWxsQ2VsbChwYXJlbnQsIGlkLCBiaWxsRGF0YUluZm86IEJpbGxEYXRhSW5mbywgYmlsbEluZm86IERvd25CaWxsSW5mb1Jlc3VsdCB8IFVwQmlsbEluZm9SZXN1bHQsIGVudHJ5OiBib29sZWFuLCB4LCB5LCB3aWR0aCwgaGVpZ2h0LCBzdHlsZT8sIHJlbGF0aXZlPzogYm9vbGVhbik6IEJpbGxDZWxsIHtcclxuICAgIGxldCBnZW9tZXRyeSA9IG5ldyBteEdlb21ldHJ5KHgsIHksIHdpZHRoLCBoZWlnaHQpO1xyXG4gICAgZ2VvbWV0cnkucmVsYXRpdmUgPSAocmVsYXRpdmUgIT0gbnVsbCkgPyByZWxhdGl2ZSA6IGZhbHNlO1xyXG4gICAgbGV0IGJpbGxDZWxsID0gbmV3IEJpbGxDZWxsKGJpbGxEYXRhSW5mbywgYmlsbEluZm8sIGVudHJ5LCBnZW9tZXRyeSwgc3R5bGUpO1xyXG4gICAgYmlsbENlbGwuc2V0SWQoaWQpO1xyXG4gICAgYmlsbENlbGwuc2V0VmVydGV4KHRydWUpO1xyXG4gICAgYmlsbENlbGwuc2V0Q29ubmVjdGFibGUodHJ1ZSk7XHJcblxyXG4gICAgcmV0dXJuIGJpbGxDZWxsO1xyXG4gIH1cclxuXHJcbiAgZ2V0VG9vbHRpcEZvckNlbGwoY2VsbDogTXhHcmFwaE5TLm14Q2VsbCk6IHN0cmluZyB7XHJcbiAgICBpZiAoY2VsbCBpbnN0YW5jZW9mIEJpbGxDZWxsKSB7XHJcbiAgICAgIHJldHVybiBjZWxsLmJ1aWxkSHRtbFRvb2x0aXAoKTtcclxuICAgIH1cclxuICAgIHJldHVybiBzdXBlci5nZXRUb29sdGlwRm9yQ2VsbChjZWxsKTtcclxuICB9XHJcblxyXG4gIGdldExhYmVsKGNlbGw6IE14R3JhcGhOUy5teENlbGwpOiBzdHJpbmcge1xyXG4gICAgaWYgKGNlbGwgaW5zdGFuY2VvZiBCaWxsQ2VsbCkge1xyXG4gICAgICAvLyBpZiAodGhpcy5uZXdCVFMpIHtcclxuICAgICAgcmV0dXJuIHN1cGVyLmdldExhYmVsKGNlbGwpO1xyXG4gICAgICAvLyB9IGVsc2Uge1xyXG4gICAgICAvLyAgICAgcmV0dXJuIGNlbGwuZ2V0Q2FwdGlvbigpO1xyXG4gICAgICAvLyB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gc3VwZXIuZ2V0TGFiZWwoY2VsbCk7XHJcbiAgfVxyXG5cclxuICBjb252ZXJ0VmFsdWVUb1N0cmluZyhjZWxsKSB7XHJcbiAgICBpZiAoY2VsbCBpbnN0YW5jZW9mIEJpbGxDZWxsKSB7XHJcbiAgICAgIHJldHVybiBjZWxsLmJ1aWxkSHRtbExhYmVsKHRoaXMpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcmV0dXJuIHN1cGVyLmNvbnZlcnRWYWx1ZVRvU3RyaW5nKGNlbGwpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBkZWZpbmVJbm5lclN0eWxlc05ld0JUUygpIHtcclxuICAgIC8v5a6a5LmJ5Y2V5o2u6IqC54K55qC35byPXHJcbiAgICBsZXQgc3R5bGUgPSBPYmplY3QuYXNzaWduKHt9LCB0aGlzLmdldFN0eWxlc2hlZXQoKS5nZXREZWZhdWx0VmVydGV4U3R5bGUoKSk7XHJcbiAgICBzdHlsZVtteENvbnN0YW50cy5TVFlMRV9GSUxMQ09MT1JdID0gJ25vbmUnO1xyXG4gICAgc3R5bGVbbXhDb25zdGFudHMuU1RZTEVfU1RST0tFX09QQUNJVFldID0gJzAnO1xyXG4gICAgc3R5bGVbbXhDb25zdGFudHMuU1RZTEVfU1RST0tFV0lEVEhdID0gJzEnO1xyXG4gICAgc3R5bGVbbXhDb25zdGFudHMuU1RZTEVfRk9OVENPTE9SXSA9ICdibGFjayc7XHJcbiAgICBzdHlsZVtteENvbnN0YW50cy5TVFlMRV9GT05UU0laRV0gPSAnMTInO1xyXG4gICAgc3R5bGVbbXhDb25zdGFudHMuU1RZTEVfRk9OVFNUWUxFXSA9ICcxJztcclxuXHJcbiAgICBzdHlsZVtteENvbnN0YW50cy5TVFlMRV9ST1VOREVEXSA9ICcxJztcclxuXHJcbiAgICBzdHlsZVtteENvbnN0YW50cy5TVFlMRV9TUEFDSU5HXSA9IDg7XHJcbiAgICBzdHlsZVtteENvbnN0YW50cy5TVFlMRV9XSElURV9TUEFDRV0gPSAnd3JhcCc7XHJcblxyXG4gICAgLy8g5Zu+54mH5ouJ5Ly4XHJcbiAgICBzdHlsZVtteENvbnN0YW50cy5TVFlMRV9JTUFHRV9BU1BFQ1RdID0gJzAnO1xyXG5cclxuICAgIC8v6IqC54K55qCH562+5pi+56S65LqO6IqC54K55LiL5pa5XHJcbiAgICBzdHlsZVtteENvbnN0YW50cy5TVFlMRV9QRVJJTUVURVJdID0gbXhQZXJpbWV0ZXIuUmVjdGFuZ2xlUGVyaW1ldGVyO1xyXG4gICAgc3R5bGVbbXhDb25zdGFudHMuU1RZTEVfQUxJR05dID0gbXhDb25zdGFudHMuQUxJR05fQ0VOVEVSO1xyXG4gICAgc3R5bGVbbXhDb25zdGFudHMuU1RZTEVfVkVSVElDQUxfQUxJR05dID0gbXhDb25zdGFudHMuQUxJR05fTUlERExFO1xyXG5cclxuICAgIHRoaXMuZ2V0U3R5bGVzaGVldCgpLnB1dENlbGxTdHlsZShTdHlsZXMuU1RZTEVfQklMTF9OT0RFX05BTUUsIHN0eWxlKTtcclxuXHJcbiAgICAvL+WumuS5ieW8gOWni+afpeivouiKgueCueagt+W8j1xyXG4gICAgc3R5bGUgPSBPYmplY3QuYXNzaWduKHt9LCBzdHlsZSk7XHJcbiAgICB0aGlzLmdldFN0eWxlc2hlZXQoKS5wdXRDZWxsU3R5bGUoU3R5bGVzLlNUWUxFX0JJTExfTk9ERV9FTlRSWV9OQU1FLCBzdHlsZSk7XHJcblxyXG4gICAgLy/lrprkuYnljZXmja7lhbPogZTov57nur/moLflvI9cclxuICAgIHN0eWxlID0gT2JqZWN0LmFzc2lnbih7fSwgdGhpcy5nZXRTdHlsZXNoZWV0KCkuZ2V0RGVmYXVsdEVkZ2VTdHlsZSgpKTtcclxuICAgIHN0eWxlW214Q29uc3RhbnRzLlNUWUxFX1NIQVBFXSA9IG14Q29uc3RhbnRzLlNIQVBFX0NPTk5FQ1RPUjtcclxuICAgIHN0eWxlW214Q29uc3RhbnRzLlNUWUxFX1NUUk9LRUNPTE9SXSA9ICcjMkE4N0ZGJztcclxuICAgIHN0eWxlW214Q29uc3RhbnRzLlNUWUxFX0VOREFSUk9XXSA9IG14Q29uc3RhbnRzLkFSUk9XX0NMQVNTSUM7XHJcblxyXG4gICAgc3R5bGVbbXhDb25zdGFudHMuU1RZTEVfVkVSVElDQUxfQUxJR05dID0gbXhDb25zdGFudHMuQUxJR05fTUlERExFO1xyXG4gICAgc3R5bGVbbXhDb25zdGFudHMuU1RZTEVfQUxJR05dID0gbXhDb25zdGFudHMuQUxJR05fQ0VOVEVSO1xyXG4gICAgc3R5bGVbbXhDb25zdGFudHMuU1RZTEVfRURHRV0gPSBteENvbnN0YW50cy5FREdFU1RZTEVfRUxCT1c7XHJcbiAgICBzdHlsZVtteENvbnN0YW50cy5TVFlMRV9FTEJPV10gPSBteENvbnN0YW50cy5FTEJPV19IT1JJWk9OVEFMO1xyXG4gICAgc3R5bGVbbXhDb25zdGFudHMuU1RZTEVfU1RST0tFV0lEVEhdID0gMS44O1xyXG4gICAgc3R5bGVbbXhDb25zdGFudHMuU1RZTEVfREFTSEVEXSA9IDE7XHJcbiAgICBzdHlsZVtteENvbnN0YW50cy5TVFlMRV9PUEFDSVRZXSA9IDgwO1xyXG4gICAgdGhpcy5nZXRTdHlsZXNoZWV0KCkucHV0Q2VsbFN0eWxlKFN0eWxlcy5TVFlMRV9CSUxMX0FTU09DSUFUSU9OX05BTUUsIHN0eWxlKTtcclxuICB9XHJcblxyXG4gIHNlbGVjdENlbGxGb3JFdmVudChjZWxsOiBhbnksIGV2dDogRXZlbnQpOiB2b2lkIHtcclxuICAgIHN1cGVyLnNlbGVjdENlbGxGb3JFdmVudChjZWxsLCBldnQpO1xyXG4gIH1cclxuXHJcbiAgY3JlYXRlQ2VsbFJlbmRlcmVyKCkge1xyXG4gICAgY29uc3QgcmVuZGVyID0gc3VwZXIuY3JlYXRlQ2VsbFJlbmRlcmVyKCk7XHJcblxyXG4gICAgLy8g6YeN5YaZbGFiZWzkuovku7bliKTmlq3mlrnms5XvvIzop6PlhrPngrnlh7voioLngrnmk43kvZzmjInpkq7ml7blpoLmnpzlh7rnjrBsb2FkaW5n5YiZ5oyJ6ZKu5raI5aSx55qE6Zeu6aKYXHJcbiAgICAvLyBub3Rl77ya5q2k5pS55Yqo5Lya5L2/54K55Ye76IqC54K55pON5L2c5oyJ6ZKu5pe25LiN6Kem5Y+R6IqC54K56YCJ5Lit5LqL5Lu2XHJcbiAgICAvLyBub3RlOiDmraTmlLnliqjlkI7vvIzngrnlh7voioLngrnmkZjopoHotoXpk77mjqXnmoTnm5HlkKzlmajkuK3kuLvliqjop6blj5HpgInkuK3kuovku7ZcclxuICAgIGNvbnN0IG9sZElzTGFiZWxFdmVudCA9IHJlbmRlci5pc0xhYmVsRXZlbnQ7XHJcbiAgICByZW5kZXIuaXNMYWJlbEV2ZW50ID0gKHN0YXRlOiBNeEdyYXBoTlMubXhDZWxsU3RhdGUsIGV2dDogRXZlbnQpID0+IHtcclxuICAgICAgaWYgKHN0YXRlLmNlbGwgaW5zdGFuY2VvZiBCaWxsQ2VsbCkge1xyXG4gICAgICAgIGlmIChldnQgJiYgZXZ0LnRhcmdldFxyXG4gICAgICAgICAgJiYgKGV2dC50YXJnZXQgYXMgSFRNTEVsZW1lbnQpLmNsYXNzTGlzdFxyXG4gICAgICAgICAgJiYgKGV2dC50YXJnZXQgYXMgSFRNTEVsZW1lbnQpLmNsYXNzTGlzdC52YWx1ZVxyXG4gICAgICAgICAgJiYgKFxyXG4gICAgICAgICAgICAoZXZ0LnRhcmdldCBhcyBIVE1MRWxlbWVudCkuY2xhc3NMaXN0LnZhbHVlLmluY2x1ZGVzKFwiYmlmLWNlbGwtbm9kZS10aXRsZS1saW5rIGJpZi1jZWxsLW5vZGUtdGl0bGUtbGluay1jb2xvclwiKVxyXG4gICAgICAgICAgICB8fCAoZXZ0LnRhcmdldCBhcyBIVE1MRWxlbWVudCkuY2xhc3NMaXN0LnZhbHVlLmluY2x1ZGVzKFwiYmlmLWNlbGwtbm9kZS1idG5cIilcclxuICAgICAgICAgIClcclxuICAgICAgICApIHtcclxuICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgcmV0dXJuIG9sZElzTGFiZWxFdmVudC5hcHBseShyZW5kZXIsIFtzdGF0ZSwgZXZ0XSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICAgIHJldHVybiBvbGRJc0xhYmVsRXZlbnQuYXBwbHkocmVuZGVyLCBbc3RhdGUsIGV2dF0pO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiByZW5kZXI7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgc3RhdGljIGNyZWF0ZVN2Z0ltYWdlKHcsIGgsIGRhdGEpIHtcclxuICAgIHZhciB0bXAgPSB1bmVzY2FwZShlbmNvZGVVUklDb21wb25lbnQoXHJcbiAgICAgICc8IURPQ1RZUEUgc3ZnIFBVQkxJQyBcIi0vL1czQy8vRFREIFNWRyAxLjEvL0VOXCIgXCJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGRcIj4nICtcclxuICAgICAgJzxzdmcgeG1sbnM9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Z1wiIHhtbG5zOnhsaW5rPVwiaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGlua1wiIHdpZHRoPVwiJyArIHcgKyAncHhcIiBoZWlnaHQ9XCInICsgaCArICdweFwiICcgK1xyXG4gICAgICAndmVyc2lvbj1cIjEuMVwiPicgKyBkYXRhICsgJzwvc3ZnPicpKTtcclxuXHJcbiAgICByZXR1cm4gbmV3IG14SW1hZ2UoJ2RhdGE6aW1hZ2Uvc3ZnK3htbDtiYXNlNjQsJyArICgod2luZG93LmJ0b2EpID8gYnRvYSh0bXApIDogQmFzZTY0LmVuY29kZSh0bXAsIHRydWUpKSwgdywgaClcclxuICB9XHJcblxyXG4gIGRlc3Ryb3koKTogdm9pZCB7XHJcbiAgICBzdXBlci5kZXN0cm95KCk7XHJcbiAgICB0aGlzLnNlbGVjdEV2ZW50RW1pdHRlciA9IG51bGw7XHJcbiAgfVxyXG59XHJcbiJdfQ==
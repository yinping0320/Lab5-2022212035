/**
 * @fileoverview added by tsickle
 * Generated from: lib/bill-tracker/mxgraph-ext/BillCell.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { mxCell, mxEvent, mxEventObject, mxUtils } from "../../ref/mxgraph";
import { BpmnModelJsonHelper } from "@edp-aif/common-api";
import { BillTrackingSettings, JointQueryMode } from '@edp-bif/common-api';
import { FieldNameAndValue } from "../../entity/tracking/FieldNameAndValue";
import { Events } from "./Events";
import { BillTrackerConstant } from "../config/bill-tracker-constant";
var BillCell = /** @class */ (function (_super) {
    tslib_1.__extends(BillCell, _super);
    function BillCell(billDataInfo, billInfo, entry, geometry, style) {
        var _this = _super.call(this, null, geometry, style) || this;
        _this.THUMB_SCALE = 0.6;
        _this.billDataInfo = billDataInfo;
        _this.billInfo = billInfo;
        /** @type {?} */
        var bts = new BillTrackingSettings();
        if (billInfo && billInfo.billTrackingSettings) {
            bts.LoadFromJson(billInfo.billTrackingSettings);
        }
        _this.entry = entry;
        return _this;
        // this.value = this.billDataInfo.caption || bts.billNodeName || this.billInfo.voName || this.billDataInfo.dataId || this.billDataInfo.summary;
    }
    /**
     * @return {?}
     */
    BillCell.prototype.getCaption = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var label = null;
        /** @type {?} */
        var bts = new BillTrackingSettings();
        if (this.billInfo && this.billInfo.billTrackingSettings) {
            bts.LoadFromJson(this.billInfo.billTrackingSettings);
        }
        label = this.billDataInfo.caption || bts.billNodeName || this.billInfo.voName || this.billDataInfo.dataId || this.billDataInfo.summary;
        return label;
    };
    /**
     * @return {?}
     */
    BillCell.prototype.buildHtmlTooltip = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var tooltipHtml = "            <span>" + this.billDataInfo.dataId + "</span>        ";
        return tooltipHtml;
    };
    /**
     * 样式类在graph组件中定义
     * @param graph
     * @returns
     */
    /**
     * 样式类在graph组件中定义
     * @param {?} graph
     * @return {?}
     */
    BillCell.prototype.buildHtmlLabel = /**
     * 样式类在graph组件中定义
     * @param {?} graph
     * @return {?}
     */
    function (graph) {
        return this.buildHtmlLabelByDOM(graph);
    };
    /**
     * 通过操纵dom元素方式创建html
     * @param graph
     * @returns
     */
    /**
     * 通过操纵dom元素方式创建html
     * @private
     * @param {?} graph
     * @return {?}
     */
    BillCell.prototype.buildHtmlLabelByDOM = /**
     * 通过操纵dom元素方式创建html
     * @private
     * @param {?} graph
     * @return {?}
     */
    function (graph) {
        var _this = this;
        /** @type {?} */
        var scale = graph.view.scale;
        /** @type {?} */
        var state = graph.view.getState(this);
        /** @type {?} */
        var width = this.geometry.width;
        /** @type {?} */
        var height = this.geometry.height;
        /** @type {?} */
        var bts = new BillTrackingSettings();
        if (this.billInfo && this.billInfo.billTrackingSettings) {
            bts.LoadFromJson(this.billInfo.billTrackingSettings);
        }
        /** @type {?} */
        var title = this.billDataInfo.caption || bts.billNodeName || this.billInfo.voName || this.billDataInfo.dataId || this.billDataInfo.summary;
        /** @type {?} */
        var isEntry = this.entry;
        // 节点框架
        /** @type {?} */
        var divNodeRoot = document.createElement("div");
        divNodeRoot.classList.add("bif-cell-node");
        divNodeRoot.style.width = width + "px";
        divNodeRoot.style.height = height + "px";
        if (isEntry) {
            // 当前节点标识
            /** @type {?} */
            var divNodeCurrent = document.createElement("div");
            divNodeRoot.appendChild(divNodeCurrent);
            divNodeCurrent.classList.add("bif-cell-node-current");
            /** @type {?} */
            var spanCurrent = document.createElement("span");
            divNodeCurrent.appendChild(spanCurrent);
            spanCurrent.classList.add("bif-cell-node-current-text");
            spanCurrent.innerHTML = graph && graph.localePipe && graph.localePipe.transform("currentNode") || "当前";
        }
        // 当比例小到指定值后仅显示单据名
        if (scale < this.THUMB_SCALE) {
            // // 使用图片+标题
            // const divNodeThumb = document.createElement("div");
            // divNodeRoot.appendChild(divNodeThumb);
            // divNodeThumb.classList.add("bif-cell-node-thumb");
            // const divNodeThumbImg = document.createElement("div");
            // divNodeThumb.appendChild(divNodeThumbImg);
            // divNodeThumbImg.classList.add("bif-cell-node-thumb-img-container");
            // const img = document.createElement("img");
            // divNodeThumbImg.appendChild(img);
            // img.classList.add("bif-cell-node-thumb-img");
            // img.src = "/platform/runtime/common/web/@edp-bif/runtime-api/images/non-entry-bill.png";
            // const divNodeThumbTitle = document.createElement("div");
            // divNodeThumb.appendChild(divNodeThumbTitle);
            // divNodeThumbTitle.classList.add("bif-cell-node-thumb-title");
            // const divNodeThumbTitleText = document.createElement("div");
            // divNodeThumbTitle.appendChild(divNodeThumbTitleText);
            // divNodeThumbTitleText.classList.add("bif-cell-node-thumb-title-text");
            // divNodeThumbTitleText.innerHTML = title;
            // // 判断是否需添加点击事件
            // const jqm = this.billInfo.jointQueryMode;
            // const jqp: JointQueryParameters = JSON.parse(this.billInfo.jointQueryParameters);
            // if ((jqm == JointQueryMode.APP && jqp.funcId) || (jqm == JointQueryMode.URL && jqp.url)) {
            //     divNodeThumbTitleText.classList.add("bif-cell-node-title-link");
            //     mxEvent.addListener(divNodeThumbTitleText, "click", () => {
            //         graph.fireEvent(new mxEventObject(Events.CLICK_FIRST_SUMMARY, "cell", this));
            //         event.stopPropagation();
            //         return false;
            //     });
            // }
            // 使用标题
            // 节点标题
            /** @type {?} */
            var divNodeTitleOnly = document.createElement("div");
            divNodeRoot.appendChild(divNodeTitleOnly);
            divNodeTitleOnly.classList.add("bif-cell-node-title-only");
            /** @type {?} */
            var divNodeTitleOnlyText = document.createElement("div");
            divNodeTitleOnly.appendChild(divNodeTitleOnlyText);
            divNodeTitleOnlyText.classList.add("bif-cell-node-title-only-text");
            divNodeTitleOnlyText.innerHTML = title;
            // 判断是否需添加点击事件
            /** @type {?} */
            var jqm = this.billInfo.jointQueryMode;
            /** @type {?} */
            var jqp = JSON.parse(this.billInfo.jointQueryParameters);
            if ((jqm == JointQueryMode.APP && jqp.funcId) || (jqm == JointQueryMode.URL && jqp.url)) {
                divNodeTitleOnlyText.classList.add("bif-cell-node-title-link");
                mxEvent.addListener(divNodeTitleOnlyText, "click", (/**
                 * @return {?}
                 */
                function () {
                    graph.fireEvent(new mxEventObject(Events.CLICK_FIRST_SUMMARY, "cell", _this));
                    event.stopPropagation();
                    return false;
                }));
            }
        }
        else {
            // 节点主内容
            /** @type {?} */
            var divNodeMain = document.createElement("div");
            divNodeRoot.appendChild(divNodeMain);
            divNodeMain.classList.add("bif-cell-node-main");
            // 节点标题
            /** @type {?} */
            var divNodeTitle = document.createElement("div");
            divNodeMain.appendChild(divNodeTitle);
            divNodeTitle.classList.add("bif-cell-node-title");
            /** @type {?} */
            var divNodeTitleText = document.createElement("div");
            divNodeTitle.appendChild(divNodeTitleText);
            divNodeTitleText.classList.add("bif-cell-node-title-text");
            divNodeTitleText.innerHTML = title;
            divNodeTitleText.title = title;
            // 节点摘要
            /** @type {?} */
            var divNodeSummaryList_1 = document.createElement("div");
            divNodeMain.appendChild(divNodeSummaryList_1);
            divNodeSummaryList_1.classList.add("bif-cell-node-summary-list");
            // 46是标题栏高度
            divNodeSummaryList_1.style.minHeight = (height - 46) + "px";
            try {
                /** @type {?} */
                var fieldNameAndValues = BpmnModelJsonHelper.FromJson(this.billDataInfo.summary, FieldNameAndValue);
                fieldNameAndValues && fieldNameAndValues.forEach((/**
                 * @param {?} fv
                 * @param {?} idx
                 * @return {?}
                 */
                function (fv, idx) {
                    /** @type {?} */
                    var divNodeSummary = document.createElement("div");
                    divNodeSummaryList_1.appendChild(divNodeSummary);
                    divNodeSummary.classList.add("bif-cell-node-summary");
                    /** @type {?} */
                    var divNodeSummaryCaption = document.createElement("div");
                    divNodeSummary.appendChild(divNodeSummaryCaption);
                    divNodeSummaryCaption.classList.add("bif-cell-node-summary-caption");
                    /** @type {?} */
                    var divNodeSummaryCaptionText = document.createElement("div");
                    divNodeSummaryCaption.appendChild(divNodeSummaryCaptionText);
                    divNodeSummaryCaptionText.classList.add("bif-cell-node-summary-caption-text");
                    divNodeSummaryCaptionText.title = fv.name;
                    divNodeSummaryCaptionText.innerHTML = fv.name;
                    /** @type {?} */
                    var divNodeSummaryValue = document.createElement("div");
                    divNodeSummary.appendChild(divNodeSummaryValue);
                    divNodeSummaryValue.classList.add("bif-cell-node-summary-value");
                    /** @type {?} */
                    var divNodeSummaryValueText = document.createElement("div");
                    divNodeSummaryValue.appendChild(divNodeSummaryValueText);
                    divNodeSummaryValueText.classList.add("bif-cell-node-summary-value-text");
                    divNodeSummaryValueText.title = fv.value;
                    divNodeSummaryValueText.innerText = fv.value;
                    if (idx == 0) {
                        // 判断是否需添加点击事件
                        /** @type {?} */
                        var jqm = _this.billInfo.jointQueryMode;
                        /** @type {?} */
                        var jqp = JSON.parse(_this.billInfo.jointQueryParameters);
                        if ((jqm == JointQueryMode.APP && jqp.funcId) || (jqm == JointQueryMode.URL && jqp.url)) {
                            divNodeSummaryValueText.classList.add("bif-cell-node-title-link", "bif-cell-node-title-link-color");
                            mxEvent.addListener(divNodeSummaryValueText, "click", (/**
                             * @return {?}
                             */
                            function () {
                                graph.fireEvent(new mxEventObject(Events.CLICK_FIRST_SUMMARY, "cell", _this));
                                event.stopPropagation();
                                return false;
                            }));
                        }
                    }
                }));
            }
            catch (e) {
                console.error(e);
            }
            // 操作按钮
            /** @type {?} */
            var divNodeBtnGroup_1 = document.createElement("div");
            divNodeMain.appendChild(divNodeBtnGroup_1);
            divNodeBtnGroup_1.classList.add("bif-cell-node-btn-group", "bif-cell-node-btn-group-control");
            // 详情按钮
            /** @type {?} */
            var imgView = document.createElement("img");
            divNodeBtnGroup_1.appendChild(imgView);
            imgView.src = BillTrackerConstant.IMAGE_PATH + "/view.svg";
            imgView.title = graph.localePipe.transform("viewBill");
            imgView.classList.add("bif-cell-node-btn");
            // 点击按钮触发选中事件
            imgView.addEventListener("click", (/**
             * @return {?}
             */
            function () {
                graph.setSelectionCell(_this);
            }));
            // 不是当前节点时添加更多按钮
            if (isEntry == false) {
                // 更多按钮
                /** @type {?} */
                var imgMore_1 = document.createElement("img");
                divNodeBtnGroup_1.appendChild(imgMore_1);
                imgMore_1.src = BillTrackerConstant.IMAGE_PATH + "/more.svg";
                imgMore_1.title = graph.localePipe.transform("more");
                imgMore_1.classList.add("bif-cell-node-btn");
                mxEvent.addListener(imgMore_1, mxEvent.CLICK, (/**
                 * @param {?} evt
                 * @return {?}
                 */
                function (evt) {
                    /** @type {?} */
                    var offset = mxUtils.getOffset(imgMore_1);
                    // 移除more hover效果
                    divNodeBtnGroup_1.classList.remove("bif-cell-node-btn-group-control");
                    // 重写隐藏菜单方法
                    /** @type {?} */
                    var hideMenu = graph.ngComp.morePopupMenu.hideMenu;
                    graph.ngComp.morePopupMenu.hideMenu = (/**
                     * @return {?}
                     */
                    function () {
                        hideMenu.apply(this, arguments);
                        // 重新添加hover效果
                        divNodeBtnGroup_1.classList.add("bif-cell-node-btn-group-control");
                    });
                    // 弹出菜单
                    graph.ngComp.morePopupMenu.popup(offset.x, offset.y + imgMore_1.offsetHeight, _this, evt);
                    // 更新当前打开菜单对象
                    graph.ngComp.currentMenu = graph.ngComp.morePopupMenu;
                }));
            }
        }
        return divNodeRoot;
    };
    /**
     * 通过模板字符串方式创建html
     * @param graph
     * @returns
     */
    /**
     * 通过模板字符串方式创建html
     * @private
     * @param {?} graph
     * @return {?}
     */
    BillCell.prototype.buildHtmlLabelByTemplateText = /**
     * 通过模板字符串方式创建html
     * @private
     * @param {?} graph
     * @return {?}
     */
    function (graph) {
        /** @type {?} */
        var state = graph.view.getState(this);
        /** @type {?} */
        var width = state && state.width ? state.width : this.geometry.width;
        /** @type {?} */
        var height = state && state.height ? state.height : this.geometry.height;
        /** @type {?} */
        var bts = new BillTrackingSettings();
        if (this.billInfo && this.billInfo.billTrackingSettings) {
            bts.LoadFromJson(this.billInfo.billTrackingSettings);
        }
        /** @type {?} */
        var title = this.billDataInfo.caption || bts.billNodeName || this.billInfo.voName || this.billDataInfo.dataId || this.billDataInfo.summary;
        /** @type {?} */
        var titleBackground = this.entry ? "rgba(86,160,255,0.08)" : "#FFFFFF";
        /** @type {?} */
        var summaryHtml = "";
        try {
            /** @type {?} */
            var fieldNameAndValues = BpmnModelJsonHelper.FromJson(this.billDataInfo.summary, FieldNameAndValue);
            fieldNameAndValues && fieldNameAndValues.forEach((/**
             * @param {?} fv
             * @param {?} idx
             * @return {?}
             */
            function (fv, idx) {
                /** @type {?} */
                var valueText = idx == 0 ? "<a href='javascript:void(0);'>" + fv.value + "</a>" : fv.value;
                summaryHtml += "                        <div class=\"bif-cell-node-summary\">                            <div class=\"bif-cell-node-summary-caption\">                                <div class=\"bif-cell-node-summary-caption-text\" title=\"" + fv.name + "\">" + fv.name + "</div>                            </div>                            <div class=\"bif-cell-node-summary-value\">                                <div class=\"bif-cell-node-summary-value-text\" title=\"" + fv.value + "\">" + valueText + "</div>                            </div>                        </div>                    ";
            }));
        }
        catch (e) {
            console.error(e);
        }
        /** @type {?} */
        var html = "            <div class=\"bif-cell-node\" style=\"width:" + width + "px;\">                <div class=\"bif-cell-node-main\" style=\"background: " + titleBackground + ";\">                    <div class=\"bif-cell-node-title\">                        <div class=\"bif-cell-node-title-text\">" + title + "</div>                    </div>                    <div class=\"bif-cell-node-summary-list\" style=\"min-height: " + (height - 30) + "px;\">                        " + summaryHtml + "                    </div>                </div>            </div>        ";
        return html;
    };
    return BillCell;
}(mxCell));
export { BillCell };
if (false) {
    /** @type {?} */
    BillCell.prototype.THUMB_SCALE;
    /** @type {?} */
    BillCell.prototype.entry;
    /** @type {?} */
    BillCell.prototype.data;
    /** @type {?} */
    BillCell.prototype.billDataInfo;
    /** @type {?} */
    BillCell.prototype.billInfo;
    /** @type {?} */
    BillCell.prototype.downCellOverlay;
    /** @type {?} */
    BillCell.prototype.upCellOverlay;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQmlsbENlbGwuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZWRwLWJpZi9ydW50aW1lLWFwaS8iLCJzb3VyY2VzIjpbImxpYi9iaWxsLXRyYWNrZXIvbXhncmFwaC1leHQvQmlsbENlbGwudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUEsT0FBTyxFQUFFLE1BQU0sRUFBRSxPQUFPLEVBQUUsYUFBYSxFQUEwQixPQUFPLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUtwRyxPQUFPLEVBQUUsbUJBQW1CLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUMxRCxPQUFPLEVBQUUsb0JBQW9CLEVBQUUsY0FBYyxFQUF3QixNQUFNLHFCQUFxQixDQUFDO0FBRWpHLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLHlDQUF5QyxDQUFDO0FBRTVFLE9BQU8sRUFBRSxNQUFNLEVBQUUsTUFBTSxVQUFVLENBQUM7QUFDbEMsT0FBTyxFQUFFLG1CQUFtQixFQUFFLE1BQU0saUNBQWlDLENBQUM7QUFFdEU7SUFBOEIsb0NBQU07SUFTbEMsa0JBQVksWUFBMEIsRUFBRSxRQUErQyxFQUFFLEtBQWMsRUFBRSxRQUFTLEVBQUUsS0FBTTtRQUExSCxZQUNFLGtCQUFNLElBQUksRUFBRSxRQUFRLEVBQUUsS0FBSyxDQUFDLFNBVTdCO1FBbkJRLGlCQUFXLEdBQVcsR0FBRyxDQUFDO1FBV2pDLEtBQUksQ0FBQyxZQUFZLEdBQUcsWUFBWSxDQUFDO1FBQ2pDLEtBQUksQ0FBQyxRQUFRLEdBQUcsUUFBUSxDQUFDOztZQUNyQixHQUFHLEdBQXlCLElBQUksb0JBQW9CLEVBQUU7UUFDMUQsSUFBSSxRQUFRLElBQUksUUFBUSxDQUFDLG9CQUFvQixFQUFFO1lBQzdDLEdBQUcsQ0FBQyxZQUFZLENBQUMsUUFBUSxDQUFDLG9CQUFvQixDQUFDLENBQUM7U0FDakQ7UUFDRCxLQUFJLENBQUMsS0FBSyxHQUFHLEtBQUssQ0FBQzs7UUFDbkIsK0lBQStJO0lBQ2pKLENBQUM7Ozs7SUFFRCw2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bEI7O1lBQ0ssSUFBSSxHQUFHLDREQUNxQyxLQUFLLG9GQUNVLGVBQWUsbUlBRXBCLEtBQUssMkhBRVksTUFBTSxHQUFHLEVBQUUsdUNBQ2xFLFdBQVcsK0VBSTVCO1FBQ0wsT0FBTyxJQUFJLENBQUM7SUFDZCxDQUFDO0lBQ0gsZUFBQztBQUFELENBQUMsQUF0VEQsQ0FBOEIsTUFBTSxHQXNUbkM7Ozs7SUFyVEMsK0JBQW1DOztJQUVuQyx5QkFBZTs7SUFDZix3QkFBZTs7SUFDZixnQ0FBMkI7O0lBQzNCLDRCQUFnRDs7SUFDaEQsbUNBQTZCOztJQUM3QixpQ0FBMkIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBteENlbGwsIG14RXZlbnQsIG14RXZlbnRPYmplY3QsIE14R3JhcGhOUywgbXhQb3B1cE1lbnUsIG14VXRpbHMgfSBmcm9tIFwiLi4vLi4vcmVmL214Z3JhcGhcIjtcclxuaW1wb3J0IHsgQmlsbERhdGFJbmZvIH0gZnJvbSAnLi4vLi4vZW50aXR5L3RyYWNraW5nL0JpbGxEYXRhSW5mbyc7XHJcbmltcG9ydCB7IERvd25CaWxsSW5mb1Jlc3VsdCB9IGZyb20gJy4uL2FyZ3MvRG93bkJpbGxJbmZvUmVzdWx0JztcclxuaW1wb3J0IHsgVXBCaWxsSW5mb1Jlc3VsdCB9IGZyb20gJy4uL2FyZ3MvVXBCaWxsSW5mb1Jlc3VsdCc7XHJcbmltcG9ydCB7IENlbGxEYXRhIH0gZnJvbSAnLi4vLi4vZW50aXR5L3RyYWNraW5nL2NlbGwtZGF0YS9DZWxsRGF0YSc7XHJcbmltcG9ydCB7IEJwbW5Nb2RlbEpzb25IZWxwZXIgfSBmcm9tIFwiQGVkcC1haWYvY29tbW9uLWFwaVwiO1xyXG5pbXBvcnQgeyBCaWxsVHJhY2tpbmdTZXR0aW5ncywgSm9pbnRRdWVyeU1vZGUsIEpvaW50UXVlcnlQYXJhbWV0ZXJzIH0gZnJvbSAnQGVkcC1iaWYvY29tbW9uLWFwaSc7XHJcbmltcG9ydCB7IEdyYXBoIH0gZnJvbSBcIi4vR3JhcGhcIjtcclxuaW1wb3J0IHsgRmllbGROYW1lQW5kVmFsdWUgfSBmcm9tIFwiLi4vLi4vZW50aXR5L3RyYWNraW5nL0ZpZWxkTmFtZUFuZFZhbHVlXCI7XHJcbmltcG9ydCB7IENlbGxPdmVybGF5IH0gZnJvbSBcIi4vQ2VsbE92ZXJsYXlcIjtcclxuaW1wb3J0IHsgRXZlbnRzIH0gZnJvbSBcIi4vRXZlbnRzXCI7XHJcbmltcG9ydCB7IEJpbGxUcmFja2VyQ29uc3RhbnQgfSBmcm9tIFwiLi4vY29uZmlnL2JpbGwtdHJhY2tlci1jb25zdGFudFwiO1xyXG5cclxuZXhwb3J0IGNsYXNzIEJpbGxDZWxsIGV4dGVuZHMgbXhDZWxsIHtcclxuICByZWFkb25seSBUSFVNQl9TQ0FMRTogbnVtYmVyID0gMC42O1xyXG5cclxuICBlbnRyeTogYm9vbGVhbjtcclxuICBkYXRhOiBDZWxsRGF0YTtcclxuICBiaWxsRGF0YUluZm86IEJpbGxEYXRhSW5mbztcclxuICBiaWxsSW5mbzogRG93bkJpbGxJbmZvUmVzdWx0IHwgVXBCaWxsSW5mb1Jlc3VsdDtcclxuICBkb3duQ2VsbE92ZXJsYXk6IENlbGxPdmVybGF5O1xyXG4gIHVwQ2VsbE92ZXJsYXk6IENlbGxPdmVybGF5O1xyXG4gIGNvbnN0cnVjdG9yKGJpbGxEYXRhSW5mbzogQmlsbERhdGFJbmZvLCBiaWxsSW5mbzogRG93bkJpbGxJbmZvUmVzdWx0IHwgVXBCaWxsSW5mb1Jlc3VsdCwgZW50cnk6IGJvb2xlYW4sIGdlb21ldHJ5Pywgc3R5bGU/KSB7XHJcbiAgICBzdXBlcihudWxsLCBnZW9tZXRyeSwgc3R5bGUpO1xyXG5cclxuICAgIHRoaXMuYmlsbERhdGFJbmZvID0gYmlsbERhdGFJbmZvO1xyXG4gICAgdGhpcy5iaWxsSW5mbyA9IGJpbGxJbmZvO1xyXG4gICAgbGV0IGJ0czogQmlsbFRyYWNraW5nU2V0dGluZ3MgPSBuZXcgQmlsbFRyYWNraW5nU2V0dGluZ3MoKTtcclxuICAgIGlmIChiaWxsSW5mbyAmJiBiaWxsSW5mby5iaWxsVHJhY2tpbmdTZXR0aW5ncykge1xyXG4gICAgICBidHMuTG9hZEZyb21Kc29uKGJpbGxJbmZvLmJpbGxUcmFja2luZ1NldHRpbmdzKTtcclxuICAgIH1cclxuICAgIHRoaXMuZW50cnkgPSBlbnRyeTtcclxuICAgIC8vIHRoaXMudmFsdWUgPSB0aGlzLmJpbGxEYXRhSW5mby5jYXB0aW9uIHx8IGJ0cy5iaWxsTm9kZU5hbWUgfHwgdGhpcy5iaWxsSW5mby52b05hbWUgfHwgdGhpcy5iaWxsRGF0YUluZm8uZGF0YUlkIHx8IHRoaXMuYmlsbERhdGFJbmZvLnN1bW1hcnk7XHJcbiAgfVxyXG5cclxuICBnZXRDYXB0aW9uKCkge1xyXG4gICAgbGV0IGxhYmVsOiBzdHJpbmcgPSBudWxsO1xyXG4gICAgbGV0IGJ0czogQmlsbFRyYWNraW5nU2V0dGluZ3MgPSBuZXcgQmlsbFRyYWNraW5nU2V0dGluZ3MoKTtcclxuICAgIGlmICh0aGlzLmJpbGxJbmZvICYmIHRoaXMuYmlsbEluZm8uYmlsbFRyYWNraW5nU2V0dGluZ3MpIHtcclxuICAgICAgYnRzLkxvYWRGcm9tSnNvbih0aGlzLmJpbGxJbmZvLmJpbGxUcmFja2luZ1NldHRpbmdzKTtcclxuICAgIH1cclxuICAgIGxhYmVsID0gdGhpcy5iaWxsRGF0YUluZm8uY2FwdGlvbiB8fCBidHMuYmlsbE5vZGVOYW1lIHx8IHRoaXMuYmlsbEluZm8udm9OYW1lIHx8IHRoaXMuYmlsbERhdGFJbmZvLmRhdGFJZCB8fCB0aGlzLmJpbGxEYXRhSW5mby5zdW1tYXJ5O1xyXG4gICAgcmV0dXJuIGxhYmVsO1xyXG4gIH1cclxuXHJcbiAgYnVpbGRIdG1sVG9vbHRpcCgpOiBzdHJpbmcge1xyXG4gICAgY29uc3QgdG9vbHRpcEh0bWwgPSBgXFxcclxuICAgICAgICAgICAgPHNwYW4+JHt0aGlzLmJpbGxEYXRhSW5mby5kYXRhSWR9PC9zcGFuPlxcXHJcbiAgICAgICAgYDtcclxuICAgIHJldHVybiB0b29sdGlwSHRtbDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOagt+W8j+exu+WcqGdyYXBo57uE5Lu25Lit5a6a5LmJXHJcbiAgICogQHBhcmFtIGdyYXBoXHJcbiAgICogQHJldHVybnNcclxuICAgKi9cclxuICBidWlsZEh0bWxMYWJlbChncmFwaDogR3JhcGgpIHtcclxuICAgIHJldHVybiB0aGlzLmJ1aWxkSHRtbExhYmVsQnlET00oZ3JhcGgpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog6YCa6L+H5pON57q1ZG9t5YWD57Sg5pa55byP5Yib5bu6aHRtbFxyXG4gICAqIEBwYXJhbSBncmFwaFxyXG4gICAqIEByZXR1cm5zXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBidWlsZEh0bWxMYWJlbEJ5RE9NKGdyYXBoOiBHcmFwaCkge1xyXG4gICAgY29uc3Qgc2NhbGUgPSBncmFwaC52aWV3LnNjYWxlO1xyXG4gICAgY29uc3Qgc3RhdGUgPSBncmFwaC52aWV3LmdldFN0YXRlKHRoaXMpO1xyXG4gICAgY29uc3Qgd2lkdGggPSB0aGlzLmdlb21ldHJ5LndpZHRoO1xyXG4gICAgY29uc3QgaGVpZ2h0ID0gdGhpcy5nZW9tZXRyeS5oZWlnaHQ7XHJcbiAgICBsZXQgYnRzOiBCaWxsVHJhY2tpbmdTZXR0aW5ncyA9IG5ldyBCaWxsVHJhY2tpbmdTZXR0aW5ncygpO1xyXG4gICAgaWYgKHRoaXMuYmlsbEluZm8gJiYgdGhpcy5iaWxsSW5mby5iaWxsVHJhY2tpbmdTZXR0aW5ncykge1xyXG4gICAgICBidHMuTG9hZEZyb21Kc29uKHRoaXMuYmlsbEluZm8uYmlsbFRyYWNraW5nU2V0dGluZ3MpO1xyXG4gICAgfVxyXG4gICAgY29uc3QgdGl0bGUgPSB0aGlzLmJpbGxEYXRhSW5mby5jYXB0aW9uIHx8IGJ0cy5iaWxsTm9kZU5hbWUgfHwgdGhpcy5iaWxsSW5mby52b05hbWUgfHwgdGhpcy5iaWxsRGF0YUluZm8uZGF0YUlkIHx8IHRoaXMuYmlsbERhdGFJbmZvLnN1bW1hcnk7XHJcbiAgICBjb25zdCBpc0VudHJ5ID0gdGhpcy5lbnRyeTtcclxuXHJcbiAgICAvLyDoioLngrnmoYbmnrZcclxuICAgIGNvbnN0IGRpdk5vZGVSb290ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcclxuICAgIGRpdk5vZGVSb290LmNsYXNzTGlzdC5hZGQoXCJiaWYtY2VsbC1ub2RlXCIpO1xyXG4gICAgZGl2Tm9kZVJvb3Quc3R5bGUud2lkdGggPSB3aWR0aCArIFwicHhcIjtcclxuICAgIGRpdk5vZGVSb290LnN0eWxlLmhlaWdodCA9IGhlaWdodCArIFwicHhcIjtcclxuXHJcbiAgICBpZiAoaXNFbnRyeSkge1xyXG4gICAgICAvLyDlvZPliY3oioLngrnmoIfor4ZcclxuICAgICAgY29uc3QgZGl2Tm9kZUN1cnJlbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xyXG4gICAgICBkaXZOb2RlUm9vdC5hcHBlbmRDaGlsZChkaXZOb2RlQ3VycmVudCk7XHJcbiAgICAgIGRpdk5vZGVDdXJyZW50LmNsYXNzTGlzdC5hZGQoXCJiaWYtY2VsbC1ub2RlLWN1cnJlbnRcIik7XHJcblxyXG4gICAgICBjb25zdCBzcGFuQ3VycmVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzcGFuXCIpO1xyXG4gICAgICBkaXZOb2RlQ3VycmVudC5hcHBlbmRDaGlsZChzcGFuQ3VycmVudCk7XHJcbiAgICAgIHNwYW5DdXJyZW50LmNsYXNzTGlzdC5hZGQoXCJiaWYtY2VsbC1ub2RlLWN1cnJlbnQtdGV4dFwiKTtcclxuICAgICAgc3BhbkN1cnJlbnQuaW5uZXJIVE1MID0gZ3JhcGggJiYgZ3JhcGgubG9jYWxlUGlwZSAmJiBncmFwaC5sb2NhbGVQaXBlLnRyYW5zZm9ybShcImN1cnJlbnROb2RlXCIpIHx8IFwi5b2T5YmNXCI7XHJcbiAgICB9XHJcblxyXG4gICAgLy8g5b2T5q+U5L6L5bCP5Yiw5oyH5a6a5YC85ZCO5LuF5pi+56S65Y2V5o2u5ZCNXHJcbiAgICBpZiAoc2NhbGUgPCB0aGlzLlRIVU1CX1NDQUxFKSB7XHJcbiAgICAgIC8vIC8vIOS9v+eUqOWbvueJhyvmoIfpophcclxuICAgICAgLy8gY29uc3QgZGl2Tm9kZVRodW1iID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcclxuICAgICAgLy8gZGl2Tm9kZVJvb3QuYXBwZW5kQ2hpbGQoZGl2Tm9kZVRodW1iKTtcclxuICAgICAgLy8gZGl2Tm9kZVRodW1iLmNsYXNzTGlzdC5hZGQoXCJiaWYtY2VsbC1ub2RlLXRodW1iXCIpO1xyXG5cclxuICAgICAgLy8gY29uc3QgZGl2Tm9kZVRodW1iSW1nID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcclxuICAgICAgLy8gZGl2Tm9kZVRodW1iLmFwcGVuZENoaWxkKGRpdk5vZGVUaHVtYkltZyk7XHJcbiAgICAgIC8vIGRpdk5vZGVUaHVtYkltZy5jbGFzc0xpc3QuYWRkKFwiYmlmLWNlbGwtbm9kZS10aHVtYi1pbWctY29udGFpbmVyXCIpO1xyXG5cclxuICAgICAgLy8gY29uc3QgaW1nID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImltZ1wiKTtcclxuICAgICAgLy8gZGl2Tm9kZVRodW1iSW1nLmFwcGVuZENoaWxkKGltZyk7XHJcbiAgICAgIC8vIGltZy5jbGFzc0xpc3QuYWRkKFwiYmlmLWNlbGwtbm9kZS10aHVtYi1pbWdcIik7XHJcbiAgICAgIC8vIGltZy5zcmMgPSBcIi9wbGF0Zm9ybS9ydW50aW1lL2NvbW1vbi93ZWIvQGVkcC1iaWYvcnVudGltZS1hcGkvaW1hZ2VzL25vbi1lbnRyeS1iaWxsLnBuZ1wiO1xyXG5cclxuICAgICAgLy8gY29uc3QgZGl2Tm9kZVRodW1iVGl0bGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xyXG4gICAgICAvLyBkaXZOb2RlVGh1bWIuYXBwZW5kQ2hpbGQoZGl2Tm9kZVRodW1iVGl0bGUpO1xyXG4gICAgICAvLyBkaXZOb2RlVGh1bWJUaXRsZS5jbGFzc0xpc3QuYWRkKFwiYmlmLWNlbGwtbm9kZS10aHVtYi10aXRsZVwiKTtcclxuXHJcbiAgICAgIC8vIGNvbnN0IGRpdk5vZGVUaHVtYlRpdGxlVGV4dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICAgIC8vIGRpdk5vZGVUaHVtYlRpdGxlLmFwcGVuZENoaWxkKGRpdk5vZGVUaHVtYlRpdGxlVGV4dCk7XHJcbiAgICAgIC8vIGRpdk5vZGVUaHVtYlRpdGxlVGV4dC5jbGFzc0xpc3QuYWRkKFwiYmlmLWNlbGwtbm9kZS10aHVtYi10aXRsZS10ZXh0XCIpO1xyXG4gICAgICAvLyBkaXZOb2RlVGh1bWJUaXRsZVRleHQuaW5uZXJIVE1MID0gdGl0bGU7XHJcblxyXG4gICAgICAvLyAvLyDliKTmlq3mmK/lkKbpnIDmt7vliqDngrnlh7vkuovku7ZcclxuICAgICAgLy8gY29uc3QganFtID0gdGhpcy5iaWxsSW5mby5qb2ludFF1ZXJ5TW9kZTtcclxuICAgICAgLy8gY29uc3QganFwOiBKb2ludFF1ZXJ5UGFyYW1ldGVycyA9IEpTT04ucGFyc2UodGhpcy5iaWxsSW5mby5qb2ludFF1ZXJ5UGFyYW1ldGVycyk7XHJcbiAgICAgIC8vIGlmICgoanFtID09IEpvaW50UXVlcnlNb2RlLkFQUCAmJiBqcXAuZnVuY0lkKSB8fCAoanFtID09IEpvaW50UXVlcnlNb2RlLlVSTCAmJiBqcXAudXJsKSkge1xyXG4gICAgICAvLyAgICAgZGl2Tm9kZVRodW1iVGl0bGVUZXh0LmNsYXNzTGlzdC5hZGQoXCJiaWYtY2VsbC1ub2RlLXRpdGxlLWxpbmtcIik7XHJcbiAgICAgIC8vICAgICBteEV2ZW50LmFkZExpc3RlbmVyKGRpdk5vZGVUaHVtYlRpdGxlVGV4dCwgXCJjbGlja1wiLCAoKSA9PiB7XHJcbiAgICAgIC8vICAgICAgICAgZ3JhcGguZmlyZUV2ZW50KG5ldyBteEV2ZW50T2JqZWN0KEV2ZW50cy5DTElDS19GSVJTVF9TVU1NQVJZLCBcImNlbGxcIiwgdGhpcykpO1xyXG4gICAgICAvLyAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gICAgICAvLyAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgLy8gICAgIH0pO1xyXG4gICAgICAvLyB9XHJcblxyXG4gICAgICAvLyDkvb/nlKjmoIfpophcclxuICAgICAgLy8g6IqC54K55qCH6aKYXHJcbiAgICAgIGNvbnN0IGRpdk5vZGVUaXRsZU9ubHkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xyXG4gICAgICBkaXZOb2RlUm9vdC5hcHBlbmRDaGlsZChkaXZOb2RlVGl0bGVPbmx5KTtcclxuICAgICAgZGl2Tm9kZVRpdGxlT25seS5jbGFzc0xpc3QuYWRkKFwiYmlmLWNlbGwtbm9kZS10aXRsZS1vbmx5XCIpO1xyXG5cclxuICAgICAgY29uc3QgZGl2Tm9kZVRpdGxlT25seVRleHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xyXG4gICAgICBkaXZOb2RlVGl0bGVPbmx5LmFwcGVuZENoaWxkKGRpdk5vZGVUaXRsZU9ubHlUZXh0KTtcclxuICAgICAgZGl2Tm9kZVRpdGxlT25seVRleHQuY2xhc3NMaXN0LmFkZChcImJpZi1jZWxsLW5vZGUtdGl0bGUtb25seS10ZXh0XCIpO1xyXG4gICAgICBkaXZOb2RlVGl0bGVPbmx5VGV4dC5pbm5lckhUTUwgPSB0aXRsZTtcclxuXHJcbiAgICAgIC8vIOWIpOaWreaYr+WQpumcgOa3u+WKoOeCueWHu+S6i+S7tlxyXG4gICAgICBjb25zdCBqcW0gPSB0aGlzLmJpbGxJbmZvLmpvaW50UXVlcnlNb2RlO1xyXG4gICAgICBjb25zdCBqcXA6IEpvaW50UXVlcnlQYXJhbWV0ZXJzID0gSlNPTi5wYXJzZSh0aGlzLmJpbGxJbmZvLmpvaW50UXVlcnlQYXJhbWV0ZXJzKTtcclxuICAgICAgaWYgKChqcW0gPT0gSm9pbnRRdWVyeU1vZGUuQVBQICYmIGpxcC5mdW5jSWQpIHx8IChqcW0gPT0gSm9pbnRRdWVyeU1vZGUuVVJMICYmIGpxcC51cmwpKSB7XHJcbiAgICAgICAgZGl2Tm9kZVRpdGxlT25seVRleHQuY2xhc3NMaXN0LmFkZChcImJpZi1jZWxsLW5vZGUtdGl0bGUtbGlua1wiKTtcclxuICAgICAgICBteEV2ZW50LmFkZExpc3RlbmVyKGRpdk5vZGVUaXRsZU9ubHlUZXh0LCBcImNsaWNrXCIsICgpID0+IHtcclxuICAgICAgICAgIGdyYXBoLmZpcmVFdmVudChuZXcgbXhFdmVudE9iamVjdChFdmVudHMuQ0xJQ0tfRklSU1RfU1VNTUFSWSwgXCJjZWxsXCIsIHRoaXMpKTtcclxuICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAvLyDoioLngrnkuLvlhoXlrrlcclxuICAgICAgY29uc3QgZGl2Tm9kZU1haW4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xyXG4gICAgICBkaXZOb2RlUm9vdC5hcHBlbmRDaGlsZChkaXZOb2RlTWFpbik7XHJcbiAgICAgIGRpdk5vZGVNYWluLmNsYXNzTGlzdC5hZGQoXCJiaWYtY2VsbC1ub2RlLW1haW5cIik7XHJcblxyXG4gICAgICAvLyDoioLngrnmoIfpophcclxuICAgICAgY29uc3QgZGl2Tm9kZVRpdGxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcclxuICAgICAgZGl2Tm9kZU1haW4uYXBwZW5kQ2hpbGQoZGl2Tm9kZVRpdGxlKTtcclxuICAgICAgZGl2Tm9kZVRpdGxlLmNsYXNzTGlzdC5hZGQoXCJiaWYtY2VsbC1ub2RlLXRpdGxlXCIpO1xyXG5cclxuICAgICAgY29uc3QgZGl2Tm9kZVRpdGxlVGV4dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICAgIGRpdk5vZGVUaXRsZS5hcHBlbmRDaGlsZChkaXZOb2RlVGl0bGVUZXh0KTtcclxuICAgICAgZGl2Tm9kZVRpdGxlVGV4dC5jbGFzc0xpc3QuYWRkKFwiYmlmLWNlbGwtbm9kZS10aXRsZS10ZXh0XCIpO1xyXG4gICAgICBkaXZOb2RlVGl0bGVUZXh0LmlubmVySFRNTCA9IHRpdGxlO1xyXG4gICAgICBkaXZOb2RlVGl0bGVUZXh0LnRpdGxlID0gdGl0bGU7XHJcblxyXG4gICAgICAvLyDoioLngrnmkZjopoFcclxuICAgICAgY29uc3QgZGl2Tm9kZVN1bW1hcnlMaXN0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcclxuICAgICAgZGl2Tm9kZU1haW4uYXBwZW5kQ2hpbGQoZGl2Tm9kZVN1bW1hcnlMaXN0KTtcclxuICAgICAgZGl2Tm9kZVN1bW1hcnlMaXN0LmNsYXNzTGlzdC5hZGQoXCJiaWYtY2VsbC1ub2RlLXN1bW1hcnktbGlzdFwiKTtcclxuICAgICAgLy8gNDbmmK/moIfpopjmoI/pq5jluqZcclxuICAgICAgZGl2Tm9kZVN1bW1hcnlMaXN0LnN0eWxlLm1pbkhlaWdodCA9IChoZWlnaHQgLSA0NikgKyBcInB4XCI7XHJcblxyXG4gICAgICB0cnkge1xyXG4gICAgICAgIGNvbnN0IGZpZWxkTmFtZUFuZFZhbHVlczogRmllbGROYW1lQW5kVmFsdWVbXSA9IEJwbW5Nb2RlbEpzb25IZWxwZXIuRnJvbUpzb24odGhpcy5iaWxsRGF0YUluZm8uc3VtbWFyeSwgRmllbGROYW1lQW5kVmFsdWUpO1xyXG4gICAgICAgIGZpZWxkTmFtZUFuZFZhbHVlcyAmJiBmaWVsZE5hbWVBbmRWYWx1ZXMuZm9yRWFjaChcclxuICAgICAgICAgIChmdiwgaWR4KSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGRpdk5vZGVTdW1tYXJ5ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcclxuICAgICAgICAgICAgZGl2Tm9kZVN1bW1hcnlMaXN0LmFwcGVuZENoaWxkKGRpdk5vZGVTdW1tYXJ5KTtcclxuICAgICAgICAgICAgZGl2Tm9kZVN1bW1hcnkuY2xhc3NMaXN0LmFkZChcImJpZi1jZWxsLW5vZGUtc3VtbWFyeVwiKTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IGRpdk5vZGVTdW1tYXJ5Q2FwdGlvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICAgICAgICAgIGRpdk5vZGVTdW1tYXJ5LmFwcGVuZENoaWxkKGRpdk5vZGVTdW1tYXJ5Q2FwdGlvbik7XHJcbiAgICAgICAgICAgIGRpdk5vZGVTdW1tYXJ5Q2FwdGlvbi5jbGFzc0xpc3QuYWRkKFwiYmlmLWNlbGwtbm9kZS1zdW1tYXJ5LWNhcHRpb25cIik7XHJcblxyXG4gICAgICAgICAgICBjb25zdCBkaXZOb2RlU3VtbWFyeUNhcHRpb25UZXh0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcclxuICAgICAgICAgICAgZGl2Tm9kZVN1bW1hcnlDYXB0aW9uLmFwcGVuZENoaWxkKGRpdk5vZGVTdW1tYXJ5Q2FwdGlvblRleHQpO1xyXG4gICAgICAgICAgICBkaXZOb2RlU3VtbWFyeUNhcHRpb25UZXh0LmNsYXNzTGlzdC5hZGQoXCJiaWYtY2VsbC1ub2RlLXN1bW1hcnktY2FwdGlvbi10ZXh0XCIpO1xyXG4gICAgICAgICAgICBkaXZOb2RlU3VtbWFyeUNhcHRpb25UZXh0LnRpdGxlID0gZnYubmFtZTtcclxuICAgICAgICAgICAgZGl2Tm9kZVN1bW1hcnlDYXB0aW9uVGV4dC5pbm5lckhUTUwgPSBmdi5uYW1lO1xyXG5cclxuICAgICAgICAgICAgY29uc3QgZGl2Tm9kZVN1bW1hcnlWYWx1ZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICAgICAgICAgIGRpdk5vZGVTdW1tYXJ5LmFwcGVuZENoaWxkKGRpdk5vZGVTdW1tYXJ5VmFsdWUpO1xyXG4gICAgICAgICAgICBkaXZOb2RlU3VtbWFyeVZhbHVlLmNsYXNzTGlzdC5hZGQoXCJiaWYtY2VsbC1ub2RlLXN1bW1hcnktdmFsdWVcIik7XHJcblxyXG4gICAgICAgICAgICBjb25zdCBkaXZOb2RlU3VtbWFyeVZhbHVlVGV4dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICAgICAgICAgIGRpdk5vZGVTdW1tYXJ5VmFsdWUuYXBwZW5kQ2hpbGQoZGl2Tm9kZVN1bW1hcnlWYWx1ZVRleHQpO1xyXG4gICAgICAgICAgICBkaXZOb2RlU3VtbWFyeVZhbHVlVGV4dC5jbGFzc0xpc3QuYWRkKFwiYmlmLWNlbGwtbm9kZS1zdW1tYXJ5LXZhbHVlLXRleHRcIik7XHJcbiAgICAgICAgICAgIGRpdk5vZGVTdW1tYXJ5VmFsdWVUZXh0LnRpdGxlID0gZnYudmFsdWU7XHJcbiAgICAgICAgICAgIGRpdk5vZGVTdW1tYXJ5VmFsdWVUZXh0LmlubmVyVGV4dCA9IGZ2LnZhbHVlO1xyXG5cclxuICAgICAgICAgICAgaWYgKGlkeCA9PSAwKSB7XHJcbiAgICAgICAgICAgICAgLy8g5Yik5pat5piv5ZCm6ZyA5re75Yqg54K55Ye75LqL5Lu2XHJcbiAgICAgICAgICAgICAgY29uc3QganFtID0gdGhpcy5iaWxsSW5mby5qb2ludFF1ZXJ5TW9kZTtcclxuICAgICAgICAgICAgICBjb25zdCBqcXA6IEpvaW50UXVlcnlQYXJhbWV0ZXJzID0gSlNPTi5wYXJzZSh0aGlzLmJpbGxJbmZvLmpvaW50UXVlcnlQYXJhbWV0ZXJzKTtcclxuICAgICAgICAgICAgICBpZiAoKGpxbSA9PSBKb2ludFF1ZXJ5TW9kZS5BUFAgJiYganFwLmZ1bmNJZCkgfHwgKGpxbSA9PSBKb2ludFF1ZXJ5TW9kZS5VUkwgJiYganFwLnVybCkpIHtcclxuICAgICAgICAgICAgICAgIGRpdk5vZGVTdW1tYXJ5VmFsdWVUZXh0LmNsYXNzTGlzdC5hZGQoXCJiaWYtY2VsbC1ub2RlLXRpdGxlLWxpbmtcIiwgXCJiaWYtY2VsbC1ub2RlLXRpdGxlLWxpbmstY29sb3JcIik7XHJcbiAgICAgICAgICAgICAgICBteEV2ZW50LmFkZExpc3RlbmVyKGRpdk5vZGVTdW1tYXJ5VmFsdWVUZXh0LCBcImNsaWNrXCIsICgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgZ3JhcGguZmlyZUV2ZW50KG5ldyBteEV2ZW50T2JqZWN0KEV2ZW50cy5DTElDS19GSVJTVF9TVU1NQVJZLCBcImNlbGxcIiwgdGhpcykpO1xyXG4gICAgICAgICAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcclxuICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgKTtcclxuICAgICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoZSk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIOaTjeS9nOaMiemSrlxyXG4gICAgICBjb25zdCBkaXZOb2RlQnRuR3JvdXAgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xyXG4gICAgICBkaXZOb2RlTWFpbi5hcHBlbmRDaGlsZChkaXZOb2RlQnRuR3JvdXApO1xyXG4gICAgICBkaXZOb2RlQnRuR3JvdXAuY2xhc3NMaXN0LmFkZChcImJpZi1jZWxsLW5vZGUtYnRuLWdyb3VwXCIsIFwiYmlmLWNlbGwtbm9kZS1idG4tZ3JvdXAtY29udHJvbFwiKTtcclxuXHJcbiAgICAgIC8vIOivpuaDheaMiemSrlxyXG4gICAgICBjb25zdCBpbWdWaWV3ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImltZ1wiKTtcclxuICAgICAgZGl2Tm9kZUJ0bkdyb3VwLmFwcGVuZENoaWxkKGltZ1ZpZXcpO1xyXG4gICAgICBpbWdWaWV3LnNyYyA9IEJpbGxUcmFja2VyQ29uc3RhbnQuSU1BR0VfUEFUSCArIFwiL3ZpZXcuc3ZnXCI7XHJcbiAgICAgIGltZ1ZpZXcudGl0bGUgPSBncmFwaC5sb2NhbGVQaXBlLnRyYW5zZm9ybShcInZpZXdCaWxsXCIpO1xyXG4gICAgICBpbWdWaWV3LmNsYXNzTGlzdC5hZGQoXCJiaWYtY2VsbC1ub2RlLWJ0blwiKTtcclxuICAgICAgLy8g54K55Ye75oyJ6ZKu6Kem5Y+R6YCJ5Lit5LqL5Lu2XHJcbiAgICAgIGltZ1ZpZXcuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcclxuICAgICAgICBncmFwaC5zZXRTZWxlY3Rpb25DZWxsKHRoaXMpO1xyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIC8vIOS4jeaYr+W9k+WJjeiKgueCueaXtua3u+WKoOabtOWkmuaMiemSrlxyXG4gICAgICBpZiAoaXNFbnRyeSA9PSBmYWxzZSkge1xyXG4gICAgICAgIC8vIOabtOWkmuaMiemSrlxyXG4gICAgICAgIGNvbnN0IGltZ01vcmUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiaW1nXCIpO1xyXG4gICAgICAgIGRpdk5vZGVCdG5Hcm91cC5hcHBlbmRDaGlsZChpbWdNb3JlKTtcclxuICAgICAgICBpbWdNb3JlLnNyYyA9IEJpbGxUcmFja2VyQ29uc3RhbnQuSU1BR0VfUEFUSCArIFwiL21vcmUuc3ZnXCI7XHJcbiAgICAgICAgaW1nTW9yZS50aXRsZSA9IGdyYXBoLmxvY2FsZVBpcGUudHJhbnNmb3JtKFwibW9yZVwiKTtcclxuICAgICAgICBpbWdNb3JlLmNsYXNzTGlzdC5hZGQoXCJiaWYtY2VsbC1ub2RlLWJ0blwiKTtcclxuXHJcbiAgICAgICAgbXhFdmVudC5hZGRMaXN0ZW5lcihpbWdNb3JlLCBteEV2ZW50LkNMSUNLLCAoZXZ0OiBQb2ludGVyRXZlbnQpID0+IHtcclxuICAgICAgICAgIGNvbnN0IG9mZnNldCA9IG14VXRpbHMuZ2V0T2Zmc2V0KGltZ01vcmUpO1xyXG4gICAgICAgICAgLy8g56e76ZmkbW9yZSBob3ZlcuaViOaenFxyXG4gICAgICAgICAgZGl2Tm9kZUJ0bkdyb3VwLmNsYXNzTGlzdC5yZW1vdmUoXCJiaWYtY2VsbC1ub2RlLWJ0bi1ncm91cC1jb250cm9sXCIpO1xyXG4gICAgICAgICAgLy8g6YeN5YaZ6ZqQ6JeP6I+c5Y2V5pa55rOVXHJcbiAgICAgICAgICBjb25zdCBoaWRlTWVudSA9IGdyYXBoLm5nQ29tcC5tb3JlUG9wdXBNZW51LmhpZGVNZW51O1xyXG4gICAgICAgICAgZ3JhcGgubmdDb21wLm1vcmVQb3B1cE1lbnUuaGlkZU1lbnUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGhpZGVNZW51LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XHJcbiAgICAgICAgICAgIC8vIOmHjeaWsOa3u+WKoGhvdmVy5pWI5p6cXHJcbiAgICAgICAgICAgIGRpdk5vZGVCdG5Hcm91cC5jbGFzc0xpc3QuYWRkKFwiYmlmLWNlbGwtbm9kZS1idG4tZ3JvdXAtY29udHJvbFwiKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIC8vIOW8ueWHuuiPnOWNlVxyXG4gICAgICAgICAgZ3JhcGgubmdDb21wLm1vcmVQb3B1cE1lbnUucG9wdXAob2Zmc2V0LngsIG9mZnNldC55ICsgaW1nTW9yZS5vZmZzZXRIZWlnaHQsIHRoaXMsIGV2dCk7XHJcbiAgICAgICAgICAvLyDmm7TmlrDlvZPliY3miZPlvIDoj5zljZXlr7nosaFcclxuICAgICAgICAgIGdyYXBoLm5nQ29tcC5jdXJyZW50TWVudSA9IGdyYXBoLm5nQ29tcC5tb3JlUG9wdXBNZW51O1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gZGl2Tm9kZVJvb3Q7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDpgJrov4fmqKHmnb/lrZfnrKbkuLLmlrnlvI/liJvlu7podG1sXHJcbiAgICogQHBhcmFtIGdyYXBoXHJcbiAgICogQHJldHVybnNcclxuICAgKi9cclxuICBwcml2YXRlIGJ1aWxkSHRtbExhYmVsQnlUZW1wbGF0ZVRleHQoZ3JhcGg6IEdyYXBoKSB7XHJcbiAgICBjb25zdCBzdGF0ZSA9IGdyYXBoLnZpZXcuZ2V0U3RhdGUodGhpcyk7XHJcbiAgICBjb25zdCB3aWR0aCA9IHN0YXRlICYmIHN0YXRlLndpZHRoID8gc3RhdGUud2lkdGggOiB0aGlzLmdlb21ldHJ5LndpZHRoO1xyXG4gICAgY29uc3QgaGVpZ2h0ID0gc3RhdGUgJiYgc3RhdGUuaGVpZ2h0ID8gc3RhdGUuaGVpZ2h0IDogdGhpcy5nZW9tZXRyeS5oZWlnaHQ7XHJcbiAgICBsZXQgYnRzOiBCaWxsVHJhY2tpbmdTZXR0aW5ncyA9IG5ldyBCaWxsVHJhY2tpbmdTZXR0aW5ncygpO1xyXG4gICAgaWYgKHRoaXMuYmlsbEluZm8gJiYgdGhpcy5iaWxsSW5mby5iaWxsVHJhY2tpbmdTZXR0aW5ncykge1xyXG4gICAgICBidHMuTG9hZEZyb21Kc29uKHRoaXMuYmlsbEluZm8uYmlsbFRyYWNraW5nU2V0dGluZ3MpO1xyXG4gICAgfVxyXG4gICAgY29uc3QgdGl0bGUgPSB0aGlzLmJpbGxEYXRhSW5mby5jYXB0aW9uIHx8IGJ0cy5iaWxsTm9kZU5hbWUgfHwgdGhpcy5iaWxsSW5mby52b05hbWUgfHwgdGhpcy5iaWxsRGF0YUluZm8uZGF0YUlkIHx8IHRoaXMuYmlsbERhdGFJbmZvLnN1bW1hcnk7XHJcbiAgICBjb25zdCB0aXRsZUJhY2tncm91bmQgPSB0aGlzLmVudHJ5ID8gXCJyZ2JhKDg2LDE2MCwyNTUsMC4wOClcIiA6IFwiI0ZGRkZGRlwiO1xyXG5cclxuICAgIGxldCBzdW1tYXJ5SHRtbCA9IFwiXCI7XHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCBmaWVsZE5hbWVBbmRWYWx1ZXM6IEZpZWxkTmFtZUFuZFZhbHVlW10gPSBCcG1uTW9kZWxKc29uSGVscGVyLkZyb21Kc29uKHRoaXMuYmlsbERhdGFJbmZvLnN1bW1hcnksIEZpZWxkTmFtZUFuZFZhbHVlKTtcclxuICAgICAgZmllbGROYW1lQW5kVmFsdWVzICYmIGZpZWxkTmFtZUFuZFZhbHVlcy5mb3JFYWNoKFxyXG4gICAgICAgIChmdiwgaWR4KSA9PiB7XHJcbiAgICAgICAgICBsZXQgdmFsdWVUZXh0ID0gaWR4ID09IDAgPyBgPGEgaHJlZj0namF2YXNjcmlwdDp2b2lkKDApOyc+JHtmdi52YWx1ZX08L2E+YCA6IGZ2LnZhbHVlO1xyXG4gICAgICAgICAgc3VtbWFyeUh0bWwgKz0gYFxcXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJiaWYtY2VsbC1ub2RlLXN1bW1hcnlcIj5cXFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cImJpZi1jZWxsLW5vZGUtc3VtbWFyeS1jYXB0aW9uXCI+XFxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwiYmlmLWNlbGwtbm9kZS1zdW1tYXJ5LWNhcHRpb24tdGV4dFwiIHRpdGxlPVwiJHtmdi5uYW1lfVwiPiR7ZnYubmFtZX08L2Rpdj5cXFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+XFxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJiaWYtY2VsbC1ub2RlLXN1bW1hcnktdmFsdWVcIj5cXFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJiaWYtY2VsbC1ub2RlLXN1bW1hcnktdmFsdWUtdGV4dFwiIHRpdGxlPVwiJHtmdi52YWx1ZX1cIj4ke3ZhbHVlVGV4dH08L2Rpdj5cXFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+XFxcclxuICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+XFxcclxuICAgICAgICAgICAgICAgICAgICBgO1xyXG4gICAgICAgIH1cclxuICAgICAgKTtcclxuICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgY29uc29sZS5lcnJvcihlKTtcclxuICAgIH1cclxuICAgIGNvbnN0IGh0bWwgPSBgXFxcclxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cImJpZi1jZWxsLW5vZGVcIiBzdHlsZT1cIndpZHRoOiR7d2lkdGh9cHg7XCI+XFxcclxuICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJiaWYtY2VsbC1ub2RlLW1haW5cIiBzdHlsZT1cImJhY2tncm91bmQ6ICR7dGl0bGVCYWNrZ3JvdW5kfTtcIj5cXFxyXG4gICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJiaWYtY2VsbC1ub2RlLXRpdGxlXCI+XFxcclxuICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cImJpZi1jZWxsLW5vZGUtdGl0bGUtdGV4dFwiPiR7dGl0bGV9PC9kaXY+XFxcclxuICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cXFxyXG4gICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJiaWYtY2VsbC1ub2RlLXN1bW1hcnktbGlzdFwiIHN0eWxlPVwibWluLWhlaWdodDogJHtoZWlnaHQgLSAzMH1weDtcIj5cXFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAke3N1bW1hcnlIdG1sfVxcXHJcbiAgICAgICAgICAgICAgICAgICAgPC9kaXY+XFxcclxuICAgICAgICAgICAgICAgIDwvZGl2PlxcXHJcbiAgICAgICAgICAgIDwvZGl2PlxcXHJcbiAgICAgICAgYDtcclxuICAgIHJldHVybiBodG1sO1xyXG4gIH1cclxufVxyXG4iXX0=
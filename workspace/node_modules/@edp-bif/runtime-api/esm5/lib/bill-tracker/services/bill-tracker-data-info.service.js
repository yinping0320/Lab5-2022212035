/**
 * @fileoverview added by tsickle
 * Generated from: lib/bill-tracker/services/bill-tracker-data-info.service.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Injectable } from "@angular/core";
import { BpmnModelJsonHelper, DataType } from "@edp-aif/common-api";
import { BillTrackingDataShownMode, BillTrackingSettings, fullPathPrefix } from "@edp-bif/common-api";
import { Exceptions } from "../../entity/tracking/Exceptions";
var BillTrackerDataInfoService = /** @class */ (function () {
    function BillTrackerDataInfoService() {
    }
    /**
     * 判断BillTrackingSettings是旧版还是新版
     * @param bts
     * @returns
     */
    /**
     * 判断BillTrackingSettings是旧版还是新版
     * @param {?} bts
     * @return {?}
     */
    BillTrackerDataInfoService.prototype.isNewBTS = /**
     * 判断BillTrackingSettings是旧版还是新版
     * @param {?} bts
     * @return {?}
     */
    function (bts) {
        if (typeof bts == "string") {
            /** @type {?} */
            var temp = new BillTrackingSettings();
            temp.LoadFromJson(bts);
            bts = temp;
        }
        return bts != null && bts.version === "1.0";
    };
    /**
     * @param {?} rows
     * @param {?} shownFields
     * @param {?} wholeFields
     * @param {?} idField
     * @return {?}
     */
    BillTrackerDataInfoService.prototype.extractDataRows = /**
     * @param {?} rows
     * @param {?} shownFields
     * @param {?} wholeFields
     * @param {?} idField
     * @return {?}
     */
    function (rows, shownFields, wholeFields, idField) {
        var _this = this;
        var e_1, _a;
        /** @type {?} */
        var frows = [];
        var _loop_1 = function (row) {
            /** @type {?} */
            var obj = {};
            obj[idField] = row.dataId;
            // 先解析其他类型字段
            /** @type {?} */
            var decimalFFs = [];
            shownFields.forEach((/**
             * @param {?} f
             * @return {?}
             */
            function (f) {
                if (f.dataType == DataType.Decimal) {
                    decimalFFs.push(f);
                }
                else {
                    obj[f.fieldPath] = _this.getFieldValue(f, row.GetFieldMap(), wholeFields);
                }
            }));
            // 再解析浮点型字段
            decimalFFs.forEach((/**
             * @param {?} f
             * @return {?}
             */
            function (f) {
                obj[f.fieldPath] = _this.getFieldValue(f, row.GetFieldMap(), wholeFields);
            }));
            frows.push(obj);
        };
        try {
            for (var rows_1 = tslib_1.__values(rows), rows_1_1 = rows_1.next(); !rows_1_1.done; rows_1_1 = rows_1.next()) {
                var row = rows_1_1.value;
                _loop_1(row);
            }
        }
        catch (e_1_1) { e_1 = { error: e_1_1 }; }
        finally {
            try {
                if (rows_1_1 && !rows_1_1.done && (_a = rows_1.return)) _a.call(rows_1);
            }
            finally { if (e_1) throw e_1.error; }
        }
        return frows;
    };
    /**
     * @param {?} field
     * @return {?}
     */
    BillTrackerDataInfoService.prototype.extractCaptionPath = /**
     * @param {?} field
     * @return {?}
     */
    function (field) {
        /** @type {?} */
        var s = field.caption;
        /** @type {?} */
        var tmp = (/** @type {?} */ (field));
        while (tmp.attachedField != null) {
            s = tmp.attachedField.caption + "." + s;
            tmp = (/** @type {?} */ (tmp.attachedField));
        }
        return s;
    };
    /**
     * @param {?} field
     * @return {?}
     */
    BillTrackerDataInfoService.prototype.extractFieldPath = /**
     * @param {?} field
     * @return {?}
     */
    function (field) {
        /** @type {?} */
        var s = field.fieldName;
        /** @type {?} */
        var tmp = (/** @type {?} */ (field));
        while (tmp.attachedField != null) {
            s = tmp.attachedField.fieldName + "." + s;
            tmp = (/** @type {?} */ (tmp.attachedField));
        }
        return s;
    };
    /**
     *
     * @param fields 子字段列表
     * @param selectedFields 用户自定义展示字段列表
     * @param showCustomFields 是否按用户自定义字段显示
     * @returns
     */
    /**
     *
     * @param {?} fields 子字段列表
     * @param {?} selectedFields 用户自定义展示字段列表
     * @param {?} showCustomFields 是否按用户自定义字段显示
     * @return {?}
     */
    BillTrackerDataInfoService.prototype.extractFFields = /**
     *
     * @param {?} fields 子字段列表
     * @param {?} selectedFields 用户自定义展示字段列表
     * @param {?} showCustomFields 是否按用户自定义字段显示
     * @return {?}
     */
    function (fields, selectedFields, showCustomFields) {
        var _this = this;
        /** @type {?} */
        var ffields = [];
        fields.forEach((/**
         * @param {?} f
         * @return {?}
         */
        function (f) {
            f.show = true;
            //枚举或者枚举型单值UDT时默认取Name
            if (f.fieldType == "Enum" || f.fieldType == "EnumSingleUdt") {
                /** @type {?} */
                var tempFPath_1 = _this.extractFieldPath(f);
                /** @type {?} */
                var sf = null;
                if (showCustomFields) {
                    // 如果字段不在已配置字段列表中则跳过
                    sf = selectedFields.find((/**
                     * @param {?} sfield
                     * @return {?}
                     */
                    function (sfield) { return sfield.fieldPath == tempFPath_1; }));
                    if (sf == null) {
                        f.show = false;
                    }
                }
                f = (/** @type {?} */ (_this.setExtendProps(f, sf, tempFPath_1 + ".Name")));
                ffields.push(f);
            }
            else if (f.GetSubFieldList() != null && f.GetSubFieldList().length > 0) {
                ffields.push.apply(ffields, tslib_1.__spread(_this.extractFFields(f.GetSubFieldList(), selectedFields, showCustomFields)));
            }
            else {
                /** @type {?} */
                var tempFPath_2 = _this.extractFieldPath(f);
                /** @type {?} */
                var sf = null;
                if (showCustomFields) {
                    // 如果字段不在已配置字段列表中则跳过
                    sf = selectedFields.find((/**
                     * @param {?} sfield
                     * @return {?}
                     */
                    function (sfield) { return sfield.fieldPath == tempFPath_2; }));
                    if (sf == null) {
                        f.show = false;
                    }
                }
                f = (/** @type {?} */ (_this.setExtendProps(f, sf, tempFPath_2)));
                ffields.push(f);
            }
        }));
        return ffields;
    };
    /**
     * 判定有子数据的条件为：子表可显示，且子表有数据
     */
    /**
     * 判定有子数据的条件为：子表可显示，且子表有数据
     * @param {?} row
     * @param {?} billInfo
     * @return {?}
     */
    BillTrackerDataInfoService.prototype.hasChildData = /**
     * 判定有子数据的条件为：子表可显示，且子表有数据
     * @param {?} row
     * @param {?} billInfo
     * @return {?}
     */
    function (row, billInfo) {
        var e_2, _a;
        /** @type {?} */
        var hasChildData = false;
        /** @type {?} */
        var schema = this.getBillTrackerSchema(billInfo);
        /** @type {?} */
        var children = row.GetChildTableList();
        try {
            for (var children_1 = tslib_1.__values(children), children_1_1 = children_1.next(); !children_1_1.done; children_1_1 = children_1.next()) {
                var c = children_1_1.value;
                /** @type {?} */
                var tableShow = false;
                /** @type {?} */
                var hasRows = false;
                /** @type {?} */
                var table = schema && schema[c.tableName];
                if (table != null && table.show != null) {
                    tableShow = table.show;
                }
                else {
                    // 兼容无show属性情形
                    tableShow = true;
                }
                if (c.GetRowList() && c.GetRowList().length > 0) {
                    hasRows = true;
                }
                hasChildData = tableShow && hasRows;
                if (hasChildData == true) {
                    break;
                }
            }
        }
        catch (e_2_1) { e_2 = { error: e_2_1 }; }
        finally {
            try {
                if (children_1_1 && !children_1_1.done && (_a = children_1.return)) _a.call(children_1);
            }
            finally { if (e_2) throw e_2.error; }
        }
        return hasChildData;
    };
    /**
     * @param {?} f
     * @param {?} rdfm
     * @param {?=} wholeFields
     * @return {?}
     */
    BillTrackerDataInfoService.prototype.getFieldValue = /**
     * @param {?} f
     * @param {?} rdfm
     * @param {?=} wholeFields
     * @return {?}
     */
    function (f, rdfm, wholeFields) {
        /** @type {?} */
        var fields = f.fieldPath ? f.fieldPath.split(".") : [f.fieldName];
        /** @type {?} */
        var bdf = fields && rdfm[fields[0]];
        for (var i = 1; bdf != null && i < fields.length; i++) {
            /** @type {?} */
            var temp = bdf.GetSubFieldMap();
            if (temp == null) {
                break;
            }
            bdf = temp[fields[i]];
        }
        /** @type {?} */
        var textValue = bdf ? bdf.GetTextValue() : "";
        if (textValue == null) {
            return null;
        }
        if (f.dataType == DataType.String) {
            if (f.formatInfo != null) {
                /** @type {?} */
                var stringMapFormatter = f.formatInfo.stringMapFormatter;
                if (stringMapFormatter != null) {
                    /** @type {?} */
                    var v = stringMapFormatter[textValue] || textValue;
                    f.fieldValue = v;
                    return v;
                }
                else {
                    f.fieldValue = textValue;
                    return textValue || "";
                }
            }
            else {
                f.fieldValue = textValue;
                return textValue || "";
            }
        }
        else if (f.dataType == DataType.Decimal) {
            /** @type {?} */
            var scale = f.scale;
            if (f.formatInfo != null) {
                if (f.formatInfo.scale != null) {
                    scale = f.formatInfo.scale;
                }
                if (f.formatInfo.enableScaleExpression) {
                    if (f.formatInfo.scaleExpression != null) {
                        /** @type {?} */
                        var scaleField = this.getFieldInFields(wholeFields, f.formatInfo.scaleExpression);
                        /** @type {?} */
                        var tmp = scaleField && parseInt(String(this.getFieldValue(scaleField, rdfm)));
                        // const tmp = parseInt(this.getFieldValueInFieldsWithValue(extactedFields, f.formatInfo.scaleExpression));
                        if (tmp != null) {
                            if (isNaN(tmp)) {
                                throw Exceptions.SCALE_FIELD_VALUE_IS_NAN;
                            }
                            scale = tmp;
                        }
                    }
                }
            }
            f.fieldValue = parseFloat(String(textValue));
            if (scale < 0) {
                scale = 0;
            }
            else if (scale > 100) {
                scale = 100;
            }
            /** @type {?} */
            var dec = parseFloat(String(textValue)).toFixed(scale).toString();
            return dec || "";
        }
        else if (f.dataType == DataType.Boolean) {
            if (textValue == "") {
                f.fieldValue = null;
                return textValue;
            }
            f.fieldValue = (/** @type {?} */ (JSON.parse(textValue)));
            return (/** @type {?} */ (JSON.parse(textValue)));
        }
        else if (f.dataType == DataType.DateTime) {
            /** @type {?} */
            var date = BpmnModelJsonHelper.DateTimeFromString(textValue);
            /** @type {?} */
            var formatter = "yyyy-MM-dd";
            formatter = f.formatInfo && f.formatInfo.dateFormatter || "yyyy-MM-dd";
            // if (f.fieldType == "DateTime") {
            //     formatter = f.formatInfo && f.formatInfo.dateFormatter || "yyyy-MM-dd HH:mm:ss.SSS";
            // } else if (f.fieldType == "Date") {
            //     formatter = f.formatInfo && f.formatInfo.dateFormatter || "yyyy-MM-dd";
            // } else {
            //     formatter = f.formatInfo && f.formatInfo.dateFormatter || "yyyy-MM-dd";
            // }
            f.fieldValue = date;
            return this.dateFormat(date, formatter);
        }
        else {
            f.fieldValue = textValue;
            return textValue || "";
        }
    };
    /**
     * 根据fullPath在字段列表中查找目标字段
     * @param fields
     * @param fullPath
     * @returns
     */
    /**
     * 根据fullPath在字段列表中查找目标字段
     * @param {?} fields
     * @param {?} fullPath
     * @return {?}
     */
    BillTrackerDataInfoService.prototype.getFieldInFields = /**
     * 根据fullPath在字段列表中查找目标字段
     * @param {?} fields
     * @param {?} fullPath
     * @return {?}
     */
    function (fields, fullPath) {
        var e_3, _a;
        /** @type {?} */
        var v = null;
        try {
            for (var fields_1 = tslib_1.__values(fields), fields_1_1 = fields_1.next(); !fields_1_1.done; fields_1_1 = fields_1.next()) {
                var fv = fields_1_1.value;
                /** @type {?} */
                var curFv = (/** @type {?} */ (fv));
                // 查找根字段
                /** @type {?} */
                var tmpFv = fv;
                while (tmpFv.attachedField) {
                    tmpFv = tmpFv.attachedField;
                }
                /** @type {?} */
                var rootFv = (/** @type {?} */ (tmpFv));
                // 更新fullPath
                curFv.fullPath = fullPathPrefix + rootFv.attachedTable.tableName + "." + curFv.fieldPath;
                // 对比当前字段fullPath与目标fullPath
                if (fullPath == curFv.fullPath) {
                    v = curFv;
                    break;
                }
                // 递归查找子字段
                /** @type {?} */
                var subFlds = curFv.GetSubFieldList();
                if (subFlds && subFlds.length > 0) {
                    v = this.getFieldInFields(subFlds, fullPath);
                    if (v != null) {
                        break;
                    }
                }
            }
        }
        catch (e_3_1) { e_3 = { error: e_3_1 }; }
        finally {
            try {
                if (fields_1_1 && !fields_1_1.done && (_a = fields_1.return)) _a.call(fields_1);
            }
            finally { if (e_3) throw e_3.error; }
        }
        return v;
    };
    /**
     * @param {?} fieldsWithValue
     * @param {?} fullPath
     * @return {?}
     */
    BillTrackerDataInfoService.prototype.getFieldValueInFieldsWithValue = /**
     * @param {?} fieldsWithValue
     * @param {?} fullPath
     * @return {?}
     */
    function (fieldsWithValue, fullPath) {
        var e_4, _a;
        /** @type {?} */
        var v = null;
        try {
            for (var fieldsWithValue_1 = tslib_1.__values(fieldsWithValue), fieldsWithValue_1_1 = fieldsWithValue_1.next(); !fieldsWithValue_1_1.done; fieldsWithValue_1_1 = fieldsWithValue_1.next()) {
                var fv = fieldsWithValue_1_1.value;
                while (fv.attachedField) {
                    fv = fv.attachedField;
                }
                /** @type {?} */
                var rootFv = (/** @type {?} */ (fv));
                rootFv.fullPath = fullPathPrefix + rootFv.attachedTable.tableName + "." + rootFv.fieldPath;
                if (fullPath == rootFv.fullPath) {
                    v = rootFv.fieldValue;
                    break;
                }
            }
        }
        catch (e_4_1) { e_4 = { error: e_4_1 }; }
        finally {
            try {
                if (fieldsWithValue_1_1 && !fieldsWithValue_1_1.done && (_a = fieldsWithValue_1.return)) _a.call(fieldsWithValue_1);
            }
            finally { if (e_4) throw e_4.error; }
        }
        return v;
    };
    /**
     * @param {?} billInfo
     * @param {?} schemaTable
     * @param {?} dataTable
     * @param {?=} filterFields
     * @return {?}
     */
    BillTrackerDataInfoService.prototype.getBasicInfoFieldsWithValue = /**
     * @param {?} billInfo
     * @param {?} schemaTable
     * @param {?} dataTable
     * @param {?=} filterFields
     * @return {?}
     */
    function (billInfo, schemaTable, dataTable, filterFields) {
        var _this = this;
        if (filterFields === void 0) { filterFields = true; }
        /** @type {?} */
        var fieldsWithValue = [];
        // 单据追踪配置
        /** @type {?} */
        var bts = new BillTrackingSettings();
        if (billInfo && billInfo.billTrackingSettings) {
            bts.LoadFromJson(billInfo.billTrackingSettings);
        }
        /** @type {?} */
        var schema = this.getBillTrackerSchema(billInfo);
        /** @type {?} */
        var selectedFields = schema && schema[schemaTable.tableName] && schema[schemaTable.tableName].fields;
        selectedFields = selectedFields ? selectedFields : [];
        /** @type {?} */
        var showCustomFields = bts.billTrackingDataShownMode === BillTrackingDataShownMode.CUSTOMFIELD;
        // 所有字段
        /** @type {?} */
        var fs = schemaTable.getFieldList();
        /** @type {?} */
        var r = dataTable.GetRowList()[0];
        // 主表字段
        /** @type {?} */
        var rdfm = r.GetFieldMap();
        // 提取展示字段
        /** @type {?} */
        var ffs = this.extractFFields(fs, selectedFields, showCustomFields);
        // 获取字段值
        // 先解析其他类型字段
        /** @type {?} */
        var decimalFfs = [];
        ffs.forEach((/**
         * @param {?} ff
         * @return {?}
         */
        function (ff) {
            if (ff.dataType == DataType.Decimal) {
                decimalFfs.push(ff);
            }
            else {
                ff.fieldValue = _this.getFieldValue(ff, rdfm);
            }
        }));
        // 再解析浮点数字段
        decimalFfs.forEach((/**
         * @param {?} ff
         * @return {?}
         */
        function (ff) {
            ff.fieldValue = _this.getFieldValue(ff, rdfm, fs);
        }));
        fieldsWithValue.push.apply(fieldsWithValue, tslib_1.__spread(ffs));
        return fieldsWithValue;
    };
    /**
     * @param {?} f
     * @param {?} sf
     * @param {?} fieldPath
     * @param {?=} rdfm
     * @return {?}
     */
    BillTrackerDataInfoService.prototype.setExtendProps = /**
     * @param {?} f
     * @param {?} sf
     * @param {?} fieldPath
     * @param {?=} rdfm
     * @return {?}
     */
    function (f, sf, fieldPath, rdfm) {
        f.captionPath = this.extractCaptionPath(f);
        f.fieldPath = fieldPath;
        if (sf) {
            f.displayName = sf.displayName;
            f.i18nCols = sf.i18nCols;
            f.formatInfo = sf.formatInfo;
            f.order = sf.order;
        }
        if (rdfm) {
            f.fieldValue = this.getFieldValue(f, rdfm);
        }
        return f;
    };
    /**
     * 字段列表按order属性排序
     * @param fieldsWithValue
     * @returns
     */
    /**
     * 字段列表按order属性排序
     * @param {?} fieldsWithValue
     * @return {?}
     */
    BillTrackerDataInfoService.prototype.sortFieldsByOrder = /**
     * 字段列表按order属性排序
     * @param {?} fieldsWithValue
     * @return {?}
     */
    function (fieldsWithValue) {
        return fieldsWithValue.sort((/**
         * @param {?} a
         * @param {?} b
         * @return {?}
         */
        function (a, b) {
            if (a.order != null && b.order != null) {
                return a.order - b.order;
            }
            else if (a.order != null && b.order == null) {
                return -1;
            }
            else if (a.order == null && b.order != null) {
                return 1;
            }
            else {
                return 0;
            }
        }));
    };
    /**
     * @param {?} date
     * @param {?} fmt
     * @return {?}
     */
    BillTrackerDataInfoService.prototype.dateFormat = /**
     * @param {?} date
     * @param {?} fmt
     * @return {?}
     */
    function (date, fmt) {
        /** @type {?} */
        var ret;
        /** @type {?} */
        var opt = {
            "y+": date.getUTCFullYear().toString(),
            // 年
            "M+": (date.getUTCMonth() + 1).toString(),
            // 月
            "d+": date.getUTCDate().toString(),
            // 日
            "H+": date.getUTCHours().toString(),
            // 时
            "m+": date.getUTCMinutes().toString(),
            // 分
            "s+": date.getUTCSeconds().toString(),
            // 秒
            "S+": date.getUTCMilliseconds().toString(),
        };
        for (var k in opt) {
            ret = new RegExp("(" + k + ")").exec(fmt);
            if (ret) {
                if (!String.prototype.padStart) {
                    fmt = fmt.replace(ret[1], (ret[1].length == 1) ? (opt[k]) : (this.myPadStart(opt[k], ret[1].length, "0")));
                }
                else {
                    fmt = fmt.replace(ret[1], (ret[1].length == 1) ? (opt[k]) : (opt[k].padStart(ret[1].length, "0")));
                }
            }
        }
        return fmt;
    };
    /**
     * @param {?} src
     * @param {?} targetLength
     * @param {?} padString
     * @return {?}
     */
    BillTrackerDataInfoService.prototype.myPadStart = /**
     * @param {?} src
     * @param {?} targetLength
     * @param {?} padString
     * @return {?}
     */
    function (src, targetLength, padString) {
        targetLength = targetLength >> 0; //floor if number or convert non-number to 0;
        padString = String(typeof padString !== 'undefined' ? padString : ' ');
        if (src.length > targetLength) {
            return String(src);
        }
        else {
            targetLength = targetLength - src.length;
            if (targetLength > padString.length) {
                padString += padString.repeat(targetLength / padString.length); //append to original to ensure we are longer than needed
            }
            return padString.slice(0, targetLength) + String(src);
        }
    };
    /**
     * 解析字段名称
     * @param f
     * @param langCode
     * @returns
     */
    /**
     * 解析字段名称
     * @param {?} f
     * @param {?=} langCode
     * @return {?}
     */
    BillTrackerDataInfoService.prototype.getFieldLabel = /**
     * 解析字段名称
     * @param {?} f
     * @param {?=} langCode
     * @return {?}
     */
    function (f, langCode) {
        return (langCode && f.i18nCols && f.i18nCols.colI18nValues.displayName &&
            f.i18nCols.colI18nValues.displayName[langCode]) || f.displayName || f.captionPath || f.caption;
    };
    /**
     * 解析表名称
     */
    /**
     * 解析表名称
     * @param {?} billInfo
     * @param {?} schemaTable
     * @param {?=} langCode
     * @return {?}
     */
    BillTrackerDataInfoService.prototype.getTableLabel = /**
     * 解析表名称
     * @param {?} billInfo
     * @param {?} schemaTable
     * @param {?=} langCode
     * @return {?}
     */
    function (billInfo, schemaTable, langCode) {
        /** @type {?} */
        var schema = this.getBillTrackerSchema(billInfo);
        /** @type {?} */
        var table = schema && schema[schemaTable.tableName];
        if (table != null) {
            /** @type {?} */
            var i18nCols = table.i18nCols;
            /** @type {?} */
            var tmp = (langCode && i18nCols && i18nCols.colI18nValues.displayName && i18nCols.colI18nValues.displayName[langCode]) || table.displayName || table.caption || table.code;
            return tmp;
        }
        else {
            return schemaTable.caption;
        }
    };
    /**
     * 获取解析可展示子表
     */
    /**
     * 获取解析可展示子表
     * @param {?} billInfo
     * @param {?} schemaTable
     * @return {?}
     */
    BillTrackerDataInfoService.prototype.getChildTables = /**
     * 获取解析可展示子表
     * @param {?} billInfo
     * @param {?} schemaTable
     * @return {?}
     */
    function (billInfo, schemaTable) {
        /** @type {?} */
        var result = [];
        /** @type {?} */
        var schema = this.getBillTrackerSchema(billInfo);
        /** @type {?} */
        var children = schemaTable.GetChildTableList();
        children && children.forEach((/**
         * @param {?} child
         * @return {?}
         */
        function (child) {
            /** @type {?} */
            var trackerTable = schema && schema[child.tableName];
            if (trackerTable != null && trackerTable.show != null) {
                if (trackerTable.show == true) {
                    child.order = trackerTable.order;
                    result.push(child);
                }
            }
            else {
                // 兼容无show属性情形
                result.push(child);
            }
        }));
        result = this.sortTablesByOrder(result);
        return result;
    };
    /**
     * 表按sort字段排序
     * @param schemaTables
     * @returns
     */
    /**
     * 表按sort字段排序
     * @param {?} schemaTables
     * @return {?}
     */
    BillTrackerDataInfoService.prototype.sortTablesByOrder = /**
     * 表按sort字段排序
     * @param {?} schemaTables
     * @return {?}
     */
    function (schemaTables) {
        return schemaTables.sort((/**
         * @param {?} a
         * @param {?} b
         * @return {?}
         */
        function (a, b) {
            if (a.order != null && b.order != null) {
                return a.order - b.order;
            }
            else if (a.order != null && b.order == null) {
                return -1;
            }
            else if (a.order == null && b.order != null) {
                return 1;
            }
            else {
                return 0;
            }
        }));
    };
    /**
     * 解析billTrackerSchema
     * @param billInfo
     */
    /**
     * 解析billTrackerSchema
     * @param {?} billInfo
     * @return {?}
     */
    BillTrackerDataInfoService.prototype.getBillTrackerSchema = /**
     * 解析billTrackerSchema
     * @param {?} billInfo
     * @return {?}
     */
    function (billInfo) {
        /** @type {?} */
        var bts = new BillTrackingSettings();
        if (billInfo && billInfo.billTrackingSettings) {
            bts.LoadFromJson(billInfo.billTrackingSettings);
        }
        /** @type {?} */
        var fieldContent = bts.customFieldContent;
        /** @type {?} */
        var fieldConfig = fieldContent && (typeof fieldContent == "object" ? fieldContent : JSON.parse(fieldContent));
        /** @type {?} */
        var schema = fieldConfig && fieldConfig.schema;
        return schema;
    };
    BillTrackerDataInfoService.decorators = [
        { type: Injectable }
    ];
    return BillTrackerDataInfoService;
}());
export { BillTrackerDataInfoService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmlsbC10cmFja2VyLWRhdGEtaW5mby5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGVkcC1iaWYvcnVudGltZS1hcGkvIiwic291cmNlcyI6WyJsaWIvYmlsbC10cmFja2VyL3NlcnZpY2VzL2JpbGwtdHJhY2tlci1kYXRhLWluZm8uc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzNDLE9BQU8sRUFBMEksbUJBQW1CLEVBQUUsUUFBUSxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDNU0sT0FBTyxFQUFvRCx5QkFBeUIsRUFBRSxvQkFBb0IsRUFBRSxjQUFjLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUV4SixPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sa0NBQWtDLENBQUM7QUFFOUQ7SUFBQTtJQTZkQSxDQUFDO0lBM2RDOzs7O09BSUc7Ozs7OztJQUNJLDZDQUFROzs7OztJQUFmLFVBQWdCLEdBQWtDO1FBQ2hELElBQUksT0FBTyxHQUFHLElBQUksUUFBUSxFQUFFOztnQkFDcEIsSUFBSSxHQUFHLElBQUksb0JBQW9CLEVBQUU7WUFDdkMsSUFBSSxDQUFDLFlBQVksQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUN2QixHQUFHLEdBQUcsSUFBSSxDQUFDO1NBQ1o7UUFFRCxPQUFPLEdBQUcsSUFBSSxJQUFJLElBQUksR0FBRyxDQUFDLE9BQU8sS0FBSyxLQUFLLENBQUM7SUFDOUMsQ0FBQzs7Ozs7Ozs7SUFFTSxvREFBZTs7Ozs7OztJQUF0QixVQUF1QixJQUFtQixFQUFFLFdBQWtDLEVBQUUsV0FBa0MsRUFBRSxPQUFlO1FBQW5JLGlCQXVCQzs7O1lBdEJLLEtBQUssR0FBRyxFQUFFO2dDQUNMLEdBQUc7O2dCQUNOLEdBQUcsR0FBRyxFQUFFO1lBQ1osR0FBRyxDQUFDLE9BQU8sQ0FBQyxHQUFHLEdBQUcsQ0FBQyxNQUFNLENBQUM7OztnQkFFcEIsVUFB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QUFDLENBQUE7SUFDSixDQUFDO0lBQ0Q7OztPQUdHOzs7Ozs7SUFDSSx5REFBb0I7Ozs7O0lBQTNCLFVBQTRCLFFBQWtCOztZQUN4QyxHQUFHLEdBQXlCLElBQUksb0JBQW9CLEVBQUU7UUFDMUQsSUFBSSxRQUFRLElBQUksUUFBUSxDQUFDLG9CQUFvQixFQUFFO1lBQzdDLEdBQUcsQ0FBQyxZQUFZLENBQUMsUUFBUSxDQUFDLG9CQUFvQixDQUFDLENBQUM7U0FDakQ7O1lBRUcsWUFBWSxHQUFHLEdBQUcsQ0FBQyxrQkFBa0I7O1lBQ3JDLFdBQVcsR0FBa0MsWUFBWSxJQUFJLENBQUMsT0FBTyxZQUFZLElBQUksUUFBUSxDQUFDLENBQUMsQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsWUFBWSxDQUFDLENBQUM7O1lBQ3hJLE1BQU0sR0FBRyxXQUFXLElBQUksV0FBVyxDQUFDLE1BQU07UUFFOUMsT0FBTyxNQUFNLENBQUM7SUFDaEIsQ0FBQzs7Z0JBNWRGLFVBQVU7O0lBNmRYLGlDQUFDO0NBQUEsQUE3ZEQsSUE2ZEM7U0E1ZFksMEJBQTBCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gXCJAYW5ndWxhci9jb3JlXCI7XHJcbmltcG9ydCB7IEJpbGxEYXRhRmllbGQsIEJpbGxEYXRhUm93LCBCaWxsRGF0YVN1YkZpZWxkLCBCaWxsRGF0YVRhYmxlLCBCaWxsU2NoZW1hRmllbGQsIEJpbGxTY2hlbWFGaWVsZEJhc2UsIEJpbGxTY2hlbWFTdWJGaWVsZCwgQmlsbFNjaGVtYVRhYmxlLCBCcG1uTW9kZWxKc29uSGVscGVyLCBEYXRhVHlwZSB9IGZyb20gXCJAZWRwLWFpZi9jb21tb24tYXBpXCI7XHJcbmltcG9ydCB7IEJpbGxUcmFja2VyU2NoZW1hLCBCaWxsVHJhY2tlclNjaGVtYUZpZWxkQ29udGVudCwgQmlsbFRyYWNraW5nRGF0YVNob3duTW9kZSwgQmlsbFRyYWNraW5nU2V0dGluZ3MsIGZ1bGxQYXRoUHJlZml4IH0gZnJvbSBcIkBlZHAtYmlmL2NvbW1vbi1hcGlcIjtcclxuaW1wb3J0IHsgQmlsbEluZm8gfSBmcm9tIFwiLi4vLi4vZW50aXR5L3RyYWNraW5nL0JpbGxJbmZvXCI7XHJcbmltcG9ydCB7IEV4Y2VwdGlvbnMgfSBmcm9tIFwiLi4vLi4vZW50aXR5L3RyYWNraW5nL0V4Y2VwdGlvbnNcIjtcclxuXHJcbkBJbmplY3RhYmxlKClcclxuZXhwb3J0IGNsYXNzIEJpbGxUcmFja2VyRGF0YUluZm9TZXJ2aWNlIHtcclxuICAvKipcclxuICAgKiDliKTmlq1CaWxsVHJhY2tpbmdTZXR0aW5nc+aYr+aXp+eJiOi/mOaYr+aWsOeJiFxyXG4gICAqIEBwYXJhbSBidHNcclxuICAgKiBAcmV0dXJuc1xyXG4gICAqL1xyXG4gIHB1YmxpYyBpc05ld0JUUyhidHM6IHN0cmluZyB8IEJpbGxUcmFja2luZ1NldHRpbmdzKTogYm9vbGVhbiB7XHJcbiAgICBpZiAodHlwZW9mIGJ0cyA9PSBcInN0cmluZ1wiKSB7XHJcbiAgICAgIGNvbnN0IHRlbXAgPSBuZXcgQmlsbFRyYWNraW5nU2V0dGluZ3MoKTtcclxuICAgICAgdGVtcC5Mb2FkRnJvbUpzb24oYnRzKTtcclxuICAgICAgYnRzID0gdGVtcDtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gYnRzICE9IG51bGwgJiYgYnRzLnZlcnNpb24gPT09IFwiMS4wXCI7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgZXh0cmFjdERhdGFSb3dzKHJvd3M6IEJpbGxEYXRhUm93W10sIHNob3duRmllbGRzOiBCaWxsU2NoZW1hRmllbGRCYXNlW10sIHdob2xlRmllbGRzOiBCaWxsU2NoZW1hRmllbGRCYXNlW10sIGlkRmllbGQ6IHN0cmluZykge1xyXG4gICAgbGV0IGZyb3dzID0gW107XHJcbiAgICBmb3IgKGxldCByb3cgb2Ygcm93cykge1xyXG4gICAgICBsZXQgb2JqID0ge307XHJcbiAgICAgIG9ialtpZEZpZWxkXSA9IHJvdy5kYXRhSWQ7XHJcbiAgICAgIC8vIOWFiOino+aekOWFtuS7luexu+Wei+Wtl+autVxyXG4gICAgICBjb25zdCBkZWNpbWFsRkZzID0gW107XHJcbiAgICAgIHNob3duRmllbGRzLmZvckVhY2goZiA9PiB7XHJcbiAgICAgICAgaWYgKGYuZGF0YVR5cGUgPT0gRGF0YVR5cGUuRGVjaW1hbCkge1xyXG4gICAgICAgICAgZGVjaW1hbEZGcy5wdXNoKGYpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICBvYmpbZi5maWVsZFBhdGhdID0gdGhpcy5nZXRGaWVsZFZhbHVlKGYsIHJvdy5HZXRGaWVsZE1hcCgpLCB3aG9sZUZpZWxkcyk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgICAgLy8g5YaN6Kej5p6Q5rWu54K55Z6L5a2X5q61XHJcbiAgICAgIGRlY2ltYWxGRnMuZm9yRWFjaChmID0+IHtcclxuICAgICAgICBvYmpbZi5maWVsZFBhdGhdID0gdGhpcy5nZXRGaWVsZFZhbHVlKGYsIHJvdy5HZXRGaWVsZE1hcCgpLCB3aG9sZUZpZWxkcyk7XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgZnJvd3MucHVzaChvYmopO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBmcm93cztcclxuICB9XHJcblxyXG4gIHB1YmxpYyBleHRyYWN0Q2FwdGlvblBhdGgoZmllbGQ6IEJpbGxTY2hlbWFGaWVsZCB8IEJpbGxTY2hlbWFTdWJGaWVsZCkge1xyXG4gICAgbGV0IHMgPSBmaWVsZC5jYXB0aW9uO1xyXG4gICAgbGV0IHRtcCA9IGZpZWxkIGFzIEJpbGxTY2hlbWFTdWJGaWVsZDtcclxuICAgIHdoaWxlICh0bXAuYXR0YWNoZWRGaWVsZCAhPSBudWxsKSB7XHJcbiAgICAgIHMgPSB0bXAuYXR0YWNoZWRGaWVsZC5jYXB0aW9uICsgXCIuXCIgKyBzO1xyXG4gICAgICB0bXAgPSB0bXAuYXR0YWNoZWRGaWVsZCBhcyBCaWxsU2NoZW1hU3ViRmllbGQ7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gcztcclxuICB9XHJcblxyXG4gIHB1YmxpYyBleHRyYWN0RmllbGRQYXRoKGZpZWxkOiBCaWxsU2NoZW1hRmllbGQgfCBCaWxsU2NoZW1hU3ViRmllbGQpIHtcclxuICAgIGxldCBzID0gZmllbGQuZmllbGROYW1lO1xyXG4gICAgbGV0IHRtcCA9IGZpZWxkIGFzIEJpbGxTY2hlbWFTdWJGaWVsZDtcclxuICAgIHdoaWxlICh0bXAuYXR0YWNoZWRGaWVsZCAhPSBudWxsKSB7XHJcbiAgICAgIHMgPSB0bXAuYXR0YWNoZWRGaWVsZC5maWVsZE5hbWUgKyBcIi5cIiArIHM7XHJcbiAgICAgIHRtcCA9IHRtcC5hdHRhY2hlZEZpZWxkIGFzIEJpbGxTY2hlbWFTdWJGaWVsZDtcclxuICAgIH1cclxuICAgIHJldHVybiBzO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICpcclxuICAgKiBAcGFyYW0gZmllbGRzIOWtkOWtl+auteWIl+ihqFxyXG4gICAqIEBwYXJhbSBzZWxlY3RlZEZpZWxkcyDnlKjmiLfoh6rlrprkuYnlsZXnpLrlrZfmrrXliJfooahcclxuICAgKiBAcGFyYW0gc2hvd0N1c3RvbUZpZWxkcyDmmK/lkKbmjInnlKjmiLfoh6rlrprkuYnlrZfmrrXmmL7npLpcclxuICAgKiBAcmV0dXJuc1xyXG4gICAqL1xyXG4gIHB1YmxpYyBleHRyYWN0RkZpZWxkcyhmaWVsZHM6IChCaWxsU2NoZW1hRmllbGQgfCBCaWxsU2NoZW1hU3ViRmllbGQpW10sIHNlbGVjdGVkRmllbGRzOiBCaWxsU2NoZW1hRmllbGRCYXNlW10sIHNob3dDdXN0b21GaWVsZHM6IGJvb2xlYW4pOiAoQmlsbFNjaGVtYUZpZWxkIHwgQmlsbFNjaGVtYVN1YkZpZWxkKVtdIHtcclxuICAgIGxldCBmZmllbGRzOiAoQmlsbFNjaGVtYUZpZWxkIHwgQmlsbFNjaGVtYVN1YkZpZWxkKVtdID0gW107XHJcbiAgICBmaWVsZHMuZm9yRWFjaChmID0+IHtcclxuICAgICAgZi5zaG93ID0gdHJ1ZTtcclxuICAgICAgLy/mnprkuL7miJbogIXmnprkuL7lnovljZXlgLxVRFTml7bpu5jorqTlj5ZOYW1lXHJcbiAgICAgIGlmIChmLmZpZWxkVHlwZSA9PSBcIkVudW1cIiB8fCBmLmZpZWxkVHlwZSA9PSBcIkVudW1TaW5nbGVVZHRcIikge1xyXG4gICAgICAgIGNvbnN0IHRlbXBGUGF0aCA9IHRoaXMuZXh0cmFjdEZpZWxkUGF0aChmKTtcclxuXHJcbiAgICAgICAgbGV0IHNmID0gbnVsbDtcclxuICAgICAgICBpZiAoc2hvd0N1c3RvbUZpZWxkcykge1xyXG4gICAgICAgICAgLy8g5aaC5p6c5a2X5q615LiN5Zyo5bey6YWN572u5a2X5q615YiX6KGo5Lit5YiZ6Lez6L+HXHJcbiAgICAgICAgICBzZiA9IHNlbGVjdGVkRmllbGRzLmZpbmQoKHNmaWVsZCkgPT4gc2ZpZWxkLmZpZWxkUGF0aCA9PSB0ZW1wRlBhdGgpO1xyXG4gICAgICAgICAgaWYgKHNmID09IG51bGwpIHtcclxuICAgICAgICAgICAgZi5zaG93ID0gZmFsc2U7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmID0gdGhpcy5zZXRFeHRlbmRQcm9wcyhmLCBzZiwgdGVtcEZQYXRoICsgXCIuTmFtZVwiKSBhcyBCaWxsU2NoZW1hU3ViRmllbGQ7XHJcblxyXG4gICAgICAgIGZmaWVsZHMucHVzaChmKTtcclxuICAgICAgfSBlbHNlIGlmIChmLkdldFN1YkZpZWxkTGlzdCgpICE9IG51bGwgJiYgZi5HZXRTdWJGaWVsZExpc3QoKS5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgZmZpZWxkcy5wdXNoKC4uLnRoaXMuZXh0cmFjdEZGaWVsZHMoZi5HZXRTdWJGaWVsZExpc3QoKSwgc2VsZWN0ZWRGaWVsZHMsIHNob3dDdXN0b21GaWVsZHMpKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBjb25zdCB0ZW1wRlBhdGggPSB0aGlzLmV4dHJhY3RGaWVsZFBhdGgoZik7XHJcblxyXG4gICAgICAgIGxldCBzZiA9IG51bGw7XHJcbiAgICAgICAgaWYgKHNob3dDdXN0b21GaWVsZHMpIHtcclxuICAgICAgICAgIC8vIOWmguaenOWtl+auteS4jeWcqOW3sumFjee9ruWtl+auteWIl+ihqOS4reWImei3s+i/h1xyXG4gICAgICAgICAgc2YgPSBzZWxlY3RlZEZpZWxkcy5maW5kKChzZmllbGQpID0+IHNmaWVsZC5maWVsZFBhdGggPT0gdGVtcEZQYXRoKTtcclxuICAgICAgICAgIGlmIChzZiA9PSBudWxsKSB7XHJcbiAgICAgICAgICAgIGYuc2hvdyA9IGZhbHNlO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZiA9IHRoaXMuc2V0RXh0ZW5kUHJvcHMoZiwgc2YsIHRlbXBGUGF0aCkgYXMgQmlsbFNjaGVtYVN1YkZpZWxkO1xyXG5cclxuICAgICAgICBmZmllbGRzLnB1c2goZik7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG5cclxuICAgIHJldHVybiBmZmllbGRzO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5Yik5a6a5pyJ5a2Q5pWw5o2u55qE5p2h5Lu25Li677ya5a2Q6KGo5Y+v5pi+56S677yM5LiU5a2Q6KGo5pyJ5pWw5o2uXHJcbiAgICovXHJcbiAgcHVibGljIGhhc0NoaWxkRGF0YShyb3c6IEJpbGxEYXRhUm93LCBiaWxsSW5mbzogQmlsbEluZm8pIHtcclxuICAgIGxldCBoYXNDaGlsZERhdGEgPSBmYWxzZTtcclxuXHJcbiAgICBjb25zdCBzY2hlbWEgPSB0aGlzLmdldEJpbGxUcmFja2VyU2NoZW1hKGJpbGxJbmZvKTtcclxuICAgIGxldCBjaGlsZHJlbiA9IHJvdy5HZXRDaGlsZFRhYmxlTGlzdCgpO1xyXG4gICAgZm9yIChsZXQgYyBvZiBjaGlsZHJlbikge1xyXG4gICAgICBsZXQgdGFibGVTaG93ID0gZmFsc2U7XHJcbiAgICAgIGxldCBoYXNSb3dzID0gZmFsc2U7XHJcbiAgICAgIGxldCB0YWJsZSA9IHNjaGVtYSAmJiBzY2hlbWFbYy50YWJsZU5hbWVdO1xyXG4gICAgICBpZiAodGFibGUgIT0gbnVsbCAmJiB0YWJsZS5zaG93ICE9IG51bGwpIHtcclxuICAgICAgICB0YWJsZVNob3cgPSB0YWJsZS5zaG93O1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIC8vIOWFvOWuueaXoHNob3flsZ7mgKfmg4XlvaJcclxuICAgICAgICB0YWJsZVNob3cgPSB0cnVlO1xyXG4gICAgICB9XHJcbiAgICAgIGlmIChjLkdldFJvd0xpc3QoKSAmJiBjLkdldFJvd0xpc3QoKS5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgaGFzUm93cyA9IHRydWU7XHJcbiAgICAgIH1cclxuICAgICAgaGFzQ2hpbGREYXRhID0gdGFibGVTaG93ICYmIGhhc1Jvd3M7XHJcbiAgICAgIGlmIChoYXNDaGlsZERhdGEgPT0gdHJ1ZSkge1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gaGFzQ2hpbGREYXRhO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGdldEZpZWxkVmFsdWUoZjogQmlsbFNjaGVtYUZpZWxkQmFzZSwgcmRmbTogeyBba2V5OiBzdHJpbmddOiBCaWxsRGF0YUZpZWxkOyB9LCB3aG9sZUZpZWxkcz86IEJpbGxTY2hlbWFGaWVsZEJhc2VbXSkge1xyXG4gICAgbGV0IGZpZWxkcyA9IGYuZmllbGRQYXRoID8gZi5maWVsZFBhdGguc3BsaXQoXCIuXCIpIDogW2YuZmllbGROYW1lXTtcclxuXHJcbiAgICBsZXQgYmRmOiBCaWxsRGF0YUZpZWxkIHwgQmlsbERhdGFTdWJGaWVsZCA9IGZpZWxkcyAmJiByZGZtW2ZpZWxkc1swXV07XHJcbiAgICBmb3IgKGxldCBpID0gMTsgYmRmICE9IG51bGwgJiYgaSA8IGZpZWxkcy5sZW5ndGg7IGkrKykge1xyXG4gICAgICBjb25zdCB0ZW1wID0gYmRmLkdldFN1YkZpZWxkTWFwKCk7XHJcbiAgICAgIGlmICh0ZW1wID09IG51bGwpIHtcclxuICAgICAgICBicmVhaztcclxuICAgICAgfVxyXG4gICAgICBiZGYgPSB0ZW1wW2ZpZWxkc1tpXV07XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgdGV4dFZhbHVlID0gYmRmID8gYmRmLkdldFRleHRWYWx1ZSgpIDogXCJcIjtcclxuICAgIGlmICh0ZXh0VmFsdWUgPT0gbnVsbCkge1xyXG4gICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxuICAgIGlmIChmLmRhdGFUeXBlID09IERhdGFUeXBlLlN0cmluZykge1xyXG4gICAgICBpZiAoZi5mb3JtYXRJbmZvICE9IG51bGwpIHtcclxuICAgICAgICBjb25zdCBzdHJpbmdNYXBGb3JtYXR0ZXIgPSBmLmZvcm1hdEluZm8uc3RyaW5nTWFwRm9ybWF0dGVyO1xyXG4gICAgICAgIGlmIChzdHJpbmdNYXBGb3JtYXR0ZXIgIT0gbnVsbCkge1xyXG4gICAgICAgICAgY29uc3QgdiA9IHN0cmluZ01hcEZvcm1hdHRlclt0ZXh0VmFsdWVdIHx8IHRleHRWYWx1ZTtcclxuICAgICAgICAgIGYuZmllbGRWYWx1ZSA9IHY7XHJcbiAgICAgICAgICByZXR1cm4gdjtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgZi5maWVsZFZhbHVlID0gdGV4dFZhbHVlO1xyXG4gICAgICAgICAgcmV0dXJuIHRleHRWYWx1ZSB8fCBcIlwiO1xyXG4gICAgICAgIH1cclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBmLmZpZWxkVmFsdWUgPSB0ZXh0VmFsdWU7XHJcbiAgICAgICAgcmV0dXJuIHRleHRWYWx1ZSB8fCBcIlwiO1xyXG4gICAgICB9XHJcbiAgICB9IGVsc2UgaWYgKGYuZGF0YVR5cGUgPT0gRGF0YVR5cGUuRGVjaW1hbCkge1xyXG4gICAgICBsZXQgc2NhbGUgPSBmLnNjYWxlO1xyXG4gICAgICBpZiAoZi5mb3JtYXRJbmZvICE9IG51bGwpIHtcclxuICAgICAgICBpZiAoZi5mb3JtYXRJbmZvLnNjYWxlICE9IG51bGwpIHtcclxuICAgICAgICAgIHNjYWxlID0gZi5mb3JtYXRJbmZvLnNjYWxlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoZi5mb3JtYXRJbmZvLmVuYWJsZVNjYWxlRXhwcmVzc2lvbikge1xyXG4gICAgICAgICAgaWYgKGYuZm9ybWF0SW5mby5zY2FsZUV4cHJlc3Npb24gIT0gbnVsbCkge1xyXG4gICAgICAgICAgICBjb25zdCBzY2FsZUZpZWxkID0gdGhpcy5nZXRGaWVsZEluRmllbGRzKHdob2xlRmllbGRzLCBmLmZvcm1hdEluZm8uc2NhbGVFeHByZXNzaW9uKTtcclxuICAgICAgICAgICAgY29uc3QgdG1wID0gc2NhbGVGaWVsZCAmJiBwYXJzZUludChTdHJpbmcodGhpcy5nZXRGaWVsZFZhbHVlKHNjYWxlRmllbGQsIHJkZm0pKSk7XHJcbiAgICAgICAgICAgIC8vIGNvbnN0IHRtcCA9IHBhcnNlSW50KHRoaXMuZ2V0RmllbGRWYWx1ZUluRmllbGRzV2l0aFZhbHVlKGV4dGFjdGVkRmllbGRzLCBmLmZvcm1hdEluZm8uc2NhbGVFeHByZXNzaW9uKSk7XHJcbiAgICAgICAgICAgIGlmICh0bXAgIT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgIGlmIChpc05hTih0bXApKSB7XHJcbiAgICAgICAgICAgICAgICB0aHJvdyBFeGNlcHRpb25zLlNDQUxFX0ZJRUxEX1ZBTFVFX0lTX05BTjtcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgc2NhbGUgPSB0bXA7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgICAgZi5maWVsZFZhbHVlID0gcGFyc2VGbG9hdChTdHJpbmcodGV4dFZhbHVlKSk7XHJcbiAgICAgIGlmIChzY2FsZSA8IDApIHtcclxuICAgICAgICBzY2FsZSA9IDA7XHJcbiAgICAgIH0gZWxzZSBpZiAoc2NhbGUgPiAxMDApIHtcclxuICAgICAgICBzY2FsZSA9IDEwMDtcclxuICAgICAgfVxyXG4gICAgICBsZXQgZGVjID0gcGFyc2VGbG9hdChTdHJpbmcodGV4dFZhbHVlKSkudG9GaXhlZChzY2FsZSkudG9TdHJpbmcoKTtcclxuICAgICAgcmV0dXJuIGRlYyB8fCBcIlwiO1xyXG4gICAgfSBlbHNlIGlmIChmLmRhdGFUeXBlID09IERhdGFUeXBlLkJvb2xlYW4pIHtcclxuICAgICAgaWYgKHRleHRWYWx1ZSA9PSBcIlwiKSB7XHJcbiAgICAgICAgZi5maWVsZFZhbHVlID0gbnVsbDtcclxuICAgICAgICByZXR1cm4gdGV4dFZhbHVlO1xyXG4gICAgICB9XHJcbiAgICAgIGYuZmllbGRWYWx1ZSA9IEpTT04ucGFyc2UodGV4dFZhbHVlKSBhcyBib29sZWFuO1xyXG4gICAgICByZXR1cm4gSlNPTi5wYXJzZSh0ZXh0VmFsdWUpIGFzIGJvb2xlYW47XHJcbiAgICB9IGVsc2UgaWYgKGYuZGF0YVR5cGUgPT0gRGF0YVR5cGUuRGF0ZVRpbWUpIHtcclxuICAgICAgbGV0IGRhdGUgPSBCcG1uTW9kZWxKc29uSGVscGVyLkRhdGVUaW1lRnJvbVN0cmluZyh0ZXh0VmFsdWUpO1xyXG4gICAgICBsZXQgZm9ybWF0dGVyID0gXCJ5eXl5LU1NLWRkXCI7XHJcbiAgICAgIGZvcm1hdHRlciA9IGYuZm9ybWF0SW5mbyAmJiBmLmZvcm1hdEluZm8uZGF0ZUZvcm1hdHRlciB8fCBcInl5eXktTU0tZGRcIjtcclxuICAgICAgLy8gaWYgKGYuZmllbGRUeXBlID09IFwiRGF0ZVRpbWVcIikge1xyXG4gICAgICAvLyAgICAgZm9ybWF0dGVyID0gZi5mb3JtYXRJbmZvICYmIGYuZm9ybWF0SW5mby5kYXRlRm9ybWF0dGVyIHx8IFwieXl5eS1NTS1kZCBISDptbTpzcy5TU1NcIjtcclxuICAgICAgLy8gfSBlbHNlIGlmIChmLmZpZWxkVHlwZSA9PSBcIkRhdGVcIikge1xyXG4gICAgICAvLyAgICAgZm9ybWF0dGVyID0gZi5mb3JtYXRJbmZvICYmIGYuZm9ybWF0SW5mby5kYXRlRm9ybWF0dGVyIHx8IFwieXl5eS1NTS1kZFwiO1xyXG4gICAgICAvLyB9IGVsc2Uge1xyXG4gICAgICAvLyAgICAgZm9ybWF0dGVyID0gZi5mb3JtYXRJbmZvICYmIGYuZm9ybWF0SW5mby5kYXRlRm9ybWF0dGVyIHx8IFwieXl5eS1NTS1kZFwiO1xyXG4gICAgICAvLyB9XHJcbiAgICAgIGYuZmllbGRWYWx1ZSA9IGRhdGU7XHJcbiAgICAgIHJldHVybiB0aGlzLmRhdGVGb3JtYXQoZGF0ZSwgZm9ybWF0dGVyKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGYuZmllbGRWYWx1ZSA9IHRleHRWYWx1ZTtcclxuICAgICAgcmV0dXJuIHRleHRWYWx1ZSB8fCBcIlwiO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5qC55o2uZnVsbFBhdGjlnKjlrZfmrrXliJfooajkuK3mn6Xmib7nm67moIflrZfmrrVcclxuICAgKiBAcGFyYW0gZmllbGRzXHJcbiAgICogQHBhcmFtIGZ1bGxQYXRoXHJcbiAgICogQHJldHVybnNcclxuICAgKi9cclxuICBwdWJsaWMgZ2V0RmllbGRJbkZpZWxkcyhmaWVsZHM6IEJpbGxTY2hlbWFGaWVsZEJhc2VbXSwgZnVsbFBhdGg6IHN0cmluZykge1xyXG4gICAgbGV0IHYgPSBudWxsO1xyXG4gICAgZm9yIChsZXQgZnYgb2YgZmllbGRzKSB7XHJcbiAgICAgIGNvbnN0IGN1ckZ2ID0gZnYgYXMgKEJpbGxTY2hlbWFGaWVsZCB8IEJpbGxTY2hlbWFTdWJGaWVsZCk7XHJcbiAgICAgIC8vIOafpeaJvuagueWtl+autVxyXG4gICAgICBsZXQgdG1wRnY6IEJpbGxTY2hlbWFGaWVsZEJhc2UgPSBmdjtcclxuICAgICAgd2hpbGUgKHRtcEZ2LmF0dGFjaGVkRmllbGQpIHtcclxuICAgICAgICB0bXBGdiA9IHRtcEZ2LmF0dGFjaGVkRmllbGQ7XHJcbiAgICAgIH1cclxuICAgICAgY29uc3Qgcm9vdEZ2ID0gdG1wRnYgYXMgQmlsbFNjaGVtYUZpZWxkO1xyXG4gICAgICAvLyDmm7TmlrBmdWxsUGF0aFxyXG4gICAgICBjdXJGdi5mdWxsUGF0aCA9IGZ1bGxQYXRoUHJlZml4ICsgcm9vdEZ2LmF0dGFjaGVkVGFibGUudGFibGVOYW1lICsgXCIuXCIgKyBjdXJGdi5maWVsZFBhdGg7XHJcbiAgICAgIC8vIOWvueavlOW9k+WJjeWtl+autWZ1bGxQYXRo5LiO55uu5qCHZnVsbFBhdGhcclxuICAgICAgaWYgKGZ1bGxQYXRoID09IGN1ckZ2LmZ1bGxQYXRoKSB7XHJcbiAgICAgICAgdiA9IGN1ckZ2O1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICB9XHJcbiAgICAgIC8vIOmAkuW9kuafpeaJvuWtkOWtl+autVxyXG4gICAgICBjb25zdCBzdWJGbGRzID0gY3VyRnYuR2V0U3ViRmllbGRMaXN0KCk7XHJcbiAgICAgIGlmIChzdWJGbGRzICYmIHN1YkZsZHMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgIHYgPSB0aGlzLmdldEZpZWxkSW5GaWVsZHMoc3ViRmxkcywgZnVsbFBhdGgpO1xyXG4gICAgICAgIGlmICh2ICE9IG51bGwpIHtcclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIHY7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgZ2V0RmllbGRWYWx1ZUluRmllbGRzV2l0aFZhbHVlKGZpZWxkc1dpdGhWYWx1ZTogQmlsbFNjaGVtYUZpZWxkQmFzZVtdLCBmdWxsUGF0aDogc3RyaW5nKSB7XHJcbiAgICBsZXQgdiA9IG51bGw7XHJcbiAgICBmb3IgKGxldCBmdiBvZiBmaWVsZHNXaXRoVmFsdWUpIHtcclxuICAgICAgd2hpbGUgKGZ2LmF0dGFjaGVkRmllbGQpIHtcclxuICAgICAgICBmdiA9IGZ2LmF0dGFjaGVkRmllbGQ7XHJcbiAgICAgIH1cclxuICAgICAgY29uc3Qgcm9vdEZ2ID0gZnYgYXMgQmlsbFNjaGVtYUZpZWxkO1xyXG4gICAgICByb290RnYuZnVsbFBhdGggPSBmdWxsUGF0aFByZWZpeCArIHJvb3RGdi5hdHRhY2hlZFRhYmxlLnRhYmxlTmFtZSArIFwiLlwiICsgcm9vdEZ2LmZpZWxkUGF0aDtcclxuICAgICAgaWYgKGZ1bGxQYXRoID09IHJvb3RGdi5mdWxsUGF0aCkge1xyXG4gICAgICAgIHYgPSByb290RnYuZmllbGRWYWx1ZTtcclxuICAgICAgICBicmVhaztcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIHY7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgZ2V0QmFzaWNJbmZvRmllbGRzV2l0aFZhbHVlKGJpbGxJbmZvOiBCaWxsSW5mbywgc2NoZW1hVGFibGU6IEJpbGxTY2hlbWFUYWJsZSwgZGF0YVRhYmxlOiBCaWxsRGF0YVRhYmxlLCBmaWx0ZXJGaWVsZHM6IGJvb2xlYW4gPSB0cnVlKTogKEJpbGxTY2hlbWFGaWVsZCB8IEJpbGxTY2hlbWFTdWJGaWVsZClbXSB7XHJcbiAgICBjb25zdCBmaWVsZHNXaXRoVmFsdWU6IChCaWxsU2NoZW1hRmllbGQgfCBCaWxsU2NoZW1hU3ViRmllbGQpW10gPSBbXTtcclxuICAgIC8vIOWNleaNrui/vei4qumFjee9rlxyXG4gICAgbGV0IGJ0czogQmlsbFRyYWNraW5nU2V0dGluZ3MgPSBuZXcgQmlsbFRyYWNraW5nU2V0dGluZ3MoKTtcclxuICAgIGlmIChiaWxsSW5mbyAmJiBiaWxsSW5mby5iaWxsVHJhY2tpbmdTZXR0aW5ncykge1xyXG4gICAgICBidHMuTG9hZEZyb21Kc29uKGJpbGxJbmZvLmJpbGxUcmFja2luZ1NldHRpbmdzKTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBzY2hlbWEgPSB0aGlzLmdldEJpbGxUcmFja2VyU2NoZW1hKGJpbGxJbmZvKTtcclxuICAgIGxldCBzZWxlY3RlZEZpZWxkcyA9IHNjaGVtYSAmJiBzY2hlbWFbc2NoZW1hVGFibGUudGFibGVOYW1lXSAmJiBzY2hlbWFbc2NoZW1hVGFibGUudGFibGVOYW1lXS5maWVsZHM7XHJcbiAgICBzZWxlY3RlZEZpZWxkcyA9IHNlbGVjdGVkRmllbGRzID8gc2VsZWN0ZWRGaWVsZHMgOiBbXTtcclxuICAgIGxldCBzaG93Q3VzdG9tRmllbGRzID0gYnRzLmJpbGxUcmFja2luZ0RhdGFTaG93bk1vZGUgPT09IEJpbGxUcmFja2luZ0RhdGFTaG93bk1vZGUuQ1VTVE9NRklFTEQ7XHJcblxyXG4gICAgLy8g5omA5pyJ5a2X5q61XHJcbiAgICBjb25zdCBmcyA9IHNjaGVtYVRhYmxlLmdldEZpZWxkTGlzdCgpO1xyXG4gICAgY29uc3QgciA9IGRhdGFUYWJsZS5HZXRSb3dMaXN0KClbMF07XHJcbiAgICAvLyDkuLvooajlrZfmrrVcclxuICAgIGNvbnN0IHJkZm0gPSByLkdldEZpZWxkTWFwKCk7XHJcblxyXG4gICAgLy8g5o+Q5Y+W5bGV56S65a2X5q61XHJcbiAgICBjb25zdCBmZnMgPSB0aGlzLmV4dHJhY3RGRmllbGRzKGZzLCBzZWxlY3RlZEZpZWxkcywgc2hvd0N1c3RvbUZpZWxkcyk7XHJcbiAgICAvLyDojrflj5blrZfmrrXlgLxcclxuICAgIC8vIOWFiOino+aekOWFtuS7luexu+Wei+Wtl+autVxyXG4gICAgY29uc3QgZGVjaW1hbEZmcyA9IFtdO1xyXG4gICAgZmZzLmZvckVhY2goZmYgPT4ge1xyXG4gICAgICBpZiAoZmYuZGF0YVR5cGUgPT0gRGF0YVR5cGUuRGVjaW1hbCkge1xyXG4gICAgICAgIGRlY2ltYWxGZnMucHVzaChmZik7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgZmYuZmllbGRWYWx1ZSA9IHRoaXMuZ2V0RmllbGRWYWx1ZShmZiwgcmRmbSk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgLy8g5YaN6Kej5p6Q5rWu54K55pWw5a2X5q61XHJcbiAgICBkZWNpbWFsRmZzLmZvckVhY2goZmYgPT4ge1xyXG4gICAgICBmZi5maWVsZFZhbHVlID0gdGhpcy5nZXRGaWVsZFZhbHVlKGZmLCByZGZtLCBmcyk7XHJcbiAgICB9KTtcclxuICAgIGZpZWxkc1dpdGhWYWx1ZS5wdXNoKC4uLmZmcyk7XHJcblxyXG4gICAgcmV0dXJuIGZpZWxkc1dpdGhWYWx1ZTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBzZXRFeHRlbmRQcm9wcyhmOiBCaWxsU2NoZW1hRmllbGQgfCBCaWxsU2NoZW1hU3ViRmllbGQsIHNmOiBCaWxsU2NoZW1hRmllbGQgfCBCaWxsU2NoZW1hU3ViRmllbGQsIGZpZWxkUGF0aDogc3RyaW5nLCByZGZtPzogeyBba2V5OiBzdHJpbmddOiBCaWxsRGF0YUZpZWxkOyB9KSB7XHJcbiAgICBmLmNhcHRpb25QYXRoID0gdGhpcy5leHRyYWN0Q2FwdGlvblBhdGgoZik7XHJcbiAgICBmLmZpZWxkUGF0aCA9IGZpZWxkUGF0aDtcclxuICAgIGlmIChzZikge1xyXG4gICAgICBmLmRpc3BsYXlOYW1lID0gc2YuZGlzcGxheU5hbWU7XHJcbiAgICAgIGYuaTE4bkNvbHMgPSBzZi5pMThuQ29scztcclxuICAgICAgZi5mb3JtYXRJbmZvID0gc2YuZm9ybWF0SW5mbztcclxuICAgICAgZi5vcmRlciA9IHNmLm9yZGVyO1xyXG4gICAgfVxyXG4gICAgaWYgKHJkZm0pIHtcclxuICAgICAgZi5maWVsZFZhbHVlID0gdGhpcy5nZXRGaWVsZFZhbHVlKGYsIHJkZm0pO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBmO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5a2X5q615YiX6KGo5oyJb3JkZXLlsZ7mgKfmjpLluo9cclxuICAgKiBAcGFyYW0gZmllbGRzV2l0aFZhbHVlXHJcbiAgICogQHJldHVybnNcclxuICAgKi9cclxuICBwdWJsaWMgc29ydEZpZWxkc0J5T3JkZXIoZmllbGRzV2l0aFZhbHVlOiAoQmlsbFNjaGVtYUZpZWxkIHwgQmlsbFNjaGVtYVN1YkZpZWxkKVtdKTogKEJpbGxTY2hlbWFGaWVsZCB8IEJpbGxTY2hlbWFTdWJGaWVsZClbXSB7XHJcbiAgICByZXR1cm4gZmllbGRzV2l0aFZhbHVlLnNvcnQoKGEsIGIpID0+IHtcclxuICAgICAgaWYgKGEub3JkZXIgIT0gbnVsbCAmJiBiLm9yZGVyICE9IG51bGwpIHtcclxuICAgICAgICByZXR1cm4gYS5vcmRlciAtIGIub3JkZXI7XHJcbiAgICAgIH0gZWxzZSBpZiAoYS5vcmRlciAhPSBudWxsICYmIGIub3JkZXIgPT0gbnVsbCkge1xyXG4gICAgICAgIHJldHVybiAtMTtcclxuICAgICAgfSBlbHNlIGlmIChhLm9yZGVyID09IG51bGwgJiYgYi5vcmRlciAhPSBudWxsKSB7XHJcbiAgICAgICAgcmV0dXJuIDE7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgcmV0dXJuIDA7XHJcbiAgICAgIH1cclxuICAgIH0pXHJcbiAgfVxyXG5cclxuICBwdWJsaWMgZGF0ZUZvcm1hdChkYXRlOiBEYXRlLCBmbXQ6IHN0cmluZyk6IHN0cmluZyB7XHJcbiAgICBsZXQgcmV0O1xyXG4gICAgY29uc3Qgb3B0ID0ge1xyXG4gICAgICBcInkrXCI6IGRhdGUuZ2V0VVRDRnVsbFllYXIoKS50b1N0cmluZygpLCAgICAgICAgLy8g5bm0XHJcbiAgICAgIFwiTStcIjogKGRhdGUuZ2V0VVRDTW9udGgoKSArIDEpLnRvU3RyaW5nKCksICAgICAvLyDmnIhcclxuICAgICAgXCJkK1wiOiBkYXRlLmdldFVUQ0RhdGUoKS50b1N0cmluZygpLCAgICAgICAgICAgIC8vIOaXpVxyXG4gICAgICBcIkgrXCI6IGRhdGUuZ2V0VVRDSG91cnMoKS50b1N0cmluZygpLCAgICAgICAgICAgLy8g5pe2XHJcbiAgICAgIFwibStcIjogZGF0ZS5nZXRVVENNaW51dGVzKCkudG9TdHJpbmcoKSwgICAgICAgICAvLyDliIZcclxuICAgICAgXCJzK1wiOiBkYXRlLmdldFVUQ1NlY29uZHMoKS50b1N0cmluZygpLCAgICAgICAgIC8vIOenklxyXG4gICAgICBcIlMrXCI6IGRhdGUuZ2V0VVRDTWlsbGlzZWNvbmRzKCkudG9TdHJpbmcoKSwgICAgLy8g56eSXHJcbiAgICAgIC8vIOacieWFtuS7luagvOW8j+WMluWtl+espumcgOaxguWPr+S7pee7p+e7rea3u+WKoO+8jOW/hemhu+i9rOWMluaIkOWtl+espuS4slxyXG4gICAgfTtcclxuICAgIGZvciAobGV0IGsgaW4gb3B0KSB7XHJcbiAgICAgIHJldCA9IG5ldyBSZWdFeHAoXCIoXCIgKyBrICsgXCIpXCIpLmV4ZWMoZm10KTtcclxuICAgICAgaWYgKHJldCkge1xyXG4gICAgICAgIGlmICghU3RyaW5nLnByb3RvdHlwZS5wYWRTdGFydCkge1xyXG4gICAgICAgICAgZm10ID0gZm10LnJlcGxhY2UocmV0WzFdLCAocmV0WzFdLmxlbmd0aCA9PSAxKSA/IChvcHRba10pIDogKHRoaXMubXlQYWRTdGFydChvcHRba10sIHJldFsxXS5sZW5ndGgsIFwiMFwiKSkpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICBmbXQgPSBmbXQucmVwbGFjZShyZXRbMV0sIChyZXRbMV0ubGVuZ3RoID09IDEpID8gKG9wdFtrXSkgOiAob3B0W2tdLnBhZFN0YXJ0KHJldFsxXS5sZW5ndGgsIFwiMFwiKSkpO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIGZtdDtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBteVBhZFN0YXJ0KHNyYzogc3RyaW5nLCB0YXJnZXRMZW5ndGg6IG51bWJlciwgcGFkU3RyaW5nOiBzdHJpbmcpIHtcclxuICAgIHRhcmdldExlbmd0aCA9IHRhcmdldExlbmd0aCA+PiAwOyAvL2Zsb29yIGlmIG51bWJlciBvciBjb252ZXJ0IG5vbi1udW1iZXIgdG8gMDtcclxuICAgIHBhZFN0cmluZyA9IFN0cmluZyh0eXBlb2YgcGFkU3RyaW5nICE9PSAndW5kZWZpbmVkJyA/IHBhZFN0cmluZyA6ICcgJyk7XHJcbiAgICBpZiAoc3JjLmxlbmd0aCA+IHRhcmdldExlbmd0aCkge1xyXG4gICAgICByZXR1cm4gU3RyaW5nKHNyYyk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0YXJnZXRMZW5ndGggPSB0YXJnZXRMZW5ndGggLSBzcmMubGVuZ3RoO1xyXG4gICAgICBpZiAodGFyZ2V0TGVuZ3RoID4gcGFkU3RyaW5nLmxlbmd0aCkge1xyXG4gICAgICAgIHBhZFN0cmluZyArPSBwYWRTdHJpbmcucmVwZWF0KHRhcmdldExlbmd0aCAvIHBhZFN0cmluZy5sZW5ndGgpOyAvL2FwcGVuZCB0byBvcmlnaW5hbCB0byBlbnN1cmUgd2UgYXJlIGxvbmdlciB0aGFuIG5lZWRlZFxyXG4gICAgICB9XHJcbiAgICAgIHJldHVybiBwYWRTdHJpbmcuc2xpY2UoMCwgdGFyZ2V0TGVuZ3RoKSArIFN0cmluZyhzcmMpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog6Kej5p6Q5a2X5q615ZCN56ewXHJcbiAgICogQHBhcmFtIGZcclxuICAgKiBAcGFyYW0gbGFuZ0NvZGVcclxuICAgKiBAcmV0dXJuc1xyXG4gICAqL1xyXG4gIHB1YmxpYyBnZXRGaWVsZExhYmVsKGY6IEJpbGxTY2hlbWFGaWVsZCB8IEJpbGxTY2hlbWFTdWJGaWVsZCwgbGFuZ0NvZGU/OiBzdHJpbmcpIHtcclxuICAgIHJldHVybiAobGFuZ0NvZGUgJiYgZi5pMThuQ29scyAmJiBmLmkxOG5Db2xzLmNvbEkxOG5WYWx1ZXMuZGlzcGxheU5hbWUgJiZcclxuICAgICAgZi5pMThuQ29scy5jb2xJMThuVmFsdWVzLmRpc3BsYXlOYW1lW2xhbmdDb2RlXSkgfHwgZi5kaXNwbGF5TmFtZSB8fCBmLmNhcHRpb25QYXRoIHx8IGYuY2FwdGlvblxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog6Kej5p6Q6KGo5ZCN56ewXHJcbiAgICovXHJcbiAgcHVibGljIGdldFRhYmxlTGFiZWwoYmlsbEluZm86IEJpbGxJbmZvLCBzY2hlbWFUYWJsZTogQmlsbFNjaGVtYVRhYmxlLCBsYW5nQ29kZT86IHN0cmluZykge1xyXG4gICAgY29uc3Qgc2NoZW1hID0gdGhpcy5nZXRCaWxsVHJhY2tlclNjaGVtYShiaWxsSW5mbyk7XHJcbiAgICBsZXQgdGFibGUgPSBzY2hlbWEgJiYgc2NoZW1hW3NjaGVtYVRhYmxlLnRhYmxlTmFtZV07XHJcbiAgICBpZiAodGFibGUgIT0gbnVsbCkge1xyXG4gICAgICBjb25zdCBpMThuQ29scyA9IHRhYmxlLmkxOG5Db2xzO1xyXG4gICAgICBjb25zdCB0bXAgPSAobGFuZ0NvZGUgJiYgaTE4bkNvbHMgJiYgaTE4bkNvbHMuY29sSTE4blZhbHVlcy5kaXNwbGF5TmFtZSAmJiBpMThuQ29scy5jb2xJMThuVmFsdWVzLmRpc3BsYXlOYW1lW2xhbmdDb2RlXSkgfHwgdGFibGUuZGlzcGxheU5hbWUgfHwgdGFibGUuY2FwdGlvbiB8fCB0YWJsZS5jb2RlO1xyXG4gICAgICByZXR1cm4gdG1wO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcmV0dXJuIHNjaGVtYVRhYmxlLmNhcHRpb247XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDojrflj5bop6PmnpDlj6/lsZXnpLrlrZDooahcclxuICAgKi9cclxuICBwdWJsaWMgZ2V0Q2hpbGRUYWJsZXMoYmlsbEluZm86IEJpbGxJbmZvLCBzY2hlbWFUYWJsZTogQmlsbFNjaGVtYVRhYmxlKSB7XHJcbiAgICBsZXQgcmVzdWx0OiBCaWxsU2NoZW1hVGFibGVbXSA9IFtdO1xyXG5cclxuICAgIGNvbnN0IHNjaGVtYSA9IHRoaXMuZ2V0QmlsbFRyYWNrZXJTY2hlbWEoYmlsbEluZm8pO1xyXG4gICAgY29uc3QgY2hpbGRyZW4gPSBzY2hlbWFUYWJsZS5HZXRDaGlsZFRhYmxlTGlzdCgpO1xyXG4gICAgY2hpbGRyZW4gJiYgY2hpbGRyZW4uZm9yRWFjaCgoY2hpbGQpID0+IHtcclxuICAgICAgbGV0IHRyYWNrZXJUYWJsZSA9IHNjaGVtYSAmJiBzY2hlbWFbY2hpbGQudGFibGVOYW1lXTtcclxuICAgICAgaWYgKHRyYWNrZXJUYWJsZSAhPSBudWxsICYmIHRyYWNrZXJUYWJsZS5zaG93ICE9IG51bGwpIHtcclxuICAgICAgICBpZiAodHJhY2tlclRhYmxlLnNob3cgPT0gdHJ1ZSkge1xyXG4gICAgICAgICAgY2hpbGQub3JkZXIgPSB0cmFja2VyVGFibGUub3JkZXI7XHJcbiAgICAgICAgICByZXN1bHQucHVzaChjaGlsZCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIC8vIOWFvOWuueaXoHNob3flsZ7mgKfmg4XlvaJcclxuICAgICAgICByZXN1bHQucHVzaChjaGlsZCk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG5cclxuICAgIHJlc3VsdCA9IHRoaXMuc29ydFRhYmxlc0J5T3JkZXIocmVzdWx0KTtcclxuXHJcbiAgICByZXR1cm4gcmVzdWx0O1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog6KGo5oyJc29ydOWtl+auteaOkuW6j1xyXG4gICAqIEBwYXJhbSBzY2hlbWFUYWJsZXNcclxuICAgKiBAcmV0dXJuc1xyXG4gICAqL1xyXG4gIHB1YmxpYyBzb3J0VGFibGVzQnlPcmRlcihzY2hlbWFUYWJsZXM6IEJpbGxTY2hlbWFUYWJsZVtdKTogQmlsbFNjaGVtYVRhYmxlW10ge1xyXG4gICAgcmV0dXJuIHNjaGVtYVRhYmxlcy5zb3J0KChhLCBiKSA9PiB7XHJcbiAgICAgIGlmIChhLm9yZGVyICE9IG51bGwgJiYgYi5vcmRlciAhPSBudWxsKSB7XHJcbiAgICAgICAgcmV0dXJuIGEub3JkZXIgLSBiLm9yZGVyO1xyXG4gICAgICB9IGVsc2UgaWYgKGEub3JkZXIgIT0gbnVsbCAmJiBiLm9yZGVyID09IG51bGwpIHtcclxuICAgICAgICByZXR1cm4gLTE7XHJcbiAgICAgIH0gZWxzZSBpZiAoYS5vcmRlciA9PSBudWxsICYmIGIub3JkZXIgIT0gbnVsbCkge1xyXG4gICAgICAgIHJldHVybiAxO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHJldHVybiAwO1xyXG4gICAgICB9XHJcbiAgICB9KVxyXG4gIH1cclxuICAvKipcclxuICAgKiDop6PmnpBiaWxsVHJhY2tlclNjaGVtYVxyXG4gICAqIEBwYXJhbSBiaWxsSW5mb1xyXG4gICAqL1xyXG4gIHB1YmxpYyBnZXRCaWxsVHJhY2tlclNjaGVtYShiaWxsSW5mbzogQmlsbEluZm8pOiBCaWxsVHJhY2tlclNjaGVtYSB7XHJcbiAgICBsZXQgYnRzOiBCaWxsVHJhY2tpbmdTZXR0aW5ncyA9IG5ldyBCaWxsVHJhY2tpbmdTZXR0aW5ncygpO1xyXG4gICAgaWYgKGJpbGxJbmZvICYmIGJpbGxJbmZvLmJpbGxUcmFja2luZ1NldHRpbmdzKSB7XHJcbiAgICAgIGJ0cy5Mb2FkRnJvbUpzb24oYmlsbEluZm8uYmlsbFRyYWNraW5nU2V0dGluZ3MpO1xyXG4gICAgfVxyXG5cclxuICAgIGxldCBmaWVsZENvbnRlbnQgPSBidHMuY3VzdG9tRmllbGRDb250ZW50O1xyXG4gICAgbGV0IGZpZWxkQ29uZmlnOiBCaWxsVHJhY2tlclNjaGVtYUZpZWxkQ29udGVudCA9IGZpZWxkQ29udGVudCAmJiAodHlwZW9mIGZpZWxkQ29udGVudCA9PSBcIm9iamVjdFwiID8gZmllbGRDb250ZW50IDogSlNPTi5wYXJzZShmaWVsZENvbnRlbnQpKTtcclxuICAgIGxldCBzY2hlbWEgPSBmaWVsZENvbmZpZyAmJiBmaWVsZENvbmZpZy5zY2hlbWE7XHJcblxyXG4gICAgcmV0dXJuIHNjaGVtYTtcclxuICB9XHJcbn1cclxuIl19
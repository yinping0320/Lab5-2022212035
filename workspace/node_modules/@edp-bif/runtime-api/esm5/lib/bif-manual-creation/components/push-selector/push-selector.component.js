/**
 * @fileoverview added by tsickle
 * Generated from: lib/bif-manual-creation/components/push-selector/push-selector.component.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Component, Inject, LOCALE_ID, ElementRef, ViewChild, Optional, Injector, ComponentFactoryResolver, ReflectiveInjector } from '@angular/core';
import { Subject } from 'rxjs';
import { SELECTOR_ARGS_INJECTOR } from '../../config/selector-args-injector.config';
import { FormGetBillCreationProcessEntityExArgs } from '../../../entity/form-rest/FormGetBillCreationProcessEntityExArgs';
import { BifDataService } from '../../service/bif-data.service';
import { LoadingService } from '@farris/ui-loading';
import { TreeTableComponent } from '@farris/ui-treetable';
import { DatagridComponent } from '@farris/ui-datagrid';
import { LocalePipe } from '../../pipe/locale.pipe';
import { MessagerService } from '@farris/ui-messager';
var PushSelectorComponent = /** @class */ (function () {
    function PushSelectorComponent(args, dataService, localeId, loading, elementRef, inj, cfr, messagerService) {
        var _this = this;
        this.dataService = dataService;
        this.loading = loading;
        this.elementRef = elementRef;
        this.inj = inj;
        this.cfr = cfr;
        this.messagerService = messagerService;
        this.ttData = [];
        this.ttIdField = 'voId';
        this.ttSearchFields = [];
        this.dgData = [];
        this.dgIdField = 'id';
        this.procData = [];
        this.bsModalRef4BifSelector = null;
        this.subject4CreationProcess = new Subject();
        this.clickOk4BifSelector = (/**
         * @return {?}
         */
        function () {
            if (_this.selectedEntity == null) {
                _this.messagerService.error(_this.localePipe.instant("pleaseSelectOneCreationProcess"));
                return;
            }
            _this.subject4CreationProcess.next(_this.selectedEntity);
            _this.subject4CreationProcess.complete();
            _this.bsModalRef4BifSelector.close();
        });
        this.clickClose4BifSelector = (/**
         * @return {?}
         */
        function () {
            _this.bsModalRef4BifSelector.close();
        });
        this.args = new FormGetBillCreationProcessEntityExArgs();
        this.args.LoadFromJsonObject(args);
        this.localePipe = new LocalePipe(localeId);
        if (inj == null) {
            /** @type {?} */
            var refInj = ReflectiveInjector.resolveAndCreate([
                MessagerService,
            ]);
            this.inj = refInj;
        }
        this.cfr = cfr || this.inj.get(ComponentFactoryResolver);
        this.messagerService = messagerService || this.inj.get(MessagerService, null);
    }
    /**
     * @return {?}
     */
    PushSelectorComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        this.ttDataRoot = {
            id: "*",
            data: {
                voId: "*",
                voName: this.localePipe.instant("all"),
            },
            parent: null,
            expanded: true,
            children: [],
        };
        this.ttData = [this.ttDataRoot];
        this.configTtColumns();
        this.configDgColumns();
        this.configTtEvents();
        this.configDgEvents();
        this.loadItems();
    };
    /**
     * @private
     * @return {?}
     */
    PushSelectorComponent.prototype.loadItems = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        this.loading.show({ container: this.elementRef });
        /** @type {?} */
        var list$ = null;
        if (this.args.downBillVoId == null) {
            list$ = this.dataService.getSlimBillCreationProcessEntityExesByUpBillVoId4Push(this.args.upBillVoId);
        }
        else {
            list$ = this.dataService.getSlimBillCreationProcessEntityExesByUpBillVoIdAndDownBillVoId4SpecificPush(this.args.upBillVoId, this.args.downBillVoId);
        }
        list$.subscribe((/**
         * @param {?} result
         * @return {?}
         */
        function (result) {
            _this.loading.close();
            _this.procData = result || [];
            _this.dgData = tslib_1.__spread(_this.procData);
            // 组织VO树
            /** @type {?} */
            var voList = [];
            _this.procData.forEach((/**
             * @param {?} it
             * @return {?}
             */
            function (it) {
                if (voList.some((/**
                 * @param {?} vo
                 * @return {?}
                 */
                function (vo) { return vo.voId == it.downBillVoId; })) == false) {
                    voList.push({
                        voId: it.downBillVoId,
                        voName: it.downBillVoName,
                    });
                }
            }));
            _this.ttDataRoot.children = voList.map((/**
             * @param {?} it
             * @return {?}
             */
            function (it) {
                return {
                    id: it.voId,
                    data: {
                        voId: it.voId,
                        voName: it.voName,
                    },
                    expanded: true,
                };
            }));
            _this.ttData = [_this.ttDataRoot];
            // 默认选中第一条
            if (_this.dgData && _this.dgData.length > 0) {
                _this.selectedEntity = _this.dgData[0];
                setTimeout((/**
                 * @return {?}
                 */
                function () {
                    _this.dg.clearSelections();
                    _this.dg.selectRow(_this.dgData[0].id);
                }), 0);
            }
        }), (/**
         * @param {?} err
         * @return {?}
         */
        function (err) {
            _this.loading.close();
            throw err;
        }));
    };
    /**
     * @return {?}
     */
    PushSelectorComponent.prototype.configTtColumns = /**
     * @return {?}
     */
    function () {
        this.ttCols = [
            {
                field: 'voName', title: this.localePipe.instant('downstreamBill'), width: 120,
            },
        ];
    };
    /**
     * @return {?}
     */
    PushSelectorComponent.prototype.configDgColumns = /**
     * @return {?}
     */
    function () {
        this.dgCols = [
            { field: "code", title: this.localePipe.transform("processCode"), width: 120, sortable: true },
            {
                field: "name", title: this.localePipe.transform("processName"), width: 250, sortable: true,
            },
        ];
    };
    /**
     * @return {?}
     */
    PushSelectorComponent.prototype.configTtEvents = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.tt.nodeSelected.subscribe((/**
         * @param {?} ctx
         * @return {?}
         */
        function (ctx) {
            //ctx:{inidex;instance;node:{data}}
            if (ctx.node.id == "*") {
                _this.dgData = tslib_1.__spread(_this.procData);
            }
            else {
                _this.dgData = tslib_1.__spread(_this.procData.filter((/**
                 * @param {?} it
                 * @return {?}
                 */
                function (it) { return it.downBillVoId == ctx.node.data.voId; })));
            }
            if (_this.dgData && _this.dgData.length > 0) {
                _this.selectedEntity = _this.dgData[0];
                setTimeout((/**
                 * @return {?}
                 */
                function () {
                    _this.dg.clearSelections();
                    _this.dg.selectRow(_this.dgData[0].id);
                }), 0);
            }
        }));
    };
    /**
     * @return {?}
     */
    PushSelectorComponent.prototype.configDgEvents = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.dg.selectChanged.subscribe((/**
         * @param {?} row
         * @return {?}
         */
        function (row) {
            _this.selectedEntity = row.data;
        }));
    };
    PushSelectorComponent.decorators = [
        { type: Component, args: [{
                    selector: 'lib-bif-push-selector',
                    template: "<div class=\"g-main\" style=\"padding-left: 24px; padding-right: 24px;\">\r\n  <div class=\"d-flex flex-row\"\r\n    style=\"height: 100%; width: 100%; border: 1px solid #E9ECF3; box-shadow: 0 2px 6px 0 rgb(31 35 41 / 6%); border-radius: 6px;\">\r\n    <div class=\"d-flex flex-column\" style=\"width: 200px;\" ngResizable rzAspectRatio=\"true\" [rzHandles]=\"'e'\">\r\n      <farris-treetable #tt class=\"f-utils-fill-flex-column\" [data]=\"ttData\" [columns]=\"ttCols\" [idField]=\"ttIdField\"\r\n        [fit]=\"true\" [showHeader]=\"true\" [fixedHeader]=\"true\" [singleSelect]=\"true\">\r\n      </farris-treetable>\r\n    </div>\r\n\r\n    <div class=\"f-utils-fill-flex-row\" style=\"padding-left: 15px;\">\r\n      <div class=\"d-flex flex-column\" style=\"width: 100%;\">\r\n        <div class=\"f-utils-fill-flex-column\">\r\n          <farris-datagrid #dg [fit]=\"true\" [fitColumns]=\"true\" [data]=\"dgData\" [columns]=\"dgCols\" [idField]=\"dgIdField\"\r\n            [showHeader]=\"true\" [showBorder]=\"true\" [striped]=\"true\" [pagination]=\"false\" [showLineNumber]=\"true\">\r\n          </farris-datagrid>\r\n        </div>\r\n        <div class=\"form-group\" style=\"\">\r\n          <div>{{ 'processDesciption' | locale }}</div>\r\n          <textarea readonly class=\"form-control\" name=\"description\" rows=\"3\"\r\n            [ngModel]=\"selectedEntity&&selectedEntity.description\"></textarea>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</div>\r\n",
                    styles: [""]
                }] }
    ];
    /** @nocollapse */
    PushSelectorComponent.ctorParameters = function () { return [
        { type: undefined, decorators: [{ type: Inject, args: [SELECTOR_ARGS_INJECTOR,] }] },
        { type: BifDataService },
        { type: String, decorators: [{ type: Inject, args: [LOCALE_ID,] }] },
        { type: LoadingService },
        { type: ElementRef },
        { type: Injector, decorators: [{ type: Optional }] },
        { type: ComponentFactoryResolver, decorators: [{ type: Optional }] },
        { type: MessagerService, decorators: [{ type: Optional }] }
    ]; };
    PushSelectorComponent.propDecorators = {
        tt: [{ type: ViewChild, args: ['tt',] }],
        dg: [{ type: ViewChild, args: ['dg',] }]
    };
    return PushSelectorComponent;
}());
export { PushSelectorComponent };
if (false) {
    /** @type {?} */
    PushSelectorComponent.prototype.tt;
    /** @type {?} */
    PushSelectorComponent.prototype.ttData;
    /** @type {?} */
    PushSelectorComponent.prototype.ttDataRoot;
    /** @type {?} */
    PushSelectorComponent.prototype.ttCols;
    /** @type {?} */
    PushSelectorComponent.prototype.ttIdField;
    /** @type {?} */
    PushSelectorComponent.prototype.ttSearchFields;
    /** @type {?} */
    PushSelectorComponent.prototype.ttSearchObj;
    /** @type {?} */
    PushSelectorComponent.prototype.dg;
    /** @type {?} */
    PushSelectorComponent.prototype.dgData;
    /** @type {?} */
    PushSelectorComponent.prototype.dgCols;
    /** @type {?} */
    PushSelectorComponent.prototype.dgIdField;
    /** @type {?} */
    PushSelectorComponent.prototype.localePipe;
    /** @type {?} */
    PushSelectorComponent.prototype.procData;
    /**
     * 选中的生单流程
     * @type {?}
     */
    PushSelectorComponent.prototype.selectedEntity;
    /** @type {?} */
    PushSelectorComponent.prototype.bsModalRef4BifSelector;
    /** @type {?} */
    PushSelectorComponent.prototype.subject4CreationProcess;
    /**
     * @type {?}
     * @private
     */
    PushSelectorComponent.prototype.args;
    /** @type {?} */
    PushSelectorComponent.prototype.clickOk4BifSelector;
    /** @type {?} */
    PushSelectorComponent.prototype.clickClose4BifSelector;
    /**
     * @type {?}
     * @private
     */
    PushSelectorComponent.prototype.dataService;
    /**
     * @type {?}
     * @private
     */
    PushSelectorComponent.prototype.loading;
    /**
     * @type {?}
     * @private
     */
    PushSelectorComponent.prototype.elementRef;
    /** @type {?} */
    PushSelectorComponent.prototype.inj;
    /** @type {?} */
    PushSelectorComponent.prototype.cfr;
    /** @type {?} */
    PushSelectorComponent.prototype.messagerService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHVzaC1zZWxlY3Rvci5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZWRwLWJpZi9ydW50aW1lLWFwaS8iLCJzb3VyY2VzIjpbImxpYi9iaWYtbWFudWFsLWNyZWF0aW9uL2NvbXBvbmVudHMvcHVzaC1zZWxlY3Rvci9wdXNoLXNlbGVjdG9yLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFVLE1BQU0sRUFBRSxTQUFTLEVBQUUsVUFBVSxFQUFFLFNBQVMsRUFBRSxRQUFRLEVBQUUsUUFBUSxFQUFFLHdCQUF3QixFQUFFLGtCQUFrQixFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzlKLE9BQU8sRUFBRSxPQUFPLEVBQWMsTUFBTSxNQUFNLENBQUM7QUFFM0MsT0FBTyxFQUFFLHNCQUFzQixFQUFnQixNQUFNLDRDQUE0QyxDQUFDO0FBRWxHLE9BQU8sRUFBRSxzQ0FBc0MsRUFBRSxNQUFNLGtFQUFrRSxDQUFDO0FBQzFILE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSxnQ0FBZ0MsQ0FBQztBQUVoRSxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sb0JBQW9CLENBQUM7QUFDcEQsT0FBTyxFQUFZLGtCQUFrQixFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFDcEUsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDeEQsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLHdCQUF3QixDQUFDO0FBQ3BELE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUV0RDtJQW9DRSwrQkFDa0MsSUFBa0IsRUFDMUMsV0FBMkIsRUFDaEIsUUFBZ0IsRUFDM0IsT0FBdUIsRUFDdkIsVUFBc0IsRUFDWCxHQUFhLEVBQ2IsR0FBNkIsRUFDN0IsZUFBZ0M7UUFSckQsaUJBc0JDO1FBcEJTLGdCQUFXLEdBQVgsV0FBVyxDQUFnQjtRQUUzQixZQUFPLEdBQVAsT0FBTyxDQUFn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LGdEQUFtRCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgT25Jbml0LCBJbmplY3QsIExPQ0FMRV9JRCwgRWxlbWVudFJlZiwgVmlld0NoaWxkLCBPcHRpb25hbCwgSW5qZWN0b3IsIENvbXBvbmVudEZhY3RvcnlSZXNvbHZlciwgUmVmbGVjdGl2ZUluamVjdG9yIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IFN1YmplY3QsIE9ic2VydmFibGUgfSBmcm9tICdyeGpzJztcclxuaW1wb3J0IHsgQnNNb2RhbFJlZiB9IGZyb20gJ0BmYXJyaXMvdWktbW9kYWwnO1xyXG5pbXBvcnQgeyBTRUxFQ1RPUl9BUkdTX0lOSkVDVE9SLCBTZWxlY3RvckFyZ3MgfSBmcm9tICcuLi8uLi9jb25maWcvc2VsZWN0b3ItYXJncy1pbmplY3Rvci5jb25maWcnO1xyXG5pbXBvcnQgeyBJUnRTbGltQmlsbENyZWF0aW9uUHJvY2Vzc0VudGl0eUV4IH0gZnJvbSAnQGVkcC1iaWYvY29tbW9uLWFwaSc7XHJcbmltcG9ydCB7IEZvcm1HZXRCaWxsQ3JlYXRpb25Qcm9jZXNzRW50aXR5RXhBcmdzIH0gZnJvbSAnLi4vLi4vLi4vZW50aXR5L2Zvcm0tcmVzdC9Gb3JtR2V0QmlsbENyZWF0aW9uUHJvY2Vzc0VudGl0eUV4QXJncyc7XHJcbmltcG9ydCB7IEJpZkRhdGFTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vc2VydmljZS9iaWYtZGF0YS5zZXJ2aWNlJztcclxuaW1wb3J0IHsgSUJpZkNyZWF0aW9uUHJvY2Vzc1NlbGVjdG9yQ29tcG9uZW50IH0gZnJvbSAnLi4vLi4vYmFzZS9JQmlmQ3JlYXRpb25Qcm9jZXNzU2VsZWN0b3JDb21wb25lbnQnO1xyXG5pbXBvcnQgeyBMb2FkaW5nU2VydmljZSB9IGZyb20gJ0BmYXJyaXMvdWktbG9hZGluZyc7XHJcbmltcG9ydCB7IFRyZWVOb2RlLCBUcmVlVGFibGVDb21wb25lbnQgfSBmcm9tICdAZmFycmlzL3VpLXRyZWV0YWJsZSc7XHJcbmltcG9ydCB7IERhdGFncmlkQ29tcG9uZW50IH0gZnJvbSAnQGZhcnJpcy91aS1kYXRhZ3JpZCc7XHJcbmltcG9ydCB7IExvY2FsZVBpcGUgfSBmcm9tICcuLi8uLi9waXBlL2xvY2FsZS5waXBlJztcclxuaW1wb3J0IHsgTWVzc2FnZXJTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy91aS1tZXNzYWdlcic7XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICBzZWxlY3RvcjogJ2xpYi1iaWYtcHVzaC1zZWxlY3RvcicsXHJcbiAgdGVtcGxhdGVVcmw6ICcuL3B1c2gtc2VsZWN0b3IuY29tcG9uZW50Lmh0bWwnLFxyXG4gIHN0eWxlVXJsczogWycuL3B1c2gtc2VsZWN0b3IuY29tcG9uZW50LmNzcyddLFxyXG59KVxyXG5leHBvcnQgY2xhc3MgUHVzaFNlbGVjdG9yQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBJQmlmQ3JlYXRpb25Qcm9jZXNzU2VsZWN0b3JDb21wb25lbnQge1xyXG4gIEBWaWV3Q2hpbGQoJ3R0JylcclxuICB0dDogVHJlZVRhYmxlQ29tcG9uZW50O1xyXG4gIHR0RGF0YTogVHJlZU5vZGVbXSA9IFtdO1xyXG4gIHR0RGF0YVJvb3Q6IFRyZWVOb2RlO1xyXG4gIHR0Q29sczogYW55W107XHJcbiAgdHRJZEZpZWxkID0gJ3ZvSWQnO1xyXG4gIHR0U2VhcmNoRmllbGRzOiB7XHJcbiAgICBsYWJlbDogc3RyaW5nO1xyXG4gICAgdmFsdWU6IHN0cmluZztcclxuICB9W10gPSBbXTtcclxuICB0dFNlYXJjaE9iajogeyBmaWVsZDogc3RyaW5nLCB2YWx1ZTogc3RyaW5nIH07XHJcblxyXG4gIEBWaWV3Q2hpbGQoJ2RnJylcclxuICBkZzogRGF0YWdyaWRDb21wb25lbnQ7XHJcbiAgZGdEYXRhOiBhbnlbXSA9IFtdO1xyXG4gIGRnQ29sczogYW55W107XHJcbiAgZGdJZEZpZWxkID0gJ2lkJztcclxuICBsb2NhbGVQaXBlOiBMb2NhbGVQaXBlO1xyXG5cclxuICBwcm9jRGF0YTogSVJ0U2xpbUJpbGxDcmVhdGlvblByb2Nlc3NFbnRpdHlFeFtdID0gW107XHJcblxyXG4gIC8qKlxyXG4gICAqIOmAieS4reeahOeUn+WNlea1geeoi1xyXG4gICAqL1xyXG4gIHNlbGVjdGVkRW50aXR5OiBJUnRTbGltQmlsbENyZWF0aW9uUHJvY2Vzc0VudGl0eUV4O1xyXG5cclxuICBic01vZGFsUmVmNEJpZlNlbGVjdG9yOiBCc01vZGFsUmVmID0gbnVsbDtcclxuICBzdWJqZWN0NENyZWF0aW9uUHJvY2VzczogU3ViamVjdDxJUnRTbGltQmlsbENyZWF0aW9uUHJvY2Vzc0VudGl0eUV4PiA9IG5ldyBTdWJqZWN0KCk7XHJcblxyXG4gIHByaXZhdGUgYXJnczogRm9ybUdldEJpbGxDcmVhdGlvblByb2Nlc3NFbnRpdHlFeEFyZ3M7XHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICBASW5qZWN0KFNFTEVDVE9SX0FSR1NfSU5KRUNUT1IpIGFyZ3M6IFNlbGVjdG9yQXJncyxcclxuICAgIHByaXZhdGUgZGF0YVNlcnZpY2U6IEJpZkRhdGFTZXJ2aWNlLFxyXG4gICAgQEluamVjdChMT0NBTEVfSUQpIGxvY2FsZUlkOiBzdHJpbmcsXHJcbiAgICBwcml2YXRlIGxvYWRpbmc6IExvYWRpbmdTZXJ2aWNlLFxyXG4gICAgcHJpdmF0ZSBlbGVtZW50UmVmOiBFbGVtZW50UmVmLFxyXG4gICAgQE9wdGlvbmFsKCkgcHVibGljIGluajogSW5qZWN0b3IsXHJcbiAgICBAT3B0aW9uYWwoKSBwdWJsaWMgY2ZyOiBDb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIsXHJcbiAgICBAT3B0aW9uYWwoKSBwdWJsaWMgbWVzc2FnZXJTZXJ2aWNlOiBNZXNzYWdlclNlcnZpY2UsXHJcbiAgKSB7XHJcbiAgICB0aGlzLmFyZ3MgPSBuZXcgRm9ybUdldEJpbGxDcmVhdGlvblByb2Nlc3NFbnRpdHlFeEFyZ3MoKTtcclxuICAgIHRoaXMuYXJncy5Mb2FkRnJvbUpzb25PYmplY3QoYXJncyk7XHJcbiAgICB0aGlzLmxvY2FsZVBpcGUgPSBuZXcgTG9jYWxlUGlwZShsb2NhbGVJZCk7XHJcblxyXG4gICAgaWYgKGluaiA9PSBudWxsKSB7XHJcbiAgICAgIGNvbnN0IHJlZkluaiA9IFJlZmxlY3RpdmVJbmplY3Rvci5yZXNvbHZlQW5kQ3JlYXRlKFtcclxuICAgICAgICBNZXNzYWdlclNlcnZpY2UsXHJcbiAgICAgIF0pO1xyXG4gICAgICB0aGlzLmluaiA9IHJlZkluajtcclxuICAgIH1cclxuICAgIHRoaXMuY2ZyID0gY2ZyIHx8IHRoaXMuaW5qLmdldChDb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIpO1xyXG4gICAgdGhpcy5tZXNzYWdlclNlcnZpY2UgPSBtZXNzYWdlclNlcnZpY2UgfHwgdGhpcy5pbmouZ2V0KE1lc3NhZ2VyU2VydmljZSwgbnVsbCk7XHJcbiAgfVxyXG5cclxuICBuZ09uSW5pdCgpIHtcclxuICAgIHRoaXMudHREYXRhUm9vdCA9IHtcclxuICAgICAgaWQ6IFwiKlwiLFxyXG4gICAgICBkYXRhOiB7XHJcbiAgICAgICAgdm9JZDogXCIqXCIsXHJcbiAgICAgICAgdm9OYW1lOiB0aGlzLmxvY2FsZVBpcGUuaW5zdGFudChcImFsbFwiKSxcclxuICAgICAgfSxcclxuICAgICAgcGFyZW50OiBudWxsLFxyXG4gICAgICBleHBhbmRlZDogdHJ1ZSxcclxuICAgICAgY2hpbGRyZW46IFtdLFxyXG4gICAgfTtcclxuICAgIHRoaXMudHREYXRhID0gW3RoaXMudHREYXRhUm9vdF07XHJcbiAgICB0aGlzLmNvbmZpZ1R0Q29sdW1ucygpO1xyXG4gICAgdGhpcy5jb25maWdEZ0NvbHVtbnMoKTtcclxuICAgIHRoaXMuY29uZmlnVHRFdmVudHMoKTtcclxuICAgIHRoaXMuY29uZmlnRGdFdmVudHMoKTtcclxuICAgIHRoaXMubG9hZEl0ZW1zKCk7XHJcbiAgfVxyXG5cclxuICBjbGlja09rNEJpZlNlbGVjdG9yID0gKCkgPT4ge1xyXG4gICAgaWYgKHRoaXMuc2VsZWN0ZWRFbnRpdHkgPT0gbnVsbCkge1xyXG4gICAgICB0aGlzLm1lc3NhZ2VyU2VydmljZS5lcnJvcih0aGlzLmxvY2FsZVBpcGUuaW5zdGFudChcInBsZWFzZVNlbGVjdE9uZUNyZWF0aW9uUHJvY2Vzc1wiKSk7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIHRoaXMuc3ViamVjdDRDcmVhdGlvblByb2Nlc3MubmV4dCh0aGlzLnNlbGVjdGVkRW50aXR5KTtcclxuICAgIHRoaXMuc3ViamVjdDRDcmVhdGlvblByb2Nlc3MuY29tcGxldGUoKTtcclxuICAgIHRoaXMuYnNNb2RhbFJlZjRCaWZTZWxlY3Rvci5jbG9zZSgpO1xyXG4gIH07XHJcblxyXG4gIGNsaWNrQ2xvc2U0QmlmU2VsZWN0b3IgPSAoKSA9PiB7XHJcbiAgICB0aGlzLmJzTW9kYWxSZWY0QmlmU2VsZWN0b3IuY2xvc2UoKTtcclxuICB9O1xyXG5cclxuICBwcml2YXRlIGxvYWRJdGVtcygpOiB2b2lkIHtcclxuICAgIHRoaXMubG9hZGluZy5zaG93KHsgY29udGFpbmVyOiB0aGlzLmVsZW1lbnRSZWYgfSk7XHJcbiAgICBsZXQgbGlzdCQ6IE9ic2VydmFibGU8SVJ0U2xpbUJpbGxDcmVhdGlvblByb2Nlc3NFbnRpdHlFeFtdPiA9IG51bGw7XHJcbiAgICBpZiAodGhpcy5hcmdzLmRvd25CaWxsVm9JZCA9PSBudWxsKSB7XHJcbiAgICAgIGxpc3QkID0gdGhpcy5kYXRhU2VydmljZS5nZXRTbGltQmlsbENyZWF0aW9uUHJvY2Vzc0VudGl0eUV4ZXNCeVVwQmlsbFZvSWQ0UHVzaCh0aGlzLmFyZ3MudXBCaWxsVm9JZCk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBsaXN0JCA9IHRoaXMuZGF0YVNlcnZpY2UuZ2V0U2xpbUJpbGxDcmVhdGlvblByb2Nlc3NFbnRpdHlFeGVzQnlVcEJpbGxWb0lkQW5kRG93bkJpbGxWb0lkNFNwZWNpZmljUHVzaCh0aGlzLmFyZ3MudXBCaWxsVm9JZCwgdGhpcy5hcmdzLmRvd25CaWxsVm9JZCk7XHJcbiAgICB9XHJcbiAgICBsaXN0JC5zdWJzY3JpYmUoXHJcbiAgICAgIChyZXN1bHQ6IElSdFNsaW1CaWxsQ3JlYXRpb25Qcm9jZXNzRW50aXR5RXhbXSkgPT4ge1xyXG4gICAgICAgIHRoaXMubG9hZGluZy5jbG9zZSgpO1xyXG5cclxuICAgICAgICB0aGlzLnByb2NEYXRhID0gcmVzdWx0IHx8IFtdO1xyXG4gICAgICAgIHRoaXMuZGdEYXRhID0gWy4uLnRoaXMucHJvY0RhdGFdO1xyXG5cclxuICAgICAgICAvLyDnu4Tnu4dWT+agkVxyXG4gICAgICAgIGNvbnN0IHZvTGlzdDoge1xyXG4gICAgICAgICAgdm9JZDogc3RyaW5nLFxyXG4gICAgICAgICAgdm9OYW1lOiBzdHJpbmcsXHJcbiAgICAgICAgfVtdID0gW107XHJcbiAgICAgICAgdGhpcy5wcm9jRGF0YS5mb3JFYWNoKGl0ID0+IHtcclxuICAgICAgICAgIGlmICh2b0xpc3Quc29tZSh2byA9PiB2by52b0lkID09IGl0LmRvd25CaWxsVm9JZCkgPT0gZmFsc2UpIHtcclxuICAgICAgICAgICAgdm9MaXN0LnB1c2goe1xyXG4gICAgICAgICAgICAgIHZvSWQ6IGl0LmRvd25CaWxsVm9JZCxcclxuICAgICAgICAgICAgICB2b05hbWU6IGl0LmRvd25CaWxsVm9OYW1lLFxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICB0aGlzLnR0RGF0YVJvb3QuY2hpbGRyZW4gPSB2b0xpc3QubWFwKGl0ID0+IHtcclxuICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIGlkOiBpdC52b0lkLFxyXG4gICAgICAgICAgICBkYXRhOiB7XHJcbiAgICAgICAgICAgICAgdm9JZDogaXQudm9JZCxcclxuICAgICAgICAgICAgICB2b05hbWU6IGl0LnZvTmFtZSxcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgZXhwYW5kZWQ6IHRydWUsXHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgdGhpcy50dERhdGEgPSBbdGhpcy50dERhdGFSb290XTtcclxuXHJcbiAgICAgICAgLy8g6buY6K6k6YCJ5Lit56ys5LiA5p2hXHJcbiAgICAgICAgaWYgKHRoaXMuZGdEYXRhICYmIHRoaXMuZGdEYXRhLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgIHRoaXMuc2VsZWN0ZWRFbnRpdHkgPSB0aGlzLmRnRGF0YVswXTtcclxuICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLmRnLmNsZWFyU2VsZWN0aW9ucygpO1xyXG4gICAgICAgICAgICB0aGlzLmRnLnNlbGVjdFJvdyh0aGlzLmRnRGF0YVswXS5pZCk7XHJcbiAgICAgICAgICB9LCAwKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0sXHJcbiAgICAgIChlcnIpID0+IHtcclxuICAgICAgICB0aGlzLmxvYWRpbmcuY2xvc2UoKTtcclxuICAgICAgICB0aHJvdyBlcnI7XHJcbiAgICAgIH1cclxuICAgICk7XHJcbiAgfVxyXG5cclxuICBjb25maWdUdENvbHVtbnMoKSB7XHJcbiAgICB0aGlzLnR0Q29scyA9IFtcclxuICAgICAge1xyXG4gICAgICAgIGZpZWxkOiAndm9OYW1lJywgdGl0bGU6IHRoaXMubG9jYWxlUGlwZS5pbnN0YW50KCdkb3duc3RyZWFtQmlsbCcpLCB3aWR0aDogMTIwLFxyXG4gICAgICB9LFxyXG4gICAgXTtcclxuICB9XHJcblxyXG4gIGNvbmZpZ0RnQ29sdW1ucygpIHtcclxuICAgIHRoaXMuZGdDb2xzID0gW1xyXG4gICAgICB7IGZpZWxkOiBcImNvZGVcIiwgdGl0bGU6IHRoaXMubG9jYWxlUGlwZS50cmFuc2Zvcm0oXCJwcm9jZXNzQ29kZVwiKSwgd2lkdGg6IDEyMCwgc29ydGFibGU6IHRydWUgfSxcclxuICAgICAge1xyXG4gICAgICAgIGZpZWxkOiBcIm5hbWVcIiwgdGl0bGU6IHRoaXMubG9jYWxlUGlwZS50cmFuc2Zvcm0oXCJwcm9jZXNzTmFtZVwiKSwgd2lkdGg6IDI1MCwgc29ydGFibGU6IHRydWUsXHJcbiAgICAgIH0sXHJcbiAgICBdO1xyXG4gIH1cclxuXHJcbiAgY29uZmlnVHRFdmVudHMoKSB7XHJcbiAgICB0aGlzLnR0Lm5vZGVTZWxlY3RlZC5zdWJzY3JpYmUoKGN0eCkgPT4ge1xyXG4gICAgICAvL2N0eDp7aW5pZGV4O2luc3RhbmNlO25vZGU6e2RhdGF9fVxyXG4gICAgICBpZiAoY3R4Lm5vZGUuaWQgPT0gXCIqXCIpIHtcclxuICAgICAgICB0aGlzLmRnRGF0YSA9IFsuLi50aGlzLnByb2NEYXRhXTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICB0aGlzLmRnRGF0YSA9IFsuLi50aGlzLnByb2NEYXRhLmZpbHRlcihpdCA9PiBpdC5kb3duQmlsbFZvSWQgPT0gY3R4Lm5vZGUuZGF0YS52b0lkKV07XHJcbiAgICAgIH1cclxuICAgICAgaWYgKHRoaXMuZGdEYXRhICYmIHRoaXMuZGdEYXRhLmxlbmd0aCA+IDApIHtcclxuICAgICAgICB0aGlzLnNlbGVjdGVkRW50aXR5ID0gdGhpcy5kZ0RhdGFbMF07XHJcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICB0aGlzLmRnLmNsZWFyU2VsZWN0aW9ucygpO1xyXG4gICAgICAgICAgdGhpcy5kZy5zZWxlY3RSb3codGhpcy5kZ0RhdGFbMF0uaWQpO1xyXG4gICAgICAgIH0sIDApO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGNvbmZpZ0RnRXZlbnRzKCkge1xyXG4gICAgdGhpcy5kZy5zZWxlY3RDaGFuZ2VkLnN1YnNjcmliZSgocm93KSA9PiB7XHJcbiAgICAgIHRoaXMuc2VsZWN0ZWRFbnRpdHkgPSByb3cuZGF0YTtcclxuICAgIH0pO1xyXG4gIH1cclxufVxyXG4iXX0=
/**
 * @fileoverview added by tsickle
 * Generated from: lib/bif-manual-creation/components/pull-selector/pull-selector.component.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Component, Inject, LOCALE_ID, ElementRef, ViewChild, Injector, ComponentFactoryResolver, Optional, ReflectiveInjector } from '@angular/core';
import { Subject } from 'rxjs';
import { SELECTOR_ARGS_INJECTOR } from '../../config/selector-args-injector.config';
import { BifDataService } from '../../service/bif-data.service';
import { FormGetBillCreationProcessEntityExArgs } from '../../../entity/form-rest/FormGetBillCreationProcessEntityExArgs';
import { LoadingService } from '@farris/ui-loading';
import { TreeTableComponent } from '@farris/ui-treetable';
import { DatagridComponent } from '@farris/ui-datagrid';
import { LocalePipe } from '../../pipe/locale.pipe';
import { MessagerService } from '@farris/ui-messager';
var PullSelectorComponent = /** @class */ (function () {
    function PullSelectorComponent(args, dataService, localeId, loading, elementRef, inj, cfr, messagerService) {
        var _this = this;
        this.dataService = dataService;
        this.loading = loading;
        this.elementRef = elementRef;
        this.inj = inj;
        this.cfr = cfr;
        this.messagerService = messagerService;
        this.ttData = [];
        this.ttIdField = 'voId';
        this.ttSearchFields = [];
        this.dgData = [];
        this.dgIdField = 'id';
        this.procData = [];
        this.scene = "Pull";
        this.bsModalRef4BifSelector = null;
        this.subject4CreationProcess = new Subject();
        this.clickOk4BifSelector = (/**
         * @return {?}
         */
        function () {
            if (_this.selectedEntity == null) {
                _this.messagerService.error(_this.localePipe.instant("pleaseSelectOneCreationProcess"));
                return;
            }
            _this.subject4CreationProcess.next(_this.selectedEntity);
            _this.subject4CreationProcess.complete();
            _this.bsModalRef4BifSelector.close();
        });
        this.clickClose4BifSelector = (/**
         * @return {?}
         */
        function () {
            _this.bsModalRef4BifSelector.close();
        });
        this.args = new FormGetBillCreationProcessEntityExArgs();
        this.args.LoadFromJsonObject(args);
        this.localePipe = new LocalePipe(localeId);
        if (inj == null) {
            /** @type {?} */
            var refInj = ReflectiveInjector.resolveAndCreate([
                MessagerService,
            ]);
            this.inj = refInj;
        }
        this.cfr = cfr || this.inj.get(ComponentFactoryResolver);
        this.messagerService = messagerService || this.inj.get(MessagerService, null);
    }
    /**
     * @return {?}
     */
    PullSelectorComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        this.ttDataRoot = {
            id: "*",
            data: {
                voId: "*",
                voName: this.localePipe.instant("all"),
            },
            parent: null,
            expanded: true,
            children: [],
        };
        this.ttData = [this.ttDataRoot];
        this.configTtColumns();
        this.configDgColumns();
        this.configTtEvents();
        this.configDgEvents();
        this.loadItems();
    };
    /**
     * @private
     * @return {?}
     */
    PullSelectorComponent.prototype.loadItems = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        this.loading.show({ container: this.elementRef });
        /** @type {?} */
        var list$ = null;
        if (this.args.upBillVoId == null) {
            list$ = this.dataService.getSlimBillCreationProcessEntityExesByDownBillVoId4Pull(this.args.downBillVoId);
        }
        else {
            list$ = this.dataService.getSlimBillCreationProcessEntityExesByUpBillVoIdAndDownBillVoId4SpecificPull(this.args.upBillVoId, this.args.downBillVoId);
        }
        list$.subscribe((/**
         * @param {?} result
         * @return {?}
         */
        function (result) {
            _this.loading.close();
            _this.procData = result || [];
            _this.dgData = tslib_1.__spread(_this.procData);
            // 组织VO树
            /** @type {?} */
            var voList = [];
            _this.procData.forEach((/**
             * @param {?} it
             * @return {?}
             */
            function (it) {
                if (voList.some((/**
                 * @param {?} vo
                 * @return {?}
                 */
                function (vo) { return vo.voId == it.upBillVoId; })) == false) {
                    voList.push({
                        voId: it.upBillVoId,
                        voName: it.upBillVoName,
                    });
                }
            }));
            _this.ttDataRoot.children = voList.map((/**
             * @param {?} it
             * @return {?}
             */
            function (it) {
                return {
                    id: it.voId,
                    data: {
                        voId: it.voId,
                        voName: it.voName,
                    },
                    expanded: true,
                };
            }));
            _this.ttData = [_this.ttDataRoot];
            // 默认选中第一条
            if (_this.dgData && _this.dgData.length > 0) {
                _this.selectedEntity = _this.dgData[0];
                setTimeout((/**
                 * @return {?}
                 */
                function () {
                    _this.dg.clearSelections();
                    _this.dg.selectRow(_this.dgData[0].id);
                }), 0);
            }
        }), (/**
         * @param {?} err
         * @return {?}
         */
        function (err) {
            _this.loading.close();
            throw err;
        }));
    };
    /**
     * @return {?}
     */
    PullSelectorComponent.prototype.configTtColumns = /**
     * @return {?}
     */
    function () {
        this.ttCols = [
            {
                field: 'voName', title: this.localePipe.instant('upstreamBill'), width: 120,
            },
        ];
    };
    /**
     * @return {?}
     */
    PullSelectorComponent.prototype.configDgColumns = /**
     * @return {?}
     */
    function () {
        this.dgCols = [
            { field: "code", title: this.localePipe.transform("processCode"), width: 120, sortable: true },
            {
                field: "name", title: this.localePipe.transform("processName"), width: 250, sortable: true,
            },
        ];
    };
    /**
     * @return {?}
     */
    PullSelectorComponent.prototype.configTtEvents = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.tt.nodeSelected.subscribe((/**
         * @param {?} ctx
         * @return {?}
         */
        function (ctx) {
            //ctx:{inidex;instance;node:{data}}
            if (ctx.node.id == "*") {
                _this.dgData = tslib_1.__spread(_this.procData);
            }
            else {
                _this.dgData = tslib_1.__spread(_this.procData.filter((/**
                 * @param {?} it
                 * @return {?}
                 */
                function (it) { return it.upBillVoId == ctx.node.data.voId; })));
            }
            if (_this.dgData && _this.dgData.length > 0) {
                _this.selectedEntity = _this.dgData[0];
                setTimeout((/**
                 * @return {?}
                 */
                function () {
                    _this.dg.clearSelections();
                    _this.dg.selectRow(_this.dgData[0].id);
                }), 0);
            }
        }));
    };
    /**
     * @return {?}
     */
    PullSelectorComponent.prototype.configDgEvents = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.dg.selectChanged.subscribe((/**
         * @param {?} row
         * @return {?}
         */
        function (row) {
            _this.selectedEntity = row.data;
        }));
    };
    PullSelectorComponent.decorators = [
        { type: Component, args: [{
                    selector: 'lib-bif-pull-selector',
                    template: "<div class=\"g-main\" style=\"padding-left: 24px; padding-right: 24px;\">\r\n  <div class=\"d-flex flex-row\"\r\n    style=\"height: 100%; width: 100%; border: 1px solid #E9ECF3; box-shadow: 0 2px 6px 0 rgb(31 35 41 / 6%); border-radius: 6px;\">\r\n    <div class=\"d-flex flex-column\" style=\"width: 200px;\" ngResizable rzAspectRatio=\"true\" [rzHandles]=\"'e'\">\r\n      <farris-treetable #tt class=\"f-utils-fill-flex-column\" [data]=\"ttData\" [columns]=\"ttCols\" [idField]=\"ttIdField\"\r\n        [fit]=\"true\" [showHeader]=\"true\" [fixedHeader]=\"true\" [singleSelect]=\"true\">\r\n      </farris-treetable>\r\n    </div>\r\n\r\n    <div class=\"f-utils-fill-flex-row\" style=\"padding-left: 15px;\">\r\n      <div class=\"d-flex flex-column\" style=\"width: 100%;\">\r\n        <div class=\"f-utils-fill-flex-column\">\r\n          <farris-datagrid #dg [fit]=\"true\" [fitColumns]=\"true\" [data]=\"dgData\" [columns]=\"dgCols\" [idField]=\"dgIdField\"\r\n            [showHeader]=\"true\" [showBorder]=\"true\" [striped]=\"true\" [pagination]=\"false\" [showLineNumber]=\"true\">\r\n          </farris-datagrid>\r\n        </div>\r\n        <div class=\"form-group\" style=\"\">\r\n          <div>{{ 'processDesciption' | locale }}</div>\r\n          <textarea readonly class=\"form-control\" name=\"description\" rows=\"3\"\r\n            [ngModel]=\"selectedEntity&&selectedEntity.description\"></textarea>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</div>\r\n",
                    styles: [""]
                }] }
    ];
    /** @nocollapse */
    PullSelectorComponent.ctorParameters = function () { return [
        { type: undefined, decorators: [{ type: Inject, args: [SELECTOR_ARGS_INJECTOR,] }] },
        { type: BifDataService },
        { type: String, decorators: [{ type: Inject, args: [LOCALE_ID,] }] },
        { type: LoadingService },
        { type: ElementRef },
        { type: Injector, decorators: [{ type: Optional }] },
        { type: ComponentFactoryResolver, decorators: [{ type: Optional }] },
        { type: MessagerService, decorators: [{ type: Optional }] }
    ]; };
    PullSelectorComponent.propDecorators = {
        tt: [{ type: ViewChild, args: ['tt',] }],
        dg: [{ type: ViewChild, args: ['dg',] }]
    };
    return PullSelectorComponent;
}());
export { PullSelectorComponent };
if (false) {
    /** @type {?} */
    PullSelectorComponent.prototype.tt;
    /** @type {?} */
    PullSelectorComponent.prototype.ttData;
    /** @type {?} */
    PullSelectorComponent.prototype.ttDataRoot;
    /** @type {?} */
    PullSelectorComponent.prototype.ttCols;
    /** @type {?} */
    PullSelectorComponent.prototype.ttIdField;
    /** @type {?} */
    PullSelectorComponent.prototype.ttSearchFields;
    /** @type {?} */
    PullSelectorComponent.prototype.ttSearchObj;
    /** @type {?} */
    PullSelectorComponent.prototype.dg;
    /** @type {?} */
    PullSelectorComponent.prototype.dgData;
    /** @type {?} */
    PullSelectorComponent.prototype.dgCols;
    /** @type {?} */
    PullSelectorComponent.prototype.dgIdField;
    /** @type {?} */
    PullSelectorComponent.prototype.localePipe;
    /** @type {?} */
    PullSelectorComponent.prototype.procData;
    /** @type {?} */
    PullSelectorComponent.prototype.scene;
    /**
     * 选中的生单流程
     * @type {?}
     */
    PullSelectorComponent.prototype.selectedEntity;
    /** @type {?} */
    PullSelectorComponent.prototype.bsModalRef4BifSelector;
    /** @type {?} */
    PullSelectorComponent.prototype.subject4CreationProcess;
    /**
     * @type {?}
     * @private
     */
    PullSelectorComponent.prototype.args;
    /** @type {?} */
    PullSelectorComponent.prototype.clickOk4BifSelector;
    /** @type {?} */
    PullSelectorComponent.prototype.clickClose4BifSelector;
    /**
     * @type {?}
     * @private
     */
    PullSelectorComponent.prototype.dataService;
    /**
     * @type {?}
     * @private
     */
    PullSelectorComponent.prototype.loading;
    /**
     * @type {?}
     * @private
     */
    PullSelectorComponent.prototype.elementRef;
    /** @type {?} */
    PullSelectorComponent.prototype.inj;
    /** @type {?} */
    PullSelectorComponent.prototype.cfr;
    /** @type {?} */
    PullSelectorComponent.prototype.messagerService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHVsbC1zZWxlY3Rvci5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZWRwLWJpZi9ydW50aW1lLWFwaS8iLCJzb3VyY2VzIjpbImxpYi9iaWYtbWFudWFsLWNyZWF0aW9uL2NvbXBvbmVudHMvcHVsbC1zZWxlY3Rvci9wdWxsLXNlbGVjdG9yLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFVLE1BQU0sRUFBRSxTQUFTLEVBQUUsVUFBVSxFQUFFLFNBQVMsRUFBRSxRQUFRLEVBQUUsd0JBQXdCLEVBQUUsUUFBUSxFQUFFLGtCQUFrQixFQUFFLE1BQU0sZUFBZSxDQUFDO0FBRTlKLE9BQU8sRUFBRSxPQUFPLEVBQWMsTUFBTSxNQUFNLENBQUM7QUFDM0MsT0FBTyxFQUFFLHNCQUFzQixFQUFnQixNQUFNLDRDQUE0QyxDQUFDO0FBQ2xHLE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSxnQ0FBZ0MsQ0FBQztBQUVoRSxPQUFPLEVBQUUsc0NBQXNDLEVBQUUsTUFBTSxrRUFBa0UsQ0FBQztBQUUxSCxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sb0JBQW9CLENBQUM7QUFDcEQsT0FBTyxFQUFZLGtCQUFrQixFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFDcEUsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDeEQsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLHdCQUF3QixDQUFDO0FBQ3BELE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUV0RDtJQXNDRSwrQkFDa0MsSUFBa0IsRUFDMUMsV0FBMkIsRUFDaEIsUUFBZ0IsRUFDM0IsT0FBdUIsRUFDdkIsVUFBc0IsRUFDWCxHQUFhLEVBQ2IsR0FBNkIsRUFDN0IsZUFBZ0M7UUFSckQsaUJBc0JDO1FBcEJTLGdCQUFXLEdBQVgsV0FBVyxDQUFnQjtRQUUzQixZQUFPLEdBQVAsT0FBTyxDQUFn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QThCOztJQUM5QixvQ0FBZ0M7O0lBQ2hDLG9DQUFnRDs7SUFDaEQsZ0RBQW1EIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBPbkluaXQsIEluamVjdCwgTE9DQUxFX0lELCBFbGVtZW50UmVmLCBWaWV3Q2hpbGQsIEluamVjdG9yLCBDb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIsIE9wdGlvbmFsLCBSZWZsZWN0aXZlSW5qZWN0b3IgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgQnNNb2RhbFJlZiB9IGZyb20gJ0BmYXJyaXMvdWktbW9kYWwnO1xyXG5pbXBvcnQgeyBTdWJqZWN0LCBPYnNlcnZhYmxlIH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7IFNFTEVDVE9SX0FSR1NfSU5KRUNUT1IsIFNlbGVjdG9yQXJncyB9IGZyb20gJy4uLy4uL2NvbmZpZy9zZWxlY3Rvci1hcmdzLWluamVjdG9yLmNvbmZpZyc7XHJcbmltcG9ydCB7IEJpZkRhdGFTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vc2VydmljZS9iaWYtZGF0YS5zZXJ2aWNlJztcclxuaW1wb3J0IHsgSVJ0U2xpbUJpbGxDcmVhdGlvblByb2Nlc3NFbnRpdHlFeCB9IGZyb20gJ0BlZHAtYmlmL2NvbW1vbi1hcGknO1xyXG5pbXBvcnQgeyBGb3JtR2V0QmlsbENyZWF0aW9uUHJvY2Vzc0VudGl0eUV4QXJncyB9IGZyb20gJy4uLy4uLy4uL2VudGl0eS9mb3JtLXJlc3QvRm9ybUdldEJpbGxDcmVhdGlvblByb2Nlc3NFbnRpdHlFeEFyZ3MnO1xyXG5pbXBvcnQgeyBJQmlmQ3JlYXRpb25Qcm9jZXNzU2VsZWN0b3JDb21wb25lbnQgfSBmcm9tICcuLi8uLi9iYXNlL0lCaWZDcmVhdGlvblByb2Nlc3NTZWxlY3RvckNvbXBvbmVudCc7XHJcbmltcG9ydCB7IExvYWRpbmdTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy91aS1sb2FkaW5nJztcclxuaW1wb3J0IHsgVHJlZU5vZGUsIFRyZWVUYWJsZUNvbXBvbmVudCB9IGZyb20gJ0BmYXJyaXMvdWktdHJlZXRhYmxlJztcclxuaW1wb3J0IHsgRGF0YWdyaWRDb21wb25lbnQgfSBmcm9tICdAZmFycmlzL3VpLWRhdGFncmlkJztcclxuaW1wb3J0IHsgTG9jYWxlUGlwZSB9IGZyb20gJy4uLy4uL3BpcGUvbG9jYWxlLnBpcGUnO1xyXG5pbXBvcnQgeyBNZXNzYWdlclNlcnZpY2UgfSBmcm9tICdAZmFycmlzL3VpLW1lc3NhZ2VyJztcclxuXHJcbkBDb21wb25lbnQoe1xyXG4gIHNlbGVjdG9yOiAnbGliLWJpZi1wdWxsLXNlbGVjdG9yJyxcclxuICB0ZW1wbGF0ZVVybDogJy4vcHVsbC1zZWxlY3Rvci5jb21wb25lbnQuaHRtbCcsXHJcbiAgc3R5bGVVcmxzOiBbJy4vcHVsbC1zZWxlY3Rvci5jb21wb25lbnQuY3NzJ11cclxufSlcclxuZXhwb3J0IGNsYXNzIFB1bGxTZWxlY3RvckNvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgSUJpZkNyZWF0aW9uUHJvY2Vzc1NlbGVjdG9yQ29tcG9uZW50IHtcclxuICBAVmlld0NoaWxkKCd0dCcpXHJcbiAgdHQ6IFRyZWVUYWJsZUNvbXBvbmVudDtcclxuICB0dERhdGE6IFRyZWVOb2RlW10gPSBbXTtcclxuICB0dERhdGFSb290OiBUcmVlTm9kZTtcclxuICB0dENvbHM6IGFueVtdO1xyXG4gIHR0SWRGaWVsZCA9ICd2b0lkJztcclxuICB0dFNlYXJjaEZpZWxkczoge1xyXG4gICAgbGFiZWw6IHN0cmluZztcclxuICAgIHZhbHVlOiBzdHJpbmc7XHJcbiAgfVtdID0gW107XHJcbiAgdHRTZWFyY2hPYmo6IHsgZmllbGQ6IHN0cmluZywgdmFsdWU6IHN0cmluZyB9O1xyXG5cclxuICBAVmlld0NoaWxkKCdkZycpXHJcbiAgZGc6IERhdGFncmlkQ29tcG9uZW50O1xyXG4gIGRnRGF0YTogYW55W10gPSBbXTtcclxuICBkZ0NvbHM6IGFueVtdO1xyXG4gIGRnSWRGaWVsZCA9ICdpZCc7XHJcbiAgbG9jYWxlUGlwZTogTG9jYWxlUGlwZTtcclxuXHJcbiAgcHJvY0RhdGE6IElSdFNsaW1CaWxsQ3JlYXRpb25Qcm9jZXNzRW50aXR5RXhbXSA9IFtdO1xyXG5cclxuICBzY2VuZTogXCJQdXNoXCIgfCBcIlB1bGxcIiA9IFwiUHVsbFwiO1xyXG5cclxuICAvKipcclxuICAgKiDpgInkuK3nmoTnlJ/ljZXmtYHnqItcclxuICAgKi9cclxuICBzZWxlY3RlZEVudGl0eTogSVJ0U2xpbUJpbGxDcmVhdGlvblByb2Nlc3NFbnRpdHlFeDtcclxuXHJcbiAgYnNNb2RhbFJlZjRCaWZTZWxlY3RvcjogQnNNb2RhbFJlZiA9IG51bGw7XHJcbiAgc3ViamVjdDRDcmVhdGlvblByb2Nlc3M6IFN1YmplY3Q8SVJ0U2xpbUJpbGxDcmVhdGlvblByb2Nlc3NFbnRpdHlFeD4gPSBuZXcgU3ViamVjdCgpO1xyXG5cclxuICBwcml2YXRlIGFyZ3M6IEZvcm1HZXRCaWxsQ3JlYXRpb25Qcm9jZXNzRW50aXR5RXhBcmdzO1xyXG4gIGNvbnN0cnVjdG9yKFxyXG4gICAgQEluamVjdChTRUxFQ1RPUl9BUkdTX0lOSkVDVE9SKSBhcmdzOiBTZWxlY3RvckFyZ3MsXHJcbiAgICBwcml2YXRlIGRhdGFTZXJ2aWNlOiBCaWZEYXRhU2VydmljZSxcclxuICAgIEBJbmplY3QoTE9DQUxFX0lEKSBsb2NhbGVJZDogc3RyaW5nLFxyXG4gICAgcHJpdmF0ZSBsb2FkaW5nOiBMb2FkaW5nU2VydmljZSxcclxuICAgIHByaXZhdGUgZWxlbWVudFJlZjogRWxlbWVudFJlZixcclxuICAgIEBPcHRpb25hbCgpIHB1YmxpYyBpbmo6IEluamVjdG9yLFxyXG4gICAgQE9wdGlvbmFsKCkgcHVibGljIGNmcjogQ29tcG9uZW50RmFjdG9yeVJlc29sdmVyLFxyXG4gICAgQE9wdGlvbmFsKCkgcHVibGljIG1lc3NhZ2VyU2VydmljZTogTWVzc2FnZXJTZXJ2aWNlLFxyXG4gICkge1xyXG4gICAgdGhpcy5hcmdzID0gbmV3IEZvcm1HZXRCaWxsQ3JlYXRpb25Qcm9jZXNzRW50aXR5RXhBcmdzKCk7XHJcbiAgICB0aGlzLmFyZ3MuTG9hZEZyb21Kc29uT2JqZWN0KGFyZ3MpO1xyXG4gICAgdGhpcy5sb2NhbGVQaXBlID0gbmV3IExvY2FsZVBpcGUobG9jYWxlSWQpO1xyXG5cclxuICAgIGlmIChpbmogPT0gbnVsbCkge1xyXG4gICAgICBjb25zdCByZWZJbmogPSBSZWZsZWN0aXZlSW5qZWN0b3IucmVzb2x2ZUFuZENyZWF0ZShbXHJcbiAgICAgICAgTWVzc2FnZXJTZXJ2aWNlLFxyXG4gICAgICBdKTtcclxuICAgICAgdGhpcy5pbmogPSByZWZJbmo7XHJcbiAgICB9XHJcbiAgICB0aGlzLmNmciA9IGNmciB8fCB0aGlzLmluai5nZXQoQ29tcG9uZW50RmFjdG9yeVJlc29sdmVyKTtcclxuICAgIHRoaXMubWVzc2FnZXJTZXJ2aWNlID0gbWVzc2FnZXJTZXJ2aWNlIHx8IHRoaXMuaW5qLmdldChNZXNzYWdlclNlcnZpY2UsIG51bGwpO1xyXG4gIH1cclxuXHJcbiAgbmdPbkluaXQoKSB7XHJcbiAgICB0aGlzLnR0RGF0YVJvb3QgPSB7XHJcbiAgICAgIGlkOiBcIipcIixcclxuICAgICAgZGF0YToge1xyXG4gICAgICAgIHZvSWQ6IFwiKlwiLFxyXG4gICAgICAgIHZvTmFtZTogdGhpcy5sb2NhbGVQaXBlLmluc3RhbnQoXCJhbGxcIiksXHJcbiAgICAgIH0sXHJcbiAgICAgIHBhcmVudDogbnVsbCxcclxuICAgICAgZXhwYW5kZWQ6IHRydWUsXHJcbiAgICAgIGNoaWxkcmVuOiBbXSxcclxuICAgIH07XHJcbiAgICB0aGlzLnR0RGF0YSA9IFt0aGlzLnR0RGF0YVJvb3RdO1xyXG4gICAgdGhpcy5jb25maWdUdENvbHVtbnMoKTtcclxuICAgIHRoaXMuY29uZmlnRGdDb2x1bW5zKCk7XHJcbiAgICB0aGlzLmNvbmZpZ1R0RXZlbnRzKCk7XHJcbiAgICB0aGlzLmNvbmZpZ0RnRXZlbnRzKCk7XHJcbiAgICB0aGlzLmxvYWRJdGVtcygpO1xyXG4gIH1cclxuXHJcbiAgY2xpY2tPazRCaWZTZWxlY3RvciA9ICgpID0+IHtcclxuICAgIGlmICh0aGlzLnNlbGVjdGVkRW50aXR5ID09IG51bGwpIHtcclxuICAgICAgdGhpcy5tZXNzYWdlclNlcnZpY2UuZXJyb3IodGhpcy5sb2NhbGVQaXBlLmluc3RhbnQoXCJwbGVhc2VTZWxlY3RPbmVDcmVhdGlvblByb2Nlc3NcIikpO1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICB0aGlzLnN1YmplY3Q0Q3JlYXRpb25Qcm9jZXNzLm5leHQodGhpcy5zZWxlY3RlZEVudGl0eSk7XHJcbiAgICB0aGlzLnN1YmplY3Q0Q3JlYXRpb25Qcm9jZXNzLmNvbXBsZXRlKCk7XHJcbiAgICB0aGlzLmJzTW9kYWxSZWY0QmlmU2VsZWN0b3IuY2xvc2UoKTtcclxuICB9O1xyXG5cclxuICBjbGlja0Nsb3NlNEJpZlNlbGVjdG9yID0gKCkgPT4ge1xyXG4gICAgdGhpcy5ic01vZGFsUmVmNEJpZlNlbGVjdG9yLmNsb3NlKCk7XHJcbiAgfTtcclxuXHJcbiAgcHJpdmF0ZSBsb2FkSXRlbXMoKTogdm9pZCB7XHJcbiAgICB0aGlzLmxvYWRpbmcuc2hvdyh7IGNvbnRhaW5lcjogdGhpcy5lbGVtZW50UmVmIH0pO1xyXG4gICAgbGV0IGxpc3QkOiBPYnNlcnZhYmxlPElSdFNsaW1CaWxsQ3JlYXRpb25Qcm9jZXNzRW50aXR5RXhbXT4gPSBudWxsO1xyXG4gICAgaWYgKHRoaXMuYXJncy51cEJpbGxWb0lkID09IG51bGwpIHtcclxuICAgICAgbGlzdCQgPSB0aGlzLmRhdGFTZXJ2aWNlLmdldFNsaW1CaWxsQ3JlYXRpb25Qcm9jZXNzRW50aXR5RXhlc0J5RG93bkJpbGxWb0lkNFB1bGwodGhpcy5hcmdzLmRvd25CaWxsVm9JZCk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBsaXN0JCA9IHRoaXMuZGF0YVNlcnZpY2UuZ2V0U2xpbUJpbGxDcmVhdGlvblByb2Nlc3NFbnRpdHlFeGVzQnlVcEJpbGxWb0lkQW5kRG93bkJpbGxWb0lkNFNwZWNpZmljUHVsbCh0aGlzLmFyZ3MudXBCaWxsVm9JZCwgdGhpcy5hcmdzLmRvd25CaWxsVm9JZCk7XHJcbiAgICB9XHJcbiAgICBsaXN0JC5zdWJzY3JpYmUoXHJcbiAgICAgIChyZXN1bHQ6IElSdFNsaW1CaWxsQ3JlYXRpb25Qcm9jZXNzRW50aXR5RXhbXSkgPT4ge1xyXG4gICAgICAgIHRoaXMubG9hZGluZy5jbG9zZSgpO1xyXG5cclxuICAgICAgICB0aGlzLnByb2NEYXRhID0gcmVzdWx0IHx8IFtdO1xyXG4gICAgICAgIHRoaXMuZGdEYXRhID0gWy4uLnRoaXMucHJvY0RhdGFdO1xyXG5cclxuICAgICAgICAvLyDnu4Tnu4dWT+agkVxyXG4gICAgICAgIGNvbnN0IHZvTGlzdDoge1xyXG4gICAgICAgICAgdm9JZDogc3RyaW5nLFxyXG4gICAgICAgICAgdm9OYW1lOiBzdHJpbmcsXHJcbiAgICAgICAgfVtdID0gW107XHJcbiAgICAgICAgdGhpcy5wcm9jRGF0YS5mb3JFYWNoKGl0ID0+IHtcclxuICAgICAgICAgIGlmICh2b0xpc3Quc29tZSh2byA9PiB2by52b0lkID09IGl0LnVwQmlsbFZvSWQpID09IGZhbHNlKSB7XHJcbiAgICAgICAgICAgIHZvTGlzdC5wdXNoKHtcclxuICAgICAgICAgICAgICB2b0lkOiBpdC51cEJpbGxWb0lkLFxyXG4gICAgICAgICAgICAgIHZvTmFtZTogaXQudXBCaWxsVm9OYW1lLFxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICB0aGlzLnR0RGF0YVJvb3QuY2hpbGRyZW4gPSB2b0xpc3QubWFwKGl0ID0+IHtcclxuICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIGlkOiBpdC52b0lkLFxyXG4gICAgICAgICAgICBkYXRhOiB7XHJcbiAgICAgICAgICAgICAgdm9JZDogaXQudm9JZCxcclxuICAgICAgICAgICAgICB2b05hbWU6IGl0LnZvTmFtZSxcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgZXhwYW5kZWQ6IHRydWUsXHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgdGhpcy50dERhdGEgPSBbdGhpcy50dERhdGFSb290XTtcclxuXHJcbiAgICAgICAgLy8g6buY6K6k6YCJ5Lit56ys5LiA5p2hXHJcbiAgICAgICAgaWYgKHRoaXMuZGdEYXRhICYmIHRoaXMuZGdEYXRhLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgIHRoaXMuc2VsZWN0ZWRFbnRpdHkgPSB0aGlzLmRnRGF0YVswXTtcclxuICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLmRnLmNsZWFyU2VsZWN0aW9ucygpO1xyXG4gICAgICAgICAgICB0aGlzLmRnLnNlbGVjdFJvdyh0aGlzLmRnRGF0YVswXS5pZCk7XHJcbiAgICAgICAgICB9LCAwKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0sXHJcbiAgICAgIChlcnIpID0+IHtcclxuICAgICAgICB0aGlzLmxvYWRpbmcuY2xvc2UoKTtcclxuICAgICAgICB0aHJvdyBlcnI7XHJcbiAgICAgIH1cclxuICAgICk7XHJcbiAgfVxyXG5cclxuICBjb25maWdUdENvbHVtbnMoKSB7XHJcbiAgICB0aGlzLnR0Q29scyA9IFtcclxuICAgICAge1xyXG4gICAgICAgIGZpZWxkOiAndm9OYW1lJywgdGl0bGU6IHRoaXMubG9jYWxlUGlwZS5pbnN0YW50KCd1cHN0cmVhbUJpbGwnKSwgd2lkdGg6IDEyMCxcclxuICAgICAgfSxcclxuICAgIF07XHJcbiAgfVxyXG5cclxuICBjb25maWdEZ0NvbHVtbnMoKSB7XHJcbiAgICB0aGlzLmRnQ29scyA9IFtcclxuICAgICAgeyBmaWVsZDogXCJjb2RlXCIsIHRpdGxlOiB0aGlzLmxvY2FsZVBpcGUudHJhbnNmb3JtKFwicHJvY2Vzc0NvZGVcIiksIHdpZHRoOiAxMjAsIHNvcnRhYmxlOiB0cnVlIH0sXHJcbiAgICAgIHtcclxuICAgICAgICBmaWVsZDogXCJuYW1lXCIsIHRpdGxlOiB0aGlzLmxvY2FsZVBpcGUudHJhbnNmb3JtKFwicHJvY2Vzc05hbWVcIiksIHdpZHRoOiAyNTAsIHNvcnRhYmxlOiB0cnVlLFxyXG4gICAgICB9LFxyXG4gICAgXTtcclxuICB9XHJcblxyXG4gIGNvbmZpZ1R0RXZlbnRzKCkge1xyXG4gICAgdGhpcy50dC5ub2RlU2VsZWN0ZWQuc3Vic2NyaWJlKChjdHgpID0+IHtcclxuICAgICAgLy9jdHg6e2luaWRleDtpbnN0YW5jZTtub2RlOntkYXRhfX1cclxuICAgICAgaWYgKGN0eC5ub2RlLmlkID09IFwiKlwiKSB7XHJcbiAgICAgICAgdGhpcy5kZ0RhdGEgPSBbLi4udGhpcy5wcm9jRGF0YV07XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgdGhpcy5kZ0RhdGEgPSBbLi4udGhpcy5wcm9jRGF0YS5maWx0ZXIoaXQgPT4gaXQudXBCaWxsVm9JZCA9PSBjdHgubm9kZS5kYXRhLnZvSWQpXTtcclxuICAgICAgfVxyXG4gICAgICBpZiAodGhpcy5kZ0RhdGEgJiYgdGhpcy5kZ0RhdGEubGVuZ3RoID4gMCkge1xyXG4gICAgICAgIHRoaXMuc2VsZWN0ZWRFbnRpdHkgPSB0aGlzLmRnRGF0YVswXTtcclxuICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgIHRoaXMuZGcuY2xlYXJTZWxlY3Rpb25zKCk7XHJcbiAgICAgICAgICB0aGlzLmRnLnNlbGVjdFJvdyh0aGlzLmRnRGF0YVswXS5pZCk7XHJcbiAgICAgICAgfSwgMCk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgY29uZmlnRGdFdmVudHMoKSB7XHJcbiAgICB0aGlzLmRnLnNlbGVjdENoYW5nZWQuc3Vic2NyaWJlKChyb3cpID0+IHtcclxuICAgICAgdGhpcy5zZWxlY3RlZEVudGl0eSA9IHJvdy5kYXRhO1xyXG4gICAgfSk7XHJcbiAgfVxyXG59XHJcbiJdfQ==
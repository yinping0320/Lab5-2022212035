/**
 * @fileoverview added by tsickle
 * Generated from: lib/bif-manual-creation/service/abstract-ui-service.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Injector, ComponentFactoryResolver, NgModuleFactoryLoader, Inject, LOCALE_ID, ComponentRef, ReflectiveInjector, Optional } from '@angular/core';
import { Observable, from } from 'rxjs';
import { switchMap } from 'rxjs/operators';
import { FrameContext } from '@farris/devkit';
import { BsModalService } from '@farris/ui-modal';
import { LocalePipe } from '../pipe/locale.pipe';
import { SELECTOR_ARGS_INJECTOR } from '../config/selector-args-injector.config';
import { MessagerService } from '@farris/ui-messager';
import { LoadingService } from '@farris/ui-loading';
import { RuntimeFrameworkService } from '@farris/command-services';
/**
 * @abstract
 */
var AbstractUiService = /** @class */ (function () {
    function AbstractUiService(frameContext, modalService, messager, injector, cfr, loader, localeId, runtimeFrameworkService) {
        this.frameContext = frameContext;
        this.modalService = modalService;
        this.messager = messager;
        this.injector = injector;
        this.cfr = cfr;
        this.loader = loader;
        this.localeId = localeId;
        /**
         * 内置模态框配置
         */
        this.defaultModalOptions = {
            title: null,
            width: 900,
            height: 500,
            buttons: null,
            showButtons: null,
        };
        this.runtimeFrameworkService = runtimeFrameworkService || injector.get(RuntimeFrameworkService);
        this.localePipe = new LocalePipe(localeId);
    }
    /**
     * @protected
     * @param {?} args
     * @param {?} type
     * @param {?=} modalOptions
     * @param {?=} customSelectorModuleUrl
     * @param {?=} extParams
     * @return {?}
     */
    AbstractUiService.prototype.openBillCreationProcessSelector = /**
     * @protected
     * @param {?} args
     * @param {?} type
     * @param {?=} modalOptions
     * @param {?=} customSelectorModuleUrl
     * @param {?=} extParams
     * @return {?}
     */
    function (args, type, modalOptions, customSelectorModuleUrl, extParams) {
        var _this = this;
        if (typeof modalOptions == "string") {
            if (modalOptions == "") {
                throw "modalOptions不可为空";
            }
            modalOptions = JSON.parse(modalOptions);
        }
        modalOptions = modalOptions == null ? this.defaultModalOptions : modalOptions;
        modalOptions.title = modalOptions.title == null ? this.localePipe.transform("creationProcessSelector") : modalOptions.title;
        /** @type {?} */
        var cmpR = null;
        if (customSelectorModuleUrl == null || customSelectorModuleUrl.trim() == "") {
            /** @type {?} */
            var cmpF = this.cfr.resolveComponentFactory(type);
            /** @type {?} */
            var inj = ReflectiveInjector.resolveAndCreate([
                { provide: SELECTOR_ARGS_INJECTOR, useValue: args.ConvertToJsonObject() },
                LoadingService,
            ], this.injector);
            cmpR = cmpF.create(inj);
            this.configModalButtons(modalOptions, cmpR);
            cmpR.instance.bsModalRef4BifSelector = this.modalService.show(cmpR, modalOptions);
            return cmpR.instance.subject4CreationProcess.asObservable();
        }
        else {
            return from(this.loader.load(customSelectorModuleUrl)).pipe(switchMap((/**
             * @param {?} moduleFactory
             * @return {?}
             */
            function (moduleFactory) {
                /** @type {?} */
                var moduleRef = moduleFactory.create(_this.frameContext.root.injector);
                /** @type {?} */
                var cmpR$ = moduleRef.instance.createCreationProcessSelector(_this.frameContext.root.injector, extParams);
                if (cmpR$ instanceof Observable) {
                    return cmpR$.pipe(switchMap((/**
                     * @param {?} componentRef
                     * @return {?}
                     */
                    function (componentRef) {
                        cmpR = componentRef;
                        _this.configModalButtons(modalOptions, cmpR);
                        cmpR.instance.bsModalRef4BifSelector = _this.modalService.show(cmpR, modalOptions);
                        return cmpR.instance.subject4CreationProcess.asObservable();
                    })));
                }
                else if (cmpR$ instanceof ComponentRef) {
                    cmpR = cmpR$;
                    _this.configModalButtons(modalOptions, cmpR);
                    cmpR.instance.bsModalRef4BifSelector = _this.modalService.show(cmpR, modalOptions);
                    return cmpR.instance.subject4CreationProcess.asObservable();
                }
            })));
        }
    };
    /**
     * 配置模态框按钮事件
     * @param modalOptions
     * @param cmpR
     */
    /**
     * 配置模态框按钮事件
     * @protected
     * @param {?} modalOptions
     * @param {?} cmpR
     * @return {?}
     */
    AbstractUiService.prototype.configModalButtons = /**
     * 配置模态框按钮事件
     * @protected
     * @param {?} modalOptions
     * @param {?} cmpR
     * @return {?}
     */
    function (modalOptions, cmpR) {
        modalOptions.buttons = [
            {
                text: this.localePipe.transform("confirm"),
                cls: "btn btn-primary",
                handle: cmpR.instance.clickOk4BifSelector,
            },
            {
                text: this.localePipe.transform("cancel"),
                cls: "btn btn-secondary",
                handle: cmpR.instance.clickClose4BifSelector,
            }
        ];
        modalOptions.showButtons = true;
    };
    /** @nocollapse */
    AbstractUiService.ctorParameters = function () { return [
        { type: FrameContext },
        { type: BsModalService },
        { type: MessagerService },
        { type: Injector },
        { type: ComponentFactoryResolver },
        { type: NgModuleFactoryLoader },
        { type: String, decorators: [{ type: Inject, args: [LOCALE_ID,] }] },
        { type: RuntimeFrameworkService, decorators: [{ type: Optional }] }
    ]; };
    return AbstractUiService;
}());
export { AbstractUiService };
if (false) {
    /**
     * 内置模态框配置
     * @type {?}
     * @protected
     */
    AbstractUiService.prototype.defaultModalOptions;
    /**
     * @type {?}
     * @protected
     */
    AbstractUiService.prototype.localePipe;
    /**
     * @type {?}
     * @protected
     */
    AbstractUiService.prototype.runtimeFrameworkService;
    /**
     * @type {?}
     * @protected
     */
    AbstractUiService.prototype.frameContext;
    /**
     * @type {?}
     * @protected
     */
    AbstractUiService.prototype.modalService;
    /**
     * @type {?}
     * @protected
     */
    AbstractUiService.prototype.messager;
    /**
     * @type {?}
     * @protected
     */
    AbstractUiService.prototype.injector;
    /**
     * @type {?}
     * @protected
     */
    AbstractUiService.prototype.cfr;
    /**
     * @type {?}
     * @protected
     */
    AbstractUiService.prototype.loader;
    /**
     * @type {?}
     * @protected
     */
    AbstractUiService.prototype.localeId;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYWJzdHJhY3QtdWktc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BlZHAtYmlmL3J1bnRpbWUtYXBpLyIsInNvdXJjZXMiOlsibGliL2JpZi1tYW51YWwtY3JlYXRpb24vc2VydmljZS9hYnN0cmFjdC11aS1zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsT0FBTyxFQUFFLFFBQVEsRUFBRSx3QkFBd0IsRUFBRSxxQkFBcUIsRUFBRSxNQUFNLEVBQUUsU0FBUyxFQUFFLFlBQVksRUFBb0Isa0JBQWtCLEVBQXlCLFFBQVEsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUNsTSxPQUFPLEVBQUUsVUFBVSxFQUFFLElBQUksRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUN4QyxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFFM0MsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQzlDLE9BQU8sRUFBRSxjQUFjLEVBQWdCLE1BQU0sa0JBQWtCLENBQUM7QUFHaEUsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQ2pELE9BQU8sRUFBRSxzQkFBc0IsRUFBRSxNQUFNLHlDQUF5QyxDQUFDO0FBS2pGLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUN0RCxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sb0JBQW9CLENBQUM7QUFDcEQsT0FBTyxFQUFFLHVCQUF1QixFQUFFLE1BQU0sMEJBQTBCLENBQUM7Ozs7QUFHbkU7SUFlSSwyQkFDYyxZQUEwQixFQUMxQixZQUE0QixFQUM1QixRQUF5QixFQUN6QixRQUFrQixFQUNsQixHQUE2QixFQUM3QixNQUE2QixFQUNWLFFBQWdCLEVBQ2pDLHVCQUFnRDtRQVBsRCxpQkFBWSxHQUFaLFlBQVksQ0FBYztRQUMxQixpQkFBWSxHQUFaLFlBQVksQ0FBZ0I7UUFDNUIsYUFBUSxHQUFSLFFBQVEsQ0FBaUI7UUFDekIs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QW1CO2dCQUN4QixNQUFNLEVBQUUsSUFBSSxDQUFDLFFBQVEsQ0FBQyxzQkFBc0I7YUFDL0M7U0FDSixDQUFDO1FBQ0YsWUFBWSxDQUFDLFdBQVcsR0FBRyxJQUFJLENBQUM7SUFDcEMsQ0FBQzs7O2dCQXBISSxZQUFZO2dCQUNaLGNBQWM7Z0JBU2QsZUFBZTtnQkFkZixRQUFRO2dCQUFFLHdCQUF3QjtnQkFBRSxxQkFBcUI7NkNBeUN6RCxNQUFNLFNBQUMsU0FBUztnQkF6QmhCLHVCQUF1Qix1QkEwQnZCLFFBQVE7O0lBK0VqQix3QkFBQztDQUFBLEFBdEdELElBc0dDO1NBdEdxQixpQkFBaUI7Ozs7Ozs7SUFJbkMsZ0RBTUU7Ozs7O0lBRUYsdUNBQWlDOzs7OztJQUNqQyxvREFBMkQ7Ozs7O0lBR3ZELHlDQUFvQzs7Ozs7SUFDcEMseUNBQXNDOzs7OztJQUN0QyxxQ0FBbUM7Ozs7O0lBQ25DLHFDQUE0Qjs7Ozs7SUFDNUIsZ0NBQXVDOzs7OztJQUN2QyxtQ0FBdUM7Ozs7O0lBQ3ZDLHFDQUE2QyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdG9yLCBDb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIsIE5nTW9kdWxlRmFjdG9yeUxvYWRlciwgSW5qZWN0LCBMT0NBTEVfSUQsIENvbXBvbmVudFJlZiwgQ29tcG9uZW50RmFjdG9yeSwgUmVmbGVjdGl2ZUluamVjdG9yLCBOZ01vZHVsZUZhY3RvcnksIFR5cGUsIE9wdGlvbmFsIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IE9ic2VydmFibGUsIGZyb20gfSBmcm9tICdyeGpzJztcclxuaW1wb3J0IHsgc3dpdGNoTWFwIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xyXG5cclxuaW1wb3J0IHsgRnJhbWVDb250ZXh0IH0gZnJvbSAnQGZhcnJpcy9kZXZraXQnO1xyXG5pbXBvcnQgeyBCc01vZGFsU2VydmljZSwgTW9kYWxPcHRpb25zIH0gZnJvbSAnQGZhcnJpcy91aS1tb2RhbCc7XHJcblxyXG5pbXBvcnQgeyBJUnRTbGltQmlsbENyZWF0aW9uUHJvY2Vzc0VudGl0eUV4IH0gZnJvbSAnQGVkcC1iaWYvY29tbW9uLWFwaSc7XHJcbmltcG9ydCB7IExvY2FsZVBpcGUgfSBmcm9tICcuLi9waXBlL2xvY2FsZS5waXBlJztcclxuaW1wb3J0IHsgU0VMRUNUT1JfQVJHU19JTkpFQ1RPUiB9IGZyb20gJy4uL2NvbmZpZy9zZWxlY3Rvci1hcmdzLWluamVjdG9yLmNvbmZpZyc7XHJcbmltcG9ydCB7IEZvcm1HZXRCaWxsQ3JlYXRpb25Qcm9jZXNzRW50aXR5RXhBcmdzIH0gZnJvbSAnLi4vLi4vZW50aXR5L2Zvcm0tcmVzdC9Gb3JtR2V0QmlsbENyZWF0aW9uUHJvY2Vzc0VudGl0eUV4QXJncyc7XHJcbmltcG9ydCB7IElCaWZDcmVhdGlvblByb2Nlc3NTZWxlY3RvckNvbXBvbmVudCB9IGZyb20gJy4uL2Jhc2UvSUJpZkNyZWF0aW9uUHJvY2Vzc1NlbGVjdG9yQ29tcG9uZW50JztcclxuaW1wb3J0IHsgSUJpZlNlbGVjdG9yQ29tcG9uZW50IH0gZnJvbSAnLi4vYmFzZS9JQmlmU2VsZWN0b3JDb21wb25lbnQnO1xyXG5pbXBvcnQgeyBJQmlmQ3JlYXRpb25Qcm9jZXNzU2VsZWN0b3JNb2R1bGUgfSBmcm9tICcuLi9iYXNlL0lCaWZDcmVhdGlvblByb2Nlc3NTZWxlY3Rvck1vZHVsZSc7XHJcbmltcG9ydCB7IE1lc3NhZ2VyU2VydmljZSB9IGZyb20gJ0BmYXJyaXMvdWktbWVzc2FnZXInO1xyXG5pbXBvcnQgeyBMb2FkaW5nU2VydmljZSB9IGZyb20gJ0BmYXJyaXMvdWktbG9hZGluZyc7XHJcbmltcG9ydCB7IFJ1bnRpbWVGcmFtZXdvcmtTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy9jb21tYW5kLXNlcnZpY2VzJztcclxuaW1wb3J0IHsgQWJzdHJhY3RCaWZEYXRhU2VsZWN0b3JTZXJ2aWNlIH0gZnJvbSAnLi9iaWYtZGF0YS1zZWxlY3Rvci5zZXJ2aWNlJztcclxuXHJcbmV4cG9ydCBhYnN0cmFjdCBjbGFzcyBBYnN0cmFjdFVpU2VydmljZSB7XHJcbiAgICAvKipcclxuICAgICAqIOWGhee9ruaooeaAgeahhumFjee9rlxyXG4gICAgICovXHJcbiAgICBwcm90ZWN0ZWQgcmVhZG9ubHkgZGVmYXVsdE1vZGFsT3B0aW9uczogTW9kYWxPcHRpb25zID0ge1xyXG4gICAgICAgIHRpdGxlOiBudWxsLFxyXG4gICAgICAgIHdpZHRoOiA5MDAsXHJcbiAgICAgICAgaGVpZ2h0OiA1MDAsXHJcbiAgICAgICAgYnV0dG9uczogbnVsbCxcclxuICAgICAgICBzaG93QnV0dG9uczogbnVsbCxcclxuICAgIH07XHJcblxyXG4gICAgcHJvdGVjdGVkIGxvY2FsZVBpcGU6IExvY2FsZVBpcGU7XHJcbiAgICBwcm90ZWN0ZWQgcnVudGltZUZyYW1ld29ya1NlcnZpY2U6IFJ1bnRpbWVGcmFtZXdvcmtTZXJ2aWNlO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKFxyXG4gICAgICAgIHByb3RlY3RlZCBmcmFtZUNvbnRleHQ6IEZyYW1lQ29udGV4dCxcclxuICAgICAgICBwcm90ZWN0ZWQgbW9kYWxTZXJ2aWNlOiBCc01vZGFsU2VydmljZSxcclxuICAgICAgICBwcm90ZWN0ZWQgbWVzc2FnZXI6IE1lc3NhZ2VyU2VydmljZSxcclxuICAgICAgICBwcm90ZWN0ZWQgaW5qZWN0b3I6IEluamVjdG9yLFxyXG4gICAgICAgIHByb3RlY3RlZCBjZnI6IENvbXBvbmVudEZhY3RvcnlSZXNvbHZlcixcclxuICAgICAgICBwcm90ZWN0ZWQgbG9hZGVyOiBOZ01vZHVsZUZhY3RvcnlMb2FkZXIsXHJcbiAgICAgICAgQEluamVjdChMT0NBTEVfSUQpIHByb3RlY3RlZCBsb2NhbGVJZDogc3RyaW5nLFxyXG4gICAgICAgIEBPcHRpb25hbCgpIHJ1bnRpbWVGcmFtZXdvcmtTZXJ2aWNlOiBSdW50aW1lRnJhbWV3b3JrU2VydmljZSxcclxuICAgICkge1xyXG4gICAgICAgIHRoaXMucnVudGltZUZyYW1ld29ya1NlcnZpY2UgPSBydW50aW1lRnJhbWV3b3JrU2VydmljZSB8fCBpbmplY3Rvci5nZXQoUnVudGltZUZyYW1ld29ya1NlcnZpY2UpO1xyXG4gICAgICAgIHRoaXMubG9jYWxlUGlwZSA9IG5ldyBMb2NhbGVQaXBlKGxvY2FsZUlkKTtcclxuICAgIH1cclxuXHJcbiAgICBwcm90ZWN0ZWQgb3BlbkJpbGxDcmVhdGlvblByb2Nlc3NTZWxlY3RvcihhcmdzOiBGb3JtR2V0QmlsbENyZWF0aW9uUHJvY2Vzc0VudGl0eUV4QXJncywgdHlwZTogVHlwZTxJQmlmQ3JlYXRpb25Qcm9jZXNzU2VsZWN0b3JDb21wb25lbnQ+LCBtb2RhbE9wdGlvbnM/OiBNb2RhbE9wdGlvbnMsIGN1c3RvbVNlbGVjdG9yTW9kdWxlVXJsPzogc3RyaW5nLCBleHRQYXJhbXM/OiB7fSk6IE9ic2VydmFibGU8SVJ0U2xpbUJpbGxDcmVhdGlvblByb2Nlc3NFbnRpdHlFeD4ge1xyXG4gICAgICAgIGlmICh0eXBlb2YgbW9kYWxPcHRpb25zID09IFwic3RyaW5nXCIpIHtcclxuICAgICAgICAgICAgaWYgKG1vZGFsT3B0aW9ucyA9PSBcIlwiKSB7XHJcbiAgICAgICAgICAgICAgICB0aHJvdyBcIm1vZGFsT3B0aW9uc+S4jeWPr+S4uuepulwiO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIG1vZGFsT3B0aW9ucyA9IEpTT04ucGFyc2UobW9kYWxPcHRpb25zKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIG1vZGFsT3B0aW9ucyA9IG1vZGFsT3B0aW9ucyA9PSBudWxsID8gdGhpcy5kZWZhdWx0TW9kYWxPcHRpb25zIDogbW9kYWxPcHRpb25zO1xyXG4gICAgICAgIG1vZGFsT3B0aW9ucy50aXRsZSA9IG1vZGFsT3B0aW9ucy50aXRsZSA9PSBudWxsID8gdGhpcy5sb2NhbGVQaXBlLnRyYW5zZm9ybShcImNyZWF0aW9uUHJvY2Vzc1NlbGVjdG9yXCIpIDogbW9kYWxPcHRpb25zLnRpdGxlO1xyXG5cclxuICAgICAgICBsZXQgY21wUjogQ29tcG9uZW50UmVmPElCaWZDcmVhdGlvblByb2Nlc3NTZWxlY3RvckNvbXBvbmVudD4gPSBudWxsO1xyXG4gICAgICAgIGlmIChjdXN0b21TZWxlY3Rvck1vZHVsZVVybCA9PSBudWxsIHx8IGN1c3RvbVNlbGVjdG9yTW9kdWxlVXJsLnRyaW0oKSA9PSBcIlwiKSB7XHJcbiAgICAgICAgICAgIGxldCBjbXBGOiBDb21wb25lbnRGYWN0b3J5PElCaWZDcmVhdGlvblByb2Nlc3NTZWxlY3RvckNvbXBvbmVudD4gPSB0aGlzLmNmci5yZXNvbHZlQ29tcG9uZW50RmFjdG9yeSh0eXBlKTtcclxuXHJcbiAgICAgICAgICAgIGxldCBpbmo6IEluamVjdG9yID0gUmVmbGVjdGl2ZUluamVjdG9yLnJlc29sdmVBbmRDcmVhdGUoW1xyXG4gICAgICAgICAgICAgICAgeyBwcm92aWRlOiBTRUxFQ1RPUl9BUkdTX0lOSkVDVE9SLCB1c2VWYWx1ZTogYXJncy5Db252ZXJ0VG9Kc29uT2JqZWN0KCkgfSxcclxuICAgICAgICAgICAgICAgIExvYWRpbmdTZXJ2aWNlLFxyXG4gICAgICAgICAgICBdLCB0aGlzLmluamVjdG9yKTtcclxuICAgICAgICAgICAgY21wUiA9IGNtcEYuY3JlYXRlKGluaik7XHJcbiAgICAgICAgICAgIHRoaXMuY29uZmlnTW9kYWxCdXR0b25zKG1vZGFsT3B0aW9ucywgY21wUik7XHJcblxyXG4gICAgICAgICAgICBjbXBSLmluc3RhbmNlLmJzTW9kYWxSZWY0QmlmU2VsZWN0b3IgPSB0aGlzLm1vZGFsU2VydmljZS5zaG93KGNtcFIsIG1vZGFsT3B0aW9ucyk7XHJcbiAgICAgICAgICAgIHJldHVybiBjbXBSLmluc3RhbmNlLnN1YmplY3Q0Q3JlYXRpb25Qcm9jZXNzLmFzT2JzZXJ2YWJsZSgpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiBmcm9tKHRoaXMubG9hZGVyLmxvYWQoY3VzdG9tU2VsZWN0b3JNb2R1bGVVcmwpKS5waXBlKFxyXG4gICAgICAgICAgICAgICAgc3dpdGNoTWFwKFxyXG4gICAgICAgICAgICAgICAgICAgIChtb2R1bGVGYWN0b3J5OiBOZ01vZHVsZUZhY3Rvcnk8SUJpZkNyZWF0aW9uUHJvY2Vzc1NlbGVjdG9yTW9kdWxlPikgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBtb2R1bGVSZWYgPSBtb2R1bGVGYWN0b3J5LmNyZWF0ZSh0aGlzLmZyYW1lQ29udGV4dC5yb290LmluamVjdG9yKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY21wUiQgPSBtb2R1bGVSZWYuaW5zdGFuY2UuY3JlYXRlQ3JlYXRpb25Qcm9jZXNzU2VsZWN0b3IodGhpcy5mcmFtZUNvbnRleHQucm9vdC5pbmplY3RvciwgZXh0UGFyYW1zKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNtcFIkIGluc3RhbmNlb2YgT2JzZXJ2YWJsZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNtcFIkLnBpcGUoXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoTWFwKFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoY29tcG9uZW50UmVmKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbXBSID0gY29tcG9uZW50UmVmO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jb25maWdNb2RhbEJ1dHRvbnMobW9kYWxPcHRpb25zLCBjbXBSKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNtcFIuaW5zdGFuY2UuYnNNb2RhbFJlZjRCaWZTZWxlY3RvciA9IHRoaXMubW9kYWxTZXJ2aWNlLnNob3coY21wUiwgbW9kYWxPcHRpb25zKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjbXBSLmluc3RhbmNlLnN1YmplY3Q0Q3JlYXRpb25Qcm9jZXNzLmFzT2JzZXJ2YWJsZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChjbXBSJCBpbnN0YW5jZW9mIENvbXBvbmVudFJlZikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY21wUiA9IGNtcFIkO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jb25maWdNb2RhbEJ1dHRvbnMobW9kYWxPcHRpb25zLCBjbXBSKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNtcFIuaW5zdGFuY2UuYnNNb2RhbFJlZjRCaWZTZWxlY3RvciA9IHRoaXMubW9kYWxTZXJ2aWNlLnNob3coY21wUiwgbW9kYWxPcHRpb25zKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjbXBSLmluc3RhbmNlLnN1YmplY3Q0Q3JlYXRpb25Qcm9jZXNzLmFzT2JzZXJ2YWJsZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgKVxyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOmFjee9ruaooeaAgeahhuaMiemSruS6i+S7tlxyXG4gICAgICogQHBhcmFtIG1vZGFsT3B0aW9uc1xyXG4gICAgICogQHBhcmFtIGNtcFJcclxuICAgICAqL1xyXG4gICAgcHJvdGVjdGVkIGNvbmZpZ01vZGFsQnV0dG9ucyhtb2RhbE9wdGlvbnM6IE1vZGFsT3B0aW9ucywgY21wUjogQ29tcG9uZW50UmVmPElCaWZTZWxlY3RvckNvbXBvbmVudD4pIHtcclxuICAgICAgICBtb2RhbE9wdGlvbnMuYnV0dG9ucyA9IFtcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgdGV4dDogdGhpcy5sb2NhbGVQaXBlLnRyYW5zZm9ybShcImNvbmZpcm1cIiksXHJcbiAgICAgICAgICAgICAgICBjbHM6IFwiYnRuIGJ0bi1wcmltYXJ5XCIsXHJcbiAgICAgICAgICAgICAgICBoYW5kbGU6IGNtcFIuaW5zdGFuY2UuY2xpY2tPazRCaWZTZWxlY3RvcixcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgdGV4dDogdGhpcy5sb2NhbGVQaXBlLnRyYW5zZm9ybShcImNhbmNlbFwiKSxcclxuICAgICAgICAgICAgICAgIGNsczogXCJidG4gYnRuLXNlY29uZGFyeVwiLFxyXG4gICAgICAgICAgICAgICAgaGFuZGxlOiBjbXBSLmluc3RhbmNlLmNsaWNrQ2xvc2U0QmlmU2VsZWN0b3IsXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICBdO1xyXG4gICAgICAgIG1vZGFsT3B0aW9ucy5zaG93QnV0dG9ucyA9IHRydWU7XHJcbiAgICB9XHJcbn1cclxuIl19
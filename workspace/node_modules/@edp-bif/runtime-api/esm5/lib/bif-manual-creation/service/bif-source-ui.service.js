/**
 * @fileoverview added by tsickle
 * Generated from: lib/bif-manual-creation/service/bif-source-ui.service.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Injectable, Injector, ComponentFactoryResolver, NgModuleFactoryLoader, Inject, LOCALE_ID, Optional } from '@angular/core';
import { AbstractUiService } from './abstract-ui-service';
import { NavigationService, RuntimeFrameworkService } from '@farris/command-services';
import { FrameContext } from '@farris/devkit';
import { BsModalService } from '@farris/ui-modal';
import { FormGetBillCreationProcessEntityExArgs } from '../../entity/form-rest/FormGetBillCreationProcessEntityExArgs';
import { PushSelectorComponent } from '../components/push-selector/push-selector.component';
import { BpmnModelJsonHelper } from '@edp-aif/common-api';
import { RpcCreationRuleExecutorResult } from '../../ref';
import { BIF_UISTATE_KEY_CREATION_RESULT } from '../config/bif-form-constants';
import { FormBillCreationProcessExecutorResult } from '@edp-aif/runtime-api';
import { ManualCreationMode } from '../../entity/form-rest/ManualCreationMode';
import { MessagerService } from '@farris/ui-messager';
import { judgeBrowserType } from "../../utils/BrowserUtil";
import { GeneralTextIdWithDataId } from '../../entity/form-rest/GeneralTextIdWithDataId';
var BifSourceUiService = /** @class */ (function (_super) {
    tslib_1.__extends(BifSourceUiService, _super);
    function BifSourceUiService(navigationService, frameContext, modalService, messager, injector, cfr, loader, localeId, runtimeFrameworkService) {
        var _this = _super.call(this, frameContext, modalService, messager, injector, cfr, loader, localeId, runtimeFrameworkService) || this;
        _this.navigationService = navigationService;
        _this.frameContext = frameContext;
        _this.modalService = modalService;
        _this.messager = messager;
        _this.injector = injector;
        _this.cfr = cfr;
        _this.loader = loader;
        _this.localeId = localeId;
        _this.uiStateKeyCreationResult = BIF_UISTATE_KEY_CREATION_RESULT;
        return _this;
    }
    /**
     * 下推时打开生单规则选择器
     */
    /**
     * 下推时打开生单规则选择器
     * @param {?} upBillVoId
     * @param {?=} bizFlowchartId
     * @param {?=} modalOptions
     * @param {?=} customSelectorModuleUrl
     * @param {?=} extParams
     * @return {?}
     */
    BifSourceUiService.prototype.openBillCreationProcessSelector4Push = /**
     * 下推时打开生单规则选择器
     * @param {?} upBillVoId
     * @param {?=} bizFlowchartId
     * @param {?=} modalOptions
     * @param {?=} customSelectorModuleUrl
     * @param {?=} extParams
     * @return {?}
     */
    function (upBillVoId, bizFlowchartId, modalOptions, customSelectorModuleUrl, extParams) {
        /** @type {?} */
        var args = new FormGetBillCreationProcessEntityExArgs();
        args.upBillVoId = upBillVoId;
        args.manualCreationMode = ManualCreationMode.Push;
        return this.openBillCreationProcessSelector(args, PushSelectorComponent, modalOptions, customSelectorModuleUrl, extParams);
    };
    /**
     * 特定下推时打开生单规则选择器
     */
    /**
     * 特定下推时打开生单规则选择器
     * @param {?} upBillVoId
     * @param {?} downBillVoId
     * @param {?=} bizFlowchartId
     * @param {?=} modalOptions
     * @param {?=} customSelectorModuleUrl
     * @param {?=} extParams
     * @return {?}
     */
    BifSourceUiService.prototype.openBillCreationProcessSelector4SpecificPush = /**
     * 特定下推时打开生单规则选择器
     * @param {?} upBillVoId
     * @param {?} downBillVoId
     * @param {?=} bizFlowchartId
     * @param {?=} modalOptions
     * @param {?=} customSelectorModuleUrl
     * @param {?=} extParams
     * @return {?}
     */
    function (upBillVoId, downBillVoId, bizFlowchartId, modalOptions, customSelectorModuleUrl, extParams) {
        /** @type {?} */
        var args = new FormGetBillCreationProcessEntityExArgs();
        args.upBillVoId = upBillVoId;
        args.downBillVoId = downBillVoId;
        args.manualCreationMode = ManualCreationMode.SpecificPush;
        // args.bizFlowchartId = bizFlowchartId;
        return this.openBillCreationProcessSelector(args, PushSelectorComponent, modalOptions, customSelectorModuleUrl, extParams);
    };
    /**
     * @Deprecated 已弃用，请使用{@link openTargetApp}
     * 打开下游单据制单界面
     * @param formSettings
     * @param creationResult
     * @param extParams
     */
    /**
     * \@Deprecated 已弃用，请使用{\@link openTargetApp}
     * 打开下游单据制单界面
     * @param {?} formSettings
     * @param {?} creationResult
     * @param {?=} extParams
     * @return {?}
     */
    BifSourceUiService.prototype.openTargetForm = /**
     * \@Deprecated 已弃用，请使用{\@link openTargetApp}
     * 打开下游单据制单界面
     * @param {?} formSettings
     * @param {?} creationResult
     * @param {?=} extParams
     * @return {?}
     */
    function (formSettings, creationResult, extParams) {
        var e_1, _a;
        if (formSettings == null) {
            throw "参数formSettings不可为空";
        }
        if (creationResult == null) {
            throw "参数creationResult不可为空";
        }
        if (typeof creationResult == "string") {
            if (creationResult == "") {
                throw "参数creationResult不可为空";
            }
            /** @type {?} */
            var temp = new FormBillCreationProcessExecutorResult();
            temp.LoadFromJson(creationResult);
            creationResult = temp;
        }
        if ((creationResult instanceof FormBillCreationProcessExecutorResult) == false) {
            /** @type {?} */
            var res = new FormBillCreationProcessExecutorResult();
            res.LoadFromJsonObject(creationResult);
            creationResult = res;
        }
        if (creationResult.conditionResult.conditionExecutionResult == false) {
            this.messager.error(creationResult.conditionResult.message || this.localePipe.transform("creationExecutionError"));
            return;
        }
        if (creationResult.creationRuleExecutorResult == null || creationResult.creationRuleExecutorResult.mappingResults == null || creationResult.creationRuleExecutorResult.mappingResults.length == 0) {
            this.messager.error(this.localePipe.transform("creationResultEmpty"));
            return;
        }
        else if (creationResult.creationRuleExecutorResult.mappingResults.length == 1) {
            // 从表单配置中取下游卡片加载命令
            /** @type {?} */
            var action = formSettings.targetCardAppLoadCmd;
            if (action != null && action != "") {
                if (extParams == null) {
                    extParams = {
                        action: action
                    };
                }
                else {
                    extParams["action"] = extParams["action"] != null && extParams["action"] != "" ? extParams["action"] : action;
                }
            }
            //只有一条数据则打开卡片
            this.openApp(creationResult.creationRuleExecutorResult.mappingResults[0].associations[0].tarRootDataId, formSettings.targetCardAppId, formSettings.targetCardAppEntrance, creationResult, extParams, false);
        }
        else {
            if (formSettings.targetListAppId != null) {
                // 多条数据且配置批量编辑界面
                throw "暂不支持打开批量编辑界面";
                this.openApp(creationResult.creationRuleExecutorResult.mappingResults[0].associations[0].tarRootDataId, formSettings.targetListAppId, formSettings.targetListAppEntrance, creationResult, extParams, false);
            }
            else {
                try {
                    //有多条数据但未配置批量编辑界面则打开多个卡片
                    for (var _b = tslib_1.__values(creationResult.creationRuleExecutorResult.mappingResults), _c = _b.next(); !_c.done; _c = _b.next()) {
                        var mappingResult = _c.value;
                        /** @type {?} */
                        var singleRes = new FormBillCreationProcessExecutorResult();
                        singleRes.conditionResult = creationResult.conditionResult;
                        singleRes.creationRuleExecutorResult = new RpcCreationRuleExecutorResult();
                        singleRes.creationRuleExecutorResult.bizFlowchartId = creationResult.creationRuleExecutorResult.bizFlowchartId;
                        singleRes.creationRuleExecutorResult.creationRuleId = creationResult.creationRuleExecutorResult.creationRuleId;
                        singleRes.creationRuleExecutorResult.creationRuleInstanceId = creationResult.creationRuleExecutorResult.creationRuleInstanceId;
                        singleRes.creationRuleExecutorResult.mappingResults = [mappingResult];
                        // 从表单配置中取下游卡片加载命令
                        /** @type {?} */
                        var action = formSettings.targetCardAppLoadCmd;
                        if (action != null && action != "") {
                            if (extParams == null) {
                                extParams = {
                                    action: action
                                };
                            }
                            else {
                                extParams["action"] = extParams["action"] != null && extParams["action"] != "" ? extParams["action"] : action;
                            }
                        }
                        this.openApp(mappingResult.associations[0].tarRootDataId, formSettings.targetCardAppId, formSettings.targetCardAppEntrance, singleRes, extParams, false);
                    }
                }
                catch (e_1_1) { e_1 = { error: e_1_1 }; }
                finally {
                    try {
                        if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
                    }
                    finally { if (e_1) throw e_1.error; }
                }
            }
        }
    };
    /**
     * @Deprecated
     * @param tabId
     * @param appId
     * @param appEntrance
     * @param creationResult
     * @param extParams
     * @param reload
     * @param tabName
     * @param enableRefresh
     * @param destructuring
     */
    /**
     * \@Deprecated
     * @private
     * @param {?} tabId
     * @param {?} appId
     * @param {?} appEntrance
     * @param {?} creationResult
     * @param {?=} extParams
     * @param {?=} reload
     * @param {?=} tabName
     * @param {?=} enableRefresh
     * @param {?=} destructuring
     * @return {?}
     */
    BifSourceUiService.prototype.openApp = /**
     * \@Deprecated
     * @private
     * @param {?} tabId
     * @param {?} appId
     * @param {?} appEntrance
     * @param {?} creationResult
     * @param {?=} extParams
     * @param {?=} reload
     * @param {?=} tabName
     * @param {?=} enableRefresh
     * @param {?=} destructuring
     * @return {?}
     */
    function (tabId, appId, appEntrance, creationResult, extParams, reload, tabName, enableRefresh, destructuring) {
        extParams = extParams == null ? {} : extParams;
        /** @type {?} */
        var browser = judgeBrowserType();
        if (browser.type == "IE" && browser.IEVersion == "IE11") {
            //IE11浏览器将生成结果转换为字符串存在top.localStorage，Id为tabId
            // console.log(tabId);
            window.top.localStorage.setItem(tabId, creationResult.ConvertToJson());
            this.navigationService.openApp(tabId, appId, appEntrance, extParams, reload, tabName, enableRefresh, destructuring);
        }
        else {
            this.navigationService.openApp(tabId, appId, appEntrance, this.buildRouteParams(creationResult, extParams), reload, tabName, enableRefresh, destructuring);
        }
    };
    /**
     * @Deprecated
     * @param action 目标App动作
     * @param pairs 其他实体参数键值对
     */
    /**
     * \@Deprecated
     * @private
     * @param {?} creationResult
     * @param {?} extParams
     * @return {?}
     */
    BifSourceUiService.prototype.buildRouteParams = /**
     * \@Deprecated
     * @private
     * @param {?} creationResult
     * @param {?} extParams
     * @return {?}
     */
    function (creationResult, extParams) {
        /** @type {?} */
        var params = extParams;
        params[this.uiStateKeyCreationResult] = creationResult.ConvertToJson();
        if (params["action"] == null || params["action"] == "") {
            params["action"] = "rootviewmodelbifLoad1";
        }
        return params;
    };
    /**
     * 打开下游单据制单界面
     * @param formSettings
     * @param creationResult
     * @param extParams
     */
    /**
     * 打开下游单据制单界面
     * @param {?} formSettings
     * @param {?} conditionResult
     * @param {?} textIdWithDataIds
     * @param {?=} extParams
     * @return {?}
     */
    BifSourceUiService.prototype.openTargetApp = /**
     * 打开下游单据制单界面
     * @param {?} formSettings
     * @param {?} conditionResult
     * @param {?} textIdWithDataIds
     * @param {?=} extParams
     * @return {?}
     */
    function (formSettings, conditionResult, textIdWithDataIds, extParams) {
        var e_2, _a;
        if (formSettings == null) {
            throw "参数formSettings不可为空";
        }
        if (textIdWithDataIds == null) {
            throw "参数creationResult不可为空";
        }
        if (typeof textIdWithDataIds == "string") {
            if (textIdWithDataIds == "") {
                throw "参数creationResult不可为空";
            }
            textIdWithDataIds = (/** @type {?} */ (BpmnModelJsonHelper.FromJson(textIdWithDataIds, GeneralTextIdWithDataId)));
        }
        if (conditionResult.conditionExecutionResult == false) {
            this.messager.error(conditionResult.message || this.localePipe.transform("creationExecutionError"));
            return;
        }
        if (textIdWithDataIds == null || textIdWithDataIds.length == null || textIdWithDataIds.length <= 0) {
            this.messager.error(this.localePipe.transform("creationResultEmpty"));
            return;
        }
        else if (textIdWithDataIds.length == 1) {
            // 从表单配置中取下游卡片加载命令
            /** @type {?} */
            var action = formSettings.targetCardAppLoadCmd;
            if (action != null && action != "") {
                if (extParams == null) {
                    extParams = {
                        action: action
                    };
                }
                else {
                    extParams["action"] = extParams["action"] != null && extParams["action"] != "" ? extParams["action"] : action;
                }
            }
            //只有一条数据则打开卡片
            this.openAppWithGeneralText(textIdWithDataIds[0].dataId, formSettings.targetCardAppId, formSettings.targetCardAppEntrance, textIdWithDataIds[0].generalTextId, extParams, false);
        }
        else {
            if (formSettings.targetListAppId != null) {
                // 多条数据且配置批量编辑界面
                throw "暂不支持打开批量编辑界面";
            }
            else {
                try {
                    //有多条数据但未配置批量编辑界面则打开多个卡片
                    for (var textIdWithDataIds_1 = tslib_1.__values(textIdWithDataIds), textIdWithDataIds_1_1 = textIdWithDataIds_1.next(); !textIdWithDataIds_1_1.done; textIdWithDataIds_1_1 = textIdWithDataIds_1.next()) {
                        var item = textIdWithDataIds_1_1.value;
                        // 从表单配置中取下游卡片加载命令
                        /** @type {?} */
                        var action = formSettings.targetCardAppLoadCmd;
                        if (action != null && action != "") {
                            if (extParams == null) {
                                extParams = {
                                    action: action
                                };
                            }
                            else {
                                extParams["action"] = extParams["action"] != null && extParams["action"] != "" ? extParams["action"] : action;
                            }
                        }
                        this.openAppWithGeneralText(item.dataId, formSettings.targetCardAppId, formSettings.targetCardAppEntrance, item.generalTextId, extParams, false);
                    }
                }
                catch (e_2_1) { e_2 = { error: e_2_1 }; }
                finally {
                    try {
                        if (textIdWithDataIds_1_1 && !textIdWithDataIds_1_1.done && (_a = textIdWithDataIds_1.return)) _a.call(textIdWithDataIds_1);
                    }
                    finally { if (e_2) throw e_2.error; }
                }
            }
        }
    };
    /**
     * @private
     * @param {?} tabId
     * @param {?} appId
     * @param {?} appEntrance
     * @param {?} textId
     * @param {?=} extParams
     * @param {?=} reload
     * @param {?=} tabName
     * @param {?=} enableRefresh
     * @param {?=} destructuring
     * @return {?}
     */
    BifSourceUiService.prototype.openAppWithGeneralText = /**
     * @private
     * @param {?} tabId
     * @param {?} appId
     * @param {?} appEntrance
     * @param {?} textId
     * @param {?=} extParams
     * @param {?=} reload
     * @param {?=} tabName
     * @param {?=} enableRefresh
     * @param {?=} destructuring
     * @return {?}
     */
    function (tabId, appId, appEntrance, textId, extParams, reload, tabName, enableRefresh, destructuring) {
        extParams = extParams == null ? {} : extParams;
        /** @type {?} */
        var browser = judgeBrowserType();
        if (browser.type == "IE" && browser.IEVersion == "IE11") {
            //IE11浏览器将生成结果转换为字符串存在top.localStorage，Id为tabId
            window.top.localStorage.setItem(tabId, textId);
            this.navigationService.openApp(tabId, appId, appEntrance, this.buildRouteParamsWithGeneralText(textId, extParams), reload, tabName, enableRefresh, destructuring);
        }
        else {
            this.navigationService.openApp(tabId, appId, appEntrance, this.buildRouteParamsWithGeneralText(textId, extParams), reload, tabName, enableRefresh, destructuring);
        }
    };
    /**
     *
     * @param action 目标App动作
     * @param pairs 其他实体参数键值对
     */
    /**
     *
     * @private
     * @param {?} textId
     * @param {?} extParams
     * @return {?}
     */
    BifSourceUiService.prototype.buildRouteParamsWithGeneralText = /**
     *
     * @private
     * @param {?} textId
     * @param {?} extParams
     * @return {?}
     */
    function (textId, extParams) {
        /** @type {?} */
        var params = extParams;
        params[this.uiStateKeyCreationResult] = textId;
        if (params["action"] == null || params["action"] == "") {
            params["action"] = "rootviewmodelbifLoad1";
        }
        return params;
    };
    BifSourceUiService.decorators = [
        { type: Injectable }
    ];
    /** @nocollapse */
    BifSourceUiService.ctorParameters = function () { return [
        { type: NavigationService },
        { type: FrameContext },
        { type: BsModalService },
        { type: MessagerService },
        { type: Injector },
        { type: ComponentFactoryResolver },
        { type: NgModuleFactoryLoader },
        { type: String, decorators: [{ type: Inject, args: [LOCALE_ID,] }] },
        { type: RuntimeFrameworkService, decorators: [{ type: Optional }] }
    ]; };
    return BifSourceUiService;
}(AbstractUiService));
export { BifSourceUiService };
if (false) {
    /**
     * @type {?}
     * @private
     */
    BifSourceUiService.prototype.uiStateKeyCreationResult;
    /**
     * @type {?}
     * @protected
     */
    BifSourceUiService.prototype.navigationService;
    /**
     * @type {?}
     * @protected
     */
    BifSourceUiService.prototype.frameContext;
    /**
     * @type {?}
     * @protected
     */
    BifSourceUiService.prototype.modalService;
    /**
     * @type {?}
     * @protected
     */
    BifSourceUiService.prototype.messager;
    /**
     * @type {?}
     * @protected
     */
    BifSourceUiService.prototype.injector;
    /**
     * @type {?}
     * @protected
     */
    BifSourceUiService.prototype.cfr;
    /**
     * @type {?}
     * @protected
     */
    BifSourceUiService.prototype.loader;
    /** @type {?} */
    BifSourceUiService.prototype.localeId;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmlmLXNvdXJjZS11aS5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGVkcC1iaWYvcnVudGltZS1hcGkvIiwic291cmNlcyI6WyJsaWIvYmlmLW1hbnVhbC1jcmVhdGlvbi9zZXJ2aWNlL2JpZi1zb3VyY2UtdWkuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLFFBQVEsRUFBRSx3QkFBd0IsRUFBRSxxQkFBcUIsRUFBRSxNQUFNLEVBQUUsU0FBUyxFQUFFLFFBQVEsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUNuSSxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQUMxRCxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsdUJBQXVCLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQztBQUN0RixPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDOUMsT0FBTyxFQUFFLGNBQWMsRUFBZ0IsTUFBTSxrQkFBa0IsQ0FBQztBQUVoRSxPQUFPLEVBQUUsc0NBQXNDLEVBQUUsTUFBTSwrREFBK0QsQ0FBQztBQUV2SCxPQUFPLEVBQUUscUJBQXFCLEVBQUUsTUFBTSxxREFBcUQsQ0FBQztBQUM1RixPQUFPLEVBQUUsbUJBQW1CLEVBQWdCLE1BQU0scUJBQXFCLENBQUM7QUFDeEUsT0FBTyxFQUFFLDZCQUE2QixFQUFFLE1BQU0sV0FBVyxDQUFDO0FBQzFELE9BQU8sRUFBRSwrQkFBK0IsRUFBRSxNQUFNLDhCQUE4QixDQUFDO0FBQy9FLE9BQU8sRUFBbUIscUNBQXFDLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUM5RixPQUFPLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSwyQ0FBMkMsQ0FBQztBQUMvRSxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDdEQsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0seUJBQXlCLENBQUE7QUFDMUQsT0FBTyxFQUFF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dkMsVUFBd0MsTUFBYyxFQUFFLFNBQWE7O1lBQzNELE1BQU0sR0FBRyxTQUFTO1FBQ3hCLE1BQU0sQ0FBQyxJQUFJLENBQUMsd0JBQXdCLENBQUMsR0FBRyxNQUFNLENBQUM7UUFDL0MsSUFBSSxNQUFNLENBQUMsUUFBUSxDQUFDLElBQUksSUFBSSxJQUFJLE1BQU0sQ0FBQyxRQUFRLENBQUMsSUFBSSxFQUFFLEVBQUU7WUFDcEQsTUFBTSxDQUFDLFFBQVEsQ0FBQyxHQUFHLHVCQUF1QixDQUFDO1NBQzlDO1FBRUQsT0FBTyxNQUFNLENBQUM7SUFDbEIsQ0FBQzs7Z0JBalRKLFVBQVU7Ozs7Z0JBaEJGLGlCQUFpQjtnQkFDakIsWUFBWTtnQkFDWixjQUFjO2dCQVVkLGVBQWU7Z0JBZEgsUUFBUTtnQkFBRSx3QkFBd0I7Z0JBQUUscUJBQXFCOzZDQThCckUsTUFBTSxTQUFDLFNBQVM7Z0JBNUJHLHVCQUF1Qix1QkE2QjFDLFFBQVE7O0lBcVNqQix5QkFBQztDQUFBLEFBbFRELENBQ3dDLGlCQUFpQixHQWlUeEQ7U0FqVFksa0JBQWtCOzs7Ozs7SUFDM0Isc0RBQTRFOzs7OztJQUd4RSwrQ0FBOEM7Ozs7O0lBQzlDLDBDQUFvQzs7Ozs7SUFDcEMsMENBQXNDOzs7OztJQUN0QyxzQ0FBbUM7Ozs7O0lBQ25DLHNDQUE0Qjs7Ozs7SUFDNUIsaUNBQXVDOzs7OztJQUN2QyxvQ0FBdUM7O0lBQ3ZDLHNDQUEwQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUsIEluamVjdG9yLCBDb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIsIE5nTW9kdWxlRmFjdG9yeUxvYWRlciwgSW5qZWN0LCBMT0NBTEVfSUQsIE9wdGlvbmFsIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IEFic3RyYWN0VWlTZXJ2aWNlIH0gZnJvbSAnLi9hYnN0cmFjdC11aS1zZXJ2aWNlJztcclxuaW1wb3J0IHsgTmF2aWdhdGlvblNlcnZpY2UsIFJ1bnRpbWVGcmFtZXdvcmtTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy9jb21tYW5kLXNlcnZpY2VzJztcclxuaW1wb3J0IHsgRnJhbWVDb250ZXh0IH0gZnJvbSAnQGZhcnJpcy9kZXZraXQnO1xyXG5pbXBvcnQgeyBCc01vZGFsU2VydmljZSwgTW9kYWxPcHRpb25zIH0gZnJvbSAnQGZhcnJpcy91aS1tb2RhbCc7XHJcbmltcG9ydCB7IElSdFNsaW1CaWxsQ3JlYXRpb25Qcm9jZXNzRW50aXR5RXggfSBmcm9tICdAZWRwLWJpZi9jb21tb24tYXBpJztcclxuaW1wb3J0IHsgRm9ybUdldEJpbGxDcmVhdGlvblByb2Nlc3NFbnRpdHlFeEFyZ3MgfSBmcm9tICcuLi8uLi9lbnRpdHkvZm9ybS1yZXN0L0Zvcm1HZXRCaWxsQ3JlYXRpb25Qcm9jZXNzRW50aXR5RXhBcmdzJztcclxuaW1wb3J0IHsgT2JzZXJ2YWJsZSB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQgeyBQdXNoU2VsZWN0b3JDb21wb25lbnQgfSBmcm9tICcuLi9jb21wb25lbnRzL3B1c2gtc2VsZWN0b3IvcHVzaC1zZWxlY3Rvci5jb21wb25lbnQnO1xyXG5pbXBvcnQgeyBCcG1uTW9kZWxKc29uSGVscGVyLCBGb3JtU2V0dGluZ3MgfSBmcm9tICdAZWRwLWFpZi9jb21tb24tYXBpJztcclxuaW1wb3J0IHsgUnBjQ3JlYXRpb25SdWxlRXhlY3V0b3JSZXN1bHQgfSBmcm9tICcuLi8uLi9yZWYnO1xyXG5pbXBvcnQgeyBCSUZfVUlTVEFURV9LRVlfQ1JFQVRJT05fUkVTVUxUIH0gZnJvbSAnLi4vY29uZmlnL2JpZi1mb3JtLWNvbnN0YW50cyc7XHJcbmltcG9ydCB7IENvbmRpdGlvblJlc3VsdCwgRm9ybUJpbGxDcmVhdGlvblByb2Nlc3NFeGVjdXRvclJlc3VsdCB9IGZyb20gJ0BlZHAtYWlmL3J1bnRpbWUtYXBpJztcclxuaW1wb3J0IHsgTWFudWFsQ3JlYXRpb25Nb2RlIH0gZnJvbSAnLi4vLi4vZW50aXR5L2Zvcm0tcmVzdC9NYW51YWxDcmVhdGlvbk1vZGUnO1xyXG5pbXBvcnQgeyBNZXNzYWdlclNlcnZpY2UgfSBmcm9tICdAZmFycmlzL3VpLW1lc3NhZ2VyJztcclxuaW1wb3J0IHsganVkZ2VCcm93c2VyVHlwZSB9IGZyb20gXCIuLi8uLi91dGlscy9Ccm93c2VyVXRpbFwiXHJcbmltcG9ydCB7IEdlbmVyYWxUZXh0SWRXaXRoRGF0YUlkIH0gZnJvbSAnLi4vLi4vZW50aXR5L2Zvcm0tcmVzdC9HZW5lcmFsVGV4dElkV2l0aERhdGFJZCc7XHJcblxyXG5ASW5qZWN0YWJsZSgpXHJcbmV4cG9ydCBjbGFzcyBCaWZTb3VyY2VVaVNlcnZpY2UgZXh0ZW5kcyBBYnN0cmFjdFVpU2VydmljZSB7XHJcbiAgICBwcml2YXRlIHJlYWRvbmx5IHVpU3RhdGVLZXlDcmVhdGlvblJlc3VsdCA9IEJJRl9VSVNUQVRFX0tFWV9DUkVBVElPTl9SRVNVTFQ7XHJcblxyXG4gICAgY29uc3RydWN0b3IoXHJcbiAgICAgICAgcHJvdGVjdGVkIG5hdmlnYXRpb25TZXJ2aWNlOiBOYXZpZ2F0aW9uU2VydmljZSxcclxuICAgICAgICBwcm90ZWN0ZWQgZnJhbWVDb250ZXh0OiBGcmFtZUNvbnRleHQsXHJcbiAgICAgICAgcHJvdGVjdGVkIG1vZGFsU2VydmljZTogQnNNb2RhbFNlcnZpY2UsXHJcbiAgICAgICAgcHJvdGVjdGVkIG1lc3NhZ2VyOiBNZXNzYWdlclNlcnZpY2UsXHJcbiAgICAgICAgcHJvdGVjdGVkIGluamVjdG9yOiBJbmplY3RvcixcclxuICAgICAgICBwcm90ZWN0ZWQgY2ZyOiBDb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIsXHJcbiAgICAgICAgcHJvdGVjdGVkIGxvYWRlcjogTmdNb2R1bGVGYWN0b3J5TG9hZGVyLFxyXG4gICAgICAgIEBJbmplY3QoTE9DQUxFX0lEKSBwdWJsaWMgbG9jYWxlSWQ6IHN0cmluZyxcclxuICAgICAgICBAT3B0aW9uYWwoKSBydW50aW1lRnJhbWV3b3JrU2VydmljZTogUnVudGltZUZyYW1ld29ya1NlcnZpY2UsXHJcbiAgICApIHtcclxuICAgICAgICBzdXBlcihmcmFtZUNvbnRleHQsIG1vZGFsU2VydmljZSwgbWVzc2FnZXIsIGluamVjdG9yLCBjZnIsIGxvYWRlciwgbG9jYWxlSWQsIHJ1bnRpbWVGcmFtZXdvcmtTZXJ2aWNlKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOS4i+aOqOaXtuaJk+W8gOeUn+WNleinhOWImemAieaLqeWZqFxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgb3BlbkJpbGxDcmVhdGlvblByb2Nlc3NTZWxlY3RvcjRQdXNoKHVwQmlsbFZvSWQ6IHN0cmluZywgYml6Rmxvd2NoYXJ0SWQ/OiBzdHJpbmcsIG1vZGFsT3B0aW9ucz86IE1vZGFsT3B0aW9ucywgY3VzdG9tU2VsZWN0b3JNb2R1bGVVcmw/OiBzdHJpbmcsIGV4dFBhcmFtcz86IHt9KTogT2JzZXJ2YWJsZTxJUnRTbGltQmlsbENyZWF0aW9uUHJvY2Vzc0VudGl0eUV4PiB7XHJcbiAgICAgICAgY29uc3QgYXJncyA9IG5ldyBGb3JtR2V0QmlsbENyZWF0aW9uUHJvY2Vzc0VudGl0eUV4QXJncygpO1xyXG4gICAgICAgIGFyZ3MudXBCaWxsVm9JZCA9IHVwQmlsbFZvSWQ7XHJcbiAgICAgICAgYXJncy5tYW51YWxDcmVhdGlvbk1vZGUgPSBNYW51YWxDcmVhdGlvbk1vZGUuUHVzaDtcclxuXHJcbiAgICAgICAgcmV0dXJuIHRoaXMub3BlbkJpbGxDcmVhdGlvblByb2Nlc3NTZWxlY3RvcihhcmdzLCBQdXNoU2VsZWN0b3JDb21wb25lbnQsIG1vZGFsT3B0aW9ucywgY3VzdG9tU2VsZWN0b3JNb2R1bGVVcmwsIGV4dFBhcmFtcyk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDnibnlrprkuIvmjqjml7bmiZPlvIDnlJ/ljZXop4TliJnpgInmi6nlmahcclxuICAgICAqL1xyXG4gICAgcHVibGljIG9wZW5CaWxsQ3JlYXRpb25Qcm9jZXNzU2VsZWN0b3I0U3BlY2lmaWNQdXNoKHVwQmlsbFZvSWQ6IHN0cmluZywgZG93bkJpbGxWb0lkOiBzdHJpbmcsIGJpekZsb3djaGFydElkPzogc3RyaW5nLCBtb2RhbE9wdGlvbnM/OiBNb2RhbE9wdGlvbnMsIGN1c3RvbVNlbGVjdG9yTW9kdWxlVXJsPzogc3RyaW5nLCBleHRQYXJhbXM/OiB7fSk6IE9ic2VydmFibGU8SVJ0U2xpbUJpbGxDcmVhdGlvblByb2Nlc3NFbnRpdHlFeD4ge1xyXG4gICAgICAgIGNvbnN0IGFyZ3MgPSBuZXcgRm9ybUdldEJpbGxDcmVhdGlvblByb2Nlc3NFbnRpdHlFeEFyZ3MoKTtcclxuICAgICAgICBhcmdzLnVwQmlsbFZvSWQgPSB1cEJpbGxWb0lkO1xyXG4gICAgICAgIGFyZ3MuZG93bkJpbGxWb0lkID0gZG93bkJpbGxWb0lkO1xyXG4gICAgICAgIGFyZ3MubWFudWFsQ3JlYXRpb25Nb2RlID0gTWFudWFsQ3JlYXRpb25Nb2RlLlNwZWNpZmljUHVzaDtcclxuICAgICAgICAvLyBhcmdzLmJpekZsb3djaGFydElkID0gYml6Rmxvd2NoYXJ0SWQ7XHJcblxyXG4gICAgICAgIHJldHVybiB0aGlzLm9wZW5CaWxsQ3JlYXRpb25Qcm9jZXNzU2VsZWN0b3IoYXJncywgUHVzaFNlbGVjdG9yQ29tcG9uZW50LCBtb2RhbE9wdGlvbnMsIGN1c3RvbVNlbGVjdG9yTW9kdWxlVXJsLCBleHRQYXJhbXMpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogQERlcHJlY2F0ZWQg5bey5byD55So77yM6K+35L2/55Soe0BsaW5rIG9wZW5UYXJnZXRBcHB9XHJcbiAgICAgKiDmiZPlvIDkuIvmuLjljZXmja7liLbljZXnlYzpnaJcclxuICAgICAqIEBwYXJhbSBmb3JtU2V0dGluZ3NcclxuICAgICAqIEBwYXJhbSBjcmVhdGlvblJlc3VsdFxyXG4gICAgICogQHBhcmFtIGV4dFBhcmFtc1xyXG4gICAgICovXHJcbiAgICBwdWJsaWMgb3BlblRhcmdldEZvcm0oZm9ybVNldHRpbmdzOiBGb3JtU2V0dGluZ3MsIGNyZWF0aW9uUmVzdWx0OiBGb3JtQmlsbENyZWF0aW9uUHJvY2Vzc0V4ZWN1dG9yUmVzdWx0LCBleHRQYXJhbXM/OiB7fSk6IHZvaWQge1xyXG4gICAgICAgIGlmIChmb3JtU2V0dGluZ3MgPT0gbnVsbCkge1xyXG4gICAgICAgICAgICB0aHJvdyBcIuWPguaVsGZvcm1TZXR0aW5nc+S4jeWPr+S4uuepulwiO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoY3JlYXRpb25SZXN1bHQgPT0gbnVsbCkge1xyXG4gICAgICAgICAgICB0aHJvdyBcIuWPguaVsGNyZWF0aW9uUmVzdWx05LiN5Y+v5Li656m6XCI7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0eXBlb2YgY3JlYXRpb25SZXN1bHQgPT0gXCJzdHJpbmdcIikge1xyXG4gICAgICAgICAgICBpZiAoY3JlYXRpb25SZXN1bHQgPT0gXCJcIikge1xyXG4gICAgICAgICAgICAgICAgdGhyb3cgXCLlj4LmlbBjcmVhdGlvblJlc3VsdOS4jeWPr+S4uuepulwiO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNvbnN0IHRlbXAgPSBuZXcgRm9ybUJpbGxDcmVhdGlvblByb2Nlc3NFeGVjdXRvclJlc3VsdCgpO1xyXG4gICAgICAgICAgICB0ZW1wLkxvYWRGcm9tSnNvbihjcmVhdGlvblJlc3VsdCk7XHJcbiAgICAgICAgICAgIGNyZWF0aW9uUmVzdWx0ID0gdGVtcDtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKChjcmVhdGlvblJlc3VsdCBpbnN0YW5jZW9mIEZvcm1CaWxsQ3JlYXRpb25Qcm9jZXNzRXhlY3V0b3JSZXN1bHQpID09IGZhbHNlKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHJlcyA9IG5ldyBGb3JtQmlsbENyZWF0aW9uUHJvY2Vzc0V4ZWN1dG9yUmVzdWx0KCk7XHJcbiAgICAgICAgICAgIHJlcy5Mb2FkRnJvbUpzb25PYmplY3QoY3JlYXRpb25SZXN1bHQpO1xyXG4gICAgICAgICAgICBjcmVhdGlvblJlc3VsdCA9IHJlcztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChjcmVhdGlvblJlc3VsdC5jb25kaXRpb25SZXN1bHQuY29uZGl0aW9uRXhlY3V0aW9uUmVzdWx0ID09IGZhbHNlKSB7XHJcbiAgICAgICAgICAgIHRoaXMubWVzc2FnZXIuZXJyb3IoY3JlYXRpb25SZXN1bHQuY29uZGl0aW9uUmVzdWx0Lm1lc3NhZ2UgfHwgdGhpcy5sb2NhbGVQaXBlLnRyYW5zZm9ybShcImNyZWF0aW9uRXhlY3V0aW9uRXJyb3JcIikpO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoY3JlYXRpb25SZXN1bHQuY3JlYXRpb25SdWxlRXhlY3V0b3JSZXN1bHQgPT0gbnVsbCB8fCBjcmVhdGlvblJlc3VsdC5jcmVhdGlvblJ1bGVFeGVjdXRvclJlc3VsdC5tYXBwaW5nUmVzdWx0cyA9PSBudWxsIHx8IGNyZWF0aW9uUmVzdWx0LmNyZWF0aW9uUnVsZUV4ZWN1dG9yUmVzdWx0Lm1hcHBpbmdSZXN1bHRzLmxlbmd0aCA9PSAwKSB7XHJcbiAgICAgICAgICAgIHRoaXMubWVzc2FnZXIuZXJyb3IodGhpcy5sb2NhbGVQaXBlLnRyYW5zZm9ybShcImNyZWF0aW9uUmVzdWx0RW1wdHlcIikpO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfSBlbHNlIGlmIChjcmVhdGlvblJlc3VsdC5jcmVhdGlvblJ1bGVFeGVjdXRvclJlc3VsdC5tYXBwaW5nUmVzdWx0cy5sZW5ndGggPT0gMSkge1xyXG4gICAgICAgICAgICAvLyDku47ooajljZXphY3nva7kuK3lj5bkuIvmuLjljaHniYfliqDovb3lkb3ku6RcclxuICAgICAgICAgICAgY29uc3QgYWN0aW9uID0gZm9ybVNldHRpbmdzLnRhcmdldENhcmRBcHBMb2FkQ21kO1xyXG4gICAgICAgICAgICBpZiAoYWN0aW9uICE9IG51bGwgJiYgYWN0aW9uICE9IFwiXCIpIHtcclxuICAgICAgICAgICAgICAgIGlmIChleHRQYXJhbXMgPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGV4dFBhcmFtcyA9IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uOiBhY3Rpb25cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGV4dFBhcmFtc1tcImFjdGlvblwiXSA9IGV4dFBhcmFtc1tcImFjdGlvblwiXSAhPSBudWxsICYmIGV4dFBhcmFtc1tcImFjdGlvblwiXSAhPSBcIlwiID8gZXh0UGFyYW1zW1wiYWN0aW9uXCJdIDogYWN0aW9uO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8v5Y+q5pyJ5LiA5p2h5pWw5o2u5YiZ5omT5byA5Y2h54mHXHJcbiAgICAgICAgICAgIHRoaXMub3BlbkFwcChcclxuICAgICAgICAgICAgICAgIGNyZWF0aW9uUmVzdWx0LmNyZWF0aW9uUnVsZUV4ZWN1dG9yUmVzdWx0Lm1hcHBpbmdSZXN1bHRzWzBdLmFzc29jaWF0aW9uc1swXS50YXJSb290RGF0YUlkLFxyXG4gICAgICAgICAgICAgICAgZm9ybVNldHRpbmdzLnRhcmdldENhcmRBcHBJZCxcclxuICAgICAgICAgICAgICAgIGZvcm1TZXR0aW5ncy50YXJnZXRDYXJkQXBwRW50cmFuY2UsXHJcbiAgICAgICAgICAgICAgICBjcmVhdGlvblJlc3VsdCxcclxuICAgICAgICAgICAgICAgIGV4dFBhcmFtcyxcclxuICAgICAgICAgICAgICAgIGZhbHNlXHJcbiAgICAgICAgICAgICk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgaWYgKGZvcm1TZXR0aW5ncy50YXJnZXRMaXN0QXBwSWQgIT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgLy8g5aSa5p2h5pWw5o2u5LiU6YWN572u5om56YeP57yW6L6R55WM6Z2iXHJcbiAgICAgICAgICAgICAgICB0aHJvdyBcIuaaguS4jeaUr+aMgeaJk+W8gOaJuemHj+e8lui+keeVjOmdolwiO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5vcGVuQXBwKFxyXG4gICAgICAgICAgICAgICAgICAgIGNyZWF0aW9uUmVzdWx0LmNyZWF0aW9uUnVsZUV4ZWN1dG9yUmVzdWx0Lm1hcHBpbmdSZXN1bHRzWzBdLmFzc29jaWF0aW9uc1swXS50YXJSb290RGF0YUlkLFxyXG4gICAgICAgICAgICAgICAgICAgIGZvcm1TZXR0aW5ncy50YXJnZXRMaXN0QXBwSWQsXHJcbiAgICAgICAgICAgICAgICAgICAgZm9ybVNldHRpbmdzLnRhcmdldExpc3RBcHBFbnRyYW5jZSxcclxuICAgICAgICAgICAgICAgICAgICBjcmVhdGlvblJlc3VsdCxcclxuICAgICAgICAgICAgICAgICAgICBleHRQYXJhbXMsXHJcbiAgICAgICAgICAgICAgICAgICAgZmFsc2VcclxuICAgICAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAvL+acieWkmuadoeaVsOaNruS9huacqumFjee9ruaJuemHj+e8lui+keeVjOmdouWImeaJk+W8gOWkmuS4quWNoeeJh1xyXG4gICAgICAgICAgICAgICAgZm9yIChsZXQgbWFwcGluZ1Jlc3VsdCBvZiBjcmVhdGlvblJlc3VsdC5jcmVhdGlvblJ1bGVFeGVjdXRvclJlc3VsdC5tYXBwaW5nUmVzdWx0cykge1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCBzaW5nbGVSZXMgPSBuZXcgRm9ybUJpbGxDcmVhdGlvblByb2Nlc3NFeGVjdXRvclJlc3VsdCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIHNpbmdsZVJlcy5jb25kaXRpb25SZXN1bHQgPSBjcmVhdGlvblJlc3VsdC5jb25kaXRpb25SZXN1bHQ7XHJcbiAgICAgICAgICAgICAgICAgICAgc2luZ2xlUmVzLmNyZWF0aW9uUnVsZUV4ZWN1dG9yUmVzdWx0ID0gbmV3IFJwY0NyZWF0aW9uUnVsZUV4ZWN1dG9yUmVzdWx0KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgc2luZ2xlUmVzLmNyZWF0aW9uUnVsZUV4ZWN1dG9yUmVzdWx0LmJpekZsb3djaGFydElkID0gY3JlYXRpb25SZXN1bHQuY3JlYXRpb25SdWxlRXhlY3V0b3JSZXN1bHQuYml6Rmxvd2NoYXJ0SWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgc2luZ2xlUmVzLmNyZWF0aW9uUnVsZUV4ZWN1dG9yUmVzdWx0LmNyZWF0aW9uUnVsZUlkID0gY3JlYXRpb25SZXN1bHQuY3JlYXRpb25SdWxlRXhlY3V0b3JSZXN1bHQuY3JlYXRpb25SdWxlSWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgc2luZ2xlUmVzLmNyZWF0aW9uUnVsZUV4ZWN1dG9yUmVzdWx0LmNyZWF0aW9uUnVsZUluc3RhbmNlSWQgPSBjcmVhdGlvblJlc3VsdC5jcmVhdGlvblJ1bGVFeGVjdXRvclJlc3VsdC5jcmVhdGlvblJ1bGVJbnN0YW5jZUlkO1xyXG4gICAgICAgICAgICAgICAgICAgIHNpbmdsZVJlcy5jcmVhdGlvblJ1bGVFeGVjdXRvclJlc3VsdC5tYXBwaW5nUmVzdWx0cyA9IFttYXBwaW5nUmVzdWx0XTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgLy8g5LuO6KGo5Y2V6YWN572u5Lit5Y+W5LiL5ri45Y2h54mH5Yqg6L295ZG95LukXHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgYWN0aW9uID0gZm9ybVNldHRpbmdzLnRhcmdldENhcmRBcHBMb2FkQ21kO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChhY3Rpb24gIT0gbnVsbCAmJiBhY3Rpb24gIT0gXCJcIikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZXh0UGFyYW1zID09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4dFBhcmFtcyA9IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb246IGFjdGlvblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZXh0UGFyYW1zW1wiYWN0aW9uXCJdID0gZXh0UGFyYW1zW1wiYWN0aW9uXCJdICE9IG51bGwgJiYgZXh0UGFyYW1zW1wiYWN0aW9uXCJdICE9IFwiXCIgPyBleHRQYXJhbXNbXCJhY3Rpb25cIl0gOiBhY3Rpb247XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5vcGVuQXBwKFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBtYXBwaW5nUmVzdWx0LmFzc29jaWF0aW9uc1swXS50YXJSb290RGF0YUlkLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3JtU2V0dGluZ3MudGFyZ2V0Q2FyZEFwcElkLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3JtU2V0dGluZ3MudGFyZ2V0Q2FyZEFwcEVudHJhbmNlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzaW5nbGVSZXMsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGV4dFBhcmFtcyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZmFsc2VcclxuICAgICAgICAgICAgICAgICAgICApO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogQERlcHJlY2F0ZWRcclxuICAgICAqIEBwYXJhbSB0YWJJZFxyXG4gICAgICogQHBhcmFtIGFwcElkXHJcbiAgICAgKiBAcGFyYW0gYXBwRW50cmFuY2VcclxuICAgICAqIEBwYXJhbSBjcmVhdGlvblJlc3VsdFxyXG4gICAgICogQHBhcmFtIGV4dFBhcmFtc1xyXG4gICAgICogQHBhcmFtIHJlbG9hZFxyXG4gICAgICogQHBhcmFtIHRhYk5hbWVcclxuICAgICAqIEBwYXJhbSBlbmFibGVSZWZyZXNoXHJcbiAgICAgKiBAcGFyYW0gZGVzdHJ1Y3R1cmluZ1xyXG4gICAgICovXHJcbiAgICBwcml2YXRlIG9wZW5BcHAodGFiSWQ6IHN0cmluZywgYXBwSWQ6IHN0cmluZywgYXBwRW50cmFuY2U6IHN0cmluZywgY3JlYXRpb25SZXN1bHQ6IEZvcm1CaWxsQ3JlYXRpb25Qcm9jZXNzRXhlY3V0b3JSZXN1bHQsIGV4dFBhcmFtcz86IHt9LCByZWxvYWQ/OiBib29sZWFuLCB0YWJOYW1lPzogc3RyaW5nLCBlbmFibGVSZWZyZXNoPzogYW55LCBkZXN0cnVjdHVyaW5nPzogYW55KTogdm9pZCB7XHJcbiAgICAgICAgZXh0UGFyYW1zID0gZXh0UGFyYW1zID09IG51bGwgPyB7fSA6IGV4dFBhcmFtcztcclxuICAgICAgICBjb25zdCBicm93c2VyID0ganVkZ2VCcm93c2VyVHlwZSgpO1xyXG4gICAgICAgIGlmIChicm93c2VyLnR5cGUgPT0gXCJJRVwiICYmIGJyb3dzZXIuSUVWZXJzaW9uID09IFwiSUUxMVwiKSB7XHJcbiAgICAgICAgICAgIC8vSUUxMea1j+iniOWZqOWwhueUn+aIkOe7k+aenOi9rOaNouS4uuWtl+espuS4suWtmOWcqHRvcC5sb2NhbFN0b3JhZ2XvvIxJZOS4unRhYklkXHJcbiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKHRhYklkKTtcclxuICAgICAgICAgICAgd2luZG93LnRvcC5sb2NhbFN0b3JhZ2Uuc2V0SXRlbSh0YWJJZCwgY3JlYXRpb25SZXN1bHQuQ29udmVydFRvSnNvbigpKTtcclxuICAgICAgICAgICAgdGhpcy5uYXZpZ2F0aW9uU2VydmljZS5vcGVuQXBwKFxyXG4gICAgICAgICAgICAgICAgdGFiSWQsIGFwcElkLCBhcHBFbnRyYW5jZSwgZXh0UGFyYW1zLCByZWxvYWQsIHRhYk5hbWUsIGVuYWJsZVJlZnJlc2gsIGRlc3RydWN0dXJpbmdcclxuICAgICAgICAgICAgKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLm5hdmlnYXRpb25TZXJ2aWNlLm9wZW5BcHAoXHJcbiAgICAgICAgICAgICAgICB0YWJJZCwgYXBwSWQsIGFwcEVudHJhbmNlLFxyXG4gICAgICAgICAgICAgICAgdGhpcy5idWlsZFJvdXRlUGFyYW1zKGNyZWF0aW9uUmVzdWx0LCBleHRQYXJhbXMpLFxyXG4gICAgICAgICAgICAgICAgcmVsb2FkLCB0YWJOYW1lLCBlbmFibGVSZWZyZXNoLCBkZXN0cnVjdHVyaW5nXHJcbiAgICAgICAgICAgICk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogQERlcHJlY2F0ZWRcclxuICAgICAqIEBwYXJhbSBhY3Rpb24g55uu5qCHQXBw5Yqo5L2cXHJcbiAgICAgKiBAcGFyYW0gcGFpcnMg5YW25LuW5a6e5L2T5Y+C5pWw6ZSu5YC85a+5XHJcbiAgICAgKi9cclxuICAgIHByaXZhdGUgYnVpbGRSb3V0ZVBhcmFtcyhjcmVhdGlvblJlc3VsdDogRm9ybUJpbGxDcmVhdGlvblByb2Nlc3NFeGVjdXRvclJlc3VsdCwgZXh0UGFyYW1zOiB7fSk6IHt9IHtcclxuICAgICAgICBjb25zdCBwYXJhbXMgPSBleHRQYXJhbXM7XHJcbiAgICAgICAgcGFyYW1zW3RoaXMudWlTdGF0ZUtleUNyZWF0aW9uUmVzdWx0XSA9IGNyZWF0aW9uUmVzdWx0LkNvbnZlcnRUb0pzb24oKTtcclxuICAgICAgICBpZiAocGFyYW1zW1wiYWN0aW9uXCJdID09IG51bGwgfHwgcGFyYW1zW1wiYWN0aW9uXCJdID09IFwiXCIpIHtcclxuICAgICAgICAgICAgcGFyYW1zW1wiYWN0aW9uXCJdID0gXCJyb290dmlld21vZGVsYmlmTG9hZDFcIjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBwYXJhbXM7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDmiZPlvIDkuIvmuLjljZXmja7liLbljZXnlYzpnaJcclxuICAgICAqIEBwYXJhbSBmb3JtU2V0dGluZ3NcclxuICAgICAqIEBwYXJhbSBjcmVhdGlvblJlc3VsdFxyXG4gICAgICogQHBhcmFtIGV4dFBhcmFtc1xyXG4gICAgICovXHJcbiAgICBwdWJsaWMgb3BlblRhcmdldEFwcChmb3JtU2V0dGluZ3M6IEZvcm1TZXR0aW5ncywgY29uZGl0aW9uUmVzdWx0OiBDb25kaXRpb25SZXN1bHQsIHRleHRJZFdpdGhEYXRhSWRzOiBHZW5lcmFsVGV4dElkV2l0aERhdGFJZFtdLCBleHRQYXJhbXM/OiB7fSk6IHZvaWQge1xyXG4gICAgICAgIGlmIChmb3JtU2V0dGluZ3MgPT0gbnVsbCkge1xyXG4gICAgICAgICAgICB0aHJvdyBcIuWPguaVsGZvcm1TZXR0aW5nc+S4jeWPr+S4uuepulwiO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGV4dElkV2l0aERhdGFJZHMgPT0gbnVsbCkge1xyXG4gICAgICAgICAgICB0aHJvdyBcIuWPguaVsGNyZWF0aW9uUmVzdWx05LiN5Y+v5Li656m6XCI7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0eXBlb2YgdGV4dElkV2l0aERhdGFJZHMgPT0gXCJzdHJpbmdcIikge1xyXG4gICAgICAgICAgICBpZiAodGV4dElkV2l0aERhdGFJZHMgPT0gXCJcIikge1xyXG4gICAgICAgICAgICAgICAgdGhyb3cgXCLlj4LmlbBjcmVhdGlvblJlc3VsdOS4jeWPr+S4uuepulwiO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRleHRJZFdpdGhEYXRhSWRzID0gQnBtbk1vZGVsSnNvbkhlbHBlci5Gcm9tSnNvbih0ZXh0SWRXaXRoRGF0YUlkcywgR2VuZXJhbFRleHRJZFdpdGhEYXRhSWQpIGFzIEdlbmVyYWxUZXh0SWRXaXRoRGF0YUlkW107XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoY29uZGl0aW9uUmVzdWx0LmNvbmRpdGlvbkV4ZWN1dGlvblJlc3VsdCA9PSBmYWxzZSkge1xyXG4gICAgICAgICAgICB0aGlzLm1lc3NhZ2VyLmVycm9yKGNvbmRpdGlvblJlc3VsdC5tZXNzYWdlIHx8IHRoaXMubG9jYWxlUGlwZS50cmFuc2Zvcm0oXCJjcmVhdGlvbkV4ZWN1dGlvbkVycm9yXCIpKTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHRleHRJZFdpdGhEYXRhSWRzID09IG51bGwgfHwgdGV4dElkV2l0aERhdGFJZHMubGVuZ3RoID09IG51bGwgfHwgdGV4dElkV2l0aERhdGFJZHMubGVuZ3RoIDw9IDApIHtcclxuICAgICAgICAgICAgdGhpcy5tZXNzYWdlci5lcnJvcih0aGlzLmxvY2FsZVBpcGUudHJhbnNmb3JtKFwiY3JlYXRpb25SZXN1bHRFbXB0eVwiKSk7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9IGVsc2UgaWYgKHRleHRJZFdpdGhEYXRhSWRzLmxlbmd0aCA9PSAxKSB7XHJcbiAgICAgICAgICAgIC8vIOS7juihqOWNlemFjee9ruS4reWPluS4i+a4uOWNoeeJh+WKoOi9veWRveS7pFxyXG4gICAgICAgICAgICBjb25zdCBhY3Rpb24gPSBmb3JtU2V0dGluZ3MudGFyZ2V0Q2FyZEFwcExvYWRDbWQ7XHJcbiAgICAgICAgICAgIGlmIChhY3Rpb24gIT0gbnVsbCAmJiBhY3Rpb24gIT0gXCJcIikge1xyXG4gICAgICAgICAgICAgICAgaWYgKGV4dFBhcmFtcyA9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZXh0UGFyYW1zID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb246IGFjdGlvblxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZXh0UGFyYW1zW1wiYWN0aW9uXCJdID0gZXh0UGFyYW1zW1wiYWN0aW9uXCJdICE9IG51bGwgJiYgZXh0UGFyYW1zW1wiYWN0aW9uXCJdICE9IFwiXCIgPyBleHRQYXJhbXNbXCJhY3Rpb25cIl0gOiBhY3Rpb247XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLy/lj6rmnInkuIDmnaHmlbDmja7liJnmiZPlvIDljaHniYdcclxuICAgICAgICAgICAgdGhpcy5vcGVuQXBwV2l0aEdlbmVyYWxUZXh0KFxyXG4gICAgICAgICAgICAgICAgdGV4dElkV2l0aERhdGFJZHNbMF0uZGF0YUlkLFxyXG4gICAgICAgICAgICAgICAgZm9ybVNldHRpbmdzLnRhcmdldENhcmRBcHBJZCxcclxuICAgICAgICAgICAgICAgIGZvcm1TZXR0aW5ncy50YXJnZXRDYXJkQXBwRW50cmFuY2UsXHJcbiAgICAgICAgICAgICAgICB0ZXh0SWRXaXRoRGF0YUlkc1swXS5nZW5lcmFsVGV4dElkLFxyXG4gICAgICAgICAgICAgICAgZXh0UGFyYW1zLFxyXG4gICAgICAgICAgICAgICAgZmFsc2VcclxuICAgICAgICAgICAgKVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGlmIChmb3JtU2V0dGluZ3MudGFyZ2V0TGlzdEFwcElkICE9IG51bGwpIHtcclxuICAgICAgICAgICAgICAgIC8vIOWkmuadoeaVsOaNruS4lOmFjee9ruaJuemHj+e8lui+keeVjOmdolxyXG4gICAgICAgICAgICAgICAgdGhyb3cgXCLmmoLkuI3mlK/mjIHmiZPlvIDmibnph4/nvJbovpHnlYzpnaJcIjtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIC8v5pyJ5aSa5p2h5pWw5o2u5L2G5pyq6YWN572u5om56YeP57yW6L6R55WM6Z2i5YiZ5omT5byA5aSa5Liq5Y2h54mHXHJcbiAgICAgICAgICAgICAgICBmb3IgKGxldCBpdGVtIG9mIHRleHRJZFdpdGhEYXRhSWRzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8g5LuO6KGo5Y2V6YWN572u5Lit5Y+W5LiL5ri45Y2h54mH5Yqg6L295ZG95LukXHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgYWN0aW9uID0gZm9ybVNldHRpbmdzLnRhcmdldENhcmRBcHBMb2FkQ21kO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChhY3Rpb24gIT0gbnVsbCAmJiBhY3Rpb24gIT0gXCJcIikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZXh0UGFyYW1zID09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4dFBhcmFtcyA9IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb246IGFjdGlvblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZXh0UGFyYW1zW1wiYWN0aW9uXCJdID0gZXh0UGFyYW1zW1wiYWN0aW9uXCJdICE9IG51bGwgJiYgZXh0UGFyYW1zW1wiYWN0aW9uXCJdICE9IFwiXCIgPyBleHRQYXJhbXNbXCJhY3Rpb25cIl0gOiBhY3Rpb247XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5vcGVuQXBwV2l0aEdlbmVyYWxUZXh0KFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpdGVtLmRhdGFJZCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZm9ybVNldHRpbmdzLnRhcmdldENhcmRBcHBJZCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZm9ybVNldHRpbmdzLnRhcmdldENhcmRBcHBFbnRyYW5jZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgaXRlbS5nZW5lcmFsVGV4dElkLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBleHRQYXJhbXMsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZhbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgKVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgb3BlbkFwcFdpdGhHZW5lcmFsVGV4dCh0YWJJZDogc3RyaW5nLCBhcHBJZDogc3RyaW5nLCBhcHBFbnRyYW5jZTogc3RyaW5nLCB0ZXh0SWQ6IHN0cmluZywgZXh0UGFyYW1zPzoge30sIHJlbG9hZD86IGJvb2xlYW4sIHRhYk5hbWU/OiBzdHJpbmcsIGVuYWJsZVJlZnJlc2g/OiBhbnksIGRlc3RydWN0dXJpbmc/OiBhbnkpOiB2b2lkIHtcclxuICAgICAgICBleHRQYXJhbXMgPSBleHRQYXJhbXMgPT0gbnVsbCA/IHt9IDogZXh0UGFyYW1zO1xyXG4gICAgICAgIGNvbnN0IGJyb3dzZXIgPSBqdWRnZUJyb3dzZXJUeXBlKCk7XHJcbiAgICAgICAgaWYgKGJyb3dzZXIudHlwZSA9PSBcIklFXCIgJiYgYnJvd3Nlci5JRVZlcnNpb24gPT0gXCJJRTExXCIpIHtcclxuICAgICAgICAgICAgLy9JRTEx5rWP6KeI5Zmo5bCG55Sf5oiQ57uT5p6c6L2s5o2i5Li65a2X56ym5Liy5a2Y5ZyodG9wLmxvY2FsU3RvcmFnZe+8jElk5Li6dGFiSWRcclxuICAgICAgICAgICAgd2luZG93LnRvcC5sb2NhbFN0b3JhZ2Uuc2V0SXRlbSh0YWJJZCwgdGV4dElkKTtcclxuICAgICAgICAgICAgdGhpcy5uYXZpZ2F0aW9uU2VydmljZS5vcGVuQXBwKFxyXG4gICAgICAgICAgICAgICAgdGFiSWQsIGFwcElkLCBhcHBFbnRyYW5jZSxcclxuICAgICAgICAgICAgICAgIHRoaXMuYnVpbGRSb3V0ZVBhcmFtc1dpdGhHZW5lcmFsVGV4dCh0ZXh0SWQsIGV4dFBhcmFtcyksXHJcbiAgICAgICAgICAgICAgICByZWxvYWQsIHRhYk5hbWUsIGVuYWJsZVJlZnJlc2gsIGRlc3RydWN0dXJpbmdcclxuICAgICAgICAgICAgKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLm5hdmlnYXRpb25TZXJ2aWNlLm9wZW5BcHAoXHJcbiAgICAgICAgICAgICAgICB0YWJJZCwgYXBwSWQsIGFwcEVudHJhbmNlLFxyXG4gICAgICAgICAgICAgICAgdGhpcy5idWlsZFJvdXRlUGFyYW1zV2l0aEdlbmVyYWxUZXh0KHRleHRJZCwgZXh0UGFyYW1zKSxcclxuICAgICAgICAgICAgICAgIHJlbG9hZCwgdGFiTmFtZSwgZW5hYmxlUmVmcmVzaCwgZGVzdHJ1Y3R1cmluZ1xyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gYWN0aW9uIOebruagh0FwcOWKqOS9nFxyXG4gICAgICogQHBhcmFtIHBhaXJzIOWFtuS7luWunuS9k+WPguaVsOmUruWAvOWvuVxyXG4gICAgICovXHJcbiAgICBwcml2YXRlIGJ1aWxkUm91dGVQYXJhbXNXaXRoR2VuZXJhbFRleHQodGV4dElkOiBzdHJpbmcsIGV4dFBhcmFtczoge30pOiB7fSB7XHJcbiAgICAgICAgY29uc3QgcGFyYW1zID0gZXh0UGFyYW1zO1xyXG4gICAgICAgIHBhcmFtc1t0aGlzLnVpU3RhdGVLZXlDcmVhdGlvblJlc3VsdF0gPSB0ZXh0SWQ7XHJcbiAgICAgICAgaWYgKHBhcmFtc1tcImFjdGlvblwiXSA9PSBudWxsIHx8IHBhcmFtc1tcImFjdGlvblwiXSA9PSBcIlwiKSB7XHJcbiAgICAgICAgICAgIHBhcmFtc1tcImFjdGlvblwiXSA9IFwicm9vdHZpZXdtb2RlbGJpZkxvYWQxXCI7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gcGFyYW1zO1xyXG4gICAgfVxyXG59XHJcbiJdfQ==
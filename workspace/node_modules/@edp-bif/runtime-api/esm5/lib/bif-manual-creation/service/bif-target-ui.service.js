/**
 * @fileoverview added by tsickle
 * Generated from: lib/bif-manual-creation/service/bif-target-ui.service.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Injectable, Injector, ComponentFactoryResolver, NgModuleFactoryLoader, Inject, LOCALE_ID, ComponentRef, Optional } from '@angular/core';
import { Observable, from, of } from 'rxjs';
import { switchMap, catchError } from 'rxjs/operators';
import { FrameContext } from '@farris/devkit';
import { BsModalService } from '@farris/ui-modal';
import { BIF_UISTATE_KEY_CREATION_RESULT } from '../config/bif-form-constants';
import { AbstractUiService } from './abstract-ui-service';
import { BifDataService } from './bif-data.service';
import { PullSelectorComponent } from '../components/pull-selector/pull-selector.component';
import { FormGetBillCreationProcessEntityExArgs } from '../../entity/form-rest/FormGetBillCreationProcessEntityExArgs';
import { ManualCreationMode } from '../../entity/form-rest/ManualCreationMode';
import { FormBillCreationProcessExecutorResult } from '@edp-aif/runtime-api';
import { MessagerService } from '@farris/ui-messager';
import { RuntimeFrameworkService } from '@farris/command-services';
import { judgeBrowserType } from '../../utils/BrowserUtil';
import { TranslateService } from "@ngx-translate/core";
import { AbstractBifDataSelectorService } from './bif-data-selector.service';
import { canJSONParse } from '../../utils/ObjectUtils';
var BifTargetUiService = /** @class */ (function (_super) {
    tslib_1.__extends(BifTargetUiService, _super);
    function BifTargetUiService(dataService, frameContext, modalService, messager, injector, cfr, loader, localeId, runtimeFrameworkService) {
        var _this = _super.call(this, frameContext, modalService, messager, injector, cfr, loader, localeId, runtimeFrameworkService) || this;
        _this.dataService = dataService;
        _this.frameContext = frameContext;
        _this.modalService = modalService;
        _this.messager = messager;
        _this.injector = injector;
        _this.cfr = cfr;
        _this.loader = loader;
        _this.localeId = localeId;
        _this.uiStateKeyCreationResult = BIF_UISTATE_KEY_CREATION_RESULT;
        return _this;
    }
    /**
     * 参照时打开生单规则选择器
     */
    /**
     * 参照时打开生单规则选择器
     * @param {?} downVoId
     * @param {?=} bizFlowchartId
     * @param {?=} modalOptions
     * @param {?=} customSelectorModuleUrl
     * @param {?=} extParams
     * @return {?}
     */
    BifTargetUiService.prototype.openBillCreationProcessSelector4Pull = /**
     * 参照时打开生单规则选择器
     * @param {?} downVoId
     * @param {?=} bizFlowchartId
     * @param {?=} modalOptions
     * @param {?=} customSelectorModuleUrl
     * @param {?=} extParams
     * @return {?}
     */
    function (downVoId, bizFlowchartId, modalOptions, customSelectorModuleUrl, extParams) {
        /** @type {?} */
        var args = new FormGetBillCreationProcessEntityExArgs();
        args.downBillVoId = downVoId;
        args.manualCreationMode = ManualCreationMode.Pull;
        // args.bizFlowchartId = bizFlowchartId;
        return this.openBillCreationProcessSelector(args, PullSelectorComponent, modalOptions, customSelectorModuleUrl, extParams);
    };
    /**
     * 特定参照时打开生单规则选择器
     */
    /**
     * 特定参照时打开生单规则选择器
     * @param {?} upBillVoId
     * @param {?} downVoId
     * @param {?=} bizFlowchartId
     * @param {?=} modalOptions
     * @param {?=} customSelectorModuleUrl
     * @param {?=} extParams
     * @return {?}
     */
    BifTargetUiService.prototype.openBillCreationProcessSelector4SpecificPull = /**
     * 特定参照时打开生单规则选择器
     * @param {?} upBillVoId
     * @param {?} downVoId
     * @param {?=} bizFlowchartId
     * @param {?=} modalOptions
     * @param {?=} customSelectorModuleUrl
     * @param {?=} extParams
     * @return {?}
     */
    function (upBillVoId, downVoId, bizFlowchartId, modalOptions, customSelectorModuleUrl, extParams) {
        /** @type {?} */
        var args = new FormGetBillCreationProcessEntityExArgs();
        args.upBillVoId = upBillVoId;
        args.downBillVoId = downVoId;
        args.manualCreationMode = ManualCreationMode.SpecificPull;
        // args.bizFlowchartId = bizFlowchartId;
        return this.openBillCreationProcessSelector(args, PullSelectorComponent, modalOptions, customSelectorModuleUrl, extParams);
    };
    /**
     * 打开来源单据选择器
     * @param formSettings
     * @param modalOptions
     */
    /**
     * 打开来源单据选择器
     * @param {?=} formSettings
     * @param {?=} modalOptions
     * @param {?=} extParams
     * @return {?}
     */
    BifTargetUiService.prototype.openSourceDataSelector4Pull = /**
     * 打开来源单据选择器
     * @param {?=} formSettings
     * @param {?=} modalOptions
     * @param {?=} extParams
     * @return {?}
     */
    function (formSettings, modalOptions, extParams) {
        var _this = this;
        modalOptions = modalOptions == null ? this.defaultModalOptions : modalOptions;
        modalOptions.title = modalOptions.title == null ? this.localePipe.transform("sourceDataSelector") : modalOptions.title;
        /** @type {?} */
        var cmpR = null;
        if (formSettings == null || formSettings.sourceDataSelectorModuleUrl == null) // 没有配置时加载默认通用单据选择器
         {
            this.messager.error(this.localePipe.instant("noDefaultUpBillSelector"));
            throw "暂无默认实现，请使用自定义来源单据选择器。请确保生单流程中【集成场景】启用了【人工拉式生单】场景，并且【单据配置】-【拉式生单配置】-【上游应用入口】或【URL】不为空";
            // let cmpF: ComponentFactory<SourceDataSelectorComponent> = this.cfr.resolveComponentFactory(SourceDataSelectorComponent);
            // let inj: Injector = Injector.create([
            // ], this.injector);
            // cmpR = cmpF.create(inj);
            // this.configModalButtons(modalOptions, cmpR);
            // cmpR.instance.bsModalRef4AifSelector = this.modalService.show(cmpR, modalOptions);
            // return cmpR.instance.subject4EntityDatas.asObservable();
        }
        else //加载自定义来源单据选择器
         {
            // return from(System.import(formSettings.sourceDataSelectorModuleUrl.substring(0, formSettings.sourceDataSelectorModuleUrl.indexOf("#")) + ".js")).pipe(
            /** @type {?} */
            var moduleF$ = null;
            if (formSettings.sourceDataSelectorAppId != null) //配置appId时
             {
                moduleF$ = from(System.import(formSettings.sourceDataSelectorModuleUrl.toLowerCase()).then((/**
                 * @param {?} m
                 * @return {?}
                 */
                function (m) { return m; }))).pipe(switchMap((/**
                 * @param {?} m
                 * @return {?}
                 */
                function (m) {
                    for (var key in m) {
                        return of(m[key]);
                    }
                    return of(null);
                })));
            }
            else //只配置url时
             {
                moduleF$ = from(this.loader.load(formSettings.sourceDataSelectorModuleUrl));
            }
            return moduleF$.pipe(switchMap((/**
             * @param {?} moduleFactory
             * @return {?}
             */
            function (moduleFactory) {
                /** @type {?} */
                var moduleRef = moduleFactory.create(_this.frameContext.root.injector);
                if (moduleRef.instance.createSourceDataSelector && moduleRef.instance.createSourceDataSelector instanceof Function) //module上定义createSourceDataSelector方法
                 {
                    /** @type {?} */
                    var cmpR$ = moduleRef.instance.createSourceDataSelector(_this.frameContext.root.injector, null, extParams);
                    if (cmpR$ instanceof Observable) {
                        return cmpR$.pipe(switchMap((/**
                         * @param {?} componentRef
                         * @return {?}
                         */
                        function (componentRef) {
                            cmpR = componentRef;
                            _this.configModalButtons(modalOptions, cmpR);
                            cmpR.instance.bsModalRef4BifSelector = _this.modalService.show(cmpR, modalOptions);
                            return cmpR.instance.subject4EntityDatas.asObservable();
                        })));
                    }
                    else if (cmpR$ instanceof ComponentRef) {
                        cmpR = cmpR$;
                        _this.configModalButtons(modalOptions, cmpR);
                        cmpR.instance.bsModalRef4BifSelector = _this.modalService.show(cmpR, modalOptions);
                        return cmpR.instance.subject4EntityDatas.asObservable();
                    }
                }
                else //module上未定义时尝试寻找RootComponent类
                 {
                    /** @type {?} */
                    var translate_1 = moduleRef.injector.get(TranslateService);
                    return translate_1.getTranslation(_this.localeId).pipe(switchMap((/**
                     * @param {?} data
                     * @return {?}
                     */
                    function (data) {
                        translate_1.setTranslation(_this.localeId, data);
                        translate_1.defaultLang = _this.localeId;
                        translate_1.currentLang = _this.localeId;
                        return _this.getEntityData(moduleRef, formSettings, modalOptions, extParams);
                    })), catchError((/**
                     * @param {?} err
                     * @return {?}
                     */
                    function (err) {
                        console.error(err);
                        return _this.getEntityData(moduleRef, formSettings, modalOptions, extParams);
                    })));
                }
            })));
        }
    };
    /**
     * @Deprecated 已弃用，请使用{@link getCreationResult}
     * 获取传到根组件UIState上的生单规则执行器结果
     */
    /**
     * \@Deprecated 已弃用，请使用{\@link getCreationResult}
     * 获取传到根组件UIState上的生单规则执行器结果
     * @return {?}
     */
    BifTargetUiService.prototype.getFormBillCreationProcessExecutorResult = /**
     * \@Deprecated 已弃用，请使用{\@link getCreationResult}
     * 获取传到根组件UIState上的生单规则执行器结果
     * @return {?}
     */
    function () {
        //取得tabId为[AppId]_[AppEntrance]_[tabId]
        /** @type {?} */
        var tabId = this.runtimeFrameworkService.tabId || this.getQueryString("tabId") || "";
        /** @type {?} */
        var dataId = tabId.substr(tabId.length - 36)
        // console.log(tabId);
        // console.log(dataId);
        ;
        // console.log(tabId);
        // console.log(dataId);
        /** @type {?} */
        var browser = judgeBrowserType();
        //IE11浏览器从localStorage取值后并删除, 并存入UIState
        if (browser.type == "IE" && browser.IEVersion == "IE11") {
            /** @type {?} */
            var tmp = window.top.localStorage.getItem(dataId);
            window.top.localStorage.removeItem(dataId);
            this.frameContext.root.uiState.setPropertyValue(this.uiStateKeyCreationResult, tmp);
        }
        /** @type {?} */
        var resTemp = this.frameContext.root.uiState[this.uiStateKeyCreationResult];
        if (resTemp == null) {
            throw "FormBillCreationProcessExecutorResult is null";
        }
        /** @type {?} */
        var result = new FormBillCreationProcessExecutorResult();
        if (typeof resTemp == "string") {
            result.LoadFromJson(resTemp);
        }
        else if (typeof resTemp == "object") {
            result.LoadFromJsonObject(resTemp);
        }
        else {
            throw "不合法的类型";
        }
        return result;
    };
    /**
     * @param {?} name
     * @return {?}
     */
    BifTargetUiService.prototype.getQueryString = /**
     * @param {?} name
     * @return {?}
     */
    function (name) {
        /** @type {?} */
        var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i");
        /** @type {?} */
        var r = window.location.search.substr(1).match(reg);
        if (r != null) {
            return unescape(r[2]);
        }
        ;
        return null;
    };
    /**
     * 获取传到根组件UIState上的生单规则执行器结果
     */
    /**
     * 获取传到根组件UIState上的生单规则执行器结果
     * @return {?}
     */
    BifTargetUiService.prototype.getCreationResult = /**
     * 获取传到根组件UIState上的生单规则执行器结果
     * @return {?}
     */
    function () {
        //取得tabId为[AppId]_[AppEntrance]_[tabId]
        /** @type {?} */
        var tabId = this.runtimeFrameworkService.tabId || this.getQueryString("tabId") || "";
        /** @type {?} */
        var dataId = tabId.substr(tabId.length - 36)
        // console.log(tabId);
        // console.log(dataId);
        ;
        // console.log(tabId);
        // console.log(dataId);
        /** @type {?} */
        var browser = judgeBrowserType();
        //IE11浏览器从localStorage取值后并删除, 并存入UIState
        if (browser.type == "IE" && browser.IEVersion == "IE11") {
            /** @type {?} */
            var tmp = window.top.localStorage.getItem(dataId);
            window.top.localStorage.removeItem(dataId);
            this.frameContext.root.uiState.setPropertyValue(this.uiStateKeyCreationResult, tmp);
        }
        /** @type {?} */
        var resTemp = this.frameContext.root.uiState[this.uiStateKeyCreationResult];
        if (resTemp == null) {
            throw "FormBillCreationProcessExecutorResult is null";
        }
        /** @type {?} */
        var result = new FormBillCreationProcessExecutorResult();
        if (typeof resTemp == "string") {
            // 兼容原直接传递生单数据场景
            if (canJSONParse(resTemp)) {
                result.LoadFromJson(resTemp);
                return of(result);
            }
            else {
                /** @type {?} */
                var resultTextId = resTemp;
                return this.dataService.getCreationResultById(resultTextId);
            }
        }
        else if (typeof resTemp == "object") {
            result.LoadFromJsonObject(resTemp);
            return of(result);
        }
        else {
            throw "不合法的类型";
        }
    };
    /**
     * 配置模态框按钮事件
     * @param modalOptions
     * @param cmpR
     */
    /**
     * 配置模态框按钮事件
     * @protected
     * @param {?} modalOptions
     * @param {?} service
     * @return {?}
     */
    BifTargetUiService.prototype.configModalButtonsByService = /**
     * 配置模态框按钮事件
     * @protected
     * @param {?} modalOptions
     * @param {?} service
     * @return {?}
     */
    function (modalOptions, service) {
        modalOptions.buttons = [
            {
                text: this.localePipe.transform("confirm"),
                cls: "btn btn-primary",
                handle: service.clickOk4BifSelector,
            },
            {
                text: this.localePipe.transform("cancel"),
                cls: "btn btn-secondary",
                handle: service.clickClose4BifSelector,
            }
        ];
        modalOptions.showButtons = true;
    };
    /**
     * @protected
     * @param {?} moduleRef
     * @param {?=} formSettings
     * @param {?=} modalOptions
     * @param {?=} extParams
     * @return {?}
     */
    BifTargetUiService.prototype.getEntityData = /**
     * @protected
     * @param {?} moduleRef
     * @param {?=} formSettings
     * @param {?=} modalOptions
     * @param {?=} extParams
     * @return {?}
     */
    function (moduleRef, formSettings, modalOptions, extParams) {
        /** @type {?} */
        var cmpF = null;
        /** @type {?} */
        var cmpR = null;
        /** @type {?} */
        var bootstrapComponentSelector = "app-rootcomponent";
        /** @type {?} */
        var bootstrapComponent = null;
        /** @type {?} */
        var facMap = moduleRef.componentFactoryResolver['_factories'];
        /** @type {?} */
        var subject4EntityDatas = null;
        if (extParams && extParams.bootstrapComponentSelector) //指定了根组件selector
         {
            bootstrapComponentSelector = extParams.bootstrapComponentSelector;
            facMap.forEach((/**
             * @param {?} value
             * @param {?} key
             * @param {?} map
             * @return {?}
             */
            function (value, key, map) {
                /** @type {?} */
                var selector = value.selector;
                if (bootstrapComponentSelector == selector) {
                    cmpF = moduleRef.componentFactoryResolver.resolveComponentFactory((/** @type {?} */ (key)));
                    cmpR = cmpF.create(moduleRef.injector);
                }
            }));
        }
        else //未指定根组件selector
         {
            bootstrapComponent = moduleRef['_bootstrapComponents'][0];
            if (bootstrapComponent) //先找bootstrapComponent数组有无组件
             {
                cmpF = moduleRef.componentFactoryResolver.resolveComponentFactory(bootstrapComponent);
                cmpR = (/** @type {?} */ (cmpF.create(moduleRef.injector)));
            }
            else //没有则从facMap中查找默认的app-rootcomponent
             {
                facMap.forEach((/**
                 * @param {?} value
                 * @param {?} key
                 * @param {?} map
                 * @return {?}
                 */
                function (value, key, map) {
                    /** @type {?} */
                    var selector = value.selector;
                    if (bootstrapComponentSelector == selector) {
                        cmpF = moduleRef.componentFactoryResolver.resolveComponentFactory((/** @type {?} */ (key)));
                        cmpR = cmpF.create(moduleRef.injector);
                    }
                }));
            }
        }
        if (cmpR && cmpR.instance && cmpR.instance.viewModel && cmpR.instance.viewModel.uiState) {
            cmpR.instance.viewModel.uiState.setPropertyValue("action", "Load1");
            cmpR.instance.viewModel.uiState.setPropertyValue('DEVKIT_DIALOG', true);
        }
        /** @type {?} */
        var dataSelectorService = cmpR.injector.get(AbstractBifDataSelectorService, null);
        if (dataSelectorService != null) // 有AbstractBifDataSelectorService的provider时
         {
            this.configModalButtonsByService(modalOptions, dataSelectorService);
            dataSelectorService.bsModalRef4BifSelector = this.modalService.show(cmpR, modalOptions);
            subject4EntityDatas = dataSelectorService.subject4EntityDatas.asObservable();
        }
        else //没有则从组件上寻找相应属性
         {
            this.configModalButtons(modalOptions, cmpR);
            cmpR.instance.bsModalRef4BifSelector = this.modalService.show(cmpR, modalOptions);
            subject4EntityDatas = cmpR.instance.subject4EntityDatas.asObservable();
        }
        // 此处用于解决任务中心直接打开来源单据帮助时不执行初始化加载命令的问题
        if (cmpR && cmpR.instance && cmpR.instance.viewModel) {
            if (extParams && extParams.loadCommand) {
                /** @type {?} */
                var loadCommand = extParams.loadCommand;
                /** @type {?} */
                var cmdFunc = cmpR.instance.viewModel[loadCommand];
                if (cmdFunc) {
                    /** @type {?} */
                    var args = undefined;
                    if (extParams && extParams.loadParams) {
                        if (Array.isArray(extParams.loadParams)) {
                            args = extParams.loadParams;
                        }
                        else {
                            args = [extParams.loadParams];
                        }
                    }
                    cmdFunc.apply(cmpR.instance.viewModel, args);
                }
            }
        }
        return subject4EntityDatas;
    };
    BifTargetUiService.decorators = [
        { type: Injectable }
    ];
    /** @nocollapse */
    BifTargetUiService.ctorParameters = function () { return [
        { type: BifDataService },
        { type: FrameContext },
        { type: BsModalService },
        { type: MessagerService },
        { type: Injector },
        { type: ComponentFactoryResolver },
        { type: NgModuleFactoryLoader },
        { type: String, decorators: [{ type: Inject, args: [LOCALE_ID,] }] },
        { type: RuntimeFrameworkService, decorators: [{ type: Optional }] }
    ]; };
    return BifTargetUiService;
}(AbstractUiService));
export { BifTargetUiService };
if (false) {
    /**
     * @type {?}
     * @private
     */
    BifTargetUiService.prototype.uiStateKeyCreationResult;
    /**
     * @type {?}
     * @protected
     */
    BifTargetUiService.prototype.dataService;
    /**
     * @type {?}
     * @protected
     */
    BifTargetUiService.prototype.frameContext;
    /**
     * @type {?}
     * @protected
     */
    BifTargetUiService.prototype.modalService;
    /**
     * @type {?}
     * @protected
     */
    BifTargetUiService.prototype.messager;
    /**
     * @type {?}
     * @protected
     */
    BifTargetUiService.prototype.injector;
    /**
     * @type {?}
     * @protected
     */
    BifTargetUiService.prototype.cfr;
    /**
     * @type {?}
     * @protected
     */
    BifTargetUiService.prototype.loader;
    /** @type {?} */
    BifTargetUiService.prototype.localeId;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmlmLXRhcmdldC11aS5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGVkcC1iaWYvcnVudGltZS1hcGkvIiwic291cmNlcyI6WyJsaWIvYmlmLW1hbnVhbC1jcmVhdGlvbi9zZXJ2aWNlL2JpZi10YXJnZXQtdWkuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLFFBQVEsRUFBRSx3QkFBd0IsRUFBRSxxQkFBcUIsRUFBRSxNQUFNLEVBQUUsU0FBUyxFQUFFLFlBQVksRUFBbUIsUUFBUSxFQUFpQyxNQUFNLGVBQWUsQ0FBQztBQUNqTSxPQUFPLEVBQUUsVUFBVSxFQUFFLElBQUksRUFBRSxFQUFFLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDNUMsT0FBTyxFQUFFLFNBQVMsRUFBZSxVQUFVLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUVwRSxPQUFPLEVBQUUsWUFBWSxFQUEwQixNQUFNLGdCQUFnQixDQUFDO0FBQ3RFLE9BQU8sRUFBRSxjQUFjLEVBQWdCLE1BQU0sa0JBQWtCLENBQUM7QUFLaEUsT0FBTyxFQUFFLCtCQUErQixFQUFFLE1BQU0sOEJBQThCLENBQUM7QUFDL0UsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sdUJBQXVCLENBQUM7QUFDMUQsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLG9CQUFvQixDQUFDO0FBQ3BELE9BQU8sRUFBRSxxQkFBcUIsRUFBRSxNQUFNLHFEQUFxRCxDQUFDO0FBRzVGLE9BQU8sRUFBRSxzQ0FBc0MsRUFBRSxNQUFNLCtEQUErRCxDQUFDO0FBQ3ZILE9BQU8sRUFBRSxrQkFBa0IsRUFBRSxNQUFNLDJDQUEyQyxDQUFDO0FBQy9FLE9BQU8sRUFBRSxxQ0FBcUMsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBQzdFLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUN0RCxPQUFPLEVBQUUsdUJBQXVCLEVBQUUsTUFBTSwwQkFB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RDtTQS9UWSxrQkFBa0I7Ozs7OztJQUM3QixzREFBb0Y7Ozs7O0lBR2xGLHlDQUFxQzs7Ozs7SUFDckMsMENBQW9DOzs7OztJQUNwQywwQ0FBc0M7Ozs7O0lBQ3RDLHNDQUFtQzs7Ozs7SUFDbkMsc0NBQTRCOzs7OztJQUM1QixpQ0FBdUM7Ozs7O0lBQ3ZDLG9DQUF1Qzs7SUFDdkMsc0NBQTBDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSwgSW5qZWN0b3IsIENvbXBvbmVudEZhY3RvcnlSZXNvbHZlciwgTmdNb2R1bGVGYWN0b3J5TG9hZGVyLCBJbmplY3QsIExPQ0FMRV9JRCwgQ29tcG9uZW50UmVmLCBOZ01vZHVsZUZhY3RvcnksIE9wdGlvbmFsLCBOZ01vZHVsZVJlZiwgQ29tcG9uZW50RmFjdG9yeSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBPYnNlcnZhYmxlLCBmcm9tLCBvZiB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQgeyBzd2l0Y2hNYXAsIHN3aXRjaE1hcFRvLCBjYXRjaEVycm9yIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xyXG5cclxuaW1wb3J0IHsgRnJhbWVDb250ZXh0LCBFbnRpdHksIEZyYW1lQ29tcG9uZW50IH0gZnJvbSAnQGZhcnJpcy9kZXZraXQnO1xyXG5pbXBvcnQgeyBCc01vZGFsU2VydmljZSwgTW9kYWxPcHRpb25zIH0gZnJvbSAnQGZhcnJpcy91aS1tb2RhbCc7XHJcblxyXG5pbXBvcnQgeyBGb3JtU2V0dGluZ3MgfSBmcm9tICdAZWRwLWFpZi9jb21tb24tYXBpJztcclxuaW1wb3J0IHsgSVJ0U2xpbUJpbGxDcmVhdGlvblByb2Nlc3NFbnRpdHlFeCB9IGZyb20gXCJAZWRwLWJpZi9jb21tb24tYXBpXCI7XHJcblxyXG5pbXBvcnQgeyBCSUZfVUlTVEFURV9LRVlfQ1JFQVRJT05fUkVTVUxUIH0gZnJvbSAnLi4vY29uZmlnL2JpZi1mb3JtLWNvbnN0YW50cyc7XHJcbmltcG9ydCB7IEFic3RyYWN0VWlTZXJ2aWNlIH0gZnJvbSAnLi9hYnN0cmFjdC11aS1zZXJ2aWNlJztcclxuaW1wb3J0IHsgQmlmRGF0YVNlcnZpY2UgfSBmcm9tICcuL2JpZi1kYXRhLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBQdWxsU2VsZWN0b3JDb21wb25lbnQgfSBmcm9tICcuLi9jb21wb25lbnRzL3B1bGwtc2VsZWN0b3IvcHVsbC1zZWxlY3Rvci5jb21wb25lbnQnO1xyXG5pbXBvcnQgeyBJQmlmRGF0YVNlbGVjdG9yQ29tcG9uZW50IH0gZnJvbSAnLi4vYmFzZS9JQmlmRGF0YVNlbGVjdG9yQ29tcG9uZW50JztcclxuaW1wb3J0IHsgSUJpZkRhdGFTZWxlY3Rvck1vZHVsZSB9IGZyb20gJy4uL2Jhc2UvSUJpZkRhdGFTZWxlY3Rvck1vZHVsZSc7XHJcbmltcG9ydCB7IEZvcm1HZXRCaWxsQ3JlYXRpb25Qcm9jZXNzRW50aXR5RXhBcmdzIH0gZnJvbSAnLi4vLi4vZW50aXR5L2Zvcm0tcmVzdC9Gb3JtR2V0QmlsbENyZWF0aW9uUHJvY2Vzc0VudGl0eUV4QXJncyc7XHJcbmltcG9ydCB7IE1hbnVhbENyZWF0aW9uTW9kZSB9IGZyb20gJy4uLy4uL2VudGl0eS9mb3JtLXJlc3QvTWFudWFsQ3JlYXRpb25Nb2RlJztcclxuaW1wb3J0IHsgRm9ybUJpbGxDcmVhdGlvblByb2Nlc3NFeGVjdXRvclJlc3VsdCB9IGZyb20gJ0BlZHAtYWlmL3J1bnRpbWUtYXBpJztcclxuaW1wb3J0IHsgTWVzc2FnZXJTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy91aS1tZXNzYWdlcic7XHJcbmltcG9ydCB7IFJ1bnRpbWVGcmFtZXdvcmtTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy9jb21tYW5kLXNlcnZpY2VzJztcclxuaW1wb3J0IHsganVkZ2VCcm93c2VyVHlwZSB9IGZyb20gJy4uLy4uL3V0aWxzL0Jyb3dzZXJVdGlsJztcclxuaW1wb3J0IHsgVHJhbnNsYXRlTG9hZGVyLCBUcmFuc2xhdGVTZXJ2aWNlIH0gZnJvbSBcIkBuZ3gtdHJhbnNsYXRlL2NvcmVcIjtcclxuaW1wb3J0IHsgQWJzdHJhY3RCaWZEYXRhU2VsZWN0b3JTZXJ2aWNlIH0gZnJvbSAnLi9iaWYtZGF0YS1zZWxlY3Rvci5zZXJ2aWNlJztcclxuaW1wb3J0IHsgY2FuSlNPTlBhcnNlIH0gZnJvbSAnLi4vLi4vdXRpbHMvT2JqZWN0VXRpbHMnO1xyXG5cclxuXHJcbmRlY2xhcmUgdmFyIFN5c3RlbTogYW55O1xyXG5cclxuQEluamVjdGFibGUoKVxyXG5leHBvcnQgY2xhc3MgQmlmVGFyZ2V0VWlTZXJ2aWNlIGV4dGVuZHMgQWJzdHJhY3RVaVNlcnZpY2Uge1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgdWlTdGF0ZUtleUNyZWF0aW9uUmVzdWx0OiBzdHJpbmcgPSBCSUZfVUlTVEFURV9LRVlfQ1JFQVRJT05fUkVTVUxUO1xyXG5cclxuICBjb25zdHJ1Y3RvcihcclxuICAgIHByb3RlY3RlZCBkYXRhU2VydmljZTogQmlmRGF0YVNlcnZpY2UsXHJcbiAgICBwcm90ZWN0ZWQgZnJhbWVDb250ZXh0OiBGcmFtZUNvbnRleHQsXHJcbiAgICBwcm90ZWN0ZWQgbW9kYWxTZXJ2aWNlOiBCc01vZGFsU2VydmljZSxcclxuICAgIHByb3RlY3RlZCBtZXNzYWdlcjogTWVzc2FnZXJTZXJ2aWNlLFxyXG4gICAgcHJvdGVjdGVkIGluamVjdG9yOiBJbmplY3RvcixcclxuICAgIHByb3RlY3RlZCBjZnI6IENvbXBvbmVudEZhY3RvcnlSZXNvbHZlcixcclxuICAgIHByb3RlY3RlZCBsb2FkZXI6IE5nTW9kdWxlRmFjdG9yeUxvYWRlcixcclxuICAgIEBJbmplY3QoTE9DQUxFX0lEKSBwdWJsaWMgbG9jYWxlSWQ6IHN0cmluZyxcclxuICAgIEBPcHRpb25hbCgpIHJ1bnRpbWVGcmFtZXdvcmtTZXJ2aWNlOiBSdW50aW1lRnJhbWV3b3JrU2VydmljZSxcclxuICApIHtcclxuICAgIHN1cGVyKGZyYW1lQ29udGV4dCwgbW9kYWxTZXJ2aWNlLCBtZXNzYWdlciwgaW5qZWN0b3IsIGNmciwgbG9hZGVyLCBsb2NhbGVJZCwgcnVudGltZUZyYW1ld29ya1NlcnZpY2UpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5Y+C54Wn5pe25omT5byA55Sf5Y2V6KeE5YiZ6YCJ5oup5ZmoXHJcbiAgICovXHJcbiAgcHVibGljIG9wZW5CaWxsQ3JlYXRpb25Qcm9jZXNzU2VsZWN0b3I0UHVsbChkb3duVm9JZDogc3RyaW5nLCBiaXpGbG93Y2hhcnRJZD86IHN0cmluZywgbW9kYWxPcHRpb25zPzogTW9kYWxPcHRpb25zLCBjdXN0b21TZWxlY3Rvck1vZHVsZVVybD86IHN0cmluZywgZXh0UGFyYW1zPzoge30pOiBPYnNlcnZhYmxlPElSdFNsaW1CaWxsQ3JlYXRpb25Qcm9jZXNzRW50aXR5RXg+IHtcclxuICAgIGNvbnN0IGFyZ3MgPSBuZXcgRm9ybUdldEJpbGxDcmVhdGlvblByb2Nlc3NFbnRpdHlFeEFyZ3MoKTtcclxuICAgIGFyZ3MuZG93bkJpbGxWb0lkID0gZG93blZvSWQ7XHJcbiAgICBhcmdzLm1hbnVhbENyZWF0aW9uTW9kZSA9IE1hbnVhbENyZWF0aW9uTW9kZS5QdWxsO1xyXG4gICAgLy8gYXJncy5iaXpGbG93Y2hhcnRJZCA9IGJpekZsb3djaGFydElkO1xyXG5cclxuICAgIHJldHVybiB0aGlzLm9wZW5CaWxsQ3JlYXRpb25Qcm9jZXNzU2VsZWN0b3IoYXJncywgUHVsbFNlbGVjdG9yQ29tcG9uZW50LCBtb2RhbE9wdGlvbnMsIGN1c3RvbVNlbGVjdG9yTW9kdWxlVXJsLCBleHRQYXJhbXMpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog54m55a6a5Y+C54Wn5pe25omT5byA55Sf5Y2V6KeE5YiZ6YCJ5oup5ZmoXHJcbiAgICovXHJcbiAgcHVibGljIG9wZW5CaWxsQ3JlYXRpb25Qcm9jZXNzU2VsZWN0b3I0U3BlY2lmaWNQdWxsKHVwQmlsbFZvSWQ6IHN0cmluZywgZG93blZvSWQ6IHN0cmluZywgYml6Rmxvd2NoYXJ0SWQ/OiBzdHJpbmcsIG1vZGFsT3B0aW9ucz86IE1vZGFsT3B0aW9ucywgY3VzdG9tU2VsZWN0b3JNb2R1bGVVcmw/OiBzdHJpbmcsIGV4dFBhcmFtcz86IHt9KTogT2JzZXJ2YWJsZTxJUnRTbGltQmlsbENyZWF0aW9uUHJvY2Vzc0VudGl0eUV4PiB7XHJcbiAgICBjb25zdCBhcmdzID0gbmV3IEZvcm1HZXRCaWxsQ3JlYXRpb25Qcm9jZXNzRW50aXR5RXhBcmdzKCk7XHJcbiAgICBhcmdzLnVwQmlsbFZvSWQgPSB1cEJpbGxWb0lkO1xyXG4gICAgYXJncy5kb3duQmlsbFZvSWQgPSBkb3duVm9JZDtcclxuICAgIGFyZ3MubWFudWFsQ3JlYXRpb25Nb2RlID0gTWFudWFsQ3JlYXRpb25Nb2RlLlNwZWNpZmljUHVsbDtcclxuICAgIC8vIGFyZ3MuYml6Rmxvd2NoYXJ0SWQgPSBiaXpGbG93Y2hhcnRJZDtcclxuXHJcbiAgICByZXR1cm4gdGhpcy5vcGVuQmlsbENyZWF0aW9uUHJvY2Vzc1NlbGVjdG9yKGFyZ3MsIFB1bGxTZWxlY3RvckNvbXBvbmVudCwgbW9kYWxPcHRpb25zLCBjdXN0b21TZWxlY3Rvck1vZHVsZVVybCwgZXh0UGFyYW1zKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOaJk+W8gOadpea6kOWNleaNrumAieaLqeWZqFxyXG4gICAqIEBwYXJhbSBmb3JtU2V0dGluZ3NcclxuICAgKiBAcGFyYW0gbW9kYWxPcHRpb25zXHJcbiAgICovXHJcbiAgcHVibGljIG9wZW5Tb3VyY2VEYXRhU2VsZWN0b3I0UHVsbChmb3JtU2V0dGluZ3M/OiBGb3JtU2V0dGluZ3MsIG1vZGFsT3B0aW9ucz86IE1vZGFsT3B0aW9ucywgZXh0UGFyYW1zPzogeyBib290c3RyYXBDb21wb25lbnRTZWxlY3Rvcj86IHN0cmluZywgW2tleTogc3RyaW5nXTogYW55IH0pOiBPYnNlcnZhYmxlPEVudGl0eVtdPiB7XHJcbiAgICBtb2RhbE9wdGlvbnMgPSBtb2RhbE9wdGlvbnMgPT0gbnVsbCA/IHRoaXMuZGVmYXVsdE1vZGFsT3B0aW9ucyA6IG1vZGFsT3B0aW9ucztcclxuICAgIG1vZGFsT3B0aW9ucy50aXRsZSA9IG1vZGFsT3B0aW9ucy50aXRsZSA9PSBudWxsID8gdGhpcy5sb2NhbGVQaXBlLnRyYW5zZm9ybShcInNvdXJjZURhdGFTZWxlY3RvclwiKSA6IG1vZGFsT3B0aW9ucy50aXRsZTtcclxuXHJcbiAgICBsZXQgY21wUjogQ29tcG9uZW50UmVmPElCaWZEYXRhU2VsZWN0b3JDb21wb25lbnQ+ID0gbnVsbDtcclxuICAgIGlmIChmb3JtU2V0dGluZ3MgPT0gbnVsbCB8fCBmb3JtU2V0dGluZ3Muc291cmNlRGF0YVNlbGVjdG9yTW9kdWxlVXJsID09IG51bGwpIC8vIOayoeaciemFjee9ruaXtuWKoOi9vem7mOiupOmAmueUqOWNleaNrumAieaLqeWZqFxyXG4gICAge1xyXG4gICAgICB0aGlzLm1lc3NhZ2VyLmVycm9yKHRoaXMubG9jYWxlUGlwZS5pbnN0YW50KFwibm9EZWZhdWx0VXBCaWxsU2VsZWN0b3JcIikpO1xyXG4gICAgICB0aHJvdyBcIuaaguaXoOm7mOiupOWunueOsO+8jOivt+S9v+eUqOiHquWumuS5ieadpea6kOWNleaNrumAieaLqeWZqOOAguivt+ehruS/neeUn+WNlea1geeoi+S4reOAkOmbhuaIkOWcuuaZr+OAkeWQr+eUqOS6huOAkOS6uuW3peaLieW8j+eUn+WNleOAkeWcuuaZr++8jOW5tuS4lOOAkOWNleaNrumFjee9ruOAkS3jgJDmi4nlvI/nlJ/ljZXphY3nva7jgJEt44CQ5LiK5ri45bqU55So5YWl5Y+j44CR5oiW44CQVVJM44CR5LiN5Li656m6XCI7XHJcbiAgICAgIC8vIGxldCBjbXBGOiBDb21wb25lbnRGYWN0b3J5PFNvdXJjZURhdGFTZWxlY3RvckNvbXBvbmVudD4gPSB0aGlzLmNmci5yZXNvbHZlQ29tcG9uZW50RmFjdG9yeShTb3VyY2VEYXRhU2VsZWN0b3JDb21wb25lbnQpO1xyXG4gICAgICAvLyBsZXQgaW5qOiBJbmplY3RvciA9IEluamVjdG9yLmNyZWF0ZShbXHJcbiAgICAgIC8vIF0sIHRoaXMuaW5qZWN0b3IpO1xyXG4gICAgICAvLyBjbXBSID0gY21wRi5jcmVhdGUoaW5qKTtcclxuICAgICAgLy8gdGhpcy5jb25maWdNb2RhbEJ1dHRvbnMobW9kYWxPcHRpb25zLCBjbXBSKTtcclxuXHJcbiAgICAgIC8vIGNtcFIuaW5zdGFuY2UuYnNNb2RhbFJlZjRBaWZTZWxlY3RvciA9IHRoaXMubW9kYWxTZXJ2aWNlLnNob3coY21wUiwgbW9kYWxPcHRpb25zKTtcclxuICAgICAgLy8gcmV0dXJuIGNtcFIuaW5zdGFuY2Uuc3ViamVjdDRFbnRpdHlEYXRhcy5hc09ic2VydmFibGUoKTtcclxuICAgIH1cclxuICAgIGVsc2UgLy/liqDovb3oh6rlrprkuYnmnaXmupDljZXmja7pgInmi6nlmahcclxuICAgIHtcclxuICAgICAgLy8gcmV0dXJuIGZyb20oU3lzdGVtLmltcG9ydChmb3JtU2V0dGluZ3Muc291cmNlRGF0YVNlbGVjdG9yTW9kdWxlVXJsLnN1YnN0cmluZygwLCBmb3JtU2V0dGluZ3Muc291cmNlRGF0YVNlbGVjdG9yTW9kdWxlVXJsLmluZGV4T2YoXCIjXCIpKSArIFwiLmpzXCIpKS5waXBlKFxyXG4gICAgICBsZXQgbW9kdWxlRiQgPSBudWxsO1xyXG4gICAgICBpZiAoZm9ybVNldHRpbmdzLnNvdXJjZURhdGFTZWxlY3RvckFwcElkICE9IG51bGwpIC8v6YWN572uYXBwSWTml7ZcclxuICAgICAge1xyXG4gICAgICAgIG1vZHVsZUYkID0gZnJvbShTeXN0ZW0uaW1wb3J0KGZvcm1TZXR0aW5ncy5zb3VyY2VEYXRhU2VsZWN0b3JNb2R1bGVVcmwudG9Mb3dlckNhc2UoKSkudGhlbihtID0+IG0pKS5waXBlKFxyXG4gICAgICAgICAgc3dpdGNoTWFwKFxyXG4gICAgICAgICAgICAobTogeyBba2V5OiBzdHJpbmddOiBOZ01vZHVsZUZhY3Rvcnk8SUJpZkRhdGFTZWxlY3Rvck1vZHVsZT4gfSkgPT4ge1xyXG4gICAgICAgICAgICAgIGZvciAobGV0IGtleSBpbiBtKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gb2YobVtrZXldKTtcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgcmV0dXJuIG9mKG51bGwpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICApXHJcbiAgICAgICAgKTtcclxuICAgICAgfVxyXG4gICAgICBlbHNlIC8v5Y+q6YWN572udXJs5pe2XHJcbiAgICAgIHtcclxuICAgICAgICBtb2R1bGVGJCA9IGZyb20odGhpcy5sb2FkZXIubG9hZChmb3JtU2V0dGluZ3Muc291cmNlRGF0YVNlbGVjdG9yTW9kdWxlVXJsKSk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHJldHVybiBtb2R1bGVGJC5waXBlKFxyXG4gICAgICAgIHN3aXRjaE1hcChcclxuICAgICAgICAgIChtb2R1bGVGYWN0b3J5OiBOZ01vZHVsZUZhY3Rvcnk8SUJpZkRhdGFTZWxlY3Rvck1vZHVsZT4pID0+IHtcclxuICAgICAgICAgICAgY29uc3QgbW9kdWxlUmVmID0gbW9kdWxlRmFjdG9yeS5jcmVhdGUodGhpcy5mcmFtZUNvbnRleHQucm9vdC5pbmplY3Rvcik7XHJcbiAgICAgICAgICAgIGlmIChtb2R1bGVSZWYuaW5zdGFuY2UuY3JlYXRlU291cmNlRGF0YVNlbGVjdG9yICYmIG1vZHVsZVJlZi5pbnN0YW5jZS5jcmVhdGVTb3VyY2VEYXRhU2VsZWN0b3IgaW5zdGFuY2VvZiBGdW5jdGlvbikvL21vZHVsZeS4iuWumuS5iWNyZWF0ZVNvdXJjZURhdGFTZWxlY3RvcuaWueazlVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgY29uc3QgY21wUiQgPSBtb2R1bGVSZWYuaW5zdGFuY2UuY3JlYXRlU291cmNlRGF0YVNlbGVjdG9yKHRoaXMuZnJhbWVDb250ZXh0LnJvb3QuaW5qZWN0b3IsIG51bGwsIGV4dFBhcmFtcyk7XHJcbiAgICAgICAgICAgICAgaWYgKGNtcFIkIGluc3RhbmNlb2YgT2JzZXJ2YWJsZSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGNtcFIkLnBpcGUoXHJcbiAgICAgICAgICAgICAgICAgIHN3aXRjaE1hcChcclxuICAgICAgICAgICAgICAgICAgICAoY29tcG9uZW50UmVmKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICBjbXBSID0gY29tcG9uZW50UmVmO1xyXG4gICAgICAgICAgICAgICAgICAgICAgdGhpcy5jb25maWdNb2RhbEJ1dHRvbnMobW9kYWxPcHRpb25zLCBjbXBSKTtcclxuICAgICAgICAgICAgICAgICAgICAgIGNtcFIuaW5zdGFuY2UuYnNNb2RhbFJlZjRCaWZTZWxlY3RvciA9IHRoaXMubW9kYWxTZXJ2aWNlLnNob3coY21wUiwgbW9kYWxPcHRpb25zKTtcclxuICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjbXBSLmluc3RhbmNlLnN1YmplY3Q0RW50aXR5RGF0YXMuYXNPYnNlcnZhYmxlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICApXHJcbiAgICAgICAgICAgICAgICApO1xyXG4gICAgICAgICAgICAgIH0gZWxzZSBpZiAoY21wUiQgaW5zdGFuY2VvZiBDb21wb25lbnRSZWYpIHtcclxuICAgICAgICAgICAgICAgIGNtcFIgPSBjbXBSJDtcclxuICAgICAgICAgICAgICAgIHRoaXMuY29uZmlnTW9kYWxCdXR0b25zKG1vZGFsT3B0aW9ucywgY21wUik7XHJcbiAgICAgICAgICAgICAgICBjbXBSLmluc3RhbmNlLmJzTW9kYWxSZWY0QmlmU2VsZWN0b3IgPSB0aGlzLm1vZGFsU2VydmljZS5zaG93KGNtcFIsIG1vZGFsT3B0aW9ucyk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gY21wUi5pbnN0YW5jZS5zdWJqZWN0NEVudGl0eURhdGFzLmFzT2JzZXJ2YWJsZSgpO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIC8vbW9kdWxl5LiK5pyq5a6a5LmJ5pe25bCd6K+V5a+75om+Um9vdENvbXBvbmVudOexu1xyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgY29uc3QgdHJhbnNsYXRlOiBUcmFuc2xhdGVTZXJ2aWNlID0gbW9kdWxlUmVmLmluamVjdG9yLmdldChUcmFuc2xhdGVTZXJ2aWNlKTtcclxuICAgICAgICAgICAgICByZXR1cm4gdHJhbnNsYXRlLmdldFRyYW5zbGF0aW9uKHRoaXMubG9jYWxlSWQpLnBpcGUoXHJcbiAgICAgICAgICAgICAgICBzd2l0Y2hNYXAoXHJcbiAgICAgICAgICAgICAgICAgIChkYXRhKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgdHJhbnNsYXRlLnNldFRyYW5zbGF0aW9uKHRoaXMubG9jYWxlSWQsIGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRyYW5zbGF0ZS5kZWZhdWx0TGFuZyA9IHRoaXMubG9jYWxlSWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgdHJhbnNsYXRlLmN1cnJlbnRMYW5nID0gdGhpcy5sb2NhbGVJZDtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5nZXRFbnRpdHlEYXRhKG1vZHVsZVJlZiwgZm9ybVNldHRpbmdzLCBtb2RhbE9wdGlvbnMsIGV4dFBhcmFtcyk7XHJcbiAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICksXHJcbiAgICAgICAgICAgICAgICBjYXRjaEVycm9yKFxyXG4gICAgICAgICAgICAgICAgICAoZXJyKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihlcnIpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmdldEVudGl0eURhdGEobW9kdWxlUmVmLCBmb3JtU2V0dGluZ3MsIG1vZGFsT3B0aW9ucywgZXh0UGFyYW1zKTtcclxuICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgKVxyXG4gICAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgKVxyXG4gICAgICApO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQERlcHJlY2F0ZWQg5bey5byD55So77yM6K+35L2/55Soe0BsaW5rIGdldENyZWF0aW9uUmVzdWx0fVxyXG4gICAqIOiOt+WPluS8oOWIsOaguee7hOS7tlVJU3RhdGXkuIrnmoTnlJ/ljZXop4TliJnmiafooYzlmajnu5PmnpxcclxuICAgKi9cclxuICBwdWJsaWMgZ2V0Rm9ybUJpbGxDcmVhdGlvblByb2Nlc3NFeGVjdXRvclJlc3VsdCgpOiBGb3JtQmlsbENyZWF0aW9uUHJvY2Vzc0V4ZWN1dG9yUmVzdWx0IHtcclxuICAgIC8v5Y+W5b6XdGFiSWTkuLpbQXBwSWRdX1tBcHBFbnRyYW5jZV1fW3RhYklkXVxyXG4gICAgbGV0IHRhYklkOiBzdHJpbmcgPSB0aGlzLnJ1bnRpbWVGcmFtZXdvcmtTZXJ2aWNlLnRhYklkIHx8IHRoaXMuZ2V0UXVlcnlTdHJpbmcoXCJ0YWJJZFwiKSB8fCBcIlwiO1xyXG4gICAgbGV0IGRhdGFJZCA9IHRhYklkLnN1YnN0cih0YWJJZC5sZW5ndGggLSAzNilcclxuICAgIC8vIGNvbnNvbGUubG9nKHRhYklkKTtcclxuICAgIC8vIGNvbnNvbGUubG9nKGRhdGFJZCk7XHJcbiAgICBjb25zdCBicm93c2VyID0ganVkZ2VCcm93c2VyVHlwZSgpO1xyXG5cclxuICAgIC8vSUUxMea1j+iniOWZqOS7jmxvY2FsU3RvcmFnZeWPluWAvOWQjuW5tuWIoOmZpCwg5bm25a2Y5YWlVUlTdGF0ZVxyXG4gICAgaWYgKGJyb3dzZXIudHlwZSA9PSBcIklFXCIgJiYgYnJvd3Nlci5JRVZlcnNpb24gPT0gXCJJRTExXCIpIHtcclxuICAgICAgY29uc3QgdG1wID0gd2luZG93LnRvcC5sb2NhbFN0b3JhZ2UuZ2V0SXRlbShkYXRhSWQpO1xyXG4gICAgICB3aW5kb3cudG9wLmxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKGRhdGFJZCk7XHJcbiAgICAgIHRoaXMuZnJhbWVDb250ZXh0LnJvb3QudWlTdGF0ZS5zZXRQcm9wZXJ0eVZhbHVlKHRoaXMudWlTdGF0ZUtleUNyZWF0aW9uUmVzdWx0LCB0bXApO1xyXG4gICAgfVxyXG5cclxuICAgIGxldCByZXNUZW1wID0gdGhpcy5mcmFtZUNvbnRleHQucm9vdC51aVN0YXRlW3RoaXMudWlTdGF0ZUtleUNyZWF0aW9uUmVzdWx0XTtcclxuICAgIGlmIChyZXNUZW1wID09IG51bGwpIHtcclxuICAgICAgdGhyb3cgXCJGb3JtQmlsbENyZWF0aW9uUHJvY2Vzc0V4ZWN1dG9yUmVzdWx0IGlzIG51bGxcIjtcclxuICAgIH1cclxuICAgIGNvbnN0IHJlc3VsdCA9IG5ldyBGb3JtQmlsbENyZWF0aW9uUHJvY2Vzc0V4ZWN1dG9yUmVzdWx0KCk7XHJcbiAgICBpZiAodHlwZW9mIHJlc1RlbXAgPT0gXCJzdHJpbmdcIikge1xyXG4gICAgICByZXN1bHQuTG9hZEZyb21Kc29uKHJlc1RlbXApO1xyXG4gICAgfSBlbHNlIGlmICh0eXBlb2YgcmVzVGVtcCA9PSBcIm9iamVjdFwiKSB7XHJcbiAgICAgIHJlc3VsdC5Mb2FkRnJvbUpzb25PYmplY3QocmVzVGVtcCk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aHJvdyBcIuS4jeWQiOazleeahOexu+Wei1wiO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHJlc3VsdDtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBnZXRRdWVyeVN0cmluZyhuYW1lKSB7XHJcbiAgICBsZXQgcmVnID0gbmV3IFJlZ0V4cChcIihefCYpXCIgKyBuYW1lICsgXCI9KFteJl0qKSgmfCQpXCIsIFwiaVwiKTtcclxuICAgIGxldCByID0gd2luZG93LmxvY2F0aW9uLnNlYXJjaC5zdWJzdHIoMSkubWF0Y2gocmVnKTtcclxuICAgIGlmIChyICE9IG51bGwpIHtcclxuICAgICAgcmV0dXJuIHVuZXNjYXBlKHJbMl0pO1xyXG4gICAgfTtcclxuICAgIHJldHVybiBudWxsO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog6I635Y+W5Lyg5Yiw5qC557uE5Lu2VUlTdGF0ZeS4iueahOeUn+WNleinhOWImeaJp+ihjOWZqOe7k+aenFxyXG4gICAqL1xyXG4gIHB1YmxpYyBnZXRDcmVhdGlvblJlc3VsdCgpOiBPYnNlcnZhYmxlPEZvcm1CaWxsQ3JlYXRpb25Qcm9jZXNzRXhlY3V0b3JSZXN1bHQ+IHtcclxuICAgIC8v5Y+W5b6XdGFiSWTkuLpbQXBwSWRdX1tBcHBFbnRyYW5jZV1fW3RhYklkXVxyXG4gICAgbGV0IHRhYklkOiBzdHJpbmcgPSB0aGlzLnJ1bnRpbWVGcmFtZXdvcmtTZXJ2aWNlLnRhYklkIHx8IHRoaXMuZ2V0UXVlcnlTdHJpbmcoXCJ0YWJJZFwiKSB8fCBcIlwiO1xyXG4gICAgbGV0IGRhdGFJZCA9IHRhYklkLnN1YnN0cih0YWJJZC5sZW5ndGggLSAzNilcclxuICAgIC8vIGNvbnNvbGUubG9nKHRhYklkKTtcclxuICAgIC8vIGNvbnNvbGUubG9nKGRhdGFJZCk7XHJcbiAgICBjb25zdCBicm93c2VyID0ganVkZ2VCcm93c2VyVHlwZSgpO1xyXG5cclxuICAgIC8vSUUxMea1j+iniOWZqOS7jmxvY2FsU3RvcmFnZeWPluWAvOWQjuW5tuWIoOmZpCwg5bm25a2Y5YWlVUlTdGF0ZVxyXG4gICAgaWYgKGJyb3dzZXIudHlwZSA9PSBcIklFXCIgJiYgYnJvd3Nlci5JRVZlcnNpb24gPT0gXCJJRTExXCIpIHtcclxuICAgICAgY29uc3QgdG1wID0gd2luZG93LnRvcC5sb2NhbFN0b3JhZ2UuZ2V0SXRlbShkYXRhSWQpO1xyXG4gICAgICB3aW5kb3cudG9wLmxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKGRhdGFJZCk7XHJcbiAgICAgIHRoaXMuZnJhbWVDb250ZXh0LnJvb3QudWlTdGF0ZS5zZXRQcm9wZXJ0eVZhbHVlKHRoaXMudWlTdGF0ZUtleUNyZWF0aW9uUmVzdWx0LCB0bXApO1xyXG4gICAgfVxyXG5cclxuICAgIGxldCByZXNUZW1wID0gdGhpcy5mcmFtZUNvbnRleHQucm9vdC51aVN0YXRlW3RoaXMudWlTdGF0ZUtleUNyZWF0aW9uUmVzdWx0XTtcclxuICAgIGlmIChyZXNUZW1wID09IG51bGwpIHtcclxuICAgICAgdGhyb3cgXCJGb3JtQmlsbENyZWF0aW9uUHJvY2Vzc0V4ZWN1dG9yUmVzdWx0IGlzIG51bGxcIjtcclxuICAgIH1cclxuICAgIGNvbnN0IHJlc3VsdCA9IG5ldyBGb3JtQmlsbENyZWF0aW9uUHJvY2Vzc0V4ZWN1dG9yUmVzdWx0KCk7XHJcbiAgICBpZiAodHlwZW9mIHJlc1RlbXAgPT0gXCJzdHJpbmdcIikge1xyXG4gICAgICAvLyDlhbzlrrnljp/nm7TmjqXkvKDpgJLnlJ/ljZXmlbDmja7lnLrmma9cclxuICAgICAgaWYgKGNhbkpTT05QYXJzZShyZXNUZW1wKSkge1xyXG4gICAgICAgIHJlc3VsdC5Mb2FkRnJvbUpzb24ocmVzVGVtcCk7XHJcbiAgICAgICAgcmV0dXJuIG9mKHJlc3VsdCk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgY29uc3QgcmVzdWx0VGV4dElkID0gcmVzVGVtcDtcclxuICAgICAgICByZXR1cm4gdGhpcy5kYXRhU2VydmljZS5nZXRDcmVhdGlvblJlc3VsdEJ5SWQocmVzdWx0VGV4dElkKTtcclxuICAgICAgfVxyXG4gICAgfSBlbHNlIGlmICh0eXBlb2YgcmVzVGVtcCA9PSBcIm9iamVjdFwiKSB7XHJcbiAgICAgIHJlc3VsdC5Mb2FkRnJvbUpzb25PYmplY3QocmVzVGVtcCk7XHJcbiAgICAgIHJldHVybiBvZihyZXN1bHQpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhyb3cgXCLkuI3lkIjms5XnmoTnsbvlnotcIjtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOmFjee9ruaooeaAgeahhuaMiemSruS6i+S7tlxyXG4gICAqIEBwYXJhbSBtb2RhbE9wdGlvbnNcclxuICAgKiBAcGFyYW0gY21wUlxyXG4gICAqL1xyXG4gIHByb3RlY3RlZCBjb25maWdNb2RhbEJ1dHRvbnNCeVNlcnZpY2UobW9kYWxPcHRpb25zOiBNb2RhbE9wdGlvbnMsIHNlcnZpY2U6IEFic3RyYWN0QmlmRGF0YVNlbGVjdG9yU2VydmljZSkge1xyXG4gICAgbW9kYWxPcHRpb25zLmJ1dHRvbnMgPSBbXHJcbiAgICAgIHtcclxuICAgICAgICB0ZXh0OiB0aGlzLmxvY2FsZVBpcGUudHJhbnNmb3JtKFwiY29uZmlybVwiKSxcclxuICAgICAgICBjbHM6IFwiYnRuIGJ0bi1wcmltYXJ5XCIsXHJcbiAgICAgICAgaGFuZGxlOiBzZXJ2aWNlLmNsaWNrT2s0QmlmU2VsZWN0b3IsXHJcbiAgICAgIH0sXHJcbiAgICAgIHtcclxuICAgICAgICB0ZXh0OiB0aGlzLmxvY2FsZVBpcGUudHJhbnNmb3JtKFwiY2FuY2VsXCIpLFxyXG4gICAgICAgIGNsczogXCJidG4gYnRuLXNlY29uZGFyeVwiLFxyXG4gICAgICAgIGhhbmRsZTogc2VydmljZS5jbGlja0Nsb3NlNEJpZlNlbGVjdG9yLFxyXG4gICAgICB9XHJcbiAgICBdO1xyXG4gICAgbW9kYWxPcHRpb25zLnNob3dCdXR0b25zID0gdHJ1ZTtcclxuICB9XHJcblxyXG4gIHByb3RlY3RlZCBnZXRFbnRpdHlEYXRhKG1vZHVsZVJlZjogTmdNb2R1bGVSZWY8YW55PiwgZm9ybVNldHRpbmdzPzogRm9ybVNldHRpbmdzLCBtb2RhbE9wdGlvbnM/OiBNb2RhbE9wdGlvbnMsIGV4dFBhcmFtcz86IHsgYm9vdHN0cmFwQ29tcG9uZW50U2VsZWN0b3I/OiBzdHJpbmcsIGxvYWRDb21tYW5kPzogc3RyaW5nLCBsb2FkUGFyYW1zPzogYW55LCBba2V5OiBzdHJpbmddOiBhbnkgfSk6IE9ic2VydmFibGU8RW50aXR5W10+IHtcclxuICAgIGxldCBjbXBGOiBDb21wb25lbnRGYWN0b3J5PElCaWZEYXRhU2VsZWN0b3JDb21wb25lbnQgJiBGcmFtZUNvbXBvbmVudD4gPSBudWxsO1xyXG4gICAgbGV0IGNtcFI6IENvbXBvbmVudFJlZjxJQmlmRGF0YVNlbGVjdG9yQ29tcG9uZW50ICYgRnJhbWVDb21wb25lbnQ+ID0gbnVsbDtcclxuICAgIGxldCBib290c3RyYXBDb21wb25lbnRTZWxlY3RvciA9IFwiYXBwLXJvb3Rjb21wb25lbnRcIjtcclxuICAgIGxldCBib290c3RyYXBDb21wb25lbnQgPSBudWxsO1xyXG4gICAgbGV0IGZhY01hcDogTWFwPGFueSwgYW55PiA9IG1vZHVsZVJlZi5jb21wb25lbnRGYWN0b3J5UmVzb2x2ZXJbJ19mYWN0b3JpZXMnXTtcclxuICAgIGxldCBzdWJqZWN0NEVudGl0eURhdGFzOiBPYnNlcnZhYmxlPEVudGl0eVtdPiA9IG51bGw7XHJcbiAgICBpZiAoZXh0UGFyYW1zICYmIGV4dFBhcmFtcy5ib290c3RyYXBDb21wb25lbnRTZWxlY3RvcikvL+aMh+WumuS6huaguee7hOS7tnNlbGVjdG9yXHJcbiAgICB7XHJcbiAgICAgIGJvb3RzdHJhcENvbXBvbmVudFNlbGVjdG9yID0gZXh0UGFyYW1zLmJvb3RzdHJhcENvbXBvbmVudFNlbGVjdG9yO1xyXG5cclxuICAgICAgZmFjTWFwLmZvckVhY2goKHZhbHVlOiBhbnksIGtleTogRnVuY3Rpb24sIG1hcDogTWFwPGFueSwgYW55PikgPT4ge1xyXG4gICAgICAgIGNvbnN0IHNlbGVjdG9yID0gdmFsdWUuc2VsZWN0b3I7XHJcbiAgICAgICAgaWYgKGJvb3RzdHJhcENvbXBvbmVudFNlbGVjdG9yID09IHNlbGVjdG9yKSB7XHJcbiAgICAgICAgICBjbXBGID0gbW9kdWxlUmVmLmNvbXBvbmVudEZhY3RvcnlSZXNvbHZlci5yZXNvbHZlQ29tcG9uZW50RmFjdG9yeShrZXkgYXMgYW55KTtcclxuICAgICAgICAgIGNtcFIgPSBjbXBGLmNyZWF0ZShtb2R1bGVSZWYuaW5qZWN0b3IpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICBlbHNlIC8v5pyq5oyH5a6a5qC557uE5Lu2c2VsZWN0b3JcclxuICAgIHtcclxuICAgICAgYm9vdHN0cmFwQ29tcG9uZW50ID0gbW9kdWxlUmVmWydfYm9vdHN0cmFwQ29tcG9uZW50cyddWzBdO1xyXG5cclxuICAgICAgaWYgKGJvb3RzdHJhcENvbXBvbmVudCkvL+WFiOaJvmJvb3RzdHJhcENvbXBvbmVudOaVsOe7hOacieaXoOe7hOS7tlxyXG4gICAgICB7XHJcbiAgICAgICAgY21wRiA9IG1vZHVsZVJlZi5jb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIucmVzb2x2ZUNvbXBvbmVudEZhY3RvcnkoYm9vdHN0cmFwQ29tcG9uZW50KTtcclxuICAgICAgICBjbXBSID0gY21wRi5jcmVhdGUobW9kdWxlUmVmLmluamVjdG9yKSBhcyBhbnk7XHJcbiAgICAgIH1cclxuICAgICAgZWxzZS8v5rKh5pyJ5YiZ5LuOZmFjTWFw5Lit5p+l5om+6buY6K6k55qEYXBwLXJvb3Rjb21wb25lbnRcclxuICAgICAge1xyXG4gICAgICAgIGZhY01hcC5mb3JFYWNoKCh2YWx1ZTogYW55LCBrZXk6IEZ1bmN0aW9uLCBtYXA6IE1hcDxhbnksIGFueT4pID0+IHtcclxuICAgICAgICAgIGNvbnN0IHNlbGVjdG9yID0gdmFsdWUuc2VsZWN0b3I7XHJcbiAgICAgICAgICBpZiAoYm9vdHN0cmFwQ29tcG9uZW50U2VsZWN0b3IgPT0gc2VsZWN0b3IpIHtcclxuICAgICAgICAgICAgY21wRiA9IG1vZHVsZVJlZi5jb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIucmVzb2x2ZUNvbXBvbmVudEZhY3Rvcnkoa2V5IGFzIGFueSk7XHJcbiAgICAgICAgICAgIGNtcFIgPSBjbXBGLmNyZWF0ZShtb2R1bGVSZWYuaW5qZWN0b3IpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICBpZiAoY21wUiAmJiBjbXBSLmluc3RhbmNlICYmIGNtcFIuaW5zdGFuY2Uudmlld01vZGVsICYmIGNtcFIuaW5zdGFuY2Uudmlld01vZGVsLnVpU3RhdGUpIHtcclxuICAgICAgY21wUi5pbnN0YW5jZS52aWV3TW9kZWwudWlTdGF0ZS5zZXRQcm9wZXJ0eVZhbHVlKFwiYWN0aW9uXCIsIFwiTG9hZDFcIik7XHJcbiAgICAgIGNtcFIuaW5zdGFuY2Uudmlld01vZGVsLnVpU3RhdGUuc2V0UHJvcGVydHlWYWx1ZSgnREVWS0lUX0RJQUxPRycsIHRydWUpO1xyXG4gICAgfVxyXG4gICAgY29uc3QgZGF0YVNlbGVjdG9yU2VydmljZTogQWJzdHJhY3RCaWZEYXRhU2VsZWN0b3JTZXJ2aWNlID0gY21wUi5pbmplY3Rvci5nZXQoQWJzdHJhY3RCaWZEYXRhU2VsZWN0b3JTZXJ2aWNlLCBudWxsKTtcclxuICAgIGlmIChkYXRhU2VsZWN0b3JTZXJ2aWNlICE9IG51bGwpIC8vIOaciUFic3RyYWN0QmlmRGF0YVNlbGVjdG9yU2VydmljZeeahHByb3ZpZGVy5pe2XHJcbiAgICB7XHJcbiAgICAgIHRoaXMuY29uZmlnTW9kYWxCdXR0b25zQnlTZXJ2aWNlKG1vZGFsT3B0aW9ucywgZGF0YVNlbGVjdG9yU2VydmljZSk7XHJcbiAgICAgIGRhdGFTZWxlY3RvclNlcnZpY2UuYnNNb2RhbFJlZjRCaWZTZWxlY3RvciA9IHRoaXMubW9kYWxTZXJ2aWNlLnNob3coY21wUiwgbW9kYWxPcHRpb25zKTtcclxuICAgICAgc3ViamVjdDRFbnRpdHlEYXRhcyA9IGRhdGFTZWxlY3RvclNlcnZpY2Uuc3ViamVjdDRFbnRpdHlEYXRhcy5hc09ic2VydmFibGUoKTtcclxuICAgIH1cclxuICAgIGVsc2UgLy/msqHmnInliJnku47nu4Tku7bkuIrlr7vmib7nm7jlupTlsZ7mgKdcclxuICAgIHtcclxuICAgICAgdGhpcy5jb25maWdNb2RhbEJ1dHRvbnMobW9kYWxPcHRpb25zLCBjbXBSKTtcclxuICAgICAgY21wUi5pbnN0YW5jZS5ic01vZGFsUmVmNEJpZlNlbGVjdG9yID0gdGhpcy5tb2RhbFNlcnZpY2Uuc2hvdyhjbXBSLCBtb2RhbE9wdGlvbnMpO1xyXG4gICAgICBzdWJqZWN0NEVudGl0eURhdGFzID0gY21wUi5pbnN0YW5jZS5zdWJqZWN0NEVudGl0eURhdGFzLmFzT2JzZXJ2YWJsZSgpO1xyXG4gICAgfVxyXG4gICAgLy8g5q2k5aSE55So5LqO6Kej5Yaz5Lu75Yqh5Lit5b+D55u05o6l5omT5byA5p2l5rqQ5Y2V5o2u5biu5Yqp5pe25LiN5omn6KGM5Yid5aeL5YyW5Yqg6L295ZG95Luk55qE6Zeu6aKYXHJcbiAgICBpZiAoY21wUiAmJiBjbXBSLmluc3RhbmNlICYmIGNtcFIuaW5zdGFuY2Uudmlld01vZGVsKSB7XHJcbiAgICAgIGlmIChleHRQYXJhbXMgJiYgZXh0UGFyYW1zLmxvYWRDb21tYW5kKSB7XHJcbiAgICAgICAgY29uc3QgbG9hZENvbW1hbmQgPSBleHRQYXJhbXMubG9hZENvbW1hbmQ7XHJcbiAgICAgICAgY29uc3QgY21kRnVuYzogRnVuY3Rpb24gPSBjbXBSLmluc3RhbmNlLnZpZXdNb2RlbFtsb2FkQ29tbWFuZF07XHJcbiAgICAgICAgaWYgKGNtZEZ1bmMpIHtcclxuICAgICAgICAgIGxldCBhcmdzID0gdW5kZWZpbmVkO1xyXG4gICAgICAgICAgaWYgKGV4dFBhcmFtcyAmJiBleHRQYXJhbXMubG9hZFBhcmFtcykge1xyXG4gICAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShleHRQYXJhbXMubG9hZFBhcmFtcykpIHtcclxuICAgICAgICAgICAgICBhcmdzID0gZXh0UGFyYW1zLmxvYWRQYXJhbXM7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgYXJncyA9IFtleHRQYXJhbXMubG9hZFBhcmFtc107XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH1cclxuICAgICAgICAgIGNtZEZ1bmMuYXBwbHkoY21wUi5pbnN0YW5jZS52aWV3TW9kZWwsIGFyZ3MpO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIHN1YmplY3Q0RW50aXR5RGF0YXM7XHJcbiAgfVxyXG59XHJcbiJdfQ==
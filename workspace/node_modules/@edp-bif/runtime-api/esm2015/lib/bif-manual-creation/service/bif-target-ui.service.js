/**
 * @fileoverview added by tsickle
 * Generated from: lib/bif-manual-creation/service/bif-target-ui.service.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Injectable, Injector, ComponentFactoryResolver, NgModuleFactoryLoader, Inject, LOCALE_ID, ComponentRef, Optional } from '@angular/core';
import { Observable, from, of } from 'rxjs';
import { switchMap, catchError } from 'rxjs/operators';
import { FrameContext } from '@farris/devkit';
import { BsModalService } from '@farris/ui-modal';
import { BIF_UISTATE_KEY_CREATION_RESULT } from '../config/bif-form-constants';
import { AbstractUiService } from './abstract-ui-service';
import { BifDataService } from './bif-data.service';
import { PullSelectorComponent } from '../components/pull-selector/pull-selector.component';
import { FormGetBillCreationProcessEntityExArgs } from '../../entity/form-rest/FormGetBillCreationProcessEntityExArgs';
import { ManualCreationMode } from '../../entity/form-rest/ManualCreationMode';
import { FormBillCreationProcessExecutorResult } from '@edp-aif/runtime-api';
import { MessagerService } from '@farris/ui-messager';
import { RuntimeFrameworkService } from '@farris/command-services';
import { judgeBrowserType } from '../../utils/BrowserUtil';
import { TranslateService } from "@ngx-translate/core";
import { AbstractBifDataSelectorService } from './bif-data-selector.service';
import { canJSONParse } from '../../utils/ObjectUtils';
export class BifTargetUiService extends AbstractUiService {
    /**
     * @param {?} dataService
     * @param {?} frameContext
     * @param {?} modalService
     * @param {?} messager
     * @param {?} injector
     * @param {?} cfr
     * @param {?} loader
     * @param {?} localeId
     * @param {?} runtimeFrameworkService
     */
    constructor(dataService, frameContext, modalService, messager, injector, cfr, loader, localeId, runtimeFrameworkService) {
        super(frameContext, modalService, messager, injector, cfr, loader, localeId, runtimeFrameworkService);
        this.dataService = dataService;
        this.frameContext = frameContext;
        this.modalService = modalService;
        this.messager = messager;
        this.injector = injector;
        this.cfr = cfr;
        this.loader = loader;
        this.localeId = localeId;
        this.uiStateKeyCreationResult = BIF_UISTATE_KEY_CREATION_RESULT;
    }
    /**
     * 参照时打开生单规则选择器
     * @param {?} downVoId
     * @param {?=} bizFlowchartId
     * @param {?=} modalOptions
     * @param {?=} customSelectorModuleUrl
     * @param {?=} extParams
     * @return {?}
     */
    openBillCreationProcessSelector4Pull(downVoId, bizFlowchartId, modalOptions, customSelectorModuleUrl, extParams) {
        /** @type {?} */
        const args = new FormGetBillCreationProcessEntityExArgs();
        args.downBillVoId = downVoId;
        args.manualCreationMode = ManualCreationMode.Pull;
        // args.bizFlowchartId = bizFlowchartId;
        return this.openBillCreationProcessSelector(args, PullSelectorComponent, modalOptions, customSelectorModuleUrl, extParams);
    }
    /**
     * 特定参照时打开生单规则选择器
     * @param {?} upBillVoId
     * @param {?} downVoId
     * @param {?=} bizFlowchartId
     * @param {?=} modalOptions
     * @param {?=} customSelectorModuleUrl
     * @param {?=} extParams
     * @return {?}
     */
    openBillCreationProcessSelector4SpecificPull(upBillVoId, downVoId, bizFlowchartId, modalOptions, customSelectorModuleUrl, extParams) {
        /** @type {?} */
        const args = new FormGetBillCreationProcessEntityExArgs();
        args.upBillVoId = upBillVoId;
        args.downBillVoId = downVoId;
        args.manualCreationMode = ManualCreationMode.SpecificPull;
        // args.bizFlowchartId = bizFlowchartId;
        return this.openBillCreationProcessSelector(args, PullSelectorComponent, modalOptions, customSelectorModuleUrl, extParams);
    }
    /**
     * 打开来源单据选择器
     * @param {?=} formSettings
     * @param {?=} modalOptions
     * @param {?=} extParams
     * @return {?}
     */
    openSourceDataSelector4Pull(formSettings, modalOptions, extParams) {
        modalOptions = modalOptions == null ? this.defaultModalOptions : modalOptions;
        modalOptions.title = modalOptions.title == null ? this.localePipe.transform("sourceDataSelector") : modalOptions.title;
        /** @type {?} */
        let cmpR = null;
        if (formSettings == null || formSettings.sourceDataSelectorModuleUrl == null) // 没有配置时加载默认通用单据选择器
         {
            this.messager.error(this.localePipe.instant("noDefaultUpBillSelector"));
            throw "暂无默认实现，请使用自定义来源单据选择器。请确保生单流程中【集成场景】启用了【人工拉式生单】场景，并且【单据配置】-【拉式生单配置】-【上游应用入口】或【URL】不为空";
            // let cmpF: ComponentFactory<SourceDataSelectorComponent> = this.cfr.resolveComponentFactory(SourceDataSelectorComponent);
            // let inj: Injector = Injector.create([
            // ], this.injector);
            // cmpR = cmpF.create(inj);
            // this.configModalButtons(modalOptions, cmpR);
            // cmpR.instance.bsModalRef4AifSelector = this.modalService.show(cmpR, modalOptions);
            // return cmpR.instance.subject4EntityDatas.asObservable();
        }
        else //加载自定义来源单据选择器
         {
            // return from(System.import(formSettings.sourceDataSelectorModuleUrl.substring(0, formSettings.sourceDataSelectorModuleUrl.indexOf("#")) + ".js")).pipe(
            /** @type {?} */
            let moduleF$ = null;
            if (formSettings.sourceDataSelectorAppId != null) //配置appId时
             {
                moduleF$ = from(System.import(formSettings.sourceDataSelectorModuleUrl.toLowerCase()).then((/**
                 * @param {?} m
                 * @return {?}
                 */
                m => m))).pipe(switchMap((/**
                 * @param {?} m
                 * @return {?}
                 */
                (m) => {
                    for (let key in m) {
                        return of(m[key]);
                    }
                    return of(null);
                })));
            }
            else //只配置url时
             {
                moduleF$ = from(this.loader.load(formSettings.sourceDataSelectorModuleUrl));
            }
            return moduleF$.pipe(switchMap((/**
             * @param {?} moduleFactory
             * @return {?}
             */
            (moduleFactory) => {
                /** @type {?} */
                const moduleRef = moduleFactory.create(this.frameContext.root.injector);
                if (moduleRef.instance.createSourceDataSelector && moduleRef.instance.createSourceDataSelector instanceof Function) //module上定义createSourceDataSelector方法
                 {
                    /** @type {?} */
                    const cmpR$ = moduleRef.instance.createSourceDataSelector(this.frameContext.root.injector, null, extParams);
                    if (cmpR$ instanceof Observable) {
                        return cmpR$.pipe(switchMap((/**
                         * @param {?} componentRef
                         * @return {?}
                         */
                        (componentRef) => {
                            cmpR = componentRef;
                            this.configModalButtons(modalOptions, cmpR);
                            cmpR.instance.bsModalRef4BifSelector = this.modalService.show(cmpR, modalOptions);
                            return cmpR.instance.subject4EntityDatas.asObservable();
                        })));
                    }
                    else if (cmpR$ instanceof ComponentRef) {
                        cmpR = cmpR$;
                        this.configModalButtons(modalOptions, cmpR);
                        cmpR.instance.bsModalRef4BifSelector = this.modalService.show(cmpR, modalOptions);
                        return cmpR.instance.subject4EntityDatas.asObservable();
                    }
                }
                else //module上未定义时尝试寻找RootComponent类
                 {
                    /** @type {?} */
                    const translate = moduleRef.injector.get(TranslateService);
                    return translate.getTranslation(this.localeId).pipe(switchMap((/**
                     * @param {?} data
                     * @return {?}
                     */
                    (data) => {
                        translate.setTranslation(this.localeId, data);
                        translate.defaultLang = this.localeId;
                        translate.currentLang = this.localeId;
                        return this.getEntityData(moduleRef, formSettings, modalOptions, extParams);
                    })), catchError((/**
                     * @param {?} err
                     * @return {?}
                     */
                    (err) => {
                        console.error(err);
                        return this.getEntityData(moduleRef, formSettings, modalOptions, extParams);
                    })));
                }
            })));
        }
    }
    /**
     * \@Deprecated 已弃用，请使用{\@link getCreationResult}
     * 获取传到根组件UIState上的生单规则执行器结果
     * @return {?}
     */
    getFormBillCreationProcessExecutorResult() {
        //取得tabId为[AppId]_[AppEntrance]_[tabId]
        /** @type {?} */
        let tabId = this.runtimeFrameworkService.tabId || this.getQueryString("tabId") || "";
        /** @type {?} */
        let dataId = tabId.substr(tabId.length - 36)
        // console.log(tabId);
        // console.log(dataId);
        ;
        // console.log(tabId);
        // console.log(dataId);
        /** @type {?} */
        const browser = judgeBrowserType();
        //IE11浏览器从localStorage取值后并删除, 并存入UIState
        if (browser.type == "IE" && browser.IEVersion == "IE11") {
            /** @type {?} */
            const tmp = window.top.localStorage.getItem(dataId);
            window.top.localStorage.removeItem(dataId);
            this.frameContext.root.uiState.setPropertyValue(this.uiStateKeyCreationResult, tmp);
        }
        /** @type {?} */
        let resTemp = this.frameContext.root.uiState[this.uiStateKeyCreationResult];
        if (resTemp == null) {
            throw "FormBillCreationProcessExecutorResult is null";
        }
        /** @type {?} */
        const result = new FormBillCreationProcessExecutorResult();
        if (typeof resTemp == "string") {
            result.LoadFromJson(resTemp);
        }
        else if (typeof resTemp == "object") {
            result.LoadFromJsonObject(resTemp);
        }
        else {
            throw "不合法的类型";
        }
        return result;
    }
    /**
     * @param {?} name
     * @return {?}
     */
    getQueryString(name) {
        /** @type {?} */
        let reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i");
        /** @type {?} */
        let r = window.location.search.substr(1).match(reg);
        if (r != null) {
            return unescape(r[2]);
        }
        ;
        return null;
    }
    /**
     * 获取传到根组件UIState上的生单规则执行器结果
     * @return {?}
     */
    getCreationResult() {
        //取得tabId为[AppId]_[AppEntrance]_[tabId]
        /** @type {?} */
        let tabId = this.runtimeFrameworkService.tabId || this.getQueryString("tabId") || "";
        /** @type {?} */
        let dataId = tabId.substr(tabId.length - 36)
        // console.log(tabId);
        // console.log(dataId);
        ;
        // console.log(tabId);
        // console.log(dataId);
        /** @type {?} */
        const browser = judgeBrowserType();
        //IE11浏览器从localStorage取值后并删除, 并存入UIState
        if (browser.type == "IE" && browser.IEVersion == "IE11") {
            /** @type {?} */
            const tmp = window.top.localStorage.getItem(dataId);
            window.top.localStorage.removeItem(dataId);
            this.frameContext.root.uiState.setPropertyValue(this.uiStateKeyCreationResult, tmp);
        }
        /** @type {?} */
        let resTemp = this.frameContext.root.uiState[this.uiStateKeyCreationResult];
        if (resTemp == null) {
            throw "FormBillCreationProcessExecutorResult is null";
        }
        /** @type {?} */
        const result = new FormBillCreationProcessExecutorResult();
        if (typeof resTemp == "string") {
            // 兼容原直接传递生单数据场景
            if (canJSONParse(resTemp)) {
                result.LoadFromJson(resTemp);
                return of(result);
            }
            else {
                /** @type {?} */
                const resultTextId = resTemp;
                return this.dataService.getCreationResultById(resultTextId);
            }
        }
        else if (typeof resTemp == "object") {
            result.LoadFromJsonObject(resTemp);
            return of(result);
        }
        else {
            throw "不合法的类型";
        }
    }
    /**
     * 配置模态框按钮事件
     * @protected
     * @param {?} modalOptions
     * @param {?} service
     * @return {?}
     */
    configModalButtonsByService(modalOptions, service) {
        modalOptions.buttons = [
            {
                text: this.localePipe.transform("confirm"),
                cls: "btn btn-primary",
                handle: service.clickOk4BifSelector,
            },
            {
                text: this.localePipe.transform("cancel"),
                cls: "btn btn-secondary",
                handle: service.clickClose4BifSelector,
            }
        ];
        modalOptions.showButtons = true;
    }
    /**
     * @protected
     * @param {?} moduleRef
     * @param {?=} formSettings
     * @param {?=} modalOptions
     * @param {?=} extParams
     * @return {?}
     */
    getEntityData(moduleRef, formSettings, modalOptions, extParams) {
        /** @type {?} */
        let cmpF = null;
        /** @type {?} */
        let cmpR = null;
        /** @type {?} */
        let bootstrapComponentSelector = "app-rootcomponent";
        /** @type {?} */
        let bootstrapComponent = null;
        /** @type {?} */
        let facMap = moduleRef.componentFactoryResolver['_factories'];
        /** @type {?} */
        let subject4EntityDatas = null;
        if (extParams && extParams.bootstrapComponentSelector) //指定了根组件selector
         {
            bootstrapComponentSelector = extParams.bootstrapComponentSelector;
            facMap.forEach((/**
             * @param {?} value
             * @param {?} key
             * @param {?} map
             * @return {?}
             */
            (value, key, map) => {
                /** @type {?} */
                const selector = value.selector;
                if (bootstrapComponentSelector == selector) {
                    cmpF = moduleRef.componentFactoryResolver.resolveComponentFactory((/** @type {?} */ (key)));
                    cmpR = cmpF.create(moduleRef.injector);
                }
            }));
        }
        else //未指定根组件selector
         {
            bootstrapComponent = moduleRef['_bootstrapComponents'][0];
            if (bootstrapComponent) //先找bootstrapComponent数组有无组件
             {
                cmpF = moduleRef.componentFactoryResolver.resolveComponentFactory(bootstrapComponent);
                cmpR = (/** @type {?} */ (cmpF.create(moduleRef.injector)));
            }
            else //没有则从facMap中查找默认的app-rootcomponent
             {
                facMap.forEach((/**
                 * @param {?} value
                 * @param {?} key
                 * @param {?} map
                 * @return {?}
                 */
                (value, key, map) => {
                    /** @type {?} */
                    const selector = value.selector;
                    if (bootstrapComponentSelector == selector) {
                        cmpF = moduleRef.componentFactoryResolver.resolveComponentFactory((/** @type {?} */ (key)));
                        cmpR = cmpF.create(moduleRef.injector);
                    }
                }));
            }
        }
        if (cmpR && cmpR.instance && cmpR.instance.viewModel && cmpR.instance.viewModel.uiState) {
            cmpR.instance.viewModel.uiState.setPropertyValue("action", "Load1");
            cmpR.instance.viewModel.uiState.setPropertyValue('DEVKIT_DIALOG', true);
        }
        /** @type {?} */
        const dataSelectorService = cmpR.injector.get(AbstractBifDataSelectorService, null);
        if (dataSelectorService != null) // 有AbstractBifDataSelectorService的provider时
         {
            this.configModalButtonsByService(modalOptions, dataSelectorService);
            dataSelectorService.bsModalRef4BifSelector = this.modalService.show(cmpR, modalOptions);
            subject4EntityDatas = dataSelectorService.subject4EntityDatas.asObservable();
        }
        else //没有则从组件上寻找相应属性
         {
            this.configModalButtons(modalOptions, cmpR);
            cmpR.instance.bsModalRef4BifSelector = this.modalService.show(cmpR, modalOptions);
            subject4EntityDatas = cmpR.instance.subject4EntityDatas.asObservable();
        }
        // 此处用于解决任务中心直接打开来源单据帮助时不执行初始化加载命令的问题
        if (cmpR && cmpR.instance && cmpR.instance.viewModel) {
            if (extParams && extParams.loadCommand) {
                /** @type {?} */
                const loadCommand = extParams.loadCommand;
                /** @type {?} */
                const cmdFunc = cmpR.instance.viewModel[loadCommand];
                if (cmdFunc) {
                    /** @type {?} */
                    let args = undefined;
                    if (extParams && extParams.loadParams) {
                        if (Array.isArray(extParams.loadParams)) {
                            args = extParams.loadParams;
                        }
                        else {
                            args = [extParams.loadParams];
                        }
                    }
                    cmdFunc.apply(cmpR.instance.viewModel, args);
                }
            }
        }
        return subject4EntityDatas;
    }
}
BifTargetUiService.decorators = [
    { type: Injectable }
];
/** @nocollapse */
BifTargetUiService.ctorParameters = () => [
    { type: BifDataService },
    { type: FrameContext },
    { type: BsModalService },
    { type: MessagerService },
    { type: Injector },
    { type: ComponentFactoryResolver },
    { type: NgModuleFactoryLoader },
    { type: String, decorators: [{ type: Inject, args: [LOCALE_ID,] }] },
    { type: RuntimeFrameworkService, decorators: [{ type: Optional }] }
];
if (false) {
    /**
     * @type {?}
     * @private
     */
    BifTargetUiService.prototype.uiStateKeyCreationResult;
    /**
     * @type {?}
     * @protected
     */
    BifTargetUiService.prototype.dataService;
    /**
     * @type {?}
     * @protected
     */
    BifTargetUiService.prototype.frameContext;
    /**
     * @type {?}
     * @protected
     */
    BifTargetUiService.prototype.modalService;
    /**
     * @type {?}
     * @protected
     */
    BifTargetUiService.prototype.messager;
    /**
     * @type {?}
     * @protected
     */
    BifTargetUiService.prototype.injector;
    /**
     * @type {?}
     * @protected
     */
    BifTargetUiService.prototype.cfr;
    /**
     * @type {?}
     * @protected
     */
    BifTargetUiService.prototype.loader;
    /** @type {?} */
    BifTargetUiService.prototype.localeId;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmlmLXRhcmdldC11aS5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGVkcC1iaWYvcnVudGltZS1hcGkvIiwic291cmNlcyI6WyJsaWIvYmlmLW1hbnVhbC1jcmVhdGlvbi9zZXJ2aWNlL2JpZi10YXJnZXQtdWkuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsUUFBUSxFQUFFLHdCQUF3QixFQUFFLHFCQUFxQixFQUFFLE1BQU0sRUFBRSxTQUFTLEVBQUUsWUFBWSxFQUFtQixRQUFRLEVBQWlDLE1BQU0sZUFBZSxDQUFDO0FBQ2pNLE9BQU8sRUFBRSxVQUFVLEVBQUUsSUFBSSxFQUFFLEVBQUUsRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUM1QyxPQUFPLEVBQUUsU0FBUyxFQUFlLFVBQVUsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBRXBFLE9BQU8sRUFBRSxZQUFZLEVBQTBCLE1BQU0sZ0JBQWdCLENBQUM7QUFDdEUsT0FBTyxFQUFFLGNBQWMsRUFBZ0IsTUFBTSxrQkFBa0IsQ0FBQztBQUtoRSxPQUFPLEVBQUUsK0JBQStCLEVBQUUsTUFBTSw4QkFBOEIsQ0FBQztBQUMvRSxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQUMxRCxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sb0JBQW9CLENBQUM7QUFDcEQsT0FBTyxFQUFFLHFCQUFxQixFQUFFLE1BQU0scURBQXFELENBQUM7QUFHNUYsT0FBTyxFQUFFLHNDQUFzQyxFQUFFLE1BQU0sK0RBQStELENBQUM7QUFDdkgsT0FBTyxFQUFFLGtCQUFrQixFQUFFLE1BQU0sMkNBQTJDLENBQUM7QUFDL0UsT0FBTyxFQUFFLHFDQUFxQyxFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFDN0UsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQ3RELE9BQU8sRUFBRSx1QkFBdUIsRUFBRSxNQUFNLDBCQUEw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LCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlLCBJbmplY3RvciwgQ29tcG9uZW50RmFjdG9yeVJlc29sdmVyLCBOZ01vZHVsZUZhY3RvcnlMb2FkZXIsIEluamVjdCwgTE9DQUxFX0lELCBDb21wb25lbnRSZWYsIE5nTW9kdWxlRmFjdG9yeSwgT3B0aW9uYWwsIE5nTW9kdWxlUmVmLCBDb21wb25lbnRGYWN0b3J5IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IE9ic2VydmFibGUsIGZyb20sIG9mIH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7IHN3aXRjaE1hcCwgc3dpdGNoTWFwVG8sIGNhdGNoRXJyb3IgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XHJcblxyXG5pbXBvcnQgeyBGcmFtZUNvbnRleHQsIEVudGl0eSwgRnJhbWVDb21wb25lbnQgfSBmcm9tICdAZmFycmlzL2RldmtpdCc7XHJcbmltcG9ydCB7IEJzTW9kYWxTZXJ2aWNlLCBNb2RhbE9wdGlvbnMgfSBmcm9tICdAZmFycmlzL3VpLW1vZGFsJztcclxuXHJcbmltcG9ydCB7IEZvcm1TZXR0aW5ncyB9IGZyb20gJ0BlZHAtYWlmL2NvbW1vbi1hcGknO1xyXG5pbXBvcnQgeyBJUnRTbGltQmlsbENyZWF0aW9uUHJvY2Vzc0VudGl0eUV4IH0gZnJvbSBcIkBlZHAtYmlmL2NvbW1vbi1hcGlcIjtcclxuXHJcbmltcG9ydCB7IEJJRl9VSVNUQVRFX0tFWV9DUkVBVElPTl9SRVNVTFQgfSBmcm9tICcuLi9jb25maWcvYmlmLWZvcm0tY29uc3RhbnRzJztcclxuaW1wb3J0IHsgQWJzdHJhY3RVaVNlcnZpY2UgfSBmcm9tICcuL2Fic3RyYWN0LXVpLXNlcnZpY2UnO1xyXG5pbXBvcnQgeyBCaWZEYXRhU2VydmljZSB9IGZyb20gJy4vYmlmLWRhdGEuc2VydmljZSc7XHJcbmltcG9ydCB7IFB1bGxTZWxlY3RvckNvbXBvbmVudCB9IGZyb20gJy4uL2NvbXBvbmVudHMvcHVsbC1zZWxlY3Rvci9wdWxsLXNlbGVjdG9yLmNvbXBvbmVudCc7XHJcbmltcG9ydCB7IElCaWZEYXRhU2VsZWN0b3JDb21wb25lbnQgfSBmcm9tICcuLi9iYXNlL0lCaWZEYXRhU2VsZWN0b3JDb21wb25lbnQnO1xyXG5pbXBvcnQgeyBJQmlmRGF0YVNlbGVjdG9yTW9kdWxlIH0gZnJvbSAnLi4vYmFzZS9JQmlmRGF0YVNlbGVjdG9yTW9kdWxlJztcclxuaW1wb3J0IHsgRm9ybUdldEJpbGxDcmVhdGlvblByb2Nlc3NFbnRpdHlFeEFyZ3MgfSBmcm9tICcuLi8uLi9lbnRpdHkvZm9ybS1yZXN0L0Zvcm1HZXRCaWxsQ3JlYXRpb25Qcm9jZXNzRW50aXR5RXhBcmdzJztcclxuaW1wb3J0IHsgTWFudWFsQ3JlYXRpb25Nb2RlIH0gZnJvbSAnLi4vLi4vZW50aXR5L2Zvcm0tcmVzdC9NYW51YWxDcmVhdGlvbk1vZGUnO1xyXG5pbXBvcnQgeyBGb3JtQmlsbENyZWF0aW9uUHJvY2Vzc0V4ZWN1dG9yUmVzdWx0IH0gZnJvbSAnQGVkcC1haWYvcnVudGltZS1hcGknO1xyXG5pbXBvcnQgeyBNZXNzYWdlclNlcnZpY2UgfSBmcm9tICdAZmFycmlzL3VpLW1lc3NhZ2VyJztcclxuaW1wb3J0IHsgUnVudGltZUZyYW1ld29ya1NlcnZpY2UgfSBmcm9tICdAZmFycmlzL2NvbW1hbmQtc2VydmljZXMnO1xyXG5pbXBvcnQgeyBqdWRnZUJyb3dzZXJUeXBlIH0gZnJvbSAnLi4vLi4vdXRpbHMvQnJvd3NlclV0aWwnO1xyXG5pbXBvcnQgeyBUcmFuc2xhdGVMb2FkZXIsIFRyYW5zbGF0ZVNlcnZpY2UgfSBmcm9tIFwiQG5neC10cmFuc2xhdGUvY29yZVwiO1xyXG5pbXBvcnQgeyBBYnN0cmFjdEJpZkRhdGFTZWxlY3RvclNlcnZpY2UgfSBmcm9tICcuL2JpZi1kYXRhLXNlbGVjdG9yLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBjYW5KU09OUGFyc2UgfSBmcm9tICcuLi8uLi91dGlscy9PYmplY3RVdGlscyc7XHJcblxyXG5cclxuZGVjbGFyZSB2YXIgU3lzdGVtOiBhbnk7XHJcblxyXG5ASW5qZWN0YWJsZSgpXHJcbmV4cG9ydCBjbGFzcyBCaWZUYXJnZXRVaVNlcnZpY2UgZXh0ZW5kcyBBYnN0cmFjdFVpU2VydmljZSB7XHJcbiAgcHJpdmF0ZSByZWFkb25seSB1aVN0YXRlS2V5Q3JlYXRpb25SZXN1bHQ6IHN0cmluZyA9IEJJRl9VSVNUQVRFX0tFWV9DUkVBVElPTl9SRVNVTFQ7XHJcblxyXG4gIGNvbnN0cnVjdG9yKFxyXG4gICAgcHJvdGVjdGVkIGRhdGFTZXJ2aWNlOiBCaWZEYXRhU2VydmljZSxcclxuICAgIHByb3RlY3RlZCBmcmFtZUNvbnRleHQ6IEZyYW1lQ29udGV4dCxcclxuICAgIHByb3RlY3RlZCBtb2RhbFNlcnZpY2U6IEJzTW9kYWxTZXJ2aWNlLFxyXG4gICAgcHJvdGVjdGVkIG1lc3NhZ2VyOiBNZXNzYWdlclNlcnZpY2UsXHJcbiAgICBwcm90ZWN0ZWQgaW5qZWN0b3I6IEluamVjdG9yLFxyXG4gICAgcHJvdGVjdGVkIGNmcjogQ29tcG9uZW50RmFjdG9yeVJlc29sdmVyLFxyXG4gICAgcHJvdGVjdGVkIGxvYWRlcjogTmdNb2R1bGVGYWN0b3J5TG9hZGVyLFxyXG4gICAgQEluamVjdChMT0NBTEVfSUQpIHB1YmxpYyBsb2NhbGVJZDogc3RyaW5nLFxyXG4gICAgQE9wdGlvbmFsKCkgcnVudGltZUZyYW1ld29ya1NlcnZpY2U6IFJ1bnRpbWVGcmFtZXdvcmtTZXJ2aWNlLFxyXG4gICkge1xyXG4gICAgc3VwZXIoZnJhbWVDb250ZXh0LCBtb2RhbFNlcnZpY2UsIG1lc3NhZ2VyLCBpbmplY3RvciwgY2ZyLCBsb2FkZXIsIGxvY2FsZUlkLCBydW50aW1lRnJhbWV3b3JrU2VydmljZSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDlj4Lnhafml7bmiZPlvIDnlJ/ljZXop4TliJnpgInmi6nlmahcclxuICAgKi9cclxuICBwdWJsaWMgb3BlbkJpbGxDcmVhdGlvblByb2Nlc3NTZWxlY3RvcjRQdWxsKGRvd25Wb0lkOiBzdHJpbmcsIGJpekZsb3djaGFydElkPzogc3RyaW5nLCBtb2RhbE9wdGlvbnM/OiBNb2RhbE9wdGlvbnMsIGN1c3RvbVNlbGVjdG9yTW9kdWxlVXJsPzogc3RyaW5nLCBleHRQYXJhbXM/OiB7fSk6IE9ic2VydmFibGU8SVJ0U2xpbUJpbGxDcmVhdGlvblByb2Nlc3NFbnRpdHlFeD4ge1xyXG4gICAgY29uc3QgYXJncyA9IG5ldyBGb3JtR2V0QmlsbENyZWF0aW9uUHJvY2Vzc0VudGl0eUV4QXJncygpO1xyXG4gICAgYXJncy5kb3duQmlsbFZvSWQgPSBkb3duVm9JZDtcclxuICAgIGFyZ3MubWFudWFsQ3JlYXRpb25Nb2RlID0gTWFudWFsQ3JlYXRpb25Nb2RlLlB1bGw7XHJcbiAgICAvLyBhcmdzLmJpekZsb3djaGFydElkID0gYml6Rmxvd2NoYXJ0SWQ7XHJcblxyXG4gICAgcmV0dXJuIHRoaXMub3BlbkJpbGxDcmVhdGlvblByb2Nlc3NTZWxlY3RvcihhcmdzLCBQdWxsU2VsZWN0b3JDb21wb25lbnQsIG1vZGFsT3B0aW9ucywgY3VzdG9tU2VsZWN0b3JNb2R1bGVVcmwsIGV4dFBhcmFtcyk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDnibnlrprlj4Lnhafml7bmiZPlvIDnlJ/ljZXop4TliJnpgInmi6nlmahcclxuICAgKi9cclxuICBwdWJsaWMgb3BlbkJpbGxDcmVhdGlvblByb2Nlc3NTZWxlY3RvcjRTcGVjaWZpY1B1bGwodXBCaWxsVm9JZDogc3RyaW5nLCBkb3duVm9JZDogc3RyaW5nLCBiaXpGbG93Y2hhcnRJZD86IHN0cmluZywgbW9kYWxPcHRpb25zPzogTW9kYWxPcHRpb25zLCBjdXN0b21TZWxlY3Rvck1vZHVsZVVybD86IHN0cmluZywgZXh0UGFyYW1zPzoge30pOiBPYnNlcnZhYmxlPElSdFNsaW1CaWxsQ3JlYXRpb25Qcm9jZXNzRW50aXR5RXg+IHtcclxuICAgIGNvbnN0IGFyZ3MgPSBuZXcgRm9ybUdldEJpbGxDcmVhdGlvblByb2Nlc3NFbnRpdHlFeEFyZ3MoKTtcclxuICAgIGFyZ3MudXBCaWxsVm9JZCA9IHVwQmlsbFZvSWQ7XHJcbiAgICBhcmdzLmRvd25CaWxsVm9JZCA9IGRvd25Wb0lkO1xyXG4gICAgYXJncy5tYW51YWxDcmVhdGlvbk1vZGUgPSBNYW51YWxDcmVhdGlvbk1vZGUuU3BlY2lmaWNQdWxsO1xyXG4gICAgLy8gYXJncy5iaXpGbG93Y2hhcnRJZCA9IGJpekZsb3djaGFydElkO1xyXG5cclxuICAgIHJldHVybiB0aGlzLm9wZW5CaWxsQ3JlYXRpb25Qcm9jZXNzU2VsZWN0b3IoYXJncywgUHVsbFNlbGVjdG9yQ29tcG9uZW50LCBtb2RhbE9wdGlvbnMsIGN1c3RvbVNlbGVjdG9yTW9kdWxlVXJsLCBleHRQYXJhbXMpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5omT5byA5p2l5rqQ5Y2V5o2u6YCJ5oup5ZmoXHJcbiAgICogQHBhcmFtIGZvcm1TZXR0aW5nc1xyXG4gICAqIEBwYXJhbSBtb2RhbE9wdGlvbnNcclxuICAgKi9cclxuICBwdWJsaWMgb3BlblNvdXJjZURhdGFTZWxlY3RvcjRQdWxsKGZvcm1TZXR0aW5ncz86IEZvcm1TZXR0aW5ncywgbW9kYWxPcHRpb25zPzogTW9kYWxPcHRpb25zLCBleHRQYXJhbXM/OiB7IGJvb3RzdHJhcENvbXBvbmVudFNlbGVjdG9yPzogc3RyaW5nLCBba2V5OiBzdHJpbmddOiBhbnkgfSk6IE9ic2VydmFibGU8RW50aXR5W10+IHtcclxuICAgIG1vZGFsT3B0aW9ucyA9IG1vZGFsT3B0aW9ucyA9PSBudWxsID8gdGhpcy5kZWZhdWx0TW9kYWxPcHRpb25zIDogbW9kYWxPcHRpb25zO1xyXG4gICAgbW9kYWxPcHRpb25zLnRpdGxlID0gbW9kYWxPcHRpb25zLnRpdGxlID09IG51bGwgPyB0aGlzLmxvY2FsZVBpcGUudHJhbnNmb3JtKFwic291cmNlRGF0YVNlbGVjdG9yXCIpIDogbW9kYWxPcHRpb25zLnRpdGxlO1xyXG5cclxuICAgIGxldCBjbXBSOiBDb21wb25lbnRSZWY8SUJpZkRhdGFTZWxlY3RvckNvbXBvbmVudD4gPSBudWxsO1xyXG4gICAgaWYgKGZvcm1TZXR0aW5ncyA9PSBudWxsIHx8IGZvcm1TZXR0aW5ncy5zb3VyY2VEYXRhU2VsZWN0b3JNb2R1bGVVcmwgPT0gbnVsbCkgLy8g5rKh5pyJ6YWN572u5pe25Yqg6L296buY6K6k6YCa55So5Y2V5o2u6YCJ5oup5ZmoXHJcbiAgICB7XHJcbiAgICAgIHRoaXMubWVzc2FnZXIuZXJyb3IodGhpcy5sb2NhbGVQaXBlLmluc3RhbnQoXCJub0RlZmF1bHRVcEJpbGxTZWxlY3RvclwiKSk7XHJcbiAgICAgIHRocm93IFwi5pqC5peg6buY6K6k5a6e546w77yM6K+35L2/55So6Ieq5a6a5LmJ5p2l5rqQ5Y2V5o2u6YCJ5oup5Zmo44CC6K+356Gu5L+d55Sf5Y2V5rWB56iL5Lit44CQ6ZuG5oiQ5Zy65pmv44CR5ZCv55So5LqG44CQ5Lq65bel5ouJ5byP55Sf5Y2V44CR5Zy65pmv77yM5bm25LiU44CQ5Y2V5o2u6YWN572u44CRLeOAkOaLieW8j+eUn+WNlemFjee9ruOAkS3jgJDkuIrmuLjlupTnlKjlhaXlj6PjgJHmiJbjgJBVUkzjgJHkuI3kuLrnqbpcIjtcclxuICAgICAgLy8gbGV0IGNtcEY6IENvbXBvbmVudEZhY3Rvcnk8U291cmNlRGF0YVNlbGVjdG9yQ29tcG9uZW50PiA9IHRoaXMuY2ZyLnJlc29sdmVDb21wb25lbnRGYWN0b3J5KFNvdXJjZURhdGFTZWxlY3RvckNvbXBvbmVudCk7XHJcbiAgICAgIC8vIGxldCBpbmo6IEluamVjdG9yID0gSW5qZWN0b3IuY3JlYXRlKFtcclxuICAgICAgLy8gXSwgdGhpcy5pbmplY3Rvcik7XHJcbiAgICAgIC8vIGNtcFIgPSBjbXBGLmNyZWF0ZShpbmopO1xyXG4gICAgICAvLyB0aGlzLmNvbmZpZ01vZGFsQnV0dG9ucyhtb2RhbE9wdGlvbnMsIGNtcFIpO1xyXG5cclxuICAgICAgLy8gY21wUi5pbnN0YW5jZS5ic01vZGFsUmVmNEFpZlNlbGVjdG9yID0gdGhpcy5tb2RhbFNlcnZpY2Uuc2hvdyhjbXBSLCBtb2RhbE9wdGlvbnMpO1xyXG4gICAgICAvLyByZXR1cm4gY21wUi5pbnN0YW5jZS5zdWJqZWN0NEVudGl0eURhdGFzLmFzT2JzZXJ2YWJsZSgpO1xyXG4gICAgfVxyXG4gICAgZWxzZSAvL+WKoOi9veiHquWumuS5ieadpea6kOWNleaNrumAieaLqeWZqFxyXG4gICAge1xyXG4gICAgICAvLyByZXR1cm4gZnJvbShTeXN0ZW0uaW1wb3J0KGZvcm1TZXR0aW5ncy5zb3VyY2VEYXRhU2VsZWN0b3JNb2R1bGVVcmwuc3Vic3RyaW5nKDAsIGZvcm1TZXR0aW5ncy5zb3VyY2VEYXRhU2VsZWN0b3JNb2R1bGVVcmwuaW5kZXhPZihcIiNcIikpICsgXCIuanNcIikpLnBpcGUoXHJcbiAgICAgIGxldCBtb2R1bGVGJCA9IG51bGw7XHJcbiAgICAgIGlmIChmb3JtU2V0dGluZ3Muc291cmNlRGF0YVNlbGVjdG9yQXBwSWQgIT0gbnVsbCkgLy/phY3nva5hcHBJZOaXtlxyXG4gICAgICB7XHJcbiAgICAgICAgbW9kdWxlRiQgPSBmcm9tKFN5c3RlbS5pbXBvcnQoZm9ybVNldHRpbmdzLnNvdXJjZURhdGFTZWxlY3Rvck1vZHVsZVVybC50b0xvd2VyQ2FzZSgpKS50aGVuKG0gPT4gbSkpLnBpcGUoXHJcbiAgICAgICAgICBzd2l0Y2hNYXAoXHJcbiAgICAgICAgICAgIChtOiB7IFtrZXk6IHN0cmluZ106IE5nTW9kdWxlRmFjdG9yeTxJQmlmRGF0YVNlbGVjdG9yTW9kdWxlPiB9KSA9PiB7XHJcbiAgICAgICAgICAgICAgZm9yIChsZXQga2V5IGluIG0pIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBvZihtW2tleV0pO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICByZXR1cm4gb2YobnVsbCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIClcclxuICAgICAgICApO1xyXG4gICAgICB9XHJcbiAgICAgIGVsc2UgLy/lj6rphY3nva51cmzml7ZcclxuICAgICAge1xyXG4gICAgICAgIG1vZHVsZUYkID0gZnJvbSh0aGlzLmxvYWRlci5sb2FkKGZvcm1TZXR0aW5ncy5zb3VyY2VEYXRhU2VsZWN0b3JNb2R1bGVVcmwpKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgcmV0dXJuIG1vZHVsZUYkLnBpcGUoXHJcbiAgICAgICAgc3dpdGNoTWFwKFxyXG4gICAgICAgICAgKG1vZHVsZUZhY3Rvcnk6IE5nTW9kdWxlRmFjdG9yeTxJQmlmRGF0YVNlbGVjdG9yTW9kdWxlPikgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBtb2R1bGVSZWYgPSBtb2R1bGVGYWN0b3J5LmNyZWF0ZSh0aGlzLmZyYW1lQ29udGV4dC5yb290LmluamVjdG9yKTtcclxuICAgICAgICAgICAgaWYgKG1vZHVsZVJlZi5pbnN0YW5jZS5jcmVhdGVTb3VyY2VEYXRhU2VsZWN0b3IgJiYgbW9kdWxlUmVmLmluc3RhbmNlLmNyZWF0ZVNvdXJjZURhdGFTZWxlY3RvciBpbnN0YW5jZW9mIEZ1bmN0aW9uKS8vbW9kdWxl5LiK5a6a5LmJY3JlYXRlU291cmNlRGF0YVNlbGVjdG9y5pa55rOVXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICBjb25zdCBjbXBSJCA9IG1vZHVsZVJlZi5pbnN0YW5jZS5jcmVhdGVTb3VyY2VEYXRhU2VsZWN0b3IodGhpcy5mcmFtZUNvbnRleHQucm9vdC5pbmplY3RvciwgbnVsbCwgZXh0UGFyYW1zKTtcclxuICAgICAgICAgICAgICBpZiAoY21wUiQgaW5zdGFuY2VvZiBPYnNlcnZhYmxlKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gY21wUiQucGlwZShcclxuICAgICAgICAgICAgICAgICAgc3dpdGNoTWFwKFxyXG4gICAgICAgICAgICAgICAgICAgIChjb21wb25lbnRSZWYpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgIGNtcFIgPSBjb21wb25lbnRSZWY7XHJcbiAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbmZpZ01vZGFsQnV0dG9ucyhtb2RhbE9wdGlvbnMsIGNtcFIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgY21wUi5pbnN0YW5jZS5ic01vZGFsUmVmNEJpZlNlbGVjdG9yID0gdGhpcy5tb2RhbFNlcnZpY2Uuc2hvdyhjbXBSLCBtb2RhbE9wdGlvbnMpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNtcFIuaW5zdGFuY2Uuc3ViamVjdDRFbnRpdHlEYXRhcy5hc09ic2VydmFibGUoKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgIClcclxuICAgICAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgICAgfSBlbHNlIGlmIChjbXBSJCBpbnN0YW5jZW9mIENvbXBvbmVudFJlZikge1xyXG4gICAgICAgICAgICAgICAgY21wUiA9IGNtcFIkO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jb25maWdNb2RhbEJ1dHRvbnMobW9kYWxPcHRpb25zLCBjbXBSKTtcclxuICAgICAgICAgICAgICAgIGNtcFIuaW5zdGFuY2UuYnNNb2RhbFJlZjRCaWZTZWxlY3RvciA9IHRoaXMubW9kYWxTZXJ2aWNlLnNob3coY21wUiwgbW9kYWxPcHRpb25zKTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBjbXBSLmluc3RhbmNlLnN1YmplY3Q0RW50aXR5RGF0YXMuYXNPYnNlcnZhYmxlKCk7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2UgLy9tb2R1bGXkuIrmnKrlrprkuYnml7blsJ3or5Xlr7vmib5Sb290Q29tcG9uZW5057G7XHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICBjb25zdCB0cmFuc2xhdGU6IFRyYW5zbGF0ZVNlcnZpY2UgPSBtb2R1bGVSZWYuaW5qZWN0b3IuZ2V0KFRyYW5zbGF0ZVNlcnZpY2UpO1xyXG4gICAgICAgICAgICAgIHJldHVybiB0cmFuc2xhdGUuZ2V0VHJhbnNsYXRpb24odGhpcy5sb2NhbGVJZCkucGlwZShcclxuICAgICAgICAgICAgICAgIHN3aXRjaE1hcChcclxuICAgICAgICAgICAgICAgICAgKGRhdGEpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICB0cmFuc2xhdGUuc2V0VHJhbnNsYXRpb24odGhpcy5sb2NhbGVJZCwgZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgdHJhbnNsYXRlLmRlZmF1bHRMYW5nID0gdGhpcy5sb2NhbGVJZDtcclxuICAgICAgICAgICAgICAgICAgICB0cmFuc2xhdGUuY3VycmVudExhbmcgPSB0aGlzLmxvY2FsZUlkO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmdldEVudGl0eURhdGEobW9kdWxlUmVmLCBmb3JtU2V0dGluZ3MsIG1vZGFsT3B0aW9ucywgZXh0UGFyYW1zKTtcclxuICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgKSxcclxuICAgICAgICAgICAgICAgIGNhdGNoRXJyb3IoXHJcbiAgICAgICAgICAgICAgICAgIChlcnIpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGVycik7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0RW50aXR5RGF0YShtb2R1bGVSZWYsIGZvcm1TZXR0aW5ncywgbW9kYWxPcHRpb25zLCBleHRQYXJhbXMpO1xyXG4gICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICApXHJcbiAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgIH1cclxuICAgICAgICApXHJcbiAgICAgICk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBARGVwcmVjYXRlZCDlt7LlvIPnlKjvvIzor7fkvb/nlKh7QGxpbmsgZ2V0Q3JlYXRpb25SZXN1bHR9XHJcbiAgICog6I635Y+W5Lyg5Yiw5qC557uE5Lu2VUlTdGF0ZeS4iueahOeUn+WNleinhOWImeaJp+ihjOWZqOe7k+aenFxyXG4gICAqL1xyXG4gIHB1YmxpYyBnZXRGb3JtQmlsbENyZWF0aW9uUHJvY2Vzc0V4ZWN1dG9yUmVzdWx0KCk6IEZvcm1CaWxsQ3JlYXRpb25Qcm9jZXNzRXhlY3V0b3JSZXN1bHQge1xyXG4gICAgLy/lj5blvpd0YWJJZOS4ultBcHBJZF1fW0FwcEVudHJhbmNlXV9bdGFiSWRdXHJcbiAgICBsZXQgdGFiSWQ6IHN0cmluZyA9IHRoaXMucnVudGltZUZyYW1ld29ya1NlcnZpY2UudGFiSWQgfHwgdGhpcy5nZXRRdWVyeVN0cmluZyhcInRhYklkXCIpIHx8IFwiXCI7XHJcbiAgICBsZXQgZGF0YUlkID0gdGFiSWQuc3Vic3RyKHRhYklkLmxlbmd0aCAtIDM2KVxyXG4gICAgLy8gY29uc29sZS5sb2codGFiSWQpO1xyXG4gICAgLy8gY29uc29sZS5sb2coZGF0YUlkKTtcclxuICAgIGNvbnN0IGJyb3dzZXIgPSBqdWRnZUJyb3dzZXJUeXBlKCk7XHJcblxyXG4gICAgLy9JRTEx5rWP6KeI5Zmo5LuObG9jYWxTdG9yYWdl5Y+W5YC85ZCO5bm25Yig6ZmkLCDlubblrZjlhaVVSVN0YXRlXHJcbiAgICBpZiAoYnJvd3Nlci50eXBlID09IFwiSUVcIiAmJiBicm93c2VyLklFVmVyc2lvbiA9PSBcIklFMTFcIikge1xyXG4gICAgICBjb25zdCB0bXAgPSB3aW5kb3cudG9wLmxvY2FsU3RvcmFnZS5nZXRJdGVtKGRhdGFJZCk7XHJcbiAgICAgIHdpbmRvdy50b3AubG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oZGF0YUlkKTtcclxuICAgICAgdGhpcy5mcmFtZUNvbnRleHQucm9vdC51aVN0YXRlLnNldFByb3BlcnR5VmFsdWUodGhpcy51aVN0YXRlS2V5Q3JlYXRpb25SZXN1bHQsIHRtcCk7XHJcbiAgICB9XHJcblxyXG4gICAgbGV0IHJlc1RlbXAgPSB0aGlzLmZyYW1lQ29udGV4dC5yb290LnVpU3RhdGVbdGhpcy51aVN0YXRlS2V5Q3JlYXRpb25SZXN1bHRdO1xyXG4gICAgaWYgKHJlc1RlbXAgPT0gbnVsbCkge1xyXG4gICAgICB0aHJvdyBcIkZvcm1CaWxsQ3JlYXRpb25Qcm9jZXNzRXhlY3V0b3JSZXN1bHQgaXMgbnVsbFwiO1xyXG4gICAgfVxyXG4gICAgY29uc3QgcmVzdWx0ID0gbmV3IEZvcm1CaWxsQ3JlYXRpb25Qcm9jZXNzRXhlY3V0b3JSZXN1bHQoKTtcclxuICAgIGlmICh0eXBlb2YgcmVzVGVtcCA9PSBcInN0cmluZ1wiKSB7XHJcbiAgICAgIHJlc3VsdC5Mb2FkRnJvbUpzb24ocmVzVGVtcCk7XHJcbiAgICB9IGVsc2UgaWYgKHR5cGVvZiByZXNUZW1wID09IFwib2JqZWN0XCIpIHtcclxuICAgICAgcmVzdWx0LkxvYWRGcm9tSnNvbk9iamVjdChyZXNUZW1wKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRocm93IFwi5LiN5ZCI5rOV55qE57G75Z6LXCI7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gcmVzdWx0O1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGdldFF1ZXJ5U3RyaW5nKG5hbWUpIHtcclxuICAgIGxldCByZWcgPSBuZXcgUmVnRXhwKFwiKF58JilcIiArIG5hbWUgKyBcIj0oW14mXSopKCZ8JClcIiwgXCJpXCIpO1xyXG4gICAgbGV0IHIgPSB3aW5kb3cubG9jYXRpb24uc2VhcmNoLnN1YnN0cigxKS5tYXRjaChyZWcpO1xyXG4gICAgaWYgKHIgIT0gbnVsbCkge1xyXG4gICAgICByZXR1cm4gdW5lc2NhcGUoclsyXSk7XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIG51bGw7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDojrflj5bkvKDliLDmoLnnu4Tku7ZVSVN0YXRl5LiK55qE55Sf5Y2V6KeE5YiZ5omn6KGM5Zmo57uT5p6cXHJcbiAgICovXHJcbiAgcHVibGljIGdldENyZWF0aW9uUmVzdWx0KCk6IE9ic2VydmFibGU8Rm9ybUJpbGxDcmVhdGlvblByb2Nlc3NFeGVjdXRvclJlc3VsdD4ge1xyXG4gICAgLy/lj5blvpd0YWJJZOS4ultBcHBJZF1fW0FwcEVudHJhbmNlXV9bdGFiSWRdXHJcbiAgICBsZXQgdGFiSWQ6IHN0cmluZyA9IHRoaXMucnVudGltZUZyYW1ld29ya1NlcnZpY2UudGFiSWQgfHwgdGhpcy5nZXRRdWVyeVN0cmluZyhcInRhYklkXCIpIHx8IFwiXCI7XHJcbiAgICBsZXQgZGF0YUlkID0gdGFiSWQuc3Vic3RyKHRhYklkLmxlbmd0aCAtIDM2KVxyXG4gICAgLy8gY29uc29sZS5sb2codGFiSWQpO1xyXG4gICAgLy8gY29uc29sZS5sb2coZGF0YUlkKTtcclxuICAgIGNvbnN0IGJyb3dzZXIgPSBqdWRnZUJyb3dzZXJUeXBlKCk7XHJcblxyXG4gICAgLy9JRTEx5rWP6KeI5Zmo5LuObG9jYWxTdG9yYWdl5Y+W5YC85ZCO5bm25Yig6ZmkLCDlubblrZjlhaVVSVN0YXRlXHJcbiAgICBpZiAoYnJvd3Nlci50eXBlID09IFwiSUVcIiAmJiBicm93c2VyLklFVmVyc2lvbiA9PSBcIklFMTFcIikge1xyXG4gICAgICBjb25zdCB0bXAgPSB3aW5kb3cudG9wLmxvY2FsU3RvcmFnZS5nZXRJdGVtKGRhdGFJZCk7XHJcbiAgICAgIHdpbmRvdy50b3AubG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oZGF0YUlkKTtcclxuICAgICAgdGhpcy5mcmFtZUNvbnRleHQucm9vdC51aVN0YXRlLnNldFByb3BlcnR5VmFsdWUodGhpcy51aVN0YXRlS2V5Q3JlYXRpb25SZXN1bHQsIHRtcCk7XHJcbiAgICB9XHJcblxyXG4gICAgbGV0IHJlc1RlbXAgPSB0aGlzLmZyYW1lQ29udGV4dC5yb290LnVpU3RhdGVbdGhpcy51aVN0YXRlS2V5Q3JlYXRpb25SZXN1bHRdO1xyXG4gICAgaWYgKHJlc1RlbXAgPT0gbnVsbCkge1xyXG4gICAgICB0aHJvdyBcIkZvcm1CaWxsQ3JlYXRpb25Qcm9jZXNzRXhlY3V0b3JSZXN1bHQgaXMgbnVsbFwiO1xyXG4gICAgfVxyXG4gICAgY29uc3QgcmVzdWx0ID0gbmV3IEZvcm1CaWxsQ3JlYXRpb25Qcm9jZXNzRXhlY3V0b3JSZXN1bHQoKTtcclxuICAgIGlmICh0eXBlb2YgcmVzVGVtcCA9PSBcInN0cmluZ1wiKSB7XHJcbiAgICAgIC8vIOWFvOWuueWOn+ebtOaOpeS8oOmAkueUn+WNleaVsOaNruWcuuaZr1xyXG4gICAgICBpZiAoY2FuSlNPTlBhcnNlKHJlc1RlbXApKSB7XHJcbiAgICAgICAgcmVzdWx0LkxvYWRGcm9tSnNvbihyZXNUZW1wKTtcclxuICAgICAgICByZXR1cm4gb2YocmVzdWx0KTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBjb25zdCByZXN1bHRUZXh0SWQgPSByZXNUZW1wO1xyXG4gICAgICAgIHJldHVybiB0aGlzLmRhdGFTZXJ2aWNlLmdldENyZWF0aW9uUmVzdWx0QnlJZChyZXN1bHRUZXh0SWQpO1xyXG4gICAgICB9XHJcbiAgICB9IGVsc2UgaWYgKHR5cGVvZiByZXNUZW1wID09IFwib2JqZWN0XCIpIHtcclxuICAgICAgcmVzdWx0LkxvYWRGcm9tSnNvbk9iamVjdChyZXNUZW1wKTtcclxuICAgICAgcmV0dXJuIG9mKHJlc3VsdCk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aHJvdyBcIuS4jeWQiOazleeahOexu+Wei1wiO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog6YWN572u5qih5oCB5qGG5oyJ6ZKu5LqL5Lu2XHJcbiAgICogQHBhcmFtIG1vZGFsT3B0aW9uc1xyXG4gICAqIEBwYXJhbSBjbXBSXHJcbiAgICovXHJcbiAgcHJvdGVjdGVkIGNvbmZpZ01vZGFsQnV0dG9uc0J5U2VydmljZShtb2RhbE9wdGlvbnM6IE1vZGFsT3B0aW9ucywgc2VydmljZTogQWJzdHJhY3RCaWZEYXRhU2VsZWN0b3JTZXJ2aWNlKSB7XHJcbiAgICBtb2RhbE9wdGlvbnMuYnV0dG9ucyA9IFtcclxuICAgICAge1xyXG4gICAgICAgIHRleHQ6IHRoaXMubG9jYWxlUGlwZS50cmFuc2Zvcm0oXCJjb25maXJtXCIpLFxyXG4gICAgICAgIGNsczogXCJidG4gYnRuLXByaW1hcnlcIixcclxuICAgICAgICBoYW5kbGU6IHNlcnZpY2UuY2xpY2tPazRCaWZTZWxlY3RvcixcclxuICAgICAgfSxcclxuICAgICAge1xyXG4gICAgICAgIHRleHQ6IHRoaXMubG9jYWxlUGlwZS50cmFuc2Zvcm0oXCJjYW5jZWxcIiksXHJcbiAgICAgICAgY2xzOiBcImJ0biBidG4tc2Vjb25kYXJ5XCIsXHJcbiAgICAgICAgaGFuZGxlOiBzZXJ2aWNlLmNsaWNrQ2xvc2U0QmlmU2VsZWN0b3IsXHJcbiAgICAgIH1cclxuICAgIF07XHJcbiAgICBtb2RhbE9wdGlvbnMuc2hvd0J1dHRvbnMgPSB0cnVlO1xyXG4gIH1cclxuXHJcbiAgcHJvdGVjdGVkIGdldEVudGl0eURhdGEobW9kdWxlUmVmOiBOZ01vZHVsZVJlZjxhbnk+LCBmb3JtU2V0dGluZ3M/OiBGb3JtU2V0dGluZ3MsIG1vZGFsT3B0aW9ucz86IE1vZGFsT3B0aW9ucywgZXh0UGFyYW1zPzogeyBib290c3RyYXBDb21wb25lbnRTZWxlY3Rvcj86IHN0cmluZywgbG9hZENvbW1hbmQ/OiBzdHJpbmcsIGxvYWRQYXJhbXM/OiBhbnksIFtrZXk6IHN0cmluZ106IGFueSB9KTogT2JzZXJ2YWJsZTxFbnRpdHlbXT4ge1xyXG4gICAgbGV0IGNtcEY6IENvbXBvbmVudEZhY3Rvcnk8SUJpZkRhdGFTZWxlY3RvckNvbXBvbmVudCAmIEZyYW1lQ29tcG9uZW50PiA9IG51bGw7XHJcbiAgICBsZXQgY21wUjogQ29tcG9uZW50UmVmPElCaWZEYXRhU2VsZWN0b3JDb21wb25lbnQgJiBGcmFtZUNvbXBvbmVudD4gPSBudWxsO1xyXG4gICAgbGV0IGJvb3RzdHJhcENvbXBvbmVudFNlbGVjdG9yID0gXCJhcHAtcm9vdGNvbXBvbmVudFwiO1xyXG4gICAgbGV0IGJvb3RzdHJhcENvbXBvbmVudCA9IG51bGw7XHJcbiAgICBsZXQgZmFjTWFwOiBNYXA8YW55LCBhbnk+ID0gbW9kdWxlUmVmLmNvbXBvbmVudEZhY3RvcnlSZXNvbHZlclsnX2ZhY3RvcmllcyddO1xyXG4gICAgbGV0IHN1YmplY3Q0RW50aXR5RGF0YXM6IE9ic2VydmFibGU8RW50aXR5W10+ID0gbnVsbDtcclxuICAgIGlmIChleHRQYXJhbXMgJiYgZXh0UGFyYW1zLmJvb3RzdHJhcENvbXBvbmVudFNlbGVjdG9yKS8v5oyH5a6a5LqG5qC557uE5Lu2c2VsZWN0b3JcclxuICAgIHtcclxuICAgICAgYm9vdHN0cmFwQ29tcG9uZW50U2VsZWN0b3IgPSBleHRQYXJhbXMuYm9vdHN0cmFwQ29tcG9uZW50U2VsZWN0b3I7XHJcblxyXG4gICAgICBmYWNNYXAuZm9yRWFjaCgodmFsdWU6IGFueSwga2V5OiBGdW5jdGlvbiwgbWFwOiBNYXA8YW55LCBhbnk+KSA9PiB7XHJcbiAgICAgICAgY29uc3Qgc2VsZWN0b3IgPSB2YWx1ZS5zZWxlY3RvcjtcclxuICAgICAgICBpZiAoYm9vdHN0cmFwQ29tcG9uZW50U2VsZWN0b3IgPT0gc2VsZWN0b3IpIHtcclxuICAgICAgICAgIGNtcEYgPSBtb2R1bGVSZWYuY29tcG9uZW50RmFjdG9yeVJlc29sdmVyLnJlc29sdmVDb21wb25lbnRGYWN0b3J5KGtleSBhcyBhbnkpO1xyXG4gICAgICAgICAgY21wUiA9IGNtcEYuY3JlYXRlKG1vZHVsZVJlZi5pbmplY3Rvcik7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgIH1cclxuICAgIGVsc2UgLy/mnKrmjIflrprmoLnnu4Tku7ZzZWxlY3RvclxyXG4gICAge1xyXG4gICAgICBib290c3RyYXBDb21wb25lbnQgPSBtb2R1bGVSZWZbJ19ib290c3RyYXBDb21wb25lbnRzJ11bMF07XHJcblxyXG4gICAgICBpZiAoYm9vdHN0cmFwQ29tcG9uZW50KS8v5YWI5om+Ym9vdHN0cmFwQ29tcG9uZW505pWw57uE5pyJ5peg57uE5Lu2XHJcbiAgICAgIHtcclxuICAgICAgICBjbXBGID0gbW9kdWxlUmVmLmNvbXBvbmVudEZhY3RvcnlSZXNvbHZlci5yZXNvbHZlQ29tcG9uZW50RmFjdG9yeShib290c3RyYXBDb21wb25lbnQpO1xyXG4gICAgICAgIGNtcFIgPSBjbXBGLmNyZWF0ZShtb2R1bGVSZWYuaW5qZWN0b3IpIGFzIGFueTtcclxuICAgICAgfVxyXG4gICAgICBlbHNlLy/msqHmnInliJnku45mYWNNYXDkuK3mn6Xmib7pu5jorqTnmoRhcHAtcm9vdGNvbXBvbmVudFxyXG4gICAgICB7XHJcbiAgICAgICAgZmFjTWFwLmZvckVhY2goKHZhbHVlOiBhbnksIGtleTogRnVuY3Rpb24sIG1hcDogTWFwPGFueSwgYW55PikgPT4ge1xyXG4gICAgICAgICAgY29uc3Qgc2VsZWN0b3IgPSB2YWx1ZS5zZWxlY3RvcjtcclxuICAgICAgICAgIGlmIChib290c3RyYXBDb21wb25lbnRTZWxlY3RvciA9PSBzZWxlY3Rvcikge1xyXG4gICAgICAgICAgICBjbXBGID0gbW9kdWxlUmVmLmNvbXBvbmVudEZhY3RvcnlSZXNvbHZlci5yZXNvbHZlQ29tcG9uZW50RmFjdG9yeShrZXkgYXMgYW55KTtcclxuICAgICAgICAgICAgY21wUiA9IGNtcEYuY3JlYXRlKG1vZHVsZVJlZi5pbmplY3Rvcik7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIGlmIChjbXBSICYmIGNtcFIuaW5zdGFuY2UgJiYgY21wUi5pbnN0YW5jZS52aWV3TW9kZWwgJiYgY21wUi5pbnN0YW5jZS52aWV3TW9kZWwudWlTdGF0ZSkge1xyXG4gICAgICBjbXBSLmluc3RhbmNlLnZpZXdNb2RlbC51aVN0YXRlLnNldFByb3BlcnR5VmFsdWUoXCJhY3Rpb25cIiwgXCJMb2FkMVwiKTtcclxuICAgICAgY21wUi5pbnN0YW5jZS52aWV3TW9kZWwudWlTdGF0ZS5zZXRQcm9wZXJ0eVZhbHVlKCdERVZLSVRfRElBTE9HJywgdHJ1ZSk7XHJcbiAgICB9XHJcbiAgICBjb25zdCBkYXRhU2VsZWN0b3JTZXJ2aWNlOiBBYnN0cmFjdEJpZkRhdGFTZWxlY3RvclNlcnZpY2UgPSBjbXBSLmluamVjdG9yLmdldChBYnN0cmFjdEJpZkRhdGFTZWxlY3RvclNlcnZpY2UsIG51bGwpO1xyXG4gICAgaWYgKGRhdGFTZWxlY3RvclNlcnZpY2UgIT0gbnVsbCkgLy8g5pyJQWJzdHJhY3RCaWZEYXRhU2VsZWN0b3JTZXJ2aWNl55qEcHJvdmlkZXLml7ZcclxuICAgIHtcclxuICAgICAgdGhpcy5jb25maWdNb2RhbEJ1dHRvbnNCeVNlcnZpY2UobW9kYWxPcHRpb25zLCBkYXRhU2VsZWN0b3JTZXJ2aWNlKTtcclxuICAgICAgZGF0YVNlbGVjdG9yU2VydmljZS5ic01vZGFsUmVmNEJpZlNlbGVjdG9yID0gdGhpcy5tb2RhbFNlcnZpY2Uuc2hvdyhjbXBSLCBtb2RhbE9wdGlvbnMpO1xyXG4gICAgICBzdWJqZWN0NEVudGl0eURhdGFzID0gZGF0YVNlbGVjdG9yU2VydmljZS5zdWJqZWN0NEVudGl0eURhdGFzLmFzT2JzZXJ2YWJsZSgpO1xyXG4gICAgfVxyXG4gICAgZWxzZSAvL+ayoeacieWImeS7jue7hOS7tuS4iuWvu+aJvuebuOW6lOWxnuaAp1xyXG4gICAge1xyXG4gICAgICB0aGlzLmNvbmZpZ01vZGFsQnV0dG9ucyhtb2RhbE9wdGlvbnMsIGNtcFIpO1xyXG4gICAgICBjbXBSLmluc3RhbmNlLmJzTW9kYWxSZWY0QmlmU2VsZWN0b3IgPSB0aGlzLm1vZGFsU2VydmljZS5zaG93KGNtcFIsIG1vZGFsT3B0aW9ucyk7XHJcbiAgICAgIHN1YmplY3Q0RW50aXR5RGF0YXMgPSBjbXBSLmluc3RhbmNlLnN1YmplY3Q0RW50aXR5RGF0YXMuYXNPYnNlcnZhYmxlKCk7XHJcbiAgICB9XHJcbiAgICAvLyDmraTlpITnlKjkuo7op6PlhrPku7vliqHkuK3lv4Pnm7TmjqXmiZPlvIDmnaXmupDljZXmja7luK7liqnml7bkuI3miafooYzliJ3lp4vljJbliqDovb3lkb3ku6TnmoTpl67pophcclxuICAgIGlmIChjbXBSICYmIGNtcFIuaW5zdGFuY2UgJiYgY21wUi5pbnN0YW5jZS52aWV3TW9kZWwpIHtcclxuICAgICAgaWYgKGV4dFBhcmFtcyAmJiBleHRQYXJhbXMubG9hZENvbW1hbmQpIHtcclxuICAgICAgICBjb25zdCBsb2FkQ29tbWFuZCA9IGV4dFBhcmFtcy5sb2FkQ29tbWFuZDtcclxuICAgICAgICBjb25zdCBjbWRGdW5jOiBGdW5jdGlvbiA9IGNtcFIuaW5zdGFuY2Uudmlld01vZGVsW2xvYWRDb21tYW5kXTtcclxuICAgICAgICBpZiAoY21kRnVuYykge1xyXG4gICAgICAgICAgbGV0IGFyZ3MgPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgICBpZiAoZXh0UGFyYW1zICYmIGV4dFBhcmFtcy5sb2FkUGFyYW1zKSB7XHJcbiAgICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KGV4dFBhcmFtcy5sb2FkUGFyYW1zKSkge1xyXG4gICAgICAgICAgICAgIGFyZ3MgPSBleHRQYXJhbXMubG9hZFBhcmFtcztcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICBhcmdzID0gW2V4dFBhcmFtcy5sb2FkUGFyYW1zXTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgY21kRnVuYy5hcHBseShjbXBSLmluc3RhbmNlLnZpZXdNb2RlbCwgYXJncyk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gc3ViamVjdDRFbnRpdHlEYXRhcztcclxuICB9XHJcbn1cclxuIl19
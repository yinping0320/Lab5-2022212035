/**
 * @fileoverview added by tsickle
 * Generated from: lib/bif-manual-creation/service/abstract-ui-service.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Injector, ComponentFactoryResolver, NgModuleFactoryLoader, Inject, LOCALE_ID, ComponentRef, ReflectiveInjector, Optional } from '@angular/core';
import { Observable, from } from 'rxjs';
import { switchMap } from 'rxjs/operators';
import { FrameContext } from '@farris/devkit';
import { BsModalService } from '@farris/ui-modal';
import { LocalePipe } from '../pipe/locale.pipe';
import { SELECTOR_ARGS_INJECTOR } from '../config/selector-args-injector.config';
import { MessagerService } from '@farris/ui-messager';
import { LoadingService } from '@farris/ui-loading';
import { RuntimeFrameworkService } from '@farris/command-services';
/**
 * @abstract
 */
export class AbstractUiService {
    /**
     * @param {?} frameContext
     * @param {?} modalService
     * @param {?} messager
     * @param {?} injector
     * @param {?} cfr
     * @param {?} loader
     * @param {?} localeId
     * @param {?} runtimeFrameworkService
     */
    constructor(frameContext, modalService, messager, injector, cfr, loader, localeId, runtimeFrameworkService) {
        this.frameContext = frameContext;
        this.modalService = modalService;
        this.messager = messager;
        this.injector = injector;
        this.cfr = cfr;
        this.loader = loader;
        this.localeId = localeId;
        /**
         * 内置模态框配置
         */
        this.defaultModalOptions = {
            title: null,
            width: 900,
            height: 500,
            buttons: null,
            showButtons: null,
        };
        this.runtimeFrameworkService = runtimeFrameworkService || injector.get(RuntimeFrameworkService);
        this.localePipe = new LocalePipe(localeId);
    }
    /**
     * @protected
     * @param {?} args
     * @param {?} type
     * @param {?=} modalOptions
     * @param {?=} customSelectorModuleUrl
     * @param {?=} extParams
     * @return {?}
     */
    openBillCreationProcessSelector(args, type, modalOptions, customSelectorModuleUrl, extParams) {
        if (typeof modalOptions == "string") {
            if (modalOptions == "") {
                throw "modalOptions不可为空";
            }
            modalOptions = JSON.parse(modalOptions);
        }
        modalOptions = modalOptions == null ? this.defaultModalOptions : modalOptions;
        modalOptions.title = modalOptions.title == null ? this.localePipe.transform("creationProcessSelector") : modalOptions.title;
        /** @type {?} */
        let cmpR = null;
        if (customSelectorModuleUrl == null || customSelectorModuleUrl.trim() == "") {
            /** @type {?} */
            let cmpF = this.cfr.resolveComponentFactory(type);
            /** @type {?} */
            let inj = ReflectiveInjector.resolveAndCreate([
                { provide: SELECTOR_ARGS_INJECTOR, useValue: args.ConvertToJsonObject() },
                LoadingService,
            ], this.injector);
            cmpR = cmpF.create(inj);
            this.configModalButtons(modalOptions, cmpR);
            cmpR.instance.bsModalRef4BifSelector = this.modalService.show(cmpR, modalOptions);
            return cmpR.instance.subject4CreationProcess.asObservable();
        }
        else {
            return from(this.loader.load(customSelectorModuleUrl)).pipe(switchMap((/**
             * @param {?} moduleFactory
             * @return {?}
             */
            (moduleFactory) => {
                /** @type {?} */
                const moduleRef = moduleFactory.create(this.frameContext.root.injector);
                /** @type {?} */
                const cmpR$ = moduleRef.instance.createCreationProcessSelector(this.frameContext.root.injector, extParams);
                if (cmpR$ instanceof Observable) {
                    return cmpR$.pipe(switchMap((/**
                     * @param {?} componentRef
                     * @return {?}
                     */
                    (componentRef) => {
                        cmpR = componentRef;
                        this.configModalButtons(modalOptions, cmpR);
                        cmpR.instance.bsModalRef4BifSelector = this.modalService.show(cmpR, modalOptions);
                        return cmpR.instance.subject4CreationProcess.asObservable();
                    })));
                }
                else if (cmpR$ instanceof ComponentRef) {
                    cmpR = cmpR$;
                    this.configModalButtons(modalOptions, cmpR);
                    cmpR.instance.bsModalRef4BifSelector = this.modalService.show(cmpR, modalOptions);
                    return cmpR.instance.subject4CreationProcess.asObservable();
                }
            })));
        }
    }
    /**
     * 配置模态框按钮事件
     * @protected
     * @param {?} modalOptions
     * @param {?} cmpR
     * @return {?}
     */
    configModalButtons(modalOptions, cmpR) {
        modalOptions.buttons = [
            {
                text: this.localePipe.transform("confirm"),
                cls: "btn btn-primary",
                handle: cmpR.instance.clickOk4BifSelector,
            },
            {
                text: this.localePipe.transform("cancel"),
                cls: "btn btn-secondary",
                handle: cmpR.instance.clickClose4BifSelector,
            }
        ];
        modalOptions.showButtons = true;
    }
}
/** @nocollapse */
AbstractUiService.ctorParameters = () => [
    { type: FrameContext },
    { type: BsModalService },
    { type: MessagerService },
    { type: Injector },
    { type: ComponentFactoryResolver },
    { type: NgModuleFactoryLoader },
    { type: String, decorators: [{ type: Inject, args: [LOCALE_ID,] }] },
    { type: RuntimeFrameworkService, decorators: [{ type: Optional }] }
];
if (false) {
    /**
     * 内置模态框配置
     * @type {?}
     * @protected
     */
    AbstractUiService.prototype.defaultModalOptions;
    /**
     * @type {?}
     * @protected
     */
    AbstractUiService.prototype.localePipe;
    /**
     * @type {?}
     * @protected
     */
    AbstractUiService.prototype.runtimeFrameworkService;
    /**
     * @type {?}
     * @protected
     */
    AbstractUiService.prototype.frameContext;
    /**
     * @type {?}
     * @protected
     */
    AbstractUiService.prototype.modalService;
    /**
     * @type {?}
     * @protected
     */
    AbstractUiService.prototype.messager;
    /**
     * @type {?}
     * @protected
     */
    AbstractUiService.prototype.injector;
    /**
     * @type {?}
     * @protected
     */
    AbstractUiService.prototype.cfr;
    /**
     * @type {?}
     * @protected
     */
    AbstractUiService.prototype.loader;
    /**
     * @type {?}
     * @protected
     */
    AbstractUiService.prototype.localeId;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYWJzdHJhY3QtdWktc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BlZHAtYmlmL3J1bnRpbWUtYXBpLyIsInNvdXJjZXMiOlsibGliL2JpZi1tYW51YWwtY3JlYXRpb24vc2VydmljZS9hYnN0cmFjdC11aS1zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsT0FBTyxFQUFFLFFBQVEsRUFBRSx3QkFBd0IsRUFBRSxxQkFBcUIsRUFBRSxNQUFNLEVBQUUsU0FBUyxFQUFFLFlBQVksRUFBb0Isa0JBQWtCLEVBQXlCLFFBQVEsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUNsTSxPQUFPLEVBQUUsVUFBVSxFQUFFLElBQUksRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUN4QyxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFFM0MsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQzlDLE9BQU8sRUFBRSxjQUFjLEVBQWdCLE1BQU0sa0JBQWtCLENBQUM7QUFHaEUsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQ2pELE9BQU8sRUFBRSxzQkFBc0IsRUFBRSxNQUFNLHlDQUF5QyxDQUFDO0FBS2pGLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUN0RCxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sb0JBQW9CLENBQUM7QUFDcEQsT0FBTyxFQUFFLHVCQUF1QixFQUFFLE1BQU0sMEJBQTBCLENBQUM7Ozs7QUFHbkUsTUFBTSxPQUFnQixpQkFBaUI7Ozs7Ozs7Ozs7O0lBZW5DLFlBQ2MsWUFBMEIsRUFDMUIsWUFBNEIsRUFDNUIsUUFBeUIsRUFDekIsUUFBa0IsRUFDbEIsR0FBNkIsRUFDN0IsTUFBNkIsRUFDVixRQUFnQixFQUNqQyx1QkFBZ0Q7UUFQbEQsaUJBQVksR0FBWixZQUFZLENBQWM7UUFDMUIsaUJBQVksR0FBWixZQUFZLENBQWdCO1FBQzVC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QUN4QixNQUFNLEVBQUUsSUFBSSxDQUFDLFFBQVEsQ0FBQyxzQkFBc0I7YUFDL0M7U0FDSixDQUFDO1FBQ0YsWUFBWSxDQUFDLFdBQVcsR0FBRyxJQUFJLENBQUM7SUFDcEMsQ0FBQzs7OztZQXBISSxZQUFZO1lBQ1osY0FBYztZQVNkLGVBQWU7WUFkZixRQUFRO1lBQUUsd0JBQXdCO1lBQUUscUJBQXFCO3lDQXlDekQsTUFBTSxTQUFDLFNBQVM7WUF6QmhCLHVCQUF1Qix1QkEwQnZCLFFBQVE7Ozs7Ozs7O0lBbkJiLGdEQU1FOzs7OztJQUVGLHVDQUFpQzs7Ozs7SUFDakMsb0RBQTJEOzs7OztJQUd2RCx5Q0FBb0M7Ozs7O0lBQ3BDLHlDQUFzQzs7Ozs7SUFDdEMscUNBQW1DOzs7OztJQUNuQyxxQ0FBNEI7Ozs7O0lBQzVCLGdDQUF1Qzs7Ozs7SUFDdkMsbUNBQXVDOzs7OztJQUN2QyxxQ0FBNkMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RvciwgQ29tcG9uZW50RmFjdG9yeVJlc29sdmVyLCBOZ01vZHVsZUZhY3RvcnlMb2FkZXIsIEluamVjdCwgTE9DQUxFX0lELCBDb21wb25lbnRSZWYsIENvbXBvbmVudEZhY3RvcnksIFJlZmxlY3RpdmVJbmplY3RvciwgTmdNb2R1bGVGYWN0b3J5LCBUeXBlLCBPcHRpb25hbCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBPYnNlcnZhYmxlLCBmcm9tIH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7IHN3aXRjaE1hcCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcclxuXHJcbmltcG9ydCB7IEZyYW1lQ29udGV4dCB9IGZyb20gJ0BmYXJyaXMvZGV2a2l0JztcclxuaW1wb3J0IHsgQnNNb2RhbFNlcnZpY2UsIE1vZGFsT3B0aW9ucyB9IGZyb20gJ0BmYXJyaXMvdWktbW9kYWwnO1xyXG5cclxuaW1wb3J0IHsgSVJ0U2xpbUJpbGxDcmVhdGlvblByb2Nlc3NFbnRpdHlFeCB9IGZyb20gJ0BlZHAtYmlmL2NvbW1vbi1hcGknO1xyXG5pbXBvcnQgeyBMb2NhbGVQaXBlIH0gZnJvbSAnLi4vcGlwZS9sb2NhbGUucGlwZSc7XHJcbmltcG9ydCB7IFNFTEVDVE9SX0FSR1NfSU5KRUNUT1IgfSBmcm9tICcuLi9jb25maWcvc2VsZWN0b3ItYXJncy1pbmplY3Rvci5jb25maWcnO1xyXG5pbXBvcnQgeyBGb3JtR2V0QmlsbENyZWF0aW9uUHJvY2Vzc0VudGl0eUV4QXJncyB9IGZyb20gJy4uLy4uL2VudGl0eS9mb3JtLXJlc3QvRm9ybUdldEJpbGxDcmVhdGlvblByb2Nlc3NFbnRpdHlFeEFyZ3MnO1xyXG5pbXBvcnQgeyBJQmlmQ3JlYXRpb25Qcm9jZXNzU2VsZWN0b3JDb21wb25lbnQgfSBmcm9tICcuLi9iYXNlL0lCaWZDcmVhdGlvblByb2Nlc3NTZWxlY3RvckNvbXBvbmVudCc7XHJcbmltcG9ydCB7IElCaWZTZWxlY3RvckNvbXBvbmVudCB9IGZyb20gJy4uL2Jhc2UvSUJpZlNlbGVjdG9yQ29tcG9uZW50JztcclxuaW1wb3J0IHsgSUJpZkNyZWF0aW9uUHJvY2Vzc1NlbGVjdG9yTW9kdWxlIH0gZnJvbSAnLi4vYmFzZS9JQmlmQ3JlYXRpb25Qcm9jZXNzU2VsZWN0b3JNb2R1bGUnO1xyXG5pbXBvcnQgeyBNZXNzYWdlclNlcnZpY2UgfSBmcm9tICdAZmFycmlzL3VpLW1lc3NhZ2VyJztcclxuaW1wb3J0IHsgTG9hZGluZ1NlcnZpY2UgfSBmcm9tICdAZmFycmlzL3VpLWxvYWRpbmcnO1xyXG5pbXBvcnQgeyBSdW50aW1lRnJhbWV3b3JrU2VydmljZSB9IGZyb20gJ0BmYXJyaXMvY29tbWFuZC1zZXJ2aWNlcyc7XHJcbmltcG9ydCB7IEFic3RyYWN0QmlmRGF0YVNlbGVjdG9yU2VydmljZSB9IGZyb20gJy4vYmlmLWRhdGEtc2VsZWN0b3Iuc2VydmljZSc7XHJcblxyXG5leHBvcnQgYWJzdHJhY3QgY2xhc3MgQWJzdHJhY3RVaVNlcnZpY2Uge1xyXG4gICAgLyoqXHJcbiAgICAgKiDlhoXnva7mqKHmgIHmoYbphY3nva5cclxuICAgICAqL1xyXG4gICAgcHJvdGVjdGVkIHJlYWRvbmx5IGRlZmF1bHRNb2RhbE9wdGlvbnM6IE1vZGFsT3B0aW9ucyA9IHtcclxuICAgICAgICB0aXRsZTogbnVsbCxcclxuICAgICAgICB3aWR0aDogOTAwLFxyXG4gICAgICAgIGhlaWdodDogNTAwLFxyXG4gICAgICAgIGJ1dHRvbnM6IG51bGwsXHJcbiAgICAgICAgc2hvd0J1dHRvbnM6IG51bGwsXHJcbiAgICB9O1xyXG5cclxuICAgIHByb3RlY3RlZCBsb2NhbGVQaXBlOiBMb2NhbGVQaXBlO1xyXG4gICAgcHJvdGVjdGVkIHJ1bnRpbWVGcmFtZXdvcmtTZXJ2aWNlOiBSdW50aW1lRnJhbWV3b3JrU2VydmljZTtcclxuXHJcbiAgICBjb25zdHJ1Y3RvcihcclxuICAgICAgICBwcm90ZWN0ZWQgZnJhbWVDb250ZXh0OiBGcmFtZUNvbnRleHQsXHJcbiAgICAgICAgcHJvdGVjdGVkIG1vZGFsU2VydmljZTogQnNNb2RhbFNlcnZpY2UsXHJcbiAgICAgICAgcHJvdGVjdGVkIG1lc3NhZ2VyOiBNZXNzYWdlclNlcnZpY2UsXHJcbiAgICAgICAgcHJvdGVjdGVkIGluamVjdG9yOiBJbmplY3RvcixcclxuICAgICAgICBwcm90ZWN0ZWQgY2ZyOiBDb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIsXHJcbiAgICAgICAgcHJvdGVjdGVkIGxvYWRlcjogTmdNb2R1bGVGYWN0b3J5TG9hZGVyLFxyXG4gICAgICAgIEBJbmplY3QoTE9DQUxFX0lEKSBwcm90ZWN0ZWQgbG9jYWxlSWQ6IHN0cmluZyxcclxuICAgICAgICBAT3B0aW9uYWwoKSBydW50aW1lRnJhbWV3b3JrU2VydmljZTogUnVudGltZUZyYW1ld29ya1NlcnZpY2UsXHJcbiAgICApIHtcclxuICAgICAgICB0aGlzLnJ1bnRpbWVGcmFtZXdvcmtTZXJ2aWNlID0gcnVudGltZUZyYW1ld29ya1NlcnZpY2UgfHwgaW5qZWN0b3IuZ2V0KFJ1bnRpbWVGcmFtZXdvcmtTZXJ2aWNlKTtcclxuICAgICAgICB0aGlzLmxvY2FsZVBpcGUgPSBuZXcgTG9jYWxlUGlwZShsb2NhbGVJZCk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJvdGVjdGVkIG9wZW5CaWxsQ3JlYXRpb25Qcm9jZXNzU2VsZWN0b3IoYXJnczogRm9ybUdldEJpbGxDcmVhdGlvblByb2Nlc3NFbnRpdHlFeEFyZ3MsIHR5cGU6IFR5cGU8SUJpZkNyZWF0aW9uUHJvY2Vzc1NlbGVjdG9yQ29tcG9uZW50PiwgbW9kYWxPcHRpb25zPzogTW9kYWxPcHRpb25zLCBjdXN0b21TZWxlY3Rvck1vZHVsZVVybD86IHN0cmluZywgZXh0UGFyYW1zPzoge30pOiBPYnNlcnZhYmxlPElSdFNsaW1CaWxsQ3JlYXRpb25Qcm9jZXNzRW50aXR5RXg+IHtcclxuICAgICAgICBpZiAodHlwZW9mIG1vZGFsT3B0aW9ucyA9PSBcInN0cmluZ1wiKSB7XHJcbiAgICAgICAgICAgIGlmIChtb2RhbE9wdGlvbnMgPT0gXCJcIikge1xyXG4gICAgICAgICAgICAgICAgdGhyb3cgXCJtb2RhbE9wdGlvbnPkuI3lj6/kuLrnqbpcIjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBtb2RhbE9wdGlvbnMgPSBKU09OLnBhcnNlKG1vZGFsT3B0aW9ucyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBtb2RhbE9wdGlvbnMgPSBtb2RhbE9wdGlvbnMgPT0gbnVsbCA/IHRoaXMuZGVmYXVsdE1vZGFsT3B0aW9ucyA6IG1vZGFsT3B0aW9ucztcclxuICAgICAgICBtb2RhbE9wdGlvbnMudGl0bGUgPSBtb2RhbE9wdGlvbnMudGl0bGUgPT0gbnVsbCA/IHRoaXMubG9jYWxlUGlwZS50cmFuc2Zvcm0oXCJjcmVhdGlvblByb2Nlc3NTZWxlY3RvclwiKSA6IG1vZGFsT3B0aW9ucy50aXRsZTtcclxuXHJcbiAgICAgICAgbGV0IGNtcFI6IENvbXBvbmVudFJlZjxJQmlmQ3JlYXRpb25Qcm9jZXNzU2VsZWN0b3JDb21wb25lbnQ+ID0gbnVsbDtcclxuICAgICAgICBpZiAoY3VzdG9tU2VsZWN0b3JNb2R1bGVVcmwgPT0gbnVsbCB8fCBjdXN0b21TZWxlY3Rvck1vZHVsZVVybC50cmltKCkgPT0gXCJcIikge1xyXG4gICAgICAgICAgICBsZXQgY21wRjogQ29tcG9uZW50RmFjdG9yeTxJQmlmQ3JlYXRpb25Qcm9jZXNzU2VsZWN0b3JDb21wb25lbnQ+ID0gdGhpcy5jZnIucmVzb2x2ZUNvbXBvbmVudEZhY3RvcnkodHlwZSk7XHJcblxyXG4gICAgICAgICAgICBsZXQgaW5qOiBJbmplY3RvciA9IFJlZmxlY3RpdmVJbmplY3Rvci5yZXNvbHZlQW5kQ3JlYXRlKFtcclxuICAgICAgICAgICAgICAgIHsgcHJvdmlkZTogU0VMRUNUT1JfQVJHU19JTkpFQ1RPUiwgdXNlVmFsdWU6IGFyZ3MuQ29udmVydFRvSnNvbk9iamVjdCgpIH0sXHJcbiAgICAgICAgICAgICAgICBMb2FkaW5nU2VydmljZSxcclxuICAgICAgICAgICAgXSwgdGhpcy5pbmplY3Rvcik7XHJcbiAgICAgICAgICAgIGNtcFIgPSBjbXBGLmNyZWF0ZShpbmopO1xyXG4gICAgICAgICAgICB0aGlzLmNvbmZpZ01vZGFsQnV0dG9ucyhtb2RhbE9wdGlvbnMsIGNtcFIpO1xyXG5cclxuICAgICAgICAgICAgY21wUi5pbnN0YW5jZS5ic01vZGFsUmVmNEJpZlNlbGVjdG9yID0gdGhpcy5tb2RhbFNlcnZpY2Uuc2hvdyhjbXBSLCBtb2RhbE9wdGlvbnMpO1xyXG4gICAgICAgICAgICByZXR1cm4gY21wUi5pbnN0YW5jZS5zdWJqZWN0NENyZWF0aW9uUHJvY2Vzcy5hc09ic2VydmFibGUoKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICByZXR1cm4gZnJvbSh0aGlzLmxvYWRlci5sb2FkKGN1c3RvbVNlbGVjdG9yTW9kdWxlVXJsKSkucGlwZShcclxuICAgICAgICAgICAgICAgIHN3aXRjaE1hcChcclxuICAgICAgICAgICAgICAgICAgICAobW9kdWxlRmFjdG9yeTogTmdNb2R1bGVGYWN0b3J5PElCaWZDcmVhdGlvblByb2Nlc3NTZWxlY3Rvck1vZHVsZT4pID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbW9kdWxlUmVmID0gbW9kdWxlRmFjdG9yeS5jcmVhdGUodGhpcy5mcmFtZUNvbnRleHQucm9vdC5pbmplY3Rvcik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGNtcFIkID0gbW9kdWxlUmVmLmluc3RhbmNlLmNyZWF0ZUNyZWF0aW9uUHJvY2Vzc1NlbGVjdG9yKHRoaXMuZnJhbWVDb250ZXh0LnJvb3QuaW5qZWN0b3IsIGV4dFBhcmFtcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjbXBSJCBpbnN0YW5jZW9mIE9ic2VydmFibGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjbXBSJC5waXBlKFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaE1hcChcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGNvbXBvbmVudFJlZikgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY21wUiA9IGNvbXBvbmVudFJlZjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY29uZmlnTW9kYWxCdXR0b25zKG1vZGFsT3B0aW9ucywgY21wUik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbXBSLmluc3RhbmNlLmJzTW9kYWxSZWY0QmlmU2VsZWN0b3IgPSB0aGlzLm1vZGFsU2VydmljZS5zaG93KGNtcFIsIG1vZGFsT3B0aW9ucyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gY21wUi5pbnN0YW5jZS5zdWJqZWN0NENyZWF0aW9uUHJvY2Vzcy5hc09ic2VydmFibGUoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoY21wUiQgaW5zdGFuY2VvZiBDb21wb25lbnRSZWYpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNtcFIgPSBjbXBSJDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY29uZmlnTW9kYWxCdXR0b25zKG1vZGFsT3B0aW9ucywgY21wUik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbXBSLmluc3RhbmNlLmJzTW9kYWxSZWY0QmlmU2VsZWN0b3IgPSB0aGlzLm1vZGFsU2VydmljZS5zaG93KGNtcFIsIG1vZGFsT3B0aW9ucyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gY21wUi5pbnN0YW5jZS5zdWJqZWN0NENyZWF0aW9uUHJvY2Vzcy5hc09ic2VydmFibGUoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIClcclxuICAgICAgICAgICAgKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDphY3nva7mqKHmgIHmoYbmjInpkq7kuovku7ZcclxuICAgICAqIEBwYXJhbSBtb2RhbE9wdGlvbnNcclxuICAgICAqIEBwYXJhbSBjbXBSXHJcbiAgICAgKi9cclxuICAgIHByb3RlY3RlZCBjb25maWdNb2RhbEJ1dHRvbnMobW9kYWxPcHRpb25zOiBNb2RhbE9wdGlvbnMsIGNtcFI6IENvbXBvbmVudFJlZjxJQmlmU2VsZWN0b3JDb21wb25lbnQ+KSB7XHJcbiAgICAgICAgbW9kYWxPcHRpb25zLmJ1dHRvbnMgPSBbXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHRleHQ6IHRoaXMubG9jYWxlUGlwZS50cmFuc2Zvcm0oXCJjb25maXJtXCIpLFxyXG4gICAgICAgICAgICAgICAgY2xzOiBcImJ0biBidG4tcHJpbWFyeVwiLFxyXG4gICAgICAgICAgICAgICAgaGFuZGxlOiBjbXBSLmluc3RhbmNlLmNsaWNrT2s0QmlmU2VsZWN0b3IsXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHRleHQ6IHRoaXMubG9jYWxlUGlwZS50cmFuc2Zvcm0oXCJjYW5jZWxcIiksXHJcbiAgICAgICAgICAgICAgICBjbHM6IFwiYnRuIGJ0bi1zZWNvbmRhcnlcIixcclxuICAgICAgICAgICAgICAgIGhhbmRsZTogY21wUi5pbnN0YW5jZS5jbGlja0Nsb3NlNEJpZlNlbGVjdG9yLFxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgXTtcclxuICAgICAgICBtb2RhbE9wdGlvbnMuc2hvd0J1dHRvbnMgPSB0cnVlO1xyXG4gICAgfVxyXG59XHJcbiJdfQ==
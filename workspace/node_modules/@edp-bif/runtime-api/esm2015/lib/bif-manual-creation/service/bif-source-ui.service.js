/**
 * @fileoverview added by tsickle
 * Generated from: lib/bif-manual-creation/service/bif-source-ui.service.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Injectable, Injector, ComponentFactoryResolver, NgModuleFactoryLoader, Inject, LOCALE_ID, Optional } from '@angular/core';
import { AbstractUiService } from './abstract-ui-service';
import { NavigationService, RuntimeFrameworkService } from '@farris/command-services';
import { FrameContext } from '@farris/devkit';
import { BsModalService } from '@farris/ui-modal';
import { FormGetBillCreationProcessEntityExArgs } from '../../entity/form-rest/FormGetBillCreationProcessEntityExArgs';
import { PushSelectorComponent } from '../components/push-selector/push-selector.component';
import { BpmnModelJsonHelper } from '@edp-aif/common-api';
import { RpcCreationRuleExecutorResult } from '../../ref';
import { BIF_UISTATE_KEY_CREATION_RESULT } from '../config/bif-form-constants';
import { FormBillCreationProcessExecutorResult } from '@edp-aif/runtime-api';
import { ManualCreationMode } from '../../entity/form-rest/ManualCreationMode';
import { MessagerService } from '@farris/ui-messager';
import { judgeBrowserType } from "../../utils/BrowserUtil";
import { GeneralTextIdWithDataId } from '../../entity/form-rest/GeneralTextIdWithDataId';
export class BifSourceUiService extends AbstractUiService {
    /**
     * @param {?} navigationService
     * @param {?} frameContext
     * @param {?} modalService
     * @param {?} messager
     * @param {?} injector
     * @param {?} cfr
     * @param {?} loader
     * @param {?} localeId
     * @param {?} runtimeFrameworkService
     */
    constructor(navigationService, frameContext, modalService, messager, injector, cfr, loader, localeId, runtimeFrameworkService) {
        super(frameContext, modalService, messager, injector, cfr, loader, localeId, runtimeFrameworkService);
        this.navigationService = navigationService;
        this.frameContext = frameContext;
        this.modalService = modalService;
        this.messager = messager;
        this.injector = injector;
        this.cfr = cfr;
        this.loader = loader;
        this.localeId = localeId;
        this.uiStateKeyCreationResult = BIF_UISTATE_KEY_CREATION_RESULT;
    }
    /**
     * 下推时打开生单规则选择器
     * @param {?} upBillVoId
     * @param {?=} bizFlowchartId
     * @param {?=} modalOptions
     * @param {?=} customSelectorModuleUrl
     * @param {?=} extParams
     * @return {?}
     */
    openBillCreationProcessSelector4Push(upBillVoId, bizFlowchartId, modalOptions, customSelectorModuleUrl, extParams) {
        /** @type {?} */
        const args = new FormGetBillCreationProcessEntityExArgs();
        args.upBillVoId = upBillVoId;
        args.manualCreationMode = ManualCreationMode.Push;
        return this.openBillCreationProcessSelector(args, PushSelectorComponent, modalOptions, customSelectorModuleUrl, extParams);
    }
    /**
     * 特定下推时打开生单规则选择器
     * @param {?} upBillVoId
     * @param {?} downBillVoId
     * @param {?=} bizFlowchartId
     * @param {?=} modalOptions
     * @param {?=} customSelectorModuleUrl
     * @param {?=} extParams
     * @return {?}
     */
    openBillCreationProcessSelector4SpecificPush(upBillVoId, downBillVoId, bizFlowchartId, modalOptions, customSelectorModuleUrl, extParams) {
        /** @type {?} */
        const args = new FormGetBillCreationProcessEntityExArgs();
        args.upBillVoId = upBillVoId;
        args.downBillVoId = downBillVoId;
        args.manualCreationMode = ManualCreationMode.SpecificPush;
        // args.bizFlowchartId = bizFlowchartId;
        return this.openBillCreationProcessSelector(args, PushSelectorComponent, modalOptions, customSelectorModuleUrl, extParams);
    }
    /**
     * \@Deprecated 已弃用，请使用{\@link openTargetApp}
     * 打开下游单据制单界面
     * @param {?} formSettings
     * @param {?} creationResult
     * @param {?=} extParams
     * @return {?}
     */
    openTargetForm(formSettings, creationResult, extParams) {
        if (formSettings == null) {
            throw "参数formSettings不可为空";
        }
        if (creationResult == null) {
            throw "参数creationResult不可为空";
        }
        if (typeof creationResult == "string") {
            if (creationResult == "") {
                throw "参数creationResult不可为空";
            }
            /** @type {?} */
            const temp = new FormBillCreationProcessExecutorResult();
            temp.LoadFromJson(creationResult);
            creationResult = temp;
        }
        if ((creationResult instanceof FormBillCreationProcessExecutorResult) == false) {
            /** @type {?} */
            const res = new FormBillCreationProcessExecutorResult();
            res.LoadFromJsonObject(creationResult);
            creationResult = res;
        }
        if (creationResult.conditionResult.conditionExecutionResult == false) {
            this.messager.error(creationResult.conditionResult.message || this.localePipe.transform("creationExecutionError"));
            return;
        }
        if (creationResult.creationRuleExecutorResult == null || creationResult.creationRuleExecutorResult.mappingResults == null || creationResult.creationRuleExecutorResult.mappingResults.length == 0) {
            this.messager.error(this.localePipe.transform("creationResultEmpty"));
            return;
        }
        else if (creationResult.creationRuleExecutorResult.mappingResults.length == 1) {
            // 从表单配置中取下游卡片加载命令
            /** @type {?} */
            const action = formSettings.targetCardAppLoadCmd;
            if (action != null && action != "") {
                if (extParams == null) {
                    extParams = {
                        action: action
                    };
                }
                else {
                    extParams["action"] = extParams["action"] != null && extParams["action"] != "" ? extParams["action"] : action;
                }
            }
            //只有一条数据则打开卡片
            this.openApp(creationResult.creationRuleExecutorResult.mappingResults[0].associations[0].tarRootDataId, formSettings.targetCardAppId, formSettings.targetCardAppEntrance, creationResult, extParams, false);
        }
        else {
            if (formSettings.targetListAppId != null) {
                // 多条数据且配置批量编辑界面
                throw "暂不支持打开批量编辑界面";
                this.openApp(creationResult.creationRuleExecutorResult.mappingResults[0].associations[0].tarRootDataId, formSettings.targetListAppId, formSettings.targetListAppEntrance, creationResult, extParams, false);
            }
            else {
                //有多条数据但未配置批量编辑界面则打开多个卡片
                for (let mappingResult of creationResult.creationRuleExecutorResult.mappingResults) {
                    /** @type {?} */
                    let singleRes = new FormBillCreationProcessExecutorResult();
                    singleRes.conditionResult = creationResult.conditionResult;
                    singleRes.creationRuleExecutorResult = new RpcCreationRuleExecutorResult();
                    singleRes.creationRuleExecutorResult.bizFlowchartId = creationResult.creationRuleExecutorResult.bizFlowchartId;
                    singleRes.creationRuleExecutorResult.creationRuleId = creationResult.creationRuleExecutorResult.creationRuleId;
                    singleRes.creationRuleExecutorResult.creationRuleInstanceId = creationResult.creationRuleExecutorResult.creationRuleInstanceId;
                    singleRes.creationRuleExecutorResult.mappingResults = [mappingResult];
                    // 从表单配置中取下游卡片加载命令
                    /** @type {?} */
                    const action = formSettings.targetCardAppLoadCmd;
                    if (action != null && action != "") {
                        if (extParams == null) {
                            extParams = {
                                action: action
                            };
                        }
                        else {
                            extParams["action"] = extParams["action"] != null && extParams["action"] != "" ? extParams["action"] : action;
                        }
                    }
                    this.openApp(mappingResult.associations[0].tarRootDataId, formSettings.targetCardAppId, formSettings.targetCardAppEntrance, singleRes, extParams, false);
                }
            }
        }
    }
    /**
     * \@Deprecated
     * @private
     * @param {?} tabId
     * @param {?} appId
     * @param {?} appEntrance
     * @param {?} creationResult
     * @param {?=} extParams
     * @param {?=} reload
     * @param {?=} tabName
     * @param {?=} enableRefresh
     * @param {?=} destructuring
     * @return {?}
     */
    openApp(tabId, appId, appEntrance, creationResult, extParams, reload, tabName, enableRefresh, destructuring) {
        extParams = extParams == null ? {} : extParams;
        /** @type {?} */
        const browser = judgeBrowserType();
        if (browser.type == "IE" && browser.IEVersion == "IE11") {
            //IE11浏览器将生成结果转换为字符串存在top.localStorage，Id为tabId
            // console.log(tabId);
            window.top.localStorage.setItem(tabId, creationResult.ConvertToJson());
            this.navigationService.openApp(tabId, appId, appEntrance, extParams, reload, tabName, enableRefresh, destructuring);
        }
        else {
            this.navigationService.openApp(tabId, appId, appEntrance, this.buildRouteParams(creationResult, extParams), reload, tabName, enableRefresh, destructuring);
        }
    }
    /**
     * \@Deprecated
     * @private
     * @param {?} creationResult
     * @param {?} extParams
     * @return {?}
     */
    buildRouteParams(creationResult, extParams) {
        /** @type {?} */
        const params = extParams;
        params[this.uiStateKeyCreationResult] = creationResult.ConvertToJson();
        if (params["action"] == null || params["action"] == "") {
            params["action"] = "rootviewmodelbifLoad1";
        }
        return params;
    }
    /**
     * 打开下游单据制单界面
     * @param {?} formSettings
     * @param {?} conditionResult
     * @param {?} textIdWithDataIds
     * @param {?=} extParams
     * @return {?}
     */
    openTargetApp(formSettings, conditionResult, textIdWithDataIds, extParams) {
        if (formSettings == null) {
            throw "参数formSettings不可为空";
        }
        if (textIdWithDataIds == null) {
            throw "参数creationResult不可为空";
        }
        if (typeof textIdWithDataIds == "string") {
            if (textIdWithDataIds == "") {
                throw "参数creationResult不可为空";
            }
            textIdWithDataIds = (/** @type {?} */ (BpmnModelJsonHelper.FromJson(textIdWithDataIds, GeneralTextIdWithDataId)));
        }
        if (conditionResult.conditionExecutionResult == false) {
            this.messager.error(conditionResult.message || this.localePipe.transform("creationExecutionError"));
            return;
        }
        if (textIdWithDataIds == null || textIdWithDataIds.length == null || textIdWithDataIds.length <= 0) {
            this.messager.error(this.localePipe.transform("creationResultEmpty"));
            return;
        }
        else if (textIdWithDataIds.length == 1) {
            // 从表单配置中取下游卡片加载命令
            /** @type {?} */
            const action = formSettings.targetCardAppLoadCmd;
            if (action != null && action != "") {
                if (extParams == null) {
                    extParams = {
                        action: action
                    };
                }
                else {
                    extParams["action"] = extParams["action"] != null && extParams["action"] != "" ? extParams["action"] : action;
                }
            }
            //只有一条数据则打开卡片
            this.openAppWithGeneralText(textIdWithDataIds[0].dataId, formSettings.targetCardAppId, formSettings.targetCardAppEntrance, textIdWithDataIds[0].generalTextId, extParams, false);
        }
        else {
            if (formSettings.targetListAppId != null) {
                // 多条数据且配置批量编辑界面
                throw "暂不支持打开批量编辑界面";
            }
            else {
                //有多条数据但未配置批量编辑界面则打开多个卡片
                for (let item of textIdWithDataIds) {
                    // 从表单配置中取下游卡片加载命令
                    /** @type {?} */
                    const action = formSettings.targetCardAppLoadCmd;
                    if (action != null && action != "") {
                        if (extParams == null) {
                            extParams = {
                                action: action
                            };
                        }
                        else {
                            extParams["action"] = extParams["action"] != null && extParams["action"] != "" ? extParams["action"] : action;
                        }
                    }
                    this.openAppWithGeneralText(item.dataId, formSettings.targetCardAppId, formSettings.targetCardAppEntrance, item.generalTextId, extParams, false);
                }
            }
        }
    }
    /**
     * @private
     * @param {?} tabId
     * @param {?} appId
     * @param {?} appEntrance
     * @param {?} textId
     * @param {?=} extParams
     * @param {?=} reload
     * @param {?=} tabName
     * @param {?=} enableRefresh
     * @param {?=} destructuring
     * @return {?}
     */
    openAppWithGeneralText(tabId, appId, appEntrance, textId, extParams, reload, tabName, enableRefresh, destructuring) {
        extParams = extParams == null ? {} : extParams;
        /** @type {?} */
        const browser = judgeBrowserType();
        if (browser.type == "IE" && browser.IEVersion == "IE11") {
            //IE11浏览器将生成结果转换为字符串存在top.localStorage，Id为tabId
            window.top.localStorage.setItem(tabId, textId);
            this.navigationService.openApp(tabId, appId, appEntrance, this.buildRouteParamsWithGeneralText(textId, extParams), reload, tabName, enableRefresh, destructuring);
        }
        else {
            this.navigationService.openApp(tabId, appId, appEntrance, this.buildRouteParamsWithGeneralText(textId, extParams), reload, tabName, enableRefresh, destructuring);
        }
    }
    /**
     *
     * @private
     * @param {?} textId
     * @param {?} extParams
     * @return {?}
     */
    buildRouteParamsWithGeneralText(textId, extParams) {
        /** @type {?} */
        const params = extParams;
        params[this.uiStateKeyCreationResult] = textId;
        if (params["action"] == null || params["action"] == "") {
            params["action"] = "rootviewmodelbifLoad1";
        }
        return params;
    }
}
BifSourceUiService.decorators = [
    { type: Injectable }
];
/** @nocollapse */
BifSourceUiService.ctorParameters = () => [
    { type: NavigationService },
    { type: FrameContext },
    { type: BsModalService },
    { type: MessagerService },
    { type: Injector },
    { type: ComponentFactoryResolver },
    { type: NgModuleFactoryLoader },
    { type: String, decorators: [{ type: Inject, args: [LOCALE_ID,] }] },
    { type: RuntimeFrameworkService, decorators: [{ type: Optional }] }
];
if (false) {
    /**
     * @type {?}
     * @private
     */
    BifSourceUiService.prototype.uiStateKeyCreationResult;
    /**
     * @type {?}
     * @protected
     */
    BifSourceUiService.prototype.navigationService;
    /**
     * @type {?}
     * @protected
     */
    BifSourceUiService.prototype.frameContext;
    /**
     * @type {?}
     * @protected
     */
    BifSourceUiService.prototype.modalService;
    /**
     * @type {?}
     * @protected
     */
    BifSourceUiService.prototype.messager;
    /**
     * @type {?}
     * @protected
     */
    BifSourceUiService.prototype.injector;
    /**
     * @type {?}
     * @protected
     */
    BifSourceUiService.prototype.cfr;
    /**
     * @type {?}
     * @protected
     */
    BifSourceUiService.prototype.loader;
    /** @type {?} */
    BifSourceUiService.prototype.localeId;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmlmLXNvdXJjZS11aS5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGVkcC1iaWYvcnVudGltZS1hcGkvIiwic291cmNlcyI6WyJsaWIvYmlmLW1hbnVhbC1jcmVhdGlvbi9zZXJ2aWNlL2JpZi1zb3VyY2UtdWkuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsUUFBUSxFQUFFLHdCQUF3QixFQUFFLHFCQUFxQixFQUFFLE1BQU0sRUFBRSxTQUFTLEVBQUUsUUFBUSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ25JLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLHVCQUF1QixDQUFDO0FBQzFELE9BQU8sRUFBRSxpQkFBaUIsRUFBRSx1QkFBdUIsRUFBRSxNQUFNLDBCQUEwQixDQUFDO0FBQ3RGLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUM5QyxPQUFPLEVBQUUsY0FBYyxFQUFnQixNQUFNLGtCQUFrQixDQUFDO0FBRWhFLE9BQU8sRUFBRSxzQ0FBc0MsRUFBRSxNQUFNLCtEQUErRCxDQUFDO0FBRXZILE9BQU8sRUFBRSxxQkFBcUIsRUFBRSxNQUFNLHFEQUFxRCxDQUFDO0FBQzVGLE9BQU8sRUFBRSxtQkFBbUIsRUFBZ0IsTUFBTSxxQkFBcUIsQ0FBQztBQUN4RSxPQUFPLEVBQUUsNkJBQTZCLEVBQUUsTUFBTSxXQUFXLENBQUM7QUFDMUQsT0FBTyxFQUFFLCtCQUErQixFQUFFLE1BQU0sOEJBQThCLENBQUM7QUFDL0UsT0FBTyxFQUFtQixxQ0FBcUMsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBQzlGLE9BQU8sRUFBRSxrQkFBa0IsRUFBRSxNQUFNLDJDQUEyQyxDQUFDO0FBQy9FLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUN0RCxPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSx5QkFBeUIsQ0FBQTtBQUMxRCxPQUFPLEVBQUUs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akIsWUFBWTtZQUNaLGNBQWM7WUFVZCxlQUFlO1lBZEgsUUFBUTtZQUFFLHdCQUF3QjtZQUFFLHFCQUFxQjt5Q0E4QnJFLE1BQU0sU0FBQyxTQUFTO1lBNUJHLHVCQUF1Qix1QkE2QjFDLFFBQVE7Ozs7Ozs7SUFYYixzREFBNEU7Ozs7O0lBR3hFLCtDQUE4Qzs7Ozs7SUFDOUMsMENBQW9DOzs7OztJQUNwQywwQ0FBc0M7Ozs7O0lBQ3RDLHNDQUFtQzs7Ozs7SUFDbkMsc0NBQTRCOzs7OztJQUM1QixpQ0FBdUM7Ozs7O0lBQ3ZDLG9DQUF1Qzs7SUFDdkMsc0NBQTBDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSwgSW5qZWN0b3IsIENvbXBvbmVudEZhY3RvcnlSZXNvbHZlciwgTmdNb2R1bGVGYWN0b3J5TG9hZGVyLCBJbmplY3QsIExPQ0FMRV9JRCwgT3B0aW9uYWwgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgQWJzdHJhY3RVaVNlcnZpY2UgfSBmcm9tICcuL2Fic3RyYWN0LXVpLXNlcnZpY2UnO1xyXG5pbXBvcnQgeyBOYXZpZ2F0aW9uU2VydmljZSwgUnVudGltZUZyYW1ld29ya1NlcnZpY2UgfSBmcm9tICdAZmFycmlzL2NvbW1hbmQtc2VydmljZXMnO1xyXG5pbXBvcnQgeyBGcmFtZUNvbnRleHQgfSBmcm9tICdAZmFycmlzL2RldmtpdCc7XHJcbmltcG9ydCB7IEJzTW9kYWxTZXJ2aWNlLCBNb2RhbE9wdGlvbnMgfSBmcm9tICdAZmFycmlzL3VpLW1vZGFsJztcclxuaW1wb3J0IHsgSVJ0U2xpbUJpbGxDcmVhdGlvblByb2Nlc3NFbnRpdHlFeCB9IGZyb20gJ0BlZHAtYmlmL2NvbW1vbi1hcGknO1xyXG5pbXBvcnQgeyBGb3JtR2V0QmlsbENyZWF0aW9uUHJvY2Vzc0VudGl0eUV4QXJncyB9IGZyb20gJy4uLy4uL2VudGl0eS9mb3JtLXJlc3QvRm9ybUdldEJpbGxDcmVhdGlvblByb2Nlc3NFbnRpdHlFeEFyZ3MnO1xyXG5pbXBvcnQgeyBPYnNlcnZhYmxlIH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7IFB1c2hTZWxlY3RvckNvbXBvbmVudCB9IGZyb20gJy4uL2NvbXBvbmVudHMvcHVzaC1zZWxlY3Rvci9wdXNoLXNlbGVjdG9yLmNvbXBvbmVudCc7XHJcbmltcG9ydCB7IEJwbW5Nb2RlbEpzb25IZWxwZXIsIEZvcm1TZXR0aW5ncyB9IGZyb20gJ0BlZHAtYWlmL2NvbW1vbi1hcGknO1xyXG5pbXBvcnQgeyBScGNDcmVhdGlvblJ1bGVFeGVjdXRvclJlc3VsdCB9IGZyb20gJy4uLy4uL3JlZic7XHJcbmltcG9ydCB7IEJJRl9VSVNUQVRFX0tFWV9DUkVBVElPTl9SRVNVTFQgfSBmcm9tICcuLi9jb25maWcvYmlmLWZvcm0tY29uc3RhbnRzJztcclxuaW1wb3J0IHsgQ29uZGl0aW9uUmVzdWx0LCBGb3JtQmlsbENyZWF0aW9uUHJvY2Vzc0V4ZWN1dG9yUmVzdWx0IH0gZnJvbSAnQGVkcC1haWYvcnVudGltZS1hcGknO1xyXG5pbXBvcnQgeyBNYW51YWxDcmVhdGlvbk1vZGUgfSBmcm9tICcuLi8uLi9lbnRpdHkvZm9ybS1yZXN0L01hbnVhbENyZWF0aW9uTW9kZSc7XHJcbmltcG9ydCB7IE1lc3NhZ2VyU2VydmljZSB9IGZyb20gJ0BmYXJyaXMvdWktbWVzc2FnZXInO1xyXG5pbXBvcnQgeyBqdWRnZUJyb3dzZXJUeXBlIH0gZnJvbSBcIi4uLy4uL3V0aWxzL0Jyb3dzZXJVdGlsXCJcclxuaW1wb3J0IHsgR2VuZXJhbFRleHRJZFdpdGhEYXRhSWQgfSBmcm9tICcuLi8uLi9lbnRpdHkvZm9ybS1yZXN0L0dlbmVyYWxUZXh0SWRXaXRoRGF0YUlkJztcclxuXHJcbkBJbmplY3RhYmxlKClcclxuZXhwb3J0IGNsYXNzIEJpZlNvdXJjZVVpU2VydmljZSBleHRlbmRzIEFic3RyYWN0VWlTZXJ2aWNlIHtcclxuICAgIHByaXZhdGUgcmVhZG9ubHkgdWlTdGF0ZUtleUNyZWF0aW9uUmVzdWx0ID0gQklGX1VJU1RBVEVfS0VZX0NSRUFUSU9OX1JFU1VMVDtcclxuXHJcbiAgICBjb25zdHJ1Y3RvcihcclxuICAgICAgICBwcm90ZWN0ZWQgbmF2aWdhdGlvblNlcnZpY2U6IE5hdmlnYXRpb25TZXJ2aWNlLFxyXG4gICAgICAgIHByb3RlY3RlZCBmcmFtZUNvbnRleHQ6IEZyYW1lQ29udGV4dCxcclxuICAgICAgICBwcm90ZWN0ZWQgbW9kYWxTZXJ2aWNlOiBCc01vZGFsU2VydmljZSxcclxuICAgICAgICBwcm90ZWN0ZWQgbWVzc2FnZXI6IE1lc3NhZ2VyU2VydmljZSxcclxuICAgICAgICBwcm90ZWN0ZWQgaW5qZWN0b3I6IEluamVjdG9yLFxyXG4gICAgICAgIHByb3RlY3RlZCBjZnI6IENvbXBvbmVudEZhY3RvcnlSZXNvbHZlcixcclxuICAgICAgICBwcm90ZWN0ZWQgbG9hZGVyOiBOZ01vZHVsZUZhY3RvcnlMb2FkZXIsXHJcbiAgICAgICAgQEluamVjdChMT0NBTEVfSUQpIHB1YmxpYyBsb2NhbGVJZDogc3RyaW5nLFxyXG4gICAgICAgIEBPcHRpb25hbCgpIHJ1bnRpbWVGcmFtZXdvcmtTZXJ2aWNlOiBSdW50aW1lRnJhbWV3b3JrU2VydmljZSxcclxuICAgICkge1xyXG4gICAgICAgIHN1cGVyKGZyYW1lQ29udGV4dCwgbW9kYWxTZXJ2aWNlLCBtZXNzYWdlciwgaW5qZWN0b3IsIGNmciwgbG9hZGVyLCBsb2NhbGVJZCwgcnVudGltZUZyYW1ld29ya1NlcnZpY2UpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5LiL5o6o5pe25omT5byA55Sf5Y2V6KeE5YiZ6YCJ5oup5ZmoXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBvcGVuQmlsbENyZWF0aW9uUHJvY2Vzc1NlbGVjdG9yNFB1c2godXBCaWxsVm9JZDogc3RyaW5nLCBiaXpGbG93Y2hhcnRJZD86IHN0cmluZywgbW9kYWxPcHRpb25zPzogTW9kYWxPcHRpb25zLCBjdXN0b21TZWxlY3Rvck1vZHVsZVVybD86IHN0cmluZywgZXh0UGFyYW1zPzoge30pOiBPYnNlcnZhYmxlPElSdFNsaW1CaWxsQ3JlYXRpb25Qcm9jZXNzRW50aXR5RXg+IHtcclxuICAgICAgICBjb25zdCBhcmdzID0gbmV3IEZvcm1HZXRCaWxsQ3JlYXRpb25Qcm9jZXNzRW50aXR5RXhBcmdzKCk7XHJcbiAgICAgICAgYXJncy51cEJpbGxWb0lkID0gdXBCaWxsVm9JZDtcclxuICAgICAgICBhcmdzLm1hbnVhbENyZWF0aW9uTW9kZSA9IE1hbnVhbENyZWF0aW9uTW9kZS5QdXNoO1xyXG5cclxuICAgICAgICByZXR1cm4gdGhpcy5vcGVuQmlsbENyZWF0aW9uUHJvY2Vzc1NlbGVjdG9yKGFyZ3MsIFB1c2hTZWxlY3RvckNvbXBvbmVudCwgbW9kYWxPcHRpb25zLCBjdXN0b21TZWxlY3Rvck1vZHVsZVVybCwgZXh0UGFyYW1zKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOeJueWumuS4i+aOqOaXtuaJk+W8gOeUn+WNleinhOWImemAieaLqeWZqFxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgb3BlbkJpbGxDcmVhdGlvblByb2Nlc3NTZWxlY3RvcjRTcGVjaWZpY1B1c2godXBCaWxsVm9JZDogc3RyaW5nLCBkb3duQmlsbFZvSWQ6IHN0cmluZywgYml6Rmxvd2NoYXJ0SWQ/OiBzdHJpbmcsIG1vZGFsT3B0aW9ucz86IE1vZGFsT3B0aW9ucywgY3VzdG9tU2VsZWN0b3JNb2R1bGVVcmw/OiBzdHJpbmcsIGV4dFBhcmFtcz86IHt9KTogT2JzZXJ2YWJsZTxJUnRTbGltQmlsbENyZWF0aW9uUHJvY2Vzc0VudGl0eUV4PiB7XHJcbiAgICAgICAgY29uc3QgYXJncyA9IG5ldyBGb3JtR2V0QmlsbENyZWF0aW9uUHJvY2Vzc0VudGl0eUV4QXJncygpO1xyXG4gICAgICAgIGFyZ3MudXBCaWxsVm9JZCA9IHVwQmlsbFZvSWQ7XHJcbiAgICAgICAgYXJncy5kb3duQmlsbFZvSWQgPSBkb3duQmlsbFZvSWQ7XHJcbiAgICAgICAgYXJncy5tYW51YWxDcmVhdGlvbk1vZGUgPSBNYW51YWxDcmVhdGlvbk1vZGUuU3BlY2lmaWNQdXNoO1xyXG4gICAgICAgIC8vIGFyZ3MuYml6Rmxvd2NoYXJ0SWQgPSBiaXpGbG93Y2hhcnRJZDtcclxuXHJcbiAgICAgICAgcmV0dXJuIHRoaXMub3BlbkJpbGxDcmVhdGlvblByb2Nlc3NTZWxlY3RvcihhcmdzLCBQdXNoU2VsZWN0b3JDb21wb25lbnQsIG1vZGFsT3B0aW9ucywgY3VzdG9tU2VsZWN0b3JNb2R1bGVVcmwsIGV4dFBhcmFtcyk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBARGVwcmVjYXRlZCDlt7LlvIPnlKjvvIzor7fkvb/nlKh7QGxpbmsgb3BlblRhcmdldEFwcH1cclxuICAgICAqIOaJk+W8gOS4i+a4uOWNleaNruWItuWNleeVjOmdolxyXG4gICAgICogQHBhcmFtIGZvcm1TZXR0aW5nc1xyXG4gICAgICogQHBhcmFtIGNyZWF0aW9uUmVzdWx0XHJcbiAgICAgKiBAcGFyYW0gZXh0UGFyYW1zXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBvcGVuVGFyZ2V0Rm9ybShmb3JtU2V0dGluZ3M6IEZvcm1TZXR0aW5ncywgY3JlYXRpb25SZXN1bHQ6IEZvcm1CaWxsQ3JlYXRpb25Qcm9jZXNzRXhlY3V0b3JSZXN1bHQsIGV4dFBhcmFtcz86IHt9KTogdm9pZCB7XHJcbiAgICAgICAgaWYgKGZvcm1TZXR0aW5ncyA9PSBudWxsKSB7XHJcbiAgICAgICAgICAgIHRocm93IFwi5Y+C5pWwZm9ybVNldHRpbmdz5LiN5Y+v5Li656m6XCI7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChjcmVhdGlvblJlc3VsdCA9PSBudWxsKSB7XHJcbiAgICAgICAgICAgIHRocm93IFwi5Y+C5pWwY3JlYXRpb25SZXN1bHTkuI3lj6/kuLrnqbpcIjtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHR5cGVvZiBjcmVhdGlvblJlc3VsdCA9PSBcInN0cmluZ1wiKSB7XHJcbiAgICAgICAgICAgIGlmIChjcmVhdGlvblJlc3VsdCA9PSBcIlwiKSB7XHJcbiAgICAgICAgICAgICAgICB0aHJvdyBcIuWPguaVsGNyZWF0aW9uUmVzdWx05LiN5Y+v5Li656m6XCI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY29uc3QgdGVtcCA9IG5ldyBGb3JtQmlsbENyZWF0aW9uUHJvY2Vzc0V4ZWN1dG9yUmVzdWx0KCk7XHJcbiAgICAgICAgICAgIHRlbXAuTG9hZEZyb21Kc29uKGNyZWF0aW9uUmVzdWx0KTtcclxuICAgICAgICAgICAgY3JlYXRpb25SZXN1bHQgPSB0ZW1wO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoKGNyZWF0aW9uUmVzdWx0IGluc3RhbmNlb2YgRm9ybUJpbGxDcmVhdGlvblByb2Nlc3NFeGVjdXRvclJlc3VsdCkgPT0gZmFsc2UpIHtcclxuICAgICAgICAgICAgY29uc3QgcmVzID0gbmV3IEZvcm1CaWxsQ3JlYXRpb25Qcm9jZXNzRXhlY3V0b3JSZXN1bHQoKTtcclxuICAgICAgICAgICAgcmVzLkxvYWRGcm9tSnNvbk9iamVjdChjcmVhdGlvblJlc3VsdCk7XHJcbiAgICAgICAgICAgIGNyZWF0aW9uUmVzdWx0ID0gcmVzO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKGNyZWF0aW9uUmVzdWx0LmNvbmRpdGlvblJlc3VsdC5jb25kaXRpb25FeGVjdXRpb25SZXN1bHQgPT0gZmFsc2UpIHtcclxuICAgICAgICAgICAgdGhpcy5tZXNzYWdlci5lcnJvcihjcmVhdGlvblJlc3VsdC5jb25kaXRpb25SZXN1bHQubWVzc2FnZSB8fCB0aGlzLmxvY2FsZVBpcGUudHJhbnNmb3JtKFwiY3JlYXRpb25FeGVjdXRpb25FcnJvclwiKSk7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChjcmVhdGlvblJlc3VsdC5jcmVhdGlvblJ1bGVFeGVjdXRvclJlc3VsdCA9PSBudWxsIHx8IGNyZWF0aW9uUmVzdWx0LmNyZWF0aW9uUnVsZUV4ZWN1dG9yUmVzdWx0Lm1hcHBpbmdSZXN1bHRzID09IG51bGwgfHwgY3JlYXRpb25SZXN1bHQuY3JlYXRpb25SdWxlRXhlY3V0b3JSZXN1bHQubWFwcGluZ1Jlc3VsdHMubGVuZ3RoID09IDApIHtcclxuICAgICAgICAgICAgdGhpcy5tZXNzYWdlci5lcnJvcih0aGlzLmxvY2FsZVBpcGUudHJhbnNmb3JtKFwiY3JlYXRpb25SZXN1bHRFbXB0eVwiKSk7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9IGVsc2UgaWYgKGNyZWF0aW9uUmVzdWx0LmNyZWF0aW9uUnVsZUV4ZWN1dG9yUmVzdWx0Lm1hcHBpbmdSZXN1bHRzLmxlbmd0aCA9PSAxKSB7XHJcbiAgICAgICAgICAgIC8vIOS7juihqOWNlemFjee9ruS4reWPluS4i+a4uOWNoeeJh+WKoOi9veWRveS7pFxyXG4gICAgICAgICAgICBjb25zdCBhY3Rpb24gPSBmb3JtU2V0dGluZ3MudGFyZ2V0Q2FyZEFwcExvYWRDbWQ7XHJcbiAgICAgICAgICAgIGlmIChhY3Rpb24gIT0gbnVsbCAmJiBhY3Rpb24gIT0gXCJcIikge1xyXG4gICAgICAgICAgICAgICAgaWYgKGV4dFBhcmFtcyA9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZXh0UGFyYW1zID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb246IGFjdGlvblxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZXh0UGFyYW1zW1wiYWN0aW9uXCJdID0gZXh0UGFyYW1zW1wiYWN0aW9uXCJdICE9IG51bGwgJiYgZXh0UGFyYW1zW1wiYWN0aW9uXCJdICE9IFwiXCIgPyBleHRQYXJhbXNbXCJhY3Rpb25cIl0gOiBhY3Rpb247XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLy/lj6rmnInkuIDmnaHmlbDmja7liJnmiZPlvIDljaHniYdcclxuICAgICAgICAgICAgdGhpcy5vcGVuQXBwKFxyXG4gICAgICAgICAgICAgICAgY3JlYXRpb25SZXN1bHQuY3JlYXRpb25SdWxlRXhlY3V0b3JSZXN1bHQubWFwcGluZ1Jlc3VsdHNbMF0uYXNzb2NpYXRpb25zWzBdLnRhclJvb3REYXRhSWQsXHJcbiAgICAgICAgICAgICAgICBmb3JtU2V0dGluZ3MudGFyZ2V0Q2FyZEFwcElkLFxyXG4gICAgICAgICAgICAgICAgZm9ybVNldHRpbmdzLnRhcmdldENhcmRBcHBFbnRyYW5jZSxcclxuICAgICAgICAgICAgICAgIGNyZWF0aW9uUmVzdWx0LFxyXG4gICAgICAgICAgICAgICAgZXh0UGFyYW1zLFxyXG4gICAgICAgICAgICAgICAgZmFsc2VcclxuICAgICAgICAgICAgKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBpZiAoZm9ybVNldHRpbmdzLnRhcmdldExpc3RBcHBJZCAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAvLyDlpJrmnaHmlbDmja7kuJTphY3nva7mibnph4/nvJbovpHnlYzpnaJcclxuICAgICAgICAgICAgICAgIHRocm93IFwi5pqC5LiN5pSv5oyB5omT5byA5om56YeP57yW6L6R55WM6Z2iXCI7XHJcbiAgICAgICAgICAgICAgICB0aGlzLm9wZW5BcHAoXHJcbiAgICAgICAgICAgICAgICAgICAgY3JlYXRpb25SZXN1bHQuY3JlYXRpb25SdWxlRXhlY3V0b3JSZXN1bHQubWFwcGluZ1Jlc3VsdHNbMF0uYXNzb2NpYXRpb25zWzBdLnRhclJvb3REYXRhSWQsXHJcbiAgICAgICAgICAgICAgICAgICAgZm9ybVNldHRpbmdzLnRhcmdldExpc3RBcHBJZCxcclxuICAgICAgICAgICAgICAgICAgICBmb3JtU2V0dGluZ3MudGFyZ2V0TGlzdEFwcEVudHJhbmNlLFxyXG4gICAgICAgICAgICAgICAgICAgIGNyZWF0aW9uUmVzdWx0LFxyXG4gICAgICAgICAgICAgICAgICAgIGV4dFBhcmFtcyxcclxuICAgICAgICAgICAgICAgICAgICBmYWxzZVxyXG4gICAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIC8v5pyJ5aSa5p2h5pWw5o2u5L2G5pyq6YWN572u5om56YeP57yW6L6R55WM6Z2i5YiZ5omT5byA5aSa5Liq5Y2h54mHXHJcbiAgICAgICAgICAgICAgICBmb3IgKGxldCBtYXBwaW5nUmVzdWx0IG9mIGNyZWF0aW9uUmVzdWx0LmNyZWF0aW9uUnVsZUV4ZWN1dG9yUmVzdWx0Lm1hcHBpbmdSZXN1bHRzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IHNpbmdsZVJlcyA9IG5ldyBGb3JtQmlsbENyZWF0aW9uUHJvY2Vzc0V4ZWN1dG9yUmVzdWx0KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgc2luZ2xlUmVzLmNvbmRpdGlvblJlc3VsdCA9IGNyZWF0aW9uUmVzdWx0LmNvbmRpdGlvblJlc3VsdDtcclxuICAgICAgICAgICAgICAgICAgICBzaW5nbGVSZXMuY3JlYXRpb25SdWxlRXhlY3V0b3JSZXN1bHQgPSBuZXcgUnBjQ3JlYXRpb25SdWxlRXhlY3V0b3JSZXN1bHQoKTtcclxuICAgICAgICAgICAgICAgICAgICBzaW5nbGVSZXMuY3JlYXRpb25SdWxlRXhlY3V0b3JSZXN1bHQuYml6Rmxvd2NoYXJ0SWQgPSBjcmVhdGlvblJlc3VsdC5jcmVhdGlvblJ1bGVFeGVjdXRvclJlc3VsdC5iaXpGbG93Y2hhcnRJZDtcclxuICAgICAgICAgICAgICAgICAgICBzaW5nbGVSZXMuY3JlYXRpb25SdWxlRXhlY3V0b3JSZXN1bHQuY3JlYXRpb25SdWxlSWQgPSBjcmVhdGlvblJlc3VsdC5jcmVhdGlvblJ1bGVFeGVjdXRvclJlc3VsdC5jcmVhdGlvblJ1bGVJZDtcclxuICAgICAgICAgICAgICAgICAgICBzaW5nbGVSZXMuY3JlYXRpb25SdWxlRXhlY3V0b3JSZXN1bHQuY3JlYXRpb25SdWxlSW5zdGFuY2VJZCA9IGNyZWF0aW9uUmVzdWx0LmNyZWF0aW9uUnVsZUV4ZWN1dG9yUmVzdWx0LmNyZWF0aW9uUnVsZUluc3RhbmNlSWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgc2luZ2xlUmVzLmNyZWF0aW9uUnVsZUV4ZWN1dG9yUmVzdWx0Lm1hcHBpbmdSZXN1bHRzID0gW21hcHBpbmdSZXN1bHRdO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAvLyDku47ooajljZXphY3nva7kuK3lj5bkuIvmuLjljaHniYfliqDovb3lkb3ku6RcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBhY3Rpb24gPSBmb3JtU2V0dGluZ3MudGFyZ2V0Q2FyZEFwcExvYWRDbWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGFjdGlvbiAhPSBudWxsICYmIGFjdGlvbiAhPSBcIlwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChleHRQYXJhbXMgPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZXh0UGFyYW1zID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbjogYWN0aW9uXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBleHRQYXJhbXNbXCJhY3Rpb25cIl0gPSBleHRQYXJhbXNbXCJhY3Rpb25cIl0gIT0gbnVsbCAmJiBleHRQYXJhbXNbXCJhY3Rpb25cIl0gIT0gXCJcIiA/IGV4dFBhcmFtc1tcImFjdGlvblwiXSA6IGFjdGlvbjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB0aGlzLm9wZW5BcHAoXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1hcHBpbmdSZXN1bHQuYXNzb2NpYXRpb25zWzBdLnRhclJvb3REYXRhSWQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1TZXR0aW5ncy50YXJnZXRDYXJkQXBwSWQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1TZXR0aW5ncy50YXJnZXRDYXJkQXBwRW50cmFuY2UsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNpbmdsZVJlcyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZXh0UGFyYW1zLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBmYWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBARGVwcmVjYXRlZFxyXG4gICAgICogQHBhcmFtIHRhYklkXHJcbiAgICAgKiBAcGFyYW0gYXBwSWRcclxuICAgICAqIEBwYXJhbSBhcHBFbnRyYW5jZVxyXG4gICAgICogQHBhcmFtIGNyZWF0aW9uUmVzdWx0XHJcbiAgICAgKiBAcGFyYW0gZXh0UGFyYW1zXHJcbiAgICAgKiBAcGFyYW0gcmVsb2FkXHJcbiAgICAgKiBAcGFyYW0gdGFiTmFtZVxyXG4gICAgICogQHBhcmFtIGVuYWJsZVJlZnJlc2hcclxuICAgICAqIEBwYXJhbSBkZXN0cnVjdHVyaW5nXHJcbiAgICAgKi9cclxuICAgIHByaXZhdGUgb3BlbkFwcCh0YWJJZDogc3RyaW5nLCBhcHBJZDogc3RyaW5nLCBhcHBFbnRyYW5jZTogc3RyaW5nLCBjcmVhdGlvblJlc3VsdDogRm9ybUJpbGxDcmVhdGlvblByb2Nlc3NFeGVjdXRvclJlc3VsdCwgZXh0UGFyYW1zPzoge30sIHJlbG9hZD86IGJvb2xlYW4sIHRhYk5hbWU/OiBzdHJpbmcsIGVuYWJsZVJlZnJlc2g/OiBhbnksIGRlc3RydWN0dXJpbmc/OiBhbnkpOiB2b2lkIHtcclxuICAgICAgICBleHRQYXJhbXMgPSBleHRQYXJhbXMgPT0gbnVsbCA/IHt9IDogZXh0UGFyYW1zO1xyXG4gICAgICAgIGNvbnN0IGJyb3dzZXIgPSBqdWRnZUJyb3dzZXJUeXBlKCk7XHJcbiAgICAgICAgaWYgKGJyb3dzZXIudHlwZSA9PSBcIklFXCIgJiYgYnJvd3Nlci5JRVZlcnNpb24gPT0gXCJJRTExXCIpIHtcclxuICAgICAgICAgICAgLy9JRTEx5rWP6KeI5Zmo5bCG55Sf5oiQ57uT5p6c6L2s5o2i5Li65a2X56ym5Liy5a2Y5ZyodG9wLmxvY2FsU3RvcmFnZe+8jElk5Li6dGFiSWRcclxuICAgICAgICAgICAgLy8gY29uc29sZS5sb2codGFiSWQpO1xyXG4gICAgICAgICAgICB3aW5kb3cudG9wLmxvY2FsU3RvcmFnZS5zZXRJdGVtKHRhYklkLCBjcmVhdGlvblJlc3VsdC5Db252ZXJ0VG9Kc29uKCkpO1xyXG4gICAgICAgICAgICB0aGlzLm5hdmlnYXRpb25TZXJ2aWNlLm9wZW5BcHAoXHJcbiAgICAgICAgICAgICAgICB0YWJJZCwgYXBwSWQsIGFwcEVudHJhbmNlLCBleHRQYXJhbXMsIHJlbG9hZCwgdGFiTmFtZSwgZW5hYmxlUmVmcmVzaCwgZGVzdHJ1Y3R1cmluZ1xyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMubmF2aWdhdGlvblNlcnZpY2Uub3BlbkFwcChcclxuICAgICAgICAgICAgICAgIHRhYklkLCBhcHBJZCwgYXBwRW50cmFuY2UsXHJcbiAgICAgICAgICAgICAgICB0aGlzLmJ1aWxkUm91dGVQYXJhbXMoY3JlYXRpb25SZXN1bHQsIGV4dFBhcmFtcyksXHJcbiAgICAgICAgICAgICAgICByZWxvYWQsIHRhYk5hbWUsIGVuYWJsZVJlZnJlc2gsIGRlc3RydWN0dXJpbmdcclxuICAgICAgICAgICAgKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBARGVwcmVjYXRlZFxyXG4gICAgICogQHBhcmFtIGFjdGlvbiDnm67moIdBcHDliqjkvZxcclxuICAgICAqIEBwYXJhbSBwYWlycyDlhbbku5blrp7kvZPlj4LmlbDplK7lgLzlr7lcclxuICAgICAqL1xyXG4gICAgcHJpdmF0ZSBidWlsZFJvdXRlUGFyYW1zKGNyZWF0aW9uUmVzdWx0OiBGb3JtQmlsbENyZWF0aW9uUHJvY2Vzc0V4ZWN1dG9yUmVzdWx0LCBleHRQYXJhbXM6IHt9KToge30ge1xyXG4gICAgICAgIGNvbnN0IHBhcmFtcyA9IGV4dFBhcmFtcztcclxuICAgICAgICBwYXJhbXNbdGhpcy51aVN0YXRlS2V5Q3JlYXRpb25SZXN1bHRdID0gY3JlYXRpb25SZXN1bHQuQ29udmVydFRvSnNvbigpO1xyXG4gICAgICAgIGlmIChwYXJhbXNbXCJhY3Rpb25cIl0gPT0gbnVsbCB8fCBwYXJhbXNbXCJhY3Rpb25cIl0gPT0gXCJcIikge1xyXG4gICAgICAgICAgICBwYXJhbXNbXCJhY3Rpb25cIl0gPSBcInJvb3R2aWV3bW9kZWxiaWZMb2FkMVwiO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHBhcmFtcztcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOaJk+W8gOS4i+a4uOWNleaNruWItuWNleeVjOmdolxyXG4gICAgICogQHBhcmFtIGZvcm1TZXR0aW5nc1xyXG4gICAgICogQHBhcmFtIGNyZWF0aW9uUmVzdWx0XHJcbiAgICAgKiBAcGFyYW0gZXh0UGFyYW1zXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBvcGVuVGFyZ2V0QXBwKGZvcm1TZXR0aW5nczogRm9ybVNldHRpbmdzLCBjb25kaXRpb25SZXN1bHQ6IENvbmRpdGlvblJlc3VsdCwgdGV4dElkV2l0aERhdGFJZHM6IEdlbmVyYWxUZXh0SWRXaXRoRGF0YUlkW10sIGV4dFBhcmFtcz86IHt9KTogdm9pZCB7XHJcbiAgICAgICAgaWYgKGZvcm1TZXR0aW5ncyA9PSBudWxsKSB7XHJcbiAgICAgICAgICAgIHRocm93IFwi5Y+C5pWwZm9ybVNldHRpbmdz5LiN5Y+v5Li656m6XCI7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0ZXh0SWRXaXRoRGF0YUlkcyA9PSBudWxsKSB7XHJcbiAgICAgICAgICAgIHRocm93IFwi5Y+C5pWwY3JlYXRpb25SZXN1bHTkuI3lj6/kuLrnqbpcIjtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHR5cGVvZiB0ZXh0SWRXaXRoRGF0YUlkcyA9PSBcInN0cmluZ1wiKSB7XHJcbiAgICAgICAgICAgIGlmICh0ZXh0SWRXaXRoRGF0YUlkcyA9PSBcIlwiKSB7XHJcbiAgICAgICAgICAgICAgICB0aHJvdyBcIuWPguaVsGNyZWF0aW9uUmVzdWx05LiN5Y+v5Li656m6XCI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGV4dElkV2l0aERhdGFJZHMgPSBCcG1uTW9kZWxKc29uSGVscGVyLkZyb21Kc29uKHRleHRJZFdpdGhEYXRhSWRzLCBHZW5lcmFsVGV4dElkV2l0aERhdGFJZCkgYXMgR2VuZXJhbFRleHRJZFdpdGhEYXRhSWRbXTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChjb25kaXRpb25SZXN1bHQuY29uZGl0aW9uRXhlY3V0aW9uUmVzdWx0ID09IGZhbHNlKSB7XHJcbiAgICAgICAgICAgIHRoaXMubWVzc2FnZXIuZXJyb3IoY29uZGl0aW9uUmVzdWx0Lm1lc3NhZ2UgfHwgdGhpcy5sb2NhbGVQaXBlLnRyYW5zZm9ybShcImNyZWF0aW9uRXhlY3V0aW9uRXJyb3JcIikpO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodGV4dElkV2l0aERhdGFJZHMgPT0gbnVsbCB8fCB0ZXh0SWRXaXRoRGF0YUlkcy5sZW5ndGggPT0gbnVsbCB8fCB0ZXh0SWRXaXRoRGF0YUlkcy5sZW5ndGggPD0gMCkge1xyXG4gICAgICAgICAgICB0aGlzLm1lc3NhZ2VyLmVycm9yKHRoaXMubG9jYWxlUGlwZS50cmFuc2Zvcm0oXCJjcmVhdGlvblJlc3VsdEVtcHR5XCIpKTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH0gZWxzZSBpZiAodGV4dElkV2l0aERhdGFJZHMubGVuZ3RoID09IDEpIHtcclxuICAgICAgICAgICAgLy8g5LuO6KGo5Y2V6YWN572u5Lit5Y+W5LiL5ri45Y2h54mH5Yqg6L295ZG95LukXHJcbiAgICAgICAgICAgIGNvbnN0IGFjdGlvbiA9IGZvcm1TZXR0aW5ncy50YXJnZXRDYXJkQXBwTG9hZENtZDtcclxuICAgICAgICAgICAgaWYgKGFjdGlvbiAhPSBudWxsICYmIGFjdGlvbiAhPSBcIlwiKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoZXh0UGFyYW1zID09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgICBleHRQYXJhbXMgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbjogYWN0aW9uXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBleHRQYXJhbXNbXCJhY3Rpb25cIl0gPSBleHRQYXJhbXNbXCJhY3Rpb25cIl0gIT0gbnVsbCAmJiBleHRQYXJhbXNbXCJhY3Rpb25cIl0gIT0gXCJcIiA/IGV4dFBhcmFtc1tcImFjdGlvblwiXSA6IGFjdGlvbjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvL+WPquacieS4gOadoeaVsOaNruWImeaJk+W8gOWNoeeJh1xyXG4gICAgICAgICAgICB0aGlzLm9wZW5BcHBXaXRoR2VuZXJhbFRleHQoXHJcbiAgICAgICAgICAgICAgICB0ZXh0SWRXaXRoRGF0YUlkc1swXS5kYXRhSWQsXHJcbiAgICAgICAgICAgICAgICBmb3JtU2V0dGluZ3MudGFyZ2V0Q2FyZEFwcElkLFxyXG4gICAgICAgICAgICAgICAgZm9ybVNldHRpbmdzLnRhcmdldENhcmRBcHBFbnRyYW5jZSxcclxuICAgICAgICAgICAgICAgIHRleHRJZFdpdGhEYXRhSWRzWzBdLmdlbmVyYWxUZXh0SWQsXHJcbiAgICAgICAgICAgICAgICBleHRQYXJhbXMsXHJcbiAgICAgICAgICAgICAgICBmYWxzZVxyXG4gICAgICAgICAgICApXHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgaWYgKGZvcm1TZXR0aW5ncy50YXJnZXRMaXN0QXBwSWQgIT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgLy8g5aSa5p2h5pWw5o2u5LiU6YWN572u5om56YeP57yW6L6R55WM6Z2iXHJcbiAgICAgICAgICAgICAgICB0aHJvdyBcIuaaguS4jeaUr+aMgeaJk+W8gOaJuemHj+e8lui+keeVjOmdolwiO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgLy/mnInlpJrmnaHmlbDmja7kvYbmnKrphY3nva7mibnph4/nvJbovpHnlYzpnaLliJnmiZPlvIDlpJrkuKrljaHniYdcclxuICAgICAgICAgICAgICAgIGZvciAobGV0IGl0ZW0gb2YgdGV4dElkV2l0aERhdGFJZHMpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyDku47ooajljZXphY3nva7kuK3lj5bkuIvmuLjljaHniYfliqDovb3lkb3ku6RcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBhY3Rpb24gPSBmb3JtU2V0dGluZ3MudGFyZ2V0Q2FyZEFwcExvYWRDbWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGFjdGlvbiAhPSBudWxsICYmIGFjdGlvbiAhPSBcIlwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChleHRQYXJhbXMgPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZXh0UGFyYW1zID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbjogYWN0aW9uXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBleHRQYXJhbXNbXCJhY3Rpb25cIl0gPSBleHRQYXJhbXNbXCJhY3Rpb25cIl0gIT0gbnVsbCAmJiBleHRQYXJhbXNbXCJhY3Rpb25cIl0gIT0gXCJcIiA/IGV4dFBhcmFtc1tcImFjdGlvblwiXSA6IGFjdGlvbjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB0aGlzLm9wZW5BcHBXaXRoR2VuZXJhbFRleHQoXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0uZGF0YUlkLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3JtU2V0dGluZ3MudGFyZ2V0Q2FyZEFwcElkLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3JtU2V0dGluZ3MudGFyZ2V0Q2FyZEFwcEVudHJhbmNlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpdGVtLmdlbmVyYWxUZXh0SWQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGV4dFBhcmFtcyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZmFsc2VcclxuICAgICAgICAgICAgICAgICAgICApXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBvcGVuQXBwV2l0aEdlbmVyYWxUZXh0KHRhYklkOiBzdHJpbmcsIGFwcElkOiBzdHJpbmcsIGFwcEVudHJhbmNlOiBzdHJpbmcsIHRleHRJZDogc3RyaW5nLCBleHRQYXJhbXM/OiB7fSwgcmVsb2FkPzogYm9vbGVhbiwgdGFiTmFtZT86IHN0cmluZywgZW5hYmxlUmVmcmVzaD86IGFueSwgZGVzdHJ1Y3R1cmluZz86IGFueSk6IHZvaWQge1xyXG4gICAgICAgIGV4dFBhcmFtcyA9IGV4dFBhcmFtcyA9PSBudWxsID8ge30gOiBleHRQYXJhbXM7XHJcbiAgICAgICAgY29uc3QgYnJvd3NlciA9IGp1ZGdlQnJvd3NlclR5cGUoKTtcclxuICAgICAgICBpZiAoYnJvd3Nlci50eXBlID09IFwiSUVcIiAmJiBicm93c2VyLklFVmVyc2lvbiA9PSBcIklFMTFcIikge1xyXG4gICAgICAgICAgICAvL0lFMTHmtY/op4jlmajlsIbnlJ/miJDnu5PmnpzovazmjaLkuLrlrZfnrKbkuLLlrZjlnKh0b3AubG9jYWxTdG9yYWdl77yMSWTkuLp0YWJJZFxyXG4gICAgICAgICAgICB3aW5kb3cudG9wLmxvY2FsU3RvcmFnZS5zZXRJdGVtKHRhYklkLCB0ZXh0SWQpO1xyXG4gICAgICAgICAgICB0aGlzLm5hdmlnYXRpb25TZXJ2aWNlLm9wZW5BcHAoXHJcbiAgICAgICAgICAgICAgICB0YWJJZCwgYXBwSWQsIGFwcEVudHJhbmNlLFxyXG4gICAgICAgICAgICAgICAgdGhpcy5idWlsZFJvdXRlUGFyYW1zV2l0aEdlbmVyYWxUZXh0KHRleHRJZCwgZXh0UGFyYW1zKSxcclxuICAgICAgICAgICAgICAgIHJlbG9hZCwgdGFiTmFtZSwgZW5hYmxlUmVmcmVzaCwgZGVzdHJ1Y3R1cmluZ1xyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMubmF2aWdhdGlvblNlcnZpY2Uub3BlbkFwcChcclxuICAgICAgICAgICAgICAgIHRhYklkLCBhcHBJZCwgYXBwRW50cmFuY2UsXHJcbiAgICAgICAgICAgICAgICB0aGlzLmJ1aWxkUm91dGVQYXJhbXNXaXRoR2VuZXJhbFRleHQodGV4dElkLCBleHRQYXJhbXMpLFxyXG4gICAgICAgICAgICAgICAgcmVsb2FkLCB0YWJOYW1lLCBlbmFibGVSZWZyZXNoLCBkZXN0cnVjdHVyaW5nXHJcbiAgICAgICAgICAgICk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBhY3Rpb24g55uu5qCHQXBw5Yqo5L2cXHJcbiAgICAgKiBAcGFyYW0gcGFpcnMg5YW25LuW5a6e5L2T5Y+C5pWw6ZSu5YC85a+5XHJcbiAgICAgKi9cclxuICAgIHByaXZhdGUgYnVpbGRSb3V0ZVBhcmFtc1dpdGhHZW5lcmFsVGV4dCh0ZXh0SWQ6IHN0cmluZywgZXh0UGFyYW1zOiB7fSk6IHt9IHtcclxuICAgICAgICBjb25zdCBwYXJhbXMgPSBleHRQYXJhbXM7XHJcbiAgICAgICAgcGFyYW1zW3RoaXMudWlTdGF0ZUtleUNyZWF0aW9uUmVzdWx0XSA9IHRleHRJZDtcclxuICAgICAgICBpZiAocGFyYW1zW1wiYWN0aW9uXCJdID09IG51bGwgfHwgcGFyYW1zW1wiYWN0aW9uXCJdID09IFwiXCIpIHtcclxuICAgICAgICAgICAgcGFyYW1zW1wiYWN0aW9uXCJdID0gXCJyb290dmlld21vZGVsYmlmTG9hZDFcIjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBwYXJhbXM7XHJcbiAgICB9XHJcbn1cclxuIl19
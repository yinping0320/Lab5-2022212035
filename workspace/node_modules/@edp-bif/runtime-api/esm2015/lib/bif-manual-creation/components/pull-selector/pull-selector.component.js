/**
 * @fileoverview added by tsickle
 * Generated from: lib/bif-manual-creation/components/pull-selector/pull-selector.component.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Inject, LOCALE_ID, ElementRef, ViewChild, Injector, ComponentFactoryResolver, Optional, ReflectiveInjector } from '@angular/core';
import { Subject } from 'rxjs';
import { SELECTOR_ARGS_INJECTOR } from '../../config/selector-args-injector.config';
import { BifDataService } from '../../service/bif-data.service';
import { FormGetBillCreationProcessEntityExArgs } from '../../../entity/form-rest/FormGetBillCreationProcessEntityExArgs';
import { LoadingService } from '@farris/ui-loading';
import { TreeTableComponent } from '@farris/ui-treetable';
import { DatagridComponent } from '@farris/ui-datagrid';
import { LocalePipe } from '../../pipe/locale.pipe';
import { MessagerService } from '@farris/ui-messager';
export class PullSelectorComponent {
    /**
     * @param {?} args
     * @param {?} dataService
     * @param {?} localeId
     * @param {?} loading
     * @param {?} elementRef
     * @param {?} inj
     * @param {?} cfr
     * @param {?} messagerService
     */
    constructor(args, dataService, localeId, loading, elementRef, inj, cfr, messagerService) {
        this.dataService = dataService;
        this.loading = loading;
        this.elementRef = elementRef;
        this.inj = inj;
        this.cfr = cfr;
        this.messagerService = messagerService;
        this.ttData = [];
        this.ttIdField = 'voId';
        this.ttSearchFields = [];
        this.dgData = [];
        this.dgIdField = 'id';
        this.procData = [];
        this.scene = "Pull";
        this.bsModalRef4BifSelector = null;
        this.subject4CreationProcess = new Subject();
        this.clickOk4BifSelector = (/**
         * @return {?}
         */
        () => {
            if (this.selectedEntity == null) {
                this.messagerService.error(this.localePipe.instant("pleaseSelectOneCreationProcess"));
                return;
            }
            this.subject4CreationProcess.next(this.selectedEntity);
            this.subject4CreationProcess.complete();
            this.bsModalRef4BifSelector.close();
        });
        this.clickClose4BifSelector = (/**
         * @return {?}
         */
        () => {
            this.bsModalRef4BifSelector.close();
        });
        this.args = new FormGetBillCreationProcessEntityExArgs();
        this.args.LoadFromJsonObject(args);
        this.localePipe = new LocalePipe(localeId);
        if (inj == null) {
            /** @type {?} */
            const refInj = ReflectiveInjector.resolveAndCreate([
                MessagerService,
            ]);
            this.inj = refInj;
        }
        this.cfr = cfr || this.inj.get(ComponentFactoryResolver);
        this.messagerService = messagerService || this.inj.get(MessagerService, null);
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.ttDataRoot = {
            id: "*",
            data: {
                voId: "*",
                voName: this.localePipe.instant("all"),
            },
            parent: null,
            expanded: true,
            children: [],
        };
        this.ttData = [this.ttDataRoot];
        this.configTtColumns();
        this.configDgColumns();
        this.configTtEvents();
        this.configDgEvents();
        this.loadItems();
    }
    /**
     * @private
     * @return {?}
     */
    loadItems() {
        this.loading.show({ container: this.elementRef });
        /** @type {?} */
        let list$ = null;
        if (this.args.upBillVoId == null) {
            list$ = this.dataService.getSlimBillCreationProcessEntityExesByDownBillVoId4Pull(this.args.downBillVoId);
        }
        else {
            list$ = this.dataService.getSlimBillCreationProcessEntityExesByUpBillVoIdAndDownBillVoId4SpecificPull(this.args.upBillVoId, this.args.downBillVoId);
        }
        list$.subscribe((/**
         * @param {?} result
         * @return {?}
         */
        (result) => {
            this.loading.close();
            this.procData = result || [];
            this.dgData = [...this.procData];
            // 组织VO树
            /** @type {?} */
            const voList = [];
            this.procData.forEach((/**
             * @param {?} it
             * @return {?}
             */
            it => {
                if (voList.some((/**
                 * @param {?} vo
                 * @return {?}
                 */
                vo => vo.voId == it.upBillVoId)) == false) {
                    voList.push({
                        voId: it.upBillVoId,
                        voName: it.upBillVoName,
                    });
                }
            }));
            this.ttDataRoot.children = voList.map((/**
             * @param {?} it
             * @return {?}
             */
            it => {
                return {
                    id: it.voId,
                    data: {
                        voId: it.voId,
                        voName: it.voName,
                    },
                    expanded: true,
                };
            }));
            this.ttData = [this.ttDataRoot];
            // 默认选中第一条
            if (this.dgData && this.dgData.length > 0) {
                this.selectedEntity = this.dgData[0];
                setTimeout((/**
                 * @return {?}
                 */
                () => {
                    this.dg.clearSelections();
                    this.dg.selectRow(this.dgData[0].id);
                }), 0);
            }
        }), (/**
         * @param {?} err
         * @return {?}
         */
        (err) => {
            this.loading.close();
            throw err;
        }));
    }
    /**
     * @return {?}
     */
    configTtColumns() {
        this.ttCols = [
            {
                field: 'voName', title: this.localePipe.instant('upstreamBill'), width: 120,
            },
        ];
    }
    /**
     * @return {?}
     */
    configDgColumns() {
        this.dgCols = [
            { field: "code", title: this.localePipe.transform("processCode"), width: 120, sortable: true },
            {
                field: "name", title: this.localePipe.transform("processName"), width: 250, sortable: true,
            },
        ];
    }
    /**
     * @return {?}
     */
    configTtEvents() {
        this.tt.nodeSelected.subscribe((/**
         * @param {?} ctx
         * @return {?}
         */
        (ctx) => {
            //ctx:{inidex;instance;node:{data}}
            if (ctx.node.id == "*") {
                this.dgData = [...this.procData];
            }
            else {
                this.dgData = [...this.procData.filter((/**
                     * @param {?} it
                     * @return {?}
                     */
                    it => it.upBillVoId == ctx.node.data.voId))];
            }
            if (this.dgData && this.dgData.length > 0) {
                this.selectedEntity = this.dgData[0];
                setTimeout((/**
                 * @return {?}
                 */
                () => {
                    this.dg.clearSelections();
                    this.dg.selectRow(this.dgData[0].id);
                }), 0);
            }
        }));
    }
    /**
     * @return {?}
     */
    configDgEvents() {
        this.dg.selectChanged.subscribe((/**
         * @param {?} row
         * @return {?}
         */
        (row) => {
            this.selectedEntity = row.data;
        }));
    }
}
PullSelectorComponent.decorators = [
    { type: Component, args: [{
                selector: 'lib-bif-pull-selector',
                template: "<div class=\"g-main\" style=\"padding-left: 24px; padding-right: 24px;\">\r\n  <div class=\"d-flex flex-row\"\r\n    style=\"height: 100%; width: 100%; border: 1px solid #E9ECF3; box-shadow: 0 2px 6px 0 rgb(31 35 41 / 6%); border-radius: 6px;\">\r\n    <div class=\"d-flex flex-column\" style=\"width: 200px;\" ngResizable rzAspectRatio=\"true\" [rzHandles]=\"'e'\">\r\n      <farris-treetable #tt class=\"f-utils-fill-flex-column\" [data]=\"ttData\" [columns]=\"ttCols\" [idField]=\"ttIdField\"\r\n        [fit]=\"true\" [showHeader]=\"true\" [fixedHeader]=\"true\" [singleSelect]=\"true\">\r\n      </farris-treetable>\r\n    </div>\r\n\r\n    <div class=\"f-utils-fill-flex-row\" style=\"padding-left: 15px;\">\r\n      <div class=\"d-flex flex-column\" style=\"width: 100%;\">\r\n        <div class=\"f-utils-fill-flex-column\">\r\n          <farris-datagrid #dg [fit]=\"true\" [fitColumns]=\"true\" [data]=\"dgData\" [columns]=\"dgCols\" [idField]=\"dgIdField\"\r\n            [showHeader]=\"true\" [showBorder]=\"true\" [striped]=\"true\" [pagination]=\"false\" [showLineNumber]=\"true\">\r\n          </farris-datagrid>\r\n        </div>\r\n        <div class=\"form-group\" style=\"\">\r\n          <div>{{ 'processDesciption' | locale }}</div>\r\n          <textarea readonly class=\"form-control\" name=\"description\" rows=\"3\"\r\n            [ngModel]=\"selectedEntity&&selectedEntity.description\"></textarea>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</div>\r\n",
                styles: [""]
            }] }
];
/** @nocollapse */
PullSelectorComponent.ctorParameters = () => [
    { type: undefined, decorators: [{ type: Inject, args: [SELECTOR_ARGS_INJECTOR,] }] },
    { type: BifDataService },
    { type: String, decorators: [{ type: Inject, args: [LOCALE_ID,] }] },
    { type: LoadingService },
    { type: ElementRef },
    { type: Injector, decorators: [{ type: Optional }] },
    { type: ComponentFactoryResolver, decorators: [{ type: Optional }] },
    { type: MessagerService, decorators: [{ type: Optional }] }
];
PullSelectorComponent.propDecorators = {
    tt: [{ type: ViewChild, args: ['tt',] }],
    dg: [{ type: ViewChild, args: ['dg',] }]
};
if (false) {
    /** @type {?} */
    PullSelectorComponent.prototype.tt;
    /** @type {?} */
    PullSelectorComponent.prototype.ttData;
    /** @type {?} */
    PullSelectorComponent.prototype.ttDataRoot;
    /** @type {?} */
    PullSelectorComponent.prototype.ttCols;
    /** @type {?} */
    PullSelectorComponent.prototype.ttIdField;
    /** @type {?} */
    PullSelectorComponent.prototype.ttSearchFields;
    /** @type {?} */
    PullSelectorComponent.prototype.ttSearchObj;
    /** @type {?} */
    PullSelectorComponent.prototype.dg;
    /** @type {?} */
    PullSelectorComponent.prototype.dgData;
    /** @type {?} */
    PullSelectorComponent.prototype.dgCols;
    /** @type {?} */
    PullSelectorComponent.prototype.dgIdField;
    /** @type {?} */
    PullSelectorComponent.prototype.localePipe;
    /** @type {?} */
    PullSelectorComponent.prototype.procData;
    /** @type {?} */
    PullSelectorComponent.prototype.scene;
    /**
     * 选中的生单流程
     * @type {?}
     */
    PullSelectorComponent.prototype.selectedEntity;
    /** @type {?} */
    PullSelectorComponent.prototype.bsModalRef4BifSelector;
    /** @type {?} */
    PullSelectorComponent.prototype.subject4CreationProcess;
    /**
     * @type {?}
     * @private
     */
    PullSelectorComponent.prototype.args;
    /** @type {?} */
    PullSelectorComponent.prototype.clickOk4BifSelector;
    /** @type {?} */
    PullSelectorComponent.prototype.clickClose4BifSelector;
    /**
     * @type {?}
     * @private
     */
    PullSelectorComponent.prototype.dataService;
    /**
     * @type {?}
     * @private
     */
    PullSelectorComponent.prototype.loading;
    /**
     * @type {?}
     * @private
     */
    PullSelectorComponent.prototype.elementRef;
    /** @type {?} */
    PullSelectorComponent.prototype.inj;
    /** @type {?} */
    PullSelectorComponent.prototype.cfr;
    /** @type {?} */
    PullSelectorComponent.prototype.messagerService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHVsbC1zZWxlY3Rvci5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZWRwLWJpZi9ydW50aW1lLWFwaS8iLCJzb3VyY2VzIjpbImxpYi9iaWYtbWFudWFsLWNyZWF0aW9uL2NvbXBvbmVudHMvcHVsbC1zZWxlY3Rvci9wdWxsLXNlbGVjdG9yLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQVUsTUFBTSxFQUFFLFNBQVMsRUFBRSxVQUFVLEVBQUUsU0FBUyxFQUFFLFFBQVEsRUFBRSx3QkFBd0IsRUFBRSxRQUFRLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFFOUosT0FBTyxFQUFFLE9BQU8sRUFBYyxNQUFNLE1BQU0sQ0FBQztBQUMzQyxPQUFPLEVBQUUsc0JBQXNCLEVBQWdCLE1BQU0sNENBQTRDLENBQUM7QUFDbEcsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLGdDQUFnQyxDQUFDO0FBRWhFLE9BQU8sRUFBRSxzQ0FBc0MsRUFBRSxNQUFNLGtFQUFrRSxDQUFDO0FBRTFILE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQztBQUNwRCxPQUFPLEVBQVksa0JBQWtCLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUNwRSxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUN4RCxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sd0JBQXdCLENBQUM7QUFDcEQsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBT3RELE1BQU0sT0FBTyxxQkFBcUI7Ozs7Ozs7Ozs7O0lBaUNoQyxZQUNrQyxJQUFrQixFQUMxQyxXQUEyQixFQUNoQixRQUFnQixFQUMzQixPQUF1QixFQUN2QixVQUFzQixFQUNYLEdBQWEsRUFDYixHQUE2QixFQUM3QixlQUFnQztRQU4zQyxnQkFBVyxHQUFYLFdBQVcsQ0FBZ0I7UUFFM0IsWUFBTyxH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OztJQUNoRCxnREFBbUQiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIE9uSW5pdCwgSW5qZWN0LCBMT0NBTEVfSUQsIEVsZW1lbnRSZWYsIFZpZXdDaGlsZCwgSW5qZWN0b3IsIENvbXBvbmVudEZhY3RvcnlSZXNvbHZlciwgT3B0aW9uYWwsIFJlZmxlY3RpdmVJbmplY3RvciB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBCc01vZGFsUmVmIH0gZnJvbSAnQGZhcnJpcy91aS1tb2RhbCc7XHJcbmltcG9ydCB7IFN1YmplY3QsIE9ic2VydmFibGUgfSBmcm9tICdyeGpzJztcclxuaW1wb3J0IHsgU0VMRUNUT1JfQVJHU19JTkpFQ1RPUiwgU2VsZWN0b3JBcmdzIH0gZnJvbSAnLi4vLi4vY29uZmlnL3NlbGVjdG9yLWFyZ3MtaW5qZWN0b3IuY29uZmlnJztcclxuaW1wb3J0IHsgQmlmRGF0YVNlcnZpY2UgfSBmcm9tICcuLi8uLi9zZXJ2aWNlL2JpZi1kYXRhLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBJUnRTbGltQmlsbENyZWF0aW9uUHJvY2Vzc0VudGl0eUV4IH0gZnJvbSAnQGVkcC1iaWYvY29tbW9uLWFwaSc7XHJcbmltcG9ydCB7IEZvcm1HZXRCaWxsQ3JlYXRpb25Qcm9jZXNzRW50aXR5RXhBcmdzIH0gZnJvbSAnLi4vLi4vLi4vZW50aXR5L2Zvcm0tcmVzdC9Gb3JtR2V0QmlsbENyZWF0aW9uUHJvY2Vzc0VudGl0eUV4QXJncyc7XHJcbmltcG9ydCB7IElCaWZDcmVhdGlvblByb2Nlc3NTZWxlY3RvckNvbXBvbmVudCB9IGZyb20gJy4uLy4uL2Jhc2UvSUJpZkNyZWF0aW9uUHJvY2Vzc1NlbGVjdG9yQ29tcG9uZW50JztcclxuaW1wb3J0IHsgTG9hZGluZ1NlcnZpY2UgfSBmcm9tICdAZmFycmlzL3VpLWxvYWRpbmcnO1xyXG5pbXBvcnQgeyBUcmVlTm9kZSwgVHJlZVRhYmxlQ29tcG9uZW50IH0gZnJvbSAnQGZhcnJpcy91aS10cmVldGFibGUnO1xyXG5pbXBvcnQgeyBEYXRhZ3JpZENvbXBvbmVudCB9IGZyb20gJ0BmYXJyaXMvdWktZGF0YWdyaWQnO1xyXG5pbXBvcnQgeyBMb2NhbGVQaXBlIH0gZnJvbSAnLi4vLi4vcGlwZS9sb2NhbGUucGlwZSc7XHJcbmltcG9ydCB7IE1lc3NhZ2VyU2VydmljZSB9IGZyb20gJ0BmYXJyaXMvdWktbWVzc2FnZXInO1xyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgc2VsZWN0b3I6ICdsaWItYmlmLXB1bGwtc2VsZWN0b3InLFxyXG4gIHRlbXBsYXRlVXJsOiAnLi9wdWxsLXNlbGVjdG9yLmNvbXBvbmVudC5odG1sJyxcclxuICBzdHlsZVVybHM6IFsnLi9wdWxsLXNlbGVjdG9yLmNvbXBvbmVudC5jc3MnXVxyXG59KVxyXG5leHBvcnQgY2xhc3MgUHVsbFNlbGVjdG9yQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBJQmlmQ3JlYXRpb25Qcm9jZXNzU2VsZWN0b3JDb21wb25lbnQge1xyXG4gIEBWaWV3Q2hpbGQoJ3R0JylcclxuICB0dDogVHJlZVRhYmxlQ29tcG9uZW50O1xyXG4gIHR0RGF0YTogVHJlZU5vZGVbXSA9IFtdO1xyXG4gIHR0RGF0YVJvb3Q6IFRyZWVOb2RlO1xyXG4gIHR0Q29sczogYW55W107XHJcbiAgdHRJZEZpZWxkID0gJ3ZvSWQnO1xyXG4gIHR0U2VhcmNoRmllbGRzOiB7XHJcbiAgICBsYWJlbDogc3RyaW5nO1xyXG4gICAgdmFsdWU6IHN0cmluZztcclxuICB9W10gPSBbXTtcclxuICB0dFNlYXJjaE9iajogeyBmaWVsZDogc3RyaW5nLCB2YWx1ZTogc3RyaW5nIH07XHJcblxyXG4gIEBWaWV3Q2hpbGQoJ2RnJylcclxuICBkZzogRGF0YWdyaWRDb21wb25lbnQ7XHJcbiAgZGdEYXRhOiBhbnlbXSA9IFtdO1xyXG4gIGRnQ29sczogYW55W107XHJcbiAgZGdJZEZpZWxkID0gJ2lkJztcclxuICBsb2NhbGVQaXBlOiBMb2NhbGVQaXBlO1xyXG5cclxuICBwcm9jRGF0YTogSVJ0U2xpbUJpbGxDcmVhdGlvblByb2Nlc3NFbnRpdHlFeFtdID0gW107XHJcblxyXG4gIHNjZW5lOiBcIlB1c2hcIiB8IFwiUHVsbFwiID0gXCJQdWxsXCI7XHJcblxyXG4gIC8qKlxyXG4gICAqIOmAieS4reeahOeUn+WNlea1geeoi1xyXG4gICAqL1xyXG4gIHNlbGVjdGVkRW50aXR5OiBJUnRTbGltQmlsbENyZWF0aW9uUHJvY2Vzc0VudGl0eUV4O1xyXG5cclxuICBic01vZGFsUmVmNEJpZlNlbGVjdG9yOiBCc01vZGFsUmVmID0gbnVsbDtcclxuICBzdWJqZWN0NENyZWF0aW9uUHJvY2VzczogU3ViamVjdDxJUnRTbGltQmlsbENyZWF0aW9uUHJvY2Vzc0VudGl0eUV4PiA9IG5ldyBTdWJqZWN0KCk7XHJcblxyXG4gIHByaXZhdGUgYXJnczogRm9ybUdldEJpbGxDcmVhdGlvblByb2Nlc3NFbnRpdHlFeEFyZ3M7XHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICBASW5qZWN0KFNFTEVDVE9SX0FSR1NfSU5KRUNUT1IpIGFyZ3M6IFNlbGVjdG9yQXJncyxcclxuICAgIHByaXZhdGUgZGF0YVNlcnZpY2U6IEJpZkRhdGFTZXJ2aWNlLFxyXG4gICAgQEluamVjdChMT0NBTEVfSUQpIGxvY2FsZUlkOiBzdHJpbmcsXHJcbiAgICBwcml2YXRlIGxvYWRpbmc6IExvYWRpbmdTZXJ2aWNlLFxyXG4gICAgcHJpdmF0ZSBlbGVtZW50UmVmOiBFbGVtZW50UmVmLFxyXG4gICAgQE9wdGlvbmFsKCkgcHVibGljIGluajogSW5qZWN0b3IsXHJcbiAgICBAT3B0aW9uYWwoKSBwdWJsaWMgY2ZyOiBDb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIsXHJcbiAgICBAT3B0aW9uYWwoKSBwdWJsaWMgbWVzc2FnZXJTZXJ2aWNlOiBNZXNzYWdlclNlcnZpY2UsXHJcbiAgKSB7XHJcbiAgICB0aGlzLmFyZ3MgPSBuZXcgRm9ybUdldEJpbGxDcmVhdGlvblByb2Nlc3NFbnRpdHlFeEFyZ3MoKTtcclxuICAgIHRoaXMuYXJncy5Mb2FkRnJvbUpzb25PYmplY3QoYXJncyk7XHJcbiAgICB0aGlzLmxvY2FsZVBpcGUgPSBuZXcgTG9jYWxlUGlwZShsb2NhbGVJZCk7XHJcblxyXG4gICAgaWYgKGluaiA9PSBudWxsKSB7XHJcbiAgICAgIGNvbnN0IHJlZkluaiA9IFJlZmxlY3RpdmVJbmplY3Rvci5yZXNvbHZlQW5kQ3JlYXRlKFtcclxuICAgICAgICBNZXNzYWdlclNlcnZpY2UsXHJcbiAgICAgIF0pO1xyXG4gICAgICB0aGlzLmluaiA9IHJlZkluajtcclxuICAgIH1cclxuICAgIHRoaXMuY2ZyID0gY2ZyIHx8IHRoaXMuaW5qLmdldChDb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIpO1xyXG4gICAgdGhpcy5tZXNzYWdlclNlcnZpY2UgPSBtZXNzYWdlclNlcnZpY2UgfHwgdGhpcy5pbmouZ2V0KE1lc3NhZ2VyU2VydmljZSwgbnVsbCk7XHJcbiAgfVxyXG5cclxuICBuZ09uSW5pdCgpIHtcclxuICAgIHRoaXMudHREYXRhUm9vdCA9IHtcclxuICAgICAgaWQ6IFwiKlwiLFxyXG4gICAgICBkYXRhOiB7XHJcbiAgICAgICAgdm9JZDogXCIqXCIsXHJcbiAgICAgICAgdm9OYW1lOiB0aGlzLmxvY2FsZVBpcGUuaW5zdGFudChcImFsbFwiKSxcclxuICAgICAgfSxcclxuICAgICAgcGFyZW50OiBudWxsLFxyXG4gICAgICBleHBhbmRlZDogdHJ1ZSxcclxuICAgICAgY2hpbGRyZW46IFtdLFxyXG4gICAgfTtcclxuICAgIHRoaXMudHREYXRhID0gW3RoaXMudHREYXRhUm9vdF07XHJcbiAgICB0aGlzLmNvbmZpZ1R0Q29sdW1ucygpO1xyXG4gICAgdGhpcy5jb25maWdEZ0NvbHVtbnMoKTtcclxuICAgIHRoaXMuY29uZmlnVHRFdmVudHMoKTtcclxuICAgIHRoaXMuY29uZmlnRGdFdmVudHMoKTtcclxuICAgIHRoaXMubG9hZEl0ZW1zKCk7XHJcbiAgfVxyXG5cclxuICBjbGlja09rNEJpZlNlbGVjdG9yID0gKCkgPT4ge1xyXG4gICAgaWYgKHRoaXMuc2VsZWN0ZWRFbnRpdHkgPT0gbnVsbCkge1xyXG4gICAgICB0aGlzLm1lc3NhZ2VyU2VydmljZS5lcnJvcih0aGlzLmxvY2FsZVBpcGUuaW5zdGFudChcInBsZWFzZVNlbGVjdE9uZUNyZWF0aW9uUHJvY2Vzc1wiKSk7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIHRoaXMuc3ViamVjdDRDcmVhdGlvblByb2Nlc3MubmV4dCh0aGlzLnNlbGVjdGVkRW50aXR5KTtcclxuICAgIHRoaXMuc3ViamVjdDRDcmVhdGlvblByb2Nlc3MuY29tcGxldGUoKTtcclxuICAgIHRoaXMuYnNNb2RhbFJlZjRCaWZTZWxlY3Rvci5jbG9zZSgpO1xyXG4gIH07XHJcblxyXG4gIGNsaWNrQ2xvc2U0QmlmU2VsZWN0b3IgPSAoKSA9PiB7XHJcbiAgICB0aGlzLmJzTW9kYWxSZWY0QmlmU2VsZWN0b3IuY2xvc2UoKTtcclxuICB9O1xyXG5cclxuICBwcml2YXRlIGxvYWRJdGVtcygpOiB2b2lkIHtcclxuICAgIHRoaXMubG9hZGluZy5zaG93KHsgY29udGFpbmVyOiB0aGlzLmVsZW1lbnRSZWYgfSk7XHJcbiAgICBsZXQgbGlzdCQ6IE9ic2VydmFibGU8SVJ0U2xpbUJpbGxDcmVhdGlvblByb2Nlc3NFbnRpdHlFeFtdPiA9IG51bGw7XHJcbiAgICBpZiAodGhpcy5hcmdzLnVwQmlsbFZvSWQgPT0gbnVsbCkge1xyXG4gICAgICBsaXN0JCA9IHRoaXMuZGF0YVNlcnZpY2UuZ2V0U2xpbUJpbGxDcmVhdGlvblByb2Nlc3NFbnRpdHlFeGVzQnlEb3duQmlsbFZvSWQ0UHVsbCh0aGlzLmFyZ3MuZG93bkJpbGxWb0lkKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGxpc3QkID0gdGhpcy5kYXRhU2VydmljZS5nZXRTbGltQmlsbENyZWF0aW9uUHJvY2Vzc0VudGl0eUV4ZXNCeVVwQmlsbFZvSWRBbmREb3duQmlsbFZvSWQ0U3BlY2lmaWNQdWxsKHRoaXMuYXJncy51cEJpbGxWb0lkLCB0aGlzLmFyZ3MuZG93bkJpbGxWb0lkKTtcclxuICAgIH1cclxuICAgIGxpc3QkLnN1YnNjcmliZShcclxuICAgICAgKHJlc3VsdDogSVJ0U2xpbUJpbGxDcmVhdGlvblByb2Nlc3NFbnRpdHlFeFtdKSA9PiB7XHJcbiAgICAgICAgdGhpcy5sb2FkaW5nLmNsb3NlKCk7XHJcblxyXG4gICAgICAgIHRoaXMucHJvY0RhdGEgPSByZXN1bHQgfHwgW107XHJcbiAgICAgICAgdGhpcy5kZ0RhdGEgPSBbLi4udGhpcy5wcm9jRGF0YV07XHJcblxyXG4gICAgICAgIC8vIOe7hOe7h1ZP5qCRXHJcbiAgICAgICAgY29uc3Qgdm9MaXN0OiB7XHJcbiAgICAgICAgICB2b0lkOiBzdHJpbmcsXHJcbiAgICAgICAgICB2b05hbWU6IHN0cmluZyxcclxuICAgICAgICB9W10gPSBbXTtcclxuICAgICAgICB0aGlzLnByb2NEYXRhLmZvckVhY2goaXQgPT4ge1xyXG4gICAgICAgICAgaWYgKHZvTGlzdC5zb21lKHZvID0+IHZvLnZvSWQgPT0gaXQudXBCaWxsVm9JZCkgPT0gZmFsc2UpIHtcclxuICAgICAgICAgICAgdm9MaXN0LnB1c2goe1xyXG4gICAgICAgICAgICAgIHZvSWQ6IGl0LnVwQmlsbFZvSWQsXHJcbiAgICAgICAgICAgICAgdm9OYW1lOiBpdC51cEJpbGxWb05hbWUsXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHRoaXMudHREYXRhUm9vdC5jaGlsZHJlbiA9IHZvTGlzdC5tYXAoaXQgPT4ge1xyXG4gICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgaWQ6IGl0LnZvSWQsXHJcbiAgICAgICAgICAgIGRhdGE6IHtcclxuICAgICAgICAgICAgICB2b0lkOiBpdC52b0lkLFxyXG4gICAgICAgICAgICAgIHZvTmFtZTogaXQudm9OYW1lLFxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBleHBhbmRlZDogdHJ1ZSxcclxuICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICB0aGlzLnR0RGF0YSA9IFt0aGlzLnR0RGF0YVJvb3RdO1xyXG5cclxuICAgICAgICAvLyDpu5jorqTpgInkuK3nrKzkuIDmnaFcclxuICAgICAgICBpZiAodGhpcy5kZ0RhdGEgJiYgdGhpcy5kZ0RhdGEubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgdGhpcy5zZWxlY3RlZEVudGl0eSA9IHRoaXMuZGdEYXRhWzBdO1xyXG4gICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuZGcuY2xlYXJTZWxlY3Rpb25zKCk7XHJcbiAgICAgICAgICAgIHRoaXMuZGcuc2VsZWN0Um93KHRoaXMuZGdEYXRhWzBdLmlkKTtcclxuICAgICAgICAgIH0sIDApO1xyXG4gICAgICAgIH1cclxuICAgICAgfSxcclxuICAgICAgKGVycikgPT4ge1xyXG4gICAgICAgIHRoaXMubG9hZGluZy5jbG9zZSgpO1xyXG4gICAgICAgIHRocm93IGVycjtcclxuICAgICAgfVxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIGNvbmZpZ1R0Q29sdW1ucygpIHtcclxuICAgIHRoaXMudHRDb2xzID0gW1xyXG4gICAgICB7XHJcbiAgICAgICAgZmllbGQ6ICd2b05hbWUnLCB0aXRsZTogdGhpcy5sb2NhbGVQaXBlLmluc3RhbnQoJ3Vwc3RyZWFtQmlsbCcpLCB3aWR0aDogMTIwLFxyXG4gICAgICB9LFxyXG4gICAgXTtcclxuICB9XHJcblxyXG4gIGNvbmZpZ0RnQ29sdW1ucygpIHtcclxuICAgIHRoaXMuZGdDb2xzID0gW1xyXG4gICAgICB7IGZpZWxkOiBcImNvZGVcIiwgdGl0bGU6IHRoaXMubG9jYWxlUGlwZS50cmFuc2Zvcm0oXCJwcm9jZXNzQ29kZVwiKSwgd2lkdGg6IDEyMCwgc29ydGFibGU6IHRydWUgfSxcclxuICAgICAge1xyXG4gICAgICAgIGZpZWxkOiBcIm5hbWVcIiwgdGl0bGU6IHRoaXMubG9jYWxlUGlwZS50cmFuc2Zvcm0oXCJwcm9jZXNzTmFtZVwiKSwgd2lkdGg6IDI1MCwgc29ydGFibGU6IHRydWUsXHJcbiAgICAgIH0sXHJcbiAgICBdO1xyXG4gIH1cclxuXHJcbiAgY29uZmlnVHRFdmVudHMoKSB7XHJcbiAgICB0aGlzLnR0Lm5vZGVTZWxlY3RlZC5zdWJzY3JpYmUoKGN0eCkgPT4ge1xyXG4gICAgICAvL2N0eDp7aW5pZGV4O2luc3RhbmNlO25vZGU6e2RhdGF9fVxyXG4gICAgICBpZiAoY3R4Lm5vZGUuaWQgPT0gXCIqXCIpIHtcclxuICAgICAgICB0aGlzLmRnRGF0YSA9IFsuLi50aGlzLnByb2NEYXRhXTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICB0aGlzLmRnRGF0YSA9IFsuLi50aGlzLnByb2NEYXRhLmZpbHRlcihpdCA9PiBpdC51cEJpbGxWb0lkID09IGN0eC5ub2RlLmRhdGEudm9JZCldO1xyXG4gICAgICB9XHJcbiAgICAgIGlmICh0aGlzLmRnRGF0YSAmJiB0aGlzLmRnRGF0YS5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgdGhpcy5zZWxlY3RlZEVudGl0eSA9IHRoaXMuZGdEYXRhWzBdO1xyXG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgdGhpcy5kZy5jbGVhclNlbGVjdGlvbnMoKTtcclxuICAgICAgICAgIHRoaXMuZGcuc2VsZWN0Um93KHRoaXMuZGdEYXRhWzBdLmlkKTtcclxuICAgICAgICB9LCAwKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBjb25maWdEZ0V2ZW50cygpIHtcclxuICAgIHRoaXMuZGcuc2VsZWN0Q2hhbmdlZC5zdWJzY3JpYmUoKHJvdykgPT4ge1xyXG4gICAgICB0aGlzLnNlbGVjdGVkRW50aXR5ID0gcm93LmRhdGE7XHJcbiAgICB9KTtcclxuICB9XHJcbn1cclxuIl19
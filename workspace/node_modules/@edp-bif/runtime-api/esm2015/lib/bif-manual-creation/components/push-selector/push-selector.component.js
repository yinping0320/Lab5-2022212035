/**
 * @fileoverview added by tsickle
 * Generated from: lib/bif-manual-creation/components/push-selector/push-selector.component.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Inject, LOCALE_ID, ElementRef, ViewChild, Optional, Injector, ComponentFactoryResolver, ReflectiveInjector } from '@angular/core';
import { Subject } from 'rxjs';
import { SELECTOR_ARGS_INJECTOR } from '../../config/selector-args-injector.config';
import { FormGetBillCreationProcessEntityExArgs } from '../../../entity/form-rest/FormGetBillCreationProcessEntityExArgs';
import { BifDataService } from '../../service/bif-data.service';
import { LoadingService } from '@farris/ui-loading';
import { TreeTableComponent } from '@farris/ui-treetable';
import { DatagridComponent } from '@farris/ui-datagrid';
import { LocalePipe } from '../../pipe/locale.pipe';
import { MessagerService } from '@farris/ui-messager';
export class PushSelectorComponent {
    /**
     * @param {?} args
     * @param {?} dataService
     * @param {?} localeId
     * @param {?} loading
     * @param {?} elementRef
     * @param {?} inj
     * @param {?} cfr
     * @param {?} messagerService
     */
    constructor(args, dataService, localeId, loading, elementRef, inj, cfr, messagerService) {
        this.dataService = dataService;
        this.loading = loading;
        this.elementRef = elementRef;
        this.inj = inj;
        this.cfr = cfr;
        this.messagerService = messagerService;
        this.ttData = [];
        this.ttIdField = 'voId';
        this.ttSearchFields = [];
        this.dgData = [];
        this.dgIdField = 'id';
        this.procData = [];
        this.bsModalRef4BifSelector = null;
        this.subject4CreationProcess = new Subject();
        this.clickOk4BifSelector = (/**
         * @return {?}
         */
        () => {
            if (this.selectedEntity == null) {
                this.messagerService.error(this.localePipe.instant("pleaseSelectOneCreationProcess"));
                return;
            }
            this.subject4CreationProcess.next(this.selectedEntity);
            this.subject4CreationProcess.complete();
            this.bsModalRef4BifSelector.close();
        });
        this.clickClose4BifSelector = (/**
         * @return {?}
         */
        () => {
            this.bsModalRef4BifSelector.close();
        });
        this.args = new FormGetBillCreationProcessEntityExArgs();
        this.args.LoadFromJsonObject(args);
        this.localePipe = new LocalePipe(localeId);
        if (inj == null) {
            /** @type {?} */
            const refInj = ReflectiveInjector.resolveAndCreate([
                MessagerService,
            ]);
            this.inj = refInj;
        }
        this.cfr = cfr || this.inj.get(ComponentFactoryResolver);
        this.messagerService = messagerService || this.inj.get(MessagerService, null);
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.ttDataRoot = {
            id: "*",
            data: {
                voId: "*",
                voName: this.localePipe.instant("all"),
            },
            parent: null,
            expanded: true,
            children: [],
        };
        this.ttData = [this.ttDataRoot];
        this.configTtColumns();
        this.configDgColumns();
        this.configTtEvents();
        this.configDgEvents();
        this.loadItems();
    }
    /**
     * @private
     * @return {?}
     */
    loadItems() {
        this.loading.show({ container: this.elementRef });
        /** @type {?} */
        let list$ = null;
        if (this.args.downBillVoId == null) {
            list$ = this.dataService.getSlimBillCreationProcessEntityExesByUpBillVoId4Push(this.args.upBillVoId);
        }
        else {
            list$ = this.dataService.getSlimBillCreationProcessEntityExesByUpBillVoIdAndDownBillVoId4SpecificPush(this.args.upBillVoId, this.args.downBillVoId);
        }
        list$.subscribe((/**
         * @param {?} result
         * @return {?}
         */
        (result) => {
            this.loading.close();
            this.procData = result || [];
            this.dgData = [...this.procData];
            // 组织VO树
            /** @type {?} */
            const voList = [];
            this.procData.forEach((/**
             * @param {?} it
             * @return {?}
             */
            it => {
                if (voList.some((/**
                 * @param {?} vo
                 * @return {?}
                 */
                vo => vo.voId == it.downBillVoId)) == false) {
                    voList.push({
                        voId: it.downBillVoId,
                        voName: it.downBillVoName,
                    });
                }
            }));
            this.ttDataRoot.children = voList.map((/**
             * @param {?} it
             * @return {?}
             */
            it => {
                return {
                    id: it.voId,
                    data: {
                        voId: it.voId,
                        voName: it.voName,
                    },
                    expanded: true,
                };
            }));
            this.ttData = [this.ttDataRoot];
            // 默认选中第一条
            if (this.dgData && this.dgData.length > 0) {
                this.selectedEntity = this.dgData[0];
                setTimeout((/**
                 * @return {?}
                 */
                () => {
                    this.dg.clearSelections();
                    this.dg.selectRow(this.dgData[0].id);
                }), 0);
            }
        }), (/**
         * @param {?} err
         * @return {?}
         */
        (err) => {
            this.loading.close();
            throw err;
        }));
    }
    /**
     * @return {?}
     */
    configTtColumns() {
        this.ttCols = [
            {
                field: 'voName', title: this.localePipe.instant('downstreamBill'), width: 120,
            },
        ];
    }
    /**
     * @return {?}
     */
    configDgColumns() {
        this.dgCols = [
            { field: "code", title: this.localePipe.transform("processCode"), width: 120, sortable: true },
            {
                field: "name", title: this.localePipe.transform("processName"), width: 250, sortable: true,
            },
        ];
    }
    /**
     * @return {?}
     */
    configTtEvents() {
        this.tt.nodeSelected.subscribe((/**
         * @param {?} ctx
         * @return {?}
         */
        (ctx) => {
            //ctx:{inidex;instance;node:{data}}
            if (ctx.node.id == "*") {
                this.dgData = [...this.procData];
            }
            else {
                this.dgData = [...this.procData.filter((/**
                     * @param {?} it
                     * @return {?}
                     */
                    it => it.downBillVoId == ctx.node.data.voId))];
            }
            if (this.dgData && this.dgData.length > 0) {
                this.selectedEntity = this.dgData[0];
                setTimeout((/**
                 * @return {?}
                 */
                () => {
                    this.dg.clearSelections();
                    this.dg.selectRow(this.dgData[0].id);
                }), 0);
            }
        }));
    }
    /**
     * @return {?}
     */
    configDgEvents() {
        this.dg.selectChanged.subscribe((/**
         * @param {?} row
         * @return {?}
         */
        (row) => {
            this.selectedEntity = row.data;
        }));
    }
}
PushSelectorComponent.decorators = [
    { type: Component, args: [{
                selector: 'lib-bif-push-selector',
                template: "<div class=\"g-main\" style=\"padding-left: 24px; padding-right: 24px;\">\r\n  <div class=\"d-flex flex-row\"\r\n    style=\"height: 100%; width: 100%; border: 1px solid #E9ECF3; box-shadow: 0 2px 6px 0 rgb(31 35 41 / 6%); border-radius: 6px;\">\r\n    <div class=\"d-flex flex-column\" style=\"width: 200px;\" ngResizable rzAspectRatio=\"true\" [rzHandles]=\"'e'\">\r\n      <farris-treetable #tt class=\"f-utils-fill-flex-column\" [data]=\"ttData\" [columns]=\"ttCols\" [idField]=\"ttIdField\"\r\n        [fit]=\"true\" [showHeader]=\"true\" [fixedHeader]=\"true\" [singleSelect]=\"true\">\r\n      </farris-treetable>\r\n    </div>\r\n\r\n    <div class=\"f-utils-fill-flex-row\" style=\"padding-left: 15px;\">\r\n      <div class=\"d-flex flex-column\" style=\"width: 100%;\">\r\n        <div class=\"f-utils-fill-flex-column\">\r\n          <farris-datagrid #dg [fit]=\"true\" [fitColumns]=\"true\" [data]=\"dgData\" [columns]=\"dgCols\" [idField]=\"dgIdField\"\r\n            [showHeader]=\"true\" [showBorder]=\"true\" [striped]=\"true\" [pagination]=\"false\" [showLineNumber]=\"true\">\r\n          </farris-datagrid>\r\n        </div>\r\n        <div class=\"form-group\" style=\"\">\r\n          <div>{{ 'processDesciption' | locale }}</div>\r\n          <textarea readonly class=\"form-control\" name=\"description\" rows=\"3\"\r\n            [ngModel]=\"selectedEntity&&selectedEntity.description\"></textarea>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</div>\r\n",
                styles: [""]
            }] }
];
/** @nocollapse */
PushSelectorComponent.ctorParameters = () => [
    { type: undefined, decorators: [{ type: Inject, args: [SELECTOR_ARGS_INJECTOR,] }] },
    { type: BifDataService },
    { type: String, decorators: [{ type: Inject, args: [LOCALE_ID,] }] },
    { type: LoadingService },
    { type: ElementRef },
    { type: Injector, decorators: [{ type: Optional }] },
    { type: ComponentFactoryResolver, decorators: [{ type: Optional }] },
    { type: MessagerService, decorators: [{ type: Optional }] }
];
PushSelectorComponent.propDecorators = {
    tt: [{ type: ViewChild, args: ['tt',] }],
    dg: [{ type: ViewChild, args: ['dg',] }]
};
if (false) {
    /** @type {?} */
    PushSelectorComponent.prototype.tt;
    /** @type {?} */
    PushSelectorComponent.prototype.ttData;
    /** @type {?} */
    PushSelectorComponent.prototype.ttDataRoot;
    /** @type {?} */
    PushSelectorComponent.prototype.ttCols;
    /** @type {?} */
    PushSelectorComponent.prototype.ttIdField;
    /** @type {?} */
    PushSelectorComponent.prototype.ttSearchFields;
    /** @type {?} */
    PushSelectorComponent.prototype.ttSearchObj;
    /** @type {?} */
    PushSelectorComponent.prototype.dg;
    /** @type {?} */
    PushSelectorComponent.prototype.dgData;
    /** @type {?} */
    PushSelectorComponent.prototype.dgCols;
    /** @type {?} */
    PushSelectorComponent.prototype.dgIdField;
    /** @type {?} */
    PushSelectorComponent.prototype.localePipe;
    /** @type {?} */
    PushSelectorComponent.prototype.procData;
    /**
     * 选中的生单流程
     * @type {?}
     */
    PushSelectorComponent.prototype.selectedEntity;
    /** @type {?} */
    PushSelectorComponent.prototype.bsModalRef4BifSelector;
    /** @type {?} */
    PushSelectorComponent.prototype.subject4CreationProcess;
    /**
     * @type {?}
     * @private
     */
    PushSelectorComponent.prototype.args;
    /** @type {?} */
    PushSelectorComponent.prototype.clickOk4BifSelector;
    /** @type {?} */
    PushSelectorComponent.prototype.clickClose4BifSelector;
    /**
     * @type {?}
     * @private
     */
    PushSelectorComponent.prototype.dataService;
    /**
     * @type {?}
     * @private
     */
    PushSelectorComponent.prototype.loading;
    /**
     * @type {?}
     * @private
     */
    PushSelectorComponent.prototype.elementRef;
    /** @type {?} */
    PushSelectorComponent.prototype.inj;
    /** @type {?} */
    PushSelectorComponent.prototype.cfr;
    /** @type {?} */
    PushSelectorComponent.prototype.messagerService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHVzaC1zZWxlY3Rvci5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZWRwLWJpZi9ydW50aW1lLWFwaS8iLCJzb3VyY2VzIjpbImxpYi9iaWYtbWFudWFsLWNyZWF0aW9uL2NvbXBvbmVudHMvcHVzaC1zZWxlY3Rvci9wdXNoLXNlbGVjdG9yLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQVUsTUFBTSxFQUFFLFNBQVMsRUFBRSxVQUFVLEVBQUUsU0FBUyxFQUFFLFFBQVEsRUFBRSxRQUFRLEVBQUUsd0JBQXdCLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDOUosT0FBTyxFQUFFLE9BQU8sRUFBYyxNQUFNLE1BQU0sQ0FBQztBQUUzQyxPQUFPLEVBQUUsc0JBQXNCLEVBQWdCLE1BQU0sNENBQTRDLENBQUM7QUFFbEcsT0FBTyxFQUFFLHNDQUFzQyxFQUFFLE1BQU0sa0VBQWtFLENBQUM7QUFDMUgsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLGdDQUFnQyxDQUFDO0FBRWhFLE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQztBQUNwRCxPQUFPLEVBQVksa0JBQWtCLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUNwRSxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUN4RCxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sd0JBQXdCLENBQUM7QUFDcEQsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBT3RELE1BQU0sT0FBTyxxQkFBcUI7Ozs7Ozs7Ozs7O0lBK0JoQyxZQUNrQyxJQUFrQixFQUMxQyxXQUEyQixFQUNoQixRQUFnQixFQUMzQixPQUF1QixFQUN2QixVQUFzQixFQUNYLEdBQWEsRUFDYixHQUE2QixFQUM3QixlQUFnQztRQU4zQyxnQkFBVyxHQUFYLFdBQVcsQ0FBZ0I7UUFFM0IsWUFBTyxH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b3J0IHsgQ29tcG9uZW50LCBPbkluaXQsIEluamVjdCwgTE9DQUxFX0lELCBFbGVtZW50UmVmLCBWaWV3Q2hpbGQsIE9wdGlvbmFsLCBJbmplY3RvciwgQ29tcG9uZW50RmFjdG9yeVJlc29sdmVyLCBSZWZsZWN0aXZlSW5qZWN0b3IgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgU3ViamVjdCwgT2JzZXJ2YWJsZSB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQgeyBCc01vZGFsUmVmIH0gZnJvbSAnQGZhcnJpcy91aS1tb2RhbCc7XHJcbmltcG9ydCB7IFNFTEVDVE9SX0FSR1NfSU5KRUNUT1IsIFNlbGVjdG9yQXJncyB9IGZyb20gJy4uLy4uL2NvbmZpZy9zZWxlY3Rvci1hcmdzLWluamVjdG9yLmNvbmZpZyc7XHJcbmltcG9ydCB7IElSdFNsaW1CaWxsQ3JlYXRpb25Qcm9jZXNzRW50aXR5RXggfSBmcm9tICdAZWRwLWJpZi9jb21tb24tYXBpJztcclxuaW1wb3J0IHsgRm9ybUdldEJpbGxDcmVhdGlvblByb2Nlc3NFbnRpdHlFeEFyZ3MgfSBmcm9tICcuLi8uLi8uLi9lbnRpdHkvZm9ybS1yZXN0L0Zvcm1HZXRCaWxsQ3JlYXRpb25Qcm9jZXNzRW50aXR5RXhBcmdzJztcclxuaW1wb3J0IHsgQmlmRGF0YVNlcnZpY2UgfSBmcm9tICcuLi8uLi9zZXJ2aWNlL2JpZi1kYXRhLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBJQmlmQ3JlYXRpb25Qcm9jZXNzU2VsZWN0b3JDb21wb25lbnQgfSBmcm9tICcuLi8uLi9iYXNlL0lCaWZDcmVhdGlvblByb2Nlc3NTZWxlY3RvckNvbXBvbmVudCc7XHJcbmltcG9ydCB7IExvYWRpbmdTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy91aS1sb2FkaW5nJztcclxuaW1wb3J0IHsgVHJlZU5vZGUsIFRyZWVUYWJsZUNvbXBvbmVudCB9IGZyb20gJ0BmYXJyaXMvdWktdHJlZXRhYmxlJztcclxuaW1wb3J0IHsgRGF0YWdyaWRDb21wb25lbnQgfSBmcm9tICdAZmFycmlzL3VpLWRhdGFncmlkJztcclxuaW1wb3J0IHsgTG9jYWxlUGlwZSB9IGZyb20gJy4uLy4uL3BpcGUvbG9jYWxlLnBpcGUnO1xyXG5pbXBvcnQgeyBNZXNzYWdlclNlcnZpY2UgfSBmcm9tICdAZmFycmlzL3VpLW1lc3NhZ2VyJztcclxuXHJcbkBDb21wb25lbnQoe1xyXG4gIHNlbGVjdG9yOiAnbGliLWJpZi1wdXNoLXNlbGVjdG9yJyxcclxuICB0ZW1wbGF0ZVVybDogJy4vcHVzaC1zZWxlY3Rvci5jb21wb25lbnQuaHRtbCcsXHJcbiAgc3R5bGVVcmxzOiBbJy4vcHVzaC1zZWxlY3Rvci5jb21wb25lbnQuY3NzJ10sXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBQdXNoU2VsZWN0b3JDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIElCaWZDcmVhdGlvblByb2Nlc3NTZWxlY3RvckNvbXBvbmVudCB7XHJcbiAgQFZpZXdDaGlsZCgndHQnKVxyXG4gIHR0OiBUcmVlVGFibGVDb21wb25lbnQ7XHJcbiAgdHREYXRhOiBUcmVlTm9kZVtdID0gW107XHJcbiAgdHREYXRhUm9vdDogVHJlZU5vZGU7XHJcbiAgdHRDb2xzOiBhbnlbXTtcclxuICB0dElkRmllbGQgPSAndm9JZCc7XHJcbiAgdHRTZWFyY2hGaWVsZHM6IHtcclxuICAgIGxhYmVsOiBzdHJpbmc7XHJcbiAgICB2YWx1ZTogc3RyaW5nO1xyXG4gIH1bXSA9IFtdO1xyXG4gIHR0U2VhcmNoT2JqOiB7IGZpZWxkOiBzdHJpbmcsIHZhbHVlOiBzdHJpbmcgfTtcclxuXHJcbiAgQFZpZXdDaGlsZCgnZGcnKVxyXG4gIGRnOiBEYXRhZ3JpZENvbXBvbmVudDtcclxuICBkZ0RhdGE6IGFueVtdID0gW107XHJcbiAgZGdDb2xzOiBhbnlbXTtcclxuICBkZ0lkRmllbGQgPSAnaWQnO1xyXG4gIGxvY2FsZVBpcGU6IExvY2FsZVBpcGU7XHJcblxyXG4gIHByb2NEYXRhOiBJUnRTbGltQmlsbENyZWF0aW9uUHJvY2Vzc0VudGl0eUV4W10gPSBbXTtcclxuXHJcbiAgLyoqXHJcbiAgICog6YCJ5Lit55qE55Sf5Y2V5rWB56iLXHJcbiAgICovXHJcbiAgc2VsZWN0ZWRFbnRpdHk6IElSdFNsaW1CaWxsQ3JlYXRpb25Qcm9jZXNzRW50aXR5RXg7XHJcblxyXG4gIGJzTW9kYWxSZWY0QmlmU2VsZWN0b3I6IEJzTW9kYWxSZWYgPSBudWxsO1xyXG4gIHN1YmplY3Q0Q3JlYXRpb25Qcm9jZXNzOiBTdWJqZWN0PElSdFNsaW1CaWxsQ3JlYXRpb25Qcm9jZXNzRW50aXR5RXg+ID0gbmV3IFN1YmplY3QoKTtcclxuXHJcbiAgcHJpdmF0ZSBhcmdzOiBGb3JtR2V0QmlsbENyZWF0aW9uUHJvY2Vzc0VudGl0eUV4QXJncztcclxuICBjb25zdHJ1Y3RvcihcclxuICAgIEBJbmplY3QoU0VMRUNUT1JfQVJHU19JTkpFQ1RPUikgYXJnczogU2VsZWN0b3JBcmdzLFxyXG4gICAgcHJpdmF0ZSBkYXRhU2VydmljZTogQmlmRGF0YVNlcnZpY2UsXHJcbiAgICBASW5qZWN0KExPQ0FMRV9JRCkgbG9jYWxlSWQ6IHN0cmluZyxcclxuICAgIHByaXZhdGUgbG9hZGluZzogTG9hZGluZ1NlcnZpY2UsXHJcbiAgICBwcml2YXRlIGVsZW1lbnRSZWY6IEVsZW1lbnRSZWYsXHJcbiAgICBAT3B0aW9uYWwoKSBwdWJsaWMgaW5qOiBJbmplY3RvcixcclxuICAgIEBPcHRpb25hbCgpIHB1YmxpYyBjZnI6IENvbXBvbmVudEZhY3RvcnlSZXNvbHZlcixcclxuICAgIEBPcHRpb25hbCgpIHB1YmxpYyBtZXNzYWdlclNlcnZpY2U6IE1lc3NhZ2VyU2VydmljZSxcclxuICApIHtcclxuICAgIHRoaXMuYXJncyA9IG5ldyBGb3JtR2V0QmlsbENyZWF0aW9uUHJvY2Vzc0VudGl0eUV4QXJncygpO1xyXG4gICAgdGhpcy5hcmdzLkxvYWRGcm9tSnNvbk9iamVjdChhcmdzKTtcclxuICAgIHRoaXMubG9jYWxlUGlwZSA9IG5ldyBMb2NhbGVQaXBlKGxvY2FsZUlkKTtcclxuXHJcbiAgICBpZiAoaW5qID09IG51bGwpIHtcclxuICAgICAgY29uc3QgcmVmSW5qID0gUmVmbGVjdGl2ZUluamVjdG9yLnJlc29sdmVBbmRDcmVhdGUoW1xyXG4gICAgICAgIE1lc3NhZ2VyU2VydmljZSxcclxuICAgICAgXSk7XHJcbiAgICAgIHRoaXMuaW5qID0gcmVmSW5qO1xyXG4gICAgfVxyXG4gICAgdGhpcy5jZnIgPSBjZnIgfHwgdGhpcy5pbmouZ2V0KENvbXBvbmVudEZhY3RvcnlSZXNvbHZlcik7XHJcbiAgICB0aGlzLm1lc3NhZ2VyU2VydmljZSA9IG1lc3NhZ2VyU2VydmljZSB8fCB0aGlzLmluai5nZXQoTWVzc2FnZXJTZXJ2aWNlLCBudWxsKTtcclxuICB9XHJcblxyXG4gIG5nT25Jbml0KCkge1xyXG4gICAgdGhpcy50dERhdGFSb290ID0ge1xyXG4gICAgICBpZDogXCIqXCIsXHJcbiAgICAgIGRhdGE6IHtcclxuICAgICAgICB2b0lkOiBcIipcIixcclxuICAgICAgICB2b05hbWU6IHRoaXMubG9jYWxlUGlwZS5pbnN0YW50KFwiYWxsXCIpLFxyXG4gICAgICB9LFxyXG4gICAgICBwYXJlbnQ6IG51bGwsXHJcbiAgICAgIGV4cGFuZGVkOiB0cnVlLFxyXG4gICAgICBjaGlsZHJlbjogW10sXHJcbiAgICB9O1xyXG4gICAgdGhpcy50dERhdGEgPSBbdGhpcy50dERhdGFSb290XTtcclxuICAgIHRoaXMuY29uZmlnVHRDb2x1bW5zKCk7XHJcbiAgICB0aGlzLmNvbmZpZ0RnQ29sdW1ucygpO1xyXG4gICAgdGhpcy5jb25maWdUdEV2ZW50cygpO1xyXG4gICAgdGhpcy5jb25maWdEZ0V2ZW50cygpO1xyXG4gICAgdGhpcy5sb2FkSXRlbXMoKTtcclxuICB9XHJcblxyXG4gIGNsaWNrT2s0QmlmU2VsZWN0b3IgPSAoKSA9PiB7XHJcbiAgICBpZiAodGhpcy5zZWxlY3RlZEVudGl0eSA9PSBudWxsKSB7XHJcbiAgICAgIHRoaXMubWVzc2FnZXJTZXJ2aWNlLmVycm9yKHRoaXMubG9jYWxlUGlwZS5pbnN0YW50KFwicGxlYXNlU2VsZWN0T25lQ3JlYXRpb25Qcm9jZXNzXCIpKTtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgdGhpcy5zdWJqZWN0NENyZWF0aW9uUHJvY2Vzcy5uZXh0KHRoaXMuc2VsZWN0ZWRFbnRpdHkpO1xyXG4gICAgdGhpcy5zdWJqZWN0NENyZWF0aW9uUHJvY2Vzcy5jb21wbGV0ZSgpO1xyXG4gICAgdGhpcy5ic01vZGFsUmVmNEJpZlNlbGVjdG9yLmNsb3NlKCk7XHJcbiAgfTtcclxuXHJcbiAgY2xpY2tDbG9zZTRCaWZTZWxlY3RvciA9ICgpID0+IHtcclxuICAgIHRoaXMuYnNNb2RhbFJlZjRCaWZTZWxlY3Rvci5jbG9zZSgpO1xyXG4gIH07XHJcblxyXG4gIHByaXZhdGUgbG9hZEl0ZW1zKCk6IHZvaWQge1xyXG4gICAgdGhpcy5sb2FkaW5nLnNob3coeyBjb250YWluZXI6IHRoaXMuZWxlbWVudFJlZiB9KTtcclxuICAgIGxldCBsaXN0JDogT2JzZXJ2YWJsZTxJUnRTbGltQmlsbENyZWF0aW9uUHJvY2Vzc0VudGl0eUV4W10+ID0gbnVsbDtcclxuICAgIGlmICh0aGlzLmFyZ3MuZG93bkJpbGxWb0lkID09IG51bGwpIHtcclxuICAgICAgbGlzdCQgPSB0aGlzLmRhdGFTZXJ2aWNlLmdldFNsaW1CaWxsQ3JlYXRpb25Qcm9jZXNzRW50aXR5RXhlc0J5VXBCaWxsVm9JZDRQdXNoKHRoaXMuYXJncy51cEJpbGxWb0lkKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGxpc3QkID0gdGhpcy5kYXRhU2VydmljZS5nZXRTbGltQmlsbENyZWF0aW9uUHJvY2Vzc0VudGl0eUV4ZXNCeVVwQmlsbFZvSWRBbmREb3duQmlsbFZvSWQ0U3BlY2lmaWNQdXNoKHRoaXMuYXJncy51cEJpbGxWb0lkLCB0aGlzLmFyZ3MuZG93bkJpbGxWb0lkKTtcclxuICAgIH1cclxuICAgIGxpc3QkLnN1YnNjcmliZShcclxuICAgICAgKHJlc3VsdDogSVJ0U2xpbUJpbGxDcmVhdGlvblByb2Nlc3NFbnRpdHlFeFtdKSA9PiB7XHJcbiAgICAgICAgdGhpcy5sb2FkaW5nLmNsb3NlKCk7XHJcblxyXG4gICAgICAgIHRoaXMucHJvY0RhdGEgPSByZXN1bHQgfHwgW107XHJcbiAgICAgICAgdGhpcy5kZ0RhdGEgPSBbLi4udGhpcy5wcm9jRGF0YV07XHJcblxyXG4gICAgICAgIC8vIOe7hOe7h1ZP5qCRXHJcbiAgICAgICAgY29uc3Qgdm9MaXN0OiB7XHJcbiAgICAgICAgICB2b0lkOiBzdHJpbmcsXHJcbiAgICAgICAgICB2b05hbWU6IHN0cmluZyxcclxuICAgICAgICB9W10gPSBbXTtcclxuICAgICAgICB0aGlzLnByb2NEYXRhLmZvckVhY2goaXQgPT4ge1xyXG4gICAgICAgICAgaWYgKHZvTGlzdC5zb21lKHZvID0+IHZvLnZvSWQgPT0gaXQuZG93bkJpbGxWb0lkKSA9PSBmYWxzZSkge1xyXG4gICAgICAgICAgICB2b0xpc3QucHVzaCh7XHJcbiAgICAgICAgICAgICAgdm9JZDogaXQuZG93bkJpbGxWb0lkLFxyXG4gICAgICAgICAgICAgIHZvTmFtZTogaXQuZG93bkJpbGxWb05hbWUsXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHRoaXMudHREYXRhUm9vdC5jaGlsZHJlbiA9IHZvTGlzdC5tYXAoaXQgPT4ge1xyXG4gICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgaWQ6IGl0LnZvSWQsXHJcbiAgICAgICAgICAgIGRhdGE6IHtcclxuICAgICAgICAgICAgICB2b0lkOiBpdC52b0lkLFxyXG4gICAgICAgICAgICAgIHZvTmFtZTogaXQudm9OYW1lLFxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBleHBhbmRlZDogdHJ1ZSxcclxuICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICB0aGlzLnR0RGF0YSA9IFt0aGlzLnR0RGF0YVJvb3RdO1xyXG5cclxuICAgICAgICAvLyDpu5jorqTpgInkuK3nrKzkuIDmnaFcclxuICAgICAgICBpZiAodGhpcy5kZ0RhdGEgJiYgdGhpcy5kZ0RhdGEubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgdGhpcy5zZWxlY3RlZEVudGl0eSA9IHRoaXMuZGdEYXRhWzBdO1xyXG4gICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuZGcuY2xlYXJTZWxlY3Rpb25zKCk7XHJcbiAgICAgICAgICAgIHRoaXMuZGcuc2VsZWN0Um93KHRoaXMuZGdEYXRhWzBdLmlkKTtcclxuICAgICAgICAgIH0sIDApO1xyXG4gICAgICAgIH1cclxuICAgICAgfSxcclxuICAgICAgKGVycikgPT4ge1xyXG4gICAgICAgIHRoaXMubG9hZGluZy5jbG9zZSgpO1xyXG4gICAgICAgIHRocm93IGVycjtcclxuICAgICAgfVxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIGNvbmZpZ1R0Q29sdW1ucygpIHtcclxuICAgIHRoaXMudHRDb2xzID0gW1xyXG4gICAgICB7XHJcbiAgICAgICAgZmllbGQ6ICd2b05hbWUnLCB0aXRsZTogdGhpcy5sb2NhbGVQaXBlLmluc3RhbnQoJ2Rvd25zdHJlYW1CaWxsJyksIHdpZHRoOiAxMjAsXHJcbiAgICAgIH0sXHJcbiAgICBdO1xyXG4gIH1cclxuXHJcbiAgY29uZmlnRGdDb2x1bW5zKCkge1xyXG4gICAgdGhpcy5kZ0NvbHMgPSBbXHJcbiAgICAgIHsgZmllbGQ6IFwiY29kZVwiLCB0aXRsZTogdGhpcy5sb2NhbGVQaXBlLnRyYW5zZm9ybShcInByb2Nlc3NDb2RlXCIpLCB3aWR0aDogMTIwLCBzb3J0YWJsZTogdHJ1ZSB9LFxyXG4gICAgICB7XHJcbiAgICAgICAgZmllbGQ6IFwibmFtZVwiLCB0aXRsZTogdGhpcy5sb2NhbGVQaXBlLnRyYW5zZm9ybShcInByb2Nlc3NOYW1lXCIpLCB3aWR0aDogMjUwLCBzb3J0YWJsZTogdHJ1ZSxcclxuICAgICAgfSxcclxuICAgIF07XHJcbiAgfVxyXG5cclxuICBjb25maWdUdEV2ZW50cygpIHtcclxuICAgIHRoaXMudHQubm9kZVNlbGVjdGVkLnN1YnNjcmliZSgoY3R4KSA9PiB7XHJcbiAgICAgIC8vY3R4OntpbmlkZXg7aW5zdGFuY2U7bm9kZTp7ZGF0YX19XHJcbiAgICAgIGlmIChjdHgubm9kZS5pZCA9PSBcIipcIikge1xyXG4gICAgICAgIHRoaXMuZGdEYXRhID0gWy4uLnRoaXMucHJvY0RhdGFdO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHRoaXMuZGdEYXRhID0gWy4uLnRoaXMucHJvY0RhdGEuZmlsdGVyKGl0ID0+IGl0LmRvd25CaWxsVm9JZCA9PSBjdHgubm9kZS5kYXRhLnZvSWQpXTtcclxuICAgICAgfVxyXG4gICAgICBpZiAodGhpcy5kZ0RhdGEgJiYgdGhpcy5kZ0RhdGEubGVuZ3RoID4gMCkge1xyXG4gICAgICAgIHRoaXMuc2VsZWN0ZWRFbnRpdHkgPSB0aGlzLmRnRGF0YVswXTtcclxuICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgIHRoaXMuZGcuY2xlYXJTZWxlY3Rpb25zKCk7XHJcbiAgICAgICAgICB0aGlzLmRnLnNlbGVjdFJvdyh0aGlzLmRnRGF0YVswXS5pZCk7XHJcbiAgICAgICAgfSwgMCk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgY29uZmlnRGdFdmVudHMoKSB7XHJcbiAgICB0aGlzLmRnLnNlbGVjdENoYW5nZWQuc3Vic2NyaWJlKChyb3cpID0+IHtcclxuICAgICAgdGhpcy5zZWxlY3RlZEVudGl0eSA9IHJvdy5kYXRhO1xyXG4gICAgfSk7XHJcbiAgfVxyXG59XHJcbiJdfQ==
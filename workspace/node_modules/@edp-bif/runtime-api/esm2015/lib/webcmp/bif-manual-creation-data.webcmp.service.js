/**
 * @fileoverview added by tsickle
 * Generated from: lib/webcmp/bif-manual-creation-data.webcmp.service.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Injectable, Optional } from '@angular/core';
import { throwError } from 'rxjs';
import { MessagerService } from "@farris/ui-messager";
import { BindingData, ViewModel, FrameContext } from "@farris/devkit";
import { FormBillCreationProcessExecutorArgs } from '../entity/form-rest/FormBillCreationProcessExecutorArgs';
import { FormBillCreationProcessExecutorResult } from '@edp-aif/runtime-api';
import { BifDataService } from '../bif-manual-creation/service/bif-data.service';
import { FormCreateArgs, FormUpdateArgs } from '../ref';
import { PushTaskArgs } from '../bif-manual-creation/args/PushTaskArgs';
import { PushCreationMode } from '@edp-aif/common-api';
import { GetEntityDatasArgs } from '../bif-manual-creation/args/GetEntityDatasArgs';
import { ManualCreationMode } from '../entity/form-rest/ManualCreationMode';
import { LocalePipe } from '../bif-manual-creation/pipe/locale.pipe';
import { EntityParamUtils } from './EntityParamUtils';
/**
 * 手工生单数据服务类
 */
export class BifManualCreationDataWebCmpService {
    /**
     * @param {?} dataService
     * @param {?} bindingData
     * @param {?} messagerService
     * @param {?} viewModel
     * @param {?} frameContext
     */
    constructor(dataService, bindingData, messagerService, viewModel, frameContext) {
        this.dataService = dataService;
        this.bindingData = bindingData;
        this.messagerService = messagerService;
        this.viewModel = viewModel;
        this.frameContext = frameContext;
        this.localePipe = new LocalePipe(this.dataService && this.dataService.localeId || 'zh-CHS');
    }
    /**
     * 根据生单流程Id查找指定的生单流程
     * @param {?} processId 单据流生单流程 Id
     * @return {?} creationProcess 生单流程 \@type { Observable<IRtSlimBillCreationProcessEntityEx> }
     */
    getSlimBillCreationProcessEntityExById(processId) {
        if (processId == null || processId == "" || processId.trim() == "") {
            this.messagerService.error(this.localePipe.transform("processIdCantBeEmpty"));
            throw "参数processId不可为空";
        }
        return this.dataService.getSlimBillCreationProcessEntityExById(processId);
    }
    /**
     * 查询表单配置
     * @param {?} formSettingsId 表单配置Id
     * @return {?} formSettings 表单配置 \@type { Observable<FormSettings> }
     */
    getFormSettingsById(formSettingsId) {
        return this.dataService.getFormSettingsById(formSettingsId);
    }
    /**
     * 执行生单流程
     * @param {?} entities 参与生单的上游单据ID列表或实体列表
     * @param {?} creationProcessId 单据流生单流程 Id
     * @param {?} creationRuleId 生单规则Id（生单流程实体中记录）
     * @param {?} targetDataIds
     * @param {?} manualCreationMode
     * @return {?} creationResult 生单结果 \@type { Observable<FormBillCreationProcessExecutorResult> }
     */
    executeBillCreationProcess(entities, creationProcessId, creationRuleId, targetDataIds, manualCreationMode) {
        if (entities == null || ((/** @type {?} */ (entities))) == "") {
            this.messagerService.error(this.localePipe.transform("entitiesCantBeEmpty"));
            throw "参数entities不可为空";
        }
        if (entities instanceof Map) {
            entities = Array.from(entities.values());
        }
        entities = Array.isArray(entities) ? entities : [entities];
        manualCreationMode = manualCreationMode ? manualCreationMode : ManualCreationMode.Push;
        const { sourceVoEntityDatas, sourceVoEntityDataIds } = EntityParamUtils.buildSourceVoEntityData(entities);
        //创建执行生单流程参数对象
        /** @type {?} */
        const args = new FormBillCreationProcessExecutorArgs();
        args.billCreationProcessId = creationProcessId;
        args.creationRuleId = creationRuleId;
        //FormCreationRuleExecutorArgs的sourceVoEntityDatas属性为前端实体序列化后的字符串列表
        //sourceVoEntityDatas列表中的每个字符串，在结构上应与单据流定义中所选中的上游视图对象一致。
        args.sourceVoEntityDatas = sourceVoEntityDatas;
        args.sourceVoEntityDataIds = sourceVoEntityDataIds;
        //下推过程中不存在目标主表单据Id，所以targetVoDataIds为空列表。
        args.targetVoDataIds = targetDataIds;
        args.manualCreationMode = manualCreationMode;
        return this.dataService.executeBillCreationProcess(args);
    }
    /**
     * 创建实体数据（RetrieveDefault至缓存）
     * @param {?} formVoId 表单绑定VO Id
     * @param {?} res 生单流程执行结果
     * @return {?} formCreateResult 创建实体数据返回结果 \@type { Observable<FormCreateResult> }
     */
    createEntityDatas(formVoId, res) {
        /** @type {?} */
        const args = new FormCreateArgs();
        args.formVoId = formVoId;
        //获取生单流程执行结果
        args.rpcCreationRuleExecutorResult = res.creationRuleExecutorResult.ConvertToJson();
        //创建实体数据
        return this.dataService.createEntityDatas(args);
    }
    /**
     * 更新实体数据
     * @param {?} res 生单流程执行结果
     * @return {?} formUpdateResult 更新实体数据返回结果 \@type { Observable<FormUpdateResult> }
     */
    updateEntityDatas(res) {
        /** @type {?} */
        const args = new FormUpdateArgs();
        //Mapping执行条件判断结果为true时才会执行生单流程得到生单结果
        if (res.conditionResult.conditionExecutionResult == true) {
            //生单结果不为空
            if (res.creationRuleExecutorResult && res.creationRuleExecutorResult.mappingResults && res.creationRuleExecutorResult.mappingResults.length > 0) {
                args.rpcCreationRuleExecutorResult = res.creationRuleExecutorResult.ConvertToJson();
                return this.dataService.updateEntityDatas(args);
            }
            else {
                return throwError("creationRuleExecutorResult is empty!");
            }
        }
        else {
            return throwError("conditionExecutionResult is false!");
        }
    }
    /**
     * 推送任务中心
     * @param {?} res 生单流程执行结果
     * @return {?} formUpdateResult 更新实体数据返回结果 \@type { Observable<FormUpdateResult> }
     */
    pushTaskCenter(res) {
        /** @type {?} */
        const args = new PushTaskArgs();
        //Mapping执行条件判断结果为true时才会执行生单流程得到生单结果
        if (res.conditionResult.conditionExecutionResult == true) {
            //生单结果不为空
            if (res.creationRuleExecutorResult && res.creationRuleExecutorResult.mappingResults && res.creationRuleExecutorResult.mappingResults.length > 0) {
                if (res.pushCreationMode == PushCreationMode.TASKCENTER) {
                    args.suCode = res.downBillSuCode;
                    args.creationRuleExecutorResult = res.creationRuleExecutorResult;
                    return this.dataService.pushTaskCenter(args);
                }
                else {
                    return throwError("creationRuleExecutorResult can't be pushed to task center!");
                }
            }
            else {
                return throwError("creationRuleExecutorResult is empty!");
            }
        }
        else {
            return throwError("conditionExecutionResult is false!");
        }
    }
    /**
     * 查询生单结果
     * @param {?} creationResultId 生单结果id
     * @return {?}
     */
    getCreationResultById(creationResultId) {
        return this.dataService.getCreationResultById(creationResultId);
    }
    /**
     * 暂存生单结果
     * @param {?} creationResult
     * @return {?}
     */
    addFormBillCreationProcessExecutorResult(creationResult) {
        if (creationResult == null) {
            this.messagerService.error(this.localePipe.transform("creationResultCantBeEmpty"));
            throw "参数creationResult不可为空";
        }
        if (typeof creationResult == "string") {
            if (creationResult == "") {
                this.messagerService.error(this.localePipe.transform("creationResultCantBeEmpty"));
                throw "参数creationResult不可为空";
            }
            /** @type {?} */
            const temp = new FormBillCreationProcessExecutorResult();
            temp.LoadFromJson(creationResult);
            creationResult = temp;
        }
        if ((creationResult instanceof FormBillCreationProcessExecutorResult) == false) {
            /** @type {?} */
            const res = new FormBillCreationProcessExecutorResult();
            res.LoadFromJsonObject(creationResult);
            creationResult = res;
        }
        return this.dataService.addFormBillCreationProcessExecutorResult(creationResult);
    }
    /**
       * 获取VO序列化数据
       */
    /**
     * 获取VO序列化数据
     * @param {?} dataId
     * @param {?} voId
     * @param {?} suCode
     * @return {?}
     */
    getEntityDatas(dataId, voId, suCode) {
        if (dataId == null) {
            this.messagerService.error(this.localePipe.transform("dataIdCantBeEmpty"));
            throw "参数dataId不可为空";
        }
        if (voId == null) {
            this.messagerService.error(this.localePipe.transform("voIdCantBeEmpty"));
            throw "参数voId不可为空";
        }
        if (suCode == null) {
            this.messagerService.error(this.localePipe.transform("suCodeCantBeEmpty"));
            throw "参数suCode不可为空";
        }
        /** @type {?} */
        const args = new GetEntityDatasArgs();
        args.dataId = dataId;
        args.suCode = suCode;
        args.voId = voId;
        return this.dataService.getEntityDatas(args);
    }
}
BifManualCreationDataWebCmpService.decorators = [
    { type: Injectable }
];
/** @nocollapse */
BifManualCreationDataWebCmpService.ctorParameters = () => [
    { type: BifDataService },
    { type: BindingData },
    { type: MessagerService },
    { type: ViewModel, decorators: [{ type: Optional }] },
    { type: FrameContext, decorators: [{ type: Optional }] }
];
if (false) {
    /** @type {?} */
    BifManualCreationDataWebCmpService.prototype.localePipe;
    /** @type {?} */
    BifManualCreationDataWebCmpService.prototype.dataService;
    /** @type {?} */
    BifManualCreationDataWebCmpService.prototype.bindingData;
    /** @type {?} */
    BifManualCreationDataWebCmpService.prototype.messagerService;
    /** @type {?} */
    BifManualCreationDataWebCmpService.prototype.viewModel;
    /** @type {?} */
    BifManualCreationDataWebCmpService.prototype.frameContext;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmlmLW1hbnVhbC1jcmVhdGlvbi1kYXRhLndlYmNtcC5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGVkcC1iaWYvcnVudGltZS1hcGkvIiwic291cmNlcyI6WyJsaWIvd2ViY21wL2JpZi1tYW51YWwtY3JlYXRpb24tZGF0YS53ZWJjbXAuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsUUFBUSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ3JELE9BQU8sRUFBYyxVQUFVLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFFOUMsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBR3RELE9BQU8sRUFBVSxXQUFXLEVBQUUsU0FBUyxFQUFFLFlBQVksRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBRzlFLE9BQU8sRUFBRSxtQ0FBbUMsRUFBRSxNQUFNLHlEQUF5RCxDQUFDO0FBQzlHLE9BQU8sRUFBRSxxQ0FBcUMsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBQzdFLE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSxpREFBaUQsQ0FBQztBQUNqRixPQUFPLEVBQUUsY0FBYyxFQUFzQyxjQUFjLEVBQUUsTUFBTSxRQUFRLENBQUM7QUFDNUYsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLDBDQUEwQyxDQUFDO0FBQ3hFLE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBRXZELE9BQU8sRUFBRSxrQkFBa0IsRUFBRSxNQUFNLGdEQUFnRCxDQUFDO0FBQ3BGLE9BQU8sRUFBRSxrQkFBa0IsRUFBRSxNQUFNLHdDQUF3QyxDQUFDO0FBQzVFLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSx5Q0FBeUMsQ0FBQztBQUNyRSxPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQzs7OztBQU10RCxNQUFNLE9BQU8sa0NBQWtDOzs7Ozs7OztJQUc3QyxZQUNTLFdBQTJC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QyxJQUFJLEdBQUcsSUFBSSxDQUFDO1FBRWpCLE9BQU8sSUFBSSxDQUFDLFdBQVcsQ0FBQyxjQUFjLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDL0MsQ0FBQzs7O1lBaE1GLFVBQVU7Ozs7WUFiRixjQUFjO1lBTE4sV0FBVztZQUhuQixlQUFlO1lBR00sU0FBUyx1QkEwQmxDLFFBQVE7WUExQjRCLFlBQVksdUJBMkJoRCxRQUFROzs7O0lBUFgsd0RBQThCOztJQUc1Qix5REFBa0M7O0lBQ2xDLHlEQUErQjs7SUFDL0IsNkRBQXVDOztJQUN2Qyx1REFBdUM7O0lBQ3ZDLDBEQUE2QyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUsIE9wdGlvbmFsIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IE9ic2VydmFibGUsIHRocm93RXJyb3IgfSBmcm9tICdyeGpzJztcclxuXHJcbmltcG9ydCB7IE1lc3NhZ2VyU2VydmljZSB9IGZyb20gXCJAZmFycmlzL3VpLW1lc3NhZ2VyXCI7XHJcbmltcG9ydCB7IE1vZGFsT3B0aW9ucyB9IGZyb20gJ0BmYXJyaXMvdWktbW9kYWwnO1xyXG5cclxuaW1wb3J0IHsgRW50aXR5LCBCaW5kaW5nRGF0YSwgVmlld01vZGVsLCBGcmFtZUNvbnRleHQgfSBmcm9tIFwiQGZhcnJpcy9kZXZraXRcIjtcclxuXHJcbmltcG9ydCB7IElSdFNsaW1CaWxsQ3JlYXRpb25Qcm9jZXNzRW50aXR5RXgsIEZvcm1TZXR0aW5ncyB9IGZyb20gXCJAZWRwLWJpZi9jb21tb24tYXBpXCI7XHJcbmltcG9ydCB7IEZvcm1CaWxsQ3JlYXRpb25Qcm9jZXNzRXhlY3V0b3JBcmdzIH0gZnJvbSAnLi4vZW50aXR5L2Zvcm0tcmVzdC9Gb3JtQmlsbENyZWF0aW9uUHJvY2Vzc0V4ZWN1dG9yQXJncyc7XHJcbmltcG9ydCB7IEZvcm1CaWxsQ3JlYXRpb25Qcm9jZXNzRXhlY3V0b3JSZXN1bHQgfSBmcm9tICdAZWRwLWFpZi9ydW50aW1lLWFwaSc7XHJcbmltcG9ydCB7IEJpZkRhdGFTZXJ2aWNlIH0gZnJvbSAnLi4vYmlmLW1hbnVhbC1jcmVhdGlvbi9zZXJ2aWNlL2JpZi1kYXRhLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBGb3JtQ3JlYXRlQXJncywgRm9ybUNyZWF0ZVJlc3VsdCwgRm9ybVVwZGF0ZVJlc3VsdCwgRm9ybVVwZGF0ZUFyZ3MgfSBmcm9tICcuLi9yZWYnO1xyXG5pbXBvcnQgeyBQdXNoVGFza0FyZ3MgfSBmcm9tICcuLi9iaWYtbWFudWFsLWNyZWF0aW9uL2FyZ3MvUHVzaFRhc2tBcmdzJztcclxuaW1wb3J0IHsgUHVzaENyZWF0aW9uTW9kZSB9IGZyb20gJ0BlZHAtYWlmL2NvbW1vbi1hcGknO1xyXG5pbXBvcnQgeyBHZW5lcmFsVGV4dElkV2l0aERhdGFJZCB9IGZyb20gJy4uL2VudGl0eS9mb3JtLXJlc3QvR2VuZXJhbFRleHRJZFdpdGhEYXRhSWQnO1xyXG5pbXBvcnQgeyBHZXRFbnRpdHlEYXRhc0FyZ3MgfSBmcm9tICcuLi9iaWYtbWFudWFsLWNyZWF0aW9uL2FyZ3MvR2V0RW50aXR5RGF0YXNBcmdzJztcclxuaW1wb3J0IHsgTWFudWFsQ3JlYXRpb25Nb2RlIH0gZnJvbSAnLi4vZW50aXR5L2Zvcm0tcmVzdC9NYW51YWxDcmVhdGlvbk1vZGUnO1xyXG5pbXBvcnQgeyBMb2NhbGVQaXBlIH0gZnJvbSAnLi4vYmlmLW1hbnVhbC1jcmVhdGlvbi9waXBlL2xvY2FsZS5waXBlJztcclxuaW1wb3J0IHsgRW50aXR5UGFyYW1VdGlscyB9IGZyb20gJy4vRW50aXR5UGFyYW1VdGlscyc7XHJcblxyXG4vKipcclxuICog5omL5bel55Sf5Y2V5pWw5o2u5pyN5Yqh57G7XHJcbiAqL1xyXG5ASW5qZWN0YWJsZSgpXHJcbmV4cG9ydCBjbGFzcyBCaWZNYW51YWxDcmVhdGlvbkRhdGFXZWJDbXBTZXJ2aWNlIHtcclxuICBwdWJsaWMgbG9jYWxlUGlwZTogTG9jYWxlUGlwZTtcclxuXHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICBwdWJsaWMgZGF0YVNlcnZpY2U6IEJpZkRhdGFTZXJ2aWNlLFxyXG4gICAgcHVibGljIGJpbmRpbmdEYXRhOiBCaW5kaW5nRGF0YSxcclxuICAgIHB1YmxpYyBtZXNzYWdlclNlcnZpY2U6IE1lc3NhZ2VyU2VydmljZSxcclxuICAgIEBPcHRpb25hbCgpIHB1YmxpYyB2aWV3TW9kZWw6IFZpZXdNb2RlbCxcclxuICAgIEBPcHRpb25hbCgpIHB1YmxpYyBmcmFtZUNvbnRleHQ6IEZyYW1lQ29udGV4dCxcclxuICApIHtcclxuICAgIHRoaXMubG9jYWxlUGlwZSA9IG5ldyBMb2NhbGVQaXBlKHRoaXMuZGF0YVNlcnZpY2UgJiYgdGhpcy5kYXRhU2VydmljZS5sb2NhbGVJZCB8fCAnemgtQ0hTJyk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDmoLnmja7nlJ/ljZXmtYHnqItJZOafpeaJvuaMh+WumueahOeUn+WNlea1geeoi1xyXG4gICAqIEBwYXJhbSBwcm9jZXNzSWQg5Y2V5o2u5rWB55Sf5Y2V5rWB56iLIElkXHJcbiAgICogQHJldHVybnMgY3JlYXRpb25Qcm9jZXNzIOeUn+WNlea1geeoiyBAdHlwZSB7IE9ic2VydmFibGU8SVJ0U2xpbUJpbGxDcmVhdGlvblByb2Nlc3NFbnRpdHlFeD4gfVxyXG4gICAqL1xyXG4gIHB1YmxpYyBnZXRTbGltQmlsbENyZWF0aW9uUHJvY2Vzc0VudGl0eUV4QnlJZChwcm9jZXNzSWQ6IHN0cmluZyk6IE9ic2VydmFibGU8SVJ0U2xpbUJpbGxDcmVhdGlvblByb2Nlc3NFbnRpdHlFeD4ge1xyXG4gICAgaWYgKHByb2Nlc3NJZCA9PSBudWxsIHx8IHByb2Nlc3NJZCA9PSBcIlwiIHx8IHByb2Nlc3NJZC50cmltKCkgPT0gXCJcIikge1xyXG4gICAgICB0aGlzLm1lc3NhZ2VyU2VydmljZS5lcnJvcih0aGlzLmxvY2FsZVBpcGUudHJhbnNmb3JtKFwicHJvY2Vzc0lkQ2FudEJlRW1wdHlcIikpO1xyXG4gICAgICB0aHJvdyBcIuWPguaVsHByb2Nlc3NJZOS4jeWPr+S4uuepulwiO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHRoaXMuZGF0YVNlcnZpY2UuZ2V0U2xpbUJpbGxDcmVhdGlvblByb2Nlc3NFbnRpdHlFeEJ5SWQocHJvY2Vzc0lkKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOafpeivouihqOWNlemFjee9rlxyXG4gICAqIEBwYXJhbSBmb3JtU2V0dGluZ3NJZCDooajljZXphY3nva5JZFxyXG4gICAqIEByZXR1cm5zIGZvcm1TZXR0aW5ncyDooajljZXphY3nva4gQHR5cGUgeyBPYnNlcnZhYmxlPEZvcm1TZXR0aW5ncz4gfVxyXG4gICAqL1xyXG4gIHB1YmxpYyBnZXRGb3JtU2V0dGluZ3NCeUlkKGZvcm1TZXR0aW5nc0lkOiBzdHJpbmcpOiBPYnNlcnZhYmxlPEZvcm1TZXR0aW5ncz4ge1xyXG4gICAgcmV0dXJuIHRoaXMuZGF0YVNlcnZpY2UuZ2V0Rm9ybVNldHRpbmdzQnlJZChmb3JtU2V0dGluZ3NJZCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDmiafooYznlJ/ljZXmtYHnqItcclxuICAgKiBAcGFyYW0gZW50aXRpZXMg5Y+C5LiO55Sf5Y2V55qE5LiK5ri45Y2V5o2uSUTliJfooajmiJblrp7kvZPliJfooahcclxuICAgKiBAcGFyYW0gY3JlYXRpb25Qcm9jZXNzSWQg5Y2V5o2u5rWB55Sf5Y2V5rWB56iLIElkXHJcbiAgICogQHBhcmFtIGNyZWF0aW9uUnVsZUlkIOeUn+WNleinhOWImUlk77yI55Sf5Y2V5rWB56iL5a6e5L2T5Lit6K6w5b2V77yJXHJcbiAgICogQHJldHVybnMgY3JlYXRpb25SZXN1bHQg55Sf5Y2V57uT5p6cIEB0eXBlIHsgT2JzZXJ2YWJsZTxGb3JtQmlsbENyZWF0aW9uUHJvY2Vzc0V4ZWN1dG9yUmVzdWx0PiB9XHJcbiAgICovXHJcbiAgcHVibGljIGV4ZWN1dGVCaWxsQ3JlYXRpb25Qcm9jZXNzKGVudGl0aWVzOiBFbnRpdHlbXSwgY3JlYXRpb25Qcm9jZXNzSWQ6IHN0cmluZywgY3JlYXRpb25SdWxlSWQ6IHN0cmluZywgdGFyZ2V0RGF0YUlkczogc3RyaW5nW10sIG1hbnVhbENyZWF0aW9uTW9kZTogTWFudWFsQ3JlYXRpb25Nb2RlKTogT2JzZXJ2YWJsZTxGb3JtQmlsbENyZWF0aW9uUHJvY2Vzc0V4ZWN1dG9yUmVzdWx0PiB7XHJcbiAgICBpZiAoZW50aXRpZXMgPT0gbnVsbCB8fCAoZW50aXRpZXMgYXMgYW55KSA9PSBcIlwiKSB7XHJcbiAgICAgIHRoaXMubWVzc2FnZXJTZXJ2aWNlLmVycm9yKHRoaXMubG9jYWxlUGlwZS50cmFuc2Zvcm0oXCJlbnRpdGllc0NhbnRCZUVtcHR5XCIpKTtcclxuICAgICAgdGhyb3cgXCLlj4LmlbBlbnRpdGllc+S4jeWPr+S4uuepulwiO1xyXG4gICAgfVxyXG4gICAgaWYgKGVudGl0aWVzIGluc3RhbmNlb2YgTWFwKSB7XHJcbiAgICAgIGVudGl0aWVzID0gQXJyYXkuZnJvbShlbnRpdGllcy52YWx1ZXMoKSk7XHJcbiAgICB9XHJcbiAgICBlbnRpdGllcyA9IEFycmF5LmlzQXJyYXkoZW50aXRpZXMpID8gZW50aXRpZXMgOiBbZW50aXRpZXNdO1xyXG4gICAgbWFudWFsQ3JlYXRpb25Nb2RlID0gbWFudWFsQ3JlYXRpb25Nb2RlID8gbWFudWFsQ3JlYXRpb25Nb2RlIDogTWFudWFsQ3JlYXRpb25Nb2RlLlB1c2g7XHJcblxyXG4gICAgY29uc3QgeyBzb3VyY2VWb0VudGl0eURhdGFzLCBzb3VyY2VWb0VudGl0eURhdGFJZHMgfSA9IEVudGl0eVBhcmFtVXRpbHMuYnVpbGRTb3VyY2VWb0VudGl0eURhdGEoZW50aXRpZXMpO1xyXG5cclxuICAgIC8v5Yib5bu65omn6KGM55Sf5Y2V5rWB56iL5Y+C5pWw5a+56LGhXHJcbiAgICBjb25zdCBhcmdzID0gbmV3IEZvcm1CaWxsQ3JlYXRpb25Qcm9jZXNzRXhlY3V0b3JBcmdzKCk7XHJcbiAgICBhcmdzLmJpbGxDcmVhdGlvblByb2Nlc3NJZCA9IGNyZWF0aW9uUHJvY2Vzc0lkO1xyXG4gICAgYXJncy5jcmVhdGlvblJ1bGVJZCA9IGNyZWF0aW9uUnVsZUlkO1xyXG4gICAgLy9Gb3JtQ3JlYXRpb25SdWxlRXhlY3V0b3JBcmdz55qEc291cmNlVm9FbnRpdHlEYXRhc+WxnuaAp+S4uuWJjeerr+WunuS9k+W6j+WIl+WMluWQjueahOWtl+espuS4suWIl+ihqFxyXG4gICAgLy9zb3VyY2VWb0VudGl0eURhdGFz5YiX6KGo5Lit55qE5q+P5Liq5a2X56ym5Liy77yM5Zyo57uT5p6E5LiK5bqU5LiO5Y2V5o2u5rWB5a6a5LmJ5Lit5omA6YCJ5Lit55qE5LiK5ri46KeG5Zu+5a+56LGh5LiA6Ie044CCXHJcbiAgICBhcmdzLnNvdXJjZVZvRW50aXR5RGF0YXMgPSBzb3VyY2VWb0VudGl0eURhdGFzO1xyXG4gICAgYXJncy5zb3VyY2VWb0VudGl0eURhdGFJZHMgPSBzb3VyY2VWb0VudGl0eURhdGFJZHM7XHJcbiAgICAvL+S4i+aOqOi/h+eoi+S4reS4jeWtmOWcqOebruagh+S4u+ihqOWNleaNrklk77yM5omA5LuldGFyZ2V0Vm9EYXRhSWRz5Li656m65YiX6KGo44CCXHJcbiAgICBhcmdzLnRhcmdldFZvRGF0YUlkcyA9IHRhcmdldERhdGFJZHM7XHJcbiAgICBhcmdzLm1hbnVhbENyZWF0aW9uTW9kZSA9IG1hbnVhbENyZWF0aW9uTW9kZTtcclxuICAgIHJldHVybiB0aGlzLmRhdGFTZXJ2aWNlLmV4ZWN1dGVCaWxsQ3JlYXRpb25Qcm9jZXNzKGFyZ3MpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5Yib5bu65a6e5L2T5pWw5o2u77yIUmV0cmlldmVEZWZhdWx06Iez57yT5a2Y77yJXHJcbiAgICogQHBhcmFtIGZvcm1Wb0lkIOihqOWNlee7keWumlZPIElkXHJcbiAgICogQHBhcmFtIHJlcyDnlJ/ljZXmtYHnqIvmiafooYznu5PmnpxcclxuICAgKiBAcmV0dXJucyBmb3JtQ3JlYXRlUmVzdWx0IOWIm+W7uuWunuS9k+aVsOaNrui/lOWbnue7k+aenCBAdHlwZSB7IE9ic2VydmFibGU8Rm9ybUNyZWF0ZVJlc3VsdD4gfVxyXG4gICAqL1xyXG4gIHB1YmxpYyBjcmVhdGVFbnRpdHlEYXRhcyhmb3JtVm9JZDogc3RyaW5nLCByZXM6IEZvcm1CaWxsQ3JlYXRpb25Qcm9jZXNzRXhlY3V0b3JSZXN1bHQpOiBPYnNlcnZhYmxlPEZvcm1DcmVhdGVSZXN1bHQ+IHtcclxuICAgIGNvbnN0IGFyZ3MgPSBuZXcgRm9ybUNyZWF0ZUFyZ3MoKTtcclxuICAgIGFyZ3MuZm9ybVZvSWQgPSBmb3JtVm9JZDtcclxuICAgIC8v6I635Y+W55Sf5Y2V5rWB56iL5omn6KGM57uT5p6cXHJcbiAgICBhcmdzLnJwY0NyZWF0aW9uUnVsZUV4ZWN1dG9yUmVzdWx0ID0gcmVzLmNyZWF0aW9uUnVsZUV4ZWN1dG9yUmVzdWx0LkNvbnZlcnRUb0pzb24oKTtcclxuICAgIC8v5Yib5bu65a6e5L2T5pWw5o2uXHJcbiAgICByZXR1cm4gdGhpcy5kYXRhU2VydmljZS5jcmVhdGVFbnRpdHlEYXRhcyhhcmdzKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOabtOaWsOWunuS9k+aVsOaNrlxyXG4gICAqIEBwYXJhbSByZXMg55Sf5Y2V5rWB56iL5omn6KGM57uT5p6cXHJcbiAgICogQHJldHVybnMgZm9ybVVwZGF0ZVJlc3VsdCDmm7TmlrDlrp7kvZPmlbDmja7ov5Tlm57nu5PmnpwgQHR5cGUgeyBPYnNlcnZhYmxlPEZvcm1VcGRhdGVSZXN1bHQ+IH1cclxuICAgKi9cclxuICBwdWJsaWMgdXBkYXRlRW50aXR5RGF0YXMocmVzOiBGb3JtQmlsbENyZWF0aW9uUHJvY2Vzc0V4ZWN1dG9yUmVzdWx0KTogT2JzZXJ2YWJsZTxGb3JtVXBkYXRlUmVzdWx0PiB7XHJcbiAgICBjb25zdCBhcmdzID0gbmV3IEZvcm1VcGRhdGVBcmdzKCk7XHJcbiAgICAvL01hcHBpbmfmiafooYzmnaHku7bliKTmlq3nu5PmnpzkuLp0cnVl5pe25omN5Lya5omn6KGM55Sf5Y2V5rWB56iL5b6X5Yiw55Sf5Y2V57uT5p6cXHJcbiAgICBpZiAocmVzLmNvbmRpdGlvblJlc3VsdC5jb25kaXRpb25FeGVjdXRpb25SZXN1bHQgPT0gdHJ1ZSkge1xyXG4gICAgICAvL+eUn+WNlee7k+aenOS4jeS4uuepulxyXG4gICAgICBpZiAocmVzLmNyZWF0aW9uUnVsZUV4ZWN1dG9yUmVzdWx0ICYmIHJlcy5jcmVhdGlvblJ1bGVFeGVjdXRvclJlc3VsdC5tYXBwaW5nUmVzdWx0cyAmJiByZXMuY3JlYXRpb25SdWxlRXhlY3V0b3JSZXN1bHQubWFwcGluZ1Jlc3VsdHMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgIGFyZ3MucnBjQ3JlYXRpb25SdWxlRXhlY3V0b3JSZXN1bHQgPSByZXMuY3JlYXRpb25SdWxlRXhlY3V0b3JSZXN1bHQuQ29udmVydFRvSnNvbigpO1xyXG4gICAgICAgIHJldHVybiB0aGlzLmRhdGFTZXJ2aWNlLnVwZGF0ZUVudGl0eURhdGFzKGFyZ3MpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHJldHVybiB0aHJvd0Vycm9yKFwiY3JlYXRpb25SdWxlRXhlY3V0b3JSZXN1bHQgaXMgZW1wdHkhXCIpXHJcbiAgICAgIH1cclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHJldHVybiB0aHJvd0Vycm9yKFwiY29uZGl0aW9uRXhlY3V0aW9uUmVzdWx0IGlzIGZhbHNlIVwiKVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5o6o6YCB5Lu75Yqh5Lit5b+DXHJcbiAgICogQHBhcmFtIHJlcyDnlJ/ljZXmtYHnqIvmiafooYznu5PmnpxcclxuICAgKiBAcmV0dXJucyBmb3JtVXBkYXRlUmVzdWx0IOabtOaWsOWunuS9k+aVsOaNrui/lOWbnue7k+aenCBAdHlwZSB7IE9ic2VydmFibGU8Rm9ybVVwZGF0ZVJlc3VsdD4gfVxyXG4gICAqL1xyXG4gIHB1YmxpYyBwdXNoVGFza0NlbnRlcihyZXM6IEZvcm1CaWxsQ3JlYXRpb25Qcm9jZXNzRXhlY3V0b3JSZXN1bHQpOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgY29uc3QgYXJncyA9IG5ldyBQdXNoVGFza0FyZ3MoKTtcclxuICAgIC8vTWFwcGluZ+aJp+ihjOadoeS7tuWIpOaWree7k+aenOS4unRydWXml7bmiY3kvJrmiafooYznlJ/ljZXmtYHnqIvlvpfliLDnlJ/ljZXnu5PmnpxcclxuICAgIGlmIChyZXMuY29uZGl0aW9uUmVzdWx0LmNvbmRpdGlvbkV4ZWN1dGlvblJlc3VsdCA9PSB0cnVlKSB7XHJcbiAgICAgIC8v55Sf5Y2V57uT5p6c5LiN5Li656m6XHJcbiAgICAgIGlmIChyZXMuY3JlYXRpb25SdWxlRXhlY3V0b3JSZXN1bHQgJiYgcmVzLmNyZWF0aW9uUnVsZUV4ZWN1dG9yUmVzdWx0Lm1hcHBpbmdSZXN1bHRzICYmIHJlcy5jcmVhdGlvblJ1bGVFeGVjdXRvclJlc3VsdC5tYXBwaW5nUmVzdWx0cy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgaWYgKHJlcy5wdXNoQ3JlYXRpb25Nb2RlID09IFB1c2hDcmVhdGlvbk1vZGUuVEFTS0NFTlRFUikge1xyXG4gICAgICAgICAgYXJncy5zdUNvZGUgPSByZXMuZG93bkJpbGxTdUNvZGU7XHJcbiAgICAgICAgICBhcmdzLmNyZWF0aW9uUnVsZUV4ZWN1dG9yUmVzdWx0ID0gcmVzLmNyZWF0aW9uUnVsZUV4ZWN1dG9yUmVzdWx0O1xyXG4gICAgICAgICAgcmV0dXJuIHRoaXMuZGF0YVNlcnZpY2UucHVzaFRhc2tDZW50ZXIoYXJncyk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHJldHVybiB0aHJvd0Vycm9yKFwiY3JlYXRpb25SdWxlRXhlY3V0b3JSZXN1bHQgY2FuJ3QgYmUgcHVzaGVkIHRvIHRhc2sgY2VudGVyIVwiKVxyXG4gICAgICAgIH1cclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICByZXR1cm4gdGhyb3dFcnJvcihcImNyZWF0aW9uUnVsZUV4ZWN1dG9yUmVzdWx0IGlzIGVtcHR5IVwiKVxyXG4gICAgICB9XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICByZXR1cm4gdGhyb3dFcnJvcihcImNvbmRpdGlvbkV4ZWN1dGlvblJlc3VsdCBpcyBmYWxzZSFcIilcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOafpeivoueUn+WNlee7k+aenFxyXG4gICAqIEBwYXJhbSBjcmVhdGlvblJlc3VsdElkIOeUn+WNlee7k+aenGlkXHJcbiAgICovXHJcbiAgcHVibGljIGdldENyZWF0aW9uUmVzdWx0QnlJZChjcmVhdGlvblJlc3VsdElkOiBzdHJpbmcpOiBPYnNlcnZhYmxlPEZvcm1CaWxsQ3JlYXRpb25Qcm9jZXNzRXhlY3V0b3JSZXN1bHQ+IHtcclxuICAgIHJldHVybiB0aGlzLmRhdGFTZXJ2aWNlLmdldENyZWF0aW9uUmVzdWx0QnlJZChjcmVhdGlvblJlc3VsdElkKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOaaguWtmOeUn+WNlee7k+aenFxyXG4gICAqL1xyXG4gIHB1YmxpYyBhZGRGb3JtQmlsbENyZWF0aW9uUHJvY2Vzc0V4ZWN1dG9yUmVzdWx0KGNyZWF0aW9uUmVzdWx0OiBGb3JtQmlsbENyZWF0aW9uUHJvY2Vzc0V4ZWN1dG9yUmVzdWx0KTogT2JzZXJ2YWJsZTxHZW5lcmFsVGV4dElkV2l0aERhdGFJZFtdPiB7XHJcbiAgICBpZiAoY3JlYXRpb25SZXN1bHQgPT0gbnVsbCkge1xyXG4gICAgICB0aGlzLm1lc3NhZ2VyU2VydmljZS5lcnJvcih0aGlzLmxvY2FsZVBpcGUudHJhbnNmb3JtKFwiY3JlYXRpb25SZXN1bHRDYW50QmVFbXB0eVwiKSk7XHJcbiAgICAgIHRocm93IFwi5Y+C5pWwY3JlYXRpb25SZXN1bHTkuI3lj6/kuLrnqbpcIjtcclxuICAgIH1cclxuICAgIGlmICh0eXBlb2YgY3JlYXRpb25SZXN1bHQgPT0gXCJzdHJpbmdcIikge1xyXG4gICAgICBpZiAoY3JlYXRpb25SZXN1bHQgPT0gXCJcIikge1xyXG4gICAgICAgIHRoaXMubWVzc2FnZXJTZXJ2aWNlLmVycm9yKHRoaXMubG9jYWxlUGlwZS50cmFuc2Zvcm0oXCJjcmVhdGlvblJlc3VsdENhbnRCZUVtcHR5XCIpKTtcclxuICAgICAgICB0aHJvdyBcIuWPguaVsGNyZWF0aW9uUmVzdWx05LiN5Y+v5Li656m6XCI7XHJcbiAgICAgIH1cclxuICAgICAgY29uc3QgdGVtcCA9IG5ldyBGb3JtQmlsbENyZWF0aW9uUHJvY2Vzc0V4ZWN1dG9yUmVzdWx0KCk7XHJcbiAgICAgIHRlbXAuTG9hZEZyb21Kc29uKGNyZWF0aW9uUmVzdWx0KTtcclxuICAgICAgY3JlYXRpb25SZXN1bHQgPSB0ZW1wO1xyXG4gICAgfVxyXG4gICAgaWYgKChjcmVhdGlvblJlc3VsdCBpbnN0YW5jZW9mIEZvcm1CaWxsQ3JlYXRpb25Qcm9jZXNzRXhlY3V0b3JSZXN1bHQpID09IGZhbHNlKSB7XHJcbiAgICAgIGNvbnN0IHJlcyA9IG5ldyBGb3JtQmlsbENyZWF0aW9uUHJvY2Vzc0V4ZWN1dG9yUmVzdWx0KCk7XHJcbiAgICAgIHJlcy5Mb2FkRnJvbUpzb25PYmplY3QoY3JlYXRpb25SZXN1bHQpO1xyXG4gICAgICBjcmVhdGlvblJlc3VsdCA9IHJlcztcclxuICAgIH1cclxuICAgIHJldHVybiB0aGlzLmRhdGFTZXJ2aWNlLmFkZEZvcm1CaWxsQ3JlYXRpb25Qcm9jZXNzRXhlY3V0b3JSZXN1bHQoY3JlYXRpb25SZXN1bHQpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog6I635Y+WVk/luo/liJfljJbmlbDmja5cclxuICAgKi9cclxuICAvKipcclxuICAgKiDojrflj5ZWT+W6j+WIl+WMluaVsOaNrlxyXG4gICAqIEBwYXJhbSBhcmdzXHJcbiAgICogQHJldHVybnNcclxuICAgKi9cclxuICBwdWJsaWMgZ2V0RW50aXR5RGF0YXMoZGF0YUlkOiBzdHJpbmcsIHZvSWQ6IHN0cmluZywgc3VDb2RlOiBzdHJpbmcpOiBPYnNlcnZhYmxlPHN0cmluZz4ge1xyXG4gICAgaWYgKGRhdGFJZCA9PSBudWxsKSB7XHJcbiAgICAgIHRoaXMubWVzc2FnZXJTZXJ2aWNlLmVycm9yKHRoaXMubG9jYWxlUGlwZS50cmFuc2Zvcm0oXCJkYXRhSWRDYW50QmVFbXB0eVwiKSk7XHJcbiAgICAgIHRocm93IFwi5Y+C5pWwZGF0YUlk5LiN5Y+v5Li656m6XCI7XHJcbiAgICB9XHJcbiAgICBpZiAodm9JZCA9PSBudWxsKSB7XHJcbiAgICAgIHRoaXMubWVzc2FnZXJTZXJ2aWNlLmVycm9yKHRoaXMubG9jYWxlUGlwZS50cmFuc2Zvcm0oXCJ2b0lkQ2FudEJlRW1wdHlcIikpO1xyXG4gICAgICB0aHJvdyBcIuWPguaVsHZvSWTkuI3lj6/kuLrnqbpcIjtcclxuICAgIH1cclxuICAgIGlmIChzdUNvZGUgPT0gbnVsbCkge1xyXG4gICAgICB0aGlzLm1lc3NhZ2VyU2VydmljZS5lcnJvcih0aGlzLmxvY2FsZVBpcGUudHJhbnNmb3JtKFwic3VDb2RlQ2FudEJlRW1wdHlcIikpO1xyXG4gICAgICB0aHJvdyBcIuWPguaVsHN1Q29kZeS4jeWPr+S4uuepulwiO1xyXG4gICAgfVxyXG4gICAgY29uc3QgYXJncyA9IG5ldyBHZXRFbnRpdHlEYXRhc0FyZ3MoKTtcclxuICAgIGFyZ3MuZGF0YUlkID0gZGF0YUlkO1xyXG4gICAgYXJncy5zdUNvZGUgPSBzdUNvZGU7XHJcbiAgICBhcmdzLnZvSWQgPSB2b0lkO1xyXG5cclxuICAgIHJldHVybiB0aGlzLmRhdGFTZXJ2aWNlLmdldEVudGl0eURhdGFzKGFyZ3MpO1xyXG4gIH1cclxufVxyXG4iXX0=
/**
 * @fileoverview added by tsickle
 * Generated from: lib/webcmp/bif-bill-tracker.webcmp.service.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { ComponentFactoryResolver, Inject, Injectable, Injector, LOCALE_ID, Optional, ReflectiveInjector } from '@angular/core';
import { BillTrackerUiService } from '../bill-tracker/services/bill-tracker-ui.service';
import { GetBillsInfoArgs } from '../entity/tracking/GetBillsInfoArgs';
import { BindingData, ViewModel, FrameContext } from '@farris/devkit';
import { canJSONParse } from '../utils/ObjectUtils';
import { MessagerService } from '@farris/ui-messager';
import { BillTrackerLocalePipe } from '../bill-tracker/pipe/bill-tracker-locale.pipe';
/**
 * 单据追踪web构件服务类
 */
export class BifBillTrackerWebCmpService {
    /**
     * @param {?} trackerUiService
     * @param {?} bindingData
     * @param {?} viewModel
     * @param {?} frameContext
     * @param {?} inj
     * @param {?} cfr
     * @param {?} localeId
     * @param {?} messagerService
     */
    constructor(trackerUiService, bindingData, viewModel, frameContext, inj, cfr, localeId, messagerService) {
        this.trackerUiService = trackerUiService;
        this.bindingData = bindingData;
        this.viewModel = viewModel;
        this.frameContext = frameContext;
        this.inj = inj;
        this.cfr = cfr;
        this.localeId = localeId;
        this.messagerService = messagerService;
        if (inj == null) {
            /** @type {?} */
            const refInj = ReflectiveInjector.resolveAndCreate([], this.frameContext && this.frameContext.injector);
            this.inj = refInj;
        }
        this.cfr = cfr || this.inj.get(ComponentFactoryResolver);
        this.localeId = localeId || this.inj.get(LOCALE_ID, null) || 'zh-CHS';
        this.messagerService = messagerService || this.inj.get(MessagerService, null);
        this.localePipe = this.trackerUiService && this.trackerUiService.localePipe || new BillTrackerLocalePipe(localeId);
    }
    /**
     * 打开单据追踪弹窗
     * @param {?} args 单据Id或者单据查询参数
     * @param {?=} maximized 是否最大化弹窗
     * @param {?=} modalOptions 弹窗配置
     * @param {?=} graphOptions 单据追踪图配置
     * @param {?=} gridOptions 单据追踪数据表配置
     * @return {?} billTrackerComponent 单据追踪组件 \@type { Observable<BillTrackerComponent> }
     */
    openDialog(args, maximized, modalOptions, graphOptions, gridOptions) {
        if (args == null || args == "" || ((/** @type {?} */ (args))).trim && ((/** @type {?} */ (args))).trim() == "") {
            this.messagerService.error(this.localePipe.transform("trackerArgsCantBeEmpty"));
            throw "参数args不可为空";
        }
        if (typeof args == "string" && canJSONParse((/** @type {?} */ (args)))) {
            args = JSON.parse((/** @type {?} */ (args)));
        }
        else {
            args = (/** @type {?} */ (args));
        }
        maximized = (/** @type {?} */ (maximized)) === "" || maximized == null ? undefined : maximized;
        if (maximized != null && typeof maximized != "boolean") {
            if (maximized == "false") {
                maximized = false;
            }
            else if (maximized == "true") {
                maximized = true;
            }
            else {
                maximized = undefined;
            }
        }
        modalOptions = (/** @type {?} */ (modalOptions)) === "" || modalOptions == null ? undefined : modalOptions;
        graphOptions = (/** @type {?} */ (graphOptions)) === "" || graphOptions == null ? undefined : graphOptions;
        gridOptions = (/** @type {?} */ (gridOptions)) === "" || gridOptions == null ? undefined : gridOptions;
        /** @type {?} */
        const argz = new GetBillsInfoArgs();
        if (typeof args == "string") {
            argz.billDataId = args;
        }
        else {
            argz.LoadFromJsonObject(args);
        }
        return this.trackerUiService.openDefaultBillTrackerDialog(argz, maximized, modalOptions, graphOptions, gridOptions);
    }
    /**
     * 打开单据追踪App
     * @param {?} args 单据Id或者单据查询参数
     * @param {?=} graphOptions 单据追踪图配置
     * @param {?=} gridOptions 单据追踪数据表配置
     * @return {?}
     */
    openApp(args, graphOptions, gridOptions) {
        if (args == null || args == "" || ((/** @type {?} */ (args))).trim && ((/** @type {?} */ (args))).trim() == "") {
            this.messagerService.error(this.localePipe.transform("trackerArgsCantBeEmpty"));
            throw "参数args不可为空";
        }
        if (typeof args == "string" && canJSONParse((/** @type {?} */ (args)))) {
            args = JSON.parse((/** @type {?} */ (args)));
        }
        else {
            args = (/** @type {?} */ (args));
        }
        graphOptions = (/** @type {?} */ (graphOptions)) === "" || graphOptions == null ? undefined : graphOptions;
        gridOptions = (/** @type {?} */ (gridOptions)) === "" || gridOptions == null ? undefined : gridOptions;
        /** @type {?} */
        const argz = new GetBillsInfoArgs();
        if (typeof args == "string") {
            argz.billDataId = args;
        }
        else {
            argz.LoadFromJsonObject(args);
        }
        this.trackerUiService.openDefaultBillTrackerApp(argz, graphOptions, gridOptions);
    }
}
BifBillTrackerWebCmpService.decorators = [
    { type: Injectable }
];
/** @nocollapse */
BifBillTrackerWebCmpService.ctorParameters = () => [
    { type: BillTrackerUiService },
    { type: BindingData, decorators: [{ type: Optional }] },
    { type: ViewModel, decorators: [{ type: Optional }] },
    { type: FrameContext, decorators: [{ type: Optional }] },
    { type: Injector, decorators: [{ type: Optional }] },
    { type: ComponentFactoryResolver, decorators: [{ type: Optional }] },
    { type: String, decorators: [{ type: Inject, args: [LOCALE_ID,] }] },
    { type: MessagerService, decorators: [{ type: Optional }] }
];
if (false) {
    /** @type {?} */
    BifBillTrackerWebCmpService.prototype.localePipe;
    /** @type {?} */
    BifBillTrackerWebCmpService.prototype.trackerUiService;
    /** @type {?} */
    BifBillTrackerWebCmpService.prototype.bindingData;
    /** @type {?} */
    BifBillTrackerWebCmpService.prototype.viewModel;
    /** @type {?} */
    BifBillTrackerWebCmpService.prototype.frameContext;
    /** @type {?} */
    BifBillTrackerWebCmpService.prototype.inj;
    /** @type {?} */
    BifBillTrackerWebCmpService.prototype.cfr;
    /** @type {?} */
    BifBillTrackerWebCmpService.prototype.localeId;
    /** @type {?} */
    BifBillTrackerWebCmpService.prototype.messagerService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmlmLWJpbGwtdHJhY2tlci53ZWJjbXAuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BlZHAtYmlmL3J1bnRpbWUtYXBpLyIsInNvdXJjZXMiOlsibGliL3dlYmNtcC9iaWYtYmlsbC10cmFja2VyLndlYmNtcC5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsT0FBTyxFQUFFLHdCQUF3QixFQUFFLE1BQU0sRUFBRSxVQUFVLEVBQUUsUUFBUSxFQUFFLFNBQVMsRUFBRSxRQUFRLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDaEksT0FBTyxFQUFFLG9CQUFvQixFQUFFLE1BQU0sa0RBQWtELENBQUM7QUFDeEYsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0scUNBQXFDLENBQUM7QUFJdkUsT0FBTyxFQUFFLFdBQVcsRUFBRSxTQUFTLEVBQUUsWUFBWSxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFHdEUsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBQ3BELE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUN0RCxPQUFPLEVBQUUscUJBQXFCLEVBQUUsTUFBTSwrQ0FBK0MsQ0FBQzs7OztBQU10RixNQUFNLE9BQU8sMkJBQTJCOzs7Ozs7Ozs7OztJQUd0QyxZQUNTLGdCQUFzQyxFQUMxQixXQUF3QixFQUN4QixTQUFvQixFQUNwQixZQUEwQixFQUMxQixHQUFhLEVBQ2IsR0FBNkIsRUFDdEIsUUFBZ0IsRUFDdkIsZUFBZ0M7UUFQNUMscUJBQWdCLEdBQWhCLGdCQUFnQixDQUFzQjtRQUMxQixnQkFBVyxHQUFYLFdBQVcsQ0FBYTtRQUN4QixjQUFTLEdBQVQsU0FBUyxDQUFXO1FBQ3BCLGlCQUFZLEdBQVosWUFBWSxDQUFjO1FBQzFCLFFBQUcsR0FBSCxHQUFHLENBQVU7UUFDYixRQUFHLEdBQUgsR0FBRyxDQUEwQjtRQUN0QixhQUFRLEdBQVIsUUFBUSxDQUFRO1FBQ3ZCLG9CQUFlLEdBQWYsZUFBZSxDQUFpQjtRQUVuRCxJQUFJLEdBQUcsSUFBSSxJQUFJLEVBQUU7O2tCQUNULE1BQU0sR0FBRyxrQkFBa0IsQ0FBQyxnQkFBZ0IsQ0FBQyxFQUFFLEVBQUUsSUFBSSxDQUFDLFlBQVksSUFBSSxJQUFJLENBQUMsWUFBWSxDQUFDLFFBQVEsQ0FBQztZQUN2RyxJQUFJLENBQUMsR0FBRyxHQUFHLE1BQU0sQ0FBQztTQUNuQjtRQUVELElBQUksQ0FBQyxHQUFHLEdBQUcsR0FBRyxJQUFJLElBQUksQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLHdCQUF3QixDQUFDLENBQUM7UUFDekQsSUFBSSxDQUFDLFFBQVEsR0FBRyxRQUFRLElBQUksSUFBSSxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsU0FBUyxFQUFFLElBQUksQ0FBQyxJQUFJLFFBQVEsQ0FBQztRQUN0RSxJQUFJLENBQUMsZUFBZSxHQUFHLGVBQWUsSUFBSSxJQUFJLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxlQUFlLEVBQUUsSUFBSSxDQUFDLENBQUM7UUFDOUUsSUFBSSxDQUFDLFVBQVUsR0FBRyxJQUFJLENBQUMsZ0JBQWdCLElBQUksSUFBSSxDQUFDLGdCQUFnQixDQUFDLFVBQVUsSUFBSSxJQUFJLHFCQUFxQixDQUFDLFFBQVEsQ0FBQyxDQUFDO0lBQ3JILENBQUM7Ozs7Ozs7Ozs7SUFXTSxVQUFVLENBQUMsSUFBK0IsRUFBRSxTQUFtQixFQUFFLFlBQTJCLEVBQUUsWUFBc0MsRUFBRSxXQUFvQztRQUMvSyxJQUFJLElBQUksSUFBSSxJQUFJLElBQUksSUFBSSxJQUFJLEVBQUUsSUFBSSxDQUFDLG1CQUFBLElBQUksRUFBTyxDQUFDLENBQUMsSUFBSSxJQUFJLENBQUMsbUJBQUEsSUFBSSxFQUFPLENBQUMsQ0FBQyxJQUFJLEVBQUUsSUFBSSxFQUFFLEVBQUU7WUFDbEYsSUFBSSxDQUFDLGVBQWUsQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxTQUFTLENBQUMsd0JBQXdCLENBQUMsQ0FBQyxDQUFDO1lBQ2hGLE1BQU0sWUFBWSxDQUFDO1NBQ3BCO1FBQ0QsSUFBSSxPQUFPLElBQUksSUFBSSxRQUFRLElBQUksWUFBWSxDQUFDLG1CQUFBLElBQUksRUFBVSxDQUFDLEVBQUU7WUFDM0QsSUFBSSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsbUJBQUEsSUFBSSxFQUFVLENBQUMsQ0FBQztTQUNuQzthQUFNO1lBQ0wsSUFBSSxHQUFHLG1CQUFBLElBQUksRUFBVSxDQUFDO1NBQ3ZCO1FBQ0QsU0FBUyxHQUFHLG1CQUFBLFNBQVMsRUFBTyxLQUFLLEVBQUUsSUFBSSxTQUFTLElBQUksSUFBSSxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQztRQUNqRixJQUFJLFNBQVMsSUFBSSxJQUFJLElBQUksT0FBTyxTQUFTLElBQUksU0FBUyxFQUFFO1lBQ3RELElBQUksU0FBUyxJQUFJLE9BQU8sRUFBRTtnQkFDeEIsU0FBUyxHQUFHLEtBQUssQ0FBQzthQUNuQjtpQkFBTSxJQUFJLFNBQVMsSUFBSSxNQUFNLEVBQUU7Z0JBQzlCLFNBQVMsR0FBRyxJQUFJLENBQUM7YUFDbEI7aUJBQU07Z0JBQ0wsU0FBUyxHQUFHLFNBQVMsQ0FBQzthQUN2QjtTQUNGO1FBQ0QsWUFBWSxHQUFHLG1CQUFBLFlBQVksRUFBTyxLQUFLLEVBQUUsSUFBSSxZQUFZLElBQUksSUFBSSxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLFlBQVksQ0FBQztRQUM3RixZQUFZLEdBQUcsbUJBQUEsWUFBWSxFQUFPLEtBQUssRUFBRSxJQUFJLFlBQVksSUFBSSxJQUFJLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsWUFBWSxDQUFDO1FBQzdGLFdBQVcsR0FBRyxtQkFBQSxXQUFXLEVBQU8sS0FBSyxFQUFFLElBQUksV0FBVyxJQUFJLElBQUksQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxXQUFXLENBQUM7O2NBRW5GLElBQUksR0FBRyxJQUFJLGdCQUFnQixFQUFFO1FBQ25DLElBQUksT0FBTyxJQUFJLElBQUksUUFBUSxFQUFFO1lBQzNCLElBQUksQ0FBQyxVQUFVLEdBQUcsSUFBSSxDQUFDO1NBQ3hCO2FBQU07WUFDTCxJQUFJLENBQUMsa0JBQWtCLENBQUMsSUFBSSxDQUFDLENBQUM7U0FDL0I7UUFFRCxPQUFPLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyw0QkFBNEIsQ0FBQyxJQUFJLEVBQUUsU0FBUyxFQUFFLFlBQVksRUFBRSxZQUFZLEVBQUUsV0FBVyxDQUFDLENBQUM7SUFDdEgsQ0FBQzs7Ozs7Ozs7SUFRTSxPQUFPLENBQUMsSUFBK0IsRUFBRSxZQUFzQyxFQUFFLFdBQW9DO1FBQzFILElBQUksSUFBSSxJQUFJLElBQUksSUFBSSxJQUFJLElBQUksRUFBRSxJQUFJLENBQUMsbUJBQUEsSUFBSSxFQUFPLENBQUMsQ0FBQyxJQUFJLElBQUksQ0FBQyxtQkFBQSxJQUFJLEVBQU8sQ0FBQyxDQUFDLElBQUksRUFBRSxJQUFJLEVBQUUsRUFBRTtZQUNsRixJQUFJLENBQUMsZUFBZSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLFNBQVMsQ0FBQyx3QkFBd0IsQ0FBQyxDQUFDLENBQUM7WUFDaEYsTUFBTSxZQUFZLENBQUM7U0FDcEI7UUFDRCxJQUFJLE9BQU8sSUFBSSxJQUFJLFFBQVEsSUFBSSxZQUFZLENBQUMsbUJBQUEsSUFBSSxFQUFVLENBQUMsRUFBRTtZQUMzRCxJQUFJLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxtQkFBQSxJQUFJLEVBQVUsQ0FBQyxDQUFDO1NBQ25DO2FBQU07WUFDTCxJQUFJLEdBQUcsbUJBQUEsSUFBSSxFQUFVLENBQUM7U0FDdkI7UUFDRCxZQUFZLEdBQUcsbUJBQUEsWUFBWSxFQUFPLEtBQUssRUFBRSxJQUFJLFlBQVksSUFBSSxJQUFJLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsWUFBWSxDQUFDO1FBQzdGLFdBQVcsR0FBRyxtQkFBQSxXQUFXLEVBQU8sS0FBSyxFQUFFLElBQUksV0FBVyxJQUFJLElBQUksQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxXQUFXLENBQUM7O2NBRW5GLElBQUksR0FBRyxJQUFJLGdCQUFnQixFQUFFO1FBQ25DLElBQUksT0FBTyxJQUFJLElBQUksUUFBUSxFQUFFO1lBQzNCLElBQUksQ0FBQyxVQUFVLEdBQUcsSUFBSSxDQUFDO1NBQ3hCO2FBQU07WUFDTCxJQUFJLENBQUMsa0JBQWtCLENBQUMsSUFBSSxDQUFDLENBQUM7U0FDL0I7UUFFRCxJQUFJLENBQUMsZ0JBQWdCLENBQUMseUJBQXlCLENBQUMsSUFBSSxFQUFFLFlBQVksRUFBRSxXQUFXLENBQUMsQ0FBQztJQUNuRixDQUFDOzs7WUEvRkYsVUFBVTs7OztZQWZGLG9CQUFvQjtZQUtwQixXQUFXLHVCQWdCZixRQUFRO1lBaEJTLFNBQVMsdUJBaUIxQixRQUFRO1lBakJvQixZQUFZLHVCQWtCeEMsUUFBUTtZQXhCMEMsUUFBUSx1QkF5QjFELFFBQVE7WUF6Qkosd0JBQXdCLHVCQTBCNUIsUUFBUTt5Q0FDUixNQUFNLFNBQUMsU0FBUztZQWpCWixlQUFlLHVCQWtCbkIsUUFBUTs7OztJQVZYLGlEQUFrQzs7SUFHaEMsdURBQTZDOztJQUM3QyxrREFBMkM7O0lBQzNDLGdEQUF1Qzs7SUFDdkMsbURBQTZDOztJQUM3QywwQ0FBZ0M7O0lBQ2hDLDBDQUFnRDs7SUFDaEQsK0NBQTBDOztJQUMxQyxzREFBbUQiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIsIEluamVjdCwgSW5qZWN0YWJsZSwgSW5qZWN0b3IsIExPQ0FMRV9JRCwgT3B0aW9uYWwsIFJlZmxlY3RpdmVJbmplY3RvciB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBCaWxsVHJhY2tlclVpU2VydmljZSB9IGZyb20gJy4uL2JpbGwtdHJhY2tlci9zZXJ2aWNlcy9iaWxsLXRyYWNrZXItdWkuc2VydmljZSc7XHJcbmltcG9ydCB7IEdldEJpbGxzSW5mb0FyZ3MgfSBmcm9tICcuLi9lbnRpdHkvdHJhY2tpbmcvR2V0QmlsbHNJbmZvQXJncyc7XHJcbmltcG9ydCB7IE1vZGFsT3B0aW9ucyB9IGZyb20gJ0BmYXJyaXMvdWktbW9kYWwnO1xyXG5pbXBvcnQgeyBCaWxsVHJhY2tlckdyYXBoT3B0aW9ucyB9IGZyb20gJy4uL2JpbGwtdHJhY2tlci9jb25maWcvYmlsbC10cmFja2VyLWdyYXBoLW9wdGlvbnMnO1xyXG5pbXBvcnQgeyBCaWxsVHJhY2tlckdyaWRPcHRpb25zIH0gZnJvbSAnLi4vYmlsbC10cmFja2VyL2NvbmZpZy9iaWxsLXRyYWNrZXItZ3JpZC1vcHRpb25zJztcclxuaW1wb3J0IHsgQmluZGluZ0RhdGEsIFZpZXdNb2RlbCwgRnJhbWVDb250ZXh0IH0gZnJvbSAnQGZhcnJpcy9kZXZraXQnO1xyXG5pbXBvcnQgeyBPYnNlcnZhYmxlIH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7IEJpbGxUcmFja2VyQ29tcG9uZW50IH0gZnJvbSAnLi4vYmlsbC10cmFja2VyL2NvbXBvbmVudHMvYmlsbC10cmFja2VyL2JpbGwtdHJhY2tlci5jb21wb25lbnQnO1xyXG5pbXBvcnQgeyBjYW5KU09OUGFyc2UgfSBmcm9tICcuLi91dGlscy9PYmplY3RVdGlscyc7XHJcbmltcG9ydCB7IE1lc3NhZ2VyU2VydmljZSB9IGZyb20gJ0BmYXJyaXMvdWktbWVzc2FnZXInO1xyXG5pbXBvcnQgeyBCaWxsVHJhY2tlckxvY2FsZVBpcGUgfSBmcm9tICcuLi9iaWxsLXRyYWNrZXIvcGlwZS9iaWxsLXRyYWNrZXItbG9jYWxlLnBpcGUnO1xyXG5cclxuLyoqXHJcbiAqIOWNleaNrui/vei4qndlYuaehOS7tuacjeWKoeexu1xyXG4gKi9cclxuQEluamVjdGFibGUoKVxyXG5leHBvcnQgY2xhc3MgQmlmQmlsbFRyYWNrZXJXZWJDbXBTZXJ2aWNlIHtcclxuICBsb2NhbGVQaXBlOiBCaWxsVHJhY2tlckxvY2FsZVBpcGU7XHJcblxyXG4gIGNvbnN0cnVjdG9yKFxyXG4gICAgcHVibGljIHRyYWNrZXJVaVNlcnZpY2U6IEJpbGxUcmFja2VyVWlTZXJ2aWNlLFxyXG4gICAgQE9wdGlvbmFsKCkgcHVibGljIGJpbmRpbmdEYXRhOiBCaW5kaW5nRGF0YSxcclxuICAgIEBPcHRpb25hbCgpIHB1YmxpYyB2aWV3TW9kZWw6IFZpZXdNb2RlbCxcclxuICAgIEBPcHRpb25hbCgpIHB1YmxpYyBmcmFtZUNvbnRleHQ6IEZyYW1lQ29udGV4dCxcclxuICAgIEBPcHRpb25hbCgpIHB1YmxpYyBpbmo6IEluamVjdG9yLFxyXG4gICAgQE9wdGlvbmFsKCkgcHVibGljIGNmcjogQ29tcG9uZW50RmFjdG9yeVJlc29sdmVyLFxyXG4gICAgQEluamVjdChMT0NBTEVfSUQpIHB1YmxpYyBsb2NhbGVJZDogc3RyaW5nLFxyXG4gICAgQE9wdGlvbmFsKCkgcHVibGljIG1lc3NhZ2VyU2VydmljZTogTWVzc2FnZXJTZXJ2aWNlLFxyXG4gICkge1xyXG4gICAgaWYgKGluaiA9PSBudWxsKSB7XHJcbiAgICAgIGNvbnN0IHJlZkluaiA9IFJlZmxlY3RpdmVJbmplY3Rvci5yZXNvbHZlQW5kQ3JlYXRlKFtdLCB0aGlzLmZyYW1lQ29udGV4dCAmJiB0aGlzLmZyYW1lQ29udGV4dC5pbmplY3Rvcik7XHJcbiAgICAgIHRoaXMuaW5qID0gcmVmSW5qO1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMuY2ZyID0gY2ZyIHx8IHRoaXMuaW5qLmdldChDb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIpO1xyXG4gICAgdGhpcy5sb2NhbGVJZCA9IGxvY2FsZUlkIHx8IHRoaXMuaW5qLmdldChMT0NBTEVfSUQsIG51bGwpIHx8ICd6aC1DSFMnO1xyXG4gICAgdGhpcy5tZXNzYWdlclNlcnZpY2UgPSBtZXNzYWdlclNlcnZpY2UgfHwgdGhpcy5pbmouZ2V0KE1lc3NhZ2VyU2VydmljZSwgbnVsbCk7XHJcbiAgICB0aGlzLmxvY2FsZVBpcGUgPSB0aGlzLnRyYWNrZXJVaVNlcnZpY2UgJiYgdGhpcy50cmFja2VyVWlTZXJ2aWNlLmxvY2FsZVBpcGUgfHwgbmV3IEJpbGxUcmFja2VyTG9jYWxlUGlwZShsb2NhbGVJZCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDmiZPlvIDljZXmja7ov73ouKrlvLnnqpdcclxuICAgKiBAcGFyYW0gYXJncyDljZXmja5JZOaIluiAheWNleaNruafpeivouWPguaVsFxyXG4gICAqIEBwYXJhbSBtYXhpbWl6ZWQg5piv5ZCm5pyA5aSn5YyW5by556qXXHJcbiAgICogQHBhcmFtIG1vZGFsT3B0aW9ucyDlvLnnqpfphY3nva5cclxuICAgKiBAcGFyYW0gZ3JhcGhPcHRpb25zIOWNleaNrui/vei4quWbvumFjee9rlxyXG4gICAqIEBwYXJhbSBncmlkT3B0aW9ucyDljZXmja7ov73ouKrmlbDmja7ooajphY3nva5cclxuICAgKiBAcmV0dXJucyBiaWxsVHJhY2tlckNvbXBvbmVudCDljZXmja7ov73ouKrnu4Tku7YgQHR5cGUgeyBPYnNlcnZhYmxlPEJpbGxUcmFja2VyQ29tcG9uZW50PiB9XHJcbiAgICovXHJcbiAgcHVibGljIG9wZW5EaWFsb2coYXJnczogc3RyaW5nIHwgR2V0QmlsbHNJbmZvQXJncywgbWF4aW1pemVkPzogYm9vbGVhbiwgbW9kYWxPcHRpb25zPzogTW9kYWxPcHRpb25zLCBncmFwaE9wdGlvbnM/OiBCaWxsVHJhY2tlckdyYXBoT3B0aW9ucywgZ3JpZE9wdGlvbnM/OiBCaWxsVHJhY2tlckdyaWRPcHRpb25zKTogT2JzZXJ2YWJsZTxCaWxsVHJhY2tlckNvbXBvbmVudD4ge1xyXG4gICAgaWYgKGFyZ3MgPT0gbnVsbCB8fCBhcmdzID09IFwiXCIgfHwgKGFyZ3MgYXMgYW55KS50cmltICYmIChhcmdzIGFzIGFueSkudHJpbSgpID09IFwiXCIpIHtcclxuICAgICAgdGhpcy5tZXNzYWdlclNlcnZpY2UuZXJyb3IodGhpcy5sb2NhbGVQaXBlLnRyYW5zZm9ybShcInRyYWNrZXJBcmdzQ2FudEJlRW1wdHlcIikpO1xyXG4gICAgICB0aHJvdyBcIuWPguaVsGFyZ3PkuI3lj6/kuLrnqbpcIjtcclxuICAgIH1cclxuICAgIGlmICh0eXBlb2YgYXJncyA9PSBcInN0cmluZ1wiICYmIGNhbkpTT05QYXJzZShhcmdzIGFzIHN0cmluZykpIHtcclxuICAgICAgYXJncyA9IEpTT04ucGFyc2UoYXJncyBhcyBzdHJpbmcpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgYXJncyA9IGFyZ3MgYXMgc3RyaW5nO1xyXG4gICAgfVxyXG4gICAgbWF4aW1pemVkID0gbWF4aW1pemVkIGFzIGFueSA9PT0gXCJcIiB8fCBtYXhpbWl6ZWQgPT0gbnVsbCA/IHVuZGVmaW5lZCA6IG1heGltaXplZDtcclxuICAgIGlmIChtYXhpbWl6ZWQgIT0gbnVsbCAmJiB0eXBlb2YgbWF4aW1pemVkICE9IFwiYm9vbGVhblwiKSB7XHJcbiAgICAgIGlmIChtYXhpbWl6ZWQgPT0gXCJmYWxzZVwiKSB7XHJcbiAgICAgICAgbWF4aW1pemVkID0gZmFsc2U7XHJcbiAgICAgIH0gZWxzZSBpZiAobWF4aW1pemVkID09IFwidHJ1ZVwiKSB7XHJcbiAgICAgICAgbWF4aW1pemVkID0gdHJ1ZTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBtYXhpbWl6ZWQgPSB1bmRlZmluZWQ7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIG1vZGFsT3B0aW9ucyA9IG1vZGFsT3B0aW9ucyBhcyBhbnkgPT09IFwiXCIgfHwgbW9kYWxPcHRpb25zID09IG51bGwgPyB1bmRlZmluZWQgOiBtb2RhbE9wdGlvbnM7XHJcbiAgICBncmFwaE9wdGlvbnMgPSBncmFwaE9wdGlvbnMgYXMgYW55ID09PSBcIlwiIHx8IGdyYXBoT3B0aW9ucyA9PSBudWxsID8gdW5kZWZpbmVkIDogZ3JhcGhPcHRpb25zO1xyXG4gICAgZ3JpZE9wdGlvbnMgPSBncmlkT3B0aW9ucyBhcyBhbnkgPT09IFwiXCIgfHwgZ3JpZE9wdGlvbnMgPT0gbnVsbCA/IHVuZGVmaW5lZCA6IGdyaWRPcHRpb25zO1xyXG5cclxuICAgIGNvbnN0IGFyZ3ogPSBuZXcgR2V0QmlsbHNJbmZvQXJncygpO1xyXG4gICAgaWYgKHR5cGVvZiBhcmdzID09IFwic3RyaW5nXCIpIHtcclxuICAgICAgYXJnei5iaWxsRGF0YUlkID0gYXJncztcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGFyZ3ouTG9hZEZyb21Kc29uT2JqZWN0KGFyZ3MpO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB0aGlzLnRyYWNrZXJVaVNlcnZpY2Uub3BlbkRlZmF1bHRCaWxsVHJhY2tlckRpYWxvZyhhcmd6LCBtYXhpbWl6ZWQsIG1vZGFsT3B0aW9ucywgZ3JhcGhPcHRpb25zLCBncmlkT3B0aW9ucyk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDmiZPlvIDljZXmja7ov73ouKpBcHBcclxuICAgKiBAcGFyYW0gYXJncyDljZXmja5JZOaIluiAheWNleaNruafpeivouWPguaVsFxyXG4gICAqIEBwYXJhbSBncmFwaE9wdGlvbnMg5Y2V5o2u6L+96Liq5Zu+6YWN572uXHJcbiAgICogQHBhcmFtIGdyaWRPcHRpb25zIOWNleaNrui/vei4quaVsOaNruihqOmFjee9rlxyXG4gICAqL1xyXG4gIHB1YmxpYyBvcGVuQXBwKGFyZ3M6IHN0cmluZyB8IEdldEJpbGxzSW5mb0FyZ3MsIGdyYXBoT3B0aW9ucz86IEJpbGxUcmFja2VyR3JhcGhPcHRpb25zLCBncmlkT3B0aW9ucz86IEJpbGxUcmFja2VyR3JpZE9wdGlvbnMpIHtcclxuICAgIGlmIChhcmdzID09IG51bGwgfHwgYXJncyA9PSBcIlwiIHx8IChhcmdzIGFzIGFueSkudHJpbSAmJiAoYXJncyBhcyBhbnkpLnRyaW0oKSA9PSBcIlwiKSB7XHJcbiAgICAgIHRoaXMubWVzc2FnZXJTZXJ2aWNlLmVycm9yKHRoaXMubG9jYWxlUGlwZS50cmFuc2Zvcm0oXCJ0cmFja2VyQXJnc0NhbnRCZUVtcHR5XCIpKTtcclxuICAgICAgdGhyb3cgXCLlj4LmlbBhcmdz5LiN5Y+v5Li656m6XCI7XHJcbiAgICB9XHJcbiAgICBpZiAodHlwZW9mIGFyZ3MgPT0gXCJzdHJpbmdcIiAmJiBjYW5KU09OUGFyc2UoYXJncyBhcyBzdHJpbmcpKSB7XHJcbiAgICAgIGFyZ3MgPSBKU09OLnBhcnNlKGFyZ3MgYXMgc3RyaW5nKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGFyZ3MgPSBhcmdzIGFzIHN0cmluZztcclxuICAgIH1cclxuICAgIGdyYXBoT3B0aW9ucyA9IGdyYXBoT3B0aW9ucyBhcyBhbnkgPT09IFwiXCIgfHwgZ3JhcGhPcHRpb25zID09IG51bGwgPyB1bmRlZmluZWQgOiBncmFwaE9wdGlvbnM7XHJcbiAgICBncmlkT3B0aW9ucyA9IGdyaWRPcHRpb25zIGFzIGFueSA9PT0gXCJcIiB8fCBncmlkT3B0aW9ucyA9PSBudWxsID8gdW5kZWZpbmVkIDogZ3JpZE9wdGlvbnM7XHJcblxyXG4gICAgY29uc3QgYXJneiA9IG5ldyBHZXRCaWxsc0luZm9BcmdzKCk7XHJcbiAgICBpZiAodHlwZW9mIGFyZ3MgPT0gXCJzdHJpbmdcIikge1xyXG4gICAgICBhcmd6LmJpbGxEYXRhSWQgPSBhcmdzO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgYXJnei5Mb2FkRnJvbUpzb25PYmplY3QoYXJncyk7XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy50cmFja2VyVWlTZXJ2aWNlLm9wZW5EZWZhdWx0QmlsbFRyYWNrZXJBcHAoYXJneiwgZ3JhcGhPcHRpb25zLCBncmlkT3B0aW9ucyk7XHJcbiAgfVxyXG59XHJcbiJdfQ==
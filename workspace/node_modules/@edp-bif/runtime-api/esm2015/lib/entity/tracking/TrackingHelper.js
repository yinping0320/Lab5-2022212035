/**
 * @fileoverview added by tsickle
 * Generated from: lib/entity/tracking/TrackingHelper.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
export class TrackingHelper {
    /**
     * @param {?} originalDownBillInfos
     * @param {?} downBillInfos
     * @return {?}
     */
    static concatDownBillInfos(originalDownBillInfos, downBillInfos) {
        if (originalDownBillInfos == null) {
            originalDownBillInfos = new Array();
        }
        if (downBillInfos == null || downBillInfos.length == 0) {
            return originalDownBillInfos;
        }
        /** @type {?} */
        let originalVoIds = new Array();
        originalDownBillInfos.forEach((/**
         * @param {?} info
         * @return {?}
         */
        info => originalVoIds.push(info.schemaId)));
        for (let downBillInfo of downBillInfos) {
            //是否存在某类单据
            if (originalVoIds.includes(downBillInfo.schemaId)) {
                for (let oldDownBillInfo of originalDownBillInfos) {
                    if (oldDownBillInfo.schemaId == downBillInfo.schemaId) {
                        /** @type {?} */
                        let oldBillDataInfos = oldDownBillInfo.billDataInfos;
                        /** @type {?} */
                        let dataIds = new Array();
                        oldBillDataInfos.forEach((/**
                         * @param {?} dataInfo
                         * @return {?}
                         */
                        dataInfo => dataIds.push(dataInfo.dataId)));
                        for (let billDataInfo of downBillInfo.billDataInfos) {
                            //是否存在某张单据
                            if (dataIds.includes(billDataInfo.dataId)) {
                                for (let oldBillDataInfo of oldBillDataInfos) {
                                    if (oldBillDataInfo.dataId == billDataInfo.dataId) {
                                        /** @type {?} */
                                        let oldAssociations = oldBillDataInfo.trackingMappingAssociations;
                                        for (let association of billDataInfo.trackingMappingAssociations) {
                                            /** @type {?} */
                                            let i = 0;
                                            for (let association1 of oldAssociations) {
                                                //是否存在某条记录
                                                if (!(association.downBillDataIdPath == association1.downBillDataIdPath) ||
                                                    !(association.downBillTableCodePath == association1.downBillTableCodePath) ||
                                                    !(association.upBillDataIdPath == association1.upBillDataIdPath) ||
                                                    !(association.upBillTableCodePath == association1.upBillTableCodePath)) {
                                                    i++;
                                                }
                                            }
                                            if (i == oldAssociations.length) {
                                                oldAssociations.push(association);
                                            }
                                        }
                                    }
                                }
                            }
                            else {
                                oldBillDataInfos.push(billDataInfo);
                            }
                        }
                    }
                }
            }
            else {
                originalVoIds.push(downBillInfo.schemaId);
                originalDownBillInfos.push(downBillInfo);
            }
        }
        return originalDownBillInfos;
    }
    /**
     * @param {?} originalUpBillInfos
     * @param {?} upBillInfos
     * @return {?}
     */
    static concatUpBillInfos(originalUpBillInfos, upBillInfos) {
        if (originalUpBillInfos == null) {
            originalUpBillInfos = new Array();
        }
        if (upBillInfos == null || upBillInfos.length == 0) {
            return originalUpBillInfos;
        }
        /** @type {?} */
        let originalVoIds = new Array();
        originalUpBillInfos.forEach((/**
         * @param {?} info
         * @return {?}
         */
        info => {
            originalVoIds.push(info.schemaId);
        }));
        for (let upBillInfo of upBillInfos) {
            //是否存在某类单据
            if (originalVoIds.includes(upBillInfo.schemaId)) {
                for (let oldUpBillInfo of originalUpBillInfos) {
                    if (oldUpBillInfo.schemaId == upBillInfo.schemaId) {
                        /** @type {?} */
                        let oldBillDataInfos = oldUpBillInfo.billDataInfos;
                        /** @type {?} */
                        let dataIds = new Array();
                        oldBillDataInfos.forEach((/**
                         * @param {?} dataInfo
                         * @return {?}
                         */
                        dataInfo => dataIds.push(dataInfo.dataId)));
                        for (let billDataInfo of upBillInfo.billDataInfos) {
                            //是否存在某张单据
                            if (dataIds.includes(billDataInfo.dataId)) {
                                for (let oldBillDataInfo of oldBillDataInfos) {
                                    if (oldBillDataInfo.dataId == billDataInfo.dataId) {
                                        /** @type {?} */
                                        let oldAssociations = oldBillDataInfo.trackingMappingAssociations;
                                        for (let association of billDataInfo.trackingMappingAssociations) {
                                            /** @type {?} */
                                            let i = 0;
                                            for (let association1 of oldAssociations) {
                                                //是否存在某条记录
                                                if (!(association.downBillDataIdPath == association1.downBillDataIdPath) ||
                                                    !(association.downBillTableCodePath == association1.downBillTableCodePath) ||
                                                    !(association.upBillDataIdPath == association1.upBillDataIdPath) ||
                                                    !(association.upBillTableCodePath == association1.upBillTableCodePath)) {
                                                    i++;
                                                }
                                            }
                                            if (i == oldAssociations.length) {
                                                oldAssociations.push(association);
                                            }
                                        }
                                    }
                                }
                            }
                            else {
                                oldBillDataInfos.push(billDataInfo);
                            }
                        }
                    }
                }
            }
            else {
                originalVoIds.push(upBillInfo.schemaId);
                originalUpBillInfos.push(upBillInfo);
            }
        }
        return originalUpBillInfos;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVHJhY2tpbmdIZWxwZXIuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZWRwLWJpZi9ydW50aW1lLWFwaS8iLCJzb3VyY2VzIjpbImxpYi9lbnRpdHkvdHJhY2tpbmcvVHJhY2tpbmdIZWxwZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFLQSxNQUFNLE9BQU8sY0FBYzs7Ozs7O0lBQ2hCLE1BQU0sQ0FBQyxtQkFBbUIsQ0FBQyxxQkFBMEMsRUFBRSxhQUFrQztRQUM1RyxJQUFJLHFCQUFxQixJQUFJLElBQUksRUFBRTtZQUMvQixxQkFBcUIsR0FBRyxJQUFJLEtBQUssRUFBRSxDQUFDO1NBQ3ZDO1FBRUQsSUFBSSxhQUFhLElBQUksSUFBSSxJQUFJLGFBQWEsQ0FBQyxNQUFNLElBQUksQ0FBQyxFQUFFO1lBQ3BELE9BQU8scUJBQXFCLENBQUM7U0FDaEM7O1lBRUcsYUFBYSxHQUFrQixJQUFJLEtBQUssRUFBRTtRQUM5QyxxQkFBcUIsQ0FBQyxPQUFPOzs7O1FBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsRUFBQyxDQUFDO1FBRXpFLEtBQUssSUFBSSxZQUFZLElBQUksYUFBYSxFQUFFO1lBQ3BDLFVBQVU7WUFDVixJQUFJLGFBQWEsQ0FBQyxRQUFRLENBQUMsWUFBWSxDQUFDLFFBQVEsQ0FBQyxFQUFFO2dCQUMvQyxLQUFLLElBQUksZUFBZSxJQUFJLHFCQUFxQixFQUFFO29CQUMvQyxJQUFJLGVBQWUsQ0FBQyxRQUFRLElBQUksWUFBWSxDQUFDLFFBQVEsRUFBRTs7NEJBQy9DLGdCQUFnQixHQUF3QixlQUFlLENBQUMsYUFBYTs7NEJBQ3JFLE9BQU8sR0FBa0IsSUFBSSxLQUFLLEVBQUU7d0JBQ3hDLGdCQUFnQixDQUFDLE9BQU87Ozs7d0JBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsRUFBQyxDQUFDO3dC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QUM7Q0FDSiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IERvd25CaWxsSW5mbyB9IGZyb20gJy4vRG93bkJpbGxJbmZvJztcclxuaW1wb3J0IHsgQmlsbERhdGFJbmZvIH0gZnJvbSAnLi9CaWxsRGF0YUluZm8nO1xyXG5pbXBvcnQgeyBUcmFja2luZ01hcHBpbmdBc3NvY2lhdGlvbiB9IGZyb20gJy4vVHJhY2tpbmdNYXBwaW5nQXNzb2NpYXRpb24nO1xyXG5pbXBvcnQgeyBVcEJpbGxJbmZvIH0gZnJvbSAnLi9VcEJpbGxJbmZvJztcclxuXHJcbmV4cG9ydCBjbGFzcyBUcmFja2luZ0hlbHBlciB7XHJcbiAgICBwdWJsaWMgc3RhdGljIGNvbmNhdERvd25CaWxsSW5mb3Mob3JpZ2luYWxEb3duQmlsbEluZm9zOiBBcnJheTxEb3duQmlsbEluZm8+LCBkb3duQmlsbEluZm9zOiBBcnJheTxEb3duQmlsbEluZm8+KTogQXJyYXk8RG93bkJpbGxJbmZvPiB7XHJcbiAgICAgICAgaWYgKG9yaWdpbmFsRG93bkJpbGxJbmZvcyA9PSBudWxsKSB7XHJcbiAgICAgICAgICAgIG9yaWdpbmFsRG93bkJpbGxJbmZvcyA9IG5ldyBBcnJheSgpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKGRvd25CaWxsSW5mb3MgPT0gbnVsbCB8fCBkb3duQmlsbEluZm9zLmxlbmd0aCA9PSAwKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBvcmlnaW5hbERvd25CaWxsSW5mb3M7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBsZXQgb3JpZ2luYWxWb0lkczogQXJyYXk8c3RyaW5nPiA9IG5ldyBBcnJheSgpO1xyXG4gICAgICAgIG9yaWdpbmFsRG93bkJpbGxJbmZvcy5mb3JFYWNoKGluZm8gPT4gb3JpZ2luYWxWb0lkcy5wdXNoKGluZm8uc2NoZW1hSWQpKTtcclxuXHJcbiAgICAgICAgZm9yIChsZXQgZG93bkJpbGxJbmZvIG9mIGRvd25CaWxsSW5mb3MpIHtcclxuICAgICAgICAgICAgLy/mmK/lkKblrZjlnKjmn5DnsbvljZXmja5cclxuICAgICAgICAgICAgaWYgKG9yaWdpbmFsVm9JZHMuaW5jbHVkZXMoZG93bkJpbGxJbmZvLnNjaGVtYUlkKSkge1xyXG4gICAgICAgICAgICAgICAgZm9yIChsZXQgb2xkRG93bkJpbGxJbmZvIG9mIG9yaWdpbmFsRG93bkJpbGxJbmZvcykge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChvbGREb3duQmlsbEluZm8uc2NoZW1hSWQgPT0gZG93bkJpbGxJbmZvLnNjaGVtYUlkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBvbGRCaWxsRGF0YUluZm9zOiBBcnJheTxCaWxsRGF0YUluZm8+ID0gb2xkRG93bkJpbGxJbmZvLmJpbGxEYXRhSW5mb3M7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBkYXRhSWRzOiBBcnJheTxzdHJpbmc+ID0gbmV3IEFycmF5KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9sZEJpbGxEYXRhSW5mb3MuZm9yRWFjaChkYXRhSW5mbyA9PiBkYXRhSWRzLnB1c2goZGF0YUluZm8uZGF0YUlkKSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBiaWxsRGF0YUluZm8gb2YgZG93bkJpbGxJbmZvLmJpbGxEYXRhSW5mb3MpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8v5piv5ZCm5a2Y5Zyo5p+Q5byg5Y2V5o2uXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YUlkcy5pbmNsdWRlcyhiaWxsRGF0YUluZm8uZGF0YUlkKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAobGV0IG9sZEJpbGxEYXRhSW5mbyBvZiBvbGRCaWxsRGF0YUluZm9zKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvbGRCaWxsRGF0YUluZm8uZGF0YUlkID09IGJpbGxEYXRhSW5mby5kYXRhSWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBvbGRBc3NvY2lhdGlvbnM6IEFycmF5PFRyYWNraW5nTWFwcGluZ0Fzc29jaWF0aW9uPiA9IG9sZEJpbGxEYXRhSW5mby50cmFja2luZ01hcHBpbmdBc3NvY2lhdGlvbnM7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgYXNzb2NpYXRpb24gb2YgYmlsbERhdGFJbmZvLnRyYWNraW5nTWFwcGluZ0Fzc29jaWF0aW9ucykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBpID0gMDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBhc3NvY2lhdGlvbjEgb2Ygb2xkQXNzb2NpYXRpb25zKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8v5piv5ZCm5a2Y5Zyo5p+Q5p2h6K6w5b2VXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghKGFzc29jaWF0aW9uLmRvd25CaWxsRGF0YUlkUGF0aCA9PSBhc3NvY2lhdGlvbjEuZG93bkJpbGxEYXRhSWRQYXRoKSB8fFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIShhc3NvY2lhdGlvbi5kb3duQmlsbFRhYmxlQ29kZVBhdGggPT0gYXNzb2NpYXRpb24xLmRvd25CaWxsVGFibGVDb2RlUGF0aCkgfHxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICEoYXNzb2NpYXRpb24udXBCaWxsRGF0YUlkUGF0aCA9PSBhc3NvY2lhdGlvbjEudXBCaWxsRGF0YUlkUGF0aCkgfHxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICEoYXNzb2NpYXRpb24udXBCaWxsVGFibGVDb2RlUGF0aCA9PSBhc3NvY2lhdGlvbjEudXBCaWxsVGFibGVDb2RlUGF0aCkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGkrKztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaSA9PSBvbGRBc3NvY2lhdGlvbnMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9sZEFzc29jaWF0aW9ucy5wdXNoKGFzc29jaWF0aW9uKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbGRCaWxsRGF0YUluZm9zLnB1c2goYmlsbERhdGFJbmZvKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIG9yaWdpbmFsVm9JZHMucHVzaChkb3duQmlsbEluZm8uc2NoZW1hSWQpO1xyXG4gICAgICAgICAgICAgICAgb3JpZ2luYWxEb3duQmlsbEluZm9zLnB1c2goZG93bkJpbGxJbmZvKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIG9yaWdpbmFsRG93bkJpbGxJbmZvcztcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgc3RhdGljIGNvbmNhdFVwQmlsbEluZm9zKG9yaWdpbmFsVXBCaWxsSW5mb3M6IEFycmF5PFVwQmlsbEluZm8+LCB1cEJpbGxJbmZvczogQXJyYXk8VXBCaWxsSW5mbz4pOiBBcnJheTxVcEJpbGxJbmZvPiB7XHJcbiAgICAgICAgaWYgKG9yaWdpbmFsVXBCaWxsSW5mb3MgPT0gbnVsbCkge1xyXG4gICAgICAgICAgICBvcmlnaW5hbFVwQmlsbEluZm9zID0gbmV3IEFycmF5KCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodXBCaWxsSW5mb3MgPT0gbnVsbCB8fCB1cEJpbGxJbmZvcy5sZW5ndGggPT0gMCkge1xyXG4gICAgICAgICAgICByZXR1cm4gb3JpZ2luYWxVcEJpbGxJbmZvcztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGxldCBvcmlnaW5hbFZvSWRzOiBBcnJheTxzdHJpbmc+ID0gbmV3IEFycmF5KCk7XHJcbiAgICAgICAgb3JpZ2luYWxVcEJpbGxJbmZvcy5mb3JFYWNoKGluZm8gPT4ge1xyXG4gICAgICAgICAgICBvcmlnaW5hbFZvSWRzLnB1c2goaW5mby5zY2hlbWFJZCk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGZvciAobGV0IHVwQmlsbEluZm8gb2YgdXBCaWxsSW5mb3MpIHtcclxuICAgICAgICAgICAgLy/mmK/lkKblrZjlnKjmn5DnsbvljZXmja5cclxuICAgICAgICAgICAgaWYgKG9yaWdpbmFsVm9JZHMuaW5jbHVkZXModXBCaWxsSW5mby5zY2hlbWFJZCkpIHtcclxuICAgICAgICAgICAgICAgIGZvciAobGV0IG9sZFVwQmlsbEluZm8gb2Ygb3JpZ2luYWxVcEJpbGxJbmZvcykge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChvbGRVcEJpbGxJbmZvLnNjaGVtYUlkID09IHVwQmlsbEluZm8uc2NoZW1hSWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IG9sZEJpbGxEYXRhSW5mb3M6IEFycmF5PEJpbGxEYXRhSW5mbz4gPSBvbGRVcEJpbGxJbmZvLmJpbGxEYXRhSW5mb3M7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBkYXRhSWRzOiBBcnJheTxzdHJpbmc+ID0gbmV3IEFycmF5KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9sZEJpbGxEYXRhSW5mb3MuZm9yRWFjaChkYXRhSW5mbyA9PiBkYXRhSWRzLnB1c2goZGF0YUluZm8uZGF0YUlkKSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBiaWxsRGF0YUluZm8gb2YgdXBCaWxsSW5mby5iaWxsRGF0YUluZm9zKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL+aYr+WQpuWtmOWcqOafkOW8oOWNleaNrlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGFJZHMuaW5jbHVkZXMoYmlsbERhdGFJbmZvLmRhdGFJZCkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBvbGRCaWxsRGF0YUluZm8gb2Ygb2xkQmlsbERhdGFJbmZvcykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAob2xkQmlsbERhdGFJbmZvLmRhdGFJZCA9PSBiaWxsRGF0YUluZm8uZGF0YUlkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgb2xkQXNzb2NpYXRpb25zOiBBcnJheTxUcmFja2luZ01hcHBpbmdBc3NvY2lhdGlvbj4gPSBvbGRCaWxsRGF0YUluZm8udHJhY2tpbmdNYXBwaW5nQXNzb2NpYXRpb25zO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGFzc29jaWF0aW9uIG9mIGJpbGxEYXRhSW5mby50cmFja2luZ01hcHBpbmdBc3NvY2lhdGlvbnMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgaSA9IDA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgYXNzb2NpYXRpb24xIG9mIG9sZEFzc29jaWF0aW9ucykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL+aYr+WQpuWtmOWcqOafkOadoeiusOW9lVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIShhc3NvY2lhdGlvbi5kb3duQmlsbERhdGFJZFBhdGggPT0gYXNzb2NpYXRpb24xLmRvd25CaWxsRGF0YUlkUGF0aCkgfHxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICEoYXNzb2NpYXRpb24uZG93bkJpbGxUYWJsZUNvZGVQYXRoID09IGFzc29jaWF0aW9uMS5kb3duQmlsbFRhYmxlQ29kZVBhdGgpIHx8XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAhKGFzc29jaWF0aW9uLnVwQmlsbERhdGFJZFBhdGggPT0gYXNzb2NpYXRpb24xLnVwQmlsbERhdGFJZFBhdGgpIHx8XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAhKGFzc29jaWF0aW9uLnVwQmlsbFRhYmxlQ29kZVBhdGggPT0gYXNzb2NpYXRpb24xLnVwQmlsbFRhYmxlQ29kZVBhdGgpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpKys7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGkgPT0gb2xkQXNzb2NpYXRpb25zLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbGRBc3NvY2lhdGlvbnMucHVzaChhc3NvY2lhdGlvbik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb2xkQmlsbERhdGFJbmZvcy5wdXNoKGJpbGxEYXRhSW5mbyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBvcmlnaW5hbFZvSWRzLnB1c2godXBCaWxsSW5mby5zY2hlbWFJZCk7XHJcbiAgICAgICAgICAgICAgICBvcmlnaW5hbFVwQmlsbEluZm9zLnB1c2godXBCaWxsSW5mbyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBvcmlnaW5hbFVwQmlsbEluZm9zO1xyXG4gICAgfVxyXG59Il19
/**
 * @fileoverview added by tsickle
 * Generated from: lib/bill-tracker/components/bill-tracker-data/bill-tracker-data.component.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, ComponentFactoryResolver, Injector, ViewContainerRef, ViewChild, ComponentRef, NgModuleFactoryLoader, ChangeDetectorRef, Optional, LOCALE_ID, Inject, ElementRef } from '@angular/core';
import { BasicTableComponent } from '../basic-table/basic-table.component';
import { BillTrackerDataService } from '../../services/bill-tracker-data.service';
import { LoadingService } from '@farris/ui-loading';
import { MessagerService } from '@farris/ui-messager';
import { BillTrackingSettings, BillTrackingDataShownMode } from '@edp-bif/common-api';
import { from, of } from 'rxjs';
import { switchMap } from 'rxjs/operators';
import { BasicInfoComponent } from '../basic-info/basic-info.component';
import { NotifyService } from '@farris/ui-notify';
import { BsModalService } from '@farris/ui-modal';
import { BillTrackerDataInfoService } from '../../services/bill-tracker-data-info.service';
import { BillTrackerLocalePipe } from '../../pipe/bill-tracker-locale.pipe';
export class BillTrackerDataComponent {
    /**
     * @param {?} notify
     * @param {?} messager
     * @param {?} loading
     * @param {?} modal
     * @param {?} dataService
     * @param {?} inj
     * @param {?} cfr
     * @param {?} cdf
     * @param {?} loader
     * @param {?} localeId
     * @param {?} vcr
     * @param {?} er
     */
    constructor(notify, messager, loading, modal, dataService, inj, cfr, cdf, loader, localeId, vcr, er) {
        this.notify = notify;
        this.messager = messager;
        this.loading = loading;
        this.modal = modal;
        this.dataService = dataService;
        this.inj = inj;
        this.cfr = cfr;
        this.cdf = cdf;
        this.loader = loader;
        this.dataInfoService = new BillTrackerDataInfoService();
        this.localeId = localeId || this.inj.get(LOCALE_ID, null) || 'zh-CHS';
        this.localePipe = new BillTrackerLocalePipe(localeId);
        this.vcr = vcr || this.inj.get(ViewContainerRef, null);
        this.er = er || this.inj.get(ElementRef, null);
    }
    /**
     * @return {?}
     */
    ngOnInit() {
    }
    /**
     * @return {?}
     */
    ngAfterViewInit() {
    }
    /**
     * @return {?}
     */
    clearDataRegion() {
        this.dataRegion.clear();
    }
    /**
     * @param {?} args
     * @param {?=} billInfo
     * @param {?=} billDataInfo
     * @param {?=} res
     * @return {?}
     */
    showDataGrid(args, billInfo, billDataInfo, res) {
        // 单据追踪配置
        /** @type {?} */
        let bts = new BillTrackingSettings();
        if (billInfo && billInfo.billTrackingSettings) {
            bts.LoadFromJson(billInfo.billTrackingSettings);
        }
        if (bts.billTrackingDataShownMode == BillTrackingDataShownMode.CUSTOMFORM) {
            this.showCustomForm(args, billInfo, billDataInfo);
        }
        else {
            this.showGeneralForm(args, billInfo, billDataInfo, res);
        }
    }
    /**
     * 打开通用表单
     * @private
     * @param {?} args
     * @param {?=} billInfo
     * @param {?=} billDataInfo
     * @param {?=} res
     * @param {?=} newBTS
     * @return {?}
     */
    showGeneralForm(args, billInfo, billDataInfo, res, newBTS) {
        if (res != null) {
            this.createDataComp(res, billInfo, billDataInfo);
        }
        else {
            /** @type {?} */
            const l = this.loading.show({ message: this.localePipe.transform("loading") });
            this.dataService.getEntityData(args).subscribe((/**
             * @param {?} res
             * @return {?}
             */
            (res) => {
                this.createDataComp(res, billInfo, billDataInfo);
                l.close();
            }), (/**
             * @param {?} err
             * @return {?}
             */
            (err) => {
                l.close();
                this.messager.error(err.error == null ? err.message : (err.error.Message || err.error.message || err.message));
                throw err;
            }));
        }
    }
    /**
     * 打开自定义表单
     * @private
     * @param {?} args
     * @param {?=} billInfo
     * @param {?=} billDataInfo
     * @return {?}
     */
    showCustomForm(args, billInfo, billDataInfo) {
        /** @type {?} */
        let bts = new BillTrackingSettings();
        if (billInfo && billInfo.billTrackingSettings) {
            bts.LoadFromJson(billInfo.billTrackingSettings);
        }
        /** @type {?} */
        let formContent = JSON.parse(bts.customFormContent);
        /** @type {?} */
        let moduleF$ = null;
        if (formContent.form.endsWith(".js")) {
            // url格式为[js路径]时
            moduleF$ = from(System.import(formContent.form.toLowerCase()).then((/**
             * @param {?} m
             * @return {?}
             */
            m => m))).pipe(switchMap((/**
             * @param {?} m
             * @return {?}
             */
            (m) => {
                for (let key in m) {
                    return of(m[key]);
                }
                return of(null);
            })));
        }
        else {
            // url格式为[js路径#模块名]时
            moduleF$ = from(this.loader.load(formContent.form));
        }
        moduleF$.subscribe((/**
         * @param {?} moduleFactory
         * @return {?}
         */
        (moduleFactory) => {
            /** @type {?} */
            const moduleRef = moduleFactory.create(this.inj);
            /** @type {?} */
            let cmpR$ = moduleRef.instance.createDataShownComponent(this.inj, args);
            if (cmpR$ instanceof ComponentRef) {
                cmpR$ = of(cmpR$);
            }
            cmpR$.subscribe((/**
             * @param {?} cmpR
             * @return {?}
             */
            (cmpR) => {
                // 重置滚动条
                /** @type {?} */
                const elt = (/** @type {?} */ (this.dataRegion.element.nativeElement.parentElement));
                elt.scrollTo({ left: 0 });
                this.dataRegion.clear();
                this.dataRegion.insert(cmpR.hostView);
            }));
        }));
    }
    /**
     * 创建通用表组件
     * @param {?} res
     * @param {?} billInfo
     * @param {?} billDataInfo
     * @return {?}
     */
    createDataComp(res, billInfo, billDataInfo) {
        /** @type {?} */
        const newBTS = this.dataInfoService.isNewBTS(billInfo.billTrackingSettings);
        // if (newBTS) {
        try {
            this.createNewDataComp(res, billInfo, billDataInfo);
        }
        catch (e) {
            // 重置滚动条
            /** @type {?} */
            const elt = (/** @type {?} */ (this.dataRegion.element.nativeElement.parentElement));
            elt && elt.scrollTo({ left: 0 });
            this.dataRegion.clear();
            /** @type {?} */
            const cmf = this.cfr.resolveComponentFactory(BasicTableComponent);
            /** @type {?} */
            const cmpR = this.dataRegion.createComponent(cmf);
            cmpR.instance.billInfo = billInfo;
            cmpR.instance.isMain = true;
            cmpR.instance.showMainTable(res);
            this.dataRegion.insert(cmpR.hostView);
        }
        // }
    }
    /**
     * 创建通用表组件
     * @param {?} res
     * @param {?=} billInfo
     * @param {?=} billDataInfo
     * @return {?}
     */
    createNewDataComp(res, billInfo, billDataInfo) {
        // 重置滚动条
        /** @type {?} */
        const elt = (/** @type {?} */ (this.dataRegion.element.nativeElement.parentElement));
        elt && elt.scrollTo({ left: 0 });
        this.dataRegion.clear();
        /** @type {?} */
        const cmf = this.cfr.resolveComponentFactory(BasicInfoComponent);
        /** @type {?} */
        const cmpR = this.dataRegion.createComponent(cmf);
        cmpR.instance.schemaTable = res.billSchema.mainTable;
        cmpR.instance.dataTable = res.billData.mainTable;
        cmpR.instance.billInfo = billInfo;
        cmpR.instance.billDataInfo = billDataInfo;
        this.dataRegion.insert(cmpR.hostView);
    }
}
BillTrackerDataComponent.decorators = [
    { type: Component, args: [{
                selector: 'lib-bill-tracker-data',
                template: "<div style=\"\">\r\n    <ng-container #dataRegion></ng-container>\r\n</div>",
                styles: [""]
            }] }
];
/** @nocollapse */
BillTrackerDataComponent.ctorParameters = () => [
    { type: NotifyService },
    { type: MessagerService },
    { type: LoadingService },
    { type: BsModalService },
    { type: BillTrackerDataService },
    { type: Injector },
    { type: ComponentFactoryResolver },
    { type: ChangeDetectorRef },
    { type: NgModuleFactoryLoader },
    { type: String, decorators: [{ type: Inject, args: [LOCALE_ID,] }] },
    { type: ViewContainerRef, decorators: [{ type: Optional }] },
    { type: ElementRef, decorators: [{ type: Optional }] }
];
BillTrackerDataComponent.propDecorators = {
    dataRegion: [{ type: ViewChild, args: ["dataRegion", { read: ViewContainerRef },] }]
};
if (false) {
    /** @type {?} */
    BillTrackerDataComponent.prototype.dataRegion;
    /** @type {?} */
    BillTrackerDataComponent.prototype.dataInfoService;
    /** @type {?} */
    BillTrackerDataComponent.prototype.localePipe;
    /** @type {?} */
    BillTrackerDataComponent.prototype.localeId;
    /** @type {?} */
    BillTrackerDataComponent.prototype.vcr;
    /** @type {?} */
    BillTrackerDataComponent.prototype.er;
    /** @type {?} */
    BillTrackerDataComponent.prototype.notify;
    /** @type {?} */
    BillTrackerDataComponent.prototype.messager;
    /** @type {?} */
    BillTrackerDataComponent.prototype.loading;
    /** @type {?} */
    BillTrackerDataComponent.prototype.modal;
    /** @type {?} */
    BillTrackerDataComponent.prototype.dataService;
    /** @type {?} */
    BillTrackerDataComponent.prototype.inj;
    /** @type {?} */
    BillTrackerDataComponent.prototype.cfr;
    /** @type {?} */
    BillTrackerDataComponent.prototype.cdf;
    /** @type {?} */
    BillTrackerDataComponent.prototype.loader;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmlsbC10cmFja2VyLWRhdGEuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGVkcC1iaWYvcnVudGltZS1hcGkvIiwic291cmNlcyI6WyJsaWIvYmlsbC10cmFja2VyL2NvbXBvbmVudHMvYmlsbC10cmFja2VyLWRhdGEvYmlsbC10cmFja2VyLWRhdGEuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsT0FBTyxFQUFFLFNBQVMsRUFBVSx3QkFBd0IsRUFBRSxRQUFRLEVBQWlCLGdCQUFnQixFQUFFLFNBQVMsRUFBRSxZQUFZLEVBQUUscUJBQXFCLEVBQW1CLGlCQUFpQixFQUFFLFFBQVEsRUFBRSxTQUFTLEVBQUUsTUFBTSxFQUFFLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUNwUCxPQUFPLEVBQUUsbUJBQW1CLEVBQUUsTUFBTSxzQ0FBc0MsQ0FBQztBQUMzRSxPQUFPLEVBQUUsc0JBQXNCLEVBQUUsTUFBTSwwQ0FBMEMsQ0FBQztBQUVsRixPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sb0JBQW9CLENBQUM7QUFDcEQsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBR3RELE9BQU8sRUFBRSxvQkFBb0IsRUFBRSx5QkFBeUIsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQ3RGLE9BQU8sRUFBRSxJQUFJLEVBQUUsRUFBRSxFQUFjLE1BQU0sTUFBTSxDQUFDO0FBQzVDLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUczQyxPQUFPLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSxvQ0FBb0MsQ0FBQztBQUN4RSxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFDbEQsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLGtCQUFrQixDQUFDO0FBQ2xELE9BQU8sRUFBRSwwQkFBMEIsRUFBRSxNQUFNLCtDQUErQyxDQUFDO0FBQzNGLE9BQU8sRUFBRSxxQkFBcUIsRUFBRSxNQUFNLHFDQUFxQyxDQUFDO0FBVTVFLE1BQU0sT0FBTyx3QkFBd0I7Ozs7Ozs7Ozs7Ozs7OztJQVVuQyxZQUNTLE1BQXFCLEVBQ3JCLFFBQXlCLEVBQ3pCLE9BQXVCLEVBQ3ZCLEtBQXFCLEVBQ3JCLFdBQW1DLEVBQ25DLEdBQWEsRUFDYixHQUE2QixFQUM3QixHQUFzQixFQUN0QixNQUE2QixFQUNqQixRQUFnQixFQUN2QixHQUFxQixFQUNyQixFQUFjO1FBWG5CLFdBQU0sR0FBTixNQUFNLENBQWU7UUFDckIsYUFBUSxHQUFSLFFBQVEsQ0FBaUI7UUFDekIsWUFBTyxHQUFQLE9BQU8sQ0FBZ0I7UUFDdkIsVUFBSyxHQUFMLEtBQUssQ0FBZ0I7UUFDckIsZ0JBQVcsR0FBWCxXQUFXLENBQXdCO1FBQ25DLFFBQUcsR0FBSCxHQUFHLENBQVU7UUFDYixRQUFHLEdBQUgsR0FBRyxDQUEwQjtRQUM3QixRQUFHLEdBQUgsR0FBRyxDQUFtQjtRQUN0QixXQUFNLEdBQU4sTUFBTSxDQUF1QjtRQUtwQyxJQUFJLENBQUMsZUFBZSxHQUFHLElBQUksMEJBQTBCLEVBQUUsQ0FBQztRQUN4RCxJQUFJLENBQUMsUUFBUSxHQUFHLFFBQVEsSUFBSSxJQUFJLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxTQUFTLEVBQUUsSUFBSSxDQUFDLElBQUksUUFBUSxDQUFDO1FBQ3RFLElBQUksQ0FBQyxVQUFVLEdBQUcsSUFBSSxxQkFBcUIsQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUN0RCxJQUFJLENBQUMsR0FBRyxHQUFHLEdBQUcsSUFBSSxJQUFJLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxnQkFBZ0IsRUFBRSxJQUFJLENBQUMsQ0FBQztRQUN2RCxJQUFJLENBQUMsRUFBRSxHQUFHLEVBQUUsSUFBSSxJQUFJLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxVQUFVLEVBQUUsSUFBSSxDQUFDLENBQUM7SUFDakQsQ0FBQzs7OztJQUVELFFBQVE7SUFFUixDQUFDOzs7O0lBRUQsZUFBZTtJQUVmLENBQUM7Ozs7SUFFTSxlQUFlO1FBQ3BCLElBQUksQ0FBQyxVQUFVLENBQUMsS0FBSyxFQUFFLENBQUM7SUFDMUIsQ0FBQzs7Ozs7Ozs7SUFFTSxZQUFZLENBQUMsSUFBMkIsRUFBRSxRQUFtQixFQUFFLFlBQTJCLEVBQUUsR0FBc0I7OztZQUVuSCxHQUFHLEdBQXlCLElBQUksb0JBQW9CLEVBQUU7UUFDMUQsSUFBSSxRQUFRLElBQUksUUFBUSxDQUFDLG9CQUFvQixFQUFFO1lBQzdDLEdBQUcsQ0FBQyxZQUFZLENBQUMsUUFBUSxDQUFDLG9CQUFvQixDQUFDLENBQUM7U0FDakQ7UUFDRCxJQUFJLEdBQUcsQ0FBQyx5QkFBeUIsSUFBSSx5QkFBeUIsQ0FBQyxVQUFVLEVBQUU7WUFDekUsSUFBSSxDQUFDLGNBQWMsQ0FBQyxJQUFJLEVBQUUsUUFBUSxFQUFFLFlBQVksQ0FBQyxDQUFDO1NBQ25EO2FBQU07WUFDTCxJQUFJLENBQUMsZUFBZSxDQUFDLElBQUksRUFBRSxRQUFRLEVBQUUsWUFBWSxFQUFFLEdBQUcsQ0FBQyxDQUFDO1NBQ3pEO0lBQ0gsQ0FBQzs7Ozs7Ozs7Ozs7SUFRTyxlQUFlLENBQUMsSUFBMkIsRUFBRSxRQUFtQixFQUFFLFlBQTJCLEVBQUUsR0FBc0IsRUFBRSxNQUFnQjtRQUM3SSxJQUFJLEdBQUcsSUFBSSxJQUFJLEVBQUU7WUFDZixJQUFJLENBQUMsY0FBYyxDQUFDLEdBQUcsRUFBRSxRQUFRLEVBQUUsWUFBWSxDQUFDLENBQUM7U0FDbEQ7YUFBTTs7a0JBQ0MsQ0FBQyxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLEVBQUUsT0FBTyxFQUFFLElBQUksQ0FBQyxVQUFVLENBQUMsU0FBUyxDQUFDLFNBQVMsQ0FBQyxFQUFFLENBQUM7WUFDOUUsSUFBSSxDQUFDLFdBQVcsQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLENBQUMsU0FBUzs7OztZQUM1QyxDQUFDLEdBQXFCLEVBQUUsRUFBRTtnQkFDeEIsSUFBSSxDQUFDLGNBQWMsQ0FBQyxHQUFHLEVBQUUsUUFBUSxFQUFFLFlBQVksQ0FBQyxDQUFDO2dCQUNqRCxDQUFDLENBQUMsS0FBSyxFQUFFLENBQUM7WUFDWixDQUFDOzs7O1lBQ0QsQ0FBQyxHQUFHLEVBQUUsRUFBRTtnQkFDTixDQUFDLENBQUMsS0FBSyxFQUFFLENBQUM7Z0JBQ1YsSUFBSSxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLEtBQUssSUFBSSxJQUFJLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxPQUFPLElBQUksR0FBRyxDQUFDLEtBQUssQ0FBQyxPQUFPLElBQUksR0FBRyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUM7Z0JBQy9HLE1BQU0sR0FBRyxDQUFDO1lBQ1osQ0FBQyxFQUNGLENBQUM7U0FDSDtJQUNILENBQUM7Ozs7Ozs7OztJQU9PLGNBQWMsQ0FBQyxJQUEyQixFQUFFLFFBQW1CLEVBQUUsWUFBMkI7O1lBQzlGLEdBQUcsR0FBeUIsSUFBSSxvQkFBb0IsRUFBRTtRQUMxRCxJQUFJLFFBQVEsSUFBSSxRQUFRLENBQUMsb0JBQW9CLEVBQUU7WUFDN0MsR0FBRyxDQUFDLFlBQVksQ0FBQyxRQUFRLENBQUMsb0JBQW9CLENBQUMsQ0FBQztTQUNqRDs7WUFDRyxXQUFXLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsaUJBQWlCLENBQUM7O1lBRS9DLFFBQVEsR0FBRyxJQUFJO1FBQ25CLElBQUksV0FBVyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLEVBQUU7WUFDcEMsZ0JBQWdCO1lBQ2hCLFFBQVEsR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLFdBQVcsRUFBRSxDQUFDLENBQUMsSUFBSTs7OztZQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFDLENBQUMsQ0FBQyxJQUFJLENBQzlFLFNBQVM7Ozs7WUFDUCxDQUFDLENBQWtFLEVBQUUsRUFBRTtnQkFDckUsS0FBSyxJQUFJLEdBQUcsSUFBSSxDQUFDLEVBQUU7b0JBQ2pCLE9BQU8sRUFBRSxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO2lCQUNuQjtnQkFDRCxPQUFPLEVBQUUsQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUNsQixDQUFDLEVBQ0YsQ0FDRixDQUFDO1NBQ0g7YUFBTTtZQUNMLG9CQUFvQjtZQUNwQixRQUFRLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO1NBQ3JEO1FBRUQsUUFBUSxDQUFDLFNBQVM7Ozs7UUFDaEIsQ0FBQyxhQUEyRCxFQUFFLEVBQUU7O2tCQUN4RCxTQUFTLEdBQUcsYUFBYSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDOztnQkFFNUMsS0FBSyxHQUFHLFNBQVMsQ0FBQyxRQUFRLENBQUMsd0JBQXdCLENBQUMsSUFBSSxDQUFDLEdBQUcsRUFBRSxJQUFJLENBQUM7WUFDdkUsSUFBSSxLQUFLLFlBQVksWUFBWSxFQUFFO2dCQUNqQyxLQUFLLEdBQUcsRUFBRSxDQUFDLEtBQUssQ0FBQyxDQUFDO2FBQ25CO1lBQ0QsS0FBSyxDQUFDLFNBQVM7Ozs7WUFDYixDQUFDLElBQWtELEVBQUUsRUFBRTs7O3NCQUUvQyxHQUFHLEdBQUcsbUJBQUEsSUFBSSxDQUFDLFVBQVUsQ0FBQyxPQUFPLENBQUMsYUFBYSxDQUFDLGFBQWEsRUFBZTtnQkFDOUUsR0FBRyxDQUFDLFFBQVEsQ0FBQyxFQUFFLElBQUksRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDO2dCQUUxQixJQUFJLENBQUMsVUFBVSxDQUFDLEtBQUssRUFBRSxDQUFDO2dCQUN4QixJQUFJLENBQUMsVUFBVSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7WUFDeEMsQ0FBQyxFQUNGLENBQUM7UUFDSixDQUFDLEVBQ0YsQ0FBQztJQUNKLENBQUM7Ozs7Ozs7O0lBT0QsY0FBYyxDQUFDLEdBQXFCLEVBQUUsUUFBa0IsRUFBRSxZQUEwQjs7Y0FDNUUsTUFBTSxHQUFHLElBQUksQ0FBQyxlQUFlLENBQUMsUUFBUSxDQUFDLFFBQVEsQ0FBQyxvQkFBb0IsQ0FBQztRQUMzRSxnQkFBZ0I7UUFDaEIsSUFBSTtZQUNGLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxHQUFHLEVBQUUsUUFBUSxFQUFFLFlBQVksQ0FBQyxDQUFDO1NBQ3JEO1FBQUMsT0FBTyxDQUFDLEVBQUU7OztrQkFFSixHQUFHLEdBQUcsbUJBQUEsSUFBSSxDQUFDLFVBQVUsQ0FBQyxPQUFPLENBQUMsYUFBYSxDQUFDLGFBQWEsRUFBZTtZQUM5RSxHQUFHLElBQUksR0FBRyxDQUFDLFFBQVEsQ0FBQyxFQUFFLElBQUksRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1lBRWpDLElBQUksQ0FBQyxVQUFVLENBQUMsS0FBSyxFQUFFLENBQUM7O2tCQUNsQixHQUFHLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyx1QkFBdUIsQ0FBQyxtQkFBbUIsQ0FBQzs7a0JBQzNELElBQUksR0FBc0MsSUFBSSxDQUFDLFVBQVUsQ0FBQyxlQUFlLENBQUMsR0FBRyxDQUFDO1lBQ3BGLElBQUksQ0FBQyxRQUFRLENBQUMsUUFBUSxHQUFHLFFBQVEsQ0FBQztZQUNsQyxJQUFJLENBQUMsUUFBUSxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUM7WUFDNUIsSUFBSSxDQUFDLFFBQVEsQ0FBQyxhQUFhLENBQUMsR0FBRyxDQUFDLENBQUM7WUFFakMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1NBQ3ZDO1FBQ0QsSUFBSTtJQUVOLENBQUM7Ozs7Ozs7O0lBT0QsaUJBQWlCLENBQUMsR0FBcUIsRUFBRSxRQUFtQixFQUFFLFlBQTJCOzs7Y0FFakYsR0FBRyxHQUFHLG1CQUFBLElBQUksQ0FBQyxVQUFVLENBQUMsT0FBTyxDQUFDLGFBQWEsQ0FBQyxhQUFhLEVBQWU7UUFDOUUsR0FBRyxJQUFJLEdBQUcsQ0FBQyxRQUFRLENBQUMsRUFBRSxJQUFJLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUVqQyxJQUFJLENBQUMsVUFBVSxDQUFDLEtBQUssRUFBRSxDQUFDOztjQUNsQixHQUFHLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyx1QkFBdUIsQ0FBQyxrQkFBa0IsQ0FBQzs7Y0FDMUQsSUFBSSxHQUFxQyxJQUFJLENBQUMsVUFBVSxDQUFDLGVBQWUsQ0FBQyxHQUFHLENBQUM7UUFDbkYsSUFBSSxDQUFDLFFBQVEsQ0FBQyxXQUFXLEdBQUcsR0FBRyxDQUFDLFVBQVUsQ0FBQyxTQUFTLENBQUM7UUFDckQsSUFBSSxDQUFDLFFBQVEsQ0FBQyxTQUFTLEdBQUcsR0FBRyxDQUFDLFFBQVEsQ0FBQyxTQUFTLENBQUM7UUFDakQsSUFBSSxDQUFDLFFBQVEsQ0FBQyxRQUFRLEdBQUcsUUFBUSxDQUFDO1FBQ2xDLElBQUksQ0FBQyxRQUFRLENBQUMsWUFBWSxHQUFHLFlBQVksQ0FBQztRQUUxQyxJQUFJLENBQUMsVUFBVSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7SUFDeEMsQ0FBQzs7O1lBekxGLFNBQVMsU0FBQztnQkFDVCxRQUFRLEVBQUUsdUJBQXVCO2dCQUNqQyx1RkFBaUQ7O2FBRWxEOzs7O1lBWlEsYUFBYTtZQVRiLGVBQWU7WUFEZixjQUFjO1lBV2QsY0FBYztZQWJkLHNCQUFzQjtZQUZ1QixRQUFRO1lBQWxDLHdCQUF3QjtZQUE4RyxpQkFBaUI7WUFBekQscUJBQXFCO3lDQStDMUksTUFBTSxTQUFDLFNBQVM7WUEvQzBELGdCQUFnQix1QkFnRDFGLFFBQVE7WUFoRHFNLFVBQVUsdUJBaUR2TixRQUFROzs7eUJBcEJWLFNBQVMsU0FBQyxZQUFZLEVBQUUsRUFBRSxJQUFJLEVBQUUsZ0JBQWdCLEVBQUU7Ozs7SUFBbkQsOENBQzZCOztJQUM3QixtREFBNEM7O0lBQzVDLDhDQUFrQzs7SUFDbEMsNENBQWlCOztJQUNqQix1Q0FBc0I7O0lBQ3RCLHNDQUErQjs7SUFHN0IsMENBQTRCOztJQUM1Qiw0Q0FBZ0M7O0lBQ2hDLDJDQUE4Qjs7SUFDOUIseUNBQTRCOztJQUM1QiwrQ0FBMEM7O0lBQzFDLHVDQUFvQjs7SUFDcEIsdUNBQW9DOztJQUNwQyx1Q0FBNkI7O0lBQzdCLDBDQUFvQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgT25Jbml0LCBDb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIsIEluamVjdG9yLCBBZnRlclZpZXdJbml0LCBWaWV3Q29udGFpbmVyUmVmLCBWaWV3Q2hpbGQsIENvbXBvbmVudFJlZiwgTmdNb2R1bGVGYWN0b3J5TG9hZGVyLCBOZ01vZHVsZUZhY3RvcnksIENoYW5nZURldGVjdG9yUmVmLCBPcHRpb25hbCwgTE9DQUxFX0lELCBJbmplY3QsIEVsZW1lbnRSZWYgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgQmFzaWNUYWJsZUNvbXBvbmVudCB9IGZyb20gJy4uL2Jhc2ljLXRhYmxlL2Jhc2ljLXRhYmxlLmNvbXBvbmVudCc7XHJcbmltcG9ydCB7IEJpbGxUcmFja2VyRGF0YVNlcnZpY2UgfSBmcm9tICcuLi8uLi9zZXJ2aWNlcy9iaWxsLXRyYWNrZXItZGF0YS5zZXJ2aWNlJztcclxuaW1wb3J0IHsgR2V0TWFpbkVudGl0eURhdGFBcmdzIH0gZnJvbSAnLi4vLi4vYXJncy9HZXRNYWluRW50aXR5RGF0YUFyZ3MnO1xyXG5pbXBvcnQgeyBMb2FkaW5nU2VydmljZSB9IGZyb20gJ0BmYXJyaXMvdWktbG9hZGluZyc7XHJcbmltcG9ydCB7IE1lc3NhZ2VyU2VydmljZSB9IGZyb20gJ0BmYXJyaXMvdWktbWVzc2FnZXInO1xyXG5pbXBvcnQgeyBFbnRpdHlEYXRhUmVzdWx0IH0gZnJvbSAnLi4vLi4vYXJncy9FbnRpdHlEYXRhUmVzdWx0JztcclxuaW1wb3J0IHsgQmlsbEluZm8gfSBmcm9tICcuLi8uLi8uLi9lbnRpdHkvdHJhY2tpbmcvQmlsbEluZm8nO1xyXG5pbXBvcnQgeyBCaWxsVHJhY2tpbmdTZXR0aW5ncywgQmlsbFRyYWNraW5nRGF0YVNob3duTW9kZSB9IGZyb20gJ0BlZHAtYmlmL2NvbW1vbi1hcGknO1xyXG5pbXBvcnQgeyBmcm9tLCBvZiwgT2JzZXJ2YWJsZSB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQgeyBzd2l0Y2hNYXAgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XHJcbmltcG9ydCB7IElCaWxsVHJhY2tlckRhdGFTaG93bk1vZHVsZSB9IGZyb20gJy4uLy4uL2Jhc2UvSUJpbGxUcmFja2VyRGF0YVNob3duTW9kdWxlJztcclxuaW1wb3J0IHsgSUJpbGxUcmFja2VyRGF0YVNob3duQ29tcG9uZW50IH0gZnJvbSAnLi4vLi4vYmFzZS9JQmlsbFRyYWNrZXJEYXRhU2hvd25Db21wb25lbnQnO1xyXG5pbXBvcnQgeyBCYXNpY0luZm9Db21wb25lbnQgfSBmcm9tICcuLi9iYXNpYy1pbmZvL2Jhc2ljLWluZm8uY29tcG9uZW50JztcclxuaW1wb3J0IHsgTm90aWZ5U2VydmljZSB9IGZyb20gJ0BmYXJyaXMvdWktbm90aWZ5JztcclxuaW1wb3J0IHsgQnNNb2RhbFNlcnZpY2UgfSBmcm9tICdAZmFycmlzL3VpLW1vZGFsJztcclxuaW1wb3J0IHsgQmlsbFRyYWNrZXJEYXRhSW5mb1NlcnZpY2UgfSBmcm9tICcuLi8uLi9zZXJ2aWNlcy9iaWxsLXRyYWNrZXItZGF0YS1pbmZvLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBCaWxsVHJhY2tlckxvY2FsZVBpcGUgfSBmcm9tICcuLi8uLi9waXBlL2JpbGwtdHJhY2tlci1sb2NhbGUucGlwZSc7XHJcbmltcG9ydCB7IEJpbGxEYXRhSW5mbyB9IGZyb20gJy4uLy4uLy4uL2VudGl0eS90cmFja2luZy9CaWxsRGF0YUluZm8nO1xyXG5cclxuZGVjbGFyZSB2YXIgU3lzdGVtOiBhbnk7XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICBzZWxlY3RvcjogJ2xpYi1iaWxsLXRyYWNrZXItZGF0YScsXHJcbiAgdGVtcGxhdGVVcmw6ICcuL2JpbGwtdHJhY2tlci1kYXRhLmNvbXBvbmVudC5odG1sJyxcclxuICBzdHlsZVVybHM6IFsnLi9iaWxsLXRyYWNrZXItZGF0YS5jb21wb25lbnQuY3NzJ11cclxufSlcclxuZXhwb3J0IGNsYXNzIEJpbGxUcmFja2VyRGF0YUNvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgQWZ0ZXJWaWV3SW5pdCB7XHJcblxyXG4gIEBWaWV3Q2hpbGQoXCJkYXRhUmVnaW9uXCIsIHsgcmVhZDogVmlld0NvbnRhaW5lclJlZiB9KVxyXG4gIGRhdGFSZWdpb246IFZpZXdDb250YWluZXJSZWY7XHJcbiAgZGF0YUluZm9TZXJ2aWNlOiBCaWxsVHJhY2tlckRhdGFJbmZvU2VydmljZTtcclxuICBsb2NhbGVQaXBlOiBCaWxsVHJhY2tlckxvY2FsZVBpcGU7XHJcbiAgbG9jYWxlSWQ6IHN0cmluZztcclxuICB2Y3I6IFZpZXdDb250YWluZXJSZWY7XHJcbiAgZXI6IEVsZW1lbnRSZWY8SFRNTERpdkVsZW1lbnQ+O1xyXG5cclxuICBjb25zdHJ1Y3RvcihcclxuICAgIHB1YmxpYyBub3RpZnk6IE5vdGlmeVNlcnZpY2UsXHJcbiAgICBwdWJsaWMgbWVzc2FnZXI6IE1lc3NhZ2VyU2VydmljZSxcclxuICAgIHB1YmxpYyBsb2FkaW5nOiBMb2FkaW5nU2VydmljZSxcclxuICAgIHB1YmxpYyBtb2RhbDogQnNNb2RhbFNlcnZpY2UsXHJcbiAgICBwdWJsaWMgZGF0YVNlcnZpY2U6IEJpbGxUcmFja2VyRGF0YVNlcnZpY2UsXHJcbiAgICBwdWJsaWMgaW5qOiBJbmplY3RvcixcclxuICAgIHB1YmxpYyBjZnI6IENvbXBvbmVudEZhY3RvcnlSZXNvbHZlcixcclxuICAgIHB1YmxpYyBjZGY6IENoYW5nZURldGVjdG9yUmVmLFxyXG4gICAgcHVibGljIGxvYWRlcjogTmdNb2R1bGVGYWN0b3J5TG9hZGVyLFxyXG4gICAgQEluamVjdChMT0NBTEVfSUQpIGxvY2FsZUlkOiBzdHJpbmcsXHJcbiAgICBAT3B0aW9uYWwoKSB2Y3I6IFZpZXdDb250YWluZXJSZWYsXHJcbiAgICBAT3B0aW9uYWwoKSBlcjogRWxlbWVudFJlZixcclxuICApIHtcclxuICAgIHRoaXMuZGF0YUluZm9TZXJ2aWNlID0gbmV3IEJpbGxUcmFja2VyRGF0YUluZm9TZXJ2aWNlKCk7XHJcbiAgICB0aGlzLmxvY2FsZUlkID0gbG9jYWxlSWQgfHwgdGhpcy5pbmouZ2V0KExPQ0FMRV9JRCwgbnVsbCkgfHwgJ3poLUNIUyc7XHJcbiAgICB0aGlzLmxvY2FsZVBpcGUgPSBuZXcgQmlsbFRyYWNrZXJMb2NhbGVQaXBlKGxvY2FsZUlkKTtcclxuICAgIHRoaXMudmNyID0gdmNyIHx8IHRoaXMuaW5qLmdldChWaWV3Q29udGFpbmVyUmVmLCBudWxsKTtcclxuICAgIHRoaXMuZXIgPSBlciB8fCB0aGlzLmluai5nZXQoRWxlbWVudFJlZiwgbnVsbCk7XHJcbiAgfVxyXG5cclxuICBuZ09uSW5pdCgpIHtcclxuXHJcbiAgfVxyXG5cclxuICBuZ0FmdGVyVmlld0luaXQoKTogdm9pZCB7XHJcblxyXG4gIH1cclxuXHJcbiAgcHVibGljIGNsZWFyRGF0YVJlZ2lvbigpOiB2b2lkIHtcclxuICAgIHRoaXMuZGF0YVJlZ2lvbi5jbGVhcigpO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIHNob3dEYXRhR3JpZChhcmdzOiBHZXRNYWluRW50aXR5RGF0YUFyZ3MsIGJpbGxJbmZvPzogQmlsbEluZm8sIGJpbGxEYXRhSW5mbz86IEJpbGxEYXRhSW5mbywgcmVzPzogRW50aXR5RGF0YVJlc3VsdCk6IHZvaWQge1xyXG4gICAgLy8g5Y2V5o2u6L+96Liq6YWN572uXHJcbiAgICBsZXQgYnRzOiBCaWxsVHJhY2tpbmdTZXR0aW5ncyA9IG5ldyBCaWxsVHJhY2tpbmdTZXR0aW5ncygpO1xyXG4gICAgaWYgKGJpbGxJbmZvICYmIGJpbGxJbmZvLmJpbGxUcmFja2luZ1NldHRpbmdzKSB7XHJcbiAgICAgIGJ0cy5Mb2FkRnJvbUpzb24oYmlsbEluZm8uYmlsbFRyYWNraW5nU2V0dGluZ3MpO1xyXG4gICAgfVxyXG4gICAgaWYgKGJ0cy5iaWxsVHJhY2tpbmdEYXRhU2hvd25Nb2RlID09IEJpbGxUcmFja2luZ0RhdGFTaG93bk1vZGUuQ1VTVE9NRk9STSkge1xyXG4gICAgICB0aGlzLnNob3dDdXN0b21Gb3JtKGFyZ3MsIGJpbGxJbmZvLCBiaWxsRGF0YUluZm8pO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5zaG93R2VuZXJhbEZvcm0oYXJncywgYmlsbEluZm8sIGJpbGxEYXRhSW5mbywgcmVzKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOaJk+W8gOmAmueUqOihqOWNlVxyXG4gICAqIEBwYXJhbSBhcmdzXHJcbiAgICogQHBhcmFtIGJpbGxJbmZvXHJcbiAgICogQHBhcmFtIHJlc1xyXG4gICAqL1xyXG4gIHByaXZhdGUgc2hvd0dlbmVyYWxGb3JtKGFyZ3M6IEdldE1haW5FbnRpdHlEYXRhQXJncywgYmlsbEluZm8/OiBCaWxsSW5mbywgYmlsbERhdGFJbmZvPzogQmlsbERhdGFJbmZvLCByZXM/OiBFbnRpdHlEYXRhUmVzdWx0LCBuZXdCVFM/OiBib29sZWFuKSB7XHJcbiAgICBpZiAocmVzICE9IG51bGwpIHtcclxuICAgICAgdGhpcy5jcmVhdGVEYXRhQ29tcChyZXMsIGJpbGxJbmZvLCBiaWxsRGF0YUluZm8pO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgY29uc3QgbCA9IHRoaXMubG9hZGluZy5zaG93KHsgbWVzc2FnZTogdGhpcy5sb2NhbGVQaXBlLnRyYW5zZm9ybShcImxvYWRpbmdcIikgfSk7XHJcbiAgICAgIHRoaXMuZGF0YVNlcnZpY2UuZ2V0RW50aXR5RGF0YShhcmdzKS5zdWJzY3JpYmUoXHJcbiAgICAgICAgKHJlczogRW50aXR5RGF0YVJlc3VsdCkgPT4ge1xyXG4gICAgICAgICAgdGhpcy5jcmVhdGVEYXRhQ29tcChyZXMsIGJpbGxJbmZvLCBiaWxsRGF0YUluZm8pO1xyXG4gICAgICAgICAgbC5jbG9zZSgpO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgKGVycikgPT4ge1xyXG4gICAgICAgICAgbC5jbG9zZSgpO1xyXG4gICAgICAgICAgdGhpcy5tZXNzYWdlci5lcnJvcihlcnIuZXJyb3IgPT0gbnVsbCA/IGVyci5tZXNzYWdlIDogKGVyci5lcnJvci5NZXNzYWdlIHx8IGVyci5lcnJvci5tZXNzYWdlIHx8IGVyci5tZXNzYWdlKSk7XHJcbiAgICAgICAgICB0aHJvdyBlcnI7XHJcbiAgICAgICAgfVxyXG4gICAgICApO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5omT5byA6Ieq5a6a5LmJ6KGo5Y2VXHJcbiAgICogQHBhcmFtIGFyZ3NcclxuICAgKiBAcGFyYW0gYmlsbEluZm9cclxuICAgKi9cclxuICBwcml2YXRlIHNob3dDdXN0b21Gb3JtKGFyZ3M6IEdldE1haW5FbnRpdHlEYXRhQXJncywgYmlsbEluZm8/OiBCaWxsSW5mbywgYmlsbERhdGFJbmZvPzogQmlsbERhdGFJbmZvKSB7XHJcbiAgICBsZXQgYnRzOiBCaWxsVHJhY2tpbmdTZXR0aW5ncyA9IG5ldyBCaWxsVHJhY2tpbmdTZXR0aW5ncygpO1xyXG4gICAgaWYgKGJpbGxJbmZvICYmIGJpbGxJbmZvLmJpbGxUcmFja2luZ1NldHRpbmdzKSB7XHJcbiAgICAgIGJ0cy5Mb2FkRnJvbUpzb24oYmlsbEluZm8uYmlsbFRyYWNraW5nU2V0dGluZ3MpO1xyXG4gICAgfVxyXG4gICAgbGV0IGZvcm1Db250ZW50ID0gSlNPTi5wYXJzZShidHMuY3VzdG9tRm9ybUNvbnRlbnQpO1xyXG5cclxuICAgIGxldCBtb2R1bGVGJCA9IG51bGw7XHJcbiAgICBpZiAoZm9ybUNvbnRlbnQuZm9ybS5lbmRzV2l0aChcIi5qc1wiKSkge1xyXG4gICAgICAvLyB1cmzmoLzlvI/kuLpbanPot6/lvoRd5pe2XHJcbiAgICAgIG1vZHVsZUYkID0gZnJvbShTeXN0ZW0uaW1wb3J0KGZvcm1Db250ZW50LmZvcm0udG9Mb3dlckNhc2UoKSkudGhlbihtID0+IG0pKS5waXBlKFxyXG4gICAgICAgIHN3aXRjaE1hcChcclxuICAgICAgICAgIChtOiB7IFtrZXk6IHN0cmluZ106IE5nTW9kdWxlRmFjdG9yeTxJQmlsbFRyYWNrZXJEYXRhU2hvd25Nb2R1bGU+IH0pID0+IHtcclxuICAgICAgICAgICAgZm9yIChsZXQga2V5IGluIG0pIHtcclxuICAgICAgICAgICAgICByZXR1cm4gb2YobVtrZXldKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gb2YobnVsbCk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgKVxyXG4gICAgICApO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgLy8gdXJs5qC85byP5Li6W2pz6Lev5b6EI+aooeWdl+WQjV3ml7ZcclxuICAgICAgbW9kdWxlRiQgPSBmcm9tKHRoaXMubG9hZGVyLmxvYWQoZm9ybUNvbnRlbnQuZm9ybSkpO1xyXG4gICAgfVxyXG5cclxuICAgIG1vZHVsZUYkLnN1YnNjcmliZShcclxuICAgICAgKG1vZHVsZUZhY3Rvcnk6IE5nTW9kdWxlRmFjdG9yeTxJQmlsbFRyYWNrZXJEYXRhU2hvd25Nb2R1bGU+KSA9PiB7XHJcbiAgICAgICAgY29uc3QgbW9kdWxlUmVmID0gbW9kdWxlRmFjdG9yeS5jcmVhdGUodGhpcy5pbmopO1xyXG5cclxuICAgICAgICBsZXQgY21wUiQgPSBtb2R1bGVSZWYuaW5zdGFuY2UuY3JlYXRlRGF0YVNob3duQ29tcG9uZW50KHRoaXMuaW5qLCBhcmdzKTtcclxuICAgICAgICBpZiAoY21wUiQgaW5zdGFuY2VvZiBDb21wb25lbnRSZWYpIHtcclxuICAgICAgICAgIGNtcFIkID0gb2YoY21wUiQpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjbXBSJC5zdWJzY3JpYmUoXHJcbiAgICAgICAgICAoY21wUjogQ29tcG9uZW50UmVmPElCaWxsVHJhY2tlckRhdGFTaG93bkNvbXBvbmVudD4pID0+IHtcclxuICAgICAgICAgICAgLy8g6YeN572u5rua5Yqo5p2hXHJcbiAgICAgICAgICAgIGNvbnN0IGVsdCA9IHRoaXMuZGF0YVJlZ2lvbi5lbGVtZW50Lm5hdGl2ZUVsZW1lbnQucGFyZW50RWxlbWVudCBhcyBIVE1MRWxlbWVudDtcclxuICAgICAgICAgICAgZWx0LnNjcm9sbFRvKHsgbGVmdDogMCB9KTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuZGF0YVJlZ2lvbi5jbGVhcigpO1xyXG4gICAgICAgICAgICB0aGlzLmRhdGFSZWdpb24uaW5zZXJ0KGNtcFIuaG9zdFZpZXcpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICk7XHJcbiAgICAgIH1cclxuICAgICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICog5Yib5bu66YCa55So6KGo57uE5Lu2XHJcbiAqIEBwYXJhbSByZXNcclxuICogQHBhcmFtIGJpbGxJbmZvXHJcbiAqL1xyXG4gIGNyZWF0ZURhdGFDb21wKHJlczogRW50aXR5RGF0YVJlc3VsdCwgYmlsbEluZm86IEJpbGxJbmZvLCBiaWxsRGF0YUluZm86IEJpbGxEYXRhSW5mbykge1xyXG4gICAgY29uc3QgbmV3QlRTID0gdGhpcy5kYXRhSW5mb1NlcnZpY2UuaXNOZXdCVFMoYmlsbEluZm8uYmlsbFRyYWNraW5nU2V0dGluZ3MpO1xyXG4gICAgLy8gaWYgKG5ld0JUUykge1xyXG4gICAgdHJ5IHtcclxuICAgICAgdGhpcy5jcmVhdGVOZXdEYXRhQ29tcChyZXMsIGJpbGxJbmZvLCBiaWxsRGF0YUluZm8pO1xyXG4gICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICAvLyDph43nva7mu5rliqjmnaFcclxuICAgICAgY29uc3QgZWx0ID0gdGhpcy5kYXRhUmVnaW9uLmVsZW1lbnQubmF0aXZlRWxlbWVudC5wYXJlbnRFbGVtZW50IGFzIEhUTUxFbGVtZW50O1xyXG4gICAgICBlbHQgJiYgZWx0LnNjcm9sbFRvKHsgbGVmdDogMCB9KTtcclxuXHJcbiAgICAgIHRoaXMuZGF0YVJlZ2lvbi5jbGVhcigpO1xyXG4gICAgICBjb25zdCBjbWYgPSB0aGlzLmNmci5yZXNvbHZlQ29tcG9uZW50RmFjdG9yeShCYXNpY1RhYmxlQ29tcG9uZW50KTtcclxuICAgICAgY29uc3QgY21wUjogQ29tcG9uZW50UmVmPEJhc2ljVGFibGVDb21wb25lbnQ+ID0gdGhpcy5kYXRhUmVnaW9uLmNyZWF0ZUNvbXBvbmVudChjbWYpO1xyXG4gICAgICBjbXBSLmluc3RhbmNlLmJpbGxJbmZvID0gYmlsbEluZm87XHJcbiAgICAgIGNtcFIuaW5zdGFuY2UuaXNNYWluID0gdHJ1ZTtcclxuICAgICAgY21wUi5pbnN0YW5jZS5zaG93TWFpblRhYmxlKHJlcyk7XHJcblxyXG4gICAgICB0aGlzLmRhdGFSZWdpb24uaW5zZXJ0KGNtcFIuaG9zdFZpZXcpO1xyXG4gICAgfVxyXG4gICAgLy8gfVxyXG5cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gKiDliJvlu7rpgJrnlKjooajnu4Tku7ZcclxuICogQHBhcmFtIHJlc1xyXG4gKiBAcGFyYW0gYmlsbEluZm9cclxuICovXHJcbiAgY3JlYXRlTmV3RGF0YUNvbXAocmVzOiBFbnRpdHlEYXRhUmVzdWx0LCBiaWxsSW5mbz86IEJpbGxJbmZvLCBiaWxsRGF0YUluZm8/OiBCaWxsRGF0YUluZm8pIHtcclxuICAgIC8vIOmHjee9rua7muWKqOadoVxyXG4gICAgY29uc3QgZWx0ID0gdGhpcy5kYXRhUmVnaW9uLmVsZW1lbnQubmF0aXZlRWxlbWVudC5wYXJlbnRFbGVtZW50IGFzIEhUTUxFbGVtZW50O1xyXG4gICAgZWx0ICYmIGVsdC5zY3JvbGxUbyh7IGxlZnQ6IDAgfSk7XHJcblxyXG4gICAgdGhpcy5kYXRhUmVnaW9uLmNsZWFyKCk7XHJcbiAgICBjb25zdCBjbWYgPSB0aGlzLmNmci5yZXNvbHZlQ29tcG9uZW50RmFjdG9yeShCYXNpY0luZm9Db21wb25lbnQpO1xyXG4gICAgY29uc3QgY21wUjogQ29tcG9uZW50UmVmPEJhc2ljSW5mb0NvbXBvbmVudD4gPSB0aGlzLmRhdGFSZWdpb24uY3JlYXRlQ29tcG9uZW50KGNtZik7XHJcbiAgICBjbXBSLmluc3RhbmNlLnNjaGVtYVRhYmxlID0gcmVzLmJpbGxTY2hlbWEubWFpblRhYmxlO1xyXG4gICAgY21wUi5pbnN0YW5jZS5kYXRhVGFibGUgPSByZXMuYmlsbERhdGEubWFpblRhYmxlO1xyXG4gICAgY21wUi5pbnN0YW5jZS5iaWxsSW5mbyA9IGJpbGxJbmZvO1xyXG4gICAgY21wUi5pbnN0YW5jZS5iaWxsRGF0YUluZm8gPSBiaWxsRGF0YUluZm87XHJcblxyXG4gICAgdGhpcy5kYXRhUmVnaW9uLmluc2VydChjbXBSLmhvc3RWaWV3KTtcclxuICB9XHJcbn1cclxuIl19
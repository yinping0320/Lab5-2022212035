/**
 * @fileoverview added by tsickle
 * Generated from: lib/bill-tracker/components/child-info/child-info.component.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { ChangeDetectorRef, Component, ComponentFactoryResolver, Inject, Injector, Input, LOCALE_ID, Optional, ViewChild, ViewContainerRef } from "@angular/core";
import { BillDataTable, BillSchemaTable, DataType } from "@edp-aif/common-api";
import { BillTrackingDataShownMode, BillTrackingSettings } from "@edp-bif/common-api";
import { DatagridComponent } from "@farris/ui-datagrid";
import { LoadingService } from "@farris/ui-loading";
import { MessagerService } from "@farris/ui-messager";
import { BsModalService } from "@farris/ui-modal";
import { NotifyService } from "@farris/ui-notify";
import { BillInfo } from "../../../entity/tracking/BillInfo";
import { BillTrackerLocalePipe } from "../../pipe/bill-tracker-locale.pipe";
import { BillTrackerDataInfoService } from "../../services/bill-tracker-data-info.service";
import { ChildInfoListComponent } from "../child-info-list/child-info-list.component";
import { Exceptions } from "../../../entity/tracking/Exceptions";
export class ChildInfoComponent {
    /**
     * @param {?} notify
     * @param {?} messager
     * @param {?} loading
     * @param {?} modal
     * @param {?} dataInfoService
     * @param {?} localePipe
     * @param {?} vcr
     * @param {?} inj
     * @param {?} cfr
     * @param {?} cdr
     * @param {?} localeId
     */
    constructor(notify, messager, loading, modal, dataInfoService, localePipe, vcr, inj, cfr, cdr, localeId) {
        this.notify = notify;
        this.messager = messager;
        this.loading = loading;
        this.modal = modal;
        this.dataInfoService = dataInfoService;
        this.localePipe = localePipe;
        this.vcr = vcr;
        this.inj = inj;
        this.cfr = cfr;
        this.cdr = cdr;
        this.localeId = localeId;
        this.secTitle = null;
        this.showDetail = false;
        this.dgCols = [];
        this.dgData = [];
        this.dgLineNumberTitle = this.localePipe.transform("lineNumber");
        this.dgIdField = "bifDgId0d63";
        this.localeId = localeId || this.inj.get(LOCALE_ID);
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        // 设置section标题
        this.secTitle = this.localePipe.transform("basicInfo");
        // 表名解析
        this.secTitle = this.dataInfoService.getTableLabel(this.billInfo, this.schemaTable, this.localeId);
        // 单据追踪配置
        /** @type {?} */
        let bts = new BillTrackingSettings();
        if (this.billInfo && this.billInfo.billTrackingSettings) {
            bts.LoadFromJson(this.billInfo.billTrackingSettings);
        }
        // 字段解析
        /** @type {?} */
        let fieldContent = bts.customFieldContent;
        /** @type {?} */
        let fieldConfig = fieldContent && (typeof fieldContent == "object" ? fieldContent : JSON.parse(fieldContent));
        /** @type {?} */
        let selectedFields = fieldConfig && fieldConfig.schema && fieldConfig.schema[this.schemaTable.tableName] && fieldConfig.schema[this.schemaTable.tableName].fields;
        selectedFields = selectedFields ? selectedFields : [];
        /** @type {?} */
        let showCustomFields = bts.billTrackingDataShownMode === BillTrackingDataShownMode.CUSTOMFIELD;
        /** @type {?} */
        const fs = this.schemaTable.getFieldList();
        // 提取字段
        /** @type {?} */
        let ffs = this.dataInfoService.extractFFields(fs, selectedFields, showCustomFields);
        // 筛选显示列
        ffs = ffs.filter((/**
         * @param {?} f
         * @return {?}
         */
        f => f.show));
        // 按order排序
        ffs = this.dataInfoService.sortFieldsByOrder(ffs);
        // 创建显示列
        this.dgCols = [];
        ffs.forEach((/**
         * @param {?} f
         * @return {?}
         */
        (f) => {
            /** @type {?} */
            let c = {
                field: f.fieldPath || f.fieldName,
                title: this.dataInfoService.getFieldLabel(f, this.localeId),
                width: 120
            };
            if (f.dataType == DataType.Boolean) {
                c.formatter = (/**
                 * @param {?} value
                 * @param {?} rowData
                 * @param {?} rowIndex
                 * @return {?}
                 */
                (value, rowData, rowIndex) => {
                    if (value == true) {
                        return this.localePipe.transform("yes");
                    }
                    else if (value == false) {
                        return this.localePipe.transform("no");
                    }
                    else {
                        return "-";
                    }
                });
            }
            if (f.dataType == DataType.Integer || f.dataType == DataType.Decimal) {
                c.halign = "right";
                c.align = "right";
            }
            this.dgCols.push(c);
        }));
        // 构建行数据
        /** @type {?} */
        const rows = this.dataTable ? this.dataTable.GetRowList() : [];
        try {
            this.dgData = [...this.dataInfoService.extractDataRows(rows, ffs, fs, this.dgIdField)];
        }
        catch (error) {
            this.dgData = [];
            if (error == Exceptions.SCALE_FIELD_VALUE_IS_NAN) {
                this.messager.error(this.localePipe.transform("scaleFieldCantBeCastToInteger"));
            }
            throw error;
        }
        if (this.dgData.length > 0) {
            setTimeout((/**
             * @return {?}
             */
            () => {
                this.dg && this.dg.selectRow(this.dgData[0][this.dgIdField]);
            }), 500);
        }
    }
    /**
     * @param {?} row
     * @return {?}
     */
    selectChanged(row) {
        /** @type {?} */
        const r = this.dataTable ? this.dataTable.GetRowMap()[row.id] : null;
        this.showDetail = r != null && this.dataInfoService.hasChildData(r, this.billInfo);
        this.cdr.detectChanges();
    }
    /**
     * @return {?}
     */
    viewChildData() {
        if (this.dg.selectedRow == null) {
            this.notify.warning(this.localePipe.transform("selectOneFirst"));
            return;
        }
        /** @type {?} */
        const row = this.dataTable ? this.dataTable.GetRowMap()[this.dg.selectedRow.id] : null;
        if (row == null || !this.dataInfoService.hasChildData(row, this.billInfo)) {
            this.notify.info(this.localePipe.transform("noChildData"));
            return;
        }
        /** @type {?} */
        const cmpF = this.cfr.resolveComponentFactory(ChildInfoListComponent);
        /** @type {?} */
        const cmpR = cmpF.create(this.inj, []);
        // 获取子表列表
        /** @type {?} */
        const childSchemaTables = this.dataInfoService.getChildTables(this.billInfo, this.schemaTable);
        cmpR.instance.childSchemaTables = childSchemaTables;
        cmpR.instance.childDataTableMap = row.GetChildTableMap();
        cmpR.instance.billInfo = this.billInfo;
        /** @type {?} */
        const bsModalRef = this.modal.show(cmpR, {
            title: this.localePipe.transform("childData"),
            width: 900,
            height: 600,
            showButtons: false,
        });
        cmpR.instance.bsModalRef = bsModalRef;
    }
}
ChildInfoComponent.decorators = [
    { type: Component, args: [{
                selector: "lib-bill-tracker-child-info",
                template: "<div class=\"f-struct-wrapper\" *ngIf=\"dgCols&&dgCols.length>0&&dgData&&dgData.length>0\">\r\n    <farris-section class=\"f-section-tabs f-section-in-mainsubcard\" [mainTitle]=\"secTitle\">\r\n        <ng-template farrisSectionToolbar [toolbarCls]=\"'section-test-toolbar'\">\r\n            <button class=\"btn btn-secondary f-btn-ml\" *ngIf=\"showDetail\" (click)=\"viewChildData()\">\r\n                {{ \"childData\" | billTrackerLocale}}\r\n            </button>\r\n        </ng-template>\r\n        <div class=\"\">\r\n            <div class=\"f-utils-fill\">\r\n                <farris-datagrid #dg [data]=\"dgData\" [idField]=\"dgIdField\" [fields]=\"dgCols\" [showLineNumber]=\"true\"\r\n                    [striped]=\"true\" [virtualized]=\"false\" [pagination]=\"false\" [virtualizedAsyncLoad]=\"false\"\r\n                    [multiSelect]=\"false\" [fit]=\"true\" [showCheckbox]=\"false\" [showAllCheckbox]=\"false\"\r\n                    [lineNumberTitle]=\"dgLineNumberTitle\" [mergeCell]=\"false\" [showBorder]=\"true\"\r\n                    [checkOnSelect]=\"false\" [selectOnCheck]=\"false\" [nowrap]=\"true\" [autoFitColumns]=\"true\"\r\n                    [fitColumns]=\"true\" [autoHeight]=\"false\" (selectChanged)=\"selectChanged($event)\">\r\n                </farris-datagrid>\r\n            </div>\r\n        </div>\r\n    </farris-section>\r\n</div>"
            }] }
];
/** @nocollapse */
ChildInfoComponent.ctorParameters = () => [
    { type: NotifyService },
    { type: MessagerService },
    { type: LoadingService },
    { type: BsModalService },
    { type: BillTrackerDataInfoService },
    { type: BillTrackerLocalePipe },
    { type: ViewContainerRef },
    { type: Injector },
    { type: ComponentFactoryResolver },
    { type: ChangeDetectorRef },
    { type: String, decorators: [{ type: Optional }, { type: Inject, args: [LOCALE_ID,] }] }
];
ChildInfoComponent.propDecorators = {
    schemaTable: [{ type: Input, args: ["schemaTable",] }],
    dataTable: [{ type: Input, args: ["dataTable",] }],
    billInfo: [{ type: Input, args: ["billInfo",] }],
    dg: [{ type: ViewChild, args: ["dg",] }]
};
if (false) {
    /** @type {?} */
    ChildInfoComponent.prototype.schemaTable;
    /** @type {?} */
    ChildInfoComponent.prototype.dataTable;
    /** @type {?} */
    ChildInfoComponent.prototype.billInfo;
    /** @type {?} */
    ChildInfoComponent.prototype.secTitle;
    /** @type {?} */
    ChildInfoComponent.prototype.showDetail;
    /** @type {?} */
    ChildInfoComponent.prototype.dg;
    /** @type {?} */
    ChildInfoComponent.prototype.dgCols;
    /** @type {?} */
    ChildInfoComponent.prototype.dgData;
    /** @type {?} */
    ChildInfoComponent.prototype.dgLineNumberTitle;
    /** @type {?} */
    ChildInfoComponent.prototype.dgIdField;
    /** @type {?} */
    ChildInfoComponent.prototype.notify;
    /** @type {?} */
    ChildInfoComponent.prototype.messager;
    /** @type {?} */
    ChildInfoComponent.prototype.loading;
    /** @type {?} */
    ChildInfoComponent.prototype.modal;
    /** @type {?} */
    ChildInfoComponent.prototype.dataInfoService;
    /** @type {?} */
    ChildInfoComponent.prototype.localePipe;
    /** @type {?} */
    ChildInfoComponent.prototype.vcr;
    /** @type {?} */
    ChildInfoComponent.prototype.inj;
    /** @type {?} */
    ChildInfoComponent.prototype.cfr;
    /** @type {?} */
    ChildInfoComponent.prototype.cdr;
    /** @type {?} */
    ChildInfoComponent.prototype.localeId;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2hpbGQtaW5mby5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZWRwLWJpZi9ydW50aW1lLWFwaS8iLCJzb3VyY2VzIjpbImxpYi9iaWxsLXRyYWNrZXIvY29tcG9uZW50cy9jaGlsZC1pbmZvL2NoaWxkLWluZm8uY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsT0FBTyxFQUFFLGlCQUFpQixFQUFFLFNBQVMsRUFBRSx3QkFBd0IsRUFBRSxNQUFNLEVBQUUsUUFBUSxFQUFFLEtBQUssRUFBRSxTQUFTLEVBQVUsUUFBUSxFQUFFLFNBQVMsRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUMxSyxPQUFPLEVBQUUsYUFBYSxFQUE0RCxlQUFlLEVBQUUsUUFBUSxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDekksT0FBTyxFQUFpQyx5QkFBeUIsRUFBRSxvQkFBb0IsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQ3JILE9BQU8sRUFBYyxpQkFBaUIsRUFBZSxNQUFNLHFCQUFxQixDQUFDO0FBQ2pGLE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQztBQUNwRCxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDdEQsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLGtCQUFrQixDQUFDO0FBQ2xELE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUNsRCxPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0sbUNBQW1DLENBQUM7QUFDN0QsT0FBTyxFQUFFLHFCQUFxQixFQUFFLE1BQU0scUNBQXFDLENBQUM7QUFDNUUsT0FBTyxFQUFFLDBCQUEwQixFQUFFLE1BQU0sK0NBQStDLENBQUM7QUFDM0YsT0FBTyxFQUFFLHNCQUFzQixFQUFFLE1BQU0sOENBQThDLENBQUM7QUFDdEYsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLHFDQUFxQyxDQUFDO0FBT2pFLE1BQU0s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SUFDNUIsNkNBQWtEOztJQUNsRCx3Q0FBd0M7O0lBQ3hDLGlDQUE0Qjs7SUFDNUIsaUNBQW9COztJQUNwQixpQ0FBb0M7O0lBQ3BDLGlDQUE2Qjs7SUFDN0Isc0NBQXNEIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ2hhbmdlRGV0ZWN0b3JSZWYsIENvbXBvbmVudCwgQ29tcG9uZW50RmFjdG9yeVJlc29sdmVyLCBJbmplY3QsIEluamVjdG9yLCBJbnB1dCwgTE9DQUxFX0lELCBPbkluaXQsIE9wdGlvbmFsLCBWaWV3Q2hpbGQsIFZpZXdDb250YWluZXJSZWYgfSBmcm9tIFwiQGFuZ3VsYXIvY29yZVwiO1xyXG5pbXBvcnQgeyBCaWxsRGF0YVRhYmxlLCBCaWxsU2NoZW1hRmllbGQsIEJpbGxTY2hlbWFGaWVsZEJhc2UsIEJpbGxTY2hlbWFTdWJGaWVsZCwgQmlsbFNjaGVtYVRhYmxlLCBEYXRhVHlwZSB9IGZyb20gXCJAZWRwLWFpZi9jb21tb24tYXBpXCI7XHJcbmltcG9ydCB7IEJpbGxUcmFja2VyU2NoZW1hRmllbGRDb250ZW50LCBCaWxsVHJhY2tpbmdEYXRhU2hvd25Nb2RlLCBCaWxsVHJhY2tpbmdTZXR0aW5ncyB9IGZyb20gXCJAZWRwLWJpZi9jb21tb24tYXBpXCI7XHJcbmltcG9ydCB7IERhdGFDb2x1bW4sIERhdGFncmlkQ29tcG9uZW50LCBTZWxlY3RlZFJvdyB9IGZyb20gXCJAZmFycmlzL3VpLWRhdGFncmlkXCI7XHJcbmltcG9ydCB7IExvYWRpbmdTZXJ2aWNlIH0gZnJvbSBcIkBmYXJyaXMvdWktbG9hZGluZ1wiO1xyXG5pbXBvcnQgeyBNZXNzYWdlclNlcnZpY2UgfSBmcm9tIFwiQGZhcnJpcy91aS1tZXNzYWdlclwiO1xyXG5pbXBvcnQgeyBCc01vZGFsU2VydmljZSB9IGZyb20gXCJAZmFycmlzL3VpLW1vZGFsXCI7XHJcbmltcG9ydCB7IE5vdGlmeVNlcnZpY2UgfSBmcm9tIFwiQGZhcnJpcy91aS1ub3RpZnlcIjtcclxuaW1wb3J0IHsgQmlsbEluZm8gfSBmcm9tIFwiLi4vLi4vLi4vZW50aXR5L3RyYWNraW5nL0JpbGxJbmZvXCI7XHJcbmltcG9ydCB7IEJpbGxUcmFja2VyTG9jYWxlUGlwZSB9IGZyb20gXCIuLi8uLi9waXBlL2JpbGwtdHJhY2tlci1sb2NhbGUucGlwZVwiO1xyXG5pbXBvcnQgeyBCaWxsVHJhY2tlckRhdGFJbmZvU2VydmljZSB9IGZyb20gXCIuLi8uLi9zZXJ2aWNlcy9iaWxsLXRyYWNrZXItZGF0YS1pbmZvLnNlcnZpY2VcIjtcclxuaW1wb3J0IHsgQ2hpbGRJbmZvTGlzdENvbXBvbmVudCB9IGZyb20gXCIuLi9jaGlsZC1pbmZvLWxpc3QvY2hpbGQtaW5mby1saXN0LmNvbXBvbmVudFwiO1xyXG5pbXBvcnQgeyBFeGNlcHRpb25zIH0gZnJvbSBcIi4uLy4uLy4uL2VudGl0eS90cmFja2luZy9FeGNlcHRpb25zXCI7XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICBzZWxlY3RvcjogXCJsaWItYmlsbC10cmFja2VyLWNoaWxkLWluZm9cIixcclxuICB0ZW1wbGF0ZVVybDogXCIuL2NoaWxkLWluZm8uY29tcG9uZW50Lmh0bWxcIixcclxuICBzdHlsZVVybHM6IFtdXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBDaGlsZEluZm9Db21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xyXG4gIEBJbnB1dChcInNjaGVtYVRhYmxlXCIpXHJcbiAgcHVibGljIHNjaGVtYVRhYmxlOiBCaWxsU2NoZW1hVGFibGU7XHJcblxyXG4gIEBJbnB1dChcImRhdGFUYWJsZVwiKVxyXG4gIHB1YmxpYyBkYXRhVGFibGU6IEJpbGxEYXRhVGFibGU7XHJcblxyXG4gIEBJbnB1dChcImJpbGxJbmZvXCIpXHJcbiAgcHVibGljIGJpbGxJbmZvOiBCaWxsSW5mbztcclxuXHJcbiAgc2VjVGl0bGUgPSBudWxsO1xyXG5cclxuICBzaG93RGV0YWlsID0gZmFsc2U7XHJcblxyXG4gIEBWaWV3Q2hpbGQoXCJkZ1wiKVxyXG4gIGRnOiBEYXRhZ3JpZENvbXBvbmVudDtcclxuICBkZ0NvbHMgPSBbXTtcclxuICBkZ0RhdGEgPSBbXTtcclxuICBkZ0xpbmVOdW1iZXJUaXRsZSA9IHRoaXMubG9jYWxlUGlwZS50cmFuc2Zvcm0oXCJsaW5lTnVtYmVyXCIpO1xyXG4gIGRnSWRGaWVsZCA9IFwiYmlmRGdJZDBkNjNcIjtcclxuXHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICBwdWJsaWMgbm90aWZ5OiBOb3RpZnlTZXJ2aWNlLFxyXG4gICAgcHVibGljIG1lc3NhZ2VyOiBNZXNzYWdlclNlcnZpY2UsXHJcbiAgICBwdWJsaWMgbG9hZGluZzogTG9hZGluZ1NlcnZpY2UsXHJcbiAgICBwdWJsaWMgbW9kYWw6IEJzTW9kYWxTZXJ2aWNlLFxyXG4gICAgcHVibGljIGRhdGFJbmZvU2VydmljZTogQmlsbFRyYWNrZXJEYXRhSW5mb1NlcnZpY2UsXHJcbiAgICBwdWJsaWMgbG9jYWxlUGlwZTogQmlsbFRyYWNrZXJMb2NhbGVQaXBlLFxyXG4gICAgcHVibGljIHZjcjogVmlld0NvbnRhaW5lclJlZixcclxuICAgIHB1YmxpYyBpbmo6IEluamVjdG9yLFxyXG4gICAgcHVibGljIGNmcjogQ29tcG9uZW50RmFjdG9yeVJlc29sdmVyLFxyXG4gICAgcHVibGljIGNkcjogQ2hhbmdlRGV0ZWN0b3JSZWYsXHJcbiAgICBAT3B0aW9uYWwoKSBASW5qZWN0KExPQ0FMRV9JRCkgcHVibGljIGxvY2FsZUlkOiBzdHJpbmcsXHJcbiAgKSB7XHJcbiAgICB0aGlzLmxvY2FsZUlkID0gbG9jYWxlSWQgfHwgdGhpcy5pbmouZ2V0KExPQ0FMRV9JRCk7XHJcbiAgfVxyXG5cclxuICBuZ09uSW5pdCgpOiB2b2lkIHtcclxuICAgIC8vIOiuvue9rnNlY3Rpb27moIfpophcclxuICAgIHRoaXMuc2VjVGl0bGUgPSB0aGlzLmxvY2FsZVBpcGUudHJhbnNmb3JtKFwiYmFzaWNJbmZvXCIpO1xyXG4gICAgLy8g6KGo5ZCN6Kej5p6QXHJcbiAgICB0aGlzLnNlY1RpdGxlID0gdGhpcy5kYXRhSW5mb1NlcnZpY2UuZ2V0VGFibGVMYWJlbCh0aGlzLmJpbGxJbmZvLCB0aGlzLnNjaGVtYVRhYmxlLCB0aGlzLmxvY2FsZUlkKTtcclxuXHJcbiAgICAvLyDljZXmja7ov73ouKrphY3nva5cclxuICAgIGxldCBidHM6IEJpbGxUcmFja2luZ1NldHRpbmdzID0gbmV3IEJpbGxUcmFja2luZ1NldHRpbmdzKCk7XHJcbiAgICBpZiAodGhpcy5iaWxsSW5mbyAmJiB0aGlzLmJpbGxJbmZvLmJpbGxUcmFja2luZ1NldHRpbmdzKSB7XHJcbiAgICAgIGJ0cy5Mb2FkRnJvbUpzb24odGhpcy5iaWxsSW5mby5iaWxsVHJhY2tpbmdTZXR0aW5ncyk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8g5a2X5q616Kej5p6QXHJcbiAgICBsZXQgZmllbGRDb250ZW50ID0gYnRzLmN1c3RvbUZpZWxkQ29udGVudDtcclxuICAgIGxldCBmaWVsZENvbmZpZzogQmlsbFRyYWNrZXJTY2hlbWFGaWVsZENvbnRlbnQgPSBmaWVsZENvbnRlbnQgJiYgKHR5cGVvZiBmaWVsZENvbnRlbnQgPT0gXCJvYmplY3RcIiA/IGZpZWxkQ29udGVudCA6IEpTT04ucGFyc2UoZmllbGRDb250ZW50KSk7XHJcbiAgICBsZXQgc2VsZWN0ZWRGaWVsZHMgPSBmaWVsZENvbmZpZyAmJiBmaWVsZENvbmZpZy5zY2hlbWEgJiYgZmllbGRDb25maWcuc2NoZW1hW3RoaXMuc2NoZW1hVGFibGUudGFibGVOYW1lXSAmJiBmaWVsZENvbmZpZy5zY2hlbWFbdGhpcy5zY2hlbWFUYWJsZS50YWJsZU5hbWVdLmZpZWxkcztcclxuICAgIHNlbGVjdGVkRmllbGRzID0gc2VsZWN0ZWRGaWVsZHMgPyBzZWxlY3RlZEZpZWxkcyA6IFtdO1xyXG4gICAgbGV0IHNob3dDdXN0b21GaWVsZHMgPSBidHMuYmlsbFRyYWNraW5nRGF0YVNob3duTW9kZSA9PT0gQmlsbFRyYWNraW5nRGF0YVNob3duTW9kZS5DVVNUT01GSUVMRDtcclxuXHJcbiAgICBjb25zdCBmcyA9IHRoaXMuc2NoZW1hVGFibGUuZ2V0RmllbGRMaXN0KCk7XHJcbiAgICAvLyDmj5Dlj5blrZfmrrVcclxuICAgIGxldCBmZnMgPSB0aGlzLmRhdGFJbmZvU2VydmljZS5leHRyYWN0RkZpZWxkcyhmcywgc2VsZWN0ZWRGaWVsZHMsIHNob3dDdXN0b21GaWVsZHMpO1xyXG4gICAgLy8g562b6YCJ5pi+56S65YiXXHJcbiAgICBmZnMgPSBmZnMuZmlsdGVyKGYgPT4gZi5zaG93KTtcclxuICAgIC8vIOaMiW9yZGVy5o6S5bqPXHJcbiAgICBmZnMgPSB0aGlzLmRhdGFJbmZvU2VydmljZS5zb3J0RmllbGRzQnlPcmRlcihmZnMpO1xyXG5cclxuICAgIC8vIOWIm+W7uuaYvuekuuWIl1xyXG4gICAgdGhpcy5kZ0NvbHMgPSBbXTtcclxuICAgIGZmcy5mb3JFYWNoKChmOiBCaWxsU2NoZW1hRmllbGQgfCBCaWxsU2NoZW1hU3ViRmllbGQpID0+IHtcclxuICAgICAgbGV0IGM6IERhdGFDb2x1bW4gPSB7XHJcbiAgICAgICAgZmllbGQ6IGYuZmllbGRQYXRoIHx8IGYuZmllbGROYW1lLFxyXG4gICAgICAgIHRpdGxlOiB0aGlzLmRhdGFJbmZvU2VydmljZS5nZXRGaWVsZExhYmVsKGYsIHRoaXMubG9jYWxlSWQpLFxyXG4gICAgICAgIHdpZHRoOiAxMjBcclxuICAgICAgfTtcclxuICAgICAgaWYgKGYuZGF0YVR5cGUgPT0gRGF0YVR5cGUuQm9vbGVhbikge1xyXG4gICAgICAgIGMuZm9ybWF0dGVyID0gKHZhbHVlOiBib29sZWFuLCByb3dEYXRhLCByb3dJbmRleCkgPT4ge1xyXG4gICAgICAgICAgaWYgKHZhbHVlID09IHRydWUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMubG9jYWxlUGlwZS50cmFuc2Zvcm0oXCJ5ZXNcIik7XHJcbiAgICAgICAgICB9IGVsc2UgaWYgKHZhbHVlID09IGZhbHNlKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmxvY2FsZVBpcGUudHJhbnNmb3JtKFwibm9cIik7XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICByZXR1cm4gXCItXCI7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICAgIGlmIChmLmRhdGFUeXBlID09IERhdGFUeXBlLkludGVnZXIgfHwgZi5kYXRhVHlwZSA9PSBEYXRhVHlwZS5EZWNpbWFsKSB7XHJcbiAgICAgICAgYy5oYWxpZ24gPSBcInJpZ2h0XCI7XHJcbiAgICAgICAgYy5hbGlnbiA9IFwicmlnaHRcIjtcclxuICAgICAgfVxyXG4gICAgICB0aGlzLmRnQ29scy5wdXNoKGMpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgLy8g5p6E5bu66KGM5pWw5o2uXHJcbiAgICBjb25zdCByb3dzID0gdGhpcy5kYXRhVGFibGUgPyB0aGlzLmRhdGFUYWJsZS5HZXRSb3dMaXN0KCkgOiBbXTtcclxuICAgIHRyeSB7XHJcbiAgICAgIHRoaXMuZGdEYXRhID0gWy4uLnRoaXMuZGF0YUluZm9TZXJ2aWNlLmV4dHJhY3REYXRhUm93cyhyb3dzLCBmZnMsIGZzLCB0aGlzLmRnSWRGaWVsZCldO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgdGhpcy5kZ0RhdGEgPSBbXTtcclxuICAgICAgaWYgKGVycm9yID09IEV4Y2VwdGlvbnMuU0NBTEVfRklFTERfVkFMVUVfSVNfTkFOKSB7XHJcbiAgICAgICAgdGhpcy5tZXNzYWdlci5lcnJvcih0aGlzLmxvY2FsZVBpcGUudHJhbnNmb3JtKFwic2NhbGVGaWVsZENhbnRCZUNhc3RUb0ludGVnZXJcIikpO1xyXG4gICAgICB9XHJcbiAgICAgIHRocm93IGVycm9yO1xyXG4gICAgfVxyXG5cclxuICAgIGlmICh0aGlzLmRnRGF0YS5sZW5ndGggPiAwKSB7XHJcbiAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgIHRoaXMuZGcgJiYgdGhpcy5kZy5zZWxlY3RSb3codGhpcy5kZ0RhdGFbMF1bdGhpcy5kZ0lkRmllbGRdKTtcclxuICAgICAgfSwgNTAwKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHNlbGVjdENoYW5nZWQocm93OiBTZWxlY3RlZFJvdykge1xyXG4gICAgY29uc3QgciA9IHRoaXMuZGF0YVRhYmxlID8gdGhpcy5kYXRhVGFibGUuR2V0Um93TWFwKClbcm93LmlkXSA6IG51bGw7XHJcbiAgICB0aGlzLnNob3dEZXRhaWwgPSByICE9IG51bGwgJiYgdGhpcy5kYXRhSW5mb1NlcnZpY2UuaGFzQ2hpbGREYXRhKHIsIHRoaXMuYmlsbEluZm8pO1xyXG4gICAgdGhpcy5jZHIuZGV0ZWN0Q2hhbmdlcygpO1xyXG4gIH1cclxuXHJcbiAgdmlld0NoaWxkRGF0YSgpIHtcclxuICAgIGlmICh0aGlzLmRnLnNlbGVjdGVkUm93ID09IG51bGwpIHtcclxuICAgICAgdGhpcy5ub3RpZnkud2FybmluZyh0aGlzLmxvY2FsZVBpcGUudHJhbnNmb3JtKFwic2VsZWN0T25lRmlyc3RcIikpO1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3Qgcm93ID0gdGhpcy5kYXRhVGFibGUgPyB0aGlzLmRhdGFUYWJsZS5HZXRSb3dNYXAoKVt0aGlzLmRnLnNlbGVjdGVkUm93LmlkXSA6IG51bGw7XHJcbiAgICBpZiAocm93ID09IG51bGwgfHwgIXRoaXMuZGF0YUluZm9TZXJ2aWNlLmhhc0NoaWxkRGF0YShyb3csIHRoaXMuYmlsbEluZm8pKSB7XHJcbiAgICAgIHRoaXMubm90aWZ5LmluZm8odGhpcy5sb2NhbGVQaXBlLnRyYW5zZm9ybShcIm5vQ2hpbGREYXRhXCIpKTtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IGNtcEYgPSB0aGlzLmNmci5yZXNvbHZlQ29tcG9uZW50RmFjdG9yeShDaGlsZEluZm9MaXN0Q29tcG9uZW50KTtcclxuICAgIGNvbnN0IGNtcFIgPSBjbXBGLmNyZWF0ZSh0aGlzLmluaiwgW10pO1xyXG4gICAgLy8g6I635Y+W5a2Q6KGo5YiX6KGoXHJcbiAgICBjb25zdCBjaGlsZFNjaGVtYVRhYmxlcyA9IHRoaXMuZGF0YUluZm9TZXJ2aWNlLmdldENoaWxkVGFibGVzKHRoaXMuYmlsbEluZm8sIHRoaXMuc2NoZW1hVGFibGUpO1xyXG4gICAgY21wUi5pbnN0YW5jZS5jaGlsZFNjaGVtYVRhYmxlcyA9IGNoaWxkU2NoZW1hVGFibGVzO1xyXG4gICAgY21wUi5pbnN0YW5jZS5jaGlsZERhdGFUYWJsZU1hcCA9IHJvdy5HZXRDaGlsZFRhYmxlTWFwKCk7XHJcbiAgICBjbXBSLmluc3RhbmNlLmJpbGxJbmZvID0gdGhpcy5iaWxsSW5mbztcclxuICAgIGNvbnN0IGJzTW9kYWxSZWYgPSB0aGlzLm1vZGFsLnNob3coY21wUiwge1xyXG4gICAgICB0aXRsZTogdGhpcy5sb2NhbGVQaXBlLnRyYW5zZm9ybShcImNoaWxkRGF0YVwiKSxcclxuICAgICAgd2lkdGg6IDkwMCxcclxuICAgICAgaGVpZ2h0OiA2MDAsXHJcbiAgICAgIHNob3dCdXR0b25zOiBmYWxzZSxcclxuICAgIH0pO1xyXG4gICAgY21wUi5pbnN0YW5jZS5ic01vZGFsUmVmID0gYnNNb2RhbFJlZjtcclxuICB9XHJcbn1cclxuIl19
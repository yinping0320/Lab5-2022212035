/**
 * @fileoverview added by tsickle
 * Generated from: lib/bill-tracker/mxgraph-ext/Graph.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { GraphView } from './GraphView';
import { BillNodeShape } from './shapes/BillNodeShape';
import { BillAssociationLine } from './shapes/BillAssociationLine';
import { mxCellRenderer, mxUtils, mxGraph, mxPoint, mxRectangle, mxGeometry, mxConstants, mxImage, mxPerimeter } from "../../ref/mxgraph";
import { BillCell } from './BillCell';
import { Base64 } from '../utils/Base64';
import { VertexHandler } from './VertexHandler';
import { Events } from './Events';
import { Styles } from './Styles';
mxCellRenderer.registerShape("billNodeShape", BillNodeShape);
mxCellRenderer.registerShape("billAssociationLine", BillAssociationLine);
export class Graph extends mxGraph {
    /**
     * @param {?=} container
     * @param {?=} model
     * @param {?=} renderHint
     * @param {?=} stylesheet
     */
    constructor(container, model, renderHint, stylesheet) {
        super(container, model, renderHint, stylesheet);
        this.background = '#ffffff';
        // this.newBTS = newBTS;
        this.autoScroll = false;
        this.autoExtend = true;
        this.setCellsResizable(false);
        this.setCellsEditable(false);
        this.setTooltips(false);
        this.setHtmlLabels(true);
        // 节点标签支持拖动
        this.setVertexLabelsMovable(false);
        // 设置不可有悬空连线
        this.setAllowDanglingEdges(false);
        // 定义内置样式
        this.defineInnerStylesNewBTS();
        // 支持画布拖动
        this.setPanning(true);
        this.panningHandler.useLeftButtonForPanning = true;
        this.container.style.cursor = 'grab';
        this.scrollTileSize = new mxRectangle(0, 0, 400, 400);
        this.addListener(Events.RESET_GRAPH_VIEW, this.resetGraphView);
    }
    /**
     * @return {?}
     */
    createGraphView() {
        return new GraphView(this);
    }
    /**
     * @param {?} state
     * @return {?}
     */
    createVertexHandler(state) {
        return new VertexHandler(state);
    }
    /**
     * @return {?}
     */
    getPagePadding() {
        return new mxPoint(Math.max(0, Math.round(this.container.offsetWidth - 34)), Math.max(0, Math.round(this.container.offsetHeight - 34)));
    }
    /**
     * @return {?}
     */
    getPageSize() {
        return (this.pageVisible) ? new mxRectangle(0, 0, this.pageFormat.width * this.pageScale, this.pageFormat.height * this.pageScale) : this.getScrollTileSize();
    }
    /**
     * @return {?}
     */
    getPageLayout() {
        /** @type {?} */
        let size = (this.pageVisible) ? this.getPageSize() : this.getScrollTileSize();
        /** @type {?} */
        let bounds = this.getGraphBounds();
        if (bounds.width == 0 || bounds.height == 0) {
            return new mxRectangle(0, 0, 1, 1);
        }
        else {
            // Computes untransformed graph bounds
            /** @type {?} */
            let x = Math.ceil(bounds.x / this.view.scale - this.view.translate.x);
            /** @type {?} */
            let y = Math.ceil(bounds.y / this.view.scale - this.view.translate.y);
            /** @type {?} */
            let w = Math.floor(bounds.width / this.view.scale);
            /** @type {?} */
            let h = Math.floor(bounds.height / this.view.scale);
            /** @type {?} */
            let x0 = Math.floor(x / size.width);
            /** @type {?} */
            let y0 = Math.floor(y / size.height);
            /** @type {?} */
            let w0 = Math.ceil((x + w) / size.width) - x0;
            /** @type {?} */
            let h0 = Math.ceil((y + h) / size.height) - y0;
            return new mxRectangle(x0, y0, w0, h0);
        }
    }
    /**
     * @return {?}
     */
    getScrollTileSize() {
        if (this.scrollTileSize == null) {
            this.scrollTileSize = new mxRectangle(0, 0, 400, 600);
        }
        return this.scrollTileSize;
    }
    /**
     * @param {?} bounds
     * @param {?} width
     * @param {?} height
     * @return {?}
     */
    getPreferredPageSize(bounds, width, height) {
        //scrollTileSize有值后再调用重载实现
        /** @type {?} */
        let pages = this.getPageLayout();
        /** @type {?} */
        let size = this.getPageSize();
        return new mxRectangle(0, 0, pages.width * size.width, pages.height * size.height);
    }
    /**
     * @return {?}
     */
    sizeDidChange() {
        if (this.container != null && mxUtils.hasScrollbars(this.container)) {
            /** @type {?} */
            let pages = this.getPageLayout();
            /** @type {?} */
            let pad = this.getPagePadding();
            /** @type {?} */
            let size = this.getPageSize();
            // Updates the minimum graph size
            /** @type {?} */
            let minw = Math.ceil(2 * pad.x / this.view.scale + pages.width * size.width);
            /** @type {?} */
            let minh = Math.ceil(2 * pad.y / this.view.scale + pages.height * size.height);
            /** @type {?} */
            let min = this.minimumGraphSize;
            // LATER: Fix flicker of scrollbar size in IE quirks mode
            // after delayed call in window.resize event handler
            if (min == null || min.width != minw || min.height != minh) {
                this.minimumGraphSize = new mxRectangle(0, 0, minw, minh);
            }
            // Updates auto-translate to include padding and graph size
            /** @type {?} */
            let dx = pad.x / this.view.scale - pages.x * size.width;
            /** @type {?} */
            let dy = pad.y / this.view.scale - pages.y * size.height;
            if (!this.autoTranslate && (this.view.translate.x != dx || this.view.translate.y != dy)) {
                this.autoTranslate = true;
                this.view.x0 = pages.x;
                this.view.y0 = pages.y;
                // NOTE: THIS INVOKES THIS METHOD AGAIN. UNFORTUNATELY THERE IS NO WAY AROUND THIS SINCE THE
                // BOUNDS ARE KNOWN AFTER THE VALIDATION AND SETTING THE TRANSLATE TRIGGERS A REVALIDATION.
                // SHOULD MOVE TRANSLATE/SCALE TO VIEW.
                /** @type {?} */
                let tx = this.view.translate.x;
                /** @type {?} */
                let ty = this.view.translate.y;
                this.view.setTranslate(dx, dy);
                this.container.scrollLeft += (dx - tx) * this.view.scale;
                this.container.scrollTop += (dy - ty) * this.view.scale;
                this.autoTranslate = false;
                return;
            }
            //super.sizeDidChange.apply(this, arguments);
            super.sizeDidChange();
        }
    }
    /**
     * @return {?}
     */
    resetGraphView() {
        /** @type {?} */
        let bounds = this.getGraphBounds();
        /** @type {?} */
        let dataRegionHeight = 0;
        if (this.gridOptions.showEntryData) {
            if (typeof this.gridOptions.defaultHeight == "string") {
                dataRegionHeight = 0;
            }
            else {
                dataRegionHeight = this.gridOptions.defaultHeight;
            }
        }
        /** @type {?} */
        let s = Math.min(this.container.clientWidth / bounds.width, (this.container.clientHeight - dataRegionHeight - 20) / bounds.height);
        // 设定最大为1倍
        s = s >= 1 ? 1 : s;
        // 设定最小为0.6倍
        s = s <= 0.6 ? 0.6 : s;
        this.zoomTo(s, true);
        bounds = this.getGraphBounds();
        /** @type {?} */
        let width = Math.max(bounds.width, this.scrollTileSize.width * this.view.scale);
        /** @type {?} */
        let height = Math.max(bounds.height, this.scrollTileSize.height * this.view.scale);
        // this.container.scrollTop = Math.floor(Math.max(0, bounds.y - Math.max(20, (this.container.clientHeight - height) / 4)));
        // this.container.scrollLeft = Math.floor(Math.max(0, bounds.x - Math.max(0, (this.container.clientWidth - width) / 2)));
        this.container.scrollTop = Math.floor(Math.max(0, bounds.y - (this.container.clientHeight - bounds.height) / 2 + 79));
        this.container.scrollLeft = Math.floor(Math.max(0, bounds.x - (this.container.clientWidth - bounds.width) / 2));
    }
    /**
     * @param {?} parent
     * @param {?} id
     * @param {?} billDataInfo
     * @param {?} billInfo
     * @param {?} entry
     * @param {?} x
     * @param {?} y
     * @param {?} width
     * @param {?} height
     * @param {?=} style
     * @param {?=} relative
     * @return {?}
     */
    insertBillCell(parent, id, billDataInfo, billInfo, entry, x, y, width, height, style, relative) {
        /** @type {?} */
        let billCell = this.createBillCell(parent, id, billDataInfo, billInfo, entry, x, y, width, height, style, relative);
        return (/** @type {?} */ (this.addCell(billCell, parent)));
    }
    /**
     * @param {?} parent
     * @param {?} id
     * @param {?} billDataInfo
     * @param {?} billInfo
     * @param {?} entry
     * @param {?} x
     * @param {?} y
     * @param {?} width
     * @param {?} height
     * @param {?=} style
     * @param {?=} relative
     * @return {?}
     */
    createBillCell(parent, id, billDataInfo, billInfo, entry, x, y, width, height, style, relative) {
        /** @type {?} */
        let geometry = new mxGeometry(x, y, width, height);
        geometry.relative = (relative != null) ? relative : false;
        /** @type {?} */
        let billCell = new BillCell(billDataInfo, billInfo, entry, geometry, style);
        billCell.setId(id);
        billCell.setVertex(true);
        billCell.setConnectable(true);
        return billCell;
    }
    /**
     * @param {?} cell
     * @return {?}
     */
    getTooltipForCell(cell) {
        if (cell instanceof BillCell) {
            return cell.buildHtmlTooltip();
        }
        return super.getTooltipForCell(cell);
    }
    /**
     * @param {?} cell
     * @return {?}
     */
    getLabel(cell) {
        if (cell instanceof BillCell) {
            // if (this.newBTS) {
            return super.getLabel(cell);
            // } else {
            //     return cell.getCaption();
            // }
        }
        return super.getLabel(cell);
    }
    /**
     * @param {?} cell
     * @return {?}
     */
    convertValueToString(cell) {
        if (cell instanceof BillCell) {
            return cell.buildHtmlLabel(this);
        }
        else {
            return super.convertValueToString(cell);
        }
    }
    /**
     * @private
     * @return {?}
     */
    defineInnerStylesNewBTS() {
        //定义单据节点样式
        /** @type {?} */
        let style = Object.assign({}, this.getStylesheet().getDefaultVertexStyle());
        style[mxConstants.STYLE_FILLCOLOR] = 'none';
        style[mxConstants.STYLE_STROKE_OPACITY] = '0';
        style[mxConstants.STYLE_STROKEWIDTH] = '1';
        style[mxConstants.STYLE_FONTCOLOR] = 'black';
        style[mxConstants.STYLE_FONTSIZE] = '12';
        style[mxConstants.STYLE_FONTSTYLE] = '1';
        style[mxConstants.STYLE_ROUNDED] = '1';
        style[mxConstants.STYLE_SPACING] = 8;
        style[mxConstants.STYLE_WHITE_SPACE] = 'wrap';
        // 图片拉伸
        style[mxConstants.STYLE_IMAGE_ASPECT] = '0';
        //节点标签显示于节点下方
        style[mxConstants.STYLE_PERIMETER] = mxPerimeter.RectanglePerimeter;
        style[mxConstants.STYLE_ALIGN] = mxConstants.ALIGN_CENTER;
        style[mxConstants.STYLE_VERTICAL_ALIGN] = mxConstants.ALIGN_MIDDLE;
        this.getStylesheet().putCellStyle(Styles.STYLE_BILL_NODE_NAME, style);
        //定义开始查询节点样式
        style = Object.assign({}, style);
        this.getStylesheet().putCellStyle(Styles.STYLE_BILL_NODE_ENTRY_NAME, style);
        //定义单据关联连线样式
        style = Object.assign({}, this.getStylesheet().getDefaultEdgeStyle());
        style[mxConstants.STYLE_SHAPE] = mxConstants.SHAPE_CONNECTOR;
        style[mxConstants.STYLE_STROKECOLOR] = '#2A87FF';
        style[mxConstants.STYLE_ENDARROW] = mxConstants.ARROW_CLASSIC;
        style[mxConstants.STYLE_VERTICAL_ALIGN] = mxConstants.ALIGN_MIDDLE;
        style[mxConstants.STYLE_ALIGN] = mxConstants.ALIGN_CENTER;
        style[mxConstants.STYLE_EDGE] = mxConstants.EDGESTYLE_ELBOW;
        style[mxConstants.STYLE_ELBOW] = mxConstants.ELBOW_HORIZONTAL;
        style[mxConstants.STYLE_STROKEWIDTH] = 1.8;
        style[mxConstants.STYLE_DASHED] = 1;
        style[mxConstants.STYLE_OPACITY] = 80;
        this.getStylesheet().putCellStyle(Styles.STYLE_BILL_ASSOCIATION_NAME, style);
    }
    /**
     * @param {?} cell
     * @param {?} evt
     * @return {?}
     */
    selectCellForEvent(cell, evt) {
        super.selectCellForEvent(cell, evt);
    }
    /**
     * @return {?}
     */
    createCellRenderer() {
        /** @type {?} */
        const render = super.createCellRenderer();
        // 重写label事件判断方法，解决点击节点操作按钮时如果出现loading则按钮消失的问题
        // note：此改动会使点击节点操作按钮时不触发节点选中事件
        // note: 此改动后，点击节点摘要超链接的监听器中主动触发选中事件
        /** @type {?} */
        const oldIsLabelEvent = render.isLabelEvent;
        render.isLabelEvent = (/**
         * @param {?} state
         * @param {?} evt
         * @return {?}
         */
        (state, evt) => {
            if (state.cell instanceof BillCell) {
                if (evt && evt.target
                    && ((/** @type {?} */ (evt.target))).classList
                    && ((/** @type {?} */ (evt.target))).classList.value
                    && (((/** @type {?} */ (evt.target))).classList.value.includes("bif-cell-node-title-link bif-cell-node-title-link-color")
                        || ((/** @type {?} */ (evt.target))).classList.value.includes("bif-cell-node-btn"))) {
                    return false;
                }
                else {
                    return oldIsLabelEvent.apply(render, [state, evt]);
                }
            }
            return oldIsLabelEvent.apply(render, [state, evt]);
        });
        return render;
    }
    /**
     * @param {?} w
     * @param {?} h
     * @param {?} data
     * @return {?}
     */
    static createSvgImage(w, h, data) {
        /** @type {?} */
        var tmp = unescape(encodeURIComponent('<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">' +
            '<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="' + w + 'px" height="' + h + 'px" ' +
            'version="1.1">' + data + '</svg>'));
        return new mxImage('data:image/svg+xml;base64,' + ((window.btoa) ? btoa(tmp) : Base64.encode(tmp, true)), w, h);
    }
    /**
     * @return {?}
     */
    destroy() {
        super.destroy();
        this.selectEventEmitter = null;
    }
}
// newBTS: boolean = false;
Graph.handleFill = '#29b6f2';
if (false) {
    /** @type {?} */
    Graph.handleFill;
    /** @type {?} */
    Graph.prototype.selectEventEmitter;
    /** @type {?} */
    Graph.prototype.scrollTileSize;
    /** @type {?} */
    Graph.prototype.autoTranslate;
    /** @type {?} */
    Graph.prototype.view;
    /** @type {?} */
    Graph.prototype.background;
    /** @type {?} */
    Graph.prototype.graphOptions;
    /** @type {?} */
    Graph.prototype.gridOptions;
    /** @type {?} */
    Graph.prototype.localePipe;
    /** @type {?} */
    Graph.prototype.ngComp;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiR3JhcGguanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZWRwLWJpZi9ydW50aW1lLWFwaS8iLCJzb3VyY2VzIjpbImxpYi9iaWxsLXRyYWNrZXIvbXhncmFwaC1leHQvR3JhcGgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sYUFBYSxDQUFDO0FBQ3hDLE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSx3QkFBd0IsQ0FBQztBQUN2RCxPQUFPLEVBQUUsbUJBQW1CLEVBQUUsTUFBTSw4QkFBOEIsQ0FBQztBQUNuRSxPQUFPLEVBQUUsY0FBYyxFQUFFLE9BQU8sRUFBRSxPQUFPLEVBQUUsT0FBTyxFQUFFLFdBQVcsRUFBRSxVQUFVLEVBQWEsV0FBVyxFQUFFLE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUNySixPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0sWUFBWSxDQUFDO0FBSXRDLE9BQU8sRUFBRSxNQUFNLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUN6QyxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFDaEQsT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLFVBQVUsQ0FBQztBQUNsQyxPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU0sVUFBVSxDQUFDO0FBT2xDLGNBQWMsQ0FBQyxhQUFhLENBQUMsZUFBZSxFQUFFLGFBQWEsQ0FBQyxDQUFDO0FBQzdELGNBQWMsQ0FBQyxhQUFhLENBQUMscUJBQXFCLEVBQUUsbUJBQW1CLENBQUMsQ0FBQztBQUV6RSxNQUFNLE9BQU8sS0FBTSxTQUFRLE9BQU87Ozs7Ozs7SUFjaEMsWUFBWSxTQUFVLEVBQUUsS0FBTSxFQUFFLFVBQVcsRUFBRSxVQUFXO1FBQ3RELEtBQUssQ0FBQyxTQUFTLEVBQUUsS0FBSyxFQUFFLFVBQVUsRUFBRSxVQUFVLENBQUMsQ0FBQztRQVZsRCxlQUFVLEdBQVcsU0FBUyxDQUFDO1FBWTdCLHdCQUF3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QXVCOztJQUN2QixxQkFBZ0I7O0lBQ2hCLDJCQUErQjs7SUFJL0IsNkJBQXNDOztJQUN0Qyw0QkFBb0M7O0lBQ3BDLDJCQUFrQzs7SUFDbEMsdUJBQWtDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgR3JhcGhWaWV3IH0gZnJvbSAnLi9HcmFwaFZpZXcnO1xyXG5pbXBvcnQgeyBCaWxsTm9kZVNoYXBlIH0gZnJvbSAnLi9zaGFwZXMvQmlsbE5vZGVTaGFwZSc7XHJcbmltcG9ydCB7IEJpbGxBc3NvY2lhdGlvbkxpbmUgfSBmcm9tICcuL3NoYXBlcy9CaWxsQXNzb2NpYXRpb25MaW5lJztcclxuaW1wb3J0IHsgbXhDZWxsUmVuZGVyZXIsIG14VXRpbHMsIG14R3JhcGgsIG14UG9pbnQsIG14UmVjdGFuZ2xlLCBteEdlb21ldHJ5LCBNeEdyYXBoTlMsIG14Q29uc3RhbnRzLCBteEltYWdlLCBteFBlcmltZXRlciB9IGZyb20gXCIuLi8uLi9yZWYvbXhncmFwaFwiO1xyXG5pbXBvcnQgeyBCaWxsQ2VsbCB9IGZyb20gJy4vQmlsbENlbGwnO1xyXG5pbXBvcnQgeyBCaWxsRGF0YUluZm8gfSBmcm9tICcuLi8uLi9lbnRpdHkvdHJhY2tpbmcvQmlsbERhdGFJbmZvJztcclxuaW1wb3J0IHsgRG93bkJpbGxJbmZvUmVzdWx0IH0gZnJvbSAnLi4vYXJncy9Eb3duQmlsbEluZm9SZXN1bHQnO1xyXG5pbXBvcnQgeyBVcEJpbGxJbmZvUmVzdWx0IH0gZnJvbSAnLi4vYXJncy9VcEJpbGxJbmZvUmVzdWx0JztcclxuaW1wb3J0IHsgQmFzZTY0IH0gZnJvbSAnLi4vdXRpbHMvQmFzZTY0JztcclxuaW1wb3J0IHsgVmVydGV4SGFuZGxlciB9IGZyb20gJy4vVmVydGV4SGFuZGxlcic7XHJcbmltcG9ydCB7IEV2ZW50cyB9IGZyb20gJy4vRXZlbnRzJztcclxuaW1wb3J0IHsgU3R5bGVzIH0gZnJvbSAnLi9TdHlsZXMnO1xyXG5pbXBvcnQgeyBCaWxsVHJhY2tlckdyYXBoT3B0aW9ucyB9IGZyb20gJy4uL2NvbmZpZy9iaWxsLXRyYWNrZXItZ3JhcGgtb3B0aW9ucyc7XHJcbmltcG9ydCB7IEJpbGxUcmFja2VyR3JpZE9wdGlvbnMgfSBmcm9tICcuLi9jb25maWcvYmlsbC10cmFja2VyLWdyaWQtb3B0aW9ucyc7XHJcbmltcG9ydCB7IEJpbGxUcmFja2VyTG9jYWxlUGlwZSB9IGZyb20gJy4uL3BpcGUvYmlsbC10cmFja2VyLWxvY2FsZS5waXBlJztcclxuaW1wb3J0IHsgRXZlbnRFbWl0dGVyIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IEJpbGxUcmFja2VyR3JhcGhDb21wb25lbnQgfSBmcm9tICcuLi9jb21wb25lbnRzL2JpbGwtdHJhY2tlci1ncmFwaC9iaWxsLXRyYWNrZXItZ3JhcGguY29tcG9uZW50JztcclxuXHJcbm14Q2VsbFJlbmRlcmVyLnJlZ2lzdGVyU2hhcGUoXCJiaWxsTm9kZVNoYXBlXCIsIEJpbGxOb2RlU2hhcGUpO1xyXG5teENlbGxSZW5kZXJlci5yZWdpc3RlclNoYXBlKFwiYmlsbEFzc29jaWF0aW9uTGluZVwiLCBCaWxsQXNzb2NpYXRpb25MaW5lKTtcclxuXHJcbmV4cG9ydCBjbGFzcyBHcmFwaCBleHRlbmRzIG14R3JhcGgge1xyXG4gIHNlbGVjdEV2ZW50RW1pdHRlcjogRXZlbnRFbWl0dGVyPGFueT47XHJcbiAgc2Nyb2xsVGlsZVNpemU6IE14R3JhcGhOUy5teFJlY3RhbmdsZTtcclxuICBhdXRvVHJhbnNsYXRlOiBib29sZWFuO1xyXG4gIHZpZXc6IEdyYXBoVmlldztcclxuICBiYWNrZ3JvdW5kOiBzdHJpbmcgPSAnI2ZmZmZmZic7XHJcbiAgLy8gbmV3QlRTOiBib29sZWFuID0gZmFsc2U7XHJcblxyXG4gIHN0YXRpYyBoYW5kbGVGaWxsID0gJyMyOWI2ZjInO1xyXG4gIGdyYXBoT3B0aW9uczogQmlsbFRyYWNrZXJHcmFwaE9wdGlvbnM7XHJcbiAgZ3JpZE9wdGlvbnM6IEJpbGxUcmFja2VyR3JpZE9wdGlvbnM7XHJcbiAgbG9jYWxlUGlwZTogQmlsbFRyYWNrZXJMb2NhbGVQaXBlO1xyXG4gIG5nQ29tcDogQmlsbFRyYWNrZXJHcmFwaENvbXBvbmVudDtcclxuXHJcbiAgY29uc3RydWN0b3IoY29udGFpbmVyPywgbW9kZWw/LCByZW5kZXJIaW50Pywgc3R5bGVzaGVldD8pIHtcclxuICAgIHN1cGVyKGNvbnRhaW5lciwgbW9kZWwsIHJlbmRlckhpbnQsIHN0eWxlc2hlZXQpO1xyXG5cclxuICAgIC8vIHRoaXMubmV3QlRTID0gbmV3QlRTO1xyXG5cclxuICAgIHRoaXMuYXV0b1Njcm9sbCA9IGZhbHNlO1xyXG4gICAgdGhpcy5hdXRvRXh0ZW5kID0gdHJ1ZTtcclxuICAgIHRoaXMuc2V0Q2VsbHNSZXNpemFibGUoZmFsc2UpO1xyXG4gICAgdGhpcy5zZXRDZWxsc0VkaXRhYmxlKGZhbHNlKTtcclxuICAgIHRoaXMuc2V0VG9vbHRpcHMoZmFsc2UpO1xyXG4gICAgdGhpcy5zZXRIdG1sTGFiZWxzKHRydWUpO1xyXG4gICAgLy8g6IqC54K55qCH562+5pSv5oyB5ouW5YqoXHJcbiAgICB0aGlzLnNldFZlcnRleExhYmVsc01vdmFibGUoZmFsc2UpO1xyXG4gICAgLy8g6K6+572u5LiN5Y+v5pyJ5oKs56m66L+e57q/XHJcbiAgICB0aGlzLnNldEFsbG93RGFuZ2xpbmdFZGdlcyhmYWxzZSk7XHJcbiAgICAvLyDlrprkuYnlhoXnva7moLflvI9cclxuICAgIHRoaXMuZGVmaW5lSW5uZXJTdHlsZXNOZXdCVFMoKTtcclxuICAgIC8vIOaUr+aMgeeUu+W4g+aLluWKqFxyXG4gICAgdGhpcy5zZXRQYW5uaW5nKHRydWUpO1xyXG4gICAgdGhpcy5wYW5uaW5nSGFuZGxlci51c2VMZWZ0QnV0dG9uRm9yUGFubmluZyA9IHRydWU7XHJcbiAgICB0aGlzLmNvbnRhaW5lci5zdHlsZS5jdXJzb3IgPSAnZ3JhYic7XHJcblxyXG4gICAgdGhpcy5zY3JvbGxUaWxlU2l6ZSA9IG5ldyBteFJlY3RhbmdsZSgwLCAwLCA0MDAsIDQwMCk7XHJcbiAgICB0aGlzLmFkZExpc3RlbmVyKEV2ZW50cy5SRVNFVF9HUkFQSF9WSUVXLCB0aGlzLnJlc2V0R3JhcGhWaWV3KTtcclxuXHJcbiAgfVxyXG5cclxuICBjcmVhdGVHcmFwaFZpZXcoKSB7XHJcbiAgICByZXR1cm4gbmV3IEdyYXBoVmlldyh0aGlzKTtcclxuICB9XHJcblxyXG4gIGNyZWF0ZVZlcnRleEhhbmRsZXIoc3RhdGUpIHtcclxuICAgIHJldHVybiBuZXcgVmVydGV4SGFuZGxlcihzdGF0ZSk7XHJcbiAgfVxyXG5cclxuICBnZXRQYWdlUGFkZGluZygpIHtcclxuICAgIHJldHVybiBuZXcgbXhQb2ludChNYXRoLm1heCgwLCBNYXRoLnJvdW5kKHRoaXMuY29udGFpbmVyLm9mZnNldFdpZHRoIC0gMzQpKSxcclxuICAgICAgTWF0aC5tYXgoMCwgTWF0aC5yb3VuZCh0aGlzLmNvbnRhaW5lci5vZmZzZXRIZWlnaHQgLSAzNCkpKTtcclxuICB9XHJcblxyXG4gIGdldFBhZ2VTaXplKCkge1xyXG4gICAgcmV0dXJuICh0aGlzLnBhZ2VWaXNpYmxlKSA/IG5ldyBteFJlY3RhbmdsZSgwLCAwLCB0aGlzLnBhZ2VGb3JtYXQud2lkdGggKiB0aGlzLnBhZ2VTY2FsZSwgdGhpcy5wYWdlRm9ybWF0LmhlaWdodCAqIHRoaXMucGFnZVNjYWxlKSA6IHRoaXMuZ2V0U2Nyb2xsVGlsZVNpemUoKTtcclxuXHJcbiAgfVxyXG5cclxuICBnZXRQYWdlTGF5b3V0KCkge1xyXG4gICAgbGV0IHNpemUgPSAodGhpcy5wYWdlVmlzaWJsZSkgPyB0aGlzLmdldFBhZ2VTaXplKCkgOiB0aGlzLmdldFNjcm9sbFRpbGVTaXplKCk7XHJcbiAgICBsZXQgYm91bmRzID0gdGhpcy5nZXRHcmFwaEJvdW5kcygpO1xyXG5cclxuICAgIGlmIChib3VuZHMud2lkdGggPT0gMCB8fCBib3VuZHMuaGVpZ2h0ID09IDApIHtcclxuICAgICAgcmV0dXJuIG5ldyBteFJlY3RhbmdsZSgwLCAwLCAxLCAxKTtcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICAvLyBDb21wdXRlcyB1bnRyYW5zZm9ybWVkIGdyYXBoIGJvdW5kc1xyXG4gICAgICBsZXQgeCA9IE1hdGguY2VpbChib3VuZHMueCAvIHRoaXMudmlldy5zY2FsZSAtIHRoaXMudmlldy50cmFuc2xhdGUueCk7XHJcbiAgICAgIGxldCB5ID0gTWF0aC5jZWlsKGJvdW5kcy55IC8gdGhpcy52aWV3LnNjYWxlIC0gdGhpcy52aWV3LnRyYW5zbGF0ZS55KTtcclxuICAgICAgbGV0IHcgPSBNYXRoLmZsb29yKGJvdW5kcy53aWR0aCAvIHRoaXMudmlldy5zY2FsZSk7XHJcbiAgICAgIGxldCBoID0gTWF0aC5mbG9vcihib3VuZHMuaGVpZ2h0IC8gdGhpcy52aWV3LnNjYWxlKTtcclxuXHJcbiAgICAgIGxldCB4MCA9IE1hdGguZmxvb3IoeCAvIHNpemUud2lkdGgpO1xyXG4gICAgICBsZXQgeTAgPSBNYXRoLmZsb29yKHkgLyBzaXplLmhlaWdodCk7XHJcbiAgICAgIGxldCB3MCA9IE1hdGguY2VpbCgoeCArIHcpIC8gc2l6ZS53aWR0aCkgLSB4MDtcclxuICAgICAgbGV0IGgwID0gTWF0aC5jZWlsKCh5ICsgaCkgLyBzaXplLmhlaWdodCkgLSB5MDtcclxuXHJcbiAgICAgIHJldHVybiBuZXcgbXhSZWN0YW5nbGUoeDAsIHkwLCB3MCwgaDApO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgZ2V0U2Nyb2xsVGlsZVNpemUoKSB7XHJcbiAgICBpZiAodGhpcy5zY3JvbGxUaWxlU2l6ZSA9PSBudWxsKSB7XHJcbiAgICAgIHRoaXMuc2Nyb2xsVGlsZVNpemUgPSBuZXcgbXhSZWN0YW5nbGUoMCwgMCwgNDAwLCA2MDApO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB0aGlzLnNjcm9sbFRpbGVTaXplO1xyXG4gIH1cclxuXHJcbiAgZ2V0UHJlZmVycmVkUGFnZVNpemUoYm91bmRzLCB3aWR0aCwgaGVpZ2h0KSB7XHJcbiAgICAvL3Njcm9sbFRpbGVTaXpl5pyJ5YC85ZCO5YaN6LCD55So6YeN6L295a6e546wXHJcbiAgICBsZXQgcGFnZXMgPSB0aGlzLmdldFBhZ2VMYXlvdXQoKTtcclxuICAgIGxldCBzaXplID0gdGhpcy5nZXRQYWdlU2l6ZSgpO1xyXG5cclxuICAgIHJldHVybiBuZXcgbXhSZWN0YW5nbGUoMCwgMCwgcGFnZXMud2lkdGggKiBzaXplLndpZHRoLCBwYWdlcy5oZWlnaHQgKiBzaXplLmhlaWdodCk7XHJcbiAgfVxyXG5cclxuICBzaXplRGlkQ2hhbmdlKCkge1xyXG4gICAgaWYgKHRoaXMuY29udGFpbmVyICE9IG51bGwgJiYgbXhVdGlscy5oYXNTY3JvbGxiYXJzKHRoaXMuY29udGFpbmVyKSkge1xyXG4gICAgICBsZXQgcGFnZXMgPSB0aGlzLmdldFBhZ2VMYXlvdXQoKTtcclxuICAgICAgbGV0IHBhZCA9IHRoaXMuZ2V0UGFnZVBhZGRpbmcoKTtcclxuICAgICAgbGV0IHNpemUgPSB0aGlzLmdldFBhZ2VTaXplKCk7XHJcblxyXG4gICAgICAvLyBVcGRhdGVzIHRoZSBtaW5pbXVtIGdyYXBoIHNpemVcclxuICAgICAgbGV0IG1pbncgPSBNYXRoLmNlaWwoMiAqIHBhZC54IC8gdGhpcy52aWV3LnNjYWxlICsgcGFnZXMud2lkdGggKiBzaXplLndpZHRoKTtcclxuICAgICAgbGV0IG1pbmggPSBNYXRoLmNlaWwoMiAqIHBhZC55IC8gdGhpcy52aWV3LnNjYWxlICsgcGFnZXMuaGVpZ2h0ICogc2l6ZS5oZWlnaHQpO1xyXG5cclxuICAgICAgbGV0IG1pbiA9IHRoaXMubWluaW11bUdyYXBoU2l6ZTtcclxuXHJcbiAgICAgIC8vIExBVEVSOiBGaXggZmxpY2tlciBvZiBzY3JvbGxiYXIgc2l6ZSBpbiBJRSBxdWlya3MgbW9kZVxyXG4gICAgICAvLyBhZnRlciBkZWxheWVkIGNhbGwgaW4gd2luZG93LnJlc2l6ZSBldmVudCBoYW5kbGVyXHJcbiAgICAgIGlmIChtaW4gPT0gbnVsbCB8fCBtaW4ud2lkdGggIT0gbWludyB8fCBtaW4uaGVpZ2h0ICE9IG1pbmgpIHtcclxuICAgICAgICB0aGlzLm1pbmltdW1HcmFwaFNpemUgPSBuZXcgbXhSZWN0YW5nbGUoMCwgMCwgbWludywgbWluaCk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIFVwZGF0ZXMgYXV0by10cmFuc2xhdGUgdG8gaW5jbHVkZSBwYWRkaW5nIGFuZCBncmFwaCBzaXplXHJcbiAgICAgIGxldCBkeCA9IHBhZC54IC8gdGhpcy52aWV3LnNjYWxlIC0gcGFnZXMueCAqIHNpemUud2lkdGg7XHJcbiAgICAgIGxldCBkeSA9IHBhZC55IC8gdGhpcy52aWV3LnNjYWxlIC0gcGFnZXMueSAqIHNpemUuaGVpZ2h0O1xyXG5cclxuICAgICAgaWYgKCF0aGlzLmF1dG9UcmFuc2xhdGUgJiYgKHRoaXMudmlldy50cmFuc2xhdGUueCAhPSBkeCB8fCB0aGlzLnZpZXcudHJhbnNsYXRlLnkgIT0gZHkpKSB7XHJcbiAgICAgICAgdGhpcy5hdXRvVHJhbnNsYXRlID0gdHJ1ZTtcclxuICAgICAgICB0aGlzLnZpZXcueDAgPSBwYWdlcy54O1xyXG4gICAgICAgIHRoaXMudmlldy55MCA9IHBhZ2VzLnk7XHJcblxyXG4gICAgICAgIC8vIE5PVEU6IFRISVMgSU5WT0tFUyBUSElTIE1FVEhPRCBBR0FJTi4gVU5GT1JUVU5BVEVMWSBUSEVSRSBJUyBOTyBXQVkgQVJPVU5EIFRISVMgU0lOQ0UgVEhFXHJcbiAgICAgICAgLy8gQk9VTkRTIEFSRSBLTk9XTiBBRlRFUiBUSEUgVkFMSURBVElPTiBBTkQgU0VUVElORyBUSEUgVFJBTlNMQVRFIFRSSUdHRVJTIEEgUkVWQUxJREFUSU9OLlxyXG4gICAgICAgIC8vIFNIT1VMRCBNT1ZFIFRSQU5TTEFURS9TQ0FMRSBUTyBWSUVXLlxyXG4gICAgICAgIGxldCB0eCA9IHRoaXMudmlldy50cmFuc2xhdGUueDtcclxuICAgICAgICBsZXQgdHkgPSB0aGlzLnZpZXcudHJhbnNsYXRlLnk7XHJcblxyXG4gICAgICAgIHRoaXMudmlldy5zZXRUcmFuc2xhdGUoZHgsIGR5KTtcclxuICAgICAgICB0aGlzLmNvbnRhaW5lci5zY3JvbGxMZWZ0ICs9IChkeCAtIHR4KSAqIHRoaXMudmlldy5zY2FsZTtcclxuICAgICAgICB0aGlzLmNvbnRhaW5lci5zY3JvbGxUb3AgKz0gKGR5IC0gdHkpICogdGhpcy52aWV3LnNjYWxlO1xyXG5cclxuICAgICAgICB0aGlzLmF1dG9UcmFuc2xhdGUgPSBmYWxzZTtcclxuICAgICAgICByZXR1cm47XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vc3VwZXIuc2l6ZURpZENoYW5nZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xyXG4gICAgICBzdXBlci5zaXplRGlkQ2hhbmdlKCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICByZXNldEdyYXBoVmlldygpIHtcclxuICAgIGxldCBib3VuZHMgPSB0aGlzLmdldEdyYXBoQm91bmRzKCk7XHJcbiAgICBsZXQgZGF0YVJlZ2lvbkhlaWdodCA9IDA7XHJcbiAgICBpZiAodGhpcy5ncmlkT3B0aW9ucy5zaG93RW50cnlEYXRhKSB7XHJcbiAgICAgIGlmICh0eXBlb2YgdGhpcy5ncmlkT3B0aW9ucy5kZWZhdWx0SGVpZ2h0ID09IFwic3RyaW5nXCIpIHtcclxuICAgICAgICBkYXRhUmVnaW9uSGVpZ2h0ID0gMDtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBkYXRhUmVnaW9uSGVpZ2h0ID0gdGhpcy5ncmlkT3B0aW9ucy5kZWZhdWx0SGVpZ2h0O1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICBsZXQgcyA9IE1hdGgubWluKHRoaXMuY29udGFpbmVyLmNsaWVudFdpZHRoIC8gYm91bmRzLndpZHRoLCAodGhpcy5jb250YWluZXIuY2xpZW50SGVpZ2h0IC0gZGF0YVJlZ2lvbkhlaWdodCAtIDIwKSAvIGJvdW5kcy5oZWlnaHQpO1xyXG4gICAgLy8g6K6+5a6a5pyA5aSn5Li6MeWAjVxyXG4gICAgcyA9IHMgPj0gMSA/IDEgOiBzO1xyXG4gICAgLy8g6K6+5a6a5pyA5bCP5Li6MC425YCNXHJcbiAgICBzID0gcyA8PSAwLjYgPyAwLjYgOiBzO1xyXG4gICAgdGhpcy56b29tVG8ocywgdHJ1ZSk7XHJcblxyXG4gICAgYm91bmRzID0gdGhpcy5nZXRHcmFwaEJvdW5kcygpO1xyXG4gICAgbGV0IHdpZHRoID0gTWF0aC5tYXgoYm91bmRzLndpZHRoLCB0aGlzLnNjcm9sbFRpbGVTaXplLndpZHRoICogdGhpcy52aWV3LnNjYWxlKTtcclxuICAgIGxldCBoZWlnaHQgPSBNYXRoLm1heChib3VuZHMuaGVpZ2h0LCB0aGlzLnNjcm9sbFRpbGVTaXplLmhlaWdodCAqIHRoaXMudmlldy5zY2FsZSk7XHJcbiAgICAvLyB0aGlzLmNvbnRhaW5lci5zY3JvbGxUb3AgPSBNYXRoLmZsb29yKE1hdGgubWF4KDAsIGJvdW5kcy55IC0gTWF0aC5tYXgoMjAsICh0aGlzLmNvbnRhaW5lci5jbGllbnRIZWlnaHQgLSBoZWlnaHQpIC8gNCkpKTtcclxuICAgIC8vIHRoaXMuY29udGFpbmVyLnNjcm9sbExlZnQgPSBNYXRoLmZsb29yKE1hdGgubWF4KDAsIGJvdW5kcy54IC0gTWF0aC5tYXgoMCwgKHRoaXMuY29udGFpbmVyLmNsaWVudFdpZHRoIC0gd2lkdGgpIC8gMikpKTtcclxuICAgIHRoaXMuY29udGFpbmVyLnNjcm9sbFRvcCA9IE1hdGguZmxvb3IoTWF0aC5tYXgoMCwgYm91bmRzLnkgLSAodGhpcy5jb250YWluZXIuY2xpZW50SGVpZ2h0IC0gYm91bmRzLmhlaWdodCkgLyAyICsgNzkpKTtcclxuICAgIHRoaXMuY29udGFpbmVyLnNjcm9sbExlZnQgPSBNYXRoLmZsb29yKE1hdGgubWF4KDAsIGJvdW5kcy54IC0gKHRoaXMuY29udGFpbmVyLmNsaWVudFdpZHRoIC0gYm91bmRzLndpZHRoKSAvIDIpKTtcclxuICB9XHJcblxyXG4gIGluc2VydEJpbGxDZWxsKHBhcmVudCwgaWQsIGJpbGxEYXRhSW5mbzogQmlsbERhdGFJbmZvLCBiaWxsSW5mbzogRG93bkJpbGxJbmZvUmVzdWx0IHwgVXBCaWxsSW5mb1Jlc3VsdCwgZW50cnk6IGJvb2xlYW4sIHgsIHksIHdpZHRoLCBoZWlnaHQsIHN0eWxlPywgcmVsYXRpdmU/OiBib29sZWFuKTogQmlsbENlbGwge1xyXG4gICAgbGV0IGJpbGxDZWxsID0gdGhpcy5jcmVhdGVCaWxsQ2VsbChwYXJlbnQsIGlkLCBiaWxsRGF0YUluZm8sIGJpbGxJbmZvLCBlbnRyeSwgeCwgeSwgd2lkdGgsIGhlaWdodCwgc3R5bGUsIHJlbGF0aXZlKTtcclxuXHJcbiAgICByZXR1cm4gdGhpcy5hZGRDZWxsKGJpbGxDZWxsLCBwYXJlbnQpIGFzIEJpbGxDZWxsO1xyXG4gIH1cclxuXHJcbiAgY3JlYXRlQmlsbENlbGwocGFyZW50LCBpZCwgYmlsbERhdGFJbmZvOiBCaWxsRGF0YUluZm8sIGJpbGxJbmZvOiBEb3duQmlsbEluZm9SZXN1bHQgfCBVcEJpbGxJbmZvUmVzdWx0LCBlbnRyeTogYm9vbGVhbiwgeCwgeSwgd2lkdGgsIGhlaWdodCwgc3R5bGU/LCByZWxhdGl2ZT86IGJvb2xlYW4pOiBCaWxsQ2VsbCB7XHJcbiAgICBsZXQgZ2VvbWV0cnkgPSBuZXcgbXhHZW9tZXRyeSh4LCB5LCB3aWR0aCwgaGVpZ2h0KTtcclxuICAgIGdlb21ldHJ5LnJlbGF0aXZlID0gKHJlbGF0aXZlICE9IG51bGwpID8gcmVsYXRpdmUgOiBmYWxzZTtcclxuICAgIGxldCBiaWxsQ2VsbCA9IG5ldyBCaWxsQ2VsbChiaWxsRGF0YUluZm8sIGJpbGxJbmZvLCBlbnRyeSwgZ2VvbWV0cnksIHN0eWxlKTtcclxuICAgIGJpbGxDZWxsLnNldElkKGlkKTtcclxuICAgIGJpbGxDZWxsLnNldFZlcnRleCh0cnVlKTtcclxuICAgIGJpbGxDZWxsLnNldENvbm5lY3RhYmxlKHRydWUpO1xyXG5cclxuICAgIHJldHVybiBiaWxsQ2VsbDtcclxuICB9XHJcblxyXG4gIGdldFRvb2x0aXBGb3JDZWxsKGNlbGw6IE14R3JhcGhOUy5teENlbGwpOiBzdHJpbmcge1xyXG4gICAgaWYgKGNlbGwgaW5zdGFuY2VvZiBCaWxsQ2VsbCkge1xyXG4gICAgICByZXR1cm4gY2VsbC5idWlsZEh0bWxUb29sdGlwKCk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gc3VwZXIuZ2V0VG9vbHRpcEZvckNlbGwoY2VsbCk7XHJcbiAgfVxyXG5cclxuICBnZXRMYWJlbChjZWxsOiBNeEdyYXBoTlMubXhDZWxsKTogc3RyaW5nIHtcclxuICAgIGlmIChjZWxsIGluc3RhbmNlb2YgQmlsbENlbGwpIHtcclxuICAgICAgLy8gaWYgKHRoaXMubmV3QlRTKSB7XHJcbiAgICAgIHJldHVybiBzdXBlci5nZXRMYWJlbChjZWxsKTtcclxuICAgICAgLy8gfSBlbHNlIHtcclxuICAgICAgLy8gICAgIHJldHVybiBjZWxsLmdldENhcHRpb24oKTtcclxuICAgICAgLy8gfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIHN1cGVyLmdldExhYmVsKGNlbGwpO1xyXG4gIH1cclxuXHJcbiAgY29udmVydFZhbHVlVG9TdHJpbmcoY2VsbCkge1xyXG4gICAgaWYgKGNlbGwgaW5zdGFuY2VvZiBCaWxsQ2VsbCkge1xyXG4gICAgICByZXR1cm4gY2VsbC5idWlsZEh0bWxMYWJlbCh0aGlzKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHJldHVybiBzdXBlci5jb252ZXJ0VmFsdWVUb1N0cmluZyhjZWxsKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHByaXZhdGUgZGVmaW5lSW5uZXJTdHlsZXNOZXdCVFMoKSB7XHJcbiAgICAvL+WumuS5ieWNleaNruiKgueCueagt+W8j1xyXG4gICAgbGV0IHN0eWxlID0gT2JqZWN0LmFzc2lnbih7fSwgdGhpcy5nZXRTdHlsZXNoZWV0KCkuZ2V0RGVmYXVsdFZlcnRleFN0eWxlKCkpO1xyXG4gICAgc3R5bGVbbXhDb25zdGFudHMuU1RZTEVfRklMTENPTE9SXSA9ICdub25lJztcclxuICAgIHN0eWxlW214Q29uc3RhbnRzLlNUWUxFX1NUUk9LRV9PUEFDSVRZXSA9ICcwJztcclxuICAgIHN0eWxlW214Q29uc3RhbnRzLlNUWUxFX1NUUk9LRVdJRFRIXSA9ICcxJztcclxuICAgIHN0eWxlW214Q29uc3RhbnRzLlNUWUxFX0ZPTlRDT0xPUl0gPSAnYmxhY2snO1xyXG4gICAgc3R5bGVbbXhDb25zdGFudHMuU1RZTEVfRk9OVFNJWkVdID0gJzEyJztcclxuICAgIHN0eWxlW214Q29uc3RhbnRzLlNUWUxFX0ZPTlRTVFlMRV0gPSAnMSc7XHJcblxyXG4gICAgc3R5bGVbbXhDb25zdGFudHMuU1RZTEVfUk9VTkRFRF0gPSAnMSc7XHJcblxyXG4gICAgc3R5bGVbbXhDb25zdGFudHMuU1RZTEVfU1BBQ0lOR10gPSA4O1xyXG4gICAgc3R5bGVbbXhDb25zdGFudHMuU1RZTEVfV0hJVEVfU1BBQ0VdID0gJ3dyYXAnO1xyXG5cclxuICAgIC8vIOWbvueJh+aLieS8uFxyXG4gICAgc3R5bGVbbXhDb25zdGFudHMuU1RZTEVfSU1BR0VfQVNQRUNUXSA9ICcwJztcclxuXHJcbiAgICAvL+iKgueCueagh+etvuaYvuekuuS6juiKgueCueS4i+aWuVxyXG4gICAgc3R5bGVbbXhDb25zdGFudHMuU1RZTEVfUEVSSU1FVEVSXSA9IG14UGVyaW1ldGVyLlJlY3RhbmdsZVBlcmltZXRlcjtcclxuICAgIHN0eWxlW214Q29uc3RhbnRzLlNUWUxFX0FMSUdOXSA9IG14Q29uc3RhbnRzLkFMSUdOX0NFTlRFUjtcclxuICAgIHN0eWxlW214Q29uc3RhbnRzLlNUWUxFX1ZFUlRJQ0FMX0FMSUdOXSA9IG14Q29uc3RhbnRzLkFMSUdOX01JRERMRTtcclxuXHJcbiAgICB0aGlzLmdldFN0eWxlc2hlZXQoKS5wdXRDZWxsU3R5bGUoU3R5bGVzLlNUWUxFX0JJTExfTk9ERV9OQU1FLCBzdHlsZSk7XHJcblxyXG4gICAgLy/lrprkuYnlvIDlp4vmn6Xor6LoioLngrnmoLflvI9cclxuICAgIHN0eWxlID0gT2JqZWN0LmFzc2lnbih7fSwgc3R5bGUpO1xyXG4gICAgdGhpcy5nZXRTdHlsZXNoZWV0KCkucHV0Q2VsbFN0eWxlKFN0eWxlcy5TVFlMRV9CSUxMX05PREVfRU5UUllfTkFNRSwgc3R5bGUpO1xyXG5cclxuICAgIC8v5a6a5LmJ5Y2V5o2u5YWz6IGU6L+e57q/5qC35byPXHJcbiAgICBzdHlsZSA9IE9iamVjdC5hc3NpZ24oe30sIHRoaXMuZ2V0U3R5bGVzaGVldCgpLmdldERlZmF1bHRFZGdlU3R5bGUoKSk7XHJcbiAgICBzdHlsZVtteENvbnN0YW50cy5TVFlMRV9TSEFQRV0gPSBteENvbnN0YW50cy5TSEFQRV9DT05ORUNUT1I7XHJcbiAgICBzdHlsZVtteENvbnN0YW50cy5TVFlMRV9TVFJPS0VDT0xPUl0gPSAnIzJBODdGRic7XHJcbiAgICBzdHlsZVtteENvbnN0YW50cy5TVFlMRV9FTkRBUlJPV10gPSBteENvbnN0YW50cy5BUlJPV19DTEFTU0lDO1xyXG5cclxuICAgIHN0eWxlW214Q29uc3RhbnRzLlNUWUxFX1ZFUlRJQ0FMX0FMSUdOXSA9IG14Q29uc3RhbnRzLkFMSUdOX01JRERMRTtcclxuICAgIHN0eWxlW214Q29uc3RhbnRzLlNUWUxFX0FMSUdOXSA9IG14Q29uc3RhbnRzLkFMSUdOX0NFTlRFUjtcclxuICAgIHN0eWxlW214Q29uc3RhbnRzLlNUWUxFX0VER0VdID0gbXhDb25zdGFudHMuRURHRVNUWUxFX0VMQk9XO1xyXG4gICAgc3R5bGVbbXhDb25zdGFudHMuU1RZTEVfRUxCT1ddID0gbXhDb25zdGFudHMuRUxCT1dfSE9SSVpPTlRBTDtcclxuICAgIHN0eWxlW214Q29uc3RhbnRzLlNUWUxFX1NUUk9LRVdJRFRIXSA9IDEuODtcclxuICAgIHN0eWxlW214Q29uc3RhbnRzLlNUWUxFX0RBU0hFRF0gPSAxO1xyXG4gICAgc3R5bGVbbXhDb25zdGFudHMuU1RZTEVfT1BBQ0lUWV0gPSA4MDtcclxuICAgIHRoaXMuZ2V0U3R5bGVzaGVldCgpLnB1dENlbGxTdHlsZShTdHlsZXMuU1RZTEVfQklMTF9BU1NPQ0lBVElPTl9OQU1FLCBzdHlsZSk7XHJcbiAgfVxyXG5cclxuICBzZWxlY3RDZWxsRm9yRXZlbnQoY2VsbDogYW55LCBldnQ6IEV2ZW50KTogdm9pZCB7XHJcbiAgICBzdXBlci5zZWxlY3RDZWxsRm9yRXZlbnQoY2VsbCwgZXZ0KTtcclxuICB9XHJcblxyXG4gIGNyZWF0ZUNlbGxSZW5kZXJlcigpIHtcclxuICAgIGNvbnN0IHJlbmRlciA9IHN1cGVyLmNyZWF0ZUNlbGxSZW5kZXJlcigpO1xyXG5cclxuICAgIC8vIOmHjeWGmWxhYmVs5LqL5Lu25Yik5pat5pa55rOV77yM6Kej5Yaz54K55Ye76IqC54K55pON5L2c5oyJ6ZKu5pe25aaC5p6c5Ye6546wbG9hZGluZ+WImeaMiemSrua2iOWkseeahOmXrumimFxyXG4gICAgLy8gbm90Ze+8muatpOaUueWKqOS8muS9v+eCueWHu+iKgueCueaTjeS9nOaMiemSruaXtuS4jeinpuWPkeiKgueCuemAieS4reS6i+S7tlxyXG4gICAgLy8gbm90ZTog5q2k5pS55Yqo5ZCO77yM54K55Ye76IqC54K55pGY6KaB6LaF6ZO+5o6l55qE55uR5ZCs5Zmo5Lit5Li75Yqo6Kem5Y+R6YCJ5Lit5LqL5Lu2XHJcbiAgICBjb25zdCBvbGRJc0xhYmVsRXZlbnQgPSByZW5kZXIuaXNMYWJlbEV2ZW50O1xyXG4gICAgcmVuZGVyLmlzTGFiZWxFdmVudCA9IChzdGF0ZTogTXhHcmFwaE5TLm14Q2VsbFN0YXRlLCBldnQ6IEV2ZW50KSA9PiB7XHJcbiAgICAgIGlmIChzdGF0ZS5jZWxsIGluc3RhbmNlb2YgQmlsbENlbGwpIHtcclxuICAgICAgICBpZiAoZXZ0ICYmIGV2dC50YXJnZXRcclxuICAgICAgICAgICYmIChldnQudGFyZ2V0IGFzIEhUTUxFbGVtZW50KS5jbGFzc0xpc3RcclxuICAgICAgICAgICYmIChldnQudGFyZ2V0IGFzIEhUTUxFbGVtZW50KS5jbGFzc0xpc3QudmFsdWVcclxuICAgICAgICAgICYmIChcclxuICAgICAgICAgICAgKGV2dC50YXJnZXQgYXMgSFRNTEVsZW1lbnQpLmNsYXNzTGlzdC52YWx1ZS5pbmNsdWRlcyhcImJpZi1jZWxsLW5vZGUtdGl0bGUtbGluayBiaWYtY2VsbC1ub2RlLXRpdGxlLWxpbmstY29sb3JcIilcclxuICAgICAgICAgICAgfHwgKGV2dC50YXJnZXQgYXMgSFRNTEVsZW1lbnQpLmNsYXNzTGlzdC52YWx1ZS5pbmNsdWRlcyhcImJpZi1jZWxsLW5vZGUtYnRuXCIpXHJcbiAgICAgICAgICApXHJcbiAgICAgICAgKSB7XHJcbiAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHJldHVybiBvbGRJc0xhYmVsRXZlbnQuYXBwbHkocmVuZGVyLCBbc3RhdGUsIGV2dF0pO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgICByZXR1cm4gb2xkSXNMYWJlbEV2ZW50LmFwcGx5KHJlbmRlciwgW3N0YXRlLCBldnRdKTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gcmVuZGVyO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIHN0YXRpYyBjcmVhdGVTdmdJbWFnZSh3LCBoLCBkYXRhKSB7XHJcbiAgICB2YXIgdG1wID0gdW5lc2NhcGUoZW5jb2RlVVJJQ29tcG9uZW50KFxyXG4gICAgICAnPCFET0NUWVBFIHN2ZyBQVUJMSUMgXCItLy9XM0MvL0RURCBTVkcgMS4xLy9FTlwiIFwiaHR0cDovL3d3dy53My5vcmcvR3JhcGhpY3MvU1ZHLzEuMS9EVEQvc3ZnMTEuZHRkXCI+JyArXHJcbiAgICAgICc8c3ZnIHhtbG5zPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmdcIiB4bWxuczp4bGluaz1cImh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmtcIiB3aWR0aD1cIicgKyB3ICsgJ3B4XCIgaGVpZ2h0PVwiJyArIGggKyAncHhcIiAnICtcclxuICAgICAgJ3ZlcnNpb249XCIxLjFcIj4nICsgZGF0YSArICc8L3N2Zz4nKSk7XHJcblxyXG4gICAgcmV0dXJuIG5ldyBteEltYWdlKCdkYXRhOmltYWdlL3N2Zyt4bWw7YmFzZTY0LCcgKyAoKHdpbmRvdy5idG9hKSA/IGJ0b2EodG1wKSA6IEJhc2U2NC5lbmNvZGUodG1wLCB0cnVlKSksIHcsIGgpXHJcbiAgfVxyXG5cclxuICBkZXN0cm95KCk6IHZvaWQge1xyXG4gICAgc3VwZXIuZGVzdHJveSgpO1xyXG4gICAgdGhpcy5zZWxlY3RFdmVudEVtaXR0ZXIgPSBudWxsO1xyXG4gIH1cclxufVxyXG4iXX0=
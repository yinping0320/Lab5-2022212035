/**
 * @fileoverview added by tsickle
 * Generated from: lib/bill-tracker/mxgraph-ext/BillCell.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { mxCell, mxEvent, mxEventObject, mxUtils } from "../../ref/mxgraph";
import { BpmnModelJsonHelper } from "@edp-aif/common-api";
import { BillTrackingSettings, JointQueryMode } from '@edp-bif/common-api';
import { FieldNameAndValue } from "../../entity/tracking/FieldNameAndValue";
import { Events } from "./Events";
import { BillTrackerConstant } from "../config/bill-tracker-constant";
export class BillCell extends mxCell {
    /**
     * @param {?} billDataInfo
     * @param {?} billInfo
     * @param {?} entry
     * @param {?=} geometry
     * @param {?=} style
     */
    constructor(billDataInfo, billInfo, entry, geometry, style) {
        super(null, geometry, style);
        this.THUMB_SCALE = 0.6;
        this.billDataInfo = billDataInfo;
        this.billInfo = billInfo;
        /** @type {?} */
        let bts = new BillTrackingSettings();
        if (billInfo && billInfo.billTrackingSettings) {
            bts.LoadFromJson(billInfo.billTrackingSettings);
        }
        this.entry = entry;
        // this.value = this.billDataInfo.caption || bts.billNodeName || this.billInfo.voName || this.billDataInfo.dataId || this.billDataInfo.summary;
    }
    /**
     * @return {?}
     */
    getCaption() {
        /** @type {?} */
        let label = null;
        /** @type {?} */
        let bts = new BillTrackingSettings();
        if (this.billInfo && this.billInfo.billTrackingSettings) {
            bts.LoadFromJson(this.billInfo.billTrackingSettings);
        }
        label = this.billDataInfo.caption || bts.billNodeName || this.billInfo.voName || this.billDataInfo.dataId || this.billDataInfo.summary;
        return label;
    }
    /**
     * @return {?}
     */
    buildHtmlTooltip() {
        /** @type {?} */
        const tooltipHtml = `\
            <span>${this.billDataInfo.dataId}</span>\
        `;
        return tooltipHtml;
    }
    /**
     * 样式类在graph组件中定义
     * @param {?} graph
     * @return {?}
     */
    buildHtmlLabel(graph) {
        return this.buildHtmlLabelByDOM(graph);
    }
    /**
     * 通过操纵dom元素方式创建html
     * @private
     * @param {?} graph
     * @return {?}
     */
    buildHtmlLabelByDOM(graph) {
        /** @type {?} */
        const scale = graph.view.scale;
        /** @type {?} */
        const state = graph.view.getState(this);
        /** @type {?} */
        const width = this.geometry.width;
        /** @type {?} */
        const height = this.geometry.height;
        /** @type {?} */
        let bts = new BillTrackingSettings();
        if (this.billInfo && this.billInfo.billTrackingSettings) {
            bts.LoadFromJson(this.billInfo.billTrackingSettings);
        }
        /** @type {?} */
        const title = this.billDataInfo.caption || bts.billNodeName || this.billInfo.voName || this.billDataInfo.dataId || this.billDataInfo.summary;
        /** @type {?} */
        const isEntry = this.entry;
        // 节点框架
        /** @type {?} */
        const divNodeRoot = document.createElement("div");
        divNodeRoot.classList.add("bif-cell-node");
        divNodeRoot.style.width = width + "px";
        divNodeRoot.style.height = height + "px";
        if (isEntry) {
            // 当前节点标识
            /** @type {?} */
            const divNodeCurrent = document.createElement("div");
            divNodeRoot.appendChild(divNodeCurrent);
            divNodeCurrent.classList.add("bif-cell-node-current");
            /** @type {?} */
            const spanCurrent = document.createElement("span");
            divNodeCurrent.appendChild(spanCurrent);
            spanCurrent.classList.add("bif-cell-node-current-text");
            spanCurrent.innerHTML = graph && graph.localePipe && graph.localePipe.transform("currentNode") || "当前";
        }
        // 当比例小到指定值后仅显示单据名
        if (scale < this.THUMB_SCALE) {
            // // 使用图片+标题
            // const divNodeThumb = document.createElement("div");
            // divNodeRoot.appendChild(divNodeThumb);
            // divNodeThumb.classList.add("bif-cell-node-thumb");
            // const divNodeThumbImg = document.createElement("div");
            // divNodeThumb.appendChild(divNodeThumbImg);
            // divNodeThumbImg.classList.add("bif-cell-node-thumb-img-container");
            // const img = document.createElement("img");
            // divNodeThumbImg.appendChild(img);
            // img.classList.add("bif-cell-node-thumb-img");
            // img.src = "/platform/runtime/common/web/@edp-bif/runtime-api/images/non-entry-bill.png";
            // const divNodeThumbTitle = document.createElement("div");
            // divNodeThumb.appendChild(divNodeThumbTitle);
            // divNodeThumbTitle.classList.add("bif-cell-node-thumb-title");
            // const divNodeThumbTitleText = document.createElement("div");
            // divNodeThumbTitle.appendChild(divNodeThumbTitleText);
            // divNodeThumbTitleText.classList.add("bif-cell-node-thumb-title-text");
            // divNodeThumbTitleText.innerHTML = title;
            // // 判断是否需添加点击事件
            // const jqm = this.billInfo.jointQueryMode;
            // const jqp: JointQueryParameters = JSON.parse(this.billInfo.jointQueryParameters);
            // if ((jqm == JointQueryMode.APP && jqp.funcId) || (jqm == JointQueryMode.URL && jqp.url)) {
            //     divNodeThumbTitleText.classList.add("bif-cell-node-title-link");
            //     mxEvent.addListener(divNodeThumbTitleText, "click", () => {
            //         graph.fireEvent(new mxEventObject(Events.CLICK_FIRST_SUMMARY, "cell", this));
            //         event.stopPropagation();
            //         return false;
            //     });
            // }
            // 使用标题
            // 节点标题
            /** @type {?} */
            const divNodeTitleOnly = document.createElement("div");
            divNodeRoot.appendChild(divNodeTitleOnly);
            divNodeTitleOnly.classList.add("bif-cell-node-title-only");
            /** @type {?} */
            const divNodeTitleOnlyText = document.createElement("div");
            divNodeTitleOnly.appendChild(divNodeTitleOnlyText);
            divNodeTitleOnlyText.classList.add("bif-cell-node-title-only-text");
            divNodeTitleOnlyText.innerHTML = title;
            // 判断是否需添加点击事件
            /** @type {?} */
            const jqm = this.billInfo.jointQueryMode;
            /** @type {?} */
            const jqp = JSON.parse(this.billInfo.jointQueryParameters);
            if ((jqm == JointQueryMode.APP && jqp.funcId) || (jqm == JointQueryMode.URL && jqp.url)) {
                divNodeTitleOnlyText.classList.add("bif-cell-node-title-link");
                mxEvent.addListener(divNodeTitleOnlyText, "click", (/**
                 * @return {?}
                 */
                () => {
                    graph.fireEvent(new mxEventObject(Events.CLICK_FIRST_SUMMARY, "cell", this));
                    event.stopPropagation();
                    return false;
                }));
            }
        }
        else {
            // 节点主内容
            /** @type {?} */
            const divNodeMain = document.createElement("div");
            divNodeRoot.appendChild(divNodeMain);
            divNodeMain.classList.add("bif-cell-node-main");
            // 节点标题
            /** @type {?} */
            const divNodeTitle = document.createElement("div");
            divNodeMain.appendChild(divNodeTitle);
            divNodeTitle.classList.add("bif-cell-node-title");
            /** @type {?} */
            const divNodeTitleText = document.createElement("div");
            divNodeTitle.appendChild(divNodeTitleText);
            divNodeTitleText.classList.add("bif-cell-node-title-text");
            divNodeTitleText.innerHTML = title;
            divNodeTitleText.title = title;
            // 节点摘要
            /** @type {?} */
            const divNodeSummaryList = document.createElement("div");
            divNodeMain.appendChild(divNodeSummaryList);
            divNodeSummaryList.classList.add("bif-cell-node-summary-list");
            // 46是标题栏高度
            divNodeSummaryList.style.minHeight = (height - 46) + "px";
            try {
                /** @type {?} */
                const fieldNameAndValues = BpmnModelJsonHelper.FromJson(this.billDataInfo.summary, FieldNameAndValue);
                fieldNameAndValues && fieldNameAndValues.forEach((/**
                 * @param {?} fv
                 * @param {?} idx
                 * @return {?}
                 */
                (fv, idx) => {
                    /** @type {?} */
                    const divNodeSummary = document.createElement("div");
                    divNodeSummaryList.appendChild(divNodeSummary);
                    divNodeSummary.classList.add("bif-cell-node-summary");
                    /** @type {?} */
                    const divNodeSummaryCaption = document.createElement("div");
                    divNodeSummary.appendChild(divNodeSummaryCaption);
                    divNodeSummaryCaption.classList.add("bif-cell-node-summary-caption");
                    /** @type {?} */
                    const divNodeSummaryCaptionText = document.createElement("div");
                    divNodeSummaryCaption.appendChild(divNodeSummaryCaptionText);
                    divNodeSummaryCaptionText.classList.add("bif-cell-node-summary-caption-text");
                    divNodeSummaryCaptionText.title = fv.name;
                    divNodeSummaryCaptionText.innerHTML = fv.name;
                    /** @type {?} */
                    const divNodeSummaryValue = document.createElement("div");
                    divNodeSummary.appendChild(divNodeSummaryValue);
                    divNodeSummaryValue.classList.add("bif-cell-node-summary-value");
                    /** @type {?} */
                    const divNodeSummaryValueText = document.createElement("div");
                    divNodeSummaryValue.appendChild(divNodeSummaryValueText);
                    divNodeSummaryValueText.classList.add("bif-cell-node-summary-value-text");
                    divNodeSummaryValueText.title = fv.value;
                    divNodeSummaryValueText.innerText = fv.value;
                    if (idx == 0) {
                        // 判断是否需添加点击事件
                        /** @type {?} */
                        const jqm = this.billInfo.jointQueryMode;
                        /** @type {?} */
                        const jqp = JSON.parse(this.billInfo.jointQueryParameters);
                        if ((jqm == JointQueryMode.APP && jqp.funcId) || (jqm == JointQueryMode.URL && jqp.url)) {
                            divNodeSummaryValueText.classList.add("bif-cell-node-title-link", "bif-cell-node-title-link-color");
                            mxEvent.addListener(divNodeSummaryValueText, "click", (/**
                             * @return {?}
                             */
                            () => {
                                graph.fireEvent(new mxEventObject(Events.CLICK_FIRST_SUMMARY, "cell", this));
                                event.stopPropagation();
                                return false;
                            }));
                        }
                    }
                }));
            }
            catch (e) {
                console.error(e);
            }
            // 操作按钮
            /** @type {?} */
            const divNodeBtnGroup = document.createElement("div");
            divNodeMain.appendChild(divNodeBtnGroup);
            divNodeBtnGroup.classList.add("bif-cell-node-btn-group", "bif-cell-node-btn-group-control");
            // 详情按钮
            /** @type {?} */
            const imgView = document.createElement("img");
            divNodeBtnGroup.appendChild(imgView);
            imgView.src = BillTrackerConstant.IMAGE_PATH + "/view.svg";
            imgView.title = graph.localePipe.transform("viewBill");
            imgView.classList.add("bif-cell-node-btn");
            // 点击按钮触发选中事件
            imgView.addEventListener("click", (/**
             * @return {?}
             */
            () => {
                graph.setSelectionCell(this);
            }));
            // 不是当前节点时添加更多按钮
            if (isEntry == false) {
                // 更多按钮
                /** @type {?} */
                const imgMore = document.createElement("img");
                divNodeBtnGroup.appendChild(imgMore);
                imgMore.src = BillTrackerConstant.IMAGE_PATH + "/more.svg";
                imgMore.title = graph.localePipe.transform("more");
                imgMore.classList.add("bif-cell-node-btn");
                mxEvent.addListener(imgMore, mxEvent.CLICK, (/**
                 * @param {?} evt
                 * @return {?}
                 */
                (evt) => {
                    /** @type {?} */
                    const offset = mxUtils.getOffset(imgMore);
                    // 移除more hover效果
                    divNodeBtnGroup.classList.remove("bif-cell-node-btn-group-control");
                    // 重写隐藏菜单方法
                    /** @type {?} */
                    const hideMenu = graph.ngComp.morePopupMenu.hideMenu;
                    graph.ngComp.morePopupMenu.hideMenu = (/**
                     * @return {?}
                     */
                    function () {
                        hideMenu.apply(this, arguments);
                        // 重新添加hover效果
                        divNodeBtnGroup.classList.add("bif-cell-node-btn-group-control");
                    });
                    // 弹出菜单
                    graph.ngComp.morePopupMenu.popup(offset.x, offset.y + imgMore.offsetHeight, this, evt);
                    // 更新当前打开菜单对象
                    graph.ngComp.currentMenu = graph.ngComp.morePopupMenu;
                }));
            }
        }
        return divNodeRoot;
    }
    /**
     * 通过模板字符串方式创建html
     * @private
     * @param {?} graph
     * @return {?}
     */
    buildHtmlLabelByTemplateText(graph) {
        /** @type {?} */
        const state = graph.view.getState(this);
        /** @type {?} */
        const width = state && state.width ? state.width : this.geometry.width;
        /** @type {?} */
        const height = state && state.height ? state.height : this.geometry.height;
        /** @type {?} */
        let bts = new BillTrackingSettings();
        if (this.billInfo && this.billInfo.billTrackingSettings) {
            bts.LoadFromJson(this.billInfo.billTrackingSettings);
        }
        /** @type {?} */
        const title = this.billDataInfo.caption || bts.billNodeName || this.billInfo.voName || this.billDataInfo.dataId || this.billDataInfo.summary;
        /** @type {?} */
        const titleBackground = this.entry ? "rgba(86,160,255,0.08)" : "#FFFFFF";
        /** @type {?} */
        let summaryHtml = "";
        try {
            /** @type {?} */
            const fieldNameAndValues = BpmnModelJsonHelper.FromJson(this.billDataInfo.summary, FieldNameAndValue);
            fieldNameAndValues && fieldNameAndValues.forEach((/**
             * @param {?} fv
             * @param {?} idx
             * @return {?}
             */
            (fv, idx) => {
                /** @type {?} */
                let valueText = idx == 0 ? `<a href='javascript:void(0);'>${fv.value}</a>` : fv.value;
                summaryHtml += `\
                        <div class="bif-cell-node-summary">\
                            <div class="bif-cell-node-summary-caption">\
                                <div class="bif-cell-node-summary-caption-text" title="${fv.name}">${fv.name}</div>\
                            </div>\
                            <div class="bif-cell-node-summary-value">\
                                <div class="bif-cell-node-summary-value-text" title="${fv.value}">${valueText}</div>\
                            </div>\
                        </div>\
                    `;
            }));
        }
        catch (e) {
            console.error(e);
        }
        /** @type {?} */
        const html = `\
            <div class="bif-cell-node" style="width:${width}px;">\
                <div class="bif-cell-node-main" style="background: ${titleBackground};">\
                    <div class="bif-cell-node-title">\
                        <div class="bif-cell-node-title-text">${title}</div>\
                    </div>\
                    <div class="bif-cell-node-summary-list" style="min-height: ${height - 30}px;">\
                        ${summaryHtml}\
                    </div>\
                </div>\
            </div>\
        `;
        return html;
    }
}
if (false) {
    /** @type {?} */
    BillCell.prototype.THUMB_SCALE;
    /** @type {?} */
    BillCell.prototype.entry;
    /** @type {?} */
    BillCell.prototype.data;
    /** @type {?} */
    BillCell.prototype.billDataInfo;
    /** @type {?} */
    BillCell.prototype.billInfo;
    /** @type {?} */
    BillCell.prototype.downCellOverlay;
    /** @type {?} */
    BillCell.prototype.upCellOverlay;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQmlsbENlbGwuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZWRwLWJpZi9ydW50aW1lLWFwaS8iLCJzb3VyY2VzIjpbImxpYi9iaWxsLXRyYWNrZXIvbXhncmFwaC1leHQvQmlsbENlbGwudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQUUsTUFBTSxFQUFFLE9BQU8sRUFBRSxhQUFhLEVBQTBCLE9BQU8sRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBS3BHLE9BQU8sRUFBRSxtQkFBbUIsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQzFELE9BQU8sRUFBRSxvQkFBb0IsRUFBRSxjQUFjLEVBQXdCLE1BQU0scUJBQXFCLENBQUM7QUFFakcsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0seUNBQXlDLENBQUM7QUFFNUUsT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLFVBQVUsQ0FBQztBQUNsQyxPQUFPLEVBQUUsbUJBQW1CLEVBQUUsTUFBTSxpQ0FBaUMsQ0FBQztBQUV0RSxNQUFNLE9BQU8sUUFBUyxTQUFRLE1BQU07Ozs7Ozs7O0lBU2xDLFlBQVksWUFBMEIsRUFBRSxRQUErQyxFQUFFLEtBQWMsRUFBRSxRQUFTLEVBQUUsS0FBTTtRQUN4SCxLQUFLLENBQUMsSUFBSSxFQUFFLFFBQVEsRUFBRSxLQUFLLENBQUMsQ0FBQztRQVR0QixnQkFBVyxHQUFXLEdBQUcsQ0FBQztRQVdqQyxJQUFJLENBQUMsWUFBWSxHQUFHLFlBQVksQ0FBQztRQUNqQyxJQUFJLENBQUMsUUFBUSxHQUFHLFFBQVEsQ0FBQzs7WUFDckIsR0FBRyxHQUF5QixJQUFJLG9CQUFvQixFQUFFO1FBQzFELElBQUksUUFBUSxJQUFJLFFBQVEsQ0FBQyxvQkFBb0IsRUFBRTtZQUM3QyxHQUFHLENBQUMsWUFBWSxDQUFDLFFBQVEsQ0FBQyxvQkFBb0IsQ0FBQyxDQUFDO1NBQ2pEO1FBQ0QsSUFBSSxDQUFDLEtBQUssR0FBRyxLQUFLLENBQUM7UUFDbkIsK0lBQStJO0lBQ2pK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SztxRUFDVSxlQUFlOztnRUFFcEIsS0FBSzs7aUZBRVksTUFBTSxHQUFHLEVBQUU7MEJBQ2xFLFdBQVc7Ozs7U0FJNUI7UUFDTCxPQUFPLElBQUksQ0FBQztJQUNkLENBQUM7Q0FDRjs7O0lBclRDLCtCQUFtQzs7SUFFbkMseUJBQWU7O0lBQ2Ysd0JBQWU7O0lBQ2YsZ0NBQTJCOztJQUMzQiw0QkFBZ0Q7O0lBQ2hELG1DQUE2Qjs7SUFDN0IsaUNBQTJCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgbXhDZWxsLCBteEV2ZW50LCBteEV2ZW50T2JqZWN0LCBNeEdyYXBoTlMsIG14UG9wdXBNZW51LCBteFV0aWxzIH0gZnJvbSBcIi4uLy4uL3JlZi9teGdyYXBoXCI7XHJcbmltcG9ydCB7IEJpbGxEYXRhSW5mbyB9IGZyb20gJy4uLy4uL2VudGl0eS90cmFja2luZy9CaWxsRGF0YUluZm8nO1xyXG5pbXBvcnQgeyBEb3duQmlsbEluZm9SZXN1bHQgfSBmcm9tICcuLi9hcmdzL0Rvd25CaWxsSW5mb1Jlc3VsdCc7XHJcbmltcG9ydCB7IFVwQmlsbEluZm9SZXN1bHQgfSBmcm9tICcuLi9hcmdzL1VwQmlsbEluZm9SZXN1bHQnO1xyXG5pbXBvcnQgeyBDZWxsRGF0YSB9IGZyb20gJy4uLy4uL2VudGl0eS90cmFja2luZy9jZWxsLWRhdGEvQ2VsbERhdGEnO1xyXG5pbXBvcnQgeyBCcG1uTW9kZWxKc29uSGVscGVyIH0gZnJvbSBcIkBlZHAtYWlmL2NvbW1vbi1hcGlcIjtcclxuaW1wb3J0IHsgQmlsbFRyYWNraW5nU2V0dGluZ3MsIEpvaW50UXVlcnlNb2RlLCBKb2ludFF1ZXJ5UGFyYW1ldGVycyB9IGZyb20gJ0BlZHAtYmlmL2NvbW1vbi1hcGknO1xyXG5pbXBvcnQgeyBHcmFwaCB9IGZyb20gXCIuL0dyYXBoXCI7XHJcbmltcG9ydCB7IEZpZWxkTmFtZUFuZFZhbHVlIH0gZnJvbSBcIi4uLy4uL2VudGl0eS90cmFja2luZy9GaWVsZE5hbWVBbmRWYWx1ZVwiO1xyXG5pbXBvcnQgeyBDZWxsT3ZlcmxheSB9IGZyb20gXCIuL0NlbGxPdmVybGF5XCI7XHJcbmltcG9ydCB7IEV2ZW50cyB9IGZyb20gXCIuL0V2ZW50c1wiO1xyXG5pbXBvcnQgeyBCaWxsVHJhY2tlckNvbnN0YW50IH0gZnJvbSBcIi4uL2NvbmZpZy9iaWxsLXRyYWNrZXItY29uc3RhbnRcIjtcclxuXHJcbmV4cG9ydCBjbGFzcyBCaWxsQ2VsbCBleHRlbmRzIG14Q2VsbCB7XHJcbiAgcmVhZG9ubHkgVEhVTUJfU0NBTEU6IG51bWJlciA9IDAuNjtcclxuXHJcbiAgZW50cnk6IGJvb2xlYW47XHJcbiAgZGF0YTogQ2VsbERhdGE7XHJcbiAgYmlsbERhdGFJbmZvOiBCaWxsRGF0YUluZm87XHJcbiAgYmlsbEluZm86IERvd25CaWxsSW5mb1Jlc3VsdCB8IFVwQmlsbEluZm9SZXN1bHQ7XHJcbiAgZG93bkNlbGxPdmVybGF5OiBDZWxsT3ZlcmxheTtcclxuICB1cENlbGxPdmVybGF5OiBDZWxsT3ZlcmxheTtcclxuICBjb25zdHJ1Y3RvcihiaWxsRGF0YUluZm86IEJpbGxEYXRhSW5mbywgYmlsbEluZm86IERvd25CaWxsSW5mb1Jlc3VsdCB8IFVwQmlsbEluZm9SZXN1bHQsIGVudHJ5OiBib29sZWFuLCBnZW9tZXRyeT8sIHN0eWxlPykge1xyXG4gICAgc3VwZXIobnVsbCwgZ2VvbWV0cnksIHN0eWxlKTtcclxuXHJcbiAgICB0aGlzLmJpbGxEYXRhSW5mbyA9IGJpbGxEYXRhSW5mbztcclxuICAgIHRoaXMuYmlsbEluZm8gPSBiaWxsSW5mbztcclxuICAgIGxldCBidHM6IEJpbGxUcmFja2luZ1NldHRpbmdzID0gbmV3IEJpbGxUcmFja2luZ1NldHRpbmdzKCk7XHJcbiAgICBpZiAoYmlsbEluZm8gJiYgYmlsbEluZm8uYmlsbFRyYWNraW5nU2V0dGluZ3MpIHtcclxuICAgICAgYnRzLkxvYWRGcm9tSnNvbihiaWxsSW5mby5iaWxsVHJhY2tpbmdTZXR0aW5ncyk7XHJcbiAgICB9XHJcbiAgICB0aGlzLmVudHJ5ID0gZW50cnk7XHJcbiAgICAvLyB0aGlzLnZhbHVlID0gdGhpcy5iaWxsRGF0YUluZm8uY2FwdGlvbiB8fCBidHMuYmlsbE5vZGVOYW1lIHx8IHRoaXMuYmlsbEluZm8udm9OYW1lIHx8IHRoaXMuYmlsbERhdGFJbmZvLmRhdGFJZCB8fCB0aGlzLmJpbGxEYXRhSW5mby5zdW1tYXJ5O1xyXG4gIH1cclxuXHJcbiAgZ2V0Q2FwdGlvbigpIHtcclxuICAgIGxldCBsYWJlbDogc3RyaW5nID0gbnVsbDtcclxuICAgIGxldCBidHM6IEJpbGxUcmFja2luZ1NldHRpbmdzID0gbmV3IEJpbGxUcmFja2luZ1NldHRpbmdzKCk7XHJcbiAgICBpZiAodGhpcy5iaWxsSW5mbyAmJiB0aGlzLmJpbGxJbmZvLmJpbGxUcmFja2luZ1NldHRpbmdzKSB7XHJcbiAgICAgIGJ0cy5Mb2FkRnJvbUpzb24odGhpcy5iaWxsSW5mby5iaWxsVHJhY2tpbmdTZXR0aW5ncyk7XHJcbiAgICB9XHJcbiAgICBsYWJlbCA9IHRoaXMuYmlsbERhdGFJbmZvLmNhcHRpb24gfHwgYnRzLmJpbGxOb2RlTmFtZSB8fCB0aGlzLmJpbGxJbmZvLnZvTmFtZSB8fCB0aGlzLmJpbGxEYXRhSW5mby5kYXRhSWQgfHwgdGhpcy5iaWxsRGF0YUluZm8uc3VtbWFyeTtcclxuICAgIHJldHVybiBsYWJlbDtcclxuICB9XHJcblxyXG4gIGJ1aWxkSHRtbFRvb2x0aXAoKTogc3RyaW5nIHtcclxuICAgIGNvbnN0IHRvb2x0aXBIdG1sID0gYFxcXHJcbiAgICAgICAgICAgIDxzcGFuPiR7dGhpcy5iaWxsRGF0YUluZm8uZGF0YUlkfTwvc3Bhbj5cXFxyXG4gICAgICAgIGA7XHJcbiAgICByZXR1cm4gdG9vbHRpcEh0bWw7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDmoLflvI/nsbvlnKhncmFwaOe7hOS7tuS4reWumuS5iVxyXG4gICAqIEBwYXJhbSBncmFwaFxyXG4gICAqIEByZXR1cm5zXHJcbiAgICovXHJcbiAgYnVpbGRIdG1sTGFiZWwoZ3JhcGg6IEdyYXBoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5idWlsZEh0bWxMYWJlbEJ5RE9NKGdyYXBoKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOmAmui/h+aTjee6tWRvbeWFg+e0oOaWueW8j+WIm+W7umh0bWxcclxuICAgKiBAcGFyYW0gZ3JhcGhcclxuICAgKiBAcmV0dXJuc1xyXG4gICAqL1xyXG4gIHByaXZhdGUgYnVpbGRIdG1sTGFiZWxCeURPTShncmFwaDogR3JhcGgpIHtcclxuICAgIGNvbnN0IHNjYWxlID0gZ3JhcGgudmlldy5zY2FsZTtcclxuICAgIGNvbnN0IHN0YXRlID0gZ3JhcGgudmlldy5nZXRTdGF0ZSh0aGlzKTtcclxuICAgIGNvbnN0IHdpZHRoID0gdGhpcy5nZW9tZXRyeS53aWR0aDtcclxuICAgIGNvbnN0IGhlaWdodCA9IHRoaXMuZ2VvbWV0cnkuaGVpZ2h0O1xyXG4gICAgbGV0IGJ0czogQmlsbFRyYWNraW5nU2V0dGluZ3MgPSBuZXcgQmlsbFRyYWNraW5nU2V0dGluZ3MoKTtcclxuICAgIGlmICh0aGlzLmJpbGxJbmZvICYmIHRoaXMuYmlsbEluZm8uYmlsbFRyYWNraW5nU2V0dGluZ3MpIHtcclxuICAgICAgYnRzLkxvYWRGcm9tSnNvbih0aGlzLmJpbGxJbmZvLmJpbGxUcmFja2luZ1NldHRpbmdzKTtcclxuICAgIH1cclxuICAgIGNvbnN0IHRpdGxlID0gdGhpcy5iaWxsRGF0YUluZm8uY2FwdGlvbiB8fCBidHMuYmlsbE5vZGVOYW1lIHx8IHRoaXMuYmlsbEluZm8udm9OYW1lIHx8IHRoaXMuYmlsbERhdGFJbmZvLmRhdGFJZCB8fCB0aGlzLmJpbGxEYXRhSW5mby5zdW1tYXJ5O1xyXG4gICAgY29uc3QgaXNFbnRyeSA9IHRoaXMuZW50cnk7XHJcblxyXG4gICAgLy8g6IqC54K55qGG5p62XHJcbiAgICBjb25zdCBkaXZOb2RlUm9vdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICBkaXZOb2RlUm9vdC5jbGFzc0xpc3QuYWRkKFwiYmlmLWNlbGwtbm9kZVwiKTtcclxuICAgIGRpdk5vZGVSb290LnN0eWxlLndpZHRoID0gd2lkdGggKyBcInB4XCI7XHJcbiAgICBkaXZOb2RlUm9vdC5zdHlsZS5oZWlnaHQgPSBoZWlnaHQgKyBcInB4XCI7XHJcblxyXG4gICAgaWYgKGlzRW50cnkpIHtcclxuICAgICAgLy8g5b2T5YmN6IqC54K55qCH6K+GXHJcbiAgICAgIGNvbnN0IGRpdk5vZGVDdXJyZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcclxuICAgICAgZGl2Tm9kZVJvb3QuYXBwZW5kQ2hpbGQoZGl2Tm9kZUN1cnJlbnQpO1xyXG4gICAgICBkaXZOb2RlQ3VycmVudC5jbGFzc0xpc3QuYWRkKFwiYmlmLWNlbGwtbm9kZS1jdXJyZW50XCIpO1xyXG5cclxuICAgICAgY29uc3Qgc3BhbkN1cnJlbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic3BhblwiKTtcclxuICAgICAgZGl2Tm9kZUN1cnJlbnQuYXBwZW5kQ2hpbGQoc3BhbkN1cnJlbnQpO1xyXG4gICAgICBzcGFuQ3VycmVudC5jbGFzc0xpc3QuYWRkKFwiYmlmLWNlbGwtbm9kZS1jdXJyZW50LXRleHRcIik7XHJcbiAgICAgIHNwYW5DdXJyZW50LmlubmVySFRNTCA9IGdyYXBoICYmIGdyYXBoLmxvY2FsZVBpcGUgJiYgZ3JhcGgubG9jYWxlUGlwZS50cmFuc2Zvcm0oXCJjdXJyZW50Tm9kZVwiKSB8fCBcIuW9k+WJjVwiO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIOW9k+avlOS+i+Wwj+WIsOaMh+WumuWAvOWQjuS7heaYvuekuuWNleaNruWQjVxyXG4gICAgaWYgKHNjYWxlIDwgdGhpcy5USFVNQl9TQ0FMRSkge1xyXG4gICAgICAvLyAvLyDkvb/nlKjlm77niYcr5qCH6aKYXHJcbiAgICAgIC8vIGNvbnN0IGRpdk5vZGVUaHVtYiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICAgIC8vIGRpdk5vZGVSb290LmFwcGVuZENoaWxkKGRpdk5vZGVUaHVtYik7XHJcbiAgICAgIC8vIGRpdk5vZGVUaHVtYi5jbGFzc0xpc3QuYWRkKFwiYmlmLWNlbGwtbm9kZS10aHVtYlwiKTtcclxuXHJcbiAgICAgIC8vIGNvbnN0IGRpdk5vZGVUaHVtYkltZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICAgIC8vIGRpdk5vZGVUaHVtYi5hcHBlbmRDaGlsZChkaXZOb2RlVGh1bWJJbWcpO1xyXG4gICAgICAvLyBkaXZOb2RlVGh1bWJJbWcuY2xhc3NMaXN0LmFkZChcImJpZi1jZWxsLW5vZGUtdGh1bWItaW1nLWNvbnRhaW5lclwiKTtcclxuXHJcbiAgICAgIC8vIGNvbnN0IGltZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJpbWdcIik7XHJcbiAgICAgIC8vIGRpdk5vZGVUaHVtYkltZy5hcHBlbmRDaGlsZChpbWcpO1xyXG4gICAgICAvLyBpbWcuY2xhc3NMaXN0LmFkZChcImJpZi1jZWxsLW5vZGUtdGh1bWItaW1nXCIpO1xyXG4gICAgICAvLyBpbWcuc3JjID0gXCIvcGxhdGZvcm0vcnVudGltZS9jb21tb24vd2ViL0BlZHAtYmlmL3J1bnRpbWUtYXBpL2ltYWdlcy9ub24tZW50cnktYmlsbC5wbmdcIjtcclxuXHJcbiAgICAgIC8vIGNvbnN0IGRpdk5vZGVUaHVtYlRpdGxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcclxuICAgICAgLy8gZGl2Tm9kZVRodW1iLmFwcGVuZENoaWxkKGRpdk5vZGVUaHVtYlRpdGxlKTtcclxuICAgICAgLy8gZGl2Tm9kZVRodW1iVGl0bGUuY2xhc3NMaXN0LmFkZChcImJpZi1jZWxsLW5vZGUtdGh1bWItdGl0bGVcIik7XHJcblxyXG4gICAgICAvLyBjb25zdCBkaXZOb2RlVGh1bWJUaXRsZVRleHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xyXG4gICAgICAvLyBkaXZOb2RlVGh1bWJUaXRsZS5hcHBlbmRDaGlsZChkaXZOb2RlVGh1bWJUaXRsZVRleHQpO1xyXG4gICAgICAvLyBkaXZOb2RlVGh1bWJUaXRsZVRleHQuY2xhc3NMaXN0LmFkZChcImJpZi1jZWxsLW5vZGUtdGh1bWItdGl0bGUtdGV4dFwiKTtcclxuICAgICAgLy8gZGl2Tm9kZVRodW1iVGl0bGVUZXh0LmlubmVySFRNTCA9IHRpdGxlO1xyXG5cclxuICAgICAgLy8gLy8g5Yik5pat5piv5ZCm6ZyA5re75Yqg54K55Ye75LqL5Lu2XHJcbiAgICAgIC8vIGNvbnN0IGpxbSA9IHRoaXMuYmlsbEluZm8uam9pbnRRdWVyeU1vZGU7XHJcbiAgICAgIC8vIGNvbnN0IGpxcDogSm9pbnRRdWVyeVBhcmFtZXRlcnMgPSBKU09OLnBhcnNlKHRoaXMuYmlsbEluZm8uam9pbnRRdWVyeVBhcmFtZXRlcnMpO1xyXG4gICAgICAvLyBpZiAoKGpxbSA9PSBKb2ludFF1ZXJ5TW9kZS5BUFAgJiYganFwLmZ1bmNJZCkgfHwgKGpxbSA9PSBKb2ludFF1ZXJ5TW9kZS5VUkwgJiYganFwLnVybCkpIHtcclxuICAgICAgLy8gICAgIGRpdk5vZGVUaHVtYlRpdGxlVGV4dC5jbGFzc0xpc3QuYWRkKFwiYmlmLWNlbGwtbm9kZS10aXRsZS1saW5rXCIpO1xyXG4gICAgICAvLyAgICAgbXhFdmVudC5hZGRMaXN0ZW5lcihkaXZOb2RlVGh1bWJUaXRsZVRleHQsIFwiY2xpY2tcIiwgKCkgPT4ge1xyXG4gICAgICAvLyAgICAgICAgIGdyYXBoLmZpcmVFdmVudChuZXcgbXhFdmVudE9iamVjdChFdmVudHMuQ0xJQ0tfRklSU1RfU1VNTUFSWSwgXCJjZWxsXCIsIHRoaXMpKTtcclxuICAgICAgLy8gICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcclxuICAgICAgLy8gICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgIC8vICAgICB9KTtcclxuICAgICAgLy8gfVxyXG5cclxuICAgICAgLy8g5L2/55So5qCH6aKYXHJcbiAgICAgIC8vIOiKgueCueagh+mimFxyXG4gICAgICBjb25zdCBkaXZOb2RlVGl0bGVPbmx5ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcclxuICAgICAgZGl2Tm9kZVJvb3QuYXBwZW5kQ2hpbGQoZGl2Tm9kZVRpdGxlT25seSk7XHJcbiAgICAgIGRpdk5vZGVUaXRsZU9ubHkuY2xhc3NMaXN0LmFkZChcImJpZi1jZWxsLW5vZGUtdGl0bGUtb25seVwiKTtcclxuXHJcbiAgICAgIGNvbnN0IGRpdk5vZGVUaXRsZU9ubHlUZXh0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcclxuICAgICAgZGl2Tm9kZVRpdGxlT25seS5hcHBlbmRDaGlsZChkaXZOb2RlVGl0bGVPbmx5VGV4dCk7XHJcbiAgICAgIGRpdk5vZGVUaXRsZU9ubHlUZXh0LmNsYXNzTGlzdC5hZGQoXCJiaWYtY2VsbC1ub2RlLXRpdGxlLW9ubHktdGV4dFwiKTtcclxuICAgICAgZGl2Tm9kZVRpdGxlT25seVRleHQuaW5uZXJIVE1MID0gdGl0bGU7XHJcblxyXG4gICAgICAvLyDliKTmlq3mmK/lkKbpnIDmt7vliqDngrnlh7vkuovku7ZcclxuICAgICAgY29uc3QganFtID0gdGhpcy5iaWxsSW5mby5qb2ludFF1ZXJ5TW9kZTtcclxuICAgICAgY29uc3QganFwOiBKb2ludFF1ZXJ5UGFyYW1ldGVycyA9IEpTT04ucGFyc2UodGhpcy5iaWxsSW5mby5qb2ludFF1ZXJ5UGFyYW1ldGVycyk7XHJcbiAgICAgIGlmICgoanFtID09IEpvaW50UXVlcnlNb2RlLkFQUCAmJiBqcXAuZnVuY0lkKSB8fCAoanFtID09IEpvaW50UXVlcnlNb2RlLlVSTCAmJiBqcXAudXJsKSkge1xyXG4gICAgICAgIGRpdk5vZGVUaXRsZU9ubHlUZXh0LmNsYXNzTGlzdC5hZGQoXCJiaWYtY2VsbC1ub2RlLXRpdGxlLWxpbmtcIik7XHJcbiAgICAgICAgbXhFdmVudC5hZGRMaXN0ZW5lcihkaXZOb2RlVGl0bGVPbmx5VGV4dCwgXCJjbGlja1wiLCAoKSA9PiB7XHJcbiAgICAgICAgICBncmFwaC5maXJlRXZlbnQobmV3IG14RXZlbnRPYmplY3QoRXZlbnRzLkNMSUNLX0ZJUlNUX1NVTU1BUlksIFwiY2VsbFwiLCB0aGlzKSk7XHJcbiAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcclxuICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9KTtcclxuICAgICAgfVxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgLy8g6IqC54K55Li75YaF5a65XHJcbiAgICAgIGNvbnN0IGRpdk5vZGVNYWluID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcclxuICAgICAgZGl2Tm9kZVJvb3QuYXBwZW5kQ2hpbGQoZGl2Tm9kZU1haW4pO1xyXG4gICAgICBkaXZOb2RlTWFpbi5jbGFzc0xpc3QuYWRkKFwiYmlmLWNlbGwtbm9kZS1tYWluXCIpO1xyXG5cclxuICAgICAgLy8g6IqC54K55qCH6aKYXHJcbiAgICAgIGNvbnN0IGRpdk5vZGVUaXRsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICAgIGRpdk5vZGVNYWluLmFwcGVuZENoaWxkKGRpdk5vZGVUaXRsZSk7XHJcbiAgICAgIGRpdk5vZGVUaXRsZS5jbGFzc0xpc3QuYWRkKFwiYmlmLWNlbGwtbm9kZS10aXRsZVwiKTtcclxuXHJcbiAgICAgIGNvbnN0IGRpdk5vZGVUaXRsZVRleHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xyXG4gICAgICBkaXZOb2RlVGl0bGUuYXBwZW5kQ2hpbGQoZGl2Tm9kZVRpdGxlVGV4dCk7XHJcbiAgICAgIGRpdk5vZGVUaXRsZVRleHQuY2xhc3NMaXN0LmFkZChcImJpZi1jZWxsLW5vZGUtdGl0bGUtdGV4dFwiKTtcclxuICAgICAgZGl2Tm9kZVRpdGxlVGV4dC5pbm5lckhUTUwgPSB0aXRsZTtcclxuICAgICAgZGl2Tm9kZVRpdGxlVGV4dC50aXRsZSA9IHRpdGxlO1xyXG5cclxuICAgICAgLy8g6IqC54K55pGY6KaBXHJcbiAgICAgIGNvbnN0IGRpdk5vZGVTdW1tYXJ5TGlzdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICAgIGRpdk5vZGVNYWluLmFwcGVuZENoaWxkKGRpdk5vZGVTdW1tYXJ5TGlzdCk7XHJcbiAgICAgIGRpdk5vZGVTdW1tYXJ5TGlzdC5jbGFzc0xpc3QuYWRkKFwiYmlmLWNlbGwtbm9kZS1zdW1tYXJ5LWxpc3RcIik7XHJcbiAgICAgIC8vIDQ25piv5qCH6aKY5qCP6auY5bqmXHJcbiAgICAgIGRpdk5vZGVTdW1tYXJ5TGlzdC5zdHlsZS5taW5IZWlnaHQgPSAoaGVpZ2h0IC0gNDYpICsgXCJweFwiO1xyXG5cclxuICAgICAgdHJ5IHtcclxuICAgICAgICBjb25zdCBmaWVsZE5hbWVBbmRWYWx1ZXM6IEZpZWxkTmFtZUFuZFZhbHVlW10gPSBCcG1uTW9kZWxKc29uSGVscGVyLkZyb21Kc29uKHRoaXMuYmlsbERhdGFJbmZvLnN1bW1hcnksIEZpZWxkTmFtZUFuZFZhbHVlKTtcclxuICAgICAgICBmaWVsZE5hbWVBbmRWYWx1ZXMgJiYgZmllbGROYW1lQW5kVmFsdWVzLmZvckVhY2goXHJcbiAgICAgICAgICAoZnYsIGlkeCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBkaXZOb2RlU3VtbWFyeSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICAgICAgICAgIGRpdk5vZGVTdW1tYXJ5TGlzdC5hcHBlbmRDaGlsZChkaXZOb2RlU3VtbWFyeSk7XHJcbiAgICAgICAgICAgIGRpdk5vZGVTdW1tYXJ5LmNsYXNzTGlzdC5hZGQoXCJiaWYtY2VsbC1ub2RlLXN1bW1hcnlcIik7XHJcblxyXG4gICAgICAgICAgICBjb25zdCBkaXZOb2RlU3VtbWFyeUNhcHRpb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xyXG4gICAgICAgICAgICBkaXZOb2RlU3VtbWFyeS5hcHBlbmRDaGlsZChkaXZOb2RlU3VtbWFyeUNhcHRpb24pO1xyXG4gICAgICAgICAgICBkaXZOb2RlU3VtbWFyeUNhcHRpb24uY2xhc3NMaXN0LmFkZChcImJpZi1jZWxsLW5vZGUtc3VtbWFyeS1jYXB0aW9uXCIpO1xyXG5cclxuICAgICAgICAgICAgY29uc3QgZGl2Tm9kZVN1bW1hcnlDYXB0aW9uVGV4dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICAgICAgICAgIGRpdk5vZGVTdW1tYXJ5Q2FwdGlvbi5hcHBlbmRDaGlsZChkaXZOb2RlU3VtbWFyeUNhcHRpb25UZXh0KTtcclxuICAgICAgICAgICAgZGl2Tm9kZVN1bW1hcnlDYXB0aW9uVGV4dC5jbGFzc0xpc3QuYWRkKFwiYmlmLWNlbGwtbm9kZS1zdW1tYXJ5LWNhcHRpb24tdGV4dFwiKTtcclxuICAgICAgICAgICAgZGl2Tm9kZVN1bW1hcnlDYXB0aW9uVGV4dC50aXRsZSA9IGZ2Lm5hbWU7XHJcbiAgICAgICAgICAgIGRpdk5vZGVTdW1tYXJ5Q2FwdGlvblRleHQuaW5uZXJIVE1MID0gZnYubmFtZTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IGRpdk5vZGVTdW1tYXJ5VmFsdWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xyXG4gICAgICAgICAgICBkaXZOb2RlU3VtbWFyeS5hcHBlbmRDaGlsZChkaXZOb2RlU3VtbWFyeVZhbHVlKTtcclxuICAgICAgICAgICAgZGl2Tm9kZVN1bW1hcnlWYWx1ZS5jbGFzc0xpc3QuYWRkKFwiYmlmLWNlbGwtbm9kZS1zdW1tYXJ5LXZhbHVlXCIpO1xyXG5cclxuICAgICAgICAgICAgY29uc3QgZGl2Tm9kZVN1bW1hcnlWYWx1ZVRleHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xyXG4gICAgICAgICAgICBkaXZOb2RlU3VtbWFyeVZhbHVlLmFwcGVuZENoaWxkKGRpdk5vZGVTdW1tYXJ5VmFsdWVUZXh0KTtcclxuICAgICAgICAgICAgZGl2Tm9kZVN1bW1hcnlWYWx1ZVRleHQuY2xhc3NMaXN0LmFkZChcImJpZi1jZWxsLW5vZGUtc3VtbWFyeS12YWx1ZS10ZXh0XCIpO1xyXG4gICAgICAgICAgICBkaXZOb2RlU3VtbWFyeVZhbHVlVGV4dC50aXRsZSA9IGZ2LnZhbHVlO1xyXG4gICAgICAgICAgICBkaXZOb2RlU3VtbWFyeVZhbHVlVGV4dC5pbm5lclRleHQgPSBmdi52YWx1ZTtcclxuXHJcbiAgICAgICAgICAgIGlmIChpZHggPT0gMCkge1xyXG4gICAgICAgICAgICAgIC8vIOWIpOaWreaYr+WQpumcgOa3u+WKoOeCueWHu+S6i+S7tlxyXG4gICAgICAgICAgICAgIGNvbnN0IGpxbSA9IHRoaXMuYmlsbEluZm8uam9pbnRRdWVyeU1vZGU7XHJcbiAgICAgICAgICAgICAgY29uc3QganFwOiBKb2ludFF1ZXJ5UGFyYW1ldGVycyA9IEpTT04ucGFyc2UodGhpcy5iaWxsSW5mby5qb2ludFF1ZXJ5UGFyYW1ldGVycyk7XHJcbiAgICAgICAgICAgICAgaWYgKChqcW0gPT0gSm9pbnRRdWVyeU1vZGUuQVBQICYmIGpxcC5mdW5jSWQpIHx8IChqcW0gPT0gSm9pbnRRdWVyeU1vZGUuVVJMICYmIGpxcC51cmwpKSB7XHJcbiAgICAgICAgICAgICAgICBkaXZOb2RlU3VtbWFyeVZhbHVlVGV4dC5jbGFzc0xpc3QuYWRkKFwiYmlmLWNlbGwtbm9kZS10aXRsZS1saW5rXCIsIFwiYmlmLWNlbGwtbm9kZS10aXRsZS1saW5rLWNvbG9yXCIpO1xyXG4gICAgICAgICAgICAgICAgbXhFdmVudC5hZGRMaXN0ZW5lcihkaXZOb2RlU3VtbWFyeVZhbHVlVGV4dCwgXCJjbGlja1wiLCAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgIGdyYXBoLmZpcmVFdmVudChuZXcgbXhFdmVudE9iamVjdChFdmVudHMuQ0xJQ0tfRklSU1RfU1VNTUFSWSwgXCJjZWxsXCIsIHRoaXMpKTtcclxuICAgICAgICAgICAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgICk7XHJcbiAgICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKGUpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyDmk43kvZzmjInpkq5cclxuICAgICAgY29uc3QgZGl2Tm9kZUJ0bkdyb3VwID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcclxuICAgICAgZGl2Tm9kZU1haW4uYXBwZW5kQ2hpbGQoZGl2Tm9kZUJ0bkdyb3VwKTtcclxuICAgICAgZGl2Tm9kZUJ0bkdyb3VwLmNsYXNzTGlzdC5hZGQoXCJiaWYtY2VsbC1ub2RlLWJ0bi1ncm91cFwiLCBcImJpZi1jZWxsLW5vZGUtYnRuLWdyb3VwLWNvbnRyb2xcIik7XHJcblxyXG4gICAgICAvLyDor6bmg4XmjInpkq5cclxuICAgICAgY29uc3QgaW1nVmlldyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJpbWdcIik7XHJcbiAgICAgIGRpdk5vZGVCdG5Hcm91cC5hcHBlbmRDaGlsZChpbWdWaWV3KTtcclxuICAgICAgaW1nVmlldy5zcmMgPSBCaWxsVHJhY2tlckNvbnN0YW50LklNQUdFX1BBVEggKyBcIi92aWV3LnN2Z1wiO1xyXG4gICAgICBpbWdWaWV3LnRpdGxlID0gZ3JhcGgubG9jYWxlUGlwZS50cmFuc2Zvcm0oXCJ2aWV3QmlsbFwiKTtcclxuICAgICAgaW1nVmlldy5jbGFzc0xpc3QuYWRkKFwiYmlmLWNlbGwtbm9kZS1idG5cIik7XHJcbiAgICAgIC8vIOeCueWHu+aMiemSruinpuWPkemAieS4reS6i+S7tlxyXG4gICAgICBpbWdWaWV3LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XHJcbiAgICAgICAgZ3JhcGguc2V0U2VsZWN0aW9uQ2VsbCh0aGlzKTtcclxuICAgICAgfSk7XHJcblxyXG4gICAgICAvLyDkuI3mmK/lvZPliY3oioLngrnml7bmt7vliqDmm7TlpJrmjInpkq5cclxuICAgICAgaWYgKGlzRW50cnkgPT0gZmFsc2UpIHtcclxuICAgICAgICAvLyDmm7TlpJrmjInpkq5cclxuICAgICAgICBjb25zdCBpbWdNb3JlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImltZ1wiKTtcclxuICAgICAgICBkaXZOb2RlQnRuR3JvdXAuYXBwZW5kQ2hpbGQoaW1nTW9yZSk7XHJcbiAgICAgICAgaW1nTW9yZS5zcmMgPSBCaWxsVHJhY2tlckNvbnN0YW50LklNQUdFX1BBVEggKyBcIi9tb3JlLnN2Z1wiO1xyXG4gICAgICAgIGltZ01vcmUudGl0bGUgPSBncmFwaC5sb2NhbGVQaXBlLnRyYW5zZm9ybShcIm1vcmVcIik7XHJcbiAgICAgICAgaW1nTW9yZS5jbGFzc0xpc3QuYWRkKFwiYmlmLWNlbGwtbm9kZS1idG5cIik7XHJcblxyXG4gICAgICAgIG14RXZlbnQuYWRkTGlzdGVuZXIoaW1nTW9yZSwgbXhFdmVudC5DTElDSywgKGV2dDogUG9pbnRlckV2ZW50KSA9PiB7XHJcbiAgICAgICAgICBjb25zdCBvZmZzZXQgPSBteFV0aWxzLmdldE9mZnNldChpbWdNb3JlKTtcclxuICAgICAgICAgIC8vIOenu+mZpG1vcmUgaG92ZXLmlYjmnpxcclxuICAgICAgICAgIGRpdk5vZGVCdG5Hcm91cC5jbGFzc0xpc3QucmVtb3ZlKFwiYmlmLWNlbGwtbm9kZS1idG4tZ3JvdXAtY29udHJvbFwiKTtcclxuICAgICAgICAgIC8vIOmHjeWGmemakOiXj+iPnOWNleaWueazlVxyXG4gICAgICAgICAgY29uc3QgaGlkZU1lbnUgPSBncmFwaC5uZ0NvbXAubW9yZVBvcHVwTWVudS5oaWRlTWVudTtcclxuICAgICAgICAgIGdyYXBoLm5nQ29tcC5tb3JlUG9wdXBNZW51LmhpZGVNZW51ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBoaWRlTWVudS5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xyXG4gICAgICAgICAgICAvLyDph43mlrDmt7vliqBob3ZlcuaViOaenFxyXG4gICAgICAgICAgICBkaXZOb2RlQnRuR3JvdXAuY2xhc3NMaXN0LmFkZChcImJpZi1jZWxsLW5vZGUtYnRuLWdyb3VwLWNvbnRyb2xcIik7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICAvLyDlvLnlh7roj5zljZVcclxuICAgICAgICAgIGdyYXBoLm5nQ29tcC5tb3JlUG9wdXBNZW51LnBvcHVwKG9mZnNldC54LCBvZmZzZXQueSArIGltZ01vcmUub2Zmc2V0SGVpZ2h0LCB0aGlzLCBldnQpO1xyXG4gICAgICAgICAgLy8g5pu05paw5b2T5YmN5omT5byA6I+c5Y2V5a+56LGhXHJcbiAgICAgICAgICBncmFwaC5uZ0NvbXAuY3VycmVudE1lbnUgPSBncmFwaC5uZ0NvbXAubW9yZVBvcHVwTWVudTtcclxuICAgICAgICB9KTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIGRpdk5vZGVSb290O1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog6YCa6L+H5qih5p2/5a2X56ym5Liy5pa55byP5Yib5bu6aHRtbFxyXG4gICAqIEBwYXJhbSBncmFwaFxyXG4gICAqIEByZXR1cm5zXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBidWlsZEh0bWxMYWJlbEJ5VGVtcGxhdGVUZXh0KGdyYXBoOiBHcmFwaCkge1xyXG4gICAgY29uc3Qgc3RhdGUgPSBncmFwaC52aWV3LmdldFN0YXRlKHRoaXMpO1xyXG4gICAgY29uc3Qgd2lkdGggPSBzdGF0ZSAmJiBzdGF0ZS53aWR0aCA/IHN0YXRlLndpZHRoIDogdGhpcy5nZW9tZXRyeS53aWR0aDtcclxuICAgIGNvbnN0IGhlaWdodCA9IHN0YXRlICYmIHN0YXRlLmhlaWdodCA/IHN0YXRlLmhlaWdodCA6IHRoaXMuZ2VvbWV0cnkuaGVpZ2h0O1xyXG4gICAgbGV0IGJ0czogQmlsbFRyYWNraW5nU2V0dGluZ3MgPSBuZXcgQmlsbFRyYWNraW5nU2V0dGluZ3MoKTtcclxuICAgIGlmICh0aGlzLmJpbGxJbmZvICYmIHRoaXMuYmlsbEluZm8uYmlsbFRyYWNraW5nU2V0dGluZ3MpIHtcclxuICAgICAgYnRzLkxvYWRGcm9tSnNvbih0aGlzLmJpbGxJbmZvLmJpbGxUcmFja2luZ1NldHRpbmdzKTtcclxuICAgIH1cclxuICAgIGNvbnN0IHRpdGxlID0gdGhpcy5iaWxsRGF0YUluZm8uY2FwdGlvbiB8fCBidHMuYmlsbE5vZGVOYW1lIHx8IHRoaXMuYmlsbEluZm8udm9OYW1lIHx8IHRoaXMuYmlsbERhdGFJbmZvLmRhdGFJZCB8fCB0aGlzLmJpbGxEYXRhSW5mby5zdW1tYXJ5O1xyXG4gICAgY29uc3QgdGl0bGVCYWNrZ3JvdW5kID0gdGhpcy5lbnRyeSA/IFwicmdiYSg4NiwxNjAsMjU1LDAuMDgpXCIgOiBcIiNGRkZGRkZcIjtcclxuXHJcbiAgICBsZXQgc3VtbWFyeUh0bWwgPSBcIlwiO1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgZmllbGROYW1lQW5kVmFsdWVzOiBGaWVsZE5hbWVBbmRWYWx1ZVtdID0gQnBtbk1vZGVsSnNvbkhlbHBlci5Gcm9tSnNvbih0aGlzLmJpbGxEYXRhSW5mby5zdW1tYXJ5LCBGaWVsZE5hbWVBbmRWYWx1ZSk7XHJcbiAgICAgIGZpZWxkTmFtZUFuZFZhbHVlcyAmJiBmaWVsZE5hbWVBbmRWYWx1ZXMuZm9yRWFjaChcclxuICAgICAgICAoZnYsIGlkeCkgPT4ge1xyXG4gICAgICAgICAgbGV0IHZhbHVlVGV4dCA9IGlkeCA9PSAwID8gYDxhIGhyZWY9J2phdmFzY3JpcHQ6dm9pZCgwKTsnPiR7ZnYudmFsdWV9PC9hPmAgOiBmdi52YWx1ZTtcclxuICAgICAgICAgIHN1bW1hcnlIdG1sICs9IGBcXFxyXG4gICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwiYmlmLWNlbGwtbm9kZS1zdW1tYXJ5XCI+XFxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJiaWYtY2VsbC1ub2RlLXN1bW1hcnktY2FwdGlvblwiPlxcXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cImJpZi1jZWxsLW5vZGUtc3VtbWFyeS1jYXB0aW9uLXRleHRcIiB0aXRsZT1cIiR7ZnYubmFtZX1cIj4ke2Z2Lm5hbWV9PC9kaXY+XFxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PlxcXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwiYmlmLWNlbGwtbm9kZS1zdW1tYXJ5LXZhbHVlXCI+XFxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwiYmlmLWNlbGwtbm9kZS1zdW1tYXJ5LXZhbHVlLXRleHRcIiB0aXRsZT1cIiR7ZnYudmFsdWV9XCI+JHt2YWx1ZVRleHR9PC9kaXY+XFxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PlxcXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PlxcXHJcbiAgICAgICAgICAgICAgICAgICAgYDtcclxuICAgICAgICB9XHJcbiAgICAgICk7XHJcbiAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoZSk7XHJcbiAgICB9XHJcbiAgICBjb25zdCBodG1sID0gYFxcXHJcbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJiaWYtY2VsbC1ub2RlXCIgc3R5bGU9XCJ3aWR0aDoke3dpZHRofXB4O1wiPlxcXHJcbiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwiYmlmLWNlbGwtbm9kZS1tYWluXCIgc3R5bGU9XCJiYWNrZ3JvdW5kOiAke3RpdGxlQmFja2dyb3VuZH07XCI+XFxcclxuICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwiYmlmLWNlbGwtbm9kZS10aXRsZVwiPlxcXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJiaWYtY2VsbC1ub2RlLXRpdGxlLXRleHRcIj4ke3RpdGxlfTwvZGl2PlxcXHJcbiAgICAgICAgICAgICAgICAgICAgPC9kaXY+XFxcclxuICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwiYmlmLWNlbGwtbm9kZS1zdW1tYXJ5LWxpc3RcIiBzdHlsZT1cIm1pbi1oZWlnaHQ6ICR7aGVpZ2h0IC0gMzB9cHg7XCI+XFxcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHtzdW1tYXJ5SHRtbH1cXFxyXG4gICAgICAgICAgICAgICAgICAgIDwvZGl2PlxcXHJcbiAgICAgICAgICAgICAgICA8L2Rpdj5cXFxyXG4gICAgICAgICAgICA8L2Rpdj5cXFxyXG4gICAgICAgIGA7XHJcbiAgICByZXR1cm4gaHRtbDtcclxuICB9XHJcbn1cclxuIl19
/**
 * @fileoverview added by tsickle
 * Generated from: lib/bill-tracker/services/bill-tracker-data-info.service.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Injectable } from "@angular/core";
import { BpmnModelJsonHelper, DataType } from "@edp-aif/common-api";
import { BillTrackingDataShownMode, BillTrackingSettings, fullPathPrefix } from "@edp-bif/common-api";
import { Exceptions } from "../../entity/tracking/Exceptions";
export class BillTrackerDataInfoService {
    /**
     * 判断BillTrackingSettings是旧版还是新版
     * @param {?} bts
     * @return {?}
     */
    isNewBTS(bts) {
        if (typeof bts == "string") {
            /** @type {?} */
            const temp = new BillTrackingSettings();
            temp.LoadFromJson(bts);
            bts = temp;
        }
        return bts != null && bts.version === "1.0";
    }
    /**
     * @param {?} rows
     * @param {?} shownFields
     * @param {?} wholeFields
     * @param {?} idField
     * @return {?}
     */
    extractDataRows(rows, shownFields, wholeFields, idField) {
        /** @type {?} */
        let frows = [];
        for (let row of rows) {
            /** @type {?} */
            let obj = {};
            obj[idField] = row.dataId;
            // 先解析其他类型字段
            /** @type {?} */
            const decimalFFs = [];
            shownFields.forEach((/**
             * @param {?} f
             * @return {?}
             */
            f => {
                if (f.dataType == DataType.Decimal) {
                    decimalFFs.push(f);
                }
                else {
                    obj[f.fieldPath] = this.getFieldValue(f, row.GetFieldMap(), wholeFields);
                }
            }));
            // 再解析浮点型字段
            decimalFFs.forEach((/**
             * @param {?} f
             * @return {?}
             */
            f => {
                obj[f.fieldPath] = this.getFieldValue(f, row.GetFieldMap(), wholeFields);
            }));
            frows.push(obj);
        }
        return frows;
    }
    /**
     * @param {?} field
     * @return {?}
     */
    extractCaptionPath(field) {
        /** @type {?} */
        let s = field.caption;
        /** @type {?} */
        let tmp = (/** @type {?} */ (field));
        while (tmp.attachedField != null) {
            s = tmp.attachedField.caption + "." + s;
            tmp = (/** @type {?} */ (tmp.attachedField));
        }
        return s;
    }
    /**
     * @param {?} field
     * @return {?}
     */
    extractFieldPath(field) {
        /** @type {?} */
        let s = field.fieldName;
        /** @type {?} */
        let tmp = (/** @type {?} */ (field));
        while (tmp.attachedField != null) {
            s = tmp.attachedField.fieldName + "." + s;
            tmp = (/** @type {?} */ (tmp.attachedField));
        }
        return s;
    }
    /**
     *
     * @param {?} fields 子字段列表
     * @param {?} selectedFields 用户自定义展示字段列表
     * @param {?} showCustomFields 是否按用户自定义字段显示
     * @return {?}
     */
    extractFFields(fields, selectedFields, showCustomFields) {
        /** @type {?} */
        let ffields = [];
        fields.forEach((/**
         * @param {?} f
         * @return {?}
         */
        f => {
            f.show = true;
            //枚举或者枚举型单值UDT时默认取Name
            if (f.fieldType == "Enum" || f.fieldType == "EnumSingleUdt") {
                /** @type {?} */
                const tempFPath = this.extractFieldPath(f);
                /** @type {?} */
                let sf = null;
                if (showCustomFields) {
                    // 如果字段不在已配置字段列表中则跳过
                    sf = selectedFields.find((/**
                     * @param {?} sfield
                     * @return {?}
                     */
                    (sfield) => sfield.fieldPath == tempFPath));
                    if (sf == null) {
                        f.show = false;
                    }
                }
                f = (/** @type {?} */ (this.setExtendProps(f, sf, tempFPath + ".Name")));
                ffields.push(f);
            }
            else if (f.GetSubFieldList() != null && f.GetSubFieldList().length > 0) {
                ffields.push(...this.extractFFields(f.GetSubFieldList(), selectedFields, showCustomFields));
            }
            else {
                /** @type {?} */
                const tempFPath = this.extractFieldPath(f);
                /** @type {?} */
                let sf = null;
                if (showCustomFields) {
                    // 如果字段不在已配置字段列表中则跳过
                    sf = selectedFields.find((/**
                     * @param {?} sfield
                     * @return {?}
                     */
                    (sfield) => sfield.fieldPath == tempFPath));
                    if (sf == null) {
                        f.show = false;
                    }
                }
                f = (/** @type {?} */ (this.setExtendProps(f, sf, tempFPath)));
                ffields.push(f);
            }
        }));
        return ffields;
    }
    /**
     * 判定有子数据的条件为：子表可显示，且子表有数据
     * @param {?} row
     * @param {?} billInfo
     * @return {?}
     */
    hasChildData(row, billInfo) {
        /** @type {?} */
        let hasChildData = false;
        /** @type {?} */
        const schema = this.getBillTrackerSchema(billInfo);
        /** @type {?} */
        let children = row.GetChildTableList();
        for (let c of children) {
            /** @type {?} */
            let tableShow = false;
            /** @type {?} */
            let hasRows = false;
            /** @type {?} */
            let table = schema && schema[c.tableName];
            if (table != null && table.show != null) {
                tableShow = table.show;
            }
            else {
                // 兼容无show属性情形
                tableShow = true;
            }
            if (c.GetRowList() && c.GetRowList().length > 0) {
                hasRows = true;
            }
            hasChildData = tableShow && hasRows;
            if (hasChildData == true) {
                break;
            }
        }
        return hasChildData;
    }
    /**
     * @param {?} f
     * @param {?} rdfm
     * @param {?=} wholeFields
     * @return {?}
     */
    getFieldValue(f, rdfm, wholeFields) {
        /** @type {?} */
        let fields = f.fieldPath ? f.fieldPath.split(".") : [f.fieldName];
        /** @type {?} */
        let bdf = fields && rdfm[fields[0]];
        for (let i = 1; bdf != null && i < fields.length; i++) {
            /** @type {?} */
            const temp = bdf.GetSubFieldMap();
            if (temp == null) {
                break;
            }
            bdf = temp[fields[i]];
        }
        /** @type {?} */
        const textValue = bdf ? bdf.GetTextValue() : "";
        if (textValue == null) {
            return null;
        }
        if (f.dataType == DataType.String) {
            if (f.formatInfo != null) {
                /** @type {?} */
                const stringMapFormatter = f.formatInfo.stringMapFormatter;
                if (stringMapFormatter != null) {
                    /** @type {?} */
                    const v = stringMapFormatter[textValue] || textValue;
                    f.fieldValue = v;
                    return v;
                }
                else {
                    f.fieldValue = textValue;
                    return textValue || "";
                }
            }
            else {
                f.fieldValue = textValue;
                return textValue || "";
            }
        }
        else if (f.dataType == DataType.Decimal) {
            /** @type {?} */
            let scale = f.scale;
            if (f.formatInfo != null) {
                if (f.formatInfo.scale != null) {
                    scale = f.formatInfo.scale;
                }
                if (f.formatInfo.enableScaleExpression) {
                    if (f.formatInfo.scaleExpression != null) {
                        /** @type {?} */
                        const scaleField = this.getFieldInFields(wholeFields, f.formatInfo.scaleExpression);
                        /** @type {?} */
                        const tmp = scaleField && parseInt(String(this.getFieldValue(scaleField, rdfm)));
                        // const tmp = parseInt(this.getFieldValueInFieldsWithValue(extactedFields, f.formatInfo.scaleExpression));
                        if (tmp != null) {
                            if (isNaN(tmp)) {
                                throw Exceptions.SCALE_FIELD_VALUE_IS_NAN;
                            }
                            scale = tmp;
                        }
                    }
                }
            }
            f.fieldValue = parseFloat(String(textValue));
            if (scale < 0) {
                scale = 0;
            }
            else if (scale > 100) {
                scale = 100;
            }
            /** @type {?} */
            let dec = parseFloat(String(textValue)).toFixed(scale).toString();
            return dec || "";
        }
        else if (f.dataType == DataType.Boolean) {
            if (textValue == "") {
                f.fieldValue = null;
                return textValue;
            }
            f.fieldValue = (/** @type {?} */ (JSON.parse(textValue)));
            return (/** @type {?} */ (JSON.parse(textValue)));
        }
        else if (f.dataType == DataType.DateTime) {
            /** @type {?} */
            let date = BpmnModelJsonHelper.DateTimeFromString(textValue);
            /** @type {?} */
            let formatter = "yyyy-MM-dd";
            formatter = f.formatInfo && f.formatInfo.dateFormatter || "yyyy-MM-dd";
            // if (f.fieldType == "DateTime") {
            //     formatter = f.formatInfo && f.formatInfo.dateFormatter || "yyyy-MM-dd HH:mm:ss.SSS";
            // } else if (f.fieldType == "Date") {
            //     formatter = f.formatInfo && f.formatInfo.dateFormatter || "yyyy-MM-dd";
            // } else {
            //     formatter = f.formatInfo && f.formatInfo.dateFormatter || "yyyy-MM-dd";
            // }
            f.fieldValue = date;
            return this.dateFormat(date, formatter);
        }
        else {
            f.fieldValue = textValue;
            return textValue || "";
        }
    }
    /**
     * 根据fullPath在字段列表中查找目标字段
     * @param {?} fields
     * @param {?} fullPath
     * @return {?}
     */
    getFieldInFields(fields, fullPath) {
        /** @type {?} */
        let v = null;
        for (let fv of fields) {
            /** @type {?} */
            const curFv = (/** @type {?} */ (fv));
            // 查找根字段
            /** @type {?} */
            let tmpFv = fv;
            while (tmpFv.attachedField) {
                tmpFv = tmpFv.attachedField;
            }
            /** @type {?} */
            const rootFv = (/** @type {?} */ (tmpFv));
            // 更新fullPath
            curFv.fullPath = fullPathPrefix + rootFv.attachedTable.tableName + "." + curFv.fieldPath;
            // 对比当前字段fullPath与目标fullPath
            if (fullPath == curFv.fullPath) {
                v = curFv;
                break;
            }
            // 递归查找子字段
            /** @type {?} */
            const subFlds = curFv.GetSubFieldList();
            if (subFlds && subFlds.length > 0) {
                v = this.getFieldInFields(subFlds, fullPath);
                if (v != null) {
                    break;
                }
            }
        }
        return v;
    }
    /**
     * @param {?} fieldsWithValue
     * @param {?} fullPath
     * @return {?}
     */
    getFieldValueInFieldsWithValue(fieldsWithValue, fullPath) {
        /** @type {?} */
        let v = null;
        for (let fv of fieldsWithValue) {
            while (fv.attachedField) {
                fv = fv.attachedField;
            }
            /** @type {?} */
            const rootFv = (/** @type {?} */ (fv));
            rootFv.fullPath = fullPathPrefix + rootFv.attachedTable.tableName + "." + rootFv.fieldPath;
            if (fullPath == rootFv.fullPath) {
                v = rootFv.fieldValue;
                break;
            }
        }
        return v;
    }
    /**
     * @param {?} billInfo
     * @param {?} schemaTable
     * @param {?} dataTable
     * @param {?=} filterFields
     * @return {?}
     */
    getBasicInfoFieldsWithValue(billInfo, schemaTable, dataTable, filterFields = true) {
        /** @type {?} */
        const fieldsWithValue = [];
        // 单据追踪配置
        /** @type {?} */
        let bts = new BillTrackingSettings();
        if (billInfo && billInfo.billTrackingSettings) {
            bts.LoadFromJson(billInfo.billTrackingSettings);
        }
        /** @type {?} */
        const schema = this.getBillTrackerSchema(billInfo);
        /** @type {?} */
        let selectedFields = schema && schema[schemaTable.tableName] && schema[schemaTable.tableName].fields;
        selectedFields = selectedFields ? selectedFields : [];
        /** @type {?} */
        let showCustomFields = bts.billTrackingDataShownMode === BillTrackingDataShownMode.CUSTOMFIELD;
        // 所有字段
        /** @type {?} */
        const fs = schemaTable.getFieldList();
        /** @type {?} */
        const r = dataTable.GetRowList()[0];
        // 主表字段
        /** @type {?} */
        const rdfm = r.GetFieldMap();
        // 提取展示字段
        /** @type {?} */
        const ffs = this.extractFFields(fs, selectedFields, showCustomFields);
        // 获取字段值
        // 先解析其他类型字段
        /** @type {?} */
        const decimalFfs = [];
        ffs.forEach((/**
         * @param {?} ff
         * @return {?}
         */
        ff => {
            if (ff.dataType == DataType.Decimal) {
                decimalFfs.push(ff);
            }
            else {
                ff.fieldValue = this.getFieldValue(ff, rdfm);
            }
        }));
        // 再解析浮点数字段
        decimalFfs.forEach((/**
         * @param {?} ff
         * @return {?}
         */
        ff => {
            ff.fieldValue = this.getFieldValue(ff, rdfm, fs);
        }));
        fieldsWithValue.push(...ffs);
        return fieldsWithValue;
    }
    /**
     * @param {?} f
     * @param {?} sf
     * @param {?} fieldPath
     * @param {?=} rdfm
     * @return {?}
     */
    setExtendProps(f, sf, fieldPath, rdfm) {
        f.captionPath = this.extractCaptionPath(f);
        f.fieldPath = fieldPath;
        if (sf) {
            f.displayName = sf.displayName;
            f.i18nCols = sf.i18nCols;
            f.formatInfo = sf.formatInfo;
            f.order = sf.order;
        }
        if (rdfm) {
            f.fieldValue = this.getFieldValue(f, rdfm);
        }
        return f;
    }
    /**
     * 字段列表按order属性排序
     * @param {?} fieldsWithValue
     * @return {?}
     */
    sortFieldsByOrder(fieldsWithValue) {
        return fieldsWithValue.sort((/**
         * @param {?} a
         * @param {?} b
         * @return {?}
         */
        (a, b) => {
            if (a.order != null && b.order != null) {
                return a.order - b.order;
            }
            else if (a.order != null && b.order == null) {
                return -1;
            }
            else if (a.order == null && b.order != null) {
                return 1;
            }
            else {
                return 0;
            }
        }));
    }
    /**
     * @param {?} date
     * @param {?} fmt
     * @return {?}
     */
    dateFormat(date, fmt) {
        /** @type {?} */
        let ret;
        /** @type {?} */
        const opt = {
            "y+": date.getUTCFullYear().toString(),
            // 年
            "M+": (date.getUTCMonth() + 1).toString(),
            // 月
            "d+": date.getUTCDate().toString(),
            // 日
            "H+": date.getUTCHours().toString(),
            // 时
            "m+": date.getUTCMinutes().toString(),
            // 分
            "s+": date.getUTCSeconds().toString(),
            // 秒
            "S+": date.getUTCMilliseconds().toString(),
        };
        for (let k in opt) {
            ret = new RegExp("(" + k + ")").exec(fmt);
            if (ret) {
                if (!String.prototype.padStart) {
                    fmt = fmt.replace(ret[1], (ret[1].length == 1) ? (opt[k]) : (this.myPadStart(opt[k], ret[1].length, "0")));
                }
                else {
                    fmt = fmt.replace(ret[1], (ret[1].length == 1) ? (opt[k]) : (opt[k].padStart(ret[1].length, "0")));
                }
            }
        }
        return fmt;
    }
    /**
     * @param {?} src
     * @param {?} targetLength
     * @param {?} padString
     * @return {?}
     */
    myPadStart(src, targetLength, padString) {
        targetLength = targetLength >> 0; //floor if number or convert non-number to 0;
        padString = String(typeof padString !== 'undefined' ? padString : ' ');
        if (src.length > targetLength) {
            return String(src);
        }
        else {
            targetLength = targetLength - src.length;
            if (targetLength > padString.length) {
                padString += padString.repeat(targetLength / padString.length); //append to original to ensure we are longer than needed
            }
            return padString.slice(0, targetLength) + String(src);
        }
    }
    /**
     * 解析字段名称
     * @param {?} f
     * @param {?=} langCode
     * @return {?}
     */
    getFieldLabel(f, langCode) {
        return (langCode && f.i18nCols && f.i18nCols.colI18nValues.displayName &&
            f.i18nCols.colI18nValues.displayName[langCode]) || f.displayName || f.captionPath || f.caption;
    }
    /**
     * 解析表名称
     * @param {?} billInfo
     * @param {?} schemaTable
     * @param {?=} langCode
     * @return {?}
     */
    getTableLabel(billInfo, schemaTable, langCode) {
        /** @type {?} */
        const schema = this.getBillTrackerSchema(billInfo);
        /** @type {?} */
        let table = schema && schema[schemaTable.tableName];
        if (table != null) {
            /** @type {?} */
            const i18nCols = table.i18nCols;
            /** @type {?} */
            const tmp = (langCode && i18nCols && i18nCols.colI18nValues.displayName && i18nCols.colI18nValues.displayName[langCode]) || table.displayName || table.caption || table.code;
            return tmp;
        }
        else {
            return schemaTable.caption;
        }
    }
    /**
     * 获取解析可展示子表
     * @param {?} billInfo
     * @param {?} schemaTable
     * @return {?}
     */
    getChildTables(billInfo, schemaTable) {
        /** @type {?} */
        let result = [];
        /** @type {?} */
        const schema = this.getBillTrackerSchema(billInfo);
        /** @type {?} */
        const children = schemaTable.GetChildTableList();
        children && children.forEach((/**
         * @param {?} child
         * @return {?}
         */
        (child) => {
            /** @type {?} */
            let trackerTable = schema && schema[child.tableName];
            if (trackerTable != null && trackerTable.show != null) {
                if (trackerTable.show == true) {
                    child.order = trackerTable.order;
                    result.push(child);
                }
            }
            else {
                // 兼容无show属性情形
                result.push(child);
            }
        }));
        result = this.sortTablesByOrder(result);
        return result;
    }
    /**
     * 表按sort字段排序
     * @param {?} schemaTables
     * @return {?}
     */
    sortTablesByOrder(schemaTables) {
        return schemaTables.sort((/**
         * @param {?} a
         * @param {?} b
         * @return {?}
         */
        (a, b) => {
            if (a.order != null && b.order != null) {
                return a.order - b.order;
            }
            else if (a.order != null && b.order == null) {
                return -1;
            }
            else if (a.order == null && b.order != null) {
                return 1;
            }
            else {
                return 0;
            }
        }));
    }
    /**
     * 解析billTrackerSchema
     * @param {?} billInfo
     * @return {?}
     */
    getBillTrackerSchema(billInfo) {
        /** @type {?} */
        let bts = new BillTrackingSettings();
        if (billInfo && billInfo.billTrackingSettings) {
            bts.LoadFromJson(billInfo.billTrackingSettings);
        }
        /** @type {?} */
        let fieldContent = bts.customFieldContent;
        /** @type {?} */
        let fieldConfig = fieldContent && (typeof fieldContent == "object" ? fieldContent : JSON.parse(fieldContent));
        /** @type {?} */
        let schema = fieldConfig && fieldConfig.schema;
        return schema;
    }
}
BillTrackerDataInfoService.decorators = [
    { type: Injectable }
];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmlsbC10cmFja2VyLWRhdGEtaW5mby5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGVkcC1iaWYvcnVudGltZS1hcGkvIiwic291cmNlcyI6WyJsaWIvYmlsbC10cmFja2VyL3NlcnZpY2VzL2JpbGwtdHJhY2tlci1kYXRhLWluZm8uc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDM0MsT0FBTyxFQUEwSSxtQkFBbUIsRUFBRSxRQUFRLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUM1TSxPQUFPLEVBQW9ELHlCQUF5QixFQUFFLG9CQUFvQixFQUFFLGNBQWMsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBRXhKLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxrQ0FBa0MsQ0FBQztBQUc5RCxNQUFNLE9BQU8sMEJBQTBCOzs7Ozs7SUFNOUIsUUFBUSxDQUFDLEdBQWtDO1FBQ2hELElBQUksT0FBTyxHQUFHLElBQUksUUFBUSxFQUFFOztrQkFDcEIsSUFBSSxHQUFHLElBQUksb0JBQW9CLEVBQUU7WUFDdkMsSUFBSSxDQUFDLFlBQVksQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUN2QixHQUFHLEdBQUcsSUFBSSxDQUFDO1NBQ1o7UUFFRCxPQUFPLEdBQUcsSUFBSSxJQUFJLElBQUksR0FBRyxDQUFDLE9BQU8sS0FBSyxLQUFLLENBQUM7SUFDOUMsQ0FBQzs7Ozs7Ozs7SUFFTSxlQUFlLENBQUMsSUFBbUIsRUFBRSxXQUFrQyxFQUFFLFdBQWtDLEVBQUUsT0FBZTs7WUFDN0gsS0FBSyxHQUFHLEVBQUU7UUFDZCxLQUFLLElBQUksR0FBRyxJQUFJLElBQUksRUFBRTs7Z0JBQ2hCLEdBQUcsR0FBRyxFQUFFO1lBQ1osR0FBRyxDQUFDLE9BQU8sQ0FBQyxHQUFHLEdBQUcsQ0FBQyxNQUFNLENBQUM7OztrQkFFcEIsVUFBVSxHQUFHLEVBQUU7WUFDckIsV0FBVyxDQUFD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QUssSUFBSSxJQUFJLEVBQUU7Z0JBQ3RDLE9BQU8sQ0FBQyxDQUFDLEtBQUssR0FBRyxDQUFDLENBQUMsS0FBSyxDQUFDO2FBQzFCO2lCQUFNLElBQUksQ0FBQyxDQUFDLEtBQUssSUFBSSxJQUFJLElBQUksQ0FBQyxDQUFDLEtBQUssSUFBSSxJQUFJLEVBQUU7Z0JBQzdDLE9BQU8sQ0FBQyxDQUFDLENBQUM7YUFDWDtpQkFBTSxJQUFJLENBQUMsQ0FBQyxLQUFLLElBQUksSUFBSSxJQUFJLENBQUMsQ0FBQyxLQUFLLElBQUksSUFBSSxFQUFFO2dCQUM3QyxPQUFPLENBQUMsQ0FBQzthQUNWO2lCQUFNO2dCQUNMLE9BQU8sQ0FBQyxDQUFDO2FBQ1Y7UUFDSCxDQUFDLEVBQUMsQ0FBQTtJQUNKLENBQUM7Ozs7OztJQUtNLG9CQUFvQixDQUFDLFFBQWtCOztZQUN4QyxHQUFHLEdBQXlCLElBQUksb0JBQW9CLEVBQUU7UUFDMUQsSUFBSSxRQUFRLElBQUksUUFBUSxDQUFDLG9CQUFvQixFQUFFO1lBQzdDLEdBQUcsQ0FBQyxZQUFZLENBQUMsUUFBUSxDQUFDLG9CQUFvQixDQUFDLENBQUM7U0FDakQ7O1lBRUcsWUFBWSxHQUFHLEdBQUcsQ0FBQyxrQkFBa0I7O1lBQ3JDLFdBQVcsR0FBa0MsWUFBWSxJQUFJLENBQUMsT0FBTyxZQUFZLElBQUksUUFBUSxDQUFDLENBQUMsQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsWUFBWSxDQUFDLENBQUM7O1lBQ3hJLE1BQU0sR0FBRyxXQUFXLElBQUksV0FBVyxDQUFDLE1BQU07UUFFOUMsT0FBTyxNQUFNLENBQUM7SUFDaEIsQ0FBQzs7O1lBNWRGLFVBQVUiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSBcIkBhbmd1bGFyL2NvcmVcIjtcclxuaW1wb3J0IHsgQmlsbERhdGFGaWVsZCwgQmlsbERhdGFSb3csIEJpbGxEYXRhU3ViRmllbGQsIEJpbGxEYXRhVGFibGUsIEJpbGxTY2hlbWFGaWVsZCwgQmlsbFNjaGVtYUZpZWxkQmFzZSwgQmlsbFNjaGVtYVN1YkZpZWxkLCBCaWxsU2NoZW1hVGFibGUsIEJwbW5Nb2RlbEpzb25IZWxwZXIsIERhdGFUeXBlIH0gZnJvbSBcIkBlZHAtYWlmL2NvbW1vbi1hcGlcIjtcclxuaW1wb3J0IHsgQmlsbFRyYWNrZXJTY2hlbWEsIEJpbGxUcmFja2VyU2NoZW1hRmllbGRDb250ZW50LCBCaWxsVHJhY2tpbmdEYXRhU2hvd25Nb2RlLCBCaWxsVHJhY2tpbmdTZXR0aW5ncywgZnVsbFBhdGhQcmVmaXggfSBmcm9tIFwiQGVkcC1iaWYvY29tbW9uLWFwaVwiO1xyXG5pbXBvcnQgeyBCaWxsSW5mbyB9IGZyb20gXCIuLi8uLi9lbnRpdHkvdHJhY2tpbmcvQmlsbEluZm9cIjtcclxuaW1wb3J0IHsgRXhjZXB0aW9ucyB9IGZyb20gXCIuLi8uLi9lbnRpdHkvdHJhY2tpbmcvRXhjZXB0aW9uc1wiO1xyXG5cclxuQEluamVjdGFibGUoKVxyXG5leHBvcnQgY2xhc3MgQmlsbFRyYWNrZXJEYXRhSW5mb1NlcnZpY2Uge1xyXG4gIC8qKlxyXG4gICAqIOWIpOaWrUJpbGxUcmFja2luZ1NldHRpbmdz5piv5pen54mI6L+Y5piv5paw54mIXHJcbiAgICogQHBhcmFtIGJ0c1xyXG4gICAqIEByZXR1cm5zXHJcbiAgICovXHJcbiAgcHVibGljIGlzTmV3QlRTKGJ0czogc3RyaW5nIHwgQmlsbFRyYWNraW5nU2V0dGluZ3MpOiBib29sZWFuIHtcclxuICAgIGlmICh0eXBlb2YgYnRzID09IFwic3RyaW5nXCIpIHtcclxuICAgICAgY29uc3QgdGVtcCA9IG5ldyBCaWxsVHJhY2tpbmdTZXR0aW5ncygpO1xyXG4gICAgICB0ZW1wLkxvYWRGcm9tSnNvbihidHMpO1xyXG4gICAgICBidHMgPSB0ZW1wO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBidHMgIT0gbnVsbCAmJiBidHMudmVyc2lvbiA9PT0gXCIxLjBcIjtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBleHRyYWN0RGF0YVJvd3Mocm93czogQmlsbERhdGFSb3dbXSwgc2hvd25GaWVsZHM6IEJpbGxTY2hlbWFGaWVsZEJhc2VbXSwgd2hvbGVGaWVsZHM6IEJpbGxTY2hlbWFGaWVsZEJhc2VbXSwgaWRGaWVsZDogc3RyaW5nKSB7XHJcbiAgICBsZXQgZnJvd3MgPSBbXTtcclxuICAgIGZvciAobGV0IHJvdyBvZiByb3dzKSB7XHJcbiAgICAgIGxldCBvYmogPSB7fTtcclxuICAgICAgb2JqW2lkRmllbGRdID0gcm93LmRhdGFJZDtcclxuICAgICAgLy8g5YWI6Kej5p6Q5YW25LuW57G75Z6L5a2X5q61XHJcbiAgICAgIGNvbnN0IGRlY2ltYWxGRnMgPSBbXTtcclxuICAgICAgc2hvd25GaWVsZHMuZm9yRWFjaChmID0+IHtcclxuICAgICAgICBpZiAoZi5kYXRhVHlwZSA9PSBEYXRhVHlwZS5EZWNpbWFsKSB7XHJcbiAgICAgICAgICBkZWNpbWFsRkZzLnB1c2goZik7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIG9ialtmLmZpZWxkUGF0aF0gPSB0aGlzLmdldEZpZWxkVmFsdWUoZiwgcm93LkdldEZpZWxkTWFwKCksIHdob2xlRmllbGRzKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgICAvLyDlho3op6PmnpDmta7ngrnlnovlrZfmrrVcclxuICAgICAgZGVjaW1hbEZGcy5mb3JFYWNoKGYgPT4ge1xyXG4gICAgICAgIG9ialtmLmZpZWxkUGF0aF0gPSB0aGlzLmdldEZpZWxkVmFsdWUoZiwgcm93LkdldEZpZWxkTWFwKCksIHdob2xlRmllbGRzKTtcclxuICAgICAgfSk7XHJcblxyXG4gICAgICBmcm93cy5wdXNoKG9iaik7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIGZyb3dzO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGV4dHJhY3RDYXB0aW9uUGF0aChmaWVsZDogQmlsbFNjaGVtYUZpZWxkIHwgQmlsbFNjaGVtYVN1YkZpZWxkKSB7XHJcbiAgICBsZXQgcyA9IGZpZWxkLmNhcHRpb247XHJcbiAgICBsZXQgdG1wID0gZmllbGQgYXMgQmlsbFNjaGVtYVN1YkZpZWxkO1xyXG4gICAgd2hpbGUgKHRtcC5hdHRhY2hlZEZpZWxkICE9IG51bGwpIHtcclxuICAgICAgcyA9IHRtcC5hdHRhY2hlZEZpZWxkLmNhcHRpb24gKyBcIi5cIiArIHM7XHJcbiAgICAgIHRtcCA9IHRtcC5hdHRhY2hlZEZpZWxkIGFzIEJpbGxTY2hlbWFTdWJGaWVsZDtcclxuICAgIH1cclxuICAgIHJldHVybiBzO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGV4dHJhY3RGaWVsZFBhdGgoZmllbGQ6IEJpbGxTY2hlbWFGaWVsZCB8IEJpbGxTY2hlbWFTdWJGaWVsZCkge1xyXG4gICAgbGV0IHMgPSBmaWVsZC5maWVsZE5hbWU7XHJcbiAgICBsZXQgdG1wID0gZmllbGQgYXMgQmlsbFNjaGVtYVN1YkZpZWxkO1xyXG4gICAgd2hpbGUgKHRtcC5hdHRhY2hlZEZpZWxkICE9IG51bGwpIHtcclxuICAgICAgcyA9IHRtcC5hdHRhY2hlZEZpZWxkLmZpZWxkTmFtZSArIFwiLlwiICsgcztcclxuICAgICAgdG1wID0gdG1wLmF0dGFjaGVkRmllbGQgYXMgQmlsbFNjaGVtYVN1YkZpZWxkO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHM7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKlxyXG4gICAqIEBwYXJhbSBmaWVsZHMg5a2Q5a2X5q615YiX6KGoXHJcbiAgICogQHBhcmFtIHNlbGVjdGVkRmllbGRzIOeUqOaIt+iHquWumuS5ieWxleekuuWtl+auteWIl+ihqFxyXG4gICAqIEBwYXJhbSBzaG93Q3VzdG9tRmllbGRzIOaYr+WQpuaMieeUqOaIt+iHquWumuS5ieWtl+auteaYvuekulxyXG4gICAqIEByZXR1cm5zXHJcbiAgICovXHJcbiAgcHVibGljIGV4dHJhY3RGRmllbGRzKGZpZWxkczogKEJpbGxTY2hlbWFGaWVsZCB8IEJpbGxTY2hlbWFTdWJGaWVsZClbXSwgc2VsZWN0ZWRGaWVsZHM6IEJpbGxTY2hlbWFGaWVsZEJhc2VbXSwgc2hvd0N1c3RvbUZpZWxkczogYm9vbGVhbik6IChCaWxsU2NoZW1hRmllbGQgfCBCaWxsU2NoZW1hU3ViRmllbGQpW10ge1xyXG4gICAgbGV0IGZmaWVsZHM6IChCaWxsU2NoZW1hRmllbGQgfCBCaWxsU2NoZW1hU3ViRmllbGQpW10gPSBbXTtcclxuICAgIGZpZWxkcy5mb3JFYWNoKGYgPT4ge1xyXG4gICAgICBmLnNob3cgPSB0cnVlO1xyXG4gICAgICAvL+aemuS4vuaIluiAheaemuS4vuWei+WNleWAvFVEVOaXtum7mOiupOWPlk5hbWVcclxuICAgICAgaWYgKGYuZmllbGRUeXBlID09IFwiRW51bVwiIHx8IGYuZmllbGRUeXBlID09IFwiRW51bVNpbmdsZVVkdFwiKSB7XHJcbiAgICAgICAgY29uc3QgdGVtcEZQYXRoID0gdGhpcy5leHRyYWN0RmllbGRQYXRoKGYpO1xyXG5cclxuICAgICAgICBsZXQgc2YgPSBudWxsO1xyXG4gICAgICAgIGlmIChzaG93Q3VzdG9tRmllbGRzKSB7XHJcbiAgICAgICAgICAvLyDlpoLmnpzlrZfmrrXkuI3lnKjlt7LphY3nva7lrZfmrrXliJfooajkuK3liJnot7Pov4dcclxuICAgICAgICAgIHNmID0gc2VsZWN0ZWRGaWVsZHMuZmluZCgoc2ZpZWxkKSA9PiBzZmllbGQuZmllbGRQYXRoID09IHRlbXBGUGF0aCk7XHJcbiAgICAgICAgICBpZiAoc2YgPT0gbnVsbCkge1xyXG4gICAgICAgICAgICBmLnNob3cgPSBmYWxzZTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGYgPSB0aGlzLnNldEV4dGVuZFByb3BzKGYsIHNmLCB0ZW1wRlBhdGggKyBcIi5OYW1lXCIpIGFzIEJpbGxTY2hlbWFTdWJGaWVsZDtcclxuXHJcbiAgICAgICAgZmZpZWxkcy5wdXNoKGYpO1xyXG4gICAgICB9IGVsc2UgaWYgKGYuR2V0U3ViRmllbGRMaXN0KCkgIT0gbnVsbCAmJiBmLkdldFN1YkZpZWxkTGlzdCgpLmxlbmd0aCA+IDApIHtcclxuICAgICAgICBmZmllbGRzLnB1c2goLi4udGhpcy5leHRyYWN0RkZpZWxkcyhmLkdldFN1YkZpZWxkTGlzdCgpLCBzZWxlY3RlZEZpZWxkcywgc2hvd0N1c3RvbUZpZWxkcykpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGNvbnN0IHRlbXBGUGF0aCA9IHRoaXMuZXh0cmFjdEZpZWxkUGF0aChmKTtcclxuXHJcbiAgICAgICAgbGV0IHNmID0gbnVsbDtcclxuICAgICAgICBpZiAoc2hvd0N1c3RvbUZpZWxkcykge1xyXG4gICAgICAgICAgLy8g5aaC5p6c5a2X5q615LiN5Zyo5bey6YWN572u5a2X5q615YiX6KGo5Lit5YiZ6Lez6L+HXHJcbiAgICAgICAgICBzZiA9IHNlbGVjdGVkRmllbGRzLmZpbmQoKHNmaWVsZCkgPT4gc2ZpZWxkLmZpZWxkUGF0aCA9PSB0ZW1wRlBhdGgpO1xyXG4gICAgICAgICAgaWYgKHNmID09IG51bGwpIHtcclxuICAgICAgICAgICAgZi5zaG93ID0gZmFsc2U7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmID0gdGhpcy5zZXRFeHRlbmRQcm9wcyhmLCBzZiwgdGVtcEZQYXRoKSBhcyBCaWxsU2NoZW1hU3ViRmllbGQ7XHJcblxyXG4gICAgICAgIGZmaWVsZHMucHVzaChmKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcblxyXG4gICAgcmV0dXJuIGZmaWVsZHM7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDliKTlrprmnInlrZDmlbDmja7nmoTmnaHku7bkuLrvvJrlrZDooajlj6/mmL7npLrvvIzkuJTlrZDooajmnInmlbDmja5cclxuICAgKi9cclxuICBwdWJsaWMgaGFzQ2hpbGREYXRhKHJvdzogQmlsbERhdGFSb3csIGJpbGxJbmZvOiBCaWxsSW5mbykge1xyXG4gICAgbGV0IGhhc0NoaWxkRGF0YSA9IGZhbHNlO1xyXG5cclxuICAgIGNvbnN0IHNjaGVtYSA9IHRoaXMuZ2V0QmlsbFRyYWNrZXJTY2hlbWEoYmlsbEluZm8pO1xyXG4gICAgbGV0IGNoaWxkcmVuID0gcm93LkdldENoaWxkVGFibGVMaXN0KCk7XHJcbiAgICBmb3IgKGxldCBjIG9mIGNoaWxkcmVuKSB7XHJcbiAgICAgIGxldCB0YWJsZVNob3cgPSBmYWxzZTtcclxuICAgICAgbGV0IGhhc1Jvd3MgPSBmYWxzZTtcclxuICAgICAgbGV0IHRhYmxlID0gc2NoZW1hICYmIHNjaGVtYVtjLnRhYmxlTmFtZV07XHJcbiAgICAgIGlmICh0YWJsZSAhPSBudWxsICYmIHRhYmxlLnNob3cgIT0gbnVsbCkge1xyXG4gICAgICAgIHRhYmxlU2hvdyA9IHRhYmxlLnNob3c7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgLy8g5YW85a655pegc2hvd+WxnuaAp+aDheW9olxyXG4gICAgICAgIHRhYmxlU2hvdyA9IHRydWU7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKGMuR2V0Um93TGlzdCgpICYmIGMuR2V0Um93TGlzdCgpLmxlbmd0aCA+IDApIHtcclxuICAgICAgICBoYXNSb3dzID0gdHJ1ZTtcclxuICAgICAgfVxyXG4gICAgICBoYXNDaGlsZERhdGEgPSB0YWJsZVNob3cgJiYgaGFzUm93cztcclxuICAgICAgaWYgKGhhc0NoaWxkRGF0YSA9PSB0cnVlKSB7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIHJldHVybiBoYXNDaGlsZERhdGE7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgZ2V0RmllbGRWYWx1ZShmOiBCaWxsU2NoZW1hRmllbGRCYXNlLCByZGZtOiB7IFtrZXk6IHN0cmluZ106IEJpbGxEYXRhRmllbGQ7IH0sIHdob2xlRmllbGRzPzogQmlsbFNjaGVtYUZpZWxkQmFzZVtdKSB7XHJcbiAgICBsZXQgZmllbGRzID0gZi5maWVsZFBhdGggPyBmLmZpZWxkUGF0aC5zcGxpdChcIi5cIikgOiBbZi5maWVsZE5hbWVdO1xyXG5cclxuICAgIGxldCBiZGY6IEJpbGxEYXRhRmllbGQgfCBCaWxsRGF0YVN1YkZpZWxkID0gZmllbGRzICYmIHJkZm1bZmllbGRzWzBdXTtcclxuICAgIGZvciAobGV0IGkgPSAxOyBiZGYgIT0gbnVsbCAmJiBpIDwgZmllbGRzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgIGNvbnN0IHRlbXAgPSBiZGYuR2V0U3ViRmllbGRNYXAoKTtcclxuICAgICAgaWYgKHRlbXAgPT0gbnVsbCkge1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICB9XHJcbiAgICAgIGJkZiA9IHRlbXBbZmllbGRzW2ldXTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCB0ZXh0VmFsdWUgPSBiZGYgPyBiZGYuR2V0VGV4dFZhbHVlKCkgOiBcIlwiO1xyXG4gICAgaWYgKHRleHRWYWx1ZSA9PSBudWxsKSB7XHJcbiAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfVxyXG4gICAgaWYgKGYuZGF0YVR5cGUgPT0gRGF0YVR5cGUuU3RyaW5nKSB7XHJcbiAgICAgIGlmIChmLmZvcm1hdEluZm8gIT0gbnVsbCkge1xyXG4gICAgICAgIGNvbnN0IHN0cmluZ01hcEZvcm1hdHRlciA9IGYuZm9ybWF0SW5mby5zdHJpbmdNYXBGb3JtYXR0ZXI7XHJcbiAgICAgICAgaWYgKHN0cmluZ01hcEZvcm1hdHRlciAhPSBudWxsKSB7XHJcbiAgICAgICAgICBjb25zdCB2ID0gc3RyaW5nTWFwRm9ybWF0dGVyW3RleHRWYWx1ZV0gfHwgdGV4dFZhbHVlO1xyXG4gICAgICAgICAgZi5maWVsZFZhbHVlID0gdjtcclxuICAgICAgICAgIHJldHVybiB2O1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICBmLmZpZWxkVmFsdWUgPSB0ZXh0VmFsdWU7XHJcbiAgICAgICAgICByZXR1cm4gdGV4dFZhbHVlIHx8IFwiXCI7XHJcbiAgICAgICAgfVxyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGYuZmllbGRWYWx1ZSA9IHRleHRWYWx1ZTtcclxuICAgICAgICByZXR1cm4gdGV4dFZhbHVlIHx8IFwiXCI7XHJcbiAgICAgIH1cclxuICAgIH0gZWxzZSBpZiAoZi5kYXRhVHlwZSA9PSBEYXRhVHlwZS5EZWNpbWFsKSB7XHJcbiAgICAgIGxldCBzY2FsZSA9IGYuc2NhbGU7XHJcbiAgICAgIGlmIChmLmZvcm1hdEluZm8gIT0gbnVsbCkge1xyXG4gICAgICAgIGlmIChmLmZvcm1hdEluZm8uc2NhbGUgIT0gbnVsbCkge1xyXG4gICAgICAgICAgc2NhbGUgPSBmLmZvcm1hdEluZm8uc2NhbGU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChmLmZvcm1hdEluZm8uZW5hYmxlU2NhbGVFeHByZXNzaW9uKSB7XHJcbiAgICAgICAgICBpZiAoZi5mb3JtYXRJbmZvLnNjYWxlRXhwcmVzc2lvbiAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHNjYWxlRmllbGQgPSB0aGlzLmdldEZpZWxkSW5GaWVsZHMod2hvbGVGaWVsZHMsIGYuZm9ybWF0SW5mby5zY2FsZUV4cHJlc3Npb24pO1xyXG4gICAgICAgICAgICBjb25zdCB0bXAgPSBzY2FsZUZpZWxkICYmIHBhcnNlSW50KFN0cmluZyh0aGlzLmdldEZpZWxkVmFsdWUoc2NhbGVGaWVsZCwgcmRmbSkpKTtcclxuICAgICAgICAgICAgLy8gY29uc3QgdG1wID0gcGFyc2VJbnQodGhpcy5nZXRGaWVsZFZhbHVlSW5GaWVsZHNXaXRoVmFsdWUoZXh0YWN0ZWRGaWVsZHMsIGYuZm9ybWF0SW5mby5zY2FsZUV4cHJlc3Npb24pKTtcclxuICAgICAgICAgICAgaWYgKHRtcCAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgaWYgKGlzTmFOKHRtcCkpIHtcclxuICAgICAgICAgICAgICAgIHRocm93IEV4Y2VwdGlvbnMuU0NBTEVfRklFTERfVkFMVUVfSVNfTkFOO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICBzY2FsZSA9IHRtcDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgICBmLmZpZWxkVmFsdWUgPSBwYXJzZUZsb2F0KFN0cmluZyh0ZXh0VmFsdWUpKTtcclxuICAgICAgaWYgKHNjYWxlIDwgMCkge1xyXG4gICAgICAgIHNjYWxlID0gMDtcclxuICAgICAgfSBlbHNlIGlmIChzY2FsZSA+IDEwMCkge1xyXG4gICAgICAgIHNjYWxlID0gMTAwO1xyXG4gICAgICB9XHJcbiAgICAgIGxldCBkZWMgPSBwYXJzZUZsb2F0KFN0cmluZyh0ZXh0VmFsdWUpKS50b0ZpeGVkKHNjYWxlKS50b1N0cmluZygpO1xyXG4gICAgICByZXR1cm4gZGVjIHx8IFwiXCI7XHJcbiAgICB9IGVsc2UgaWYgKGYuZGF0YVR5cGUgPT0gRGF0YVR5cGUuQm9vbGVhbikge1xyXG4gICAgICBpZiAodGV4dFZhbHVlID09IFwiXCIpIHtcclxuICAgICAgICBmLmZpZWxkVmFsdWUgPSBudWxsO1xyXG4gICAgICAgIHJldHVybiB0ZXh0VmFsdWU7XHJcbiAgICAgIH1cclxuICAgICAgZi5maWVsZFZhbHVlID0gSlNPTi5wYXJzZSh0ZXh0VmFsdWUpIGFzIGJvb2xlYW47XHJcbiAgICAgIHJldHVybiBKU09OLnBhcnNlKHRleHRWYWx1ZSkgYXMgYm9vbGVhbjtcclxuICAgIH0gZWxzZSBpZiAoZi5kYXRhVHlwZSA9PSBEYXRhVHlwZS5EYXRlVGltZSkge1xyXG4gICAgICBsZXQgZGF0ZSA9IEJwbW5Nb2RlbEpzb25IZWxwZXIuRGF0ZVRpbWVGcm9tU3RyaW5nKHRleHRWYWx1ZSk7XHJcbiAgICAgIGxldCBmb3JtYXR0ZXIgPSBcInl5eXktTU0tZGRcIjtcclxuICAgICAgZm9ybWF0dGVyID0gZi5mb3JtYXRJbmZvICYmIGYuZm9ybWF0SW5mby5kYXRlRm9ybWF0dGVyIHx8IFwieXl5eS1NTS1kZFwiO1xyXG4gICAgICAvLyBpZiAoZi5maWVsZFR5cGUgPT0gXCJEYXRlVGltZVwiKSB7XHJcbiAgICAgIC8vICAgICBmb3JtYXR0ZXIgPSBmLmZvcm1hdEluZm8gJiYgZi5mb3JtYXRJbmZvLmRhdGVGb3JtYXR0ZXIgfHwgXCJ5eXl5LU1NLWRkIEhIOm1tOnNzLlNTU1wiO1xyXG4gICAgICAvLyB9IGVsc2UgaWYgKGYuZmllbGRUeXBlID09IFwiRGF0ZVwiKSB7XHJcbiAgICAgIC8vICAgICBmb3JtYXR0ZXIgPSBmLmZvcm1hdEluZm8gJiYgZi5mb3JtYXRJbmZvLmRhdGVGb3JtYXR0ZXIgfHwgXCJ5eXl5LU1NLWRkXCI7XHJcbiAgICAgIC8vIH0gZWxzZSB7XHJcbiAgICAgIC8vICAgICBmb3JtYXR0ZXIgPSBmLmZvcm1hdEluZm8gJiYgZi5mb3JtYXRJbmZvLmRhdGVGb3JtYXR0ZXIgfHwgXCJ5eXl5LU1NLWRkXCI7XHJcbiAgICAgIC8vIH1cclxuICAgICAgZi5maWVsZFZhbHVlID0gZGF0ZTtcclxuICAgICAgcmV0dXJuIHRoaXMuZGF0ZUZvcm1hdChkYXRlLCBmb3JtYXR0ZXIpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgZi5maWVsZFZhbHVlID0gdGV4dFZhbHVlO1xyXG4gICAgICByZXR1cm4gdGV4dFZhbHVlIHx8IFwiXCI7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDmoLnmja5mdWxsUGF0aOWcqOWtl+auteWIl+ihqOS4reafpeaJvuebruagh+Wtl+autVxyXG4gICAqIEBwYXJhbSBmaWVsZHNcclxuICAgKiBAcGFyYW0gZnVsbFBhdGhcclxuICAgKiBAcmV0dXJuc1xyXG4gICAqL1xyXG4gIHB1YmxpYyBnZXRGaWVsZEluRmllbGRzKGZpZWxkczogQmlsbFNjaGVtYUZpZWxkQmFzZVtdLCBmdWxsUGF0aDogc3RyaW5nKSB7XHJcbiAgICBsZXQgdiA9IG51bGw7XHJcbiAgICBmb3IgKGxldCBmdiBvZiBmaWVsZHMpIHtcclxuICAgICAgY29uc3QgY3VyRnYgPSBmdiBhcyAoQmlsbFNjaGVtYUZpZWxkIHwgQmlsbFNjaGVtYVN1YkZpZWxkKTtcclxuICAgICAgLy8g5p+l5om+5qC55a2X5q61XHJcbiAgICAgIGxldCB0bXBGdjogQmlsbFNjaGVtYUZpZWxkQmFzZSA9IGZ2O1xyXG4gICAgICB3aGlsZSAodG1wRnYuYXR0YWNoZWRGaWVsZCkge1xyXG4gICAgICAgIHRtcEZ2ID0gdG1wRnYuYXR0YWNoZWRGaWVsZDtcclxuICAgICAgfVxyXG4gICAgICBjb25zdCByb290RnYgPSB0bXBGdiBhcyBCaWxsU2NoZW1hRmllbGQ7XHJcbiAgICAgIC8vIOabtOaWsGZ1bGxQYXRoXHJcbiAgICAgIGN1ckZ2LmZ1bGxQYXRoID0gZnVsbFBhdGhQcmVmaXggKyByb290RnYuYXR0YWNoZWRUYWJsZS50YWJsZU5hbWUgKyBcIi5cIiArIGN1ckZ2LmZpZWxkUGF0aDtcclxuICAgICAgLy8g5a+55q+U5b2T5YmN5a2X5q61ZnVsbFBhdGjkuI7nm67moIdmdWxsUGF0aFxyXG4gICAgICBpZiAoZnVsbFBhdGggPT0gY3VyRnYuZnVsbFBhdGgpIHtcclxuICAgICAgICB2ID0gY3VyRnY7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIH1cclxuICAgICAgLy8g6YCS5b2S5p+l5om+5a2Q5a2X5q61XHJcbiAgICAgIGNvbnN0IHN1YkZsZHMgPSBjdXJGdi5HZXRTdWJGaWVsZExpc3QoKTtcclxuICAgICAgaWYgKHN1YkZsZHMgJiYgc3ViRmxkcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgdiA9IHRoaXMuZ2V0RmllbGRJbkZpZWxkcyhzdWJGbGRzLCBmdWxsUGF0aCk7XHJcbiAgICAgICAgaWYgKHYgIT0gbnVsbCkge1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdjtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBnZXRGaWVsZFZhbHVlSW5GaWVsZHNXaXRoVmFsdWUoZmllbGRzV2l0aFZhbHVlOiBCaWxsU2NoZW1hRmllbGRCYXNlW10sIGZ1bGxQYXRoOiBzdHJpbmcpIHtcclxuICAgIGxldCB2ID0gbnVsbDtcclxuICAgIGZvciAobGV0IGZ2IG9mIGZpZWxkc1dpdGhWYWx1ZSkge1xyXG4gICAgICB3aGlsZSAoZnYuYXR0YWNoZWRGaWVsZCkge1xyXG4gICAgICAgIGZ2ID0gZnYuYXR0YWNoZWRGaWVsZDtcclxuICAgICAgfVxyXG4gICAgICBjb25zdCByb290RnYgPSBmdiBhcyBCaWxsU2NoZW1hRmllbGQ7XHJcbiAgICAgIHJvb3RGdi5mdWxsUGF0aCA9IGZ1bGxQYXRoUHJlZml4ICsgcm9vdEZ2LmF0dGFjaGVkVGFibGUudGFibGVOYW1lICsgXCIuXCIgKyByb290RnYuZmllbGRQYXRoO1xyXG4gICAgICBpZiAoZnVsbFBhdGggPT0gcm9vdEZ2LmZ1bGxQYXRoKSB7XHJcbiAgICAgICAgdiA9IHJvb3RGdi5maWVsZFZhbHVlO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdjtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBnZXRCYXNpY0luZm9GaWVsZHNXaXRoVmFsdWUoYmlsbEluZm86IEJpbGxJbmZvLCBzY2hlbWFUYWJsZTogQmlsbFNjaGVtYVRhYmxlLCBkYXRhVGFibGU6IEJpbGxEYXRhVGFibGUsIGZpbHRlckZpZWxkczogYm9vbGVhbiA9IHRydWUpOiAoQmlsbFNjaGVtYUZpZWxkIHwgQmlsbFNjaGVtYVN1YkZpZWxkKVtdIHtcclxuICAgIGNvbnN0IGZpZWxkc1dpdGhWYWx1ZTogKEJpbGxTY2hlbWFGaWVsZCB8IEJpbGxTY2hlbWFTdWJGaWVsZClbXSA9IFtdO1xyXG4gICAgLy8g5Y2V5o2u6L+96Liq6YWN572uXHJcbiAgICBsZXQgYnRzOiBCaWxsVHJhY2tpbmdTZXR0aW5ncyA9IG5ldyBCaWxsVHJhY2tpbmdTZXR0aW5ncygpO1xyXG4gICAgaWYgKGJpbGxJbmZvICYmIGJpbGxJbmZvLmJpbGxUcmFja2luZ1NldHRpbmdzKSB7XHJcbiAgICAgIGJ0cy5Mb2FkRnJvbUpzb24oYmlsbEluZm8uYmlsbFRyYWNraW5nU2V0dGluZ3MpO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHNjaGVtYSA9IHRoaXMuZ2V0QmlsbFRyYWNrZXJTY2hlbWEoYmlsbEluZm8pO1xyXG4gICAgbGV0IHNlbGVjdGVkRmllbGRzID0gc2NoZW1hICYmIHNjaGVtYVtzY2hlbWFUYWJsZS50YWJsZU5hbWVdICYmIHNjaGVtYVtzY2hlbWFUYWJsZS50YWJsZU5hbWVdLmZpZWxkcztcclxuICAgIHNlbGVjdGVkRmllbGRzID0gc2VsZWN0ZWRGaWVsZHMgPyBzZWxlY3RlZEZpZWxkcyA6IFtdO1xyXG4gICAgbGV0IHNob3dDdXN0b21GaWVsZHMgPSBidHMuYmlsbFRyYWNraW5nRGF0YVNob3duTW9kZSA9PT0gQmlsbFRyYWNraW5nRGF0YVNob3duTW9kZS5DVVNUT01GSUVMRDtcclxuXHJcbiAgICAvLyDmiYDmnInlrZfmrrVcclxuICAgIGNvbnN0IGZzID0gc2NoZW1hVGFibGUuZ2V0RmllbGRMaXN0KCk7XHJcbiAgICBjb25zdCByID0gZGF0YVRhYmxlLkdldFJvd0xpc3QoKVswXTtcclxuICAgIC8vIOS4u+ihqOWtl+autVxyXG4gICAgY29uc3QgcmRmbSA9IHIuR2V0RmllbGRNYXAoKTtcclxuXHJcbiAgICAvLyDmj5Dlj5blsZXnpLrlrZfmrrVcclxuICAgIGNvbnN0IGZmcyA9IHRoaXMuZXh0cmFjdEZGaWVsZHMoZnMsIHNlbGVjdGVkRmllbGRzLCBzaG93Q3VzdG9tRmllbGRzKTtcclxuICAgIC8vIOiOt+WPluWtl+auteWAvFxyXG4gICAgLy8g5YWI6Kej5p6Q5YW25LuW57G75Z6L5a2X5q61XHJcbiAgICBjb25zdCBkZWNpbWFsRmZzID0gW107XHJcbiAgICBmZnMuZm9yRWFjaChmZiA9PiB7XHJcbiAgICAgIGlmIChmZi5kYXRhVHlwZSA9PSBEYXRhVHlwZS5EZWNpbWFsKSB7XHJcbiAgICAgICAgZGVjaW1hbEZmcy5wdXNoKGZmKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBmZi5maWVsZFZhbHVlID0gdGhpcy5nZXRGaWVsZFZhbHVlKGZmLCByZGZtKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICAvLyDlho3op6PmnpDmta7ngrnmlbDlrZfmrrVcclxuICAgIGRlY2ltYWxGZnMuZm9yRWFjaChmZiA9PiB7XHJcbiAgICAgIGZmLmZpZWxkVmFsdWUgPSB0aGlzLmdldEZpZWxkVmFsdWUoZmYsIHJkZm0sIGZzKTtcclxuICAgIH0pO1xyXG4gICAgZmllbGRzV2l0aFZhbHVlLnB1c2goLi4uZmZzKTtcclxuXHJcbiAgICByZXR1cm4gZmllbGRzV2l0aFZhbHVlO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIHNldEV4dGVuZFByb3BzKGY6IEJpbGxTY2hlbWFGaWVsZCB8IEJpbGxTY2hlbWFTdWJGaWVsZCwgc2Y6IEJpbGxTY2hlbWFGaWVsZCB8IEJpbGxTY2hlbWFTdWJGaWVsZCwgZmllbGRQYXRoOiBzdHJpbmcsIHJkZm0/OiB7IFtrZXk6IHN0cmluZ106IEJpbGxEYXRhRmllbGQ7IH0pIHtcclxuICAgIGYuY2FwdGlvblBhdGggPSB0aGlzLmV4dHJhY3RDYXB0aW9uUGF0aChmKTtcclxuICAgIGYuZmllbGRQYXRoID0gZmllbGRQYXRoO1xyXG4gICAgaWYgKHNmKSB7XHJcbiAgICAgIGYuZGlzcGxheU5hbWUgPSBzZi5kaXNwbGF5TmFtZTtcclxuICAgICAgZi5pMThuQ29scyA9IHNmLmkxOG5Db2xzO1xyXG4gICAgICBmLmZvcm1hdEluZm8gPSBzZi5mb3JtYXRJbmZvO1xyXG4gICAgICBmLm9yZGVyID0gc2Yub3JkZXI7XHJcbiAgICB9XHJcbiAgICBpZiAocmRmbSkge1xyXG4gICAgICBmLmZpZWxkVmFsdWUgPSB0aGlzLmdldEZpZWxkVmFsdWUoZiwgcmRmbSk7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIGY7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDlrZfmrrXliJfooajmjIlvcmRlcuWxnuaAp+aOkuW6j1xyXG4gICAqIEBwYXJhbSBmaWVsZHNXaXRoVmFsdWVcclxuICAgKiBAcmV0dXJuc1xyXG4gICAqL1xyXG4gIHB1YmxpYyBzb3J0RmllbGRzQnlPcmRlcihmaWVsZHNXaXRoVmFsdWU6IChCaWxsU2NoZW1hRmllbGQgfCBCaWxsU2NoZW1hU3ViRmllbGQpW10pOiAoQmlsbFNjaGVtYUZpZWxkIHwgQmlsbFNjaGVtYVN1YkZpZWxkKVtdIHtcclxuICAgIHJldHVybiBmaWVsZHNXaXRoVmFsdWUuc29ydCgoYSwgYikgPT4ge1xyXG4gICAgICBpZiAoYS5vcmRlciAhPSBudWxsICYmIGIub3JkZXIgIT0gbnVsbCkge1xyXG4gICAgICAgIHJldHVybiBhLm9yZGVyIC0gYi5vcmRlcjtcclxuICAgICAgfSBlbHNlIGlmIChhLm9yZGVyICE9IG51bGwgJiYgYi5vcmRlciA9PSBudWxsKSB7XHJcbiAgICAgICAgcmV0dXJuIC0xO1xyXG4gICAgICB9IGVsc2UgaWYgKGEub3JkZXIgPT0gbnVsbCAmJiBiLm9yZGVyICE9IG51bGwpIHtcclxuICAgICAgICByZXR1cm4gMTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICByZXR1cm4gMDtcclxuICAgICAgfVxyXG4gICAgfSlcclxuICB9XHJcblxyXG4gIHB1YmxpYyBkYXRlRm9ybWF0KGRhdGU6IERhdGUsIGZtdDogc3RyaW5nKTogc3RyaW5nIHtcclxuICAgIGxldCByZXQ7XHJcbiAgICBjb25zdCBvcHQgPSB7XHJcbiAgICAgIFwieStcIjogZGF0ZS5nZXRVVENGdWxsWWVhcigpLnRvU3RyaW5nKCksICAgICAgICAvLyDlubRcclxuICAgICAgXCJNK1wiOiAoZGF0ZS5nZXRVVENNb250aCgpICsgMSkudG9TdHJpbmcoKSwgICAgIC8vIOaciFxyXG4gICAgICBcImQrXCI6IGRhdGUuZ2V0VVRDRGF0ZSgpLnRvU3RyaW5nKCksICAgICAgICAgICAgLy8g5pelXHJcbiAgICAgIFwiSCtcIjogZGF0ZS5nZXRVVENIb3VycygpLnRvU3RyaW5nKCksICAgICAgICAgICAvLyDml7ZcclxuICAgICAgXCJtK1wiOiBkYXRlLmdldFVUQ01pbnV0ZXMoKS50b1N0cmluZygpLCAgICAgICAgIC8vIOWIhlxyXG4gICAgICBcInMrXCI6IGRhdGUuZ2V0VVRDU2Vjb25kcygpLnRvU3RyaW5nKCksICAgICAgICAgLy8g56eSXHJcbiAgICAgIFwiUytcIjogZGF0ZS5nZXRVVENNaWxsaXNlY29uZHMoKS50b1N0cmluZygpLCAgICAvLyDnp5JcclxuICAgICAgLy8g5pyJ5YW25LuW5qC85byP5YyW5a2X56ym6ZyA5rGC5Y+v5Lul57un57ut5re75Yqg77yM5b+F6aG76L2s5YyW5oiQ5a2X56ym5LiyXHJcbiAgICB9O1xyXG4gICAgZm9yIChsZXQgayBpbiBvcHQpIHtcclxuICAgICAgcmV0ID0gbmV3IFJlZ0V4cChcIihcIiArIGsgKyBcIilcIikuZXhlYyhmbXQpO1xyXG4gICAgICBpZiAocmV0KSB7XHJcbiAgICAgICAgaWYgKCFTdHJpbmcucHJvdG90eXBlLnBhZFN0YXJ0KSB7XHJcbiAgICAgICAgICBmbXQgPSBmbXQucmVwbGFjZShyZXRbMV0sIChyZXRbMV0ubGVuZ3RoID09IDEpID8gKG9wdFtrXSkgOiAodGhpcy5teVBhZFN0YXJ0KG9wdFtrXSwgcmV0WzFdLmxlbmd0aCwgXCIwXCIpKSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIGZtdCA9IGZtdC5yZXBsYWNlKHJldFsxXSwgKHJldFsxXS5sZW5ndGggPT0gMSkgPyAob3B0W2tdKSA6IChvcHRba10ucGFkU3RhcnQocmV0WzFdLmxlbmd0aCwgXCIwXCIpKSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gZm10O1xyXG4gIH1cclxuXHJcbiAgcHVibGljIG15UGFkU3RhcnQoc3JjOiBzdHJpbmcsIHRhcmdldExlbmd0aDogbnVtYmVyLCBwYWRTdHJpbmc6IHN0cmluZykge1xyXG4gICAgdGFyZ2V0TGVuZ3RoID0gdGFyZ2V0TGVuZ3RoID4+IDA7IC8vZmxvb3IgaWYgbnVtYmVyIG9yIGNvbnZlcnQgbm9uLW51bWJlciB0byAwO1xyXG4gICAgcGFkU3RyaW5nID0gU3RyaW5nKHR5cGVvZiBwYWRTdHJpbmcgIT09ICd1bmRlZmluZWQnID8gcGFkU3RyaW5nIDogJyAnKTtcclxuICAgIGlmIChzcmMubGVuZ3RoID4gdGFyZ2V0TGVuZ3RoKSB7XHJcbiAgICAgIHJldHVybiBTdHJpbmcoc3JjKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRhcmdldExlbmd0aCA9IHRhcmdldExlbmd0aCAtIHNyYy5sZW5ndGg7XHJcbiAgICAgIGlmICh0YXJnZXRMZW5ndGggPiBwYWRTdHJpbmcubGVuZ3RoKSB7XHJcbiAgICAgICAgcGFkU3RyaW5nICs9IHBhZFN0cmluZy5yZXBlYXQodGFyZ2V0TGVuZ3RoIC8gcGFkU3RyaW5nLmxlbmd0aCk7IC8vYXBwZW5kIHRvIG9yaWdpbmFsIHRvIGVuc3VyZSB3ZSBhcmUgbG9uZ2VyIHRoYW4gbmVlZGVkXHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIHBhZFN0cmluZy5zbGljZSgwLCB0YXJnZXRMZW5ndGgpICsgU3RyaW5nKHNyYyk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDop6PmnpDlrZfmrrXlkI3np7BcclxuICAgKiBAcGFyYW0gZlxyXG4gICAqIEBwYXJhbSBsYW5nQ29kZVxyXG4gICAqIEByZXR1cm5zXHJcbiAgICovXHJcbiAgcHVibGljIGdldEZpZWxkTGFiZWwoZjogQmlsbFNjaGVtYUZpZWxkIHwgQmlsbFNjaGVtYVN1YkZpZWxkLCBsYW5nQ29kZT86IHN0cmluZykge1xyXG4gICAgcmV0dXJuIChsYW5nQ29kZSAmJiBmLmkxOG5Db2xzICYmIGYuaTE4bkNvbHMuY29sSTE4blZhbHVlcy5kaXNwbGF5TmFtZSAmJlxyXG4gICAgICBmLmkxOG5Db2xzLmNvbEkxOG5WYWx1ZXMuZGlzcGxheU5hbWVbbGFuZ0NvZGVdKSB8fCBmLmRpc3BsYXlOYW1lIHx8IGYuY2FwdGlvblBhdGggfHwgZi5jYXB0aW9uXHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDop6PmnpDooajlkI3np7BcclxuICAgKi9cclxuICBwdWJsaWMgZ2V0VGFibGVMYWJlbChiaWxsSW5mbzogQmlsbEluZm8sIHNjaGVtYVRhYmxlOiBCaWxsU2NoZW1hVGFibGUsIGxhbmdDb2RlPzogc3RyaW5nKSB7XHJcbiAgICBjb25zdCBzY2hlbWEgPSB0aGlzLmdldEJpbGxUcmFja2VyU2NoZW1hKGJpbGxJbmZvKTtcclxuICAgIGxldCB0YWJsZSA9IHNjaGVtYSAmJiBzY2hlbWFbc2NoZW1hVGFibGUudGFibGVOYW1lXTtcclxuICAgIGlmICh0YWJsZSAhPSBudWxsKSB7XHJcbiAgICAgIGNvbnN0IGkxOG5Db2xzID0gdGFibGUuaTE4bkNvbHM7XHJcbiAgICAgIGNvbnN0IHRtcCA9IChsYW5nQ29kZSAmJiBpMThuQ29scyAmJiBpMThuQ29scy5jb2xJMThuVmFsdWVzLmRpc3BsYXlOYW1lICYmIGkxOG5Db2xzLmNvbEkxOG5WYWx1ZXMuZGlzcGxheU5hbWVbbGFuZ0NvZGVdKSB8fCB0YWJsZS5kaXNwbGF5TmFtZSB8fCB0YWJsZS5jYXB0aW9uIHx8IHRhYmxlLmNvZGU7XHJcbiAgICAgIHJldHVybiB0bXA7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICByZXR1cm4gc2NoZW1hVGFibGUuY2FwdGlvbjtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOiOt+WPluino+aekOWPr+WxleekuuWtkOihqFxyXG4gICAqL1xyXG4gIHB1YmxpYyBnZXRDaGlsZFRhYmxlcyhiaWxsSW5mbzogQmlsbEluZm8sIHNjaGVtYVRhYmxlOiBCaWxsU2NoZW1hVGFibGUpIHtcclxuICAgIGxldCByZXN1bHQ6IEJpbGxTY2hlbWFUYWJsZVtdID0gW107XHJcblxyXG4gICAgY29uc3Qgc2NoZW1hID0gdGhpcy5nZXRCaWxsVHJhY2tlclNjaGVtYShiaWxsSW5mbyk7XHJcbiAgICBjb25zdCBjaGlsZHJlbiA9IHNjaGVtYVRhYmxlLkdldENoaWxkVGFibGVMaXN0KCk7XHJcbiAgICBjaGlsZHJlbiAmJiBjaGlsZHJlbi5mb3JFYWNoKChjaGlsZCkgPT4ge1xyXG4gICAgICBsZXQgdHJhY2tlclRhYmxlID0gc2NoZW1hICYmIHNjaGVtYVtjaGlsZC50YWJsZU5hbWVdO1xyXG4gICAgICBpZiAodHJhY2tlclRhYmxlICE9IG51bGwgJiYgdHJhY2tlclRhYmxlLnNob3cgIT0gbnVsbCkge1xyXG4gICAgICAgIGlmICh0cmFja2VyVGFibGUuc2hvdyA9PSB0cnVlKSB7XHJcbiAgICAgICAgICBjaGlsZC5vcmRlciA9IHRyYWNrZXJUYWJsZS5vcmRlcjtcclxuICAgICAgICAgIHJlc3VsdC5wdXNoKGNoaWxkKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgLy8g5YW85a655pegc2hvd+WxnuaAp+aDheW9olxyXG4gICAgICAgIHJlc3VsdC5wdXNoKGNoaWxkKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcblxyXG4gICAgcmVzdWx0ID0gdGhpcy5zb3J0VGFibGVzQnlPcmRlcihyZXN1bHQpO1xyXG5cclxuICAgIHJldHVybiByZXN1bHQ7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDooajmjIlzb3J05a2X5q615o6S5bqPXHJcbiAgICogQHBhcmFtIHNjaGVtYVRhYmxlc1xyXG4gICAqIEByZXR1cm5zXHJcbiAgICovXHJcbiAgcHVibGljIHNvcnRUYWJsZXNCeU9yZGVyKHNjaGVtYVRhYmxlczogQmlsbFNjaGVtYVRhYmxlW10pOiBCaWxsU2NoZW1hVGFibGVbXSB7XHJcbiAgICByZXR1cm4gc2NoZW1hVGFibGVzLnNvcnQoKGEsIGIpID0+IHtcclxuICAgICAgaWYgKGEub3JkZXIgIT0gbnVsbCAmJiBiLm9yZGVyICE9IG51bGwpIHtcclxuICAgICAgICByZXR1cm4gYS5vcmRlciAtIGIub3JkZXI7XHJcbiAgICAgIH0gZWxzZSBpZiAoYS5vcmRlciAhPSBudWxsICYmIGIub3JkZXIgPT0gbnVsbCkge1xyXG4gICAgICAgIHJldHVybiAtMTtcclxuICAgICAgfSBlbHNlIGlmIChhLm9yZGVyID09IG51bGwgJiYgYi5vcmRlciAhPSBudWxsKSB7XHJcbiAgICAgICAgcmV0dXJuIDE7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgcmV0dXJuIDA7XHJcbiAgICAgIH1cclxuICAgIH0pXHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOino+aekGJpbGxUcmFja2VyU2NoZW1hXHJcbiAgICogQHBhcmFtIGJpbGxJbmZvXHJcbiAgICovXHJcbiAgcHVibGljIGdldEJpbGxUcmFja2VyU2NoZW1hKGJpbGxJbmZvOiBCaWxsSW5mbyk6IEJpbGxUcmFja2VyU2NoZW1hIHtcclxuICAgIGxldCBidHM6IEJpbGxUcmFja2luZ1NldHRpbmdzID0gbmV3IEJpbGxUcmFja2luZ1NldHRpbmdzKCk7XHJcbiAgICBpZiAoYmlsbEluZm8gJiYgYmlsbEluZm8uYmlsbFRyYWNraW5nU2V0dGluZ3MpIHtcclxuICAgICAgYnRzLkxvYWRGcm9tSnNvbihiaWxsSW5mby5iaWxsVHJhY2tpbmdTZXR0aW5ncyk7XHJcbiAgICB9XHJcblxyXG4gICAgbGV0IGZpZWxkQ29udGVudCA9IGJ0cy5jdXN0b21GaWVsZENvbnRlbnQ7XHJcbiAgICBsZXQgZmllbGRDb25maWc6IEJpbGxUcmFja2VyU2NoZW1hRmllbGRDb250ZW50ID0gZmllbGRDb250ZW50ICYmICh0eXBlb2YgZmllbGRDb250ZW50ID09IFwib2JqZWN0XCIgPyBmaWVsZENvbnRlbnQgOiBKU09OLnBhcnNlKGZpZWxkQ29udGVudCkpO1xyXG4gICAgbGV0IHNjaGVtYSA9IGZpZWxkQ29uZmlnICYmIGZpZWxkQ29uZmlnLnNjaGVtYTtcclxuXHJcbiAgICByZXR1cm4gc2NoZW1hO1xyXG4gIH1cclxufVxyXG4iXX0=
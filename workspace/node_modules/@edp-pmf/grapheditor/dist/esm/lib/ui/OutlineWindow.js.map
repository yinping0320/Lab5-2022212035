{"version":3,"file":"OutlineWindow.js","sourceRoot":"","sources":["../../../../src/lib/ui/OutlineWindow.ts"],"names":[],"mappings":"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","sourcesContent":["import { ActionKeys } from \"../action/ActionKeys\";\r\nimport { mxWindow, mxResources, mxEvent, mxOutline, mxGraph, mxUtils, mxConstants, MxGraphNS } from \"@edp-pmf/mxgraph-ts\";\r\nimport { PmfEvents } from \"../util/PmfEvents\";\r\nimport { IEditorUi } from \"./IEditorUi\";\r\n\r\n/**\r\n * mxgraph弹窗类\r\n */\r\nexport class OutlineWindow {\r\n    window: MxGraphNS.mxWindow;\r\n\r\n    constructor(editorUi: IEditorUi, x: number, y: number, w: number, h: number) {\r\n        let graph = editorUi.graph;\r\n\r\n        let div = document.createElement('div');\r\n        div.style.position = 'absolute';\r\n        div.style.width = '100%';\r\n        div.style.height = '100%';\r\n        div.style.border = '1px solid whiteSmoke';\r\n        div.style.overflow = 'hidden';\r\n\r\n        this.window = new mxWindow(mxResources.get('outline'), div, x, y, w, h, true, true);\r\n        this.window.destroyOnClose = false;\r\n        this.window.setMaximizable(false);\r\n        this.window.setResizable(true);\r\n        this.window.setClosable(true);\r\n        this.window.setVisible(true);\r\n\r\n        this.window.setLocation = (x, y) => {\r\n            let iw = window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth;\r\n            let ih = window.innerHeight || document.documentElement.clientHeight || document.body.clientHeight;\r\n\r\n            x = Math.max(0, Math.min(x, iw - this.window.table.clientWidth));\r\n            y = Math.max(0, Math.min(y, ih - this.window.table.clientHeight - 48));\r\n\r\n            if (this.window.getX() != x || this.window.getY() != y) {\r\n                mxWindow.prototype.setLocation.apply(this.window, [x, y]);\r\n            }\r\n        };\r\n\r\n        mxEvent.addListener(window, 'resize', () => {\r\n            let x = this.window.getX();\r\n            let y = this.window.getY();\r\n\r\n            this.window.setLocation(x, y);\r\n        });\r\n\r\n        let outline = new mxOutline(editorUi.graph);\r\n        outline.border = 20;\r\n\r\n        mxEvent.addListener(window, 'resize', () => {\r\n            outline.update();\r\n        });\r\n\r\n        editorUi.addListener('pageFormatChanged', () => {\r\n            outline.update();\r\n        });\r\n\r\n        editorUi.addListener(PmfEvents.ResizeGraphView, () => {\r\n            outline.update();\r\n        });\r\n\r\n        this.window.addListener(mxEvent.RESIZE, () => {\r\n            outline.update(false);\r\n            outline.outline.sizeDidChange();\r\n        });\r\n\r\n        this.window.addListener(mxEvent.SHOW, () => {\r\n            outline.suspended = false;\r\n            outline.outline.refresh();\r\n            outline.update();\r\n        });\r\n\r\n        this.window.addListener(mxEvent.HIDE, () => {\r\n            outline.suspended = true;\r\n        });\r\n\r\n        this.window.addListener(mxEvent.NORMALIZE, () => {\r\n            outline.suspended = false;\r\n            outline.update();\r\n        });\r\n\r\n        this.window.addListener(mxEvent.MINIMIZE, () => {\r\n            outline.suspended = true;\r\n        });\r\n\r\n        let outlineCreateGraph = outline.createGraph;\r\n        outline.createGraph = (container: HTMLDivElement) => {\r\n            let g: MxGraphNS.mxGraph = outlineCreateGraph.apply(outline, [container]);\r\n            g.gridEnabled = false;\r\n            g.pageScale = graph.pageScale;\r\n            g.pageFormat = graph.pageFormat;\r\n            g.background = graph.background;\r\n            g.pageVisible = graph.pageVisible;\r\n\r\n            let current: CSSStyleDeclaration = mxUtils.getCurrentStyle(graph.container);\r\n            div.style.backgroundColor = current.backgroundColor;\r\n\r\n            return g;\r\n        };\r\n\r\n        const update = () => {\r\n            outline.outline.pageScale = graph.pageScale;\r\n            outline.outline.pageFormat = graph.pageFormat;\r\n            outline.outline.pageVisible = graph.pageVisible;\r\n            outline.outline.background = graph.background;\r\n\r\n            let current = mxUtils.getCurrentStyle(graph.container);\r\n            div.style.backgroundColor = current.backgroundColor;\r\n\r\n            if (graph.view.backgroundPageShape != null && outline.outline.view.backgroundPageShape != null) {\r\n                outline.outline.view.backgroundPageShape.fill = graph.view.backgroundPageShape.fill;\r\n            }\r\n\r\n            outline.outline.refresh();\r\n        }\r\n\r\n        outline.init(div);\r\n\r\n        editorUi.addListener('resetGraphView', update);\r\n        editorUi.addListener('pageFormatChanged', update);\r\n        editorUi.addListener('backgroundColorChanged', update);\r\n        editorUi.addListener('backgroundImageChanged', update);\r\n        editorUi.addListener('pageViewChanged', () => {\r\n            update();\r\n            outline.update(true);\r\n        });\r\n\r\n        if (outline.outline.dialect == mxConstants.DIALECT_SVG) {\r\n            let zoomInAction = editorUi.actions.getAction(ActionKeys.pmf_zoomIn);\r\n            let zoomOutAction = editorUi.actions.getAction(ActionKeys.pmf_zoomOut);\r\n\r\n            mxEvent.addMouseWheelListener((evt: Event, up: boolean) => {\r\n                let outlineWheel = false;\r\n                let source: Node = mxEvent.getSource(evt);\r\n\r\n                while (source != null) {\r\n                    if (source == outline.outline.view.canvas.ownerSVGElement) {\r\n                        outlineWheel = true;\r\n                        break;\r\n                    }\r\n\r\n                    source = source.parentNode;\r\n                }\r\n\r\n                if (outlineWheel) {\r\n                    if (up) {\r\n                        zoomInAction.execute();\r\n                    }\r\n                    else {\r\n                        zoomOutAction.execute();\r\n                    }\r\n\r\n                    mxEvent.consume(evt);\r\n                }\r\n            });\r\n        }\r\n    }\r\n}"]}
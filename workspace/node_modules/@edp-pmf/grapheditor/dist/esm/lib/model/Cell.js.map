{"version":3,"file":"Cell.js","sourceRoot":"","sources":["../../../../src/lib/model/Cell.ts"],"names":[],"mappings":"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","sourcesContent":["import { BPMNDiagram, BpmnModelHelper, BPMNPlane, DiagramElement, FlowElement } from \"@edp-pmf/bpmn-model\";\r\nimport { mxCell, mxEventObject, MxGraphNS, mxResources } from \"@edp-pmf/mxgraph-ts\";\r\nimport { IEditorUi } from \"../ui/IEditorUi\";\r\nimport { PmfEvents } from \"../util/PmfEvents\";\r\nimport { ElementPropertyConfig } from \"./farris-property-config/ElementPropertyConfig\";\r\nimport { FarrisPropConfigWithData } from \"./farris-property-config/FarrisPropConfigWithData\";\r\nimport { IFarrisPropertyPanelOperation } from \"./farris-property-config/IFarrisPropertyPanelOperation\";\r\n\r\n/**\r\n * 画布元素类，分为边和节点两种\r\n */\r\nexport abstract class Cell extends mxCell implements IFarrisPropertyPanelOperation {\r\n    /**\r\n     * 名称，目前已支持多语名称，此值目前表示默认名称，即中文简体下的名称\r\n     */\r\n    abstract name: string;\r\n    /**\r\n     * 多语名称\r\n     */\r\n    nameLanguage: { [lang: string]: string };\r\n    /**\r\n     * 类型ID\r\n     */\r\n    abstract clrTypeId: string;\r\n    /**\r\n     * 流程元素\r\n     */\r\n    flowElement: FlowElement;\r\n    /**\r\n     * 图元素\r\n     */\r\n    diagramElement: DiagramElement & { BpmnElementId: string };\r\n    /**\r\n     * editorUi\r\n     */\r\n    editorUi: IEditorUi;\r\n\r\n    constructor(value?: any, geometry?: MxGraphNS.mxGeometry, style?: string) {\r\n        super(value, geometry, style);\r\n    }\r\n\r\n    /**\r\n     * 实例化FlowElement与DiagramElement，并绑定至BpmnModel\r\n     * @param bpmnModel \r\n     */\r\n    bindBpmnModel(flowElt?: FlowElement, diagElt?: DiagramElement & { BpmnElementId: string }): any {\r\n        const bpmnModel = this.editorUi.graph.bpmnModel;\r\n\r\n        this.flowElement = this.createFlowElement(flowElt);\r\n        this.diagramElement = this.createDiagramElement(diagElt);\r\n\r\n        // diagElt与flowElt绑定\r\n        this.diagramElement.BpmnElementId = this.flowElement.Id;\r\n        // 添加到BpmnModel\r\n        bpmnModel.DefaultProcess.AddFlowElement(this.flowElement);\r\n        bpmnModel.DefaultDiagram.BpmnPlane.AddDiagramElement(this.diagramElement);\r\n    }\r\n\r\n    /**\r\n     * 与BpmnModel脱钩，从Process和Diagram删除元素\r\n     * @param bpmnModel \r\n     */\r\n    unbindBpmnModel(): any {\r\n        if (this.flowElement == null) {\r\n            return;\r\n        }\r\n        this.flowElement.Model.DefaultProcess.RemoveFlowElement(this.flowElement.Id);\r\n        this.flowElement.Model.DefaultDiagram.BpmnPlane.RemoveDiagramElement(this.diagramElement.Id);\r\n    }\r\n\r\n    /**\r\n     * 实例化FlowElement,flowElt不为空时值为复制后的流程元素\r\n     * @param flowElt \r\n     */\r\n    abstract createFlowElement(flowElt?: FlowElement): FlowElement;\r\n\r\n    /**\r\n     * 实例化DiagramElement,diagElt不为空时值为复制后的图元素\r\n     * @param diagElt \r\n     */\r\n    abstract createDiagramElement(diagElt?: DiagramElement & { BpmnElementId: string }): DiagramElement & { BpmnElementId: string };\r\n\r\n    clone() {\r\n        // 为保证clone方法顺利执行，临时删除editorUi与bpmn属性\r\n        const tmpFlowElt = this.flowElement;\r\n        const tmpDiagElt = this.diagramElement;\r\n        const tmpEditorUi = this.editorUi;\r\n        delete this.flowElement;\r\n        delete this.diagramElement;\r\n        delete this.editorUi;\r\n\r\n        const clone: Cell = super.clone();\r\n        // 恢复bpmn属性\r\n        this.flowElement = tmpFlowElt;\r\n        this.diagramElement = tmpDiagElt;\r\n        this.editorUi = tmpEditorUi;\r\n\r\n        // 克隆bpmn属性\r\n        if (tmpFlowElt) {\r\n            const b = this.cloneFlowElement(tmpFlowElt);\r\n            clone.flowElement = b;\r\n        }\r\n        if (tmpDiagElt) {\r\n            const d = this.cloneDiagramElement(tmpDiagElt);\r\n            d.BpmnElementId = clone.flowElement.Id;\r\n\r\n            clone.diagramElement = d;\r\n        }\r\n        if (tmpEditorUi) {\r\n            clone.editorUi = tmpEditorUi;\r\n        }\r\n        return clone;\r\n    }\r\n\r\n    /**\r\n     * 克隆FlowElement\r\n     * @param flowElt \r\n     * @returns \r\n     */\r\n    cloneFlowElement(flowElt: FlowElement) {\r\n        const b = flowElt.clone();\r\n        return b;\r\n    }\r\n\r\n    /**\r\n     * 克隆DiagramElement\r\n     * @param diagElt \r\n     * @returns \r\n     */\r\n    cloneDiagramElement(diagElt: DiagramElement) {\r\n        const d = diagElt.NewInstance() as DiagramElement & { BpmnElementId: string };\r\n        d.LoadFromJsonObject(diagElt.ConvertToJsonObject());\r\n        d.Id = BpmnModelHelper.GenerateElementId();\r\n\r\n        return d;\r\n    }\r\n\r\n    /**\r\n     * 获取属性配置\r\n     */\r\n    getPropConfig(): any {\r\n        return {};\r\n    }\r\n\r\n    /**\r\n     * 获取属性配置（Farris属性框专用）\r\n     */\r\n    getFarrisPropConfig() {\r\n        const configWithData = new FarrisPropConfigWithData();\r\n\r\n        const propertyConfig: ElementPropertyConfig = new ElementPropertyConfig();\r\n        configWithData.propertyConfig.push(propertyConfig);\r\n\r\n        propertyConfig.categoryId = 'general';\r\n        propertyConfig.categoryName = mxResources.get(\"Basic Info\") || '基本信息';\r\n        propertyConfig.tabId = 'basic';\r\n        propertyConfig.tabName = mxResources.get(\"Basic Property\") || '基础属性'\r\n        propertyConfig.properties = [\r\n            { propertyID: 'Name', propertyName: mxResources.get(\"Property Name\") || '名称', propertyType: 'string', visible: !this.editorUi.multiLangEnabled },\r\n            { propertyID: \"NameLanguage\", propertyName: mxResources.get(\"Property Name\") || '名称', propertyType: 'multiLanguage', visible: this.editorUi.multiLangEnabled },\r\n            { propertyID: 'Id', propertyName: mxResources.get(\"Property Id\") || '标识', propertyType: 'string', readonly: true }\r\n        ];\r\n\r\n        configWithData.propertyData = {\r\n            Id: this.flowElement.Id,\r\n            Name: this.flowElement.Name,\r\n            ClrTypeId: this.flowElement.ClrTypeID,\r\n            ClrTypeID: this.flowElement.ClrTypeID,\r\n            // 没有NameLanguage时把Name作为中文简体值\r\n            NameLanguage: this.flowElement.NameLanguage || {\r\n                [this.editorUi.langCode || \"zh-CHS\"]: this.flowElement.Name,\r\n            }\r\n        };\r\n\r\n        return configWithData;\r\n    }\r\n\r\n    /**\r\n     * 更新属性\r\n     */\r\n    updateProps(obj: any): any {\r\n        this.flowElement[obj.propertyID] = obj.propertyValue;\r\n        if (obj.propertyID == \"NameLanguage\") {\r\n            this.flowElement.Name = this.flowElement.NameLanguage && this.flowElement.NameLanguage['zh-CHS'] || \"\";\r\n        }\r\n        if (obj.propertyID == \"NameLanguage\" || obj.propertyID == \"Name\") {\r\n            this.editorUi.fireEvent(new mxEventObject(PmfEvents.NameChanged, \"cell\", this));\r\n        }\r\n    }\r\n}"]}
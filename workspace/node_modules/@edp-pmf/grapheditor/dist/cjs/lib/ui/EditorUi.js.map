{"version":3,"file":"EditorUi.js","sourceRoot":"","sources":["../../../../src/lib/ui/EditorUi.ts"],"names":[],"mappings":"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","sourcesContent":["import { Actions } from \"../action/Actions\";\r\nimport { NodeCell } from \"../model/NodeCell\";\r\nimport { mxEventSource, mxClient, mxPoint, mxPopupMenu, mxEvent, mxEventObject, mxResources, mxUtils, mxConstants, mxGuide, mxPolyline, mxRubberband, mxClipboard, mxCell, MxGraphNS } from \"@edp-pmf/mxgraph-ts\";\r\nimport { DefaultToolbarItems } from \"../toolbar/DefaultToolbarItems\";\r\nimport { ToolbarItems } from \"../toolbar/ToolbarItems\";\r\nimport { DefaultToolbox } from \"../toolbox/DefaultToolBox\";\r\nimport { Toolbox } from \"../toolbox/ToolBox\";\r\nimport { PmfEvents } from \"../util/PmfEvents\";\r\nimport { Footer } from \"./Footer\";\r\nimport { Format } from \"./Format\";\r\nimport { Graph } from \"./Graph\";\r\nimport { KeyHandler } from \"./KeyHandler\";\r\nimport { Menubar } from \"./Menubar\";\r\nimport { Sidebar } from \"./Sidebar\";\r\nimport { Toolbar } from \"./Toolbar\";\r\nimport { IEditorUi } from \"./IEditorUi\";\r\nimport { MxGraphInnerClass } from \"../util/MxGraphInnerClass\";\r\nimport { EdgeCell } from \"../model/EdgeCell\";\r\nimport { Cell } from \"../model/Cell\";\r\nimport { ActionKeys } from \"../action/ActionKeys\";\r\nimport { Utils } from \"../util/Utils\";\r\nimport { FlowElement, FlowNode } from \"@edp-pmf/bpmn-model\";\r\n\r\n/**\r\n * 设计器统一入口，持有各部分组件实例，可触发以及响应事件\r\n */\r\nexport class EditorUi extends mxEventSource implements IEditorUi {\r\n    /**\r\n     * 菜单栏高度\r\n     */\r\n    menubarHeight: number = 30;\r\n    /**\r\n     * 工具栏高度\r\n     */\r\n    toolbarHeight: number = 34;\r\n    /**\r\n     * 属性框宽度\r\n     */\r\n    formatWidth: number = 240;\r\n    /**\r\n     * 底部栏高度\r\n     */\r\n    footerHeight: number = 28;\r\n    /**\r\n     * 分割条位置\r\n     */\r\n    sidebarSplitPosition: number = (screen.width <= 640) ? 118 : 243;\r\n    /**\r\n     * 分割条宽度\r\n     */\r\n    sidebarSplitSize: number = (mxClient.IS_TOUCH || mxClient.IS_POINTER) ? 12 : 8;\r\n    /**\r\n     * 画布最小宽度\r\n     */\r\n    diagramMinWidth: number = 50;\r\n    /**\r\n     * 侧边栏底部栏高度\r\n     */\r\n    sidebarFooterHeight: number = 34;\r\n    /**\r\n     * 0偏移量\r\n     */\r\n    zeroOffset = new mxPoint(0, 0);\r\n\r\n    /**\r\n     * 是否显示菜单栏\r\n     */\r\n    showMenubar: boolean = false;\r\n    /**\r\n     * 是否显示工具栏\r\n     */\r\n    showToolbar: boolean = false;\r\n    /**\r\n     * 是否显示侧边栏\r\n     */\r\n    showSidebar: boolean = true;\r\n    /**\r\n     * 是否显示属性框\r\n     */\r\n    showFormat: boolean = false;\r\n    /**\r\n     * 是否显示底部栏\r\n     */\r\n    showFooter: boolean = false;\r\n\r\n    /**\r\n     * 菜单栏\r\n     */\r\n    menubar: Menubar;\r\n    /**\r\n     * 工具栏\r\n     */\r\n    toolbar: Toolbar;\r\n    /**\r\n     * 侧边栏\r\n     */\r\n    sidebar: Sidebar;\r\n    /**\r\n     * 工具箱\r\n     */\r\n    toolbox: Toolbox;\r\n    /**\r\n     * 画布\r\n     */\r\n    graph: Graph;\r\n    /**\r\n     * 属性框\r\n     */\r\n    format: Format;\r\n    /**\r\n     * 底部栏\r\n     */\r\n    footer: Footer;\r\n    /**\r\n     * 动作列表\r\n     */\r\n    actions: Actions;\r\n    /**\r\n     * 工具栏列表\r\n     */\r\n    toolbarItems: ToolbarItems;\r\n\r\n    /**\r\n     * 快捷键处理器\r\n     */\r\n    keyHandler: KeyHandler;\r\n\r\n    /**\r\n     * 总容器\r\n     */\r\n    container: HTMLElement;\r\n    /**\r\n     * 菜单栏容器\r\n     */\r\n    menubarContainer: HTMLDivElement;\r\n    /**\r\n     * 工具栏容器\r\n     */\r\n    toolbarContainer: HTMLDivElement;\r\n    /**\r\n     * 侧边栏容器\r\n     */\r\n    sidebarContainer: HTMLDivElement;\r\n    /**\r\n     * 侧边栏底部容器\r\n     */\r\n    sidebarFooterContainer: HTMLDivElement;\r\n    /**\r\n     * 分割条\r\n     */\r\n    sidebarSplit: HTMLDivElement;\r\n    /**\r\n     * 画布容器\r\n     */\r\n    diagramContainer: HTMLDivElement;\r\n    /**\r\n     * 属性框容器\r\n     */\r\n    formatContainer: HTMLDivElement;\r\n    /**\r\n     * 底部栏容器\r\n     */\r\n    footerContainer: HTMLDivElement;\r\n\r\n    /**\r\n     * 组件销毁方法列表\r\n     */\r\n    destroyFunctions: any = [];\r\n\r\n    /**\r\n     * 当前菜单DOM元素\r\n     */\r\n    currentMenuElt: HTMLAnchorElement;\r\n    /**\r\n     * 当前菜单\r\n     */\r\n    currentMenu: MxGraphNS.mxPopupMenu;\r\n    /**\r\n     * 鼠标点击非当前菜单位置时，关闭已显示的菜单\r\n     */\r\n    gestureHandler: (evt: PointerEvent) => void;\r\n\r\n    /**\r\n     * 窗口大小变化时触发，刷新界面\r\n     */\r\n    resizeHandler: () => void;\r\n    /**\r\n     * Delete按键处理器\r\n     */\r\n    deleteKeyHandler: (evt: KeyboardEvent) => void;\r\n    /**\r\n     * 是否启用多语\r\n     */\r\n    multiLangEnabled: boolean = false;\r\n    /**\r\n     * 当前语言，尝试从igix运行框架取当前语言，没有则取zh-CHS\r\n     */\r\n    langCode: string = window.gspframeworkService && window.gspframeworkService.rtf && window.gspframeworkService.rtf.language && window.gspframeworkService.rtf.language.getLanguageCode && window.gspframeworkService.rtf.language.getLanguageCode() || localStorage.getItem('languageCode') || 'zh-CHS';\r\n\r\n    /**\r\n     * 构造方法\r\n     * @param container 容器dom，没有则去body\r\n     * @param eventSource 事件源\r\n     * @param importLinks 是否引入内置样式文件，默认为true\r\n     */\r\n    constructor(container?: HTMLElement, eventSource?: any, importLinks: boolean = true) {\r\n        super(eventSource);\r\n\r\n        this.container = container || document.body;\r\n        importLinks && this.importStyles();\r\n    }\r\n\r\n    /**\r\n     * 引入内置样式文件\r\n     */\r\n    importStyles() {\r\n        const link1 = document.createElement(\"link\");\r\n        link1.rel = \"stylesheet\";\r\n        link1.href = (window.mxiGIXBasePath ? window.mxiGIXBasePath : \"\") + \"/platform/runtime/common/web/@edp-pmf/grapheditor/styles/grapheditor.css?v=\" + new Date().getTime();\r\n        document.head.appendChild(link1);\r\n\r\n        const link2 = document.createElement(\"link\");\r\n        link2.rel = \"stylesheet\";\r\n        link2.href = (window.mxiGIXBasePath ? window.mxiGIXBasePath : \"\") + \"/platform/runtime/common/web/@edp-pmf/grapheditor/styles/pmf.css?v=\" + new Date().getTime();\r\n        document.head.appendChild(link2);\r\n    }\r\n\r\n    /**\r\n     * 修改属性\r\n     * @param obj 至少要包含属性标识propertyID，属性值propertyValue和元素标识Id三个属性，元素标识Id可以为空，为空表示修改的是流程属性\r\n     */\r\n    updateProperty(obj: { propertyID: string; propertyValue: any; Id: string;[key: string]: any }) {\r\n        const cell = this.graph.getCellByFlowElementId(obj.Id);\r\n        if (cell) {\r\n            cell.updateProps(obj);\r\n        } else {\r\n            this.graph.processCell.updateProps(obj);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 获取属性配置\r\n     * @param cells \r\n     * @returns \r\n     */\r\n    getFarrisPropConfig(cells?: Cell[]) {\r\n        if (cells && cells.length > 0 && cells[0] != null) {\r\n            const cell = cells[0];\r\n            return this.getCellFarrisPropConfig(cell);\r\n        } else {\r\n            return this.getProcessFarrisPropConfig();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 获取流程属性配置\r\n     */\r\n    getProcessFarrisPropConfig() {\r\n        return this.graph.processCell.getFarrisPropConfig();\r\n    }\r\n\r\n    /**\r\n     * 获取节点属性配置\r\n     * @param cell \r\n     * @returns \r\n     */\r\n    getCellFarrisPropConfig(cell: Cell) {\r\n        return cell.getFarrisPropConfig();\r\n    }\r\n\r\n    /**\r\n     * 显示EditorUI\r\n     */\r\n    show() {\r\n        this.createDivs();\r\n        this.refresh(false);\r\n\r\n        this.graph = this.createGraph();\r\n        this.keyHandler = this.createKeyHandler(this.graph);\r\n        this.actions = this.createActions();\r\n        this.toolbarItems = this.createToolbarItems();\r\n\r\n        if (this.showMenubar) {\r\n            this.menubar = this.createMenubar();\r\n        }\r\n        if (this.showToolbar) {\r\n            this.toolbar = this.createToolbar();\r\n        }\r\n        if (this.showSidebar) {\r\n            this.sidebar = this.createSidebar();\r\n        }\r\n        if (this.showFormat) {\r\n            this.format = this.createFormat();\r\n        }\r\n        if (this.showFooter) {\r\n            this.footer = this.createFooter();\r\n        }\r\n\r\n        this.resetToolbar(this.toolbarItems);\r\n        this.resetToolbox();\r\n\r\n        // 禁用右键快捷菜单\r\n        mxEvent.disableContextMenu(this.container);\r\n\r\n        // 点击非当前菜单位置时关闭菜单\r\n        this.gestureHandler = (evt: PointerEvent) => {\r\n            if (this.currentMenu != null && mxEvent.getSource(evt) != this.currentMenu.div) {\r\n                this.hideCurrentMenu();\r\n            }\r\n        };\r\n        mxEvent.addGestureListeners(document, this.gestureHandler);\r\n\r\n        this.resizeHandler = () => {\r\n            window.setTimeout(() => {\r\n                if (this.graph != null) {\r\n                    this.refresh();\r\n                }\r\n            }, 0);\r\n        };\r\n        mxEvent.addListener(window, 'resize', this.resizeHandler);\r\n\r\n        this.addListener(PmfEvents.ResetGraphView, () => {\r\n            this.resetScrollbars();\r\n        });\r\n        this.fireEvent(new mxEventObject(PmfEvents.ResetGraphView));\r\n\r\n        this.addBpmnListeners();\r\n    }\r\n\r\n    /**\r\n     * 刷新\r\n     * @param sizeDidChange \r\n     */\r\n    refresh(sizeDidChange: boolean = true): void {\r\n        const quirks: boolean = mxClient.IS_QUIRKS;\r\n        let w: number = this.container.clientWidth;\r\n        let h: number = this.container.clientHeight;\r\n\r\n        if (this.container == document.body) {\r\n            w = document.body.clientWidth || document.documentElement.clientWidth;\r\n            h = (quirks) ? document.body.clientHeight || document.documentElement.clientHeight : document.documentElement.clientHeight;\r\n        }\r\n\r\n        // Workaround for bug on iOS see\r\n        // http://stackoverflow.com/questions/19012135/ios-7-ipad-safari-landscape-innerheight-outerheight-layout-issue\r\n        // FIXME: Fix if footer visible\r\n        let off: number = 0;\r\n\r\n        if (mxClient.IS_IOS && !window.navigator.standalone) {\r\n            if (window.innerHeight != document.documentElement.clientHeight) {\r\n                off = document.documentElement.clientHeight - window.innerHeight;\r\n                window.scrollTo(0, 0);\r\n            }\r\n        }\r\n\r\n        const menubarContainerHeight = this.showMenubar ? this.menubarHeight : 0;\r\n        const toolbarContainerHeight = this.showToolbar ? this.toolbarHeight : 0;\r\n        const formatContainerWidth = this.showFooter ? this.formatWidth : 0;\r\n        const footerContainerHeight = this.showFooter ? this.footerHeight : 0;\r\n\r\n        let tmp = 0;\r\n\r\n        this.menubarContainer.style.height = menubarContainerHeight + 'px';\r\n        tmp += menubarContainerHeight;\r\n\r\n        this.toolbarContainer.style.top = menubarContainerHeight + 'px';\r\n        this.toolbarContainer.style.height = toolbarContainerHeight + 'px';\r\n        tmp += toolbarContainerHeight;\r\n\r\n        if (tmp > 0 && !mxClient.IS_QUIRKS) {\r\n            tmp += 1;\r\n        }\r\n\r\n        const effectSidebarSplitPosition: number = Math.max(0, Math.min(this.sidebarSplitPosition, w - this.sidebarSplitSize - 20));\r\n\r\n        if (this.showSidebar) {\r\n            this.sidebarContainer.style.top = tmp + 'px';\r\n            this.sidebarContainer.style.width = effectSidebarSplitPosition + 'px';\r\n\r\n            this.sidebarSplit.style.top = this.sidebarContainer.style.top;\r\n            this.sidebarSplit.style.bottom = (footerContainerHeight + off) + 'px';\r\n            this.sidebarSplit.style.left = effectSidebarSplitPosition + 'px';\r\n        }\r\n\r\n        this.diagramContainer.style.left = (this.sidebarSplit.parentNode != null) && this.showSidebar ? (effectSidebarSplitPosition + this.sidebarSplitSize) + 'px' : '0px';\r\n        this.diagramContainer.style.top = tmp + 'px';\r\n\r\n        this.formatContainer.style.top = tmp + 'px';\r\n        this.formatContainer.style.width = formatContainerWidth + 'px';\r\n\r\n        this.footerContainer.style.height = footerContainerHeight + \"px\";\r\n\r\n        if (quirks) {\r\n            this.menubarContainer.style.width = w + 'px';\r\n            this.toolbarContainer.style.width = this.menubarContainer.style.width;\r\n            const sidebarHeight = Math.max(0, h - footerContainerHeight - menubarContainerHeight - this.toolbarHeight);\r\n            this.sidebarContainer.style.height = sidebarHeight + 'px';\r\n            this.formatContainer.style.height = sidebarHeight + 'px';\r\n            this.diagramContainer.style.width = (this.sidebarSplit.parentNode != null) ? Math.max(0, w - effectSidebarSplitPosition - this.sidebarSplitSize - formatContainerWidth) + 'px' : w + 'px';\r\n            this.footerContainer.style.width = this.menubarContainer.style.width;\r\n            const diagramHeight = Math.max(0, h - footerContainerHeight - menubarContainerHeight - this.toolbarHeight);\r\n\r\n            this.diagramContainer.style.height = diagramHeight + 'px';\r\n            this.sidebarSplit.style.height = diagramHeight + 'px';\r\n        }\r\n        else {\r\n            if (footerContainerHeight > 0) {\r\n                this.footerContainer.style.bottom = off + 'px';\r\n            }\r\n\r\n            this.diagramContainer.style.right = formatContainerWidth + 'px';\r\n\r\n            this.sidebarContainer.style.bottom = (footerContainerHeight + off) + 'px';\r\n            this.formatContainer.style.bottom = (footerContainerHeight + off) + 'px';\r\n            this.diagramContainer.style.bottom = (footerContainerHeight + off) + 'px';\r\n        }\r\n\r\n        if (sizeDidChange && this.graph != null) {\r\n            this.graph.sizeDidChange();\r\n            this.fireEvent(new mxEventObject(PmfEvents.ResizeGraphView));\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 创建各容器div\r\n     */\r\n    createDivs() {\r\n        this.menubarContainer = this.createDiv('geMenubarContainer');\r\n        this.menubarContainer.style.top = '0px';\r\n        this.menubarContainer.style.left = '0px';\r\n        this.menubarContainer.style.right = '0px';\r\n        this.container.appendChild(this.menubarContainer);\r\n\r\n        this.toolbarContainer = this.createDiv('geToolbarContainer');\r\n        this.toolbarContainer.style.left = '0px';\r\n        this.toolbarContainer.style.right = '0px';\r\n        this.container.appendChild(this.toolbarContainer);\r\n\r\n        this.sidebarContainer = this.createDiv('geSidebarContainer');\r\n        this.sidebarContainer.style.left = '0px';\r\n        this.container.appendChild(this.sidebarContainer);\r\n\r\n        this.sidebarSplit = this.createDiv('geHsplit');\r\n        this.sidebarSplit.setAttribute('title', mxResources.get('collapseExpand'));\r\n        this.sidebarSplit.style.width = this.sidebarSplitSize + 'px';\r\n        this.addSplitHandler(this.sidebarSplit, true, 0, (value) => {\r\n            this.sidebarSplitOnChange(value);\r\n        });\r\n        this.container.appendChild(this.sidebarSplit);\r\n\r\n        this.diagramContainer = this.createDiv('geDiagramContainer');\r\n        this.diagramContainer.style.right = (this.showFormat ? this.formatWidth : 0) + 'px';\r\n        this.diagramContainer.style.overflow = \"auto\";\r\n        this.container.appendChild(this.diagramContainer);\r\n\r\n        this.formatContainer = this.createDiv('geSidebarContainer');\r\n        this.formatContainer.style.right = '0px';\r\n        this.formatContainer.style.zIndex = '1';\r\n        this.formatContainer.style.backgroundColor = 'whiteSmoke';\r\n        this.formatContainer.style.overflowX = 'hidden';\r\n        this.formatContainer.style.overflowY = 'auto';\r\n        this.formatContainer.style.fontSize = '12px';\r\n        this.container.appendChild(this.formatContainer);\r\n\r\n        this.footerContainer = this.createDiv('geFooterContainer');\r\n        this.footerContainer.style.left = '0px';\r\n        this.footerContainer.style.right = '0px';\r\n        this.footerContainer.style.bottom = '0px';\r\n        this.footerContainer.style.zIndex = (mxPopupMenu.prototype.zIndex - 2).toString();\r\n        this.container.appendChild(this.footerContainer);\r\n    }\r\n\r\n    /**\r\n     * 创建带指定样式类的div\r\n     * @param classname \r\n     * @returns \r\n     */\r\n    createDiv(classname: string): HTMLDivElement {\r\n        const elt = document.createElement('div');\r\n        elt.className = classname;\r\n\r\n        return elt;\r\n    }\r\n\r\n    /**\r\n     * 添加分割条处理器\r\n     * @param elt \r\n     * @param horizontal \r\n     * @param dx \r\n     * @param onChange \r\n     */\r\n    addSplitHandler(elt: HTMLDivElement, horizontal: boolean, dx: number, onChange: (value: number) => void) {\r\n        onChange = mxUtils.bind(this, onChange);\r\n\r\n        let start: MxGraphNS.mxPoint | null;\r\n        let initial: number | null;\r\n        let ignoreClick = true;\r\n        let last: number | null;\r\n\r\n        // Disables built-in pan and zoom in IE10 and later\r\n        if (mxClient.IS_POINTER) {\r\n            elt.style.touchAction = 'none';\r\n        }\r\n\r\n        const getValue = (): number => {\r\n            let result = parseInt(((horizontal) ? elt.style.left : elt.style.bottom));\r\n\r\n            if (!horizontal) {\r\n                result = result + dx - this.footerHeight;\r\n            }\r\n\r\n            return result;\r\n        }\r\n\r\n        const clickHandler = (evt: PointerEvent): void => {\r\n            if (!ignoreClick) {\r\n                const next = (last != null) ? last - dx : 0;\r\n                last = getValue();\r\n                onChange(next);\r\n                mxEvent.consume(evt);\r\n            }\r\n        }\r\n\r\n        const startHandler = (evt: PointerEvent): void => {\r\n            start = new mxPoint(mxEvent.getClientX(evt), mxEvent.getClientY(evt));\r\n            initial = getValue();\r\n            ignoreClick = false;\r\n            mxEvent.consume(evt);\r\n        }\r\n\r\n        const moveHandler = (evt: PointerEvent): void => {\r\n            if (start != null) {\r\n                const pt = new mxPoint(mxEvent.getClientX(evt), mxEvent.getClientY(evt));\r\n                onChange(Math.max(0, (initial == null ? 0 : initial) + ((horizontal) ? (pt.x - start.x) : (start.y - pt.y)) - dx));\r\n                mxEvent.consume(evt);\r\n\r\n                if (initial != getValue()) {\r\n                    ignoreClick = true;\r\n                    last = null;\r\n                }\r\n            }\r\n        };\r\n\r\n        const dropHandler = (evt: PointerEvent): void => {\r\n            moveHandler(evt);\r\n            initial = null;\r\n            start = null;\r\n        }\r\n\r\n        mxEvent.addListener(elt, 'click', clickHandler);\r\n        mxEvent.addGestureListeners(elt, startHandler, null, null);\r\n        mxEvent.addGestureListeners(document, null, moveHandler, dropHandler);\r\n    }\r\n\r\n    /**\r\n     * 分割条移动后刷新界面\r\n     * @param value \r\n     */\r\n    sidebarSplitOnChange(value: number): void {\r\n        // 分割条不可超过画布最小宽度\r\n        if (this.container.clientWidth - value <= this.formatWidth + this.sidebarSplitSize + this.diagramMinWidth) {\r\n            return;\r\n        }\r\n        this.sidebarSplitPosition = value;\r\n        this.refresh();\r\n    }\r\n\r\n    /**\r\n     * 获取画布容器偏移量\r\n     * @returns \r\n     */\r\n    getDiagramContainerOffset() {\r\n        return this.zeroOffset;\r\n    }\r\n\r\n    /**\r\n     * 创建画布\r\n     * @returns \r\n     */\r\n    createGraph(): Graph {\r\n        this.beforeCreateGraph();\r\n        const graph = this.createGraphInstance();\r\n        this.afterCreateGraph(graph);\r\n\r\n        return graph;\r\n    }\r\n\r\n    /**\r\n     * 创建画布前\r\n     */\r\n    beforeCreateGraph() {\r\n        mxConstants.DEFAULT_VALID_COLOR = '#FFFFFF';\r\n        mxConstants.VALID_COLOR = '#00CD66';\r\n        // 引导线颜色\r\n        mxConstants.GUIDE_COLOR = '#0088cf';\r\n        // 选中高亮框宽度\r\n        mxConstants.HIGHLIGHT_STROKEWIDTH = 1;\r\n        //设置节点选中线框宽度\r\n        mxConstants.VERTEX_SELECTION_STROKEWIDTH = 1;\r\n        mxConstants.VERTEX_SELECTION_COLOR = '#0000CD';\r\n        mxConstants.VERTEX_SELECTION_DASHED = true;\r\n        mxGuide.prototype.createGuideShape = (horizontal: boolean) => {\r\n            const guide = new mxPolyline([], mxConstants.GUIDE_COLOR, mxConstants.GUIDE_STROKEWIDTH);\r\n\r\n            return guide;\r\n        };\r\n    }\r\n\r\n    /**\r\n     * 创建画布实例\r\n     */\r\n    createGraphInstance(): Graph {\r\n        const graph = new Graph(this, this.diagramContainer);\r\n\r\n        return graph;\r\n    }\r\n\r\n    /**\r\n     * 创建画布后\r\n     * @param graph \r\n     */\r\n    afterCreateGraph(graph: Graph) {\r\n        new mxRubberband(graph);\r\n\r\n        graph.setDropEnabled(true);\r\n        graph.setConnectable(true);\r\n\r\n        // 设置画布容器dom可以获得焦点\r\n        graph.container.setAttribute('tabindex', '0');\r\n\r\n        //选中元素变更后出发EditorUI选中模型变更事件，修改action状态\r\n        graph.getSelectionModel().addListener(mxEvent.CHANGE, (sender: Graph, evt: MxGraphNS.mxEventObject) => {\r\n            this.fireEvent(new mxEventObject(PmfEvents.SelectionModelChanged));\r\n        });\r\n\r\n        // 保证鼠标按下时焦点一直是画布容器\r\n        const graphFireMouseEvent = graph.fireMouseEvent;\r\n        graph.fireMouseEvent = (evtName, me, sender) => {\r\n            if (evtName == mxEvent.MOUSE_DOWN) {\r\n                graph.container.focus();\r\n            }\r\n\r\n            graphFireMouseEvent.apply(graph, [evtName, me, sender]);\r\n        };\r\n\r\n        // 创建无限大画布\r\n        graph.createInfiniteCanvas();\r\n        // 方法重写完成后，需重新调用一次sizeDidChange()才可生效\r\n        graph.sizeDidChange();\r\n\r\n        // 重写复制方法\r\n        mxClipboard.copy = (graph: Graph, cells?: MxGraphNS.mxCell[]) => {\r\n            cells = cells || graph.getSelectionCells();\r\n            // 仅复制节点\r\n            cells = cells.filter(cell => cell.vertex);\r\n            const result = graph.getExportableCells(graph.model.getTopmostCells(cells));\r\n            mxClipboard.insertCount = 1;\r\n            mxClipboard.setCells(graph.cloneCells(result));\r\n\r\n            return result;\r\n        };\r\n\r\n        // 重写粘贴方法\r\n        mxClipboard.paste = (graph: Graph) => {\r\n            let cells = null;\r\n\r\n            if (!mxClipboard.isEmpty()) {\r\n                cells = graph.getImportableCells(mxClipboard.getCells());\r\n                // 仅粘贴节点\r\n                cells = cells.filter(cell => cell.vertex) as NodeCell[];\r\n                const delta = mxClipboard.insertCount * mxClipboard.STEPSIZE;\r\n                const parent = graph.getDefaultParent();\r\n                graph.clearSelection();\r\n\r\n                const select: MxGraphNS.mxCell[] = [];\r\n                graph.model.beginUpdate();\r\n                try {\r\n                    cells.forEach(cell => {\r\n                        // const clone = graph.moveCells([cell], delta, delta, false, parent)[0] as NodeCell;\r\n                        const clone = graph.importCells([cell], delta, delta, parent)[0] as NodeCell;\r\n                        clone.bindBpmnModel(clone.flowElement, clone.diagramElement);\r\n\r\n                        select.push(clone);\r\n                    });\r\n\r\n                    // Increments the counter and selects the inserted cells\r\n                    mxClipboard.insertCount++;\r\n                } finally {\r\n                    graph.model.endUpdate();\r\n                }\r\n                graph.setSelectionCells(select);\r\n            }\r\n\r\n            return cells;\r\n        };\r\n    }\r\n\r\n    /**\r\n     * 创建动作列表\r\n     * @returns \r\n     */\r\n    createActions(): Actions {\r\n        const actions = new Actions(this);\r\n        return actions;\r\n    }\r\n\r\n    /**\r\n     * 创建工具栏项列表\r\n     * @returns \r\n     */\r\n    createToolbarItems(): ToolbarItems {\r\n        const toolbarItems = new DefaultToolbarItems();\r\n        return toolbarItems;\r\n    }\r\n\r\n    /**\r\n     * 创建键盘事件处理器\r\n     * @param graph \r\n     * @returns \r\n     */\r\n    createKeyHandler(graph: Graph): KeyHandler {\r\n        const keyHandler = new KeyHandler(graph);\r\n        return keyHandler;\r\n    }\r\n\r\n    /**\r\n     * 创建菜单栏\r\n     * @returns \r\n     */\r\n    createMenubar(): Menubar {\r\n        const menubar = new Menubar(this, this.menubarContainer);\r\n\r\n        return menubar;\r\n    }\r\n\r\n    /**\r\n     * 创建工具栏\r\n     * @returns \r\n     */\r\n    createToolbar(): Toolbar {\r\n        const toolbar = new Toolbar(this, this.toolbarContainer);\r\n\r\n        return toolbar;\r\n    }\r\n\r\n    /**\r\n     * 创建侧边栏\r\n     * @returns \r\n     */\r\n    createSidebar(): Sidebar {\r\n        const sidebar = new Sidebar(this, this.sidebarContainer);\r\n\r\n        return sidebar;\r\n    }\r\n\r\n    /**\r\n     * 创建内置属性框\r\n     * @returns \r\n     */\r\n    createFormat(): Format {\r\n        const format = new Format(this, this.formatContainer);\r\n\r\n        return format;\r\n    }\r\n\r\n    /**\r\n     * 创建底部栏\r\n     * @returns \r\n     */\r\n    createFooter(): Footer {\r\n        const footer = new Footer(this, this.footerContainer);\r\n\r\n        return footer;\r\n    }\r\n\r\n    /**\r\n     * 重置工具条\r\n     */\r\n    resetToolbar(toolbarItems: ToolbarItems) {\r\n        this.toolbar && this.toolbar.reset(toolbarItems);\r\n    }\r\n\r\n    /**\r\n     * 重置工具箱\r\n     */\r\n    resetToolbox() {\r\n        this.toolbox = this.createToolbox();\r\n\r\n        this.sidebar && this.sidebar.reset(this.toolbox);\r\n    }\r\n\r\n    /**\r\n     * 创建工具箱\r\n     * @returns \r\n     */\r\n    createToolbox(): Toolbox {\r\n        const toolbox = new DefaultToolbox();\r\n        return toolbox;\r\n    }\r\n\r\n    /**\r\n     * 加载BpmnModel\r\n     * @param json \r\n     */\r\n    loadBpmnModel(json: string): void {\r\n        this.graph && this.graph.loadBpmnModel(json);\r\n    }\r\n\r\n    /**\r\n     * 重置滚动条\r\n     */\r\n    resetScrollbars(): void {\r\n        const graph = this.graph;\r\n        const bounds = graph.getGraphBounds();\r\n        let width = bounds.width;\r\n        let height = bounds.height;\r\n        if (graph.getScrollTileSize) {\r\n            width = Math.max(bounds.width, graph.getScrollTileSize().width * graph.view.scale);\r\n            height = Math.max(bounds.height, graph.getScrollTileSize().height * graph.view.scale);\r\n        }\r\n        graph.container.scrollTop = Math.floor(Math.max(0, bounds.y - Math.max(20, (graph.container.clientHeight - height) / 4)));\r\n        graph.container.scrollLeft = Math.floor(Math.max(0, bounds.x - Math.max(0, (graph.container.clientWidth - width) / 2)));\r\n    }\r\n\r\n    /**\r\n     * 设置当前菜单\r\n     * @param menu \r\n     * @param elt \r\n     */\r\n    setCurrentMenu(menu: MxGraphNS.mxPopupMenu, elt: HTMLAnchorElement): void {\r\n        this.currentMenuElt = elt;\r\n        this.currentMenu = menu;\r\n    }\r\n\r\n    /**\r\n     * 重置当前菜单\r\n     */\r\n    resetCurrentMenu(): void {\r\n        this.currentMenuElt = null;\r\n        this.currentMenu = null;\r\n    }\r\n\r\n    /**\r\n     * 隐藏当前菜单\r\n     */\r\n    hideCurrentMenu(): void {\r\n        if (this.currentMenu != null) {\r\n            this.currentMenu.hideMenu();\r\n            this.resetCurrentMenu();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 添加模型相关监听器\r\n     */\r\n    addBpmnListeners() {\r\n        // 元素修改事件处理\r\n        this.graph.getModel().addListener(mxEvent.CHANGE, (sender: Graph, evt: MxGraphNS.mxEventObject) => {\r\n            // 画图完成后才会为graph的bpmnModel赋值，此后才真正监听change事件\r\n            if (this.graph.bpmnModel == null) {\r\n                return;\r\n            }\r\n            const changes: (Object & (MxGraphNS.mxValueChange | MxGraphNS.mxStyleChange | MxGraphNS.mxGeometryChange | MxGraphNS.mxCollapseChange | MxGraphNS.mxVisibleChange | MxGraphNS.mxCellAttributeChange | MxGraphNS.mxTerminalChange | MxGraphNS.mxChildChange | MxGraphNS.mxRootChange))[] = evt.getProperty(\"changes\");\r\n            const edit = evt.getProperty(\"edit\");\r\n\r\n            //消息发送开关，发送出一次消息后关闭\r\n            let flag = true;\r\n\r\n            changes && changes.forEach((chg) => {\r\n                // 根据change实例的构造函数名判断具体属于哪种类型\r\n                if (chg.constructor.name == MxGraphInnerClass.mxTerminalChange) {\r\n                    const change = chg as MxGraphNS.mxTerminalChange;\r\n                    const edge = change.cell as EdgeCell;\r\n                    const terminal = change.terminal as NodeCell;\r\n                    const source = change.source;\r\n                    const previous = change.previous as NodeCell;\r\n\r\n                    this.graph.bpmnEdgeTerminalChanged(edge, terminal, source, previous, sender, evt, change);\r\n\r\n                    if (flag && edge != null) {\r\n                        this.fireEvent(new mxEventObject(PmfEvents.ShowProperty, \"cells\", [edge]));\r\n                        flag = false;\r\n                    }\r\n                    this.graph.setSelectionCells([edge]);\r\n                } else if (chg.constructor.name == MxGraphInnerClass.mxGeometryChange) {\r\n                    const change = chg as MxGraphNS.mxGeometryChange;\r\n                    const cell: Cell = change.cell;\r\n                    this.graph.bpmnCellGeometryChanged(cell, sender, evt, change);\r\n                    if (flag && cell != null) {\r\n                        this.fireEvent(new mxEventObject(PmfEvents.ShowProperty, \"cells\", [cell]));\r\n                        flag = false;\r\n                    }\r\n                }\r\n            });\r\n        });\r\n\r\n        // 元素删除事件处理\r\n        this.graph.addListener(mxEvent.CELLS_REMOVED, (sender: Graph, evt: MxGraphNS.mxEventObject) => {\r\n            const cells = evt.getProperty(\"cells\");\r\n            this.graph.bpmnCellsRemoved(cells, sender, evt);\r\n        });\r\n\r\n\r\n        // 修改选中元素事件处理\r\n        this.graph.getSelectionModel().addListener(mxEvent.CHANGE, (sender: Graph, evt: MxGraphNS.mxEventObject) => {\r\n            const cells = this.graph.getSelectionCells() as Cell[];\r\n            this.graph.bpmnCellsSelectionChanged(cells, sender, evt);\r\n        });\r\n\r\n        // 添加连线事件\r\n        this.graph.connectionHandler.addListener(mxEvent.CONNECT, (sender: MxGraphNS.mxConnectionHandler, evt: MxGraphNS.mxEventObject) => {\r\n            const edge = evt.getProperty(\"cell\") as EdgeCell;\r\n            this.graph.bpmnCellsConnected(edge, sender, evt);\r\n        });\r\n\r\n        // 活动名称修改事件\r\n        this.addListener(PmfEvents.NameChanged, (sender: IEditorUi, evt: MxGraphNS.mxEventObject) => {\r\n            const cell = evt.getProperty(\"cell\") as Cell;\r\n            this.graph.bpmnCellNameChanged(cell, sender, evt);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * 销毁\r\n     */\r\n    destroy(): void {\r\n        if (this.graph != null) {\r\n            this.graph.destroy()\r\n        }\r\n\r\n        if (this.toolbar != null) {\r\n            this.toolbar.destroy();\r\n            this.toolbar = null;\r\n        }\r\n\r\n        if (this.sidebar != null) {\r\n            this.sidebar.destroy();\r\n            this.sidebar = null;\r\n        }\r\n\r\n        if (this.keyHandler != null) {\r\n            this.keyHandler.destroy();\r\n            this.keyHandler = null;\r\n        }\r\n\r\n        if (this.gestureHandler != null) {\r\n            mxEvent.removeGestureListeners(document, this.gestureHandler);\r\n            this.gestureHandler = null;\r\n        }\r\n\r\n        if (this.resizeHandler != null) {\r\n            mxEvent.removeListener(window, 'resize', this.resizeHandler);\r\n            this.resizeHandler = null;\r\n        }\r\n\r\n        if (this.deleteKeyHandler != null) {\r\n            mxEvent.removeListener(document, 'keydown', this.deleteKeyHandler);\r\n            this.deleteKeyHandler = null;\r\n        }\r\n\r\n\r\n        if (this.destroyFunctions != null) {\r\n            for (let i = 0; i < this.destroyFunctions.length; i++) {\r\n                this.destroyFunctions[i]();\r\n            }\r\n\r\n            this.destroyFunctions = null;\r\n        }\r\n\r\n        let c = [\r\n            this.menubarContainer,\r\n            this.toolbarContainer,\r\n            this.sidebarContainer,\r\n            this.formatContainer,\r\n            this.diagramContainer,\r\n            this.footerContainer,\r\n            this.sidebarSplit,\r\n        ];\r\n\r\n        for (let i = 0; i < c.length; i++) {\r\n            if (c[i] != null && c[i].parentNode != null) {\r\n                c[i].parentNode.removeChild(c[i]);\r\n            }\r\n        }\r\n    }\r\n}"]}
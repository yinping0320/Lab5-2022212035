{"version":3,"file":"Process.js","sourceRoot":"","sources":["../../../../src/lib/model/Process.ts"],"names":[],"mappings":";;;;AAEA,qDAAoD;AACpD,qDAAoD;AACpD,2CAA0C;AAG1C,uCAAsC;AAItC,6DAA4D;AAE5D,+CAA8C;AAC9C,mDAAkD;AAGlD;IAA6B,mCAAe;IACxC,iBAAY,KAAgB;QAA5B,YACI,kBAAM,KAAK,CAAC,SACf;QAEQ,eAAS,GAAW,cAAc,CAAC;QAGpC,qBAAe,GAAmC,EAAE,CAAC;QACrD,qBAAe,GAAoC,EAAE,CAAC;QACtD,wBAAkB,GAA6B,IAAI,KAAK,EAAqB,CAAC;QAC9E,uBAAiB,GAA4B,IAAI,KAAK,EAAoB,CAAC;QAuLlE,YAAM,GAAW,cAAc,CAAC;;IA/LjD,CAAC;IAUS,qCAAmB,GAA7B;QACI,iBAAM,mBAAmB,WAAE,CAAC;QAE5B,IAAI,CAAC,GAAG,GAAG,IAAI,CAAC;QAChB,IAAI,CAAC,eAAe,GAAG,EAAE,CAAC;QAC1B,IAAI,CAAC,eAAe,GAAG,EAAE,CAAC;QAC1B,IAAI,CAAC,kBAAkB,GAAG,IAAI,KAAK,EAAqB,CAAC;QACzD,IAAI,CAAC,iBAAiB,GAAG,IAAI,KAAK,EAAoB,CAAC;IAC3D,CAAC;IAED,6BAAW,GAAX;QACI,OAAO,IAAI,OAAO,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;IACnC,CAAC;IAED,+BAAa,GAAb,UAAc,UAAsB;QAChC,IAAI,CAAC,oBAAoB,CAAC,UAAU,CAAC,CAAC;QACtC,IAAI,CAAC,mBAAmB,CAAC,UAAU,CAAC,CAAC;IACzC,CAAC;IAED,+BAAa,GAAb,UAAc,YAAoB;QAC9B,IAAI,YAAY,IAAI,IAAI;YACpB,OAAO,IAAI,CAAC;QAEhB,IAAI,IAAI,CAAC,eAAe,CAAC,cAAc,CAAC,YAAY,CAAC,IAAI,IAAI,CAAC,eAAe,CAAC,YAAY,CAAC,YAAY,uBAAU;YAC7G,OAAO,IAAI,CAAC,eAAe,CAAC,YAAY,CAAe,CAAC;QAE5D,OAAO,IAAI,CAAC;IAChB,CAAC;IAED,gCAAc,GAAd;QACI,IAAI,WAAW,GAAsB,IAAI,KAAK,EAAc,CAAC;QAC7D,KAAK,IAAI,IAAI,IAAI,IAAI,CAAC,eAAe,EAAE;YACnC,iEAAiE;YACjE,kBAAkB;YAClB,4BAA4B;YAE5B,IAAI,IAAI,CAAC,eAAe,CAAC,IAAI,CAAC,YAAY,uBAAU,EAAE;gBAClD,WAAW,CAAC,IAAI,CAAC,IAAI,CAAC,eAAe,CAAC,IAAI,CAAe,CAAC,CAAC;aAC9D;SACJ;QAED,OAAO,WAAW,CAAC;IACvB,CAAC;IAED,kCAAgB,GAAhB,UAAiB,YAAoB;QACjC,IAAI,CAAC,iBAAiB,CAAC,YAAY,CAAC,CAAC;IACzC,CAAC;IAED,gCAAc,GAAd,UAAe,OAAoB;QAC/B,IAAI,OAAO,YAAY,uBAAU;YAC7B,MAAM,IAAI,KAAK,CAAC,4BAA4B,CAAC,CAAC;QAElD,+BAAc,CAAC,iBAAiB,CAAC,OAAO,CAAC,CAAC;QAE1C,IAAI,CAAC,mBAAmB,CAAC,OAAO,CAAC,CAAC;IACtC,CAAC;IAED,gCAAc,GAAd,UAAe,SAAiB;QAC5B,IAAI,SAAS,IAAI,IAAI;YACjB,OAAO,IAAI,CAAC;QAEhB,IAAI,IAAI,CAAC,eAAe,CAAC,cAAc,CAAC,SAAS,CAAC;YAC9C,OAAO,IAAI,CAAC,eAAe,CAAC,SAAS,CAAC,CAAC;QAE3C,OAAO,IAAI,CAAC;IAChB,CAAC;IAED,iCAAe,GAAf;QACI,OAAO,IAAI,CAAC,eAAe,CAAC;IAChC,CAAC;IAED,mCAAiB,GAAjB,UAAkB,SAAiB;QAC/B,IAAI,OAAO,GAAgB,IAAI,CAAC,cAAc,CAAC,SAAS,CAAC,CAAC;QAC1D,IAAI,OAAO,IAAI,IAAI;YACf,OAAO;QAEX,IAAI,OAAO,YAAY,2BAAY,EAAE;YACjC,IAAI,CAAC,kBAAkB,CAAe,OAAO,CAAC,CAAC;SAClD;QAED,IAAI,OAAO,YAAY,mBAAQ,EAAE;YAC7B,IAAI,CAAC,cAAc,CAAW,OAAO,CAAC,CAAC;SAC1C;QAED,IAAI,OAAO,YAAY,uBAAU,EAAE;YAC/B,IAAI,CAAC,qBAAqB,CAAa,OAAO,CAAC,CAAC;SACnD;QAED,OAAO,IAAI,CAAC,eAAe,CAAC,SAAS,CAAC,CAAC;QACvC,IAAI,CAAC,KAAK,CAAC,kBAAkB,CAAC,SAAS,CAAC,CAAC;IAC7C,CAAC;IAED,uCAAqB,GAArB;QACI,OAAO,IAAI,CAAC,kBAAkB,CAAC;IACnC,CAAC;IAED,iCAAe,GAAf,UAAgB,IAAkB;QAC9B,IAAI,CAAC,eAAe,CAAC,IAAI,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC;QACrC,IAAI,CAAC,KAAK,CAAC,eAAe,CAAC,IAAI,CAAC,CAAC;IACrC,CAAC;IAED,iCAAe,GAAf,UAAgB,cAAsB;QAClC,IAAI,cAAc,IAAI,IAAI;YACtB,OAAO,IAAI,CAAC;QAEhB,IAAI,IAAI,CAAC,eAAe,CAAC,cAAc,CAAC,cAAc,CAAC;YACnD,OAAO,IAAI,CAAC,eAAe,CAAC,cAAc,CAAC,CAAC;QAEhD,OAAO,IAAI,CAAC;IAChB,CAAC;IAED,kCAAgB,GAAhB;QACI,IAAI,aAAa,GAAwB,IAAI,KAAK,EAAgB,CAAC;QAEnE,KAAK,IAAI,IAAI,IAAI,IAAI,CAAC,eAAe,EAAE;YACnC,aAAa,CAAC,IAAI,CAAC,IAAI,CAAC,eAAe,CAAC,IAAI,CAAC,CAAC,CAAC;SAClD;QAED,OAAO,aAAa,CAAC;IACzB,CAAC;IAED,oCAAkB,GAAlB,UAAmB,cAAsB;QACrC,OAAO,IAAI,CAAC,eAAe,CAAC,cAAc,CAAC,CAAC;QAC5C,IAAI,CAAC,KAAK,CAAC,kBAAkB,CAAC,cAAc,CAAC,CAAC;IAClD,CAAC;IAED,qCAAmB,GAAnB;QACI,IAAI,GAAG,GAAQ,iBAAM,mBAAmB,WAAE,CAAC;QAE3C,iCAAe,CAAC,iBAAiB,CAAC,GAAG,EAAE,KAAK,EAAE,IAAI,CAAC,GAAG,CAAC,CAAC;QAExD,IAAI,YAAY,GAAe,EAAE,CAAC;QAClC,KAAK,IAAI,SAAS,IAAI,IAAI,CAAC,eAAe,EAAE;YACxC,IAAI,OAAO,GAAQ,IAAI,CAAC,eAAe,CAAC,SAAS,CAAC,CAAC,mBAAmB,EAAE,CAAC;YACzE,YAAY,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;SAC9B;QAED,iCAAe,CAAC,iBAAiB,CAAC,GAAG,EAAE,cAAc,EAAE,YAAY,CAAC,CAAC;QAErE,IAAI,aAAa,GAAe,IAAI,KAAK,EAAO,CAAC;QACjD,KAAK,IAAI,IAAI,IAAI,IAAI,CAAC,eAAe,EAAE;YACnC,aAAa,CAAC,IAAI,CAAC,IAAI,CAAC,eAAe,CAAC,IAAI,CAAC,CAAC,mBAAmB,EAAE,CAAC,CAAC;SACxE;QACD,IAAI,aAAa,CAAC,MAAM,GAAG,CAAC,EAAE;YAC1B,iCAAe,CAAC,iBAAiB,CAAC,GAAG,EAAE,eAAe,EAAE,aAAa,CAAC,CAAC;SAC1E;QAED,OAAO,GAAG,CAAC;IACf,CAAC;IAED,oCAAkB,GAAlB,UAAmB,GAAQ;QACvB,iBAAM,kBAAkB,YAAC,GAAG,CAAC,CAAC;QAE9B,IAAI,CAAC,GAAG,GAAG,GAAG,CAAC,GAAG,CAAC;QAEnB,IAAI,GAAG,CAAC,cAAc,CAAC,cAAc,CAAC,IAAI,KAAK,CAAC,OAAO,CAAC,GAAG,CAAC,YAAY,CAAC,EAAE;YACvE,KAAuB,UAAgB,EAAhB,KAAA,GAAG,CAAC,YAAY,EAAhB,cAAgB,EAAhB,IAAgB,EAAE;gBAApC,IAAI,UAAU,SAAA;gBACf,IAAI,OAAO,GAAgB,iCAAe,CAAC,cAAc,CAAC,UAAU,CAAC,SAAS,CAAgB,CAAC;gBAE/F,IAAI,OAAO,IAAI,IAAI;oBACf,SAAS;gBAEb,OAAO,CAAC,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC;gBAC3B,OAAO,CAAC,kBAAkB,CAAC,UAAU,CAAC,CAAC;gBACvC,IAAI,CAAC,mBAAmB,CAAC,OAAO,CAAC,CAAC;aACrC;SACJ;QAED,IAAI,GAAG,CAAC,cAAc,CAAC,eAAe,CAAC,IAAI,KAAK,CAAC,OAAO,CAAC,GAAG,CAAC,aAAa,CAAC,EAAE;YACzE,KAAiB,UAAiB,EAAjB,KAAA,GAAG,CAAC,aAAa,EAAjB,cAAiB,EAAjB,IAAiB,EAAE;gBAA/B,IAAI,IAAI,SAAA;gBACT,IAAI,YAAY,GAAiB,iCAAe,CAAC,cAAc,CAAC,IAAI,CAAC,SAAS,CAAiB,CAAC;gBAEhG,IAAI,YAAY,IAAI,IAAI;oBACpB,SAAS;gBAEb,YAAY,CAAC,kBAAkB,CAAC,IAAI,CAAC,CAAC;gBACtC,IAAI,CAAC,eAAe,CAAC,YAAY,CAAC,CAAC;aACtC;SACJ;IACL,CAAC;IAIS,gDAA8B,GAAxC;QACI,IAAI,IAAI,GAA4B,iBAAM,8BAA8B,WAAE,CAAC;QAE3E,KAAiB,UAAuB,EAAvB,KAAA,IAAI,CAAC,kBAAkB,EAAvB,cAAuB,EAAvB,IAAuB,EAAE;YAArC,IAAI,IAAI,SAAA;YACT,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,MAAM,CAAC;YAC1B,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;SACnB;QAED,KAAiB,UAAsB,EAAtB,KAAA,IAAI,CAAC,iBAAiB,EAAtB,cAAsB,EAAtB,IAAsB,EAAE;YAApC,IAAI,IAAI,SAAA;YACT,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,MAAM,CAAC;YAC1B,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;SACnB;QAED,OAAO,IAAI,CAAC;IAChB,CAAC;IAES,+CAA6B,GAAvC,UAAwC,iBAA0C;QAC9E,iBAAM,6BAA6B,YAAC,iBAAiB,CAAC,CAAC;QAEvD,KAA6B,UAAiB,EAAjB,uCAAiB,EAAjB,+BAAiB,EAAjB,IAAiB,EAAE;YAA3C,IAAI,gBAAgB,0BAAA;YACrB,IAAI,CAAC,gBAAgB,YAAY,qCAAiB,CAAC,IAAI,gBAAgB,CAAC,MAAM,IAAI,IAAI,CAAC,MAAM,EAAE;gBAC3F,IAAI,CAAC,kBAAkB,CAAC,IAAI,CAAC,gBAAqC,CAAC,CAAC;aACvE;iBACI,IAAI,gBAAgB,CAAC,MAAM,IAAI,IAAI,CAAC,MAAM,EAAE;gBAC7C,IAAI,CAAC,iBAAiB,CAAC,IAAI,CAAC,gBAAgB,CAAC,CAAC;aACjD;SACJ;IACL,CAAC;IAEM,sCAAoB,GAA3B;QACI,OAAO,IAAI,CAAC,iBAAiB,CAAC;IAClC,CAAC;IAED,0BAAQ,GAAR,UAAS,MAA8B;QACnC,iBAAM,QAAQ,YAAC,MAAM,CAAC,CAAC;QAEvB,KAAiB,UAAuB,EAAvB,KAAA,IAAI,CAAC,kBAAkB,EAAvB,cAAuB,EAAvB,IAAuB,EAAE;YAArC,IAAI,IAAI,SAAA;YACT,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC;SACzB;QAED,KAAK,IAAI,IAAI,IAAI,IAAI,CAAC,eAAe,EAAE;YACnC,IAAI,CAAC,eAAe,CAAC,IAAI,CAAC,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC;SAC/C;QAED,+BAAc,CAAC,eAAe,CAAC,IAAI,EAAE,MAAM,CAAC,CAAC;IACjD,CAAC;IAED,sCAAoB,GAApB,UAAqB,eAAiC;QAClD,iBAAM,oBAAoB,YAAC,eAAe,CAAC,CAAC;QAE5C,+BAAc,CAAC,oBAAoB,CAAC,eAAe,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,CAAC,CAAC;IAC3E,CAAC;IAEO,qCAAmB,GAA3B,UAA4B,OAAoB;QAC5C,IAAI,CAAC,eAAe,CAAC,OAAO,CAAC,EAAE,CAAC,GAAG,OAAO,CAAC;QAC3C,IAAI,CAAC,KAAK,CAAC,eAAe,CAAC,OAAO,CAAC,CAAC;IACxC,CAAC;IAEO,oCAAkB,GAA1B,UAA2B,OAAqB;IAChD,CAAC;IAEO,uCAAqB,GAA7B,UAA8B,OAAmB;IACjD,CAAC;IAEO,gCAAc,GAAtB,UAAuB,OAAiB;QACpC,IAAI,IAAI,GAAwB,IAAI,KAAK,EAAgB,CAAC;QAC1D,KAAK,IAAI,IAAI,IAAI,IAAI,CAAC,eAAe,EAAE,EAAE;YACrC,IAAI,WAAW,GAAG,IAAI,CAAC,eAAe,EAAE,CAAC,IAAI,CAAC,CAAC;YAC/C,IAAI,WAAW,IAAI,IAAI;gBACnB,SAAS;YAEb,IAAI,WAAW,YAAY,2BAAY,IAAI,CAAC,WAAW,CAAC,SAAS,IAAI,OAAO,CAAC,EAAE,IAAI,WAAW,CAAC,SAAS,IAAI,OAAO,CAAC,EAAE,CAAC;gBACnH,IAAI,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC;SAC9B;QAED,KAAiB,UAAI,EAAJ,aAAI,EAAJ,kBAAI,EAAJ,IAAI,EAAE;YAAlB,IAAI,IAAI,aAAA;YACT,OAAO,IAAI,CAAC,eAAe,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;SACxC;IACL,CAAC;IACL,cAAC;AAAD,CAAC,AAnRD,CAA6B,iCAAe,GAmR3C;AAnRY,0BAAO","sourcesContent":["import { BpmnModel } from \"./BpmnModel\";\r\nimport { BpmnModelElement } from \"./BpmnModelElement\";\r\nimport { BpmnModelHelper } from \"./BpmnModelHelper\";\r\nimport { CallableElement } from \"./CallableElement\";\r\nimport { DataObject } from \"./DataObject\";\r\nimport { ExtensionElement } from \"./ExtensionElement\";\r\nimport { FlowElement } from \"./FlowElement\";\r\nimport { FlowNode } from \"./FlowNode\";\r\nimport { IExecutionListenerContainer } from \"./IExecutionListenerContainer\";\r\nimport { IProcess } from \"./IProcess\";\r\nimport { IVariableElement } from \"./IVariableElement\";\r\nimport { ExecutionListener } from \"./mex/ExecutionListener\";\r\nimport { ResourceRole } from \"./ResourceRole\";\r\nimport { SequenceFlow } from \"./SequenceFlow\";\r\nimport { ValidateHelper } from \"./ValidateHelper\";\r\nimport { ValidationError } from \"./ValidationError\";\r\n\r\nexport class Process extends CallableElement implements IProcess, IExecutionListenerContainer {\r\n    constructor(model: BpmnModel) {\r\n        super(model);\r\n    }\r\n\r\n    readonly ClrTypeID: string = \"bpmn.Process\";\r\n\r\n    Key: string;\r\n    private flowElementsDic: { [key: string]: FlowElement } = {};\r\n    private resourceRoleDIc: { [key: string]: ResourceRole } = {};\r\n    private executionListeners: Array<ExecutionListener> = new Array<ExecutionListener>();\r\n    private extensionElements: Array<ExtensionElement> = new Array<ExtensionElement>();\r\n\r\n    protected ResetBeforeLoadFrom(): void {\r\n        super.ResetBeforeLoadFrom();\r\n\r\n        this.Key = null;\r\n        this.flowElementsDic = {};\r\n        this.resourceRoleDIc = {};\r\n        this.executionListeners = new Array<ExecutionListener>();\r\n        this.extensionElements = new Array<ExtensionElement>();\r\n    }\r\n\r\n    NewInstance(): Process {\r\n        return new Process(this.Model);\r\n    }\r\n\r\n    AddDataObject(dataObject: DataObject): void {\r\n        this.CheckVariableElement(dataObject);\r\n        this.InnerAddFlowElement(dataObject);\r\n    }\r\n\r\n    GetDataObject(dataObjectId: string): DataObject {\r\n        if (dataObjectId == null)\r\n            return null;\r\n\r\n        if (this.flowElementsDic.hasOwnProperty(dataObjectId) && this.flowElementsDic[dataObjectId] instanceof DataObject)\r\n            return this.flowElementsDic[dataObjectId] as DataObject;\r\n\r\n        return null;\r\n    }\r\n\r\n    GetDataObjects(): DataObject[] {\r\n        let dataObjects: Array<DataObject> = new Array<DataObject>();\r\n        for (let item in this.flowElementsDic) {\r\n            //let obj: DataObject = this.flowElementsDic[item] as DataObject;\r\n            //if (obj != null)\r\n            //    dataObjects.push(obj);\r\n\r\n            if (this.flowElementsDic[item] instanceof DataObject) {\r\n                dataObjects.push(this.flowElementsDic[item] as DataObject);\r\n            }\r\n        }\r\n\r\n        return dataObjects;\r\n    }\r\n\r\n    RemoveDataObject(dataObjectId: string): void {\r\n        this.RemoveFlowElement(dataObjectId);\r\n    }\r\n\r\n    AddFlowElement(element: FlowElement): void {\r\n        if (element instanceof DataObject)\r\n            throw new Error(\"请使用 AddDataObjcet 方法添加流程变量\");\r\n\r\n        ValidateHelper.CheckHasIdElement(element);\r\n\r\n        this.InnerAddFlowElement(element);\r\n    }\r\n\r\n    GetFlowElement(elementId: string): FlowElement {\r\n        if (elementId == null)\r\n            return null;\r\n\r\n        if (this.flowElementsDic.hasOwnProperty(elementId))\r\n            return this.flowElementsDic[elementId];\r\n\r\n        return null;\r\n    }\r\n\r\n    GetFlowElements(): { [key: string]: FlowElement; } {\r\n        return this.flowElementsDic;\r\n    }\r\n\r\n    RemoveFlowElement(elementId: string): void {\r\n        let element: FlowElement = this.GetFlowElement(elementId);\r\n        if (element == null)\r\n            return;\r\n\r\n        if (element instanceof SequenceFlow) {\r\n            this.RemoveSequenceFlow(<SequenceFlow>element);\r\n        }\r\n\r\n        if (element instanceof FlowNode) {\r\n            this.RemoveFlowNode(<FlowNode>element);\r\n        }\r\n\r\n        if (element instanceof DataObject) {\r\n            this.InnerRemoveDataObject(<DataObject>element);\r\n        }\r\n\r\n        delete this.flowElementsDic[elementId];\r\n        this.Model.RemoveHasIdElement(elementId);\r\n    }\r\n\r\n    GetExecutionListeners(): ExecutionListener[] {\r\n        return this.executionListeners;\r\n    }\r\n\r\n    AddResourceRole(item: ResourceRole): void {\r\n        this.resourceRoleDIc[item.Id] = item;\r\n        this.Model.AddHasIdElement(item);\r\n    }\r\n\r\n    GetResourceRole(resourceRoleId: string): ResourceRole {\r\n        if (resourceRoleId == null)\r\n            return null;\r\n\r\n        if (this.resourceRoleDIc.hasOwnProperty(resourceRoleId))\r\n            return this.resourceRoleDIc[resourceRoleId];\r\n\r\n        return null;\r\n    }\r\n\r\n    GetResourceRoles(): Array<ResourceRole> {\r\n        let resourceRoles: Array<ResourceRole> = new Array<ResourceRole>();\r\n\r\n        for (let item in this.resourceRoleDIc) {\r\n            resourceRoles.push(this.resourceRoleDIc[item]);\r\n        }\r\n\r\n        return resourceRoles;\r\n    }\r\n\r\n    RemoveResourceRole(resourceRoleId: string): void {\r\n        delete this.resourceRoleDIc[resourceRoleId];\r\n        this.Model.RemoveHasIdElement(resourceRoleId);\r\n    }\r\n\r\n    ConvertToJsonObject(): any {\r\n        let obj: any = super.ConvertToJsonObject();\r\n\r\n        BpmnModelHelper.SetAttributeValue(obj, \"Key\", this.Key);\r\n\r\n        let flowElements: Array<any> = [];\r\n        for (let elementId in this.flowElementsDic) {\r\n            let element: any = this.flowElementsDic[elementId].ConvertToJsonObject();\r\n            flowElements.push(element);\r\n        }\r\n\r\n        BpmnModelHelper.SetAttributeValue(obj, \"flowElements\", flowElements);\r\n\r\n        let resourceRoles: Array<any> = new Array<any>();\r\n        for (let item in this.resourceRoleDIc) {\r\n            resourceRoles.push(this.resourceRoleDIc[item].ConvertToJsonObject());\r\n        }\r\n        if (resourceRoles.length > 0) {\r\n            BpmnModelHelper.SetAttributeValue(obj, \"resourceRoles\", resourceRoles);\r\n        }\r\n\r\n        return obj;\r\n    }\r\n\r\n    LoadFromJsonObject(obj: any): void {\r\n        super.LoadFromJsonObject(obj);\r\n\r\n        this.Key = obj.Key;\r\n\r\n        if (obj.hasOwnProperty(\"flowElements\") && Array.isArray(obj.flowElements)) {\r\n            for (let elementObj of obj.flowElements) {\r\n                let element: FlowElement = BpmnModelHelper.GetElementType(elementObj.ClrTypeID) as FlowElement;\r\n\r\n                if (element == null)\r\n                    continue;\r\n\r\n                element.Model = this.Model;\r\n                element.LoadFromJsonObject(elementObj);\r\n                this.InnerAddFlowElement(element);\r\n            }\r\n        }\r\n\r\n        if (obj.hasOwnProperty(\"resourceRoles\") && Array.isArray(obj.resourceRoles)) {\r\n            for (let item of obj.resourceRoles) {\r\n                let resourceRole: ResourceRole = BpmnModelHelper.GetElementType(item.ClrTypeID) as ResourceRole;\r\n\r\n                if (resourceRole == null)\r\n                    continue;\r\n\r\n                resourceRole.LoadFromJsonObject(item);\r\n                this.AddResourceRole(resourceRole);\r\n            }\r\n        }\r\n    }\r\n\r\n    private readonly MEXTAG: string = \"bpmn.Process\";\r\n\r\n    protected GetExtensionElements4ConvertTo(): Array<ExtensionElement> {\r\n        let list: Array<ExtensionElement> = super.GetExtensionElements4ConvertTo();\r\n\r\n        for (let item of this.executionListeners) {\r\n            item.MexTag = this.MEXTAG;\r\n            list.push(item);\r\n        }\r\n\r\n        for (let item of this.extensionElements) {\r\n            item.MexTag = this.MEXTAG;\r\n            list.push(item);\r\n        }\r\n\r\n        return list;\r\n    }\r\n\r\n    protected SetExtensionElements4LoadFrom(extensionElements: Array<ExtensionElement>): void {\r\n        super.SetExtensionElements4LoadFrom(extensionElements);\r\n\r\n        for (let extensionElement of extensionElements) {\r\n            if ((extensionElement instanceof ExecutionListener) && extensionElement.MexTag == this.MEXTAG) {\r\n                this.executionListeners.push(extensionElement as ExecutionListener);\r\n            }\r\n            else if (extensionElement.MexTag == this.MEXTAG) {\r\n                this.extensionElements.push(extensionElement);\r\n            }\r\n        }\r\n    }\r\n\r\n    public GetExtensionElements(): Array<ExtensionElement> {\r\n        return this.extensionElements;\r\n    }\r\n\r\n    Validate(errors: Array<ValidationError>): void {\r\n        super.Validate(errors);\r\n\r\n        for (let item of this.executionListeners) {\r\n            item.Validate(errors);\r\n        }\r\n\r\n        for (let item in this.flowElementsDic) {\r\n            this.flowElementsDic[item].Validate(errors);\r\n        }\r\n\r\n        ValidateHelper.ValidateProcess(this, errors);\r\n    }\r\n\r\n    CheckVariableElement(variableElement: IVariableElement): void {\r\n        super.CheckVariableElement(variableElement);\r\n\r\n        ValidateHelper.CheckVariableElement(variableElement, null, null, this);\r\n    }\r\n\r\n    private InnerAddFlowElement(element: FlowElement): void {\r\n        this.flowElementsDic[element.Id] = element;\r\n        this.Model.AddHasIdElement(element);\r\n    }\r\n\r\n    private RemoveSequenceFlow(element: SequenceFlow): void {\r\n    }\r\n\r\n    private InnerRemoveDataObject(element: DataObject): void {\r\n    }\r\n\r\n    private RemoveFlowNode(element: FlowNode): void {\r\n        let list: Array<SequenceFlow> = new Array<SequenceFlow>();\r\n        for (let item in this.GetFlowElements()) {\r\n            let itemElement = this.GetFlowElements()[item];\r\n            if (itemElement == null)\r\n                continue;\r\n\r\n            if (itemElement instanceof SequenceFlow && (itemElement.SourceRef == element.Id || itemElement.TargetRef == element.Id))\r\n                list.push(itemElement);\r\n        }\r\n\r\n        for (let item of list) {\r\n            delete this.flowElementsDic[item.Id];\r\n        }\r\n    }\r\n}"]}
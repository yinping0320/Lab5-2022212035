/**
 * @fileoverview added by tsickle
 * Generated from: lib/views/bo-tree-panel/bo-tree-panel.component.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, ViewChild, EventEmitter, Output, Input } from '@angular/core';
import { BOTreePanelState } from './bo-tree-panel.state';
import { BusinessObjectRtService } from '@gsp-lcm/bo-rt-service';
import { TreeTableComponent } from '@farris/ui-treetable';
// 设置需要显示的值
/** @type {?} */
const CUSTOM_TEMPLATE_STRING = '{{ node.name }} ({{ node.subTitle }})';
export class BOTreePanelComponent {
    // 注入文件树数据获取服务，以获取数据
    /**
     * @param {?} boRtService
     * @param {?} boTreePanelState
     */
    constructor(boRtService, boTreePanelState) {
        this.boRtService = boRtService;
        this.boTreePanelState = boTreePanelState;
        this.selectionChanged = new EventEmitter();
        this.cols = [
            { field: 'name', title: 'Name', width: 200 }
        ];
        this.customTemplateStringOptions = { treeNodeTemplate: CUSTOM_TEMPLATE_STRING };
        this.getInitBOTreeData();
    }
    /**
     * 获取根目录树
     * @return {?}
     */
    getInitBOTreeData() {
        this.boRtService.getBusinessObjects().subscribe((/**
         * @param {?} res
         * @return {?}
         */
        (res) => {
            if (res instanceof Array) {
                res.forEach((/**
                 * @param {?} item
                 * @return {?}
                 */
                (item) => {
                    if (item.parentID === undefined || item.parentID === null || item.parentID === '') {
                        item.parentID = undefined;
                    }
                    if (item.sysInit === '1') {
                        item.isSysInit = true;
                    }
                    else {
                        item.isSysInit = false;
                    }
                }));
            }
            else {
                if (res.parentID === undefined || res.parentID === null || res.parentID === '') {
                    res.parentID = undefined;
                    if (res.sysInit === '1') {
                        res.isSysInit = true;
                    }
                    else {
                        res.isSysInit = false;
                    }
                }
            }
            this.treeNodes = this.makeTree(res);
        }));
    }
    /**
     * @param {?} id
     * @param {?=} detectChanges
     * @return {?}
     */
    selectNode(id, detectChanges) {
        this.treetable.selectNode(id, detectChanges);
    }
    /**
     * @param {?} $event
     * @return {?}
     */
    doubleClickEventHandler($event) {
        this.boTreePanelState.boTreeNodeDoubleClick.emit($event.node);
    }
    /**
     * @return {?}
     */
    ngOnInit() {
    }
    /**
     * @param {?} $event
     * @return {?}
     */
    selectionChange($event) {
        this.selctedBO = $event.node.data;
        this.selectionChanged.emit($event.node);
    }
    /**
     * @return {?}
     */
    refresh() {
        this.getInitBOTreeData();
    }
    /**
     * @private
     * @param {?} data
     * @return {?}
     */
    makeTree(data) {
        /** @type {?} */
        const r = data.filter((/**
         * @param {?} t
         * @return {?}
         */
        t => t.layer === 1)).map((/**
         * @param {?} t
         * @return {?}
         */
        t => {
            return {
                id: t.id,
                data: t,
                children: [],
                expanded: true
            };
        }));
        r.forEach((/**
         * @param {?} e
         * @return {?}
         */
        e => {
            e.children = this.makeTreeChildren(data, e.data);
        }));
        return r;
    }
    /**
     * @private
     * @param {?} data
     * @param {?} treeInfo
     * @return {?}
     */
    makeTreeChildren(data, treeInfo) {
        /** @type {?} */
        const pLayer = treeInfo.layer + 1;
        return data.filter((/**
         * @param {?} c
         * @return {?}
         */
        c => c.layer === pLayer && c.parentID === treeInfo.id)).map((/**
         * @param {?} d
         * @return {?}
         */
        d => {
            return {
                data: d,
                children: this.makeTreeChildren(data, d),
                expanded: false
            };
        }));
    }
}
BOTreePanelComponent.decorators = [
    { type: Component, args: [{
                selector: 'app-bo-tree-panel',
                template: "\r\n<div  #test class=\"botreepanel farris-main-area flex-column\">\r\n  <farris-treetable #treetable class=\"farris-overflow-y-auto flex-fill\"\r\n    [data]=\"treeNodes\" \r\n    [columns]=\"cols\" \r\n    [fit] =\"true\" \r\n    [fixedHeader]=\"true\" \r\n    [idField]=\"'id'\" \r\n    [checkOnSelect]=\"true\"  \r\n    [showIcon]=\"showIcon\"\r\n    [showHeader]=\"false\" \r\n    (nodeSelected)=\"selectionChange($event)\">\r\n  </farris-treetable>\r\n</div>",
                styles: [".botreepanel{overflow:hidden;cursor:pointer;-webkit-user-select:none;-ms-user-select:none;-moz-user-select:none;user-select:none;white-space:nowrap}"]
            }] }
];
/** @nocollapse */
BOTreePanelComponent.ctorParameters = () => [
    { type: BusinessObjectRtService },
    { type: BOTreePanelState }
];
BOTreePanelComponent.propDecorators = {
    showIcon: [{ type: Input }],
    selectionChanged: [{ type: Output }],
    treetable: [{ type: ViewChild, args: ['treetable',] }]
};
if (false) {
    /** @type {?} */
    BOTreePanelComponent.prototype.showIcon;
    /** @type {?} */
    BOTreePanelComponent.prototype.selectionChanged;
    /** @type {?} */
    BOTreePanelComponent.prototype.treetable;
    /** @type {?} */
    BOTreePanelComponent.prototype.cols;
    /** @type {?} */
    BOTreePanelComponent.prototype.treeNodes;
    /** @type {?} */
    BOTreePanelComponent.prototype.selctedBO;
    /** @type {?} */
    BOTreePanelComponent.prototype.customTemplateStringOptions;
    /** @type {?} */
    BOTreePanelComponent.prototype.boRtService;
    /**
     * @type {?}
     * @private
     */
    BOTreePanelComponent.prototype.boTreePanelState;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYm8tdHJlZS1wYW5lbC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZ3NwLWxjbS9iby10cmVlLyIsInNvdXJjZXMiOlsibGliL3ZpZXdzL2JvLXRyZWUtcGFuZWwvYm8tdHJlZS1wYW5lbC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFVLFNBQVMsRUFBRSxZQUFZLEVBQUUsTUFBTSxFQUFFLEtBQUssRUFBQyxNQUFNLGVBQWUsQ0FBQztBQUN6RixPQUFPLEVBQUUsZ0JBQWdCLEVBQUMsTUFBTSx1QkFBdUIsQ0FBQztBQUN4RCxPQUFPLEVBQUUsdUJBQXVCLEVBQUUsTUFBTSx3QkFBd0IsQ0FBQztBQUNqRSxPQUFPLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQzs7O01BRXBELHNCQUFzQixHQUFHLHVDQUF1QztBQVF0RSxNQUFNLE9BQU8sb0JBQW9COzs7Ozs7SUFhL0IsWUFBbUIsV0FBb0MsRUFBVSxnQkFBa0M7UUFBaEYsZ0JBQVcsR0FBWCxXQUFXLENBQXlCO1FBQVUscUJBQWdCLEdBQWhCLGdCQUFnQixDQUFrQjtRQVh6RixxQkFBZ0IsR0FBRyxJQUFJLFlBQVksRUFBTyxDQUFDO1FBRXJELFNBQUksR0FBRztZQUNMLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFFLEtBQUssRUFBRSxHQUFHLEVBQUM7U0FDNUMsQ0FBQztRQUlGLGdDQUEyQixHQUFHLEVBQUUsZ0JBQWdCLEVBQUUsc0JBQXNCLEVBQUUsQ0FBQztRQUl6RSxJQUFJLENBQUMsaUJBQWlCLEVBQUUsQ0FBQztJQUMzQixDQUFDOzs7OztJQUtELGlCQUFpQjtRQUNmLElBQUksQ0FBQyxXQUFXLENBQUMsa0JBQWtCLEVBQUUsQ0FBQyxTQUFTOzs7O1FBQUMsQ0FBQyxHQUFRLEVBQUUsRUFBRTtZQUMzRCxJQUFJLEdBQUcsWUFBWSxLQUFLLEVBQUU7Z0JBQ3hCLEdB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Q0FBQyxDQUFDLFFBQVEsS0FBRyxRQUFRLENBQUMsRUFBRSxFQUFDLENBQUMsR0FBRzs7OztRQUFFLENBQUMsQ0FBQyxFQUFFO1lBQ2hGLE9BQU87Z0JBQ0gsSUFBSSxFQUFFLENBQUM7Z0JBQ1AsUUFBUSxFQUFFLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDO2dCQUN4QyxRQUFRLEVBQUUsS0FBSzthQUNsQixDQUFDO1FBQ0osQ0FBQyxFQUFDLENBQUM7SUFDTCxDQUFDOzs7WUFwR0YsU0FBUyxTQUFDO2dCQUNULFFBQVEsRUFBRSxtQkFBbUI7Z0JBQzdCLDRkQUE2Qzs7YUFFOUM7Ozs7WUFUUSx1QkFBdUI7WUFEdkIsZ0JBQWdCOzs7dUJBYXRCLEtBQUs7K0JBQ0wsTUFBTTt3QkFDTixTQUFTLFNBQUMsV0FBVzs7OztJQUZ0Qix3Q0FBNEI7O0lBQzVCLGdEQUFxRDs7SUFDckQseUNBQXVEOztJQUN2RCxvQ0FFRTs7SUFFRix5Q0FBaUI7O0lBQ2pCLHlDQUFlOztJQUNmLDJEQUEyRTs7SUFHL0QsMkNBQTJDOzs7OztJQUFFLGdEQUEwQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgT25Jbml0LCBWaWV3Q2hpbGQsIEV2ZW50RW1pdHRlciwgT3V0cHV0LCBJbnB1dH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IEJPVHJlZVBhbmVsU3RhdGV9IGZyb20gJy4vYm8tdHJlZS1wYW5lbC5zdGF0ZSc7XHJcbmltcG9ydCB7IEJ1c2luZXNzT2JqZWN0UnRTZXJ2aWNlIH0gZnJvbSAnQGdzcC1sY20vYm8tcnQtc2VydmljZSc7XHJcbmltcG9ydCB7IFRyZWVUYWJsZUNvbXBvbmVudCB9IGZyb20gJ0BmYXJyaXMvdWktdHJlZXRhYmxlJzsgXHJcbi8vIOiuvue9rumcgOimgeaYvuekuueahOWAvFxyXG5jb25zdCBDVVNUT01fVEVNUExBVEVfU1RSSU5HID0gJ3t7IG5vZGUubmFtZSB9fSAoe3sgbm9kZS5zdWJUaXRsZSB9fSknO1xyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgc2VsZWN0b3I6ICdhcHAtYm8tdHJlZS1wYW5lbCcsXHJcbiAgdGVtcGxhdGVVcmw6ICcuL2JvLXRyZWUtcGFuZWwuY29tcG9uZW50Lmh0bWwnLFxyXG4gIHN0eWxlVXJsczogWycuL2JvLXRyZWUtcGFuZWwuY29tcG9uZW50LmNzcyddLFxyXG59KVxyXG5cclxuZXhwb3J0IGNsYXNzIEJPVHJlZVBhbmVsQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcclxuICBASW5wdXQoKSBzaG93SWNvbiA6IGJvb2xlYW47XHJcbiAgQE91dHB1dCgpIHNlbGVjdGlvbkNoYW5nZWQgPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcclxuICBAVmlld0NoaWxkKCd0cmVldGFibGUnKSB0cmVldGFibGUgOiBUcmVlVGFibGVDb21wb25lbnQ7XHJcbiAgY29scyA9IFtcclxuICAgIHsgZmllbGQ6ICduYW1lJywgdGl0bGU6ICdOYW1lJywgd2lkdGg6IDIwMH1cclxuICBdO1xyXG4gIC8vIOiOt+WPluaVsOaNrlxyXG4gIHRyZWVOb2RlczogYW55W107XHJcbiAgc2VsY3RlZEJPOiBhbnk7XHJcbiAgY3VzdG9tVGVtcGxhdGVTdHJpbmdPcHRpb25zID0geyB0cmVlTm9kZVRlbXBsYXRlOiBDVVNUT01fVEVNUExBVEVfU1RSSU5HIH07XHJcbiAgXHJcbiAgLy8g5rOo5YWl5paH5Lu25qCR5pWw5o2u6I635Y+W5pyN5Yqh77yM5Lul6I635Y+W5pWw5o2uXHJcbiAgY29uc3RydWN0b3IocHVibGljIGJvUnRTZXJ2aWNlOiBCdXNpbmVzc09iamVjdFJ0U2VydmljZSwgcHJpdmF0ZSBib1RyZWVQYW5lbFN0YXRlOiBCT1RyZWVQYW5lbFN0YXRlKSB7XHJcbiAgICB0aGlzLmdldEluaXRCT1RyZWVEYXRhKCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDojrflj5bmoLnnm67lvZXmoJFcclxuICAgKi9cclxuICBnZXRJbml0Qk9UcmVlRGF0YSgpIHtcclxuICAgIHRoaXMuYm9SdFNlcnZpY2UuZ2V0QnVzaW5lc3NPYmplY3RzKCkuc3Vic2NyaWJlKChyZXM6IGFueSkgPT4ge1xyXG4gICAgICBpZiAocmVzIGluc3RhbmNlb2YgQXJyYXkpIHtcclxuICAgICAgICByZXMuZm9yRWFjaCgoaXRlbSkgPT4gey8vIGtlbmRvVWkgdHJlZXZpZXcgcGFyZW50SWQg5Li656ys5LiA57qn55qE5pe25YCZIOW/hemhu3VuZGVmaW5lZO+8jOW/hemhu+WSjHdlYmFwaeW+l+WIsOWunuS9k+Wkp+Wwj+WGmeS4gOiHtFxyXG4gICAgICAgICAgaWYgKGl0ZW0ucGFyZW50SUQ9PT11bmRlZmluZWQgfHwgaXRlbS5wYXJlbnRJRCA9PT0gbnVsbCB8fCBpdGVtLnBhcmVudElEID09PSAnJykge1xyXG4gICAgICAgICAgICBpdGVtLnBhcmVudElEID0gdW5kZWZpbmVkO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgaWYgKGl0ZW0uc3lzSW5pdCA9PT0gJzEnKSB7XHJcbiAgICAgICAgICAgIGl0ZW0uaXNTeXNJbml0ID0gdHJ1ZTtcclxuICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGl0ZW0uaXNTeXNJbml0ID0gZmFsc2U7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgaWYgKHJlcy5wYXJlbnRJRD09PXVuZGVmaW5lZCB8fCByZXMucGFyZW50SUQgPT09IG51bGwgfHwgcmVzLnBhcmVudElEID09PSAnJykge1xyXG4gICAgICAgICAgcmVzLnBhcmVudElEID0gdW5kZWZpbmVkO1xyXG4gICAgICAgICAgaWYgKHJlcy5zeXNJbml0ID09PSAnMScpIHtcclxuICAgICAgICAgICAgcmVzLmlzU3lzSW5pdCA9IHRydWU7XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICByZXMuaXNTeXNJbml0ID0gZmFsc2U7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICAgIHRoaXMudHJlZU5vZGVzID10aGlzLm1ha2VUcmVlKHJlcyk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIHNlbGVjdE5vZGUoaWQ6IHN0cmluZywgZGV0ZWN0Q2hhbmdlcz86IGJvb2xlYW4pe1xyXG4gICAgdGhpcy50cmVldGFibGUuc2VsZWN0Tm9kZShpZCxkZXRlY3RDaGFuZ2VzKTtcclxuICB9XHJcbiAgXHJcblxyXG5cclxuICBkb3VibGVDbGlja0V2ZW50SGFuZGxlcigkZXZlbnQpIHtcclxuICAgICAgICB0aGlzLmJvVHJlZVBhbmVsU3RhdGUuYm9UcmVlTm9kZURvdWJsZUNsaWNrLmVtaXQoJGV2ZW50Lm5vZGUpO1xyXG4gIH1cclxuXHJcblxyXG4gIG5nT25Jbml0KCkge1xyXG4gIH1cclxuICBzZWxlY3Rpb25DaGFuZ2UoJGV2ZW50KSB7XHJcbiAgICB0aGlzLnNlbGN0ZWRCTyA9ICRldmVudC5ub2RlLmRhdGE7XHJcbiAgICB0aGlzLnNlbGVjdGlvbkNoYW5nZWQuZW1pdCgkZXZlbnQubm9kZSk7XHJcbiAgfVxyXG5cclxuICByZWZyZXNoKCkge1xyXG4gICAgdGhpcy5nZXRJbml0Qk9UcmVlRGF0YSgpO1xyXG4gIH1cclxuICBwcml2YXRlIG1ha2VUcmVlKGRhdGEpIHtcclxuICAgIGNvbnN0IHIgPSBkYXRhLmZpbHRlcih0ID0+IHQubGF5ZXIgPT09IDEpLm1hcCh0ID0+IHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBpZDp0LmlkLFxyXG4gICAgICAgICAgICBkYXRhOiB0LFxyXG4gICAgICAgICAgICBjaGlsZHJlbjogW10sXHJcbiAgICAgICAgICAgIGV4cGFuZGVkOiB0cnVlXHJcbiAgICAgICAgfTtcclxuICAgIH0pO1xyXG5cclxuICAgIHIuZm9yRWFjaChlID0+IHtcclxuICAgICAgICBlLmNoaWxkcmVuID0gdGhpcy5tYWtlVHJlZUNoaWxkcmVuKGRhdGEsIGUuZGF0YSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICByZXR1cm4gcjtcclxuICB9ICAgXHJcbiAgcHJpdmF0ZSBtYWtlVHJlZUNoaWxkcmVuKGRhdGEsIHRyZWVJbmZvKSB7XHJcbiAgICBjb25zdCBwTGF5ZXIgPSB0cmVlSW5mby5sYXllciArIDE7ICAgICAgXHJcblxyXG4gICAgcmV0dXJuIGRhdGEuZmlsdGVyKCBjID0+IGMubGF5ZXIgPT09IHBMYXllciAmJiBjLnBhcmVudElEPT09dHJlZUluZm8uaWQpLm1hcCggZCA9PiB7XHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICBkYXRhOiBkLFxyXG4gICAgICAgICAgY2hpbGRyZW46IHRoaXMubWFrZVRyZWVDaGlsZHJlbihkYXRhLCBkKSxcclxuICAgICAgICAgIGV4cGFuZGVkOiBmYWxzZVxyXG4gICAgICB9O1xyXG4gICAgfSk7XHJcbiAgfVxyXG59XHJcbiJdfQ==
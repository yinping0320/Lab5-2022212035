/**
 * @fileoverview added by tsickle
 * Generated from: lib/views/bo-tree-panel/bo-tree-panel.component.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, ViewChild, EventEmitter, Output, Input } from '@angular/core';
import { BOTreePanelState } from './bo-tree-panel.state';
import { BusinessObjectRtService } from '@gsp-lcm/bo-rt-service';
import { TreeTableComponent } from '@farris/ui-treetable';
// 设置需要显示的值
/** @type {?} */
var CUSTOM_TEMPLATE_STRING = '{{ node.name }} ({{ node.subTitle }})';
var BOTreePanelComponent = /** @class */ (function () {
    // 注入文件树数据获取服务，以获取数据
    function BOTreePanelComponent(boRtService, boTreePanelState) {
        this.boRtService = boRtService;
        this.boTreePanelState = boTreePanelState;
        this.selectionChanged = new EventEmitter();
        this.cols = [
            { field: 'name', title: 'Name', width: 200 }
        ];
        this.customTemplateStringOptions = { treeNodeTemplate: CUSTOM_TEMPLATE_STRING };
        this.getInitBOTreeData();
    }
    /**
     * 获取根目录树
     */
    /**
     * 获取根目录树
     * @return {?}
     */
    BOTreePanelComponent.prototype.getInitBOTreeData = /**
     * 获取根目录树
     * @return {?}
     */
    function () {
        var _this = this;
        this.boRtService.getBusinessObjects().subscribe((/**
         * @param {?} res
         * @return {?}
         */
        function (res) {
            if (res instanceof Array) {
                res.forEach((/**
                 * @param {?} item
                 * @return {?}
                 */
                function (item) {
                    if (item.parentID === undefined || item.parentID === null || item.parentID === '') {
                        item.parentID = undefined;
                    }
                    if (item.sysInit === '1') {
                        item.isSysInit = true;
                    }
                    else {
                        item.isSysInit = false;
                    }
                }));
            }
            else {
                if (res.parentID === undefined || res.parentID === null || res.parentID === '') {
                    res.parentID = undefined;
                    if (res.sysInit === '1') {
                        res.isSysInit = true;
                    }
                    else {
                        res.isSysInit = false;
                    }
                }
            }
            _this.treeNodes = _this.makeTree(res);
        }));
    };
    /**
     * @param {?} id
     * @param {?=} detectChanges
     * @return {?}
     */
    BOTreePanelComponent.prototype.selectNode = /**
     * @param {?} id
     * @param {?=} detectChanges
     * @return {?}
     */
    function (id, detectChanges) {
        this.treetable.selectNode(id, detectChanges);
    };
    /**
     * @param {?} $event
     * @return {?}
     */
    BOTreePanelComponent.prototype.doubleClickEventHandler = /**
     * @param {?} $event
     * @return {?}
     */
    function ($event) {
        this.boTreePanelState.boTreeNodeDoubleClick.emit($event.node);
    };
    /**
     * @return {?}
     */
    BOTreePanelComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
    };
    /**
     * @param {?} $event
     * @return {?}
     */
    BOTreePanelComponent.prototype.selectionChange = /**
     * @param {?} $event
     * @return {?}
     */
    function ($event) {
        this.selctedBO = $event.node.data;
        this.selectionChanged.emit($event.node);
    };
    /**
     * @return {?}
     */
    BOTreePanelComponent.prototype.refresh = /**
     * @return {?}
     */
    function () {
        this.getInitBOTreeData();
    };
    /**
     * @private
     * @param {?} data
     * @return {?}
     */
    BOTreePanelComponent.prototype.makeTree = /**
     * @private
     * @param {?} data
     * @return {?}
     */
    function (data) {
        var _this = this;
        /** @type {?} */
        var r = data.filter((/**
         * @param {?} t
         * @return {?}
         */
        function (t) { return t.layer === 1; })).map((/**
         * @param {?} t
         * @return {?}
         */
        function (t) {
            return {
                id: t.id,
                data: t,
                children: [],
                expanded: true
            };
        }));
        r.forEach((/**
         * @param {?} e
         * @return {?}
         */
        function (e) {
            e.children = _this.makeTreeChildren(data, e.data);
        }));
        return r;
    };
    /**
     * @private
     * @param {?} data
     * @param {?} treeInfo
     * @return {?}
     */
    BOTreePanelComponent.prototype.makeTreeChildren = /**
     * @private
     * @param {?} data
     * @param {?} treeInfo
     * @return {?}
     */
    function (data, treeInfo) {
        var _this = this;
        /** @type {?} */
        var pLayer = treeInfo.layer + 1;
        return data.filter((/**
         * @param {?} c
         * @return {?}
         */
        function (c) { return c.layer === pLayer && c.parentID === treeInfo.id; })).map((/**
         * @param {?} d
         * @return {?}
         */
        function (d) {
            return {
                data: d,
                children: _this.makeTreeChildren(data, d),
                expanded: false
            };
        }));
    };
    BOTreePanelComponent.decorators = [
        { type: Component, args: [{
                    selector: 'app-bo-tree-panel',
                    template: "\r\n<div  #test class=\"botreepanel farris-main-area flex-column\">\r\n  <farris-treetable #treetable class=\"farris-overflow-y-auto flex-fill\"\r\n    [data]=\"treeNodes\" \r\n    [columns]=\"cols\" \r\n    [fit] =\"true\" \r\n    [fixedHeader]=\"true\" \r\n    [idField]=\"'id'\" \r\n    [checkOnSelect]=\"true\"  \r\n    [showIcon]=\"showIcon\"\r\n    [showHeader]=\"false\" \r\n    (nodeSelected)=\"selectionChange($event)\">\r\n  </farris-treetable>\r\n</div>",
                    styles: [".botreepanel{overflow:hidden;cursor:pointer;-webkit-user-select:none;-ms-user-select:none;-moz-user-select:none;user-select:none;white-space:nowrap}"]
                }] }
    ];
    /** @nocollapse */
    BOTreePanelComponent.ctorParameters = function () { return [
        { type: BusinessObjectRtService },
        { type: BOTreePanelState }
    ]; };
    BOTreePanelComponent.propDecorators = {
        showIcon: [{ type: Input }],
        selectionChanged: [{ type: Output }],
        treetable: [{ type: ViewChild, args: ['treetable',] }]
    };
    return BOTreePanelComponent;
}());
export { BOTreePanelComponent };
if (false) {
    /** @type {?} */
    BOTreePanelComponent.prototype.showIcon;
    /** @type {?} */
    BOTreePanelComponent.prototype.selectionChanged;
    /** @type {?} */
    BOTreePanelComponent.prototype.treetable;
    /** @type {?} */
    BOTreePanelComponent.prototype.cols;
    /** @type {?} */
    BOTreePanelComponent.prototype.treeNodes;
    /** @type {?} */
    BOTreePanelComponent.prototype.selctedBO;
    /** @type {?} */
    BOTreePanelComponent.prototype.customTemplateStringOptions;
    /** @type {?} */
    BOTreePanelComponent.prototype.boRtService;
    /**
     * @type {?}
     * @private
     */
    BOTreePanelComponent.prototype.boTreePanelState;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYm8tdHJlZS1wYW5lbC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZ3NwLWxjbS9iby10cmVlLyIsInNvdXJjZXMiOlsibGliL3ZpZXdzL2JvLXRyZWUtcGFuZWwvYm8tdHJlZS1wYW5lbC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFVLFNBQVMsRUFBRSxZQUFZLEVBQUUsTUFBTSxFQUFFLEtBQUssRUFBQyxNQUFNLGVBQWUsQ0FBQztBQUN6RixPQUFPLEVBQUUsZ0JBQWdCLEVBQUMsTUFBTSx1QkFBdUIsQ0FBQztBQUN4RCxPQUFPLEVBQUUsdUJBQXVCLEVBQUUsTUFBTSx3QkFBd0IsQ0FBQztBQUNqRSxPQUFPLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQzs7O0lBRXBELHNCQUFzQixHQUFHLHVDQUF1QztBQUV0RTtJQWtCRSxvQkFBb0I7SUFDcEIsOEJBQW1CLFdBQW9DLEVBQVUsZ0JBQWtDO1FBQWhGLGdCQUFXLEdBQVgsV0FBVyxDQUF5QjtRQUFVLHFCQUFnQixHQUFoQixnQkFBZ0IsQ0FBa0I7UUFYekYscUJBQWdCLEdBQUcsSUFBSSxZQUFZLEVBQU8sQ0FBQztRQUVyRCxTQUFJLEdBQUc7WUFDTCxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRSxLQUFLLEVBQUUsR0FBRyxFQUFDO1NBQzVDLENBQUM7UUFJRixnQ0FBMkIsR0FBRyxFQUFFLGdCQUFnQixFQUFFLHNCQUFzQixFQUFFLENBQUM7UUFJekUsSUFBSSxDQUFDLGlCQUFpQixFQUFFLENBQUM7SUFDM0IsQ0FBQztJQUVEOztPQUVHOzs7OztJQUNILGdEQUFpQjs7OztJQUFqQjtRQUFBLGlCQXlCQztRQXhCQyxJQUFJLENBQUMsV0FBVyxDQUFDLGtCQUFrQixFQUFFLENBQUMsU0FBUzs7OztRQUFDLFVBQUMsR0FBUTtZQUN2RCxJQUFJLEdBQUcsWUFBWSxLQUFL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QUssR0FBRyxDQUFDO1FBRWpDLE9BQU8sSUFBSSxDQUFDLE1BQU07Ozs7UUFBRSxVQUFBLENBQUMsSUFBSSxPQUFBLENBQUMsQ0FBQyxLQUFLLEtBQUssTUFBTSxJQUFJLENBQUMsQ0FBQyxRQUFRLEtBQUcsUUFBUSxDQUFDLEVBQUUsRUFBOUMsQ0FBOEMsRUFBQyxDQUFDLEdBQUc7Ozs7UUFBRSxVQUFBLENBQUM7WUFDN0UsT0FBTztnQkFDSCxJQUFJLEVBQUUsQ0FBQztnQkFDUCxRQUFRLEVBQUUsS0FBSSxDQUFDLGdCQUFnQixDQUFDLElBQUksRUFBRSxDQUFDLENBQUM7Z0JBQ3hDLFFBQVEsRUFBRSxLQUFLO2FBQ2xCLENBQUM7UUFDSixDQUFDLEVBQUMsQ0FBQztJQUNMLENBQUM7O2dCQXBHRixTQUFTLFNBQUM7b0JBQ1QsUUFBUSxFQUFFLG1CQUFtQjtvQkFDN0IsNGRBQTZDOztpQkFFOUM7Ozs7Z0JBVFEsdUJBQXVCO2dCQUR2QixnQkFBZ0I7OzsyQkFhdEIsS0FBSzttQ0FDTCxNQUFNOzRCQUNOLFNBQVMsU0FBQyxXQUFXOztJQTRGeEIsMkJBQUM7Q0FBQSxBQXJHRCxJQXFHQztTQS9GWSxvQkFBb0I7OztJQUMvQix3Q0FBNEI7O0lBQzVCLGdEQUFxRDs7SUFDckQseUNBQXVEOztJQUN2RCxvQ0FFRTs7SUFFRix5Q0FBaUI7O0lBQ2pCLHlDQUFlOztJQUNmLDJEQUEyRTs7SUFHL0QsMkNBQTJDOzs7OztJQUFFLGdEQUEwQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgT25Jbml0LCBWaWV3Q2hpbGQsIEV2ZW50RW1pdHRlciwgT3V0cHV0LCBJbnB1dH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IEJPVHJlZVBhbmVsU3RhdGV9IGZyb20gJy4vYm8tdHJlZS1wYW5lbC5zdGF0ZSc7XHJcbmltcG9ydCB7IEJ1c2luZXNzT2JqZWN0UnRTZXJ2aWNlIH0gZnJvbSAnQGdzcC1sY20vYm8tcnQtc2VydmljZSc7XHJcbmltcG9ydCB7IFRyZWVUYWJsZUNvbXBvbmVudCB9IGZyb20gJ0BmYXJyaXMvdWktdHJlZXRhYmxlJzsgXHJcbi8vIOiuvue9rumcgOimgeaYvuekuueahOWAvFxyXG5jb25zdCBDVVNUT01fVEVNUExBVEVfU1RSSU5HID0gJ3t7IG5vZGUubmFtZSB9fSAoe3sgbm9kZS5zdWJUaXRsZSB9fSknO1xyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgc2VsZWN0b3I6ICdhcHAtYm8tdHJlZS1wYW5lbCcsXHJcbiAgdGVtcGxhdGVVcmw6ICcuL2JvLXRyZWUtcGFuZWwuY29tcG9uZW50Lmh0bWwnLFxyXG4gIHN0eWxlVXJsczogWycuL2JvLXRyZWUtcGFuZWwuY29tcG9uZW50LmNzcyddLFxyXG59KVxyXG5cclxuZXhwb3J0IGNsYXNzIEJPVHJlZVBhbmVsQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcclxuICBASW5wdXQoKSBzaG93SWNvbiA6IGJvb2xlYW47XHJcbiAgQE91dHB1dCgpIHNlbGVjdGlvbkNoYW5nZWQgPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcclxuICBAVmlld0NoaWxkKCd0cmVldGFibGUnKSB0cmVldGFibGUgOiBUcmVlVGFibGVDb21wb25lbnQ7XHJcbiAgY29scyA9IFtcclxuICAgIHsgZmllbGQ6ICduYW1lJywgdGl0bGU6ICdOYW1lJywgd2lkdGg6IDIwMH1cclxuICBdO1xyXG4gIC8vIOiOt+WPluaVsOaNrlxyXG4gIHRyZWVOb2RlczogYW55W107XHJcbiAgc2VsY3RlZEJPOiBhbnk7XHJcbiAgY3VzdG9tVGVtcGxhdGVTdHJpbmdPcHRpb25zID0geyB0cmVlTm9kZVRlbXBsYXRlOiBDVVNUT01fVEVNUExBVEVfU1RSSU5HIH07XHJcbiAgXHJcbiAgLy8g5rOo5YWl5paH5Lu25qCR5pWw5o2u6I635Y+W5pyN5Yqh77yM5Lul6I635Y+W5pWw5o2uXHJcbiAgY29uc3RydWN0b3IocHVibGljIGJvUnRTZXJ2aWNlOiBCdXNpbmVzc09iamVjdFJ0U2VydmljZSwgcHJpdmF0ZSBib1RyZWVQYW5lbFN0YXRlOiBCT1RyZWVQYW5lbFN0YXRlKSB7XHJcbiAgICB0aGlzLmdldEluaXRCT1RyZWVEYXRhKCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDojrflj5bmoLnnm67lvZXmoJFcclxuICAgKi9cclxuICBnZXRJbml0Qk9UcmVlRGF0YSgpIHtcclxuICAgIHRoaXMuYm9SdFNlcnZpY2UuZ2V0QnVzaW5lc3NPYmplY3RzKCkuc3Vic2NyaWJlKChyZXM6IGFueSkgPT4ge1xyXG4gICAgICBpZiAocmVzIGluc3RhbmNlb2YgQXJyYXkpIHtcclxuICAgICAgICByZXMuZm9yRWFjaCgoaXRlbSkgPT4gey8vIGtlbmRvVWkgdHJlZXZpZXcgcGFyZW50SWQg5Li656ys5LiA57qn55qE5pe25YCZIOW/hemhu3VuZGVmaW5lZO+8jOW/hemhu+WSjHdlYmFwaeW+l+WIsOWunuS9k+Wkp+Wwj+WGmeS4gOiHtFxyXG4gICAgICAgICAgaWYgKGl0ZW0ucGFyZW50SUQ9PT11bmRlZmluZWQgfHwgaXRlbS5wYXJlbnRJRCA9PT0gbnVsbCB8fCBpdGVtLnBhcmVudElEID09PSAnJykge1xyXG4gICAgICAgICAgICBpdGVtLnBhcmVudElEID0gdW5kZWZpbmVkO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgaWYgKGl0ZW0uc3lzSW5pdCA9PT0gJzEnKSB7XHJcbiAgICAgICAgICAgIGl0ZW0uaXNTeXNJbml0ID0gdHJ1ZTtcclxuICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGl0ZW0uaXNTeXNJbml0ID0gZmFsc2U7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgaWYgKHJlcy5wYXJlbnRJRD09PXVuZGVmaW5lZCB8fCByZXMucGFyZW50SUQgPT09IG51bGwgfHwgcmVzLnBhcmVudElEID09PSAnJykge1xyXG4gICAgICAgICAgcmVzLnBhcmVudElEID0gdW5kZWZpbmVkO1xyXG4gICAgICAgICAgaWYgKHJlcy5zeXNJbml0ID09PSAnMScpIHtcclxuICAgICAgICAgICAgcmVzLmlzU3lzSW5pdCA9IHRydWU7XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICByZXMuaXNTeXNJbml0ID0gZmFsc2U7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICAgIHRoaXMudHJlZU5vZGVzID10aGlzLm1ha2VUcmVlKHJlcyk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIHNlbGVjdE5vZGUoaWQ6IHN0cmluZywgZGV0ZWN0Q2hhbmdlcz86IGJvb2xlYW4pe1xyXG4gICAgdGhpcy50cmVldGFibGUuc2VsZWN0Tm9kZShpZCxkZXRlY3RDaGFuZ2VzKTtcclxuICB9XHJcbiAgXHJcblxyXG5cclxuICBkb3VibGVDbGlja0V2ZW50SGFuZGxlcigkZXZlbnQpIHtcclxuICAgICAgICB0aGlzLmJvVHJlZVBhbmVsU3RhdGUuYm9UcmVlTm9kZURvdWJsZUNsaWNrLmVtaXQoJGV2ZW50Lm5vZGUpO1xyXG4gIH1cclxuXHJcblxyXG4gIG5nT25Jbml0KCkge1xyXG4gIH1cclxuICBzZWxlY3Rpb25DaGFuZ2UoJGV2ZW50KSB7XHJcbiAgICB0aGlzLnNlbGN0ZWRCTyA9ICRldmVudC5ub2RlLmRhdGE7XHJcbiAgICB0aGlzLnNlbGVjdGlvbkNoYW5nZWQuZW1pdCgkZXZlbnQubm9kZSk7XHJcbiAgfVxyXG5cclxuICByZWZyZXNoKCkge1xyXG4gICAgdGhpcy5nZXRJbml0Qk9UcmVlRGF0YSgpO1xyXG4gIH1cclxuICBwcml2YXRlIG1ha2VUcmVlKGRhdGEpIHtcclxuICAgIGNvbnN0IHIgPSBkYXRhLmZpbHRlcih0ID0+IHQubGF5ZXIgPT09IDEpLm1hcCh0ID0+IHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBpZDp0LmlkLFxyXG4gICAgICAgICAgICBkYXRhOiB0LFxyXG4gICAgICAgICAgICBjaGlsZHJlbjogW10sXHJcbiAgICAgICAgICAgIGV4cGFuZGVkOiB0cnVlXHJcbiAgICAgICAgfTtcclxuICAgIH0pO1xyXG5cclxuICAgIHIuZm9yRWFjaChlID0+IHtcclxuICAgICAgICBlLmNoaWxkcmVuID0gdGhpcy5tYWtlVHJlZUNoaWxkcmVuKGRhdGEsIGUuZGF0YSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICByZXR1cm4gcjtcclxuICB9ICAgXHJcbiAgcHJpdmF0ZSBtYWtlVHJlZUNoaWxkcmVuKGRhdGEsIHRyZWVJbmZvKSB7XHJcbiAgICBjb25zdCBwTGF5ZXIgPSB0cmVlSW5mby5sYXllciArIDE7ICAgICAgXHJcblxyXG4gICAgcmV0dXJuIGRhdGEuZmlsdGVyKCBjID0+IGMubGF5ZXIgPT09IHBMYXllciAmJiBjLnBhcmVudElEPT09dHJlZUluZm8uaWQpLm1hcCggZCA9PiB7XHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICBkYXRhOiBkLFxyXG4gICAgICAgICAgY2hpbGRyZW46IHRoaXMubWFrZVRyZWVDaGlsZHJlbihkYXRhLCBkKSxcclxuICAgICAgICAgIGV4cGFuZGVkOiBmYWxzZVxyXG4gICAgICB9O1xyXG4gICAgfSk7XHJcbiAgfVxyXG59XHJcbiJdfQ==
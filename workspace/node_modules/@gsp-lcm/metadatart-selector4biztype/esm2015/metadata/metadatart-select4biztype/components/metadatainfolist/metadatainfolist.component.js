/**
 * @fileoverview added by tsickle
 * Generated from: metadata/metadatart-select4biztype/components/metadatainfolist/metadatainfolist.component.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input } from '@angular/core';
import { MetadataInfoService } from '../../metadatainfo.service';
import { TranslateService } from '@ngx-translate/core';
// tslint:disable-next-line:component-class-suffix
export class MetadataInfoList {
    /**
     * @param {?} metadataService
     * @param {?} translate
     */
    constructor(metadataService /**/, translate) {
        this.metadataService = metadataService;
        this.translate = translate;
        this.allType = { text: this.transform('SelectAll'), value: 'All' };
        this.selectedType = this.allType;
        this.typeList = [
            this.allType
        ];
        this.typeListReadonly = false;
        this.searchText = '';
        this.searchTextForDup = '';
        this.Code = this.transform('Code');
        this.dataCache = [];
        this.columns = [];
        this.boId = 'all';
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.columns = [
            { field: 'nameSpace', width: 250, title: this.transform('NameSpace') },
            { field: 'code', width: 200, title: this.transform('Code') },
            { field: 'name', width: 200, title: this.transform('Name') },
            { field: 'type', width: 150, title: this.transform('Type') }
        ];
        // 获取所有的元数据类型列表
        this.metadataService.GetMetadataTypeList().subscribe((/**
         * @param {?} typeList
         * @return {?}
         */
        typeList => {
            if (typeList) {
                typeList.forEach((/**
                 * @param {?} type
                 * @return {?}
                 */
                type => {
                    this.typeList.push({ text: type.typeName, value: type.typeCode });
                }));
            }
        }));
        // 初始化数据
        this.getData();
    }
    /**
     * @return {?}
     */
    clear() {
        this.data = [];
    }
    // tslint:disable-next-line:use-life-cycle-interface
    /**
     * @param {?} changes
     * @return {?}
     */
    ngOnChanges(changes) {
        if (this.searchText) {
            this.onSearchTextChanged();
            return;
        }
        for (const key in changes) {
            if (changes.hasOwnProperty(key)) {
                /** @type {?} */
                const changedProp = changes[key];
                /** @type {?} */
                const currentValue = changedProp.currentValue;
                this.boId = currentValue;
                if (this.dataCache) {
                    /** @type {?} */
                    let dtos = [];
                    dtos = this.filterByBoId(this.dataCache);
                    dtos = this.filterByType(dtos);
                    dtos = this.filterBySearchText(dtos, this.searchText.trim());
                    this.data = dtos;
                }
            }
        }
    }
    /**
     * @param {?} key
     * @return {?}
     */
    transform(key) {
        return this.translate.instant(key);
    }
    /**
     * @return {?}
     */
    onSearchTextChanged() {
        if (!this.searchText) {
            this.searchText = '';
        }
        /** @type {?} */
        const searchTextTrim = this.searchText.trim();
        console.log(this.searchText);
        this.filterData(searchTextTrim);
    }
    /**
     * @param {?} mdSeleted
     * @return {?}
     */
    typeSelectedChanged(mdSeleted) {
        if (!mdSeleted) {
            mdSeleted = this.selectedType;
        }
        else {
            this.selectedType = mdSeleted;
        }
        if (this.searchText) {
            this.onSearchTextChanged();
            return;
        }
        if (mdSeleted) {
            /** @type {?} */
            let dtos = [];
            dtos = this.filterByBoId(this.dataCache);
            dtos = this.filterByType(dtos);
            this.data = dtos;
        }
    }
    /**
     * @return {?}
     */
    goSearch() {
    }
    /**
     * @private
     * @return {?}
     */
    getData() {
        /** @type {?} */
        const metadatadto = [];
        this.metadataService.GetMetadataRTList('').subscribe((/**
         * @param {?} metadataList
         * @return {?}
         */
        metadataList => {
            if (metadataList) {
                this.metadataService.GetMetadataTypeList().subscribe((/**
                 * @param {?} typeList
                 * @return {?}
                 */
                typeList => {
                    if (typeList) {
                        metadataList.forEach((/**
                         * @param {?} item
                         * @return {?}
                         */
                        item => {
                            /** @type {?} */
                            const dto = typeList.find((/**
                             * @param {?} type
                             * @return {?}
                             */
                            type => type.typeCode === item.metadata.type));
                            if (dto) {
                                item.metadata.type = dto.typeName;
                            }
                            metadatadto.push(item.metadata);
                        }));
                    }
                    else {
                        metadataList.forEach((/**
                         * @param {?} item
                         * @return {?}
                         */
                        item => {
                            metadatadto.push(item.metadata);
                        }));
                    }
                    this.data = metadatadto;
                    this.dataCache = metadatadto;
                }));
            }
        }));
    }
    /**
     * @private
     * @param {?} filter
     * @return {?}
     */
    filterData(filter) {
        /** @type {?} */
        let dtos = [];
        dtos = this.filterByBoId(this.dataCache);
        dtos = this.filterByType(dtos);
        dtos = this.filterBySearchText(dtos, filter);
        this.data = dtos;
    }
    /**
     * @private
     * @param {?} datas
     * @return {?}
     */
    filterByType(datas) {
        /** @type {?} */
        let dtos = [];
        if (this.selectedType.value === 'All') {
            dtos = datas;
        }
        else {
            datas.forEach((/**
             * @param {?} data
             * @return {?}
             */
            data => {
                this.data;
                // tslint:disable-next-line:max-line-length
                if (data.type === this.selectedType.text) {
                    dtos.push(data);
                }
            }));
        }
        return dtos;
    }
    /**
     * @private
     * @param {?} datas
     * @return {?}
     */
    filterByBoId(datas) {
        /** @type {?} */
        let dtos = [];
        if (!this.boId) {
            dtos = datas;
        }
        else {
            datas.forEach((/**
             * @param {?} data
             * @return {?}
             */
            data => {
                // tslint:disable-next-line:max-line-length
                if (data.bizobjectID === this.boId) {
                    dtos.push(data);
                }
            }));
        }
        return dtos;
    }
    /**
     * @private
     * @param {?} datas
     * @param {?} text
     * @return {?}
     */
    filterBySearchText(datas, text) {
        /** @type {?} */
        let dtos = [];
        if (!text) {
            dtos = datas;
        }
        else {
            datas.forEach((/**
             * @param {?} data
             * @return {?}
             */
            data => {
                if (data.code.toLowerCase().indexOf(text.toLowerCase()) > -1 || data.name.toLowerCase().indexOf(text.toLowerCase()) > -1) {
                    dtos.push(data);
                }
            }));
        }
        return dtos;
    }
    // 选中元数据后的事件处理
    /**
     * @param {?} event
     * @return {?}
     */
    onSelectionChange(event) {
        if (event.selectedRows.length > 0) {
            this.metadataService.clearMetadataRT();
            /** @type {?} */
            const metadata = {
                ID: event.selectedRows[0].dataItem.id,
                RelativePath: event.selectedRows[0].dataItem.relativePath,
                FileName: event.selectedRows[0].dataItem.fileName
            };
            this.metadataService.addMetadataRT(metadata);
        }
    }
    /**
     * @param {?} $event
     * @return {?}
     */
    onPageSizeChanged($event) {
        console.log('PageSize Changed:', $event);
    }
    /**
     * @param {?} $event
     * @return {?}
     */
    onPageChanged($event) {
        console.log('PageNumber Changed:', $event);
    }
    /**
     * @param {?} event
     * @return {?}
     */
    checkedChange(event) {
        if (event != null && event.length > 0) {
            this.metadataService.clearMetadataRT();
            event.forEach((/**
             * @param {?} element
             * @return {?}
             */
            element => {
                /** @type {?} */
                const metadata = {
                    ID: element.data.id,
                    Name: element.data.name,
                    Code: element.data.code,
                    Type: element.data.type,
                    NameSpace: element.data.nameSpace
                };
                this.metadataService.addMetadataRT(metadata);
            }));
        }
    }
}
MetadataInfoList.decorators = [
    { type: Component, args: [{
                // tslint:disable-next-line:component-selector
                selector: 'app-metadatainfolist',
                template: "<div class=\"templateInfo d-flex flex-column h-100\">\r\n  <div class=\"templateSelectorHeader m-2 flex-shrink-0\">\r\n    <div class=\"searchArea d-flex flex-row\">\r\n\r\n      <input id=\"url\" class=\"textInput flex-fill\" type=\"text\" size=\"30\" kendoTextBox [(ngModel)]=\"this.searchText\"\r\n        #url=\"ngModel\" (ngModelChange)=\"onSearchTextChanged()\">\r\n      <button type=\"button\" class=\"btn btn-light btn-sm px-3 mx-2\"\r\n          (click)=\"goSearch()\">{{ 'Search' | translate }}</button>\r\n\r\n      <kendo-combobox [readonly]=\"this.typeListReadonly\" [data]=\"typeList\" [(ngModel)]=\"selectedType\"\r\n        [textField]=\"'text'\" [valueField]=\"'value'\"  (selectionChange)=\"typeSelectedChanged($event)\">\r\n      </kendo-combobox>\r\n    </div>\r\n   </div>\r\n\r\n    <div class=\"templateSelector farris-overflow-y-auto flex-fill f-utils-fill-flex-column\">\r\n      <farris-datagrid class=\"f-utils-fill\"\r\n      [columns]=\"columns\" [data]=\"data\" [showBorder]=\"true\"\r\n      [showLineNumber]=\"true\" [fit]=\"true\"\r\n      [striped]=\"true\"\r\n      [pagerOnServer]=\"false\"\r\n      [pagination]=\"true\" [pageSize]=\"10\" [showPageList]=\"true\"\r\n      (pageChanged)=\"onPageChanged($event)\" (pageSizeChanged)=\"onPageSizeChanged($event)\"\r\n      [fitColumns]=\"true\"\r\n      [autoFitColumns]=\"true\"\r\n      [multiSelect]=\"true\"\r\n      [showAllCheckbox]=\"true\"\r\n      [selectOnCheck]=\"true\"\r\n      [checkOnSelect]=\"true\"\r\n      [onlySelectSelf]=\"true\"\r\n      [showCheckbox]=\"true\"\r\n      [multiSelect]=\"true\"\r\n      [keepSelect]=\"true\"\r\n      (checkedChange) = \"checkedChange($event)\">\r\n      </farris-datagrid>\r\n    </div>\r\n  </div>\r\n\r\n",
                styles: [""]
            }] }
];
/** @nocollapse */
MetadataInfoList.ctorParameters = () => [
    { type: MetadataInfoService },
    { type: TranslateService }
];
MetadataInfoList.propDecorators = {
    boId: [{ type: Input }]
};
if (false) {
    /** @type {?} */
    MetadataInfoList.prototype.boId;
    /** @type {?} */
    MetadataInfoList.prototype.allType;
    /** @type {?} */
    MetadataInfoList.prototype.selectedType;
    /** @type {?} */
    MetadataInfoList.prototype.typeList;
    /** @type {?} */
    MetadataInfoList.prototype.typeListReadonly;
    /** @type {?} */
    MetadataInfoList.prototype.searchText;
    /** @type {?} */
    MetadataInfoList.prototype.searchTextForDup;
    /** @type {?} */
    MetadataInfoList.prototype.Code;
    /** @type {?} */
    MetadataInfoList.prototype.data;
    /** @type {?} */
    MetadataInfoList.prototype.dataCache;
    /** @type {?} */
    MetadataInfoList.prototype.columns;
    /**
     * @type {?}
     * @private
     */
    MetadataInfoList.prototype.metadataService;
    /**
     * @type {?}
     * @private
     */
    MetadataInfoList.prototype.translate;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWV0YWRhdGFpbmZvbGlzdC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZ3NwLWxjbS9tZXRhZGF0YXJ0LXNlbGVjdG9yNGJpenR5cGUvIiwic291cmNlcyI6WyJtZXRhZGF0YS9tZXRhZGF0YXJ0LXNlbGVjdDRiaXp0eXBlL2NvbXBvbmVudHMvbWV0YWRhdGFpbmZvbGlzdC9tZXRhZGF0YWluZm9saXN0LmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQW9DLEtBQUssRUFBd0IsTUFBTSxlQUFlLENBQUM7QUFFekcsT0FBTyxFQUFFLG1CQUFtQixFQUFFLE1BQU0sNEJBQTRCLENBQUM7QUFDakUsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFRdkQsa0RBQWtEO0FBQ2xELE1BQU0sT0FBTyxnQkFBZ0I7Ozs7O0lBZTNCLFlBQW9CLGVBQW9DLENBQUEsSUFBSSxFQUFXLFNBQTJCO1FBQTlFLG9CQUFlLEdBQWYsZUFBZSxDQUFxQjtRQUFlLGNBQVMsR0FBVCxTQUFTLENBQWtCO1FBYmxHLFlBQU8sR0FBRyxFQUFFLElBQUksRUFBRSxJQUFJLENBQUMsU0FBUyxDQUFDLFdBQVcsQ0FBQyxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUUsQ0FBQztRQUM5RCxpQkFBWSxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUM7UUFDNUIsYUFBUSxHQUEyQztZQUNqRCxJQUFJLENBQUMsT0FBTztTQUNiLENBQUM7UUFDRixxQkFBZ0IsR0FBRyxLQUFLLENBQUM7UUFDekIsZUFBVSxHQUFHLEVBQUUsQ0FBQztRQUNoQixxQkFBZ0IsR0FBRyxFQUFFLENBQUM7UUFDdEIsU0FBSSxHQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsTUFBTSxDQUFDLENBQUM7UUFFNUIsY0FBUyxHQUFVLEVBQUUsQ0FBQztRQUN0QixZQUFPLEdBQUksRUFBRSxDQUFDO1FBR1osSUFBSSxDQUFDLElBQUks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TyxDQUFDLElBQUksQ0FBQyxJQUFJO29CQUN2QixJQUFJLEVBQUUsT0FBTyxDQUFDLElBQUksQ0FBQyxJQUFJO29CQUN2QixTQUFTLEVBQUUsT0FBTyxDQUFDLElBQUksQ0FBQyxTQUFTO2lCQUNsQztnQkFDRCxJQUFJLENBQUMsZUFBZSxDQUFDLGFBQWEsQ0FBQyxRQUFRLENBQUMsQ0FBQztZQUMvQyxDQUFDLEVBQUMsQ0FBQztTQUNKO0lBQ0gsQ0FBQzs7O1lBcE5GLFNBQVMsU0FBQzs7Z0JBRVQsUUFBUSxFQUFFLHNCQUFzQjtnQkFDaEMsOHREQUFnRDs7YUFFakQ7Ozs7WUFSUSxtQkFBbUI7WUFDbkIsZ0JBQWdCOzs7bUJBVXRCLEtBQUs7Ozs7SUFBTixnQ0FBc0I7O0lBQ3RCLG1DQUE4RDs7SUFDOUQsd0NBQTRCOztJQUM1QixvQ0FFRTs7SUFDRiw0Q0FBeUI7O0lBQ3pCLHNDQUFnQjs7SUFDaEIsNENBQXNCOztJQUN0QixnQ0FBNEI7O0lBQzVCLGdDQUF5Qjs7SUFDekIscUNBQXNCOztJQUN0QixtQ0FBYzs7Ozs7SUFFRiwyQ0FBNEM7Ozs7O0lBQU8scUNBQW1DIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCAgT25Jbml0LCBTaW1wbGVDaGFuZ2UsIE9uQ2hhbmdlcywgSW5wdXQsIE91dHB1dCwgRXZlbnRFbWl0dGVyIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IE1ldGFkYXRhQmFzZUluZm8gfSBmcm9tICcuLi8uLi9tZXRhZGF0YWJhc2VpbmZvJztcclxuaW1wb3J0IHsgTWV0YWRhdGFJbmZvU2VydmljZSB9IGZyb20gJy4uLy4uL21ldGFkYXRhaW5mby5zZXJ2aWNlJztcclxuaW1wb3J0IHsgVHJhbnNsYXRlU2VydmljZSB9IGZyb20gJ0BuZ3gtdHJhbnNsYXRlL2NvcmUnO1xyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOmNvbXBvbmVudC1zZWxlY3RvclxyXG4gIHNlbGVjdG9yOiAnYXBwLW1ldGFkYXRhaW5mb2xpc3QnLFxyXG4gIHRlbXBsYXRlVXJsOiAnLi9tZXRhZGF0YWluZm9saXN0LmNvbXBvbmVudC5odG1sJyxcclxuICBzdHlsZVVybHM6IFsnLi9tZXRhZGF0YWluZm9saXN0LmNvbXBvbmVudC5jc3MnXVxyXG59KVxyXG4vLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6Y29tcG9uZW50LWNsYXNzLXN1ZmZpeFxyXG5leHBvcnQgY2xhc3MgTWV0YWRhdGFJbmZvTGlzdCBpbXBsZW1lbnRzIE9uSW5pdCwgT25DaGFuZ2VzIHtcclxuICBASW5wdXQoKSBib0lkOiBzdHJpbmc7XHJcbiAgYWxsVHlwZSA9IHsgdGV4dDogdGhpcy50cmFuc2Zvcm0oJ1NlbGVjdEFsbCcpLCB2YWx1ZTogJ0FsbCcgfTtcclxuICBzZWxlY3RlZFR5cGUgPSB0aGlzLmFsbFR5cGU7XHJcbiAgdHlwZUxpc3Q6IEFycmF5PHsgdGV4dDogc3RyaW5nLCB2YWx1ZTogc3RyaW5nIH0+ID0gW1xyXG4gICAgdGhpcy5hbGxUeXBlXHJcbiAgXTtcclxuICB0eXBlTGlzdFJlYWRvbmx5ID0gZmFsc2U7XHJcbiAgc2VhcmNoVGV4dCA9ICcnO1xyXG4gIHNlYXJjaFRleHRGb3JEdXAgPSAnJztcclxuICBDb2RlPXRoaXMudHJhbnNmb3JtKCdDb2RlJyk7XHJcbiAgZGF0YTogTWV0YWRhdGFCYXNlSW5mb1tdO1xyXG4gIGRhdGFDYWNoZTogYW55W10gPSBbXTtcclxuICBjb2x1bW5zID0gIFtdO1xyXG5cclxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIG1ldGFkYXRhU2VydmljZTogTWV0YWRhdGFJbmZvU2VydmljZS8qKi8sICBwcml2YXRlIHRyYW5zbGF0ZTogVHJhbnNsYXRlU2VydmljZSkge1xyXG4gICAgdGhpcy5ib0lkID0gJ2FsbCc7XHJcbiAgfVxyXG5cclxuICBuZ09uSW5pdCgpIHtcclxuICAgIHRoaXMuY29sdW1ucz1bXHJcbiAgICAgIHsgZmllbGQ6ICduYW1lU3BhY2UnLCB3aWR0aDogMjUwLCB0aXRsZTogdGhpcy50cmFuc2Zvcm0oJ05hbWVTcGFjZScpICB9LFxyXG4gICAgICB7IGZpZWxkOiAnY29kZScsIHdpZHRoOiAyMDAsIHRpdGxlOiB0aGlzLnRyYW5zZm9ybSgnQ29kZScpfSxcclxuICAgICAgeyBmaWVsZDogJ25hbWUnLCB3aWR0aDogMjAwLCB0aXRsZTogdGhpcy50cmFuc2Zvcm0oJ05hbWUnKX0sXHJcbiAgICAgIHsgZmllbGQ6ICd0eXBlJywgd2lkdGg6IDE1MCwgdGl0bGU6IHRoaXMudHJhbnNmb3JtKCdUeXBlJyl9ICAgXHJcbiAgICBdO1xyXG4gICAgLy8g6I635Y+W5omA5pyJ55qE5YWD5pWw5o2u57G75Z6L5YiX6KGoXHJcbiAgICB0aGlzLm1ldGFkYXRhU2VydmljZS5HZXRNZXRhZGF0YVR5cGVMaXN0KCkuc3Vic2NyaWJlKHR5cGVMaXN0ID0+IHtcclxuICAgICAgaWYgKHR5cGVMaXN0KSB7XHJcbiAgICAgICAgdHlwZUxpc3QuZm9yRWFjaCh0eXBlID0+IHtcclxuICAgICAgICAgIHRoaXMudHlwZUxpc3QucHVzaCh7IHRleHQ6IHR5cGUudHlwZU5hbWUsIHZhbHVlOiB0eXBlLnR5cGVDb2RlIH0pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICAgIC8vIOWIneWni+WMluaVsOaNrlxyXG4gICAgdGhpcy5nZXREYXRhKCk7XHJcbiAgfVxyXG4gIGNsZWFyKCkge1xyXG4gICAgdGhpcy5kYXRhID0gW107XHJcbiAgfVxyXG5cclxuICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6dXNlLWxpZmUtY3ljbGUtaW50ZXJmYWNlXHJcbiAgbmdPbkNoYW5nZXMoY2hhbmdlczogeyBbcHJvcEtleTogc3RyaW5nXTogU2ltcGxlQ2hhbmdlIH0pIHtcclxuICAgIGlmICh0aGlzLnNlYXJjaFRleHQpIHtcclxuICAgICAgdGhpcy5vblNlYXJjaFRleHRDaGFuZ2VkKCk7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGZvciAoY29uc3Qga2V5IGluIGNoYW5nZXMpIHtcclxuICAgICAgaWYgKGNoYW5nZXMuaGFzT3duUHJvcGVydHkoa2V5KSkge1xyXG4gICAgICAgIGNvbnN0IGNoYW5nZWRQcm9wID0gY2hhbmdlc1trZXldO1xyXG4gICAgICAgIGNvbnN0IGN1cnJlbnRWYWx1ZSA9IGNoYW5nZWRQcm9wLmN1cnJlbnRWYWx1ZTtcclxuICAgICAgICB0aGlzLmJvSWQ9Y3VycmVudFZhbHVlO1xyXG4gICAgICAgIGlmKHRoaXMuZGF0YUNhY2hlKXtcclxuICAgICAgICAgIGxldCBkdG9zPVtdO1xyXG4gICAgICAgICAgZHRvcz10aGlzLmZpbHRlckJ5Qm9JZCh0aGlzLmRhdGFDYWNoZSk7XHJcbiAgICAgICAgICBkdG9zPXRoaXMuZmlsdGVyQnlUeXBlKGR0b3MpO1xyXG4gICAgICAgICAgZHRvcz10aGlzLmZpbHRlckJ5U2VhcmNoVGV4dChkdG9zLHRoaXMuc2VhcmNoVGV4dC50cmltKCkpO1xyXG4gICAgICAgICAgdGhpcy5kYXRhPWR0b3M7XHJcbiAgICAgICAgfSAgICAgICAgXHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIHRyYW5zZm9ybShrZXk6IHN0cmluZykge1xyXG4gICAgcmV0dXJuIHRoaXMudHJhbnNsYXRlLmluc3RhbnQoa2V5KTtcclxuICB9XHJcblxyXG4gIG9uU2VhcmNoVGV4dENoYW5nZWQoKSB7XHJcbiAgICBpZiAoIXRoaXMuc2VhcmNoVGV4dCkgeyB0aGlzLnNlYXJjaFRleHQgPSAnJzsgfVxyXG4gICAgY29uc3Qgc2VhcmNoVGV4dFRyaW0gPSB0aGlzLnNlYXJjaFRleHQudHJpbSgpO1xyXG4gICAgY29uc29sZS5sb2codGhpcy5zZWFyY2hUZXh0KTtcclxuICAgIHRoaXMuZmlsdGVyRGF0YShzZWFyY2hUZXh0VHJpbSk7XHJcbiAgfVxyXG5cclxuICB0eXBlU2VsZWN0ZWRDaGFuZ2VkKG1kU2VsZXRlZCkge1xyXG4gICAgaWYgKCFtZFNlbGV0ZWQpIHtcclxuICAgICAgbWRTZWxldGVkID0gdGhpcy5zZWxlY3RlZFR5cGU7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLnNlbGVjdGVkVHlwZSA9IG1kU2VsZXRlZDtcclxuICAgIH1cclxuICAgIGlmICh0aGlzLnNlYXJjaFRleHQpIHtcclxuICAgICAgdGhpcy5vblNlYXJjaFRleHRDaGFuZ2VkKCk7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGlmIChtZFNlbGV0ZWQpIHtcclxuICAgICAgbGV0IGR0b3M9IFtdO1xyXG4gICAgICBkdG9zPXRoaXMuZmlsdGVyQnlCb0lkKHRoaXMuZGF0YUNhY2hlKTtcclxuICAgICAgZHRvcz10aGlzLmZpbHRlckJ5VHlwZShkdG9zKTtcclxuICAgICAgdGhpcy5kYXRhPWR0b3M7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBnb1NlYXJjaCgpIHtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgZ2V0RGF0YSgpIHtcclxuICAgIGNvbnN0IG1ldGFkYXRhZHRvID0gW107XHJcbiAgICB0aGlzLm1ldGFkYXRhU2VydmljZS5HZXRNZXRhZGF0YVJUTGlzdCgnJykuc3Vic2NyaWJlKG1ldGFkYXRhTGlzdCA9PiB7XHJcbiAgICAgIGlmIChtZXRhZGF0YUxpc3QpIHtcclxuICAgICAgICB0aGlzLm1ldGFkYXRhU2VydmljZS5HZXRNZXRhZGF0YVR5cGVMaXN0KCkuc3Vic2NyaWJlKHR5cGVMaXN0ID0+IHtcclxuICAgICAgICAgIGlmICh0eXBlTGlzdCkge1xyXG4gICAgICAgICAgICBtZXRhZGF0YUxpc3QuZm9yRWFjaChpdGVtID0+IHtcclxuICAgICAgICAgICAgICBjb25zdCBkdG8gPSB0eXBlTGlzdC5maW5kKHR5cGUgPT4gdHlwZS50eXBlQ29kZSA9PT0gaXRlbS5tZXRhZGF0YS50eXBlKTtcclxuICAgICAgICAgICAgICBpZiAoZHRvKSB7XHJcbiAgICAgICAgICAgICAgICBpdGVtLm1ldGFkYXRhLnR5cGUgPSBkdG8udHlwZU5hbWU7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIG1ldGFkYXRhZHRvLnB1c2goaXRlbS5tZXRhZGF0YSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgbWV0YWRhdGFMaXN0LmZvckVhY2goaXRlbSA9PiB7XHJcbiAgICAgICAgICAgICAgbWV0YWRhdGFkdG8ucHVzaChpdGVtLm1ldGFkYXRhKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICB0aGlzLmRhdGEgPSBtZXRhZGF0YWR0bztcclxuICAgICAgICAgIHRoaXMuZGF0YUNhY2hlID0gbWV0YWRhdGFkdG87XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBmaWx0ZXJEYXRhKGZpbHRlcjogc3RyaW5nKSB7XHJcbiAgICBsZXQgZHRvcz1bXTtcclxuICAgIGR0b3M9dGhpcy5maWx0ZXJCeUJvSWQodGhpcy5kYXRhQ2FjaGUpO1xyXG4gICAgZHRvcz10aGlzLmZpbHRlckJ5VHlwZShkdG9zKTtcclxuICAgIGR0b3M9dGhpcy5maWx0ZXJCeVNlYXJjaFRleHQoZHRvcyxmaWx0ZXIpO1xyXG4gICAgdGhpcy5kYXRhPWR0b3M7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGZpbHRlckJ5VHlwZShkYXRhcyA6IE1ldGFkYXRhQmFzZUluZm9bXSl7XHJcbiAgICBsZXQgZHRvcz0gW107XHJcbiAgICBpZiAodGhpcy5zZWxlY3RlZFR5cGUudmFsdWUgPT09ICdBbGwnKSB7XHJcbiAgICAgICAgZHRvcz1kYXRhcztcclxuICAgIH0gZWxzZXtcclxuICAgICAgZGF0YXMuZm9yRWFjaChkYXRhID0+IHtcclxuICAgICAgICB0aGlzLmRhdGFcclxuICAgICAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bWF4LWxpbmUtbGVuZ3RoXHJcbiAgICAgICAgaWYgKGRhdGEudHlwZSA9PT0gdGhpcy5zZWxlY3RlZFR5cGUudGV4dCkge1xyXG4gICAgICAgICAgZHRvcy5wdXNoKGRhdGEpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gZHRvcztcclxuICB9XHJcbiAgcHJpdmF0ZSBmaWx0ZXJCeUJvSWQoZGF0YXMgOiBNZXRhZGF0YUJhc2VJbmZvW10pe1xyXG4gICAgbGV0IGR0b3MgPSBbXTtcclxuICAgIGlmICghdGhpcy5ib0lkKSB7XHJcbiAgICAgICAgZHRvcz1kYXRhcztcclxuICAgIH0gZWxzZXtcclxuICAgICAgZGF0YXMuZm9yRWFjaChkYXRhID0+IHtcclxuICAgICAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bWF4LWxpbmUtbGVuZ3RoXHJcbiAgICAgICAgaWYgKGRhdGEuYml6b2JqZWN0SUQgPT09IHRoaXMuYm9JZCkge1xyXG4gICAgICAgICAgZHRvcy5wdXNoKGRhdGEpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gZHRvcztcclxuICB9XHJcbiAgcHJpdmF0ZSBmaWx0ZXJCeVNlYXJjaFRleHQoZGF0YXMgOiBNZXRhZGF0YUJhc2VJbmZvW10sdGV4dDpzdHJpbmcpe1xyXG4gICAgbGV0IGR0b3MgPSBbXTtcclxuICAgIGlmICghdGV4dCkge1xyXG4gICAgICAgIGR0b3M9ZGF0YXM7XHJcbiAgICB9IGVsc2V7XHJcbiAgICAgIGRhdGFzLmZvckVhY2goZGF0YSA9PiB7XHJcbiAgICAgICAgaWYgKGRhdGEuY29kZS50b0xvd2VyQ2FzZSgpLmluZGV4T2YodGV4dC50b0xvd2VyQ2FzZSgpKSA+IC0xIHx8IGRhdGEubmFtZS50b0xvd2VyQ2FzZSgpLmluZGV4T2YodGV4dC50b0xvd2VyQ2FzZSgpKSA+IC0xKSB7XHJcbiAgICAgICAgICBkdG9zLnB1c2goZGF0YSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgIH1cclxuICAgIHJldHVybiBkdG9zO1xyXG4gIH1cclxuXHJcbiAgLy8g6YCJ5Lit5YWD5pWw5o2u5ZCO55qE5LqL5Lu25aSE55CGXHJcbiAgb25TZWxlY3Rpb25DaGFuZ2UoZXZlbnQpIHtcclxuICAgIGlmIChldmVudC5zZWxlY3RlZFJvd3MubGVuZ3RoID4gMCkge1xyXG4gICAgICB0aGlzLm1ldGFkYXRhU2VydmljZS5jbGVhck1ldGFkYXRhUlQoKTtcclxuICAgICAgY29uc3QgbWV0YWRhdGEgPSB7XHJcbiAgICAgICAgSUQ6IGV2ZW50LnNlbGVjdGVkUm93c1swXS5kYXRhSXRlbS5pZCxcclxuICAgICAgICBSZWxhdGl2ZVBhdGg6IGV2ZW50LnNlbGVjdGVkUm93c1swXS5kYXRhSXRlbS5yZWxhdGl2ZVBhdGgsXHJcbiAgICAgICAgRmlsZU5hbWU6IGV2ZW50LnNlbGVjdGVkUm93c1swXS5kYXRhSXRlbS5maWxlTmFtZVxyXG4gICAgICB9O1xyXG4gICAgICB0aGlzLm1ldGFkYXRhU2VydmljZS5hZGRNZXRhZGF0YVJUKG1ldGFkYXRhKTtcclxuICAgIH1cclxuICB9XHJcbiAgb25QYWdlU2l6ZUNoYW5nZWQoJGV2ZW50KSB7XHJcbiAgICBjb25zb2xlLmxvZygnUGFnZVNpemUgQ2hhbmdlZDonLCAkZXZlbnQpO1xyXG4gIH1cclxuXHJcbiAgb25QYWdlQ2hhbmdlZCgkZXZlbnQpIHtcclxuICAgIGNvbnNvbGUubG9nKCdQYWdlTnVtYmVyIENoYW5nZWQ6JywgJGV2ZW50KTtcclxuICB9XHJcblxyXG4gIGNoZWNrZWRDaGFuZ2UoZXZlbnQpe1xyXG4gICAgaWYoZXZlbnQhPW51bGwmJmV2ZW50Lmxlbmd0aD4wKXtcclxuICAgICAgdGhpcy5tZXRhZGF0YVNlcnZpY2UuY2xlYXJNZXRhZGF0YVJUKCk7XHJcbiAgICAgIGV2ZW50LmZvckVhY2goZWxlbWVudCA9PiB7XHJcbiAgICAgICAgY29uc3QgbWV0YWRhdGEgPSB7XHJcbiAgICAgICAgICBJRDogZWxlbWVudC5kYXRhLmlkLFxyXG4gICAgICAgICAgTmFtZTogZWxlbWVudC5kYXRhLm5hbWUsXHJcbiAgICAgICAgICBDb2RlOiBlbGVtZW50LmRhdGEuY29kZSxcclxuICAgICAgICAgIFR5cGU6IGVsZW1lbnQuZGF0YS50eXBlLFxyXG4gICAgICAgICAgTmFtZVNwYWNlOiBlbGVtZW50LmRhdGEubmFtZVNwYWNlXHJcbiAgICAgICAgfTtcclxuICAgICAgICB0aGlzLm1ldGFkYXRhU2VydmljZS5hZGRNZXRhZGF0YVJUKG1ldGFkYXRhKTtcclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgfVxyXG59XHJcbiJdfQ==
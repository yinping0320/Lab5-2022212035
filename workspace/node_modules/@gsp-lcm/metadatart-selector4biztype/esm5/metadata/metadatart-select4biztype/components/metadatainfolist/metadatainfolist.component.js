/**
 * @fileoverview added by tsickle
 * Generated from: metadata/metadatart-select4biztype/components/metadatainfolist/metadatainfolist.component.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input } from '@angular/core';
import { MetadataInfoService } from '../../metadatainfo.service';
import { TranslateService } from '@ngx-translate/core';
var MetadataInfoList = /** @class */ (function () {
    function MetadataInfoList(metadataService /**/, translate) {
        this.metadataService = metadataService;
        this.translate = translate;
        this.allType = { text: this.transform('SelectAll'), value: 'All' };
        this.selectedType = this.allType;
        this.typeList = [
            this.allType
        ];
        this.typeListReadonly = false;
        this.searchText = '';
        this.searchTextForDup = '';
        this.Code = this.transform('Code');
        this.dataCache = [];
        this.columns = [];
        this.boId = 'all';
    }
    /**
     * @return {?}
     */
    MetadataInfoList.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.columns = [
            { field: 'nameSpace', width: 250, title: this.transform('NameSpace') },
            { field: 'code', width: 200, title: this.transform('Code') },
            { field: 'name', width: 200, title: this.transform('Name') },
            { field: 'type', width: 150, title: this.transform('Type') }
        ];
        // 获取所有的元数据类型列表
        this.metadataService.GetMetadataTypeList().subscribe((/**
         * @param {?} typeList
         * @return {?}
         */
        function (typeList) {
            if (typeList) {
                typeList.forEach((/**
                 * @param {?} type
                 * @return {?}
                 */
                function (type) {
                    _this.typeList.push({ text: type.typeName, value: type.typeCode });
                }));
            }
        }));
        // 初始化数据
        this.getData();
    };
    /**
     * @return {?}
     */
    MetadataInfoList.prototype.clear = /**
     * @return {?}
     */
    function () {
        this.data = [];
    };
    // tslint:disable-next-line:use-life-cycle-interface
    // tslint:disable-next-line:use-life-cycle-interface
    /**
     * @param {?} changes
     * @return {?}
     */
    MetadataInfoList.prototype.ngOnChanges = 
    // tslint:disable-next-line:use-life-cycle-interface
    /**
     * @param {?} changes
     * @return {?}
     */
    function (changes) {
        if (this.searchText) {
            this.onSearchTextChanged();
            return;
        }
        for (var key in changes) {
            if (changes.hasOwnProperty(key)) {
                /** @type {?} */
                var changedProp = changes[key];
                /** @type {?} */
                var currentValue = changedProp.currentValue;
                this.boId = currentValue;
                if (this.dataCache) {
                    /** @type {?} */
                    var dtos = [];
                    dtos = this.filterByBoId(this.dataCache);
                    dtos = this.filterByType(dtos);
                    dtos = this.filterBySearchText(dtos, this.searchText.trim());
                    this.data = dtos;
                }
            }
        }
    };
    /**
     * @param {?} key
     * @return {?}
     */
    MetadataInfoList.prototype.transform = /**
     * @param {?} key
     * @return {?}
     */
    function (key) {
        return this.translate.instant(key);
    };
    /**
     * @return {?}
     */
    MetadataInfoList.prototype.onSearchTextChanged = /**
     * @return {?}
     */
    function () {
        if (!this.searchText) {
            this.searchText = '';
        }
        /** @type {?} */
        var searchTextTrim = this.searchText.trim();
        console.log(this.searchText);
        this.filterData(searchTextTrim);
    };
    /**
     * @param {?} mdSeleted
     * @return {?}
     */
    MetadataInfoList.prototype.typeSelectedChanged = /**
     * @param {?} mdSeleted
     * @return {?}
     */
    function (mdSeleted) {
        if (!mdSeleted) {
            mdSeleted = this.selectedType;
        }
        else {
            this.selectedType = mdSeleted;
        }
        if (this.searchText) {
            this.onSearchTextChanged();
            return;
        }
        if (mdSeleted) {
            /** @type {?} */
            var dtos = [];
            dtos = this.filterByBoId(this.dataCache);
            dtos = this.filterByType(dtos);
            this.data = dtos;
        }
    };
    /**
     * @return {?}
     */
    MetadataInfoList.prototype.goSearch = /**
     * @return {?}
     */
    function () {
    };
    /**
     * @private
     * @return {?}
     */
    MetadataInfoList.prototype.getData = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        /** @type {?} */
        var metadatadto = [];
        this.metadataService.GetMetadataRTList('').subscribe((/**
         * @param {?} metadataList
         * @return {?}
         */
        function (metadataList) {
            if (metadataList) {
                _this.metadataService.GetMetadataTypeList().subscribe((/**
                 * @param {?} typeList
                 * @return {?}
                 */
                function (typeList) {
                    if (typeList) {
                        metadataList.forEach((/**
                         * @param {?} item
                         * @return {?}
                         */
                        function (item) {
                            /** @type {?} */
                            var dto = typeList.find((/**
                             * @param {?} type
                             * @return {?}
                             */
                            function (type) { return type.typeCode === item.metadata.type; }));
                            if (dto) {
                                item.metadata.type = dto.typeName;
                            }
                            metadatadto.push(item.metadata);
                        }));
                    }
                    else {
                        metadataList.forEach((/**
                         * @param {?} item
                         * @return {?}
                         */
                        function (item) {
                            metadatadto.push(item.metadata);
                        }));
                    }
                    _this.data = metadatadto;
                    _this.dataCache = metadatadto;
                }));
            }
        }));
    };
    /**
     * @private
     * @param {?} filter
     * @return {?}
     */
    MetadataInfoList.prototype.filterData = /**
     * @private
     * @param {?} filter
     * @return {?}
     */
    function (filter) {
        /** @type {?} */
        var dtos = [];
        dtos = this.filterByBoId(this.dataCache);
        dtos = this.filterByType(dtos);
        dtos = this.filterBySearchText(dtos, filter);
        this.data = dtos;
    };
    /**
     * @private
     * @param {?} datas
     * @return {?}
     */
    MetadataInfoList.prototype.filterByType = /**
     * @private
     * @param {?} datas
     * @return {?}
     */
    function (datas) {
        var _this = this;
        /** @type {?} */
        var dtos = [];
        if (this.selectedType.value === 'All') {
            dtos = datas;
        }
        else {
            datas.forEach((/**
             * @param {?} data
             * @return {?}
             */
            function (data) {
                _this.data;
                // tslint:disable-next-line:max-line-length
                if (data.type === _this.selectedType.text) {
                    dtos.push(data);
                }
            }));
        }
        return dtos;
    };
    /**
     * @private
     * @param {?} datas
     * @return {?}
     */
    MetadataInfoList.prototype.filterByBoId = /**
     * @private
     * @param {?} datas
     * @return {?}
     */
    function (datas) {
        var _this = this;
        /** @type {?} */
        var dtos = [];
        if (!this.boId) {
            dtos = datas;
        }
        else {
            datas.forEach((/**
             * @param {?} data
             * @return {?}
             */
            function (data) {
                // tslint:disable-next-line:max-line-length
                if (data.bizobjectID === _this.boId) {
                    dtos.push(data);
                }
            }));
        }
        return dtos;
    };
    /**
     * @private
     * @param {?} datas
     * @param {?} text
     * @return {?}
     */
    MetadataInfoList.prototype.filterBySearchText = /**
     * @private
     * @param {?} datas
     * @param {?} text
     * @return {?}
     */
    function (datas, text) {
        /** @type {?} */
        var dtos = [];
        if (!text) {
            dtos = datas;
        }
        else {
            datas.forEach((/**
             * @param {?} data
             * @return {?}
             */
            function (data) {
                if (data.code.toLowerCase().indexOf(text.toLowerCase()) > -1 || data.name.toLowerCase().indexOf(text.toLowerCase()) > -1) {
                    dtos.push(data);
                }
            }));
        }
        return dtos;
    };
    // 选中元数据后的事件处理
    // 选中元数据后的事件处理
    /**
     * @param {?} event
     * @return {?}
     */
    MetadataInfoList.prototype.onSelectionChange = 
    // 选中元数据后的事件处理
    /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        if (event.selectedRows.length > 0) {
            this.metadataService.clearMetadataRT();
            /** @type {?} */
            var metadata = {
                ID: event.selectedRows[0].dataItem.id,
                RelativePath: event.selectedRows[0].dataItem.relativePath,
                FileName: event.selectedRows[0].dataItem.fileName
            };
            this.metadataService.addMetadataRT(metadata);
        }
    };
    /**
     * @param {?} $event
     * @return {?}
     */
    MetadataInfoList.prototype.onPageSizeChanged = /**
     * @param {?} $event
     * @return {?}
     */
    function ($event) {
        console.log('PageSize Changed:', $event);
    };
    /**
     * @param {?} $event
     * @return {?}
     */
    MetadataInfoList.prototype.onPageChanged = /**
     * @param {?} $event
     * @return {?}
     */
    function ($event) {
        console.log('PageNumber Changed:', $event);
    };
    /**
     * @param {?} event
     * @return {?}
     */
    MetadataInfoList.prototype.checkedChange = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        var _this = this;
        if (event != null && event.length > 0) {
            this.metadataService.clearMetadataRT();
            event.forEach((/**
             * @param {?} element
             * @return {?}
             */
            function (element) {
                /** @type {?} */
                var metadata = {
                    ID: element.data.id,
                    Name: element.data.name,
                    Code: element.data.code,
                    Type: element.data.type,
                    NameSpace: element.data.nameSpace
                };
                _this.metadataService.addMetadataRT(metadata);
            }));
        }
    };
    MetadataInfoList.decorators = [
        { type: Component, args: [{
                    // tslint:disable-next-line:component-selector
                    selector: 'app-metadatainfolist',
                    template: "<div class=\"templateInfo d-flex flex-column h-100\">\r\n  <div class=\"templateSelectorHeader m-2 flex-shrink-0\">\r\n    <div class=\"searchArea d-flex flex-row\">\r\n\r\n      <input id=\"url\" class=\"textInput flex-fill\" type=\"text\" size=\"30\" kendoTextBox [(ngModel)]=\"this.searchText\"\r\n        #url=\"ngModel\" (ngModelChange)=\"onSearchTextChanged()\">\r\n      <button type=\"button\" class=\"btn btn-light btn-sm px-3 mx-2\"\r\n          (click)=\"goSearch()\">{{ 'Search' | translate }}</button>\r\n\r\n      <kendo-combobox [readonly]=\"this.typeListReadonly\" [data]=\"typeList\" [(ngModel)]=\"selectedType\"\r\n        [textField]=\"'text'\" [valueField]=\"'value'\"  (selectionChange)=\"typeSelectedChanged($event)\">\r\n      </kendo-combobox>\r\n    </div>\r\n   </div>\r\n\r\n    <div class=\"templateSelector farris-overflow-y-auto flex-fill f-utils-fill-flex-column\">\r\n      <farris-datagrid class=\"f-utils-fill\"\r\n      [columns]=\"columns\" [data]=\"data\" [showBorder]=\"true\"\r\n      [showLineNumber]=\"true\" [fit]=\"true\"\r\n      [striped]=\"true\"\r\n      [pagerOnServer]=\"false\"\r\n      [pagination]=\"true\" [pageSize]=\"10\" [showPageList]=\"true\"\r\n      (pageChanged)=\"onPageChanged($event)\" (pageSizeChanged)=\"onPageSizeChanged($event)\"\r\n      [fitColumns]=\"true\"\r\n      [autoFitColumns]=\"true\"\r\n      [multiSelect]=\"true\"\r\n      [showAllCheckbox]=\"true\"\r\n      [selectOnCheck]=\"true\"\r\n      [checkOnSelect]=\"true\"\r\n      [onlySelectSelf]=\"true\"\r\n      [showCheckbox]=\"true\"\r\n      [multiSelect]=\"true\"\r\n      [keepSelect]=\"true\"\r\n      (checkedChange) = \"checkedChange($event)\">\r\n      </farris-datagrid>\r\n    </div>\r\n  </div>\r\n\r\n",
                    styles: [""]
                }] }
    ];
    /** @nocollapse */
    MetadataInfoList.ctorParameters = function () { return [
        { type: MetadataInfoService },
        { type: TranslateService }
    ]; };
    MetadataInfoList.propDecorators = {
        boId: [{ type: Input }]
    };
    return MetadataInfoList;
}());
export { MetadataInfoList };
if (false) {
    /** @type {?} */
    MetadataInfoList.prototype.boId;
    /** @type {?} */
    MetadataInfoList.prototype.allType;
    /** @type {?} */
    MetadataInfoList.prototype.selectedType;
    /** @type {?} */
    MetadataInfoList.prototype.typeList;
    /** @type {?} */
    MetadataInfoList.prototype.typeListReadonly;
    /** @type {?} */
    MetadataInfoList.prototype.searchText;
    /** @type {?} */
    MetadataInfoList.prototype.searchTextForDup;
    /** @type {?} */
    MetadataInfoList.prototype.Code;
    /** @type {?} */
    MetadataInfoList.prototype.data;
    /** @type {?} */
    MetadataInfoList.prototype.dataCache;
    /** @type {?} */
    MetadataInfoList.prototype.columns;
    /**
     * @type {?}
     * @private
     */
    MetadataInfoList.prototype.metadataService;
    /**
     * @type {?}
     * @private
     */
    MetadataInfoList.prototype.translate;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWV0YWRhdGFpbmZvbGlzdC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZ3NwLWxjbS9tZXRhZGF0YXJ0LXNlbGVjdG9yNGJpenR5cGUvIiwic291cmNlcyI6WyJtZXRhZGF0YS9tZXRhZGF0YXJ0LXNlbGVjdDRiaXp0eXBlL2NvbXBvbmVudHMvbWV0YWRhdGFpbmZvbGlzdC9tZXRhZGF0YWluZm9saXN0LmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQW9DLEtBQUssRUFBd0IsTUFBTSxlQUFlLENBQUM7QUFFekcsT0FBTyxFQUFFLG1CQUFtQixFQUFFLE1BQU0sNEJBQTRCLENBQUM7QUFDakUsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFFdkQ7SUFzQkUsMEJBQW9CLGVBQW9DLENBQUEsSUFBSSxFQUFXLFNBQTJCO1FBQTlFLG9CQUFlLEdBQWYsZUFBZSxDQUFxQjtRQUFlLGNBQVMsR0FBVCxTQUFTLENBQWtCO1FBYmxHLFlBQU8sR0FBRyxFQUFFLElBQUksRUFBRSxJQUFJLENBQUMsU0FBUyxDQUFDLFdBQVcsQ0FBQyxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUUsQ0FBQztRQUM5RCxpQkFBWSxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUM7UUFDNUIsYUFBUSxHQUEyQztZQUNqRCxJQUFJLENBQUMsT0FBTztTQUNiLENBQUM7UUFDRixxQkFBZ0IsR0FBRyxLQUFLLENBQUM7UUFDekIsZUFBVSxHQUFHLEVBQUUsQ0FBQztRQUNoQixxQkFBZ0IsR0FBRyxFQUFFLENBQUM7UUFDdEIsU0FBSSxHQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsTUFBTSxDQUFDLENBQUM7UUFFNUIsY0FBUyxHQUFVLEVBQUUsQ0FBQztRQUN0QixZQUFPLEdBQUksRUFBRSxDQUFDO1FBR1osSUFBSSxDQUFDLElBQUksR0FBRyxLQUFLLENBQUM7SUFDcEIsQ0FBQzs7OztJQUVE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QUFFLENBQUM7WUFDdkMsS0FBSyxDQUFDLE9BQU87Ozs7WUFBQyxVQUFBLE9BQU87O29CQUNiLFFBQVEsR0FBRztvQkFDZixFQUFFLEVBQUUsT0FBTyxDQUFDLElBQUksQ0FBQyxFQUFFO29CQUNuQixJQUFJLEVBQUUsT0FBTyxDQUFDLElBQUksQ0FBQyxJQUFJO29CQUN2QixJQUFJLEVBQUUsT0FBTyxDQUFDLElBQUksQ0FBQyxJQUFJO29CQUN2QixJQUFJLEVBQUUsT0FBTyxDQUFDLElBQUksQ0FBQyxJQUFJO29CQUN2QixTQUFTLEVBQUUsT0FBTyxDQUFDLElBQUksQ0FBQyxTQUFTO2lCQUNsQztnQkFDRCxLQUFJLENBQUMsZUFBZSxDQUFDLGFBQWEsQ0FBQyxRQUFRLENBQUMsQ0FBQztZQUMvQyxDQUFDLEVBQUMsQ0FBQztTQUNKO0lBQ0gsQ0FBQzs7Z0JBcE5GLFNBQVMsU0FBQzs7b0JBRVQsUUFBUSxFQUFFLHNCQUFzQjtvQkFDaEMsOHREQUFnRDs7aUJBRWpEOzs7O2dCQVJRLG1CQUFtQjtnQkFDbkIsZ0JBQWdCOzs7dUJBVXRCLEtBQUs7O0lBNk1SLHVCQUFDO0NBQUEsQUFyTkQsSUFxTkM7U0E5TVksZ0JBQWdCOzs7SUFDM0IsZ0NBQXNCOztJQUN0QixtQ0FBOEQ7O0lBQzlELHdDQUE0Qjs7SUFDNUIsb0NBRUU7O0lBQ0YsNENBQXlCOztJQUN6QixzQ0FBZ0I7O0lBQ2hCLDRDQUFzQjs7SUFDdEIsZ0NBQTRCOztJQUM1QixnQ0FBeUI7O0lBQ3pCLHFDQUFzQjs7SUFDdEIsbUNBQWM7Ozs7O0lBRUYsMkNBQTRDOzs7OztJQUFPLHFDQUFtQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgIE9uSW5pdCwgU2ltcGxlQ2hhbmdlLCBPbkNoYW5nZXMsIElucHV0LCBPdXRwdXQsIEV2ZW50RW1pdHRlciB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBNZXRhZGF0YUJhc2VJbmZvIH0gZnJvbSAnLi4vLi4vbWV0YWRhdGFiYXNlaW5mbyc7XHJcbmltcG9ydCB7IE1ldGFkYXRhSW5mb1NlcnZpY2UgfSBmcm9tICcuLi8uLi9tZXRhZGF0YWluZm8uc2VydmljZSc7XHJcbmltcG9ydCB7IFRyYW5zbGF0ZVNlcnZpY2UgfSBmcm9tICdAbmd4LXRyYW5zbGF0ZS9jb3JlJztcclxuXHJcbkBDb21wb25lbnQoe1xyXG4gIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpjb21wb25lbnQtc2VsZWN0b3JcclxuICBzZWxlY3RvcjogJ2FwcC1tZXRhZGF0YWluZm9saXN0JyxcclxuICB0ZW1wbGF0ZVVybDogJy4vbWV0YWRhdGFpbmZvbGlzdC5jb21wb25lbnQuaHRtbCcsXHJcbiAgc3R5bGVVcmxzOiBbJy4vbWV0YWRhdGFpbmZvbGlzdC5jb21wb25lbnQuY3NzJ11cclxufSlcclxuLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOmNvbXBvbmVudC1jbGFzcy1zdWZmaXhcclxuZXhwb3J0IGNsYXNzIE1ldGFkYXRhSW5mb0xpc3QgaW1wbGVtZW50cyBPbkluaXQsIE9uQ2hhbmdlcyB7XHJcbiAgQElucHV0KCkgYm9JZDogc3RyaW5nO1xyXG4gIGFsbFR5cGUgPSB7IHRleHQ6IHRoaXMudHJhbnNmb3JtKCdTZWxlY3RBbGwnKSwgdmFsdWU6ICdBbGwnIH07XHJcbiAgc2VsZWN0ZWRUeXBlID0gdGhpcy5hbGxUeXBlO1xyXG4gIHR5cGVMaXN0OiBBcnJheTx7IHRleHQ6IHN0cmluZywgdmFsdWU6IHN0cmluZyB9PiA9IFtcclxuICAgIHRoaXMuYWxsVHlwZVxyXG4gIF07XHJcbiAgdHlwZUxpc3RSZWFkb25seSA9IGZhbHNlO1xyXG4gIHNlYXJjaFRleHQgPSAnJztcclxuICBzZWFyY2hUZXh0Rm9yRHVwID0gJyc7XHJcbiAgQ29kZT10aGlzLnRyYW5zZm9ybSgnQ29kZScpO1xyXG4gIGRhdGE6IE1ldGFkYXRhQmFzZUluZm9bXTtcclxuICBkYXRhQ2FjaGU6IGFueVtdID0gW107XHJcbiAgY29sdW1ucyA9ICBbXTtcclxuXHJcbiAgY29uc3RydWN0b3IocHJpdmF0ZSBtZXRhZGF0YVNlcnZpY2U6IE1ldGFkYXRhSW5mb1NlcnZpY2UvKiovLCAgcHJpdmF0ZSB0cmFuc2xhdGU6IFRyYW5zbGF0ZVNlcnZpY2UpIHtcclxuICAgIHRoaXMuYm9JZCA9ICdhbGwnO1xyXG4gIH1cclxuXHJcbiAgbmdPbkluaXQoKSB7XHJcbiAgICB0aGlzLmNvbHVtbnM9W1xyXG4gICAgICB7IGZpZWxkOiAnbmFtZVNwYWNlJywgd2lkdGg6IDI1MCwgdGl0bGU6IHRoaXMudHJhbnNmb3JtKCdOYW1lU3BhY2UnKSAgfSxcclxuICAgICAgeyBmaWVsZDogJ2NvZGUnLCB3aWR0aDogMjAwLCB0aXRsZTogdGhpcy50cmFuc2Zvcm0oJ0NvZGUnKX0sXHJcbiAgICAgIHsgZmllbGQ6ICduYW1lJywgd2lkdGg6IDIwMCwgdGl0bGU6IHRoaXMudHJhbnNmb3JtKCdOYW1lJyl9LFxyXG4gICAgICB7IGZpZWxkOiAndHlwZScsIHdpZHRoOiAxNTAsIHRpdGxlOiB0aGlzLnRyYW5zZm9ybSgnVHlwZScpfSAgIFxyXG4gICAgXTtcclxuICAgIC8vIOiOt+WPluaJgOacieeahOWFg+aVsOaNruexu+Wei+WIl+ihqFxyXG4gICAgdGhpcy5tZXRhZGF0YVNlcnZpY2UuR2V0TWV0YWRhdGFUeXBlTGlzdCgpLnN1YnNjcmliZSh0eXBlTGlzdCA9PiB7XHJcbiAgICAgIGlmICh0eXBlTGlzdCkge1xyXG4gICAgICAgIHR5cGVMaXN0LmZvckVhY2godHlwZSA9PiB7XHJcbiAgICAgICAgICB0aGlzLnR5cGVMaXN0LnB1c2goeyB0ZXh0OiB0eXBlLnR5cGVOYW1lLCB2YWx1ZTogdHlwZS50eXBlQ29kZSB9KTtcclxuICAgICAgICB9KTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICAvLyDliJ3lp4vljJbmlbDmja5cclxuICAgIHRoaXMuZ2V0RGF0YSgpO1xyXG4gIH1cclxuICBjbGVhcigpIHtcclxuICAgIHRoaXMuZGF0YSA9IFtdO1xyXG4gIH1cclxuXHJcbiAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOnVzZS1saWZlLWN5Y2xlLWludGVyZmFjZVxyXG4gIG5nT25DaGFuZ2VzKGNoYW5nZXM6IHsgW3Byb3BLZXk6IHN0cmluZ106IFNpbXBsZUNoYW5nZSB9KSB7XHJcbiAgICBpZiAodGhpcy5zZWFyY2hUZXh0KSB7XHJcbiAgICAgIHRoaXMub25TZWFyY2hUZXh0Q2hhbmdlZCgpO1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBmb3IgKGNvbnN0IGtleSBpbiBjaGFuZ2VzKSB7XHJcbiAgICAgIGlmIChjaGFuZ2VzLmhhc093blByb3BlcnR5KGtleSkpIHtcclxuICAgICAgICBjb25zdCBjaGFuZ2VkUHJvcCA9IGNoYW5nZXNba2V5XTtcclxuICAgICAgICBjb25zdCBjdXJyZW50VmFsdWUgPSBjaGFuZ2VkUHJvcC5jdXJyZW50VmFsdWU7XHJcbiAgICAgICAgdGhpcy5ib0lkPWN1cnJlbnRWYWx1ZTtcclxuICAgICAgICBpZih0aGlzLmRhdGFDYWNoZSl7XHJcbiAgICAgICAgICBsZXQgZHRvcz1bXTtcclxuICAgICAgICAgIGR0b3M9dGhpcy5maWx0ZXJCeUJvSWQodGhpcy5kYXRhQ2FjaGUpO1xyXG4gICAgICAgICAgZHRvcz10aGlzLmZpbHRlckJ5VHlwZShkdG9zKTtcclxuICAgICAgICAgIGR0b3M9dGhpcy5maWx0ZXJCeVNlYXJjaFRleHQoZHRvcyx0aGlzLnNlYXJjaFRleHQudHJpbSgpKTtcclxuICAgICAgICAgIHRoaXMuZGF0YT1kdG9zO1xyXG4gICAgICAgIH0gICAgICAgIFxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICB0cmFuc2Zvcm0oa2V5OiBzdHJpbmcpIHtcclxuICAgIHJldHVybiB0aGlzLnRyYW5zbGF0ZS5pbnN0YW50KGtleSk7XHJcbiAgfVxyXG5cclxuICBvblNlYXJjaFRleHRDaGFuZ2VkKCkge1xyXG4gICAgaWYgKCF0aGlzLnNlYXJjaFRleHQpIHsgdGhpcy5zZWFyY2hUZXh0ID0gJyc7IH1cclxuICAgIGNvbnN0IHNlYXJjaFRleHRUcmltID0gdGhpcy5zZWFyY2hUZXh0LnRyaW0oKTtcclxuICAgIGNvbnNvbGUubG9nKHRoaXMuc2VhcmNoVGV4dCk7XHJcbiAgICB0aGlzLmZpbHRlckRhdGEoc2VhcmNoVGV4dFRyaW0pO1xyXG4gIH1cclxuXHJcbiAgdHlwZVNlbGVjdGVkQ2hhbmdlZChtZFNlbGV0ZWQpIHtcclxuICAgIGlmICghbWRTZWxldGVkKSB7XHJcbiAgICAgIG1kU2VsZXRlZCA9IHRoaXMuc2VsZWN0ZWRUeXBlO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5zZWxlY3RlZFR5cGUgPSBtZFNlbGV0ZWQ7XHJcbiAgICB9XHJcbiAgICBpZiAodGhpcy5zZWFyY2hUZXh0KSB7XHJcbiAgICAgIHRoaXMub25TZWFyY2hUZXh0Q2hhbmdlZCgpO1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBpZiAobWRTZWxldGVkKSB7XHJcbiAgICAgIGxldCBkdG9zPSBbXTtcclxuICAgICAgZHRvcz10aGlzLmZpbHRlckJ5Qm9JZCh0aGlzLmRhdGFDYWNoZSk7XHJcbiAgICAgIGR0b3M9dGhpcy5maWx0ZXJCeVR5cGUoZHRvcyk7XHJcbiAgICAgIHRoaXMuZGF0YT1kdG9zO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgZ29TZWFyY2goKSB7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGdldERhdGEoKSB7XHJcbiAgICBjb25zdCBtZXRhZGF0YWR0byA9IFtdO1xyXG4gICAgdGhpcy5tZXRhZGF0YVNlcnZpY2UuR2V0TWV0YWRhdGFSVExpc3QoJycpLnN1YnNjcmliZShtZXRhZGF0YUxpc3QgPT4ge1xyXG4gICAgICBpZiAobWV0YWRhdGFMaXN0KSB7XHJcbiAgICAgICAgdGhpcy5tZXRhZGF0YVNlcnZpY2UuR2V0TWV0YWRhdGFUeXBlTGlzdCgpLnN1YnNjcmliZSh0eXBlTGlzdCA9PiB7XHJcbiAgICAgICAgICBpZiAodHlwZUxpc3QpIHtcclxuICAgICAgICAgICAgbWV0YWRhdGFMaXN0LmZvckVhY2goaXRlbSA9PiB7XHJcbiAgICAgICAgICAgICAgY29uc3QgZHRvID0gdHlwZUxpc3QuZmluZCh0eXBlID0+IHR5cGUudHlwZUNvZGUgPT09IGl0ZW0ubWV0YWRhdGEudHlwZSk7XHJcbiAgICAgICAgICAgICAgaWYgKGR0bykge1xyXG4gICAgICAgICAgICAgICAgaXRlbS5tZXRhZGF0YS50eXBlID0gZHRvLnR5cGVOYW1lO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICBtZXRhZGF0YWR0by5wdXNoKGl0ZW0ubWV0YWRhdGEpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIG1ldGFkYXRhTGlzdC5mb3JFYWNoKGl0ZW0gPT4ge1xyXG4gICAgICAgICAgICAgIG1ldGFkYXRhZHRvLnB1c2goaXRlbS5tZXRhZGF0YSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgdGhpcy5kYXRhID0gbWV0YWRhdGFkdG87XHJcbiAgICAgICAgICB0aGlzLmRhdGFDYWNoZSA9IG1ldGFkYXRhZHRvO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgZmlsdGVyRGF0YShmaWx0ZXI6IHN0cmluZykge1xyXG4gICAgbGV0IGR0b3M9W107XHJcbiAgICBkdG9zPXRoaXMuZmlsdGVyQnlCb0lkKHRoaXMuZGF0YUNhY2hlKTtcclxuICAgIGR0b3M9dGhpcy5maWx0ZXJCeVR5cGUoZHRvcyk7XHJcbiAgICBkdG9zPXRoaXMuZmlsdGVyQnlTZWFyY2hUZXh0KGR0b3MsZmlsdGVyKTtcclxuICAgIHRoaXMuZGF0YT1kdG9zO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBmaWx0ZXJCeVR5cGUoZGF0YXMgOiBNZXRhZGF0YUJhc2VJbmZvW10pe1xyXG4gICAgbGV0IGR0b3M9IFtdO1xyXG4gICAgaWYgKHRoaXMuc2VsZWN0ZWRUeXBlLnZhbHVlID09PSAnQWxsJykge1xyXG4gICAgICAgIGR0b3M9ZGF0YXM7XHJcbiAgICB9IGVsc2V7XHJcbiAgICAgIGRhdGFzLmZvckVhY2goZGF0YSA9PiB7XHJcbiAgICAgICAgdGhpcy5kYXRhXHJcbiAgICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm1heC1saW5lLWxlbmd0aFxyXG4gICAgICAgIGlmIChkYXRhLnR5cGUgPT09IHRoaXMuc2VsZWN0ZWRUeXBlLnRleHQpIHtcclxuICAgICAgICAgIGR0b3MucHVzaChkYXRhKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGR0b3M7XHJcbiAgfVxyXG4gIHByaXZhdGUgZmlsdGVyQnlCb0lkKGRhdGFzIDogTWV0YWRhdGFCYXNlSW5mb1tdKXtcclxuICAgIGxldCBkdG9zID0gW107XHJcbiAgICBpZiAoIXRoaXMuYm9JZCkge1xyXG4gICAgICAgIGR0b3M9ZGF0YXM7XHJcbiAgICB9IGVsc2V7XHJcbiAgICAgIGRhdGFzLmZvckVhY2goZGF0YSA9PiB7XHJcbiAgICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm1heC1saW5lLWxlbmd0aFxyXG4gICAgICAgIGlmIChkYXRhLmJpem9iamVjdElEID09PSB0aGlzLmJvSWQpIHtcclxuICAgICAgICAgIGR0b3MucHVzaChkYXRhKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGR0b3M7XHJcbiAgfVxyXG4gIHByaXZhdGUgZmlsdGVyQnlTZWFyY2hUZXh0KGRhdGFzIDogTWV0YWRhdGFCYXNlSW5mb1tdLHRleHQ6c3RyaW5nKXtcclxuICAgIGxldCBkdG9zID0gW107XHJcbiAgICBpZiAoIXRleHQpIHtcclxuICAgICAgICBkdG9zPWRhdGFzO1xyXG4gICAgfSBlbHNle1xyXG4gICAgICBkYXRhcy5mb3JFYWNoKGRhdGEgPT4ge1xyXG4gICAgICAgIGlmIChkYXRhLmNvZGUudG9Mb3dlckNhc2UoKS5pbmRleE9mKHRleHQudG9Mb3dlckNhc2UoKSkgPiAtMSB8fCBkYXRhLm5hbWUudG9Mb3dlckNhc2UoKS5pbmRleE9mKHRleHQudG9Mb3dlckNhc2UoKSkgPiAtMSkge1xyXG4gICAgICAgICAgZHRvcy5wdXNoKGRhdGEpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gZHRvcztcclxuICB9XHJcblxyXG4gIC8vIOmAieS4reWFg+aVsOaNruWQjueahOS6i+S7tuWkhOeQhlxyXG4gIG9uU2VsZWN0aW9uQ2hhbmdlKGV2ZW50KSB7XHJcbiAgICBpZiAoZXZlbnQuc2VsZWN0ZWRSb3dzLmxlbmd0aCA+IDApIHtcclxuICAgICAgdGhpcy5tZXRhZGF0YVNlcnZpY2UuY2xlYXJNZXRhZGF0YVJUKCk7XHJcbiAgICAgIGNvbnN0IG1ldGFkYXRhID0ge1xyXG4gICAgICAgIElEOiBldmVudC5zZWxlY3RlZFJvd3NbMF0uZGF0YUl0ZW0uaWQsXHJcbiAgICAgICAgUmVsYXRpdmVQYXRoOiBldmVudC5zZWxlY3RlZFJvd3NbMF0uZGF0YUl0ZW0ucmVsYXRpdmVQYXRoLFxyXG4gICAgICAgIEZpbGVOYW1lOiBldmVudC5zZWxlY3RlZFJvd3NbMF0uZGF0YUl0ZW0uZmlsZU5hbWVcclxuICAgICAgfTtcclxuICAgICAgdGhpcy5tZXRhZGF0YVNlcnZpY2UuYWRkTWV0YWRhdGFSVChtZXRhZGF0YSk7XHJcbiAgICB9XHJcbiAgfVxyXG4gIG9uUGFnZVNpemVDaGFuZ2VkKCRldmVudCkge1xyXG4gICAgY29uc29sZS5sb2coJ1BhZ2VTaXplIENoYW5nZWQ6JywgJGV2ZW50KTtcclxuICB9XHJcblxyXG4gIG9uUGFnZUNoYW5nZWQoJGV2ZW50KSB7XHJcbiAgICBjb25zb2xlLmxvZygnUGFnZU51bWJlciBDaGFuZ2VkOicsICRldmVudCk7XHJcbiAgfVxyXG5cclxuICBjaGVja2VkQ2hhbmdlKGV2ZW50KXtcclxuICAgIGlmKGV2ZW50IT1udWxsJiZldmVudC5sZW5ndGg+MCl7XHJcbiAgICAgIHRoaXMubWV0YWRhdGFTZXJ2aWNlLmNsZWFyTWV0YWRhdGFSVCgpO1xyXG4gICAgICBldmVudC5mb3JFYWNoKGVsZW1lbnQgPT4ge1xyXG4gICAgICAgIGNvbnN0IG1ldGFkYXRhID0ge1xyXG4gICAgICAgICAgSUQ6IGVsZW1lbnQuZGF0YS5pZCxcclxuICAgICAgICAgIE5hbWU6IGVsZW1lbnQuZGF0YS5uYW1lLFxyXG4gICAgICAgICAgQ29kZTogZWxlbWVudC5kYXRhLmNvZGUsXHJcbiAgICAgICAgICBUeXBlOiBlbGVtZW50LmRhdGEudHlwZSxcclxuICAgICAgICAgIE5hbWVTcGFjZTogZWxlbWVudC5kYXRhLm5hbWVTcGFjZVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgdGhpcy5tZXRhZGF0YVNlcnZpY2UuYWRkTWV0YWRhdGFSVChtZXRhZGF0YSk7XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gIH1cclxufVxyXG4iXX0=
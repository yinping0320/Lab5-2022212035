!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("rxjs/Observable"),require("@angular/common/http"),require("@farris/ui-notify"),require("@angular/common"),require("@progress/kendo-angular-dropdowns"),require("@angular/forms"),require("@progress/kendo-angular-layout"),require("@gsp-lcm/bo-tree"),require("@gsp-lcm/bo-rt-service"),require("@farris/ui-splitter"),require("@farris/ui-section"),require("@ngx-translate/http-loader"),require("@angular/core"),require("@ngx-translate/core"),require("@ecp-caf/caf-common"),require("@farris/ui-datagrid"),require("@farris/ui-forms")):"function"==typeof define&&define.amd?define("@gsp-lcm/metadatart-selector4biztype",["exports","rxjs/Observable","@angular/common/http","@farris/ui-notify","@angular/common","@progress/kendo-angular-dropdowns","@angular/forms","@progress/kendo-angular-layout","@gsp-lcm/bo-tree","@gsp-lcm/bo-rt-service","@farris/ui-splitter","@farris/ui-section","@ngx-translate/http-loader","@angular/core","@ngx-translate/core","@ecp-caf/caf-common","@farris/ui-datagrid","@farris/ui-forms"],e):e((t["gsp-lcm"]=t["gsp-lcm"]||{},t["gsp-lcm"]["metadatart-selector4biztype"]={}),t.rxjs.Observable,t.ng.common.http,t.uiNotify,t.ng.common,t.kendoAngularDropdowns,t.ng.forms,t.kendoAngularLayout,t.boTree,t.boRtService,t.uiSplitter,t.uiSection,t.httpLoader,t.ng.core,t.core$1,t.cafCommon,t.uiDatagrid,t.uiForms)}(this,function(t,a,e,i,r,n,o,s,p,d,l,c,h,u,f,y,m,g){"use strict";var v=(T.prototype.GetMetadataRT=function(t){var e=this.MetadataRT_Base_Path+"/"+t;return this.http.get(e)},T.prototype.GetMetadataRTList=function(t){var e=this.MetadataRT_Base_Path+"?metadataTypes="+t;return this.http.get(e)},T.prototype.GetPackagedMetadataRTListWithType=function(t){var e=this.MetadataRT_Base_Path+"/packaged?metadataTypes="+t;return this.http.get(e)},T.prototype.GetAllOriginMdRTListWithType=function(t){var e=this.MetadataRT_Base_Path+"/origin?metadataTypes="+t;return this.http.get(e)},T.prototype.getMetadataListByBizTypeId=function(t,e){var a=this.MetadataBizType_Base_Path+"?bizTypeId="+t+"&metadataTypes="+e;return this.http.get(a)},T.prototype.getMappingListByMetadataId=function(t,e){var a=this.MetadataBizType_Mapping_Path+"?metadataId="+t+"&certId="+e;return this.http.get(a)},T.prototype.isMappingExist=function(t,e){var a=this.MetadataBizType_Base_Path+"/validation/md?bizTypeId="+t+"&mdId="+e;return this.http.get(a)},T.prototype.isBoBizTypeMappingExist=function(t,e){var a=this.MetadataBizType_Base_Path+"/validation/bo?bizTypeId="+t+"&boId="+e;return this.http.get(a)},T.prototype.GetMetadataTypeList=function(){var t=this.MetadataRT_Base_Path+"/typeList";return this.http.get(t)},T.prototype.GetPackagedMetadataRTList=function(){var t=this.MetadataRT_Base_Path+"/packaged";return this.http.get(t)},T.prototype.deleteMappingData=function(t,e){var a=this.MetadataBizType_Base_Path+"/mappings/md?bizTypeId="+t+"&mdId="+e;return this.http["delete"](a,null)},T.prototype.deleteMdMappingDataList=function(t,e){var a=this.MetadataBizType_Base_Path+"/mappings/mds?bizTypeId="+t+"&mdIds="+e;return this.http["delete"](a,null)},T.prototype.deleteBoMappingDataList=function(t,e){var a=this.MetadataBizType_Base_Path+"/mappings/bos?bizTypeId="+t+"&boIds="+e;return this.http["delete"](a,null)},T.prototype.saveMappingData=function(t){var e=this.MetadataBizType_Base_Path+"/mappings/md";return this.http.post(e,t)},T.prototype.saveMdMappingList=function(t){var e=this.MetadataBizType_Base_Path+"/mappings/mds";return this.http.post(e,t)},T.prototype.saveBoBizTypeMapping=function(t){var e=this.MetadataBizType_Base_Path+"/mappings/bo";return this.http.post(e,t)},T.prototype.saveBoBizTypeMappingList=function(t){var e=this.MetadataBizType_Base_Path+"/mappings/bos";return this.http.post(e,t)},T.prototype.GetPostfix=function(e){return this.GetMetadataTypeList().subscribe(function(t){t.forEach(function(t){if(e.toLowerCase()===t.typeCode.toLowerCase())return t.postfix})}),new a.Observable},T.prototype.getMdBizTypeMappingType=function(t){var e=this.MetadataBizType_Base_Path+"/mappingtype?bizTypeId="+t;return this.http.get(e)},T.prototype.getMdBizMappingListBizTypeId=function(t){var e=this.MetadataBizType_Base_Path+"/mappings/md?bizTypeId="+t;return this.http.get(e)},T.prototype.getBoBizMappingListBizTypeId=function(t){var e=this.MetadataBizType_Base_Path+"/mappings/bo?bizTypeId="+t;return this.http.get(e)},T.prototype.save=function(t){var e=this.MetadataBizType_Base_Path;return this.http.post(e,t)},T.prototype.saveMappingType=function(t,e){var a=this.MetadataBizType_Base_Path+"/mappingtype?bizTypeId="+t+"&mdBizMapType="+e;return this.http.post(a,null)},T.prototype.deleteBoMdMappingData=function(t,e){var a=this.MetadataBizType_Base_Path+"/mappings/bo?bizTypeId="+t+"&boId="+e;return this.http["delete"](a,null)},T);function T(t){this.http=t,this.MetadataRT_Base_Path="/api/runtime/lcm/v1.0/rt-metadatas",this.MetadataBizType_Base_Path="/api/runtime/lcm/v1.0/metadata-biztypes",this.MetadataBizType_Mapping_Path="/api/runtime/lcm/v1.0/metadata-biztypes/mappings"}var M=(x.prototype.addMetadataRT=function(t){this.metadatas.push(t)},x.prototype.clearMetadataRT=function(){this.metadatas=[]},x.prototype.getBusinessObject=function(t){var e=this.BusinessObject_Base_Path+"/"+t;return this.http.get(e)},x.prototype.GetMetadataTypeList=function(){return this.gspMetadataService.GetMetadataTypeList()},x.prototype.GetMetadataRTList=function(t){return this.gspMetadataService.GetAllOriginMdRTListWithType(t)},x.prototype.GetMetadataRT=function(t){return this.gspMetadataService.GetMetadataRT(t)},x.decorators=[{type:u.Injectable}],x.ctorParameters=function(){return[{type:e.HttpClient},{type:v}]},x);function x(t,e){this.http=t,this.gspMetadataService=e,this.BusinessObject_Base_Path="/api/dev/main/v1.0/business-objects",this.metadatas=[]}var b=(B.prototype.ngOnInit=function(){},B.prototype.transform=function(t){return this.translate.instant(t)},B.prototype.LoadMetadata=function(){null==this.metadataInfoService.metadatas||this.metadataInfoService.metadatas.length<=0?this.notifyService.warning(this.transform("PleaseChooseData")):(this.metadataInfoService.metadatas,this.selectedMetadata.emit(this.metadataInfoService.metadatas),this.hideModal(),this.metadataInfoService.clearMetadataRT())},B.prototype.hideModal=function(){this.closeModalEmitter.emit()},B.prototype.onSelectedChange=function(t){"gscloud"===t.id?this.boId="":this.boId=t.id},B.decorators=[{type:u.Component,args:[{selector:"app-metadatainfo",template:'\x3c!-- <div class="modal-body">\r\n    <div class="templateBlock">\r\n        <app-treeclassifier></app-treeclassifier>\r\n        <app-metadatainfolist></app-metadatainfolist>\r\n    </div>\r\n</div> --\x3e\r\n<div class="farris-main-area flex-column farris-overflow-hidden">\r\n  <div class="f-utils-fill bg-c-white position-relative f-utils-overflow-xhya d-flex">\r\n      <div class="templateBlock flex-column flex-fill d-flex w-100">\r\n        <kendo-splitter class="d-flex h-100 " style="flex: 1 1 auto;" orientation="horizontal">\r\n          <kendo-splitter-pane class="d-flex " [collapsible]="true" size="250px" style="height: auto">\r\n            <app-bo-tree-panel (selectionChanged)=onSelectedChange($event)></app-bo-tree-panel>\r\n          </kendo-splitter-pane>\r\n          <kendo-splitter-pane class="d-flex" style="height: auto">\r\n            <app-metadatainfolist class="flex-fill" [boId]="boId"></app-metadatainfolist>\r\n          </kendo-splitter-pane>\r\n        </kendo-splitter>\r\n      </div>\r\n    </div>\r\n    <div class="modal-footer">\r\n      <button type="button" class="btn btn-default btn-primary" (click)="LoadMetadata()">{{ \'OK\' | translate }}</button>\r\n      <button type="button" class="btn btn-default" (click)="hideModal()">{{ \'Cancel\' | translate }}</button>\r\n  </div>\r\n</div>',styles:[".templateBlock{display:flex}.infoBlock{width:100%;min-width:400px}.infoBlock label{width:50px}"]}]}],B.ctorParameters=function(){return[{type:M},{type:i.NotifyService},{type:f.TranslateService}]},B.propDecorators={selectedMetadata:[{type:u.Output}],closeModalEmitter:[{type:u.Output}]},B);function B(t,e,a){this.metadataInfoService=t,this.notifyService=e,this.translate=a,this.OK=this.transform("OK"),this.cancel=this.transform("Cancel"),this.selectedMetadata=new u.EventEmitter,this.closeModalEmitter=new u.EventEmitter}var S=(z.newGuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)})},z);function z(){}var C=function $(){this.id=S.newGuid()},I=function V(){this.id=S.newGuid()},P=function K(){this.boBizTypeMappings=[],this.mdBizTypeMappings=[]},_=function W(){this.id=S.newGuid()},L=(k.prototype.ngOnInit=function(){var e=this;this.columns=[{field:"nameSpace",width:250,title:this.transform("NameSpace")},{field:"code",width:200,title:this.transform("Code")},{field:"name",width:200,title:this.transform("Name")},{field:"type",width:150,title:this.transform("Type")}],this.metadataService.GetMetadataTypeList().subscribe(function(t){t&&t.forEach(function(t){e.typeList.push({text:t.typeName,value:t.typeCode})})}),this.getData()},k.prototype.clear=function(){this.data=[]},k.prototype.ngOnChanges=function(t){if(this.searchText)this.onSearchTextChanged();else for(var e in t)if(t.hasOwnProperty(e)){var a=t[e].currentValue;if(this.boId=a,this.dataCache){var i=[];i=this.filterByBoId(this.dataCache),i=this.filterByType(i),i=this.filterBySearchText(i,this.searchText.trim()),this.data=i}}},k.prototype.transform=function(t){return this.translate.instant(t)},k.prototype.onSearchTextChanged=function(){this.searchText||(this.searchText="");var t=this.searchText.trim();console.log(this.searchText),this.filterData(t)},k.prototype.typeSelectedChanged=function(t){if(t?this.selectedType=t:t=this.selectedType,this.searchText)this.onSearchTextChanged();else if(t){var e=[];e=this.filterByBoId(this.dataCache),e=this.filterByType(e),this.data=e}},k.prototype.goSearch=function(){},k.prototype.getData=function(){var e=this,i=[];this.metadataService.GetMetadataRTList("").subscribe(function(t){t&&e.metadataService.GetMetadataTypeList().subscribe(function(a){a?t.forEach(function(e){var t=a.find(function(t){return t.typeCode===e.metadata.type});t&&(e.metadata.type=t.typeName),i.push(e.metadata)}):t.forEach(function(t){i.push(t.metadata)}),e.data=i,e.dataCache=i})})},k.prototype.filterData=function(t){var e=[];e=this.filterByBoId(this.dataCache),e=this.filterByType(e),e=this.filterBySearchText(e,t),this.data=e},k.prototype.filterByType=function(t){var e=this,a=[];return"All"===this.selectedType.value?a=t:t.forEach(function(t){e.data,t.type===e.selectedType.text&&a.push(t)}),a},k.prototype.filterByBoId=function(t){var e=this,a=[];return this.boId?t.forEach(function(t){t.bizobjectID===e.boId&&a.push(t)}):a=t,a},k.prototype.filterBySearchText=function(t,e){var a=[];return e?t.forEach(function(t){(-1<t.code.toLowerCase().indexOf(e.toLowerCase())||-1<t.name.toLowerCase().indexOf(e.toLowerCase()))&&a.push(t)}):a=t,a},k.prototype.onSelectionChange=function(t){if(0<t.selectedRows.length){this.metadataService.clearMetadataRT();var e={ID:t.selectedRows[0].dataItem.id,RelativePath:t.selectedRows[0].dataItem.relativePath,FileName:t.selectedRows[0].dataItem.fileName};this.metadataService.addMetadataRT(e)}},k.prototype.onPageSizeChanged=function(t){console.log("PageSize Changed:",t)},k.prototype.onPageChanged=function(t){console.log("PageNumber Changed:",t)},k.prototype.checkedChange=function(t){var a=this;null!=t&&0<t.length&&(this.metadataService.clearMetadataRT(),t.forEach(function(t){var e={ID:t.data.id,Name:t.data.name,Code:t.data.code,Type:t.data.type,NameSpace:t.data.nameSpace};a.metadataService.addMetadataRT(e)}))},k.decorators=[{type:u.Component,args:[{selector:"app-metadatainfolist",template:'<div class="templateInfo d-flex flex-column h-100">\r\n  <div class="templateSelectorHeader m-2 flex-shrink-0">\r\n    <div class="searchArea d-flex flex-row">\r\n\r\n      <input id="url" class="textInput flex-fill" type="text" size="30" kendoTextBox [(ngModel)]="this.searchText"\r\n        #url="ngModel" (ngModelChange)="onSearchTextChanged()">\r\n      <button type="button" class="btn btn-light btn-sm px-3 mx-2"\r\n          (click)="goSearch()">{{ \'Search\' | translate }}</button>\r\n\r\n      <kendo-combobox [readonly]="this.typeListReadonly" [data]="typeList" [(ngModel)]="selectedType"\r\n        [textField]="\'text\'" [valueField]="\'value\'"  (selectionChange)="typeSelectedChanged($event)">\r\n      </kendo-combobox>\r\n    </div>\r\n   </div>\r\n\r\n    <div class="templateSelector farris-overflow-y-auto flex-fill f-utils-fill-flex-column">\r\n      <farris-datagrid class="f-utils-fill"\r\n      [columns]="columns" [data]="data" [showBorder]="true"\r\n      [showLineNumber]="true" [fit]="true"\r\n      [striped]="true"\r\n      [pagerOnServer]="false"\r\n      [pagination]="true" [pageSize]="10" [showPageList]="true"\r\n      (pageChanged)="onPageChanged($event)" (pageSizeChanged)="onPageSizeChanged($event)"\r\n      [fitColumns]="true"\r\n      [autoFitColumns]="true"\r\n      [multiSelect]="true"\r\n      [showAllCheckbox]="true"\r\n      [selectOnCheck]="true"\r\n      [checkOnSelect]="true"\r\n      [onlySelectSelf]="true"\r\n      [showCheckbox]="true"\r\n      [multiSelect]="true"\r\n      [keepSelect]="true"\r\n      (checkedChange) = "checkedChange($event)">\r\n      </farris-datagrid>\r\n    </div>\r\n  </div>\r\n\r\n',styles:[""]}]}],k.ctorParameters=function(){return[{type:M},{type:f.TranslateService}]},k.propDecorators={boId:[{type:u.Input}]},k);function k(t,e){this.metadataService=t,this.translate=e,this.allType={text:this.transform("SelectAll"),value:"All"},this.selectedType=this.allType,this.typeList=[this.allType],this.typeListReadonly=!1,this.searchText="",this.searchTextForDup="",this.Code=this.transform("Code"),this.dataCache=[],this.columns=[],this.boId="all"}var w={key:"中文文本"},R=(D.prototype.resolve=function(t,e){var a=localStorage.getItem("languageCode");return this.translate.defaultLang===a||(this.translate.defaultLang=a),this.translate.getTranslation(a)},D.decorators=[{type:u.Injectable}],D.ctorParameters=function(){return[{type:f.TranslateService}]},D);function D(t){(this.translate=t).defaultLang="zh-CHS",t.setTranslation("zh-CHS",w)}function O(t){return new h.TranslateHttpLoader(t,"/platform/runtime/common/web/@gsp-lcm/metadatart-selector4biztype/i18n/",".json")}var G=O,j=localStorage.getItem("languageCode")||"zh-CHS",N=(E.decorators=[{type:u.NgModule,args:[{imports:[g.FarrisFormsModule,e.HttpClientModule,i.NotifyModule.forRoot(),r.CommonModule,o.FormsModule,s.LayoutModule,n.DropDownsModule,p.BOTreePanelPackageModule,l.SplitterModule,c.FarrisSectionModule,d.BORtServiceModule,m.DatagridModule,f.TranslateModule.forRoot({loader:{provide:f.TranslateLoader,useFactory:G,deps:[e.HttpClient]}})],declarations:[b,L],exports:[b],providers:[y.HttpService,v,M,d.BusinessObjectRtService,R,C,I,P,_,{provide:u.LOCALE_ID,useValue:j}],entryComponents:[b]}]}],E);function E(){}var q=function J(t,e,a,i,r,n,o,s,p,d){this.id=t,this.nameSpace=e,this.code=a,this.name=i,this.fileName=r,this.type=n,this.bizobjectID=o,this.relativePath=s,this.extendProperty=p,this.content=d},F=function Q(){},A=function U(t,e,a,i){this.packageName=t,this.projectPath=i,this.packageVersion=e,this.packageLocation=a},H=function X(t,e,a,i,r,n,o){this.packageName=t,this.projectName=a,this.projectPath=e,this.projectNameSpace=i,this.depPackageName=r,this.depPackageVersion=n,this.depPackageLocation=o};t.MetadataInfoComponent=b,t.GSPMetadataRTServiceModule4BizType=N,t.GSPMetadataRTService4BizType=v,t.MetadataDto=q,t.Metadata4RefDto=F,t.MetadataPackageDto=A,t.MetadataProjectDto=H,t.GspBoBizTypeMapping=C,t.GspMdBizTypeMapping=I,t.MdBizTypeMappingDto=P,t.MetadataInfoService=M,t.GspMdBizTypeMappingType=_,t.Guid=S,t.ɵa=O,t.ɵb=L,t.ɵc=R,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=gsp-lcm-metadatart-selector4biztype.umd.min.js.map
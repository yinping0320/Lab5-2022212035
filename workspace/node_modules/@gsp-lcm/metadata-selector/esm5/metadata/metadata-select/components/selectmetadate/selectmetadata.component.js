/**
 * @fileoverview added by tsickle
 * Generated from: metadata/metadata-select/components/selectmetadate/selectmetadata.component.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
// tslint:disable-next-line:max-line-length
import { Component, ViewChild, Input, Output, EventEmitter } from '@angular/core';
import { MetadataService } from '../../metadata.service';
import { MetadatapackageselectComponent } from '../metadatapackageselect/metadatapackageselect.component';
import { Metadata4RefDto, MetadataPackageHeader } from '../../../metadata4refdto';
import { GSPMetadataService } from '../../../metadata.service';
import { LoadingService } from '@farris/ui-loading';
var SelectMetadataComponent = /** @class */ (function () {
    function SelectMetadataComponent(metadataService, loading, gspMetaService) {
        var _this = this;
        this.metadataService = metadataService;
        this.loading = loading;
        this.gspMetaService = gspMetaService;
        this.selectedMetadata = new EventEmitter();
        this.closeModalEmitter = new EventEmitter();
        this.metadataService.selectedChange.subscribe((/**
         * @param {?} leftItem
         * @return {?}
         */
        function (leftItem) {
            _this.classifier = leftItem;
        }));
        this.isMavenEnable = false;
        this.gspMetaService.getMavenSetting().subscribe((/**
         * @param {?} flag
         * @return {?}
         */
        function (flag) {
            // if (flag) {
            _this.isMavenEnable = flag;
            // }
        }));
    }
    /**
     * @param {?} metadata
     * @return {?}
     */
    SelectMetadataComponent.prototype.onSelectedMetadataChanged = /**
     * @param {?} metadata
     * @return {?}
     */
    function (metadata) {
        this.metadata = metadata;
    };
    /**
     * @param {?} code
     * @return {?}
     */
    SelectMetadataComponent.prototype.setCodeLanguage = /**
     * @param {?} code
     * @return {?}
     */
    function (code) {
        this.codelanguage = code;
    };
    /**
     * @return {?}
     */
    SelectMetadataComponent.prototype.LoadMetadata = /**
     * @return {?}
     */
    function () {
        var _this = this;
        if (this.metadata && this.classifier) {
            // 选中的是当前工程下的元数据，调用Load
            if (this.classifier.id === 'project' || this.classifier.id === 'bo') {
                if (this.loading) {
                    this.loading.show({ message: '正在添加引用，请稍候...' });
                }
                this.metadataService.LoadTheMetadata(this.metadata).subscribe((/**
                 * @param {?} templates
                 * @return {?}
                 */
                function (templates) {
                    if (_this.loading) {
                        _this.loading.close();
                    }
                    /** @type {?} */
                    var metadata4Ref = new Metadata4RefDto();
                    metadata4Ref.metadata = templates;
                    metadata4Ref.metadata.processMode = _this.metadata.processMode === 'interpretation' ? 'interpretation' : 'generation';
                    metadata4Ref.packageHeader = new MetadataPackageHeader();
                    _this.selectedMetadata.emit(metadata4Ref);
                    _this.hideModal();
                }), (/**
                 * @param {?} error
                 * @return {?}
                 */
                function (error) {
                    _this.errorMsg(error);
                    if (_this.loading) {
                        _this.loading.close();
                    }
                }), (/**
                 * @return {?}
                 */
                function () {
                    if (_this.loading) {
                        _this.loading.close();
                    }
                }));
            }
            else if (this.classifier.id === 'local') {
                if (!this.metadata.mdPkgName) {
                    /** @type {?} */
                    var msg = '未找到元数据包信息。';
                    gsp.ide.messager.error(msg);
                    return;
                }
                if (this.loading) {
                    this.loading.show({ message: '正在添加引用，请稍候...' });
                }
                this.metadataService.pickMetadataIndex(1, this.metadata, this.codelanguage, this.isMavenEnable).subscribe((/**
                 * @param {?} templates
                 * @return {?}
                 */
                function (templates) {
                    if (_this.loading) {
                        _this.loading.close();
                    }
                    templates.metadata.processMode = _this.metadata.processMode === 'interpretation' ? 'interpretation' : 'generation';
                    _this.selectedMetadata.emit(templates);
                    _this.hideModal();
                }), (/**
                 * @param {?} error
                 * @return {?}
                 */
                function (error) {
                    _this.errorMsg(error);
                    if (_this.loading) {
                        _this.loading.close();
                    }
                }), (/**
                 * @return {?}
                 */
                function () {
                    if (_this.loading) {
                        _this.loading.close();
                    }
                }));
            }
            else if (this.classifier.id === 'remote') {
                if (!this.metadata.mdPkgName) {
                    /** @type {?} */
                    var msg = '未找到元数据包信息。';
                    gsp.ide.messager.error(msg);
                    return;
                }
                if (!this.metadata.repoPkg || this.metadata.repoPkg.length < 1) {
                    /** @type {?} */
                    var msg = '未找到仓库信息。';
                    gsp.ide.messager.error(msg);
                    return;
                }
                if (this.loading) {
                    this.loading.show({ message: '正在添加引用，请稍候...' });
                }
                this.metadataService.pickMetadataIndex(2, this.metadata, this.codelanguage, this.isMavenEnable).subscribe((/**
                 * @param {?} templates
                 * @return {?}
                 */
                function (templates) {
                    if (_this.loading) {
                        _this.loading.close();
                    }
                    templates.metadata.processMode = _this.metadata.processMode === 'interpretation' ? 'interpretation' : 'generation';
                    _this.selectedMetadata.emit(templates);
                    _this.hideModal();
                }), (/**
                 * @param {?} error
                 * @return {?}
                 */
                function (error) {
                    _this.errorMsg(error);
                    if (_this.loading) {
                        _this.loading.close();
                    }
                }), (/**
                 * @return {?}
                 */
                function () {
                    if (_this.loading) {
                        _this.loading.close();
                    }
                }));
            }
            else if (this.classifier.id === 'ref') {
                if (!this.metadata.mdPkgName) {
                    /** @type {?} */
                    var msg = '未找到元数据包信息。';
                    gsp.ide.messager.error(msg);
                    return;
                }
                if (!this.metadata.repoPkg || this.metadata.repoPkg.length < 1) {
                    /** @type {?} */
                    var msg = '未找到仓库信息。';
                    gsp.ide.messager.error(msg);
                    return;
                }
                if (this.loading) {
                    this.loading.show({ message: '请稍候...' });
                }
                this.metadataService.pickMetadataIndex(3, this.metadata, this.codelanguage, this.isMavenEnable).subscribe((/**
                 * @param {?} templates
                 * @return {?}
                 */
                function (templates) {
                    if (_this.loading) {
                        _this.loading.close();
                    }
                    templates.metadata.processMode = _this.metadata.processMode === 'interpretation' ? 'interpretation' : 'generation';
                    _this.selectedMetadata.emit(templates);
                    _this.hideModal();
                }), (/**
                 * @param {?} error
                 * @return {?}
                 */
                function (error) {
                    _this.errorMsg(error);
                    if (_this.loading) {
                        _this.loading.close();
                    }
                }), (/**
                 * @return {?}
                 */
                function () {
                    if (_this.loading) {
                        _this.loading.close();
                    }
                }));
            }
        }
        else {
            /** @type {?} */
            var msg = '请先选中一个元数据。';
            gsp.ide.messager.warning(msg);
        }
    };
    /**
     * @private
     * @param {?} error
     * @return {?}
     */
    SelectMetadataComponent.prototype.errorMsg = /**
     * @private
     * @param {?} error
     * @return {?}
     */
    function (error) {
        /** @type {?} */
        var msg = error.error.Message !== undefined ? error.error.Message : error.error.error.message;
        if (msg == null) {
            msg = '引用元数据失败。';
        }
        gsp.ide.messager.error(msg);
    };
    // 弹出元数据包选择界面
    // 弹出元数据包选择界面
    /**
     * @return {?}
     */
    SelectMetadataComponent.prototype.PackageSelect = 
    // 弹出元数据包选择界面
    /**
     * @return {?}
     */
    function () {
        this.metadatapackageselectComponent.showModal();
    };
    /**
     * @return {?}
     */
    SelectMetadataComponent.prototype.hideModal = /**
     * @return {?}
     */
    function () {
        this.closeModalEmitter.emit();
    };
    SelectMetadataComponent.decorators = [
        { type: Component, args: [{
                    // tslint:disable-next-line:component-selector
                    selector: 'app-select-metadata',
                    template: "<div class=\"farris-main-area d-flex flex-column\">\r\n  <div class=\"modal-body d-flex flex-fill flex-column\">\r\n    <div class=\"templateBlock flex-column flex-fill d-flex\">\r\n      <kendo-splitter class=\"d-flex \" style=\"flex: 1 1 auto;\" orientation=\"horizontal\">\r\n        <kendo-splitter-pane class=\"d-flex \" [collapsible]=\"true\" size=\"170px\" style=\"height: auto\">\r\n          <app-treeclassifier [metadataPath]=\"metadataPath\" [onlyDisplayCurrentProject]=\"onlyDisplayCurrentProject\"></app-treeclassifier>\r\n        </kendo-splitter-pane>\r\n        <kendo-splitter-pane class=\"d-flex\" style=\"height: auto\">\r\n          <app-metadatalist [typeName]=\"typeName\" [filter]=\"filter\" [isMavenEnable]=\"isMavenEnable\" (technologyStack)=\"setCodeLanguage($event)\"\r\n            (selectedMetadataChanged)=\"this.onSelectedMetadataChanged($event)\"></app-metadatalist>\r\n        </kendo-splitter-pane>\r\n      </kendo-splitter>\r\n    </div>\r\n  </div>\r\n  <div class=\"modal-footer\">\r\n    <button type=\"button\" click.once class=\"btn btn-outline-primary btn-sm px-3 mx-2\"\r\n      (click.once)=\"LoadMetadata()\">\u786E\u5B9A</button>\r\n    <button type=\"button\" class=\"btn btn-outline-secondary btn-sm px-3 mx-2\" (click)=\"hideModal()\">\u53D6\u6D88</button>\r\n  </div>\r\n</div>\r\n",
                    styles: [".templateBlock{display:flex}.infoBlock{width:100%;min-width:400px}.infoBlock label{width:50px}"]
                }] }
    ];
    /** @nocollapse */
    SelectMetadataComponent.ctorParameters = function () { return [
        { type: MetadataService },
        { type: LoadingService },
        { type: GSPMetadataService }
    ]; };
    SelectMetadataComponent.propDecorators = {
        metadatapackageselectComponent: [{ type: ViewChild, args: [MetadatapackageselectComponent,] }],
        metadataPath: [{ type: Input }],
        typeName: [{ type: Input }],
        filter: [{ type: Input }],
        onlyDisplayCurrentProject: [{ type: Input }],
        closeModalEmitter: [{ type: Output }],
        selectedMetadata: [{ type: Output }]
    };
    return SelectMetadataComponent;
}());
export { SelectMetadataComponent };
if (false) {
    /** @type {?} */
    SelectMetadataComponent.prototype.metadatapackageselectComponent;
    /** @type {?} */
    SelectMetadataComponent.prototype.metadataPath;
    /** @type {?} */
    SelectMetadataComponent.prototype.typeName;
    /** @type {?} */
    SelectMetadataComponent.prototype.filter;
    /** @type {?} */
    SelectMetadataComponent.prototype.onlyDisplayCurrentProject;
    /** @type {?} */
    SelectMetadataComponent.prototype.classifier;
    /** @type {?} */
    SelectMetadataComponent.prototype.codelanguage;
    /** @type {?} */
    SelectMetadataComponent.prototype.isMavenEnable;
    /** @type {?} */
    SelectMetadataComponent.prototype.metadata;
    /** @type {?} */
    SelectMetadataComponent.prototype.closeModalEmitter;
    /** @type {?} */
    SelectMetadataComponent.prototype.selectedMetadata;
    /**
     * @type {?}
     * @private
     */
    SelectMetadataComponent.prototype.metadataService;
    /**
     * @type {?}
     * @private
     */
    SelectMetadataComponent.prototype.loading;
    /**
     * @type {?}
     * @private
     */
    SelectMetadataComponent.prototype.gspMetaService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2VsZWN0bWV0YWRhdGEuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGdzcC1sY20vbWV0YWRhdGEtc2VsZWN0b3IvIiwic291cmNlcyI6WyJtZXRhZGF0YS9tZXRhZGF0YS1zZWxlY3QvY29tcG9uZW50cy9zZWxlY3RtZXRhZGF0ZS9zZWxlY3RtZXRhZGF0YS5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQ0EsT0FBTyxFQUFFLFNBQVMsRUFBRSxTQUFTLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRSxZQUFZLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDbEYsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLHdCQUF3QixDQUFDO0FBQ3pELE9BQU8sRUFBRSw4QkFBOEIsRUFBRSxNQUFNLDBEQUEwRCxDQUFDO0FBQzFHLE9BQU8sRUFBRSxlQUFlLEVBQUUscUJBQXFCLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQztBQUNsRixPQUFPLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSwyQkFBMkIsQ0FBQztBQUMvRCxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sb0JBQW9CLENBQUM7QUFFcEQ7SUFxQkUsaUNBQW9CLGVBQWdDLEVBQ2hDLE9BQXVCLEVBQ3ZCLGNBQWtDO1FBRnRELGlCQWFDO1FBYm1CLG9CQUFlLEdBQWYsZUFBZSxDQUFpQjtRQUNoQyxZQUFPLEdBQVAsT0FBTyxDQUFnQjtRQUN2QixtQkFBYyxHQUFkLGNBQWMsQ0FBb0I7UUFKNUMscUJBQWdCLEdBQUcsSUFBSSxZQUFZLEVBQU8sQ0FBQztRQUtuRCxJQUFJLENBQUMsaUJBQWlCLEdBQUcsSUFBSSxZQUFZLEVBQU8sQ0FBQztRQUNqRCxJQUFJLENBQUMsZUFBZSxDQUFDLGNBQWMsQ0FBQyxTQUFTOzs7O1FBQUMsVUFBQSxRQUFRO1lBQ3BELEtBQUksQ0FBQyxVQUFVLEdBQUcsUUFBUSxDQUFDO1FBQzdCLENBQUMsRUFBQyxDQUFDO1FBQ0gsSUFBSSxDQUFDLGFBQWEsR0FBRyxLQUFLLENBQUM7UUFDM0IsSUFBSSxDQUFDLGNBQWMsQ0FBQyxlQUFlLEVBQUUsQ0FBQyxTQUFTOzs7O1FBQUMsVUFBQSxJQUFJO1lBQ2xELGNBQWM7WUFDWixLQUFJLENBQUMsYUFBYSxHQUFHLElBQUksQ0FBQztZQUM1QixJQUFJO1FBQ04sQ0FBQyxFQUFDLENBQUM7SUFDTCxDQUFDOzs7OztJQUNELDJEQUF5Qjs7OztJQUF6QixVQUEwQixRQUFRO1FBQ2hDLElBQUksQ0FBQyxRQUFRLEdBQUcsUUFBUSxDQUFDO0lBQzNCLENBQUM7Ozs7O0lBRUQsaURBQWU7Ozs7SUFBZixVQUFnQixJQUFZO1FBQzFCLElBQUksQ0FBQyxZQUFZLEdBQUcsSUFBSSxDQUFDO0lBQzNCLENBQUM7Ozs7SUFFRCw4Q0FBWTs7O0lBQVo7UUFBQSxpQkF3RkM7UUF2RkMsSUFBSSxJQUFJLENBQUMsUUFBUSxJQUFJLElBQUksQ0FBQyxVQUFVLEVBQUU7WUFDcEMsdUJBQXVCO1lBQ3ZCLElBQUksSUFBSSxDQUFDLFVBQVUsQ0FBQyxFQUFFLEtBQUssU0FBUyxJQUFJLElBQUksQ0FBQyxVQUFVLENBQUMsRUFBRSxLQUFLLElBQUksRUFBRTtnQkFDbkUsSUFBSSxJQUFJLENBQUMsT0FBTyxFQUFFO29CQUFFLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLEVBQUUsT0FBTyxFQUFFLGVBQWUsRUFBRSxDQUFDLENBQUM7aUJBQUU7Z0JBQ3RFLElBQUksQ0FBQyxlQUFlLENBQUMsZUFBZSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQyxTQUFTOzs7O2dCQUFDLFVBQUEsU0FBUztvQkFDckUsSUFBSSxLQUFJLENBQUMsT0FBTyxFQUFFO3dCQUFFLEtBQUksQ0FBQyxPQUFPLENBQUMsS0FBSyxFQUFFLENBQUM7cUJBQUU7O3dCQUNyQyxZQUFZLEdBQUcsSUFBSSxlQUFlLEVBQUU7b0JBQzFDLFlBQVksQ0FBQyxRQUFRLEdBQUcsU0FBUyxDQUFDO29CQUNsQyxZQUFZLENBQUMsUUFBUSxDQUFDLFdBQVcsR0FBRyxLQUFJLENBQUMsUUFBUSxDQUFDLFdBQVcsS0FBSyxnQkFBZ0IsQ0FBQyxDQUFDLENBQUMsZ0JBQWdCLENBQUMsQ0FBQyxDQUFDLFlBQVksQ0FBQztvQkFDckgsWUFBWSxDQUFDLGFBQWEsR0FBRyxJQUFJLHFCQUFxQixFQUFFLENBQUM7b0JBQ3pELEtBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUM7b0JBQ3pDLEtBQUksQ0FBQyxTQUFTLEVBQUUsQ0FBQztnQkFDbkIsQ0FBQzs7OztnQkFBRSxVQUFBLEtBQUs7b0JBQ04sS0FBSSxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsQ0FBQztvQkFDckIsSUFBSSxLQUFJLENBQUMsT0FBTyxFQUFFO3dCQUFFLEtBQUksQ0FBQyxPQUFPLENBQUMsS0FBSyxFQUFFLENBQUM7cUJBQUU7Z0JBQzdDLENBQUM7OztnQkFBRTtvQkFDRCxJQUFJLEtBQUksQ0FBQyxPQUFPLEVBQUU7d0JBQUUsS0FBSSxDQUFDLE9BQU8sQ0FBQyxLQUFLLEVBQUUsQ0FBQztxQkFBRTtnQkFDN0MsQ0FBQyxFQUFDLENBQUM7YUFDSjtpQkFBTSxJQUFJLElBQUksQ0FBQyxVQUFVLENBQUMsRUFBRSxLQUFLLE9BQU8sRUFBRTtnQkFDekMsSUFBSSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsU0FBUyxFQUFFOzt3QkFDdEIsR0FBRyxHQUFHLFlBQVk7b0JBQ3hCLEdBQUcsQ0FBQyxHQUFHLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQztvQkFDNUIsT0FBTztpQkFDUjtnQkFDRCxJQUFJLElBQUksQ0FBQyxPQUFPLEVBQUU7b0JBQUUsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsRUFBRSxPQUFPLEVBQUUsZUFBZSxFQUFFLENBQUMsQ0FBQztpQkFBRTtnQkFDdEUsSUFBSSxDQUFDLGVBQWUsQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDLEVBQUUsSUFBSSxDQUFDLFFBQVEsRUFBRSxJQUFJLENBQUMsWUFBWSxFQUFFLElBQUksQ0FBQyxhQUFhLENBQUMsQ0FBQyxTQUFTOzs7O2dCQUFDLFVBQUEsU0FBUztvQkFDakgsSUFBSSxLQUFJLENBQUMsT0FBTyxFQUFFO3dCQUFFLEtBQUksQ0FBQyxPQUFPLENBQUMsS0FBSyxFQUFFLENBQUM7cUJBQUU7b0JBQzNDLFNBQVMsQ0FBQyxRQUFRLENBQUMsV0FBVyxHQUFHLEtBQUksQ0FBQyxRQUFRLENBQUMsV0FBVyxLQUFLLGdCQUFnQixDQUFDLENBQUMsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLENBQUMsWUFBWSxDQUFDO29CQUNsSCxLQUFJLENBQUMsZ0JBQWdCLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDO29CQUN0QyxLQUFJLENBQUMsU0FBUyxFQUFFLENBQUM7Z0JBQ25CLENBQUM7Ozs7Z0JBQUUsVUFBQSxLQUFLO29CQUNOLEtBQUksQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLENBQUM7b0JBQ3JCLElBQUksS0FBSSxDQUFDLE9BQU8sRUFBRTt3QkFBRSxLQUFJLENBQUMsT0FBTyxDQUFDLEtBQUssRUFBRSxDQUFDO3FCQUFFO2dCQUM3QyxDQUFDOzs7Z0JBQUU7b0JBQ0QsSUFBSSxLQUFJLENBQUMsT0FBTyxFQUFFO3dCQUFFLEtBQUksQ0FBQyxPQUFPLENBQUMsS0FBSyxFQUFFLENBQUM7cUJBQUU7Z0JBQzdDLENBQUMsRUFBQyxDQUFDO2FBQ0o7aUJBQU0sSUFBSSxJQUFJLENBQUMsVUFBVSxDQUFDLEVBQUUsS0FBSyxRQUFRLEVBQUU7Z0JBQzFDLElBQUksQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLFNBQVMsRUFBRTs7d0JBQ3RCLEdBQUcsR0FBRyxZQUFZO29CQUN4QixHQUFHLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUM7b0JBQzVCLE9BQU87aUJBQ1I7Z0JBQ0QsSUFBSSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsT0FBTyxJQUFJLElBQUksQ0FBQyxRQUFRLENBQUMsT0FBTyxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUU7O3dCQUN4RCxHQUFHLEdBQUcsVUFBVTtvQkFDdEIsR0FBRyxDQUFDLEdBQUcsQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDO29CQUM1QixPQUFPO2lCQUNSO2dCQUNELElBQUksSUFBSSxDQUFDLE9BQU8sRUFBRTtvQkFBRSxJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxFQUFFLE9BQU8sRUFBRSxlQUFlLEVBQUUsQ0FBQyxDQUFDO2lCQUFFO2dCQUN0RSxJQUFJLENBQUMsZUFBZSxDQUFDLGlCQUFpQixDQUFDLENBQUMsRUFBRSxJQUFJLENBQUMsUUFBUSxFQUFFLElBQUksQ0FBQyxZQUFZLEVBQUUsSUFBSSxDQUFDLGFBQWEsQ0FBQyxDQUFDLFNBQVM7Ozs7Z0JBQUMsVUFBQSxTQUFTO29CQUNqSCxJQUFJLEtBQUksQ0FBQyxPQUFPLEVBQUU7d0JBQUUsS0FBSSxDQUFDLE9BQU8sQ0FBQyxLQUFLLEVBQUUsQ0FBQztxQkFBRTtvQkFDM0MsU0FBUyxDQUFDLFFBQVEsQ0FBQyxXQUFXLEdBQUcsS0FBSSxDQUFDLFFBQVEsQ0FBQyxXQUFXLEtBQUssZ0JBQWdCLENBQUMsQ0FBQyxDQUFDLGdCQUFnQixDQUFDLENBQUMsQ0FBQyxZQUFZLENBQUM7b0JBQ2xILEtBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUM7b0JBQ3RDLEtBQUksQ0FBQyxTQUFTLEVBQUUsQ0FBQztnQkFDbkIsQ0FBQzs7OztnQkFBRSxVQUFBLEtBQUs7b0JBQ04sS0FBSSxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsQ0FBQztvQkFDckIsSUFBSSxLQUFJLENBQUMsT0FBTyxFQUFFO3dCQUFFLEtBQUksQ0FBQyxPQUFPLENBQUMsS0FBSyxFQUFFLENBQUM7cUJBQUU7Z0JBQzdDLENBQUM7OztnQkFBRTtvQkFDRCxJQUFJLEtBQUksQ0FBQyxPQUFPLEVBQUU7d0JBQUUsS0FBSSxDQUFDLE9BQU8sQ0FBQyxLQUFLLEVBQUUsQ0FBQztxQkFBRTtnQkFDN0MsQ0FBQyxFQUFDLENBQUM7YUFDSjtpQkFBTSxJQUFJLElBQUksQ0FBQyxVQUFVLENBQUMsRUFBRSxLQUFLLEtBQUssRUFBRTtnQkFDdkMsSUFBSSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsU0FBUyxFQUFFOzt3QkFDdEIsR0FBRyxHQUFHLFlBQVk7b0JBQ3hCLEdBQUcsQ0FBQyxHQUFHLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQztvQkFDNUIsT0FBTztpQkFDUjtnQkFDRCxJQUFJLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxPQUFPLElBQUksSUFBSSxDQUFDLFFBQVEsQ0FBQyxPQUFPLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRTs7d0JBQ3hELEdBQUcsR0FBRyxVQUFVO29CQUN0QixHQUFHLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUM7b0JBQzVCLE9BQU87aUJBQ1I7Z0JBQ0QsSUFBSSxJQUFJLENBQUMsT0FBTyxFQUFFO29CQUFFLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLEVBQUUsT0FBTyxFQUFFLFFBQVEsRUFBRSxDQUFDLENBQUM7aUJBQUU7Z0JBQy9ELElBQUksQ0FBQyxlQUFlLENBQUMsaUJBQWlCLENBQUMsQ0FBQyxFQUFFLElBQUksQ0FBQyxRQUFRLEVBQUUsSUFBSSxDQUFDLFlBQVksRUFBRSxJQUFJLENBQUMsYUFBYSxDQUFDLENBQUMsU0FBUzs7OztnQkFBQyxVQUFBLFNBQVM7b0JBQ2pILElBQUksS0FBSSxDQUFDLE9BQU8sRUFBRTt3QkFBRSxLQUFJLENBQUMsT0FBTyxDQUFDLEtBQUssRUFBRSxDQUFDO3FCQUFFO29CQUMzQyxTQUFTLENBQUMsUUFBUSxDQUFDLFdBQVcsR0FBRyxLQUFJLENBQUMsUUFBUSxDQUFDLFdBQVcsS0FBSyxnQkFBZ0IsQ0FBQyxDQUFDLENBQUMsZ0JBQWdCLENBQUMsQ0FBQyxDQUFDLFlBQVksQ0FBQztvQkFDbEgsS0FBSSxDQUFDLGdCQUFnQixDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQztvQkFDdEMsS0FBSSxDQUFDLFNBQVMsRUFBRSxDQUFDO2dCQUNuQixDQUFDOzs7O2dCQUFFLFVBQUEsS0FBSztvQkFDTixLQUFJLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxDQUFDO29CQUNyQixJQUFJLEtBQUksQ0FBQyxPQUFPLEVBQUU7d0JBQUUsS0FBSSxDQUFDLE9BQU8sQ0FBQyxLQUFLLEVBQUUsQ0FBQztxQkFBRTtnQkFDN0MsQ0FBQzs7O2dCQUFFO29CQUNELElBQUksS0FBSSxDQUFDLE9BQU8sRUFBRTt3QkFBRSxLQUFJLENBQUMsT0FBTyxDQUFDLEtBQUssRUFBRSxDQUFDO3FCQUFFO2dCQUM3QyxDQUFDLEVBQUMsQ0FBQzthQUNKO1NBQ0Y7YUFBTTs7Z0JBQ0MsR0FBRyxHQUFHLFlBQVk7WUFDeEIsR0FBRyxDQUFDLEdBQUcsQ0FBQyxRQUFRLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1NBQy9CO0lBQ0gsQ0FBQzs7Ozs7O0lBRU8sMENBQVE7Ozs7O0lBQWhCLFVBQWlCLEtBQUs7O1lBQ2hCLEdBQUcsR0FBRyxLQUFLLENBQUMsS0FBSyxDQUFDLE9BQU8sS0FBSyxTQUFTLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxPQUFPO1FBQzdGLElBQUksR0FBRyxJQUFJLElBQUksRUFBRTtZQUNmLEdBQUcsR0FBRyxVQUFVLENBQUM7U0FDbEI7UUFDRCxHQUFHLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDOUIsQ0FBQztJQUVELGFBQWE7Ozs7O0lBQ2IsK0NBQWE7Ozs7O0lBQWI7UUFDRSxJQUFJLENBQUMsOEJBQThCLENBQUMsU0FBUyxFQUFFLENBQUM7SUFDbEQsQ0FBQzs7OztJQUNELDJDQUFTOzs7SUFBVDtRQUNFLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxJQUFJLEVBQUUsQ0FBQztJQUNoQyxDQUFDOztnQkFuSkYsU0FBUyxTQUFDOztvQkFFVCxRQUFRLEVBQUUscUJBQXFCO29CQUMvQiwrekNBQThDOztpQkFFL0M7Ozs7Z0JBWFEsZUFBZTtnQkFJZixjQUFjO2dCQURkLGtCQUFrQjs7O2lEQVV4QixTQUFTLFNBQUMsOEJBQThCOytCQUN4QyxLQUFLOzJCQUNMLEtBQUs7eUJBQ0wsS0FBSzs0Q0FDTCxLQUFLO29DQU9MLE1BQU07bUNBQ04sTUFBTTs7SUFpSVQsOEJBQUM7Q0FBQSxBQXBKRCxJQW9KQztTQTlJWSx1QkFBdUI7OztJQUNsQyxpRUFBMEc7O0lBQzFHLCtDQUE4Qjs7SUFDOUIsMkNBQTBCOztJQUMxQix5Q0FBd0I7O0lBQ3hCLDREQUE0Qzs7SUFDNUMsNkNBQWdCOztJQUVoQiwrQ0FBcUI7O0lBRXJCLGdEQUF1Qjs7SUFDdkIsMkNBQWM7O0lBQ2Qsb0RBQStDOztJQUMvQyxtREFBcUQ7Ozs7O0lBRXpDLGtEQUF3Qzs7Ozs7SUFDeEMsMENBQStCOzs7OztJQUMvQixpREFBMEMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bWF4LWxpbmUtbGVuZ3RoXHJcbmltcG9ydCB7IENvbXBvbmVudCwgVmlld0NoaWxkLCBJbnB1dCwgT3V0cHV0LCBFdmVudEVtaXR0ZXIgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgTWV0YWRhdGFTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vbWV0YWRhdGEuc2VydmljZSc7XHJcbmltcG9ydCB7IE1ldGFkYXRhcGFja2FnZXNlbGVjdENvbXBvbmVudCB9IGZyb20gJy4uL21ldGFkYXRhcGFja2FnZXNlbGVjdC9tZXRhZGF0YXBhY2thZ2VzZWxlY3QuY29tcG9uZW50JztcclxuaW1wb3J0IHsgTWV0YWRhdGE0UmVmRHRvLCBNZXRhZGF0YVBhY2thZ2VIZWFkZXIgfSBmcm9tICcuLi8uLi8uLi9tZXRhZGF0YTRyZWZkdG8nO1xyXG5pbXBvcnQgeyBHU1BNZXRhZGF0YVNlcnZpY2UgfSBmcm9tICcuLi8uLi8uLi9tZXRhZGF0YS5zZXJ2aWNlJztcclxuaW1wb3J0IHsgTG9hZGluZ1NlcnZpY2UgfSBmcm9tICdAZmFycmlzL3VpLWxvYWRpbmcnO1xyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOmNvbXBvbmVudC1zZWxlY3RvclxyXG4gIHNlbGVjdG9yOiAnYXBwLXNlbGVjdC1tZXRhZGF0YScsXHJcbiAgdGVtcGxhdGVVcmw6ICcuL3NlbGVjdG1ldGFkYXRhLmNvbXBvbmVudC5odG1sJyxcclxuICBzdHlsZVVybHM6IFsnLi9zZWxlY3RtZXRhZGF0YS5jb21wb25lbnQuY3NzJ11cclxufSlcclxuZXhwb3J0IGNsYXNzIFNlbGVjdE1ldGFkYXRhQ29tcG9uZW50IHtcclxuICBAVmlld0NoaWxkKE1ldGFkYXRhcGFja2FnZXNlbGVjdENvbXBvbmVudCkgbWV0YWRhdGFwYWNrYWdlc2VsZWN0Q29tcG9uZW50OiBNZXRhZGF0YXBhY2thZ2VzZWxlY3RDb21wb25lbnQ7XHJcbiAgQElucHV0KCkgbWV0YWRhdGFQYXRoOiBzdHJpbmc7XHJcbiAgQElucHV0KCkgdHlwZU5hbWU6IHN0cmluZztcclxuICBASW5wdXQoKSBmaWx0ZXI6IHN0cmluZztcclxuICBASW5wdXQoKSBvbmx5RGlzcGxheUN1cnJlbnRQcm9qZWN0OiBib29sZWFuO1xyXG4gIGNsYXNzaWZpZXI6IGFueTtcclxuICAvLyDmioDmnK/moIhcclxuICBjb2RlbGFuZ3VhZ2U6IHN0cmluZztcclxuICAvLyDmmK/lkKblvIDlkK9tYXZlbuW8leeUqFxyXG4gIGlzTWF2ZW5FbmFibGU6IGJvb2xlYW47XHJcbiAgbWV0YWRhdGE6IGFueTtcclxuICBAT3V0cHV0KCkgY2xvc2VNb2RhbEVtaXR0ZXI6IEV2ZW50RW1pdHRlcjxhbnk+O1xyXG4gIEBPdXRwdXQoKSBzZWxlY3RlZE1ldGFkYXRhID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XHJcblxyXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgbWV0YWRhdGFTZXJ2aWNlOiBNZXRhZGF0YVNlcnZpY2UsXHJcbiAgICAgICAgICAgICAgcHJpdmF0ZSBsb2FkaW5nOiBMb2FkaW5nU2VydmljZSxcclxuICAgICAgICAgICAgICBwcml2YXRlIGdzcE1ldGFTZXJ2aWNlOiBHU1BNZXRhZGF0YVNlcnZpY2UpIHtcclxuICAgIHRoaXMuY2xvc2VNb2RhbEVtaXR0ZXIgPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcclxuICAgIHRoaXMubWV0YWRhdGFTZXJ2aWNlLnNlbGVjdGVkQ2hhbmdlLnN1YnNjcmliZShsZWZ0SXRlbSA9PiB7XHJcbiAgICAgIHRoaXMuY2xhc3NpZmllciA9IGxlZnRJdGVtO1xyXG4gICAgfSk7XHJcbiAgICB0aGlzLmlzTWF2ZW5FbmFibGUgPSBmYWxzZTtcclxuICAgIHRoaXMuZ3NwTWV0YVNlcnZpY2UuZ2V0TWF2ZW5TZXR0aW5nKCkuc3Vic2NyaWJlKGZsYWcgPT4ge1xyXG4gICAgICAvLyBpZiAoZmxhZykge1xyXG4gICAgICAgIHRoaXMuaXNNYXZlbkVuYWJsZSA9IGZsYWc7XHJcbiAgICAgIC8vIH1cclxuICAgIH0pO1xyXG4gIH1cclxuICBvblNlbGVjdGVkTWV0YWRhdGFDaGFuZ2VkKG1ldGFkYXRhKSB7XHJcbiAgICB0aGlzLm1ldGFkYXRhID0gbWV0YWRhdGE7XHJcbiAgfVxyXG5cclxuICBzZXRDb2RlTGFuZ3VhZ2UoY29kZTogc3RyaW5nKSB7XHJcbiAgICB0aGlzLmNvZGVsYW5ndWFnZSA9IGNvZGU7XHJcbiAgfVxyXG5cclxuICBMb2FkTWV0YWRhdGEoKSB7XHJcbiAgICBpZiAodGhpcy5tZXRhZGF0YSAmJiB0aGlzLmNsYXNzaWZpZXIpIHtcclxuICAgICAgLy8g6YCJ5Lit55qE5piv5b2T5YmN5bel56iL5LiL55qE5YWD5pWw5o2u77yM6LCD55SoTG9hZFxyXG4gICAgICBpZiAodGhpcy5jbGFzc2lmaWVyLmlkID09PSAncHJvamVjdCcgfHwgdGhpcy5jbGFzc2lmaWVyLmlkID09PSAnYm8nKSB7XHJcbiAgICAgICAgaWYgKHRoaXMubG9hZGluZykgeyB0aGlzLmxvYWRpbmcuc2hvdyh7IG1lc3NhZ2U6ICfmraPlnKjmt7vliqDlvJXnlKjvvIzor7fnqI3lgJkuLi4nIH0pOyB9XHJcbiAgICAgICAgdGhpcy5tZXRhZGF0YVNlcnZpY2UuTG9hZFRoZU1ldGFkYXRhKHRoaXMubWV0YWRhdGEpLnN1YnNjcmliZSh0ZW1wbGF0ZXMgPT4ge1xyXG4gICAgICAgICAgaWYgKHRoaXMubG9hZGluZykgeyB0aGlzLmxvYWRpbmcuY2xvc2UoKTsgfVxyXG4gICAgICAgICAgY29uc3QgbWV0YWRhdGE0UmVmID0gbmV3IE1ldGFkYXRhNFJlZkR0bygpO1xyXG4gICAgICAgICAgbWV0YWRhdGE0UmVmLm1ldGFkYXRhID0gdGVtcGxhdGVzO1xyXG4gICAgICAgICAgbWV0YWRhdGE0UmVmLm1ldGFkYXRhLnByb2Nlc3NNb2RlID0gdGhpcy5tZXRhZGF0YS5wcm9jZXNzTW9kZSA9PT0gJ2ludGVycHJldGF0aW9uJyA/ICdpbnRlcnByZXRhdGlvbicgOiAnZ2VuZXJhdGlvbic7XHJcbiAgICAgICAgICBtZXRhZGF0YTRSZWYucGFja2FnZUhlYWRlciA9IG5ldyBNZXRhZGF0YVBhY2thZ2VIZWFkZXIoKTtcclxuICAgICAgICAgIHRoaXMuc2VsZWN0ZWRNZXRhZGF0YS5lbWl0KG1ldGFkYXRhNFJlZik7XHJcbiAgICAgICAgICB0aGlzLmhpZGVNb2RhbCgpO1xyXG4gICAgICAgIH0sIGVycm9yID0+IHtcclxuICAgICAgICAgIHRoaXMuZXJyb3JNc2coZXJyb3IpO1xyXG4gICAgICAgICAgaWYgKHRoaXMubG9hZGluZykgeyB0aGlzLmxvYWRpbmcuY2xvc2UoKTsgfVxyXG4gICAgICAgIH0sICgpID0+IHtcclxuICAgICAgICAgIGlmICh0aGlzLmxvYWRpbmcpIHsgdGhpcy5sb2FkaW5nLmNsb3NlKCk7IH1cclxuICAgICAgICB9KTtcclxuICAgICAgfSBlbHNlIGlmICh0aGlzLmNsYXNzaWZpZXIuaWQgPT09ICdsb2NhbCcpIHtcclxuICAgICAgICBpZiAoIXRoaXMubWV0YWRhdGEubWRQa2dOYW1lKSB7XHJcbiAgICAgICAgICBjb25zdCBtc2cgPSAn5pyq5om+5Yiw5YWD5pWw5o2u5YyF5L+h5oGv44CCJztcclxuICAgICAgICAgIGdzcC5pZGUubWVzc2FnZXIuZXJyb3IobXNnKTtcclxuICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHRoaXMubG9hZGluZykgeyB0aGlzLmxvYWRpbmcuc2hvdyh7IG1lc3NhZ2U6ICfmraPlnKjmt7vliqDlvJXnlKjvvIzor7fnqI3lgJkuLi4nIH0pOyB9XHJcbiAgICAgICAgdGhpcy5tZXRhZGF0YVNlcnZpY2UucGlja01ldGFkYXRhSW5kZXgoMSwgdGhpcy5tZXRhZGF0YSwgdGhpcy5jb2RlbGFuZ3VhZ2UsIHRoaXMuaXNNYXZlbkVuYWJsZSkuc3Vic2NyaWJlKHRlbXBsYXRlcyA9PiB7XHJcbiAgICAgICAgICBpZiAodGhpcy5sb2FkaW5nKSB7IHRoaXMubG9hZGluZy5jbG9zZSgpOyB9XHJcbiAgICAgICAgICB0ZW1wbGF0ZXMubWV0YWRhdGEucHJvY2Vzc01vZGUgPSB0aGlzLm1ldGFkYXRhLnByb2Nlc3NNb2RlID09PSAnaW50ZXJwcmV0YXRpb24nID8gJ2ludGVycHJldGF0aW9uJyA6ICdnZW5lcmF0aW9uJztcclxuICAgICAgICAgIHRoaXMuc2VsZWN0ZWRNZXRhZGF0YS5lbWl0KHRlbXBsYXRlcyk7XHJcbiAgICAgICAgICB0aGlzLmhpZGVNb2RhbCgpO1xyXG4gICAgICAgIH0sIGVycm9yID0+IHtcclxuICAgICAgICAgIHRoaXMuZXJyb3JNc2coZXJyb3IpO1xyXG4gICAgICAgICAgaWYgKHRoaXMubG9hZGluZykgeyB0aGlzLmxvYWRpbmcuY2xvc2UoKTsgfVxyXG4gICAgICAgIH0sICgpID0+IHtcclxuICAgICAgICAgIGlmICh0aGlzLmxvYWRpbmcpIHsgdGhpcy5sb2FkaW5nLmNsb3NlKCk7IH1cclxuICAgICAgICB9KTtcclxuICAgICAgfSBlbHNlIGlmICh0aGlzLmNsYXNzaWZpZXIuaWQgPT09ICdyZW1vdGUnKSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLm1ldGFkYXRhLm1kUGtnTmFtZSkge1xyXG4gICAgICAgICAgY29uc3QgbXNnID0gJ+acquaJvuWIsOWFg+aVsOaNruWMheS/oeaBr+OAgic7XHJcbiAgICAgICAgICBnc3AuaWRlLm1lc3NhZ2VyLmVycm9yKG1zZyk7XHJcbiAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICghdGhpcy5tZXRhZGF0YS5yZXBvUGtnIHx8IHRoaXMubWV0YWRhdGEucmVwb1BrZy5sZW5ndGggPCAxKSB7XHJcbiAgICAgICAgICBjb25zdCBtc2cgPSAn5pyq5om+5Yiw5LuT5bqT5L+h5oGv44CCJztcclxuICAgICAgICAgIGdzcC5pZGUubWVzc2FnZXIuZXJyb3IobXNnKTtcclxuICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHRoaXMubG9hZGluZykgeyB0aGlzLmxvYWRpbmcuc2hvdyh7IG1lc3NhZ2U6ICfmraPlnKjmt7vliqDlvJXnlKjvvIzor7fnqI3lgJkuLi4nIH0pOyB9XHJcbiAgICAgICAgdGhpcy5tZXRhZGF0YVNlcnZpY2UucGlja01ldGFkYXRhSW5kZXgoMiwgdGhpcy5tZXRhZGF0YSwgdGhpcy5jb2RlbGFuZ3VhZ2UsIHRoaXMuaXNNYXZlbkVuYWJsZSkuc3Vic2NyaWJlKHRlbXBsYXRlcyA9PiB7XHJcbiAgICAgICAgICBpZiAodGhpcy5sb2FkaW5nKSB7IHRoaXMubG9hZGluZy5jbG9zZSgpOyB9XHJcbiAgICAgICAgICB0ZW1wbGF0ZXMubWV0YWRhdGEucHJvY2Vzc01vZGUgPSB0aGlzLm1ldGFkYXRhLnByb2Nlc3NNb2RlID09PSAnaW50ZXJwcmV0YXRpb24nID8gJ2ludGVycHJldGF0aW9uJyA6ICdnZW5lcmF0aW9uJztcclxuICAgICAgICAgIHRoaXMuc2VsZWN0ZWRNZXRhZGF0YS5lbWl0KHRlbXBsYXRlcyk7XHJcbiAgICAgICAgICB0aGlzLmhpZGVNb2RhbCgpO1xyXG4gICAgICAgIH0sIGVycm9yID0+IHtcclxuICAgICAgICAgIHRoaXMuZXJyb3JNc2coZXJyb3IpO1xyXG4gICAgICAgICAgaWYgKHRoaXMubG9hZGluZykgeyB0aGlzLmxvYWRpbmcuY2xvc2UoKTsgfVxyXG4gICAgICAgIH0sICgpID0+IHtcclxuICAgICAgICAgIGlmICh0aGlzLmxvYWRpbmcpIHsgdGhpcy5sb2FkaW5nLmNsb3NlKCk7IH1cclxuICAgICAgICB9KTtcclxuICAgICAgfSBlbHNlIGlmICh0aGlzLmNsYXNzaWZpZXIuaWQgPT09ICdyZWYnKSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLm1ldGFkYXRhLm1kUGtnTmFtZSkge1xyXG4gICAgICAgICAgY29uc3QgbXNnID0gJ+acquaJvuWIsOWFg+aVsOaNruWMheS/oeaBr+OAgic7XHJcbiAgICAgICAgICBnc3AuaWRlLm1lc3NhZ2VyLmVycm9yKG1zZyk7XHJcbiAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICghdGhpcy5tZXRhZGF0YS5yZXBvUGtnIHx8IHRoaXMubWV0YWRhdGEucmVwb1BrZy5sZW5ndGggPCAxKSB7XHJcbiAgICAgICAgICBjb25zdCBtc2cgPSAn5pyq5om+5Yiw5LuT5bqT5L+h5oGv44CCJztcclxuICAgICAgICAgIGdzcC5pZGUubWVzc2FnZXIuZXJyb3IobXNnKTtcclxuICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHRoaXMubG9hZGluZykgeyB0aGlzLmxvYWRpbmcuc2hvdyh7IG1lc3NhZ2U6ICfor7fnqI3lgJkuLi4nIH0pOyB9XHJcbiAgICAgICAgdGhpcy5tZXRhZGF0YVNlcnZpY2UucGlja01ldGFkYXRhSW5kZXgoMywgdGhpcy5tZXRhZGF0YSwgdGhpcy5jb2RlbGFuZ3VhZ2UsIHRoaXMuaXNNYXZlbkVuYWJsZSkuc3Vic2NyaWJlKHRlbXBsYXRlcyA9PiB7XHJcbiAgICAgICAgICBpZiAodGhpcy5sb2FkaW5nKSB7IHRoaXMubG9hZGluZy5jbG9zZSgpOyB9XHJcbiAgICAgICAgICB0ZW1wbGF0ZXMubWV0YWRhdGEucHJvY2Vzc01vZGUgPSB0aGlzLm1ldGFkYXRhLnByb2Nlc3NNb2RlID09PSAnaW50ZXJwcmV0YXRpb24nID8gJ2ludGVycHJldGF0aW9uJyA6ICdnZW5lcmF0aW9uJztcclxuICAgICAgICAgIHRoaXMuc2VsZWN0ZWRNZXRhZGF0YS5lbWl0KHRlbXBsYXRlcyk7XHJcbiAgICAgICAgICB0aGlzLmhpZGVNb2RhbCgpO1xyXG4gICAgICAgIH0sIGVycm9yID0+IHtcclxuICAgICAgICAgIHRoaXMuZXJyb3JNc2coZXJyb3IpO1xyXG4gICAgICAgICAgaWYgKHRoaXMubG9hZGluZykgeyB0aGlzLmxvYWRpbmcuY2xvc2UoKTsgfVxyXG4gICAgICAgIH0sICgpID0+IHtcclxuICAgICAgICAgIGlmICh0aGlzLmxvYWRpbmcpIHsgdGhpcy5sb2FkaW5nLmNsb3NlKCk7IH1cclxuICAgICAgICB9KTtcclxuICAgICAgfVxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgY29uc3QgbXNnID0gJ+ivt+WFiOmAieS4reS4gOS4quWFg+aVsOaNruOAgic7XHJcbiAgICAgIGdzcC5pZGUubWVzc2FnZXIud2FybmluZyhtc2cpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBlcnJvck1zZyhlcnJvcikge1xyXG4gICAgbGV0IG1zZyA9IGVycm9yLmVycm9yLk1lc3NhZ2UgIT09IHVuZGVmaW5lZCA/IGVycm9yLmVycm9yLk1lc3NhZ2UgOiBlcnJvci5lcnJvci5lcnJvci5tZXNzYWdlO1xyXG4gICAgaWYgKG1zZyA9PSBudWxsKSB7XHJcbiAgICAgIG1zZyA9ICflvJXnlKjlhYPmlbDmja7lpLHotKXjgIInO1xyXG4gICAgfVxyXG4gICAgZ3NwLmlkZS5tZXNzYWdlci5lcnJvcihtc2cpO1xyXG4gIH1cclxuXHJcbiAgLy8g5by55Ye65YWD5pWw5o2u5YyF6YCJ5oup55WM6Z2iXHJcbiAgUGFja2FnZVNlbGVjdCgpIHtcclxuICAgIHRoaXMubWV0YWRhdGFwYWNrYWdlc2VsZWN0Q29tcG9uZW50LnNob3dNb2RhbCgpO1xyXG4gIH1cclxuICBoaWRlTW9kYWwoKTogdm9pZCB7XHJcbiAgICB0aGlzLmNsb3NlTW9kYWxFbWl0dGVyLmVtaXQoKTtcclxuICB9XHJcbn1cclxuIl19
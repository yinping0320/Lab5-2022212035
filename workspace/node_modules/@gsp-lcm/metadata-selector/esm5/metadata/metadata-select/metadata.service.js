/**
 * @fileoverview added by tsickle
 * Generated from: metadata/metadata-select/metadata.service.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Injectable, EventEmitter } from '@angular/core';
import { Observable } from 'rxjs/Observable';
import { GSPMetadataService } from '../metadata.service';
// mock数据
/** @type {?} */
var classifier = [
    { id: 'project', text: '工程内元数据' },
    { id: 'local', text: '离线的元数据' },
    { id: 'remote', text: '仓库中元数据' },
    { id: 'ref', text: '引用的元数据' } // 3
];
/** @type {?} */
var classifierForBo = [
    { id: 'bo', text: 'BO内元数据' },
    { id: 'local', text: '离线的元数据' },
    { id: 'remote', text: '仓库中元数据' },
    { id: 'ref', text: '引用的元数据' } // 3
];
var MetadataService = /** @class */ (function () {
    function MetadataService(gspMetadataService) {
        this.gspMetadataService = gspMetadataService;
        this.selectedChange = new EventEmitter();
        // tslint:disable-next-line:member-ordering
        this.metadatas = [];
        // tslint:disable-next-line:member-ordering
        this.packages = [];
        this.packRefPath = '/packages';
    }
    /**
     * @param {?} type
     * @return {?}
     */
    MetadataService.prototype.getMetadataClassifier = /**
     * @param {?} type
     * @return {?}
     */
    function (type) {
        switch (type) {
            case 'bo':
                return classifierForBo;
            case 'project':
            default:
                return classifier;
        }
    };
    /**
     * @param {?} metadata
     * @return {?}
     */
    MetadataService.prototype.addMetadata = /**
     * @param {?} metadata
     * @return {?}
     */
    function (metadata) {
        this.metadatas.push(metadata);
    };
    /**
     * @return {?}
     */
    MetadataService.prototype.clearMetadata = /**
     * @return {?}
     */
    function () {
        this.metadatas = [];
    };
    /**
     * @param {?} mp
     * @return {?}
     */
    MetadataService.prototype.addPackage = /**
     * @param {?} mp
     * @return {?}
     */
    function (mp) {
        this.packages.push(mp);
    };
    /**
     * @return {?}
     */
    MetadataService.prototype.clearPackage = /**
     * @return {?}
     */
    function () {
        this.packages = [];
    };
    // 获取当前工程下所有的元数据
    // 获取当前工程下所有的元数据
    /**
     * @param {?} typeName
     * @return {?}
     */
    MetadataService.prototype.GetMetadataList = 
    // 获取当前工程下所有的元数据
    /**
     * @param {?} typeName
     * @return {?}
     */
    function (typeName) {
        return this.gspMetadataService.GetMetadataList(this.currentProjectPath, typeName);
    };
    // 获取当前工程下所有的元数据
    // 获取当前工程下所有的元数据
    /**
     * @param {?} typeName
     * @return {?}
     */
    MetadataService.prototype.GetMetadataListInBo = 
    // 获取当前工程下所有的元数据
    /**
     * @param {?} typeName
     * @return {?}
     */
    function (typeName) {
        return this.gspMetadataService.GetMetadataListInBo(this.currentProjectPath, typeName);
    };
    /**
     * @param {?} typeCode
     * @param {?} postfix
     * @param {?} filter
     * @return {?}
     */
    MetadataService.prototype.GetMetadataByFilter = /**
     * @param {?} typeCode
     * @param {?} postfix
     * @param {?} filter
     * @return {?}
     */
    function (typeCode, postfix, filter) {
        return this.gspMetadataService.GetMetadataByFilter(this.currentProjectPath, typeCode, filter, postfix);
    };
    // 获取元数据工程信息（获取本工程依赖的元数据包基本信息）
    // 获取元数据工程信息（获取本工程依赖的元数据包基本信息）
    /**
     * @return {?}
     */
    MetadataService.prototype.GetMetadataProjectInfo = 
    // 获取元数据工程信息（获取本工程依赖的元数据包基本信息）
    /**
     * @return {?}
     */
    function () {
        return this.gspMetadataService.GetProjectInfo(this.currentProjectPath);
    };
    // 获取工程路径
    // 获取工程路径
    /**
     * @param {?} metadataPath
     * @return {?}
     */
    MetadataService.prototype.GetMetadataProjPath = 
    // 获取工程路径
    /**
     * @param {?} metadataPath
     * @return {?}
     */
    function (metadataPath) {
        return this.gspMetadataService.GetProjectInfo(metadataPath);
    };
    // tslint:disable-next-line:max-line-length
    // tslint:disable-next-line:max-line-length
    /**
     * @param {?} scope
     * @param {?} codelanguage
     * @param {?} isMavenEnable
     * @param {?=} metadataType
     * @param {?=} searchText
     * @param {?=} page
     * @param {?=} selectedPackageSource
     * @return {?}
     */
    MetadataService.prototype.GetMetadataInfos = 
    // tslint:disable-next-line:max-line-length
    /**
     * @param {?} scope
     * @param {?} codelanguage
     * @param {?} isMavenEnable
     * @param {?=} metadataType
     * @param {?=} searchText
     * @param {?=} page
     * @param {?=} selectedPackageSource
     * @return {?}
     */
    function (scope, codelanguage, isMavenEnable, metadataType, searchText, page, selectedPackageSource) {
        if (metadataType === void 0) { metadataType = null; }
        if (searchText === void 0) { searchText = null; }
        if (page === void 0) { page = null; }
        if (selectedPackageSource === void 0) { selectedPackageSource = null; }
        if (codelanguage === 'dotnet' || isMavenEnable === false) {
            return this.gspMetadataService.GetMetadataInfosByScope(scope, metadataType, searchText, page, selectedPackageSource, this.currentProjectPath);
        }
        else {
            return this.gspMetadataService.GetMetadataInfosByScope4Java(scope, metadataType, searchText, page, selectedPackageSource, this.currentProjectPath);
        }
    };
    // 获取元数据包中所包含的元数据信息
    // 获取元数据包中所包含的元数据信息
    /**
     * @param {?} packPath
     * @param {?} packageName
     * @return {?}
     */
    MetadataService.prototype.GetMetadataPackageInfo = 
    // 获取元数据包中所包含的元数据信息
    /**
     * @param {?} packPath
     * @param {?} packageName
     * @return {?}
     */
    function (packPath, packageName) {
        /** @type {?} */
        var fullName = '';
        if (packageName.endsWith('mdpkg')) {
            fullName = packageName;
        }
        else {
            fullName = packageName + '.mdpkg';
        }
        return this.gspMetadataService.GetMetadataPackageInfo(packPath, fullName);
    };
    /**
     * @param {?} scope
     * @param {?} metadataIndexDto
     * @param {?} codelanguage
     * @param {?} isMavenEnable
     * @return {?}
     */
    MetadataService.prototype.pickMetadataIndex = /**
     * @param {?} scope
     * @param {?} metadataIndexDto
     * @param {?} codelanguage
     * @param {?} isMavenEnable
     * @return {?}
     */
    function (scope, metadataIndexDto, codelanguage, isMavenEnable) {
        // if (codelanguage === 'dotnet' || isMavenEnable === false) {
        //   scope = scope === 3 ? 2 : scope;
        //   return this.gspMetadataService.pickMetadataIndex(scope, this.currentProjectPath, metadataIndexDto);
        // } else {
        return this.gspMetadataService.pickMetadataIndex(scope, this.currentProjectPath, metadataIndexDto);
        // }
    };
    // Load元数据
    // Load元数据
    /**
     * @param {?} metadata
     * @return {?}
     */
    MetadataService.prototype.LoadTheMetadata = 
    // Load元数据
    /**
     * @param {?} metadata
     * @return {?}
     */
    function (metadata) {
        if (metadata) {
            /** @type {?} */
            var fileName = metadata.fileName;
            /** @type {?} */
            var relativePath = metadata.relativePath;
            return this.gspMetadataService.LoadMetadataInBo(fileName, relativePath, this.currentProjectPath);
        }
        return new Observable();
    };
    // Load元数据
    // Load元数据
    /**
     * @return {?}
     */
    MetadataService.prototype.LoadMetadata = 
    // Load元数据
    /**
     * @return {?}
     */
    function () {
        if (this.metadatas.length > 0) {
            /** @type {?} */
            var index1 = this.metadatas.length;
            if (index1 > 0) {
                /** @type {?} */
                var index2 = this.metadatas[index1 - 1].treenode.MetadataInfo.length;
                if (index2 > 0) {
                    /** @type {?} */
                    var fileName = this.metadatas[index1 - 1].treenode.MetadataInfo[index2 - 1].FileName;
                    /** @type {?} */
                    var relativePath = this.metadatas[index1 - 1].treenode.MetadataInfo[index2 - 1].RelativePath;
                    return this.gspMetadataService.LoadMetadata(fileName, relativePath);
                }
            }
            else {
                return new Observable();
            }
        }
    };
    // // 获取元数据以及包的信息
    // GetTheMetadataFromPackage(metadata): Observable<any> {
    //   if (metadata) {
    //     const packageName = metadata.mdPkgName;
    //     const metadataID = metadata.id;
    //     return this.gspMetadataService.GetMetadataFromPackage(packageName, null, metadataID);
    //   }
    //   return new Observable<any>();
    // }
    // // 获取元数据以及包的信息
    // GetMetadataFromPackage(): Observable<any> {
    //   const index1 = this.metadatas.length;
    //   if (index1 > 0) {
    //     const index2 = this.metadatas[index1 - 1].treenode.MetadataInfo.length;
    //     if (index2 > 0) {
    //       const packageName = this.metadatas[index1 - 1].treenode.PackageName;
    //       const packagePath = this.metadatas[index1 - 1].treenode.Location;
    //       const metadataID = this.metadatas[index1 - 1].treenode.MetadataInfo[index2 - 1].ID;
    //       return this.gspMetadataService.GetMetadataFromPackage(packageName, packagePath, metadataID);
    //     }
    //   } else {
    //     return new Observable<any>();
    //   }
    // }
    // 获取某个路径下的所有元数据包
    // // 获取元数据以及包的信息
    // GetTheMetadataFromPackage(metadata): Observable<any> {
    //   if (metadata) {
    //     const packageName = metadata.mdPkgName;
    //     const metadataID = metadata.id;
    //     return this.gspMetadataService.GetMetadataFromPackage(packageName, null, metadataID);
    //   }
    //   return new Observable<any>();
    // }
    // // 获取元数据以及包的信息
    // GetMetadataFromPackage(): Observable<any> {
    //   const index1 = this.metadatas.length;
    //   if (index1 > 0) {
    //     const index2 = this.metadatas[index1 - 1].treenode.MetadataInfo.length;
    //     if (index2 > 0) {
    //       const packageName = this.metadatas[index1 - 1].treenode.PackageName;
    //       const packagePath = this.metadatas[index1 - 1].treenode.Location;
    //       const metadataID = this.metadatas[index1 - 1].treenode.MetadataInfo[index2 - 1].ID;
    //       return this.gspMetadataService.GetMetadataFromPackage(packageName, packagePath, metadataID);
    //     }
    //   } else {
    //     return new Observable<any>();
    //   }
    // }
    // 获取某个路径下的所有元数据包
    /**
     * @return {?}
     */
    MetadataService.prototype.GetMetadataPackages = 
    // // 获取元数据以及包的信息
    // GetTheMetadataFromPackage(metadata): Observable<any> {
    //   if (metadata) {
    //     const packageName = metadata.mdPkgName;
    //     const metadataID = metadata.id;
    //     return this.gspMetadataService.GetMetadataFromPackage(packageName, null, metadataID);
    //   }
    //   return new Observable<any>();
    // }
    // // 获取元数据以及包的信息
    // GetMetadataFromPackage(): Observable<any> {
    //   const index1 = this.metadatas.length;
    //   if (index1 > 0) {
    //     const index2 = this.metadatas[index1 - 1].treenode.MetadataInfo.length;
    //     if (index2 > 0) {
    //       const packageName = this.metadatas[index1 - 1].treenode.PackageName;
    //       const packagePath = this.metadatas[index1 - 1].treenode.Location;
    //       const metadataID = this.metadatas[index1 - 1].treenode.MetadataInfo[index2 - 1].ID;
    //       return this.gspMetadataService.GetMetadataFromPackage(packageName, packagePath, metadataID);
    //     }
    //   } else {
    //     return new Observable<any>();
    //   }
    // }
    // 获取某个路径下的所有元数据包
    /**
     * @return {?}
     */
    function () {
        return this.gspMetadataService.GetMetadataPackages('packages');
    };
    // 更新工程引用
    // 更新工程引用
    /**
     * @param {?} packageHeader
     * @return {?}
     */
    MetadataService.prototype.UpdateMetadataProject = 
    // 更新工程引用
    /**
     * @param {?} packageHeader
     * @return {?}
     */
    function (packageHeader) {
        // this.gspMetadataService.UpdateMetadataProject(this.currentProjectPath, packageHeader).then(response => {
        //   if (response.status === 200) {
        //     this.treeData = [];
        //     this.Refresh();
        //   }
        // });
        return this.gspMetadataService.UpdateMetadataProject(this.currentProjectPath, packageHeader);
    };
    /**
     * @return {?}
     */
    MetadataService.prototype.getCodeLanguage = /**
     * @return {?}
     */
    function () {
        return this.gspMetadataService.getCodeLanguage(this.currentProjectPath);
    };
    /**
     * @return {?}
     */
    MetadataService.prototype.getProcessMode = /**
     * @return {?}
     */
    function () {
        return this.gspMetadataService.getProcessMode(this.currentProjectPath);
    };
    /**
     * @return {?}
     */
    MetadataService.prototype.Refresh = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.treeData = this.getMetadataClassifier('');
        this.treeData[1].items = [];
        /** @type {?} */
        var packages = [];
        this.GetMetadataProjPath(this.currentProjectPath).subscribe((/**
         * @param {?} proj
         * @return {?}
         */
        function (proj) {
            _this.currentProjectPath = proj.projectPath;
            _this.GetMetadataProjectInfo().subscribe((/**
             * @param {?} meta
             * @return {?}
             */
            function (meta) {
                packages = meta.nugetPackageRefs;
                /** @type {?} */
                var index = 0;
                packages.forEach((/**
                 * @param {?} item
                 * @return {?}
                 */
                function (item) {
                    /** @type {?} */
                    var child = {
                        id: item.name,
                        text: item.name,
                        items: []
                    };
                    if (_this.treeData) {
                        _this.treeData[1].items.push(child);
                    }
                    _this.gspMetadataService.GetDevRootPath().subscribe((/**
                     * @param {?} root
                     * @return {?}
                     */
                    function (root) {
                        /** @type {?} */
                        var rootPath = root + _this.packRefPath;
                        _this.gspMetadataService.GetMetadataPackagesUnderNugetDir(rootPath + '/' + item.name).subscribe((/**
                         * @param {?} pkgs
                         * @return {?}
                         */
                        function (pkgs) {
                            if (pkgs) {
                                /** @type {?} */
                                var mdpkg_1;
                                pkgs.forEach((/**
                                 * @param {?} pkg
                                 * @return {?}
                                 */
                                function (pkg) {
                                    mdpkg_1 = {
                                        id: pkg.header.name,
                                        text: pkg.header.name,
                                        desc: pkg.header.location
                                    };
                                    child.items.push(mdpkg_1);
                                }));
                                // this.files[1].items[index].push(mdpkg);
                            }
                            index = index + 1;
                        }));
                    }));
                }));
            }));
        }));
    };
    /**
     * @return {?}
     */
    MetadataService.prototype.getBoPath = /**
     * @return {?}
     */
    function () {
        return this.gspMetadataService.getBoPath(this.currentProjectPath);
    };
    MetadataService.decorators = [
        { type: Injectable }
    ];
    /** @nocollapse */
    MetadataService.ctorParameters = function () { return [
        { type: GSPMetadataService }
    ]; };
    return MetadataService;
}());
export { MetadataService };
if (false) {
    /** @type {?} */
    MetadataService.prototype.currentProjectPath;
    /** @type {?} */
    MetadataService.prototype.rootPath;
    /** @type {?} */
    MetadataService.prototype.packRefPath;
    /** @type {?} */
    MetadataService.prototype.selectedChange;
    /** @type {?} */
    MetadataService.prototype.treeData;
    /** @type {?} */
    MetadataService.prototype.metadatas;
    /** @type {?} */
    MetadataService.prototype.packages;
    /**
     * @type {?}
     * @private
     */
    MetadataService.prototype.gspMetadataService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWV0YWRhdGEuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0Bnc3AtbGNtL21ldGFkYXRhLXNlbGVjdG9yLyIsInNvdXJjZXMiOlsibWV0YWRhdGEvbWV0YWRhdGEtc2VsZWN0L21ldGFkYXRhLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLFlBQVksRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUN6RCxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFDN0MsT0FBTyxFQUFFLGtCQUFrQixFQUFFLE1BQU0scUJBQXFCLENBQUM7OztJQUduRCxVQUFVLEdBQVU7SUFDeEIsRUFBRSxFQUFFLEVBQUUsU0FBUyxFQUFFLElBQUksRUFBRSxRQUFRLEVBQUU7SUFDakMsRUFBRSxFQUFFLEVBQUUsT0FBTyxFQUFFLElBQUksRUFBRSxRQUFRLEVBQUU7SUFDL0IsRUFBRSxFQUFFLEVBQUUsUUFBUSxFQUFFLElBQUksRUFBRSxRQUFRLEVBQUU7SUFDaEMsRUFBRSxFQUFFLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxRQUFRLEVBQUUsQ0FBTyxJQUFJO0NBQ3pDOztJQUVLLGVBQWUsR0FBVTtJQUM3QixFQUFFLEVBQUUsRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLFFBQVEsRUFBRTtJQUM1QixFQUFFLEVBQUUsRUFBRSxPQUFPLEVBQUUsSUFBSSxFQUFFLFFBQVEsRUFBRTtJQUMvQixFQUFFLEVBQUUsRUFBRSxRQUFRLEVBQUUsSUFBSSxFQUFFLFFBQVEsRUFBRTtJQUNoQyxFQUFFLEVBQUUsRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFLFFBQVEsRUFBRSxDQUFPLElBQUk7Q0FDekM7QUFFRDtJQU1FLHlCQUFvQixrQkFBc0M7UUFBdEMsdUJBQWtCLEdBQWxCLGtCQUFrQixDQUFvQjtRQUQxRCxtQkFBYyxHQUFHLElBQUksWUFBWSxFQUFVLENBQUM7O1FBZ0I1QyxjQUFTLEdBQUcs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QyxDQUFDO29CQUNMLENBQUMsRUFBQyxDQUFDO2dCQUNMLENBQUMsRUFBQyxDQUFDO1lBQ0wsQ0FBQyxFQUFDLENBQUM7UUFDTCxDQUFDLEVBQUMsQ0FBQztJQUNMLENBQUM7Ozs7SUFFTSxtQ0FBUzs7O0lBQWhCO1FBQ0UsT0FBTyxJQUFJLENBQUMsa0JBQWtCLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDO0lBQ3BFLENBQUM7O2dCQW5ORixVQUFVOzs7O2dCQWpCRixrQkFBa0I7O0lBcU8zQixzQkFBQztDQUFBLEFBcE5ELElBb05DO1NBbk5ZLGVBQWU7OztJQUMxQiw2Q0FBMkI7O0lBQzNCLG1DQUFpQjs7SUFDakIsc0NBQW9COztJQUNwQix5Q0FBNEM7O0lBSzVDLG1DQUFnQjs7SUFXaEIsb0NBQWU7O0lBUWYsbUNBQWM7Ozs7O0lBdkJGLDZDQUE4QyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUsIEV2ZW50RW1pdHRlciB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBPYnNlcnZhYmxlIH0gZnJvbSAncnhqcy9PYnNlcnZhYmxlJztcclxuaW1wb3J0IHsgR1NQTWV0YWRhdGFTZXJ2aWNlIH0gZnJvbSAnLi4vbWV0YWRhdGEuc2VydmljZSc7XHJcblxyXG4vLyBtb2Nr5pWw5o2uXHJcbmNvbnN0IGNsYXNzaWZpZXI6IGFueVtdID0gW1xyXG4gIHsgaWQ6ICdwcm9qZWN0JywgdGV4dDogJ+W3peeoi+WGheWFg+aVsOaNricgfSwgIC8vIDBcclxuICB7IGlkOiAnbG9jYWwnLCB0ZXh0OiAn56a757q/55qE5YWD5pWw5o2uJyB9LCAgICAvLyAxXHJcbiAgeyBpZDogJ3JlbW90ZScsIHRleHQ6ICfku5PlupPkuK3lhYPmlbDmja4nIH0sICAgLy8gMlxyXG4gIHsgaWQ6ICdyZWYnLCB0ZXh0OiAn5byV55So55qE5YWD5pWw5o2uJyB9ICAgICAgIC8vIDNcclxuXTtcclxuXHJcbmNvbnN0IGNsYXNzaWZpZXJGb3JCbzogYW55W10gPSBbXHJcbiAgeyBpZDogJ2JvJywgdGV4dDogJ0JP5YaF5YWD5pWw5o2uJyB9LCAgLy8gMFxyXG4gIHsgaWQ6ICdsb2NhbCcsIHRleHQ6ICfnprvnur/nmoTlhYPmlbDmja4nIH0sICAgIC8vIDFcclxuICB7IGlkOiAncmVtb3RlJywgdGV4dDogJ+S7k+W6k+S4reWFg+aVsOaNricgfSwgICAvLyAyXHJcbiAgeyBpZDogJ3JlZicsIHRleHQ6ICflvJXnlKjnmoTlhYPmlbDmja4nIH0gICAgICAgLy8gM1xyXG5dO1xyXG5cclxuQEluamVjdGFibGUoKVxyXG5leHBvcnQgY2xhc3MgTWV0YWRhdGFTZXJ2aWNlIHtcclxuICBjdXJyZW50UHJvamVjdFBhdGg6IHN0cmluZztcclxuICByb290UGF0aDogc3RyaW5nO1xyXG4gIHBhY2tSZWZQYXRoOiBzdHJpbmc7XHJcbiAgc2VsZWN0ZWRDaGFuZ2UgPSBuZXcgRXZlbnRFbWl0dGVyPHN0cmluZz4oKTtcclxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIGdzcE1ldGFkYXRhU2VydmljZTogR1NQTWV0YWRhdGFTZXJ2aWNlKSB7XHJcbiAgICB0aGlzLnBhY2tSZWZQYXRoID0gJy9wYWNrYWdlcyc7XHJcbiAgfVxyXG4gIC8vIG1vY2vmoJHoioLngrnmlbDmja5cclxuICB0cmVlRGF0YTogYW55W107XHJcbiAgZ2V0TWV0YWRhdGFDbGFzc2lmaWVyKHR5cGUpIHtcclxuICAgIHN3aXRjaCAodHlwZSkge1xyXG4gICAgICBjYXNlICdibyc6XHJcbiAgICAgICAgcmV0dXJuIGNsYXNzaWZpZXJGb3JCbztcclxuICAgICAgY2FzZSAncHJvamVjdCc6XHJcbiAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgcmV0dXJuIGNsYXNzaWZpZXI7XHJcbiAgICB9XHJcbiAgfVxyXG4gIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTptZW1iZXItb3JkZXJpbmdcclxuICBtZXRhZGF0YXMgPSBbXTtcclxuICBhZGRNZXRhZGF0YShtZXRhZGF0YSkge1xyXG4gICAgdGhpcy5tZXRhZGF0YXMucHVzaChtZXRhZGF0YSk7XHJcbiAgfVxyXG4gIGNsZWFyTWV0YWRhdGEoKSB7XHJcbiAgICB0aGlzLm1ldGFkYXRhcyA9IFtdO1xyXG4gIH1cclxuICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bWVtYmVyLW9yZGVyaW5nXHJcbiAgcGFja2FnZXMgPSBbXTtcclxuICBhZGRQYWNrYWdlKG1wKSB7XHJcbiAgICB0aGlzLnBhY2thZ2VzLnB1c2gobXApO1xyXG4gIH1cclxuICBjbGVhclBhY2thZ2UoKSB7XHJcbiAgICB0aGlzLnBhY2thZ2VzID0gW107XHJcbiAgfVxyXG5cclxuICAvLyDojrflj5blvZPliY3lt6XnqIvkuIvmiYDmnInnmoTlhYPmlbDmja5cclxuICBHZXRNZXRhZGF0YUxpc3QodHlwZU5hbWU6IHN0cmluZyk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICByZXR1cm4gdGhpcy5nc3BNZXRhZGF0YVNlcnZpY2UuR2V0TWV0YWRhdGFMaXN0KHRoaXMuY3VycmVudFByb2plY3RQYXRoLCB0eXBlTmFtZSk7XHJcbiAgfVxyXG5cclxuICAvLyDojrflj5blvZPliY3lt6XnqIvkuIvmiYDmnInnmoTlhYPmlbDmja5cclxuICBHZXRNZXRhZGF0YUxpc3RJbkJvKHR5cGVOYW1lOiBzdHJpbmcpOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgcmV0dXJuIHRoaXMuZ3NwTWV0YWRhdGFTZXJ2aWNlLkdldE1ldGFkYXRhTGlzdEluQm8odGhpcy5jdXJyZW50UHJvamVjdFBhdGgsIHR5cGVOYW1lKTtcclxuICB9XHJcblxyXG4gIEdldE1ldGFkYXRhQnlGaWx0ZXIodHlwZUNvZGU6IHN0cmluZywgcG9zdGZpeDogc3RyaW5nLCBmaWx0ZXI6IHN0cmluZyk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICByZXR1cm4gdGhpcy5nc3BNZXRhZGF0YVNlcnZpY2UuR2V0TWV0YWRhdGFCeUZpbHRlcih0aGlzLmN1cnJlbnRQcm9qZWN0UGF0aCwgdHlwZUNvZGUsIGZpbHRlciwgcG9zdGZpeCk7XHJcbiAgfVxyXG5cclxuICAvLyDojrflj5blhYPmlbDmja7lt6XnqIvkv6Hmga/vvIjojrflj5bmnKzlt6XnqIvkvp3otZbnmoTlhYPmlbDmja7ljIXln7rmnKzkv6Hmga/vvIlcclxuICBHZXRNZXRhZGF0YVByb2plY3RJbmZvKCk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICByZXR1cm4gdGhpcy5nc3BNZXRhZGF0YVNlcnZpY2UuR2V0UHJvamVjdEluZm8odGhpcy5jdXJyZW50UHJvamVjdFBhdGgpO1xyXG4gIH1cclxuXHJcbiAgLy8g6I635Y+W5bel56iL6Lev5b6EXHJcbiAgR2V0TWV0YWRhdGFQcm9qUGF0aChtZXRhZGF0YVBhdGg6IHN0cmluZyk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICByZXR1cm4gdGhpcy5nc3BNZXRhZGF0YVNlcnZpY2UuR2V0UHJvamVjdEluZm8obWV0YWRhdGFQYXRoKTtcclxuICB9XHJcblxyXG4gIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTptYXgtbGluZS1sZW5ndGhcclxuICBHZXRNZXRhZGF0YUluZm9zKHNjb3BlLCBjb2RlbGFuZ3VhZ2U6IHN0cmluZywgaXNNYXZlbkVuYWJsZTogYm9vbGVhbiwgbWV0YWRhdGFUeXBlID0gbnVsbCwgc2VhcmNoVGV4dCA9IG51bGwsIHBhZ2UgPSBudWxsLCBzZWxlY3RlZFBhY2thZ2VTb3VyY2UgPSBudWxsKSB7XHJcbiAgICBpZiAoY29kZWxhbmd1YWdlID09PSAnZG90bmV0JyB8fCBpc01hdmVuRW5hYmxlID09PSBmYWxzZSkge1xyXG4gICAgICByZXR1cm4gdGhpcy5nc3BNZXRhZGF0YVNlcnZpY2UuR2V0TWV0YWRhdGFJbmZvc0J5U2NvcGUoc2NvcGUsIG1ldGFkYXRhVHlwZSwgc2VhcmNoVGV4dCwgcGFnZSxcclxuICAgICAgICBzZWxlY3RlZFBhY2thZ2VTb3VyY2UsIHRoaXMuY3VycmVudFByb2plY3RQYXRoKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHJldHVybiB0aGlzLmdzcE1ldGFkYXRhU2VydmljZS5HZXRNZXRhZGF0YUluZm9zQnlTY29wZTRKYXZhKHNjb3BlLCBtZXRhZGF0YVR5cGUsIHNlYXJjaFRleHQsIHBhZ2UsXHJcbiAgICAgICAgc2VsZWN0ZWRQYWNrYWdlU291cmNlLCB0aGlzLmN1cnJlbnRQcm9qZWN0UGF0aCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvLyDojrflj5blhYPmlbDmja7ljIXkuK3miYDljIXlkKvnmoTlhYPmlbDmja7kv6Hmga9cclxuICBHZXRNZXRhZGF0YVBhY2thZ2VJbmZvKHBhY2tQYXRoOiBzdHJpbmcsIHBhY2thZ2VOYW1lOiBzdHJpbmcpOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgbGV0IGZ1bGxOYW1lID0gJyc7XHJcbiAgICBpZiAocGFja2FnZU5hbWUuZW5kc1dpdGgoJ21kcGtnJykpIHtcclxuICAgICAgZnVsbE5hbWUgPSBwYWNrYWdlTmFtZTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGZ1bGxOYW1lID0gcGFja2FnZU5hbWUgKyAnLm1kcGtnJztcclxuICAgIH1cclxuICAgIHJldHVybiB0aGlzLmdzcE1ldGFkYXRhU2VydmljZS5HZXRNZXRhZGF0YVBhY2thZ2VJbmZvKHBhY2tQYXRoLCBmdWxsTmFtZSk7XHJcbiAgfVxyXG4gIHBpY2tNZXRhZGF0YUluZGV4KHNjb3BlOiBudW1iZXIsIG1ldGFkYXRhSW5kZXhEdG86IGFueSwgY29kZWxhbmd1YWdlOiBzdHJpbmcsIGlzTWF2ZW5FbmFibGU6IGJvb2xlYW4pOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgLy8gaWYgKGNvZGVsYW5ndWFnZSA9PT0gJ2RvdG5ldCcgfHwgaXNNYXZlbkVuYWJsZSA9PT0gZmFsc2UpIHtcclxuICAgIC8vICAgc2NvcGUgPSBzY29wZSA9PT0gMyA/IDIgOiBzY29wZTtcclxuICAgIC8vICAgcmV0dXJuIHRoaXMuZ3NwTWV0YWRhdGFTZXJ2aWNlLnBpY2tNZXRhZGF0YUluZGV4KHNjb3BlLCB0aGlzLmN1cnJlbnRQcm9qZWN0UGF0aCwgbWV0YWRhdGFJbmRleER0byk7XHJcbiAgICAvLyB9IGVsc2Uge1xyXG4gICAgICByZXR1cm4gdGhpcy5nc3BNZXRhZGF0YVNlcnZpY2UucGlja01ldGFkYXRhSW5kZXgoc2NvcGUsIHRoaXMuY3VycmVudFByb2plY3RQYXRoLCBtZXRhZGF0YUluZGV4RHRvKTtcclxuICAgIC8vIH1cclxuICB9XHJcbiAgLy8gTG9hZOWFg+aVsOaNrlxyXG4gIExvYWRUaGVNZXRhZGF0YShtZXRhZGF0YTogYW55KTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgIGlmIChtZXRhZGF0YSkge1xyXG4gICAgICBjb25zdCBmaWxlTmFtZSA9IG1ldGFkYXRhLmZpbGVOYW1lO1xyXG4gICAgICBjb25zdCByZWxhdGl2ZVBhdGggPSBtZXRhZGF0YS5yZWxhdGl2ZVBhdGg7XHJcbiAgICAgIHJldHVybiB0aGlzLmdzcE1ldGFkYXRhU2VydmljZS5Mb2FkTWV0YWRhdGFJbkJvKGZpbGVOYW1lLCByZWxhdGl2ZVBhdGgsIHRoaXMuY3VycmVudFByb2plY3RQYXRoKTtcclxuICAgIH1cclxuICAgIHJldHVybiBuZXcgT2JzZXJ2YWJsZTxhbnk+KCk7XHJcbiAgfVxyXG5cclxuICAvLyBMb2Fk5YWD5pWw5o2uXHJcbiAgTG9hZE1ldGFkYXRhKCk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICBpZiAodGhpcy5tZXRhZGF0YXMubGVuZ3RoID4gMCkge1xyXG4gICAgICBjb25zdCBpbmRleDEgPSB0aGlzLm1ldGFkYXRhcy5sZW5ndGg7XHJcbiAgICAgIGlmIChpbmRleDEgPiAwKSB7XHJcbiAgICAgICAgY29uc3QgaW5kZXgyID0gdGhpcy5tZXRhZGF0YXNbaW5kZXgxIC0gMV0udHJlZW5vZGUuTWV0YWRhdGFJbmZvLmxlbmd0aDtcclxuICAgICAgICBpZiAoaW5kZXgyID4gMCkge1xyXG4gICAgICAgICAgY29uc3QgZmlsZU5hbWUgPSB0aGlzLm1ldGFkYXRhc1tpbmRleDEgLSAxXS50cmVlbm9kZS5NZXRhZGF0YUluZm9baW5kZXgyIC0gMV0uRmlsZU5hbWU7XHJcbiAgICAgICAgICBjb25zdCByZWxhdGl2ZVBhdGggPSB0aGlzLm1ldGFkYXRhc1tpbmRleDEgLSAxXS50cmVlbm9kZS5NZXRhZGF0YUluZm9baW5kZXgyIC0gMV0uUmVsYXRpdmVQYXRoO1xyXG4gICAgICAgICAgcmV0dXJuIHRoaXMuZ3NwTWV0YWRhdGFTZXJ2aWNlLkxvYWRNZXRhZGF0YShmaWxlTmFtZSwgcmVsYXRpdmVQYXRoKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBPYnNlcnZhYmxlPGFueT4oKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLy8gLy8g6I635Y+W5YWD5pWw5o2u5Lul5Y+K5YyF55qE5L+h5oGvXHJcbiAgLy8gR2V0VGhlTWV0YWRhdGFGcm9tUGFja2FnZShtZXRhZGF0YSk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgLy8gICBpZiAobWV0YWRhdGEpIHtcclxuICAvLyAgICAgY29uc3QgcGFja2FnZU5hbWUgPSBtZXRhZGF0YS5tZFBrZ05hbWU7XHJcbiAgLy8gICAgIGNvbnN0IG1ldGFkYXRhSUQgPSBtZXRhZGF0YS5pZDtcclxuICAvLyAgICAgcmV0dXJuIHRoaXMuZ3NwTWV0YWRhdGFTZXJ2aWNlLkdldE1ldGFkYXRhRnJvbVBhY2thZ2UocGFja2FnZU5hbWUsIG51bGwsIG1ldGFkYXRhSUQpO1xyXG4gIC8vICAgfVxyXG4gIC8vICAgcmV0dXJuIG5ldyBPYnNlcnZhYmxlPGFueT4oKTtcclxuICAvLyB9XHJcblxyXG4gIC8vIC8vIOiOt+WPluWFg+aVsOaNruS7peWPiuWMheeahOS/oeaBr1xyXG4gIC8vIEdldE1ldGFkYXRhRnJvbVBhY2thZ2UoKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAvLyAgIGNvbnN0IGluZGV4MSA9IHRoaXMubWV0YWRhdGFzLmxlbmd0aDtcclxuICAvLyAgIGlmIChpbmRleDEgPiAwKSB7XHJcbiAgLy8gICAgIGNvbnN0IGluZGV4MiA9IHRoaXMubWV0YWRhdGFzW2luZGV4MSAtIDFdLnRyZWVub2RlLk1ldGFkYXRhSW5mby5sZW5ndGg7XHJcbiAgLy8gICAgIGlmIChpbmRleDIgPiAwKSB7XHJcbiAgLy8gICAgICAgY29uc3QgcGFja2FnZU5hbWUgPSB0aGlzLm1ldGFkYXRhc1tpbmRleDEgLSAxXS50cmVlbm9kZS5QYWNrYWdlTmFtZTtcclxuICAvLyAgICAgICBjb25zdCBwYWNrYWdlUGF0aCA9IHRoaXMubWV0YWRhdGFzW2luZGV4MSAtIDFdLnRyZWVub2RlLkxvY2F0aW9uO1xyXG4gIC8vICAgICAgIGNvbnN0IG1ldGFkYXRhSUQgPSB0aGlzLm1ldGFkYXRhc1tpbmRleDEgLSAxXS50cmVlbm9kZS5NZXRhZGF0YUluZm9baW5kZXgyIC0gMV0uSUQ7XHJcbiAgLy8gICAgICAgcmV0dXJuIHRoaXMuZ3NwTWV0YWRhdGFTZXJ2aWNlLkdldE1ldGFkYXRhRnJvbVBhY2thZ2UocGFja2FnZU5hbWUsIHBhY2thZ2VQYXRoLCBtZXRhZGF0YUlEKTtcclxuICAvLyAgICAgfVxyXG4gIC8vICAgfSBlbHNlIHtcclxuICAvLyAgICAgcmV0dXJuIG5ldyBPYnNlcnZhYmxlPGFueT4oKTtcclxuICAvLyAgIH1cclxuICAvLyB9XHJcblxyXG4gIC8vIOiOt+WPluafkOS4qui3r+W+hOS4i+eahOaJgOacieWFg+aVsOaNruWMhVxyXG4gIEdldE1ldGFkYXRhUGFja2FnZXMoKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgIHJldHVybiB0aGlzLmdzcE1ldGFkYXRhU2VydmljZS5HZXRNZXRhZGF0YVBhY2thZ2VzKCdwYWNrYWdlcycpO1xyXG4gIH1cclxuXHJcbiAgLy8g5pu05paw5bel56iL5byV55SoXHJcbiAgVXBkYXRlTWV0YWRhdGFQcm9qZWN0KHBhY2thZ2VIZWFkZXI6IGFueSk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICAvLyB0aGlzLmdzcE1ldGFkYXRhU2VydmljZS5VcGRhdGVNZXRhZGF0YVByb2plY3QodGhpcy5jdXJyZW50UHJvamVjdFBhdGgsIHBhY2thZ2VIZWFkZXIpLnRoZW4ocmVzcG9uc2UgPT4ge1xyXG4gICAgLy8gICBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSAyMDApIHtcclxuICAgIC8vICAgICB0aGlzLnRyZWVEYXRhID0gW107XHJcbiAgICAvLyAgICAgdGhpcy5SZWZyZXNoKCk7XHJcbiAgICAvLyAgIH1cclxuICAgIC8vIH0pO1xyXG4gICAgcmV0dXJuIHRoaXMuZ3NwTWV0YWRhdGFTZXJ2aWNlLlVwZGF0ZU1ldGFkYXRhUHJvamVjdCh0aGlzLmN1cnJlbnRQcm9qZWN0UGF0aCwgcGFja2FnZUhlYWRlcik7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgZ2V0Q29kZUxhbmd1YWdlKCk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICByZXR1cm4gdGhpcy5nc3BNZXRhZGF0YVNlcnZpY2UuZ2V0Q29kZUxhbmd1YWdlKHRoaXMuY3VycmVudFByb2plY3RQYXRoKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBnZXRQcm9jZXNzTW9kZSgpOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgcmV0dXJuIHRoaXMuZ3NwTWV0YWRhdGFTZXJ2aWNlLmdldFByb2Nlc3NNb2RlKHRoaXMuY3VycmVudFByb2plY3RQYXRoKTtcclxuICB9XHJcblxyXG4gIFJlZnJlc2goKSB7XHJcbiAgICB0aGlzLnRyZWVEYXRhID0gdGhpcy5nZXRNZXRhZGF0YUNsYXNzaWZpZXIoJycpO1xyXG4gICAgdGhpcy50cmVlRGF0YVsxXS5pdGVtcyA9IFtdO1xyXG4gICAgbGV0IHBhY2thZ2VzID0gW107XHJcblxyXG4gICAgdGhpcy5HZXRNZXRhZGF0YVByb2pQYXRoKHRoaXMuY3VycmVudFByb2plY3RQYXRoKS5zdWJzY3JpYmUocHJvaiA9PiB7XHJcbiAgICAgIHRoaXMuY3VycmVudFByb2plY3RQYXRoID0gcHJvai5wcm9qZWN0UGF0aDtcclxuICAgICAgdGhpcy5HZXRNZXRhZGF0YVByb2plY3RJbmZvKCkuc3Vic2NyaWJlKG1ldGEgPT4ge1xyXG4gICAgICAgIHBhY2thZ2VzID0gbWV0YS5udWdldFBhY2thZ2VSZWZzO1xyXG4gICAgICAgIGxldCBpbmRleCA9IDA7XHJcbiAgICAgICAgcGFja2FnZXMuZm9yRWFjaChpdGVtID0+IHtcclxuICAgICAgICAgIGNvbnN0IGNoaWxkID0ge1xyXG4gICAgICAgICAgICBpZDogaXRlbS5uYW1lLFxyXG4gICAgICAgICAgICB0ZXh0OiBpdGVtLm5hbWUsXHJcbiAgICAgICAgICAgIGl0ZW1zOiBbXVxyXG4gICAgICAgICAgfTtcclxuICAgICAgICAgIGlmICh0aGlzLnRyZWVEYXRhKSB7XHJcbiAgICAgICAgICAgIHRoaXMudHJlZURhdGFbMV0uaXRlbXMucHVzaChjaGlsZCk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICB0aGlzLmdzcE1ldGFkYXRhU2VydmljZS5HZXREZXZSb290UGF0aCgpLnN1YnNjcmliZShyb290ID0+IHtcclxuICAgICAgICAgICAgY29uc3Qgcm9vdFBhdGggPSByb290ICsgdGhpcy5wYWNrUmVmUGF0aDtcclxuICAgICAgICAgICAgdGhpcy5nc3BNZXRhZGF0YVNlcnZpY2UuR2V0TWV0YWRhdGFQYWNrYWdlc1VuZGVyTnVnZXREaXIocm9vdFBhdGggKyAnLycgKyBpdGVtLm5hbWUpLnN1YnNjcmliZShwa2dzID0+IHtcclxuICAgICAgICAgICAgICBpZiAocGtncykge1xyXG4gICAgICAgICAgICAgICAgbGV0IG1kcGtnO1xyXG4gICAgICAgICAgICAgICAgcGtncy5mb3JFYWNoKHBrZyA9PiB7XHJcbiAgICAgICAgICAgICAgICAgIG1kcGtnID0ge1xyXG4gICAgICAgICAgICAgICAgICAgIGlkOiBwa2cuaGVhZGVyLm5hbWUsXHJcbiAgICAgICAgICAgICAgICAgICAgdGV4dDogcGtnLmhlYWRlci5uYW1lLFxyXG4gICAgICAgICAgICAgICAgICAgIGRlc2M6IHBrZy5oZWFkZXIubG9jYXRpb25cclxuICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgICAgY2hpbGQuaXRlbXMucHVzaChtZHBrZyk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIC8vIHRoaXMuZmlsZXNbMV0uaXRlbXNbaW5kZXhdLnB1c2gobWRwa2cpO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICBpbmRleCA9IGluZGV4ICsgMTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICB9KTtcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBnZXRCb1BhdGgoKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgIHJldHVybiB0aGlzLmdzcE1ldGFkYXRhU2VydmljZS5nZXRCb1BhdGgodGhpcy5jdXJyZW50UHJvamVjdFBhdGgpO1xyXG4gIH1cclxufVxyXG4iXX0=
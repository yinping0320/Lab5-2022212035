/**
 * @fileoverview added by tsickle
 * Generated from: metadata/metadata-select/metadata.service.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Injectable, EventEmitter } from '@angular/core';
import { Observable } from 'rxjs/Observable';
import { GSPMetadataService } from '../metadata.service';
// mock数据
/** @type {?} */
const classifier = [
    { id: 'project', text: '工程内元数据' },
    { id: 'local', text: '离线的元数据' },
    { id: 'remote', text: '仓库中元数据' },
    { id: 'ref', text: '引用的元数据' } // 3
];
/** @type {?} */
const classifierForBo = [
    { id: 'bo', text: 'BO内元数据' },
    { id: 'local', text: '离线的元数据' },
    { id: 'remote', text: '仓库中元数据' },
    { id: 'ref', text: '引用的元数据' } // 3
];
export class MetadataService {
    /**
     * @param {?} gspMetadataService
     */
    constructor(gspMetadataService) {
        this.gspMetadataService = gspMetadataService;
        this.selectedChange = new EventEmitter();
        // tslint:disable-next-line:member-ordering
        this.metadatas = [];
        // tslint:disable-next-line:member-ordering
        this.packages = [];
        this.packRefPath = '/packages';
    }
    /**
     * @param {?} type
     * @return {?}
     */
    getMetadataClassifier(type) {
        switch (type) {
            case 'bo':
                return classifierForBo;
            case 'project':
            default:
                return classifier;
        }
    }
    /**
     * @param {?} metadata
     * @return {?}
     */
    addMetadata(metadata) {
        this.metadatas.push(metadata);
    }
    /**
     * @return {?}
     */
    clearMetadata() {
        this.metadatas = [];
    }
    /**
     * @param {?} mp
     * @return {?}
     */
    addPackage(mp) {
        this.packages.push(mp);
    }
    /**
     * @return {?}
     */
    clearPackage() {
        this.packages = [];
    }
    // 获取当前工程下所有的元数据
    /**
     * @param {?} typeName
     * @return {?}
     */
    GetMetadataList(typeName) {
        return this.gspMetadataService.GetMetadataList(this.currentProjectPath, typeName);
    }
    // 获取当前工程下所有的元数据
    /**
     * @param {?} typeName
     * @return {?}
     */
    GetMetadataListInBo(typeName) {
        return this.gspMetadataService.GetMetadataListInBo(this.currentProjectPath, typeName);
    }
    /**
     * @param {?} typeCode
     * @param {?} postfix
     * @param {?} filter
     * @return {?}
     */
    GetMetadataByFilter(typeCode, postfix, filter) {
        return this.gspMetadataService.GetMetadataByFilter(this.currentProjectPath, typeCode, filter, postfix);
    }
    // 获取元数据工程信息（获取本工程依赖的元数据包基本信息）
    /**
     * @return {?}
     */
    GetMetadataProjectInfo() {
        return this.gspMetadataService.GetProjectInfo(this.currentProjectPath);
    }
    // 获取工程路径
    /**
     * @param {?} metadataPath
     * @return {?}
     */
    GetMetadataProjPath(metadataPath) {
        return this.gspMetadataService.GetProjectInfo(metadataPath);
    }
    // tslint:disable-next-line:max-line-length
    /**
     * @param {?} scope
     * @param {?} codelanguage
     * @param {?} isMavenEnable
     * @param {?=} metadataType
     * @param {?=} searchText
     * @param {?=} page
     * @param {?=} selectedPackageSource
     * @return {?}
     */
    GetMetadataInfos(scope, codelanguage, isMavenEnable, metadataType = null, searchText = null, page = null, selectedPackageSource = null) {
        if (codelanguage === 'dotnet' || isMavenEnable === false) {
            return this.gspMetadataService.GetMetadataInfosByScope(scope, metadataType, searchText, page, selectedPackageSource, this.currentProjectPath);
        }
        else {
            return this.gspMetadataService.GetMetadataInfosByScope4Java(scope, metadataType, searchText, page, selectedPackageSource, this.currentProjectPath);
        }
    }
    // 获取元数据包中所包含的元数据信息
    /**
     * @param {?} packPath
     * @param {?} packageName
     * @return {?}
     */
    GetMetadataPackageInfo(packPath, packageName) {
        /** @type {?} */
        let fullName = '';
        if (packageName.endsWith('mdpkg')) {
            fullName = packageName;
        }
        else {
            fullName = packageName + '.mdpkg';
        }
        return this.gspMetadataService.GetMetadataPackageInfo(packPath, fullName);
    }
    /**
     * @param {?} scope
     * @param {?} metadataIndexDto
     * @param {?} codelanguage
     * @param {?} isMavenEnable
     * @return {?}
     */
    pickMetadataIndex(scope, metadataIndexDto, codelanguage, isMavenEnable) {
        // if (codelanguage === 'dotnet' || isMavenEnable === false) {
        //   scope = scope === 3 ? 2 : scope;
        //   return this.gspMetadataService.pickMetadataIndex(scope, this.currentProjectPath, metadataIndexDto);
        // } else {
        return this.gspMetadataService.pickMetadataIndex(scope, this.currentProjectPath, metadataIndexDto);
        // }
    }
    // Load元数据
    /**
     * @param {?} metadata
     * @return {?}
     */
    LoadTheMetadata(metadata) {
        if (metadata) {
            /** @type {?} */
            const fileName = metadata.fileName;
            /** @type {?} */
            const relativePath = metadata.relativePath;
            return this.gspMetadataService.LoadMetadataInBo(fileName, relativePath, this.currentProjectPath);
        }
        return new Observable();
    }
    // Load元数据
    /**
     * @return {?}
     */
    LoadMetadata() {
        if (this.metadatas.length > 0) {
            /** @type {?} */
            const index1 = this.metadatas.length;
            if (index1 > 0) {
                /** @type {?} */
                const index2 = this.metadatas[index1 - 1].treenode.MetadataInfo.length;
                if (index2 > 0) {
                    /** @type {?} */
                    const fileName = this.metadatas[index1 - 1].treenode.MetadataInfo[index2 - 1].FileName;
                    /** @type {?} */
                    const relativePath = this.metadatas[index1 - 1].treenode.MetadataInfo[index2 - 1].RelativePath;
                    return this.gspMetadataService.LoadMetadata(fileName, relativePath);
                }
            }
            else {
                return new Observable();
            }
        }
    }
    // // 获取元数据以及包的信息
    // GetTheMetadataFromPackage(metadata): Observable<any> {
    //   if (metadata) {
    //     const packageName = metadata.mdPkgName;
    //     const metadataID = metadata.id;
    //     return this.gspMetadataService.GetMetadataFromPackage(packageName, null, metadataID);
    //   }
    //   return new Observable<any>();
    // }
    // // 获取元数据以及包的信息
    // GetMetadataFromPackage(): Observable<any> {
    //   const index1 = this.metadatas.length;
    //   if (index1 > 0) {
    //     const index2 = this.metadatas[index1 - 1].treenode.MetadataInfo.length;
    //     if (index2 > 0) {
    //       const packageName = this.metadatas[index1 - 1].treenode.PackageName;
    //       const packagePath = this.metadatas[index1 - 1].treenode.Location;
    //       const metadataID = this.metadatas[index1 - 1].treenode.MetadataInfo[index2 - 1].ID;
    //       return this.gspMetadataService.GetMetadataFromPackage(packageName, packagePath, metadataID);
    //     }
    //   } else {
    //     return new Observable<any>();
    //   }
    // }
    // 获取某个路径下的所有元数据包
    /**
     * @return {?}
     */
    GetMetadataPackages() {
        return this.gspMetadataService.GetMetadataPackages('packages');
    }
    // 更新工程引用
    /**
     * @param {?} packageHeader
     * @return {?}
     */
    UpdateMetadataProject(packageHeader) {
        // this.gspMetadataService.UpdateMetadataProject(this.currentProjectPath, packageHeader).then(response => {
        //   if (response.status === 200) {
        //     this.treeData = [];
        //     this.Refresh();
        //   }
        // });
        return this.gspMetadataService.UpdateMetadataProject(this.currentProjectPath, packageHeader);
    }
    /**
     * @return {?}
     */
    getCodeLanguage() {
        return this.gspMetadataService.getCodeLanguage(this.currentProjectPath);
    }
    /**
     * @return {?}
     */
    getProcessMode() {
        return this.gspMetadataService.getProcessMode(this.currentProjectPath);
    }
    /**
     * @return {?}
     */
    Refresh() {
        this.treeData = this.getMetadataClassifier('');
        this.treeData[1].items = [];
        /** @type {?} */
        let packages = [];
        this.GetMetadataProjPath(this.currentProjectPath).subscribe((/**
         * @param {?} proj
         * @return {?}
         */
        proj => {
            this.currentProjectPath = proj.projectPath;
            this.GetMetadataProjectInfo().subscribe((/**
             * @param {?} meta
             * @return {?}
             */
            meta => {
                packages = meta.nugetPackageRefs;
                /** @type {?} */
                let index = 0;
                packages.forEach((/**
                 * @param {?} item
                 * @return {?}
                 */
                item => {
                    /** @type {?} */
                    const child = {
                        id: item.name,
                        text: item.name,
                        items: []
                    };
                    if (this.treeData) {
                        this.treeData[1].items.push(child);
                    }
                    this.gspMetadataService.GetDevRootPath().subscribe((/**
                     * @param {?} root
                     * @return {?}
                     */
                    root => {
                        /** @type {?} */
                        const rootPath = root + this.packRefPath;
                        this.gspMetadataService.GetMetadataPackagesUnderNugetDir(rootPath + '/' + item.name).subscribe((/**
                         * @param {?} pkgs
                         * @return {?}
                         */
                        pkgs => {
                            if (pkgs) {
                                /** @type {?} */
                                let mdpkg;
                                pkgs.forEach((/**
                                 * @param {?} pkg
                                 * @return {?}
                                 */
                                pkg => {
                                    mdpkg = {
                                        id: pkg.header.name,
                                        text: pkg.header.name,
                                        desc: pkg.header.location
                                    };
                                    child.items.push(mdpkg);
                                }));
                                // this.files[1].items[index].push(mdpkg);
                            }
                            index = index + 1;
                        }));
                    }));
                }));
            }));
        }));
    }
    /**
     * @return {?}
     */
    getBoPath() {
        return this.gspMetadataService.getBoPath(this.currentProjectPath);
    }
}
MetadataService.decorators = [
    { type: Injectable }
];
/** @nocollapse */
MetadataService.ctorParameters = () => [
    { type: GSPMetadataService }
];
if (false) {
    /** @type {?} */
    MetadataService.prototype.currentProjectPath;
    /** @type {?} */
    MetadataService.prototype.rootPath;
    /** @type {?} */
    MetadataService.prototype.packRefPath;
    /** @type {?} */
    MetadataService.prototype.selectedChange;
    /** @type {?} */
    MetadataService.prototype.treeData;
    /** @type {?} */
    MetadataService.prototype.metadatas;
    /** @type {?} */
    MetadataService.prototype.packages;
    /**
     * @type {?}
     * @private
     */
    MetadataService.prototype.gspMetadataService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWV0YWRhdGEuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0Bnc3AtbGNtL21ldGFkYXRhLXNlbGVjdG9yLyIsInNvdXJjZXMiOlsibWV0YWRhdGEvbWV0YWRhdGEtc2VsZWN0L21ldGFkYXRhLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLFlBQVksRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUN6RCxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFDN0MsT0FBTyxFQUFFLGtCQUFrQixFQUFFLE1BQU0scUJBQXFCLENBQUM7OztNQUduRCxVQUFVLEdBQVU7SUFDeEIsRUFBRSxFQUFFLEVBQUUsU0FBUyxFQUFFLElBQUksRUFBRSxRQUFRLEVBQUU7SUFDakMsRUFBRSxFQUFFLEVBQUUsT0FBTyxFQUFFLElBQUksRUFBRSxRQUFRLEVBQUU7SUFDL0IsRUFBRSxFQUFFLEVBQUUsUUFBUSxFQUFFLElBQUksRUFBRSxRQUFRLEVBQUU7SUFDaEMsRUFBRSxFQUFFLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxRQUFRLEVBQUUsQ0FBTyxJQUFJO0NBQ3pDOztNQUVLLGVBQWUsR0FBVTtJQUM3QixFQUFFLEVBQUUsRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLFFBQVEsRUFBRTtJQUM1QixFQUFFLEVBQUUsRUFBRSxPQUFPLEVBQUUsSUFBSSxFQUFFLFFBQVEsRUFBRTtJQUMvQixFQUFFLEVBQUUsRUFBRSxRQUFRLEVBQUUsSUFBSSxFQUFFLFFBQVEsRUFBRTtJQUNoQyxFQUFFLEVBQUUsRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFLFFBQVEsRUFBRSxDQUFPLElBQUk7Q0FDekM7QUFHRCxNQUFNLE9BQU8sZUFBZTs7OztJQUsxQixZQUFvQixrQkFBc0M7UUFBdEMsdUJBQWtCLEdBQWxCLGtCQUFrQixDQUFvQjtRQUQxRCxtQkFBYyxHQUFHLElBQUksWUFBWSxFQUFVLENBQUM7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Q25CLElBQUksRUFBRSxHQUFHLENBQUMsTUFBTSxDQUFDLElBQUk7d0NBQ3JCLElBQUksRUFBRSxHQUFHLENBQUMsTUFBTSxDQUFDLFFBQVE7cUNBQzFCLENBQUM7b0NBQ0YsS0FBSyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7Z0NBQzFCLENBQUMsRUFBQyxDQUFDO2dDQUNILDBDQUEwQzs2QkFDM0M7NEJBQ0QsS0FBSyxHQUFHLEtBQUssR0FBRyxDQUFDLENBQUM7d0JBQ3BCLENBQUMsRUFBQyxDQUFDO29CQUNMLENBQUMsRUFBQyxDQUFDO2dCQUNMLENBQUMsRUFBQyxDQUFDO1lBQ0wsQ0FBQyxFQUFDLENBQUM7UUFDTCxDQUFDLEVBQUMsQ0FBQztJQUNMLENBQUM7Ozs7SUFFTSxTQUFTO1FBQ2QsT0FBTyxJQUFJLENBQUMsa0JBQWtCLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDO0lBQ3BFLENBQUM7OztZQW5ORixVQUFVOzs7O1lBakJGLGtCQUFrQjs7OztJQW1CekIsNkNBQTJCOztJQUMzQixtQ0FBaUI7O0lBQ2pCLHNDQUFvQjs7SUFDcEIseUNBQTRDOztJQUs1QyxtQ0FBZ0I7O0lBV2hCLG9DQUFlOztJQVFmLG1DQUFjOzs7OztJQXZCRiw2Q0FBOEMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlLCBFdmVudEVtaXR0ZXIgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgT2JzZXJ2YWJsZSB9IGZyb20gJ3J4anMvT2JzZXJ2YWJsZSc7XHJcbmltcG9ydCB7IEdTUE1ldGFkYXRhU2VydmljZSB9IGZyb20gJy4uL21ldGFkYXRhLnNlcnZpY2UnO1xyXG5cclxuLy8gbW9ja+aVsOaNrlxyXG5jb25zdCBjbGFzc2lmaWVyOiBhbnlbXSA9IFtcclxuICB7IGlkOiAncHJvamVjdCcsIHRleHQ6ICflt6XnqIvlhoXlhYPmlbDmja4nIH0sICAvLyAwXHJcbiAgeyBpZDogJ2xvY2FsJywgdGV4dDogJ+emu+e6v+eahOWFg+aVsOaNricgfSwgICAgLy8gMVxyXG4gIHsgaWQ6ICdyZW1vdGUnLCB0ZXh0OiAn5LuT5bqT5Lit5YWD5pWw5o2uJyB9LCAgIC8vIDJcclxuICB7IGlkOiAncmVmJywgdGV4dDogJ+W8leeUqOeahOWFg+aVsOaNricgfSAgICAgICAvLyAzXHJcbl07XHJcblxyXG5jb25zdCBjbGFzc2lmaWVyRm9yQm86IGFueVtdID0gW1xyXG4gIHsgaWQ6ICdibycsIHRleHQ6ICdCT+WGheWFg+aVsOaNricgfSwgIC8vIDBcclxuICB7IGlkOiAnbG9jYWwnLCB0ZXh0OiAn56a757q/55qE5YWD5pWw5o2uJyB9LCAgICAvLyAxXHJcbiAgeyBpZDogJ3JlbW90ZScsIHRleHQ6ICfku5PlupPkuK3lhYPmlbDmja4nIH0sICAgLy8gMlxyXG4gIHsgaWQ6ICdyZWYnLCB0ZXh0OiAn5byV55So55qE5YWD5pWw5o2uJyB9ICAgICAgIC8vIDNcclxuXTtcclxuXHJcbkBJbmplY3RhYmxlKClcclxuZXhwb3J0IGNsYXNzIE1ldGFkYXRhU2VydmljZSB7XHJcbiAgY3VycmVudFByb2plY3RQYXRoOiBzdHJpbmc7XHJcbiAgcm9vdFBhdGg6IHN0cmluZztcclxuICBwYWNrUmVmUGF0aDogc3RyaW5nO1xyXG4gIHNlbGVjdGVkQ2hhbmdlID0gbmV3IEV2ZW50RW1pdHRlcjxzdHJpbmc+KCk7XHJcbiAgY29uc3RydWN0b3IocHJpdmF0ZSBnc3BNZXRhZGF0YVNlcnZpY2U6IEdTUE1ldGFkYXRhU2VydmljZSkge1xyXG4gICAgdGhpcy5wYWNrUmVmUGF0aCA9ICcvcGFja2FnZXMnO1xyXG4gIH1cclxuICAvLyBtb2Nr5qCR6IqC54K55pWw5o2uXHJcbiAgdHJlZURhdGE6IGFueVtdO1xyXG4gIGdldE1ldGFkYXRhQ2xhc3NpZmllcih0eXBlKSB7XHJcbiAgICBzd2l0Y2ggKHR5cGUpIHtcclxuICAgICAgY2FzZSAnYm8nOlxyXG4gICAgICAgIHJldHVybiBjbGFzc2lmaWVyRm9yQm87XHJcbiAgICAgIGNhc2UgJ3Byb2plY3QnOlxyXG4gICAgICBkZWZhdWx0OlxyXG4gICAgICAgIHJldHVybiBjbGFzc2lmaWVyO1xyXG4gICAgfVxyXG4gIH1cclxuICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bWVtYmVyLW9yZGVyaW5nXHJcbiAgbWV0YWRhdGFzID0gW107XHJcbiAgYWRkTWV0YWRhdGEobWV0YWRhdGEpIHtcclxuICAgIHRoaXMubWV0YWRhdGFzLnB1c2gobWV0YWRhdGEpO1xyXG4gIH1cclxuICBjbGVhck1ldGFkYXRhKCkge1xyXG4gICAgdGhpcy5tZXRhZGF0YXMgPSBbXTtcclxuICB9XHJcbiAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm1lbWJlci1vcmRlcmluZ1xyXG4gIHBhY2thZ2VzID0gW107XHJcbiAgYWRkUGFja2FnZShtcCkge1xyXG4gICAgdGhpcy5wYWNrYWdlcy5wdXNoKG1wKTtcclxuICB9XHJcbiAgY2xlYXJQYWNrYWdlKCkge1xyXG4gICAgdGhpcy5wYWNrYWdlcyA9IFtdO1xyXG4gIH1cclxuXHJcbiAgLy8g6I635Y+W5b2T5YmN5bel56iL5LiL5omA5pyJ55qE5YWD5pWw5o2uXHJcbiAgR2V0TWV0YWRhdGFMaXN0KHR5cGVOYW1lOiBzdHJpbmcpOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgcmV0dXJuIHRoaXMuZ3NwTWV0YWRhdGFTZXJ2aWNlLkdldE1ldGFkYXRhTGlzdCh0aGlzLmN1cnJlbnRQcm9qZWN0UGF0aCwgdHlwZU5hbWUpO1xyXG4gIH1cclxuXHJcbiAgLy8g6I635Y+W5b2T5YmN5bel56iL5LiL5omA5pyJ55qE5YWD5pWw5o2uXHJcbiAgR2V0TWV0YWRhdGFMaXN0SW5Cbyh0eXBlTmFtZTogc3RyaW5nKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgIHJldHVybiB0aGlzLmdzcE1ldGFkYXRhU2VydmljZS5HZXRNZXRhZGF0YUxpc3RJbkJvKHRoaXMuY3VycmVudFByb2plY3RQYXRoLCB0eXBlTmFtZSk7XHJcbiAgfVxyXG5cclxuICBHZXRNZXRhZGF0YUJ5RmlsdGVyKHR5cGVDb2RlOiBzdHJpbmcsIHBvc3RmaXg6IHN0cmluZywgZmlsdGVyOiBzdHJpbmcpOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgcmV0dXJuIHRoaXMuZ3NwTWV0YWRhdGFTZXJ2aWNlLkdldE1ldGFkYXRhQnlGaWx0ZXIodGhpcy5jdXJyZW50UHJvamVjdFBhdGgsIHR5cGVDb2RlLCBmaWx0ZXIsIHBvc3RmaXgpO1xyXG4gIH1cclxuXHJcbiAgLy8g6I635Y+W5YWD5pWw5o2u5bel56iL5L+h5oGv77yI6I635Y+W5pys5bel56iL5L6d6LWW55qE5YWD5pWw5o2u5YyF5Z+65pys5L+h5oGv77yJXHJcbiAgR2V0TWV0YWRhdGFQcm9qZWN0SW5mbygpOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgcmV0dXJuIHRoaXMuZ3NwTWV0YWRhdGFTZXJ2aWNlLkdldFByb2plY3RJbmZvKHRoaXMuY3VycmVudFByb2plY3RQYXRoKTtcclxuICB9XHJcblxyXG4gIC8vIOiOt+WPluW3peeoi+i3r+W+hFxyXG4gIEdldE1ldGFkYXRhUHJvalBhdGgobWV0YWRhdGFQYXRoOiBzdHJpbmcpOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgcmV0dXJuIHRoaXMuZ3NwTWV0YWRhdGFTZXJ2aWNlLkdldFByb2plY3RJbmZvKG1ldGFkYXRhUGF0aCk7XHJcbiAgfVxyXG5cclxuICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bWF4LWxpbmUtbGVuZ3RoXHJcbiAgR2V0TWV0YWRhdGFJbmZvcyhzY29wZSwgY29kZWxhbmd1YWdlOiBzdHJpbmcsIGlzTWF2ZW5FbmFibGU6IGJvb2xlYW4sIG1ldGFkYXRhVHlwZSA9IG51bGwsIHNlYXJjaFRleHQgPSBudWxsLCBwYWdlID0gbnVsbCwgc2VsZWN0ZWRQYWNrYWdlU291cmNlID0gbnVsbCkge1xyXG4gICAgaWYgKGNvZGVsYW5ndWFnZSA9PT0gJ2RvdG5ldCcgfHwgaXNNYXZlbkVuYWJsZSA9PT0gZmFsc2UpIHtcclxuICAgICAgcmV0dXJuIHRoaXMuZ3NwTWV0YWRhdGFTZXJ2aWNlLkdldE1ldGFkYXRhSW5mb3NCeVNjb3BlKHNjb3BlLCBtZXRhZGF0YVR5cGUsIHNlYXJjaFRleHQsIHBhZ2UsXHJcbiAgICAgICAgc2VsZWN0ZWRQYWNrYWdlU291cmNlLCB0aGlzLmN1cnJlbnRQcm9qZWN0UGF0aCk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICByZXR1cm4gdGhpcy5nc3BNZXRhZGF0YVNlcnZpY2UuR2V0TWV0YWRhdGFJbmZvc0J5U2NvcGU0SmF2YShzY29wZSwgbWV0YWRhdGFUeXBlLCBzZWFyY2hUZXh0LCBwYWdlLFxyXG4gICAgICAgIHNlbGVjdGVkUGFja2FnZVNvdXJjZSwgdGhpcy5jdXJyZW50UHJvamVjdFBhdGgpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLy8g6I635Y+W5YWD5pWw5o2u5YyF5Lit5omA5YyF5ZCr55qE5YWD5pWw5o2u5L+h5oGvXHJcbiAgR2V0TWV0YWRhdGFQYWNrYWdlSW5mbyhwYWNrUGF0aDogc3RyaW5nLCBwYWNrYWdlTmFtZTogc3RyaW5nKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgIGxldCBmdWxsTmFtZSA9ICcnO1xyXG4gICAgaWYgKHBhY2thZ2VOYW1lLmVuZHNXaXRoKCdtZHBrZycpKSB7XHJcbiAgICAgIGZ1bGxOYW1lID0gcGFja2FnZU5hbWU7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBmdWxsTmFtZSA9IHBhY2thZ2VOYW1lICsgJy5tZHBrZyc7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdGhpcy5nc3BNZXRhZGF0YVNlcnZpY2UuR2V0TWV0YWRhdGFQYWNrYWdlSW5mbyhwYWNrUGF0aCwgZnVsbE5hbWUpO1xyXG4gIH1cclxuICBwaWNrTWV0YWRhdGFJbmRleChzY29wZTogbnVtYmVyLCBtZXRhZGF0YUluZGV4RHRvOiBhbnksIGNvZGVsYW5ndWFnZTogc3RyaW5nLCBpc01hdmVuRW5hYmxlOiBib29sZWFuKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgIC8vIGlmIChjb2RlbGFuZ3VhZ2UgPT09ICdkb3RuZXQnIHx8IGlzTWF2ZW5FbmFibGUgPT09IGZhbHNlKSB7XHJcbiAgICAvLyAgIHNjb3BlID0gc2NvcGUgPT09IDMgPyAyIDogc2NvcGU7XHJcbiAgICAvLyAgIHJldHVybiB0aGlzLmdzcE1ldGFkYXRhU2VydmljZS5waWNrTWV0YWRhdGFJbmRleChzY29wZSwgdGhpcy5jdXJyZW50UHJvamVjdFBhdGgsIG1ldGFkYXRhSW5kZXhEdG8pO1xyXG4gICAgLy8gfSBlbHNlIHtcclxuICAgICAgcmV0dXJuIHRoaXMuZ3NwTWV0YWRhdGFTZXJ2aWNlLnBpY2tNZXRhZGF0YUluZGV4KHNjb3BlLCB0aGlzLmN1cnJlbnRQcm9qZWN0UGF0aCwgbWV0YWRhdGFJbmRleER0byk7XHJcbiAgICAvLyB9XHJcbiAgfVxyXG4gIC8vIExvYWTlhYPmlbDmja5cclxuICBMb2FkVGhlTWV0YWRhdGEobWV0YWRhdGE6IGFueSk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICBpZiAobWV0YWRhdGEpIHtcclxuICAgICAgY29uc3QgZmlsZU5hbWUgPSBtZXRhZGF0YS5maWxlTmFtZTtcclxuICAgICAgY29uc3QgcmVsYXRpdmVQYXRoID0gbWV0YWRhdGEucmVsYXRpdmVQYXRoO1xyXG4gICAgICByZXR1cm4gdGhpcy5nc3BNZXRhZGF0YVNlcnZpY2UuTG9hZE1ldGFkYXRhSW5CbyhmaWxlTmFtZSwgcmVsYXRpdmVQYXRoLCB0aGlzLmN1cnJlbnRQcm9qZWN0UGF0aCk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gbmV3IE9ic2VydmFibGU8YW55PigpO1xyXG4gIH1cclxuXHJcbiAgLy8gTG9hZOWFg+aVsOaNrlxyXG4gIExvYWRNZXRhZGF0YSgpOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgaWYgKHRoaXMubWV0YWRhdGFzLmxlbmd0aCA+IDApIHtcclxuICAgICAgY29uc3QgaW5kZXgxID0gdGhpcy5tZXRhZGF0YXMubGVuZ3RoO1xyXG4gICAgICBpZiAoaW5kZXgxID4gMCkge1xyXG4gICAgICAgIGNvbnN0IGluZGV4MiA9IHRoaXMubWV0YWRhdGFzW2luZGV4MSAtIDFdLnRyZWVub2RlLk1ldGFkYXRhSW5mby5sZW5ndGg7XHJcbiAgICAgICAgaWYgKGluZGV4MiA+IDApIHtcclxuICAgICAgICAgIGNvbnN0IGZpbGVOYW1lID0gdGhpcy5tZXRhZGF0YXNbaW5kZXgxIC0gMV0udHJlZW5vZGUuTWV0YWRhdGFJbmZvW2luZGV4MiAtIDFdLkZpbGVOYW1lO1xyXG4gICAgICAgICAgY29uc3QgcmVsYXRpdmVQYXRoID0gdGhpcy5tZXRhZGF0YXNbaW5kZXgxIC0gMV0udHJlZW5vZGUuTWV0YWRhdGFJbmZvW2luZGV4MiAtIDFdLlJlbGF0aXZlUGF0aDtcclxuICAgICAgICAgIHJldHVybiB0aGlzLmdzcE1ldGFkYXRhU2VydmljZS5Mb2FkTWV0YWRhdGEoZmlsZU5hbWUsIHJlbGF0aXZlUGF0aCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHJldHVybiBuZXcgT2JzZXJ2YWJsZTxhbnk+KCk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8vIC8vIOiOt+WPluWFg+aVsOaNruS7peWPiuWMheeahOS/oeaBr1xyXG4gIC8vIEdldFRoZU1ldGFkYXRhRnJvbVBhY2thZ2UobWV0YWRhdGEpOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gIC8vICAgaWYgKG1ldGFkYXRhKSB7XHJcbiAgLy8gICAgIGNvbnN0IHBhY2thZ2VOYW1lID0gbWV0YWRhdGEubWRQa2dOYW1lO1xyXG4gIC8vICAgICBjb25zdCBtZXRhZGF0YUlEID0gbWV0YWRhdGEuaWQ7XHJcbiAgLy8gICAgIHJldHVybiB0aGlzLmdzcE1ldGFkYXRhU2VydmljZS5HZXRNZXRhZGF0YUZyb21QYWNrYWdlKHBhY2thZ2VOYW1lLCBudWxsLCBtZXRhZGF0YUlEKTtcclxuICAvLyAgIH1cclxuICAvLyAgIHJldHVybiBuZXcgT2JzZXJ2YWJsZTxhbnk+KCk7XHJcbiAgLy8gfVxyXG5cclxuICAvLyAvLyDojrflj5blhYPmlbDmja7ku6Xlj4rljIXnmoTkv6Hmga9cclxuICAvLyBHZXRNZXRhZGF0YUZyb21QYWNrYWdlKCk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgLy8gICBjb25zdCBpbmRleDEgPSB0aGlzLm1ldGFkYXRhcy5sZW5ndGg7XHJcbiAgLy8gICBpZiAoaW5kZXgxID4gMCkge1xyXG4gIC8vICAgICBjb25zdCBpbmRleDIgPSB0aGlzLm1ldGFkYXRhc1tpbmRleDEgLSAxXS50cmVlbm9kZS5NZXRhZGF0YUluZm8ubGVuZ3RoO1xyXG4gIC8vICAgICBpZiAoaW5kZXgyID4gMCkge1xyXG4gIC8vICAgICAgIGNvbnN0IHBhY2thZ2VOYW1lID0gdGhpcy5tZXRhZGF0YXNbaW5kZXgxIC0gMV0udHJlZW5vZGUuUGFja2FnZU5hbWU7XHJcbiAgLy8gICAgICAgY29uc3QgcGFja2FnZVBhdGggPSB0aGlzLm1ldGFkYXRhc1tpbmRleDEgLSAxXS50cmVlbm9kZS5Mb2NhdGlvbjtcclxuICAvLyAgICAgICBjb25zdCBtZXRhZGF0YUlEID0gdGhpcy5tZXRhZGF0YXNbaW5kZXgxIC0gMV0udHJlZW5vZGUuTWV0YWRhdGFJbmZvW2luZGV4MiAtIDFdLklEO1xyXG4gIC8vICAgICAgIHJldHVybiB0aGlzLmdzcE1ldGFkYXRhU2VydmljZS5HZXRNZXRhZGF0YUZyb21QYWNrYWdlKHBhY2thZ2VOYW1lLCBwYWNrYWdlUGF0aCwgbWV0YWRhdGFJRCk7XHJcbiAgLy8gICAgIH1cclxuICAvLyAgIH0gZWxzZSB7XHJcbiAgLy8gICAgIHJldHVybiBuZXcgT2JzZXJ2YWJsZTxhbnk+KCk7XHJcbiAgLy8gICB9XHJcbiAgLy8gfVxyXG5cclxuICAvLyDojrflj5bmn5DkuKrot6/lvoTkuIvnmoTmiYDmnInlhYPmlbDmja7ljIVcclxuICBHZXRNZXRhZGF0YVBhY2thZ2VzKCk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICByZXR1cm4gdGhpcy5nc3BNZXRhZGF0YVNlcnZpY2UuR2V0TWV0YWRhdGFQYWNrYWdlcygncGFja2FnZXMnKTtcclxuICB9XHJcblxyXG4gIC8vIOabtOaWsOW3peeoi+W8leeUqFxyXG4gIFVwZGF0ZU1ldGFkYXRhUHJvamVjdChwYWNrYWdlSGVhZGVyOiBhbnkpOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgLy8gdGhpcy5nc3BNZXRhZGF0YVNlcnZpY2UuVXBkYXRlTWV0YWRhdGFQcm9qZWN0KHRoaXMuY3VycmVudFByb2plY3RQYXRoLCBwYWNrYWdlSGVhZGVyKS50aGVuKHJlc3BvbnNlID0+IHtcclxuICAgIC8vICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gMjAwKSB7XHJcbiAgICAvLyAgICAgdGhpcy50cmVlRGF0YSA9IFtdO1xyXG4gICAgLy8gICAgIHRoaXMuUmVmcmVzaCgpO1xyXG4gICAgLy8gICB9XHJcbiAgICAvLyB9KTtcclxuICAgIHJldHVybiB0aGlzLmdzcE1ldGFkYXRhU2VydmljZS5VcGRhdGVNZXRhZGF0YVByb2plY3QodGhpcy5jdXJyZW50UHJvamVjdFBhdGgsIHBhY2thZ2VIZWFkZXIpO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGdldENvZGVMYW5ndWFnZSgpOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgcmV0dXJuIHRoaXMuZ3NwTWV0YWRhdGFTZXJ2aWNlLmdldENvZGVMYW5ndWFnZSh0aGlzLmN1cnJlbnRQcm9qZWN0UGF0aCk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgZ2V0UHJvY2Vzc01vZGUoKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgIHJldHVybiB0aGlzLmdzcE1ldGFkYXRhU2VydmljZS5nZXRQcm9jZXNzTW9kZSh0aGlzLmN1cnJlbnRQcm9qZWN0UGF0aCk7XHJcbiAgfVxyXG5cclxuICBSZWZyZXNoKCkge1xyXG4gICAgdGhpcy50cmVlRGF0YSA9IHRoaXMuZ2V0TWV0YWRhdGFDbGFzc2lmaWVyKCcnKTtcclxuICAgIHRoaXMudHJlZURhdGFbMV0uaXRlbXMgPSBbXTtcclxuICAgIGxldCBwYWNrYWdlcyA9IFtdO1xyXG5cclxuICAgIHRoaXMuR2V0TWV0YWRhdGFQcm9qUGF0aCh0aGlzLmN1cnJlbnRQcm9qZWN0UGF0aCkuc3Vic2NyaWJlKHByb2ogPT4ge1xyXG4gICAgICB0aGlzLmN1cnJlbnRQcm9qZWN0UGF0aCA9IHByb2oucHJvamVjdFBhdGg7XHJcbiAgICAgIHRoaXMuR2V0TWV0YWRhdGFQcm9qZWN0SW5mbygpLnN1YnNjcmliZShtZXRhID0+IHtcclxuICAgICAgICBwYWNrYWdlcyA9IG1ldGEubnVnZXRQYWNrYWdlUmVmcztcclxuICAgICAgICBsZXQgaW5kZXggPSAwO1xyXG4gICAgICAgIHBhY2thZ2VzLmZvckVhY2goaXRlbSA9PiB7XHJcbiAgICAgICAgICBjb25zdCBjaGlsZCA9IHtcclxuICAgICAgICAgICAgaWQ6IGl0ZW0ubmFtZSxcclxuICAgICAgICAgICAgdGV4dDogaXRlbS5uYW1lLFxyXG4gICAgICAgICAgICBpdGVtczogW11cclxuICAgICAgICAgIH07XHJcbiAgICAgICAgICBpZiAodGhpcy50cmVlRGF0YSkge1xyXG4gICAgICAgICAgICB0aGlzLnRyZWVEYXRhWzFdLml0ZW1zLnB1c2goY2hpbGQpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgdGhpcy5nc3BNZXRhZGF0YVNlcnZpY2UuR2V0RGV2Um9vdFBhdGgoKS5zdWJzY3JpYmUocm9vdCA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IHJvb3RQYXRoID0gcm9vdCArIHRoaXMucGFja1JlZlBhdGg7XHJcbiAgICAgICAgICAgIHRoaXMuZ3NwTWV0YWRhdGFTZXJ2aWNlLkdldE1ldGFkYXRhUGFja2FnZXNVbmRlck51Z2V0RGlyKHJvb3RQYXRoICsgJy8nICsgaXRlbS5uYW1lKS5zdWJzY3JpYmUocGtncyA9PiB7XHJcbiAgICAgICAgICAgICAgaWYgKHBrZ3MpIHtcclxuICAgICAgICAgICAgICAgIGxldCBtZHBrZztcclxuICAgICAgICAgICAgICAgIHBrZ3MuZm9yRWFjaChwa2cgPT4ge1xyXG4gICAgICAgICAgICAgICAgICBtZHBrZyA9IHtcclxuICAgICAgICAgICAgICAgICAgICBpZDogcGtnLmhlYWRlci5uYW1lLFxyXG4gICAgICAgICAgICAgICAgICAgIHRleHQ6IHBrZy5oZWFkZXIubmFtZSxcclxuICAgICAgICAgICAgICAgICAgICBkZXNjOiBwa2cuaGVhZGVyLmxvY2F0aW9uXHJcbiAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICAgIGNoaWxkLml0ZW1zLnB1c2gobWRwa2cpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAvLyB0aGlzLmZpbGVzWzFdLml0ZW1zW2luZGV4XS5wdXNoKG1kcGtnKTtcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgaW5kZXggPSBpbmRleCArIDE7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgZ2V0Qm9QYXRoKCk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICByZXR1cm4gdGhpcy5nc3BNZXRhZGF0YVNlcnZpY2UuZ2V0Qm9QYXRoKHRoaXMuY3VycmVudFByb2plY3RQYXRoKTtcclxuICB9XHJcbn1cclxuIl19
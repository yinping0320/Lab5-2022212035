/**
 * @fileoverview added by tsickle
 * Generated from: metadata/metadata-select/components/selectmetadate/selectmetadata.component.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
// tslint:disable-next-line:max-line-length
import { Component, ViewChild, Input, Output, EventEmitter } from '@angular/core';
import { MetadataService } from '../../metadata.service';
import { MetadatapackageselectComponent } from '../metadatapackageselect/metadatapackageselect.component';
import { Metadata4RefDto, MetadataPackageHeader } from '../../../metadata4refdto';
import { GSPMetadataService } from '../../../metadata.service';
import { LoadingService } from '@farris/ui-loading';
export class SelectMetadataComponent {
    /**
     * @param {?} metadataService
     * @param {?} loading
     * @param {?} gspMetaService
     */
    constructor(metadataService, loading, gspMetaService) {
        this.metadataService = metadataService;
        this.loading = loading;
        this.gspMetaService = gspMetaService;
        this.selectedMetadata = new EventEmitter();
        this.closeModalEmitter = new EventEmitter();
        this.metadataService.selectedChange.subscribe((/**
         * @param {?} leftItem
         * @return {?}
         */
        leftItem => {
            this.classifier = leftItem;
        }));
        this.isMavenEnable = false;
        this.gspMetaService.getMavenSetting().subscribe((/**
         * @param {?} flag
         * @return {?}
         */
        flag => {
            // if (flag) {
            this.isMavenEnable = flag;
            // }
        }));
    }
    /**
     * @param {?} metadata
     * @return {?}
     */
    onSelectedMetadataChanged(metadata) {
        this.metadata = metadata;
    }
    /**
     * @param {?} code
     * @return {?}
     */
    setCodeLanguage(code) {
        this.codelanguage = code;
    }
    /**
     * @return {?}
     */
    LoadMetadata() {
        if (this.metadata && this.classifier) {
            // 选中的是当前工程下的元数据，调用Load
            if (this.classifier.id === 'project' || this.classifier.id === 'bo') {
                if (this.loading) {
                    this.loading.show({ message: '正在添加引用，请稍候...' });
                }
                this.metadataService.LoadTheMetadata(this.metadata).subscribe((/**
                 * @param {?} templates
                 * @return {?}
                 */
                templates => {
                    if (this.loading) {
                        this.loading.close();
                    }
                    /** @type {?} */
                    const metadata4Ref = new Metadata4RefDto();
                    metadata4Ref.metadata = templates;
                    metadata4Ref.metadata.processMode = this.metadata.processMode === 'interpretation' ? 'interpretation' : 'generation';
                    metadata4Ref.packageHeader = new MetadataPackageHeader();
                    this.selectedMetadata.emit(metadata4Ref);
                    this.hideModal();
                }), (/**
                 * @param {?} error
                 * @return {?}
                 */
                error => {
                    this.errorMsg(error);
                    if (this.loading) {
                        this.loading.close();
                    }
                }), (/**
                 * @return {?}
                 */
                () => {
                    if (this.loading) {
                        this.loading.close();
                    }
                }));
            }
            else if (this.classifier.id === 'local') {
                if (!this.metadata.mdPkgName) {
                    /** @type {?} */
                    const msg = '未找到元数据包信息。';
                    gsp.ide.messager.error(msg);
                    return;
                }
                if (this.loading) {
                    this.loading.show({ message: '正在添加引用，请稍候...' });
                }
                this.metadataService.pickMetadataIndex(1, this.metadata, this.codelanguage, this.isMavenEnable).subscribe((/**
                 * @param {?} templates
                 * @return {?}
                 */
                templates => {
                    if (this.loading) {
                        this.loading.close();
                    }
                    templates.metadata.processMode = this.metadata.processMode === 'interpretation' ? 'interpretation' : 'generation';
                    this.selectedMetadata.emit(templates);
                    this.hideModal();
                }), (/**
                 * @param {?} error
                 * @return {?}
                 */
                error => {
                    this.errorMsg(error);
                    if (this.loading) {
                        this.loading.close();
                    }
                }), (/**
                 * @return {?}
                 */
                () => {
                    if (this.loading) {
                        this.loading.close();
                    }
                }));
            }
            else if (this.classifier.id === 'remote') {
                if (!this.metadata.mdPkgName) {
                    /** @type {?} */
                    const msg = '未找到元数据包信息。';
                    gsp.ide.messager.error(msg);
                    return;
                }
                if (!this.metadata.repoPkg || this.metadata.repoPkg.length < 1) {
                    /** @type {?} */
                    const msg = '未找到仓库信息。';
                    gsp.ide.messager.error(msg);
                    return;
                }
                if (this.loading) {
                    this.loading.show({ message: '正在添加引用，请稍候...' });
                }
                this.metadataService.pickMetadataIndex(2, this.metadata, this.codelanguage, this.isMavenEnable).subscribe((/**
                 * @param {?} templates
                 * @return {?}
                 */
                templates => {
                    if (this.loading) {
                        this.loading.close();
                    }
                    templates.metadata.processMode = this.metadata.processMode === 'interpretation' ? 'interpretation' : 'generation';
                    this.selectedMetadata.emit(templates);
                    this.hideModal();
                }), (/**
                 * @param {?} error
                 * @return {?}
                 */
                error => {
                    this.errorMsg(error);
                    if (this.loading) {
                        this.loading.close();
                    }
                }), (/**
                 * @return {?}
                 */
                () => {
                    if (this.loading) {
                        this.loading.close();
                    }
                }));
            }
            else if (this.classifier.id === 'ref') {
                if (!this.metadata.mdPkgName) {
                    /** @type {?} */
                    const msg = '未找到元数据包信息。';
                    gsp.ide.messager.error(msg);
                    return;
                }
                if (!this.metadata.repoPkg || this.metadata.repoPkg.length < 1) {
                    /** @type {?} */
                    const msg = '未找到仓库信息。';
                    gsp.ide.messager.error(msg);
                    return;
                }
                if (this.loading) {
                    this.loading.show({ message: '请稍候...' });
                }
                this.metadataService.pickMetadataIndex(3, this.metadata, this.codelanguage, this.isMavenEnable).subscribe((/**
                 * @param {?} templates
                 * @return {?}
                 */
                templates => {
                    if (this.loading) {
                        this.loading.close();
                    }
                    templates.metadata.processMode = this.metadata.processMode === 'interpretation' ? 'interpretation' : 'generation';
                    this.selectedMetadata.emit(templates);
                    this.hideModal();
                }), (/**
                 * @param {?} error
                 * @return {?}
                 */
                error => {
                    this.errorMsg(error);
                    if (this.loading) {
                        this.loading.close();
                    }
                }), (/**
                 * @return {?}
                 */
                () => {
                    if (this.loading) {
                        this.loading.close();
                    }
                }));
            }
        }
        else {
            /** @type {?} */
            const msg = '请先选中一个元数据。';
            gsp.ide.messager.warning(msg);
        }
    }
    /**
     * @private
     * @param {?} error
     * @return {?}
     */
    errorMsg(error) {
        /** @type {?} */
        let msg = error.error.Message !== undefined ? error.error.Message : error.error.error.message;
        if (msg == null) {
            msg = '引用元数据失败。';
        }
        gsp.ide.messager.error(msg);
    }
    // 弹出元数据包选择界面
    /**
     * @return {?}
     */
    PackageSelect() {
        this.metadatapackageselectComponent.showModal();
    }
    /**
     * @return {?}
     */
    hideModal() {
        this.closeModalEmitter.emit();
    }
}
SelectMetadataComponent.decorators = [
    { type: Component, args: [{
                // tslint:disable-next-line:component-selector
                selector: 'app-select-metadata',
                template: "<div class=\"farris-main-area d-flex flex-column\">\r\n  <div class=\"modal-body d-flex flex-fill flex-column\">\r\n    <div class=\"templateBlock flex-column flex-fill d-flex\">\r\n      <kendo-splitter class=\"d-flex \" style=\"flex: 1 1 auto;\" orientation=\"horizontal\">\r\n        <kendo-splitter-pane class=\"d-flex \" [collapsible]=\"true\" size=\"170px\" style=\"height: auto\">\r\n          <app-treeclassifier [metadataPath]=\"metadataPath\" [onlyDisplayCurrentProject]=\"onlyDisplayCurrentProject\"></app-treeclassifier>\r\n        </kendo-splitter-pane>\r\n        <kendo-splitter-pane class=\"d-flex\" style=\"height: auto\">\r\n          <app-metadatalist [typeName]=\"typeName\" [filter]=\"filter\" [isMavenEnable]=\"isMavenEnable\" (technologyStack)=\"setCodeLanguage($event)\"\r\n            (selectedMetadataChanged)=\"this.onSelectedMetadataChanged($event)\"></app-metadatalist>\r\n        </kendo-splitter-pane>\r\n      </kendo-splitter>\r\n    </div>\r\n  </div>\r\n  <div class=\"modal-footer\">\r\n    <button type=\"button\" click.once class=\"btn btn-outline-primary btn-sm px-3 mx-2\"\r\n      (click.once)=\"LoadMetadata()\">\u786E\u5B9A</button>\r\n    <button type=\"button\" class=\"btn btn-outline-secondary btn-sm px-3 mx-2\" (click)=\"hideModal()\">\u53D6\u6D88</button>\r\n  </div>\r\n</div>\r\n",
                styles: [".templateBlock{display:flex}.infoBlock{width:100%;min-width:400px}.infoBlock label{width:50px}"]
            }] }
];
/** @nocollapse */
SelectMetadataComponent.ctorParameters = () => [
    { type: MetadataService },
    { type: LoadingService },
    { type: GSPMetadataService }
];
SelectMetadataComponent.propDecorators = {
    metadatapackageselectComponent: [{ type: ViewChild, args: [MetadatapackageselectComponent,] }],
    metadataPath: [{ type: Input }],
    typeName: [{ type: Input }],
    filter: [{ type: Input }],
    onlyDisplayCurrentProject: [{ type: Input }],
    closeModalEmitter: [{ type: Output }],
    selectedMetadata: [{ type: Output }]
};
if (false) {
    /** @type {?} */
    SelectMetadataComponent.prototype.metadatapackageselectComponent;
    /** @type {?} */
    SelectMetadataComponent.prototype.metadataPath;
    /** @type {?} */
    SelectMetadataComponent.prototype.typeName;
    /** @type {?} */
    SelectMetadataComponent.prototype.filter;
    /** @type {?} */
    SelectMetadataComponent.prototype.onlyDisplayCurrentProject;
    /** @type {?} */
    SelectMetadataComponent.prototype.classifier;
    /** @type {?} */
    SelectMetadataComponent.prototype.codelanguage;
    /** @type {?} */
    SelectMetadataComponent.prototype.isMavenEnable;
    /** @type {?} */
    SelectMetadataComponent.prototype.metadata;
    /** @type {?} */
    SelectMetadataComponent.prototype.closeModalEmitter;
    /** @type {?} */
    SelectMetadataComponent.prototype.selectedMetadata;
    /**
     * @type {?}
     * @private
     */
    SelectMetadataComponent.prototype.metadataService;
    /**
     * @type {?}
     * @private
     */
    SelectMetadataComponent.prototype.loading;
    /**
     * @type {?}
     * @private
     */
    SelectMetadataComponent.prototype.gspMetaService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2VsZWN0bWV0YWRhdGEuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGdzcC1sY20vbWV0YWRhdGEtc2VsZWN0b3IvIiwic291cmNlcyI6WyJtZXRhZGF0YS9tZXRhZGF0YS1zZWxlY3QvY29tcG9uZW50cy9zZWxlY3RtZXRhZGF0ZS9zZWxlY3RtZXRhZGF0YS5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQ0EsT0FBTyxFQUFFLFNBQVMsRUFBRSxTQUFTLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRSxZQUFZLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDbEYsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLHdCQUF3QixDQUFDO0FBQ3pELE9BQU8sRUFBRSw4QkFBOEIsRUFBRSxNQUFNLDBEQUEwRCxDQUFDO0FBQzFHLE9BQU8sRUFBRSxlQUFlLEVBQUUscUJBQXFCLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQztBQUNsRixPQUFPLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSwyQkFBMkIsQ0FBQztBQUMvRCxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sb0JBQW9CLENBQUM7QUFRcEQsTUFBTSxPQUFPLHVCQUF1Qjs7Ozs7O0lBZWxDLFlBQW9CLGVBQWdDLEVBQ2hDLE9BQXVCLEVBQ3ZCLGNBQWtDO1FBRmxDLG9CQUFlLEdBQWYsZUFBZSxDQUFpQjtRQUNoQyxZQUFPLEdBQVAsT0FBTyxDQUFnQjtRQUN2QixtQkFBYyxHQUFkLGNBQWMsQ0FBb0I7UUFKNUMscUJBQWdCLEdBQUcsSUFBSSxZQUFZLEVBQU8sQ0FBQztRQUtuRCxJQUFJLENBQUMsaUJBQWlCLEdBQUcsSUFBSSxZQUFZLEVBQU8sQ0FBQztRQUNqRCxJQUFJLENBQUMsZUFBZSxDQUFDLGNBQWMsQ0FBQyxTQUFTOzs7O1FBQUMsUUFBUSxDQUFDLEVBQUU7WUFDdkQsSUFBSSxDQUFDLFVBQVUsR0FBRyxRQUFRLENBQUM7UUFDN0IsQ0FBQyxFQUFDLENBQUM7UUFDSCxJQUFJ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Q0FBQztJQUNoQyxDQUFDOzs7WUFuSkYsU0FBUyxTQUFDOztnQkFFVCxRQUFRLEVBQUUscUJBQXFCO2dCQUMvQiwrekNBQThDOzthQUUvQzs7OztZQVhRLGVBQWU7WUFJZixjQUFjO1lBRGQsa0JBQWtCOzs7NkNBVXhCLFNBQVMsU0FBQyw4QkFBOEI7MkJBQ3hDLEtBQUs7dUJBQ0wsS0FBSztxQkFDTCxLQUFLO3dDQUNMLEtBQUs7Z0NBT0wsTUFBTTsrQkFDTixNQUFNOzs7O0lBWlAsaUVBQTBHOztJQUMxRywrQ0FBOEI7O0lBQzlCLDJDQUEwQjs7SUFDMUIseUNBQXdCOztJQUN4Qiw0REFBNEM7O0lBQzVDLDZDQUFnQjs7SUFFaEIsK0NBQXFCOztJQUVyQixnREFBdUI7O0lBQ3ZCLDJDQUFjOztJQUNkLG9EQUErQzs7SUFDL0MsbURBQXFEOzs7OztJQUV6QyxrREFBd0M7Ozs7O0lBQ3hDLDBDQUErQjs7Ozs7SUFDL0IsaURBQTBDIiwic291cmNlc0NvbnRlbnQiOlsiLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm1heC1saW5lLWxlbmd0aFxyXG5pbXBvcnQgeyBDb21wb25lbnQsIFZpZXdDaGlsZCwgSW5wdXQsIE91dHB1dCwgRXZlbnRFbWl0dGVyIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IE1ldGFkYXRhU2VydmljZSB9IGZyb20gJy4uLy4uL21ldGFkYXRhLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBNZXRhZGF0YXBhY2thZ2VzZWxlY3RDb21wb25lbnQgfSBmcm9tICcuLi9tZXRhZGF0YXBhY2thZ2VzZWxlY3QvbWV0YWRhdGFwYWNrYWdlc2VsZWN0LmNvbXBvbmVudCc7XHJcbmltcG9ydCB7IE1ldGFkYXRhNFJlZkR0bywgTWV0YWRhdGFQYWNrYWdlSGVhZGVyIH0gZnJvbSAnLi4vLi4vLi4vbWV0YWRhdGE0cmVmZHRvJztcclxuaW1wb3J0IHsgR1NQTWV0YWRhdGFTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vLi4vbWV0YWRhdGEuc2VydmljZSc7XHJcbmltcG9ydCB7IExvYWRpbmdTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy91aS1sb2FkaW5nJztcclxuXHJcbkBDb21wb25lbnQoe1xyXG4gIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpjb21wb25lbnQtc2VsZWN0b3JcclxuICBzZWxlY3RvcjogJ2FwcC1zZWxlY3QtbWV0YWRhdGEnLFxyXG4gIHRlbXBsYXRlVXJsOiAnLi9zZWxlY3RtZXRhZGF0YS5jb21wb25lbnQuaHRtbCcsXHJcbiAgc3R5bGVVcmxzOiBbJy4vc2VsZWN0bWV0YWRhdGEuY29tcG9uZW50LmNzcyddXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBTZWxlY3RNZXRhZGF0YUNvbXBvbmVudCB7XHJcbiAgQFZpZXdDaGlsZChNZXRhZGF0YXBhY2thZ2VzZWxlY3RDb21wb25lbnQpIG1ldGFkYXRhcGFja2FnZXNlbGVjdENvbXBvbmVudDogTWV0YWRhdGFwYWNrYWdlc2VsZWN0Q29tcG9uZW50O1xyXG4gIEBJbnB1dCgpIG1ldGFkYXRhUGF0aDogc3RyaW5nO1xyXG4gIEBJbnB1dCgpIHR5cGVOYW1lOiBzdHJpbmc7XHJcbiAgQElucHV0KCkgZmlsdGVyOiBzdHJpbmc7XHJcbiAgQElucHV0KCkgb25seURpc3BsYXlDdXJyZW50UHJvamVjdDogYm9vbGVhbjtcclxuICBjbGFzc2lmaWVyOiBhbnk7XHJcbiAgLy8g5oqA5pyv5qCIXHJcbiAgY29kZWxhbmd1YWdlOiBzdHJpbmc7XHJcbiAgLy8g5piv5ZCm5byA5ZCvbWF2ZW7lvJXnlKhcclxuICBpc01hdmVuRW5hYmxlOiBib29sZWFuO1xyXG4gIG1ldGFkYXRhOiBhbnk7XHJcbiAgQE91dHB1dCgpIGNsb3NlTW9kYWxFbWl0dGVyOiBFdmVudEVtaXR0ZXI8YW55PjtcclxuICBAT3V0cHV0KCkgc2VsZWN0ZWRNZXRhZGF0YSA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xyXG5cclxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIG1ldGFkYXRhU2VydmljZTogTWV0YWRhdGFTZXJ2aWNlLFxyXG4gICAgICAgICAgICAgIHByaXZhdGUgbG9hZGluZzogTG9hZGluZ1NlcnZpY2UsXHJcbiAgICAgICAgICAgICAgcHJpdmF0ZSBnc3BNZXRhU2VydmljZTogR1NQTWV0YWRhdGFTZXJ2aWNlKSB7XHJcbiAgICB0aGlzLmNsb3NlTW9kYWxFbWl0dGVyID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XHJcbiAgICB0aGlzLm1ldGFkYXRhU2VydmljZS5zZWxlY3RlZENoYW5nZS5zdWJzY3JpYmUobGVmdEl0ZW0gPT4ge1xyXG4gICAgICB0aGlzLmNsYXNzaWZpZXIgPSBsZWZ0SXRlbTtcclxuICAgIH0pO1xyXG4gICAgdGhpcy5pc01hdmVuRW5hYmxlID0gZmFsc2U7XHJcbiAgICB0aGlzLmdzcE1ldGFTZXJ2aWNlLmdldE1hdmVuU2V0dGluZygpLnN1YnNjcmliZShmbGFnID0+IHtcclxuICAgICAgLy8gaWYgKGZsYWcpIHtcclxuICAgICAgICB0aGlzLmlzTWF2ZW5FbmFibGUgPSBmbGFnO1xyXG4gICAgICAvLyB9XHJcbiAgICB9KTtcclxuICB9XHJcbiAgb25TZWxlY3RlZE1ldGFkYXRhQ2hhbmdlZChtZXRhZGF0YSkge1xyXG4gICAgdGhpcy5tZXRhZGF0YSA9IG1ldGFkYXRhO1xyXG4gIH1cclxuXHJcbiAgc2V0Q29kZUxhbmd1YWdlKGNvZGU6IHN0cmluZykge1xyXG4gICAgdGhpcy5jb2RlbGFuZ3VhZ2UgPSBjb2RlO1xyXG4gIH1cclxuXHJcbiAgTG9hZE1ldGFkYXRhKCkge1xyXG4gICAgaWYgKHRoaXMubWV0YWRhdGEgJiYgdGhpcy5jbGFzc2lmaWVyKSB7XHJcbiAgICAgIC8vIOmAieS4reeahOaYr+W9k+WJjeW3peeoi+S4i+eahOWFg+aVsOaNru+8jOiwg+eUqExvYWRcclxuICAgICAgaWYgKHRoaXMuY2xhc3NpZmllci5pZCA9PT0gJ3Byb2plY3QnIHx8IHRoaXMuY2xhc3NpZmllci5pZCA9PT0gJ2JvJykge1xyXG4gICAgICAgIGlmICh0aGlzLmxvYWRpbmcpIHsgdGhpcy5sb2FkaW5nLnNob3coeyBtZXNzYWdlOiAn5q2j5Zyo5re75Yqg5byV55So77yM6K+356iN5YCZLi4uJyB9KTsgfVxyXG4gICAgICAgIHRoaXMubWV0YWRhdGFTZXJ2aWNlLkxvYWRUaGVNZXRhZGF0YSh0aGlzLm1ldGFkYXRhKS5zdWJzY3JpYmUodGVtcGxhdGVzID0+IHtcclxuICAgICAgICAgIGlmICh0aGlzLmxvYWRpbmcpIHsgdGhpcy5sb2FkaW5nLmNsb3NlKCk7IH1cclxuICAgICAgICAgIGNvbnN0IG1ldGFkYXRhNFJlZiA9IG5ldyBNZXRhZGF0YTRSZWZEdG8oKTtcclxuICAgICAgICAgIG1ldGFkYXRhNFJlZi5tZXRhZGF0YSA9IHRlbXBsYXRlcztcclxuICAgICAgICAgIG1ldGFkYXRhNFJlZi5tZXRhZGF0YS5wcm9jZXNzTW9kZSA9IHRoaXMubWV0YWRhdGEucHJvY2Vzc01vZGUgPT09ICdpbnRlcnByZXRhdGlvbicgPyAnaW50ZXJwcmV0YXRpb24nIDogJ2dlbmVyYXRpb24nO1xyXG4gICAgICAgICAgbWV0YWRhdGE0UmVmLnBhY2thZ2VIZWFkZXIgPSBuZXcgTWV0YWRhdGFQYWNrYWdlSGVhZGVyKCk7XHJcbiAgICAgICAgICB0aGlzLnNlbGVjdGVkTWV0YWRhdGEuZW1pdChtZXRhZGF0YTRSZWYpO1xyXG4gICAgICAgICAgdGhpcy5oaWRlTW9kYWwoKTtcclxuICAgICAgICB9LCBlcnJvciA9PiB7XHJcbiAgICAgICAgICB0aGlzLmVycm9yTXNnKGVycm9yKTtcclxuICAgICAgICAgIGlmICh0aGlzLmxvYWRpbmcpIHsgdGhpcy5sb2FkaW5nLmNsb3NlKCk7IH1cclxuICAgICAgICB9LCAoKSA9PiB7XHJcbiAgICAgICAgICBpZiAodGhpcy5sb2FkaW5nKSB7IHRoaXMubG9hZGluZy5jbG9zZSgpOyB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH0gZWxzZSBpZiAodGhpcy5jbGFzc2lmaWVyLmlkID09PSAnbG9jYWwnKSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLm1ldGFkYXRhLm1kUGtnTmFtZSkge1xyXG4gICAgICAgICAgY29uc3QgbXNnID0gJ+acquaJvuWIsOWFg+aVsOaNruWMheS/oeaBr+OAgic7XHJcbiAgICAgICAgICBnc3AuaWRlLm1lc3NhZ2VyLmVycm9yKG1zZyk7XHJcbiAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0aGlzLmxvYWRpbmcpIHsgdGhpcy5sb2FkaW5nLnNob3coeyBtZXNzYWdlOiAn5q2j5Zyo5re75Yqg5byV55So77yM6K+356iN5YCZLi4uJyB9KTsgfVxyXG4gICAgICAgIHRoaXMubWV0YWRhdGFTZXJ2aWNlLnBpY2tNZXRhZGF0YUluZGV4KDEsIHRoaXMubWV0YWRhdGEsIHRoaXMuY29kZWxhbmd1YWdlLCB0aGlzLmlzTWF2ZW5FbmFibGUpLnN1YnNjcmliZSh0ZW1wbGF0ZXMgPT4ge1xyXG4gICAgICAgICAgaWYgKHRoaXMubG9hZGluZykgeyB0aGlzLmxvYWRpbmcuY2xvc2UoKTsgfVxyXG4gICAgICAgICAgdGVtcGxhdGVzLm1ldGFkYXRhLnByb2Nlc3NNb2RlID0gdGhpcy5tZXRhZGF0YS5wcm9jZXNzTW9kZSA9PT0gJ2ludGVycHJldGF0aW9uJyA/ICdpbnRlcnByZXRhdGlvbicgOiAnZ2VuZXJhdGlvbic7XHJcbiAgICAgICAgICB0aGlzLnNlbGVjdGVkTWV0YWRhdGEuZW1pdCh0ZW1wbGF0ZXMpO1xyXG4gICAgICAgICAgdGhpcy5oaWRlTW9kYWwoKTtcclxuICAgICAgICB9LCBlcnJvciA9PiB7XHJcbiAgICAgICAgICB0aGlzLmVycm9yTXNnKGVycm9yKTtcclxuICAgICAgICAgIGlmICh0aGlzLmxvYWRpbmcpIHsgdGhpcy5sb2FkaW5nLmNsb3NlKCk7IH1cclxuICAgICAgICB9LCAoKSA9PiB7XHJcbiAgICAgICAgICBpZiAodGhpcy5sb2FkaW5nKSB7IHRoaXMubG9hZGluZy5jbG9zZSgpOyB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH0gZWxzZSBpZiAodGhpcy5jbGFzc2lmaWVyLmlkID09PSAncmVtb3RlJykge1xyXG4gICAgICAgIGlmICghdGhpcy5tZXRhZGF0YS5tZFBrZ05hbWUpIHtcclxuICAgICAgICAgIGNvbnN0IG1zZyA9ICfmnKrmib7liLDlhYPmlbDmja7ljIXkv6Hmga/jgIInO1xyXG4gICAgICAgICAgZ3NwLmlkZS5tZXNzYWdlci5lcnJvcihtc2cpO1xyXG4gICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoIXRoaXMubWV0YWRhdGEucmVwb1BrZyB8fCB0aGlzLm1ldGFkYXRhLnJlcG9Qa2cubGVuZ3RoIDwgMSkge1xyXG4gICAgICAgICAgY29uc3QgbXNnID0gJ+acquaJvuWIsOS7k+W6k+S/oeaBr+OAgic7XHJcbiAgICAgICAgICBnc3AuaWRlLm1lc3NhZ2VyLmVycm9yKG1zZyk7XHJcbiAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0aGlzLmxvYWRpbmcpIHsgdGhpcy5sb2FkaW5nLnNob3coeyBtZXNzYWdlOiAn5q2j5Zyo5re75Yqg5byV55So77yM6K+356iN5YCZLi4uJyB9KTsgfVxyXG4gICAgICAgIHRoaXMubWV0YWRhdGFTZXJ2aWNlLnBpY2tNZXRhZGF0YUluZGV4KDIsIHRoaXMubWV0YWRhdGEsIHRoaXMuY29kZWxhbmd1YWdlLCB0aGlzLmlzTWF2ZW5FbmFibGUpLnN1YnNjcmliZSh0ZW1wbGF0ZXMgPT4ge1xyXG4gICAgICAgICAgaWYgKHRoaXMubG9hZGluZykgeyB0aGlzLmxvYWRpbmcuY2xvc2UoKTsgfVxyXG4gICAgICAgICAgdGVtcGxhdGVzLm1ldGFkYXRhLnByb2Nlc3NNb2RlID0gdGhpcy5tZXRhZGF0YS5wcm9jZXNzTW9kZSA9PT0gJ2ludGVycHJldGF0aW9uJyA/ICdpbnRlcnByZXRhdGlvbicgOiAnZ2VuZXJhdGlvbic7XHJcbiAgICAgICAgICB0aGlzLnNlbGVjdGVkTWV0YWRhdGEuZW1pdCh0ZW1wbGF0ZXMpO1xyXG4gICAgICAgICAgdGhpcy5oaWRlTW9kYWwoKTtcclxuICAgICAgICB9LCBlcnJvciA9PiB7XHJcbiAgICAgICAgICB0aGlzLmVycm9yTXNnKGVycm9yKTtcclxuICAgICAgICAgIGlmICh0aGlzLmxvYWRpbmcpIHsgdGhpcy5sb2FkaW5nLmNsb3NlKCk7IH1cclxuICAgICAgICB9LCAoKSA9PiB7XHJcbiAgICAgICAgICBpZiAodGhpcy5sb2FkaW5nKSB7IHRoaXMubG9hZGluZy5jbG9zZSgpOyB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH0gZWxzZSBpZiAodGhpcy5jbGFzc2lmaWVyLmlkID09PSAncmVmJykge1xyXG4gICAgICAgIGlmICghdGhpcy5tZXRhZGF0YS5tZFBrZ05hbWUpIHtcclxuICAgICAgICAgIGNvbnN0IG1zZyA9ICfmnKrmib7liLDlhYPmlbDmja7ljIXkv6Hmga/jgIInO1xyXG4gICAgICAgICAgZ3NwLmlkZS5tZXNzYWdlci5lcnJvcihtc2cpO1xyXG4gICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoIXRoaXMubWV0YWRhdGEucmVwb1BrZyB8fCB0aGlzLm1ldGFkYXRhLnJlcG9Qa2cubGVuZ3RoIDwgMSkge1xyXG4gICAgICAgICAgY29uc3QgbXNnID0gJ+acquaJvuWIsOS7k+W6k+S/oeaBr+OAgic7XHJcbiAgICAgICAgICBnc3AuaWRlLm1lc3NhZ2VyLmVycm9yKG1zZyk7XHJcbiAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0aGlzLmxvYWRpbmcpIHsgdGhpcy5sb2FkaW5nLnNob3coeyBtZXNzYWdlOiAn6K+356iN5YCZLi4uJyB9KTsgfVxyXG4gICAgICAgIHRoaXMubWV0YWRhdGFTZXJ2aWNlLnBpY2tNZXRhZGF0YUluZGV4KDMsIHRoaXMubWV0YWRhdGEsIHRoaXMuY29kZWxhbmd1YWdlLCB0aGlzLmlzTWF2ZW5FbmFibGUpLnN1YnNjcmliZSh0ZW1wbGF0ZXMgPT4ge1xyXG4gICAgICAgICAgaWYgKHRoaXMubG9hZGluZykgeyB0aGlzLmxvYWRpbmcuY2xvc2UoKTsgfVxyXG4gICAgICAgICAgdGVtcGxhdGVzLm1ldGFkYXRhLnByb2Nlc3NNb2RlID0gdGhpcy5tZXRhZGF0YS5wcm9jZXNzTW9kZSA9PT0gJ2ludGVycHJldGF0aW9uJyA/ICdpbnRlcnByZXRhdGlvbicgOiAnZ2VuZXJhdGlvbic7XHJcbiAgICAgICAgICB0aGlzLnNlbGVjdGVkTWV0YWRhdGEuZW1pdCh0ZW1wbGF0ZXMpO1xyXG4gICAgICAgICAgdGhpcy5oaWRlTW9kYWwoKTtcclxuICAgICAgICB9LCBlcnJvciA9PiB7XHJcbiAgICAgICAgICB0aGlzLmVycm9yTXNnKGVycm9yKTtcclxuICAgICAgICAgIGlmICh0aGlzLmxvYWRpbmcpIHsgdGhpcy5sb2FkaW5nLmNsb3NlKCk7IH1cclxuICAgICAgICB9LCAoKSA9PiB7XHJcbiAgICAgICAgICBpZiAodGhpcy5sb2FkaW5nKSB7IHRoaXMubG9hZGluZy5jbG9zZSgpOyB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH1cclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGNvbnN0IG1zZyA9ICfor7flhYjpgInkuK3kuIDkuKrlhYPmlbDmja7jgIInO1xyXG4gICAgICBnc3AuaWRlLm1lc3NhZ2VyLndhcm5pbmcobXNnKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHByaXZhdGUgZXJyb3JNc2coZXJyb3IpIHtcclxuICAgIGxldCBtc2cgPSBlcnJvci5lcnJvci5NZXNzYWdlICE9PSB1bmRlZmluZWQgPyBlcnJvci5lcnJvci5NZXNzYWdlIDogZXJyb3IuZXJyb3IuZXJyb3IubWVzc2FnZTtcclxuICAgIGlmIChtc2cgPT0gbnVsbCkge1xyXG4gICAgICBtc2cgPSAn5byV55So5YWD5pWw5o2u5aSx6LSl44CCJztcclxuICAgIH1cclxuICAgIGdzcC5pZGUubWVzc2FnZXIuZXJyb3IobXNnKTtcclxuICB9XHJcblxyXG4gIC8vIOW8ueWHuuWFg+aVsOaNruWMhemAieaLqeeVjOmdolxyXG4gIFBhY2thZ2VTZWxlY3QoKSB7XHJcbiAgICB0aGlzLm1ldGFkYXRhcGFja2FnZXNlbGVjdENvbXBvbmVudC5zaG93TW9kYWwoKTtcclxuICB9XHJcbiAgaGlkZU1vZGFsKCk6IHZvaWQge1xyXG4gICAgdGhpcy5jbG9zZU1vZGFsRW1pdHRlci5lbWl0KCk7XHJcbiAgfVxyXG59XHJcbiJdfQ==
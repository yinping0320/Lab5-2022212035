!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/common"),require("rxjs/Observable"),require("@angular/forms"),require("@progress/kendo-angular-treeview"),require("@progress/kendo-angular-grid"),require("@farris/ui-dialog"),require("@progress/kendo-angular-layout"),require("@progress/kendo-data-query"),require("@progress/kendo-angular-dropdowns"),require("@farris/ui-loading"),require("rxjs/operators"),require("rxjs"),require("@angular/core"),require("@angular/common/http"),require("@farris/ide-devkit")):"function"==typeof define&&define.amd?define("@gsp-lcm/metadata-selector",["exports","@angular/common","rxjs/Observable","@angular/forms","@progress/kendo-angular-treeview","@progress/kendo-angular-grid","@farris/ui-dialog","@progress/kendo-angular-layout","@progress/kendo-data-query","@progress/kendo-angular-dropdowns","@farris/ui-loading","rxjs/operators","rxjs","@angular/core","@angular/common/http","@farris/ide-devkit"],t):t((e["gsp-lcm"]=e["gsp-lcm"]||{},e["gsp-lcm"]["metadata-selector"]={}),e.ng.common,e.rxjs.Observable,e.ng.forms,e.kendoAngularTreeview,e.kendoAngularGrid,e.uiDialog,e.kendoAngularLayout,e.kendoDataQuery,e.kendoAngularDropdowns,e.uiLoading,e.rxjs.operators,e.rxjs,e.ng.core,e.ng.common.http,e.ideDevkit)}(this,function(e,t,s,a,i,n,r,o,d,c,p,l,h,g,u,f){"use strict";var m=function $(e,t,a,i){this.packageName=e,this.projectPath=i,this.packageVersion=t,this.packageLocation=a},v=(S.prototype.Pack=function(){"folder"===this.selectType||"project"===this.selectType?""!==this.selectPath&&this.selectPath!==undefined&&this.PackageBuild(this.selectPath.substring(1)):alert("请选择合适的目录")},S.prototype.PackageBuild=function(e){var t=gsp.cache.get("sessionId"),a=new u.HttpHeaders({"Content-Type":"application/json"}).append("SessionId",t),i=new m("","","",e),s=this.SERVER_IP+this.METADATA_PACKAGE_BASE_PATH;return this.http.post(s,i,{headers:a,observe:"response"})},S.prototype.IsProjExistRecursively=function(e){var t=this.SERVER_IP+this.METADATA_PROJECT_BASE_PATH+"/validationrecursively?path="+e,a=new h.Subject;return this.http.get(t).subscribe(function(e){a.next(e)}),a},S.prototype.InitializeMetadataEntity=function(e){var t=(new u.HttpHeaders).set("SessionId",this.sessionId),a=this.SERVER_IP+this.METADATA_BASE_PATH+"/initialized?nameSpace="+e.nameSpace+"&code="+e.code+"&name="+e.name+"&type="+e.type+"&bizObjectID="+e.bizobjectID+"&metadataPath="+e.relativePath+"&extendProperty="+e.extendProperty;return this.http.get(a,{headers:t})},S.prototype.CreateMetadata=function(e){var t={ID:e.id,NameSpace:e.nameSpace,Code:e.code,Name:e.name,FileName:e.fileName,RelativePath:e.relativePath,Content:e.content,Type:e.type,BizobjectID:e.bizobjectID,ExtendProperty:e.extendProperty},a=(new u.HttpHeaders).set("SessionId",this.sessionId),i=this.SERVER_IP+this.METADATA_BASE_PATH;return this.http.post(i,t,{params:{},headers:a,observe:"response"})},S.prototype.DeleteMetadata=function(){var t=this;""!==this.selectPath&&this.selectPath!==undefined&&"file"===this.selectType?this.DeleteMetadataOrDir(this.selectPath.substring(1)).subscribe(function(e){alert("删除成功！"),t.selectPath="",t.selectType=""},function(e){alert("删除失败！")}):alert("请选择正确的文件进行删除！")},S.prototype.SaveMetadata=function(e,t){var a={ID:e.id,NameSpace:e.nameSpace,Code:e.code,Name:e.name,FileName:e.fileName,RelativePath:e.relativePath,Content:e.content,Type:e.type,BizobjectID:e.bizobjectID,ExtendProperty:e.extendProperty,Extendable:e.extendable},i=(new u.HttpHeaders).set("SessionId",this.sessionId),s=this.SERVER_IP+this.METADATA_BASE_PATH;return this.http.put(s,a,{headers:i,observe:"response"})},S.prototype.LoadMetadata=function(e,t){var a=(new u.HttpHeaders).set("SessionId",this.sessionId),i=t.replace(/\\/g,"/")+"/"+e,s=encodeURIComponent(i),n=this.SERVER_IP+this.METADATA_BASE_PATH+"/load?metadataFullPath="+s;return this.http.get(n,{headers:a})},S.prototype.LoadMetadataInBo=function(e,t,a){var i=(new u.HttpHeaders).set("SessionId",this.sessionId),s=t.replace(/\\/g,"/")+"/"+e,n=encodeURIComponent(s),r=this.SERVER_IP+this.METADATA_BASE_PATH+"/metadataInBo?metadataFullPath="+n+"&currentProjPath="+a;return this.http.get(r,{headers:i})},S.prototype.DeleteFolder=function(){var t=this;""!==this.selectPath&&this.selectPath!==undefined&&"folder"===this.selectType?this.DeleteMetadataOrDir(this.selectPath.substring(1)).subscribe(function(e){alert("删除成功！"),t.selectPath="",t.selectType=""},function(e){alert("删除失败！")}):alert("请选择正确的目录进行删除！")},S.prototype.DeleteProj=function(){var t=this;""!==this.selectPath&&this.selectPath!==undefined&&"project"===this.selectType?this.DeleteProject(this.selectPath.substring(1)).subscribe(function(e){alert("删除成功！"),t.selectPath="",t.selectType=""},function(e){alert("删除失败！")}):alert("请选择正确的工程节点进行删除！")},S.prototype.DeleteMetadataOrDir=function(e){var t=gsp.cache.get("sessionId"),a=(new u.HttpHeaders).set("SessionId",t),i=encodeURIComponent(e.replace(/\\/g,"/")),s=this.SERVER_IP+this.METADATA_BASE_PATH+"/delete?fullPath="+i;return this.http["delete"](s,{params:{},headers:a,observe:"response"})},S.prototype.isMetadataRefed=function(e){var t=gsp.cache.get("sessionId"),a=(new u.HttpHeaders).set("SessionId",t),i=encodeURIComponent(e.replace(/\\/g,"/")),s=this.SERVER_IP+this.METADATA_JAVA_BASE_PATH+"/isMetadataRefed?path="+i;return this.http.get(s,{params:{},headers:a,observe:"response"})},S.prototype.DeleteProject=function(e){var t=gsp.cache.get("sessionId"),a=(new u.HttpHeaders).set("SessionId",t),i=this.SERVER_IP+this.Project_Base_Path+"/"+e.replace(/\\/g,"/");return this.http["delete"](i,{params:{},headers:a,observe:"response"})},S.prototype.GetDevRootPath=function(){(new u.HttpHeaders).set("SessionId",this.sessionId);var e=this.SERVER_IP+this.Project_Base_Path+"/rootpath",t=new h.Subject;return this.http.get(e,{responseType:"text"}).subscribe(function(e){e&&t.next(e)}),t},S.prototype.LoadDBO=function(e,t,a){var i=t.replace(/\\/g,"/")+"/"+e,s=this.SERVER_IP+this.DBO_BASE_PATH+"/"+i,n=(new u.HttpHeaders).set("SessionId",this.sessionId);return this.http.get(s,{headers:n})},S.prototype.CreateDir=function(e,t){var a=(new u.HttpHeaders).set("SessionId",this.sessionId),i=this.SERVER_IP+this.Project_Base_Path+"/folder"+e+"/"+t+"?quiet=true";return this.http.post(i,null,{params:{},headers:a,observe:"response"})},S.prototype.GetProjectInfo=function(e){var t=(new u.HttpHeaders).set("SessionId",this.sessionId),a=this.SERVER_IP+this.METADATA_PROJECT_BASE_PATH+"?path="+e;return this.http.get(a,{headers:t})},S.prototype.GetGspProjInfo=function(e){var t=(new u.HttpHeaders).set("SessionId",this.sessionId),a=this.SERVER_IP+this.GSP_PROJECT_BASE_PATH+"?path="+e;return this.http.get(a,{headers:t})},S.prototype.GetProjPath=function(e){(new u.HttpHeaders).set("SessionId",this.sessionId);var t=this.SERVER_IP+this.METADATA_PROJECT_BASE_PATH+"/path?path="+e;return this.http.get(t,{responseType:"text"})},S.prototype.GetRefMetadata=function(e,t,a){var i=(new u.HttpHeaders).set("SessionId",this.sessionId),s=this.SERVER_IP+this.METADATA_BASE_PATH+"/relied?metadataPath="+e+"&metadataID="+t;return this.http.get(s,{headers:i})},S.prototype.GetMetadataList=function(e,t){var a=(new u.HttpHeaders).set("SessionId",this.sessionId),i=this.SERVER_IP+this.METADATA_JAVA_BASE_PATH+"?path="+e+"&metadataTypeList="+t;return this.http.get(i,{headers:a})},S.prototype.GetMetadataListInBo=function(e,t){var a=(new u.HttpHeaders).set("SessionId",this.sessionId),i=this.SERVER_IP+this.METADATA_JAVA_BASE_PATH+"/metadataListInBo?path="+e+"&metadataTypeList="+t;return this.http.get(i,{headers:a})},S.prototype.GetMetadataByFilter=function(e,t,a,i){var s=(new u.HttpHeaders).set("SessionId",this.sessionId),n=this.SERVER_IP+this.METADATA_BASE_PATH+"/filter?path="+e+"&typeCode="+t+"&filter="+a+"&postfix="+i;return this.http.get(n,{headers:s})},S.prototype.pickMetadataIndex=function(e,t,a){var i=gsp.cache.get("sessionId"),s=new u.HttpHeaders({"Content-Type":"application/json"}).append("SessionId",i),n=this.SERVER_IP+this.METADATA_JAVA_BASE_PATH+"/pickmd?scopeType="+e+"&currentPath="+t;return this.http.post(n,a,{headers:s})},S.prototype.GetMetadataPackageInfo=function(e,t){var a=(new u.HttpHeaders).set("SessionId",this.sessionId),i="";i=e?e.replace(/\\/g,"/")+"/"+t:t;var s=encodeURIComponent(i),n=this.SERVER_IP+this.METADATA_PACKAGE_BASE_PATH+"/packagePath?packagePath="+s;return this.http.get(n,{headers:a})},S.prototype.GetLocalPackages=function(e){var t=(new u.HttpHeaders).set("SessionId",this.sessionId),a=this.SERVER_IP+this.METADATA_PACKAGE_BASE_PATH+"/local?path="+e;return this.http.get(a,{headers:t})},S.prototype.GetMetadataInfosByScope=function(e,t,a,i,s,n){void 0===t&&(t=null),void 0===a&&(a=null),void 0===i&&(i=null),void 0===s&&(s=null),void 0===n&&(n="");var r=(new u.HttpHeaders).set("SessionId",this.sessionId),o=this.SERVER_IP+this.METADATA_BASE_PATH+"/scope/"+e+"?path="+n;return i?o=o+"&page=true&pageIndex="+i.pageIndex+"&pageSize="+i.pageSize:o+="&page=false",t&&(o=o+"&metadataTypeList="+t),a&&(o=o+"&text="+a),2!==e&&3!==e||!s||(o=o+"&selectedPackageSource="+s),this.http.get(o,{headers:r})},S.prototype.GetMetadataInfosByScope4Java=function(e,t,a,i,s,n){void 0===t&&(t=null),void 0===a&&(a=null),void 0===i&&(i=null),void 0===s&&(s=null),void 0===n&&(n="");var r=(new u.HttpHeaders).set("SessionId",this.sessionId),o=this.SERVER_IP+this.METADATA_JAVA_BASE_PATH+"/mdlist?scopeType="+e+"&path="+n;return i?o=o+"&page=true&pageIndex="+i.pageIndex+"&pageSize="+i.pageSize:o+="&page=false",t&&(o=o+"&metadataTypeList="+t),a&&(o=o+"&text="+a),2!==e&&3!==e||!s||(o=o+"&selectedPackageSource="+s),this.http.get(o,{headers:r})},S.prototype.GetMetadataPackages=function(e){var t=(new u.HttpHeaders).set("SessionId",this.sessionId),a=this.SERVER_IP+this.Project_Base_Path+"/children/"+e;return this.http.get(a,{headers:t})},S.prototype.GetMetadataTypeList=function(){var e=(new u.HttpHeaders).set("SessionId",this.sessionId),t=this.SERVER_IP+this.METADATA_CONFIG_BASE_PATH;return this.http.get(t,{headers:e})},S.prototype.GetPostfix=function(t){return this.GetMetadataTypeList().subscribe(function(e){e.forEach(function(e){if(t.toLowerCase()===e.typeCode.toLowerCase())return e.postfix})}),new h.Observable},S.prototype.UpdateMetadataProject=function(e,t){var a={ProjectPath:e,DepPackageName:t.name,DepPackageVersion:t.version.versionString,DepPackageLocation:t.location},i=(new u.HttpHeaders).set("SessionId",this.sessionId),s=this.SERVER_IP+this.METADATA_PROJECT_BASE_PATH;return this.http.put(s,a,{params:{},headers:i,observe:"response"})},S.prototype.GetDevBasicBOInfo=function(e,t){var a=(new u.HttpHeaders).set("SessionId",this.sessionId),i=this.SERVER_IP+this.DevBasinBOInfo_Base_Path+"/"+e;return this.http.get(i,{headers:a})},S.prototype.ValidateRepeatName=function(e,t){var a=this.SERVER_IP+this.METADATA_BASE_PATH+"/validation?path="+e+"&fileName="+t,i=new h.Subject;return this.http.get(a).subscribe(function(e){i.next(e)}),i},S.prototype.SetMetadataUri=function(e,t){var a=(new u.HttpHeaders).set("SessionId",this.sessionId),i=this.SERVER_IP+this.METADATA_CONFIG_BASE_PATH+"?path="+e;return this.http.put(i,null,{params:{},headers:a,observe:"response"})},S.prototype.getGspProjectType=function(){var e=(new u.HttpHeaders).set("SessionId",this.sessionId),t=this.SERVER_IP+this.GSP_PROJECT_BASE_PATH+"/type";return this.http.get(t,{headers:e})},S.prototype.updateGspProject=function(e,t){var a=gsp.cache.get("sessionId"),i=(new u.HttpHeaders).set("SessionId",a),s=this.SERVER_IP+this.GSP_PROJECT_BASE_PATH+"?path="+e+"&codeLanguage="+t;return this.http.put(s,null,{params:{},headers:i,observe:"response"})},S.prototype.getNugetSourceList=function(){var e=(new u.HttpHeaders).set("SessionId",this.sessionId),t=this.SERVER_IP+this.NUGET_BASE_PATH+"/sources";return this.http.get(t,{headers:e})},S.prototype.getMavenSourceList=function(){var e=(new u.HttpHeaders).set("SessionId",this.sessionId),t=this.SERVER_IP+this.MAVEN_JAVA_BASE_PATH+"/repolist";return this.http.get(t,{headers:e})},S.prototype.getCodeLanguage=function(e){var t=this.SERVER_IP+this.METADATA_PROJECT_BASE_PATH+"/codelanguage?projPath="+e;return this.http.get(t,{responseType:"text"})},S.prototype.getSettingInfo=function(){var e=(new u.HttpHeaders).set("SessionId",this.sessionId),t=this.SERVER_IP+this.SETTING_BASE_PATH;return this.http.get(t,{headers:e})},S.prototype.getMavenSetting=function(){var e=this.SERVER_IP+this.METADATA_BASE_PATH+"/mavensetting";return this.http.get(e)},S.prototype.getBoPath=function(e){var t=this.SERVER_IP+this.METADATA_PROJECT_BASE_PATH+"/bopath?path="+e;return this.http.get(t,{responseType:"text"})},S.prototype.getMavenStatus=function(e){var t=this.SERVER_IP+this.METADATA_PROJECT_BASE_PATH+"/isMaven?path="+e;return this.http.get(t)},S.prototype.isInterpretation=function(e){var t=this.SERVER_IP+this.METADATA_PROJECT_BASE_PATH+"/isInterpretation?path="+e;return this.http.get(t)},S.prototype.generate=function(e){var t=this.JAVA_CODE_GENERATOR+"?path="+e;return this.http.post(t,null)},S.prototype.getProcessMode=function(e){var t=this.SERVER_IP+this.METADATA_JAVA_BASE_PATH+"/processMode?path="+e;return this.http.get(t,{responseType:"text"})},S.prototype.addDependencyAndRestore=function(e,t,a){var i,s=(new u.HttpHeaders).set("SessionId",this.sessionId);return a?(i=this.SERVER_IP+this.MAVEN_JAVA_BASE_PATH+"/adddepedency?path="+e+"&metadataPackages="+t,this.http.put(i,null,{params:{},headers:s,observe:"response"})):(i=this.SERVER_IP+this.NUGET_BASE_PATH+"/adddepedency?projPath="+e+"&metadataPackages="+t,this.http.post(i,null,{params:{},headers:s,observe:"response"}))},S.prototype.showInExplorer=function(e){var t=this.SERVER_IP+this.FS_JAVA_BASE_PATH+"?path="+e;return this.http.get(t)},S.prototype.restoreMavenPackage=function(e,t){var a=(new u.HttpHeaders).set("SessionId",this.sessionId),i=this.SERVER_IP+this.MAVEN_JAVA_BASE_PATH+"/adddepedency?path="+e+"&metadataPackages="+t;return this.http.put(i,null,{headers:a,observe:"response"})},S.prototype.getMenu=function(e){var t=this.SERVER_IP+this.SETTING_BASE_PATH+"/menu?path="+e;return this.http.get(t)},S.prototype.mavenBuildAll=function(e,t){if(void 0===t&&(t=!1),t)return this.getMenu(e);var a=this.JAVA_BUILD+"/compileAll?path="+e;return this.http.post(a,null)},S.prototype.getProjPathsInPath=function(e){var t=this.SERVER_IP+this.METADATA_JAVA_BASE_PATH+"/projinpath?path="+e;return this.http.get(t)},S.prototype.getMdpkgNameExistInBo=function(e,t){var a=this.SERVER_IP+this.METADATA_JAVA_BASE_PATH+"/mdpkgNameExist?path="+e+"&mdpkgName="+t;return this.http.get(a,{responseType:"text"})},S.prototype.IsProjExist=function(e){var t=this.SERVER_IP+this.METADATA_PROJECT_BASE_PATH+"/validation?path="+e,a=new h.Subject;return this.http.get(t).subscribe(function(e){a.next(e)}),a},S.prototype.GetMetadataPackagesUnderNugetDir=function(e){var t=(new u.HttpHeaders).set("SessionId",this.sessionId),a=this.SERVER_IP+this.METADATA_PACKAGE_BASE_PATH+"?path="+e;return this.http.get(a,{headers:t})},S.decorators=[{type:g.Injectable}],S.ctorParameters=function(){return[{type:u.HttpClient},{type:String,decorators:[{type:g.Inject,args:["url"]}]}]},S);function S(e,t){this.http=e,this.url=t,this.METADATA_BASE_PATH="/api/dev/main/v1.0/metadatas",this.GSP_PROJECT_BASE_PATH="/api/dev/main/v1.0/gsp-projects",this.Project_Base_Path="/api/dev/main/v1.0/project",this.DBO_BASE_PATH="/api/dev/main/v1.0/database-objects",this.METADATA_PROJECT_BASE_PATH="/api/dev/main/v1.0/metadata-projects",this.METADATA_PACKAGE_BASE_PATH="/api/dev/main/v1.0/metadata-packages",this.METADATA_CONFIG_BASE_PATH="/api/dev/main/v1.0/metadata-configs",this.DevBasinBOInfo_Base_Path="/api/dev/main/v1.0/dev-basic-boinfos",this.NUGET_BASE_PATH="/api/dev/main/v1.0/nuget-packages",this.SETTING_BASE_PATH="/api/dev/main/v1.0/ide/settings",this.MAVEN_JAVA_BASE_PATH="/api/dev/main/v1.0/repo-packages",this.FS_JAVA_BASE_PATH="/api/dev/main/v1.0/file-system",this.JAVA_CODE_GENERATOR="/api/dev/main/v1.0/generator",this.JAVA_BUILD="/api/dev/main/v1.0/repo-packages",this.METADATA_JAVA_BASE_PATH="/api/dev/main/v1.0/mdservice",this.SERVER_IP=null===t||t===undefined?"":t,this.sessionId=gsp.cache.get("sessionId")}var P=[{id:"project",text:"工程内元数据"},{id:"local",text:"离线的元数据"},{id:"remote",text:"仓库中元数据"},{id:"ref",text:"引用的元数据"}],y=[{id:"bo",text:"BO内元数据"},{id:"local",text:"离线的元数据"},{id:"remote",text:"仓库中元数据"},{id:"ref",text:"引用的元数据"}],b=(E.prototype.getMetadataClassifier=function(e){switch(e){case"bo":return y;case"project":default:return P}},E.prototype.addMetadata=function(e){this.metadatas.push(e)},E.prototype.clearMetadata=function(){this.metadatas=[]},E.prototype.addPackage=function(e){this.packages.push(e)},E.prototype.clearPackage=function(){this.packages=[]},E.prototype.GetMetadataList=function(e){return this.gspMetadataService.GetMetadataList(this.currentProjectPath,e)},E.prototype.GetMetadataListInBo=function(e){return this.gspMetadataService.GetMetadataListInBo(this.currentProjectPath,e)},E.prototype.GetMetadataByFilter=function(e,t,a){return this.gspMetadataService.GetMetadataByFilter(this.currentProjectPath,e,a,t)},E.prototype.GetMetadataProjectInfo=function(){return this.gspMetadataService.GetProjectInfo(this.currentProjectPath)},E.prototype.GetMetadataProjPath=function(e){return this.gspMetadataService.GetProjectInfo(e)},E.prototype.GetMetadataInfos=function(e,t,a,i,s,n,r){return void 0===i&&(i=null),void 0===s&&(s=null),void 0===n&&(n=null),void 0===r&&(r=null),"dotnet"===t||!1===a?this.gspMetadataService.GetMetadataInfosByScope(e,i,s,n,r,this.currentProjectPath):this.gspMetadataService.GetMetadataInfosByScope4Java(e,i,s,n,r,this.currentProjectPath)},E.prototype.GetMetadataPackageInfo=function(e,t){var a="";return a=t.endsWith("mdpkg")?t:t+".mdpkg",this.gspMetadataService.GetMetadataPackageInfo(e,a)},E.prototype.pickMetadataIndex=function(e,t,a,i){return this.gspMetadataService.pickMetadataIndex(e,this.currentProjectPath,t)},E.prototype.LoadTheMetadata=function(e){if(e){var t=e.fileName,a=e.relativePath;return this.gspMetadataService.LoadMetadataInBo(t,a,this.currentProjectPath)}return new s.Observable},E.prototype.LoadMetadata=function(){if(0<this.metadatas.length){var e=this.metadatas.length;if(!(0<e))return new s.Observable;var t=this.metadatas[e-1].treenode.MetadataInfo.length;if(0<t){var a=this.metadatas[e-1].treenode.MetadataInfo[t-1].FileName,i=this.metadatas[e-1].treenode.MetadataInfo[t-1].RelativePath;return this.gspMetadataService.LoadMetadata(a,i)}}},E.prototype.GetMetadataPackages=function(){return this.gspMetadataService.GetMetadataPackages("packages")},E.prototype.UpdateMetadataProject=function(e){return this.gspMetadataService.UpdateMetadataProject(this.currentProjectPath,e)},E.prototype.getCodeLanguage=function(){return this.gspMetadataService.getCodeLanguage(this.currentProjectPath)},E.prototype.getProcessMode=function(){return this.gspMetadataService.getProcessMode(this.currentProjectPath)},E.prototype.Refresh=function(){var s=this;this.treeData=this.getMetadataClassifier(""),this.treeData[1].items=[],this.GetMetadataProjPath(this.currentProjectPath).subscribe(function(e){s.currentProjectPath=e.projectPath,s.GetMetadataProjectInfo().subscribe(function(e){e.nugetPackageRefs.forEach(function(a){var i={id:a.name,text:a.name,items:[]};s.treeData&&s.treeData[1].items.push(i),s.gspMetadataService.GetDevRootPath().subscribe(function(e){var t=e+s.packRefPath;s.gspMetadataService.GetMetadataPackagesUnderNugetDir(t+"/"+a.name).subscribe(function(e){var t;e&&e.forEach(function(e){t={id:e.header.name,text:e.header.name,desc:e.header.location},i.items.push(t)})})})})})})},E.prototype.getBoPath=function(){return this.gspMetadataService.getBoPath(this.currentProjectPath)},E.decorators=[{type:g.Injectable}],E.ctorParameters=function(){return[{type:v}]},E);function E(e){this.gspMetadataService=e,this.selectedChange=new g.EventEmitter,this.metadatas=[],this.packages=[],this.packRefPath="/packages"}var M=(A.prototype.ngOnInit=function(){var a=this;this.metadataService.GetMetadataProjPath(this.metadataPath).subscribe(function(t){a.metadataService.currentProjectPath=t.projectPath,!0===a.onlyDisplayCurrentProject?(a.files=a.classifier,a.metadataService.selectedChange.emit(a.files[0])):a.gspMetadataService.getMavenSetting().subscribe(function(e){!0===e?a.gspMetadataService.getCodeLanguage(t.projectPath).subscribe(function(e){a.files="java"===e?a.metadataService.getMetadataClassifier("bo"):a.metadataService.getMetadataClassifier("project"),a.metadataService.selectedChange.emit(a.files[0])}):(a.files=a.metadataService.getMetadataClassifier("project"),a.metadataService.selectedChange.emit(a.files[0]))})})},A.prototype.nodeSelect=function(e){this.metadataService.selectedChange.emit(e.dataItem)},A.decorators=[{type:g.Component,args:[{selector:"app-treeclassifier",template:'<div class="templateTree befTree">\r\n    <div class="treeClassifier">\r\n        <kendo-treeview\r\n            [nodes]="files"\r\n            textField="text"\r\n            kendoTreeViewExpandable\r\n            kendoTreeViewSelectable\r\n            kendoTreeViewHierarchyBinding\r\n            childrenField="items"\r\n            (selectionChange)="this.nodeSelect($event)"\r\n            [(selectedKeys)]="this.selectedKeys"\r\n        >\r\n        </kendo-treeview>\r\n    </div>\r\n</div>',styles:[".treeClassifier .k-treeview{overflow:visible}.templateTree{padding:5px;margin-left:5px}"]}]}],A.ctorParameters=function(){return[{type:b},{type:v}]},A.propDecorators={metadataPath:[{type:g.Input}],onlyDisplayCurrentProject:[{type:g.Input}]},A);function A(e,t){this.metadataService=e,this.gspMetadataService=t,this.selectedKeys=["0"],this.classifier=[{id:"project",text:"当前工程"}]}var I=(k.prototype.ngOnInit=function(){},k.prototype.showModal=function(){},k.prototype.hideModal=function(){this.closeModalEmitter.emit()},k.prototype.onHidden=function(){this.closeModalEmitter.emit()},k.prototype.onSelectedChange=function(e){},k.prototype.ResolvePackage=function(){var a=this;if(this.closeModalEmitter.emit(),0<this.metadataService.packages.length){var i=!1,t=this.metadataService.packages[0];this.gspMetaService.GetDevRootPath().subscribe(function(e){a.metadataService.rootPath=e,a.metadataService.GetMetadataPackageInfo(e+a.metadataService.packRefPath,t).subscribe(function(e){var t=e.header;a.metadataService.GetMetadataProjectInfo().subscribe(function(e){e.metadataPackageRefs.forEach(function(e){e.name===t.name&&(alert("已添加对该元数据包的依赖"),i=!0)}),!0!==i&&(a.metadataService.UpdateMetadataProject(t).subscribe(function(e){a.metadataService.treeData=[],a.metadataService.Refresh()}),a.treeclassifierComponent&&(a.treeclassifierComponent.files=a.metadataService.treeData))})})})}},k.decorators=[{type:g.Component,args:[{selector:"app-metadatapackageselect",template:'\x3c!--第二种弹出方法的组件--\x3e\r\n\x3c!-- <div *ngIf="isModalShown" [config]="{ show: true }" (onHidden)="onHidden()" bsModal #autoShownModal="bs-modal" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true" style=\'min-height: 800px; min-width: 900px; max-width: none\'>\r\n    <div class="modal-dialog" style=\'max-width:none; width: 615px;margin-top:0\'>\r\n        <div class="modal-content"> --\x3e\r\n            \x3c!-- <div class="modal-header">\r\n                <h4 class="modal-title pull-left">选择元数据包</h4>\r\n                <button type="button" class="close pull-right" aria-label="Close" (click)="hideModal()">\r\n          <span aria-hidden="true">&times;</span>\r\n        </button>\r\n            </div> --\x3e\r\n            <div class="modal-body">\r\n                <div class="templateBlock">\r\n                    <app-metadatapackagelist></app-metadatapackagelist>\r\n                </div>\r\n            </div>\r\n            <div class="modal-footer">\r\n                <button type="button" class="btn btn-default btn-primary" (click)="ResolvePackage()">确定</button>\r\n                <button type="button" class="btn btn-default" (click)="hideModal()">取消</button>\r\n            </div>\r\n        \x3c!-- </div>\r\n    </div>\r\n</div> --\x3e',styles:[".templateBlock{display:flex}.infoBlock{width:100%;min-width:400px}.infoBlock label{width:50px}"]}]}],k.ctorParameters=function(){return[{type:b},{type:v}]},k.propDecorators={closeModalEmitter:[{type:g.Output}],treeclassifierComponent:[{type:g.ViewChild,args:[M]}]},k);function k(e,t){this.metadataService=e,this.gspMetaService=t,this.closeModalEmitter=new g.EventEmitter}var x=function K(){},T=function W(){},_=(R.prototype.onSelectedMetadataChanged=function(e){this.metadata=e},R.prototype.setCodeLanguage=function(e){this.codelanguage=e},R.prototype.LoadMetadata=function(){var a=this;if(this.metadata&&this.classifier){if("project"===this.classifier.id||"bo"===this.classifier.id)this.loading&&this.loading.show({message:"正在添加引用，请稍候..."}),this.metadataService.LoadTheMetadata(this.metadata).subscribe(function(e){a.loading&&a.loading.close();var t=new x;t.metadata=e,t.metadata.processMode="interpretation"===a.metadata.processMode?"interpretation":"generation",t.packageHeader=new T,a.selectedMetadata.emit(t),a.hideModal()},function(e){a.errorMsg(e),a.loading&&a.loading.close()},function(){a.loading&&a.loading.close()});else if("local"===this.classifier.id){if(!this.metadata.mdPkgName){var e="未找到元数据包信息。";return void gsp.ide.messager.error(e)}this.loading&&this.loading.show({message:"正在添加引用，请稍候..."}),this.metadataService.pickMetadataIndex(1,this.metadata,this.codelanguage,this.isMavenEnable).subscribe(function(e){a.loading&&a.loading.close(),e.metadata.processMode="interpretation"===a.metadata.processMode?"interpretation":"generation",a.selectedMetadata.emit(e),a.hideModal()},function(e){a.errorMsg(e),a.loading&&a.loading.close()},function(){a.loading&&a.loading.close()})}else if("remote"===this.classifier.id){if(!this.metadata.mdPkgName)return e="未找到元数据包信息。",void gsp.ide.messager.error(e);if(!this.metadata.repoPkg||this.metadata.repoPkg.length<1)return e="未找到仓库信息。",void gsp.ide.messager.error(e);this.loading&&this.loading.show({message:"正在添加引用，请稍候..."}),this.metadataService.pickMetadataIndex(2,this.metadata,this.codelanguage,this.isMavenEnable).subscribe(function(e){a.loading&&a.loading.close(),e.metadata.processMode="interpretation"===a.metadata.processMode?"interpretation":"generation",a.selectedMetadata.emit(e),a.hideModal()},function(e){a.errorMsg(e),a.loading&&a.loading.close()},function(){a.loading&&a.loading.close()})}else if("ref"===this.classifier.id){if(!this.metadata.mdPkgName)return e="未找到元数据包信息。",void gsp.ide.messager.error(e);if(!this.metadata.repoPkg||this.metadata.repoPkg.length<1)return e="未找到仓库信息。",void gsp.ide.messager.error(e);this.loading&&this.loading.show({message:"请稍候..."}),this.metadataService.pickMetadataIndex(3,this.metadata,this.codelanguage,this.isMavenEnable).subscribe(function(e){a.loading&&a.loading.close(),e.metadata.processMode="interpretation"===a.metadata.processMode?"interpretation":"generation",a.selectedMetadata.emit(e),a.hideModal()},function(e){a.errorMsg(e),a.loading&&a.loading.close()},function(){a.loading&&a.loading.close()})}}else e="请先选中一个元数据。",gsp.ide.messager.warning(e)},R.prototype.errorMsg=function(e){var t=e.error.Message!==undefined?e.error.Message:e.error.error.message;null==t&&(t="引用元数据失败。"),gsp.ide.messager.error(t)},R.prototype.PackageSelect=function(){this.metadatapackageselectComponent.showModal()},R.prototype.hideModal=function(){this.closeModalEmitter.emit()},R.decorators=[{type:g.Component,args:[{selector:"app-select-metadata",template:'<div class="farris-main-area d-flex flex-column">\r\n  <div class="modal-body d-flex flex-fill flex-column">\r\n    <div class="templateBlock flex-column flex-fill d-flex">\r\n      <kendo-splitter class="d-flex " style="flex: 1 1 auto;" orientation="horizontal">\r\n        <kendo-splitter-pane class="d-flex " [collapsible]="true" size="170px" style="height: auto">\r\n          <app-treeclassifier [metadataPath]="metadataPath" [onlyDisplayCurrentProject]="onlyDisplayCurrentProject"></app-treeclassifier>\r\n        </kendo-splitter-pane>\r\n        <kendo-splitter-pane class="d-flex" style="height: auto">\r\n          <app-metadatalist [typeName]="typeName" [filter]="filter" [isMavenEnable]="isMavenEnable" (technologyStack)="setCodeLanguage($event)"\r\n            (selectedMetadataChanged)="this.onSelectedMetadataChanged($event)"></app-metadatalist>\r\n        </kendo-splitter-pane>\r\n      </kendo-splitter>\r\n    </div>\r\n  </div>\r\n  <div class="modal-footer">\r\n    <button type="button" click.once class="btn btn-outline-primary btn-sm px-3 mx-2"\r\n      (click.once)="LoadMetadata()">确定</button>\r\n    <button type="button" class="btn btn-outline-secondary btn-sm px-3 mx-2" (click)="hideModal()">取消</button>\r\n  </div>\r\n</div>\r\n',styles:[".templateBlock{display:flex}.infoBlock{width:100%;min-width:400px}.infoBlock label{width:50px}"]}]}],R.ctorParameters=function(){return[{type:b},{type:p.LoadingService},{type:v}]},R.propDecorators={metadatapackageselectComponent:[{type:g.ViewChild,args:[I]}],metadataPath:[{type:g.Input}],typeName:[{type:g.Input}],filter:[{type:g.Input}],onlyDisplayCurrentProject:[{type:g.Input}],closeModalEmitter:[{type:g.Output}],selectedMetadata:[{type:g.Output}]},R);function R(e,t,a){var i=this;this.metadataService=e,this.loading=t,this.gspMetaService=a,this.selectedMetadata=new g.EventEmitter,this.closeModalEmitter=new g.EventEmitter,this.metadataService.selectedChange.subscribe(function(e){i.classifier=e}),this.isMavenEnable=!1,this.gspMetaService.getMavenSetting().subscribe(function(e){i.isMavenEnable=e})}var w=(C.prototype.clear=function(){this.data=[],this.selectionChanged(null,[]),this.page={pageIndex:this.initPageIndex,pageSize:this.initPageSize}},C.prototype.dataStateChange=function(e){this.state=e},C.prototype.ngOnDestroy=function(){var e,t;if(this.subscriptions&&0<this.subscriptions.length)try{for(var a=function s(e){var t="function"==typeof Symbol&&e[Symbol.iterator],a=0;return t?t.call(e):{next:function(){return e&&a>=e.length&&(e=void 0),{value:e&&e[a++],done:!e}}}}(this.subscriptions),i=a.next();!i.done;i=a.next())i.value.unsubscribe()}catch(n){e={error:n}}finally{try{i&&!i.done&&(t=a["return"])&&t.call(a)}finally{if(e)throw e.error}}},C.prototype.initNugetSourceList=function(){var t=this;1===this.sourceList.length&&this.gspMetaService.getNugetSourceList().subscribe(function(e){e.forEach(function(e){t.sourceList.push({text:e.name,value:e.name})})})},C.prototype.initMavenSourceList=function(){var t=this;1===this.sourceList.length&&this.gspMetaService.getMavenSourceList().subscribe(function(e){e.repoList&&e.repoList.forEach(function(e){t.sourceList.push({text:e.id,value:e.id})})})},C.prototype.onSearchTextChanged=function(){this.searchText||(this.searchText="");var e=this.searchText.trim();this.searchTextForDup!==e&&(this.searchTextForDup=e,console.log(this.searchText),this.searchTextSub.next(e))},C.prototype.GetMetadataList=function(){var i=this,s=[];this.loading=!0,this.metadataService.GetMetadataList(this.postfixSelected).subscribe(function(e){if(i.loading=!1,!e)return i.gridData=i.data,void gsp.ide.messager.error("error to get response");for(var t=0;t<e.length;t++){var a=e[t];(!i.searchText||-1<a.code.indexOf(i.searchText)||-1<a.name.indexOf(i.searchText))&&s.push(a)}0<s.length&&i.onSelectionChangedInternal(s[0],[0]),i.hasNext=!1,i.data=s,i.gridData=i.data},function(e){i.data=s,i.gridData=i.data,i.loading=!1;var t=e.error.Message!==undefined?e.error.Message:e.error.error.message;gsp.ide.messager.error("Get Metadatas Error:"+t)})},C.prototype.GetMetadataListInBo=function(){var i=this,s=[];this.loading=!0,this.metadataService.GetMetadataListInBo(this.postfixSelected).subscribe(function(e){if(i.loading=!1,!e)return i.gridData=i.data,void gsp.ide.messager.error("error to get response");for(var t=0;t<e.length;t++){var a=e[t];(!i.searchText||-1<a.projectName.toLowerCase().indexOf(i.searchText.toLowerCase())||-1<a.code.toLowerCase().indexOf(i.searchText.toLowerCase())||-1<a.name.toLowerCase().indexOf(i.searchText.toLowerCase()))&&s.push(a)}0<s.length&&i.onSelectionChangedInternal(s[0],[0]),i.hasNext=!1,i.data=s,i.gridData=i.data},function(e){i.data=s,i.gridData=i.data,i.loading=!1;var t=e.error.Message!==undefined?e.error.Message:e.error.error.message;gsp.ide.messager.error("Get Metadatas Error:"+t)})},C.prototype.GetLocalMetadataList=function(a){var i=this;void 0===a&&(a=!0);var s=[];this.loading=!0,this.metadataService.GetMetadataInfos(this.scope,this.codelanguage,this.isMavenEnable,this.postfixSelected,this.searchText,this.page).subscribe(function(e){if(i.loading=!1,e){e.page?(e.page.pageSize<i.initPageSize?i.hasNext=!1:i.hasNext=!0,i.page.pageSize=e.page.pageSize,i.page.pageIndex=e.page.pageIndex):i.hasNext=!1;var t=e.metadataIndexItems;if(!t||t.length<1)return i.mySelection=[],void(i.gridData=i.data);t.forEach(function(e){e.repoPkg&&0<e.repoPkg.length&&(e.nugetPkgName=e.repoPkg[0].name,e.nugetPkgVersion=e.repoPkg[0].version),s.push(e)}),a?(i.onSelectionChangedInternal(s[0],[0]),i.data=s):s.forEach(function(e){i.data.push(e)}),i.gridData=i.data}else gsp.ide.messager.error("error to get metadata infos")},function(e){i.data=s,i.gridData=i.data,i.loading=!1;var t=e.error.Message!==undefined?e.error.Message:e.error.error.message;gsp.ide.messager.error("Metadata req failed: "+t)})},C.prototype.showOnlyBeveragesDetails=function(e,t){return e.repoPkg&&1<e.repoPkg.length},C.prototype.getRemoteMetadataList=function(a){var i=this,s=[];this.loading=!0,this.metadataService.GetMetadataInfos(this.scope,this.codelanguage,this.isMavenEnable,this.postfixSelected,this.searchText,this.page,this.selectedSource.value).subscribe(function(e){if(i.loading=!1,e){e.page?(e.page.pageSize<i.initPageSize?i.hasNext=!1:i.hasNext=!0,i.page.pageSize=e.page.pageSize,i.page.pageIndex=e.page.pageIndex):i.hasNext=!1;var t=e.metadataIndexItems;if(!t||t.length<1)return i.mySelection=[],void(i.gridData=i.data);if(t.forEach(function(e){!e.repoPkg||e.repoPkg.length<1||("dotnet"===i.codelanguage||!1===i.isMavenEnable?(e.repoPkg.sort(i.compareNuget("version")),e.nugetPkgName=e.repoPkg[0].name,e.nugetPkgVersion=e.repoPkg[0].version):(e.repoPkg.sort(i.compare("version")),e.groupId=e.repoPkg[0].groupId,e.artifactId=e.repoPkg[0].artifactId,e.mavenPkgVersion=e.repoPkg[0].version),s.push(e))}),!s||s.length<1)return i.mySelection=[],void(i.gridData=i.data);a?(i.onSelectionChangedInternal(s[0],[0]),i.data=s):s.forEach(function(e){i.data.push(e)}),i.gridData=i.data}else gsp.ide.messager.error("error to get metadata infos")},function(e){i.data=s,i.gridData=i.data,i.loading=!1;var t=e.error.Message!==undefined?e.error.Message:e.error.error.message;gsp.ide.messager.error("Metadata req failed: "+t)})},C.prototype.compare=function(p){return function(e,t){var a=e[p],i=t[p],s=a.split("."),n=i.split("."),r=s[0].substr(1),o=n[0].substr(1);if(Number(r)<Number(o))return 1;if(Number(r)>Number(o))return-1;if(Number(s[1])<Number(n[1]))return 1;if(Number(s[1])>Number(n[1]))return-1;var d=s[2].replace("-SNAPSHOT",""),c=n[2].replace("-SNAPSHOT","");return Number(d)<Number(c)||!(Number(d)>Number(c))&&0<s[2].indexOf("-SNAPSHOT")?1:-1}},C.prototype.compareNuget=function(p){return function(e,t){var a=e[p],i=t[p],s=a.split("."),n=i.split("."),r=s[0],o=n[0];if(Number(r)<Number(o))return-1;if(Number(r)>Number(o))return 1;if(Number(s[1])<Number(n[1]))return 1;if(Number(s[1])>Number(n[1]))return-1;var d=s[2],c=n[2];if(0<d.indexOf("alpha")){if(d<c)return 1;if(c<d)return-1}else{if(Number(d)<Number(c))return 1;if(Number(d)>Number(c))return-1}}},C.prototype.scopeChanged=function(e){this.classifier=e,this.getData()},C.prototype.getData=function(){if(this.classifier){this.reload&&this.clear();var e=this.reload;"project"===this.classifier.id?(this.scope=0,this.GetMetadataList()):"bo"===this.classifier.id?(this.scope=0,this.GetMetadataListInBo()):"ref"===this.classifier.id?(this.scope=3,this.getRemoteMetadataList(e)):"remote"===this.classifier.id?(this.scope=2,this.getRemoteMetadataList(e)):"local"===this.classifier.id&&(this.scope=1,this.GetLocalMetadataList(e)),this.reload=!0}},C.prototype.onSelectionChange=function(e){if(e&&e.selectedRows&&0<e.selectedRows.length){var t=e.selectedRows[0].dataItem;this.onSelectionChangedInternal(t,[e.selectedRows[0].index])}},C.prototype.onSelectionChangedInternal=function(e,t){var a=this.makeNewData(e);2!==this.scope&&3!==this.scope||a.repoPkg.push(e.repoPkg[0]),this.selectionChanged(a,t)},C.prototype.selectionChanged=function(e,t){void 0===t&&(t=[]),this.selectedMetadataChanged.emit(e),this.mySelection=t},C.prototype.makeNewData=function(e){return{mdPkgName:e.mdPkgName,repoPkg:[],id:e.id,nameSpace:e.nameSpace,code:e.code,name:e.name,fileName:e.fileName,type:e.type,bizobjectID:e.bizobjectID,language:e.language,isTranslating:e.isTranslating,relativePath:e.relativePath,extendProperty:e.extendProperty,processMode:e.processMode}},C.prototype.onSelectedPkgChanged=function(e){if(e&&e.repoPkg&&0<e.repoPkg.length){var t=this.makeNewData(e);e.selectedPkg?t.repoPkg.push(e.selectedPkg):t.repoPkg.push(e.repoPkg[0]),this.selectionChanged(t,[])}},C.prototype.goSearch=function(){this.searchText||(this.searchText=""),console.log("搜索");var e=this.searchText.trim();this.searchText&&this.searchTextForDup===e||(this.searchTextForDup=e,console.log(this.searchText),this.searchText=e,console.log("search for "+this.searchText),this.getData())},C.prototype.goNext=function(){console.log("下一页"),this.page.pageIndex=this.page.pageIndex+1,this.reload=!1,this.getData()},C.prototype.onConflictAvoidFlagChanged=function(){console.log("ConflictAvoidFlag "+this.conflictAvoidFlag),this.getData()},C.prototype.typeSelectedChanged=function(e){(e=e||this.selectedType)&&(e.value===this.allType.value?this.postfixSelected=this.postfix:this.postfixSelected=e.value,this.getData())},C.prototype.sourceSelectedChanged=function(e){e=e||this.selectedSource,this.selectedSource=e,this.getData()},C.decorators=[{type:g.Component,args:[{selector:"app-metadatalist",template:'<div class="templateInfo farris-main-area flex-column">\r\n  <div class="templateSelectorHeader m-2">\r\n    <div class="searchArea d-flex flex-row">\r\n\r\n      <input id="url" class="textInput flex-fill" type="text" size="30" kendoTextBox [(ngModel)]="this.searchText"\r\n        #url="ngModel" required (ngModelChange)="onSearchTextChanged()">\r\n      <button type="button" class="btn btn-light btn-sm px-3 mx-2"\r\n          (click)="goSearch()">搜索</button>\r\n\r\n      \x3c!-- <div class="conflictAvoidFlag" *ngIf="this.scope === 2">\r\n        <input type="checkbox" class="form-check-input" id="check1"\r\n          [(ngModel)]="this.conflictAvoidFlag" (ngModelChange)="this.onConflictAvoidFlagChanged()">\r\n        <label class="form-check-label text-label" for="check1">避免冲突</label>\r\n      </div> --\x3e\r\n\r\n      <kendo-combobox class="mx-2" [allowCustom]="allowCustom" *ngIf="this.scope === 2 || this.scope === 3" [data]="sourceList" \r\n        [textField]="\'text\'" [valueField]="\'value\'" [(ngModel)]="this.selectedSource" \r\n        (selectionChange)="sourceSelectedChanged($event)" [popupSettings]="popupSettings">\r\n      </kendo-combobox>\r\n\r\n      <kendo-combobox [readonly]="this.typeListReadonly" [data]="typeList" [(ngModel)]="selectedType"\r\n        [textField]="\'text\'" [valueField]="\'value\'"  (selectionChange)="typeSelectedChanged($event)">\r\n      </kendo-combobox>\r\n    </div>\r\n  </div>\r\n  <div class="templateSelector flex-fill d-flex flex-column">\r\n    <kendo-grid class="flex-fill"\r\n                [data]="gridData"\r\n                [selectable]="selectableSetting" \r\n                (selectionChange)=onSelectionChange($event)\r\n                [sortable]="true"\r\n                [pageable]="false"\r\n                [filterable]="false"\r\n                [resizable]="true"\r\n                [loading]="this.loading"\r\n                [rowSelected]="rowSelected">\r\n      <kendo-grid-column [width]="190" *ngIf="(this.scope === 0 && this.classifier.id === \'bo\') && (this.isMavenEnable === true && this.codelanguage === java)" field="projectName" title="工程名称">\r\n      </kendo-grid-column>\r\n      <kendo-grid-column [width]="150" field="code" title="编号">\r\n      </kendo-grid-column>\r\n      <kendo-grid-column [width]="150" field="name" title="名称">\r\n      </kendo-grid-column>\r\n      <kendo-grid-column field="type" [width]="130" title="类型">\r\n      </kendo-grid-column>\r\n      <kendo-grid-column [width]="190" *ngIf="this.scope === 1 || this.scope === 2 || this.scope === 3" field="mdPkgName"\r\n        title="元数据包">\r\n      </kendo-grid-column>\r\n      <kendo-grid-column [width]="190" *ngIf="(this.scope === 2 || this.scope === 3) && (this.isMavenEnable === false || this.codelanguage === dotnet)" field="nugetPkgName" title="所属Nuget包">\r\n      </kendo-grid-column>\r\n      <kendo-grid-column [width]="190" *ngIf="(this.scope === 2 || this.scope === 3) && (this.isMavenEnable === false || this.codelanguage === dotnet)" field="nugetPkgVersion" title="所属Nuget包版本">\r\n      </kendo-grid-column>\r\n      <kendo-grid-column [width]="190" *ngIf="(this.scope === 2 || this.scope === 3) && (this.isMavenEnable === true && this.codelanguage === java)" field="groupId" title="所属Maven包GroupId">\r\n      </kendo-grid-column>\r\n      <kendo-grid-column [width]="190" *ngIf="(this.scope === 2 || this.scope === 3) && (this.isMavenEnable === true && this.codelanguage === java)" field="artifactId" title="所属Maven包ArtifactId">\r\n      </kendo-grid-column>\r\n      <kendo-grid-column [width]="190" *ngIf="(this.scope === 2 || this.scope === 3) && (this.isMavenEnable === true && this.codelanguage === java)" field="mavenPkgVersion" title="所属Maven包版本">\r\n      </kendo-grid-column>\r\n\r\n      <ng-template kendoGridDetailTemplate let-dataItem [kendoGridDetailTemplateShowIf]="showOnlyBeveragesDetails">\r\n        <lib-metadatalistdetails (selectedPkgChanged)="this.onSelectedPkgChanged($event)" [isMavenEnable]="isMavenEnable" [mdItem]="dataItem" [codelanguage]="codelanguage">\r\n        </lib-metadatalistdetails>\r\n      </ng-template>\r\n\r\n    </kendo-grid>\r\n  </div>\r\n  <div *ngIf="this.hasNext && !this.loading" class="model-footer">\r\n    <button type="button" class="btn btn-link btn-sm" (click)="goNext()">加载更多</button>\r\n  </div>\r\n  <div *ngIf="this.loading" class="model-footer">\r\n    <label class="text-label">加载中...</label>\r\n  </div>\r\n  <div *ngIf="!this.hasNext && !this.loading" class="model-footer">\r\n    <label class="text-label">已经到底了</label>\r\n  </div>\r\n</div>',styles:[".templateSelector{overflow-y:hidden;overflow-x:auto}.templateInfo{display:flex;overflow:hidden}.conflictAvoidFlag{margin-left:25px;align-content:baseline;margin-top:1px;margin-right:3px;min-width:65px}.scope1{min-width:800px}.scope2{min-width:1000px}.text-label{margin-top:1.3px}"]}]}],C.ctorParameters=function(){return[{type:b},{type:v}]},C.propDecorators={isMavenEnable:[{type:g.Input}],technologyStack:[{type:g.Output}],typeName:[{type:g.Input}],filter:[{type:g.Input}],selectedMetadataChanged:[{type:g.Output}]},C);function C(e,t){var i=this;this.metadataService=e,this.gspMetaService=t,this.subscriptions=[],this.dotnet="dotnet",this.java="java",this.technologyStack=new g.EventEmitter,this.loading=!1,this.selectedMetadataChanged=new g.EventEmitter,this.allSource={text:"全选",value:"All"},this.selectedSource=this.allSource,this.sourceList=[this.allSource],this.popupSettings={width:"auto"},this.allowCustom=!0,this.allType={text:"全选",value:"All"},this.selectedType=this.allType,this.typeList=[this.allType],this.postfixSelected="",this.initPageIndex=0,this.initPageSize=10,this.page={pageIndex:this.initPageIndex,pageSize:this.initPageSize},this.typeListReadonly=!1,this.hasNext=!0,this.searchText="",this.searchTextForDup="",this.searchTextSub=new h.Subject,this.postfix="",this.postfixFlag=!0,this.scope=0,this.conflictAvoidFlag=!1,this.reload=!0,this.mySelection=[],this.state={skip:0,take:9999,filter:{logic:"and",filters:[]}},this.selectableSetting={mode:"single",checkboxOnly:!1},this.rowSelected=function(e){return 0<=i.mySelection.indexOf(e.index)},this.classifier={id:""},this.searchTextSub.pipe(l.debounceTime(2048),l.distinctUntilChanged()).subscribe(function(e){i.searchText=e.trim(),console.log("search for "+i.searchText),i.getData()});var a=this.metadataService.selectedChange.subscribe(function(t){i.classifier&&t&&i.classifier.id===t.id||(i.postfixFlag?i.gspMetaService.GetMetadataTypeList().subscribe(function(e){var a=0;e.forEach(function(t){i.postfixFlag=!1,i.typeName.split(",").forEach(function(e){e.toLowerCase()===t.typeCode.toLowerCase()&&(i.postfix=i.postfix+t.postfix+",",i.typeList.push({text:t.typeName,value:t.postfix}),a++)})}),1===a&&(i.typeList.shift(),i.selectedType=i.typeList[0],i.typeListReadonly=!0),i.postfixSelected=i.postfix,i.scopeChanged(t)},function(e){var t=e.error.Message!==undefined?e.error.Message:e.error.error.message;gsp.ide.messager.error("Fetch Metadata Type error:"+t)}):i.scopeChanged(t),i.metadataService.getCodeLanguage().subscribe(function(e){e?-1<e.indexOf(";")?i.gspMetaService.getSettingInfo().subscribe(function(e){e&&e.technologyStack?(i.codelanguage=e.technologyStack,i.technologyStack.emit(i.codelanguage),"ref"!==t.id&&"remote"!==t.id||("dotnet"===i.codelanguage||!1===i.isMavenEnable?i.initNugetSourceList():i.initMavenSourceList())):!0===i.isMavenEnable?(i.codelanguage="java",i.technologyStack.emit(i.codelanguage),"ref"!==t.id&&"remote"!==t.id||i.initMavenSourceList()):(i.codelanguage="dotnet",i.technologyStack.emit(i.codelanguage),"ref"!==t.id&&"remote"!==t.id||i.initNugetSourceList())}):(i.codelanguage=e,i.technologyStack.emit(i.codelanguage),"ref"!==t.id&&"remote"!==t.id||("dotnet"===i.codelanguage||!1===i.isMavenEnable?i.initNugetSourceList():i.initMavenSourceList())):i.gspMetaService.getSettingInfo().subscribe(function(e){e&&e.technologyStack?(i.codelanguage=e.technologyStack,i.technologyStack.emit(i.codelanguage),"ref"!==t.id&&"remote"!==t.id||("dotnet"===i.codelanguage||!1===i.isMavenEnable?i.initNugetSourceList():i.initMavenSourceList())):!0===i.isMavenEnable?(i.codelanguage="java",i.technologyStack.emit(i.codelanguage),"ref"!==t.id&&"remote"!==t.id||i.initMavenSourceList()):(i.codelanguage="dotnet",i.technologyStack.emit(i.codelanguage),"ref"!==t.id&&"remote"!==t.id||i.initNugetSourceList())})}),i.metadataService.getProcessMode().subscribe(function(e){i.processMode=e}))});this.subscriptions.push(a)}var D=(H.prototype.dataStateChange=function(e){this.state=e,this.gridData=d.process(this.data,this.state)},H.prototype.ngOnInit=function(){var a=this;this.metadataService.GetMetadataPackages().subscribe(function(e){var t=[];a.packagesInfo=e,a.packagesInfo&&(a.packagesInfo.forEach(function(e){("folder"===e.type||"file"===e.type&&e.name.endsWith("mdpkg"))&&t.push({name:e.name})}),a.data=t,a.gridData=d.process(a.data,a.state))})},H.prototype.onSelectionChange=function(e){var t=e.selectedRows[0].dataItem.name;this.metadataService.clearPackage(),this.metadataService.addPackage(t)},H.decorators=[{type:g.Component,args:[{selector:"app-metadatapackagelist",template:'<div class="templateInfo">\r\n  <div class="templateSelector">\r\n    <kendo-grid [data]="gridData" \r\n                [selectable]="selectableSetting" \r\n                (selectionChange)=onSelectionChange($event)\r\n                [pageSize]="state.take"\r\n                [skip]="state.skip"\r\n                [sort]="state.sort"\r\n                [filter]="state.filter"\r\n                [sortable]="true"\r\n                [pageable]="false"\r\n                [filterable]="true"\r\n                (dataStateChange)=dataStateChange($event)>\r\n      <kendo-grid-column field="name" title="包名称" width="200">\r\n      </kendo-grid-column>\r\n    </kendo-grid>\r\n  </div>\r\n</div>',styles:[".templateSelector{width:580px;height:450px;border:.5px solid #ddd}.templateDescription{width:200px;height:450px;border:.5px solid #ddd}.templateInfo{display:flex}"]}]}],H.ctorParameters=function(){return[{type:b}]},H);function H(e){this.metadataService=e,this.state={skip:0,take:9999,filter:{logic:"and",filters:[]}},this.selectableSetting={mode:"single",checkboxOnly:!1}}var j=(N.prototype.ngOnInit=function(){this.mdItem&&this.mdItem.repoPkg&&(this.dataItem=this.mdItem.repoPkg,this.detailView={data:this.dataItem.slice(this.detailSkip,this.detailSkip+this.pageSize),total:this.dataItem.length})},N.prototype.detailPageChange=function(e){var t=e.skip,a=e.take;this.detailSkip=t,this.detailView={data:this.dataItem.slice(this.detailSkip,this.detailSkip+a),total:this.dataItem.length}},N.prototype.onSelectedPkgChanged=function(e){console.log(e),this.mdItem.selectedPkg=e.selectedRows[0].dataItem,this.selectedPkgChanged.emit(this.mdItem)},N.decorators=[{type:g.Component,args:[{selector:"lib-metadatalistdetails",template:'<div class="gridDetails">\r\n  <kendo-grid\r\n    [data]="detailView"\r\n    [pageSize]="5"\r\n    [skip]="detailSkip"\r\n    [pageable]="true"\r\n    [scrollable]="\'none\'"\r\n    [selectable]="this.selectableSetting"\r\n    (selectionChange)=onSelectedPkgChanged($event)\r\n    (pageChange)="detailPageChange($event)"\r\n    [navigable]="true"\r\n    kendoGridFocusable>\r\n    <kendo-grid-column field="name" *ngIf="this.isMavenEnable === false || this.codelanguage === dotnet" title="Nuget名称" width="120">\r\n    </kendo-grid-column>\r\n    <kendo-grid-column field="version" *ngIf="this.isMavenEnable === false || this.codelanguage === dotnet" title="Nuget版本" width="120">\r\n    </kendo-grid-column>\r\n    <kendo-grid-column field="groupId" *ngIf="this.isMavenEnable === true && this.codelanguage === java" title="GroupId" width="120">\r\n    </kendo-grid-column>\r\n    <kendo-grid-column field="artifactId" *ngIf="this.isMavenEnable === true && this.codelanguage === java" title="ArtifactId" width="120">\r\n    </kendo-grid-column>\r\n    <kendo-grid-column field="version" *ngIf="this.isMavenEnable === true && this.codelanguage === java" title="Maven版本" width="120">\r\n    </kendo-grid-column>\r\n  </kendo-grid>\r\n</div>\r\n',styles:[""]}]}],N.ctorParameters=function(){return[]},N.propDecorators={isMavenEnable:[{type:g.Input}],mdItem:[{type:g.Input}],selectedPkgChanged:[{type:g.Output}],codelanguage:[{type:g.Input}]},N);function N(){this.selectableSetting={mode:"single",checkboxOnly:!1},this.dotnet="dotnet",this.java="java",this.detailSkip=0,this.pageSize=5,this.selectedPkgChanged=new g.EventEmitter,this.dataItem=[]}var B=(L.prototype.ngOnInit=function(){var t=this;this.subscription=this.$sub.pipe(l.throttleTime(this.duration)).subscribe(function(e){t.clickCall.emit(e)})},L.prototype.clickEvent=function(e){e.preventDefault(),e.stopPropagation(),this.$sub.next(e)},L.prototype.ngOnDestroy=function(){this.subscription.unsubscribe()},L.decorators=[{type:g.Directive,args:[{selector:"[click.once]"}]}],L.ctorParameters=function(){return[{type:g.Renderer2},{type:g.ElementRef}]},L.propDecorators={clickCall:[{type:g.Output,args:["click.once"]}],duration:[{type:g.Input}],clickEvent:[{type:g.HostListener,args:["click",["$event"]]}]},L);function L(e,t){this.renderer=e,this.element=t,this.clickCall=new g.EventEmitter,this.duration=1e3,this.$sub=new h.Subject}var V=(G.decorators=[{type:g.NgModule,args:[{imports:[t.CommonModule,a.FormsModule,i.TreeViewModule,n.GridModule,o.LayoutModule,r.FarrisDialogModule,c.DropDownsModule,p.LoadingModule.forRoot()],exports:[_],providers:[b],declarations:[_,M,w,I,D,j,B],entryComponents:[_,I]}]}],G.ctorParameters=function(){return[]},G);function G(){}function O(e,t){return new v(e,t)}var F=(z.forRoot=function(e){return{ngModule:z,providers:[{provide:"url",useValue:e},{provide:v,useFactory:O,deps:[u.HttpClient,"url"]}]}},z.decorators=[{type:g.NgModule,args:[{exports:[],providers:[]}]}],z);function z(){}var J=window.top.gsp;window.gsp||(window.gsp=new f.GSP(J));var q=function Q(e,t,a,i,s,n,r,o,d,c,p){this.id=e,this.nameSpace=t,this.code=a,this.name=i,this.fileName=s,this.type=n,this.bizobjectID=r,this.relativePath=o,this.extendProperty=d,this.content=c,this.extendable=p},U=function X(e,t,a,i,s,n,r){this.packageName=e,this.projectName=a,this.projectPath=t,this.projectNameSpace=i,this.depPackageName=s,this.depPackageVersion=n,this.depPackageLocation=r};e.MetadataSelectModule=V,e.SelectMetadataComponent=_,e.GSPMetadataService=v,e.GSPMetadataServiceModule=F,e.MetadataDto=q,e.Metadata4RefDto=x,e.MetadataPackageDto=m,e.MetadataProjectDto=U,e.ɵe=w,e.ɵg=j,e.ɵf=D,e.ɵb=I,e.ɵh=B,e.ɵc=M,e.ɵd=b,e.ɵa=O,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=gsp-lcm-metadata-selector.umd.min.js.map
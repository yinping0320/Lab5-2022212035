/**
 * @fileoverview added by tsickle
 * Generated from: lib/views/bo-creator/modal/app-modal/app-creator-modal.component.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Output, EventEmitter } from '@angular/core';
import { NotifyService } from '@farris/ui-notify';
import { BusinessObjectEntity, BusinessObjectDtService } from '@gsp-lcm/bo-dt-service';
import { ValidatorResult } from '../../common/validation-result';
import { BoCreatorUtils } from '../../utils/bo-create-utils';
var AppCreatorModalComponent = /** @class */ (function () {
    function AppCreatorModalComponent(boCreatorUtils, boDtService, notifyService) {
        this.boCreatorUtils = boCreatorUtils;
        this.boDtService = boDtService;
        this.notifyService = notifyService;
        this.appConfirmEmitter = new EventEmitter();
        this.currentBo = new BusinessObjectEntity();
        this.apps = [];
    }
    /**
     * @return {?}
     */
    AppCreatorModalComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        this.initData();
    };
    /**
     * @private
     * @return {?}
     */
    AppCreatorModalComponent.prototype.initData = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        this.boDtService.getBusinessObjects().subscribe((/**
         * @param {?} data
         * @return {?}
         */
        function (data) {
            if (!data) {
                return;
            }
            //二级节点是APP
            _this.apps = data.filter((/**
             * @param {?} x
             * @return {?}
             */
            function (x) { return x.layer === 2; }));
            //一级节点是产品，目前默认一级节点（根节点）只有一个
            _this.parent = data.find((/**
             * @param {?} x
             * @return {?}
             */
            function (x) { return x.layer === 1; }));
        }));
    };
    /**
     * @return {?}
     */
    AppCreatorModalComponent.prototype.create = /**
     * @return {?}
     */
    function () {
        var _this = this;
        /** @type {?} */
        var bo = this.getCurrentBo();
        if (!bo) {
            return;
        }
        this.boDtService.save(bo).subscribe((/**
         * @return {?}
         */
        function () {
            _this.appConfirmEmitter.emit(bo);
        }), (/**
         * @param {?} error
         * @return {?}
         */
        function (error) {
            _this.notifyService.error('创建失败');
            throw error;
        }));
    };
    /**
     * @return {?}
     */
    AppCreatorModalComponent.prototype.getCurrentBo = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var result = this.appInfoValidator();
        if (result.illegal) {
            this.notifyService.warning(result.message);
            return null;
        }
        this.currentBo.id = this.boCreatorUtils.newGuid();
        this.currentBo.layer = 2;
        this.currentBo.parentID = this.parent.id;
        this.currentBo.sysInit = '0';
        this.currentBo.isSysInit = false;
        this.currentBo.isDetail = '0';
        /** @type {?} */
        var max = this.boCreatorUtils.getMaxOrder(this.apps, this.currentBo.parentID);
        this.currentBo.sortOrder = max + 1;
        return Object.assign(new BusinessObjectEntity(), this.currentBo);
    };
    /**
     * @return {?}
     */
    AppCreatorModalComponent.prototype.appInfoValidator = /**
     * @return {?}
     */
    function () {
        //新增信息空校验
        /** @type {?} */
        var result = this.emptyValidator();
        if (result.illegal) {
            return result;
        }
        //编号，名称命名规范性校验
        result = this.namingConventionValidator();
        if (result.illegal) {
            return result;
        }
        //APP编号重复校验
        return this.repeatValidator();
    };
    /**
     * @return {?}
     */
    AppCreatorModalComponent.prototype.emptyValidator = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var result = new ValidatorResult();
        if (!this.currentBo.code) {
            result.illegal = true;
            result.message = "\u5173\u952E\u5E94\u7528\u7684\u7F16\u53F7\u4E0D\u80FD\u4E3A\u7A7A";
            return result;
        }
        if (!this.currentBo.name) {
            result.illegal = true;
            result.message = "\u5173\u952E\u5E94\u7528\u7684\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A";
            return result;
        }
        return result;
    };
    /**
     * @return {?}
     */
    AppCreatorModalComponent.prototype.namingConventionValidator = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var result = new ValidatorResult();
        /** @type {?} */
        var codeRegx = new RegExp('^[a-zA-Z\x7f-\xff][a-zA-Z0-9\x7f-\xff]*$');
        if (!codeRegx.test(this.currentBo.code)) {
            result.illegal = true;
            result.message = '关键应用的编号只能包含字母,数字,并且不可以用数字开头!';
            return result;
        }
        /** @type {?} */
        var nameRegx = new RegExp('[`~!@#$^&*()=|{}\':;\',\\[\\].<>/?~！@#￥……&*（）——|{}【】‘；：”“\'。，、？]');
        if (nameRegx.test(this.currentBo.name)) {
            result.illegal = true;
            result.message = '关键应用的名称包含非法字符，请重新输入!';
            return result;
        }
        return result;
    };
    /**
     * @return {?}
     */
    AppCreatorModalComponent.prototype.repeatValidator = /**
     * @return {?}
     */
    function () {
        var _this = this;
        /** @type {?} */
        var result = new ValidatorResult();
        /** @type {?} */
        var filterApp = this.apps.find((/**
         * @param {?} x
         * @return {?}
         */
        function (x) { return x.code.toLowerCase() === _this.currentBo.code.toLowerCase(); }));
        if (filterApp) {
            result.illegal = true;
            result.message = "\u5173\u952E\u5E94\u7528\u7684\u7F16\u53F7" + this.currentBo.code + "\u5DF2\u5B58\u5728";
            return result;
        }
        return result;
    };
    AppCreatorModalComponent.decorators = [
        { type: Component, args: [{
                    selector: 'app-app-creator-modal',
                    template: "\r\n<div class=\"cloumn\" style=\"margin-top: 28px;\">\r\n\r\n  <div class=\"app-Info row\">\r\n    <label class=\"col-form-label ps-col-form-label\">\r\n      <span class=\"farris-label-info text-danger\">*</span>\r\n      <span class=\"farris-label-text\">\u5E94\u7528\u7F16\u53F7</span>\r\n    </label>\r\n    <div class=\"col-9\">\r\n      <input-group [(ngModel)]=\"currentBo.code\"  autocomplete=\"off\" name=\"code\" ></input-group>\r\n    </div>\r\n  </div>\r\n\r\n  <div class=\"app-Info row\">\r\n    <label class=\"col-form-label ps-col-form-label\">\r\n      <span class=\"farris-label-info text-danger\">*</span>\r\n      <span class=\"farris-label-text\">\u5E94\u7528\u540D\u79F0</span>\r\n    </label>\r\n    <div class=\"col-9\">\r\n      <input-group [(ngModel)]=\"currentBo.name\"  autocomplete=\"off\" name=\"name\" ></input-group>\r\n    </div>\r\n  </div>\r\n\r\n  <div class=\"app-Info row\">\r\n    <label class=\"col-form-label ps-col-form-label\">\r\n      <span class=\"farris-label-text\">\u5E94\u7528\u63CF\u8FF0</span>\r\n    </label>\r\n    <div class=\"col-9\">\r\n      <input-group [(ngModel)]=\"currentBo.description\"  autocomplete=\"off\" name=\"description\"></input-group>\r\n    </div>\r\n  </div>\r\n\r\n</div>",
                    styles: [".app-Info{margin:0 0 16px 20px}div .ps-col-form-label{width:94px;text-align:right}"]
                }] }
    ];
    /** @nocollapse */
    AppCreatorModalComponent.ctorParameters = function () { return [
        { type: BoCreatorUtils },
        { type: BusinessObjectDtService },
        { type: NotifyService }
    ]; };
    AppCreatorModalComponent.propDecorators = {
        appConfirmEmitter: [{ type: Output }]
    };
    return AppCreatorModalComponent;
}());
export { AppCreatorModalComponent };
if (false) {
    /** @type {?} */
    AppCreatorModalComponent.prototype.appConfirmEmitter;
    /** @type {?} */
    AppCreatorModalComponent.prototype.currentBo;
    /** @type {?} */
    AppCreatorModalComponent.prototype.parent;
    /** @type {?} */
    AppCreatorModalComponent.prototype.apps;
    /**
     * @type {?}
     * @private
     */
    AppCreatorModalComponent.prototype.boCreatorUtils;
    /**
     * @type {?}
     * @private
     */
    AppCreatorModalComponent.prototype.boDtService;
    /**
     * @type {?}
     * @private
     */
    AppCreatorModalComponent.prototype.notifyService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXBwLWNyZWF0b3ItbW9kYWwuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGdzcC1sY20vYm8tY3JlYXRvci8iLCJzb3VyY2VzIjpbImxpYi92aWV3cy9iby1jcmVhdG9yL21vZGFsL2FwcC1tb2RhbC9hcHAtY3JlYXRvci1tb2RhbC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFVLE1BQU0sRUFBRSxZQUFZLEVBQWlDLE1BQU0sZUFBZSxDQUFDO0FBQ3ZHLE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUNsRCxPQUFPLEVBQUUsb0JBQW9CLEVBQUUsdUJBQXVCLEVBQUUsTUFBTSx3QkFBd0IsQ0FBQztBQUN2RixPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sZ0NBQWdDLENBQUM7QUFDakUsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLDZCQUE2QixDQUFDO0FBRTdEO0lBZUksa0NBQ1ksY0FBNkIsRUFDN0IsV0FBb0MsRUFDcEMsYUFBNEI7UUFGNUIsbUJBQWMsR0FBZCxjQUFjLENBQWU7UUFDN0IsZ0JBQVcsR0FBWCxXQUFXLENBQXlCO1FBQ3BDLGtCQUFhLEdBQWIsYUFBYSxDQUFlO1FBWDlCLHNCQUFpQixHQUFzQixJQUFJLFlBQVksRUFBTyxDQUFDO1FBRXpFLGNBQVMsR0FBeUIsSUFBSSxvQkFBb0IsRUFBRSxDQUFDO1FBSTdELFNBQUksR0FBVSxFQUFFLENBQUM7SUFLMkIsQ0FBQzs7OztJQUU3QywyQ0FBUTs7O0lBQVI7UUFDSSxJQUFJLENBQUMsUUFBUSxFQUFFLENBQUM7SUFDcEIsQ0FBQzs7Ozs7SUFFTywyQ0FBUTs7OztJQUFoQjtRQUFBLGlCQVlDO1FBWEcsSUFBSSxDQUFDLFdBQVcsQ0FBQyxrQkFBa0IsRUFBRSxDQUFDLFNBQVM7Ozs7UUFDM0MsVUFBQyxJQUFXO1lBQ1IsSUFBSSxDQUFDLElBQUksRUFBRTtnQkFDUCxPQUFPO2FBQ1Y7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LEVBQUUsS0FBSyxLQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxXQUFXLEVBQUUsRUFBMUQsQ0FBMEQsRUFBQztRQUMvRixJQUFJLFNBQVMsRUFBRTtZQUNYLE1BQU0sQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDO1lBQ3RCLE1BQU0sQ0FBQyxPQUFPLEdBQUcsK0NBQVUsSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLHVCQUFLLENBQUM7WUFDcEQsT0FBTyxNQUFNLENBQUM7U0FDakI7UUFDRCxPQUFPLE1BQU0sQ0FBQztJQUNsQixDQUFDOztnQkFuSUosU0FBUyxTQUFDO29CQUNQLFFBQVEsRUFBRSx1QkFBdUI7b0JBQ2pDLDh1Q0FBaUQ7O2lCQUVwRDs7OztnQkFOUSxjQUFjO2dCQUZRLHVCQUF1QjtnQkFEN0MsYUFBYTs7O29DQVlqQixNQUFNOztJQThIWCwrQkFBQztDQUFBLEFBcklELElBcUlDO1NBaElZLHdCQUF3Qjs7O0lBRWpDLHFEQUF5RTs7SUFFekUsNkNBQTZEOztJQUU3RCwwQ0FBWTs7SUFFWix3Q0FBaUI7Ozs7O0lBR2Isa0RBQXFDOzs7OztJQUNyQywrQ0FBNEM7Ozs7O0lBQzVDLGlEQUFvQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgT25Jbml0LCBPdXRwdXQsIEV2ZW50RW1pdHRlciwgVGVtcGxhdGVSZWYsIFZpZXdDaGlsZCwgSW5wdXQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IE5vdGlmeVNlcnZpY2UgfSBmcm9tICdAZmFycmlzL3VpLW5vdGlmeSc7XG5pbXBvcnQgeyBCdXNpbmVzc09iamVjdEVudGl0eSwgQnVzaW5lc3NPYmplY3REdFNlcnZpY2UgfSBmcm9tICdAZ3NwLWxjbS9iby1kdC1zZXJ2aWNlJztcbmltcG9ydCB7IFZhbGlkYXRvclJlc3VsdCB9IGZyb20gJy4uLy4uL2NvbW1vbi92YWxpZGF0aW9uLXJlc3VsdCc7XG5pbXBvcnQgeyBCb0NyZWF0b3JVdGlscyB9IGZyb20gJy4uLy4uL3V0aWxzL2JvLWNyZWF0ZS11dGlscyc7XG5cbkBDb21wb25lbnQoe1xuICAgIHNlbGVjdG9yOiAnYXBwLWFwcC1jcmVhdG9yLW1vZGFsJyxcbiAgICB0ZW1wbGF0ZVVybDogJy4vYXBwLWNyZWF0b3ItbW9kYWwuY29tcG9uZW50Lmh0bWwnLFxuICAgIHN0eWxlVXJsczogWycuL2FwcC1jcmVhdG9yLW1vZGFsLmNvbXBvbmVudC5jc3MnXVxufSlcbmV4cG9ydCBjbGFzcyBBcHBDcmVhdG9yTW9kYWxDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xuXG4gICAgQE91dHB1dCgpIGFwcENvbmZpcm1FbWl0dGVyOiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuXG4gICAgY3VycmVudEJvOiBCdXNpbmVzc09iamVjdEVudGl0eSA9IG5ldyBCdXNpbmVzc09iamVjdEVudGl0eSgpO1xuXG4gICAgcGFyZW50OiBhbnk7XG5cbiAgICBhcHBzOiBhbnlbXSA9IFtdO1xuXG4gICAgY29uc3RydWN0b3IoXG4gICAgICAgIHByaXZhdGUgYm9DcmVhdG9yVXRpbHM6Qm9DcmVhdG9yVXRpbHMsXG4gICAgICAgIHByaXZhdGUgYm9EdFNlcnZpY2U6IEJ1c2luZXNzT2JqZWN0RHRTZXJ2aWNlLFxuICAgICAgICBwcml2YXRlIG5vdGlmeVNlcnZpY2U6IE5vdGlmeVNlcnZpY2UpIHsgfVxuXG4gICAgbmdPbkluaXQoKSB7XG4gICAgICAgIHRoaXMuaW5pdERhdGEoKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGluaXREYXRhKCkge1xuICAgICAgICB0aGlzLmJvRHRTZXJ2aWNlLmdldEJ1c2luZXNzT2JqZWN0cygpLnN1YnNjcmliZShcbiAgICAgICAgICAgIChkYXRhOiBhbnlbXSkgPT4ge1xuICAgICAgICAgICAgICAgIGlmICghZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIC8v5LqM57qn6IqC54K55pivQVBQXG4gICAgICAgICAgICAgICAgdGhpcy5hcHBzID0gZGF0YS5maWx0ZXIoeCA9PiB4LmxheWVyID09PSAyKTtcbiAgICAgICAgICAgICAgICAvL+S4gOe6p+iKgueCueaYr+S6p+WTge+8jOebruWJjem7mOiupOS4gOe6p+iKgueCue+8iOagueiKgueCue+8ieWPquacieS4gOS4qlxuICAgICAgICAgICAgICAgIHRoaXMucGFyZW50ID0gZGF0YS5maW5kKHggPT4geC5sYXllciA9PT0gMSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgY3JlYXRlKCl7XG4gICAgICAgIGxldCBibz10aGlzLmdldEN1cnJlbnRCbygpO1xuICAgICAgICBpZighYm8pe1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuYm9EdFNlcnZpY2Uuc2F2ZShibykuc3Vic2NyaWJlKFxuICAgICAgICAgICAgKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuYXBwQ29uZmlybUVtaXR0ZXIuZW1pdChibyk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZXJyb3IgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMubm90aWZ5U2VydmljZS5lcnJvcign5Yib5bu65aSx6LSlJyk7XG4gICAgICAgICAgICAgICAgdGhyb3cgZXJyb3I7XG4gICAgICAgICAgICB9XG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgZ2V0Q3VycmVudEJvKCl7XG4gICAgICAgIGxldCByZXN1bHQ9dGhpcy5hcHBJbmZvVmFsaWRhdG9yKCk7XG4gICAgICAgIGlmKHJlc3VsdC5pbGxlZ2FsKXsgXG4gICAgICAgICAgICB0aGlzLm5vdGlmeVNlcnZpY2Uud2FybmluZyhyZXN1bHQubWVzc2FnZSk7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmN1cnJlbnRCby5pZCA9IHRoaXMuYm9DcmVhdG9yVXRpbHMubmV3R3VpZCgpO1xuICAgICAgICB0aGlzLmN1cnJlbnRCby5sYXllciA9IDI7XG4gICAgICAgIHRoaXMuY3VycmVudEJvLnBhcmVudElEID0gdGhpcy5wYXJlbnQuaWQ7XG4gICAgICAgIHRoaXMuY3VycmVudEJvLnN5c0luaXQgPSAnMCc7XG4gICAgICAgIHRoaXMuY3VycmVudEJvLmlzU3lzSW5pdCA9IGZhbHNlO1xuICAgICAgICB0aGlzLmN1cnJlbnRCby5pc0RldGFpbCA9ICcwJztcbiAgICAgICAgbGV0IG1heCA9IHRoaXMuYm9DcmVhdG9yVXRpbHMuZ2V0TWF4T3JkZXIodGhpcy5hcHBzLCB0aGlzLmN1cnJlbnRCby5wYXJlbnRJRCk7XG4gICAgICAgIHRoaXMuY3VycmVudEJvLnNvcnRPcmRlciA9IG1heCArIDE7XG4gICAgICAgIHJldHVybiBPYmplY3QuYXNzaWduKG5ldyBCdXNpbmVzc09iamVjdEVudGl0eSgpLHRoaXMuY3VycmVudEJvKTtcbiAgICB9XG5cbiAgICBhcHBJbmZvVmFsaWRhdG9yKCk6IFZhbGlkYXRvclJlc3VsdCB7XG5cbiAgICAgICAgLy/mlrDlop7kv6Hmga/nqbrmoKHpqoxcbiAgICAgICAgbGV0IHJlc3VsdCA9IHRoaXMuZW1wdHlWYWxpZGF0b3IoKTtcbiAgICAgICAgaWYgKHJlc3VsdC5pbGxlZ2FsKSB7XG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgICB9XG5cbiAgICAgICAgLy/nvJblj7fvvIzlkI3np7Dlkb3lkI3op4TojIPmgKfmoKHpqoxcbiAgICAgICAgcmVzdWx0ID0gdGhpcy5uYW1pbmdDb252ZW50aW9uVmFsaWRhdG9yKCk7XG4gICAgICAgIGlmIChyZXN1bHQuaWxsZWdhbCkge1xuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vQVBQ57yW5Y+36YeN5aSN5qCh6aqMXG4gICAgICAgIHJldHVybiB0aGlzLnJlcGVhdFZhbGlkYXRvcigpO1xuXG4gICAgfVxuXG4gICAgZW1wdHlWYWxpZGF0b3IoKTogVmFsaWRhdG9yUmVzdWx0IHtcbiAgICAgICAgbGV0IHJlc3VsdCA9IG5ldyBWYWxpZGF0b3JSZXN1bHQoKTtcbiAgICAgICAgaWYgKCF0aGlzLmN1cnJlbnRCby5jb2RlKSB7XG4gICAgICAgICAgICByZXN1bHQuaWxsZWdhbCA9IHRydWU7XG4gICAgICAgICAgICByZXN1bHQubWVzc2FnZSA9IGDlhbPplK7lupTnlKjnmoTnvJblj7fkuI3og73kuLrnqbpgO1xuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIXRoaXMuY3VycmVudEJvLm5hbWUpIHtcbiAgICAgICAgICAgIHJlc3VsdC5pbGxlZ2FsID0gdHJ1ZTtcbiAgICAgICAgICAgIHJlc3VsdC5tZXNzYWdlID0gYOWFs+mUruW6lOeUqOeahOWQjeensOS4jeiDveS4uuepumA7XG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfVxuXG4gICAgbmFtaW5nQ29udmVudGlvblZhbGlkYXRvcigpOiBWYWxpZGF0b3JSZXN1bHQge1xuICAgICAgICBsZXQgcmVzdWx0ID0gbmV3IFZhbGlkYXRvclJlc3VsdCgpO1xuICAgICAgICBjb25zdCBjb2RlUmVneCA9IG5ldyBSZWdFeHAoJ15bYS16QS1aXFx4N2YtXFx4ZmZdW2EtekEtWjAtOVxceDdmLVxceGZmXSokJyk7XG4gICAgICAgIGlmICghY29kZVJlZ3gudGVzdCh0aGlzLmN1cnJlbnRCby5jb2RlKSkge1xuICAgICAgICAgICAgcmVzdWx0LmlsbGVnYWwgPSB0cnVlO1xuICAgICAgICAgICAgcmVzdWx0Lm1lc3NhZ2UgPSAn5YWz6ZSu5bqU55So55qE57yW5Y+35Y+q6IO95YyF5ZCr5a2X5q+NLOaVsOWtlyzlubbkuJTkuI3lj6/ku6XnlKjmlbDlrZflvIDlpLQhJztcbiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgbmFtZVJlZ3ggPSBuZXcgUmVnRXhwKCdbYH4hQCMkXiYqKCk9fHt9XFwnOjtcXCcsXFxcXFtcXFxcXS48Pi8/fu+8gUAj77+l4oCm4oCmJirvvIjvvInigJTigJR8e33jgJDjgJHigJjvvJvvvJrigJ3igJxcXCfjgILvvIzjgIHvvJ9dJyk7XG4gICAgICAgIGlmIChuYW1lUmVneC50ZXN0KHRoaXMuY3VycmVudEJvLm5hbWUpKSB7XG4gICAgICAgICAgICByZXN1bHQuaWxsZWdhbCA9IHRydWU7XG4gICAgICAgICAgICByZXN1bHQubWVzc2FnZSA9ICflhbPplK7lupTnlKjnmoTlkI3np7DljIXlkKvpnZ7ms5XlrZfnrKbvvIzor7fph43mlrDovpPlhaUhJztcbiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9XG5cbiAgICByZXBlYXRWYWxpZGF0b3IoKTogVmFsaWRhdG9yUmVzdWx0IHtcbiAgICAgICAgbGV0IHJlc3VsdCA9IG5ldyBWYWxpZGF0b3JSZXN1bHQoKTtcbiAgICAgICAgbGV0IGZpbHRlckFwcCA9IHRoaXMuYXBwcy5maW5kKHggPT4geC5jb2RlLnRvTG93ZXJDYXNlKCkgPT09IHRoaXMuY3VycmVudEJvLmNvZGUudG9Mb3dlckNhc2UoKSk7XG4gICAgICAgIGlmIChmaWx0ZXJBcHApIHtcbiAgICAgICAgICAgIHJlc3VsdC5pbGxlZ2FsID0gdHJ1ZTtcbiAgICAgICAgICAgIHJlc3VsdC5tZXNzYWdlID0gYOWFs+mUruW6lOeUqOeahOe8luWPtyR7dGhpcy5jdXJyZW50Qm8uY29kZX3lt7LlrZjlnKhgO1xuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH1cblxufVxuIl19
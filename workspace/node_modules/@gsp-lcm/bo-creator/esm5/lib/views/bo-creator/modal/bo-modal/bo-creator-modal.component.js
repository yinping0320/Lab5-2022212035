/**
 * @fileoverview added by tsickle
 * Generated from: lib/views/bo-creator/modal/bo-modal/bo-creator-modal.component.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input, EventEmitter, Output, ViewChild } from '@angular/core';
import { ComboListComponent } from '@farris/ui-combo-list';
import { BusinessObjectEntity, BusinessObjectDtService } from '@gsp-lcm/bo-dt-service';
import { BoCreatorUtils } from '../../utils/bo-create-utils';
import { NotifyService } from '@farris/ui-notify';
import { ValidatorResult } from '../../common/validation-result';
var BoCreatorModalComponent = /** @class */ (function () {
    function BoCreatorModalComponent(boCreatorUtils, boDtService, notifyService) {
        this.boCreatorUtils = boCreatorUtils;
        this.boDtService = boDtService;
        this.notifyService = notifyService;
        this.boConfirmEmitter = new EventEmitter();
        /**
         * 当前BO节点
         */
        this.currentBo = new BusinessObjectEntity();
        /**
         * 关键应用集合
         */
        this.items = [];
        /**
         * 选择应用节点下的所有服务单元集合
         */
        this.suList = [];
        /**
         * 所有业务对象节点集合
         */
        this.data = [];
        this.parentBo = new BusinessObjectEntity();
        this.labelLength = '2';
        this.inputLength = '9';
    }
    Object.defineProperty(BoCreatorModalComponent.prototype, "_parentId", {
        set: /**
         * @param {?} parentId
         * @return {?}
         */
        function (parentId) {
            this.parentId = parentId;
            this.getParentBo();
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    BoCreatorModalComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        this.initData();
    };
    /**
     * @private
     * @return {?}
     */
    BoCreatorModalComponent.prototype.initData = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        this.boDtService.getBusinessObjects().subscribe((/**
         * @param {?} data
         * @return {?}
         */
        function (data) {
            _this.data = data;
            _this.items = data.filter((/**
             * @param {?} item
             * @return {?}
             */
            function (item) { return item.parentID === _this.parentId && item.layer === 4 && item.isDetail === '0'; }));
            /** @type {?} */
            var children = data.filter((/**
             * @param {?} item
             * @return {?}
             */
            function (item) { return item.parentID === _this.parentId; }));
            /** @type {?} */
            var boInSU = [];
            children.forEach((/**
             * @param {?} s
             * @return {?}
             */
            function (s) {
                if (s.isDetail == '0') {
                    boInSU.push(s);
                    /** @type {?} */
                    var bos = data.filter((/**
                     * @param {?} t
                     * @return {?}
                     */
                    function (t) { return t.parentID === s.id; }));
                    if (bos) {
                        bos.forEach((/**
                         * @param {?} bo
                         * @return {?}
                         */
                        function (bo) {
                            boInSU.push(bo);
                        }));
                    }
                }
                else {
                    boInSU.push(s);
                }
            }));
            _this.bosInSU = boInSU;
        }));
    };
    /**
     * @return {?}
     */
    BoCreatorModalComponent.prototype.create = /**
     * @return {?}
     */
    function () {
        var _this = this;
        /** @type {?} */
        var bo = this.getCurrentBo();
        if (!bo) {
            return;
        }
        this.boDtService.save(bo).subscribe((/**
         * @return {?}
         */
        function () {
            _this.boConfirmEmitter.emit(bo);
        }), (/**
         * @param {?} error
         * @return {?}
         */
        function (error) {
            _this.notifyService.error('创建失败');
            throw error;
        }));
    };
    /**
     * @return {?}
     */
    BoCreatorModalComponent.prototype.getCurrentBo = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var result = this.boInfoValidator();
        if (result.illegal) {
            this.notifyService.warning(result.message);
            return null;
        }
        this.currentBo.id = this.boCreatorUtils.newGuid();
        this.currentBo.layer = this.parentBo ? this.parentBo.layer + 1 : 4;
        this.currentBo.parentID = this.parentBo && this.parentBo.id ? this.parentBo.id : this.parentId;
        this.currentBo.sysInit = '0';
        this.currentBo.isSysInit = false;
        this.currentBo.isDetail = '1';
        /** @type {?} */
        var max = this.boCreatorUtils.getMaxOrder(this.bosInSU, this.currentBo.parentID);
        this.currentBo.sortOrder = max + 1;
        return Object.assign(new BusinessObjectEntity(), this.currentBo);
    };
    /**
     * @return {?}
     */
    BoCreatorModalComponent.prototype.boInfoValidator = /**
     * @return {?}
     */
    function () {
        //新增信息空校验
        /** @type {?} */
        var result = this.emptyValidator();
        if (result.illegal) {
            return result;
        }
        //编号，名称命名规范性校验
        result = this.namingConventionValidator();
        if (result.illegal) {
            return result;
        }
        //APP编号重复校验
        return this.repeatValidator();
    };
    /**
     * @return {?}
     */
    BoCreatorModalComponent.prototype.emptyValidator = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var result = new ValidatorResult();
        if (!this.suCode) {
            result.illegal = true;
            result.message = "\u6240\u5C5E\u5FAE\u670D\u52A1\u4E0D\u80FD\u4E3A\u7A7A";
            return result;
        }
        if (!this.currentBo.code) {
            result.illegal = true;
            result.message = "\u4E1A\u52A1\u5BF9\u8C61\u7684\u7F16\u53F7\u4E0D\u80FD\u4E3A\u7A7A";
            return result;
        }
        if (!this.currentBo.name) {
            result.illegal = true;
            result.message = "\u4E1A\u52A1\u5BF9\u8C61\u7684\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A";
            return result;
        }
        return result;
    };
    /**
     * @return {?}
     */
    BoCreatorModalComponent.prototype.namingConventionValidator = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var result = new ValidatorResult();
        /** @type {?} */
        var codeRegx = new RegExp('^[a-zA-Z\x7f-\xff][a-zA-Z0-9\x7f-\xff]*$');
        if (!codeRegx.test(this.currentBo.code)) {
            result.illegal = true;
            result.message = '业务对象的编号只能包含字母,数字,并且不可以用数字开头!';
            return result;
        }
        /** @type {?} */
        var nameRegx = new RegExp('[`~!@#$^&*()=|{}\':;\',\\[\\].<>/?~！@#￥……&*（）——|{}【】‘；：”“\'。，、？]');
        if (nameRegx.test(this.currentBo.name)) {
            result.illegal = true;
            result.message = '业务对象的名称包含非法字符，请重新输入!';
            return result;
        }
        return result;
    };
    /**
     * @return {?}
     */
    BoCreatorModalComponent.prototype.repeatValidator = /**
     * @return {?}
     */
    function () {
        var _this = this;
        /** @type {?} */
        var result = new ValidatorResult();
        if (!this.bosInSU || this.bosInSU.length <= 0) {
            return result;
        }
        /** @type {?} */
        var repeatCodeBO = this.bosInSU.find((/**
         * @param {?} bo
         * @return {?}
         */
        function (bo) { return bo.code.toLowerCase() === _this.currentBo.code.toLowerCase(); }));
        if (repeatCodeBO) {
            result.illegal = true;
            result.message = '同一SU下业务对象/业务对象分组/业务对象与业务对象分组编号不能重复，业务对象编号为：' + this.currentBo.code;
            return result;
        }
        return result;
    };
    /**
     * @param {?} $event
     * @return {?}
     */
    BoCreatorModalComponent.prototype.boGroupSelectChanged = /**
     * @param {?} $event
     * @return {?}
     */
    function ($event) {
        this.parentBo = $event.data;
    };
    /**
     * @private
     * @return {?}
     */
    BoCreatorModalComponent.prototype.getParentBo = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        if (this.parentId) {
            this.boDtService.getBusinessObject(this.parentId).subscribe((/**
             * @param {?} data
             * @return {?}
             */
            function (data) {
                _this.parentBo = data;
                _this.suCode = data.code;
            }));
        }
    };
    /**
     * @return {?}
     */
    BoCreatorModalComponent.prototype.clearHandler = /**
     * @return {?}
     */
    function () {
        this.parentBo = null;
    };
    BoCreatorModalComponent.decorators = [
        { type: Component, args: [{
                    selector: 'app-bo-creator-modal',
                    template: "<div class=\"cloumn\" style=\"margin-top: 28px;\">\n\n  <div class=\"suInfo row\">\n    <label class=\"col-form-label ps-col-form-label\">\n      <span class=\"farris-label-info text-danger\">*</span>\n      <span class=\"farris-label-text\">\u6240\u5C5E\u5FAE\u670D\u52A1</span>\n    </label>\n    <div class=\"col-{{inputLength}}\">\n      <input-group [(ngModel)]=\"suCode\" #boCode=\"ngModel\" [readonly]=\"true\"></input-group>\n    </div>\n  </div>\n\n  <div class=\"row suInfo\">\n    <label class=\"col-form-label ps-col-form-label\">\n      <span class=\"farris-label-text\">\u4E1A\u52A1\u5BF9\u8C61\u5206\u7EC4</span>\n    </label>\n    <div class=\"col-{{inputLength}}\">\n      <farris-combo-list #boGroupSelector [idField]=\"'id'\" [textField]=\"'name'\" [data]=\"items\"\n        (selectChange)=\"boGroupSelectChanged($event)\" (clear)=\"clearHandler()\" [panelHeight]=\"280\" [editable]=\"false\"></farris-combo-list>\n    </div>\n  </div>\n\n  <div class=\"row suInfo\">\n    <label class=\"col-form-label ps-col-form-label\">\n      <span class=\"farris-label-info text-danger\">*</span>\n      <span class=\"farris-label-text\">\u7F16\u53F7</span>\n    </label>\n    <div class=\"col-{{inputLength}}\">\n      <input-group [(ngModel)]=\"currentBo.code\" #boCode=\"ngModel\" required></input-group>\n    </div>\n    <!-- <div [hidden]=\"boCode.valid || boCode.pristine\" class=\"alert-danger\">\n      \u7F16\u53F7\u4E0D\u80FD\u4E3A\u7A7A\n    </div> -->\n  </div>\n\n  <div class=\"row suInfo\">\n    <label class=\"col-form-label ps-col-form-label\">\n      <span class=\"farris-label-info text-danger\">*</span>\n      <span class=\"farris-label-text\">\u540D\u79F0</span>\n    </label>\n    <div class=\"col-{{inputLength}}\">\n      <input-group [(ngModel)]=\"currentBo.name\" #boName=\"ngModel\" required></input-group>\n    </div>\n    <!-- <div [hidden]=\"boName.valid || boName.pristine\" class=\"alert-danger\">\n      \u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A\n    </div> -->\n  </div>\n\n</div>",
                    styles: [".sucreator-wrapper{background:rgba(255,255,255,.8);width:95%;margin:40px auto 0;max-width:480px;padding:24px 18px;border-radius:8px;position:relative;z-index:100}.suInfo{margin:0 0 16px 20px}.sucreator-wrapper .col-form-label,.sucreator-wrapper .form-control{padding-top:3px;padding-bottom:3px}.sucreator-wrapper .col-form-label{width:70px;margin-right:12px;text-align:right;flex-shrink:0}.bocreator{background:#fff;box-shadow:0 2px 16px 0 rgba(0,0,0,.1);border-radius:4px}.boCreatorPanel{background-color:#fff}div .ps-col-form-label{width:94px;text-align:right}"]
                }] }
    ];
    /** @nocollapse */
    BoCreatorModalComponent.ctorParameters = function () { return [
        { type: BoCreatorUtils },
        { type: BusinessObjectDtService },
        { type: NotifyService }
    ]; };
    BoCreatorModalComponent.propDecorators = {
        _parentId: [{ type: Input }],
        boConfirmEmitter: [{ type: Output }],
        boGroupSelector: [{ type: ViewChild, args: ["boGroupSelector",] }]
    };
    return BoCreatorModalComponent;
}());
export { BoCreatorModalComponent };
if (false) {
    /** @type {?} */
    BoCreatorModalComponent.prototype.parentId;
    /** @type {?} */
    BoCreatorModalComponent.prototype.boConfirmEmitter;
    /** @type {?} */
    BoCreatorModalComponent.prototype.boGroupSelector;
    /**
     * 当前BO节点
     * @type {?}
     */
    BoCreatorModalComponent.prototype.currentBo;
    /**
     * 关键应用集合
     * @type {?}
     */
    BoCreatorModalComponent.prototype.items;
    /**
     * 选择应用节点下的所有服务单元集合
     * @type {?}
     */
    BoCreatorModalComponent.prototype.suList;
    /**
     * 当前选择的SU下的所有BO
     * @type {?}
     */
    BoCreatorModalComponent.prototype.bosInSU;
    /**
     * 所有业务对象节点集合
     * @type {?}
     */
    BoCreatorModalComponent.prototype.data;
    /**
     * 所属微服务
     * @type {?}
     */
    BoCreatorModalComponent.prototype.suCode;
    /** @type {?} */
    BoCreatorModalComponent.prototype.parentBo;
    /** @type {?} */
    BoCreatorModalComponent.prototype.labelLength;
    /** @type {?} */
    BoCreatorModalComponent.prototype.inputLength;
    /**
     * @type {?}
     * @private
     */
    BoCreatorModalComponent.prototype.boCreatorUtils;
    /**
     * @type {?}
     * @private
     */
    BoCreatorModalComponent.prototype.boDtService;
    /**
     * @type {?}
     * @private
     */
    BoCreatorModalComponent.prototype.notifyService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYm8tY3JlYXRvci1tb2RhbC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZ3NwLWxjbS9iby1jcmVhdG9yLyIsInNvdXJjZXMiOlsibGliL3ZpZXdzL2JvLWNyZWF0b3IvbW9kYWwvYm8tbW9kYWwvYm8tY3JlYXRvci1tb2RhbC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFVLEtBQUssRUFBRSxZQUFZLEVBQUUsTUFBTSxFQUFFLFNBQVMsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUMxRixPQUFPLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQUMzRCxPQUFPLEVBQUUsb0JBQW9CLEVBQUUsdUJBQXVCLEVBQUUsTUFBTSx3QkFBd0IsQ0FBQztBQUN2RixPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sNkJBQTZCLENBQUM7QUFDN0QsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBQ2xELE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxnQ0FBZ0MsQ0FBQztBQUVqRTtJQXFESSxpQ0FDWSxjQUE2QixFQUM3QixXQUFvQyxFQUNwQyxhQUE0QjtRQUY1QixtQkFBYyxHQUFkLGNBQWMsQ0FBZTtRQUM3QixnQkFBVyxHQUFYLFdBQVcsQ0FBeUI7UUFDcEMsa0JBQWEsR0FBYixhQUFhLENBQWU7UUExQzlCLHFCQUFnQixHQUFzQixJQUFJLFlBQVksRUFBTyxDQUFDOzs7O1FBT3hFLGNBQVMsR0FBeUIsSUFBSSxvQkFBb0IsRUFBRSxDQUFDOzs7O1FBSzdELFVBQUssR0FBeUIsRUFBRSxDQUFDOzs7O1FBS2pDLFdBQU0sR0FBeUIsRUFBRSxDQUFDOzs7O1FBVWxDLFNBQUksR0FBTyxFQUFFLENBQUM7UUFPZCxhQUFRLEdBQXVCLElBQUksb0JBQW9CLEVBQUUsQ0FBQztRQUUxRCxnQkFBVyxHQUFHLEdBQUcsQ0FBQztRQUNsQixnQkFBVyxHQUFHLEdBQUcs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LENBQUMsUUFBUSxHQUFHLElBQUksQ0FBQztnQkFDckIsS0FBSSxDQUFDLE1BQU0sR0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDO1lBQzFCLENBQUMsRUFBQyxDQUFDO1NBQ047SUFDTCxDQUFDOzs7O0lBRUQsOENBQVk7OztJQUFaO1FBQ0ksSUFBSSxDQUFDLFFBQVEsR0FBQyxJQUFJLENBQUM7SUFDdkIsQ0FBQzs7Z0JBN01KLFNBQVMsU0FBQztvQkFDUCxRQUFRLEVBQUUsc0JBQXNCO29CQUNoQyw4K0RBQWdEOztpQkFFbkQ7Ozs7Z0JBUlEsY0FBYztnQkFEUSx1QkFBdUI7Z0JBRTdDLGFBQWE7Ozs0QkFZakIsS0FBSzttQ0FLTCxNQUFNO2tDQUVOLFNBQVMsU0FBQyxpQkFBaUI7O0lBOExoQyw4QkFBQztDQUFBLEFBOU1ELElBOE1DO1NBek1ZLHVCQUF1Qjs7O0lBRWhDLDJDQUFnQjs7SUFPaEIsbURBQXdFOztJQUV4RSxrREFBa0U7Ozs7O0lBS2xFLDRDQUE2RDs7Ozs7SUFLN0Qsd0NBQWlDOzs7OztJQUtqQyx5Q0FBa0M7Ozs7O0lBS2xDLDBDQUFnQzs7Ozs7SUFLaEMsdUNBQWM7Ozs7O0lBS2QseUNBQWM7O0lBRWQsMkNBQTBEOztJQUUxRCw4Q0FBa0I7O0lBQ2xCLDhDQUFrQjs7Ozs7SUFHZCxpREFBcUM7Ozs7O0lBQ3JDLDhDQUE0Qzs7Ozs7SUFDNUMsZ0RBQW9DIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBPbkluaXQsIElucHV0LCBFdmVudEVtaXR0ZXIsIE91dHB1dCwgVmlld0NoaWxkIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBDb21ib0xpc3RDb21wb25lbnQgfSBmcm9tICdAZmFycmlzL3VpLWNvbWJvLWxpc3QnO1xuaW1wb3J0IHsgQnVzaW5lc3NPYmplY3RFbnRpdHksIEJ1c2luZXNzT2JqZWN0RHRTZXJ2aWNlIH0gZnJvbSAnQGdzcC1sY20vYm8tZHQtc2VydmljZSc7XG5pbXBvcnQgeyBCb0NyZWF0b3JVdGlscyB9IGZyb20gJy4uLy4uL3V0aWxzL2JvLWNyZWF0ZS11dGlscyc7XG5pbXBvcnQgeyBOb3RpZnlTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy91aS1ub3RpZnknO1xuaW1wb3J0IHsgVmFsaWRhdG9yUmVzdWx0IH0gZnJvbSAnLi4vLi4vY29tbW9uL3ZhbGlkYXRpb24tcmVzdWx0JztcblxuQENvbXBvbmVudCh7XG4gICAgc2VsZWN0b3I6ICdhcHAtYm8tY3JlYXRvci1tb2RhbCcsXG4gICAgdGVtcGxhdGVVcmw6ICcuL2JvLWNyZWF0b3ItbW9kYWwuY29tcG9uZW50Lmh0bWwnLFxuICAgIHN0eWxlVXJsczogWycuL2JvLWNyZWF0b3ItbW9kYWwuY29tcG9uZW50LmNzcyddXG59KVxuZXhwb3J0IGNsYXNzIEJvQ3JlYXRvck1vZGFsQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcblxuICAgIHBhcmVudElkOnN0cmluZztcblxuICAgIEBJbnB1dCgpIHNldCBfcGFyZW50SWQocGFyZW50SWQ6c3RyaW5nKXtcbiAgICAgICAgdGhpcy5wYXJlbnRJZD1wYXJlbnRJZDtcbiAgICAgICAgdGhpcy5nZXRQYXJlbnRCbygpO1xuICAgIH1cblxuICAgIEBPdXRwdXQoKSBib0NvbmZpcm1FbWl0dGVyOiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuXG4gICAgQFZpZXdDaGlsZChcImJvR3JvdXBTZWxlY3RvclwiKSBib0dyb3VwU2VsZWN0b3I6IENvbWJvTGlzdENvbXBvbmVudDtcbiAgICBcbiAgICAvKipcbiAgICAgKiDlvZPliY1CT+iKgueCuVxuICAgICAqL1xuICAgIGN1cnJlbnRCbzogQnVzaW5lc3NPYmplY3RFbnRpdHkgPSBuZXcgQnVzaW5lc3NPYmplY3RFbnRpdHkoKTtcblxuICAgIC8qKlxuICAgICAqIOWFs+mUruW6lOeUqOmbhuWQiFxuICAgICAqL1xuICAgIGl0ZW1zOiBCdXNpbmVzc09iamVjdEVudGl0eVtdPVtdO1xuXG4gICAgLyoqXG4gICAgICog6YCJ5oup5bqU55So6IqC54K55LiL55qE5omA5pyJ5pyN5Yqh5Y2V5YWD6ZuG5ZCIXG4gICAgICovXG4gICAgc3VMaXN0OiBCdXNpbmVzc09iamVjdEVudGl0eVtdPVtdO1xuXG4gICAgLyoqXG4gICAgICog5b2T5YmN6YCJ5oup55qEU1XkuIvnmoTmiYDmnIlCT1xuICAgICAqL1xuICAgIGJvc0luU1U6IEJ1c2luZXNzT2JqZWN0RW50aXR5W107XG5cbiAgICAvKipcbiAgICAgKiDmiYDmnInkuJrliqHlr7nosaHoioLngrnpm4blkIhcbiAgICAgKi9cbiAgICBkYXRhOmFueVtdPVtdO1xuXG4gICAgLyoqXG4gICAgICog5omA5bGe5b6u5pyN5YqhXG4gICAgICovXG4gICAgc3VDb2RlOnN0cmluZztcblxuICAgIHBhcmVudEJvOiBCdXNpbmVzc09iamVjdEVudGl0eT1uZXcgQnVzaW5lc3NPYmplY3RFbnRpdHkoKTtcblxuICAgIGxhYmVsTGVuZ3RoID0gJzInO1xuICAgIGlucHV0TGVuZ3RoID0gJzknO1xuXG4gICAgY29uc3RydWN0b3IoXG4gICAgICAgIHByaXZhdGUgYm9DcmVhdG9yVXRpbHM6Qm9DcmVhdG9yVXRpbHMsXG4gICAgICAgIHByaXZhdGUgYm9EdFNlcnZpY2U6IEJ1c2luZXNzT2JqZWN0RHRTZXJ2aWNlLFxuICAgICAgICBwcml2YXRlIG5vdGlmeVNlcnZpY2U6IE5vdGlmeVNlcnZpY2UpIHsgfVxuXG4gICAgbmdPbkluaXQoKSB7XG4gICAgICAgIHRoaXMuaW5pdERhdGEoKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGluaXREYXRhKCkge1xuICAgICAgICB0aGlzLmJvRHRTZXJ2aWNlLmdldEJ1c2luZXNzT2JqZWN0cygpLnN1YnNjcmliZShkYXRhID0+IHtcbiAgICAgICAgICAgIHRoaXMuZGF0YSA9IGRhdGE7XG4gICAgICAgICAgICB0aGlzLml0ZW1zID0gZGF0YS5maWx0ZXIoaXRlbSA9PiBpdGVtLnBhcmVudElEID09PSB0aGlzLnBhcmVudElkICYmIGl0ZW0ubGF5ZXIgPT09IDQgJiYgaXRlbS5pc0RldGFpbCA9PT0gJzAnKTtcbiAgICAgICAgICAgIGNvbnN0IGNoaWxkcmVuID0gZGF0YS5maWx0ZXIoaXRlbSA9PiBpdGVtLnBhcmVudElEID09PSB0aGlzLnBhcmVudElkKTtcbiAgICAgICAgICAgIGxldCBib0luU1UgPSBbXTtcbiAgICAgICAgICAgIGNoaWxkcmVuLmZvckVhY2gocyA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKHMuaXNEZXRhaWwgPT0gJzAnKSB7XG4gICAgICAgICAgICAgICAgICAgIGJvSW5TVS5wdXNoKHMpO1xuICAgICAgICAgICAgICAgICAgICB2YXIgYm9zID0gZGF0YS5maWx0ZXIodCA9PiB0LnBhcmVudElEID09PSBzLmlkKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGJvcykge1xuICAgICAgICAgICAgICAgICAgICAgICAgYm9zLmZvckVhY2goYm8gPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJvSW5TVS5wdXNoKGJvKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBib0luU1UucHVzaChzKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHRoaXMuYm9zSW5TVSA9IGJvSW5TVTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgY3JlYXRlKCl7XG4gICAgICAgIGxldCBibz10aGlzLmdldEN1cnJlbnRCbygpO1xuICAgICAgICBpZighYm8pe1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuYm9EdFNlcnZpY2Uuc2F2ZShibykuc3Vic2NyaWJlKFxuICAgICAgICAgICAgKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuYm9Db25maXJtRW1pdHRlci5lbWl0KGJvKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBlcnJvciA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5ub3RpZnlTZXJ2aWNlLmVycm9yKCfliJvlu7rlpLHotKUnKTtcbiAgICAgICAgICAgICAgICB0aHJvdyBlcnJvcjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICBnZXRDdXJyZW50Qm8oKXtcbiAgICAgICAgbGV0IHJlc3VsdD10aGlzLmJvSW5mb1ZhbGlkYXRvcigpO1xuICAgICAgICBpZihyZXN1bHQuaWxsZWdhbCl7IFxuICAgICAgICAgICAgdGhpcy5ub3RpZnlTZXJ2aWNlLndhcm5pbmcocmVzdWx0Lm1lc3NhZ2UpO1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5jdXJyZW50Qm8uaWQgPSB0aGlzLmJvQ3JlYXRvclV0aWxzLm5ld0d1aWQoKTtcbiAgICAgICAgdGhpcy5jdXJyZW50Qm8ubGF5ZXIgPSAgdGhpcy5wYXJlbnRCbz90aGlzLnBhcmVudEJvLmxheWVyICsgMTo0O1xuICAgICAgICB0aGlzLmN1cnJlbnRCby5wYXJlbnRJRCA9IHRoaXMucGFyZW50Qm8mJnRoaXMucGFyZW50Qm8uaWQ/dGhpcy5wYXJlbnRCby5pZDp0aGlzLnBhcmVudElkO1xuICAgICAgICB0aGlzLmN1cnJlbnRCby5zeXNJbml0ID0gJzAnO1xuICAgICAgICB0aGlzLmN1cnJlbnRCby5pc1N5c0luaXQgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5jdXJyZW50Qm8uaXNEZXRhaWwgPSAnMSc7XG5cbiAgICAgICAgbGV0IG1heCA9IHRoaXMuYm9DcmVhdG9yVXRpbHMuZ2V0TWF4T3JkZXIodGhpcy5ib3NJblNVLCB0aGlzLmN1cnJlbnRCby5wYXJlbnRJRCk7XG4gICAgICAgIHRoaXMuY3VycmVudEJvLnNvcnRPcmRlciA9IG1heCArIDE7XG4gICAgICAgIHJldHVybiBPYmplY3QuYXNzaWduKG5ldyBCdXNpbmVzc09iamVjdEVudGl0eSgpLHRoaXMuY3VycmVudEJvKTtcbiAgICB9XG5cbiAgICBib0luZm9WYWxpZGF0b3IoKTogVmFsaWRhdG9yUmVzdWx0IHtcblxuICAgICAgICAvL+aWsOWinuS/oeaBr+epuuagoemqjFxuICAgICAgICBsZXQgcmVzdWx0ID0gdGhpcy5lbXB0eVZhbGlkYXRvcigpO1xuICAgICAgICBpZiAocmVzdWx0LmlsbGVnYWwpIHtcbiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgIH1cblxuICAgICAgICAvL+e8luWPt++8jOWQjeensOWRveWQjeinhOiMg+aAp+agoemqjFxuICAgICAgICByZXN1bHQgPSB0aGlzLm5hbWluZ0NvbnZlbnRpb25WYWxpZGF0b3IoKTtcbiAgICAgICAgaWYgKHJlc3VsdC5pbGxlZ2FsKSB7XG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgICB9XG5cbiAgICAgICAgLy9BUFDnvJblj7fph43lpI3moKHpqoxcbiAgICAgICAgcmV0dXJuIHRoaXMucmVwZWF0VmFsaWRhdG9yKCk7XG5cbiAgICB9XG5cbiAgICBlbXB0eVZhbGlkYXRvcigpOiBWYWxpZGF0b3JSZXN1bHQge1xuICAgICAgICBsZXQgcmVzdWx0ID0gbmV3IFZhbGlkYXRvclJlc3VsdCgpO1xuICAgICAgICBpZighdGhpcy5zdUNvZGUpe1xuICAgICAgICAgICAgcmVzdWx0LmlsbGVnYWwgPSB0cnVlO1xuICAgICAgICAgICAgcmVzdWx0Lm1lc3NhZ2UgPSBg5omA5bGe5b6u5pyN5Yqh5LiN6IO95Li656m6YDtcbiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCF0aGlzLmN1cnJlbnRCby5jb2RlKSB7XG4gICAgICAgICAgICByZXN1bHQuaWxsZWdhbCA9IHRydWU7XG4gICAgICAgICAgICByZXN1bHQubWVzc2FnZSA9IGDkuJrliqHlr7nosaHnmoTnvJblj7fkuI3og73kuLrnqbpgO1xuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIXRoaXMuY3VycmVudEJvLm5hbWUpIHtcbiAgICAgICAgICAgIHJlc3VsdC5pbGxlZ2FsID0gdHJ1ZTtcbiAgICAgICAgICAgIHJlc3VsdC5tZXNzYWdlID0gYOS4muWKoeWvueixoeeahOWQjeensOS4jeiDveS4uuepumA7XG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfVxuXG4gICAgbmFtaW5nQ29udmVudGlvblZhbGlkYXRvcigpOiBWYWxpZGF0b3JSZXN1bHQge1xuICAgICAgICBsZXQgcmVzdWx0ID0gbmV3IFZhbGlkYXRvclJlc3VsdCgpO1xuICAgICAgICBjb25zdCBjb2RlUmVneCA9IG5ldyBSZWdFeHAoJ15bYS16QS1aXFx4N2YtXFx4ZmZdW2EtekEtWjAtOVxceDdmLVxceGZmXSokJyk7XG4gICAgICAgIGlmICghY29kZVJlZ3gudGVzdCh0aGlzLmN1cnJlbnRCby5jb2RlKSkge1xuICAgICAgICAgICAgcmVzdWx0LmlsbGVnYWwgPSB0cnVlO1xuICAgICAgICAgICAgcmVzdWx0Lm1lc3NhZ2UgPSAn5Lia5Yqh5a+56LGh55qE57yW5Y+35Y+q6IO95YyF5ZCr5a2X5q+NLOaVsOWtlyzlubbkuJTkuI3lj6/ku6XnlKjmlbDlrZflvIDlpLQhJztcbiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgbmFtZVJlZ3ggPSBuZXcgUmVnRXhwKCdbYH4hQCMkXiYqKCk9fHt9XFwnOjtcXCcsXFxcXFtcXFxcXS48Pi8/fu+8gUAj77+l4oCm4oCmJirvvIjvvInigJTigJR8e33jgJDjgJHigJjvvJvvvJrigJ3igJxcXCfjgILvvIzjgIHvvJ9dJyk7XG4gICAgICAgIGlmIChuYW1lUmVneC50ZXN0KHRoaXMuY3VycmVudEJvLm5hbWUpKSB7XG4gICAgICAgICAgICByZXN1bHQuaWxsZWdhbCA9IHRydWU7XG4gICAgICAgICAgICByZXN1bHQubWVzc2FnZSA9ICfkuJrliqHlr7nosaHnmoTlkI3np7DljIXlkKvpnZ7ms5XlrZfnrKbvvIzor7fph43mlrDovpPlhaUhJztcbiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9XG5cbiAgICByZXBlYXRWYWxpZGF0b3IoKTogVmFsaWRhdG9yUmVzdWx0IHtcbiAgICAgICAgbGV0IHJlc3VsdCA9IG5ldyBWYWxpZGF0b3JSZXN1bHQoKTtcbiAgICAgICAgaWYgKCF0aGlzLmJvc0luU1V8fCB0aGlzLmJvc0luU1UubGVuZ3RoIDw9IDApIHtcbiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgcmVwZWF0Q29kZUJPID0gdGhpcy5ib3NJblNVLmZpbmQoYm8gPT4gYm8uY29kZS50b0xvd2VyQ2FzZSgpID09PSB0aGlzLmN1cnJlbnRCby5jb2RlLnRvTG93ZXJDYXNlKCkpO1xuICAgICAgICBpZiAocmVwZWF0Q29kZUJPKSB7XG4gICAgICAgICAgICByZXN1bHQuaWxsZWdhbCA9IHRydWU7XG4gICAgICAgICAgICByZXN1bHQubWVzc2FnZSA9ICflkIzkuIBTVeS4i+S4muWKoeWvueixoS/kuJrliqHlr7nosaHliIbnu4Qv5Lia5Yqh5a+56LGh5LiO5Lia5Yqh5a+56LGh5YiG57uE57yW5Y+35LiN6IO96YeN5aSN77yM5Lia5Yqh5a+56LGh57yW5Y+35Li677yaJyArIHRoaXMuY3VycmVudEJvLmNvZGU7XG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfVxuXG4gICAgYm9Hcm91cFNlbGVjdENoYW5nZWQoJGV2ZW50KSB7XG4gICAgICAgIHRoaXMucGFyZW50Qm8gPSAkZXZlbnQuZGF0YTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGdldFBhcmVudEJvKCkge1xuICAgICAgICBpZiAodGhpcy5wYXJlbnRJZCkge1xuICAgICAgICAgICAgdGhpcy5ib0R0U2VydmljZS5nZXRCdXNpbmVzc09iamVjdCh0aGlzLnBhcmVudElkKS5zdWJzY3JpYmUoZGF0YSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5wYXJlbnRCbyA9IGRhdGE7XG4gICAgICAgICAgICAgICAgdGhpcy5zdUNvZGU9ZGF0YS5jb2RlO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBjbGVhckhhbmRsZXIoKXtcbiAgICAgICAgdGhpcy5wYXJlbnRCbz1udWxsO1xuICAgIH1cbn1cbiJdfQ==
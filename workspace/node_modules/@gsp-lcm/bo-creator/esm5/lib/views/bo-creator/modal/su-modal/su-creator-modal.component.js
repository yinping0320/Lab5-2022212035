/**
 * @fileoverview added by tsickle
 * Generated from: lib/views/bo-creator/modal/su-modal/su-creator-modal.component.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, EventEmitter, Output, Input, ViewChild } from '@angular/core';
import { BusinessObjectEntity, BusinessObjectDtService } from '@gsp-lcm/bo-dt-service';
import { BoCreatorUtils } from '../../utils/bo-create-utils';
import { NotifyService } from '@farris/ui-notify';
import { ComboListComponent } from '@farris/ui-combo-list';
import { ValidatorResult } from '../../common/validation-result';
var SuCreatorModalComponent = /** @class */ (function () {
    function SuCreatorModalComponent(boCreatorUtils, boDtService, notifyService) {
        this.boCreatorUtils = boCreatorUtils;
        this.boDtService = boDtService;
        this.notifyService = notifyService;
        this.suConfirmEmitter = new EventEmitter();
        /**
         * 当前BO节点
         */
        this.currentBo = new BusinessObjectEntity();
        /**
         * 关键应用集合
         */
        this.items = [];
        /**
         * 选择应用节点下的所有服务单元集合
         */
        this.suList = [];
        /**
         * 所有业务对象节点集合
         */
        this.data = [];
        this.parent = new BusinessObjectEntity();
        this.labelLength = '2';
        this.inputLength = '9';
    }
    /**
     * @return {?}
     */
    SuCreatorModalComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        this.initData();
    };
    /**
     * @private
     * @return {?}
     */
    SuCreatorModalComponent.prototype.initData = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        this.boDtService.getBusinessObjects().subscribe((/**
         * @param {?} data
         * @return {?}
         */
        function (data) {
            _this.data = data;
            _this.items = data.filter((/**
             * @param {?} item
             * @return {?}
             */
            function (item) { return item.layer === 2; }));
            _this.suList = data.filter((/**
             * @param {?} item
             * @return {?}
             */
            function (item) { return item.layer === 3; }));
        }));
    };
    /**
     * @param {?} $event
     * @return {?}
     */
    SuCreatorModalComponent.prototype.appSelectChanged = /**
     * @param {?} $event
     * @return {?}
     */
    function ($event) {
        this.parent = $event.data;
    };
    /**
     * @return {?}
     */
    SuCreatorModalComponent.prototype.create = /**
     * @return {?}
     */
    function () {
        var _this = this;
        /** @type {?} */
        var bo = this.getCurrentBo();
        if (!bo) {
            return;
        }
        this.boDtService.save(bo).subscribe((/**
         * @return {?}
         */
        function () {
            _this.suConfirmEmitter.emit(bo);
        }), (/**
         * @param {?} error
         * @return {?}
         */
        function (error) {
            _this.notifyService.error('创建失败');
            throw error;
        }));
    };
    /**
     * @return {?}
     */
    SuCreatorModalComponent.prototype.getCurrentBo = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var result = this.suInfoValidator();
        if (result.illegal) {
            this.notifyService.warning(result.message);
            return null;
        }
        this.currentBo.id = this.boCreatorUtils.newGuid();
        this.currentBo.layer = 3;
        this.currentBo.parentID = this.parentId;
        this.currentBo.sysInit = '0';
        this.currentBo.isSysInit = false;
        this.currentBo.isDetail = '0';
        /** @type {?} */
        var max = this.boCreatorUtils.getMaxOrder(this.suList, this.currentBo.parentID);
        this.currentBo.sortOrder = max + 1;
        return Object.assign(new BusinessObjectEntity(), this.currentBo);
    };
    /**
     * @return {?}
     */
    SuCreatorModalComponent.prototype.suInfoValidator = /**
     * @return {?}
     */
    function () {
        //新增信息空校验
        /** @type {?} */
        var result = this.emptyValidator();
        if (result.illegal) {
            return result;
        }
        //编号，名称命名规范性校验
        result = this.namingConventionValidator();
        if (result.illegal) {
            return result;
        }
        //APP编号重复校验
        return this.repeatValidator();
    };
    /**
     * @return {?}
     */
    SuCreatorModalComponent.prototype.emptyValidator = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var result = new ValidatorResult();
        if (!this.parentId) {
            result.illegal = true;
            result.message = "\u5173\u952E\u5E94\u7528\u4E0D\u80FD\u4E3A\u7A7A";
            return result;
        }
        if (!this.currentBo.code) {
            result.illegal = true;
            result.message = "\u670D\u52A1\u5355\u5143\u7684\u7F16\u53F7\u4E0D\u80FD\u4E3A\u7A7A";
            return result;
        }
        if (!this.currentBo.name) {
            result.illegal = true;
            result.message = "\u670D\u52A1\u5355\u5143\u7684\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A";
            return result;
        }
        return result;
    };
    /**
     * @return {?}
     */
    SuCreatorModalComponent.prototype.namingConventionValidator = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var result = new ValidatorResult();
        /** @type {?} */
        var codeRegx = new RegExp('^[a-zA-Z\x7f-\xff][a-zA-Z0-9\x7f-\xff]*$');
        if (!codeRegx.test(this.currentBo.code)) {
            result.illegal = true;
            result.message = '服务单元的编号只能包含字母,数字,并且不可以用数字开头!';
            return result;
        }
        /** @type {?} */
        var nameRegx = new RegExp('[`~!@#$^&*()=|{}\':;\',\\[\\].<>/?~！@#￥……&*（）——|{}【】‘；：”“\'。，、？]');
        if (nameRegx.test(this.currentBo.name)) {
            result.illegal = true;
            result.message = '服务单元的名称包含非法字符，请重新输入!';
            return result;
        }
        return result;
    };
    /**
     * @return {?}
     */
    SuCreatorModalComponent.prototype.repeatValidator = /**
     * @return {?}
     */
    function () {
        var _this = this;
        /** @type {?} */
        var result = new ValidatorResult();
        if (!this.suList || this.suList.length <= 0) {
            return result;
        }
        /** @type {?} */
        var repeatCodeBO = this.suList.find((/**
         * @param {?} bo
         * @return {?}
         */
        function (bo) { return bo.code.toLowerCase() === _this.currentBo.code.toLowerCase() && bo.layer == 3; }));
        if (repeatCodeBO) {
            result.illegal = true;
            result.message = '微服务的编号不能与已有微服务编号重复，编号为：' + this.currentBo.code;
            return result;
        }
        return result;
    };
    SuCreatorModalComponent.decorators = [
        { type: Component, args: [{
                    selector: 'app-su-creator-modal',
                    template: "<div class=\"cloumn\" style=\"margin-top: 28px;\">\r\n  <div class=\"row suInfo\">\r\n    <label class=\"col-form-label ps-col-form-label\">\r\n      <span class=\"farris-label-info text-danger\">*</span>\r\n      <span class=\"farris-label-text\">\u5173\u952E\u5E94\u7528</span>\r\n    </label>\r\n    <div class=\"col-{{inputLength}}\">\r\n      <farris-combo-list [(ngModel)]=\"parentId\" [idField]=\"'id'\" [textField]=\"'name'\" [data]=\"items\"\r\n        (selectChange)=\"appSelectChanged($event)\" [panelHeight]=\"280\" [editable]=\"false\"></farris-combo-list>\r\n    </div>\r\n  </div>\r\n\r\n  <div class=\"row suInfo\">\r\n    <!-- <div class=\"col-{{labelLength}}\">\u7F16\u53F7</div> -->\r\n    <label class=\"col-form-label ps-col-form-label\">\r\n      <span class=\"farris-label-info text-danger\">*</span>\r\n      <span class=\"farris-label-text\">\u7F16\u53F7</span>\r\n    </label>\r\n    <div class=\"col-{{inputLength}}\">\r\n      <input-group [(ngModel)]=\"currentBo.code\" #boCode=\"ngModel\" required></input-group>\r\n    </div>\r\n    <!-- <div [hidden]=\"boCode.valid || boCode.pristine\" class=\"alert-danger\">\r\n      \u7F16\u53F7\u4E0D\u80FD\u4E3A\u7A7A\r\n    </div> -->\r\n  </div>\r\n  <div class=\"row suInfo\">\r\n    <label class=\"col-form-label ps-col-form-label\">\r\n      <span class=\"farris-label-info text-danger\">*</span>\r\n      <span class=\"farris-label-text\">\u540D\u79F0</span>\r\n    </label>\r\n    <!-- <div class=\"col-{{labelLength}}\">\u540D\u79F0</div> -->\r\n    <div class=\"col-{{inputLength}}\">\r\n      <input-group [(ngModel)]=\"currentBo.name\" #boName=\"ngModel\" required></input-group>\r\n    </div>\r\n    <!-- <div [hidden]=\"boName.valid || boName.pristine\" class=\"alert-danger\">\r\n      \u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A\r\n    </div> -->\r\n  </div>\r\n\r\n</div>",
                    styles: [".sucreator-wrapper{background:rgba(255,255,255,.8);width:95%;margin:40px auto 0;max-width:480px;padding:24px 18px;border-radius:8px;position:relative;z-index:100}.suInfo{margin:0 0 16px 20px}.sucreator-wrapper .col-form-label,.sucreator-wrapper .form-control{padding-top:3px;padding-bottom:3px}.sucreator-wrapper .col-form-label{width:70px;margin-right:12px;text-align:right;flex-shrink:0}.bocreator{background:#fff;box-shadow:0 2px 16px 0 rgba(0,0,0,.1);border-radius:4px}.boCreatorPanel{background-color:#fff}div .ps-col-form-label{width:94px;text-align:right}"]
                }] }
    ];
    /** @nocollapse */
    SuCreatorModalComponent.ctorParameters = function () { return [
        { type: BoCreatorUtils },
        { type: BusinessObjectDtService },
        { type: NotifyService }
    ]; };
    SuCreatorModalComponent.propDecorators = {
        parentId: [{ type: Input }],
        suConfirmEmitter: [{ type: Output }],
        appSelector: [{ type: ViewChild, args: ["appSelector",] }]
    };
    return SuCreatorModalComponent;
}());
export { SuCreatorModalComponent };
if (false) {
    /** @type {?} */
    SuCreatorModalComponent.prototype.parentId;
    /** @type {?} */
    SuCreatorModalComponent.prototype.suConfirmEmitter;
    /** @type {?} */
    SuCreatorModalComponent.prototype.appSelector;
    /**
     * 当前BO节点
     * @type {?}
     */
    SuCreatorModalComponent.prototype.currentBo;
    /**
     * 关键应用集合
     * @type {?}
     */
    SuCreatorModalComponent.prototype.items;
    /**
     * 选择应用节点下的所有服务单元集合
     * @type {?}
     */
    SuCreatorModalComponent.prototype.suList;
    /**
     * 所有业务对象节点集合
     * @type {?}
     */
    SuCreatorModalComponent.prototype.data;
    /** @type {?} */
    SuCreatorModalComponent.prototype.parent;
    /** @type {?} */
    SuCreatorModalComponent.prototype.labelLength;
    /** @type {?} */
    SuCreatorModalComponent.prototype.inputLength;
    /**
     * @type {?}
     * @private
     */
    SuCreatorModalComponent.prototype.boCreatorUtils;
    /**
     * @type {?}
     * @private
     */
    SuCreatorModalComponent.prototype.boDtService;
    /**
     * @type {?}
     * @private
     */
    SuCreatorModalComponent.prototype.notifyService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3UtY3JlYXRvci1tb2RhbC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZ3NwLWxjbS9iby1jcmVhdG9yLyIsInNvdXJjZXMiOlsibGliL3ZpZXdzL2JvLWNyZWF0b3IvbW9kYWwvc3UtbW9kYWwvc3UtY3JlYXRvci1tb2RhbC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFVLFlBQVksRUFBRSxNQUFNLEVBQUUsS0FBSyxFQUFFLFNBQVMsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUMxRixPQUFPLEVBQUUsb0JBQW9CLEVBQUUsdUJBQXVCLEVBQUUsTUFBTSx3QkFBd0IsQ0FBQztBQUN2RixPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sNkJBQTZCLENBQUM7QUFDN0QsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBQ2xELE9BQU8sRUFBRSxrQkFBa0IsRUFBRSxNQUFNLHVCQUF1QixDQUFDO0FBQzNELE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxnQ0FBZ0MsQ0FBQztBQUVqRTtJQXNDSSxpQ0FDWSxjQUE2QixFQUM3QixXQUFvQyxFQUNwQyxhQUE0QjtRQUY1QixtQkFBYyxHQUFkLGNBQWMsQ0FBZTtRQUM3QixnQkFBVyxHQUFYLFdBQVcsQ0FBeUI7UUFDcEMsa0JBQWEsR0FBYixhQUFhLENBQWU7UUFoQzlCLHFCQUFnQixHQUFzQixJQUFJLFlBQVksRUFBTyxDQUFDOzs7O1FBT3hFLGNBQVMsR0FBeUIsSUFBSSxvQkFBb0IsRUFBRSxDQUFDOzs7O1FBSzdELFVBQUssR0FBeUIsRUFBRSxDQUFDOzs7O1FBS2pDLFdBQU0sR0FBeUIsRUFBRSxDQUFDOzs7O1FBS2xDLFNBQUksR0FBTyxFQUFFLENBQUM7UUFFZCxXQUFNLEdBQXVCLElBQUksb0JBQW9CLEVBQUUsQ0FBQztRQUV4RCxnQkFBVyxHQUFHLEdBQUcsQ0FBQztRQUNsQixnQkFBVyxHQUFHLEdBQUcs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V2pCLEtBQUs7bUNBRUwsTUFBTTs4QkFFTixTQUFTLFNBQUMsYUFBYTs7SUF1SjVCLDhCQUFDO0NBQUEsQUFsS0QsSUFrS0M7U0E3SlksdUJBQXVCOzs7SUFFaEMsMkNBQXlCOztJQUV6QixtREFBd0U7O0lBRXhFLDhDQUEwRDs7Ozs7SUFLMUQsNENBQTZEOzs7OztJQUs3RCx3Q0FBaUM7Ozs7O0lBS2pDLHlDQUFrQzs7Ozs7SUFLbEMsdUNBQWM7O0lBRWQseUNBQXdEOztJQUV4RCw4Q0FBa0I7O0lBQ2xCLDhDQUFrQjs7Ozs7SUFHZCxpREFBcUM7Ozs7O0lBQ3JDLDhDQUE0Qzs7Ozs7SUFDNUMsZ0RBQW9DIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBPbkluaXQsIEV2ZW50RW1pdHRlciwgT3V0cHV0LCBJbnB1dCwgVmlld0NoaWxkIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IEJ1c2luZXNzT2JqZWN0RW50aXR5LCBCdXNpbmVzc09iamVjdER0U2VydmljZSB9IGZyb20gJ0Bnc3AtbGNtL2JvLWR0LXNlcnZpY2UnO1xyXG5pbXBvcnQgeyBCb0NyZWF0b3JVdGlscyB9IGZyb20gJy4uLy4uL3V0aWxzL2JvLWNyZWF0ZS11dGlscyc7XHJcbmltcG9ydCB7IE5vdGlmeVNlcnZpY2UgfSBmcm9tICdAZmFycmlzL3VpLW5vdGlmeSc7XHJcbmltcG9ydCB7IENvbWJvTGlzdENvbXBvbmVudCB9IGZyb20gJ0BmYXJyaXMvdWktY29tYm8tbGlzdCc7XHJcbmltcG9ydCB7IFZhbGlkYXRvclJlc3VsdCB9IGZyb20gJy4uLy4uL2NvbW1vbi92YWxpZGF0aW9uLXJlc3VsdCc7XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICAgIHNlbGVjdG9yOiAnYXBwLXN1LWNyZWF0b3ItbW9kYWwnLFxyXG4gICAgdGVtcGxhdGVVcmw6ICcuL3N1LWNyZWF0b3ItbW9kYWwuY29tcG9uZW50Lmh0bWwnLFxyXG4gICAgc3R5bGVVcmxzOiBbJy4vc3UtY3JlYXRvci1tb2RhbC5jb21wb25lbnQuY3NzJ11cclxufSlcclxuZXhwb3J0IGNsYXNzIFN1Q3JlYXRvck1vZGFsQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcclxuXHJcbiAgICBASW5wdXQoKSBwYXJlbnRJZDpzdHJpbmc7XHJcblxyXG4gICAgQE91dHB1dCgpIHN1Q29uZmlybUVtaXR0ZXI6IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XHJcblxyXG4gICAgQFZpZXdDaGlsZChcImFwcFNlbGVjdG9yXCIpIGFwcFNlbGVjdG9yOiBDb21ib0xpc3RDb21wb25lbnQ7XHJcbiAgICBcclxuICAgIC8qKlxyXG4gICAgICog5b2T5YmNQk/oioLngrlcclxuICAgICAqL1xyXG4gICAgY3VycmVudEJvOiBCdXNpbmVzc09iamVjdEVudGl0eSA9IG5ldyBCdXNpbmVzc09iamVjdEVudGl0eSgpO1xyXG5cclxuICAgIC8qKlxyXG4gICAgICog5YWz6ZSu5bqU55So6ZuG5ZCIXHJcbiAgICAgKi9cclxuICAgIGl0ZW1zOiBCdXNpbmVzc09iamVjdEVudGl0eVtdPVtdO1xyXG5cclxuICAgIC8qKlxyXG4gICAgICog6YCJ5oup5bqU55So6IqC54K55LiL55qE5omA5pyJ5pyN5Yqh5Y2V5YWD6ZuG5ZCIXHJcbiAgICAgKi9cclxuICAgIHN1TGlzdDogQnVzaW5lc3NPYmplY3RFbnRpdHlbXT1bXTtcclxuXHJcbiAgICAvKipcclxuICAgICAqIOaJgOacieS4muWKoeWvueixoeiKgueCuembhuWQiFxyXG4gICAgICovXHJcbiAgICBkYXRhOmFueVtdPVtdO1xyXG5cclxuICAgIHBhcmVudDogQnVzaW5lc3NPYmplY3RFbnRpdHk9bmV3IEJ1c2luZXNzT2JqZWN0RW50aXR5KCk7XHJcblxyXG4gICAgbGFiZWxMZW5ndGggPSAnMic7XHJcbiAgICBpbnB1dExlbmd0aCA9ICc5JztcclxuXHJcbiAgICBjb25zdHJ1Y3RvcihcclxuICAgICAgICBwcml2YXRlIGJvQ3JlYXRvclV0aWxzOkJvQ3JlYXRvclV0aWxzLFxyXG4gICAgICAgIHByaXZhdGUgYm9EdFNlcnZpY2U6IEJ1c2luZXNzT2JqZWN0RHRTZXJ2aWNlLFxyXG4gICAgICAgIHByaXZhdGUgbm90aWZ5U2VydmljZTogTm90aWZ5U2VydmljZSkgeyB9XHJcblxyXG4gICAgbmdPbkluaXQoKSB7XHJcbiAgICAgICAgdGhpcy5pbml0RGF0YSgpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgaW5pdERhdGEoKSB7XHJcbiAgICAgICAgdGhpcy5ib0R0U2VydmljZS5nZXRCdXNpbmVzc09iamVjdHMoKS5zdWJzY3JpYmUoZGF0YSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuZGF0YSA9IGRhdGE7XHJcbiAgICAgICAgICAgIHRoaXMuaXRlbXMgPSBkYXRhLmZpbHRlcihpdGVtID0+IGl0ZW0ubGF5ZXIgPT09IDIpO1xyXG4gICAgICAgICAgICB0aGlzLnN1TGlzdCA9IGRhdGEuZmlsdGVyKGl0ZW0gPT4gaXRlbS5sYXllciA9PT0gMyk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgYXBwU2VsZWN0Q2hhbmdlZCgkZXZlbnQpIHtcclxuICAgICAgICB0aGlzLnBhcmVudCA9ICRldmVudC5kYXRhO1xyXG4gICAgfVxyXG5cclxuICAgIGNyZWF0ZSgpe1xyXG4gICAgICAgIGxldCBibz10aGlzLmdldEN1cnJlbnRCbygpO1xyXG4gICAgICAgIGlmKCFibyl7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5ib0R0U2VydmljZS5zYXZlKGJvKS5zdWJzY3JpYmUoXHJcbiAgICAgICAgICAgICgpID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMuc3VDb25maXJtRW1pdHRlci5lbWl0KGJvKTtcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgZXJyb3IgPT4ge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5ub3RpZnlTZXJ2aWNlLmVycm9yKCfliJvlu7rlpLHotKUnKTtcclxuICAgICAgICAgICAgICAgIHRocm93IGVycm9yO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgKTtcclxuICAgIH1cclxuXHJcbiAgICBnZXRDdXJyZW50Qm8oKXtcclxuICAgICAgICBsZXQgcmVzdWx0PXRoaXMuc3VJbmZvVmFsaWRhdG9yKCk7XHJcbiAgICAgICAgaWYocmVzdWx0LmlsbGVnYWwpeyBcclxuICAgICAgICAgICAgdGhpcy5ub3RpZnlTZXJ2aWNlLndhcm5pbmcocmVzdWx0Lm1lc3NhZ2UpO1xyXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5jdXJyZW50Qm8uaWQgPSB0aGlzLmJvQ3JlYXRvclV0aWxzLm5ld0d1aWQoKTtcclxuICAgICAgICB0aGlzLmN1cnJlbnRCby5sYXllciA9IDM7XHJcbiAgICAgICAgdGhpcy5jdXJyZW50Qm8ucGFyZW50SUQgPSB0aGlzLnBhcmVudElkO1xyXG4gICAgICAgIHRoaXMuY3VycmVudEJvLnN5c0luaXQgPSAnMCc7XHJcbiAgICAgICAgdGhpcy5jdXJyZW50Qm8uaXNTeXNJbml0ID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy5jdXJyZW50Qm8uaXNEZXRhaWwgPSAnMCc7XHJcbiAgICAgICAgbGV0IG1heCA9IHRoaXMuYm9DcmVhdG9yVXRpbHMuZ2V0TWF4T3JkZXIodGhpcy5zdUxpc3QsIHRoaXMuY3VycmVudEJvLnBhcmVudElEKTtcclxuICAgICAgICB0aGlzLmN1cnJlbnRCby5zb3J0T3JkZXIgPSBtYXggKyAxO1xyXG4gICAgICAgIHJldHVybiBPYmplY3QuYXNzaWduKG5ldyBCdXNpbmVzc09iamVjdEVudGl0eSgpLHRoaXMuY3VycmVudEJvKTtcclxuICAgIH1cclxuXHJcbiAgICBzdUluZm9WYWxpZGF0b3IoKTogVmFsaWRhdG9yUmVzdWx0IHtcclxuXHJcbiAgICAgICAgLy/mlrDlop7kv6Hmga/nqbrmoKHpqoxcclxuICAgICAgICBsZXQgcmVzdWx0ID0gdGhpcy5lbXB0eVZhbGlkYXRvcigpO1xyXG4gICAgICAgIGlmIChyZXN1bHQuaWxsZWdhbCkge1xyXG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy/nvJblj7fvvIzlkI3np7Dlkb3lkI3op4TojIPmgKfmoKHpqoxcclxuICAgICAgICByZXN1bHQgPSB0aGlzLm5hbWluZ0NvbnZlbnRpb25WYWxpZGF0b3IoKTtcclxuICAgICAgICBpZiAocmVzdWx0LmlsbGVnYWwpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vQVBQ57yW5Y+36YeN5aSN5qCh6aqMXHJcbiAgICAgICAgcmV0dXJuIHRoaXMucmVwZWF0VmFsaWRhdG9yKCk7XHJcblxyXG4gICAgfVxyXG5cclxuICAgIGVtcHR5VmFsaWRhdG9yKCk6IFZhbGlkYXRvclJlc3VsdCB7XHJcbiAgICAgICAgbGV0IHJlc3VsdCA9IG5ldyBWYWxpZGF0b3JSZXN1bHQoKTtcclxuICAgICAgICBpZighdGhpcy5wYXJlbnRJZCl7XHJcbiAgICAgICAgICAgIHJlc3VsdC5pbGxlZ2FsID0gdHJ1ZTtcclxuICAgICAgICAgICAgcmVzdWx0Lm1lc3NhZ2UgPSBg5YWz6ZSu5bqU55So5LiN6IO95Li656m6YDtcclxuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKCF0aGlzLmN1cnJlbnRCby5jb2RlKSB7XHJcbiAgICAgICAgICAgIHJlc3VsdC5pbGxlZ2FsID0gdHJ1ZTtcclxuICAgICAgICAgICAgcmVzdWx0Lm1lc3NhZ2UgPSBg5pyN5Yqh5Y2V5YWD55qE57yW5Y+35LiN6IO95Li656m6YDtcclxuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKCF0aGlzLmN1cnJlbnRCby5uYW1lKSB7XHJcbiAgICAgICAgICAgIHJlc3VsdC5pbGxlZ2FsID0gdHJ1ZTtcclxuICAgICAgICAgICAgcmVzdWx0Lm1lc3NhZ2UgPSBg5pyN5Yqh5Y2V5YWD55qE5ZCN56ew5LiN6IO95Li656m6YDtcclxuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgIH1cclxuXHJcbiAgICBuYW1pbmdDb252ZW50aW9uVmFsaWRhdG9yKCk6IFZhbGlkYXRvclJlc3VsdCB7XHJcbiAgICAgICAgbGV0IHJlc3VsdCA9IG5ldyBWYWxpZGF0b3JSZXN1bHQoKTtcclxuICAgICAgICBjb25zdCBjb2RlUmVneCA9IG5ldyBSZWdFeHAoJ15bYS16QS1aXFx4N2YtXFx4ZmZdW2EtekEtWjAtOVxceDdmLVxceGZmXSokJyk7XHJcbiAgICAgICAgaWYgKCFjb2RlUmVneC50ZXN0KHRoaXMuY3VycmVudEJvLmNvZGUpKSB7XHJcbiAgICAgICAgICAgIHJlc3VsdC5pbGxlZ2FsID0gdHJ1ZTtcclxuICAgICAgICAgICAgcmVzdWx0Lm1lc3NhZ2UgPSAn5pyN5Yqh5Y2V5YWD55qE57yW5Y+35Y+q6IO95YyF5ZCr5a2X5q+NLOaVsOWtlyzlubbkuJTkuI3lj6/ku6XnlKjmlbDlrZflvIDlpLQhJztcclxuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc3QgbmFtZVJlZ3ggPSBuZXcgUmVnRXhwKCdbYH4hQCMkXiYqKCk9fHt9XFwnOjtcXCcsXFxcXFtcXFxcXS48Pi8/fu+8gUAj77+l4oCm4oCmJirvvIjvvInigJTigJR8e33jgJDjgJHigJjvvJvvvJrigJ3igJxcXCfjgILvvIzjgIHvvJ9dJyk7XHJcbiAgICAgICAgaWYgKG5hbWVSZWd4LnRlc3QodGhpcy5jdXJyZW50Qm8ubmFtZSkpIHtcclxuICAgICAgICAgICAgcmVzdWx0LmlsbGVnYWwgPSB0cnVlO1xyXG4gICAgICAgICAgICByZXN1bHQubWVzc2FnZSA9ICfmnI3liqHljZXlhYPnmoTlkI3np7DljIXlkKvpnZ7ms5XlrZfnrKbvvIzor7fph43mlrDovpPlhaUhJztcclxuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgIH1cclxuXHJcbiAgICByZXBlYXRWYWxpZGF0b3IoKTogVmFsaWRhdG9yUmVzdWx0IHtcclxuICAgICAgICBsZXQgcmVzdWx0ID0gbmV3IFZhbGlkYXRvclJlc3VsdCgpO1xyXG4gICAgICAgIGlmICghdGhpcy5zdUxpc3QgfHwgdGhpcy5zdUxpc3QubGVuZ3RoIDw9IDApIHtcclxuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc3QgcmVwZWF0Q29kZUJPID0gdGhpcy5zdUxpc3QuZmluZChibyA9PiBiby5jb2RlLnRvTG93ZXJDYXNlKCkgPT09IHRoaXMuY3VycmVudEJvLmNvZGUudG9Mb3dlckNhc2UoKSAmJiBiby5sYXllciA9PSAzKTtcclxuICAgICAgICBpZiAocmVwZWF0Q29kZUJPKSB7XHJcbiAgICAgICAgICAgIHJlc3VsdC5pbGxlZ2FsID0gdHJ1ZTtcclxuICAgICAgICAgICAgcmVzdWx0Lm1lc3NhZ2UgPSAn5b6u5pyN5Yqh55qE57yW5Y+35LiN6IO95LiO5bey5pyJ5b6u5pyN5Yqh57yW5Y+36YeN5aSN77yM57yW5Y+35Li677yaJyArIHRoaXMuY3VycmVudEJvLmNvZGU7XHJcbiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICAgICAgfSBcclxuICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgfVxyXG5cclxufVxyXG4iXX0=
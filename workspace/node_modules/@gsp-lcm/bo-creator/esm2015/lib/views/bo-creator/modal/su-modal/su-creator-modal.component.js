/**
 * @fileoverview added by tsickle
 * Generated from: lib/views/bo-creator/modal/su-modal/su-creator-modal.component.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, EventEmitter, Output, Input, ViewChild } from '@angular/core';
import { BusinessObjectEntity, BusinessObjectDtService } from '@gsp-lcm/bo-dt-service';
import { BoCreatorUtils } from '../../utils/bo-create-utils';
import { NotifyService } from '@farris/ui-notify';
import { ComboListComponent } from '@farris/ui-combo-list';
import { ValidatorResult } from '../../common/validation-result';
export class SuCreatorModalComponent {
    /**
     * @param {?} boCreatorUtils
     * @param {?} boDtService
     * @param {?} notifyService
     */
    constructor(boCreatorUtils, boDtService, notifyService) {
        this.boCreatorUtils = boCreatorUtils;
        this.boDtService = boDtService;
        this.notifyService = notifyService;
        this.suConfirmEmitter = new EventEmitter();
        /**
         * 当前BO节点
         */
        this.currentBo = new BusinessObjectEntity();
        /**
         * 关键应用集合
         */
        this.items = [];
        /**
         * 选择应用节点下的所有服务单元集合
         */
        this.suList = [];
        /**
         * 所有业务对象节点集合
         */
        this.data = [];
        this.parent = new BusinessObjectEntity();
        this.labelLength = '2';
        this.inputLength = '9';
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.initData();
    }
    /**
     * @private
     * @return {?}
     */
    initData() {
        this.boDtService.getBusinessObjects().subscribe((/**
         * @param {?} data
         * @return {?}
         */
        data => {
            this.data = data;
            this.items = data.filter((/**
             * @param {?} item
             * @return {?}
             */
            item => item.layer === 2));
            this.suList = data.filter((/**
             * @param {?} item
             * @return {?}
             */
            item => item.layer === 3));
        }));
    }
    /**
     * @param {?} $event
     * @return {?}
     */
    appSelectChanged($event) {
        this.parent = $event.data;
    }
    /**
     * @return {?}
     */
    create() {
        /** @type {?} */
        let bo = this.getCurrentBo();
        if (!bo) {
            return;
        }
        this.boDtService.save(bo).subscribe((/**
         * @return {?}
         */
        () => {
            this.suConfirmEmitter.emit(bo);
        }), (/**
         * @param {?} error
         * @return {?}
         */
        error => {
            this.notifyService.error('创建失败');
            throw error;
        }));
    }
    /**
     * @return {?}
     */
    getCurrentBo() {
        /** @type {?} */
        let result = this.suInfoValidator();
        if (result.illegal) {
            this.notifyService.warning(result.message);
            return null;
        }
        this.currentBo.id = this.boCreatorUtils.newGuid();
        this.currentBo.layer = 3;
        this.currentBo.parentID = this.parentId;
        this.currentBo.sysInit = '0';
        this.currentBo.isSysInit = false;
        this.currentBo.isDetail = '0';
        /** @type {?} */
        let max = this.boCreatorUtils.getMaxOrder(this.suList, this.currentBo.parentID);
        this.currentBo.sortOrder = max + 1;
        return Object.assign(new BusinessObjectEntity(), this.currentBo);
    }
    /**
     * @return {?}
     */
    suInfoValidator() {
        //新增信息空校验
        /** @type {?} */
        let result = this.emptyValidator();
        if (result.illegal) {
            return result;
        }
        //编号，名称命名规范性校验
        result = this.namingConventionValidator();
        if (result.illegal) {
            return result;
        }
        //APP编号重复校验
        return this.repeatValidator();
    }
    /**
     * @return {?}
     */
    emptyValidator() {
        /** @type {?} */
        let result = new ValidatorResult();
        if (!this.parentId) {
            result.illegal = true;
            result.message = `关键应用不能为空`;
            return result;
        }
        if (!this.currentBo.code) {
            result.illegal = true;
            result.message = `服务单元的编号不能为空`;
            return result;
        }
        if (!this.currentBo.name) {
            result.illegal = true;
            result.message = `服务单元的名称不能为空`;
            return result;
        }
        return result;
    }
    /**
     * @return {?}
     */
    namingConventionValidator() {
        /** @type {?} */
        let result = new ValidatorResult();
        /** @type {?} */
        const codeRegx = new RegExp('^[a-zA-Z\x7f-\xff][a-zA-Z0-9\x7f-\xff]*$');
        if (!codeRegx.test(this.currentBo.code)) {
            result.illegal = true;
            result.message = '服务单元的编号只能包含字母,数字,并且不可以用数字开头!';
            return result;
        }
        /** @type {?} */
        const nameRegx = new RegExp('[`~!@#$^&*()=|{}\':;\',\\[\\].<>/?~！@#￥……&*（）——|{}【】‘；：”“\'。，、？]');
        if (nameRegx.test(this.currentBo.name)) {
            result.illegal = true;
            result.message = '服务单元的名称包含非法字符，请重新输入!';
            return result;
        }
        return result;
    }
    /**
     * @return {?}
     */
    repeatValidator() {
        /** @type {?} */
        let result = new ValidatorResult();
        if (!this.suList || this.suList.length <= 0) {
            return result;
        }
        /** @type {?} */
        const repeatCodeBO = this.suList.find((/**
         * @param {?} bo
         * @return {?}
         */
        bo => bo.code.toLowerCase() === this.currentBo.code.toLowerCase() && bo.layer == 3));
        if (repeatCodeBO) {
            result.illegal = true;
            result.message = '微服务的编号不能与已有微服务编号重复，编号为：' + this.currentBo.code;
            return result;
        }
        return result;
    }
}
SuCreatorModalComponent.decorators = [
    { type: Component, args: [{
                selector: 'app-su-creator-modal',
                template: "<div class=\"cloumn\" style=\"margin-top: 28px;\">\r\n  <div class=\"row suInfo\">\r\n    <label class=\"col-form-label ps-col-form-label\">\r\n      <span class=\"farris-label-info text-danger\">*</span>\r\n      <span class=\"farris-label-text\">\u5173\u952E\u5E94\u7528</span>\r\n    </label>\r\n    <div class=\"col-{{inputLength}}\">\r\n      <farris-combo-list [(ngModel)]=\"parentId\" [idField]=\"'id'\" [textField]=\"'name'\" [data]=\"items\"\r\n        (selectChange)=\"appSelectChanged($event)\" [panelHeight]=\"280\" [editable]=\"false\"></farris-combo-list>\r\n    </div>\r\n  </div>\r\n\r\n  <div class=\"row suInfo\">\r\n    <!-- <div class=\"col-{{labelLength}}\">\u7F16\u53F7</div> -->\r\n    <label class=\"col-form-label ps-col-form-label\">\r\n      <span class=\"farris-label-info text-danger\">*</span>\r\n      <span class=\"farris-label-text\">\u7F16\u53F7</span>\r\n    </label>\r\n    <div class=\"col-{{inputLength}}\">\r\n      <input-group [(ngModel)]=\"currentBo.code\" #boCode=\"ngModel\" required></input-group>\r\n    </div>\r\n    <!-- <div [hidden]=\"boCode.valid || boCode.pristine\" class=\"alert-danger\">\r\n      \u7F16\u53F7\u4E0D\u80FD\u4E3A\u7A7A\r\n    </div> -->\r\n  </div>\r\n  <div class=\"row suInfo\">\r\n    <label class=\"col-form-label ps-col-form-label\">\r\n      <span class=\"farris-label-info text-danger\">*</span>\r\n      <span class=\"farris-label-text\">\u540D\u79F0</span>\r\n    </label>\r\n    <!-- <div class=\"col-{{labelLength}}\">\u540D\u79F0</div> -->\r\n    <div class=\"col-{{inputLength}}\">\r\n      <input-group [(ngModel)]=\"currentBo.name\" #boName=\"ngModel\" required></input-group>\r\n    </div>\r\n    <!-- <div [hidden]=\"boName.valid || boName.pristine\" class=\"alert-danger\">\r\n      \u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A\r\n    </div> -->\r\n  </div>\r\n\r\n</div>",
                styles: [".sucreator-wrapper{background:rgba(255,255,255,.8);width:95%;margin:40px auto 0;max-width:480px;padding:24px 18px;border-radius:8px;position:relative;z-index:100}.suInfo{margin:0 0 16px 20px}.sucreator-wrapper .col-form-label,.sucreator-wrapper .form-control{padding-top:3px;padding-bottom:3px}.sucreator-wrapper .col-form-label{width:70px;margin-right:12px;text-align:right;flex-shrink:0}.bocreator{background:#fff;box-shadow:0 2px 16px 0 rgba(0,0,0,.1);border-radius:4px}.boCreatorPanel{background-color:#fff}div .ps-col-form-label{width:94px;text-align:right}"]
            }] }
];
/** @nocollapse */
SuCreatorModalComponent.ctorParameters = () => [
    { type: BoCreatorUtils },
    { type: BusinessObjectDtService },
    { type: NotifyService }
];
SuCreatorModalComponent.propDecorators = {
    parentId: [{ type: Input }],
    suConfirmEmitter: [{ type: Output }],
    appSelector: [{ type: ViewChild, args: ["appSelector",] }]
};
if (false) {
    /** @type {?} */
    SuCreatorModalComponent.prototype.parentId;
    /** @type {?} */
    SuCreatorModalComponent.prototype.suConfirmEmitter;
    /** @type {?} */
    SuCreatorModalComponent.prototype.appSelector;
    /**
     * 当前BO节点
     * @type {?}
     */
    SuCreatorModalComponent.prototype.currentBo;
    /**
     * 关键应用集合
     * @type {?}
     */
    SuCreatorModalComponent.prototype.items;
    /**
     * 选择应用节点下的所有服务单元集合
     * @type {?}
     */
    SuCreatorModalComponent.prototype.suList;
    /**
     * 所有业务对象节点集合
     * @type {?}
     */
    SuCreatorModalComponent.prototype.data;
    /** @type {?} */
    SuCreatorModalComponent.prototype.parent;
    /** @type {?} */
    SuCreatorModalComponent.prototype.labelLength;
    /** @type {?} */
    SuCreatorModalComponent.prototype.inputLength;
    /**
     * @type {?}
     * @private
     */
    SuCreatorModalComponent.prototype.boCreatorUtils;
    /**
     * @type {?}
     * @private
     */
    SuCreatorModalComponent.prototype.boDtService;
    /**
     * @type {?}
     * @private
     */
    SuCreatorModalComponent.prototype.notifyService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3UtY3JlYXRvci1tb2RhbC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZ3NwLWxjbS9iby1jcmVhdG9yLyIsInNvdXJjZXMiOlsibGliL3ZpZXdzL2JvLWNyZWF0b3IvbW9kYWwvc3UtbW9kYWwvc3UtY3JlYXRvci1tb2RhbC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFVLFlBQVksRUFBRSxNQUFNLEVBQUUsS0FBSyxFQUFFLFNBQVMsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUMxRixPQUFPLEVBQUUsb0JBQW9CLEVBQUUsdUJBQXVCLEVBQUUsTUFBTSx3QkFBd0IsQ0FBQztBQUN2RixPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sNkJBQTZCLENBQUM7QUFDN0QsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBQ2xELE9BQU8sRUFBRSxrQkFBa0IsRUFBRSxNQUFNLHVCQUF1QixDQUFDO0FBQzNELE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxnQ0FBZ0MsQ0FBQztBQU9qRSxNQUFNLE9BQU8sdUJBQXVCOzs7Ozs7SUFpQ2hDLFlBQ1ksY0FBNkIsRUFDN0IsV0FBb0MsRUFDcEMsYUFBNEI7UUFGNUIsbUJBQWMsR0FBZCxjQUFjLENBQWU7UUFDN0IsZ0JBQVcsR0FBWCxXQUFXLENBQXlCO1FBQ3BDLGtCQUFhLEdBQWIsYUFBYSxDQUFlO1FBaEM5QixxQkFBZ0IsR0FBc0IsSUFBSSxZQUFZLEVBQU8sQ0FBQzs7OztRQU94RSxjQUFTLEdBQXlCLElBQUksb0JBQW9CLEVBQUUsQ0FBQzs7OztRQUs3RCxVQUFLLEdBQXlCLEVBQUUsQ0FBQzs7OztRQUtqQyxXQUFNLEdBQXlCLEVBQUUsQ0FBQzs7OztRQUtsQyxTQUFJLEdBQU8sRUFBRSxDQUFDO1FBRWQsV0FBTSxHQUF1QixJQUFJLG9CQUFvQixFQUFFLENBQUM7UUFFeEQsZ0JBQVcsR0FBRyxHQUFHLENBQUM7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N0Qsd0NBQWlDOzs7OztJQUtqQyx5Q0FBa0M7Ozs7O0lBS2xDLHVDQUFjOztJQUVkLHlDQUF3RDs7SUFFeEQsOENBQWtCOztJQUNsQiw4Q0FBa0I7Ozs7O0lBR2QsaURBQXFDOzs7OztJQUNyQyw4Q0FBNEM7Ozs7O0lBQzVDLGdEQUFvQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgT25Jbml0LCBFdmVudEVtaXR0ZXIsIE91dHB1dCwgSW5wdXQsIFZpZXdDaGlsZCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBCdXNpbmVzc09iamVjdEVudGl0eSwgQnVzaW5lc3NPYmplY3REdFNlcnZpY2UgfSBmcm9tICdAZ3NwLWxjbS9iby1kdC1zZXJ2aWNlJztcclxuaW1wb3J0IHsgQm9DcmVhdG9yVXRpbHMgfSBmcm9tICcuLi8uLi91dGlscy9iby1jcmVhdGUtdXRpbHMnO1xyXG5pbXBvcnQgeyBOb3RpZnlTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy91aS1ub3RpZnknO1xyXG5pbXBvcnQgeyBDb21ib0xpc3RDb21wb25lbnQgfSBmcm9tICdAZmFycmlzL3VpLWNvbWJvLWxpc3QnO1xyXG5pbXBvcnQgeyBWYWxpZGF0b3JSZXN1bHQgfSBmcm9tICcuLi8uLi9jb21tb24vdmFsaWRhdGlvbi1yZXN1bHQnO1xyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgICBzZWxlY3RvcjogJ2FwcC1zdS1jcmVhdG9yLW1vZGFsJyxcclxuICAgIHRlbXBsYXRlVXJsOiAnLi9zdS1jcmVhdG9yLW1vZGFsLmNvbXBvbmVudC5odG1sJyxcclxuICAgIHN0eWxlVXJsczogWycuL3N1LWNyZWF0b3ItbW9kYWwuY29tcG9uZW50LmNzcyddXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBTdUNyZWF0b3JNb2RhbENvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCB7XHJcblxyXG4gICAgQElucHV0KCkgcGFyZW50SWQ6c3RyaW5nO1xyXG5cclxuICAgIEBPdXRwdXQoKSBzdUNvbmZpcm1FbWl0dGVyOiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xyXG5cclxuICAgIEBWaWV3Q2hpbGQoXCJhcHBTZWxlY3RvclwiKSBhcHBTZWxlY3RvcjogQ29tYm9MaXN0Q29tcG9uZW50O1xyXG4gICAgXHJcbiAgICAvKipcclxuICAgICAqIOW9k+WJjUJP6IqC54K5XHJcbiAgICAgKi9cclxuICAgIGN1cnJlbnRCbzogQnVzaW5lc3NPYmplY3RFbnRpdHkgPSBuZXcgQnVzaW5lc3NPYmplY3RFbnRpdHkoKTtcclxuXHJcbiAgICAvKipcclxuICAgICAqIOWFs+mUruW6lOeUqOmbhuWQiFxyXG4gICAgICovXHJcbiAgICBpdGVtczogQnVzaW5lc3NPYmplY3RFbnRpdHlbXT1bXTtcclxuXHJcbiAgICAvKipcclxuICAgICAqIOmAieaLqeW6lOeUqOiKgueCueS4i+eahOaJgOacieacjeWKoeWNleWFg+mbhuWQiFxyXG4gICAgICovXHJcbiAgICBzdUxpc3Q6IEJ1c2luZXNzT2JqZWN0RW50aXR5W109W107XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDmiYDmnInkuJrliqHlr7nosaHoioLngrnpm4blkIhcclxuICAgICAqL1xyXG4gICAgZGF0YTphbnlbXT1bXTtcclxuXHJcbiAgICBwYXJlbnQ6IEJ1c2luZXNzT2JqZWN0RW50aXR5PW5ldyBCdXNpbmVzc09iamVjdEVudGl0eSgpO1xyXG5cclxuICAgIGxhYmVsTGVuZ3RoID0gJzInO1xyXG4gICAgaW5wdXRMZW5ndGggPSAnOSc7XHJcblxyXG4gICAgY29uc3RydWN0b3IoXHJcbiAgICAgICAgcHJpdmF0ZSBib0NyZWF0b3JVdGlsczpCb0NyZWF0b3JVdGlscyxcclxuICAgICAgICBwcml2YXRlIGJvRHRTZXJ2aWNlOiBCdXNpbmVzc09iamVjdER0U2VydmljZSxcclxuICAgICAgICBwcml2YXRlIG5vdGlmeVNlcnZpY2U6IE5vdGlmeVNlcnZpY2UpIHsgfVxyXG5cclxuICAgIG5nT25Jbml0KCkge1xyXG4gICAgICAgIHRoaXMuaW5pdERhdGEoKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGluaXREYXRhKCkge1xyXG4gICAgICAgIHRoaXMuYm9EdFNlcnZpY2UuZ2V0QnVzaW5lc3NPYmplY3RzKCkuc3Vic2NyaWJlKGRhdGEgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLmRhdGEgPSBkYXRhO1xyXG4gICAgICAgICAgICB0aGlzLml0ZW1zID0gZGF0YS5maWx0ZXIoaXRlbSA9PiBpdGVtLmxheWVyID09PSAyKTtcclxuICAgICAgICAgICAgdGhpcy5zdUxpc3QgPSBkYXRhLmZpbHRlcihpdGVtID0+IGl0ZW0ubGF5ZXIgPT09IDMpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIGFwcFNlbGVjdENoYW5nZWQoJGV2ZW50KSB7XHJcbiAgICAgICAgdGhpcy5wYXJlbnQgPSAkZXZlbnQuZGF0YTtcclxuICAgIH1cclxuXHJcbiAgICBjcmVhdGUoKXtcclxuICAgICAgICBsZXQgYm89dGhpcy5nZXRDdXJyZW50Qm8oKTtcclxuICAgICAgICBpZighYm8pe1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuYm9EdFNlcnZpY2Uuc2F2ZShibykuc3Vic2NyaWJlKFxyXG4gICAgICAgICAgICAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnN1Q29uZmlybUVtaXR0ZXIuZW1pdChibyk7XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGVycm9yID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMubm90aWZ5U2VydmljZS5lcnJvcign5Yib5bu65aSx6LSlJyk7XHJcbiAgICAgICAgICAgICAgICB0aHJvdyBlcnJvcjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICk7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0Q3VycmVudEJvKCl7XHJcbiAgICAgICAgbGV0IHJlc3VsdD10aGlzLnN1SW5mb1ZhbGlkYXRvcigpO1xyXG4gICAgICAgIGlmKHJlc3VsdC5pbGxlZ2FsKXsgXHJcbiAgICAgICAgICAgIHRoaXMubm90aWZ5U2VydmljZS53YXJuaW5nKHJlc3VsdC5tZXNzYWdlKTtcclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuY3VycmVudEJvLmlkID0gdGhpcy5ib0NyZWF0b3JVdGlscy5uZXdHdWlkKCk7XHJcbiAgICAgICAgdGhpcy5jdXJyZW50Qm8ubGF5ZXIgPSAzO1xyXG4gICAgICAgIHRoaXMuY3VycmVudEJvLnBhcmVudElEID0gdGhpcy5wYXJlbnRJZDtcclxuICAgICAgICB0aGlzLmN1cnJlbnRCby5zeXNJbml0ID0gJzAnO1xyXG4gICAgICAgIHRoaXMuY3VycmVudEJvLmlzU3lzSW5pdCA9IGZhbHNlO1xyXG4gICAgICAgIHRoaXMuY3VycmVudEJvLmlzRGV0YWlsID0gJzAnO1xyXG4gICAgICAgIGxldCBtYXggPSB0aGlzLmJvQ3JlYXRvclV0aWxzLmdldE1heE9yZGVyKHRoaXMuc3VMaXN0LCB0aGlzLmN1cnJlbnRCby5wYXJlbnRJRCk7XHJcbiAgICAgICAgdGhpcy5jdXJyZW50Qm8uc29ydE9yZGVyID0gbWF4ICsgMTtcclxuICAgICAgICByZXR1cm4gT2JqZWN0LmFzc2lnbihuZXcgQnVzaW5lc3NPYmplY3RFbnRpdHkoKSx0aGlzLmN1cnJlbnRCbyk7XHJcbiAgICB9XHJcblxyXG4gICAgc3VJbmZvVmFsaWRhdG9yKCk6IFZhbGlkYXRvclJlc3VsdCB7XHJcblxyXG4gICAgICAgIC8v5paw5aKe5L+h5oGv56m65qCh6aqMXHJcbiAgICAgICAgbGV0IHJlc3VsdCA9IHRoaXMuZW1wdHlWYWxpZGF0b3IoKTtcclxuICAgICAgICBpZiAocmVzdWx0LmlsbGVnYWwpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8v57yW5Y+377yM5ZCN56ew5ZG95ZCN6KeE6IyD5oCn5qCh6aqMXHJcbiAgICAgICAgcmVzdWx0ID0gdGhpcy5uYW1pbmdDb252ZW50aW9uVmFsaWRhdG9yKCk7XHJcbiAgICAgICAgaWYgKHJlc3VsdC5pbGxlZ2FsKSB7XHJcbiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvL0FQUOe8luWPt+mHjeWkjeagoemqjFxyXG4gICAgICAgIHJldHVybiB0aGlzLnJlcGVhdFZhbGlkYXRvcigpO1xyXG5cclxuICAgIH1cclxuXHJcbiAgICBlbXB0eVZhbGlkYXRvcigpOiBWYWxpZGF0b3JSZXN1bHQge1xyXG4gICAgICAgIGxldCByZXN1bHQgPSBuZXcgVmFsaWRhdG9yUmVzdWx0KCk7XHJcbiAgICAgICAgaWYoIXRoaXMucGFyZW50SWQpe1xyXG4gICAgICAgICAgICByZXN1bHQuaWxsZWdhbCA9IHRydWU7XHJcbiAgICAgICAgICAgIHJlc3VsdC5tZXNzYWdlID0gYOWFs+mUruW6lOeUqOS4jeiDveS4uuepumA7XHJcbiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICghdGhpcy5jdXJyZW50Qm8uY29kZSkge1xyXG4gICAgICAgICAgICByZXN1bHQuaWxsZWdhbCA9IHRydWU7XHJcbiAgICAgICAgICAgIHJlc3VsdC5tZXNzYWdlID0gYOacjeWKoeWNleWFg+eahOe8luWPt+S4jeiDveS4uuepumA7XHJcbiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICghdGhpcy5jdXJyZW50Qm8ubmFtZSkge1xyXG4gICAgICAgICAgICByZXN1bHQuaWxsZWdhbCA9IHRydWU7XHJcbiAgICAgICAgICAgIHJlc3VsdC5tZXNzYWdlID0gYOacjeWKoeWNleWFg+eahOWQjeensOS4jeiDveS4uuepumA7XHJcbiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICB9XHJcblxyXG4gICAgbmFtaW5nQ29udmVudGlvblZhbGlkYXRvcigpOiBWYWxpZGF0b3JSZXN1bHQge1xyXG4gICAgICAgIGxldCByZXN1bHQgPSBuZXcgVmFsaWRhdG9yUmVzdWx0KCk7XHJcbiAgICAgICAgY29uc3QgY29kZVJlZ3ggPSBuZXcgUmVnRXhwKCdeW2EtekEtWlxceDdmLVxceGZmXVthLXpBLVowLTlcXHg3Zi1cXHhmZl0qJCcpO1xyXG4gICAgICAgIGlmICghY29kZVJlZ3gudGVzdCh0aGlzLmN1cnJlbnRCby5jb2RlKSkge1xyXG4gICAgICAgICAgICByZXN1bHQuaWxsZWdhbCA9IHRydWU7XHJcbiAgICAgICAgICAgIHJlc3VsdC5tZXNzYWdlID0gJ+acjeWKoeWNleWFg+eahOe8luWPt+WPquiDveWMheWQq+Wtl+avjSzmlbDlrZcs5bm25LiU5LiN5Y+v5Lul55So5pWw5a2X5byA5aS0ISc7XHJcbiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IG5hbWVSZWd4ID0gbmV3IFJlZ0V4cCgnW2B+IUAjJF4mKigpPXx7fVxcJzo7XFwnLFxcXFxbXFxcXF0uPD4vP37vvIFAI++/peKApuKApiYq77yI77yJ4oCU4oCUfHt944CQ44CR4oCY77yb77ya4oCd4oCcXFwn44CC77yM44CB77yfXScpO1xyXG4gICAgICAgIGlmIChuYW1lUmVneC50ZXN0KHRoaXMuY3VycmVudEJvLm5hbWUpKSB7XHJcbiAgICAgICAgICAgIHJlc3VsdC5pbGxlZ2FsID0gdHJ1ZTtcclxuICAgICAgICAgICAgcmVzdWx0Lm1lc3NhZ2UgPSAn5pyN5Yqh5Y2V5YWD55qE5ZCN56ew5YyF5ZCr6Z2e5rOV5a2X56ym77yM6K+36YeN5paw6L6T5YWlISc7XHJcbiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICB9XHJcblxyXG4gICAgcmVwZWF0VmFsaWRhdG9yKCk6IFZhbGlkYXRvclJlc3VsdCB7XHJcbiAgICAgICAgbGV0IHJlc3VsdCA9IG5ldyBWYWxpZGF0b3JSZXN1bHQoKTtcclxuICAgICAgICBpZiAoIXRoaXMuc3VMaXN0IHx8IHRoaXMuc3VMaXN0Lmxlbmd0aCA8PSAwKSB7XHJcbiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IHJlcGVhdENvZGVCTyA9IHRoaXMuc3VMaXN0LmZpbmQoYm8gPT4gYm8uY29kZS50b0xvd2VyQ2FzZSgpID09PSB0aGlzLmN1cnJlbnRCby5jb2RlLnRvTG93ZXJDYXNlKCkgJiYgYm8ubGF5ZXIgPT0gMyk7XHJcbiAgICAgICAgaWYgKHJlcGVhdENvZGVCTykge1xyXG4gICAgICAgICAgICByZXN1bHQuaWxsZWdhbCA9IHRydWU7XHJcbiAgICAgICAgICAgIHJlc3VsdC5tZXNzYWdlID0gJ+W+ruacjeWKoeeahOe8luWPt+S4jeiDveS4juW3suacieW+ruacjeWKoee8luWPt+mHjeWkje+8jOe8luWPt+S4uu+8micgKyB0aGlzLmN1cnJlbnRCby5jb2RlO1xyXG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgICAgIH0gXHJcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgIH1cclxuXHJcbn1cclxuIl19
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/common"),require("@farris/ui-input-group"),require("@angular/forms"),require("@progress/kendo-angular-inputs"),require("@farris/ui-combo-list"),require("@angular/core"),require("@gsp-lcm/bo-dt-service"),require("@farris/ui-notify")):"function"==typeof define&&define.amd?define("@gsp-lcm/bo-creator",["exports","@angular/common","@farris/ui-input-group","@angular/forms","@progress/kendo-angular-inputs","@farris/ui-combo-list","@angular/core","@gsp-lcm/bo-dt-service","@farris/ui-notify"],e):e((t["gsp-lcm"]=t["gsp-lcm"]||{},t["gsp-lcm"]["bo-creator"]={}),t.ng.common,t.uiInputGroup,t.ng.forms,t.kendoAngularInputs,t.uiComboList,t.ng.core,t.boDtService,t.uiNotify)}(this,function(t,e,r,n,o,i,a,s,l){"use strict";var p=(c.prototype.ngOnInit=function(){},c.prototype.appConfirmEmitterHandler=function(t){var e=t;this.createdAfterOk.emit(e),this.modalClosed.emit()},c.prototype.suConfirmEmitterHandler=function(t){var e=t;this.createdAfterOk.emit(e),this.modalClosed.emit()},c.prototype.boConfirmEmitterHandler=function(t){var e=t;this.createdAfterOk.emit(e),this.modalClosed.emit()},c.prototype.btnOkClick=function(){switch(this.type){case"app":return void this.appCmp.create();case"su":return void this.suCmp.create();case"bo":return void this.boCmp.create();default:return}},c.prototype.hideModal=function(){this.modalClosed.emit()},c.decorators=[{type:a.Component,args:[{selector:"app-bo-creator",template:'<div class="bo-creator farris-main-area flex-column farris-overflow-hidden">\r\n\r\n  <div *ngIf="type===\'app\'" class="modal-body boCreatorPanel">\r\n    <app-app-creator-modal #appModal (appConfirmEmitter)="appConfirmEmitterHandler($event)"></app-app-creator-modal>\r\n  </div>\r\n\r\n  <div *ngIf="type===\'su\'" class="modal-body boCreatorPanel">\r\n    <app-su-creator-modal #suModal (suConfirmEmitter)="suConfirmEmitterHandler($event)" [(parentId)]="parentId">\r\n    </app-su-creator-modal>\r\n  </div>\r\n\r\n  <div *ngIf="type ===\'bo\'" class="modal-body boCreatorPanel">\r\n    <app-bo-creator-modal #boModal (boConfirmEmitter)="boConfirmEmitterHandler($event)" [(_parentId)]="parentId">\r\n    </app-bo-creator-modal>\r\n  </div>\r\n\r\n  <div class="modal-footer btns" #btns>\r\n    <button type="button" class="btn btn-default btn-primary" (click)="btnOkClick()">确定</button>\r\n    <button type="button" class="btn btn-default" (click)="hideModal()">取消</button>\r\n  </div>\r\n</div>',styles:[".sucreator-wrapper{background:rgba(255,255,255,.8);width:95%;margin:40px auto 0;max-width:480px;padding:24px 18px;border-radius:8px;position:relative;z-index:100}.suInfo{margin:0 0 16px 20px}.sucreator-wrapper .col-form-label,.sucreator-wrapper .form-control{padding-top:3px;padding-bottom:3px}.sucreator-wrapper .col-form-label{width:70px;margin-right:12px;text-align:right;flex-shrink:0}.bocreator{background:#fff;box-shadow:0 2px 16px 0 rgba(0,0,0,.1);border-radius:4px}.boCreatorPanel{background-color:#fff}"]}]}],c.ctorParameters=function(){return[]},c.propDecorators={createdAfterOk:[{type:a.Output}],modalClosed:[{type:a.Output}],parentId:[{type:a.Input}],type:[{type:a.Input}],appCmp:[{type:a.ViewChild,args:["appModal"]}],suCmp:[{type:a.ViewChild,args:["suModal"]}],boCmp:[{type:a.ViewChild,args:["boModal"]}]},c);function c(){this.createdAfterOk=new a.EventEmitter,this.modalClosed=new a.EventEmitter}var u=function B(){this.illegal=!1},d=(f.prototype.newGuid=function(){return this.s4()+this.s4()+"-"+this.s4()+"-"+this.s4()+"-"+this.s4()+"-"+this.s4()+this.s4()+this.s4()},f.prototype.s4=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)},f.prototype.getMaxOrder=function(t,e){var r=0,n=t.filter(function(t){return t.parentID===e});return n===undefined||null===n||n.length<=0||n.forEach(function(t){t.sortOrder>r&&(r=t.sortOrder)}),r},f.decorators=[{type:a.Injectable}],f);function f(){}var g=(b.prototype.ngOnInit=function(){this.initData()},b.prototype.initData=function(){var e=this;this.boDtService.getBusinessObjects().subscribe(function(t){t&&(e.apps=t.filter(function(t){return 2===t.layer}),e.parent=t.find(function(t){return 1===t.layer}))})},b.prototype.create=function(){var e=this,t=this.getCurrentBo();t&&this.boDtService.save(t).subscribe(function(){e.appConfirmEmitter.emit(t)},function(t){throw e.notifyService.error("创建失败"),t})},b.prototype.getCurrentBo=function(){var t=this.appInfoValidator();if(t.illegal)return this.notifyService.warning(t.message),null;this.currentBo.id=this.boCreatorUtils.newGuid(),this.currentBo.layer=2,this.currentBo.parentID=this.parent.id,this.currentBo.sysInit="0",this.currentBo.isSysInit=!1,this.currentBo.isDetail="0";var e=this.boCreatorUtils.getMaxOrder(this.apps,this.currentBo.parentID);return this.currentBo.sortOrder=e+1,Object.assign(new s.BusinessObjectEntity,this.currentBo)},b.prototype.appInfoValidator=function(){var t=this.emptyValidator();return t.illegal||(t=this.namingConventionValidator()).illegal?t:this.repeatValidator()},b.prototype.emptyValidator=function(){var t=new u;return this.currentBo.code?this.currentBo.name||(t.illegal=!0,t.message="关键应用的名称不能为空"):(t.illegal=!0,t.message="关键应用的编号不能为空"),t},b.prototype.namingConventionValidator=function(){var t=new u;return new RegExp("^[a-zA-Z-ÿ][a-zA-Z0-9-ÿ]*$").test(this.currentBo.code)?new RegExp("[`~!@#$^&*()=|{}':;',\\[\\].<>/?~！@#￥……&*（）——|{}【】‘；：”“'。，、？]").test(this.currentBo.name)&&(t.illegal=!0,t.message="关键应用的名称包含非法字符，请重新输入!"):(t.illegal=!0,t.message="关键应用的编号只能包含字母,数字,并且不可以用数字开头!"),t},b.prototype.repeatValidator=function(){var e=this,t=new u;return this.apps.find(function(t){return t.code.toLowerCase()===e.currentBo.code.toLowerCase()})&&(t.illegal=!0,t.message="关键应用的编号"+this.currentBo.code+"已存在"),t},b.decorators=[{type:a.Component,args:[{selector:"app-app-creator-modal",template:'\r\n<div class="cloumn" style="margin-top: 28px;">\r\n\r\n  <div class="app-Info row">\r\n    <label class="col-form-label ps-col-form-label">\r\n      <span class="farris-label-info text-danger">*</span>\r\n      <span class="farris-label-text">应用编号</span>\r\n    </label>\r\n    <div class="col-9">\r\n      <input-group [(ngModel)]="currentBo.code"  autocomplete="off" name="code" ></input-group>\r\n    </div>\r\n  </div>\r\n\r\n  <div class="app-Info row">\r\n    <label class="col-form-label ps-col-form-label">\r\n      <span class="farris-label-info text-danger">*</span>\r\n      <span class="farris-label-text">应用名称</span>\r\n    </label>\r\n    <div class="col-9">\r\n      <input-group [(ngModel)]="currentBo.name"  autocomplete="off" name="name" ></input-group>\r\n    </div>\r\n  </div>\r\n\r\n  <div class="app-Info row">\r\n    <label class="col-form-label ps-col-form-label">\r\n      <span class="farris-label-text">应用描述</span>\r\n    </label>\r\n    <div class="col-9">\r\n      <input-group [(ngModel)]="currentBo.description"  autocomplete="off" name="description"></input-group>\r\n    </div>\r\n  </div>\r\n\r\n</div>',styles:[".app-Info{margin:0 0 16px 20px}div .ps-col-form-label{width:94px;text-align:right}"]}]}],b.ctorParameters=function(){return[{type:d},{type:s.BusinessObjectDtService},{type:l.NotifyService}]},b.propDecorators={appConfirmEmitter:[{type:a.Output}]},b);function b(t,e,r){this.boCreatorUtils=t,this.boDtService=e,this.notifyService=r,this.appConfirmEmitter=new a.EventEmitter,this.currentBo=new s.BusinessObjectEntity,this.apps=[]}var m=(h.prototype.ngOnInit=function(){this.initData()},h.prototype.initData=function(){var e=this;this.boDtService.getBusinessObjects().subscribe(function(t){e.data=t,e.items=t.filter(function(t){return 2===t.layer}),e.suList=t.filter(function(t){return 3===t.layer})})},h.prototype.appSelectChanged=function(t){this.parent=t.data},h.prototype.create=function(){var e=this,t=this.getCurrentBo();t&&this.boDtService.save(t).subscribe(function(){e.suConfirmEmitter.emit(t)},function(t){throw e.notifyService.error("创建失败"),t})},h.prototype.getCurrentBo=function(){var t=this.suInfoValidator();if(t.illegal)return this.notifyService.warning(t.message),null;this.currentBo.id=this.boCreatorUtils.newGuid(),this.currentBo.layer=3,this.currentBo.parentID=this.parentId,this.currentBo.sysInit="0",this.currentBo.isSysInit=!1,this.currentBo.isDetail="0";var e=this.boCreatorUtils.getMaxOrder(this.suList,this.currentBo.parentID);return this.currentBo.sortOrder=e+1,Object.assign(new s.BusinessObjectEntity,this.currentBo)},h.prototype.suInfoValidator=function(){var t=this.emptyValidator();return t.illegal||(t=this.namingConventionValidator()).illegal?t:this.repeatValidator()},h.prototype.emptyValidator=function(){var t=new u;return this.parentId?this.currentBo.code?this.currentBo.name||(t.illegal=!0,t.message="服务单元的名称不能为空"):(t.illegal=!0,t.message="服务单元的编号不能为空"):(t.illegal=!0,t.message="关键应用不能为空"),t},h.prototype.namingConventionValidator=function(){var t=new u;return new RegExp("^[a-zA-Z-ÿ][a-zA-Z0-9-ÿ]*$").test(this.currentBo.code)?new RegExp("[`~!@#$^&*()=|{}':;',\\[\\].<>/?~！@#￥……&*（）——|{}【】‘；：”“'。，、？]").test(this.currentBo.name)&&(t.illegal=!0,t.message="服务单元的名称包含非法字符，请重新输入!"):(t.illegal=!0,t.message="服务单元的编号只能包含字母,数字,并且不可以用数字开头!"),t},h.prototype.repeatValidator=function(){var e=this,t=new u;return!this.suList||this.suList.length<=0||this.suList.find(function(t){return t.code.toLowerCase()===e.currentBo.code.toLowerCase()&&3==t.layer})&&(t.illegal=!0,t.message="微服务的编号不能与已有微服务编号重复，编号为："+this.currentBo.code),t},h.decorators=[{type:a.Component,args:[{selector:"app-su-creator-modal",template:'<div class="cloumn" style="margin-top: 28px;">\r\n  <div class="row suInfo">\r\n    <label class="col-form-label ps-col-form-label">\r\n      <span class="farris-label-info text-danger">*</span>\r\n      <span class="farris-label-text">关键应用</span>\r\n    </label>\r\n    <div class="col-{{inputLength}}">\r\n      <farris-combo-list [(ngModel)]="parentId" [idField]="\'id\'" [textField]="\'name\'" [data]="items"\r\n        (selectChange)="appSelectChanged($event)" [panelHeight]="280" [editable]="false"></farris-combo-list>\r\n    </div>\r\n  </div>\r\n\r\n  <div class="row suInfo">\r\n    \x3c!-- <div class="col-{{labelLength}}">编号</div> --\x3e\r\n    <label class="col-form-label ps-col-form-label">\r\n      <span class="farris-label-info text-danger">*</span>\r\n      <span class="farris-label-text">编号</span>\r\n    </label>\r\n    <div class="col-{{inputLength}}">\r\n      <input-group [(ngModel)]="currentBo.code" #boCode="ngModel" required></input-group>\r\n    </div>\r\n    \x3c!-- <div [hidden]="boCode.valid || boCode.pristine" class="alert-danger">\r\n      编号不能为空\r\n    </div> --\x3e\r\n  </div>\r\n  <div class="row suInfo">\r\n    <label class="col-form-label ps-col-form-label">\r\n      <span class="farris-label-info text-danger">*</span>\r\n      <span class="farris-label-text">名称</span>\r\n    </label>\r\n    \x3c!-- <div class="col-{{labelLength}}">名称</div> --\x3e\r\n    <div class="col-{{inputLength}}">\r\n      <input-group [(ngModel)]="currentBo.name" #boName="ngModel" required></input-group>\r\n    </div>\r\n    \x3c!-- <div [hidden]="boName.valid || boName.pristine" class="alert-danger">\r\n      名称不能为空\r\n    </div> --\x3e\r\n  </div>\r\n\r\n</div>',styles:[".sucreator-wrapper{background:rgba(255,255,255,.8);width:95%;margin:40px auto 0;max-width:480px;padding:24px 18px;border-radius:8px;position:relative;z-index:100}.suInfo{margin:0 0 16px 20px}.sucreator-wrapper .col-form-label,.sucreator-wrapper .form-control{padding-top:3px;padding-bottom:3px}.sucreator-wrapper .col-form-label{width:70px;margin-right:12px;text-align:right;flex-shrink:0}.bocreator{background:#fff;box-shadow:0 2px 16px 0 rgba(0,0,0,.1);border-radius:4px}.boCreatorPanel{background-color:#fff}div .ps-col-form-label{width:94px;text-align:right}"]}]}],h.ctorParameters=function(){return[{type:d},{type:s.BusinessObjectDtService},{type:l.NotifyService}]},h.propDecorators={parentId:[{type:a.Input}],suConfirmEmitter:[{type:a.Output}],appSelector:[{type:a.ViewChild,args:["appSelector"]}]},h);function h(t,e,r){this.boCreatorUtils=t,this.boDtService=e,this.notifyService=r,this.suConfirmEmitter=new a.EventEmitter,this.currentBo=new s.BusinessObjectEntity,this.items=[],this.suList=[],this.data=[],this.parent=new s.BusinessObjectEntity,this.labelLength="2",this.inputLength="9"}var v=(Object.defineProperty(y.prototype,"_parentId",{set:function(t){this.parentId=t,this.getParentBo()},enumerable:!0,configurable:!0}),y.prototype.ngOnInit=function(){this.initData()},y.prototype.initData=function(){var e=this;this.boDtService.getBusinessObjects().subscribe(function(r){e.data=r,e.items=r.filter(function(t){return t.parentID===e.parentId&&4===t.layer&&"0"===t.isDetail});var t=r.filter(function(t){return t.parentID===e.parentId}),n=[];t.forEach(function(e){if("0"==e.isDetail){n.push(e);var t=r.filter(function(t){return t.parentID===e.id});t&&t.forEach(function(t){n.push(t)})}else n.push(e)}),e.bosInSU=n})},y.prototype.create=function(){var e=this,t=this.getCurrentBo();t&&this.boDtService.save(t).subscribe(function(){e.boConfirmEmitter.emit(t)},function(t){throw e.notifyService.error("创建失败"),t})},y.prototype.getCurrentBo=function(){var t=this.boInfoValidator();if(t.illegal)return this.notifyService.warning(t.message),null;this.currentBo.id=this.boCreatorUtils.newGuid(),this.currentBo.layer=this.parentBo?this.parentBo.layer+1:4,this.currentBo.parentID=this.parentBo&&this.parentBo.id?this.parentBo.id:this.parentId,this.currentBo.sysInit="0",this.currentBo.isSysInit=!1,this.currentBo.isDetail="1";var e=this.boCreatorUtils.getMaxOrder(this.bosInSU,this.currentBo.parentID);return this.currentBo.sortOrder=e+1,Object.assign(new s.BusinessObjectEntity,this.currentBo)},y.prototype.boInfoValidator=function(){var t=this.emptyValidator();return t.illegal||(t=this.namingConventionValidator()).illegal?t:this.repeatValidator()},y.prototype.emptyValidator=function(){var t=new u;return this.suCode?this.currentBo.code?this.currentBo.name||(t.illegal=!0,t.message="业务对象的名称不能为空"):(t.illegal=!0,t.message="业务对象的编号不能为空"):(t.illegal=!0,t.message="所属微服务不能为空"),t},y.prototype.namingConventionValidator=function(){var t=new u;return new RegExp("^[a-zA-Z-ÿ][a-zA-Z0-9-ÿ]*$").test(this.currentBo.code)?new RegExp("[`~!@#$^&*()=|{}':;',\\[\\].<>/?~！@#￥……&*（）——|{}【】‘；：”“'。，、？]").test(this.currentBo.name)&&(t.illegal=!0,t.message="业务对象的名称包含非法字符，请重新输入!"):(t.illegal=!0,t.message="业务对象的编号只能包含字母,数字,并且不可以用数字开头!"),t},y.prototype.repeatValidator=function(){var e=this,t=new u;return!this.bosInSU||this.bosInSU.length<=0||this.bosInSU.find(function(t){return t.code.toLowerCase()===e.currentBo.code.toLowerCase()})&&(t.illegal=!0,t.message="同一SU下业务对象/业务对象分组/业务对象与业务对象分组编号不能重复，业务对象编号为："+this.currentBo.code),t},y.prototype.boGroupSelectChanged=function(t){this.parentBo=t.data},y.prototype.getParentBo=function(){var e=this;this.parentId&&this.boDtService.getBusinessObject(this.parentId).subscribe(function(t){e.parentBo=t,e.suCode=t.code})},y.prototype.clearHandler=function(){this.parentBo=null},y.decorators=[{type:a.Component,args:[{selector:"app-bo-creator-modal",template:'<div class="cloumn" style="margin-top: 28px;">\n\n  <div class="suInfo row">\n    <label class="col-form-label ps-col-form-label">\n      <span class="farris-label-info text-danger">*</span>\n      <span class="farris-label-text">所属微服务</span>\n    </label>\n    <div class="col-{{inputLength}}">\n      <input-group [(ngModel)]="suCode" #boCode="ngModel" [readonly]="true"></input-group>\n    </div>\n  </div>\n\n  <div class="row suInfo">\n    <label class="col-form-label ps-col-form-label">\n      <span class="farris-label-text">业务对象分组</span>\n    </label>\n    <div class="col-{{inputLength}}">\n      <farris-combo-list #boGroupSelector [idField]="\'id\'" [textField]="\'name\'" [data]="items"\n        (selectChange)="boGroupSelectChanged($event)" (clear)="clearHandler()" [panelHeight]="280" [editable]="false"></farris-combo-list>\n    </div>\n  </div>\n\n  <div class="row suInfo">\n    <label class="col-form-label ps-col-form-label">\n      <span class="farris-label-info text-danger">*</span>\n      <span class="farris-label-text">编号</span>\n    </label>\n    <div class="col-{{inputLength}}">\n      <input-group [(ngModel)]="currentBo.code" #boCode="ngModel" required></input-group>\n    </div>\n    \x3c!-- <div [hidden]="boCode.valid || boCode.pristine" class="alert-danger">\n      编号不能为空\n    </div> --\x3e\n  </div>\n\n  <div class="row suInfo">\n    <label class="col-form-label ps-col-form-label">\n      <span class="farris-label-info text-danger">*</span>\n      <span class="farris-label-text">名称</span>\n    </label>\n    <div class="col-{{inputLength}}">\n      <input-group [(ngModel)]="currentBo.name" #boName="ngModel" required></input-group>\n    </div>\n    \x3c!-- <div [hidden]="boName.valid || boName.pristine" class="alert-danger">\n      名称不能为空\n    </div> --\x3e\n  </div>\n\n</div>',styles:[".sucreator-wrapper{background:rgba(255,255,255,.8);width:95%;margin:40px auto 0;max-width:480px;padding:24px 18px;border-radius:8px;position:relative;z-index:100}.suInfo{margin:0 0 16px 20px}.sucreator-wrapper .col-form-label,.sucreator-wrapper .form-control{padding-top:3px;padding-bottom:3px}.sucreator-wrapper .col-form-label{width:70px;margin-right:12px;text-align:right;flex-shrink:0}.bocreator{background:#fff;box-shadow:0 2px 16px 0 rgba(0,0,0,.1);border-radius:4px}.boCreatorPanel{background-color:#fff}div .ps-col-form-label{width:94px;text-align:right}"]}]}],y.ctorParameters=function(){return[{type:d},{type:s.BusinessObjectDtService},{type:l.NotifyService}]},y.propDecorators={_parentId:[{type:a.Input}],boConfirmEmitter:[{type:a.Output}],boGroupSelector:[{type:a.ViewChild,args:["boGroupSelector"]}]},y);function y(t,e,r){this.boCreatorUtils=t,this.boDtService=e,this.notifyService=r,this.boConfirmEmitter=new a.EventEmitter,this.currentBo=new s.BusinessObjectEntity,this.items=[],this.suList=[],this.data=[],this.parentBo=new s.BusinessObjectEntity,this.labelLength="2",this.inputLength="9"}var x=(C.decorators=[{type:a.NgModule,args:[{declarations:[p,g,m,v],imports:[e.CommonModule,r.InputGroupModule,n.FormsModule,o.InputsModule,l.NotifyModule.forRoot(),i.ComboListModule,s.BoDtServiceModule],entryComponents:[p],exports:[p,g],providers:[s.BusinessObjectDtService,d]}]}],C);function C(){}t.BOCreatorPackageModule=x,t.BOCreatorComponent=p,t.ɵa=g,t.ɵd=v,t.ɵc=m,t.ɵb=d,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=gsp-lcm-bo-creator.umd.min.js.map
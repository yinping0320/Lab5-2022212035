/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Inject, LOCALE_ID } from '@angular/core';
import { Subject } from 'rxjs';
import { SELECTOR_ARGS_INJECTOR } from '../../config/selector-args-injector.config';
import { FormGetCreationRuleEntityExArgs } from '../../form-args';
import { AifDataService } from '../../service/aif-data.service';
/**
 * @deprecated please use \@edp-bif/runtime-api
 */
var ReferSelectorComponent = /** @class */ (function () {
    function ReferSelectorComponent(args, dataService, localeId) {
        var _this = this;
        this.dataService = dataService;
        //来源VoType列表
        this.sourceVoIdList = [];
        //来源VoType与来源VoName映射
        this.sourceVoNameDict = {};
        //来源VoType与相应的生单规则列表映射
        this.creationRuleDict = {};
        this.bsModalRef4AifSelector = null;
        this.subject4CreationRule = new Subject();
        this.clickOk4AifSelector = (/**
         * @return {?}
         */
        function () {
            _this.subject4CreationRule.next(_this.selectedCreationRule);
            _this.subject4CreationRule.complete();
            _this.bsModalRef4AifSelector.close();
        });
        this.clickClose4AifSelector = (/**
         * @return {?}
         */
        function () {
            _this.bsModalRef4AifSelector.close();
        });
        this.args = new FormGetCreationRuleEntityExArgs();
        this.args.LoadFromJsonObject(args);
    }
    Object.defineProperty(ReferSelectorComponent.prototype, "selectedSourceVoId", {
        get: /**
         * @return {?}
         */
        function () {
            return this._selectedSourceVoId;
        },
        set: /**
         * @param {?} sourceVoId
         * @return {?}
         */
        function (sourceVoId) {
            this._selectedSourceVoId = sourceVoId;
            if (sourceVoId != null) {
                this.selectedCreationRule = this.creationRuleDict[this._selectedSourceVoId][0];
            }
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    ReferSelectorComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        this.loadItems();
    };
    /**
     * @private
     * @return {?}
     */
    ReferSelectorComponent.prototype.loadItems = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        /** @type {?} */
        var list$ = null;
        if (this.args.sourceVoId == null) {
            if (this.args.bizFlowchartId == null) {
                list$ = this.dataService.getSlimCreationRulesByTargetVoId(this.args.targetVoId);
            }
            else {
                list$ = this.dataService.getSlimCreationRulesByTargetVoIdAndFlowchartId(this.args.targetVoId, this.args.bizFlowchartId);
            }
        }
        else {
            if (this.args.bizFlowchartId == null) {
                list$ = this.dataService.getSlimCreationRulesBySourceVoIdAndTargetVoId(this.args.sourceVoId, this.args.targetVoId);
            }
            else {
                list$ = this.dataService.getSlimCreationRulesBySourceVoIdAndTargetVoIdAndFlowchartId(this.args.sourceVoId, this.args.targetVoId, this.args.bizFlowchartId);
            }
        }
        list$.subscribe((/**
         * @param {?} result
         * @return {?}
         */
        function (result) {
            /** @type {?} */
            var list = result;
            list.forEach((/**
             * @param {?} elt
             * @return {?}
             */
            function (elt) {
                if (_this.sourceVoIdList.includes(elt.sourceVoId) === false) {
                    _this.sourceVoIdList.push(elt.sourceVoId);
                    _this.creationRuleDict[elt.sourceVoId] = new Array();
                }
                _this.sourceVoNameDict[elt.sourceVoId] = elt.sourceVoName;
                _this.creationRuleDict[elt.sourceVoId].push(elt);
            }));
            _this.selectedSourceVoId = _this.sourceVoIdList.length > 0 ? _this.sourceVoIdList[0] : null;
        }));
    };
    ReferSelectorComponent.decorators = [
        { type: Component, args: [{
                    selector: 'lib-refer-selector',
                    template: "<div class=\"g-main p-2\">\r\n  <!--  -->\r\n  <div class=\"form-group\" style=\"height: 150px;overflow-y: auto;\">\r\n    <div [hidden]=\"sourceVoIdList.length != 0\"><span style=\"color: red;\">{{ 'emptyResult' | aifLocale }}</span></div>\r\n    <div>{{ 'selectSourceBillType' | aifLocale }}</div>\r\n    <div *ngFor=\"let sourceVoId of sourceVoIdList;let i=index\" class=\"col-sm-12 col-md-5 form-check form-check-inline\">\r\n      <input class=\"form-check-input\" type=\"radio\" [name]=\"'sourceVoId'+i\" id=\"sourceVoId\" [value]=\"sourceVoId\"\r\n        [(ngModel)]=\"selectedSourceVoId\" />\r\n      <label class=\"form-check-label\" [for]=\"'sourceVoId'+i\">{{sourceVoNameDict[sourceVoId]}}</label>\r\n    </div>\r\n  </div>\r\n\r\n  <!--  -->\r\n  <div class=\"form-group\" style=\"\">\r\n    <div>{{ 'selectCreationRule' | aifLocale }}</div>\r\n    <select class=\"form-control\" name=\"selectedCreationRule\" [(ngModel)]=\"selectedCreationRule\">\r\n      <option *ngFor=\"let cr of creationRuleDict[selectedSourceVoId];\" [ngValue]=\"cr\">\r\n        {{cr.name}}</option>\r\n    </select>\r\n  </div>\r\n\r\n  <!--  -->\r\n  <div class=\"form-group\" style=\"\">\r\n    <div>{{ 'creationRuleDesciption' | aifLocale }}</div>\r\n    <textarea readonly class=\"form-control\" name=\"description\" rows=\"3\"\r\n      [ngModel]=\"selectedCreationRule&&selectedCreationRule.description\"></textarea>\r\n  </div>\r\n</div>",
                    styles: [""]
                }] }
    ];
    /** @nocollapse */
    ReferSelectorComponent.ctorParameters = function () { return [
        { type: undefined, decorators: [{ type: Inject, args: [SELECTOR_ARGS_INJECTOR,] }] },
        { type: AifDataService },
        { type: String, decorators: [{ type: Inject, args: [LOCALE_ID,] }] }
    ]; };
    return ReferSelectorComponent;
}());
export { ReferSelectorComponent };
if (false) {
    /** @type {?} */
    ReferSelectorComponent.prototype.sourceVoIdList;
    /** @type {?} */
    ReferSelectorComponent.prototype.sourceVoNameDict;
    /** @type {?} */
    ReferSelectorComponent.prototype.creationRuleDict;
    /**
     * @type {?}
     * @private
     */
    ReferSelectorComponent.prototype._selectedSourceVoId;
    /** @type {?} */
    ReferSelectorComponent.prototype.selectedCreationRule;
    /** @type {?} */
    ReferSelectorComponent.prototype.bsModalRef4AifSelector;
    /** @type {?} */
    ReferSelectorComponent.prototype.subject4CreationRule;
    /**
     * @type {?}
     * @private
     */
    ReferSelectorComponent.prototype.args;
    /** @type {?} */
    ReferSelectorComponent.prototype.clickOk4AifSelector;
    /** @type {?} */
    ReferSelectorComponent.prototype.clickClose4AifSelector;
    /**
     * @type {?}
     * @private
     */
    ReferSelectorComponent.prototype.dataService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmVmZXItc2VsZWN0b3IuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGVkcC1haWYvcnVudGltZS1hcGkvIiwic291cmNlcyI6WyJsaWIvYWlmLW1hbnVhbC1jcmVhdGlvbi9jb21wb25lbnRzL3JlZmVyLXNlbGVjdG9yL3JlZmVyLXNlbGVjdG9yLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFFLFNBQVMsRUFBVSxNQUFNLEVBQUUsU0FBUyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBRXJFLE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDL0IsT0FBTyxFQUFFLHNCQUFzQixFQUFFLE1BQU0sNENBQTRDLENBQUM7QUFHcEYsT0FBTyxFQUFFLCtCQUErQixFQUErQixNQUFNLGlCQUFpQixDQUFDO0FBQy9GLE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSxnQ0FBZ0MsQ0FBQzs7OztBQUtoRTtJQXVDRSxnQ0FDa0MsSUFBaUMsRUFDekQsV0FBMkIsRUFDaEIsUUFBZ0I7UUFIckMsaUJBT0M7UUFMUyxnQkFBVyxHQUFYLFdBQVcsQ0FBZ0I7O1FBakNyQyxtQkFBYyxHQUFhLEVBQUUsQ0FBQzs7UUFHOUIscUJBQWdCLEdBRVosRUFBRSxDQUFDOztRQUdQLHFCQUFnQixHQUVaLEVBQUUsQ0FBQztRQWlCUCwyQkFBc0IsR0FBZSxJQUFJLENBQUM7UUFDMUMseUJBQW9CLEdBQXVDLElBQUksT0FBTyxFQUFFLENBQUM7UUFnQnpFLHdCQUFtQjs7O1FBQUc7WUFDcEIsS0FBSSxDQUFDLG9CQUFvQixDQUFDLElBQUksQ0FBQyxLQUFJLENBQUMsb0JBQW9CLENBQUMsQ0FBQztZQUMxRCxLQUFJLENBQUMsb0JBQW9CLENBQUMsUUFBUSxFQUFFLENBQUM7WUFDckMsS0FBSSxDQUFDLHNCQUFzQixDQUFDLEtBQUssRUFBRSxDQUFDO1FBQ3RDLENBQUMsRUFBQztRQUVGLDJCQUFzQjs7O1FBQUc7WUFD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QUFDLGNBQWMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDO1FBQzNGLENBQUMsRUFDRixDQUFDO0lBQ0osQ0FBQzs7Z0JBNUZGLFNBQVMsU0FBQztvQkFDVCxRQUFRLEVBQUUsb0JBQW9CO29CQUM5QixtNkNBQThDOztpQkFFL0M7Ozs7Z0RBb0NJLE1BQU0sU0FBQyxzQkFBc0I7Z0JBN0N6QixjQUFjOzZDQStDbEIsTUFBTSxTQUFDLFNBQVM7O0lBbURyQiw2QkFBQztDQUFBLEFBN0ZELElBNkZDO1NBeEZZLHNCQUFzQjs7O0lBR2pDLGdEQUE4Qjs7SUFHOUIsa0RBRU87O0lBR1Asa0RBRU87Ozs7O0lBR1AscURBQW9DOztJQVlwQyxzREFBZ0Q7O0lBRWhELHdEQUEwQzs7SUFDMUMsc0RBQXlFOzs7OztJQUV6RSxzQ0FBOEM7O0lBYzlDLHFEQUlFOztJQUVGLHdEQUVFOzs7OztJQW5CQSw2Q0FBbUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIE9uSW5pdCwgSW5qZWN0LCBMT0NBTEVfSUQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgQnNNb2RhbFJlZiB9IGZyb20gJ0BmYXJyaXMvdWktbW9kYWwnO1xyXG5pbXBvcnQgeyBTdWJqZWN0IH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7IFNFTEVDVE9SX0FSR1NfSU5KRUNUT1IgfSBmcm9tICcuLi8uLi9jb25maWcvc2VsZWN0b3ItYXJncy1pbmplY3Rvci5jb25maWcnO1xyXG5pbXBvcnQgeyBJU2xpbUNyZWF0aW9uUnVsZUVudGl0eUV4IH0gZnJvbSAnQGVkcC1haWYvY29tbW9uLWFwaSc7XHJcbmltcG9ydCB7IElBaWZDcmVhdGlvblJ1bGVTZWxlY3RvckNvbXBvbmVudCB9IGZyb20gJy4uLy4uL2Jhc2UvSUFpZkNyZWF0aW9uUnVsZVNlbGVjdG9yQ29tcG9uZW50JztcclxuaW1wb3J0IHsgRm9ybUdldENyZWF0aW9uUnVsZUVudGl0eUV4QXJncywgR2V0Q3JlYXRpb25SdWxlRW50aXR5RXhBcmdzIH0gZnJvbSAnLi4vLi4vZm9ybS1hcmdzJztcclxuaW1wb3J0IHsgQWlmRGF0YVNlcnZpY2UgfSBmcm9tICcuLi8uLi9zZXJ2aWNlL2FpZi1kYXRhLnNlcnZpY2UnO1xyXG5cclxuLyoqXHJcbiAqIEBkZXByZWNhdGVkIHBsZWFzZSB1c2UgQGVkcC1iaWYvcnVudGltZS1hcGkgXHJcbiAqL1xyXG5AQ29tcG9uZW50KHtcclxuICBzZWxlY3RvcjogJ2xpYi1yZWZlci1zZWxlY3RvcicsXHJcbiAgdGVtcGxhdGVVcmw6ICcuL3JlZmVyLXNlbGVjdG9yLmNvbXBvbmVudC5odG1sJyxcclxuICBzdHlsZVVybHM6IFsnLi9yZWZlci1zZWxlY3Rvci5jb21wb25lbnQuY3NzJ11cclxufSlcclxuZXhwb3J0IGNsYXNzIFJlZmVyU2VsZWN0b3JDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIElBaWZDcmVhdGlvblJ1bGVTZWxlY3RvckNvbXBvbmVudCB7XHJcblxyXG4gIC8v5p2l5rqQVm9UeXBl5YiX6KGoXHJcbiAgc291cmNlVm9JZExpc3Q6IHN0cmluZ1tdID0gW107XHJcblxyXG4gIC8v5p2l5rqQVm9UeXBl5LiO5p2l5rqQVm9OYW1l5pig5bCEXHJcbiAgc291cmNlVm9OYW1lRGljdDoge1xyXG4gICAgW3NvdXJjZVZvSWQ6IHN0cmluZ106IHN0cmluZ1xyXG4gIH0gPSB7fTtcclxuXHJcbiAgLy/mnaXmupBWb1R5cGXkuI7nm7jlupTnmoTnlJ/ljZXop4TliJnliJfooajmmKDlsIRcclxuICBjcmVhdGlvblJ1bGVEaWN0OiB7XHJcbiAgICBbc291cmNlVm9JZDogc3RyaW5nXTogSVNsaW1DcmVhdGlvblJ1bGVFbnRpdHlFeFtdXHJcbiAgfSA9IHt9O1xyXG5cclxuICAvL+mAieS4reeahOadpea6kFZvVHlwZVxyXG4gIHByaXZhdGUgX3NlbGVjdGVkU291cmNlVm9JZDogc3RyaW5nO1xyXG4gIGdldCBzZWxlY3RlZFNvdXJjZVZvSWQoKTogc3RyaW5nIHtcclxuICAgIHJldHVybiB0aGlzLl9zZWxlY3RlZFNvdXJjZVZvSWQ7XHJcbiAgfVxyXG4gIHNldCBzZWxlY3RlZFNvdXJjZVZvSWQoc291cmNlVm9JZDogc3RyaW5nKSB7XHJcbiAgICB0aGlzLl9zZWxlY3RlZFNvdXJjZVZvSWQgPSBzb3VyY2VWb0lkO1xyXG4gICAgaWYgKHNvdXJjZVZvSWQgIT0gbnVsbCkge1xyXG4gICAgICB0aGlzLnNlbGVjdGVkQ3JlYXRpb25SdWxlID0gdGhpcy5jcmVhdGlvblJ1bGVEaWN0W3RoaXMuX3NlbGVjdGVkU291cmNlVm9JZF1bMF07XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvL+mAieS4reeahOeUn+WNleinhOWImVxyXG4gIHNlbGVjdGVkQ3JlYXRpb25SdWxlOiBJU2xpbUNyZWF0aW9uUnVsZUVudGl0eUV4O1xyXG5cclxuICBic01vZGFsUmVmNEFpZlNlbGVjdG9yOiBCc01vZGFsUmVmID0gbnVsbDtcclxuICBzdWJqZWN0NENyZWF0aW9uUnVsZTogU3ViamVjdDxJU2xpbUNyZWF0aW9uUnVsZUVudGl0eUV4PiA9IG5ldyBTdWJqZWN0KCk7XHJcblxyXG4gIHByaXZhdGUgYXJnczogRm9ybUdldENyZWF0aW9uUnVsZUVudGl0eUV4QXJncztcclxuICBjb25zdHJ1Y3RvcihcclxuICAgIEBJbmplY3QoU0VMRUNUT1JfQVJHU19JTkpFQ1RPUikgYXJnczogR2V0Q3JlYXRpb25SdWxlRW50aXR5RXhBcmdzLFxyXG4gICAgcHJpdmF0ZSBkYXRhU2VydmljZTogQWlmRGF0YVNlcnZpY2UsXHJcbiAgICBASW5qZWN0KExPQ0FMRV9JRCkgbG9jYWxlSWQ6IHN0cmluZyxcclxuICApIHtcclxuICAgIHRoaXMuYXJncyA9IG5ldyBGb3JtR2V0Q3JlYXRpb25SdWxlRW50aXR5RXhBcmdzKCk7XHJcbiAgICB0aGlzLmFyZ3MuTG9hZEZyb21Kc29uT2JqZWN0KGFyZ3MpO1xyXG4gIH1cclxuXHJcbiAgbmdPbkluaXQoKSB7XHJcbiAgICB0aGlzLmxvYWRJdGVtcygpO1xyXG4gIH1cclxuXHJcbiAgY2xpY2tPazRBaWZTZWxlY3RvciA9ICgpID0+IHtcclxuICAgIHRoaXMuc3ViamVjdDRDcmVhdGlvblJ1bGUubmV4dCh0aGlzLnNlbGVjdGVkQ3JlYXRpb25SdWxlKTtcclxuICAgIHRoaXMuc3ViamVjdDRDcmVhdGlvblJ1bGUuY29tcGxldGUoKTtcclxuICAgIHRoaXMuYnNNb2RhbFJlZjRBaWZTZWxlY3Rvci5jbG9zZSgpO1xyXG4gIH07XHJcblxyXG4gIGNsaWNrQ2xvc2U0QWlmU2VsZWN0b3IgPSAoKSA9PiB7XHJcbiAgICB0aGlzLmJzTW9kYWxSZWY0QWlmU2VsZWN0b3IuY2xvc2UoKTtcclxuICB9O1xyXG5cclxuICBwcml2YXRlIGxvYWRJdGVtcygpOiB2b2lkIHtcclxuICAgIGxldCBsaXN0JCA9IG51bGw7XHJcbiAgICBpZiAodGhpcy5hcmdzLnNvdXJjZVZvSWQgPT0gbnVsbCkge1xyXG4gICAgICBpZiAodGhpcy5hcmdzLmJpekZsb3djaGFydElkID09IG51bGwpIHtcclxuICAgICAgICBsaXN0JCA9IHRoaXMuZGF0YVNlcnZpY2UuZ2V0U2xpbUNyZWF0aW9uUnVsZXNCeVRhcmdldFZvSWQodGhpcy5hcmdzLnRhcmdldFZvSWQpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGxpc3QkID0gdGhpcy5kYXRhU2VydmljZS5nZXRTbGltQ3JlYXRpb25SdWxlc0J5VGFyZ2V0Vm9JZEFuZEZsb3djaGFydElkKHRoaXMuYXJncy50YXJnZXRWb0lkLCB0aGlzLmFyZ3MuYml6Rmxvd2NoYXJ0SWQpO1xyXG4gICAgICB9XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBpZiAodGhpcy5hcmdzLmJpekZsb3djaGFydElkID09IG51bGwpIHtcclxuICAgICAgICBsaXN0JCA9IHRoaXMuZGF0YVNlcnZpY2UuZ2V0U2xpbUNyZWF0aW9uUnVsZXNCeVNvdXJjZVZvSWRBbmRUYXJnZXRWb0lkKHRoaXMuYXJncy5zb3VyY2VWb0lkLCB0aGlzLmFyZ3MudGFyZ2V0Vm9JZCk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgbGlzdCQgPSB0aGlzLmRhdGFTZXJ2aWNlLmdldFNsaW1DcmVhdGlvblJ1bGVzQnlTb3VyY2VWb0lkQW5kVGFyZ2V0Vm9JZEFuZEZsb3djaGFydElkKHRoaXMuYXJncy5zb3VyY2VWb0lkLCB0aGlzLmFyZ3MudGFyZ2V0Vm9JZCwgdGhpcy5hcmdzLmJpekZsb3djaGFydElkKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgbGlzdCQuc3Vic2NyaWJlKFxyXG4gICAgICAocmVzdWx0OiBJU2xpbUNyZWF0aW9uUnVsZUVudGl0eUV4W10pID0+IHtcclxuICAgICAgICBjb25zdCBsaXN0ID0gcmVzdWx0O1xyXG4gICAgICAgIGxpc3QuZm9yRWFjaChlbHQgPT4ge1xyXG4gICAgICAgICAgaWYgKHRoaXMuc291cmNlVm9JZExpc3QuaW5jbHVkZXMoZWx0LnNvdXJjZVZvSWQpID09PSBmYWxzZSkge1xyXG4gICAgICAgICAgICB0aGlzLnNvdXJjZVZvSWRMaXN0LnB1c2goZWx0LnNvdXJjZVZvSWQpO1xyXG4gICAgICAgICAgICB0aGlzLmNyZWF0aW9uUnVsZURpY3RbZWx0LnNvdXJjZVZvSWRdID0gbmV3IEFycmF5PElTbGltQ3JlYXRpb25SdWxlRW50aXR5RXg+KCk7XHJcbiAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgdGhpcy5zb3VyY2VWb05hbWVEaWN0W2VsdC5zb3VyY2VWb0lkXSA9IGVsdC5zb3VyY2VWb05hbWU7XHJcbiAgICAgICAgICB0aGlzLmNyZWF0aW9uUnVsZURpY3RbZWx0LnNvdXJjZVZvSWRdLnB1c2goZWx0KTtcclxuICAgICAgICB9KTtcclxuICAgICAgICB0aGlzLnNlbGVjdGVkU291cmNlVm9JZCA9IHRoaXMuc291cmNlVm9JZExpc3QubGVuZ3RoID4gMCA/IHRoaXMuc291cmNlVm9JZExpc3RbMF0gOiBudWxsO1xyXG4gICAgICB9XHJcbiAgICApO1xyXG4gIH1cclxufVxyXG4iXX0=
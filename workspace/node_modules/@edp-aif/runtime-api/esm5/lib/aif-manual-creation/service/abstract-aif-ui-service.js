/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { FrameContext } from '@farris/devkit';
import { BsModalService } from '@farris/ui-modal';
import { Injector, ComponentFactoryResolver, NgModuleFactoryLoader, Inject, LOCALE_ID, ReflectiveInjector } from '@angular/core';
import { AifLocalePipe } from '../pipe/locale.pipe';
import { from } from 'rxjs';
import { SELECTOR_ARGS_INJECTOR } from '../config/selector-args-injector.config';
import { switchMap } from 'rxjs/operators';
/**
 * @abstract
 */
var AbstractAifUiService = /** @class */ (function () {
    function AbstractAifUiService(frameContext, modalService, injector, cfr, loader, localeId) {
        this.frameContext = frameContext;
        this.modalService = modalService;
        this.injector = injector;
        this.cfr = cfr;
        this.loader = loader;
        this.localeId = localeId;
        /**
         * 内置模态框配置
         */
        this.defaultModalOptions = {
            title: null,
            width: 650,
            height: 415,
            buttons: null,
            showButtons: null,
        };
        this.aifLocalePipe = new AifLocalePipe(localeId);
    }
    /**
     * @protected
     * @param {?} args
     * @param {?} type
     * @param {?=} modalOptions
     * @param {?=} customSelectorModuleUrl
     * @return {?}
     */
    AbstractAifUiService.prototype.openCreationRuleSelector = /**
     * @protected
     * @param {?} args
     * @param {?} type
     * @param {?=} modalOptions
     * @param {?=} customSelectorModuleUrl
     * @return {?}
     */
    function (args, type, modalOptions, customSelectorModuleUrl) {
        var _this = this;
        if (typeof modalOptions == "string") {
            if (modalOptions == "") {
                throw "modalOptions不可为空";
            }
            modalOptions = JSON.parse(modalOptions);
        }
        modalOptions = modalOptions == null ? this.defaultModalOptions : modalOptions;
        modalOptions.title = modalOptions.title == null ? this.aifLocalePipe.transform("creationRuleSelector") : modalOptions.title;
        /** @type {?} */
        var cmpR = null;
        if (customSelectorModuleUrl == null || customSelectorModuleUrl.trim() == "") {
            /** @type {?} */
            var cmpF = this.cfr.resolveComponentFactory(type);
            /** @type {?} */
            var inj = ReflectiveInjector.resolveAndCreate([
                { provide: SELECTOR_ARGS_INJECTOR, useValue: args.ConvertToJsonObject() },
            ], this.injector);
            cmpR = cmpF.create(inj);
            this.configModalButtons(modalOptions, cmpR);
            cmpR.instance.bsModalRef4AifSelector = this.modalService.show(cmpR, modalOptions);
            return cmpR.instance.subject4CreationRule.asObservable();
        }
        else {
            return from(this.loader.load(customSelectorModuleUrl)).pipe(switchMap((/**
             * @param {?} moduleFactory
             * @return {?}
             */
            function (moduleFactory) {
                /** @type {?} */
                var moduleRef = moduleFactory.create(_this.frameContext.root.injector);
                cmpR = moduleRef.instance.createCreationRuleSelector(_this.frameContext.root.injector);
                _this.configModalButtons(modalOptions, cmpR);
                cmpR.instance.bsModalRef4AifSelector = _this.modalService.show(cmpR, modalOptions);
                return cmpR.instance.subject4CreationRule.asObservable();
            })));
        }
    };
    /**
     * 配置模态框按钮事件
     * @param modalOptions
     * @param cmpR
     */
    /**
     * 配置模态框按钮事件
     * @protected
     * @param {?} modalOptions
     * @param {?} cmpR
     * @return {?}
     */
    AbstractAifUiService.prototype.configModalButtons = /**
     * 配置模态框按钮事件
     * @protected
     * @param {?} modalOptions
     * @param {?} cmpR
     * @return {?}
     */
    function (modalOptions, cmpR) {
        modalOptions.buttons = [
            {
                text: this.aifLocalePipe.transform("confirm"),
                cls: "btn btn-primary",
                handle: cmpR.instance.clickOk4AifSelector,
            },
            {
                text: this.aifLocalePipe.transform("cancel"),
                cls: "btn btn-secondary",
                handle: cmpR.instance.clickClose4AifSelector,
            }
        ];
        modalOptions.showButtons = true;
    };
    /** @nocollapse */
    AbstractAifUiService.ctorParameters = function () { return [
        { type: FrameContext },
        { type: BsModalService },
        { type: Injector },
        { type: ComponentFactoryResolver },
        { type: NgModuleFactoryLoader },
        { type: String, decorators: [{ type: Inject, args: [LOCALE_ID,] }] }
    ]; };
    return AbstractAifUiService;
}());
export { AbstractAifUiService };
if (false) {
    /**
     * 内置模态框配置
     * @type {?}
     * @protected
     */
    AbstractAifUiService.prototype.defaultModalOptions;
    /**
     * @type {?}
     * @protected
     */
    AbstractAifUiService.prototype.aifLocalePipe;
    /**
     * @type {?}
     * @protected
     */
    AbstractAifUiService.prototype.frameContext;
    /**
     * @type {?}
     * @protected
     */
    AbstractAifUiService.prototype.modalService;
    /**
     * @type {?}
     * @protected
     */
    AbstractAifUiService.prototype.injector;
    /**
     * @type {?}
     * @protected
     */
    AbstractAifUiService.prototype.cfr;
    /**
     * @type {?}
     * @protected
     */
    AbstractAifUiService.prototype.loader;
    /**
     * @type {?}
     * @protected
     */
    AbstractAifUiService.prototype.localeId;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYWJzdHJhY3QtYWlmLXVpLXNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZWRwLWFpZi9ydW50aW1lLWFwaS8iLCJzb3VyY2VzIjpbImxpYi9haWYtbWFudWFsLWNyZWF0aW9uL3NlcnZpY2UvYWJzdHJhY3QtYWlmLXVpLXNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUM5QyxPQUFPLEVBQUUsY0FBYyxFQUFnQixNQUFNLGtCQUFrQixDQUFDO0FBQ2hFLE9BQU8sRUFBRSxRQUFRLEVBQUUsd0JBQXdCLEVBQUUscUJBQXFCLEVBQUUsTUFBTSxFQUFFLFNBQVMsRUFBa0Msa0JBQWtCLEVBQXlCLE1BQU0sZUFBZSxDQUFDO0FBQ3hMLE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUVwRCxPQUFPLEVBQWMsSUFBSSxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBR3hDLE9BQU8sRUFBRSxzQkFBc0IsRUFBRSxNQUFNLHlDQUF5QyxDQUFDO0FBQ2pGLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQzs7OztBQUUzQztJQWNJLDhCQUNjLFlBQTBCLEVBQzFCLFlBQTRCLEVBQzVCLFFBQWtCLEVBQ2xCLEdBQTZCLEVBQzdCLE1BQTZCLEVBQ1YsUUFBZ0I7UUFMbkMsaUJBQVksR0FBWixZQUFZLENBQWM7UUFDMUIsaUJBQVksR0FBWixZQUFZLENBQWdCO1FBQzVCLGFBQVEsR0FBUixRQUFRLENBQVU7UUFDbEIsUUFBRyxHQUFILEdBQUcsQ0FBMEI7UUFDN0IsV0FBTSxHQUFOLE1BQU0sQ0FBdUI7UUFDVixhQUFRLEdBQVIsUUFBUSxDQUFROzs7O1FBaEI5Qix3QkFBbUIsR0FBaUI7WUFDbkQsS0FBSyxFQUFFLElBQUk7WUFDWCxLQUFLLEVBQUUsR0FBRztZQUNWLE1BQU0sRUFBRSxHQUFHO1lBQ1gsT0FBTyxFQUFFLElBQUk7WUFD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Q0FBQyxTQUFTLENBQUM7Z0JBQzdDLEdBQUcsRUFBRSxpQkFBaUI7Z0JBQ3RCLE1BQU0sRUFBRSxJQUFJLENBQUMsUUFBUSxDQUFDLG1CQUFtQjthQUM1QztZQUNEO2dCQUNJLElBQUksRUFBRSxJQUFJLENBQUMsYUFBYSxDQUFDLFNBQVMsQ0FBQyxRQUFRLENBQUM7Z0JBQzVDLEdBQUcsRUFBRSxtQkFBbUI7Z0JBQ3hCLE1BQU0sRUFBRSxJQUFJLENBQUMsUUFBUSxDQUFDLHNCQUFzQjthQUMvQztTQUNKLENBQUM7UUFDRixZQUFZLENBQUMsV0FBVyxHQUFHLElBQUksQ0FBQztJQUNwQyxDQUFDOzs7Z0JBN0ZJLFlBQVk7Z0JBQ1osY0FBYztnQkFDZCxRQUFRO2dCQUFFLHdCQUF3QjtnQkFBRSxxQkFBcUI7NkNBNkJ6RCxNQUFNLFNBQUMsU0FBUzs7SUErRHpCLDJCQUFDO0NBQUEsQUFuRkQsSUFtRkM7U0FuRnFCLG9CQUFvQjs7Ozs7OztJQUl0QyxtREFNRTs7Ozs7SUFFRiw2Q0FBdUM7Ozs7O0lBR25DLDRDQUFvQzs7Ozs7SUFDcEMsNENBQXNDOzs7OztJQUN0Qyx3Q0FBNEI7Ozs7O0lBQzVCLG1DQUF1Qzs7Ozs7SUFDdkMsc0NBQXVDOzs7OztJQUN2Qyx3Q0FBNkMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBGcmFtZUNvbnRleHQgfSBmcm9tICdAZmFycmlzL2RldmtpdCc7XHJcbmltcG9ydCB7IEJzTW9kYWxTZXJ2aWNlLCBNb2RhbE9wdGlvbnMgfSBmcm9tICdAZmFycmlzL3VpLW1vZGFsJztcclxuaW1wb3J0IHsgSW5qZWN0b3IsIENvbXBvbmVudEZhY3RvcnlSZXNvbHZlciwgTmdNb2R1bGVGYWN0b3J5TG9hZGVyLCBJbmplY3QsIExPQ0FMRV9JRCwgQ29tcG9uZW50UmVmLCBDb21wb25lbnRGYWN0b3J5LCBSZWZsZWN0aXZlSW5qZWN0b3IsIE5nTW9kdWxlRmFjdG9yeSwgVHlwZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBBaWZMb2NhbGVQaXBlIH0gZnJvbSAnLi4vcGlwZS9sb2NhbGUucGlwZSc7XHJcbmltcG9ydCB7IEZvcm1HZXRDcmVhdGlvblJ1bGVFbnRpdHlFeEFyZ3MgfSBmcm9tICcuLi9mb3JtLWFyZ3MnO1xyXG5pbXBvcnQgeyBPYnNlcnZhYmxlLCBmcm9tIH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7IElTbGltQ3JlYXRpb25SdWxlRW50aXR5RXggfSBmcm9tICdAZWRwLWFpZi9jb21tb24tYXBpJztcclxuaW1wb3J0IHsgSUFpZkNyZWF0aW9uUnVsZVNlbGVjdG9yQ29tcG9uZW50LCBJQWlmQ3JlYXRpb25SdWxlU2VsZWN0b3JNb2R1bGUsIElBaWZTZWxlY3RvckNvbXBvbmVudCB9IGZyb20gJy4uL2Jhc2UnO1xyXG5pbXBvcnQgeyBTRUxFQ1RPUl9BUkdTX0lOSkVDVE9SIH0gZnJvbSAnLi4vY29uZmlnL3NlbGVjdG9yLWFyZ3MtaW5qZWN0b3IuY29uZmlnJztcclxuaW1wb3J0IHsgc3dpdGNoTWFwIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xyXG5cclxuZXhwb3J0IGFic3RyYWN0IGNsYXNzIEFic3RyYWN0QWlmVWlTZXJ2aWNlIHtcclxuICAgIC8qKlxyXG4gICAgICog5YaF572u5qih5oCB5qGG6YWN572uXHJcbiAgICAgKi9cclxuICAgIHByb3RlY3RlZCByZWFkb25seSBkZWZhdWx0TW9kYWxPcHRpb25zOiBNb2RhbE9wdGlvbnMgPSB7XHJcbiAgICAgICAgdGl0bGU6IG51bGwsXHJcbiAgICAgICAgd2lkdGg6IDY1MCxcclxuICAgICAgICBoZWlnaHQ6IDQxNSxcclxuICAgICAgICBidXR0b25zOiBudWxsLFxyXG4gICAgICAgIHNob3dCdXR0b25zOiBudWxsLFxyXG4gICAgfTtcclxuXHJcbiAgICBwcm90ZWN0ZWQgYWlmTG9jYWxlUGlwZTogQWlmTG9jYWxlUGlwZTtcclxuXHJcbiAgICBjb25zdHJ1Y3RvcihcclxuICAgICAgICBwcm90ZWN0ZWQgZnJhbWVDb250ZXh0OiBGcmFtZUNvbnRleHQsXHJcbiAgICAgICAgcHJvdGVjdGVkIG1vZGFsU2VydmljZTogQnNNb2RhbFNlcnZpY2UsXHJcbiAgICAgICAgcHJvdGVjdGVkIGluamVjdG9yOiBJbmplY3RvcixcclxuICAgICAgICBwcm90ZWN0ZWQgY2ZyOiBDb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIsXHJcbiAgICAgICAgcHJvdGVjdGVkIGxvYWRlcjogTmdNb2R1bGVGYWN0b3J5TG9hZGVyLFxyXG4gICAgICAgIEBJbmplY3QoTE9DQUxFX0lEKSBwcm90ZWN0ZWQgbG9jYWxlSWQ6IHN0cmluZyxcclxuICAgICkge1xyXG4gICAgICAgIHRoaXMuYWlmTG9jYWxlUGlwZSA9IG5ldyBBaWZMb2NhbGVQaXBlKGxvY2FsZUlkKTtcclxuICAgIH1cclxuXHJcbiAgICBwcm90ZWN0ZWQgb3BlbkNyZWF0aW9uUnVsZVNlbGVjdG9yKGFyZ3M6IEZvcm1HZXRDcmVhdGlvblJ1bGVFbnRpdHlFeEFyZ3MsIHR5cGU6IFR5cGU8SUFpZkNyZWF0aW9uUnVsZVNlbGVjdG9yQ29tcG9uZW50PiwgbW9kYWxPcHRpb25zPzogTW9kYWxPcHRpb25zLCBjdXN0b21TZWxlY3Rvck1vZHVsZVVybD86IHN0cmluZyk6IE9ic2VydmFibGU8SVNsaW1DcmVhdGlvblJ1bGVFbnRpdHlFeD4ge1xyXG4gICAgICAgIGlmICh0eXBlb2YgbW9kYWxPcHRpb25zID09IFwic3RyaW5nXCIpIHtcclxuICAgICAgICAgICAgaWYgKG1vZGFsT3B0aW9ucyA9PSBcIlwiKSB7XHJcbiAgICAgICAgICAgICAgICB0aHJvdyBcIm1vZGFsT3B0aW9uc+S4jeWPr+S4uuepulwiO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIG1vZGFsT3B0aW9ucyA9IEpTT04ucGFyc2UobW9kYWxPcHRpb25zKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIG1vZGFsT3B0aW9ucyA9IG1vZGFsT3B0aW9ucyA9PSBudWxsID8gdGhpcy5kZWZhdWx0TW9kYWxPcHRpb25zIDogbW9kYWxPcHRpb25zO1xyXG4gICAgICAgIG1vZGFsT3B0aW9ucy50aXRsZSA9IG1vZGFsT3B0aW9ucy50aXRsZSA9PSBudWxsID8gdGhpcy5haWZMb2NhbGVQaXBlLnRyYW5zZm9ybShcImNyZWF0aW9uUnVsZVNlbGVjdG9yXCIpIDogbW9kYWxPcHRpb25zLnRpdGxlO1xyXG5cclxuICAgICAgICBsZXQgY21wUjogQ29tcG9uZW50UmVmPElBaWZDcmVhdGlvblJ1bGVTZWxlY3RvckNvbXBvbmVudD4gPSBudWxsO1xyXG4gICAgICAgIGlmIChjdXN0b21TZWxlY3Rvck1vZHVsZVVybCA9PSBudWxsIHx8IGN1c3RvbVNlbGVjdG9yTW9kdWxlVXJsLnRyaW0oKSA9PSBcIlwiKSB7XHJcbiAgICAgICAgICAgIGxldCBjbXBGOiBDb21wb25lbnRGYWN0b3J5PElBaWZDcmVhdGlvblJ1bGVTZWxlY3RvckNvbXBvbmVudD4gPSB0aGlzLmNmci5yZXNvbHZlQ29tcG9uZW50RmFjdG9yeSh0eXBlKTtcclxuXHJcbiAgICAgICAgICAgIGxldCBpbmo6IEluamVjdG9yID0gUmVmbGVjdGl2ZUluamVjdG9yLnJlc29sdmVBbmRDcmVhdGUoW1xyXG4gICAgICAgICAgICAgICAgeyBwcm92aWRlOiBTRUxFQ1RPUl9BUkdTX0lOSkVDVE9SLCB1c2VWYWx1ZTogYXJncy5Db252ZXJ0VG9Kc29uT2JqZWN0KCkgfSxcclxuICAgICAgICAgICAgXSwgdGhpcy5pbmplY3Rvcik7XHJcbiAgICAgICAgICAgIGNtcFIgPSBjbXBGLmNyZWF0ZShpbmopO1xyXG4gICAgICAgICAgICB0aGlzLmNvbmZpZ01vZGFsQnV0dG9ucyhtb2RhbE9wdGlvbnMsIGNtcFIpO1xyXG5cclxuICAgICAgICAgICAgY21wUi5pbnN0YW5jZS5ic01vZGFsUmVmNEFpZlNlbGVjdG9yID0gdGhpcy5tb2RhbFNlcnZpY2Uuc2hvdyhjbXBSLCBtb2RhbE9wdGlvbnMpO1xyXG4gICAgICAgICAgICByZXR1cm4gY21wUi5pbnN0YW5jZS5zdWJqZWN0NENyZWF0aW9uUnVsZS5hc09ic2VydmFibGUoKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICByZXR1cm4gZnJvbSh0aGlzLmxvYWRlci5sb2FkKGN1c3RvbVNlbGVjdG9yTW9kdWxlVXJsKSkucGlwZShcclxuICAgICAgICAgICAgICAgIHN3aXRjaE1hcChcclxuICAgICAgICAgICAgICAgICAgICAobW9kdWxlRmFjdG9yeTogTmdNb2R1bGVGYWN0b3J5PElBaWZDcmVhdGlvblJ1bGVTZWxlY3Rvck1vZHVsZT4pID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbW9kdWxlUmVmID0gbW9kdWxlRmFjdG9yeS5jcmVhdGUodGhpcy5mcmFtZUNvbnRleHQucm9vdC5pbmplY3Rvcik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNtcFIgPSBtb2R1bGVSZWYuaW5zdGFuY2UuY3JlYXRlQ3JlYXRpb25SdWxlU2VsZWN0b3IodGhpcy5mcmFtZUNvbnRleHQucm9vdC5pbmplY3Rvcik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY29uZmlnTW9kYWxCdXR0b25zKG1vZGFsT3B0aW9ucywgY21wUik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNtcFIuaW5zdGFuY2UuYnNNb2RhbFJlZjRBaWZTZWxlY3RvciA9IHRoaXMubW9kYWxTZXJ2aWNlLnNob3coY21wUiwgbW9kYWxPcHRpb25zKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNtcFIuaW5zdGFuY2Uuc3ViamVjdDRDcmVhdGlvblJ1bGUuYXNPYnNlcnZhYmxlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgKVxyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOmFjee9ruaooeaAgeahhuaMiemSruS6i+S7tlxyXG4gICAgICogQHBhcmFtIG1vZGFsT3B0aW9ucyBcclxuICAgICAqIEBwYXJhbSBjbXBSIFxyXG4gICAgICovXHJcbiAgICBwcm90ZWN0ZWQgY29uZmlnTW9kYWxCdXR0b25zKG1vZGFsT3B0aW9uczogTW9kYWxPcHRpb25zLCBjbXBSOiBDb21wb25lbnRSZWY8SUFpZlNlbGVjdG9yQ29tcG9uZW50Pikge1xyXG4gICAgICAgIG1vZGFsT3B0aW9ucy5idXR0b25zID0gW1xyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICB0ZXh0OiB0aGlzLmFpZkxvY2FsZVBpcGUudHJhbnNmb3JtKFwiY29uZmlybVwiKSxcclxuICAgICAgICAgICAgICAgIGNsczogXCJidG4gYnRuLXByaW1hcnlcIixcclxuICAgICAgICAgICAgICAgIGhhbmRsZTogY21wUi5pbnN0YW5jZS5jbGlja09rNEFpZlNlbGVjdG9yLFxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICB0ZXh0OiB0aGlzLmFpZkxvY2FsZVBpcGUudHJhbnNmb3JtKFwiY2FuY2VsXCIpLFxyXG4gICAgICAgICAgICAgICAgY2xzOiBcImJ0biBidG4tc2Vjb25kYXJ5XCIsXHJcbiAgICAgICAgICAgICAgICBoYW5kbGU6IGNtcFIuaW5zdGFuY2UuY2xpY2tDbG9zZTRBaWZTZWxlY3RvcixcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIF07XHJcbiAgICAgICAgbW9kYWxPcHRpb25zLnNob3dCdXR0b25zID0gdHJ1ZTtcclxuICAgIH1cclxufSJdfQ==
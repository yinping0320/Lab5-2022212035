/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Injectable } from "@angular/core";
import { FormSettings, GeneralTextEntity } from "@edp-aif/common-api";
import { of } from "rxjs";
import { FormGetCreationRuleEntityExArgs, FormGetCreationRuleEntityExResult, FormCreateResult, FormUpdateResult } from '../form-args';
import { map, switchMap } from 'rxjs/operators';
import { Repository } from '@farris/devkit';
import { RpcCreationRuleExecutorResult } from '../../entity';
var AifDataService = /** @class */ (function () {
    function AifDataService(repository) {
        this.getCreationRuleEntityByIdUrl = "/api/runtime/aif/v1.0/form/getcreationruleentityex";
        this.getCreationRuleEntityByIdMethod = "GET";
        this.getCreationRuleUrl = "/api/runtime/aif/v1.0/form/getcreationruleentityexes";
        this.getCreationRuleMethod = "POST";
        this.executeCreationRuleUrl = "/api/runtime/aif/v1.0/form/executecreationrule";
        this.executeCreationRuleMethod = "POST";
        this.formCreateUrl = "/api/runtime/aif/v1.0/form/create";
        this.formCreateMethod = "POST";
        this.formUpdateUrl = "/api/runtime/aif/v1.0/form/update";
        this.formUpdateMethod = "POST";
        this.generalTextUrl = "/api/runtime/aif/v1.0/generaltext";
        this.generalTextMethod = "GET";
        this.repository = (/** @type {?} */ (repository));
    }
    /**
     * 根据来源 VO Id获取生单规则实体列表。
     *
     * @param sourceVoId 来源 VO Id。
     * @return 符合条件的生单规则实体列表。
     */
    /**
     * 根据来源 VO Id获取生单规则实体列表。
     *
     * @param {?} sourceVoId 来源 VO Id。
     * @return {?} 符合条件的生单规则实体列表。
     */
    AifDataService.prototype.getSlimCreationRulesBySourceVoId = /**
     * 根据来源 VO Id获取生单规则实体列表。
     *
     * @param {?} sourceVoId 来源 VO Id。
     * @return {?} 符合条件的生单规则实体列表。
     */
    function (sourceVoId) {
        /** @type {?} */
        var args = new FormGetCreationRuleEntityExArgs();
        args.sourceVoId = sourceVoId;
        return this.getCreationRuleList(args).pipe(map((/**
         * @param {?} res
         * @return {?}
         */
        function (res) {
            return res.ruleEntityExes;
        })));
    };
    /**
     * 根据目标 VO Id获取生单规则实体列表。
     *
     * @param targetVoId 目标 VO Id。
     * @return 符合条件的生单规则实体列表。
     */
    /**
     * 根据目标 VO Id获取生单规则实体列表。
     *
     * @param {?} targetVoId 目标 VO Id。
     * @return {?} 符合条件的生单规则实体列表。
     */
    AifDataService.prototype.getSlimCreationRulesByTargetVoId = /**
     * 根据目标 VO Id获取生单规则实体列表。
     *
     * @param {?} targetVoId 目标 VO Id。
     * @return {?} 符合条件的生单规则实体列表。
     */
    function (targetVoId) {
        /** @type {?} */
        var args = new FormGetCreationRuleEntityExArgs();
        args.targetVoId = targetVoId;
        return this.getCreationRuleList(args).pipe(map((/**
         * @param {?} res
         * @return {?}
         */
        function (res) {
            return res.ruleEntityExes;
        })));
    };
    /**
     * 根据来源 VO Id和目标 VO Id获取生单规则实体列表。
     *
     * @param sourceVoId 来源 VO Id。
     * @param targetVoId 目标 VO Id。
     * @return 符合条件的生单规则实体列表。
     */
    /**
     * 根据来源 VO Id和目标 VO Id获取生单规则实体列表。
     *
     * @param {?} sourceVoId 来源 VO Id。
     * @param {?} targetVoId 目标 VO Id。
     * @return {?} 符合条件的生单规则实体列表。
     */
    AifDataService.prototype.getSlimCreationRulesBySourceVoIdAndTargetVoId = /**
     * 根据来源 VO Id和目标 VO Id获取生单规则实体列表。
     *
     * @param {?} sourceVoId 来源 VO Id。
     * @param {?} targetVoId 目标 VO Id。
     * @return {?} 符合条件的生单规则实体列表。
     */
    function (sourceVoId, targetVoId) {
        /** @type {?} */
        var args = new FormGetCreationRuleEntityExArgs();
        args.sourceVoId = sourceVoId;
        args.targetVoId = targetVoId;
        return this.getCreationRuleList(args).pipe(map((/**
         * @param {?} res
         * @return {?}
         */
        function (res) {
            return res.ruleEntityExes;
        })));
    };
    /**
     * 根据来源 VO Id获取生单规则实体列表。
     *
     * @param sourceVoId     来源 VO Id。
     * @param bizFlowchartId 业务场景图Id。
     * @return 符合条件的生单规则实体列表。
     */
    /**
     * 根据来源 VO Id获取生单规则实体列表。
     *
     * @param {?} sourceVoId     来源 VO Id。
     * @param {?} bizFlowchartId 业务场景图Id。
     * @return {?} 符合条件的生单规则实体列表。
     */
    AifDataService.prototype.getSlimCreationRulesBySourceVoIdAndFlowchartId = /**
     * 根据来源 VO Id获取生单规则实体列表。
     *
     * @param {?} sourceVoId     来源 VO Id。
     * @param {?} bizFlowchartId 业务场景图Id。
     * @return {?} 符合条件的生单规则实体列表。
     */
    function (sourceVoId, bizFlowchartId) {
        /** @type {?} */
        var args = new FormGetCreationRuleEntityExArgs();
        args.sourceVoId = sourceVoId;
        args.bizFlowchartId = bizFlowchartId;
        return this.getCreationRuleList(args).pipe(map((/**
         * @param {?} res
         * @return {?}
         */
        function (res) {
            return res.ruleEntityExes;
        })));
    };
    /**
     * 根据目标 VO Id获取生单规则实体列表。
     *
     * @param targetVoId     目标 VO Id。
     * @param bizFlowchartId 业务场景图Id。
     * @return 符合条件的生单规则实体列表。
     */
    /**
     * 根据目标 VO Id获取生单规则实体列表。
     *
     * @param {?} targetVoId     目标 VO Id。
     * @param {?} bizFlowchartId 业务场景图Id。
     * @return {?} 符合条件的生单规则实体列表。
     */
    AifDataService.prototype.getSlimCreationRulesByTargetVoIdAndFlowchartId = /**
     * 根据目标 VO Id获取生单规则实体列表。
     *
     * @param {?} targetVoId     目标 VO Id。
     * @param {?} bizFlowchartId 业务场景图Id。
     * @return {?} 符合条件的生单规则实体列表。
     */
    function (targetVoId, bizFlowchartId) {
        /** @type {?} */
        var args = new FormGetCreationRuleEntityExArgs();
        args.targetVoId = targetVoId;
        args.bizFlowchartId = bizFlowchartId;
        return this.getCreationRuleList(args).pipe(map((/**
         * @param {?} res
         * @return {?}
         */
        function (res) {
            return res.ruleEntityExes;
        })));
    };
    /**
     * 根据来源 VO Id和目标 VO Id获取生单规则实体列表。
     *
     * @param sourceVoId     来源 VO Id。
     * @param targetVoId     目标 VO Id。
     * @param bizFlowchartId 业务场景图Id。
     * @return 符合条件的生单规则实体列表。
     */
    /**
     * 根据来源 VO Id和目标 VO Id获取生单规则实体列表。
     *
     * @param {?} sourceVoId     来源 VO Id。
     * @param {?} targetVoId     目标 VO Id。
     * @param {?} bizFlowchartId 业务场景图Id。
     * @return {?} 符合条件的生单规则实体列表。
     */
    AifDataService.prototype.getSlimCreationRulesBySourceVoIdAndTargetVoIdAndFlowchartId = /**
     * 根据来源 VO Id和目标 VO Id获取生单规则实体列表。
     *
     * @param {?} sourceVoId     来源 VO Id。
     * @param {?} targetVoId     目标 VO Id。
     * @param {?} bizFlowchartId 业务场景图Id。
     * @return {?} 符合条件的生单规则实体列表。
     */
    function (sourceVoId, targetVoId, bizFlowchartId) {
        /** @type {?} */
        var args = new FormGetCreationRuleEntityExArgs();
        args.sourceVoId = sourceVoId;
        args.targetVoId = targetVoId;
        args.bizFlowchartId = bizFlowchartId;
        return this.getCreationRuleList(args).pipe(map((/**
         * @param {?} res
         * @return {?}
         */
        function (res) {
            return res.ruleEntityExes;
        })));
    };
    /**
     * 获取生单规则实体
     */
    /**
     * 获取生单规则实体
     * @param {?} creationRuleId
     * @return {?}
     */
    AifDataService.prototype.getSlimCreationRuleEntityExById = /**
     * 获取生单规则实体
     * @param {?} creationRuleId
     * @return {?}
     */
    function (creationRuleId) {
        /** @type {?} */
        var getCreationRuleById$ = this.repository.proxy.request(this.getCreationRuleEntityByIdUrl + "/" + creationRuleId, this.getCreationRuleEntityByIdMethod, null);
        return getCreationRuleById$;
    };
    /**
     * 获取表单配置实体
     * @param formSettingsId
     */
    /**
     * 获取表单配置实体
     * @param {?} formSettingsId
     * @return {?}
     */
    AifDataService.prototype.getFormSettingsById = /**
     * 获取表单配置实体
     * @param {?} formSettingsId
     * @return {?}
     */
    function (formSettingsId) {
        if (formSettingsId == null || formSettingsId.trim() == "") {
            throw "生单规则为空";
        }
        /** @type {?} */
        var formSettings$ = this.repository.proxy.request(this.generalTextUrl + "/" + formSettingsId, this.generalTextMethod, null, { responseType: "text" });
        return formSettings$.pipe(map((/**
         * @param {?} data
         * @return {?}
         */
        function (data) {
            /** @type {?} */
            var generateText = new GeneralTextEntity();
            generateText.LoadFromJson(data);
            /** @type {?} */
            var formSettings = new FormSettings();
            formSettings.LoadFromJson(generateText.text);
            return formSettings;
        })));
    };
    /**
     * 执行生单规则
     */
    /**
     * 执行生单规则
     * @param {?} args
     * @return {?}
     */
    AifDataService.prototype.executeCreationRule = /**
     * 执行生单规则
     * @param {?} args
     * @return {?}
     */
    function (args) {
        /** @type {?} */
        var body = args.ConvertToJson();
        /** @type {?} */
        var executeCreationRule$ = this.repository.proxy.request(this.executeCreationRuleUrl, this.executeCreationRuleMethod, null, {
            body: body,
            responseType: 'text'
        });
        return executeCreationRule$.pipe(map((/**
         * @param {?} data
         * @return {?}
         */
        function (data) {
            /** @type {?} */
            var res = new RpcCreationRuleExecutorResult();
            res.LoadFromJson(data);
            return res;
        })));
    };
    /**
     * 创建单据
     */
    /**
     * 创建单据
     * @param {?} args
     * @return {?}
     */
    AifDataService.prototype.createEntityDatas = /**
     * 创建单据
     * @param {?} args
     * @return {?}
     */
    function (args) {
        var _this = this;
        /** @type {?} */
        var body = args.ConvertToJson();
        /** @type {?} */
        var options = {
            body: body,
            responseType: 'text'
        };
        /** @type {?} */
        var create$ = this.repository.proxy.request(this.formCreateUrl, this.formCreateMethod, null, options);
        return create$.pipe(switchMap((/**
         * @param {?} res
         * @return {?}
         */
        function (res) {
            /** @type {?} */
            var result = new FormCreateResult();
            result.LoadFromJson(res);
            /** @type {?} */
            var entities = result.entityDataList.map((/**
             * @param {?} entityStr
             * @return {?}
             */
            function (entityStr) {
                /** @type {?} */
                var newEntity = _this.repository.buildEntity(JSON.parse(entityStr));
                _this.appendInitialData(newEntity, newEntity);
                return newEntity;
            }));
            /** @type {?} */
            var origin = _this.repository.entityCollection.getAllEntities();
            if (origin == null || origin.length == 0) {
                _this.repository.entityCollection.loadEntities(entities);
            }
            else {
                _this.repository.entityCollection.addEntities(entities);
            }
            return of(result);
        })));
    };
    /**
     * 修改单据
     */
    /**
     * 修改单据
     * @param {?} args
     * @return {?}
     */
    AifDataService.prototype.updateEntityDatas = /**
     * 修改单据
     * @param {?} args
     * @return {?}
     */
    function (args) {
        /** @type {?} */
        var body = args.ConvertToJson();
        /** @type {?} */
        var options = {
            body: body,
            responseType: "text"
        };
        /** @type {?} */
        var update$ = this.repository.proxy.request(this.formUpdateUrl, this.formUpdateMethod, null, options);
        return update$.pipe(map((/**
         * @param {?} data
         * @return {?}
         */
        function (data) {
            /** @type {?} */
            var res = new FormUpdateResult();
            res.LoadFromJson(data);
            return res;
        })));
    };
    /**
     * @private
     * @param {?} args
     * @return {?}
     */
    AifDataService.prototype.getCreationRuleList = /**
     * @private
     * @param {?} args
     * @return {?}
     */
    function (args) {
        if (args == null) {
            throw "args不可为空";
        }
        if (typeof args == "string") {
            if (args == "") {
                throw "args不可为空";
            }
            /** @type {?} */
            var temp = new FormGetCreationRuleEntityExArgs();
            temp.LoadFromJson(args);
            args = temp;
        }
        /** @type {?} */
        var getCreationRule$ = this.repository.proxy.request(this.getCreationRuleUrl, this.getCreationRuleMethod, null, { body: args.ConvertToJson(), responseType: "text" });
        return getCreationRule$.pipe(map((/**
         * @param {?} data
         * @return {?}
         */
        function (data) {
            /** @type {?} */
            var result = new FormGetCreationRuleEntityExResult();
            result.LoadFromJson(data);
            return result;
        })));
    };
    /**
 * 参考farris/bef EntityUtil实现
 * @param entity
 * @param initialData
 */
    /**
     * 参考farris/bef EntityUtil实现
     * @private
     * @param {?} entity
     * @param {?} initialData
     * @return {?}
     */
    AifDataService.prototype.appendInitialData = /**
     * 参考farris/bef EntityUtil实现
     * @private
     * @param {?} entity
     * @param {?} initialData
     * @return {?}
     */
    function (entity, initialData) {
        /** @type {?} */
        var data = Object.assign({}, initialData);
        delete data.id;
        delete data.parentID;
        entity['initialData'] = data;
    };
    AifDataService.decorators = [
        { type: Injectable }
    ];
    /** @nocollapse */
    AifDataService.ctorParameters = function () { return [
        { type: Repository }
    ]; };
    return AifDataService;
}());
export { AifDataService };
if (false) {
    /**
     * @type {?}
     * @private
     */
    AifDataService.prototype.getCreationRuleEntityByIdUrl;
    /**
     * @type {?}
     * @private
     */
    AifDataService.prototype.getCreationRuleEntityByIdMethod;
    /**
     * @type {?}
     * @private
     */
    AifDataService.prototype.getCreationRuleUrl;
    /**
     * @type {?}
     * @private
     */
    AifDataService.prototype.getCreationRuleMethod;
    /**
     * @type {?}
     * @private
     */
    AifDataService.prototype.executeCreationRuleUrl;
    /**
     * @type {?}
     * @private
     */
    AifDataService.prototype.executeCreationRuleMethod;
    /**
     * @type {?}
     * @private
     */
    AifDataService.prototype.formCreateUrl;
    /**
     * @type {?}
     * @private
     */
    AifDataService.prototype.formCreateMethod;
    /**
     * @type {?}
     * @private
     */
    AifDataService.prototype.formUpdateUrl;
    /**
     * @type {?}
     * @private
     */
    AifDataService.prototype.formUpdateMethod;
    /**
     * @type {?}
     * @private
     */
    AifDataService.prototype.generalTextUrl;
    /**
     * @type {?}
     * @private
     */
    AifDataService.prototype.generalTextMethod;
    /**
     * @type {?}
     * @private
     */
    AifDataService.prototype.repository;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYWlmLWRhdGEuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BlZHAtYWlmL3J1bnRpbWUtYXBpLyIsInNvdXJjZXMiOlsibGliL2FpZi1tYW51YWwtY3JlYXRpb24vc2VydmljZS9haWYtZGF0YS5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzNDLE9BQU8sRUFBNkIsWUFBWSxFQUFFLGlCQUFpQixFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDakcsT0FBTyxFQUFjLEVBQUUsRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUN0QyxPQUFPLEVBQUUsK0JBQStCLEVBQUUsaUNBQWlDLEVBQWdDLGdCQUFnQixFQUFrQixnQkFBZ0IsRUFBa0IsTUFBTSxjQUFjLENBQUM7QUFDcE0sT0FBTyxFQUFFLEdBQUcsRUFBRSxTQUFTLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUVoRCxPQUFPLEVBQVUsVUFBVSxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDcEQsT0FBTyxFQUFFLDZCQUE2QixFQUFFLE1BQU0sY0FBYyxDQUFDO0FBRTdEO0lBaUJJLHdCQUNJLFVBQThCO1FBaEJqQixpQ0FBNEIsR0FBRyxvREFBb0QsQ0FBQztRQUNwRixvQ0FBK0IsR0FBRyxLQUFLLENBQUM7UUFDeEMsdUJBQWtCLEdBQVcsc0RBQXNELENBQUM7UUFDcEYsMEJBQXFCLEdBQVcsTUFBTSxDQUFDO1FBQ3ZDLDJCQUFzQixHQUFXLGdEQUFnRCxDQUFDO1FBQ2xGLDhCQUF5QixHQUFXLE1BQU0sQ0FBQztRQUMzQyxrQkFBYSxHQUFXLG1DQUFtQyxDQUFDO1FBQzVELHFCQUFnQixHQUFXLE1BQU0sQ0FBQztRQUNsQyxrQkFBYSxHQUFXLG1DQUFtQyxDQUFDO1FBQzVELHFCQUFnQixHQUFXLE1BQU0sQ0FBQztRQUNsQyxtQkFBYyxHQUFXLG1DQUFtQyxDQUFDO1FBQzdELHNCQUFpQixHQUFXLEtBQUss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QzNDLE9BQU8sSUFBSSxDQUFDLEVBQUUsQ0FBQztRQUNmLE9BQU8sSUFBSSxDQUFDLFFBQVEsQ0FBQztRQUNyQixNQUFNLENBQUMsYUFBYSxDQUFDLEdBQUcsSUFBSSxDQUFDO0lBQ2pDLENBQUM7O2dCQXRSSixVQUFVOzs7O2dCQUhNLFVBQVU7O0lBMFIzQixxQkFBQztDQUFBLEFBdlJELElBdVJDO1NBdFJZLGNBQWM7Ozs7OztJQUN2QixzREFBcUc7Ozs7O0lBQ3JHLHlEQUF5RDs7Ozs7SUFDekQsNENBQXFHOzs7OztJQUNyRywrQ0FBd0Q7Ozs7O0lBQ3hELGdEQUFtRzs7Ozs7SUFDbkcsbURBQTREOzs7OztJQUM1RCx1Q0FBNkU7Ozs7O0lBQzdFLDBDQUFtRDs7Ozs7SUFDbkQsdUNBQTZFOzs7OztJQUM3RSwwQ0FBbUQ7Ozs7O0lBQ25ELHdDQUE4RTs7Ozs7SUFDOUUsMkNBQW1EOzs7OztJQUVuRCxvQ0FBMEMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSBcIkBhbmd1bGFyL2NvcmVcIjtcclxuaW1wb3J0IHsgSVNsaW1DcmVhdGlvblJ1bGVFbnRpdHlFeCwgRm9ybVNldHRpbmdzLCBHZW5lcmFsVGV4dEVudGl0eSB9IGZyb20gXCJAZWRwLWFpZi9jb21tb24tYXBpXCI7XHJcbmltcG9ydCB7IE9ic2VydmFibGUsIG9mIH0gZnJvbSBcInJ4anNcIjtcclxuaW1wb3J0IHsgRm9ybUdldENyZWF0aW9uUnVsZUVudGl0eUV4QXJncywgRm9ybUdldENyZWF0aW9uUnVsZUVudGl0eUV4UmVzdWx0LCBGb3JtQ3JlYXRpb25SdWxlRXhlY3V0b3JBcmdzLCBGb3JtQ3JlYXRlUmVzdWx0LCBGb3JtQ3JlYXRlQXJncywgRm9ybVVwZGF0ZVJlc3VsdCwgRm9ybVVwZGF0ZUFyZ3MgfSBmcm9tICcuLi9mb3JtLWFyZ3MnO1xyXG5pbXBvcnQgeyBtYXAsIHN3aXRjaE1hcCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcclxuaW1wb3J0IHsgQmVmUmVwb3NpdG9yeSB9IGZyb20gJ0BmYXJyaXMvYmVmJztcclxuaW1wb3J0IHsgRW50aXR5LCBSZXBvc2l0b3J5IH0gZnJvbSAnQGZhcnJpcy9kZXZraXQnO1xyXG5pbXBvcnQgeyBScGNDcmVhdGlvblJ1bGVFeGVjdXRvclJlc3VsdCB9IGZyb20gJy4uLy4uL2VudGl0eSc7XHJcblxyXG5ASW5qZWN0YWJsZSgpXHJcbmV4cG9ydCBjbGFzcyBBaWZEYXRhU2VydmljZSB7XHJcbiAgICBwcml2YXRlIHJlYWRvbmx5IGdldENyZWF0aW9uUnVsZUVudGl0eUJ5SWRVcmwgPSBcIi9hcGkvcnVudGltZS9haWYvdjEuMC9mb3JtL2dldGNyZWF0aW9ucnVsZWVudGl0eWV4XCI7XHJcbiAgICBwcml2YXRlIHJlYWRvbmx5IGdldENyZWF0aW9uUnVsZUVudGl0eUJ5SWRNZXRob2QgPSBcIkdFVFwiO1xyXG4gICAgcHJpdmF0ZSByZWFkb25seSBnZXRDcmVhdGlvblJ1bGVVcmw6IHN0cmluZyA9IFwiL2FwaS9ydW50aW1lL2FpZi92MS4wL2Zvcm0vZ2V0Y3JlYXRpb25ydWxlZW50aXR5ZXhlc1wiO1xyXG4gICAgcHJpdmF0ZSByZWFkb25seSBnZXRDcmVhdGlvblJ1bGVNZXRob2Q6IHN0cmluZyA9IFwiUE9TVFwiO1xyXG4gICAgcHJpdmF0ZSByZWFkb25seSBleGVjdXRlQ3JlYXRpb25SdWxlVXJsOiBzdHJpbmcgPSBcIi9hcGkvcnVudGltZS9haWYvdjEuMC9mb3JtL2V4ZWN1dGVjcmVhdGlvbnJ1bGVcIjtcclxuICAgIHByaXZhdGUgcmVhZG9ubHkgZXhlY3V0ZUNyZWF0aW9uUnVsZU1ldGhvZDogc3RyaW5nID0gXCJQT1NUXCI7XHJcbiAgICBwcml2YXRlIHJlYWRvbmx5IGZvcm1DcmVhdGVVcmw6IHN0cmluZyA9IFwiL2FwaS9ydW50aW1lL2FpZi92MS4wL2Zvcm0vY3JlYXRlXCI7XHJcbiAgICBwcml2YXRlIHJlYWRvbmx5IGZvcm1DcmVhdGVNZXRob2Q6IHN0cmluZyA9IFwiUE9TVFwiO1xyXG4gICAgcHJpdmF0ZSByZWFkb25seSBmb3JtVXBkYXRlVXJsOiBzdHJpbmcgPSBcIi9hcGkvcnVudGltZS9haWYvdjEuMC9mb3JtL3VwZGF0ZVwiO1xyXG4gICAgcHJpdmF0ZSByZWFkb25seSBmb3JtVXBkYXRlTWV0aG9kOiBzdHJpbmcgPSBcIlBPU1RcIjtcclxuICAgIHByaXZhdGUgcmVhZG9ubHkgZ2VuZXJhbFRleHRVcmw6IHN0cmluZyA9IFwiL2FwaS9ydW50aW1lL2FpZi92MS4wL2dlbmVyYWx0ZXh0XCI7XHJcbiAgICBwcml2YXRlIHJlYWRvbmx5IGdlbmVyYWxUZXh0TWV0aG9kOiBzdHJpbmcgPSBcIkdFVFwiO1xyXG5cclxuICAgIHByaXZhdGUgcmVwb3NpdG9yeTogQmVmUmVwb3NpdG9yeTxFbnRpdHk+O1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKFxyXG4gICAgICAgIHJlcG9zaXRvcnk6IFJlcG9zaXRvcnk8RW50aXR5PixcclxuICAgICkge1xyXG4gICAgICAgIHRoaXMucmVwb3NpdG9yeSA9IHJlcG9zaXRvcnkgYXMgQmVmUmVwb3NpdG9yeTxFbnRpdHk+O1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiDmoLnmja7mnaXmupAgVk8gSWTojrflj5bnlJ/ljZXop4TliJnlrp7kvZPliJfooajjgIJcclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gc291cmNlVm9JZCDmnaXmupAgVk8gSWTjgIJcclxuICAgICAqIEByZXR1cm4g56ym5ZCI5p2h5Lu255qE55Sf5Y2V6KeE5YiZ5a6e5L2T5YiX6KGo44CCXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBnZXRTbGltQ3JlYXRpb25SdWxlc0J5U291cmNlVm9JZChzb3VyY2VWb0lkOiBzdHJpbmcpOiBPYnNlcnZhYmxlPElTbGltQ3JlYXRpb25SdWxlRW50aXR5RXhbXT4ge1xyXG4gICAgICAgIGNvbnN0IGFyZ3MgPSBuZXcgRm9ybUdldENyZWF0aW9uUnVsZUVudGl0eUV4QXJncygpO1xyXG4gICAgICAgIGFyZ3Muc291cmNlVm9JZCA9IHNvdXJjZVZvSWQ7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0Q3JlYXRpb25SdWxlTGlzdChhcmdzKS5waXBlKFxyXG4gICAgICAgICAgICBtYXAoXHJcbiAgICAgICAgICAgICAgICAocmVzOiBGb3JtR2V0Q3JlYXRpb25SdWxlRW50aXR5RXhSZXN1bHQpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzLnJ1bGVFbnRpdHlFeGVzO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICApXHJcbiAgICAgICAgKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOagueaNruebruaghyBWTyBJZOiOt+WPlueUn+WNleinhOWImeWunuS9k+WIl+ihqOOAglxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSB0YXJnZXRWb0lkIOebruaghyBWTyBJZOOAglxyXG4gICAgICogQHJldHVybiDnrKblkIjmnaHku7bnmoTnlJ/ljZXop4TliJnlrp7kvZPliJfooajjgIJcclxuICAgICAqL1xyXG4gICAgcHVibGljIGdldFNsaW1DcmVhdGlvblJ1bGVzQnlUYXJnZXRWb0lkKHRhcmdldFZvSWQ6IHN0cmluZyk6IE9ic2VydmFibGU8SVNsaW1DcmVhdGlvblJ1bGVFbnRpdHlFeFtdPiB7XHJcbiAgICAgICAgY29uc3QgYXJncyA9IG5ldyBGb3JtR2V0Q3JlYXRpb25SdWxlRW50aXR5RXhBcmdzKCk7XHJcbiAgICAgICAgYXJncy50YXJnZXRWb0lkID0gdGFyZ2V0Vm9JZDtcclxuICAgICAgICByZXR1cm4gdGhpcy5nZXRDcmVhdGlvblJ1bGVMaXN0KGFyZ3MpLnBpcGUoXHJcbiAgICAgICAgICAgIG1hcChcclxuICAgICAgICAgICAgICAgIChyZXM6IEZvcm1HZXRDcmVhdGlvblJ1bGVFbnRpdHlFeFJlc3VsdCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByZXMucnVsZUVudGl0eUV4ZXM7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIClcclxuICAgICAgICApO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5qC55o2u5p2l5rqQIFZPIElk5ZKM55uu5qCHIFZPIElk6I635Y+W55Sf5Y2V6KeE5YiZ5a6e5L2T5YiX6KGo44CCXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIHNvdXJjZVZvSWQg5p2l5rqQIFZPIElk44CCXHJcbiAgICAgKiBAcGFyYW0gdGFyZ2V0Vm9JZCDnm67moIcgVk8gSWTjgIJcclxuICAgICAqIEByZXR1cm4g56ym5ZCI5p2h5Lu255qE55Sf5Y2V6KeE5YiZ5a6e5L2T5YiX6KGo44CCXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBnZXRTbGltQ3JlYXRpb25SdWxlc0J5U291cmNlVm9JZEFuZFRhcmdldFZvSWQoc291cmNlVm9JZDogc3RyaW5nLCB0YXJnZXRWb0lkOiBzdHJpbmcpOiBPYnNlcnZhYmxlPElTbGltQ3JlYXRpb25SdWxlRW50aXR5RXhbXT4ge1xyXG4gICAgICAgIGNvbnN0IGFyZ3MgPSBuZXcgRm9ybUdldENyZWF0aW9uUnVsZUVudGl0eUV4QXJncygpO1xyXG4gICAgICAgIGFyZ3Muc291cmNlVm9JZCA9IHNvdXJjZVZvSWQ7XHJcbiAgICAgICAgYXJncy50YXJnZXRWb0lkID0gdGFyZ2V0Vm9JZDtcclxuICAgICAgICByZXR1cm4gdGhpcy5nZXRDcmVhdGlvblJ1bGVMaXN0KGFyZ3MpLnBpcGUoXHJcbiAgICAgICAgICAgIG1hcChcclxuICAgICAgICAgICAgICAgIChyZXM6IEZvcm1HZXRDcmVhdGlvblJ1bGVFbnRpdHlFeFJlc3VsdCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByZXMucnVsZUVudGl0eUV4ZXM7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIClcclxuICAgICAgICApO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5qC55o2u5p2l5rqQIFZPIElk6I635Y+W55Sf5Y2V6KeE5YiZ5a6e5L2T5YiX6KGo44CCXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIHNvdXJjZVZvSWQgICAgIOadpea6kCBWTyBJZOOAglxyXG4gICAgICogQHBhcmFtIGJpekZsb3djaGFydElkIOS4muWKoeWcuuaZr+Wbvklk44CCXHJcbiAgICAgKiBAcmV0dXJuIOespuWQiOadoeS7tueahOeUn+WNleinhOWImeWunuS9k+WIl+ihqOOAglxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgZ2V0U2xpbUNyZWF0aW9uUnVsZXNCeVNvdXJjZVZvSWRBbmRGbG93Y2hhcnRJZChzb3VyY2VWb0lkOiBzdHJpbmcsIGJpekZsb3djaGFydElkOiBzdHJpbmcpOiBPYnNlcnZhYmxlPElTbGltQ3JlYXRpb25SdWxlRW50aXR5RXhbXT4ge1xyXG4gICAgICAgIGNvbnN0IGFyZ3MgPSBuZXcgRm9ybUdldENyZWF0aW9uUnVsZUVudGl0eUV4QXJncygpO1xyXG4gICAgICAgIGFyZ3Muc291cmNlVm9JZCA9IHNvdXJjZVZvSWQ7XHJcbiAgICAgICAgYXJncy5iaXpGbG93Y2hhcnRJZCA9IGJpekZsb3djaGFydElkO1xyXG4gICAgICAgIHJldHVybiB0aGlzLmdldENyZWF0aW9uUnVsZUxpc3QoYXJncykucGlwZShcclxuICAgICAgICAgICAgbWFwKFxyXG4gICAgICAgICAgICAgICAgKHJlczogRm9ybUdldENyZWF0aW9uUnVsZUVudGl0eUV4UmVzdWx0KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlcy5ydWxlRW50aXR5RXhlcztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgKVxyXG4gICAgICAgICk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDmoLnmja7nm67moIcgVk8gSWTojrflj5bnlJ/ljZXop4TliJnlrp7kvZPliJfooajjgIJcclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gdGFyZ2V0Vm9JZCAgICAg55uu5qCHIFZPIElk44CCXHJcbiAgICAgKiBAcGFyYW0gYml6Rmxvd2NoYXJ0SWQg5Lia5Yqh5Zy65pmv5Zu+SWTjgIJcclxuICAgICAqIEByZXR1cm4g56ym5ZCI5p2h5Lu255qE55Sf5Y2V6KeE5YiZ5a6e5L2T5YiX6KGo44CCXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBnZXRTbGltQ3JlYXRpb25SdWxlc0J5VGFyZ2V0Vm9JZEFuZEZsb3djaGFydElkKHRhcmdldFZvSWQ6IHN0cmluZywgYml6Rmxvd2NoYXJ0SWQ6IHN0cmluZyk6IE9ic2VydmFibGU8SVNsaW1DcmVhdGlvblJ1bGVFbnRpdHlFeFtdPiB7XHJcbiAgICAgICAgY29uc3QgYXJncyA9IG5ldyBGb3JtR2V0Q3JlYXRpb25SdWxlRW50aXR5RXhBcmdzKCk7XHJcbiAgICAgICAgYXJncy50YXJnZXRWb0lkID0gdGFyZ2V0Vm9JZDtcclxuICAgICAgICBhcmdzLmJpekZsb3djaGFydElkID0gYml6Rmxvd2NoYXJ0SWQ7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0Q3JlYXRpb25SdWxlTGlzdChhcmdzKS5waXBlKFxyXG4gICAgICAgICAgICBtYXAoXHJcbiAgICAgICAgICAgICAgICAocmVzOiBGb3JtR2V0Q3JlYXRpb25SdWxlRW50aXR5RXhSZXN1bHQpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzLnJ1bGVFbnRpdHlFeGVzO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICApXHJcbiAgICAgICAgKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOagueaNruadpea6kCBWTyBJZOWSjOebruaghyBWTyBJZOiOt+WPlueUn+WNleinhOWImeWunuS9k+WIl+ihqOOAglxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBzb3VyY2VWb0lkICAgICDmnaXmupAgVk8gSWTjgIJcclxuICAgICAqIEBwYXJhbSB0YXJnZXRWb0lkICAgICDnm67moIcgVk8gSWTjgIJcclxuICAgICAqIEBwYXJhbSBiaXpGbG93Y2hhcnRJZCDkuJrliqHlnLrmma/lm75JZOOAglxyXG4gICAgICogQHJldHVybiDnrKblkIjmnaHku7bnmoTnlJ/ljZXop4TliJnlrp7kvZPliJfooajjgIJcclxuICAgICAqL1xyXG4gICAgcHVibGljIGdldFNsaW1DcmVhdGlvblJ1bGVzQnlTb3VyY2VWb0lkQW5kVGFyZ2V0Vm9JZEFuZEZsb3djaGFydElkKHNvdXJjZVZvSWQ6IHN0cmluZywgdGFyZ2V0Vm9JZDogc3RyaW5nLCBiaXpGbG93Y2hhcnRJZDogc3RyaW5nKTogT2JzZXJ2YWJsZTxJU2xpbUNyZWF0aW9uUnVsZUVudGl0eUV4W10+IHtcclxuICAgICAgICBjb25zdCBhcmdzID0gbmV3IEZvcm1HZXRDcmVhdGlvblJ1bGVFbnRpdHlFeEFyZ3MoKTtcclxuICAgICAgICBhcmdzLnNvdXJjZVZvSWQgPSBzb3VyY2VWb0lkO1xyXG4gICAgICAgIGFyZ3MudGFyZ2V0Vm9JZCA9IHRhcmdldFZvSWQ7XHJcbiAgICAgICAgYXJncy5iaXpGbG93Y2hhcnRJZCA9IGJpekZsb3djaGFydElkO1xyXG4gICAgICAgIHJldHVybiB0aGlzLmdldENyZWF0aW9uUnVsZUxpc3QoYXJncykucGlwZShcclxuICAgICAgICAgICAgbWFwKFxyXG4gICAgICAgICAgICAgICAgKHJlczogRm9ybUdldENyZWF0aW9uUnVsZUVudGl0eUV4UmVzdWx0KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlcy5ydWxlRW50aXR5RXhlcztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgKVxyXG4gICAgICAgICk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDojrflj5bnlJ/ljZXop4TliJnlrp7kvZNcclxuICAgICAqL1xyXG4gICAgcHVibGljIGdldFNsaW1DcmVhdGlvblJ1bGVFbnRpdHlFeEJ5SWQoY3JlYXRpb25SdWxlSWQ6IHN0cmluZyk6IE9ic2VydmFibGU8SVNsaW1DcmVhdGlvblJ1bGVFbnRpdHlFeD4ge1xyXG4gICAgICAgIGNvbnN0IGdldENyZWF0aW9uUnVsZUJ5SWQkOiBPYnNlcnZhYmxlPElTbGltQ3JlYXRpb25SdWxlRW50aXR5RXg+ID0gdGhpcy5yZXBvc2l0b3J5LnByb3h5LnJlcXVlc3QoYCR7dGhpcy5nZXRDcmVhdGlvblJ1bGVFbnRpdHlCeUlkVXJsfS8ke2NyZWF0aW9uUnVsZUlkfWAsIHRoaXMuZ2V0Q3JlYXRpb25SdWxlRW50aXR5QnlJZE1ldGhvZCwgbnVsbCk7XHJcbiAgICAgICAgcmV0dXJuIGdldENyZWF0aW9uUnVsZUJ5SWQkO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog6I635Y+W6KGo5Y2V6YWN572u5a6e5L2TXHJcbiAgICAgKiBAcGFyYW0gZm9ybVNldHRpbmdzSWQgXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBnZXRGb3JtU2V0dGluZ3NCeUlkKGZvcm1TZXR0aW5nc0lkOiBzdHJpbmcpOiBPYnNlcnZhYmxlPEZvcm1TZXR0aW5ncz4ge1xyXG4gICAgICAgIGlmIChmb3JtU2V0dGluZ3NJZCA9PSBudWxsIHx8IGZvcm1TZXR0aW5nc0lkLnRyaW0oKSA9PSBcIlwiKSB7XHJcbiAgICAgICAgICAgIHRocm93IFwi55Sf5Y2V6KeE5YiZ5Li656m6XCI7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IGZvcm1TZXR0aW5ncyQ6IE9ic2VydmFibGU8c3RyaW5nPiA9IHRoaXMucmVwb3NpdG9yeS5wcm94eS5yZXF1ZXN0KGAke3RoaXMuZ2VuZXJhbFRleHRVcmx9LyR7Zm9ybVNldHRpbmdzSWR9YCwgdGhpcy5nZW5lcmFsVGV4dE1ldGhvZCwgbnVsbCwgeyByZXNwb25zZVR5cGU6IFwidGV4dFwiIH0pO1xyXG4gICAgICAgIHJldHVybiBmb3JtU2V0dGluZ3MkLnBpcGUoXHJcbiAgICAgICAgICAgIG1hcChcclxuICAgICAgICAgICAgICAgIChkYXRhOiBzdHJpbmcpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBnZW5lcmF0ZVRleHQgPSBuZXcgR2VuZXJhbFRleHRFbnRpdHkoKTtcclxuICAgICAgICAgICAgICAgICAgICBnZW5lcmF0ZVRleHQuTG9hZEZyb21Kc29uKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGZvcm1TZXR0aW5ncyA9IG5ldyBGb3JtU2V0dGluZ3MoKTtcclxuICAgICAgICAgICAgICAgICAgICBmb3JtU2V0dGluZ3MuTG9hZEZyb21Kc29uKGdlbmVyYXRlVGV4dC50ZXh0KTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZm9ybVNldHRpbmdzO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICApXHJcbiAgICAgICAgKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOaJp+ihjOeUn+WNleinhOWImVxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgZXhlY3V0ZUNyZWF0aW9uUnVsZShhcmdzOiBGb3JtQ3JlYXRpb25SdWxlRXhlY3V0b3JBcmdzKTogT2JzZXJ2YWJsZTxScGNDcmVhdGlvblJ1bGVFeGVjdXRvclJlc3VsdD4ge1xyXG4gICAgICAgIGNvbnN0IGJvZHkgPSBhcmdzLkNvbnZlcnRUb0pzb24oKTtcclxuICAgICAgICBjb25zdCBleGVjdXRlQ3JlYXRpb25SdWxlJCA9IHRoaXMucmVwb3NpdG9yeS5wcm94eS5yZXF1ZXN0KHRoaXMuZXhlY3V0ZUNyZWF0aW9uUnVsZVVybCwgdGhpcy5leGVjdXRlQ3JlYXRpb25SdWxlTWV0aG9kLCBudWxsLCB7XHJcbiAgICAgICAgICAgIGJvZHk6IGJvZHksXHJcbiAgICAgICAgICAgIHJlc3BvbnNlVHlwZTogJ3RleHQnXHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgcmV0dXJuIGV4ZWN1dGVDcmVhdGlvblJ1bGUkLnBpcGUoXHJcbiAgICAgICAgICAgIG1hcChcclxuICAgICAgICAgICAgICAgIChkYXRhOiBzdHJpbmcpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCByZXMgPSBuZXcgUnBjQ3JlYXRpb25SdWxlRXhlY3V0b3JSZXN1bHQoKTtcclxuICAgICAgICAgICAgICAgICAgICByZXMuTG9hZEZyb21Kc29uKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByZXM7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIClcclxuICAgICAgICApO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5Yib5bu65Y2V5o2uXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBjcmVhdGVFbnRpdHlEYXRhcyhhcmdzOiBGb3JtQ3JlYXRlQXJncyk6IE9ic2VydmFibGU8Rm9ybUNyZWF0ZVJlc3VsdD4ge1xyXG4gICAgICAgIGNvbnN0IGJvZHkgPSBhcmdzLkNvbnZlcnRUb0pzb24oKTtcclxuICAgICAgICBjb25zdCBvcHRpb25zID0ge1xyXG4gICAgICAgICAgICBib2R5OiBib2R5LFxyXG4gICAgICAgICAgICByZXNwb25zZVR5cGU6ICd0ZXh0J1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgY29uc3QgY3JlYXRlJDogT2JzZXJ2YWJsZTxzdHJpbmc+ID0gdGhpcy5yZXBvc2l0b3J5LnByb3h5LnJlcXVlc3QodGhpcy5mb3JtQ3JlYXRlVXJsLCB0aGlzLmZvcm1DcmVhdGVNZXRob2QsIG51bGwsIG9wdGlvbnMpO1xyXG4gICAgICAgIHJldHVybiBjcmVhdGUkLnBpcGUoXHJcbiAgICAgICAgICAgIHN3aXRjaE1hcChcclxuICAgICAgICAgICAgICAgIChyZXM6IHN0cmluZykgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IG5ldyBGb3JtQ3JlYXRlUmVzdWx0KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0LkxvYWRGcm9tSnNvbihyZXMpO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGVudGl0aWVzOiBFbnRpdHlbXSA9IHJlc3VsdC5lbnRpdHlEYXRhTGlzdC5tYXAoKGVudGl0eVN0cjogc3RyaW5nKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG5ld0VudGl0eSA9IHRoaXMucmVwb3NpdG9yeS5idWlsZEVudGl0eShKU09OLnBhcnNlKGVudGl0eVN0cikpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmFwcGVuZEluaXRpYWxEYXRhKG5ld0VudGl0eSwgbmV3RW50aXR5KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ld0VudGl0eTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICBsZXQgb3JpZ2luID0gdGhpcy5yZXBvc2l0b3J5LmVudGl0eUNvbGxlY3Rpb24uZ2V0QWxsRW50aXRpZXMoKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAob3JpZ2luID09IG51bGwgfHwgb3JpZ2luLmxlbmd0aCA9PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucmVwb3NpdG9yeS5lbnRpdHlDb2xsZWN0aW9uLmxvYWRFbnRpdGllcyhlbnRpdGllcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yZXBvc2l0b3J5LmVudGl0eUNvbGxlY3Rpb24uYWRkRW50aXRpZXMoZW50aXRpZXMpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9mKHJlc3VsdCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIClcclxuICAgICAgICApO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5L+u5pS55Y2V5o2uXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyB1cGRhdGVFbnRpdHlEYXRhcyhhcmdzOiBGb3JtVXBkYXRlQXJncyk6IE9ic2VydmFibGU8Rm9ybVVwZGF0ZVJlc3VsdD4ge1xyXG4gICAgICAgIGNvbnN0IGJvZHkgPSBhcmdzLkNvbnZlcnRUb0pzb24oKTtcclxuICAgICAgICBjb25zdCBvcHRpb25zID0ge1xyXG4gICAgICAgICAgICBib2R5OiBib2R5LFxyXG4gICAgICAgICAgICByZXNwb25zZVR5cGU6IFwidGV4dFwiXHJcbiAgICAgICAgfTtcclxuICAgICAgICBjb25zdCB1cGRhdGUkID0gdGhpcy5yZXBvc2l0b3J5LnByb3h5LnJlcXVlc3QodGhpcy5mb3JtVXBkYXRlVXJsLCB0aGlzLmZvcm1VcGRhdGVNZXRob2QsIG51bGwsIG9wdGlvbnMpO1xyXG4gICAgICAgIHJldHVybiB1cGRhdGUkLnBpcGUoXHJcbiAgICAgICAgICAgIG1hcChcclxuICAgICAgICAgICAgICAgIChkYXRhOiBzdHJpbmcpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCByZXM6IEZvcm1VcGRhdGVSZXN1bHQgPSBuZXcgRm9ybVVwZGF0ZVJlc3VsdCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJlcy5Mb2FkRnJvbUpzb24oZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlcztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgKVxyXG4gICAgICAgICk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBnZXRDcmVhdGlvblJ1bGVMaXN0KGFyZ3M6IEZvcm1HZXRDcmVhdGlvblJ1bGVFbnRpdHlFeEFyZ3MpOiBPYnNlcnZhYmxlPEZvcm1HZXRDcmVhdGlvblJ1bGVFbnRpdHlFeFJlc3VsdD4ge1xyXG4gICAgICAgIGlmIChhcmdzID09IG51bGwpIHtcclxuICAgICAgICAgICAgdGhyb3cgXCJhcmdz5LiN5Y+v5Li656m6XCI7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0eXBlb2YgYXJncyA9PSBcInN0cmluZ1wiKSB7XHJcbiAgICAgICAgICAgIGlmIChhcmdzID09IFwiXCIpIHtcclxuICAgICAgICAgICAgICAgIHRocm93IFwiYXJnc+S4jeWPr+S4uuepulwiO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNvbnN0IHRlbXAgPSBuZXcgRm9ybUdldENyZWF0aW9uUnVsZUVudGl0eUV4QXJncygpO1xyXG4gICAgICAgICAgICB0ZW1wLkxvYWRGcm9tSnNvbihhcmdzKTtcclxuICAgICAgICAgICAgYXJncyA9IHRlbXA7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IGdldENyZWF0aW9uUnVsZSQgPSB0aGlzLnJlcG9zaXRvcnkucHJveHkucmVxdWVzdCh0aGlzLmdldENyZWF0aW9uUnVsZVVybCwgdGhpcy5nZXRDcmVhdGlvblJ1bGVNZXRob2QsIG51bGwsIHsgYm9keTogYXJncy5Db252ZXJ0VG9Kc29uKCksIHJlc3BvbnNlVHlwZTogXCJ0ZXh0XCIgfSk7XHJcbiAgICAgICAgcmV0dXJuIGdldENyZWF0aW9uUnVsZSQucGlwZShcclxuICAgICAgICAgICAgbWFwKFxyXG4gICAgICAgICAgICAgICAgKGRhdGE6IHN0cmluZykgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IG5ldyBGb3JtR2V0Q3JlYXRpb25SdWxlRW50aXR5RXhSZXN1bHQoKTtcclxuICAgICAgICAgICAgICAgICAgICByZXN1bHQuTG9hZEZyb21Kc29uKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIClcclxuICAgICAgICApO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKiBcclxuICog5Y+C6ICDZmFycmlzL2JlZiBFbnRpdHlVdGls5a6e546wXHJcbiAqIEBwYXJhbSBlbnRpdHkgXHJcbiAqIEBwYXJhbSBpbml0aWFsRGF0YSBcclxuICovXHJcbiAgICBwcml2YXRlIGFwcGVuZEluaXRpYWxEYXRhKGVudGl0eSwgaW5pdGlhbERhdGEpIHtcclxuICAgICAgICBjb25zdCBkYXRhID0gT2JqZWN0LmFzc2lnbih7fSwgaW5pdGlhbERhdGEpO1xyXG4gICAgICAgIGRlbGV0ZSBkYXRhLmlkO1xyXG4gICAgICAgIGRlbGV0ZSBkYXRhLnBhcmVudElEO1xyXG4gICAgICAgIGVudGl0eVsnaW5pdGlhbERhdGEnXSA9IGRhdGE7XHJcbiAgICB9XHJcbn0iXX0=
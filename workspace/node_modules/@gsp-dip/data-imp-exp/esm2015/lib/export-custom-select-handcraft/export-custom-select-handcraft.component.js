/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, ComponentFactoryResolver, EventEmitter, Injector, Input, Output, TemplateRef, ViewChild } from '@angular/core';
import { MethodType } from "../model/DataIEType/MethodType";
import { FrameContext } from "@farris/devkit";
import { LoadingService } from "@farris/ui-loading";
import { FileConst } from "../model/utils/FileConst";
import { DataExportService } from "../service/DataIEService/data-export.service";
import { NotifyService } from "@farris/ui-notify";
import { HttpClient } from "@angular/common/http";
import { BsModalService } from "@farris/ui-modal";
import { DataIEUtils, FileTypeUtil } from "../service/Utils/DataIEUtils";
import { RuleSelectComponent } from "../rule-select/rule-select.component";
export class ExportCustomSelectHandcraftComponent {
    /**
     * @param {?} dataExportService
     * @param {?} notify
     * @param {?} http
     * @param {?} loadingService
     * @param {?} injector
     * @param {?} modalService
     * @param {?} resolver
     */
    constructor(dataExportService, notify, http, loadingService, injector, modalService, resolver) {
        this.dataExportService = dataExportService;
        this.notify = notify;
        this.http = http;
        this.loadingService = loadingService;
        this.injector = injector;
        this.modalService = modalService;
        this.resolver = resolver;
        this.ruleId = '';
        this.frameContext = null;
        this.subject = null;
        this.exportOption = null;
        this.needDestroy = new EventEmitter();
        this.enableRuntimeCustom = false;
        // 记录的规则
        this.recordRule = null;
        this.currentRuleName = '';
        this.currentRuleId = '';
        this.currentRuleFileType = '';
        this.lookupIcon = '<i class="f-icon f-icon-windows"></i>';
        this.loadingComp = null;
        this.fileListItems = [
            { id: FileConst.xls, label: FileConst.xls },
            { id: FileConst.xlsx, label: FileConst.xlsx },
            { id: FileConst.xlsm, label: FileConst.xlsm },
            { id: FileConst.et, label: FileConst.et },
        ];
        DataIEUtils.getTranslateValue(http).subscribe((/**
         * @param {?} res
         * @return {?}
         */
        res => {
            this.export_success = res['export_success'];
            this.export_fail = res['export_fail'];
            this.file_type = res['file_type'];
            this.ie_cancel = res['ie_cancel'];
            this.ie_ok = res['ie_ok'];
            this.rule_list = res['rule_list'];
            this.i18nResource = res;
        }));
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.currentRuleId = this.recordRule.ruleId;
        this.currentRuleName = this.recordRule.ruleName;
        this.valueField = FileTypeUtil.getFileTypeName(this.recordRule.fileType);
        this.currentRuleFileType = this.valueField;
        if (this.exportOption.enableRuntimeCustom === true) {
            this.enableRuntimeCustom = true;
        }
    }
    /**
     * @param {?} $event
     * @return {?}
     */
    openSelectRule($event) {
        this.loadingComp = this.loadingService.show();
        //过滤规则时用表单命令处配置的规则来过滤，因此用ruleId，而不是currentRuleId
        /** @type {?} */
        const url = '/api/runtime/dip/v1.0/dataIeRuleManage/filterRulesByRuleIdAndVoId';
        /** @type {?} */
        const body = {
            ruleId: this.ruleId,
            ruleType: 1,
            voId: this.exportOption.voId,
            methodType: this.methodType,
            exportChildNodeCode: this.exportOption.exportChildNodeCode
        };
        this.http.post(url, body).subscribe((/**
         * @param {?} RuleMgrs
         * @return {?}
         */
        (RuleMgrs) => {
            this.loadingService.clearAll();
            if (RuleMgrs.length === 0) {
                this.notify.info(this.i18nResource['ruleselect_listempty']);
                return;
            }
            /** @type {?} */
            const compFactory = this.resolver.resolveComponentFactory(RuleSelectComponent);
            /** @type {?} */
            const compRef = compFactory.create(this.injector);
            compRef.instance.ruleId = this.ruleId;
            compRef.instance.voId = this.exportOption.voId;
            compRef.instance.ruleType = 1;
            compRef.instance.RuleMgrsData = RuleMgrs;
            /** @type {?} */
            const modalConfig = {
                title: this.rule_list,
                width: 950,
                height: 500,
                buttons: compRef.instance.modalFooter,
                showHeader: true,
                showMaxButton: false,
                showButtons: true
            };
            /** @type {?} */
            const dialog = this.modalService.show(compRef, modalConfig);
            compRef.instance.closeModal.subscribe((/**
             * @return {?}
             */
            () => {
                dialog.close();
            }));
            compRef.instance.okModal.subscribe((/**
             * @param {?} RuleMgr
             * @return {?}
             */
            RuleMgr => {
                this.currentRuleId = RuleMgr.id;
                this.currentRuleName = RuleMgr.name;
                this.valueField = FileTypeUtil.getFileTypeName(RuleMgr.fileType);
                this.currentRuleFileType = this.valueField;
                dialog.close();
            }));
        }), (/**
         * @param {?} error
         * @return {?}
         */
        error => {
            this.loadingService.clearAll();
            this.notify.error(error.error.Message);
            console.log(error.error.Message);
        }));
    }
    /**
     * @return {?}
     */
    Ok() {
        /** @type {?} */
        let suffix = null;
        if (this.valueField !== this.currentRuleFileType) {
            suffix = FileTypeUtil.getFileExtension(this.valueField);
        }
        switch (this.methodType) {
            case MethodType.CommonExport:
                this.dataExportService.ExportById4HandCraft(this.currentRuleId, this.exportOption, suffix);
                this.exportComplete();
                break;
            case MethodType.ExportCurrentTableData:
                this.notify.warning('不支持导出当前页');
                this.exportComplete();
                break;
            case MethodType.ExportCurrentChildData:
                this.notify.warning('不支持导出子表数据');
                this.exportComplete();
                break;
        }
    }
    /**
     * @return {?}
     */
    exportComplete() {
        /** @type {?} */
        const exportUnscribe = this.dataExportService.export.subscribe((/**
         * @param {?} data
         * @return {?}
         */
        data => {
            if (data === '') {
                this.notify.success(this.export_success);
                exportUnscribe.unsubscribe();
                /** @type {?} */
                const res = {
                    type: 'success',
                    data: null,
                    other: null
                };
                this.subject.next(res);
                this.subject.complete();
            }
            else {
                /** @type {?} */
                const errorlevel = this.dataExportService.errorlevel;
                if (errorlevel === 'Info') {
                    this.notify.info(data);
                }
                else if (errorlevel === 'Warning') {
                    this.notify.warning(data);
                }
                else {
                    this.notify.error(this.export_fail + data);
                }
                /** @type {?} */
                const res = {
                    type: 'fail',
                    data: null,
                    other: data
                };
                this.subject.next(res);
                this.subject.complete();
            }
            exportUnscribe.unsubscribe();
            this.needDestroy.emit();
        }));
    }
    /**
     * @return {?}
     */
    canSelectFileType() {
        /** @type {?} */
        const suffix = FileTypeUtil.getFileExtension(this.valueField);
        /** @type {?} */
        const canList = ['.xls', '.xlsx', '.xlsm', '.et'];
        if (canList.findIndex((/**
         * @param {?} t
         * @return {?}
         */
        t => t === suffix)) < 0) {
            return false;
        }
        return true;
    }
    /**
     * @return {?}
     */
    close() {
        this.needDestroy.emit();
    }
    /**
     * @return {?}
     */
    Cancel() {
        this.needDestroy.emit(true);
    }
}
ExportCustomSelectHandcraftComponent.decorators = [
    { type: Component, args: [{
                selector: 'lib-export-custom-select-handcraft',
                template: "<!-- <div class=\"d-flex flex-column\" style=\"width: 100%; height: 100%;\">\n    <div region=\"south\" class=\"south mgleft\">\n        <table>\n            <tr>\n                <td class=\"mkwidth\">\n                    <label> </label>\n                </td>\n            </tr>\n            <tr *ngIf=\"selectrule\">\n                <td class=\"mkwidth\">\n                    <label for=\"f_select_rule\">{{rule_list}}</label>\n                </td>\n                <td style=\"width: 430px;\">\n                    <input-group class=\"ng-untouched ng-pristine ng-valid\" [editable]=\"false\" [groupText]=\"lookupIcon\" [enableClear]=\"false\"\n                        [value]=\"currentRuleName\" (clickHandle)=\"openSelectRule($event)\">\n                    </input-group>\n                </td>\n            </tr>\n\n            <tr *ngIf=\"selectfiletype\">\n                <td class=\"mkwidth\">\n                    <label for=\"f_select_fileType\">{{file_type}}</label>\n                </td>\n                <td style=\"width: 430px;\">\n                    <farris-combo-list id=\"f_select_fileType\" [(ngModel)]=\"valueField\" [idField]=\"'id'\" [textField]=\"'label'\" [data]=\"fileListItems\"></farris-combo-list>\n                </td>\n            </tr>\n        </table>\n    </div>\n</div> -->\n\n<form class=\"px-3 px-md-4 farris-form d-flex flex-wrap\">\n  <div class=\"col-12\" style=\"margin-top: 72px\">\n    <div *ngIf=\"enableRuntimeCustom === true\" class=\"farris-group-wrap form-inline farris-form-inline\">\n      <div class=\"form-group farris-form-group\">\n        <label class=\" col-form-label\">\n          <span class=\"farris-label-text\">{{rule_list}}</span>\n        </label>\n        <div class=\"farris-input-wrap\">\n          <input-group class=\"ng-untouched ng-pristine ng-valid\" [editable]=\"false\" [groupText]=\"lookupIcon\" [enableClear]=\"false\"\n                       [value]=\"currentRuleName\" (clickHandle)=\"openSelectRule($event)\">\n          </input-group>\n        </div>\n      </div>\n    </div>\n    <div *ngIf=\"enableRuntimeCustom === false\" class=\"farris-group-wrap form-inline farris-form-inline\">\n      <span>&nbsp;</span>\n    </div>\n    <div class=\"farris-group-wrap form-inline farris-form-inline\">\n      <div class=\"form-group farris-form-group\" style=\"width: 450px\">\n        <label class=\"col-form-label\">\n          <span class=\"farris-label-text\">{{file_type}}</span>\n        </label>\n        <div class=\"farris-input-wrap\">\n          <farris-combo-list [readonly]=\"canSelectFileType() === false\" id=\"f_select_fileType\" name=\"f_select_fileType\" [(ngModel)]=\"valueField\"\n                             [idField]=\"'id'\" [textField]=\"'label'\" [editable]=\"false\" [enableClear]=\"false\" [data]=\"fileListItems\"></farris-combo-list>\n        </div>\n        <span>&nbsp;&nbsp;</span>\n        <!-- <span *ngIf=\"enableRuntimeCustom === true\" class=\"f-icon f-icon-custom\" style=\"color: #388FFF;cursor: pointer;\"></span>\n        <span *ngIf=\"enableRuntimeCustom === false\" class=\"f-icon f-icon-custom\" style=\"color:white\"></span> -->\n        <span  class=\"f-icon f-icon-custom\" style=\"color:white\"></span>\n      </div>\n    </div>\n\n\n\n  </div>\n</form>\n\n<ng-template #selectFooter>\n  <button type=\"button\" class=\"btn btn-outline-secondary\" (click)=\"Cancel()\">{{ie_cancel}}</button>\n  <button type=\"button\" class=\"btn btn-primary\" (click)=\"Ok()\">{{ie_ok}}</button>\n</ng-template>\n",
                styles: [".barmanager{position:absolute;bottom:0;height:50px;right:30px;padding-left:50px}#filePath,#fileType,#filterExpression{margin-left:7px}.input-group{margin-bottom:12px}.btngroup{margin-top:12px}.exchange{margin-top:30px}#IsSave{margin:6px}.pos{position:relative}.left{float:right}.mkwidth{width:75px;line-height:28px}.div-inline{display:inline}.mgleft{margin-left:20px;margin-top:10px}.longlen{width:400px}"]
            }] }
];
/** @nocollapse */
ExportCustomSelectHandcraftComponent.ctorParameters = () => [
    { type: DataExportService },
    { type: NotifyService },
    { type: HttpClient },
    { type: LoadingService },
    { type: Injector },
    { type: BsModalService },
    { type: ComponentFactoryResolver }
];
ExportCustomSelectHandcraftComponent.propDecorators = {
    modalFooter: [{ type: ViewChild, args: ['selectFooter',] }],
    ruleId: [{ type: Input }],
    methodType: [{ type: Input }],
    frameContext: [{ type: Input }],
    exportOption: [{ type: Input }],
    needDestroy: [{ type: Output }]
};
if (false) {
    /** @type {?} */
    ExportCustomSelectHandcraftComponent.prototype.modalFooter;
    /** @type {?} */
    ExportCustomSelectHandcraftComponent.prototype.ruleId;
    /** @type {?} */
    ExportCustomSelectHandcraftComponent.prototype.methodType;
    /** @type {?} */
    ExportCustomSelectHandcraftComponent.prototype.frameContext;
    /** @type {?} */
    ExportCustomSelectHandcraftComponent.prototype.subject;
    /** @type {?} */
    ExportCustomSelectHandcraftComponent.prototype.exportOption;
    /** @type {?} */
    ExportCustomSelectHandcraftComponent.prototype.needDestroy;
    /** @type {?} */
    ExportCustomSelectHandcraftComponent.prototype.valueField;
    /** @type {?} */
    ExportCustomSelectHandcraftComponent.prototype.enableRuntimeCustom;
    /** @type {?} */
    ExportCustomSelectHandcraftComponent.prototype.recordRule;
    /** @type {?} */
    ExportCustomSelectHandcraftComponent.prototype.currentRuleName;
    /** @type {?} */
    ExportCustomSelectHandcraftComponent.prototype.currentRuleId;
    /** @type {?} */
    ExportCustomSelectHandcraftComponent.prototype.currentRuleFileType;
    /** @type {?} */
    ExportCustomSelectHandcraftComponent.prototype.lookupIcon;
    /** @type {?} */
    ExportCustomSelectHandcraftComponent.prototype.loadingComp;
    /** @type {?} */
    ExportCustomSelectHandcraftComponent.prototype.fileListItems;
    /** @type {?} */
    ExportCustomSelectHandcraftComponent.prototype.file_type;
    /** @type {?} */
    ExportCustomSelectHandcraftComponent.prototype.export_success;
    /** @type {?} */
    ExportCustomSelectHandcraftComponent.prototype.export_fail;
    /** @type {?} */
    ExportCustomSelectHandcraftComponent.prototype.ie_cancel;
    /** @type {?} */
    ExportCustomSelectHandcraftComponent.prototype.ie_ok;
    /** @type {?} */
    ExportCustomSelectHandcraftComponent.prototype.rule_list;
    /** @type {?} */
    ExportCustomSelectHandcraftComponent.prototype.i18nResource;
    /**
     * @type {?}
     * @private
     */
    ExportCustomSelectHandcraftComponent.prototype.dataExportService;
    /**
     * @type {?}
     * @private
     */
    ExportCustomSelectHandcraftComponent.prototype.notify;
    /**
     * @type {?}
     * @private
     */
    ExportCustomSelectHandcraftComponent.prototype.http;
    /**
     * @type {?}
     * @private
     */
    ExportCustomSelectHandcraftComponent.prototype.loadingService;
    /**
     * @type {?}
     * @private
     */
    ExportCustomSelectHandcraftComponent.prototype.injector;
    /**
     * @type {?}
     * @private
     */
    ExportCustomSelectHandcraftComponent.prototype.modalService;
    /**
     * @type {?}
     * @private
     */
    ExportCustomSelectHandcraftComponent.prototype.resolver;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZXhwb3J0LWN1c3RvbS1zZWxlY3QtaGFuZGNyYWZ0LmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0Bnc3AtZGlwL2RhdGEtaW1wLWV4cC8iLCJzb3VyY2VzIjpbImxpYi9leHBvcnQtY3VzdG9tLXNlbGVjdC1oYW5kY3JhZnQvZXhwb3J0LWN1c3RvbS1zZWxlY3QtaGFuZGNyYWZ0LmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUNMLFNBQVMsRUFDVCx3QkFBd0IsRUFDeEIsWUFBWSxFQUNaLFFBQVEsRUFDUixLQUFLLEVBRUwsTUFBTSxFQUNOLFdBQVcsRUFDWCxTQUFTLEVBQ1YsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFDLFVBQVUsRUFBQyxNQUFNLGdDQUFnQyxDQUFDO0FBQzFELE9BQU8sRUFBQyxZQUFZLEVBQUMsTUFBTSxnQkFBZ0IsQ0FBQztBQUU1QyxPQUFPLEVBQW1CLGNBQWMsRUFBQyxNQUFNLG9CQUFvQixDQUFDO0FBQ3BFLE9BQU8sRUFBQyxTQUFTLEVBQUMsTUFBTSwwQkFBMEIsQ0FBQztBQUNuRCxPQUFPLEVBQUMsaUJBQWlCLEVBQUMsTUFBTSw4Q0FBOEMsQ0FBQztBQUMvRSxPQUFPLEVBQUMsYUFBYSxFQUFDLE1BQU0sbUJBQW1CLENBQUM7QUFFaEQsT0FBTyxFQUFDLFVBQVUsRUFBQyxNQUFNLHNCQUFzQixDQUFDO0FBQ2hELE9BQU8sRUFBQyxjQUFjLEVBQUMsTUFBTSxrQkFBa0IsQ0FBQztBQUNoRCxPQUFPLEVBQUMsV0FBVyxFQUFFLFlBQVksRUFBQyxNQUFNLDhCQUE4QixDQUFDO0FBQ3ZFLE9BQU8sRUFBQyxtQkFBbUIsRUFBQyxNQUFNLHNDQUFzQyxDQUFDO0FBT3pFLE1BQU0sT0FBTyxvQ0FBb0M7Ozs7Ozs7Ozs7SUFpRC9DLFlBQ1UsaUJBQW9DLEVBQ3BDLE1BQXFCLEVBQ3JCLElBQWdCLEVBQ2hCLGNBQThCLEVBQzlCLFFBQWtCLEVBQ2xCLFlBQTRCLEVB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Q0QsT0FBTyxJQUFJLENBQUM7SUFDZCxDQUFDOzs7O0lBRU0sS0FBSztRQUNWLElBQUksQ0FBQyxXQUFXLENBQUMsSUFBSSxFQUFFLENBQUM7SUFDMUIsQ0FBQzs7OztJQUVNLE1BQU07UUFDWCxJQUFJLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUM5QixDQUFDOzs7WUE1TUYsU0FBUyxTQUFDO2dCQUNULFFBQVEsRUFBRSxvQ0FBb0M7Z0JBQzlDLHk5R0FBOEQ7O2FBRS9EOzs7O1lBWk8saUJBQWlCO1lBQ2pCLGFBQWE7WUFFYixVQUFVO1lBTFEsY0FBYztZQVZ0QyxRQUFRO1lBZ0JGLGNBQWM7WUFsQnBCLHdCQUF3Qjs7OzBCQWdDdkIsU0FBUyxTQUFDLGNBQWM7cUJBQ3hCLEtBQUs7eUJBRUwsS0FBSzsyQkFFTCxLQUFLOzJCQUdMLEtBQUs7MEJBRUwsTUFBTTs7OztJQVZQLDJEQUF5RDs7SUFDekQsc0RBQ1k7O0lBQ1osMERBQ3VCOztJQUN2Qiw0REFDa0M7O0lBQ2xDLHVEQUE2Qjs7SUFDN0IsNERBQ3lCOztJQUN6QiwyREFDMEM7O0lBRTFDLDBEQUFnQjs7SUFFaEIsbUVBQTRCOztJQUU1QiwwREFBa0I7O0lBQ2xCLCtEQUFxQjs7SUFDckIsNkRBQW1COztJQUNuQixtRUFBeUI7O0lBRXpCLDBEQUFxRDs7SUFDckQsMkRBQXFDOztJQUVyQyw2REFRRTs7SUFHRix5REFBa0I7O0lBQ2xCLDhEQUF1Qjs7SUFDdkIsMkRBQW9COztJQUNwQix5REFBa0I7O0lBQ2xCLHFEQUFjOztJQUNkLHlEQUFrQjs7SUFDbEIsNERBQWtCOzs7OztJQUdoQixpRUFBNEM7Ozs7O0lBQzVDLHNEQUE2Qjs7Ozs7SUFDN0Isb0RBQXdCOzs7OztJQUN4Qiw4REFBc0M7Ozs7O0lBQ3RDLHdEQUEwQjs7Ozs7SUFDMUIsNERBQW9DOzs7OztJQUNwQyx3REFBMEMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBDb21wb25lbnQsXG4gIENvbXBvbmVudEZhY3RvcnlSZXNvbHZlcixcbiAgRXZlbnRFbWl0dGVyLFxuICBJbmplY3RvcixcbiAgSW5wdXQsXG4gIE9uSW5pdCxcbiAgT3V0cHV0LFxuICBUZW1wbGF0ZVJlZixcbiAgVmlld0NoaWxkXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHtNZXRob2RUeXBlfSBmcm9tIFwiLi4vbW9kZWwvRGF0YUlFVHlwZS9NZXRob2RUeXBlXCI7XG5pbXBvcnQge0ZyYW1lQ29udGV4dH0gZnJvbSBcIkBmYXJyaXMvZGV2a2l0XCI7XG5pbXBvcnQge1N1YmplY3R9IGZyb20gXCJyeGpzXCI7XG5pbXBvcnQge0xvYWRpbmdDb21wb25lbnQsIExvYWRpbmdTZXJ2aWNlfSBmcm9tIFwiQGZhcnJpcy91aS1sb2FkaW5nXCI7XG5pbXBvcnQge0ZpbGVDb25zdH0gZnJvbSBcIi4uL21vZGVsL3V0aWxzL0ZpbGVDb25zdFwiO1xuaW1wb3J0IHtEYXRhRXhwb3J0U2VydmljZX0gZnJvbSBcIi4uL3NlcnZpY2UvRGF0YUlFU2VydmljZS9kYXRhLWV4cG9ydC5zZXJ2aWNlXCI7XG5pbXBvcnQge05vdGlmeVNlcnZpY2V9IGZyb20gXCJAZmFycmlzL3VpLW5vdGlmeVwiO1xuaW1wb3J0IHtFbnRpdHlMaXN0U2VydmljZX0gZnJvbSBcIkBmYXJyaXMvY29tbWFuZC1zZXJ2aWNlc1wiO1xuaW1wb3J0IHtIdHRwQ2xpZW50fSBmcm9tIFwiQGFuZ3VsYXIvY29tbW9uL2h0dHBcIjtcbmltcG9ydCB7QnNNb2RhbFNlcnZpY2V9IGZyb20gXCJAZmFycmlzL3VpLW1vZGFsXCI7XG5pbXBvcnQge0RhdGFJRVV0aWxzLCBGaWxlVHlwZVV0aWx9IGZyb20gXCIuLi9zZXJ2aWNlL1V0aWxzL0RhdGFJRVV0aWxzXCI7XG5pbXBvcnQge1J1bGVTZWxlY3RDb21wb25lbnR9IGZyb20gXCIuLi9ydWxlLXNlbGVjdC9ydWxlLXNlbGVjdC5jb21wb25lbnRcIjtcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnbGliLWV4cG9ydC1jdXN0b20tc2VsZWN0LWhhbmRjcmFmdCcsXG4gIHRlbXBsYXRlVXJsOiAnLi9leHBvcnQtY3VzdG9tLXNlbGVjdC1oYW5kY3JhZnQuY29tcG9uZW50Lmh0bWwnLFxuICBzdHlsZVVybHM6IFsnLi9leHBvcnQtY3VzdG9tLXNlbGVjdC1oYW5kY3JhZnQuY29tcG9uZW50LmNzcyddXG59KVxuZXhwb3J0IGNsYXNzIEV4cG9ydEN1c3RvbVNlbGVjdEhhbmRjcmFmdENvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCB7XG5cbiAgbmdPbkRlc3Ryb3koKTogdm9pZCB7XG4gIH1cblxuICBAVmlld0NoaWxkKCdzZWxlY3RGb290ZXInKSBtb2RhbEZvb3RlcjogVGVtcGxhdGVSZWY8YW55PjtcbiAgQElucHV0KClcbiAgcnVsZUlkID0gJyc7XG4gIEBJbnB1dCgpXG4gIG1ldGhvZFR5cGU6IE1ldGhvZFR5cGU7XG4gIEBJbnB1dCgpXG4gIGZyYW1lQ29udGV4dDogRnJhbWVDb250ZXh0ID0gbnVsbDtcbiAgc3ViamVjdDogU3ViamVjdDxhbnk+ID0gbnVsbDtcbiAgQElucHV0KClcbiAgZXhwb3J0T3B0aW9uOiBhbnkgPSBudWxsO1xuICBAT3V0cHV0KClcbiAgbmVlZERlc3Ryb3kgPSBuZXcgRXZlbnRFbWl0dGVyPGJvb2xlYW4+KCk7XG5cbiAgdmFsdWVGaWVsZDogYW55O1xuXG4gIGVuYWJsZVJ1bnRpbWVDdXN0b20gPSBmYWxzZTtcbiAgLy8g6K6w5b2V55qE6KeE5YiZXG4gIHJlY29yZFJ1bGUgPSBudWxsO1xuICBjdXJyZW50UnVsZU5hbWUgPSAnJztcbiAgY3VycmVudFJ1bGVJZCA9ICcnO1xuICBjdXJyZW50UnVsZUZpbGVUeXBlID0gJyc7XG5cbiAgbG9va3VwSWNvbiA9ICc8aSBjbGFzcz1cImYtaWNvbiBmLWljb24td2luZG93c1wiPjwvaT4nO1xuICBsb2FkaW5nQ29tcDogTG9hZGluZ0NvbXBvbmVudCA9IG51bGw7XG5cbiAgcHVibGljIGZpbGVMaXN0SXRlbXMgPSBbXG4gICAge2lkOiBGaWxlQ29uc3QueGxzLCBsYWJlbDogRmlsZUNvbnN0Lnhsc30sXG4gICAge2lkOiBGaWxlQ29uc3QueGxzeCwgbGFiZWw6IEZpbGVDb25zdC54bHN4fSxcbiAgICB7aWQ6IEZpbGVDb25zdC54bHNtLCBsYWJlbDogRmlsZUNvbnN0Lnhsc219LFxuICAgIHtpZDogRmlsZUNvbnN0LmV0LCBsYWJlbDogRmlsZUNvbnN0LmV0fSxcbiAgICAvLyB7IGlkOiBGaWxlQ29uc3QuY3N2LCBsYWJlbDogRmlsZUNvbnN0LmNzdiB9LFxuICAgIC8vIHsgaWQ6IEZpbGVDb25zdC5wZGYsIGxhYmVsOiBGaWxlQ29uc3QucGRmIH0sXG4gICAgLy8geyBpZDogRmlsZUNvbnN0LnhtbCwgbGFibGU6IEZpbGVDb25zdC54bWwgfVxuICBdO1xuXG5cbiAgZmlsZV90eXBlOiBzdHJpbmc7XG4gIGV4cG9ydF9zdWNjZXNzOiBzdHJpbmc7XG4gIGV4cG9ydF9mYWlsOiBzdHJpbmc7XG4gIGllX2NhbmNlbDogc3RyaW5nO1xuICBpZV9vazogc3RyaW5nO1xuICBydWxlX2xpc3Q6IHN0cmluZztcbiAgaTE4blJlc291cmNlOiBhbnk7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSBkYXRhRXhwb3J0U2VydmljZTogRGF0YUV4cG9ydFNlcnZpY2UsXG4gICAgcHJpdmF0ZSBub3RpZnk6IE5vdGlmeVNlcnZpY2UsXG4gICAgcHJpdmF0ZSBodHRwOiBIdHRwQ2xpZW50LFxuICAgIHByaXZhdGUgbG9hZGluZ1NlcnZpY2U6IExvYWRpbmdTZXJ2aWNlLFxuICAgIHByaXZhdGUgaW5qZWN0b3I6IEluamVjdG9yLFxuICAgIHByaXZhdGUgbW9kYWxTZXJ2aWNlOiBCc01vZGFsU2VydmljZSxcbiAgICBwcml2YXRlIHJlc29sdmVyOiBDb21wb25lbnRGYWN0b3J5UmVzb2x2ZXJcbiAgKSB7XG4gICAgRGF0YUlFVXRpbHMuZ2V0VHJhbnNsYXRlVmFsdWUoaHR0cCkuc3Vic2NyaWJlKHJlcyA9PiB7XG4gICAgICB0aGlzLmV4cG9ydF9zdWNjZXNzID0gcmVzWydleHBvcnRfc3VjY2VzcyddO1xuICAgICAgdGhpcy5leHBvcnRfZmFpbCA9IHJlc1snZXhwb3J0X2ZhaWwnXTtcbiAgICAgIHRoaXMuZmlsZV90eXBlID0gcmVzWydmaWxlX3R5cGUnXTtcbiAgICAgIHRoaXMuaWVfY2FuY2VsID0gcmVzWydpZV9jYW5jZWwnXTtcbiAgICAgIHRoaXMuaWVfb2sgPSByZXNbJ2llX29rJ107XG4gICAgICB0aGlzLnJ1bGVfbGlzdCA9IHJlc1sncnVsZV9saXN0J107XG4gICAgICB0aGlzLmkxOG5SZXNvdXJjZSA9IHJlcztcbiAgICB9KTtcbiAgfVxuXG4gIG5nT25Jbml0KCkge1xuICAgIHRoaXMuY3VycmVudFJ1bGVJZCA9IHRoaXMucmVjb3JkUnVsZS5ydWxlSWQ7XG4gICAgdGhpcy5jdXJyZW50UnVsZU5hbWUgPSB0aGlzLnJlY29yZFJ1bGUucnVsZU5hbWU7XG4gICAgdGhpcy52YWx1ZUZpZWxkID0gRmlsZVR5cGVVdGlsLmdldEZpbGVUeXBlTmFtZSh0aGlzLnJlY29yZFJ1bGUuZmlsZVR5cGUpO1xuICAgIHRoaXMuY3VycmVudFJ1bGVGaWxlVHlwZSA9IHRoaXMudmFsdWVGaWVsZDtcbiAgICBpZiAodGhpcy5leHBvcnRPcHRpb24uZW5hYmxlUnVudGltZUN1c3RvbSA9PT0gdHJ1ZSkge1xuICAgICAgdGhpcy5lbmFibGVSdW50aW1lQ3VzdG9tID0gdHJ1ZTtcbiAgICB9XG4gIH1cblxuICBvcGVuU2VsZWN0UnVsZSgkZXZlbnQpIHtcbiAgICB0aGlzLmxvYWRpbmdDb21wID0gdGhpcy5sb2FkaW5nU2VydmljZS5zaG93KCk7XG4gICAgLy/ov4fmu6Top4TliJnml7bnlKjooajljZXlkb3ku6TlpITphY3nva7nmoTop4TliJnmnaXov4fmu6TvvIzlm6DmraTnlKhydWxlSWTvvIzogIzkuI3mmK9jdXJyZW50UnVsZUlkXG4gICAgY29uc3QgdXJsID0gJy9hcGkvcnVudGltZS9kaXAvdjEuMC9kYXRhSWVSdWxlTWFuYWdlL2ZpbHRlclJ1bGVzQnlSdWxlSWRBbmRWb0lkJztcbiAgICBjb25zdCBib2R5ID0ge1xuICAgICAgcnVsZUlkOiB0aGlzLnJ1bGVJZCxcbiAgICAgIHJ1bGVUeXBlOiAxLFxuICAgICAgdm9JZDogdGhpcy5leHBvcnRPcHRpb24udm9JZCxcbiAgICAgIG1ldGhvZFR5cGU6IHRoaXMubWV0aG9kVHlwZSxcbiAgICAgIGV4cG9ydENoaWxkTm9kZUNvZGU6IHRoaXMuZXhwb3J0T3B0aW9uLmV4cG9ydENoaWxkTm9kZUNvZGVcbiAgICB9O1xuICAgIHRoaXMuaHR0cC5wb3N0KHVybCwgYm9keSkuc3Vic2NyaWJlKChSdWxlTWdyczogYW55KSA9PiB7XG4gICAgICB0aGlzLmxvYWRpbmdTZXJ2aWNlLmNsZWFyQWxsKCk7XG4gICAgICBpZiAoUnVsZU1ncnMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHRoaXMubm90aWZ5LmluZm8odGhpcy5pMThuUmVzb3VyY2VbJ3J1bGVzZWxlY3RfbGlzdGVtcHR5J10pO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBjb25zdCBjb21wRmFjdG9yeSA9IHRoaXMucmVzb2x2ZXIucmVzb2x2ZUNvbXBvbmVudEZhY3RvcnkoUnVsZVNlbGVjdENvbXBvbmVudCk7XG4gICAgICBjb25zdCBjb21wUmVmID0gY29tcEZhY3RvcnkuY3JlYXRlKHRoaXMuaW5qZWN0b3IpO1xuICAgICAgY29tcFJlZi5pbnN0YW5jZS5ydWxlSWQgPSB0aGlzLnJ1bGVJZDtcbiAgICAgIGNvbXBSZWYuaW5zdGFuY2Uudm9JZCA9IHRoaXMuZXhwb3J0T3B0aW9uLnZvSWQ7XG4gICAgICBjb21wUmVmLmluc3RhbmNlLnJ1bGVUeXBlID0gMTtcbiAgICAgIGNvbXBSZWYuaW5zdGFuY2UuUnVsZU1ncnNEYXRhID0gUnVsZU1ncnM7XG4gICAgICBjb25zdCBtb2RhbENvbmZpZyA9IHtcbiAgICAgICAgdGl0bGU6IHRoaXMucnVsZV9saXN0LFxuICAgICAgICB3aWR0aDogOTUwLFxuICAgICAgICBoZWlnaHQ6IDUwMCxcbiAgICAgICAgYnV0dG9uczogY29tcFJlZi5pbnN0YW5jZS5tb2RhbEZvb3RlcixcbiAgICAgICAgc2hvd0hlYWRlcjogdHJ1ZSxcbiAgICAgICAgc2hvd01heEJ1dHRvbjogZmFsc2UsXG4gICAgICAgIHNob3dCdXR0b25zOiB0cnVlXG4gICAgICB9O1xuICAgICAgY29uc3QgZGlhbG9nID0gdGhpcy5tb2RhbFNlcnZpY2Uuc2hvdyhjb21wUmVmLCBtb2RhbENvbmZpZyk7XG4gICAgICBjb21wUmVmLmluc3RhbmNlLmNsb3NlTW9kYWwuc3Vic2NyaWJlKCgpID0+IHtcbiAgICAgICAgZGlhbG9nLmNsb3NlKCk7XG4gICAgICB9KVxuICAgICAgY29tcFJlZi5pbnN0YW5jZS5va01vZGFsLnN1YnNjcmliZShSdWxlTWdyID0+IHtcbiAgICAgICAgdGhpcy5jdXJyZW50UnVsZUlkID0gUnVsZU1nci5pZDtcbiAgICAgICAgdGhpcy5jdXJyZW50UnVsZU5hbWUgPSBSdWxlTWdyLm5hbWU7XG4gICAgICAgIHRoaXMudmFsdWVGaWVsZCA9IEZpbGVUeXBlVXRpbC5nZXRGaWxlVHlwZU5hbWUoUnVsZU1nci5maWxlVHlwZSk7XG4gICAgICAgIHRoaXMuY3VycmVudFJ1bGVGaWxlVHlwZSA9IHRoaXMudmFsdWVGaWVsZDtcbiAgICAgICAgZGlhbG9nLmNsb3NlKCk7XG4gICAgICB9KTtcbiAgICB9LCBlcnJvciA9PiB7XG4gICAgICB0aGlzLmxvYWRpbmdTZXJ2aWNlLmNsZWFyQWxsKCk7XG4gICAgICB0aGlzLm5vdGlmeS5lcnJvcihlcnJvci5lcnJvci5NZXNzYWdlKTtcbiAgICAgIGNvbnNvbGUubG9nKGVycm9yLmVycm9yLk1lc3NhZ2UpO1xuICAgIH0pO1xuICB9XG5cbiAgcHVibGljIE9rKCkge1xuICAgIGxldCBzdWZmaXggPSBudWxsO1xuICAgIGlmICh0aGlzLnZhbHVlRmllbGQgIT09IHRoaXMuY3VycmVudFJ1bGVGaWxlVHlwZSkge1xuICAgICAgc3VmZml4ID0gRmlsZVR5cGVVdGlsLmdldEZpbGVFeHRlbnNpb24odGhpcy52YWx1ZUZpZWxkKTtcbiAgICB9XG4gICAgc3dpdGNoICh0aGlzLm1ldGhvZFR5cGUpIHtcbiAgICAgIGNhc2UgTWV0aG9kVHlwZS5Db21tb25FeHBvcnQ6XG4gICAgICAgIHRoaXMuZGF0YUV4cG9ydFNlcnZpY2UuRXhwb3J0QnlJZDRIYW5kQ3JhZnQodGhpcy5jdXJyZW50UnVsZUlkLCB0aGlzLmV4cG9ydE9wdGlvbiwgc3VmZml4KTtcbiAgICAgICAgdGhpcy5leHBvcnRDb21wbGV0ZSgpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgTWV0aG9kVHlwZS5FeHBvcnRDdXJyZW50VGFibGVEYXRhOlxuICAgICAgICB0aGlzLm5vdGlmeS53YXJuaW5nKCfkuI3mlK/mjIHlr7zlh7rlvZPliY3pobUnKTtcbiAgICAgICAgdGhpcy5leHBvcnRDb21wbGV0ZSgpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgTWV0aG9kVHlwZS5FeHBvcnRDdXJyZW50Q2hpbGREYXRhOlxuICAgICAgICB0aGlzLm5vdGlmeS53YXJuaW5nKCfkuI3mlK/mjIHlr7zlh7rlrZDooajmlbDmja4nKTtcbiAgICAgICAgdGhpcy5leHBvcnRDb21wbGV0ZSgpO1xuICAgICAgICBicmVhaztcbiAgICB9XG4gIH1cblxuICBleHBvcnRDb21wbGV0ZSgpIHtcbiAgICBjb25zdCBleHBvcnRVbnNjcmliZSA9IHRoaXMuZGF0YUV4cG9ydFNlcnZpY2UuZXhwb3J0LnN1YnNjcmliZShkYXRhID0+IHtcbiAgICAgIGlmIChkYXRhID09PSAnJykge1xuICAgICAgICB0aGlzLm5vdGlmeS5zdWNjZXNzKHRoaXMuZXhwb3J0X3N1Y2Nlc3MpO1xuICAgICAgICBleHBvcnRVbnNjcmliZS51bnN1YnNjcmliZSgpO1xuICAgICAgICBjb25zdCByZXMgPSB7XG4gICAgICAgICAgdHlwZTogJ3N1Y2Nlc3MnLFxuICAgICAgICAgIGRhdGE6IG51bGwsXG4gICAgICAgICAgb3RoZXI6IG51bGxcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5zdWJqZWN0Lm5leHQocmVzKTtcbiAgICAgICAgdGhpcy5zdWJqZWN0LmNvbXBsZXRlKCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zdCBlcnJvcmxldmVsID0gdGhpcy5kYXRhRXhwb3J0U2VydmljZS5lcnJvcmxldmVsO1xuICAgICAgICBpZiAoZXJyb3JsZXZlbCA9PT0gJ0luZm8nKSB7XG4gICAgICAgICAgdGhpcy5ub3RpZnkuaW5mbyhkYXRhKTtcbiAgICAgICAgfSBlbHNlIGlmIChlcnJvcmxldmVsID09PSAnV2FybmluZycpIHtcbiAgICAgICAgICB0aGlzLm5vdGlmeS53YXJuaW5nKGRhdGEpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRoaXMubm90aWZ5LmVycm9yKHRoaXMuZXhwb3J0X2ZhaWwgKyBkYXRhKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCByZXMgPSB7XG4gICAgICAgICAgdHlwZTogJ2ZhaWwnLFxuICAgICAgICAgIGRhdGE6IG51bGwsXG4gICAgICAgICAgb3RoZXI6IGRhdGFcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5zdWJqZWN0Lm5leHQocmVzKTtcbiAgICAgICAgdGhpcy5zdWJqZWN0LmNvbXBsZXRlKCk7XG4gICAgICB9XG4gICAgICBleHBvcnRVbnNjcmliZS51bnN1YnNjcmliZSgpO1xuICAgICAgdGhpcy5uZWVkRGVzdHJveS5lbWl0KCk7XG4gICAgfSk7XG4gIH1cblxuICBjYW5TZWxlY3RGaWxlVHlwZSgpIHtcbiAgICBjb25zdCBzdWZmaXggPSBGaWxlVHlwZVV0aWwuZ2V0RmlsZUV4dGVuc2lvbih0aGlzLnZhbHVlRmllbGQpO1xuICAgIGNvbnN0IGNhbkxpc3QgPSBbJy54bHMnLCAnLnhsc3gnLCAnLnhsc20nLCAnLmV0J107XG4gICAgaWYgKGNhbkxpc3QuZmluZEluZGV4KHQgPT4gdCA9PT0gc3VmZml4KSA8IDApIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICBwdWJsaWMgY2xvc2UoKSB7XG4gICAgdGhpcy5uZWVkRGVzdHJveS5lbWl0KCk7XG4gIH1cblxuICBwdWJsaWMgQ2FuY2VsKCkge1xuICAgIHRoaXMubmVlZERlc3Ryb3kuZW1pdCh0cnVlKTtcbiAgfVxuXG59XG4iXX0=
/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Injectable, EventEmitter } from '@angular/core';
import { HttpClient } from '@angular/common/http';
import { DataIEUtils } from '../Utils/DataIEUtils';
export class FileOperateService {
    /**
     * @param {?} http
     */
    constructor(http) {
        this.http = http;
        this.origin = window.location.origin;
        this.fileUrl = this.origin + '/api/runtime/rtcommon/v1.0/fileoper';
        this.downloadComplete = new EventEmitter();
        DataIEUtils.getTranslateValue(http).subscribe((/**
         * @param {?} res
         * @return {?}
         */
        res => {
            this.file_download_fail = res['file_download_fail'];
        }));
    }
    // 下载文件
    /**
     * @param {?} relativePath
     * @param {?} fileName
     * @param {?} preurl
     * @param {?} option
     * @param {?=} needDelete
     * @return {?}
     */
    DownloadFile(relativePath, fileName, preurl, option, needDelete = true) {
        /** @type {?} */
        let tempUrl = '';
        if (preurl === '') {
            tempUrl = this.fileUrl;
        }
        else {
            tempUrl = `${preurl}/fileoper`;
        }
        /** @type {?} */
        const app = DataIEUtils.getApp(tempUrl);
        /** @type {?} */
        let su = DataIEUtils.getSu(tempUrl);
        if (option !== null && option['su'] !== null && option['su'] !== undefined) {
            su = option['su'];
        }
        /** @type {?} */
        const fileParam = {
            relativePath: relativePath,
            app: app,
            su: su
        };
        /** @type {?} */
        const fixedUrl = this.origin + '/api/runtime/dip/v1.0/rpcfileoper';
        this.http.post(`${fixedUrl}/DownloadFile`, fileParam, {
            headers: {
                'Content-Type': 'application/json',
                'Access-Control-Allow-Origin': '*'
            },
            responseType: 'blob',
            observe: 'response',
            params: { su: su }
        }).subscribe((/**
         * @param {?} filedata
         * @return {?}
         */
        filedata => {
            if (!filedata || filedata.body.size == 0) {
                this.downloadComplete.emit(this.file_download_fail);
            }
            else {
                //const blob = new Blob([filedata.body], {type: 'application/vnd.ms-excel'});
                /** @type {?} */
                const blob = new Blob([filedata.body]);
                if (navigator.msSaveOrOpenBlob) {
                    navigator.msSaveOrOpenBlob(blob, fileName);
                }
                else {
                    /** @type {?} */
                    const link = document.createElement('a');
                    link.setAttribute('href', window.URL.createObjectURL(blob));
                    // 设置下载的文件名
                    link.setAttribute('download', fileName);
                    link.style.visibility = 'hidden';
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                }
                this.downloadComplete.emit('');
                if (needDelete) {
                    this.DeleteFile(relativePath, preurl, su);
                }
            }
        }), (/**
         * @param {?} error
         * @return {?}
         */
        error => {
            this.downloadComplete.error(error);
        }));
        // 添加error异常处理
    }
    // 打包文件下载文件
    /**
     * @param {?} relativePaths
     * @param {?} itemsFileName
     * @param {?} packageName
     * @param {?} preurl
     * @param {?} packtype
     * @param {?=} needDelete
     * @return {?}
     */
    DownloadPackageFile(relativePaths, itemsFileName, packageName, preurl, packtype, needDelete = true) {
        /** @type {?} */
        let tempUrl = '';
        if (preurl === '') {
            tempUrl = this.fileUrl;
        }
        else {
            tempUrl = `${preurl}/fileoper`;
        }
        /** @type {?} */
        const app = DataIEUtils.getApp(tempUrl);
        /** @type {?} */
        const su = DataIEUtils.getSu(tempUrl);
        /** @type {?} */
        const fileParam = {
            relativePaths: relativePaths,
            itemsFileName: itemsFileName,
            packType: packtype,
            packageName: packageName,
            su: su
        };
        /** @type {?} */
        const fixedUrl = this.origin + '/api/runtime/dip/v1.0/rpcfileoper';
        this.http.post(`${fixedUrl}/DownloadPackageFile`, fileParam, {
            headers: {
                'Content-Type': 'application/json',
                'Access-Control-Allow-Origin': '*'
            },
            responseType: 'blob',
            observe: 'response',
            params: { su: su }
        }).subscribe((/**
         * @param {?} filedata
         * @return {?}
         */
        filedata => {
            if (!filedata || filedata.body.size == 0) {
                this.downloadComplete.emit(this.file_download_fail);
            }
            else {
                /** @type {?} */
                const blob = new Blob([filedata.body]);
                // 设置下载的文件名
                /** @type {?} */
                const downloadFileName = packageName + '.' + packtype;
                if (navigator.msSaveOrOpenBlob) {
                    navigator.msSaveOrOpenBlob(blob, downloadFileName);
                }
                else {
                    /** @type {?} */
                    const link = document.createElement('a');
                    link.setAttribute('href', window.URL.createObjectURL(blob));
                    link.setAttribute('download', downloadFileName);
                    link.style.visibility = 'hidden';
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                }
                this.downloadComplete.emit('');
                if (needDelete) {
                    this.DeleteFile(downloadFileName, preurl);
                }
            }
        }), (/**
         * @param {?} error
         * @return {?}
         */
        error => {
            this.downloadComplete.error(error);
        }));
        // 添加error异常处理
    }
    /**
     * 手工表单下载
     * @param {?} relativePath
     * @param {?} fileName
     * @param {?} su
     * @param {?=} needDelete
     * @return {?}
     */
    DownloadFile4HandCraft(relativePath, fileName, su, needDelete = true) {
        /** @type {?} */
        const fileParam = {
            relativePath: relativePath,
            app: '',
            su: su
        };
        /** @type {?} */
        const fixedUrl = this.origin + '/api/runtime/dip/v1.0/rpcfileoper';
        this.http.post(`${fixedUrl}/DownloadFile`, fileParam, {
            headers: {
                'Content-Type': 'application/json',
                'Access-Control-Allow-Origin': '*'
            },
            responseType: 'blob',
            observe: 'response',
            params: { su: su }
        }).subscribe((/**
         * @param {?} filedata
         * @return {?}
         */
        filedata => {
            if (!filedata || filedata.body.size == 0) {
                this.downloadComplete.emit(this.file_download_fail);
            }
            else {
                /** @type {?} */
                const blob = new Blob([filedata.body]);
                if (navigator.msSaveOrOpenBlob) {
                    navigator.msSaveOrOpenBlob(blob, fileName);
                }
                else {
                    /** @type {?} */
                    const link = document.createElement('a');
                    link.setAttribute('href', window.URL.createObjectURL(blob));
                    // 设置下载的文件名
                    link.setAttribute('download', fileName);
                    link.style.visibility = 'hidden';
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                }
                this.downloadComplete.emit('');
                if (needDelete) {
                    this.DeleteFile4HandCraft(relativePath, su);
                }
            }
        }), (/**
         * @param {?} error
         * @return {?}
         */
        error => {
            this.downloadComplete.error(error);
        }));
        // 添加error异常处理
    }
    // 删除文件
    /**
     * @param {?} relativePath
     * @param {?} preurl
     * @param {?=} customSu
     * @return {?}
     */
    DeleteFile(relativePath, preurl, customSu = '') {
        /** @type {?} */
        let tempUrl = '';
        if (preurl === '') {
            tempUrl = this.fileUrl;
        }
        else {
            tempUrl = `${preurl}/fileoper`;
        }
        /** @type {?} */
        let su = '';
        if (customSu !== '') {
            su = customSu;
        }
        else {
            su = DataIEUtils.getSu(tempUrl);
        }
        /** @type {?} */
        const delParam = {
            relativePath: relativePath,
            su: su
        };
        /** @type {?} */
        const fixedUrl = this.origin + '/api/runtime/dip/v1.0/rpcfileoper';
        this.http.post(`${fixedUrl}/DeleteFile`, delParam, {
            params: { su: su }
        }).subscribe();
    }
    /**
     * @param {?} relativePath
     * @param {?} su
     * @return {?}
     */
    DeleteFile4HandCraft(relativePath, su) {
        /** @type {?} */
        const delParam = {
            relativePath: relativePath,
            su: su
        };
        /** @type {?} */
        const fixedUrl = this.origin + '/api/runtime/dip/v1.0/rpcfileoper';
        this.http.post(`${fixedUrl}/DeleteFile`, delParam, {
            params: { su: su }
        }).subscribe();
    }
}
FileOperateService.decorators = [
    { type: Injectable }
];
/** @nocollapse */
FileOperateService.ctorParameters = () => [
    { type: HttpClient }
];
if (false) {
    /**
     * @type {?}
     * @private
     */
    FileOperateService.prototype.origin;
    /**
     * @type {?}
     * @private
     */
    FileOperateService.prototype.fileUrl;
    /** @type {?} */
    FileOperateService.prototype.downloadComplete;
    /**
     * @type {?}
     * @private
     */
    FileOperateService.prototype.file_download_fail;
    /**
     * @type {?}
     * @private
     */
    FileOperateService.prototype.http;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmlsZS1vcGVyYXRlLnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZ3NwLWRpcC9kYXRhLWltcC1leHAvIiwic291cmNlcyI6WyJsaWIvc2VydmljZS9EYXRhSUVTZXJ2aWNlL2ZpbGUtb3BlcmF0ZS5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFVLFlBQVksRUFBWSxNQUFNLGVBQWUsQ0FBQztBQUMzRSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFDbEQsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBR25ELE1BQU0sT0FBTyxrQkFBa0I7Ozs7SUFLN0IsWUFDVSxJQUFnQjtRQUFoQixTQUFJLEdBQUosSUFBSSxDQUFZO1FBTGxCLFdBQU0sR0FBRyxNQUFNLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQztRQUNoQyxZQUFPLEdBQUcsSUFBSSxDQUFDLE1BQU0sR0FBRyxxQ0FBcUMsQ0FBQztRQU1wRSxJQUFJLENBQUMsZ0JBQWdCLEdBQUcsSUFBSSxZQUFZLEVBQUUsQ0FBQztRQUMzQyxXQUFXLENBQUMsaUJBQWlCLENBQUMsSUFBSSxDQUFDLENBQUMsU0FBUzs7OztRQUFDLEdBQUcsQ0FBQyxFQUFFO1lBQ2xELElBQUksQ0FBQyxrQkFBa0IsR0FBRyxHQUFHLENBQUMsb0JBQW9CLENBQUMsQ0FBQztRQUN0RCxDQUFDLEVBQUMsQ0FBQztJQUNMLENBQUM7Ozs7Ozs7Ozs7SUFFRCxZQUFZLENBQUMsWUFBb0IsRUFBRSxRQUFnQixFQUFFLE1BQWMsRUFBRSxNQUFXLEVBQUUsYUFBc0IsSUFBSTs7WUFFdEcsT0FBTyxHQUFHLEVBQUU7UUFDaEIsSUFBSSxNQUFNLEtBQUssRUFBRSxFQUFFO1lBQ2pCLE9BQU8sR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDO1NBQ3hCO2FBQU07WUFDTCxPQUFPLEdBQUcsR0FBRyxNQUFNLFdBQVcsQ0FBQztTQUNo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QVU7O2NBQzdDLFFBQVEsR0FBRztZQUNmLFlBQVksRUFBRSxZQUFZO1lBQzFCLEVBQUUsRUFBRSxFQUFFO1NBQ1A7O2NBQ0ssUUFBUSxHQUFHLElBQUksQ0FBQyxNQUFNLEdBQUcsbUNBQW1DO1FBQ2xFLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUNaLEdBQUcsUUFBUSxhQUFhLEVBQ3hCLFFBQVEsRUFDUjtZQUNFLE1BQU0sRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUU7U0FDbkIsQ0FDRixDQUFDLFNBQVMsRUFBRSxDQUFDO0lBQ2hCLENBQUM7OztZQXZPRixVQUFVOzs7O1lBSEYsVUFBVTs7Ozs7OztJQUtqQixvQ0FBd0M7Ozs7O0lBQ3hDLHFDQUFzRTs7SUFDdEUsOENBQTZCOzs7OztJQUM3QixnREFBbUM7Ozs7O0lBRWpDLGtDQUF3QiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUsIE91dHB1dCwgRXZlbnRFbWl0dGVyLCBJbmplY3RvciB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBIdHRwQ2xpZW50IH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uL2h0dHAnO1xyXG5pbXBvcnQgeyBEYXRhSUVVdGlscyB9IGZyb20gJy4uL1V0aWxzL0RhdGFJRVV0aWxzJztcclxuXHJcbkBJbmplY3RhYmxlKClcclxuZXhwb3J0IGNsYXNzIEZpbGVPcGVyYXRlU2VydmljZSB7XHJcbiAgcHJpdmF0ZSBvcmlnaW4gPSB3aW5kb3cubG9jYXRpb24ub3JpZ2luO1xyXG4gIHByaXZhdGUgZmlsZVVybCA9IHRoaXMub3JpZ2luICsgJy9hcGkvcnVudGltZS9ydGNvbW1vbi92MS4wL2ZpbGVvcGVyJztcclxuICBwdWJsaWMgZG93bmxvYWRDb21wbGV0ZTogYW55O1xyXG4gIHByaXZhdGUgZmlsZV9kb3dubG9hZF9mYWlsOiBzdHJpbmc7XHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICBwcml2YXRlIGh0dHA6IEh0dHBDbGllbnQsXHJcbiAgKSB7XHJcbiAgICB0aGlzLmRvd25sb2FkQ29tcGxldGUgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcbiAgICBEYXRhSUVVdGlscy5nZXRUcmFuc2xhdGVWYWx1ZShodHRwKS5zdWJzY3JpYmUocmVzID0+IHtcclxuICAgICAgdGhpcy5maWxlX2Rvd25sb2FkX2ZhaWwgPSByZXNbJ2ZpbGVfZG93bmxvYWRfZmFpbCddO1xyXG4gICAgfSk7XHJcbiAgfVxyXG4gIC8vIOS4i+i9veaWh+S7tlxyXG4gIERvd25sb2FkRmlsZShyZWxhdGl2ZVBhdGg6IHN0cmluZywgZmlsZU5hbWU6IHN0cmluZywgcHJldXJsOiBzdHJpbmcsIG9wdGlvbjogYW55LCBuZWVkRGVsZXRlOiBib29sZWFuID0gdHJ1ZSkge1xyXG5cclxuICAgIGxldCB0ZW1wVXJsID0gJyc7XHJcbiAgICBpZiAocHJldXJsID09PSAnJykge1xyXG4gICAgICB0ZW1wVXJsID0gdGhpcy5maWxlVXJsO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGVtcFVybCA9IGAke3ByZXVybH0vZmlsZW9wZXJgO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IGFwcCA9IERhdGFJRVV0aWxzLmdldEFwcCh0ZW1wVXJsKTtcclxuICAgIGxldCBzdSA9IERhdGFJRVV0aWxzLmdldFN1KHRlbXBVcmwpO1xyXG4gICAgaWYgKG9wdGlvbiAhPT0gbnVsbCAmJiBvcHRpb25bJ3N1J10gIT09IG51bGwgJiYgb3B0aW9uWydzdSddICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgc3UgPSBvcHRpb25bJ3N1J107XHJcbiAgICB9XHJcbiAgICBjb25zdCBmaWxlUGFyYW0gPSB7XHJcbiAgICAgIHJlbGF0aXZlUGF0aDogcmVsYXRpdmVQYXRoLFxyXG4gICAgICBhcHA6IGFwcCxcclxuICAgICAgc3U6IHN1XHJcbiAgICB9O1xyXG4gICAgY29uc3QgZml4ZWRVcmwgPSB0aGlzLm9yaWdpbiArICcvYXBpL3J1bnRpbWUvZGlwL3YxLjAvcnBjZmlsZW9wZXInO1xyXG5cclxuICAgIHRoaXMuaHR0cC5wb3N0KFxyXG4gICAgICBgJHtmaXhlZFVybH0vRG93bmxvYWRGaWxlYCxcclxuICAgICAgZmlsZVBhcmFtLFxyXG4gICAgICB7XHJcbiAgICAgICAgaGVhZGVyczoge1xyXG4gICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyxcclxuICAgICAgICAgICdBY2Nlc3MtQ29udHJvbC1BbGxvdy1PcmlnaW4nOiAnKidcclxuICAgICAgICB9LFxyXG4gICAgICAgIHJlc3BvbnNlVHlwZTogJ2Jsb2InLFxyXG4gICAgICAgIG9ic2VydmU6ICdyZXNwb25zZScsXHJcbiAgICAgICAgcGFyYW1zOiB7IHN1OiBzdSB9XHJcbiAgICAgIH1cclxuICAgICkuc3Vic2NyaWJlKGZpbGVkYXRhID0+IHtcclxuICAgICAgaWYgKCFmaWxlZGF0YSB8fCBmaWxlZGF0YS5ib2R5LnNpemUgPT0gMCkge1xyXG4gICAgICAgIHRoaXMuZG93bmxvYWRDb21wbGV0ZS5lbWl0KHRoaXMuZmlsZV9kb3dubG9hZF9mYWlsKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICAvL2NvbnN0IGJsb2IgPSBuZXcgQmxvYihbZmlsZWRhdGEuYm9keV0sIHt0eXBlOiAnYXBwbGljYXRpb24vdm5kLm1zLWV4Y2VsJ30pO1xyXG4gICAgICAgIGNvbnN0IGJsb2IgPSBuZXcgQmxvYihbZmlsZWRhdGEuYm9keV0pO1xyXG4gICAgICAgIGlmIChuYXZpZ2F0b3IubXNTYXZlT3JPcGVuQmxvYikge1xyXG4gICAgICAgICAgbmF2aWdhdG9yLm1zU2F2ZU9yT3BlbkJsb2IoYmxvYiwgZmlsZU5hbWUpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICBjb25zdCBsaW5rID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpO1xyXG4gICAgICAgICAgbGluay5zZXRBdHRyaWJ1dGUoJ2hyZWYnLCB3aW5kb3cuVVJMLmNyZWF0ZU9iamVjdFVSTChibG9iKSk7XHJcbiAgICAgICAgICAvLyDorr7nva7kuIvovb3nmoTmlofku7blkI1cclxuICAgICAgICAgIGxpbmsuc2V0QXR0cmlidXRlKCdkb3dubG9hZCcsIGZpbGVOYW1lKTtcclxuICAgICAgICAgIGxpbmsuc3R5bGUudmlzaWJpbGl0eSA9ICdoaWRkZW4nO1xyXG4gICAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChsaW5rKTtcclxuICAgICAgICAgIGxpbmsuY2xpY2soKTtcclxuICAgICAgICAgIGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQobGluayk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuZG93bmxvYWRDb21wbGV0ZS5lbWl0KCcnKTtcclxuICAgICAgICBpZiAobmVlZERlbGV0ZSkge1xyXG4gICAgICAgICAgdGhpcy5EZWxldGVGaWxlKHJlbGF0aXZlUGF0aCwgcHJldXJsLCBzdSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9LCBlcnJvciA9PiB7XHJcbiAgICAgIHRoaXMuZG93bmxvYWRDb21wbGV0ZS5lcnJvcihlcnJvcik7XHJcbiAgICB9KTtcclxuICAgIC8vIOa3u+WKoGVycm9y5byC5bi45aSE55CGXHJcbiAgfVxyXG4gIC8vIOaJk+WMheaWh+S7tuS4i+i9veaWh+S7tlxyXG4gIERvd25sb2FkUGFja2FnZUZpbGUocmVsYXRpdmVQYXRoczogYW55LCBpdGVtc0ZpbGVOYW1lOiBhbnksIHBhY2thZ2VOYW1lOiBzdHJpbmcsIHByZXVybDogc3RyaW5nLCBwYWNrdHlwZTogc3RyaW5nLCBuZWVkRGVsZXRlOiBib29sZWFuID0gdHJ1ZSkge1xyXG5cclxuICAgIGxldCB0ZW1wVXJsID0gJyc7XHJcbiAgICBpZiAocHJldXJsID09PSAnJykge1xyXG4gICAgICB0ZW1wVXJsID0gdGhpcy5maWxlVXJsO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGVtcFVybCA9IGAke3ByZXVybH0vZmlsZW9wZXJgO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IGFwcCA9IERhdGFJRVV0aWxzLmdldEFwcCh0ZW1wVXJsKTtcclxuICAgIGNvbnN0IHN1ID0gRGF0YUlFVXRpbHMuZ2V0U3UodGVtcFVybCk7XHJcbiAgICBjb25zdCBmaWxlUGFyYW0gPSB7XHJcbiAgICAgIHJlbGF0aXZlUGF0aHM6IHJlbGF0aXZlUGF0aHMsXHJcbiAgICAgIGl0ZW1zRmlsZU5hbWU6IGl0ZW1zRmlsZU5hbWUsXHJcbiAgICAgIHBhY2tUeXBlOiBwYWNrdHlwZSxcclxuICAgICAgcGFja2FnZU5hbWU6IHBhY2thZ2VOYW1lLFxyXG4gICAgICBzdTogc3VcclxuICAgIH07XHJcbiAgICBjb25zdCBmaXhlZFVybCA9IHRoaXMub3JpZ2luICsgJy9hcGkvcnVudGltZS9kaXAvdjEuMC9ycGNmaWxlb3Blcic7XHJcblxyXG4gICAgdGhpcy5odHRwLnBvc3QoXHJcbiAgICAgIGAke2ZpeGVkVXJsfS9Eb3dubG9hZFBhY2thZ2VGaWxlYCxcclxuICAgICAgZmlsZVBhcmFtLFxyXG4gICAgICB7XHJcbiAgICAgICAgaGVhZGVyczoge1xyXG4gICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyxcclxuICAgICAgICAgICdBY2Nlc3MtQ29udHJvbC1BbGxvdy1PcmlnaW4nOiAnKidcclxuICAgICAgICB9LFxyXG4gICAgICAgIHJlc3BvbnNlVHlwZTogJ2Jsb2InLFxyXG4gICAgICAgIG9ic2VydmU6ICdyZXNwb25zZScsXHJcbiAgICAgICAgcGFyYW1zOiB7IHN1OiBzdSB9XHJcbiAgICAgIH1cclxuICAgICkuc3Vic2NyaWJlKGZpbGVkYXRhID0+IHtcclxuICAgICAgaWYgKCFmaWxlZGF0YSB8fCBmaWxlZGF0YS5ib2R5LnNpemUgPT0gMCkge1xyXG4gICAgICAgIHRoaXMuZG93bmxvYWRDb21wbGV0ZS5lbWl0KHRoaXMuZmlsZV9kb3dubG9hZF9mYWlsKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBjb25zdCBibG9iID0gbmV3IEJsb2IoW2ZpbGVkYXRhLmJvZHldKTtcclxuICAgICAgICAvLyDorr7nva7kuIvovb3nmoTmlofku7blkI1cclxuICAgICAgICBjb25zdCBkb3dubG9hZEZpbGVOYW1lID0gcGFja2FnZU5hbWUgKyAnLicgKyBwYWNrdHlwZTtcclxuICAgICAgICBpZiAobmF2aWdhdG9yLm1zU2F2ZU9yT3BlbkJsb2IpIHtcclxuICAgICAgICAgIG5hdmlnYXRvci5tc1NhdmVPck9wZW5CbG9iKGJsb2IsIGRvd25sb2FkRmlsZU5hbWUpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICBjb25zdCBsaW5rID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpO1xyXG4gICAgICAgICAgbGluay5zZXRBdHRyaWJ1dGUoJ2hyZWYnLCB3aW5kb3cuVVJMLmNyZWF0ZU9iamVjdFVSTChibG9iKSk7XHJcbiAgICAgICAgICBsaW5rLnNldEF0dHJpYnV0ZSgnZG93bmxvYWQnLCBkb3dubG9hZEZpbGVOYW1lKTtcclxuICAgICAgICAgIGxpbmsuc3R5bGUudmlzaWJpbGl0eSA9ICdoaWRkZW4nO1xyXG4gICAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChsaW5rKTtcclxuICAgICAgICAgIGxpbmsuY2xpY2soKTtcclxuICAgICAgICAgIGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQobGluayk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuZG93bmxvYWRDb21wbGV0ZS5lbWl0KCcnKTtcclxuICAgICAgICBpZiAobmVlZERlbGV0ZSkge1xyXG4gICAgICAgICAgdGhpcy5EZWxldGVGaWxlKGRvd25sb2FkRmlsZU5hbWUsIHByZXVybCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9LCBlcnJvciA9PiB7XHJcbiAgICAgIHRoaXMuZG93bmxvYWRDb21wbGV0ZS5lcnJvcihlcnJvcik7XHJcbiAgICB9KTtcclxuICAgIC8vIOa3u+WKoGVycm9y5byC5bi45aSE55CGXHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOaJi+W3peihqOWNleS4i+i9vVxyXG4gICAqIEBwYXJhbSByZWxhdGl2ZVBhdGggXHJcbiAgICogQHBhcmFtIGZpbGVOYW1lIFxyXG4gICAqIEBwYXJhbSBzdSBcclxuICAgKiBAcGFyYW0gbmVlZERlbGV0ZSBcclxuICAgKi9cclxuICBEb3dubG9hZEZpbGU0SGFuZENyYWZ0KHJlbGF0aXZlUGF0aDogc3RyaW5nLCBmaWxlTmFtZTogc3RyaW5nLCBzdTogc3RyaW5nLCBuZWVkRGVsZXRlOiBib29sZWFuID0gdHJ1ZSkge1xyXG4gICAgY29uc3QgZmlsZVBhcmFtID0ge1xyXG4gICAgICByZWxhdGl2ZVBhdGg6IHJlbGF0aXZlUGF0aCxcclxuICAgICAgYXBwOiAnJyxcclxuICAgICAgc3U6IHN1XHJcbiAgICB9O1xyXG4gICAgY29uc3QgZml4ZWRVcmwgPSB0aGlzLm9yaWdpbiArICcvYXBpL3J1bnRpbWUvZGlwL3YxLjAvcnBjZmlsZW9wZXInO1xyXG5cclxuICAgIHRoaXMuaHR0cC5wb3N0KFxyXG4gICAgICBgJHtmaXhlZFVybH0vRG93bmxvYWRGaWxlYCxcclxuICAgICAgZmlsZVBhcmFtLFxyXG4gICAgICB7XHJcbiAgICAgICAgaGVhZGVyczoge1xyXG4gICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyxcclxuICAgICAgICAgICdBY2Nlc3MtQ29udHJvbC1BbGxvdy1PcmlnaW4nOiAnKidcclxuICAgICAgICB9LFxyXG4gICAgICAgIHJlc3BvbnNlVHlwZTogJ2Jsb2InLFxyXG4gICAgICAgIG9ic2VydmU6ICdyZXNwb25zZScsXHJcbiAgICAgICAgcGFyYW1zOiB7IHN1OiBzdSB9XHJcbiAgICAgIH1cclxuICAgICkuc3Vic2NyaWJlKGZpbGVkYXRhID0+IHtcclxuICAgICAgaWYgKCFmaWxlZGF0YSB8fCBmaWxlZGF0YS5ib2R5LnNpemUgPT0gMCkge1xyXG4gICAgICAgIHRoaXMuZG93bmxvYWRDb21wbGV0ZS5lbWl0KHRoaXMuZmlsZV9kb3dubG9hZF9mYWlsKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBjb25zdCBibG9iID0gbmV3IEJsb2IoW2ZpbGVkYXRhLmJvZHldKTtcclxuICAgICAgICBpZiAobmF2aWdhdG9yLm1zU2F2ZU9yT3BlbkJsb2IpIHtcclxuICAgICAgICAgIG5hdmlnYXRvci5tc1NhdmVPck9wZW5CbG9iKGJsb2IsIGZpbGVOYW1lKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgY29uc3QgbGluayA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTtcclxuICAgICAgICAgIGxpbmsuc2V0QXR0cmlidXRlKCdocmVmJywgd2luZG93LlVSTC5jcmVhdGVPYmplY3RVUkwoYmxvYikpO1xyXG4gICAgICAgICAgLy8g6K6+572u5LiL6L2955qE5paH5Lu25ZCNXHJcbiAgICAgICAgICBsaW5rLnNldEF0dHJpYnV0ZSgnZG93bmxvYWQnLCBmaWxlTmFtZSk7XHJcbiAgICAgICAgICBsaW5rLnN0eWxlLnZpc2liaWxpdHkgPSAnaGlkZGVuJztcclxuICAgICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQobGluayk7XHJcbiAgICAgICAgICBsaW5rLmNsaWNrKCk7XHJcbiAgICAgICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKGxpbmspO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmRvd25sb2FkQ29tcGxldGUuZW1pdCgnJyk7XHJcbiAgICAgICAgaWYgKG5lZWREZWxldGUpIHtcclxuICAgICAgICAgIHRoaXMuRGVsZXRlRmlsZTRIYW5kQ3JhZnQocmVsYXRpdmVQYXRoLCBzdSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9LCBlcnJvciA9PiB7XHJcbiAgICAgIHRoaXMuZG93bmxvYWRDb21wbGV0ZS5lcnJvcihlcnJvcik7XHJcbiAgICB9KTtcclxuICAgIC8vIOa3u+WKoGVycm9y5byC5bi45aSE55CGXHJcbiAgfVxyXG4gIC8vIOWIoOmZpOaWh+S7tlxyXG4gIERlbGV0ZUZpbGUocmVsYXRpdmVQYXRoOiBzdHJpbmcsIHByZXVybDogc3RyaW5nLCBjdXN0b21TdTogc3RyaW5nID0gJycpIHtcclxuICAgIGxldCB0ZW1wVXJsID0gJyc7XHJcbiAgICBpZiAocHJldXJsID09PSAnJykge1xyXG4gICAgICB0ZW1wVXJsID0gdGhpcy5maWxlVXJsO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGVtcFVybCA9IGAke3ByZXVybH0vZmlsZW9wZXJgO1xyXG4gICAgfVxyXG4gICAgbGV0IHN1ID0gJyc7XHJcbiAgICBpZiAoY3VzdG9tU3UgIT09ICcnKSB7XHJcbiAgICAgIHN1ID0gY3VzdG9tU3U7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBzdSA9IERhdGFJRVV0aWxzLmdldFN1KHRlbXBVcmwpO1xyXG4gICAgfVxyXG4gICAgY29uc3QgZGVsUGFyYW0gPSB7XHJcbiAgICAgIHJlbGF0aXZlUGF0aDogcmVsYXRpdmVQYXRoLFxyXG4gICAgICBzdTogc3VcclxuICAgIH07XHJcbiAgICBjb25zdCBmaXhlZFVybCA9IHRoaXMub3JpZ2luICsgJy9hcGkvcnVudGltZS9kaXAvdjEuMC9ycGNmaWxlb3Blcic7XHJcbiAgICB0aGlzLmh0dHAucG9zdChcclxuICAgICAgYCR7Zml4ZWRVcmx9L0RlbGV0ZUZpbGVgLFxyXG4gICAgICBkZWxQYXJhbSxcclxuICAgICAge1xyXG4gICAgICAgIHBhcmFtczogeyBzdTogc3UgfVxyXG4gICAgICB9XHJcbiAgICApLnN1YnNjcmliZSgpO1xyXG4gIH1cclxuICBEZWxldGVGaWxlNEhhbmRDcmFmdChyZWxhdGl2ZVBhdGg6IHN0cmluZywgc3U6IHN0cmluZykge1xyXG4gICAgY29uc3QgZGVsUGFyYW0gPSB7XHJcbiAgICAgIHJlbGF0aXZlUGF0aDogcmVsYXRpdmVQYXRoLFxyXG4gICAgICBzdTogc3VcclxuICAgIH07XHJcbiAgICBjb25zdCBmaXhlZFVybCA9IHRoaXMub3JpZ2luICsgJy9hcGkvcnVudGltZS9kaXAvdjEuMC9ycGNmaWxlb3Blcic7XHJcbiAgICB0aGlzLmh0dHAucG9zdChcclxuICAgICAgYCR7Zml4ZWRVcmx9L0RlbGV0ZUZpbGVgLFxyXG4gICAgICBkZWxQYXJhbSxcclxuICAgICAge1xyXG4gICAgICAgIHBhcmFtczogeyBzdTogc3UgfVxyXG4gICAgICB9XHJcbiAgICApLnN1YnNjcmliZSgpO1xyXG4gIH1cclxufVxyXG4iXX0=
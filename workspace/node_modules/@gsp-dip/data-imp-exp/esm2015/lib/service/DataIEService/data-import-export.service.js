/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { ComponentFactoryResolver, Injectable, Injector } from '@angular/core';
import { ImportDialogComponent } from '../../import-dialog/import-dialog.component';
import { ExportDialogComponent } from '../../custom-export-dialog/export-dialog.component';
import { BsModalService } from '@farris/ui-modal';
import { FrameContext } from '@farris/devkit';
import { MethodType } from '../../model/DataIEType/MethodType';
import { EntityListService } from '@farris/command-services';
import { NotifyService } from '@farris/ui-notify';
import { DataExportService } from './data-export.service';
import { Subject } from 'rxjs';
import { CustomDataIEService } from './custom-data-ie.service';
import { CustomImportDialogComponent } from '../../custom-import-dialog/custom-import-dialog.component';
import { ExportCustomSelectComponent } from '../../export-custom-select/export-custom-select.component';
import { HttpClient } from '@angular/common/http';
import { DataIEUtils, isNullOrEmpty, isNullOrUndefined } from '../Utils/DataIEUtils';
import { DataieHandcraftService } from './dataie-handcraft.service';
import { LoadingService } from '@farris/ui-loading';
import { DataImportService } from "./data-import.service";
export class DataImportExportService {
    /**
     * @param {?} modalService
     * @param {?} resolver
     * @param {?} injector
     * @param {?} frameContext
     * @param {?} dataExportService
     * @param {?} notify
     * @param {?} entityService
     * @param {?} customIEService
     * @param {?} handcraftSer
     * @param {?} http
     * @param {?} loadingService
     * @param {?} dataImportService
     */
    constructor(modalService, resolver, injector, frameContext, dataExportService, notify, entityService, customIEService, handcraftSer, http, loadingService, dataImportService) {
        this.modalService = modalService;
        this.resolver = resolver;
        this.injector = injector;
        this.frameContext = frameContext;
        this.dataExportService = dataExportService;
        this.notify = notify;
        this.entityService = entityService;
        this.customIEService = customIEService;
        this.handcraftSer = handcraftSer;
        this.http = http;
        this.loadingService = loadingService;
        this.dataImportService = dataImportService;
        DataIEUtils.getTranslateValue(http).subscribe((/**
         * @param {?} res
         * @return {?}
         */
        res => {
            this.i18nResource = res;
            this.data_import = res['data_import'];
            this.data_export = res['data_export'];
            this.export_success = res['export_success'];
            this.export_fail = res['export_fail'];
            this.data_export_customfile = res['data_export_customfile'];
            this.rule_list = res['rule_list'];
        }));
    }
    /**
     * 根据规则导出
     * @param {?} ruleID
     * @param {?} option
     * @return {?}
     */
    ExportByRule(ruleID, option) {
        /** @type {?} */
        const subject = new Subject();
        /** @type {?} */
        const optionJson = this.ParseExportJson(option);
        if (optionJson.packSize) {
            //获取总共有多少条数据
            /** @type {?} */
            const totalData = this.frameContext.bindingData.pagingInfo.total;
            if (isNullOrUndefined(totalData) || totalData <= 0) {
                this.notify.warning('未获取到总数据量或数据量为0，无法进行分批打包导出，请检查');
                subject.next(false);
                subject.complete();
            }
            else {
                /** @type {?} */
                let filterConditions = [];
                if (optionJson.enableScreeningScheme === true) {
                    /** @type {?} */
                    const filterConditionList = this.frameContext.uiState['filterConditionList'];
                    if (!isNullOrUndefined(filterConditionList) && filterConditionList !== '' && filterConditionList !== '[]') {
                        /** @type {?} */
                        let filterConditionListJson = [];
                        if (typeof (filterConditionList) === 'string') {
                            filterConditionListJson = JSON.parse(filterConditionList);
                        }
                        else {
                            filterConditionListJson = filterConditionList;
                        }
                        for (let index = 0; index < filterConditionListJson.length; index++) {
                            /** @type {?} */
                            const element = filterConditionListJson[index];
                            element.Value = decodeURIComponent(element.Value);
                            if (index === filterConditionListJson.length - 1) {
                                element.Relation = 0;
                            }
                            filterConditions.push(element);
                        }
                    }
                }
                //分页大小，对应的每个Excel文件的数据量
                /** @type {?} */
                const pageSize = Number.parseInt(optionJson.packSize);
                /** @type {?} */
                const num = Math.ceil(totalData / pageSize);
                /** @type {?} */
                const packitems = [];
                for (let i = 0; i < num; i++) {
                    /** @type {?} */
                    const packitem = {
                        ruleid: ruleID,
                        globalParam: optionJson.globalParam,
                        filter: {
                            filterConditions: filterConditions,
                            isUsePagination: true,
                            pagination: {
                                pageIndex: i + 1,
                                pageSize: pageSize
                            }
                        }
                    };
                    packitems.push(packitem);
                }
                /** @type {?} */
                let customfilename = '打包导出' + new Date();
                if (!isNullOrEmpty(optionJson.customfilename)) {
                    customfilename = optionJson.customfilename;
                }
                /** @type {?} */
                const option = {
                    package: {
                        customfilename: customfilename,
                        packitems: packitems
                    }
                };
                this.ExportByPackage(JSON.stringify(option)).subscribe((/**
                 * @param {?} s
                 * @return {?}
                 */
                s => {
                    subject.next(s);
                    subject.complete();
                }));
            }
        }
        else {
            this.ExportCommonEntry(ruleID, option, MethodType.CommonExport).subscribe((/**
             * @param {?} s
             * @return {?}
             */
            s => {
                subject.next(s);
                subject.complete();
            }));
        }
        return subject;
    }
    /**
     * 根据规则导出
     * @param {?} ruleID
     * @param {?} option
     * @return {?}
     */
    ExportCurrentChildData(ruleID, option) {
        /** @type {?} */
        const subject = new Subject();
        this.ExportCommonEntry(ruleID, option, MethodType.ExportCurrentChildData).subscribe((/**
         * @param {?} s
         * @return {?}
         */
        s => {
            subject.next(s);
            subject.complete();
        }));
        return subject;
    }
    /**
     * 导出当前列表数据（分页）
     * @param {?} ruleID
     * @param {?} option
     * @return {?}
     */
    ExportCurrentListData(ruleID, option) {
        /** @type {?} */
        const subject = new Subject();
        this.ExportCommonEntry(ruleID, option, MethodType.ExportCurrentTableData).subscribe((/**
         * @param {?} s
         * @return {?}
         */
        s => {
            subject.next(s);
            subject.complete();
        }));
        return subject;
    }
    /**
     * 批量打包导出
     * @param {?} option 配置打包信息
     * @return {?}
     */
    ExportByPackage(option) {
        console.log(option);
        /** @type {?} */
        const subject = new Subject();
        /** @type {?} */
        const optionJson = this.ParseExportJson(option);
        this.dataExportService.ExportByPackage(this.frameContext.repository, optionJson);
        /** @type {?} */
        const unscriber = this.dataExportService.export.subscribe((/**
         * @param {?} data
         * @return {?}
         */
        data => {
            if (data === '') {
                this.notify.success(this.export_success);
                unscriber.unsubscribe();
                subject.next(true);
                subject.complete();
            }
            else {
                /** @type {?} */
                const errorlevel = this.dataExportService.errorlevel;
                if (errorlevel === 'Info') {
                    this.notify.info(data);
                }
                else if (errorlevel === 'Warning') {
                    this.notify.warning(data);
                }
                else {
                    this.notify.error(this.export_fail + data);
                }
                unscriber.unsubscribe();
                subject.next(false);
                subject.complete();
            }
        }));
        return subject;
    }
    /**
     * @private
     * @param {?} ruleID
     * @param {?} option
     * @param {?} methodType
     * @return {?}
     */
    ExportCommonEntry(ruleID, option, methodType) {
        /** @type {?} */
        const subject = new Subject();
        console.log(option);
        /** @type {?} */
        const optionJson = this.ParseExportJson(option);
        if (isNullOrEmpty(ruleID) && isNullOrEmpty(optionJson.voId)) {
            this.notify.warning("未配置规则id，且无法获取到表单对应的voId，请检查");
            return subject;
        }
        if (methodType === MethodType.ExportCurrentChildData) {
            if (isNullOrEmpty(ruleID) && isNullOrEmpty(optionJson.exportChildNodeCode)) {
                //导出子表当规则id为空时，根据vo找规则，必须要求有配置子表节点
                this.notify.warning("规则id为空时，根据Vo查找规则，导出子表必须配置子表节点");
                return subject;
            }
        }
        if (isNullOrEmpty(ruleID) || optionJson.enableRuntimeCustom === true || optionJson.selectfiletype === true) {
            /** @type {?} */
            const befRestService = DataIEUtils.GetBefRestService(this.frameContext.repository);
            this.StartLoading();
            /** @type {?} */
            const url = '/api/runtime/dip/v1.0/dataIeRuleManage/getRecordRuleInfo';
            /** @type {?} */
            const postBody = {
                body: {
                    ruleId: ruleID,
                    ruleType: 1,
                    voId: optionJson.voId,
                    methodType: methodType,
                    exportChildNodeCode: optionJson.exportChildNodeCode,
                    enableRuntimeCustom: optionJson.enableRuntimeCustom === true
                }
            };
            /** @type {?} */
            let subscriber;
            if (!isNullOrUndefined(this.http)) {
                subscriber = this.http.post(url, postBody.body);
            }
            else {
                subscriber = befRestService.request(url, 'post', null, postBody);
            }
            subscriber.subscribe((/**
             * @param {?} recordRule
             * @return {?}
             */
            recordRule => {
                this.CloseLoading();
                this.ExportByRuleImpl(ruleID, optionJson, methodType, recordRule).subscribe((/**
                 * @param {?} s
                 * @return {?}
                 */
                s => {
                    subject.next(s);
                    subject.complete();
                }));
            }), (/**
             * @param {?} error
             * @return {?}
             */
            error => {
                this.CloseLoading();
                this.notify.error(error.error.Message);
                console.log(error.error.Message);
            }));
        }
        else {
            this.ExportByRuleImpl(ruleID, optionJson, methodType).subscribe((/**
             * @param {?} s
             * @return {?}
             */
            s => {
                subject.next(s);
                subject.complete();
            }));
        }
        return subject;
    }
    /**
     * @private
     * @param {?} ruleID
     * @param {?} optionJson
     * @param {?} mType
     * @param {?=} recordRule
     * @return {?}
     */
    ExportByRuleImpl(ruleID, optionJson, mType, recordRule) {
        /** @type {?} */
        const subject = new Subject();
        if (optionJson.customExportTitle !== undefined && optionJson.customExportTitle !== null) {
            if (optionJson.customExportTitle.length > 20) {
                this.notify.warning('自定义标题名称的长度太长');
                return subject;
            }
            if (DataIEUtils.JudgeIllegalChar(optionJson.customExportTitle)) {
                this.notify.warning('自定义标题名称存在不合法字符');
                return subject;
            }
        }
        if (optionJson.applyui === true) {
            /** @type {?} */
            const cmpRef = this.CreateExportComponent();
            cmpRef.instance.ruleId = ruleID;
            cmpRef.instance.exportOption = optionJson;
            cmpRef.instance.frameContext = this.frameContext;
            cmpRef.instance.methodType = mType;
            cmpRef.instance.subject = subject;
            cmpRef.instance.show = optionJson.vsto;
            cmpRef.instance.isCustomExport = false;
            /** @type {?} */
            const exportModalConfig = this.GetExportDialogConfig(cmpRef, optionJson);
            /** @type {?} */
            const dialog = this.modalService.show(cmpRef, exportModalConfig);
            cmpRef.instance.needDestroy.subscribe((/**
             * @param {?} $event
             * @return {?}
             */
            $event => {
                dialog.close();
            }));
        }
        else if (optionJson.enableRuntimeCustom === true || optionJson.selectfiletype === true) {
            /** @type {?} */
            const cmpRef = this.CreateSelectExportComponent();
            cmpRef.instance.ruleId = ruleID;
            cmpRef.instance.exportOption = optionJson;
            cmpRef.instance.recordRule = recordRule;
            cmpRef.instance.frameContext = this.frameContext;
            cmpRef.instance.methodType = mType;
            cmpRef.instance.subject = subject;
            /** @type {?} */
            const exportModalConfig = this.GetSelectExportDialogConfig(cmpRef, optionJson);
            /** @type {?} */
            const dialog = this.modalService.show(cmpRef, exportModalConfig);
            cmpRef.instance.needDestroy.subscribe((/**
             * @param {?} $event
             * @return {?}
             */
            $event => {
                dialog.close();
            }));
        }
        else {
            if (!isNullOrUndefined(recordRule) && !isNullOrEmpty(recordRule.ruleId)) {
                ruleID = recordRule.ruleId;
            }
            if (mType == MethodType.CommonExport) {
                this.dataExportService.ExportById(ruleID, this.frameContext, optionJson);
            }
            else if (mType == MethodType.ExportCurrentTableData) {
                this.dataExportService.ExportCurrentData(ruleID, this.frameContext, this.entityService.pageIndex, this.entityService.pageSize, optionJson);
            }
            else {
                this.dataExportService.ExportCurrentChildData(ruleID, this.frameContext, optionJson);
            }
            /** @type {?} */
            const unscriber = this.dataExportService.export.subscribe((/**
             * @param {?} data
             * @return {?}
             */
            data => {
                if (data === '') {
                    // 有人需求导出去掉成功提示，因为文件还没下载下来提示提前了
                    if (optionJson.cancelnotify === undefined || optionJson.cancelnotify === null || optionJson.cancelnotify === false) {
                        this.notify.success(this.export_success);
                    }
                    subject.next(true);
                    subject.complete();
                }
                else {
                    /** @type {?} */
                    const errorlevel = this.dataExportService.errorlevel;
                    if (errorlevel === 'Info') {
                        this.notify.info(data);
                    }
                    else if (errorlevel === 'Warning') {
                        this.notify.warning(data);
                    }
                    else {
                        this.notify.error(this.export_fail + data);
                    }
                    subject.next(false);
                    subject.complete();
                }
                unscriber.unsubscribe();
            }), (/**
             * @param {?} error
             * @return {?}
             */
            error => {
                this.notify.error(error.error.Message);
                subject.next(false);
                subject.complete();
            }));
        }
        return subject;
    }
    /**
     * 通用导入方法
     * @param {?} type
     * @param {?} ruleID
     * @param {?} option
     * @return {?}
     */
    CommonDataImport(type, ruleID, option) {
        // if (type !== 2 && (ruleID === undefined || ruleID === null || ruleID === '')) {
        //     this.notify.error('请在表单导入命令动作处配置导入规则ID');
        //     return;
        // }
        if (type === 1) {
            console.log('执行方法：ImportSublistData');
            return this.ImportSublistData(ruleID, option);
        }
        else if (type === 2) {
            console.log('执行方法：ImportByModel');
            return this.ImportByModel(option);
        }
        else if (type === 0) {
            console.log('执行方法：ImportByRule');
            return this.ImportByRule(ruleID, option);
        }
        else {
            console.log('执行方法：ImportByRule');
            return this.ImportByRule(ruleID, option);
        }
    }
    /**
     * 卡片表单数据导入（主从表，子表，统一只导入到表单）
     * @param {?} dataId
     * @param {?} ruleID
     * @param {?} option
     * @return {?}
     */
    CardDataImport(dataId, ruleID, option) {
        /** @type {?} */
        const subject = new Subject();
        console.log(dataId);
        if (!dataId) {
            this.notify.warning('未读取到主表数据id，不允许导入');
            subject.next(false);
            return subject;
        }
        /** @type {?} */
        const optionJson = this.ParseImportJson(option);
        optionJson['mainObjId'] = dataId;
        this.frameContext.repository.updateAllChanges().subscribe((/**
         * @param {?} e
         * @return {?}
         */
        e => {
            this.ImportCommonEntry(ruleID, JSON.stringify(optionJson), MethodType.CardFormDataImport).subscribe((/**
             * @param {?} s
             * @return {?}
             */
            s => {
                subject.next(s);
                subject.complete();
            }));
        }));
        return subject;
    }
    /**
     * 通用导出方法
     * @param {?} type
     * @param {?} ruleID
     * @param {?} option
     * @return {?}
     */
    CommonDataExport(type, ruleID, option) {
        // if (type !== 2 && (ruleID === undefined || ruleID === null || ruleID === '')) {
        //     this.notify.error('请在表单导出命令动作处配置导出规则ID');
        //     return;
        // }
        if (type === 1) {
            console.log('执行方法：ExportCurrentListData');
            // const pageInfo = new PageInfo();
            // pageInfo.pageIndex = this.entityService.pageIndex;
            // pageInfo.pageSize = this.entityService.pageSize;
            return this.ExportCurrentListData(ruleID, option);
        }
        else if (type === 2) {
            console.log('执行方法：ExportByModel');
            return this.ExportByModel(option);
        }
        else if (type === 3) {
            console.log('执行方法：ExportCurrentChildData');
            return this.ExportCurrentChildData(ruleID, option);
        }
        else if (type === 0) {
            console.log('执行方法：ExportByRule');
            return this.ExportByRule(ruleID, option);
        }
        else {
            console.log('执行方法：ExportByRule');
            return this.ExportByRule(ruleID, option);
        }
    }
    /**
     * @private
     * @param {?} option
     * @return {?}
     */
    ParseExportJson(option) {
        /** @type {?} */
        const voId = this.frameContext.appContext.formId;
        if (isNullOrUndefined(option) || isNullOrEmpty(option)) {
            return { filter: null, voId: voId, customfilename: '', applyui: false, vsto: false };
        }
        /** @type {?} */
        let optionJson = null;
        try {
            optionJson = JSON.parse(option);
        }
        catch (_a) {
            this.notify.warning('传入的参数转换JSON对象异常，已使用默认参数');
            return { filter: null, voId: voId, customfilename: '', applyui: false, vsto: false };
        }
        if (typeof (optionJson) !== 'object') {
            optionJson = {};
        }
        optionJson['voId'] = voId;
        return optionJson;
    }
    /**
     * @private
     * @param {?} option
     * @return {?}
     */
    ParseImportJson(option) {
        /** @type {?} */
        const voId = this.frameContext.appContext.formId;
        if (isNullOrUndefined(option) || isNullOrEmpty(option)) {
            return { templatefilename: '', GlobalParam: '', voId: voId };
        }
        /** @type {?} */
        let optionJson = null;
        try {
            optionJson = JSON.parse(option);
        }
        catch (_a) {
            this.notify.warning('传入的参数转换JSON对象异常，已使用默认参数');
            return { templatefilename: '', GlobalParam: '', voId: voId };
        }
        if (typeof (optionJson) !== 'object') {
            optionJson = {};
        }
        /** @type {?} */
        let globalParam = optionJson['globalParam'];
        if (globalParam !== undefined && globalParam !== null) {
            optionJson['GlobalParam'] = globalParam;
        }
        optionJson['voId'] = voId;
        return optionJson;
    }
    /**
     * @param {?} option
     * @return {?}
     */
    ExportByModel(option) {
        /** @type {?} */
        const subject = new Subject();
        /** @type {?} */
        const optionJson = JSON.parse(option);
        /** @type {?} */
        const model = optionJson.dataExchangeModel;
        /** @type {?} */
        const components = [];
        if (optionJson.components !== undefined && optionJson.components !== null && optionJson.components.length > 0) {
            optionJson.components.forEach((/**
             * @param {?} c
             * @return {?}
             */
            c => components.push(JSON.stringify(c))));
        }
        /** @type {?} */
        let i18nId = '';
        if (optionJson.I18nMetadataID !== undefined && optionJson.I18nMetadataID !== null) {
            i18nId = optionJson.I18nMetadataID;
        }
        /** @type {?} */
        let filter = null;
        if (optionJson.filter !== undefined && optionJson.filter !== null) {
            filter = optionJson.filter;
        }
        /** @type {?} */
        const cmpRef = this.CreateExportComponent();
        cmpRef.instance.frameContext = this.frameContext;
        cmpRef.instance.methodType = MethodType.CommonExport;
        cmpRef.instance.isCustomExport = true;
        cmpRef.instance.Model = model;
        cmpRef.instance.subject = subject;
        cmpRef.instance.components = components;
        cmpRef.instance.i18nId = i18nId;
        cmpRef.instance.filter = filter;
        cmpRef.instance.exportOption = optionJson;
        /** @type {?} */
        const modelStr = JSON.stringify(model);
        cmpRef.instance.InnerModel = JSON.parse(modelStr);
        /** @type {?} */
        const exportModalConfig = this.GetExportDialogConfig(cmpRef, optionJson);
        /** @type {?} */
        const keys = ['DataExport', model['MainObject']['Source']['SourceMetadataID'], optionJson.dimension];
        this.customIEService.GetExportRuleModel(keys, this.frameContext.repository, i18nId, model).subscribe((/**
         * @param {?} data
         * @return {?}
         */
        data => {
            if (data['success'] === true) {
                cmpRef.instance.CustomModel = JSON.parse(data['modelStr']);
            }
            if (i18nId !== '' && data['i18nModel'] !== undefined && data['i18nModel'] !== null) {
                /** @type {?} */
                const i18nModel = JSON.parse(data['i18nModel']);
                cmpRef.instance.Model = i18nModel;
                /** @type {?} */
                const modelStr = JSON.stringify(i18nModel);
                cmpRef.instance.InnerModel = JSON.parse(modelStr);
            }
            /** @type {?} */
            const dialog = this.modalService.show(cmpRef, exportModalConfig);
            cmpRef.instance.needDestroy.subscribe((/**
             * @param {?} $event
             * @return {?}
             */
            $event => {
                dialog.close();
            }));
        }));
        return subject;
        // const dialog = this.modalService.show(cmpRef, exportModalConfig);
        // cmpRef.instance.needDestroy.subscribe($event => { dialog.close(); });
    }
    /**
     * @param {?} option
     * @return {?}
     */
    ImportByModel(option) {
        /** @type {?} */
        const optionJson = JSON.parse(option);
        /** @type {?} */
        const model = optionJson.dataExchangeModel;
        /** @type {?} */
        const subject = new Subject();
        /** @type {?} */
        const components = [];
        if (optionJson.components !== undefined && optionJson.components !== null && optionJson.components.length > 0) {
            optionJson.components.forEach((/**
             * @param {?} c
             * @return {?}
             */
            c => components.push(JSON.stringify(c))));
        }
        /** @type {?} */
        let i18nId = '';
        if (optionJson.I18nMetadataID !== undefined && optionJson.I18nMetadataID !== null) {
            i18nId = optionJson.I18nMetadataID;
        }
        if (optionJson.customImportTitle !== undefined && optionJson.customImportTitle !== null) {
            if (optionJson.customImportTitle.length > 20) {
                this.notify.warning('自定义标题名称的长度太长');
                return subject;
            }
            if (DataIEUtils.JudgeIllegalChar(optionJson.customImportTitle)) {
                this.notify.warning('自定义标题名称存在不合法字符');
                return subject;
            }
        }
        /** @type {?} */
        const cmpRef = this.CreateCustomImportComponent();
        cmpRef.instance.frameContext = this.frameContext;
        cmpRef.instance.importOption = optionJson;
        // cmpRef.instance.methodType = MethodType.ImportSubTableDetail;
        cmpRef.instance.subject = subject;
        cmpRef.instance.i18nId = i18nId;
        cmpRef.instance.Model = model;
        /** @type {?} */
        const modelStr = JSON.stringify(model);
        cmpRef.instance.InnerModel = JSON.parse(modelStr);
        cmpRef.instance.components = components;
        /** @type {?} */
        const importModalConfig = this.GetCustomImportDialogConfig(cmpRef, optionJson);
        /** @type {?} */
        const keys = ['DataImport', model['MainObject']['Source']['SourceMetadataID'], optionJson.dimension];
        this.customIEService.GetImportRuleModel(keys, this.frameContext.repository, i18nId, model).subscribe((/**
         * @param {?} data
         * @return {?}
         */
        data => {
            if (data['success'] === true) {
                cmpRef.instance.CustomModel = JSON.parse(data['modelStr']);
            }
            if (i18nId !== '' && data['i18nModel'] !== undefined && data['i18nModel'] !== null) {
                /** @type {?} */
                const i18nModel = JSON.parse(data['i18nModel']);
                cmpRef.instance.Model = i18nModel;
                /** @type {?} */
                const modelStr = JSON.stringify(i18nModel);
                cmpRef.instance.InnerModel = JSON.parse(modelStr);
            }
            /** @type {?} */
            const dialog = this.modalService.show(cmpRef, importModalConfig);
            cmpRef.instance.needDestroy.subscribe((/**
             * @param {?} $event
             * @return {?}
             */
            $event => {
                dialog.close();
            }));
        }));
        return subject;
    }
    /**
     * 下载导入模板
     * @param {?} ruleID
     * @param {?} option
     * @return {?}
     */
    DownloadTemplate(ruleID, option) {
        /** @type {?} */
        const subject = new Subject();
        this.ImportCommonEntry(ruleID, option, MethodType.DownloadImportTemplate).subscribe((/**
         * @param {?} s
         * @return {?}
         */
        s => {
            subject.next(s);
            subject.complete();
        }));
        return subject;
    }
    /**
     * 根据规则导入
     * @param {?} ruleID
     * @param {?} option
     * @return {?}
     */
    ImportByRule(ruleID, option) {
        /** @type {?} */
        const subject = new Subject();
        this.ImportCommonEntry(ruleID, option, MethodType.CommonImport).subscribe((/**
         * @param {?} s
         * @return {?}
         */
        s => {
            subject.next(s);
            subject.complete();
        }));
        return subject;
    }
    /**
     * 导入子表数据
     * @param {?} ruleID
     * @param {?} option
     * @return {?}
     */
    ImportSublistData(ruleID, option) {
        /** @type {?} */
        const subject = new Subject();
        this.ImportCommonEntry(ruleID, option, MethodType.ImportSubTableDetail).subscribe((/**
         * @param {?} s
         * @return {?}
         */
        s => {
            subject.next(s);
            subject.complete();
        }));
        return subject;
    }
    /**
     * @private
     * @param {?} ruleID
     * @param {?} option
     * @param {?} methodType
     * @return {?}
     */
    ImportCommonEntry(ruleID, option, methodType) {
        console.log(option);
        /** @type {?} */
        const subject = new Subject();
        /** @type {?} */
        const befRestService = DataIEUtils.GetBefRestService(this.frameContext.repository);
        /** @type {?} */
        const su = DataIEUtils.getSu(befRestService.baseUri);
        /** @type {?} */
        const optionJson = this.ParseImportJson(option);
        if (methodType === MethodType.ImportSubTableDetail) {
            if (isNullOrEmpty(ruleID) && isNullOrEmpty(optionJson.importChildNodeCode)) {
                //导入子表当规则id为空时，根据vo找规则，必须要求有配置子表节点
                this.notify.warning("规则id为空时，根据Vo查找规则，导入子表必须配置子表节点");
                return subject;
            }
        }
        this.StartLoading();
        /** @type {?} */
        const url = '/api/runtime/dip/v1.0/dataIeRuleManage/getRecordRuleInfo';
        /** @type {?} */
        const postBody = {
            body: {
                ruleId: ruleID,
                su: su,
                ruleType: 0,
                voId: optionJson.voId,
                methodType: methodType,
                importChildNodeCode: optionJson.importChildNodeCode,
                enableRuntimeCustom: optionJson.enableRuntimeCustom === true
            }
        };
        /** @type {?} */
        let subscriber;
        if (!isNullOrUndefined(this.http)) {
            subscriber = this.http.post(url, postBody.body);
        }
        else {
            subscriber = befRestService.request(url, 'post', null, postBody);
        }
        subscriber.subscribe((/**
         * @param {?} recordRule
         * @return {?}
         */
        recordRule => {
            this.CloseLoading();
            this.ImportByRuleImpl(ruleID, optionJson, methodType, recordRule).subscribe((/**
             * @param {?} s
             * @return {?}
             */
            s => {
                subject.next(s);
                subject.complete();
            }));
        }), (/**
         * @param {?} error
         * @return {?}
         */
        error => {
            this.CloseLoading();
            this.notify.error(error.error.Message);
            console.log(error.error.Message);
        }));
        return subject;
    }
    /**
     * @private
     * @param {?} ruleID
     * @param {?} optionJson
     * @param {?} methodType
     * @param {?=} recordRule
     * @return {?}
     */
    ImportByRuleImpl(ruleID, optionJson, methodType, recordRule) {
        /** @type {?} */
        const subject = new Subject();
        if (methodType === MethodType.DownloadImportTemplate) {
            this.loadingService.show();
            /** @type {?} */
            const ruleId = recordRule.ruleId ? recordRule.ruleId : ruleID;
            this.dataImportService.DowmloadTemplate(ruleId, this.frameContext.repository, optionJson, null);
            this.dataImportService.complete.subscribe((/**
             * @param {?} data
             * @return {?}
             */
            data => {
                this.loadingService.clearAll();
                if (data === '') {
                    this.notify.success(this.i18nResource.download_template_ok);
                    subject.next(true);
                    subject.complete();
                }
                else {
                    this.notify.error(this.i18nResource.download_template_fail + data);
                    subject.next(false);
                    subject.complete();
                }
            }));
        }
        else {
            if (optionJson.customImportTitle !== undefined && optionJson.customImportTitle !== null) {
                if (optionJson.customImportTitle.length > 20) {
                    this.notify.warning('自定义标题名称的长度太长');
                    return subject;
                }
                if (DataIEUtils.JudgeIllegalChar(optionJson.customImportTitle)) {
                    this.notify.warning('自定义标题名称存在不合法字符');
                    return subject;
                }
            }
            /** @type {?} */
            const cmpRef = this.CreateImportComponent();
            cmpRef.instance.ruleId = ruleID;
            cmpRef.instance.importOption = optionJson;
            cmpRef.instance.recordRule = recordRule;
            cmpRef.instance.frameContext = this.frameContext;
            cmpRef.instance.methodType = methodType;
            cmpRef.instance.subject = subject;
            /** @type {?} */
            const importModalConfig = this.GetImportDialogConfig(cmpRef, optionJson);
            /** @type {?} */
            const dialog = this.modalService.show(cmpRef, importModalConfig);
            cmpRef.instance.needDestroy.subscribe((/**
             * @param {?} $event
             * @return {?}
             */
            $event => {
                dialog.close();
            }));
        }
        return subject;
    }
    /**
     * @return {?}
     */
    StartLoading() {
        if (this.loadingService !== undefined && this.loadingService !== null) {
            this.loadingService.show();
        }
    }
    /**
     * @return {?}
     */
    CloseLoading() {
        if (this.loadingService !== undefined && this.loadingService !== null) {
            this.loadingService.clearAll();
        }
    }
    /**
     * @private
     * @param {?} cmpRef
     * @param {?} optionJson
     * @return {?}
     */
    GetImportDialogConfig(cmpRef, optionJson) {
        /** @type {?} */
        let title = this.data_import;
        if (optionJson.customImportTitle !== undefined && optionJson.customImportTitle !== null) {
            title = optionJson.customImportTitle;
        }
        /** @type {?} */
        const importModalConfig = {
            title: title,
            width: 530,
            height: 342,
            buttons: cmpRef.instance.modalFooter,
            showCloseButton: true,
            showMaxButton: false,
            showMinButton: false,
            showButtons: true,
            resizable: false
        };
        return importModalConfig;
    }
    /**
     * @private
     * @param {?} cmpRef
     * @param {?} optionJson
     * @return {?}
     */
    GetCustomImportDialogConfig(cmpRef, optionJson) {
        /** @type {?} */
        let title = this.data_import;
        if (optionJson.customImportTitle !== undefined && optionJson.customImportTitle !== null) {
            title = optionJson.customImportTitle;
        }
        /** @type {?} */
        const importModalConfig = {
            title: title,
            width: 950,
            height: 570,
            buttons: cmpRef.instance.modalFooter,
            showCloseButton: true,
            showMaxButton: false,
            showMinButton: false,
            showButtons: true,
            resizable: false
        };
        return importModalConfig;
    }
    /**
     * @private
     * @param {?} cmpRef
     * @param {?} optionJson
     * @return {?}
     */
    GetExportDialogConfig(cmpRef, optionJson) {
        /** @type {?} */
        let title = this.data_export;
        if (optionJson.customExportTitle !== undefined && optionJson.customExportTitle !== null) {
            title = optionJson.customExportTitle;
        }
        /** @type {?} */
        const exportModalConfig = {
            title: title,
            width: 922,
            height: 530,
            buttons: cmpRef.instance.modalFooter,
            showCloseButton: true,
            showMaxButton: false,
            showMinButton: false,
            showButtons: true,
            resizable: false
        };
        return exportModalConfig;
    }
    /**
     * @private
     * @param {?} cmpRef
     * @param {?} optionJson
     * @return {?}
     */
    GetSelectExportDialogConfig(cmpRef, optionJson) {
        /** @type {?} */
        let title = this.data_export;
        if (optionJson.customExportTitle !== undefined && optionJson.customExportTitle !== null) {
            title = optionJson.customExportTitle;
        }
        /** @type {?} */
        const exportModalConfig = {
            title: title,
            width: 530,
            height: 342,
            buttons: cmpRef.instance.modalFooter,
            showCloseButton: true,
            showMaxButton: false,
            showMinButton: false,
            showButtons: true,
            resizable: false
        };
        return exportModalConfig;
    }
    // 创建输入组件实例
    /**
     * @private
     * @return {?}
     */
    CreateImportComponent() {
        /** @type {?} */
        const compFactory = this.resolver.resolveComponentFactory(ImportDialogComponent);
        /** @type {?} */
        const cmpRef = compFactory.create(this.injector);
        return cmpRef;
    }
    // 创建输出组件实例
    /**
     * @private
     * @return {?}
     */
    CreateExportComponent() {
        /** @type {?} */
        const compFactory = this.resolver.resolveComponentFactory(ExportDialogComponent);
        /** @type {?} */
        const cmpRef = compFactory.create(this.injector);
        return cmpRef;
    }
    /**
     * @private
     * @return {?}
     */
    CreateSelectExportComponent() {
        /** @type {?} */
        const compFactory = this.resolver.resolveComponentFactory(ExportCustomSelectComponent);
        /** @type {?} */
        const cmpRef = compFactory.create(this.injector);
        return cmpRef;
    }
    /**
     * @private
     * @return {?}
     */
    CreateCustomImportComponent() {
        /** @type {?} */
        const compFactory = this.resolver.resolveComponentFactory(CustomImportDialogComponent);
        /** @type {?} */
        const cmpRef = compFactory.create(this.injector);
        return cmpRef;
    }
}
DataImportExportService.decorators = [
    { type: Injectable }
];
/** @nocollapse */
DataImportExportService.ctorParameters = () => [
    { type: BsModalService },
    { type: ComponentFactoryResolver },
    { type: Injector },
    { type: FrameContext },
    { type: DataExportService },
    { type: NotifyService },
    { type: EntityListService },
    { type: CustomDataIEService },
    { type: DataieHandcraftService },
    { type: HttpClient },
    { type: LoadingService },
    { type: DataImportService }
];
if (false) {
    /** @type {?} */
    DataImportExportService.prototype.data_import;
    /** @type {?} */
    DataImportExportService.prototype.data_export;
    /** @type {?} */
    DataImportExportService.prototype.data_export_customfile;
    /** @type {?} */
    DataImportExportService.prototype.export_success;
    /** @type {?} */
    DataImportExportService.prototype.export_fail;
    /** @type {?} */
    DataImportExportService.prototype.rule_list;
    /** @type {?} */
    DataImportExportService.prototype.i18nResource;
    /**
     * @type {?}
     * @private
     */
    DataImportExportService.prototype.modalService;
    /**
     * @type {?}
     * @private
     */
    DataImportExportService.prototype.resolver;
    /**
     * @type {?}
     * @private
     */
    DataImportExportService.prototype.injector;
    /**
     * @type {?}
     * @private
     */
    DataImportExportService.prototype.frameContext;
    /**
     * @type {?}
     * @private
     */
    DataImportExportService.prototype.dataExportService;
    /**
     * @type {?}
     * @private
     */
    DataImportExportService.prototype.notify;
    /**
     * @type {?}
     * @private
     */
    DataImportExportService.prototype.entityService;
    /**
     * @type {?}
     * @private
     */
    DataImportExportService.prototype.customIEService;
    /**
     * @type {?}
     * @private
     */
    DataImportExportService.prototype.handcraftSer;
    /**
     * @type {?}
     * @private
     */
    DataImportExportService.prototype.http;
    /**
     * @type {?}
     * @private
     */
    DataImportExportService.prototype.loadingService;
    /**
     * @type {?}
     * @private
     */
    DataImportExportService.prototype.dataImportService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0YS1pbXBvcnQtZXhwb3J0LnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZ3NwLWRpcC9kYXRhLWltcC1leHAvIiwic291cmNlcyI6WyJsaWIvc2VydmljZS9EYXRhSUVTZXJ2aWNlL2RhdGEtaW1wb3J0LWV4cG9ydC5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUMsd0JBQXdCLEVBQUUsVUFBVSxFQUFFLFFBQVEsRUFBQyxNQUFNLGVBQWUsQ0FBQztBQUM3RSxPQUFPLEVBQUMscUJBQXFCLEVBQUMsTUFBTSw2Q0FBNkMsQ0FBQztBQUNsRixPQUFPLEVBQUMscUJBQXFCLEVBQUMsTUFBTSxvREFBb0QsQ0FBQztBQUN6RixPQUFPLEVBQUMsY0FBYyxFQUFDLE1BQU0sa0JBQWtCLENBQUM7QUFDaEQsT0FBTyxFQUFDLFlBQVksRUFBQyxNQUFNLGdCQUFnQixDQUFDO0FBQzVDLE9BQU8sRUFBQyxVQUFVLEVBQUMsTUFBTSxtQ0FBbUMsQ0FBQztBQUM3RCxPQUFPLEVBQUMsaUJBQWlCLEVBQUMsTUFBTSwwQkFBMEIsQ0FBQztBQUMzRCxPQUFPLEVBQUMsYUFBYSxFQUFDLE1BQU0sbUJBQW1CLENBQUM7QUFDaEQsT0FBTyxFQUFDLGlCQUFpQixFQUFDLE1BQU0sdUJBQXVCLENBQUM7QUFDeEQsT0FBTyxFQUFhLE9BQU8sRUFBQyxNQUFNLE1BQU0sQ0FBQztBQUN6QyxPQUFPLEVBQUMsbUJBQW1CLEVBQUMsTUFBTSwwQkFBMEIsQ0FBQztBQUM3RCxPQUFPLEVBQUMsMkJBQTJCLEVBQUMsTUFBTSwyREFBMkQsQ0FBQztBQUN0RyxPQUFPLEVBQUMsMkJBQTJCLEVBQUMsTUFBTSwyREFBMkQsQ0FBQztBQUN0RyxPQUFPLEVBQUMsVUFBVSxFQUFDLE1BQU0sc0JBQXNCLENBQUM7QUFDaEQsT0FBTyxFQUFDLFdBQVcsRUFBZ0IsYUFBYSxFQUFFLGlCQUFpQixFQUFDLE1BQU0sc0JBQXNCLENBQUM7QUFDakcsT0FB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MkI7O2NBQzNCLFdBQVcsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLHVCQUF1QixDQUFDLDJCQUEyQixDQUFDOztjQUNoRixNQUFNLEdBQUcsV0FBVyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDO1FBQ2hELE9BQU8sTUFBTSxDQUFDO0lBQ2hCLENBQUM7Ozs7O0lBRU8sMkJBQTJCOztjQUMzQixXQUFXLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyx1QkFBdUIsQ0FBQywyQkFBMkIsQ0FBQzs7Y0FDaEYsTUFBTSxHQUFHLFdBQVcsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQztRQUNoRCxPQUFPLE1BQU0sQ0FBQztJQUNoQixDQUFDOzs7WUE1eEJGLFVBQVU7Ozs7WUFoQkgsY0FBYztZQUhkLHdCQUF3QjtZQUFjLFFBQVE7WUFJOUMsWUFBWTtZQUlaLGlCQUFpQjtZQURqQixhQUFhO1lBRGIsaUJBQWlCO1lBSWpCLG1CQUFtQjtZQUtuQixzQkFBc0I7WUFGdEIsVUFBVTtZQUdWLGNBQWM7WUFDZCxpQkFBaUI7Ozs7SUFJdkIsOENBQW9COztJQUNwQiw4Q0FBb0I7O0lBQ3BCLHlEQUErQjs7SUFDL0IsaURBQXVCOztJQUN2Qiw4Q0FBb0I7O0lBQ3BCLDRDQUFrQjs7SUFFbEIsK0NBQWtCOzs7OztJQUdoQiwrQ0FBb0M7Ozs7O0lBQ3BDLDJDQUEwQzs7Ozs7SUFDMUMsMkNBQTBCOzs7OztJQUMxQiwrQ0FBa0M7Ozs7O0lBQ2xDLG9EQUE0Qzs7Ozs7SUFDNUMseUNBQTZCOzs7OztJQUM3QixnREFBd0M7Ozs7O0lBQ3hDLGtEQUE0Qzs7Ozs7SUFDNUMsK0NBQTRDOzs7OztJQUM1Qyx1Q0FBd0I7Ozs7O0lBQ3hCLGlEQUFzQzs7Ozs7SUFDdEMsb0RBQTRDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtDb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIsIEluamVjdGFibGUsIEluamVjdG9yfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHtJbXBvcnREaWFsb2dDb21wb25lbnR9IGZyb20gJy4uLy4uL2ltcG9ydC1kaWFsb2cvaW1wb3J0LWRpYWxvZy5jb21wb25lbnQnO1xyXG5pbXBvcnQge0V4cG9ydERpYWxvZ0NvbXBvbmVudH0gZnJvbSAnLi4vLi4vY3VzdG9tLWV4cG9ydC1kaWFsb2cvZXhwb3J0LWRpYWxvZy5jb21wb25lbnQnO1xyXG5pbXBvcnQge0JzTW9kYWxTZXJ2aWNlfSBmcm9tICdAZmFycmlzL3VpLW1vZGFsJztcclxuaW1wb3J0IHtGcmFtZUNvbnRleHR9IGZyb20gJ0BmYXJyaXMvZGV2a2l0JztcclxuaW1wb3J0IHtNZXRob2RUeXBlfSBmcm9tICcuLi8uLi9tb2RlbC9EYXRhSUVUeXBlL01ldGhvZFR5cGUnO1xyXG5pbXBvcnQge0VudGl0eUxpc3RTZXJ2aWNlfSBmcm9tICdAZmFycmlzL2NvbW1hbmQtc2VydmljZXMnO1xyXG5pbXBvcnQge05vdGlmeVNlcnZpY2V9IGZyb20gJ0BmYXJyaXMvdWktbm90aWZ5JztcclxuaW1wb3J0IHtEYXRhRXhwb3J0U2VydmljZX0gZnJvbSAnLi9kYXRhLWV4cG9ydC5zZXJ2aWNlJztcclxuaW1wb3J0IHtPYnNlcnZhYmxlLCBTdWJqZWN0fSBmcm9tICdyeGpzJztcclxuaW1wb3J0IHtDdXN0b21EYXRhSUVTZXJ2aWNlfSBmcm9tICcuL2N1c3RvbS1kYXRhLWllLnNlcnZpY2UnO1xyXG5pbXBvcnQge0N1c3RvbUltcG9ydERpYWxvZ0NvbXBvbmVudH0gZnJvbSAnLi4vLi4vY3VzdG9tLWltcG9ydC1kaWFsb2cvY3VzdG9tLWltcG9ydC1kaWFsb2cuY29tcG9uZW50JztcclxuaW1wb3J0IHtFeHBvcnRDdXN0b21TZWxlY3RDb21wb25lbnR9IGZyb20gJy4uLy4uL2V4cG9ydC1jdXN0b20tc2VsZWN0L2V4cG9ydC1jdXN0b20tc2VsZWN0LmNvbXBvbmVudCc7XHJcbmltcG9ydCB7SHR0cENsaWVudH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uL2h0dHAnO1xyXG5pbXBvcnQge0RhdGFJRVV0aWxzLCBGaWxlVHlwZVV0aWwsIGlzTnVsbE9yRW1wdHksIGlzTnVsbE9yVW5kZWZpbmVkfSBmcm9tICcuLi9VdGlscy9EYXRhSUVVdGlscyc7XHJcbmltcG9ydCB7RGF0YWllSGFuZGNyYWZ0U2VydmljZX0gZnJvbSAnLi9kYXRhaWUtaGFuZGNyYWZ0LnNlcnZpY2UnO1xyXG5pbXBvcnQge0xvYWRpbmdTZXJ2aWNlfSBmcm9tICdAZmFycmlzL3VpLWxvYWRpbmcnO1xyXG5pbXBvcnQge0RhdGFJbXBvcnRTZXJ2aWNlfSBmcm9tIFwiLi9kYXRhLWltcG9ydC5zZXJ2aWNlXCI7XHJcblxyXG5ASW5qZWN0YWJsZSgpXHJcbmV4cG9ydCBjbGFzcyBEYXRhSW1wb3J0RXhwb3J0U2VydmljZSB7XHJcbiAgZGF0YV9pbXBvcnQ6IHN0cmluZztcclxuICBkYXRhX2V4cG9ydDogc3RyaW5nO1xyXG4gIGRhdGFfZXhwb3J0X2N1c3RvbWZpbGU6IHN0cmluZztcclxuICBleHBvcnRfc3VjY2Vzczogc3RyaW5nO1xyXG4gIGV4cG9ydF9mYWlsOiBzdHJpbmc7XHJcbiAgcnVsZV9saXN0OiBzdHJpbmc7XHJcbiAgLy8yMDIxLjEyLjE35Y+35Yqg55qEXHJcbiAgaTE4blJlc291cmNlOiBhbnk7XHJcblxyXG4gIGNvbnN0cnVjdG9yKFxyXG4gICAgcHJpdmF0ZSBtb2RhbFNlcnZpY2U6IEJzTW9kYWxTZXJ2aWNlLFxyXG4gICAgcHJpdmF0ZSByZXNvbHZlcjogQ29tcG9uZW50RmFjdG9yeVJlc29sdmVyLFxyXG4gICAgcHJpdmF0ZSBpbmplY3RvcjogSW5qZWN0b3IsXHJcbiAgICBwcml2YXRlIGZyYW1lQ29udGV4dDogRnJhbWVDb250ZXh0LFxyXG4gICAgcHJpdmF0ZSBkYXRhRXhwb3J0U2VydmljZTogRGF0YUV4cG9ydFNlcnZpY2UsXHJcbiAgICBwcml2YXRlIG5vdGlmeTogTm90aWZ5U2VydmljZSxcclxuICAgIHByaXZhdGUgZW50aXR5U2VydmljZTogRW50aXR5TGlzdFNlcnZpY2UsXHJcbiAgICBwcml2YXRlIGN1c3RvbUlFU2VydmljZTogQ3VzdG9tRGF0YUlFU2VydmljZSxcclxuICAgIHByaXZhdGUgaGFuZGNyYWZ0U2VyOiBEYXRhaWVIYW5kY3JhZnRTZXJ2aWNlLFxyXG4gICAgcHJpdmF0ZSBodHRwOiBIdHRwQ2xpZW50LFxyXG4gICAgcHJpdmF0ZSBsb2FkaW5nU2VydmljZTogTG9hZGluZ1NlcnZpY2UsXHJcbiAgICBwcml2YXRlIGRhdGFJbXBvcnRTZXJ2aWNlOiBEYXRhSW1wb3J0U2VydmljZVxyXG4gICkge1xyXG4gICAgRGF0YUlFVXRpbHMuZ2V0VHJhbnNsYXRlVmFsdWUoaHR0cCkuc3Vic2NyaWJlKHJlcyA9PiB7XHJcbiAgICAgIHRoaXMuaTE4blJlc291cmNlID0gcmVzO1xyXG4gICAgICB0aGlzLmRhdGFfaW1wb3J0ID0gcmVzWydkYXRhX2ltcG9ydCddO1xyXG4gICAgICB0aGlzLmRhdGFfZXhwb3J0ID0gcmVzWydkYXRhX2V4cG9ydCddO1xyXG4gICAgICB0aGlzLmV4cG9ydF9zdWNjZXNzID0gcmVzWydleHBvcnRfc3VjY2VzcyddO1xyXG4gICAgICB0aGlzLmV4cG9ydF9mYWlsID0gcmVzWydleHBvcnRfZmFpbCddO1xyXG4gICAgICB0aGlzLmRhdGFfZXhwb3J0X2N1c3RvbWZpbGUgPSByZXNbJ2RhdGFfZXhwb3J0X2N1c3RvbWZpbGUnXTtcclxuICAgICAgdGhpcy5ydWxlX2xpc3QgPSByZXNbJ3J1bGVfbGlzdCddO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDmoLnmja7op4TliJnlr7zlh7pcclxuICAgKiBAcGFyYW0gcnVsZUlEXHJcbiAgICogQHBhcmFtIG9wdGlvblxyXG4gICAqL1xyXG4gIHB1YmxpYyBFeHBvcnRCeVJ1bGUocnVsZUlEOiBzdHJpbmcsIG9wdGlvbjogc3RyaW5nKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgIGNvbnN0IHN1YmplY3QgPSBuZXcgU3ViamVjdDxhbnk+KCk7XHJcblxyXG4gICAgY29uc3Qgb3B0aW9uSnNvbiA9IHRoaXMuUGFyc2VFeHBvcnRKc29uKG9wdGlvbik7XHJcbiAgICBpZiAob3B0aW9uSnNvbi5wYWNrU2l6ZSkge1xyXG4gICAgICAvL+iOt+WPluaAu+WFseacieWkmuWwkeadoeaVsOaNrlxyXG4gICAgICBjb25zdCB0b3RhbERhdGEgPSB0aGlzLmZyYW1lQ29udGV4dC5iaW5kaW5nRGF0YS5wYWdpbmdJbmZvLnRvdGFsO1xyXG4gICAgICBpZiAoaXNOdWxsT3JVbmRlZmluZWQodG90YWxEYXRhKSB8fCB0b3RhbERhdGEgPD0gMCkge1xyXG4gICAgICAgIHRoaXMubm90aWZ5Lndhcm5pbmcoJ+acquiOt+WPluWIsOaAu+aVsOaNrumHj+aIluaVsOaNrumHj+S4ujDvvIzml6Dms5Xov5vooYzliIbmibnmiZPljIXlr7zlh7rvvIzor7fmo4Dmn6UnKTtcclxuICAgICAgICBzdWJqZWN0Lm5leHQoZmFsc2UpO1xyXG4gICAgICAgIHN1YmplY3QuY29tcGxldGUoKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBsZXQgZmlsdGVyQ29uZGl0aW9ucyA9IFtdO1xyXG4gICAgICAgIGlmIChvcHRpb25Kc29uLmVuYWJsZVNjcmVlbmluZ1NjaGVtZSA9PT0gdHJ1ZSkge1xyXG4gICAgICAgICAgY29uc3QgZmlsdGVyQ29uZGl0aW9uTGlzdCA9IHRoaXMuZnJhbWVDb250ZXh0LnVpU3RhdGVbJ2ZpbHRlckNvbmRpdGlvbkxpc3QnXTtcclxuICAgICAgICAgIGlmICghaXNOdWxsT3JVbmRlZmluZWQoZmlsdGVyQ29uZGl0aW9uTGlzdCkgJiYgZmlsdGVyQ29uZGl0aW9uTGlzdCAhPT0gJycgJiYgZmlsdGVyQ29uZGl0aW9uTGlzdCAhPT0gJ1tdJykge1xyXG4gICAgICAgICAgICBsZXQgZmlsdGVyQ29uZGl0aW9uTGlzdEpzb24gPSBbXTtcclxuICAgICAgICAgICAgaWYgKHR5cGVvZiAoZmlsdGVyQ29uZGl0aW9uTGlzdCkgPT09ICdzdHJpbmcnKSB7XHJcbiAgICAgICAgICAgICAgZmlsdGVyQ29uZGl0aW9uTGlzdEpzb24gPSBKU09OLnBhcnNlKGZpbHRlckNvbmRpdGlvbkxpc3QpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgIGZpbHRlckNvbmRpdGlvbkxpc3RKc29uID0gZmlsdGVyQ29uZGl0aW9uTGlzdDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4IDwgZmlsdGVyQ29uZGl0aW9uTGlzdEpzb24ubGVuZ3RoOyBpbmRleCsrKSB7XHJcbiAgICAgICAgICAgICAgY29uc3QgZWxlbWVudCA9IGZpbHRlckNvbmRpdGlvbkxpc3RKc29uW2luZGV4XTtcclxuICAgICAgICAgICAgICBlbGVtZW50LlZhbHVlID0gZGVjb2RlVVJJQ29tcG9uZW50KGVsZW1lbnQuVmFsdWUpO1xyXG4gICAgICAgICAgICAgIGlmIChpbmRleCA9PT0gZmlsdGVyQ29uZGl0aW9uTGlzdEpzb24ubGVuZ3RoIC0gMSkge1xyXG4gICAgICAgICAgICAgICAgZWxlbWVudC5SZWxhdGlvbiA9IDA7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIGZpbHRlckNvbmRpdGlvbnMucHVzaChlbGVtZW50KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICAvL+WIhumhteWkp+Wwj++8jOWvueW6lOeahOavj+S4qkV4Y2Vs5paH5Lu255qE5pWw5o2u6YePXHJcbiAgICAgICAgY29uc3QgcGFnZVNpemUgPSBOdW1iZXIucGFyc2VJbnQob3B0aW9uSnNvbi5wYWNrU2l6ZSk7XHJcbiAgICAgICAgY29uc3QgbnVtID0gTWF0aC5jZWlsKHRvdGFsRGF0YSAvIHBhZ2VTaXplKTtcclxuICAgICAgICBjb25zdCBwYWNraXRlbXMgPSBbXTtcclxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bTsgaSsrKSB7XHJcbiAgICAgICAgICBjb25zdCBwYWNraXRlbSA9IHtcclxuICAgICAgICAgICAgcnVsZWlkOiBydWxlSUQsXHJcbiAgICAgICAgICAgIGdsb2JhbFBhcmFtOiBvcHRpb25Kc29uLmdsb2JhbFBhcmFtLFxyXG4gICAgICAgICAgICBmaWx0ZXI6IHtcclxuICAgICAgICAgICAgICBmaWx0ZXJDb25kaXRpb25zOiBmaWx0ZXJDb25kaXRpb25zLFxyXG4gICAgICAgICAgICAgIGlzVXNlUGFnaW5hdGlvbjogdHJ1ZSxcclxuICAgICAgICAgICAgICBwYWdpbmF0aW9uOiB7XHJcbiAgICAgICAgICAgICAgICBwYWdlSW5kZXg6IGkgKyAxLFxyXG4gICAgICAgICAgICAgICAgcGFnZVNpemU6IHBhZ2VTaXplXHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9O1xyXG4gICAgICAgICAgcGFja2l0ZW1zLnB1c2gocGFja2l0ZW0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICBsZXQgY3VzdG9tZmlsZW5hbWUgPSAn5omT5YyF5a+85Ye6JyArIG5ldyBEYXRlKCk7XHJcbiAgICAgICAgaWYgKCFpc051bGxPckVtcHR5KG9wdGlvbkpzb24uY3VzdG9tZmlsZW5hbWUpKSB7XHJcbiAgICAgICAgICBjdXN0b21maWxlbmFtZSA9IG9wdGlvbkpzb24uY3VzdG9tZmlsZW5hbWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IG9wdGlvbiA9IHtcclxuICAgICAgICAgIHBhY2thZ2U6XHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICBjdXN0b21maWxlbmFtZTogY3VzdG9tZmlsZW5hbWUsXHJcbiAgICAgICAgICAgICAgcGFja2l0ZW1zOiBwYWNraXRlbXNcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLkV4cG9ydEJ5UGFja2FnZShKU09OLnN0cmluZ2lmeShvcHRpb24pKS5zdWJzY3JpYmUocyA9PiB7XHJcbiAgICAgICAgICBzdWJqZWN0Lm5leHQocyk7XHJcbiAgICAgICAgICBzdWJqZWN0LmNvbXBsZXRlKCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH1cclxuXHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLkV4cG9ydENvbW1vbkVudHJ5KHJ1bGVJRCwgb3B0aW9uLCBNZXRob2RUeXBlLkNvbW1vbkV4cG9ydCkuc3Vic2NyaWJlKHMgPT4ge1xyXG4gICAgICAgIHN1YmplY3QubmV4dChzKTtcclxuICAgICAgICBzdWJqZWN0LmNvbXBsZXRlKCk7XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBzdWJqZWN0O1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5qC55o2u6KeE5YiZ5a+85Ye6XHJcbiAgICogQHBhcmFtIHJ1bGVJRFxyXG4gICAqIEBwYXJhbSBvcHRpb25cclxuICAgKi9cclxuICBwdWJsaWMgRXhwb3J0Q3VycmVudENoaWxkRGF0YShydWxlSUQ6IHN0cmluZywgb3B0aW9uOiBzdHJpbmcpOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgY29uc3Qgc3ViamVjdCA9IG5ldyBTdWJqZWN0PGFueT4oKTtcclxuICAgIHRoaXMuRXhwb3J0Q29tbW9uRW50cnkocnVsZUlELCBvcHRpb24sIE1ldGhvZFR5cGUuRXhwb3J0Q3VycmVudENoaWxkRGF0YSkuc3Vic2NyaWJlKHMgPT4ge1xyXG4gICAgICBzdWJqZWN0Lm5leHQocyk7XHJcbiAgICAgIHN1YmplY3QuY29tcGxldGUoKTtcclxuICAgIH0pO1xyXG4gICAgcmV0dXJuIHN1YmplY3Q7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDlr7zlh7rlvZPliY3liJfooajmlbDmja7vvIjliIbpobXvvIlcclxuICAgKiBAcGFyYW0gcnVsZUlEXHJcbiAgICogQHBhcmFtIG9wdGlvblxyXG4gICAqL1xyXG4gIHB1YmxpYyBFeHBvcnRDdXJyZW50TGlzdERhdGEocnVsZUlEOiBzdHJpbmcsIG9wdGlvbjogc3RyaW5nKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgIGNvbnN0IHN1YmplY3QgPSBuZXcgU3ViamVjdDxhbnk+KCk7XHJcbiAgICB0aGlzLkV4cG9ydENvbW1vbkVudHJ5KHJ1bGVJRCwgb3B0aW9uLCBNZXRob2RUeXBlLkV4cG9ydEN1cnJlbnRUYWJsZURhdGEpLnN1YnNjcmliZShzID0+IHtcclxuICAgICAgc3ViamVjdC5uZXh0KHMpO1xyXG4gICAgICBzdWJqZWN0LmNvbXBsZXRlKCk7XHJcbiAgICB9KTtcclxuICAgIHJldHVybiBzdWJqZWN0O1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5om56YeP5omT5YyF5a+85Ye6XHJcbiAgICogQHBhcmFtIG9wdGlvbiDphY3nva7miZPljIXkv6Hmga9cclxuICAgKi9cclxuICBwdWJsaWMgRXhwb3J0QnlQYWNrYWdlKG9wdGlvbjogc3RyaW5nKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgIGNvbnNvbGUubG9nKG9wdGlvbik7XHJcbiAgICBjb25zdCBzdWJqZWN0ID0gbmV3IFN1YmplY3Q8Qm9vbGVhbj4oKTtcclxuICAgIGNvbnN0IG9wdGlvbkpzb24gPSB0aGlzLlBhcnNlRXhwb3J0SnNvbihvcHRpb24pO1xyXG4gICAgdGhpcy5kYXRhRXhwb3J0U2VydmljZS5FeHBvcnRCeVBhY2thZ2UodGhpcy5mcmFtZUNvbnRleHQucmVwb3NpdG9yeSwgb3B0aW9uSnNvbik7XHJcbiAgICBjb25zdCB1bnNjcmliZXIgPSB0aGlzLmRhdGFFeHBvcnRTZXJ2aWNlLmV4cG9ydC5zdWJzY3JpYmUoZGF0YSA9PiB7XHJcbiAgICAgIGlmIChkYXRhID09PSAnJykge1xyXG4gICAgICAgIHRoaXMubm90aWZ5LnN1Y2Nlc3ModGhpcy5leHBvcnRfc3VjY2Vzcyk7XHJcbiAgICAgICAgdW5zY3JpYmVyLnVuc3Vic2NyaWJlKCk7XHJcbiAgICAgICAgc3ViamVjdC5uZXh0KHRydWUpO1xyXG4gICAgICAgIHN1YmplY3QuY29tcGxldGUoKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBjb25zdCBlcnJvcmxldmVsID0gdGhpcy5kYXRhRXhwb3J0U2VydmljZS5lcnJvcmxldmVsO1xyXG4gICAgICAgIGlmIChlcnJvcmxldmVsID09PSAnSW5mbycpIHtcclxuICAgICAgICAgIHRoaXMubm90aWZ5LmluZm8oZGF0YSk7XHJcbiAgICAgICAgfSBlbHNlIGlmIChlcnJvcmxldmVsID09PSAnV2FybmluZycpIHtcclxuICAgICAgICAgIHRoaXMubm90aWZ5Lndhcm5pbmcoZGF0YSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHRoaXMubm90aWZ5LmVycm9yKHRoaXMuZXhwb3J0X2ZhaWwgKyBkYXRhKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdW5zY3JpYmVyLnVuc3Vic2NyaWJlKCk7XHJcbiAgICAgICAgc3ViamVjdC5uZXh0KGZhbHNlKTtcclxuICAgICAgICBzdWJqZWN0LmNvbXBsZXRlKCk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgcmV0dXJuIHN1YmplY3Q7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIEV4cG9ydENvbW1vbkVudHJ5KHJ1bGVJRDogc3RyaW5nLCBvcHRpb246IHN0cmluZywgbWV0aG9kVHlwZTogTWV0aG9kVHlwZSk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICBjb25zdCBzdWJqZWN0ID0gbmV3IFN1YmplY3Q8YW55PigpO1xyXG4gICAgY29uc29sZS5sb2cob3B0aW9uKTtcclxuICAgIGNvbnN0IG9wdGlvbkpzb24gPSB0aGlzLlBhcnNlRXhwb3J0SnNvbihvcHRpb24pO1xyXG4gICAgaWYgKGlzTnVsbE9yRW1wdHkocnVsZUlEKSAmJiBpc051bGxPckVtcHR5KG9wdGlvbkpzb24udm9JZCkpIHtcclxuICAgICAgdGhpcy5ub3RpZnkud2FybmluZyhcIuacqumFjee9ruinhOWImWlk77yM5LiU5peg5rOV6I635Y+W5Yiw6KGo5Y2V5a+55bqU55qEdm9JZO+8jOivt+ajgOafpVwiKTtcclxuICAgICAgcmV0dXJuIHN1YmplY3Q7XHJcbiAgICB9XHJcbiAgICBpZiAobWV0aG9kVHlwZSA9PT0gTWV0aG9kVHlwZS5FeHBvcnRDdXJyZW50Q2hpbGREYXRhKSB7XHJcbiAgICAgIGlmIChpc051bGxPckVtcHR5KHJ1bGVJRCkgJiYgaXNOdWxsT3JFbXB0eShvcHRpb25Kc29uLmV4cG9ydENoaWxkTm9kZUNvZGUpKSB7XHJcbiAgICAgICAgLy/lr7zlh7rlrZDooajlvZPop4TliJlpZOS4uuepuuaXtu+8jOagueaNrnZv5om+6KeE5YiZ77yM5b+F6aG76KaB5rGC5pyJ6YWN572u5a2Q6KGo6IqC54K5XHJcbiAgICAgICAgdGhpcy5ub3RpZnkud2FybmluZyhcIuinhOWImWlk5Li656m65pe277yM5qC55o2uVm/mn6Xmib7op4TliJnvvIzlr7zlh7rlrZDooajlv4XpobvphY3nva7lrZDooajoioLngrlcIik7XHJcbiAgICAgICAgcmV0dXJuIHN1YmplY3Q7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIGlmIChpc051bGxPckVtcHR5KHJ1bGVJRCkgfHwgb3B0aW9uSnNvbi5lbmFibGVSdW50aW1lQ3VzdG9tID09PSB0cnVlIHx8IG9wdGlvbkpzb24uc2VsZWN0ZmlsZXR5cGUgPT09IHRydWUpIHtcclxuICAgICAgY29uc3QgYmVmUmVzdFNlcnZpY2UgPSBEYXRhSUVVdGlscy5HZXRCZWZSZXN0U2VydmljZSh0aGlzLmZyYW1lQ29udGV4dC5yZXBvc2l0b3J5KTtcclxuICAgICAgdGhpcy5TdGFydExvYWRpbmcoKTtcclxuICAgICAgY29uc3QgdXJsID0gJy9hcGkvcnVudGltZS9kaXAvdjEuMC9kYXRhSWVSdWxlTWFuYWdlL2dldFJlY29yZFJ1bGVJbmZvJztcclxuICAgICAgY29uc3QgcG9zdEJvZHkgPSB7XHJcbiAgICAgICAgYm9keToge1xyXG4gICAgICAgICAgcnVsZUlkOiBydWxlSUQsXHJcbiAgICAgICAgICBydWxlVHlwZTogMSxcclxuICAgICAgICAgIHZvSWQ6IG9wdGlvbkpzb24udm9JZCxcclxuICAgICAgICAgIG1ldGhvZFR5cGU6IG1ldGhvZFR5cGUsXHJcbiAgICAgICAgICBleHBvcnRDaGlsZE5vZGVDb2RlOiBvcHRpb25Kc29uLmV4cG9ydENoaWxkTm9kZUNvZGUsXHJcbiAgICAgICAgICBlbmFibGVSdW50aW1lQ3VzdG9tOiBvcHRpb25Kc29uLmVuYWJsZVJ1bnRpbWVDdXN0b20gPT09IHRydWVcclxuICAgICAgICB9XHJcbiAgICAgIH07XHJcbiAgICAgIGxldCBzdWJzY3JpYmVyOiBPYnNlcnZhYmxlPGFueT47XHJcbiAgICAgIGlmICghaXNOdWxsT3JVbmRlZmluZWQodGhpcy5odHRwKSkge1xyXG4gICAgICAgIHN1YnNjcmliZXIgPSB0aGlzLmh0dHAucG9zdCh1cmwsIHBvc3RCb2R5LmJvZHkpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHN1YnNjcmliZXIgPSBiZWZSZXN0U2VydmljZS5yZXF1ZXN0KHVybCwgJ3Bvc3QnLCBudWxsLCBwb3N0Qm9keSk7XHJcbiAgICAgIH1cclxuICAgICAgc3Vic2NyaWJlci5zdWJzY3JpYmUocmVjb3JkUnVsZSA9PiB7XHJcbiAgICAgICAgdGhpcy5DbG9zZUxvYWRpbmcoKTtcclxuICAgICAgICB0aGlzLkV4cG9ydEJ5UnVsZUltcGwocnVsZUlELCBvcHRpb25Kc29uLCBtZXRob2RUeXBlLCByZWNvcmRSdWxlKS5zdWJzY3JpYmUocyA9PiB7XHJcbiAgICAgICAgICBzdWJqZWN0Lm5leHQocyk7XHJcbiAgICAgICAgICBzdWJqZWN0LmNvbXBsZXRlKCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH0sIGVycm9yID0+IHtcclxuICAgICAgICB0aGlzLkNsb3NlTG9hZGluZygpO1xyXG4gICAgICAgIHRoaXMubm90aWZ5LmVycm9yKGVycm9yLmVycm9yLk1lc3NhZ2UpO1xyXG4gICAgICAgIGNvbnNvbGUubG9nKGVycm9yLmVycm9yLk1lc3NhZ2UpO1xyXG4gICAgICB9KTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMuRXhwb3J0QnlSdWxlSW1wbChydWxlSUQsIG9wdGlvbkpzb24sIG1ldGhvZFR5cGUpLnN1YnNjcmliZShzID0+IHtcclxuICAgICAgICBzdWJqZWN0Lm5leHQocyk7XHJcbiAgICAgICAgc3ViamVjdC5jb21wbGV0ZSgpO1xyXG4gICAgICB9KTtcclxuICAgIH1cclxuICAgIHJldHVybiBzdWJqZWN0O1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBFeHBvcnRCeVJ1bGVJbXBsKHJ1bGVJRDogc3RyaW5nLCBvcHRpb25Kc29uOiBhbnksIG1UeXBlOiBNZXRob2RUeXBlLCByZWNvcmRSdWxlPzogYW55KSB7XHJcbiAgICBjb25zdCBzdWJqZWN0ID0gbmV3IFN1YmplY3Q8Qm9vbGVhbj4oKTtcclxuICAgIGlmIChvcHRpb25Kc29uLmN1c3RvbUV4cG9ydFRpdGxlICE9PSB1bmRlZmluZWQgJiYgb3B0aW9uSnNvbi5jdXN0b21FeHBvcnRUaXRsZSAhPT0gbnVsbCkge1xyXG4gICAgICBpZiAob3B0aW9uSnNvbi5jdXN0b21FeHBvcnRUaXRsZS5sZW5ndGggPiAyMCkge1xyXG4gICAgICAgIHRoaXMubm90aWZ5Lndhcm5pbmcoJ+iHquWumuS5ieagh+mimOWQjeensOeahOmVv+W6puWkqumVvycpO1xyXG4gICAgICAgIHJldHVybiBzdWJqZWN0O1xyXG4gICAgICB9XHJcbiAgICAgIGlmIChEYXRhSUVVdGlscy5KdWRnZUlsbGVnYWxDaGFyKG9wdGlvbkpzb24uY3VzdG9tRXhwb3J0VGl0bGUpKSB7XHJcbiAgICAgICAgdGhpcy5ub3RpZnkud2FybmluZygn6Ieq5a6a5LmJ5qCH6aKY5ZCN56ew5a2Y5Zyo5LiN5ZCI5rOV5a2X56ymJyk7XHJcbiAgICAgICAgcmV0dXJuIHN1YmplY3Q7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBpZiAob3B0aW9uSnNvbi5hcHBseXVpID09PSB0cnVlKSB7XHJcbiAgICAgIGNvbnN0IGNtcFJlZiA9IHRoaXMuQ3JlYXRlRXhwb3J0Q29tcG9uZW50KCk7XHJcbiAgICAgIGNtcFJlZi5pbnN0YW5jZS5ydWxlSWQgPSBydWxlSUQ7XHJcbiAgICAgIGNtcFJlZi5pbnN0YW5jZS5leHBvcnRPcHRpb24gPSBvcHRpb25Kc29uO1xyXG4gICAgICBjbXBSZWYuaW5zdGFuY2UuZnJhbWVDb250ZXh0ID0gdGhpcy5mcmFtZUNvbnRleHQ7XHJcbiAgICAgIGNtcFJlZi5pbnN0YW5jZS5tZXRob2RUeXBlID0gbVR5cGU7XHJcbiAgICAgIGNtcFJlZi5pbnN0YW5jZS5zdWJqZWN0ID0gc3ViamVjdDtcclxuICAgICAgY21wUmVmLmluc3RhbmNlLnNob3cgPSBvcHRpb25Kc29uLnZzdG87XHJcbiAgICAgIGNtcFJlZi5pbnN0YW5jZS5pc0N1c3RvbUV4cG9ydCA9IGZhbHNlO1xyXG4gICAgICBjb25zdCBleHBvcnRNb2RhbENvbmZpZyA9IHRoaXMuR2V0RXhwb3J0RGlhbG9nQ29uZmlnKGNtcFJlZiwgb3B0aW9uSnNvbik7XHJcbiAgICAgIGNvbnN0IGRpYWxvZyA9IHRoaXMubW9kYWxTZXJ2aWNlLnNob3coY21wUmVmLCBleHBvcnRNb2RhbENvbmZpZyk7XHJcbiAgICAgIGNtcFJlZi5pbnN0YW5jZS5uZWVkRGVzdHJveS5zdWJzY3JpYmUoJGV2ZW50ID0+IHtcclxuICAgICAgICBkaWFsb2cuY2xvc2UoKTtcclxuICAgICAgfSk7XHJcbiAgICB9IGVsc2UgaWYgKG9wdGlvbkpzb24uZW5hYmxlUnVudGltZUN1c3RvbSA9PT0gdHJ1ZSB8fCBvcHRpb25Kc29uLnNlbGVjdGZpbGV0eXBlID09PSB0cnVlKSB7XHJcbiAgICAgIGNvbnN0IGNtcFJlZiA9IHRoaXMuQ3JlYXRlU2VsZWN0RXhwb3J0Q29tcG9uZW50KCk7XHJcbiAgICAgIGNtcFJlZi5pbnN0YW5jZS5ydWxlSWQgPSBydWxlSUQ7XHJcbiAgICAgIGNtcFJlZi5pbnN0YW5jZS5leHBvcnRPcHRpb24gPSBvcHRpb25Kc29uO1xyXG4gICAgICBjbXBSZWYuaW5zdGFuY2UucmVjb3JkUnVsZSA9IHJlY29yZFJ1bGU7XHJcbiAgICAgIGNtcFJlZi5pbnN0YW5jZS5mcmFtZUNvbnRleHQgPSB0aGlzLmZyYW1lQ29udGV4dDtcclxuICAgICAgY21wUmVmLmluc3RhbmNlLm1ldGhvZFR5cGUgPSBtVHlwZTtcclxuICAgICAgY21wUmVmLmluc3RhbmNlLnN1YmplY3QgPSBzdWJqZWN0O1xyXG4gICAgICBjb25zdCBleHBvcnRNb2RhbENvbmZpZyA9IHRoaXMuR2V0U2VsZWN0RXhwb3J0RGlhbG9nQ29uZmlnKGNtcFJlZiwgb3B0aW9uSnNvbik7XHJcbiAgICAgIGNvbnN0IGRpYWxvZyA9IHRoaXMubW9kYWxTZXJ2aWNlLnNob3coY21wUmVmLCBleHBvcnRNb2RhbENvbmZpZyk7XHJcbiAgICAgIGNtcFJlZi5pbnN0YW5jZS5uZWVkRGVzdHJveS5zdWJzY3JpYmUoJGV2ZW50ID0+IHtcclxuICAgICAgICBkaWFsb2cuY2xvc2UoKTtcclxuICAgICAgfSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBpZiAoIWlzTnVsbE9yVW5kZWZpbmVkKHJlY29yZFJ1bGUpICYmICFpc051bGxPckVtcHR5KHJlY29yZFJ1bGUucnVsZUlkKSkge1xyXG4gICAgICAgIHJ1bGVJRCA9IHJlY29yZFJ1bGUucnVsZUlkO1xyXG4gICAgICB9XHJcbiAgICAgIGlmIChtVHlwZSA9PSBNZXRob2RUeXBlLkNvbW1vbkV4cG9ydCkge1xyXG4gICAgICAgIHRoaXMuZGF0YUV4cG9ydFNlcnZpY2UuRXhwb3J0QnlJZChydWxlSUQsIHRoaXMuZnJhbWVDb250ZXh0LCBvcHRpb25Kc29uKTtcclxuICAgICAgfSBlbHNlIGlmIChtVHlwZSA9PSBNZXRob2RUeXBlLkV4cG9ydEN1cnJlbnRUYWJsZURhdGEpIHtcclxuICAgICAgICB0aGlzLmRhdGFFeHBvcnRTZXJ2aWNlLkV4cG9ydEN1cnJlbnREYXRhKHJ1bGVJRCwgdGhpcy5mcmFtZUNvbnRleHQsIHRoaXMuZW50aXR5U2VydmljZS5wYWdlSW5kZXgsXHJcbiAgICAgICAgICB0aGlzLmVudGl0eVNlcnZpY2UucGFnZVNpemUsIG9wdGlvbkpzb24pO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHRoaXMuZGF0YUV4cG9ydFNlcnZpY2UuRXhwb3J0Q3VycmVudENoaWxkRGF0YShydWxlSUQsIHRoaXMuZnJhbWVDb250ZXh0LCBvcHRpb25Kc29uKTtcclxuICAgICAgfVxyXG4gICAgICBjb25zdCB1bnNjcmliZXIgPSB0aGlzLmRhdGFFeHBvcnRTZXJ2aWNlLmV4cG9ydC5zdWJzY3JpYmUoZGF0YSA9PiB7XHJcbiAgICAgICAgaWYgKGRhdGEgPT09ICcnKSB7XHJcbiAgICAgICAgICAvLyDmnInkurrpnIDmsYLlr7zlh7rljrvmjonmiJDlip/mj5DnpLrvvIzlm6DkuLrmlofku7bov5jmsqHkuIvovb3kuIvmnaXmj5DnpLrmj5DliY3kuoZcclxuICAgICAgICAgIGlmIChvcHRpb25Kc29uLmNhbmNlbG5vdGlmeSA9PT0gdW5kZWZpbmVkIHx8IG9wdGlvbkpzb24uY2FuY2Vsbm90aWZ5ID09PSBudWxsIHx8IG9wdGlvbkpzb24uY2FuY2Vsbm90aWZ5ID09PSBmYWxzZSkge1xyXG4gICAgICAgICAgICB0aGlzLm5vdGlmeS5zdWNjZXNzKHRoaXMuZXhwb3J0X3N1Y2Nlc3MpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgc3ViamVjdC5uZXh0KHRydWUpO1xyXG4gICAgICAgICAgc3ViamVjdC5jb21wbGV0ZSgpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICBjb25zdCBlcnJvcmxldmVsID0gdGhpcy5kYXRhRXhwb3J0U2VydmljZS5lcnJvcmxldmVsO1xyXG4gICAgICAgICAgaWYgKGVycm9ybGV2ZWwgPT09ICdJbmZvJykge1xyXG4gICAgICAgICAgICB0aGlzLm5vdGlmeS5pbmZvKGRhdGEpO1xyXG4gICAgICAgICAgfSBlbHNlIGlmIChlcnJvcmxldmVsID09PSAnV2FybmluZycpIHtcclxuICAgICAgICAgICAgdGhpcy5ub3RpZnkud2FybmluZyhkYXRhKTtcclxuICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMubm90aWZ5LmVycm9yKHRoaXMuZXhwb3J0X2ZhaWwgKyBkYXRhKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIHN1YmplY3QubmV4dChmYWxzZSk7XHJcbiAgICAgICAgICBzdWJqZWN0LmNvbXBsZXRlKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHVuc2NyaWJlci51bnN1YnNjcmliZSgpO1xyXG4gICAgICB9LCBlcnJvciA9PiB7XHJcbiAgICAgICAgdGhpcy5ub3RpZnkuZXJyb3IoZXJyb3IuZXJyb3IuTWVzc2FnZSk7XHJcbiAgICAgICAgc3ViamVjdC5uZXh0KGZhbHNlKTtcclxuICAgICAgICBzdWJqZWN0LmNvbXBsZXRlKCk7XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHN1YmplY3Q7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDpgJrnlKjlr7zlhaXmlrnms5VcclxuICAgKiBAcGFyYW0gdHlwZVxyXG4gICAqIEBwYXJhbSBydWxlSURcclxuICAgKiBAcGFyYW0gb3B0aW9uXHJcbiAgICovXHJcbiAgcHVibGljIENvbW1vbkRhdGFJbXBvcnQodHlwZTogYW55LCBydWxlSUQ6IHN0cmluZywgb3B0aW9uOiBzdHJpbmcpOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgLy8gaWYgKHR5cGUgIT09IDIgJiYgKHJ1bGVJRCA9PT0gdW5kZWZpbmVkIHx8IHJ1bGVJRCA9PT0gbnVsbCB8fCBydWxlSUQgPT09ICcnKSkge1xyXG4gICAgLy8gICAgIHRoaXMubm90aWZ5LmVycm9yKCfor7flnKjooajljZXlr7zlhaXlkb3ku6TliqjkvZzlpITphY3nva7lr7zlhaXop4TliJlJRCcpO1xyXG4gICAgLy8gICAgIHJldHVybjtcclxuICAgIC8vIH1cclxuICAgIGlmICh0eXBlID09PSAxKSB7XHJcbiAgICAgIGNvbnNvbGUubG9nKCfmiafooYzmlrnms5XvvJpJbXBvcnRTdWJsaXN0RGF0YScpO1xyXG4gICAgICByZXR1cm4gdGhpcy5JbXBvcnRTdWJsaXN0RGF0YShydWxlSUQsIG9wdGlvbik7XHJcbiAgICB9IGVsc2UgaWYgKHR5cGUgPT09IDIpIHtcclxuICAgICAgY29uc29sZS5sb2coJ+aJp+ihjOaWueazle+8mkltcG9ydEJ5TW9kZWwnKTtcclxuICAgICAgcmV0dXJuIHRoaXMuSW1wb3J0QnlNb2RlbChvcHRpb24pO1xyXG4gICAgfSBlbHNlIGlmICh0eXBlID09PSAwKSB7XHJcbiAgICAgIGNvbnNvbGUubG9nKCfmiafooYzmlrnms5XvvJpJbXBvcnRCeVJ1bGUnKTtcclxuICAgICAgcmV0dXJuIHRoaXMuSW1wb3J0QnlSdWxlKHJ1bGVJRCwgb3B0aW9uKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGNvbnNvbGUubG9nKCfmiafooYzmlrnms5XvvJpJbXBvcnRCeVJ1bGUnKTtcclxuICAgICAgcmV0dXJuIHRoaXMuSW1wb3J0QnlSdWxlKHJ1bGVJRCwgb3B0aW9uKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOWNoeeJh+ihqOWNleaVsOaNruWvvOWFpe+8iOS4u+S7juihqO+8jOWtkOihqO+8jOe7n+S4gOWPquWvvOWFpeWIsOihqOWNle+8iVxyXG4gICAqIEBwYXJhbSBkYXRhSWRcclxuICAgKiBAcGFyYW0gcnVsZUlEXHJcbiAgICogQHBhcmFtIG9wdGlvblxyXG4gICAqL1xyXG4gIHB1YmxpYyBDYXJkRGF0YUltcG9ydChkYXRhSWQ6IHN0cmluZywgcnVsZUlEOiBzdHJpbmcsIG9wdGlvbjogc3RyaW5nKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgIGNvbnN0IHN1YmplY3QgPSBuZXcgU3ViamVjdDxhbnk+KCk7XHJcbiAgICBjb25zb2xlLmxvZyhkYXRhSWQpO1xyXG4gICAgaWYoIWRhdGFJZCl7XHJcbiAgICAgIHRoaXMubm90aWZ5Lndhcm5pbmcoJ+acquivu+WPluWIsOS4u+ihqOaVsOaNrmlk77yM5LiN5YWB6K645a+85YWlJyk7XHJcbiAgICAgIHN1YmplY3QubmV4dChmYWxzZSk7XHJcbiAgICAgIHJldHVybiBzdWJqZWN0O1xyXG4gICAgfVxyXG4gICAgY29uc3Qgb3B0aW9uSnNvbiA9IHRoaXMuUGFyc2VJbXBvcnRKc29uKG9wdGlvbik7XHJcbiAgICBvcHRpb25Kc29uWydtYWluT2JqSWQnXSA9IGRhdGFJZDtcclxuICAgIHRoaXMuZnJhbWVDb250ZXh0LnJlcG9zaXRvcnkudXBkYXRlQWxsQ2hhbmdlcygpLnN1YnNjcmliZShlPT57XHJcbiAgICAgIHRoaXMuSW1wb3J0Q29tbW9uRW50cnkocnVsZUlELCBKU09OLnN0cmluZ2lmeShvcHRpb25Kc29uKSwgTWV0aG9kVHlwZS5DYXJkRm9ybURhdGFJbXBvcnQpLnN1YnNjcmliZShzID0+IHtcclxuICAgICAgICBzdWJqZWN0Lm5leHQocyk7XHJcbiAgICAgICAgc3ViamVjdC5jb21wbGV0ZSgpO1xyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIHJldHVybiBzdWJqZWN0O1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog6YCa55So5a+85Ye65pa55rOVXHJcbiAgICogQHBhcmFtIHR5cGVcclxuICAgKiBAcGFyYW0gcnVsZUlEXHJcbiAgICogQHBhcmFtIG9wdGlvblxyXG4gICAqL1xyXG4gIHB1YmxpYyBDb21tb25EYXRhRXhwb3J0KHR5cGU6IGFueSwgcnVsZUlEOiBzdHJpbmcsIG9wdGlvbjogc3RyaW5nKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgIC8vIGlmICh0eXBlICE9PSAyICYmIChydWxlSUQgPT09IHVuZGVmaW5lZCB8fCBydWxlSUQgPT09IG51bGwgfHwgcnVsZUlEID09PSAnJykpIHtcclxuICAgIC8vICAgICB0aGlzLm5vdGlmeS5lcnJvcign6K+35Zyo6KGo5Y2V5a+85Ye65ZG95Luk5Yqo5L2c5aSE6YWN572u5a+85Ye66KeE5YiZSUQnKTtcclxuICAgIC8vICAgICByZXR1cm47XHJcbiAgICAvLyB9XHJcbiAgICBpZiAodHlwZSA9PT0gMSkge1xyXG4gICAgICBjb25zb2xlLmxvZygn5omn6KGM5pa55rOV77yaRXhwb3J0Q3VycmVudExpc3REYXRhJyk7XHJcbiAgICAgIC8vIGNvbnN0IHBhZ2VJbmZvID0gbmV3IFBhZ2VJbmZvKCk7XHJcbiAgICAgIC8vIHBhZ2VJbmZvLnBhZ2VJbmRleCA9IHRoaXMuZW50aXR5U2VydmljZS5wYWdlSW5kZXg7XHJcbiAgICAgIC8vIHBhZ2VJbmZvLnBhZ2VTaXplID0gdGhpcy5lbnRpdHlTZXJ2aWNlLnBhZ2VTaXplO1xyXG4gICAgICByZXR1cm4gdGhpcy5FeHBvcnRDdXJyZW50TGlzdERhdGEocnVsZUlELCBvcHRpb24pO1xyXG4gICAgfSBlbHNlIGlmICh0eXBlID09PSAyKSB7XHJcbiAgICAgIGNvbnNvbGUubG9nKCfmiafooYzmlrnms5XvvJpFeHBvcnRCeU1vZGVsJyk7XHJcbiAgICAgIHJldHVybiB0aGlzLkV4cG9ydEJ5TW9kZWwob3B0aW9uKTtcclxuICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gMykge1xyXG4gICAgICBjb25zb2xlLmxvZygn5omn6KGM5pa55rOV77yaRXhwb3J0Q3VycmVudENoaWxkRGF0YScpO1xyXG4gICAgICByZXR1cm4gdGhpcy5FeHBvcnRDdXJyZW50Q2hpbGREYXRhKHJ1bGVJRCwgb3B0aW9uKTtcclxuICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gMCkge1xyXG4gICAgICBjb25zb2xlLmxvZygn5omn6KGM5pa55rOV77yaRXhwb3J0QnlSdWxlJyk7XHJcbiAgICAgIHJldHVybiB0aGlzLkV4cG9ydEJ5UnVsZShydWxlSUQsIG9wdGlvbik7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBjb25zb2xlLmxvZygn5omn6KGM5pa55rOV77yaRXhwb3J0QnlSdWxlJyk7XHJcbiAgICAgIHJldHVybiB0aGlzLkV4cG9ydEJ5UnVsZShydWxlSUQsIG9wdGlvbik7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIFBhcnNlRXhwb3J0SnNvbihvcHRpb246IHN0cmluZyk6IGFueSB7XHJcbiAgICBjb25zdCB2b0lkID0gdGhpcy5mcmFtZUNvbnRleHQuYXBwQ29udGV4dC5mb3JtSWQ7XHJcbiAgICBpZiAoaXNOdWxsT3JVbmRlZmluZWQob3B0aW9uKSB8fCBpc051bGxPckVtcHR5KG9wdGlvbikpIHtcclxuICAgICAgcmV0dXJuIHtmaWx0ZXI6IG51bGwsIHZvSWQ6IHZvSWQsIGN1c3RvbWZpbGVuYW1lOiAnJywgYXBwbHl1aTogZmFsc2UsIHZzdG86IGZhbHNlfTtcclxuICAgIH1cclxuICAgIGxldCBvcHRpb25Kc29uID0gbnVsbDtcclxuICAgIHRyeSB7XHJcbiAgICAgIG9wdGlvbkpzb24gPSBKU09OLnBhcnNlKG9wdGlvbik7XHJcbiAgICB9IGNhdGNoIHtcclxuICAgICAgdGhpcy5ub3RpZnkud2FybmluZygn5Lyg5YWl55qE5Y+C5pWw6L2s5o2iSlNPTuWvueixoeW8guW4uO+8jOW3suS9v+eUqOm7mOiupOWPguaVsCcpO1xyXG4gICAgICByZXR1cm4ge2ZpbHRlcjogbnVsbCwgdm9JZDogdm9JZCwgY3VzdG9tZmlsZW5hbWU6ICcnLCBhcHBseXVpOiBmYWxzZSwgdnN0bzogZmFsc2V9O1xyXG4gICAgfVxyXG4gICAgaWYgKHR5cGVvZiAob3B0aW9uSnNvbikgIT09ICdvYmplY3QnKSB7XHJcbiAgICAgIG9wdGlvbkpzb24gPSB7fTtcclxuICAgIH1cclxuICAgIG9wdGlvbkpzb25bJ3ZvSWQnXSA9IHZvSWQ7XHJcbiAgICByZXR1cm4gb3B0aW9uSnNvbjtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgUGFyc2VJbXBvcnRKc29uKG9wdGlvbjogc3RyaW5nKTogYW55IHtcclxuICAgIGNvbnN0IHZvSWQgPSB0aGlzLmZyYW1lQ29udGV4dC5hcHBDb250ZXh0LmZvcm1JZDtcclxuICAgIGlmIChpc051bGxPclVuZGVmaW5lZChvcHRpb24pIHx8IGlzTnVsbE9yRW1wdHkob3B0aW9uKSkge1xyXG4gICAgICByZXR1cm4ge3RlbXBsYXRlZmlsZW5hbWU6ICcnLCBHbG9iYWxQYXJhbTogJycsIHZvSWQ6IHZvSWR9O1xyXG4gICAgfVxyXG4gICAgbGV0IG9wdGlvbkpzb24gPSBudWxsO1xyXG4gICAgdHJ5IHtcclxuICAgICAgb3B0aW9uSnNvbiA9IEpTT04ucGFyc2Uob3B0aW9uKTtcclxuICAgIH0gY2F0Y2gge1xyXG4gICAgICB0aGlzLm5vdGlmeS53YXJuaW5nKCfkvKDlhaXnmoTlj4LmlbDovazmjaJKU09O5a+56LGh5byC5bi477yM5bey5L2/55So6buY6K6k5Y+C5pWwJyk7XHJcbiAgICAgIHJldHVybiB7dGVtcGxhdGVmaWxlbmFtZTogJycsIEdsb2JhbFBhcmFtOiAnJywgdm9JZDogdm9JZH07XHJcbiAgICB9XHJcbiAgICBpZiAodHlwZW9mIChvcHRpb25Kc29uKSAhPT0gJ29iamVjdCcpIHtcclxuICAgICAgb3B0aW9uSnNvbiA9IHt9O1xyXG4gICAgfVxyXG4gICAgbGV0IGdsb2JhbFBhcmFtID0gb3B0aW9uSnNvblsnZ2xvYmFsUGFyYW0nXTtcclxuICAgIGlmIChnbG9iYWxQYXJhbSAhPT0gdW5kZWZpbmVkICYmIGdsb2JhbFBhcmFtICE9PSBudWxsKSB7XHJcbiAgICAgIG9wdGlvbkpzb25bJ0dsb2JhbFBhcmFtJ10gPSBnbG9iYWxQYXJhbTtcclxuICAgIH1cclxuICAgIG9wdGlvbkpzb25bJ3ZvSWQnXSA9IHZvSWQ7XHJcbiAgICByZXR1cm4gb3B0aW9uSnNvbjtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBFeHBvcnRCeU1vZGVsKG9wdGlvbjogc3RyaW5nKSB7XHJcbiAgICBjb25zdCBzdWJqZWN0ID0gbmV3IFN1YmplY3Q8Qm9vbGVhbj4oKTtcclxuICAgIGNvbnN0IG9wdGlvbkpzb24gPSBKU09OLnBhcnNlKG9wdGlvbik7XHJcbiAgICBjb25zdCBtb2RlbCA9IG9wdGlvbkpzb24uZGF0YUV4Y2hhbmdlTW9kZWw7XHJcbiAgICBjb25zdCBjb21wb25lbnRzID0gW107XHJcbiAgICBpZiAob3B0aW9uSnNvbi5jb21wb25lbnRzICE9PSB1bmRlZmluZWQgJiYgb3B0aW9uSnNvbi5jb21wb25lbnRzICE9PSBudWxsICYmIG9wdGlvbkpzb24uY29tcG9uZW50cy5sZW5ndGggPiAwKSB7XHJcbiAgICAgIG9wdGlvbkpzb24uY29tcG9uZW50cy5mb3JFYWNoKGMgPT5cclxuICAgICAgICBjb21wb25lbnRzLnB1c2goSlNPTi5zdHJpbmdpZnkoYykpKTtcclxuICAgIH1cclxuICAgIGxldCBpMThuSWQgPSAnJztcclxuICAgIGlmIChvcHRpb25Kc29uLkkxOG5NZXRhZGF0YUlEICE9PSB1bmRlZmluZWQgJiYgb3B0aW9uSnNvbi5JMThuTWV0YWRhdGFJRCAhPT0gbnVsbCkge1xyXG4gICAgICBpMThuSWQgPSBvcHRpb25Kc29uLkkxOG5NZXRhZGF0YUlEO1xyXG4gICAgfVxyXG4gICAgbGV0IGZpbHRlciA9IG51bGw7XHJcbiAgICBpZiAob3B0aW9uSnNvbi5maWx0ZXIgIT09IHVuZGVmaW5lZCAmJiBvcHRpb25Kc29uLmZpbHRlciAhPT0gbnVsbCkge1xyXG4gICAgICBmaWx0ZXIgPSBvcHRpb25Kc29uLmZpbHRlcjtcclxuICAgIH1cclxuICAgIGNvbnN0IGNtcFJlZiA9IHRoaXMuQ3JlYXRlRXhwb3J0Q29tcG9uZW50KCk7XHJcbiAgICBjbXBSZWYuaW5zdGFuY2UuZnJhbWVDb250ZXh0ID0gdGhpcy5mcmFtZUNvbnRleHQ7XHJcbiAgICBjbXBSZWYuaW5zdGFuY2UubWV0aG9kVHlwZSA9IE1ldGhvZFR5cGUuQ29tbW9uRXhwb3J0O1xyXG4gICAgY21wUmVmLmluc3RhbmNlLmlzQ3VzdG9tRXhwb3J0ID0gdHJ1ZTtcclxuICAgIGNtcFJlZi5pbnN0YW5jZS5Nb2RlbCA9IG1vZGVsO1xyXG4gICAgY21wUmVmLmluc3RhbmNlLnN1YmplY3QgPSBzdWJqZWN0O1xyXG4gICAgY21wUmVmLmluc3RhbmNlLmNvbXBvbmVudHMgPSBjb21wb25lbnRzO1xyXG4gICAgY21wUmVmLmluc3RhbmNlLmkxOG5JZCA9IGkxOG5JZDtcclxuICAgIGNtcFJlZi5pbnN0YW5jZS5maWx0ZXIgPSBmaWx0ZXI7XHJcbiAgICBjbXBSZWYuaW5zdGFuY2UuZXhwb3J0T3B0aW9uID0gb3B0aW9uSnNvbjtcclxuICAgIGNvbnN0IG1vZGVsU3RyID0gSlNPTi5zdHJpbmdpZnkobW9kZWwpO1xyXG4gICAgY21wUmVmLmluc3RhbmNlLklubmVyTW9kZWwgPSBKU09OLnBhcnNlKG1vZGVsU3RyKTtcclxuICAgIGNvbnN0IGV4cG9ydE1vZGFsQ29uZmlnID0gdGhpcy5HZXRFeHBvcnREaWFsb2dDb25maWcoY21wUmVmLCBvcHRpb25Kc29uKTtcclxuICAgIGNvbnN0IGtleXMgPSBbJ0RhdGFFeHBvcnQnLCBtb2RlbFsnTWFpbk9iamVjdCddWydTb3VyY2UnXVsnU291cmNlTWV0YWRhdGFJRCddLCBvcHRpb25Kc29uLmRpbWVuc2lvbl07XHJcbiAgICB0aGlzLmN1c3RvbUlFU2VydmljZS5HZXRFeHBvcnRSdWxlTW9kZWwoa2V5cywgdGhpcy5mcmFtZUNvbnRleHQucmVwb3NpdG9yeSwgaTE4bklkLCBtb2RlbCkuc3Vic2NyaWJlKFxyXG4gICAgICBkYXRhID0+IHtcclxuICAgICAgICBpZiAoZGF0YVsnc3VjY2VzcyddID09PSB0cnVlKSB7XHJcbiAgICAgICAgICBjbXBSZWYuaW5zdGFuY2UuQ3VzdG9tTW9kZWwgPSBKU09OLnBhcnNlKGRhdGFbJ21vZGVsU3RyJ10pO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoaTE4bklkICE9PSAnJyAmJiBkYXRhWydpMThuTW9kZWwnXSAhPT0gdW5kZWZpbmVkICYmIGRhdGFbJ2kxOG5Nb2RlbCddICE9PSBudWxsKSB7XHJcbiAgICAgICAgICBjb25zdCBpMThuTW9kZWwgPSBKU09OLnBhcnNlKGRhdGFbJ2kxOG5Nb2RlbCddKTtcclxuICAgICAgICAgIGNtcFJlZi5pbnN0YW5jZS5Nb2RlbCA9IGkxOG5Nb2RlbDtcclxuICAgICAgICAgIGNvbnN0IG1vZGVsU3RyID0gSlNPTi5zdHJpbmdpZnkoaTE4bk1vZGVsKTtcclxuICAgICAgICAgIGNtcFJlZi5pbnN0YW5jZS5Jbm5lck1vZGVsID0gSlNPTi5wYXJzZShtb2RlbFN0cik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IGRpYWxvZyA9IHRoaXMubW9kYWxTZXJ2aWNlLnNob3coY21wUmVmLCBleHBvcnRNb2RhbENvbmZpZyk7XHJcbiAgICAgICAgY21wUmVmLmluc3RhbmNlLm5lZWREZXN0cm95LnN1YnNjcmliZSgkZXZlbnQgPT4ge1xyXG4gICAgICAgICAgZGlhbG9nLmNsb3NlKCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH1cclxuICAgICk7XHJcbiAgICByZXR1cm4gc3ViamVjdDtcclxuICAgIC8vIGNvbnN0IGRpYWxvZyA9IHRoaXMubW9kYWxTZXJ2aWNlLnNob3coY21wUmVmLCBleHBvcnRNb2RhbENvbmZpZyk7XHJcbiAgICAvLyBjbXBSZWYuaW5zdGFuY2UubmVlZERlc3Ryb3kuc3Vic2NyaWJlKCRldmVudCA9PiB7IGRpYWxvZy5jbG9zZSgpOyB9KTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBJbXBvcnRCeU1vZGVsKG9wdGlvbjogc3RyaW5nKSB7XHJcbiAgICBjb25zdCBvcHRpb25Kc29uID0gSlNPTi5wYXJzZShvcHRpb24pO1xyXG4gICAgY29uc3QgbW9kZWwgPSBvcHRpb25Kc29uLmRhdGFFeGNoYW5nZU1vZGVsO1xyXG4gICAgY29uc3Qgc3ViamVjdCA9IG5ldyBTdWJqZWN0PEJvb2xlYW4+KCk7XHJcbiAgICBjb25zdCBjb21wb25lbnRzID0gW107XHJcbiAgICBpZiAob3B0aW9uSnNvbi5jb21wb25lbnRzICE9PSB1bmRlZmluZWQgJiYgb3B0aW9uSnNvbi5jb21wb25lbnRzICE9PSBudWxsICYmIG9wdGlvbkpzb24uY29tcG9uZW50cy5sZW5ndGggPiAwKSB7XHJcbiAgICAgIG9wdGlvbkpzb24uY29tcG9uZW50cy5mb3JFYWNoKGMgPT5cclxuICAgICAgICBjb21wb25lbnRzLnB1c2goSlNPTi5zdHJpbmdpZnkoYykpKTtcclxuICAgIH1cclxuICAgIGxldCBpMThuSWQgPSAnJztcclxuICAgIGlmIChvcHRpb25Kc29uLkkxOG5NZXRhZGF0YUlEICE9PSB1bmRlZmluZWQgJiYgb3B0aW9uSnNvbi5JMThuTWV0YWRhdGFJRCAhPT0gbnVsbCkge1xyXG4gICAgICBpMThuSWQgPSBvcHRpb25Kc29uLkkxOG5NZXRhZGF0YUlEO1xyXG4gICAgfVxyXG4gICAgaWYgKG9wdGlvbkpzb24uY3VzdG9tSW1wb3J0VGl0bGUgIT09IHVuZGVmaW5lZCAmJiBvcHRpb25Kc29uLmN1c3RvbUltcG9ydFRpdGxlICE9PSBudWxsKSB7XHJcbiAgICAgIGlmIChvcHRpb25Kc29uLmN1c3RvbUltcG9ydFRpdGxlLmxlbmd0aCA+IDIwKSB7XHJcbiAgICAgICAgdGhpcy5ub3RpZnkud2FybmluZygn6Ieq5a6a5LmJ5qCH6aKY5ZCN56ew55qE6ZW/5bqm5aSq6ZW/Jyk7XHJcbiAgICAgICAgcmV0dXJuIHN1YmplY3Q7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKERhdGFJRVV0aWxzLkp1ZGdlSWxsZWdhbENoYXIob3B0aW9uSnNvbi5jdXN0b21JbXBvcnRUaXRsZSkpIHtcclxuICAgICAgICB0aGlzLm5vdGlmeS53YXJuaW5nKCfoh6rlrprkuYnmoIfpopjlkI3np7DlrZjlnKjkuI3lkIjms5XlrZfnrKYnKTtcclxuICAgICAgICByZXR1cm4gc3ViamVjdDtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgY29uc3QgY21wUmVmID0gdGhpcy5DcmVhdGVDdXN0b21JbXBvcnRDb21wb25lbnQoKTtcclxuICAgIGNtcFJlZi5pbnN0YW5jZS5mcmFtZUNvbnRleHQgPSB0aGlzLmZyYW1lQ29udGV4dDtcclxuICAgIGNtcFJlZi5pbnN0YW5jZS5pbXBvcnRPcHRpb24gPSBvcHRpb25Kc29uO1xyXG4gICAgLy8gY21wUmVmLmluc3RhbmNlLm1ldGhvZFR5cGUgPSBNZXRob2RUeXBlLkltcG9ydFN1YlRhYmxlRGV0YWlsO1xyXG4gICAgY21wUmVmLmluc3RhbmNlLnN1YmplY3QgPSBzdWJqZWN0O1xyXG4gICAgY21wUmVmLmluc3RhbmNlLmkxOG5JZCA9IGkxOG5JZDtcclxuICAgIGNtcFJlZi5pbnN0YW5jZS5Nb2RlbCA9IG1vZGVsO1xyXG4gICAgY29uc3QgbW9kZWxTdHIgPSBKU09OLnN0cmluZ2lmeShtb2RlbCk7XHJcbiAgICBjbXBSZWYuaW5zdGFuY2UuSW5uZXJNb2RlbCA9IEpTT04ucGFyc2UobW9kZWxTdHIpO1xyXG4gICAgY21wUmVmLmluc3RhbmNlLmNvbXBvbmVudHMgPSBjb21wb25lbnRzO1xyXG4gICAgY29uc3QgaW1wb3J0TW9kYWxDb25maWcgPSB0aGlzLkdldEN1c3RvbUltcG9ydERpYWxvZ0NvbmZpZyhjbXBSZWYsIG9wdGlvbkpzb24pO1xyXG4gICAgY29uc3Qga2V5cyA9IFsnRGF0YUltcG9ydCcsIG1vZGVsWydNYWluT2JqZWN0J11bJ1NvdXJjZSddWydTb3VyY2VNZXRhZGF0YUlEJ10sIG9wdGlvbkpzb24uZGltZW5zaW9uXTtcclxuICAgIHRoaXMuY3VzdG9tSUVTZXJ2aWNlLkdldEltcG9ydFJ1bGVNb2RlbChrZXlzLCB0aGlzLmZyYW1lQ29udGV4dC5yZXBvc2l0b3J5LCBpMThuSWQsIG1vZGVsKS5zdWJzY3JpYmUoXHJcbiAgICAgIGRhdGEgPT4ge1xyXG4gICAgICAgIGlmIChkYXRhWydzdWNjZXNzJ10gPT09IHRydWUpIHtcclxuICAgICAgICAgIGNtcFJlZi5pbnN0YW5jZS5DdXN0b21Nb2RlbCA9IEpTT04ucGFyc2UoZGF0YVsnbW9kZWxTdHInXSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChpMThuSWQgIT09ICcnICYmIGRhdGFbJ2kxOG5Nb2RlbCddICE9PSB1bmRlZmluZWQgJiYgZGF0YVsnaTE4bk1vZGVsJ10gIT09IG51bGwpIHtcclxuICAgICAgICAgIGNvbnN0IGkxOG5Nb2RlbCA9IEpTT04ucGFyc2UoZGF0YVsnaTE4bk1vZGVsJ10pO1xyXG4gICAgICAgICAgY21wUmVmLmluc3RhbmNlLk1vZGVsID0gaTE4bk1vZGVsO1xyXG4gICAgICAgICAgY29uc3QgbW9kZWxTdHIgPSBKU09OLnN0cmluZ2lmeShpMThuTW9kZWwpO1xyXG4gICAgICAgICAgY21wUmVmLmluc3RhbmNlLklubmVyTW9kZWwgPSBKU09OLnBhcnNlKG1vZGVsU3RyKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc3QgZGlhbG9nID0gdGhpcy5tb2RhbFNlcnZpY2Uuc2hvdyhjbXBSZWYsIGltcG9ydE1vZGFsQ29uZmlnKTtcclxuICAgICAgICBjbXBSZWYuaW5zdGFuY2UubmVlZERlc3Ryb3kuc3Vic2NyaWJlKCRldmVudCA9PiB7XHJcbiAgICAgICAgICBkaWFsb2cuY2xvc2UoKTtcclxuICAgICAgICB9KTtcclxuICAgICAgfVxyXG4gICAgKVxyXG4gICAgcmV0dXJuIHN1YmplY3Q7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDkuIvovb3lr7zlhaXmqKHmnb9cclxuICAgKiBAcGFyYW0gcnVsZUlEXHJcbiAgICogQHBhcmFtIG9wdGlvblxyXG4gICAqL1xyXG4gIHB1YmxpYyBEb3dubG9hZFRlbXBsYXRlKHJ1bGVJRDogc3RyaW5nLCBvcHRpb246IHN0cmluZyk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICBjb25zdCBzdWJqZWN0ID0gbmV3IFN1YmplY3Q8YW55PigpO1xyXG4gICAgdGhpcy5JbXBvcnRDb21tb25FbnRyeShydWxlSUQsIG9wdGlvbiwgTWV0aG9kVHlwZS5Eb3dubG9hZEltcG9ydFRlbXBsYXRlKS5zdWJzY3JpYmUocyA9PiB7XHJcbiAgICAgIHN1YmplY3QubmV4dChzKTtcclxuICAgICAgc3ViamVjdC5jb21wbGV0ZSgpO1xyXG4gICAgfSk7XHJcbiAgICByZXR1cm4gc3ViamVjdDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOagueaNruinhOWImeWvvOWFpVxyXG4gICAqIEBwYXJhbSBydWxlSURcclxuICAgKiBAcGFyYW0gb3B0aW9uXHJcbiAgICovXHJcbiAgcHVibGljIEltcG9ydEJ5UnVsZShydWxlSUQ6IHN0cmluZywgb3B0aW9uOiBzdHJpbmcpOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgY29uc3Qgc3ViamVjdCA9IG5ldyBTdWJqZWN0PGFueT4oKTtcclxuICAgIHRoaXMuSW1wb3J0Q29tbW9uRW50cnkocnVsZUlELCBvcHRpb24sIE1ldGhvZFR5cGUuQ29tbW9uSW1wb3J0KS5zdWJzY3JpYmUocyA9PiB7XHJcbiAgICAgIHN1YmplY3QubmV4dChzKTtcclxuICAgICAgc3ViamVjdC5jb21wbGV0ZSgpO1xyXG4gICAgfSk7XHJcbiAgICByZXR1cm4gc3ViamVjdDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOWvvOWFpeWtkOihqOaVsOaNrlxyXG4gICAqIEBwYXJhbSBydWxlSURcclxuICAgKiBAcGFyYW0gb3B0aW9uXHJcbiAgICovXHJcbiAgcHVibGljIEltcG9ydFN1Ymxpc3REYXRhKHJ1bGVJRDogc3RyaW5nLCBvcHRpb246IHN0cmluZyk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICBjb25zdCBzdWJqZWN0ID0gbmV3IFN1YmplY3Q8YW55PigpO1xyXG4gICAgdGhpcy5JbXBvcnRDb21tb25FbnRyeShydWxlSUQsIG9wdGlvbiwgTWV0aG9kVHlwZS5JbXBvcnRTdWJUYWJsZURldGFpbCkuc3Vic2NyaWJlKHMgPT4ge1xyXG4gICAgICBzdWJqZWN0Lm5leHQocyk7XHJcbiAgICAgIHN1YmplY3QuY29tcGxldGUoKTtcclxuICAgIH0pO1xyXG4gICAgcmV0dXJuIHN1YmplY3Q7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIEltcG9ydENvbW1vbkVudHJ5KHJ1bGVJRDogc3RyaW5nLCBvcHRpb246IHN0cmluZywgbWV0aG9kVHlwZTogTWV0aG9kVHlwZSkge1xyXG4gICAgY29uc29sZS5sb2cob3B0aW9uKTtcclxuICAgIGNvbnN0IHN1YmplY3QgPSBuZXcgU3ViamVjdDxhbnk+KCk7XHJcbiAgICBjb25zdCBiZWZSZXN0U2VydmljZSA9IERhdGFJRVV0aWxzLkdldEJlZlJlc3RTZXJ2aWNlKHRoaXMuZnJhbWVDb250ZXh0LnJlcG9zaXRvcnkpO1xyXG4gICAgY29uc3Qgc3UgPSBEYXRhSUVVdGlscy5nZXRTdShiZWZSZXN0U2VydmljZS5iYXNlVXJpKTtcclxuICAgIGNvbnN0IG9wdGlvbkpzb24gPSB0aGlzLlBhcnNlSW1wb3J0SnNvbihvcHRpb24pO1xyXG4gICAgaWYgKG1ldGhvZFR5cGUgPT09IE1ldGhvZFR5cGUuSW1wb3J0U3ViVGFibGVEZXRhaWwpIHtcclxuICAgICAgaWYgKGlzTnVsbE9yRW1wdHkocnVsZUlEKSAmJiBpc051bGxPckVtcHR5KG9wdGlvbkpzb24uaW1wb3J0Q2hpbGROb2RlQ29kZSkpIHtcclxuICAgICAgICAvL+WvvOWFpeWtkOihqOW9k+inhOWImWlk5Li656m65pe277yM5qC55o2udm/mib7op4TliJnvvIzlv4XpobvopoHmsYLmnInphY3nva7lrZDooajoioLngrlcclxuICAgICAgICB0aGlzLm5vdGlmeS53YXJuaW5nKFwi6KeE5YiZaWTkuLrnqbrml7bvvIzmoLnmja5Wb+afpeaJvuinhOWIme+8jOWvvOWFpeWtkOihqOW/hemhu+mFjee9ruWtkOihqOiKgueCuVwiKTtcclxuICAgICAgICByZXR1cm4gc3ViamVjdDtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgdGhpcy5TdGFydExvYWRpbmcoKTtcclxuICAgIGNvbnN0IHVybCA9ICcvYXBpL3J1bnRpbWUvZGlwL3YxLjAvZGF0YUllUnVsZU1hbmFnZS9nZXRSZWNvcmRSdWxlSW5mbyc7XHJcbiAgICBjb25zdCBwb3N0Qm9keSA9IHtcclxuICAgICAgYm9keToge1xyXG4gICAgICAgIHJ1bGVJZDogcnVsZUlELFxyXG4gICAgICAgIHN1OiBzdSxcclxuICAgICAgICBydWxlVHlwZTogMCxcclxuICAgICAgICB2b0lkOiBvcHRpb25Kc29uLnZvSWQsXHJcbiAgICAgICAgbWV0aG9kVHlwZTogbWV0aG9kVHlwZSxcclxuICAgICAgICBpbXBvcnRDaGlsZE5vZGVDb2RlOiBvcHRpb25Kc29uLmltcG9ydENoaWxkTm9kZUNvZGUsXHJcbiAgICAgICAgZW5hYmxlUnVudGltZUN1c3RvbTogb3B0aW9uSnNvbi5lbmFibGVSdW50aW1lQ3VzdG9tID09PSB0cnVlXHJcbiAgICAgIH1cclxuICAgIH07XHJcbiAgICBsZXQgc3Vic2NyaWJlcjogT2JzZXJ2YWJsZTxhbnk+O1xyXG4gICAgaWYgKCFpc051bGxPclVuZGVmaW5lZCh0aGlzLmh0dHApKSB7XHJcbiAgICAgIHN1YnNjcmliZXIgPSB0aGlzLmh0dHAucG9zdCh1cmwsIHBvc3RCb2R5LmJvZHkpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgc3Vic2NyaWJlciA9IGJlZlJlc3RTZXJ2aWNlLnJlcXVlc3QodXJsLCAncG9zdCcsIG51bGwsIHBvc3RCb2R5KTtcclxuICAgIH1cclxuICAgIHN1YnNjcmliZXIuc3Vic2NyaWJlKHJlY29yZFJ1bGUgPT4ge1xyXG4gICAgICB0aGlzLkNsb3NlTG9hZGluZygpO1xyXG4gICAgICB0aGlzLkltcG9ydEJ5UnVsZUltcGwocnVsZUlELCBvcHRpb25Kc29uLCBtZXRob2RUeXBlLCByZWNvcmRSdWxlKS5zdWJzY3JpYmUocyA9PiB7XHJcbiAgICAgICAgc3ViamVjdC5uZXh0KHMpO1xyXG4gICAgICAgIHN1YmplY3QuY29tcGxldGUoKTtcclxuICAgICAgfSk7XHJcbiAgICB9LCBlcnJvciA9PiB7XHJcbiAgICAgIHRoaXMuQ2xvc2VMb2FkaW5nKCk7XHJcbiAgICAgIHRoaXMubm90aWZ5LmVycm9yKGVycm9yLmVycm9yLk1lc3NhZ2UpO1xyXG4gICAgICBjb25zb2xlLmxvZyhlcnJvci5lcnJvci5NZXNzYWdlKTtcclxuICAgIH0pO1xyXG4gICAgcmV0dXJuIHN1YmplY3Q7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIEltcG9ydEJ5UnVsZUltcGwocnVsZUlEOiBzdHJpbmcsIG9wdGlvbkpzb246IGFueSwgbWV0aG9kVHlwZTogTWV0aG9kVHlwZSwgcmVjb3JkUnVsZT86IGFueSkge1xyXG4gICAgY29uc3Qgc3ViamVjdCA9IG5ldyBTdWJqZWN0PEJvb2xlYW4+KCk7XHJcbiAgICBpZihtZXRob2RUeXBlID09PSBNZXRob2RUeXBlLkRvd25sb2FkSW1wb3J0VGVtcGxhdGUpe1xyXG4gICAgICB0aGlzLmxvYWRpbmdTZXJ2aWNlLnNob3coKTtcclxuICAgICAgY29uc3QgcnVsZUlkID0gcmVjb3JkUnVsZS5ydWxlSWQgPyByZWNvcmRSdWxlLnJ1bGVJZCA6IHJ1bGVJRDtcclxuICAgICAgdGhpcy5kYXRhSW1wb3J0U2VydmljZS5Eb3dtbG9hZFRlbXBsYXRlKHJ1bGVJZCwgdGhpcy5mcmFtZUNvbnRleHQucmVwb3NpdG9yeSwgb3B0aW9uSnNvbiwgbnVsbCk7XHJcbiAgICAgIHRoaXMuZGF0YUltcG9ydFNlcnZpY2UuY29tcGxldGUuc3Vic2NyaWJlKGRhdGEgPT4ge1xyXG4gICAgICAgIHRoaXMubG9hZGluZ1NlcnZpY2UuY2xlYXJBbGwoKTtcclxuICAgICAgICBpZiAoZGF0YSA9PT0gJycpIHtcclxuICAgICAgICAgIHRoaXMubm90aWZ5LnN1Y2Nlc3ModGhpcy5pMThuUmVzb3VyY2UuZG93bmxvYWRfdGVtcGxhdGVfb2spO1xyXG4gICAgICAgICAgc3ViamVjdC5uZXh0KHRydWUpO1xyXG4gICAgICAgICAgc3ViamVjdC5jb21wbGV0ZSgpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICB0aGlzLm5vdGlmeS5lcnJvcih0aGlzLmkxOG5SZXNvdXJjZS5kb3dubG9hZF90ZW1wbGF0ZV9mYWlsICsgZGF0YSk7XHJcbiAgICAgICAgICBzdWJqZWN0Lm5leHQoZmFsc2UpO1xyXG4gICAgICAgICAgc3ViamVjdC5jb21wbGV0ZSgpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcbiAgICB9ZWxzZSB7XHJcbiAgICAgIGlmIChvcHRpb25Kc29uLmN1c3RvbUltcG9ydFRpdGxlICE9PSB1bmRlZmluZWQgJiYgb3B0aW9uSnNvbi5jdXN0b21JbXBvcnRUaXRsZSAhPT0gbnVsbCkge1xyXG4gICAgICAgIGlmIChvcHRpb25Kc29uLmN1c3RvbUltcG9ydFRpdGxlLmxlbmd0aCA+IDIwKSB7XHJcbiAgICAgICAgICB0aGlzLm5vdGlmeS53YXJuaW5nKCfoh6rlrprkuYnmoIfpopjlkI3np7DnmoTplb/luqblpKrplb8nKTtcclxuICAgICAgICAgIHJldHVybiBzdWJqZWN0O1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoRGF0YUlFVXRpbHMuSnVkZ2VJbGxlZ2FsQ2hhcihvcHRpb25Kc29uLmN1c3RvbUltcG9ydFRpdGxlKSkge1xyXG4gICAgICAgICAgdGhpcy5ub3RpZnkud2FybmluZygn6Ieq5a6a5LmJ5qCH6aKY5ZCN56ew5a2Y5Zyo5LiN5ZCI5rOV5a2X56ymJyk7XHJcbiAgICAgICAgICByZXR1cm4gc3ViamVjdDtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgICAgY29uc3QgY21wUmVmID0gdGhpcy5DcmVhdGVJbXBvcnRDb21wb25lbnQoKTtcclxuICAgICAgY21wUmVmLmluc3RhbmNlLnJ1bGVJZCA9IHJ1bGVJRDtcclxuICAgICAgY21wUmVmLmluc3RhbmNlLmltcG9ydE9wdGlvbiA9IG9wdGlvbkpzb247XHJcbiAgICAgIGNtcFJlZi5pbnN0YW5jZS5yZWNvcmRSdWxlID0gcmVjb3JkUnVsZTtcclxuICAgICAgY21wUmVmLmluc3RhbmNlLmZyYW1lQ29udGV4dCA9IHRoaXMuZnJhbWVDb250ZXh0O1xyXG4gICAgICBjbXBSZWYuaW5zdGFuY2UubWV0aG9kVHlwZSA9IG1ldGhvZFR5cGU7XHJcbiAgICAgIGNtcFJlZi5pbnN0YW5jZS5zdWJqZWN0ID0gc3ViamVjdDtcclxuICAgICAgY29uc3QgaW1wb3J0TW9kYWxDb25maWcgPSB0aGlzLkdldEltcG9ydERpYWxvZ0NvbmZpZyhjbXBSZWYsIG9wdGlvbkpzb24pO1xyXG4gICAgICBjb25zdCBkaWFsb2cgPSB0aGlzLm1vZGFsU2VydmljZS5zaG93KGNtcFJlZiwgaW1wb3J0TW9kYWxDb25maWcpO1xyXG4gICAgICBjbXBSZWYuaW5zdGFuY2UubmVlZERlc3Ryb3kuc3Vic2NyaWJlKCRldmVudCA9PiB7XHJcbiAgICAgICAgZGlhbG9nLmNsb3NlKCk7XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBzdWJqZWN0O1xyXG4gIH1cclxuXHJcbiAgU3RhcnRMb2FkaW5nKCkge1xyXG4gICAgaWYgKHRoaXMubG9hZGluZ1NlcnZpY2UgIT09IHVuZGVmaW5lZCAmJiB0aGlzLmxvYWRpbmdTZXJ2aWNlICE9PSBudWxsKSB7XHJcbiAgICAgIHRoaXMubG9hZGluZ1NlcnZpY2Uuc2hvdygpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgQ2xvc2VMb2FkaW5nKCkge1xyXG4gICAgaWYgKHRoaXMubG9hZGluZ1NlcnZpY2UgIT09IHVuZGVmaW5lZCAmJiB0aGlzLmxvYWRpbmdTZXJ2aWNlICE9PSBudWxsKSB7XHJcbiAgICAgIHRoaXMubG9hZGluZ1NlcnZpY2UuY2xlYXJBbGwoKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHByaXZhdGUgR2V0SW1wb3J0RGlhbG9nQ29uZmlnKGNtcFJlZiwgb3B0aW9uSnNvbikge1xyXG4gICAgbGV0IHRpdGxlID0gdGhpcy5kYXRhX2ltcG9ydDtcclxuICAgIGlmIChvcHRpb25Kc29uLmN1c3RvbUltcG9ydFRpdGxlICE9PSB1bmRlZmluZWQgJiYgb3B0aW9uSnNvbi5jdXN0b21JbXBvcnRUaXRsZSAhPT0gbnVsbCkge1xyXG4gICAgICB0aXRsZSA9IG9wdGlvbkpzb24uY3VzdG9tSW1wb3J0VGl0bGU7XHJcbiAgICB9XHJcbiAgICBjb25zdCBpbXBvcnRNb2RhbENvbmZpZyA9IHtcclxuICAgICAgdGl0bGU6IHRpdGxlLFxyXG4gICAgICB3aWR0aDogNTMwLFxyXG4gICAgICBoZWlnaHQ6IDM0MixcclxuICAgICAgYnV0dG9uczogY21wUmVmLmluc3RhbmNlLm1vZGFsRm9vdGVyLFxyXG4gICAgICBzaG93Q2xvc2VCdXR0b246IHRydWUsXHJcbiAgICAgIHNob3dNYXhCdXR0b246IGZhbHNlLFxyXG4gICAgICBzaG93TWluQnV0dG9uOiBmYWxzZSxcclxuICAgICAgc2hvd0J1dHRvbnM6IHRydWUsXHJcbiAgICAgIHJlc2l6YWJsZTogZmFsc2VcclxuICAgIH07XHJcbiAgICByZXR1cm4gaW1wb3J0TW9kYWxDb25maWc7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIEdldEN1c3RvbUltcG9ydERpYWxvZ0NvbmZpZyhjbXBSZWYsIG9wdGlvbkpzb24pIHtcclxuICAgIGxldCB0aXRsZSA9IHRoaXMuZGF0YV9pbXBvcnQ7XHJcbiAgICBpZiAob3B0aW9uSnNvbi5jdXN0b21JbXBvcnRUaXRsZSAhPT0gdW5kZWZpbmVkICYmIG9wdGlvbkpzb24uY3VzdG9tSW1wb3J0VGl0bGUgIT09IG51bGwpIHtcclxuICAgICAgdGl0bGUgPSBvcHRpb25Kc29uLmN1c3RvbUltcG9ydFRpdGxlO1xyXG4gICAgfVxyXG4gICAgY29uc3QgaW1wb3J0TW9kYWxDb25maWcgPSB7XHJcbiAgICAgIHRpdGxlOiB0aXRsZSxcclxuICAgICAgd2lkdGg6IDk1MCxcclxuICAgICAgaGVpZ2h0OiA1NzAsXHJcbiAgICAgIGJ1dHRvbnM6IGNtcFJlZi5pbnN0YW5jZS5tb2RhbEZvb3RlcixcclxuICAgICAgc2hvd0Nsb3NlQnV0dG9uOiB0cnVlLFxyXG4gICAgICBzaG93TWF4QnV0dG9uOiBmYWxzZSxcclxuICAgICAgc2hvd01pbkJ1dHRvbjogZmFsc2UsXHJcbiAgICAgIHNob3dCdXR0b25zOiB0cnVlLFxyXG4gICAgICByZXNpemFibGU6IGZhbHNlXHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIGltcG9ydE1vZGFsQ29uZmlnO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBHZXRFeHBvcnREaWFsb2dDb25maWcoY21wUmVmLCBvcHRpb25Kc29uKSB7XHJcbiAgICBsZXQgdGl0bGUgPSB0aGlzLmRhdGFfZXhwb3J0O1xyXG4gICAgaWYgKG9wdGlvbkpzb24uY3VzdG9tRXhwb3J0VGl0bGUgIT09IHVuZGVmaW5lZCAmJiBvcHRpb25Kc29uLmN1c3RvbUV4cG9ydFRpdGxlICE9PSBudWxsKSB7XHJcbiAgICAgIHRpdGxlID0gb3B0aW9uSnNvbi5jdXN0b21FeHBvcnRUaXRsZTtcclxuICAgIH1cclxuICAgIGNvbnN0IGV4cG9ydE1vZGFsQ29uZmlnID0ge1xyXG4gICAgICB0aXRsZTogdGl0bGUsXHJcbiAgICAgIHdpZHRoOiA5MjIsXHJcbiAgICAgIGhlaWdodDogNTMwLFxyXG4gICAgICBidXR0b25zOiBjbXBSZWYuaW5zdGFuY2UubW9kYWxGb290ZXIsXHJcbiAgICAgIHNob3dDbG9zZUJ1dHRvbjogdHJ1ZSxcclxuICAgICAgc2hvd01heEJ1dHRvbjogZmFsc2UsXHJcbiAgICAgIHNob3dNaW5CdXR0b246IGZhbHNlLFxyXG4gICAgICBzaG93QnV0dG9uczogdHJ1ZSxcclxuICAgICAgcmVzaXphYmxlOiBmYWxzZVxyXG4gICAgfTtcclxuICAgIHJldHVybiBleHBvcnRNb2RhbENvbmZpZztcclxuICB9XHJcblxyXG4gIHByaXZhdGUgR2V0U2VsZWN0RXhwb3J0RGlhbG9nQ29uZmlnKGNtcFJlZiwgb3B0aW9uSnNvbikge1xyXG4gICAgbGV0IHRpdGxlID0gdGhpcy5kYXRhX2V4cG9ydDtcclxuICAgIGlmIChvcHRpb25Kc29uLmN1c3RvbUV4cG9ydFRpdGxlICE9PSB1bmRlZmluZWQgJiYgb3B0aW9uSnNvbi5jdXN0b21FeHBvcnRUaXRsZSAhPT0gbnVsbCkge1xyXG4gICAgICB0aXRsZSA9IG9wdGlvbkpzb24uY3VzdG9tRXhwb3J0VGl0bGU7XHJcbiAgICB9XHJcbiAgICBjb25zdCBleHBvcnRNb2RhbENvbmZpZyA9IHtcclxuICAgICAgdGl0bGU6IHRpdGxlLFxyXG4gICAgICB3aWR0aDogNTMwLFxyXG4gICAgICBoZWlnaHQ6IDM0MixcclxuICAgICAgYnV0dG9uczogY21wUmVmLmluc3RhbmNlLm1vZGFsRm9vdGVyLFxyXG4gICAgICBzaG93Q2xvc2VCdXR0b246IHRydWUsXHJcbiAgICAgIHNob3dNYXhCdXR0b246IGZhbHNlLFxyXG4gICAgICBzaG93TWluQnV0dG9uOiBmYWxzZSxcclxuICAgICAgc2hvd0J1dHRvbnM6IHRydWUsXHJcbiAgICAgIHJlc2l6YWJsZTogZmFsc2VcclxuICAgIH07XHJcbiAgICByZXR1cm4gZXhwb3J0TW9kYWxDb25maWc7XHJcbiAgfVxyXG5cclxuICAvLyDliJvlu7rovpPlhaXnu4Tku7blrp7kvotcclxuICBwcml2YXRlIENyZWF0ZUltcG9ydENvbXBvbmVudCgpIHtcclxuICAgIGNvbnN0IGNvbXBGYWN0b3J5ID0gdGhpcy5yZXNvbHZlci5yZXNvbHZlQ29tcG9uZW50RmFjdG9yeShJbXBvcnREaWFsb2dDb21wb25lbnQpO1xyXG4gICAgY29uc3QgY21wUmVmID0gY29tcEZhY3RvcnkuY3JlYXRlKHRoaXMuaW5qZWN0b3IpO1xyXG4gICAgcmV0dXJuIGNtcFJlZjtcclxuICB9XHJcblxyXG4gIC8vIOWIm+W7uui+k+WHuue7hOS7tuWunuS+i1xyXG4gIHByaXZhdGUgQ3JlYXRlRXhwb3J0Q29tcG9uZW50KCkge1xyXG4gICAgY29uc3QgY29tcEZhY3RvcnkgPSB0aGlzLnJlc29sdmVyLnJlc29sdmVDb21wb25lbnRGYWN0b3J5KEV4cG9ydERpYWxvZ0NvbXBvbmVudCk7XHJcbiAgICBjb25zdCBjbXBSZWYgPSBjb21wRmFjdG9yeS5jcmVhdGUodGhpcy5pbmplY3Rvcik7XHJcbiAgICByZXR1cm4gY21wUmVmO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBDcmVhdGVTZWxlY3RFeHBvcnRDb21wb25lbnQoKSB7XHJcbiAgICBjb25zdCBjb21wRmFjdG9yeSA9IHRoaXMucmVzb2x2ZXIucmVzb2x2ZUNvbXBvbmVudEZhY3RvcnkoRXhwb3J0Q3VzdG9tU2VsZWN0Q29tcG9uZW50KTtcclxuICAgIGNvbnN0IGNtcFJlZiA9IGNvbXBGYWN0b3J5LmNyZWF0ZSh0aGlzLmluamVjdG9yKTtcclxuICAgIHJldHVybiBjbXBSZWY7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIENyZWF0ZUN1c3RvbUltcG9ydENvbXBvbmVudCgpIHtcclxuICAgIGNvbnN0IGNvbXBGYWN0b3J5ID0gdGhpcy5yZXNvbHZlci5yZXNvbHZlQ29tcG9uZW50RmFjdG9yeShDdXN0b21JbXBvcnREaWFsb2dDb21wb25lbnQpO1xyXG4gICAgY29uc3QgY21wUmVmID0gY29tcEZhY3RvcnkuY3JlYXRlKHRoaXMuaW5qZWN0b3IpO1xyXG4gICAgcmV0dXJuIGNtcFJlZjtcclxuICB9XHJcblxyXG5cclxufVxyXG4iXX0=
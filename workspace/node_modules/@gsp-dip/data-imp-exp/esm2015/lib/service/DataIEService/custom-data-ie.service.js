/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { EventEmitter, Injectable, Output } from '@angular/core';
import { DataIEUtils, getQueryString, isNullOrEmpty, isNullOrUndefined } from '../Utils/DataIEUtils';
import { NotifyService } from '@farris/ui-notify';
import { FileOperateService } from './file-operate.service';
import { DataImportService } from './data-import.service';
import { LoadingService } from '@farris/ui-loading';
import { HttpClient } from '@angular/common/http';
import * as i0 from "@angular/core";
import * as i1 from "@farris/ui-notify";
import * as i2 from "./file-operate.service";
import * as i3 from "@farris/ui-loading";
import * as i4 from "./data-import.service";
import * as i5 from "@angular/common/http";
export class CustomDataIEService {
    /**
     * @param {?} notify
     * @param {?} operateService
     * @param {?} loadingService
     * @param {?} importService
     * @param {?} http
     */
    constructor(notify, operateService, loadingService, importService, http) {
        this.notify = notify;
        this.operateService = operateService;
        this.loadingService = loadingService;
        this.importService = importService;
        this.http = http;
        this.origin = window.location.origin;
        this.customExportUrl = this.origin + '/api/runtime/dip/v1.0/customexport';
        this.customImportUrl = this.origin + '/api/runtime/dip/v1.0/customimport';
        this.export = new EventEmitter();
        this.complete = new EventEmitter();
        DataIEUtils.getTranslateValue(http).subscribe((/**
         * @param {?} res
         * @return {?}
         */
        res => {
            this.i18nResource = res;
        }));
    }
    /**
     * @param {?} model
     * @param {?} components
     * @param {?} frameContext
     * @param {?} suffix
     * @param {?} isImportForm
     * @param {?} i18nId
     * @param {?} dimension
     * @return {?}
     */
    SaveCustomImportRule(model, components, frameContext, suffix, isImportForm, i18nId, dimension) {
        /** @type {?} */
        const befRestService = DataIEUtils.GetBefRestService(frameContext.repository);
        /** @type {?} */
        const tempUrl = DataIEUtils.GetPreUrl(befRestService.baseUri);
        /** @type {?} */
        const su = DataIEUtils.getSu(tempUrl);
        /** @type {?} */
        let importParam = null;
        if (isNullOrUndefined(dimension)) {
            importParam = {
                body: {
                    dataExchangeModel: JSON.stringify(model),
                    components: components,
                    suffix: suffix,
                    keys: ['DataImport', model['MainObject']['Source']['SourceMetadataID']],
                    importForm: isImportForm,
                    su: su,
                    i18nId: i18nId
                }
            };
        }
        else {
            importParam = {
                body: {
                    dataExchangeModel: JSON.stringify(model),
                    components: components,
                    suffix: suffix,
                    keys: ['DataImport', model['MainObject']['Source']['SourceMetadataID'], dimension],
                    importForm: isImportForm,
                    su: su,
                    i18nId: i18nId
                }
            };
        }
        /** @type {?} */
        let subject;
        if (!isNullOrUndefined(this.http)) {
            subject = this.http.post(`${this.customImportUrl}/AddImportRule`, importParam.body, { params: { su: su } });
        }
        else {
            subject = befRestService.request(`${this.customImportUrl}/AddImportRule`, 'post', { su: su }, importParam);
        }
        return subject;
    }
    /**
     * @param {?} model
     * @param {?} components
     * @param {?} frameContext
     * @param {?} suffix
     * @param {?} i18nId
     * @param {?} dimension
     * @return {?}
     */
    SaveCustomExportRule(model, components, frameContext, suffix, i18nId, dimension) {
        /** @type {?} */
        const befRestService = DataIEUtils.GetBefRestService(frameContext.repository);
        /** @type {?} */
        const tempUrl = DataIEUtils.GetPreUrl(befRestService.baseUri);
        /** @type {?} */
        const su = DataIEUtils.getSu(tempUrl);
        /** @type {?} */
        let exportParam = null;
        if (isNullOrUndefined(dimension)) {
            exportParam = {
                body: {
                    dataExchangeModel: JSON.stringify(model),
                    components: components,
                    suffix: suffix,
                    keys: ['DataExport', model['MainObject']['Source']['SourceMetadataID']],
                    su: su,
                    i18nId: i18nId
                }
            };
        }
        else {
            exportParam = {
                body: {
                    dataExchangeModel: JSON.stringify(model),
                    components: components,
                    suffix: suffix,
                    keys: ['DataExport', model['MainObject']['Source']['SourceMetadataID'], dimension],
                    su: su,
                    i18nId: i18nId
                }
            };
        }
        /** @type {?} */
        let subject;
        if (!isNullOrUndefined(this.http)) {
            subject = this.http.post(`${this.customExportUrl}/AddExportRule`, exportParam.body, { params: { su: su } });
        }
        else {
            subject = befRestService.request(`${this.customExportUrl}/AddExportRule`, 'post', { su: su }, exportParam);
        }
        return subject;
    }
    // 下载模板
    /**
     * @param {?} model
     * @param {?} frameContext
     * @param {?} importOption
     * @return {?}
     */
    DowmloadTemplate(model, frameContext, importOption) {
        /** @type {?} */
        const keys = ['DataImport', model['MainObject']['Source']['SourceMetadataID'], importOption.dimension];
        /** @type {?} */
        const befRestService = DataIEUtils.GetBefRestService(frameContext.repository);
        /** @type {?} */
        const tempUrl = DataIEUtils.GetPreUrl(befRestService.baseUri);
        /** @type {?} */
        const su = DataIEUtils.getSu(tempUrl);
        /** @type {?} */
        const templateParam = {
            body: {
                keys: keys,
                su: su
            }
        };
        /** @type {?} */
        const subject = befRestService.request(`${this.customImportUrl}/TemplateDownload`, 'post', { su: su }, templateParam);
        subject.subscribe((/**
         * @param {?} data
         * @return {?}
         */
        data => {
            if (data['success'] === true) {
                /** @type {?} */
                let filename = data['fileName'];
                if (importOption !== null && importOption['templatefilename'] !== null && importOption['templatefilename'] !== undefined) {
                    /** @type {?} */
                    const suffixIndex = filename.lastIndexOf('.');
                    /** @type {?} */
                    const suffix = filename.substring(suffixIndex);
                    filename = importOption['templatefilename'] + suffix;
                }
                /** @type {?} */
                const preUrl = DataIEUtils.GetPreUrl(befRestService.baseUri);
                this.operateService.DownloadFile(data['relativePath'], filename, preUrl, importOption);
                /** @type {?} */
                const subscription = this.operateService.downloadComplete.subscribe((/**
                 * @param {?} result
                 * @return {?}
                 */
                result => {
                    if (result === '') {
                        this.complete.emit('');
                        subscription.unsubscribe();
                    }
                    else {
                        this.complete.emit(result);
                        subscription.unsubscribe();
                    }
                }));
            }
            else {
                this.complete.emit(data['message']);
            }
        }));
    }
    /**
     * @param {?} keys
     * @param {?} repository
     * @param {?} i18nId
     * @param {?} model
     * @return {?}
     */
    GetImportRuleModel(keys, repository, i18nId, model) {
        /** @type {?} */
        const befRestService = DataIEUtils.GetBefRestService(repository);
        /** @type {?} */
        const tempUrl = DataIEUtils.GetPreUrl(befRestService.baseUri);
        /** @type {?} */
        const su = DataIEUtils.getSu(tempUrl);
        /** @type {?} */
        const params = {
            body: {
                keys: keys,
                su: su,
                i18nId: i18nId,
                needI18nModel: JSON.stringify(model)
            }
        };
        /** @type {?} */
        let subject;
        if (!isNullOrUndefined(this.http)) {
            subject = this.http.post(`${this.customImportUrl}/GetImportModel`, params.body, { params: { su: su } });
        }
        else {
            subject = befRestService.request(`${this.customImportUrl}/GetImportModel`, 'post', { su: su }, params);
        }
        return subject;
    }
    /**
     * @param {?} keys
     * @param {?} repository
     * @param {?} i18nId
     * @param {?} model
     * @return {?}
     */
    GetExportRuleModel(keys, repository, i18nId, model) {
        /** @type {?} */
        const befRestService = DataIEUtils.GetBefRestService(repository);
        /** @type {?} */
        const tempUrl = DataIEUtils.GetPreUrl(befRestService.baseUri);
        /** @type {?} */
        const su = DataIEUtils.getSu(tempUrl);
        /** @type {?} */
        const params = {
            body: {
                keys: keys,
                su: su,
                i18nId: i18nId,
                needI18nModel: JSON.stringify(model)
            }
        };
        /** @type {?} */
        let subject;
        if (!isNullOrUndefined(this.http)) {
            subject = this.http.post(`${this.customExportUrl}/GetExportModel`, params.body, { params: { su: su } });
        }
        else {
            subject = befRestService.request(`${this.customExportUrl}/GetExportModel`, 'post', { su: su }, params);
        }
        return subject;
    }
    /**
     * @param {?} commonParams
     * @return {?}
     */
    ImportByRule(commonParams) {
        /** @type {?} */
        const repository = commonParams.repository;
        /** @type {?} */
        const option = commonParams.option;
        /** @type {?} */
        const keys = commonParams.keys;
        /** @type {?} */
        const fileName = commonParams.fileName;
        /** @type {?} */
        const befRestService = DataIEUtils.GetBefRestService(repository);
        /** @type {?} */
        let globalVar = '';
        if (option !== null && option['GlobalParam'] !== null && option['GlobalParam'] !== undefined) {
            globalVar = JSON.stringify(option['GlobalParam']);
        }
        /** @type {?} */
        const funcId = getQueryString('funcId');
        /** @type {?} */
        const importParam = {
            body: {
                dataImportContext: {
                    Keys: keys,
                    FileName: fileName,
                    GlobalParam: globalVar,
                    funcId: funcId
                }
            }
        };
        commonParams.befRestService = befRestService;
        commonParams.importParam = importParam;
        commonParams.mainObjId = '';
        this.importService.Import(commonParams);
    }
    /**
     * @param {?} commonParams
     * @return {?}
     */
    ImportSubTableByRule(commonParams) {
        /** @type {?} */
        const repository = commonParams.repository;
        /** @type {?} */
        const option = commonParams.option;
        /** @type {?} */
        const keys = commonParams.keys;
        /** @type {?} */
        const fileName = commonParams.fileName;
        /** @type {?} */
        const frameContext = commonParams.frameContext;
        /** @type {?} */
        const befRestService = DataIEUtils.GetBefRestService(repository);
        /** @type {?} */
        let globalVar = '';
        if (option !== null && option['GlobalParam'] !== null && option['GlobalParam'] !== undefined) {
            globalVar = JSON.stringify(option['GlobalParam']);
        }
        if (frameContext.bindingData.list.currentId === '' || frameContext.bindingData.list.currentId === null) {
            this.notify.info(this.i18nResource['master_table_noid']);
            return false;
        }
        else {
            /** @type {?} */
            const funcId = getQueryString('funcId');
            /** @type {?} */
            const importParam = {
                body: {
                    dataImportContext: {
                        Keys: keys,
                        FileName: fileName,
                        MainObjId: frameContext.bindingData.list.currentId,
                        GlobalParam: globalVar,
                        funcId: funcId
                    },
                    requestInfo: befRestService.buildRequestInfo()
                }
            };
            commonParams.befRestService = befRestService;
            commonParams.importParam = importParam;
            commonParams.mainObjId = frameContext.bindingData.list.currentId;
            this.importService.Import(commonParams);
        }
    }
    /**
     * @param {?} keys
     * @param {?} filter
     * @param {?} option
     * @param {?} frameContext
     * @return {?}
     */
    ExportByRule(keys, filter, option, frameContext) {
        /** @type {?} */
        const befRestService = DataIEUtils.GetBefRestService(frameContext.repository);
        /** @type {?} */
        const funcId = getQueryString('funcId');
        /** @type {?} */
        const newFilters = [];
        /** @type {?} */
        const selectFilterGridComponent = option['selectFilterGridComponent'];
        if (!isNullOrUndefined(selectFilterGridComponent) && !isNullOrEmpty(selectFilterGridComponent)) {
            /** @type {?} */
            const ids = frameContext.appContext.frameContextManager.getFrameContextById(selectFilterGridComponent).uiState['ids'];
            if (!isNullOrUndefined(ids) && ids.length > 0) {
                /** @type {?} */
                let idsStr = '';
                for (let i = 0; i < ids.length; i++) {
                    /** @type {?} */
                    const id = ids[i];
                    if (i === ids.length - 1) {
                        idsStr += id;
                    }
                    else {
                        idsStr += id + '\r\n';
                    }
                }
                /** @type {?} */
                const selectIdFilterCondition = {
                    FilterField: "ID",
                    Compare: 14,
                    Value: idsStr,
                    Relation: 1,
                    Expresstype: 0
                };
                newFilters.push(selectIdFilterCondition);
            }
            else {
                this.notify.info(this.i18nResource['select-data-export']);
                return;
            }
        }
        if (option['enableScreeningScheme'] === true) {
            /** @type {?} */
            const filterConditionList = frameContext.uiState['filterConditionList'];
            if (filterConditionList !== undefined && filterConditionList !== null && filterConditionList !== '' && filterConditionList !== '[]') {
                /** @type {?} */
                let filterConditionListJson;
                if (typeof (filterConditionList) === 'string') {
                    filterConditionListJson = JSON.parse(filterConditionList);
                }
                else {
                    filterConditionListJson = filterConditionList;
                }
                for (let index = 0; index < filterConditionListJson.length; index++) {
                    /** @type {?} */
                    const element = filterConditionListJson[index];
                    /** @type {?} */
                    const value = decodeURIComponent(element.Value);
                    element.Value = value;
                    newFilters.push(element);
                }
            }
        }
        if (newFilters.length > 0) {
            if (!isNullOrUndefined(filter) && filter.FilterConditions !== null) {
                filter.FilterConditions = newFilters.concat(filter.FilterConditions);
            }
            else {
                if (isNullOrUndefined(filter)) {
                    filter = {};
                }
                filter['FilterConditions'] = newFilters;
            }
        }
        if (!isNullOrUndefined(filter) && !isNullOrUndefined(filter.FilterConditions)) {
            //确保最后一个关系为空
            filter.FilterConditions[filter.FilterConditions.length - 1].Relation = 0;
        }
        /** @type {?} */
        const exportParam = {
            body: {
                exportContext: {
                    Filter: filter,
                    Keys: keys,
                    GlobalParam: '',
                    funcId: funcId
                }
            }
        };
        this.loadingService.show();
        /** @type {?} */
        const subject = befRestService.request(`${befRestService.baseUri}/service/dataexportvmaction`, 'put', null, exportParam);
        subject.subscribe((/**
         * @param {?} data
         * @return {?}
         */
        data => {
            if (data === null) {
                // this.export.emit(false);
                this.notify.info('数据导出失败！\n 失败原因：服务端响应异常，请检查');
            }
            /** @type {?} */
            let exportResult = (/** @type {?} */ (data.returnValue));
            if (isNullOrUndefined(exportResult)) {
                exportResult = (/** @type {?} */ (data));
            }
            /** @type {?} */
            let fileName = exportResult.fileName;
            if (option !== null && option['customfilename'] !== null && option['customfilename'] !== undefined) {
                /** @type {?} */
                const suffixIndex = fileName.lastIndexOf('.');
                /** @type {?} */
                const suffix = fileName.substring(suffixIndex);
                fileName = option['customfilename'] + suffix;
            }
            if (exportResult.succeed === true) {
                /** @type {?} */
                const preUrl = DataIEUtils.GetPreUrl(befRestService.baseUri);
                this.operateService.DownloadFile(exportResult.relativePath, fileName, preUrl, option);
                /** @type {?} */
                const subscriber = this.operateService.downloadComplete.subscribe((/**
                 * @param {?} result
                 * @return {?}
                 */
                result => {
                    this.loadingService.clearAll();
                    if (result === '') {
                        this.export.emit('');
                        subscriber.unsubscribe();
                    }
                    else {
                        this.export.emit(result);
                        subscriber.unsubscribe();
                    }
                }));
            }
            else {
                this.loadingService.clearAll();
                this.errorlevel = exportResult.errorLevel;
                this.export.emit(exportResult.message);
                // this.notify.error('数据导出失败！\n 失败原因：' + exportResult.message);
            }
        }));
    }
}
CustomDataIEService.decorators = [
    { type: Injectable, args: [{
                providedIn: 'root'
            },] }
];
/** @nocollapse */
CustomDataIEService.ctorParameters = () => [
    { type: NotifyService },
    { type: FileOperateService },
    { type: LoadingService },
    { type: DataImportService },
    { type: HttpClient }
];
CustomDataIEService.propDecorators = {
    export: [{ type: Output }]
};
/** @nocollapse */ CustomDataIEService.ngInjectableDef = i0.defineInjectable({ factory: function CustomDataIEService_Factory() { return new CustomDataIEService(i0.inject(i1.NotifyService), i0.inject(i2.FileOperateService), i0.inject(i3.LoadingService), i0.inject(i4.DataImportService), i0.inject(i5.HttpClient)); }, token: CustomDataIEService, providedIn: "root" });
if (false) {
    /**
     * @type {?}
     * @private
     */
    CustomDataIEService.prototype.origin;
    /**
     * @type {?}
     * @private
     */
    CustomDataIEService.prototype.customExportUrl;
    /**
     * @type {?}
     * @private
     */
    CustomDataIEService.prototype.customImportUrl;
    /** @type {?} */
    CustomDataIEService.prototype.complete;
    /** @type {?} */
    CustomDataIEService.prototype.export;
    /** @type {?} */
    CustomDataIEService.prototype.errorlevel;
    /** @type {?} */
    CustomDataIEService.prototype.i18nResource;
    /**
     * @type {?}
     * @private
     */
    CustomDataIEService.prototype.notify;
    /**
     * @type {?}
     * @private
     */
    CustomDataIEService.prototype.operateService;
    /**
     * @type {?}
     * @private
     */
    CustomDataIEService.prototype.loadingService;
    /**
     * @type {?}
     * @private
     */
    CustomDataIEService.prototype.importService;
    /**
     * @type {?}
     * @private
     */
    CustomDataIEService.prototype.http;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY3VzdG9tLWRhdGEtaWUuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0Bnc3AtZGlwL2RhdGEtaW1wLWV4cC8iLCJzb3VyY2VzIjpbImxpYi9zZXJ2aWNlL0RhdGFJRVNlcnZpY2UvY3VzdG9tLWRhdGEtaWUuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFDLFlBQVksRUFBRSxVQUFVLEVBQUUsTUFBTSxFQUFDLE1BQU0sZUFBZSxDQUFDO0FBRS9ELE9BQU8sRUFBQyxXQUFXLEVBQUUsY0FBYyxFQUFFLGFBQWEsRUFBRSxpQkFBaUIsRUFBQyxNQUFNLHNCQUFzQixDQUFDO0FBRW5HLE9BQU8sRUFBQyxhQUFhLEVBQUMsTUFBTSxtQkFBbUIsQ0FBQztBQUVoRCxPQUFPLEVBQUMsa0JBQWtCLEVBQUMsTUFBTSx3QkFBd0IsQ0FBQztBQUMxRCxPQUFPLEVBQUMsaUJBQWlCLEVBQUMsTUFBTSx1QkFBdUIsQ0FBQztBQUN4RCxPQUFPLEVBQUMsY0FBYyxFQUFDLE1BQU0sb0JBQW9CLENBQUM7QUFDbEQsT0FBTyxFQUFDLFVBQVUsRUFBQyxNQUFNLHNCQUFzQixDQUFDOzs7Ozs7O0FBTWhELE1BQU0sT0FBTyxtQkFBbUI7Ozs7Ozs7O0lBYTlCLFlBQ1UsTUFBcUIsRUFDckIsY0FBa0MsRUFDbEMsY0FBOEIsRUFDOUIsYUFBZ0MsRUFDaEMsSUFBZ0I7UUFKaEIsV0FBTSxHQUFOLE1BQU0sQ0FBZTtRQUNyQixtQkFBYyxHQUFkLGNBQWMsQ0FBb0I7UUFDbEMsbUJBQWMsR0FBZCxjQUFjLENBQWdCO1FBQzlCLGtCQUFhLEdBQWIsYUFBYSxDQUFtQjtRQUNoQyxTQUFJLEdBQUosSUFBSSxDQUFZO1FBaEJsQixXQUFNLEdBQUcsTUFBTSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUM7UUFDaEMsb0JBQWUsR0FBRyxJQUFJLENBQUMsTUFBTSxHQUFHLG9DQUFvQyxDQUFDO1FBQ3JFLG9CQUFlLEdBQUcsSUFBSSxDQUFDLE1B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LHVDQUFxQjs7SUFFckIscUNBQzRCOztJQUM1Qix5Q0FBdUI7O0lBRXZCLDJDQUFrQjs7Ozs7SUFHaEIscUNBQTZCOzs7OztJQUM3Qiw2Q0FBMEM7Ozs7O0lBQzFDLDZDQUFzQzs7Ozs7SUFDdEMsNENBQXdDOzs7OztJQUN4QyxtQ0FBd0IiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge0V2ZW50RW1pdHRlciwgSW5qZWN0YWJsZSwgT3V0cHV0fSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHtGcmFtZUNvbnRleHQsIFJlcG9zaXRvcnl9IGZyb20gJ0BmYXJyaXMvZGV2a2l0JztcclxuaW1wb3J0IHtEYXRhSUVVdGlscywgZ2V0UXVlcnlTdHJpbmcsIGlzTnVsbE9yRW1wdHksIGlzTnVsbE9yVW5kZWZpbmVkfSBmcm9tICcuLi9VdGlscy9EYXRhSUVVdGlscyc7XHJcbmltcG9ydCB7T2JzZXJ2YWJsZX0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7Tm90aWZ5U2VydmljZX0gZnJvbSAnQGZhcnJpcy91aS1ub3RpZnknO1xyXG5pbXBvcnQge0RhdGFJRVJlc3VsdH0gZnJvbSAnLi4vRW50aXR5L0RhdGFJRVJlc3VsdCc7XHJcbmltcG9ydCB7RmlsZU9wZXJhdGVTZXJ2aWNlfSBmcm9tICcuL2ZpbGUtb3BlcmF0ZS5zZXJ2aWNlJztcclxuaW1wb3J0IHtEYXRhSW1wb3J0U2VydmljZX0gZnJvbSAnLi9kYXRhLWltcG9ydC5zZXJ2aWNlJztcclxuaW1wb3J0IHtMb2FkaW5nU2VydmljZX0gZnJvbSAnQGZhcnJpcy91aS1sb2FkaW5nJztcclxuaW1wb3J0IHtIdHRwQ2xpZW50fSBmcm9tICdAYW5ndWxhci9jb21tb24vaHR0cCc7XHJcbmltcG9ydCB7Q29tbW9uUGFyYW1zfSBmcm9tIFwiLi4vRW50aXR5L0NvbW1vblBhcmFtc1wiO1xyXG5cclxuQEluamVjdGFibGUoe1xyXG4gIHByb3ZpZGVkSW46ICdyb290J1xyXG59KVxyXG5leHBvcnQgY2xhc3MgQ3VzdG9tRGF0YUlFU2VydmljZSB7XHJcblxyXG4gIHByaXZhdGUgb3JpZ2luID0gd2luZG93LmxvY2F0aW9uLm9yaWdpbjtcclxuICBwcml2YXRlIGN1c3RvbUV4cG9ydFVybCA9IHRoaXMub3JpZ2luICsgJy9hcGkvcnVudGltZS9kaXAvdjEuMC9jdXN0b21leHBvcnQnO1xyXG4gIHByaXZhdGUgY3VzdG9tSW1wb3J0VXJsID0gdGhpcy5vcmlnaW4gKyAnL2FwaS9ydW50aW1lL2RpcC92MS4wL2N1c3RvbWltcG9ydCc7XHJcbiAgcHVibGljIGNvbXBsZXRlOiBhbnk7XHJcblxyXG4gIEBPdXRwdXQoKVxyXG4gIGV4cG9ydCA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuICBwdWJsaWMgZXJyb3JsZXZlbDogYW55O1xyXG4gIC8vIGxvYWRpbmdDb21wOiBMb2FkaW5nQ29tcG9uZW50ID0gbnVsbDtcclxuICBpMThuUmVzb3VyY2U6IGFueTtcclxuXHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICBwcml2YXRlIG5vdGlmeTogTm90aWZ5U2VydmljZSxcclxuICAgIHByaXZhdGUgb3BlcmF0ZVNlcnZpY2U6IEZpbGVPcGVyYXRlU2VydmljZSxcclxuICAgIHByaXZhdGUgbG9hZGluZ1NlcnZpY2U6IExvYWRpbmdTZXJ2aWNlLFxyXG4gICAgcHJpdmF0ZSBpbXBvcnRTZXJ2aWNlOiBEYXRhSW1wb3J0U2VydmljZSxcclxuICAgIHByaXZhdGUgaHR0cDogSHR0cENsaWVudFxyXG4gICkge1xyXG4gICAgdGhpcy5jb21wbGV0ZSA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuICAgIERhdGFJRVV0aWxzLmdldFRyYW5zbGF0ZVZhbHVlKGh0dHApLnN1YnNjcmliZShyZXMgPT4ge1xyXG4gICAgICB0aGlzLmkxOG5SZXNvdXJjZSA9IHJlcztcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIFNhdmVDdXN0b21JbXBvcnRSdWxlKG1vZGVsOiBhbnksIGNvbXBvbmVudHM6IGFueSwgZnJhbWVDb250ZXh0OiBGcmFtZUNvbnRleHQsIHN1ZmZpeDogc3RyaW5nLCBpc0ltcG9ydEZvcm06IGJvb2xlYW4sIGkxOG5JZDogc3RyaW5nLCBkaW1lbnNpb246IHN0cmluZyk6XHJcbiAgICBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgY29uc3QgYmVmUmVzdFNlcnZpY2UgPSBEYXRhSUVVdGlscy5HZXRCZWZSZXN0U2VydmljZShmcmFtZUNvbnRleHQucmVwb3NpdG9yeSk7XHJcbiAgICBjb25zdCB0ZW1wVXJsID0gRGF0YUlFVXRpbHMuR2V0UHJlVXJsKGJlZlJlc3RTZXJ2aWNlLmJhc2VVcmkpO1xyXG4gICAgY29uc3Qgc3UgPSBEYXRhSUVVdGlscy5nZXRTdSh0ZW1wVXJsKTtcclxuICAgIGxldCBpbXBvcnRQYXJhbSA9IG51bGw7XHJcbiAgICBpZiAoaXNOdWxsT3JVbmRlZmluZWQoZGltZW5zaW9uKSkge1xyXG4gICAgICBpbXBvcnRQYXJhbSA9IHtcclxuICAgICAgICBib2R5OiB7XHJcbiAgICAgICAgICBkYXRhRXhjaGFuZ2VNb2RlbDogSlNPTi5zdHJpbmdpZnkobW9kZWwpLFxyXG4gICAgICAgICAgY29tcG9uZW50czogY29tcG9uZW50cyxcclxuICAgICAgICAgIHN1ZmZpeDogc3VmZml4LFxyXG4gICAgICAgICAga2V5czogWydEYXRhSW1wb3J0JywgbW9kZWxbJ01haW5PYmplY3QnXVsnU291cmNlJ11bJ1NvdXJjZU1ldGFkYXRhSUQnXV0sXHJcbiAgICAgICAgICBpbXBvcnRGb3JtOiBpc0ltcG9ydEZvcm0sXHJcbiAgICAgICAgICBzdTogc3UsXHJcbiAgICAgICAgICBpMThuSWQ6IGkxOG5JZFxyXG4gICAgICAgIH1cclxuICAgICAgfTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGltcG9ydFBhcmFtID0ge1xyXG4gICAgICAgIGJvZHk6IHtcclxuICAgICAgICAgIGRhdGFFeGNoYW5nZU1vZGVsOiBKU09OLnN0cmluZ2lmeShtb2RlbCksXHJcbiAgICAgICAgICBjb21wb25lbnRzOiBjb21wb25lbnRzLFxyXG4gICAgICAgICAgc3VmZml4OiBzdWZmaXgsXHJcbiAgICAgICAgICBrZXlzOiBbJ0RhdGFJbXBvcnQnLCBtb2RlbFsnTWFpbk9iamVjdCddWydTb3VyY2UnXVsnU291cmNlTWV0YWRhdGFJRCddLCBkaW1lbnNpb25dLFxyXG4gICAgICAgICAgaW1wb3J0Rm9ybTogaXNJbXBvcnRGb3JtLFxyXG4gICAgICAgICAgc3U6IHN1LFxyXG4gICAgICAgICAgaTE4bklkOiBpMThuSWRcclxuICAgICAgICB9XHJcbiAgICAgIH07XHJcbiAgICB9XHJcbiAgICBsZXQgc3ViamVjdDogT2JzZXJ2YWJsZTxhbnk+O1xyXG4gICAgaWYgKCFpc051bGxPclVuZGVmaW5lZCh0aGlzLmh0dHApKSB7XHJcbiAgICAgIHN1YmplY3QgPSB0aGlzLmh0dHAucG9zdChgJHt0aGlzLmN1c3RvbUltcG9ydFVybH0vQWRkSW1wb3J0UnVsZWAsIGltcG9ydFBhcmFtLmJvZHksIHtwYXJhbXM6IHtzdTogc3V9fSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBzdWJqZWN0ID0gYmVmUmVzdFNlcnZpY2UucmVxdWVzdChgJHt0aGlzLmN1c3RvbUltcG9ydFVybH0vQWRkSW1wb3J0UnVsZWAsICdwb3N0Jywge3N1OiBzdX0sIGltcG9ydFBhcmFtKTtcclxuICAgIH1cclxuICAgIHJldHVybiBzdWJqZWN0O1xyXG4gIH1cclxuXHJcbiAgcHVibGljIFNhdmVDdXN0b21FeHBvcnRSdWxlKG1vZGVsOiBhbnksIGNvbXBvbmVudHM6IGFueSwgZnJhbWVDb250ZXh0OiBGcmFtZUNvbnRleHQsIHN1ZmZpeDogc3RyaW5nLCBpMThuSWQ6IHN0cmluZywgZGltZW5zaW9uOiBzdHJpbmcpOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgY29uc3QgYmVmUmVzdFNlcnZpY2UgPSBEYXRhSUVVdGlscy5HZXRCZWZSZXN0U2VydmljZShmcmFtZUNvbnRleHQucmVwb3NpdG9yeSk7XHJcbiAgICBjb25zdCB0ZW1wVXJsID0gRGF0YUlFVXRpbHMuR2V0UHJlVXJsKGJlZlJlc3RTZXJ2aWNlLmJhc2VVcmkpO1xyXG4gICAgY29uc3Qgc3UgPSBEYXRhSUVVdGlscy5nZXRTdSh0ZW1wVXJsKTtcclxuICAgIGxldCBleHBvcnRQYXJhbSA9IG51bGw7XHJcbiAgICBpZiAoaXNOdWxsT3JVbmRlZmluZWQoZGltZW5zaW9uKSkge1xyXG4gICAgICBleHBvcnRQYXJhbSA9IHtcclxuICAgICAgICBib2R5OiB7XHJcbiAgICAgICAgICBkYXRhRXhjaGFuZ2VNb2RlbDogSlNPTi5zdHJpbmdpZnkobW9kZWwpLFxyXG4gICAgICAgICAgY29tcG9uZW50czogY29tcG9uZW50cyxcclxuICAgICAgICAgIHN1ZmZpeDogc3VmZml4LFxyXG4gICAgICAgICAga2V5czogWydEYXRhRXhwb3J0JywgbW9kZWxbJ01haW5PYmplY3QnXVsnU291cmNlJ11bJ1NvdXJjZU1ldGFkYXRhSUQnXV0sXHJcbiAgICAgICAgICBzdTogc3UsXHJcbiAgICAgICAgICBpMThuSWQ6IGkxOG5JZFxyXG4gICAgICAgIH1cclxuICAgICAgfTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGV4cG9ydFBhcmFtID0ge1xyXG4gICAgICAgIGJvZHk6IHtcclxuICAgICAgICAgIGRhdGFFeGNoYW5nZU1vZGVsOiBKU09OLnN0cmluZ2lmeShtb2RlbCksXHJcbiAgICAgICAgICBjb21wb25lbnRzOiBjb21wb25lbnRzLFxyXG4gICAgICAgICAgc3VmZml4OiBzdWZmaXgsXHJcbiAgICAgICAgICBrZXlzOiBbJ0RhdGFFeHBvcnQnLCBtb2RlbFsnTWFpbk9iamVjdCddWydTb3VyY2UnXVsnU291cmNlTWV0YWRhdGFJRCddLCBkaW1lbnNpb25dLFxyXG4gICAgICAgICAgc3U6IHN1LFxyXG4gICAgICAgICAgaTE4bklkOiBpMThuSWRcclxuICAgICAgICB9XHJcbiAgICAgIH07XHJcbiAgICB9XHJcbiAgICBsZXQgc3ViamVjdDogT2JzZXJ2YWJsZTxhbnk+O1xyXG4gICAgaWYgKCFpc051bGxPclVuZGVmaW5lZCh0aGlzLmh0dHApKSB7XHJcbiAgICAgIHN1YmplY3QgPSB0aGlzLmh0dHAucG9zdChgJHt0aGlzLmN1c3RvbUV4cG9ydFVybH0vQWRkRXhwb3J0UnVsZWAsIGV4cG9ydFBhcmFtLmJvZHksIHtwYXJhbXM6IHtzdTogc3V9fSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBzdWJqZWN0ID0gYmVmUmVzdFNlcnZpY2UucmVxdWVzdChgJHt0aGlzLmN1c3RvbUV4cG9ydFVybH0vQWRkRXhwb3J0UnVsZWAsICdwb3N0Jywge3N1OiBzdX0sIGV4cG9ydFBhcmFtKTtcclxuICAgIH1cclxuICAgIHJldHVybiBzdWJqZWN0O1xyXG4gIH1cclxuXHJcbiAgLy8g5LiL6L295qih5p2/XHJcbiAgcHVibGljIERvd21sb2FkVGVtcGxhdGUobW9kZWw6IGFueSwgZnJhbWVDb250ZXh0OiBGcmFtZUNvbnRleHQsIGltcG9ydE9wdGlvbjogYW55KSB7XHJcbiAgICBjb25zdCBrZXlzID0gWydEYXRhSW1wb3J0JywgbW9kZWxbJ01haW5PYmplY3QnXVsnU291cmNlJ11bJ1NvdXJjZU1ldGFkYXRhSUQnXSwgaW1wb3J0T3B0aW9uLmRpbWVuc2lvbl07XHJcbiAgICBjb25zdCBiZWZSZXN0U2VydmljZSA9IERhdGFJRVV0aWxzLkdldEJlZlJlc3RTZXJ2aWNlKGZyYW1lQ29udGV4dC5yZXBvc2l0b3J5KTtcclxuICAgIGNvbnN0IHRlbXBVcmwgPSBEYXRhSUVVdGlscy5HZXRQcmVVcmwoYmVmUmVzdFNlcnZpY2UuYmFzZVVyaSk7XHJcbiAgICBjb25zdCBzdSA9IERhdGFJRVV0aWxzLmdldFN1KHRlbXBVcmwpO1xyXG4gICAgY29uc3QgdGVtcGxhdGVQYXJhbSA9IHtcclxuICAgICAgYm9keToge1xyXG4gICAgICAgIGtleXM6IGtleXMsXHJcbiAgICAgICAgc3U6IHN1XHJcbiAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgY29uc3Qgc3ViamVjdCA9IGJlZlJlc3RTZXJ2aWNlLnJlcXVlc3QoYCR7dGhpcy5jdXN0b21JbXBvcnRVcmx9L1RlbXBsYXRlRG93bmxvYWRgLCAncG9zdCcsIHtzdTogc3V9LCB0ZW1wbGF0ZVBhcmFtKTtcclxuICAgIHN1YmplY3Quc3Vic2NyaWJlKGRhdGEgPT4ge1xyXG4gICAgICBpZiAoZGF0YVsnc3VjY2VzcyddID09PSB0cnVlKSB7XHJcbiAgICAgICAgbGV0IGZpbGVuYW1lID0gZGF0YVsnZmlsZU5hbWUnXTtcclxuICAgICAgICBpZiAoaW1wb3J0T3B0aW9uICE9PSBudWxsICYmIGltcG9ydE9wdGlvblsndGVtcGxhdGVmaWxlbmFtZSddICE9PSBudWxsICYmIGltcG9ydE9wdGlvblsndGVtcGxhdGVmaWxlbmFtZSddICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgIGNvbnN0IHN1ZmZpeEluZGV4ID0gZmlsZW5hbWUubGFzdEluZGV4T2YoJy4nKTtcclxuICAgICAgICAgIGNvbnN0IHN1ZmZpeCA9IGZpbGVuYW1lLnN1YnN0cmluZyhzdWZmaXhJbmRleCk7XHJcbiAgICAgICAgICBmaWxlbmFtZSA9IGltcG9ydE9wdGlvblsndGVtcGxhdGVmaWxlbmFtZSddICsgc3VmZml4O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgcHJlVXJsID0gRGF0YUlFVXRpbHMuR2V0UHJlVXJsKGJlZlJlc3RTZXJ2aWNlLmJhc2VVcmkpO1xyXG4gICAgICAgIHRoaXMub3BlcmF0ZVNlcnZpY2UuRG93bmxvYWRGaWxlKGRhdGFbJ3JlbGF0aXZlUGF0aCddLCBmaWxlbmFtZSwgcHJlVXJsLCBpbXBvcnRPcHRpb24pO1xyXG4gICAgICAgIGNvbnN0IHN1YnNjcmlwdGlvbiA9IHRoaXMub3BlcmF0ZVNlcnZpY2UuZG93bmxvYWRDb21wbGV0ZS5zdWJzY3JpYmUocmVzdWx0ID0+IHtcclxuICAgICAgICAgIGlmIChyZXN1bHQgPT09ICcnKSB7XHJcbiAgICAgICAgICAgIHRoaXMuY29tcGxldGUuZW1pdCgnJyk7XHJcbiAgICAgICAgICAgIHN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xyXG4gICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5jb21wbGV0ZS5lbWl0KHJlc3VsdCk7XHJcbiAgICAgICAgICAgIHN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHRoaXMuY29tcGxldGUuZW1pdChkYXRhWydtZXNzYWdlJ10pO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBHZXRJbXBvcnRSdWxlTW9kZWwoa2V5czogc3RyaW5nW10sIHJlcG9zaXRvcnk6IFJlcG9zaXRvcnk8YW55PiwgaTE4bklkOiBzdHJpbmcsIG1vZGVsOiBhbnkpIHtcclxuICAgIGNvbnN0IGJlZlJlc3RTZXJ2aWNlID0gRGF0YUlFVXRpbHMuR2V0QmVmUmVzdFNlcnZpY2UocmVwb3NpdG9yeSk7XHJcbiAgICBjb25zdCB0ZW1wVXJsID0gRGF0YUlFVXRpbHMuR2V0UHJlVXJsKGJlZlJlc3RTZXJ2aWNlLmJhc2VVcmkpO1xyXG4gICAgY29uc3Qgc3UgPSBEYXRhSUVVdGlscy5nZXRTdSh0ZW1wVXJsKTtcclxuICAgIGNvbnN0IHBhcmFtcyA9IHtcclxuICAgICAgYm9keToge1xyXG4gICAgICAgIGtleXM6IGtleXMsXHJcbiAgICAgICAgc3U6IHN1LFxyXG4gICAgICAgIGkxOG5JZDogaTE4bklkLFxyXG4gICAgICAgIG5lZWRJMThuTW9kZWw6IEpTT04uc3RyaW5naWZ5KG1vZGVsKVxyXG4gICAgICB9XHJcbiAgICB9O1xyXG4gICAgbGV0IHN1YmplY3Q6IE9ic2VydmFibGU8YW55PjtcclxuICAgIGlmICghaXNOdWxsT3JVbmRlZmluZWQodGhpcy5odHRwKSkge1xyXG4gICAgICBzdWJqZWN0ID0gdGhpcy5odHRwLnBvc3QoYCR7dGhpcy5jdXN0b21JbXBvcnRVcmx9L0dldEltcG9ydE1vZGVsYCwgcGFyYW1zLmJvZHksIHtwYXJhbXM6IHtzdTogc3V9fSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBzdWJqZWN0ID0gYmVmUmVzdFNlcnZpY2UucmVxdWVzdChgJHt0aGlzLmN1c3RvbUltcG9ydFVybH0vR2V0SW1wb3J0TW9kZWxgLCAncG9zdCcsIHtzdTogc3V9LCBwYXJhbXMpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHN1YmplY3Q7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgR2V0RXhwb3J0UnVsZU1vZGVsKGtleXM6IHN0cmluZ1tdLCByZXBvc2l0b3J5OiBSZXBvc2l0b3J5PGFueT4sIGkxOG5JZDogc3RyaW5nLCBtb2RlbDogYW55KSB7XHJcbiAgICBjb25zdCBiZWZSZXN0U2VydmljZSA9IERhdGFJRVV0aWxzLkdldEJlZlJlc3RTZXJ2aWNlKHJlcG9zaXRvcnkpO1xyXG4gICAgY29uc3QgdGVtcFVybCA9IERhdGFJRVV0aWxzLkdldFByZVVybChiZWZSZXN0U2VydmljZS5iYXNlVXJpKTtcclxuICAgIGNvbnN0IHN1ID0gRGF0YUlFVXRpbHMuZ2V0U3UodGVtcFVybCk7XHJcbiAgICBjb25zdCBwYXJhbXMgPSB7XHJcbiAgICAgIGJvZHk6IHtcclxuICAgICAgICBrZXlzOiBrZXlzLFxyXG4gICAgICAgIHN1OiBzdSxcclxuICAgICAgICBpMThuSWQ6IGkxOG5JZCxcclxuICAgICAgICBuZWVkSTE4bk1vZGVsOiBKU09OLnN0cmluZ2lmeShtb2RlbClcclxuICAgICAgfVxyXG4gICAgfTtcclxuICAgIGxldCBzdWJqZWN0OiBPYnNlcnZhYmxlPGFueT47XHJcbiAgICBpZiAoIWlzTnVsbE9yVW5kZWZpbmVkKHRoaXMuaHR0cCkpIHtcclxuICAgICAgc3ViamVjdCA9IHRoaXMuaHR0cC5wb3N0KGAke3RoaXMuY3VzdG9tRXhwb3J0VXJsfS9HZXRFeHBvcnRNb2RlbGAsIHBhcmFtcy5ib2R5LCB7cGFyYW1zOiB7c3U6IHN1fX0pO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgc3ViamVjdCA9IGJlZlJlc3RTZXJ2aWNlLnJlcXVlc3QoYCR7dGhpcy5jdXN0b21FeHBvcnRVcmx9L0dldEV4cG9ydE1vZGVsYCwgJ3Bvc3QnLCB7c3U6IHN1fSwgcGFyYW1zKTtcclxuICAgIH1cclxuICAgIHJldHVybiBzdWJqZWN0O1xyXG4gIH1cclxuXHJcbiAgcHVibGljIEltcG9ydEJ5UnVsZShjb21tb25QYXJhbXM6IENvbW1vblBhcmFtcykge1xyXG4gICAgY29uc3QgcmVwb3NpdG9yeSA9IGNvbW1vblBhcmFtcy5yZXBvc2l0b3J5O1xyXG4gICAgY29uc3Qgb3B0aW9uID0gY29tbW9uUGFyYW1zLm9wdGlvbjtcclxuICAgIGNvbnN0IGtleXMgPSBjb21tb25QYXJhbXMua2V5cztcclxuICAgIGNvbnN0IGZpbGVOYW1lID0gY29tbW9uUGFyYW1zLmZpbGVOYW1lO1xyXG4gICAgY29uc3QgYmVmUmVzdFNlcnZpY2UgPSBEYXRhSUVVdGlscy5HZXRCZWZSZXN0U2VydmljZShyZXBvc2l0b3J5KTtcclxuICAgIGxldCBnbG9iYWxWYXIgPSAnJztcclxuICAgIGlmIChvcHRpb24gIT09IG51bGwgJiYgb3B0aW9uWydHbG9iYWxQYXJhbSddICE9PSBudWxsICYmIG9wdGlvblsnR2xvYmFsUGFyYW0nXSAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgIGdsb2JhbFZhciA9IEpTT04uc3RyaW5naWZ5KG9wdGlvblsnR2xvYmFsUGFyYW0nXSk7XHJcbiAgICB9XHJcbiAgICBjb25zdCBmdW5jSWQgPSBnZXRRdWVyeVN0cmluZygnZnVuY0lkJyk7XHJcbiAgICBjb25zdCBpbXBvcnRQYXJhbSA9IHtcclxuICAgICAgYm9keToge1xyXG4gICAgICAgIGRhdGFJbXBvcnRDb250ZXh0OiB7XHJcbiAgICAgICAgICBLZXlzOiBrZXlzLFxyXG4gICAgICAgICAgRmlsZU5hbWU6IGZpbGVOYW1lLFxyXG4gICAgICAgICAgR2xvYmFsUGFyYW06IGdsb2JhbFZhcixcclxuICAgICAgICAgIGZ1bmNJZDogZnVuY0lkXHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9O1xyXG4gICAgY29tbW9uUGFyYW1zLmJlZlJlc3RTZXJ2aWNlID0gYmVmUmVzdFNlcnZpY2U7XHJcbiAgICBjb21tb25QYXJhbXMuaW1wb3J0UGFyYW0gPSBpbXBvcnRQYXJhbTtcclxuICAgIGNvbW1vblBhcmFtcy5tYWluT2JqSWQgPSAnJztcclxuICAgIHRoaXMuaW1wb3J0U2VydmljZS5JbXBvcnQoY29tbW9uUGFyYW1zKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBJbXBvcnRTdWJUYWJsZUJ5UnVsZShjb21tb25QYXJhbXM6IENvbW1vblBhcmFtcyk6IGJvb2xlYW4ge1xyXG4gICAgY29uc3QgcmVwb3NpdG9yeSA9IGNvbW1vblBhcmFtcy5yZXBvc2l0b3J5O1xyXG4gICAgY29uc3Qgb3B0aW9uID0gY29tbW9uUGFyYW1zLm9wdGlvbjtcclxuICAgIGNvbnN0IGtleXMgPSBjb21tb25QYXJhbXMua2V5cztcclxuICAgIGNvbnN0IGZpbGVOYW1lID0gY29tbW9uUGFyYW1zLmZpbGVOYW1lO1xyXG4gICAgY29uc3QgZnJhbWVDb250ZXh0ID0gY29tbW9uUGFyYW1zLmZyYW1lQ29udGV4dDtcclxuICAgIGNvbnN0IGJlZlJlc3RTZXJ2aWNlID0gRGF0YUlFVXRpbHMuR2V0QmVmUmVzdFNlcnZpY2UocmVwb3NpdG9yeSk7XHJcbiAgICBsZXQgZ2xvYmFsVmFyID0gJyc7XHJcbiAgICBpZiAob3B0aW9uICE9PSBudWxsICYmIG9wdGlvblsnR2xvYmFsUGFyYW0nXSAhPT0gbnVsbCAmJiBvcHRpb25bJ0dsb2JhbFBhcmFtJ10gIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICBnbG9iYWxWYXIgPSBKU09OLnN0cmluZ2lmeShvcHRpb25bJ0dsb2JhbFBhcmFtJ10pO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChmcmFtZUNvbnRleHQuYmluZGluZ0RhdGEubGlzdC5jdXJyZW50SWQgPT09ICcnIHx8IGZyYW1lQ29udGV4dC5iaW5kaW5nRGF0YS5saXN0LmN1cnJlbnRJZCA9PT0gbnVsbCkge1xyXG4gICAgICB0aGlzLm5vdGlmeS5pbmZvKHRoaXMuaTE4blJlc291cmNlWydtYXN0ZXJfdGFibGVfbm9pZCddKTtcclxuICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgY29uc3QgZnVuY0lkID0gZ2V0UXVlcnlTdHJpbmcoJ2Z1bmNJZCcpO1xyXG4gICAgICBjb25zdCBpbXBvcnRQYXJhbSA9IHtcclxuICAgICAgICBib2R5OiB7XHJcbiAgICAgICAgICBkYXRhSW1wb3J0Q29udGV4dDoge1xyXG4gICAgICAgICAgICBLZXlzOiBrZXlzLFxyXG4gICAgICAgICAgICBGaWxlTmFtZTogZmlsZU5hbWUsXHJcbiAgICAgICAgICAgIE1haW5PYmpJZDogZnJhbWVDb250ZXh0LmJpbmRpbmdEYXRhLmxpc3QuY3VycmVudElkLFxyXG4gICAgICAgICAgICBHbG9iYWxQYXJhbTogZ2xvYmFsVmFyLFxyXG4gICAgICAgICAgICBmdW5jSWQ6IGZ1bmNJZFxyXG4gICAgICAgICAgfSxcclxuICAgICAgICAgIHJlcXVlc3RJbmZvOiBiZWZSZXN0U2VydmljZS5idWlsZFJlcXVlc3RJbmZvKClcclxuICAgICAgICB9XHJcbiAgICAgIH07XHJcbiAgICAgIGNvbW1vblBhcmFtcy5iZWZSZXN0U2VydmljZSA9IGJlZlJlc3RTZXJ2aWNlO1xyXG4gICAgICBjb21tb25QYXJhbXMuaW1wb3J0UGFyYW0gPSBpbXBvcnRQYXJhbTtcclxuICAgICAgY29tbW9uUGFyYW1zLm1haW5PYmpJZCA9IGZyYW1lQ29udGV4dC5iaW5kaW5nRGF0YS5saXN0LmN1cnJlbnRJZDtcclxuICAgICAgdGhpcy5pbXBvcnRTZXJ2aWNlLkltcG9ydChjb21tb25QYXJhbXMpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHVibGljIEV4cG9ydEJ5UnVsZShrZXlzOiBhbnlbXSwgZmlsdGVyOiBhbnksIG9wdGlvbjogYW55LCBmcmFtZUNvbnRleHQ6IEZyYW1lQ29udGV4dCkge1xyXG4gICAgY29uc3QgYmVmUmVzdFNlcnZpY2UgPSBEYXRhSUVVdGlscy5HZXRCZWZSZXN0U2VydmljZShmcmFtZUNvbnRleHQucmVwb3NpdG9yeSk7XHJcbiAgICBjb25zdCBmdW5jSWQgPSBnZXRRdWVyeVN0cmluZygnZnVuY0lkJyk7XHJcblxyXG4gICAgY29uc3QgbmV3RmlsdGVycyA9IFtdO1xyXG5cclxuICAgIGNvbnN0IHNlbGVjdEZpbHRlckdyaWRDb21wb25lbnQgPSBvcHRpb25bJ3NlbGVjdEZpbHRlckdyaWRDb21wb25lbnQnXTtcclxuICAgIGlmICghaXNOdWxsT3JVbmRlZmluZWQoc2VsZWN0RmlsdGVyR3JpZENvbXBvbmVudCkgJiYgIWlzTnVsbE9yRW1wdHkoc2VsZWN0RmlsdGVyR3JpZENvbXBvbmVudCkpIHtcclxuICAgICAgY29uc3QgaWRzID0gZnJhbWVDb250ZXh0LmFwcENvbnRleHQuZnJhbWVDb250ZXh0TWFuYWdlci5nZXRGcmFtZUNvbnRleHRCeUlkKHNlbGVjdEZpbHRlckdyaWRDb21wb25lbnQpLnVpU3RhdGVbJ2lkcyddO1xyXG4gICAgICBpZiAoIWlzTnVsbE9yVW5kZWZpbmVkKGlkcykgJiYgaWRzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICBsZXQgaWRzU3RyID0gJyc7XHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBpZHMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgIGNvbnN0IGlkID0gaWRzW2ldO1xyXG4gICAgICAgICAgaWYgKGkgPT09IGlkcy5sZW5ndGggLSAxKSB7XHJcbiAgICAgICAgICAgIGlkc1N0ciArPSBpZDtcclxuICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGlkc1N0ciArPSBpZCArICdcXHJcXG4nO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCBzZWxlY3RJZEZpbHRlckNvbmRpdGlvbiA9IHtcclxuICAgICAgICAgIEZpbHRlckZpZWxkOiBcIklEXCIsXHJcbiAgICAgICAgICBDb21wYXJlOiAxNCxcclxuICAgICAgICAgIFZhbHVlOiBpZHNTdHIsXHJcbiAgICAgICAgICBSZWxhdGlvbjogMSxcclxuICAgICAgICAgIEV4cHJlc3N0eXBlOiAwXHJcbiAgICAgICAgfVxyXG4gICAgICAgIG5ld0ZpbHRlcnMucHVzaChzZWxlY3RJZEZpbHRlckNvbmRpdGlvbik7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgdGhpcy5ub3RpZnkuaW5mbyh0aGlzLmkxOG5SZXNvdXJjZVsnc2VsZWN0LWRhdGEtZXhwb3J0J10pO1xyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGlmIChvcHRpb25bJ2VuYWJsZVNjcmVlbmluZ1NjaGVtZSddID09PSB0cnVlKSB7XHJcbiAgICAgIGNvbnN0IGZpbHRlckNvbmRpdGlvbkxpc3QgPSBmcmFtZUNvbnRleHQudWlTdGF0ZVsnZmlsdGVyQ29uZGl0aW9uTGlzdCddO1xyXG4gICAgICBpZiAoZmlsdGVyQ29uZGl0aW9uTGlzdCAhPT0gdW5kZWZpbmVkICYmIGZpbHRlckNvbmRpdGlvbkxpc3QgIT09IG51bGwgJiYgZmlsdGVyQ29uZGl0aW9uTGlzdCAhPT0gJycgJiYgZmlsdGVyQ29uZGl0aW9uTGlzdCAhPT0gJ1tdJykge1xyXG4gICAgICAgIGxldCBmaWx0ZXJDb25kaXRpb25MaXN0SnNvbjtcclxuICAgICAgICBpZiAodHlwZW9mIChmaWx0ZXJDb25kaXRpb25MaXN0KSA9PT0gJ3N0cmluZycpIHtcclxuICAgICAgICAgIGZpbHRlckNvbmRpdGlvbkxpc3RKc29uID0gSlNPTi5wYXJzZShmaWx0ZXJDb25kaXRpb25MaXN0KTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgZmlsdGVyQ29uZGl0aW9uTGlzdEpzb24gPSBmaWx0ZXJDb25kaXRpb25MaXN0O1xyXG4gICAgICAgIH1cclxuICAgICAgICBmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4IDwgZmlsdGVyQ29uZGl0aW9uTGlzdEpzb24ubGVuZ3RoOyBpbmRleCsrKSB7XHJcbiAgICAgICAgICBjb25zdCBlbGVtZW50ID0gZmlsdGVyQ29uZGl0aW9uTGlzdEpzb25baW5kZXhdO1xyXG4gICAgICAgICAgY29uc3QgdmFsdWUgPSBkZWNvZGVVUklDb21wb25lbnQoZWxlbWVudC5WYWx1ZSk7XHJcblxyXG4gICAgICAgICAgZWxlbWVudC5WYWx1ZSA9IHZhbHVlO1xyXG4gICAgICAgICAgbmV3RmlsdGVycy5wdXNoKGVsZW1lbnQpO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgaWYgKG5ld0ZpbHRlcnMubGVuZ3RoID4gMCkge1xyXG4gICAgICBpZiAoIWlzTnVsbE9yVW5kZWZpbmVkKGZpbHRlcikgJiYgZmlsdGVyLkZpbHRlckNvbmRpdGlvbnMgIT09IG51bGwpIHtcclxuICAgICAgICBmaWx0ZXIuRmlsdGVyQ29uZGl0aW9ucyA9IG5ld0ZpbHRlcnMuY29uY2F0KGZpbHRlci5GaWx0ZXJDb25kaXRpb25zKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBpZiAoaXNOdWxsT3JVbmRlZmluZWQoZmlsdGVyKSkge1xyXG4gICAgICAgICAgZmlsdGVyID0ge307XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGZpbHRlclsnRmlsdGVyQ29uZGl0aW9ucyddID0gbmV3RmlsdGVycztcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgaWYgKCFpc051bGxPclVuZGVmaW5lZChmaWx0ZXIpICYmICFpc051bGxPclVuZGVmaW5lZChmaWx0ZXIuRmlsdGVyQ29uZGl0aW9ucykpIHtcclxuICAgICAgLy/noa7kv53mnIDlkI7kuIDkuKrlhbPns7vkuLrnqbpcclxuICAgICAgZmlsdGVyLkZpbHRlckNvbmRpdGlvbnNbZmlsdGVyLkZpbHRlckNvbmRpdGlvbnMubGVuZ3RoIC0gMV0uUmVsYXRpb24gPSAwO1xyXG4gICAgfVxyXG4gICAgY29uc3QgZXhwb3J0UGFyYW0gPSB7XHJcbiAgICAgIGJvZHk6IHtcclxuICAgICAgICBleHBvcnRDb250ZXh0OiB7XHJcbiAgICAgICAgICBGaWx0ZXI6IGZpbHRlcixcclxuICAgICAgICAgIEtleXM6IGtleXMsXHJcbiAgICAgICAgICBHbG9iYWxQYXJhbTogJycsXHJcbiAgICAgICAgICBmdW5jSWQ6IGZ1bmNJZFxyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfTtcclxuICAgIHRoaXMubG9hZGluZ1NlcnZpY2Uuc2hvdygpO1xyXG4gICAgY29uc3Qgc3ViamVjdCA9IGJlZlJlc3RTZXJ2aWNlLnJlcXVlc3QoYCR7YmVmUmVzdFNlcnZpY2UuYmFzZVVyaX0vc2VydmljZS9kYXRhZXhwb3J0dm1hY3Rpb25gLCAncHV0JywgbnVsbCwgZXhwb3J0UGFyYW0pO1xyXG4gICAgc3ViamVjdC5zdWJzY3JpYmUoZGF0YSA9PiB7XHJcbiAgICAgIGlmIChkYXRhID09PSBudWxsKSB7XHJcbiAgICAgICAgLy8gdGhpcy5leHBvcnQuZW1pdChmYWxzZSk7XHJcbiAgICAgICAgdGhpcy5ub3RpZnkuaW5mbygn5pWw5o2u5a+85Ye65aSx6LSl77yBXFxuIOWksei0peWOn+WboO+8muacjeWKoeerr+WTjeW6lOW8guW4uO+8jOivt+ajgOafpScpO1xyXG4gICAgICB9XHJcbiAgICAgIGxldCBleHBvcnRSZXN1bHQgPSBkYXRhLnJldHVyblZhbHVlIGFzIERhdGFJRVJlc3VsdDtcclxuICAgICAgaWYgKGlzTnVsbE9yVW5kZWZpbmVkKGV4cG9ydFJlc3VsdCkpIHtcclxuICAgICAgICBleHBvcnRSZXN1bHQgPSBkYXRhIGFzIERhdGFJRVJlc3VsdDtcclxuICAgICAgfVxyXG4gICAgICBsZXQgZmlsZU5hbWUgPSBleHBvcnRSZXN1bHQuZmlsZU5hbWU7XHJcbiAgICAgIGlmIChvcHRpb24gIT09IG51bGwgJiYgb3B0aW9uWydjdXN0b21maWxlbmFtZSddICE9PSBudWxsICYmIG9wdGlvblsnY3VzdG9tZmlsZW5hbWUnXSAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgY29uc3Qgc3VmZml4SW5kZXggPSBmaWxlTmFtZS5sYXN0SW5kZXhPZignLicpO1xyXG4gICAgICAgIGNvbnN0IHN1ZmZpeCA9IGZpbGVOYW1lLnN1YnN0cmluZyhzdWZmaXhJbmRleCk7XHJcbiAgICAgICAgZmlsZU5hbWUgPSBvcHRpb25bJ2N1c3RvbWZpbGVuYW1lJ10gKyBzdWZmaXg7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKGV4cG9ydFJlc3VsdC5zdWNjZWVkID09PSB0cnVlKSB7XHJcbiAgICAgICAgY29uc3QgcHJlVXJsID0gRGF0YUlFVXRpbHMuR2V0UHJlVXJsKGJlZlJlc3RTZXJ2aWNlLmJhc2VVcmkpO1xyXG4gICAgICAgIHRoaXMub3BlcmF0ZVNlcnZpY2UuRG93bmxvYWRGaWxlKGV4cG9ydFJlc3VsdC5yZWxhdGl2ZVBhdGgsIGZpbGVOYW1lLCBwcmVVcmwsIG9wdGlvbik7XHJcbiAgICAgICAgY29uc3Qgc3Vic2NyaWJlciA9IHRoaXMub3BlcmF0ZVNlcnZpY2UuZG93bmxvYWRDb21wbGV0ZS5zdWJzY3JpYmUocmVzdWx0ID0+IHtcclxuICAgICAgICAgIHRoaXMubG9hZGluZ1NlcnZpY2UuY2xlYXJBbGwoKTtcclxuICAgICAgICAgIGlmIChyZXN1bHQgPT09ICcnKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZXhwb3J0LmVtaXQoJycpO1xyXG4gICAgICAgICAgICBzdWJzY3JpYmVyLnVuc3Vic2NyaWJlKCk7XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLmV4cG9ydC5lbWl0KHJlc3VsdCk7XHJcbiAgICAgICAgICAgIHN1YnNjcmliZXIudW5zdWJzY3JpYmUoKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICB0aGlzLmxvYWRpbmdTZXJ2aWNlLmNsZWFyQWxsKCk7XHJcbiAgICAgICAgdGhpcy5lcnJvcmxldmVsID0gZXhwb3J0UmVzdWx0LmVycm9yTGV2ZWw7XHJcbiAgICAgICAgdGhpcy5leHBvcnQuZW1pdChleHBvcnRSZXN1bHQubWVzc2FnZSk7XHJcbiAgICAgICAgLy8gdGhpcy5ub3RpZnkuZXJyb3IoJ+aVsOaNruWvvOWHuuWksei0pe+8gVxcbiDlpLHotKXljp/lm6DvvJonICsgZXhwb3J0UmVzdWx0Lm1lc3NhZ2UpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcbn1cclxuIl19
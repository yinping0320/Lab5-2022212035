/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, ComponentFactoryResolver, EventEmitter, Injector, Input, Output, TemplateRef, ViewChild } from '@angular/core';
import { DataExportService } from '../service/DataIEService/data-export.service';
import { NotifyService } from '@farris/ui-notify';
import { BindingData, FrameContext } from '@farris/devkit';
import { EntityListService } from '@farris/command-services';
import { HttpClient } from '@angular/common/http';
import { DataIEUtils, FileTypeUtil } from '../service/Utils/DataIEUtils';
import { LoadingService } from '@farris/ui-loading';
import { BsModalService } from '@farris/ui-modal';
import { RuleSelectComponent } from '../rule-select/rule-select.component';
import { FileConst } from '../model/utils/FileConst';
import { MethodType } from '../model/DataIEType/MethodType';
//自选文件类型导出
export class ExportCustomSelectComponent {
    /**
     * @param {?} dataExportService
     * @param {?} notify
     * @param {?} entityService
     * @param {?} http
     * @param {?} loadingService
     * @param {?} injector
     * @param {?} modalService
     * @param {?} resolver
     */
    constructor(dataExportService, notify, entityService, http, loadingService, injector, modalService, resolver) {
        this.dataExportService = dataExportService;
        this.notify = notify;
        this.entityService = entityService;
        this.http = http;
        this.loadingService = loadingService;
        this.injector = injector;
        this.modalService = modalService;
        this.resolver = resolver;
        this.ruleId = '';
        this.frameContext = null;
        this.subject = null;
        this.exportOption = null;
        this.needDestroy = new EventEmitter();
        this.enableRuntimeCustom = false;
        // 记录的规则
        this.recordRule = null;
        this.currentRuleName = '';
        this.currentRuleId = '';
        this.currentRuleFileType = '';
        this.lookupIcon = '<i class="f-icon f-icon-windows"></i>';
        this.loadingComp = null;
        this.fileListItems = [
            { id: FileConst.xls, label: FileConst.xls },
            { id: FileConst.xlsx, label: FileConst.xlsx },
            { id: FileConst.xlsm, label: FileConst.xlsm },
            { id: FileConst.et, label: FileConst.et },
        ];
        DataIEUtils.getTranslateValue(http).subscribe((/**
         * @param {?} res
         * @return {?}
         */
        res => {
            this.export_success = res['export_success'];
            this.export_fail = res['export_fail'];
            this.file_type = res['file_type'];
            this.ie_cancel = res['ie_cancel'];
            this.ie_ok = res['ie_ok'];
            this.rule_list = res['rule_list'];
            this.i18nResource = res;
        }));
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.currentRuleId = this.recordRule.ruleId;
        this.currentRuleName = this.recordRule.ruleName;
        this.valueField = FileTypeUtil.getFileTypeName(this.recordRule.fileType);
        this.currentRuleFileType = this.valueField;
        if (this.exportOption.enableRuntimeCustom === true) {
            this.enableRuntimeCustom = true;
        }
    }
    /**
     * @param {?} $event
     * @return {?}
     */
    openSelectRule($event) {
        this.loadingComp = this.loadingService.show();
        //过滤规则时用表单命令处配置的规则来过滤，因此用ruleId，而不是currentRuleId
        /** @type {?} */
        const url = '/api/runtime/dip/v1.0/dataIeRuleManage/filterRulesByRuleIdAndVoId';
        /** @type {?} */
        const body = {
            ruleId: this.ruleId,
            ruleType: 1,
            voId: this.exportOption.voId,
            methodType: this.methodType,
            exportChildNodeCode: this.exportOption.exportChildNodeCode
        };
        this.http.post(url, body).subscribe((/**
         * @param {?} RuleMgrs
         * @return {?}
         */
        (RuleMgrs) => {
            this.loadingService.clearAll();
            if (RuleMgrs.length === 0) {
                this.notify.info(this.i18nResource['ruleselect_listempty']);
                return;
            }
            /** @type {?} */
            const compFactory = this.resolver.resolveComponentFactory(RuleSelectComponent);
            /** @type {?} */
            const compRef = compFactory.create(this.injector);
            compRef.instance.ruleId = this.ruleId;
            compRef.instance.voId = this.exportOption.voId;
            compRef.instance.ruleType = 1;
            compRef.instance.RuleMgrsData = RuleMgrs;
            /** @type {?} */
            const modalConfig = {
                title: this.rule_list,
                width: 950,
                height: 500,
                buttons: compRef.instance.modalFooter,
                showHeader: true,
                showMaxButton: false,
                showButtons: true
            };
            /** @type {?} */
            const dialog = this.modalService.show(compRef, modalConfig);
            compRef.instance.closeModal.subscribe((/**
             * @return {?}
             */
            () => {
                dialog.close();
            }));
            compRef.instance.okModal.subscribe((/**
             * @param {?} RuleMgr
             * @return {?}
             */
            RuleMgr => {
                this.currentRuleId = RuleMgr.id;
                this.currentRuleName = RuleMgr.name;
                this.valueField = FileTypeUtil.getFileTypeName(RuleMgr.fileType);
                this.currentRuleFileType = this.valueField;
                dialog.close();
            }));
        }), (/**
         * @param {?} error
         * @return {?}
         */
        error => {
            this.loadingService.clearAll();
            this.notify.error(error.error.Message);
            console.log(error.error.Message);
        }));
    }
    /**
     * @return {?}
     */
    Ok() {
        /** @type {?} */
        let suffix = null;
        if (this.valueField !== this.currentRuleFileType) {
            suffix = FileTypeUtil.getFileExtension(this.valueField);
        }
        switch (this.methodType) {
            case MethodType.CommonExport:
                this.dataExportService.ExportById(this.currentRuleId, this.frameContext, this.exportOption, suffix);
                this.exportComplete();
                break;
            case MethodType.ExportCurrentTableData:
                this.dataExportService.ExportCurrentData(this.currentRuleId, this.frameContext, this.entityService.pageIndex, this.entityService.pageSize, this.exportOption, suffix);
                this.exportComplete();
                break;
            case MethodType.ExportCurrentChildData:
                this.dataExportService.ExportCurrentChildData(this.currentRuleId, this.frameContext, this.exportOption, suffix);
                this.exportComplete();
                break;
        }
    }
    /**
     * @return {?}
     */
    exportComplete() {
        /** @type {?} */
        const exportUnscribe = this.dataExportService.export.subscribe((/**
         * @param {?} data
         * @return {?}
         */
        data => {
            if (data === '') {
                this.notify.success(this.export_success);
                exportUnscribe.unsubscribe();
                this.subject.next(true);
                this.subject.complete();
            }
            else {
                /** @type {?} */
                const errorlevel = this.dataExportService.errorlevel;
                if (errorlevel === 'Info') {
                    this.notify.info(data);
                }
                else if (errorlevel === 'Warning') {
                    this.notify.warning(data);
                }
                else {
                    this.notify.error(this.export_fail + data);
                }
                exportUnscribe.unsubscribe();
                this.subject.next(false);
                this.subject.complete();
            }
            this.needDestroy.emit();
        }));
    }
    /**
     * @return {?}
     */
    canSelectFileType() {
        /** @type {?} */
        const suffix = FileTypeUtil.getFileExtension(this.valueField);
        /** @type {?} */
        const canList = ['.xls', '.xlsx', '.xlsm', '.et'];
        if (canList.findIndex((/**
         * @param {?} t
         * @return {?}
         */
        t => t === suffix)) < 0) {
            return false;
        }
        return true;
    }
    /**
     * @return {?}
     */
    close() {
        this.needDestroy.emit();
    }
    /**
     * @return {?}
     */
    Cancel() {
        this.needDestroy.emit(true);
    }
}
ExportCustomSelectComponent.decorators = [
    { type: Component, args: [{
                selector: 'app-export-custom-select',
                template: "<!-- <div class=\"d-flex flex-column\" style=\"width: 100%; height: 100%;\">\n    <div region=\"south\" class=\"south mgleft\">\n        <table>\n            <tr>\n                <td class=\"mkwidth\">\n                    <label> </label>\n                </td>\n            </tr>\n            <tr *ngIf=\"selectrule\">\n                <td class=\"mkwidth\">\n                    <label for=\"f_select_rule\">{{rule_list}}</label>\n                </td>\n                <td style=\"width: 430px;\">\n                    <input-group class=\"ng-untouched ng-pristine ng-valid\" [editable]=\"false\" [groupText]=\"lookupIcon\" [enableClear]=\"false\"\n                        [value]=\"currentRuleName\" (clickHandle)=\"openSelectRule($event)\">\n                    </input-group>\n                </td>\n            </tr>\n\n            <tr *ngIf=\"selectfiletype\">\n                <td class=\"mkwidth\">\n                    <label for=\"f_select_fileType\">{{file_type}}</label>\n                </td>\n                <td style=\"width: 430px;\">\n                    <farris-combo-list id=\"f_select_fileType\" [(ngModel)]=\"valueField\" [idField]=\"'id'\" [textField]=\"'label'\" [data]=\"fileListItems\"></farris-combo-list>\n                </td>\n            </tr>\n        </table>\n    </div>\n</div> -->\n\n<form class=\"px-3 px-md-4 farris-form d-flex flex-wrap\">\n    <div class=\"col-12\" style=\"margin-top: 72px\">\n        <div *ngIf=\"enableRuntimeCustom === true\" class=\"farris-group-wrap form-inline farris-form-inline\">\n            <div class=\"form-group farris-form-group\">\n                <label class=\" col-form-label\">\n                    <span class=\"farris-label-text\">{{rule_list}}</span>\n                </label>\n                <div class=\"farris-input-wrap\">\n                    <input-group class=\"ng-untouched ng-pristine ng-valid\" [editable]=\"false\" [groupText]=\"lookupIcon\" [enableClear]=\"false\"\n                        [value]=\"currentRuleName\" (clickHandle)=\"openSelectRule($event)\">\n                    </input-group>\n                </div>\n            </div>\n        </div>\n        <div *ngIf=\"enableRuntimeCustom === false\" class=\"farris-group-wrap form-inline farris-form-inline\">\n            <span>&nbsp;</span>\n        </div>\n        <div class=\"farris-group-wrap form-inline farris-form-inline\">\n            <div class=\"form-group farris-form-group\" style=\"width: 450px\">\n                <label class=\"col-form-label\">\n                    <span class=\"farris-label-text\">{{file_type}}</span>\n                </label>\n                <div class=\"farris-input-wrap\">\n                    <farris-combo-list [readonly]=\"canSelectFileType() === false\" id=\"f_select_fileType\" name=\"f_select_fileType\" [(ngModel)]=\"valueField\"\n                        [idField]=\"'id'\" [textField]=\"'label'\" [editable]=\"false\" [enableClear]=\"false\" [data]=\"fileListItems\"></farris-combo-list>\n                </div>\n                <span>&nbsp;&nbsp;</span>\n                <!-- <span *ngIf=\"enableRuntimeCustom === true\" class=\"f-icon f-icon-custom\" style=\"color: #388FFF;cursor: pointer;\"></span>\n                <span *ngIf=\"enableRuntimeCustom === false\" class=\"f-icon f-icon-custom\" style=\"color:white\"></span> -->\n                <span  class=\"f-icon f-icon-custom\" style=\"color:white\"></span>\n            </div>\n        </div>\n\n\n\n    </div>\n</form>\n\n<ng-template #selectFooter>\n    <button type=\"button\" class=\"btn btn-outline-secondary\" (click)=\"Cancel()\">{{ie_cancel}}</button>\n    <button type=\"button\" class=\"btn btn-primary\" (click)=\"Ok()\">{{ie_ok}}</button>\n</ng-template>",
                providers: [NotifyService, DataExportService, EntityListService, BindingData],
                styles: [".barmanager{position:absolute;bottom:0;height:50px;right:30px;padding-left:50px}#filePath,#fileType,#filterExpression{margin-left:7px}.input-group{margin-bottom:12px}.btngroup{margin-top:12px}.exchange{margin-top:30px}#IsSave{margin:6px}.pos{position:relative}.left{float:right}.mkwidth{width:75px;line-height:28px}.div-inline{display:inline}.mgleft{margin-left:20px;margin-top:10px}.longlen{width:400px}"]
            }] }
];
/** @nocollapse */
ExportCustomSelectComponent.ctorParameters = () => [
    { type: DataExportService },
    { type: NotifyService },
    { type: EntityListService },
    { type: HttpClient },
    { type: LoadingService },
    { type: Injector },
    { type: BsModalService },
    { type: ComponentFactoryResolver }
];
ExportCustomSelectComponent.propDecorators = {
    modalFooter: [{ type: ViewChild, args: ['selectFooter',] }],
    ruleId: [{ type: Input }],
    methodType: [{ type: Input }],
    frameContext: [{ type: Input }],
    exportOption: [{ type: Input }],
    needDestroy: [{ type: Output }]
};
if (false) {
    /** @type {?} */
    ExportCustomSelectComponent.prototype.modalFooter;
    /** @type {?} */
    ExportCustomSelectComponent.prototype.ruleId;
    /** @type {?} */
    ExportCustomSelectComponent.prototype.methodType;
    /** @type {?} */
    ExportCustomSelectComponent.prototype.frameContext;
    /** @type {?} */
    ExportCustomSelectComponent.prototype.subject;
    /** @type {?} */
    ExportCustomSelectComponent.prototype.exportOption;
    /** @type {?} */
    ExportCustomSelectComponent.prototype.needDestroy;
    /** @type {?} */
    ExportCustomSelectComponent.prototype.valueField;
    /** @type {?} */
    ExportCustomSelectComponent.prototype.enableRuntimeCustom;
    /** @type {?} */
    ExportCustomSelectComponent.prototype.recordRule;
    /** @type {?} */
    ExportCustomSelectComponent.prototype.currentRuleName;
    /** @type {?} */
    ExportCustomSelectComponent.prototype.currentRuleId;
    /** @type {?} */
    ExportCustomSelectComponent.prototype.currentRuleFileType;
    /** @type {?} */
    ExportCustomSelectComponent.prototype.lookupIcon;
    /** @type {?} */
    ExportCustomSelectComponent.prototype.loadingComp;
    /** @type {?} */
    ExportCustomSelectComponent.prototype.fileListItems;
    /** @type {?} */
    ExportCustomSelectComponent.prototype.file_type;
    /** @type {?} */
    ExportCustomSelectComponent.prototype.export_success;
    /** @type {?} */
    ExportCustomSelectComponent.prototype.export_fail;
    /** @type {?} */
    ExportCustomSelectComponent.prototype.ie_cancel;
    /** @type {?} */
    ExportCustomSelectComponent.prototype.ie_ok;
    /** @type {?} */
    ExportCustomSelectComponent.prototype.rule_list;
    /** @type {?} */
    ExportCustomSelectComponent.prototype.i18nResource;
    /**
     * @type {?}
     * @private
     */
    ExportCustomSelectComponent.prototype.dataExportService;
    /**
     * @type {?}
     * @private
     */
    ExportCustomSelectComponent.prototype.notify;
    /**
     * @type {?}
     * @private
     */
    ExportCustomSelectComponent.prototype.entityService;
    /**
     * @type {?}
     * @private
     */
    ExportCustomSelectComponent.prototype.http;
    /**
     * @type {?}
     * @private
     */
    ExportCustomSelectComponent.prototype.loadingService;
    /**
     * @type {?}
     * @private
     */
    ExportCustomSelectComponent.prototype.injector;
    /**
     * @type {?}
     * @private
     */
    ExportCustomSelectComponent.prototype.modalService;
    /**
     * @type {?}
     * @private
     */
    ExportCustomSelectComponent.prototype.resolver;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZXhwb3J0LWN1c3RvbS1zZWxlY3QuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGdzcC1kaXAvZGF0YS1pbXAtZXhwLyIsInNvdXJjZXMiOlsibGliL2V4cG9ydC1jdXN0b20tc2VsZWN0L2V4cG9ydC1jdXN0b20tc2VsZWN0LmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUNMLFNBQVMsRUFDVCx3QkFBd0IsRUFDeEIsWUFBWSxFQUNaLFFBQVEsRUFDUixLQUFLLEVBRUwsTUFBTSxFQUNOLFdBQVcsRUFDWCxTQUFTLEVBQ1YsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFDLGlCQUFpQixFQUFDLE1BQU0sOENBQThDLENBQUM7QUFDL0UsT0FBTyxFQUFDLGFBQWEsRUFBQyxNQUFNLG1CQUFtQixDQUFDO0FBQ2hELE9BQU8sRUFBQyxXQUFXLEVBQUUsWUFBWSxFQUFDLE1BQU0sZ0JBQWdCLENBQUM7QUFDekQsT0FBTyxFQUFDLGlCQUFpQixFQUFDLE1BQU0sMEJBQTBCLENBQUM7QUFDM0QsT0FBTyxFQUFDLFVBQVUsRUFBQyxNQUFNLHNCQUFzQixDQUFDO0FBQ2hELE9BQU8sRUFBQyxXQUFXLEVBQUUsWUFBWSxFQUFDLE1BQU0sOEJBQThCLENBQUM7QUFDdkUsT0FBTyxFQUFtQixjQUFjLEVBQUMsTUFBTSxvQkFBb0IsQ0FBQztBQUNwRSxPQUFPLEVBQUMsY0FBYyxFQUFDLE1BQU0sa0JBQWtCLENBQUM7QUFDaEQsT0FBTyxFQUFDLG1CQUFtQixFQUFDLE1BQU0sc0NBQXNDLENBQUM7QUFFekUsT0FBTyxFQUFDLFNBQVMsRUFBQyxNQUFNLDBCQUEwQixDQUFDO0FBQ25ELE9BQU8sRUFBQyxVQUFVLEVBQUMsTUFBTSxnQ0FBZ0MsQ0FBQztBQVExRCxVQUFVO0FBQ1YsTUFBTSxPQUFPLDJCQUEyQjs7Ozs7Ozs7Ozs7SUErQ3RDLFlBQ1UsaUJBQW9DLEVBQ3BDLE1BQXFCLEVBQ3JCLGFBQWdDLEVBQ2hDLElBQWdCLEVBQ2hCLGNBQThCLEVBQzlCLFFBQWtCLEVBQ2xCLFlBQTRCLEVBQzVCLFFBQWtDO1FBUGxDLHNCQUFpQixHQUFqQixpQkFBaUIsQ0FBbUI7UUFDcEMsV0FBTSxHQUFOLE1BQU0sQ0FBZTtRQUNyQixrQkFBYSxHQUFiLGFBQWEsQ0FBbUI7UUFDaEMsU0FBSSxHQUFKLElBQUksQ0FBWTtRQUNoQixtQkFBYyxHQUFkLGNBQWMsQ0FBZ0I7UUFDOUIsYUFBUSxHQUFSLFFBQVEsQ0FBVTtRQUNsQixpQkFBWSxHQUFaLFlBQVksQ0FBZ0I7UUFDNUIsYUFBUSxHQUFSLFFBQVEsQ0FBMEI7UUFqRDVDLFdBQU0sR0FBRyxFQUFFLENBQUM7UUFJWixpQkFBWSxHQUFpQixJQUFJLENBQUM7UUFDbEMsWUFBTyxHQUFxQixJQUFJLENBQUM7UUFFakMsaUJBQVksR0FBUSxJQUFJLENBQUM7UUFFekIsZ0JBQVcsR0FBRyxJQUFJLFlBQVksRUFBVyxDQUFDO1FBRzFDLHdCQUFtQixHQUFHLEtBQUssQ0FBQzs7UUFFNUIsZUFBVSxHQUFHLElBQUksQ0FBQztRQUNsQixvQkFBZSxHQUFHLEVBQUUsQ0FBQztRQUNyQixrQkFBYSxHQUFHLEVBQUUsQ0FBQztRQUNuQix3QkFBbUIsR0FBRyxFQUFFLENBQUM7UUFFekIsZUFBVSxHQUFHLHVDQUF1QyxDQUFDO1FBQ3JELGdCQUFXLEdBQXFCLElBQUksQ0FBQztRQUU5QixrQkFBYSxHQUFHO1lBQ3JCLEVBQUMsRUFBRSxFQUFFLFNBQVMsQ0FBQyxHQUFHLEVBQUUsS0FBSyxFQUFFLFNBQVMsQ0FBQyxHQUFHLEVBQUM7WUFDekMsRUFBQyxFQUFFLEVBQUUsU0FBUyxDQUFDLElBQUksRUFBRSxLQUFLLEVBQUUsU0FBUyxDQUFDLElBQUksRUFBQztZQUMzQyxFQUFDLEVBQUUsRUFBRSxTQUFTLENBQUMsSUFBSSxFQUFFLEtBQUssRUFBRSxTQUFTLENBQUMsSUFBSSxFQUFDO1lBQzNDLEVBQUMsRUFBRSxFQUFFLFNBQVMsQ0FBQyxFQUFFLEVBQUUsS0FBSyxFQUFFLFNBQVMsQ0FBQyxFQUFFLEVBQUM7U0FJeEMsQ0FBQztRQXFCQSxXQUFXLENBQUMsaUJBQWlCLENBQUMsSUFBSSxDQUFDLENBQUMsU0FBUzs7OztRQUFDLEdBQUcsQ0FBQyxFQUFFO1lBQ2xELElBQUksQ0FBQyxjQUFjLEdBQUcsR0FBRyxDQUFDLGdCQUFnQixDQUFDLENBQUM7WUFDNUMsSUFBSSxDQUFDLFdBQVcsR0FBRyxHQUFHLENBQUMsYUFBYSxDQUFDLENBQUM7WUFDdEMsSUFBSSxDQUFDLFNBQVMsR0FBRyxHQUFHLENBQUMsV0FBVyxDQUFDLENBQUM7WUFDbEMsSUFBSSxDQUFDLFNBQVMsR0FBRyxHQUFHLENBQUMsV0FBVyxDQUFDLENBQUM7WUFDbEMsSUFBSSxDQUFDLEtBQUssR0FBRyxHQUFHLENBQUMsT0FBTyxDQUFDLENBQUM7WUFDMUIsSUFBSSxDQUFDLFNBQVMsR0FBRyxHQUFHLENBQUMsV0FBVyxDQUFDLENBQUM7WUFDbEMsSUFBSSxDQUFDLFlBQVksR0FBRyxHQUFHLENBQUM7UUFDMUIsQ0FBQyxFQUFDLENBQUM7SUFDTCxDQUFDOzs7O0lBakVELFdBQVc7SUFDWCxDQUFDOzs7O0lBa0VELFFBQVE7UUFDTixJQUFJLENBQUMsYUFBYSxHQUFHLElBQUksQ0FBQyxVQUFVLENBQUMsTUFBTSxDQUFDO1FBQzVDLElBQUksQ0FBQyxlQUFlLEdBQUcsSUFBSSxDQUFDLFVBQVUsQ0FBQyxRQUFRLENBQUM7UUFDaEQsSUFBSSxDQUFDLFVBQVUsR0FBRyxZQUFZLENBQUMsZUFBZSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDekUsSUFBSSxDQUFDLG1CQUFtQixHQUFHLElBQUksQ0FBQyxVQUFVLENBQUM7UUFDM0MsSUFBSSxJQUFJLENBQUMsWUFBWSxDQUFDLG1CQUFtQixLQUFLLElBQUksRUFBRTtZQUNsRCxJQUFJLENBQUMsbUJBQW1CLEdBQUcsSUFBSSxDQUFDO1NBQ2pDO0lBQ0gsQ0FBQzs7Ozs7SUFFRCxjQUFjLENBQUMsTUFBTTtRQUNuQixJQUFJLENBQUMsV0FBVyxHQUFHLElBQUksQ0FBQyxjQUFjLENBQUMsSUFBSSxFQUFFLENBQUM7OztjQUV4QyxHQUFHLEdBQUcsbUVBQW1FOztjQUN6RSxJQUFJLEdBQUc7WUFDWCxNQUFNLEVBQUUsSUFBSSxDQUFDLE1BQU07WUFDbkIsUUFBUSxFQUFFLENBQUM7WUFDWCxJQUFJLEVBQUUsSUFBSSxDQUFDLFlBQVksQ0FBQyxJQUFJO1lBQzVCLFVBQVUsRUFBRSxJQUFJLENBQUMsVUFBVTtZQUMzQixtQkFBbUIsRUFBRSxJQUFJLENBQUMsWUFBWSxDQUFDLG1CQUFtQjtTQUMzRDtRQUNELElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsRUFBRSxJQUFJLENBQUMsQ0FBQyxTQUFTOzs7O1FBQUMsQ0FBQyxRQUFhLEVBQUUsRUFBRTtZQUNwRCxJQUFJLENBQUMsY0FBYyxDQUFDLFFBQVEsRUFBRSxDQUFDO1lBQy9CLElBQUksUUFBUSxDQUFDLE1BQU0sS0FBSyxDQUFDLEVBQUU7Z0JBQ3pCLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsc0JBQXNCLENBQUMsQ0FBQyxDQUFDO2dCQUM1RCxPQUFPO2FBQ1I7O2tCQUNLLFdBQVcsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLHVCQUF1QixDQUFDLG1CQUFtQixDQUFDOztrQkFDeEUsT0FBTyxHQUFHLFdBQVcsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQztZQUNqRCxPQUFPLENBQUMsUUFBUSxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDO1lBQ3RDLE9BQU8sQ0FBQyxRQUFRLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDO1lBQy9DLE9BQU8sQ0FBQyxRQUFRLENBQUMsUUFBUSxHQUFHLENBQUMsQ0FBQztZQUM5QixPQUFPLENBQUMsUUFBUSxDQUFDLFlBQVksR0FBRyxRQUFRLENBQUM7O2tCQUNuQyxXQUFXLEdBQUc7Z0JBQ2xCLEtBQUssRUFBRSxJQUFJLENBQUMsU0FBUztnQkFDckIsS0FBSyxFQUFFLEdBQUc7Z0JBQ1YsTUFBTSxFQUFFLEdBQUc7Z0JBQ1gsT0FBTyxFQUFFLE9BQU8sQ0FBQyxRQUFRLENBQUMsV0FBVztnQkFDckMsVUFBVSxFQUFFLElBQUk7Z0JBQ2hCLGFBQWEsRUFBRSxLQUFLO2dCQUNwQixXQUFXLEVBQUUsSUFBSTthQUNsQjs7a0JBQ0ssTUFBTSxHQUFHLElBQUksQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLE9BQU8sRUFBRSxXQUFXLENBQUM7WUFDM0QsT0FBTyxDQUFDLFFBQVEsQ0FBQyxVQUFVLENBQUMsU0FBUzs7O1lBQUMsR0FBRyxFQUFFO2dCQUN6QyxNQUFNLENBQUMsS0FBSyxFQUFFLENBQUM7WUFDakIsQ0FBQyxFQUFDLENBQUE7WUFDRixPQUFPLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQyxTQUFTOzs7O1lBQUMsT0FBTyxDQUFDLEVBQUU7Z0JBQzNDLElBQUksQ0FBQyxhQUFhLEdBQUcsT0FBTyxDQUFDLEVBQUUsQ0FBQztnQkFDaEMsSUFBSSxDQUFDLGVBQWUsR0FBRyxPQUFPLENBQUMsSUFBSSxDQUFDO2dCQUNwQyxJQUFJLENBQUMsVUFBVSxHQUFHLFlBQVksQ0FBQyxlQUFlLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxDQUFDO2dCQUNqRSxJQUFJLENBQUMsbUJBQW1CLEdBQUcsSUFBSSxDQUFDLFVBQVUsQ0FBQztnQkFDM0MsTUFBTSxDQUFDLEtBQUssRUFBRSxDQUFDO1lBQ2pCLENBQUMsRUFBQyxDQUFDO1FBQ0wsQ0FBQzs7OztRQUFFLEtBQUssQ0FBQyxFQUFFO1lBQ1QsSUFBSSxDQUFDLGNBQWMsQ0FBQyxRQUFRLEVBQUUsQ0FBQztZQUMvQixJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDO1lBQ3ZDLE9BQU8sQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUNuQyxDQUFDLEVBQUMsQ0FBQztJQUNMLENBQUM7Ozs7SUFFTSxFQUFFOztZQUNILE1BQU0sR0FBRyxJQUFJO1FBQ2pCLElBQUksSUFBSSxDQUFDLFVBQVUsS0FBSyxJQUFJLENBQUMsbUJBQW1CLEVBQUU7WUFDaEQsTUFBTSxHQUFHLFlBQVksQ0FBQyxnQkFBZ0IsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUM7U0FDekQ7UUFDRCxRQUFRLElBQUksQ0FBQyxVQUFVLEVBQUU7WUFDdkIsS0FBSyxVQUFVLENBQUMsWUFBWTtnQkFDMUIsSUFBSSxDQUFDLGlCQUFpQixDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsYUFBYSxFQUFFLElBQUksQ0FBQyxZQUFZLEVBQUUsSUFBSSxDQUFDLFlBQVksRUFBRSxNQUFNLENBQUMsQ0FBQztnQkFDcEcsSUFBSSxDQUFDLGNBQWMsRUFBRSxDQUFDO2dCQUN0QixNQUFNO1lBQ1IsS0FBSyxVQUFVLENBQUMsc0JBQXNCO2dCQUNwQyxJQUFJLENBQUMsaUJBQWlCLENBQUMsaUJBQWlCLENBQUMsSUFBSSxDQUFDLGFBQWEsRUFBRSxJQUFJLENBQUMsWUFBWSxFQUFFLElBQUksQ0FBQyxhQUFhLENBQUMsU0FBUyxFQUMxRyxJQUFJLENBQUMsYUFBYSxDQUFDLFFBQVEsRUFBRSxJQUFJLENBQUMsWUFBWSxFQUFFLE1BQU0sQ0FBQyxDQUFDO2dCQUMxRCxJQUFJLENBQUMsY0FBYyxFQUFFLENBQUM7Z0JBQ3RCLE1BQU07WUFDUixLQUFLLFVBQVUsQ0FBQyxzQkFBc0I7Z0JBQ3BDLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxzQkFBc0IsQ0FBQyxJQUFJLENBQUMsYUFBYSxFQUFFLElBQUksQ0FBQyxZQUFZLEVBQUUsSUFBSSxDQUFDLFlBQVksRUFBRSxNQUFNLENBQUMsQ0FBQztnQkFDaEgsSUFBSSxDQUFDLGNBQWMsRUFBRSxDQUFDO2dCQUN0QixNQUFNO1NBQ1Q7SUFDSCxDQUFDOzs7O0lBRUQsY0FBYzs7Y0FDTixjQUFjLEdBQUcsSUFBSSxDQUFDLGlCQUFpQixDQUFDLE1BQU0sQ0FBQyxTQUFTOzs7O1FBQUMsSUFBSSxDQUFDLEVBQUU7WUFDcEUsSUFBSSxJQUFJLEtBQUssRUFBRSxFQUFFO2dCQUNmLElBQUksQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxjQUFjLENBQUMsQ0FBQztnQkFDekMsY0FBYyxDQUFDLFdBQVcsRUFBRSxDQUFDO2dCQUM3QixJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztnQkFDeEIsSUFBSSxDQUFDLE9BQU8sQ0FBQyxRQUFRLEVBQUUsQ0FBQzthQUN6QjtpQkFBTTs7c0JBQ0MsVUFBVSxHQUFHLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxVQUFVO2dCQUNwRCxJQUFJLFVBQVUsS0FBSyxNQUFNLEVBQUU7b0JBQ3pCLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO2lCQUN4QjtxQkFBTSxJQUFJLFVBQVUsS0FBSyxTQUFTLEVBQUU7b0JBQ25DLElBQUksQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDO2lCQUMzQjtxQkFBTTtvQkFDTCxJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsV0FBVyxHQUFHLElBQUksQ0FBQyxDQUFDO2lCQUM1QztnQkFDRCxjQUFjLENBQUMsV0FBVyxFQUFFLENBQUM7Z0JBQzdCLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO2dCQUN6QixJQUFJLENBQUMsT0FBTyxDQUFDLFFBQVEsRUFBRSxDQUFDO2FBQ3pCO1lBQ0QsSUFBSSxDQUFDLFdBQVcsQ0FBQyxJQUFJLEVBQUUsQ0FBQztRQUMxQixDQUFDLEVBQUM7SUFDSixDQUFDOzs7O0lBRUQsaUJBQWlCOztjQUNULE1BQU0sR0FBRyxZQUFZLENBQUMsZ0JBQWdCLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQzs7Y0FDdkQsT0FBTyxHQUFHLENBQUMsTUFBTSxFQUFFLE9BQU8sRUFBRSxPQUFPLEVBQUUsS0FBSyxDQUFDO1FBQ2pELElBQUksT0FBTyxDQUFDLFNBQVM7Ozs7UUFBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsS0FBSyxNQUFNLEVBQUMsR0FBRyxDQUFDLEVBQUU7WUFDNUMsT0FBTyxLQUFLLENBQUM7U0FDZDtRQUNELE9BQU8sSUFBSSxDQUFDO0lBQ2QsQ0FBQzs7OztJQUVNLEtBQUs7UUFDVixJQUFJLENBQUMsV0FBVyxDQUFDLElBQUksRUFBRSxDQUFDO0lBQzFCLENBQUM7Ozs7SUFFTSxNQUFNO1FBQ1gsSUFBSSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDOUIsQ0FBQzs7O1lBcE1GLFNBQVMsU0FBQztnQkFDVCxRQUFRLEVBQUUsMEJBQTBCO2dCQUNwQyxtcUhBQW9EO2dCQUVwRCxTQUFTLEVBQUUsQ0FBQyxhQUFhLEVBQUUsaUJBQWlCLEVBQUUsaUJBQWlCLEVBQUUsV0FBVyxDQUFDOzthQUM5RTs7OztZQWxCTyxpQkFBaUI7WUFDakIsYUFBYTtZQUViLGlCQUFpQjtZQUNqQixVQUFVO1lBRVEsY0FBYztZQWJ0QyxRQUFRO1lBY0YsY0FBYztZQWhCcEIsd0JBQXdCOzs7MEJBaUN2QixTQUFTLFNBQUMsY0FBYztxQkFDeEIsS0FBSzt5QkFFTCxLQUFLOzJCQUVMLEtBQUs7MkJBR0wsS0FBSzswQkFFTCxNQUFNOzs7O0lBVlAsa0RBQXlEOztJQUN6RCw2Q0FDWTs7SUFDWixpREFDdUI7O0lBQ3ZCLG1EQUNrQzs7SUFDbEMsOENBQWlDOztJQUNqQyxtREFDeUI7O0lBQ3pCLGtEQUMwQzs7SUFDMUMsaURBQWdCOztJQUVoQiwwREFBNEI7O0lBRTVCLGlEQUFrQjs7SUFDbEIsc0RBQXFCOztJQUNyQixvREFBbUI7O0lBQ25CLDBEQUF5Qjs7SUFFekIsaURBQXFEOztJQUNyRCxrREFBcUM7O0lBRXJDLG9EQVFFOztJQUdGLGdEQUFrQjs7SUFDbEIscURBQXVCOztJQUN2QixrREFBb0I7O0lBQ3BCLGdEQUFrQjs7SUFDbEIsNENBQWM7O0lBQ2QsZ0RBQWtCOztJQUNsQixtREFBa0I7Ozs7O0lBR2hCLHdEQUE0Qzs7Ozs7SUFDNUMsNkNBQTZCOzs7OztJQUM3QixvREFBd0M7Ozs7O0lBQ3hDLDJDQUF3Qjs7Ozs7SUFDeEIscURBQXNDOzs7OztJQUN0QywrQ0FBMEI7Ozs7O0lBQzFCLG1EQUFvQzs7Ozs7SUFDcEMsK0NBQTBDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgQ29tcG9uZW50LFxuICBDb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIsXG4gIEV2ZW50RW1pdHRlcixcbiAgSW5qZWN0b3IsXG4gIElucHV0LFxuICBPbkRlc3Ryb3ksXG4gIE91dHB1dCxcbiAgVGVtcGxhdGVSZWYsXG4gIFZpZXdDaGlsZFxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7RGF0YUV4cG9ydFNlcnZpY2V9IGZyb20gJy4uL3NlcnZpY2UvRGF0YUlFU2VydmljZS9kYXRhLWV4cG9ydC5zZXJ2aWNlJztcbmltcG9ydCB7Tm90aWZ5U2VydmljZX0gZnJvbSAnQGZhcnJpcy91aS1ub3RpZnknO1xuaW1wb3J0IHtCaW5kaW5nRGF0YSwgRnJhbWVDb250ZXh0fSBmcm9tICdAZmFycmlzL2RldmtpdCc7XG5pbXBvcnQge0VudGl0eUxpc3RTZXJ2aWNlfSBmcm9tICdAZmFycmlzL2NvbW1hbmQtc2VydmljZXMnO1xuaW1wb3J0IHtIdHRwQ2xpZW50fSBmcm9tICdAYW5ndWxhci9jb21tb24vaHR0cCc7XG5pbXBvcnQge0RhdGFJRVV0aWxzLCBGaWxlVHlwZVV0aWx9IGZyb20gJy4uL3NlcnZpY2UvVXRpbHMvRGF0YUlFVXRpbHMnO1xuaW1wb3J0IHtMb2FkaW5nQ29tcG9uZW50LCBMb2FkaW5nU2VydmljZX0gZnJvbSAnQGZhcnJpcy91aS1sb2FkaW5nJztcbmltcG9ydCB7QnNNb2RhbFNlcnZpY2V9IGZyb20gJ0BmYXJyaXMvdWktbW9kYWwnO1xuaW1wb3J0IHtSdWxlU2VsZWN0Q29tcG9uZW50fSBmcm9tICcuLi9ydWxlLXNlbGVjdC9ydWxlLXNlbGVjdC5jb21wb25lbnQnO1xuaW1wb3J0IHtTdWJqZWN0fSBmcm9tICdyeGpzJztcbmltcG9ydCB7RmlsZUNvbnN0fSBmcm9tICcuLi9tb2RlbC91dGlscy9GaWxlQ29uc3QnO1xuaW1wb3J0IHtNZXRob2RUeXBlfSBmcm9tICcuLi9tb2RlbC9EYXRhSUVUeXBlL01ldGhvZFR5cGUnO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdhcHAtZXhwb3J0LWN1c3RvbS1zZWxlY3QnLFxuICB0ZW1wbGF0ZVVybDogJy4vZXhwb3J0LWN1c3RvbS1zZWxlY3QuY29tcG9uZW50Lmh0bWwnLFxuICBzdHlsZVVybHM6IFsnLi9leHBvcnQtY3VzdG9tLXNlbGVjdC5jb21wb25lbnQuY3NzJ10sXG4gIHByb3ZpZGVyczogW05vdGlmeVNlcnZpY2UsIERhdGFFeHBvcnRTZXJ2aWNlLCBFbnRpdHlMaXN0U2VydmljZSwgQmluZGluZ0RhdGFdXG59KVxuLy/oh6rpgInmlofku7bnsbvlnovlr7zlh7pcbmV4cG9ydCBjbGFzcyBFeHBvcnRDdXN0b21TZWxlY3RDb21wb25lbnQgaW1wbGVtZW50cyBPbkRlc3Ryb3kge1xuICBuZ09uRGVzdHJveSgpOiB2b2lkIHtcbiAgfVxuXG4gIEBWaWV3Q2hpbGQoJ3NlbGVjdEZvb3RlcicpIG1vZGFsRm9vdGVyOiBUZW1wbGF0ZVJlZjxhbnk+O1xuICBASW5wdXQoKVxuICBydWxlSWQgPSAnJztcbiAgQElucHV0KClcbiAgbWV0aG9kVHlwZTogTWV0aG9kVHlwZTtcbiAgQElucHV0KClcbiAgZnJhbWVDb250ZXh0OiBGcmFtZUNvbnRleHQgPSBudWxsO1xuICBzdWJqZWN0OiBTdWJqZWN0PEJvb2xlYW4+ID0gbnVsbDtcbiAgQElucHV0KClcbiAgZXhwb3J0T3B0aW9uOiBhbnkgPSBudWxsO1xuICBAT3V0cHV0KClcbiAgbmVlZERlc3Ryb3kgPSBuZXcgRXZlbnRFbWl0dGVyPGJvb2xlYW4+KCk7XG4gIHZhbHVlRmllbGQ6IGFueTtcblxuICBlbmFibGVSdW50aW1lQ3VzdG9tID0gZmFsc2U7XG4gIC8vIOiusOW9leeahOinhOWImVxuICByZWNvcmRSdWxlID0gbnVsbDtcbiAgY3VycmVudFJ1bGVOYW1lID0gJyc7XG4gIGN1cnJlbnRSdWxlSWQgPSAnJztcbiAgY3VycmVudFJ1bGVGaWxlVHlwZSA9ICcnO1xuXG4gIGxvb2t1cEljb24gPSAnPGkgY2xhc3M9XCJmLWljb24gZi1pY29uLXdpbmRvd3NcIj48L2k+JztcbiAgbG9hZGluZ0NvbXA6IExvYWRpbmdDb21wb25lbnQgPSBudWxsO1xuXG4gIHB1YmxpYyBmaWxlTGlzdEl0ZW1zID0gW1xuICAgIHtpZDogRmlsZUNvbnN0LnhscywgbGFiZWw6IEZpbGVDb25zdC54bHN9LFxuICAgIHtpZDogRmlsZUNvbnN0Lnhsc3gsIGxhYmVsOiBGaWxlQ29uc3QueGxzeH0sXG4gICAge2lkOiBGaWxlQ29uc3QueGxzbSwgbGFiZWw6IEZpbGVDb25zdC54bHNtfSxcbiAgICB7aWQ6IEZpbGVDb25zdC5ldCwgbGFiZWw6IEZpbGVDb25zdC5ldH0sXG4gICAgLy8geyBpZDogRmlsZUNvbnN0LmNzdiwgbGFiZWw6IEZpbGVDb25zdC5jc3YgfSxcbiAgICAvLyB7IGlkOiBGaWxlQ29uc3QucGRmLCBsYWJlbDogRmlsZUNvbnN0LnBkZiB9LFxuICAgIC8vIHsgaWQ6IEZpbGVDb25zdC54bWwsIGxhYmxlOiBGaWxlQ29uc3QueG1sIH1cbiAgXTtcblxuXG4gIGZpbGVfdHlwZTogc3RyaW5nO1xuICBleHBvcnRfc3VjY2Vzczogc3RyaW5nO1xuICBleHBvcnRfZmFpbDogc3RyaW5nO1xuICBpZV9jYW5jZWw6IHN0cmluZztcbiAgaWVfb2s6IHN0cmluZztcbiAgcnVsZV9saXN0OiBzdHJpbmc7XG4gIGkxOG5SZXNvdXJjZTogYW55O1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgZGF0YUV4cG9ydFNlcnZpY2U6IERhdGFFeHBvcnRTZXJ2aWNlLFxuICAgIHByaXZhdGUgbm90aWZ5OiBOb3RpZnlTZXJ2aWNlLFxuICAgIHByaXZhdGUgZW50aXR5U2VydmljZTogRW50aXR5TGlzdFNlcnZpY2UsXG4gICAgcHJpdmF0ZSBodHRwOiBIdHRwQ2xpZW50LFxuICAgIHByaXZhdGUgbG9hZGluZ1NlcnZpY2U6IExvYWRpbmdTZXJ2aWNlLFxuICAgIHByaXZhdGUgaW5qZWN0b3I6IEluamVjdG9yLFxuICAgIHByaXZhdGUgbW9kYWxTZXJ2aWNlOiBCc01vZGFsU2VydmljZSxcbiAgICBwcml2YXRlIHJlc29sdmVyOiBDb21wb25lbnRGYWN0b3J5UmVzb2x2ZXJcbiAgKSB7XG4gICAgRGF0YUlFVXRpbHMuZ2V0VHJhbnNsYXRlVmFsdWUoaHR0cCkuc3Vic2NyaWJlKHJlcyA9PiB7XG4gICAgICB0aGlzLmV4cG9ydF9zdWNjZXNzID0gcmVzWydleHBvcnRfc3VjY2VzcyddO1xuICAgICAgdGhpcy5leHBvcnRfZmFpbCA9IHJlc1snZXhwb3J0X2ZhaWwnXTtcbiAgICAgIHRoaXMuZmlsZV90eXBlID0gcmVzWydmaWxlX3R5cGUnXTtcbiAgICAgIHRoaXMuaWVfY2FuY2VsID0gcmVzWydpZV9jYW5jZWwnXTtcbiAgICAgIHRoaXMuaWVfb2sgPSByZXNbJ2llX29rJ107XG4gICAgICB0aGlzLnJ1bGVfbGlzdCA9IHJlc1sncnVsZV9saXN0J107XG4gICAgICB0aGlzLmkxOG5SZXNvdXJjZSA9IHJlcztcbiAgICB9KTtcbiAgfVxuXG4gIG5nT25Jbml0KCkge1xuICAgIHRoaXMuY3VycmVudFJ1bGVJZCA9IHRoaXMucmVjb3JkUnVsZS5ydWxlSWQ7XG4gICAgdGhpcy5jdXJyZW50UnVsZU5hbWUgPSB0aGlzLnJlY29yZFJ1bGUucnVsZU5hbWU7XG4gICAgdGhpcy52YWx1ZUZpZWxkID0gRmlsZVR5cGVVdGlsLmdldEZpbGVUeXBlTmFtZSh0aGlzLnJlY29yZFJ1bGUuZmlsZVR5cGUpO1xuICAgIHRoaXMuY3VycmVudFJ1bGVGaWxlVHlwZSA9IHRoaXMudmFsdWVGaWVsZDtcbiAgICBpZiAodGhpcy5leHBvcnRPcHRpb24uZW5hYmxlUnVudGltZUN1c3RvbSA9PT0gdHJ1ZSkge1xuICAgICAgdGhpcy5lbmFibGVSdW50aW1lQ3VzdG9tID0gdHJ1ZTtcbiAgICB9XG4gIH1cblxuICBvcGVuU2VsZWN0UnVsZSgkZXZlbnQpIHtcbiAgICB0aGlzLmxvYWRpbmdDb21wID0gdGhpcy5sb2FkaW5nU2VydmljZS5zaG93KCk7XG4gICAgLy/ov4fmu6Top4TliJnml7bnlKjooajljZXlkb3ku6TlpITphY3nva7nmoTop4TliJnmnaXov4fmu6TvvIzlm6DmraTnlKhydWxlSWTvvIzogIzkuI3mmK9jdXJyZW50UnVsZUlkXG4gICAgY29uc3QgdXJsID0gJy9hcGkvcnVudGltZS9kaXAvdjEuMC9kYXRhSWVSdWxlTWFuYWdlL2ZpbHRlclJ1bGVzQnlSdWxlSWRBbmRWb0lkJztcbiAgICBjb25zdCBib2R5ID0ge1xuICAgICAgcnVsZUlkOiB0aGlzLnJ1bGVJZCxcbiAgICAgIHJ1bGVUeXBlOiAxLFxuICAgICAgdm9JZDogdGhpcy5leHBvcnRPcHRpb24udm9JZCxcbiAgICAgIG1ldGhvZFR5cGU6IHRoaXMubWV0aG9kVHlwZSxcbiAgICAgIGV4cG9ydENoaWxkTm9kZUNvZGU6IHRoaXMuZXhwb3J0T3B0aW9uLmV4cG9ydENoaWxkTm9kZUNvZGVcbiAgICB9O1xuICAgIHRoaXMuaHR0cC5wb3N0KHVybCwgYm9keSkuc3Vic2NyaWJlKChSdWxlTWdyczogYW55KSA9PiB7XG4gICAgICB0aGlzLmxvYWRpbmdTZXJ2aWNlLmNsZWFyQWxsKCk7XG4gICAgICBpZiAoUnVsZU1ncnMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHRoaXMubm90aWZ5LmluZm8odGhpcy5pMThuUmVzb3VyY2VbJ3J1bGVzZWxlY3RfbGlzdGVtcHR5J10pO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBjb25zdCBjb21wRmFjdG9yeSA9IHRoaXMucmVzb2x2ZXIucmVzb2x2ZUNvbXBvbmVudEZhY3RvcnkoUnVsZVNlbGVjdENvbXBvbmVudCk7XG4gICAgICBjb25zdCBjb21wUmVmID0gY29tcEZhY3RvcnkuY3JlYXRlKHRoaXMuaW5qZWN0b3IpO1xuICAgICAgY29tcFJlZi5pbnN0YW5jZS5ydWxlSWQgPSB0aGlzLnJ1bGVJZDtcbiAgICAgIGNvbXBSZWYuaW5zdGFuY2Uudm9JZCA9IHRoaXMuZXhwb3J0T3B0aW9uLnZvSWQ7XG4gICAgICBjb21wUmVmLmluc3RhbmNlLnJ1bGVUeXBlID0gMTtcbiAgICAgIGNvbXBSZWYuaW5zdGFuY2UuUnVsZU1ncnNEYXRhID0gUnVsZU1ncnM7XG4gICAgICBjb25zdCBtb2RhbENvbmZpZyA9IHtcbiAgICAgICAgdGl0bGU6IHRoaXMucnVsZV9saXN0LFxuICAgICAgICB3aWR0aDogOTUwLFxuICAgICAgICBoZWlnaHQ6IDUwMCxcbiAgICAgICAgYnV0dG9uczogY29tcFJlZi5pbnN0YW5jZS5tb2RhbEZvb3RlcixcbiAgICAgICAgc2hvd0hlYWRlcjogdHJ1ZSxcbiAgICAgICAgc2hvd01heEJ1dHRvbjogZmFsc2UsXG4gICAgICAgIHNob3dCdXR0b25zOiB0cnVlXG4gICAgICB9O1xuICAgICAgY29uc3QgZGlhbG9nID0gdGhpcy5tb2RhbFNlcnZpY2Uuc2hvdyhjb21wUmVmLCBtb2RhbENvbmZpZyk7XG4gICAgICBjb21wUmVmLmluc3RhbmNlLmNsb3NlTW9kYWwuc3Vic2NyaWJlKCgpID0+IHtcbiAgICAgICAgZGlhbG9nLmNsb3NlKCk7XG4gICAgICB9KVxuICAgICAgY29tcFJlZi5pbnN0YW5jZS5va01vZGFsLnN1YnNjcmliZShSdWxlTWdyID0+IHtcbiAgICAgICAgdGhpcy5jdXJyZW50UnVsZUlkID0gUnVsZU1nci5pZDtcbiAgICAgICAgdGhpcy5jdXJyZW50UnVsZU5hbWUgPSBSdWxlTWdyLm5hbWU7XG4gICAgICAgIHRoaXMudmFsdWVGaWVsZCA9IEZpbGVUeXBlVXRpbC5nZXRGaWxlVHlwZU5hbWUoUnVsZU1nci5maWxlVHlwZSk7XG4gICAgICAgIHRoaXMuY3VycmVudFJ1bGVGaWxlVHlwZSA9IHRoaXMudmFsdWVGaWVsZDtcbiAgICAgICAgZGlhbG9nLmNsb3NlKCk7XG4gICAgICB9KTtcbiAgICB9LCBlcnJvciA9PiB7XG4gICAgICB0aGlzLmxvYWRpbmdTZXJ2aWNlLmNsZWFyQWxsKCk7XG4gICAgICB0aGlzLm5vdGlmeS5lcnJvcihlcnJvci5lcnJvci5NZXNzYWdlKTtcbiAgICAgIGNvbnNvbGUubG9nKGVycm9yLmVycm9yLk1lc3NhZ2UpO1xuICAgIH0pO1xuICB9XG5cbiAgcHVibGljIE9rKCkge1xuICAgIGxldCBzdWZmaXggPSBudWxsO1xuICAgIGlmICh0aGlzLnZhbHVlRmllbGQgIT09IHRoaXMuY3VycmVudFJ1bGVGaWxlVHlwZSkge1xuICAgICAgc3VmZml4ID0gRmlsZVR5cGVVdGlsLmdldEZpbGVFeHRlbnNpb24odGhpcy52YWx1ZUZpZWxkKTtcbiAgICB9XG4gICAgc3dpdGNoICh0aGlzLm1ldGhvZFR5cGUpIHtcbiAgICAgIGNhc2UgTWV0aG9kVHlwZS5Db21tb25FeHBvcnQ6XG4gICAgICAgIHRoaXMuZGF0YUV4cG9ydFNlcnZpY2UuRXhwb3J0QnlJZCh0aGlzLmN1cnJlbnRSdWxlSWQsIHRoaXMuZnJhbWVDb250ZXh0LCB0aGlzLmV4cG9ydE9wdGlvbiwgc3VmZml4KTtcbiAgICAgICAgdGhpcy5leHBvcnRDb21wbGV0ZSgpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgTWV0aG9kVHlwZS5FeHBvcnRDdXJyZW50VGFibGVEYXRhOlxuICAgICAgICB0aGlzLmRhdGFFeHBvcnRTZXJ2aWNlLkV4cG9ydEN1cnJlbnREYXRhKHRoaXMuY3VycmVudFJ1bGVJZCwgdGhpcy5mcmFtZUNvbnRleHQsIHRoaXMuZW50aXR5U2VydmljZS5wYWdlSW5kZXgsXG4gICAgICAgICAgdGhpcy5lbnRpdHlTZXJ2aWNlLnBhZ2VTaXplLCB0aGlzLmV4cG9ydE9wdGlvbiwgc3VmZml4KTtcbiAgICAgICAgdGhpcy5leHBvcnRDb21wbGV0ZSgpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgTWV0aG9kVHlwZS5FeHBvcnRDdXJyZW50Q2hpbGREYXRhOlxuICAgICAgICB0aGlzLmRhdGFFeHBvcnRTZXJ2aWNlLkV4cG9ydEN1cnJlbnRDaGlsZERhdGEodGhpcy5jdXJyZW50UnVsZUlkLCB0aGlzLmZyYW1lQ29udGV4dCwgdGhpcy5leHBvcnRPcHRpb24sIHN1ZmZpeCk7XG4gICAgICAgIHRoaXMuZXhwb3J0Q29tcGxldGUoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgfVxuICB9XG5cbiAgZXhwb3J0Q29tcGxldGUoKSB7XG4gICAgY29uc3QgZXhwb3J0VW5zY3JpYmUgPSB0aGlzLmRhdGFFeHBvcnRTZXJ2aWNlLmV4cG9ydC5zdWJzY3JpYmUoZGF0YSA9PiB7XG4gICAgICBpZiAoZGF0YSA9PT0gJycpIHtcbiAgICAgICAgdGhpcy5ub3RpZnkuc3VjY2Vzcyh0aGlzLmV4cG9ydF9zdWNjZXNzKTtcbiAgICAgICAgZXhwb3J0VW5zY3JpYmUudW5zdWJzY3JpYmUoKTtcbiAgICAgICAgdGhpcy5zdWJqZWN0Lm5leHQodHJ1ZSk7XG4gICAgICAgIHRoaXMuc3ViamVjdC5jb21wbGV0ZSgpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uc3QgZXJyb3JsZXZlbCA9IHRoaXMuZGF0YUV4cG9ydFNlcnZpY2UuZXJyb3JsZXZlbDtcbiAgICAgICAgaWYgKGVycm9ybGV2ZWwgPT09ICdJbmZvJykge1xuICAgICAgICAgIHRoaXMubm90aWZ5LmluZm8oZGF0YSk7XG4gICAgICAgIH0gZWxzZSBpZiAoZXJyb3JsZXZlbCA9PT0gJ1dhcm5pbmcnKSB7XG4gICAgICAgICAgdGhpcy5ub3RpZnkud2FybmluZyhkYXRhKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aGlzLm5vdGlmeS5lcnJvcih0aGlzLmV4cG9ydF9mYWlsICsgZGF0YSk7XG4gICAgICAgIH1cbiAgICAgICAgZXhwb3J0VW5zY3JpYmUudW5zdWJzY3JpYmUoKTtcbiAgICAgICAgdGhpcy5zdWJqZWN0Lm5leHQoZmFsc2UpO1xuICAgICAgICB0aGlzLnN1YmplY3QuY29tcGxldGUoKTtcbiAgICAgIH1cbiAgICAgIHRoaXMubmVlZERlc3Ryb3kuZW1pdCgpO1xuICAgIH0pO1xuICB9XG5cbiAgY2FuU2VsZWN0RmlsZVR5cGUoKSB7XG4gICAgY29uc3Qgc3VmZml4ID0gRmlsZVR5cGVVdGlsLmdldEZpbGVFeHRlbnNpb24odGhpcy52YWx1ZUZpZWxkKTtcbiAgICBjb25zdCBjYW5MaXN0ID0gWycueGxzJywgJy54bHN4JywgJy54bHNtJywgJy5ldCddO1xuICAgIGlmIChjYW5MaXN0LmZpbmRJbmRleCh0ID0+IHQgPT09IHN1ZmZpeCkgPCAwKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIHJldHVybiB0cnVlO1xuICB9XG5cbiAgcHVibGljIGNsb3NlKCkge1xuICAgIHRoaXMubmVlZERlc3Ryb3kuZW1pdCgpO1xuICB9XG5cbiAgcHVibGljIENhbmNlbCgpIHtcbiAgICB0aGlzLm5lZWREZXN0cm95LmVtaXQodHJ1ZSk7XG4gIH1cbn1cbiJdfQ==
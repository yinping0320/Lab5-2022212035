/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Component, EventEmitter, Output, TemplateRef, ViewChild } from '@angular/core';
import { HttpClient } from "@angular/common/http";
import { NotifyService } from "@farris/ui-notify";
import { DataIEUtils, isNullOrEmpty, isNullOrBlank } from "../../service/Utils/DataIEUtils";
import { DatagridComponent } from "@farris/ui-datagrid";
var ExtendComponent1Component = /** @class */ (function () {
    function ExtendComponent1Component(http, notify) {
        var _this = this;
        this.http = http;
        this.notify = notify;
        this.closeModal = new EventEmitter();
        this.okModal = new EventEmitter();
        this.ObjInfoColumns = [];
        this.ObjInfoData = [];
        this.FieldsColumns = [];
        this.FieldsData = [];
        this.canNotCheckedRow = (/**
         * @param {?} row
         * @param {?} index
         * @return {?}
         */
        function (row, index) {
            return row.require;
        });
        DataIEUtils.getTranslateValue(http).subscribe((/**
         * @param {?} res
         * @return {?}
         */
        function (res) {
            _this.i18nResouce = res;
            _this.ie_cancel = res['ie_cancel'];
            _this.ie_ok = res['ie_ok'];
        }));
    }
    /**
     * @return {?}
     */
    ExtendComponent1Component.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        this.ObjInfoColumns = [
            { field: 'fileObjectName', width: 100, title: '对象名称', sortable: false, showTips: true }
        ];
        this.dataIeRuleExtend = JSON.parse(JSON.stringify(this.dataIeRuleExtendOriginal));
        this.extendRuleInfo = JSON.parse(this.dataIeRuleExtend.extendRuleInfo);
        this.ObjInfoData = this.extendRuleInfo.objInfos;
        this.FieldsColumns = [
            { field: 'fileElementName', width: 100, title: '列名', sortable: false, showTips: true, filter: true }
        ];
    };
    /**
     * @return {?}
     */
    ExtendComponent1Component.prototype.ngAfterViewInit = /**
     * @return {?}
     */
    function () {
        // this.objSelectChanged({data:this.ObjInfoData[0]});
        this.ObjsGrid.selectRow(this.ObjInfoData[0].id);
    };
    /**
     * @param {?} e
     * @return {?}
     */
    ExtendComponent1Component.prototype.moveUp = /**
     * @param {?} e
     * @return {?}
     */
    function (e) {
        var _a;
        /** @type {?} */
        var selectedRow = this.FieldsGrid.selectedRow;
        if (!selectedRow || !selectedRow.data) {
            return;
        }
        /** @type {?} */
        var id = selectedRow.data.id;
        /** @type {?} */
        var idx = this.FieldsData.findIndex((/**
         * @param {?} e
         * @return {?}
         */
        function (e) { return e.id === id; }));
        if (idx <= 0) {
            return;
        }
        /** @type {?} */
        var temp = this.FieldsData.splice(idx, 1);
        (_a = this.FieldsData).splice.apply(_a, tslib_1.__spread([idx - 1, 0], temp));
        this.FieldsData = JSON.parse(JSON.stringify(this.FieldsData));
        this.FieldsGrid.selectRow(id);
    };
    /**
     * @param {?} e
     * @return {?}
     */
    ExtendComponent1Component.prototype.moveDown = /**
     * @param {?} e
     * @return {?}
     */
    function (e) {
        var _a;
        /** @type {?} */
        var selectedRow = this.FieldsGrid.selectedRow;
        if (!selectedRow || !selectedRow.data) {
            return;
        }
        /** @type {?} */
        var id = selectedRow.data.id;
        /** @type {?} */
        var idx = this.FieldsData.findIndex((/**
         * @param {?} e
         * @return {?}
         */
        function (e) { return e.id === id; }));
        if (idx >= this.FieldsData.length - 1) {
            return;
        }
        /** @type {?} */
        var temp = this.FieldsData.splice(idx, 1);
        (_a = this.FieldsData).splice.apply(_a, tslib_1.__spread([idx + 1, 0], temp));
        this.FieldsData = JSON.parse(JSON.stringify(this.FieldsData));
        this.FieldsGrid.selectRow(id);
    };
    /**
     * @param {?} e
     * @return {?}
     */
    ExtendComponent1Component.prototype.onFilterChanged = /**
     * @param {?} e
     * @return {?}
     */
    function (e) {
        if (!e.fileElementName) {
            /** @type {?} */
            var selectedRow = this.ObjsGrid.selectedRow;
            if (!selectedRow || !selectedRow.data) {
                return;
            }
            this.objSelectChanged(selectedRow);
        }
    };
    /**
     * @param {?} e
     * @return {?}
     */
    ExtendComponent1Component.prototype.objSelectChanged = /**
     * @param {?} e
     * @return {?}
     */
    function (e) {
        var _this = this;
        /** @type {?} */
        var rowDataId = e.data.id;
        /** @type {?} */
        var idx = this.ObjInfoData.findIndex((/**
         * @param {?} e
         * @return {?}
         */
        function (e) { return e.id === rowDataId; }));
        if (idx >= 0) {
            this.FieldsData = this.ObjInfoData[idx].fieldsInfo;
            this.FieldsGrid.loadData(this.FieldsData);
            // this.FieldsGrid = JSON.parse(JSON.stringify(fieldsData));
            this.FieldsData.forEach((/**
             * @param {?} d
             * @return {?}
             */
            function (d) {
                if (d.checked) {
                    _this.FieldsGrid.checkRow(d.id, false);
                }
            }));
            /** @type {?} */
            var selectedRow = this.FieldsGrid.selectedRow;
            if (selectedRow) {
                this.FieldsGrid.clearSelections();
            }
        }
    };
    /**
     * @param {?} e
     * @return {?}
     */
    ExtendComponent1Component.prototype.ElementCheckedRow = /**
     * @param {?} e
     * @return {?}
     */
    function (e) {
        /** @type {?} */
        var rowData = e.data;
        /** @type {?} */
        var idx = this.FieldsData.findIndex((/**
         * @param {?} e
         * @return {?}
         */
        function (e) { return e.id === rowData.id; }));
        if (idx >= 0) {
            this.FieldsData[idx].checked = true;
        }
    };
    /**
     * @param {?} e
     * @return {?}
     */
    ExtendComponent1Component.prototype.ElementUnCheckedRow = /**
     * @param {?} e
     * @return {?}
     */
    function (e) {
        /** @type {?} */
        var rowData = e.data;
        /** @type {?} */
        var idx = this.FieldsData.findIndex((/**
         * @param {?} e
         * @return {?}
         */
        function (e) { return e.id === rowData.id; }));
        if (idx >= 0) {
            this.FieldsData[idx].checked = false;
        }
    };
    /**
     * @param {?} e
     * @return {?}
     */
    ExtendComponent1Component.prototype.ElementCheckedAll = /**
     * @param {?} e
     * @return {?}
     */
    function (e) {
        this.FieldsData.forEach((/**
         * @param {?} d
         * @return {?}
         */
        function (d) {
            d.checked = true;
        }));
    };
    /**
     * @param {?} e
     * @return {?}
     */
    ExtendComponent1Component.prototype.ElementUnCheckedAll = /**
     * @param {?} e
     * @return {?}
     */
    function (e) {
        if (isNullOrEmpty(e)) {
            return;
        }
        this.FieldsData.forEach((/**
         * @param {?} d
         * @return {?}
         */
        function (d) {
            d.checked = false;
        }));
    };
    /**
     * @return {?}
     */
    ExtendComponent1Component.prototype.okHandler = /**
     * @return {?}
     */
    function () {
        var _this = this;
        if (isNullOrBlank(this.dataIeRuleExtend.code)) {
            this.notify.warning('模板编号不能为空');
            return;
        }
        if (isNullOrBlank(this.dataIeRuleExtend.name)) {
            this.notify.warning('模板名称不能为空');
            return;
        }
        this.extendRuleInfo.objInfos = this.ObjInfoData;
        this.dataIeRuleExtend.extendRuleInfo = JSON.stringify(this.extendRuleInfo);
        /** @type {?} */
        var url = '/api/runtime/dip/v1.0/dataIeRuleManage/checkUpdateRuleExtend';
        this.http.post(url, this.dataIeRuleExtend).subscribe((/**
         * @param {?} e
         * @return {?}
         */
        function (e) {
            if (e.success) {
                _this.okModal.emit(_this.dataIeRuleExtend);
            }
        }), (/**
         * @param {?} error
         * @return {?}
         */
        function (error) {
            _this.notify.error(error.error.Message);
            console.log(error.error.Message);
        }));
    };
    /**
     * @return {?}
     */
    ExtendComponent1Component.prototype.cancelHandler = /**
     * @return {?}
     */
    function () {
        this.closeModal.emit();
    };
    ExtendComponent1Component.decorators = [
        { type: Component, args: [{
                    selector: 'hlo-extend-component1',
                    template: "<form class=\"px-3 px-md-4 farris-form d-flex flex-wrap\" style=\"margin-top: 13px;\">\n\n  <div class=\"farris-group-wrap form-inline farris-form-inline item-label\">\n    <div class=\"form-group farris-form-group\">\n      <label class=\" col-form-label\">\n        <span class=\"farris-label-info text-danger\">*</span>\n        <span class=\"farris-label-text\">\u6A21\u677F\u7F16\u53F7</span>\n      </label>\n      <div class=\"farris-input-wrap\" style=\"width:240px;\">\n        <input-group name=\"templateCode\" [(ngModel)]=\"dataIeRuleExtend.code\"></input-group>\n        <div class=\"farris-feedback valid-feedback\"></div>\n      </div>\n    </div>\n  </div>\n  <div class=\"farris-group-wrap form-inline farris-form-inline item-label\">\n    <div class=\"form-group farris-form-group\">\n      <label class=\" col-form-label\">\n        <span class=\"farris-label-info text-danger\">*</span>\n        <span class=\"farris-label-text\">\u6A21\u677F\u540D\u79F0</span>\n      </label>\n      <div class=\"farris-input-wrap\" style=\"width:240px;\">\n        <input-group name=\"templateName\" [(ngModel)]=\"dataIeRuleExtend.name\"></input-group>\n        <div class=\"farris-feedback valid-feedback\"></div>\n      </div>\n    </div>\n  </div>\n\n\n</form>\n<farris-section style=\"height: 500px;\">\n  <div class=\"f-page f-page-is-wizard\">\n    <div class=\"position-relative flex-fill farris-split-section m-2 farris-overflow-hidden\">\n\n      <layout id=\"manage-layout\" direction=\"h\" fill=\"true\" class=\"d-flex flex-row layout-fill\">\n        <layout-panel id=\"adptor-layout-panel-left\" class=\"col-2 d-flex flex-column farris-lsection p-0\" region=\"west\"\n                      minWidth=\"150\"\n                      showBorder=\"false\"\n                      style=\"flex: 0 0 auto; max-width: none; width: 260px;margin-top: 14px;overflow-y: auto;overflow-x: hidden\">\n          <div class=\"flex-fill farris-overflow-y-auto\" style=\"background-color: white;height: 468px;\">\n            <farris-datagrid #ObjsGrid id=\"objs-grid\" [idField]=\"'id'\" [fit]=\"true\" [fitColumns]=\"true\"\n                             [columns]=\"ObjInfoColumns\"\n                             [pagination]=\"false\" [showBorder]=\"true\" [striped]=\"true\" [showLineNumber]=\"true\"\n                             [sizeType]=\"'sm'\"\n                             [data]=\"ObjInfoData\" [editable]=\"false\" (selectChanged)=\"objSelectChanged($event)\">\n            </farris-datagrid>\n          </div>\n        </layout-panel>\n\n        <layout-panel id=\"adptor-layout-panel-right\" class=\"farris-rsection f-overflow-y-auto d-flex flex-fill\"\n                      region=\"center\" minWidth=\"280\"\n                      showBorder=\"false\">\n          <div class=\"f-struct-wrapper f-utils-fill-flex-column\" style=\"width: 445px;height: 460px;\">\n            <div class=\"row\" style=\"margin-left:5px;\">\n              <farris-button [type]=\"'link'\" (click)=\"moveUp($event)\">\u4E0A\u79FB</farris-button>\n              <farris-button [type]=\"'link'\" (click)=\"moveDown($event)\">\u4E0B\u79FB</farris-button>\n            </div>\n            <farris-datagrid #FieldsGrid id=\"fields-grid\" [idField]=\"'id'\" [fit]=\"true\" [fitColumns]=\"true\"\n                             [columns]=\"FieldsColumns\"\n                             [showAllCheckbox]=\"false\" [selectOnCheck]=\"true\" [onlySelectSelf]=\"true\"\n                             [showCheckbox]=\"true\"\n                             [multiSelect]=\"true\" [keepSelect]=\"true\" [pagination]=\"false\" [showBorder]=\"true\"\n                             [showLineNumber]=\"true\"\n                             [striped]=\"true\" [sizeType]=\"'sm'\" [data]=\"FieldsData\" [enableFilterRow]=\"true\"\n                             (filterChanged)=\"onFilterChanged($event)\" [disableRow]=\"canNotCheckedRow\"\n                             (checked)=\"ElementCheckedRow($event)\" (unChecked)=\"ElementUnCheckedRow($event)\"\n                             >\n            </farris-datagrid>\n          </div>\n        </layout-panel>\n      </layout>\n\n    </div>\n  </div>\n</farris-section>\n\n\n<ng-template #selectFooter>\n  <button type=\"button\" class=\"btn btn-outline-secondary\" (click)=\"cancelHandler()\">{{ie_cancel}}</button>\n  <button type=\"button\" class=\"btn btn-primary\" (click)=\"okHandler()\">{{ie_ok}}</button>\n</ng-template>\n",
                    styles: [""]
                }] }
    ];
    /** @nocollapse */
    ExtendComponent1Component.ctorParameters = function () { return [
        { type: HttpClient },
        { type: NotifyService }
    ]; };
    ExtendComponent1Component.propDecorators = {
        ObjsGrid: [{ type: ViewChild, args: ['ObjsGrid',] }],
        FieldsGrid: [{ type: ViewChild, args: ['FieldsGrid',] }],
        modalFooter: [{ type: ViewChild, args: ['selectFooter',] }],
        closeModal: [{ type: Output }],
        okModal: [{ type: Output }]
    };
    return ExtendComponent1Component;
}());
export { ExtendComponent1Component };
if (false) {
    /** @type {?} */
    ExtendComponent1Component.prototype.ObjsGrid;
    /** @type {?} */
    ExtendComponent1Component.prototype.FieldsGrid;
    /** @type {?} */
    ExtendComponent1Component.prototype.modalFooter;
    /** @type {?} */
    ExtendComponent1Component.prototype.closeModal;
    /** @type {?} */
    ExtendComponent1Component.prototype.okModal;
    /** @type {?} */
    ExtendComponent1Component.prototype.dataIeRuleExtendOriginal;
    /** @type {?} */
    ExtendComponent1Component.prototype.dataIeRuleExtend;
    /** @type {?} */
    ExtendComponent1Component.prototype.extendRuleInfo;
    /** @type {?} */
    ExtendComponent1Component.prototype.ObjInfoColumns;
    /** @type {?} */
    ExtendComponent1Component.prototype.ObjInfoData;
    /** @type {?} */
    ExtendComponent1Component.prototype.FieldsColumns;
    /** @type {?} */
    ExtendComponent1Component.prototype.FieldsData;
    /** @type {?} */
    ExtendComponent1Component.prototype.i18nResouce;
    /** @type {?} */
    ExtendComponent1Component.prototype.ie_cancel;
    /** @type {?} */
    ExtendComponent1Component.prototype.ie_ok;
    /** @type {?} */
    ExtendComponent1Component.prototype.canNotCheckedRow;
    /**
     * @type {?}
     * @private
     */
    ExtendComponent1Component.prototype.http;
    /**
     * @type {?}
     * @private
     */
    ExtendComponent1Component.prototype.notify;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZXh0ZW5kLWNvbXBvbmVudDEuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGdzcC1kaXAvZGF0YS1pbXAtZXhwLyIsInNvdXJjZXMiOlsibGliL2Jha2NvbXBvbmVudHMvZXh0ZW5kLWNvbXBvbmVudDEvZXh0ZW5kLWNvbXBvbmVudDEuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsT0FBTyxFQUFDLFNBQVMsRUFBRSxZQUFZLEVBQVUsTUFBTSxFQUFFLFdBQVcsRUFBRSxTQUFTLEVBQUMsTUFBTSxlQUFlLENBQUM7QUFDOUYsT0FBTyxFQUFDLFVBQVUsRUFBQyxNQUFNLHNCQUFzQixDQUFDO0FBQ2hELE9BQU8sRUFBQyxhQUFhLEVBQUMsTUFBTSxtQkFBbUIsQ0FBQztBQUNoRCxPQUFPLEVBQUMsV0FBVyxFQUFFLGFBQWEsRUFBRSxhQUFhLEVBQUMsTUFBTSxpQ0FBaUMsQ0FBQztBQUMxRixPQUFPLEVBQUMsaUJBQWlCLEVBQUMsTUFBTSxxQkFBcUIsQ0FBQztBQUV0RDtJQThCRSxtQ0FDVSxJQUFnQixFQUNoQixNQUFxQjtRQUYvQixpQkFTQztRQVJTLFNBQUksR0FBSixJQUFJLENBQVk7UUFDaEIsV0FBTSxHQUFOLE1BQU0sQ0FBZTtRQWxCckIsZUFBVSxHQUFHLElBQUksWUFBWSxFQUFPLENBQUM7UUFDckMsWUFBTyxHQUFHLElBQUksWUFBWSxFQUFPLENBQUM7UUFNNUMsbUJBQWMsR0FBRyxFQUFFLENBQUM7UUFDcEIsZ0JBQVcsR0FBRyxFQUFFLENBQUM7UUFDakIsa0JBQWEsR0FBRyxFQUFFLENBQUM7UUFDbkIsZUFBVSxHQUFHLEVBQUUsQ0FBQztRQW1DaEIscUJBQWdCOzs7OztRQUFHLFVBQUMsR0FBRyxFQUFFLEtBQUs7WUFDNUIsT0FBTyxHQUFHLENBQUMsT0FBTyxDQUFDO1FBQ3JCLENBQUMsRUFBQztRQTNCQSxXQUFXLENBQUMsaUJBQWlCLENBQUMsSUFBSSxDQUFDLENBQUMsU0FBUzs7OztR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Z0I7O0lBRWhCLGdEQUFpQjs7SUFDakIsOENBQWtCOztJQUNsQiwwQ0FBYzs7SUErQmQscURBRUU7Ozs7O0lBOUJBLHlDQUF3Qjs7Ozs7SUFDeEIsMkNBQTZCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtDb21wb25lbnQsIEV2ZW50RW1pdHRlciwgT25Jbml0LCBPdXRwdXQsIFRlbXBsYXRlUmVmLCBWaWV3Q2hpbGR9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHtIdHRwQ2xpZW50fSBmcm9tIFwiQGFuZ3VsYXIvY29tbW9uL2h0dHBcIjtcbmltcG9ydCB7Tm90aWZ5U2VydmljZX0gZnJvbSBcIkBmYXJyaXMvdWktbm90aWZ5XCI7XG5pbXBvcnQge0RhdGFJRVV0aWxzLCBpc051bGxPckVtcHR5LCBpc051bGxPckJsYW5rfSBmcm9tIFwiLi4vLi4vc2VydmljZS9VdGlscy9EYXRhSUVVdGlsc1wiO1xuaW1wb3J0IHtEYXRhZ3JpZENvbXBvbmVudH0gZnJvbSBcIkBmYXJyaXMvdWktZGF0YWdyaWRcIjtcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnaGxvLWV4dGVuZC1jb21wb25lbnQxJyxcbiAgdGVtcGxhdGVVcmw6ICcuL2V4dGVuZC1jb21wb25lbnQxLmNvbXBvbmVudC5odG1sJyxcbiAgc3R5bGVVcmxzOiBbJy4vZXh0ZW5kLWNvbXBvbmVudDEuY29tcG9uZW50LnNjc3MnXVxufSlcbi8qKlxuICog6aKE55WZ5omp5bGV57uE5Lu2MVxuICog5q2k57uE5Lu255uu5YmN6KKr55So5LqO5L2c5Li66KeE5YiZ6YCJ5oup5omp5bGV5qih5p2/6YWN572u55WM6Z2iXG4gKi9cbmV4cG9ydCBjbGFzcyBFeHRlbmRDb21wb25lbnQxQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcbiAgQFZpZXdDaGlsZCgnT2Jqc0dyaWQnKSBPYmpzR3JpZDogRGF0YWdyaWRDb21wb25lbnQ7XG4gIEBWaWV3Q2hpbGQoJ0ZpZWxkc0dyaWQnKSBGaWVsZHNHcmlkOiBEYXRhZ3JpZENvbXBvbmVudDtcblxuICBAVmlld0NoaWxkKCdzZWxlY3RGb290ZXInKSBtb2RhbEZvb3RlcjogVGVtcGxhdGVSZWY8YW55PjtcbiAgQE91dHB1dCgpIGNsb3NlTW9kYWwgPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcbiAgQE91dHB1dCgpIG9rTW9kYWwgPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcblxuICBkYXRhSWVSdWxlRXh0ZW5kT3JpZ2luYWw6IGFueTtcbiAgZGF0YUllUnVsZUV4dGVuZDogYW55O1xuICBleHRlbmRSdWxlSW5mbzogYW55O1xuXG4gIE9iakluZm9Db2x1bW5zID0gW107XG4gIE9iakluZm9EYXRhID0gW107XG4gIEZpZWxkc0NvbHVtbnMgPSBbXTtcbiAgRmllbGRzRGF0YSA9IFtdO1xuXG4gIGkxOG5SZXNvdWNlOiBhbnk7XG4gIGllX2NhbmNlbDogc3RyaW5nO1xuICBpZV9vazogc3RyaW5nO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgaHR0cDogSHR0cENsaWVudCxcbiAgICBwcml2YXRlIG5vdGlmeTogTm90aWZ5U2VydmljZSxcbiAgKSB7XG4gICAgRGF0YUlFVXRpbHMuZ2V0VHJhbnNsYXRlVmFsdWUoaHR0cCkuc3Vic2NyaWJlKHJlcyA9PiB7XG4gICAgICB0aGlzLmkxOG5SZXNvdWNlID0gcmVzO1xuICAgICAgdGhpcy5pZV9jYW5jZWwgPSByZXNbJ2llX2NhbmNlbCddO1xuICAgICAgdGhpcy5pZV9vayA9IHJlc1snaWVfb2snXTtcbiAgICB9KTtcbiAgfVxuXG4gIG5nT25Jbml0KCkge1xuICAgIHRoaXMuT2JqSW5mb0NvbHVtbnMgPSBbXG4gICAgICB7ZmllbGQ6ICdmaWxlT2JqZWN0TmFtZScsIHdpZHRoOiAxMDAsIHRpdGxlOiAn5a+56LGh5ZCN56ewJywgc29ydGFibGU6IGZhbHNlLCBzaG93VGlwczogdHJ1ZX1cbiAgICBdO1xuICAgIHRoaXMuZGF0YUllUnVsZUV4dGVuZCA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkodGhpcy5kYXRhSWVSdWxlRXh0ZW5kT3JpZ2luYWwpKTtcbiAgICB0aGlzLmV4dGVuZFJ1bGVJbmZvID0gSlNPTi5wYXJzZSh0aGlzLmRhdGFJZVJ1bGVFeHRlbmQuZXh0ZW5kUnVsZUluZm8pO1xuICAgIHRoaXMuT2JqSW5mb0RhdGEgPSB0aGlzLmV4dGVuZFJ1bGVJbmZvLm9iakluZm9zO1xuICAgIHRoaXMuRmllbGRzQ29sdW1ucyA9IFtcbiAgICAgIHtmaWVsZDogJ2ZpbGVFbGVtZW50TmFtZScsIHdpZHRoOiAxMDAsIHRpdGxlOiAn5YiX5ZCNJywgc29ydGFibGU6IGZhbHNlLCBzaG93VGlwczogdHJ1ZSwgZmlsdGVyOiB0cnVlfVxuICAgIF07XG5cbiAgfVxuXG4gIG5nQWZ0ZXJWaWV3SW5pdCgpIHtcbiAgICAvLyB0aGlzLm9ialNlbGVjdENoYW5nZWQoe2RhdGE6dGhpcy5PYmpJbmZvRGF0YVswXX0pO1xuICAgIHRoaXMuT2Jqc0dyaWQuc2VsZWN0Um93KHRoaXMuT2JqSW5mb0RhdGFbMF0uaWQpO1xuICB9XG5cbiAgY2FuTm90Q2hlY2tlZFJvdyA9IChyb3csIGluZGV4KSA9PiB7XG4gICAgcmV0dXJuIHJvdy5yZXF1aXJlO1xuICB9O1xuXG4gIG1vdmVVcChlKSB7XG4gICAgY29uc3Qgc2VsZWN0ZWRSb3cgPSB0aGlzLkZpZWxkc0dyaWQuc2VsZWN0ZWRSb3c7XG4gICAgaWYgKCFzZWxlY3RlZFJvdyB8fCAhc2VsZWN0ZWRSb3cuZGF0YSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zdCBpZCA9IHNlbGVjdGVkUm93LmRhdGEuaWQ7XG4gICAgY29uc3QgaWR4ID0gdGhpcy5GaWVsZHNEYXRhLmZpbmRJbmRleChlID0+IGUuaWQgPT09IGlkKTtcbiAgICBpZiAoaWR4IDw9IDApIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc3QgdGVtcCA9IHRoaXMuRmllbGRzRGF0YS5zcGxpY2UoaWR4LCAxKTtcbiAgICB0aGlzLkZpZWxkc0RhdGEuc3BsaWNlKGlkeCAtIDEsIDAsIC4uLnRlbXApO1xuICAgIHRoaXMuRmllbGRzRGF0YSA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkodGhpcy5GaWVsZHNEYXRhKSk7XG4gICAgdGhpcy5GaWVsZHNHcmlkLnNlbGVjdFJvdyhpZCk7XG4gIH1cblxuICBtb3ZlRG93bihlKSB7XG4gICAgY29uc3Qgc2VsZWN0ZWRSb3cgPSB0aGlzLkZpZWxkc0dyaWQuc2VsZWN0ZWRSb3c7XG4gICAgaWYgKCFzZWxlY3RlZFJvdyB8fCAhc2VsZWN0ZWRSb3cuZGF0YSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zdCBpZCA9IHNlbGVjdGVkUm93LmRhdGEuaWQ7XG4gICAgY29uc3QgaWR4ID0gdGhpcy5GaWVsZHNEYXRhLmZpbmRJbmRleChlID0+IGUuaWQgPT09IGlkKTtcbiAgICBpZiAoaWR4ID49IHRoaXMuRmllbGRzRGF0YS5sZW5ndGggLSAxKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IHRlbXAgPSB0aGlzLkZpZWxkc0RhdGEuc3BsaWNlKGlkeCwgMSk7XG4gICAgdGhpcy5GaWVsZHNEYXRhLnNwbGljZShpZHggKyAxLCAwLCAuLi50ZW1wKTtcbiAgICB0aGlzLkZpZWxkc0RhdGEgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHRoaXMuRmllbGRzRGF0YSkpO1xuICAgIHRoaXMuRmllbGRzR3JpZC5zZWxlY3RSb3coaWQpO1xuICB9XG5cbiAgb25GaWx0ZXJDaGFuZ2VkKGUpIHtcbiAgICBpZiAoIWUuZmlsZUVsZW1lbnROYW1lKSB7XG4gICAgICBjb25zdCBzZWxlY3RlZFJvdyA9IHRoaXMuT2Jqc0dyaWQuc2VsZWN0ZWRSb3c7XG4gICAgICBpZiAoIXNlbGVjdGVkUm93IHx8ICFzZWxlY3RlZFJvdy5kYXRhKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIHRoaXMub2JqU2VsZWN0Q2hhbmdlZChzZWxlY3RlZFJvdyk7XG4gICAgfVxuICB9XG5cbiAgb2JqU2VsZWN0Q2hhbmdlZChlKSB7XG4gICAgY29uc3Qgcm93RGF0YUlkID0gZS5kYXRhLmlkO1xuICAgIGNvbnN0IGlkeCA9IHRoaXMuT2JqSW5mb0RhdGEuZmluZEluZGV4KGUgPT4gZS5pZCA9PT0gcm93RGF0YUlkKTtcbiAgICBpZiAoaWR4ID49IDApIHtcbiAgICAgIHRoaXMuRmllbGRzRGF0YSA9IHRoaXMuT2JqSW5mb0RhdGFbaWR4XS5maWVsZHNJbmZvO1xuICAgICAgdGhpcy5GaWVsZHNHcmlkLmxvYWREYXRhKHRoaXMuRmllbGRzRGF0YSk7XG4gICAgICAvLyB0aGlzLkZpZWxkc0dyaWQgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KGZpZWxkc0RhdGEpKTtcbiAgICAgIHRoaXMuRmllbGRzRGF0YS5mb3JFYWNoKGQgPT4ge1xuICAgICAgICBpZiAoZC5jaGVja2VkKSB7XG4gICAgICAgICAgdGhpcy5GaWVsZHNHcmlkLmNoZWNrUm93KGQuaWQsIGZhbHNlKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICBjb25zdCBzZWxlY3RlZFJvdyA9IHRoaXMuRmllbGRzR3JpZC5zZWxlY3RlZFJvdztcbiAgICAgIGlmIChzZWxlY3RlZFJvdykge1xuICAgICAgICB0aGlzLkZpZWxkc0dyaWQuY2xlYXJTZWxlY3Rpb25zKCk7XG4gICAgICB9XG5cbiAgICB9XG4gIH1cblxuICBFbGVtZW50Q2hlY2tlZFJvdyhlKSB7XG4gICAgY29uc3Qgcm93RGF0YSA9IGUuZGF0YTtcbiAgICBjb25zdCBpZHggPSB0aGlzLkZpZWxkc0RhdGEuZmluZEluZGV4KGUgPT4gZS5pZCA9PT0gcm93RGF0YS5pZCk7XG4gICAgaWYgKGlkeCA+PSAwKSB7XG4gICAgICB0aGlzLkZpZWxkc0RhdGFbaWR4XS5jaGVja2VkID0gdHJ1ZTtcbiAgICB9XG4gIH1cblxuICBFbGVtZW50VW5DaGVja2VkUm93KGUpIHtcbiAgICBjb25zdCByb3dEYXRhID0gZS5kYXRhO1xuICAgIGNvbnN0IGlkeCA9IHRoaXMuRmllbGRzRGF0YS5maW5kSW5kZXgoZSA9PiBlLmlkID09PSByb3dEYXRhLmlkKTtcbiAgICBpZiAoaWR4ID49IDApIHtcbiAgICAgIHRoaXMuRmllbGRzRGF0YVtpZHhdLmNoZWNrZWQgPSBmYWxzZTtcbiAgICB9XG4gIH1cblxuICBFbGVtZW50Q2hlY2tlZEFsbChlKSB7XG4gICAgdGhpcy5GaWVsZHNEYXRhLmZvckVhY2goZCA9PiB7XG4gICAgICBkLmNoZWNrZWQgPSB0cnVlO1xuICAgIH0pXG4gIH1cblxuICBFbGVtZW50VW5DaGVja2VkQWxsKGUpIHtcbiAgICBpZiAoaXNOdWxsT3JFbXB0eShlKSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB0aGlzLkZpZWxkc0RhdGEuZm9yRWFjaChkID0+IHtcbiAgICAgIGQuY2hlY2tlZCA9IGZhbHNlO1xuICAgIH0pXG4gIH1cblxuICBva0hhbmRsZXIoKSB7XG4gICAgaWYgKGlzTnVsbE9yQmxhbmsodGhpcy5kYXRhSWVSdWxlRXh0ZW5kLmNvZGUpKSB7XG4gICAgICB0aGlzLm5vdGlmeS53YXJuaW5nKCfmqKHmnb/nvJblj7fkuI3og73kuLrnqbonKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKGlzTnVsbE9yQmxhbmsodGhpcy5kYXRhSWVSdWxlRXh0ZW5kLm5hbWUpKSB7XG4gICAgICB0aGlzLm5vdGlmeS53YXJuaW5nKCfmqKHmnb/lkI3np7DkuI3og73kuLrnqbonKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0aGlzLmV4dGVuZFJ1bGVJbmZvLm9iakluZm9zID0gdGhpcy5PYmpJbmZvRGF0YTtcbiAgICB0aGlzLmRhdGFJZVJ1bGVFeHRlbmQuZXh0ZW5kUnVsZUluZm8gPSBKU09OLnN0cmluZ2lmeSh0aGlzLmV4dGVuZFJ1bGVJbmZvKTtcbiAgICBjb25zdCB1cmwgPSAnL2FwaS9ydW50aW1lL2RpcC92MS4wL2RhdGFJZVJ1bGVNYW5hZ2UvY2hlY2tVcGRhdGVSdWxlRXh0ZW5kJztcbiAgICB0aGlzLmh0dHAucG9zdCh1cmwsIHRoaXMuZGF0YUllUnVsZUV4dGVuZCkuc3Vic2NyaWJlKChlOiBhbnkpID0+IHtcbiAgICAgIGlmIChlLnN1Y2Nlc3MpIHtcbiAgICAgICAgdGhpcy5va01vZGFsLmVtaXQodGhpcy5kYXRhSWVSdWxlRXh0ZW5kKTtcbiAgICAgIH1cbiAgICB9LCBlcnJvciA9PiB7XG4gICAgICB0aGlzLm5vdGlmeS5lcnJvcihlcnJvci5lcnJvci5NZXNzYWdlKTtcbiAgICAgIGNvbnNvbGUubG9nKGVycm9yLmVycm9yLk1lc3NhZ2UpO1xuICAgIH0pO1xuICB9XG5cbiAgY2FuY2VsSGFuZGxlcigpIHtcbiAgICB0aGlzLmNsb3NlTW9kYWwuZW1pdCgpO1xuICB9XG5cbn1cbiJdfQ==
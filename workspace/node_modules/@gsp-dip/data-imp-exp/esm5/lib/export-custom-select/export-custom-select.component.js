/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, ComponentFactoryResolver, EventEmitter, Injector, Input, Output, TemplateRef, ViewChild } from '@angular/core';
import { DataExportService } from '../service/DataIEService/data-export.service';
import { NotifyService } from '@farris/ui-notify';
import { BindingData, FrameContext } from '@farris/devkit';
import { EntityListService } from '@farris/command-services';
import { HttpClient } from '@angular/common/http';
import { DataIEUtils, FileTypeUtil } from '../service/Utils/DataIEUtils';
import { LoadingService } from '@farris/ui-loading';
import { BsModalService } from '@farris/ui-modal';
import { RuleSelectComponent } from '../rule-select/rule-select.component';
import { FileConst } from '../model/utils/FileConst';
import { MethodType } from '../model/DataIEType/MethodType';
var ExportCustomSelectComponent = /** @class */ (function () {
    function ExportCustomSelectComponent(dataExportService, notify, entityService, http, loadingService, injector, modalService, resolver) {
        var _this = this;
        this.dataExportService = dataExportService;
        this.notify = notify;
        this.entityService = entityService;
        this.http = http;
        this.loadingService = loadingService;
        this.injector = injector;
        this.modalService = modalService;
        this.resolver = resolver;
        this.ruleId = '';
        this.frameContext = null;
        this.subject = null;
        this.exportOption = null;
        this.needDestroy = new EventEmitter();
        this.enableRuntimeCustom = false;
        // 记录的规则
        this.recordRule = null;
        this.currentRuleName = '';
        this.currentRuleId = '';
        this.currentRuleFileType = '';
        this.lookupIcon = '<i class="f-icon f-icon-windows"></i>';
        this.loadingComp = null;
        this.fileListItems = [
            { id: FileConst.xls, label: FileConst.xls },
            { id: FileConst.xlsx, label: FileConst.xlsx },
            { id: FileConst.xlsm, label: FileConst.xlsm },
            { id: FileConst.et, label: FileConst.et },
        ];
        DataIEUtils.getTranslateValue(http).subscribe((/**
         * @param {?} res
         * @return {?}
         */
        function (res) {
            _this.export_success = res['export_success'];
            _this.export_fail = res['export_fail'];
            _this.file_type = res['file_type'];
            _this.ie_cancel = res['ie_cancel'];
            _this.ie_ok = res['ie_ok'];
            _this.rule_list = res['rule_list'];
            _this.i18nResource = res;
        }));
    }
    /**
     * @return {?}
     */
    ExportCustomSelectComponent.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
    };
    /**
     * @return {?}
     */
    ExportCustomSelectComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        this.currentRuleId = this.recordRule.ruleId;
        this.currentRuleName = this.recordRule.ruleName;
        this.valueField = FileTypeUtil.getFileTypeName(this.recordRule.fileType);
        this.currentRuleFileType = this.valueField;
        if (this.exportOption.enableRuntimeCustom === true) {
            this.enableRuntimeCustom = true;
        }
    };
    /**
     * @param {?} $event
     * @return {?}
     */
    ExportCustomSelectComponent.prototype.openSelectRule = /**
     * @param {?} $event
     * @return {?}
     */
    function ($event) {
        var _this = this;
        this.loadingComp = this.loadingService.show();
        //过滤规则时用表单命令处配置的规则来过滤，因此用ruleId，而不是currentRuleId
        /** @type {?} */
        var url = '/api/runtime/dip/v1.0/dataIeRuleManage/filterRulesByRuleIdAndVoId';
        /** @type {?} */
        var body = {
            ruleId: this.ruleId,
            ruleType: 1,
            voId: this.exportOption.voId,
            methodType: this.methodType,
            exportChildNodeCode: this.exportOption.exportChildNodeCode
        };
        this.http.post(url, body).subscribe((/**
         * @param {?} RuleMgrs
         * @return {?}
         */
        function (RuleMgrs) {
            _this.loadingService.clearAll();
            if (RuleMgrs.length === 0) {
                _this.notify.info(_this.i18nResource['ruleselect_listempty']);
                return;
            }
            /** @type {?} */
            var compFactory = _this.resolver.resolveComponentFactory(RuleSelectComponent);
            /** @type {?} */
            var compRef = compFactory.create(_this.injector);
            compRef.instance.ruleId = _this.ruleId;
            compRef.instance.voId = _this.exportOption.voId;
            compRef.instance.ruleType = 1;
            compRef.instance.RuleMgrsData = RuleMgrs;
            /** @type {?} */
            var modalConfig = {
                title: _this.rule_list,
                width: 950,
                height: 500,
                buttons: compRef.instance.modalFooter,
                showHeader: true,
                showMaxButton: false,
                showButtons: true
            };
            /** @type {?} */
            var dialog = _this.modalService.show(compRef, modalConfig);
            compRef.instance.closeModal.subscribe((/**
             * @return {?}
             */
            function () {
                dialog.close();
            }));
            compRef.instance.okModal.subscribe((/**
             * @param {?} RuleMgr
             * @return {?}
             */
            function (RuleMgr) {
                _this.currentRuleId = RuleMgr.id;
                _this.currentRuleName = RuleMgr.name;
                _this.valueField = FileTypeUtil.getFileTypeName(RuleMgr.fileType);
                _this.currentRuleFileType = _this.valueField;
                dialog.close();
            }));
        }), (/**
         * @param {?} error
         * @return {?}
         */
        function (error) {
            _this.loadingService.clearAll();
            _this.notify.error(error.error.Message);
            console.log(error.error.Message);
        }));
    };
    /**
     * @return {?}
     */
    ExportCustomSelectComponent.prototype.Ok = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var suffix = null;
        if (this.valueField !== this.currentRuleFileType) {
            suffix = FileTypeUtil.getFileExtension(this.valueField);
        }
        switch (this.methodType) {
            case MethodType.CommonExport:
                this.dataExportService.ExportById(this.currentRuleId, this.frameContext, this.exportOption, suffix);
                this.exportComplete();
                break;
            case MethodType.ExportCurrentTableData:
                this.dataExportService.ExportCurrentData(this.currentRuleId, this.frameContext, this.entityService.pageIndex, this.entityService.pageSize, this.exportOption, suffix);
                this.exportComplete();
                break;
            case MethodType.ExportCurrentChildData:
                this.dataExportService.ExportCurrentChildData(this.currentRuleId, this.frameContext, this.exportOption, suffix);
                this.exportComplete();
                break;
        }
    };
    /**
     * @return {?}
     */
    ExportCustomSelectComponent.prototype.exportComplete = /**
     * @return {?}
     */
    function () {
        var _this = this;
        /** @type {?} */
        var exportUnscribe = this.dataExportService.export.subscribe((/**
         * @param {?} data
         * @return {?}
         */
        function (data) {
            if (data === '') {
                _this.notify.success(_this.export_success);
                exportUnscribe.unsubscribe();
                _this.subject.next(true);
                _this.subject.complete();
            }
            else {
                /** @type {?} */
                var errorlevel = _this.dataExportService.errorlevel;
                if (errorlevel === 'Info') {
                    _this.notify.info(data);
                }
                else if (errorlevel === 'Warning') {
                    _this.notify.warning(data);
                }
                else {
                    _this.notify.error(_this.export_fail + data);
                }
                exportUnscribe.unsubscribe();
                _this.subject.next(false);
                _this.subject.complete();
            }
            _this.needDestroy.emit();
        }));
    };
    /**
     * @return {?}
     */
    ExportCustomSelectComponent.prototype.canSelectFileType = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var suffix = FileTypeUtil.getFileExtension(this.valueField);
        /** @type {?} */
        var canList = ['.xls', '.xlsx', '.xlsm', '.et'];
        if (canList.findIndex((/**
         * @param {?} t
         * @return {?}
         */
        function (t) { return t === suffix; })) < 0) {
            return false;
        }
        return true;
    };
    /**
     * @return {?}
     */
    ExportCustomSelectComponent.prototype.close = /**
     * @return {?}
     */
    function () {
        this.needDestroy.emit();
    };
    /**
     * @return {?}
     */
    ExportCustomSelectComponent.prototype.Cancel = /**
     * @return {?}
     */
    function () {
        this.needDestroy.emit(true);
    };
    ExportCustomSelectComponent.decorators = [
        { type: Component, args: [{
                    selector: 'app-export-custom-select',
                    template: "<!-- <div class=\"d-flex flex-column\" style=\"width: 100%; height: 100%;\">\n    <div region=\"south\" class=\"south mgleft\">\n        <table>\n            <tr>\n                <td class=\"mkwidth\">\n                    <label> </label>\n                </td>\n            </tr>\n            <tr *ngIf=\"selectrule\">\n                <td class=\"mkwidth\">\n                    <label for=\"f_select_rule\">{{rule_list}}</label>\n                </td>\n                <td style=\"width: 430px;\">\n                    <input-group class=\"ng-untouched ng-pristine ng-valid\" [editable]=\"false\" [groupText]=\"lookupIcon\" [enableClear]=\"false\"\n                        [value]=\"currentRuleName\" (clickHandle)=\"openSelectRule($event)\">\n                    </input-group>\n                </td>\n            </tr>\n\n            <tr *ngIf=\"selectfiletype\">\n                <td class=\"mkwidth\">\n                    <label for=\"f_select_fileType\">{{file_type}}</label>\n                </td>\n                <td style=\"width: 430px;\">\n                    <farris-combo-list id=\"f_select_fileType\" [(ngModel)]=\"valueField\" [idField]=\"'id'\" [textField]=\"'label'\" [data]=\"fileListItems\"></farris-combo-list>\n                </td>\n            </tr>\n        </table>\n    </div>\n</div> -->\n\n<form class=\"px-3 px-md-4 farris-form d-flex flex-wrap\">\n    <div class=\"col-12\" style=\"margin-top: 72px\">\n        <div *ngIf=\"enableRuntimeCustom === true\" class=\"farris-group-wrap form-inline farris-form-inline\">\n            <div class=\"form-group farris-form-group\">\n                <label class=\" col-form-label\">\n                    <span class=\"farris-label-text\">{{rule_list}}</span>\n                </label>\n                <div class=\"farris-input-wrap\">\n                    <input-group class=\"ng-untouched ng-pristine ng-valid\" [editable]=\"false\" [groupText]=\"lookupIcon\" [enableClear]=\"false\"\n                        [value]=\"currentRuleName\" (clickHandle)=\"openSelectRule($event)\">\n                    </input-group>\n                </div>\n            </div>\n        </div>\n        <div *ngIf=\"enableRuntimeCustom === false\" class=\"farris-group-wrap form-inline farris-form-inline\">\n            <span>&nbsp;</span>\n        </div>\n        <div class=\"farris-group-wrap form-inline farris-form-inline\">\n            <div class=\"form-group farris-form-group\" style=\"width: 450px\">\n                <label class=\"col-form-label\">\n                    <span class=\"farris-label-text\">{{file_type}}</span>\n                </label>\n                <div class=\"farris-input-wrap\">\n                    <farris-combo-list [readonly]=\"canSelectFileType() === false\" id=\"f_select_fileType\" name=\"f_select_fileType\" [(ngModel)]=\"valueField\"\n                        [idField]=\"'id'\" [textField]=\"'label'\" [editable]=\"false\" [enableClear]=\"false\" [data]=\"fileListItems\"></farris-combo-list>\n                </div>\n                <span>&nbsp;&nbsp;</span>\n                <!-- <span *ngIf=\"enableRuntimeCustom === true\" class=\"f-icon f-icon-custom\" style=\"color: #388FFF;cursor: pointer;\"></span>\n                <span *ngIf=\"enableRuntimeCustom === false\" class=\"f-icon f-icon-custom\" style=\"color:white\"></span> -->\n                <span  class=\"f-icon f-icon-custom\" style=\"color:white\"></span>\n            </div>\n        </div>\n\n\n\n    </div>\n</form>\n\n<ng-template #selectFooter>\n    <button type=\"button\" class=\"btn btn-outline-secondary\" (click)=\"Cancel()\">{{ie_cancel}}</button>\n    <button type=\"button\" class=\"btn btn-primary\" (click)=\"Ok()\">{{ie_ok}}</button>\n</ng-template>",
                    providers: [NotifyService, DataExportService, EntityListService, BindingData],
                    styles: [".barmanager{position:absolute;bottom:0;height:50px;right:30px;padding-left:50px}#filePath,#fileType,#filterExpression{margin-left:7px}.input-group{margin-bottom:12px}.btngroup{margin-top:12px}.exchange{margin-top:30px}#IsSave{margin:6px}.pos{position:relative}.left{float:right}.mkwidth{width:75px;line-height:28px}.div-inline{display:inline}.mgleft{margin-left:20px;margin-top:10px}.longlen{width:400px}"]
                }] }
    ];
    /** @nocollapse */
    ExportCustomSelectComponent.ctorParameters = function () { return [
        { type: DataExportService },
        { type: NotifyService },
        { type: EntityListService },
        { type: HttpClient },
        { type: LoadingService },
        { type: Injector },
        { type: BsModalService },
        { type: ComponentFactoryResolver }
    ]; };
    ExportCustomSelectComponent.propDecorators = {
        modalFooter: [{ type: ViewChild, args: ['selectFooter',] }],
        ruleId: [{ type: Input }],
        methodType: [{ type: Input }],
        frameContext: [{ type: Input }],
        exportOption: [{ type: Input }],
        needDestroy: [{ type: Output }]
    };
    return ExportCustomSelectComponent;
}());
export { ExportCustomSelectComponent };
if (false) {
    /** @type {?} */
    ExportCustomSelectComponent.prototype.modalFooter;
    /** @type {?} */
    ExportCustomSelectComponent.prototype.ruleId;
    /** @type {?} */
    ExportCustomSelectComponent.prototype.methodType;
    /** @type {?} */
    ExportCustomSelectComponent.prototype.frameContext;
    /** @type {?} */
    ExportCustomSelectComponent.prototype.subject;
    /** @type {?} */
    ExportCustomSelectComponent.prototype.exportOption;
    /** @type {?} */
    ExportCustomSelectComponent.prototype.needDestroy;
    /** @type {?} */
    ExportCustomSelectComponent.prototype.valueField;
    /** @type {?} */
    ExportCustomSelectComponent.prototype.enableRuntimeCustom;
    /** @type {?} */
    ExportCustomSelectComponent.prototype.recordRule;
    /** @type {?} */
    ExportCustomSelectComponent.prototype.currentRuleName;
    /** @type {?} */
    ExportCustomSelectComponent.prototype.currentRuleId;
    /** @type {?} */
    ExportCustomSelectComponent.prototype.currentRuleFileType;
    /** @type {?} */
    ExportCustomSelectComponent.prototype.lookupIcon;
    /** @type {?} */
    ExportCustomSelectComponent.prototype.loadingComp;
    /** @type {?} */
    ExportCustomSelectComponent.prototype.fileListItems;
    /** @type {?} */
    ExportCustomSelectComponent.prototype.file_type;
    /** @type {?} */
    ExportCustomSelectComponent.prototype.export_success;
    /** @type {?} */
    ExportCustomSelectComponent.prototype.export_fail;
    /** @type {?} */
    ExportCustomSelectComponent.prototype.ie_cancel;
    /** @type {?} */
    ExportCustomSelectComponent.prototype.ie_ok;
    /** @type {?} */
    ExportCustomSelectComponent.prototype.rule_list;
    /** @type {?} */
    ExportCustomSelectComponent.prototype.i18nResource;
    /**
     * @type {?}
     * @private
     */
    ExportCustomSelectComponent.prototype.dataExportService;
    /**
     * @type {?}
     * @private
     */
    ExportCustomSelectComponent.prototype.notify;
    /**
     * @type {?}
     * @private
     */
    ExportCustomSelectComponent.prototype.entityService;
    /**
     * @type {?}
     * @private
     */
    ExportCustomSelectComponent.prototype.http;
    /**
     * @type {?}
     * @private
     */
    ExportCustomSelectComponent.prototype.loadingService;
    /**
     * @type {?}
     * @private
     */
    ExportCustomSelectComponent.prototype.injector;
    /**
     * @type {?}
     * @private
     */
    ExportCustomSelectComponent.prototype.modalService;
    /**
     * @type {?}
     * @private
     */
    ExportCustomSelectComponent.prototype.resolver;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZXhwb3J0LWN1c3RvbS1zZWxlY3QuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGdzcC1kaXAvZGF0YS1pbXAtZXhwLyIsInNvdXJjZXMiOlsibGliL2V4cG9ydC1jdXN0b20tc2VsZWN0L2V4cG9ydC1jdXN0b20tc2VsZWN0LmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUNMLFNBQVMsRUFDVCx3QkFBd0IsRUFDeEIsWUFBWSxFQUNaLFFBQVEsRUFDUixLQUFLLEVBRUwsTUFBTSxFQUNOLFdBQVcsRUFDWCxTQUFTLEVBQ1YsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFDLGlCQUFpQixFQUFDLE1BQU0sOENBQThDLENBQUM7QUFDL0UsT0FBTyxFQUFDLGFBQWEsRUFBQyxNQUFNLG1CQUFtQixDQUFDO0FBQ2hELE9BQU8sRUFBQyxXQUFXLEVBQUUsWUFBWSxFQUFDLE1BQU0sZ0JBQWdCLENBQUM7QUFDekQsT0FBTyxFQUFDLGlCQUFpQixFQUFDLE1BQU0sMEJBQTBCLENBQUM7QUFDM0QsT0FBTyxFQUFDLFVBQVUsRUFBQyxNQUFNLHNCQUFzQixDQUFDO0FBQ2hELE9BQU8sRUFBQyxXQUFXLEVBQUUsWUFBWSxFQUFDLE1BQU0sOEJBQThCLENBQUM7QUFDdkUsT0FBTyxFQUFtQixjQUFjLEVBQUMsTUFBTSxvQkFBb0IsQ0FBQztBQUNwRSxPQUFPLEVBQUMsY0FBYyxFQUFDLE1BQU0sa0JBQWtCLENBQUM7QUFDaEQsT0FBTyxFQUFDLG1CQUFtQixFQUFDLE1BQU0sc0NBQXNDLENBQUM7QUFFekUsT0FBTyxFQUFDLFNBQVMsRUFBQyxNQUFNLDBCQUEwQixDQUFDO0FBQ25ELE9BQU8sRUFBQyxVQUFVLEVBQUMsTUFBTSxnQ0FBZ0MsQ0FBQztBQUUxRDtJQXNERSxxQ0FDVSxpQkFBb0MsRUFDcEMsTUFBcUIsRUFDckIsYUFBZ0MsRUFDaEMsSUFBZ0IsRUFDaEIsY0FBOEIsRUFDOUIsUUFBa0IsRUFD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Z0RBQWtCOztJQUNsQixxREFBdUI7O0lBQ3ZCLGtEQUFvQjs7SUFDcEIsZ0RBQWtCOztJQUNsQiw0Q0FBYzs7SUFDZCxnREFBa0I7O0lBQ2xCLG1EQUFrQjs7Ozs7SUFHaEIsd0RBQTRDOzs7OztJQUM1Qyw2Q0FBNkI7Ozs7O0lBQzdCLG9EQUF3Qzs7Ozs7SUFDeEMsMkNBQXdCOzs7OztJQUN4QixxREFBc0M7Ozs7O0lBQ3RDLCtDQUEwQjs7Ozs7SUFDMUIsbURBQW9DOzs7OztJQUNwQywrQ0FBMEMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBDb21wb25lbnQsXG4gIENvbXBvbmVudEZhY3RvcnlSZXNvbHZlcixcbiAgRXZlbnRFbWl0dGVyLFxuICBJbmplY3RvcixcbiAgSW5wdXQsXG4gIE9uRGVzdHJveSxcbiAgT3V0cHV0LFxuICBUZW1wbGF0ZVJlZixcbiAgVmlld0NoaWxkXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHtEYXRhRXhwb3J0U2VydmljZX0gZnJvbSAnLi4vc2VydmljZS9EYXRhSUVTZXJ2aWNlL2RhdGEtZXhwb3J0LnNlcnZpY2UnO1xuaW1wb3J0IHtOb3RpZnlTZXJ2aWNlfSBmcm9tICdAZmFycmlzL3VpLW5vdGlmeSc7XG5pbXBvcnQge0JpbmRpbmdEYXRhLCBGcmFtZUNvbnRleHR9IGZyb20gJ0BmYXJyaXMvZGV2a2l0JztcbmltcG9ydCB7RW50aXR5TGlzdFNlcnZpY2V9IGZyb20gJ0BmYXJyaXMvY29tbWFuZC1zZXJ2aWNlcyc7XG5pbXBvcnQge0h0dHBDbGllbnR9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbi9odHRwJztcbmltcG9ydCB7RGF0YUlFVXRpbHMsIEZpbGVUeXBlVXRpbH0gZnJvbSAnLi4vc2VydmljZS9VdGlscy9EYXRhSUVVdGlscyc7XG5pbXBvcnQge0xvYWRpbmdDb21wb25lbnQsIExvYWRpbmdTZXJ2aWNlfSBmcm9tICdAZmFycmlzL3VpLWxvYWRpbmcnO1xuaW1wb3J0IHtCc01vZGFsU2VydmljZX0gZnJvbSAnQGZhcnJpcy91aS1tb2RhbCc7XG5pbXBvcnQge1J1bGVTZWxlY3RDb21wb25lbnR9IGZyb20gJy4uL3J1bGUtc2VsZWN0L3J1bGUtc2VsZWN0LmNvbXBvbmVudCc7XG5pbXBvcnQge1N1YmplY3R9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHtGaWxlQ29uc3R9IGZyb20gJy4uL21vZGVsL3V0aWxzL0ZpbGVDb25zdCc7XG5pbXBvcnQge01ldGhvZFR5cGV9IGZyb20gJy4uL21vZGVsL0RhdGFJRVR5cGUvTWV0aG9kVHlwZSc7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ2FwcC1leHBvcnQtY3VzdG9tLXNlbGVjdCcsXG4gIHRlbXBsYXRlVXJsOiAnLi9leHBvcnQtY3VzdG9tLXNlbGVjdC5jb21wb25lbnQuaHRtbCcsXG4gIHN0eWxlVXJsczogWycuL2V4cG9ydC1jdXN0b20tc2VsZWN0LmNvbXBvbmVudC5jc3MnXSxcbiAgcHJvdmlkZXJzOiBbTm90aWZ5U2VydmljZSwgRGF0YUV4cG9ydFNlcnZpY2UsIEVudGl0eUxpc3RTZXJ2aWNlLCBCaW5kaW5nRGF0YV1cbn0pXG4vL+iHqumAieaWh+S7tuexu+Wei+WvvOWHulxuZXhwb3J0IGNsYXNzIEV4cG9ydEN1c3RvbVNlbGVjdENvbXBvbmVudCBpbXBsZW1lbnRzIE9uRGVzdHJveSB7XG4gIG5nT25EZXN0cm95KCk6IHZvaWQge1xuICB9XG5cbiAgQFZpZXdDaGlsZCgnc2VsZWN0Rm9vdGVyJykgbW9kYWxGb290ZXI6IFRlbXBsYXRlUmVmPGFueT47XG4gIEBJbnB1dCgpXG4gIHJ1bGVJZCA9ICcnO1xuICBASW5wdXQoKVxuICBtZXRob2RUeXBlOiBNZXRob2RUeXBlO1xuICBASW5wdXQoKVxuICBmcmFtZUNvbnRleHQ6IEZyYW1lQ29udGV4dCA9IG51bGw7XG4gIHN1YmplY3Q6IFN1YmplY3Q8Qm9vbGVhbj4gPSBudWxsO1xuICBASW5wdXQoKVxuICBleHBvcnRPcHRpb246IGFueSA9IG51bGw7XG4gIEBPdXRwdXQoKVxuICBuZWVkRGVzdHJveSA9IG5ldyBFdmVudEVtaXR0ZXI8Ym9vbGVhbj4oKTtcbiAgdmFsdWVGaWVsZDogYW55O1xuXG4gIGVuYWJsZVJ1bnRpbWVDdXN0b20gPSBmYWxzZTtcbiAgLy8g6K6w5b2V55qE6KeE5YiZXG4gIHJlY29yZFJ1bGUgPSBudWxsO1xuICBjdXJyZW50UnVsZU5hbWUgPSAnJztcbiAgY3VycmVudFJ1bGVJZCA9ICcnO1xuICBjdXJyZW50UnVsZUZpbGVUeXBlID0gJyc7XG5cbiAgbG9va3VwSWNvbiA9ICc8aSBjbGFzcz1cImYtaWNvbiBmLWljb24td2luZG93c1wiPjwvaT4nO1xuICBsb2FkaW5nQ29tcDogTG9hZGluZ0NvbXBvbmVudCA9IG51bGw7XG5cbiAgcHVibGljIGZpbGVMaXN0SXRlbXMgPSBbXG4gICAge2lkOiBGaWxlQ29uc3QueGxzLCBsYWJlbDogRmlsZUNvbnN0Lnhsc30sXG4gICAge2lkOiBGaWxlQ29uc3QueGxzeCwgbGFiZWw6IEZpbGVDb25zdC54bHN4fSxcbiAgICB7aWQ6IEZpbGVDb25zdC54bHNtLCBsYWJlbDogRmlsZUNvbnN0Lnhsc219LFxuICAgIHtpZDogRmlsZUNvbnN0LmV0LCBsYWJlbDogRmlsZUNvbnN0LmV0fSxcbiAgICAvLyB7IGlkOiBGaWxlQ29uc3QuY3N2LCBsYWJlbDogRmlsZUNvbnN0LmNzdiB9LFxuICAgIC8vIHsgaWQ6IEZpbGVDb25zdC5wZGYsIGxhYmVsOiBGaWxlQ29uc3QucGRmIH0sXG4gICAgLy8geyBpZDogRmlsZUNvbnN0LnhtbCwgbGFibGU6IEZpbGVDb25zdC54bWwgfVxuICBdO1xuXG5cbiAgZmlsZV90eXBlOiBzdHJpbmc7XG4gIGV4cG9ydF9zdWNjZXNzOiBzdHJpbmc7XG4gIGV4cG9ydF9mYWlsOiBzdHJpbmc7XG4gIGllX2NhbmNlbDogc3RyaW5nO1xuICBpZV9vazogc3RyaW5nO1xuICBydWxlX2xpc3Q6IHN0cmluZztcbiAgaTE4blJlc291cmNlOiBhbnk7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSBkYXRhRXhwb3J0U2VydmljZTogRGF0YUV4cG9ydFNlcnZpY2UsXG4gICAgcHJpdmF0ZSBub3RpZnk6IE5vdGlmeVNlcnZpY2UsXG4gICAgcHJpdmF0ZSBlbnRpdHlTZXJ2aWNlOiBFbnRpdHlMaXN0U2VydmljZSxcbiAgICBwcml2YXRlIGh0dHA6IEh0dHBDbGllbnQsXG4gICAgcHJpdmF0ZSBsb2FkaW5nU2VydmljZTogTG9hZGluZ1NlcnZpY2UsXG4gICAgcHJpdmF0ZSBpbmplY3RvcjogSW5qZWN0b3IsXG4gICAgcHJpdmF0ZSBtb2RhbFNlcnZpY2U6IEJzTW9kYWxTZXJ2aWNlLFxuICAgIHByaXZhdGUgcmVzb2x2ZXI6IENvbXBvbmVudEZhY3RvcnlSZXNvbHZlclxuICApIHtcbiAgICBEYXRhSUVVdGlscy5nZXRUcmFuc2xhdGVWYWx1ZShodHRwKS5zdWJzY3JpYmUocmVzID0+IHtcbiAgICAgIHRoaXMuZXhwb3J0X3N1Y2Nlc3MgPSByZXNbJ2V4cG9ydF9zdWNjZXNzJ107XG4gICAgICB0aGlzLmV4cG9ydF9mYWlsID0gcmVzWydleHBvcnRfZmFpbCddO1xuICAgICAgdGhpcy5maWxlX3R5cGUgPSByZXNbJ2ZpbGVfdHlwZSddO1xuICAgICAgdGhpcy5pZV9jYW5jZWwgPSByZXNbJ2llX2NhbmNlbCddO1xuICAgICAgdGhpcy5pZV9vayA9IHJlc1snaWVfb2snXTtcbiAgICAgIHRoaXMucnVsZV9saXN0ID0gcmVzWydydWxlX2xpc3QnXTtcbiAgICAgIHRoaXMuaTE4blJlc291cmNlID0gcmVzO1xuICAgIH0pO1xuICB9XG5cbiAgbmdPbkluaXQoKSB7XG4gICAgdGhpcy5jdXJyZW50UnVsZUlkID0gdGhpcy5yZWNvcmRSdWxlLnJ1bGVJZDtcbiAgICB0aGlzLmN1cnJlbnRSdWxlTmFtZSA9IHRoaXMucmVjb3JkUnVsZS5ydWxlTmFtZTtcbiAgICB0aGlzLnZhbHVlRmllbGQgPSBGaWxlVHlwZVV0aWwuZ2V0RmlsZVR5cGVOYW1lKHRoaXMucmVjb3JkUnVsZS5maWxlVHlwZSk7XG4gICAgdGhpcy5jdXJyZW50UnVsZUZpbGVUeXBlID0gdGhpcy52YWx1ZUZpZWxkO1xuICAgIGlmICh0aGlzLmV4cG9ydE9wdGlvbi5lbmFibGVSdW50aW1lQ3VzdG9tID09PSB0cnVlKSB7XG4gICAgICB0aGlzLmVuYWJsZVJ1bnRpbWVDdXN0b20gPSB0cnVlO1xuICAgIH1cbiAgfVxuXG4gIG9wZW5TZWxlY3RSdWxlKCRldmVudCkge1xuICAgIHRoaXMubG9hZGluZ0NvbXAgPSB0aGlzLmxvYWRpbmdTZXJ2aWNlLnNob3coKTtcbiAgICAvL+i/h+a7pOinhOWImeaXtueUqOihqOWNleWRveS7pOWkhOmFjee9rueahOinhOWImeadpei/h+a7pO+8jOWboOatpOeUqHJ1bGVJZO+8jOiAjOS4jeaYr2N1cnJlbnRSdWxlSWRcbiAgICBjb25zdCB1cmwgPSAnL2FwaS9ydW50aW1lL2RpcC92MS4wL2RhdGFJZVJ1bGVNYW5hZ2UvZmlsdGVyUnVsZXNCeVJ1bGVJZEFuZFZvSWQnO1xuICAgIGNvbnN0IGJvZHkgPSB7XG4gICAgICBydWxlSWQ6IHRoaXMucnVsZUlkLFxuICAgICAgcnVsZVR5cGU6IDEsXG4gICAgICB2b0lkOiB0aGlzLmV4cG9ydE9wdGlvbi52b0lkLFxuICAgICAgbWV0aG9kVHlwZTogdGhpcy5tZXRob2RUeXBlLFxuICAgICAgZXhwb3J0Q2hpbGROb2RlQ29kZTogdGhpcy5leHBvcnRPcHRpb24uZXhwb3J0Q2hpbGROb2RlQ29kZVxuICAgIH07XG4gICAgdGhpcy5odHRwLnBvc3QodXJsLCBib2R5KS5zdWJzY3JpYmUoKFJ1bGVNZ3JzOiBhbnkpID0+IHtcbiAgICAgIHRoaXMubG9hZGluZ1NlcnZpY2UuY2xlYXJBbGwoKTtcbiAgICAgIGlmIChSdWxlTWdycy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgdGhpcy5ub3RpZnkuaW5mbyh0aGlzLmkxOG5SZXNvdXJjZVsncnVsZXNlbGVjdF9saXN0ZW1wdHknXSk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGNvbnN0IGNvbXBGYWN0b3J5ID0gdGhpcy5yZXNvbHZlci5yZXNvbHZlQ29tcG9uZW50RmFjdG9yeShSdWxlU2VsZWN0Q29tcG9uZW50KTtcbiAgICAgIGNvbnN0IGNvbXBSZWYgPSBjb21wRmFjdG9yeS5jcmVhdGUodGhpcy5pbmplY3Rvcik7XG4gICAgICBjb21wUmVmLmluc3RhbmNlLnJ1bGVJZCA9IHRoaXMucnVsZUlkO1xuICAgICAgY29tcFJlZi5pbnN0YW5jZS52b0lkID0gdGhpcy5leHBvcnRPcHRpb24udm9JZDtcbiAgICAgIGNvbXBSZWYuaW5zdGFuY2UucnVsZVR5cGUgPSAxO1xuICAgICAgY29tcFJlZi5pbnN0YW5jZS5SdWxlTWdyc0RhdGEgPSBSdWxlTWdycztcbiAgICAgIGNvbnN0IG1vZGFsQ29uZmlnID0ge1xuICAgICAgICB0aXRsZTogdGhpcy5ydWxlX2xpc3QsXG4gICAgICAgIHdpZHRoOiA5NTAsXG4gICAgICAgIGhlaWdodDogNTAwLFxuICAgICAgICBidXR0b25zOiBjb21wUmVmLmluc3RhbmNlLm1vZGFsRm9vdGVyLFxuICAgICAgICBzaG93SGVhZGVyOiB0cnVlLFxuICAgICAgICBzaG93TWF4QnV0dG9uOiBmYWxzZSxcbiAgICAgICAgc2hvd0J1dHRvbnM6IHRydWVcbiAgICAgIH07XG4gICAgICBjb25zdCBkaWFsb2cgPSB0aGlzLm1vZGFsU2VydmljZS5zaG93KGNvbXBSZWYsIG1vZGFsQ29uZmlnKTtcbiAgICAgIGNvbXBSZWYuaW5zdGFuY2UuY2xvc2VNb2RhbC5zdWJzY3JpYmUoKCkgPT4ge1xuICAgICAgICBkaWFsb2cuY2xvc2UoKTtcbiAgICAgIH0pXG4gICAgICBjb21wUmVmLmluc3RhbmNlLm9rTW9kYWwuc3Vic2NyaWJlKFJ1bGVNZ3IgPT4ge1xuICAgICAgICB0aGlzLmN1cnJlbnRSdWxlSWQgPSBSdWxlTWdyLmlkO1xuICAgICAgICB0aGlzLmN1cnJlbnRSdWxlTmFtZSA9IFJ1bGVNZ3IubmFtZTtcbiAgICAgICAgdGhpcy52YWx1ZUZpZWxkID0gRmlsZVR5cGVVdGlsLmdldEZpbGVUeXBlTmFtZShSdWxlTWdyLmZpbGVUeXBlKTtcbiAgICAgICAgdGhpcy5jdXJyZW50UnVsZUZpbGVUeXBlID0gdGhpcy52YWx1ZUZpZWxkO1xuICAgICAgICBkaWFsb2cuY2xvc2UoKTtcbiAgICAgIH0pO1xuICAgIH0sIGVycm9yID0+IHtcbiAgICAgIHRoaXMubG9hZGluZ1NlcnZpY2UuY2xlYXJBbGwoKTtcbiAgICAgIHRoaXMubm90aWZ5LmVycm9yKGVycm9yLmVycm9yLk1lc3NhZ2UpO1xuICAgICAgY29uc29sZS5sb2coZXJyb3IuZXJyb3IuTWVzc2FnZSk7XG4gICAgfSk7XG4gIH1cblxuICBwdWJsaWMgT2soKSB7XG4gICAgbGV0IHN1ZmZpeCA9IG51bGw7XG4gICAgaWYgKHRoaXMudmFsdWVGaWVsZCAhPT0gdGhpcy5jdXJyZW50UnVsZUZpbGVUeXBlKSB7XG4gICAgICBzdWZmaXggPSBGaWxlVHlwZVV0aWwuZ2V0RmlsZUV4dGVuc2lvbih0aGlzLnZhbHVlRmllbGQpO1xuICAgIH1cbiAgICBzd2l0Y2ggKHRoaXMubWV0aG9kVHlwZSkge1xuICAgICAgY2FzZSBNZXRob2RUeXBlLkNvbW1vbkV4cG9ydDpcbiAgICAgICAgdGhpcy5kYXRhRXhwb3J0U2VydmljZS5FeHBvcnRCeUlkKHRoaXMuY3VycmVudFJ1bGVJZCwgdGhpcy5mcmFtZUNvbnRleHQsIHRoaXMuZXhwb3J0T3B0aW9uLCBzdWZmaXgpO1xuICAgICAgICB0aGlzLmV4cG9ydENvbXBsZXRlKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBNZXRob2RUeXBlLkV4cG9ydEN1cnJlbnRUYWJsZURhdGE6XG4gICAgICAgIHRoaXMuZGF0YUV4cG9ydFNlcnZpY2UuRXhwb3J0Q3VycmVudERhdGEodGhpcy5jdXJyZW50UnVsZUlkLCB0aGlzLmZyYW1lQ29udGV4dCwgdGhpcy5lbnRpdHlTZXJ2aWNlLnBhZ2VJbmRleCxcbiAgICAgICAgICB0aGlzLmVudGl0eVNlcnZpY2UucGFnZVNpemUsIHRoaXMuZXhwb3J0T3B0aW9uLCBzdWZmaXgpO1xuICAgICAgICB0aGlzLmV4cG9ydENvbXBsZXRlKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBNZXRob2RUeXBlLkV4cG9ydEN1cnJlbnRDaGlsZERhdGE6XG4gICAgICAgIHRoaXMuZGF0YUV4cG9ydFNlcnZpY2UuRXhwb3J0Q3VycmVudENoaWxkRGF0YSh0aGlzLmN1cnJlbnRSdWxlSWQsIHRoaXMuZnJhbWVDb250ZXh0LCB0aGlzLmV4cG9ydE9wdGlvbiwgc3VmZml4KTtcbiAgICAgICAgdGhpcy5leHBvcnRDb21wbGV0ZSgpO1xuICAgICAgICBicmVhaztcbiAgICB9XG4gIH1cblxuICBleHBvcnRDb21wbGV0ZSgpIHtcbiAgICBjb25zdCBleHBvcnRVbnNjcmliZSA9IHRoaXMuZGF0YUV4cG9ydFNlcnZpY2UuZXhwb3J0LnN1YnNjcmliZShkYXRhID0+IHtcbiAgICAgIGlmIChkYXRhID09PSAnJykge1xuICAgICAgICB0aGlzLm5vdGlmeS5zdWNjZXNzKHRoaXMuZXhwb3J0X3N1Y2Nlc3MpO1xuICAgICAgICBleHBvcnRVbnNjcmliZS51bnN1YnNjcmliZSgpO1xuICAgICAgICB0aGlzLnN1YmplY3QubmV4dCh0cnVlKTtcbiAgICAgICAgdGhpcy5zdWJqZWN0LmNvbXBsZXRlKCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zdCBlcnJvcmxldmVsID0gdGhpcy5kYXRhRXhwb3J0U2VydmljZS5lcnJvcmxldmVsO1xuICAgICAgICBpZiAoZXJyb3JsZXZlbCA9PT0gJ0luZm8nKSB7XG4gICAgICAgICAgdGhpcy5ub3RpZnkuaW5mbyhkYXRhKTtcbiAgICAgICAgfSBlbHNlIGlmIChlcnJvcmxldmVsID09PSAnV2FybmluZycpIHtcbiAgICAgICAgICB0aGlzLm5vdGlmeS53YXJuaW5nKGRhdGEpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRoaXMubm90aWZ5LmVycm9yKHRoaXMuZXhwb3J0X2ZhaWwgKyBkYXRhKTtcbiAgICAgICAgfVxuICAgICAgICBleHBvcnRVbnNjcmliZS51bnN1YnNjcmliZSgpO1xuICAgICAgICB0aGlzLnN1YmplY3QubmV4dChmYWxzZSk7XG4gICAgICAgIHRoaXMuc3ViamVjdC5jb21wbGV0ZSgpO1xuICAgICAgfVxuICAgICAgdGhpcy5uZWVkRGVzdHJveS5lbWl0KCk7XG4gICAgfSk7XG4gIH1cblxuICBjYW5TZWxlY3RGaWxlVHlwZSgpIHtcbiAgICBjb25zdCBzdWZmaXggPSBGaWxlVHlwZVV0aWwuZ2V0RmlsZUV4dGVuc2lvbih0aGlzLnZhbHVlRmllbGQpO1xuICAgIGNvbnN0IGNhbkxpc3QgPSBbJy54bHMnLCAnLnhsc3gnLCAnLnhsc20nLCAnLmV0J107XG4gICAgaWYgKGNhbkxpc3QuZmluZEluZGV4KHQgPT4gdCA9PT0gc3VmZml4KSA8IDApIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICBwdWJsaWMgY2xvc2UoKSB7XG4gICAgdGhpcy5uZWVkRGVzdHJveS5lbWl0KCk7XG4gIH1cblxuICBwdWJsaWMgQ2FuY2VsKCkge1xuICAgIHRoaXMubmVlZERlc3Ryb3kuZW1pdCh0cnVlKTtcbiAgfVxufVxuIl19
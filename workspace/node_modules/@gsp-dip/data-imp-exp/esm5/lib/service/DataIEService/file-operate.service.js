/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Injectable, EventEmitter } from '@angular/core';
import { HttpClient } from '@angular/common/http';
import { DataIEUtils } from '../Utils/DataIEUtils';
var FileOperateService = /** @class */ (function () {
    function FileOperateService(http) {
        var _this = this;
        this.http = http;
        this.origin = window.location.origin;
        this.fileUrl = this.origin + '/api/runtime/rtcommon/v1.0/fileoper';
        this.downloadComplete = new EventEmitter();
        DataIEUtils.getTranslateValue(http).subscribe((/**
         * @param {?} res
         * @return {?}
         */
        function (res) {
            _this.file_download_fail = res['file_download_fail'];
        }));
    }
    // 下载文件
    // 下载文件
    /**
     * @param {?} relativePath
     * @param {?} fileName
     * @param {?} preurl
     * @param {?} option
     * @param {?=} needDelete
     * @return {?}
     */
    FileOperateService.prototype.DownloadFile = 
    // 下载文件
    /**
     * @param {?} relativePath
     * @param {?} fileName
     * @param {?} preurl
     * @param {?} option
     * @param {?=} needDelete
     * @return {?}
     */
    function (relativePath, fileName, preurl, option, needDelete) {
        var _this = this;
        if (needDelete === void 0) { needDelete = true; }
        /** @type {?} */
        var tempUrl = '';
        if (preurl === '') {
            tempUrl = this.fileUrl;
        }
        else {
            tempUrl = preurl + "/fileoper";
        }
        /** @type {?} */
        var app = DataIEUtils.getApp(tempUrl);
        /** @type {?} */
        var su = DataIEUtils.getSu(tempUrl);
        if (option !== null && option['su'] !== null && option['su'] !== undefined) {
            su = option['su'];
        }
        /** @type {?} */
        var fileParam = {
            relativePath: relativePath,
            app: app,
            su: su
        };
        /** @type {?} */
        var fixedUrl = this.origin + '/api/runtime/dip/v1.0/rpcfileoper';
        this.http.post(fixedUrl + "/DownloadFile", fileParam, {
            headers: {
                'Content-Type': 'application/json',
                'Access-Control-Allow-Origin': '*'
            },
            responseType: 'blob',
            observe: 'response',
            params: { su: su }
        }).subscribe((/**
         * @param {?} filedata
         * @return {?}
         */
        function (filedata) {
            if (!filedata || filedata.body.size == 0) {
                _this.downloadComplete.emit(_this.file_download_fail);
            }
            else {
                //const blob = new Blob([filedata.body], {type: 'application/vnd.ms-excel'});
                /** @type {?} */
                var blob = new Blob([filedata.body]);
                if (navigator.msSaveOrOpenBlob) {
                    navigator.msSaveOrOpenBlob(blob, fileName);
                }
                else {
                    /** @type {?} */
                    var link = document.createElement('a');
                    link.setAttribute('href', window.URL.createObjectURL(blob));
                    // 设置下载的文件名
                    link.setAttribute('download', fileName);
                    link.style.visibility = 'hidden';
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                }
                _this.downloadComplete.emit('');
                if (needDelete) {
                    _this.DeleteFile(relativePath, preurl, su);
                }
            }
        }), (/**
         * @param {?} error
         * @return {?}
         */
        function (error) {
            _this.downloadComplete.error(error);
        }));
        // 添加error异常处理
    };
    // 打包文件下载文件
    // 打包文件下载文件
    /**
     * @param {?} relativePaths
     * @param {?} itemsFileName
     * @param {?} packageName
     * @param {?} preurl
     * @param {?} packtype
     * @param {?=} needDelete
     * @return {?}
     */
    FileOperateService.prototype.DownloadPackageFile = 
    // 打包文件下载文件
    /**
     * @param {?} relativePaths
     * @param {?} itemsFileName
     * @param {?} packageName
     * @param {?} preurl
     * @param {?} packtype
     * @param {?=} needDelete
     * @return {?}
     */
    function (relativePaths, itemsFileName, packageName, preurl, packtype, needDelete) {
        var _this = this;
        if (needDelete === void 0) { needDelete = true; }
        /** @type {?} */
        var tempUrl = '';
        if (preurl === '') {
            tempUrl = this.fileUrl;
        }
        else {
            tempUrl = preurl + "/fileoper";
        }
        /** @type {?} */
        var app = DataIEUtils.getApp(tempUrl);
        /** @type {?} */
        var su = DataIEUtils.getSu(tempUrl);
        /** @type {?} */
        var fileParam = {
            relativePaths: relativePaths,
            itemsFileName: itemsFileName,
            packType: packtype,
            packageName: packageName,
            su: su
        };
        /** @type {?} */
        var fixedUrl = this.origin + '/api/runtime/dip/v1.0/rpcfileoper';
        this.http.post(fixedUrl + "/DownloadPackageFile", fileParam, {
            headers: {
                'Content-Type': 'application/json',
                'Access-Control-Allow-Origin': '*'
            },
            responseType: 'blob',
            observe: 'response',
            params: { su: su }
        }).subscribe((/**
         * @param {?} filedata
         * @return {?}
         */
        function (filedata) {
            if (!filedata || filedata.body.size == 0) {
                _this.downloadComplete.emit(_this.file_download_fail);
            }
            else {
                /** @type {?} */
                var blob = new Blob([filedata.body]);
                // 设置下载的文件名
                /** @type {?} */
                var downloadFileName = packageName + '.' + packtype;
                if (navigator.msSaveOrOpenBlob) {
                    navigator.msSaveOrOpenBlob(blob, downloadFileName);
                }
                else {
                    /** @type {?} */
                    var link = document.createElement('a');
                    link.setAttribute('href', window.URL.createObjectURL(blob));
                    link.setAttribute('download', downloadFileName);
                    link.style.visibility = 'hidden';
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                }
                _this.downloadComplete.emit('');
                if (needDelete) {
                    _this.DeleteFile(downloadFileName, preurl);
                }
            }
        }), (/**
         * @param {?} error
         * @return {?}
         */
        function (error) {
            _this.downloadComplete.error(error);
        }));
        // 添加error异常处理
    };
    /**
     * 手工表单下载
     * @param relativePath
     * @param fileName
     * @param su
     * @param needDelete
     */
    /**
     * 手工表单下载
     * @param {?} relativePath
     * @param {?} fileName
     * @param {?} su
     * @param {?=} needDelete
     * @return {?}
     */
    FileOperateService.prototype.DownloadFile4HandCraft = /**
     * 手工表单下载
     * @param {?} relativePath
     * @param {?} fileName
     * @param {?} su
     * @param {?=} needDelete
     * @return {?}
     */
    function (relativePath, fileName, su, needDelete) {
        var _this = this;
        if (needDelete === void 0) { needDelete = true; }
        /** @type {?} */
        var fileParam = {
            relativePath: relativePath,
            app: '',
            su: su
        };
        /** @type {?} */
        var fixedUrl = this.origin + '/api/runtime/dip/v1.0/rpcfileoper';
        this.http.post(fixedUrl + "/DownloadFile", fileParam, {
            headers: {
                'Content-Type': 'application/json',
                'Access-Control-Allow-Origin': '*'
            },
            responseType: 'blob',
            observe: 'response',
            params: { su: su }
        }).subscribe((/**
         * @param {?} filedata
         * @return {?}
         */
        function (filedata) {
            if (!filedata || filedata.body.size == 0) {
                _this.downloadComplete.emit(_this.file_download_fail);
            }
            else {
                /** @type {?} */
                var blob = new Blob([filedata.body]);
                if (navigator.msSaveOrOpenBlob) {
                    navigator.msSaveOrOpenBlob(blob, fileName);
                }
                else {
                    /** @type {?} */
                    var link = document.createElement('a');
                    link.setAttribute('href', window.URL.createObjectURL(blob));
                    // 设置下载的文件名
                    link.setAttribute('download', fileName);
                    link.style.visibility = 'hidden';
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                }
                _this.downloadComplete.emit('');
                if (needDelete) {
                    _this.DeleteFile4HandCraft(relativePath, su);
                }
            }
        }), (/**
         * @param {?} error
         * @return {?}
         */
        function (error) {
            _this.downloadComplete.error(error);
        }));
        // 添加error异常处理
    };
    // 删除文件
    // 删除文件
    /**
     * @param {?} relativePath
     * @param {?} preurl
     * @param {?=} customSu
     * @return {?}
     */
    FileOperateService.prototype.DeleteFile = 
    // 删除文件
    /**
     * @param {?} relativePath
     * @param {?} preurl
     * @param {?=} customSu
     * @return {?}
     */
    function (relativePath, preurl, customSu) {
        if (customSu === void 0) { customSu = ''; }
        /** @type {?} */
        var tempUrl = '';
        if (preurl === '') {
            tempUrl = this.fileUrl;
        }
        else {
            tempUrl = preurl + "/fileoper";
        }
        /** @type {?} */
        var su = '';
        if (customSu !== '') {
            su = customSu;
        }
        else {
            su = DataIEUtils.getSu(tempUrl);
        }
        /** @type {?} */
        var delParam = {
            relativePath: relativePath,
            su: su
        };
        /** @type {?} */
        var fixedUrl = this.origin + '/api/runtime/dip/v1.0/rpcfileoper';
        this.http.post(fixedUrl + "/DeleteFile", delParam, {
            params: { su: su }
        }).subscribe();
    };
    /**
     * @param {?} relativePath
     * @param {?} su
     * @return {?}
     */
    FileOperateService.prototype.DeleteFile4HandCraft = /**
     * @param {?} relativePath
     * @param {?} su
     * @return {?}
     */
    function (relativePath, su) {
        /** @type {?} */
        var delParam = {
            relativePath: relativePath,
            su: su
        };
        /** @type {?} */
        var fixedUrl = this.origin + '/api/runtime/dip/v1.0/rpcfileoper';
        this.http.post(fixedUrl + "/DeleteFile", delParam, {
            params: { su: su }
        }).subscribe();
    };
    FileOperateService.decorators = [
        { type: Injectable }
    ];
    /** @nocollapse */
    FileOperateService.ctorParameters = function () { return [
        { type: HttpClient }
    ]; };
    return FileOperateService;
}());
export { FileOperateService };
if (false) {
    /**
     * @type {?}
     * @private
     */
    FileOperateService.prototype.origin;
    /**
     * @type {?}
     * @private
     */
    FileOperateService.prototype.fileUrl;
    /** @type {?} */
    FileOperateService.prototype.downloadComplete;
    /**
     * @type {?}
     * @private
     */
    FileOperateService.prototype.file_download_fail;
    /**
     * @type {?}
     * @private
     */
    FileOperateService.prototype.http;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmlsZS1vcGVyYXRlLnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZ3NwLWRpcC9kYXRhLWltcC1leHAvIiwic291cmNlcyI6WyJsaWIvc2VydmljZS9EYXRhSUVTZXJ2aWNlL2ZpbGUtb3BlcmF0ZS5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFVLFlBQVksRUFBWSxNQUFNLGVBQWUsQ0FBQztBQUMzRSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFDbEQsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBRW5EO0lBTUUsNEJBQ1UsSUFBZ0I7UUFEMUIsaUJBT0M7UUFOUyxTQUFJLEdBQUosSUFBSSxDQUFZO1FBTGxCLFdBQU0sR0FBRyxNQUFNLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQztRQUNoQyxZQUFPLEdBQUcsSUFBSSxDQUFDLE1BQU0sR0FBRyxxQ0FBcUMsQ0FBQztRQU1wRSxJQUFJLENBQUMsZ0JBQWdCLEdBQUcsSUFBSSxZQUFZLEVBQUUsQ0FBQztRQUMzQyxXQUFXLENBQUMsaUJBQWlCLENBQUMsSUFBSSxDQUFDLENBQUMsU0FBUzs7OztRQUFDLFVBQUEsR0FBRztZQUMvQyxLQUFJLENBQUMsa0JBQWtCLEdBQUcsR0FBRyxDQUFDLG9CQUFvQixDQUFDLENBQUM7UUFDdEQsQ0FBQyxFQUFDLENBQUM7SUFDTCxDQUFDO0lBQ0QsT0FBTzs7Ozs7Ozs7OztJQUNQLHlDQUFZOzs7Ozs7Ozs7O0lBQVosVUFBYSxZQUFvQixFQUFFLFFBQWdCLEVBQUUsTUFBYyxFQUFFLE1BQVcsRUFBRSxVQUEwQjtRQUE1RyxpQkE0REM7UUE1RGlGLDJCQUFBLEVBQUEsaUJBQTBCOztZQUV0RyxPQUFPLEdBQUcsRUFBRTtRQUNoQixJQUFJLE1BQU0sS0FBSyxFQUFFLEVBQUU7WUFDakIsT0FBTyxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUM7U0FDeEI7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LFFBQVEsZ0JBQWEsRUFDeEIsUUFBUSxFQUNSO1lBQ0UsTUFBTSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRTtTQUNuQixDQUNGLENBQUMsU0FBUyxFQUFFLENBQUM7SUFDaEIsQ0FBQzs7Ozs7O0lBQ0QsaURBQW9COzs7OztJQUFwQixVQUFxQixZQUFvQixFQUFFLEVBQVU7O1lBQzdDLFFBQVEsR0FBRztZQUNmLFlBQVksRUFBRSxZQUFZO1lBQzFCLEVBQUUsRUFBRSxFQUFFO1NBQ1A7O1lBQ0ssUUFBUSxHQUFHLElBQUksQ0FBQyxNQUFNLEdBQUcsbUNBQW1DO1FBQ2xFLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUNULFFBQVEsZ0JBQWEsRUFDeEIsUUFBUSxFQUNSO1lBQ0UsTUFBTSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRTtTQUNuQixDQUNGLENBQUMsU0FBUyxFQUFFLENBQUM7SUFDaEIsQ0FBQzs7Z0JBdk9GLFVBQVU7Ozs7Z0JBSEYsVUFBVTs7SUEyT25CLHlCQUFDO0NBQUEsQUF4T0QsSUF3T0M7U0F2T1ksa0JBQWtCOzs7Ozs7SUFDN0Isb0NBQXdDOzs7OztJQUN4QyxxQ0FBc0U7O0lBQ3RFLDhDQUE2Qjs7Ozs7SUFDN0IsZ0RBQW1DOzs7OztJQUVqQyxrQ0FBd0IiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlLCBPdXRwdXQsIEV2ZW50RW1pdHRlciwgSW5qZWN0b3IgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgSHR0cENsaWVudCB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbi9odHRwJztcclxuaW1wb3J0IHsgRGF0YUlFVXRpbHMgfSBmcm9tICcuLi9VdGlscy9EYXRhSUVVdGlscyc7XHJcblxyXG5ASW5qZWN0YWJsZSgpXHJcbmV4cG9ydCBjbGFzcyBGaWxlT3BlcmF0ZVNlcnZpY2Uge1xyXG4gIHByaXZhdGUgb3JpZ2luID0gd2luZG93LmxvY2F0aW9uLm9yaWdpbjtcclxuICBwcml2YXRlIGZpbGVVcmwgPSB0aGlzLm9yaWdpbiArICcvYXBpL3J1bnRpbWUvcnRjb21tb24vdjEuMC9maWxlb3Blcic7XHJcbiAgcHVibGljIGRvd25sb2FkQ29tcGxldGU6IGFueTtcclxuICBwcml2YXRlIGZpbGVfZG93bmxvYWRfZmFpbDogc3RyaW5nO1xyXG4gIGNvbnN0cnVjdG9yKFxyXG4gICAgcHJpdmF0ZSBodHRwOiBIdHRwQ2xpZW50LFxyXG4gICkge1xyXG4gICAgdGhpcy5kb3dubG9hZENvbXBsZXRlID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG4gICAgRGF0YUlFVXRpbHMuZ2V0VHJhbnNsYXRlVmFsdWUoaHR0cCkuc3Vic2NyaWJlKHJlcyA9PiB7XHJcbiAgICAgIHRoaXMuZmlsZV9kb3dubG9hZF9mYWlsID0gcmVzWydmaWxlX2Rvd25sb2FkX2ZhaWwnXTtcclxuICAgIH0pO1xyXG4gIH1cclxuICAvLyDkuIvovb3mlofku7ZcclxuICBEb3dubG9hZEZpbGUocmVsYXRpdmVQYXRoOiBzdHJpbmcsIGZpbGVOYW1lOiBzdHJpbmcsIHByZXVybDogc3RyaW5nLCBvcHRpb246IGFueSwgbmVlZERlbGV0ZTogYm9vbGVhbiA9IHRydWUpIHtcclxuXHJcbiAgICBsZXQgdGVtcFVybCA9ICcnO1xyXG4gICAgaWYgKHByZXVybCA9PT0gJycpIHtcclxuICAgICAgdGVtcFVybCA9IHRoaXMuZmlsZVVybDtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRlbXBVcmwgPSBgJHtwcmV1cmx9L2ZpbGVvcGVyYDtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBhcHAgPSBEYXRhSUVVdGlscy5nZXRBcHAodGVtcFVybCk7XHJcbiAgICBsZXQgc3UgPSBEYXRhSUVVdGlscy5nZXRTdSh0ZW1wVXJsKTtcclxuICAgIGlmIChvcHRpb24gIT09IG51bGwgJiYgb3B0aW9uWydzdSddICE9PSBudWxsICYmIG9wdGlvblsnc3UnXSAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgIHN1ID0gb3B0aW9uWydzdSddO1xyXG4gICAgfVxyXG4gICAgY29uc3QgZmlsZVBhcmFtID0ge1xyXG4gICAgICByZWxhdGl2ZVBhdGg6IHJlbGF0aXZlUGF0aCxcclxuICAgICAgYXBwOiBhcHAsXHJcbiAgICAgIHN1OiBzdVxyXG4gICAgfTtcclxuICAgIGNvbnN0IGZpeGVkVXJsID0gdGhpcy5vcmlnaW4gKyAnL2FwaS9ydW50aW1lL2RpcC92MS4wL3JwY2ZpbGVvcGVyJztcclxuXHJcbiAgICB0aGlzLmh0dHAucG9zdChcclxuICAgICAgYCR7Zml4ZWRVcmx9L0Rvd25sb2FkRmlsZWAsXHJcbiAgICAgIGZpbGVQYXJhbSxcclxuICAgICAge1xyXG4gICAgICAgIGhlYWRlcnM6IHtcclxuICAgICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsXHJcbiAgICAgICAgICAnQWNjZXNzLUNvbnRyb2wtQWxsb3ctT3JpZ2luJzogJyonXHJcbiAgICAgICAgfSxcclxuICAgICAgICByZXNwb25zZVR5cGU6ICdibG9iJyxcclxuICAgICAgICBvYnNlcnZlOiAncmVzcG9uc2UnLFxyXG4gICAgICAgIHBhcmFtczogeyBzdTogc3UgfVxyXG4gICAgICB9XHJcbiAgICApLnN1YnNjcmliZShmaWxlZGF0YSA9PiB7XHJcbiAgICAgIGlmICghZmlsZWRhdGEgfHwgZmlsZWRhdGEuYm9keS5zaXplID09IDApIHtcclxuICAgICAgICB0aGlzLmRvd25sb2FkQ29tcGxldGUuZW1pdCh0aGlzLmZpbGVfZG93bmxvYWRfZmFpbCk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgLy9jb25zdCBibG9iID0gbmV3IEJsb2IoW2ZpbGVkYXRhLmJvZHldLCB7dHlwZTogJ2FwcGxpY2F0aW9uL3ZuZC5tcy1leGNlbCd9KTtcclxuICAgICAgICBjb25zdCBibG9iID0gbmV3IEJsb2IoW2ZpbGVkYXRhLmJvZHldKTtcclxuICAgICAgICBpZiAobmF2aWdhdG9yLm1zU2F2ZU9yT3BlbkJsb2IpIHtcclxuICAgICAgICAgIG5hdmlnYXRvci5tc1NhdmVPck9wZW5CbG9iKGJsb2IsIGZpbGVOYW1lKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgY29uc3QgbGluayA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTtcclxuICAgICAgICAgIGxpbmsuc2V0QXR0cmlidXRlKCdocmVmJywgd2luZG93LlVSTC5jcmVhdGVPYmplY3RVUkwoYmxvYikpO1xyXG4gICAgICAgICAgLy8g6K6+572u5LiL6L2955qE5paH5Lu25ZCNXHJcbiAgICAgICAgICBsaW5rLnNldEF0dHJpYnV0ZSgnZG93bmxvYWQnLCBmaWxlTmFtZSk7XHJcbiAgICAgICAgICBsaW5rLnN0eWxlLnZpc2liaWxpdHkgPSAnaGlkZGVuJztcclxuICAgICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQobGluayk7XHJcbiAgICAgICAgICBsaW5rLmNsaWNrKCk7XHJcbiAgICAgICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKGxpbmspO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmRvd25sb2FkQ29tcGxldGUuZW1pdCgnJyk7XHJcbiAgICAgICAgaWYgKG5lZWREZWxldGUpIHtcclxuICAgICAgICAgIHRoaXMuRGVsZXRlRmlsZShyZWxhdGl2ZVBhdGgsIHByZXVybCwgc3UpO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfSwgZXJyb3IgPT4ge1xyXG4gICAgICB0aGlzLmRvd25sb2FkQ29tcGxldGUuZXJyb3IoZXJyb3IpO1xyXG4gICAgfSk7XHJcbiAgICAvLyDmt7vliqBlcnJvcuW8guW4uOWkhOeQhlxyXG4gIH1cclxuICAvLyDmiZPljIXmlofku7bkuIvovb3mlofku7ZcclxuICBEb3dubG9hZFBhY2thZ2VGaWxlKHJlbGF0aXZlUGF0aHM6IGFueSwgaXRlbXNGaWxlTmFtZTogYW55LCBwYWNrYWdlTmFtZTogc3RyaW5nLCBwcmV1cmw6IHN0cmluZywgcGFja3R5cGU6IHN0cmluZywgbmVlZERlbGV0ZTogYm9vbGVhbiA9IHRydWUpIHtcclxuXHJcbiAgICBsZXQgdGVtcFVybCA9ICcnO1xyXG4gICAgaWYgKHByZXVybCA9PT0gJycpIHtcclxuICAgICAgdGVtcFVybCA9IHRoaXMuZmlsZVVybDtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRlbXBVcmwgPSBgJHtwcmV1cmx9L2ZpbGVvcGVyYDtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBhcHAgPSBEYXRhSUVVdGlscy5nZXRBcHAodGVtcFVybCk7XHJcbiAgICBjb25zdCBzdSA9IERhdGFJRVV0aWxzLmdldFN1KHRlbXBVcmwpO1xyXG4gICAgY29uc3QgZmlsZVBhcmFtID0ge1xyXG4gICAgICByZWxhdGl2ZVBhdGhzOiByZWxhdGl2ZVBhdGhzLFxyXG4gICAgICBpdGVtc0ZpbGVOYW1lOiBpdGVtc0ZpbGVOYW1lLFxyXG4gICAgICBwYWNrVHlwZTogcGFja3R5cGUsXHJcbiAgICAgIHBhY2thZ2VOYW1lOiBwYWNrYWdlTmFtZSxcclxuICAgICAgc3U6IHN1XHJcbiAgICB9O1xyXG4gICAgY29uc3QgZml4ZWRVcmwgPSB0aGlzLm9yaWdpbiArICcvYXBpL3J1bnRpbWUvZGlwL3YxLjAvcnBjZmlsZW9wZXInO1xyXG5cclxuICAgIHRoaXMuaHR0cC5wb3N0KFxyXG4gICAgICBgJHtmaXhlZFVybH0vRG93bmxvYWRQYWNrYWdlRmlsZWAsXHJcbiAgICAgIGZpbGVQYXJhbSxcclxuICAgICAge1xyXG4gICAgICAgIGhlYWRlcnM6IHtcclxuICAgICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsXHJcbiAgICAgICAgICAnQWNjZXNzLUNvbnRyb2wtQWxsb3ctT3JpZ2luJzogJyonXHJcbiAgICAgICAgfSxcclxuICAgICAgICByZXNwb25zZVR5cGU6ICdibG9iJyxcclxuICAgICAgICBvYnNlcnZlOiAncmVzcG9uc2UnLFxyXG4gICAgICAgIHBhcmFtczogeyBzdTogc3UgfVxyXG4gICAgICB9XHJcbiAgICApLnN1YnNjcmliZShmaWxlZGF0YSA9PiB7XHJcbiAgICAgIGlmICghZmlsZWRhdGEgfHwgZmlsZWRhdGEuYm9keS5zaXplID09IDApIHtcclxuICAgICAgICB0aGlzLmRvd25sb2FkQ29tcGxldGUuZW1pdCh0aGlzLmZpbGVfZG93bmxvYWRfZmFpbCk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgY29uc3QgYmxvYiA9IG5ldyBCbG9iKFtmaWxlZGF0YS5ib2R5XSk7XHJcbiAgICAgICAgLy8g6K6+572u5LiL6L2955qE5paH5Lu25ZCNXHJcbiAgICAgICAgY29uc3QgZG93bmxvYWRGaWxlTmFtZSA9IHBhY2thZ2VOYW1lICsgJy4nICsgcGFja3R5cGU7XHJcbiAgICAgICAgaWYgKG5hdmlnYXRvci5tc1NhdmVPck9wZW5CbG9iKSB7XHJcbiAgICAgICAgICBuYXZpZ2F0b3IubXNTYXZlT3JPcGVuQmxvYihibG9iLCBkb3dubG9hZEZpbGVOYW1lKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgY29uc3QgbGluayA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTtcclxuICAgICAgICAgIGxpbmsuc2V0QXR0cmlidXRlKCdocmVmJywgd2luZG93LlVSTC5jcmVhdGVPYmplY3RVUkwoYmxvYikpO1xyXG4gICAgICAgICAgbGluay5zZXRBdHRyaWJ1dGUoJ2Rvd25sb2FkJywgZG93bmxvYWRGaWxlTmFtZSk7XHJcbiAgICAgICAgICBsaW5rLnN0eWxlLnZpc2liaWxpdHkgPSAnaGlkZGVuJztcclxuICAgICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQobGluayk7XHJcbiAgICAgICAgICBsaW5rLmNsaWNrKCk7XHJcbiAgICAgICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKGxpbmspO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmRvd25sb2FkQ29tcGxldGUuZW1pdCgnJyk7XHJcbiAgICAgICAgaWYgKG5lZWREZWxldGUpIHtcclxuICAgICAgICAgIHRoaXMuRGVsZXRlRmlsZShkb3dubG9hZEZpbGVOYW1lLCBwcmV1cmwpO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfSwgZXJyb3IgPT4ge1xyXG4gICAgICB0aGlzLmRvd25sb2FkQ29tcGxldGUuZXJyb3IoZXJyb3IpO1xyXG4gICAgfSk7XHJcbiAgICAvLyDmt7vliqBlcnJvcuW8guW4uOWkhOeQhlxyXG4gIH1cclxuICAvKipcclxuICAgKiDmiYvlt6XooajljZXkuIvovb1cclxuICAgKiBAcGFyYW0gcmVsYXRpdmVQYXRoIFxyXG4gICAqIEBwYXJhbSBmaWxlTmFtZSBcclxuICAgKiBAcGFyYW0gc3UgXHJcbiAgICogQHBhcmFtIG5lZWREZWxldGUgXHJcbiAgICovXHJcbiAgRG93bmxvYWRGaWxlNEhhbmRDcmFmdChyZWxhdGl2ZVBhdGg6IHN0cmluZywgZmlsZU5hbWU6IHN0cmluZywgc3U6IHN0cmluZywgbmVlZERlbGV0ZTogYm9vbGVhbiA9IHRydWUpIHtcclxuICAgIGNvbnN0IGZpbGVQYXJhbSA9IHtcclxuICAgICAgcmVsYXRpdmVQYXRoOiByZWxhdGl2ZVBhdGgsXHJcbiAgICAgIGFwcDogJycsXHJcbiAgICAgIHN1OiBzdVxyXG4gICAgfTtcclxuICAgIGNvbnN0IGZpeGVkVXJsID0gdGhpcy5vcmlnaW4gKyAnL2FwaS9ydW50aW1lL2RpcC92MS4wL3JwY2ZpbGVvcGVyJztcclxuXHJcbiAgICB0aGlzLmh0dHAucG9zdChcclxuICAgICAgYCR7Zml4ZWRVcmx9L0Rvd25sb2FkRmlsZWAsXHJcbiAgICAgIGZpbGVQYXJhbSxcclxuICAgICAge1xyXG4gICAgICAgIGhlYWRlcnM6IHtcclxuICAgICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsXHJcbiAgICAgICAgICAnQWNjZXNzLUNvbnRyb2wtQWxsb3ctT3JpZ2luJzogJyonXHJcbiAgICAgICAgfSxcclxuICAgICAgICByZXNwb25zZVR5cGU6ICdibG9iJyxcclxuICAgICAgICBvYnNlcnZlOiAncmVzcG9uc2UnLFxyXG4gICAgICAgIHBhcmFtczogeyBzdTogc3UgfVxyXG4gICAgICB9XHJcbiAgICApLnN1YnNjcmliZShmaWxlZGF0YSA9PiB7XHJcbiAgICAgIGlmICghZmlsZWRhdGEgfHwgZmlsZWRhdGEuYm9keS5zaXplID09IDApIHtcclxuICAgICAgICB0aGlzLmRvd25sb2FkQ29tcGxldGUuZW1pdCh0aGlzLmZpbGVfZG93bmxvYWRfZmFpbCk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgY29uc3QgYmxvYiA9IG5ldyBCbG9iKFtmaWxlZGF0YS5ib2R5XSk7XHJcbiAgICAgICAgaWYgKG5hdmlnYXRvci5tc1NhdmVPck9wZW5CbG9iKSB7XHJcbiAgICAgICAgICBuYXZpZ2F0b3IubXNTYXZlT3JPcGVuQmxvYihibG9iLCBmaWxlTmFtZSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIGNvbnN0IGxpbmsgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7XHJcbiAgICAgICAgICBsaW5rLnNldEF0dHJpYnV0ZSgnaHJlZicsIHdpbmRvdy5VUkwuY3JlYXRlT2JqZWN0VVJMKGJsb2IpKTtcclxuICAgICAgICAgIC8vIOiuvue9ruS4i+i9veeahOaWh+S7tuWQjVxyXG4gICAgICAgICAgbGluay5zZXRBdHRyaWJ1dGUoJ2Rvd25sb2FkJywgZmlsZU5hbWUpO1xyXG4gICAgICAgICAgbGluay5zdHlsZS52aXNpYmlsaXR5ID0gJ2hpZGRlbic7XHJcbiAgICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGxpbmspO1xyXG4gICAgICAgICAgbGluay5jbGljaygpO1xyXG4gICAgICAgICAgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZChsaW5rKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5kb3dubG9hZENvbXBsZXRlLmVtaXQoJycpO1xyXG4gICAgICAgIGlmIChuZWVkRGVsZXRlKSB7XHJcbiAgICAgICAgICB0aGlzLkRlbGV0ZUZpbGU0SGFuZENyYWZ0KHJlbGF0aXZlUGF0aCwgc3UpO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfSwgZXJyb3IgPT4ge1xyXG4gICAgICB0aGlzLmRvd25sb2FkQ29tcGxldGUuZXJyb3IoZXJyb3IpO1xyXG4gICAgfSk7XHJcbiAgICAvLyDmt7vliqBlcnJvcuW8guW4uOWkhOeQhlxyXG4gIH1cclxuICAvLyDliKDpmaTmlofku7ZcclxuICBEZWxldGVGaWxlKHJlbGF0aXZlUGF0aDogc3RyaW5nLCBwcmV1cmw6IHN0cmluZywgY3VzdG9tU3U6IHN0cmluZyA9ICcnKSB7XHJcbiAgICBsZXQgdGVtcFVybCA9ICcnO1xyXG4gICAgaWYgKHByZXVybCA9PT0gJycpIHtcclxuICAgICAgdGVtcFVybCA9IHRoaXMuZmlsZVVybDtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRlbXBVcmwgPSBgJHtwcmV1cmx9L2ZpbGVvcGVyYDtcclxuICAgIH1cclxuICAgIGxldCBzdSA9ICcnO1xyXG4gICAgaWYgKGN1c3RvbVN1ICE9PSAnJykge1xyXG4gICAgICBzdSA9IGN1c3RvbVN1O1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgc3UgPSBEYXRhSUVVdGlscy5nZXRTdSh0ZW1wVXJsKTtcclxuICAgIH1cclxuICAgIGNvbnN0IGRlbFBhcmFtID0ge1xyXG4gICAgICByZWxhdGl2ZVBhdGg6IHJlbGF0aXZlUGF0aCxcclxuICAgICAgc3U6IHN1XHJcbiAgICB9O1xyXG4gICAgY29uc3QgZml4ZWRVcmwgPSB0aGlzLm9yaWdpbiArICcvYXBpL3J1bnRpbWUvZGlwL3YxLjAvcnBjZmlsZW9wZXInO1xyXG4gICAgdGhpcy5odHRwLnBvc3QoXHJcbiAgICAgIGAke2ZpeGVkVXJsfS9EZWxldGVGaWxlYCxcclxuICAgICAgZGVsUGFyYW0sXHJcbiAgICAgIHtcclxuICAgICAgICBwYXJhbXM6IHsgc3U6IHN1IH1cclxuICAgICAgfVxyXG4gICAgKS5zdWJzY3JpYmUoKTtcclxuICB9XHJcbiAgRGVsZXRlRmlsZTRIYW5kQ3JhZnQocmVsYXRpdmVQYXRoOiBzdHJpbmcsIHN1OiBzdHJpbmcpIHtcclxuICAgIGNvbnN0IGRlbFBhcmFtID0ge1xyXG4gICAgICByZWxhdGl2ZVBhdGg6IHJlbGF0aXZlUGF0aCxcclxuICAgICAgc3U6IHN1XHJcbiAgICB9O1xyXG4gICAgY29uc3QgZml4ZWRVcmwgPSB0aGlzLm9yaWdpbiArICcvYXBpL3J1bnRpbWUvZGlwL3YxLjAvcnBjZmlsZW9wZXInO1xyXG4gICAgdGhpcy5odHRwLnBvc3QoXHJcbiAgICAgIGAke2ZpeGVkVXJsfS9EZWxldGVGaWxlYCxcclxuICAgICAgZGVsUGFyYW0sXHJcbiAgICAgIHtcclxuICAgICAgICBwYXJhbXM6IHsgc3U6IHN1IH1cclxuICAgICAgfVxyXG4gICAgKS5zdWJzY3JpYmUoKTtcclxuICB9XHJcbn1cclxuIl19
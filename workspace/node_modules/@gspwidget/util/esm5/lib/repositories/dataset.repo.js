/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { HttpClient, HttpHeaders } from '@angular/common/http';
import { Injectable } from '@angular/core';
import { map } from 'rxjs/operators';
import { addBaseUrl, DATA_PREFIX } from '../const';
import { Agg, Dataset, DpValue, RuntimeAggOption } from '../types/data.type';
import * as i0 from "@angular/core";
import * as i1 from "@angular/common/http";
/** @type {?} */
export var datasetUrls = {
    GET_BY_ID: DATA_PREFIX + "/DataSetService/find/",
    CREATE: DATA_PREFIX + "/DataSetService/create",
    IMPORT_QO: DATA_PREFIX + "/DataSetService/importQO",
    DELETE: DATA_PREFIX + "/DataSetService/delete",
    GET_ALL: DATA_PREFIX + "/DataSetService/findAll",
    // 500
    GET_RAW_DIMS_BY_DATASET: DATA_PREFIX + "/DataResultSetService/tryGetDimensions",
    GET_RAW_DATA_BY_DATASET: DATA_PREFIX + "/DataResultSetService/getResultSet",
    UPDATE: DATA_PREFIX + "/DataSetService/update",
};
/** @type {?} */
export var aggUrls = {
    SAVE: DATA_PREFIX + "/DataSetService/saveAggConfig",
    GET_BY_RESOURCE: DATA_PREFIX + "/DataSetService/findAggConfigByResource",
};
/** @type {?} */
export var dataResultSetUrls = {
    GET_BY_AGG_ID: DATA_PREFIX + "/DataResultSetService/getAggResultSet/{aggId}",
    // ?
    GET_BY_AGG: DATA_PREFIX + "/DataResultSetService/getAggResultSetForTest",
    GET_BY_DATASET: DATA_PREFIX + "/DataResultSetService/getResultSet",
    // 原始数据，用不到
    GET_BY_RESOURCE: DATA_PREFIX + "/DataResultSetService/getResultSetByResource",
};
addBaseUrl(datasetUrls);
addBaseUrl(aggUrls);
addBaseUrl(dataResultSetUrls);
var DatasetRepo = /** @class */ (function () {
    function DatasetRepo(http) {
        this.http = http;
    }
    /**
     * @param {?} datasetDto
     * @return {?}
     */
    DatasetRepo.prototype.getRawDimsByDataset = /**
     * @param {?} datasetDto
     * @return {?}
     */
    function (datasetDto) {
        return this.http
            .post(datasetUrls.GET_RAW_DIMS_BY_DATASET, datasetDto);
    };
    /**
     * @param {?} datasetDto
     * @return {?}
     */
    DatasetRepo.prototype.getRawColsNDataByDataset = /**
     * @param {?} datasetDto
     * @return {?}
     */
    function (datasetDto) {
        return this.http
            .post(datasetUrls.GET_RAW_DATA_BY_DATASET, datasetDto);
    };
    /**
     * @return {?}
     */
    DatasetRepo.prototype.getDatasets = /**
     * @return {?}
     */
    function () {
        return this.http
            .get(datasetUrls.GET_ALL)
            .pipe(map((/**
         * @param {?} datasetDtos
         * @return {?}
         */
        function (datasetDtos) { return datasetDtos.map(Dataset.fromDto); })));
    };
    /**
     * @param {?} id
     * @return {?}
     */
    DatasetRepo.prototype.getDatasetById = /**
     * @param {?} id
     * @return {?}
     */
    function (id) {
        return this.http
            .get(datasetUrls.GET_BY_ID + id)
            .pipe(map(Dataset.fromDto));
    };
    /**
     * @param {?} datasetDto
     * @return {?}
     */
    DatasetRepo.prototype.saveDataset = /**
     * @param {?} datasetDto
     * @return {?}
     */
    function (datasetDto) {
        return this.http.post(datasetDto.id ? datasetUrls.UPDATE : datasetUrls.CREATE, 
        // Dataset.toDto(dataset)
        datasetDto).pipe(map(Dataset.fromDto));
        // TODO:
        // , this.success()
    };
    /**
     * @param {?} ids
     * @return {?}
     */
    DatasetRepo.prototype.importQO = /**
     * @param {?} ids
     * @return {?}
     */
    function (ids) {
        return this.http.post(datasetUrls.IMPORT_QO, ids);
    };
    /**
     * @param {?} datasetId
     * @return {?}
     */
    DatasetRepo.prototype.deleteDataset = /**
     * @param {?} datasetId
     * @return {?}
     */
    function (datasetId) {
        return this.http
            .post(datasetUrls.DELETE, null, { params: { id: datasetId } });
        // TODO:
        // .pipe(this.success())
    };
    /** agg */
    /**
     * agg
     * @param {?} portletId
     * @return {?}
     */
    DatasetRepo.prototype.getAggByPortletId = /**
     * agg
     * @param {?} portletId
     * @return {?}
     */
    function (portletId) {
        return this.http.get(aggUrls.GET_BY_RESOURCE, {
            params: {
                resource: 'portlet',
                resourceId: portletId
            }
        }).pipe(map(Agg.fromDto));
    };
    /**
     * @param {?} agg
     * @return {?}
     */
    DatasetRepo.prototype.saveAgg = /**
     * @param {?} agg
     * @return {?}
     */
    function (agg) {
        return this.http
            .post(aggUrls.SAVE, Agg.toDto(agg));
    };
    /** result */
    /**
     * result
     * @param {?} agg
     * @param {?=} dpValues
     * @param {?=} runtimeAgg
     * @return {?}
     */
    DatasetRepo.prototype.getAggResultByAgg = /**
     * result
     * @param {?} agg
     * @param {?=} dpValues
     * @param {?=} runtimeAgg
     * @return {?}
     */
    function (agg, dpValues, runtimeAgg) {
        if (dpValues === void 0) { dpValues = []; }
        /** @type {?} */
        var body = {
            aggDataDto: Agg.toDto(agg),
            aggregation: RuntimeAggOption.toDto(runtimeAgg)
        }
        // dataParam 为 [] 服务端会报错，若没有直接不传此参数。
        ;
        // dataParam 为 [] 服务端会报错，若没有直接不传此参数。
        if (dpValues && dpValues.length > 0)
            body.dataParam = dpValues.map(DpValue.toDto);
        return this.http.post(dataResultSetUrls.GET_BY_AGG, body);
    };
    /**
     * @param {?} portletId
     * @param {?=} dpValues
     * @param {?=} filter
     * @param {?=} runtimeAgg
     * @return {?}
     */
    DatasetRepo.prototype.getResultByPortletId = /**
     * @param {?} portletId
     * @param {?=} dpValues
     * @param {?=} filter
     * @param {?=} runtimeAgg
     * @return {?}
     */
    function (portletId, dpValues, filter, runtimeAgg) {
        if (dpValues === void 0) { dpValues = []; }
        if (filter === void 0) { filter = '""'; }
        /** @type {?} */
        var body = {
            filter: filter,
            aggregation: RuntimeAggOption.toDto(runtimeAgg)
        }
        // dataParam 为 [] 服务端会报错，若没有直接不传此参数。
        ;
        // dataParam 为 [] 服务端会报错，若没有直接不传此参数。
        if (dpValues && dpValues.length > 0)
            body.dataParam = dpValues.map(DpValue.toDto);
        return this.http.post(dataResultSetUrls.GET_BY_RESOURCE, body, {
            headers: new HttpHeaders({ 'Content-Type': 'application/json' }),
            params: {
                resourceType: 'portlet',
                resourceId: portletId
            }
        });
    };
    DatasetRepo.decorators = [
        { type: Injectable, args: [{
                    providedIn: 'root'
                },] }
    ];
    /** @nocollapse */
    DatasetRepo.ctorParameters = function () { return [
        { type: HttpClient }
    ]; };
    /** @nocollapse */ DatasetRepo.ngInjectableDef = i0.defineInjectable({ factory: function DatasetRepo_Factory() { return new DatasetRepo(i0.inject(i1.HttpClient)); }, token: DatasetRepo, providedIn: "root" });
    return DatasetRepo;
}());
export { DatasetRepo };
if (false) {
    /**
     * @type {?}
     * @private
     */
    DatasetRepo.prototype.http;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0YXNldC5yZXBvLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGdzcHdpZGdldC91dGlsLyIsInNvdXJjZXMiOlsibGliL3JlcG9zaXRvcmllcy9kYXRhc2V0LnJlcG8udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsV0FBVyxFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFDL0QsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUMzQyxPQUFPLEVBQUUsR0FBRyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDckMsT0FBTyxFQUFFLFVBQVUsRUFBRSxXQUFXLEVBQUUsTUFBTSxVQUFVLENBQUM7QUFDbkQsT0FBTyxFQUFFLEdBQUcsRUFBYSxPQUFPLEVBQXlCLE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLG9CQUFvQixDQUFDOzs7O0FBRS9HLE1BQU0sS0FBTyxXQUFXLEdBQUc7SUFDekIsU0FBUyxFQUFLLFdBQVcsMEJBQXVCO0lBQ2hELE1BQU0sRUFBSyxXQUFXLDJCQUF3QjtJQUM5QyxTQUFTLEVBQUssV0FBVyw2QkFBMEI7SUFDbkQsTUFBTSxFQUFLLFdBQVcsMkJBQXdCO0lBQzlDLE9BQU8sRUFBSyxXQUFXLDRCQUF5Qjs7SUFDaEQsdUJBQXVCLEVBQUssV0FBVywyQ0FBd0M7SUFDL0UsdUJBQXVCLEVBQUssV0FBVyx1Q0FBb0M7SUFDM0UsTUFBTSxFQUFLLFdBQVcsMkJBQXdCO0NBQy9DOztBQUNELE1BQU0sS0FBTyxPQUFPLEdBQUc7SUFDckIsSUFBSSxFQUFLLFdBQVcsa0NBQStCO0lBQ25ELGVBQWUsRUFBSyxXQUFXLDRDQUF5QztDQUN6RTs7QUFDRCxNQUFNLEtBQU8saUJBQWlCLEdBQUc7SUFDL0IsYUFBYSxFQUFLLFdBQVcsa0RBQStDOztJQUM1RSxVQUFVLEVBQUssV0FBVyxpREFBOEM7SUFDeEUsY0FBYyxFQUFLLFdBQVcsdUNBQW9DOztJQUNsRSxlQUFlLEVBQUssV0FBVyxp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QyxDQUFDO1lBQzlELE1BQU0sRUFBRTtnQkFDTixZQUFZLEVBQUUsU0FBUztnQkFDdkIsVUFBVSxFQUFFLFNBQVM7YUFDdEI7U0FDRixDQUNGLENBQUE7SUFDSCxDQUFDOztnQkFuR0YsVUFBVSxTQUFDO29CQUNWLFVBQVUsRUFBRSxNQUFNO2lCQUNuQjs7OztnQkFoQ1EsVUFBVTs7O3NCQUFuQjtDQWtJQyxBQXBHRCxJQW9HQztTQWpHWSxXQUFXOzs7Ozs7SUFHcEIsMkJBQXdCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSHR0cENsaWVudCwgSHR0cEhlYWRlcnMgfSBmcm9tICdAYW5ndWxhci9jb21tb24vaHR0cCc7XG5pbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBtYXAgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQgeyBhZGRCYXNlVXJsLCBEQVRBX1BSRUZJWCB9IGZyb20gJy4uL2NvbnN0JztcbmltcG9ydCB7IEFnZywgQWdnUmVzdWx0LCBEYXRhc2V0LCBEYXRhc2V0RHRvLCBEaW1lbnNpb24sIERwVmFsdWUsIFJ1bnRpbWVBZ2dPcHRpb24gfSBmcm9tICcuLi90eXBlcy9kYXRhLnR5cGUnO1xuXG5leHBvcnQgY29uc3QgZGF0YXNldFVybHMgPSB7XG4gIEdFVF9CWV9JRDogYCR7REFUQV9QUkVGSVh9L0RhdGFTZXRTZXJ2aWNlL2ZpbmQvYCxcbiAgQ1JFQVRFOiBgJHtEQVRBX1BSRUZJWH0vRGF0YVNldFNlcnZpY2UvY3JlYXRlYCxcbiAgSU1QT1JUX1FPOiBgJHtEQVRBX1BSRUZJWH0vRGF0YVNldFNlcnZpY2UvaW1wb3J0UU9gLFxuICBERUxFVEU6IGAke0RBVEFfUFJFRklYfS9EYXRhU2V0U2VydmljZS9kZWxldGVgLFxuICBHRVRfQUxMOiBgJHtEQVRBX1BSRUZJWH0vRGF0YVNldFNlcnZpY2UvZmluZEFsbGAsIC8vIDUwMFxuICBHRVRfUkFXX0RJTVNfQllfREFUQVNFVDogYCR7REFUQV9QUkVGSVh9L0RhdGFSZXN1bHRTZXRTZXJ2aWNlL3RyeUdldERpbWVuc2lvbnNgLFxuICBHRVRfUkFXX0RBVEFfQllfREFUQVNFVDogYCR7REFUQV9QUkVGSVh9L0RhdGFSZXN1bHRTZXRTZXJ2aWNlL2dldFJlc3VsdFNldGAsXG4gIFVQREFURTogYCR7REFUQV9QUkVGSVh9L0RhdGFTZXRTZXJ2aWNlL3VwZGF0ZWAsXG59XG5leHBvcnQgY29uc3QgYWdnVXJscyA9IHtcbiAgU0FWRTogYCR7REFUQV9QUkVGSVh9L0RhdGFTZXRTZXJ2aWNlL3NhdmVBZ2dDb25maWdgLFxuICBHRVRfQllfUkVTT1VSQ0U6IGAke0RBVEFfUFJFRklYfS9EYXRhU2V0U2VydmljZS9maW5kQWdnQ29uZmlnQnlSZXNvdXJjZWAsXG59XG5leHBvcnQgY29uc3QgZGF0YVJlc3VsdFNldFVybHMgPSB7XG4gIEdFVF9CWV9BR0dfSUQ6IGAke0RBVEFfUFJFRklYfS9EYXRhUmVzdWx0U2V0U2VydmljZS9nZXRBZ2dSZXN1bHRTZXQve2FnZ0lkfWAsIC8vID9cbiAgR0VUX0JZX0FHRzogYCR7REFUQV9QUkVGSVh9L0RhdGFSZXN1bHRTZXRTZXJ2aWNlL2dldEFnZ1Jlc3VsdFNldEZvclRlc3RgLFxuICBHRVRfQllfREFUQVNFVDogYCR7REFUQV9QUkVGSVh9L0RhdGFSZXN1bHRTZXRTZXJ2aWNlL2dldFJlc3VsdFNldGAsIC8vIOWOn+Wni+aVsOaNru+8jOeUqOS4jeWIsFxuICBHRVRfQllfUkVTT1VSQ0U6IGAke0RBVEFfUFJFRklYfS9EYXRhUmVzdWx0U2V0U2VydmljZS9nZXRSZXN1bHRTZXRCeVJlc291cmNlYCwgLy9cbn1cbmFkZEJhc2VVcmwoZGF0YXNldFVybHMpXG5hZGRCYXNlVXJsKGFnZ1VybHMpXG5hZGRCYXNlVXJsKGRhdGFSZXN1bHRTZXRVcmxzKVxuXG5ASW5qZWN0YWJsZSh7XG4gIHByb3ZpZGVkSW46ICdyb290J1xufSlcbmV4cG9ydCBjbGFzcyBEYXRhc2V0UmVwbyB7XG5cbiAgY29uc3RydWN0b3IgKFxuICAgIHByaXZhdGUgaHR0cDogSHR0cENsaWVudCxcbiAgKSB7IH1cblxuICBnZXRSYXdEaW1zQnlEYXRhc2V0IChkYXRhc2V0RHRvOiBEYXRhc2V0RHRvKSB7XG4gICAgcmV0dXJuIHRoaXMuaHR0cFxuICAgICAgLnBvc3Q8RGltZW5zaW9uW10+KGRhdGFzZXRVcmxzLkdFVF9SQVdfRElNU19CWV9EQVRBU0VULCBkYXRhc2V0RHRvKVxuICB9XG4gIGdldFJhd0NvbHNORGF0YUJ5RGF0YXNldCAoZGF0YXNldER0bzogRGF0YXNldER0bykge1xuICAgIHJldHVybiB0aGlzLmh0dHBcbiAgICAgIC5wb3N0PHtjb2x1bW5zOiBzdHJpbmdbXSwgZGF0YTphbnlbXX0+KGRhdGFzZXRVcmxzLkdFVF9SQVdfREFUQV9CWV9EQVRBU0VULCBkYXRhc2V0RHRvKVxuICB9XG4gIGdldERhdGFzZXRzICgpIHtcbiAgICByZXR1cm4gdGhpcy5odHRwXG4gICAgICAuZ2V0PERhdGFzZXREdG9bXT4oZGF0YXNldFVybHMuR0VUX0FMTClcbiAgICAgIC5waXBlKG1hcChkYXRhc2V0RHRvcyA9PiBkYXRhc2V0RHRvcy5tYXAoRGF0YXNldC5mcm9tRHRvKSkpXG4gIH1cbiAgZ2V0RGF0YXNldEJ5SWQgKGlkOiBzdHJpbmcpIHtcbiAgICByZXR1cm4gdGhpcy5odHRwXG4gICAgICAuZ2V0PERhdGFzZXREdG8+KGRhdGFzZXRVcmxzLkdFVF9CWV9JRCArIGlkKVxuICAgICAgLnBpcGUobWFwKERhdGFzZXQuZnJvbUR0bykpXG4gIH1cbiAgc2F2ZURhdGFzZXQgKGRhdGFzZXREdG86IERhdGFzZXREdG8pIHtcbiAgICByZXR1cm4gdGhpcy5odHRwLnBvc3Q8RGF0YXNldER0bz4oXG4gICAgICBkYXRhc2V0RHRvLmlkID8gZGF0YXNldFVybHMuVVBEQVRFIDogZGF0YXNldFVybHMuQ1JFQVRFLFxuICAgICAgLy8gRGF0YXNldC50b0R0byhkYXRhc2V0KVxuICAgICAgZGF0YXNldER0b1xuICAgICkucGlwZShtYXAoRGF0YXNldC5mcm9tRHRvKSlcbiAgICAvLyBUT0RPOlxuICAgIC8vICwgdGhpcy5zdWNjZXNzKClcbiAgfVxuICBpbXBvcnRRTyAoaWRzOiBzdHJpbmdbXSkge1xuICAgIHJldHVybiB0aGlzLmh0dHAucG9zdChkYXRhc2V0VXJscy5JTVBPUlRfUU8sIGlkcylcbiAgfVxuICBkZWxldGVEYXRhc2V0IChkYXRhc2V0SWQ6IHN0cmluZykge1xuICAgIHJldHVybiB0aGlzLmh0dHBcbiAgICAgIC5wb3N0PGFueT4oZGF0YXNldFVybHMuREVMRVRFLCBudWxsLCB7IHBhcmFtczogeyBpZDogZGF0YXNldElkIH0gfSlcbiAgICAgIC8vIFRPRE86XG4gICAgICAvLyAucGlwZSh0aGlzLnN1Y2Nlc3MoKSlcbiAgfVxuXG4gIC8qKiBhZ2cgKi9cbiAgZ2V0QWdnQnlQb3J0bGV0SWQgKHBvcnRsZXRJZDogc3RyaW5nKSB7XG4gICAgcmV0dXJuIHRoaXMuaHR0cC5nZXQ8QWdnPihhZ2dVcmxzLkdFVF9CWV9SRVNPVVJDRSwge1xuICAgICAgcGFyYW1zOiB7XG4gICAgICAgIHJlc291cmNlOiAncG9ydGxldCcsXG4gICAgICAgIHJlc291cmNlSWQ6IHBvcnRsZXRJZFxuICAgICAgfVxuICAgIH0pLnBpcGUobWFwKEFnZy5mcm9tRHRvKSlcbiAgfVxuICBzYXZlQWdnIChhZ2c6IEFnZykge1xuICAgIHJldHVybiB0aGlzLmh0dHBcbiAgICAgIC5wb3N0PEFnZz4oYWdnVXJscy5TQVZFLCBBZ2cudG9EdG8oYWdnKSlcbiAgfVxuXG4gIC8qKiByZXN1bHQgKi9cbiAgZ2V0QWdnUmVzdWx0QnlBZ2cgKFxuICAgIGFnZzogQWdnLFxuICAgIGRwVmFsdWVzOiBEcFZhbHVlW10gPSBbXSxcbiAgICBydW50aW1lQWdnPzogUnVudGltZUFnZ09wdGlvblxuICApIHtcbiAgICBjb25zdCBib2R5OiBhbnkgPSB7XG4gICAgICBhZ2dEYXRhRHRvOiBBZ2cudG9EdG8oYWdnKSxcbiAgICAgIGFnZ3JlZ2F0aW9uOiBSdW50aW1lQWdnT3B0aW9uLnRvRHRvKHJ1bnRpbWVBZ2cpXG4gICAgfVxuICAgIC8vIGRhdGFQYXJhbSDkuLogW10g5pyN5Yqh56uv5Lya5oql6ZSZ77yM6Iul5rKh5pyJ55u05o6l5LiN5Lyg5q2k5Y+C5pWw44CCXG4gICAgaWYgKGRwVmFsdWVzICYmIGRwVmFsdWVzLmxlbmd0aCA+IDApIGJvZHkuZGF0YVBhcmFtID0gZHBWYWx1ZXMubWFwKERwVmFsdWUudG9EdG8pXG4gICAgcmV0dXJuIHRoaXMuaHR0cC5wb3N0PEFnZ1Jlc3VsdD4oZGF0YVJlc3VsdFNldFVybHMuR0VUX0JZX0FHRywgYm9keSlcbiAgfVxuICBnZXRSZXN1bHRCeVBvcnRsZXRJZCAoXG4gICAgcG9ydGxldElkOiBzdHJpbmcsXG4gICAgZHBWYWx1ZXM6IERwVmFsdWVbXSA9IFtdLFxuICAgIGZpbHRlciA9ICdcIlwiJyxcbiAgICBydW50aW1lQWdnPzogUnVudGltZUFnZ09wdGlvblxuICAgICkge1xuXG4gICAgY29uc3QgYm9keTogYW55ID0ge1xuICAgICAgZmlsdGVyLFxuICAgICAgYWdncmVnYXRpb246IFJ1bnRpbWVBZ2dPcHRpb24udG9EdG8ocnVudGltZUFnZylcbiAgICB9XG4gICAgLy8gZGF0YVBhcmFtIOS4uiBbXSDmnI3liqHnq6/kvJrmiqXplJnvvIzoi6XmsqHmnInnm7TmjqXkuI3kvKDmraTlj4LmlbDjgIJcbiAgICBpZiAoZHBWYWx1ZXMgJiYgZHBWYWx1ZXMubGVuZ3RoID4gMCkgYm9keS5kYXRhUGFyYW0gPSBkcFZhbHVlcy5tYXAoRHBWYWx1ZS50b0R0bylcblxuICAgIHJldHVybiB0aGlzLmh0dHAucG9zdDxBZ2dSZXN1bHQ+KFxuICAgICAgZGF0YVJlc3VsdFNldFVybHMuR0VUX0JZX1JFU09VUkNFLFxuICAgICAgYm9keSxcbiAgICAgIHtcbiAgICAgICAgaGVhZGVyczogbmV3IEh0dHBIZWFkZXJzKHsnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nfSksXG4gICAgICAgIHBhcmFtczoge1xuICAgICAgICAgIHJlc291cmNlVHlwZTogJ3BvcnRsZXQnLFxuICAgICAgICAgIHJlc291cmNlSWQ6IHBvcnRsZXRJZFxuICAgICAgICB9XG4gICAgICB9XG4gICAgKVxuICB9XG59XG4iXX0=
/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { HttpClient } from '@angular/common/http';
import { Injectable } from '@angular/core';
import { from, of } from 'rxjs';
import { map } from 'rxjs/operators';
import { list2Tree } from '../misc';
import { Lang } from '../types/common.type';
import { BAPortlet } from '../types/portlet.type';
import * as i0 from "@angular/core";
import * as i1 from "@angular/common/http";
/** @type {?} */
export var igixUrls = {
    bo: {
        GET_ALL: "/api/dev/main/v1.0/business-objects"
    },
    funcOperations: {
        GET_BY_BO_ID: "/api/runtime/sys/v1.0/funcOperations/business/"
    },
    roleGroup: {
        GET_ALL: "/api/runtime/sys/v1.0/rolegroups/all"
    },
    role: {
        GET: "/api/runtime/sys/v1.0/roles",
    },
    userInfo: {
        // igix 的 userInfo 里有头像
        GET: "/api/runtime/sys/v1.0/userinfos?infoType=user"
        // GET: `http://dscloud.chec.bj.cn/api/runime/sys/v1.0/userinfos/setting`
    },
    func: {
        /**
         * 包含了所有菜单、联查，体积大、加载较慢
         */
        GET_ALL_WITH_INVOKE: "/api/runtime/sys/v1.0/functions/allFuncs",
        /**
         * 这个是 iGIX 我的应用中的菜单、功能组列表，数据量稍小，性能较好
         */
        GET_ALL: "/api/runtime/sys/v1.0/functions/funcGroups?funcType=4"
    },
    langs: {
        GET_ALL: "/api/runtime/sys/v1.0/loginInfo?infoType=supportedLanguage"
    },
    qoDataset: {
        // GET_BO_TREE: `/api/gsp/bcc/v1.0/botreefornavvo/extension/query`,
        GET_ECP_BIZ_TREE: "/api/gsp/bcc/v1.0/ecpbiztree/extension/query",
        GET_DETAIL_BY_ID: "/api/gsp/bcc/v1.0/datasetdetail_frm/extension/retrieve/",
        GET_DETAIL_QUERY: "/api/gsp/bcc/v1.0/datasetdetail_frm/extension/query"
    },
    ba: {
        // GET_ALL_PORTLETS: `/api/ba/bap/v1.0/category/getCloudCategoryList?type=widget`,
        GET_ALL_PORTLETS: "/api/ba/bap/v1.0/widget/getCloudWidgetList?allWidgetList=true",
    }
    // TODO: su http://10.24.20.77:5200/api/dev/main/v1.0/business-objects/
    // http://localhost:5000/api/dev/main/v1.0/business-object-trees
};
var IgixRepo = /** @class */ (function () {
    function IgixRepo(http) {
        this.http = http;
    }
    /**
     * @param {?=} layer
     * @return {?}
     */
    IgixRepo.prototype.getBOTree = /**
     * @param {?=} layer
     * @return {?}
     */
    function (layer) {
        if (layer === void 0) { layer = Infinity; }
        return this.http.get(igixUrls.bo.GET_ALL).pipe(map((/**
         * @param {?} boList
         * @return {?}
         */
        function (boList) {
            return list2Tree(boList, {
                parentIdKey: 'parentID',
                ifIgnore: (/**
                 * @param {?} item
                 * @return {?}
                 */
                function (item) { return item.layer > layer; })
            });
        })));
    };
    /**
     * @param {?} boId
     * @return {?}
     */
    IgixRepo.prototype.getOpsByBOId = /**
     * @param {?} boId
     * @return {?}
     */
    function (boId) {
        return this.http.get(igixUrls.funcOperations.GET_BY_BO_ID + boId);
    };
    /** role, role group */
    /**
     * role, role group
     * @return {?}
     */
    IgixRepo.prototype.getRoleGroupTree = /**
     * role, role group
     * @return {?}
     */
    function () {
        return this.http.get(igixUrls.roleGroup.GET_ALL).pipe(map((/**
         * @param {?} roleGroups
         * @return {?}
         */
        function (roleGroups) {
            return list2Tree(roleGroups, {});
        })));
    };
    /**
     * @param {?} groupId
     * @return {?}
     */
    IgixRepo.prototype.getRolesByRoleGroupId = /**
     * @param {?} groupId
     * @return {?}
     */
    function (groupId) {
        return this.http.get(igixUrls.role.GET, {
            params: {
                param: JSON.stringify({ groupId: groupId })
            }
        }).pipe(map((/**
         * @param {?} res
         * @return {?}
         */
        function (res) { return res.data; })));
    };
    /**
     * @return {?}
     */
    IgixRepo.prototype.getAllRoles = /**
     * @return {?}
     */
    function () {
        return this.http.get(igixUrls.role.GET).pipe(map((/**
         * @param {?} res
         * @return {?}
         */
        function (res) { return res.data; })));
    };
    /** 获取部件列表需要的二级 bo tree */
    /**
     * 获取部件列表需要的二级 bo tree
     * @return {?}
     */
    IgixRepo.prototype.getFuncTree12 = /**
     * 获取部件列表需要的二级 bo tree
     * @return {?}
     */
    function () {
        var _this = this;
        if (this.funcTree12)
            return of(this.funcTree12);
        return this.getAllFuncs()
            .pipe(map((/**
         * @param {?} funcs
         * @return {?}
         */
        function (funcs) {
            funcs = funcs.filter((/**
             * @param {?} func
             * @return {?}
             */
            function (func) { return parseInt(func.layer) < 3; }));
            _this.funcTree12 = list2Tree(funcs, {
                rootParentIdValue: '0',
                parentIdKey: 'parentId',
            });
            return _this.funcTree12;
        })));
    };
    /**
     * @param {?} moduleId
     * @return {?}
     */
    IgixRepo.prototype.getQoDatasetDetailsByModuleId = /**
     * @param {?} moduleId
     * @return {?}
     */
    function (moduleId) {
        return this.http.put(igixUrls.qoDataset.GET_DETAIL_QUERY, {}, {
            params: {
                entityFilter: JSON.stringify({
                    FilterConditions: [{
                            FilterField: 'moduleID',
                            Compare: 0,
                            Value: moduleId,
                            Relation: 0
                        }],
                    SortConditions: [],
                    IsUsePagination: true,
                    Pagination: {
                        PageIndex: 1,
                        PageSize: 20,
                        // TODO:
                        PageCount: 0,
                        TotalCount: 0
                    }
                })
            }
            // }, null).pipe(map(res => res.returnValue))
        }).pipe(map((/**
         * @param {?} res
         * @return {?}
         */
        function (res) { return res.returnValue.result; })));
    };
    /**
     * @param {?} id
     * @return {?}
     */
    IgixRepo.prototype.getQoDatasetDetailById = /**
     * @param {?} id
     * @return {?}
     */
    function (id) {
        return this.http.put(igixUrls.qoDataset.GET_DETAIL_BY_ID + id, {}).pipe(map((/**
         * @param {?} res
         * @return {?}
         */
        function (res) { return res.returnValue; })));
    };
    /**
     * @param {?=} reload
     * @return {?}
     */
    IgixRepo.prototype.getUserInfo = /**
     * @param {?=} reload
     * @return {?}
     */
    function (reload) {
        if (reload === void 0) { reload = false; }
        if (reload)
            this.userInfoPromise = null;
        if (!this.userInfoPromise)
            this.userInfoPromise = this.http
                .get(igixUrls.userInfo.GET)
                .toPromise();
        return from(this.userInfoPromise);
    };
    /**
     * @param {?=} reload
     * @return {?}
     */
    IgixRepo.prototype.getUserAvatar = /**
     * @param {?=} reload
     * @return {?}
     */
    function (reload) {
        if (reload === void 0) { reload = false; }
        return this.getUserInfo(reload).pipe(map((/**
         * @param {?} userInfo
         * @return {?}
         */
        function (userInfo) {
            if (userInfo && userInfo.userSetting && userInfo.userSetting.imgblob)
                return userInfo.userSetting.imgblob;
            return null;
        })));
    };
    /**
     * @return {?}
     */
    IgixRepo.prototype.getAllFuncs = /**
     * @return {?}
     */
    function () {
        return this.http.get(igixUrls.func.GET_ALL);
    };
    /**
     * @return {?}
     */
    IgixRepo.prototype.getBAPortletsAll = /**
     * @return {?}
     */
    function () {
        return this.http
            .get(igixUrls.ba.GET_ALL_PORTLETS).pipe(
        // map(res => JSON.parse(res)),
        map((/**
         * @param {?} res
         * @return {?}
         */
        function (res) { return res.data
            // .filter(p => p.tab === 1)
            .map((/**
         * @param {?} p
         * @return {?}
         */
        function (p) { return Object.assign(new BAPortlet(), p); })); })));
    };
    /**
     * @return {?}
     */
    IgixRepo.prototype.getLangs = /**
     * @return {?}
     */
    function () {
        if (!this.getLangsPromise)
            this.getLangsPromise = this.http
                .get(igixUrls.langs.GET_ALL)
                .pipe(map((/**
             * @param {?} rtfLangs
             * @return {?}
             */
            function (rtfLangs) { return rtfLangs.map((/**
             * @param {?} rtfLang
             * @return {?}
             */
            function (rtfLang) { return new Lang(rtfLang.code, rtfLang.name); })); })))
                .toPromise();
        return this.getLangsPromise;
    };
    IgixRepo.decorators = [
        { type: Injectable, args: [{
                    providedIn: 'root'
                },] }
    ];
    /** @nocollapse */
    IgixRepo.ctorParameters = function () { return [
        { type: HttpClient }
    ]; };
    /** @nocollapse */ IgixRepo.ngInjectableDef = i0.defineInjectable({ factory: function IgixRepo_Factory() { return new IgixRepo(i0.inject(i1.HttpClient)); }, token: IgixRepo, providedIn: "root" });
    return IgixRepo;
}());
export { IgixRepo };
if (false) {
    /** @type {?} */
    IgixRepo.prototype.funcTree12;
    /**
     * 获取 igix 用户信息
     * \@param reload 默认为假，不再发出请求，使用已缓存的结果；真则重新请求
     * @type {?}
     */
    IgixRepo.prototype.userInfoPromise;
    /** @type {?} */
    IgixRepo.prototype.getLangsPromise;
    /**
     * @type {?}
     * @private
     */
    IgixRepo.prototype.http;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaWdpeC5yZXBvLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGdzcHdpZGdldC91dGlsLyIsInNvdXJjZXMiOlsibGliL3JlcG9zaXRvcmllcy9pZ2l4LnJlcG8udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUNsRCxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBRTNDLE9BQU8sRUFBRSxJQUFJLEVBQWMsRUFBRSxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQzVDLE9BQU8sRUFBRSxHQUFHLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUNyQyxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sU0FBUyxDQUFDO0FBQ3BDLE9BQU8sRUFBRSxJQUFJLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUc1QyxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sdUJBQXVCLENBQUM7Ozs7QUFFbEQsTUFBTSxLQUFPLFFBQVEsR0FBRztJQUN0QixFQUFFLEVBQUU7UUFDRixPQUFPLEVBQUUscUNBQXFDO0tBQy9DO0lBQ0QsY0FBYyxFQUFFO1FBQ2QsWUFBWSxFQUFFLGdEQUFnRDtLQUMvRDtJQUNELFNBQVMsRUFBRTtRQUNULE9BQU8sRUFBRSxzQ0FBc0M7S0FDaEQ7SUFDRCxJQUFJLEVBQUU7UUFDSixHQUFHLEVBQUUsNkJBQTZCO0tBQ25DO0lBQ0QsUUFBUSxFQUFFOztRQUNSLEdBQUcsRUFBRSwrQ0FBK0M7UUFDcEQseUVBQXlFO0tBQzFFO0lBQ0QsSUFBSSxFQUFFOzs7O1FBRUosbUJBQW1CLEVBQUUsMENBQTBDOzs7O1FBRS9ELE9BQU8sRUFBRSx1REFBdUQ7S0FDakU7SUFDRCxLQUFLLEVBQUU7UUFDTCxPQUFPLEVBQUUsNERBQTREO0tBQ3RFO0lBQ0QsU0FBUyxFQUFFOztRQUVULGdCQUFnQixFQUFHLDhDQUE4QztRQUNqRSxnQkFBZ0IsRUFBRSx5REFBeUQ7UUFDM0UsZ0JBQWdC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TSxDQUFDLElBQUksU0FBUyxFQUFFLEVBQUUsQ0FBQyxDQUFDLEVBQWpDLENBQWlDLEVBQUMsRUFGbkMsQ0FFbUMsRUFBQyxDQUFDLENBQUE7SUFDdEQsQ0FBQzs7OztJQVFELDJCQUFROzs7SUFBUjtRQUNFLElBQUksQ0FBQyxJQUFJLENBQUMsZUFBZTtZQUFFLElBQUksQ0FBQyxlQUFlLEdBQUcsSUFBSSxDQUFDLElBQUk7aUJBQ3hELEdBQUcsQ0FBUyxRQUFRLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQztpQkFDbkMsSUFBSSxDQUFDLEdBQUc7Ozs7WUFBQyxVQUFBLFFBQVEsSUFBSSxPQUFBLFFBQVEsQ0FBQyxHQUFHOzs7O1lBQUMsVUFBQSxPQUFPLElBQUksT0FBQSxJQUFJLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxFQUFFLE9BQU8sQ0FBQyxJQUFJLENBQUMsRUFBcEMsQ0FBb0MsRUFBQyxFQUE3RCxDQUE2RCxFQUFDLENBQUM7aUJBQ3BGLFNBQVMsRUFBRSxDQUFBO1FBQ2QsT0FBTyxJQUFJLENBQUMsZUFBZSxDQUFBO0lBQzdCLENBQUM7O2dCQTdIRixVQUFVLFNBQUM7b0JBQ1YsVUFBVSxFQUFFLE1BQU07aUJBQ25COzs7O2dCQXREUSxVQUFVOzs7bUJBQW5CO0NBa0xDLEFBOUhELElBOEhDO1NBM0hZLFFBQVE7OztJQWtDbkIsOEJBQVU7Ozs7OztJQThDVixtQ0FBa0M7O0lBbUNsQyxtQ0FBZ0M7Ozs7O0lBaEg5Qix3QkFBd0IiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBIdHRwQ2xpZW50IH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uL2h0dHAnO1xuaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgTnpUcmVlTm9kZU9wdGlvbnMgfSBmcm9tICduZy16b3Jyby1hbnRkL2NvcmUnO1xuaW1wb3J0IHsgZnJvbSwgT2JzZXJ2YWJsZSwgb2YgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IG1hcCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7IGxpc3QyVHJlZSB9IGZyb20gJy4uL21pc2MnO1xuaW1wb3J0IHsgTGFuZyB9IGZyb20gJy4uL3R5cGVzL2NvbW1vbi50eXBlJztcbi8vIGltcG9ydCB7IExhbmcsIGxpc3QyVHJlZSB9IGZyb20gJy4uLy4uL3B1YmxpYy1hcGknO1xuaW1wb3J0IHsgQk8sIFJvbGVHcm91cCwgUnRmRnVuYywgVXNlckluZm8gfSBmcm9tICcuLi90eXBlcy9pZ2l4LnR5cGUnO1xuaW1wb3J0IHsgQkFQb3J0bGV0IH0gZnJvbSAnLi4vdHlwZXMvcG9ydGxldC50eXBlJztcblxuZXhwb3J0IGNvbnN0IGlnaXhVcmxzID0ge1xuICBibzoge1xuICAgIEdFVF9BTEw6IGAvYXBpL2Rldi9tYWluL3YxLjAvYnVzaW5lc3Mtb2JqZWN0c2BcbiAgfSxcbiAgZnVuY09wZXJhdGlvbnM6IHtcbiAgICBHRVRfQllfQk9fSUQ6IGAvYXBpL3J1bnRpbWUvc3lzL3YxLjAvZnVuY09wZXJhdGlvbnMvYnVzaW5lc3MvYFxuICB9LFxuICByb2xlR3JvdXA6IHtcbiAgICBHRVRfQUxMOiBgL2FwaS9ydW50aW1lL3N5cy92MS4wL3JvbGVncm91cHMvYWxsYFxuICB9LFxuICByb2xlOiB7XG4gICAgR0VUOiBgL2FwaS9ydW50aW1lL3N5cy92MS4wL3JvbGVzYCxcbiAgfSxcbiAgdXNlckluZm86IHsgLy8gaWdpeCDnmoQgdXNlckluZm8g6YeM5pyJ5aS05YOPXG4gICAgR0VUOiBgL2FwaS9ydW50aW1lL3N5cy92MS4wL3VzZXJpbmZvcz9pbmZvVHlwZT11c2VyYFxuICAgIC8vIEdFVDogYGh0dHA6Ly9kc2Nsb3VkLmNoZWMuYmouY24vYXBpL3J1bmltZS9zeXMvdjEuMC91c2VyaW5mb3Mvc2V0dGluZ2BcbiAgfSxcbiAgZnVuYzoge1xuICAgIC8qKiDljIXlkKvkuobmiYDmnInoj5zljZXjgIHogZTmn6XvvIzkvZPnp6/lpKfjgIHliqDovb3ovoPmhaIgKi9cbiAgICBHRVRfQUxMX1dJVEhfSU5WT0tFOiBgL2FwaS9ydW50aW1lL3N5cy92MS4wL2Z1bmN0aW9ucy9hbGxGdW5jc2AsXG4gICAgLyoqIOi/meS4quaYryBpR0lYIOaIkeeahOW6lOeUqOS4reeahOiPnOWNleOAgeWKn+iDvee7hOWIl+ihqO+8jOaVsOaNrumHj+eojeWwj++8jOaAp+iDvei+g+WlvSAqL1xuICAgIEdFVF9BTEw6IGAvYXBpL3J1bnRpbWUvc3lzL3YxLjAvZnVuY3Rpb25zL2Z1bmNHcm91cHM/ZnVuY1R5cGU9NGBcbiAgfSxcbiAgbGFuZ3M6IHtcbiAgICBHRVRfQUxMOiBgL2FwaS9ydW50aW1lL3N5cy92MS4wL2xvZ2luSW5mbz9pbmZvVHlwZT1zdXBwb3J0ZWRMYW5ndWFnZWBcbiAgfSxcbiAgcW9EYXRhc2V0OiB7XG4gICAgLy8gR0VUX0JPX1RSRUU6IGAvYXBpL2dzcC9iY2MvdjEuMC9ib3RyZWVmb3JuYXZ2by9leHRlbnNpb24vcXVlcnlgLFxuICAgIEdFVF9FQ1BfQklaX1RSRUUgOiBgL2FwaS9nc3AvYmNjL3YxLjAvZWNwYml6dHJlZS9leHRlbnNpb24vcXVlcnlgLFxuICAgIEdFVF9ERVRBSUxfQllfSUQ6IGAvYXBpL2dzcC9iY2MvdjEuMC9kYXRhc2V0ZGV0YWlsX2ZybS9leHRlbnNpb24vcmV0cmlldmUvYCxcbiAgICBHRVRfREVUQUlMX1FVRVJZOiBgL2FwaS9nc3AvYmNjL3YxLjAvZGF0YXNldGRldGFpbF9mcm0vZXh0ZW5zaW9uL3F1ZXJ5YFxuICB9LFxuICBiYToge1xuICAgIC8vIEdFVF9BTExfUE9SVExFVFM6IGAvYXBpL2JhL2JhcC92MS4wL2NhdGVnb3J5L2dldENsb3VkQ2F0ZWdvcnlMaXN0P3R5cGU9d2lkZ2V0YCxcbiAgICBHRVRfQUxMX1BPUlRMRVRTOiBgL2FwaS9iYS9iYXAvdjEuMC93aWRnZXQvZ2V0Q2xvdWRXaWRnZXRMaXN0P2FsbFdpZGdldExpc3Q9dHJ1ZWAsXG4gICAgLy8gR0VUX0FMTF9QT1JUTEVUUzogYC9hcGkvYmEvYmFwL3YxLjAvd2lkZ2V0L0dldFBvcnRsZXRJbmZvYCxcbiAgfVxuICAvLyBUT0RPOiBzdSBodHRwOi8vMTAuMjQuMjAuNzc6NTIwMC9hcGkvZGV2L21haW4vdjEuMC9idXNpbmVzcy1vYmplY3RzL1xuICAvLyBodHRwOi8vbG9jYWxob3N0OjUwMDAvYXBpL2Rldi9tYWluL3YxLjAvYnVzaW5lc3Mtb2JqZWN0LXRyZWVzXG59XG5cbkBJbmplY3RhYmxlKHtcbiAgcHJvdmlkZWRJbjogJ3Jvb3QnXG59KVxuZXhwb3J0IGNsYXNzIElnaXhSZXBvIHtcblxuICBjb25zdHJ1Y3RvciAoXG4gICAgcHJpdmF0ZSBodHRwOiBIdHRwQ2xpZW50LFxuICApIHsgfVxuXG4gIGdldEJPVHJlZSAobGF5ZXIgPSBJbmZpbml0eSkge1xuICAgIHJldHVybiB0aGlzLmh0dHAuZ2V0PEJPW10+KGlnaXhVcmxzLmJvLkdFVF9BTEwpLnBpcGUobWFwKGJvTGlzdCA9PiB7XG4gICAgICByZXR1cm4gbGlzdDJUcmVlKGJvTGlzdCwge1xuICAgICAgICBwYXJlbnRJZEtleTogJ3BhcmVudElEJyxcbiAgICAgICAgaWZJZ25vcmU6IGl0ZW0gPT4gaXRlbS5sYXllciA+IGxheWVyXG4gICAgICB9KVxuICAgIH0pKVxuICB9XG4gIGdldE9wc0J5Qk9JZCAoYm9JZDogc3RyaW5nKTogT2JzZXJ2YWJsZTxhbnk+IHtcbiAgICByZXR1cm4gdGhpcy5odHRwLmdldDxhbnlbXT4oaWdpeFVybHMuZnVuY09wZXJhdGlvbnMuR0VUX0JZX0JPX0lEICsgYm9JZClcbiAgfVxuICAvKiogcm9sZSwgcm9sZSBncm91cCAqL1xuICBnZXRSb2xlR3JvdXBUcmVlICgpIHtcbiAgICByZXR1cm4gdGhpcy5odHRwLmdldDxSb2xlR3JvdXBbXT4oaWdpeFVybHMucm9sZUdyb3VwLkdFVF9BTEwpLnBpcGUobWFwKHJvbGVHcm91cHMgPT4ge1xuICAgICAgcmV0dXJuIGxpc3QyVHJlZShyb2xlR3JvdXBzLCB7fSlcbiAgICB9KSlcbiAgfVxuICBnZXRSb2xlc0J5Um9sZUdyb3VwSWQgKGdyb3VwSWQ6IHN0cmluZykge1xuICAgIHJldHVybiB0aGlzLmh0dHAuZ2V0PGFueT4oaWdpeFVybHMucm9sZS5HRVQsIHtcbiAgICAgIHBhcmFtczoge1xuICAgICAgICBwYXJhbTogSlNPTi5zdHJpbmdpZnkoeyBncm91cElkIH0pXG4gICAgICB9XG4gICAgfSkucGlwZShtYXAocmVzID0+IHJlcy5kYXRhKSlcbiAgfVxuICBnZXRBbGxSb2xlcyAoKSB7XG4gICAgcmV0dXJuIHRoaXMuaHR0cC5nZXQ8YW55PihpZ2l4VXJscy5yb2xlLkdFVCkucGlwZShtYXAocmVzID0+IHJlcy5kYXRhKSlcbiAgfVxuXG4gIGZ1bmNUcmVlMTJcbiAgLyoqIOiOt+WPlumDqOS7tuWIl+ihqOmcgOimgeeahOS6jOe6pyBibyB0cmVlICovXG4gIGdldEZ1bmNUcmVlMTIgKCkge1xuICAgIGlmICh0aGlzLmZ1bmNUcmVlMTIpIHJldHVybiBvZih0aGlzLmZ1bmNUcmVlMTIpXG4gICAgcmV0dXJuIHRoaXMuZ2V0QWxsRnVuY3MoKVxuICAgICAgLnBpcGUoXG4gICAgICAgIG1hcChmdW5jcyA9PiB7XG4gICAgICAgICAgZnVuY3MgPSBmdW5jcy5maWx0ZXIoZnVuYyA9PiBwYXJzZUludChmdW5jLmxheWVyKSA8IDMpXG4gICAgICAgICAgdGhpcy5mdW5jVHJlZTEyID0gbGlzdDJUcmVlKGZ1bmNzLCB7XG4gICAgICAgICAgICByb290UGFyZW50SWRWYWx1ZTogJzAnLFxuICAgICAgICAgICAgcGFyZW50SWRLZXk6ICdwYXJlbnRJZCcsXG4gICAgICAgICAgfSlcbiAgICAgICAgICByZXR1cm4gdGhpcy5mdW5jVHJlZTEyXG4gICAgICAgIH0pXG4gICAgICApXG4gIH1cbiAgZ2V0UW9EYXRhc2V0RGV0YWlsc0J5TW9kdWxlSWQgKG1vZHVsZUlkOiBzdHJpbmcpIHtcbiAgICByZXR1cm4gdGhpcy5odHRwLnB1dDxhbnk+KGlnaXhVcmxzLnFvRGF0YXNldC5HRVRfREVUQUlMX1FVRVJZLCB7fSwge1xuICAgICAgcGFyYW1zOiB7XG4gICAgICAgIGVudGl0eUZpbHRlcjogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICAgIEZpbHRlckNvbmRpdGlvbnM6IFt7XG4gICAgICAgICAgICBGaWx0ZXJGaWVsZDogJ21vZHVsZUlEJyxcbiAgICAgICAgICAgIENvbXBhcmU6IDAsXG4gICAgICAgICAgICBWYWx1ZTogbW9kdWxlSWQsXG4gICAgICAgICAgICBSZWxhdGlvbjogMFxuICAgICAgICAgIH1dLFxuICAgICAgICAgIFNvcnRDb25kaXRpb25zOiBbXSxcbiAgICAgICAgICBJc1VzZVBhZ2luYXRpb246IHRydWUsXG4gICAgICAgICAgUGFnaW5hdGlvbjoge1xuICAgICAgICAgICAgUGFnZUluZGV4OiAxLFxuICAgICAgICAgICAgUGFnZVNpemU6IDIwLCAvLyBUT0RPOlxuICAgICAgICAgICAgUGFnZUNvdW50OiAwLFxuICAgICAgICAgICAgVG90YWxDb3VudDogMFxuICAgICAgICAgIH1cbiAgICAgICAgfSlcbiAgICAgIH1cbiAgICAvLyB9LCBudWxsKS5waXBlKG1hcChyZXMgPT4gcmVzLnJldHVyblZhbHVlKSlcbiAgICB9KS5waXBlKG1hcChyZXMgPT4gcmVzLnJldHVyblZhbHVlLnJlc3VsdCkpXG4gIH1cbiAgZ2V0UW9EYXRhc2V0RGV0YWlsQnlJZCAoaWQ6IHN0cmluZykge1xuICAgIHJldHVybiB0aGlzLmh0dHAucHV0PGFueT4oaWdpeFVybHMucW9EYXRhc2V0LkdFVF9ERVRBSUxfQllfSUQgKyBpZCwge30pLnBpcGUobWFwKHJlcyA9PiByZXMucmV0dXJuVmFsdWUpKVxuICB9XG4gIC8qKlxuICAgKiDojrflj5YgaWdpeCDnlKjmiLfkv6Hmga9cbiAgICogQHBhcmFtIHJlbG9hZCDpu5jorqTkuLrlgYfvvIzkuI3lho3lj5Hlh7ror7fmsYLvvIzkvb/nlKjlt7LnvJPlrZjnmoTnu5PmnpzvvJvnnJ/liJnph43mlrDor7fmsYJcbiAgICovXG4gIHVzZXJJbmZvUHJvbWlzZTogUHJvbWlzZTxVc2VySW5mbz5cbiAgZ2V0VXNlckluZm8gKHJlbG9hZCA9IGZhbHNlKSB7XG4gICAgaWYgKHJlbG9hZCkgdGhpcy51c2VySW5mb1Byb21pc2UgPSBudWxsXG4gICAgaWYgKCF0aGlzLnVzZXJJbmZvUHJvbWlzZSkgdGhpcy51c2VySW5mb1Byb21pc2UgPSB0aGlzLmh0dHBcbiAgICAgIC5nZXQ8VXNlckluZm8+KGlnaXhVcmxzLnVzZXJJbmZvLkdFVClcbiAgICAgIC50b1Byb21pc2UoKVxuICAgIHJldHVybiBmcm9tKHRoaXMudXNlckluZm9Qcm9taXNlKVxuICB9XG4gIGdldFVzZXJBdmF0YXIgKHJlbG9hZCA9IGZhbHNlKSB7XG4gICAgcmV0dXJuIHRoaXMuZ2V0VXNlckluZm8ocmVsb2FkKS5waXBlKG1hcCh1c2VySW5mbyA9PiB7XG4gICAgICBpZiAodXNlckluZm8gJiYgdXNlckluZm8udXNlclNldHRpbmcgJiYgdXNlckluZm8udXNlclNldHRpbmcuaW1nYmxvYikgcmV0dXJuIHVzZXJJbmZvLnVzZXJTZXR0aW5nLmltZ2Jsb2JcbiAgICAgIHJldHVybiBudWxsXG4gICAgfSkpXG4gIH1cbiAgZ2V0QWxsRnVuY3MgKCkge1xuICAgIHJldHVybiB0aGlzLmh0dHAuZ2V0PFJ0ZkZ1bmNbXT4oaWdpeFVybHMuZnVuYy5HRVRfQUxMKVxuICB9XG4gIGdldEJBUG9ydGxldHNBbGwgKCkge1xuICAgIHJldHVybiB0aGlzLmh0dHBcbiAgICAgIC5nZXQ8YW55PihpZ2l4VXJscy5iYS5HRVRfQUxMX1BPUlRMRVRTLFxuICAgICAgICAvLyB7XG4gICAgICAgIC8vIHJlc3BvbnNlVHlwZTogJ3RleHQnXG4gICAgICAgIC8vIH1cbiAgICAgICkucGlwZShcbiAgICAgICAgLy8gbWFwKHJlcyA9PiBKU09OLnBhcnNlKHJlcykpLFxuICAgICAgICBtYXAocmVzID0+IHJlcy5kYXRhXG4gICAgICAgICAgLy8gLmZpbHRlcihwID0+IHAudGFiID09PSAxKVxuICAgICAgICAgIC5tYXAocCA9PiBPYmplY3QuYXNzaWduKG5ldyBCQVBvcnRsZXQoKSwgcCkpKSlcbiAgfVxuICAvLyBnZXRCQVBvcnRsZXRCeUlkICgpIHtcbiAgLy8gICByZXR1cm4gdGhpcy5odHRwXG4gIC8vICAgICAuZ2V0PGFueT4oaWdpeFVybHMuYmEuR0VUX0FMTF9QT1JUTEVUUylcbiAgLy8gICAgIC5waXBlKG1hcChyZXMgPT4gcmVzLmNhdGVnb3J5TGlzdC5tYXAocCA9PiBPYmplY3QuYXNzaWduKG5ldyBCQVBvcnRsZXQoKSwgcCkpWzBdKSlcbiAgLy8gfVxuXG4gIGdldExhbmdzUHJvbWlzZTogUHJvbWlzZTxMYW5nW10+XG4gIGdldExhbmdzICgpIHtcbiAgICBpZiAoIXRoaXMuZ2V0TGFuZ3NQcm9taXNlKSB0aGlzLmdldExhbmdzUHJvbWlzZSA9IHRoaXMuaHR0cFxuICAgICAgLmdldDxMYW5nW10+KGlnaXhVcmxzLmxhbmdzLkdFVF9BTEwpXG4gICAgICAucGlwZShtYXAocnRmTGFuZ3MgPT4gcnRmTGFuZ3MubWFwKHJ0ZkxhbmcgPT4gbmV3IExhbmcocnRmTGFuZy5jb2RlLCBydGZMYW5nLm5hbWUpKSkpXG4gICAgICAudG9Qcm9taXNlKClcbiAgICByZXR1cm4gdGhpcy5nZXRMYW5nc1Byb21pc2VcbiAgfVxufVxuIl19
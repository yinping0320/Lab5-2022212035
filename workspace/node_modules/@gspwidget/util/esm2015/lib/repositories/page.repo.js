/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { HttpClient } from '@angular/common/http';
import { Injectable } from '@angular/core';
import { map, tap } from 'rxjs/operators';
import { addBaseUrl } from '../const';
import { mapEntityFeilds } from '../utils/field-mapping';
import * as i0 from "@angular/core";
import * as i1 from "@angular/common/http";
/** @type {?} */
export const pageInfoUrls = {
    GET_BY_ID_MANAGE: `page/`,
    GET_BY_ID_PERSONAL: `page/pageofuser?pageId=`,
    GET_ALL_MANAGE: `page/all/mg`,
    GET_ALL_PERSONAL: `page/pagelistofuser`,
    GET_BY_ROLE: `pagerole/pagesbyrole?roleId=`,
    GET_PAGES_WITH_ROLE: `pagerole/all`,
    SET_TO_ROLE_DEFAULT: `pagerole/settingrolepageenable`,
    // roleId pageId
    DELETE: `page/`,
    // delete + id
    DELETE_MANAGE: `page/delete/mg`,
    // post []
    ADD: `page`,
    ADD_MANAGE: `page/add/mg`,
    UPDATE: `page`,
    UPDATE_MANAGE: `page/update/mg`,
    COPY: `page/copy`,
    COPY_MANAGE: `page/copy/mg`,
    RESET_PAGE: `page/resetsyspage?pageId=`,
    SELECT_PAGE: `page/changepageselect?pageId=`,
};
/** @type {?} */
export const pageRoles = {
    SAVE: `pagerole/save?pageId=`,
    GET_BY_PAGE_ID: `pagerole/getallpagerole?pageId=`,
};
addBaseUrl(pageInfoUrls);
addBaseUrl(pageRoles);
export class PageRepo {
    /**
     * @param {?} http
     */
    constructor(http) {
        this.http = http;
    }
    /**
     * @return {?}
     */
    getPagesManage() {
        return this.http
            .get(pageInfoUrls.GET_ALL_MANAGE)
            .pipe(map((/**
         * @param {?} data
         * @return {?}
         */
        data => data.map(convertPageInfo))));
    }
    /**
     * @return {?}
     */
    getPagesUser() {
        return this.http
            .get(pageInfoUrls.GET_ALL_PERSONAL);
    }
    /**
     * @param {?} roleId
     * @return {?}
     */
    getPagesByRole(roleId) {
        return this.http
            .get(pageInfoUrls.GET_BY_ROLE + roleId);
    }
    /**
     * @return {?}
     */
    getPagesWithRole() {
        return this.http.get(pageInfoUrls.GET_PAGES_WITH_ROLE);
    }
    /**
     * @param {?} roleId
     * @param {?} pageId
     * @return {?}
     */
    setRoleDefaultPage(roleId, pageId) {
        return this.http
            .post(pageInfoUrls.SET_TO_ROLE_DEFAULT, null, {
            params: { pageId, roleId }
        }).pipe(this.success());
    }
    /**
     * @param {?} id
     * @param {?=} isManage
     * @return {?}
     */
    getPageInfoById(id, isManage = false) {
        return this.http
            .get((isManage
            ? pageInfoUrls.GET_BY_ID_MANAGE
            : pageInfoUrls.GET_BY_ID_PERSONAL)
            + id)
            .pipe(map((/**
         * @param {?} data
         * @return {?}
         */
        data => convertPageInfo(data))));
    }
    /**
     * @param {?} pageInfo
     * @param {?=} isManage
     * @return {?}
     */
    savePageInfo(pageInfo, isManage = false) {
        return pageInfo.id
            ? this.http.post(isManage ? pageInfoUrls.UPDATE_MANAGE : pageInfoUrls.UPDATE, convertPageInfoInverse(pageInfo)).pipe(this.success())
            : this.http.put(isManage ? pageInfoUrls.ADD_MANAGE : pageInfoUrls.ADD, convertPageInfoInverse(pageInfo)).pipe(this.success());
    }
    /**
     * @param {?} id
     * @return {?}
     */
    deletePageInfo(id) {
        return this.http
            .delete(pageInfoUrls.DELETE + id, { responseType: 'text' })
            .pipe(this.success());
    }
    /**
     * @param {?} ids
     * @return {?}
     */
    deletePageInfoManage(ids) {
        return this.http
            .post(pageInfoUrls.DELETE_MANAGE, ids)
            .pipe(this.success());
    }
    /**
     * @param {?} ids
     * @param {?=} isManage
     * @return {?}
     */
    copyPageInfo(ids, isManage = false) {
        return this.http
            .post(isManage ? pageInfoUrls.COPY_MANAGE : pageInfoUrls.COPY, ids, { responseType: 'text' });
    }
    /**
     * @param {?} pageId
     * @return {?}
     */
    resetPage(pageId) {
        return this.http.post(pageInfoUrls.RESET_PAGE + pageId, null);
    }
    /**
     * @param {?} pageId
     * @return {?}
     */
    selectPage(pageId) {
        return this.http.post(pageInfoUrls.SELECT_PAGE + pageId, null);
    }
    // TODO: 不该在这依赖 nzmsg，应移到使用处
    /**
     * @private
     * @return {?}
     */
    success() {
        return tap((/**
         * @return {?}
         */
        () => {
            // this.nzMsg.success(`操作成功！`, { nzDuration: 1000 })
        }));
    }
    /**
     * page roles
     * @param {?} pageId
     * @param {?} roleIds
     * @return {?}
     */
    savePageRoles(pageId, roleIds) {
        return this.http.post(pageRoles.SAVE + pageId, roleIds);
    }
    /**
     * @param {?} pageId
     * @return {?}
     */
    getPageRoles(pageId) {
        return this.http.get(pageRoles.GET_BY_PAGE_ID + pageId);
    }
}
PageRepo.decorators = [
    { type: Injectable, args: [{
                providedIn: 'root'
            },] }
];
/** @nocollapse */
PageRepo.ctorParameters = () => [
    { type: HttpClient }
];
/** @nocollapse */ PageRepo.ngInjectableDef = i0.defineInjectable({ factory: function PageRepo_Factory() { return new PageRepo(i0.inject(i1.HttpClient)); }, token: PageRepo, providedIn: "root" });
if (false) {
    /**
     * @type {?}
     * @private
     */
    PageRepo.prototype.http;
}
/**
 * pageInfo 后端 -> 前端, 前端 -> 后端 转换
 * @param {?} original
 * @return {?}
 */
export function convertPageInfo(original) {
    /** @type {?} */
    const result = mapEntityFeilds(original, 'pageInfo');
    result.config = JSON.parse((/** @type {?} */ (result.config)));
    return result;
}
/**
 * @param {?} pageInfo
 * @return {?}
 */
export function convertPageInfoInverse(pageInfo) {
    /** @type {?} */
    const result = mapEntityFeilds(pageInfo, 'pageInfo', true)
    // 保存时，删除 pageInfo.config.layout 的元素的 portlet
    ;
    // 保存时，删除 pageInfo.config.layout 的元素的 portlet
    result.config.layout = result.config.layout.map((/**
     * @param {?} item
     * @return {?}
     */
    item => {
        const { instanceId, isBAPortlet, gridsterItem, portletId, link } = item;
        return { instanceId, isBAPortlet, gridsterItem, portletId, link };
    }));
    result.config = JSON.stringify(result.config);
    return result;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGFnZS5yZXBvLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGdzcHdpZGdldC91dGlsLyIsInNvdXJjZXMiOlsibGliL3JlcG9zaXRvcmllcy9wYWdlLnJlcG8udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUNsRCxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzNDLE9BQU8sRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDMUMsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLFVBQVUsQ0FBQztBQUV0QyxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sd0JBQXdCLENBQUM7Ozs7QUFFekQsTUFBTSxPQUFPLFlBQVksR0FBRztJQUMxQixnQkFBZ0IsRUFBRSxPQUFPO0lBQ3pCLGtCQUFrQixFQUFFLHlCQUF5QjtJQUM3QyxjQUFjLEVBQUUsYUFBYTtJQUM3QixnQkFBZ0IsRUFBRSxxQkFBcUI7SUFDdkMsV0FBVyxFQUFFLDhCQUE4QjtJQUMzQyxtQkFBbUIsRUFBRSxjQUFjO0lBQ25DLG1CQUFtQixFQUFFLGdDQUFnQzs7SUFDckQsTUFBTSxFQUFFLE9BQU87O0lBQ2YsYUFBYSxFQUFFLGdCQUFnQjs7SUFDL0IsR0FBRyxFQUFFLE1BQU07SUFDWCxVQUFVLEVBQUUsYUFBYTtJQUN6QixNQUFNLEVBQUUsTUFBTTtJQUNkLGFBQWEsRUFBRSxnQkFBZ0I7SUFDL0IsSUFBSSxFQUFFLFdBQVc7SUFDakIsV0FBVyxFQUFFLGNBQWM7SUFDM0IsVUFBVSxFQUFFLDJCQUEyQjtJQUN2QyxXQUFXLEVBQUUsK0JBQStCO0NBQzdDOztBQUNELE1BQU0sT0FBTyxTQUFTLEdBQUc7SUFDdkIsSUFBSSxFQUFFLHVCQUF1QjtJQUM3QixjQUFjLEVBQUUsaUNBQWlDO0NBQ2xEO0FBQ0QsVUFBVSxDQUFDLFlBQVksQ0FBQyxDQUFBO0FBQ3hCLFVBQVUs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WUFuQ1EsVUFBVTs7Ozs7Ozs7SUF1Q2Ysd0JBQXdCOzs7Ozs7O0FBbUY1QixNQUFNLFVBQVUsZUFBZSxDQUFFLFFBQVE7O1VBQ2pDLE1BQU0sR0FBYSxlQUFlLENBQUMsUUFBUSxFQUFFLFVBQVUsQ0FBQztJQUM5RCxNQUFNLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsbUJBQUEsTUFBTSxDQUFDLE1BQU0sRUFBTyxDQUFDLENBQUE7SUFDaEQsT0FBTyxNQUFNLENBQUE7QUFDZixDQUFDOzs7OztBQUNELE1BQU0sVUFBVSxzQkFBc0IsQ0FBRSxRQUFROztVQUN4QyxNQUFNLEdBQVEsZUFBZSxDQUFDLFFBQVEsRUFBRSxVQUFVLEVBQUUsSUFBSSxDQUFDO0lBQy9ELDZDQUE2Qzs7SUFBN0MsNkNBQTZDO0lBQzdDLE1BQU0sQ0FBQyxNQUFNLENBQUMsTUFBTSxHQUFHLE1BQU0sQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLEdBQUc7Ozs7SUFBQyxJQUFJLENBQUMsRUFBRTtjQUMvQyxFQUFFLFVBQVUsRUFBRSxXQUFXLEVBQUUsWUFBWSxFQUFFLFNBQVMsRUFBRSxJQUFJLEVBQUUsR0FBRyxJQUFJO1FBQ3ZFLE9BQU8sRUFBRSxVQUFVLEVBQUUsV0FBVyxFQUFFLFlBQVksRUFBRSxTQUFTLEVBQUUsSUFBSSxFQUFFLENBQUE7SUFDbkUsQ0FBQyxFQUFDLENBQUE7SUFDRixNQUFNLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFBO0lBQzdDLE9BQU8sTUFBTSxDQUFBO0FBQ2YsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEh0dHBDbGllbnQgfSBmcm9tICdAYW5ndWxhci9jb21tb24vaHR0cCc7XG5pbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBtYXAsIHRhcCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7IGFkZEJhc2VVcmwgfSBmcm9tICcuLi9jb25zdCc7XG5pbXBvcnQgeyBQYWdlSW5mbywgUGFnZVdpdGhSb2xlLCBTaW1wbGVQYWdlIH0gZnJvbSAnLi4vdHlwZXMvcGFnZS50eXBlJztcbmltcG9ydCB7IG1hcEVudGl0eUZlaWxkcyB9IGZyb20gJy4uL3V0aWxzL2ZpZWxkLW1hcHBpbmcnO1xuXG5leHBvcnQgY29uc3QgcGFnZUluZm9VcmxzID0ge1xuICBHRVRfQllfSURfTUFOQUdFOiBgcGFnZS9gLFxuICBHRVRfQllfSURfUEVSU09OQUw6IGBwYWdlL3BhZ2VvZnVzZXI/cGFnZUlkPWAsXG4gIEdFVF9BTExfTUFOQUdFOiBgcGFnZS9hbGwvbWdgLFxuICBHRVRfQUxMX1BFUlNPTkFMOiBgcGFnZS9wYWdlbGlzdG9mdXNlcmAsXG4gIEdFVF9CWV9ST0xFOiBgcGFnZXJvbGUvcGFnZXNieXJvbGU/cm9sZUlkPWAsXG4gIEdFVF9QQUdFU19XSVRIX1JPTEU6IGBwYWdlcm9sZS9hbGxgLFxuICBTRVRfVE9fUk9MRV9ERUZBVUxUOiBgcGFnZXJvbGUvc2V0dGluZ3JvbGVwYWdlZW5hYmxlYCwgLy8gcm9sZUlkIHBhZ2VJZFxuICBERUxFVEU6IGBwYWdlL2AsIC8vIGRlbGV0ZSArIGlkXG4gIERFTEVURV9NQU5BR0U6IGBwYWdlL2RlbGV0ZS9tZ2AsIC8vIHBvc3QgW11cbiAgQUREOiBgcGFnZWAsXG4gIEFERF9NQU5BR0U6IGBwYWdlL2FkZC9tZ2AsXG4gIFVQREFURTogYHBhZ2VgLFxuICBVUERBVEVfTUFOQUdFOiBgcGFnZS91cGRhdGUvbWdgLFxuICBDT1BZOiBgcGFnZS9jb3B5YCxcbiAgQ09QWV9NQU5BR0U6IGBwYWdlL2NvcHkvbWdgLFxuICBSRVNFVF9QQUdFOiBgcGFnZS9yZXNldHN5c3BhZ2U/cGFnZUlkPWAsXG4gIFNFTEVDVF9QQUdFOiBgcGFnZS9jaGFuZ2VwYWdlc2VsZWN0P3BhZ2VJZD1gLFxufVxuZXhwb3J0IGNvbnN0IHBhZ2VSb2xlcyA9IHtcbiAgU0FWRTogYHBhZ2Vyb2xlL3NhdmU/cGFnZUlkPWAsXG4gIEdFVF9CWV9QQUdFX0lEOiBgcGFnZXJvbGUvZ2V0YWxscGFnZXJvbGU/cGFnZUlkPWAsXG59XG5hZGRCYXNlVXJsKHBhZ2VJbmZvVXJscylcbmFkZEJhc2VVcmwocGFnZVJvbGVzKVxuXG5ASW5qZWN0YWJsZSh7XG4gIHByb3ZpZGVkSW46ICdyb290J1xufSlcbmV4cG9ydCBjbGFzcyBQYWdlUmVwbyB7XG5cbiAgY29uc3RydWN0b3IgKFxuICAgIHByaXZhdGUgaHR0cDogSHR0cENsaWVudCxcbiAgKSB7IH1cblxuICBnZXRQYWdlc01hbmFnZSAoKSB7XG4gICAgcmV0dXJuIHRoaXMuaHR0cFxuICAgICAgLmdldDxhbnlbXT4ocGFnZUluZm9VcmxzLkdFVF9BTExfTUFOQUdFKVxuICAgICAgLnBpcGUobWFwKGRhdGEgPT4gZGF0YS5tYXAoY29udmVydFBhZ2VJbmZvKSkpXG4gIH1cbiAgZ2V0UGFnZXNVc2VyICgpIHtcbiAgICByZXR1cm4gdGhpcy5odHRwXG4gICAgICAuZ2V0PFNpbXBsZVBhZ2VbXT4ocGFnZUluZm9VcmxzLkdFVF9BTExfUEVSU09OQUwpXG4gIH1cbiAgZ2V0UGFnZXNCeVJvbGUgKHJvbGVJZDogc3RyaW5nKSB7XG4gICAgcmV0dXJuIHRoaXMuaHR0cFxuICAgICAgLmdldDxQYWdlV2l0aFJvbGVbXT4ocGFnZUluZm9VcmxzLkdFVF9CWV9ST0xFICsgcm9sZUlkKVxuICB9XG4gIGdldFBhZ2VzV2l0aFJvbGUgKCkge1xuICAgIHJldHVybiB0aGlzLmh0dHAuZ2V0PFBhZ2VXaXRoUm9sZVtdPihwYWdlSW5mb1VybHMuR0VUX1BBR0VTX1dJVEhfUk9MRSlcbiAgfVxuICBzZXRSb2xlRGVmYXVsdFBhZ2UgKHJvbGVJZDogc3RyaW5nLCBwYWdlSWQ6IHN0cmluZykge1xuICAgIHJldHVybiB0aGlzLmh0dHBcbiAgICAgIC5wb3N0KHBhZ2VJbmZvVXJscy5TRVRfVE9fUk9MRV9ERUZBVUxULCBudWxsLCB7XG4gICAgICAgIHBhcmFtczogeyBwYWdlSWQsIHJvbGVJZCB9XG4gICAgICB9KS5waXBlKHRoaXMuc3VjY2VzcygpKVxuICB9XG4gIGdldFBhZ2VJbmZvQnlJZCAoaWQ6IHN0cmluZywgaXNNYW5hZ2UgPSBmYWxzZSkge1xuICAgIHJldHVybiB0aGlzLmh0dHBcbiAgICAgIC5nZXQ8UGFnZUluZm8+KChpc01hbmFnZVxuICAgICAgICA/IHBhZ2VJbmZvVXJscy5HRVRfQllfSURfTUFOQUdFXG4gICAgICAgIDogcGFnZUluZm9VcmxzLkdFVF9CWV9JRF9QRVJTT05BTClcbiAgICAgICAgKyBpZClcbiAgICAgIC5waXBlKG1hcChkYXRhID0+IGNvbnZlcnRQYWdlSW5mbyhkYXRhKSkpXG4gIH1cbiAgc2F2ZVBhZ2VJbmZvIChwYWdlSW5mbzogUGFnZUluZm8sIGlzTWFuYWdlID0gZmFsc2UpIHtcbiAgICByZXR1cm4gcGFnZUluZm8uaWRcbiAgICAgID8gdGhpcy5odHRwLnBvc3QoXG4gICAgICAgIGlzTWFuYWdlID8gcGFnZUluZm9VcmxzLlVQREFURV9NQU5BR0UgOiBwYWdlSW5mb1VybHMuVVBEQVRFLFxuICAgICAgICBjb252ZXJ0UGFnZUluZm9JbnZlcnNlKHBhZ2VJbmZvKVxuICAgICAgKS5waXBlKHRoaXMuc3VjY2VzcygpKVxuICAgICAgOiB0aGlzLmh0dHAucHV0KFxuICAgICAgICBpc01hbmFnZSA/IHBhZ2VJbmZvVXJscy5BRERfTUFOQUdFIDogcGFnZUluZm9VcmxzLkFERCxcbiAgICAgICAgY29udmVydFBhZ2VJbmZvSW52ZXJzZShwYWdlSW5mbylcbiAgICAgICkucGlwZSh0aGlzLnN1Y2Nlc3MoKSlcbiAgfVxuICBkZWxldGVQYWdlSW5mbyAoaWQ6IHN0cmluZykge1xuICAgIHJldHVybiB0aGlzLmh0dHBcbiAgICAgIC5kZWxldGUocGFnZUluZm9VcmxzLkRFTEVURSArIGlkLCB7IHJlc3BvbnNlVHlwZTogJ3RleHQnIH0pXG4gICAgICAucGlwZSh0aGlzLnN1Y2Nlc3MoKSlcbiAgfVxuICBkZWxldGVQYWdlSW5mb01hbmFnZSAoaWRzOiBzdHJpbmdbXSkge1xuICAgIHJldHVybiB0aGlzLmh0dHBcbiAgICAgIC5wb3N0KHBhZ2VJbmZvVXJscy5ERUxFVEVfTUFOQUdFLCBpZHMpXG4gICAgICAucGlwZSh0aGlzLnN1Y2Nlc3MoKSlcbiAgfVxuICBjb3B5UGFnZUluZm8gKGlkczogc3RyaW5nW10sIGlzTWFuYWdlID0gZmFsc2UpIHtcbiAgICByZXR1cm4gdGhpcy5odHRwXG4gICAgICAucG9zdChpc01hbmFnZSA/IHBhZ2VJbmZvVXJscy5DT1BZX01BTkFHRSA6IHBhZ2VJbmZvVXJscy5DT1BZLCBpZHMsIHsgcmVzcG9uc2VUeXBlOiAndGV4dCcgfSlcbiAgfVxuICByZXNldFBhZ2UgKHBhZ2VJZDogc3RyaW5nKSB7XG4gICAgcmV0dXJuIHRoaXMuaHR0cC5wb3N0KHBhZ2VJbmZvVXJscy5SRVNFVF9QQUdFICsgcGFnZUlkLCBudWxsKVxuICB9XG4gIHNlbGVjdFBhZ2UgKHBhZ2VJZDogc3RyaW5nKSB7XG4gICAgcmV0dXJuIHRoaXMuaHR0cC5wb3N0KHBhZ2VJbmZvVXJscy5TRUxFQ1RfUEFHRSArIHBhZ2VJZCwgbnVsbClcbiAgfVxuXG4gIC8vIFRPRE86IOS4jeivpeWcqOi/meS+nei1liBuem1zZ++8jOW6lOenu+WIsOS9v+eUqOWkhFxuICBwcml2YXRlIHN1Y2Nlc3MgKCkge1xuICAgIHJldHVybiB0YXA8YW55PiAoXG4gICAgICAoKSA9PiB7XG4gICAgICAgIC8vIHRoaXMubnpNc2cuc3VjY2Vzcyhg5pON5L2c5oiQ5Yqf77yBYCwgeyBuekR1cmF0aW9uOiAxMDAwIH0pXG4gICAgICB9XG4gICAgKVxuICB9XG4gIC8qKiBwYWdlIHJvbGVzICovXG4gIHNhdmVQYWdlUm9sZXMgKHBhZ2VJZDogc3RyaW5nLCByb2xlSWRzOiBzdHJpbmdbXSkge1xuICAgIHJldHVybiB0aGlzLmh0dHAucG9zdChwYWdlUm9sZXMuU0FWRSArIHBhZ2VJZCwgcm9sZUlkcylcbiAgfVxuICBnZXRQYWdlUm9sZXMgKHBhZ2VJZDogc3RyaW5nKSB7XG4gICAgcmV0dXJuIHRoaXMuaHR0cC5nZXQ8UGFnZVdpdGhSb2xlW10+KHBhZ2VSb2xlcy5HRVRfQllfUEFHRV9JRCArIHBhZ2VJZClcbiAgfVxufVxuXG4vKiogcGFnZUluZm8g5ZCO56uvIC0+IOWJjeerrywg5YmN56uvIC0+IOWQjuerryDovazmjaIgKi9cbmV4cG9ydCBmdW5jdGlvbiBjb252ZXJ0UGFnZUluZm8gKG9yaWdpbmFsKSB7XG4gIGNvbnN0IHJlc3VsdDogUGFnZUluZm8gPSBtYXBFbnRpdHlGZWlsZHMob3JpZ2luYWwsICdwYWdlSW5mbycpXG4gIHJlc3VsdC5jb25maWcgPSBKU09OLnBhcnNlKHJlc3VsdC5jb25maWcgYXMgYW55KVxuICByZXR1cm4gcmVzdWx0XG59XG5leHBvcnQgZnVuY3Rpb24gY29udmVydFBhZ2VJbmZvSW52ZXJzZSAocGFnZUluZm8pIHtcbiAgY29uc3QgcmVzdWx0OiBhbnkgPSBtYXBFbnRpdHlGZWlsZHMocGFnZUluZm8sICdwYWdlSW5mbycsIHRydWUpXG4gIC8vIOS/neWtmOaXtu+8jOWIoOmZpCBwYWdlSW5mby5jb25maWcubGF5b3V0IOeahOWFg+e0oOeahCBwb3J0bGV0XG4gIHJlc3VsdC5jb25maWcubGF5b3V0ID0gcmVzdWx0LmNvbmZpZy5sYXlvdXQubWFwKGl0ZW0gPT4ge1xuICAgIGNvbnN0IHsgaW5zdGFuY2VJZCwgaXNCQVBvcnRsZXQsIGdyaWRzdGVySXRlbSwgcG9ydGxldElkLCBsaW5rIH0gPSBpdGVtXG4gICAgcmV0dXJuIHsgaW5zdGFuY2VJZCwgaXNCQVBvcnRsZXQsIGdyaWRzdGVySXRlbSwgcG9ydGxldElkLCBsaW5rIH1cbiAgfSlcbiAgcmVzdWx0LmNvbmZpZyA9IEpTT04uc3RyaW5naWZ5KHJlc3VsdC5jb25maWcpXG4gIHJldHVybiByZXN1bHRcbn1cbiJdfQ==
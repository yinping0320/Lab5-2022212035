import add from 'date-fns/add';
import sub from 'date-fns/sub';
import { map } from 'rxjs/operators';
import { __decorate, __metadata } from 'tslib';
import { FormControl, ReactiveFormsModule } from '@angular/forms';
import { TranslateModule } from '@ngx-translate/core';
import { curLang, FILTERS_WIDGET_FILTERS_PROP_NAME, FILTERS_WIDGET_NAME, list2Tree, PlThemeColors } from '@gspwidget/util';
import { Injectable, EventEmitter, NgModule, Input, Component, ContentChild, Output, ViewEncapsulation, defineInjectable } from '@angular/core';
import { CommonModule } from '@angular/common';
import { BsModalService, ModalModule } from 'ngx-bootstrap/modal';

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
// if (!window.widgetBaseProperies) window.widgetBaseProperies = []
if (!window.registry)
    window.registry = {};
/**
 * 元部件注册表
 * @type {?}
 */
const WidgetRegistry = {
    /**
     * @param {?} name
     * @param {?} config
     * @return {?}
     */
    setWidget(name, config) {
        if (!window.registry[name])
            window.registry[name] = {};
        window.registry[name] = Object.assign({}, window.registry[name], config);
    },
    /**
     * @param {?} name
     * @return {?}
     */
    getWidgetByName(name) {
        return window.registry[name];
    },
    /**
     * @param {?} ctorName
     * @return {?}
     */
    getWidgetByCtorName(ctorName) {
        return Object.values(window.registry)
            .find((/**
         * @param {?} widgetConfig
         * @return {?}
         */
        (widgetConfig) => {
            return widgetConfig.ctor.name === ctorName;
        }));
    }
};

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/**
 * @param {?} widgetConfig
 * @return {?}
 */
function Widget(widgetConfig) {
    return (/**
     * @param {?} constructor
     * @return {?}
     */
    (constructor) => {
        WidgetRegistry.setWidget(widgetConfig.name, Object.assign({ ctor: constructor }, widgetConfig));
        // 父类 WidgetBase
        constructor.prototype.widgetName = widgetConfig.name;
    });
}

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/** @type {?} */
const WidgetEventMap = new Map()
/** 用于把 EventEmitter 属性注册为元部件事件 */
;
/**
 * 用于把 EventEmitter 属性注册为元部件事件
 * @param {?=} eventConfig
 * @return {?}
 */
function WidgetEvent(eventConfig = {}) {
    return (/**
     * @param {?} widgetPrototype
     * @param {?} eventPropName
     * @return {?}
     */
    (widgetPrototype, eventPropName) => {
        // TODO: 想办法把 su 加进所有运行时注册表里的 keys 里
        /** @type {?} */
        const ctorName = widgetPrototype.constructor.name;
        if (!WidgetEventMap.get(ctorName))
            WidgetEventMap.set(ctorName, []);
        WidgetEventMap.get(ctorName).push(Object.assign({ propName: eventPropName }, eventConfig));
    });
}

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
class WidgetEventService {
    constructor() { }
    /**
     * @param {?} widgetName
     * @param {?} pvs
     * @return {?}
     */
    getEventsByWidgetName(widgetName, pvs) {
        /** @type {?} */
        const ctorName = WidgetRegistry.getWidgetByName(widgetName).ctor.name;
        /** @type {?} */
        const widgetEvents = WidgetEventMap.get(ctorName) || [];
        if (widgetName === FILTERS_WIDGET_NAME) {
            return pvs[FILTERS_WIDGET_FILTERS_PROP_NAME].map((/**
             * @param {?} fc
             * @return {?}
             */
            (fc) => ({
                name: fc.i18nName[curLang],
                propName: fc.i18nName[curLang],
            })));
        }
        // 组装
        return [
            ...widgetEvents,
            ...test,
        ];
    }
}
WidgetEventService.decorators = [
    { type: Injectable, args: [{
                providedIn: 'root'
            },] }
];
/** @nocollapse */
WidgetEventService.ctorParameters = () => [];
/** @nocollapse */ WidgetEventService.ngInjectableDef = defineInjectable({ factory: function WidgetEventService_Factory() { return new WidgetEventService(); }, token: WidgetEventService, providedIn: "root" });
/** @type {?} */
const test = [{
        name: 'click bar'
    }, {
        name: 'event 2'
    }, {
        name: 'event 3'
    }];

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/** @enum {string} */
const PropertyTypes = {
    Text: 'textOption',
    Bool: 'boolOption',
    Number: 'numberOption',
    Enum: 'enumOption',
    Color: 'colorOption',
    // Date = 'dateOption',
    Object: 'objectOption',
    Custom: 'customOption',
    SelectHelp: 'selectHelpOption',
    /** Help 得到的值的结构，取决于配置 HelpOption 后，最终得到的数据结构 */
    Help: 'helpOption',
    /** DataField 得到的值的值的类型为 DataField */
    DataField: 'dataFieldOption',
    Filter: 'filterOption',
    Html: 'htmlOption',
    DataParam: 'dataParamOption',
};
/** @enum {number} */
const HelpStructure = {
    table: 0,
    treeTable: 1,
    transfer: 2,
    treeTransfer: 3,
};
HelpStructure[HelpStructure.table] = 'table';
HelpStructure[HelpStructure.treeTable] = 'treeTable';
HelpStructure[HelpStructure.transfer] = 'transfer';
HelpStructure[HelpStructure.treeTransfer] = 'treeTransfer';

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/**
 * 没发直接用 [] 作 key 直接建 literal 对象，aot 编译会报错
 * @param {?} key
 * @param {?} value
 * @return {?}
 */
function getObj(key, value) {
    /** @type {?} */
    const obj = {};
    obj[key] = value;
    return obj;
}
/**
 * 筛选描述
 */
class FSLastTimeItem {
    constructor() {
        this.num = 1;
        this.unit = 'day';
    }
    /**
     * 传入一个 '最近n某'，返回对应的时间范围数组
     * @param {?} lastTimeItem
     * @return {?}
     */
    static GetDates(lastTimeItem) {
        return [
            sub(new Date(), getObj(lastTimeItem.unit + 's', lastTimeItem.num)),
            new Date()
        ];
    }
}
class FSRangeDefault {
    constructor() {
        this.beforeNum = 1;
        this.beforeUnit = 'month';
        this.afterNum = 0;
        this.afterUnit = 'day';
    }
    /**
     * @param {?} rangeDefault
     * @return {?}
     */
    static GetDates(rangeDefault) {
        return [
            sub(new Date(), getObj(rangeDefault.beforeUnit + 's', rangeDefault.afterNum)),
            add(new Date(), getObj(rangeDefault.beforeUnit + 's', rangeDefault.afterNum)),
        ];
    }
}
class FSDate {
    constructor() {
        this.type = 'single';
        this.singleUnit = 'day';
        this.singleDefaultType = 'current';
        this.singleDefaultSpecified = new Date();
        this.rangeDefault = new FSRangeDefault();
        this.lastTimeItems = [];
        this.lastTimeDisplayType = 'flat';
    }
}
class FSEnum {
    constructor() {
        this.multi = false;
        /**
         * 暂时定为，仅有 single 时可以选择 flat
         */
        this.displayType = 'select';
        this.source = 'manual';
        /**
         * 是否可清空不选。仅有 select 且 single 才有此选项
         */
        this.allowEmpty = false;
        /**
         * 通过上面两个字段取出 items 存在下面
         */
        this.itemsFromData = [];
        this.itemsManual = [];
        this.multiDefault = [];
    }
    // 暂时不做
    // sourceDatasetId: string
    // sourceDatasetLabelField?: DataField
    // sourceDatasetValueField?: DataField
    /**
     * @param {?} fsEnum
     * @return {?}
     */
    static GetItems(fsEnum) {
        const { source, itemsFromData, itemsManual } = fsEnum;
        if (source === 'dataField') {
            // if (!itemsValueField || !intactData) return []
            // const tempItems = intactData.map(dataItem => ({
            //   label: dataItem[itemsLabelField || itemsValueField],
            //   value: dataItem[itemsValueField]
            // }))
            // return ArrUtil.Unique(tempItems)
            return itemsFromData;
        }
        else if (source === 'manual') {
            return itemsManual;
        }
    }
    /**
     * @param {?} fsEnum
     * @return {?}
     */
    static GetItemValues(fsEnum) {
        /**
         * @param {?} item
         * @return {?}
         */
        function mapCb(item) { return item.value; }
        return FSEnum.GetItems(fsEnum).map(mapCb);
    }
}
class FSEnumItem {
}
class FilterSchema {
    constructor() {
        /**
         * 过滤名称，在筛选控件上显示，可选
         */
        this.i18nName = {};
        this.showName = false;
        /**
         * 过滤大类
         */
        this.type = 'date';
        /**
         * 每种类型的过滤配置
         */
        this.date = new FSDate();
        this.enum = new FSEnum();
        this.number = {
            default: 0
        };
        this.text = {
            default: ''
        };
    }
    /**
     * 获取 FS 的默认值
     * 🙅 不可以依赖 data：部件第一次根据默认值筛选时，还没有 data 呢。
     * @param {?} fs
     * @return {?}
     */
    static getDefaultValue(fs) {
        switch (fs.type) {
            case 'date':
                if (fs.date.type === 'single') {
                    if (fs.date.singleDefaultType === 'current') {
                        return new Date();
                    }
                    else {
                        return fs.date.singleDefaultSpecified;
                    }
                }
                else if (fs.date.type === 'range') {
                    return FSRangeDefault.GetDates(fs.date.rangeDefault);
                }
                else if (fs.date.type === 'lastTimeEnum') {
                    return FSLastTimeItem.GetDates(fs.date.lastTimeItems[0]);
                }
                break;
            case 'enum':
                const { multi, singleDefault, multiDefault } = fs.enum;
                return multi ? multiDefault : singleDefault;
            case 'number':
                return fs.number.default;
                break;
            case 'text':
                return fs.text.default;
                break;
        }
    }
}
/**
 * @param {?} fs
 * @return {?}
 */
function ifFsDateRange(fs) {
    if (!fs)
        return;
    return fs.type === 'date' && fs.date.type === 'range';
}
/**
 * @param {?} fs
 * @return {?}
 */
function isFsFlat(fs) {
    if (!fs)
        return;
    return fs.type === 'date' && fs.date.type === 'lastTimeEnum' && fs.date.lastTimeDisplayType === 'flat'
        || fs.type === 'enum' && !fs.enum.multi && fs.enum.displayType === 'flat';
}
/**
 * 官方预制的筛选 property
 * @type {?}
 */
const FILTER_PROP_NAME = 'filter';
/** @type {?} */
const frontendFilterProp = {
    name: FILTER_PROP_NAME,
    displayName: '筛选',
    isArray: true,
    type: PropertyTypes.Object,
    objectOption: {
        objPropertyOptions: [{
                name: 'fs',
                type: PropertyTypes.Filter,
            }, {
                name: 'dpId',
                type: PropertyTypes.DataParam,
            }, {
                name: 'dpId2',
                type: PropertyTypes.DataParam,
                ifShow: (/**
                 * @param {?} pv
                 * @return {?}
                 */
                pv => {
                    return pv.fs && ifFsDateRange(pv.fs);
                })
            }]
    }
};

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/** @enum {string} */
const JumpTypes = {
    None: '0',
    Func: '1',
    ChartTable: '2',
    NewBrowserTab: '3',
};
/**
 * 选择联查类型
 * @type {?}
 */
const jumpTypeOption = {
    type: PropertyTypes.Enum,
    enumOption: {
        default: JumpTypes.None,
        items: [
            { value: JumpTypes.None, displayName: 'none' },
            { value: JumpTypes.Func, displayName: 'toFuncOrInvoke' },
            // { value: JumpTypes.ChartTable, displayName: '跳转至预制图表页' },
            { value: JumpTypes.NewBrowserTab, displayName: 'browserNewTab' }
        ]
    }
}
// let allFuncs
/** 菜单/联查帮助 option */
;
// let allFuncs
/**
 * 菜单/联查帮助 option
 * @type {?}
 */
const funcOption = {
    type: PropertyTypes.Help,
    tip: '选菜单/联查的帮助',
    helpOption: {
        getData: (/**
         * @param {?} httpClient
         * @return {?}
         */
        (httpClient) => {
            return httpClient
                .get('/api/runtime/sys/v1.0/functions/allFuncs')
                .pipe(map((/**
             * @param {?} funcs
             * @return {?}
             */
            funcs => {
                // allFuncs = funcs
                return list2Tree(funcs, {
                    rootParentIdValue: '0',
                    /**
                     * @param {?} item
                     * @return {?}
                     */
                    beforeProcess(item) {
                        if (item.layer === '3') {
                            item.isLeaf = true;
                            item.isTableParent = true;
                        }
                    }
                });
            })));
        }),
        structure: HelpStructure.treeTable,
        tableFields: ['code', 'name'],
        valueField: 'id',
        nameField: 'name'
    }
}
/** 不取决于某条数据值的联查 */
;
/**
 * 不取决于某条数据值的联查
 * @type {?}
 */
const dataJumpOption = {
    category: 'clickJump',
    type: PropertyTypes.Object,
    objectOption: {
        objPropertyOptions: [
            Object.assign({ name: 'jumpType', displayName: 'jumpType' }, jumpTypeOption),
            /** 菜单/联查 */
            {
                name: 'funcIdSource',
                type: PropertyTypes.Enum,
                enumOption: {
                    items: ['fixed', 'fromData']
                },
                /**
                 * @param {?} c
                 * @return {?}
                 */
                ifShow(c) { return c.jumpType === JumpTypes.Func; }
            }, {
                name: 'funcIdDataField',
                type: PropertyTypes.DataField,
                /**
                 * @param {?} c
                 * @return {?}
                 */
                ifShow(c) {
                    return c.jumpType === JumpTypes.Func && c.funcIdSource === 'fromData';
                }
            },
            Object.assign({ name: 'funcId', displayName: 'func/invoke', /**
                 * @param {?} c
                 * @return {?}
                 */
                ifShow(c) {
                    return c.jumpType === JumpTypes.Func && c.funcIdSource === 'fixed';
                } }, funcOption),
            {
                name: 'funcParams',
                displayName: 'routeParams',
                type: PropertyTypes.Object,
                isArray: true,
                objectOption: {
                    objPropertyOptions: [{
                            name: 'key',
                            displayName: 'paramKey',
                            textOption: { i18n: false },
                            type: PropertyTypes.Text,
                        }, {
                            name: 'valueType',
                            displayName: 'valueType',
                            type: PropertyTypes.Enum,
                            enumOption: {
                                items: [
                                    { value: 'fieldName', displayName: 'dataFieldValue' },
                                    { value: 'fixedValue', displayName: 'fixedValue' }
                                ]
                            }
                        }, {
                            name: 'fixedValue',
                            displayName: 'paramFixedValue',
                            type: PropertyTypes.Text,
                            textOption: { i18n: false },
                            /**
                             * @param {?} funcParam
                             * @return {?}
                             */
                            ifShow(funcParam) { return funcParam.valueType === 'fixedValue'; }
                        }, {
                            name: 'fieldName',
                            displayName: 'paramValueField',
                            type: PropertyTypes.DataField,
                            /**
                             * @param {?} funcParam
                             * @return {?}
                             */
                            ifShow(funcParam) { return funcParam.valueType === 'fieldName'; }
                        }]
                },
                /**
                 * @param {?} values
                 * @return {?}
                 */
                ifShow(values) { return values.jumpType === JumpTypes.Func; }
            },
            /** 浏览器标签 */
            {
                name: 'url',
                displayName: 'newTabUrl',
                type: PropertyTypes.Text,
                textOption: { i18n: false },
                /**
                 * @param {?} values
                 * @return {?}
                 */
                ifShow(values) { return values.jumpType === JumpTypes.NewBrowserTab; }
            }, {
                name: 'urlParams',
                displayName: 'urlParams',
                type: PropertyTypes.Object,
                isArray: true,
                objectOption: {
                    objPropertyOptions: [{
                            name: 'valueType',
                            displayName: 'valueType',
                            type: PropertyTypes.Enum,
                            enumOption: {
                                items: [
                                    { value: 'fieldName', displayName: 'dataFieldValue' },
                                    { value: 'fixedValue', displayName: 'fixedValue' }
                                ]
                            }
                        }, {
                            name: 'fixedValue',
                            displayName: 'paramFixedValue',
                            type: PropertyTypes.Text,
                            textOption: { i18n: false },
                            /**
                             * @param {?} urlParam
                             * @return {?}
                             */
                            ifShow(urlParam) { return urlParam.valueType === 'fixedValue'; }
                        }, {
                            name: 'fieldName',
                            displayName: 'paramValueField',
                            type: PropertyTypes.DataField,
                            /**
                             * @param {?} urlParam
                             * @return {?}
                             */
                            ifShow(urlParam) { return urlParam.valueType === 'fieldName'; }
                        }]
                },
                /**
                 * @param {?} values
                 * @return {?}
                 */
                ifShow(values) { return values.jumpType === JumpTypes.NewBrowserTab; }
            }, {
                name: 'queryParams',
                displayName: 'urlQueryParams',
                type: PropertyTypes.Object,
                isArray: true,
                objectOption: {
                    objPropertyOptions: [{
                            name: 'key',
                            displayName: 'paramKey',
                            type: PropertyTypes.Text,
                            textOption: { i18n: false },
                        }, {
                            name: 'valueType',
                            displayName: 'valueType',
                            type: PropertyTypes.Enum,
                            enumOption: {
                                items: [
                                    { value: 'fieldName', displayName: 'dataFieldValue' },
                                    { value: 'fixedValue', displayName: 'fixedValue' }
                                ]
                            }
                        }, {
                            name: 'fixedValue',
                            displayName: 'paramFixedValue',
                            type: PropertyTypes.Text,
                            textOption: { i18n: false },
                            /**
                             * @param {?} funcParam
                             * @return {?}
                             */
                            ifShow(funcParam) { return funcParam.valueType === 'fixedValue'; }
                        }, {
                            name: 'fieldName',
                            displayName: 'paramValueField',
                            type: PropertyTypes.DataField,
                            /**
                             * @param {?} funcParam
                             * @return {?}
                             */
                            ifShow(funcParam) { return funcParam.valueType === 'fieldName'; }
                        }]
                },
                /**
                 * @param {?} values
                 * @return {?}
                 */
                ifShow(values) { return values.jumpType === JumpTypes.NewBrowserTab; }
            }
        ]
    }
}
/** 决于某条数据值的联查 */
;
/**
 * 决于某条数据值的联查
 * @type {?}
 */
const datalessJumpOption = {
    category: 'clickJump',
    type: PropertyTypes.Object,
    objectOption: {
        objPropertyOptions: [
            Object.assign({ name: 'jumpType', displayName: 'jumpType' }, jumpTypeOption),
            Object.assign({ name: 'funcId', displayName: 'func/invoke', /**
                 * @param {?} values
                 * @return {?}
                 */
                ifShow(values) { return values.jumpType === JumpTypes.Func; } }, funcOption),
            {
                name: 'funcParams',
                displayName: 'routeParams',
                type: PropertyTypes.Object,
                isArray: true,
                objectOption: {
                    objPropertyOptions: [{
                            name: 'key',
                            displayName: 'paramKey',
                            type: PropertyTypes.Text,
                            textOption: { i18n: false },
                        }, {
                            name: 'value',
                            displayName: 'paramValue',
                            type: PropertyTypes.Text,
                            textOption: { i18n: false },
                        }]
                },
                /**
                 * @param {?} values
                 * @return {?}
                 */
                ifShow(values) { return values.jumpType === JumpTypes.Func; }
            },
            /** 浏览器标签 */
            {
                name: 'url',
                displayName: 'newTabUrl',
                type: PropertyTypes.Text,
                textOption: { i18n: false },
                /**
                 * @param {?} values
                 * @return {?}
                 */
                ifShow(values) { return values.jumpType === JumpTypes.NewBrowserTab; }
            }
        ]
    }
}
/** @deprecated 请用 datalessJump 或 dataJump */
;
/**
 * @deprecated 请用 datalessJump 或 dataJump
 * @type {?}
 */
const CommonPropertyOptions = {
    jump: datalessJumpOption
};

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/**
 * 元部件属性注册表，形如
 * { constructorName: { propertyName: propertyOption }
 * @type {?}
 */
const WidgetPropertyMap = new Map()
/**
 * TODO: 加入检查，编译时报错（name不应该写；）
 * @param option 可选，默认为 { type: PropertyTypes.String }
 */
;
/**
 * TODO: 加入检查，编译时报错（name不应该写；）
 * @param {?=} option 可选，默认为 { type: PropertyTypes.String }
 * @return {?}
 */
function Property(option = {}) {
    // 这里统一处理：没有设置 type 的一律设置为 Text。没用递归，仅多考虑了 Obj 内一层。
    option.type = option.type || PropertyTypes.Text;
    if (option.objectOption && option.objectOption.objPropertyOptions) {
        option.objectOption.objPropertyOptions.forEach((/**
         * @param {?} subOption
         * @return {?}
         */
        subOption => {
            subOption.type = subOption.type || PropertyTypes.Text;
        }));
    }
    option.isArray = !!option.isArray;
    return (/**
     * @param {?} widgetPrototype
     * @param {?} propName
     * @return {?}
     */
    (widgetPrototype, propName) => {
        // TODO: 想办法把 su 加进所有运行时注册表里的 keys 里
        /** @type {?} */
        const ctorName = widgetPrototype.constructor.name;
        if (!WidgetPropertyMap.get(ctorName))
            WidgetPropertyMap.set(ctorName, []);
        WidgetPropertyMap.get(ctorName).push(Object.assign({ name: propName }, option));
        // 调 angular Input decorator
        Input()(widgetPrototype, propName);
    });
}

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/**
 * @abstract
 */
class WidgetBase {
    /**
     * 因为是父类构造函数所以无法依赖注入, 也没法传入参数;
     * compInstance.field = xxx 的方式又发生在构造函数后而不太好,
     * 所以考虑此父类不提供成员属性, 而通过依赖注入, 在子组件自取.
     */
    constructor() {
        this.title = 'untitled';
        /**
         * @deprecated 是否使用外部数据源。是的话，wc 就拿它的 portlet id 请求数据去。应改为 dataEngine 写法。
         */
        this.useDataEngine = false;
        if (this.widgetName == null)
            console.error(`元部件 ${this.constructor.name} 未添加 @Widget({ name: <name>})`);
    }
    /**
     * 元部件容器大小变化事件，参数 width 为容器宽度，单位 px。
     * 可重写此方法以处理复杂的响应式样式。
     * @param {?} width
     * @param {?} height
     * @return {?}
     */
    onResized(width, height) { }
    /**
     * @param {?} propName
     * @param {?} value
     * @return {?}
     */
    onPropertyChange(propName, value) { }
    /**
     * @deprecated
     * 请用 this.dataService.loadData() 代替
     * @param {?} data 获得的数据
     * @return {?}
     */
    onGetData(data) { }
}
__decorate([
    Property({
        category: '公共属性',
        displayName: '部件标题'
    }),
    __metadata("design:type", Object)
], WidgetBase.prototype, "title", void 0);

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/** @type {?} */
const PropertyTypeDefaultValues = {
    [PropertyTypes.Text]: '',
    [PropertyTypes.Bool]: false,
    [PropertyTypes.Number]: 0,
    [PropertyTypes.DataField]: {}
    // [PropertyTypes.Color]: '#000000',
    // [PropertyTypes.Enum]: 0,
    // [PropertyTypes.Date]: new Date()
    // [PropertyTypes.Object]: {},
}
// const frontendFilterProp: PropertyOption = {
//   name: 'filter',
//   displayName: '筛选',
//   isArray: true,
//   type: PropertyTypes.Filter,
// }
// TODO: filters
;
// const frontendFilterProp: PropertyOption = {
//   name: 'filter',
//   displayName: '筛选',
//   isArray: true,
//   type: PropertyTypes.Filter,
// }
// TODO: filters
/** @type {?} */
const titleBarProps = [{
        category: 'titleBar',
        name: 'titleBarHide',
        type: PropertyTypes.Bool,
        boolOption: {
            default: false
        }
    }, {
        category: 'titleBar',
        name: 'titleBarShowRefresh',
        displayName: 'showRefreshBtn',
        type: PropertyTypes.Bool,
        boolOption: {
            default: true
        }
    }, Object.assign({}, datalessJumpOption, { category: 'titleBar', name: 'titleBarJump' })];
class WidgetPropertyService {
    constructor() { }
    /**
     * 获得某种类型的全局默认值，在完全没有值时使用
     * @param {?} prop
     * @param {?=} arrayItem 是否是来获取 array 的子项默认值的，默认不是。
     * 如果不是，若 prop.isArray 为真，就返回空数组 []；
     * 如果是，则不管 prop.isArray 是否为真，总返回 prop.type 对应的默认值，仅应用于增加数组项时获取新项。
     * @return {?}
     */
    getPropertyDefaultValue(prop, arrayItem = false) {
        if (!arrayItem && prop.isArray)
            return [];
        // object: 递归生成具有所有 key 的对象，每个 key 的 value 是默认值
        if (prop.type === PropertyTypes.Object) {
            /** @type {?} */
            const newObj = {};
            prop.objectOption.objPropertyOptions.forEach((/**
             * @param {?} childProp
             * @return {?}
             */
            (childProp) => {
                newObj[childProp.name] = (childProp[childProp.type]
                    && childProp[childProp.type].default)
                    || this.getPropertyDefaultValue(childProp);
            }));
            return newObj;
        }
        else if (prop.type === PropertyTypes.Enum) {
            /** @type {?} */
            const firstItem = prop.enumOption.items[0];
            return typeof firstItem === 'string'
                ? firstItem
                : firstItem['value'];
        }
        else if (prop.type === PropertyTypes.Color) {
            /** @type {?} */
            const colors = this.getColorsByColorOption(prop.colorOption);
            /** @type {?} */
            const i = Math.random();
            return colors[Math.floor(i * colors.length)];
        }
        else if (prop.type === PropertyTypes.Filter) {
            return new FilterSchema();
        }
        else {
            return PropertyTypeDefaultValues[prop.type];
        }
    }
    /**
     * 元部件加载、编译完成后，组装新的 properties
     * widget name
     * -> constructor name
     * -> widget + title bar + base properties
     * -> 元部件的所有可配置 properties
     * @param {?} widgetName
     * @param {?} widgetConfig
     * @return {?}
     */
    getWidgetProps(widgetName, widgetConfig) {
        /** @type {?} */
        const ctorName = WidgetRegistry.getWidgetByName(widgetName).ctor.name
        // widget 子类中的 property
        ;
        // widget 子类中的 property
        /** @type {?} */
        const widgetProps = WidgetPropertyMap.get(ctorName) || []
        // 筛选出 widget 子类中没重写过的 property，否则可能会有俩一样的
        ;
        // 筛选出 widget 子类中没重写过的 property，否则可能会有俩一样的
        /** @type {?} */
        const baseProps = WidgetPropertyMap.get(WidgetBase.name)
            .filter((/**
         * @param {?} baseProp
         * @return {?}
         */
        baseProp => !widgetProps.some((/**
         * @param {?} prop
         * @return {?}
         */
        prop => baseProp.name === prop.name))))
        // 组装
        ;
        // 组装
        return [
            // 公共配置都放这
            ...baseProps,
            // 标题配置
            ...(widgetConfig.enableCommonTitleBar
                ? titleBarProps
                : []),
            // 筛选配置
            ...(widgetConfig.enableDataConfig && widgetConfig.enableCommonTitleBar
                ? [frontendFilterProp]
                : []),
            // 元部件自身配置
            ...widgetProps
            // ...testProps,
        ];
    }
    /**
     * mixin 已有pv + 元部件推荐的默认pv + 此类型的全局默认pv
     * @param {?} props
     * @param {?} propValues
     * @return {?}
     */
    mixinWidgetPropValues(props, propValues) {
        /** @type {?} */
        const mixinedPropValues = Object.assign({}, propValues)
        // 检查所有 properties，哪个没有值，就赋上默认推荐值
        ;
        // 检查所有 properties，哪个没有值，就赋上默认推荐值
        props.forEach((/**
         * @param {?} prop
         * @return {?}
         */
        prop => {
            // 这里必须是判断 undefined，否则 bool 类型的 false 也可能判定为无值
            if (mixinedPropValues[prop.name] === undefined) {
                mixinedPropValues[prop.name] = prop[prop.type] && prop[prop.type].default
                    // 如果元部件无默认值，就加入全局的当前类型默认值
                    || this.getPropertyDefaultValue(prop);
            }
        }));
        return mixinedPropValues;
    }
    /**
     * @param {?} colorOption
     * @return {?}
     */
    getColorsByColorOption(colorOption) {
        if (colorOption && colorOption.palette)
            return colorOption.palette;
        /** @type {?} */
        const colorType = colorOption ? colorOption.type : 'pure';
        /** @type {?} */
        let colors;
        switch (colorType) {
            case 'gradient':
                colors = PlThemeColors.gradient;
                break;
            case 'pureOrGradient':
                colors = [...PlThemeColors.pure, ...PlThemeColors.gradient];
                break;
            case 'pure':
            default:
                colors = PlThemeColors.pure;
                break;
        }
        return colors;
    }
}
WidgetPropertyService.decorators = [
    { type: Injectable, args: [{
                providedIn: 'root'
            },] }
];
/** @nocollapse */
WidgetPropertyService.ctorParameters = () => [];
/** @nocollapse */ WidgetPropertyService.ngInjectableDef = defineInjectable({ factory: function WidgetPropertyService_Factory() { return new WidgetPropertyService(); }, token: WidgetPropertyService, providedIn: "root" });

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
// TODO: 左图右表页面、funcId
/** @type {?} */
const CHART_TABLE_FUNC_ID = '???';

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/**
 * @deprecated
 * 为了 widget-devkit 的兼容而暂时保留。不准再用了。
 * 元部件应该直接用 \@gspwidget/util。
 * @type {?}
 */
const DASHBOARD_API = 'DashboardApi';
class WidgetDevkitService {
    /**
     * @param {?} modalService
     */
    constructor(modalService) {
        this.modalService = modalService;
    }
    /**
     * @param {?} content
     * @param {?=} config
     * @return {?}
     */
    openModal(content, config) {
        return this.modalService.show(content, config);
    }
    /**
     * @param {?} funcId
     * @param {?=} queryParamsArray
     * @return {?}
     */
    openMenu(funcId, queryParamsArray) {
        window[DASHBOARD_API].openMenu(funcId, queryParamsArray);
    }
    /**
     * @param {?} appId
     * @return {?}
     */
    openApp(appId) {
        window[DASHBOARD_API].openApp(appId);
    }
    /**
     * options 参考 https://ng.ant.design/components/message/zh
     * @param {?} content
     * @param {?=} options
     * @return {?}
     */
    openInfoMsg(content, options) {
        window[DASHBOARD_API].messageSvc.info(content, options);
    }
    /**
     * options 参考 https://ng.ant.design/components/message/zh
     * @param {?} content
     * @param {?=} options
     * @return {?}
     */
    openSuccessMsg(content, options) {
        window[DASHBOARD_API].messageSvc.success(content, options);
    }
    /**
     * options 参考 https://ng.ant.design/components/message/zh
     * @param {?} content
     * @param {?=} options
     * @return {?}
     */
    openWarningMsg(content, options) {
        window[DASHBOARD_API].messageSvc.warning(content, options);
    }
    /**
     * options 参考 https://ng.ant.design/components/message/zh
     * @param {?} content
     * @param {?=} options
     * @return {?}
     */
    openErrorMsg(content, options) {
        window[DASHBOARD_API].messageSvc.error(content, options);
    }
    /**
     * @param {?} dataOption
     * @return {?}
     */
    getData(dataOption) {
        return window[DASHBOARD_API].storageSvc.getData(dataOption);
    }
    /**
     * @param {?=} reload
     * @return {?}
     */
    getUserInfo(reload = false) {
        return window[DASHBOARD_API].storageSvc.getUserInfo(reload);
    }
    /**
     * @param {?=} reload
     * @return {?}
     */
    getUserAvatar(reload = false) {
        return window[DASHBOARD_API].storageSvc.getUserAvatar(reload);
    }
    /**
     * @deprecated 应用另外两个 jump 方法
     * 联查跳转，直接把配置属性的值传进来就行。配成“无”就不跳转。
     * @param {?} jumpProperty 跳转的配置属性的值
     * @param {?=} dataItem 当前跳转对应的数据行。如果是全局跳转，就传入第一行？
     * @return {?}
     */
    jump(jumpProperty, dataItem) {
        const { type, funcId, params } = jumpProperty;
        /** @type {?} */
        const queryParamsArray = Array.isArray(params)
            ? params.map((/**
             * @param {?} param
             * @return {?}
             */
            param => [param.key, (param.valueType === 'fixedValue'
                    ? param.fixedValue
                    : (dataItem
                        ? dataItem[param.fieldName.name]
                        : undefined))]))
            : undefined;
        switch (type) {
            case JumpTypes.None:
                return;
            case JumpTypes.Func:
                this.openMenu(funcId, queryParamsArray);
                break;
            case JumpTypes.ChartTable:
                this.openMenu(CHART_TABLE_FUNC_ID, queryParamsArray);
                break;
        }
    }
    /**
     * @param {?} dataJumpConfig
     * @param {?} dataItem
     * @return {?}
     */
    jumpWithData(dataJumpConfig, dataItem) {
        const { jumpType, funcIdSource, funcIdDataField, funcId, funcParams, url, urlParams, queryParams } = dataJumpConfig;
        /** @type {?} */
        const funcParamsArray = Array.isArray(funcParams)
            ? funcParams.map((/**
             * @param {?} funcParam
             * @return {?}
             */
            funcParam => [funcParam.key, (funcParam.valueType === 'fixedValue'
                    ? funcParam.fixedValue
                    : (dataItem
                        ? dataItem[funcParam.fieldName.name]
                        : undefined))]))
            : undefined;
        switch (jumpType) {
            case JumpTypes.None:
                return;
            case JumpTypes.Func:
                /** @type {?} */
                const resultFuncId = (!funcIdSource || funcIdSource === 'fixed')
                    ? funcId
                    : dataItem[funcIdDataField.name];
                if (resultFuncId)
                    this.openMenu(resultFuncId, funcParamsArray);
                break;
            case JumpTypes.ChartTable:
                this.openMenu(CHART_TABLE_FUNC_ID, funcParamsArray);
                break;
            case JumpTypes.NewBrowserTab:
                // 拼 url
                /** @type {?} */
                let finalUrl = url
                // + urlParams
                ;
                // + urlParams
                if (urlParams && urlParams.length > 0) {
                    /** @type {?} */
                    const urlParamPart = urlParams.map((/**
                     * @param {?} urlParam
                     * @return {?}
                     */
                    urlParam => {
                        const { valueType, fixedValue, fieldName } = urlParam;
                        return valueType === 'fixedValue' ? fixedValue : dataItem[fieldName.name];
                    })).join('/');
                    finalUrl += url.endsWith('/') ? '' : '/';
                    finalUrl += urlParamPart;
                }
                // + queryParams
                if (queryParams && queryParams.length > 0) {
                    /** @type {?} */
                    const queryParamPart = queryParams.map((/**
                     * @param {?} queryParam
                     * @return {?}
                     */
                    queryParam => {
                        const { key, valueType, fixedValue, fieldName } = queryParam;
                        return `${key}=${valueType === 'fixedValue' ? fixedValue : dataItem[fieldName.name]}`;
                    })).join('&');
                    finalUrl += '?' + queryParamPart;
                }
                // 打开
                window.open(finalUrl, '_blank');
        }
    }
    /**
     * @param {?} datalessJumpConfig
     * @return {?}
     */
    jumpWithoutData(datalessJumpConfig) {
        const { jumpType, funcId, funcParams, url } = datalessJumpConfig;
        /** @type {?} */
        const funcParamsArray = Array.isArray(funcParams)
            ? funcParams.map((/**
             * @param {?} funcParam
             * @return {?}
             */
            funcParam => [funcParam.key, funcParam.value]))
            : undefined;
        switch (jumpType) {
            case JumpTypes.None:
                return;
            case JumpTypes.Func:
                this.openMenu(funcId, funcParamsArray);
                break;
            case JumpTypes.ChartTable:
                this.openMenu(CHART_TABLE_FUNC_ID, funcParamsArray);
                break;
            case JumpTypes.NewBrowserTab:
                window.open(url, '_blank');
        }
    }
}
WidgetDevkitService.decorators = [
    { type: Injectable }
];
/** @nocollapse */
WidgetDevkitService.ctorParameters = () => [
    { type: BsModalService }
];

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
class WidgetTitleBarComponent {
    /**
     * @param {?} devkitSvc
     */
    constructor(devkitSvc) {
        this.devkitSvc = devkitSvc;
        this.icon = '';
        /**
         * 标题
         */
        this.showTitle = true;
        this.title = '';
        /**
         * 数字
         */
        this.showNumber = false;
        this.number = 0;
        /**
         * 设置按钮
         */
        this.showSetting = false;
        this.clickSetting = new EventEmitter();
        /**
         * 刷新按钮
         */
        this.showRefresh = false;
        this.clickRefresh = new EventEmitter();
        this.JumpTypes = JumpTypes;
    }
    /**
     * @return {?}
     */
    ngOnInit() { }
    /**
     * @return {?}
     */
    handleClickJump() {
        this.devkitSvc.jumpWithoutData(this.jumpConfig);
    }
}
WidgetTitleBarComponent.decorators = [
    { type: Component, args: [{
                selector: 'lib-widget-title-bar',
                template: "\n<div class=\"widget-title-bar d-flex\">\n  <!-- left -->\n  <div class=\"left align-items-center\">\n    <i *ngIf=\"icon!=''\" class=\"material-icons\">{{icon}}</i>\n    <div *ngIf=\"showTitle\" class=\"title\">{{title}}</div>\n    <div *ngIf=\"showNumber\" class=\"number\">{{number}}</div>\n    <ng-container *ngTemplateOutlet=\"leftTemplate\"></ng-container>\n  </div>\n  <!-- right -->\n  <div class=\"right\">\n    <ng-container *ngTemplateOutlet=\"rightTemplate\"></ng-container>\n    <div class=\"tool-wrap d-flex\" [title]=\"(settingTitle || '') | translate\">\n      <img\n        class=\"setting\"\n        *ngIf=\"showSetting\"\n        (click)=\"clickSetting.emit()\"\n        src=\"assets/img/setting.svg\"\n        [alt]=\"settingTitle\">\n    </div>\n    <div\n      class=\"tool-wrap d-flex\"\n      *ngIf=\"showRefresh\"\n      (click)=\"clickRefresh.emit()\">\n      <i class=\"icon-refresh material-icons\" style=\"font-size: 20px;\">refresh</i>\n    </div>\n    <div\n      *ngIf=\"jumpConfig && jumpConfig.jumpType!==JumpTypes.None\"\n      (click)=\"handleClickJump()\"\n      class=\"tool-wrap d-flex\">\n      <i class=\"material-icons\">chevron_right</i>\n    </div>\n  </div>\n</div>",
                encapsulation: ViewEncapsulation.None,
                styles: ["@charset \"UTF-8\";.widget-title-bar{display:flex;padding:12px 20px 10px}.widget-title-bar .left{flex:1 1 auto;display:flex}.widget-title-bar .left .material-icons{font-size:18px;margin-right:8px;color:#3794ff;padding-top:1px}.widget-title-bar .left .title{font-weight:700;font-size:15px}.widget-title-bar .left .number{font-size:15px;margin-left:10px}.widget-title-bar .right{flex:1 1 auto;display:flex;justify-content:flex-end;align-items:center}.widget-title-bar .right .widget-select{margin-left:5px}.widget-title-bar .right .setting{width:16px;height:16px;transition:.3s;opacity:1!important}.widget-title-bar .right .setting:hover{transform:rotate(60deg)}.widget-title-bar .right .tool-wrap{width:20px;margin-left:10px;font-size:14px;color:#000;transition:.3s;cursor:pointer;opacity:.2}.widget-title-bar .right .tool-wrap:hover{opacity:.4}"]
            }] }
];
/** @nocollapse */
WidgetTitleBarComponent.ctorParameters = () => [
    { type: WidgetDevkitService }
];
WidgetTitleBarComponent.propDecorators = {
    icon: [{ type: Input }],
    showTitle: [{ type: Input }],
    title: [{ type: Input }],
    showNumber: [{ type: Input }],
    number: [{ type: Input }],
    showSetting: [{ type: Input }],
    settingTitle: [{ type: Input }],
    clickSetting: [{ type: Output }],
    showRefresh: [{ type: Input }],
    clickRefresh: [{ type: Output }],
    jumpConfig: [{ type: Input }],
    jumpProperty: [{ type: Input }],
    data: [{ type: Input }],
    leftTemplate: [{ type: ContentChild, args: ['leftTemplate',] }],
    rightTemplate: [{ type: ContentChild, args: ['rightTemplate',] }]
};

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
class WidgetTitleBarSelectComponent {
    constructor() {
        this.filterOptions = [];
        this.onFilterChange = new EventEmitter();
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.filter = new FormControl(this.defaultFilterValue ? this.defaultFilterValue : this.filterOptions[0].value);
        this.filter.valueChanges.subscribe((/**
         * @param {?} newValue
         * @return {?}
         */
        newValue => {
            this.onFilterChange.emit(newValue);
        }));
    }
}
WidgetTitleBarSelectComponent.decorators = [
    { type: Component, args: [{
                selector: 'lib-widget-title-bar-select',
                template: "\n<select\n  [formControl]=\"filter\"\n  class=\"widget-select form-control\" >\n  <option *ngFor=\"let option of filterOptions\"\n    [value]=\"option.value\">{{option.name}}</option>\n</select>",
                styles: [".widget-select{font-size:12px;padding:0 5px;height:25px}"]
            }] }
];
/** @nocollapse */
WidgetTitleBarSelectComponent.ctorParameters = () => [];
WidgetTitleBarSelectComponent.propDecorators = {
    defaultFilterValue: [{ type: Input }],
    filterOptions: [{ type: Input }],
    onFilterChange: [{ type: Output }]
};

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
class WidgetTitleBarModule {
}
WidgetTitleBarModule.decorators = [
    { type: NgModule, args: [{
                declarations: [
                    WidgetTitleBarComponent,
                    WidgetTitleBarSelectComponent
                ],
                exports: [
                    WidgetTitleBarComponent,
                    WidgetTitleBarSelectComponent
                ],
                imports: [
                    CommonModule,
                    ReactiveFormsModule,
                    TranslateModule.forChild()
                ]
            },] }
];

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
class Gradient {
    /**
     * @param {?} colorStops
     */
    constructor(colorStops) {
        this.colorStops = colorStops || [];
    }
    /**
     * @param {?} offset
     * @param {?} color
     * @return {?}
     */
    addColorStop(offset, color) {
        this.colorStops.push({
            offset,
            color,
        });
    }
}

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/**
 * x, y, x2, y2 are all percent from 0 to 1 when globalCoord is false
 */
class LinearGradient extends Gradient {
    /**
     * @param {?} x
     * @param {?} y
     * @param {?} x2
     * @param {?} y2
     * @param {?=} colorStops
     * @param {?=} globalCoord
     */
    constructor(x, y, x2, y2, colorStops, globalCoord) {
        super(colorStops);
        // Should do nothing more in this constructor. Because gradient can be
        // declard by `color: {type: 'linear', colorStops: ...}`, where
        // this constructor will not be called.
        this.x = x == null ? 0 : x;
        this.y = y == null ? 0 : y;
        this.x2 = x2 == null ? 1 : x2;
        this.y2 = y2 == null ? 0 : y2;
        // Can be cloned
        this.type = "linear";
        // If use global coord
        this.global = globalCoord || false;
    }
}

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/** @type {?} */
const EchartsOptions = {
    grid: {
        top: 20,
        right: 30,
        bottom: 36,
        left: 10,
        containLabel: true,
    },
    xAxis: {
        type: 'category',
        axisLine: {
            lineStyle: {
                color: '#D9D9D9',
            }
        },
        axisTick: {
            lineStyle: {
                color: '#D9D9D9',
            }
        },
        axisLabel: {
            color: 'black',
            margin: 10,
            fontSize: 11
        }
    },
    yAxis: {
        axisLine: {
            show: false
        },
        axisTick: {
            show: false
        },
        splitLine: {
            lineStyle: {
                color: '#E4EBF057',
            }
        },
        axisLabel: {
            fontSize: 11
        }
    },
    legend: {
        // left: 45,
        // top: -3,
        x: 'center',
        y: 'bottom',
        itemWidth: 16,
        itemHeight: 3,
        borderRadius: 2,
        icon: 'roundRect',
        padding: [15, 0],
        textStyle: {
            color: '#000000a6'
        }
    },
    tooltip: {
        backgroundColor: "#ffffffe8",
        textStyle: {
            color: "#000000e6",
        },
        extraCssText: "box-shadow: 0px 1px 7px #00000017;",
        appendToBody: true,
        confine: true,
    },
};
/** @type {?} */
const chartsConsts = {
    /**
     * series label 字体大小
     */
    seriesLabelFontSize: 9,
};
const ɵ0 = /**
 * @param {?} c
 * @return {?}
 */
c => c.split(',');
/** @type {?} */
const splitedGradientColors = PlThemeColors.gradient.map((ɵ0));
/** @type {?} */
const getChartColorsPure = (/**
 * @param {?} params
 * @return {?}
 */
(params) => {
    return PlThemeColors.pure[params.dataIndex];
});
/** @type {?} */
const getChartColorsGradient = (/**
 * @param {?} params
 * @return {?}
 */
(params) => {
    return new LinearGradient(0, 0, 0, 1, [
        { offset: 0, color: splitedGradientColors[params.dataIndex % splitedGradientColors.length][0] },
        { offset: 1, color: splitedGradientColors[params.dataIndex % splitedGradientColors.length][1] }
    ]);
});
/** @type {?} */
const getChartColorsGradientOne = (/**
 * @param {?} params
 * @return {?}
 */
(params) => {
    return new LinearGradient(1, 0, 0, 0, [
        { offset: 0, color: splitedGradientColors[params.dataIndex % splitedGradientColors.length][0] },
        { offset: 1, color: splitedGradientColors[params.dataIndex % splitedGradientColors.length][1] }
    ]);
})
/**
 * 对于有 “y 轴自定义范围” 的 charts 元部件，data 都要用它过滤后再用
 * @param obj 元部件实例
 */
;
/**
 * 对于有 “y 轴自定义范围” 的 charts 元部件，data 都要用它过滤后再用
 * @param {?} obj 元部件实例
 * @param {?} data
 * @return {?}
 */
function filterYData(obj, data) {
    if (obj.filterYFlag) {
        /** @type {?} */
        const yFields = obj.yFieldObjs.map((/**
         * @param {?} o
         * @return {?}
         */
        o => o.valueField.name));
        return data.filter((/**
         * @param {?} item
         * @return {?}
         */
        item => {
            return !yFields.some((/**
             * @param {?} yField
             * @return {?}
             */
            yField => item[yField] <= obj.minY || item[yField] >= obj.maxY));
        }));
    }
    return data;
}
/** @type {?} */
const EchartsPropertyOptions = {
    showRefresh: {
        category: 'data',
        displayName: 'showRefreshBtn',
        type: PropertyTypes.Bool,
        boolOption: {
            default: true
        }
    },
    filterYFlag: {
        type: PropertyTypes.Bool,
        category: 'data',
        displayName: 'setYRange'
    },
    minY: {
        type: PropertyTypes.Number,
        category: 'data',
        displayName: 'minY',
        numberOption: {
            default: 0
        },
        /**
         * @param {?} values
         * @return {?}
         */
        ifShow(values) { return values.filterYFlag; }
    },
    maxY: {
        type: PropertyTypes.Number,
        category: 'data',
        displayName: 'maxY',
        numberOption: {
            default: 1000
        },
        /**
         * @param {?} values
         * @return {?}
         */
        ifShow(values) { return values.filterYFlag; }
    },
    showLabel: {
        category: 'style',
        type: PropertyTypes.Bool,
        displayName: 'showNumber'
    },
    showTooltip: {
        category: 'style',
        type: PropertyTypes.Bool,
        boolOption: { default: true },
        displayName: 'showHoverDetail'
    },
    legendStyleOption: {
        type: PropertyTypes.Enum,
        displayName: 'legendType',
        category: 'style',
        enumOption: {
            default: 'scroll',
            items: [
                { value: 'none', displayName: 'notVisible' },
                { value: 'plain', displayName: 'showAll' },
                { value: 'scroll', displayName: 'scrollOverflow' }
            ]
        }
    },
    valueStyleOption: {
        type: PropertyTypes.Enum,
        displayName: 'valueType',
        category: 'style',
        enumOption: {
            default: 'right',
            items: [
                { value: 'right', displayName: 'right' },
                { value: 'insideRight', displayName: 'inside' },
            ]
        }
    }
}
/**
 * 三种传参方式：
 * 1. '#000', '#fff'
 * 2. '#000,#fff'
 * 3. '#000'
 */
;
/**
 * 三种传参方式：
 * 1. '#000', '#fff'
 * 2. '#000,#fff'
 * 3. '#000'
 * @param {?} c1
 * @param {?=} c2
 * @return {?}
 */
function echartsGradient(c1, c2) {
    // 若只传了一个值、还不是逗号分割，则直接返回此纯色
    if (!c2 && !c1.includes(','))
        return c1;
    // 若只传了一个值、是逗号分割，就分割为俩颜色
    if (!c2)
        [c1, c2] = c1.split(',');
    return new LinearGradient(0, 0, 0, 1, [
        { offset: 0, color: c1 },
        { offset: 1, color: c2 }
    ]);
}
// TODO: 暂时给资金做国际化
/** @type {?} */
const tempMap = {
    '金额': {
        'en': 'Amount',
        'zh-CHS': '金额',
    },
    '数量': {
        'en': 'Number',
        'zh-CHS': '数量',
    }
}
// TODO: 暂时给资金国际化
;
// TODO: 暂时给资金国际化
/**
 * @param {?} dataField
 * @param {?} currentLang
 * @return {?}
 */
function tempLabel(dataField, currentLang) {
    const { label } = dataField;
    return tempMap[label] && tempMap[label][currentLang]
        ? tempMap[label][currentLang]
        : dataField.label;
}

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/**
 * dataItem 这个名字会影响 exp 中的写法，不可随意更改。
 * @param {?} html
 * @param {?} dataItem
 * @return {?}
 */
function resolveTemplate(html, dataItem) {
    /** @type {?} */
    const expPatt = /{{[\d\D]+?}}/gm;
    if (!html)
        return '';
    /** @type {?} */
    const exps = html.match(expPatt) || [];
    try {
        exps.forEach((/**
         * @param {?} exp
         * @return {?}
         */
        exp => {
            html = html.replace(exp, eval(exp.slice(2, -2)));
        }));
    }
    catch (err) {
        return html;
    }
    return html;
}

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/**
 * 数据加载不应该让此 service 直接发出，因为外部框架并不随时都支持取数，
 * 比如新增部件后的部件配置，此时没有配置过数据，便会服务端报错。
 * 应该交由元部件容器加载数据。
 */
class WidgetDataService {
    constructor() {
        /**
         * loadData() / reloadData() 时触发，外部元部件容器接收、加载数据，并通过 setData 设置回数据
         */
        this.onLoadData = new EventEmitter();
        this.onGetData = new EventEmitter();
        this.onGetDataWithDims = new EventEmitter();
    }
    /**
     * 元部件调用此方法获取数据。示例：
     * ```ts
     * this.dataService.loadData().subscribe(data => {
     *  this.data = data // 使用数据
     * })
     * ```
     * @param {?=} options
     * @return {?}
     */
    loadData(options) {
        this.onLoadData.emit(options);
        return this.onGetData;
    }
    /**
     * 获取全数据信息，包含 dimensions
     * @param {?=} options
     * @return {?}
     */
    loadDataWithDims(options) {
        this.onLoadData.emit(options);
        return this.onGetDataWithDims;
    }
    /**
     * 元部件调用此方法以重新获取数据，数据加载完成后再次调用在 loadData() 注册的事件处理器。示例：
     * ```ts
     * this.dataService.refreshData()
     * ```
     * @param {?=} param
     * @return {?}
     */
    reloadData(param) {
        this.onLoadData.emit(param);
    }
    /**
     * 外部通过此方法给元部件设置数据，元部件无需调用
     * @param {?} dataWithDims 要设置的数据
     * @return {?}
     */
    setData(dataWithDims) {
        this.onGetData.emit(dataWithDims.tableData);
        this.onGetDataWithDims.emit(dataWithDims);
    }
}
WidgetDataService.decorators = [
    { type: Injectable }
];

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/**
 * 可依赖注入至元部件的元部件实例信息
 */
class WidgetInstanceInfo {
    /**
     * @param {?=} portletId
     * @param {?=} id
     * @param {?=} assetsBaseUrl
     */
    constructor(portletId, id, assetsBaseUrl) {
        this.portletId = portletId;
        this.id = id;
        this.assetsBaseUrl = assetsBaseUrl;
    }
}

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
// import { TranslateModule } from '@ngx-translate/core';
class WidgetDevkitModule {
}
WidgetDevkitModule.decorators = [
    { type: NgModule, args: [{
                declarations: [],
                providers: [WidgetDevkitService],
                imports: [
                    CommonModule,
                    // 需要加 forRoot，保证 WidgetDevkitService 能在此层找到依赖的里面的服务。
                    // 无法保证外部环境。
                    ModalModule.forRoot(),
                ],
                exports: [
                    // TranslateModule
                    WidgetTitleBarModule
                ]
            },] }
];

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */

export { Widget, WidgetRegistry, WidgetEvent, WidgetEventMap, WidgetEventService, WidgetPropertyService, Property, WidgetPropertyMap, WidgetTitleBarModule, WidgetTitleBarComponent, WidgetTitleBarSelectComponent, WidgetBase, resolveTemplate, JumpTypes, jumpTypeOption, funcOption, dataJumpOption, datalessJumpOption, CommonPropertyOptions, filterYData, echartsGradient, tempLabel, EchartsOptions, chartsConsts, getChartColorsPure, getChartColorsGradient, getChartColorsGradientOne, EchartsPropertyOptions, tempMap, WidgetDataService, WidgetInstanceInfo, WidgetDevkitModule, DASHBOARD_API, WidgetDevkitService, PropertyTypes, HelpStructure, CHART_TABLE_FUNC_ID, getObj, ifFsDateRange, isFsFlat, FSLastTimeItem, FSRangeDefault, FSDate, FSEnum, FSEnumItem, FilterSchema, FILTER_PROP_NAME, frontendFilterProp };

//# sourceMappingURL=gspwidget-widget-devkit.js.map
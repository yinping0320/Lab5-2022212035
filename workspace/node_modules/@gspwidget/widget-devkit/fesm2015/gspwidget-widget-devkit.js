import add from 'date-fns/add';
import sub from 'date-fns/sub';
import { map } from 'rxjs/operators';
import { __decorate, __metadata } from 'tslib';
import { FormControl, ReactiveFormsModule } from '@angular/forms';
import { TranslateModule } from '@ngx-translate/core';
import { curLang, FILTERS_WIDGET_FILTERS_PROP_NAME, FILTERS_WIDGET_NAME, list2Tree, PlThemeColors } from '@gspwidget/util';
import { Injectable, EventEmitter, NgModule, Input, Component, ContentChild, Output, ViewEncapsulation, defineInjectable } from '@angular/core';
import { CommonModule } from '@angular/common';
import { BsModalService, ModalModule } from 'ngx-bootstrap/modal';

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
// if (!window.widgetBaseProperies) window.widgetBaseProperies = []
if (!window.registry)
    window.registry = {};
/**
 * å…ƒéƒ¨ä»¶æ³¨å†Œè¡¨
 * @type {?}
 */
const WidgetRegistry = {
    /**
     * @param {?} name
     * @param {?} config
     * @return {?}
     */
    setWidget(name, config) {
        if (!window.registry[name])
            window.registry[name] = {};
        window.registry[name] = Object.assign({}, window.registry[name], config);
    },
    /**
     * @param {?} name
     * @return {?}
     */
    getWidgetByName(name) {
        return window.registry[name];
    },
    /**
     * @param {?} ctorName
     * @return {?}
     */
    getWidgetByCtorName(ctorName) {
        return Object.values(window.registry)
            .find((/**
         * @param {?} widgetConfig
         * @return {?}
         */
        (widgetConfig) => {
            return widgetConfig.ctor.name === ctorName;
        }));
    }
};

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/**
 * @param {?} widgetConfig
 * @return {?}
 */
function Widget(widgetConfig) {
    return (/**
     * @param {?} constructor
     * @return {?}
     */
    (constructor) => {
        WidgetRegistry.setWidget(widgetConfig.name, Object.assign({ ctor: constructor }, widgetConfig));
        // çˆ¶ç±» WidgetBase
        constructor.prototype.widgetName = widgetConfig.name;
    });
}

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/** @type {?} */
const WidgetEventMap = new Map()
/** ç”¨äºæŠŠ EventEmitter å±æ€§æ³¨å†Œä¸ºå…ƒéƒ¨ä»¶äº‹ä»¶ */
;
/**
 * ç”¨äºæŠŠ EventEmitter å±æ€§æ³¨å†Œä¸ºå…ƒéƒ¨ä»¶äº‹ä»¶
 * @param {?=} eventConfig
 * @return {?}
 */
function WidgetEvent(eventConfig = {}) {
    return (/**
     * @param {?} widgetPrototype
     * @param {?} eventPropName
     * @return {?}
     */
    (widgetPrototype, eventPropName) => {
        // TODO: æƒ³åŠæ³•æŠŠ su åŠ è¿›æ‰€æœ‰è¿è¡Œæ—¶æ³¨å†Œè¡¨é‡Œçš„ keys é‡Œ
        /** @type {?} */
        const ctorName = widgetPrototype.constructor.name;
        if (!WidgetEventMap.get(ctorName))
            WidgetEventMap.set(ctorName, []);
        WidgetEventMap.get(ctorName).push(Object.assign({ propName: eventPropName }, eventConfig));
    });
}

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
class WidgetEventService {
    constructor() { }
    /**
     * @param {?} widgetName
     * @param {?} pvs
     * @return {?}
     */
    getEventsByWidgetName(widgetName, pvs) {
        /** @type {?} */
        const ctorName = WidgetRegistry.getWidgetByName(widgetName).ctor.name;
        /** @type {?} */
        const widgetEvents = WidgetEventMap.get(ctorName) || [];
        if (widgetName === FILTERS_WIDGET_NAME) {
            return pvs[FILTERS_WIDGET_FILTERS_PROP_NAME].map((/**
             * @param {?} fc
             * @return {?}
             */
            (fc) => ({
                name: fc.i18nName[curLang],
                propName: fc.i18nName[curLang],
            })));
        }
        // ç»„è£…
        return [
            ...widgetEvents,
            ...test,
        ];
    }
}
WidgetEventService.decorators = [
    { type: Injectable, args: [{
                providedIn: 'root'
            },] }
];
/** @nocollapse */
WidgetEventService.ctorParameters = () => [];
/** @nocollapse */ WidgetEventService.ngInjectableDef = defineInjectable({ factory: function WidgetEventService_Factory() { return new WidgetEventService(); }, token: WidgetEventService, providedIn: "root" });
/** @type {?} */
const test = [{
        name: 'click bar'
    }, {
        name: 'event 2'
    }, {
        name: 'event 3'
    }];

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/** @enum {string} */
const PropertyTypes = {
    Text: 'textOption',
    Bool: 'boolOption',
    Number: 'numberOption',
    Enum: 'enumOption',
    Color: 'colorOption',
    // Date = 'dateOption',
    Object: 'objectOption',
    Custom: 'customOption',
    SelectHelp: 'selectHelpOption',
    /** Help å¾—åˆ°çš„å€¼çš„ç»“æ„ï¼Œå–å†³äºé…ç½® HelpOption åï¼Œæœ€ç»ˆå¾—åˆ°çš„æ•°æ®ç»“æ„ */
    Help: 'helpOption',
    /** DataField å¾—åˆ°çš„å€¼çš„å€¼çš„ç±»å‹ä¸º DataField */
    DataField: 'dataFieldOption',
    Filter: 'filterOption',
    Html: 'htmlOption',
    DataParam: 'dataParamOption',
};
/** @enum {number} */
const HelpStructure = {
    table: 0,
    treeTable: 1,
    transfer: 2,
    treeTransfer: 3,
};
HelpStructure[HelpStructure.table] = 'table';
HelpStructure[HelpStructure.treeTable] = 'treeTable';
HelpStructure[HelpStructure.transfer] = 'transfer';
HelpStructure[HelpStructure.treeTransfer] = 'treeTransfer';

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/**
 * æ²¡å‘ç›´æ¥ç”¨ [] ä½œ key ç›´æ¥å»º literal å¯¹è±¡ï¼Œaot ç¼–è¯‘ä¼šæŠ¥é”™
 * @param {?} key
 * @param {?} value
 * @return {?}
 */
function getObj(key, value) {
    /** @type {?} */
    const obj = {};
    obj[key] = value;
    return obj;
}
/**
 * ç­›é€‰æè¿°
 */
class FSLastTimeItem {
    constructor() {
        this.num = 1;
        this.unit = 'day';
    }
    /**
     * ä¼ å…¥ä¸€ä¸ª 'æœ€è¿‘næŸ'ï¼Œè¿”å›å¯¹åº”çš„æ—¶é—´èŒƒå›´æ•°ç»„
     * @param {?} lastTimeItem
     * @return {?}
     */
    static GetDates(lastTimeItem) {
        return [
            sub(new Date(), getObj(lastTimeItem.unit + 's', lastTimeItem.num)),
            new Date()
        ];
    }
}
class FSRangeDefault {
    constructor() {
        this.beforeNum = 1;
        this.beforeUnit = 'month';
        this.afterNum = 0;
        this.afterUnit = 'day';
    }
    /**
     * @param {?} rangeDefault
     * @return {?}
     */
    static GetDates(rangeDefault) {
        return [
            sub(new Date(), getObj(rangeDefault.beforeUnit + 's', rangeDefault.afterNum)),
            add(new Date(), getObj(rangeDefault.beforeUnit + 's', rangeDefault.afterNum)),
        ];
    }
}
class FSDate {
    constructor() {
        this.type = 'single';
        this.singleUnit = 'day';
        this.singleDefaultType = 'current';
        this.singleDefaultSpecified = new Date();
        this.rangeDefault = new FSRangeDefault();
        this.lastTimeItems = [];
        this.lastTimeDisplayType = 'flat';
    }
}
class FSEnum {
    constructor() {
        this.multi = false;
        /**
         * æš‚æ—¶å®šä¸ºï¼Œä»…æœ‰ single æ—¶å¯ä»¥é€‰æ‹© flat
         */
        this.displayType = 'select';
        this.source = 'manual';
        /**
         * æ˜¯å¦å¯æ¸…ç©ºä¸é€‰ã€‚ä»…æœ‰ select ä¸” single æ‰æœ‰æ­¤é€‰é¡¹
         */
        this.allowEmpty = false;
        /**
         * é€šè¿‡ä¸Šé¢ä¸¤ä¸ªå­—æ®µå–å‡º items å­˜åœ¨ä¸‹é¢
         */
        this.itemsFromData = [];
        this.itemsManual = [];
        this.multiDefault = [];
    }
    // æš‚æ—¶ä¸åš
    // sourceDatasetId: string
    // sourceDatasetLabelField?: DataField
    // sourceDatasetValueField?: DataField
    /**
     * @param {?} fsEnum
     * @return {?}
     */
    static GetItems(fsEnum) {
        const { source, itemsFromData, itemsManual } = fsEnum;
        if (source === 'dataField') {
            // if (!itemsValueField || !intactData) return []
            // const tempItems = intactData.map(dataItem => ({
            //   label: dataItem[itemsLabelField || itemsValueField],
            //   value: dataItem[itemsValueField]
            // }))
            // return ArrUtil.Unique(tempItems)
            return itemsFromData;
        }
        else if (source === 'manual') {
            return itemsManual;
        }
    }
    /**
     * @param {?} fsEnum
     * @return {?}
     */
    static GetItemValues(fsEnum) {
        /**
         * @param {?} item
         * @return {?}
         */
        function mapCb(item) { return item.value; }
        return FSEnum.GetItems(fsEnum).map(mapCb);
    }
}
class FSEnumItem {
}
class FilterSchema {
    constructor() {
        /**
         * è¿‡æ»¤åç§°ï¼Œåœ¨ç­›é€‰æ§ä»¶ä¸Šæ˜¾ç¤ºï¼Œå¯é€‰
         */
        this.i18nName = {};
        this.showName = false;
        /**
         * è¿‡æ»¤å¤§ç±»
         */
        this.type = 'date';
        /**
         * æ¯ç§ç±»å‹çš„è¿‡æ»¤é…ç½®
         */
        this.date = new FSDate();
        this.enum = new FSEnum();
        this.number = {
            default: 0
        };
        this.text = {
            default: ''
        };
    }
    /**
     * è·å– FS çš„é»˜è®¤å€¼
     * ğŸ™… ä¸å¯ä»¥ä¾èµ– dataï¼šéƒ¨ä»¶ç¬¬ä¸€æ¬¡æ ¹æ®é»˜è®¤å€¼ç­›é€‰æ—¶ï¼Œè¿˜æ²¡æœ‰ data å‘¢ã€‚
     * @param {?} fs
     * @return {?}
     */
    static getDefaultValue(fs) {
        switch (fs.type) {
            case 'date':
                if (fs.date.type === 'single') {
                    if (fs.date.singleDefaultType === 'current') {
                        return new Date();
                    }
                    else {
                        return fs.date.singleDefaultSpecified;
                    }
                }
                else if (fs.date.type === 'range') {
                    return FSRangeDefault.GetDates(fs.date.rangeDefault);
                }
                else if (fs.date.type === 'lastTimeEnum') {
                    return FSLastTimeItem.GetDates(fs.date.lastTimeItems[0]);
                }
                break;
            case 'enum':
                const { multi, singleDefault, multiDefault } = fs.enum;
                return multi ? multiDefault : singleDefault;
            case 'number':
                return fs.number.default;
                break;
            case 'text':
                return fs.text.default;
                break;
        }
    }
}
/**
 * @param {?} fs
 * @return {?}
 */
function ifFsDateRange(fs) {
    if (!fs)
        return;
    return fs.type === 'date' && fs.date.type === 'range';
}
/**
 * @param {?} fs
 * @return {?}
 */
function isFsFlat(fs) {
    if (!fs)
        return;
    return fs.type === 'date' && fs.date.type === 'lastTimeEnum' && fs.date.lastTimeDisplayType === 'flat'
        || fs.type === 'enum' && !fs.enum.multi && fs.enum.displayType === 'flat';
}
/**
 * å®˜æ–¹é¢„åˆ¶çš„ç­›é€‰ property
 * @type {?}
 */
const FILTER_PROP_NAME = 'filter';
/** @type {?} */
const frontendFilterProp = {
    name: FILTER_PROP_NAME,
    displayName: 'ç­›é€‰',
    isArray: true,
    type: PropertyTypes.Object,
    objectOption: {
        objPropertyOptions: [{
                name: 'fs',
                type: PropertyTypes.Filter,
            }, {
                name: 'dpId',
                type: PropertyTypes.DataParam,
            }, {
                name: 'dpId2',
                type: PropertyTypes.DataParam,
                ifShow: (/**
                 * @param {?} pv
                 * @return {?}
                 */
                pv => {
                    return pv.fs && ifFsDateRange(pv.fs);
                })
            }]
    }
};

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/** @enum {string} */
const JumpTypes = {
    None: '0',
    Func: '1',
    ChartTable: '2',
    NewBrowserTab: '3',
};
/**
 * é€‰æ‹©è”æŸ¥ç±»å‹
 * @type {?}
 */
const jumpTypeOption = {
    type: PropertyTypes.Enum,
    enumOption: {
        default: JumpTypes.None,
        items: [
            { value: JumpTypes.None, displayName: 'none' },
            { value: JumpTypes.Func, displayName: 'toFuncOrInvoke' },
            // { value: JumpTypes.ChartTable, displayName: 'è·³è½¬è‡³é¢„åˆ¶å›¾è¡¨é¡µ' },
            { value: JumpTypes.NewBrowserTab, displayName: 'browserNewTab' }
        ]
    }
}
// let allFuncs
/** èœå•/è”æŸ¥å¸®åŠ© option */
;
// let allFuncs
/**
 * èœå•/è”æŸ¥å¸®åŠ© option
 * @type {?}
 */
const funcOption = {
    type: PropertyTypes.Help,
    tip: 'é€‰èœå•/è”æŸ¥çš„å¸®åŠ©',
    helpOption: {
        getData: (/**
         * @param {?} httpClient
         * @return {?}
         */
        (httpClient) => {
            return httpClient
                .get('/api/runtime/sys/v1.0/functions/allFuncs')
                .pipe(map((/**
             * @param {?} funcs
             * @return {?}
             */
            funcs => {
                // allFuncs = funcs
                return list2Tree(funcs, {
                    rootParentIdValue: '0',
                    /**
                     * @param {?} item
                     * @return {?}
                     */
                    beforeProcess(item) {
                        if (item.layer === '3') {
                            item.isLeaf = true;
                            item.isTableParent = true;
                        }
                    }
                });
            })));
        }),
        structure: HelpStructure.treeTable,
        tableFields: ['code', 'name'],
        valueField: 'id',
        nameField: 'name'
    }
}
/** ä¸å–å†³äºæŸæ¡æ•°æ®å€¼çš„è”æŸ¥ */
;
/**
 * ä¸å–å†³äºæŸæ¡æ•°æ®å€¼çš„è”æŸ¥
 * @type {?}
 */
const dataJumpOption = {
    category: 'clickJump',
    type: PropertyTypes.Object,
    objectOption: {
        objPropertyOptions: [
            Object.assign({ name: 'jumpType', displayName: 'jumpType' }, jumpTypeOption),
            /** èœå•/è”æŸ¥ */
            {
                name: 'funcIdSource',
                type: PropertyTypes.Enum,
                enumOption: {
                    items: ['fixed', 'fromData']
                },
                /**
                 * @param {?} c
                 * @return {?}
                 */
                ifShow(c) { return c.jumpType === JumpTypes.Func; }
            }, {
                name: 'funcIdDataField',
                type: PropertyTypes.DataField,
                /**
                 * @param {?} c
                 * @return {?}
                 */
                ifShow(c) {
                    return c.jumpType === JumpTypes.Func && c.funcIdSource === 'fromData';
                }
            },
            Object.assign({ name: 'funcId', displayName: 'func/invoke', /**
                 * @param {?} c
                 * @return {?}
                 */
                ifShow(c) {
                    return c.jumpType === JumpTypes.Func && c.funcIdSource === 'fixed';
                } }, funcOption),
            {
                name: 'funcParams',
                displayName: 'routeParams',
                type: PropertyTypes.Object,
                isArray: true,
                objectOption: {
                    objPropertyOptions: [{
                            name: 'key',
                            displayName: 'paramKey',
                            textOption: { i18n: false },
                            type: PropertyTypes.Text,
                        }, {
                            name: 'valueType',
                            displayName: 'valueType',
                            type: PropertyTypes.Enum,
                            enumOption: {
                                items: [
                                    { value: 'fieldName', displayName: 'dataFieldValue' },
                                    { value: 'fixedValue', displayName: 'fixedValue' }
                                ]
                            }
                        }, {
                            name: 'fixedValue',
                            displayName: 'paramFixedValue',
                            type: PropertyTypes.Text,
                            textOption: { i18n: false },
                            /**
                             * @param {?} funcParam
                             * @return {?}
                             */
                            ifShow(funcParam) { return funcParam.valueType === 'fixedValue'; }
                        }, {
                            name: 'fieldName',
                            displayName: 'paramValueField',
                            type: PropertyTypes.DataField,
                            /**
                             * @param {?} funcParam
                             * @return {?}
                             */
                            ifShow(funcParam) { return funcParam.valueType === 'fieldName'; }
                        }]
                },
                /**
                 * @param {?} values
                 * @return {?}
                 */
                ifShow(values) { return values.jumpType === JumpTypes.Func; }
            },
            /** æµè§ˆå™¨æ ‡ç­¾ */
            {
                name: 'url',
                displayName: 'newTabUrl',
                type: PropertyTypes.Text,
                textOption: { i18n: false },
                /**
                 * @param {?} values
                 * @return {?}
                 */
                ifShow(values) { return values.jumpType === JumpTypes.NewBrowserTab; }
            }, {
                name: 'urlParams',
                displayName: 'urlParams',
                type: PropertyTypes.Object,
                isArray: true,
                objectOption: {
                    objPropertyOptions: [{
                            name: 'valueType',
                            displayName: 'valueType',
                            type: PropertyTypes.Enum,
                            enumOption: {
                                items: [
                                    { value: 'fieldName', displayName: 'dataFieldValue' },
                                    { value: 'fixedValue', displayName: 'fixedValue' }
                                ]
                            }
                        }, {
                            name: 'fixedValue',
                            displayName: 'paramFixedValue',
                            type: PropertyTypes.Text,
                            textOption: { i18n: false },
                            /**
                             * @param {?} urlParam
                             * @return {?}
                             */
                            ifShow(urlParam) { return urlParam.valueType === 'fixedValue'; }
                        }, {
                            name: 'fieldName',
                            displayName: 'paramValueField',
                            type: PropertyTypes.DataField,
                            /**
                             * @param {?} urlParam
                             * @return {?}
                             */
                            ifShow(urlParam) { return urlParam.valueType === 'fieldName'; }
                        }]
                },
                /**
                 * @param {?} values
                 * @return {?}
                 */
                ifShow(values) { return values.jumpType === JumpTypes.NewBrowserTab; }
            }, {
                name: 'queryParams',
                displayName: 'urlQueryParams',
                type: PropertyTypes.Object,
                isArray: true,
                objectOption: {
                    objPropertyOptions: [{
                            name: 'key',
                            displayName: 'paramKey',
                            type: PropertyTypes.Text,
                            textOption: { i18n: false },
                        }, {
                            name: 'valueType',
                            displayName: 'valueType',
                            type: PropertyTypes.Enum,
                            enumOption: {
                                items: [
                                    { value: 'fieldName', displayName: 'dataFieldValue' },
                                    { value: 'fixedValue', displayName: 'fixedValue' }
                                ]
                            }
                        }, {
                            name: 'fixedValue',
                            displayName: 'paramFixedValue',
                            type: PropertyTypes.Text,
                            textOption: { i18n: false },
                            /**
                             * @param {?} funcParam
                             * @return {?}
                             */
                            ifShow(funcParam) { return funcParam.valueType === 'fixedValue'; }
                        }, {
                            name: 'fieldName',
                            displayName: 'paramValueField',
                            type: PropertyTypes.DataField,
                            /**
                             * @param {?} funcParam
                             * @return {?}
                             */
                            ifShow(funcParam) { return funcParam.valueType === 'fieldName'; }
                        }]
                },
                /**
                 * @param {?} values
                 * @return {?}
                 */
                ifShow(values) { return values.jumpType === JumpTypes.NewBrowserTab; }
            }
        ]
    }
}
/** å†³äºæŸæ¡æ•°æ®å€¼çš„è”æŸ¥ */
;
/**
 * å†³äºæŸæ¡æ•°æ®å€¼çš„è”æŸ¥
 * @type {?}
 */
const datalessJumpOption = {
    category: 'clickJump',
    type: PropertyTypes.Object,
    objectOption: {
        objPropertyOptions: [
            Object.assign({ name: 'jumpType', displayName: 'jumpType' }, jumpTypeOption),
            Object.assign({ name: 'funcId', displayName: 'func/invoke', /**
                 * @param {?} values
                 * @return {?}
                 */
                ifShow(values) { return values.jumpType === JumpTypes.Func; } }, funcOption),
            {
                name: 'funcParams',
                displayName: 'routeParams',
                type: PropertyTypes.Object,
                isArray: true,
                objectOption: {
                    objPropertyOptions: [{
                            name: 'key',
                            displayName: 'paramKey',
                            type: PropertyTypes.Text,
                            textOption: { i18n: false },
                        }, {
                            name: 'value',
                            displayName: 'paramValue',
                            type: PropertyTypes.Text,
                            textOption: { i18n: false },
                        }]
                },
                /**
                 * @param {?} values
                 * @return {?}
                 */
                ifShow(values) { return values.jumpType === JumpTypes.Func; }
            },
            /** æµè§ˆå™¨æ ‡ç­¾ */
            {
                name: 'url',
                displayName: 'newTabUrl',
                type: PropertyTypes.Text,
                textOption: { i18n: false },
                /**
                 * @param {?} values
                 * @return {?}
                 */
                ifShow(values) { return values.jumpType === JumpTypes.NewBrowserTab; }
            }
        ]
    }
}
/** @deprecated è¯·ç”¨ datalessJump æˆ– dataJump */
;
/**
 * @deprecated è¯·ç”¨ datalessJump æˆ– dataJump
 * @type {?}
 */
const CommonPropertyOptions = {
    jump: datalessJumpOption
};

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/**
 * å…ƒéƒ¨ä»¶å±æ€§æ³¨å†Œè¡¨ï¼Œå½¢å¦‚
 * { constructorName: { propertyName: propertyOption }
 * @type {?}
 */
const WidgetPropertyMap = new Map()
/**
 * TODO: åŠ å…¥æ£€æŸ¥ï¼Œç¼–è¯‘æ—¶æŠ¥é”™ï¼ˆnameä¸åº”è¯¥å†™ï¼›ï¼‰
 * @param option å¯é€‰ï¼Œé»˜è®¤ä¸º { type: PropertyTypes.String }
 */
;
/**
 * TODO: åŠ å…¥æ£€æŸ¥ï¼Œç¼–è¯‘æ—¶æŠ¥é”™ï¼ˆnameä¸åº”è¯¥å†™ï¼›ï¼‰
 * @param {?=} option å¯é€‰ï¼Œé»˜è®¤ä¸º { type: PropertyTypes.String }
 * @return {?}
 */
function Property(option = {}) {
    // è¿™é‡Œç»Ÿä¸€å¤„ç†ï¼šæ²¡æœ‰è®¾ç½® type çš„ä¸€å¾‹è®¾ç½®ä¸º Textã€‚æ²¡ç”¨é€’å½’ï¼Œä»…å¤šè€ƒè™‘äº† Obj å†…ä¸€å±‚ã€‚
    option.type = option.type || PropertyTypes.Text;
    if (option.objectOption && option.objectOption.objPropertyOptions) {
        option.objectOption.objPropertyOptions.forEach((/**
         * @param {?} subOption
         * @return {?}
         */
        subOption => {
            subOption.type = subOption.type || PropertyTypes.Text;
        }));
    }
    option.isArray = !!option.isArray;
    return (/**
     * @param {?} widgetPrototype
     * @param {?} propName
     * @return {?}
     */
    (widgetPrototype, propName) => {
        // TODO: æƒ³åŠæ³•æŠŠ su åŠ è¿›æ‰€æœ‰è¿è¡Œæ—¶æ³¨å†Œè¡¨é‡Œçš„ keys é‡Œ
        /** @type {?} */
        const ctorName = widgetPrototype.constructor.name;
        if (!WidgetPropertyMap.get(ctorName))
            WidgetPropertyMap.set(ctorName, []);
        WidgetPropertyMap.get(ctorName).push(Object.assign({ name: propName }, option));
        // è°ƒ angular Input decorator
        Input()(widgetPrototype, propName);
    });
}

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/**
 * @abstract
 */
class WidgetBase {
    /**
     * å› ä¸ºæ˜¯çˆ¶ç±»æ„é€ å‡½æ•°æ‰€ä»¥æ— æ³•ä¾èµ–æ³¨å…¥, ä¹Ÿæ²¡æ³•ä¼ å…¥å‚æ•°;
     * compInstance.field = xxx çš„æ–¹å¼åˆå‘ç”Ÿåœ¨æ„é€ å‡½æ•°åè€Œä¸å¤ªå¥½,
     * æ‰€ä»¥è€ƒè™‘æ­¤çˆ¶ç±»ä¸æä¾›æˆå‘˜å±æ€§, è€Œé€šè¿‡ä¾èµ–æ³¨å…¥, åœ¨å­ç»„ä»¶è‡ªå–.
     */
    constructor() {
        this.title = 'untitled';
        /**
         * @deprecated æ˜¯å¦ä½¿ç”¨å¤–éƒ¨æ•°æ®æºã€‚æ˜¯çš„è¯ï¼Œwc å°±æ‹¿å®ƒçš„ portlet id è¯·æ±‚æ•°æ®å»ã€‚åº”æ”¹ä¸º dataEngine å†™æ³•ã€‚
         */
        this.useDataEngine = false;
        if (this.widgetName == null)
            console.error(`å…ƒéƒ¨ä»¶ ${this.constructor.name} æœªæ·»åŠ  @Widget({ name: <name>})`);
    }
    /**
     * å…ƒéƒ¨ä»¶å®¹å™¨å¤§å°å˜åŒ–äº‹ä»¶ï¼Œå‚æ•° width ä¸ºå®¹å™¨å®½åº¦ï¼Œå•ä½ pxã€‚
     * å¯é‡å†™æ­¤æ–¹æ³•ä»¥å¤„ç†å¤æ‚çš„å“åº”å¼æ ·å¼ã€‚
     * @param {?} width
     * @param {?} height
     * @return {?}
     */
    onResized(width, height) { }
    /**
     * @param {?} propName
     * @param {?} value
     * @return {?}
     */
    onPropertyChange(propName, value) { }
    /**
     * @deprecated
     * è¯·ç”¨ this.dataService.loadData() ä»£æ›¿
     * @param {?} data è·å¾—çš„æ•°æ®
     * @return {?}
     */
    onGetData(data) { }
}
__decorate([
    Property({
        category: 'å…¬å…±å±æ€§',
        displayName: 'éƒ¨ä»¶æ ‡é¢˜'
    }),
    __metadata("design:type", Object)
], WidgetBase.prototype, "title", void 0);

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/** @type {?} */
const PropertyTypeDefaultValues = {
    [PropertyTypes.Text]: '',
    [PropertyTypes.Bool]: false,
    [PropertyTypes.Number]: 0,
    [PropertyTypes.DataField]: {}
    // [PropertyTypes.Color]: '#000000',
    // [PropertyTypes.Enum]: 0,
    // [PropertyTypes.Date]: new Date()
    // [PropertyTypes.Object]: {},
}
// const frontendFilterProp: PropertyOption = {
//   name: 'filter',
//   displayName: 'ç­›é€‰',
//   isArray: true,
//   type: PropertyTypes.Filter,
// }
// TODO: filters
;
// const frontendFilterProp: PropertyOption = {
//   name: 'filter',
//   displayName: 'ç­›é€‰',
//   isArray: true,
//   type: PropertyTypes.Filter,
// }
// TODO: filters
/** @type {?} */
const titleBarProps = [{
        category: 'titleBar',
        name: 'titleBarHide',
        type: PropertyTypes.Bool,
        boolOption: {
            default: false
        }
    }, {
        category: 'titleBar',
        name: 'titleBarShowRefresh',
        displayName: 'showRefreshBtn',
        type: PropertyTypes.Bool,
        boolOption: {
            default: true
        }
    }, Object.assign({}, datalessJumpOption, { category: 'titleBar', name: 'titleBarJump' })];
class WidgetPropertyService {
    constructor() { }
    /**
     * è·å¾—æŸç§ç±»å‹çš„å…¨å±€é»˜è®¤å€¼ï¼Œåœ¨å®Œå…¨æ²¡æœ‰å€¼æ—¶ä½¿ç”¨
     * @param {?} prop
     * @param {?=} arrayItem æ˜¯å¦æ˜¯æ¥è·å– array çš„å­é¡¹é»˜è®¤å€¼çš„ï¼Œé»˜è®¤ä¸æ˜¯ã€‚
     * å¦‚æœä¸æ˜¯ï¼Œè‹¥ prop.isArray ä¸ºçœŸï¼Œå°±è¿”å›ç©ºæ•°ç»„ []ï¼›
     * å¦‚æœæ˜¯ï¼Œåˆ™ä¸ç®¡ prop.isArray æ˜¯å¦ä¸ºçœŸï¼Œæ€»è¿”å› prop.type å¯¹åº”çš„é»˜è®¤å€¼ï¼Œä»…åº”ç”¨äºå¢åŠ æ•°ç»„é¡¹æ—¶è·å–æ–°é¡¹ã€‚
     * @return {?}
     */
    getPropertyDefaultValue(prop, arrayItem = false) {
        if (!arrayItem && prop.isArray)
            return [];
        // object: é€’å½’ç”Ÿæˆå…·æœ‰æ‰€æœ‰ key çš„å¯¹è±¡ï¼Œæ¯ä¸ª key çš„ value æ˜¯é»˜è®¤å€¼
        if (prop.type === PropertyTypes.Object) {
            /** @type {?} */
            const newObj = {};
            prop.objectOption.objPropertyOptions.forEach((/**
             * @param {?} childProp
             * @return {?}
             */
            (childProp) => {
                newObj[childProp.name] = (childProp[childProp.type]
                    && childProp[childProp.type].default)
                    || this.getPropertyDefaultValue(childProp);
            }));
            return newObj;
        }
        else if (prop.type === PropertyTypes.Enum) {
            /** @type {?} */
            const firstItem = prop.enumOption.items[0];
            return typeof firstItem === 'string'
                ? firstItem
                : firstItem['value'];
        }
        else if (prop.type === PropertyTypes.Color) {
            /** @type {?} */
            const colors = this.getColorsByColorOption(prop.colorOption);
            /** @type {?} */
            const i = Math.random();
            return colors[Math.floor(i * colors.length)];
        }
        else if (prop.type === PropertyTypes.Filter) {
            return new FilterSchema();
        }
        else {
            return PropertyTypeDefaultValues[prop.type];
        }
    }
    /**
     * å…ƒéƒ¨ä»¶åŠ è½½ã€ç¼–è¯‘å®Œæˆåï¼Œç»„è£…æ–°çš„ properties
     * widget name
     * -> constructor name
     * -> widget + title bar + base properties
     * -> å…ƒéƒ¨ä»¶çš„æ‰€æœ‰å¯é…ç½® properties
     * @param {?} widgetName
     * @param {?} widgetConfig
     * @return {?}
     */
    getWidgetProps(widgetName, widgetConfig) {
        /** @type {?} */
        const ctorName = WidgetRegistry.getWidgetByName(widgetName).ctor.name
        // widget å­ç±»ä¸­çš„ property
        ;
        // widget å­ç±»ä¸­çš„ property
        /** @type {?} */
        const widgetProps = WidgetPropertyMap.get(ctorName) || []
        // ç­›é€‰å‡º widget å­ç±»ä¸­æ²¡é‡å†™è¿‡çš„ propertyï¼Œå¦åˆ™å¯èƒ½ä¼šæœ‰ä¿©ä¸€æ ·çš„
        ;
        // ç­›é€‰å‡º widget å­ç±»ä¸­æ²¡é‡å†™è¿‡çš„ propertyï¼Œå¦åˆ™å¯èƒ½ä¼šæœ‰ä¿©ä¸€æ ·çš„
        /** @type {?} */
        const baseProps = WidgetPropertyMap.get(WidgetBase.name)
            .filter((/**
         * @param {?} baseProp
         * @return {?}
         */
        baseProp => !widgetProps.some((/**
         * @param {?} prop
         * @return {?}
         */
        prop => baseProp.name === prop.name))))
        // ç»„è£…
        ;
        // ç»„è£…
        return [
            // å…¬å…±é…ç½®éƒ½æ”¾è¿™
            ...baseProps,
            // æ ‡é¢˜é…ç½®
            ...(widgetConfig.enableCommonTitleBar
                ? titleBarProps
                : []),
            // ç­›é€‰é…ç½®
            ...(widgetConfig.enableDataConfig && widgetConfig.enableCommonTitleBar
                ? [frontendFilterProp]
                : []),
            // å…ƒéƒ¨ä»¶è‡ªèº«é…ç½®
            ...widgetProps
            // ...testProps,
        ];
    }
    /**
     * mixin å·²æœ‰pv + å…ƒéƒ¨ä»¶æ¨èçš„é»˜è®¤pv + æ­¤ç±»å‹çš„å…¨å±€é»˜è®¤pv
     * @param {?} props
     * @param {?} propValues
     * @return {?}
     */
    mixinWidgetPropValues(props, propValues) {
        /** @type {?} */
        const mixinedPropValues = Object.assign({}, propValues)
        // æ£€æŸ¥æ‰€æœ‰ propertiesï¼Œå“ªä¸ªæ²¡æœ‰å€¼ï¼Œå°±èµ‹ä¸Šé»˜è®¤æ¨èå€¼
        ;
        // æ£€æŸ¥æ‰€æœ‰ propertiesï¼Œå“ªä¸ªæ²¡æœ‰å€¼ï¼Œå°±èµ‹ä¸Šé»˜è®¤æ¨èå€¼
        props.forEach((/**
         * @param {?} prop
         * @return {?}
         */
        prop => {
            // è¿™é‡Œå¿…é¡»æ˜¯åˆ¤æ–­ undefinedï¼Œå¦åˆ™ bool ç±»å‹çš„ false ä¹Ÿå¯èƒ½åˆ¤å®šä¸ºæ— å€¼
            if (mixinedPropValues[prop.name] === undefined) {
                mixinedPropValues[prop.name] = prop[prop.type] && prop[prop.type].default
                    // å¦‚æœå…ƒéƒ¨ä»¶æ— é»˜è®¤å€¼ï¼Œå°±åŠ å…¥å…¨å±€çš„å½“å‰ç±»å‹é»˜è®¤å€¼
                    || this.getPropertyDefaultValue(prop);
            }
        }));
        return mixinedPropValues;
    }
    /**
     * @param {?} colorOption
     * @return {?}
     */
    getColorsByColorOption(colorOption) {
        if (colorOption && colorOption.palette)
            return colorOption.palette;
        /** @type {?} */
        const colorType = colorOption ? colorOption.type : 'pure';
        /** @type {?} */
        let colors;
        switch (colorType) {
            case 'gradient':
                colors = PlThemeColors.gradient;
                break;
            case 'pureOrGradient':
                colors = [...PlThemeColors.pure, ...PlThemeColors.gradient];
                break;
            case 'pure':
            default:
                colors = PlThemeColors.pure;
                break;
        }
        return colors;
    }
}
WidgetPropertyService.decorators = [
    { type: Injectable, args: [{
                providedIn: 'root'
            },] }
];
/** @nocollapse */
WidgetPropertyService.ctorParameters = () => [];
/** @nocollapse */ WidgetPropertyService.ngInjectableDef = defineInjectable({ factory: function WidgetPropertyService_Factory() { return new WidgetPropertyService(); }, token: WidgetPropertyService, providedIn: "root" });

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
// TODO: å·¦å›¾å³è¡¨é¡µé¢ã€funcId
/** @type {?} */
const CHART_TABLE_FUNC_ID = '???';

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/**
 * @deprecated
 * ä¸ºäº† widget-devkit çš„å…¼å®¹è€Œæš‚æ—¶ä¿ç•™ã€‚ä¸å‡†å†ç”¨äº†ã€‚
 * å…ƒéƒ¨ä»¶åº”è¯¥ç›´æ¥ç”¨ \@gspwidget/utilã€‚
 * @type {?}
 */
const DASHBOARD_API = 'DashboardApi';
class WidgetDevkitService {
    /**
     * @param {?} modalService
     */
    constructor(modalService) {
        this.modalService = modalService;
    }
    /**
     * @param {?} content
     * @param {?=} config
     * @return {?}
     */
    openModal(content, config) {
        return this.modalService.show(content, config);
    }
    /**
     * @param {?} funcId
     * @param {?=} queryParamsArray
     * @return {?}
     */
    openMenu(funcId, queryParamsArray) {
        window[DASHBOARD_API].openMenu(funcId, queryParamsArray);
    }
    /**
     * @param {?} appId
     * @return {?}
     */
    openApp(appId) {
        window[DASHBOARD_API].openApp(appId);
    }
    /**
     * options å‚è€ƒ https://ng.ant.design/components/message/zh
     * @param {?} content
     * @param {?=} options
     * @return {?}
     */
    openInfoMsg(content, options) {
        window[DASHBOARD_API].messageSvc.info(content, options);
    }
    /**
     * options å‚è€ƒ https://ng.ant.design/components/message/zh
     * @param {?} content
     * @param {?=} options
     * @return {?}
     */
    openSuccessMsg(content, options) {
        window[DASHBOARD_API].messageSvc.success(content, options);
    }
    /**
     * options å‚è€ƒ https://ng.ant.design/components/message/zh
     * @param {?} content
     * @param {?=} options
     * @return {?}
     */
    openWarningMsg(content, options) {
        window[DASHBOARD_API].messageSvc.warning(content, options);
    }
    /**
     * options å‚è€ƒ https://ng.ant.design/components/message/zh
     * @param {?} content
     * @param {?=} options
     * @return {?}
     */
    openErrorMsg(content, options) {
        window[DASHBOARD_API].messageSvc.error(content, options);
    }
    /**
     * @param {?} dataOption
     * @return {?}
     */
    getData(dataOption) {
        return window[DASHBOARD_API].storageSvc.getData(dataOption);
    }
    /**
     * @param {?=} reload
     * @return {?}
     */
    getUserInfo(reload = false) {
        return window[DASHBOARD_API].storageSvc.getUserInfo(reload);
    }
    /**
     * @param {?=} reload
     * @return {?}
     */
    getUserAvatar(reload = false) {
        return window[DASHBOARD_API].storageSvc.getUserAvatar(reload);
    }
    /**
     * @deprecated åº”ç”¨å¦å¤–ä¸¤ä¸ª jump æ–¹æ³•
     * è”æŸ¥è·³è½¬ï¼Œç›´æ¥æŠŠé…ç½®å±æ€§çš„å€¼ä¼ è¿›æ¥å°±è¡Œã€‚é…æˆâ€œæ— â€å°±ä¸è·³è½¬ã€‚
     * @param {?} jumpProperty è·³è½¬çš„é…ç½®å±æ€§çš„å€¼
     * @param {?=} dataItem å½“å‰è·³è½¬å¯¹åº”çš„æ•°æ®è¡Œã€‚å¦‚æœæ˜¯å…¨å±€è·³è½¬ï¼Œå°±ä¼ å…¥ç¬¬ä¸€è¡Œï¼Ÿ
     * @return {?}
     */
    jump(jumpProperty, dataItem) {
        const { type, funcId, params } = jumpProperty;
        /** @type {?} */
        const queryParamsArray = Array.isArray(params)
            ? params.map((/**
             * @param {?} param
             * @return {?}
             */
            param => [param.key, (param.valueType === 'fixedValue'
                    ? param.fixedValue
                    : (dataItem
                        ? dataItem[param.fieldName.name]
                        : undefined))]))
            : undefined;
        switch (type) {
            case JumpTypes.None:
                return;
            case JumpTypes.Func:
                this.openMenu(funcId, queryParamsArray);
                break;
            case JumpTypes.ChartTable:
                this.openMenu(CHART_TABLE_FUNC_ID, queryParamsArray);
                break;
        }
    }
    /**
     * @param {?} dataJumpConfig
     * @param {?} dataItem
     * @return {?}
     */
    jumpWithData(dataJumpConfig, dataItem) {
        const { jumpType, funcIdSource, funcIdDataField, funcId, funcParams, url, urlParams, queryParams } = dataJumpConfig;
        /** @type {?} */
        const funcParamsArray = Array.isArray(funcParams)
            ? funcParams.map((/**
             * @param {?} funcParam
             * @return {?}
             */
            funcParam => [funcParam.key, (funcParam.valueType === 'fixedValue'
                    ? funcParam.fixedValue
                    : (dataItem
                        ? dataItem[funcParam.fieldName.name]
                        : undefined))]))
            : undefined;
        switch (jumpType) {
            case JumpTypes.None:
                return;
            case JumpTypes.Func:
                /** @type {?} */
                const resultFuncId = (!funcIdSource || funcIdSource === 'fixed')
                    ? funcId
                    : dataItem[funcIdDataField.name];
                if (resultFuncId)
                    this.openMenu(resultFuncId, funcParamsArray);
                break;
            case JumpTypes.ChartTable:
                this.openMenu(CHART_TABLE_FUNC_ID, funcParamsArray);
                break;
            case JumpTypes.NewBrowserTab:
                // æ‹¼ url
                /** @type {?} */
                let finalUrl = url
                // + urlParams
                ;
                // + urlParams
                if (urlParams && urlParams.length > 0) {
                    /** @type {?} */
                    const urlParamPart = urlParams.map((/**
                     * @param {?} urlParam
                     * @return {?}
                     */
                    urlParam => {
                        const { valueType, fixedValue, fieldName } = urlParam;
                        return valueType === 'fixedValue' ? fixedValue : dataItem[fieldName.name];
                    })).join('/');
                    finalUrl += url.endsWith('/') ? '' : '/';
                    finalUrl += urlParamPart;
                }
                // + queryParams
                if (queryParams && queryParams.length > 0) {
                    /** @type {?} */
                    const queryParamPart = queryParams.map((/**
                     * @param {?} queryParam
                     * @return {?}
                     */
                    queryParam => {
                        const { key, valueType, fixedValue, fieldName } = queryParam;
                        return `${key}=${valueType === 'fixedValue' ? fixedValue : dataItem[fieldName.name]}`;
                    })).join('&');
                    finalUrl += '?' + queryParamPart;
                }
                // æ‰“å¼€
                window.open(finalUrl, '_blank');
        }
    }
    /**
     * @param {?} datalessJumpConfig
     * @return {?}
     */
    jumpWithoutData(datalessJumpConfig) {
        const { jumpType, funcId, funcParams, url } = datalessJumpConfig;
        /** @type {?} */
        const funcParamsArray = Array.isArray(funcParams)
            ? funcParams.map((/**
             * @param {?} funcParam
             * @return {?}
             */
            funcParam => [funcParam.key, funcParam.value]))
            : undefined;
        switch (jumpType) {
            case JumpTypes.None:
                return;
            case JumpTypes.Func:
                this.openMenu(funcId, funcParamsArray);
                break;
            case JumpTypes.ChartTable:
                this.openMenu(CHART_TABLE_FUNC_ID, funcParamsArray);
                break;
            case JumpTypes.NewBrowserTab:
                window.open(url, '_blank');
        }
    }
}
WidgetDevkitService.decorators = [
    { type: Injectable }
];
/** @nocollapse */
WidgetDevkitService.ctorParameters = () => [
    { type: BsModalService }
];

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
class WidgetTitleBarComponent {
    /**
     * @param {?} devkitSvc
     */
    constructor(devkitSvc) {
        this.devkitSvc = devkitSvc;
        this.icon = '';
        /**
         * æ ‡é¢˜
         */
        this.showTitle = true;
        this.title = '';
        /**
         * æ•°å­—
         */
        this.showNumber = false;
        this.number = 0;
        /**
         * è®¾ç½®æŒ‰é’®
         */
        this.showSetting = false;
        this.clickSetting = new EventEmitter();
        /**
         * åˆ·æ–°æŒ‰é’®
         */
        this.showRefresh = false;
        this.clickRefresh = new EventEmitter();
        this.JumpTypes = JumpTypes;
    }
    /**
     * @return {?}
     */
    ngOnInit() { }
    /**
     * @return {?}
     */
    handleClickJump() {
        this.devkitSvc.jumpWithoutData(this.jumpConfig);
    }
}
WidgetTitleBarComponent.decorators = [
    { type: Component, args: [{
                selector: 'lib-widget-title-bar',
                template: "\n<div class=\"widget-title-bar d-flex\">\n  <!-- left -->\n  <div class=\"left align-items-center\">\n    <i *ngIf=\"icon!=''\" class=\"material-icons\">{{icon}}</i>\n    <div *ngIf=\"showTitle\" class=\"title\">{{title}}</div>\n    <div *ngIf=\"showNumber\" class=\"number\">{{number}}</div>\n    <ng-container *ngTemplateOutlet=\"leftTemplate\"></ng-container>\n  </div>\n  <!-- right -->\n  <div class=\"right\">\n    <ng-container *ngTemplateOutlet=\"rightTemplate\"></ng-container>\n    <div class=\"tool-wrap d-flex\" [title]=\"(settingTitle || '') | translate\">\n      <img\n        class=\"setting\"\n        *ngIf=\"showSetting\"\n        (click)=\"clickSetting.emit()\"\n        src=\"assets/img/setting.svg\"\n        [alt]=\"settingTitle\">\n    </div>\n    <div\n      class=\"tool-wrap d-flex\"\n      *ngIf=\"showRefresh\"\n      (click)=\"clickRefresh.emit()\">\n      <i class=\"icon-refresh material-icons\" style=\"font-size: 20px;\">refresh</i>\n    </div>\n    <div\n      *ngIf=\"jumpConfig && jumpConfig.jumpType!==JumpTypes.None\"\n      (click)=\"handleClickJump()\"\n      class=\"tool-wrap d-flex\">\n      <i class=\"material-icons\">chevron_right</i>\n    </div>\n  </div>\n</div>",
                encapsulation: ViewEncapsulation.None,
                styles: ["@charset \"UTF-8\";.widget-title-bar{display:flex;padding:12px 20px 10px}.widget-title-bar .left{flex:1 1 auto;display:flex}.widget-title-bar .left .material-icons{font-size:18px;margin-right:8px;color:#3794ff;padding-top:1px}.widget-title-bar .left .title{font-weight:700;font-size:15px}.widget-title-bar .left .number{font-size:15px;margin-left:10px}.widget-title-bar .right{flex:1 1 auto;display:flex;justify-content:flex-end;align-items:center}.widget-title-bar .right .widget-select{margin-left:5px}.widget-title-bar .right .setting{width:16px;height:16px;transition:.3s;opacity:1!important}.widget-title-bar .right .setting:hover{transform:rotate(60deg)}.widget-title-bar .right .tool-wrap{width:20px;margin-left:10px;font-size:14px;color:#000;transition:.3s;cursor:pointer;opacity:.2}.widget-title-bar .right .tool-wrap:hover{opacity:.4}"]
            }] }
];
/** @nocollapse */
WidgetTitleBarComponent.ctorParameters = () => [
    { type: WidgetDevkitService }
];
WidgetTitleBarComponent.propDecorators = {
    icon: [{ type: Input }],
    showTitle: [{ type: Input }],
    title: [{ type: Input }],
    showNumber: [{ type: Input }],
    number: [{ type: Input }],
    showSetting: [{ type: Input }],
    settingTitle: [{ type: Input }],
    clickSetting: [{ type: Output }],
    showRefresh: [{ type: Input }],
    clickRefresh: [{ type: Output }],
    jumpConfig: [{ type: Input }],
    jumpProperty: [{ type: Input }],
    data: [{ type: Input }],
    leftTemplate: [{ type: ContentChild, args: ['leftTemplate',] }],
    rightTemplate: [{ type: ContentChild, args: ['rightTemplate',] }]
};

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
class WidgetTitleBarSelectComponent {
    constructor() {
        this.filterOptions = [];
        this.onFilterChange = new EventEmitter();
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.filter = new FormControl(this.defaultFilterValue ? this.defaultFilterValue : this.filterOptions[0].value);
        this.filter.valueChanges.subscribe((/**
         * @param {?} newValue
         * @return {?}
         */
        newValue => {
            this.onFilterChange.emit(newValue);
        }));
    }
}
WidgetTitleBarSelectComponent.decorators = [
    { type: Component, args: [{
                selector: 'lib-widget-title-bar-select',
                template: "\n<select\n  [formControl]=\"filter\"\n  class=\"widget-select form-control\" >\n  <option *ngFor=\"let option of filterOptions\"\n    [value]=\"option.value\">{{option.name}}</option>\n</select>",
                styles: [".widget-select{font-size:12px;padding:0 5px;height:25px}"]
            }] }
];
/** @nocollapse */
WidgetTitleBarSelectComponent.ctorParameters = () => [];
WidgetTitleBarSelectComponent.propDecorators = {
    defaultFilterValue: [{ type: Input }],
    filterOptions: [{ type: Input }],
    onFilterChange: [{ type: Output }]
};

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
class WidgetTitleBarModule {
}
WidgetTitleBarModule.decorators = [
    { type: NgModule, args: [{
                declarations: [
                    WidgetTitleBarComponent,
                    WidgetTitleBarSelectComponent
                ],
                exports: [
                    WidgetTitleBarComponent,
                    WidgetTitleBarSelectComponent
                ],
                imports: [
                    CommonModule,
                    ReactiveFormsModule,
                    TranslateModule.forChild()
                ]
            },] }
];

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
class Gradient {
    /**
     * @param {?} colorStops
     */
    constructor(colorStops) {
        this.colorStops = colorStops || [];
    }
    /**
     * @param {?} offset
     * @param {?} color
     * @return {?}
     */
    addColorStop(offset, color) {
        this.colorStops.push({
            offset,
            color,
        });
    }
}

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/**
 * x, y, x2, y2 are all percent from 0 to 1 when globalCoord is false
 */
class LinearGradient extends Gradient {
    /**
     * @param {?} x
     * @param {?} y
     * @param {?} x2
     * @param {?} y2
     * @param {?=} colorStops
     * @param {?=} globalCoord
     */
    constructor(x, y, x2, y2, colorStops, globalCoord) {
        super(colorStops);
        // Should do nothing more in this constructor. Because gradient can be
        // declard by `color: {type: 'linear', colorStops: ...}`, where
        // this constructor will not be called.
        this.x = x == null ? 0 : x;
        this.y = y == null ? 0 : y;
        this.x2 = x2 == null ? 1 : x2;
        this.y2 = y2 == null ? 0 : y2;
        // Can be cloned
        this.type = "linear";
        // If use global coord
        this.global = globalCoord || false;
    }
}

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/** @type {?} */
const EchartsOptions = {
    grid: {
        top: 20,
        right: 30,
        bottom: 36,
        left: 10,
        containLabel: true,
    },
    xAxis: {
        type: 'category',
        axisLine: {
            lineStyle: {
                color: '#D9D9D9',
            }
        },
        axisTick: {
            lineStyle: {
                color: '#D9D9D9',
            }
        },
        axisLabel: {
            color: 'black',
            margin: 10,
            fontSize: 11
        }
    },
    yAxis: {
        axisLine: {
            show: false
        },
        axisTick: {
            show: false
        },
        splitLine: {
            lineStyle: {
                color: '#E4EBF057',
            }
        },
        axisLabel: {
            fontSize: 11
        }
    },
    legend: {
        // left: 45,
        // top: -3,
        x: 'center',
        y: 'bottom',
        itemWidth: 16,
        itemHeight: 3,
        borderRadius: 2,
        icon: 'roundRect',
        padding: [15, 0],
        textStyle: {
            color: '#000000a6'
        }
    },
    tooltip: {
        backgroundColor: "#ffffffe8",
        textStyle: {
            color: "#000000e6",
        },
        extraCssText: "box-shadow: 0px 1px 7px #00000017;",
        appendToBody: true,
        confine: true,
    },
};
/** @type {?} */
const chartsConsts = {
    /**
     * series label å­—ä½“å¤§å°
     */
    seriesLabelFontSize: 9,
};
const Éµ0 = /**
 * @param {?} c
 * @return {?}
 */
c => c.split(',');
/** @type {?} */
const splitedGradientColors = PlThemeColors.gradient.map((Éµ0));
/** @type {?} */
const getChartColorsPure = (/**
 * @param {?} params
 * @return {?}
 */
(params) => {
    return PlThemeColors.pure[params.dataIndex];
});
/** @type {?} */
const getChartColorsGradient = (/**
 * @param {?} params
 * @return {?}
 */
(params) => {
    return new LinearGradient(0, 0, 0, 1, [
        { offset: 0, color: splitedGradientColors[params.dataIndex % splitedGradientColors.length][0] },
        { offset: 1, color: splitedGradientColors[params.dataIndex % splitedGradientColors.length][1] }
    ]);
});
/** @type {?} */
const getChartColorsGradientOne = (/**
 * @param {?} params
 * @return {?}
 */
(params) => {
    return new LinearGradient(1, 0, 0, 0, [
        { offset: 0, color: splitedGradientColors[params.dataIndex % splitedGradientColors.length][0] },
        { offset: 1, color: splitedGradientColors[params.dataIndex % splitedGradientColors.length][1] }
    ]);
})
/**
 * å¯¹äºæœ‰ â€œy è½´è‡ªå®šä¹‰èŒƒå›´â€ çš„ charts å…ƒéƒ¨ä»¶ï¼Œdata éƒ½è¦ç”¨å®ƒè¿‡æ»¤åå†ç”¨
 * @param obj å…ƒéƒ¨ä»¶å®ä¾‹
 */
;
/**
 * å¯¹äºæœ‰ â€œy è½´è‡ªå®šä¹‰èŒƒå›´â€ çš„ charts å…ƒéƒ¨ä»¶ï¼Œdata éƒ½è¦ç”¨å®ƒè¿‡æ»¤åå†ç”¨
 * @param {?} obj å…ƒéƒ¨ä»¶å®ä¾‹
 * @param {?} data
 * @return {?}
 */
function filterYData(obj, data) {
    if (obj.filterYFlag) {
        /** @type {?} */
        const yFields = obj.yFieldObjs.map((/**
         * @param {?} o
         * @return {?}
         */
        o => o.valueField.name));
        return data.filter((/**
         * @param {?} item
         * @return {?}
         */
        item => {
            return !yFields.some((/**
             * @param {?} yField
             * @return {?}
             */
            yField => item[yField] <= obj.minY || item[yField] >= obj.maxY));
        }));
    }
    return data;
}
/** @type {?} */
const EchartsPropertyOptions = {
    showRefresh: {
        category: 'data',
        displayName: 'showRefreshBtn',
        type: PropertyTypes.Bool,
        boolOption: {
            default: true
        }
    },
    filterYFlag: {
        type: PropertyTypes.Bool,
        category: 'data',
        displayName: 'setYRange'
    },
    minY: {
        type: PropertyTypes.Number,
        category: 'data',
        displayName: 'minY',
        numberOption: {
            default: 0
        },
        /**
         * @param {?} values
         * @return {?}
         */
        ifShow(values) { return values.filterYFlag; }
    },
    maxY: {
        type: PropertyTypes.Number,
        category: 'data',
        displayName: 'maxY',
        numberOption: {
            default: 1000
        },
        /**
         * @param {?} values
         * @return {?}
         */
        ifShow(values) { return values.filterYFlag; }
    },
    showLabel: {
        category: 'style',
        type: PropertyTypes.Bool,
        displayName: 'showNumber'
    },
    showTooltip: {
        category: 'style',
        type: PropertyTypes.Bool,
        boolOption: { default: true },
        displayName: 'showHoverDetail'
    },
    legendStyleOption: {
        type: PropertyTypes.Enum,
        displayName: 'legendType',
        category: 'style',
        enumOption: {
            default: 'scroll',
            items: [
                { value: 'none', displayName: 'notVisible' },
                { value: 'plain', displayName: 'showAll' },
                { value: 'scroll', displayName: 'scrollOverflow' }
            ]
        }
    },
    valueStyleOption: {
        type: PropertyTypes.Enum,
        displayName: 'valueType',
        category: 'style',
        enumOption: {
            default: 'right',
            items: [
                { value: 'right', displayName: 'right' },
                { value: 'insideRight', displayName: 'inside' },
            ]
        }
    }
}
/**
 * ä¸‰ç§ä¼ å‚æ–¹å¼ï¼š
 * 1. '#000', '#fff'
 * 2. '#000,#fff'
 * 3. '#000'
 */
;
/**
 * ä¸‰ç§ä¼ å‚æ–¹å¼ï¼š
 * 1. '#000', '#fff'
 * 2. '#000,#fff'
 * 3. '#000'
 * @param {?} c1
 * @param {?=} c2
 * @return {?}
 */
function echartsGradient(c1, c2) {
    // è‹¥åªä¼ äº†ä¸€ä¸ªå€¼ã€è¿˜ä¸æ˜¯é€—å·åˆ†å‰²ï¼Œåˆ™ç›´æ¥è¿”å›æ­¤çº¯è‰²
    if (!c2 && !c1.includes(','))
        return c1;
    // è‹¥åªä¼ äº†ä¸€ä¸ªå€¼ã€æ˜¯é€—å·åˆ†å‰²ï¼Œå°±åˆ†å‰²ä¸ºä¿©é¢œè‰²
    if (!c2)
        [c1, c2] = c1.split(',');
    return new LinearGradient(0, 0, 0, 1, [
        { offset: 0, color: c1 },
        { offset: 1, color: c2 }
    ]);
}
// TODO: æš‚æ—¶ç»™èµ„é‡‘åšå›½é™…åŒ–
/** @type {?} */
const tempMap = {
    'é‡‘é¢': {
        'en': 'Amount',
        'zh-CHS': 'é‡‘é¢',
    },
    'æ•°é‡': {
        'en': 'Number',
        'zh-CHS': 'æ•°é‡',
    }
}
// TODO: æš‚æ—¶ç»™èµ„é‡‘å›½é™…åŒ–
;
// TODO: æš‚æ—¶ç»™èµ„é‡‘å›½é™…åŒ–
/**
 * @param {?} dataField
 * @param {?} currentLang
 * @return {?}
 */
function tempLabel(dataField, currentLang) {
    const { label } = dataField;
    return tempMap[label] && tempMap[label][currentLang]
        ? tempMap[label][currentLang]
        : dataField.label;
}

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/**
 * dataItem è¿™ä¸ªåå­—ä¼šå½±å“ exp ä¸­çš„å†™æ³•ï¼Œä¸å¯éšæ„æ›´æ”¹ã€‚
 * @param {?} html
 * @param {?} dataItem
 * @return {?}
 */
function resolveTemplate(html, dataItem) {
    /** @type {?} */
    const expPatt = /{{[\d\D]+?}}/gm;
    if (!html)
        return '';
    /** @type {?} */
    const exps = html.match(expPatt) || [];
    try {
        exps.forEach((/**
         * @param {?} exp
         * @return {?}
         */
        exp => {
            html = html.replace(exp, eval(exp.slice(2, -2)));
        }));
    }
    catch (err) {
        return html;
    }
    return html;
}

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/**
 * æ•°æ®åŠ è½½ä¸åº”è¯¥è®©æ­¤ service ç›´æ¥å‘å‡ºï¼Œå› ä¸ºå¤–éƒ¨æ¡†æ¶å¹¶ä¸éšæ—¶éƒ½æ”¯æŒå–æ•°ï¼Œ
 * æ¯”å¦‚æ–°å¢éƒ¨ä»¶åçš„éƒ¨ä»¶é…ç½®ï¼Œæ­¤æ—¶æ²¡æœ‰é…ç½®è¿‡æ•°æ®ï¼Œä¾¿ä¼šæœåŠ¡ç«¯æŠ¥é”™ã€‚
 * åº”è¯¥äº¤ç”±å…ƒéƒ¨ä»¶å®¹å™¨åŠ è½½æ•°æ®ã€‚
 */
class WidgetDataService {
    constructor() {
        /**
         * loadData() / reloadData() æ—¶è§¦å‘ï¼Œå¤–éƒ¨å…ƒéƒ¨ä»¶å®¹å™¨æ¥æ”¶ã€åŠ è½½æ•°æ®ï¼Œå¹¶é€šè¿‡ setData è®¾ç½®å›æ•°æ®
         */
        this.onLoadData = new EventEmitter();
        this.onGetData = new EventEmitter();
        this.onGetDataWithDims = new EventEmitter();
    }
    /**
     * å…ƒéƒ¨ä»¶è°ƒç”¨æ­¤æ–¹æ³•è·å–æ•°æ®ã€‚ç¤ºä¾‹ï¼š
     * ```ts
     * this.dataService.loadData().subscribe(data => {
     *  this.data = data // ä½¿ç”¨æ•°æ®
     * })
     * ```
     * @param {?=} options
     * @return {?}
     */
    loadData(options) {
        this.onLoadData.emit(options);
        return this.onGetData;
    }
    /**
     * è·å–å…¨æ•°æ®ä¿¡æ¯ï¼ŒåŒ…å« dimensions
     * @param {?=} options
     * @return {?}
     */
    loadDataWithDims(options) {
        this.onLoadData.emit(options);
        return this.onGetDataWithDims;
    }
    /**
     * å…ƒéƒ¨ä»¶è°ƒç”¨æ­¤æ–¹æ³•ä»¥é‡æ–°è·å–æ•°æ®ï¼Œæ•°æ®åŠ è½½å®Œæˆåå†æ¬¡è°ƒç”¨åœ¨ loadData() æ³¨å†Œçš„äº‹ä»¶å¤„ç†å™¨ã€‚ç¤ºä¾‹ï¼š
     * ```ts
     * this.dataService.refreshData()
     * ```
     * @param {?=} param
     * @return {?}
     */
    reloadData(param) {
        this.onLoadData.emit(param);
    }
    /**
     * å¤–éƒ¨é€šè¿‡æ­¤æ–¹æ³•ç»™å…ƒéƒ¨ä»¶è®¾ç½®æ•°æ®ï¼Œå…ƒéƒ¨ä»¶æ— éœ€è°ƒç”¨
     * @param {?} dataWithDims è¦è®¾ç½®çš„æ•°æ®
     * @return {?}
     */
    setData(dataWithDims) {
        this.onGetData.emit(dataWithDims.tableData);
        this.onGetDataWithDims.emit(dataWithDims);
    }
}
WidgetDataService.decorators = [
    { type: Injectable }
];

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/**
 * å¯ä¾èµ–æ³¨å…¥è‡³å…ƒéƒ¨ä»¶çš„å…ƒéƒ¨ä»¶å®ä¾‹ä¿¡æ¯
 */
class WidgetInstanceInfo {
    /**
     * @param {?=} portletId
     * @param {?=} id
     * @param {?=} assetsBaseUrl
     */
    constructor(portletId, id, assetsBaseUrl) {
        this.portletId = portletId;
        this.id = id;
        this.assetsBaseUrl = assetsBaseUrl;
    }
}

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
// import { TranslateModule } from '@ngx-translate/core';
class WidgetDevkitModule {
}
WidgetDevkitModule.decorators = [
    { type: NgModule, args: [{
                declarations: [],
                providers: [WidgetDevkitService],
                imports: [
                    CommonModule,
                    // éœ€è¦åŠ  forRootï¼Œä¿è¯ WidgetDevkitService èƒ½åœ¨æ­¤å±‚æ‰¾åˆ°ä¾èµ–çš„é‡Œé¢çš„æœåŠ¡ã€‚
                    // æ— æ³•ä¿è¯å¤–éƒ¨ç¯å¢ƒã€‚
                    ModalModule.forRoot(),
                ],
                exports: [
                    // TranslateModule
                    WidgetTitleBarModule
                ]
            },] }
];

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */

export { Widget, WidgetRegistry, WidgetEvent, WidgetEventMap, WidgetEventService, WidgetPropertyService, Property, WidgetPropertyMap, WidgetTitleBarModule, WidgetTitleBarComponent, WidgetTitleBarSelectComponent, WidgetBase, resolveTemplate, JumpTypes, jumpTypeOption, funcOption, dataJumpOption, datalessJumpOption, CommonPropertyOptions, filterYData, echartsGradient, tempLabel, EchartsOptions, chartsConsts, getChartColorsPure, getChartColorsGradient, getChartColorsGradientOne, EchartsPropertyOptions, tempMap, WidgetDataService, WidgetInstanceInfo, WidgetDevkitModule, DASHBOARD_API, WidgetDevkitService, PropertyTypes, HelpStructure, CHART_TABLE_FUNC_ID, getObj, ifFsDateRange, isFsFlat, FSLastTimeItem, FSRangeDefault, FSDate, FSEnum, FSEnumItem, FilterSchema, FILTER_PROP_NAME, frontendFilterProp };

//# sourceMappingURL=gspwidget-widget-devkit.js.map
/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import add from "date-fns/add";
import sub from 'date-fns/sub';
import { PropertyTypes } from "../types";
/**
 * 没发直接用 [] 作 key 直接建 literal 对象，aot 编译会报错
 * @param {?} key
 * @param {?} value
 * @return {?}
 */
export function getObj(key, value) {
    /** @type {?} */
    const obj = {};
    obj[key] = value;
    return obj;
}
/**
 * 筛选描述
 */
export class FSLastTimeItem {
    constructor() {
        this.num = 1;
        this.unit = 'day';
    }
    /**
     * 传入一个 '最近n某'，返回对应的时间范围数组
     * @param {?} lastTimeItem
     * @return {?}
     */
    static GetDates(lastTimeItem) {
        return [
            sub(new Date(), getObj(lastTimeItem.unit + 's', lastTimeItem.num)),
            new Date()
        ];
    }
}
if (false) {
    /** @type {?} */
    FSLastTimeItem.prototype.num;
    /** @type {?} */
    FSLastTimeItem.prototype.unit;
    /** @type {?} */
    FSLastTimeItem.prototype.isDefault;
}
export class FSRangeDefault {
    constructor() {
        this.beforeNum = 1;
        this.beforeUnit = 'month';
        this.afterNum = 0;
        this.afterUnit = 'day';
    }
    /**
     * @param {?} rangeDefault
     * @return {?}
     */
    static GetDates(rangeDefault) {
        return [
            sub(new Date(), getObj(rangeDefault.beforeUnit + 's', rangeDefault.afterNum)),
            add(new Date(), getObj(rangeDefault.beforeUnit + 's', rangeDefault.afterNum)),
        ];
    }
}
if (false) {
    /** @type {?} */
    FSRangeDefault.prototype.beforeNum;
    /** @type {?} */
    FSRangeDefault.prototype.beforeUnit;
    /** @type {?} */
    FSRangeDefault.prototype.afterNum;
    /** @type {?} */
    FSRangeDefault.prototype.afterUnit;
}
export class FSDate {
    constructor() {
        this.type = 'single';
        this.singleUnit = 'day';
        this.singleDefaultType = 'current';
        this.singleDefaultSpecified = new Date();
        this.rangeDefault = new FSRangeDefault();
        this.lastTimeItems = [];
        this.lastTimeDisplayType = 'flat';
    }
}
if (false) {
    /** @type {?} */
    FSDate.prototype.type;
    /** @type {?} */
    FSDate.prototype.singleUnit;
    /** @type {?} */
    FSDate.prototype.singleDefaultType;
    /** @type {?} */
    FSDate.prototype.singleDefaultSpecified;
    /** @type {?} */
    FSDate.prototype.rangeDefault;
    /** @type {?} */
    FSDate.prototype.lastTimeItems;
    /** @type {?} */
    FSDate.prototype.lastTimeDisplayType;
}
export class FSEnum {
    constructor() {
        this.multi = false;
        /**
         * 暂时定为，仅有 single 时可以选择 flat
         */
        this.displayType = 'select';
        this.source = 'manual';
        /**
         * 是否可清空不选。仅有 select 且 single 才有此选项
         */
        this.allowEmpty = false;
        /**
         * 通过上面两个字段取出 items 存在下面
         */
        this.itemsFromData = [];
        this.itemsManual = [];
        this.multiDefault = [];
    }
    // 暂时不做
    // sourceDatasetId: string
    // sourceDatasetLabelField?: DataField
    // sourceDatasetValueField?: DataField
    /**
     * @param {?} fsEnum
     * @return {?}
     */
    static GetItems(fsEnum) {
        const { source, itemsFromData, itemsManual } = fsEnum;
        if (source === 'dataField') {
            // if (!itemsValueField || !intactData) return []
            // const tempItems = intactData.map(dataItem => ({
            //   label: dataItem[itemsLabelField || itemsValueField],
            //   value: dataItem[itemsValueField]
            // }))
            // return ArrUtil.Unique(tempItems)
            return itemsFromData;
        }
        else if (source === 'manual') {
            return itemsManual;
        }
    }
    /**
     * @param {?} fsEnum
     * @return {?}
     */
    static GetItemValues(fsEnum) {
        /**
         * @param {?} item
         * @return {?}
         */
        function mapCb(item) { return item.value; }
        return FSEnum.GetItems(fsEnum).map(mapCb);
    }
}
if (false) {
    /** @type {?} */
    FSEnum.prototype.multi;
    /**
     * 暂时定为，仅有 single 时可以选择 flat
     * @type {?}
     */
    FSEnum.prototype.displayType;
    /** @type {?} */
    FSEnum.prototype.source;
    /**
     * 是否可清空不选。仅有 select 且 single 才有此选项
     * @type {?}
     */
    FSEnum.prototype.allowEmpty;
    /** @type {?} */
    FSEnum.prototype.itemsLabelField;
    /** @type {?} */
    FSEnum.prototype.itemsValueField;
    /**
     * 通过上面两个字段取出 items 存在下面
     * @type {?}
     */
    FSEnum.prototype.itemsFromData;
    /** @type {?} */
    FSEnum.prototype.itemsManual;
    /** @type {?} */
    FSEnum.prototype.multiDefault;
    /** @type {?} */
    FSEnum.prototype.singleDefault;
}
export class FSEnumItem {
}
if (false) {
    /** @type {?} */
    FSEnumItem.prototype.label;
    /** @type {?} */
    FSEnumItem.prototype.value;
}
export class FilterSchema {
    constructor() {
        /**
         * 过滤名称，在筛选控件上显示，可选
         */
        this.i18nName = {};
        this.showName = false;
        /**
         * 过滤大类
         */
        this.type = 'date';
        /**
         * 每种类型的过滤配置
         */
        this.date = new FSDate();
        this.enum = new FSEnum();
        this.number = {
            default: 0
        };
        this.text = {
            default: ''
        };
    }
    /**
     * 获取 FS 的默认值
     * 🙅 不可以依赖 data：部件第一次根据默认值筛选时，还没有 data 呢。
     * @param {?} fs
     * @return {?}
     */
    static getDefaultValue(fs) {
        switch (fs.type) {
            case 'date':
                if (fs.date.type === 'single') {
                    if (fs.date.singleDefaultType === 'current') {
                        return new Date();
                    }
                    else {
                        return fs.date.singleDefaultSpecified;
                    }
                }
                else if (fs.date.type === 'range') {
                    return FSRangeDefault.GetDates(fs.date.rangeDefault);
                }
                else if (fs.date.type === 'lastTimeEnum') {
                    return FSLastTimeItem.GetDates(fs.date.lastTimeItems[0]);
                }
                break;
            case 'enum':
                const { multi, singleDefault, multiDefault } = fs.enum;
                return multi ? multiDefault : singleDefault;
            case 'number':
                return fs.number.default;
                break;
            case 'text':
                return fs.text.default;
                break;
        }
    }
}
if (false) {
    /**
     * 过滤名称，在筛选控件上显示，可选
     * @type {?}
     */
    FilterSchema.prototype.i18nName;
    /** @type {?} */
    FilterSchema.prototype.showName;
    /**
     * 过滤大类
     * @type {?}
     */
    FilterSchema.prototype.type;
    /**
     * 每种类型的过滤配置
     * @type {?}
     */
    FilterSchema.prototype.date;
    /** @type {?} */
    FilterSchema.prototype.enum;
    /** @type {?} */
    FilterSchema.prototype.help;
    /** @type {?} */
    FilterSchema.prototype.number;
    /** @type {?} */
    FilterSchema.prototype.text;
}
/**
 * @param {?} fs
 * @return {?}
 */
export function ifFsDateRange(fs) {
    if (!fs)
        return;
    return fs.type === 'date' && fs.date.type === 'range';
}
/**
 * @param {?} fs
 * @return {?}
 */
export function isFsFlat(fs) {
    if (!fs)
        return;
    return fs.type === 'date' && fs.date.type === 'lastTimeEnum' && fs.date.lastTimeDisplayType === 'flat'
        || fs.type === 'enum' && !fs.enum.multi && fs.enum.displayType === 'flat';
}
/**
 * 官方预制的筛选 property
 * @type {?}
 */
export const FILTER_PROP_NAME = 'filter';
/** @type {?} */
export const frontendFilterProp = {
    name: FILTER_PROP_NAME,
    displayName: '筛选',
    isArray: true,
    type: PropertyTypes.Object,
    objectOption: {
        objPropertyOptions: [{
                name: 'fs',
                type: PropertyTypes.Filter,
            }, {
                name: 'dpId',
                type: PropertyTypes.DataParam,
            }, {
                name: 'dpId2',
                type: PropertyTypes.DataParam,
                ifShow: (/**
                 * @param {?} pv
                 * @return {?}
                 */
                pv => {
                    return pv.fs && ifFsDateRange(pv.fs);
                })
            }]
    }
};
/**
 * @record
 */
export function FilterConfig() { }
if (false) {
    /** @type {?} */
    FilterConfig.prototype.fs;
    /** @type {?} */
    FilterConfig.prototype.dpId;
    /** @type {?} */
    FilterConfig.prototype.dpId2;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmlsdGVyLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGdzcHdpZGdldC93aWRnZXQtZGV2a2l0LyIsInNvdXJjZXMiOlsibGliL2ZpbHRlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxHQUFHLE1BQU0sY0FBYyxDQUFBO0FBQzlCLE9BQU8sR0FBRyxNQUFNLGNBQWMsQ0FBQTtBQUM5QixPQUFPLEVBQWtCLGFBQWEsRUFBRSxNQUFNLFVBQVUsQ0FBQTs7Ozs7OztBQUt4RCxNQUFNLFVBQVUsTUFBTSxDQUFFLEdBQVcsRUFBRSxLQUFhOztVQUMxQyxHQUFHLEdBQUcsRUFBRTtJQUNkLEdBQUcsQ0FBQyxHQUFHLENBQUMsR0FBRyxLQUFLLENBQUE7SUFDaEIsT0FBTyxHQUFHLENBQUE7QUFDWixDQUFDOzs7O0FBR0QsTUFBTSxPQUFPLGNBQWM7SUFBM0I7UUFDRSxRQUFHLEdBQUcsQ0FBQyxDQUFBO1FBQ1AsU0FBSSxHQUFnQixLQUFLLENBQUE7SUFXM0IsQ0FBQzs7Ozs7O0lBTkMsTUFBTSxDQUFFLFFBQVEsQ0FBRSxZQUE0QjtRQUM1QyxPQUFPO1lBQ0wsR0FBRyxDQUFDLElBQUksSUFBSSxFQUFFLEVBQUUsTUFBTSxDQUFDLFlBQVksQ0FBQyxJQUFJLEdBQUcsR0FBRyxFQUFFLFlBQVksQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUNsRSxJQUFJLElBQUksRUFBRTtTQUNYLENBQUE7SUFDSCxDQUFDO0NBQ0Y7OztJQVpDLDZCQUFPOztJQUNQLDhCQUF5Qjs7SUFDekIsbUNBQW1COztBQVdyQixNQUFNLE9BQU8sY0FBYztJQUEzQjtRQUNFLGNBQVMsR0FBRyxDQUFDLENBQUE7UUFDYixlQUFVLEdBQWUsT0FBTyxDQUFBO1FBQ2hDLGFBQVEsR0FBRyxDQUFDLENBQUE7UUFDWixjQUFTLEdBQWUsS0FBSyxDQUFBO0lBTy9CLENBQUM7Ozs7O0lBTkMsTUFBTSxDQUFDLFFBQVEsQ0FBRSxZQUE0QjtRQUMzQyxPQUFPO1lBQ0wsR0FBRyxDQUFD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Q0QsSUFBSSxFQUFFLE9BQU87Z0JBQ2IsSUFBSSxFQUFFLGFBQWEsQ0FBQyxTQUFTO2dCQUM3QixNQUFNOzs7O2dCQUFFLEVBQUUsQ0FBQyxFQUFFO29CQUNYLE9BQU8sRUFBRSxDQUFDLEVBQUUsSUFBSSxhQUFhLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFBO2dCQUN0QyxDQUFDLENBQUE7YUFDRixDQUFDO0tBQ0g7Q0FDRjs7OztBQUNELGtDQUlDOzs7SUFIQywwQkFBZ0I7O0lBQ2hCLDRCQUFZOztJQUNaLDZCQUFhIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGFkZCBmcm9tIFwiZGF0ZS1mbnMvYWRkXCJcbmltcG9ydCBzdWIgZnJvbSAnZGF0ZS1mbnMvc3ViJ1xuaW1wb3J0IHsgUHJvcGVydHlPcHRpb24sIFByb3BlcnR5VHlwZXMgfSBmcm9tIFwiLi4vdHlwZXNcIlxuXG4vKipcbiAqIOayoeWPkeebtOaOpeeUqCBbXSDkvZwga2V5IOebtOaOpeW7uiBsaXRlcmFsIOWvueixoe+8jGFvdCDnvJbor5HkvJrmiqXplJlcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldE9iaiAoa2V5OiBzdHJpbmcsIHZhbHVlOiBudW1iZXIpIHtcbiAgY29uc3Qgb2JqID0ge31cbiAgb2JqW2tleV0gPSB2YWx1ZVxuICByZXR1cm4gb2JqXG59XG5leHBvcnQgdHlwZSBGU0RhdGVVbml0ID0gJ3llYXInIHwgJ21vbnRoJyB8ICdkYXknXG4vKiog562b6YCJ5o+P6L+wICovXG5leHBvcnQgY2xhc3MgRlNMYXN0VGltZUl0ZW0ge1xuICBudW0gPSAxXG4gIHVuaXQ/OiBGU0RhdGVVbml0ID0gJ2RheSdcbiAgaXNEZWZhdWx0PzogYm9vbGVhblxuICAvKipcbiAgICog5Lyg5YWl5LiA5LiqICfmnIDov5Fu5p+QJ++8jOi/lOWbnuWvueW6lOeahOaXtumXtOiMg+WbtOaVsOe7hFxuICAgKi9cbiAgc3RhdGljICBHZXREYXRlcyAobGFzdFRpbWVJdGVtOiBGU0xhc3RUaW1lSXRlbSkge1xuICAgIHJldHVybiBbXG4gICAgICBzdWIobmV3IERhdGUoKSwgZ2V0T2JqKGxhc3RUaW1lSXRlbS51bml0ICsgJ3MnLCBsYXN0VGltZUl0ZW0ubnVtKSksXG4gICAgICBuZXcgRGF0ZSgpXG4gICAgXVxuICB9XG59XG5leHBvcnQgY2xhc3MgRlNSYW5nZURlZmF1bHQge1xuICBiZWZvcmVOdW0gPSAxXG4gIGJlZm9yZVVuaXQ6IEZTRGF0ZVVuaXQgPSAnbW9udGgnXG4gIGFmdGVyTnVtID0gMFxuICBhZnRlclVuaXQ6IEZTRGF0ZVVuaXQgPSAnZGF5J1xuICBzdGF0aWMgR2V0RGF0ZXMgKHJhbmdlRGVmYXVsdDogRlNSYW5nZURlZmF1bHQpIHtcbiAgICByZXR1cm4gW1xuICAgICAgc3ViKG5ldyBEYXRlKCksIGdldE9iaihyYW5nZURlZmF1bHQuYmVmb3JlVW5pdCArICdzJywgcmFuZ2VEZWZhdWx0LmFmdGVyTnVtKSksXG4gICAgICBhZGQobmV3IERhdGUoKSwgZ2V0T2JqKHJhbmdlRGVmYXVsdC5iZWZvcmVVbml0ICsgJ3MnLCByYW5nZURlZmF1bHQuYWZ0ZXJOdW0pKSxcbiAgICBdXG4gIH1cbn1cbmV4cG9ydCBjbGFzcyBGU0RhdGUge1xuICB0eXBlPzogJ3NpbmdsZScgfCAncmFuZ2UnIHwgJ2xhc3RUaW1lRW51bScgPSAnc2luZ2xlJ1xuICBzaW5nbGVVbml0PzogRlNEYXRlVW5pdCA9ICdkYXknXG4gIHNpbmdsZURlZmF1bHRUeXBlPzogJ2N1cnJlbnQnIHwgJ3NwZWNpZmllZCcgPSAnY3VycmVudCdcbiAgc2luZ2xlRGVmYXVsdFNwZWNpZmllZCA9IG5ldyBEYXRlKClcbiAgcmFuZ2VEZWZhdWx0ID0gbmV3IEZTUmFuZ2VEZWZhdWx0KClcbiAgbGFzdFRpbWVJdGVtcz86IEZTTGFzdFRpbWVJdGVtW10gPSBbXVxuICBsYXN0VGltZURpc3BsYXlUeXBlPzogJ3NlbGVjdCcgfCAnZmxhdCcgPSAnZmxhdCdcbn1cbmV4cG9ydCB0eXBlIEZTRW51bVNvdXJjZSA9ICdkYXRhRmllbGQnIHwgJ21hbnVhbCcgfCAnZGF0YXNldCdcbmV4cG9ydCBjbGFzcyBGU0VudW0ge1xuICBtdWx0aSA9IGZhbHNlXG4gIC8qKiDmmoLml7blrprkuLrvvIzku4XmnIkgc2luZ2xlIOaXtuWPr+S7pemAieaLqSBmbGF0ICovXG4gIGRpc3BsYXlUeXBlPzogJ3NlbGVjdCcgfCAnZmxhdCcgPSAnc2VsZWN0J1xuICBzb3VyY2U/OiBGU0VudW1Tb3VyY2UgPSAnbWFudWFsJ1xuICAvKiog5piv5ZCm5Y+v5riF56m65LiN6YCJ44CC5LuF5pyJIHNlbGVjdCDkuJQgc2luZ2xlIOaJjeacieatpOmAiemhuSAqL1xuICBhbGxvd0VtcHR5ID0gZmFsc2VcbiAgLy8gVE9ETzog5LiL6Z2i5Lik5Liq5a2X5q615LuF55So5L2c5LiL5qyh57yW6L6R5pe25pi+56S65ZCn44CCXG4gIGl0ZW1zTGFiZWxGaWVsZD86IHN0cmluZ1xuICBpdGVtc1ZhbHVlRmllbGQ/OiBzdHJpbmdcbiAgLyoqIOmAmui/h+S4iumdouS4pOS4quWtl+auteWPluWHuiBpdGVtcyDlrZjlnKjkuIvpnaIgKi9cbiAgaXRlbXNGcm9tRGF0YT86IEZTRW51bUl0ZW1bXSA9IFtdXG4gIGl0ZW1zTWFudWFsPzogRlNFbnVtSXRlbVtdID0gW11cbiAgbXVsdGlEZWZhdWx0OiBzdHJpbmdbXSA9IFtdXG4gIHNpbmdsZURlZmF1bHQ6IHN0cmluZ1xuICAvLyDmmoLml7bkuI3lgZpcbiAgLy8gc291cmNlRGF0YXNldElkOiBzdHJpbmdcbiAgLy8gc291cmNlRGF0YXNldExhYmVsRmllbGQ/OiBEYXRhRmllbGRcbiAgLy8gc291cmNlRGF0YXNldFZhbHVlRmllbGQ/OiBEYXRhRmllbGRcbiAgc3RhdGljIEdldEl0ZW1zIChmc0VudW06IEZTRW51bSk6IEZTRW51bUl0ZW1bXSB7XG4gICAgY29uc3Qge1xuICAgICAgc291cmNlLCBpdGVtc0Zyb21EYXRhLCBpdGVtc01hbnVhbFxuICAgIH0gPSBmc0VudW1cbiAgICBpZiAoc291cmNlID09PSAnZGF0YUZpZWxkJykge1xuICAgICAgLy8gaWYgKCFpdGVtc1ZhbHVlRmllbGQgfHwgIWludGFjdERhdGEpIHJldHVybiBbXVxuICAgICAgLy8gY29uc3QgdGVtcEl0ZW1zID0gaW50YWN0RGF0YS5tYXAoZGF0YUl0ZW0gPT4gKHtcbiAgICAgIC8vICAgbGFiZWw6IGRhdGFJdGVtW2l0ZW1zTGFiZWxGaWVsZCB8fCBpdGVtc1ZhbHVlRmllbGRdLFxuICAgICAgLy8gICB2YWx1ZTogZGF0YUl0ZW1baXRlbXNWYWx1ZUZpZWxkXVxuICAgICAgLy8gfSkpXG4gICAgICAvLyByZXR1cm4gQXJyVXRpbC5VbmlxdWUodGVtcEl0ZW1zKVxuICAgICAgcmV0dXJuIGl0ZW1zRnJvbURhdGFcbiAgICB9IGVsc2UgaWYgKHNvdXJjZSA9PT0gJ21hbnVhbCcpIHtcbiAgICAgIHJldHVybiBpdGVtc01hbnVhbFxuICAgIH1cbiAgfVxuICBzdGF0aWMgR2V0SXRlbVZhbHVlcyAoZnNFbnVtOiBGU0VudW0pIHtcbiAgICBmdW5jdGlvbiBtYXBDYiAoaXRlbSkgeyByZXR1cm4gaXRlbS52YWx1ZSB9XG4gICAgcmV0dXJuIEZTRW51bS5HZXRJdGVtcyhmc0VudW0pLm1hcChtYXBDYilcbiAgfVxufVxuZXhwb3J0IGNsYXNzIEZTRW51bUl0ZW0ge1xuICBsYWJlbDogc3RyaW5nXG4gIHZhbHVlOiBzdHJpbmdcbn1cbmV4cG9ydCBjbGFzcyBGaWx0ZXJTY2hlbWEge1xuICAvKiog6L+H5ruk5ZCN56ew77yM5Zyo562b6YCJ5o6n5Lu25LiK5pi+56S677yM5Y+v6YCJICovXG4gIGkxOG5OYW1lOiBhbnkgPSB7fVxuICBzaG93TmFtZSA9IGZhbHNlXG4gIC8qKiDov4fmu6TlpKfnsbsgKi9cbiAgdHlwZT86ICdkYXRlJyB8ICdlbnVtJyB8ICdudW1iZXInIHwgJ3RleHQnIHwgJ2hlbHAnID0gJ2RhdGUnXG4gIC8qKiDmr4/np43nsbvlnovnmoTov4fmu6TphY3nva4gKi9cbiAgZGF0ZSA9IG5ldyBGU0RhdGUoKVxuICBlbnVtID0gbmV3IEZTRW51bSgpXG4gIGhlbHA/OiB7fVxuICBudW1iZXIgPSB7XG4gICAgZGVmYXVsdDogMFxuICB9XG4gIHRleHQgPSB7XG4gICAgZGVmYXVsdDogJydcbiAgfVxuICAvKipcbiAgICog6I635Y+WIEZTIOeahOm7mOiupOWAvFxuICAgKiDwn5mFIOS4jeWPr+S7peS+nei1liBkYXRh77ya6YOo5Lu256ys5LiA5qyh5qC55o2u6buY6K6k5YC8562b6YCJ5pe277yM6L+Y5rKh5pyJIGRhdGEg5ZGi44CCXG4gICAqL1xuICBzdGF0aWMgZ2V0RGVmYXVsdFZhbHVlIChmczogRmlsdGVyU2NoZW1hKSB7XG4gICAgc3dpdGNoIChmcy50eXBlKSB7XG4gICAgICBjYXNlICdkYXRlJzpcbiAgICAgICAgaWYgKGZzLmRhdGUudHlwZSA9PT0gJ3NpbmdsZScpIHtcbiAgICAgICAgICBpZiAoZnMuZGF0ZS5zaW5nbGVEZWZhdWx0VHlwZSA9PT0gJ2N1cnJlbnQnKSB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IERhdGUoKVxuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gZnMuZGF0ZS5zaW5nbGVEZWZhdWx0U3BlY2lmaWVkXG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2UgaWYgKGZzLmRhdGUudHlwZSA9PT0gJ3JhbmdlJykge1xuICAgICAgICAgIHJldHVybiBGU1JhbmdlRGVmYXVsdC5HZXREYXRlcyhmcy5kYXRlLnJhbmdlRGVmYXVsdClcbiAgICAgICAgfSBlbHNlIGlmIChmcy5kYXRlLnR5cGUgPT09ICdsYXN0VGltZUVudW0nKSB7XG4gICAgICAgICAgcmV0dXJuIEZTTGFzdFRpbWVJdGVtLkdldERhdGVzKGZzLmRhdGUubGFzdFRpbWVJdGVtc1swXSlcbiAgICAgICAgfVxuICAgICAgICBicmVha1xuICAgICAgY2FzZSAnZW51bSc6XG4gICAgICAgIGNvbnN0IHsgbXVsdGksIHNpbmdsZURlZmF1bHQsIG11bHRpRGVmYXVsdCB9ID0gZnMuZW51bVxuICAgICAgICByZXR1cm4gbXVsdGkgPyBtdWx0aURlZmF1bHQgOiBzaW5nbGVEZWZhdWx0XG4gICAgICBjYXNlICdudW1iZXInOlxuICAgICAgICByZXR1cm4gZnMubnVtYmVyLmRlZmF1bHRcbiAgICAgICAgYnJlYWtcbiAgICAgIGNhc2UgJ3RleHQnOlxuICAgICAgICByZXR1cm4gZnMudGV4dC5kZWZhdWx0XG4gICAgICAgIGJyZWFrXG4gICAgfVxuICB9XG59XG5leHBvcnQgZnVuY3Rpb24gaWZGc0RhdGVSYW5nZSAoZnM6IEZpbHRlclNjaGVtYSkge1xuICBpZiAoIWZzKSByZXR1cm5cbiAgcmV0dXJuIGZzLnR5cGUgPT09ICdkYXRlJyAmJiBmcy5kYXRlLnR5cGUgPT09ICdyYW5nZSdcbn1cbmV4cG9ydCBmdW5jdGlvbiBpc0ZzRmxhdCAoZnM6IEZpbHRlclNjaGVtYSkge1xuICBpZiAoIWZzKSByZXR1cm5cbiAgcmV0dXJuIGZzLnR5cGU9PT0nZGF0ZScgJiYgZnMuZGF0ZS50eXBlPT09J2xhc3RUaW1lRW51bScgJiYgZnMuZGF0ZS5sYXN0VGltZURpc3BsYXlUeXBlPT09J2ZsYXQnXG4gICAgfHwgZnMudHlwZT09PSdlbnVtJyAmJiAhZnMuZW51bS5tdWx0aSAmJiBmcy5lbnVtLmRpc3BsYXlUeXBlPT09J2ZsYXQnXG59XG5cbi8qKlxuICog5a6Y5pa56aKE5Yi255qE562b6YCJIHByb3BlcnR5XG4gKi9cbmV4cG9ydCBjb25zdCBGSUxURVJfUFJPUF9OQU1FID0gJ2ZpbHRlcidcbmV4cG9ydCBjb25zdCBmcm9udGVuZEZpbHRlclByb3A6IFByb3BlcnR5T3B0aW9uID0ge1xuICBuYW1lOiBGSUxURVJfUFJPUF9OQU1FLFxuICBkaXNwbGF5TmFtZTogJ+etm+mAiScsXG4gIGlzQXJyYXk6IHRydWUsXG4gIHR5cGU6IFByb3BlcnR5VHlwZXMuT2JqZWN0LFxuICBvYmplY3RPcHRpb246IHtcbiAgICBvYmpQcm9wZXJ0eU9wdGlvbnM6IFt7XG4gICAgICBuYW1lOiAnZnMnLFxuICAgICAgdHlwZTogUHJvcGVydHlUeXBlcy5GaWx0ZXIsXG4gICAgfSwge1xuICAgICAgbmFtZTogJ2RwSWQnLFxuICAgICAgdHlwZTogUHJvcGVydHlUeXBlcy5EYXRhUGFyYW0sXG4gICAgfSwge1xuICAgICAgbmFtZTogJ2RwSWQyJyxcbiAgICAgIHR5cGU6IFByb3BlcnR5VHlwZXMuRGF0YVBhcmFtLFxuICAgICAgaWZTaG93OiBwdiA9PiB7XG4gICAgICAgIHJldHVybiBwdi5mcyAmJiBpZkZzRGF0ZVJhbmdlKHB2LmZzKVxuICAgICAgfVxuICAgIH1dXG4gIH1cbn1cbmV4cG9ydCBpbnRlcmZhY2UgRmlsdGVyQ29uZmlnIHtcbiAgZnM6IEZpbHRlclNjaGVtYVxuICBkcElkOiBzdHJpbmdcbiAgZHBJZDI6IHN0cmluZ1xufVxuIl19
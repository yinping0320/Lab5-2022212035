/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import add from "date-fns/add";
import sub from 'date-fns/sub';
import { PropertyTypes } from "../types";
/**
 * 没发直接用 [] 作 key 直接建 literal 对象，aot 编译会报错
 * @param {?} key
 * @param {?} value
 * @return {?}
 */
export function getObj(key, value) {
    /** @type {?} */
    var obj = {};
    obj[key] = value;
    return obj;
}
/**
 * 筛选描述
 */
var /**
 * 筛选描述
 */
FSLastTimeItem = /** @class */ (function () {
    function FSLastTimeItem() {
        this.num = 1;
        this.unit = 'day';
    }
    /**
     * 传入一个 '最近n某'，返回对应的时间范围数组
     */
    /**
     * 传入一个 '最近n某'，返回对应的时间范围数组
     * @param {?} lastTimeItem
     * @return {?}
     */
    FSLastTimeItem.GetDates = /**
     * 传入一个 '最近n某'，返回对应的时间范围数组
     * @param {?} lastTimeItem
     * @return {?}
     */
    function (lastTimeItem) {
        return [
            sub(new Date(), getObj(lastTimeItem.unit + 's', lastTimeItem.num)),
            new Date()
        ];
    };
    return FSLastTimeItem;
}());
/**
 * 筛选描述
 */
export { FSLastTimeItem };
if (false) {
    /** @type {?} */
    FSLastTimeItem.prototype.num;
    /** @type {?} */
    FSLastTimeItem.prototype.unit;
    /** @type {?} */
    FSLastTimeItem.prototype.isDefault;
}
var FSRangeDefault = /** @class */ (function () {
    function FSRangeDefault() {
        this.beforeNum = 1;
        this.beforeUnit = 'month';
        this.afterNum = 0;
        this.afterUnit = 'day';
    }
    /**
     * @param {?} rangeDefault
     * @return {?}
     */
    FSRangeDefault.GetDates = /**
     * @param {?} rangeDefault
     * @return {?}
     */
    function (rangeDefault) {
        return [
            sub(new Date(), getObj(rangeDefault.beforeUnit + 's', rangeDefault.afterNum)),
            add(new Date(), getObj(rangeDefault.beforeUnit + 's', rangeDefault.afterNum)),
        ];
    };
    return FSRangeDefault;
}());
export { FSRangeDefault };
if (false) {
    /** @type {?} */
    FSRangeDefault.prototype.beforeNum;
    /** @type {?} */
    FSRangeDefault.prototype.beforeUnit;
    /** @type {?} */
    FSRangeDefault.prototype.afterNum;
    /** @type {?} */
    FSRangeDefault.prototype.afterUnit;
}
var FSDate = /** @class */ (function () {
    function FSDate() {
        this.type = 'single';
        this.singleUnit = 'day';
        this.singleDefaultType = 'current';
        this.singleDefaultSpecified = new Date();
        this.rangeDefault = new FSRangeDefault();
        this.lastTimeItems = [];
        this.lastTimeDisplayType = 'flat';
    }
    return FSDate;
}());
export { FSDate };
if (false) {
    /** @type {?} */
    FSDate.prototype.type;
    /** @type {?} */
    FSDate.prototype.singleUnit;
    /** @type {?} */
    FSDate.prototype.singleDefaultType;
    /** @type {?} */
    FSDate.prototype.singleDefaultSpecified;
    /** @type {?} */
    FSDate.prototype.rangeDefault;
    /** @type {?} */
    FSDate.prototype.lastTimeItems;
    /** @type {?} */
    FSDate.prototype.lastTimeDisplayType;
}
var FSEnum = /** @class */ (function () {
    function FSEnum() {
        this.multi = false;
        /**
         * 暂时定为，仅有 single 时可以选择 flat
         */
        this.displayType = 'select';
        this.source = 'manual';
        /**
         * 是否可清空不选。仅有 select 且 single 才有此选项
         */
        this.allowEmpty = false;
        /**
         * 通过上面两个字段取出 items 存在下面
         */
        this.itemsFromData = [];
        this.itemsManual = [];
        this.multiDefault = [];
    }
    // 暂时不做
    // sourceDatasetId: string
    // sourceDatasetLabelField?: DataField
    // sourceDatasetValueField?: DataField
    // 暂时不做
    // sourceDatasetId: string
    // sourceDatasetLabelField?: DataField
    // sourceDatasetValueField?: DataField
    /**
     * @param {?} fsEnum
     * @return {?}
     */
    FSEnum.GetItems = 
    // 暂时不做
    // sourceDatasetId: string
    // sourceDatasetLabelField?: DataField
    // sourceDatasetValueField?: DataField
    /**
     * @param {?} fsEnum
     * @return {?}
     */
    function (fsEnum) {
        var source = fsEnum.source, itemsFromData = fsEnum.itemsFromData, itemsManual = fsEnum.itemsManual;
        if (source === 'dataField') {
            // if (!itemsValueField || !intactData) return []
            // const tempItems = intactData.map(dataItem => ({
            //   label: dataItem[itemsLabelField || itemsValueField],
            //   value: dataItem[itemsValueField]
            // }))
            // return ArrUtil.Unique(tempItems)
            return itemsFromData;
        }
        else if (source === 'manual') {
            return itemsManual;
        }
    };
    /**
     * @param {?} fsEnum
     * @return {?}
     */
    FSEnum.GetItemValues = /**
     * @param {?} fsEnum
     * @return {?}
     */
    function (fsEnum) {
        /**
         * @param {?} item
         * @return {?}
         */
        function mapCb(item) { return item.value; }
        return FSEnum.GetItems(fsEnum).map(mapCb);
    };
    return FSEnum;
}());
export { FSEnum };
if (false) {
    /** @type {?} */
    FSEnum.prototype.multi;
    /**
     * 暂时定为，仅有 single 时可以选择 flat
     * @type {?}
     */
    FSEnum.prototype.displayType;
    /** @type {?} */
    FSEnum.prototype.source;
    /**
     * 是否可清空不选。仅有 select 且 single 才有此选项
     * @type {?}
     */
    FSEnum.prototype.allowEmpty;
    /** @type {?} */
    FSEnum.prototype.itemsLabelField;
    /** @type {?} */
    FSEnum.prototype.itemsValueField;
    /**
     * 通过上面两个字段取出 items 存在下面
     * @type {?}
     */
    FSEnum.prototype.itemsFromData;
    /** @type {?} */
    FSEnum.prototype.itemsManual;
    /** @type {?} */
    FSEnum.prototype.multiDefault;
    /** @type {?} */
    FSEnum.prototype.singleDefault;
}
var FSEnumItem = /** @class */ (function () {
    function FSEnumItem() {
    }
    return FSEnumItem;
}());
export { FSEnumItem };
if (false) {
    /** @type {?} */
    FSEnumItem.prototype.label;
    /** @type {?} */
    FSEnumItem.prototype.value;
}
var FilterSchema = /** @class */ (function () {
    function FilterSchema() {
        /**
         * 过滤名称，在筛选控件上显示，可选
         */
        this.i18nName = {};
        this.showName = false;
        /**
         * 过滤大类
         */
        this.type = 'date';
        /**
         * 每种类型的过滤配置
         */
        this.date = new FSDate();
        this.enum = new FSEnum();
        this.number = {
            default: 0
        };
        this.text = {
            default: ''
        };
    }
    /**
     * 获取 FS 的默认值
     * 🙅 不可以依赖 data：部件第一次根据默认值筛选时，还没有 data 呢。
     */
    /**
     * 获取 FS 的默认值
     * 🙅 不可以依赖 data：部件第一次根据默认值筛选时，还没有 data 呢。
     * @param {?} fs
     * @return {?}
     */
    FilterSchema.getDefaultValue = /**
     * 获取 FS 的默认值
     * 🙅 不可以依赖 data：部件第一次根据默认值筛选时，还没有 data 呢。
     * @param {?} fs
     * @return {?}
     */
    function (fs) {
        switch (fs.type) {
            case 'date':
                if (fs.date.type === 'single') {
                    if (fs.date.singleDefaultType === 'current') {
                        return new Date();
                    }
                    else {
                        return fs.date.singleDefaultSpecified;
                    }
                }
                else if (fs.date.type === 'range') {
                    return FSRangeDefault.GetDates(fs.date.rangeDefault);
                }
                else if (fs.date.type === 'lastTimeEnum') {
                    return FSLastTimeItem.GetDates(fs.date.lastTimeItems[0]);
                }
                break;
            case 'enum':
                var _a = fs.enum, multi = _a.multi, singleDefault = _a.singleDefault, multiDefault = _a.multiDefault;
                return multi ? multiDefault : singleDefault;
            case 'number':
                return fs.number.default;
                break;
            case 'text':
                return fs.text.default;
                break;
        }
    };
    return FilterSchema;
}());
export { FilterSchema };
if (false) {
    /**
     * 过滤名称，在筛选控件上显示，可选
     * @type {?}
     */
    FilterSchema.prototype.i18nName;
    /** @type {?} */
    FilterSchema.prototype.showName;
    /**
     * 过滤大类
     * @type {?}
     */
    FilterSchema.prototype.type;
    /**
     * 每种类型的过滤配置
     * @type {?}
     */
    FilterSchema.prototype.date;
    /** @type {?} */
    FilterSchema.prototype.enum;
    /** @type {?} */
    FilterSchema.prototype.help;
    /** @type {?} */
    FilterSchema.prototype.number;
    /** @type {?} */
    FilterSchema.prototype.text;
}
/**
 * @param {?} fs
 * @return {?}
 */
export function ifFsDateRange(fs) {
    if (!fs)
        return;
    return fs.type === 'date' && fs.date.type === 'range';
}
/**
 * @param {?} fs
 * @return {?}
 */
export function isFsFlat(fs) {
    if (!fs)
        return;
    return fs.type === 'date' && fs.date.type === 'lastTimeEnum' && fs.date.lastTimeDisplayType === 'flat'
        || fs.type === 'enum' && !fs.enum.multi && fs.enum.displayType === 'flat';
}
/**
 * 官方预制的筛选 property
 * @type {?}
 */
export var FILTER_PROP_NAME = 'filter';
/** @type {?} */
export var frontendFilterProp = {
    name: FILTER_PROP_NAME,
    displayName: '筛选',
    isArray: true,
    type: PropertyTypes.Object,
    objectOption: {
        objPropertyOptions: [{
                name: 'fs',
                type: PropertyTypes.Filter,
            }, {
                name: 'dpId',
                type: PropertyTypes.DataParam,
            }, {
                name: 'dpId2',
                type: PropertyTypes.DataParam,
                ifShow: (/**
                 * @param {?} pv
                 * @return {?}
                 */
                function (pv) {
                    return pv.fs && ifFsDateRange(pv.fs);
                })
            }]
    }
};
/**
 * @record
 */
export function FilterConfig() { }
if (false) {
    /** @type {?} */
    FilterConfig.prototype.fs;
    /** @type {?} */
    FilterConfig.prototype.dpId;
    /** @type {?} */
    FilterConfig.prototype.dpId2;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmlsdGVyLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGdzcHdpZGdldC93aWRnZXQtZGV2a2l0LyIsInNvdXJjZXMiOlsibGliL2ZpbHRlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxHQUFHLE1BQU0sY0FBYyxDQUFBO0FBQzlCLE9BQU8sR0FBRyxNQUFNLGNBQWMsQ0FBQTtBQUM5QixPQUFPLEVBQWtCLGFBQWEsRUFBRSxNQUFNLFVBQVUsQ0FBQTs7Ozs7OztBQUt4RCxNQUFNLFVBQVUsTUFBTSxDQUFFLEdBQVcsRUFBRSxLQUFhOztRQUMxQyxHQUFHLEdBQUcsRUFBRTtJQUNkLEdBQUcsQ0FBQyxHQUFHLENBQUMsR0FBRyxLQUFLLENBQUE7SUFDaEIsT0FBTyxHQUFHLENBQUE7QUFDWixDQUFDOzs7O0FBR0Q7Ozs7SUFBQTtRQUNFLFFBQUcsR0FBRyxDQUFDLENBQUE7UUFDUCxTQUFJLEdBQWdCLEtBQUssQ0FBQTtJQVczQixDQUFDO0lBVEM7O09BRUc7Ozs7OztJQUNLLHVCQUFROzs7OztJQUFoQixVQUFrQixZQUE0QjtRQUM1QyxPQUFPO1lBQ0wsR0FBRyxDQUFDLElBQUksSUFBSSxFQUFFLEVBQUUsTUFBTSxDQUFDLFlBQVksQ0FBQyxJQUFJLEdBQUcsR0FBRyxFQUFFLFlBQVksQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUNsRSxJQUFJLElBQUksRUFBRTtTQUNYLENBQUE7SUFDSCxDQUFDO0lBQ0gscUJBQUM7QUFBRCxDQUFDLEFBYkQsSUFhQzs7Ozs7OztJQVpDLDZCQUFPOztJQUNQLDhCQUF5Qjs7SUFDekIsbUNBQW1COztBQVdyQjtJQUFBO1FBQ0UsY0FBUyxHQUFHLENBQUMsQ0FBQTtRQUNiLGVBQVUsR0FBZSxPQUFPLENBQUE7UUFDaEMsYUFBUSxHQUFHLENBQUMsQ0FBQTtRQUNaLGNBQVMsR0FBZSxLQUFLLENBQUE7SUFPL0IsQ0FBQzs7Ozs7SUFOUSx1QkFBUTs7OztJQUFmLFVBQWlCLFlBQTRCO1FBQzNDLE9BQU87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Q1osa0JBQWtCLEVBQUUsQ0FBQztnQkFDbkIsSUFBSSxFQUFFLElBQUk7Z0JBQ1YsSUFBSSxFQUFFLGFBQWEsQ0FBQyxNQUFNO2FBQzNCLEVBQUU7Z0JBQ0QsSUFBSSxFQUFFLE1BQU07Z0JBQ1osSUFBSSxFQUFFLGFBQWEsQ0FBQyxTQUFTO2FBQzlCLEVBQUU7Z0JBQ0QsSUFBSSxFQUFFLE9BQU87Z0JBQ2IsSUFBSSxFQUFFLGFBQWEsQ0FBQyxTQUFTO2dCQUM3QixNQUFNOzs7O2dCQUFFLFVBQUEsRUFBRTtvQkFDUixPQUFPLEVBQUUsQ0FBQyxFQUFFLElBQUksYUFBYSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQTtnQkFDdEMsQ0FBQyxDQUFBO2FBQ0YsQ0FBQztLQUNIO0NBQ0Y7Ozs7QUFDRCxrQ0FJQzs7O0lBSEMsMEJBQWdCOztJQUNoQiw0QkFBWTs7SUFDWiw2QkFBYSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBhZGQgZnJvbSBcImRhdGUtZm5zL2FkZFwiXG5pbXBvcnQgc3ViIGZyb20gJ2RhdGUtZm5zL3N1YidcbmltcG9ydCB7IFByb3BlcnR5T3B0aW9uLCBQcm9wZXJ0eVR5cGVzIH0gZnJvbSBcIi4uL3R5cGVzXCJcblxuLyoqXG4gKiDmsqHlj5Hnm7TmjqXnlKggW10g5L2cIGtleSDnm7TmjqXlu7ogbGl0ZXJhbCDlr7nosaHvvIxhb3Qg57yW6K+R5Lya5oql6ZSZXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZXRPYmogKGtleTogc3RyaW5nLCB2YWx1ZTogbnVtYmVyKSB7XG4gIGNvbnN0IG9iaiA9IHt9XG4gIG9ialtrZXldID0gdmFsdWVcbiAgcmV0dXJuIG9ialxufVxuZXhwb3J0IHR5cGUgRlNEYXRlVW5pdCA9ICd5ZWFyJyB8ICdtb250aCcgfCAnZGF5J1xuLyoqIOetm+mAieaPj+i/sCAqL1xuZXhwb3J0IGNsYXNzIEZTTGFzdFRpbWVJdGVtIHtcbiAgbnVtID0gMVxuICB1bml0PzogRlNEYXRlVW5pdCA9ICdkYXknXG4gIGlzRGVmYXVsdD86IGJvb2xlYW5cbiAgLyoqXG4gICAqIOS8oOWFpeS4gOS4qiAn5pyA6L+RbuafkCfvvIzov5Tlm57lr7nlupTnmoTml7bpl7TojIPlm7TmlbDnu4RcbiAgICovXG4gIHN0YXRpYyAgR2V0RGF0ZXMgKGxhc3RUaW1lSXRlbTogRlNMYXN0VGltZUl0ZW0pIHtcbiAgICByZXR1cm4gW1xuICAgICAgc3ViKG5ldyBEYXRlKCksIGdldE9iaihsYXN0VGltZUl0ZW0udW5pdCArICdzJywgbGFzdFRpbWVJdGVtLm51bSkpLFxuICAgICAgbmV3IERhdGUoKVxuICAgIF1cbiAgfVxufVxuZXhwb3J0IGNsYXNzIEZTUmFuZ2VEZWZhdWx0IHtcbiAgYmVmb3JlTnVtID0gMVxuICBiZWZvcmVVbml0OiBGU0RhdGVVbml0ID0gJ21vbnRoJ1xuICBhZnRlck51bSA9IDBcbiAgYWZ0ZXJVbml0OiBGU0RhdGVVbml0ID0gJ2RheSdcbiAgc3RhdGljIEdldERhdGVzIChyYW5nZURlZmF1bHQ6IEZTUmFuZ2VEZWZhdWx0KSB7XG4gICAgcmV0dXJuIFtcbiAgICAgIHN1YihuZXcgRGF0ZSgpLCBnZXRPYmoocmFuZ2VEZWZhdWx0LmJlZm9yZVVuaXQgKyAncycsIHJhbmdlRGVmYXVsdC5hZnRlck51bSkpLFxuICAgICAgYWRkKG5ldyBEYXRlKCksIGdldE9iaihyYW5nZURlZmF1bHQuYmVmb3JlVW5pdCArICdzJywgcmFuZ2VEZWZhdWx0LmFmdGVyTnVtKSksXG4gICAgXVxuICB9XG59XG5leHBvcnQgY2xhc3MgRlNEYXRlIHtcbiAgdHlwZT86ICdzaW5nbGUnIHwgJ3JhbmdlJyB8ICdsYXN0VGltZUVudW0nID0gJ3NpbmdsZSdcbiAgc2luZ2xlVW5pdD86IEZTRGF0ZVVuaXQgPSAnZGF5J1xuICBzaW5nbGVEZWZhdWx0VHlwZT86ICdjdXJyZW50JyB8ICdzcGVjaWZpZWQnID0gJ2N1cnJlbnQnXG4gIHNpbmdsZURlZmF1bHRTcGVjaWZpZWQgPSBuZXcgRGF0ZSgpXG4gIHJhbmdlRGVmYXVsdCA9IG5ldyBGU1JhbmdlRGVmYXVsdCgpXG4gIGxhc3RUaW1lSXRlbXM/OiBGU0xhc3RUaW1lSXRlbVtdID0gW11cbiAgbGFzdFRpbWVEaXNwbGF5VHlwZT86ICdzZWxlY3QnIHwgJ2ZsYXQnID0gJ2ZsYXQnXG59XG5leHBvcnQgdHlwZSBGU0VudW1Tb3VyY2UgPSAnZGF0YUZpZWxkJyB8ICdtYW51YWwnIHwgJ2RhdGFzZXQnXG5leHBvcnQgY2xhc3MgRlNFbnVtIHtcbiAgbXVsdGkgPSBmYWxzZVxuICAvKiog5pqC5pe25a6a5Li677yM5LuF5pyJIHNpbmdsZSDml7blj6/ku6XpgInmi6kgZmxhdCAqL1xuICBkaXNwbGF5VHlwZT86ICdzZWxlY3QnIHwgJ2ZsYXQnID0gJ3NlbGVjdCdcbiAgc291cmNlPzogRlNFbnVtU291cmNlID0gJ21hbnVhbCdcbiAgLyoqIOaYr+WQpuWPr+a4heepuuS4jemAieOAguS7heaciSBzZWxlY3Qg5LiUIHNpbmdsZSDmiY3mnInmraTpgInpobkgKi9cbiAgYWxsb3dFbXB0eSA9IGZhbHNlXG4gIC8vIFRPRE86IOS4i+mdouS4pOS4quWtl+auteS7heeUqOS9nOS4i+asoee8lui+keaXtuaYvuekuuWQp+OAglxuICBpdGVtc0xhYmVsRmllbGQ/OiBzdHJpbmdcbiAgaXRlbXNWYWx1ZUZpZWxkPzogc3RyaW5nXG4gIC8qKiDpgJrov4fkuIrpnaLkuKTkuKrlrZfmrrXlj5blh7ogaXRlbXMg5a2Y5Zyo5LiL6Z2iICovXG4gIGl0ZW1zRnJvbURhdGE/OiBGU0VudW1JdGVtW10gPSBbXVxuICBpdGVtc01hbnVhbD86IEZTRW51bUl0ZW1bXSA9IFtdXG4gIG11bHRpRGVmYXVsdDogc3RyaW5nW10gPSBbXVxuICBzaW5nbGVEZWZhdWx0OiBzdHJpbmdcbiAgLy8g5pqC5pe25LiN5YGaXG4gIC8vIHNvdXJjZURhdGFzZXRJZDogc3RyaW5nXG4gIC8vIHNvdXJjZURhdGFzZXRMYWJlbEZpZWxkPzogRGF0YUZpZWxkXG4gIC8vIHNvdXJjZURhdGFzZXRWYWx1ZUZpZWxkPzogRGF0YUZpZWxkXG4gIHN0YXRpYyBHZXRJdGVtcyAoZnNFbnVtOiBGU0VudW0pOiBGU0VudW1JdGVtW10ge1xuICAgIGNvbnN0IHtcbiAgICAgIHNvdXJjZSwgaXRlbXNGcm9tRGF0YSwgaXRlbXNNYW51YWxcbiAgICB9ID0gZnNFbnVtXG4gICAgaWYgKHNvdXJjZSA9PT0gJ2RhdGFGaWVsZCcpIHtcbiAgICAgIC8vIGlmICghaXRlbXNWYWx1ZUZpZWxkIHx8ICFpbnRhY3REYXRhKSByZXR1cm4gW11cbiAgICAgIC8vIGNvbnN0IHRlbXBJdGVtcyA9IGludGFjdERhdGEubWFwKGRhdGFJdGVtID0+ICh7XG4gICAgICAvLyAgIGxhYmVsOiBkYXRhSXRlbVtpdGVtc0xhYmVsRmllbGQgfHwgaXRlbXNWYWx1ZUZpZWxkXSxcbiAgICAgIC8vICAgdmFsdWU6IGRhdGFJdGVtW2l0ZW1zVmFsdWVGaWVsZF1cbiAgICAgIC8vIH0pKVxuICAgICAgLy8gcmV0dXJuIEFyclV0aWwuVW5pcXVlKHRlbXBJdGVtcylcbiAgICAgIHJldHVybiBpdGVtc0Zyb21EYXRhXG4gICAgfSBlbHNlIGlmIChzb3VyY2UgPT09ICdtYW51YWwnKSB7XG4gICAgICByZXR1cm4gaXRlbXNNYW51YWxcbiAgICB9XG4gIH1cbiAgc3RhdGljIEdldEl0ZW1WYWx1ZXMgKGZzRW51bTogRlNFbnVtKSB7XG4gICAgZnVuY3Rpb24gbWFwQ2IgKGl0ZW0pIHsgcmV0dXJuIGl0ZW0udmFsdWUgfVxuICAgIHJldHVybiBGU0VudW0uR2V0SXRlbXMoZnNFbnVtKS5tYXAobWFwQ2IpXG4gIH1cbn1cbmV4cG9ydCBjbGFzcyBGU0VudW1JdGVtIHtcbiAgbGFiZWw6IHN0cmluZ1xuICB2YWx1ZTogc3RyaW5nXG59XG5leHBvcnQgY2xhc3MgRmlsdGVyU2NoZW1hIHtcbiAgLyoqIOi/h+a7pOWQjeensO+8jOWcqOetm+mAieaOp+S7tuS4iuaYvuekuu+8jOWPr+mAiSAqL1xuICBpMThuTmFtZTogYW55ID0ge31cbiAgc2hvd05hbWUgPSBmYWxzZVxuICAvKiog6L+H5ruk5aSn57G7ICovXG4gIHR5cGU/OiAnZGF0ZScgfCAnZW51bScgfCAnbnVtYmVyJyB8ICd0ZXh0JyB8ICdoZWxwJyA9ICdkYXRlJ1xuICAvKiog5q+P56eN57G75Z6L55qE6L+H5ruk6YWN572uICovXG4gIGRhdGUgPSBuZXcgRlNEYXRlKClcbiAgZW51bSA9IG5ldyBGU0VudW0oKVxuICBoZWxwPzoge31cbiAgbnVtYmVyID0ge1xuICAgIGRlZmF1bHQ6IDBcbiAgfVxuICB0ZXh0ID0ge1xuICAgIGRlZmF1bHQ6ICcnXG4gIH1cbiAgLyoqXG4gICAqIOiOt+WPliBGUyDnmoTpu5jorqTlgLxcbiAgICog8J+ZhSDkuI3lj6/ku6Xkvp3otZYgZGF0Ye+8mumDqOS7tuesrOS4gOasoeagueaNrum7mOiupOWAvOetm+mAieaXtu+8jOi/mOayoeaciSBkYXRhIOWRouOAglxuICAgKi9cbiAgc3RhdGljIGdldERlZmF1bHRWYWx1ZSAoZnM6IEZpbHRlclNjaGVtYSkge1xuICAgIHN3aXRjaCAoZnMudHlwZSkge1xuICAgICAgY2FzZSAnZGF0ZSc6XG4gICAgICAgIGlmIChmcy5kYXRlLnR5cGUgPT09ICdzaW5nbGUnKSB7XG4gICAgICAgICAgaWYgKGZzLmRhdGUuc2luZ2xlRGVmYXVsdFR5cGUgPT09ICdjdXJyZW50Jykge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBEYXRlKClcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIGZzLmRhdGUuc2luZ2xlRGVmYXVsdFNwZWNpZmllZFxuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIGlmIChmcy5kYXRlLnR5cGUgPT09ICdyYW5nZScpIHtcbiAgICAgICAgICByZXR1cm4gRlNSYW5nZURlZmF1bHQuR2V0RGF0ZXMoZnMuZGF0ZS5yYW5nZURlZmF1bHQpXG4gICAgICAgIH0gZWxzZSBpZiAoZnMuZGF0ZS50eXBlID09PSAnbGFzdFRpbWVFbnVtJykge1xuICAgICAgICAgIHJldHVybiBGU0xhc3RUaW1lSXRlbS5HZXREYXRlcyhmcy5kYXRlLmxhc3RUaW1lSXRlbXNbMF0pXG4gICAgICAgIH1cbiAgICAgICAgYnJlYWtcbiAgICAgIGNhc2UgJ2VudW0nOlxuICAgICAgICBjb25zdCB7IG11bHRpLCBzaW5nbGVEZWZhdWx0LCBtdWx0aURlZmF1bHQgfSA9IGZzLmVudW1cbiAgICAgICAgcmV0dXJuIG11bHRpID8gbXVsdGlEZWZhdWx0IDogc2luZ2xlRGVmYXVsdFxuICAgICAgY2FzZSAnbnVtYmVyJzpcbiAgICAgICAgcmV0dXJuIGZzLm51bWJlci5kZWZhdWx0XG4gICAgICAgIGJyZWFrXG4gICAgICBjYXNlICd0ZXh0JzpcbiAgICAgICAgcmV0dXJuIGZzLnRleHQuZGVmYXVsdFxuICAgICAgICBicmVha1xuICAgIH1cbiAgfVxufVxuZXhwb3J0IGZ1bmN0aW9uIGlmRnNEYXRlUmFuZ2UgKGZzOiBGaWx0ZXJTY2hlbWEpIHtcbiAgaWYgKCFmcykgcmV0dXJuXG4gIHJldHVybiBmcy50eXBlID09PSAnZGF0ZScgJiYgZnMuZGF0ZS50eXBlID09PSAncmFuZ2UnXG59XG5leHBvcnQgZnVuY3Rpb24gaXNGc0ZsYXQgKGZzOiBGaWx0ZXJTY2hlbWEpIHtcbiAgaWYgKCFmcykgcmV0dXJuXG4gIHJldHVybiBmcy50eXBlPT09J2RhdGUnICYmIGZzLmRhdGUudHlwZT09PSdsYXN0VGltZUVudW0nICYmIGZzLmRhdGUubGFzdFRpbWVEaXNwbGF5VHlwZT09PSdmbGF0J1xuICAgIHx8IGZzLnR5cGU9PT0nZW51bScgJiYgIWZzLmVudW0ubXVsdGkgJiYgZnMuZW51bS5kaXNwbGF5VHlwZT09PSdmbGF0J1xufVxuXG4vKipcbiAqIOWumOaWuemihOWItueahOetm+mAiSBwcm9wZXJ0eVxuICovXG5leHBvcnQgY29uc3QgRklMVEVSX1BST1BfTkFNRSA9ICdmaWx0ZXInXG5leHBvcnQgY29uc3QgZnJvbnRlbmRGaWx0ZXJQcm9wOiBQcm9wZXJ0eU9wdGlvbiA9IHtcbiAgbmFtZTogRklMVEVSX1BST1BfTkFNRSxcbiAgZGlzcGxheU5hbWU6ICfnrZvpgIknLFxuICBpc0FycmF5OiB0cnVlLFxuICB0eXBlOiBQcm9wZXJ0eVR5cGVzLk9iamVjdCxcbiAgb2JqZWN0T3B0aW9uOiB7XG4gICAgb2JqUHJvcGVydHlPcHRpb25zOiBbe1xuICAgICAgbmFtZTogJ2ZzJyxcbiAgICAgIHR5cGU6IFByb3BlcnR5VHlwZXMuRmlsdGVyLFxuICAgIH0sIHtcbiAgICAgIG5hbWU6ICdkcElkJyxcbiAgICAgIHR5cGU6IFByb3BlcnR5VHlwZXMuRGF0YVBhcmFtLFxuICAgIH0sIHtcbiAgICAgIG5hbWU6ICdkcElkMicsXG4gICAgICB0eXBlOiBQcm9wZXJ0eVR5cGVzLkRhdGFQYXJhbSxcbiAgICAgIGlmU2hvdzogcHYgPT4ge1xuICAgICAgICByZXR1cm4gcHYuZnMgJiYgaWZGc0RhdGVSYW5nZShwdi5mcylcbiAgICAgIH1cbiAgICB9XVxuICB9XG59XG5leHBvcnQgaW50ZXJmYWNlIEZpbHRlckNvbmZpZyB7XG4gIGZzOiBGaWx0ZXJTY2hlbWFcbiAgZHBJZDogc3RyaW5nXG4gIGRwSWQyOiBzdHJpbmdcbn1cbiJdfQ==
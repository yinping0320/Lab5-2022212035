import * as tslib_1 from "tslib";
var _a;
/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Injectable } from '@angular/core';
import { PlThemeColors } from '@gspwidget/util';
import { PropertyTypes } from '../../types';
import { FilterSchema, frontendFilterProp } from '../filter';
import { datalessJumpOption } from '../preset/preset.jump';
// import { WidgetPropertyMap } from './widget-event.decorator';
import { WidgetRegistry } from './widget-registry';
import { WidgetBase } from '../WidgetBase';
import { WidgetPropertyMap } from './widget-property.decorator';
import * as i0 from "@angular/core";
/** @type {?} */
var PropertyTypeDefaultValues = (_a = {},
    _a[PropertyTypes.Text] = '',
    _a[PropertyTypes.Bool] = false,
    _a[PropertyTypes.Number] = 0,
    _a[PropertyTypes.DataField] = {},
    _a)
// const frontendFilterProp: PropertyOption = {
//   name: 'filter',
//   displayName: '筛选',
//   isArray: true,
//   type: PropertyTypes.Filter,
// }
// TODO: filters
;
// const frontendFilterProp: PropertyOption = {
//   name: 'filter',
//   displayName: '筛选',
//   isArray: true,
//   type: PropertyTypes.Filter,
// }
// TODO: filters
/** @type {?} */
var titleBarProps = [{
        category: 'titleBar',
        name: 'titleBarHide',
        type: PropertyTypes.Bool,
        boolOption: {
            default: false
        }
    }, {
        category: 'titleBar',
        name: 'titleBarShowRefresh',
        displayName: 'showRefreshBtn',
        type: PropertyTypes.Bool,
        boolOption: {
            default: true
        }
    }, tslib_1.__assign({}, datalessJumpOption, { category: 'titleBar', name: 'titleBarJump' })];
var WidgetPropertyService = /** @class */ (function () {
    function WidgetPropertyService() {
    }
    /**
     * 获得某种类型的全局默认值，在完全没有值时使用
     * @param prop
     * @param arrayItem 是否是来获取 array 的子项默认值的，默认不是。
     * 如果不是，若 prop.isArray 为真，就返回空数组 []；
     * 如果是，则不管 prop.isArray 是否为真，总返回 prop.type 对应的默认值，仅应用于增加数组项时获取新项。
     */
    /**
     * 获得某种类型的全局默认值，在完全没有值时使用
     * @param {?} prop
     * @param {?=} arrayItem 是否是来获取 array 的子项默认值的，默认不是。
     * 如果不是，若 prop.isArray 为真，就返回空数组 []；
     * 如果是，则不管 prop.isArray 是否为真，总返回 prop.type 对应的默认值，仅应用于增加数组项时获取新项。
     * @return {?}
     */
    WidgetPropertyService.prototype.getPropertyDefaultValue = /**
     * 获得某种类型的全局默认值，在完全没有值时使用
     * @param {?} prop
     * @param {?=} arrayItem 是否是来获取 array 的子项默认值的，默认不是。
     * 如果不是，若 prop.isArray 为真，就返回空数组 []；
     * 如果是，则不管 prop.isArray 是否为真，总返回 prop.type 对应的默认值，仅应用于增加数组项时获取新项。
     * @return {?}
     */
    function (prop, arrayItem) {
        var _this = this;
        if (arrayItem === void 0) { arrayItem = false; }
        if (!arrayItem && prop.isArray)
            return [];
        // object: 递归生成具有所有 key 的对象，每个 key 的 value 是默认值
        if (prop.type === PropertyTypes.Object) {
            /** @type {?} */
            var newObj_1 = {};
            prop.objectOption.objPropertyOptions.forEach((/**
             * @param {?} childProp
             * @return {?}
             */
            function (childProp) {
                newObj_1[childProp.name] = (childProp[childProp.type]
                    && childProp[childProp.type].default)
                    || _this.getPropertyDefaultValue(childProp);
            }));
            return newObj_1;
        }
        else if (prop.type === PropertyTypes.Enum) {
            /** @type {?} */
            var firstItem = prop.enumOption.items[0];
            return typeof firstItem === 'string'
                ? firstItem
                : firstItem['value'];
        }
        else if (prop.type === PropertyTypes.Color) {
            /** @type {?} */
            var colors = this.getColorsByColorOption(prop.colorOption);
            /** @type {?} */
            var i = Math.random();
            return colors[Math.floor(i * colors.length)];
        }
        else if (prop.type === PropertyTypes.Filter) {
            return new FilterSchema();
        }
        else {
            return PropertyTypeDefaultValues[prop.type];
        }
    };
    /**
     * 元部件加载、编译完成后，组装新的 properties
     * widget name
     * -> constructor name
     * -> widget + title bar + base properties
     * -> 元部件的所有可配置 properties
     */
    /**
     * 元部件加载、编译完成后，组装新的 properties
     * widget name
     * -> constructor name
     * -> widget + title bar + base properties
     * -> 元部件的所有可配置 properties
     * @param {?} widgetName
     * @param {?} widgetConfig
     * @return {?}
     */
    WidgetPropertyService.prototype.getWidgetProps = /**
     * 元部件加载、编译完成后，组装新的 properties
     * widget name
     * -> constructor name
     * -> widget + title bar + base properties
     * -> 元部件的所有可配置 properties
     * @param {?} widgetName
     * @param {?} widgetConfig
     * @return {?}
     */
    function (widgetName, widgetConfig) {
        /** @type {?} */
        var ctorName = WidgetRegistry.getWidgetByName(widgetName).ctor.name
        // widget 子类中的 property
        ;
        // widget 子类中的 property
        /** @type {?} */
        var widgetProps = WidgetPropertyMap.get(ctorName) || []
        // 筛选出 widget 子类中没重写过的 property，否则可能会有俩一样的
        ;
        // 筛选出 widget 子类中没重写过的 property，否则可能会有俩一样的
        /** @type {?} */
        var baseProps = WidgetPropertyMap.get(WidgetBase.name)
            .filter((/**
         * @param {?} baseProp
         * @return {?}
         */
        function (baseProp) { return !widgetProps.some((/**
         * @param {?} prop
         * @return {?}
         */
        function (prop) { return baseProp.name === prop.name; })); }))
        // 组装
        ;
        // 组装
        return tslib_1.__spread(baseProps, (widgetConfig.enableCommonTitleBar
            ? titleBarProps
            : []), (widgetConfig.enableDataConfig && widgetConfig.enableCommonTitleBar
            ? [frontendFilterProp]
            : []), widgetProps
        // ...testProps,
        );
    };
    /**
     * mixin 已有pv + 元部件推荐的默认pv + 此类型的全局默认pv
     */
    /**
     * mixin 已有pv + 元部件推荐的默认pv + 此类型的全局默认pv
     * @param {?} props
     * @param {?} propValues
     * @return {?}
     */
    WidgetPropertyService.prototype.mixinWidgetPropValues = /**
     * mixin 已有pv + 元部件推荐的默认pv + 此类型的全局默认pv
     * @param {?} props
     * @param {?} propValues
     * @return {?}
     */
    function (props, propValues) {
        var _this = this;
        /** @type {?} */
        var mixinedPropValues = tslib_1.__assign({}, propValues)
        // 检查所有 properties，哪个没有值，就赋上默认推荐值
        ;
        // 检查所有 properties，哪个没有值，就赋上默认推荐值
        props.forEach((/**
         * @param {?} prop
         * @return {?}
         */
        function (prop) {
            // 这里必须是判断 undefined，否则 bool 类型的 false 也可能判定为无值
            if (mixinedPropValues[prop.name] === undefined) {
                mixinedPropValues[prop.name] = prop[prop.type] && prop[prop.type].default
                    // 如果元部件无默认值，就加入全局的当前类型默认值
                    || _this.getPropertyDefaultValue(prop);
            }
        }));
        return mixinedPropValues;
    };
    /**
     * @param {?} colorOption
     * @return {?}
     */
    WidgetPropertyService.prototype.getColorsByColorOption = /**
     * @param {?} colorOption
     * @return {?}
     */
    function (colorOption) {
        if (colorOption && colorOption.palette)
            return colorOption.palette;
        /** @type {?} */
        var colorType = colorOption ? colorOption.type : 'pure';
        /** @type {?} */
        var colors;
        switch (colorType) {
            case 'gradient':
                colors = PlThemeColors.gradient;
                break;
            case 'pureOrGradient':
                colors = tslib_1.__spread(PlThemeColors.pure, PlThemeColors.gradient);
                break;
            case 'pure':
            default:
                colors = PlThemeColors.pure;
                break;
        }
        return colors;
    };
    WidgetPropertyService.decorators = [
        { type: Injectable, args: [{
                    providedIn: 'root'
                },] }
    ];
    /** @nocollapse */
    WidgetPropertyService.ctorParameters = function () { return []; };
    /** @nocollapse */ WidgetPropertyService.ngInjectableDef = i0.defineInjectable({ factory: function WidgetPropertyService_Factory() { return new WidgetPropertyService(); }, token: WidgetPropertyService, providedIn: "root" });
    return WidgetPropertyService;
}());
export { WidgetPropertyService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2lkZ2V0LXByb3BlcnR5LnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZ3Nwd2lkZ2V0L3dpZGdldC1kZXZraXQvIiwic291cmNlcyI6WyJsaWIvd2lkZ2V0LXJlZ2lzdHJ5L3dpZGdldC1wcm9wZXJ0eS5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDM0MsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQ2hELE9BQU8sRUFBa0IsYUFBYSxFQUFnQixNQUFNLGFBQWEsQ0FBQztBQUMxRSxPQUFPLEVBQUUsWUFBWSxFQUFFLGtCQUFrQixFQUFpQixNQUFNLFdBQVcsQ0FBQztBQUM1RSxPQUFPLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQzs7QUFFM0QsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBQ25ELE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDM0MsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sNkJBQTZCLENBQUM7OztJQUUxRCx5QkFBeUI7SUFDN0IsR0FBQyxhQUFhLENBQUMsSUFBSSxJQUFHLEVBQUU7SUFDeEIsR0FBQyxhQUFhLENBQUMsSUFBSSxJQUFHLEtBQUs7SUFDM0IsR0FBQyxhQUFhLENBQUMsTUFBTSxJQUFHLENBQUM7SUFDekIsR0FBQyxhQUFhLENBQUMsU0FBUyxJQUFHLEVBQUU7T0FLOUI7QUFFRCwrQ0FBK0M7QUFDL0Msb0JBQW9CO0FBQ3BCLHVCQUF1QjtBQUN2QixtQkFBbUI7QUFDbkIsZ0NBQWdDO0FBQ2hDLElBQUk7QUFDSixnQkFBZ0I7Ozs7Ozs7Ozs7SUFHVixhQUFhLEdBQXFCLENBQUM7UUFDdkMsUUFBUSxFQUFFLFVBQVU7UUFDcEIsSUFBSSxFQUFFLGNBQWM7UUFDcEIsSUFBSSxFQUFFLGFBQWEsQ0FBQyxJQUFJO1FBQ3hC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R0FBRyxXQUFXLENBQUMsQ0FBQyxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLE1BQU07O1lBQ3JELE1BQU07UUFDVixRQUFRLFNBQVMsRUFBRTtZQUNqQixLQUFLLFVBQVU7Z0JBQ2IsTUFBTSxHQUFHLGFBQWEsQ0FBQyxRQUFRLENBQUE7Z0JBQy9CLE1BQUs7WUFDUCxLQUFLLGdCQUFnQjtnQkFDbkIsTUFBTSxvQkFBTyxhQUFhLENBQUMsSUFBSSxFQUFLLGFBQWEsQ0FBQyxRQUFRLENBQUMsQ0FBQTtnQkFDM0QsTUFBSztZQUNQLEtBQUssTUFBTSxDQUFDO1lBQ1o7Z0JBQ0UsTUFBTSxHQUFHLGFBQWEsQ0FBQyxJQUFJLENBQUE7Z0JBQzNCLE1BQUs7U0FDUjtRQUNELE9BQU8sTUFBTSxDQUFBO0lBQ2YsQ0FBQzs7Z0JBekdGLFVBQVUsU0FBQztvQkFDVixVQUFVLEVBQUUsTUFBTTtpQkFDbkI7Ozs7O2dDQXJERDtDQThKQyxBQTNHRCxJQTJHQztTQXhHWSxxQkFBcUIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBQbFRoZW1lQ29sb3JzIH0gZnJvbSAnQGdzcHdpZGdldC91dGlsJztcbmltcG9ydCB7IFByb3BlcnR5T3B0aW9uLCBQcm9wZXJ0eVR5cGVzLCBXaWRnZXRDb25maWcgfSBmcm9tICcuLi8uLi90eXBlcyc7XG5pbXBvcnQgeyBGaWx0ZXJTY2hlbWEsIGZyb250ZW5kRmlsdGVyUHJvcCwgaWZGc0RhdGVSYW5nZSB9IGZyb20gJy4uL2ZpbHRlcic7XG5pbXBvcnQgeyBkYXRhbGVzc0p1bXBPcHRpb24gfSBmcm9tICcuLi9wcmVzZXQvcHJlc2V0Lmp1bXAnO1xuLy8gaW1wb3J0IHsgV2lkZ2V0UHJvcGVydHlNYXAgfSBmcm9tICcuL3dpZGdldC1ldmVudC5kZWNvcmF0b3InO1xuaW1wb3J0IHsgV2lkZ2V0UmVnaXN0cnkgfSBmcm9tICcuL3dpZGdldC1yZWdpc3RyeSc7XG5pbXBvcnQgeyBXaWRnZXRCYXNlIH0gZnJvbSAnLi4vV2lkZ2V0QmFzZSc7XG5pbXBvcnQgeyBXaWRnZXRQcm9wZXJ0eU1hcCB9IGZyb20gJy4vd2lkZ2V0LXByb3BlcnR5LmRlY29yYXRvcic7XG5cbmNvbnN0IFByb3BlcnR5VHlwZURlZmF1bHRWYWx1ZXMgPSB7XG4gIFtQcm9wZXJ0eVR5cGVzLlRleHRdOiAnJyxcbiAgW1Byb3BlcnR5VHlwZXMuQm9vbF06IGZhbHNlLFxuICBbUHJvcGVydHlUeXBlcy5OdW1iZXJdOiAwLFxuICBbUHJvcGVydHlUeXBlcy5EYXRhRmllbGRdOiB7fVxuICAvLyBbUHJvcGVydHlUeXBlcy5Db2xvcl06ICcjMDAwMDAwJyxcbiAgLy8gW1Byb3BlcnR5VHlwZXMuRW51bV06IDAsXG4gIC8vIFtQcm9wZXJ0eVR5cGVzLkRhdGVdOiBuZXcgRGF0ZSgpXG4gIC8vIFtQcm9wZXJ0eVR5cGVzLk9iamVjdF06IHt9LFxufVxuXG4vLyBjb25zdCBmcm9udGVuZEZpbHRlclByb3A6IFByb3BlcnR5T3B0aW9uID0ge1xuLy8gICBuYW1lOiAnZmlsdGVyJyxcbi8vICAgZGlzcGxheU5hbWU6ICfnrZvpgIknLFxuLy8gICBpc0FycmF5OiB0cnVlLFxuLy8gICB0eXBlOiBQcm9wZXJ0eVR5cGVzLkZpbHRlcixcbi8vIH1cbi8vIFRPRE86IGZpbHRlcnNcblxuXG5jb25zdCB0aXRsZUJhclByb3BzOiBQcm9wZXJ0eU9wdGlvbltdID0gW3tcbiAgY2F0ZWdvcnk6ICd0aXRsZUJhcicsXG4gIG5hbWU6ICd0aXRsZUJhckhpZGUnLFxuICB0eXBlOiBQcm9wZXJ0eVR5cGVzLkJvb2wsXG4gIGJvb2xPcHRpb246IHtcbiAgICBkZWZhdWx0OiBmYWxzZVxuICB9XG59LCB7XG4gIGNhdGVnb3J5OiAndGl0bGVCYXInLFxuICBuYW1lOiAndGl0bGVCYXJTaG93UmVmcmVzaCcsXG4gIGRpc3BsYXlOYW1lOiAnc2hvd1JlZnJlc2hCdG4nLFxuICB0eXBlOiBQcm9wZXJ0eVR5cGVzLkJvb2wsXG4gIGJvb2xPcHRpb246IHtcbiAgICBkZWZhdWx0OiB0cnVlXG4gIH1cbn0sIHtcbiAgLi4uZGF0YWxlc3NKdW1wT3B0aW9uLFxuICBjYXRlZ29yeTogJ3RpdGxlQmFyJyxcbiAgbmFtZTogJ3RpdGxlQmFySnVtcCcsXG59XVxuXG5ASW5qZWN0YWJsZSh7XG4gIHByb3ZpZGVkSW46ICdyb290J1xufSlcbmV4cG9ydCBjbGFzcyBXaWRnZXRQcm9wZXJ0eVNlcnZpY2Uge1xuXG4gIGNvbnN0cnVjdG9yIChcbiAgKSB7IH1cbiAgLyoqXG4gICAqIOiOt+W+l+afkOenjeexu+Wei+eahOWFqOWxgOm7mOiupOWAvO+8jOWcqOWujOWFqOayoeacieWAvOaXtuS9v+eUqFxuICAgKiBAcGFyYW0gcHJvcFxuICAgKiBAcGFyYW0gYXJyYXlJdGVtIOaYr+WQpuaYr+adpeiOt+WPliBhcnJheSDnmoTlrZDpobnpu5jorqTlgLznmoTvvIzpu5jorqTkuI3mmK/jgIJcbiAgICog5aaC5p6c5LiN5piv77yM6IulIHByb3AuaXNBcnJheSDkuLrnnJ/vvIzlsLHov5Tlm57nqbrmlbDnu4QgW13vvJtcbiAgICog5aaC5p6c5piv77yM5YiZ5LiN566hIHByb3AuaXNBcnJheSDmmK/lkKbkuLrnnJ/vvIzmgLvov5Tlm54gcHJvcC50eXBlIOWvueW6lOeahOm7mOiupOWAvO+8jOS7heW6lOeUqOS6juWinuWKoOaVsOe7hOmhueaXtuiOt+WPluaWsOmhueOAglxuICAgKi9cbiAgcHVibGljIGdldFByb3BlcnR5RGVmYXVsdFZhbHVlIChwcm9wOiBQcm9wZXJ0eU9wdGlvbiwgYXJyYXlJdGVtID0gZmFsc2UpIHtcbiAgICBpZiAoIWFycmF5SXRlbSAmJiBwcm9wLmlzQXJyYXkpIHJldHVybiBbXVxuICAgIC8vIG9iamVjdDog6YCS5b2S55Sf5oiQ5YW35pyJ5omA5pyJIGtleSDnmoTlr7nosaHvvIzmr4/kuKoga2V5IOeahCB2YWx1ZSDmmK/pu5jorqTlgLxcbiAgICBpZiAocHJvcC50eXBlID09PSBQcm9wZXJ0eVR5cGVzLk9iamVjdCkge1xuICAgICAgY29uc3QgbmV3T2JqID0ge31cbiAgICAgIHByb3Aub2JqZWN0T3B0aW9uLm9ialByb3BlcnR5T3B0aW9ucy5mb3JFYWNoKChjaGlsZFByb3A6IFByb3BlcnR5T3B0aW9uKSA9PiB7XG4gICAgICAgIG5ld09ialtjaGlsZFByb3AubmFtZV0gPSAoY2hpbGRQcm9wW2NoaWxkUHJvcC50eXBlXVxuICAgICAgICAgICYmIGNoaWxkUHJvcFtjaGlsZFByb3AudHlwZV0uZGVmYXVsdClcbiAgICAgICAgICB8fCB0aGlzLmdldFByb3BlcnR5RGVmYXVsdFZhbHVlKGNoaWxkUHJvcClcbiAgICAgIH0pXG4gICAgICByZXR1cm4gbmV3T2JqXG4gICAgfSBlbHNlIGlmIChwcm9wLnR5cGUgPT09IFByb3BlcnR5VHlwZXMuRW51bSkge1xuICAgICAgY29uc3QgZmlyc3RJdGVtID0gcHJvcC5lbnVtT3B0aW9uLml0ZW1zWzBdXG4gICAgICByZXR1cm4gdHlwZW9mIGZpcnN0SXRlbSA9PT0gJ3N0cmluZydcbiAgICAgICAgPyBmaXJzdEl0ZW1cbiAgICAgICAgOiBmaXJzdEl0ZW1bJ3ZhbHVlJ11cbiAgICB9IGVsc2UgaWYgKHByb3AudHlwZSA9PT0gUHJvcGVydHlUeXBlcy5Db2xvcikge1xuICAgICAgY29uc3QgY29sb3JzID0gdGhpcy5nZXRDb2xvcnNCeUNvbG9yT3B0aW9uKHByb3AuY29sb3JPcHRpb24pXG4gICAgICBjb25zdCBpID0gTWF0aC5yYW5kb20oKVxuICAgICAgcmV0dXJuIGNvbG9yc1tNYXRoLmZsb29yKGkgKiBjb2xvcnMubGVuZ3RoKV1cbiAgICB9IGVsc2UgaWYgKHByb3AudHlwZSA9PT0gUHJvcGVydHlUeXBlcy5GaWx0ZXIpIHtcbiAgICAgIHJldHVybiBuZXcgRmlsdGVyU2NoZW1hKClcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIFByb3BlcnR5VHlwZURlZmF1bHRWYWx1ZXNbcHJvcC50eXBlXVxuICAgIH1cbiAgfVxuICAvKipcbiAgICog5YWD6YOo5Lu25Yqg6L2944CB57yW6K+R5a6M5oiQ5ZCO77yM57uE6KOF5paw55qEIHByb3BlcnRpZXNcbiAgICogd2lkZ2V0IG5hbWVcbiAgICogLT4gY29uc3RydWN0b3IgbmFtZVxuICAgKiAtPiB3aWRnZXQgKyB0aXRsZSBiYXIgKyBiYXNlIHByb3BlcnRpZXNcbiAgICogLT4g5YWD6YOo5Lu255qE5omA5pyJ5Y+v6YWN572uIHByb3BlcnRpZXNcbiAgICovXG4gIHB1YmxpYyBnZXRXaWRnZXRQcm9wcyAod2lkZ2V0TmFtZTogc3RyaW5nLCB3aWRnZXRDb25maWc6IFdpZGdldENvbmZpZyk6IFByb3BlcnR5T3B0aW9uW10ge1xuICAgIGNvbnN0IGN0b3JOYW1lID0gV2lkZ2V0UmVnaXN0cnkuZ2V0V2lkZ2V0QnlOYW1lKHdpZGdldE5hbWUpLmN0b3IubmFtZVxuICAgIC8vIHdpZGdldCDlrZDnsbvkuK3nmoQgcHJvcGVydHlcbiAgICBjb25zdCB3aWRnZXRQcm9wcyA9IFdpZGdldFByb3BlcnR5TWFwLmdldChjdG9yTmFtZSkgfHwgW11cbiAgICAvLyDnrZvpgInlh7ogd2lkZ2V0IOWtkOexu+S4reayoemHjeWGmei/h+eahCBwcm9wZXJ0ee+8jOWQpuWImeWPr+iDveS8muacieS/qeS4gOagt+eahFxuICAgIGNvbnN0IGJhc2VQcm9wcyA9IFdpZGdldFByb3BlcnR5TWFwLmdldChXaWRnZXRCYXNlLm5hbWUpXG4gICAgICAuZmlsdGVyKGJhc2VQcm9wID0+ICF3aWRnZXRQcm9wcy5zb21lKHByb3AgPT4gYmFzZVByb3AubmFtZSA9PT0gcHJvcC5uYW1lKSlcbiAgICAvLyDnu4Too4VcbiAgICByZXR1cm4gW1xuICAgICAgLy8g5YWs5YWx6YWN572u6YO95pS+6L+ZXG4gICAgICAuLi5iYXNlUHJvcHMsXG4gICAgICAvLyDmoIfpopjphY3nva5cbiAgICAgIC4uLih3aWRnZXRDb25maWcuZW5hYmxlQ29tbW9uVGl0bGVCYXJcbiAgICAgICAgPyB0aXRsZUJhclByb3BzXG4gICAgICAgIDogW10pLFxuICAgICAgLy8g562b6YCJ6YWN572uXG4gICAgICAuLi4od2lkZ2V0Q29uZmlnLmVuYWJsZURhdGFDb25maWcgJiYgd2lkZ2V0Q29uZmlnLmVuYWJsZUNvbW1vblRpdGxlQmFyXG4gICAgICAgID8gW2Zyb250ZW5kRmlsdGVyUHJvcF1cbiAgICAgICAgOiBbXSksXG4gICAgICAvLyDlhYPpg6jku7boh6rouqvphY3nva5cbiAgICAgIC4uLndpZGdldFByb3BzXG4gICAgICAvLyAuLi50ZXN0UHJvcHMsXG4gICAgXVxuICB9XG4gIC8qKlxuICAgKiBtaXhpbiDlt7LmnIlwdiArIOWFg+mDqOS7tuaOqOiNkOeahOm7mOiupHB2ICsg5q2k57G75Z6L55qE5YWo5bGA6buY6K6kcHZcbiAgICovXG4gIHB1YmxpYyBtaXhpbldpZGdldFByb3BWYWx1ZXMgKHByb3BzOiBQcm9wZXJ0eU9wdGlvbltdLCBwcm9wVmFsdWVzOiBvYmplY3QpIHtcbiAgICBjb25zdCBtaXhpbmVkUHJvcFZhbHVlczogeyBbcHJvcE5hbWU6IHN0cmluZ106IGFueSB9ID0geyAuLi5wcm9wVmFsdWVzIH1cbiAgICAvLyDmo4Dmn6XmiYDmnIkgcHJvcGVydGllc++8jOWTquS4quayoeacieWAvO+8jOWwsei1i+S4ium7mOiupOaOqOiNkOWAvFxuICAgIHByb3BzLmZvckVhY2gocHJvcCA9PiB7XG4gICAgICAvLyDov5nph4zlv4XpobvmmK/liKTmlq0gdW5kZWZpbmVk77yM5ZCm5YiZIGJvb2wg57G75Z6L55qEIGZhbHNlIOS5n+WPr+iDveWIpOWumuS4uuaXoOWAvFxuICAgICAgaWYgKG1peGluZWRQcm9wVmFsdWVzW3Byb3AubmFtZV0gPT09IHVuZGVmaW5lZCkge1xuICAgICAgICBtaXhpbmVkUHJvcFZhbHVlc1twcm9wLm5hbWVdID0gcHJvcFtwcm9wLnR5cGVdICYmIHByb3BbcHJvcC50eXBlXS5kZWZhdWx0XG4gICAgICAgICAgLy8g5aaC5p6c5YWD6YOo5Lu25peg6buY6K6k5YC877yM5bCx5Yqg5YWl5YWo5bGA55qE5b2T5YmN57G75Z6L6buY6K6k5YC8XG4gICAgICAgICAgfHwgdGhpcy5nZXRQcm9wZXJ0eURlZmF1bHRWYWx1ZShwcm9wKVxuICAgICAgfVxuICAgIH0pXG4gICAgcmV0dXJuIG1peGluZWRQcm9wVmFsdWVzXG4gIH1cblxuICBwdWJsaWMgZ2V0Q29sb3JzQnlDb2xvck9wdGlvbiAoY29sb3JPcHRpb24pIHtcbiAgICBpZiAoY29sb3JPcHRpb24gJiYgY29sb3JPcHRpb24ucGFsZXR0ZSkgcmV0dXJuIGNvbG9yT3B0aW9uLnBhbGV0dGVcbiAgICBjb25zdCBjb2xvclR5cGUgPSBjb2xvck9wdGlvbiA/IGNvbG9yT3B0aW9uLnR5cGUgOiAncHVyZSdcbiAgICBsZXQgY29sb3JzXG4gICAgc3dpdGNoIChjb2xvclR5cGUpIHtcbiAgICAgIGNhc2UgJ2dyYWRpZW50JzpcbiAgICAgICAgY29sb3JzID0gUGxUaGVtZUNvbG9ycy5ncmFkaWVudFxuICAgICAgICBicmVha1xuICAgICAgY2FzZSAncHVyZU9yR3JhZGllbnQnOlxuICAgICAgICBjb2xvcnMgPSBbLi4uUGxUaGVtZUNvbG9ycy5wdXJlLCAuLi5QbFRoZW1lQ29sb3JzLmdyYWRpZW50XVxuICAgICAgICBicmVha1xuICAgICAgY2FzZSAncHVyZSc6XG4gICAgICBkZWZhdWx0OlxuICAgICAgICBjb2xvcnMgPSBQbFRoZW1lQ29sb3JzLnB1cmVcbiAgICAgICAgYnJlYWtcbiAgICB9XG4gICAgcmV0dXJuIGNvbG9yc1xuICB9XG5cbn1cbiJdfQ==
/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { HttpClient } from '@angular/common/http';
import { ChangeDetectorRef, Component, EventEmitter, Injector, Input, Output, ViewChild, ViewContainerRef } from '@angular/core';
import { EppPortlet, FILTERS_WIDGET_NAME, FILTERS_WIDGET_PROP_NAME, IGIX_HOME_PATH, loadCommonStyleNTheme, WidgetContainerMode } from '@gspwidget/util';
import { FilterSchema, FILTER_PROP_NAME, WidgetDataService, WidgetEventService, WidgetInstanceInfo, WidgetPropertyService } from '@gspwidget/widget-devkit';
import { TranslateService } from '@ngx-translate/core';
import { NzModalService } from 'ng-zorro-antd/modal';
import ResizeObserver from 'resize-observer-polyfill';
import { delay } from 'rxjs/operators';
import { DynamicLoaderService } from '../dynamic-loader.service';
import { InstanceService } from '../instance.service';
import { TitleBarComponent } from '../title-bar/title-bar.component';
import { chartAggFieldMap, isWidgetRuntimeAggActive } from './runtime-agg';
// private langsSet: { [widgetName: string]: string[] } = {}
/**
 * 已被 set 翻译的 lang，下次不再请求此 lang
 * @type {?}
 */
var loadedI18nUrls = [];
/** @enum {number} */
var WCStatus = {
    LoadingWidget: 0,
    LoadingData: 1,
    DataEmpty: 2,
    Normal: 3,
    DataError: 4,
    WidgetLoadError: 5,
};
export { WCStatus };
WCStatus[WCStatus.LoadingWidget] = 'LoadingWidget';
WCStatus[WCStatus.LoadingData] = 'LoadingData';
WCStatus[WCStatus.DataEmpty] = 'DataEmpty';
WCStatus[WCStatus.Normal] = 'Normal';
WCStatus[WCStatus.DataError] = 'DataError';
WCStatus[WCStatus.WidgetLoadError] = 'WidgetLoadError';
/**
 * @record
 */
export function GetDataOptions() { }
if (false) {
    /** @type {?} */
    GetDataOptions.prototype.dpValues;
    /** @type {?} */
    GetDataOptions.prototype.runtimeAgg;
}
loadCommonStyleNTheme();
/**
 * 兼容阶段数据加载逻辑
 * 1. 若元部件 useDataEngine === true, 说明是老写法、且需要数据的元部件，但其内部未调用加载数据，所以初始化完成后加载一下；
 *    新数据加载请求处理永远启用，因为仅有新写法元部件会触发；
 * 2. 若 getData 有值，则用它获得数据，不用真数据
 * 3. 若名中带有 '演示'，则用演示数据
 * 4. 都不满足再用真数据
 */
var WidgetComponent = /** @class */ (function () {
    /** 公共头上是否显示运行时聚合配置 */
    function WidgetComponent(loader, cd, injector, modal, http, translate, widgetPropertyService, widgetEventService, insSerivce) {
        var _this = this;
        this.loader = loader;
        this.cd = cd;
        this.injector = injector;
        this.modal = modal;
        this.http = http;
        this.translate = translate;
        this.widgetPropertyService = widgetPropertyService;
        this.widgetEventService = widgetEventService;
        this.insSerivce = insSerivce;
        /**
         * 可选
         */
        this.mode = WidgetContainerMode.AOT;
        // TODO: 解耦 portlet
        /**
         * 可选，部件信息，需要注入到元部件
         */
        this.portlet = new EppPortlet(null);
        this.status = WCStatus.LoadingWidget;
        /**
         * widget 加载完成，发出当前 widget 的信息
         */
        this.widgetLoaded = new EventEmitter();
        /**
         * widget component create 完成，发出当前 widget 的信息
         */
        this.widgetInit = new EventEmitter();
        this.runtimeAggChange = new EventEmitter();
        // public isLoading = true
        // public status = WCStatus.Normal
        this.WCStatus = WCStatus;
        this.IGIX_HOME_PATH = IGIX_HOME_PATH;
        this.FILTER_PROP_NAME = FILTER_PROP_NAME;
        // public feFilterValues: FrontendFilter[]
        /**
         * 存在此层的数据。可用于前端筛选、数据获取状态判断
         */
        this.data = null;
        this.showRuntimeAgg = false;
        /**
         * pv 中包含 {fs,dp}[]（筛选控件+取数参数=筛选）
         * 部件实例中保存 {fs,dp}: filterValue
         */
        this.dpValues = [];
        this.handleDataError = (/**
         * @return {?}
         */
        function () {
            // 数据加载失败
            _this.status = WCStatus.DataError;
            _this.cd.markForCheck();
        });
        this._initWidgetEnv();
    }
    /**
     * 全局初始化
     */
    /**
     * 全局初始化
     * @private
     * @return {?}
     */
    WidgetComponent.prototype._initWidgetEnv = /**
     * 全局初始化
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        // i18n
        if (!this.translate.defaultLang)
            this.translate.setDefaultLang('zh-CHS');
        if (!this.translate.currentLang) {
            /** @type {?} */
            var lang = localStorage.getItem('languageCode') || 'zh-CHS';
            this.translate.use(lang || 'zh-CHS');
        }
        if (!window.widgetI18nResLoaded) {
            var currentLang_1 = this.translate.currentLang;
            this.http.get(IGIX_HOME_PATH + "assets/i18n/" + currentLang_1 + ".json").subscribe((/**
             * @param {?} res
             * @return {?}
             */
            function (res) {
                _this.translate.setTranslation(currentLang_1, res, true);
            }));
            window.widgetI18nResLoaded = true;
        }
    };
    /**
     * @return {?}
     */
    WidgetComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.insSerivce.addInsInfo(this.instanceId, this, 'widgetComp');
        // 监听 resizeTarget 的大小变化，变化时调用元部件.onResized()，传入 DomRectReadonly
        if (this.resizeTarget) {
            new ResizeObserver((/**
             * @param {?} entries
             * @return {?}
             */
            function (entries) {
                var _a = entries[0].contentRect, width = _a.width, height = _a.height;
                if (_this.widgetInstance)
                    _this.widgetInstance.onResized(width, height);
                _this.width = width;
                _this.height = height;
                _this.cd.markForCheck();
            })).observe(this.resizeTarget.nativeElement);
        }
    };
    /**
     * @param {?} c
     * @return {?}
     */
    WidgetComponent.prototype.ngOnChanges = /**
     * @param {?} c
     * @return {?}
     */
    function (c) {
        var basicWidgetInfo = c.basicWidgetInfo;
        if (basicWidgetInfo && basicWidgetInfo.currentValue && basicWidgetInfo.currentValue !== basicWidgetInfo.previousValue) {
            // widget 变了，渲染新元部件
            this.renderWidget();
        }
    };
    /**
     * 此 container 被 gridster 渲染出正确的大小事件
     */
    /**
     * 此 container 被 gridster 渲染出正确的大小事件
     * @return {?}
     */
    WidgetComponent.prototype.triggerWidgetResize = /**
     * 此 container 被 gridster 渲染出正确的大小事件
     * @return {?}
     */
    function () {
        if (this.widgetInstance && this.widgetInstance.onResized) {
            var _a = this.resizeTarget.nativeElement, clientWidth = _a.clientWidth, clientHeight = _a.clientHeight;
            this.widgetInstance.onResized(clientWidth, clientHeight);
        }
    };
    // TODO: 这些都改造成，参数为一个对象，里面可以一次塞多个属性-值，全部更新后再触发 onPropertyChange，
    // 否则像初始化完要赋多个值的情况，通知触发太频繁了，也会导致频繁触发元部件渲染、数据加载
    /**
     * 外部更新元部件 propValues 的某属性后，需要调用此方法，否则我们不知道 propValues 发生了变化。
     * 不太好精简掉这个方法。尝试过用 keyValueDiffer 在 ngDoCheck 中检测 propValues 变化，但仅能检测一层。
     */
    // TODO: 这些都改造成，参数为一个对象，里面可以一次塞多个属性-值，全部更新后再触发 onPropertyChange，
    // 否则像初始化完要赋多个值的情况，通知触发太频繁了，也会导致频繁触发元部件渲染、数据加载
    /**
     * 外部更新元部件 propValues 的某属性后，需要调用此方法，否则我们不知道 propValues 发生了变化。
     * 不太好精简掉这个方法。尝试过用 keyValueDiffer 在 ngDoCheck 中检测 propValues 变化，但仅能检测一层。
     * @param {?} propName
     * @param {?} pValue
     * @return {?}
     */
    WidgetComponent.prototype.setPropertyValue = 
    // TODO: 这些都改造成，参数为一个对象，里面可以一次塞多个属性-值，全部更新后再触发 onPropertyChange，
    // 否则像初始化完要赋多个值的情况，通知触发太频繁了，也会导致频繁触发元部件渲染、数据加载
    /**
     * 外部更新元部件 propValues 的某属性后，需要调用此方法，否则我们不知道 propValues 发生了变化。
     * 不太好精简掉这个方法。尝试过用 keyValueDiffer 在 ngDoCheck 中检测 propValues 变化，但仅能检测一层。
     * @param {?} propName
     * @param {?} pValue
     * @return {?}
     */
    function (propName, pValue) {
        // TODO: portlet 结构改变后，可以省去这一步：__extra 应该根本不会传进来
        if (propName === '__extra')
            return;
        // 如果不是 object，则判断值如果 pValue 与当前元部件实例中相同，就不传给部件了
        if (typeof pValue !== 'object' && this.widgetInstance[propName] === pValue)
            return;
        // TODO: 部件配置时，运行时更改语言的处理
        /** @type {?} */
        var value = this.processPV(pValue)
        // 改值
        ;
        // 改值
        this.widgetInstance[propName] = value;
        // 通知，因为元部件可能需要这个时机
        // 防止没有这个方法的老元部件报错，后面都会升级掉
        if (this.widgetInstance.onPropertyChange) {
            this.widgetInstance.onPropertyChange(propName, value);
        }
        if (propName === FILTER_PROP_NAME) {
            this.dpValues = ((/** @type {?} */ (pValue)))
                .filter((/**
             * @param {?} dv
             * @return {?}
             */
            function (dv) { return dv.dpId; }))
                .map((/**
             * @param {?} fc
             * @return {?}
             */
            function (fc) { return ({
                value: FilterSchema.getDefaultValue(fc.fs),
                dpId: fc.dpId
            }); }));
            // TODO:
            // if (pValue && pValue.slice) this.propValues[FILTER_PROP_NAME] = pValue.slice()
            // this.cd.markForCheck()
        }
        if (!this.propValues)
            this.propValues = {};
        this.propValues[propName] = pValue;
        this.cd.markForCheck();
    };
    /* 递归检查 pv，做特殊处理，比如国际化、帮助 */
    /* 递归检查 pv，做特殊处理，比如国际化、帮助 */
    /**
     * @private
     * @param {?} value
     * @return {?}
     */
    WidgetComponent.prototype.processPV = /* 递归检查 pv，做特殊处理，比如国际化、帮助 */
    /**
     * @private
     * @param {?} value
     * @return {?}
     */
    function (value) {
        var currentLang = this.translate.currentLang;
        try {
            value = JSON.parse(JSON.stringify(value));
        }
        catch (e) { }
        return _processPVRecursively(value);
        /**
         * @param {?} pValue
         * @return {?}
         */
        function _processPVRecursively(pValue) {
            if (Array.isArray(pValue)) {
                pValue.forEach((/**
                 * @param {?} v
                 * @param {?} i
                 * @return {?}
                 */
                function (v, i) {
                    pValue[i] = _processPVRecursively(v);
                }));
                return pValue;
                // i18n: 如果 value 中包含 en 或 zh-CHS 或 当前语言的key，则是 i18n 字段
            }
            else if (pValue && !pValue._notProcess && typeof (pValue.en + pValue['zh-CHS'] + pValue[currentLang]) === 'string') {
                return pValue[currentLang];
                // help
            }
            else if (pValue && pValue.__type === 'help') {
                return pValue.value;
            }
            else if (pValue && ['Object'].includes(pValue.constructor.name)) {
                Object.keys(pValue).forEach((/**
                 * @param {?} key
                 * @return {?}
                 */
                function (key) {
                    pValue[key] = _processPVRecursively(pValue[key]);
                }));
                return pValue;
            }
            else {
                return pValue;
            }
        }
    };
    /**
     * @return {?}
     */
    WidgetComponent.prototype.renderWidget = /**
     * @return {?}
     */
    function () {
        return tslib_1.__awaiter(this, void 0, void 0, function () {
            var baseUrl, curWidgetData, widgetCompFactory, widgetModuleFactory, propValues, widgetConfig, injector;
            var _this = this;
            return tslib_1.__generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        // 加载渲染这个 widget 需要的一切元数据
                        baseUrl = this.basicWidgetInfo.baseUrl;
                        return [4 /*yield*/, this.loader.loadWidget(this.basicWidgetInfo, this.propValues, this.mode)
                            // TODO: propValues 是不是不用经过 loader，直接调 widgetPropService 获取就行？
                        ];
                    case 1:
                        curWidgetData = _a.sent();
                        // TODO: propValues 是不是不用经过 loader，直接调 widgetPropService 获取就行？
                        widgetCompFactory = curWidgetData.widgetCompFactory, widgetModuleFactory = curWidgetData.widgetModuleFactory, propValues = curWidgetData.propValues, widgetConfig = curWidgetData.widgetConfig;
                        this.curWidgetConfig = widgetConfig;
                        this.initRuntimeAgg();
                        if (this.curWidgetConfig.enableLoadingI18n)
                            this.loadI18nRes();
                        // 元部件加载完成事件
                        this.widgetLoaded.emit(curWidgetData);
                        // 删老元部件
                        this.widgetContainer.remove();
                        // 创建注入器
                        injector = Injector.create({
                            providers: [{
                                    provide: WidgetInstanceInfo,
                                    /**
                                     * 元部件实例信息
                                     */
                                    useValue: new WidgetInstanceInfo(this.portlet.id, this.instanceId, this.assetsBaseUrl || this.basicWidgetInfo.baseUrl + '/assets/')
                                }, {
                                    provide: WidgetDataService,
                                    /**
                                     * 元部件数据服务
                                     */
                                    useFactory: (/**
                                     * @return {?}
                                     */
                                    function () {
                                        _this.widgetDataService = new WidgetDataService();
                                        _this.widgetDataService.onLoadData
                                            .pipe(delay(0)) // 为避免用 of(data) 会同步返回数据，导致 data service 中的 onGetData 还没返回到元部件手里就触发完了
                                            .subscribe(_this.loadNSetData.bind(_this));
                                        return _this.widgetDataService;
                                    }),
                                    deps: []
                                }],
                            parent: this.injector
                        });
                        // 创建、挂载 widget 组件
                        this.widgetInstance = (/** @type {?} */ (this.widgetContainer.createComponent(widgetCompFactory, 0, injector, undefined, widgetModuleFactory && widgetModuleFactory.create(this.injector)).instance));
                        // 设置 widget 的 properties 的 values
                        // TODO: 改为一次配多个
                        Object.keys(propValues).forEach((/**
                         * @param {?} prop
                         * @return {?}
                         */
                        function (prop) {
                            _this.setPropertyValue(prop, propValues[prop]);
                        }));
                        // TODO: 已废弃方案, 以下为过渡方案以兼容老写法元部件, 后期将移除
                        this.widgetInstance.id = this.instanceId;
                        this.widgetInstance.portletId = this.portlet.id;
                        this.widgetInstance.assetsBaseUrl = this.assetsBaseUrl || baseUrl + '/assets/';
                        if (this.widgetInstance.useDataEngine)
                            this.loadNSetData({});
                        // TODO: 它完成之后才算作 widget 初始化完成，可以显示出来。否则会显示 code。
                        // this.setWidgetTranslation()
                        // event
                        this.initWidgetEventListener();
                        // 元部件初始化完成事件
                        this.widgetInit.emit(curWidgetData);
                        // this.isLoading = false
                        this.status = WCStatus.Normal;
                        this.cd.markForCheck();
                        return [2 /*return*/];
                }
            });
        });
    };
    /**
     * @private
     * @return {?}
     */
    WidgetComponent.prototype.loadI18nRes = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        var currentLang = this.translate.currentLang;
        var _a = this.basicWidgetInfo, name = _a.name, baseUrl = _a.baseUrl;
        var customI18nResourceUrl = this.curWidgetConfig.customI18nResourceUrl;
        /** @type {?} */
        var i18nResUrl = customI18nResourceUrl || baseUrl + "/assets/i18n/" + currentLang + ".json"
        // 缓存曾加载过的资源文件名，下次相同文件不再请求。缓存资源文件名，是因为可能多个元部件指定相同的资源文件。
        ;
        // 缓存曾加载过的资源文件名，下次相同文件不再请求。缓存资源文件名，是因为可能多个元部件指定相同的资源文件。
        if (loadedI18nUrls.includes(i18nResUrl))
            return;
        loadedI18nUrls.push(i18nResUrl);
        return this.http.get(i18nResUrl).toPromise().then((/**
         * @param {?} res
         * @return {?}
         */
        function (res) {
            _this.translate.setTranslation(currentLang, res, true);
        }), (/**
         * @return {?}
         */
        function () {
            console.log("\u5143\u90E8\u4EF6 " + name + " \u65E0 " + currentLang + " \u7684\u8D44\u6E90\u6587\u4EF6");
        })).finally((/**
         * @return {?}
         */
        function () {
            return Promise.resolve();
        }));
    };
    /**
     * 塞数据入口 1/2: 加载数据并塞给部件
     */
    // TODO: loadNSetData 可能是不带参数的。取数参数可能存在当前 widget 实例里，直接取。
    // loadNSetData 有没有可能带着来自部件的额外参数？
    /**
     * 塞数据入口 1/2: 加载数据并塞给部件
     * @param {?=} param
     * @return {?}
     */
    // TODO: loadNSetData 可能是不带参数的。取数参数可能存在当前 widget 实例里，直接取。
    // loadNSetData 有没有可能带着来自部件的额外参数？
    WidgetComponent.prototype.loadNSetData = /**
     * 塞数据入口 1/2: 加载数据并塞给部件
     * @param {?=} param
     * @return {?}
     */
    // TODO: loadNSetData 可能是不带参数的。取数参数可能存在当前 widget 实例里，直接取。
    // loadNSetData 有没有可能带着来自部件的额外参数？
    function (param) {
        var _this = this;
        if (param === void 0) { param = {}; }
        /** @type {?} */
        var ob = this.getData({
            dpValues: mergeDpValuesForNew(this.dpValues, param.dpValues),
            runtimeAgg: this.runtimeAgg
        });
        if (!ob)
            return;
        ob.subscribe((/**
         * @param {?} dataWithDims
         * @return {?}
         */
        function (dataWithDims) {
            _this.setData(dataWithDims);
        }), this.handleDataError.bind(this));
    };
    /**
     * 给元部件重新设置数据结果，外部可调用此方法给部件设置数据。
     */
    /**
     * 给元部件重新设置数据结果，外部可调用此方法给部件设置数据。
     * @param {?} pDataWithDims
     * @return {?}
     */
    WidgetComponent.prototype.setData = /**
     * 给元部件重新设置数据结果，外部可调用此方法给部件设置数据。
     * @param {?} pDataWithDims
     * @return {?}
     */
    function (pDataWithDims) {
        /** @type {?} */
        var dataWithDims = pDataWithDims
        // set if empty status
        ;
        // set if empty status
        if (!pDataWithDims || !pDataWithDims.tableData || pDataWithDims.tableData.length === 0)
            this.status = WCStatus.DataEmpty;
        // 如果外面没有给 DataWithDims 而是简单数据列表，就简单转一把。以兼容 config 里的假数据等。
        if (!pDataWithDims.dimensions && pDataWithDims['length']) {
            dataWithDims = {
                dimensions: Object
                    .keys(pDataWithDims[0])
                    .map((/**
                 * @param {?} key
                 * @return {?}
                 */
                function (key) { return ({ name: key, label: key }); })),
                tableData: ((/** @type {?} */ ((/** @type {?} */ (pDataWithDims)))))
            };
        }
        this.status = WCStatus.Normal;
        this.data = dataWithDims.tableData;
        this.dims = dataWithDims.dimensions;
        if (this.widgetDataService)
            this.widgetDataService.setData(dataWithDims);
        if (this.widgetInstance && this.widgetInstance.useDataEngine)
            this.widgetInstance.onGetData(dataWithDims.tableData); // 兼容用途
        // 给元部件设置完数据，若有运行时聚合，还需要重新绑定字段
        this.setRuntimeAggDims();
        this.cd.markForCheck();
    };
    /**
     * @return {?}
     */
    WidgetComponent.prototype.handleClickStatusMore = /**
     * @return {?}
     */
    function () {
        this.modal.error({
            nzTitle: '小部件错误',
            nzContent: '此小部件的数据配置无效，需要管理员重新配置或删除。'
        });
    };
    /**
     * @param {?} dpValues
     * @return {?}
     */
    WidgetComponent.prototype.handleFilterChange = /**
     * @param {?} dpValues
     * @return {?}
     */
    function (dpValues) {
        mergeDpValues(this.dpValues, dpValues);
        this.loadNSetData();
    };
    /**
     * @param {?} runtimeAgg
     * @return {?}
     */
    WidgetComponent.prototype.handleRuntimeAggChange = /**
     * @param {?} runtimeAgg
     * @return {?}
     */
    function (runtimeAgg) {
        // if (objectLiteralEqual(runtimeAgg, this.runtimeAgg)) return
        this.runtimeAgg = runtimeAgg;
        // 下面两行顺序严格，因为外部加载数据时可能要依赖当前最新的 runtimeAgg
        this.runtimeAggChange.emit(runtimeAgg);
        this.loadNSetData();
    };
    /** 当前写法需要保证 renderWidget() 已完成 */
    /**
     * 当前写法需要保证 renderWidget() 已完成
     * @param {?} titleBar
     * @return {?}
     */
    WidgetComponent.prototype.handleTitleBarInit = /**
     * 当前写法需要保证 renderWidget() 已完成
     * @param {?} titleBar
     * @return {?}
     */
    function (titleBar) {
        if (this.showRuntimeAgg) {
            titleBar.setRuntimeAgg(this.runtimeAgg);
        }
    };
    /**
     * @return {?}
     */
    WidgetComponent.prototype.initRuntimeAgg = /**
     * @return {?}
     */
    function () {
        // runtime agg
        this.showRuntimeAgg = isWidgetRuntimeAggActive(this.basicWidgetInfo.name);
        if (this.showRuntimeAgg) {
            this.runtimeAgg = this.propValues.__extra ? this.propValues.__extra.runtimeAgg : null;
        }
    };
    // TODO: 以后把 su 放 basic... 里
    /**
     * 初始化部件事件监听
     */
    // TODO: 以后把 su 放 basic... 里
    /**
     * 初始化部件事件监听
     * @private
     * @return {?}
     */
    WidgetComponent.prototype.initWidgetEventListener = 
    // TODO: 以后把 su 放 basic... 里
    /**
     * 初始化部件事件监听
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        if (!this.linkMap)
            return;
        if (this.amIFilterWidget()) {
            this.initOneEventListener(FILTERS_WIDGET_PROP_NAME);
        }
        else {
            this.widgetEventService
                .getEventsByWidgetName(this.basicWidgetInfo.name, this.propValues)
                .forEach((/**
             * @param {?} eventConfig
             * @return {?}
             */
            function (eventConfig) {
                _this.initOneEventListener(eventConfig.propName);
            }));
        }
    };
    /**
     * eventPropName 是事件对应的实际属性名，
     * eventKey 配置在 link 里的事件名。
     * 一般他俩是一样的，后者可以不传。
     * 若是筛选部件，则两者不同，一个是 'filter'，一个是实际的事件（筛选）名称。
     */
    /**
     * eventPropName 是事件对应的实际属性名，
     * eventKey 配置在 link 里的事件名。
     * 一般他俩是一样的，后者可以不传。
     * 若是筛选部件，则两者不同，一个是 'filter'，一个是实际的事件（筛选）名称。
     * @private
     * @param {?} eventPropName
     * @return {?}
     */
    WidgetComponent.prototype.initOneEventListener = /**
     * eventPropName 是事件对应的实际属性名，
     * eventKey 配置在 link 里的事件名。
     * 一般他俩是一样的，后者可以不传。
     * 若是筛选部件，则两者不同，一个是 'filter'，一个是实际的事件（筛选）名称。
     * @private
     * @param {?} eventPropName
     * @return {?}
     */
    function (eventPropName) {
        var _this = this;
        /** @type {?} */
        var eventEmitter = this.widgetInstance[eventPropName];
        if (eventEmitter)
            eventEmitter.subscribe((/**
             * @param {?} widgetEventParam
             * @return {?}
             */
            function (widgetEventParam) {
                console.log('联动事件触发，参数：' + widgetEventParam);
                /** @type {?} */
                var linkEventKey = _this.amIFilterWidget()
                    ? ((/** @type {?} */ (widgetEventParam))).eventKey
                    : eventPropName
                // 根据 link map 调用其他 ins 根据 重新加载数据
                ;
                // 根据 link map 调用其他 ins 根据 重新加载数据
                /** @type {?} */
                var pInsLink = _this.linkMap[linkEventKey];
                Object.keys(pInsLink).forEach((/**
                 * @param {?} pInsId
                 * @return {?}
                 */
                function (pInsId) {
                    if (!pInsLink[pInsId] || !pInsLink[pInsId].active || !pInsLink[pInsId].dpId)
                        return;
                    /** @type {?} */
                    var targetWIns = _this.insSerivce.getInsByPInsId(pInsId).widgetComp;
                    if (targetWIns)
                        targetWIns.loadNSetData({
                            dpValues: [{
                                    dpId: pInsLink[pInsId].dpId,
                                    // TODO: 联动参数值的处理加在这
                                    value: String(widgetEventParam['dataIndex']),
                                }]
                        });
                }));
            }));
    };
    /**
     * @return {?}
     */
    WidgetComponent.prototype.setRuntimeAggDims = /**
     * @return {?}
     */
    function () {
        var _this = this;
        if (!this.runtimeAgg)
            return;
        chartAggFieldMap[this.basicWidgetInfo.name].forEach((/**
         * @param {?} aggField
         * @return {?}
         */
        function (aggField) {
            _this.setPropertyValue(aggField.name, aggField.valueFactory(_this.runtimeAgg, _this.dims));
        }));
    };
    /**
     * @return {?}
     */
    WidgetComponent.prototype.amIFilterWidget = /**
     * @return {?}
     */
    function () {
        return this.basicWidgetInfo.name === FILTERS_WIDGET_NAME
            && this.basicWidgetInfo.baseUrl.includes('/epp/');
    };
    WidgetComponent.decorators = [
        { type: Component, args: [{
                    selector: 'lib-widget',
                    template: "<div\n  #resizeTarget\n  class=\"wc-wrapper h-100 overflow-hidden position-relative\">\n  <!-- TODO: \u589E\u52A0\u516C\u5171\u7684\u52A0\u8F7D\u906E\u7F69\u5C42\uFF0C\u6570\u636E\u670D\u52A1\u52A0\u8F7D\u65F6\u3001\u90E8\u4EF6\u5185\u8C03\u7528\u65F6\u3001\u90E8\u4EF6\u672C\u8EAB\u52A0\u8F7D\u90FD\u7528\u5B83 -->\n  <!-- loading -->\n  <div\n    *ngIf=\"[WCStatus.LoadingWidget, WCStatus.LoadingData].includes(status)\"\n    class=\"h-100 d-flex justify-content-center align-items-center\">\n    <div class=\"text-center\">\n      <i class=\"spin-ball loading-color material-icons\">public</i>\n      <div class=\"fs-12 loading-color\">{{'\u90E8\u4EF6\u52A0\u8F7D\u4E2D' | trans}}</div>\n    </div>\n  </div>\n\n  <!-- TODO: \u90E8\u4EF6\u52A0\u8F7D\u5931\u8D25\u3002\u600E\u4E48\u7EDF\u4E00\u5904\u7406\u8FD9\u51E0\u79CD\u5F02\u5E38\u72B6\u6001\uFF1F -->\n  <!-- <div\n    *ngIf=\"status === WCStatus.WidgetLoadError\">\n  </div> -->\n\n  <!-- \u65E0\u6570\u636E -->\n  <div\n    *ngIf=\"status === WCStatus.DataEmpty\"\n    class=\"flex-fill no-data h-100 w-100 d-flex flex-column\">\n    <lib-title-bar\n      *ngIf=\"curWidgetConfig?.enableCommonTitleBar\n        && widgetInstance\n        && !widgetInstance['titleBarHide']\"\n      [title]=\"portlet.name\"\n      [showRefresh]=\"widgetInstance['titleBarShowRefresh']\"\n      [jumpConfig]=\"widgetInstance['titleBarJump']\"\n      ></lib-title-bar>\n    <div class=\"flex-fill d-flex flex-column justify-content-center align-items-center\">\n      <img src=\"{{IGIX_HOME_PATH}}assets/img/data-empty.svg\" style=\"transform:translateY(-5px)\" alt=\"\">\n      <div class=\"fs-13\" style=\"color:gray\">{{'noDataAvailable'|translate}}</div>\n    </div>\n  </div>\n\n  <!-- abnormal -->\n  <div class=\"d-flex flex-column overflow-hidden h-100\"\n    *ngIf=\"status === WCStatus.DataError\">\n    <div class=\"portlet-title text-truncate flex-shrink-0\">{{this.portlet.name}}</div>\n    <div class=\"status-layer cursor-pointer flex-fill\"\n      (click)=\"handleClickStatusMore()\">\n      <ng-container *ngIf=\"status === WCStatus.DataError\">\n        <img src=\"{{IGIX_HOME_PATH}}assets/img/data-error.svg\" alt=\"\">\n        <div class=\"error-tip fs-12 text-truncate\">\n          \u90E8\u4EF6\u6570\u636E\u52A0\u8F7D\u5931\u8D25\uFF0C\n          <span class=\"theme-color more\">\u67E5\u770B\u8BE6\u60C5</span>\n        </div>\n      </ng-container>\n    </div>\n  </div>\n\n  <!-- normal -->\n  <!-- *ngIf=\"status === WCStatus.Normal\" -->\n  <div\n    class=\"h-100 d-flex flex-column\">\n    <!-- TODO: \u91CD\u6784 DOM \u7ED3\u6784\uFF0C\u628A title bar \u653E\u5728\u516C\u5171\u4F4D\u7F6E -->\n    <!-- \u516C\u5171 title bar -->\n    <lib-title-bar\n      #titleBar\n      *ngIf=\"curWidgetConfig?.enableCommonTitleBar\n        && widgetInstance\n        && !widgetInstance['titleBarHide']\"\n      [title]=\"portlet.name\"\n      [showRefresh]=\"widgetInstance['titleBarShowRefresh']\"\n      [jumpConfig]=\"widgetInstance['titleBarJump']\"\n      [filterConfigs]=\"propValues[FILTER_PROP_NAME] || []\"\n      [dims]=\"dims\"\n      (clickRefresh)=\"loadNSetData()\"\n      (filterChange)=\"handleFilterChange($event)\"\n      (init)=\"handleTitleBarInit($event)\"\n      [showRuntimeAgg]=\"showRuntimeAgg\"\n      (runtimeAggChange)=\"handleRuntimeAggChange($event)\"\n      >\n    </lib-title-bar>\n    <div class=\"flex-fill overflow-hidden\" >\n      <ng-container #wc></ng-container>\n    </div>\n  </div>\n</div>\n",
                    styles: [".portlet-title{font-weight:700;padding:12px 20px 10px}.status-layer{width:100%;display:flex;align-items:center;justify-content:center;z-index:1;flex-direction:column}.status-layer img{width:75%;max-width:200px}.status-layer .error-tip{color:#666;margin:5px 0}.status-layer .error-tip .more{text-decoration:underline}.no-data{position:absolute;top:0;background:#fff}::ng-deep .widget-title-bar .left{overflow:hidden}::ng-deep .widget-title-bar .left .title{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.loading-color{color:#b2bac4}.spin-ball{font-size:30px}"]
                }] }
    ];
    /** @nocollapse */
    WidgetComponent.ctorParameters = function () { return [
        { type: DynamicLoaderService },
        { type: ChangeDetectorRef },
        { type: Injector },
        { type: NzModalService },
        { type: HttpClient },
        { type: TranslateService },
        { type: WidgetPropertyService },
        { type: WidgetEventService },
        { type: InstanceService }
    ]; };
    WidgetComponent.propDecorators = {
        basicWidgetInfo: [{ type: Input }],
        propValues: [{ type: Input }],
        linkMap: [{ type: Input }],
        mode: [{ type: Input }],
        assetsBaseUrl: [{ type: Input }],
        portlet: [{ type: Input }],
        instanceId: [{ type: Input }],
        getData: [{ type: Input }],
        status: [{ type: Input }],
        widgetLoaded: [{ type: Output }],
        widgetInit: [{ type: Output }],
        runtimeAggChange: [{ type: Output }],
        resizeTarget: [{ type: ViewChild, args: ['resizeTarget',] }],
        widgetContainer: [{ type: ViewChild, args: ['wc', { read: ViewContainerRef },] }],
        titleBar: [{ type: ViewChild, args: ['titleBar',] }]
    };
    return WidgetComponent;
}());
export { WidgetComponent };
if (false) {
    /**
     * 必选，要渲染的 widget 信息
     * @type {?}
     */
    WidgetComponent.prototype.basicWidgetInfo;
    /**
     * 必选，此 widget 的配置信息；仅在元部件加载时起作用，若属性改变，必需调用 setPropValues()
     * @type {?}
     */
    WidgetComponent.prototype.propValues;
    /** @type {?} */
    WidgetComponent.prototype.linkMap;
    /**
     * 可选
     * @type {?}
     */
    WidgetComponent.prototype.mode;
    /**
     * 可选，widget 的静态资源地址，一般不用管，特殊情况可配置，默认值为 this.basicWidgetInfo.baseUrl + '/assets/'
     * @type {?}
     */
    WidgetComponent.prototype.assetsBaseUrl;
    /**
     * 可选，部件信息，需要注入到元部件
     * @type {?}
     */
    WidgetComponent.prototype.portlet;
    /**
     * 可选，部件实例 id, 获取数据可能用到
     * @type {?}
     */
    WidgetComponent.prototype.instanceId;
    /**
     * 必选，
     * 若指定，则元部件主动加载数据时使用它获取数据，
     * 不再加载真实数据。用于给元部件设置假数据
     * @type {?}
     */
    WidgetComponent.prototype.getData;
    /** @type {?} */
    WidgetComponent.prototype.status;
    /**
     * widget 加载完成，发出当前 widget 的信息
     * @type {?}
     */
    WidgetComponent.prototype.widgetLoaded;
    /**
     * widget component create 完成，发出当前 widget 的信息
     * @type {?}
     */
    WidgetComponent.prototype.widgetInit;
    /** @type {?} */
    WidgetComponent.prototype.runtimeAggChange;
    /** @type {?} */
    WidgetComponent.prototype.resizeTarget;
    /** @type {?} */
    WidgetComponent.prototype.widgetContainer;
    /** @type {?} */
    WidgetComponent.prototype.titleBar;
    /** @type {?} */
    WidgetComponent.prototype.WCStatus;
    /** @type {?} */
    WidgetComponent.prototype.IGIX_HOME_PATH;
    /** @type {?} */
    WidgetComponent.prototype.FILTER_PROP_NAME;
    /** @type {?} */
    WidgetComponent.prototype.width;
    /** @type {?} */
    WidgetComponent.prototype.height;
    /** @type {?} */
    WidgetComponent.prototype.curWidgetConfig;
    /**
     * 存在此层的数据。可用于前端筛选、数据获取状态判断
     * @type {?}
     */
    WidgetComponent.prototype.data;
    /**
     * 获取数据后存起来的维度。可用于页面设计时、运行时获取、显示维度
     * @type {?}
     */
    WidgetComponent.prototype.dims;
    /** @type {?} */
    WidgetComponent.prototype.widgetInstance;
    /** @type {?} */
    WidgetComponent.prototype.showRuntimeAgg;
    /**
     * @type {?}
     * @private
     */
    WidgetComponent.prototype.widgetDataService;
    /**
     * pv 中包含 {fs,dp}[]（筛选控件+取数参数=筛选）
     * 部件实例中保存 {fs,dp}: filterValue
     * @type {?}
     */
    WidgetComponent.prototype.dpValues;
    /** @type {?} */
    WidgetComponent.prototype.handleDataError;
    /** @type {?} */
    WidgetComponent.prototype.filterValues;
    /**
     * 此 runtimeAgg 存储当前运行时用户选的、最新的 runtimeAgg。
     * extra 中的是存储在部件中的。
     * widget 不负责把 runtimeAgg 放到 extra 里，因为这里不确定是否需要持久化。
     * @type {?}
     */
    WidgetComponent.prototype.runtimeAgg;
    /**
     * @type {?}
     * @private
     */
    WidgetComponent.prototype.loader;
    /**
     * @type {?}
     * @private
     */
    WidgetComponent.prototype.cd;
    /**
     * @type {?}
     * @private
     */
    WidgetComponent.prototype.injector;
    /**
     * @type {?}
     * @private
     */
    WidgetComponent.prototype.modal;
    /**
     * @type {?}
     * @private
     */
    WidgetComponent.prototype.http;
    /**
     * @type {?}
     * @private
     */
    WidgetComponent.prototype.translate;
    /**
     * @type {?}
     * @private
     */
    WidgetComponent.prototype.widgetPropertyService;
    /**
     * @type {?}
     * @private
     */
    WidgetComponent.prototype.widgetEventService;
    /**
     * @type {?}
     * @private
     */
    WidgetComponent.prototype.insSerivce;
}
/**
 * newDpValues 合并到 this.dpValues，同 dpId 覆盖。
 * 此方法会改变 oldDpValues。
 * @param {?} oldDpValues
 * @param {?} newDpValues
 * @return {?}
 */
function mergeDpValues(oldDpValues, newDpValues) {
    var e_1, _a;
    var _loop_1 = function (newDV) {
        /** @type {?} */
        var targetOldDV = oldDpValues.find((/**
         * @param {?} oldDV
         * @return {?}
         */
        function (oldDV) { return oldDV.dpId === newDV.dpId; }));
        if (targetOldDV) {
            targetOldDV.value = newDV.value;
        }
        else {
            oldDpValues.push(newDV);
        }
    };
    try {
        for (var _b = tslib_1.__values(newDpValues.filter((/**
         * @param {?} dv
         * @return {?}
         */
        function (dv) { return dv.dpId; }))), _c = _b.next(); !_c.done; _c = _b.next()) {
            var newDV = _c.value;
            _loop_1(newDV);
        }
    }
    catch (e_1_1) { e_1 = { error: e_1_1 }; }
    finally {
        try {
            if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
        }
        finally { if (e_1) throw e_1.error; }
    }
}
/**
 * @param {?=} oldDpValues
 * @param {?=} newDpValues
 * @return {?}
 */
function mergeDpValuesForNew(oldDpValues, newDpValues) {
    if (oldDpValues === void 0) { oldDpValues = []; }
    if (newDpValues === void 0) { newDpValues = []; }
    /** @type {?} */
    var result = oldDpValues.slice();
    mergeDpValues(result, newDpValues);
    return result;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2lkZ2V0LmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0Bnc3B3aWRnZXQvd2lkZ2V0LWNvcmUvIiwic291cmNlcyI6WyJsaWIvd2lkZ2V0L3dpZGdldC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFDbEQsT0FBTyxFQUNMLGlCQUFpQixFQUFFLFNBQVMsRUFDNUIsWUFBWSxFQUFFLFFBQVEsRUFBRSxLQUFLLEVBRTdCLE1BQU0sRUFBaUIsU0FBUyxFQUFFLGdCQUFnQixFQUNuRCxNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQXFELFVBQVUsRUFBRSxtQkFBbUIsRUFBRSx3QkFBd0IsRUFBMEIsY0FBYyxFQUFXLHFCQUFxQixFQUF3QyxtQkFBbUIsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQ2xSLE9BQU8sRUFFTCxZQUFZLEVBQ1osZ0JBQWdCLEVBQ29CLGlCQUFpQixFQUFFLGtCQUFrQixFQUFFLGtCQUFrQixFQUFFLHFCQUFxQixFQUNySCxNQUFNLDBCQUEwQixDQUFDO0FBQ2xDLE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQ3ZELE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUNyRCxPQUFPLGNBQWMsTUFBTSwwQkFBMEIsQ0FBQztBQUV0RCxPQUFPLEVBQUUsS0FBSyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDdkMsT0FBTyxFQUFFLG9CQUFvQixFQUFFLE1BQU0sMkJBQTJCLENBQUM7QUFDakUsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQ3RELE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLGtDQUFrQyxDQUFDO0FBQ3JFLE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSx3QkFBd0IsRUFBRSxNQUFNLGVBQWUsQ0FBQzs7Ozs7O0lBSXJFLGNBQWMsR0FB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QzdCLG1DQUEwQjs7Ozs7SUFDMUIsZ0NBQTZCOzs7OztJQUM3QiwrQkFBd0I7Ozs7O0lBQ3hCLG9DQUFtQzs7Ozs7SUFDbkMsZ0RBQW9EOzs7OztJQUNwRCw2Q0FBOEM7Ozs7O0lBQzlDLHFDQUFtQzs7Ozs7Ozs7O0FBbVd2QyxTQUFTLGFBQWEsQ0FBRSxXQUFzQixFQUFFLFdBQXNCOzs0QkFDekQsS0FBSzs7WUFDUixXQUFXLEdBQUcsV0FBVyxDQUFDLElBQUk7Ozs7UUFBQyxVQUFBLEtBQUssSUFBSSxPQUFBLEtBQUssQ0FBQyxJQUFJLEtBQUssS0FBSyxDQUFDLElBQUksRUFBekIsQ0FBeUIsRUFBQztRQUN4RSxJQUFJLFdBQVcsRUFBRTtZQUNmLFdBQVcsQ0FBQyxLQUFLLEdBQUcsS0FBSyxDQUFDLEtBQUssQ0FBQTtTQUNoQzthQUFNO1lBQ0wsV0FBVyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQTtTQUN4Qjs7O1FBTkgsS0FBb0IsSUFBQSxLQUFBLGlCQUFBLFdBQVcsQ0FBQyxNQUFNOzs7O1FBQUMsVUFBQSxFQUFFLElBQUksT0FBQSxFQUFFLENBQUMsSUFBSSxFQUFQLENBQU8sRUFBQyxDQUFBLGdCQUFBO1lBQWhELElBQU0sS0FBSyxXQUFBO29CQUFMLEtBQUs7U0FPZjs7Ozs7Ozs7O0FBQ0gsQ0FBQzs7Ozs7O0FBQ0QsU0FBUyxtQkFBbUIsQ0FBRSxXQUEyQixFQUFFLFdBQTJCO0lBQXhELDRCQUFBLEVBQUEsZ0JBQTJCO0lBQUUsNEJBQUEsRUFBQSxnQkFBMkI7O1FBQzlFLE1BQU0sR0FBRyxXQUFXLENBQUMsS0FBSyxFQUFFO0lBQ2xDLGFBQWEsQ0FBQyxNQUFNLEVBQUUsV0FBVyxDQUFDLENBQUE7SUFDbEMsT0FBTyxNQUFNLENBQUE7QUFDZixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSHR0cENsaWVudCB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbi9odHRwJztcbmltcG9ydCB7XG4gIENoYW5nZURldGVjdG9yUmVmLCBDb21wb25lbnQsXG4gIEV2ZW50RW1pdHRlciwgSW5qZWN0b3IsIElucHV0LFxuICBPbkNoYW5nZXMsIE9uSW5pdCxcbiAgT3V0cHV0LCBTaW1wbGVDaGFuZ2VzLCBWaWV3Q2hpbGQsIFZpZXdDb250YWluZXJSZWZcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBCYXNpY1dpZGdldEluZm8sIERhdGFXaXRoRGltcywgRGltZW5zaW9uLCBEcFZhbHVlLCBFcHBQb3J0bGV0LCBGSUxURVJTX1dJREdFVF9OQU1FLCBGSUxURVJTX1dJREdFVF9QUk9QX05BTUUsIEZpbHRlcldpZGdldEV2ZW50UGFyYW0sIElHSVhfSE9NRV9QQVRILCBMaW5rTWFwLCBsb2FkQ29tbW9uU3R5bGVOVGhlbWUsIG9iamVjdExpdGVyYWxFcXVhbCwgUnVudGltZUFnZ09wdGlvbiwgV2lkZ2V0Q29udGFpbmVyTW9kZSB9IGZyb20gJ0Bnc3B3aWRnZXQvdXRpbCc7XG5pbXBvcnQge1xuICBGaWx0ZXJDb25maWcsXG4gIEZpbHRlclNjaGVtYSxcbiAgRklMVEVSX1BST1BfTkFNRSxcbiAgUmVnaXN0ZXJlZFdpZGdldENvbmZpZywgV2lkZ2V0QmFzZSwgV2lkZ2V0RGF0YVNlcnZpY2UsIFdpZGdldEV2ZW50U2VydmljZSwgV2lkZ2V0SW5zdGFuY2VJbmZvLCBXaWRnZXRQcm9wZXJ0eVNlcnZpY2Vcbn0gZnJvbSAnQGdzcHdpZGdldC93aWRnZXQtZGV2a2l0JztcbmltcG9ydCB7IFRyYW5zbGF0ZVNlcnZpY2UgfSBmcm9tICdAbmd4LXRyYW5zbGF0ZS9jb3JlJztcbmltcG9ydCB7IE56TW9kYWxTZXJ2aWNlIH0gZnJvbSAnbmctem9ycm8tYW50ZC9tb2RhbCc7XG5pbXBvcnQgUmVzaXplT2JzZXJ2ZXIgZnJvbSAncmVzaXplLW9ic2VydmVyLXBvbHlmaWxsJztcbmltcG9ydCB7IE9ic2VydmFibGUgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IGRlbGF5IH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuaW1wb3J0IHsgRHluYW1pY0xvYWRlclNlcnZpY2UgfSBmcm9tICcuLi9keW5hbWljLWxvYWRlci5zZXJ2aWNlJztcbmltcG9ydCB7IEluc3RhbmNlU2VydmljZSB9IGZyb20gJy4uL2luc3RhbmNlLnNlcnZpY2UnO1xuaW1wb3J0IHsgVGl0bGVCYXJDb21wb25lbnQgfSBmcm9tICcuLi90aXRsZS1iYXIvdGl0bGUtYmFyLmNvbXBvbmVudCc7XG5pbXBvcnQgeyBjaGFydEFnZ0ZpZWxkTWFwLCBpc1dpZGdldFJ1bnRpbWVBZ2dBY3RpdmUgfSBmcm9tICcuL3J1bnRpbWUtYWdnJztcblxuICAvKiog5bey6KKrIHNldCDnv7vor5HnmoQgbGFuZ++8jOS4i+asoeS4jeWGjeivt+axguatpCBsYW5nICovXG4gIC8vIHByaXZhdGUgbGFuZ3NTZXQ6IHsgW3dpZGdldE5hbWU6IHN0cmluZ106IHN0cmluZ1tdIH0gPSB7fVxuY29uc3QgbG9hZGVkSTE4blVybHM6IHN0cmluZ1tdID0gW11cblxuZGVjbGFyZSBnbG9iYWwge1xuICBpbnRlcmZhY2UgV2luZG93IHtcbiAgICB3aWRnZXRJMThuUmVzTG9hZGVkOiBib29sZWFuXG4gICAgd2lkZ2V0U3R5bGVMb2FkZWQ6IGJvb2xlYW5cbiAgICBkZWZpbmU6IGFueVxuICB9XG59XG5leHBvcnQgZW51bSBXQ1N0YXR1cyB7XG4gIExvYWRpbmdXaWRnZXQsXG4gIExvYWRpbmdEYXRhLFxuICBEYXRhRW1wdHksXG4gIE5vcm1hbCxcbiAgRGF0YUVycm9yLFxuICBXaWRnZXRMb2FkRXJyb3IsXG59XG5leHBvcnQgaW50ZXJmYWNlIEdldERhdGFPcHRpb25zIHtcbiAgZHBWYWx1ZXM6IERwVmFsdWVbXSxcbiAgcnVudGltZUFnZzogUnVudGltZUFnZ09wdGlvblxufVxuXG5sb2FkQ29tbW9uU3R5bGVOVGhlbWUoKVxuLyoqXG4gKiDlhbzlrrnpmLbmrrXmlbDmja7liqDovb3pgLvovpFcbiAqIDEuIOiLpeWFg+mDqOS7tiB1c2VEYXRhRW5naW5lID09PSB0cnVlLCDor7TmmI7mmK/ogIHlhpnms5XjgIHkuJTpnIDopoHmlbDmja7nmoTlhYPpg6jku7bvvIzkvYblhbblhoXpg6jmnKrosIPnlKjliqDovb3mlbDmja7vvIzmiYDku6XliJ3lp4vljJblrozmiJDlkI7liqDovb3kuIDkuIvvvJtcbiAqICAgIOaWsOaVsOaNruWKoOi9veivt+axguWkhOeQhuawuOi/nOWQr+eUqO+8jOWboOS4uuS7heacieaWsOWGmeazleWFg+mDqOS7tuS8muinpuWPke+8m1xuICogMi4g6IulIGdldERhdGEg5pyJ5YC877yM5YiZ55So5a6D6I635b6X5pWw5o2u77yM5LiN55So55yf5pWw5o2uXG4gKiAzLiDoi6XlkI3kuK3luKbmnIkgJ+a8lOekuifvvIzliJnnlKjmvJTnpLrmlbDmja5cbiAqIDQuIOmDveS4jea7oei2s+WGjeeUqOecn+aVsOaNrlxuICovXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdsaWItd2lkZ2V0JyxcbiAgdGVtcGxhdGVVcmw6ICcuL3dpZGdldC5jb21wb25lbnQuaHRtbCcsXG4gIHN0eWxlVXJsczogWycuL3dpZGdldC5jb21wb25lbnQuc2NzcyddXG59KVxuZXhwb3J0IGNsYXNzIFdpZGdldENvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgT25DaGFuZ2VzIHtcbiAgLyoqIOW/hemAie+8jOimgea4suafk+eahCB3aWRnZXQg5L+h5oGvICovXG4gIEBJbnB1dCgpIGJhc2ljV2lkZ2V0SW5mbzogQmFzaWNXaWRnZXRJbmZvXG4gIC8qKiDlv4XpgInvvIzmraQgd2lkZ2V0IOeahOmFjee9ruS/oeaBr++8m+S7heWcqOWFg+mDqOS7tuWKoOi9veaXtui1t+S9nOeUqO+8jOiLpeWxnuaAp+aUueWPmO+8jOW/hemcgOiwg+eUqCBzZXRQcm9wVmFsdWVzKCkgKi9cbiAgQElucHV0KCkgcHJvcFZhbHVlc1xuICBASW5wdXQoKSBsaW5rTWFwOiBMaW5rTWFwXG4gIC8qKiDlj6/pgIkgKi9cbiAgQElucHV0KCkgbW9kZSA9IFdpZGdldENvbnRhaW5lck1vZGUuQU9UXG4gIC8qKiDlj6/pgInvvIx3aWRnZXQg55qE6Z2Z5oCB6LWE5rqQ5Zyw5Z2A77yM5LiA6Iis5LiN55So566h77yM54m55q6K5oOF5Ya15Y+v6YWN572u77yM6buY6K6k5YC85Li6IHRoaXMuYmFzaWNXaWRnZXRJbmZvLmJhc2VVcmwgKyAnL2Fzc2V0cy8nICovXG4gIEBJbnB1dCgpIGFzc2V0c0Jhc2VVcmw6IHN0cmluZ1xuICAvLyBUT0RPOiDop6PogKYgcG9ydGxldFxuICAvKiog5Y+v6YCJ77yM6YOo5Lu25L+h5oGv77yM6ZyA6KaB5rOo5YWl5Yiw5YWD6YOo5Lu2ICovXG4gIEBJbnB1dCgpIHBvcnRsZXQ6IEVwcFBvcnRsZXQgPSBuZXcgRXBwUG9ydGxldChudWxsKVxuICAvKiog5Y+v6YCJ77yM6YOo5Lu25a6e5L6LIGlkLCDojrflj5bmlbDmja7lj6/og73nlKjliLAgKi9cbiAgQElucHV0KCkgaW5zdGFuY2VJZDogc3RyaW5nXG4gIC8qKlxuICAgKiDlv4XpgInvvIxcbiAgICog6Iul5oyH5a6a77yM5YiZ5YWD6YOo5Lu25Li75Yqo5Yqg6L295pWw5o2u5pe25L2/55So5a6D6I635Y+W5pWw5o2u77yMXG4gICAqIOS4jeWGjeWKoOi9veecn+WunuaVsOaNruOAgueUqOS6jue7meWFg+mDqOS7tuiuvue9ruWBh+aVsOaNrlxuICAgKi9cbiAgQElucHV0KCkgZ2V0RGF0YTogKGdldERhdGFPcHRzOiBHZXREYXRhT3B0aW9ucykgPT4gT2JzZXJ2YWJsZTxEYXRhV2l0aERpbXM+XG4gIEBJbnB1dCgpIHN0YXR1cyA9IFdDU3RhdHVzLkxvYWRpbmdXaWRnZXRcblxuICAvKiogd2lkZ2V0IOWKoOi9veWujOaIkO+8jOWPkeWHuuW9k+WJjSB3aWRnZXQg55qE5L+h5oGvICovXG4gIEBPdXRwdXQoKSB3aWRnZXRMb2FkZWQgPSBuZXcgRXZlbnRFbWl0dGVyKClcbiAgLyoqIHdpZGdldCBjb21wb25lbnQgY3JlYXRlIOWujOaIkO+8jOWPkeWHuuW9k+WJjSB3aWRnZXQg55qE5L+h5oGvICovXG4gIEBPdXRwdXQoKSB3aWRnZXRJbml0ID0gbmV3IEV2ZW50RW1pdHRlcigpXG4gIEBPdXRwdXQoKSBydW50aW1lQWdnQ2hhbmdlID0gbmV3IEV2ZW50RW1pdHRlcigpXG4gIC8vIFRPRE86IOiAg+iZkeWOu+aOiVxuICAvLyBAT3V0cHV0KCkgdHJpZ2dlckxvYWREYXRhID0gbmV3IEV2ZW50RW1pdHRlcigpXG5cbiAgQFZpZXdDaGlsZCgncmVzaXplVGFyZ2V0JykgcmVzaXplVGFyZ2V0XG4gIEBWaWV3Q2hpbGQoJ3djJywgeyByZWFkOiBWaWV3Q29udGFpbmVyUmVmIH0pIHdpZGdldENvbnRhaW5lcjogVmlld0NvbnRhaW5lclJlZlxuICBAVmlld0NoaWxkKCd0aXRsZUJhcicpIHRpdGxlQmFyOiBUaXRsZUJhckNvbXBvbmVudFxuXG4gIC8vIHB1YmxpYyBpc0xvYWRpbmcgPSB0cnVlXG4gIC8vIHB1YmxpYyBzdGF0dXMgPSBXQ1N0YXR1cy5Ob3JtYWxcbiAgcHVibGljIFdDU3RhdHVzID0gV0NTdGF0dXNcbiAgcHVibGljIElHSVhfSE9NRV9QQVRIID0gSUdJWF9IT01FX1BBVEhcbiAgcHVibGljIEZJTFRFUl9QUk9QX05BTUUgPSBGSUxURVJfUFJPUF9OQU1FXG4gIHB1YmxpYyB3aWR0aDogbnVtYmVyXG4gIHB1YmxpYyBoZWlnaHQ6IG51bWJlclxuICBwdWJsaWMgY3VyV2lkZ2V0Q29uZmlnOiBSZWdpc3RlcmVkV2lkZ2V0Q29uZmlnXG4gIC8vIHB1YmxpYyBmZUZpbHRlclZhbHVlczogRnJvbnRlbmRGaWx0ZXJbXVxuICAvKiog5a2Y5Zyo5q2k5bGC55qE5pWw5o2u44CC5Y+v55So5LqO5YmN56uv562b6YCJ44CB5pWw5o2u6I635Y+W54q25oCB5Yik5patICovXG4gIHB1YmxpYyBkYXRhOiBhbnlbXSA9IG51bGxcbiAgLyoqIOiOt+WPluaVsOaNruWQjuWtmOi1t+adpeeahOe7tOW6puOAguWPr+eUqOS6jumhtemdouiuvuiuoeaXtuOAgei/kOihjOaXtuiOt+WPluOAgeaYvuekuue7tOW6piAqL1xuICBwdWJsaWMgZGltczogRGltZW5zaW9uW11cbiAgcHVibGljIHdpZGdldEluc3RhbmNlOiBXaWRnZXRCYXNlXG4gIHB1YmxpYyBzaG93UnVudGltZUFnZyA9IGZhbHNlXG5cbiAgLy8gcHJpdmF0ZSB3aWRnZXRDb21wb25lbnRSZWY6IENvbXBvbmVudFJlZjxhbnk+XG4gIC8vIHByaXZhdGUgd2lkZ2V0SW5zdGFuY2VJbmZvOiBXaWRnZXRJbnN0YW5jZUluZm9cbiAgcHJpdmF0ZSB3aWRnZXREYXRhU2VydmljZTogV2lkZ2V0RGF0YVNlcnZpY2VcbiAgLyoqIOWFrOWFseWktOS4iuaYr+WQpuaYvuekuui/kOihjOaXtuiBmuWQiOmFjee9riAqL1xuXG4gIGNvbnN0cnVjdG9yIChcbiAgICBwcml2YXRlIGxvYWRlcjogRHluYW1pY0xvYWRlclNlcnZpY2UsXG4gICAgcHJpdmF0ZSBjZDogQ2hhbmdlRGV0ZWN0b3JSZWYsXG4gICAgcHJpdmF0ZSBpbmplY3RvcjogSW5qZWN0b3IsXG4gICAgcHJpdmF0ZSBtb2RhbDogTnpNb2RhbFNlcnZpY2UsXG4gICAgcHJpdmF0ZSBodHRwOiBIdHRwQ2xpZW50LFxuICAgIHByaXZhdGUgdHJhbnNsYXRlOiBUcmFuc2xhdGVTZXJ2aWNlLFxuICAgIHByaXZhdGUgd2lkZ2V0UHJvcGVydHlTZXJ2aWNlOiBXaWRnZXRQcm9wZXJ0eVNlcnZpY2UsXG4gICAgcHJpdmF0ZSB3aWRnZXRFdmVudFNlcnZpY2U6IFdpZGdldEV2ZW50U2VydmljZSxcbiAgICBwcml2YXRlIGluc1Nlcml2Y2U6IEluc3RhbmNlU2VydmljZSxcbiAgKSB7XG4gICAgdGhpcy5faW5pdFdpZGdldEVudigpXG4gIH1cbiAgLyoqXG4gICAqIOWFqOWxgOWIneWni+WMllxuICAgKi9cbiAgcHJpdmF0ZSBfaW5pdFdpZGdldEVudiAoKSB7XG4gICAgLy8gaTE4blxuICAgIGlmICghdGhpcy50cmFuc2xhdGUuZGVmYXVsdExhbmcpIHRoaXMudHJhbnNsYXRlLnNldERlZmF1bHRMYW5nKCd6aC1DSFMnKTtcbiAgICBpZiAoIXRoaXMudHJhbnNsYXRlLmN1cnJlbnRMYW5nKSB7XG4gICAgICBjb25zdCBsYW5nID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2xhbmd1YWdlQ29kZScpIHx8ICd6aC1DSFMnXG4gICAgICB0aGlzLnRyYW5zbGF0ZS51c2UobGFuZyB8fCAnemgtQ0hTJylcbiAgICB9XG4gICAgaWYgKCF3aW5kb3cud2lkZ2V0STE4blJlc0xvYWRlZCkge1xuICAgICAgY29uc3QgeyBjdXJyZW50TGFuZyB9ID0gdGhpcy50cmFuc2xhdGVcbiAgICAgIHRoaXMuaHR0cC5nZXQoYCR7SUdJWF9IT01FX1BBVEh9YXNzZXRzL2kxOG4vJHtjdXJyZW50TGFuZ30uanNvbmApLnN1YnNjcmliZShyZXMgPT4ge1xuICAgICAgICB0aGlzLnRyYW5zbGF0ZS5zZXRUcmFuc2xhdGlvbihjdXJyZW50TGFuZywgcmVzLCB0cnVlKVxuICAgICAgfSlcbiAgICAgIHdpbmRvdy53aWRnZXRJMThuUmVzTG9hZGVkID0gdHJ1ZVxuICAgIH1cbiAgfVxuXG4gIG5nT25Jbml0ICgpIHtcbiAgICB0aGlzLmluc1Nlcml2Y2UuYWRkSW5zSW5mbyh0aGlzLmluc3RhbmNlSWQsIHRoaXMsICd3aWRnZXRDb21wJylcbiAgICAvLyDnm5HlkKwgcmVzaXplVGFyZ2V0IOeahOWkp+Wwj+WPmOWMlu+8jOWPmOWMluaXtuiwg+eUqOWFg+mDqOS7ti5vblJlc2l6ZWQoKe+8jOS8oOWFpSBEb21SZWN0UmVhZG9ubHlcbiAgICBpZiAodGhpcy5yZXNpemVUYXJnZXQpIHtcbiAgICAgIG5ldyBSZXNpemVPYnNlcnZlcihlbnRyaWVzID0+IHtcbiAgICAgICAgY29uc3QgeyB3aWR0aCwgaGVpZ2h0IH0gPSBlbnRyaWVzWzBdLmNvbnRlbnRSZWN0XG4gICAgICAgIGlmICh0aGlzLndpZGdldEluc3RhbmNlKSB0aGlzLndpZGdldEluc3RhbmNlLm9uUmVzaXplZCh3aWR0aCwgaGVpZ2h0KVxuICAgICAgICB0aGlzLndpZHRoID0gd2lkdGhcbiAgICAgICAgdGhpcy5oZWlnaHQgPSBoZWlnaHRcbiAgICAgICAgdGhpcy5jZC5tYXJrRm9yQ2hlY2soKVxuICAgICAgfSkub2JzZXJ2ZSh0aGlzLnJlc2l6ZVRhcmdldC5uYXRpdmVFbGVtZW50KVxuICAgIH1cbiAgfVxuXG4gIG5nT25DaGFuZ2VzIChjOiBTaW1wbGVDaGFuZ2VzKSB7XG4gICAgY29uc3QgeyBiYXNpY1dpZGdldEluZm8gfSA9IGNcbiAgICBpZiAoYmFzaWNXaWRnZXRJbmZvICYmIGJhc2ljV2lkZ2V0SW5mby5jdXJyZW50VmFsdWUgJiYgYmFzaWNXaWRnZXRJbmZvLmN1cnJlbnRWYWx1ZSAhPT0gYmFzaWNXaWRnZXRJbmZvLnByZXZpb3VzVmFsdWUpIHtcbiAgICAgIC8vIHdpZGdldCDlj5jkuobvvIzmuLLmn5PmlrDlhYPpg6jku7ZcbiAgICAgIHRoaXMucmVuZGVyV2lkZ2V0KClcbiAgICB9XG4gIH1cbiAgLyoqXG4gICAqIOatpCBjb250YWluZXIg6KKrIGdyaWRzdGVyIOa4suafk+WHuuato+ehrueahOWkp+Wwj+S6i+S7tlxuICAgKi9cbiAgcHVibGljIHRyaWdnZXJXaWRnZXRSZXNpemUgKCkge1xuICAgIGlmICh0aGlzLndpZGdldEluc3RhbmNlICYmIHRoaXMud2lkZ2V0SW5zdGFuY2Uub25SZXNpemVkKSB7XG4gICAgICBjb25zdCB7IGNsaWVudFdpZHRoLCBjbGllbnRIZWlnaHQgfSA9IHRoaXMucmVzaXplVGFyZ2V0Lm5hdGl2ZUVsZW1lbnRcbiAgICAgIHRoaXMud2lkZ2V0SW5zdGFuY2Uub25SZXNpemVkKGNsaWVudFdpZHRoLCBjbGllbnRIZWlnaHQpXG4gICAgfVxuICB9XG4gIC8vIFRPRE86IOi/meS6m+mDveaUuemAoOaIkO+8jOWPguaVsOS4uuS4gOS4quWvueixoe+8jOmHjOmdouWPr+S7peS4gOasoeWhnuWkmuS4quWxnuaApy3lgLzvvIzlhajpg6jmm7TmlrDlkI7lho3op6blj5Egb25Qcm9wZXJ0eUNoYW5nZe+8jFxuICAvLyDlkKbliJnlg4/liJ3lp4vljJblrozopoHotYvlpJrkuKrlgLznmoTmg4XlhrXvvIzpgJrnn6Xop6blj5HlpKrpopHnuYHkuobvvIzkuZ/kvJrlr7zoh7TpopHnuYHop6blj5HlhYPpg6jku7bmuLLmn5PjgIHmlbDmja7liqDovb1cbiAgLyoqXG4gICAqIOWklumDqOabtOaWsOWFg+mDqOS7tiBwcm9wVmFsdWVzIOeahOafkOWxnuaAp+WQju+8jOmcgOimgeiwg+eUqOatpOaWueazle+8jOWQpuWImeaIkeS7rOS4jeefpemBkyBwcm9wVmFsdWVzIOWPkeeUn+S6huWPmOWMluOAglxuICAgKiDkuI3lpKrlpb3nsr7nroDmjonov5nkuKrmlrnms5XjgILlsJ3or5Xov4fnlKgga2V5VmFsdWVEaWZmZXIg5ZyoIG5nRG9DaGVjayDkuK3mo4DmtYsgcHJvcFZhbHVlcyDlj5jljJbvvIzkvYbku4Xog73mo4DmtYvkuIDlsYLjgIJcbiAgICovXG4gIHB1YmxpYyBzZXRQcm9wZXJ0eVZhbHVlIChwcm9wTmFtZTogc3RyaW5nLCBwVmFsdWUpIHtcbiAgICAvLyBUT0RPOiBwb3J0bGV0IOe7k+aehOaUueWPmOWQju+8jOWPr+S7peecgeWOu+i/meS4gOatpe+8ml9fZXh0cmEg5bqU6K+l5qC55pys5LiN5Lya5Lyg6L+b5p2lXG4gICAgaWYgKHByb3BOYW1lID09PSAnX19leHRyYScpIHJldHVyblxuICAgIC8vIOWmguaenOS4jeaYryBvYmplY3TvvIzliJnliKTmlq3lgLzlpoLmnpwgcFZhbHVlIOS4juW9k+WJjeWFg+mDqOS7tuWunuS+i+S4reebuOWQjO+8jOWwseS4jeS8oOe7memDqOS7tuS6hlxuICAgIGlmICh0eXBlb2YgcFZhbHVlICE9PSAnb2JqZWN0JyAmJiB0aGlzLndpZGdldEluc3RhbmNlW3Byb3BOYW1lXSA9PT0gcFZhbHVlKSByZXR1cm5cbiAgICAvLyBUT0RPOiDpg6jku7bphY3nva7ml7bvvIzov5DooYzml7bmm7TmlLnor63oqIDnmoTlpITnkIZcbiAgICBjb25zdCB2YWx1ZSA9IHRoaXMucHJvY2Vzc1BWKHBWYWx1ZSlcbiAgICAvLyDmlLnlgLxcbiAgICB0aGlzLndpZGdldEluc3RhbmNlW3Byb3BOYW1lXSA9IHZhbHVlXG4gICAgLy8g6YCa55+l77yM5Zug5Li65YWD6YOo5Lu25Y+v6IO96ZyA6KaB6L+Z5Liq5pe25py6XG4gICAgLy8g6Ziy5q2i5rKh5pyJ6L+Z5Liq5pa55rOV55qE6ICB5YWD6YOo5Lu25oql6ZSZ77yM5ZCO6Z2i6YO95Lya5Y2H57qn5o6JXG4gICAgaWYgKHRoaXMud2lkZ2V0SW5zdGFuY2Uub25Qcm9wZXJ0eUNoYW5nZSkge1xuICAgICAgdGhpcy53aWRnZXRJbnN0YW5jZS5vblByb3BlcnR5Q2hhbmdlKHByb3BOYW1lLCB2YWx1ZSlcbiAgICB9XG4gICAgaWYgKHByb3BOYW1lID09PSBGSUxURVJfUFJPUF9OQU1FKSB7XG4gICAgICB0aGlzLmRwVmFsdWVzID0gKHBWYWx1ZSBhcyBGaWx0ZXJDb25maWdbXSlcbiAgICAgICAgLmZpbHRlcihkdiA9PiBkdi5kcElkKVxuICAgICAgICAubWFwKGZjID0+ICh7XG4gICAgICAgICAgdmFsdWU6IEZpbHRlclNjaGVtYS5nZXREZWZhdWx0VmFsdWUoZmMuZnMpLFxuICAgICAgICAgIGRwSWQ6IGZjLmRwSWRcbiAgICAgICAgfSkpXG4gICAgICAvLyBUT0RPOlxuXG4gICAgICAvLyBpZiAocFZhbHVlICYmIHBWYWx1ZS5zbGljZSkgdGhpcy5wcm9wVmFsdWVzW0ZJTFRFUl9QUk9QX05BTUVdID0gcFZhbHVlLnNsaWNlKClcbiAgICAgIC8vIHRoaXMuY2QubWFya0ZvckNoZWNrKClcbiAgICB9XG4gICAgaWYgKCF0aGlzLnByb3BWYWx1ZXMpIHRoaXMucHJvcFZhbHVlcyA9IHt9XG4gICAgdGhpcy5wcm9wVmFsdWVzW3Byb3BOYW1lXSA9IHBWYWx1ZVxuICAgIHRoaXMuY2QubWFya0ZvckNoZWNrKClcbiAgfVxuXG4gIC8qIOmAkuW9kuajgOafpSBwdu+8jOWBmueJueauiuWkhOeQhu+8jOavlOWmguWbvemZheWMluOAgeW4ruWKqSAqL1xuICBwcml2YXRlIHByb2Nlc3NQViAodmFsdWUpIHtcbiAgICBjb25zdCB7IGN1cnJlbnRMYW5nIH0gPSB0aGlzLnRyYW5zbGF0ZVxuICAgIHRyeSB7XG4gICAgICB2YWx1ZSA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkodmFsdWUpKVxuICAgIH0gY2F0Y2ggKGUpIHsgfVxuICAgIHJldHVybiBfcHJvY2Vzc1BWUmVjdXJzaXZlbHkodmFsdWUpXG5cbiAgICBmdW5jdGlvbiBfcHJvY2Vzc1BWUmVjdXJzaXZlbHkgKHBWYWx1ZSkge1xuICAgICAgaWYgKEFycmF5LmlzQXJyYXkocFZhbHVlKSkge1xuICAgICAgICBwVmFsdWUuZm9yRWFjaCgodiwgaSkgPT4ge1xuICAgICAgICAgIHBWYWx1ZVtpXSA9IF9wcm9jZXNzUFZSZWN1cnNpdmVseSh2KVxuICAgICAgICB9KVxuICAgICAgICByZXR1cm4gcFZhbHVlXG4gICAgICAgIC8vIGkxOG46IOWmguaenCB2YWx1ZSDkuK3ljIXlkKsgZW4g5oiWIHpoLUNIUyDmiJYg5b2T5YmN6K+t6KiA55qEa2V577yM5YiZ5pivIGkxOG4g5a2X5q61XG4gICAgICB9IGVsc2UgaWYgKHBWYWx1ZSAmJiAhcFZhbHVlLl9ub3RQcm9jZXNzICYmIHR5cGVvZiAocFZhbHVlLmVuICsgcFZhbHVlWyd6aC1DSFMnXSArIHBWYWx1ZVtjdXJyZW50TGFuZ10pID09PSAnc3RyaW5nJykge1xuICAgICAgICByZXR1cm4gcFZhbHVlW2N1cnJlbnRMYW5nXVxuICAgICAgICAvLyBoZWxwXG4gICAgICB9IGVsc2UgaWYgKHBWYWx1ZSAmJiBwVmFsdWUuX190eXBlID09PSAnaGVscCcpIHtcbiAgICAgICAgcmV0dXJuIHBWYWx1ZS52YWx1ZVxuICAgICAgfSBlbHNlIGlmIChwVmFsdWUgJiYgWydPYmplY3QnXS5pbmNsdWRlcyhwVmFsdWUuY29uc3RydWN0b3IubmFtZSkpIHtcbiAgICAgICAgT2JqZWN0LmtleXMocFZhbHVlKS5mb3JFYWNoKGtleSA9PiB7XG4gICAgICAgICAgcFZhbHVlW2tleV0gPSBfcHJvY2Vzc1BWUmVjdXJzaXZlbHkocFZhbHVlW2tleV0pXG4gICAgICAgIH0pXG4gICAgICAgIHJldHVybiBwVmFsdWVcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBwVmFsdWVcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgcHVibGljIGFzeW5jIHJlbmRlcldpZGdldCAoKSB7XG4gICAgLy8g5Yqg6L295riy5p+T6L+Z5LiqIHdpZGdldCDpnIDopoHnmoTkuIDliIflhYPmlbDmja5cbiAgICBjb25zdCB7IGJhc2VVcmwgfSA9IHRoaXMuYmFzaWNXaWRnZXRJbmZvXG4gICAgY29uc3QgY3VyV2lkZ2V0RGF0YSA9IGF3YWl0IHRoaXMubG9hZGVyLmxvYWRXaWRnZXQodGhpcy5iYXNpY1dpZGdldEluZm8sIHRoaXMucHJvcFZhbHVlcywgdGhpcy5tb2RlKVxuICAgIC8vIFRPRE86IHByb3BWYWx1ZXMg5piv5LiN5piv5LiN55So57uP6L+HIGxvYWRlcu+8jOebtOaOpeiwgyB3aWRnZXRQcm9wU2VydmljZSDojrflj5blsLHooYzvvJ9cbiAgICBjb25zdCB7IHdpZGdldENvbXBGYWN0b3J5LCB3aWRnZXRNb2R1bGVGYWN0b3J5LCBwcm9wVmFsdWVzLCB3aWRnZXRDb25maWcgfSA9IGN1cldpZGdldERhdGFcbiAgICB0aGlzLmN1cldpZGdldENvbmZpZyA9IHdpZGdldENvbmZpZ1xuICAgIHRoaXMuaW5pdFJ1bnRpbWVBZ2coKVxuICAgIGlmICh0aGlzLmN1cldpZGdldENvbmZpZy5lbmFibGVMb2FkaW5nSTE4bikgdGhpcy5sb2FkSTE4blJlcygpXG4gICAgLy8g5YWD6YOo5Lu25Yqg6L295a6M5oiQ5LqL5Lu2XG4gICAgdGhpcy53aWRnZXRMb2FkZWQuZW1pdChjdXJXaWRnZXREYXRhKVxuICAgIC8vIOWIoOiAgeWFg+mDqOS7tlxuICAgIHRoaXMud2lkZ2V0Q29udGFpbmVyLnJlbW92ZSgpXG4gICAgLy8g5Yib5bu65rOo5YWl5ZmoXG4gICAgY29uc3QgaW5qZWN0b3IgPSBJbmplY3Rvci5jcmVhdGUoe1xuICAgICAgcHJvdmlkZXJzOiBbe1xuICAgICAgICBwcm92aWRlOiBXaWRnZXRJbnN0YW5jZUluZm8sIC8qKiDlhYPpg6jku7blrp7kvovkv6Hmga8gKi9cbiAgICAgICAgdXNlVmFsdWU6IG5ldyBXaWRnZXRJbnN0YW5jZUluZm8oXG4gICAgICAgICAgdGhpcy5wb3J0bGV0LmlkLFxuICAgICAgICAgIHRoaXMuaW5zdGFuY2VJZCxcbiAgICAgICAgICB0aGlzLmFzc2V0c0Jhc2VVcmwgfHwgdGhpcy5iYXNpY1dpZGdldEluZm8uYmFzZVVybCArICcvYXNzZXRzLycsXG4gICAgICAgIClcbiAgICAgIH0sIHtcbiAgICAgICAgcHJvdmlkZTogV2lkZ2V0RGF0YVNlcnZpY2UsIC8qKiDlhYPpg6jku7bmlbDmja7mnI3liqEgKi9cbiAgICAgICAgdXNlRmFjdG9yeTogKCkgPT4ge1xuICAgICAgICAgIHRoaXMud2lkZ2V0RGF0YVNlcnZpY2UgPSBuZXcgV2lkZ2V0RGF0YVNlcnZpY2UoKVxuICAgICAgICAgIHRoaXMud2lkZ2V0RGF0YVNlcnZpY2Uub25Mb2FkRGF0YVxuICAgICAgICAgICAgLnBpcGUoZGVsYXkoMCkpIC8vIOS4uumBv+WFjeeUqCBvZihkYXRhKSDkvJrlkIzmraXov5Tlm57mlbDmja7vvIzlr7zoh7QgZGF0YSBzZXJ2aWNlIOS4reeahCBvbkdldERhdGEg6L+Y5rKh6L+U5Zue5Yiw5YWD6YOo5Lu25omL6YeM5bCx6Kem5Y+R5a6M5LqGXG4gICAgICAgICAgICAuc3Vic2NyaWJlKHRoaXMubG9hZE5TZXREYXRhLmJpbmQodGhpcykpXG4gICAgICAgICAgcmV0dXJuIHRoaXMud2lkZ2V0RGF0YVNlcnZpY2VcbiAgICAgICAgfSxcbiAgICAgICAgZGVwczogW11cbiAgICAgIH1dLFxuICAgICAgcGFyZW50OiB0aGlzLmluamVjdG9yXG4gICAgfSlcbiAgICAvLyDliJvlu7rjgIHmjILovb0gd2lkZ2V0IOe7hOS7tlxuICAgIHRoaXMud2lkZ2V0SW5zdGFuY2UgPSB0aGlzLndpZGdldENvbnRhaW5lci5jcmVhdGVDb21wb25lbnQoXG4gICAgICB3aWRnZXRDb21wRmFjdG9yeSwgMCwgaW5qZWN0b3IsIHVuZGVmaW5lZCxcbiAgICAgIHdpZGdldE1vZHVsZUZhY3RvcnkgJiYgd2lkZ2V0TW9kdWxlRmFjdG9yeS5jcmVhdGUodGhpcy5pbmplY3RvcilcbiAgICApLmluc3RhbmNlIGFzIFdpZGdldEJhc2VcblxuICAgIC8vIOiuvue9riB3aWRnZXQg55qEIHByb3BlcnRpZXMg55qEIHZhbHVlc1xuICAgIC8vIFRPRE86IOaUueS4uuS4gOasoemFjeWkmuS4qlxuICAgIE9iamVjdC5rZXlzKHByb3BWYWx1ZXMpLmZvckVhY2gocHJvcCA9PiB7XG4gICAgICB0aGlzLnNldFByb3BlcnR5VmFsdWUocHJvcCwgcHJvcFZhbHVlc1twcm9wXSlcbiAgICB9KVxuXG4gICAgLy8gVE9ETzog5bey5bqf5byD5pa55qGILCDku6XkuIvkuLrov4fmuKHmlrnmoYjku6XlhbzlrrnogIHlhpnms5XlhYPpg6jku7YsIOWQjuacn+Wwhuenu+mZpFxuICAgIHRoaXMud2lkZ2V0SW5zdGFuY2UuaWQgPSB0aGlzLmluc3RhbmNlSWRcbiAgICB0aGlzLndpZGdldEluc3RhbmNlLnBvcnRsZXRJZCA9IHRoaXMucG9ydGxldC5pZFxuICAgIHRoaXMud2lkZ2V0SW5zdGFuY2UuYXNzZXRzQmFzZVVybCA9IHRoaXMuYXNzZXRzQmFzZVVybCB8fCBiYXNlVXJsICsgJy9hc3NldHMvJ1xuICAgIGlmICh0aGlzLndpZGdldEluc3RhbmNlLnVzZURhdGFFbmdpbmUpIHRoaXMubG9hZE5TZXREYXRhKHt9KVxuXG4gICAgLy8gVE9ETzog5a6D5a6M5oiQ5LmL5ZCO5omN566X5L2cIHdpZGdldCDliJ3lp4vljJblrozmiJDvvIzlj6/ku6XmmL7npLrlh7rmnaXjgILlkKbliJnkvJrmmL7npLogY29kZeOAglxuICAgIC8vIHRoaXMuc2V0V2lkZ2V0VHJhbnNsYXRpb24oKVxuICAgIC8vIGV2ZW50XG4gICAgdGhpcy5pbml0V2lkZ2V0RXZlbnRMaXN0ZW5lcigpXG4gICAgLy8g5YWD6YOo5Lu25Yid5aeL5YyW5a6M5oiQ5LqL5Lu2XG4gICAgdGhpcy53aWRnZXRJbml0LmVtaXQoY3VyV2lkZ2V0RGF0YSlcbiAgICAvLyB0aGlzLmlzTG9hZGluZyA9IGZhbHNlXG4gICAgdGhpcy5zdGF0dXMgPSBXQ1N0YXR1cy5Ob3JtYWxcbiAgICB0aGlzLmNkLm1hcmtGb3JDaGVjaygpXG4gIH1cblxuICBwcml2YXRlIGxvYWRJMThuUmVzICgpIHtcbiAgICBjb25zdCB7IGN1cnJlbnRMYW5nIH0gPSB0aGlzLnRyYW5zbGF0ZVxuICAgIGNvbnN0IHsgbmFtZSwgYmFzZVVybCB9ID0gdGhpcy5iYXNpY1dpZGdldEluZm9cbiAgICBjb25zdCB7IGN1c3RvbUkxOG5SZXNvdXJjZVVybCB9ID0gdGhpcy5jdXJXaWRnZXRDb25maWdcbiAgICBjb25zdCBpMThuUmVzVXJsID0gY3VzdG9tSTE4blJlc291cmNlVXJsIHx8IGAke2Jhc2VVcmx9L2Fzc2V0cy9pMThuLyR7Y3VycmVudExhbmd9Lmpzb25gXG5cbiAgICAvLyDnvJPlrZjmm77liqDovb3ov4fnmoTotYTmupDmlofku7blkI3vvIzkuIvmrKHnm7jlkIzmlofku7bkuI3lho3or7fmsYLjgILnvJPlrZjotYTmupDmlofku7blkI3vvIzmmK/lm6DkuLrlj6/og73lpJrkuKrlhYPpg6jku7bmjIflrprnm7jlkIznmoTotYTmupDmlofku7bjgIJcbiAgICBpZiAobG9hZGVkSTE4blVybHMuaW5jbHVkZXMoaTE4blJlc1VybCkpIHJldHVyblxuICAgIGxvYWRlZEkxOG5VcmxzLnB1c2goaTE4blJlc1VybClcblxuICAgIHJldHVybiB0aGlzLmh0dHAuZ2V0KGkxOG5SZXNVcmwpLnRvUHJvbWlzZSgpLnRoZW4ocmVzID0+IHtcbiAgICAgIHRoaXMudHJhbnNsYXRlLnNldFRyYW5zbGF0aW9uKGN1cnJlbnRMYW5nLCByZXMsIHRydWUpXG4gICAgfSwgKCkgPT4ge1xuICAgICAgY29uc29sZS5sb2coYOWFg+mDqOS7tiAke25hbWV9IOaXoCAke2N1cnJlbnRMYW5nfSDnmoTotYTmupDmlofku7ZgKVxuICAgIH0pLmZpbmFsbHkoKCkgPT4ge1xuICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpXG4gICAgfSlcbiAgfVxuICAvKipcbiAgICogcHYg5Lit5YyF5ZCrIHtmcyxkcH1bXe+8iOetm+mAieaOp+S7tivlj5bmlbDlj4LmlbA9562b6YCJ77yJXG4gICAqIOmDqOS7tuWunuS+i+S4reS/neWtmCB7ZnMsZHB9OiBmaWx0ZXJWYWx1ZVxuICAgKi9cbiAgZHBWYWx1ZXM6IERwVmFsdWVbXSA9IFtdXG4gIC8qKlxuICAgKiDloZ7mlbDmja7lhaXlj6MgMS8yOiDliqDovb3mlbDmja7lubbloZ7nu5npg6jku7ZcbiAgICovXG4gIC8vIFRPRE86IGxvYWROU2V0RGF0YSDlj6/og73mmK/kuI3luKblj4LmlbDnmoTjgILlj5bmlbDlj4LmlbDlj6/og73lrZjlnKjlvZPliY0gd2lkZ2V0IOWunuS+i+mHjO+8jOebtOaOpeWPluOAglxuICAvLyBsb2FkTlNldERhdGEg5pyJ5rKh5pyJ5Y+v6IO95bim552A5p2l6Ieq6YOo5Lu255qE6aKd5aSW5Y+C5pWw77yfXG4gIHB1YmxpYyBsb2FkTlNldERhdGEgKHBhcmFtOiB7XG4gICAgZHBWYWx1ZXM/OiBEcFZhbHVlW10sXG4gIH0gPSB7fSkge1xuICAgIGNvbnN0IG9iID0gdGhpcy5nZXREYXRhKHtcbiAgICAgIGRwVmFsdWVzOiBtZXJnZURwVmFsdWVzRm9yTmV3KHRoaXMuZHBWYWx1ZXMsIHBhcmFtLmRwVmFsdWVzKSxcbiAgICAgIHJ1bnRpbWVBZ2c6IHRoaXMucnVudGltZUFnZ1xuICAgIH0pXG4gICAgaWYgKCFvYikgcmV0dXJuXG4gICAgb2Iuc3Vic2NyaWJlKGRhdGFXaXRoRGltcyA9PiB7XG4gICAgICB0aGlzLnNldERhdGEoZGF0YVdpdGhEaW1zKVxuICAgIH0sIHRoaXMuaGFuZGxlRGF0YUVycm9yLmJpbmQodGhpcykpXG4gIH1cbiAgLyoqXG4gICAqIOe7meWFg+mDqOS7tumHjeaWsOiuvue9ruaVsOaNrue7k+aenO+8jOWklumDqOWPr+iwg+eUqOatpOaWueazlee7memDqOS7tuiuvue9ruaVsOaNruOAglxuICAgKi9cbiAgcHVibGljIHNldERhdGEgKHBEYXRhV2l0aERpbXM6IERhdGFXaXRoRGltcykge1xuICAgIGxldCBkYXRhV2l0aERpbXMgPSBwRGF0YVdpdGhEaW1zXG4gICAgLy8gc2V0IGlmIGVtcHR5IHN0YXR1c1xuICAgIGlmICghcERhdGFXaXRoRGltcyB8fCAhcERhdGFXaXRoRGltcy50YWJsZURhdGEgfHwgcERhdGFXaXRoRGltcy50YWJsZURhdGEubGVuZ3RoID09PSAwKSB0aGlzLnN0YXR1cyA9IFdDU3RhdHVzLkRhdGFFbXB0eVxuICAgIC8vIOWmguaenOWklumdouayoeaciee7mSBEYXRhV2l0aERpbXMg6ICM5piv566A5Y2V5pWw5o2u5YiX6KGo77yM5bCx566A5Y2V6L2s5LiA5oqK44CC5Lul5YW85a65IGNvbmZpZyDph4znmoTlgYfmlbDmja7nrYnjgIJcbiAgICBpZiAoIXBEYXRhV2l0aERpbXMuZGltZW5zaW9ucyAmJiBwRGF0YVdpdGhEaW1zWydsZW5ndGgnXSkge1xuICAgICAgZGF0YVdpdGhEaW1zID0ge1xuICAgICAgICBkaW1lbnNpb25zOiBPYmplY3RcbiAgICAgICAgICAua2V5cyhwRGF0YVdpdGhEaW1zWzBdKVxuICAgICAgICAgIC5tYXAoa2V5ID0+ICh7IG5hbWU6IGtleSwgbGFiZWw6IGtleSB9KSksXG4gICAgICAgIHRhYmxlRGF0YTogKHBEYXRhV2l0aERpbXMgYXMgdW5rbm93biBhcyBhbnlbXSlcbiAgICAgIH1cbiAgICB9XG4gICAgdGhpcy5zdGF0dXMgPSBXQ1N0YXR1cy5Ob3JtYWxcbiAgICB0aGlzLmRhdGEgPSBkYXRhV2l0aERpbXMudGFibGVEYXRhXG4gICAgdGhpcy5kaW1zID0gZGF0YVdpdGhEaW1zLmRpbWVuc2lvbnNcblxuICAgIGlmICh0aGlzLndpZGdldERhdGFTZXJ2aWNlKSB0aGlzLndpZGdldERhdGFTZXJ2aWNlLnNldERhdGEoZGF0YVdpdGhEaW1zKVxuICAgIGlmICh0aGlzLndpZGdldEluc3RhbmNlICYmIHRoaXMud2lkZ2V0SW5zdGFuY2UudXNlRGF0YUVuZ2luZSkgdGhpcy53aWRnZXRJbnN0YW5jZS5vbkdldERhdGEoZGF0YVdpdGhEaW1zLnRhYmxlRGF0YSkgLy8g5YW85a6555So6YCUXG5cbiAgICAvLyDnu5nlhYPpg6jku7borr7nva7lrozmlbDmja7vvIzoi6XmnInov5DooYzml7bogZrlkIjvvIzov5jpnIDopoHph43mlrDnu5HlrprlrZfmrrVcbiAgICB0aGlzLnNldFJ1bnRpbWVBZ2dEaW1zKClcbiAgICB0aGlzLmNkLm1hcmtGb3JDaGVjaygpXG4gIH1cblxuICBoYW5kbGVEYXRhRXJyb3IgPSAoKSA9PiB7XG4gICAgLy8g5pWw5o2u5Yqg6L295aSx6LSlXG4gICAgdGhpcy5zdGF0dXMgPSBXQ1N0YXR1cy5EYXRhRXJyb3JcbiAgICB0aGlzLmNkLm1hcmtGb3JDaGVjaygpXG4gIH1cbiAgaGFuZGxlQ2xpY2tTdGF0dXNNb3JlICgpIHtcbiAgICB0aGlzLm1vZGFsLmVycm9yKHtcbiAgICAgIG56VGl0bGU6ICflsI/pg6jku7bplJnor68nLFxuICAgICAgbnpDb250ZW50OiAn5q2k5bCP6YOo5Lu255qE5pWw5o2u6YWN572u5peg5pWI77yM6ZyA6KaB566h55CG5ZGY6YeN5paw6YWN572u5oiW5Yig6Zmk44CCJ1xuICAgIH0pXG4gIH1cbiAgZmlsdGVyVmFsdWVzOiBhbnlbXVxuICBoYW5kbGVGaWx0ZXJDaGFuZ2UgKGRwVmFsdWVzOiBEcFZhbHVlW10pIHtcbiAgICBtZXJnZURwVmFsdWVzKHRoaXMuZHBWYWx1ZXMsIGRwVmFsdWVzKVxuICAgIHRoaXMubG9hZE5TZXREYXRhKClcbiAgfVxuICAvLyBASW5wdXQoKSBpbml0UnVudGltZUFnZzogUnVudGltZUFnZ09wdGlvblxuICAvKipcbiAgICog5q2kIHJ1bnRpbWVBZ2cg5a2Y5YKo5b2T5YmN6L+Q6KGM5pe255So5oi36YCJ55qE44CB5pyA5paw55qEIHJ1bnRpbWVBZ2fjgIJcbiAgICogZXh0cmEg5Lit55qE5piv5a2Y5YKo5Zyo6YOo5Lu25Lit55qE44CCXG4gICAqIHdpZGdldCDkuI3otJ/otKPmioogcnVudGltZUFnZyDmlL7liLAgZXh0cmEg6YeM77yM5Zug5Li66L+Z6YeM5LiN56Gu5a6a5piv5ZCm6ZyA6KaB5oyB5LmF5YyW44CCXG4gICAqL1xuICBydW50aW1lQWdnOiBSdW50aW1lQWdnT3B0aW9uXG4gIGhhbmRsZVJ1bnRpbWVBZ2dDaGFuZ2UgKHJ1bnRpbWVBZ2c6IFJ1bnRpbWVBZ2dPcHRpb24pIHtcbiAgICAvLyBpZiAob2JqZWN0TGl0ZXJhbEVxdWFsKHJ1bnRpbWVBZ2csIHRoaXMucnVudGltZUFnZykpIHJldHVyblxuICAgIHRoaXMucnVudGltZUFnZyA9IHJ1bnRpbWVBZ2dcbiAgICAvLyDkuIvpnaLkuKTooYzpobrluo/kuKXmoLzvvIzlm6DkuLrlpJbpg6jliqDovb3mlbDmja7ml7blj6/og73opoHkvp3otZblvZPliY3mnIDmlrDnmoQgcnVudGltZUFnZ1xuICAgIHRoaXMucnVudGltZUFnZ0NoYW5nZS5lbWl0KHJ1bnRpbWVBZ2cpXG4gICAgdGhpcy5sb2FkTlNldERhdGEoKVxuICB9XG4gIC8qKiDlvZPliY3lhpnms5XpnIDopoHkv53or4EgcmVuZGVyV2lkZ2V0KCkg5bey5a6M5oiQICovXG4gIGhhbmRsZVRpdGxlQmFySW5pdCAodGl0bGVCYXI6IFRpdGxlQmFyQ29tcG9uZW50KSB7XG4gICAgaWYgKHRoaXMuc2hvd1J1bnRpbWVBZ2cpIHtcbiAgICAgIHRpdGxlQmFyLnNldFJ1bnRpbWVBZ2codGhpcy5ydW50aW1lQWdnKVxuICAgIH1cbiAgfVxuICBpbml0UnVudGltZUFnZyAoKSB7XG4gICAgLy8gcnVudGltZSBhZ2dcbiAgICB0aGlzLnNob3dSdW50aW1lQWdnID0gaXNXaWRnZXRSdW50aW1lQWdnQWN0aXZlKHRoaXMuYmFzaWNXaWRnZXRJbmZvLm5hbWUpXG4gICAgaWYgKHRoaXMuc2hvd1J1bnRpbWVBZ2cpIHtcbiAgICAgIHRoaXMucnVudGltZUFnZyA9IHRoaXMucHJvcFZhbHVlcy5fX2V4dHJhID8gdGhpcy5wcm9wVmFsdWVzLl9fZXh0cmEucnVudGltZUFnZyA6IG51bGxcbiAgICB9XG4gIH1cbiAgLy8gVE9ETzog5Lul5ZCO5oqKIHN1IOaUviBiYXNpYy4uLiDph4xcbiAgLyoqXG4gICAqIOWIneWni+WMlumDqOS7tuS6i+S7tuebkeWQrFxuICAgKi9cbiAgcHJpdmF0ZSBpbml0V2lkZ2V0RXZlbnRMaXN0ZW5lciAoKSB7XG4gICAgaWYgKCF0aGlzLmxpbmtNYXApIHJldHVyblxuICAgIGlmICh0aGlzLmFtSUZpbHRlcldpZGdldCgpKSB7XG4gICAgICB0aGlzLmluaXRPbmVFdmVudExpc3RlbmVyKEZJTFRFUlNfV0lER0VUX1BST1BfTkFNRSlcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy53aWRnZXRFdmVudFNlcnZpY2VcbiAgICAgICAgLmdldEV2ZW50c0J5V2lkZ2V0TmFtZSh0aGlzLmJhc2ljV2lkZ2V0SW5mby5uYW1lLCB0aGlzLnByb3BWYWx1ZXMpXG4gICAgICAgIC5mb3JFYWNoKGV2ZW50Q29uZmlnID0+IHtcbiAgICAgICAgICAgIHRoaXMuaW5pdE9uZUV2ZW50TGlzdGVuZXIoZXZlbnRDb25maWcucHJvcE5hbWUpXG4gICAgICAgIH0pXG4gICAgICB9XG4gIH1cbiAgLyoqXG4gICAqIGV2ZW50UHJvcE5hbWUg5piv5LqL5Lu25a+55bqU55qE5a6e6ZmF5bGe5oCn5ZCN77yMXG4gICAqIGV2ZW50S2V5IOmFjee9ruWcqCBsaW5rIOmHjOeahOS6i+S7tuWQjeOAglxuICAgKiDkuIDoiKzku5bkv6nmmK/kuIDmoLfnmoTvvIzlkI7ogIXlj6/ku6XkuI3kvKDjgIJcbiAgICog6Iul5piv562b6YCJ6YOo5Lu277yM5YiZ5Lik6ICF5LiN5ZCM77yM5LiA5Liq5pivICdmaWx0ZXIn77yM5LiA5Liq5piv5a6e6ZmF55qE5LqL5Lu277yI562b6YCJ77yJ5ZCN56ew44CCXG4gICAqL1xuICBwcml2YXRlIGluaXRPbmVFdmVudExpc3RlbmVyIChldmVudFByb3BOYW1lOiBzdHJpbmcpIHtcbiAgICBjb25zdCBldmVudEVtaXR0ZXIgPSB0aGlzLndpZGdldEluc3RhbmNlW2V2ZW50UHJvcE5hbWVdXG4gICAgaWYgKGV2ZW50RW1pdHRlcikgZXZlbnRFbWl0dGVyLnN1YnNjcmliZSh3aWRnZXRFdmVudFBhcmFtID0+IHtcbiAgICAgIGNvbnNvbGUubG9nKCfogZTliqjkuovku7bop6blj5HvvIzlj4LmlbDvvJonICsgd2lkZ2V0RXZlbnRQYXJhbSlcbiAgICAgIGNvbnN0IGxpbmtFdmVudEtleSA9IHRoaXMuYW1JRmlsdGVyV2lkZ2V0KClcbiAgICAgID8gKHdpZGdldEV2ZW50UGFyYW0gYXMgRmlsdGVyV2lkZ2V0RXZlbnRQYXJhbSkuZXZlbnRLZXlcbiAgICAgIDogZXZlbnRQcm9wTmFtZVxuICAgICAgLy8g5qC55o2uIGxpbmsgbWFwIOiwg+eUqOWFtuS7liBpbnMg5qC55o2uIOmHjeaWsOWKoOi9veaVsOaNrlxuICAgICAgY29uc3QgcEluc0xpbmsgPSB0aGlzLmxpbmtNYXBbbGlua0V2ZW50S2V5XVxuICAgICAgT2JqZWN0LmtleXMocEluc0xpbmspLmZvckVhY2gocEluc0lkID0+IHtcbiAgICAgICAgaWYgKCFwSW5zTGlua1twSW5zSWRdIHx8ICFwSW5zTGlua1twSW5zSWRdLmFjdGl2ZSB8fCAhcEluc0xpbmtbcEluc0lkXS5kcElkKSByZXR1cm5cbiAgICAgICAgY29uc3QgdGFyZ2V0V0lucyA9IHRoaXMuaW5zU2VyaXZjZS5nZXRJbnNCeVBJbnNJZChwSW5zSWQpLndpZGdldENvbXBcbiAgICAgICAgaWYgKHRhcmdldFdJbnMpIHRhcmdldFdJbnMubG9hZE5TZXREYXRhKHtcbiAgICAgICAgICBkcFZhbHVlczogW3tcbiAgICAgICAgICAgIGRwSWQ6IHBJbnNMaW5rW3BJbnNJZF0uZHBJZCxcbiAgICAgICAgICAgIC8vIFRPRE86IOiBlOWKqOWPguaVsOWAvOeahOWkhOeQhuWKoOWcqOi/mVxuICAgICAgICAgICAgdmFsdWU6IFN0cmluZyh3aWRnZXRFdmVudFBhcmFtWydkYXRhSW5kZXgnXSksXG4gICAgICAgICAgfV1cbiAgICAgICAgfSlcbiAgICAgIH0pXG4gICAgfSlcbiAgfVxuICBzZXRSdW50aW1lQWdnRGltcyAoKSB7XG4gICAgaWYgKCF0aGlzLnJ1bnRpbWVBZ2cpIHJldHVyblxuICAgIGNoYXJ0QWdnRmllbGRNYXBbdGhpcy5iYXNpY1dpZGdldEluZm8ubmFtZV0uZm9yRWFjaChhZ2dGaWVsZCA9PiB7XG4gICAgICB0aGlzLnNldFByb3BlcnR5VmFsdWUoYWdnRmllbGQubmFtZSwgYWdnRmllbGQudmFsdWVGYWN0b3J5KHRoaXMucnVudGltZUFnZywgdGhpcy5kaW1zKSlcbiAgICB9KVxuICB9XG4gIGFtSUZpbHRlcldpZGdldCAoKSB7XG4gICAgcmV0dXJuIHRoaXMuYmFzaWNXaWRnZXRJbmZvLm5hbWUgPT09IEZJTFRFUlNfV0lER0VUX05BTUVcbiAgICAgICYmIHRoaXMuYmFzaWNXaWRnZXRJbmZvLmJhc2VVcmwuaW5jbHVkZXMoJy9lcHAvJylcbiAgfVxufVxuXG4vKipcbiAqIG5ld0RwVmFsdWVzIOWQiOW5tuWIsCB0aGlzLmRwVmFsdWVz77yM5ZCMIGRwSWQg6KaG55uW44CCXG4gKiDmraTmlrnms5XkvJrmlLnlj5ggb2xkRHBWYWx1ZXPjgIJcbiAqL1xuZnVuY3Rpb24gbWVyZ2VEcFZhbHVlcyAob2xkRHBWYWx1ZXM6IERwVmFsdWVbXSwgbmV3RHBWYWx1ZXM6IERwVmFsdWVbXSkge1xuICBmb3IgKGNvbnN0IG5ld0RWIG9mIG5ld0RwVmFsdWVzLmZpbHRlcihkdiA9PiBkdi5kcElkKSkge1xuICAgIGNvbnN0IHRhcmdldE9sZERWID0gb2xkRHBWYWx1ZXMuZmluZChvbGREViA9PiBvbGREVi5kcElkID09PSBuZXdEVi5kcElkKVxuICAgIGlmICh0YXJnZXRPbGREVikge1xuICAgICAgdGFyZ2V0T2xkRFYudmFsdWUgPSBuZXdEVi52YWx1ZVxuICAgIH0gZWxzZSB7XG4gICAgICBvbGREcFZhbHVlcy5wdXNoKG5ld0RWKVxuICAgIH1cbiAgfVxufVxuZnVuY3Rpb24gbWVyZ2VEcFZhbHVlc0Zvck5ldyAob2xkRHBWYWx1ZXM6IERwVmFsdWVbXSA9IFtdLCBuZXdEcFZhbHVlczogRHBWYWx1ZVtdID0gW10pIHtcbiAgY29uc3QgcmVzdWx0ID0gb2xkRHBWYWx1ZXMuc2xpY2UoKVxuICBtZXJnZURwVmFsdWVzKHJlc3VsdCwgbmV3RHBWYWx1ZXMpXG4gIHJldHVybiByZXN1bHRcbn1cbiJdfQ==
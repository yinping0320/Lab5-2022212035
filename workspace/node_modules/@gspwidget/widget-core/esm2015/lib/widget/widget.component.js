/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { HttpClient } from '@angular/common/http';
import { ChangeDetectorRef, Component, EventEmitter, Injector, Input, Output, ViewChild, ViewContainerRef } from '@angular/core';
import { EppPortlet, FILTERS_WIDGET_NAME, FILTERS_WIDGET_PROP_NAME, IGIX_HOME_PATH, loadCommonStyleNTheme, WidgetContainerMode } from '@gspwidget/util';
import { FilterSchema, FILTER_PROP_NAME, WidgetDataService, WidgetEventService, WidgetInstanceInfo, WidgetPropertyService } from '@gspwidget/widget-devkit';
import { TranslateService } from '@ngx-translate/core';
import { NzModalService } from 'ng-zorro-antd/modal';
import ResizeObserver from 'resize-observer-polyfill';
import { delay } from 'rxjs/operators';
import { DynamicLoaderService } from '../dynamic-loader.service';
import { InstanceService } from '../instance.service';
import { TitleBarComponent } from '../title-bar/title-bar.component';
import { chartAggFieldMap, isWidgetRuntimeAggActive } from './runtime-agg';
// private langsSet: { [widgetName: string]: string[] } = {}
/**
 * 已被 set 翻译的 lang，下次不再请求此 lang
 * @type {?}
 */
const loadedI18nUrls = [];
/** @enum {number} */
const WCStatus = {
    LoadingWidget: 0,
    LoadingData: 1,
    DataEmpty: 2,
    Normal: 3,
    DataError: 4,
    WidgetLoadError: 5,
};
export { WCStatus };
WCStatus[WCStatus.LoadingWidget] = 'LoadingWidget';
WCStatus[WCStatus.LoadingData] = 'LoadingData';
WCStatus[WCStatus.DataEmpty] = 'DataEmpty';
WCStatus[WCStatus.Normal] = 'Normal';
WCStatus[WCStatus.DataError] = 'DataError';
WCStatus[WCStatus.WidgetLoadError] = 'WidgetLoadError';
/**
 * @record
 */
export function GetDataOptions() { }
if (false) {
    /** @type {?} */
    GetDataOptions.prototype.dpValues;
    /** @type {?} */
    GetDataOptions.prototype.runtimeAgg;
}
loadCommonStyleNTheme();
/**
 * 兼容阶段数据加载逻辑
 * 1. 若元部件 useDataEngine === true, 说明是老写法、且需要数据的元部件，但其内部未调用加载数据，所以初始化完成后加载一下；
 *    新数据加载请求处理永远启用，因为仅有新写法元部件会触发；
 * 2. 若 getData 有值，则用它获得数据，不用真数据
 * 3. 若名中带有 '演示'，则用演示数据
 * 4. 都不满足再用真数据
 */
export class WidgetComponent {
    /**
     * 公共头上是否显示运行时聚合配置
     * @param {?} loader
     * @param {?} cd
     * @param {?} injector
     * @param {?} modal
     * @param {?} http
     * @param {?} translate
     * @param {?} widgetPropertyService
     * @param {?} widgetEventService
     * @param {?} insSerivce
     */
    constructor(loader, cd, injector, modal, http, translate, widgetPropertyService, widgetEventService, insSerivce) {
        this.loader = loader;
        this.cd = cd;
        this.injector = injector;
        this.modal = modal;
        this.http = http;
        this.translate = translate;
        this.widgetPropertyService = widgetPropertyService;
        this.widgetEventService = widgetEventService;
        this.insSerivce = insSerivce;
        /**
         * 可选
         */
        this.mode = WidgetContainerMode.AOT;
        // TODO: 解耦 portlet
        /**
         * 可选，部件信息，需要注入到元部件
         */
        this.portlet = new EppPortlet(null);
        this.status = WCStatus.LoadingWidget;
        /**
         * widget 加载完成，发出当前 widget 的信息
         */
        this.widgetLoaded = new EventEmitter();
        /**
         * widget component create 完成，发出当前 widget 的信息
         */
        this.widgetInit = new EventEmitter();
        this.runtimeAggChange = new EventEmitter();
        // public isLoading = true
        // public status = WCStatus.Normal
        this.WCStatus = WCStatus;
        this.IGIX_HOME_PATH = IGIX_HOME_PATH;
        this.FILTER_PROP_NAME = FILTER_PROP_NAME;
        // public feFilterValues: FrontendFilter[]
        /**
         * 存在此层的数据。可用于前端筛选、数据获取状态判断
         */
        this.data = null;
        this.showRuntimeAgg = false;
        /**
         * pv 中包含 {fs,dp}[]（筛选控件+取数参数=筛选）
         * 部件实例中保存 {fs,dp}: filterValue
         */
        this.dpValues = [];
        this.handleDataError = (/**
         * @return {?}
         */
        () => {
            // 数据加载失败
            this.status = WCStatus.DataError;
            this.cd.markForCheck();
        });
        this._initWidgetEnv();
    }
    /**
     * 全局初始化
     * @private
     * @return {?}
     */
    _initWidgetEnv() {
        // i18n
        if (!this.translate.defaultLang)
            this.translate.setDefaultLang('zh-CHS');
        if (!this.translate.currentLang) {
            /** @type {?} */
            const lang = localStorage.getItem('languageCode') || 'zh-CHS';
            this.translate.use(lang || 'zh-CHS');
        }
        if (!window.widgetI18nResLoaded) {
            const { currentLang } = this.translate;
            this.http.get(`${IGIX_HOME_PATH}assets/i18n/${currentLang}.json`).subscribe((/**
             * @param {?} res
             * @return {?}
             */
            res => {
                this.translate.setTranslation(currentLang, res, true);
            }));
            window.widgetI18nResLoaded = true;
        }
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.insSerivce.addInsInfo(this.instanceId, this, 'widgetComp');
        // 监听 resizeTarget 的大小变化，变化时调用元部件.onResized()，传入 DomRectReadonly
        if (this.resizeTarget) {
            new ResizeObserver((/**
             * @param {?} entries
             * @return {?}
             */
            entries => {
                const { width, height } = entries[0].contentRect;
                if (this.widgetInstance)
                    this.widgetInstance.onResized(width, height);
                this.width = width;
                this.height = height;
                this.cd.markForCheck();
            })).observe(this.resizeTarget.nativeElement);
        }
    }
    /**
     * @param {?} c
     * @return {?}
     */
    ngOnChanges(c) {
        const { basicWidgetInfo } = c;
        if (basicWidgetInfo && basicWidgetInfo.currentValue && basicWidgetInfo.currentValue !== basicWidgetInfo.previousValue) {
            // widget 变了，渲染新元部件
            this.renderWidget();
        }
    }
    /**
     * 此 container 被 gridster 渲染出正确的大小事件
     * @return {?}
     */
    triggerWidgetResize() {
        if (this.widgetInstance && this.widgetInstance.onResized) {
            const { clientWidth, clientHeight } = this.resizeTarget.nativeElement;
            this.widgetInstance.onResized(clientWidth, clientHeight);
        }
    }
    // TODO: 这些都改造成，参数为一个对象，里面可以一次塞多个属性-值，全部更新后再触发 onPropertyChange，
    // 否则像初始化完要赋多个值的情况，通知触发太频繁了，也会导致频繁触发元部件渲染、数据加载
    /**
     * 外部更新元部件 propValues 的某属性后，需要调用此方法，否则我们不知道 propValues 发生了变化。
     * 不太好精简掉这个方法。尝试过用 keyValueDiffer 在 ngDoCheck 中检测 propValues 变化，但仅能检测一层。
     * @param {?} propName
     * @param {?} pValue
     * @return {?}
     */
    setPropertyValue(propName, pValue) {
        // TODO: portlet 结构改变后，可以省去这一步：__extra 应该根本不会传进来
        if (propName === '__extra')
            return;
        // 如果不是 object，则判断值如果 pValue 与当前元部件实例中相同，就不传给部件了
        if (typeof pValue !== 'object' && this.widgetInstance[propName] === pValue)
            return;
        // TODO: 部件配置时，运行时更改语言的处理
        /** @type {?} */
        const value = this.processPV(pValue)
        // 改值
        ;
        // 改值
        this.widgetInstance[propName] = value;
        // 通知，因为元部件可能需要这个时机
        // 防止没有这个方法的老元部件报错，后面都会升级掉
        if (this.widgetInstance.onPropertyChange) {
            this.widgetInstance.onPropertyChange(propName, value);
        }
        if (propName === FILTER_PROP_NAME) {
            this.dpValues = ((/** @type {?} */ (pValue)))
                .filter((/**
             * @param {?} dv
             * @return {?}
             */
            dv => dv.dpId))
                .map((/**
             * @param {?} fc
             * @return {?}
             */
            fc => ({
                value: FilterSchema.getDefaultValue(fc.fs),
                dpId: fc.dpId
            })));
            // TODO:
            // if (pValue && pValue.slice) this.propValues[FILTER_PROP_NAME] = pValue.slice()
            // this.cd.markForCheck()
        }
        if (!this.propValues)
            this.propValues = {};
        this.propValues[propName] = pValue;
        this.cd.markForCheck();
    }
    /* 递归检查 pv，做特殊处理，比如国际化、帮助 */
    /**
     * @private
     * @param {?} value
     * @return {?}
     */
    processPV(value) {
        const { currentLang } = this.translate;
        try {
            value = JSON.parse(JSON.stringify(value));
        }
        catch (e) { }
        return _processPVRecursively(value);
        /**
         * @param {?} pValue
         * @return {?}
         */
        function _processPVRecursively(pValue) {
            if (Array.isArray(pValue)) {
                pValue.forEach((/**
                 * @param {?} v
                 * @param {?} i
                 * @return {?}
                 */
                (v, i) => {
                    pValue[i] = _processPVRecursively(v);
                }));
                return pValue;
                // i18n: 如果 value 中包含 en 或 zh-CHS 或 当前语言的key，则是 i18n 字段
            }
            else if (pValue && !pValue._notProcess && typeof (pValue.en + pValue['zh-CHS'] + pValue[currentLang]) === 'string') {
                return pValue[currentLang];
                // help
            }
            else if (pValue && pValue.__type === 'help') {
                return pValue.value;
            }
            else if (pValue && ['Object'].includes(pValue.constructor.name)) {
                Object.keys(pValue).forEach((/**
                 * @param {?} key
                 * @return {?}
                 */
                key => {
                    pValue[key] = _processPVRecursively(pValue[key]);
                }));
                return pValue;
            }
            else {
                return pValue;
            }
        }
    }
    /**
     * @return {?}
     */
    renderWidget() {
        return tslib_1.__awaiter(this, void 0, void 0, function* () {
            // 加载渲染这个 widget 需要的一切元数据
            const { baseUrl } = this.basicWidgetInfo;
            /** @type {?} */
            const curWidgetData = yield this.loader.loadWidget(this.basicWidgetInfo, this.propValues, this.mode)
            // TODO: propValues 是不是不用经过 loader，直接调 widgetPropService 获取就行？
            ;
            // TODO: propValues 是不是不用经过 loader，直接调 widgetPropService 获取就行？
            const { widgetCompFactory, widgetModuleFactory, propValues, widgetConfig } = curWidgetData;
            this.curWidgetConfig = widgetConfig;
            this.initRuntimeAgg();
            if (this.curWidgetConfig.enableLoadingI18n)
                this.loadI18nRes();
            // 元部件加载完成事件
            this.widgetLoaded.emit(curWidgetData);
            // 删老元部件
            this.widgetContainer.remove();
            // 创建注入器
            /** @type {?} */
            const injector = Injector.create({
                providers: [{
                        provide: WidgetInstanceInfo,
                        /**
                         * 元部件实例信息
                         */
                        useValue: new WidgetInstanceInfo(this.portlet.id, this.instanceId, this.assetsBaseUrl || this.basicWidgetInfo.baseUrl + '/assets/')
                    }, {
                        provide: WidgetDataService,
                        /**
                         * 元部件数据服务
                         */
                        useFactory: (/**
                         * @return {?}
                         */
                        () => {
                            this.widgetDataService = new WidgetDataService();
                            this.widgetDataService.onLoadData
                                .pipe(delay(0)) // 为避免用 of(data) 会同步返回数据，导致 data service 中的 onGetData 还没返回到元部件手里就触发完了
                                .subscribe(this.loadNSetData.bind(this));
                            return this.widgetDataService;
                        }),
                        deps: []
                    }],
                parent: this.injector
            })
            // 创建、挂载 widget 组件
            ;
            // 创建、挂载 widget 组件
            this.widgetInstance = (/** @type {?} */ (this.widgetContainer.createComponent(widgetCompFactory, 0, injector, undefined, widgetModuleFactory && widgetModuleFactory.create(this.injector)).instance));
            // 设置 widget 的 properties 的 values
            // TODO: 改为一次配多个
            Object.keys(propValues).forEach((/**
             * @param {?} prop
             * @return {?}
             */
            prop => {
                this.setPropertyValue(prop, propValues[prop]);
            }));
            // TODO: 已废弃方案, 以下为过渡方案以兼容老写法元部件, 后期将移除
            this.widgetInstance.id = this.instanceId;
            this.widgetInstance.portletId = this.portlet.id;
            this.widgetInstance.assetsBaseUrl = this.assetsBaseUrl || baseUrl + '/assets/';
            if (this.widgetInstance.useDataEngine)
                this.loadNSetData({});
            // TODO: 它完成之后才算作 widget 初始化完成，可以显示出来。否则会显示 code。
            // this.setWidgetTranslation()
            // event
            this.initWidgetEventListener();
            // 元部件初始化完成事件
            this.widgetInit.emit(curWidgetData);
            // this.isLoading = false
            this.status = WCStatus.Normal;
            this.cd.markForCheck();
        });
    }
    /**
     * @private
     * @return {?}
     */
    loadI18nRes() {
        const { currentLang } = this.translate;
        const { name, baseUrl } = this.basicWidgetInfo;
        const { customI18nResourceUrl } = this.curWidgetConfig;
        /** @type {?} */
        const i18nResUrl = customI18nResourceUrl || `${baseUrl}/assets/i18n/${currentLang}.json`
        // 缓存曾加载过的资源文件名，下次相同文件不再请求。缓存资源文件名，是因为可能多个元部件指定相同的资源文件。
        ;
        // 缓存曾加载过的资源文件名，下次相同文件不再请求。缓存资源文件名，是因为可能多个元部件指定相同的资源文件。
        if (loadedI18nUrls.includes(i18nResUrl))
            return;
        loadedI18nUrls.push(i18nResUrl);
        return this.http.get(i18nResUrl).toPromise().then((/**
         * @param {?} res
         * @return {?}
         */
        res => {
            this.translate.setTranslation(currentLang, res, true);
        }), (/**
         * @return {?}
         */
        () => {
            console.log(`元部件 ${name} 无 ${currentLang} 的资源文件`);
        })).finally((/**
         * @return {?}
         */
        () => {
            return Promise.resolve();
        }));
    }
    /**
     * 塞数据入口 1/2: 加载数据并塞给部件
     * @param {?=} param
     * @return {?}
     */
    // TODO: loadNSetData 可能是不带参数的。取数参数可能存在当前 widget 实例里，直接取。
    // loadNSetData 有没有可能带着来自部件的额外参数？
    loadNSetData(param = {}) {
        /** @type {?} */
        const ob = this.getData({
            dpValues: mergeDpValuesForNew(this.dpValues, param.dpValues),
            runtimeAgg: this.runtimeAgg
        });
        if (!ob)
            return;
        ob.subscribe((/**
         * @param {?} dataWithDims
         * @return {?}
         */
        dataWithDims => {
            this.setData(dataWithDims);
        }), this.handleDataError.bind(this));
    }
    /**
     * 给元部件重新设置数据结果，外部可调用此方法给部件设置数据。
     * @param {?} pDataWithDims
     * @return {?}
     */
    setData(pDataWithDims) {
        /** @type {?} */
        let dataWithDims = pDataWithDims
        // set if empty status
        ;
        // set if empty status
        if (!pDataWithDims || !pDataWithDims.tableData || pDataWithDims.tableData.length === 0)
            this.status = WCStatus.DataEmpty;
        // 如果外面没有给 DataWithDims 而是简单数据列表，就简单转一把。以兼容 config 里的假数据等。
        if (!pDataWithDims.dimensions && pDataWithDims['length']) {
            dataWithDims = {
                dimensions: Object
                    .keys(pDataWithDims[0])
                    .map((/**
                 * @param {?} key
                 * @return {?}
                 */
                key => ({ name: key, label: key }))),
                tableData: ((/** @type {?} */ ((/** @type {?} */ (pDataWithDims)))))
            };
        }
        this.status = WCStatus.Normal;
        this.data = dataWithDims.tableData;
        this.dims = dataWithDims.dimensions;
        if (this.widgetDataService)
            this.widgetDataService.setData(dataWithDims);
        if (this.widgetInstance && this.widgetInstance.useDataEngine)
            this.widgetInstance.onGetData(dataWithDims.tableData); // 兼容用途
        // 给元部件设置完数据，若有运行时聚合，还需要重新绑定字段
        this.setRuntimeAggDims();
        this.cd.markForCheck();
    }
    /**
     * @return {?}
     */
    handleClickStatusMore() {
        this.modal.error({
            nzTitle: '小部件错误',
            nzContent: '此小部件的数据配置无效，需要管理员重新配置或删除。'
        });
    }
    /**
     * @param {?} dpValues
     * @return {?}
     */
    handleFilterChange(dpValues) {
        mergeDpValues(this.dpValues, dpValues);
        this.loadNSetData();
    }
    /**
     * @param {?} runtimeAgg
     * @return {?}
     */
    handleRuntimeAggChange(runtimeAgg) {
        // if (objectLiteralEqual(runtimeAgg, this.runtimeAgg)) return
        this.runtimeAgg = runtimeAgg;
        // 下面两行顺序严格，因为外部加载数据时可能要依赖当前最新的 runtimeAgg
        this.runtimeAggChange.emit(runtimeAgg);
        this.loadNSetData();
    }
    /**
     * 当前写法需要保证 renderWidget() 已完成
     * @param {?} titleBar
     * @return {?}
     */
    handleTitleBarInit(titleBar) {
        if (this.showRuntimeAgg) {
            titleBar.setRuntimeAgg(this.runtimeAgg);
        }
    }
    /**
     * @return {?}
     */
    initRuntimeAgg() {
        // runtime agg
        this.showRuntimeAgg = isWidgetRuntimeAggActive(this.basicWidgetInfo.name);
        if (this.showRuntimeAgg) {
            this.runtimeAgg = this.propValues.__extra ? this.propValues.__extra.runtimeAgg : null;
        }
    }
    // TODO: 以后把 su 放 basic... 里
    /**
     * 初始化部件事件监听
     * @private
     * @return {?}
     */
    initWidgetEventListener() {
        if (!this.linkMap)
            return;
        if (this.amIFilterWidget()) {
            this.initOneEventListener(FILTERS_WIDGET_PROP_NAME);
        }
        else {
            this.widgetEventService
                .getEventsByWidgetName(this.basicWidgetInfo.name, this.propValues)
                .forEach((/**
             * @param {?} eventConfig
             * @return {?}
             */
            eventConfig => {
                this.initOneEventListener(eventConfig.propName);
            }));
        }
    }
    /**
     * eventPropName 是事件对应的实际属性名，
     * eventKey 配置在 link 里的事件名。
     * 一般他俩是一样的，后者可以不传。
     * 若是筛选部件，则两者不同，一个是 'filter'，一个是实际的事件（筛选）名称。
     * @private
     * @param {?} eventPropName
     * @return {?}
     */
    initOneEventListener(eventPropName) {
        /** @type {?} */
        const eventEmitter = this.widgetInstance[eventPropName];
        if (eventEmitter)
            eventEmitter.subscribe((/**
             * @param {?} widgetEventParam
             * @return {?}
             */
            widgetEventParam => {
                console.log('联动事件触发，参数：' + widgetEventParam);
                /** @type {?} */
                const linkEventKey = this.amIFilterWidget()
                    ? ((/** @type {?} */ (widgetEventParam))).eventKey
                    : eventPropName
                // 根据 link map 调用其他 ins 根据 重新加载数据
                ;
                // 根据 link map 调用其他 ins 根据 重新加载数据
                /** @type {?} */
                const pInsLink = this.linkMap[linkEventKey];
                Object.keys(pInsLink).forEach((/**
                 * @param {?} pInsId
                 * @return {?}
                 */
                pInsId => {
                    if (!pInsLink[pInsId] || !pInsLink[pInsId].active || !pInsLink[pInsId].dpId)
                        return;
                    /** @type {?} */
                    const targetWIns = this.insSerivce.getInsByPInsId(pInsId).widgetComp;
                    if (targetWIns)
                        targetWIns.loadNSetData({
                            dpValues: [{
                                    dpId: pInsLink[pInsId].dpId,
                                    // TODO: 联动参数值的处理加在这
                                    value: String(widgetEventParam['dataIndex']),
                                }]
                        });
                }));
            }));
    }
    /**
     * @return {?}
     */
    setRuntimeAggDims() {
        if (!this.runtimeAgg)
            return;
        chartAggFieldMap[this.basicWidgetInfo.name].forEach((/**
         * @param {?} aggField
         * @return {?}
         */
        aggField => {
            this.setPropertyValue(aggField.name, aggField.valueFactory(this.runtimeAgg, this.dims));
        }));
    }
    /**
     * @return {?}
     */
    amIFilterWidget() {
        return this.basicWidgetInfo.name === FILTERS_WIDGET_NAME
            && this.basicWidgetInfo.baseUrl.includes('/epp/');
    }
}
WidgetComponent.decorators = [
    { type: Component, args: [{
                selector: 'lib-widget',
                template: "<div\n  #resizeTarget\n  class=\"wc-wrapper h-100 overflow-hidden position-relative\">\n  <!-- TODO: \u589E\u52A0\u516C\u5171\u7684\u52A0\u8F7D\u906E\u7F69\u5C42\uFF0C\u6570\u636E\u670D\u52A1\u52A0\u8F7D\u65F6\u3001\u90E8\u4EF6\u5185\u8C03\u7528\u65F6\u3001\u90E8\u4EF6\u672C\u8EAB\u52A0\u8F7D\u90FD\u7528\u5B83 -->\n  <!-- loading -->\n  <div\n    *ngIf=\"[WCStatus.LoadingWidget, WCStatus.LoadingData].includes(status)\"\n    class=\"h-100 d-flex justify-content-center align-items-center\">\n    <div class=\"text-center\">\n      <i class=\"spin-ball loading-color material-icons\">public</i>\n      <div class=\"fs-12 loading-color\">{{'\u90E8\u4EF6\u52A0\u8F7D\u4E2D' | trans}}</div>\n    </div>\n  </div>\n\n  <!-- TODO: \u90E8\u4EF6\u52A0\u8F7D\u5931\u8D25\u3002\u600E\u4E48\u7EDF\u4E00\u5904\u7406\u8FD9\u51E0\u79CD\u5F02\u5E38\u72B6\u6001\uFF1F -->\n  <!-- <div\n    *ngIf=\"status === WCStatus.WidgetLoadError\">\n  </div> -->\n\n  <!-- \u65E0\u6570\u636E -->\n  <div\n    *ngIf=\"status === WCStatus.DataEmpty\"\n    class=\"flex-fill no-data h-100 w-100 d-flex flex-column\">\n    <lib-title-bar\n      *ngIf=\"curWidgetConfig?.enableCommonTitleBar\n        && widgetInstance\n        && !widgetInstance['titleBarHide']\"\n      [title]=\"portlet.name\"\n      [showRefresh]=\"widgetInstance['titleBarShowRefresh']\"\n      [jumpConfig]=\"widgetInstance['titleBarJump']\"\n      ></lib-title-bar>\n    <div class=\"flex-fill d-flex flex-column justify-content-center align-items-center\">\n      <img src=\"{{IGIX_HOME_PATH}}assets/img/data-empty.svg\" style=\"transform:translateY(-5px)\" alt=\"\">\n      <div class=\"fs-13\" style=\"color:gray\">{{'noDataAvailable'|translate}}</div>\n    </div>\n  </div>\n\n  <!-- abnormal -->\n  <div class=\"d-flex flex-column overflow-hidden h-100\"\n    *ngIf=\"status === WCStatus.DataError\">\n    <div class=\"portlet-title text-truncate flex-shrink-0\">{{this.portlet.name}}</div>\n    <div class=\"status-layer cursor-pointer flex-fill\"\n      (click)=\"handleClickStatusMore()\">\n      <ng-container *ngIf=\"status === WCStatus.DataError\">\n        <img src=\"{{IGIX_HOME_PATH}}assets/img/data-error.svg\" alt=\"\">\n        <div class=\"error-tip fs-12 text-truncate\">\n          \u90E8\u4EF6\u6570\u636E\u52A0\u8F7D\u5931\u8D25\uFF0C\n          <span class=\"theme-color more\">\u67E5\u770B\u8BE6\u60C5</span>\n        </div>\n      </ng-container>\n    </div>\n  </div>\n\n  <!-- normal -->\n  <!-- *ngIf=\"status === WCStatus.Normal\" -->\n  <div\n    class=\"h-100 d-flex flex-column\">\n    <!-- TODO: \u91CD\u6784 DOM \u7ED3\u6784\uFF0C\u628A title bar \u653E\u5728\u516C\u5171\u4F4D\u7F6E -->\n    <!-- \u516C\u5171 title bar -->\n    <lib-title-bar\n      #titleBar\n      *ngIf=\"curWidgetConfig?.enableCommonTitleBar\n        && widgetInstance\n        && !widgetInstance['titleBarHide']\"\n      [title]=\"portlet.name\"\n      [showRefresh]=\"widgetInstance['titleBarShowRefresh']\"\n      [jumpConfig]=\"widgetInstance['titleBarJump']\"\n      [filterConfigs]=\"propValues[FILTER_PROP_NAME] || []\"\n      [dims]=\"dims\"\n      (clickRefresh)=\"loadNSetData()\"\n      (filterChange)=\"handleFilterChange($event)\"\n      (init)=\"handleTitleBarInit($event)\"\n      [showRuntimeAgg]=\"showRuntimeAgg\"\n      (runtimeAggChange)=\"handleRuntimeAggChange($event)\"\n      >\n    </lib-title-bar>\n    <div class=\"flex-fill overflow-hidden\" >\n      <ng-container #wc></ng-container>\n    </div>\n  </div>\n</div>\n",
                styles: [".portlet-title{font-weight:700;padding:12px 20px 10px}.status-layer{width:100%;display:flex;align-items:center;justify-content:center;z-index:1;flex-direction:column}.status-layer img{width:75%;max-width:200px}.status-layer .error-tip{color:#666;margin:5px 0}.status-layer .error-tip .more{text-decoration:underline}.no-data{position:absolute;top:0;background:#fff}::ng-deep .widget-title-bar .left{overflow:hidden}::ng-deep .widget-title-bar .left .title{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.loading-color{color:#b2bac4}.spin-ball{font-size:30px}"]
            }] }
];
/** @nocollapse */
WidgetComponent.ctorParameters = () => [
    { type: DynamicLoaderService },
    { type: ChangeDetectorRef },
    { type: Injector },
    { type: NzModalService },
    { type: HttpClient },
    { type: TranslateService },
    { type: WidgetPropertyService },
    { type: WidgetEventService },
    { type: InstanceService }
];
WidgetComponent.propDecorators = {
    basicWidgetInfo: [{ type: Input }],
    propValues: [{ type: Input }],
    linkMap: [{ type: Input }],
    mode: [{ type: Input }],
    assetsBaseUrl: [{ type: Input }],
    portlet: [{ type: Input }],
    instanceId: [{ type: Input }],
    getData: [{ type: Input }],
    status: [{ type: Input }],
    widgetLoaded: [{ type: Output }],
    widgetInit: [{ type: Output }],
    runtimeAggChange: [{ type: Output }],
    resizeTarget: [{ type: ViewChild, args: ['resizeTarget',] }],
    widgetContainer: [{ type: ViewChild, args: ['wc', { read: ViewContainerRef },] }],
    titleBar: [{ type: ViewChild, args: ['titleBar',] }]
};
if (false) {
    /**
     * 必选，要渲染的 widget 信息
     * @type {?}
     */
    WidgetComponent.prototype.basicWidgetInfo;
    /**
     * 必选，此 widget 的配置信息；仅在元部件加载时起作用，若属性改变，必需调用 setPropValues()
     * @type {?}
     */
    WidgetComponent.prototype.propValues;
    /** @type {?} */
    WidgetComponent.prototype.linkMap;
    /**
     * 可选
     * @type {?}
     */
    WidgetComponent.prototype.mode;
    /**
     * 可选，widget 的静态资源地址，一般不用管，特殊情况可配置，默认值为 this.basicWidgetInfo.baseUrl + '/assets/'
     * @type {?}
     */
    WidgetComponent.prototype.assetsBaseUrl;
    /**
     * 可选，部件信息，需要注入到元部件
     * @type {?}
     */
    WidgetComponent.prototype.portlet;
    /**
     * 可选，部件实例 id, 获取数据可能用到
     * @type {?}
     */
    WidgetComponent.prototype.instanceId;
    /**
     * 必选，
     * 若指定，则元部件主动加载数据时使用它获取数据，
     * 不再加载真实数据。用于给元部件设置假数据
     * @type {?}
     */
    WidgetComponent.prototype.getData;
    /** @type {?} */
    WidgetComponent.prototype.status;
    /**
     * widget 加载完成，发出当前 widget 的信息
     * @type {?}
     */
    WidgetComponent.prototype.widgetLoaded;
    /**
     * widget component create 完成，发出当前 widget 的信息
     * @type {?}
     */
    WidgetComponent.prototype.widgetInit;
    /** @type {?} */
    WidgetComponent.prototype.runtimeAggChange;
    /** @type {?} */
    WidgetComponent.prototype.resizeTarget;
    /** @type {?} */
    WidgetComponent.prototype.widgetContainer;
    /** @type {?} */
    WidgetComponent.prototype.titleBar;
    /** @type {?} */
    WidgetComponent.prototype.WCStatus;
    /** @type {?} */
    WidgetComponent.prototype.IGIX_HOME_PATH;
    /** @type {?} */
    WidgetComponent.prototype.FILTER_PROP_NAME;
    /** @type {?} */
    WidgetComponent.prototype.width;
    /** @type {?} */
    WidgetComponent.prototype.height;
    /** @type {?} */
    WidgetComponent.prototype.curWidgetConfig;
    /**
     * 存在此层的数据。可用于前端筛选、数据获取状态判断
     * @type {?}
     */
    WidgetComponent.prototype.data;
    /**
     * 获取数据后存起来的维度。可用于页面设计时、运行时获取、显示维度
     * @type {?}
     */
    WidgetComponent.prototype.dims;
    /** @type {?} */
    WidgetComponent.prototype.widgetInstance;
    /** @type {?} */
    WidgetComponent.prototype.showRuntimeAgg;
    /**
     * @type {?}
     * @private
     */
    WidgetComponent.prototype.widgetDataService;
    /**
     * pv 中包含 {fs,dp}[]（筛选控件+取数参数=筛选）
     * 部件实例中保存 {fs,dp}: filterValue
     * @type {?}
     */
    WidgetComponent.prototype.dpValues;
    /** @type {?} */
    WidgetComponent.prototype.handleDataError;
    /** @type {?} */
    WidgetComponent.prototype.filterValues;
    /**
     * 此 runtimeAgg 存储当前运行时用户选的、最新的 runtimeAgg。
     * extra 中的是存储在部件中的。
     * widget 不负责把 runtimeAgg 放到 extra 里，因为这里不确定是否需要持久化。
     * @type {?}
     */
    WidgetComponent.prototype.runtimeAgg;
    /**
     * @type {?}
     * @private
     */
    WidgetComponent.prototype.loader;
    /**
     * @type {?}
     * @private
     */
    WidgetComponent.prototype.cd;
    /**
     * @type {?}
     * @private
     */
    WidgetComponent.prototype.injector;
    /**
     * @type {?}
     * @private
     */
    WidgetComponent.prototype.modal;
    /**
     * @type {?}
     * @private
     */
    WidgetComponent.prototype.http;
    /**
     * @type {?}
     * @private
     */
    WidgetComponent.prototype.translate;
    /**
     * @type {?}
     * @private
     */
    WidgetComponent.prototype.widgetPropertyService;
    /**
     * @type {?}
     * @private
     */
    WidgetComponent.prototype.widgetEventService;
    /**
     * @type {?}
     * @private
     */
    WidgetComponent.prototype.insSerivce;
}
/**
 * newDpValues 合并到 this.dpValues，同 dpId 覆盖。
 * 此方法会改变 oldDpValues。
 * @param {?} oldDpValues
 * @param {?} newDpValues
 * @return {?}
 */
function mergeDpValues(oldDpValues, newDpValues) {
    for (const newDV of newDpValues.filter((/**
     * @param {?} dv
     * @return {?}
     */
    dv => dv.dpId))) {
        /** @type {?} */
        const targetOldDV = oldDpValues.find((/**
         * @param {?} oldDV
         * @return {?}
         */
        oldDV => oldDV.dpId === newDV.dpId));
        if (targetOldDV) {
            targetOldDV.value = newDV.value;
        }
        else {
            oldDpValues.push(newDV);
        }
    }
}
/**
 * @param {?=} oldDpValues
 * @param {?=} newDpValues
 * @return {?}
 */
function mergeDpValuesForNew(oldDpValues = [], newDpValues = []) {
    /** @type {?} */
    const result = oldDpValues.slice();
    mergeDpValues(result, newDpValues);
    return result;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2lkZ2V0LmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0Bnc3B3aWRnZXQvd2lkZ2V0LWNvcmUvIiwic291cmNlcyI6WyJsaWIvd2lkZ2V0L3dpZGdldC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFDbEQsT0FBTyxFQUNMLGlCQUFpQixFQUFFLFNBQVMsRUFDNUIsWUFBWSxFQUFFLFFBQVEsRUFBRSxLQUFLLEVBRTdCLE1BQU0sRUFBaUIsU0FBUyxFQUFFLGdCQUFnQixFQUNuRCxNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQXFELFVBQVUsRUFBRSxtQkFBbUIsRUFBRSx3QkFBd0IsRUFBMEIsY0FBYyxFQUFXLHFCQUFxQixFQUF3QyxtQkFBbUIsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQ2xSLE9BQU8sRUFFTCxZQUFZLEVBQ1osZ0JBQWdCLEVBQ29CLGlCQUFpQixFQUFFLGtCQUFrQixFQUFFLGtCQUFrQixFQUFFLHFCQUFxQixFQUNySCxNQUFNLDBCQUEwQixDQUFDO0FBQ2xDLE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQ3ZELE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUNyRCxPQUFPLGNBQWMsTUFBTSwwQkFBMEIsQ0FBQztBQUV0RCxPQUFPLEVBQUUsS0FBSyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDdkMsT0FBTyxFQUFFLG9CQUFvQixFQUFFLE1BQU0sMkJBQTJCLENBQUM7QUFDakUsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQ3RELE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLGtDQUFrQyxDQUFDO0FBQ3JFLE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSx3QkFBd0IsRUFBRSxNQUFNLGVBQWUsQ0FBQzs7Ozs7O01BSXJFLGNBQWMsR0FBYSxFQUFFOzs7SUFVakMsZ0JBQWE7SUFDYixjQUFXO0lBQ1gsWUFBUztJQUNULFNBQU07SUFDTixZQUFTO0lBQ1Qsa0JBQWU7Ozs7Ozs7Ozs7OztBQUVqQixvQ0FHQzs7O0lBRkMsa0NBQW9COztJQUNwQixvQ0FBNEI7O0FBRzlCLHFCQUFxQixFQUFFLENBQUE7Ozs7Ozs7OztBQWN2QixNQUFNLE9BQU8sZUFBZTs7Ozs7Ozs7Ozs7OztJQXdEMUIsWUFDVSxNQUE0QixFQUM1QixFQUFxQixFQUNyQixRQUFrQixFQUNsQixLQUFxQixFQUNyQixJQUFnQixFQUNoQixTQUEyQixFQUMzQixxQkFBNEMsRUFDNUMsa0JBQXNDLEVBQ3RDLFVBQTJCO1FBUjNCLFdBQU0sR0FBTixNQUFNLENBQXNCO1FBQzVCLE9BQUUsR0FBRixFQUFFLENBQW1CO1FBQ3JCLGFBQVEsR0FBUixRQUFRLENBQVU7UUFDbEIsVUFBSyxHQUFMLEtBQUssQ0FBZ0I7UUFDckIsU0FBSSxHQUFKLElBQUksQ0FBWTtRQUNoQixjQUFTLEdBQVQsU0FBUyxDQUFrQjtRQUMzQiwwQkFBcUIsR0FBckIscUJBQXFCLENBQXVCO1FBQzVDLHVCQUFrQixHQUFsQixrQkFBa0IsQ0FBb0I7UUFDdEMsZUFBVSxHQUFWLFVBQVUsQ0FBaUI7Ozs7UUExRDVCLFNBQUksR0FBRyxtQkFBbUIsQ0FBQyxHQUFHLENBQUE7Ozs7O1FBSzlCLFlBQU8sR0FBZSxJQUFJLFVBQVUsQ0FBQyxJQUFJLENBQUMsQ0FBQTtRQVMxQyxXQUFNLEdBQUcsUUFBUSxDQUFDLGFBQWEsQ0FBQTs7OztRQUc5QixpQkFBWSxHQUFHLElBQUksWUFBWSxFQUFFLENBQUE7Ozs7UUFFakMsZUFBVSxHQUFHLElBQUksWUFBWSxFQUFFLENBQUE7UUFDL0IscUJBQWdCLEdBQUcsSUFBSSxZQUFZLEVBQUUsQ0FBQTs7O1FBVXhDLGFBQVEsR0FBRyxRQUFRLENBQUE7UUFDbkIsbUJBQWMsR0FBRyxjQUFjLENBQUE7UUFDL0IscUJBQWdCLEdBQUcsZ0JBQWdCLENBQUE7Ozs7O1FBTW5DLFNBQUksR0FBVSxJQUFJLENBQUE7UUFJbEIsbUJBQWMsR0FBRyxLQUFLLENBQUE7Ozs7O1FBOE43QixhQUFRLEdBQWMsRUFBRSxDQUFBO1FBOEN4QixvQkFBZTs7O1FBQUcsR0FBRyxFQUFFO1lBQ3JCLFNBQVM7WUFDVCxJQUFJLENBQUMsTUFBTSxHQUFHLFFBQVEsQ0FBQyxTQUFTLENBQUE7WUFDaEMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxZQUFZLEVBQUUsQ0FBQTtRQUN4QixDQUFDLEVBQUE7UUE5UEMsSUFBSSxDQUFDLGNBQWMsRUFBRSxDQUFBO0lBQ3ZCLENBQUM7Ozs7OztJQUlPLGNBQWM7UUFDcEIsT0FBTztRQUNQLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLFdBQVc7WUFBRSxJQUFJLENBQUMsU0FBUyxDQUFDLGNBQWMsQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUN6RSxJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxXQUFXLEVBQUU7O2tCQUN6QixJQUFJLEdBQUcsWUFBWSxDQUFDLE9BQU8sQ0FBQyxjQUFjLENBQUMsSUFBSSxRQUFRO1lBQzdELElBQUksQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLElBQUksSUFBSSxRQUFRLENBQUMsQ0FBQTtTQUNyQztRQUNELElBQUksQ0FBQyxNQUFNLENBQUMsbUJBQW1CLEVBQUU7a0JBQ3pCLEVBQUUsV0FBVyxFQUFFLEdBQUcsSUFBSSxDQUFDLFNBQVM7WUFDdEMsSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsR0FBRyxjQUFjLGVBQWUsV0FBVyxPQUFPLENBQUMsQ0FBQyxTQUFTOzs7O1lBQUMsR0FBRyxDQUFDLEVBQUU7Z0JBQ2hGLElBQUksQ0FBQyxTQUFTLENBQUMsY0FBYyxDQUFDLFdBQVcsRUFBRSxHQUFHLEVBQUUsSUFBSSxDQUFDLENBQUE7WUFDdkQsQ0FBQyxFQUFDLENBQUE7WUFDRixNQUFNLENBQUMsbUJBQW1CLEdBQUcsSUFBSSxDQUFBO1NBQ2xDO0lBQ0gsQ0FBQzs7OztJQUVELFFBQVE7UUFDTixJQUFJLENBQUMsVUFBVSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsVUFBVSxFQUFFLElBQUksRUFBRSxZQUFZLENBQUMsQ0FBQTtRQUMvRCxnRUFBZ0U7UUFDaEUsSUFBSSxJQUFJLENBQUMsWUFBWSxFQUFFO1lBQ3JCLElBQUksY0FBYzs7OztZQUFDLE9BQU8sQ0FBQyxFQUFFO3NCQUNyQixFQUFFLEtBQUssRUFBRSxNQUFNLEVBQUUsR0FBRyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsV0FBVztnQkFDaEQsSUFBSSxJQUFJLENBQUMsY0FBYztvQkFBRSxJQUFJLENBQUMsY0FBYyxDQUFDLFNBQVMsQ0FBQyxLQUFLLEVBQUUsTUFBTSxDQUFDLENBQUE7Z0JBQ3JFLElBQUksQ0FBQyxLQUFLLEdBQUcsS0FBSyxDQUFBO2dCQUNsQixJQUFJLENBQUMsTUFBTSxHQUFHLE1BQU0sQ0FBQTtnQkFDcEIsSUFBSSxDQUFDLEVBQUUsQ0FBQyxZQUFZLEVBQUUsQ0FBQTtZQUN4QixDQUFDLEVBQUMsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxhQUFhLENBQUMsQ0FBQTtTQUM1QztJQUNILENBQUM7Ozs7O0lBRUQsV0FBVyxDQUFFLENBQWdCO2NBQ3JCLEVBQUUsZUFBZSxFQUFFLEdBQUcsQ0FBQztRQUM3QixJQUFJLGVBQWUsSUFBSSxlQUFlLENBQUMsWUFBWSxJQUFJLGVBQWUsQ0FBQyxZQUFZLEtBQUssZUFBZSxDQUFDLGFBQWEsRUFBRTtZQUNySCxtQkFBbUI7WUFDbkIsSUFBSSxDQUFDLFlBQVksRUFBRSxDQUFBO1NBQ3BCO0lBQ0gsQ0FBQzs7Ozs7SUFJTSxtQkFBbUI7UUFDeEIsSUFBSSxJQUFJLENBQUMsY0FBYyxJQUFJLElBQUksQ0FBQyxjQUFjLENBQUMsU0FBUyxFQUFFO2tCQUNsRCxFQUFFLFdBQVcsRUFBRSxZQUFZLEVBQUUsR0FBRyxJQUFJLENBQUMsWUFBWSxDQUFDLGFBQWE7WUFDckUsSUFBSSxDQUFDLGNBQWMsQ0FBQyxTQUFTLENBQUMsV0FBVyxFQUFFLFlBQVksQ0FBQyxDQUFBO1NBQ3pEO0lBQ0gsQ0FBQzs7Ozs7Ozs7OztJQU9NLGdCQUFnQixDQUFFLFFBQWdCLEVBQUUsTUFBTTtRQUMvQyxnREFBZ0Q7UUFDaEQsSUFBSSxRQUFRLEtBQUssU0FBUztZQUFFLE9BQU07UUFDbEMsZ0RBQWdEO1FBQ2hELElBQUksT0FBTyxNQUFNLEtBQUssUUFBUSxJQUFJLElBQUksQ0FBQyxjQUFjLENBQUMsUUFBUSxDQUFDLEtBQUssTUFBTTtZQUFFLE9BQU07OztjQUU1RSxLQUFLLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUM7UUFDcEMsS0FBSzs7UUFBTCxLQUFLO1FBQ0wsSUFBSSxDQUFDLGNBQWMsQ0FBQyxRQUFRLENBQUMsR0FBRyxLQUFLLENBQUE7UUFDckMsbUJBQW1CO1FBQ25CLDBCQUEwQjtRQUMxQixJQUFJLElBQUksQ0FBQyxjQUFjLENBQUMsZ0JBQWdCLEVBQUU7WUFDeEMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxnQkFBZ0IsQ0FBQyxRQUFRLEVBQUUsS0FBSyxDQUFDLENBQUE7U0FDdEQ7UUFDRCxJQUFJLFFBQVEsS0FBSyxnQkFBZ0IsRUFBRTtZQUNqQyxJQUFJLENBQUMsUUFBUSxHQUFHLENBQUMsbUJBQUEsTUFBTSxFQUFrQixDQUFDO2lCQUN2QyxNQUFNOzs7O1lBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsSUFBSSxFQUFDO2lCQUNyQixHQUFHOzs7O1lBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDO2dCQUNWLEtBQUssRUFBRSxZQUFZLENBQUMsZUFBZSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUM7Z0JBQzFDLElBQUksRUFBRSxFQUFFLENBQUMsSUFBSTthQUNkLENBQUMsRUFBQyxDQUFBO1lBQ0wsUUFBUTtZQUVSLGlGQUFpRjtZQUNqRix5QkFBeUI7U0FDMUI7UUFDRCxJQUFJLENBQUMsSUFBSSxDQUFDLFVBQVU7WUFBRSxJQUFJLENBQUMsVUFBVSxHQUFHLEVBQUUsQ0FBQTtRQUMxQyxJQUFJLENBQUMsVUFBVSxDQUFDLFFBQVEsQ0FBQyxHQUFHLE1BQU0sQ0FBQTtRQUNsQyxJQUFJLENBQUMsRUFBRSxDQUFDLFlBQVksRUFBRSxDQUFBO0lBQ3hCLENBQUM7Ozs7Ozs7SUFHTyxTQUFTLENBQUUsS0FBSztjQUNoQixFQUFFLFdBQVcsRUFBRSxHQUFHLElBQUksQ0FBQyxTQUFTO1FBQ3RDLElBQUk7WUFDRixLQUFLLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUE7U0FDMUM7UUFBQyxPQUFPLENBQUMsRUFBRSxHQUFHO1FBQ2YsT0FBTyxxQkFBcUIsQ0FBQyxLQUFLLENBQUMsQ0FBQTs7Ozs7UUFFbkMsU0FBUyxxQkFBcUIsQ0FBRSxNQUFNO1lBQ3BDLElBQUksS0FBSyxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsRUFBRTtnQkFDekIsTUFBTSxDQUFDLE9BQU87Ozs7O2dCQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFO29CQUN0QixNQUFNLENBQUMsQ0FBQyxDQUFDLEdBQUcscUJBQXFCLENBQUMsQ0FBQyxDQUFDLENBQUE7Z0JBQ3RDLENBQUMsRUFBQyxDQUFBO2dCQUNGLE9BQU8sTUFBTSxDQUFBO2dCQUNiLHVEQUF1RDthQUN4RDtpQkFBTSxJQUFJLE1BQU0sSUFBSSxDQUFDLE1BQU0sQ0FBQyxXQUFXLElBQUksT0FBTyxDQUFDLE1BQU0sQ0FBQyxFQUFFLEdBQUcsTUFBTSxDQUFDLFFBQVEsQ0FBQyxHQUFHLE1BQU0sQ0FBQyxXQUFXLENBQUMsQ0FBQyxLQUFLLFFBQVEsRUFBRTtnQkFDcEgsT0FBTyxNQUFNLENBQUMsV0FBVyxDQUFDLENBQUE7Z0JBQzFCLE9BQU87YUFDUjtpQkFBTSxJQUFJLE1BQU0sSUFBSSxNQUFNLENBQUMsTUFBTSxLQUFLLE1BQU0sRUFBRTtnQkFDN0MsT0FBTyxNQUFNLENBQUMsS0FBSyxDQUFBO2FBQ3BCO2lCQUFNLElBQUksTUFBTSxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLEVBQUU7Z0JBQ2pFLE1BQU0sQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsT0FBTzs7OztnQkFBQyxHQUFHLENBQUMsRUFBRTtvQkFDaEMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxHQUFHLHFCQUFxQixDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFBO2dCQUNsRCxDQUFDLEVBQUMsQ0FBQTtnQkFDRixPQUFPLE1BQU0sQ0FBQTthQUNkO2lCQUFNO2dCQUNMLE9BQU8sTUFBTSxDQUFBO2FBQ2Q7UUFDSCxDQUFDO0lBQ0gsQ0FBQzs7OztJQUNZLFlBQVk7OztrQkFFakIsRUFBRSxPQUFPLEVBQUUsR0FBRyxJQUFJLENBQUMsZUFBZTs7a0JBQ2xDLGFBQWEsR0FBRyxNQUFNLElBQUksQ0FBQyxNQUFNLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxlQUFlLEVBQUUsSUFBSSxDQUFDLFVBQVUsRUFBRSxJQUFJLENBQUMsSUFBSSxDQUFDO1lBQ3BHLDhEQUE4RDs7O2tCQUN4RCxFQUFFLGlCQUFpQixFQUFFLG1CQUFtQixFQUFFLFVBQVUsRUFBRSxZQUFZLEVBQUUsR0FBRyxhQUFhO1lBQzFGLElBQUksQ0FBQyxlQUFlLEdBQUcsWUFBWSxDQUFBO1lBQ25DLElBQUksQ0FBQyxjQUFjLEVBQUUsQ0FBQTtZQUNyQixJQUFJLElBQUksQ0FBQyxlQUFlLENBQUMsaUJBQWlCO2dCQUFFLElBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQTtZQUM5RCxZQUFZO1lBQ1osSUFBSSxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLENBQUE7WUFDckMsUUFBUTtZQUNSLElBQUksQ0FBQyxlQUFlLENBQUMsTUFBTSxFQUFFLENBQUE7OztrQkFFdkIsUUFBUSxHQUFHLFFBQVEsQ0FBQyxNQUFNLENBQUM7Z0JBQy9CLFNBQVMsRUFBRSxDQUFDO3dCQUNWLE9BQU8sRUFBRSxrQkFBa0I7Ozs7d0JBQzNCLFFBQVEsRUFBRSxJQUFJLGtCQUFrQixDQUM5QixJQUFJLENBQUMsT0FBTyxDQUFDLEVBQUUsRUFDZixJQUFJLENBQUMsVUFBVSxFQUNmLElBQUksQ0FBQyxhQUFhLElBQUksSUFBSSxDQUFDLGVBQWUsQ0FBQyxPQUFPLEdBQUcsVUFBVSxDQUNoRTtxQkFDRixFQUFFO3dCQUNELE9BQU8sRUFBRSxpQkFBaUI7Ozs7d0JBQzFCLFVBQVU7Ozt3QkFBRSxHQUFHLEVBQUU7NEJBQ2YsSUFBSSxDQUFDLGlCQUFpQixHQUFHLElBQUksaUJBQWlCLEVBQUUsQ0FBQTs0QkFDaEQsSUFBSSxDQUFDLGlCQUFpQixDQUFDLFVBQVU7aUNBQzlCLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxxRUFBcUU7aUNBQ3BGLFNBQVMsQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFBOzRCQUMxQyxPQUFPLElBQUksQ0FBQyxpQkFBaUIsQ0FBQTt3QkFDL0IsQ0FBQyxDQUFBO3dCQUNELElBQUksRUFBRSxFQUFFO3FCQUNULENBQUM7Z0JBQ0YsTUFBTSxFQUFFLElBQUksQ0FBQyxRQUFRO2FBQ3RCLENBQUM7WUFDRixrQkFBa0I7O1lBQWxCLGtCQUFrQjtZQUNsQixJQUFJLENBQUMsY0FBYyxHQUFHLG1CQUFBLElBQUksQ0FBQyxlQUFlLENBQUMsZUFBZSxDQUN4RCxpQkFBaUIsRUFBRSxDQUFDLEVBQUUsUUFBUSxFQUFFLFNBQVMsRUFDekMsbUJBQW1CLElBQUksbUJBQW1CLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FDakUsQ0FBQyxRQUFRLEVBQWMsQ0FBQTtZQUV4QixrQ0FBa0M7WUFDbEMsZ0JBQWdCO1lBQ2hCLE1BQU0sQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUMsT0FBTzs7OztZQUFDLElBQUksQ0FBQyxFQUFFO2dCQUNyQyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsSUFBSSxFQUFFLFVBQVUsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFBO1lBQy9DLENBQUMsRUFBQyxDQUFBO1lBRUYsdUNBQXVDO1lBQ3ZDLElBQUksQ0FBQyxjQUFjLENBQUMsRUFBRSxHQUFHLElBQUksQ0FBQyxVQUFVLENBQUE7WUFDeEMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxTQUFTLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUE7WUFDL0MsSUFBSSxDQUFDLGNBQWMsQ0FBQyxhQUFhLEdBQUcsSUFBSSxDQUFDLGFBQWEsSUFBSSxPQUFPLEdBQUcsVUFBVSxDQUFBO1lBQzlFLElBQUksSUFBSSxDQUFDLGNBQWMsQ0FBQyxhQUFhO2dCQUFFLElBQUksQ0FBQyxZQUFZLENBQUMsRUFBRSxDQUFDLENBQUE7WUFFNUQsaURBQWlEO1lBQ2pELDhCQUE4QjtZQUM5QixRQUFRO1lBQ1IsSUFBSSxDQUFDLHVCQUF1QixFQUFFLENBQUE7WUFDOUIsYUFBYTtZQUNiLElBQUksQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxDQUFBO1lBQ25DLHlCQUF5QjtZQUN6QixJQUFJLENBQUMsTUFBTSxHQUFHLFFBQVEsQ0FBQyxNQUFNLENBQUE7WUFDN0IsSUFBSSxDQUFDLEVBQUUsQ0FBQyxZQUFZLEVBQUUsQ0FBQTtRQUN4QixDQUFDO0tBQUE7Ozs7O0lBRU8sV0FBVztjQUNYLEVBQUUsV0FBVyxFQUFFLEdBQUcsSUFBSSxDQUFDLFNBQVM7Y0FDaEMsRUFBRSxJQUFJLEVBQUUsT0FBTyxFQUFFLEdBQUcsSUFBSSxDQUFDLGVBQWU7Y0FDeEMsRUFBRSxxQkFBcUIsRUFBRSxHQUFHLElBQUksQ0FBQyxlQUFlOztjQUNoRCxVQUFVLEdBQUcscUJBQXFCLElBQUksR0FBRyxPQUFPLGdCQUFnQixXQUFXLE9BQU87UUFFeEYsdURBQXVEOztRQUF2RCx1REFBdUQ7UUFDdkQsSUFBSSxjQUFjLENBQUMsUUFBUSxDQUFDLFVBQVUsQ0FBQztZQUFFLE9BQU07UUFDL0MsY0FBYyxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQTtRQUUvQixPQUFPLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLFVBQVUsQ0FBQyxDQUFDLFNBQVMsRUFBRSxDQUFDLElBQUk7Ozs7UUFBQyxHQUFHLENBQUMsRUFBRTtZQUN0RCxJQUFJLENBQUMsU0FBUyxDQUFDLGNBQWMsQ0FBQyxXQUFXLEVBQUUsR0FBRyxFQUFFLElBQUksQ0FBQyxDQUFBO1FBQ3ZELENBQUM7OztRQUFFLEdBQUcsRUFBRTtZQUNOLE9BQU8sQ0FBQyxHQUFHLENBQUMsT0FBTyxJQUFJLE1BQU0sV0FBVyxRQUFRLENBQUMsQ0FBQTtRQUNuRCxDQUFDLEVBQUMsQ0FBQyxPQUFPOzs7UUFBQyxHQUFHLEVBQUU7WUFDZCxPQUFPLE9BQU8sQ0FBQyxPQUFPLEVBQUUsQ0FBQTtRQUMxQixDQUFDLEVBQUMsQ0FBQTtJQUNKLENBQUM7Ozs7Ozs7O0lBV00sWUFBWSxDQUFFLFFBRWpCLEVBQUU7O2NBQ0UsRUFBRSxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUM7WUFDdEIsUUFBUSxFQUFFLG1CQUFtQixDQUFDLElBQUksQ0FBQyxRQUFRLEVBQUUsS0FBSyxDQUFDLFFBQVEsQ0FBQztZQUM1RCxVQUFVLEVBQUUsSUFBSSxDQUFDLFVBQVU7U0FDNUIsQ0FBQztRQUNGLElBQUksQ0FBQyxFQUFFO1lBQUUsT0FBTTtRQUNmLEVBQUUsQ0FBQyxTQUFTOzs7O1FBQUMsWUFBWSxDQUFDLEVBQUU7WUFDMUIsSUFBSSxDQUFDLE9BQU8sQ0FBQyxZQUFZLENBQUMsQ0FBQTtRQUM1QixDQUFDLEdBQUUsSUFBSSxDQUFDLGVBQWUsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQTtJQUNyQyxDQUFDOzs7Ozs7SUFJTSxPQUFPLENBQUUsYUFBMkI7O1lBQ3JDLFlBQVksR0FBRyxhQUFhO1FBQ2hDLHNCQUFzQjs7UUFBdEIsc0JBQXNCO1FBQ3RCLElBQUksQ0FBQyxhQUFhLElBQUksQ0FBQyxhQUFhLENBQUMsU0FBUyxJQUFJLGFBQWEsQ0FBQyxTQUFTLENBQUMsTUFBTSxLQUFLLENBQUM7WUFBRSxJQUFJLENBQUMsTUFBTSxHQUFHLFFBQVEsQ0FBQyxTQUFTLENBQUE7UUFDeEgsMERBQTBEO1FBQzFELElBQUksQ0FBQyxhQUFhLENBQUMsVUFBVSxJQUFJLGFBQWEsQ0FBQyxRQUFRLENBQUMsRUFBRTtZQUN4RCxZQUFZLEdBQUc7Z0JBQ2IsVUFBVSxFQUFFLE1BQU07cUJBQ2YsSUFBSSxDQUFDLGFBQWEsQ0FBQyxDQUFDLENBQUMsQ0FBQztxQkFDdEIsR0FBRzs7OztnQkFBQyxHQUFHLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxJQUFJLEVBQUUsR0FBRyxFQUFFLEtBQUssRUFBRSxHQUFHLEVBQUUsQ0FBQyxFQUFDO2dCQUMxQyxTQUFTLEVBQUUsQ0FBQyxtQkFBQSxtQkFBQSxhQUFhLEVBQVcsRUFBUyxDQUFDO2FBQy9DLENBQUE7U0FDRjtRQUNELElBQUksQ0FBQyxNQUFNLEdBQUcsUUFBUSxDQUFDLE1BQU0sQ0FBQTtRQUM3QixJQUFJLENBQUMsSUFBSSxHQUFHLFlBQVksQ0FBQyxTQUFTLENBQUE7UUFDbEMsSUFBSSxDQUFDLElBQUksR0FBRyxZQUFZLENBQUMsVUFBVSxDQUFBO1FBRW5DLElBQUksSUFBSSxDQUFDLGlCQUFpQjtZQUFFLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxPQUFPLENBQUMsWUFBWSxDQUFDLENBQUE7UUFDeEUsSUFBSSxJQUFJLENBQUMsY0FBYyxJQUFJLElBQUksQ0FBQyxjQUFjLENBQUMsYUFBYTtZQUFFLElBQUksQ0FBQyxjQUFjLENBQUMsU0FBUyxDQUFDLFlBQVksQ0FBQyxTQUFTLENBQUMsQ0FBQSxDQUFDLE9BQU87UUFFM0gsOEJBQThCO1FBQzlCLElBQUksQ0FBQyxpQkFBaUIsRUFBRSxDQUFBO1FBQ3hCLElBQUksQ0FBQyxFQUFFLENBQUMsWUFBWSxFQUFFLENBQUE7SUFDeEIsQ0FBQzs7OztJQU9ELHFCQUFxQjtRQUNuQixJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQztZQUNmLE9BQU8sRUFBRSxPQUFPO1lBQ2hCLFNBQVMsRUFBRSwyQkFBMkI7U0FDdkMsQ0FBQyxDQUFBO0lBQ0osQ0FBQzs7Ozs7SUFFRCxrQkFBa0IsQ0FBRSxRQUFtQjtRQUNyQyxhQUFhLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFBRSxRQUFRLENBQUMsQ0FBQTtRQUN0QyxJQUFJLENBQUMsWUFBWSxFQUFFLENBQUE7SUFDckIsQ0FBQzs7Ozs7SUFRRCxzQkFBc0IsQ0FBRSxVQUE0QjtRQUNsRCw4REFBOEQ7UUFDOUQsSUFBSSxDQUFDLFVBQVUsR0FBRyxVQUFVLENBQUE7UUFDNUIsMENBQTBDO1FBQzFDLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUE7UUFDdEMsSUFBSSxDQUFDLFlBQVksRUFBRSxDQUFBO0lBQ3JCLENBQUM7Ozs7OztJQUVELGtCQUFrQixDQUFFLFFBQTJCO1FBQzdDLElBQUksSUFBSSxDQUFDLGNBQWMsRUFBRTtZQUN2QixRQUFRLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQTtTQUN4QztJQUNILENBQUM7Ozs7SUFDRCxjQUFjO1FBQ1osY0FBYztRQUNkLElBQUksQ0FBQyxjQUFjLEdBQUcsd0JBQXdCLENBQUMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxJQUFJLENBQUMsQ0FBQTtRQUN6RSxJQUFJLElBQUksQ0FBQyxjQUFjLEVBQUU7WUFDdkIsSUFBSSxDQUFDLFVBQVUsR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxPQUFPLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUE7U0FDdEY7SUFDSCxDQUFDOzs7Ozs7O0lBS08sdUJBQXVCO1FBQzdCLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTztZQUFFLE9BQU07UUFDekIsSUFBSSxJQUFJLENBQUMsZUFBZSxFQUFFLEVBQUU7WUFDMUIsSUFBSSxDQUFDLG9CQUFvQixDQUFDLHdCQUF3QixDQUFDLENBQUE7U0FDcEQ7YUFBTTtZQUNMLElBQUksQ0FBQyxrQkFBa0I7aUJBQ3BCLHFCQUFxQixDQUFDLElBQUksQ0FBQyxlQUFlLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxVQUFVLENBQUM7aUJBQ2pFLE9BQU87Ozs7WUFBQyxXQUFXLENBQUMsRUFBRTtnQkFDbkIsSUFBSSxDQUFDLG9CQUFvQixDQUFDLFdBQVcsQ0FBQyxRQUFRLENBQUMsQ0FBQTtZQUNuRCxDQUFDLEVBQUMsQ0FBQTtTQUNIO0lBQ0wsQ0FBQzs7Ozs7Ozs7OztJQU9PLG9CQUFvQixDQUFFLGFBQXFCOztjQUMzQyxZQUFZLEdBQUcsSUFBSSxDQUFDLGNBQWMsQ0FBQyxhQUFhLENBQUM7UUFDdkQsSUFBSSxZQUFZO1lBQUUsWUFBWSxDQUFDLFNBQVM7Ozs7WUFBQyxnQkFBZ0IsQ0FBQyxFQUFFO2dCQUMxRCxPQUFPLENBQUMsR0FBRyxDQUFDLFlBQVksR0FBRyxnQkFBZ0IsQ0FBQyxDQUFBOztzQkFDdEMsWUFBWSxHQUFHLElBQUksQ0FBQyxlQUFlLEVBQUU7b0JBQzNDLENBQUMsQ0FBQyxDQUFDLG1CQUFBLGdCQUFnQixFQUEwQixDQUFDLENBQUMsUUFBUTtvQkFDdkQsQ0FBQyxDQUFDLGFBQWE7Z0JBQ2YsaUNBQWlDOzs7O3NCQUMzQixRQUFRLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxZQUFZLENBQUM7Z0JBQzNDLE1BQU0sQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUMsT0FBTzs7OztnQkFBQyxNQUFNLENBQUMsRUFBRTtvQkFDckMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsQ0FBQyxNQUFNLElBQUksQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSTt3QkFBRSxPQUFNOzswQkFDN0UsVUFBVSxHQUFHLElBQUksQ0FBQyxVQUFVLENBQUMsY0FBYyxDQUFDLE1BQU0sQ0FBQyxDQUFDLFVBQVU7b0JBQ3BFLElBQUksVUFBVTt3QkFBRSxVQUFVLENBQUMsWUFBWSxDQUFDOzRCQUN0QyxRQUFRLEVBQUUsQ0FBQztvQ0FDVCxJQUFJLEVBQUUsUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUk7O29DQUUzQixLQUFLLEVBQUUsTUFBTSxDQUFDLGdCQUFnQixDQUFDLFdBQVcsQ0FBQyxDQUFDO2lDQUM3QyxDQUFDO3lCQUNILENBQUMsQ0FBQTtnQkFDSixDQUFDLEVBQUMsQ0FBQTtZQUNKLENBQUMsRUFBQyxDQUFBO0lBQ0osQ0FBQzs7OztJQUNELGlCQUFpQjtRQUNmLElBQUksQ0FBQyxJQUFJLENBQUMsVUFBVTtZQUFFLE9BQU07UUFDNUIsZ0JBQWdCLENBQUMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxJQUFJLENBQUMsQ0FBQyxPQUFPOzs7O1FBQUMsUUFBUSxDQUFDLEVBQUU7WUFDN0QsSUFBSSxDQUFDLGdCQUFnQixDQUFDLFFBQVEsQ0FBQyxJQUFJLEVBQUUsUUFBUSxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsVUFBVSxFQUFFLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFBO1FBQ3pGLENBQUMsRUFBQyxDQUFBO0lBQ0osQ0FBQzs7OztJQUNELGVBQWU7UUFDYixPQUFPLElBQUksQ0FBQyxlQUFlLENBQUMsSUFBSSxLQUFLLG1CQUFtQjtlQUNuRCxJQUFJLENBQUMsZUFBZSxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsT0FBTyxDQUFDLENBQUE7SUFDckQsQ0FBQzs7O1lBbGFGLFNBQVMsU0FBQztnQkFDVCxRQUFRLEVBQUUsWUFBWTtnQkFDdEIsbTdHQUFzQzs7YUFFdkM7Ozs7WUExQ1Esb0JBQW9CO1lBakIzQixpQkFBaUI7WUFDSCxRQUFRO1lBWWYsY0FBYztZQWZkLFVBQVU7WUFjVixnQkFBZ0I7WUFGd0UscUJBQXFCO1lBQTdELGtCQUFrQjtZQVFsRSxlQUFlOzs7OEJBNENyQixLQUFLO3lCQUVMLEtBQUs7c0JBQ0wsS0FBSzttQkFFTCxLQUFLOzRCQUVMLEtBQUs7c0JBR0wsS0FBSzt5QkFFTCxLQUFLO3NCQU1MLEtBQUs7cUJBQ0wsS0FBSzsyQkFHTCxNQUFNO3lCQUVOLE1BQU07K0JBQ04sTUFBTTsyQkFJTixTQUFTLFNBQUMsY0FBYzs4QkFDeEIsU0FBUyxTQUFDLElBQUksRUFBRSxFQUFFLElBQUksRUFBRSxnQkFBZ0IsRUFBRTt1QkFDMUMsU0FBUyxTQUFDLFVBQVU7Ozs7Ozs7SUEvQnJCLDBDQUF5Qzs7Ozs7SUFFekMscUNBQW1COztJQUNuQixrQ0FBeUI7Ozs7O0lBRXpCLCtCQUF1Qzs7Ozs7SUFFdkMsd0NBQThCOzs7OztJQUc5QixrQ0FBbUQ7Ozs7O0lBRW5ELHFDQUEyQjs7Ozs7OztJQU0zQixrQ0FBMkU7O0lBQzNFLGlDQUF3Qzs7Ozs7SUFHeEMsdUNBQTJDOzs7OztJQUUzQyxxQ0FBeUM7O0lBQ3pDLDJDQUErQzs7SUFJL0MsdUNBQXVDOztJQUN2QywwQ0FBOEU7O0lBQzlFLG1DQUFrRDs7SUFJbEQsbUNBQTBCOztJQUMxQix5Q0FBc0M7O0lBQ3RDLDJDQUEwQzs7SUFDMUMsZ0NBQW9COztJQUNwQixpQ0FBcUI7O0lBQ3JCLDBDQUE4Qzs7Ozs7SUFHOUMsK0JBQXlCOzs7OztJQUV6QiwrQkFBd0I7O0lBQ3hCLHlDQUFpQzs7SUFDakMseUNBQTZCOzs7OztJQUk3Qiw0Q0FBNEM7Ozs7OztJQTBONUMsbUNBQXdCOztJQThDeEIsMENBSUM7O0lBT0QsdUNBQW1COzs7Ozs7O0lBV25CLHFDQUE0Qjs7Ozs7SUExUjFCLGlDQUFvQzs7Ozs7SUFDcEMsNkJBQTZCOzs7OztJQUM3QixtQ0FBMEI7Ozs7O0lBQzFCLGdDQUE2Qjs7Ozs7SUFDN0IsK0JBQXdCOzs7OztJQUN4QixvQ0FBbUM7Ozs7O0lBQ25DLGdEQUFvRDs7Ozs7SUFDcEQsNkNBQThDOzs7OztJQUM5QyxxQ0FBbUM7Ozs7Ozs7OztBQW1XdkMsU0FBUyxhQUFhLENBQUUsV0FBc0IsRUFBRSxXQUFzQjtJQUNwRSxLQUFLLE1BQU0sS0FBSyxJQUFJLFdBQVcsQ0FBQyxNQUFNOzs7O0lBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsSUFBSSxFQUFDLEVBQUU7O2NBQy9DLFdBQVcsR0FBRyxXQUFXLENBQUMsSUFBSTs7OztRQUFDLEtBQUssQ0FBQyxFQUFFLENBQUMsS0FBSyxDQUFDLElBQUksS0FBSyxLQUFLLENBQUMsSUFBSSxFQUFDO1FBQ3hFLElBQUksV0FBVyxFQUFFO1lBQ2YsV0FBVyxDQUFDLEtBQUssR0FBRyxLQUFLLENBQUMsS0FBSyxDQUFBO1NBQ2hDO2FBQU07WUFDTCxXQUFXLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFBO1NBQ3hCO0tBQ0Y7QUFDSCxDQUFDOzs7Ozs7QUFDRCxTQUFTLG1CQUFtQixDQUFFLGNBQXlCLEVBQUUsRUFBRSxjQUF5QixFQUFFOztVQUM5RSxNQUFNLEdBQUcsV0FBVyxDQUFDLEtBQUssRUFBRTtJQUNsQyxhQUFhLENBQUMsTUFBTSxFQUFFLFdBQVcsQ0FBQyxDQUFBO0lBQ2xDLE9BQU8sTUFBTSxDQUFBO0FBQ2YsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEh0dHBDbGllbnQgfSBmcm9tICdAYW5ndWxhci9jb21tb24vaHR0cCc7XG5pbXBvcnQge1xuICBDaGFuZ2VEZXRlY3RvclJlZiwgQ29tcG9uZW50LFxuICBFdmVudEVtaXR0ZXIsIEluamVjdG9yLCBJbnB1dCxcbiAgT25DaGFuZ2VzLCBPbkluaXQsXG4gIE91dHB1dCwgU2ltcGxlQ2hhbmdlcywgVmlld0NoaWxkLCBWaWV3Q29udGFpbmVyUmVmXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgQmFzaWNXaWRnZXRJbmZvLCBEYXRhV2l0aERpbXMsIERpbWVuc2lvbiwgRHBWYWx1ZSwgRXBwUG9ydGxldCwgRklMVEVSU19XSURHRVRfTkFNRSwgRklMVEVSU19XSURHRVRfUFJPUF9OQU1FLCBGaWx0ZXJXaWRnZXRFdmVudFBhcmFtLCBJR0lYX0hPTUVfUEFUSCwgTGlua01hcCwgbG9hZENvbW1vblN0eWxlTlRoZW1lLCBvYmplY3RMaXRlcmFsRXF1YWwsIFJ1bnRpbWVBZ2dPcHRpb24sIFdpZGdldENvbnRhaW5lck1vZGUgfSBmcm9tICdAZ3Nwd2lkZ2V0L3V0aWwnO1xuaW1wb3J0IHtcbiAgRmlsdGVyQ29uZmlnLFxuICBGaWx0ZXJTY2hlbWEsXG4gIEZJTFRFUl9QUk9QX05BTUUsXG4gIFJlZ2lzdGVyZWRXaWRnZXRDb25maWcsIFdpZGdldEJhc2UsIFdpZGdldERhdGFTZXJ2aWNlLCBXaWRnZXRFdmVudFNlcnZpY2UsIFdpZGdldEluc3RhbmNlSW5mbywgV2lkZ2V0UHJvcGVydHlTZXJ2aWNlXG59IGZyb20gJ0Bnc3B3aWRnZXQvd2lkZ2V0LWRldmtpdCc7XG5pbXBvcnQgeyBUcmFuc2xhdGVTZXJ2aWNlIH0gZnJvbSAnQG5neC10cmFuc2xhdGUvY29yZSc7XG5pbXBvcnQgeyBOek1vZGFsU2VydmljZSB9IGZyb20gJ25nLXpvcnJvLWFudGQvbW9kYWwnO1xuaW1wb3J0IFJlc2l6ZU9ic2VydmVyIGZyb20gJ3Jlc2l6ZS1vYnNlcnZlci1wb2x5ZmlsbCc7XG5pbXBvcnQgeyBPYnNlcnZhYmxlIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBkZWxheSB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7IER5bmFtaWNMb2FkZXJTZXJ2aWNlIH0gZnJvbSAnLi4vZHluYW1pYy1sb2FkZXIuc2VydmljZSc7XG5pbXBvcnQgeyBJbnN0YW5jZVNlcnZpY2UgfSBmcm9tICcuLi9pbnN0YW5jZS5zZXJ2aWNlJztcbmltcG9ydCB7IFRpdGxlQmFyQ29tcG9uZW50IH0gZnJvbSAnLi4vdGl0bGUtYmFyL3RpdGxlLWJhci5jb21wb25lbnQnO1xuaW1wb3J0IHsgY2hhcnRBZ2dGaWVsZE1hcCwgaXNXaWRnZXRSdW50aW1lQWdnQWN0aXZlIH0gZnJvbSAnLi9ydW50aW1lLWFnZyc7XG5cbiAgLyoqIOW3suiiqyBzZXQg57+76K+R55qEIGxhbmfvvIzkuIvmrKHkuI3lho3or7fmsYLmraQgbGFuZyAqL1xuICAvLyBwcml2YXRlIGxhbmdzU2V0OiB7IFt3aWRnZXROYW1lOiBzdHJpbmddOiBzdHJpbmdbXSB9ID0ge31cbmNvbnN0IGxvYWRlZEkxOG5VcmxzOiBzdHJpbmdbXSA9IFtdXG5cbmRlY2xhcmUgZ2xvYmFsIHtcbiAgaW50ZXJmYWNlIFdpbmRvdyB7XG4gICAgd2lkZ2V0STE4blJlc0xvYWRlZDogYm9vbGVhblxuICAgIHdpZGdldFN0eWxlTG9hZGVkOiBib29sZWFuXG4gICAgZGVmaW5lOiBhbnlcbiAgfVxufVxuZXhwb3J0IGVudW0gV0NTdGF0dXMge1xuICBMb2FkaW5nV2lkZ2V0LFxuICBMb2FkaW5nRGF0YSxcbiAgRGF0YUVtcHR5LFxuICBOb3JtYWwsXG4gIERhdGFFcnJvcixcbiAgV2lkZ2V0TG9hZEVycm9yLFxufVxuZXhwb3J0IGludGVyZmFjZSBHZXREYXRhT3B0aW9ucyB7XG4gIGRwVmFsdWVzOiBEcFZhbHVlW10sXG4gIHJ1bnRpbWVBZ2c6IFJ1bnRpbWVBZ2dPcHRpb25cbn1cblxubG9hZENvbW1vblN0eWxlTlRoZW1lKClcbi8qKlxuICog5YW85a656Zi25q615pWw5o2u5Yqg6L296YC76L6RXG4gKiAxLiDoi6XlhYPpg6jku7YgdXNlRGF0YUVuZ2luZSA9PT0gdHJ1ZSwg6K+05piO5piv6ICB5YaZ5rOV44CB5LiU6ZyA6KaB5pWw5o2u55qE5YWD6YOo5Lu277yM5L2G5YW25YaF6YOo5pyq6LCD55So5Yqg6L295pWw5o2u77yM5omA5Lul5Yid5aeL5YyW5a6M5oiQ5ZCO5Yqg6L295LiA5LiL77ybXG4gKiAgICDmlrDmlbDmja7liqDovb3or7fmsYLlpITnkIbmsLjov5zlkK/nlKjvvIzlm6DkuLrku4XmnInmlrDlhpnms5XlhYPpg6jku7bkvJrop6blj5HvvJtcbiAqIDIuIOiLpSBnZXREYXRhIOacieWAvO+8jOWImeeUqOWug+iOt+W+l+aVsOaNru+8jOS4jeeUqOecn+aVsOaNrlxuICogMy4g6Iul5ZCN5Lit5bim5pyJICfmvJTnpLon77yM5YiZ55So5ryU56S65pWw5o2uXG4gKiA0LiDpg73kuI3mu6HotrPlho3nlKjnnJ/mlbDmja5cbiAqL1xuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnbGliLXdpZGdldCcsXG4gIHRlbXBsYXRlVXJsOiAnLi93aWRnZXQuY29tcG9uZW50Lmh0bWwnLFxuICBzdHlsZVVybHM6IFsnLi93aWRnZXQuY29tcG9uZW50LnNjc3MnXVxufSlcbmV4cG9ydCBjbGFzcyBXaWRnZXRDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIE9uQ2hhbmdlcyB7XG4gIC8qKiDlv4XpgInvvIzopoHmuLLmn5PnmoQgd2lkZ2V0IOS/oeaBryAqL1xuICBASW5wdXQoKSBiYXNpY1dpZGdldEluZm86IEJhc2ljV2lkZ2V0SW5mb1xuICAvKiog5b+F6YCJ77yM5q2kIHdpZGdldCDnmoTphY3nva7kv6Hmga/vvJvku4XlnKjlhYPpg6jku7bliqDovb3ml7botbfkvZznlKjvvIzoi6XlsZ7mgKfmlLnlj5jvvIzlv4XpnIDosIPnlKggc2V0UHJvcFZhbHVlcygpICovXG4gIEBJbnB1dCgpIHByb3BWYWx1ZXNcbiAgQElucHV0KCkgbGlua01hcDogTGlua01hcFxuICAvKiog5Y+v6YCJICovXG4gIEBJbnB1dCgpIG1vZGUgPSBXaWRnZXRDb250YWluZXJNb2RlLkFPVFxuICAvKiog5Y+v6YCJ77yMd2lkZ2V0IOeahOmdmeaAgei1hOa6kOWcsOWdgO+8jOS4gOiIrOS4jeeUqOeuoe+8jOeJueauiuaDheWGteWPr+mFjee9ru+8jOm7mOiupOWAvOS4uiB0aGlzLmJhc2ljV2lkZ2V0SW5mby5iYXNlVXJsICsgJy9hc3NldHMvJyAqL1xuICBASW5wdXQoKSBhc3NldHNCYXNlVXJsOiBzdHJpbmdcbiAgLy8gVE9ETzog6Kej6ICmIHBvcnRsZXRcbiAgLyoqIOWPr+mAie+8jOmDqOS7tuS/oeaBr++8jOmcgOimgeazqOWFpeWIsOWFg+mDqOS7tiAqL1xuICBASW5wdXQoKSBwb3J0bGV0OiBFcHBQb3J0bGV0ID0gbmV3IEVwcFBvcnRsZXQobnVsbClcbiAgLyoqIOWPr+mAie+8jOmDqOS7tuWunuS+iyBpZCwg6I635Y+W5pWw5o2u5Y+v6IO955So5YiwICovXG4gIEBJbnB1dCgpIGluc3RhbmNlSWQ6IHN0cmluZ1xuICAvKipcbiAgICog5b+F6YCJ77yMXG4gICAqIOiLpeaMh+Wumu+8jOWImeWFg+mDqOS7tuS4u+WKqOWKoOi9veaVsOaNruaXtuS9v+eUqOWug+iOt+WPluaVsOaNru+8jFxuICAgKiDkuI3lho3liqDovb3nnJ/lrp7mlbDmja7jgILnlKjkuo7nu5nlhYPpg6jku7borr7nva7lgYfmlbDmja5cbiAgICovXG4gIEBJbnB1dCgpIGdldERhdGE6IChnZXREYXRhT3B0czogR2V0RGF0YU9wdGlvbnMpID0+IE9ic2VydmFibGU8RGF0YVdpdGhEaW1zPlxuICBASW5wdXQoKSBzdGF0dXMgPSBXQ1N0YXR1cy5Mb2FkaW5nV2lkZ2V0XG5cbiAgLyoqIHdpZGdldCDliqDovb3lrozmiJDvvIzlj5Hlh7rlvZPliY0gd2lkZ2V0IOeahOS/oeaBryAqL1xuICBAT3V0cHV0KCkgd2lkZ2V0TG9hZGVkID0gbmV3IEV2ZW50RW1pdHRlcigpXG4gIC8qKiB3aWRnZXQgY29tcG9uZW50IGNyZWF0ZSDlrozmiJDvvIzlj5Hlh7rlvZPliY0gd2lkZ2V0IOeahOS/oeaBryAqL1xuICBAT3V0cHV0KCkgd2lkZ2V0SW5pdCA9IG5ldyBFdmVudEVtaXR0ZXIoKVxuICBAT3V0cHV0KCkgcnVudGltZUFnZ0NoYW5nZSA9IG5ldyBFdmVudEVtaXR0ZXIoKVxuICAvLyBUT0RPOiDogIPomZHljrvmjolcbiAgLy8gQE91dHB1dCgpIHRyaWdnZXJMb2FkRGF0YSA9IG5ldyBFdmVudEVtaXR0ZXIoKVxuXG4gIEBWaWV3Q2hpbGQoJ3Jlc2l6ZVRhcmdldCcpIHJlc2l6ZVRhcmdldFxuICBAVmlld0NoaWxkKCd3YycsIHsgcmVhZDogVmlld0NvbnRhaW5lclJlZiB9KSB3aWRnZXRDb250YWluZXI6IFZpZXdDb250YWluZXJSZWZcbiAgQFZpZXdDaGlsZCgndGl0bGVCYXInKSB0aXRsZUJhcjogVGl0bGVCYXJDb21wb25lbnRcblxuICAvLyBwdWJsaWMgaXNMb2FkaW5nID0gdHJ1ZVxuICAvLyBwdWJsaWMgc3RhdHVzID0gV0NTdGF0dXMuTm9ybWFsXG4gIHB1YmxpYyBXQ1N0YXR1cyA9IFdDU3RhdHVzXG4gIHB1YmxpYyBJR0lYX0hPTUVfUEFUSCA9IElHSVhfSE9NRV9QQVRIXG4gIHB1YmxpYyBGSUxURVJfUFJPUF9OQU1FID0gRklMVEVSX1BST1BfTkFNRVxuICBwdWJsaWMgd2lkdGg6IG51bWJlclxuICBwdWJsaWMgaGVpZ2h0OiBudW1iZXJcbiAgcHVibGljIGN1cldpZGdldENvbmZpZzogUmVnaXN0ZXJlZFdpZGdldENvbmZpZ1xuICAvLyBwdWJsaWMgZmVGaWx0ZXJWYWx1ZXM6IEZyb250ZW5kRmlsdGVyW11cbiAgLyoqIOWtmOWcqOatpOWxgueahOaVsOaNruOAguWPr+eUqOS6juWJjeerr+etm+mAieOAgeaVsOaNruiOt+WPlueKtuaAgeWIpOaWrSAqL1xuICBwdWJsaWMgZGF0YTogYW55W10gPSBudWxsXG4gIC8qKiDojrflj5bmlbDmja7lkI7lrZjotbfmnaXnmoTnu7TluqbjgILlj6/nlKjkuo7pobXpnaLorr7orqHml7bjgIHov5DooYzml7bojrflj5bjgIHmmL7npLrnu7TluqYgKi9cbiAgcHVibGljIGRpbXM6IERpbWVuc2lvbltdXG4gIHB1YmxpYyB3aWRnZXRJbnN0YW5jZTogV2lkZ2V0QmFzZVxuICBwdWJsaWMgc2hvd1J1bnRpbWVBZ2cgPSBmYWxzZVxuXG4gIC8vIHByaXZhdGUgd2lkZ2V0Q29tcG9uZW50UmVmOiBDb21wb25lbnRSZWY8YW55PlxuICAvLyBwcml2YXRlIHdpZGdldEluc3RhbmNlSW5mbzogV2lkZ2V0SW5zdGFuY2VJbmZvXG4gIHByaXZhdGUgd2lkZ2V0RGF0YVNlcnZpY2U6IFdpZGdldERhdGFTZXJ2aWNlXG4gIC8qKiDlhazlhbHlpLTkuIrmmK/lkKbmmL7npLrov5DooYzml7bogZrlkIjphY3nva4gKi9cblxuICBjb25zdHJ1Y3RvciAoXG4gICAgcHJpdmF0ZSBsb2FkZXI6IER5bmFtaWNMb2FkZXJTZXJ2aWNlLFxuICAgIHByaXZhdGUgY2Q6IENoYW5nZURldGVjdG9yUmVmLFxuICAgIHByaXZhdGUgaW5qZWN0b3I6IEluamVjdG9yLFxuICAgIHByaXZhdGUgbW9kYWw6IE56TW9kYWxTZXJ2aWNlLFxuICAgIHByaXZhdGUgaHR0cDogSHR0cENsaWVudCxcbiAgICBwcml2YXRlIHRyYW5zbGF0ZTogVHJhbnNsYXRlU2VydmljZSxcbiAgICBwcml2YXRlIHdpZGdldFByb3BlcnR5U2VydmljZTogV2lkZ2V0UHJvcGVydHlTZXJ2aWNlLFxuICAgIHByaXZhdGUgd2lkZ2V0RXZlbnRTZXJ2aWNlOiBXaWRnZXRFdmVudFNlcnZpY2UsXG4gICAgcHJpdmF0ZSBpbnNTZXJpdmNlOiBJbnN0YW5jZVNlcnZpY2UsXG4gICkge1xuICAgIHRoaXMuX2luaXRXaWRnZXRFbnYoKVxuICB9XG4gIC8qKlxuICAgKiDlhajlsYDliJ3lp4vljJZcbiAgICovXG4gIHByaXZhdGUgX2luaXRXaWRnZXRFbnYgKCkge1xuICAgIC8vIGkxOG5cbiAgICBpZiAoIXRoaXMudHJhbnNsYXRlLmRlZmF1bHRMYW5nKSB0aGlzLnRyYW5zbGF0ZS5zZXREZWZhdWx0TGFuZygnemgtQ0hTJyk7XG4gICAgaWYgKCF0aGlzLnRyYW5zbGF0ZS5jdXJyZW50TGFuZykge1xuICAgICAgY29uc3QgbGFuZyA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdsYW5ndWFnZUNvZGUnKSB8fCAnemgtQ0hTJ1xuICAgICAgdGhpcy50cmFuc2xhdGUudXNlKGxhbmcgfHwgJ3poLUNIUycpXG4gICAgfVxuICAgIGlmICghd2luZG93LndpZGdldEkxOG5SZXNMb2FkZWQpIHtcbiAgICAgIGNvbnN0IHsgY3VycmVudExhbmcgfSA9IHRoaXMudHJhbnNsYXRlXG4gICAgICB0aGlzLmh0dHAuZ2V0KGAke0lHSVhfSE9NRV9QQVRIfWFzc2V0cy9pMThuLyR7Y3VycmVudExhbmd9Lmpzb25gKS5zdWJzY3JpYmUocmVzID0+IHtcbiAgICAgICAgdGhpcy50cmFuc2xhdGUuc2V0VHJhbnNsYXRpb24oY3VycmVudExhbmcsIHJlcywgdHJ1ZSlcbiAgICAgIH0pXG4gICAgICB3aW5kb3cud2lkZ2V0STE4blJlc0xvYWRlZCA9IHRydWVcbiAgICB9XG4gIH1cblxuICBuZ09uSW5pdCAoKSB7XG4gICAgdGhpcy5pbnNTZXJpdmNlLmFkZEluc0luZm8odGhpcy5pbnN0YW5jZUlkLCB0aGlzLCAnd2lkZ2V0Q29tcCcpXG4gICAgLy8g55uR5ZCsIHJlc2l6ZVRhcmdldCDnmoTlpKflsI/lj5jljJbvvIzlj5jljJbml7bosIPnlKjlhYPpg6jku7Yub25SZXNpemVkKCnvvIzkvKDlhaUgRG9tUmVjdFJlYWRvbmx5XG4gICAgaWYgKHRoaXMucmVzaXplVGFyZ2V0KSB7XG4gICAgICBuZXcgUmVzaXplT2JzZXJ2ZXIoZW50cmllcyA9PiB7XG4gICAgICAgIGNvbnN0IHsgd2lkdGgsIGhlaWdodCB9ID0gZW50cmllc1swXS5jb250ZW50UmVjdFxuICAgICAgICBpZiAodGhpcy53aWRnZXRJbnN0YW5jZSkgdGhpcy53aWRnZXRJbnN0YW5jZS5vblJlc2l6ZWQod2lkdGgsIGhlaWdodClcbiAgICAgICAgdGhpcy53aWR0aCA9IHdpZHRoXG4gICAgICAgIHRoaXMuaGVpZ2h0ID0gaGVpZ2h0XG4gICAgICAgIHRoaXMuY2QubWFya0ZvckNoZWNrKClcbiAgICAgIH0pLm9ic2VydmUodGhpcy5yZXNpemVUYXJnZXQubmF0aXZlRWxlbWVudClcbiAgICB9XG4gIH1cblxuICBuZ09uQ2hhbmdlcyAoYzogU2ltcGxlQ2hhbmdlcykge1xuICAgIGNvbnN0IHsgYmFzaWNXaWRnZXRJbmZvIH0gPSBjXG4gICAgaWYgKGJhc2ljV2lkZ2V0SW5mbyAmJiBiYXNpY1dpZGdldEluZm8uY3VycmVudFZhbHVlICYmIGJhc2ljV2lkZ2V0SW5mby5jdXJyZW50VmFsdWUgIT09IGJhc2ljV2lkZ2V0SW5mby5wcmV2aW91c1ZhbHVlKSB7XG4gICAgICAvLyB3aWRnZXQg5Y+Y5LqG77yM5riy5p+T5paw5YWD6YOo5Lu2XG4gICAgICB0aGlzLnJlbmRlcldpZGdldCgpXG4gICAgfVxuICB9XG4gIC8qKlxuICAgKiDmraQgY29udGFpbmVyIOiiqyBncmlkc3RlciDmuLLmn5Plh7rmraPnoa7nmoTlpKflsI/kuovku7ZcbiAgICovXG4gIHB1YmxpYyB0cmlnZ2VyV2lkZ2V0UmVzaXplICgpIHtcbiAgICBpZiAodGhpcy53aWRnZXRJbnN0YW5jZSAmJiB0aGlzLndpZGdldEluc3RhbmNlLm9uUmVzaXplZCkge1xuICAgICAgY29uc3QgeyBjbGllbnRXaWR0aCwgY2xpZW50SGVpZ2h0IH0gPSB0aGlzLnJlc2l6ZVRhcmdldC5uYXRpdmVFbGVtZW50XG4gICAgICB0aGlzLndpZGdldEluc3RhbmNlLm9uUmVzaXplZChjbGllbnRXaWR0aCwgY2xpZW50SGVpZ2h0KVxuICAgIH1cbiAgfVxuICAvLyBUT0RPOiDov5nkupvpg73mlLnpgKDmiJDvvIzlj4LmlbDkuLrkuIDkuKrlr7nosaHvvIzph4zpnaLlj6/ku6XkuIDmrKHloZ7lpJrkuKrlsZ7mgKct5YC877yM5YWo6YOo5pu05paw5ZCO5YaN6Kem5Y+RIG9uUHJvcGVydHlDaGFuZ2XvvIxcbiAgLy8g5ZCm5YiZ5YOP5Yid5aeL5YyW5a6M6KaB6LWL5aSa5Liq5YC855qE5oOF5Ya177yM6YCa55+l6Kem5Y+R5aSq6aKR57mB5LqG77yM5Lmf5Lya5a+86Ie06aKR57mB6Kem5Y+R5YWD6YOo5Lu25riy5p+T44CB5pWw5o2u5Yqg6L29XG4gIC8qKlxuICAgKiDlpJbpg6jmm7TmlrDlhYPpg6jku7YgcHJvcFZhbHVlcyDnmoTmn5DlsZ7mgKflkI7vvIzpnIDopoHosIPnlKjmraTmlrnms5XvvIzlkKbliJnmiJHku6zkuI3nn6XpgZMgcHJvcFZhbHVlcyDlj5HnlJ/kuoblj5jljJbjgIJcbiAgICog5LiN5aSq5aW957K+566A5o6J6L+Z5Liq5pa55rOV44CC5bCd6K+V6L+H55SoIGtleVZhbHVlRGlmZmVyIOWcqCBuZ0RvQ2hlY2sg5Lit5qOA5rWLIHByb3BWYWx1ZXMg5Y+Y5YyW77yM5L2G5LuF6IO95qOA5rWL5LiA5bGC44CCXG4gICAqL1xuICBwdWJsaWMgc2V0UHJvcGVydHlWYWx1ZSAocHJvcE5hbWU6IHN0cmluZywgcFZhbHVlKSB7XG4gICAgLy8gVE9ETzogcG9ydGxldCDnu5PmnoTmlLnlj5jlkI7vvIzlj6/ku6XnnIHljrvov5nkuIDmraXvvJpfX2V4dHJhIOW6lOivpeagueacrOS4jeS8muS8oOi/m+adpVxuICAgIGlmIChwcm9wTmFtZSA9PT0gJ19fZXh0cmEnKSByZXR1cm5cbiAgICAvLyDlpoLmnpzkuI3mmK8gb2JqZWN077yM5YiZ5Yik5pat5YC85aaC5p6cIHBWYWx1ZSDkuI7lvZPliY3lhYPpg6jku7blrp7kvovkuK3nm7jlkIzvvIzlsLHkuI3kvKDnu5npg6jku7bkuoZcbiAgICBpZiAodHlwZW9mIHBWYWx1ZSAhPT0gJ29iamVjdCcgJiYgdGhpcy53aWRnZXRJbnN0YW5jZVtwcm9wTmFtZV0gPT09IHBWYWx1ZSkgcmV0dXJuXG4gICAgLy8gVE9ETzog6YOo5Lu26YWN572u5pe277yM6L+Q6KGM5pe25pu05pS56K+t6KiA55qE5aSE55CGXG4gICAgY29uc3QgdmFsdWUgPSB0aGlzLnByb2Nlc3NQVihwVmFsdWUpXG4gICAgLy8g5pS55YC8XG4gICAgdGhpcy53aWRnZXRJbnN0YW5jZVtwcm9wTmFtZV0gPSB2YWx1ZVxuICAgIC8vIOmAmuefpe+8jOWboOS4uuWFg+mDqOS7tuWPr+iDvemcgOimgei/meS4quaXtuaculxuICAgIC8vIOmYsuatouayoeaciei/meS4quaWueazleeahOiAgeWFg+mDqOS7tuaKpemUme+8jOWQjumdoumDveS8muWNh+e6p+aOiVxuICAgIGlmICh0aGlzLndpZGdldEluc3RhbmNlLm9uUHJvcGVydHlDaGFuZ2UpIHtcbiAgICAgIHRoaXMud2lkZ2V0SW5zdGFuY2Uub25Qcm9wZXJ0eUNoYW5nZShwcm9wTmFtZSwgdmFsdWUpXG4gICAgfVxuICAgIGlmIChwcm9wTmFtZSA9PT0gRklMVEVSX1BST1BfTkFNRSkge1xuICAgICAgdGhpcy5kcFZhbHVlcyA9IChwVmFsdWUgYXMgRmlsdGVyQ29uZmlnW10pXG4gICAgICAgIC5maWx0ZXIoZHYgPT4gZHYuZHBJZClcbiAgICAgICAgLm1hcChmYyA9PiAoe1xuICAgICAgICAgIHZhbHVlOiBGaWx0ZXJTY2hlbWEuZ2V0RGVmYXVsdFZhbHVlKGZjLmZzKSxcbiAgICAgICAgICBkcElkOiBmYy5kcElkXG4gICAgICAgIH0pKVxuICAgICAgLy8gVE9ETzpcblxuICAgICAgLy8gaWYgKHBWYWx1ZSAmJiBwVmFsdWUuc2xpY2UpIHRoaXMucHJvcFZhbHVlc1tGSUxURVJfUFJPUF9OQU1FXSA9IHBWYWx1ZS5zbGljZSgpXG4gICAgICAvLyB0aGlzLmNkLm1hcmtGb3JDaGVjaygpXG4gICAgfVxuICAgIGlmICghdGhpcy5wcm9wVmFsdWVzKSB0aGlzLnByb3BWYWx1ZXMgPSB7fVxuICAgIHRoaXMucHJvcFZhbHVlc1twcm9wTmFtZV0gPSBwVmFsdWVcbiAgICB0aGlzLmNkLm1hcmtGb3JDaGVjaygpXG4gIH1cblxuICAvKiDpgJLlvZLmo4Dmn6UgcHbvvIzlgZrnibnmrorlpITnkIbvvIzmr5TlpoLlm73pmYXljJbjgIHluK7liqkgKi9cbiAgcHJpdmF0ZSBwcm9jZXNzUFYgKHZhbHVlKSB7XG4gICAgY29uc3QgeyBjdXJyZW50TGFuZyB9ID0gdGhpcy50cmFuc2xhdGVcbiAgICB0cnkge1xuICAgICAgdmFsdWUgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHZhbHVlKSlcbiAgICB9IGNhdGNoIChlKSB7IH1cbiAgICByZXR1cm4gX3Byb2Nlc3NQVlJlY3Vyc2l2ZWx5KHZhbHVlKVxuXG4gICAgZnVuY3Rpb24gX3Byb2Nlc3NQVlJlY3Vyc2l2ZWx5IChwVmFsdWUpIHtcbiAgICAgIGlmIChBcnJheS5pc0FycmF5KHBWYWx1ZSkpIHtcbiAgICAgICAgcFZhbHVlLmZvckVhY2goKHYsIGkpID0+IHtcbiAgICAgICAgICBwVmFsdWVbaV0gPSBfcHJvY2Vzc1BWUmVjdXJzaXZlbHkodilcbiAgICAgICAgfSlcbiAgICAgICAgcmV0dXJuIHBWYWx1ZVxuICAgICAgICAvLyBpMThuOiDlpoLmnpwgdmFsdWUg5Lit5YyF5ZCrIGVuIOaIliB6aC1DSFMg5oiWIOW9k+WJjeivreiogOeahGtlee+8jOWImeaYryBpMThuIOWtl+autVxuICAgICAgfSBlbHNlIGlmIChwVmFsdWUgJiYgIXBWYWx1ZS5fbm90UHJvY2VzcyAmJiB0eXBlb2YgKHBWYWx1ZS5lbiArIHBWYWx1ZVsnemgtQ0hTJ10gKyBwVmFsdWVbY3VycmVudExhbmddKSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgcmV0dXJuIHBWYWx1ZVtjdXJyZW50TGFuZ11cbiAgICAgICAgLy8gaGVscFxuICAgICAgfSBlbHNlIGlmIChwVmFsdWUgJiYgcFZhbHVlLl9fdHlwZSA9PT0gJ2hlbHAnKSB7XG4gICAgICAgIHJldHVybiBwVmFsdWUudmFsdWVcbiAgICAgIH0gZWxzZSBpZiAocFZhbHVlICYmIFsnT2JqZWN0J10uaW5jbHVkZXMocFZhbHVlLmNvbnN0cnVjdG9yLm5hbWUpKSB7XG4gICAgICAgIE9iamVjdC5rZXlzKHBWYWx1ZSkuZm9yRWFjaChrZXkgPT4ge1xuICAgICAgICAgIHBWYWx1ZVtrZXldID0gX3Byb2Nlc3NQVlJlY3Vyc2l2ZWx5KHBWYWx1ZVtrZXldKVxuICAgICAgICB9KVxuICAgICAgICByZXR1cm4gcFZhbHVlXG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gcFZhbHVlXG4gICAgICB9XG4gICAgfVxuICB9XG4gIHB1YmxpYyBhc3luYyByZW5kZXJXaWRnZXQgKCkge1xuICAgIC8vIOWKoOi9vea4suafk+i/meS4qiB3aWRnZXQg6ZyA6KaB55qE5LiA5YiH5YWD5pWw5o2uXG4gICAgY29uc3QgeyBiYXNlVXJsIH0gPSB0aGlzLmJhc2ljV2lkZ2V0SW5mb1xuICAgIGNvbnN0IGN1cldpZGdldERhdGEgPSBhd2FpdCB0aGlzLmxvYWRlci5sb2FkV2lkZ2V0KHRoaXMuYmFzaWNXaWRnZXRJbmZvLCB0aGlzLnByb3BWYWx1ZXMsIHRoaXMubW9kZSlcbiAgICAvLyBUT0RPOiBwcm9wVmFsdWVzIOaYr+S4jeaYr+S4jeeUqOe7j+i/hyBsb2FkZXLvvIznm7TmjqXosIMgd2lkZ2V0UHJvcFNlcnZpY2Ug6I635Y+W5bCx6KGM77yfXG4gICAgY29uc3QgeyB3aWRnZXRDb21wRmFjdG9yeSwgd2lkZ2V0TW9kdWxlRmFjdG9yeSwgcHJvcFZhbHVlcywgd2lkZ2V0Q29uZmlnIH0gPSBjdXJXaWRnZXREYXRhXG4gICAgdGhpcy5jdXJXaWRnZXRDb25maWcgPSB3aWRnZXRDb25maWdcbiAgICB0aGlzLmluaXRSdW50aW1lQWdnKClcbiAgICBpZiAodGhpcy5jdXJXaWRnZXRDb25maWcuZW5hYmxlTG9hZGluZ0kxOG4pIHRoaXMubG9hZEkxOG5SZXMoKVxuICAgIC8vIOWFg+mDqOS7tuWKoOi9veWujOaIkOS6i+S7tlxuICAgIHRoaXMud2lkZ2V0TG9hZGVkLmVtaXQoY3VyV2lkZ2V0RGF0YSlcbiAgICAvLyDliKDogIHlhYPpg6jku7ZcbiAgICB0aGlzLndpZGdldENvbnRhaW5lci5yZW1vdmUoKVxuICAgIC8vIOWIm+W7uuazqOWFpeWZqFxuICAgIGNvbnN0IGluamVjdG9yID0gSW5qZWN0b3IuY3JlYXRlKHtcbiAgICAgIHByb3ZpZGVyczogW3tcbiAgICAgICAgcHJvdmlkZTogV2lkZ2V0SW5zdGFuY2VJbmZvLCAvKiog5YWD6YOo5Lu25a6e5L6L5L+h5oGvICovXG4gICAgICAgIHVzZVZhbHVlOiBuZXcgV2lkZ2V0SW5zdGFuY2VJbmZvKFxuICAgICAgICAgIHRoaXMucG9ydGxldC5pZCxcbiAgICAgICAgICB0aGlzLmluc3RhbmNlSWQsXG4gICAgICAgICAgdGhpcy5hc3NldHNCYXNlVXJsIHx8IHRoaXMuYmFzaWNXaWRnZXRJbmZvLmJhc2VVcmwgKyAnL2Fzc2V0cy8nLFxuICAgICAgICApXG4gICAgICB9LCB7XG4gICAgICAgIHByb3ZpZGU6IFdpZGdldERhdGFTZXJ2aWNlLCAvKiog5YWD6YOo5Lu25pWw5o2u5pyN5YqhICovXG4gICAgICAgIHVzZUZhY3Rvcnk6ICgpID0+IHtcbiAgICAgICAgICB0aGlzLndpZGdldERhdGFTZXJ2aWNlID0gbmV3IFdpZGdldERhdGFTZXJ2aWNlKClcbiAgICAgICAgICB0aGlzLndpZGdldERhdGFTZXJ2aWNlLm9uTG9hZERhdGFcbiAgICAgICAgICAgIC5waXBlKGRlbGF5KDApKSAvLyDkuLrpgb/lhY3nlKggb2YoZGF0YSkg5Lya5ZCM5q2l6L+U5Zue5pWw5o2u77yM5a+86Ie0IGRhdGEgc2VydmljZSDkuK3nmoQgb25HZXREYXRhIOi/mOayoei/lOWbnuWIsOWFg+mDqOS7tuaJi+mHjOWwseinpuWPkeWujOS6hlxuICAgICAgICAgICAgLnN1YnNjcmliZSh0aGlzLmxvYWROU2V0RGF0YS5iaW5kKHRoaXMpKVxuICAgICAgICAgIHJldHVybiB0aGlzLndpZGdldERhdGFTZXJ2aWNlXG4gICAgICAgIH0sXG4gICAgICAgIGRlcHM6IFtdXG4gICAgICB9XSxcbiAgICAgIHBhcmVudDogdGhpcy5pbmplY3RvclxuICAgIH0pXG4gICAgLy8g5Yib5bu644CB5oyC6L29IHdpZGdldCDnu4Tku7ZcbiAgICB0aGlzLndpZGdldEluc3RhbmNlID0gdGhpcy53aWRnZXRDb250YWluZXIuY3JlYXRlQ29tcG9uZW50KFxuICAgICAgd2lkZ2V0Q29tcEZhY3RvcnksIDAsIGluamVjdG9yLCB1bmRlZmluZWQsXG4gICAgICB3aWRnZXRNb2R1bGVGYWN0b3J5ICYmIHdpZGdldE1vZHVsZUZhY3RvcnkuY3JlYXRlKHRoaXMuaW5qZWN0b3IpXG4gICAgKS5pbnN0YW5jZSBhcyBXaWRnZXRCYXNlXG5cbiAgICAvLyDorr7nva4gd2lkZ2V0IOeahCBwcm9wZXJ0aWVzIOeahCB2YWx1ZXNcbiAgICAvLyBUT0RPOiDmlLnkuLrkuIDmrKHphY3lpJrkuKpcbiAgICBPYmplY3Qua2V5cyhwcm9wVmFsdWVzKS5mb3JFYWNoKHByb3AgPT4ge1xuICAgICAgdGhpcy5zZXRQcm9wZXJ0eVZhbHVlKHByb3AsIHByb3BWYWx1ZXNbcHJvcF0pXG4gICAgfSlcblxuICAgIC8vIFRPRE86IOW3suW6n+W8g+aWueahiCwg5Lul5LiL5Li66L+H5rih5pa55qGI5Lul5YW85a656ICB5YaZ5rOV5YWD6YOo5Lu2LCDlkI7mnJ/lsIbnp7vpmaRcbiAgICB0aGlzLndpZGdldEluc3RhbmNlLmlkID0gdGhpcy5pbnN0YW5jZUlkXG4gICAgdGhpcy53aWRnZXRJbnN0YW5jZS5wb3J0bGV0SWQgPSB0aGlzLnBvcnRsZXQuaWRcbiAgICB0aGlzLndpZGdldEluc3RhbmNlLmFzc2V0c0Jhc2VVcmwgPSB0aGlzLmFzc2V0c0Jhc2VVcmwgfHwgYmFzZVVybCArICcvYXNzZXRzLydcbiAgICBpZiAodGhpcy53aWRnZXRJbnN0YW5jZS51c2VEYXRhRW5naW5lKSB0aGlzLmxvYWROU2V0RGF0YSh7fSlcblxuICAgIC8vIFRPRE86IOWug+WujOaIkOS5i+WQjuaJjeeul+S9nCB3aWRnZXQg5Yid5aeL5YyW5a6M5oiQ77yM5Y+v5Lul5pi+56S65Ye65p2l44CC5ZCm5YiZ5Lya5pi+56S6IGNvZGXjgIJcbiAgICAvLyB0aGlzLnNldFdpZGdldFRyYW5zbGF0aW9uKClcbiAgICAvLyBldmVudFxuICAgIHRoaXMuaW5pdFdpZGdldEV2ZW50TGlzdGVuZXIoKVxuICAgIC8vIOWFg+mDqOS7tuWIneWni+WMluWujOaIkOS6i+S7tlxuICAgIHRoaXMud2lkZ2V0SW5pdC5lbWl0KGN1cldpZGdldERhdGEpXG4gICAgLy8gdGhpcy5pc0xvYWRpbmcgPSBmYWxzZVxuICAgIHRoaXMuc3RhdHVzID0gV0NTdGF0dXMuTm9ybWFsXG4gICAgdGhpcy5jZC5tYXJrRm9yQ2hlY2soKVxuICB9XG5cbiAgcHJpdmF0ZSBsb2FkSTE4blJlcyAoKSB7XG4gICAgY29uc3QgeyBjdXJyZW50TGFuZyB9ID0gdGhpcy50cmFuc2xhdGVcbiAgICBjb25zdCB7IG5hbWUsIGJhc2VVcmwgfSA9IHRoaXMuYmFzaWNXaWRnZXRJbmZvXG4gICAgY29uc3QgeyBjdXN0b21JMThuUmVzb3VyY2VVcmwgfSA9IHRoaXMuY3VyV2lkZ2V0Q29uZmlnXG4gICAgY29uc3QgaTE4blJlc1VybCA9IGN1c3RvbUkxOG5SZXNvdXJjZVVybCB8fCBgJHtiYXNlVXJsfS9hc3NldHMvaTE4bi8ke2N1cnJlbnRMYW5nfS5qc29uYFxuXG4gICAgLy8g57yT5a2Y5pu+5Yqg6L296L+H55qE6LWE5rqQ5paH5Lu25ZCN77yM5LiL5qyh55u45ZCM5paH5Lu25LiN5YaN6K+35rGC44CC57yT5a2Y6LWE5rqQ5paH5Lu25ZCN77yM5piv5Zug5Li65Y+v6IO95aSa5Liq5YWD6YOo5Lu25oyH5a6a55u45ZCM55qE6LWE5rqQ5paH5Lu244CCXG4gICAgaWYgKGxvYWRlZEkxOG5VcmxzLmluY2x1ZGVzKGkxOG5SZXNVcmwpKSByZXR1cm5cbiAgICBsb2FkZWRJMThuVXJscy5wdXNoKGkxOG5SZXNVcmwpXG5cbiAgICByZXR1cm4gdGhpcy5odHRwLmdldChpMThuUmVzVXJsKS50b1Byb21pc2UoKS50aGVuKHJlcyA9PiB7XG4gICAgICB0aGlzLnRyYW5zbGF0ZS5zZXRUcmFuc2xhdGlvbihjdXJyZW50TGFuZywgcmVzLCB0cnVlKVxuICAgIH0sICgpID0+IHtcbiAgICAgIGNvbnNvbGUubG9nKGDlhYPpg6jku7YgJHtuYW1lfSDml6AgJHtjdXJyZW50TGFuZ30g55qE6LWE5rqQ5paH5Lu2YClcbiAgICB9KS5maW5hbGx5KCgpID0+IHtcbiAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKVxuICAgIH0pXG4gIH1cbiAgLyoqXG4gICAqIHB2IOS4reWMheWQqyB7ZnMsZHB9W13vvIjnrZvpgInmjqfku7Yr5Y+W5pWw5Y+C5pWwPeetm+mAie+8iVxuICAgKiDpg6jku7blrp7kvovkuK3kv53lrZgge2ZzLGRwfTogZmlsdGVyVmFsdWVcbiAgICovXG4gIGRwVmFsdWVzOiBEcFZhbHVlW10gPSBbXVxuICAvKipcbiAgICog5aGe5pWw5o2u5YWl5Y+jIDEvMjog5Yqg6L295pWw5o2u5bm25aGe57uZ6YOo5Lu2XG4gICAqL1xuICAvLyBUT0RPOiBsb2FkTlNldERhdGEg5Y+v6IO95piv5LiN5bim5Y+C5pWw55qE44CC5Y+W5pWw5Y+C5pWw5Y+v6IO95a2Y5Zyo5b2T5YmNIHdpZGdldCDlrp7kvovph4zvvIznm7TmjqXlj5bjgIJcbiAgLy8gbG9hZE5TZXREYXRhIOacieayoeacieWPr+iDveW4puedgOadpeiHqumDqOS7tueahOmineWkluWPguaVsO+8n1xuICBwdWJsaWMgbG9hZE5TZXREYXRhIChwYXJhbToge1xuICAgIGRwVmFsdWVzPzogRHBWYWx1ZVtdLFxuICB9ID0ge30pIHtcbiAgICBjb25zdCBvYiA9IHRoaXMuZ2V0RGF0YSh7XG4gICAgICBkcFZhbHVlczogbWVyZ2VEcFZhbHVlc0Zvck5ldyh0aGlzLmRwVmFsdWVzLCBwYXJhbS5kcFZhbHVlcyksXG4gICAgICBydW50aW1lQWdnOiB0aGlzLnJ1bnRpbWVBZ2dcbiAgICB9KVxuICAgIGlmICghb2IpIHJldHVyblxuICAgIG9iLnN1YnNjcmliZShkYXRhV2l0aERpbXMgPT4ge1xuICAgICAgdGhpcy5zZXREYXRhKGRhdGFXaXRoRGltcylcbiAgICB9LCB0aGlzLmhhbmRsZURhdGFFcnJvci5iaW5kKHRoaXMpKVxuICB9XG4gIC8qKlxuICAgKiDnu5nlhYPpg6jku7bph43mlrDorr7nva7mlbDmja7nu5PmnpzvvIzlpJbpg6jlj6/osIPnlKjmraTmlrnms5Xnu5npg6jku7borr7nva7mlbDmja7jgIJcbiAgICovXG4gIHB1YmxpYyBzZXREYXRhIChwRGF0YVdpdGhEaW1zOiBEYXRhV2l0aERpbXMpIHtcbiAgICBsZXQgZGF0YVdpdGhEaW1zID0gcERhdGFXaXRoRGltc1xuICAgIC8vIHNldCBpZiBlbXB0eSBzdGF0dXNcbiAgICBpZiAoIXBEYXRhV2l0aERpbXMgfHwgIXBEYXRhV2l0aERpbXMudGFibGVEYXRhIHx8IHBEYXRhV2l0aERpbXMudGFibGVEYXRhLmxlbmd0aCA9PT0gMCkgdGhpcy5zdGF0dXMgPSBXQ1N0YXR1cy5EYXRhRW1wdHlcbiAgICAvLyDlpoLmnpzlpJbpnaLmsqHmnInnu5kgRGF0YVdpdGhEaW1zIOiAjOaYr+eugOWNleaVsOaNruWIl+ihqO+8jOWwseeugOWNlei9rOS4gOaKiuOAguS7peWFvOWuuSBjb25maWcg6YeM55qE5YGH5pWw5o2u562J44CCXG4gICAgaWYgKCFwRGF0YVdpdGhEaW1zLmRpbWVuc2lvbnMgJiYgcERhdGFXaXRoRGltc1snbGVuZ3RoJ10pIHtcbiAgICAgIGRhdGFXaXRoRGltcyA9IHtcbiAgICAgICAgZGltZW5zaW9uczogT2JqZWN0XG4gICAgICAgICAgLmtleXMocERhdGFXaXRoRGltc1swXSlcbiAgICAgICAgICAubWFwKGtleSA9PiAoeyBuYW1lOiBrZXksIGxhYmVsOiBrZXkgfSkpLFxuICAgICAgICB0YWJsZURhdGE6IChwRGF0YVdpdGhEaW1zIGFzIHVua25vd24gYXMgYW55W10pXG4gICAgICB9XG4gICAgfVxuICAgIHRoaXMuc3RhdHVzID0gV0NTdGF0dXMuTm9ybWFsXG4gICAgdGhpcy5kYXRhID0gZGF0YVdpdGhEaW1zLnRhYmxlRGF0YVxuICAgIHRoaXMuZGltcyA9IGRhdGFXaXRoRGltcy5kaW1lbnNpb25zXG5cbiAgICBpZiAodGhpcy53aWRnZXREYXRhU2VydmljZSkgdGhpcy53aWRnZXREYXRhU2VydmljZS5zZXREYXRhKGRhdGFXaXRoRGltcylcbiAgICBpZiAodGhpcy53aWRnZXRJbnN0YW5jZSAmJiB0aGlzLndpZGdldEluc3RhbmNlLnVzZURhdGFFbmdpbmUpIHRoaXMud2lkZ2V0SW5zdGFuY2Uub25HZXREYXRhKGRhdGFXaXRoRGltcy50YWJsZURhdGEpIC8vIOWFvOWuueeUqOmAlFxuXG4gICAgLy8g57uZ5YWD6YOo5Lu26K6+572u5a6M5pWw5o2u77yM6Iul5pyJ6L+Q6KGM5pe26IGa5ZCI77yM6L+Y6ZyA6KaB6YeN5paw57uR5a6a5a2X5q61XG4gICAgdGhpcy5zZXRSdW50aW1lQWdnRGltcygpXG4gICAgdGhpcy5jZC5tYXJrRm9yQ2hlY2soKVxuICB9XG5cbiAgaGFuZGxlRGF0YUVycm9yID0gKCkgPT4ge1xuICAgIC8vIOaVsOaNruWKoOi9veWksei0pVxuICAgIHRoaXMuc3RhdHVzID0gV0NTdGF0dXMuRGF0YUVycm9yXG4gICAgdGhpcy5jZC5tYXJrRm9yQ2hlY2soKVxuICB9XG4gIGhhbmRsZUNsaWNrU3RhdHVzTW9yZSAoKSB7XG4gICAgdGhpcy5tb2RhbC5lcnJvcih7XG4gICAgICBuelRpdGxlOiAn5bCP6YOo5Lu26ZSZ6K+vJyxcbiAgICAgIG56Q29udGVudDogJ+atpOWwj+mDqOS7tueahOaVsOaNrumFjee9ruaXoOaViO+8jOmcgOimgeeuoeeQhuWRmOmHjeaWsOmFjee9ruaIluWIoOmZpOOAgidcbiAgICB9KVxuICB9XG4gIGZpbHRlclZhbHVlczogYW55W11cbiAgaGFuZGxlRmlsdGVyQ2hhbmdlIChkcFZhbHVlczogRHBWYWx1ZVtdKSB7XG4gICAgbWVyZ2VEcFZhbHVlcyh0aGlzLmRwVmFsdWVzLCBkcFZhbHVlcylcbiAgICB0aGlzLmxvYWROU2V0RGF0YSgpXG4gIH1cbiAgLy8gQElucHV0KCkgaW5pdFJ1bnRpbWVBZ2c6IFJ1bnRpbWVBZ2dPcHRpb25cbiAgLyoqXG4gICAqIOatpCBydW50aW1lQWdnIOWtmOWCqOW9k+WJjei/kOihjOaXtueUqOaIt+mAieeahOOAgeacgOaWsOeahCBydW50aW1lQWdn44CCXG4gICAqIGV4dHJhIOS4reeahOaYr+WtmOWCqOWcqOmDqOS7tuS4reeahOOAglxuICAgKiB3aWRnZXQg5LiN6LSf6LSj5oqKIHJ1bnRpbWVBZ2cg5pS+5YiwIGV4dHJhIOmHjO+8jOWboOS4uui/memHjOS4jeehruWumuaYr+WQpumcgOimgeaMgeS5heWMluOAglxuICAgKi9cbiAgcnVudGltZUFnZzogUnVudGltZUFnZ09wdGlvblxuICBoYW5kbGVSdW50aW1lQWdnQ2hhbmdlIChydW50aW1lQWdnOiBSdW50aW1lQWdnT3B0aW9uKSB7XG4gICAgLy8gaWYgKG9iamVjdExpdGVyYWxFcXVhbChydW50aW1lQWdnLCB0aGlzLnJ1bnRpbWVBZ2cpKSByZXR1cm5cbiAgICB0aGlzLnJ1bnRpbWVBZ2cgPSBydW50aW1lQWdnXG4gICAgLy8g5LiL6Z2i5Lik6KGM6aG65bqP5Lil5qC877yM5Zug5Li65aSW6YOo5Yqg6L295pWw5o2u5pe25Y+v6IO96KaB5L6d6LWW5b2T5YmN5pyA5paw55qEIHJ1bnRpbWVBZ2dcbiAgICB0aGlzLnJ1bnRpbWVBZ2dDaGFuZ2UuZW1pdChydW50aW1lQWdnKVxuICAgIHRoaXMubG9hZE5TZXREYXRhKClcbiAgfVxuICAvKiog5b2T5YmN5YaZ5rOV6ZyA6KaB5L+d6K+BIHJlbmRlcldpZGdldCgpIOW3suWujOaIkCAqL1xuICBoYW5kbGVUaXRsZUJhckluaXQgKHRpdGxlQmFyOiBUaXRsZUJhckNvbXBvbmVudCkge1xuICAgIGlmICh0aGlzLnNob3dSdW50aW1lQWdnKSB7XG4gICAgICB0aXRsZUJhci5zZXRSdW50aW1lQWdnKHRoaXMucnVudGltZUFnZylcbiAgICB9XG4gIH1cbiAgaW5pdFJ1bnRpbWVBZ2cgKCkge1xuICAgIC8vIHJ1bnRpbWUgYWdnXG4gICAgdGhpcy5zaG93UnVudGltZUFnZyA9IGlzV2lkZ2V0UnVudGltZUFnZ0FjdGl2ZSh0aGlzLmJhc2ljV2lkZ2V0SW5mby5uYW1lKVxuICAgIGlmICh0aGlzLnNob3dSdW50aW1lQWdnKSB7XG4gICAgICB0aGlzLnJ1bnRpbWVBZ2cgPSB0aGlzLnByb3BWYWx1ZXMuX19leHRyYSA/IHRoaXMucHJvcFZhbHVlcy5fX2V4dHJhLnJ1bnRpbWVBZ2cgOiBudWxsXG4gICAgfVxuICB9XG4gIC8vIFRPRE86IOS7peWQjuaKiiBzdSDmlL4gYmFzaWMuLi4g6YeMXG4gIC8qKlxuICAgKiDliJ3lp4vljJbpg6jku7bkuovku7bnm5HlkKxcbiAgICovXG4gIHByaXZhdGUgaW5pdFdpZGdldEV2ZW50TGlzdGVuZXIgKCkge1xuICAgIGlmICghdGhpcy5saW5rTWFwKSByZXR1cm5cbiAgICBpZiAodGhpcy5hbUlGaWx0ZXJXaWRnZXQoKSkge1xuICAgICAgdGhpcy5pbml0T25lRXZlbnRMaXN0ZW5lcihGSUxURVJTX1dJREdFVF9QUk9QX05BTUUpXG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMud2lkZ2V0RXZlbnRTZXJ2aWNlXG4gICAgICAgIC5nZXRFdmVudHNCeVdpZGdldE5hbWUodGhpcy5iYXNpY1dpZGdldEluZm8ubmFtZSwgdGhpcy5wcm9wVmFsdWVzKVxuICAgICAgICAuZm9yRWFjaChldmVudENvbmZpZyA9PiB7XG4gICAgICAgICAgICB0aGlzLmluaXRPbmVFdmVudExpc3RlbmVyKGV2ZW50Q29uZmlnLnByb3BOYW1lKVxuICAgICAgICB9KVxuICAgICAgfVxuICB9XG4gIC8qKlxuICAgKiBldmVudFByb3BOYW1lIOaYr+S6i+S7tuWvueW6lOeahOWunumZheWxnuaAp+WQje+8jFxuICAgKiBldmVudEtleSDphY3nva7lnKggbGluayDph4znmoTkuovku7blkI3jgIJcbiAgICog5LiA6Iis5LuW5L+p5piv5LiA5qC355qE77yM5ZCO6ICF5Y+v5Lul5LiN5Lyg44CCXG4gICAqIOiLpeaYr+etm+mAiemDqOS7tu+8jOWImeS4pOiAheS4jeWQjO+8jOS4gOS4quaYryAnZmlsdGVyJ++8jOS4gOS4quaYr+WunumZheeahOS6i+S7tu+8iOetm+mAie+8ieWQjeensOOAglxuICAgKi9cbiAgcHJpdmF0ZSBpbml0T25lRXZlbnRMaXN0ZW5lciAoZXZlbnRQcm9wTmFtZTogc3RyaW5nKSB7XG4gICAgY29uc3QgZXZlbnRFbWl0dGVyID0gdGhpcy53aWRnZXRJbnN0YW5jZVtldmVudFByb3BOYW1lXVxuICAgIGlmIChldmVudEVtaXR0ZXIpIGV2ZW50RW1pdHRlci5zdWJzY3JpYmUod2lkZ2V0RXZlbnRQYXJhbSA9PiB7XG4gICAgICBjb25zb2xlLmxvZygn6IGU5Yqo5LqL5Lu26Kem5Y+R77yM5Y+C5pWw77yaJyArIHdpZGdldEV2ZW50UGFyYW0pXG4gICAgICBjb25zdCBsaW5rRXZlbnRLZXkgPSB0aGlzLmFtSUZpbHRlcldpZGdldCgpXG4gICAgICA/ICh3aWRnZXRFdmVudFBhcmFtIGFzIEZpbHRlcldpZGdldEV2ZW50UGFyYW0pLmV2ZW50S2V5XG4gICAgICA6IGV2ZW50UHJvcE5hbWVcbiAgICAgIC8vIOagueaNriBsaW5rIG1hcCDosIPnlKjlhbbku5YgaW5zIOagueaNriDph43mlrDliqDovb3mlbDmja5cbiAgICAgIGNvbnN0IHBJbnNMaW5rID0gdGhpcy5saW5rTWFwW2xpbmtFdmVudEtleV1cbiAgICAgIE9iamVjdC5rZXlzKHBJbnNMaW5rKS5mb3JFYWNoKHBJbnNJZCA9PiB7XG4gICAgICAgIGlmICghcEluc0xpbmtbcEluc0lkXSB8fCAhcEluc0xpbmtbcEluc0lkXS5hY3RpdmUgfHwgIXBJbnNMaW5rW3BJbnNJZF0uZHBJZCkgcmV0dXJuXG4gICAgICAgIGNvbnN0IHRhcmdldFdJbnMgPSB0aGlzLmluc1Nlcml2Y2UuZ2V0SW5zQnlQSW5zSWQocEluc0lkKS53aWRnZXRDb21wXG4gICAgICAgIGlmICh0YXJnZXRXSW5zKSB0YXJnZXRXSW5zLmxvYWROU2V0RGF0YSh7XG4gICAgICAgICAgZHBWYWx1ZXM6IFt7XG4gICAgICAgICAgICBkcElkOiBwSW5zTGlua1twSW5zSWRdLmRwSWQsXG4gICAgICAgICAgICAvLyBUT0RPOiDogZTliqjlj4LmlbDlgLznmoTlpITnkIbliqDlnKjov5lcbiAgICAgICAgICAgIHZhbHVlOiBTdHJpbmcod2lkZ2V0RXZlbnRQYXJhbVsnZGF0YUluZGV4J10pLFxuICAgICAgICAgIH1dXG4gICAgICAgIH0pXG4gICAgICB9KVxuICAgIH0pXG4gIH1cbiAgc2V0UnVudGltZUFnZ0RpbXMgKCkge1xuICAgIGlmICghdGhpcy5ydW50aW1lQWdnKSByZXR1cm5cbiAgICBjaGFydEFnZ0ZpZWxkTWFwW3RoaXMuYmFzaWNXaWRnZXRJbmZvLm5hbWVdLmZvckVhY2goYWdnRmllbGQgPT4ge1xuICAgICAgdGhpcy5zZXRQcm9wZXJ0eVZhbHVlKGFnZ0ZpZWxkLm5hbWUsIGFnZ0ZpZWxkLnZhbHVlRmFjdG9yeSh0aGlzLnJ1bnRpbWVBZ2csIHRoaXMuZGltcykpXG4gICAgfSlcbiAgfVxuICBhbUlGaWx0ZXJXaWRnZXQgKCkge1xuICAgIHJldHVybiB0aGlzLmJhc2ljV2lkZ2V0SW5mby5uYW1lID09PSBGSUxURVJTX1dJREdFVF9OQU1FXG4gICAgICAmJiB0aGlzLmJhc2ljV2lkZ2V0SW5mby5iYXNlVXJsLmluY2x1ZGVzKCcvZXBwLycpXG4gIH1cbn1cblxuLyoqXG4gKiBuZXdEcFZhbHVlcyDlkIjlubbliLAgdGhpcy5kcFZhbHVlc++8jOWQjCBkcElkIOimhuebluOAglxuICog5q2k5pa55rOV5Lya5pS55Y+YIG9sZERwVmFsdWVz44CCXG4gKi9cbmZ1bmN0aW9uIG1lcmdlRHBWYWx1ZXMgKG9sZERwVmFsdWVzOiBEcFZhbHVlW10sIG5ld0RwVmFsdWVzOiBEcFZhbHVlW10pIHtcbiAgZm9yIChjb25zdCBuZXdEViBvZiBuZXdEcFZhbHVlcy5maWx0ZXIoZHYgPT4gZHYuZHBJZCkpIHtcbiAgICBjb25zdCB0YXJnZXRPbGREViA9IG9sZERwVmFsdWVzLmZpbmQob2xkRFYgPT4gb2xkRFYuZHBJZCA9PT0gbmV3RFYuZHBJZClcbiAgICBpZiAodGFyZ2V0T2xkRFYpIHtcbiAgICAgIHRhcmdldE9sZERWLnZhbHVlID0gbmV3RFYudmFsdWVcbiAgICB9IGVsc2Uge1xuICAgICAgb2xkRHBWYWx1ZXMucHVzaChuZXdEVilcbiAgICB9XG4gIH1cbn1cbmZ1bmN0aW9uIG1lcmdlRHBWYWx1ZXNGb3JOZXcgKG9sZERwVmFsdWVzOiBEcFZhbHVlW10gPSBbXSwgbmV3RHBWYWx1ZXM6IERwVmFsdWVbXSA9IFtdKSB7XG4gIGNvbnN0IHJlc3VsdCA9IG9sZERwVmFsdWVzLnNsaWNlKClcbiAgbWVyZ2VEcFZhbHVlcyhyZXN1bHQsIG5ld0RwVmFsdWVzKVxuICByZXR1cm4gcmVzdWx0XG59XG4iXX0=
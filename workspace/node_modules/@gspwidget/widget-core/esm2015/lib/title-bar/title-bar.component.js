/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { ChangeDetectionStrategy, Component, ContentChild, EventEmitter, Input, Output, TemplateRef } from '@angular/core';
import { ArrUtil, deepClone, Indicator, objectLiteralEqual, RuntimeAggOption } from '@gspwidget/util';
import { ifFsDateRange, isFsFlat, JumpTypes, WidgetDevkitService } from '@gspwidget/widget-devkit';
import { TranslateService } from '@ngx-translate/core';
export class TitleBarComponent {
    /**
     * @param {?} devkitSvc
     * @param {?} translate
     */
    constructor(devkitSvc, translate) {
        this.devkitSvc = devkitSvc;
        this.translate = translate;
        this.icon = '';
        /**
         * 标题
         */
        this.showTitle = true;
        this.title = '';
        /**
         * 数字
         */
        this.showNumber = false;
        this.number = 0;
        /**
         * 设置按钮
         */
        this.showSetting = false;
        this.clickSetting = new EventEmitter();
        /**
         * 刷新按钮
         */
        this.showRefresh = false;
        this.clickRefresh = new EventEmitter();
        /**
         * 维度，用于运行时聚合
         */
        this.dims = [];
        /**
         * 是否显示运行时聚合
         */
        this.showRuntimeAgg = false;
        this.filterChange = new EventEmitter();
        this.runtimeAggChange = new EventEmitter();
        this.init = new EventEmitter();
        this.JumpTypes = JumpTypes;
        /**
         * 聚合
         */
        this.editingRuntimeAgg = new RuntimeAggOption();
        this.runtimeAggDropdownOpen = false;
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.init.emit(this);
    }
    /**
     * @param {?} changes
     * @return {?}
     */
    ngOnChanges(changes) {
        if (changes.filterConfigs) {
            this.outerFC = null;
            this.innerFCs = null;
            /** @type {?} */
            const notFlatFCs = this.filterConfigs.filter((/**
             * @param {?} fc
             * @return {?}
             */
            fc => !isFsFlat(fc.fs)));
            if (notFlatFCs && notFlatFCs[0])
                this.outerFC = notFlatFCs[0];
            if (notFlatFCs && notFlatFCs.length > 1)
                this.innerFCs = notFlatFCs.slice(1);
            this.flatFCs = this.filterConfigs.filter((/**
             * @param {?} fc
             * @return {?}
             */
            fc => isFsFlat(fc.fs)));
        }
    }
    /**
     * 用于外部手动设置 runtime agg。因为每次都需要 deep clone，所以封装为手动调用的函数，而非模板绑定，以减少次数。
     * @param {?} runtimeAgg
     * @return {?}
     */
    setRuntimeAgg(runtimeAgg) {
        if (!runtimeAgg)
            return;
        this.editingRuntimeAgg = deepClone(runtimeAgg);
        this.confirmedRuntimeAgg = deepClone(runtimeAgg);
    }
    /**
     * @return {?}
     */
    handleClickJump() {
        this.devkitSvc.jumpWithoutData(this.jumpConfig);
    }
    /**
     * 把 filter 发来的结果值，加上 dpId 一起包装为 dpValues 发出去
     * @param {?} value
     * @param {?} fc
     * @return {?}
     */
    handleFilterSingleChange(value, fc) {
        // 1. 普通：发出对应 1 个 dp 的单个值
        this.filterChange.emit([{
                value,
                dpId: fc.dpId,
            }]);
    }
    /**
     * @param {?} values
     * @param {?} fc
     * @return {?}
     */
    handleFilterMultiChange(values, fc) {
        /** @type {?} */
        let dpValues
        // 2. 日期范围：发出对应 2 个 dp 的 2 个值
        ;
        // 2. 日期范围：发出对应 2 个 dp 的 2 个值
        if (ifFsDateRange(fc.fs)) {
            dpValues = [
                { value: values[0], dpId: fc.dpId },
                { value: values[1], dpId: fc.dpId2 },
            ];
        }
        else {
            // 3. 枚举多选：发出对应 1 个 dp 的多个值
            dpValues = [{
                    // TODO: 多值的连接方式是否可配？
                    value: values.join(','), dpId: fc.dpId
                }];
        }
        this.filterChange.emit(dpValues);
    }
    /**
     * 聚合
     * @return {?}
     */
    handleAddInd() {
        this.editingRuntimeAgg.indicators.push(new Indicator());
    }
    /**
     * @param {?} ind
     * @return {?}
     */
    handleRemoveInd(ind) {
        ArrUtil.Remove(this.editingRuntimeAgg.indicators, ind);
    }
    /**
     * @return {?}
     */
    handleConfirmAgg() {
        this.runtimeAggDropdownOpen = false;
        if (objectLiteralEqual(this.editingRuntimeAgg, this.confirmedRuntimeAgg))
            return;
        this.confirmedRuntimeAgg = deepClone(this.editingRuntimeAgg);
        this.runtimeAggChange.emit(this.confirmedRuntimeAgg);
    }
}
TitleBarComponent.decorators = [
    { type: Component, args: [{
                selector: 'lib-title-bar',
                template: "<!-- --{{filterSchemas | json}}-- -->\n<!-- TODO: \u6240\u6709\u5176\u4ED6 filter \u6536\u8D77\u5230 dropdown \u91CC -->\n<!-- <div class=\"d-flex\">\n  <filter\n    *ngFor=\"let fc of filterConfigs\"\n    [filterSchema]=\"fc.fs\"\n    (singleValueChange)=\"handleFilterSingleChange($event, fc)\"\n    (multiValueChange)=\"handleFilterMultiChange($event, fc)\"\n    ></filter>\n</div> -->\n<div class=\"title-bar\">\n  <div class=\"d-flex\">\n    <!-- left -->\n    <div class=\"left align-items-center\">\n      <i *ngIf=\"icon!=''\" class=\"material-icons\">{{icon}}</i>\n      <div *ngIf=\"showTitle\" class=\"title\">{{title}}</div>\n      <div *ngIf=\"showNumber\" class=\"number\">{{number}}</div>\n      <ng-container *ngTemplateOutlet=\"leftTemplate\"></ng-container>\n    </div>\n    <!-- right -->\n    <div class=\"right\">\n      <ng-container *ngTemplateOutlet=\"rightTemplate\"></ng-container>\n      <filter\n        *ngIf=\"outerFC\"\n        [filterSchema]=\"outerFC.fs\"\n        (singleValueChange)=\"handleFilterSingleChange($event, outerFC)\"\n        (multiValueChange)=\"handleFilterMultiChange($event, outerFC)\"\n        ></filter>\n      <div *ngIf=\"innerFCs\"\n        class=\"tool-wrap d-flex\">\n        <nz-dropdown nzTrigger=\"click\">\n          <i nz-dropdown class=\"material-icons\">more_horiz</i>\n          <ul nz-menu class=\"p-2\">\n            <li\n              *ngFor=\"let fc of innerFCs\"\n              class=\"mt-1 d-flex align-items-center\">\n              <span class=\"text-truncate\" style=\"width: 50px\">{{fc?.fs?.i18nName[translate.currentLang]}}</span>\n              <filter\n                [filterSchema]=\"fc.fs\"\n                (singleValueChange)=\"handleFilterSingleChange($event, fc)\"\n                (multiValueChange)=\"handleFilterMultiChange($event, fc)\"\n                ></filter>\n            </li>\n          </ul>\n        </nz-dropdown>\n      </div>\n      <!-- \u805A\u5408\u914D\u7F6E -->\n      <div *ngIf=\"showRuntimeAgg\"\n        class=\"tool-wrap d-flex\">\n        <nz-dropdown nzTrigger=\"click\" [(nzVisible)]=\"runtimeAggDropdownOpen\">\n          <i nz-dropdown class=\"material-icons\">show_chart</i>\n          <div nz-menu class=\"p-2\" style=\"width:200px;box-sizing:content-box;\">\n            <h5>\u805A\u5408\u914D\u7F6E</h5>\n            <div class=\"tip p-2\">\n              \u805A\u5408\u914D\u7F6E\u4EC5\u5BF9 QDP \u6570\u636E\u96C6\u751F\u6548\u3002\n            </div>\n            <div class=\"sm-title\">\u7EF4\u5EA6</div>\n            <nz-select\n              [(ngModel)]=\"editingRuntimeAgg.dimensions[0]\"\n              nzPlaceHolder=\"\u9009\u62E9\u7EF4\u5EA6\u5B57\u6BB5\"\n              style=\"width:200px\">\n              <nz-option\n                *ngFor=\"let dim of dims\"\n                [nzLabel]=\"dim.label || dim.name\"\n                [nzValue]=\"dim.name\"></nz-option>\n            </nz-select>\n            <div class=\"sm-title mt-2\">\u6C47\u603B\u65B9\u5F0F\u53CA\u6307\u6807</div>\n            <ul>\n              <li\n                class=\"mb-1 d-flex align-items-center\"\n                *ngFor=\"let ind of editingRuntimeAgg.indicators\">\n                <nz-input-group nzCompact>\n                  <nz-select [(ngModel)]=\"ind.aggFn\" style=\"width:70px\">\n                    <nz-option nzLabel=\"\u5408\u8BA1\" [nzValue]=\"1\"></nz-option>\n                    <nz-option nzLabel=\"\u6700\u5927\u503C\" [nzValue]=\"2\"></nz-option>\n                    <nz-option nzLabel=\"\u6700\u5C0F\u503C\" [nzValue]=\"3\"></nz-option>\n                    <nz-option nzLabel=\"\u8BA1\u6570\" [nzValue]=\"4\"></nz-option>\n                    <nz-option nzLabel=\"\u5E73\u5747\u503C\" [nzValue]=\"5\"></nz-option>\n                  </nz-select>\n                  <nz-select\n                    nzPlaceHolder=\"\u9009\u62E9\u6307\u6807\u5B57\u6BB5\"\n                    [(ngModel)]=\"ind.dimName\"\n                    style=\"width:110px\">\n                    <nz-option\n                      *ngFor=\"let dim of dims\"\n                      [nzLabel]=\"dim.label || dim.name\"\n                      [nzValue]=\"dim.name\"></nz-option>\n                  </nz-select>\n                </nz-input-group>\n                <i\n                  class=\"material-icons cursor-pointer fs-15 text-gray-200 hover:text-red-600 transition-colors\"\n                  (click)=\"handleRemoveInd(ind)\"\n                  >remove_circle</i>\n              </li>\n            </ul>\n\n            <div class=\"text-right mt-2\">\n              <button class=\"btn btn-secondary mr-1\" (click)=\"handleAddInd()\">\u589E\u52A0\u6307\u6807</button>\n              <button class=\"btn btn-primary\" (click)=\"handleConfirmAgg()\">{{'confirm' | translate}}</button>\n            </div>\n          </div>\n\n          <!-- <ul nz-menu class=\"p-2\">\n            <li\n              *ngFor=\"let fc of innerFCs\"\n              class=\"mt-1 d-flex align-items-center\">\n              <span class=\"text-truncate\" style=\"width: 50px\">{{fc?.fs?.i18nName[translate.currentLang]}}</span>\n              <filter\n                [filterSchema]=\"fc.fs\"\n                (singleValueChange)=\"handleFilterSingleChange($event, fc)\"\n                (multiValueChange)=\"handleFilterMultiChange($event, fc)\"\n                ></filter>\n            </li>\n          </ul> -->\n        </nz-dropdown>\n      </div>\n      <div\n        class=\"tool-wrap d-flex\"\n        [title]=\"(settingTitle || '') | translate\"\n        *ngIf=\"showSetting\">\n        <img\n          class=\"setting\"\n          (click)=\"clickSetting.emit()\"\n          src=\"assets/img/setting.svg\"\n          [alt]=\"settingTitle\">\n      </div>\n      <div\n        class=\"tool-wrap d-flex\"\n        *ngIf=\"showRefresh\"\n        (click)=\"clickRefresh.emit()\">\n        <i class=\"icon-refresh material-icons\" style=\"font-size: 20px;\">refresh</i>\n      </div>\n      <!-- -{{jumpConfig.jumpType}}-{{jumpConfig|json}}- -->\n      <div\n        *ngIf=\"jumpConfig && jumpConfig.jumpType!==JumpTypes.None\"\n        (click)=\"handleClickJump()\"\n        class=\"tool-wrap d-flex\">\n        <i class=\"material-icons\">chevron_right</i>\n      </div>\n    </div>\n  </div>\n  <ul>\n    <li *ngFor=\"let flatFC of flatFCs\" class=\"mt-1\">\n      <filter\n        [filterSchema]=\"flatFC.fs\"\n        (singleValueChange)=\"handleFilterSingleChange($event, flatFC)\"\n        (multiValueChange)=\"handleFilterMultiChange($event, flatFC)\"\n        ></filter>\n    </li>\n  </ul>\n</div>",
                changeDetection: ChangeDetectionStrategy.OnPush,
                styles: ["@charset \"UTF-8\";.title-bar{padding:12px 20px 10px}.title-bar .left{flex:1 1 auto;display:flex}.title-bar .left .material-icons{font-size:18px;margin-right:8px;color:#3794ff;padding-top:1px}.title-bar .left .title{font-weight:700;font-size:15px}.title-bar .left .number{font-size:15px;margin-left:10px}.title-bar .right{flex:1 1 auto;display:flex;justify-content:flex-end;align-items:center}.title-bar .right .widget-select{margin-left:5px}.title-bar .right .setting{width:16px;height:16px;transition:.3s;opacity:1!important}.title-bar .right .setting:hover{transform:rotate(60deg)}.title-bar .right .tool-wrap{width:20px;margin-left:10px;font-size:14px;color:#000;transition:.3s;cursor:pointer;opacity:.2}.title-bar .right .tool-wrap:hover{opacity:.4}"]
            }] }
];
/** @nocollapse */
TitleBarComponent.ctorParameters = () => [
    { type: WidgetDevkitService },
    { type: TranslateService }
];
TitleBarComponent.propDecorators = {
    icon: [{ type: Input }],
    showTitle: [{ type: Input }],
    title: [{ type: Input }],
    showNumber: [{ type: Input }],
    number: [{ type: Input }],
    showSetting: [{ type: Input }],
    settingTitle: [{ type: Input }],
    clickSetting: [{ type: Output }],
    showRefresh: [{ type: Input }],
    clickRefresh: [{ type: Output }],
    jumpConfig: [{ type: Input }],
    jumpProperty: [{ type: Input }],
    data: [{ type: Input }],
    filterConfigs: [{ type: Input }],
    dims: [{ type: Input }],
    showRuntimeAgg: [{ type: Input }],
    filterChange: [{ type: Output }],
    runtimeAggChange: [{ type: Output }],
    init: [{ type: Output }],
    leftTemplate: [{ type: ContentChild, args: ['leftTemplate',] }],
    rightTemplate: [{ type: ContentChild, args: ['rightTemplate',] }]
};
if (false) {
    /** @type {?} */
    TitleBarComponent.prototype.icon;
    /**
     * 标题
     * @type {?}
     */
    TitleBarComponent.prototype.showTitle;
    /** @type {?} */
    TitleBarComponent.prototype.title;
    /**
     * 数字
     * @type {?}
     */
    TitleBarComponent.prototype.showNumber;
    /** @type {?} */
    TitleBarComponent.prototype.number;
    /**
     * 设置按钮
     * @type {?}
     */
    TitleBarComponent.prototype.showSetting;
    /** @type {?} */
    TitleBarComponent.prototype.settingTitle;
    /** @type {?} */
    TitleBarComponent.prototype.clickSetting;
    /**
     * 刷新按钮
     * @type {?}
     */
    TitleBarComponent.prototype.showRefresh;
    /** @type {?} */
    TitleBarComponent.prototype.clickRefresh;
    /**
     * 是否启用跳转，开启后元部件配置中可配置全局联查
     * @type {?}
     */
    TitleBarComponent.prototype.jumpConfig;
    /**
     * @deprecated 应改用 enableJump。全局联查配置
     * @type {?}
     */
    TitleBarComponent.prototype.jumpProperty;
    /**
     * @deprecated 应改用 enableJump。为了跳转时能取到数据的第一行，用来拼接跳转路由参数。
     * @type {?}
     */
    TitleBarComponent.prototype.data;
    /**
     * 筛选
     * @type {?}
     */
    TitleBarComponent.prototype.filterConfigs;
    /**
     * 维度，用于运行时聚合
     * @type {?}
     */
    TitleBarComponent.prototype.dims;
    /**
     * 是否显示运行时聚合
     * @type {?}
     */
    TitleBarComponent.prototype.showRuntimeAgg;
    /** @type {?} */
    TitleBarComponent.prototype.filterChange;
    /** @type {?} */
    TitleBarComponent.prototype.runtimeAggChange;
    /** @type {?} */
    TitleBarComponent.prototype.init;
    /**
     * 传入模板
     * @type {?}
     */
    TitleBarComponent.prototype.leftTemplate;
    /** @type {?} */
    TitleBarComponent.prototype.rightTemplate;
    /** @type {?} */
    TitleBarComponent.prototype.JumpTypes;
    /**
     * 非 flat 的 fcs
     * @type {?}
     */
    TitleBarComponent.prototype.outerFC;
    /** @type {?} */
    TitleBarComponent.prototype.innerFCs;
    /**
     * flat 的 fc
     * @type {?}
     */
    TitleBarComponent.prototype.flatFCs;
    /**
     * 聚合
     * @type {?}
     */
    TitleBarComponent.prototype.editingRuntimeAgg;
    /** @type {?} */
    TitleBarComponent.prototype.confirmedRuntimeAgg;
    /** @type {?} */
    TitleBarComponent.prototype.runtimeAggDropdownOpen;
    /**
     * @type {?}
     * @private
     */
    TitleBarComponent.prototype.devkitSvc;
    /** @type {?} */
    TitleBarComponent.prototype.translate;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGl0bGUtYmFyLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0Bnc3B3aWRnZXQvd2lkZ2V0LWNvcmUvIiwic291cmNlcyI6WyJsaWIvdGl0bGUtYmFyL3RpdGxlLWJhci5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFDTCx1QkFBdUIsRUFDdkIsU0FBUyxFQUNULFlBQVksRUFBYyxZQUFZLEVBQUUsS0FBSyxFQUFxQixNQUFNLEVBRXhFLFdBQVcsRUFDWixNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQUUsT0FBTyxFQUFFLFNBQVMsRUFBc0IsU0FBUyxFQUFFLGtCQUFrQixFQUFFLGdCQUFnQixFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFDMUgsT0FBTyxFQUErQyxhQUFhLEVBQUUsUUFBUSxFQUFFLFNBQVMsRUFBRSxtQkFBbUIsRUFBRSxNQUFNLDBCQUEwQixDQUFDO0FBQ2hKLE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBUXZELE1BQU0sT0FBTyxpQkFBaUI7Ozs7O0lBb0Q1QixZQUNVLFNBQThCLEVBQy9CLFNBQTJCO1FBRDFCLGNBQVMsR0FBVCxTQUFTLENBQXFCO1FBQy9CLGNBQVMsR0FBVCxTQUFTLENBQWtCO1FBcEQzQixTQUFJLEdBQUcsRUFBRSxDQUFBOzs7O1FBRVQsY0FBUyxHQUFHLElBQUksQ0FBQTtRQUNoQixVQUFLLEdBQUcsRUFBRSxDQUFBOzs7O1FBRVYsZUFBVSxHQUFHLEtBQUssQ0FBQTtRQUNsQixXQUFNLEdBQUcsQ0FBQyxDQUFBOzs7O1FBRVYsZ0JBQVcsR0FBRyxLQUFLLENBQUE7UUFFbEIsaUJBQVksR0FBRyxJQUFJLFlBQVksRUFBTyxDQUFBOzs7O1FBRXZDLGdCQUFXLEdBQUcsS0FBSyxDQUFBO1FBQ2xCLGlCQUFZLEdBQUcsSUFBSSxZQUFZLEVBQU8sQ0FBQTs7OztRQVd2QyxTQUFJLEdBQWdCLEVBQUUsQ0FBQTs7OztRQUV0Qixt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QXlCOztJQUN6QixrQ0FBbUI7Ozs7O0lBRW5CLHVDQUEyQjs7SUFDM0IsbUNBQW1COzs7OztJQUVuQix3Q0FBNEI7O0lBQzVCLHlDQUE2Qjs7SUFDN0IseUNBQWdEOzs7OztJQUVoRCx3Q0FBNEI7O0lBQzVCLHlDQUFnRDs7Ozs7SUFHaEQsdUNBQXVDOzs7OztJQUV2Qyx5Q0FBcUI7Ozs7O0lBRXJCLGlDQUFvQjs7Ozs7SUFFcEIsMENBQXNDOzs7OztJQUV0QyxpQ0FBK0I7Ozs7O0lBRS9CLDJDQUErQjs7SUFFL0IseUNBQXNEOztJQUN0RCw2Q0FBaUU7O0lBQ2pFLGlDQUFzRDs7Ozs7SUFFdEQseUNBQW1FOztJQUNuRSwwQ0FBcUU7O0lBRXJFLHNDQUFxQjs7Ozs7SUFHckIsb0NBQXFCOztJQUNyQixxQ0FBd0I7Ozs7O0lBSXhCLG9DQUF1Qjs7Ozs7SUFHdkIsOENBQTBDOztJQUMxQyxnREFBcUM7O0lBQ3JDLG1EQUE4Qjs7Ozs7SUFHNUIsc0NBQXNDOztJQUN0QyxzQ0FBa0MiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneSxcbiAgQ29tcG9uZW50LFxuICBDb250ZW50Q2hpbGQsIEVsZW1lbnRSZWYsIEV2ZW50RW1pdHRlciwgSW5wdXQsIE9uQ2hhbmdlcywgT25Jbml0LCBPdXRwdXQsXG4gIFNpbXBsZUNoYW5nZXMsXG4gIFRlbXBsYXRlUmVmXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgQXJyVXRpbCwgZGVlcENsb25lLCBEaW1lbnNpb24sIERwVmFsdWUsIEluZGljYXRvciwgb2JqZWN0TGl0ZXJhbEVxdWFsLCBSdW50aW1lQWdnT3B0aW9uIH0gZnJvbSAnQGdzcHdpZGdldC91dGlsJztcbmltcG9ydCB7IERhdGFGaWVsZCwgRGF0YWxlc3NKdW1wQ29uZmlnLCBGaWx0ZXJDb25maWcsIGlmRnNEYXRlUmFuZ2UsIGlzRnNGbGF0LCBKdW1wVHlwZXMsIFdpZGdldERldmtpdFNlcnZpY2UgfSBmcm9tICdAZ3Nwd2lkZ2V0L3dpZGdldC1kZXZraXQnO1xuaW1wb3J0IHsgVHJhbnNsYXRlU2VydmljZSB9IGZyb20gJ0BuZ3gtdHJhbnNsYXRlL2NvcmUnO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdsaWItdGl0bGUtYmFyJyxcbiAgdGVtcGxhdGVVcmw6ICcuL3RpdGxlLWJhci5jb21wb25lbnQuaHRtbCcsXG4gIHN0eWxlVXJsczogWycuL3RpdGxlLWJhci5jb21wb25lbnQuc2NzcyddLFxuICBjaGFuZ2VEZXRlY3Rpb246IENoYW5nZURldGVjdGlvblN0cmF0ZWd5Lk9uUHVzaFxufSlcbmV4cG9ydCBjbGFzcyBUaXRsZUJhckNvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgT25DaGFuZ2VzIHtcblxuICBASW5wdXQoKSBpY29uID0gJydcbiAgLyoqIOagh+mimCAqL1xuICBASW5wdXQoKSBzaG93VGl0bGUgPSB0cnVlXG4gIEBJbnB1dCgpIHRpdGxlID0gJydcbiAgLyoqIOaVsOWtlyAqL1xuICBASW5wdXQoKSBzaG93TnVtYmVyID0gZmFsc2VcbiAgQElucHV0KCkgbnVtYmVyID0gMFxuICAvKiog6K6+572u5oyJ6ZKuICovXG4gIEBJbnB1dCgpIHNob3dTZXR0aW5nID0gZmFsc2VcbiAgQElucHV0KCkgc2V0dGluZ1RpdGxlOiBzdHJpbmdcbiAgQE91dHB1dCgpIGNsaWNrU2V0dGluZyA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpXG4gIC8qKiDliLfmlrDmjInpkq4gKi9cbiAgQElucHV0KCkgc2hvd1JlZnJlc2ggPSBmYWxzZVxuICBAT3V0cHV0KCkgY2xpY2tSZWZyZXNoID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KClcblxuICAvKiog5piv5ZCm5ZCv55So6Lez6L2s77yM5byA5ZCv5ZCO5YWD6YOo5Lu26YWN572u5Lit5Y+v6YWN572u5YWo5bGA6IGU5p+lICovXG4gIEBJbnB1dCgpIGp1bXBDb25maWc6IERhdGFsZXNzSnVtcENvbmZpZ1xuICAvKiogQGRlcHJlY2F0ZWQg5bqU5pS555SoIGVuYWJsZUp1bXDjgILlhajlsYDogZTmn6XphY3nva4gKi9cbiAgQElucHV0KCkganVtcFByb3BlcnR5XG4gIC8qKiBAZGVwcmVjYXRlZCDlupTmlLnnlKggZW5hYmxlSnVtcOOAguS4uuS6hui3s+i9rOaXtuiDveWPluWIsOaVsOaNrueahOesrOS4gOihjO+8jOeUqOadpeaLvOaOpei3s+i9rOi3r+eUseWPguaVsOOAgiAqL1xuICBASW5wdXQoKSBkYXRhOiBhbnlbXVxuICAvKiog562b6YCJICovXG4gIEBJbnB1dCgpIGZpbHRlckNvbmZpZ3M6IEZpbHRlckNvbmZpZ1tdXG4gIC8qKiDnu7TluqbvvIznlKjkuo7ov5DooYzml7bogZrlkIggKi9cbiAgQElucHV0KCkgZGltczogRGltZW5zaW9uW10gPSBbXVxuICAvKiog5piv5ZCm5pi+56S66L+Q6KGM5pe26IGa5ZCIICovXG4gIEBJbnB1dCgpIHNob3dSdW50aW1lQWdnID0gZmFsc2VcblxuICBAT3V0cHV0KCkgZmlsdGVyQ2hhbmdlID0gbmV3IEV2ZW50RW1pdHRlcjxEcFZhbHVlW10+KClcbiAgQE91dHB1dCgpIHJ1bnRpbWVBZ2dDaGFuZ2UgPSBuZXcgRXZlbnRFbWl0dGVyPFJ1bnRpbWVBZ2dPcHRpb24+KClcbiAgQE91dHB1dCgpIGluaXQgPSBuZXcgRXZlbnRFbWl0dGVyPFRpdGxlQmFyQ29tcG9uZW50PigpXG4gIC8qKiDkvKDlhaXmqKHmnb8gKi9cbiAgQENvbnRlbnRDaGlsZCgnbGVmdFRlbXBsYXRlJykgbGVmdFRlbXBsYXRlOiBUZW1wbGF0ZVJlZjxFbGVtZW50UmVmPlxuICBAQ29udGVudENoaWxkKCdyaWdodFRlbXBsYXRlJykgcmlnaHRUZW1wbGF0ZTogVGVtcGxhdGVSZWY8RWxlbWVudFJlZj5cblxuICBKdW1wVHlwZXMgPSBKdW1wVHlwZXNcblxuICAvKiog6Z2eIGZsYXQg55qEIGZjcyAqL1xuICBvdXRlckZDOiBGaWx0ZXJDb25maWdcbiAgaW5uZXJGQ3M6IEZpbHRlckNvbmZpZ1tdXG4gIC8qKiDooqvpgInkuK3nmoTjgIHmmL7npLrlnKjlpJbpnaLnmoQgZmMgKi9cbiAgLy8gc2VsZWN0ZWRGQzogRmlsdGVyQ29uZmlnXG4gIC8qKiBmbGF0IOeahCBmYyAqL1xuICBmbGF0RkNzOiBGaWx0ZXJDb25maWdbXVxuXG4gIC8qKiDogZrlkIggKi9cbiAgZWRpdGluZ1J1bnRpbWVBZ2cgPSBuZXcgUnVudGltZUFnZ09wdGlvbigpXG4gIGNvbmZpcm1lZFJ1bnRpbWVBZ2c6IFJ1bnRpbWVBZ2dPcHRpb25cbiAgcnVudGltZUFnZ0Ryb3Bkb3duT3BlbiA9IGZhbHNlXG5cbiAgY29uc3RydWN0b3IgKFxuICAgIHByaXZhdGUgZGV2a2l0U3ZjOiBXaWRnZXREZXZraXRTZXJ2aWNlLFxuICAgIHB1YmxpYyB0cmFuc2xhdGU6IFRyYW5zbGF0ZVNlcnZpY2UsXG4gICkgeyB9XG5cbiAgbmdPbkluaXQgKCkge1xuICAgIHRoaXMuaW5pdC5lbWl0KHRoaXMpXG4gIH1cblxuICBuZ09uQ2hhbmdlcyAoY2hhbmdlczogU2ltcGxlQ2hhbmdlcykge1xuICAgIGlmIChjaGFuZ2VzLmZpbHRlckNvbmZpZ3MpIHtcbiAgICAgIHRoaXMub3V0ZXJGQyA9IG51bGxcbiAgICAgIHRoaXMuaW5uZXJGQ3MgPSBudWxsXG4gICAgICBjb25zdCBub3RGbGF0RkNzID0gdGhpcy5maWx0ZXJDb25maWdzLmZpbHRlcihmYyA9PiAhaXNGc0ZsYXQoZmMuZnMpKVxuICAgICAgaWYgKG5vdEZsYXRGQ3MgJiYgbm90RmxhdEZDc1swXSkgdGhpcy5vdXRlckZDID0gbm90RmxhdEZDc1swXVxuICAgICAgaWYgKG5vdEZsYXRGQ3MgJiYgbm90RmxhdEZDcy5sZW5ndGggPiAxKSB0aGlzLmlubmVyRkNzID0gbm90RmxhdEZDcy5zbGljZSgxKVxuICAgICAgdGhpcy5mbGF0RkNzID0gdGhpcy5maWx0ZXJDb25maWdzLmZpbHRlcihmYyA9PiBpc0ZzRmxhdChmYy5mcykpXG4gICAgfVxuICB9XG4gIC8qKiDnlKjkuo7lpJbpg6jmiYvliqjorr7nva4gcnVudGltZSBhZ2fjgILlm6DkuLrmr4/mrKHpg73pnIDopoEgZGVlcCBjbG9uZe+8jOaJgOS7peWwgeijheS4uuaJi+WKqOiwg+eUqOeahOWHveaVsO+8jOiAjOmdnuaooeadv+e7keWumu+8jOS7peWHj+WwkeasoeaVsOOAgiAqL1xuICBwdWJsaWMgc2V0UnVudGltZUFnZyAocnVudGltZUFnZzogUnVudGltZUFnZ09wdGlvbikge1xuICAgIGlmICghcnVudGltZUFnZykgcmV0dXJuXG4gICAgdGhpcy5lZGl0aW5nUnVudGltZUFnZyA9IGRlZXBDbG9uZShydW50aW1lQWdnKVxuICAgIHRoaXMuY29uZmlybWVkUnVudGltZUFnZyA9IGRlZXBDbG9uZShydW50aW1lQWdnKVxuICB9XG5cbiAgaGFuZGxlQ2xpY2tKdW1wICgpIHtcbiAgICB0aGlzLmRldmtpdFN2Yy5qdW1wV2l0aG91dERhdGEodGhpcy5qdW1wQ29uZmlnKVxuICB9XG4gIC8qKiDmioogZmlsdGVyIOWPkeadpeeahOe7k+aenOWAvO+8jOWKoOS4iiBkcElkIOS4gOi1t+WMheijheS4uiBkcFZhbHVlcyDlj5Hlh7rljrsgKi9cbiAgaGFuZGxlRmlsdGVyU2luZ2xlQ2hhbmdlICh2YWx1ZSwgZmM6IEZpbHRlckNvbmZpZykge1xuICAgIC8vIDEuIOaZrumAmu+8muWPkeWHuuWvueW6lCAxIOS4qiBkcCDnmoTljZXkuKrlgLxcbiAgICB0aGlzLmZpbHRlckNoYW5nZS5lbWl0KFt7XG4gICAgICB2YWx1ZSxcbiAgICAgIGRwSWQ6IGZjLmRwSWQsXG4gICAgfV0pXG4gIH1cbiAgaGFuZGxlRmlsdGVyTXVsdGlDaGFuZ2UgKHZhbHVlczogYW55W10sIGZjOiBGaWx0ZXJDb25maWcpIHtcbiAgICBsZXQgZHBWYWx1ZXNcbiAgICAvLyAyLiDml6XmnJ/ojIPlm7TvvJrlj5Hlh7rlr7nlupQgMiDkuKogZHAg55qEIDIg5Liq5YC8XG4gICAgaWYgKGlmRnNEYXRlUmFuZ2UoZmMuZnMpKSB7XG4gICAgICBkcFZhbHVlcyA9IFtcbiAgICAgICAgeyB2YWx1ZTogdmFsdWVzWzBdLCBkcElkOiBmYy5kcElkIH0sXG4gICAgICAgIHsgdmFsdWU6IHZhbHVlc1sxXSwgZHBJZDogZmMuZHBJZDIgfSxcbiAgICAgIF1cbiAgICB9IGVsc2Uge1xuICAgICAgLy8gMy4g5p6a5Li+5aSa6YCJ77ya5Y+R5Ye65a+55bqUIDEg5LiqIGRwIOeahOWkmuS4quWAvFxuICAgICAgZHBWYWx1ZXMgPSBbe1xuICAgICAgICAvLyBUT0RPOiDlpJrlgLznmoTov57mjqXmlrnlvI/mmK/lkKblj6/phY3vvJ9cbiAgICAgICAgdmFsdWU6IHZhbHVlcy5qb2luKCcsJyksIGRwSWQ6IGZjLmRwSWRcbiAgICAgIH1dXG4gICAgfVxuICAgIHRoaXMuZmlsdGVyQ2hhbmdlLmVtaXQoZHBWYWx1ZXMpXG4gIH1cblxuICAvKiog6IGa5ZCIICovXG4gIGhhbmRsZUFkZEluZCAoKSB7XG4gICAgdGhpcy5lZGl0aW5nUnVudGltZUFnZy5pbmRpY2F0b3JzLnB1c2gobmV3IEluZGljYXRvcigpKVxuICB9XG4gIGhhbmRsZVJlbW92ZUluZCAoaW5kOiBJbmRpY2F0b3IpIHtcbiAgICBBcnJVdGlsLlJlbW92ZSh0aGlzLmVkaXRpbmdSdW50aW1lQWdnLmluZGljYXRvcnMsIGluZClcbiAgfVxuICBoYW5kbGVDb25maXJtQWdnICgpIHtcbiAgICB0aGlzLnJ1bnRpbWVBZ2dEcm9wZG93bk9wZW4gPSBmYWxzZVxuICAgIGlmIChvYmplY3RMaXRlcmFsRXF1YWwodGhpcy5lZGl0aW5nUnVudGltZUFnZywgdGhpcy5jb25maXJtZWRSdW50aW1lQWdnKSkgcmV0dXJuXG4gICAgdGhpcy5jb25maXJtZWRSdW50aW1lQWdnID0gZGVlcENsb25lKHRoaXMuZWRpdGluZ1J1bnRpbWVBZ2cpXG4gICAgdGhpcy5ydW50aW1lQWdnQ2hhbmdlLmVtaXQodGhpcy5jb25maXJtZWRSdW50aW1lQWdnKVxuICB9XG59XG5cbiJdfQ==
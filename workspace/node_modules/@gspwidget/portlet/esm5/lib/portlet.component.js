/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { HttpClient } from '@angular/common/http';
import { ChangeDetectorRef, Component, EventEmitter, Input, Output, ViewChild } from '@angular/core';
import { DatasetRepo, EppPortlet, PortletRepo } from '@gspwidget/util';
import { WCStatus, WidgetComponent } from '@gspwidget/widget-core';
import { delay, map } from 'rxjs/operators';
var PortletComponent = /** @class */ (function () {
    function PortletComponent(portletRepo, dataResultsetRepo, http, cd) {
        var _this = this;
        this.portletRepo = portletRepo;
        this.dataResultsetRepo = dataResultsetRepo;
        this.http = http;
        this.cd = cd;
        /* optional */
        this.portletNamesUsingDemoData = [];
        this.init = new EventEmitter();
        /**
         * 获取到 portlet 元数据事件，将 portlet 传出
         */
        this.gotPortlet = new EventEmitter();
        this.getData = (/**
         * @param {?} getDataOpts
         * @return {?}
         */
        function (getDataOpts) {
            // TODO: 这部分都应该由外面处理，仅区分出一个 getCustomizedData()
            // 若有外部手工数据，就用它而不取真数据/演示数据
            if (_this.getCustomizedData) {
                //   // 加个 delay 是为了变成异步调用。否则从注册，到里面的 setData，会同步调用，可怕。
                //   return this.getCustomizedData().pipe(delay(0))
                // // 若名中含有某些字，则用演示数据
                return _this.getCustomizedData().pipe(delay(0));
            }
            else if (_this.portletNamesUsingDemoData
                .some((/**
             * @param {?} name
             * @return {?}
             */
            function (name) { return _this.innerPortlet.name.includes(name); }))) {
                return _this.getDemoData().pipe(delay(0));
            }
            else {
                // 默认真数据
                return _this.dataResultsetRepo.getResultByPortletId(_this.innerPortlet.id, getDataOpts.dpValues, convertQueryConditions(_this.queryConditions), getDataOpts.runtimeAgg);
            }
        });
        this.getDataWithDims = (/**
         * @return {?}
         */
        function () {
        });
    }
    /**
     * @return {?}
     */
    PortletComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
    };
    /**
     * @param {?} changes
     * @return {?}
     */
    PortletComponent.prototype.ngOnChanges = /**
     * @param {?} changes
     * @return {?}
     */
    function (changes) {
        var _this = this;
        if (changes.portletId && changes.portletId.currentValue) {
            this.portletRepo.getPortletById(this.portletId).subscribe((/**
             * @param {?} p
             * @return {?}
             */
            function (p) {
                _this.innerPortlet = p;
                _this.cd.markForCheck();
                _this.gotPortlet.emit(p);
            }), (/**
             * @param {?} err
             * @return {?}
             */
            function (err) {
                // console.log(err)
                _this.widget.status = WCStatus.WidgetLoadError;
            }));
        }
        else if (changes.portlet && changes.portlet.currentValue) {
            this.innerPortlet = changes.portlet.currentValue;
        }
        else if (changes.queryConditions && changes.queryConditions.currentValue) {
            // 触发元部件加载数据
            this.widget.loadNSetData();
        }
    };
    /**
     * @return {?}
     */
    PortletComponent.prototype.handleWidgetInit = /**
     * @return {?}
     */
    function () {
        this.init.emit();
    };
    /** 获取演示数据 */
    // TODO: 等验证完成没问题后，挪到 util service 之类里面去，config service 啥的都可以在 util，部件系统一定生存在 iGIX 里。
    /**
     * 获取演示数据
     * @return {?}
     */
    // TODO: 等验证完成没问题后，挪到 util service 之类里面去，config service 啥的都可以在 util，部件系统一定生存在 iGIX 里。
    PortletComponent.prototype.getDemoData = /**
     * 获取演示数据
     * @return {?}
     */
    // TODO: 等验证完成没问题后，挪到 util service 之类里面去，config service 啥的都可以在 util，部件系统一定生存在 iGIX 里。
    function () {
        /** @type {?} */
        var lang = (/** @type {?} */ (localStorage.getItem('languageCode'))) || 'zh-CHS';
        return this.getHomeConfig().pipe(map((/**
         * @param {?} config
         * @return {?}
         */
        function (config) { return config.data[lang]; })));
    };
    /**
     * @return {?}
     */
    PortletComponent.prototype.getHomeConfig = /**
     * @return {?}
     */
    function () {
        return this.http.get('/platform/runtime/sys/web/home/assets/home.config.json');
    };
    PortletComponent.decorators = [
        { type: Component, args: [{
                    selector: 'lib-portlet',
                    template: "\n    <!-- {{innerPortlet | json}} -->\n    <lib-widget\n      #widget\n      [portlet]=\"innerPortlet\"\n      [basicWidgetInfo]=\"innerPortlet?.widget\"\n      [propValues]=\"innerPortlet?.propValues\"\n      [instanceId]=\"instanceId\"\n      [getData]=\"getData\"\n      [linkMap]=\"linkMap\"\n      (widgetInit)=\"handleWidgetInit()\"\n    ></lib-widget>\n  "
                }] }
    ];
    /** @nocollapse */
    PortletComponent.ctorParameters = function () { return [
        { type: PortletRepo },
        { type: DatasetRepo },
        { type: HttpClient },
        { type: ChangeDetectorRef }
    ]; };
    PortletComponent.propDecorators = {
        portletId: [{ type: Input }],
        portlet: [{ type: Input }],
        queryConditions: [{ type: Input }],
        portletNamesUsingDemoData: [{ type: Input }],
        getCustomizedData: [{ type: Input }],
        instanceId: [{ type: Input }],
        linkMap: [{ type: Input }],
        init: [{ type: Output }],
        gotPortlet: [{ type: Output }],
        widget: [{ type: ViewChild, args: ['widget',] }]
    };
    return PortletComponent;
}());
export { PortletComponent };
if (false) {
    /**
     * 下面两者任意一个必选
     * 哪个变化后有值，就用哪个
     * @type {?}
     */
    PortletComponent.prototype.portletId;
    /** @type {?} */
    PortletComponent.prototype.portlet;
    /**
     * 筛选条件
     * @type {?}
     */
    PortletComponent.prototype.queryConditions;
    /** @type {?} */
    PortletComponent.prototype.portletNamesUsingDemoData;
    /** @type {?} */
    PortletComponent.prototype.getCustomizedData;
    /** @type {?} */
    PortletComponent.prototype.instanceId;
    /** @type {?} */
    PortletComponent.prototype.linkMap;
    /** @type {?} */
    PortletComponent.prototype.init;
    /**
     * 获取到 portlet 元数据事件，将 portlet 传出
     * @type {?}
     */
    PortletComponent.prototype.gotPortlet;
    /** @type {?} */
    PortletComponent.prototype.widget;
    /**
     * 通过外部输入计算得到的真正渲染的 portlet
     * @type {?}
     */
    PortletComponent.prototype.innerPortlet;
    /** @type {?} */
    PortletComponent.prototype.getData;
    /** @type {?} */
    PortletComponent.prototype.getDataWithDims;
    /**
     * @type {?}
     * @private
     */
    PortletComponent.prototype.portletRepo;
    /**
     * @type {?}
     * @private
     */
    PortletComponent.prototype.dataResultsetRepo;
    /**
     * @type {?}
     * @private
     */
    PortletComponent.prototype.http;
    /**
     * @type {?}
     * @private
     */
    PortletComponent.prototype.cd;
}
/**
 * @param {?} conditions
 * @return {?}
 */
function convertQueryConditions(conditions) {
    if (!conditions)
        return '""';
    /** @type {?} */
    var entityData = { id: 'undefined_null' };
    conditions.forEach((/**
     * @param {?} c
     * @return {?}
     */
    function (c) {
        var fieldCode = c.fieldCode;
        /** @type {?} */
        var value = c.value;
        /** @type {?} */
        var tempValue;
        if (value && (value.dateValue || value.value || value.numValue || value.yearValue
            || value.startTime || value.endTime || value.startValue || value.endValue)) {
            switch (c.control.getControlType()) {
                case 0: // Text
                    tempValue = value.value;
                    break;
                case 1: // SingleDate
                    tempValue = value.dateValue;
                    break;
                case 2: // SmartHelp
                    tempValue = value.value[value.valueField];
                    break;
                case 3: // DropDownList
                    tempValue = value.value.value;
                    break;
                case 4: // DateRange
                    tempValue = {
                        beginValue: value.startTime ? value.startTime : 0,
                        endValue: value.endTime ? value.endTime : 0
                    }; // tempData.value;
                    break;
                case 5: // NumberRange
                    tempValue = {
                        beginValue: value.startValue ? value.startValue : 0,
                        endValue: value.endValue ? value.endValue : 0
                    }; // tempData.value;
                    break;
                case 6: // SingleNumber
                    tempValue = value.numValue;
                    break;
                case 7: // SingleYear
                    tempValue = value.yearValue;
                    break;
                case 8: // BoolCheck
                    tempValue = value.value && value.value.length ? value.value[0] : value.value;
                    break;
                case 9: // DateTimeRange
                    tempValue = {
                        beginValue: value.startValue ? value.startValue : 0,
                        endValue: value.endValue ? value.endValue : 0
                    }; // tempData.value;
                    break;
                default:
                    break;
            }
            // 根据 field code 组合 entity data
            if (fieldCode && fieldCode.includes(';')) {
                /** @type {?} */
                var fields1 = fieldCode.split(';')[0].split('.');
                /** @type {?} */
                var fields2 = fieldCode.split(';')[1].split('.');
                setEntityData(fields1, entityData, tempValue['beginValue']);
                setEntityData(fields2, entityData, tempValue['endValue']);
            }
            else {
                /** @type {?} */
                var fields = fieldCode.split('.');
                setEntityData(fields, entityData, tempValue);
            }
        }
    }));
    return entityData;
}
/**
 * @param {?} fields
 * @param {?} entityData
 * @param {?} tempData
 * @return {?}
 */
function setEntityData(fields, entityData, tempData) {
    if (fields.length && fields.length > 1) {
        for (var i = 0; i < fields.length; i++) {
            if (i === 0) {
                entityData = prepareEntityData(fields[i], entityData);
            }
            else {
                entityData = prepareEntityData(fields[i], entityData[fields[i - 1]]);
            }
            if ((i + 1) === fields.length) {
                entityData[fields[i]] = tempData;
            }
        }
    }
    else {
        entityData[fields[0]] = tempData;
    }
}
/**
 * @param {?} key
 * @param {?} entityData
 * @return {?}
 */
function prepareEntityData(key, entityData) {
    if (!entityData.hasOwnProperty(key))
        entityData[key] = {};
}
var QueryCondition = /** @class */ (function () {
    function QueryCondition() {
    }
    return QueryCondition;
}());
export { QueryCondition };
if (false) {
    /** @type {?} */
    QueryCondition.prototype.id;
    /** @type {?} */
    QueryCondition.prototype.leftBrackets;
    /** @type {?} */
    QueryCondition.prototype.fieldCode;
    /** @type {?} */
    QueryCondition.prototype.fieldName;
    /** @type {?} */
    QueryCondition.prototype.name;
    /** @type {?} */
    QueryCondition.prototype.compareType;
    /** @type {?} */
    QueryCondition.prototype.valueType;
    /**
     * 值
     * 该属性为IValue接口，根据不同的控件类型有不同的实现类：具体如下：
     * 1. 文本类型：TextValue
     * 2. 下拉列表：DropDownListValue
     * 3. 日期区间：DateRangeValue
     * 4. 数字区间：NumberRangeValue
     * 5. 帮助类型：SmartHelpValue
     * @type {?}
     */
    QueryCondition.prototype.value;
    /** @type {?} */
    QueryCondition.prototype.rightBrackets;
    /** @type {?} */
    QueryCondition.prototype.relationType;
    /**
     * 控件类型，目前包括文本类型，下拉列表，日期区间，数字区间，帮助类型
     * 控件类型为IControl接口，根据不同的控件类型对应不同的实现类，具体如下：
     * 1. 文本类型：TextControl
     * 2. 下拉列表：DropDownListControl
     * 3. 日期区间：DateRangeControl
     * 4. 数字区间：NumberRangeControl
     * 5. 帮助类型：SmartHelpContol
     * @type {?}
     */
    QueryCondition.prototype.control;
}
/** @enum {number} */
var CompareType = {
    Equal: 0,
    GreaterThan: 2,
    GreaterThanOrEqual: 3,
    LessThan: 4,
    LessThanOrEqual: 5,
    BetWeen: 6,
};
export { CompareType };
CompareType[CompareType.Equal] = 'Equal';
CompareType[CompareType.GreaterThan] = 'GreaterThan';
CompareType[CompareType.GreaterThanOrEqual] = 'GreaterThanOrEqual';
CompareType[CompareType.LessThan] = 'LessThan';
CompareType[CompareType.LessThanOrEqual] = 'LessThanOrEqual';
CompareType[CompareType.BetWeen] = 'BetWeen';
/** @enum {number} */
var ValueType = {
    Value: 0,
    SmartHelp: 1,
    Enum: 2,
    Express: 3,
};
export { ValueType };
ValueType[ValueType.Value] = 'Value';
ValueType[ValueType.SmartHelp] = 'SmartHelp';
ValueType[ValueType.Enum] = 'Enum';
ValueType[ValueType.Express] = 'Express';
/**
 * @record
 */
export function IValue() { }
if (false) {
    /**
     * @return {?}
     */
    IValue.prototype.getControlType = function () { };
    /**
     * @return {?}
     */
    IValue.prototype.getOriginalValue = function () { };
    /**
     * @param {?} value
     * @return {?}
     */
    IValue.prototype.setOriginalValue = function (value) { };
    /**
     * @return {?}
     */
    IValue.prototype.clearValue = function () { };
    /**
     * @return {?}
     */
    IValue.prototype.isEmpty = function () { };
}
/** @enum {number} */
var RelationType = {
    And: 0,
    Or: 1,
};
export { RelationType };
RelationType[RelationType.And] = 'And';
RelationType[RelationType.Or] = 'Or';
/**
 * @record
 */
export function IControl() { }
if (false) {
    /**
     * 是否是展示在扩展区域内的
     * @type {?}
     */
    IControl.prototype.isExtend;
    /** @type {?} */
    IControl.prototype.required;
    /**
     * 日期需要增加类型比较
     * @type {?|undefined}
     */
    IControl.prototype.compareType;
    /**
     * 获取控件类型
     * @return {?}
     */
    IControl.prototype.getControlType = function () { };
}
/** @enum {number} */
var ControlType = {
    Text: 0,
    // DateTime=1,
    Help: 1,
    DropDown: 2,
    DateRange: 3,
    NumberRange: 4,
    Search: 5,
    Date: 6,
    CheckboxGroup: 7,
    DateRangeTime: 8,
};
export { ControlType };
ControlType[ControlType.Text] = 'Text';
ControlType[ControlType.Help] = 'Help';
ControlType[ControlType.DropDown] = 'DropDown';
ControlType[ControlType.DateRange] = 'DateRange';
ControlType[ControlType.NumberRange] = 'NumberRange';
ControlType[ControlType.Search] = 'Search';
ControlType[ControlType.Date] = 'Date';
ControlType[ControlType.CheckboxGroup] = 'CheckboxGroup';
ControlType[ControlType.DateRangeTime] = 'DateRangeTime';
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG9ydGxldC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZ3Nwd2lkZ2V0L3BvcnRsZXQvIiwic291cmNlcyI6WyJsaWIvcG9ydGxldC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUNsRCxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsU0FBUyxFQUFFLFlBQVksRUFBRSxLQUFLLEVBQXFCLE1BQU0sRUFBaUIsU0FBUyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ3ZJLE9BQU8sRUFBRSxXQUFXLEVBQUUsVUFBVSxFQUFXLFdBQVcsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQ2hGLE9BQU8sRUFBa0IsUUFBUSxFQUFFLGVBQWUsRUFBRSxNQUFNLHdCQUF3QixDQUFDO0FBRW5GLE9BQU8sRUFBRSxLQUFLLEVBQUUsR0FBRyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFFNUM7SUE0Q0UsMEJBQ1UsV0FBd0IsRUFDeEIsaUJBQThCLEVBQzlCLElBQWdCLEVBQ2hCLEVBQXFCO1FBSi9CLGlCQUtLO1FBSkssZ0JBQVcsR0FBWCxXQUFXLENBQWE7UUFDeEIsc0JBQWlCLEdBQWpCLGlCQUFpQixDQUFhO1FBQzlCLFNBQUksR0FBSixJQUFJLENBQVk7UUFDaEIsT0FBRSxHQUFGLEVBQUUsQ0FBbUI7O1FBckJ0Qiw4QkFBeUIsR0FBYSxFQUFFLENBQUE7UUFRdkMsU0FBSSxHQUFHLElBQUksWUFBWSxFQUFFLENBQUE7Ozs7UUFFekIsZUFBVSxHQUFHLElBQUksWUFBWSxFQUFjLENBQUE7UUFrQ3JELFlBQU87Ozs7UUFBRyxVQUFDLFdBQTJCO1lBQ3BDLCtDQUErQztZQUMvQywwQkFBMEI7WUFDMUIsSUFBSSxLQUFJLENBQUMsaUJBQWlCLEVBQUU7Z0JBQzVCLHVEQUF1RDtnQkFDdkQsbURBQW1EO2dCQUNuRCxxQkFBcUI7Z0JBQ25CLE9BQU8sS0FBSSxDQUFDLGlC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QUFFLENBQUE7QUFDM0QsQ0FBQztBQUdEO0lBQUE7SUE4QkEsQ0FBQztJQUFELHFCQUFDO0FBQUQsQ0FBQyxBQTlCRCxJQThCQzs7OztJQTdCQyw0QkFBVzs7SUFDWCxzQ0FBcUI7O0lBQ3JCLG1DQUFrQjs7SUFDbEIsbUNBQWtCOztJQUNsQiw4QkFBYTs7SUFDYixxQ0FBeUI7O0lBQ3pCLG1DQUFxQjs7Ozs7Ozs7Ozs7SUFVckIsK0JBQWM7O0lBQ2QsdUNBQXNCOztJQUN0QixzQ0FBMkI7Ozs7Ozs7Ozs7O0lBVTNCLGlDQUFrQjs7OztJQUdoQixRQUFTO0lBQ1QsY0FBYztJQUNkLHFCQUFxQjtJQUNyQixXQUFZO0lBQ1osa0JBQW1CO0lBQ25CLFVBQVU7Ozs7Ozs7Ozs7O0lBR1osUUFBUTtJQUNSLFlBQVk7SUFDWixPQUFPO0lBQ1AsVUFBVTs7Ozs7Ozs7OztBQUdaLDRCQU1DOzs7OztJQUxDLGtEQUErQjs7OztJQUMvQixvREFBeUI7Ozs7O0lBQ3pCLHlEQUFvQzs7OztJQUNwQyw4Q0FBb0I7Ozs7SUFDcEIsMkNBQW9COzs7O0lBSXBCLE1BQU07SUFDTixLQUFLOzs7Ozs7OztBQUVQLDhCQVlDOzs7Ozs7SUFSQyw0QkFBa0I7O0lBQ2xCLDRCQUFrQjs7Ozs7SUFFbEIsK0JBQTBCOzs7OztJQUkxQixvREFBK0I7Ozs7SUFHL0IsT0FBTztJQUNQLGNBQWM7SUFDZCxPQUFPO0lBQ1AsV0FBVztJQUNYLFlBQVk7SUFDWixjQUFjO0lBQ2QsU0FBUztJQUNULE9BQU87SUFDUCxnQkFBZ0I7SUFDaEIsZ0JBQWdCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSHR0cENsaWVudCB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbi9odHRwJztcbmltcG9ydCB7IENoYW5nZURldGVjdG9yUmVmLCBDb21wb25lbnQsIEV2ZW50RW1pdHRlciwgSW5wdXQsIE9uQ2hhbmdlcywgT25Jbml0LCBPdXRwdXQsIFNpbXBsZUNoYW5nZXMsIFZpZXdDaGlsZCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgRGF0YXNldFJlcG8sIEVwcFBvcnRsZXQsIExpbmtNYXAsIFBvcnRsZXRSZXBvIH0gZnJvbSAnQGdzcHdpZGdldC91dGlsJztcbmltcG9ydCB7IEdldERhdGFPcHRpb25zLCBXQ1N0YXR1cywgV2lkZ2V0Q29tcG9uZW50IH0gZnJvbSAnQGdzcHdpZGdldC93aWRnZXQtY29yZSc7XG5pbXBvcnQgeyBPYnNlcnZhYmxlIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBkZWxheSwgbWFwIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdsaWItcG9ydGxldCcsXG4gIHRlbXBsYXRlOiBgXG4gICAgPCEtLSB7e2lubmVyUG9ydGxldCB8IGpzb259fSAtLT5cbiAgICA8bGliLXdpZGdldFxuICAgICAgI3dpZGdldFxuICAgICAgW3BvcnRsZXRdPVwiaW5uZXJQb3J0bGV0XCJcbiAgICAgIFtiYXNpY1dpZGdldEluZm9dPVwiaW5uZXJQb3J0bGV0Py53aWRnZXRcIlxuICAgICAgW3Byb3BWYWx1ZXNdPVwiaW5uZXJQb3J0bGV0Py5wcm9wVmFsdWVzXCJcbiAgICAgIFtpbnN0YW5jZUlkXT1cImluc3RhbmNlSWRcIlxuICAgICAgW2dldERhdGFdPVwiZ2V0RGF0YVwiXG4gICAgICBbbGlua01hcF09XCJsaW5rTWFwXCJcbiAgICAgICh3aWRnZXRJbml0KT1cImhhbmRsZVdpZGdldEluaXQoKVwiXG4gICAgPjwvbGliLXdpZGdldD5cbiAgYCxcbiAgc3R5bGVzOiBbXVxufSlcbmV4cG9ydCBjbGFzcyBQb3J0bGV0Q29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBPbkNoYW5nZXMge1xuICAvKipcbiAgICog5LiL6Z2i5Lik6ICF5Lu75oSP5LiA5Liq5b+F6YCJXG4gICAqIOWTquS4quWPmOWMluWQjuacieWAvO+8jOWwseeUqOWTquS4qlxuICAgKi9cbiAgQElucHV0KCkgcG9ydGxldElkOiBzdHJpbmdcbiAgQElucHV0KCkgcG9ydGxldDogRXBwUG9ydGxldFxuICAvKiog562b6YCJ5p2h5Lu2ICovXG4gIEBJbnB1dCgpIHF1ZXJ5Q29uZGl0aW9uczogUXVlcnlDb25kaXRpb25bXVxuICAvKiBvcHRpb25hbCAqL1xuICBASW5wdXQoKSBwb3J0bGV0TmFtZXNVc2luZ0RlbW9EYXRhOiBzdHJpbmdbXSA9IFtdXG4gIC8qIG9wdGlvbmFsICovXG4gIEBJbnB1dCgpIGdldEN1c3RvbWl6ZWREYXRhOiAoKSA9PiBPYnNlcnZhYmxlPGFueT5cbiAgLyogb3B0aW9uYWwgKi9cbiAgQElucHV0KCkgaW5zdGFuY2VJZDogc3RyaW5nXG4gIC8qIG9wdGlvbmFsICovXG4gIEBJbnB1dCgpIGxpbmtNYXA6IExpbmtNYXBcblxuICBAT3V0cHV0KCkgaW5pdCA9IG5ldyBFdmVudEVtaXR0ZXIoKVxuICAvKiog6I635Y+W5YiwIHBvcnRsZXQg5YWD5pWw5o2u5LqL5Lu277yM5bCGIHBvcnRsZXQg5Lyg5Ye6ICovXG4gIEBPdXRwdXQoKSBnb3RQb3J0bGV0ID0gbmV3IEV2ZW50RW1pdHRlcjxFcHBQb3J0bGV0PigpXG5cbiAgQFZpZXdDaGlsZCgnd2lkZ2V0Jykgd2lkZ2V0OiBXaWRnZXRDb21wb25lbnRcblxuICAvKiog6YCa6L+H5aSW6YOo6L6T5YWl6K6h566X5b6X5Yiw55qE55yf5q2j5riy5p+T55qEIHBvcnRsZXQgKi9cbiAgcHVibGljIGlubmVyUG9ydGxldDogRXBwUG9ydGxldFxuXG4gIGNvbnN0cnVjdG9yIChcbiAgICBwcml2YXRlIHBvcnRsZXRSZXBvOiBQb3J0bGV0UmVwbyxcbiAgICBwcml2YXRlIGRhdGFSZXN1bHRzZXRSZXBvOiBEYXRhc2V0UmVwbyxcbiAgICBwcml2YXRlIGh0dHA6IEh0dHBDbGllbnQsXG4gICAgcHJpdmF0ZSBjZDogQ2hhbmdlRGV0ZWN0b3JSZWYsXG4gICkgeyB9XG5cbiAgbmdPbkluaXQgKCkge1xuICB9XG5cbiAgbmdPbkNoYW5nZXMgKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpOiB2b2lkIHtcbiAgICBpZiAoY2hhbmdlcy5wb3J0bGV0SWQgJiYgY2hhbmdlcy5wb3J0bGV0SWQuY3VycmVudFZhbHVlKSB7XG4gICAgICB0aGlzLnBvcnRsZXRSZXBvLmdldFBvcnRsZXRCeUlkKHRoaXMucG9ydGxldElkKS5zdWJzY3JpYmUocCA9PiB7XG4gICAgICAgIHRoaXMuaW5uZXJQb3J0bGV0ID0gcFxuICAgICAgICB0aGlzLmNkLm1hcmtGb3JDaGVjaygpXG4gICAgICAgIHRoaXMuZ290UG9ydGxldC5lbWl0KHApXG4gICAgICB9LCBlcnIgPT4ge1xuICAgICAgICAvLyBjb25zb2xlLmxvZyhlcnIpXG4gICAgICAgIHRoaXMud2lkZ2V0LnN0YXR1cyA9IFdDU3RhdHVzLldpZGdldExvYWRFcnJvclxuICAgICAgfSlcbiAgICB9IGVsc2UgaWYgKGNoYW5nZXMucG9ydGxldCAmJiBjaGFuZ2VzLnBvcnRsZXQuY3VycmVudFZhbHVlKSB7XG4gICAgICB0aGlzLmlubmVyUG9ydGxldCA9IGNoYW5nZXMucG9ydGxldC5jdXJyZW50VmFsdWVcbiAgICB9IGVsc2UgaWYgKGNoYW5nZXMucXVlcnlDb25kaXRpb25zICYmIGNoYW5nZXMucXVlcnlDb25kaXRpb25zLmN1cnJlbnRWYWx1ZSkge1xuICAgICAgLy8g6Kem5Y+R5YWD6YOo5Lu25Yqg6L295pWw5o2uXG4gICAgICB0aGlzLndpZGdldC5sb2FkTlNldERhdGEoKVxuICAgIH1cbiAgfVxuICBnZXREYXRhID0gKGdldERhdGFPcHRzOiBHZXREYXRhT3B0aW9ucykgPT4ge1xuICAgIC8vIFRPRE86IOi/memDqOWIhumDveW6lOivpeeUseWklumdouWkhOeQhu+8jOS7heWMuuWIhuWHuuS4gOS4qiBnZXRDdXN0b21pemVkRGF0YSgpXG4gICAgLy8g6Iul5pyJ5aSW6YOo5omL5bel5pWw5o2u77yM5bCx55So5a6D6ICM5LiN5Y+W55yf5pWw5o2uL+a8lOekuuaVsOaNrlxuICAgIGlmICh0aGlzLmdldEN1c3RvbWl6ZWREYXRhKSB7XG4gICAgLy8gICAvLyDliqDkuKogZGVsYXkg5piv5Li65LqG5Y+Y5oiQ5byC5q2l6LCD55So44CC5ZCm5YiZ5LuO5rOo5YaM77yM5Yiw6YeM6Z2i55qEIHNldERhdGHvvIzkvJrlkIzmraXosIPnlKjvvIzlj6/mgJXjgIJcbiAgICAvLyAgIHJldHVybiB0aGlzLmdldEN1c3RvbWl6ZWREYXRhKCkucGlwZShkZWxheSgwKSlcbiAgICAvLyAvLyDoi6XlkI3kuK3lkKvmnInmn5DkupvlrZfvvIzliJnnlKjmvJTnpLrmlbDmja5cbiAgICAgIHJldHVybiB0aGlzLmdldEN1c3RvbWl6ZWREYXRhKCkucGlwZShkZWxheSgwKSlcbiAgICB9IGVsc2UgaWYgKHRoaXMucG9ydGxldE5hbWVzVXNpbmdEZW1vRGF0YVxuICAgICAgLnNvbWUobmFtZSA9PiB0aGlzLmlubmVyUG9ydGxldC5uYW1lLmluY2x1ZGVzKG5hbWUpKVxuICAgICAgKSB7XG4gICAgICByZXR1cm4gdGhpcy5nZXREZW1vRGF0YSgpLnBpcGUoZGVsYXkoMCkpXG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIOm7mOiupOecn+aVsOaNrlxuICAgICAgcmV0dXJuIHRoaXMuZGF0YVJlc3VsdHNldFJlcG8uZ2V0UmVzdWx0QnlQb3J0bGV0SWQoXG4gICAgICAgIHRoaXMuaW5uZXJQb3J0bGV0LmlkLFxuICAgICAgICBnZXREYXRhT3B0cy5kcFZhbHVlcyxcbiAgICAgICAgY29udmVydFF1ZXJ5Q29uZGl0aW9ucyh0aGlzLnF1ZXJ5Q29uZGl0aW9ucyksXG4gICAgICAgIGdldERhdGFPcHRzLnJ1bnRpbWVBZ2csXG4gICAgICApXG4gICAgfVxuICB9XG4gIGdldERhdGFXaXRoRGltcyA9ICgpID0+IHtcblxuICB9XG5cbiAgaGFuZGxlV2lkZ2V0SW5pdCAoKSB7XG4gICAgdGhpcy5pbml0LmVtaXQoKVxuICB9XG5cbiAgLyoqIOiOt+WPlua8lOekuuaVsOaNriAqL1xuICAvLyBUT0RPOiDnrYnpqozor4HlrozmiJDmsqHpl67popjlkI7vvIzmjKrliLAgdXRpbCBzZXJ2aWNlIOS5i+exu+mHjOmdouWOu++8jGNvbmZpZyBzZXJ2aWNlIOWVpeeahOmDveWPr+S7peWcqCB1dGls77yM6YOo5Lu257O757uf5LiA5a6a55Sf5a2Y5ZyoIGlHSVgg6YeM44CCXG4gIGdldERlbW9EYXRhICgpIHtcbiAgICBjb25zdCBsYW5nID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2xhbmd1YWdlQ29kZScpIGFzICdlbicgfCAnemgtQ0hTJyB8fCAnemgtQ0hTJ1xuICAgIHJldHVybiB0aGlzLmdldEhvbWVDb25maWcoKS5waXBlKG1hcChjb25maWcgPT4gY29uZmlnLmRhdGFbbGFuZ10pKVxuICB9XG4gIGdldEhvbWVDb25maWcgKCk6IE9ic2VydmFibGU8YW55PiB7XG4gICAgcmV0dXJuIHRoaXMuaHR0cC5nZXQoJy9wbGF0Zm9ybS9ydW50aW1lL3N5cy93ZWIvaG9tZS9hc3NldHMvaG9tZS5jb25maWcuanNvbicpXG4gIH1cblxufVxuXG5mdW5jdGlvbiBjb252ZXJ0UXVlcnlDb25kaXRpb25zIChjb25kaXRpb25zOiBRdWVyeUNvbmRpdGlvbltdKSB7XG4gIGlmICghY29uZGl0aW9ucykgcmV0dXJuICdcIlwiJ1xuICBjb25zdCBlbnRpdHlEYXRhOiBhbnkgPSB7IGlkOiAndW5kZWZpbmVkX251bGwnIH07XG4gIGNvbmRpdGlvbnMuZm9yRWFjaChjID0+IHtcbiAgICBjb25zdCB7IGZpZWxkQ29kZSB9ID0gYztcbiAgICBjb25zdCB2YWx1ZTogYW55ID0gYy52YWx1ZTtcbiAgICBsZXQgdGVtcFZhbHVlXG4gICAgaWYgKHZhbHVlICYmICh2YWx1ZS5kYXRlVmFsdWUgfHwgdmFsdWUudmFsdWUgfHwgdmFsdWUubnVtVmFsdWUgfHwgdmFsdWUueWVhclZhbHVlXG4gICAgICAgIHx8IHZhbHVlLnN0YXJ0VGltZSB8fCB2YWx1ZS5lbmRUaW1lIHx8IHZhbHVlLnN0YXJ0VmFsdWUgfHwgdmFsdWUuZW5kVmFsdWUpKSB7XG4gICAgICBzd2l0Y2ggKGMuY29udHJvbC5nZXRDb250cm9sVHlwZSgpKSB7XG4gICAgICAgIGNhc2UgMDogLy8gVGV4dFxuICAgICAgICAgIHRlbXBWYWx1ZSA9IHZhbHVlLnZhbHVlO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIDE6IC8vIFNpbmdsZURhdGVcbiAgICAgICAgICB0ZW1wVmFsdWUgPSB2YWx1ZS5kYXRlVmFsdWU7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgMjogLy8gU21hcnRIZWxwXG4gICAgICAgICAgdGVtcFZhbHVlID0gdmFsdWUudmFsdWVbdmFsdWUudmFsdWVGaWVsZF07XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgMzogLy8gRHJvcERvd25MaXN0XG4gICAgICAgICAgdGVtcFZhbHVlID0gdmFsdWUudmFsdWUudmFsdWU7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgNDogLy8gRGF0ZVJhbmdlXG4gICAgICAgICAgdGVtcFZhbHVlID0ge1xuICAgICAgICAgICAgYmVnaW5WYWx1ZTogdmFsdWUuc3RhcnRUaW1lID8gdmFsdWUuc3RhcnRUaW1lIDogMCxcbiAgICAgICAgICAgIGVuZFZhbHVlOiB2YWx1ZS5lbmRUaW1lID8gdmFsdWUuZW5kVGltZSA6IDBcbiAgICAgICAgICB9OyAvLyB0ZW1wRGF0YS52YWx1ZTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSA1OiAvLyBOdW1iZXJSYW5nZVxuICAgICAgICAgIHRlbXBWYWx1ZSA9IHtcbiAgICAgICAgICAgIGJlZ2luVmFsdWU6IHZhbHVlLnN0YXJ0VmFsdWUgPyB2YWx1ZS5zdGFydFZhbHVlIDogMCxcbiAgICAgICAgICAgIGVuZFZhbHVlOiB2YWx1ZS5lbmRWYWx1ZSA/IHZhbHVlLmVuZFZhbHVlIDogMFxuICAgICAgICAgIH07IC8vIHRlbXBEYXRhLnZhbHVlO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIDY6IC8vIFNpbmdsZU51bWJlclxuICAgICAgICAgIHRlbXBWYWx1ZSA9IHZhbHVlLm51bVZhbHVlO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIDc6IC8vIFNpbmdsZVllYXJcbiAgICAgICAgICB0ZW1wVmFsdWUgPSB2YWx1ZS55ZWFyVmFsdWU7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgODogLy8gQm9vbENoZWNrXG4gICAgICAgICAgdGVtcFZhbHVlID0gdmFsdWUudmFsdWUgJiYgdmFsdWUudmFsdWUubGVuZ3RoID8gdmFsdWUudmFsdWVbMF0gOiB2YWx1ZS52YWx1ZTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSA5OiAvLyBEYXRlVGltZVJhbmdlXG4gICAgICAgICAgdGVtcFZhbHVlID0ge1xuICAgICAgICAgICAgYmVnaW5WYWx1ZTogdmFsdWUuc3RhcnRWYWx1ZSA/IHZhbHVlLnN0YXJ0VmFsdWUgOiAwLFxuICAgICAgICAgICAgZW5kVmFsdWU6IHZhbHVlLmVuZFZhbHVlID8gdmFsdWUuZW5kVmFsdWUgOiAwXG4gICAgICAgICAgfTsgLy8gdGVtcERhdGEudmFsdWU7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICAvLyDmoLnmja4gZmllbGQgY29kZSDnu4TlkIggZW50aXR5IGRhdGFcbiAgICAgIGlmIChmaWVsZENvZGUgJiYgZmllbGRDb2RlLmluY2x1ZGVzKCc7JykpIHtcbiAgICAgICAgY29uc3QgZmllbGRzMSA9IGZpZWxkQ29kZS5zcGxpdCgnOycpWzBdLnNwbGl0KCcuJyk7XG4gICAgICAgIGNvbnN0IGZpZWxkczIgPSBmaWVsZENvZGUuc3BsaXQoJzsnKVsxXS5zcGxpdCgnLicpO1xuICAgICAgICBzZXRFbnRpdHlEYXRhKGZpZWxkczEsIGVudGl0eURhdGEsIHRlbXBWYWx1ZVsnYmVnaW5WYWx1ZSddKTtcbiAgICAgICAgc2V0RW50aXR5RGF0YShmaWVsZHMyLCBlbnRpdHlEYXRhLCB0ZW1wVmFsdWVbJ2VuZFZhbHVlJ10pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uc3QgZmllbGRzID0gZmllbGRDb2RlLnNwbGl0KCcuJyk7XG4gICAgICAgIHNldEVudGl0eURhdGEoZmllbGRzLCBlbnRpdHlEYXRhLCB0ZW1wVmFsdWUpO1xuICAgICAgfVxuICAgIH1cbiAgfSlcbiAgcmV0dXJuIGVudGl0eURhdGFcbn1cblxuZnVuY3Rpb24gc2V0RW50aXR5RGF0YSAoZmllbGRzOiBhbnlbXSwgZW50aXR5RGF0YTogYW55LCB0ZW1wRGF0YTogYW55KSB7XG4gIGlmIChmaWVsZHMubGVuZ3RoICYmIGZpZWxkcy5sZW5ndGggPiAxKSB7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBmaWVsZHMubGVuZ3RoOyBpKyspIHtcbiAgICAgIGlmIChpID09PSAwKSB7XG4gICAgICAgIGVudGl0eURhdGEgPSBwcmVwYXJlRW50aXR5RGF0YShmaWVsZHNbaV0sIGVudGl0eURhdGEpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZW50aXR5RGF0YSA9IHByZXBhcmVFbnRpdHlEYXRhKGZpZWxkc1tpXSwgZW50aXR5RGF0YVtmaWVsZHNbaSAtIDFdXSk7XG4gICAgICB9XG4gICAgICBpZiAoKGkgKyAxKSA9PT0gZmllbGRzLmxlbmd0aCkge1xuICAgICAgICBlbnRpdHlEYXRhW2ZpZWxkc1tpXV0gPSB0ZW1wRGF0YTtcbiAgICAgIH1cbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgZW50aXR5RGF0YVtmaWVsZHNbMF1dID0gdGVtcERhdGE7XG4gIH1cbn1cbmZ1bmN0aW9uIHByZXBhcmVFbnRpdHlEYXRhIChrZXk6IHN0cmluZywgZW50aXR5RGF0YTogYW55KTogYW55IHtcbiAgaWYgKCFlbnRpdHlEYXRhLmhhc093blByb3BlcnR5KGtleSkpIGVudGl0eURhdGFba2V5XSA9IHt9XG59XG5cblxuZXhwb3J0IGNsYXNzIFF1ZXJ5Q29uZGl0aW9uIHtcbiAgaWQ6IHN0cmluZztcbiAgbGVmdEJyYWNrZXRzOiBzdHJpbmc7XG4gIGZpZWxkQ29kZTogc3RyaW5nO1xuICBmaWVsZE5hbWU6IHN0cmluZztcbiAgbmFtZTogc3RyaW5nO1xuICBjb21wYXJlVHlwZTogQ29tcGFyZVR5cGU7XG4gIHZhbHVlVHlwZTogVmFsdWVUeXBlO1xuICAvKipcbiAgICog5YC8XG4gICAqIOivpeWxnuaAp+S4uklWYWx1ZeaOpeWPo++8jOagueaNruS4jeWQjOeahOaOp+S7tuexu+Wei+acieS4jeWQjOeahOWunueOsOexu++8muWFt+S9k+WmguS4i++8mlxuICAgKiAxLiDmlofmnKznsbvlnovvvJpUZXh0VmFsdWVcbiAgICogMi4g5LiL5ouJ5YiX6KGo77yaRHJvcERvd25MaXN0VmFsdWVcbiAgICogMy4g5pel5pyf5Yy66Ze077yaRGF0ZVJhbmdlVmFsdWVcbiAgICogNC4g5pWw5a2X5Yy66Ze077yaTnVtYmVyUmFuZ2VWYWx1ZVxuICAgKiA1LiDluK7liqnnsbvlnovvvJpTbWFydEhlbHBWYWx1ZVxuICAgKi9cbiAgdmFsdWU6IElWYWx1ZTtcbiAgcmlnaHRCcmFja2V0czogc3RyaW5nO1xuICByZWxhdGlvblR5cGU6IFJlbGF0aW9uVHlwZTtcbiAgLyoqXG4gICAqIOaOp+S7tuexu+Wei++8jOebruWJjeWMheaLrOaWh+acrOexu+Wei++8jOS4i+aLieWIl+ihqO+8jOaXpeacn+WMuumXtO+8jOaVsOWtl+WMuumXtO+8jOW4ruWKqeexu+Wei1xuICAgKiDmjqfku7bnsbvlnovkuLpJQ29udHJvbOaOpeWPo++8jOagueaNruS4jeWQjOeahOaOp+S7tuexu+Wei+WvueW6lOS4jeWQjOeahOWunueOsOexu++8jOWFt+S9k+WmguS4i++8mlxuICAgKiAxLiDmlofmnKznsbvlnovvvJpUZXh0Q29udHJvbFxuICAgKiAyLiDkuIvmi4nliJfooajvvJpEcm9wRG93bkxpc3RDb250cm9sXG4gICAqIDMuIOaXpeacn+WMuumXtO+8mkRhdGVSYW5nZUNvbnRyb2xcbiAgICogNC4g5pWw5a2X5Yy66Ze077yaTnVtYmVyUmFuZ2VDb250cm9sXG4gICAqIDUuIOW4ruWKqeexu+Wei++8mlNtYXJ0SGVscENvbnRvbFxuICAgKi9cbiAgY29udHJvbDogSUNvbnRyb2w7XG59XG5leHBvcnQgZW51bSBDb21wYXJlVHlwZSB7XG4gICAgRXF1YWwgPSAwLFxuICAgIEdyZWF0ZXJUaGFuPSAyLFxuICAgIEdyZWF0ZXJUaGFuT3JFcXVhbD0gMyxcbiAgICBMZXNzVGhhbiA9IDQsXG4gICAgTGVzc1RoYW5PckVxdWFsID0gNSxcbiAgICBCZXRXZWVuPSA2XG59XG5leHBvcnQgZW51bSBWYWx1ZVR5cGUge1xuICBWYWx1ZT0gMCxcbiAgU21hcnRIZWxwPSAxLFxuICBFbnVtPSAyLFxuICBFeHByZXNzPSAzXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgSVZhbHVlIHtcbiAgZ2V0Q29udHJvbFR5cGUgKCk6IENvbnRyb2xUeXBlO1xuICBnZXRPcmlnaW5hbFZhbHVlICgpOiBhbnk7XG4gIHNldE9yaWdpbmFsVmFsdWUgKHZhbHVlOiBhbnkpOiB2b2lkO1xuICBjbGVhclZhbHVlICgpOiB2b2lkO1xuICBpc0VtcHR5ICgpOiBib29sZWFuO1xufVxuXG5leHBvcnQgZW51bSBSZWxhdGlvblR5cGUge1xuICBBbmQ9IDAsXG4gIE9yPSAxXG59XG5leHBvcnQgaW50ZXJmYWNlIElDb250cm9sIHtcbiAgLyoqXG4gICAqIOaYr+WQpuaYr+WxleekuuWcqOaJqeWxleWMuuWfn+WGheeahFxuICAgKi9cbiAgaXNFeHRlbmQ6IGJvb2xlYW47XG4gIHJlcXVpcmVkOiBib29sZWFuO1xuICAvKiog5pel5pyf6ZyA6KaB5aKe5Yqg57G75Z6L5q+U6L6DICovXG4gIGNvbXBhcmVUeXBlPzogQ29tcGFyZVR5cGU7XG4gIC8qKlxuICAgKiDojrflj5bmjqfku7bnsbvlnotcbiAgICovXG4gIGdldENvbnRyb2xUeXBlICgpOiBDb250cm9sVHlwZTtcbn1cbmV4cG9ydCBlbnVtIENvbnRyb2xUeXBlIHtcbiAgVGV4dD0gMCxcbiAgLy8gRGF0ZVRpbWU9MSxcbiAgSGVscD0gMSxcbiAgRHJvcERvd249IDIsXG4gIERhdGVSYW5nZT0gMyxcbiAgTnVtYmVyUmFuZ2U9IDQsXG4gIFNlYXJjaD0gNSxcbiAgRGF0ZT0gNixcbiAgQ2hlY2tib3hHcm91cD0gNyxcbiAgRGF0ZVJhbmdlVGltZT0gOFxufVxuIl19
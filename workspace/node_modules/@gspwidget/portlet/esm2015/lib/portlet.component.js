/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { HttpClient } from '@angular/common/http';
import { ChangeDetectorRef, Component, EventEmitter, Input, Output, ViewChild } from '@angular/core';
import { DatasetRepo, EppPortlet, PortletRepo } from '@gspwidget/util';
import { WCStatus, WidgetComponent } from '@gspwidget/widget-core';
import { delay, map } from 'rxjs/operators';
export class PortletComponent {
    /**
     * @param {?} portletRepo
     * @param {?} dataResultsetRepo
     * @param {?} http
     * @param {?} cd
     */
    constructor(portletRepo, dataResultsetRepo, http, cd) {
        this.portletRepo = portletRepo;
        this.dataResultsetRepo = dataResultsetRepo;
        this.http = http;
        this.cd = cd;
        /* optional */
        this.portletNamesUsingDemoData = [];
        this.init = new EventEmitter();
        /**
         * 获取到 portlet 元数据事件，将 portlet 传出
         */
        this.gotPortlet = new EventEmitter();
        this.getData = (/**
         * @param {?} getDataOpts
         * @return {?}
         */
        (getDataOpts) => {
            // TODO: 这部分都应该由外面处理，仅区分出一个 getCustomizedData()
            // 若有外部手工数据，就用它而不取真数据/演示数据
            if (this.getCustomizedData) {
                //   // 加个 delay 是为了变成异步调用。否则从注册，到里面的 setData，会同步调用，可怕。
                //   return this.getCustomizedData().pipe(delay(0))
                // // 若名中含有某些字，则用演示数据
                return this.getCustomizedData().pipe(delay(0));
            }
            else if (this.portletNamesUsingDemoData
                .some((/**
             * @param {?} name
             * @return {?}
             */
            name => this.innerPortlet.name.includes(name)))) {
                return this.getDemoData().pipe(delay(0));
            }
            else {
                // 默认真数据
                return this.dataResultsetRepo.getResultByPortletId(this.innerPortlet.id, getDataOpts.dpValues, convertQueryConditions(this.queryConditions), getDataOpts.runtimeAgg);
            }
        });
        this.getDataWithDims = (/**
         * @return {?}
         */
        () => {
        });
    }
    /**
     * @return {?}
     */
    ngOnInit() {
    }
    /**
     * @param {?} changes
     * @return {?}
     */
    ngOnChanges(changes) {
        if (changes.portletId && changes.portletId.currentValue) {
            this.portletRepo.getPortletById(this.portletId).subscribe((/**
             * @param {?} p
             * @return {?}
             */
            p => {
                this.innerPortlet = p;
                this.cd.markForCheck();
                this.gotPortlet.emit(p);
            }), (/**
             * @param {?} err
             * @return {?}
             */
            err => {
                // console.log(err)
                this.widget.status = WCStatus.WidgetLoadError;
            }));
        }
        else if (changes.portlet && changes.portlet.currentValue) {
            this.innerPortlet = changes.portlet.currentValue;
        }
        else if (changes.queryConditions && changes.queryConditions.currentValue) {
            // 触发元部件加载数据
            this.widget.loadNSetData();
        }
    }
    /**
     * @return {?}
     */
    handleWidgetInit() {
        this.init.emit();
    }
    /**
     * 获取演示数据
     * @return {?}
     */
    // TODO: 等验证完成没问题后，挪到 util service 之类里面去，config service 啥的都可以在 util，部件系统一定生存在 iGIX 里。
    getDemoData() {
        /** @type {?} */
        const lang = (/** @type {?} */ (localStorage.getItem('languageCode'))) || 'zh-CHS';
        return this.getHomeConfig().pipe(map((/**
         * @param {?} config
         * @return {?}
         */
        config => config.data[lang])));
    }
    /**
     * @return {?}
     */
    getHomeConfig() {
        return this.http.get('/platform/runtime/sys/web/home/assets/home.config.json');
    }
}
PortletComponent.decorators = [
    { type: Component, args: [{
                selector: 'lib-portlet',
                template: `
    <!-- {{innerPortlet | json}} -->
    <lib-widget
      #widget
      [portlet]="innerPortlet"
      [basicWidgetInfo]="innerPortlet?.widget"
      [propValues]="innerPortlet?.propValues"
      [instanceId]="instanceId"
      [getData]="getData"
      [linkMap]="linkMap"
      (widgetInit)="handleWidgetInit()"
    ></lib-widget>
  `
            }] }
];
/** @nocollapse */
PortletComponent.ctorParameters = () => [
    { type: PortletRepo },
    { type: DatasetRepo },
    { type: HttpClient },
    { type: ChangeDetectorRef }
];
PortletComponent.propDecorators = {
    portletId: [{ type: Input }],
    portlet: [{ type: Input }],
    queryConditions: [{ type: Input }],
    portletNamesUsingDemoData: [{ type: Input }],
    getCustomizedData: [{ type: Input }],
    instanceId: [{ type: Input }],
    linkMap: [{ type: Input }],
    init: [{ type: Output }],
    gotPortlet: [{ type: Output }],
    widget: [{ type: ViewChild, args: ['widget',] }]
};
if (false) {
    /**
     * 下面两者任意一个必选
     * 哪个变化后有值，就用哪个
     * @type {?}
     */
    PortletComponent.prototype.portletId;
    /** @type {?} */
    PortletComponent.prototype.portlet;
    /**
     * 筛选条件
     * @type {?}
     */
    PortletComponent.prototype.queryConditions;
    /** @type {?} */
    PortletComponent.prototype.portletNamesUsingDemoData;
    /** @type {?} */
    PortletComponent.prototype.getCustomizedData;
    /** @type {?} */
    PortletComponent.prototype.instanceId;
    /** @type {?} */
    PortletComponent.prototype.linkMap;
    /** @type {?} */
    PortletComponent.prototype.init;
    /**
     * 获取到 portlet 元数据事件，将 portlet 传出
     * @type {?}
     */
    PortletComponent.prototype.gotPortlet;
    /** @type {?} */
    PortletComponent.prototype.widget;
    /**
     * 通过外部输入计算得到的真正渲染的 portlet
     * @type {?}
     */
    PortletComponent.prototype.innerPortlet;
    /** @type {?} */
    PortletComponent.prototype.getData;
    /** @type {?} */
    PortletComponent.prototype.getDataWithDims;
    /**
     * @type {?}
     * @private
     */
    PortletComponent.prototype.portletRepo;
    /**
     * @type {?}
     * @private
     */
    PortletComponent.prototype.dataResultsetRepo;
    /**
     * @type {?}
     * @private
     */
    PortletComponent.prototype.http;
    /**
     * @type {?}
     * @private
     */
    PortletComponent.prototype.cd;
}
/**
 * @param {?} conditions
 * @return {?}
 */
function convertQueryConditions(conditions) {
    if (!conditions)
        return '""';
    /** @type {?} */
    const entityData = { id: 'undefined_null' };
    conditions.forEach((/**
     * @param {?} c
     * @return {?}
     */
    c => {
        const { fieldCode } = c;
        /** @type {?} */
        const value = c.value;
        /** @type {?} */
        let tempValue;
        if (value && (value.dateValue || value.value || value.numValue || value.yearValue
            || value.startTime || value.endTime || value.startValue || value.endValue)) {
            switch (c.control.getControlType()) {
                case 0: // Text
                    tempValue = value.value;
                    break;
                case 1: // SingleDate
                    tempValue = value.dateValue;
                    break;
                case 2: // SmartHelp
                    tempValue = value.value[value.valueField];
                    break;
                case 3: // DropDownList
                    tempValue = value.value.value;
                    break;
                case 4: // DateRange
                    tempValue = {
                        beginValue: value.startTime ? value.startTime : 0,
                        endValue: value.endTime ? value.endTime : 0
                    }; // tempData.value;
                    break;
                case 5: // NumberRange
                    tempValue = {
                        beginValue: value.startValue ? value.startValue : 0,
                        endValue: value.endValue ? value.endValue : 0
                    }; // tempData.value;
                    break;
                case 6: // SingleNumber
                    tempValue = value.numValue;
                    break;
                case 7: // SingleYear
                    tempValue = value.yearValue;
                    break;
                case 8: // BoolCheck
                    tempValue = value.value && value.value.length ? value.value[0] : value.value;
                    break;
                case 9: // DateTimeRange
                    tempValue = {
                        beginValue: value.startValue ? value.startValue : 0,
                        endValue: value.endValue ? value.endValue : 0
                    }; // tempData.value;
                    break;
                default:
                    break;
            }
            // 根据 field code 组合 entity data
            if (fieldCode && fieldCode.includes(';')) {
                /** @type {?} */
                const fields1 = fieldCode.split(';')[0].split('.');
                /** @type {?} */
                const fields2 = fieldCode.split(';')[1].split('.');
                setEntityData(fields1, entityData, tempValue['beginValue']);
                setEntityData(fields2, entityData, tempValue['endValue']);
            }
            else {
                /** @type {?} */
                const fields = fieldCode.split('.');
                setEntityData(fields, entityData, tempValue);
            }
        }
    }));
    return entityData;
}
/**
 * @param {?} fields
 * @param {?} entityData
 * @param {?} tempData
 * @return {?}
 */
function setEntityData(fields, entityData, tempData) {
    if (fields.length && fields.length > 1) {
        for (let i = 0; i < fields.length; i++) {
            if (i === 0) {
                entityData = prepareEntityData(fields[i], entityData);
            }
            else {
                entityData = prepareEntityData(fields[i], entityData[fields[i - 1]]);
            }
            if ((i + 1) === fields.length) {
                entityData[fields[i]] = tempData;
            }
        }
    }
    else {
        entityData[fields[0]] = tempData;
    }
}
/**
 * @param {?} key
 * @param {?} entityData
 * @return {?}
 */
function prepareEntityData(key, entityData) {
    if (!entityData.hasOwnProperty(key))
        entityData[key] = {};
}
export class QueryCondition {
}
if (false) {
    /** @type {?} */
    QueryCondition.prototype.id;
    /** @type {?} */
    QueryCondition.prototype.leftBrackets;
    /** @type {?} */
    QueryCondition.prototype.fieldCode;
    /** @type {?} */
    QueryCondition.prototype.fieldName;
    /** @type {?} */
    QueryCondition.prototype.name;
    /** @type {?} */
    QueryCondition.prototype.compareType;
    /** @type {?} */
    QueryCondition.prototype.valueType;
    /**
     * 值
     * 该属性为IValue接口，根据不同的控件类型有不同的实现类：具体如下：
     * 1. 文本类型：TextValue
     * 2. 下拉列表：DropDownListValue
     * 3. 日期区间：DateRangeValue
     * 4. 数字区间：NumberRangeValue
     * 5. 帮助类型：SmartHelpValue
     * @type {?}
     */
    QueryCondition.prototype.value;
    /** @type {?} */
    QueryCondition.prototype.rightBrackets;
    /** @type {?} */
    QueryCondition.prototype.relationType;
    /**
     * 控件类型，目前包括文本类型，下拉列表，日期区间，数字区间，帮助类型
     * 控件类型为IControl接口，根据不同的控件类型对应不同的实现类，具体如下：
     * 1. 文本类型：TextControl
     * 2. 下拉列表：DropDownListControl
     * 3. 日期区间：DateRangeControl
     * 4. 数字区间：NumberRangeControl
     * 5. 帮助类型：SmartHelpContol
     * @type {?}
     */
    QueryCondition.prototype.control;
}
/** @enum {number} */
const CompareType = {
    Equal: 0,
    GreaterThan: 2,
    GreaterThanOrEqual: 3,
    LessThan: 4,
    LessThanOrEqual: 5,
    BetWeen: 6,
};
export { CompareType };
CompareType[CompareType.Equal] = 'Equal';
CompareType[CompareType.GreaterThan] = 'GreaterThan';
CompareType[CompareType.GreaterThanOrEqual] = 'GreaterThanOrEqual';
CompareType[CompareType.LessThan] = 'LessThan';
CompareType[CompareType.LessThanOrEqual] = 'LessThanOrEqual';
CompareType[CompareType.BetWeen] = 'BetWeen';
/** @enum {number} */
const ValueType = {
    Value: 0,
    SmartHelp: 1,
    Enum: 2,
    Express: 3,
};
export { ValueType };
ValueType[ValueType.Value] = 'Value';
ValueType[ValueType.SmartHelp] = 'SmartHelp';
ValueType[ValueType.Enum] = 'Enum';
ValueType[ValueType.Express] = 'Express';
/**
 * @record
 */
export function IValue() { }
if (false) {
    /**
     * @return {?}
     */
    IValue.prototype.getControlType = function () { };
    /**
     * @return {?}
     */
    IValue.prototype.getOriginalValue = function () { };
    /**
     * @param {?} value
     * @return {?}
     */
    IValue.prototype.setOriginalValue = function (value) { };
    /**
     * @return {?}
     */
    IValue.prototype.clearValue = function () { };
    /**
     * @return {?}
     */
    IValue.prototype.isEmpty = function () { };
}
/** @enum {number} */
const RelationType = {
    And: 0,
    Or: 1,
};
export { RelationType };
RelationType[RelationType.And] = 'And';
RelationType[RelationType.Or] = 'Or';
/**
 * @record
 */
export function IControl() { }
if (false) {
    /**
     * 是否是展示在扩展区域内的
     * @type {?}
     */
    IControl.prototype.isExtend;
    /** @type {?} */
    IControl.prototype.required;
    /**
     * 日期需要增加类型比较
     * @type {?|undefined}
     */
    IControl.prototype.compareType;
    /**
     * 获取控件类型
     * @return {?}
     */
    IControl.prototype.getControlType = function () { };
}
/** @enum {number} */
const ControlType = {
    Text: 0,
    // DateTime=1,
    Help: 1,
    DropDown: 2,
    DateRange: 3,
    NumberRange: 4,
    Search: 5,
    Date: 6,
    CheckboxGroup: 7,
    DateRangeTime: 8,
};
export { ControlType };
ControlType[ControlType.Text] = 'Text';
ControlType[ControlType.Help] = 'Help';
ControlType[ControlType.DropDown] = 'DropDown';
ControlType[ControlType.DateRange] = 'DateRange';
ControlType[ControlType.NumberRange] = 'NumberRange';
ControlType[ControlType.Search] = 'Search';
ControlType[ControlType.Date] = 'Date';
ControlType[ControlType.CheckboxGroup] = 'CheckboxGroup';
ControlType[ControlType.DateRangeTime] = 'DateRangeTime';
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG9ydGxldC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZ3Nwd2lkZ2V0L3BvcnRsZXQvIiwic291cmNlcyI6WyJsaWIvcG9ydGxldC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUNsRCxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsU0FBUyxFQUFFLFlBQVksRUFBRSxLQUFLLEVBQXFCLE1BQU0sRUFBaUIsU0FBUyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ3ZJLE9BQU8sRUFBRSxXQUFXLEVBQUUsVUFBVSxFQUFXLFdBQVcsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQ2hGLE9BQU8sRUFBa0IsUUFBUSxFQUFFLGVBQWUsRUFBRSxNQUFNLHdCQUF3QixDQUFDO0FBRW5GLE9BQU8sRUFBRSxLQUFLLEVBQUUsR0FBRyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFtQjVDLE1BQU0sT0FBTyxnQkFBZ0I7Ozs7Ozs7SUEyQjNCLFlBQ1UsV0FBd0IsRUFDeEIsaUJBQThCLEVBQzlCLElBQWdCLEVBQ2hCLEVBQXFCO1FBSHJCLGdCQUFXLEdBQVgsV0FBVyxDQUFhO1FBQ3hCLHNCQUFpQixHQUFqQixpQkFBaUIsQ0FBYTtRQUM5QixTQUFJLEdBQUosSUFBSSxDQUFZO1FBQ2hCLE9BQUUsR0FBRixFQUFFLENBQW1COztRQXJCdEIsOEJBQXlCLEdBQWEsRUFBRSxDQUFBO1FBUXZDLFNBQUksR0FBRyxJQUFJLFlBQVksRUFBRSxDQUFBOzs7O1FBRXpCLGVBQVUsR0FBRyxJQUFJLFlBQVksRUFBYyxDQUFBO1FBa0NyRCxZQUFPOzs7O1FBQUcsQ0FBQyxXQUEyQixFQUFFLEVBQUU7WUFDeEMsK0NBQStDO1lBQy9DLDBCQUEwQjtZQUMxQixJQUFJLElBQUksQ0FBQyxpQkFBaUIsRUFBRTtnQkFDNUIsdURBQXVEO2dCQUN2RCxtREFBbUQ7Z0JBQ25ELHFCQUFxQjtn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QUNyQixtQ0FBa0I7O0lBQ2xCLG1DQUFrQjs7SUFDbEIsOEJBQWE7O0lBQ2IscUNBQXlCOztJQUN6QixtQ0FBcUI7Ozs7Ozs7Ozs7O0lBVXJCLCtCQUFjOztJQUNkLHVDQUFzQjs7SUFDdEIsc0NBQTJCOzs7Ozs7Ozs7OztJQVUzQixpQ0FBa0I7Ozs7SUFHaEIsUUFBUztJQUNULGNBQWM7SUFDZCxxQkFBcUI7SUFDckIsV0FBWTtJQUNaLGtCQUFtQjtJQUNuQixVQUFVOzs7Ozs7Ozs7OztJQUdaLFFBQVE7SUFDUixZQUFZO0lBQ1osT0FBTztJQUNQLFVBQVU7Ozs7Ozs7Ozs7QUFHWiw0QkFNQzs7Ozs7SUFMQyxrREFBK0I7Ozs7SUFDL0Isb0RBQXlCOzs7OztJQUN6Qix5REFBb0M7Ozs7SUFDcEMsOENBQW9COzs7O0lBQ3BCLDJDQUFvQjs7OztJQUlwQixNQUFNO0lBQ04sS0FBSzs7Ozs7Ozs7QUFFUCw4QkFZQzs7Ozs7O0lBUkMsNEJBQWtCOztJQUNsQiw0QkFBa0I7Ozs7O0lBRWxCLCtCQUEwQjs7Ozs7SUFJMUIsb0RBQStCOzs7O0lBRy9CLE9BQU87SUFDUCxjQUFjO0lBQ2QsT0FBTztJQUNQLFdBQVc7SUFDWCxZQUFZO0lBQ1osY0FBYztJQUNkLFNBQVM7SUFDVCxPQUFPO0lBQ1AsZ0JBQWdCO0lBQ2hCLGdCQUFnQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEh0dHBDbGllbnQgfSBmcm9tICdAYW5ndWxhci9jb21tb24vaHR0cCc7XG5pbXBvcnQgeyBDaGFuZ2VEZXRlY3RvclJlZiwgQ29tcG9uZW50LCBFdmVudEVtaXR0ZXIsIElucHV0LCBPbkNoYW5nZXMsIE9uSW5pdCwgT3V0cHV0LCBTaW1wbGVDaGFuZ2VzLCBWaWV3Q2hpbGQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IERhdGFzZXRSZXBvLCBFcHBQb3J0bGV0LCBMaW5rTWFwLCBQb3J0bGV0UmVwbyB9IGZyb20gJ0Bnc3B3aWRnZXQvdXRpbCc7XG5pbXBvcnQgeyBHZXREYXRhT3B0aW9ucywgV0NTdGF0dXMsIFdpZGdldENvbXBvbmVudCB9IGZyb20gJ0Bnc3B3aWRnZXQvd2lkZ2V0LWNvcmUnO1xuaW1wb3J0IHsgT2JzZXJ2YWJsZSB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgZGVsYXksIG1hcCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnbGliLXBvcnRsZXQnLFxuICB0ZW1wbGF0ZTogYFxuICAgIDwhLS0ge3tpbm5lclBvcnRsZXQgfCBqc29ufX0gLS0+XG4gICAgPGxpYi13aWRnZXRcbiAgICAgICN3aWRnZXRcbiAgICAgIFtwb3J0bGV0XT1cImlubmVyUG9ydGxldFwiXG4gICAgICBbYmFzaWNXaWRnZXRJbmZvXT1cImlubmVyUG9ydGxldD8ud2lkZ2V0XCJcbiAgICAgIFtwcm9wVmFsdWVzXT1cImlubmVyUG9ydGxldD8ucHJvcFZhbHVlc1wiXG4gICAgICBbaW5zdGFuY2VJZF09XCJpbnN0YW5jZUlkXCJcbiAgICAgIFtnZXREYXRhXT1cImdldERhdGFcIlxuICAgICAgW2xpbmtNYXBdPVwibGlua01hcFwiXG4gICAgICAod2lkZ2V0SW5pdCk9XCJoYW5kbGVXaWRnZXRJbml0KClcIlxuICAgID48L2xpYi13aWRnZXQ+XG4gIGAsXG4gIHN0eWxlczogW11cbn0pXG5leHBvcnQgY2xhc3MgUG9ydGxldENvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgT25DaGFuZ2VzIHtcbiAgLyoqXG4gICAqIOS4i+mdouS4pOiAheS7u+aEj+S4gOS4quW/hemAiVxuICAgKiDlk6rkuKrlj5jljJblkI7mnInlgLzvvIzlsLHnlKjlk6rkuKpcbiAgICovXG4gIEBJbnB1dCgpIHBvcnRsZXRJZDogc3RyaW5nXG4gIEBJbnB1dCgpIHBvcnRsZXQ6IEVwcFBvcnRsZXRcbiAgLyoqIOetm+mAieadoeS7tiAqL1xuICBASW5wdXQoKSBxdWVyeUNvbmRpdGlvbnM6IFF1ZXJ5Q29uZGl0aW9uW11cbiAgLyogb3B0aW9uYWwgKi9cbiAgQElucHV0KCkgcG9ydGxldE5hbWVzVXNpbmdEZW1vRGF0YTogc3RyaW5nW10gPSBbXVxuICAvKiBvcHRpb25hbCAqL1xuICBASW5wdXQoKSBnZXRDdXN0b21pemVkRGF0YTogKCkgPT4gT2JzZXJ2YWJsZTxhbnk+XG4gIC8qIG9wdGlvbmFsICovXG4gIEBJbnB1dCgpIGluc3RhbmNlSWQ6IHN0cmluZ1xuICAvKiBvcHRpb25hbCAqL1xuICBASW5wdXQoKSBsaW5rTWFwOiBMaW5rTWFwXG5cbiAgQE91dHB1dCgpIGluaXQgPSBuZXcgRXZlbnRFbWl0dGVyKClcbiAgLyoqIOiOt+WPluWIsCBwb3J0bGV0IOWFg+aVsOaNruS6i+S7tu+8jOWwhiBwb3J0bGV0IOS8oOWHuiAqL1xuICBAT3V0cHV0KCkgZ290UG9ydGxldCA9IG5ldyBFdmVudEVtaXR0ZXI8RXBwUG9ydGxldD4oKVxuXG4gIEBWaWV3Q2hpbGQoJ3dpZGdldCcpIHdpZGdldDogV2lkZ2V0Q29tcG9uZW50XG5cbiAgLyoqIOmAmui/h+WklumDqOi+k+WFpeiuoeeul+W+l+WIsOeahOecn+ato+a4suafk+eahCBwb3J0bGV0ICovXG4gIHB1YmxpYyBpbm5lclBvcnRsZXQ6IEVwcFBvcnRsZXRcblxuICBjb25zdHJ1Y3RvciAoXG4gICAgcHJpdmF0ZSBwb3J0bGV0UmVwbzogUG9ydGxldFJlcG8sXG4gICAgcHJpdmF0ZSBkYXRhUmVzdWx0c2V0UmVwbzogRGF0YXNldFJlcG8sXG4gICAgcHJpdmF0ZSBodHRwOiBIdHRwQ2xpZW50LFxuICAgIHByaXZhdGUgY2Q6IENoYW5nZURldGVjdG9yUmVmLFxuICApIHsgfVxuXG4gIG5nT25Jbml0ICgpIHtcbiAgfVxuXG4gIG5nT25DaGFuZ2VzIChjaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKTogdm9pZCB7XG4gICAgaWYgKGNoYW5nZXMucG9ydGxldElkICYmIGNoYW5nZXMucG9ydGxldElkLmN1cnJlbnRWYWx1ZSkge1xuICAgICAgdGhpcy5wb3J0bGV0UmVwby5nZXRQb3J0bGV0QnlJZCh0aGlzLnBvcnRsZXRJZCkuc3Vic2NyaWJlKHAgPT4ge1xuICAgICAgICB0aGlzLmlubmVyUG9ydGxldCA9IHBcbiAgICAgICAgdGhpcy5jZC5tYXJrRm9yQ2hlY2soKVxuICAgICAgICB0aGlzLmdvdFBvcnRsZXQuZW1pdChwKVxuICAgICAgfSwgZXJyID0+IHtcbiAgICAgICAgLy8gY29uc29sZS5sb2coZXJyKVxuICAgICAgICB0aGlzLndpZGdldC5zdGF0dXMgPSBXQ1N0YXR1cy5XaWRnZXRMb2FkRXJyb3JcbiAgICAgIH0pXG4gICAgfSBlbHNlIGlmIChjaGFuZ2VzLnBvcnRsZXQgJiYgY2hhbmdlcy5wb3J0bGV0LmN1cnJlbnRWYWx1ZSkge1xuICAgICAgdGhpcy5pbm5lclBvcnRsZXQgPSBjaGFuZ2VzLnBvcnRsZXQuY3VycmVudFZhbHVlXG4gICAgfSBlbHNlIGlmIChjaGFuZ2VzLnF1ZXJ5Q29uZGl0aW9ucyAmJiBjaGFuZ2VzLnF1ZXJ5Q29uZGl0aW9ucy5jdXJyZW50VmFsdWUpIHtcbiAgICAgIC8vIOinpuWPkeWFg+mDqOS7tuWKoOi9veaVsOaNrlxuICAgICAgdGhpcy53aWRnZXQubG9hZE5TZXREYXRhKClcbiAgICB9XG4gIH1cbiAgZ2V0RGF0YSA9IChnZXREYXRhT3B0czogR2V0RGF0YU9wdGlvbnMpID0+IHtcbiAgICAvLyBUT0RPOiDov5npg6jliIbpg73lupTor6XnlLHlpJbpnaLlpITnkIbvvIzku4XljLrliIblh7rkuIDkuKogZ2V0Q3VzdG9taXplZERhdGEoKVxuICAgIC8vIOiLpeacieWklumDqOaJi+W3peaVsOaNru+8jOWwseeUqOWug+iAjOS4jeWPluecn+aVsOaNri/mvJTnpLrmlbDmja5cbiAgICBpZiAodGhpcy5nZXRDdXN0b21pemVkRGF0YSkge1xuICAgIC8vICAgLy8g5Yqg5LiqIGRlbGF5IOaYr+S4uuS6huWPmOaIkOW8guatpeiwg+eUqOOAguWQpuWImeS7juazqOWGjO+8jOWIsOmHjOmdoueahCBzZXREYXRh77yM5Lya5ZCM5q2l6LCD55So77yM5Y+v5oCV44CCXG4gICAgLy8gICByZXR1cm4gdGhpcy5nZXRDdXN0b21pemVkRGF0YSgpLnBpcGUoZGVsYXkoMCkpXG4gICAgLy8gLy8g6Iul5ZCN5Lit5ZCr5pyJ5p+Q5Lqb5a2X77yM5YiZ55So5ryU56S65pWw5o2uXG4gICAgICByZXR1cm4gdGhpcy5nZXRDdXN0b21pemVkRGF0YSgpLnBpcGUoZGVsYXkoMCkpXG4gICAgfSBlbHNlIGlmICh0aGlzLnBvcnRsZXROYW1lc1VzaW5nRGVtb0RhdGFcbiAgICAgIC5zb21lKG5hbWUgPT4gdGhpcy5pbm5lclBvcnRsZXQubmFtZS5pbmNsdWRlcyhuYW1lKSlcbiAgICAgICkge1xuICAgICAgcmV0dXJuIHRoaXMuZ2V0RGVtb0RhdGEoKS5waXBlKGRlbGF5KDApKVxuICAgIH0gZWxzZSB7XG4gICAgICAvLyDpu5jorqTnnJ/mlbDmja5cbiAgICAgIHJldHVybiB0aGlzLmRhdGFSZXN1bHRzZXRSZXBvLmdldFJlc3VsdEJ5UG9ydGxldElkKFxuICAgICAgICB0aGlzLmlubmVyUG9ydGxldC5pZCxcbiAgICAgICAgZ2V0RGF0YU9wdHMuZHBWYWx1ZXMsXG4gICAgICAgIGNvbnZlcnRRdWVyeUNvbmRpdGlvbnModGhpcy5xdWVyeUNvbmRpdGlvbnMpLFxuICAgICAgICBnZXREYXRhT3B0cy5ydW50aW1lQWdnLFxuICAgICAgKVxuICAgIH1cbiAgfVxuICBnZXREYXRhV2l0aERpbXMgPSAoKSA9PiB7XG5cbiAgfVxuXG4gIGhhbmRsZVdpZGdldEluaXQgKCkge1xuICAgIHRoaXMuaW5pdC5lbWl0KClcbiAgfVxuXG4gIC8qKiDojrflj5bmvJTnpLrmlbDmja4gKi9cbiAgLy8gVE9ETzog562J6aqM6K+B5a6M5oiQ5rKh6Zeu6aKY5ZCO77yM5oyq5YiwIHV0aWwgc2VydmljZSDkuYvnsbvph4zpnaLljrvvvIxjb25maWcgc2VydmljZSDllaXnmoTpg73lj6/ku6XlnKggdXRpbO+8jOmDqOS7tuezu+e7n+S4gOWumueUn+WtmOWcqCBpR0lYIOmHjOOAglxuICBnZXREZW1vRGF0YSAoKSB7XG4gICAgY29uc3QgbGFuZyA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdsYW5ndWFnZUNvZGUnKSBhcyAnZW4nIHwgJ3poLUNIUycgfHwgJ3poLUNIUydcbiAgICByZXR1cm4gdGhpcy5nZXRIb21lQ29uZmlnKCkucGlwZShtYXAoY29uZmlnID0+IGNvbmZpZy5kYXRhW2xhbmddKSlcbiAgfVxuICBnZXRIb21lQ29uZmlnICgpOiBPYnNlcnZhYmxlPGFueT4ge1xuICAgIHJldHVybiB0aGlzLmh0dHAuZ2V0KCcvcGxhdGZvcm0vcnVudGltZS9zeXMvd2ViL2hvbWUvYXNzZXRzL2hvbWUuY29uZmlnLmpzb24nKVxuICB9XG5cbn1cblxuZnVuY3Rpb24gY29udmVydFF1ZXJ5Q29uZGl0aW9ucyAoY29uZGl0aW9uczogUXVlcnlDb25kaXRpb25bXSkge1xuICBpZiAoIWNvbmRpdGlvbnMpIHJldHVybiAnXCJcIidcbiAgY29uc3QgZW50aXR5RGF0YTogYW55ID0geyBpZDogJ3VuZGVmaW5lZF9udWxsJyB9O1xuICBjb25kaXRpb25zLmZvckVhY2goYyA9PiB7XG4gICAgY29uc3QgeyBmaWVsZENvZGUgfSA9IGM7XG4gICAgY29uc3QgdmFsdWU6IGFueSA9IGMudmFsdWU7XG4gICAgbGV0IHRlbXBWYWx1ZVxuICAgIGlmICh2YWx1ZSAmJiAodmFsdWUuZGF0ZVZhbHVlIHx8IHZhbHVlLnZhbHVlIHx8IHZhbHVlLm51bVZhbHVlIHx8IHZhbHVlLnllYXJWYWx1ZVxuICAgICAgICB8fCB2YWx1ZS5zdGFydFRpbWUgfHwgdmFsdWUuZW5kVGltZSB8fCB2YWx1ZS5zdGFydFZhbHVlIHx8IHZhbHVlLmVuZFZhbHVlKSkge1xuICAgICAgc3dpdGNoIChjLmNvbnRyb2wuZ2V0Q29udHJvbFR5cGUoKSkge1xuICAgICAgICBjYXNlIDA6IC8vIFRleHRcbiAgICAgICAgICB0ZW1wVmFsdWUgPSB2YWx1ZS52YWx1ZTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAxOiAvLyBTaW5nbGVEYXRlXG4gICAgICAgICAgdGVtcFZhbHVlID0gdmFsdWUuZGF0ZVZhbHVlO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIDI6IC8vIFNtYXJ0SGVscFxuICAgICAgICAgIHRlbXBWYWx1ZSA9IHZhbHVlLnZhbHVlW3ZhbHVlLnZhbHVlRmllbGRdO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIDM6IC8vIERyb3BEb3duTGlzdFxuICAgICAgICAgIHRlbXBWYWx1ZSA9IHZhbHVlLnZhbHVlLnZhbHVlO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIDQ6IC8vIERhdGVSYW5nZVxuICAgICAgICAgIHRlbXBWYWx1ZSA9IHtcbiAgICAgICAgICAgIGJlZ2luVmFsdWU6IHZhbHVlLnN0YXJ0VGltZSA/IHZhbHVlLnN0YXJ0VGltZSA6IDAsXG4gICAgICAgICAgICBlbmRWYWx1ZTogdmFsdWUuZW5kVGltZSA/IHZhbHVlLmVuZFRpbWUgOiAwXG4gICAgICAgICAgfTsgLy8gdGVtcERhdGEudmFsdWU7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgNTogLy8gTnVtYmVyUmFuZ2VcbiAgICAgICAgICB0ZW1wVmFsdWUgPSB7XG4gICAgICAgICAgICBiZWdpblZhbHVlOiB2YWx1ZS5zdGFydFZhbHVlID8gdmFsdWUuc3RhcnRWYWx1ZSA6IDAsXG4gICAgICAgICAgICBlbmRWYWx1ZTogdmFsdWUuZW5kVmFsdWUgPyB2YWx1ZS5lbmRWYWx1ZSA6IDBcbiAgICAgICAgICB9OyAvLyB0ZW1wRGF0YS52YWx1ZTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSA2OiAvLyBTaW5nbGVOdW1iZXJcbiAgICAgICAgICB0ZW1wVmFsdWUgPSB2YWx1ZS5udW1WYWx1ZTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSA3OiAvLyBTaW5nbGVZZWFyXG4gICAgICAgICAgdGVtcFZhbHVlID0gdmFsdWUueWVhclZhbHVlO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIDg6IC8vIEJvb2xDaGVja1xuICAgICAgICAgIHRlbXBWYWx1ZSA9IHZhbHVlLnZhbHVlICYmIHZhbHVlLnZhbHVlLmxlbmd0aCA/IHZhbHVlLnZhbHVlWzBdIDogdmFsdWUudmFsdWU7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgOTogLy8gRGF0ZVRpbWVSYW5nZVxuICAgICAgICAgIHRlbXBWYWx1ZSA9IHtcbiAgICAgICAgICAgIGJlZ2luVmFsdWU6IHZhbHVlLnN0YXJ0VmFsdWUgPyB2YWx1ZS5zdGFydFZhbHVlIDogMCxcbiAgICAgICAgICAgIGVuZFZhbHVlOiB2YWx1ZS5lbmRWYWx1ZSA/IHZhbHVlLmVuZFZhbHVlIDogMFxuICAgICAgICAgIH07IC8vIHRlbXBEYXRhLnZhbHVlO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgICAgLy8g5qC55o2uIGZpZWxkIGNvZGUg57uE5ZCIIGVudGl0eSBkYXRhXG4gICAgICBpZiAoZmllbGRDb2RlICYmIGZpZWxkQ29kZS5pbmNsdWRlcygnOycpKSB7XG4gICAgICAgIGNvbnN0IGZpZWxkczEgPSBmaWVsZENvZGUuc3BsaXQoJzsnKVswXS5zcGxpdCgnLicpO1xuICAgICAgICBjb25zdCBmaWVsZHMyID0gZmllbGRDb2RlLnNwbGl0KCc7JylbMV0uc3BsaXQoJy4nKTtcbiAgICAgICAgc2V0RW50aXR5RGF0YShmaWVsZHMxLCBlbnRpdHlEYXRhLCB0ZW1wVmFsdWVbJ2JlZ2luVmFsdWUnXSk7XG4gICAgICAgIHNldEVudGl0eURhdGEoZmllbGRzMiwgZW50aXR5RGF0YSwgdGVtcFZhbHVlWydlbmRWYWx1ZSddKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnN0IGZpZWxkcyA9IGZpZWxkQ29kZS5zcGxpdCgnLicpO1xuICAgICAgICBzZXRFbnRpdHlEYXRhKGZpZWxkcywgZW50aXR5RGF0YSwgdGVtcFZhbHVlKTtcbiAgICAgIH1cbiAgICB9XG4gIH0pXG4gIHJldHVybiBlbnRpdHlEYXRhXG59XG5cbmZ1bmN0aW9uIHNldEVudGl0eURhdGEgKGZpZWxkczogYW55W10sIGVudGl0eURhdGE6IGFueSwgdGVtcERhdGE6IGFueSkge1xuICBpZiAoZmllbGRzLmxlbmd0aCAmJiBmaWVsZHMubGVuZ3RoID4gMSkge1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZmllbGRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBpZiAoaSA9PT0gMCkge1xuICAgICAgICBlbnRpdHlEYXRhID0gcHJlcGFyZUVudGl0eURhdGEoZmllbGRzW2ldLCBlbnRpdHlEYXRhKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGVudGl0eURhdGEgPSBwcmVwYXJlRW50aXR5RGF0YShmaWVsZHNbaV0sIGVudGl0eURhdGFbZmllbGRzW2kgLSAxXV0pO1xuICAgICAgfVxuICAgICAgaWYgKChpICsgMSkgPT09IGZpZWxkcy5sZW5ndGgpIHtcbiAgICAgICAgZW50aXR5RGF0YVtmaWVsZHNbaV1dID0gdGVtcERhdGE7XG4gICAgICB9XG4gICAgfVxuICB9IGVsc2Uge1xuICAgIGVudGl0eURhdGFbZmllbGRzWzBdXSA9IHRlbXBEYXRhO1xuICB9XG59XG5mdW5jdGlvbiBwcmVwYXJlRW50aXR5RGF0YSAoa2V5OiBzdHJpbmcsIGVudGl0eURhdGE6IGFueSk6IGFueSB7XG4gIGlmICghZW50aXR5RGF0YS5oYXNPd25Qcm9wZXJ0eShrZXkpKSBlbnRpdHlEYXRhW2tleV0gPSB7fVxufVxuXG5cbmV4cG9ydCBjbGFzcyBRdWVyeUNvbmRpdGlvbiB7XG4gIGlkOiBzdHJpbmc7XG4gIGxlZnRCcmFja2V0czogc3RyaW5nO1xuICBmaWVsZENvZGU6IHN0cmluZztcbiAgZmllbGROYW1lOiBzdHJpbmc7XG4gIG5hbWU6IHN0cmluZztcbiAgY29tcGFyZVR5cGU6IENvbXBhcmVUeXBlO1xuICB2YWx1ZVR5cGU6IFZhbHVlVHlwZTtcbiAgLyoqXG4gICAqIOWAvFxuICAgKiDor6XlsZ7mgKfkuLpJVmFsdWXmjqXlj6PvvIzmoLnmja7kuI3lkIznmoTmjqfku7bnsbvlnovmnInkuI3lkIznmoTlrp7njrDnsbvvvJrlhbfkvZPlpoLkuIvvvJpcbiAgICogMS4g5paH5pys57G75Z6L77yaVGV4dFZhbHVlXG4gICAqIDIuIOS4i+aLieWIl+ihqO+8mkRyb3BEb3duTGlzdFZhbHVlXG4gICAqIDMuIOaXpeacn+WMuumXtO+8mkRhdGVSYW5nZVZhbHVlXG4gICAqIDQuIOaVsOWtl+WMuumXtO+8mk51bWJlclJhbmdlVmFsdWVcbiAgICogNS4g5biu5Yqp57G75Z6L77yaU21hcnRIZWxwVmFsdWVcbiAgICovXG4gIHZhbHVlOiBJVmFsdWU7XG4gIHJpZ2h0QnJhY2tldHM6IHN0cmluZztcbiAgcmVsYXRpb25UeXBlOiBSZWxhdGlvblR5cGU7XG4gIC8qKlxuICAgKiDmjqfku7bnsbvlnovvvIznm67liY3ljIXmi6zmlofmnKznsbvlnovvvIzkuIvmi4nliJfooajvvIzml6XmnJ/ljLrpl7TvvIzmlbDlrZfljLrpl7TvvIzluK7liqnnsbvlnotcbiAgICog5o6n5Lu257G75Z6L5Li6SUNvbnRyb2zmjqXlj6PvvIzmoLnmja7kuI3lkIznmoTmjqfku7bnsbvlnovlr7nlupTkuI3lkIznmoTlrp7njrDnsbvvvIzlhbfkvZPlpoLkuIvvvJpcbiAgICogMS4g5paH5pys57G75Z6L77yaVGV4dENvbnRyb2xcbiAgICogMi4g5LiL5ouJ5YiX6KGo77yaRHJvcERvd25MaXN0Q29udHJvbFxuICAgKiAzLiDml6XmnJ/ljLrpl7TvvJpEYXRlUmFuZ2VDb250cm9sXG4gICAqIDQuIOaVsOWtl+WMuumXtO+8mk51bWJlclJhbmdlQ29udHJvbFxuICAgKiA1LiDluK7liqnnsbvlnovvvJpTbWFydEhlbHBDb250b2xcbiAgICovXG4gIGNvbnRyb2w6IElDb250cm9sO1xufVxuZXhwb3J0IGVudW0gQ29tcGFyZVR5cGUge1xuICAgIEVxdWFsID0gMCxcbiAgICBHcmVhdGVyVGhhbj0gMixcbiAgICBHcmVhdGVyVGhhbk9yRXF1YWw9IDMsXG4gICAgTGVzc1RoYW4gPSA0LFxuICAgIExlc3NUaGFuT3JFcXVhbCA9IDUsXG4gICAgQmV0V2Vlbj0gNlxufVxuZXhwb3J0IGVudW0gVmFsdWVUeXBlIHtcbiAgVmFsdWU9IDAsXG4gIFNtYXJ0SGVscD0gMSxcbiAgRW51bT0gMixcbiAgRXhwcmVzcz0gM1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIElWYWx1ZSB7XG4gIGdldENvbnRyb2xUeXBlICgpOiBDb250cm9sVHlwZTtcbiAgZ2V0T3JpZ2luYWxWYWx1ZSAoKTogYW55O1xuICBzZXRPcmlnaW5hbFZhbHVlICh2YWx1ZTogYW55KTogdm9pZDtcbiAgY2xlYXJWYWx1ZSAoKTogdm9pZDtcbiAgaXNFbXB0eSAoKTogYm9vbGVhbjtcbn1cblxuZXhwb3J0IGVudW0gUmVsYXRpb25UeXBlIHtcbiAgQW5kPSAwLFxuICBPcj0gMVxufVxuZXhwb3J0IGludGVyZmFjZSBJQ29udHJvbCB7XG4gIC8qKlxuICAgKiDmmK/lkKbmmK/lsZXnpLrlnKjmianlsZXljLrln5/lhoXnmoRcbiAgICovXG4gIGlzRXh0ZW5kOiBib29sZWFuO1xuICByZXF1aXJlZDogYm9vbGVhbjtcbiAgLyoqIOaXpeacn+mcgOimgeWinuWKoOexu+Wei+avlOi+gyAqL1xuICBjb21wYXJlVHlwZT86IENvbXBhcmVUeXBlO1xuICAvKipcbiAgICog6I635Y+W5o6n5Lu257G75Z6LXG4gICAqL1xuICBnZXRDb250cm9sVHlwZSAoKTogQ29udHJvbFR5cGU7XG59XG5leHBvcnQgZW51bSBDb250cm9sVHlwZSB7XG4gIFRleHQ9IDAsXG4gIC8vIERhdGVUaW1lPTEsXG4gIEhlbHA9IDEsXG4gIERyb3BEb3duPSAyLFxuICBEYXRlUmFuZ2U9IDMsXG4gIE51bWJlclJhbmdlPSA0LFxuICBTZWFyY2g9IDUsXG4gIERhdGU9IDYsXG4gIENoZWNrYm94R3JvdXA9IDcsXG4gIERhdGVSYW5nZVRpbWU9IDhcbn1cbiJdfQ==
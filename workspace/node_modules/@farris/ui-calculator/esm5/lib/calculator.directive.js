/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Directive, HostListener, Renderer2, ElementRef, ChangeDetectorRef } from '@angular/core';
import { plus, minus, times, divide, } from './precision';
import { NotifyService } from '@farris/ui-notify';
var CalculatorDirective = /** @class */ (function () {
    function CalculatorDirective(el, rd, notifyService, cdr) {
        this.el = el;
        this.rd = rd;
        this.notifyService = notifyService;
        this.cdr = cdr;
        this.number = ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9'];
        //操作步骤缓存
        this.stepInputCache = '';
        //结果缓存
        this.resultInputCache = '0';
        //记录加减乘除的数字
        this.preNumber = [];
        //记录加减乘除符号
        this.preOperator = [];
    }
    /**
     * @return {?}
     */
    CalculatorDirective.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.selfEl = this.el.nativeElement;
        this.stepEl = this.selfEl.querySelector('#std-pre-step');
        this.resultEl = this.selfEl.querySelector('#std-show-input');
        this.symbolEl = this.selfEl.querySelector('#std-num-symbol');
        this.preEl = this.selfEl.querySelector('.pre');
        this.leftEl = this.selfEl.querySelector('.pre_left');
        this.rightEl = this.selfEl.querySelector('.pre_right');
        this.rd.listen(this.rightEl, 'click', (/**
         * @return {?}
         */
        function () {
            _this.stepEl.scrollLeft += 50;
        }));
        this.rd.listen(this.leftEl, 'click', (/**
         * @return {?}
         */
        function () {
            _this.stepEl.scrollLeft -= 50;
        }));
    };
    /**
     * @return {?}
     */
    CalculatorDirective.prototype.ngAfterViewChecked = /**
     * @return {?}
     */
    function () {
        this.calculateWidth();
    };
    /**
     * @return {?}
     */
    CalculatorDirective.prototype.calculateWidth = /**
     * @return {?}
     */
    function () {
        if (this.stepEl.scrollWidth > this.preEl.offsetWidth) {
            this.leftEl.style.display = 'block';
            this.rightEl.style.display = 'block';
        }
        else {
            this.leftEl.style.display = 'none';
            this.rightEl.style.display = 'none';
        }
    };
    /**
     *
     * @param value 设置步骤显示区的内容
     */
    /**
     *
     * @param {?} value 设置步骤显示区的内容
     * @return {?}
     */
    CalculatorDirective.prototype.setStepInput = /**
     *
     * @param {?} value 设置步骤显示区的内容
     * @return {?}
     */
    function (value) {
        this.stepEl.innerHTML = value;
    };
    /**
     *
     * @param value 设置结果示区的内容
     */
    /**
     *
     * @param {?} value 设置结果示区的内容
     * @return {?}
     */
    CalculatorDirective.prototype.setResultInput = /**
     *
     * @param {?} value 设置结果示区的内容
     * @return {?}
     */
    function (value) {
        this.resultEl.innerHTML = value;
    };
    /**
     * 步骤操作视窗中，最后显示的是否是操作符
     */
    /**
     * 步骤操作视窗中，最后显示的是否是操作符
     * @return {?}
     */
    CalculatorDirective.prototype.stepInputEndIsOperator = /**
     * 步骤操作视窗中，最后显示的是否是操作符
     * @return {?}
     */
    function () {
        return this.stepInputCache.lastIndexOf('+') !== -1 ||
            this.stepInputCache.lastIndexOf('-') !== -1 ||
            this.stepInputCache.lastIndexOf('×') !== -1 ||
            this.stepInputCache.lastIndexOf('÷') !== -1;
    };
    /**
     * 加减乘除运算
     * @param f 第一个数字
     * @param s 第二个数字
     * @param o 操作符
     */
    /**
     * 加减乘除运算
     * @param {?} f 第一个数字
     * @param {?} s 第二个数字
     * @param {?} o 操作符
     * @return {?}
     */
    CalculatorDirective.prototype.calculate = /**
     * 加减乘除运算
     * @param {?} f 第一个数字
     * @param {?} s 第二个数字
     * @param {?} o 操作符
     * @return {?}
     */
    function (f, s, o) {
        /** @type {?} */
        var result;
        f = Number(f);
        s = Number(s);
        switch (o) {
            case '+':
                result = plus(f, s);
                break;
            case '-':
                result = minus(f, s);
                break;
            case '×':
                result = times(f, s);
                break;
            case '÷':
                result = divide(f, s);
                break;
        }
        return result;
    };
    /**
     * numberClick,dotClick,operatorClick,pnClick,equalClick,ceClick,cClick,backClick等，对应着点击相关的按钮操作
     * @param val
     */
    /**
     * numberClick,dotClick,operatorClick,pnClick,equalClick,ceClick,cClick,backClick等，对应着点击相关的按钮操作
     * @param {?} val
     * @return {?}
     */
    CalculatorDirective.prototype.numberClick = /**
     * numberClick,dotClick,operatorClick,pnClick,equalClick,ceClick,cClick,backClick等，对应着点击相关的按钮操作
     * @param {?} val
     * @return {?}
     */
    function (val) {
        if ((this.resultInputCache.indexOf('0') === 0 && this.resultInputCache.indexOf('.') === -1) || this.firstInputToken === true) {
            this.resultInputCache = val;
        }
        else {
            this.resultInputCache += val;
        }
        this.firstInputToken = false;
        this.equalToken = false;
    };
    /**
     * @param {?} val
     * @return {?}
     */
    CalculatorDirective.prototype.dotClick = /**
     * @param {?} val
     * @return {?}
     */
    function (val) {
        if (this.firstInputToken === true) {
            this.resultInputCache = '0' + val;
        }
        else {
            if (this.resultInputCache.indexOf('.') === -1) {
                this.resultInputCache += val;
            }
        }
        this.firstInputToken = false;
        this.equalToken = false;
    };
    /**
     * @return {?}
     */
    CalculatorDirective.prototype.pnClick = /**
     * @return {?}
     */
    function () {
        if (this.resultInputCache.indexOf('-') === -1 && this.resultInputCache !== '0') {
            this.resultInputCache = "-" + this.resultInputCache;
        }
        else if (this.resultInputCache.indexOf('-') > -1 && this.resultInputCache !== '0') {
            this.resultInputCache = this.resultInputCache.substring(1);
        }
    };
    /**
     * @param {?} val
     * @return {?}
     */
    CalculatorDirective.prototype.operatorClick = /**
     * @param {?} val
     * @return {?}
     */
    function (val) {
        if (this.preNumber.length < 2 && (this.firstInputToken !== true || this.equalToken === true)) {
            this.resultInputCache = parseFloat(this.resultInputCache) + '';
            this.stepInputCache = this.stepInputCache + ' ' + this.resultInputCache + ' ' + val;
            this.preNumber.push(this.resultInputCache);
            this.preOperator.push(val);
            this.firstInputToken = true;
        }
        else if (this.preNumber.length < 2 && this.stepInputEndIsOperator()) {
            this.stepInputCache = this.stepInputCache.substring(0, this.stepInputCache.length - 1) + '' + val;
            this.preOperator.push(val);
        }
        if (this.preNumber.length === 2) {
            /** @type {?} */
            var operator = this.preOperator[this.preOperator.length - 2];
            if (this.preNumber[1] === '0' && operator === '÷') {
                this.preNumber = [];
                this.resultInputCache = '除数不能为零';
                this.stepInputCache = '';
                this.firstInputToken = true;
                return;
            }
            /** @type {?} */
            var res = this.calculate(this.preNumber[0], this.preNumber[1], operator);
            this.preNumber = [];
            this.preNumber.push(res);
            this.resultInputCache = res + '';
            this.firstInputToken = true;
        }
        this.cdr.detectChanges();
    };
    /**
     * @return {?}
     */
    CalculatorDirective.prototype.equalClick = /**
     * @return {?}
     */
    function () {
        if (this.preNumber.length > 0) {
            /** @type {?} */
            var operator = this.preOperator.pop();
            if (this.resultInputCache === '0' && operator === '÷') {
                this.preNumber = [];
                this.resultInputCache = '除数不能为零';
                this.stepInputCache = '';
                this.firstInputToken = true;
                this.equalToken = true;
                return;
            }
            /** @type {?} */
            var res = this.calculate(this.preNumber[0], this.resultInputCache, operator);
            this.preNumber = [];
            this.resultInputCache = res + '';
            this.stepInputCache = '';
            this.firstInputToken = true;
            this.equalToken = true;
        }
        this.cdr.detectChanges();
    };
    /**
     * @return {?}
     */
    CalculatorDirective.prototype.ceClick = /**
     * @return {?}
     */
    function () {
        this.resultInputCache = '0';
    };
    /**
     * @return {?}
     */
    CalculatorDirective.prototype.cClick = /**
     * @return {?}
     */
    function () {
        this.resultInputCache = '0';
        this.stepInputCache = '';
        this.firstInputToken = true;
        this.preNumber = [];
        this.preOperator = [];
        this.cdr.detectChanges();
    };
    /**
     * @return {?}
     */
    CalculatorDirective.prototype.backClick = /**
     * @return {?}
     */
    function () {
        this.resultInputCache = this.resultInputCache.length > 1 ? this.resultInputCache.substring(0, this.resultInputCache.length - 1) : '0';
    };
    /**
     * @param {?} event
     * @return {?}
     */
    CalculatorDirective.prototype.click = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        if (!this.symbolEl.contains(event.target)) {
            return;
        }
        /** @type {?} */
        var val = event.target.innerHTML;
        // if (this.resultInputCache.length > 12 && this.number.includes(val) && this.firstInputToken !== true) {
        //   this.notifyService.warning(`${this.resultInputCache}越界,该区域至多显示13位数字`);
        //   return;
        // }
        switch (val) {
            case '0':
            case '1':
            case '2':
            case '3':
            case '4':
            case '5':
            case '6':
            case '7':
            case '8':
            case '9':
                this.numberClick(val);
                break;
            case '.':
                this.dotClick(val);
                break;
            case '±':
                this.pnClick();
                break;
            case '+':
            case '-':
            case '×':
            case '÷':
                this.operatorClick(val);
                break;
            case '=':
                this.equalClick();
                break;
            case 'CE':
                this.ceClick();
                break;
            case 'C':
                this.cClick();
                break;
            case 'Back':
                this.backClick();
                break;
        }
        this.setStepInput(this.stepInputCache);
        this.setResultInput(this.resultInputCache);
    };
    CalculatorDirective.decorators = [
        { type: Directive, args: [{
                    selector: '[farrisCalculator]'
                },] }
    ];
    /** @nocollapse */
    CalculatorDirective.ctorParameters = function () { return [
        { type: ElementRef },
        { type: Renderer2 },
        { type: NotifyService },
        { type: ChangeDetectorRef }
    ]; };
    CalculatorDirective.propDecorators = {
        click: [{ type: HostListener, args: ['click', ['$event'],] }]
    };
    return CalculatorDirective;
}());
export { CalculatorDirective };
if (false) {
    /**
     * @type {?}
     * @private
     */
    CalculatorDirective.prototype.selfEl;
    /**
     * @type {?}
     * @private
     */
    CalculatorDirective.prototype.stepEl;
    /**
     * @type {?}
     * @private
     */
    CalculatorDirective.prototype.resultEl;
    /**
     * @type {?}
     * @private
     */
    CalculatorDirective.prototype.symbolEl;
    /**
     * @type {?}
     * @private
     */
    CalculatorDirective.prototype.preEl;
    /**
     * @type {?}
     * @private
     */
    CalculatorDirective.prototype.leftEl;
    /**
     * @type {?}
     * @private
     */
    CalculatorDirective.prototype.rightEl;
    /**
     * @type {?}
     * @private
     */
    CalculatorDirective.prototype.number;
    /**
     * @type {?}
     * @private
     */
    CalculatorDirective.prototype.stepInputCache;
    /**
     * @type {?}
     * @private
     */
    CalculatorDirective.prototype.resultInputCache;
    /**
     * @type {?}
     * @private
     */
    CalculatorDirective.prototype.preNumber;
    /**
     * @type {?}
     * @private
     */
    CalculatorDirective.prototype.preOperator;
    /**
     * @type {?}
     * @private
     */
    CalculatorDirective.prototype.firstInputToken;
    /**
     * @type {?}
     * @private
     */
    CalculatorDirective.prototype.equalToken;
    /**
     * @type {?}
     * @private
     */
    CalculatorDirective.prototype.el;
    /**
     * @type {?}
     * @private
     */
    CalculatorDirective.prototype.rd;
    /**
     * @type {?}
     * @private
     */
    CalculatorDirective.prototype.notifyService;
    /**
     * @type {?}
     * @private
     */
    CalculatorDirective.prototype.cdr;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2FsY3VsYXRvci5kaXJlY3RpdmUuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL3VpLWNhbGN1bGF0b3IvIiwic291cmNlcyI6WyJsaWIvY2FsY3VsYXRvci5kaXJlY3RpdmUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsWUFBWSxFQUFFLFNBQVMsRUFBRSxVQUFVLEVBQTRCLGlCQUFpQixFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzVILE9BQU8sRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxNQUFNLEdBQUcsTUFBTSxhQUFhLENBQUM7QUFDMUQsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBRWxEO0lBNEJFLDZCQUNVLEVBQWMsRUFDZCxFQUFhLEVBQ2IsYUFBNEIsRUFDNUIsR0FBc0I7UUFIdEIsT0FBRSxHQUFGLEVBQUUsQ0FBWTtRQUNkLE9BQUUsR0FBRixFQUFFLENBQVc7UUFDYixrQkFBYSxHQUFiLGFBQWEsQ0FBZTtRQUM1QixRQUFHLEdBQUgsR0FBRyxDQUFtQjtRQWpCeEIsV0FBTSxHQUFHLENBQUMsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxDQUFDLENBQUM7O1FBRTVELG1CQUFjLEdBQVEsRUFBRSxDQUFDOztRQUV6QixxQkFBZ0IsR0FBUSxHQUFHLENBQUM7O1FBRTVCLGNBQVMsR0FBVSxFQUFFLENBQUM7O1FBRXRCLGdCQUFXLEdBQVUsRUFBRSxDQUFDO0lBWWhDLENBQUM7Ozs7SUFFRCxzQ0FBUTs7O0lBQVI7UUFBQSxpQkFnQkM7UUFmQyxJQUFJLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQyxFQUFFLENBQUMsYUFBYSxDQUFDO1FBQ3BDLElBQUksQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxh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bkMsMEJBQUM7Q0FBQSxBQXhSRCxJQXdSQztTQXJSWSxtQkFBbUI7Ozs7OztJQUU5QixxQ0FBNEI7Ozs7O0lBRTVCLHFDQUE0Qjs7Ozs7SUFFNUIsdUNBQThCOzs7OztJQUU5Qix1Q0FBOEI7Ozs7O0lBQzlCLG9DQUEyQjs7Ozs7SUFDM0IscUNBQTRCOzs7OztJQUM1QixzQ0FBNkI7Ozs7O0lBQzdCLHFDQUFvRTs7Ozs7SUFFcEUsNkNBQWlDOzs7OztJQUVqQywrQ0FBb0M7Ozs7O0lBRXBDLHdDQUE4Qjs7Ozs7SUFFOUIsMENBQWdDOzs7OztJQUVoQyw4Q0FBaUM7Ozs7O0lBQ2pDLHlDQUE0Qjs7Ozs7SUFHMUIsaUNBQXNCOzs7OztJQUN0QixpQ0FBcUI7Ozs7O0lBQ3JCLDRDQUFvQzs7Ozs7SUFDcEMsa0NBQThCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRGlyZWN0aXZlLCBIb3N0TGlzdGVuZXIsIFJlbmRlcmVyMiwgRWxlbWVudFJlZiwgT25Jbml0LCBBZnRlclZpZXdDaGVja2VkLCBDaGFuZ2VEZXRlY3RvclJlZiB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBwbHVzLCBtaW51cywgdGltZXMsIGRpdmlkZSwgfSBmcm9tICcuL3ByZWNpc2lvbic7XHJcbmltcG9ydCB7IE5vdGlmeVNlcnZpY2UgfSBmcm9tICdAZmFycmlzL3VpLW5vdGlmeSc7XHJcblxyXG5ARGlyZWN0aXZlKHtcclxuICBzZWxlY3RvcjogJ1tmYXJyaXNDYWxjdWxhdG9yXSdcclxufSlcclxuZXhwb3J0IGNsYXNzIENhbGN1bGF0b3JEaXJlY3RpdmUgaW1wbGVtZW50cyBPbkluaXQsIEFmdGVyVmlld0NoZWNrZWQge1xyXG4gIC8v6K6h566X5Zmo5pys6LqrXHJcbiAgcHJpdmF0ZSBzZWxmRWw6IEhUTUxFbGVtZW50O1xyXG4gIC8v5pON5L2c5q2l6aqk5pi+56S65Yy6XHJcbiAgcHJpdmF0ZSBzdGVwRWw6IEhUTUxFbGVtZW50O1xyXG4gIC8v6K6h566X57uT5p6c5pi+56S65Yy6XHJcbiAgcHJpdmF0ZSByZXN1bHRFbDogSFRNTEVsZW1lbnQ7XHJcbiAgLy/mjInpkq7ljLpcclxuICBwcml2YXRlIHN5bWJvbEVsOiBIVE1MRWxlbWVudDtcclxuICBwcml2YXRlIHByZUVsOiBIVE1MRWxlbWVudDtcclxuICBwcml2YXRlIGxlZnRFbDogSFRNTEVsZW1lbnQ7XHJcbiAgcHJpdmF0ZSByaWdodEVsOiBIVE1MRWxlbWVudDtcclxuICBwcml2YXRlIG51bWJlciA9IFsnMCcsICcxJywgJzInLCAnMycsICc0JywgJzUnLCAnNicsICc3JywgJzgnLCAnOSddO1xyXG4gIC8v5pON5L2c5q2l6aqk57yT5a2YXHJcbiAgcHJpdmF0ZSBzdGVwSW5wdXRDYWNoZTogYW55ID0gJyc7XHJcbiAgLy/nu5PmnpznvJPlrZhcclxuICBwcml2YXRlIHJlc3VsdElucHV0Q2FjaGU6IGFueSA9ICcwJztcclxuICAvL+iusOW9leWKoOWHj+S5mOmZpOeahOaVsOWtl1xyXG4gIHByaXZhdGUgcHJlTnVtYmVyOiBhbnlbXSA9IFtdO1xyXG4gIC8v6K6w5b2V5Yqg5YeP5LmY6Zmk56ym5Y+3XHJcbiAgcHJpdmF0ZSBwcmVPcGVyYXRvcjogYW55W10gPSBbXTtcclxuICAvL+iusOW9leiDveWQpui/veWKoOi/kOeul+aIluiAheaVsOWtl+aYr+i/veWKoOi/mOaYr+imhuebllxyXG4gIHByaXZhdGUgZmlyc3RJbnB1dFRva2VuOiBib29sZWFuO1xyXG4gIHByaXZhdGUgZXF1YWxUb2tlbjogYm9vbGVhbjtcclxuXHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICBwcml2YXRlIGVsOiBFbGVtZW50UmVmLFxyXG4gICAgcHJpdmF0ZSByZDogUmVuZGVyZXIyLFxyXG4gICAgcHJpdmF0ZSBub3RpZnlTZXJ2aWNlOiBOb3RpZnlTZXJ2aWNlLFxyXG4gICAgcHJpdmF0ZSBjZHI6IENoYW5nZURldGVjdG9yUmVmXHJcbiAgKSB7XHJcblxyXG4gIH1cclxuXHJcbiAgbmdPbkluaXQoKSB7XHJcbiAgICB0aGlzLnNlbGZFbCA9IHRoaXMuZWwubmF0aXZlRWxlbWVudDtcclxuICAgIHRoaXMuc3RlcEVsID0gdGhpcy5zZWxmRWwucXVlcnlTZWxlY3RvcignI3N0ZC1wcmUtc3RlcCcpO1xyXG4gICAgdGhpcy5yZXN1bHRFbCA9IHRoaXMuc2VsZkVsLnF1ZXJ5U2VsZWN0b3IoJyNzdGQtc2hvdy1pbnB1dCcpO1xyXG4gICAgdGhpcy5zeW1ib2xFbCA9IHRoaXMuc2VsZkVsLnF1ZXJ5U2VsZWN0b3IoJyNzdGQtbnVtLXN5bWJvbCcpO1xyXG4gICAgdGhpcy5wcmVFbCA9IHRoaXMuc2VsZkVsLnF1ZXJ5U2VsZWN0b3IoJy5wcmUnKTtcclxuICAgIHRoaXMubGVmdEVsID0gdGhpcy5zZWxmRWwucXVlcnlTZWxlY3RvcignLnByZV9sZWZ0Jyk7XHJcbiAgICB0aGlzLnJpZ2h0RWwgPSB0aGlzLnNlbGZFbC5xdWVyeVNlbGVjdG9yKCcucHJlX3JpZ2h0Jyk7XHJcblxyXG4gICAgdGhpcy5yZC5saXN0ZW4odGhpcy5yaWdodEVsLCAnY2xpY2snLCAoKSA9PiB7XHJcbiAgICAgIHRoaXMuc3RlcEVsLnNjcm9sbExlZnQgKz01MDtcclxuICAgIH0pXHJcblxyXG4gICAgdGhpcy5yZC5saXN0ZW4odGhpcy5sZWZ0RWwsICdjbGljaycsICgpID0+IHtcclxuICAgICAgdGhpcy5zdGVwRWwuc2Nyb2xsTGVmdCAtPTUwO1xyXG4gICAgfSlcclxuICB9XHJcblxyXG4gIG5nQWZ0ZXJWaWV3Q2hlY2tlZCgpOiB2b2lkIHtcclxuICAgIHRoaXMuY2FsY3VsYXRlV2lkdGgoKVxyXG4gIH1cclxuXHJcbiAgY2FsY3VsYXRlV2lkdGgoKSB7XHJcbiAgICBpZiAodGhpcy5zdGVwRWwuc2Nyb2xsV2lkdGggPiB0aGlzLnByZUVsLm9mZnNldFdpZHRoKSB7XHJcbiAgICAgIHRoaXMubGVmdEVsLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snO1xyXG4gICAgICB0aGlzLnJpZ2h0RWwuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLmxlZnRFbC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xyXG4gICAgICB0aGlzLnJpZ2h0RWwuc3R5bGUuZGlzcGxheSA9ICdub25lJztcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFxyXG4gICAqIEBwYXJhbSB2YWx1ZSDorr7nva7mraXpqqTmmL7npLrljLrnmoTlhoXlrrlcclxuICAgKi9cclxuICBzZXRTdGVwSW5wdXQodmFsdWU6IGFueSkge1xyXG4gICAgdGhpcy5zdGVwRWwuaW5uZXJIVE1MID0gdmFsdWU7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBcclxuICAgKiBAcGFyYW0gdmFsdWUg6K6+572u57uT5p6c56S65Yy655qE5YaF5a65XHJcbiAgICovXHJcbiAgc2V0UmVzdWx0SW5wdXQodmFsdWU6IGFueSkge1xyXG4gICAgdGhpcy5yZXN1bHRFbC5pbm5lckhUTUwgPSB2YWx1ZTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOatpemqpOaTjeS9nOinhueql+S4re+8jOacgOWQjuaYvuekuueahOaYr+WQpuaYr+aTjeS9nOesplxyXG4gICAqL1xyXG4gIHN0ZXBJbnB1dEVuZElzT3BlcmF0b3IoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5zdGVwSW5wdXRDYWNoZS5sYXN0SW5kZXhPZignKycpICE9PSAtMSB8fFxyXG4gICAgICB0aGlzLnN0ZXBJbnB1dENhY2hlLmxhc3RJbmRleE9mKCctJykgIT09IC0xIHx8XHJcbiAgICAgIHRoaXMuc3RlcElucHV0Q2FjaGUubGFzdEluZGV4T2YoJ8OXJykgIT09IC0xIHx8XHJcbiAgICAgIHRoaXMuc3RlcElucHV0Q2FjaGUubGFzdEluZGV4T2YoJ8O3JykgIT09IC0xO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5Yqg5YeP5LmY6Zmk6L+Q566XXHJcbiAgICogQHBhcmFtIGYg56ys5LiA5Liq5pWw5a2XXHJcbiAgICogQHBhcmFtIHMg56ys5LqM5Liq5pWw5a2XXHJcbiAgICogQHBhcmFtIG8g5pON5L2c56ymXHJcbiAgICovXHJcbiAgY2FsY3VsYXRlKGY6IG51bWJlciwgczogbnVtYmVyLCBvOiBzdHJpbmcpIHtcclxuICAgIGxldCByZXN1bHQ6IG51bWJlcjtcclxuICAgIGYgPSBOdW1iZXIoZik7XHJcbiAgICBzID0gTnVtYmVyKHMpO1xyXG4gICAgc3dpdGNoIChvKSB7XHJcbiAgICAgIGNhc2UgJysnOlxyXG4gICAgICAgIHJlc3VsdCA9IHBsdXMoZiwgcyk7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIGNhc2UgJy0nOlxyXG4gICAgICAgIHJlc3VsdCA9IG1pbnVzKGYsIHMpO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICBjYXNlICfDlyc6XHJcbiAgICAgICAgcmVzdWx0ID0gdGltZXMoZiwgcyk7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIGNhc2UgJ8O3JzpcclxuICAgICAgICByZXN1bHQgPSBkaXZpZGUoZiwgcyk7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gcmVzdWx0O1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogbnVtYmVyQ2xpY2ssZG90Q2xpY2ssb3BlcmF0b3JDbGljayxwbkNsaWNrLGVxdWFsQ2xpY2ssY2VDbGljayxjQ2xpY2ssYmFja0NsaWNr562J77yM5a+55bqU552A54K55Ye755u45YWz55qE5oyJ6ZKu5pON5L2cXHJcbiAgICogQHBhcmFtIHZhbCBcclxuICAgKi9cclxuXHJcbiAgbnVtYmVyQ2xpY2sodmFsOiBhbnkpIHtcclxuICAgIGlmICgodGhpcy5yZXN1bHRJbnB1dENhY2hlLmluZGV4T2YoJzAnKSA9PT0gMCAmJiB0aGlzLnJlc3VsdElucHV0Q2FjaGUuaW5kZXhPZignLicpID09PSAtMSkgfHwgdGhpcy5maXJzdElucHV0VG9rZW4gPT09IHRydWUpIHtcclxuICAgICAgdGhpcy5yZXN1bHRJbnB1dENhY2hlID0gdmFsO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5yZXN1bHRJbnB1dENhY2hlICs9IHZhbDtcclxuICAgIH1cclxuICAgIHRoaXMuZmlyc3RJbnB1dFRva2VuID0gZmFsc2U7XHJcbiAgICB0aGlzLmVxdWFsVG9rZW4gPSBmYWxzZTtcclxuICB9XHJcblxyXG4gIGRvdENsaWNrKHZhbDogYW55KSB7XHJcbiAgICBpZiAodGhpcy5maXJzdElucHV0VG9rZW4gPT09IHRydWUpIHtcclxuICAgICAgdGhpcy5yZXN1bHRJbnB1dENhY2hlID0gJzAnICsgdmFsO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgaWYgKHRoaXMucmVzdWx0SW5wdXRDYWNoZS5pbmRleE9mKCcuJykgPT09IC0xKSB7XHJcbiAgICAgICAgdGhpcy5yZXN1bHRJbnB1dENhY2hlICs9IHZhbDtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgdGhpcy5maXJzdElucHV0VG9rZW4gPSBmYWxzZTtcclxuICAgIHRoaXMuZXF1YWxUb2tlbiA9IGZhbHNlO1xyXG4gIH1cclxuXHJcbiAgcG5DbGljaygpIHtcclxuICAgIGlmICh0aGlzLnJlc3VsdElucHV0Q2FjaGUuaW5kZXhPZignLScpID09PSAtMSAmJiB0aGlzLnJlc3VsdElucHV0Q2FjaGUgIT09ICcwJykge1xyXG4gICAgICB0aGlzLnJlc3VsdElucHV0Q2FjaGUgPSBcIi1cIiArIHRoaXMucmVzdWx0SW5wdXRDYWNoZTtcclxuICAgIH0gZWxzZSBpZiAodGhpcy5yZXN1bHRJbnB1dENhY2hlLmluZGV4T2YoJy0nKSA+IC0xICYmIHRoaXMucmVzdWx0SW5wdXRDYWNoZSAhPT0gJzAnKSB7XHJcbiAgICAgIHRoaXMucmVzdWx0SW5wdXRDYWNoZSA9IHRoaXMucmVzdWx0SW5wdXRDYWNoZS5zdWJzdHJpbmcoMSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBvcGVyYXRvckNsaWNrKHZhbDogYW55KSB7XHJcbiAgICBpZiAodGhpcy5wcmVOdW1iZXIubGVuZ3RoIDwgMiAmJiAodGhpcy5maXJzdElucHV0VG9rZW4gIT09IHRydWUgfHwgdGhpcy5lcXVhbFRva2VuID09PSB0cnVlKSkge1xyXG4gICAgICB0aGlzLnJlc3VsdElucHV0Q2FjaGUgPSBwYXJzZUZsb2F0KHRoaXMucmVzdWx0SW5wdXRDYWNoZSkgKyAnJztcclxuICAgICAgdGhpcy5zdGVwSW5wdXRDYWNoZSA9IHRoaXMuc3RlcElucHV0Q2FjaGUgKyAnICcgKyB0aGlzLnJlc3VsdElucHV0Q2FjaGUgKyAnICcgKyB2YWw7XHJcbiAgICAgIHRoaXMucHJlTnVtYmVyLnB1c2godGhpcy5yZXN1bHRJbnB1dENhY2hlKTtcclxuICAgICAgdGhpcy5wcmVPcGVyYXRvci5wdXNoKHZhbCk7XHJcbiAgICAgIHRoaXMuZmlyc3RJbnB1dFRva2VuID0gdHJ1ZTtcclxuICAgIH0gZWxzZSBpZiAodGhpcy5wcmVOdW1iZXIubGVuZ3RoIDwgMiAmJiB0aGlzLnN0ZXBJbnB1dEVuZElzT3BlcmF0b3IoKSkge1xyXG4gICAgICB0aGlzLnN0ZXBJbnB1dENhY2hlID0gdGhpcy5zdGVwSW5wdXRDYWNoZS5zdWJzdHJpbmcoMCwgdGhpcy5zdGVwSW5wdXRDYWNoZS5sZW5ndGggLSAxKSArICcnICsgdmFsO1xyXG4gICAgICB0aGlzLnByZU9wZXJhdG9yLnB1c2godmFsKTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAodGhpcy5wcmVOdW1iZXIubGVuZ3RoID09PSAyKSB7XHJcbiAgICAgIGNvbnN0IG9wZXJhdG9yID0gdGhpcy5wcmVPcGVyYXRvclt0aGlzLnByZU9wZXJhdG9yLmxlbmd0aCAtIDJdO1xyXG4gICAgICBpZiAodGhpcy5wcmVOdW1iZXJbMV0gPT09ICcwJyAmJiBvcGVyYXRvciA9PT0gJ8O3Jykge1xyXG4gICAgICAgIHRoaXMucHJlTnVtYmVyID0gW107XHJcbiAgICAgICAgdGhpcy5yZXN1bHRJbnB1dENhY2hlID0gJ+mZpOaVsOS4jeiDveS4uumbtic7XHJcbiAgICAgICAgdGhpcy5zdGVwSW5wdXRDYWNoZSA9ICcnO1xyXG4gICAgICAgIHRoaXMuZmlyc3RJbnB1dFRva2VuID0gdHJ1ZTtcclxuICAgICAgICByZXR1cm47XHJcbiAgICAgIH1cclxuICAgICAgY29uc3QgcmVzID0gdGhpcy5jYWxjdWxhdGUodGhpcy5wcmVOdW1iZXJbMF0sIHRoaXMucHJlTnVtYmVyWzFdLCBvcGVyYXRvcik7XHJcbiAgICAgIHRoaXMucHJlTnVtYmVyID0gW107XHJcbiAgICAgIHRoaXMucHJlTnVtYmVyLnB1c2gocmVzKTtcclxuICAgICAgdGhpcy5yZXN1bHRJbnB1dENhY2hlID0gcmVzICsgJyc7XHJcbiAgICAgIHRoaXMuZmlyc3RJbnB1dFRva2VuID0gdHJ1ZTtcclxuICAgIH1cclxuICAgIHRoaXMuY2RyLmRldGVjdENoYW5nZXMoKTtcclxuICB9XHJcblxyXG4gIGVxdWFsQ2xpY2soKSB7XHJcbiAgICBpZiAodGhpcy5wcmVOdW1iZXIubGVuZ3RoID4gMCkge1xyXG4gICAgICBjb25zdCBvcGVyYXRvciA9IHRoaXMucHJlT3BlcmF0b3IucG9wKCk7XHJcbiAgICAgIGlmICh0aGlzLnJlc3VsdElucHV0Q2FjaGUgPT09ICcwJyAmJiBvcGVyYXRvciA9PT0gJ8O3Jykge1xyXG4gICAgICAgIHRoaXMucHJlTnVtYmVyID0gW107XHJcbiAgICAgICAgdGhpcy5yZXN1bHRJbnB1dENhY2hlID0gJ+mZpOaVsOS4jeiDveS4uumbtic7XHJcbiAgICAgICAgdGhpcy5zdGVwSW5wdXRDYWNoZSA9ICcnO1xyXG4gICAgICAgIHRoaXMuZmlyc3RJbnB1dFRva2VuID0gdHJ1ZTtcclxuICAgICAgICB0aGlzLmVxdWFsVG9rZW4gPSB0cnVlO1xyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfVxyXG4gICAgICBjb25zdCByZXMgPSB0aGlzLmNhbGN1bGF0ZSh0aGlzLnByZU51bWJlclswXSwgdGhpcy5yZXN1bHRJbnB1dENhY2hlLCBvcGVyYXRvcik7XHJcbiAgICAgIHRoaXMucHJlTnVtYmVyID0gW107XHJcbiAgICAgIHRoaXMucmVzdWx0SW5wdXRDYWNoZSA9IHJlcyArICcnO1xyXG4gICAgICB0aGlzLnN0ZXBJbnB1dENhY2hlID0gJyc7XHJcbiAgICAgIHRoaXMuZmlyc3RJbnB1dFRva2VuID0gdHJ1ZTtcclxuICAgICAgdGhpcy5lcXVhbFRva2VuID0gdHJ1ZTtcclxuICAgIH1cclxuICAgIHRoaXMuY2RyLmRldGVjdENoYW5nZXMoKTtcclxuICB9XHJcblxyXG4gIGNlQ2xpY2soKSB7XHJcbiAgICB0aGlzLnJlc3VsdElucHV0Q2FjaGUgPSAnMCc7XHJcbiAgfVxyXG5cclxuICBjQ2xpY2soKSB7XHJcbiAgICB0aGlzLnJlc3VsdElucHV0Q2FjaGUgPSAnMCc7XHJcbiAgICB0aGlzLnN0ZXBJbnB1dENhY2hlID0gJyc7XHJcbiAgICB0aGlzLmZpcnN0SW5wdXRUb2tlbiA9IHRydWU7XHJcbiAgICB0aGlzLnByZU51bWJlciA9IFtdO1xyXG4gICAgdGhpcy5wcmVPcGVyYXRvciA9IFtdO1xyXG4gICAgdGhpcy5jZHIuZGV0ZWN0Q2hhbmdlcygpO1xyXG4gIH1cclxuXHJcbiAgYmFja0NsaWNrKCkge1xyXG4gICAgdGhpcy5yZXN1bHRJbnB1dENhY2hlID0gdGhpcy5yZXN1bHRJbnB1dENhY2hlLmxlbmd0aCA+IDEgPyB0aGlzLnJlc3VsdElucHV0Q2FjaGUuc3Vic3RyaW5nKDAsIHRoaXMucmVzdWx0SW5wdXRDYWNoZS5sZW5ndGggLSAxKSA6ICcwJztcclxuICB9XHJcblxyXG4gIEBIb3N0TGlzdGVuZXIoJ2NsaWNrJywgWyckZXZlbnQnXSkgY2xpY2soZXZlbnQ6IGFueSkge1xyXG5cclxuICAgIGlmICghdGhpcy5zeW1ib2xFbC5jb250YWlucyhldmVudC50YXJnZXQpKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCB2YWwgPSBldmVudC50YXJnZXQuaW5uZXJIVE1MO1xyXG5cclxuICAgIC8vIGlmICh0aGlzLnJlc3VsdElucHV0Q2FjaGUubGVuZ3RoID4gMTIgJiYgdGhpcy5udW1iZXIuaW5jbHVkZXModmFsKSAmJiB0aGlzLmZpcnN0SW5wdXRUb2tlbiAhPT0gdHJ1ZSkge1xyXG4gICAgLy8gICB0aGlzLm5vdGlmeVNlcnZpY2Uud2FybmluZyhgJHt0aGlzLnJlc3VsdElucHV0Q2FjaGV96LaK55WMLOivpeWMuuWfn+iHs+WkmuaYvuekujEz5L2N5pWw5a2XYCk7XHJcbiAgICAvLyAgIHJldHVybjtcclxuICAgIC8vIH1cclxuXHJcbiAgICBzd2l0Y2ggKHZhbCkge1xyXG4gICAgICBjYXNlICcwJzpcclxuICAgICAgY2FzZSAnMSc6XHJcbiAgICAgIGNhc2UgJzInOlxyXG4gICAgICBjYXNlICczJzpcclxuICAgICAgY2FzZSAnNCc6XHJcbiAgICAgIGNhc2UgJzUnOlxyXG4gICAgICBjYXNlICc2JzpcclxuICAgICAgY2FzZSAnNyc6XHJcbiAgICAgIGNhc2UgJzgnOlxyXG4gICAgICBjYXNlICc5JzpcclxuICAgICAgICB0aGlzLm51bWJlckNsaWNrKHZhbCk7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIGNhc2UgJy4nOlxyXG4gICAgICAgIHRoaXMuZG90Q2xpY2sodmFsKTtcclxuICAgICAgICBicmVhaztcclxuICAgICAgY2FzZSAnwrEnOlxyXG4gICAgICAgIHRoaXMucG5DbGljaygpO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICBjYXNlICcrJzpcclxuICAgICAgY2FzZSAnLSc6XHJcbiAgICAgIGNhc2UgJ8OXJzpcclxuICAgICAgY2FzZSAnw7cnOlxyXG4gICAgICAgIHRoaXMub3BlcmF0b3JDbGljayh2YWwpO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICBjYXNlICc9JzpcclxuICAgICAgICB0aGlzLmVxdWFsQ2xpY2soKTtcclxuICAgICAgICBicmVhaztcclxuICAgICAgY2FzZSAnQ0UnOlxyXG4gICAgICAgIHRoaXMuY2VDbGljaygpO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICBjYXNlICdDJzpcclxuICAgICAgICB0aGlzLmNDbGljaygpO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICBjYXNlICdCYWNrJzpcclxuICAgICAgICB0aGlzLmJhY2tDbGljaygpO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMuc2V0U3RlcElucHV0KHRoaXMuc3RlcElucHV0Q2FjaGUpXHJcbiAgICB0aGlzLnNldFJlc3VsdElucHV0KHRoaXMucmVzdWx0SW5wdXRDYWNoZSk7XHJcbiAgfVxyXG59XHJcblxyXG4iXX0=
/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, HostBinding, Input, ContentChildren, QueryList, ComponentFactoryResolver, ViewContainerRef, Injector, Renderer2, ElementRef, ViewChild } from '@angular/core';
import { SplitterPaneComponent } from './splitter-pane.component';
import { SplitterBarComponent } from './splitter-bar.component';
var SplitterComponent = /** @class */ (function () {
    function SplitterComponent(componentFactoryResolver, injector, renderer, elementRef) {
        this.componentFactoryResolver = componentFactoryResolver;
        this.injector = injector;
        this.renderer = renderer;
        this.elementRef = elementRef;
        this.splitterCls = true;
        // @HostBinding('class.d-flex') flexCls = true;
        this.orientation = "horizontal";
        this.barComponentRefArray = [];
    }
    /**
     * @return {?}
     */
    SplitterComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
    };
    /**
     * @return {?}
     */
    SplitterComponent.prototype.ngAfterContentInit = /**
     * @return {?}
     */
    function () {
    };
    /**
     * @return {?}
     */
    SplitterComponent.prototype.ngAfterViewInit = /**
     * @return {?}
     */
    function () {
        //使用的是ngResizable，没有使用Bar，此处方法可不执行
        this.hostEl = this.elementRef.nativeElement;
        //  this.initPane();
    };
    /**
     * @return {?}
     */
    SplitterComponent.prototype.initPane = /**
     * @return {?}
     */
    function () {
        var _this = this;
        if (this.pane && this.pane['_results'] && this.pane['_results'].length) {
            /** @type {?} */
            var hostWidth_1 = this.hostEl.offsetWidth;
            /** @type {?} */
            var length_1 = this.pane['_results'].length;
            /** @type {?} */
            var restPane = this.pane['_results'].filter((/**
             * @param {?} item
             * @return {?}
             */
            function (item) {
                return !item._size;
            }));
            /** @type {?} */
            var restLength_1 = restPane.length;
            this.pane['_results'].forEach((/**
             * @param {?} item
             * @param {?} index
             * @return {?}
             */
            function (item, index) {
                item.order = index * 2;
                if (!!item._size) {
                    hostWidth_1 = hostWidth_1 - _this.getElementSize(hostWidth_1, item._size);
                }
            }));
            restPane.forEach((/**
             * @param {?} item
             * @return {?}
             */
            function (item) {
                item.size = hostWidth_1 / restLength_1;
            }));
            if (length_1 > 1) {
                this.createBar(length_1 - 1);
            }
            this.listenPaneSizeChange();
        }
    };
    /**
     * @return {?}
     */
    SplitterComponent.prototype.listenPaneSizeChange = /**
     * @return {?}
     */
    function () {
        var _this = this;
        /** @type {?} */
        var hostWidth = this.hostEl.offsetWidth;
        this.pane['_results'].forEach((/**
         * @param {?} item
         * @param {?} index
         * @return {?}
         */
        function (item, index) {
            item.sizeChange.subscribe((/**
             * @param {?} size
             * @return {?}
             */
            function (size) {
                /** @type {?} */
                var nextIndex = index + 1;
                /** @type {?} */
                var diff = item.el.offsetWidth - size;
                if (_this.pane['_results'][nextIndex]) {
                    /** @type {?} */
                    var nextPaneMin = _this.getElementSize(hostWidth, _this.pane['_results'][nextIndex].min);
                    if (_this.barComponentRefArray[nextIndex]) {
                        // 拖拽向左的最大宽度
                        if (nextPaneMin >= item.el.offsetWidth || nextPaneMin <= 0) {
                            _this.barComponentRefArray[nextIndex].instance.leftMovedMax = _this.pane['_results'][nextIndex].el.offsetWidth + diff;
                        }
                        else {
                            _this.barComponentRefArray[nextIndex].instance.leftMovedMax = _this.pane['_results'][nextIndex].el.offsetWidth + diff - nextPaneMin;
                        }
                    }
                }
            }));
        }));
    };
    // 获取目标元素的size
    // 获取目标元素的size
    /**
     * @param {?} hostWidth
     * @param {?} size
     * @return {?}
     */
    SplitterComponent.prototype.getElementSize = 
    // 获取目标元素的size
    /**
     * @param {?} hostWidth
     * @param {?} size
     * @return {?}
     */
    function (hostWidth, size) {
        /** @type {?} */
        var targetSize;
        if (!size) {
            targetSize = 0;
            return targetSize;
        }
        if (size.indexOf('px') !== -1 || typeof size === 'number') {
            targetSize = parseInt(size);
        }
        else if (size.indexOf('%') !== -1) {
            targetSize = hostWidth * parseInt(size) / 100;
        }
        return targetSize;
    };
    /**
     * @param {?} len
     * @return {?}
     */
    SplitterComponent.prototype.createBar = /**
     * @param {?} len
     * @return {?}
     */
    function (len) {
        /** @type {?} */
        var size;
        /** @type {?} */
        var hostWidth = this.hostEl.offsetWidth;
        var _loop_1 = function (i) {
            /** @type {?} */
            var factory = this_1.componentFactoryResolver.resolveComponentFactory(SplitterBarComponent);
            /** @type {?} */
            var componentRef = this_1.container.createComponent(factory);
            /** @type {?} */
            var prevPane = this_1.pane['_results'][i];
            /** @type {?} */
            var prevPaneOriginWidth = prevPane.el.offsetWidth;
            /** @type {?} */
            var nextPane = this_1.pane['_results'][i + 1];
            /** @type {?} */
            var nextPaneOriginWidth = nextPane.el.offsetWidth;
            /** @type {?} */
            var prePaneMax = this_1.getElementSize(hostWidth, this_1.pane['_results'][i].max);
            /** @type {?} */
            var prePaneMin = this_1.getElementSize(hostWidth, this_1.pane['_results'][i].min);
            // 拖拽向右的最大宽度
            if (prePaneMax <= prevPaneOriginWidth && prePaneMax > 0) {
                componentRef.instance.rightMovedMax = 0;
            }
            else if (prePaneMax >= prevPaneOriginWidth + nextPaneOriginWidth || prePaneMax === 0) {
                componentRef.instance.rightMovedMax = nextPaneOriginWidth;
            }
            else {
                componentRef.instance.rightMovedMax = prePaneMax - prevPaneOriginWidth;
            }
            // 拖拽向左的最大宽度
            if (prePaneMin >= prevPaneOriginWidth || prePaneMin <= 0) {
                componentRef.instance.leftMovedMax = prevPaneOriginWidth;
            }
            else {
                componentRef.instance.leftMovedMax = prevPaneOriginWidth - prePaneMin;
            }
            // 横向拖拽还是纵向拖拽
            if (this_1.orientation === 'horizontal') {
                componentRef.instance.lockAxis = 'y';
            }
            else if (this_1.orientation === 'vertical') {
                componentRef.instance.lockAxis = 'x';
            }
            componentRef.instance.order = 2 * i + 1;
            // 拖拽变化
            componentRef.instance.endOffset.subscribe((/**
             * @param {?} data
             * @return {?}
             */
            function (data) {
                prevPane.size = prevPane.el.offsetWidth + data.x;
                nextPane.size = nextPane.el.offsetWidth - data.x;
                // console.log(prevPanelOriginWidth + data.x, nextPanelOriginWidth - data.x)
            }));
            this_1.barComponentRefArray.push(componentRef);
            componentRef.changeDetectorRef.detectChanges();
        };
        var this_1 = this;
        for (var i = 0; i < len; i++) {
            _loop_1(i);
        }
    };
    SplitterComponent.decorators = [
        { type: Component, args: [{
                    selector: 'farris-splitter',
                    template: "\n    <ng-content></ng-content>\n    <ng-container #container></ng-container>\n  "
                }] }
    ];
    /** @nocollapse */
    SplitterComponent.ctorParameters = function () { return [
        { type: ComponentFactoryResolver },
        { type: Injector },
        { type: Renderer2 },
        { type: ElementRef }
    ]; };
    SplitterComponent.propDecorators = {
        splitterCls: [{ type: HostBinding, args: ['class.f-component-splitter',] }],
        orientation: [{ type: Input }],
        container: [{ type: ViewChild, args: ['container', { read: ViewContainerRef },] }],
        pane: [{ type: ContentChildren, args: [SplitterPaneComponent,] }]
    };
    return SplitterComponent;
}());
export { SplitterComponent };
if (false) {
    /** @type {?} */
    SplitterComponent.prototype.splitterCls;
    /** @type {?} */
    SplitterComponent.prototype.orientation;
    /** @type {?} */
    SplitterComponent.prototype.hostEl;
    /** @type {?} */
    SplitterComponent.prototype.container;
    /** @type {?} */
    SplitterComponent.prototype.pane;
    /** @type {?} */
    SplitterComponent.prototype.barComponentRefArray;
    /**
     * @type {?}
     * @private
     */
    SplitterComponent.prototype.componentFactoryResolver;
    /**
     * @type {?}
     * @private
     */
    SplitterComponent.prototype.injector;
    /**
     * @type {?}
     * @private
     */
    SplitterComponent.prototype.renderer;
    /**
     * @type {?}
     * @private
     */
    SplitterComponent.prototype.elementRef;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3BsaXR0ZXIuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy91aS1zcGxpdHRlci8iLCJzb3VyY2VzIjpbImxpYi9zcGxpdHRlci5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQVUsV0FBVyxFQUFFLEtBQUssRUFBRSxlQUFlLEVBQW9CLFNBQVMsRUFBRSx3QkFBd0IsRUFBRSxnQkFBZ0IsRUFBRSxRQUFRLEVBQWtCLFNBQVMsRUFBRSxVQUFVLEVBQUUsU0FBUyxFQUFpQixNQUFNLGVBQWUsQ0FBQztBQUMzTyxPQUFPLEVBQUUscUJBQXFCLEVBQUUsTUFBTSwyQkFBMkIsQ0FBQztBQUNsRSxPQUFPLEVBQUUsb0JBQW9CLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQztBQUVoRTtJQWtCSSwyQkFDWSx3QkFBa0QsRUFDbEQsUUFBa0IsRUFDbEIsUUFBbUIsRUFDbkIsVUFBc0I7UUFIdEIsNkJBQXdCLEdBQXhCLHdCQUF3QixDQUEwQjtRQUNsRCxhQUFRLEdBQVIsUUFBUSxDQUFVO1FBQ2xCLGFBQVEsR0FBUixRQUFRLENBQVc7UUFDbkIsZUFBVSxHQUFWLFVBQVUsQ0FBWTtRQVpTLGdCQUFXLEdBQUcsSUFBSSxDQUFDOztRQUVyRCxnQkFBVyxHQUFHLFlBQVksQ0FBQztRQUtwQyx5QkFBb0IsR0FBVSxFQUFFLENBQUM7SUFNN0IsQ0FBQzs7OztJQUVMLG9DQUFROzs7SUFBUjtJQUNBLENBQUM7Ozs7SUFFRCw4Q0FBa0I7OztJQUFsQjtJQUVBLENBQUM7Ozs7SUFFRCwyQ0FBZTs7O0lBQWY7UUFDSSxrQ0FBa0M7UUFDOUIsSUFBSSxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDLGFBQWEsQ0FBQztRQUNsRCxvQkFBb0I7SUFDdEIsQ0FBQzs7OztJQUVELG9DQUFROzs7SUFBUjtRQUFBLGlCQXNCQztRQXJCRyxJQUFJLElBQUksQ0FBQyxJQUFJLElBQUksSUFBSSxD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LCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIE9uSW5pdCwgSG9zdEJpbmRpbmcsIElucHV0LCBDb250ZW50Q2hpbGRyZW4sIEFmdGVyQ29udGVudEluaXQsIFF1ZXJ5TGlzdCwgQ29tcG9uZW50RmFjdG9yeVJlc29sdmVyLCBWaWV3Q29udGFpbmVyUmVmLCBJbmplY3RvciwgQXBwbGljYXRpb25SZWYsIFJlbmRlcmVyMiwgRWxlbWVudFJlZiwgVmlld0NoaWxkLCBBZnRlclZpZXdJbml0IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IFNwbGl0dGVyUGFuZUNvbXBvbmVudCB9IGZyb20gJy4vc3BsaXR0ZXItcGFuZS5jb21wb25lbnQnO1xyXG5pbXBvcnQgeyBTcGxpdHRlckJhckNvbXBvbmVudCB9IGZyb20gJy4vc3BsaXR0ZXItYmFyLmNvbXBvbmVudCc7XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICAgIHNlbGVjdG9yOiAnZmFycmlzLXNwbGl0dGVyJyxcclxuICAgIHRlbXBsYXRlOiBgXHJcbiAgICA8bmctY29udGVudD48L25nLWNvbnRlbnQ+XHJcbiAgICA8bmctY29udGFpbmVyICNjb250YWluZXI+PC9uZy1jb250YWluZXI+XHJcbiAgYCxcclxuICAgIHN0eWxlczogW11cclxufSlcclxuZXhwb3J0IGNsYXNzIFNwbGl0dGVyQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBBZnRlckNvbnRlbnRJbml0LCBBZnRlclZpZXdJbml0IHtcclxuXHJcbiAgICBASG9zdEJpbmRpbmcoJ2NsYXNzLmYtY29tcG9uZW50LXNwbGl0dGVyJykgc3BsaXR0ZXJDbHMgPSB0cnVlO1xyXG4gICAgLy8gQEhvc3RCaW5kaW5nKCdjbGFzcy5kLWZsZXgnKSBmbGV4Q2xzID0gdHJ1ZTtcclxuICAgIEBJbnB1dCgpIG9yaWVudGF0aW9uID0gXCJob3Jpem9udGFsXCI7XHJcbiAgICBob3N0RWw6IEhUTUxFbGVtZW50O1xyXG4gICAgQFZpZXdDaGlsZCgnY29udGFpbmVyJywgeyByZWFkOiBWaWV3Q29udGFpbmVyUmVmIH0pIGNvbnRhaW5lcjogVmlld0NvbnRhaW5lclJlZjtcclxuXHJcbiAgICBAQ29udGVudENoaWxkcmVuKFNwbGl0dGVyUGFuZUNvbXBvbmVudCkgcGFuZTogUXVlcnlMaXN0PFNwbGl0dGVyUGFuZUNvbXBvbmVudD47XHJcbiAgICBiYXJDb21wb25lbnRSZWZBcnJheTogYW55W10gPSBbXTtcclxuICAgIGNvbnN0cnVjdG9yKFxyXG4gICAgICAgIHByaXZhdGUgY29tcG9uZW50RmFjdG9yeVJlc29sdmVyOiBDb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIsXHJcbiAgICAgICAgcHJpdmF0ZSBpbmplY3RvcjogSW5qZWN0b3IsXHJcbiAgICAgICAgcHJpdmF0ZSByZW5kZXJlcjogUmVuZGVyZXIyLFxyXG4gICAgICAgIHByaXZhdGUgZWxlbWVudFJlZjogRWxlbWVudFJlZlxyXG4gICAgKSB7IH1cclxuXHJcbiAgICBuZ09uSW5pdCgpIHtcclxuICAgIH1cclxuXHJcbiAgICBuZ0FmdGVyQ29udGVudEluaXQoKSB7XHJcblxyXG4gICAgfVxyXG5cclxuICAgIG5nQWZ0ZXJWaWV3SW5pdCgpIHtcclxuICAgICAgICAvL+S9v+eUqOeahOaYr25nUmVzaXphYmxl77yM5rKh5pyJ5L2/55SoQmFy77yM5q2k5aSE5pa55rOV5Y+v5LiN5omn6KGMXHJcbiAgICAgICAgICAgIHRoaXMuaG9zdEVsID0gdGhpcy5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQ7IFxyXG4gICAgICAvLyAgdGhpcy5pbml0UGFuZSgpO1xyXG4gICAgfVxyXG5cclxuICAgIGluaXRQYW5lKCkge1xyXG4gICAgICAgIGlmICh0aGlzLnBhbmUgJiYgdGhpcy5wYW5lWydfcmVzdWx0cyddICYmIHRoaXMucGFuZVsnX3Jlc3VsdHMnXS5sZW5ndGgpIHtcclxuICAgICAgICAgICAgbGV0IGhvc3RXaWR0aCA9IHRoaXMuaG9zdEVsLm9mZnNldFdpZHRoO1xyXG4gICAgICAgICAgICBjb25zdCBsZW5ndGggPSB0aGlzLnBhbmVbJ19yZXN1bHRzJ10ubGVuZ3RoO1xyXG4gICAgICAgICAgICBjb25zdCByZXN0UGFuZSA9IHRoaXMucGFuZVsnX3Jlc3VsdHMnXS5maWx0ZXIoaXRlbSA9PiB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gIWl0ZW0uX3NpemU7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBjb25zdCByZXN0TGVuZ3RoID0gcmVzdFBhbmUubGVuZ3RoO1xyXG4gICAgICAgICAgICB0aGlzLnBhbmVbJ19yZXN1bHRzJ10uZm9yRWFjaCgoaXRlbSwgaW5kZXgpID0+IHtcclxuICAgICAgICAgICAgICAgIGl0ZW0ub3JkZXIgPSBpbmRleCAqIDI7XHJcbiAgICAgICAgICAgICAgICBpZiAoISFpdGVtLl9zaXplKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaG9zdFdpZHRoID0gaG9zdFdpZHRoIC0gdGhpcy5nZXRFbGVtZW50U2l6ZShob3N0V2lkdGgsIGl0ZW0uX3NpemUpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICByZXN0UGFuZS5mb3JFYWNoKGl0ZW0gPT4ge1xyXG4gICAgICAgICAgICAgICAgaXRlbS5zaXplID0gaG9zdFdpZHRoIC8gcmVzdExlbmd0aDtcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgaWYgKGxlbmd0aCA+IDEpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuY3JlYXRlQmFyKGxlbmd0aCAtIDEpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMubGlzdGVuUGFuZVNpemVDaGFuZ2UoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgbGlzdGVuUGFuZVNpemVDaGFuZ2UoKSB7XHJcbiAgICAgICAgY29uc3QgaG9zdFdpZHRoID0gdGhpcy5ob3N0RWwub2Zmc2V0V2lkdGg7XHJcbiAgICAgICAgdGhpcy5wYW5lWydfcmVzdWx0cyddLmZvckVhY2goKGl0ZW0sIGluZGV4KSA9PiB7XHJcbiAgICAgICAgICAgIGl0ZW0uc2l6ZUNoYW5nZS5zdWJzY3JpYmUoc2l6ZSA9PiB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBuZXh0SW5kZXggPSBpbmRleCArIDE7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBkaWZmID0gaXRlbS5lbC5vZmZzZXRXaWR0aCAtIHNpemU7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5wYW5lWydfcmVzdWx0cyddW25leHRJbmRleF0pIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBuZXh0UGFuZU1pbiA9IHRoaXMuZ2V0RWxlbWVudFNpemUoaG9zdFdpZHRoLCB0aGlzLnBhbmVbJ19yZXN1bHRzJ11bbmV4dEluZGV4XS5taW4pO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmJhckNvbXBvbmVudFJlZkFycmF5W25leHRJbmRleF0pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8g5ouW5ou95ZCR5bem55qE5pyA5aSn5a695bqmXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChuZXh0UGFuZU1pbiA+PSBpdGVtLmVsLm9mZnNldFdpZHRoIHx8IG5leHRQYW5lTWluIDw9IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYmFyQ29tcG9uZW50UmVmQXJyYXlbbmV4dEluZGV4XS5pbnN0YW5jZS5sZWZ0TW92ZWRNYXggPSB0aGlzLnBhbmVbJ19yZXN1bHRzJ11bbmV4dEluZGV4XS5lbC5vZmZzZXRXaWR0aCArIGRpZmY7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmJhckNvbXBvbmVudFJlZkFycmF5W25leHRJbmRleF0uaW5zdGFuY2UubGVmdE1vdmVkTWF4ID0gdGhpcy5wYW5lWydfcmVzdWx0cyddW25leHRJbmRleF0uZWwub2Zmc2V0V2lkdGggKyBkaWZmIC0gbmV4dFBhbmVNaW47XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgfSlcclxuICAgIH1cclxuXHJcblxyXG4gICAgLy8g6I635Y+W55uu5qCH5YWD57Sg55qEc2l6ZVxyXG4gICAgZ2V0RWxlbWVudFNpemUoaG9zdFdpZHRoOiBudW1iZXIsIHNpemU6IGFueSk6IG51bWJlciB7XHJcbiAgICAgICAgbGV0IHRhcmdldFNpemU6IG51bWJlcjtcclxuICAgICAgICBpZiAoIXNpemUpIHtcclxuICAgICAgICAgICAgdGFyZ2V0U2l6ZSA9IDA7XHJcbiAgICAgICAgICAgIHJldHVybiB0YXJnZXRTaXplO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoc2l6ZS5pbmRleE9mKCdweCcpICE9PSAtMSB8fCB0eXBlb2Ygc2l6ZSA9PT0gJ251bWJlcicpIHtcclxuICAgICAgICAgICAgdGFyZ2V0U2l6ZSA9IHBhcnNlSW50KHNpemUpO1xyXG4gICAgICAgIH0gZWxzZSBpZiAoc2l6ZS5pbmRleE9mKCclJykgIT09IC0xKSB7XHJcbiAgICAgICAgICAgIHRhcmdldFNpemUgPSBob3N0V2lkdGggKiBwYXJzZUludChzaXplKSAvIDEwMDtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHRhcmdldFNpemU7XHJcbiAgICB9XHJcblxyXG4gICAgY3JlYXRlQmFyKGxlbjogbnVtYmVyKSB7XHJcbiAgICAgICAgbGV0IHNpemU6IGFueTtcclxuICAgICAgICBjb25zdCBob3N0V2lkdGggPSB0aGlzLmhvc3RFbC5vZmZzZXRXaWR0aDtcclxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGxlbjsgaSsrKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGZhY3RvcnkgPSB0aGlzLmNvbXBvbmVudEZhY3RvcnlSZXNvbHZlci5yZXNvbHZlQ29tcG9uZW50RmFjdG9yeShTcGxpdHRlckJhckNvbXBvbmVudCk7XHJcbiAgICAgICAgICAgIGNvbnN0IGNvbXBvbmVudFJlZiA9IHRoaXMuY29udGFpbmVyLmNyZWF0ZUNvbXBvbmVudChmYWN0b3J5KTtcclxuICAgICAgICAgICAgY29uc3QgcHJldlBhbmUgPSB0aGlzLnBhbmVbJ19yZXN1bHRzJ11baV07XHJcbiAgICAgICAgICAgIGNvbnN0IHByZXZQYW5lT3JpZ2luV2lkdGggPSBwcmV2UGFuZS5lbC5vZmZzZXRXaWR0aDtcclxuICAgICAgICAgICAgY29uc3QgbmV4dFBhbmUgPSB0aGlzLnBhbmVbJ19yZXN1bHRzJ11baSArIDFdO1xyXG4gICAgICAgICAgICBjb25zdCBuZXh0UGFuZU9yaWdpbldpZHRoID0gbmV4dFBhbmUuZWwub2Zmc2V0V2lkdGg7XHJcbiAgICAgICAgICAgIGNvbnN0IHByZVBhbmVNYXggPSB0aGlzLmdldEVsZW1lbnRTaXplKGhvc3RXaWR0aCwgdGhpcy5wYW5lWydfcmVzdWx0cyddW2ldLm1heCk7XHJcbiAgICAgICAgICAgIGNvbnN0IHByZVBhbmVNaW4gPSB0aGlzLmdldEVsZW1lbnRTaXplKGhvc3RXaWR0aCwgdGhpcy5wYW5lWydfcmVzdWx0cyddW2ldLm1pbik7XHJcblxyXG4gICAgICAgICAgICAvLyDmi5bmi73lkJHlj7PnmoTmnIDlpKflrr3luqZcclxuICAgICAgICAgICAgaWYgKHByZVBhbmVNYXggPD0gcHJldlBhbmVPcmlnaW5XaWR0aCAmJiBwcmVQYW5lTWF4ID4gMCkge1xyXG4gICAgICAgICAgICAgICAgY29tcG9uZW50UmVmLmluc3RhbmNlLnJpZ2h0TW92ZWRNYXggPSAwO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKHByZVBhbmVNYXggPj0gcHJldlBhbmVPcmlnaW5XaWR0aCArIG5leHRQYW5lT3JpZ2luV2lkdGggfHwgcHJlUGFuZU1heCA9PT0gMCkge1xyXG4gICAgICAgICAgICAgICAgY29tcG9uZW50UmVmLmluc3RhbmNlLnJpZ2h0TW92ZWRNYXggPSBuZXh0UGFuZU9yaWdpbldpZHRoO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgY29tcG9uZW50UmVmLmluc3RhbmNlLnJpZ2h0TW92ZWRNYXggPSBwcmVQYW5lTWF4IC0gcHJldlBhbmVPcmlnaW5XaWR0aDtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8g5ouW5ou95ZCR5bem55qE5pyA5aSn5a695bqmXHJcbiAgICAgICAgICAgIGlmIChwcmVQYW5lTWluID49IHByZXZQYW5lT3JpZ2luV2lkdGggfHwgcHJlUGFuZU1pbiA8PSAwKSB7XHJcbiAgICAgICAgICAgICAgICBjb21wb25lbnRSZWYuaW5zdGFuY2UubGVmdE1vdmVkTWF4ID0gcHJldlBhbmVPcmlnaW5XaWR0aDtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGNvbXBvbmVudFJlZi5pbnN0YW5jZS5sZWZ0TW92ZWRNYXggPSBwcmV2UGFuZU9yaWdpbldpZHRoIC0gcHJlUGFuZU1pbjtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8g5qiq5ZCR5ouW5ou96L+Y5piv57q15ZCR5ouW5ou9XHJcbiAgICAgICAgICAgIGlmICh0aGlzLm9yaWVudGF0aW9uID09PSAnaG9yaXpvbnRhbCcpIHtcclxuICAgICAgICAgICAgICAgIGNvbXBvbmVudFJlZi5pbnN0YW5jZS5sb2NrQXhpcyA9ICd5JztcclxuICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLm9yaWVudGF0aW9uID09PSAndmVydGljYWwnKSB7XHJcbiAgICAgICAgICAgICAgICBjb21wb25lbnRSZWYuaW5zdGFuY2UubG9ja0F4aXMgPSAneCc7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY29tcG9uZW50UmVmLmluc3RhbmNlLm9yZGVyID0gMiAqIGkgKyAxO1xyXG5cclxuICAgICAgICAgICAgLy8g5ouW5ou95Y+Y5YyWXHJcbiAgICAgICAgICAgIGNvbXBvbmVudFJlZi5pbnN0YW5jZS5lbmRPZmZzZXQuc3Vic2NyaWJlKGRhdGEgPT4ge1xyXG4gICAgICAgICAgICAgICAgcHJldlBhbmUuc2l6ZSA9IHByZXZQYW5lLmVsLm9mZnNldFdpZHRoICsgZGF0YS54O1xyXG4gICAgICAgICAgICAgICAgbmV4dFBhbmUuc2l6ZSA9IG5leHRQYW5lLmVsLm9mZnNldFdpZHRoIC0gZGF0YS54O1xyXG4gICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2cocHJldlBhbmVsT3JpZ2luV2lkdGggKyBkYXRhLngsIG5leHRQYW5lbE9yaWdpbldpZHRoIC0gZGF0YS54KVxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICB0aGlzLmJhckNvbXBvbmVudFJlZkFycmF5LnB1c2goY29tcG9uZW50UmVmKTtcclxuICAgICAgICAgICAgY29tcG9uZW50UmVmLmNoYW5nZURldGVjdG9yUmVmLmRldGVjdENoYW5nZXMoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG59XHJcblxyXG4iXX0=
/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, HostBinding, Input, ContentChildren, QueryList, ComponentFactoryResolver, ViewContainerRef, Injector, Renderer2, ElementRef, ViewChild } from '@angular/core';
import { SplitterPaneComponent } from './splitter-pane.component';
import { SplitterBarComponent } from './splitter-bar.component';
export class SplitterComponent {
    /**
     * @param {?} componentFactoryResolver
     * @param {?} injector
     * @param {?} renderer
     * @param {?} elementRef
     */
    constructor(componentFactoryResolver, injector, renderer, elementRef) {
        this.componentFactoryResolver = componentFactoryResolver;
        this.injector = injector;
        this.renderer = renderer;
        this.elementRef = elementRef;
        this.splitterCls = true;
        // @HostBinding('class.d-flex') flexCls = true;
        this.orientation = "horizontal";
        this.barComponentRefArray = [];
    }
    /**
     * @return {?}
     */
    ngOnInit() {
    }
    /**
     * @return {?}
     */
    ngAfterContentInit() {
    }
    /**
     * @return {?}
     */
    ngAfterViewInit() {
        //使用的是ngResizable，没有使用Bar，此处方法可不执行
        this.hostEl = this.elementRef.nativeElement;
        //  this.initPane();
    }
    /**
     * @return {?}
     */
    initPane() {
        if (this.pane && this.pane['_results'] && this.pane['_results'].length) {
            /** @type {?} */
            let hostWidth = this.hostEl.offsetWidth;
            /** @type {?} */
            const length = this.pane['_results'].length;
            /** @type {?} */
            const restPane = this.pane['_results'].filter((/**
             * @param {?} item
             * @return {?}
             */
            item => {
                return !item._size;
            }));
            /** @type {?} */
            const restLength = restPane.length;
            this.pane['_results'].forEach((/**
             * @param {?} item
             * @param {?} index
             * @return {?}
             */
            (item, index) => {
                item.order = index * 2;
                if (!!item._size) {
                    hostWidth = hostWidth - this.getElementSize(hostWidth, item._size);
                }
            }));
            restPane.forEach((/**
             * @param {?} item
             * @return {?}
             */
            item => {
                item.size = hostWidth / restLength;
            }));
            if (length > 1) {
                this.createBar(length - 1);
            }
            this.listenPaneSizeChange();
        }
    }
    /**
     * @return {?}
     */
    listenPaneSizeChange() {
        /** @type {?} */
        const hostWidth = this.hostEl.offsetWidth;
        this.pane['_results'].forEach((/**
         * @param {?} item
         * @param {?} index
         * @return {?}
         */
        (item, index) => {
            item.sizeChange.subscribe((/**
             * @param {?} size
             * @return {?}
             */
            size => {
                /** @type {?} */
                const nextIndex = index + 1;
                /** @type {?} */
                const diff = item.el.offsetWidth - size;
                if (this.pane['_results'][nextIndex]) {
                    /** @type {?} */
                    const nextPaneMin = this.getElementSize(hostWidth, this.pane['_results'][nextIndex].min);
                    if (this.barComponentRefArray[nextIndex]) {
                        // 拖拽向左的最大宽度
                        if (nextPaneMin >= item.el.offsetWidth || nextPaneMin <= 0) {
                            this.barComponentRefArray[nextIndex].instance.leftMovedMax = this.pane['_results'][nextIndex].el.offsetWidth + diff;
                        }
                        else {
                            this.barComponentRefArray[nextIndex].instance.leftMovedMax = this.pane['_results'][nextIndex].el.offsetWidth + diff - nextPaneMin;
                        }
                    }
                }
            }));
        }));
    }
    // 获取目标元素的size
    /**
     * @param {?} hostWidth
     * @param {?} size
     * @return {?}
     */
    getElementSize(hostWidth, size) {
        /** @type {?} */
        let targetSize;
        if (!size) {
            targetSize = 0;
            return targetSize;
        }
        if (size.indexOf('px') !== -1 || typeof size === 'number') {
            targetSize = parseInt(size);
        }
        else if (size.indexOf('%') !== -1) {
            targetSize = hostWidth * parseInt(size) / 100;
        }
        return targetSize;
    }
    /**
     * @param {?} len
     * @return {?}
     */
    createBar(len) {
        /** @type {?} */
        let size;
        /** @type {?} */
        const hostWidth = this.hostEl.offsetWidth;
        for (let i = 0; i < len; i++) {
            /** @type {?} */
            const factory = this.componentFactoryResolver.resolveComponentFactory(SplitterBarComponent);
            /** @type {?} */
            const componentRef = this.container.createComponent(factory);
            /** @type {?} */
            const prevPane = this.pane['_results'][i];
            /** @type {?} */
            const prevPaneOriginWidth = prevPane.el.offsetWidth;
            /** @type {?} */
            const nextPane = this.pane['_results'][i + 1];
            /** @type {?} */
            const nextPaneOriginWidth = nextPane.el.offsetWidth;
            /** @type {?} */
            const prePaneMax = this.getElementSize(hostWidth, this.pane['_results'][i].max);
            /** @type {?} */
            const prePaneMin = this.getElementSize(hostWidth, this.pane['_results'][i].min);
            // 拖拽向右的最大宽度
            if (prePaneMax <= prevPaneOriginWidth && prePaneMax > 0) {
                componentRef.instance.rightMovedMax = 0;
            }
            else if (prePaneMax >= prevPaneOriginWidth + nextPaneOriginWidth || prePaneMax === 0) {
                componentRef.instance.rightMovedMax = nextPaneOriginWidth;
            }
            else {
                componentRef.instance.rightMovedMax = prePaneMax - prevPaneOriginWidth;
            }
            // 拖拽向左的最大宽度
            if (prePaneMin >= prevPaneOriginWidth || prePaneMin <= 0) {
                componentRef.instance.leftMovedMax = prevPaneOriginWidth;
            }
            else {
                componentRef.instance.leftMovedMax = prevPaneOriginWidth - prePaneMin;
            }
            // 横向拖拽还是纵向拖拽
            if (this.orientation === 'horizontal') {
                componentRef.instance.lockAxis = 'y';
            }
            else if (this.orientation === 'vertical') {
                componentRef.instance.lockAxis = 'x';
            }
            componentRef.instance.order = 2 * i + 1;
            // 拖拽变化
            componentRef.instance.endOffset.subscribe((/**
             * @param {?} data
             * @return {?}
             */
            data => {
                prevPane.size = prevPane.el.offsetWidth + data.x;
                nextPane.size = nextPane.el.offsetWidth - data.x;
                // console.log(prevPanelOriginWidth + data.x, nextPanelOriginWidth - data.x)
            }));
            this.barComponentRefArray.push(componentRef);
            componentRef.changeDetectorRef.detectChanges();
        }
    }
}
SplitterComponent.decorators = [
    { type: Component, args: [{
                selector: 'farris-splitter',
                template: `
    <ng-content></ng-content>
    <ng-container #container></ng-container>
  `
            }] }
];
/** @nocollapse */
SplitterComponent.ctorParameters = () => [
    { type: ComponentFactoryResolver },
    { type: Injector },
    { type: Renderer2 },
    { type: ElementRef }
];
SplitterComponent.propDecorators = {
    splitterCls: [{ type: HostBinding, args: ['class.f-component-splitter',] }],
    orientation: [{ type: Input }],
    container: [{ type: ViewChild, args: ['container', { read: ViewContainerRef },] }],
    pane: [{ type: ContentChildren, args: [SplitterPaneComponent,] }]
};
if (false) {
    /** @type {?} */
    SplitterComponent.prototype.splitterCls;
    /** @type {?} */
    SplitterComponent.prototype.orientation;
    /** @type {?} */
    SplitterComponent.prototype.hostEl;
    /** @type {?} */
    SplitterComponent.prototype.container;
    /** @type {?} */
    SplitterComponent.prototype.pane;
    /** @type {?} */
    SplitterComponent.prototype.barComponentRefArray;
    /**
     * @type {?}
     * @private
     */
    SplitterComponent.prototype.componentFactoryResolver;
    /**
     * @type {?}
     * @private
     */
    SplitterComponent.prototype.injector;
    /**
     * @type {?}
     * @private
     */
    SplitterComponent.prototype.renderer;
    /**
     * @type {?}
     * @private
     */
    SplitterComponent.prototype.elementRef;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3BsaXR0ZXIuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy91aS1zcGxpdHRlci8iLCJzb3VyY2VzIjpbImxpYi9zcGxpdHRlci5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQVUsV0FBVyxFQUFFLEtBQUssRUFBRSxlQUFlLEVBQW9CLFNBQVMsRUFBRSx3QkFBd0IsRUFBRSxnQkFBZ0IsRUFBRSxRQUFRLEVBQWtCLFNBQVMsRUFBRSxVQUFVLEVBQUUsU0FBUyxFQUFpQixNQUFNLGVBQWUsQ0FBQztBQUMzTyxPQUFPLEVBQUUscUJBQXFCLEVBQUUsTUFBTSwyQkFBMkIsQ0FBQztBQUNsRSxPQUFPLEVBQUUsb0JBQW9CLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQztBQVVoRSxNQUFNLE9BQU8saUJBQWlCOzs7Ozs7O0lBVTFCLFlBQ1ksd0JBQWtELEVBQ2xELFFBQWtCLEVBQ2xCLFFBQW1CLEVBQ25CLFVBQXNCO1FBSHRCLDZCQUF3QixHQUF4Qix3QkFBd0IsQ0FBMEI7UUFDbEQsYUFBUSxHQUFSLFFBQVEsQ0FBVTtRQUNsQixhQUFRLEdBQVIsUUFBUSxDQUFXO1FBQ25CLGVBQVUsR0FBVixVQUFVLENBQVk7UUFaUyxnQkFBVyxHQUFHLElBQUksQ0FBQzs7UUFFckQsZ0JBQVcsR0FBRyxZQUFZLENBQUM7UUFLcEMseUJBQW9CLEdBQVUsRUFBRSxDQUFDO0lBTTdCLENBQUM7Ozs7SUFFTCxRQUFRO0lBQ1IsQ0FBQzs7OztJQUVELGtCQUFrQjtJQUVsQixDQUFDOzs7O0lBRUQsZUFBZTtRQUNYLGtDQUFrQztRQUM5QixJQUFJLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQyxVQUFVLENBQUMsYUFBYSxDQUFDO1FBQ2xELG9CQUFvQjtJQUN0QixDQUFDOzs7O0lBRUQsUUFBUTtRQUNKLElBQUksSUFBSSxDQUFDLElBQUksSUFBSSxJQUFJLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxJQUFJLElBQUksQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUMsTUFBTSxFQUFFOztnQkFDaEUsU0FBUyxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsV0FBVzs7a0JBQ2pDLE1BQU0sR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDLE1BQU07O2tCQUNyQyxRQUFRLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQyxNQUFNOzs7O1lBQUMsSUFBSSxDQUFDLEVBQUU7Z0JBQ2pELE9BQU8sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDO1lBQ3ZCLENBQUMsRUFBQzs7a0JBQ0ksVUFBVSxHQUFHLFFBQVEsQ0FBQyxNQUFNO1lBQ2xDLElBQUksQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUMsT0FBTzs7Ozs7WUFBQyxDQUFDLElBQUksRUFBRSxLQUFLLEVBQUUsRUFBRTtnQkFDMUMsSUFBSSxDQUFDLEtBQUssR0FBRyxLQUFLLEdBQUcsQ0FBQyxDQUFDO2dCQUN2QixJQUFJLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxFQUFFO29CQUNkLFNBQVMsR0FBRyxTQUFTLEdBQUcsSUFBSSxDQUFDLGNBQWMsQ0FBQyxTQUFTLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO2lCQUN0RTtZQUNMLENBQUMsRUFBQyxDQUFBO1lBQ0YsUUFBUSxDQUFDLE9BQU87Ozs7WUFBQyxJQUFJLENBQUMsRUFBRTtnQkFDcEIsSUFBSSxDQUFDLElBQUksR0FBRyxTQUFTLEdBQUcsVUFBVSxDQUFDO1lBQ3ZDLENBQUMsRUFBQyxDQUFBO1lBQ0YsSUFBSSxNQUFNLEdBQUcsQ0FBQyxFQUFFO2dCQUNaLElBQUksQ0FBQyxTQUFTLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDO2FBQzlCO1lBQ0QsSUFBSSxDQUFDLG9CQUFvQixFQUFFLENBQUM7U0FDL0I7SUFDTCxDQUFDOzs7O0lBRUQsb0JBQW9COztjQUNWLFNBQVMsR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLFdBQVc7UUFDekMsSUFBSSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQyxPQUFPOzs7OztRQUFDLENBQUMsSUFBSSxFQUFFLEtBQUssRUFBRSxFQUFFO1lBQzFDLElBQUksQ0FBQyxVQUFVLENBQUMsU0FBUzs7OztZQUFDLElBQUksQ0FBQyxFQUFFOztzQkFDdkIsU0FBUyxHQUFHLEtBQUssR0FBRyxDQUFDOztzQkFDckIsSUFBSSxHQUFHLElBQUksQ0FBQyxFQUFFLENBQUMsV0FBVyxHQUFHLElBQUk7Z0JBQ3ZDLElBQUksSUFBSSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQyxTQUFTLENBQUMsRUFBRTs7MEJBQzVCLFdBQVcsR0FBRyxJQUFJLENBQUMsY0FBYyxDQUFDLFNBQVMsRUFBRSxJQUFJLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxDQUFDLEdBQUcsQ0FBQztvQkFDeEYsSUFBSSxJQUFJLENBQUMsb0JBQW9CLENBQUMsU0FBUyxDQUFDLEVBQUU7d0JBQ3RDLFlBQVk7d0JBQ1osSUFBSSxXQUFXLElBQUksSUFBSSxDQUFDLEVBQUUsQ0FBQyxXQUFXLElBQUksV0FBVyxJQUFJLENBQUMsRUFBRTs0QkFDeEQsSUFBSSxDQUFDLG9CQUFvQixDQUFDLFNBQVMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxZQUFZLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQyxTQUFTLENBQUMsQ0FBQyxFQUFFLENBQUMsV0FBVyxHQUFHLElBQUksQ0FBQzt5QkFDdkg7NkJBQU07NEJBQ0gsSUFBSSxDQUFDLG9CQUFvQixDQUFDLFNBQVMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxZQUFZLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQyxTQUFTLENBQUMsQ0FBQyxFQUFFLENBQUMsV0FBVyxHQUFHLElBQUksR0FBRyxXQUFXLENBQUM7eUJBQ3JJO3FCQUNKO2lCQUNKO1lBQ0wsQ0FBQyxFQUFDLENBQUE7UUFDTixDQUFDLEVBQUMsQ0FBQTtJQUNOLENBQUM7Ozs7Ozs7SUFJRCxjQUFjLENBQUMsU0FBaUIsRUFBRSxJQUFTOztZQUNuQyxVQUFrQjtRQUN0QixJQUFJLENBQUMsSUFBSSxFQUFFO1lBQ1AsVUFBVSxHQUFHLENBQUMsQ0FBQztZQUNmLE9BQU8sVUFBVSxDQUFDO1NBQ3JCO1FBQ0QsSUFBSSxJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxJQUFJLE9BQU8sSUFBSSxLQUFLLFFBQVEsRUFBRTtZQUN2RCxVQUFVLEdBQUcsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDO1NBQy9CO2FBQU0sSUFBSSxJQUFJLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFO1lBQ2pDLFVBQVUsR0FBRyxTQUFTLEdBQUcsUUFBUSxDQUFDLElBQUksQ0FBQyxHQUFHLEdBQUcsQ0FBQztTQUNqRDtRQUNELE9BQU8sVUFBVSxDQUFDO0lBQ3RCLENBQUM7Ozs7O0lBRUQsU0FBUyxDQUFDLEdBQVc7O1lBQ2IsSUFBUzs7Y0FDUCxTQUFTLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxXQUFXO1FBQ3pDLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxHQUFHLEVBQUUsQ0FBQyxFQUFFLEVBQUU7O2tCQUNwQixPQUFPLEdBQUcsSUFBSSxDQUFDLHdCQUF3QixDQUFDLHVCQUF1QixDQUFDLG9CQUFvQixDQUFDOztrQkFDckYsWUFBWSxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsZUFBZSxDQUFDLE9BQU8sQ0FBQzs7a0JBQ3RELFFBQVEsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQzs7a0JBQ25DLG1CQUFtQixHQUFHLFFBQVEsQ0FBQyxFQUFFLENBQUMsV0FBVzs7a0JBQzdDLFFBQVEsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUM7O2tCQUN2QyxtQkFBbUIsR0FBRyxRQUFRLENBQUMsRUFBRSxDQUFDLFdBQVc7O2tCQUM3QyxVQUFVLEdBQUcsSUFBSSxDQUFDLGNBQWMsQ0FBQyxTQUFTLEVBQUUsSUFBSSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUM7O2tCQUN6RSxVQUFVLEdBQUcsSUFBSSxDQUFDLGNBQWMsQ0FBQyxTQUFTLEVBQUUsSUFBSSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUM7WUFFL0UsWUFBWTtZQUNaLElBQUksVUFBVSxJQUFJLG1CQUFtQixJQUFJLFVBQVUsR0FBRyxDQUFDLEVBQUU7Z0JBQ3JELFlBQVksQ0FBQyxRQUFRLENBQUMsYUFBYSxHQUFHLENBQUMsQ0FBQzthQUMzQztpQkFBTSxJQUFJLFVBQVUsSUFBSSxtQkFBbUIsR0FBRyxtQkFBbUIsSUFBSSxVQUFVLEtBQUssQ0FBQyxFQUFFO2dCQUNwRixZQUFZLENBQUMsUUFBUSxDQUFDLGFBQWEsR0FBRyxtQkFBbUIsQ0FBQzthQUM3RDtpQkFBTTtnQkFDSCxZQUFZLENBQUMsUUFBUSxDQUFDLGFBQWEsR0FBRyxVQUFVLEdBQUcsbUJBQW1CLENBQUM7YUFDMUU7WUFFRCxZQUFZO1lBQ1osSUFBSSxVQUFVLElBQUksbUJBQW1CLElBQUksVUFBVSxJQUFJLENBQUMsRUFBRTtnQkFDdEQsWUFBWSxDQUFDLFFBQVEsQ0FBQyxZQUFZLEdBQUcsbUJBQW1CLENBQUM7YUFDNUQ7aUJBQU07Z0JBQ0gsWUFBWSxDQUFDLFFBQVEsQ0FBQyxZQUFZLEdBQUcsbUJBQW1CLEdBQUcsVUFBVSxDQUFDO2FBQ3pFO1lBRUQsYUFBYTtZQUNiLElBQUksSUFBSSxDQUFDLFdBQVcsS0FBSyxZQUFZLEVBQUU7Z0JBQ25DLFlBQVksQ0FBQyxRQUFRLENBQUMsUUFBUSxHQUFHLEdBQUcsQ0FBQzthQUN4QztpQkFBTSxJQUFJLElBQUksQ0FBQyxXQUFXLEtBQUssVUFBVSxFQUFFO2dCQUN4QyxZQUFZLENBQUMsUUFBUSxDQUFDLFFBQVEsR0FBRyxHQUFHLENBQUM7YUFDeEM7WUFDRCxZQUFZLENBQUMsUUFBUSxDQUFDLEtBQUssR0FBRyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUV4QyxPQUFPO1lBQ1AsWUFBWSxDQUFDLFFBQVEsQ0FBQyxTQUFTLENBQUMsU0FBUzs7OztZQUFDLElBQUksQ0FBQyxFQUFFO2dCQUM3QyxRQUFRLENBQUMsSUFBSSxHQUFHLFFBQVEsQ0FBQyxFQUFFLENBQUMsV0FBVyxHQUFHLElBQUksQ0FBQyxDQUFDLENBQUM7Z0JBQ2pELFFBQVEsQ0FBQyxJQUFJLEdBQUcsUUFBUSxDQUFDLEVBQUUsQ0FBQyxXQUFXLEdBQUcsSUFBSSxDQUFDLENBQUMsQ0FBQztnQkFDakQsNEVBQTRFO1lBQ2hGLENBQUMsRUFBQyxDQUFBO1lBQ0YsSUFBSSxDQUFDLG9CQUFvQixDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQztZQUM3QyxZQUFZLENBQUMsaUJBQWlCLENBQUMsYUFBYSxFQUFFLENBQUM7U0FDbEQ7SUFDTCxDQUFDOzs7WUFqSkosU0FBUyxTQUFDO2dCQUNQLFFBQVEsRUFBRSxpQkFBaUI7Z0JBQzNCLFFBQVEsRUFBRTs7O0dBR1g7YUFFRjs7OztZQVg2Rix3QkFBd0I7WUFBb0IsUUFBUTtZQUFrQixTQUFTO1lBQUUsVUFBVTs7OzBCQWNwTCxXQUFXLFNBQUMsNEJBQTRCOzBCQUV4QyxLQUFLO3dCQUVMLFNBQVMsU0FBQyxXQUFXLEVBQUUsRUFBRSxJQUFJLEVBQUUsZ0JBQWdCLEVBQUU7bUJBRWpELGVBQWUsU0FBQyxxQkFBcUI7Ozs7SUFOdEMsd0NBQThEOztJQUU5RCx3Q0FBb0M7O0lBQ3BDLG1DQUFvQjs7SUFDcEIsc0NBQWdGOztJQUVoRixpQ0FBK0U7O0lBQy9FLGlEQUFpQzs7Ozs7SUFFN0IscURBQTBEOzs7OztJQUMxRCxxQ0FBMEI7Ozs7O0lBQzFCLHFDQUEyQjs7Ozs7SUFDM0IsdUNBQThCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBPbkluaXQsIEhvc3RCaW5kaW5nLCBJbnB1dCwgQ29udGVudENoaWxkcmVuLCBBZnRlckNvbnRlbnRJbml0LCBRdWVyeUxpc3QsIENvbXBvbmVudEZhY3RvcnlSZXNvbHZlciwgVmlld0NvbnRhaW5lclJlZiwgSW5qZWN0b3IsIEFwcGxpY2F0aW9uUmVmLCBSZW5kZXJlcjIsIEVsZW1lbnRSZWYsIFZpZXdDaGlsZCwgQWZ0ZXJWaWV3SW5pdCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBTcGxpdHRlclBhbmVDb21wb25lbnQgfSBmcm9tICcuL3NwbGl0dGVyLXBhbmUuY29tcG9uZW50JztcclxuaW1wb3J0IHsgU3BsaXR0ZXJCYXJDb21wb25lbnQgfSBmcm9tICcuL3NwbGl0dGVyLWJhci5jb21wb25lbnQnO1xyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgICBzZWxlY3RvcjogJ2ZhcnJpcy1zcGxpdHRlcicsXHJcbiAgICB0ZW1wbGF0ZTogYFxyXG4gICAgPG5nLWNvbnRlbnQ+PC9uZy1jb250ZW50PlxyXG4gICAgPG5nLWNvbnRhaW5lciAjY29udGFpbmVyPjwvbmctY29udGFpbmVyPlxyXG4gIGAsXHJcbiAgICBzdHlsZXM6IFtdXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBTcGxpdHRlckNvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgQWZ0ZXJDb250ZW50SW5pdCwgQWZ0ZXJWaWV3SW5pdCB7XHJcblxyXG4gICAgQEhvc3RCaW5kaW5nKCdjbGFzcy5mLWNvbXBvbmVudC1zcGxpdHRlcicpIHNwbGl0dGVyQ2xzID0gdHJ1ZTtcclxuICAgIC8vIEBIb3N0QmluZGluZygnY2xhc3MuZC1mbGV4JykgZmxleENscyA9IHRydWU7XHJcbiAgICBASW5wdXQoKSBvcmllbnRhdGlvbiA9IFwiaG9yaXpvbnRhbFwiO1xyXG4gICAgaG9zdEVsOiBIVE1MRWxlbWVudDtcclxuICAgIEBWaWV3Q2hpbGQoJ2NvbnRhaW5lcicsIHsgcmVhZDogVmlld0NvbnRhaW5lclJlZiB9KSBjb250YWluZXI6IFZpZXdDb250YWluZXJSZWY7XHJcblxyXG4gICAgQENvbnRlbnRDaGlsZHJlbihTcGxpdHRlclBhbmVDb21wb25lbnQpIHBhbmU6IFF1ZXJ5TGlzdDxTcGxpdHRlclBhbmVDb21wb25lbnQ+O1xyXG4gICAgYmFyQ29tcG9uZW50UmVmQXJyYXk6IGFueVtdID0gW107XHJcbiAgICBjb25zdHJ1Y3RvcihcclxuICAgICAgICBwcml2YXRlIGNvbXBvbmVudEZhY3RvcnlSZXNvbHZlcjogQ29tcG9uZW50RmFjdG9yeVJlc29sdmVyLFxyXG4gICAgICAgIHByaXZhdGUgaW5qZWN0b3I6IEluamVjdG9yLFxyXG4gICAgICAgIHByaXZhdGUgcmVuZGVyZXI6IFJlbmRlcmVyMixcclxuICAgICAgICBwcml2YXRlIGVsZW1lbnRSZWY6IEVsZW1lbnRSZWZcclxuICAgICkgeyB9XHJcblxyXG4gICAgbmdPbkluaXQoKSB7XHJcbiAgICB9XHJcblxyXG4gICAgbmdBZnRlckNvbnRlbnRJbml0KCkge1xyXG5cclxuICAgIH1cclxuXHJcbiAgICBuZ0FmdGVyVmlld0luaXQoKSB7XHJcbiAgICAgICAgLy/kvb/nlKjnmoTmmK9uZ1Jlc2l6YWJsZe+8jOayoeacieS9v+eUqEJhcu+8jOatpOWkhOaWueazleWPr+S4jeaJp+ihjFxyXG4gICAgICAgICAgICB0aGlzLmhvc3RFbCA9IHRoaXMuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50OyBcclxuICAgICAgLy8gIHRoaXMuaW5pdFBhbmUoKTtcclxuICAgIH1cclxuXHJcbiAgICBpbml0UGFuZSgpIHtcclxuICAgICAgICBpZiAodGhpcy5wYW5lICYmIHRoaXMucGFuZVsnX3Jlc3VsdHMnXSAmJiB0aGlzLnBhbmVbJ19yZXN1bHRzJ10ubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIGxldCBob3N0V2lkdGggPSB0aGlzLmhvc3RFbC5vZmZzZXRXaWR0aDtcclxuICAgICAgICAgICAgY29uc3QgbGVuZ3RoID0gdGhpcy5wYW5lWydfcmVzdWx0cyddLmxlbmd0aDtcclxuICAgICAgICAgICAgY29uc3QgcmVzdFBhbmUgPSB0aGlzLnBhbmVbJ19yZXN1bHRzJ10uZmlsdGVyKGl0ZW0gPT4ge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuICFpdGVtLl9zaXplO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgY29uc3QgcmVzdExlbmd0aCA9IHJlc3RQYW5lLmxlbmd0aDtcclxuICAgICAgICAgICAgdGhpcy5wYW5lWydfcmVzdWx0cyddLmZvckVhY2goKGl0ZW0sIGluZGV4KSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpdGVtLm9yZGVyID0gaW5kZXggKiAyO1xyXG4gICAgICAgICAgICAgICAgaWYgKCEhaXRlbS5fc2l6ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGhvc3RXaWR0aCA9IGhvc3RXaWR0aCAtIHRoaXMuZ2V0RWxlbWVudFNpemUoaG9zdFdpZHRoLCBpdGVtLl9zaXplKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgcmVzdFBhbmUuZm9yRWFjaChpdGVtID0+IHtcclxuICAgICAgICAgICAgICAgIGl0ZW0uc2l6ZSA9IGhvc3RXaWR0aCAvIHJlc3RMZW5ndGg7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIGlmIChsZW5ndGggPiAxKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNyZWF0ZUJhcihsZW5ndGggLSAxKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLmxpc3RlblBhbmVTaXplQ2hhbmdlKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGxpc3RlblBhbmVTaXplQ2hhbmdlKCkge1xyXG4gICAgICAgIGNvbnN0IGhvc3RXaWR0aCA9IHRoaXMuaG9zdEVsLm9mZnNldFdpZHRoO1xyXG4gICAgICAgIHRoaXMucGFuZVsnX3Jlc3VsdHMnXS5mb3JFYWNoKChpdGVtLCBpbmRleCkgPT4ge1xyXG4gICAgICAgICAgICBpdGVtLnNpemVDaGFuZ2Uuc3Vic2NyaWJlKHNpemUgPT4ge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgbmV4dEluZGV4ID0gaW5kZXggKyAxO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgZGlmZiA9IGl0ZW0uZWwub2Zmc2V0V2lkdGggLSBzaXplO1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMucGFuZVsnX3Jlc3VsdHMnXVtuZXh0SW5kZXhdKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgbmV4dFBhbmVNaW4gPSB0aGlzLmdldEVsZW1lbnRTaXplKGhvc3RXaWR0aCwgdGhpcy5wYW5lWydfcmVzdWx0cyddW25leHRJbmRleF0ubWluKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5iYXJDb21wb25lbnRSZWZBcnJheVtuZXh0SW5kZXhdKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIOaLluaLveWQkeW3pueahOacgOWkp+WuveW6plxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAobmV4dFBhbmVNaW4gPj0gaXRlbS5lbC5vZmZzZXRXaWR0aCB8fCBuZXh0UGFuZU1pbiA8PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmJhckNvbXBvbmVudFJlZkFycmF5W25leHRJbmRleF0uaW5zdGFuY2UubGVmdE1vdmVkTWF4ID0gdGhpcy5wYW5lWydfcmVzdWx0cyddW25leHRJbmRleF0uZWwub2Zmc2V0V2lkdGggKyBkaWZmO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5iYXJDb21wb25lbnRSZWZBcnJheVtuZXh0SW5kZXhdLmluc3RhbmNlLmxlZnRNb3ZlZE1heCA9IHRoaXMucGFuZVsnX3Jlc3VsdHMnXVtuZXh0SW5kZXhdLmVsLm9mZnNldFdpZHRoICsgZGlmZiAtIG5leHRQYW5lTWluO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgIH0pXHJcbiAgICB9XHJcblxyXG5cclxuICAgIC8vIOiOt+WPluebruagh+WFg+e0oOeahHNpemVcclxuICAgIGdldEVsZW1lbnRTaXplKGhvc3RXaWR0aDogbnVtYmVyLCBzaXplOiBhbnkpOiBudW1iZXIge1xyXG4gICAgICAgIGxldCB0YXJnZXRTaXplOiBudW1iZXI7XHJcbiAgICAgICAgaWYgKCFzaXplKSB7XHJcbiAgICAgICAgICAgIHRhcmdldFNpemUgPSAwO1xyXG4gICAgICAgICAgICByZXR1cm4gdGFyZ2V0U2l6ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHNpemUuaW5kZXhPZigncHgnKSAhPT0gLTEgfHwgdHlwZW9mIHNpemUgPT09ICdudW1iZXInKSB7XHJcbiAgICAgICAgICAgIHRhcmdldFNpemUgPSBwYXJzZUludChzaXplKTtcclxuICAgICAgICB9IGVsc2UgaWYgKHNpemUuaW5kZXhPZignJScpICE9PSAtMSkge1xyXG4gICAgICAgICAgICB0YXJnZXRTaXplID0gaG9zdFdpZHRoICogcGFyc2VJbnQoc2l6ZSkgLyAxMDA7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB0YXJnZXRTaXplO1xyXG4gICAgfVxyXG5cclxuICAgIGNyZWF0ZUJhcihsZW46IG51bWJlcikge1xyXG4gICAgICAgIGxldCBzaXplOiBhbnk7XHJcbiAgICAgICAgY29uc3QgaG9zdFdpZHRoID0gdGhpcy5ob3N0RWwub2Zmc2V0V2lkdGg7XHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsZW47IGkrKykge1xyXG4gICAgICAgICAgICBjb25zdCBmYWN0b3J5ID0gdGhpcy5jb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIucmVzb2x2ZUNvbXBvbmVudEZhY3RvcnkoU3BsaXR0ZXJCYXJDb21wb25lbnQpO1xyXG4gICAgICAgICAgICBjb25zdCBjb21wb25lbnRSZWYgPSB0aGlzLmNvbnRhaW5lci5jcmVhdGVDb21wb25lbnQoZmFjdG9yeSk7XHJcbiAgICAgICAgICAgIGNvbnN0IHByZXZQYW5lID0gdGhpcy5wYW5lWydfcmVzdWx0cyddW2ldO1xyXG4gICAgICAgICAgICBjb25zdCBwcmV2UGFuZU9yaWdpbldpZHRoID0gcHJldlBhbmUuZWwub2Zmc2V0V2lkdGg7XHJcbiAgICAgICAgICAgIGNvbnN0IG5leHRQYW5lID0gdGhpcy5wYW5lWydfcmVzdWx0cyddW2kgKyAxXTtcclxuICAgICAgICAgICAgY29uc3QgbmV4dFBhbmVPcmlnaW5XaWR0aCA9IG5leHRQYW5lLmVsLm9mZnNldFdpZHRoO1xyXG4gICAgICAgICAgICBjb25zdCBwcmVQYW5lTWF4ID0gdGhpcy5nZXRFbGVtZW50U2l6ZShob3N0V2lkdGgsIHRoaXMucGFuZVsnX3Jlc3VsdHMnXVtpXS5tYXgpO1xyXG4gICAgICAgICAgICBjb25zdCBwcmVQYW5lTWluID0gdGhpcy5nZXRFbGVtZW50U2l6ZShob3N0V2lkdGgsIHRoaXMucGFuZVsnX3Jlc3VsdHMnXVtpXS5taW4pO1xyXG5cclxuICAgICAgICAgICAgLy8g5ouW5ou95ZCR5Y+z55qE5pyA5aSn5a695bqmXHJcbiAgICAgICAgICAgIGlmIChwcmVQYW5lTWF4IDw9IHByZXZQYW5lT3JpZ2luV2lkdGggJiYgcHJlUGFuZU1heCA+IDApIHtcclxuICAgICAgICAgICAgICAgIGNvbXBvbmVudFJlZi5pbnN0YW5jZS5yaWdodE1vdmVkTWF4ID0gMDtcclxuICAgICAgICAgICAgfSBlbHNlIGlmIChwcmVQYW5lTWF4ID49IHByZXZQYW5lT3JpZ2luV2lkdGggKyBuZXh0UGFuZU9yaWdpbldpZHRoIHx8IHByZVBhbmVNYXggPT09IDApIHtcclxuICAgICAgICAgICAgICAgIGNvbXBvbmVudFJlZi5pbnN0YW5jZS5yaWdodE1vdmVkTWF4ID0gbmV4dFBhbmVPcmlnaW5XaWR0aDtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGNvbXBvbmVudFJlZi5pbnN0YW5jZS5yaWdodE1vdmVkTWF4ID0gcHJlUGFuZU1heCAtIHByZXZQYW5lT3JpZ2luV2lkdGg7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIOaLluaLveWQkeW3pueahOacgOWkp+WuveW6plxyXG4gICAgICAgICAgICBpZiAocHJlUGFuZU1pbiA+PSBwcmV2UGFuZU9yaWdpbldpZHRoIHx8IHByZVBhbmVNaW4gPD0gMCkge1xyXG4gICAgICAgICAgICAgICAgY29tcG9uZW50UmVmLmluc3RhbmNlLmxlZnRNb3ZlZE1heCA9IHByZXZQYW5lT3JpZ2luV2lkdGg7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBjb21wb25lbnRSZWYuaW5zdGFuY2UubGVmdE1vdmVkTWF4ID0gcHJldlBhbmVPcmlnaW5XaWR0aCAtIHByZVBhbmVNaW47XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIOaoquWQkeaLluaLvei/mOaYr+e6teWQkeaLluaLvVxyXG4gICAgICAgICAgICBpZiAodGhpcy5vcmllbnRhdGlvbiA9PT0gJ2hvcml6b250YWwnKSB7XHJcbiAgICAgICAgICAgICAgICBjb21wb25lbnRSZWYuaW5zdGFuY2UubG9ja0F4aXMgPSAneSc7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5vcmllbnRhdGlvbiA9PT0gJ3ZlcnRpY2FsJykge1xyXG4gICAgICAgICAgICAgICAgY29tcG9uZW50UmVmLmluc3RhbmNlLmxvY2tBeGlzID0gJ3gnO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNvbXBvbmVudFJlZi5pbnN0YW5jZS5vcmRlciA9IDIgKiBpICsgMTtcclxuXHJcbiAgICAgICAgICAgIC8vIOaLluaLveWPmOWMllxyXG4gICAgICAgICAgICBjb21wb25lbnRSZWYuaW5zdGFuY2UuZW5kT2Zmc2V0LnN1YnNjcmliZShkYXRhID0+IHtcclxuICAgICAgICAgICAgICAgIHByZXZQYW5lLnNpemUgPSBwcmV2UGFuZS5lbC5vZmZzZXRXaWR0aCArIGRhdGEueDtcclxuICAgICAgICAgICAgICAgIG5leHRQYW5lLnNpemUgPSBuZXh0UGFuZS5lbC5vZmZzZXRXaWR0aCAtIGRhdGEueDtcclxuICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKHByZXZQYW5lbE9yaWdpbldpZHRoICsgZGF0YS54LCBuZXh0UGFuZWxPcmlnaW5XaWR0aCAtIGRhdGEueClcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgdGhpcy5iYXJDb21wb25lbnRSZWZBcnJheS5wdXNoKGNvbXBvbmVudFJlZik7XHJcbiAgICAgICAgICAgIGNvbXBvbmVudFJlZi5jaGFuZ2VEZXRlY3RvclJlZi5kZXRlY3RDaGFuZ2VzKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxufVxyXG5cclxuIl19
/**
 * @fileoverview added by tsickle
 * Generated from: lib/selections/sl.component.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input, EventEmitter, Output, ChangeDetectorRef, Injector, NgZone } from '@angular/core';
import { ApiService } from '../../utils/api.service';
import * as _ from 'lodash-es';
import { FavoritesTool } from '../../utils/favorites.tool';
import { ChangeType } from '../../utils/index.type';
import { CommonUtil } from '../../utils/common.tool';
import { StateMgrTool } from '../../utils/state.mgr.tool';
import { LocaleService } from '@farris/ui-locale';
import { ORGANIZATION_SELECTOR_LOCALE } from '../../utils/locale';
export class SelectionComponent {
    /**
     * @param {?} apiService
     * @param {?} cdr
     * @param {?} favoritesTool
     * @param {?} injector
     * @param {?} ngZone
     * @param {?} stateMgr
     */
    constructor(apiService, cdr, favoritesTool, injector, ngZone, stateMgr) {
        this.apiService = apiService;
        this.cdr = cdr;
        this.favoritesTool = favoritesTool;
        this.injector = injector;
        this.ngZone = ngZone;
        this.stateMgr = stateMgr;
        this.openedChange = new EventEmitter();
        this.datas = [];
        this.items = [];
        this.pageIndex = 0;
        this.pageSize = 5;
        this.moreText = '';
        this.localeService = null;
        this.moreDataText = '';
        this.noneDataText = '';
        this.cdr = this.injector.get(ChangeDetectorRef);
        this.localeService = this.injector.get(LocaleService);
        if (!this.localeService.langData['organizationSelector']) {
            this.localeService.setLocaleData(ORGANIZATION_SELECTOR_LOCALE);
        }
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        this.selectionsSub.unsubscribe();
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.selectionsSub = this.stateMgr.selectionsSubject.subscribe((/**
         * @param {?} data
         * @return {?}
         */
        data => {
            this.pageIndex = 0;
            if (data.changeType === ChangeType.ValueChanged) {
                this.datas = _.cloneDeep(data.value);
            }
            else if (data.changeType === ChangeType.Remove) {
                this.datas = this.datas.filter((/**
                 * @param {?} item
                 * @return {?}
                 */
                item => item['id'] !== data.value['id']));
            }
            else if (data.changeType === ChangeType.Append) {
                if (CommonUtil.findIndex(data.value['id'], 'id', this.datas) === -1) {
                    this.datas.push(data.value);
                }
            }
            this.items = this.datas.slice(this.pageIndex, this.pageSize);
            if (this.datas.length < 1) {
                this.moreText = this.noneDataText;
            }
            else {
                if (this.items.length < this.datas.length) {
                    this.moreText = this.moreDataText;
                }
                else {
                    this.moreText = null;
                }
            }
            this.cdr.detectChanges();
        }));
        this.moreDataText = this.localeService.getValue("organizationSelector.tabCommon.more");
        this.noneDataText = this.localeService.getValue("organizationSelector.tabCommon.noMore");
    }
    /**
     * @return {?}
     */
    ngAfterViewInit() {
    }
    /**
     * @param {?} changes
     * @return {?}
     */
    ngOnChanges(changes) {
    }
    /**
     * @return {?}
     */
    openGroupDialog() {
        this.openedChange.emit(true);
    }
    /**
     * @param {?} index
     * @param {?} item
     * @return {?}
     */
    trackByFn(index, item) {
        return index;
    }
    /**
     * @return {?}
     */
    loadMore() {
        if (this.pageIndex < this.datas.length) {
            this.pageIndex += 1;
            /** @type {?} */
            const currentPageIndex = this.pageIndex * this.pageSize;
            /** @type {?} */
            const currentItems = this.datas.slice(currentPageIndex, currentPageIndex + this.pageSize);
            this.items = this.items.concat(currentItems);
            if (this.items.length && this.items.length === this.datas.length) {
                this.moreText = null;
            }
            this.cdr.detectChanges;
        }
    }
    /**
     * @param {?} e
     * @param {?} data
     * @param {?} i
     * @return {?}
     */
    removeItem(e, data, i) {
        this.stateMgr.emitSelections(data, ChangeType.Remove, 'selection');
        if (i !== 0) {
            e.stopPropagation();
            e.cancelBubble = true;
        }
    }
}
SelectionComponent.decorators = [
    { type: Component, args: [{
                selector: 'lib-selection',
                template: "<div class=\"selections-content\">\r\n    <perfect-scrollbar style=\"max-height: 340px;min-height: 40px;\">\r\n        <ng-container *ngFor=\"let item of items; let i = index;trackBy: trackByFn\">\r\n            <div class=\"selections-blank-4\"></div>\r\n            <div class=\"selections-item\">\r\n                <span class=\"si-icon-circle\">{{ i + 1 }}</span>\r\n                <dl>\r\n                    <dt>{{ item.name }}</dt>\r\n                    <dd title=\"{{item.orgAllPath}}\">{{ item.orgAllPath }}</dd>\r\n                </dl>\r\n                <span class=\"f-icon f-icon-minus-circle deleteBtn\" (click)=\"removeItem($event, item, i)\"></span>\r\n            </div>\r\n        </ng-container>\r\n        <div class=\"selections-more\">\r\n            <span (click)=\"loadMore()\"\r\n                [ngStyle]=\"{'color': moreText === moreDataText ? '#2A87FF' : '#ded5d5', 'cursor': moreText === moreDataText ? 'pointer' : 'default'}\">{{\r\n                moreText }}</span>\r\n            <div class=\"saved-group\" (click)=\"openGroupDialog()\" *ngIf=\"enableGroup\">\r\n                <span class=\"f-icon f-icon-team\"></span>{{'organizationSelector.group.saveGroup' | locale}}\r\n            </div>\r\n        </div>\r\n        <div class=\"selections-blank-34\"></div>\r\n    </perfect-scrollbar>\r\n</div>\r\n<div class=\"selections-triangle-down\"></div>",
                styles: [".selections-content{box-shadow:0 1px 12px 0 rgba(73,84,102,.15);border-radius:7px;width:340px;height:auto;overflow:hidden}.selections-item{width:332px;height:44px;border-radius:6px;margin:0 4px;display:-webkit-box;display:flex}.selections-blank-4{width:100%;height:4px}.selections-blank-34{width:100%;height:34px}.selections-item:hover{background:#ebf4ff}.selections-item .si-icon-circle{border-radius:50%;font-size:12px;width:14px;height:14px;background:#62c8ca;text-align:center;display:block;color:#fff;margin:7px 8px 0 11px;line-height:14px}.selections-item dl{-webkit-box-flex:1;flex:1;margin-top:3px;font-size:13px;overflow:hidden}.selections-item dl dt{font-weight:400;line-height:18px;color:#53565d}.selections-item dl dd{line-height:18px;color:#a8adb8;text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.selections-item .deleteBtn{font-size:14px;margin:15px 15px 0;color:#f46160;cursor:pointer}.selections-triangle-down{width:0;height:0;border-left:6px solid transparent;border-right:6px solid transparent;border-top:8px solid #fff;margin-left:40px}.selections-more{text-align:center;padding:4px 20px;height:34px;line-height:26px;font-size:13px;color:#2a87ff;display:-webkit-box;display:flex;-webkit-box-pack:justify;justify-content:space-between;position:absolute;bottom:0;left:0;right:0;background:#fff}.selections-more .saved-group{width:95px;height:26px;line-height:26px;background:#eaedf2;border-radius:5px;text-align:center;font-size:13px;color:#909ba2;cursor:pointer}.selections-more .saved-group:hover{color:#2a87ff;background:#eaf4ff}.selections-more .saved-group:hover .f-icon{color:#2a87ff}.selections-more .saved-group .f-icon{color:#909ba2;margin-right:5px;cursor:pointer;font-size:14px}"]
            }] }
];
/** @nocollapse */
SelectionComponent.ctorParameters = () => [
    { type: ApiService },
    { type: ChangeDetectorRef },
    { type: FavoritesTool },
    { type: Injector },
    { type: NgZone },
    { type: StateMgrTool }
];
SelectionComponent.propDecorators = {
    primaryField: [{ type: Input }],
    enableGroup: [{ type: Input }],
    openedChange: [{ type: Output }]
};
if (false) {
    /** @type {?} */
    SelectionComponent.prototype.primaryField;
    /** @type {?} */
    SelectionComponent.prototype.enableGroup;
    /** @type {?} */
    SelectionComponent.prototype.openedChange;
    /** @type {?} */
    SelectionComponent.prototype.datas;
    /** @type {?} */
    SelectionComponent.prototype.items;
    /** @type {?} */
    SelectionComponent.prototype.pageIndex;
    /** @type {?} */
    SelectionComponent.prototype.pageSize;
    /** @type {?} */
    SelectionComponent.prototype.moreText;
    /** @type {?} */
    SelectionComponent.prototype.selectionsSub;
    /** @type {?} */
    SelectionComponent.prototype.localeService;
    /** @type {?} */
    SelectionComponent.prototype.moreDataText;
    /** @type {?} */
    SelectionComponent.prototype.noneDataText;
    /**
     * @type {?}
     * @private
     */
    SelectionComponent.prototype.apiService;
    /**
     * @type {?}
     * @private
     */
    SelectionComponent.prototype.cdr;
    /**
     * @type {?}
     * @private
     */
    SelectionComponent.prototype.favoritesTool;
    /**
     * @type {?}
     * @private
     */
    SelectionComponent.prototype.injector;
    /**
     * @type {?}
     * @private
     */
    SelectionComponent.prototype.ngZone;
    /**
     * @type {?}
     * @private
     */
    SelectionComponent.prototype.stateMgr;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2wuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy91aS1hZG1pbm9yZ2FuaXphdGlvbi1zZWxlY3Rvci8iLCJzb3VyY2VzIjpbImxpYi9zZWxlY3Rpb25zL3NsLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFDSCxTQUFTLEVBQUUsS0FBSyxFQUFFLFlBQVksRUFBRSxNQUFNLEVBQW1ELGlCQUFpQixFQUFFLFFBQVEsRUFBRSxNQUFNLEVBQy9ILE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSx5QkFBeUIsQ0FBQztBQUNyRCxPQUFPLEtBQUssQ0FBQyxNQUFNLFdBQVcsQ0FBQztBQUMvQixPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sNEJBQTRCLENBQUM7QUFDM0QsT0FBTyxFQUFFLFVBQVUsRUFBbUIsTUFBTSx3QkFBd0IsQ0FBQztBQUNyRSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0seUJBQXlCLENBQUM7QUFDckQsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLDRCQUE0QixDQUFDO0FBRTFELE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUNsRCxPQUFPLEVBQUUsNEJBQTRCLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQztBQU9sRSxNQUFNLE9BQU8sa0JBQWtCOzs7Ozs7Ozs7SUFnQjNCLFlBQ1ksVUFBc0IsRUFDdEIsR0FBc0IsRUFDdEIsYUFBNEIsRUFDNUIsUUFBa0IsRUFDbEIsTUFBYyxFQUNkLFFBQXNCO1FBTHRCLGVBQVUsR0FBVixVQUFVLENBQVk7UUFDdEIsUUFBRyxHQUFILEdBQUcsQ0FBbUI7UUFDdEIsa0JBQWEsR0FBYixhQUFhLENBQWU7UUFDNUIsYUFBUSxHQUFSLFFBQVEsQ0FBVTtRQUNsQixXQUFNLEdBQU4sTUFBTSxDQUFRO1FBQ2QsYUFBUSxHQUFSLFFBQVEsQ0FBYztRQWxCeEIsaUJBQVksR0FBRyxJQUFJ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QUFNLEVBQUUsV0FBVyxDQUFDLENBQUM7UUFDbkUsSUFBRyxDQUFDLEtBQUssQ0FBQyxFQUFFO1lBQ1IsQ0FBQyxDQUFDLGVBQWUsRUFBRSxDQUFDO1lBQ3BCLENBQUMsQ0FBQyxZQUFZLEdBQUcsSUFBSSxDQUFDO1NBQ3pCO0lBQ0wsQ0FBQzs7O1lBdkdKLFNBQVMsU0FBQztnQkFDUCxRQUFRLEVBQUUsZUFBZTtnQkFDekIsMDNDQUFrQzs7YUFFckM7Ozs7WUFkUSxVQUFVO1lBRjBFLGlCQUFpQjtZQUlyRyxhQUFhO1lBSjBGLFFBQVE7WUFBRSxNQUFNO1lBT3ZILFlBQVk7OzsyQkFZaEIsS0FBSzswQkFDTCxLQUFLOzJCQUNMLE1BQU07Ozs7SUFGUCwwQ0FBOEI7O0lBQzlCLHlDQUE4Qjs7SUFDOUIsMENBQXFEOztJQUVyRCxtQ0FBVzs7SUFDWCxtQ0FBVzs7SUFDWCx1Q0FBYzs7SUFDZCxzQ0FBYTs7SUFDYixzQ0FBYzs7SUFDZCwyQ0FBNEI7O0lBQzVCLDJDQUFvQzs7SUFDcEMsMENBQWtCOztJQUNsQiwwQ0FBa0I7Ozs7O0lBR2Qsd0NBQThCOzs7OztJQUM5QixpQ0FBOEI7Ozs7O0lBQzlCLDJDQUFvQzs7Ozs7SUFDcEMsc0NBQTBCOzs7OztJQUMxQixvQ0FBc0I7Ozs7O0lBQ3RCLHNDQUE4QiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XHJcbiAgICBDb21wb25lbnQsIElucHV0LCBFdmVudEVtaXR0ZXIsIE91dHB1dCwgT25Jbml0LCBBZnRlclZpZXdJbml0LCBTaW1wbGVDaGFuZ2VzLCBPbkNoYW5nZXMsIENoYW5nZURldGVjdG9yUmVmLCBJbmplY3RvciwgTmdab25lLCBPbkRlc3Ryb3lcclxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgQXBpU2VydmljZSB9IGZyb20gJy4uLy4uL3V0aWxzL2FwaS5zZXJ2aWNlJztcclxuaW1wb3J0ICogYXMgXyBmcm9tICdsb2Rhc2gtZXMnO1xyXG5pbXBvcnQgeyBGYXZvcml0ZXNUb29sIH0gZnJvbSAnLi4vLi4vdXRpbHMvZmF2b3JpdGVzLnRvb2wnO1xyXG5pbXBvcnQgeyBDaGFuZ2VUeXBlLCBPcmdSZXF1ZXN0UGFyYW0gfSBmcm9tICcuLi8uLi91dGlscy9pbmRleC50eXBlJztcclxuaW1wb3J0IHsgQ29tbW9uVXRpbCB9IGZyb20gJy4uLy4uL3V0aWxzL2NvbW1vbi50b29sJztcclxuaW1wb3J0IHsgU3RhdGVNZ3JUb29sIH0gZnJvbSAnLi4vLi4vdXRpbHMvc3RhdGUubWdyLnRvb2wnO1xyXG5pbXBvcnQgeyBTdWJzY3JpcHRpb24gfSBmcm9tICdyeGpzJztcclxuaW1wb3J0IHsgTG9jYWxlU2VydmljZSB9IGZyb20gJ0BmYXJyaXMvdWktbG9jYWxlJztcclxuaW1wb3J0IHsgT1JHQU5JWkFUSU9OX1NFTEVDVE9SX0xPQ0FMRSB9IGZyb20gJy4uLy4uL3V0aWxzL2xvY2FsZSc7XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICAgIHNlbGVjdG9yOiAnbGliLXNlbGVjdGlvbicsXHJcbiAgICB0ZW1wbGF0ZVVybDogJy4vc2wuY29tcG9uZW50Lmh0bWwnLFxyXG4gICAgc3R5bGVVcmxzOiBbJy4vc2wuY29tcG9uZW50LmNzcyddLFxyXG59KVxyXG5leHBvcnQgY2xhc3MgU2VsZWN0aW9uQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBBZnRlclZpZXdJbml0LCBPbkNoYW5nZXMsIE9uRGVzdHJveSB7XHJcblxyXG4gICAgQElucHV0KCkgcHJpbWFyeUZpZWxkOiBzdHJpbmc7XHJcbiAgICBASW5wdXQoKSBlbmFibGVHcm91cDogYm9vbGVhbjtcclxuICAgIEBPdXRwdXQoKSBvcGVuZWRDaGFuZ2UgPSBuZXcgRXZlbnRFbWl0dGVyPGJvb2xlYW4+KCk7XHJcblxyXG4gICAgZGF0YXMgPSBbXTtcclxuICAgIGl0ZW1zID0gW107XHJcbiAgICBwYWdlSW5kZXggPSAwO1xyXG4gICAgcGFnZVNpemUgPSA1O1xyXG4gICAgbW9yZVRleHQgPSAnJztcclxuICAgIHNlbGVjdGlvbnNTdWI6IFN1YnNjcmlwdGlvbjtcclxuICAgIGxvY2FsZVNlcnZpY2U6IExvY2FsZVNlcnZpY2UgPSBudWxsO1xyXG4gICAgbW9yZURhdGFUZXh0ID0gJyc7XHJcbiAgICBub25lRGF0YVRleHQgPSAnJztcclxuXHJcbiAgICBjb25zdHJ1Y3RvcihcclxuICAgICAgICBwcml2YXRlIGFwaVNlcnZpY2U6IEFwaVNlcnZpY2UsXHJcbiAgICAgICAgcHJpdmF0ZSBjZHI6IENoYW5nZURldGVjdG9yUmVmLFxyXG4gICAgICAgIHByaXZhdGUgZmF2b3JpdGVzVG9vbDogRmF2b3JpdGVzVG9vbCxcclxuICAgICAgICBwcml2YXRlIGluamVjdG9yOiBJbmplY3RvcixcclxuICAgICAgICBwcml2YXRlIG5nWm9uZTogTmdab25lLFxyXG4gICAgICAgIHByaXZhdGUgc3RhdGVNZ3I6IFN0YXRlTWdyVG9vbFxyXG4gICAgKSB7XHJcbiAgICAgICAgdGhpcy5jZHIgPSB0aGlzLmluamVjdG9yLmdldChDaGFuZ2VEZXRlY3RvclJlZik7XHJcbiAgICAgICAgdGhpcy5sb2NhbGVTZXJ2aWNlID0gdGhpcy5pbmplY3Rvci5nZXQoTG9jYWxlU2VydmljZSk7XHJcbiAgICAgICAgaWYoIXRoaXMubG9jYWxlU2VydmljZS5sYW5nRGF0YVsnb3JnYW5pemF0aW9uU2VsZWN0b3InXSkge1xyXG4gICAgICAgICAgICB0aGlzLmxvY2FsZVNlcnZpY2Uuc2V0TG9jYWxlRGF0YShPUkdBTklaQVRJT05fU0VMRUNUT1JfTE9DQUxFKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgbmdPbkRlc3Ryb3koKTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy5zZWxlY3Rpb25zU3ViLnVuc3Vic2NyaWJlKCk7XHJcbiAgICB9XHJcblxyXG4gICAgbmdPbkluaXQoKTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy5zZWxlY3Rpb25zU3ViID0gdGhpcy5zdGF0ZU1nci5zZWxlY3Rpb25zU3ViamVjdC5zdWJzY3JpYmUoZGF0YSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMucGFnZUluZGV4ID0gMDtcclxuICAgICAgICAgICAgaWYgKGRhdGEuY2hhbmdlVHlwZSA9PT0gQ2hhbmdlVHlwZS5WYWx1ZUNoYW5nZWQpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZGF0YXMgPSBfLmNsb25lRGVlcChkYXRhLnZhbHVlKTtcclxuICAgICAgICAgICAgfSBlbHNlIGlmIChkYXRhLmNoYW5nZVR5cGUgPT09IENoYW5nZVR5cGUuUmVtb3ZlKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmRhdGFzID0gdGhpcy5kYXRhcy5maWx0ZXIoaXRlbSA9PiBpdGVtWydpZCddICE9PSBkYXRhLnZhbHVlWydpZCddKTtcclxuICAgICAgICAgICAgfSBlbHNlIGlmIChkYXRhLmNoYW5nZVR5cGUgPT09IENoYW5nZVR5cGUuQXBwZW5kKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoQ29tbW9uVXRpbC5maW5kSW5kZXgoZGF0YS52YWx1ZVsnaWQnXSwgJ2lkJywgdGhpcy5kYXRhcykgPT09IC0xKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kYXRhcy5wdXNoKGRhdGEudmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMuaXRlbXMgPSB0aGlzLmRhdGFzLnNsaWNlKHRoaXMucGFnZUluZGV4LCB0aGlzLnBhZ2VTaXplKTtcclxuICAgICAgICAgICAgaWYodGhpcy5kYXRhcy5sZW5ndGggPCAxKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLm1vcmVUZXh0ID0gdGhpcy5ub25lRGF0YVRleHQ7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5pdGVtcy5sZW5ndGggPCB0aGlzLmRhdGFzLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMubW9yZVRleHQgPSB0aGlzLm1vcmVEYXRhVGV4dDtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5tb3JlVGV4dCA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5jZHIuZGV0ZWN0Q2hhbmdlcygpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHRoaXMubW9yZURhdGFUZXh0ID0gdGhpcy5sb2NhbGVTZXJ2aWNlLmdldFZhbHVlKFwib3JnYW5pemF0aW9uU2VsZWN0b3IudGFiQ29tbW9uLm1vcmVcIik7XHJcbiAgICAgICAgdGhpcy5ub25lRGF0YVRleHQgPSB0aGlzLmxvY2FsZVNlcnZpY2UuZ2V0VmFsdWUoXCJvcmdhbml6YXRpb25TZWxlY3Rvci50YWJDb21tb24ubm9Nb3JlXCIpO1xyXG4gICAgfVxyXG5cclxuICAgIG5nQWZ0ZXJWaWV3SW5pdCgpOiB2b2lkIHtcclxuXHJcbiAgICB9XHJcblxyXG4gICAgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcyk6IHZvaWQge1xyXG5cclxuICAgIH1cclxuXHJcbiAgICBvcGVuR3JvdXBEaWFsb2coKSB7XHJcbiAgICAgICAgdGhpcy5vcGVuZWRDaGFuZ2UuZW1pdCh0cnVlKTtcclxuICAgIH1cclxuXHJcbiAgICB0cmFja0J5Rm4oaW5kZXgsIGl0ZW0pIHtcclxuICAgICAgICByZXR1cm4gaW5kZXg7XHJcbiAgICB9XHJcblxyXG4gICAgbG9hZE1vcmUoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMucGFnZUluZGV4IDwgdGhpcy5kYXRhcy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgdGhpcy5wYWdlSW5kZXggKz0gMTtcclxuICAgICAgICAgICAgY29uc3QgY3VycmVudFBhZ2VJbmRleCA9IHRoaXMucGFnZUluZGV4ICogdGhpcy5wYWdlU2l6ZTtcclxuICAgICAgICAgICAgY29uc3QgY3VycmVudEl0ZW1zID0gdGhpcy5kYXRhcy5zbGljZShjdXJyZW50UGFnZUluZGV4LCBjdXJyZW50UGFnZUluZGV4ICsgdGhpcy5wYWdlU2l6ZSlcclxuICAgICAgICAgICAgdGhpcy5pdGVtcyA9IHRoaXMuaXRlbXMuY29uY2F0KGN1cnJlbnRJdGVtcyk7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLml0ZW1zLmxlbmd0aCAmJiB0aGlzLml0ZW1zLmxlbmd0aCA9PT0gdGhpcy5kYXRhcy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMubW9yZVRleHQgPSBudWxsO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMuY2RyLmRldGVjdENoYW5nZXM7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHJlbW92ZUl0ZW0oZTogYW55LCBkYXRhOiBhbnksIGk6IGFueSkge1xyXG4gICAgICAgIHRoaXMuc3RhdGVNZ3IuZW1pdFNlbGVjdGlvbnMoZGF0YSwgQ2hhbmdlVHlwZS5SZW1vdmUsICdzZWxlY3Rpb24nKTtcclxuICAgICAgICBpZihpICE9PSAwKSB7XHJcbiAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICAgICAgICAgIGUuY2FuY2VsQnViYmxlID0gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG5cclxufVxyXG4iXX0=
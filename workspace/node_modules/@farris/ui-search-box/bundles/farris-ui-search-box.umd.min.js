!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/common"),require("@farris/ui-datepicker"),require("@farris/ui-switch"),require("@farris/ui-number-spinner"),require("@farris/ui-forms"),require("@farris/ui-common/types"),require("@angular/forms"),require("rxjs"),require("@farris/ui-common"),require("@farris/ui-input-group"),require("rxjs/operators"),require("@farris/ui-common/date"),require("@farris/ui-locale"),require("lodash-es"),require("@angular/core")):"function"==typeof define&&define.amd?define("@farris/ui-search-box",["exports","@angular/common","@farris/ui-datepicker","@farris/ui-switch","@farris/ui-number-spinner","@farris/ui-forms","@farris/ui-common/types","@angular/forms","rxjs","@farris/ui-common","@farris/ui-input-group","rxjs/operators","@farris/ui-common/date","@farris/ui-locale","lodash-es","@angular/core"],t):t((e.farris=e.farris||{},e.farris["ui-search-box"]={}),e.ng.common,e.uiDatepicker,e.uiSwitch,e.uiNumberSpinner,e.uiForms,e.types,e.ng.forms,e.rxjs,e.uiCommon,e.uiInputGroup,e.rxjs.operators,e.date,e.uiLocale,e.lodashEs,e.ng.core)}(this,function(e,t,n,i,a,r,o,l,s,c,h,d,u,p,f,m){"use strict";var v=(g.decorators=[{type:m.Injectable}],g.ctorParameters=function(){return[]},g);function g(){}var y=function(e,t){return(y=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function x(e,t){function n(){this.constructor=e}y(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var b=function(){return(b=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},w={en:{searchbox:{enterKeywords:"Please enter keywords",tips:'Space can be used to represent "or" in input, and enter to search.',contain:"contain",clear:"Clear all conditions.",cancel:"Cancel",ok:"Ok",removeFilter:"Delete Condition",anyFields:"All",relation:{and:"AND",or:"OR"}}},"zh-CHS":{searchbox:{enterKeywords:"请输入关键字",tips:"输入中可用空格代表“或”，回车可搜索",contain:"包含",clear:"清除筛选",cancel:"取消",ok:"确定",removeFilter:"删除条件",anyFields:"全部",relation:{and:"并",or:"或"}}},"zh-CHT":{searchbox:{enterKeywords:"請輸入關鍵字",tips:"輸入中可用空格代表“或”，回車可搜索",contain:"包含",clear:"清除篩選",cancel:"取消",ok:"確定",removeFilter:"刪除條件",anyFields:"全部",relation:{and:"並",or:"或"}}}},C=(E.ctorParameters=function(){return[{type:m.ElementRef},{type:m.Injector},{type:c.OverLayHiddenService,decorators:[{type:m.Optional}]},{type:m.ChangeDetectorRef}]},E);function E(e,t,n,i){this.el=e,this.injector=t,this.overLayService=n,this.cd=i,this.commonUtils=null,this.render=this.injector.get(m.Renderer2),n||(this.overLayService=new c.OverLayHiddenService),this.localeSer=this.injector.get(p.LocaleService,null),this.commonUtils=this.injector.get(c.CommonUtils,null),this.localeSer&&this.localeSer.setLocaleData(w)}var S,F={provide:l.NG_VALUE_ACCESSOR,useExisting:m.forwardRef(function(){return T}),multi:!0},T=(x(R,S=C),R.prototype.ngOnInit=function(){},R.prototype.ngAfterViewInit=function(){var e=this;setTimeout(function(){e.moveShadowToBody()})},R.prototype.ngOnChanges=function(e){},R.prototype.ngOnDestroy=function(){this.overLayService&&(this.overLayService.destory(this.shadowBox.nativeElement),this.overLayService=null),this.shadowBox&&this.shadowBox.nativeElement.remove(),this.REMOVE_ITEM_TIMER&&(clearTimeout(this.REMOVE_ITEM_TIMER),this.REMOVE_ITEM_TIMER=null)},R.prototype.onBlur=function(e){this.enableFloat&&(this.input2.value||this.toggleShadowBox(!1))},R.prototype.onInputClick=function(e){this.enableFloat&&this.toggleShadowBox()},R.prototype.filterChanged=function(){var t=this,e=this.filterConditions.filter(function(e){return"*"!==e.code}).map(function(n,e){if(-1<n.value.trim().indexOf(" ")){var i=Array.from(new Set(n.value.trim().split(" ").filter(function(e){return e.trim()})));return i.map(function(e,t){return{filterField:n.code,value:e,lbracket:0==t?"(":"",rbracket:t==i.length-1?")":"",relation:t==i.length-1?1:2,compare:6}})}return{filterField:n.code,value:n.value,lbracket:"",rbracket:"",relation:e==t.filterConditions.length-1?0:1,compare:6}}),n=[];n=this.expandStarFieldToAllFields().concat(f.flatten(e)),e&&e.length&&(n[n.length-1].relation=0),this.onModelChange(this.filterConditions),this.onModelTouched(this.filterConditions),n.length?this.conditionChange.emit(n):this.conditionChange.emit(this.filterConditions)},R.prototype.expandStarFieldToAllFields=function(){var e=this.filterConditions.find(function(e){return"*"===e.code});if(!e)return[];var t=Array.from(new Set(e.value.trim().split(" ").filter(function(e){return e.trim()}))),n=this.fields.filter(function(e){return"*"!==e.code}).map(function(n,e){return t.map(function(e,t){return{filterField:n.code,value:e,lbracket:"",rbracket:"",relation:o.FilterRelation.Or,compare:o.Compare.Like}})}),i=[];return n&&n.length&&((i=f.flatten(n))[0].lbracket="(",i[i.length-1].rbracket=")",i[i.length-1].relation=this.filterConditions.filter(function(e){return"*"!==e.code}).length?1:0),i},R.prototype.initDislayText=function(e){var t=this;void 0===e&&(e=!0);var i=this.localeSer.getValue("searchbox.relation.or");this.displayTextList=this.filterConditions.map(function(e){var t=b({},e),n=t.value.trim().split(" ").filter(function(e){return e.trim()});return t.dislayText=t.name+"："+n.join(" "+i+" "),t.displayHtml=t.name+"："+n.join('<span class="text-muted font-italic mx-1 or">'+i+"</span>"),t}),setTimeout(function(){t.enableFloat&&t.setHiddenCount()}),this.cd.detectChanges(),e&&this.filterChanged()},R.prototype.select=function(t){var e=this.filterConditions.find(function(e){return e.code===t.code});e?e.value=e.value.trim()+" "+t.value:this.filterConditions.push(t),this.initDislayText(),this.input.value=""},R.prototype.remove=function(t){this.filterConditions=this.filterConditions.filter(function(e){return e.code!==t}),this.initDislayText(!1),this._emitFilterChanged()},R.prototype._emitFilterChanged=function(){var e=this;this.REMOVE_ITEM_TIMER&&clearTimeout(this.REMOVE_ITEM_TIMER),this.REMOVE_ITEM_TIMER=setTimeout(function(){e.filterChanged()},180)},R.prototype.onRemoveItem=function(e,t){e.stopPropagation(),this.filterConditions=this.filterConditions.filter(function(e){return e.code!==t.code}),this.initDislayText()},R.prototype.clearConditions=function(e){void 0===e&&(e=!0),this.input.value="",this.displayTextList=[],this.filterConditions=[],this.setHiddenCount(),e&&(this.conditionChange.emit([]),this.clear.emit())},R.prototype.onSubmit=function(e){e.stopPropagation(),this.input.value="",this.toggleShadowBox(!1),this._emitFilterChanged()},R.prototype.writeValue=function(e){var t=e;Array.isArray(e)||(t=[]),this.filterConditions=t,this.initDislayText()},R.prototype.registerOnChange=function(e){this.onModelChange=e},R.prototype.registerOnTouched=function(e){this.onModelTouched=e},R.prototype.setValue=function(e,t){void 0===t&&(t=!0),this.filterConditions=e,this.initDislayText(t)},R.prototype.updateShadowBoxPosition=function(e){var t=void 0===e?{top:null,left:null,width:null}:e,n=t.top,i=t.left,a=t.width;if(!n&&!i&&!a){var r=this.el.nativeElement.getBoundingClientRect();n=r.top,i=r.left,a=r.width}this.render.setStyle(this.shadowBox.nativeElement,"left",i+"px"),this.render.setStyle(this.shadowBox.nativeElement,"top",n+"px"),this.render.setStyle(this.shadowBox.nativeElement,"width",a+"px"),this.render.setStyle(this.shadowBox.nativeElement,"zIndex",this.commonUtils.getFloatingLayerIndex())},R.prototype.moveShadowToBody=function(){var t=this;this.enableFloat&&(this.updateShadowBoxPosition(),document.body.append(this.shadowBox.nativeElement),this.overLayService.registerMouseEvent(this.shadowBox.nativeElement,function(e){e.target&&-1<e.target.className.indexOf("search-box_delete-keys")||e.target===t.input2.textbox.nativeElement||!t.shadowBox||t.shadowBox.nativeElement.contains(e.target)||e.target.closest(".f-search-box-panel")||t.toggleShadowBox(!1)}))},R.prototype.toggleShadowBox=function(e){void 0===e&&(e=!0),this.enableFloat&&(this.fields&&this.fields.length||this.useAnyField)&&(e?(this.updateShadowBoxPosition(),this.render.removeStyle(this.shadowBox.nativeElement,"display"),this.container.nativeElement.style.visibility="hidden",this.input2.focus()):(this.container.nativeElement.style.visibility="visible",this.render.setStyle(this.shadowBox.nativeElement,"display","none")))},R.prototype.onShadowBoxClick=function(e){e.stopPropagation(),this.enableFloat&&this.input2.focus()},R.prototype.onResized=function(e){var t=this;this.enableFloat&&(this.updateShadowBoxPosition(e),setTimeout(function(){t.setHiddenCount(),t.cd.detectChanges()}))},R.prototype.setHiddenCount=function(){var e=0;if(this.displayTextList&&this.displayTextList.length){var t=Array.from(this.container.nativeElement.querySelectorAll("span.search-tag-item"));t&&t.length&&(e=t.map(function(e){return e.offsetTop}).filter(function(e){return 20<e}).length),this.hiddenItemsCount$.next(e)}else this.hiddenItemsCount$.next(e)},R.prototype.onEsc=function(e){this.escHandler.emit(e)},R.decorators=[{type:m.Component,args:[{selector:"farris-search-box",template:'\r\n\r\n<div #searchbox class="input-group f-search-box" resizeObserver (resize)="onResized($event)" >\r\n    <div class="form-control f-cmp-inputgroup--multi-wrapper multi-more" style="min-height: 26px;padding: 0px 5px;" [style.height]="enableFloat? \'26px\': \'auto\'">\r\n        <div class="multi--content d-flex flex-row" style="width: 100%;flex-wrap: wrap;align-items: center;cursor: text;" #tagContainer (click)="toggleShadowBox()">\r\n            <span class="multi--item search-tag-item" *ngFor="let txt of displayTextList; let index" title="{{ txt.dislayText }}">\r\n                <span class="search-tag" [innerHTML]="txt.displayHtml | safe: \'html\'"></span>\r\n                <i class="f-icon f-icon-close search-box_delete-keys" style="top:5px" title="{{\'searchbox.removeFilter\'| locale}}" (click)="onRemoveItem($event, txt)"></i>\r\n            </span>\r\n\r\n            <span class="inputbox">\r\n                <input-group #tagInput class="search-input"\r\n                    [placeholder]="\'searchbox.enterKeywords\'| locale" (escHandler)="onEsc($event)"\r\n                    [enableClear]="false" [noborder]="true" (inputClick)="onInputClick($event)"\r\n                    [search-box-panel]="fields" [maxFields]="maxSearchFields" [useAnyField]="useAnyField"\r\n                ></input-group>\r\n            </span>\r\n        </div>\r\n\r\n        <div class="d-flex flex-row" style="cursor: pointer;align-items: center;color: #2A87FF;font-weight: 600;" *ngIf="hiddenItemsCount$ | async" (click)="toggleShadowBox()">\r\n            <span class="multi--more-text">+{{hiddenItemsCount$ | async}}</span>\r\n        </div>\r\n    </div>\r\n    <div class="input-group-append" style="position: relative;" (mouseenter)="$event.stopPropagation()">\r\n        <span class="input-group-text" [ngStyle]="displayTextList && displayTextList.length? {} : {pointerEvents: \'none\'}" >\r\n            <span class="f-icon f-icon-search" (click)="onSubmit($event)"></span>\r\n        </span>\r\n    </div>\r\n</div>\r\n\r\n\r\n<div #searchbox2 class="input-group f-search-box f-cmp-inputgroup " style="position:absolute;display: none; z-index: 2999;" *ngIf="enableFloat" \r\n(click)="onShadowBoxClick($event)" (mousedown)="$event.preventDefault()" >\r\n    <div class="form-control f-cmp-inputgroup--multi-wrapper multi-more  d-flex" style="height: auto; min-height: 26px;padding: 0px 5px;">\r\n        <div class="multi--content d-flex flex-row" style="width: 100%;flex-wrap: wrap;align-items: center;" #tagContainer>\r\n            <span class="multi--item search-tag-item" *ngFor="let txt of displayTextList; let index" title="{{ txt.dislayText }}">\r\n                <span class="search-tag" [innerHTML]="txt.displayHtml | safe: \'html\'"></span>\r\n                <i class="f-icon f-icon-close search-box_delete-keys" style="top:5px" title="{{\'searchbox.removeFilter\'| locale}}"  (click)="onRemoveItem($event, txt)"></i>\r\n            </span>\r\n\r\n            <span class="inputbox">\r\n                <input-group #tagInput2 class="search-input"\r\n                    [placeholder]="\'searchbox.enterKeywords\'| locale"\r\n                    [enableClear]="false" [noborder]="true" (blurHandle)="onBlur($event)" (escHandler)="onEsc($event)"\r\n                    [search-box-panel]="fields" [maxFields]="maxSearchFields" [useAnyField]="useAnyField"\r\n                ></input-group>\r\n            </span>\r\n        </div>\r\n    </div>\r\n    <div class="input-group-append" style="position: relative;" (mousedown)="$event.preventDefault()">\r\n        <span class="input-group-text" [ngStyle]="displayTextList && displayTextList.length? {} : {pointerEvents: \'none\'}">\r\n            <span class="f-icon f-icon-search" (click)="onSubmit($event)"></span>\r\n        </span>\r\n    </div>\r\n</div>\r\n',encapsulation:m.ViewEncapsulation.None,providers:[F]}]}],R.ctorParameters=function(){return[{type:m.ElementRef},{type:m.Injector},{type:c.OverLayHiddenService,decorators:[{type:m.Optional}]},{type:m.ChangeDetectorRef}]},R.propDecorators={fields:[{type:m.Input}],maxSearchFields:[{type:m.Input}],condition:[{type:m.Input}],useAnyField:[{type:m.Input}],container:[{type:m.ViewChild,args:["searchbox"]}],input:[{type:m.ViewChild,args:["tagInput"]}],shadowBox:[{type:m.ViewChild,args:["searchbox2"]}],input2:[{type:m.ViewChild,args:["tagInput2"]}],conditionChange:[{type:m.Output}],clear:[{type:m.Output}],escHandler:[{type:m.Output}]},R);function R(e,t,n,i){var a=S.call(this,e,t,n,i)||this;return a.fields=[],a.maxSearchFields=5,a.condition=[],a.useAnyField=!0,a.conditionChange=new m.EventEmitter,a.clear=new m.EventEmitter,a.escHandler=new m.EventEmitter,a.enableFloat=!0,a.displayTextList=[],a.filterConditions=[],a.hiddenItemsCount$=new s.BehaviorSubject(0),a.onModelChange=function(e){},a.onModelTouched=function(e){},a}var k=(I.prototype.ngOnInit=function(){},I.prototype.onSearchValueChange=function(e){this.conditions=e,this.cd.detectChanges()},I.prototype.onSubmitCondition=function(e){this.fieldOptions.value=this.conditions.value,this.fieldOptions.value.single?(delete this.fieldOptions.value.begin,delete this.fieldOptions.value.end):this.fieldOptions.value.value=null,this.filterChange.emit(this.conditions)},I.prototype.onRemoveSearchField=function(e){this.remove.emit(this.fieldOptions)},I.decorators=[{type:m.Component,args:[{selector:"farris-search-field-panel",template:'<div class="f-search-field-panel f-filter-panel-inner">\r\n    <div class="f-filter-panel-arrow" style="left: 26px; right: auto;"></div>\r\n    <div class="f-filter-panel-content " style="box-shadow:none">\r\n        <search-filed-editor-date [field]="fieldOptions" *ngIf="fieldOptions.control?.controltype === \'datetime\'"\r\n            class="d-flex flex-column" (valueChange)="onSearchValueChange($event)"></search-filed-editor-date>\r\n\r\n        <search-filed-editor-number [field]="fieldOptions" *ngIf="fieldOptions.control?.controltype === \'number\'" \r\n            class="d-flex flex-column" (valueChange)="onSearchValueChange($event)"></search-filed-editor-number>\r\n\r\n        <search-filed-editor-enum [field]="fieldOptions" *ngIf="fieldOptions.control?.controltype === \'enum\'" \r\n            class="d-flex flex-column" (valueChange)="onSearchValueChange($event)"></search-filed-editor-enum>\r\n\r\n        <search-field-editor-bool [field]="fieldOptions" *ngIf="fieldOptions.control?.controltype === \'dropdown\'" \r\n            class="d-flex flex-column" (valueChange)="onSearchValueChange($event)"></search-field-editor-bool>\r\n    </div>\r\n\r\n    <div class="f-filter-panel-footer">\r\n        <div class="filer-panel-clear">\r\n            <button class="btn btn-link" (click)="onRemoveSearchField($event)" [disabled]="fieldOptions?.value | canclear">{{\'searchbox.clear\' | locale}}</button>\r\n        </div>\r\n        <div class="filter-panel-btns">\r\n            <button class="btn btn-secondary close-field-panel">{{\'searchbox.cancel\' | locale}}</button>\r\n            <button class="filter-panel-submit btn btn-primary" #btnSubmit [disabled]="conditions?.value | canclear" (click)="onSubmitCondition($event)">{{\'searchbox.ok\' | locale}}</button>\r\n        </div>\r\n    </div>\r\n</div>'}]}],I.ctorParameters=function(){return[{type:m.Injector},{type:m.ChangeDetectorRef}]},I.propDecorators={fieldOptions:[{type:m.Input}],btnSubmit:[{type:m.ViewChild,args:["btnSubmit"]}],filterChange:[{type:m.Output}],remove:[{type:m.Output}]},I);function I(e,t){this.injecotr=e,this.cd=t,this.filterChange=new m.EventEmitter,this.remove=new m.EventEmitter,this.conditions=null,this.elRef=this.injecotr.get(m.ElementRef,null)}var P,V={provide:l.NG_VALUE_ACCESSOR,useExisting:m.forwardRef(function(){return D}),multi:!0},D=(x(O,P=C),Object.defineProperty(O.prototype,"hasFilter",{get:function(){return!(!this.displayTextList||!this.displayTextList.length)&&this.displayTextList.filter(function(e){return e.hasFilter}).length},enumerable:!0,configurable:!0}),O.prototype.ngOnInit=function(){var t=this;this.initDislayText(!!this.fields.filter(function(e){return e.value}).length),this.overLayService.registerMouseEvent(this.el.nativeElement,function(e){if(t.shadowBox&&t.showShadowBox){if(t.shadowBox.nativeElement.contains(e.target))return;if(e.target.closest(".f-search-field-container"))return;if(e.target.closest(".date-overlay-container")||-1<e.target.className.indexOf("date-overlay-container"))return;t.toggleShadowBox(!1),t.hideShadowbox.next(e)}})},O.prototype.ngAfterViewInit=function(){var e=this;setTimeout(function(){e.moveShadowToBody()})},O.prototype.ngOnChanges=function(e){},O.prototype.ngOnDestroy=function(){this.overLayService&&(this.overLayService=null),this.shadowBox&&this.shadowBox.nativeElement.remove()},O.prototype.filterChanged=function(){var r=this,e=this.fields.filter(function(e){return e.value}).map(function(n){var e=n.value,i=e.value,t=e.begin,a=e.end;return null!=i&&i!==undefined&&n.control.single?"datetime"===n.control.controltype?[{filterField:n.code,value:i,lbracket:"(",rbracket:"",relation:o.FilterRelation.And,compare:o.Compare.GreaterOrEqual},{filterField:n.code,value:r.dateHelp.formatTo(r.dateHelp.addDays(new Date(i),1),n.control.dateFormat),lbracket:"",rbracket:")",relation:o.FilterRelation.And,compare:o.Compare.Less}]:"enum"===n.control.controltype&&Array.isArray(i)?i.map(function(e,t){return{filterField:n.code,value:e,lbracket:t?"":"(",rbracket:t==i.length-1?")":"",relation:t==i.length-1?o.FilterRelation.And:o.FilterRelation.Or,compare:o.Compare.Equal}}):{filterField:n.code,value:Array.isArray(i)?i.join(","):i,lbracket:"",rbracket:"",relation:o.FilterRelation.And,compare:Array.isArray(i)?o.Compare.In:o.Compare.Equal}:""!==t&&null!=t&&t!=undefined&&""!==a&&null!=a&&a!=undefined?[{filterField:n.code,value:t,lbracket:"(",rbracket:"",relation:o.FilterRelation.And,compare:o.Compare.GreaterOrEqual},{filterField:n.code,value:a,lbracket:"",rbracket:")",relation:o.FilterRelation.And,compare:o.Compare.LessOrEqual}]:""!==t&&null!=t&&t!=undefined?{filterField:n.code,value:t,lbracket:"",rbracket:"",relation:o.FilterRelation.And,compare:o.Compare.GreaterOrEqual}:""!==a&&null!=a&&a!=undefined?{filterField:n.code,value:a,lbracket:"",rbracket:"",relation:o.FilterRelation.And,compare:o.Compare.LessOrEqual}:null}).filter(function(e){return e}),t=[];e&&e.length&&((t=f.flatten(e))[t.length-1].relation=o.FilterRelation.Empty),this.onModelChange(this.fields),this.onModelTouched(this.fields),this.conditionChange.emit(t)},O.prototype.setConditions=function(t){var e=this.fields.find(function(e){return e.code===t.field});e.value=t.value,e.control.single=t.value.single,this.initDislayText(),this.cd.detectChanges()},O.prototype.initDislayText=function(e){void 0===e&&(e=!0),this.displayTextList=this.fields.map(function(n){var e=b({},n);if(e.dislayText=e.name,e.hasFilter=!1,e.value){var t=e.value,i=t.value,a=t.begin,r=t.end,o=i;n.control&&n.control.enumValues&&n.control.enumValues.length?(Array.isArray(o)||(o=[o]),o=o.map(function(t){var e=n.control.enumValues.find(function(e){return e.value===t});return e?e.name:t}).join(",")):(null!==a&&a!==undefined&&(o=a),null!==r&&r!==undefined&&(null!=o?o+="~"+r:o=r)),e.dislayText+="："+o,e.hasFilter=!0}return e}),this.setMoreStatus(),e&&this.filterChanged()},O.prototype.remove=function(t){var e=this.fields.find(function(e){return e.code===t});e&&(e.value=null,this.initDislayText())},O.prototype.onRemoveItem=function(e,t){null!==t.value&&t.value!=undefined&&""!==t.value&&(e.stopPropagation(),this.remove(t.code))},O.prototype.clearConditions=function(e){void 0===e&&(e=!0),this.fields.forEach(function(e){return e.value=null}),this.initDislayText(e),e&&this.clear.emit(),this.cd.detectChanges()},O.prototype.writeValue=function(e){var t=e;Array.isArray(e)||(t=[]),this.fields=t,this.initDislayText()},O.prototype.registerOnChange=function(e){this.onModelChange=e},O.prototype.registerOnTouched=function(e){this.onModelTouched=e},O.prototype.setValue=function(e){},O.prototype.updateShadowBoxPosition=function(e){var t=void 0===e?{top:null,left:null,width:null}:e,n=t.top,i=t.left,a=t.width;if(!n&&!i&&!a){var r=this.el.nativeElement.getBoundingClientRect();n=r.top,i=r.left,a=r.width}this.render.setStyle(this.shadowBox.nativeElement,"left",i+"px"),this.render.setStyle(this.shadowBox.nativeElement,"top",n+"px"),this.render.setStyle(this.shadowBox.nativeElement,"width",a+"px"),this.render.setStyle(this.shadowBox.nativeElement,"zIndex",this.commonUtils.getFloatingLayerIndex())},O.prototype.moveShadowToBody=function(){this.enableFloat&&(this.updateShadowBoxPosition(),document.body.append(this.shadowBox.nativeElement))},O.prototype.toggleShadowBox=function(e,t){void 0===e&&(e=!0),void 0===t&&(t=null),this.enableFloat&&(t&&t.clientHeight<=30||((this.showShadowBox=e)?(this.updateShadowBoxPosition(),this.render.removeStyle(this.shadowBox.nativeElement,"display"),this.container.nativeElement.style.visibility="hidden",this.render.addClass(this.shadowBox.nativeElement,"active")):(this.container.nativeElement.style.visibility="visible",this.render.setStyle(this.shadowBox.nativeElement,"display","none"),this.render.removeClass(this.shadowBox.nativeElement,"active"))))},O.prototype.onResized=function(e){this.enableFloat&&(this.updateShadowBoxPosition(e),this.setMoreStatus())},O.prototype.setMoreStatus=function(){var t=this;this.enableFloat&&setTimeout(function(){var e=30<t.tagContainerRef.nativeElement.clientHeight;t.moreStatus$.next(e),t.cd.detectChanges()})},O.decorators=[{type:m.Component,args:[{selector:"farris-search-fields",template:'\r\n\x3c!-- [style.color]="hasFilter && (moreStatus$ | async) ? \'#529dff\': \'\'" --\x3e\r\n<div #searchbox class="input-group f-search-box f-search-fields" style="border-color: transparent" resizeObserver (resize)="onResized($event)" >\r\n    <div class="form-control f-cmp-inputgroup--multi-wrapper multi-more" style="min-height: 26px; padding: 0px 5px;" [style.height]="enableFloat? \'26px\': \'auto\'">\r\n        <div class="multi--content d-flex flex-row" [class.more]="moreStatus$ | async"\r\n         style="width: 100%;flex-wrap: wrap;align-items: center;cursor: text;" #tagContainer (click)="toggleShadowBox(true, tagContainer)">\r\n            <span class="multi--item search-tag-item search-field" [search-field]="txt" [class.search-field-remove]="txt.hasFilter" [class.has-filter]="txt.hasFilter"\r\n                *ngFor="let txt of displayTextList; let index" title="{{ txt.dislayText }}" [attr.field]="txt.code">\r\n                {{txt.dislayText}}\r\n                <i class="f-icon f-icon-arrow-chevron-down" [attr.title]="txt.hasFilter ? (\'searchbox.removeFilter\'| locale): \'\'" (click)="onRemoveItem($event, txt)"></i>\r\n            </span>\r\n        </div>\r\n    </div>\r\n</div>\r\n\r\n\r\n<div #searchbox2 class="input-group f-search-box f-cmp-inputgroup f-search-shadow-fields" style="position:absolute;display: none; z-index: 2999;" *ngIf="enableFloat" (mousedown)="$event.preventDefault()" >\r\n    <div class="form-control f-cmp-inputgroup--multi-wrapper multi-more pb-1 d-flex" style="height: auto; min-height: 26px;padding: 0 5px">\r\n        <div class="multi--content d-flex flex-row" style="width: 100%;flex-wrap: wrap;align-items: center;">\r\n            <span class="multi--item search-tag-item search-field" [search-field]="txt" [class.search-field-remove]="txt.hasFilter" [class.has-filter]="txt.hasFilter"\r\n                *ngFor="let txt of displayTextList; let index" title="{{ txt.dislayText }}" [attr.field]="txt.code">\r\n                {{txt.dislayText}}\r\n                <i class="f-icon f-icon-arrow-chevron-down" [attr.title]="txt.hasFilter ? (\'searchbox.removeFilter\'| locale): \'\'" (click)="onRemoveItem($event, txt)"></i>\r\n            </span>\r\n        </div>\r\n    </div>\r\n</div>\r\n',encapsulation:m.ViewEncapsulation.None,providers:[V]}]}],O.ctorParameters=function(){return[{type:m.ElementRef},{type:m.Injector},{type:c.OverLayHiddenService,decorators:[{type:m.Optional}]},{type:m.ChangeDetectorRef},{type:u.DateTimeHelperService}]},O.propDecorators={fields:[{type:m.Input}],maxSearchFields:[{type:m.Input}],condition:[{type:m.Input}],multi:[{type:m.Input}],container:[{type:m.ViewChild,args:["searchbox"]}],shadowBox:[{type:m.ViewChild,args:["searchbox2"]}],tagContainerRef:[{type:m.ViewChild,args:["tagContainer"]}],conditionChange:[{type:m.Output}],clear:[{type:m.Output}]},O);function O(e,t,n,i,a){var r=P.call(this,e,t,n,i)||this;return r.dateHelp=a,r.fields=[],r.maxSearchFields=5,r.condition=[],r.multi=!0,r.conditionChange=new m.EventEmitter,r.clear=new m.EventEmitter,r.enableFloat=!0,r.displayTextList=[],r.moreStatus$=new s.BehaviorSubject(!1),r.hideShadowbox=new s.Subject,r.showShadowBox=!1,r.onModelChange=function(e){},r.onModelTouched=function(e){},r}var M=(B.prototype.ngOnInit=function(){var t=this;this.searchFieldsRef&&this.searchFieldsRef.hideShadowbox.subscribe(function(e){t.removeFieldPanel()}),this.winResizeHandle=this.render.listen(window,"resize",function(){t.removeFieldPanel()})},B.prototype.ngAfterViewInit=function(){},B.prototype.ngOnDestroy=function(){this.removeFieldPanel(),this.winResizeHandle&&this.winResizeHandle()},B.prototype.onMouseDown=function(e){e.stopPropagation()},B.prototype.onFieldClick=function(e){e.stopPropagation(),this.panelElement?this.removeFieldPanel():this.createFieldPanel()},B.prototype.removeFieldPanel=function(){this.panelElement&&(this.panelElement.remove(),this.panelElement=null,this.searchFieldsRef.overLayService.destory(this.elRef.nativeElement),this.render.removeClass(this.elRef.nativeElement,"selected")),this.docKeydownEventHandle&&(this.docKeydownEventHandle(),this.docKeydownEventHandle=null)},B.prototype.registerKeyboardEvent=function(e){var t=this;return this.commonUtils?this.commonUtils.regBodyKeydownEvent(e,function(){t.removeFieldPanel()}):null},B.prototype.createFieldPanel=function(){var t=this;this.panelElement=document.createElement("div"),this.panelElement.classList.add("overlay-pane","f-filter-panel","f-area-hide","f-search-field-container");var e=""+this.searchFieldsRef.commonUtils.getFloatingLayerIndex();this.panelElement.style.zIndex=e,document.body.appendChild(this.panelElement),this.setPanelPosition();var n=this.cfr.resolveComponentFactory(k).create(this.injector);this._applicationRef.attachView(n.hostView),n.instance.fieldOptions=this.field,n.instance.conditions={field:this.field.code,value:this.field.value},this.panelElement.appendChild(n.location.nativeElement),this.panelElement.classList.add("f-area-show"),n.instance.filterChange.pipe(d.debounceTime(100)).subscribe(function(e){t.searchFieldsRef.setConditions(e)}),n.instance.remove.subscribe(function(e){t.searchFieldsRef.remove(e.code)}),n.changeDetectorRef.detectChanges(),this.searchFieldsRef.overLayService.registerMouseEvent(this.elRef.nativeElement,function(e){t.elRef.nativeElement.contains(e.target)||(e.target.closest(".f-search-field-container")?"BUTTON"===e.target.nodeName&&-1<e.target.className.indexOf("close-field-panel")&&t.removeFieldPanel():e.target.closest(".date-overlay-container")||-1<e.target.className.indexOf("date-overlay-container")||t.removeFieldPanel())}),this.render.addClass(this.elRef.nativeElement,"selected"),this.docKeydownEventHandle=this.registerKeyboardEvent(function(){var e=n.instance.btnSubmit;e&&!e.nativeElement.disabled&&(e.nativeElement.click(),t.removeFieldPanel())})},B.prototype.setPanelPosition=function(e){if(void 0===e&&(e=!0),this.panelElement){var t=this.getPanelSize(),n=t.width,i=t.left,a=t.top;t.height,this.panelElement.style.width=n+"px",e&&(this.panelElement.style.top=a+"px"),this.panelElement.style.left=i+"px"}},B.prototype.getInputSizeInfo=function(){return this.elRef.nativeElement.getBoundingClientRect()},B.prototype.getPanelSize=function(){var e=this.getInputSizeInfo(),t=e.top,n=e.left,i=e.height,a=window.innerHeight-i-t,r=190,o=a<t?t:a;return r<a?(t+=i,this.panelElement.style.transformOrigin="100% top"):a<t?(t=o<r?(r=o-10,10):t-parseInt(""+r,10)-5,this.panelElement.style.transformOrigin="100% bottom"):(o<r&&(r=o-10),t+=i),window.innerWidth-n<380&&(n=n+380-380),{width:380,top:t,height:r,left:n}},B.decorators=[{type:m.Directive,args:[{selector:"[search-field]"}]}],B.ctorParameters=function(){return[{type:m.Injector},{type:m.ElementRef},{type:m.NgZone},{type:m.Renderer2},{type:m.ComponentFactoryResolver},{type:D},{type:m.ApplicationRef}]},B.propDecorators={field:[{type:m.Input,args:["search-field"]}],onMouseDown:[{type:m.HostListener,args:["mousedown",["$event"]]}],onFieldClick:[{type:m.HostListener,args:["click",["$event"]]}]},B);function B(e,t,n,i,a,r,o){this.injector=e,this.elRef=t,this.ngzone=n,this.render=i,this.cfr=a,this.searchFieldsRef=r,this._applicationRef=o,this.winResizeHandle=null,this.docKeydownEventHandle=null,this.commonUtils=null,this.commonUtils=this.injector.get(c.CommonUtils,new c.CommonUtils)}var A=(H.prototype.onClick=function(e){e.stopPropagation()},H.prototype.ngOnInit=function(){},H.prototype.loadData=function(e){this.fields=e,this.cdr.destroyed||this.cdr.detectChanges()},H.prototype.onFieldItemClick=function(e,t){e.preventDefault(),this.itemClick.emit({data:t,evnet:e})},H.prototype.setActiveItem=function(e){this.activeIndex=e,this.cdr.destroyed||this.cdr.detectChanges()},H.prototype.setValue=function(e){this.searchKeyWord=e,this.cdr.detectChanges()},H.prototype.onClosePanel=function(e){e.stopPropagation(),this.closepanel.emit()},H.prototype.onMouseDown=function(e){e.preventDefault(),e.stopPropagation(),this.mouseDown.emit(e)},H.decorators=[{type:m.Component,args:[{selector:"search-panel",template:'<div class="d-flex flex-column px-2" style="width: 100%;height:100%;" #itemsContainer (mousedown)="onMouseDown($event)">\r\n    <div class="search-tip-info d-flex flex-row align-items-center" style="height: auto;line-height: normal;padding:7px" >{{\'searchbox.tips\' | locale}} <i class="f-icon f-icon-close" (click)="onClosePanel($event)"></i></div>\r\n    <div class="list f-utils-fill f-datalist" style="overflow: auto;">\r\n        <ul class="list-group list-group-flush p-0">\r\n            <li class="list-group-item list-group-item-action d-flex flex-row" [class.active]="activeIndex === i" \r\n                    *ngFor="let item of fields; index as i" (click)="onFieldItemClick($event, item)">\r\n                <span style="min-width: 60px; text-align:right" title="{{item.name}} ({{ item.code }})">{{ item.name }} </span>\r\n                <span class="mx-2 text-muted" >{{\'searchbox.contain\' | locale}}</span>\r\n                <div class="f-utils-fill text-primary search-box-keyword " [innerHTML]=" searchKeyWord | searchwords | safe: \'html\' "></div> \r\n            </li>\r\n        </ul>\r\n    </div>\r\n</div>',encapsulation:m.ViewEncapsulation.None}]}],H.ctorParameters=function(){return[{type:m.Injector},{type:m.ChangeDetectorRef}]},H.propDecorators={fields:[{type:m.Input}],maxItems:[{type:m.Input}],searchKeyWord:[{type:m.Input}],itemClick:[{type:m.Output}],closepanel:[{type:m.Output}],mouseDown:[{type:m.Output}],itemsContainer:[{type:m.ViewChild,args:["itemsContainer"]}],onClick:[{type:m.HostListener,args:["mousedown",["$event"]]}]},H);function H(e,t){this.injector=e,this.cdr=t,this.fields=[],this.maxItems=5,this.searchKeyWord="",this.itemClick=new m.EventEmitter,this.closepanel=new m.EventEmitter,this.mouseDown=new m.EventEmitter,this.activeIndex=-1}var _=(L.prototype.ngOnInit=function(){},L.prototype.ngAfterViewInit=function(){var t=this;(this.fields&&this.fields.length||this.useAnyField)&&(this.inputRef.inputClick.subscribe(function(e){e.stopPropagation()}),this.inputRef.valueChange.pipe(d.debounceTime(50)).subscribe(function(e){f.trim(e)?(t.panelElement||(t.createDataPanel(),t.searchPanelRef.instance.setActiveItem(0)),t.searchPanelRef.instance.setValue(e)):t.panelElement&&t.hide()}),this.searchBoxRef.clear.subscribe(function(){t.hide()}))},L.prototype.ngOnDestroy=function(){this.searchBoxRef.overLayService.destory(this.searchBoxRef.el.nativeElement)},L.prototype.removePanelElement=function(){document.body.removeChild(this.panelElement),this.panelElement=null,this.searchPanelRef&&(this.searchPanelRef.destroy(),this.searchPanelRef=null)},L.prototype.hide=function(e){var t=this;c.reqAnimFrame(function(){t.inputRef.value="",t.panelElement&&(!e||"mousewheel"!==e.type&&"wheel"!==e.type?(t.panelElement.classList.remove("f-area-show"),setTimeout(function(){t.removePanelElement()},120)):t.removePanelElement(),t.searchBoxRef.overLayService.destory(t.searchBoxRef.el.nativeElement))})},L.prototype.setPanelPosition=function(e){if(void 0===e&&(e=!0),this.panelElement){var t=this.getPanelSize(),n=t.maxWidth,i=t.left,a=t.top,r=t.height;this.panelElement.style.minWidth=this.minPanelWidth+"px",this.panelElement.style.maxWidth=n+"px",this.panelElement.style.maxHeight=r+"px",e&&(this.panelElement.style.top=a+"px"),this.panelElement.style.left=i+"px"}},L.prototype.createDataPanel=function(){var n=this;this.panelElement=document.createElement("div"),this.panelElement.classList.add("overlay-pane","f-search-box-panel","f-area-hide");var e=""+this.searchBoxRef.commonUtils.getFloatingLayerIndex();document.body.appendChild(this.panelElement),this.setPanelPosition(),this.panelElement.style.zIndex=e,this.panelElement.style.overflow="hidden";var t=this.cfr.resolveComponentFactory(A);if(this.searchPanelRef=t.create(this.injector),this.useAnyField&&!this.fields.find(function(e){return"*"===e.code})){var i=this.searchBoxRef.localeSer.getValue("searchbox.anyFields");this.fields.splice(0,0,{code:"*",name:i})}if(this.searchPanelRef.instance.fields=this.fields,this.panelElement.appendChild(this.searchPanelRef.location.nativeElement),this.searchPanelRef.changeDetectorRef.detectChanges(),this.searchPanelRef.instance.searchKeyWord=this.inputRef.value,this.searchPanelRef.instance.itemClick.subscribe(function(e){var t=e.data;n.selectItem(t)}),this.searchPanelRef.instance.closepanel.subscribe(function(){n.hide()}),this.searchBoxRef.overLayService.registerMouseEvent(this.searchBoxRef.el.nativeElement,function(e){if(n.panelElement&&!e.target.closest(".f-search-box-panel"))return(!n.inputRef||n.inputRef.textbox.nativeElement!==e.target)&&void n.hide(e)}),this.searchPanelRef.instance.fields.length+1<this.maxPanelItems){var a=this.searchPanelRef.instance.itemsContainer.nativeElement.querySelector("ul").offsetHeight+40;this.searchPanelRef.instance.itemsContainer.nativeElement.style.height=a+"px",this.panelElement&&(-1<this.panelElement.style.transformOrigin.indexOf("bottom")&&(this.panelElement.style.top=this.getInputSizeInfo().top-a-5+"px"),this.panelElement.style.height="auto")}else this.searchPanelRef.instance.itemsContainer.nativeElement.style.height="100%",this.panelElement&&this.render.removeStyle(this.panelElement,"height");this.panelElement.classList.add("f-area-show")},L.prototype.selectItem=function(e){e&&(this.searchBoxRef.select(b({},e,{value:this.inputRef.value})),this.hide(),this.inputRef.focus())},L.prototype.calculationPanelHeight=function(){return 30*this.maxPanelItems+15},L.prototype.getInputSizeInfo=function(){return(this.searchBoxRef.enableFloat?this.searchBoxRef.shadowBox:this.searchBoxRef.container).nativeElement.getBoundingClientRect()},L.prototype.getPanelSize=function(){var e=this.getInputSizeInfo(),t=e.width,n=e.height,i=e.top,a=e.left,r=window.innerHeight-n-i,o=this.calculationPanelHeight(),l=r<i?i:r;o<r?(i+=n,this.panelElement.style.transformOrigin="100% top"):r<i?(i=l<o?(o=l-10,10):i-parseInt(""+o,10)-5,this.panelElement.style.transformOrigin="100% bottom"):(l<o&&(o=l-10),i+=n);var s=t<this.minPanelWidth?this.minPanelWidth:t;return window.innerWidth-a<s&&(a=a+t-s),{width:s,top:i,height:o,left:a,maxWidth:Math.floor(window.innerWidth-a-10)}},L.prototype.registerKeyboardEvent=function(e){var t=this,n=this.fields;if(("ArrowUp"===e.code||"ArrowDown"===e.code)&&(e.preventDefault(),e.stopPropagation(),this.searchPanelRef)){var i=this.searchPanelRef.instance.activeIndex,a=function(e){t.searchPanelRef.instance.setActiveItem(e)};if("ArrowUp"===e.code)if(-1<i){var r=i-1;r<0&&(r=n.length-1),a(r)}else a(n.length-1);if("ArrowDown"===e.code){var o=i+1;o>=n.length&&(o=0),a(o)}}if("Backspace"===e.code&&!this.inputRef.value&&this.searchBoxRef.displayTextList&&this.searchBoxRef.displayTextList.length){e.preventDefault(),e.stopPropagation();var l=this.searchBoxRef.displayTextList[this.searchBoxRef.displayTextList.length-1];l&&(this.searchBoxRef.remove(l.code),this.searchPanelRef&&this.searchPanelRef.changeDetectorRef.detectChanges())}if("Enter"===e.key)if(n&&n.length&&this.panelElement){var s=n[i=this.searchPanelRef.instance.activeIndex];this.selectItem(s)}else this.searchBoxRef.onSubmit(e);"Escape"===e.key&&(this.panelElement?this.hide():this.escHandler.emit())},L.decorators=[{type:m.Directive,args:[{selector:"[search-box-panel]"}]}],L.ctorParameters=function(){return[{type:m.Injector},{type:m.NgZone},{type:m.Renderer2},{type:h.InputGroupComponent},{type:T},{type:m.ComponentFactoryResolver}]},L.propDecorators={fields:[{type:m.Input,args:["search-box-panel"]}],maxFields:[{type:m.Input}],useAnyField:[{type:m.Input}],escHandler:[{type:m.Output}],registerKeyboardEvent:[{type:m.HostListener,args:["keydown",["$event"]]}]},L);function L(e,t,n,i,a,r){this.injector=e,this.ngzone=t,this.render=n,this.inputRef=i,this.searchBoxRef=a,this.cfr=r,this.maxFields=5,this.useAnyField=!0,this.escHandler=new m.EventEmitter,this.maxPanelItems=10,this.minPanelWidth=270}var j=($.prototype.transform=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(e===undefined||null===e)return"";var i=this.searchBoxRef.localeSer.getValue("searchbox.relation.or"),a=e.trim().split(" ").filter(function(e){return e.trim()});return a.map(function(e,t){return e+(t===a.length-1?"":'<span class="text-muted" style="margin: 0 5px;"> '+i+" </span>")}).join("")},$.decorators=[{type:m.Pipe,args:[{name:"searchwords"}]}],$.ctorParameters=function(){return[{type:m.Injector},{type:T}]},$);function $(e,t){this.injector=e,this.searchBoxRef=t}var N=(z.prototype.ngOnInit=function(){if(this.dateTags=[{id:"tag1",text:this.localeService.getValue("filterPanel.last1Month")},{id:"tag2",text:this.localeService.getValue("filterPanel.last3Month")},{id:"tag3",text:this.localeService.getValue("filterPanel.last6Month")}],this.dayTags=[{id:"yesterday",text:this.localeService.getValue("filterPanel.yesterday")},{id:"today",text:this.localeService.getValue("filterPanel.today")}],this.field.control){var e=this.field.control,t=e.showTime,n=e.showType,i=e.single;if(this.field.value){var a=this.field.value,r=a.value,o=a.begin,l=a.end;this.value=r,this.beginValue=o,this.endValue=l}this.showTime=t,this.showType=n,this.single=i;var s=this.field.control.dateFormat;this.showTime&&s?0<s.length&&-1==s.indexOf("HH:mm")&&(s+=" HH:mm:ss"):s=this.showTime?"yyyy-MM-dd HH:mm:ss":"2"==this.showType?"yyyy-MM":"3"==this.showType?"yyyy":"yyyy-MM-dd",this.dateFormat=s}},z.prototype.onDateChange=function(e){this.valueChange.emit({field:this.field.code,value:{value:this.value,single:!0}})},z.prototype.beginValueChange=function(e){this.valueChange.emit({field:this.field.code,value:{begin:this.beginValue,end:this.endValue,single:!1}})},z.prototype.endValueChange=function(e){this.valueChange.emit({field:this.field.code,value:{begin:this.beginValue,end:this.endValue,single:!1}})},z.prototype.onSingleChange=function(e){this.single=!e,this.valueChange.emit({field:this.field.code,value:{value:this.value,begin:this.beginValue,end:this.endValue,single:this.single}}),this.cd.detectChanges()},z.prototype.clickTag=function(e){var t;this.activedDateTagId=e.id,"tag1"==e.id?t=this.getLastNumMonth(1,this.showTime,this.showType):"tag2"==e.id?t=this.getLastNumMonth(3,this.showTime,this.showType):"tag3"==e.id&&(t=this.getLastNumMonth(6,this.showTime,this.showType)),this.beginValue=t.startTime,this.endValue=t.endTime,this.valueChange.emit({field:this.field.code,value:{value:this.value,begin:this.beginValue,end:this.endValue,single:this.single}}),this.cd.detectChanges()},z.prototype.clickDayTag=function(e){this.activedDayTagId=e.id;var t=this.getToday(this.activedDayTagId,this.showTime);this.value=t,this.valueChange.emit({field:this.field.code,value:{value:this.value,single:!0}})},z.prototype.getLastNumMonth=function(e,t,n){var i=new Date,a=i.getFullYear(),r=i.getMonth()+1,o=i.getDate(),l={},s=i.getHours()+":"+(i.getMinutes()<10?"0"+(new Date).getMinutes():(new Date).getMinutes())+":"+((new Date).getSeconds()<10?"0"+(new Date).getSeconds():(new Date).getSeconds()),c=r<10?"0"+r:r,h=o<10?"0"+o:o;l.endTime="2"==n?a+"-"+c:"3"==n?a:a+"-"+c+"-"+h;var d,u,p,f,m=new Date(a,r,0).getDate();return p=r-e<=0?(f=new Date(a-1,12-(e-r),0).getDate())<o?(d=a-1,u=12-(e-r),f):(d=a-1,u=12-(e-r),o):(f=new Date(a,r-e,0).getDate())<o?o<m?(d=a,u=r-e,f-(m-o)):(d=a,u=r-e,f):(d=a,u=r-e,o),u=u<10?"0"+u:u,p=p<10?"0"+p:p,l.startTime="2"==n?d+"-"+u:"3"==n?d:d+"-"+u+"-"+p,t&&(l.endTime=l.endTime+" "+s,l.startTime=l.startTime+" "+s),l},z.prototype.getToday=function(e,t){void 0===e&&(e="today");var n=new Date;return"today"==e?this.dateHelp.formatTo(n,this.dateFormat):"yesterday"==e?this.dateHelp.formatTo(this.dateHelp.subDays(n,1),this.dateFormat):void 0},z.decorators=[{type:m.Component,args:[{selector:"search-filed-editor-date",template:'\r\n<div class="f-panel-filter-tip">\r\n    <span class="panel-filter-tip-text">{{ \'filterPanel.intervalFilter\' | locale }}</span>\r\n    <farris-switch size="small" [checked]="!single" (valueChange)="onSingleChange($event)"></farris-switch>\r\n</div>\r\n\r\n<div class="f-panel-filter-content">\r\n    <ng-container *ngIf="single; else elseTemplate">\r\n        <ng-container *ngIf="showTime; else singleDefaultdate">\r\n            <farris-datepicker [(ngModel)]="value" [editable]="false" [returnFormat]="\'yyyy-MM-dd HH:mm:ss\'" [dateFormat]="dateFormat"\r\n             (valueChange)="onDateChange($event)" [placeholder]="placeholder" [showTime]="showTime" #datepicker></farris-datepicker>\r\n        </ng-container>\r\n        <ng-template #singleDefaultdate>\r\n            <farris-datepicker [(ngModel)]="value" [editable]="false" [returnFormat]="showType == \'2\'? \'yyyy-MM\': (showType == \'3\'? \'yyyy\':\'yyyy-MM-dd\')" \r\n            [dateFormat]="dateFormat" (valueChange)="onDateChange($event)" [placeholder]="placeholder" [showType]="showType" #datepicker></farris-datepicker>\r\n        </ng-template>\r\n    </ng-container>\r\n    <ng-template #elseTemplate>\r\n        <div class="d-flex align-items-center">\r\n            <ng-container *ngIf="showTime;else startDefaultdate">\r\n                <farris-datepicker [(ngModel)]="beginValue" [editable]="false" [returnFormat]="\'yyyy-MM-dd HH:mm:ss\'" [dateFormat]="dateFormat"\r\n                 (valueChange)="beginValueChange($event)" [placeholder]="beginPlaceHolder" [showTime]="showTime" [maxDate]="endValue" #datepicker></farris-datepicker>\r\n            </ng-container>\r\n            <ng-template #startDefaultdate>\r\n                <farris-datepicker [(ngModel)]="beginValue" [editable]="false" \r\n                [returnFormat]="showType == \'2\'? \'yyyy-MM\': (showType == \'3\'? \'yyyy\':\'yyyy-MM-dd\')" [dateFormat]="dateFormat" \r\n                (valueChange)="beginValueChange($event)" [placeholder]="beginPlaceHolder" [showType]="showType" [maxDate]="endValue" #datepicker></farris-datepicker>\r\n            </ng-template>\r\n            <span class="f-icon f-icon-orientation-arrow mx-2"></span>\r\n            <ng-container *ngIf="showTime;else endDefaultdate">\r\n                <farris-datepicker [(ngModel)]="endValue" [editable]="false" [returnFormat]="\'yyyy-MM-dd HH:mm:ss\'" \r\n                [dateFormat]="dateFormat" (valueChange)="endValueChange($event)" [placeholder]="endPlaceHolder" [showTime]="showTime" [minDate]="beginValue" #datepicker></farris-datepicker>\r\n            </ng-container>\r\n            <ng-template #endDefaultdate>\r\n                <farris-datepicker [(ngModel)]="endValue" [editable]="false" \r\n                [returnFormat]="showType == \'2\'? \'yyyy-MM\': (showType == \'3\'? \'yyyy\':\'yyyy-MM-dd\')" \r\n                [dateFormat]="dateFormat" (valueChange)="endValueChange($event)" [placeholder]="endPlaceHolder" [showType]="showType" [minDate]="beginValue" #datepicker></farris-datepicker>\r\n            </ng-template>\r\n        </div>\r\n    </ng-template>\r\n\r\n</div>\r\n<div class="f-filter-panel-date-tags" *ngIf="!single && showType !== \'3\'">\r\n    <div class="panel-date-tag" *ngFor="let tag of dateTags" (click)="clickTag(tag)" \r\n    [ngClass]="{\'active\': tag.id == activedDateTagId}">\r\n        {{tag.text}}\r\n    </div>\r\n</div>\r\n\r\n<div class="f-filter-panel-date-tags" *ngIf="single && showType !== \'3\' && showType !== \'2\'">\r\n    <div class="panel-date-tag" *ngFor="let day of dayTags" (click)="clickDayTag(day)" [ngClass]="{\'active\': day.id == activedDayTagId}">\r\n        {{day.text}}\r\n    </div>\r\n</div>'}]}],z.ctorParameters=function(){return[{type:p.LocaleService},{type:m.Injector},{type:m.ChangeDetectorRef}]},z.propDecorators={field:[{type:m.Input}],valueChange:[{type:m.Output}]},z);function z(e,t,n){this.localeService=e,this.injector=t,this.cd=n,this.valueChange=new m.EventEmitter,this.single=!0,this.dateFormat="",this.showTime=!1,this.value="",this.beginValue="",this.endValue="",this.showType="1",this.placeholder="",this.endPlaceHolder="",this.beginPlaceHolder="",this.activedDateTagId="",this.activedDayTagId="",this.dateTags=[],this.dayTags=[],this.dateHelp=null,this.dateHelp=this.injector.get(u.DateTimeHelperService,new u.DateTimeHelperService)}var q=(K.prototype.ngOnInit=function(){if(this.single=this.field.control.single,this.field){if(this.field.value){var e=this.field.value,t=e.value,n=e.begin,i=e.end;this.value=t,this.beginValue=n,this.endValue=i}this.bigNumber=this.field.control.bigNumber,this.precision=this.field.control.precision||0,this.bigNumber||(this.min=-2147483648,this.max=2147483647)}},K.prototype.onSingleValueChange=function(e){this.single=!e,this.valueChange.emit({field:this.field.code,value:{value:this.value,end:this.endValue,begin:this.beginValue,single:this.single}}),this.cd.detectChanges()},K.prototype.onValueChange=function(e){this.valueChange.emit({field:this.field.code,value:{value:e,single:!0}})},K.prototype.onBeginValueChange=function(e){this.valueChange.emit({field:this.field.code,value:{begin:e,end:this.endValue,single:!1}})},K.prototype.onEndValueChange=function(e){this.valueChange.emit({field:this.field.code,value:{begin:this.beginValue,end:e,single:!1}})},K.decorators=[{type:m.Component,args:[{selector:"search-filed-editor-number",template:'<div class="f-panel-filter-tip">\r\n    <span class="panel-filter-tip-text">{{ \'filterPanel.intervalFilter\' | locale }}</span>\r\n    <farris-switch size="small" [checked]="!single" (valueChange)="onSingleValueChange($event)"></farris-switch>\r\n</div>\r\n<div class="f-panel-filter-content">\r\n    <ng-container *ngIf="single; else elseTemplate">\r\n        <farris-number-spinner\r\n            class="f-utils-fill-flex-row"\r\n            [(ngModel)]="value"\r\n            [precision]="precision"\r\n            [bigNumber]="bigNumber"\r\n            [canNull]="true"\r\n            [min]="min" [max]="max"\r\n            [placeholder]="placeholder"\r\n            (valueChange)="onValueChange($event)"\r\n            #numberText\r\n        ></farris-number-spinner>\r\n    </ng-container>\r\n    <ng-template #elseTemplate>\r\n        <div class="d-flex panel-flexible-range-wrapper">\r\n            <farris-number-spinner\r\n                [(ngModel)]="beginValue"\r\n                [precision]="precision"\r\n                [bigNumber]="bigNumber"\r\n                [canNull]="true"\r\n                [min]="min" [max]="endValue?endValue:max"\r\n                [placeholder]="beginPlaceHolder"\r\n                (valueChange)="onBeginValueChange($event)"\r\n                #beginNumberText\r\n            ></farris-number-spinner>\r\n            <span class="f-icon f-icon-orientation-arrow"></span>\r\n            <farris-number-spinner\r\n                [(ngModel)]="endValue"\r\n                [precision]="precision"\r\n                [bigNumber]="bigNumber"\r\n                [canNull]="true"\r\n                [min]="beginValue?beginValue:min" [max]="max"\r\n                [placeholder]="endPlaceHolder"\r\n                (valueChange)="onEndValueChange($event)"\r\n            ></farris-number-spinner>\r\n        </div>\r\n    </ng-template>\r\n    \r\n</div>'}]}],K.ctorParameters=function(){return[{type:m.Injector},{type:m.ChangeDetectorRef}]},K.propDecorators={field:[{type:m.Input}],valueChange:[{type:m.Output}]},K);function K(e,t){this.injecotr=e,this.cd=t,this.valueChange=new m.EventEmitter,this.single=!0}var U=(Object.defineProperty(W.prototype,"field",{get:function(){return this._item},set:function(e){this._item=f.cloneDeep(e),this.getDataSource(),this._item.hasOwnProperty("value")||(this._item.value={value:[]}),this._item.hasOwnProperty("value")&&this._item.value?this.checkValue=this._item.value.value:this._item.value={value:[]},0==this._item.value.value.length?this.checkedAll=!1:this._item.control.enumValues&&this._item.value.value.length==this._item.control.enumValues.length&&(this.checkedAll=!0),this.setSubmitChange()},enumerable:!0,configurable:!0}),W.prototype.ngOnInit=function(){},W.prototype.getDataSource=function(){var t=this;if(this.field&&this._item.control){var e=this._item.control;this.checkboxDataSource=Array(),e.enumValues&&0<e.enumValues.length&&e.enumValues.forEach(function(e){t.checkboxDataSource.push(Object.assign({},e))})}},W.prototype.onSearch=function(e){var t=[];if(e){var n=e;n&&n.length&&(t=n),this._item.value.value=t}else this._item.value.value="";t.length<this._item.control.enumValues.length?this.checkedAll=!1:t.length==this._item.control.enumValues.length&&(this.checkedAll=!0),this.cd.detectChanges(),this.getValueText(),this.setSubmitChange(),this.valueChange.emit({field:this.field.code,value:{value:t,single:!0}})},W.prototype.getValueText=function(){var n=this._item.control.enumValues,i=this._item.value.value;if(n&&n.length&&i&&i.length){for(var a=[],e=function(t){var e=n.find(function(e){return e.value==i[t]});e&&a.push(e.name)},t=0;t<=i.length;t++)e(t);this._item.valueText=a.join(",")}},W.prototype.setSubmitChange=function(){var e=this._item.value;Object.keys(e).length<0||Object.keys(e.value).length},W.prototype.onCheckAll=function(e){this.checkedAll=!this.checkedAll,this.checkedAll?this.setCheckedAll():(this._item.value.value=[],this._item.valueText="",this.checkValue=[]),this.getValueText(),this.setSubmitChange(),this.cd.detectChanges(),this.valueChange.emit({field:this.field.code,value:{value:this.checkValue,single:!0}})},W.prototype.setCheckedAll=function(){var e=this._item.control.enumValues;if(e&&e.length){for(var t=[],n=0;n<e.length;n++)t.push(e[n].value);this._item.value.value=t,this.checkValue=this._item.value.value,this.cd.detectChanges()}},W.decorators=[{type:m.Component,args:[{selector:"search-filed-editor-enum",template:'<div class="custom-control custom-checkbox custom-control-inline filter-panel-checkbox" style="padding-left: 10px;">\r\n    <input type="checkbox" class="custom-control-input"  [checked]="checkedAll" #checkAllEl>\r\n    <label class="custom-control-label" (click)="onCheckAll($event)">{{\'filterPanel.checkall\'| locale}}</label>\r\n</div>\r\n<farris-checkboxgroup [value]="checkValue" [horizontal]="false" style="padding-left: 10px;"\r\n    [data]="checkboxDataSource" [isStringValue]="false" (changeValue)="onSearch($event)">\r\n</farris-checkboxgroup>\r\n'}]}],W.ctorParameters=function(){return[{type:m.Injector},{type:m.ChangeDetectorRef}]},W.propDecorators={boolcheck:[{type:m.Input}],field:[{type:m.Input}],valueChange:[{type:m.Output}],checkAllElRef:[{type:m.ViewChild,args:["checkAllEl"]}]},W);function W(e,t){this.injector=e,this.cd=t,this.checkedAll=!1,this.boolcheck=!1,this.valueChange=new m.EventEmitter,this.checkboxDataSource=new Array}var G=(Z.prototype.ngOnInit=function(){this.field&&(this.field.control&&(this.radioDataSource=this.field.control.enumValues||[]),this.field.value&&(this.selectedValue=this.field.value.value))},Z.prototype.ngAfterViewInit=function(){var t=this;if(null!==this.selectedValue&&this.selectedValue!==undefined){this._radioElements=Array.from(this.el.nativeElement.querySelectorAll("input"));var e=this._radioElements.find(function(e){return e.value==t.selectedValue});e&&(e.checked=!0)}},Z.prototype.onRadioClicked=function(e,t){this.selectedValue=t;var n=e.target.querySelector("input");n&&(this.clearChecked(),n.checked=!0,this.cd.detectChanges()),this.valueChange.emit({field:this.field.code,value:{value:this.selectedValue,single:!0}})},Z.prototype.clearChecked=function(){this._radioElements&&this._radioElements.length||(this._radioElements=Array.from(this.el.nativeElement.querySelectorAll("input"))),this._radioElements.forEach(function(e){e.checked=!1})},Z.decorators=[{type:m.Component,args:[{selector:"search-field-editor-bool",template:'<div class="f-filter-panel-radiogroup">\r\n    <div class="panel-radiogroup-item" \r\n    [ngClass]="{\'panel-radiogroup-item-active\': selectedValue == item.value}"\r\n    *ngFor="let item of radioDataSource"\r\n    (click)="onRadioClicked($event, item.value)"\r\n    >\r\n        \r\n\r\n        <div class="custom-control custom-radio">\r\n            <input class="custom-control-input" name="{{field.code}}" id="{{\'search_radio_\' + item.value}}" type="radio" [attr.value]="item.value">\r\n            <label class="custom-control-label" for="{{\'search_radio_\' + item.value}}">{{item.name}}</label>\r\n        </div>\r\n\r\n\r\n    </div>\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n</div>'}]}],Z.ctorParameters=function(){return[{type:m.Injector},{type:m.ChangeDetectorRef},{type:m.ElementRef}]},Z.propDecorators={field:[{type:m.Input}],valueChange:[{type:m.Output}]},Z);function Z(e,t,n){this.injector=e,this.cd=t,this.el=n,this.radioDataSource=[],this.selectedValue=undefined,this.valueChange=new m.EventEmitter,this._radioElements=[]}var X=(Y.prototype.transform=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var i=!1;if(e){var a=e.value,r=e.begin,o=e.end,l=e.single;i=this.isNil(l)?!this.isNil(a):l?!this.isNil(a):!this.isNil(r)||!this.isNil(o)}return!i},Y.decorators=[{type:m.Pipe,args:[{name:"canclear"}]}],Y);function Y(){this.isNil=function(e){return null===e||e===undefined||""===e||Array.isArray(e)&&!e.length}}var J=(Q.decorators=[{type:m.NgModule,args:[{declarations:[T,A,_,j,D,M,k,N,q,U,G,X],imports:[t.CommonModule,l.FormsModule,c.FarrisCommonModule.forRoot(),h.InputGroupModule,p.LocaleModule.forRoot(),n.FarrisDatePickerModule,i.SwitchModule,a.NumberSpinnerModule,r.FarrisFormsModule,u.DateHelperModule.forRoot()],entryComponents:[A,k],exports:[T,A,_,j,D,M,k,N,q,U,G]}]}],Q);function Q(){}e.SearchPanelComponent=A,e.SearchPanelDirective=_,e.SearchWordPipe=j,e.SearchFieldsComponent=D,e.SearchFieldPanelComponent=k,e.SearchFieldDirective=M,e.SearchFieldFlexibleDateComponent=N,e.SearchFieldFlexibleNumberComponent=q,e.SearchFieldEnumEditorComponent=U,e.SearchFieldEditorBooleanComponent=G,e.SearchFieldCanClearPipe=X,e.SearchBoxBase=C,e.SearchBoxService=v,e.SEARCH_BOX_VALUE_ACCESSOR=F,e.SearchBoxComponent=T,e.SearchBoxModule=J,e.ɵa=V,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=farris-ui-search-box.umd.min.js.map
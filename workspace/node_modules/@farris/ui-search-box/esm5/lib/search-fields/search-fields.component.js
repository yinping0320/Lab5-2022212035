/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { ChangeDetectorRef, Component, ElementRef, EventEmitter, forwardRef, Injector, Input, Optional, Output, ViewChild, ViewEncapsulation } from "@angular/core";
import { OverLayHiddenService } from "@farris/ui-common";
import { Compare, FilterRelation } from "@farris/ui-common/types";
import { flatten } from 'lodash-es';
import { NG_VALUE_ACCESSOR } from "@angular/forms";
import { BehaviorSubject, Subject } from "rxjs";
import { SearchBoxBase } from "../search-box-base";
import { DateTimeHelperService } from "@farris/ui-common/date";
/** @type {?} */
export var SEARCH_BOX_VALUE_ACCESSOR = {
    provide: NG_VALUE_ACCESSOR,
    useExisting: forwardRef((/**
     * @return {?}
     */
    function () { return SearchFieldsComponent; })),
    multi: true
};
var SearchFieldsComponent = /** @class */ (function (_super) {
    tslib_1.__extends(SearchFieldsComponent, _super);
    function SearchFieldsComponent(el, injector, overLayService, cd, dateHelp) {
        var _this = _super.call(this, el, injector, overLayService, cd) || this;
        _this.dateHelp = dateHelp;
        _this.fields = [];
        _this.maxSearchFields = 5;
        _this.condition = [];
        /**
         * 多字段查询
         */
        _this.multi = true;
        _this.conditionChange = new EventEmitter();
        _this.clear = new EventEmitter();
        /**
         * 启用漂浮，false: 内容会撑高容器； true：固定高度26px，点击或滑过时，显示完整内容，失去焦点后，返回固定状态
         */
        _this.enableFloat = true;
        _this.displayTextList = [];
        // filterConditions: Array<SearchFieldValue> = [];
        _this.moreStatus$ = new BehaviorSubject(false);
        _this.hideShadowbox = new Subject();
        _this.showShadowBox = false;
        _this.onModelChange = (/**
         * @param {?} arr
         * @return {?}
         */
        function (arr) { });
        _this.onModelTouched = (/**
         * @param {?} arr
         * @return {?}
         */
        function (arr) { });
        return _this;
    }
    Object.defineProperty(SearchFieldsComponent.prototype, "hasFilter", {
        get: /**
         * @return {?}
         */
        function () {
            return this.displayTextList && this.displayTextList.length ? this.displayTextList.filter((/**
             * @param {?} n
             * @return {?}
             */
            function (n) { return n.hasFilter; })).length : false;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    SearchFieldsComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.initDislayText(!!this.fields.filter((/**
         * @param {?} n
         * @return {?}
         */
        function (n) { return n.value; })).length);
        this.overLayService.registerMouseEvent(this.el.nativeElement, (/**
         * @param {?} e
         * @return {?}
         */
        function (e) {
            if (_this.shadowBox && _this.showShadowBox) {
                if (_this.shadowBox.nativeElement.contains(e.target)) {
                    return;
                }
                if (e.target.closest('.f-search-field-container')) {
                    return;
                }
                if (e.target.closest('.date-overlay-container') || e.target.className.indexOf('date-overlay-container') > -1) {
                    return;
                }
                _this.toggleShadowBox(false);
                _this.hideShadowbox.next(e);
            }
        }));
    };
    /**
     * @return {?}
     */
    SearchFieldsComponent.prototype.ngAfterViewInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        setTimeout((/**
         * @return {?}
         */
        function () {
            _this.moveShadowToBody();
        }));
    };
    /**
     * @param {?} changes
     * @return {?}
     */
    SearchFieldsComponent.prototype.ngOnChanges = /**
     * @param {?} changes
     * @return {?}
     */
    function (changes) {
    };
    /**
     * @return {?}
     */
    SearchFieldsComponent.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        if (this.overLayService) {
            this.overLayService = null;
        }
        if (this.shadowBox) {
            this.shadowBox.nativeElement.remove();
        }
    };
    /**
     * @private
     * @return {?}
     */
    SearchFieldsComponent.prototype.filterChanged = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        /** @type {?} */
        var conditions = this.fields.filter((/**
         * @param {?} n
         * @return {?}
         */
        function (n) { return n.value; })).map((/**
         * @param {?} n
         * @return {?}
         */
        function (n) {
            var _a = n.value, value = _a.value, begin = _a.begin, end = _a.end;
            if (value != null && value !== undefined && n.control.single) {
                if (n.control.controltype === 'datetime') {
                    return [{
                            filterField: n.code,
                            value: value,
                            lbracket: '(',
                            rbracket: '',
                            relation: FilterRelation.And,
                            compare: Compare.GreaterOrEqual
                        },
                        {
                            filterField: n.code,
                            value: _this.dateHelp.formatTo(_this.dateHelp.addDays(new Date(value), 1), n.control.dateFormat),
                            lbracket: '',
                            rbracket: ')',
                            relation: FilterRelation.And,
                            compare: Compare.Less
                        }];
                }
                else if (n.control.controltype === 'enum' && Array.isArray(value)) {
                    return value.map((/**
                     * @param {?} e
                     * @param {?} i
                     * @return {?}
                     */
                    function (e, i) {
                        return {
                            filterField: n.code,
                            value: e,
                            lbracket: i ? '' : '(',
                            rbracket: i == value.length - 1 ? ')' : '',
                            relation: i == value.length - 1 ? FilterRelation.And : FilterRelation.Or,
                            compare: Compare.Equal
                        };
                    }));
                }
                return {
                    filterField: n.code,
                    value: Array.isArray(value) ? value.join(',') : value,
                    lbracket: '',
                    rbracket: '',
                    relation: FilterRelation.And,
                    compare: Array.isArray(value) ? Compare.In : Compare.Equal
                };
            }
            else {
                if (begin !== '' && begin != null && begin != undefined && end !== '' && end != null && end != undefined) {
                    return [
                        {
                            filterField: n.code,
                            value: begin,
                            lbracket: '(',
                            rbracket: '',
                            relation: FilterRelation.And,
                            compare: Compare.GreaterOrEqual
                        },
                        {
                            filterField: n.code,
                            value: end,
                            lbracket: '',
                            rbracket: ')',
                            relation: FilterRelation.And,
                            compare: Compare.LessOrEqual
                        }
                    ];
                }
                else {
                    if (begin !== '' && begin != null && begin != undefined) {
                        return {
                            filterField: n.code,
                            value: begin,
                            lbracket: '',
                            rbracket: '',
                            relation: FilterRelation.And,
                            compare: Compare.GreaterOrEqual
                        };
                    }
                    if (end !== '' && end != null && end != undefined) {
                        return {
                            filterField: n.code,
                            value: end,
                            lbracket: '',
                            rbracket: '',
                            relation: FilterRelation.And,
                            compare: Compare.LessOrEqual
                        };
                    }
                }
                return null;
            }
        })).filter((/**
         * @param {?} n
         * @return {?}
         */
        function (n) { return n; }));
        /** @type {?} */
        var _conditions = [];
        if (conditions && conditions.length) {
            _conditions = flatten(conditions);
            _conditions[_conditions.length - 1].relation = FilterRelation.Empty;
        }
        this.onModelChange(this.fields);
        this.onModelTouched(this.fields);
        this.conditionChange.emit(_conditions);
    };
    /**
     * @param {?} condition
     * @return {?}
     */
    SearchFieldsComponent.prototype.setConditions = /**
     * @param {?} condition
     * @return {?}
     */
    function (condition) {
        /** @type {?} */
        var field = this.fields.find((/**
         * @param {?} n
         * @return {?}
         */
        function (n) { return n.code === condition.field; }));
        field.value = condition.value;
        field.control.single = condition.value.single;
        this.initDislayText();
        this.cd.detectChanges();
    };
    /**
     * @private
     * @param {?=} emit
     * @return {?}
     */
    SearchFieldsComponent.prototype.initDislayText = /**
     * @private
     * @param {?=} emit
     * @return {?}
     */
    function (emit) {
        if (emit === void 0) { emit = true; }
        this.displayTextList = this.fields.map((/**
         * @param {?} t
         * @return {?}
         */
        function (t) {
            /** @type {?} */
            var n = tslib_1.__assign({}, t);
            n.dislayText = n.name;
            n.hasFilter = false;
            if (n.value) {
                var _a = n.value, value = _a.value, begin = _a.begin, end = _a.end;
                /** @type {?} */
                var val = value;
                if (t.control && t.control.enumValues && t.control.enumValues.length) {
                    if (!Array.isArray(val)) {
                        val = [val];
                    }
                    val = val.map((/**
                     * @param {?} n
                     * @return {?}
                     */
                    function (n) {
                        /** @type {?} */
                        var d = t.control.enumValues.find((/**
                         * @param {?} e
                         * @return {?}
                         */
                        function (e) { return e.value === n; }));
                        if (d) {
                            return d.name;
                        }
                        return n;
                    })).join(',');
                }
                else {
                    if (begin !== null && begin !== undefined) {
                        val = begin;
                    }
                    if (end !== null && end !== undefined) {
                        if (val != null) {
                            val += '~' + end;
                        }
                        else {
                            val = end;
                        }
                    }
                }
                n.dislayText += '：' + val;
                n.hasFilter = true;
            }
            return n;
        }));
        this.setMoreStatus();
        if (emit) {
            this.filterChanged();
        }
    };
    /**
     * @param {?} field
     * @return {?}
     */
    SearchFieldsComponent.prototype.remove = /**
     * @param {?} field
     * @return {?}
     */
    function (field) {
        /** @type {?} */
        var searchField = this.fields.find((/**
         * @param {?} n
         * @return {?}
         */
        function (n) { return n.code === field; }));
        if (searchField) {
            searchField.value = null;
            this.initDislayText();
        }
    };
    /**
     * @param {?} $event
     * @param {?} item
     * @return {?}
     */
    SearchFieldsComponent.prototype.onRemoveItem = /**
     * @param {?} $event
     * @param {?} item
     * @return {?}
     */
    function ($event, item) {
        if (item.value !== null && item.value != undefined && item.value !== '') {
            $event.stopPropagation();
            this.remove(item.code);
        }
    };
    /**
     * @param {?=} emit
     * @return {?}
     */
    SearchFieldsComponent.prototype.clearConditions = /**
     * @param {?=} emit
     * @return {?}
     */
    function (emit) {
        if (emit === void 0) { emit = true; }
        this.fields.forEach((/**
         * @param {?} n
         * @return {?}
         */
        function (n) { return n.value = null; }));
        this.initDislayText(emit);
        if (emit) {
            this.clear.emit();
        }
        this.cd.detectChanges();
    };
    /**
     * @param {?} obj
     * @return {?}
     */
    SearchFieldsComponent.prototype.writeValue = /**
     * @param {?} obj
     * @return {?}
     */
    function (obj) {
        /** @type {?} */
        var arr = obj;
        if (!Array.isArray(obj)) {
            arr = [];
        }
        this.fields = arr;
        this.initDislayText();
    };
    /**
     * @param {?} fn
     * @return {?}
     */
    SearchFieldsComponent.prototype.registerOnChange = /**
     * @param {?} fn
     * @return {?}
     */
    function (fn) {
        this.onModelChange = fn;
    };
    /**
     * @param {?} fn
     * @return {?}
     */
    SearchFieldsComponent.prototype.registerOnTouched = /**
     * @param {?} fn
     * @return {?}
     */
    function (fn) {
        this.onModelTouched = fn;
    };
    /**
     * @param {?} arr
     * @return {?}
     */
    SearchFieldsComponent.prototype.setValue = /**
     * @param {?} arr
     * @return {?}
     */
    function (arr) {
        // this.filterConditions = arr;
        // this.initDislayText();
    };
    /**
     * @param {?=} __0
     * @return {?}
     */
    SearchFieldsComponent.prototype.updateShadowBoxPosition = /**
     * @param {?=} __0
     * @return {?}
     */
    function (_a) {
        var _b = _a === void 0 ? { top: null, left: null, width: null } : _a, top = _b.top, left = _b.left, width = _b.width;
        if (!top && !left && !width) {
            /** @type {?} */
            var e = this.el.nativeElement.getBoundingClientRect();
            top = e.top;
            left = e.left;
            width = e.width;
        }
        this.render.setStyle(this.shadowBox.nativeElement, 'left', left + 'px');
        this.render.setStyle(this.shadowBox.nativeElement, 'top', top + 'px');
        this.render.setStyle(this.shadowBox.nativeElement, 'width', width + 'px');
        this.render.setStyle(this.shadowBox.nativeElement, 'zIndex', this.commonUtils.getFloatingLayerIndex());
    };
    /**
     * @private
     * @return {?}
     */
    SearchFieldsComponent.prototype.moveShadowToBody = /**
     * @private
     * @return {?}
     */
    function () {
        if (!this.enableFloat) {
            return;
        }
        this.updateShadowBoxPosition();
        document.body.append(this.shadowBox.nativeElement);
    };
    /**
     * @param {?=} show
     * @param {?=} el
     * @return {?}
     */
    SearchFieldsComponent.prototype.toggleShadowBox = /**
     * @param {?=} show
     * @param {?=} el
     * @return {?}
     */
    function (show, el) {
        if (show === void 0) { show = true; }
        if (el === void 0) { el = null; }
        if (!this.enableFloat) {
            return;
        }
        if (el && el.clientHeight <= 30) {
            return;
        }
        this.showShadowBox = show;
        if (show) {
            this.updateShadowBoxPosition();
            this.render.removeStyle(this.shadowBox.nativeElement, 'display');
            this.container.nativeElement.style.visibility = 'hidden';
            this.render.addClass(this.shadowBox.nativeElement, 'active');
        }
        else {
            this.container.nativeElement.style.visibility = 'visible';
            this.render.setStyle(this.shadowBox.nativeElement, 'display', 'none');
            this.render.removeClass(this.shadowBox.nativeElement, 'active');
        }
    };
    /**
     * @param {?} $event
     * @return {?}
     */
    SearchFieldsComponent.prototype.onResized = /**
     * @param {?} $event
     * @return {?}
     */
    function ($event) {
        if (this.enableFloat) {
            this.updateShadowBoxPosition($event);
            this.setMoreStatus();
        }
    };
    /**
     * @private
     * @return {?}
     */
    SearchFieldsComponent.prototype.setMoreStatus = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        if (this.enableFloat) {
            setTimeout((/**
             * @return {?}
             */
            function () {
                /** @type {?} */
                var r = _this.tagContainerRef.nativeElement.clientHeight > 30;
                _this.moreStatus$.next(r);
                _this.cd.detectChanges();
            }));
        }
    };
    SearchFieldsComponent.decorators = [
        { type: Component, args: [{
                    selector: 'farris-search-fields',
                    template: "\r\n<!-- [style.color]=\"hasFilter && (moreStatus$ | async) ? '#529dff': ''\" -->\r\n<div #searchbox class=\"input-group f-search-box f-search-fields\" style=\"border-color: transparent\" resizeObserver (resize)=\"onResized($event)\" >\r\n    <div class=\"form-control f-cmp-inputgroup--multi-wrapper multi-more\" style=\"min-height: 26px; padding: 0px 5px;\" [style.height]=\"enableFloat? '26px': 'auto'\">\r\n        <div class=\"multi--content d-flex flex-row\" [class.more]=\"moreStatus$ | async\"\r\n         style=\"width: 100%;flex-wrap: wrap;align-items: center;cursor: text;\" #tagContainer (click)=\"toggleShadowBox(true, tagContainer)\">\r\n            <span class=\"multi--item search-tag-item search-field\" [search-field]=\"txt\" [class.search-field-remove]=\"txt.hasFilter\" [class.has-filter]=\"txt.hasFilter\"\r\n                *ngFor=\"let txt of displayTextList; let index\" title=\"{{ txt.dislayText }}\" [attr.field]=\"txt.code\">\r\n                {{txt.dislayText}}\r\n                <i class=\"f-icon f-icon-arrow-chevron-down\" [attr.title]=\"txt.hasFilter ? ('searchbox.removeFilter'| locale): ''\" (click)=\"onRemoveItem($event, txt)\"></i>\r\n            </span>\r\n        </div>\r\n    </div>\r\n</div>\r\n\r\n\r\n<div #searchbox2 class=\"input-group f-search-box f-cmp-inputgroup f-search-shadow-fields\" style=\"position:absolute;display: none; z-index: 2999;\" *ngIf=\"enableFloat\" (mousedown)=\"$event.preventDefault()\" >\r\n    <div class=\"form-control f-cmp-inputgroup--multi-wrapper multi-more pb-1 d-flex\" style=\"height: auto; min-height: 26px;padding: 0 5px\">\r\n        <div class=\"multi--content d-flex flex-row\" style=\"width: 100%;flex-wrap: wrap;align-items: center;\">\r\n            <span class=\"multi--item search-tag-item search-field\" [search-field]=\"txt\" [class.search-field-remove]=\"txt.hasFilter\" [class.has-filter]=\"txt.hasFilter\"\r\n                *ngFor=\"let txt of displayTextList; let index\" title=\"{{ txt.dislayText }}\" [attr.field]=\"txt.code\">\r\n                {{txt.dislayText}}\r\n                <i class=\"f-icon f-icon-arrow-chevron-down\" [attr.title]=\"txt.hasFilter ? ('searchbox.removeFilter'| locale): ''\" (click)=\"onRemoveItem($event, txt)\"></i>\r\n            </span>\r\n        </div>\r\n    </div>\r\n</div>\r\n",
                    // styleUrls: [
                    //     `../searchbox-panel.scss`
                    // ],
                    encapsulation: ViewEncapsulation.None,
                    providers: [
                        SEARCH_BOX_VALUE_ACCESSOR
                    ]
                }] }
    ];
    /** @nocollapse */
    SearchFieldsComponent.ctorParameters = function () { return [
        { type: ElementRef },
        { type: Injector },
        { type: OverLayHiddenService, decorators: [{ type: Optional }] },
        { type: ChangeDetectorRef },
        { type: DateTimeHelperService }
    ]; };
    SearchFieldsComponent.propDecorators = {
        fields: [{ type: Input }],
        maxSearchFields: [{ type: Input }],
        condition: [{ type: Input }],
        multi: [{ type: Input }],
        container: [{ type: ViewChild, args: ['searchbox',] }],
        shadowBox: [{ type: ViewChild, args: ['searchbox2',] }],
        tagContainerRef: [{ type: ViewChild, args: ['tagContainer',] }],
        conditionChange: [{ type: Output }],
        clear: [{ type: Output }]
    };
    return SearchFieldsComponent;
}(SearchBoxBase));
export { SearchFieldsComponent };
if (false) {
    /** @type {?} */
    SearchFieldsComponent.prototype.fields;
    /** @type {?} */
    SearchFieldsComponent.prototype.maxSearchFields;
    /** @type {?} */
    SearchFieldsComponent.prototype.condition;
    /**
     * 多字段查询
     * @type {?}
     */
    SearchFieldsComponent.prototype.multi;
    /** @type {?} */
    SearchFieldsComponent.prototype.container;
    /** @type {?} */
    SearchFieldsComponent.prototype.shadowBox;
    /** @type {?} */
    SearchFieldsComponent.prototype.tagContainerRef;
    /** @type {?} */
    SearchFieldsComponent.prototype.conditionChange;
    /** @type {?} */
    SearchFieldsComponent.prototype.clear;
    /**
     * 启用漂浮，false: 内容会撑高容器； true：固定高度26px，点击或滑过时，显示完整内容，失去焦点后，返回固定状态
     * @type {?}
     */
    SearchFieldsComponent.prototype.enableFloat;
    /** @type {?} */
    SearchFieldsComponent.prototype.displayTextList;
    /** @type {?} */
    SearchFieldsComponent.prototype.moreStatus$;
    /** @type {?} */
    SearchFieldsComponent.prototype.hideShadowbox;
    /**
     * @type {?}
     * @private
     */
    SearchFieldsComponent.prototype.showShadowBox;
    /** @type {?} */
    SearchFieldsComponent.prototype.onModelChange;
    /** @type {?} */
    SearchFieldsComponent.prototype.onModelTouched;
    /**
     * @type {?}
     * @private
     */
    SearchFieldsComponent.prototype.dateHelp;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2VhcmNoLWZpZWxkcy5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL3VpLXNlYXJjaC1ib3gvIiwic291cmNlcyI6WyJsaWIvc2VhcmNoLWZpZWxkcy9zZWFyY2gtZmllbGRzLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFBaUIsaUJBQWlCLEVBQUUsU0FBUyxFQUFFLFVBQVUsRUFBRSxZQUFZLEVBQUUsVUFBVSxFQUN0RixRQUFRLEVBQUUsS0FBSyxFQUFnQyxRQUFRLEVBQUUsTUFBTSxFQUE0QixTQUFTLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDbkosT0FBTyxFQUFFLG9CQUFvQixFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFDekQsT0FBTyxFQUFFLE9BQU8sRUFBbUIsY0FBYyxFQUFFLE1BQU0seUJBQXlCLENBQUM7QUFFbkYsT0FBTyxFQUFFLE9BQU8sRUFBRSxNQUFNLFdBQVcsQ0FBQztBQUNwQyxPQUFPLEVBQXdCLGlCQUFpQixFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDekUsT0FBTyxFQUFFLGVBQWUsRUFBTSxPQUFPLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDcEQsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLG9CQUFvQixDQUFDO0FBQ25ELE9BQU8sRUFBRSxxQkFBcUIsRUFBRSxNQUFNLHdCQUF3QixDQUFDOztBQUUvRCxNQUFNLEtBQU8seUJBQXlCLEdBQVE7SUFDMUMsT0FBTyxFQUFFLGlCQUFpQjtJQUMxQixXQUFXLEVBQUUsVUFBVTs7O0lBQUMsY0FBTSxPQUFBLHFCQUFxQixFQUFyQixDQUFxQixFQUFDO0lBQ3BELEtBQUssRUFBRSxJQUFJO0NBQ2Q7QUFFRDtJQVcyQyxpREFBYTtJQTZCcEQsK0JBQVksRUFBYyxFQUFFLFFBQWtCLEVBQWMsY0FBb0MsRUFBRSxFQUFxQixFQUFVLFFBQStCO1FBQWhLLFlBQ0ksa0JBQU0sRUFBRSxFQUFFLFFB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Q2xDLCtDQUFtQzs7Ozs7SUFsRHNGLHlDQUF1QyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFmdGVyVmlld0luaXQsIENoYW5nZURldGVjdG9yUmVmLCBDb21wb25lbnQsIEVsZW1lbnRSZWYsIEV2ZW50RW1pdHRlciwgZm9yd2FyZFJlZiwgSG9zdEJpbmRpbmcsIEhvc3RMaXN0ZW5lciwgXHJcbiAgICBJbmplY3RvciwgSW5wdXQsIE9uQ2hhbmdlcywgT25EZXN0cm95LCBPbkluaXQsIE9wdGlvbmFsLCBPdXRwdXQsIFJlbmRlcmVyMiwgU2ltcGxlQ2hhbmdlcywgVmlld0NoaWxkLCBWaWV3RW5jYXBzdWxhdGlvbiB9IGZyb20gXCJAYW5ndWxhci9jb3JlXCI7XHJcbmltcG9ydCB7IE92ZXJMYXlIaWRkZW5TZXJ2aWNlIH0gZnJvbSBcIkBmYXJyaXMvdWktY29tbW9uXCI7XHJcbmltcG9ydCB7IENvbXBhcmUsIEZpbHRlckNvbmRpdGlvbiwgRmlsdGVyUmVsYXRpb24gfSBmcm9tIFwiQGZhcnJpcy91aS1jb21tb24vdHlwZXNcIjtcclxuaW1wb3J0IHsgRGlzcGxheVRleHQsIFNlYXJjaEZpZWxkLCBTZWFyY2hGaWVsZFZhbHVlIH0gZnJvbSBcIi4uL3NlYXJjaC1ib3gudHlwZXNcIjtcclxuaW1wb3J0IHsgZmxhdHRlbiB9IGZyb20gJ2xvZGFzaC1lcyc7XHJcbmltcG9ydCB7IENvbnRyb2xWYWx1ZUFjY2Vzc29yLCBOR19WQUxVRV9BQ0NFU1NPUiB9IGZyb20gXCJAYW5ndWxhci9mb3Jtc1wiO1xyXG5pbXBvcnQgeyBCZWhhdmlvclN1YmplY3QsIG9mLCBTdWJqZWN0IH0gZnJvbSBcInJ4anNcIjtcclxuaW1wb3J0IHsgU2VhcmNoQm94QmFzZSB9IGZyb20gXCIuLi9zZWFyY2gtYm94LWJhc2VcIjtcclxuaW1wb3J0IHsgRGF0ZVRpbWVIZWxwZXJTZXJ2aWNlIH0gZnJvbSBcIkBmYXJyaXMvdWktY29tbW9uL2RhdGVcIjtcclxuXHJcbmV4cG9ydCBjb25zdCBTRUFSQ0hfQk9YX1ZBTFVFX0FDQ0VTU09SOiBhbnkgPSB7XHJcbiAgICBwcm92aWRlOiBOR19WQUxVRV9BQ0NFU1NPUixcclxuICAgIHVzZUV4aXN0aW5nOiBmb3J3YXJkUmVmKCgpID0+IFNlYXJjaEZpZWxkc0NvbXBvbmVudCksXHJcbiAgICBtdWx0aTogdHJ1ZVxyXG59O1xyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgICBzZWxlY3RvcjogJ2ZhcnJpcy1zZWFyY2gtZmllbGRzJyxcclxuICAgIHRlbXBsYXRlVXJsOiAnc2VhcmNoLWZpZWxkcy5jb21wb25lbnQuaHRtbCcsXHJcbiAgICAvLyBzdHlsZVVybHM6IFtcclxuICAgIC8vICAgICBgLi4vc2VhcmNoYm94LXBhbmVsLnNjc3NgXHJcbiAgICAvLyBdLFxyXG4gICAgZW5jYXBzdWxhdGlvbjogVmlld0VuY2Fwc3VsYXRpb24uTm9uZSxcclxuICAgIHByb3ZpZGVyczogW1xyXG4gICAgICAgIFNFQVJDSF9CT1hfVkFMVUVfQUNDRVNTT1JcclxuICAgIF1cclxufSlcclxuZXhwb3J0IGNsYXNzIFNlYXJjaEZpZWxkc0NvbXBvbmVudCBleHRlbmRzIFNlYXJjaEJveEJhc2UgaW1wbGVtZW50cyBPbkluaXQsIE9uQ2hhbmdlcywgQ29udHJvbFZhbHVlQWNjZXNzb3IsIEFmdGVyVmlld0luaXQsIE9uRGVzdHJveSB7XHJcbiAgICBASW5wdXQoKSBmaWVsZHM6IEFycmF5PFNlYXJjaEZpZWxkVmFsdWU+ID0gW107XHJcbiAgICBASW5wdXQoKSBtYXhTZWFyY2hGaWVsZHMgPSA1O1xyXG4gICAgQElucHV0KCkgY29uZGl0aW9uOiBBcnJheTxGaWx0ZXJDb25kaXRpb24+ID0gW107XHJcbiAgICAvKiog5aSa5a2X5q615p+l6K+iICovXHJcbiAgICBASW5wdXQoKSBtdWx0aSA9IHRydWU7XHJcbiAgICBcclxuICAgIEBWaWV3Q2hpbGQoJ3NlYXJjaGJveCcpIGNvbnRhaW5lcjogRWxlbWVudFJlZjtcclxuICAgIEBWaWV3Q2hpbGQoJ3NlYXJjaGJveDInKSBzaGFkb3dCb3g6IEVsZW1lbnRSZWY7XHJcbiAgICBAVmlld0NoaWxkKCd0YWdDb250YWluZXInKSB0YWdDb250YWluZXJSZWY6IEVsZW1lbnRSZWY7XHJcblxyXG4gICAgQE91dHB1dCgpIGNvbmRpdGlvbkNoYW5nZSA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuICAgIEBPdXRwdXQoKSBjbGVhciA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuICAgIC8qKiDlkK/nlKjmvILmta7vvIxmYWxzZTog5YaF5a655Lya5pKR6auY5a655Zmo77ybIHRydWXvvJrlm7rlrprpq5jluqYyNnB477yM54K55Ye75oiW5ruR6L+H5pe277yM5pi+56S65a6M5pW05YaF5a6577yM5aSx5Y6754Sm54K55ZCO77yM6L+U5Zue5Zu65a6a54q25oCBICovXHJcbiAgICBlbmFibGVGbG9hdCA9IHRydWU7XHJcblxyXG4gICAgZGlzcGxheVRleHRMaXN0OiBBcnJheTxEaXNwbGF5VGV4dD4gPSBbXTtcclxuICAgIC8vIGZpbHRlckNvbmRpdGlvbnM6IEFycmF5PFNlYXJjaEZpZWxkVmFsdWU+ID0gW107XHJcblxyXG4gICAgbW9yZVN0YXR1cyQgPSBuZXcgQmVoYXZpb3JTdWJqZWN0KGZhbHNlKTtcclxuXHJcbiAgICBoaWRlU2hhZG93Ym94ID0gbmV3IFN1YmplY3QoKTtcclxuXHJcbiAgICBnZXQgaGFzRmlsdGVyKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmRpc3BsYXlUZXh0TGlzdCAmJiB0aGlzLmRpc3BsYXlUZXh0TGlzdC5sZW5ndGggPyB0aGlzLmRpc3BsYXlUZXh0TGlzdC5maWx0ZXIoKG46IGFueSkgPT4gbi5oYXNGaWx0ZXIpLmxlbmd0aCA6IGZhbHNlO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgc2hvd1NoYWRvd0JveCA9IGZhbHNlO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKGVsOiBFbGVtZW50UmVmLCBpbmplY3RvcjogSW5qZWN0b3IsIEBPcHRpb25hbCgpIG92ZXJMYXlTZXJ2aWNlOiBPdmVyTGF5SGlkZGVuU2VydmljZSwgY2Q6IENoYW5nZURldGVjdG9yUmVmLCBwcml2YXRlIGRhdGVIZWxwOiBEYXRlVGltZUhlbHBlclNlcnZpY2UpIHtcclxuICAgICAgICBzdXBlcihlbCwgaW5qZWN0b3IsIG92ZXJMYXlTZXJ2aWNlLCBjZCk7XHJcbiAgICB9XHJcblxyXG4gICAgbmdPbkluaXQoKSB7XHJcblxyXG4gICAgICAgIHRoaXMuaW5pdERpc2xheVRleHQoISF0aGlzLmZpZWxkcy5maWx0ZXIoKG46IGFueSkgPT4gbi52YWx1ZSkubGVuZ3RoKTtcclxuXHJcbiAgICAgICAgdGhpcy5vdmVyTGF5U2VydmljZS5yZWdpc3Rlck1vdXNlRXZlbnQodGhpcy5lbC5uYXRpdmVFbGVtZW50LCAoZTogYW55KSA9PiB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLnNoYWRvd0JveCAmJiB0aGlzLnNob3dTaGFkb3dCb3gpIHtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLnNoYWRvd0JveC5uYXRpdmVFbGVtZW50LmNvbnRhaW5zKGUudGFyZ2V0KSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmIChlLnRhcmdldC5jbG9zZXN0KCcuZi1zZWFyY2gtZmllbGQtY29udGFpbmVyJykpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKGUudGFyZ2V0LmNsb3Nlc3QoJy5kYXRlLW92ZXJsYXktY29udGFpbmVyJykgfHwgZS50YXJnZXQuY2xhc3NOYW1lLmluZGV4T2YoJ2RhdGUtb3ZlcmxheS1jb250YWluZXInKSA+IC0xKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHRoaXMudG9nZ2xlU2hhZG93Qm94KGZhbHNlKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuaGlkZVNoYWRvd2JveC5uZXh0KGUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgbmdBZnRlclZpZXdJbml0KCk6IHZvaWQge1xyXG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLm1vdmVTaGFkb3dUb0JvZHkoKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICB9XHJcblxyXG4gICAgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcykge1xyXG4gICAgICAgXHJcbiAgICB9XHJcblxyXG4gICAgbmdPbkRlc3Ryb3koKSB7XHJcbiAgICAgICAgaWYgKHRoaXMub3ZlckxheVNlcnZpY2UpIHtcclxuICAgICAgICAgICAgdGhpcy5vdmVyTGF5U2VydmljZSA9IG51bGw7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodGhpcy5zaGFkb3dCb3gpIHtcclxuICAgICAgICAgICAgdGhpcy5zaGFkb3dCb3gubmF0aXZlRWxlbWVudC5yZW1vdmUoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG5cclxuICAgIG9uTW9kZWxDaGFuZ2UgPSAoYXJyOiBhbnkpID0+IHsgfTtcclxuICAgIG9uTW9kZWxUb3VjaGVkID0gKGFycjogYW55KSA9PiB7IH07XHJcblxyXG4gICAgcHJpdmF0ZSBmaWx0ZXJDaGFuZ2VkKCkge1xyXG4gICAgICAgIGNvbnN0IGNvbmRpdGlvbnMgPSB0aGlzLmZpZWxkcy5maWx0ZXIoKG46IGFueSkgPT4gbi52YWx1ZSkubWFwKChuOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgeyB2YWx1ZSwgYmVnaW4sIGVuZCB9ID0gbi52YWx1ZTtcclxuXHJcbiAgICAgICAgICAgIGlmICh2YWx1ZSAhPSBudWxsICYmIHZhbHVlICE9PSB1bmRlZmluZWQgJiYgbi5jb250cm9sLnNpbmdsZSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKG4uY29udHJvbC5jb250cm9sdHlwZSA9PT0gJ2RhdGV0aW1lJykge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBbe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXJGaWVsZDogbi5jb2RlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGJyYWNrZXQ6ICcoJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmJyYWNrZXQ6ICAnJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVsYXRpb246IEZpbHRlclJlbGF0aW9uLkFuZCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29tcGFyZTogQ29tcGFyZS5HcmVhdGVyT3JFcXVhbFxyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXJGaWVsZDogbi5jb2RlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy5kYXRlSGVscC5mb3JtYXRUbyh0aGlzLmRhdGVIZWxwLmFkZERheXMobmV3IERhdGUodmFsdWUpLCAxKSwgbi5jb250cm9sLmRhdGVGb3JtYXQpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBsYnJhY2tldDogJycsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJicmFja2V0OiAgJyknLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZWxhdGlvbjogRmlsdGVyUmVsYXRpb24uQW5kLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb21wYXJlOiBDb21wYXJlLkxlc3NcclxuICAgICAgICAgICAgICAgICAgICB9XVxyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChuLmNvbnRyb2wuY29udHJvbHR5cGUgPT09ICdlbnVtJyAmJiBBcnJheS5pc0FycmF5KHZhbHVlKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB2YWx1ZS5tYXAoKGUsIGkpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlckZpZWxkOiBuLmNvZGUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxicmFja2V0OiBpPycnOiAnKCcsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByYnJhY2tldDogIGkgPT0gdmFsdWUubGVuZ3RoIC0xID8gJyknIDogJycsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWxhdGlvbjogaSA9PSB2YWx1ZS5sZW5ndGggLTEgPyBGaWx0ZXJSZWxhdGlvbi5BbmQ6IEZpbHRlclJlbGF0aW9uLk9yLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tcGFyZTogQ29tcGFyZS5FcXVhbFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGZpbHRlckZpZWxkOiBuLmNvZGUsXHJcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IEFycmF5LmlzQXJyYXkodmFsdWUpID8gdmFsdWUuam9pbignLCcpIDogdmFsdWUsXHJcbiAgICAgICAgICAgICAgICAgICAgbGJyYWNrZXQ6ICcnLFxyXG4gICAgICAgICAgICAgICAgICAgIHJicmFja2V0OiAgJycsXHJcbiAgICAgICAgICAgICAgICAgICAgcmVsYXRpb246IEZpbHRlclJlbGF0aW9uLkFuZCxcclxuICAgICAgICAgICAgICAgICAgICBjb21wYXJlOiBBcnJheS5pc0FycmF5KHZhbHVlKSA/ICBDb21wYXJlLkluOiBDb21wYXJlLkVxdWFsXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoYmVnaW4gIT09ICcnICYmIGJlZ2luIT1udWxsICYmIGJlZ2luICE9IHVuZGVmaW5lZCAmJiBlbmQgIT09JycgJiYgZW5kICE9bnVsbCAmJiBlbmQgIT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFtcclxuICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyRmllbGQ6IG4uY29kZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiBiZWdpbixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxicmFja2V0OiAnKCcsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByYnJhY2tldDogICcnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVsYXRpb246IEZpbHRlclJlbGF0aW9uLkFuZCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbXBhcmU6IENvbXBhcmUuR3JlYXRlck9yRXF1YWxcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyRmllbGQ6IG4uY29kZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiBlbmQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYnJhY2tldDogJycsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByYnJhY2tldDogICcpJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlbGF0aW9uOiBGaWx0ZXJSZWxhdGlvbi5BbmQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21wYXJlOiBDb21wYXJlLkxlc3NPckVxdWFsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBdXHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChiZWdpbiAhPT0gJycgJiYgYmVnaW4hPW51bGwgJiYgYmVnaW4gIT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXJGaWVsZDogbi5jb2RlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IGJlZ2luLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGJyYWNrZXQ6ICcnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmJyYWNrZXQ6ICAnJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlbGF0aW9uOiBGaWx0ZXJSZWxhdGlvbi5BbmQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21wYXJlOiBDb21wYXJlLkdyZWF0ZXJPckVxdWFsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChlbmQgIT09JycgJiYgZW5kICE9bnVsbCAmJiBlbmQgIT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXJGaWVsZDogbi5jb2RlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IGVuZCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxicmFja2V0OiAnJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJicmFja2V0OiAgJycsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWxhdGlvbjogRmlsdGVyUmVsYXRpb24uQW5kLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tcGFyZTogQ29tcGFyZS5MZXNzT3JFcXVhbFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSkuZmlsdGVyKG4gPT4gbik7XHJcblxyXG4gICAgICAgIGxldCBfY29uZGl0aW9uczogQXJyYXk8RmlsdGVyQ29uZGl0aW9uPiA9IFtdO1xyXG4gICAgICAgIGlmIChjb25kaXRpb25zICYmIGNvbmRpdGlvbnMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIF9jb25kaXRpb25zID0gZmxhdHRlbihjb25kaXRpb25zKVxyXG4gICAgICAgICAgICBfY29uZGl0aW9uc1tfY29uZGl0aW9ucy5sZW5ndGggLSAxXS5yZWxhdGlvbiA9IEZpbHRlclJlbGF0aW9uLkVtcHR5O1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLm9uTW9kZWxDaGFuZ2UodGhpcy5maWVsZHMpO1xyXG4gICAgICAgIHRoaXMub25Nb2RlbFRvdWNoZWQodGhpcy5maWVsZHMpO1xyXG4gICAgICAgIHRoaXMuY29uZGl0aW9uQ2hhbmdlLmVtaXQoX2NvbmRpdGlvbnMpO1xyXG4gICAgfVxyXG5cclxuICAgIHNldENvbmRpdGlvbnMoY29uZGl0aW9uOiBhbnkpIHtcclxuICAgICAgICBjb25zdCBmaWVsZDogYW55ID0gdGhpcy5maWVsZHMuZmluZChuID0+IG4uY29kZSA9PT0gY29uZGl0aW9uLmZpZWxkKTtcclxuICAgICAgICBmaWVsZC52YWx1ZSA9IGNvbmRpdGlvbi52YWx1ZTtcclxuICAgICAgICBmaWVsZC5jb250cm9sLnNpbmdsZSA9IGNvbmRpdGlvbi52YWx1ZS5zaW5nbGU7XHJcblxyXG4gICAgICAgIHRoaXMuaW5pdERpc2xheVRleHQoKTtcclxuICAgICAgICB0aGlzLmNkLmRldGVjdENoYW5nZXMoKTtcclxuICAgIH1cclxuXHJcblxyXG4gICAgcHJpdmF0ZSBpbml0RGlzbGF5VGV4dChlbWl0ID0gdHJ1ZSkge1xyXG4gICAgICAgIHRoaXMuZGlzcGxheVRleHRMaXN0ID0gdGhpcy5maWVsZHMubWFwKCh0OiBhbnkpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgbiA9IHsuLi50fTtcclxuICAgICAgICAgICAgbi5kaXNsYXlUZXh0ID0gbi5uYW1lO1xyXG4gICAgICAgICAgICBuLmhhc0ZpbHRlciA9IGZhbHNlO1xyXG4gICAgICAgICAgICBpZiAobi52YWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgY29uc3Qge3ZhbHVlLCBiZWdpbiwgZW5kfSA9ICBuLnZhbHVlO1xyXG4gICAgICAgICAgICAgICAgbGV0IHZhbCA9IHZhbHVlO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmICh0LmNvbnRyb2wgJiYgdC5jb250cm9sLmVudW1WYWx1ZXMgJiYgdC5jb250cm9sLmVudW1WYWx1ZXMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFBcnJheS5pc0FycmF5KHZhbCkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFsID0gW3ZhbF07XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHZhbCA9IHZhbC5tYXAobiA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGQgPSB0LmNvbnRyb2wuZW51bVZhbHVlcy5maW5kKGUgPT4gZS52YWx1ZSA9PT0gbik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZC5uYW1lO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBuO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pLmpvaW4oJywnKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGJlZ2luICE9PSBudWxsICYmIGJlZ2luICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFsID0gYmVnaW47XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChlbmQgIT09IG51bGwgJiYgZW5kICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZhbCAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWwgKz0gJ34nICsgZW5kO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsID0gZW5kO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgbi5kaXNsYXlUZXh0ICs9ICfvvJonICsgdmFsO1xyXG4gICAgICAgICAgICAgICAgbi5oYXNGaWx0ZXIgPSB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBuO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICB0aGlzLnNldE1vcmVTdGF0dXMoKTtcclxuICAgICAgICBcclxuICAgICAgICBpZiAoZW1pdCkge1xyXG4gICAgICAgICAgICB0aGlzLmZpbHRlckNoYW5nZWQoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcmVtb3ZlKGZpZWxkOiBzdHJpbmcpIHtcclxuICAgICAgICBjb25zdCBzZWFyY2hGaWVsZCA9IHRoaXMuZmllbGRzLmZpbmQobiA9PiBuLmNvZGUgPT09IGZpZWxkKTtcclxuICAgICAgICBpZiAoc2VhcmNoRmllbGQpIHtcclxuICAgICAgICAgICAgc2VhcmNoRmllbGQudmFsdWUgPSBudWxsO1xyXG4gICAgICAgICAgICB0aGlzLmluaXREaXNsYXlUZXh0KCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuXHJcblxyXG4gICAgb25SZW1vdmVJdGVtKCRldmVudCwgaXRlbSkge1xyXG4gICAgICAgIGlmIChpdGVtLnZhbHVlIT09IG51bGwgJiYgaXRlbS52YWx1ZSAhPSB1bmRlZmluZWQgJiYgaXRlbS52YWx1ZSAhPT0gJycpIHtcclxuICAgICAgICAgICAgJGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gICAgICAgICAgICB0aGlzLnJlbW92ZShpdGVtLmNvZGUpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBjbGVhckNvbmRpdGlvbnMoZW1pdCA9IHRydWUpIHtcclxuICAgICAgICB0aGlzLmZpZWxkcy5mb3JFYWNoKG4gPT4gbi52YWx1ZSA9IG51bGwpO1xyXG4gICAgICAgIHRoaXMuaW5pdERpc2xheVRleHQoZW1pdCk7XHJcbiAgICAgICAgaWYgKGVtaXQpIHtcclxuICAgICAgICAgICAgdGhpcy5jbGVhci5lbWl0KCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuY2QuZGV0ZWN0Q2hhbmdlcygpO1xyXG4gICAgfVxyXG5cclxuICAgIHdyaXRlVmFsdWUob2JqOiBhbnkpOiB2b2lkIHtcclxuICAgICAgICBsZXQgYXJyID0gb2JqO1xyXG4gICAgICAgIGlmICghQXJyYXkuaXNBcnJheShvYmopKSB7XHJcbiAgICAgICAgICAgIGFyciA9IFtdO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5maWVsZHMgPSBhcnI7XHJcbiAgICAgICAgdGhpcy5pbml0RGlzbGF5VGV4dCgpO1xyXG4gICAgfVxyXG5cclxuICAgIHJlZ2lzdGVyT25DaGFuZ2UoZm46IGFueSk6IHZvaWQge1xyXG4gICAgICAgIHRoaXMub25Nb2RlbENoYW5nZSA9IGZuO1xyXG4gICAgfVxyXG5cclxuICAgIHJlZ2lzdGVyT25Ub3VjaGVkKGZuOiBhbnkpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLm9uTW9kZWxUb3VjaGVkID0gZm47XHJcbiAgICB9XHJcblxyXG4gICAgc2V0VmFsdWUoYXJyOiBBcnJheTxTZWFyY2hGaWVsZFZhbHVlPikge1xyXG4gICAgICAgIC8vIHRoaXMuZmlsdGVyQ29uZGl0aW9ucyA9IGFycjtcclxuICAgICAgICAvLyB0aGlzLmluaXREaXNsYXlUZXh0KCk7XHJcbiAgICB9XHJcblxyXG4gICAgdXBkYXRlU2hhZG93Qm94UG9zaXRpb24oe3RvcCwgbGVmdCwgd2lkdGh9ID0ge3RvcDogbnVsbCwgbGVmdDogbnVsbCwgd2lkdGg6IG51bGx9KSB7XHJcbiAgICAgICAgaWYgKCF0b3AgJiYgIWxlZnQgJiYgIXdpZHRoKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGUgPSB0aGlzLmVsLm5hdGl2ZUVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XHJcbiAgICAgICAgICAgIHRvcCA9IGUudG9wO1xyXG4gICAgICAgICAgICBsZWZ0ID0gZS5sZWZ0O1xyXG4gICAgICAgICAgICB3aWR0aCA9IGUud2lkdGg7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMucmVuZGVyLnNldFN0eWxlKHRoaXMuc2hhZG93Qm94Lm5hdGl2ZUVsZW1lbnQsICdsZWZ0JywgbGVmdCArICdweCcpO1xyXG4gICAgICAgIHRoaXMucmVuZGVyLnNldFN0eWxlKHRoaXMuc2hhZG93Qm94Lm5hdGl2ZUVsZW1lbnQsICd0b3AnLCB0b3AgKyAncHgnKTtcclxuICAgICAgICB0aGlzLnJlbmRlci5zZXRTdHlsZSh0aGlzLnNoYWRvd0JveC5uYXRpdmVFbGVtZW50LCAnd2lkdGgnLCB3aWR0aCArICdweCcpO1xyXG5cclxuICAgICAgICB0aGlzLnJlbmRlci5zZXRTdHlsZSh0aGlzLnNoYWRvd0JveC5uYXRpdmVFbGVtZW50LCAnekluZGV4JywgdGhpcy5jb21tb25VdGlscy5nZXRGbG9hdGluZ0xheWVySW5kZXgoKSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBtb3ZlU2hhZG93VG9Cb2R5KCkge1xyXG4gICAgICAgIGlmICghdGhpcy5lbmFibGVGbG9hdCkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLnVwZGF0ZVNoYWRvd0JveFBvc2l0aW9uKClcclxuICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZCh0aGlzLnNoYWRvd0JveC5uYXRpdmVFbGVtZW50KTtcclxuICAgIH1cclxuXHJcbiAgICB0b2dnbGVTaGFkb3dCb3goc2hvdyA9IHRydWUsIGVsID0gbnVsbCkge1xyXG4gICAgICAgIGlmICghdGhpcy5lbmFibGVGbG9hdCkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoZWwgJiYgZWwuY2xpZW50SGVpZ2h0IDw9IDMwKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuc2hvd1NoYWRvd0JveCA9IHNob3c7XHJcbiAgICAgICAgaWYgKHNob3cpIHtcclxuICAgICAgICAgICAgdGhpcy51cGRhdGVTaGFkb3dCb3hQb3NpdGlvbigpO1xyXG4gICAgICAgICAgICB0aGlzLnJlbmRlci5yZW1vdmVTdHlsZSh0aGlzLnNoYWRvd0JveC5uYXRpdmVFbGVtZW50LCAnZGlzcGxheScpO1xyXG4gICAgICAgICAgICB0aGlzLmNvbnRhaW5lci5uYXRpdmVFbGVtZW50LnN0eWxlLnZpc2liaWxpdHkgPSAnaGlkZGVuJztcclxuICAgICAgICAgICAgdGhpcy5yZW5kZXIuYWRkQ2xhc3ModGhpcy5zaGFkb3dCb3gubmF0aXZlRWxlbWVudCwgJ2FjdGl2ZScpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMuY29udGFpbmVyLm5hdGl2ZUVsZW1lbnQuc3R5bGUudmlzaWJpbGl0eSA9ICd2aXNpYmxlJztcclxuICAgICAgICAgICAgdGhpcy5yZW5kZXIuc2V0U3R5bGUodGhpcy5zaGFkb3dCb3gubmF0aXZlRWxlbWVudCwgJ2Rpc3BsYXknLCAnbm9uZScpO1xyXG4gICAgICAgICAgICB0aGlzLnJlbmRlci5yZW1vdmVDbGFzcyh0aGlzLnNoYWRvd0JveC5uYXRpdmVFbGVtZW50LCAnYWN0aXZlJyk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuXHJcbiAgICBvblJlc2l6ZWQoJGV2ZW50KSB7XHJcbiAgICAgICAgaWYgKHRoaXMuZW5hYmxlRmxvYXQpIHtcclxuICAgICAgICAgICAgdGhpcy51cGRhdGVTaGFkb3dCb3hQb3NpdGlvbigkZXZlbnQpO1xyXG4gICAgICAgICAgICB0aGlzLnNldE1vcmVTdGF0dXMoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBzZXRNb3JlU3RhdHVzKCkge1xyXG4gICAgICAgIGlmICh0aGlzLmVuYWJsZUZsb2F0KSB7XHJcbiAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgciA9IHRoaXMudGFnQ29udGFpbmVyUmVmLm5hdGl2ZUVsZW1lbnQuY2xpZW50SGVpZ2h0ID4gMzA7XHJcbiAgICAgICAgICAgICAgICB0aGlzLm1vcmVTdGF0dXMkLm5leHQocik7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNkLmRldGVjdENoYW5nZXMoKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59Il19
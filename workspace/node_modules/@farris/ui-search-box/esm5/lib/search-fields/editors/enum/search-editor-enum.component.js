/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { ChangeDetectorRef, Component, ElementRef, EventEmitter, Injector, Input, Output, ViewChild } from "@angular/core";
import { cloneDeep } from 'lodash-es';
var SearchFieldEnumEditorComponent = /** @class */ (function () {
    function SearchFieldEnumEditorComponent(injector, cd) {
        this.injector = injector;
        this.cd = cd;
        this.checkedAll = false;
        this.boolcheck = false;
        this.valueChange = new EventEmitter();
        // indeterminate: boolean = true;
        // boolchecked: boolean;
        // boolCheckState: string = "indeterminate";
        this.checkboxDataSource = new Array();
    }
    Object.defineProperty(SearchFieldEnumEditorComponent.prototype, "field", {
        get: /**
         * @return {?}
         */
        function () {
            return this._item;
        },
        set: /**
         * @param {?} data
         * @return {?}
         */
        function (data) {
            this._item = cloneDeep(data);
            this.getDataSource();
            //this.checkValue = this._item.value.getOriginalValue();
            if (!this._item.hasOwnProperty("value")) {
                this._item.value = { value: [] };
            }
            if (this._item.hasOwnProperty("value") && this._item.value) {
                this.checkValue = this._item.value.value;
            }
            else {
                this._item.value = { value: [] };
            }
            // if (this.boolcheck) {
            //     if (this.checkValue.length) {
            //         this.boolchecked = this.checkValue[0];
            //         if (this.boolchecked) this.boolCheckState = "checked";
            //         else this.boolCheckState = "unchecked";
            //     } else this.boolCheckState = "indeterminate";
            // }
            if (this._item.value.value.length == 0) {
                this.checkedAll = false;
            }
            else if (this._item.control["enumValues"] && this._item.value.value.length == this._item.control["enumValues"].length) {
                this.checkedAll = true;
            }
            this.setSubmitChange();
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    SearchFieldEnumEditorComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () { };
    /**
     * @return {?}
     */
    SearchFieldEnumEditorComponent.prototype.getDataSource = /**
     * @return {?}
     */
    function () {
        var _this = this;
        if (this.field && this._item.control) {
            /** @type {?} */
            var checkboxList = this._item.control;
            this.checkboxDataSource = Array();
            if (checkboxList.enumValues && checkboxList.enumValues.length > 0) {
                checkboxList.enumValues.forEach((/**
                 * @param {?} element
                 * @return {?}
                 */
                function (element) {
                    _this.checkboxDataSource.push(Object.assign({}, element));
                }));
            }
        }
    };
    /**
     * @param {?} event
     * @return {?}
     */
    SearchFieldEnumEditorComponent.prototype.onSearch = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        /** @type {?} */
        var checkboxValue = [];
        if (event) {
            // let checkboxList = event.split(',');
            /** @type {?} */
            var checkboxList = event;
            if (checkboxList && checkboxList.length) {
                checkboxValue = checkboxList;
            }
            this._item.value.value = checkboxValue;
        }
        else {
            this._item.value.value = "";
        }
        if (checkboxValue.length < this._item.control["enumValues"].length) {
            this.checkedAll = false;
            // this.checkAllElRef.nativeElement.indeterminate = !!checkboxValue.length;
            // if (!checkboxValue.length) {
            //     this.checkedAll = false;    
            // }
        }
        else if (checkboxValue.length == this._item.control["enumValues"].length) {
            this.checkedAll = true;
            // this.checkAllElRef.nativeElement.indeterminate = false;
        }
        this.cd.detectChanges();
        this.getValueText();
        this.setSubmitChange();
        this.valueChange.emit({ field: this.field.code, value: { value: checkboxValue, single: true } });
    };
    /**
     * @return {?}
     */
    SearchFieldEnumEditorComponent.prototype.getValueText = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var enumValue = this._item.control.enumValues;
        /** @type {?} */
        var value = this._item.value.value;
        if (enumValue && enumValue.length && value && value.length) {
            /** @type {?} */
            var texts = [];
            var _loop_1 = function (i) {
                /** @type {?} */
                var enums = enumValue.find((/**
                 * @param {?} val
                 * @return {?}
                 */
                function (val) {
                    return val["value"] == value[i];
                }));
                if (enums) {
                    texts.push(enums["name"]);
                }
            };
            for (var i = 0; i <= value.length; i++) {
                _loop_1(i);
            }
            this._item.valueText = texts.join(",");
        }
    };
    /**
     * @return {?}
     */
    SearchFieldEnumEditorComponent.prototype.setSubmitChange = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var val = this._item.value;
        if (Object.keys(val).length < 0 ||
            Object.keys(val.value).length === 0) {
            // this.submitChange.emit(false);
        }
        else {
            // this.submitChange.emit(true);
        }
    };
    /**
     * @param {?} event
     * @return {?}
     */
    SearchFieldEnumEditorComponent.prototype.onCheckAll = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        // this.checkAllElRef.nativeElement.indeterminate = false;
        this.checkedAll = !this.checkedAll;
        if (this.checkedAll) {
            this.setCheckedAll();
        }
        else {
            this._item.value.value = [];
            this._item.valueText = "";
            this.checkValue = [];
        }
        this.getValueText();
        this.setSubmitChange();
        this.cd.detectChanges();
        this.valueChange.emit({ field: this.field.code, value: { value: this.checkValue, single: true } });
    };
    /**
     * @private
     * @return {?}
     */
    SearchFieldEnumEditorComponent.prototype.setCheckedAll = /**
     * @private
     * @return {?}
     */
    function () {
        /** @type {?} */
        var enumValue = this._item.control.enumValues;
        if (enumValue && enumValue.length) {
            /** @type {?} */
            var checkboxValue = [];
            //checkboxTexts = [];
            for (var i = 0; i < enumValue.length; i++) {
                checkboxValue.push(enumValue[i]["value"]);
                //checkboxTexts.push(enumValue[i]['name'])
            }
            this._item.value.value = checkboxValue;
            this.checkValue = this._item.value.value;
            //this._item.valueText = checkboxTexts.join(',');
            this.cd.detectChanges();
        }
    };
    SearchFieldEnumEditorComponent.decorators = [
        { type: Component, args: [{
                    selector: "search-filed-editor-enum",
                    template: "<div class=\"custom-control custom-checkbox custom-control-inline filter-panel-checkbox\" style=\"padding-left: 10px;\">\r\n    <input type=\"checkbox\" class=\"custom-control-input\"  [checked]=\"checkedAll\" #checkAllEl>\r\n    <label class=\"custom-control-label\" (click)=\"onCheckAll($event)\">{{'filterPanel.checkall'| locale}}</label>\r\n</div>\r\n<farris-checkboxgroup [value]=\"checkValue\" [horizontal]=\"false\" style=\"padding-left: 10px;\"\r\n    [data]=\"checkboxDataSource\" [isStringValue]=\"false\" (changeValue)=\"onSearch($event)\">\r\n</farris-checkboxgroup>\r\n"
                }] }
    ];
    /** @nocollapse */
    SearchFieldEnumEditorComponent.ctorParameters = function () { return [
        { type: Injector },
        { type: ChangeDetectorRef }
    ]; };
    SearchFieldEnumEditorComponent.propDecorators = {
        boolcheck: [{ type: Input }],
        field: [{ type: Input }],
        valueChange: [{ type: Output }],
        checkAllElRef: [{ type: ViewChild, args: ['checkAllEl',] }]
    };
    return SearchFieldEnumEditorComponent;
}());
export { SearchFieldEnumEditorComponent };
if (false) {
    /** @type {?} */
    SearchFieldEnumEditorComponent.prototype.checkedAll;
    /** @type {?} */
    SearchFieldEnumEditorComponent.prototype.boolcheck;
    /** @type {?} */
    SearchFieldEnumEditorComponent.prototype._item;
    /** @type {?} */
    SearchFieldEnumEditorComponent.prototype.valueChange;
    /** @type {?} */
    SearchFieldEnumEditorComponent.prototype.checkValue;
    /** @type {?} */
    SearchFieldEnumEditorComponent.prototype.checkboxDataSource;
    /** @type {?} */
    SearchFieldEnumEditorComponent.prototype.checkAllElRef;
    /**
     * @type {?}
     * @private
     */
    SearchFieldEnumEditorComponent.prototype.injector;
    /**
     * @type {?}
     * @private
     */
    SearchFieldEnumEditorComponent.prototype.cd;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2VhcmNoLWVkaXRvci1lbnVtLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvdWktc2VhcmNoLWJveC8iLCJzb3VyY2VzIjpbImxpYi9zZWFyY2gtZmllbGRzL2VkaXRvcnMvZW51bS9zZWFyY2gtZWRpdG9yLWVudW0uY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsU0FBUyxFQUFFLFVBQVUsRUFBRSxZQUFZLEVBQUUsUUFBUSxFQUFFLEtBQUssRUFBVSxNQUFNLEVBQUUsU0FBUyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ25JLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxXQUFXLENBQUM7QUFDdEM7SUFvREksd0NBQW9CLFFBQWtCLEVBQVUsRUFBcUI7UUFBakQsYUFBUSxHQUFSLFFBQVEsQ0FBVTtRQUFVLE9BQUUsR0FBRixFQUFFLENBQW1CO1FBL0NyRSxlQUFVLEdBQVksS0FBSyxDQUFDO1FBQ25CLGNBQVMsR0FBWSxLQUFLLENBQUM7UUFrQzFCLGdCQUFXLEdBQUcsSUFBSSxZQUFZLEVBQUUsQ0FBQzs7OztRQVEzQyx1QkFBa0IsR0FBZSxJQUFJLEtBQUssRUFBTyxDQUFDO0lBSXVCLENBQUM7SUE1QzFFLHNCQUNJLGlEQUFLOzs7O1FBRFQ7WUFFSSxPQUFPLElBQUksQ0FBQyxLQUFLLENBQUM7UUFDdEIsQ0FBQzs7Ozs7UUFDRCxVQUFVLElBQUk7WUFDVixJQUFJLENBQUMsS0FBSyxHQUFHLFNBQVMsQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUM3QixJQUFJLENBQUMsYUFBYSxFQUFFLENBQUM7WUFDckIsd0RBQXdEO1lBQ3hELElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLGNBQWMsQ0FBQyxPQUFPLENBQUMsRUFBRTtnQkFDckMsSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLEdBQUcsRUFBRSxLQUFLLEVBQUUsRUFBRSxFQUFFLENBQUM7YUFDcEM7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QUFFOztnQkFDM0IsYUFBYSxHQUFHLEVBQUU7WUFDdEIscUJBQXFCO1lBQ3JCLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxTQUFTLENBQUMsTUFBTSxFQUFFLENBQUMsRUFBRSxFQUFFO2dCQUN2QyxhQUFhLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDO2dCQUMxQywwQ0FBMEM7YUFDN0M7WUFDRCxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxLQUFLLEdBQUcsYUFBYSxDQUFDO1lBQ3ZDLElBQUksQ0FBQyxVQUFVLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDO1lBQ3pDLGlEQUFpRDtZQUVqRCxJQUFJLENBQUMsRUFBRSxDQUFDLGFBQWEsRUFBRSxDQUFDO1NBQzNCO0lBQ0wsQ0FBQzs7Z0JBL0pKLFNBQVMsU0FBQztvQkFDUCxRQUFRLEVBQUUsMEJBQTBCO29CQUNwQyxrbEJBQWtEO2lCQUNyRDs7OztnQkFMZ0UsUUFBUTtnQkFBaEUsaUJBQWlCOzs7NEJBUXJCLEtBQUs7d0JBRUwsS0FBSzs4QkFnQ0wsTUFBTTtnQ0FVTixTQUFTLFNBQUMsWUFBWTs7SUErRzNCLHFDQUFDO0NBQUEsQUFqS0QsSUFpS0M7U0E3SlksOEJBQThCOzs7SUFDdkMsb0RBQTRCOztJQUM1QixtREFBb0M7O0lBQ3BDLCtDQUFXOztJQWlDWCxxREFBMkM7O0lBRzNDLG9EQUFrQjs7SUFLbEIsNERBQWtEOztJQUVsRCx1REFBbUQ7Ozs7O0lBRXZDLGtEQUEwQjs7Ozs7SUFBRSw0Q0FBNkIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDaGFuZ2VEZXRlY3RvclJlZiwgQ29tcG9uZW50LCBFbGVtZW50UmVmLCBFdmVudEVtaXR0ZXIsIEluamVjdG9yLCBJbnB1dCwgT25Jbml0LCBPdXRwdXQsIFZpZXdDaGlsZCB9IGZyb20gXCJAYW5ndWxhci9jb3JlXCI7XHJcbmltcG9ydCB7IGNsb25lRGVlcCB9IGZyb20gJ2xvZGFzaC1lcyc7XHJcbkBDb21wb25lbnQoe1xyXG4gICAgc2VsZWN0b3I6IFwic2VhcmNoLWZpbGVkLWVkaXRvci1lbnVtXCIsXHJcbiAgICB0ZW1wbGF0ZVVybDogXCIuL3NlYXJjaC1lZGl0b3ItZW51bS5jb21wb25lbnQuaHRtbFwiLFxyXG59KVxyXG5leHBvcnQgY2xhc3MgU2VhcmNoRmllbGRFbnVtRWRpdG9yQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcclxuICAgIGNoZWNrZWRBbGw6IGJvb2xlYW4gPSBmYWxzZTtcclxuICAgIEBJbnB1dCgpIGJvb2xjaGVjazogYm9vbGVhbiA9IGZhbHNlO1xyXG4gICAgX2l0ZW06IGFueTtcclxuICAgIEBJbnB1dCgpXHJcbiAgICBnZXQgZmllbGQoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2l0ZW07XHJcbiAgICB9XHJcbiAgICBzZXQgZmllbGQoZGF0YSkge1xyXG4gICAgICAgIHRoaXMuX2l0ZW0gPSBjbG9uZURlZXAoZGF0YSk7XHJcbiAgICAgICAgdGhpcy5nZXREYXRhU291cmNlKCk7XHJcbiAgICAgICAgLy90aGlzLmNoZWNrVmFsdWUgPSB0aGlzLl9pdGVtLnZhbHVlLmdldE9yaWdpbmFsVmFsdWUoKTtcclxuICAgICAgICBpZiAoIXRoaXMuX2l0ZW0uaGFzT3duUHJvcGVydHkoXCJ2YWx1ZVwiKSkge1xyXG4gICAgICAgICAgICB0aGlzLl9pdGVtLnZhbHVlID0geyB2YWx1ZTogW10gfTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh0aGlzLl9pdGVtLmhhc093blByb3BlcnR5KFwidmFsdWVcIikgJiYgdGhpcy5faXRlbS52YWx1ZSkge1xyXG4gICAgICAgICAgICB0aGlzLmNoZWNrVmFsdWUgPSB0aGlzLl9pdGVtLnZhbHVlLnZhbHVlO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMuX2l0ZW0udmFsdWUgPSB7IHZhbHVlOiBbXSB9O1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyBpZiAodGhpcy5ib29sY2hlY2spIHtcclxuICAgICAgICAvLyAgICAgaWYgKHRoaXMuY2hlY2tWYWx1ZS5sZW5ndGgpIHtcclxuICAgICAgICAvLyAgICAgICAgIHRoaXMuYm9vbGNoZWNrZWQgPSB0aGlzLmNoZWNrVmFsdWVbMF07XHJcbiAgICAgICAgLy8gICAgICAgICBpZiAodGhpcy5ib29sY2hlY2tlZCkgdGhpcy5ib29sQ2hlY2tTdGF0ZSA9IFwiY2hlY2tlZFwiO1xyXG4gICAgICAgIC8vICAgICAgICAgZWxzZSB0aGlzLmJvb2xDaGVja1N0YXRlID0gXCJ1bmNoZWNrZWRcIjtcclxuICAgICAgICAvLyAgICAgfSBlbHNlIHRoaXMuYm9vbENoZWNrU3RhdGUgPSBcImluZGV0ZXJtaW5hdGVcIjtcclxuICAgICAgICAvLyB9XHJcbiAgICAgICAgaWYgKHRoaXMuX2l0ZW0udmFsdWUudmFsdWUubGVuZ3RoID09IDApe1xyXG4gICAgICAgICAgICB0aGlzLmNoZWNrZWRBbGwgPSBmYWxzZTtcclxuICAgICAgICB9ZWxzZSBpZiAodGhpcy5faXRlbS5jb250cm9sW1wiZW51bVZhbHVlc1wiXSAmJiB0aGlzLl9pdGVtLnZhbHVlLnZhbHVlLmxlbmd0aCA9PSB0aGlzLl9pdGVtLmNvbnRyb2xbXCJlbnVtVmFsdWVzXCJdLmxlbmd0aCkge1xyXG4gICAgICAgICAgICB0aGlzLmNoZWNrZWRBbGwgPSB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLnNldFN1Ym1pdENoYW5nZSgpO1xyXG4gICAgfVxyXG5cclxuICAgIEBPdXRwdXQoKSB2YWx1ZUNoYW5nZSA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuXHJcblxyXG4gICAgY2hlY2tWYWx1ZTogYW55W107XHJcbiAgICAvLyBpbmRldGVybWluYXRlOiBib29sZWFuID0gdHJ1ZTtcclxuICAgIC8vIGJvb2xjaGVja2VkOiBib29sZWFuO1xyXG4gICAgLy8gYm9vbENoZWNrU3RhdGU6IHN0cmluZyA9IFwiaW5kZXRlcm1pbmF0ZVwiO1xyXG5cclxuICAgIGNoZWNrYm94RGF0YVNvdXJjZTogQXJyYXk8YW55PiA9IG5ldyBBcnJheTxhbnk+KCk7XHJcblxyXG4gICAgQFZpZXdDaGlsZCgnY2hlY2tBbGxFbCcpIGNoZWNrQWxsRWxSZWY6IEVsZW1lbnRSZWY7XHJcblxyXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBpbmplY3RvcjogSW5qZWN0b3IsIHByaXZhdGUgY2Q6IENoYW5nZURldGVjdG9yUmVmKSB7IH1cclxuXHJcbiAgICBuZ09uSW5pdCgpOiB2b2lkIHsgfVxyXG5cclxuICAgIGdldERhdGFTb3VyY2UoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuZmllbGQgJiYgdGhpcy5faXRlbS5jb250cm9sKSB7XHJcbiAgICAgICAgICAgIGxldCBjaGVja2JveExpc3QgPSB0aGlzLl9pdGVtLmNvbnRyb2w7XHJcbiAgICAgICAgICAgIHRoaXMuY2hlY2tib3hEYXRhU291cmNlID0gQXJyYXk8YW55PigpO1xyXG4gICAgICAgICAgICBpZiAoY2hlY2tib3hMaXN0LmVudW1WYWx1ZXMgJiYgY2hlY2tib3hMaXN0LmVudW1WYWx1ZXMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgY2hlY2tib3hMaXN0LmVudW1WYWx1ZXMuZm9yRWFjaCgoZWxlbWVudCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2hlY2tib3hEYXRhU291cmNlLnB1c2goT2JqZWN0LmFzc2lnbih7fSwgZWxlbWVudCkpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgb25TZWFyY2goZXZlbnQpIHtcclxuICAgICAgICBsZXQgY2hlY2tib3hWYWx1ZSA9IFtdO1xyXG4gICAgICAgIGlmIChldmVudCkge1xyXG4gICAgICAgICAgICAvLyBsZXQgY2hlY2tib3hMaXN0ID0gZXZlbnQuc3BsaXQoJywnKTtcclxuICAgICAgICAgICAgbGV0IGNoZWNrYm94TGlzdCA9IGV2ZW50O1xyXG4gICAgICAgICAgICBpZiAoY2hlY2tib3hMaXN0ICYmIGNoZWNrYm94TGlzdC5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgIGNoZWNrYm94VmFsdWUgPSBjaGVja2JveExpc3Q7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5faXRlbS52YWx1ZS52YWx1ZSA9IGNoZWNrYm94VmFsdWU7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5faXRlbS52YWx1ZS52YWx1ZSA9IFwiXCI7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChjaGVja2JveFZhbHVlLmxlbmd0aCA8IHRoaXMuX2l0ZW0uY29udHJvbFtcImVudW1WYWx1ZXNcIl0ubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIHRoaXMuY2hlY2tlZEFsbCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAvLyB0aGlzLmNoZWNrQWxsRWxSZWYubmF0aXZlRWxlbWVudC5pbmRldGVybWluYXRlID0gISFjaGVja2JveFZhbHVlLmxlbmd0aDtcclxuICAgICAgICAgICAgLy8gaWYgKCFjaGVja2JveFZhbHVlLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAvLyAgICAgdGhpcy5jaGVja2VkQWxsID0gZmFsc2U7ICAgIFxyXG4gICAgICAgICAgICAvLyB9XHJcbiAgICAgICAgfSBlbHNlIGlmICggY2hlY2tib3hWYWx1ZS5sZW5ndGggPT0gdGhpcy5faXRlbS5jb250cm9sW1wiZW51bVZhbHVlc1wiXS5sZW5ndGgpe1xyXG4gICAgICAgICAgICB0aGlzLmNoZWNrZWRBbGwgPSB0cnVlO1xyXG4gICAgICAgICAgICAvLyB0aGlzLmNoZWNrQWxsRWxSZWYubmF0aXZlRWxlbWVudC5pbmRldGVybWluYXRlID0gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuY2QuZGV0ZWN0Q2hhbmdlcygpO1xyXG4gICAgICAgIHRoaXMuZ2V0VmFsdWVUZXh0KCk7XHJcbiAgICAgICAgdGhpcy5zZXRTdWJtaXRDaGFuZ2UoKTtcclxuICAgICAgICB0aGlzLnZhbHVlQ2hhbmdlLmVtaXQoeyAgZmllbGQ6IHRoaXMuZmllbGQuY29kZSx2YWx1ZToge3ZhbHVlOiBjaGVja2JveFZhbHVlLCBzaW5nbGU6IHRydWV9IH0pO1xyXG4gICAgfVxyXG5cclxuICAgIGdldFZhbHVlVGV4dCgpIHtcclxuICAgICAgICBjb25zdCBlbnVtVmFsdWUgPSB0aGlzLl9pdGVtLmNvbnRyb2wuZW51bVZhbHVlcztcclxuICAgICAgICBjb25zdCB2YWx1ZSA9IHRoaXMuX2l0ZW0udmFsdWUudmFsdWU7XHJcbiAgICAgICAgaWYgKGVudW1WYWx1ZSAmJiBlbnVtVmFsdWUubGVuZ3RoICYmIHZhbHVlICYmIHZhbHVlLmxlbmd0aCkge1xyXG4gICAgICAgICAgICBsZXQgdGV4dHMgPSBbXTtcclxuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPD0gdmFsdWUubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGVudW1zID0gZW51bVZhbHVlLmZpbmQoKHZhbCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB2YWxbXCJ2YWx1ZVwiXSA9PSB2YWx1ZVtpXTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgaWYgKGVudW1zKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGV4dHMucHVzaChlbnVtc1tcIm5hbWVcIl0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMuX2l0ZW0udmFsdWVUZXh0ID0gdGV4dHMuam9pbihcIixcIik7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHNldFN1Ym1pdENoYW5nZSgpIHtcclxuICAgICAgICBjb25zdCB2YWwgPSB0aGlzLl9pdGVtLnZhbHVlO1xyXG4gICAgICAgIGlmIChcclxuICAgICAgICAgICAgT2JqZWN0LmtleXModmFsKS5sZW5ndGggPCAwIHx8XHJcbiAgICAgICAgICAgIE9iamVjdC5rZXlzKHZhbC52YWx1ZSkubGVuZ3RoID09PSAwXHJcbiAgICAgICAgKSB7XHJcbiAgICAgICAgICAgIC8vIHRoaXMuc3VibWl0Q2hhbmdlLmVtaXQoZmFsc2UpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIC8vIHRoaXMuc3VibWl0Q2hhbmdlLmVtaXQodHJ1ZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIG9uQ2hlY2tBbGwoZXZlbnQpIHtcclxuICAgICAgICAvLyB0aGlzLmNoZWNrQWxsRWxSZWYubmF0aXZlRWxlbWVudC5pbmRldGVybWluYXRlID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy5jaGVja2VkQWxsID0gIXRoaXMuY2hlY2tlZEFsbDtcclxuICAgICAgICBpZiAodGhpcy5jaGVja2VkQWxsKSB7XHJcbiAgICAgICAgICAgIHRoaXMuc2V0Q2hlY2tlZEFsbCgpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMuX2l0ZW0udmFsdWUudmFsdWUgPSBbXTtcclxuICAgICAgICAgICAgdGhpcy5faXRlbS52YWx1ZVRleHQgPSBcIlwiO1xyXG4gICAgICAgICAgICB0aGlzLmNoZWNrVmFsdWUgPSBbXTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuZ2V0VmFsdWVUZXh0KCk7XHJcbiAgICAgICAgdGhpcy5zZXRTdWJtaXRDaGFuZ2UoKTtcclxuXHJcbiAgICAgICAgdGhpcy5jZC5kZXRlY3RDaGFuZ2VzKCk7XHJcblxyXG4gICAgICAgIHRoaXMudmFsdWVDaGFuZ2UuZW1pdCh7IGZpZWxkOiB0aGlzLmZpZWxkLmNvZGUsIHZhbHVlOiB7dmFsdWU6IHRoaXMuY2hlY2tWYWx1ZSwgc2luZ2xlOiB0cnVlfSB9KTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHNldENoZWNrZWRBbGwoKSB7XHJcbiAgICAgICAgY29uc3QgZW51bVZhbHVlID0gdGhpcy5faXRlbS5jb250cm9sLmVudW1WYWx1ZXM7XHJcbiAgICAgICAgaWYgKGVudW1WYWx1ZSAmJiBlbnVtVmFsdWUubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIGxldCBjaGVja2JveFZhbHVlID0gW107XHJcbiAgICAgICAgICAgIC8vY2hlY2tib3hUZXh0cyA9IFtdO1xyXG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGVudW1WYWx1ZS5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgY2hlY2tib3hWYWx1ZS5wdXNoKGVudW1WYWx1ZVtpXVtcInZhbHVlXCJdKTtcclxuICAgICAgICAgICAgICAgIC8vY2hlY2tib3hUZXh0cy5wdXNoKGVudW1WYWx1ZVtpXVsnbmFtZSddKVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMuX2l0ZW0udmFsdWUudmFsdWUgPSBjaGVja2JveFZhbHVlO1xyXG4gICAgICAgICAgICB0aGlzLmNoZWNrVmFsdWUgPSB0aGlzLl9pdGVtLnZhbHVlLnZhbHVlO1xyXG4gICAgICAgICAgICAvL3RoaXMuX2l0ZW0udmFsdWVUZXh0ID0gY2hlY2tib3hUZXh0cy5qb2luKCcsJyk7XHJcblxyXG4gICAgICAgICAgICB0aGlzLmNkLmRldGVjdENoYW5nZXMoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG59XHJcbiJdfQ==
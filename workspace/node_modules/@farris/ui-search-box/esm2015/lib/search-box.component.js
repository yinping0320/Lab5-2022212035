/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { ChangeDetectorRef, Component, ElementRef, EventEmitter, forwardRef, Injector, Input, Optional, Output, ViewChild, ViewEncapsulation } from "@angular/core";
import { OverLayHiddenService } from "@farris/ui-common";
import { InputGroupComponent } from "@farris/ui-input-group";
import { Compare, FilterRelation } from "@farris/ui-common/types";
import { flatten } from 'lodash-es';
import { NG_VALUE_ACCESSOR } from "@angular/forms";
import { BehaviorSubject } from "rxjs";
import { SearchBoxBase } from "./search-box-base";
/** @type {?} */
export const SEARCH_BOX_VALUE_ACCESSOR = {
    provide: NG_VALUE_ACCESSOR,
    useExisting: forwardRef((/**
     * @return {?}
     */
    () => SearchBoxComponent)),
    multi: true
};
export class SearchBoxComponent extends SearchBoxBase {
    /**
     * @param {?} el
     * @param {?} injector
     * @param {?} overLayService
     * @param {?} cd
     */
    constructor(el, injector, overLayService, cd) {
        super(el, injector, overLayService, cd);
        this.fields = [];
        this.maxSearchFields = 5;
        this.condition = [];
        /**
         * 启用 任意字段
         */
        this.useAnyField = true;
        this.conditionChange = new EventEmitter();
        this.clear = new EventEmitter();
        this.escHandler = new EventEmitter();
        /**
         * 启用漂浮，false: 内容会撑高容器； true：固定高度26px，点击或滑过时，显示完整内容，失去焦点后，返回固定状态
         */
        this.enableFloat = true;
        this.displayTextList = [];
        this.filterConditions = [];
        this.hiddenItemsCount$ = new BehaviorSubject(0);
        this.onModelChange = (/**
         * @param {?} arr
         * @return {?}
         */
        (arr) => { });
        this.onModelTouched = (/**
         * @param {?} arr
         * @return {?}
         */
        (arr) => { });
    }
    /**
     * @return {?}
     */
    ngOnInit() {
    }
    /**
     * @return {?}
     */
    ngAfterViewInit() {
        setTimeout((/**
         * @return {?}
         */
        () => {
            this.moveShadowToBody();
        }));
    }
    /**
     * @param {?} changes
     * @return {?}
     */
    ngOnChanges(changes) {
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        if (this.overLayService) {
            this.overLayService.destory(this.shadowBox.nativeElement);
            this.overLayService = null;
        }
        if (this.shadowBox) {
            this.shadowBox.nativeElement.remove();
        }
        if (this['REMOVE_ITEM_TIMER']) {
            clearTimeout(this['REMOVE_ITEM_TIMER']);
            this['REMOVE_ITEM_TIMER'] = null;
        }
    }
    /**
     * @param {?} $event
     * @return {?}
     */
    onBlur($event) {
        if (this.enableFloat) {
            if (!this.input2.value) {
                this.toggleShadowBox(false);
            }
        }
    }
    /**
     * @param {?} $event
     * @return {?}
     */
    onInputClick($event) {
        if (this.enableFloat) {
            this.toggleShadowBox();
        }
    }
    /**
     * @private
     * @return {?}
     */
    filterChanged() {
        /** @type {?} */
        const conditions = this.filterConditions.filter((/**
         * @param {?} n
         * @return {?}
         */
        n => n.code !== '*')).map((/**
         * @param {?} n
         * @param {?} i
         * @return {?}
         */
        (n, i) => {
            if (n.value.trim().indexOf(' ') > -1) {
                /** @type {?} */
                const searchKeys = Array.from(new Set(n.value.trim().split(' ').filter((/**
                 * @param {?} n
                 * @return {?}
                 */
                n => n.trim()))));
                return searchKeys.map((/**
                 * @param {?} s
                 * @param {?} j
                 * @return {?}
                 */
                (s, j) => {
                    return {
                        filterField: n.code,
                        value: s,
                        lbracket: j == 0 ? '(' : '',
                        rbracket: j == searchKeys.length - 1 ? ')' : '',
                        relation: j == searchKeys.length - 1 ? 1 : 2,
                        compare: 6,
                    };
                }));
            }
            return {
                filterField: n.code,
                value: n.value,
                lbracket: '',
                rbracket: '',
                relation: i == this.filterConditions.length - 1 ? 0 : 1,
                compare: 6,
            };
        }));
        /** @type {?} */
        let _conditions = [];
        _conditions = this.expandStarFieldToAllFields().concat(flatten(conditions));
        if (conditions && conditions.length) {
            _conditions[_conditions.length - 1].relation = 0;
        }
        this.onModelChange(this.filterConditions);
        this.onModelTouched(this.filterConditions);
        if (!_conditions.length) {
            this.conditionChange.emit(this.filterConditions);
        }
        else {
            this.conditionChange.emit(_conditions);
        }
    }
    /**
     * @return {?}
     */
    expandStarFieldToAllFields() {
        /** @type {?} */
        const item = this.filterConditions.find((/**
         * @param {?} n
         * @return {?}
         */
        n => n.code === '*'));
        if (!item) {
            return [];
        }
        /** @type {?} */
        const searchKeys = Array.from(new Set(item.value.trim().split(' ').filter((/**
         * @param {?} n
         * @return {?}
         */
        n => n.trim()))));
        /** @type {?} */
        const conditions = this.fields.filter((/**
         * @param {?} n
         * @return {?}
         */
        n => n.code !== '*')).map((/**
         * @param {?} n
         * @param {?} i
         * @return {?}
         */
        (n, i) => {
            return searchKeys.map((/**
             * @param {?} s
             * @param {?} j
             * @return {?}
             */
            (s, j) => {
                return {
                    filterField: n.code,
                    value: s,
                    lbracket: '',
                    rbracket: '',
                    relation: FilterRelation.Or,
                    compare: Compare.Like,
                };
            }));
        }));
        /** @type {?} */
        let _conditions = [];
        if (conditions && conditions.length) {
            _conditions = flatten(conditions);
            _conditions[0].lbracket = '(';
            _conditions[_conditions.length - 1].rbracket = ')';
            _conditions[_conditions.length - 1].relation = this.filterConditions.filter((/**
             * @param {?} n
             * @return {?}
             */
            n => n.code !== '*')).length ? 1 : 0;
        }
        return _conditions;
    }
    /**
     * @private
     * @param {?=} emit
     * @return {?}
     */
    initDislayText(emit = true) {
        /** @type {?} */
        const relationStr = this.localeSer.getValue('searchbox.relation.or');
        this.displayTextList = this.filterConditions.map((/**
         * @param {?} t
         * @return {?}
         */
        (t) => {
            /** @type {?} */
            const n = Object.assign({}, t);
            // .map(n => `“${n}”`)
            /** @type {?} */
            const values = n.value.trim().split(' ').filter((/**
             * @param {?} n
             * @return {?}
             */
            n => n.trim()));
            n.dislayText = n.name + '：' + values.join(` ${relationStr} `);
            n.displayHtml = n.name + '：' + values.join(`<span class="text-muted font-italic mx-1 or">${relationStr}</span>`);
            return n;
        }));
        setTimeout((/**
         * @return {?}
         */
        () => {
            if (this.enableFloat) {
                this.setHiddenCount();
            }
        }));
        this.cd.detectChanges();
        if (emit) {
            this.filterChanged();
        }
    }
    /**
     * @param {?} searchData
     * @return {?}
     */
    select(searchData) {
        /** @type {?} */
        const condition = this.filterConditions.find((/**
         * @param {?} n
         * @return {?}
         */
        n => n.code === searchData.code));
        if (condition) {
            condition.value = condition.value.trim() + ' ' + searchData.value;
        }
        else {
            this.filterConditions.push(searchData);
        }
        this.initDislayText();
        this.input.value = '';
    }
    /**
     * @param {?} field
     * @return {?}
     */
    remove(field) {
        this.filterConditions = this.filterConditions.filter((/**
         * @param {?} n
         * @return {?}
         */
        n => n.code !== field));
        this.initDislayText(false);
        this._emitFilterChanged();
    }
    /**
     * @private
     * @return {?}
     */
    _emitFilterChanged() {
        if (this['REMOVE_ITEM_TIMER']) {
            clearTimeout(this['REMOVE_ITEM_TIMER']);
        }
        this['REMOVE_ITEM_TIMER'] = setTimeout((/**
         * @return {?}
         */
        () => {
            this.filterChanged();
        }), 180);
    }
    /**
     * @param {?} $event
     * @param {?} item
     * @return {?}
     */
    onRemoveItem($event, item) {
        $event.stopPropagation();
        this.filterConditions = this.filterConditions.filter((/**
         * @param {?} n
         * @return {?}
         */
        n => n.code !== item.code));
        this.initDislayText();
    }
    /**
     * @param {?=} emit
     * @return {?}
     */
    clearConditions(emit = true) {
        this.input.value = '';
        this.displayTextList = [];
        this.filterConditions = [];
        this.setHiddenCount();
        if (emit) {
            this.conditionChange.emit([]);
            this.clear.emit();
        }
    }
    /**
     * @param {?} $event
     * @return {?}
     */
    onSubmit($event) {
        $event.stopPropagation();
        this.input.value = '';
        this.toggleShadowBox(false);
        this._emitFilterChanged();
    }
    /**
     * @param {?} obj
     * @return {?}
     */
    writeValue(obj) {
        /** @type {?} */
        let arr = obj;
        if (!Array.isArray(obj)) {
            arr = [];
        }
        this.filterConditions = arr;
        this.initDislayText();
    }
    /**
     * @param {?} fn
     * @return {?}
     */
    registerOnChange(fn) {
        this.onModelChange = fn;
    }
    /**
     * @param {?} fn
     * @return {?}
     */
    registerOnTouched(fn) {
        this.onModelTouched = fn;
    }
    /**
     * @param {?} arr
     * @param {?=} emit
     * @return {?}
     */
    setValue(arr, emit = true) {
        this.filterConditions = arr;
        this.initDislayText(emit);
    }
    /**
     * @param {?=} __0
     * @return {?}
     */
    updateShadowBoxPosition({ top, left, width } = { top: null, left: null, width: null }) {
        if (!top && !left && !width) {
            /** @type {?} */
            const e = this.el.nativeElement.getBoundingClientRect();
            top = e.top;
            left = e.left;
            width = e.width;
        }
        this.render.setStyle(this.shadowBox.nativeElement, 'left', left + 'px');
        this.render.setStyle(this.shadowBox.nativeElement, 'top', top + 'px');
        this.render.setStyle(this.shadowBox.nativeElement, 'width', width + 'px');
        this.render.setStyle(this.shadowBox.nativeElement, 'zIndex', this.commonUtils.getFloatingLayerIndex());
    }
    /**
     * @private
     * @return {?}
     */
    moveShadowToBody() {
        if (!this.enableFloat) {
            return;
        }
        this.updateShadowBoxPosition();
        document.body.append(this.shadowBox.nativeElement);
        this.overLayService.registerMouseEvent(this.shadowBox.nativeElement, (/**
         * @param {?} e
         * @return {?}
         */
        (e) => {
            if (e.target && e.target.className.indexOf('search-box_delete-keys') > -1) {
                return;
            }
            if (e.target === this.input2.textbox.nativeElement || !this.shadowBox || this.shadowBox.nativeElement.contains(e.target) ||
                e.target['closest']('.f-search-box-panel')) {
                return;
            }
            this.toggleShadowBox(false);
        }));
    }
    /**
     * @param {?=} show
     * @return {?}
     */
    toggleShadowBox(show = true) {
        if (!this.enableFloat || ((!this.fields || !this.fields.length) && !this.useAnyField)) {
            return;
        }
        if (show) {
            this.updateShadowBoxPosition();
            this.render.removeStyle(this.shadowBox.nativeElement, 'display');
            this.container.nativeElement.style.visibility = 'hidden';
            this.input2.focus();
        }
        else {
            this.container.nativeElement.style.visibility = 'visible';
            this.render.setStyle(this.shadowBox.nativeElement, 'display', 'none');
        }
    }
    /**
     * @param {?} $event
     * @return {?}
     */
    onShadowBoxClick($event) {
        $event.stopPropagation();
        if (this.enableFloat) {
            this.input2.focus();
        }
    }
    /**
     * @param {?} $event
     * @return {?}
     */
    onResized($event) {
        if (this.enableFloat) {
            this.updateShadowBoxPosition($event);
            setTimeout((/**
             * @return {?}
             */
            () => {
                this.setHiddenCount();
                this.cd.detectChanges();
            }));
        }
    }
    /**
     * @private
     * @return {?}
     */
    setHiddenCount() {
        /** @type {?} */
        let len = 0;
        if (!this.displayTextList || !this.displayTextList.length) {
            this.hiddenItemsCount$.next(len);
            return;
        }
        /** @type {?} */
        const items = Array.from(this.container.nativeElement.querySelectorAll('span.search-tag-item'));
        if (items && items.length) {
            len = items.map((/**
             * @param {?} n
             * @return {?}
             */
            (n) => {
                return n.offsetTop;
            })).filter((/**
             * @param {?} n
             * @return {?}
             */
            n => n > 20)).length;
        }
        this.hiddenItemsCount$.next(len);
    }
    /**
     * @param {?} $event
     * @return {?}
     */
    onEsc($event) {
        this.escHandler.emit($event);
    }
}
SearchBoxComponent.decorators = [
    { type: Component, args: [{
                selector: "farris-search-box",
                template: "\r\n\r\n<div #searchbox class=\"input-group f-search-box\" resizeObserver (resize)=\"onResized($event)\" >\r\n    <div class=\"form-control f-cmp-inputgroup--multi-wrapper multi-more\" style=\"min-height: 26px;padding: 0px 5px;\" [style.height]=\"enableFloat? '26px': 'auto'\">\r\n        <div class=\"multi--content d-flex flex-row\" style=\"width: 100%;flex-wrap: wrap;align-items: center;cursor: text;\" #tagContainer (click)=\"toggleShadowBox()\">\r\n            <span class=\"multi--item search-tag-item\" *ngFor=\"let txt of displayTextList; let index\" title=\"{{ txt.dislayText }}\">\r\n                <span class=\"search-tag\" [innerHTML]=\"txt.displayHtml | safe: 'html'\"></span>\r\n                <i class=\"f-icon f-icon-close search-box_delete-keys\" style=\"top:5px\" title=\"{{'searchbox.removeFilter'| locale}}\" (click)=\"onRemoveItem($event, txt)\"></i>\r\n            </span>\r\n\r\n            <span class=\"inputbox\">\r\n                <input-group #tagInput class=\"search-input\"\r\n                    [placeholder]=\"'searchbox.enterKeywords'| locale\" (escHandler)=\"onEsc($event)\"\r\n                    [enableClear]=\"false\" [noborder]=\"true\" (inputClick)=\"onInputClick($event)\"\r\n                    [search-box-panel]=\"fields\" [maxFields]=\"maxSearchFields\" [useAnyField]=\"useAnyField\"\r\n                ></input-group>\r\n            </span>\r\n        </div>\r\n\r\n        <div class=\"d-flex flex-row\" style=\"cursor: pointer;align-items: center;color: #2A87FF;font-weight: 600;\" *ngIf=\"hiddenItemsCount$ | async\" (click)=\"toggleShadowBox()\">\r\n            <span class=\"multi--more-text\">+{{hiddenItemsCount$ | async}}</span>\r\n        </div>\r\n    </div>\r\n    <div class=\"input-group-append\" style=\"position: relative;\" (mouseenter)=\"$event.stopPropagation()\">\r\n        <span class=\"input-group-text\" [ngStyle]=\"displayTextList && displayTextList.length? {} : {pointerEvents: 'none'}\" >\r\n            <span class=\"f-icon f-icon-search\" (click)=\"onSubmit($event)\"></span>\r\n        </span>\r\n    </div>\r\n</div>\r\n\r\n\r\n<div #searchbox2 class=\"input-group f-search-box f-cmp-inputgroup \" style=\"position:absolute;display: none; z-index: 2999;\" *ngIf=\"enableFloat\" \r\n(click)=\"onShadowBoxClick($event)\" (mousedown)=\"$event.preventDefault()\" >\r\n    <div class=\"form-control f-cmp-inputgroup--multi-wrapper multi-more  d-flex\" style=\"height: auto; min-height: 26px;padding: 0px 5px;\">\r\n        <div class=\"multi--content d-flex flex-row\" style=\"width: 100%;flex-wrap: wrap;align-items: center;\" #tagContainer>\r\n            <span class=\"multi--item search-tag-item\" *ngFor=\"let txt of displayTextList; let index\" title=\"{{ txt.dislayText }}\">\r\n                <span class=\"search-tag\" [innerHTML]=\"txt.displayHtml | safe: 'html'\"></span>\r\n                <i class=\"f-icon f-icon-close search-box_delete-keys\" style=\"top:5px\" title=\"{{'searchbox.removeFilter'| locale}}\"  (click)=\"onRemoveItem($event, txt)\"></i>\r\n            </span>\r\n\r\n            <span class=\"inputbox\">\r\n                <input-group #tagInput2 class=\"search-input\"\r\n                    [placeholder]=\"'searchbox.enterKeywords'| locale\"\r\n                    [enableClear]=\"false\" [noborder]=\"true\" (blurHandle)=\"onBlur($event)\" (escHandler)=\"onEsc($event)\"\r\n                    [search-box-panel]=\"fields\" [maxFields]=\"maxSearchFields\" [useAnyField]=\"useAnyField\"\r\n                ></input-group>\r\n            </span>\r\n        </div>\r\n    </div>\r\n    <div class=\"input-group-append\" style=\"position: relative;\" (mousedown)=\"$event.preventDefault()\">\r\n        <span class=\"input-group-text\" [ngStyle]=\"displayTextList && displayTextList.length? {} : {pointerEvents: 'none'}\">\r\n            <span class=\"f-icon f-icon-search\" (click)=\"onSubmit($event)\"></span>\r\n        </span>\r\n    </div>\r\n</div>\r\n",
                encapsulation: ViewEncapsulation.None,
                providers: [
                    SEARCH_BOX_VALUE_ACCESSOR
                ]
            }] }
];
/** @nocollapse */
SearchBoxComponent.ctorParameters = () => [
    { type: ElementRef },
    { type: Injector },
    { type: OverLayHiddenService, decorators: [{ type: Optional }] },
    { type: ChangeDetectorRef }
];
SearchBoxComponent.propDecorators = {
    fields: [{ type: Input }],
    maxSearchFields: [{ type: Input }],
    condition: [{ type: Input }],
    useAnyField: [{ type: Input }],
    container: [{ type: ViewChild, args: ['searchbox',] }],
    input: [{ type: ViewChild, args: ['tagInput',] }],
    shadowBox: [{ type: ViewChild, args: ['searchbox2',] }],
    input2: [{ type: ViewChild, args: ['tagInput2',] }],
    conditionChange: [{ type: Output }],
    clear: [{ type: Output }],
    escHandler: [{ type: Output }]
};
if (false) {
    /** @type {?} */
    SearchBoxComponent.prototype.fields;
    /** @type {?} */
    SearchBoxComponent.prototype.maxSearchFields;
    /** @type {?} */
    SearchBoxComponent.prototype.condition;
    /**
     * 启用 任意字段
     * @type {?}
     */
    SearchBoxComponent.prototype.useAnyField;
    /** @type {?} */
    SearchBoxComponent.prototype.container;
    /** @type {?} */
    SearchBoxComponent.prototype.input;
    /** @type {?} */
    SearchBoxComponent.prototype.shadowBox;
    /** @type {?} */
    SearchBoxComponent.prototype.input2;
    /** @type {?} */
    SearchBoxComponent.prototype.conditionChange;
    /** @type {?} */
    SearchBoxComponent.prototype.clear;
    /** @type {?} */
    SearchBoxComponent.prototype.escHandler;
    /**
     * 启用漂浮，false: 内容会撑高容器； true：固定高度26px，点击或滑过时，显示完整内容，失去焦点后，返回固定状态
     * @type {?}
     */
    SearchBoxComponent.prototype.enableFloat;
    /** @type {?} */
    SearchBoxComponent.prototype.displayTextList;
    /** @type {?} */
    SearchBoxComponent.prototype.filterConditions;
    /** @type {?} */
    SearchBoxComponent.prototype.hiddenItemsCount$;
    /** @type {?} */
    SearchBoxComponent.prototype.onModelChange;
    /** @type {?} */
    SearchBoxComponent.prototype.onModelTouched;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2VhcmNoLWJveC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL3VpLXNlYXJjaC1ib3gvIiwic291cmNlcyI6WyJsaWIvc2VhcmNoLWJveC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBaUIsaUJBQWlCLEVBQUUsU0FBUyxFQUFFLFVBQVUsRUFBRSxZQUFZLEVBQUUsVUFBVSxFQUE2QixRQUFRLEVBQUUsS0FBSyxFQUFnQyxRQUFRLEVBQUUsTUFBTSxFQUE0QixTQUFTLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDdFEsT0FBTyxFQUFlLG9CQUFvQixFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFDdEUsT0FBTyxFQUFFLG1CQUFtQixFQUFFLE1BQU0sd0JBQXdCLENBQUM7QUFDN0QsT0FBTyxFQUFFLE9BQU8sRUFBbUIsY0FBYyxFQUFFLE1BQU0seUJBQXlCLENBQUM7QUFFbkYsT0FBTyxFQUFFLE9BQU8sRUFBRSxNQUFNLFdBQVcsQ0FBQztBQUNwQyxPQUFPLEVBQXdCLGlCQUFpQixFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDekUsT0FBTyxFQUFFLGVBQWUsRUFBTSxNQUFNLE1BQU0sQ0FBQztBQUMzQyxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sbUJBQW1CLENBQUM7O0FBR2xELE1BQU0sT0FBTyx5QkFBeUIsR0FBUTtJQUMxQyxPQUFPLEVBQUUsaUJBQWlCO0lBQzFCLFdBQVcsRUFBRSxVQUFVOzs7SUFBQyxHQUFHLEVBQUUsQ0FBQyxrQkFBa0IsRUFBQztJQUNqRCxLQUFLLEVBQUUsSUFBSTtDQUNkO0FBU0QsTUFBTSxPQUFPLGtCQUFtQixTQUFRLGFBQWE7Ozs7Ozs7SUE2QmpELFlBQVksRUFBYyxFQUFFLFFBQWtCLEVBQWMsY0FBb0MsRUFBRSxFQUFxQjtRQUNwSCxLQUFLLENBQUMsRUFBRSxFQUFFLFFBQVEsRUFBRSxjQUFjLEVBQUUsRUFBRSxDQUFDLENB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ZXNDb250ZW50IjpbImltcG9ydCB7IEFmdGVyVmlld0luaXQsIENoYW5nZURldGVjdG9yUmVmLCBDb21wb25lbnQsIEVsZW1lbnRSZWYsIEV2ZW50RW1pdHRlciwgZm9yd2FyZFJlZiwgSG9zdEJpbmRpbmcsIEhvc3RMaXN0ZW5lciwgSW5qZWN0b3IsIElucHV0LCBPbkNoYW5nZXMsIE9uRGVzdHJveSwgT25Jbml0LCBPcHRpb25hbCwgT3V0cHV0LCBSZW5kZXJlcjIsIFNpbXBsZUNoYW5nZXMsIFZpZXdDaGlsZCwgVmlld0VuY2Fwc3VsYXRpb24gfSBmcm9tIFwiQGFuZ3VsYXIvY29yZVwiO1xyXG5pbXBvcnQgeyBDb21tb25VdGlscywgT3ZlckxheUhpZGRlblNlcnZpY2UgfSBmcm9tIFwiQGZhcnJpcy91aS1jb21tb25cIjtcclxuaW1wb3J0IHsgSW5wdXRHcm91cENvbXBvbmVudCB9IGZyb20gXCJAZmFycmlzL3VpLWlucHV0LWdyb3VwXCI7XHJcbmltcG9ydCB7IENvbXBhcmUsIEZpbHRlckNvbmRpdGlvbiwgRmlsdGVyUmVsYXRpb24gfSBmcm9tIFwiQGZhcnJpcy91aS1jb21tb24vdHlwZXNcIjtcclxuaW1wb3J0IHsgRGlzcGxheVRleHQsIFNlYXJjaEZpZWxkLCBTZWFyY2hGaWVsZFZhbHVlIH0gZnJvbSBcIi4vc2VhcmNoLWJveC50eXBlc1wiO1xyXG5pbXBvcnQgeyBmbGF0dGVuIH0gZnJvbSAnbG9kYXNoLWVzJztcclxuaW1wb3J0IHsgQ29udHJvbFZhbHVlQWNjZXNzb3IsIE5HX1ZBTFVFX0FDQ0VTU09SIH0gZnJvbSBcIkBhbmd1bGFyL2Zvcm1zXCI7XHJcbmltcG9ydCB7IEJlaGF2aW9yU3ViamVjdCwgb2YgfSBmcm9tIFwicnhqc1wiO1xyXG5pbXBvcnQgeyBTZWFyY2hCb3hCYXNlIH0gZnJvbSBcIi4vc2VhcmNoLWJveC1iYXNlXCI7XHJcblxyXG5cclxuZXhwb3J0IGNvbnN0IFNFQVJDSF9CT1hfVkFMVUVfQUNDRVNTT1I6IGFueSA9IHtcclxuICAgIHByb3ZpZGU6IE5HX1ZBTFVFX0FDQ0VTU09SLFxyXG4gICAgdXNlRXhpc3Rpbmc6IGZvcndhcmRSZWYoKCkgPT4gU2VhcmNoQm94Q29tcG9uZW50KSxcclxuICAgIG11bHRpOiB0cnVlXHJcbn07XHJcbkBDb21wb25lbnQoe1xyXG4gICAgc2VsZWN0b3I6IFwiZmFycmlzLXNlYXJjaC1ib3hcIixcclxuICAgIHRlbXBsYXRlVXJsOiAnLi9zZWFyY2gtYm94LmNvbXBvbmVudC5odG1sJyxcclxuICAgIGVuY2Fwc3VsYXRpb246IFZpZXdFbmNhcHN1bGF0aW9uLk5vbmUsXHJcbiAgICBwcm92aWRlcnM6IFtcclxuICAgICAgICBTRUFSQ0hfQk9YX1ZBTFVFX0FDQ0VTU09SXHJcbiAgICBdXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBTZWFyY2hCb3hDb21wb25lbnQgZXh0ZW5kcyBTZWFyY2hCb3hCYXNlIGltcGxlbWVudHMgT25Jbml0LCBPbkNoYW5nZXMsIENvbnRyb2xWYWx1ZUFjY2Vzc29yLCBBZnRlclZpZXdJbml0LCBPbkRlc3Ryb3kge1xyXG5cclxuICAgIEBJbnB1dCgpIGZpZWxkczogQXJyYXk8U2VhcmNoRmllbGQ+ID0gW107XHJcbiAgICBASW5wdXQoKSBtYXhTZWFyY2hGaWVsZHMgPSA1O1xyXG4gICAgQElucHV0KCkgY29uZGl0aW9uOiBBcnJheTxGaWx0ZXJDb25kaXRpb24+ID0gW107XHJcblxyXG4gICAgLyoqIOWQr+eUqCDku7vmhI/lrZfmrrUgKi9cclxuICAgIEBJbnB1dCgpIHVzZUFueUZpZWxkID0gdHJ1ZTtcclxuICAgIFxyXG5cclxuICAgIEBWaWV3Q2hpbGQoJ3NlYXJjaGJveCcpIGNvbnRhaW5lcjogRWxlbWVudFJlZjtcclxuICAgIEBWaWV3Q2hpbGQoJ3RhZ0lucHV0JykgaW5wdXQ6IElucHV0R3JvdXBDb21wb25lbnQ7XHJcblxyXG5cclxuICAgIEBWaWV3Q2hpbGQoJ3NlYXJjaGJveDInKSBzaGFkb3dCb3g6IEVsZW1lbnRSZWY7XHJcbiAgICBAVmlld0NoaWxkKCd0YWdJbnB1dDInKSBpbnB1dDI6IElucHV0R3JvdXBDb21wb25lbnQ7XHJcblxyXG5cclxuICAgIEBPdXRwdXQoKSBjb25kaXRpb25DaGFuZ2UgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcbiAgICBAT3V0cHV0KCkgY2xlYXIgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcbiAgICBAT3V0cHV0KCkgZXNjSGFuZGxlciA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuICAgIC8qKiDlkK/nlKjmvILmta7vvIxmYWxzZTog5YaF5a655Lya5pKR6auY5a655Zmo77ybIHRydWXvvJrlm7rlrprpq5jluqYyNnB477yM54K55Ye75oiW5ruR6L+H5pe277yM5pi+56S65a6M5pW05YaF5a6577yM5aSx5Y6754Sm54K55ZCO77yM6L+U5Zue5Zu65a6a54q25oCBICovXHJcbiAgICBlbmFibGVGbG9hdCA9IHRydWU7XHJcblxyXG4gICAgZGlzcGxheVRleHRMaXN0OiBBcnJheTxEaXNwbGF5VGV4dD4gPSBbXTtcclxuICAgIGZpbHRlckNvbmRpdGlvbnM6IEFycmF5PFNlYXJjaEZpZWxkVmFsdWU+ID0gW107XHJcblxyXG4gICAgaGlkZGVuSXRlbXNDb3VudCQgPSBuZXcgQmVoYXZpb3JTdWJqZWN0KDApO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKGVsOiBFbGVtZW50UmVmLCBpbmplY3RvcjogSW5qZWN0b3IsIEBPcHRpb25hbCgpIG92ZXJMYXlTZXJ2aWNlOiBPdmVyTGF5SGlkZGVuU2VydmljZSwgY2Q6IENoYW5nZURldGVjdG9yUmVmKSB7XHJcbiAgICAgICBzdXBlcihlbCwgaW5qZWN0b3IsIG92ZXJMYXlTZXJ2aWNlLCBjZCk7XHJcbiAgICB9XHJcblxyXG4gICAgbmdPbkluaXQoKSB7XHJcbiAgICB9XHJcblxyXG4gICAgbmdBZnRlclZpZXdJbml0KCk6IHZvaWQge1xyXG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLm1vdmVTaGFkb3dUb0JvZHkoKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICB9XHJcblxyXG4gICAgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcykge1xyXG4gICAgfVxyXG5cclxuICAgIG5nT25EZXN0cm95KCkge1xyXG4gICAgICAgIGlmICh0aGlzLm92ZXJMYXlTZXJ2aWNlKSB7XHJcbiAgICAgICAgICAgIHRoaXMub3ZlckxheVNlcnZpY2UuZGVzdG9yeSh0aGlzLnNoYWRvd0JveC5uYXRpdmVFbGVtZW50KTtcclxuICAgICAgICAgICAgdGhpcy5vdmVyTGF5U2VydmljZSA9IG51bGw7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodGhpcy5zaGFkb3dCb3gpIHtcclxuICAgICAgICAgICAgdGhpcy5zaGFkb3dCb3gubmF0aXZlRWxlbWVudC5yZW1vdmUoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh0aGlzWydSRU1PVkVfSVRFTV9USU1FUiddKSB7XHJcbiAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aGlzWydSRU1PVkVfSVRFTV9USU1FUiddKTtcclxuICAgICAgICAgICAgdGhpc1snUkVNT1ZFX0lURU1fVElNRVInXSA9IG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIG9uQmx1cigkZXZlbnQpIHtcclxuICAgICAgICBpZiAodGhpcy5lbmFibGVGbG9hdCkge1xyXG4gICAgICAgICAgICBpZiAoIXRoaXMuaW5wdXQyLnZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnRvZ2dsZVNoYWRvd0JveChmYWxzZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgb25JbnB1dENsaWNrKCRldmVudCkge1xyXG4gICAgICAgIGlmICh0aGlzLmVuYWJsZUZsb2F0KSB7XHJcbiAgICAgICAgICAgIHRoaXMudG9nZ2xlU2hhZG93Qm94KCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuXHJcbiAgICBvbk1vZGVsQ2hhbmdlID0gKGFycjogYW55KSA9PiB7IH07XHJcbiAgICBvbk1vZGVsVG91Y2hlZCA9IChhcnI6IGFueSkgPT4geyB9O1xyXG5cclxuICAgIHByaXZhdGUgZmlsdGVyQ2hhbmdlZCgpIHtcclxuICAgICAgICBjb25zdCBjb25kaXRpb25zID0gdGhpcy5maWx0ZXJDb25kaXRpb25zLmZpbHRlcihuID0+IG4uY29kZSAhPT0gJyonKS5tYXAoXHJcbiAgICAgICAgICAgIChuLCBpKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAobi52YWx1ZS50cmltKCkuaW5kZXhPZignICcpID4gLTEpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBzZWFyY2hLZXlzID0gQXJyYXkuZnJvbShuZXcgU2V0KG4udmFsdWUudHJpbSgpLnNwbGl0KCcgJykuZmlsdGVyKG4gPT4gbi50cmltKCkpKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNlYXJjaEtleXMubWFwKChzLCBqKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXJGaWVsZDogbi5jb2RlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHMsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYnJhY2tldDogaiA9PSAwPyAnKCc6ICAnJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJicmFja2V0OiBqID09IHNlYXJjaEtleXMubGVuZ3RoIC0gMSA/ICcpJyA6ICcnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVsYXRpb246IGogPT0gc2VhcmNoS2V5cy5sZW5ndGggLSAxID8gMSA6IDIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21wYXJlOiA2LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGZpbHRlckZpZWxkOiBuLmNvZGUsXHJcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IG4udmFsdWUsXHJcbiAgICAgICAgICAgICAgICAgICAgbGJyYWNrZXQ6ICcnLFxyXG4gICAgICAgICAgICAgICAgICAgIHJicmFja2V0OiAnJyxcclxuICAgICAgICAgICAgICAgICAgICByZWxhdGlvbjogaSA9PSB0aGlzLmZpbHRlckNvbmRpdGlvbnMubGVuZ3RoIC0xID8gMCA6IDEsXHJcbiAgICAgICAgICAgICAgICAgICAgY29tcGFyZTogNixcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICk7XHJcblxyXG4gICAgICAgIGxldCBfY29uZGl0aW9ucyA9IFtdO1xyXG4gICAgICAgIF9jb25kaXRpb25zID0gdGhpcy5leHBhbmRTdGFyRmllbGRUb0FsbEZpZWxkcygpLmNvbmNhdChmbGF0dGVuKGNvbmRpdGlvbnMpKTtcclxuICAgICAgICBpZiAoY29uZGl0aW9ucyAmJiBjb25kaXRpb25zLmxlbmd0aCkge1xyXG4gICAgICAgICAgICBfY29uZGl0aW9uc1tfY29uZGl0aW9ucy5sZW5ndGggLSAxXS5yZWxhdGlvbiA9IDA7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMub25Nb2RlbENoYW5nZSh0aGlzLmZpbHRlckNvbmRpdGlvbnMpO1xyXG4gICAgICAgIHRoaXMub25Nb2RlbFRvdWNoZWQodGhpcy5maWx0ZXJDb25kaXRpb25zKTtcclxuXHJcblxyXG4gICAgICAgIGlmICghX2NvbmRpdGlvbnMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIHRoaXMuY29uZGl0aW9uQ2hhbmdlLmVtaXQodGhpcy5maWx0ZXJDb25kaXRpb25zKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLmNvbmRpdGlvbkNoYW5nZS5lbWl0KF9jb25kaXRpb25zKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgZXhwYW5kU3RhckZpZWxkVG9BbGxGaWVsZHMoKSB7XHJcbiAgICAgICAgY29uc3QgaXRlbSA9IHRoaXMuZmlsdGVyQ29uZGl0aW9ucy5maW5kKG4gPT4gbi5jb2RlID09PSAnKicpO1xyXG4gICAgICAgIGlmICghaXRlbSkge1xyXG4gICAgICAgICAgICByZXR1cm4gW107XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IHNlYXJjaEtleXMgPSBBcnJheS5mcm9tKG5ldyBTZXQoaXRlbS52YWx1ZS50cmltKCkuc3BsaXQoJyAnKS5maWx0ZXIobiA9PiBuLnRyaW0oKSkpKTtcclxuICAgICAgICBjb25zdCBjb25kaXRpb25zID0gdGhpcy5maWVsZHMuZmlsdGVyKG4gPT4gbi5jb2RlICE9PSAnKicpLm1hcCgobjogU2VhcmNoRmllbGQsIGkpID0+IHtcclxuICAgICAgICAgICAgcmV0dXJuIHNlYXJjaEtleXMubWFwKChzLCBqKSA9PiB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGZpbHRlckZpZWxkOiBuLmNvZGUsXHJcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHMsXHJcbiAgICAgICAgICAgICAgICAgICAgbGJyYWNrZXQ6ICcnLFxyXG4gICAgICAgICAgICAgICAgICAgIHJicmFja2V0OiAnJyxcclxuICAgICAgICAgICAgICAgICAgICByZWxhdGlvbjogRmlsdGVyUmVsYXRpb24uT3IsXHJcbiAgICAgICAgICAgICAgICAgICAgY29tcGFyZTogQ29tcGFyZS5MaWtlLFxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgbGV0IF9jb25kaXRpb25zID0gW107XHJcbiAgICAgICAgaWYgKGNvbmRpdGlvbnMgJiYgY29uZGl0aW9ucy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgX2NvbmRpdGlvbnMgPSBmbGF0dGVuKGNvbmRpdGlvbnMpXHJcbiAgICAgICAgICAgIF9jb25kaXRpb25zWzBdLmxicmFja2V0ID0gJygnXHJcbiAgICAgICAgICAgIF9jb25kaXRpb25zW19jb25kaXRpb25zLmxlbmd0aCAtIDFdLnJicmFja2V0ID0gJyknXHJcbiAgICAgICAgICAgIF9jb25kaXRpb25zW19jb25kaXRpb25zLmxlbmd0aCAtIDFdLnJlbGF0aW9uID0gdGhpcy5maWx0ZXJDb25kaXRpb25zLmZpbHRlcihuID0+IG4uY29kZSAhPT0nKicpLmxlbmd0aCA/IDEgOiAwO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIF9jb25kaXRpb25zO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgaW5pdERpc2xheVRleHQoZW1pdCA9IHRydWUpIHtcclxuICAgICAgICBjb25zdCByZWxhdGlvblN0ciA9IHRoaXMubG9jYWxlU2VyLmdldFZhbHVlKCdzZWFyY2hib3gucmVsYXRpb24ub3InKTtcclxuICAgICAgICB0aGlzLmRpc3BsYXlUZXh0TGlzdCA9IHRoaXMuZmlsdGVyQ29uZGl0aW9ucy5tYXAoKHQ6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBuID0gey4uLnR9O1xyXG4gICAgICAgICAgICAvLyAubWFwKG4gPT4gYOKAnCR7bn3igJ1gKVxyXG4gICAgICAgICAgICBjb25zdCB2YWx1ZXMgPSAgbi52YWx1ZS50cmltKCkuc3BsaXQoJyAnKS5maWx0ZXIobiA9PiBuLnRyaW0oKSk7XHJcbiAgICAgICAgICAgIG4uZGlzbGF5VGV4dCA9IG4ubmFtZSArICfvvJonICsgdmFsdWVzLmpvaW4oYCAkeyByZWxhdGlvblN0ciB9IGApO1xyXG4gICAgICAgICAgICBuLmRpc3BsYXlIdG1sID0gbi5uYW1lICsgJ++8micgKyB2YWx1ZXMuam9pbihgPHNwYW4gY2xhc3M9XCJ0ZXh0LW11dGVkIGZvbnQtaXRhbGljIG14LTEgb3JcIj4ke3JlbGF0aW9uU3RyfTwvc3Bhbj5gKTtcclxuICAgICAgICAgICAgcmV0dXJuIG47XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5lbmFibGVGbG9hdCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zZXRIaWRkZW5Db3VudCgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgdGhpcy5jZC5kZXRlY3RDaGFuZ2VzKCk7XHJcbiAgICAgICAgaWYgKGVtaXQpIHtcclxuICAgICAgICAgICAgdGhpcy5maWx0ZXJDaGFuZ2VkKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHNlbGVjdChzZWFyY2hEYXRhOiBhbnkpIHtcclxuICAgICAgICBjb25zdCBjb25kaXRpb24gPSB0aGlzLmZpbHRlckNvbmRpdGlvbnMuZmluZChuID0+IG4uY29kZSA9PT0gc2VhcmNoRGF0YS5jb2RlKTtcclxuICAgICAgICBpZiAoY29uZGl0aW9uKSB7XHJcbiAgICAgICAgICAgIGNvbmRpdGlvbi52YWx1ZSA9IGNvbmRpdGlvbi52YWx1ZS50cmltKCkgKyAnICcgKyBzZWFyY2hEYXRhLnZhbHVlO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMuZmlsdGVyQ29uZGl0aW9ucy5wdXNoKHNlYXJjaERhdGEpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmluaXREaXNsYXlUZXh0KCk7XHJcblxyXG4gICAgICAgIHRoaXMuaW5wdXQudmFsdWUgPSAnJztcclxuICAgIH1cclxuXHJcbiAgICByZW1vdmUoZmllbGQ6IHN0cmluZykge1xyXG4gICAgICAgIHRoaXMuZmlsdGVyQ29uZGl0aW9ucyA9IHRoaXMuZmlsdGVyQ29uZGl0aW9ucy5maWx0ZXIobiA9PiBuLmNvZGUgIT09IGZpZWxkKVxyXG4gICAgICAgIHRoaXMuaW5pdERpc2xheVRleHQoZmFsc2UpO1xyXG5cclxuICAgICAgICB0aGlzLl9lbWl0RmlsdGVyQ2hhbmdlZCgpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgX2VtaXRGaWx0ZXJDaGFuZ2VkKCkge1xyXG4gICAgICAgIGlmICh0aGlzWydSRU1PVkVfSVRFTV9USU1FUiddKSB7XHJcbiAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aGlzWydSRU1PVkVfSVRFTV9USU1FUiddKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXNbJ1JFTU9WRV9JVEVNX1RJTUVSJ10gPSBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgICAgdGhpcy5maWx0ZXJDaGFuZ2VkKCk7XHJcbiAgICAgICAgfSwgMTgwKTtcclxuICAgIH1cclxuXHJcbiAgICBvblJlbW92ZUl0ZW0oJGV2ZW50LCBpdGVtKSB7XHJcbiAgICAgICAgJGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gICAgICAgIHRoaXMuZmlsdGVyQ29uZGl0aW9ucyA9IHRoaXMuZmlsdGVyQ29uZGl0aW9ucy5maWx0ZXIobiA9PiBuLmNvZGUgIT09IGl0ZW0uY29kZSk7XHJcbiAgICAgICAgdGhpcy5pbml0RGlzbGF5VGV4dCgpO1xyXG4gICAgICAgIFxyXG4gICAgfVxyXG5cclxuICAgIGNsZWFyQ29uZGl0aW9ucyhlbWl0ID0gdHJ1ZSkge1xyXG4gICAgICAgIHRoaXMuaW5wdXQudmFsdWUgPSAnJztcclxuICAgICAgICB0aGlzLmRpc3BsYXlUZXh0TGlzdCA9IFtdO1xyXG4gICAgICAgIHRoaXMuZmlsdGVyQ29uZGl0aW9ucyA9IFtdO1xyXG4gICAgICAgIHRoaXMuc2V0SGlkZGVuQ291bnQoKTtcclxuICAgICAgICBpZiAoZW1pdCkge1xyXG4gICAgICAgICAgICB0aGlzLmNvbmRpdGlvbkNoYW5nZS5lbWl0KFtdKTtcclxuICAgICAgICAgICAgdGhpcy5jbGVhci5lbWl0KCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIG9uU3VibWl0KCRldmVudCkge1xyXG4gICAgICAgICRldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcclxuICAgICAgICB0aGlzLmlucHV0LnZhbHVlID0gJyc7XHJcbiAgICAgICAgdGhpcy50b2dnbGVTaGFkb3dCb3goZmFsc2UpO1xyXG4gICAgICAgIHRoaXMuX2VtaXRGaWx0ZXJDaGFuZ2VkKCk7XHJcbiAgICB9XHJcblxyXG4gICAgd3JpdGVWYWx1ZShvYmo6IGFueSk6IHZvaWQge1xyXG4gICAgICAgIGxldCBhcnIgPSBvYmo7XHJcbiAgICAgICAgaWYgKCFBcnJheS5pc0FycmF5KG9iaikpIHtcclxuICAgICAgICAgICAgYXJyID0gW107XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLmZpbHRlckNvbmRpdGlvbnMgPSBhcnI7XHJcbiAgICAgICAgdGhpcy5pbml0RGlzbGF5VGV4dCgpO1xyXG4gICAgfVxyXG5cclxuICAgIHJlZ2lzdGVyT25DaGFuZ2UoZm46IGFueSk6IHZvaWQge1xyXG4gICAgICAgIHRoaXMub25Nb2RlbENoYW5nZSA9IGZuO1xyXG4gICAgfVxyXG5cclxuICAgIHJlZ2lzdGVyT25Ub3VjaGVkKGZuOiBhbnkpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLm9uTW9kZWxUb3VjaGVkID0gZm47XHJcbiAgICB9XHJcblxyXG4gICAgc2V0VmFsdWUoYXJyOiBBcnJheTxTZWFyY2hGaWVsZFZhbHVlPiwgZW1pdCA9IHRydWUpIHtcclxuICAgICAgICB0aGlzLmZpbHRlckNvbmRpdGlvbnMgPSBhcnI7XHJcbiAgICAgICAgdGhpcy5pbml0RGlzbGF5VGV4dChlbWl0KTtcclxuICAgIH1cclxuXHJcbiAgICB1cGRhdGVTaGFkb3dCb3hQb3NpdGlvbih7dG9wLCBsZWZ0LCB3aWR0aH0gPSB7dG9wOiBudWxsLCBsZWZ0OiBudWxsLCB3aWR0aDogbnVsbH0pIHtcclxuICAgICAgICBpZiAoIXRvcCAmJiAhbGVmdCAmJiAhd2lkdGgpIHtcclxuICAgICAgICAgICAgY29uc3QgZSA9IHRoaXMuZWwubmF0aXZlRWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcclxuICAgICAgICAgICAgdG9wID0gZS50b3A7XHJcbiAgICAgICAgICAgIGxlZnQgPSBlLmxlZnQ7XHJcbiAgICAgICAgICAgIHdpZHRoID0gZS53aWR0aDtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5yZW5kZXIuc2V0U3R5bGUodGhpcy5zaGFkb3dCb3gubmF0aXZlRWxlbWVudCwgJ2xlZnQnLCBsZWZ0ICsgJ3B4Jyk7XHJcbiAgICAgICAgdGhpcy5yZW5kZXIuc2V0U3R5bGUodGhpcy5zaGFkb3dCb3gubmF0aXZlRWxlbWVudCwgJ3RvcCcsIHRvcCArICdweCcpO1xyXG4gICAgICAgIHRoaXMucmVuZGVyLnNldFN0eWxlKHRoaXMuc2hhZG93Qm94Lm5hdGl2ZUVsZW1lbnQsICd3aWR0aCcsIHdpZHRoICsgJ3B4Jyk7XHJcblxyXG4gICAgICAgIHRoaXMucmVuZGVyLnNldFN0eWxlKHRoaXMuc2hhZG93Qm94Lm5hdGl2ZUVsZW1lbnQsICd6SW5kZXgnLCB0aGlzLmNvbW1vblV0aWxzLmdldEZsb2F0aW5nTGF5ZXJJbmRleCgpKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIG1vdmVTaGFkb3dUb0JvZHkoKSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLmVuYWJsZUZsb2F0KSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy51cGRhdGVTaGFkb3dCb3hQb3NpdGlvbigpO1xyXG4gICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kKHRoaXMuc2hhZG93Qm94Lm5hdGl2ZUVsZW1lbnQpO1xyXG5cclxuICAgICAgICB0aGlzLm92ZXJMYXlTZXJ2aWNlLnJlZ2lzdGVyTW91c2VFdmVudCh0aGlzLnNoYWRvd0JveC5uYXRpdmVFbGVtZW50LCAoZSkgPT4ge1xyXG4gICAgICAgICAgICBpZiAoZS50YXJnZXQgJiYgZS50YXJnZXQuY2xhc3NOYW1lLmluZGV4T2YoJ3NlYXJjaC1ib3hfZGVsZXRlLWtleXMnKSA+IC0xKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmIChlLnRhcmdldCA9PT0gdGhpcy5pbnB1dDIudGV4dGJveC5uYXRpdmVFbGVtZW50IHx8ICF0aGlzLnNoYWRvd0JveCB8fCB0aGlzLnNoYWRvd0JveC5uYXRpdmVFbGVtZW50LmNvbnRhaW5zKGUudGFyZ2V0KSB8fCBcclxuICAgICAgICAgICAgZS50YXJnZXRbJ2Nsb3Nlc3QnXSgnLmYtc2VhcmNoLWJveC1wYW5lbCcpKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHRoaXMudG9nZ2xlU2hhZG93Qm94KGZhbHNlKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICB9XHJcblxyXG4gICAgdG9nZ2xlU2hhZG93Qm94KHNob3cgPSB0cnVlKSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLmVuYWJsZUZsb2F0IHx8ICgoIXRoaXMuZmllbGRzIHx8ICF0aGlzLmZpZWxkcy5sZW5ndGgpICYmICF0aGlzLnVzZUFueUZpZWxkKSkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChzaG93KSB7XHJcbiAgICAgICAgICAgIHRoaXMudXBkYXRlU2hhZG93Qm94UG9zaXRpb24oKTtcclxuICAgICAgICAgICAgdGhpcy5yZW5kZXIucmVtb3ZlU3R5bGUodGhpcy5zaGFkb3dCb3gubmF0aXZlRWxlbWVudCwgJ2Rpc3BsYXknKTtcclxuICAgICAgICAgICAgdGhpcy5jb250YWluZXIubmF0aXZlRWxlbWVudC5zdHlsZS52aXNpYmlsaXR5ID0gJ2hpZGRlbic7XHJcbiAgICAgICAgICAgIHRoaXMuaW5wdXQyLmZvY3VzKCk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5jb250YWluZXIubmF0aXZlRWxlbWVudC5zdHlsZS52aXNpYmlsaXR5ID0gJ3Zpc2libGUnO1xyXG4gICAgICAgICAgICB0aGlzLnJlbmRlci5zZXRTdHlsZSh0aGlzLnNoYWRvd0JveC5uYXRpdmVFbGVtZW50LCAnZGlzcGxheScsICdub25lJyk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIG9uU2hhZG93Qm94Q2xpY2soJGV2ZW50OiBNb3VzZUV2ZW50KSB7XHJcbiAgICAgICAgJGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gICAgICAgIGlmICh0aGlzLmVuYWJsZUZsb2F0KSB7XHJcbiAgICAgICAgICAgIHRoaXMuaW5wdXQyLmZvY3VzKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIG9uUmVzaXplZCgkZXZlbnQpIHtcclxuICAgICAgICBpZiAodGhpcy5lbmFibGVGbG9hdCkge1xyXG4gICAgICAgICAgICB0aGlzLnVwZGF0ZVNoYWRvd0JveFBvc2l0aW9uKCRldmVudCk7XHJcbiAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zZXRIaWRkZW5Db3VudCgpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jZC5kZXRlY3RDaGFuZ2VzKCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHNldEhpZGRlbkNvdW50KCkge1xyXG4gICAgICAgIGxldCBsZW4gPSAwO1xyXG4gICAgICAgIGlmICghdGhpcy5kaXNwbGF5VGV4dExpc3QgfHwgIXRoaXMuZGlzcGxheVRleHRMaXN0Lmxlbmd0aCkge1xyXG4gICAgICAgICAgICB0aGlzLmhpZGRlbkl0ZW1zQ291bnQkLm5leHQobGVuKTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCBpdGVtcyA9IEFycmF5LmZyb20odGhpcy5jb250YWluZXIubmF0aXZlRWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKCdzcGFuLnNlYXJjaC10YWctaXRlbScpKTtcclxuICAgICAgICBpZiAoaXRlbXMgJiYgaXRlbXMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIGxlbiA9IGl0ZW1zLm1hcCgobjogYW55KSA9PiB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbi5vZmZzZXRUb3A7XHJcbiAgICAgICAgICAgIH0pLmZpbHRlcihuID0+IG4gPiAyMCkubGVuZ3RoXHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuaGlkZGVuSXRlbXNDb3VudCQubmV4dChsZW4pO1xyXG4gICAgfVxyXG5cclxuICAgIG9uRXNjKCRldmVudCkge1xyXG4gICAgICAgIHRoaXMuZXNjSGFuZGxlci5lbWl0KCRldmVudCk7XHJcbiAgICB9XHJcbn1cclxuIl19
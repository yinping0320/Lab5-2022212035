/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { ChangeDetectorRef, Component, EventEmitter, Injector, Input, Output } from '@angular/core';
import { DateTimeHelperService } from '@farris/ui-common/date';
import { LocaleService } from '@farris/ui-locale';
export class SearchFieldFlexibleDateComponent {
    /**
     * @param {?} localeService
     * @param {?} injector
     * @param {?} cd
     */
    constructor(localeService, injector, cd) {
        this.localeService = localeService;
        this.injector = injector;
        this.cd = cd;
        this.valueChange = new EventEmitter();
        // 是否为区间日期
        this.single = true;
        this.dateFormat = '';
        this.showTime = false;
        this.value = '';
        this.beginValue = '';
        this.endValue = '';
        this.showType = '1';
        this.placeholder = '';
        this.endPlaceHolder = '';
        this.beginPlaceHolder = '';
        this.activedDateTagId = '';
        this.activedDayTagId = '';
        this.dateTags = [];
        this.dayTags = [];
        this.dateHelp = null;
        this.dateHelp = this.injector.get(DateTimeHelperService, new DateTimeHelperService());
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.dateTags = [
            {
                id: 'tag1',
                text: this.localeService.getValue('filterPanel.last1Month')
            },
            {
                id: 'tag2',
                text: this.localeService.getValue('filterPanel.last3Month')
            },
            {
                id: 'tag3',
                text: this.localeService.getValue('filterPanel.last6Month')
            }
        ];
        this.dayTags = [
            {
                id: 'yesterday',
                text: this.localeService.getValue('filterPanel.yesterday')
            },
            {
                id: 'today',
                text: this.localeService.getValue('filterPanel.today')
            }
        ];
        if (this.field.control) {
            const { showTime, showType, single } = this.field.control;
            if (this.field.value) {
                const { value, begin, end } = this.field.value;
                this.value = value,
                    this.beginValue = begin;
                this.endValue = end;
            }
            this.showTime = showTime;
            this.showType = showType;
            this.single = single;
            /** @type {?} */
            let itemDateFormat = this.field.control.dateFormat;
            if (this.showTime && itemDateFormat) {
                if (itemDateFormat.length > 0 && itemDateFormat.indexOf('HH:mm') == -1) {
                    itemDateFormat = itemDateFormat + ' HH:mm:ss';
                }
            }
            else {
                itemDateFormat = this.showTime ? 'yyyy-MM-dd HH:mm:ss' : (this.showType == '2' ? 'yyyy-MM' : (this.showType == '3' ? 'yyyy' : 'yyyy-MM-dd'));
            }
            this.dateFormat = itemDateFormat;
        }
    }
    /**
     * @param {?} $event
     * @return {?}
     */
    onDateChange($event) {
        this.valueChange.emit({ field: this.field.code, value: { value: this.value, single: true } });
    }
    /**
     * @param {?} $event
     * @return {?}
     */
    beginValueChange($event) {
        this.valueChange.emit({ field: this.field.code, value: { begin: this.beginValue, end: this.endValue, single: false } });
    }
    /**
     * @param {?} $event
     * @return {?}
     */
    endValueChange($event) {
        this.valueChange.emit({ field: this.field.code, value: { begin: this.beginValue, end: this.endValue, single: false } });
    }
    /**
     * @param {?} $event
     * @return {?}
     */
    onSingleChange($event) {
        this.single = !$event;
        this.valueChange.emit({ field: this.field.code, value: { value: this.value, begin: this.beginValue, end: this.endValue, single: this.single } });
        this.cd.detectChanges();
    }
    /**
     * @param {?} tag
     * @return {?}
     */
    clickTag(tag) {
        this.activedDateTagId = tag.id;
        /** @type {?} */
        let tagDate;
        if (tag.id == 'tag1') {
            tagDate = this.getLastNumMonth(1, this.showTime, this.showType);
        }
        else if (tag.id == 'tag2') {
            tagDate = this.getLastNumMonth(3, this.showTime, this.showType);
        }
        else if (tag.id == 'tag3') {
            tagDate = this.getLastNumMonth(6, this.showTime, this.showType);
        }
        this.beginValue = tagDate['startTime'];
        this.endValue = tagDate['endTime'];
        this.valueChange.emit({ field: this.field.code, value: { value: this.value, begin: this.beginValue, end: this.endValue, single: this.single } });
        this.cd.detectChanges();
    }
    /**
     * @param {?} tag
     * @return {?}
     */
    clickDayTag(tag) {
        this.activedDayTagId = tag.id;
        /** @type {?} */
        let dayTag = this.getToday(this.activedDayTagId, this.showTime);
        this.value = dayTag;
        this.valueChange.emit({ field: this.field.code, value: { value: this.value, single: true } });
    }
    /**
     * @private
     * @param {?} num
     * @param {?} showtime
     * @param {?} type
     * @return {?}
     */
    getLastNumMonth(num, showtime, type) {
        /** @type {?} */
        let now = new Date();
        /** @type {?} */
        let year = now.getFullYear();
        /** @type {?} */
        let month = now.getMonth() + 1;
        //0-11表示1-12月
        /** @type {?} */
        let day = now.getDate();
        /** @type {?} */
        let hour = now.getHours();
        /** @type {?} */
        let min = now.getMinutes() < 10 ? '0' + new Date().getMinutes()
            : new Date().getMinutes();
        /** @type {?} */
        let sec = new Date().getSeconds() < 10 ? '0' + new Date().getSeconds()
            : new Date().getSeconds();
        /** @type {?} */
        let dateObj = {};
        /** @type {?} */
        const time = hour + ':' + min + ':' + sec;
        // dateObj['endTime'] = year + '-' + month + '-' + day;
        /** @type {?} */
        let endMonth = month < 10 ? '0' + month : month;
        /** @type {?} */
        let endDay = day < 10 ? '0' + day : day;
        if (type == '2') {
            dateObj['endTime'] = year + '-' + endMonth;
        }
        else if (type == '3') {
            dateObj['endTime'] = year;
        }
        else {
            dateObj['endTime'] = year + '-' + endMonth + '-' + endDay;
        }
        /** @type {?} */
        let nowMonthDay = new Date(year, month, 0).getDate();
        //当前月的总天数
        /** @type {?} */
        let dYear;
        /** @type {?} */
        let dMouth;
        /** @type {?} */
        let dDay;
        if (month - num <= 0) { //如果是1、2、3月，年数往前推一年
            //如果是1、2、3月，年数往前推一年
            /** @type {?} */
            let lastMonthDay = new Date((year - 1), (12 - (num - month)), 0).getDate();
            if (lastMonthDay < day) { //3个月前所在月的总天数小于现在的天日期
                // dateObj['startTime'] = (year - 1) + '-' + (12 - (num - month)) + '-' + lastMonthDay;
                dYear = year - 1;
                dMouth = 12 - (num - month);
                dDay = lastMonthDay;
            }
            else {
                dYear = year - 1;
                dMouth = 12 - (num - month);
                dDay = day;
                // dateObj['startTime']= (year - 1) + '-' + (12 - (num - month)) + '-' + day;
            }
        }
        else {
            /** @type {?} */
            let lastMonthDay = new Date(year, (month - num), 0).getDate();
            if (lastMonthDay < day) { //3个月前所在月的总天数小于现在的天日期
                if (day < nowMonthDay) { //当前天日期小于当前月总天数,2月份比较特殊的月份
                    // dateObj['startTime'] = year + '-' + (month - num) + '-' + (lastMonthDay - (nowMonthDay - day));
                    dYear = year;
                    dMouth = month - num;
                    dDay = lastMonthDay - (nowMonthDay - day);
                }
                else {
                    dYear = year;
                    dMouth = month - num;
                    dDay = lastMonthDay;
                    // dateObj['startTime'] = year + '-' + (month - num) + '-' + lastMonthDay;
                }
            }
            else {
                dYear = year;
                dMouth = month - num;
                dDay = day;
                // dateObj['startTime'] = year + '-' + (month - num) + '-' + day;
            }
        }
        dMouth = dMouth < 10 ? '0' + dMouth : dMouth;
        dDay = dDay < 10 ? '0' + dDay : dDay;
        if (type == '2') {
            dateObj['startTime'] = dYear + '-' + dMouth;
        }
        else if (type == '3') {
            dateObj['startTime'] = dYear;
        }
        else {
            dateObj['startTime'] = dYear + '-' + dMouth + '-' + dDay;
        }
        if (showtime) {
            dateObj['endTime'] = dateObj['endTime'] + ' ' + time;
            dateObj['startTime'] = dateObj['startTime'] + ' ' + time;
        }
        return dateObj;
    }
    /**
     * @private
     * @param {?=} dayTags
     * @param {?=} showtime
     * @return {?}
     */
    getToday(dayTags = 'today', showtime) {
        /** @type {?} */
        let now = new Date();
        if (dayTags == 'today') {
            return this.dateHelp.formatTo(now, this.dateFormat);
        }
        else if (dayTags == 'yesterday') {
            return this.dateHelp.formatTo(this.dateHelp.subDays(now, 1), this.dateFormat);
        }
        /*
        let year = now.getFullYear();
        let month = now.getMonth() + 1;//0-11表示1-12月
        let day = now.getDate();
        let hour = now.getHours();
        let min = now.getMinutes() < 10 ? '0' + new Date().getMinutes()
            :new Date().getMinutes();
        let sec = new Date().getSeconds() < 10 ? '0' + new Date().getSeconds()
            :new Date().getSeconds();
        const time = hour + ':' + min + ':' + sec;
        let yesterday = new Date();
        yesterday.setTime(now.getTime()-24*60*60*1000);
        let yesterdayObj = yesterday.getFullYear()+"-" + (yesterday.getMonth()+1) + "-" + yesterday.getDate();
        let dateObj = year + '-' + month + '-' + day;
        if(showtime){
            dateObj = dateObj + ' ' + time;
            yesterdayObj = yesterdayObj + ' ' + time;
        }
        if(dayTags == 'today') return dateObj;
        else if (dayTags == 'yesterday') return yesterdayObj;

        */
    }
}
SearchFieldFlexibleDateComponent.decorators = [
    { type: Component, args: [{
                selector: 'search-filed-editor-date',
                template: "\r\n<div class=\"f-panel-filter-tip\">\r\n    <span class=\"panel-filter-tip-text\">{{ 'filterPanel.intervalFilter' | locale }}</span>\r\n    <farris-switch size=\"small\" [checked]=\"!single\" (valueChange)=\"onSingleChange($event)\"></farris-switch>\r\n</div>\r\n\r\n<div class=\"f-panel-filter-content\">\r\n    <ng-container *ngIf=\"single; else elseTemplate\">\r\n        <ng-container *ngIf=\"showTime; else singleDefaultdate\">\r\n            <farris-datepicker [(ngModel)]=\"value\" [editable]=\"false\" [returnFormat]=\"'yyyy-MM-dd HH:mm:ss'\" [dateFormat]=\"dateFormat\"\r\n             (valueChange)=\"onDateChange($event)\" [placeholder]=\"placeholder\" [showTime]=\"showTime\" #datepicker></farris-datepicker>\r\n        </ng-container>\r\n        <ng-template #singleDefaultdate>\r\n            <farris-datepicker [(ngModel)]=\"value\" [editable]=\"false\" [returnFormat]=\"showType == '2'? 'yyyy-MM': (showType == '3'? 'yyyy':'yyyy-MM-dd')\" \r\n            [dateFormat]=\"dateFormat\" (valueChange)=\"onDateChange($event)\" [placeholder]=\"placeholder\" [showType]=\"showType\" #datepicker></farris-datepicker>\r\n        </ng-template>\r\n    </ng-container>\r\n    <ng-template #elseTemplate>\r\n        <div class=\"d-flex align-items-center\">\r\n            <ng-container *ngIf=\"showTime;else startDefaultdate\">\r\n                <farris-datepicker [(ngModel)]=\"beginValue\" [editable]=\"false\" [returnFormat]=\"'yyyy-MM-dd HH:mm:ss'\" [dateFormat]=\"dateFormat\"\r\n                 (valueChange)=\"beginValueChange($event)\" [placeholder]=\"beginPlaceHolder\" [showTime]=\"showTime\" [maxDate]=\"endValue\" #datepicker></farris-datepicker>\r\n            </ng-container>\r\n            <ng-template #startDefaultdate>\r\n                <farris-datepicker [(ngModel)]=\"beginValue\" [editable]=\"false\" \r\n                [returnFormat]=\"showType == '2'? 'yyyy-MM': (showType == '3'? 'yyyy':'yyyy-MM-dd')\" [dateFormat]=\"dateFormat\" \r\n                (valueChange)=\"beginValueChange($event)\" [placeholder]=\"beginPlaceHolder\" [showType]=\"showType\" [maxDate]=\"endValue\" #datepicker></farris-datepicker>\r\n            </ng-template>\r\n            <span class=\"f-icon f-icon-orientation-arrow mx-2\"></span>\r\n            <ng-container *ngIf=\"showTime;else endDefaultdate\">\r\n                <farris-datepicker [(ngModel)]=\"endValue\" [editable]=\"false\" [returnFormat]=\"'yyyy-MM-dd HH:mm:ss'\" \r\n                [dateFormat]=\"dateFormat\" (valueChange)=\"endValueChange($event)\" [placeholder]=\"endPlaceHolder\" [showTime]=\"showTime\" [minDate]=\"beginValue\" #datepicker></farris-datepicker>\r\n            </ng-container>\r\n            <ng-template #endDefaultdate>\r\n                <farris-datepicker [(ngModel)]=\"endValue\" [editable]=\"false\" \r\n                [returnFormat]=\"showType == '2'? 'yyyy-MM': (showType == '3'? 'yyyy':'yyyy-MM-dd')\" \r\n                [dateFormat]=\"dateFormat\" (valueChange)=\"endValueChange($event)\" [placeholder]=\"endPlaceHolder\" [showType]=\"showType\" [minDate]=\"beginValue\" #datepicker></farris-datepicker>\r\n            </ng-template>\r\n        </div>\r\n    </ng-template>\r\n\r\n</div>\r\n<div class=\"f-filter-panel-date-tags\" *ngIf=\"!single && showType !== '3'\">\r\n    <div class=\"panel-date-tag\" *ngFor=\"let tag of dateTags\" (click)=\"clickTag(tag)\" \r\n    [ngClass]=\"{'active': tag.id == activedDateTagId}\">\r\n        {{tag.text}}\r\n    </div>\r\n</div>\r\n\r\n<div class=\"f-filter-panel-date-tags\" *ngIf=\"single && showType !== '3' && showType !== '2'\">\r\n    <div class=\"panel-date-tag\" *ngFor=\"let day of dayTags\" (click)=\"clickDayTag(day)\" [ngClass]=\"{'active': day.id == activedDayTagId}\">\r\n        {{day.text}}\r\n    </div>\r\n</div>"
            }] }
];
/** @nocollapse */
SearchFieldFlexibleDateComponent.ctorParameters = () => [
    { type: LocaleService },
    { type: Injector },
    { type: ChangeDetectorRef }
];
SearchFieldFlexibleDateComponent.propDecorators = {
    field: [{ type: Input }],
    valueChange: [{ type: Output }]
};
if (false) {
    /** @type {?} */
    SearchFieldFlexibleDateComponent.prototype.field;
    /** @type {?} */
    SearchFieldFlexibleDateComponent.prototype.valueChange;
    /** @type {?} */
    SearchFieldFlexibleDateComponent.prototype.single;
    /** @type {?} */
    SearchFieldFlexibleDateComponent.prototype.dateFormat;
    /** @type {?} */
    SearchFieldFlexibleDateComponent.prototype.showTime;
    /** @type {?} */
    SearchFieldFlexibleDateComponent.prototype.value;
    /** @type {?} */
    SearchFieldFlexibleDateComponent.prototype.beginValue;
    /** @type {?} */
    SearchFieldFlexibleDateComponent.prototype.endValue;
    /** @type {?} */
    SearchFieldFlexibleDateComponent.prototype.showType;
    /** @type {?} */
    SearchFieldFlexibleDateComponent.prototype.placeholder;
    /** @type {?} */
    SearchFieldFlexibleDateComponent.prototype.endPlaceHolder;
    /** @type {?} */
    SearchFieldFlexibleDateComponent.prototype.beginPlaceHolder;
    /** @type {?} */
    SearchFieldFlexibleDateComponent.prototype.activedDateTagId;
    /** @type {?} */
    SearchFieldFlexibleDateComponent.prototype.activedDayTagId;
    /** @type {?} */
    SearchFieldFlexibleDateComponent.prototype.dateTags;
    /** @type {?} */
    SearchFieldFlexibleDateComponent.prototype.dayTags;
    /**
     * @type {?}
     * @private
     */
    SearchFieldFlexibleDateComponent.prototype.dateHelp;
    /**
     * @type {?}
     * @private
     */
    SearchFieldFlexibleDateComponent.prototype.localeService;
    /**
     * @type {?}
     * @private
     */
    SearchFieldFlexibleDateComponent.prototype.injector;
    /**
     * @type {?}
     * @private
     */
    SearchFieldFlexibleDateComponent.prototype.cd;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmxleGlibGUtZGF0ZS5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL3VpLXNlYXJjaC1ib3gvIiwic291cmNlcyI6WyJsaWIvc2VhcmNoLWZpZWxkcy9lZGl0b3JzL2RhdGUvZmxleGlibGUtZGF0ZS5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxTQUFTLEVBQUUsWUFBWSxFQUFFLFFBQVEsRUFBRSxLQUFLLEVBQVUsTUFBTSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzVHLE9BQU8sRUFBRSxxQkFBcUIsRUFBRSxNQUFNLHdCQUF3QixDQUFDO0FBQy9ELE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQU9sRCxNQUFNLE9BQU8sZ0NBQWdDOzs7Ozs7SUF1QnpDLFlBQW9CLGFBQTRCLEVBQVUsUUFBa0IsRUFBVSxFQUFxQjtRQUF2RixrQkFBYSxHQUFiLGFBQWEsQ0FBZTtRQUFVLGFBQVEsR0FBUixRQUFRLENBQVU7UUFBVSxPQUFFLEdBQUYsRUFBRSxDQUFtQjtRQXBCakcsZ0JBQVcsR0FBRyxJQUFJLFlBQVksRUFBRSxDQUFDOztRQUUzQyxXQUFNLEdBQUcsSUFBSSxDQUFDO1FBQ2QsZUFBVSxHQUFHLEVBQUUsQ0FBQztRQUNoQixhQUFRLEdBQUcsS0FBSyxDQUFDO1FBQ2pCLFVBQUssR0FBRyxFQUFFLENBQUM7UUFDWCxlQUFVLEdBQUcsRUFBRSxDQUFDO1FBQ2hCLGFBQVEsR0FBRyxFQUFFLENBQUM7UUFDZCxhQUFRLEdBQUcsR0FBRyxDQUFDO1FBQ2YsZ0JBQVcsR0FBRyxFQUFFLENBQUM7UUFDakIsbUJBQWMsR0FBRyxFQUFFLENBQUM7UUFDcEIscUJBQWdCLEdBQUcsRUFBRSxDQUFDO1FBRXRCLHFCQUFnQixHQUFHLEVBQUUsQ0FBQztRQUN0QixvQkFBZSxHQUFHLEVBQUUsQ0FBQztRQUVyQixhQUFRLEdBQUcsRUFBRSxDQUFDO1FB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LEVBQUUsMEJBQTBCO2dCQUNwQyx5dEhBQTJDO2FBQzlDOzs7O1lBTFEsYUFBYTtZQUYrQixRQUFRO1lBQXBELGlCQUFpQjs7O29CQVdyQixLQUFLOzBCQUNMLE1BQU07Ozs7SUFEUCxpREFBZTs7SUFDZix1REFBMkM7O0lBRTNDLGtEQUFjOztJQUNkLHNEQUFnQjs7SUFDaEIsb0RBQWlCOztJQUNqQixpREFBVzs7SUFDWCxzREFBZ0I7O0lBQ2hCLG9EQUFjOztJQUNkLG9EQUFlOztJQUNmLHVEQUFpQjs7SUFDakIsMERBQW9COztJQUNwQiw0REFBc0I7O0lBRXRCLDREQUFzQjs7SUFDdEIsMkRBQXFCOztJQUVyQixvREFBYzs7SUFDZCxtREFBYTs7Ozs7SUFFYixvREFBK0M7Ozs7O0lBQ25DLHlEQUFvQzs7Ozs7SUFBRSxvREFBMEI7Ozs7O0lBQUUsOENBQTZCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ2hhbmdlRGV0ZWN0b3JSZWYsIENvbXBvbmVudCwgRXZlbnRFbWl0dGVyLCBJbmplY3RvciwgSW5wdXQsIE9uSW5pdCwgT3V0cHV0IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IERhdGVUaW1lSGVscGVyU2VydmljZSB9IGZyb20gJ0BmYXJyaXMvdWktY29tbW9uL2RhdGUnO1xyXG5pbXBvcnQgeyBMb2NhbGVTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy91aS1sb2NhbGUnO1xyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgICBzZWxlY3RvcjogJ3NlYXJjaC1maWxlZC1lZGl0b3ItZGF0ZScsXHJcbiAgICB0ZW1wbGF0ZVVybDogJ2ZsZXhpYmxlLWRhdGUuY29tcG9uZW50Lmh0bWwnXHJcbn0pXHJcblxyXG5leHBvcnQgY2xhc3MgU2VhcmNoRmllbGRGbGV4aWJsZURhdGVDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xyXG5cclxuICAgIEBJbnB1dCgpIGZpZWxkO1xyXG4gICAgQE91dHB1dCgpIHZhbHVlQ2hhbmdlID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG4gICAgLy8g5piv5ZCm5Li65Yy66Ze05pel5pyfXHJcbiAgICBzaW5nbGUgPSB0cnVlO1xyXG4gICAgZGF0ZUZvcm1hdCA9ICcnO1xyXG4gICAgc2hvd1RpbWUgPSBmYWxzZTtcclxuICAgIHZhbHVlID0gJyc7XHJcbiAgICBiZWdpblZhbHVlID0gJyc7XHJcbiAgICBlbmRWYWx1ZSA9ICcnO1xyXG4gICAgc2hvd1R5cGUgPSAnMSc7XHJcbiAgICBwbGFjZWhvbGRlciA9ICcnO1xyXG4gICAgZW5kUGxhY2VIb2xkZXIgPSAnJztcclxuICAgIGJlZ2luUGxhY2VIb2xkZXIgPSAnJztcclxuXHJcbiAgICBhY3RpdmVkRGF0ZVRhZ0lkID0gJyc7XHJcbiAgICBhY3RpdmVkRGF5VGFnSWQgPSAnJztcclxuXHJcbiAgICBkYXRlVGFncyA9IFtdO1xyXG4gICAgZGF5VGFncyA9IFtdO1xyXG5cclxuICAgIHByaXZhdGUgZGF0ZUhlbHA6IERhdGVUaW1lSGVscGVyU2VydmljZSA9IG51bGw7XHJcbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIGxvY2FsZVNlcnZpY2U6IExvY2FsZVNlcnZpY2UsIHByaXZhdGUgaW5qZWN0b3I6IEluamVjdG9yLCBwcml2YXRlIGNkOiBDaGFuZ2VEZXRlY3RvclJlZikge1xyXG4gICAgICAgIHRoaXMuZGF0ZUhlbHAgPSB0aGlzLmluamVjdG9yLmdldChEYXRlVGltZUhlbHBlclNlcnZpY2UsIG5ldyBEYXRlVGltZUhlbHBlclNlcnZpY2UoKSk7XHJcbiAgICB9XHJcblxyXG4gICAgbmdPbkluaXQoKTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy5kYXRlVGFncyA9IFtcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaWQ6ICd0YWcxJyxcclxuICAgICAgICAgICAgICAgIHRleHQ6IHRoaXMubG9jYWxlU2VydmljZS5nZXRWYWx1ZSgnZmlsdGVyUGFuZWwubGFzdDFNb250aCcpXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGlkOiAndGFnMicsXHJcbiAgICAgICAgICAgICAgICB0ZXh0OiB0aGlzLmxvY2FsZVNlcnZpY2UuZ2V0VmFsdWUoJ2ZpbHRlclBhbmVsLmxhc3QzTW9udGgnKVxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpZDogJ3RhZzMnLFxyXG4gICAgICAgICAgICAgICAgdGV4dDogdGhpcy5sb2NhbGVTZXJ2aWNlLmdldFZhbHVlKCdmaWx0ZXJQYW5lbC5sYXN0Nk1vbnRoJylcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIF07XHJcbiAgICAgICAgdGhpcy5kYXlUYWdzID0gW1xyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpZDogJ3llc3RlcmRheScsXHJcbiAgICAgICAgICAgICAgICB0ZXh0OiB0aGlzLmxvY2FsZVNlcnZpY2UuZ2V0VmFsdWUoJ2ZpbHRlclBhbmVsLnllc3RlcmRheScpXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGlkOiAndG9kYXknLFxyXG4gICAgICAgICAgICAgICAgdGV4dDogdGhpcy5sb2NhbGVTZXJ2aWNlLmdldFZhbHVlKCdmaWx0ZXJQYW5lbC50b2RheScpXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICBdO1xyXG5cclxuXHJcbiAgICAgICAgaWYgKHRoaXMuZmllbGQuY29udHJvbCkge1xyXG4gICAgICAgICAgICBjb25zdCB7IHNob3dUaW1lLCBzaG93VHlwZSwgc2luZ2xlIH0gPSB0aGlzLmZpZWxkLmNvbnRyb2w7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmZpZWxkLnZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCB7IHZhbHVlLCBiZWdpbiwgZW5kIH0gPSB0aGlzLmZpZWxkLnZhbHVlO1xyXG4gICAgICAgICAgICAgICAgdGhpcy52YWx1ZSA9IHZhbHVlLFxyXG4gICAgICAgICAgICAgICAgdGhpcy5iZWdpblZhbHVlID0gYmVnaW47XHJcbiAgICAgICAgICAgICAgICB0aGlzLmVuZFZhbHVlID0gZW5kO1xyXG4gICAgICAgICAgICB9XHJcbiAgICBcclxuICAgICAgICAgICAgdGhpcy5zaG93VGltZSA9IHNob3dUaW1lO1xyXG4gICAgICAgICAgICB0aGlzLnNob3dUeXBlID0gc2hvd1R5cGU7XHJcbiAgICAgICAgICAgIHRoaXMuc2luZ2xlID0gc2luZ2xlO1xyXG5cclxuICAgICAgICAgICAgbGV0IGl0ZW1EYXRlRm9ybWF0ID0gdGhpcy5maWVsZC5jb250cm9sLmRhdGVGb3JtYXQ7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLnNob3dUaW1lICYmIGl0ZW1EYXRlRm9ybWF0KSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoaXRlbURhdGVGb3JtYXQubGVuZ3RoID4gMCAmJiBpdGVtRGF0ZUZvcm1hdC5pbmRleE9mKCdISDptbScpID09IC0xKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaXRlbURhdGVGb3JtYXQgPSBpdGVtRGF0ZUZvcm1hdCArICcgSEg6bW06c3MnO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgaXRlbURhdGVGb3JtYXQgPSB0aGlzLnNob3dUaW1lID8gJ3l5eXktTU0tZGQgSEg6bW06c3MnIDogKHRoaXMuc2hvd1R5cGUgPT0gJzInID8gJ3l5eXktTU0nIDogKHRoaXMuc2hvd1R5cGUgPT0gJzMnID8gJ3l5eXknIDogJ3l5eXktTU0tZGQnKSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5kYXRlRm9ybWF0ID0gaXRlbURhdGVGb3JtYXQ7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIG9uRGF0ZUNoYW5nZSgkZXZlbnQpIHtcclxuICAgICAgICB0aGlzLnZhbHVlQ2hhbmdlLmVtaXQoeyAgZmllbGQ6IHRoaXMuZmllbGQuY29kZSwgdmFsdWU6IHt2YWx1ZTogdGhpcy52YWx1ZSwgc2luZ2xlOiB0cnVlfX0pO1xyXG4gICAgfVxyXG5cclxuICAgIGJlZ2luVmFsdWVDaGFuZ2UoJGV2ZW50KSB7XHJcbiAgICAgICAgdGhpcy52YWx1ZUNoYW5nZS5lbWl0KHsgIGZpZWxkOiB0aGlzLmZpZWxkLmNvZGUsdmFsdWU6IHsgYmVnaW46IHRoaXMuYmVnaW5WYWx1ZSwgZW5kOiB0aGlzLmVuZFZhbHVlLCBzaW5nbGU6IGZhbHNlfX0pO1xyXG4gICAgfVxyXG4gICAgZW5kVmFsdWVDaGFuZ2UoJGV2ZW50KSB7XHJcbiAgICAgICAgdGhpcy52YWx1ZUNoYW5nZS5lbWl0KHsgIGZpZWxkOiB0aGlzLmZpZWxkLmNvZGUsIHZhbHVlOiB7IGJlZ2luOiB0aGlzLmJlZ2luVmFsdWUsIGVuZDogdGhpcy5lbmRWYWx1ZSwgc2luZ2xlOiBmYWxzZX19KTtcclxuICAgIH1cclxuXHJcbiAgICBvblNpbmdsZUNoYW5nZSgkZXZlbnQpIHtcclxuICAgICAgICB0aGlzLnNpbmdsZSA9ICEkZXZlbnQ7XHJcbiAgICAgICAgdGhpcy52YWx1ZUNoYW5nZS5lbWl0KHsgIGZpZWxkOiB0aGlzLmZpZWxkLmNvZGUsdmFsdWU6IHt2YWx1ZTogdGhpcy52YWx1ZSwgIGJlZ2luOiB0aGlzLmJlZ2luVmFsdWUsIGVuZDogdGhpcy5lbmRWYWx1ZSwgc2luZ2xlOiB0aGlzLnNpbmdsZX19KTtcclxuICAgICAgICB0aGlzLmNkLmRldGVjdENoYW5nZXMoKTtcclxuICAgIH1cclxuXHJcbiAgICBjbGlja1RhZyh0YWcpIHtcclxuICAgICAgICB0aGlzLmFjdGl2ZWREYXRlVGFnSWQgPSB0YWcuaWQ7XHJcbiAgICAgICAgbGV0IHRhZ0RhdGU7XHJcbiAgICAgICAgaWYgKHRhZy5pZCA9PSAndGFnMScpIHtcclxuICAgICAgICAgICAgdGFnRGF0ZSA9IHRoaXMuZ2V0TGFzdE51bU1vbnRoKDEsIHRoaXMuc2hvd1RpbWUsIHRoaXMuc2hvd1R5cGUpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmICh0YWcuaWQgPT0gJ3RhZzInKSB7XHJcbiAgICAgICAgICAgIHRhZ0RhdGUgPSB0aGlzLmdldExhc3ROdW1Nb250aCgzLCB0aGlzLnNob3dUaW1lLCB0aGlzLnNob3dUeXBlKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAodGFnLmlkID09ICd0YWczJykge1xyXG4gICAgICAgICAgICB0YWdEYXRlID0gdGhpcy5nZXRMYXN0TnVtTW9udGgoNiwgdGhpcy5zaG93VGltZSwgdGhpcy5zaG93VHlwZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuYmVnaW5WYWx1ZSA9IHRhZ0RhdGVbJ3N0YXJ0VGltZSddO1xyXG4gICAgICAgIHRoaXMuZW5kVmFsdWUgPSB0YWdEYXRlWydlbmRUaW1lJ107XHJcbiAgICAgICAgdGhpcy52YWx1ZUNoYW5nZS5lbWl0KHsgIGZpZWxkOiB0aGlzLmZpZWxkLmNvZGUsdmFsdWU6IHt2YWx1ZTogdGhpcy52YWx1ZSwgIGJlZ2luOiB0aGlzLmJlZ2luVmFsdWUsIGVuZDogdGhpcy5lbmRWYWx1ZSwgc2luZ2xlOiB0aGlzLnNpbmdsZX19KTtcclxuICAgICAgICB0aGlzLmNkLmRldGVjdENoYW5nZXMoKTtcclxuICAgIH1cclxuXHJcbiAgICBjbGlja0RheVRhZyh0YWcpIHtcclxuICAgICAgICB0aGlzLmFjdGl2ZWREYXlUYWdJZCA9IHRhZy5pZDtcclxuICAgICAgICBsZXQgZGF5VGFnID0gdGhpcy5nZXRUb2RheSh0aGlzLmFjdGl2ZWREYXlUYWdJZCwgdGhpcy5zaG93VGltZSk7XHJcbiAgICAgICAgdGhpcy52YWx1ZSA9IGRheVRhZztcclxuICAgICAgICB0aGlzLnZhbHVlQ2hhbmdlLmVtaXQoeyAgZmllbGQ6IHRoaXMuZmllbGQuY29kZSwgdmFsdWU6IHt2YWx1ZTogdGhpcy52YWx1ZSwgc2luZ2xlOiB0cnVlfX0pO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZ2V0TGFzdE51bU1vbnRoKG51bTpudW1iZXIsc2hvd3RpbWUsdHlwZTpzdHJpbmcpIHtcclxuICAgICAgICBsZXQgbm93ID0gbmV3IERhdGUoKTtcclxuICAgICAgICBsZXQgeWVhciA9IG5vdy5nZXRGdWxsWWVhcigpO1xyXG4gICAgICAgIGxldCBtb250aCA9IG5vdy5nZXRNb250aCgpICsgMTsvLzAtMTHooajnpLoxLTEy5pyIXHJcbiAgICAgICAgbGV0IGRheSA9IG5vdy5nZXREYXRlKCk7XHJcbiAgICAgICAgbGV0IGhvdXIgPSBub3cuZ2V0SG91cnMoKTtcclxuICAgICAgICBsZXQgbWluID0gbm93LmdldE1pbnV0ZXMoKSA8IDEwID8gJzAnICsgbmV3IERhdGUoKS5nZXRNaW51dGVzKClcclxuICAgICAgICAgICAgOm5ldyBEYXRlKCkuZ2V0TWludXRlcygpO1xyXG4gICAgICAgICAgbGV0IHNlYyA9IG5ldyBEYXRlKCkuZ2V0U2Vjb25kcygpIDwgMTAgPyAnMCcgKyBuZXcgRGF0ZSgpLmdldFNlY29uZHMoKVxyXG4gICAgICAgICAgICA6bmV3IERhdGUoKS5nZXRTZWNvbmRzKCk7XHJcbiAgICAgICAgbGV0IGRhdGVPYmogPSB7fTtcclxuICAgICAgICBjb25zdCB0aW1lID0gaG91ciArICc6JyArIG1pbiArICc6JyArIHNlYztcclxuICAgICAgICAvLyBkYXRlT2JqWydlbmRUaW1lJ10gPSB5ZWFyICsgJy0nICsgbW9udGggKyAnLScgKyBkYXk7XHJcbiAgICAgICAgbGV0IGVuZE1vbnRoID0gbW9udGggPCAxMCA/ICcwJyArbW9udGggOiBtb250aDtcclxuICAgICAgICBsZXQgZW5kRGF5ID0gZGF5IDwgMTAgPyAnMCcgK2RheSA6IGRheTtcclxuICAgICAgICBpZih0eXBlID09ICcyJyl7XHJcbiAgICAgICAgICAgIGRhdGVPYmpbJ2VuZFRpbWUnXSA9IHllYXIgKyAnLScgKyBlbmRNb250aDtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZih0eXBlID09ICczJyl7XHJcbiAgICAgICAgICAgIGRhdGVPYmpbJ2VuZFRpbWUnXSA9IHllYXI7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2V7XHJcbiAgICAgICAgICAgIGRhdGVPYmpbJ2VuZFRpbWUnXSA9IHllYXIgKyAnLScgKyBlbmRNb250aCArICctJyArIGVuZERheTtcclxuICAgICAgICB9XHJcbiAgICAgICAgICBsZXQgbm93TW9udGhEYXkgPSBuZXcgRGF0ZSh5ZWFyLCBtb250aCwgMCkuZ2V0RGF0ZSgpOyAgICAvL+W9k+WJjeaciOeahOaAu+WkqeaVsFxyXG4gICAgICAgIGxldCBkWWVhcixkTW91dGgsZERheTtcclxuICAgICAgICBpZihtb250aCAtIG51bSA8PSAwKXsgLy/lpoLmnpzmmK8x44CBMuOAgTPmnIjvvIzlubTmlbDlvoDliY3mjqjkuIDlubRcclxuICAgICAgICAgICAgbGV0IGxhc3RNb250aERheSA9IG5ldyBEYXRlKCh5ZWFyIC0gMSksICgxMiAtIChudW0gLSBtb250aCkpLCAwKS5nZXREYXRlKCk7ICAgIC8vM+S4quaciOWJjeaJgOWcqOaciOeahOaAu+WkqeaVsFxyXG4gICAgICAgICAgICBpZihsYXN0TW9udGhEYXkgPCBkYXkpeyAgICAvLzPkuKrmnIjliY3miYDlnKjmnIjnmoTmgLvlpKnmlbDlsI/kuo7njrDlnKjnmoTlpKnml6XmnJ9cclxuICAgICAgICAgICAgICAgIC8vIGRhdGVPYmpbJ3N0YXJ0VGltZSddID0gKHllYXIgLSAxKSArICctJyArICgxMiAtIChudW0gLSBtb250aCkpICsgJy0nICsgbGFzdE1vbnRoRGF5O1xyXG4gICAgICAgICAgICAgICAgZFllYXIgPSB5ZWFyIC0gMTtcclxuICAgICAgICAgICAgICAgIGRNb3V0aCA9IDEyIC0gKG51bSAtIG1vbnRoKTtcclxuICAgICAgICAgICAgICAgIGREYXkgPSBsYXN0TW9udGhEYXk7XHJcbiAgICAgICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICAgICAgZFllYXIgPSB5ZWFyIC0gMTtcclxuICAgICAgICAgICAgICAgIGRNb3V0aCA9IDEyIC0gKG51bSAtIG1vbnRoKTtcclxuICAgICAgICAgICAgICAgIGREYXkgPSBkYXk7XHJcbiAgICAgICAgICAgICAgICAvLyBkYXRlT2JqWydzdGFydFRpbWUnXT0gKHllYXIgLSAxKSArICctJyArICgxMiAtIChudW0gLSBtb250aCkpICsgJy0nICsgZGF5O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgIGxldCBsYXN0TW9udGhEYXkgPSBuZXcgRGF0ZSh5ZWFyLCAobW9udGggLSBudW0pLCAwKS5nZXREYXRlKCk7ICAgIC8vM+S4quaciOWJjeaJgOWcqOaciOeahOaAu+WkqeaVsFxyXG4gICAgICAgICAgICBpZihsYXN0TW9udGhEYXkgPCBkYXkpeyAgICAvLzPkuKrmnIjliY3miYDlnKjmnIjnmoTmgLvlpKnmlbDlsI/kuo7njrDlnKjnmoTlpKnml6XmnJ9cclxuICAgICAgICAgICAgICAgIGlmKGRheSA8IG5vd01vbnRoRGF5KXsgICAgICAgIC8v5b2T5YmN5aSp5pel5pyf5bCP5LqO5b2T5YmN5pyI5oC75aSp5pWwLDLmnIjku73mr5TovoPnibnmrornmoTmnIjku71cclxuICAgICAgICAgICAgICAgICAgICAvLyBkYXRlT2JqWydzdGFydFRpbWUnXSA9IHllYXIgKyAnLScgKyAobW9udGggLSBudW0pICsgJy0nICsgKGxhc3RNb250aERheSAtIChub3dNb250aERheSAtIGRheSkpO1xyXG4gICAgICAgICAgICAgICAgICAgIGRZZWFyID0geWVhcjtcclxuICAgICAgICAgICAgICAgICAgICBkTW91dGggPSBtb250aCAtIG51bTtcclxuICAgICAgICAgICAgICAgICAgICBkRGF5ID0gbGFzdE1vbnRoRGF5IC0gKG5vd01vbnRoRGF5IC0gZGF5KTtcclxuICAgICAgICAgICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICAgICAgICAgIGRZZWFyID0geWVhcjtcclxuICAgICAgICAgICAgICAgICAgICBkTW91dGggPSBtb250aCAtIG51bTtcclxuICAgICAgICAgICAgICAgICAgICBkRGF5ID0gbGFzdE1vbnRoRGF5O1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIGRhdGVPYmpbJ3N0YXJ0VGltZSddID0geWVhciArICctJyArIChtb250aCAtIG51bSkgKyAnLScgKyBsYXN0TW9udGhEYXk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICAgICAgZFllYXIgPSB5ZWFyO1xyXG4gICAgICAgICAgICAgICAgZE1vdXRoID0gbW9udGggLSBudW07XHJcbiAgICAgICAgICAgICAgICBkRGF5ID0gZGF5O1xyXG4gICAgICAgICAgICAgICAgLy8gZGF0ZU9ialsnc3RhcnRUaW1lJ10gPSB5ZWFyICsgJy0nICsgKG1vbnRoIC0gbnVtKSArICctJyArIGRheTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBkTW91dGggPSBkTW91dGggPCAxMCA/ICcwJyArZE1vdXRoIDogZE1vdXRoO1xyXG4gICAgICAgIGREYXkgPSBkRGF5IDwgMTAgPyAnMCcgK2REYXkgOiBkRGF5O1xyXG4gICAgICAgIGlmKHR5cGUgPT0gJzInKXtcclxuICAgICAgICAgICAgZGF0ZU9ialsnc3RhcnRUaW1lJ10gPSBkWWVhciArICctJyArIGRNb3V0aDtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZih0eXBlID09ICczJyl7XHJcbiAgICAgICAgICAgIGRhdGVPYmpbJ3N0YXJ0VGltZSddID0gZFllYXI7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2V7XHJcbiAgICAgICAgICAgIGRhdGVPYmpbJ3N0YXJ0VGltZSddID0gZFllYXIgKyAnLScgKyBkTW91dGggKyAnLScgKyBkRGF5O1xyXG4gICAgICAgIH1cclxuICAgIFxyXG4gICAgICAgIGlmKHNob3d0aW1lKXtcclxuICAgICAgICAgICAgZGF0ZU9ialsnZW5kVGltZSddID0gZGF0ZU9ialsnZW5kVGltZSddICsgJyAnICsgdGltZTtcclxuICAgICAgICAgICAgZGF0ZU9ialsnc3RhcnRUaW1lJ10gPSBkYXRlT2JqWydzdGFydFRpbWUnXSArICcgJyArIHRpbWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBkYXRlT2JqO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICBwcml2YXRlIGdldFRvZGF5KGRheVRhZ3MgPSAndG9kYXknLHNob3d0aW1lKXtcclxuICAgICAgICBsZXQgbm93ID0gbmV3IERhdGUoKTtcclxuXHJcbiAgICAgICAgaWYoZGF5VGFncyA9PSAndG9kYXknKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmRhdGVIZWxwLmZvcm1hdFRvKG5vdywgdGhpcy5kYXRlRm9ybWF0KTtcclxuICAgICAgICB9IGVsc2UgaWYgKGRheVRhZ3MgPT0gJ3llc3RlcmRheScpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZGF0ZUhlbHAuZm9ybWF0VG8odGhpcy5kYXRlSGVscC5zdWJEYXlzKG5vdywgMSksIHRoaXMuZGF0ZUZvcm1hdCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvKlxyXG4gICAgICAgIGxldCB5ZWFyID0gbm93LmdldEZ1bGxZZWFyKCk7XHJcbiAgICAgICAgbGV0IG1vbnRoID0gbm93LmdldE1vbnRoKCkgKyAxOy8vMC0xMeihqOekujEtMTLmnIhcclxuICAgICAgICBsZXQgZGF5ID0gbm93LmdldERhdGUoKTtcclxuICAgICAgICBsZXQgaG91ciA9IG5vdy5nZXRIb3VycygpO1xyXG4gICAgICAgIGxldCBtaW4gPSBub3cuZ2V0TWludXRlcygpIDwgMTAgPyAnMCcgKyBuZXcgRGF0ZSgpLmdldE1pbnV0ZXMoKVxyXG4gICAgICAgICAgICA6bmV3IERhdGUoKS5nZXRNaW51dGVzKCk7XHJcbiAgICAgICAgbGV0IHNlYyA9IG5ldyBEYXRlKCkuZ2V0U2Vjb25kcygpIDwgMTAgPyAnMCcgKyBuZXcgRGF0ZSgpLmdldFNlY29uZHMoKVxyXG4gICAgICAgICAgICA6bmV3IERhdGUoKS5nZXRTZWNvbmRzKCk7XHJcbiAgICAgICAgY29uc3QgdGltZSA9IGhvdXIgKyAnOicgKyBtaW4gKyAnOicgKyBzZWM7XHJcbiAgICAgICAgbGV0IHllc3RlcmRheSA9IG5ldyBEYXRlKCk7XHJcbiAgICAgICAgeWVzdGVyZGF5LnNldFRpbWUobm93LmdldFRpbWUoKS0yNCo2MCo2MCoxMDAwKTtcclxuICAgICAgICBsZXQgeWVzdGVyZGF5T2JqID0geWVzdGVyZGF5LmdldEZ1bGxZZWFyKCkrXCItXCIgKyAoeWVzdGVyZGF5LmdldE1vbnRoKCkrMSkgKyBcIi1cIiArIHllc3RlcmRheS5nZXREYXRlKCk7XHJcbiAgICAgICAgbGV0IGRhdGVPYmogPSB5ZWFyICsgJy0nICsgbW9udGggKyAnLScgKyBkYXk7XHJcbiAgICAgICAgaWYoc2hvd3RpbWUpe1xyXG4gICAgICAgICAgICBkYXRlT2JqID0gZGF0ZU9iaiArICcgJyArIHRpbWU7XHJcbiAgICAgICAgICAgIHllc3RlcmRheU9iaiA9IHllc3RlcmRheU9iaiArICcgJyArIHRpbWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmKGRheVRhZ3MgPT0gJ3RvZGF5JykgcmV0dXJuIGRhdGVPYmo7XHJcbiAgICAgICAgZWxzZSBpZiAoZGF5VGFncyA9PSAneWVzdGVyZGF5JykgcmV0dXJuIHllc3RlcmRheU9iajtcclxuXHJcbiAgICAgICAgKi9cclxuICAgICAgICBcclxuICAgIH1cclxufSJdfQ==
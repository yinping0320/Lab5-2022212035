/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { ChangeDetectorRef, Component, ElementRef, EventEmitter, Injector, Input, Output, ViewChild } from "@angular/core";
import { cloneDeep } from 'lodash-es';
export class SearchFieldEnumEditorComponent {
    /**
     * @param {?} injector
     * @param {?} cd
     */
    constructor(injector, cd) {
        this.injector = injector;
        this.cd = cd;
        this.checkedAll = false;
        this.boolcheck = false;
        this.valueChange = new EventEmitter();
        // indeterminate: boolean = true;
        // boolchecked: boolean;
        // boolCheckState: string = "indeterminate";
        this.checkboxDataSource = new Array();
    }
    /**
     * @return {?}
     */
    get field() {
        return this._item;
    }
    /**
     * @param {?} data
     * @return {?}
     */
    set field(data) {
        this._item = cloneDeep(data);
        this.getDataSource();
        //this.checkValue = this._item.value.getOriginalValue();
        if (!this._item.hasOwnProperty("value")) {
            this._item.value = { value: [] };
        }
        if (this._item.hasOwnProperty("value") && this._item.value) {
            this.checkValue = this._item.value.value;
        }
        else {
            this._item.value = { value: [] };
        }
        // if (this.boolcheck) {
        //     if (this.checkValue.length) {
        //         this.boolchecked = this.checkValue[0];
        //         if (this.boolchecked) this.boolCheckState = "checked";
        //         else this.boolCheckState = "unchecked";
        //     } else this.boolCheckState = "indeterminate";
        // }
        if (this._item.value.value.length == 0) {
            this.checkedAll = false;
        }
        else if (this._item.control["enumValues"] && this._item.value.value.length == this._item.control["enumValues"].length) {
            this.checkedAll = true;
        }
        this.setSubmitChange();
    }
    /**
     * @return {?}
     */
    ngOnInit() { }
    /**
     * @return {?}
     */
    getDataSource() {
        if (this.field && this._item.control) {
            /** @type {?} */
            let checkboxList = this._item.control;
            this.checkboxDataSource = Array();
            if (checkboxList.enumValues && checkboxList.enumValues.length > 0) {
                checkboxList.enumValues.forEach((/**
                 * @param {?} element
                 * @return {?}
                 */
                (element) => {
                    this.checkboxDataSource.push(Object.assign({}, element));
                }));
            }
        }
    }
    /**
     * @param {?} event
     * @return {?}
     */
    onSearch(event) {
        /** @type {?} */
        let checkboxValue = [];
        if (event) {
            // let checkboxList = event.split(',');
            /** @type {?} */
            let checkboxList = event;
            if (checkboxList && checkboxList.length) {
                checkboxValue = checkboxList;
            }
            this._item.value.value = checkboxValue;
        }
        else {
            this._item.value.value = "";
        }
        if (checkboxValue.length < this._item.control["enumValues"].length) {
            this.checkedAll = false;
            // this.checkAllElRef.nativeElement.indeterminate = !!checkboxValue.length;
            // if (!checkboxValue.length) {
            //     this.checkedAll = false;    
            // }
        }
        else if (checkboxValue.length == this._item.control["enumValues"].length) {
            this.checkedAll = true;
            // this.checkAllElRef.nativeElement.indeterminate = false;
        }
        this.cd.detectChanges();
        this.getValueText();
        this.setSubmitChange();
        this.valueChange.emit({ field: this.field.code, value: { value: checkboxValue, single: true } });
    }
    /**
     * @return {?}
     */
    getValueText() {
        /** @type {?} */
        const enumValue = this._item.control.enumValues;
        /** @type {?} */
        const value = this._item.value.value;
        if (enumValue && enumValue.length && value && value.length) {
            /** @type {?} */
            let texts = [];
            for (let i = 0; i <= value.length; i++) {
                /** @type {?} */
                const enums = enumValue.find((/**
                 * @param {?} val
                 * @return {?}
                 */
                (val) => {
                    return val["value"] == value[i];
                }));
                if (enums) {
                    texts.push(enums["name"]);
                }
            }
            this._item.valueText = texts.join(",");
        }
    }
    /**
     * @return {?}
     */
    setSubmitChange() {
        /** @type {?} */
        const val = this._item.value;
        if (Object.keys(val).length < 0 ||
            Object.keys(val.value).length === 0) {
            // this.submitChange.emit(false);
        }
        else {
            // this.submitChange.emit(true);
        }
    }
    /**
     * @param {?} event
     * @return {?}
     */
    onCheckAll(event) {
        // this.checkAllElRef.nativeElement.indeterminate = false;
        this.checkedAll = !this.checkedAll;
        if (this.checkedAll) {
            this.setCheckedAll();
        }
        else {
            this._item.value.value = [];
            this._item.valueText = "";
            this.checkValue = [];
        }
        this.getValueText();
        this.setSubmitChange();
        this.cd.detectChanges();
        this.valueChange.emit({ field: this.field.code, value: { value: this.checkValue, single: true } });
    }
    /**
     * @private
     * @return {?}
     */
    setCheckedAll() {
        /** @type {?} */
        const enumValue = this._item.control.enumValues;
        if (enumValue && enumValue.length) {
            /** @type {?} */
            let checkboxValue = [];
            //checkboxTexts = [];
            for (let i = 0; i < enumValue.length; i++) {
                checkboxValue.push(enumValue[i]["value"]);
                //checkboxTexts.push(enumValue[i]['name'])
            }
            this._item.value.value = checkboxValue;
            this.checkValue = this._item.value.value;
            //this._item.valueText = checkboxTexts.join(',');
            this.cd.detectChanges();
        }
    }
}
SearchFieldEnumEditorComponent.decorators = [
    { type: Component, args: [{
                selector: "search-filed-editor-enum",
                template: "<div class=\"custom-control custom-checkbox custom-control-inline filter-panel-checkbox\" style=\"padding-left: 10px;\">\r\n    <input type=\"checkbox\" class=\"custom-control-input\"  [checked]=\"checkedAll\" #checkAllEl>\r\n    <label class=\"custom-control-label\" (click)=\"onCheckAll($event)\">{{'filterPanel.checkall'| locale}}</label>\r\n</div>\r\n<farris-checkboxgroup [value]=\"checkValue\" [horizontal]=\"false\" style=\"padding-left: 10px;\"\r\n    [data]=\"checkboxDataSource\" [isStringValue]=\"false\" (changeValue)=\"onSearch($event)\">\r\n</farris-checkboxgroup>\r\n"
            }] }
];
/** @nocollapse */
SearchFieldEnumEditorComponent.ctorParameters = () => [
    { type: Injector },
    { type: ChangeDetectorRef }
];
SearchFieldEnumEditorComponent.propDecorators = {
    boolcheck: [{ type: Input }],
    field: [{ type: Input }],
    valueChange: [{ type: Output }],
    checkAllElRef: [{ type: ViewChild, args: ['checkAllEl',] }]
};
if (false) {
    /** @type {?} */
    SearchFieldEnumEditorComponent.prototype.checkedAll;
    /** @type {?} */
    SearchFieldEnumEditorComponent.prototype.boolcheck;
    /** @type {?} */
    SearchFieldEnumEditorComponent.prototype._item;
    /** @type {?} */
    SearchFieldEnumEditorComponent.prototype.valueChange;
    /** @type {?} */
    SearchFieldEnumEditorComponent.prototype.checkValue;
    /** @type {?} */
    SearchFieldEnumEditorComponent.prototype.checkboxDataSource;
    /** @type {?} */
    SearchFieldEnumEditorComponent.prototype.checkAllElRef;
    /**
     * @type {?}
     * @private
     */
    SearchFieldEnumEditorComponent.prototype.injector;
    /**
     * @type {?}
     * @private
     */
    SearchFieldEnumEditorComponent.prototype.cd;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2VhcmNoLWVkaXRvci1lbnVtLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvdWktc2VhcmNoLWJveC8iLCJzb3VyY2VzIjpbImxpYi9zZWFyY2gtZmllbGRzL2VkaXRvcnMvZW51bS9zZWFyY2gtZWRpdG9yLWVudW0uY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsU0FBUyxFQUFFLFVBQVUsRUFBRSxZQUFZLEVBQUUsUUFBUSxFQUFFLEtBQUssRUFBVSxNQUFNLEVBQUUsU0FBUyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ25JLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxXQUFXLENBQUM7QUFLdEMsTUFBTSxPQUFPLDhCQUE4Qjs7Ozs7SUFnRHZDLFlBQW9CLFFBQWtCLEVBQVUsRUFBcUI7UUFBakQsYUFBUSxHQUFSLFFBQVEsQ0FBVTtRQUFVLE9BQUUsR0FBRixFQUFFLENBQW1CO1FBL0NyRSxlQUFVLEdBQVksS0FBSyxDQUFDO1FBQ25CLGNBQVMsR0FBWSxLQUFLLENBQUM7UUFrQzFCLGdCQUFXLEdBQUcsSUFBSSxZQUFZLEVBQUUsQ0FBQzs7OztRQVEzQyx1QkFBa0IsR0FBZSxJQUFJLEtBQUssRUFBTyxDQUFDO0lBSXVCLENBQUM7Ozs7SUE1QzFFLElBQ0ksS0FBSztRQUNMLE9BQU8sSUFBSSxDQUFDLEtBQUssQ0FBQztJQUN0QixDQUFDOzs7OztJQUNELElBQUksS0FBSyxDQUFDLElBQUk7UUFDVixJQUFJLENBQUMsS0FBSyxHQUFHLFNBQVMsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUM3QixJQUFJLENBQUMsYUFBYSxFQUFFLENBQUM7UUFDckIsd0RBQXdEO1FBQ3hELElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLGNBQWMsQ0FBQyxPQUFPLENBQUMsRUFBRTtZQUNyQyxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssR0FBRyxFQUFFLEtBQUssRUFB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R0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLFNBQVMsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxFQUFFLEVBQUU7Z0JBQ3ZDLGFBQWEsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUM7Z0JBQzFDLDBDQUEwQzthQUM3QztZQUNELElBQUksQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLEtBQUssR0FBRyxhQUFhLENBQUM7WUFDdkMsSUFBSSxDQUFDLFVBQVUsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUM7WUFDekMsaURBQWlEO1lBRWpELElBQUksQ0FBQyxFQUFFLENBQUMsYUFBYSxFQUFFLENBQUM7U0FDM0I7SUFDTCxDQUFDOzs7WUEvSkosU0FBUyxTQUFDO2dCQUNQLFFBQVEsRUFBRSwwQkFBMEI7Z0JBQ3BDLGtsQkFBa0Q7YUFDckQ7Ozs7WUFMZ0UsUUFBUTtZQUFoRSxpQkFBaUI7Ozt3QkFRckIsS0FBSztvQkFFTCxLQUFLOzBCQWdDTCxNQUFNOzRCQVVOLFNBQVMsU0FBQyxZQUFZOzs7O0lBN0N2QixvREFBNEI7O0lBQzVCLG1EQUFvQzs7SUFDcEMsK0NBQVc7O0lBaUNYLHFEQUEyQzs7SUFHM0Msb0RBQWtCOztJQUtsQiw0REFBa0Q7O0lBRWxELHVEQUFtRDs7Ozs7SUFFdkMsa0RBQTBCOzs7OztJQUFFLDRDQUE2QiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENoYW5nZURldGVjdG9yUmVmLCBDb21wb25lbnQsIEVsZW1lbnRSZWYsIEV2ZW50RW1pdHRlciwgSW5qZWN0b3IsIElucHV0LCBPbkluaXQsIE91dHB1dCwgVmlld0NoaWxkIH0gZnJvbSBcIkBhbmd1bGFyL2NvcmVcIjtcclxuaW1wb3J0IHsgY2xvbmVEZWVwIH0gZnJvbSAnbG9kYXNoLWVzJztcclxuQENvbXBvbmVudCh7XHJcbiAgICBzZWxlY3RvcjogXCJzZWFyY2gtZmlsZWQtZWRpdG9yLWVudW1cIixcclxuICAgIHRlbXBsYXRlVXJsOiBcIi4vc2VhcmNoLWVkaXRvci1lbnVtLmNvbXBvbmVudC5odG1sXCIsXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBTZWFyY2hGaWVsZEVudW1FZGl0b3JDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xyXG4gICAgY2hlY2tlZEFsbDogYm9vbGVhbiA9IGZhbHNlO1xyXG4gICAgQElucHV0KCkgYm9vbGNoZWNrOiBib29sZWFuID0gZmFsc2U7XHJcbiAgICBfaXRlbTogYW55O1xyXG4gICAgQElucHV0KClcclxuICAgIGdldCBmaWVsZCgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5faXRlbTtcclxuICAgIH1cclxuICAgIHNldCBmaWVsZChkYXRhKSB7XHJcbiAgICAgICAgdGhpcy5faXRlbSA9IGNsb25lRGVlcChkYXRhKTtcclxuICAgICAgICB0aGlzLmdldERhdGFTb3VyY2UoKTtcclxuICAgICAgICAvL3RoaXMuY2hlY2tWYWx1ZSA9IHRoaXMuX2l0ZW0udmFsdWUuZ2V0T3JpZ2luYWxWYWx1ZSgpO1xyXG4gICAgICAgIGlmICghdGhpcy5faXRlbS5oYXNPd25Qcm9wZXJ0eShcInZhbHVlXCIpKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX2l0ZW0udmFsdWUgPSB7IHZhbHVlOiBbXSB9O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHRoaXMuX2l0ZW0uaGFzT3duUHJvcGVydHkoXCJ2YWx1ZVwiKSAmJiB0aGlzLl9pdGVtLnZhbHVlKSB7XHJcbiAgICAgICAgICAgIHRoaXMuY2hlY2tWYWx1ZSA9IHRoaXMuX2l0ZW0udmFsdWUudmFsdWU7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5faXRlbS52YWx1ZSA9IHsgdmFsdWU6IFtdIH07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIGlmICh0aGlzLmJvb2xjaGVjaykge1xyXG4gICAgICAgIC8vICAgICBpZiAodGhpcy5jaGVja1ZhbHVlLmxlbmd0aCkge1xyXG4gICAgICAgIC8vICAgICAgICAgdGhpcy5ib29sY2hlY2tlZCA9IHRoaXMuY2hlY2tWYWx1ZVswXTtcclxuICAgICAgICAvLyAgICAgICAgIGlmICh0aGlzLmJvb2xjaGVja2VkKSB0aGlzLmJvb2xDaGVja1N0YXRlID0gXCJjaGVja2VkXCI7XHJcbiAgICAgICAgLy8gICAgICAgICBlbHNlIHRoaXMuYm9vbENoZWNrU3RhdGUgPSBcInVuY2hlY2tlZFwiO1xyXG4gICAgICAgIC8vICAgICB9IGVsc2UgdGhpcy5ib29sQ2hlY2tTdGF0ZSA9IFwiaW5kZXRlcm1pbmF0ZVwiO1xyXG4gICAgICAgIC8vIH1cclxuICAgICAgICBpZiAodGhpcy5faXRlbS52YWx1ZS52YWx1ZS5sZW5ndGggPT0gMCl7XHJcbiAgICAgICAgICAgIHRoaXMuY2hlY2tlZEFsbCA9IGZhbHNlO1xyXG4gICAgICAgIH1lbHNlIGlmICh0aGlzLl9pdGVtLmNvbnRyb2xbXCJlbnVtVmFsdWVzXCJdICYmIHRoaXMuX2l0ZW0udmFsdWUudmFsdWUubGVuZ3RoID09IHRoaXMuX2l0ZW0uY29udHJvbFtcImVudW1WYWx1ZXNcIl0ubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIHRoaXMuY2hlY2tlZEFsbCA9IHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuc2V0U3VibWl0Q2hhbmdlKCk7XHJcbiAgICB9XHJcblxyXG4gICAgQE91dHB1dCgpIHZhbHVlQ2hhbmdlID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG5cclxuXHJcbiAgICBjaGVja1ZhbHVlOiBhbnlbXTtcclxuICAgIC8vIGluZGV0ZXJtaW5hdGU6IGJvb2xlYW4gPSB0cnVlO1xyXG4gICAgLy8gYm9vbGNoZWNrZWQ6IGJvb2xlYW47XHJcbiAgICAvLyBib29sQ2hlY2tTdGF0ZTogc3RyaW5nID0gXCJpbmRldGVybWluYXRlXCI7XHJcblxyXG4gICAgY2hlY2tib3hEYXRhU291cmNlOiBBcnJheTxhbnk+ID0gbmV3IEFycmF5PGFueT4oKTtcclxuXHJcbiAgICBAVmlld0NoaWxkKCdjaGVja0FsbEVsJykgY2hlY2tBbGxFbFJlZjogRWxlbWVudFJlZjtcclxuXHJcbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIGluamVjdG9yOiBJbmplY3RvciwgcHJpdmF0ZSBjZDogQ2hhbmdlRGV0ZWN0b3JSZWYpIHsgfVxyXG5cclxuICAgIG5nT25Jbml0KCk6IHZvaWQgeyB9XHJcblxyXG4gICAgZ2V0RGF0YVNvdXJjZSgpIHtcclxuICAgICAgICBpZiAodGhpcy5maWVsZCAmJiB0aGlzLl9pdGVtLmNvbnRyb2wpIHtcclxuICAgICAgICAgICAgbGV0IGNoZWNrYm94TGlzdCA9IHRoaXMuX2l0ZW0uY29udHJvbDtcclxuICAgICAgICAgICAgdGhpcy5jaGVja2JveERhdGFTb3VyY2UgPSBBcnJheTxhbnk+KCk7XHJcbiAgICAgICAgICAgIGlmIChjaGVja2JveExpc3QuZW51bVZhbHVlcyAmJiBjaGVja2JveExpc3QuZW51bVZhbHVlcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICBjaGVja2JveExpc3QuZW51bVZhbHVlcy5mb3JFYWNoKChlbGVtZW50KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jaGVja2JveERhdGFTb3VyY2UucHVzaChPYmplY3QuYXNzaWduKHt9LCBlbGVtZW50KSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBvblNlYXJjaChldmVudCkge1xyXG4gICAgICAgIGxldCBjaGVja2JveFZhbHVlID0gW107XHJcbiAgICAgICAgaWYgKGV2ZW50KSB7XHJcbiAgICAgICAgICAgIC8vIGxldCBjaGVja2JveExpc3QgPSBldmVudC5zcGxpdCgnLCcpO1xyXG4gICAgICAgICAgICBsZXQgY2hlY2tib3hMaXN0ID0gZXZlbnQ7XHJcbiAgICAgICAgICAgIGlmIChjaGVja2JveExpc3QgJiYgY2hlY2tib3hMaXN0Lmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgY2hlY2tib3hWYWx1ZSA9IGNoZWNrYm94TGlzdDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLl9pdGVtLnZhbHVlLnZhbHVlID0gY2hlY2tib3hWYWx1ZTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLl9pdGVtLnZhbHVlLnZhbHVlID0gXCJcIjtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKGNoZWNrYm94VmFsdWUubGVuZ3RoIDwgdGhpcy5faXRlbS5jb250cm9sW1wiZW51bVZhbHVlc1wiXS5sZW5ndGgpIHtcclxuICAgICAgICAgICAgdGhpcy5jaGVja2VkQWxsID0gZmFsc2U7XHJcbiAgICAgICAgICAgIC8vIHRoaXMuY2hlY2tBbGxFbFJlZi5uYXRpdmVFbGVtZW50LmluZGV0ZXJtaW5hdGUgPSAhIWNoZWNrYm94VmFsdWUubGVuZ3RoO1xyXG4gICAgICAgICAgICAvLyBpZiAoIWNoZWNrYm94VmFsdWUubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIC8vICAgICB0aGlzLmNoZWNrZWRBbGwgPSBmYWxzZTsgICAgXHJcbiAgICAgICAgICAgIC8vIH1cclxuICAgICAgICB9IGVsc2UgaWYgKCBjaGVja2JveFZhbHVlLmxlbmd0aCA9PSB0aGlzLl9pdGVtLmNvbnRyb2xbXCJlbnVtVmFsdWVzXCJdLmxlbmd0aCl7XHJcbiAgICAgICAgICAgIHRoaXMuY2hlY2tlZEFsbCA9IHRydWU7XHJcbiAgICAgICAgICAgIC8vIHRoaXMuY2hlY2tBbGxFbFJlZi5uYXRpdmVFbGVtZW50LmluZGV0ZXJtaW5hdGUgPSBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5jZC5kZXRlY3RDaGFuZ2VzKCk7XHJcbiAgICAgICAgdGhpcy5nZXRWYWx1ZVRleHQoKTtcclxuICAgICAgICB0aGlzLnNldFN1Ym1pdENoYW5nZSgpO1xyXG4gICAgICAgIHRoaXMudmFsdWVDaGFuZ2UuZW1pdCh7ICBmaWVsZDogdGhpcy5maWVsZC5jb2RlLHZhbHVlOiB7dmFsdWU6IGNoZWNrYm94VmFsdWUsIHNpbmdsZTogdHJ1ZX0gfSk7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0VmFsdWVUZXh0KCkge1xyXG4gICAgICAgIGNvbnN0IGVudW1WYWx1ZSA9IHRoaXMuX2l0ZW0uY29udHJvbC5lbnVtVmFsdWVzO1xyXG4gICAgICAgIGNvbnN0IHZhbHVlID0gdGhpcy5faXRlbS52YWx1ZS52YWx1ZTtcclxuICAgICAgICBpZiAoZW51bVZhbHVlICYmIGVudW1WYWx1ZS5sZW5ndGggJiYgdmFsdWUgJiYgdmFsdWUubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIGxldCB0ZXh0cyA9IFtdO1xyXG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8PSB2YWx1ZS5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgZW51bXMgPSBlbnVtVmFsdWUuZmluZCgodmFsKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZhbFtcInZhbHVlXCJdID09IHZhbHVlW2ldO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICBpZiAoZW51bXMpIHtcclxuICAgICAgICAgICAgICAgICAgICB0ZXh0cy5wdXNoKGVudW1zW1wibmFtZVwiXSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5faXRlbS52YWx1ZVRleHQgPSB0ZXh0cy5qb2luKFwiLFwiKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgc2V0U3VibWl0Q2hhbmdlKCkge1xyXG4gICAgICAgIGNvbnN0IHZhbCA9IHRoaXMuX2l0ZW0udmFsdWU7XHJcbiAgICAgICAgaWYgKFxyXG4gICAgICAgICAgICBPYmplY3Qua2V5cyh2YWwpLmxlbmd0aCA8IDAgfHxcclxuICAgICAgICAgICAgT2JqZWN0LmtleXModmFsLnZhbHVlKS5sZW5ndGggPT09IDBcclxuICAgICAgICApIHtcclxuICAgICAgICAgICAgLy8gdGhpcy5zdWJtaXRDaGFuZ2UuZW1pdChmYWxzZSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgLy8gdGhpcy5zdWJtaXRDaGFuZ2UuZW1pdCh0cnVlKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgb25DaGVja0FsbChldmVudCkge1xyXG4gICAgICAgIC8vIHRoaXMuY2hlY2tBbGxFbFJlZi5uYXRpdmVFbGVtZW50LmluZGV0ZXJtaW5hdGUgPSBmYWxzZTtcclxuICAgICAgICB0aGlzLmNoZWNrZWRBbGwgPSAhdGhpcy5jaGVja2VkQWxsO1xyXG4gICAgICAgIGlmICh0aGlzLmNoZWNrZWRBbGwpIHtcclxuICAgICAgICAgICAgdGhpcy5zZXRDaGVja2VkQWxsKCk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5faXRlbS52YWx1ZS52YWx1ZSA9IFtdO1xyXG4gICAgICAgICAgICB0aGlzLl9pdGVtLnZhbHVlVGV4dCA9IFwiXCI7XHJcbiAgICAgICAgICAgIHRoaXMuY2hlY2tWYWx1ZSA9IFtdO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5nZXRWYWx1ZVRleHQoKTtcclxuICAgICAgICB0aGlzLnNldFN1Ym1pdENoYW5nZSgpO1xyXG5cclxuICAgICAgICB0aGlzLmNkLmRldGVjdENoYW5nZXMoKTtcclxuXHJcbiAgICAgICAgdGhpcy52YWx1ZUNoYW5nZS5lbWl0KHsgZmllbGQ6IHRoaXMuZmllbGQuY29kZSwgdmFsdWU6IHt2YWx1ZTogdGhpcy5jaGVja1ZhbHVlLCBzaW5nbGU6IHRydWV9IH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgc2V0Q2hlY2tlZEFsbCgpIHtcclxuICAgICAgICBjb25zdCBlbnVtVmFsdWUgPSB0aGlzLl9pdGVtLmNvbnRyb2wuZW51bVZhbHVlcztcclxuICAgICAgICBpZiAoZW51bVZhbHVlICYmIGVudW1WYWx1ZS5sZW5ndGgpIHtcclxuICAgICAgICAgICAgbGV0IGNoZWNrYm94VmFsdWUgPSBbXTtcclxuICAgICAgICAgICAgLy9jaGVja2JveFRleHRzID0gW107XHJcbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZW51bVZhbHVlLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICBjaGVja2JveFZhbHVlLnB1c2goZW51bVZhbHVlW2ldW1widmFsdWVcIl0pO1xyXG4gICAgICAgICAgICAgICAgLy9jaGVja2JveFRleHRzLnB1c2goZW51bVZhbHVlW2ldWyduYW1lJ10pXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5faXRlbS52YWx1ZS52YWx1ZSA9IGNoZWNrYm94VmFsdWU7XHJcbiAgICAgICAgICAgIHRoaXMuY2hlY2tWYWx1ZSA9IHRoaXMuX2l0ZW0udmFsdWUudmFsdWU7XHJcbiAgICAgICAgICAgIC8vdGhpcy5faXRlbS52YWx1ZVRleHQgPSBjaGVja2JveFRleHRzLmpvaW4oJywnKTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuY2QuZGV0ZWN0Q2hhbmdlcygpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbn1cclxuIl19
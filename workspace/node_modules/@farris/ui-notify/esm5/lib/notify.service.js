/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Injectable, ComponentFactoryResolver, Injector, ApplicationRef } from '@angular/core';
import { Subject } from 'rxjs';
import { NotifyConfig } from './notifiy.options';
import { NotifyContainerComponent } from './notify-container.component';
import { LocaleService } from '@farris/ui-locale';
/**
 * Check and return true if an object is type of string
 * @param {?} obj Analyse has to object the string type
 * @return {?} result of analysis
 */
export function isString(obj) {
    return typeof obj === 'string';
}
/**
 * Check and return true if an object is type of number
 * @param {?} obj Analyse has to object the boolean type
 * @return {?} result of analysis
 */
export function isNumber(obj) {
    return typeof obj === 'number';
}
/**
 * Check and return true if an object is type of Function
 * @param {?} obj Analyse has to object the function type
 * @return {?} result of analysis
 */
export function isFunction(obj) {
    return typeof obj === 'function';
}
var NotifyService = /** @class */ (function () {
    function NotifyService(cfr, injector, appRef) {
        this.cfr = cfr;
        this.injector = injector;
        this.appRef = appRef;
        // Init the counter
        this.uniqueCounter = 0;
        this.eventSource = new Subject();
        this.events = this.eventSource.asObservable();
        this.config = new NotifyConfig();
        this.localeService = this.injector.get(LocaleService);
    }
    /**
     * @param {?} options
     * @return {?}
     */
    NotifyService.prototype.default = /**
     * @param {?} options
     * @return {?}
     */
    function (options) {
        this.show(options, 'default');
    };
    /**
     * @param {?} options
     * @return {?}
     */
    NotifyService.prototype.info = /**
     * @param {?} options
     * @return {?}
     */
    function (options) {
        this.show(options, 'info');
    };
    /**
     * @param {?} options
     * @return {?}
     */
    NotifyService.prototype.success = /**
     * @param {?} options
     * @return {?}
     */
    function (options) {
        this.show(options, 'success');
    };
    /**
     * @param {?} options
     * @return {?}
     */
    NotifyService.prototype.warning = /**
     * @param {?} options
     * @return {?}
     */
    function (options) {
        this.show(options, 'warning');
    };
    /**
     * @param {?} options
     * @return {?}
     */
    NotifyService.prototype.error = /**
     * @param {?} options
     * @return {?}
     */
    function (options) {
        this.show(options, 'danger');
    };
    /**
     * @return {?}
     */
    NotifyService.prototype.clearAll = /**
     * @return {?}
     */
    function () {
        // this.eventSource.next(new NotifyEvent(NotifyEventType.CLEAR_ALL));
        this.notifyContainer.instance.clearAll();
    };
    /**
     * @param {?} id
     * @return {?}
     */
    NotifyService.prototype.clear = /**
     * @param {?} id
     * @return {?}
     */
    function (id) {
        // this.eventSource.next(new NotifyEvent(NotifyEventType.CLEAR, id));
        this.notifyContainer.instance.clear(id);
    };
    /**
     * @private
     * @return {?}
     */
    NotifyService.prototype.createContainer = /**
     * @private
     * @return {?}
     */
    function () {
        if (!this.notifyContainer) {
            /** @type {?} */
            var containerFac = this.cfr.resolveComponentFactory(NotifyContainerComponent);
            /** @type {?} */
            var cmpRef = containerFac.create(this.injector);
            // cmpRef.instance.id = 'Farris-Notify-Container';
            this.appRef.attachView(cmpRef.hostView);
            document.querySelector('body').appendChild(cmpRef.location.nativeElement);
            this.notifyContainer = cmpRef;
        }
    };
    /**
     * @private
     * @param {?} options
     * @param {?} type
     * @return {?}
     */
    NotifyService.prototype.show = /**
     * @private
     * @param {?} options
     * @param {?} type
     * @return {?}
     */
    function (options, type) {
        var _this = this;
        this.createContainer();
        /** @type {?} */
        var notifyOptions;
        if (isString(options) && options !== '' || isNumber(options)) {
            notifyOptions = (/** @type {?} */ ({
                //20191129 去除默认标题
                //title: this.localeService.getValue('notify.title'),
                msg: options.toString()
            }));
        }
        else {
            notifyOptions = (/** @type {?} */ (options));
        }
        if (!notifyOptions || !notifyOptions.title && !notifyOptions.msg) {
            throw new Error('Farris-Notify: No notify title or message specified!');
        }
        type = type || 'default';
        this.uniqueCounter++;
        /** @type {?} */
        var showClose = this._checkConfigItem(this.config, notifyOptions, 'showClose');
        /** @type {?} */
        var theme;
        if (notifyOptions.theme) {
            theme = NotifyService.THEMES.indexOf(notifyOptions.theme) > -1 ? notifyOptions.theme : this.config.theme;
        }
        else {
            theme = this.config.theme;
        }
        //判断success类型 展示时间为1.5s
        if (type === 'success') {
            if (!notifyOptions.hasOwnProperty('timeout')) {
                notifyOptions.timeout = 1500;
            }
        }
        /** @type {?} */
        var newNotifyOpts = {
            id: this.uniqueCounter,
            title: notifyOptions.title,
            msg: notifyOptions.msg,
            showClose: showClose,
            type: 'toasty-type-' + type,
            theme: 'toasty-theme-' + theme,
            onAdd: notifyOptions.onAdd && isFunction(notifyOptions.onAdd) ? notifyOptions.onAdd : null,
            onRemove: notifyOptions.onRemove && isFunction(notifyOptions.onRemove) ? notifyOptions.onRemove : null
        };
        newNotifyOpts.timeout = notifyOptions.hasOwnProperty('timeout') ? notifyOptions.timeout : this.config.timeout;
        // this.eventSource.next(new NotifyEvent(NotifyEventType.ADD, newNotifyOpts));
        this.notifyContainer.instance.config = this.config;
        this.notifyContainer.instance.position = this.config.position;
        this.notifyContainer.instance.add(newNotifyOpts);
        ((/** @type {?} */ (this.notifyContainer.instance))).empty.subscribe((/**
         * @return {?}
         */
        function () {
            _this.clearDom();
        }));
        this.notifyContainer.changeDetectorRef.markForCheck();
        this.notifyContainer.changeDetectorRef.detectChanges();
        if (notifyOptions.onAdd && isFunction(notifyOptions.onAdd)) {
            notifyOptions.onAdd.call(this, newNotifyOpts);
        }
    };
    /**
     * @private
     * @param {?} config
     * @param {?} options
     * @param {?} property
     * @return {?}
     */
    NotifyService.prototype._checkConfigItem = /**
     * @private
     * @param {?} config
     * @param {?} options
     * @param {?} property
     * @return {?}
     */
    function (config, options, property) {
        if (options[property] === false) {
            return false;
        }
        else if (!options[property]) {
            return config[property];
        }
        else {
            return true;
        }
    };
    /**
     * @private
     * @return {?}
     */
    NotifyService.prototype.clearDom = /**
     * @private
     * @return {?}
     */
    function () {
        if (this.notifyContainer) {
            /** @type {?} */
            var el = this.notifyContainer.location.nativeElement;
            if (el.parentNode) {
                el.parentNode.removeChild(el);
            }
            this.notifyContainer.destroy();
            this.notifyContainer = undefined;
        }
    };
    NotifyService.THEMES = ['default', 'material', 'bootstrap'];
    NotifyService.decorators = [
        { type: Injectable }
    ];
    /** @nocollapse */
    NotifyService.ctorParameters = function () { return [
        { type: ComponentFactoryResolver },
        { type: Injector },
        { type: ApplicationRef }
    ]; };
    return NotifyService;
}());
export { NotifyService };
if (false) {
    /** @type {?} */
    NotifyService.THEMES;
    /** @type {?} */
    NotifyService.prototype.uniqueCounter;
    /**
     * @type {?}
     * @private
     */
    NotifyService.prototype.eventSource;
    /** @type {?} */
    NotifyService.prototype.events;
    /** @type {?} */
    NotifyService.prototype.notifyContainer;
    /** @type {?} */
    NotifyService.prototype.config;
    /** @type {?} */
    NotifyService.prototype.localeService;
    /**
     * @type {?}
     * @private
     */
    NotifyService.prototype.cfr;
    /**
     * @type {?}
     * @private
     */
    NotifyService.prototype.injector;
    /**
     * @type {?}
     * @private
     */
    NotifyService.prototype.appRef;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibm90aWZ5LnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL3VpLW5vdGlmeS8iLCJzb3VyY2VzIjpbImxpYi9ub3RpZnkuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFFLFVBQVUsRUFBZ0Isd0JBQXdCLEVBQUUsUUFBUSxFQUFFLGNBQWMsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUM3RyxPQUFPLEVBQUUsT0FBTyxFQUFjLE1BQU0sTUFBTSxDQUFDO0FBQzNDLE9BQU8sRUFBOEIsWUFBWSxFQUFjLE1BQU0sbUJBQW1CLENBQUM7QUFDekYsT0FBTyxFQUFFLHdCQUF3QixFQUFFLE1BQU0sOEJBQThCLENBQUM7QUFDeEUsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLG1CQUFtQixDQUFDOzs7Ozs7QUFPbEQsTUFBTSxVQUFVLFFBQVEsQ0FBQyxHQUFRO0lBQzdCLE9BQU8sT0FBTyxHQUFHLEtBQUssUUFBUSxDQUFDO0FBQ25DLENBQUM7Ozs7OztBQU9ELE1BQU0sVUFBVSxRQUFRLENBQUMsR0FBUTtJQUM3QixPQUFPLE9BQU8sR0FBRyxLQUFLLFFBQVEsQ0FBQztBQUNuQyxDQUFDOzs7Ozs7QUFPRCxNQUFNLFVBQVUsVUFBVSxDQUFDLEdBQVE7SUFDL0IsT0FBTyxPQUFPLEdBQUcsS0FBSyxVQUFVLENBQUM7QUFDckMsQ0FBQztBQUdEO0lBZUksdUJBQW9CLEdBQTZCLEVBQzdCLFFBQWtCLEVBQVUsTUFBc0I7UUFEbEQsUUFBRyxHQUFILEdBQUcsQ0FBMEI7UUFDN0IsYUFBUSxHQUFSLFFBQVEsQ0FBVTtRQUFVLFdBQU0sR0FBTixNQUFNLENBQWdCOztRQVZ0RSxrQkFBYSxHQUFHLENBQUMsQ0FBQztRQUVWLGdCQUFXLEdBQXlCLElBQUksT0FBTyxFQUFlLENBQUM7UUFDdkUsV0FBTSxHQUE0QixJQUFJLENBQUMsV0FBVyxDQUFDLFlBQVksRUFBRSxDQUFDO1FBSWxFLFdBQU0sR0FBRyxJQUFJLFlB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SSxJQUFJLElBQUksQ0FBQyxlQUFlLEVBQUU7O2dCQUNoQixFQUFFLEdBQUcsSUFBSSxDQUFDLGVBQWUsQ0FBQyxRQUFRLENBQUMsYUFBYTtZQUN0RCxJQUFJLEVBQUUsQ0FBQyxVQUFVLEVBQUU7Z0JBQ2YsRUFBRSxDQUFDLFVBQVUsQ0FBQyxXQUFXLENBQUMsRUFBRSxDQUFDLENBQUM7YUFDakM7WUFFRCxJQUFJLENBQUMsZUFBZSxDQUFDLE9BQU8sRUFBRSxDQUFDO1lBQy9CLElBQUksQ0FBQyxlQUFlLEdBQUcsU0FBUyxDQUFDO1NBQ3BDO0lBQ0wsQ0FBQztJQXBKTSxvQkFBTSxHQUFrQixDQUFDLFNBQVMsRUFBRSxVQUFVLEVBQUUsV0FBVyxDQUFDLENBQUM7O2dCQUh2RSxVQUFVOzs7O2dCQWxDd0Isd0JBQXdCO2dCQUFFLFFBQVE7Z0JBQUUsY0FBYzs7SUEwTHJGLG9CQUFDO0NBQUEsQUF4SkQsSUF3SkM7U0F2SlksYUFBYTs7O0lBRXRCLHFCQUFvRTs7SUFHcEUsc0NBQWtCOzs7OztJQUVsQixvQ0FBdUU7O0lBQ3ZFLCtCQUFrRTs7SUFHbEUsd0NBQW1DOztJQUNuQywrQkFBNEI7O0lBQzVCLHNDQUE2Qjs7Ozs7SUFDakIsNEJBQXFDOzs7OztJQUNyQyxpQ0FBMEI7Ozs7O0lBQUUsK0JBQThCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSwgQ29tcG9uZW50UmVmLCBDb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIsIEluamVjdG9yLCBBcHBsaWNhdGlvblJlZiB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBTdWJqZWN0LCBPYnNlcnZhYmxlIH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7IE5vdGlmeUV2ZW50LCBOb3RpZnlPcHRpb25zLCBOb3RpZnlDb25maWcsIE5vdGlmeURhdGEgfSBmcm9tICcuL25vdGlmaXkub3B0aW9ucyc7XHJcbmltcG9ydCB7IE5vdGlmeUNvbnRhaW5lckNvbXBvbmVudCB9IGZyb20gJy4vbm90aWZ5LWNvbnRhaW5lci5jb21wb25lbnQnO1xyXG5pbXBvcnQgeyBMb2NhbGVTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy91aS1sb2NhbGUnO1xyXG5cclxuLyoqXHJcbiAqIENoZWNrIGFuZCByZXR1cm4gdHJ1ZSBpZiBhbiBvYmplY3QgaXMgdHlwZSBvZiBzdHJpbmdcclxuICogQHBhcmFtIG9iaiBBbmFseXNlIGhhcyB0byBvYmplY3QgdGhlIHN0cmluZyB0eXBlXHJcbiAqIEByZXR1cm4gcmVzdWx0IG9mIGFuYWx5c2lzXHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gaXNTdHJpbmcob2JqOiBhbnkpOiBib29sZWFuIHtcclxuICAgIHJldHVybiB0eXBlb2Ygb2JqID09PSAnc3RyaW5nJztcclxufVxyXG5cclxuLyoqXHJcbiAqIENoZWNrIGFuZCByZXR1cm4gdHJ1ZSBpZiBhbiBvYmplY3QgaXMgdHlwZSBvZiBudW1iZXJcclxuICogQHBhcmFtIG9iaiBBbmFseXNlIGhhcyB0byBvYmplY3QgdGhlIGJvb2xlYW4gdHlwZVxyXG4gKiBAcmV0dXJuIHJlc3VsdCBvZiBhbmFseXNpc1xyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIGlzTnVtYmVyKG9iajogYW55KTogYm9vbGVhbiB7XHJcbiAgICByZXR1cm4gdHlwZW9mIG9iaiA9PT0gJ251bWJlcic7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBDaGVjayBhbmQgcmV0dXJuIHRydWUgaWYgYW4gb2JqZWN0IGlzIHR5cGUgb2YgRnVuY3Rpb25cclxuICogQHBhcmFtIG9iaiBBbmFseXNlIGhhcyB0byBvYmplY3QgdGhlIGZ1bmN0aW9uIHR5cGVcclxuICogQHJldHVybiByZXN1bHQgb2YgYW5hbHlzaXNcclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiBpc0Z1bmN0aW9uKG9iajogYW55KTogYm9vbGVhbiB7XHJcbiAgICByZXR1cm4gdHlwZW9mIG9iaiA9PT0gJ2Z1bmN0aW9uJztcclxufVxyXG5cclxuXHJcbkBJbmplY3RhYmxlKClcclxuZXhwb3J0IGNsYXNzIE5vdGlmeVNlcnZpY2Uge1xyXG5cclxuICAgIHN0YXRpYyBUSEVNRVM6IEFycmF5PHN0cmluZz4gPSBbJ2RlZmF1bHQnLCAnbWF0ZXJpYWwnLCAnYm9vdHN0cmFwJ107XHJcblxyXG4gICAgLy8gSW5pdCB0aGUgY291bnRlclxyXG4gICAgdW5pcXVlQ291bnRlciA9IDA7XHJcblxyXG4gICAgcHJpdmF0ZSBldmVudFNvdXJjZTogU3ViamVjdDxOb3RpZnlFdmVudD4gPSBuZXcgU3ViamVjdDxOb3RpZnlFdmVudD4oKTtcclxuICAgIGV2ZW50czogT2JzZXJ2YWJsZTxOb3RpZnlFdmVudD4gPSB0aGlzLmV2ZW50U291cmNlLmFzT2JzZXJ2YWJsZSgpO1xyXG5cclxuXHJcbiAgICBub3RpZnlDb250YWluZXI6IENvbXBvbmVudFJlZjxhbnk+O1xyXG4gICAgY29uZmlnID0gbmV3IE5vdGlmeUNvbmZpZygpO1xyXG4gICAgbG9jYWxlU2VydmljZTogTG9jYWxlU2VydmljZTtcclxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgY2ZyOiBDb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIsXHJcbiAgICAgICAgICAgICAgICBwcml2YXRlIGluamVjdG9yOiBJbmplY3RvciwgcHJpdmF0ZSBhcHBSZWY6IEFwcGxpY2F0aW9uUmVmKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2NhbGVTZXJ2aWNlID0gdGhpcy5pbmplY3Rvci5nZXQoTG9jYWxlU2VydmljZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgZGVmYXVsdChvcHRpb25zOiBOb3RpZnlPcHRpb25zfHN0cmluZ3xudW1iZXIpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLnNob3cob3B0aW9ucywgJ2RlZmF1bHQnKTtcclxuICAgIH1cclxuXHJcbiAgICBpbmZvKG9wdGlvbnM6IE5vdGlmeU9wdGlvbnN8c3RyaW5nfG51bWJlcik6IHZvaWQge1xyXG4gICAgICAgIHRoaXMuc2hvdyhvcHRpb25zLCAnaW5mbycpO1xyXG4gICAgfVxyXG5cclxuICAgIHN1Y2Nlc3Mob3B0aW9uczogTm90aWZ5T3B0aW9uc3xzdHJpbmd8bnVtYmVyKTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy5zaG93KG9wdGlvbnMsICdzdWNjZXNzJyk7XHJcbiAgICB9XHJcblxyXG4gICAgd2FybmluZyhvcHRpb25zOiBOb3RpZnlPcHRpb25zfHN0cmluZ3xudW1iZXIpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLnNob3cob3B0aW9ucywgJ3dhcm5pbmcnKTtcclxuICAgIH1cclxuXHJcbiAgICBlcnJvcihvcHRpb25zOiBOb3RpZnlPcHRpb25zfHN0cmluZ3xudW1iZXIpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLnNob3cob3B0aW9ucywgJ2RhbmdlcicpO1xyXG4gICAgfVxyXG5cclxuICAgIGNsZWFyQWxsKCkge1xyXG4gICAgICAgIC8vIHRoaXMuZXZlbnRTb3VyY2UubmV4dChuZXcgTm90aWZ5RXZlbnQoTm90aWZ5RXZlbnRUeXBlLkNMRUFSX0FMTCkpO1xyXG4gICAgICAgIHRoaXMubm90aWZ5Q29udGFpbmVyLmluc3RhbmNlLmNsZWFyQWxsKCk7XHJcbiAgICB9XHJcblxyXG4gICAgY2xlYXIoaWQ6IG51bWJlcikge1xyXG4gICAgICAgIC8vIHRoaXMuZXZlbnRTb3VyY2UubmV4dChuZXcgTm90aWZ5RXZlbnQoTm90aWZ5RXZlbnRUeXBlLkNMRUFSLCBpZCkpO1xyXG4gICAgICAgIHRoaXMubm90aWZ5Q29udGFpbmVyLmluc3RhbmNlLmNsZWFyKGlkKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGNyZWF0ZUNvbnRhaW5lcigpIHtcclxuICAgICAgICBpZiAoIXRoaXMubm90aWZ5Q29udGFpbmVyKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGNvbnRhaW5lckZhYyA9IHRoaXMuY2ZyLnJlc29sdmVDb21wb25lbnRGYWN0b3J5KE5vdGlmeUNvbnRhaW5lckNvbXBvbmVudCk7XHJcbiAgICAgICAgICAgIGNvbnN0IGNtcFJlZiA9IGNvbnRhaW5lckZhYy5jcmVhdGUodGhpcy5pbmplY3Rvcik7XHJcbiAgICAgICAgICAgIC8vIGNtcFJlZi5pbnN0YW5jZS5pZCA9ICdGYXJyaXMtTm90aWZ5LUNvbnRhaW5lcic7XHJcbiAgICAgICAgICAgIHRoaXMuYXBwUmVmLmF0dGFjaFZpZXcoY21wUmVmLmhvc3RWaWV3KTtcclxuICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignYm9keScpLmFwcGVuZENoaWxkKGNtcFJlZi5sb2NhdGlvbi5uYXRpdmVFbGVtZW50KTtcclxuICAgICAgICAgICAgdGhpcy5ub3RpZnlDb250YWluZXIgPSBjbXBSZWY7XHJcbiAgICAgICAgfVxyXG5cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHNob3cob3B0aW9uczogTm90aWZ5T3B0aW9ucyB8IHN0cmluZyB8IG51bWJlciwgdHlwZTogc3RyaW5nKSB7XHJcblxyXG4gICAgICAgIHRoaXMuY3JlYXRlQ29udGFpbmVyKCk7XHJcblxyXG4gICAgICAgIGxldCBub3RpZnlPcHRpb25zOiBOb3RpZnlPcHRpb25zO1xyXG4gICAgICAgIGlmIChpc1N0cmluZyhvcHRpb25zKSAmJiBvcHRpb25zICE9PSAnJyB8fCBpc051bWJlcihvcHRpb25zKSkge1xyXG4gICAgICAgICAgICBub3RpZnlPcHRpb25zID0ge1xyXG4gICAgICAgICAgICAgICAgLy8yMDE5MTEyOSDljrvpmaTpu5jorqTmoIfpophcclxuICAgICAgICAgICAgICAgIC8vdGl0bGU6IHRoaXMubG9jYWxlU2VydmljZS5nZXRWYWx1ZSgnbm90aWZ5LnRpdGxlJyksXHJcbiAgICAgICAgICAgICAgICBtc2c6IG9wdGlvbnMudG9TdHJpbmcoKVxyXG4gICAgICAgICAgICB9IGFzIE5vdGlmeU9wdGlvbnM7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgbm90aWZ5T3B0aW9ucyA9IG9wdGlvbnMgYXMgTm90aWZ5T3B0aW9ucztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICghbm90aWZ5T3B0aW9ucyB8fCAhbm90aWZ5T3B0aW9ucy50aXRsZSAmJiAhbm90aWZ5T3B0aW9ucy5tc2cpIHtcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdGYXJyaXMtTm90aWZ5OiBObyBub3RpZnkgdGl0bGUgb3IgbWVzc2FnZSBzcGVjaWZpZWQhJyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0eXBlID0gdHlwZSB8fCAnZGVmYXVsdCc7XHJcbiAgICAgICAgXHJcblxyXG4gICAgICAgIHRoaXMudW5pcXVlQ291bnRlcisrO1xyXG5cclxuICAgICAgICBjb25zdCBzaG93Q2xvc2UgPSB0aGlzLl9jaGVja0NvbmZpZ0l0ZW0odGhpcy5jb25maWcsIG5vdGlmeU9wdGlvbnMsICdzaG93Q2xvc2UnKTtcclxuXHJcbiAgICAgICAgbGV0IHRoZW1lOiBzdHJpbmc7XHJcbiAgICAgICAgaWYgKG5vdGlmeU9wdGlvbnMudGhlbWUpIHtcclxuICAgICAgICAgICAgdGhlbWUgPSBOb3RpZnlTZXJ2aWNlLlRIRU1FUy5pbmRleE9mKG5vdGlmeU9wdGlvbnMudGhlbWUpID4gLTEgPyBub3RpZnlPcHRpb25zLnRoZW1lIDogdGhpcy5jb25maWcudGhlbWU7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhlbWUgPSB0aGlzLmNvbmZpZy50aGVtZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy/liKTmlq1zdWNjZXNz57G75Z6LIOWxleekuuaXtumXtOS4ujEuNXNcclxuICAgICAgICBpZih0eXBlID09PSAnc3VjY2Vzcycpe1xyXG4gICAgICAgICAgICBpZighbm90aWZ5T3B0aW9ucy5oYXNPd25Qcm9wZXJ0eSgndGltZW91dCcpKXtcclxuICAgICAgICAgICAgICAgIG5vdGlmeU9wdGlvbnMudGltZW91dCA9IDE1MDA7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IG5ld05vdGlmeU9wdHM6IE5vdGlmeURhdGEgPSB7XHJcbiAgICAgICAgICAgIGlkOiB0aGlzLnVuaXF1ZUNvdW50ZXIsXHJcbiAgICAgICAgICAgIHRpdGxlOiBub3RpZnlPcHRpb25zLnRpdGxlLFxyXG4gICAgICAgICAgICBtc2c6IG5vdGlmeU9wdGlvbnMubXNnLFxyXG4gICAgICAgICAgICBzaG93Q2xvc2UsXHJcbiAgICAgICAgICAgIHR5cGU6ICd0b2FzdHktdHlwZS0nICsgdHlwZSxcclxuICAgICAgICAgICAgdGhlbWU6ICd0b2FzdHktdGhlbWUtJyArIHRoZW1lLFxyXG4gICAgICAgICAgICBvbkFkZCAgICA6IG5vdGlmeU9wdGlvbnMub25BZGQgJiYgaXNGdW5jdGlvbihub3RpZnlPcHRpb25zLm9uQWRkKSA/IG5vdGlmeU9wdGlvbnMub25BZGQgOiBudWxsLFxyXG4gICAgICAgICAgICBvblJlbW92ZSA6IG5vdGlmeU9wdGlvbnMub25SZW1vdmUgJiYgaXNGdW5jdGlvbihub3RpZnlPcHRpb25zLm9uUmVtb3ZlKSA/IG5vdGlmeU9wdGlvbnMub25SZW1vdmUgOiBudWxsXHJcbiAgICAgICAgfTtcclxuICAgICAgICBuZXdOb3RpZnlPcHRzLnRpbWVvdXQgPSBub3RpZnlPcHRpb25zLmhhc093blByb3BlcnR5KCd0aW1lb3V0JykgPyBub3RpZnlPcHRpb25zLnRpbWVvdXQgOiB0aGlzLmNvbmZpZy50aW1lb3V0O1xyXG5cclxuICAgICAgICAvLyB0aGlzLmV2ZW50U291cmNlLm5leHQobmV3IE5vdGlmeUV2ZW50KE5vdGlmeUV2ZW50VHlwZS5BREQsIG5ld05vdGlmeU9wdHMpKTtcclxuICAgICAgICB0aGlzLm5vdGlmeUNvbnRhaW5lci5pbnN0YW5jZS5jb25maWcgPSB0aGlzLmNvbmZpZztcclxuICAgICAgICB0aGlzLm5vdGlmeUNvbnRhaW5lci5pbnN0YW5jZS5wb3NpdGlvbiA9IHRoaXMuY29uZmlnLnBvc2l0aW9uO1xyXG4gICAgICAgIHRoaXMubm90aWZ5Q29udGFpbmVyLmluc3RhbmNlLmFkZChuZXdOb3RpZnlPcHRzKTtcclxuXHJcbiAgICAgICAgKHRoaXMubm90aWZ5Q29udGFpbmVyLmluc3RhbmNlIGFzIE5vdGlmeUNvbnRhaW5lckNvbXBvbmVudCkuZW1wdHkuc3Vic2NyaWJlKCgpID0+IHtcclxuICAgICAgICAgICAgdGhpcy5jbGVhckRvbSgpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICB0aGlzLm5vdGlmeUNvbnRhaW5lci5jaGFuZ2VEZXRlY3RvclJlZi5tYXJrRm9yQ2hlY2soKTtcclxuICAgICAgICB0aGlzLm5vdGlmeUNvbnRhaW5lci5jaGFuZ2VEZXRlY3RvclJlZi5kZXRlY3RDaGFuZ2VzKCk7XHJcblxyXG4gICAgICAgIGlmIChub3RpZnlPcHRpb25zLm9uQWRkICYmIGlzRnVuY3Rpb24obm90aWZ5T3B0aW9ucy5vbkFkZCkpIHtcclxuICAgICAgICAgICAgbm90aWZ5T3B0aW9ucy5vbkFkZC5jYWxsKHRoaXMsIG5ld05vdGlmeU9wdHMpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBfY2hlY2tDb25maWdJdGVtKGNvbmZpZzogYW55LCBvcHRpb25zOiBhbnksIHByb3BlcnR5OiBzdHJpbmcpIHtcclxuICAgICAgICBpZiAob3B0aW9uc1twcm9wZXJ0eV0gPT09IGZhbHNlKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9IGVsc2UgaWYgKCFvcHRpb25zW3Byb3BlcnR5XSkge1xyXG4gICAgICAgICAgICByZXR1cm4gY29uZmlnW3Byb3BlcnR5XTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBjbGVhckRvbSgpIHtcclxuICAgICAgICBpZiAodGhpcy5ub3RpZnlDb250YWluZXIpIHtcclxuICAgICAgICAgICAgY29uc3QgZWwgPSB0aGlzLm5vdGlmeUNvbnRhaW5lci5sb2NhdGlvbi5uYXRpdmVFbGVtZW50O1xyXG4gICAgICAgICAgICBpZiAoZWwucGFyZW50Tm9kZSkge1xyXG4gICAgICAgICAgICAgICAgZWwucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChlbCk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHRoaXMubm90aWZ5Q29udGFpbmVyLmRlc3Ryb3koKTtcclxuICAgICAgICAgICAgdGhpcy5ub3RpZnlDb250YWluZXIgPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcblxyXG4vLyBleHBvcnQgZnVuY3Rpb24gbm90aWZ5U2VydmljZUZhY3RvcnkoY29uZmlnOiBOb3RpZnlDb25maWcpOiBOb3RpZnlTZXJ2aWNlICB7XHJcbi8vICAgICByZXR1cm4gbmV3IE5vdGlmeVNlcnZpY2UoY29uZmlnLCApO1xyXG4vLyB9XHJcbiJdfQ==
/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input, ViewChildren, QueryList, Output, EventEmitter, NgZone } from '@angular/core';
import { isFunction } from 'lodash-es';
import { NotifyComponent } from './notify.component';
export class NotifyContainerComponent {
    /**
     * @param {?} ngZone
     */
    constructor(ngZone) {
        this.ngZone = ngZone;
        this._position = '';
        this.style = {
            'left': '',
            'right': '',
            'top': '',
            'bottom': ''
        };
        this.notifyDistance = {
            'left': 12,
            'right': 12,
            'top': 136,
            'bottom': 12
        };
        this.animateCls = 'fadeIn';
        this.id = '';
        this.empty = new EventEmitter();
        this.toasts = [];
    }
    /**
     * @param {?} value
     * @return {?}
     */
    set position(value) {
        if (value) {
            /** @type {?} */
            let notFound = true;
            for (let i = 0; i < NotifyContainerComponent.POSITIONS.length; i++) {
                if (NotifyContainerComponent.POSITIONS[i] === value) {
                    notFound = false;
                    break;
                }
            }
            if (notFound) {
                value = this.config.position;
            }
        }
        else {
            value = this.config.position;
        }
        // console.log(this.config);
        // if (value === 'center-center') {
        //     this.animateCls = 'bounceIn';
        // } else {
        /** @type {?} */
        const i = NotifyContainerComponent.POSITIONS.indexOf(value);
        //this.animateCls = NotifyContainerComponent.ANIMATES[i];
        this.animateCls = 'fadeIn';
        //}
        this._position = 'toasty-position-' + value;
        if (this.config.left) {
            this.notifyDistance.left = this.config.left;
        }
        if (this.config.right) {
            this.notifyDistance.right = this.config.right;
        }
        if (this.config.top) {
            this.notifyDistance.top = this.config.top;
        }
        if (this.config.bottom) {
            this.notifyDistance.bottom = this.config.bottom;
        }
        this.initstyle();
        if (value === 'top-left') {
            this.style.left = `${this.notifyDistance.left}px`;
            this.style.top = `${this.notifyDistance.top}px`;
        }
        else if (value === 'top-center') {
            this.style.top = `${this.notifyDistance.top}px`;
        }
        else if (value === 'top-right') {
            this.style.right = `${this.notifyDistance.right}px`;
            this.style.top = `${this.notifyDistance.top}px`;
        }
        else if (value === 'bottom-left') {
            this.style.left = `${this.notifyDistance.left}px`;
            this.style.bottom = `${this.notifyDistance.bottom}px`;
        }
        else if (value === 'bottom-center') {
            this.style.bottom = `${this.notifyDistance.bottom}px`;
        }
        else if (value === 'bottom-right') {
            this.style.right = `${this.notifyDistance.right}px`;
            this.style.bottom = `${this.notifyDistance.bottom}px`;
        }
    }
    /**
     * @return {?}
     */
    get position() {
        if (this._position) {
            return this._position;
        }
        else {
            return 'toasty-position-top-center';
        }
    }
    /**
     * @return {?}
     */
    initstyle() {
        this.style = {
            'left': '',
            'right': '',
            'top': '',
            'bottom': ''
        };
    }
    /**
     * @return {?}
     */
    ngOnInit() {
    }
    /**
     * @return {?}
     */
    ngAfterContentChecked() {
        if (this.notifyCmpList && this.notifyCmpList.length) {
            this.notifyCmpList.forEach((/**
             * @param {?} cmp
             * @return {?}
             */
            cmp => {
                cmp.close.subscribe((/**
                 * @return {?}
                 */
                () => {
                    this.clear(cmp.toast.id);
                }));
            }));
        }
    }
    /**
     * @param {?} toast
     * @return {?}
     */
    closeToast(toast) {
        this.clear(toast.id);
    }
    /**
     * @param {?} notify
     * @return {?}
     */
    add(notify) {
        if (this.toasts.length >= this.config.limit) {
            this.toasts.shift();
        }
        this.toasts.push(notify);
        if (notify.timeout) {
            this._setTimeout(notify);
        }
    }
    /**
     * @param {?} id
     * @return {?}
     */
    clear(id) {
        if (id) {
            this.toasts.forEach((/**
             * @param {?} value
             * @param {?} key
             * @return {?}
             */
            (value, key) => {
                if (value.id === id) {
                    if (value.onRemove && isFunction(value.onRemove)) {
                        value.onRemove.call(this, value);
                    }
                    this.toasts.splice(key, 1);
                }
            }));
            if (this.toasts.length === 0) {
                this.empty.emit();
            }
        }
        else {
            throw new Error('Please provide id of Toast to close');
        }
    }
    /**
     * @return {?}
     */
    clearAll() {
        this.toasts.forEach((/**
         * @param {?} value
         * @param {?} key
         * @return {?}
         */
        (value, key) => {
            if (value.onRemove && isFunction(value.onRemove)) {
                value.onRemove.call(this, value);
            }
        }));
        this.toasts = [];
        this.empty.emit();
    }
    /**
     * @private
     * @param {?} id
     * @return {?}
     */
    findNotifyComponent(id) {
        return this.notifyCmpList.find((/**
         * @param {?} item
         * @return {?}
         */
        item => item.toast.id === id));
    }
    /**
     * @private
     * @param {?} notify
     * @return {?}
     */
    _setTimeout(notify) {
        // this.ngZone.runOutsideAngular(() => {
        window.setTimeout((/**
         * @return {?}
         */
        () => {
            // this.clear(notify.id);
            /** @type {?} */
            const cmp = this.findNotifyComponent(notify.id);
            if (cmp) {
                cmp.state = true;
                cmp.inCls[cmp.animateCls] = false;
            }
        }), notify.timeout);
        // });
    }
}
NotifyContainerComponent.POSITIONS = ['bottom-right', 'bottom-left',
    'top-right', 'top-left', 'top-center', 'bottom-center', 'center-center'];
NotifyContainerComponent.ANIMATES = ['bounceInRight', 'bounceInLeft',
    'bounceInRight', 'bounceInLeft', 'bounceInDown', 'bounceInUp', 'bounceIn'];
NotifyContainerComponent.decorators = [
    { type: Component, args: [{
                selector: 'farris-notify-container',
                template: `
    <div [id]="id" class="farris-notify" [ngClass]="[position]" [ngStyle]="style">
        <farris-notify *ngFor="let toast of toasts" [toast]="toast" [animateCls]="animateCls" (close)="closeToast(toast)"></farris-notify>
    </div>
    `
            }] }
];
/** @nocollapse */
NotifyContainerComponent.ctorParameters = () => [
    { type: NgZone }
];
NotifyContainerComponent.propDecorators = {
    notifyCmpList: [{ type: ViewChildren, args: [NotifyComponent,] }],
    empty: [{ type: Output }],
    position: [{ type: Input }]
};
if (false) {
    /** @type {?} */
    NotifyContainerComponent.POSITIONS;
    /** @type {?} */
    NotifyContainerComponent.ANIMATES;
    /**
     * @type {?}
     * @private
     */
    NotifyContainerComponent.prototype._position;
    /** @type {?} */
    NotifyContainerComponent.prototype.style;
    /** @type {?} */
    NotifyContainerComponent.prototype.notifyDistance;
    /** @type {?} */
    NotifyContainerComponent.prototype.animateCls;
    /** @type {?} */
    NotifyContainerComponent.prototype.config;
    /** @type {?} */
    NotifyContainerComponent.prototype.id;
    /** @type {?} */
    NotifyContainerComponent.prototype.notifyCmpList;
    /** @type {?} */
    NotifyContainerComponent.prototype.empty;
    /** @type {?} */
    NotifyContainerComponent.prototype.toasts;
    /**
     * @type {?}
     * @private
     */
    NotifyContainerComponent.prototype.ngZone;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibm90aWZ5LWNvbnRhaW5lci5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL3VpLW5vdGlmeS8iLCJzb3VyY2VzIjpbImxpYi9ub3RpZnktY29udGFpbmVyLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFFLFNBQVMsRUFBRSxLQUFLLEVBQUUsWUFBWSxFQUFFLFNBQVMsRUFBK0IsTUFBTSxFQUFFLFlBQVksRUFBRSxNQUFNLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFFckksT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLFdBQVcsQ0FBQztBQUN2QyxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sb0JBQW9CLENBQUM7QUFVckQsTUFBTSxPQUFPLHdCQUF3Qjs7OztJQXlIakMsWUFBb0IsTUFBYztRQUFkLFdBQU0sR0FBTixNQUFNLENBQVE7UUFqSDFCLGNBQVMsR0FBRyxFQUFFLENBQUM7UUFDdkIsVUFBSyxHQUFHO1lBQ0osTUFBTSxFQUFDLEVBQUU7WUFDVCxPQUFPLEVBQUMsRUFBRTtZQUNWLEtBQUssRUFBQyxFQUFFO1lBQ1IsUUFBUSxFQUFDLEVBQUU7U0FDZCxDQUFDO1FBQ0YsbUJBQWMsR0FBRztZQUNiLE1BQU0sRUFBQyxFQUFFO1lBQ1QsT0FBTyxFQUFDLEVBQUU7WUFDVixLQUFLLEVBQUMsR0FBRztZQUNULFFBQVEsRUFBQyxFQUFFO1NBQ2QsQ0FBQztRQUVGLGVBQVUsR0FBRyxRQUFRLENBQUM7UUFJdEIsT0FBRSxHQUFHLEVBQUUsQ0FBQztRQUtFLFVBQUssR0FBRyxJQUFJLFlBQVksRUFBRSxDQUFDO1FBd0ZyQyxXQUFNLEdBQXNCLEVBQUUsQ0FBQztJQUVPLENBQUM7Ozs7O0lBeEZ2QyxJQUFhLFFBQVEsQ0FBQyxLQUFhO1FBQy9CLElBQUksS0FBSyxFQUFFOztnQkFDSCxRQUFRLEdBQUcsSUFBSTtZQUNuQixLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdB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QU07Ozs0QkF5Q3hHLFlBQVksU0FBQyxlQUFlO29CQUc1QixNQUFNO3VCQUVOLEtBQUs7Ozs7SUEvQk4sbUNBQzZFOztJQUU3RSxrQ0FDK0U7Ozs7O0lBRS9FLDZDQUF1Qjs7SUFDdkIseUNBS0U7O0lBQ0Ysa0RBS0U7O0lBRUYsOENBQXNCOztJQUV0QiwwQ0FBcUI7O0lBRXJCLHNDQUFROztJQUVSLGlEQUF5RTs7SUFHekUseUNBQXFDOztJQXdGckMsMENBQStCOzs7OztJQUVuQiwwQ0FBc0IiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIElucHV0LCBWaWV3Q2hpbGRyZW4sIFF1ZXJ5TGlzdCwgQWZ0ZXJDb250ZW50Q2hlY2tlZCwgT25Jbml0LCBPdXRwdXQsIEV2ZW50RW1pdHRlciwgTmdab25lIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IE5vdGlmeUNvbmZpZywgTm90aWZ5RGF0YSB9IGZyb20gJy4vbm90aWZpeS5vcHRpb25zJztcclxuaW1wb3J0IHsgaXNGdW5jdGlvbiB9IGZyb20gJ2xvZGFzaC1lcyc7XHJcbmltcG9ydCB7IE5vdGlmeUNvbXBvbmVudCB9IGZyb20gJy4vbm90aWZ5LmNvbXBvbmVudCc7XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICAgIHNlbGVjdG9yOiAnZmFycmlzLW5vdGlmeS1jb250YWluZXInLFxyXG4gICAgdGVtcGxhdGU6IGBcclxuICAgIDxkaXYgW2lkXT1cImlkXCIgY2xhc3M9XCJmYXJyaXMtbm90aWZ5XCIgW25nQ2xhc3NdPVwiW3Bvc2l0aW9uXVwiIFtuZ1N0eWxlXT1cInN0eWxlXCI+XHJcbiAgICAgICAgPGZhcnJpcy1ub3RpZnkgKm5nRm9yPVwibGV0IHRvYXN0IG9mIHRvYXN0c1wiIFt0b2FzdF09XCJ0b2FzdFwiIFthbmltYXRlQ2xzXT1cImFuaW1hdGVDbHNcIiAoY2xvc2UpPVwiY2xvc2VUb2FzdCh0b2FzdClcIj48L2ZhcnJpcy1ub3RpZnk+XHJcbiAgICA8L2Rpdj5cclxuICAgIGBcclxufSlcclxuZXhwb3J0IGNsYXNzIE5vdGlmeUNvbnRhaW5lckNvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgQWZ0ZXJDb250ZW50Q2hlY2tlZCB7XHJcblxyXG4gICAgc3RhdGljIFBPU0lUSU9OUzogQXJyYXk8U3RyaW5nPiA9IFsnYm90dG9tLXJpZ2h0JywgJ2JvdHRvbS1sZWZ0JyxcclxuICAgICAgICAndG9wLXJpZ2h0JywgJ3RvcC1sZWZ0JywgJ3RvcC1jZW50ZXInLCAnYm90dG9tLWNlbnRlcicsICdjZW50ZXItY2VudGVyJ107XHJcblxyXG4gICAgc3RhdGljIEFOSU1BVEVTOiBBcnJheTxzdHJpbmc+ID0gWydib3VuY2VJblJpZ2h0JywgJ2JvdW5jZUluTGVmdCcsXHJcbiAgICAgICAgJ2JvdW5jZUluUmlnaHQnLCAnYm91bmNlSW5MZWZ0JywgJ2JvdW5jZUluRG93bicsICdib3VuY2VJblVwJywgJ2JvdW5jZUluJ107XHJcblxyXG4gICAgcHJpdmF0ZSBfcG9zaXRpb24gPSAnJztcclxuICAgIHN0eWxlID0ge1xyXG4gICAgICAgICdsZWZ0JzonJyxcclxuICAgICAgICAncmlnaHQnOicnLFxyXG4gICAgICAgICd0b3AnOicnLFxyXG4gICAgICAgICdib3R0b20nOicnXHJcbiAgICB9O1xyXG4gICAgbm90aWZ5RGlzdGFuY2UgPSB7XHJcbiAgICAgICAgJ2xlZnQnOjEyLFxyXG4gICAgICAgICdyaWdodCc6MTIsXHJcbiAgICAgICAgJ3RvcCc6MTM2LFxyXG4gICAgICAgICdib3R0b20nOjEyXHJcbiAgICB9O1xyXG5cclxuICAgIGFuaW1hdGVDbHMgPSAnZmFkZUluJztcclxuXHJcbiAgICBjb25maWc6IE5vdGlmeUNvbmZpZztcclxuXHJcbiAgICBpZCA9ICcnO1xyXG5cclxuICAgIEBWaWV3Q2hpbGRyZW4oTm90aWZ5Q29tcG9uZW50KSBub3RpZnlDbXBMaXN0OiBRdWVyeUxpc3Q8Tm90aWZ5Q29tcG9uZW50PjtcclxuXHJcblxyXG4gICAgQE91dHB1dCgpIGVtcHR5ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG5cclxuICAgIEBJbnB1dCgpIHNldCBwb3NpdGlvbih2YWx1ZTogc3RyaW5nKSB7XHJcbiAgICAgICAgaWYgKHZhbHVlKSB7XHJcbiAgICAgICAgICAgIGxldCBub3RGb3VuZCA9IHRydWU7XHJcbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgTm90aWZ5Q29udGFpbmVyQ29tcG9uZW50LlBPU0lUSU9OUy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgaWYgKE5vdGlmeUNvbnRhaW5lckNvbXBvbmVudC5QT1NJVElPTlNbaV0gPT09IHZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbm90Rm91bmQgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKG5vdEZvdW5kKSB7XHJcbiAgICAgICAgICAgICAgICB2YWx1ZSA9IHRoaXMuY29uZmlnLnBvc2l0aW9uO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdmFsdWUgPSB0aGlzLmNvbmZpZy5wb3NpdGlvbjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIGNvbnNvbGUubG9nKHRoaXMuY29uZmlnKTtcclxuXHJcblxyXG4gICAgICAgIC8vIGlmICh2YWx1ZSA9PT0gJ2NlbnRlci1jZW50ZXInKSB7XHJcbiAgICAgICAgLy8gICAgIHRoaXMuYW5pbWF0ZUNscyA9ICdib3VuY2VJbic7XHJcbiAgICAgICAgLy8gfSBlbHNlIHtcclxuICAgICAgICAgICAgY29uc3QgaSA9IE5vdGlmeUNvbnRhaW5lckNvbXBvbmVudC5QT1NJVElPTlMuaW5kZXhPZih2YWx1ZSk7XHJcbiAgICAgICAgICAgIC8vdGhpcy5hbmltYXRlQ2xzID0gTm90aWZ5Q29udGFpbmVyQ29tcG9uZW50LkFOSU1BVEVTW2ldO1xyXG4gICAgICAgICAgICB0aGlzLmFuaW1hdGVDbHMgPSAnZmFkZUluJztcclxuICAgICAgICAvL31cclxuXHJcbiAgICAgICAgdGhpcy5fcG9zaXRpb24gPSAndG9hc3R5LXBvc2l0aW9uLScgKyB2YWx1ZTtcclxuXHJcbiAgICAgICAgaWYodGhpcy5jb25maWcubGVmdCl7XHJcbiAgICAgICAgICAgIHRoaXMubm90aWZ5RGlzdGFuY2UubGVmdCA9IHRoaXMuY29uZmlnLmxlZnQ7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmKHRoaXMuY29uZmlnLnJpZ2h0KXtcclxuICAgICAgICAgICAgdGhpcy5ub3RpZnlEaXN0YW5jZS5yaWdodCA9IHRoaXMuY29uZmlnLnJpZ2h0O1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZih0aGlzLmNvbmZpZy50b3Ape1xyXG4gICAgICAgICAgICB0aGlzLm5vdGlmeURpc3RhbmNlLnRvcCA9IHRoaXMuY29uZmlnLnRvcDtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYodGhpcy5jb25maWcuYm90dG9tKXtcclxuICAgICAgICAgICAgdGhpcy5ub3RpZnlEaXN0YW5jZS5ib3R0b20gPSB0aGlzLmNvbmZpZy5ib3R0b207XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuaW5pdHN0eWxlKCk7XHJcbiAgICAgICAgaWYoIHZhbHVlID09PSAndG9wLWxlZnQnICl7XHJcbiAgICAgICAgICAgIHRoaXMuc3R5bGUubGVmdCA9IGAke3RoaXMubm90aWZ5RGlzdGFuY2UubGVmdH1weGA7XHJcbiAgICAgICAgICAgIHRoaXMuc3R5bGUudG9wID0gYCR7dGhpcy5ub3RpZnlEaXN0YW5jZS50b3B9cHhgO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmKCB2YWx1ZSA9PT0gJ3RvcC1jZW50ZXInICl7XHJcbiAgICAgICAgICAgIHRoaXMuc3R5bGUudG9wID0gYCR7dGhpcy5ub3RpZnlEaXN0YW5jZS50b3B9cHhgO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmKCB2YWx1ZSA9PT0gJ3RvcC1yaWdodCcgKXtcclxuICAgICAgICAgICAgdGhpcy5zdHlsZS5yaWdodCA9IGAke3RoaXMubm90aWZ5RGlzdGFuY2UucmlnaHR9cHhgO1xyXG4gICAgICAgICAgICB0aGlzLnN0eWxlLnRvcCA9IGAke3RoaXMubm90aWZ5RGlzdGFuY2UudG9wfXB4YDtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiggdmFsdWUgPT09ICdib3R0b20tbGVmdCcgKXtcclxuICAgICAgICAgICAgdGhpcy5zdHlsZS5sZWZ0ID0gYCR7dGhpcy5ub3RpZnlEaXN0YW5jZS5sZWZ0fXB4YDtcclxuICAgICAgICAgICAgdGhpcy5zdHlsZS5ib3R0b20gPSBgJHt0aGlzLm5vdGlmeURpc3RhbmNlLmJvdHRvbX1weGA7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYoIHZhbHVlID09PSAnYm90dG9tLWNlbnRlcicgKXtcclxuICAgICAgICAgICAgdGhpcy5zdHlsZS5ib3R0b20gPSBgJHt0aGlzLm5vdGlmeURpc3RhbmNlLmJvdHRvbX1weGA7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYoIHZhbHVlID09PSAnYm90dG9tLXJpZ2h0JyApe1xyXG4gICAgICAgICAgICB0aGlzLnN0eWxlLnJpZ2h0ID0gYCR7dGhpcy5ub3RpZnlEaXN0YW5jZS5yaWdodH1weGA7XHJcbiAgICAgICAgICAgIHRoaXMuc3R5bGUuYm90dG9tID0gYCR7dGhpcy5ub3RpZnlEaXN0YW5jZS5ib3R0b219cHhgO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IHBvc2l0aW9uKCkge1xyXG4gICAgICAgIGlmICh0aGlzLl9wb3NpdGlvbikge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fcG9zaXRpb247XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcmV0dXJuICd0b2FzdHktcG9zaXRpb24tdG9wLWNlbnRlcic7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGluaXRzdHlsZSgpIHtcclxuICAgICAgICB0aGlzLnN0eWxlID0ge1xyXG4gICAgICAgICAgICAnbGVmdCc6JycsXHJcbiAgICAgICAgICAgICdyaWdodCc6JycsXHJcbiAgICAgICAgICAgICd0b3AnOicnLFxyXG4gICAgICAgICAgICAnYm90dG9tJzonJ1xyXG4gICAgICAgIH07XHJcbiAgICB9XHJcblxyXG5cclxuICAgIHRvYXN0czogQXJyYXk8Tm90aWZ5RGF0YT4gPSBbXTtcclxuXHJcbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIG5nWm9uZTogTmdab25lKSB7IH1cclxuXHJcbiAgICBuZ09uSW5pdCgpIHsgXHJcbiAgICAgICAgXHJcbiAgICB9XHJcblxyXG4gICAgbmdBZnRlckNvbnRlbnRDaGVja2VkKCkge1xyXG4gICAgICAgIGlmICh0aGlzLm5vdGlmeUNtcExpc3QgJiYgdGhpcy5ub3RpZnlDbXBMaXN0Lmxlbmd0aCkge1xyXG4gICAgICAgICAgICB0aGlzLm5vdGlmeUNtcExpc3QuZm9yRWFjaChjbXAgPT4ge1xyXG4gICAgICAgICAgICAgICAgY21wLmNsb3NlLnN1YnNjcmliZSgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jbGVhcihjbXAudG9hc3QuaWQpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBjbG9zZVRvYXN0KHRvYXN0OiBOb3RpZnlEYXRhKSB7XHJcbiAgICAgICAgdGhpcy5jbGVhcih0b2FzdC5pZCk7XHJcbiAgICB9XHJcblxyXG4gICAgYWRkKG5vdGlmeTogTm90aWZ5RGF0YSkge1xyXG4gICAgICAgIGlmICh0aGlzLnRvYXN0cy5sZW5ndGggPj0gdGhpcy5jb25maWcubGltaXQpIHtcclxuICAgICAgICAgICAgdGhpcy50b2FzdHMuc2hpZnQoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMudG9hc3RzLnB1c2gobm90aWZ5KTtcclxuXHJcbiAgICAgICAgaWYgKG5vdGlmeS50aW1lb3V0KSB7XHJcbiAgICAgICAgICAgIHRoaXMuX3NldFRpbWVvdXQobm90aWZ5KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgY2xlYXIoaWQ6IG51bWJlcikge1xyXG4gICAgICAgIGlmIChpZCkge1xyXG4gICAgICAgICAgICB0aGlzLnRvYXN0cy5mb3JFYWNoKCh2YWx1ZTogYW55LCBrZXk6IG51bWJlcikgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlLmlkID09PSBpZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZS5vblJlbW92ZSAmJiBpc0Z1bmN0aW9uKHZhbHVlLm9uUmVtb3ZlKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZS5vblJlbW92ZS5jYWxsKHRoaXMsIHZhbHVlKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMudG9hc3RzLnNwbGljZShrZXksIDEpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIGlmICh0aGlzLnRvYXN0cy5sZW5ndGggPT09IDApIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZW1wdHkuZW1pdCgpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignUGxlYXNlIHByb3ZpZGUgaWQgb2YgVG9hc3QgdG8gY2xvc2UnKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgY2xlYXJBbGwoKSB7XHJcbiAgICAgICAgdGhpcy50b2FzdHMuZm9yRWFjaCgodmFsdWU6IGFueSwga2V5OiBudW1iZXIpID0+IHtcclxuICAgICAgICAgICAgaWYgKHZhbHVlLm9uUmVtb3ZlICYmIGlzRnVuY3Rpb24odmFsdWUub25SZW1vdmUpKSB7XHJcbiAgICAgICAgICAgICAgICB2YWx1ZS5vblJlbW92ZS5jYWxsKHRoaXMsIHZhbHVlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHRoaXMudG9hc3RzID0gW107XHJcbiAgICAgICAgdGhpcy5lbXB0eS5lbWl0KCk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBmaW5kTm90aWZ5Q29tcG9uZW50KGlkOiBudW1iZXIpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5ub3RpZnlDbXBMaXN0LmZpbmQoaXRlbSA9PiBpdGVtLnRvYXN0LmlkID09PSBpZCk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBfc2V0VGltZW91dChub3RpZnk6IE5vdGlmeURhdGEpIHtcclxuICAgICAgICAvLyB0aGlzLm5nWm9uZS5ydW5PdXRzaWRlQW5ndWxhcigoKSA9PiB7XHJcbiAgICAgICAgICAgIHdpbmRvdy5zZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgICAgICAgIC8vIHRoaXMuY2xlYXIobm90aWZ5LmlkKTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGNtcCA9IHRoaXMuZmluZE5vdGlmeUNvbXBvbmVudChub3RpZnkuaWQpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGNtcCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNtcC5zdGF0ZSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgY21wLmluQ2xzW2NtcC5hbmltYXRlQ2xzXSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LCBub3RpZnkudGltZW91dCk7XHJcbiAgICAgICAgLy8gfSk7XHJcbiAgICB9XHJcbn1cclxuIl19
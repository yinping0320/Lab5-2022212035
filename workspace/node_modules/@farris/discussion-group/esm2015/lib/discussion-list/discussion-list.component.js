/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input, Output, EventEmitter, ViewChild, ViewEncapsulation } from '@angular/core';
import { PaginationControlsComponent } from '@farris/ui-pagination';
import { DiscussionListService } from './discussion-list.service';
export class DiscussionListComponent {
    /**
     * @param {?} discussionListService
     */
    constructor(discussionListService) {
        this.discussionListService = discussionListService;
        // @Input() personnelsPrimaryKey: string = 'userId';
        this.personnelsDisplayKey = 'userName';
        this.pagerOnServer = true;
        /* *是否支持分页 */
        this.supportPaging = true;
        /**  总页数 */
        // @Input() pageSize:number;
        /**
         * 当前页码
         */
        this.pageIndex = 1;
        /**  每页显示条数选项 */
        // private _pageList = [10,20,30,50];
        // get pageList() {
        //     return this._pageList;
        // }
        // @Input() set pageList(val) {
        //     this._pageList = val;
        //     if (this.pager) {
        //         this.pager.setPageList(val);
        //     }
        // }
        /**
         * 总条数
         */
        this._total = 0;
        /**
         * 每页显示个数
         */
        this._pageSize = 10;
        /**  总条数 */
        // @Input() total = 0;
        /**
         * 评论数据
         */
        this.innerDiscussionData = [];
        this._discussionData = [];
        this.replyMessage = new EventEmitter();
        // 分页事件
        this.pageChanged = new EventEmitter();
        this.pageSizeChanged = new EventEmitter();
        /**
         * 附件预览
         */
        this.filePreview = new EventEmitter();
        /**
         * 附件下载
         */
        this.fileDownload = new EventEmitter();
        this.labels = {
            previousLabel: ' ',
            nextLabel: ' '
        };
        this.directionLinks = true;
        this.maxSize = 7;
        this.responsive = true;
        this.autoHide = false;
    }
    /**
     * @return {?}
     */
    get total() {
        return this._total;
    }
    /**
     * @param {?} val
     * @return {?}
     */
    set total(val) {
        this._total = val;
        // this.paginationOptions.totalItems = val;
        this.initPaginationOptions();
        // if(val){
        //   this.initPaginationOptions();
        // }
    }
    /**
     * @return {?}
     */
    get pageSize() {
        return this._pageSize;
    }
    /**
     * @param {?} val
     * @return {?}
     */
    set pageSize(val) {
        this._pageSize = val;
        // this.paginationOptions.itemsPerPage = val;
        this.initPaginationOptions();
    }
    /**
     * @param {?} val
     * @return {?}
     */
    set discussionData(val) {
        if (val) {
            this._discussionData = val;
            this.innerDiscussionData = val;
        }
    }
    /**
     * @return {?}
     */
    get discussionData() {
        return this._discussionData;
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        // this.paginationOptions = {
        //   id: 'Farris-discussion-Pagination',
        //   itemsPerPage: this.pageSize,
        //   currentPage: this.pageIndex,
        //   // pageList: this.pageList,
        //   totalItems: this.total
        // };
        this.initPaginationOptions();
        /** 监听指令得到的数据 */
        this.discussionListService.getData().subscribe((/**
         * @param {?} data
         * @return {?}
         */
        (data) => {
            if (data && !this._discussionData.length) {
                this.innerDiscussionData = data;
            }
        }));
    }
    /**
     * @return {?}
     */
    initPaginationOptions() {
        this.paginationOptions = {
            id: 'Farris-discussion-Pagination',
            itemsPerPage: this._pageSize,
            currentPage: this.pageIndex,
            pageList: [10, 20, 30, 50, 100],
            totalItems: this._total,
            remote: this.pagerOnServer
        };
    }
    /**
     * 点击回复留言
     * @param {?} item
     * @return {?}
     */
    reply(item) {
        this.replyMessage.emit(item);
    }
    /**
     * 页码变化
     * @param {?} page
     * @return {?}
     */
    onPageChange(page) {
        if (this.pageIndex !== page.pageIndex) {
            this.pageIndex = page.pageIndex;
            this.paginationOptions.currentPage = page.pageIndex;
            this.pageChanged.emit({ pageInfo: page });
        }
    }
    /**
     * 每页显示条数变化
     * @param {?} pageSize
     * @return {?}
     */
    onPageSizeChange(pageSize) {
        if (this.pageSize !== pageSize && this.total) {
            this.paginationOptions.itemsPerPage = pageSize;
            this.pageSize = pageSize;
            /** @type {?} */
            const total = this.total;
            /** @type {?} */
            let pageLength = Math.floor(total / pageSize);
            if (total % pageSize > 0) {
                pageLength += 1;
            }
            if (pageLength && this.pageIndex > pageLength) {
                this.pageIndex = pageLength;
                this.paginationOptions.currentPage = this.pageIndex;
            }
            this.pageSizeChanged.emit({ pageInfo: { pageIndex: this.pageIndex, pageSize: pageSize } });
        }
    }
    /**
     * 附件预览
     * @param {?} info
     * @return {?}
     */
    filePreviewEventHandler(info) {
        this.filePreview.emit(info);
    }
    /**
     * 附件下载
     * @param {?} info
     * @return {?}
     */
    fileDownloadEventHandler(info) {
        this.fileDownload.emit(info);
    }
    /**
     * 占位头像文字
     * @param {?} item
     * @return {?}
     */
    getAvatar(item) {
        if (item && item[this.personnelsDisplayKey]) {
            /** @type {?} */
            let str = item[this.personnelsDisplayKey];
            return str.substring(str.length - 2, str.length);
        }
        else {
            return '';
        }
    }
}
DiscussionListComponent.decorators = [
    { type: Component, args: [{
                selector: 'farris-discussion-list',
                template: "<div class=\"f-discussion-group-content\">\r\n    <div class=\"f-discussion-group-content-item\" *ngFor=\"let item of (supportPaging ? (innerDiscussionData | paginate: paginationOptions) : innerDiscussionData)\">\r\n        <div class=\"discussion-item-avatar\">\r\n            <img [src]=\"item.imgData\" alt=\"\" class=\"discussion-item-avatar-img\" *ngIf=\"item.imgData\">\r\n            <div class=\"discussion-item-avatar-tip\" *ngIf=\"!item.imgData\" [innerHTML]=\"getAvatar(item)\"></div>\r\n        </div>\r\n        <div class=\"discussion-item-inner\">\r\n            <div class=\"discussion-item-username\">\r\n                {{item[personnelsDisplayKey]}}\r\n            </div>\r\n            <div class=\"discussion-item-text\">\r\n                <span class=\"discussion-item-text-message\" [innerHTML]=\"item.text | safeHtml\"></span>\r\n                <!-- <span class=\"discussion-item-text-about\" *ngIf=\"item.messageAbout\">@{{item.messageAbout}}</span> -->\r\n            </div>\r\n            <div class=\"discussion-item-text-reply\" *ngIf=\"item.parentData\">\r\n                <span class=\"discussion-item-text-reply-title\">\r\n                    {{ 'discussionGroup.reply' | locale }}\r\n                    <span class=\"discussion-item-text-reply-name\">{{item.parentData[personnelsDisplayKey]}}</span>\uFF1A\r\n                </span>\r\n                <span class=\"discussion-item-text-reply-content\" [innerHTML]=\"item.parentData.text | safeHtml\">\r\n                </span>\r\n            </div>\r\n            <!-- \u9644\u4EF6\u5217\u8868 <div class=\"discussion-item-files\" *ngIf=\"item.attachFiles && item.attachFiles.length\">\r\n                <f-file-preview class=\"d-flex flex-wrap\" [itemCls]=\"'demo-view-item'\" [fileInfos]=\"item.attachFiles\"\r\n                    (filePreviewEvent)=\"filePreviewEventHandler($event)\" (fileDownloadEvent)=\"fileDownloadEventHandler($event)\"\r\n                    #filePreview>\r\n                    <ng-template filePreviewListTypeTemplate let-data let-readonly=\"readonly\">\r\n                        <div class=\"ffilepreview--item-detail\">\r\n                            <div class=\"ffilepreview--item-icon\">\r\n                                <span class=\"ffilepreview--filetype-icon\" [ngClass]=\"filePreview.getFileTypeClassName(data.name)\"></span>\r\n                            </div>\r\n                            <div class=\"ffilepreview--item-content\">\r\n                                <a class=\"item-content--title\" [title]=\"data.name\"\r\n                                    (click)=\"filePreview.filePreviewHandler($event,data)\">{{data.name}}</a>\r\n                                <div class=\"item-content--toolbar f-text-light\">\r\n                                    <button class=\"btn btn-link\" (click)=\"filePreview.filePreviewHandler($event,data)\">\r\n                                    <span class=\"f-icon f-icon-preview\"></span>\u9884\u89C8\r\n                                    </button>\r\n                                    <button class=\"btn btn-link\" (click)=\"filePreview.fileDownloadHandler($event,data)\">\r\n                                    <span class=\"f-icon f-icon-download\"></span>\u4E0B\u8F7D\r\n                                    </button>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </ng-template>\r\n                </f-file-preview>\r\n            </div> -->\r\n            <div class=\"discussion-item-footer\">\r\n                <div class=\"discussion-item-time\">\r\n                    <span class=\"discussion-item-time-text\">{{item.commentDate | dateformat:'yyyy-MM-dd HH:mm'}}</span>\r\n                </div>\r\n                <div class=\"discussion-item-btns\">\r\n                    <span class=\"discussion-item-btns-start\" (click)=\"reply(item)\">\r\n                        <span class=\"f-icon f-icon-message\"></span>\r\n                        <span class=\"discussion-item-btns-start-text\">\r\n                            {{ 'discussionGroup.reply' | locale }}\r\n                        </span>\r\n                    </span>\r\n                    <!-- <span class=\"discussion-item-btns-new\">\r\n                        <span class=\"f-icon f-icon-star-outline\"></span>\r\n                    </span> -->\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <div class=\"f-discussion-group-footer\" *ngIf=\"supportPaging\">\r\n        <pagination-controls #pager \r\n            [id]=\"paginationOptions.id\" \r\n            [maxSize]=\"maxSize\" \r\n            [directionLinks]=\"directionLinks\"\r\n            [autoHide]=\"autoHide\" \r\n            [responsive]=\"responsive\" \r\n            [previousLabel]=\"labels.previousLabel\"\r\n            [nextLabel]=\"labels.nextLabel\"\r\n            (pageChange)=\"onPageChange($event)\"\r\n            (pageSizeChange)=\"onPageSizeChange($event)\"\r\n            [showPageList]=\"false\"\r\n        >\r\n        </pagination-controls>\r\n    </div>\r\n</div>",
                encapsulation: ViewEncapsulation.None,
                styles: [".f-discussion-group-content-item{display:-webkit-box;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;flex-direction:row;margin-bottom:14px}.f-discussion-group-content-item .discussion-item-avatar{width:32px;height:32px;margin-right:10px;overflow:hidden;cursor:pointer;flex-shrink:0}.f-discussion-group-content-item .discussion-item-avatar-img{display:block;width:32px;height:32px;border-radius:50%}.f-discussion-group-content-item .discussion-item-avatar-tip{width:32px;height:32px;font-size:12px;color:#fff;text-align:center;line-height:32px;border-radius:50%;background-color:#4796ff}.f-discussion-group-content-item .discussion-item-inner{flex-shrink:1;-webkit-box-flex:1;flex-grow:1;flex-basis:0;padding-bottom:14px;border-bottom:1px solid #e3e3e3;overflow:hidden}.f-discussion-group-content-item .discussion-item-inner .discussion-item-username{margin-bottom:4px;font-size:16px;color:rgba(0,0,0,.85)}.f-discussion-group-content-item .discussion-item-inner .discussion-item-text{font-size:14px;color:rgba(0,0,0,.75)}.f-discussion-group-content-item .discussion-item-inner .discussion-item-text .discussion-item-text-message{word-break:break-all}.f-discussion-group-content-item .discussion-item-inner .discussion-item-text-reply{margin-top:11px;padding:6px 8px;font-size:0;background:#f5f5f5;border-radius:2px}.f-discussion-group-content-item .discussion-item-inner .discussion-item-text-reply-content,.f-discussion-group-content-item .discussion-item-inner .discussion-item-text-reply-title{font-size:14px;color:rgba(0,0,0,.75);line-height:20px}.f-discussion-group-content-item .discussion-item-inner .discussion-item-text-reply-title .discussion-item-text-reply-name{color:#3487e3}.f-discussion-group-content-item .discussion-item-inner .discussion-item-text-reply-content{word-break:break-all}.f-discussion-group-content-item .discussion-item-inner .discussion-item-files{margin-top:11px}.f-discussion-group-content-item .discussion-item-inner .discussion-item-files .ffilepreview--filetype-icon{width:40px;height:40px}.f-discussion-group-content-item .discussion-item-inner .discussion-item-footer{margin-top:10px;padding-right:20px;display:-webkit-box;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;flex-direction:row;-webkit-box-align:center;align-items:center;-webkit-box-pack:justify;justify-content:space-between}.f-discussion-group-content-item .discussion-item-inner .discussion-item-footer .discussion-item-time{font-size:14px;color:#b1b6c2}.f-discussion-group-content-item .discussion-item-inner .discussion-item-footer .discussion-item-btns{display:-webkit-box;display:flex;-webkit-box-align:center;align-items:center}.f-discussion-group-content-item .discussion-item-inner .discussion-item-footer .discussion-item-btns .discussion-item-btns-start{display:-webkit-box;display:flex;-webkit-box-align:center;align-items:center;position:relative;cursor:pointer}.f-discussion-group-content-item .discussion-item-inner .discussion-item-footer .discussion-item-btns .discussion-item-btns-start .f-icon{color:rgba(0,0,0,.45);font-size:16px}.f-discussion-group-content-item .discussion-item-inner .discussion-item-footer .discussion-item-btns .discussion-item-btns-start .f-icon::before{vertical-align:bottom}.f-discussion-group-content-item .discussion-item-inner .discussion-item-footer .discussion-item-btns .discussion-item-btns-start .discussion-item-btns-start-text{margin-left:14px;font-size:14px;color:rgba(0,0,0,.45)}.f-discussion-group-content-item .discussion-item-inner .discussion-item-footer .discussion-item-btns .discussion-item-btns-start:hover .discussion-item-btns-start-text,.f-discussion-group-content-item .discussion-item-inner .discussion-item-footer .discussion-item-btns .discussion-item-btns-start:hover .f-icon{color:#3487e3}.f-discussion-group-content-item:last-child .discussion-item-inner{border-bottom:none}"]
            }] }
];
/** @nocollapse */
DiscussionListComponent.ctorParameters = () => [
    { type: DiscussionListService }
];
DiscussionListComponent.propDecorators = {
    personnelsDisplayKey: [{ type: Input }],
    pagerOnServer: [{ type: Input }],
    supportPaging: [{ type: Input }],
    pageIndex: [{ type: Input }],
    total: [{ type: Input }],
    pageSize: [{ type: Input }],
    discussionData: [{ type: Input }],
    replyMessage: [{ type: Output }],
    pageChanged: [{ type: Output }],
    pageSizeChanged: [{ type: Output }],
    filePreview: [{ type: Output }],
    fileDownload: [{ type: Output }],
    pager: [{ type: ViewChild, args: ['pager',] }]
};
if (false) {
    /** @type {?} */
    DiscussionListComponent.prototype.personnelsDisplayKey;
    /** @type {?} */
    DiscussionListComponent.prototype.pagerOnServer;
    /** @type {?} */
    DiscussionListComponent.prototype.supportPaging;
    /**
     * 当前页码
     * @type {?}
     */
    DiscussionListComponent.prototype.pageIndex;
    /**
     * 总条数
     * @type {?}
     * @private
     */
    DiscussionListComponent.prototype._total;
    /**
     * 每页显示个数
     * @type {?}
     * @private
     */
    DiscussionListComponent.prototype._pageSize;
    /**
     * 评论数据
     * @type {?}
     */
    DiscussionListComponent.prototype.innerDiscussionData;
    /** @type {?} */
    DiscussionListComponent.prototype._discussionData;
    /** @type {?} */
    DiscussionListComponent.prototype.replyMessage;
    /** @type {?} */
    DiscussionListComponent.prototype.pageChanged;
    /** @type {?} */
    DiscussionListComponent.prototype.pageSizeChanged;
    /**
     * 附件预览
     * @type {?}
     */
    DiscussionListComponent.prototype.filePreview;
    /**
     * 附件下载
     * @type {?}
     */
    DiscussionListComponent.prototype.fileDownload;
    /** @type {?} */
    DiscussionListComponent.prototype.labels;
    /** @type {?} */
    DiscussionListComponent.prototype.directionLinks;
    /** @type {?} */
    DiscussionListComponent.prototype.maxSize;
    /** @type {?} */
    DiscussionListComponent.prototype.responsive;
    /** @type {?} */
    DiscussionListComponent.prototype.autoHide;
    /** @type {?} */
    DiscussionListComponent.prototype.paginationOptions;
    /** @type {?} */
    DiscussionListComponent.prototype.pager;
    /**
     * @type {?}
     * @private
     */
    DiscussionListComponent.prototype.discussionListService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGlzY3Vzc2lvbi1saXN0LmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvZGlzY3Vzc2lvbi1ncm91cC8iLCJzb3VyY2VzIjpbImxpYi9kaXNjdXNzaW9uLWxpc3QvZGlzY3Vzc2lvbi1saXN0LmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFFLFNBQVMsRUFBVSxLQUFLLEVBQUUsTUFBTSxFQUFFLFlBQVksRUFBRSxTQUFTLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDN0csT0FBTyxFQUFFLDJCQUEyQixFQUFzQixNQUFNLHVCQUF1QixDQUFDO0FBQ3hGLE9BQU8sRUFBRSxxQkFBcUIsRUFBRSxNQUFNLDJCQUEyQixDQUFDO0FBUWxFLE1BQU0sT0FBTyx1QkFBdUI7Ozs7SUErRWhDLFlBQW9CLHFCQUE0QztRQUE1QywwQkFBcUIsR0FBckIscUJBQXFCLENBQXVCOztRQTdFdkQseUJBQW9CLEdBQUcsVUFBVSxDQUFDO1FBQ2xDLGtCQUFhLEdBQUcsSUFBSSxDQUFDOztRQUVyQixrQkFBYSxHQUFHLElBQUksQ0FBQzs7Ozs7O1FBSXJCLGNBQVMsR0FBRyxDQUFDLENBQUM7Ozs7Ozs7Ozs7Ozs7OztRQWFmLFdBQU0sR0FBRyxDQUFDLENBQUM7Ozs7UUFhWCxjQUFTLEdBQUcsRUFBRSxDQUFDOzs7Ozs7UUFZdkIsd0JBQW1CLEdBQUcsRUFBRSxDQUFDO1FBQ3pCLG9CQUFlLEdBQUcsRUFBRSxDQUFDO1FBV1gsaUJBQVksR0FBRyxJQUFJLFlBQVksRUFBRSxDQUFDOztRQUVsQyxnQkFBVyxHQUFHLElBQUksWUFBWSxFQUFFLENBQUM7UUFDakMsb0JBQWUsR0FBRyxJQUFJLFlBQVksRUFBRSxDQUFDOzs7O1FBR3JDLGdCQUFXLEdBQUcsSUFBSSxZQUFZLEVBQUUsQ0FBQzs7OztRQUVqQyxpQkFBWSxHQUFHLElBQUksWUFBWSxFQUFFLENBQUM7UUFDckMsV0FBTSxHQUFRO1lB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RyxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRSxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUM7U0FDcEQ7YUFBTTtZQUNILE9BQU8sRUFBRSxDQUFDO1NBQ2I7SUFDTCxDQUFDOzs7WUFoS0osU0FBUyxTQUFDO2dCQUNQLFFBQVEsRUFBRSx3QkFBd0I7Z0JBQ2xDLCtoS0FBK0M7Z0JBRS9DLGFBQWEsRUFBRSxpQkFBaUIsQ0FBQyxJQUFJOzthQUN4Qzs7OztZQVBRLHFCQUFxQjs7O21DQVV6QixLQUFLOzRCQUNMLEtBQUs7NEJBRUwsS0FBSzt3QkFJTCxLQUFLO29CQWlCTCxLQUFLO3VCQWFMLEtBQUs7NkJBVUwsS0FBSzsyQkFVTCxNQUFNOzBCQUVOLE1BQU07OEJBQ04sTUFBTTswQkFHTixNQUFNOzJCQUVOLE1BQU07b0JBVU4sU0FBUyxTQUFDLE9BQU87Ozs7SUEzRWxCLHVEQUEyQzs7SUFDM0MsZ0RBQThCOztJQUU5QixnREFBOEI7Ozs7O0lBSTlCLDRDQUF1Qjs7Ozs7O0lBYXZCLHlDQUFtQjs7Ozs7O0lBYW5CLDRDQUF1Qjs7Ozs7SUFZdkIsc0RBQXlCOztJQUN6QixrREFBcUI7O0lBV3JCLCtDQUE0Qzs7SUFFNUMsOENBQTJDOztJQUMzQyxrREFBK0M7Ozs7O0lBRy9DLDhDQUEyQzs7Ozs7SUFFM0MsK0NBQTRDOztJQUM1Qyx5Q0FHRTs7SUFDRixpREFBNkI7O0lBQzdCLDBDQUFtQjs7SUFDbkIsNkNBQXlCOztJQUN6QiwyQ0FBd0I7O0lBQ3hCLG9EQUFzQzs7SUFDdEMsd0NBQXVEOzs7OztJQUUzQyx3REFBb0QiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIE9uSW5pdCwgSW5wdXQsIE91dHB1dCwgRXZlbnRFbWl0dGVyLCBWaWV3Q2hpbGQsIFZpZXdFbmNhcHN1bGF0aW9uIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IFBhZ2luYXRpb25Db250cm9sc0NvbXBvbmVudCwgUGFnaW5hdGlvbkluc3RhbmNlIH0gZnJvbSAnQGZhcnJpcy91aS1wYWdpbmF0aW9uJztcclxuaW1wb3J0IHsgRGlzY3Vzc2lvbkxpc3RTZXJ2aWNlIH0gZnJvbSAnLi9kaXNjdXNzaW9uLWxpc3Quc2VydmljZSc7XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICAgIHNlbGVjdG9yOiAnZmFycmlzLWRpc2N1c3Npb24tbGlzdCcsXHJcbiAgICB0ZW1wbGF0ZVVybDogJy4vZGlzY3Vzc2lvbi1saXN0LmNvbXBvbmVudC5odG1sJyxcclxuICAgIHN0eWxlVXJsczogWycuL2Rpc2N1c3Npb24tbGlzdC5jb21wb25lbnQuc2NzcyddLFxyXG4gICAgZW5jYXBzdWxhdGlvbjogVmlld0VuY2Fwc3VsYXRpb24uTm9uZVxyXG59KVxyXG5leHBvcnQgY2xhc3MgRGlzY3Vzc2lvbkxpc3RDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xyXG4gICAgLy8gQElucHV0KCkgcGVyc29ubmVsc1ByaW1hcnlLZXk6IHN0cmluZyA9ICd1c2VySWQnO1xyXG4gICAgQElucHV0KCkgcGVyc29ubmVsc0Rpc3BsYXlLZXkgPSAndXNlck5hbWUnO1xyXG4gICAgQElucHV0KCkgcGFnZXJPblNlcnZlciA9IHRydWU7XHJcbiAgICAvKiAq5piv5ZCm5pSv5oyB5YiG6aG1ICovXHJcbiAgICBASW5wdXQoKSBzdXBwb3J0UGFnaW5nID0gdHJ1ZTtcclxuICAgIC8qKiAg5oC76aG15pWwICovXHJcbiAgICAvLyBASW5wdXQoKSBwYWdlU2l6ZTpudW1iZXI7XHJcbiAgICAvKiogIOW9k+WJjemhteeggSAqL1xyXG4gICAgQElucHV0KCkgcGFnZUluZGV4ID0gMTtcclxuICAgIC8qKiAg5q+P6aG15pi+56S65p2h5pWw6YCJ6aG5ICovXHJcbiAgICAvLyBwcml2YXRlIF9wYWdlTGlzdCA9IFsxMCwyMCwzMCw1MF07XHJcbiAgICAvLyBnZXQgcGFnZUxpc3QoKSB7XHJcbiAgICAvLyAgICAgcmV0dXJuIHRoaXMuX3BhZ2VMaXN0O1xyXG4gICAgLy8gfVxyXG4gICAgLy8gQElucHV0KCkgc2V0IHBhZ2VMaXN0KHZhbCkge1xyXG4gICAgLy8gICAgIHRoaXMuX3BhZ2VMaXN0ID0gdmFsO1xyXG4gICAgLy8gICAgIGlmICh0aGlzLnBhZ2VyKSB7XHJcbiAgICAvLyAgICAgICAgIHRoaXMucGFnZXIuc2V0UGFnZUxpc3QodmFsKTtcclxuICAgIC8vICAgICB9XHJcbiAgICAvLyB9XHJcbiAgICAvKiogIOaAu+adoeaVsCAqL1xyXG4gICAgcHJpdmF0ZSBfdG90YWwgPSAwO1xyXG4gICAgZ2V0IHRvdGFsKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl90b3RhbDtcclxuICAgIH1cclxuICAgIEBJbnB1dCgpIHNldCB0b3RhbCh2YWwpIHtcclxuICAgICAgICB0aGlzLl90b3RhbCA9IHZhbDtcclxuICAgICAgICAvLyB0aGlzLnBhZ2luYXRpb25PcHRpb25zLnRvdGFsSXRlbXMgPSB2YWw7XHJcbiAgICAgICAgdGhpcy5pbml0UGFnaW5hdGlvbk9wdGlvbnMoKTtcclxuICAgICAgICAvLyBpZih2YWwpe1xyXG4gICAgICAgIC8vICAgdGhpcy5pbml0UGFnaW5hdGlvbk9wdGlvbnMoKTtcclxuICAgICAgICAvLyB9XHJcbiAgICB9XHJcbiAgICAvKiogIOavj+mhteaYvuekuuS4quaVsCAqL1xyXG4gICAgcHJpdmF0ZSBfcGFnZVNpemUgPSAxMDtcclxuICAgIGdldCBwYWdlU2l6ZSgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fcGFnZVNpemU7XHJcbiAgICB9XHJcbiAgICBASW5wdXQoKSBzZXQgcGFnZVNpemUodmFsKSB7XHJcbiAgICAgICAgdGhpcy5fcGFnZVNpemUgPSB2YWw7XHJcbiAgICAgICAgLy8gdGhpcy5wYWdpbmF0aW9uT3B0aW9ucy5pdGVtc1BlclBhZ2UgPSB2YWw7XHJcbiAgICAgICAgdGhpcy5pbml0UGFnaW5hdGlvbk9wdGlvbnMoKTtcclxuICAgIH1cclxuICAgIC8qKiAg5oC75p2h5pWwICovXHJcbiAgICAvLyBASW5wdXQoKSB0b3RhbCA9IDA7XHJcbiAgICAvKiogIOivhOiuuuaVsOaNriAqL1xyXG4gICAgaW5uZXJEaXNjdXNzaW9uRGF0YSA9IFtdO1xyXG4gICAgX2Rpc2N1c3Npb25EYXRhID0gW107XHJcbiAgICBASW5wdXQoKVxyXG4gICAgc2V0IGRpc2N1c3Npb25EYXRhKHZhbCkge1xyXG4gICAgICAgIGlmICh2YWwpIHtcclxuICAgICAgICAgICAgdGhpcy5fZGlzY3Vzc2lvbkRhdGEgPSB2YWw7XHJcbiAgICAgICAgICAgIHRoaXMuaW5uZXJEaXNjdXNzaW9uRGF0YSA9IHZhbDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBnZXQgZGlzY3Vzc2lvbkRhdGEoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2Rpc2N1c3Npb25EYXRhO1xyXG4gICAgfVxyXG4gICAgQE91dHB1dCgpIHJlcGx5TWVzc2FnZSA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuICAgIC8vIOWIhumhteS6i+S7tlxyXG4gICAgQE91dHB1dCgpIHBhZ2VDaGFuZ2VkID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG4gICAgQE91dHB1dCgpIHBhZ2VTaXplQ2hhbmdlZCA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuXHJcbiAgICAvKiog6ZmE5Lu26aKE6KeIICovXHJcbiAgICBAT3V0cHV0KCkgZmlsZVByZXZpZXcgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcbiAgICAvKiog6ZmE5Lu25LiL6L29ICovXHJcbiAgICBAT3V0cHV0KCkgZmlsZURvd25sb2FkID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG4gICAgcHVibGljIGxhYmVsczogYW55ID0ge1xyXG4gICAgICAgIHByZXZpb3VzTGFiZWw6ICcgJyxcclxuICAgICAgICBuZXh0TGFiZWw6ICcgJ1xyXG4gICAgfTtcclxuICAgIHB1YmxpYyBkaXJlY3Rpb25MaW5rcyA9IHRydWU7XHJcbiAgICBwdWJsaWMgbWF4U2l6ZSA9IDc7XHJcbiAgICBwdWJsaWMgcmVzcG9uc2l2ZSA9IHRydWU7XHJcbiAgICBwdWJsaWMgYXV0b0hpZGUgPSBmYWxzZTtcclxuICAgIHBhZ2luYXRpb25PcHRpb25zOiBQYWdpbmF0aW9uSW5zdGFuY2U7XHJcbiAgICBAVmlld0NoaWxkKCdwYWdlcicpIHBhZ2VyOiBQYWdpbmF0aW9uQ29udHJvbHNDb21wb25lbnQ7XHJcblxyXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBkaXNjdXNzaW9uTGlzdFNlcnZpY2U6IERpc2N1c3Npb25MaXN0U2VydmljZSkgeyB9XHJcbiAgICBuZ09uSW5pdCgpIHtcclxuICAgICAgICAvLyB0aGlzLnBhZ2luYXRpb25PcHRpb25zID0ge1xyXG4gICAgICAgIC8vICAgaWQ6ICdGYXJyaXMtZGlzY3Vzc2lvbi1QYWdpbmF0aW9uJyxcclxuICAgICAgICAvLyAgIGl0ZW1zUGVyUGFnZTogdGhpcy5wYWdlU2l6ZSxcclxuICAgICAgICAvLyAgIGN1cnJlbnRQYWdlOiB0aGlzLnBhZ2VJbmRleCxcclxuICAgICAgICAvLyAgIC8vIHBhZ2VMaXN0OiB0aGlzLnBhZ2VMaXN0LFxyXG4gICAgICAgIC8vICAgdG90YWxJdGVtczogdGhpcy50b3RhbFxyXG4gICAgICAgIC8vIH07XHJcbiAgICAgICAgdGhpcy5pbml0UGFnaW5hdGlvbk9wdGlvbnMoKTtcclxuICAgICAgICAvKiog55uR5ZCs5oyH5Luk5b6X5Yiw55qE5pWw5o2uICovXHJcbiAgICAgICAgdGhpcy5kaXNjdXNzaW9uTGlzdFNlcnZpY2UuZ2V0RGF0YSgpLnN1YnNjcmliZSgoZGF0YTogYW55KTogdm9pZCA9PiB7XHJcbiAgICAgICAgICAgIGlmIChkYXRhICYmICF0aGlzLl9kaXNjdXNzaW9uRGF0YS5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuaW5uZXJEaXNjdXNzaW9uRGF0YSA9IGRhdGE7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH1cclxuICAgIGluaXRQYWdpbmF0aW9uT3B0aW9ucygpIHtcclxuICAgICAgICB0aGlzLnBhZ2luYXRpb25PcHRpb25zID0ge1xyXG4gICAgICAgICAgICBpZDogJ0ZhcnJpcy1kaXNjdXNzaW9uLVBhZ2luYXRpb24nLFxyXG4gICAgICAgICAgICBpdGVtc1BlclBhZ2U6IHRoaXMuX3BhZ2VTaXplLFxyXG4gICAgICAgICAgICBjdXJyZW50UGFnZTogdGhpcy5wYWdlSW5kZXgsXHJcbiAgICAgICAgICAgIHBhZ2VMaXN0OiBbMTAsIDIwLCAzMCwgNTAsIDEwMF0sXHJcbiAgICAgICAgICAgIHRvdGFsSXRlbXM6IHRoaXMuX3RvdGFsLFxyXG4gICAgICAgICAgICByZW1vdGU6IHRoaXMucGFnZXJPblNlcnZlclxyXG4gICAgICAgIH07XHJcbiAgICB9XHJcbiAgICAvKiog54K55Ye75Zue5aSN55WZ6KiAICovXHJcbiAgICByZXBseShpdGVtKSB7XHJcbiAgICAgICAgdGhpcy5yZXBseU1lc3NhZ2UuZW1pdChpdGVtKTtcclxuICAgIH1cclxuICAgIC8qKiDpobXnoIHlj5jljJYgKi9cclxuICAgIG9uUGFnZUNoYW5nZShwYWdlOiB7IHBhZ2VJbmRleDogbnVtYmVyLCBwYWdlU2l6ZTogbnVtYmVyIH0pIHtcclxuICAgICAgICBpZiAodGhpcy5wYWdlSW5kZXggIT09IHBhZ2UucGFnZUluZGV4KSB7XHJcbiAgICAgICAgICAgIHRoaXMucGFnZUluZGV4ID0gcGFnZS5wYWdlSW5kZXg7XHJcbiAgICAgICAgICAgIHRoaXMucGFnaW5hdGlvbk9wdGlvbnMuY3VycmVudFBhZ2UgPSBwYWdlLnBhZ2VJbmRleDtcclxuICAgICAgICAgICAgdGhpcy5wYWdlQ2hhbmdlZC5lbWl0KHsgcGFnZUluZm86IHBhZ2UgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgLyoqIOavj+mhteaYvuekuuadoeaVsOWPmOWMliAqL1xyXG4gICAgb25QYWdlU2l6ZUNoYW5nZShwYWdlU2l6ZTogbnVtYmVyKSB7XHJcbiAgICAgICAgaWYgKHRoaXMucGFnZVNpemUgIT09IHBhZ2VTaXplICYmIHRoaXMudG90YWwpIHtcclxuICAgICAgICAgICAgdGhpcy5wYWdpbmF0aW9uT3B0aW9ucy5pdGVtc1BlclBhZ2UgPSBwYWdlU2l6ZTtcclxuICAgICAgICAgICAgdGhpcy5wYWdlU2l6ZSA9IHBhZ2VTaXplO1xyXG5cclxuICAgICAgICAgICAgY29uc3QgdG90YWwgPSB0aGlzLnRvdGFsO1xyXG4gICAgICAgICAgICBsZXQgcGFnZUxlbmd0aCA9IE1hdGguZmxvb3IodG90YWwgLyBwYWdlU2l6ZSk7XHJcbiAgICAgICAgICAgIGlmICh0b3RhbCAlIHBhZ2VTaXplID4gMCkge1xyXG4gICAgICAgICAgICAgICAgcGFnZUxlbmd0aCArPSAxO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAocGFnZUxlbmd0aCAmJiB0aGlzLnBhZ2VJbmRleCA+IHBhZ2VMZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMucGFnZUluZGV4ID0gcGFnZUxlbmd0aDtcclxuICAgICAgICAgICAgICAgIHRoaXMucGFnaW5hdGlvbk9wdGlvbnMuY3VycmVudFBhZ2UgPSB0aGlzLnBhZ2VJbmRleDtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdGhpcy5wYWdlU2l6ZUNoYW5nZWQuZW1pdCh7IHBhZ2VJbmZvOiB7IHBhZ2VJbmRleDogdGhpcy5wYWdlSW5kZXgsIHBhZ2VTaXplOiBwYWdlU2l6ZSB9IH0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIC8qKiDpmYTku7bpooTop4ggKi9cclxuICAgIGZpbGVQcmV2aWV3RXZlbnRIYW5kbGVyKGluZm8pIHtcclxuICAgICAgICB0aGlzLmZpbGVQcmV2aWV3LmVtaXQoaW5mbyk7XHJcbiAgICB9XHJcbiAgICAvKiog6ZmE5Lu25LiL6L29ICovXHJcbiAgICBmaWxlRG93bmxvYWRFdmVudEhhbmRsZXIoaW5mbykge1xyXG4gICAgICAgIHRoaXMuZmlsZURvd25sb2FkLmVtaXQoaW5mbyk7XHJcbiAgICB9XHJcbiAgICAvKiog5Y2g5L2N5aS05YOP5paH5a2XICovXHJcbiAgICBnZXRBdmF0YXIoaXRlbSkge1xyXG4gICAgICAgIGlmIChpdGVtICYmIGl0ZW1bdGhpcy5wZXJzb25uZWxzRGlzcGxheUtleV0pIHtcclxuICAgICAgICAgICAgbGV0IHN0ciA9IGl0ZW1bdGhpcy5wZXJzb25uZWxzRGlzcGxheUtleV07XHJcbiAgICAgICAgICAgIHJldHVybiBzdHIuc3Vic3RyaW5nKHN0ci5sZW5ndGggLSAyLCBzdHIubGVuZ3RoKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICByZXR1cm4gJyc7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbiJdfQ==
!function(e,i){"object"==typeof exports&&"undefined"!=typeof module?i(exports,require("rxjs"),require("rxjs/operators"),require("@angular/common"),require("@angular/forms"),require("@angular/platform-browser"),require("@farris/ui-dialog"),require("@farris/ui-common"),require("@farris/ui-common/date"),require("@farris/ui-tree"),require("@farris/ui-modal"),require("@farris/ui-loading"),require("@farris/ui-locale"),require("@farris/ui-modal/component-loader"),require("@farris/ui-modal/positioning"),require("@farris/ui-perfect-scrollbar"),require("@farris/ui-pagination"),require("@farris/ui-notify"),require("@farris/ui-input-group"),require("@angular/common/http"),require("@angular/core")):"function"==typeof define&&define.amd?define("@farris/discussion-group",["exports","rxjs","rxjs/operators","@angular/common","@angular/forms","@angular/platform-browser","@farris/ui-dialog","@farris/ui-common","@farris/ui-common/date","@farris/ui-tree","@farris/ui-modal","@farris/ui-loading","@farris/ui-locale","@farris/ui-modal/component-loader","@farris/ui-modal/positioning","@farris/ui-perfect-scrollbar","@farris/ui-pagination","@farris/ui-notify","@farris/ui-input-group","@angular/common/http","@angular/core"],i):i((e.farris=e.farris||{},e.farris["discussion-group"]={}),e.rxjs,e.rxjs.operators,e.ng.common,e.ng.forms,e.ng.platformBrowser,e.uiDialog,e.uiCommon,e.date,e.uiTree,e.uiModal,e.uiLoading,e.uiLocale,e.componentLoader,e.positioning,e.uiPerfectScrollbar,e.uiPagination,e.uiNotify,e.uiInputGroup,e.ng.common.http,e.ng.core)}(this,function(e,r,s,i,t,n,o,a,c,l,d,u,p,f,h,g,m,b,v,x,y){"use strict";var w=(S.decorators=[{type:y.Injectable,args:[{providedIn:"root"}]}],S.ctorParameters=function(){return[]},S.ngInjectableDef=y.defineInjectable({factory:function(){return new S},token:S,providedIn:"root"}),S);function S(){}var k=(I.prototype.resetData=function(p){var f=[];p&&p.commentIds&&p.commentIds.length&&p.commentIds.forEach(function(i){var s=p.comments.find(function(e){return e.id===i});if(s){var e=s.id,t=s.userId,n=s.user.name,o=s.user.hasOwnProperty("imgData")?s.user.imgData:"",r=s.commentDate,a=s.text,c=s.hasOwnProperty("attachFiles")?s.attachFiles:[],l=void 0;if(s.hasOwnProperty("parentId")){var d=p.comments.find(function(e){return e.id===s.parentId});d&&(l={id:d.id,userId:d.userId,userName:d.user.name,imgData:d.user.hasOwnProperty("imgData")?d.user.imgData:"",commentDate:d.commentDate,text:d.text,attachFiles:d.hasOwnProperty("attachFiles")?d.attachFiles:[]})}var u={id:e,userId:t,userName:n,imgData:o,commentDate:r,text:a,attachFiles:c,parentData:l};f.push(u)}}),this.resultDiscussion.next(f)},I.prototype.getData=function(){return this.resultDiscussion},I.decorators=[{type:y.Injectable}],I.ctorParameters=function(){return[]},I);function I(){this.resultDiscussion=new r.BehaviorSubject(null)}var P=(Object.defineProperty(D.prototype,"total",{get:function(){return this._total},set:function(e){this._total=e,this.initPaginationOptions()},enumerable:!0,configurable:!0}),Object.defineProperty(D.prototype,"pageSize",{get:function(){return this._pageSize},set:function(e){this._pageSize=e,this.initPaginationOptions()},enumerable:!0,configurable:!0}),Object.defineProperty(D.prototype,"discussionData",{get:function(){return this._discussionData},set:function(e){e&&(this._discussionData=e,this.innerDiscussionData=e)},enumerable:!0,configurable:!0}),D.prototype.ngOnInit=function(){var i=this;this.initPaginationOptions(),this.discussionListService.getData().subscribe(function(e){e&&!i._discussionData.length&&(i.innerDiscussionData=e)})},D.prototype.initPaginationOptions=function(){this.paginationOptions={id:"Farris-discussion-Pagination",itemsPerPage:this._pageSize,currentPage:this.pageIndex,pageList:[10,20,30,50,100],totalItems:this._total,remote:this.pagerOnServer}},D.prototype.reply=function(e){this.replyMessage.emit(e)},D.prototype.onPageChange=function(e){this.pageIndex!==e.pageIndex&&(this.pageIndex=e.pageIndex,this.paginationOptions.currentPage=e.pageIndex,this.pageChanged.emit({pageInfo:e}))},D.prototype.onPageSizeChange=function(e){if(this.pageSize!==e&&this.total){this.paginationOptions.itemsPerPage=e,this.pageSize=e;var i=this.total,s=Math.floor(i/e);0<i%e&&(s+=1),s&&this.pageIndex>s&&(this.pageIndex=s,this.paginationOptions.currentPage=this.pageIndex),this.pageSizeChanged.emit({pageInfo:{pageIndex:this.pageIndex,pageSize:e}})}},D.prototype.filePreviewEventHandler=function(e){this.filePreview.emit(e)},D.prototype.fileDownloadEventHandler=function(e){this.fileDownload.emit(e)},D.prototype.getAvatar=function(e){if(e&&e[this.personnelsDisplayKey]){var i=e[this.personnelsDisplayKey];return i.substring(i.length-2,i.length)}return""},D.decorators=[{type:y.Component,args:[{selector:"farris-discussion-list",template:'<div class="f-discussion-group-content">\r\n    <div class="f-discussion-group-content-item" *ngFor="let item of (supportPaging ? (innerDiscussionData | paginate: paginationOptions) : innerDiscussionData)">\r\n        <div class="discussion-item-avatar">\r\n            <img [src]="item.imgData" alt="" class="discussion-item-avatar-img" *ngIf="item.imgData">\r\n            <div class="discussion-item-avatar-tip" *ngIf="!item.imgData" [innerHTML]="getAvatar(item)"></div>\r\n        </div>\r\n        <div class="discussion-item-inner">\r\n            <div class="discussion-item-username">\r\n                {{item[personnelsDisplayKey]}}\r\n            </div>\r\n            <div class="discussion-item-text">\r\n                <span class="discussion-item-text-message" [innerHTML]="item.text | safeHtml"></span>\r\n                \x3c!-- <span class="discussion-item-text-about" *ngIf="item.messageAbout">@{{item.messageAbout}}</span> --\x3e\r\n            </div>\r\n            <div class="discussion-item-text-reply" *ngIf="item.parentData">\r\n                <span class="discussion-item-text-reply-title">\r\n                    {{ \'discussionGroup.reply\' | locale }}\r\n                    <span class="discussion-item-text-reply-name">{{item.parentData[personnelsDisplayKey]}}</span>：\r\n                </span>\r\n                <span class="discussion-item-text-reply-content" [innerHTML]="item.parentData.text | safeHtml">\r\n                </span>\r\n            </div>\r\n            \x3c!-- 附件列表 <div class="discussion-item-files" *ngIf="item.attachFiles && item.attachFiles.length">\r\n                <f-file-preview class="d-flex flex-wrap" [itemCls]="\'demo-view-item\'" [fileInfos]="item.attachFiles"\r\n                    (filePreviewEvent)="filePreviewEventHandler($event)" (fileDownloadEvent)="fileDownloadEventHandler($event)"\r\n                    #filePreview>\r\n                    <ng-template filePreviewListTypeTemplate let-data let-readonly="readonly">\r\n                        <div class="ffilepreview--item-detail">\r\n                            <div class="ffilepreview--item-icon">\r\n                                <span class="ffilepreview--filetype-icon" [ngClass]="filePreview.getFileTypeClassName(data.name)"></span>\r\n                            </div>\r\n                            <div class="ffilepreview--item-content">\r\n                                <a class="item-content--title" [title]="data.name"\r\n                                    (click)="filePreview.filePreviewHandler($event,data)">{{data.name}}</a>\r\n                                <div class="item-content--toolbar f-text-light">\r\n                                    <button class="btn btn-link" (click)="filePreview.filePreviewHandler($event,data)">\r\n                                    <span class="f-icon f-icon-preview"></span>预览\r\n                                    </button>\r\n                                    <button class="btn btn-link" (click)="filePreview.fileDownloadHandler($event,data)">\r\n                                    <span class="f-icon f-icon-download"></span>下载\r\n                                    </button>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </ng-template>\r\n                </f-file-preview>\r\n            </div> --\x3e\r\n            <div class="discussion-item-footer">\r\n                <div class="discussion-item-time">\r\n                    <span class="discussion-item-time-text">{{item.commentDate | dateformat:\'yyyy-MM-dd HH:mm\'}}</span>\r\n                </div>\r\n                <div class="discussion-item-btns">\r\n                    <span class="discussion-item-btns-start" (click)="reply(item)">\r\n                        <span class="f-icon f-icon-message"></span>\r\n                        <span class="discussion-item-btns-start-text">\r\n                            {{ \'discussionGroup.reply\' | locale }}\r\n                        </span>\r\n                    </span>\r\n                    \x3c!-- <span class="discussion-item-btns-new">\r\n                        <span class="f-icon f-icon-star-outline"></span>\r\n                    </span> --\x3e\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <div class="f-discussion-group-footer" *ngIf="supportPaging">\r\n        <pagination-controls #pager \r\n            [id]="paginationOptions.id" \r\n            [maxSize]="maxSize" \r\n            [directionLinks]="directionLinks"\r\n            [autoHide]="autoHide" \r\n            [responsive]="responsive" \r\n            [previousLabel]="labels.previousLabel"\r\n            [nextLabel]="labels.nextLabel"\r\n            (pageChange)="onPageChange($event)"\r\n            (pageSizeChange)="onPageSizeChange($event)"\r\n            [showPageList]="false"\r\n        >\r\n        </pagination-controls>\r\n    </div>\r\n</div>',encapsulation:y.ViewEncapsulation.None,styles:[".f-discussion-group-content-item{display:-webkit-box;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;flex-direction:row;margin-bottom:14px}.f-discussion-group-content-item .discussion-item-avatar{width:32px;height:32px;margin-right:10px;overflow:hidden;cursor:pointer;flex-shrink:0}.f-discussion-group-content-item .discussion-item-avatar-img{display:block;width:32px;height:32px;border-radius:50%}.f-discussion-group-content-item .discussion-item-avatar-tip{width:32px;height:32px;font-size:12px;color:#fff;text-align:center;line-height:32px;border-radius:50%;background-color:#4796ff}.f-discussion-group-content-item .discussion-item-inner{flex-shrink:1;-webkit-box-flex:1;flex-grow:1;flex-basis:0;padding-bottom:14px;border-bottom:1px solid #e3e3e3;overflow:hidden}.f-discussion-group-content-item .discussion-item-inner .discussion-item-username{margin-bottom:4px;font-size:16px;color:rgba(0,0,0,.85)}.f-discussion-group-content-item .discussion-item-inner .discussion-item-text{font-size:14px;color:rgba(0,0,0,.75)}.f-discussion-group-content-item .discussion-item-inner .discussion-item-text .discussion-item-text-message{word-break:break-all}.f-discussion-group-content-item .discussion-item-inner .discussion-item-text-reply{margin-top:11px;padding:6px 8px;font-size:0;background:#f5f5f5;border-radius:2px}.f-discussion-group-content-item .discussion-item-inner .discussion-item-text-reply-content,.f-discussion-group-content-item .discussion-item-inner .discussion-item-text-reply-title{font-size:14px;color:rgba(0,0,0,.75);line-height:20px}.f-discussion-group-content-item .discussion-item-inner .discussion-item-text-reply-title .discussion-item-text-reply-name{color:#3487e3}.f-discussion-group-content-item .discussion-item-inner .discussion-item-text-reply-content{word-break:break-all}.f-discussion-group-content-item .discussion-item-inner .discussion-item-files{margin-top:11px}.f-discussion-group-content-item .discussion-item-inner .discussion-item-files .ffilepreview--filetype-icon{width:40px;height:40px}.f-discussion-group-content-item .discussion-item-inner .discussion-item-footer{margin-top:10px;padding-right:20px;display:-webkit-box;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;flex-direction:row;-webkit-box-align:center;align-items:center;-webkit-box-pack:justify;justify-content:space-between}.f-discussion-group-content-item .discussion-item-inner .discussion-item-footer .discussion-item-time{font-size:14px;color:#b1b6c2}.f-discussion-group-content-item .discussion-item-inner .discussion-item-footer .discussion-item-btns{display:-webkit-box;display:flex;-webkit-box-align:center;align-items:center}.f-discussion-group-content-item .discussion-item-inner .discussion-item-footer .discussion-item-btns .discussion-item-btns-start{display:-webkit-box;display:flex;-webkit-box-align:center;align-items:center;position:relative;cursor:pointer}.f-discussion-group-content-item .discussion-item-inner .discussion-item-footer .discussion-item-btns .discussion-item-btns-start .f-icon{color:rgba(0,0,0,.45);font-size:16px}.f-discussion-group-content-item .discussion-item-inner .discussion-item-footer .discussion-item-btns .discussion-item-btns-start .f-icon::before{vertical-align:bottom}.f-discussion-group-content-item .discussion-item-inner .discussion-item-footer .discussion-item-btns .discussion-item-btns-start .discussion-item-btns-start-text{margin-left:14px;font-size:14px;color:rgba(0,0,0,.45)}.f-discussion-group-content-item .discussion-item-inner .discussion-item-footer .discussion-item-btns .discussion-item-btns-start:hover .discussion-item-btns-start-text,.f-discussion-group-content-item .discussion-item-inner .discussion-item-footer .discussion-item-btns .discussion-item-btns-start:hover .f-icon{color:#3487e3}.f-discussion-group-content-item:last-child .discussion-item-inner{border-bottom:none}"]}]}],D.ctorParameters=function(){return[{type:k}]},D.propDecorators={personnelsDisplayKey:[{type:y.Input}],pagerOnServer:[{type:y.Input}],supportPaging:[{type:y.Input}],pageIndex:[{type:y.Input}],total:[{type:y.Input}],pageSize:[{type:y.Input}],discussionData:[{type:y.Input}],replyMessage:[{type:y.Output}],pageChanged:[{type:y.Output}],pageSizeChanged:[{type:y.Output}],filePreview:[{type:y.Output}],fileDownload:[{type:y.Output}],pager:[{type:y.ViewChild,args:["pager"]}]},D);function D(e){this.discussionListService=e,this.personnelsDisplayKey="userName",this.pagerOnServer=!0,this.supportPaging=!0,this.pageIndex=1,this._total=0,this._pageSize=10,this.innerDiscussionData=[],this._discussionData=[],this.replyMessage=new y.EventEmitter,this.pageChanged=new y.EventEmitter,this.pageSizeChanged=new y.EventEmitter,this.filePreview=new y.EventEmitter,this.fileDownload=new y.EventEmitter,this.labels={previousLabel:" ",nextLabel:" "},this.directionLinks=!0,this.maxSize=7,this.responsive=!0,this.autoHide=!1}var C=function(){return(C=Object.assign||function(e){for(var i,s=1,t=arguments.length;s<t;s++)for(var n in i=arguments[s])Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n]);return e}).apply(this,arguments)};function L(e,i){var s="function"==typeof Symbol&&e[Symbol.iterator];if(!s)return e;var t,n,o=s.call(e),r=[];try{for(;(void 0===i||0<i--)&&!(t=o.next()).done;)r.push(t.value)}catch(a){n={error:a}}finally{try{t&&!t.done&&(s=o["return"])&&s.call(o)}finally{if(n)throw n.error}}return r}function E(){for(var e=[],i=0;i<arguments.length;i++)e=e.concat(L(arguments[i]));return e}var T={Cancel:0,Confirm:1};T[T.Cancel]="Cancel",T[T.Confirm]="Confirm";var O=(Object.defineProperty(U.prototype,"personnels",{get:function(){return this._personnels},set:function(e){e&&(this._personnels=e,this.innerPersonnels=this._personnels,this.copyPersonnels=this._personnels)},enumerable:!0,configurable:!0}),Object.defineProperty(U.prototype,"replyUser",{get:function(){return this._replyUser},set:function(e){e&&(this._replyUser=e,this._replyUser.id&&this.editorFocus())},enumerable:!0,configurable:!0}),Object.defineProperty(U.prototype,"attachFiles",{get:function(){return this._attachFiles},set:function(e){e&&(this._attachFiles=e)},enumerable:!0,configurable:!0}),U.prototype.ngOnInit=function(){var i=this;this.renderer.listen(document,"click",function(e){i.personModalVisible=!1,i.relativeVisible=!1}),this.el=this.elementRef.nativeElement,this.permissionList=[{value:"ALL",text:this.localeService.getValue("discussionGroup.all")},{value:"RELATED",text:this.localeService.getValue("discussionGroup.related")}],this.permission=this.permissionList[0],this.options={maxUploads:3,maxFileSize:10240,allowedContentTypes:[".jpg",".pdf"]},this.placeholder=this.localeService.getValue("discussionGroup.placeholder")},U.prototype.fUploadDoneHandler=function(e){this.fileUploadDone.emit(e)},U.prototype.fUploadRemovedHandler=function(e){},U.prototype.filePreviewEventHandler=function(e){this.filePreview.emit(e)},U.prototype.fileRemoveEventHandler=function(e){this.fileRemove.emit(e)},U.prototype.setTextValue=function(e){void 0===e&&(e=null),e&&(this.tempTextValue=e.target.innerHTML,this.textValue=this.tempTextValue),this.tempPersonnelsValue&&(this.textValue+=this.tempPersonnelsValue),this.tempSectionValue&&(this.textValue+=this.tempSectionValue),this.tempTextValue="",this.tempPersonnelsValue="",this.tempSectionValue=""},U.prototype.listenEditorValueChange=function(e){var s=this;this.tempTextValue=e.target.innerHTML;for(var i=e.target.children,t=[],n=0;n<i.length;n++)t.push(i[n].id);this.selectedPersonnels.forEach(function(e,i){t.includes(e[s.personnelsPrimaryKey])||s.selectedPersonnels.splice(i,1)}),this.selectedSection.forEach(function(e,i){t.includes(e[s.personnelsPrimaryKey])||s.selectedSection.splice(i,1)}),this.tempTextValue||(this.tempTextValue="")},U.prototype.serachPersonnel=function(){var i=this;this.personnelText?(this.showSearchList=!0,this.getSearchData(this.personnelText,0).subscribe(function(e){e.hasOwnProperty("users")&&(i.searchPersonnelList=e,i.setPersonModalPosition())})):this.showSearchList=!1},U.prototype.getMoreSearchData=function(){var i=this;this.getSearchData(this.personnelText,this.searchPersonnelList.pageIndex+1).subscribe(function(e){e.hasOwnProperty("users")&&(i.searchPersonnelList.pageIndex=e.pageIndex,i.searchPersonnelList.users=E(i.searchPersonnelList.users,e.users))})},U.prototype.getSearchData=function(e,i,s){if(void 0===s&&(s=this.pageSize),this.personSearchUrl){var t=this.personSearchUrl+"?param="+e+"&pageSize="+s+"&pageIndex="+i;return this.http.get(t)}return r.of(!0)},U.prototype.personnelChecked=function(e){e.active=!e.active,this.innerPersonnels=this.innerPersonnels.map(function(e){return C({},e)}),this.cd.markForCheck(),this.appendPersonnels()},U.prototype.appendPersonnels=function(){var e=[];(e=this.showSearchList?this.searchPersonnelList.users.filter(function(e){return!0===e.active}):this.innerPersonnels.filter(function(e){return!0===e.active})).length&&this.appendPersonnel(e),this.resetPersonnels(),this.setTextValue(),this.personModalVisible=!1},U.prototype.appendPersonnelsList=function(e){e.length&&this.appendPersonnel(e,!0),this.setTextValue()},U.prototype.appendPersonnel=function(e,i){var s=this;void 0===i&&(i=!1),e.forEach(function(e){s.selectedPersonnels.length&&s._isInArray(e[s.personnelsPrimaryKey],s.personnelsPrimaryKey,s.selectedPersonnels)||(s.tempPersonnelsValue+='<a name="personnel" contenteditable="false" class="at-user" id="'+e[s.personnelsPrimaryKey]+'" userid="'+e[s.personnelsPrimaryKey]+'">@'+e[s.personnelsDisplayKey]+"</a>&nbsp;",s.selectedPersonnels.push(e))})},U.prototype.appendSectionList=function(e){e.length&&this.appendSection(e),this.setTextValue()},U.prototype.appendSection=function(e){var i=this;e.forEach(function(e){i.selectedSection.length&&i._isInArray(e[i.personnelsPrimaryKey],i.personnelsPrimaryKey,i.selectedSection)||(i.tempSectionValue+='<a name="org" contenteditable="false" class="at-org" id="'+e[i.personnelsPrimaryKey]+'" orgid="'+e[i.personnelsPrimaryKey]+'">@'+e.name+"</a>&nbsp;",i.selectedSection.push(e))})},U.prototype._isInArray=function(i,s,e){return!(!i||!s)&&-1!==e.findIndex(function(e){return i===e[s]})},U.prototype.resetPersonnels=function(){this.showSearchList=!1,this.personModalVisible=!1,this.innerPersonnels=this.copyPersonnels,this.innerPersonnels.length&&this.innerPersonnels.forEach(function(e){return e.active=!1}),this.personnelText=""},U.prototype.openModalPerson=function(e){var i=this;this.personModalVisible=!this.personModalVisible,setTimeout(function(){i.personModalVisible&&i.setPersonModalPosition()},0),this.stopBubble(e)},U.prototype.setPersonModalPosition=function(){window.innerHeight<this.personModal.nativeElement.getBoundingClientRect().bottom&&this.personModal.nativeElement.scrollIntoView(!1)},U.prototype.openModalPermission=function(e){this.relativeVisible=!this.relativeVisible,this.stopBubble(e)},U.prototype.openModalFile=function(e){this.attachFilesModalVisible=!this.attachFilesModalVisible,this.stopBubble(e)},U.prototype.stopBubble=function(e){e&&e.stopPropagation?e.stopPropagation():window.event.cancelBubble=!0},U.prototype.submitApproval=function(){if(this.textValue){var s=[];this.attachFiles&&this.attachFiles.length&&this.attachFiles.forEach(function(e){var i={id:e.id,name:e.name,size:e.size,metadataId:e.extend.metadataId};s.push(i)}),this.valueChange.emit({msgInfo:T.Confirm,text:this.textValue,mailTos:this.selectedPersonnels,mailToSections:this.selectedSection,visibility:this.permission.value,parentId:this.replyUser&&this.replyUser.hasOwnProperty("id")?this.replyUser.id:null,attachFiles:s.length?s:null}),this.textValue="",this.selectedPersonnels=[],this.selectedSection=[],this.attachFiles=[],this.replyUser={}}else{var e=this.localeService.getValue("discussionGroup.notEmpty");e&&this.notifyService.error(e)}},U.prototype.cancel=function(){this.valueChange.emit({msgInfo:T.Cancel,text:null,mailTos:[],mailToSections:[],visibility:null,parentId:null,attachFiles:null}),this.textValue="",this.selectedPersonnels=[],this.selectedSection=[],this.attachFiles=[],this.replyUser={}},U.prototype.changePermission=function(i){this.permission=this.permissionList.find(function(e){return e.value===i}),this.relativeVisible=!1},U.prototype.editorFocus=function(){this.editor.nativeElement.focus()},U.prototype.selectionsChangePar=function(e){if(e.data.users.length){var i=[];e.data.users.forEach(function(e){i.push(e.data)}),this.appendPersonnelsList(i)}if(e.data.section.length){var s=[];e.data.section.forEach(function(e){s.push(e.data)}),this.appendSectionList(s)}this.selectionsChange.emit(e)},U.prototype.lineDataChangePar=function(e){this.lineDataChange.emit(e)},U.prototype.getAvatar=function(e){if(e&&e[this.personnelsDisplayKey]){var i=e[this.personnelsDisplayKey];return i.substring(i.length-2,i.length)}return""},U.prototype.ougUsers=function(e){this.getOugUsers.emit(e)},U.decorators=[{type:y.Component,args:[{selector:"farris-discussion-editor",template:'<div class="farris-discussion-group-reply-tip" *ngIf="replyUser && replyUser.id">\r\n    {{ \'discussionGroup.reply\' | locale }} &nbsp;\r\n    <span class="farris-discussion-group-reply-tip-name">\r\n        {{replyUser[replyPersonnelsDisplayKey]}}\r\n    </span>\r\n    ：\r\n</div>\r\n<div class="f-discussion-group-edit">\r\n    <div class="f-discussion-group-edit-container" [ngStyle]="{\'height\': editHeight + \'px\'}">\r\n        <div class="textarea-editor" #editor (keyup)="listenEditorValueChange($event)" (blur)="setTextValue($event)"\r\n            contenteditable="true" [innerHTML]="textValue | safeHtml"></div>\r\n    </div>\r\n    \x3c!-- 附件部分 <div class="f-discussion-group-edit-files" *ngIf="attachFiles && attachFiles.length">\r\n        <f-file-preview class="d-flex flex-wrap" [itemCls]="\'demo-view-item\'" [fileInfos]="attachFiles"\r\n            (filePreviewEvent)="filePreviewEventHandler($event)" (fileRemoveEvent)="fileRemoveEventHandler($event)"\r\n            #filePreview>\r\n            <ng-template filePreviewListTypeTemplate let-data let-readonly="readonly">\r\n                <div class="ffilepreview--item-detail">\r\n                    <div class="ffilepreview--item-icon">\r\n                        <span class="ffilepreview--filetype-icon" [ngClass]="filePreview.getFileTypeClassName(data.name)"></span>\r\n                    </div>\r\n                    <div class="ffilepreview--item-content">\r\n                        <a class="item-content--title" [title]="data.name"\r\n                            (click)="filePreview.filePreviewHandler($event,data)">{{data.name}}</a>\r\n                        <div class="item-content--toolbar f-text-light">\r\n                            <button class="btn btn-link" (click)="filePreview.filePreviewHandler($event,data)">\r\n                                <span class="f-icon f-icon-preview"></span>预览\r\n                            </button>\r\n                            <button class="btn btn-link" (click)="filePreview.fileRemoveHandler($event,data)">\r\n                                <span class="f-icon f-icon-delete"></span>删除\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </ng-template>\r\n        </f-file-preview>\r\n    </div> --\x3e\r\n    <div class="f-discussion-group-edit-footer">\r\n        <div class="f-discussion-group-edit-toolbar">\r\n            \x3c!-- <div class="f-discussion-group-edit-toolbar-item f-discussion-group-edit-toolbar-file" (click)="openModalFile($event)">\r\n                <div class="toolbar-item-text">\r\n                    <span class="toolbar-icon f-icon f-icon-attachment"></span>\r\n                    <span class="toolbar-text">附件</span>\r\n                </div>\r\n            </div> --\x3e\r\n            <div class="f-discussion-group-edit-toolbar-item f-discussion-group-edit-toolbar-about">\r\n                <div class="toolbar-item-text" (click)="openModalPerson($event)">\r\n                    <span class="toolbar-icon">@</span>\r\n                    <span class="toolbar-text">{{ \'discussionGroup.colleague\' | locale }}</span>\r\n                </div>\r\n                <div class="f-discussion-group-about-dropdown" *ngIf="personModalVisible" (click)="stopBubble($event)" #personModal>\r\n                    <div class="f-discussion-group-about-search">\r\n                        \x3c!-- bugNum:480647 --\x3e\r\n                        <input-group [placeholder]="placeholder" [groupText]="groupIcon" [(ngModel)]="personnelText" (enterHandle)="serachPersonnel()" (clickHandle)="serachPersonnel()" (valueChange)="serachPersonnel()" (clear)="serachPersonnel()"></input-group>\r\n                    </div>\r\n                    <div class="f-discussion-group-about-content">\r\n                        <div class="f-discussion-group-about-used" [hidden]="showSearchList">\r\n                            <ul class="f-discussion-group-about-dropdown-list">\r\n                                <ng-template [ngIf]="innerPersonnels.length">\r\n                                    <li *ngFor="let item of innerPersonnels" (click)="item.active = !item.active" class="d-flex f-discussion-group-about-dropdown-list-item"\r\n                                        [class.active]="item.active">\r\n                                        <span class="f-icon f-icon-check"></span>\r\n                                        <img [src]="item.imgData" class="about-list-item-avatar" *ngIf="item.imgData"/>\r\n                                        <div class="about-list-item-avatar-tip" *ngIf="!item.imgData" [innerHTML]="getAvatar(item)"></div>\r\n                                        <div class="f-discussion-group-about-dropdown-list-detail f-utils-fill">\r\n                                            <div class="about-list-detail-text">{{item[personnelsDisplayKey]}}</div>\r\n                                            <div class="about-list-detail-subtext">{{item.email}}</div>\r\n                                        </div>\r\n                                    </li>\r\n                                </ng-template>\r\n                                <ng-template [ngIf]="!innerPersonnels.length">\r\n                                    <li class="f-discussion-group-about-dropdown-list-item about-dropdown-list-item-empty">{{ \'discussionGroup.emptyMessage\' | locale }}</li>\r\n                                </ng-template>\r\n                            </ul>        \r\n                        </div>\r\n                        <div class="f-discussion-group-about-searchlist" [hidden]="!showSearchList">\r\n                            <ul class="f-discussion-group-about-dropdown-list">\r\n                                <ng-template [ngIf]="searchPersonnelList && searchPersonnelList.users && searchPersonnelList.users.length">\r\n                                    <li *ngFor="let item of searchPersonnelList[\'users\']" (click)="item.active = !item.active" class="d-flex f-discussion-group-about-dropdown-list-item"\r\n                                        [class.active]="item.active">\r\n                                        <span class="f-icon f-icon-check"></span>\r\n                                        <img [src]="item.imgData" class="about-list-item-avatar" *ngIf="item.imgData"/>\r\n                                        <div class="about-list-item-avatar-tip" *ngIf="!item.imgData" [innerHTML]="getAvatar(item)"></div>\r\n                                        <div class="f-discussion-group-about-dropdown-list-detail f-utils-fill">\r\n                                            <div class="about-list-detail-text">{{item[personnelsDisplayKey]}}</div>\r\n                                            \x3c!-- <div class="about-list-detail-subtext">{{item.email}}</div> --\x3e\r\n                                            <div class="about-list-detail-subtext">\r\n                                                <span [innerHTML]="item | getOrgText:sectionData"></span>\r\n                                            </div>\r\n                                        </div>\r\n                                    </li>\r\n                                    <div class="f-discussion-person-list-page">\r\n                                        <span class="section-page-more section-page-text" *ngIf="searchPersonnelList.pageIndex < searchPersonnelList.pageCount-1" (click)="getMoreSearchData()">{{ \'discussionGroup.viewMore\' | locale }}</span>\r\n                                    </div>\r\n                                </ng-template>\r\n                                <ng-template [ngIf]="searchPersonnelList && searchPersonnelList.users && !searchPersonnelList.users.length">\r\n                                    <li class="f-discussion-group-about-dropdown-list-item">{{ \'discussionGroup.emptyMessage\' | locale }}</li>\r\n                                </ng-template>\r\n                            </ul>\r\n                        </div>\r\n                    </div>\r\n                    <div class="f-about-list-btns d-flex">\r\n                        <div class="f-about-list-btns-left">\r\n                            <farris-discussion-personnel \r\n                            [sectionData]="sectionData"\r\n                            [orgUrl]="orgUrl"\r\n                            [personSearchUrl]="personSearchUrl"\r\n                            (selectionsChange)="selectionsChangePar($event)"\r\n                            (lineDataChange)="lineDataChangePar($event)"\r\n                            (ougUsers)="ougUsers($event)"\r\n                            ></farris-discussion-personnel>\r\n                        </div>\r\n                        <div class="f-about-list-btns-right">\r\n                            <button class="btn btn-secondary" (click)="resetPersonnels()">{{ \'discussionGroup.cancel\' | locale }}</button>\r\n                            <button class="btn btn-primary" (click)="appendPersonnels()">{{ \'discussionGroup.confirm\' | locale }}</button>\r\n                        </div>\r\n                        \r\n                    </div>\r\n                </div>\r\n            </div>\r\n            \x3c!-- 暂时注释20210407 --\x3e\r\n            \x3c!-- <div class="f-discussion-group-edit-toolbar-item f-discussion-group-edit-toolbar-dropdown">\r\n                <div class="toolbar-dropdown-text" (click)="openModalPermission($event)">\r\n                    <span class="toolbar-text">{{permission.text}}</span>\r\n                    <span class="f-icon f-icon-collapse toolbar-icon"></span>\r\n                </div>\r\n                <div class="toolbar-dropdown-list dropdownlist" *ngIf="relativeVisible">\r\n                    <ul *ngIf="permissionList && permissionList.length">\r\n                        <li *ngFor="let item of permissionList" class="dropdown-item" [class.active]="permission?.value === item.value"\r\n                            (click)="changePermission(item.value)">{{item.text}}</li>\r\n                    </ul>\r\n                </div>\r\n            </div> --\x3e\r\n        </div>\r\n        <div class="f-discussion-group-edit-btns">\r\n            <button class="btn btn-link f-discussion-cancel" *ngIf="cancelVisible" (click)="cancel()">{{ \'discussionGroup.cancel\' | locale }}</button>\r\n            <button class="btn btn-primary" (click)="submitApproval()">{{ \'discussionGroup.submit\' | locale }}</button>\r\n        </div>\r\n    </div>\r\n</div>\r\n\x3c!-- <div class="f-discussion-group-file-upload" [hidden]="!attachFilesModalVisible">\r\n    <f-file-upload\r\n        (fUploadDoneEvent)="fUploadDoneHandler($event)"\r\n        (fUploadRemovedEvent)="fUploadRemovedHandler($event)">\r\n    </f-file-upload>\r\n</div> --\x3e',encapsulation:y.ViewEncapsulation.None,styles:[":host{display:block}.f-discussion-group-edit{border:1px solid #dcdcdc;background:#fff}.f-discussion-group-edit .f-discussion-group-edit-container{width:100%;position:relative}.f-discussion-group-edit .f-discussion-group-edit-container .textarea-editor{width:100%;height:100%;padding:8px;margin:0 auto;outline:0;overflow-y:auto;word-break:break-all;white-space:normal;resize:none}.f-discussion-group-edit .f-discussion-group-edit-container .textarea-editor a{color:#3487e3}.f-discussion-group-edit .f-discussion-group-edit-footer{display:-webkit-box;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;flex-direction:row;-webkit-box-align:center;align-items:center;flex-wrap:wrap;-webkit-box-pack:justify;justify-content:space-between;padding:10px 14px;background:#f7f7f7}.f-discussion-group-edit .f-discussion-group-edit-footer .f-discussion-group-edit-toolbar{display:-webkit-box;display:flex;-webkit-box-align:center;align-items:center;flex-wrap:wrap}.f-discussion-group-edit .f-discussion-group-edit-footer .f-discussion-group-edit-toolbar .f-discussion-group-edit-toolbar-item{cursor:pointer;color:rgba(0,0,0,.65)}.f-discussion-group-edit .f-discussion-group-edit-footer .f-discussion-group-edit-toolbar .f-discussion-group-edit-toolbar-item .toolbar-item-text{display:-webkit-box;display:flex;-webkit-box-align:center;align-items:center;line-height:22px}.f-discussion-group-edit .f-discussion-group-edit-footer .f-discussion-group-edit-toolbar .f-discussion-group-edit-toolbar-item .toolbar-text{margin-left:2px;font-size:14px}.f-discussion-group-edit .f-discussion-group-edit-footer .f-discussion-group-edit-toolbar .f-discussion-group-edit-toolbar-item .toolbar-icon{color:#667580;font-size:16px}.f-discussion-group-edit .f-discussion-group-edit-footer .f-discussion-group-edit-toolbar .f-discussion-group-edit-toolbar-file{margin-right:12px}.f-discussion-group-edit .f-discussion-group-edit-footer .f-discussion-group-edit-toolbar .f-discussion-group-edit-toolbar-about{position:relative;margin-right:32px}.f-discussion-group-edit .f-discussion-group-edit-footer .f-discussion-group-edit-toolbar .f-discussion-group-edit-toolbar-about .f-discussion-group-about-dropdown{position:absolute;top:calc(100% + 6px);left:0;width:300px;padding-top:16px;z-index:999;background:#fff;box-shadow:0 2px 8px 0 rgba(0,0,0,.15);border-radius:2px}.f-discussion-group-edit .f-discussion-group-edit-footer .f-discussion-group-edit-toolbar .f-discussion-group-edit-toolbar-about .f-discussion-group-about-dropdown .f-discussion-group-about-dropdown-list{max-height:282px;margin-top:10px;overflow-y:auto}.f-discussion-group-edit .f-discussion-group-edit-footer .f-discussion-group-edit-toolbar .f-discussion-group-edit-toolbar-about .f-discussion-group-about-dropdown .f-discussion-group-about-dropdown-list::-webkit-scrollbar{width:7px;height:7px;background-color:#8e8e8e}.f-discussion-group-edit .f-discussion-group-edit-footer .f-discussion-group-edit-toolbar .f-discussion-group-edit-toolbar-about .f-discussion-group-about-dropdown .f-discussion-group-about-dropdown-list::-webkit-scrollbar-track{border-radius:0;background-color:#fff;border:0;background-clip:padding-box;border-right:0}.f-discussion-group-edit .f-discussion-group-edit-footer .f-discussion-group-edit-toolbar .f-discussion-group-edit-toolbar-about .f-discussion-group-about-dropdown .f-discussion-group-about-dropdown-list::-webkit-scrollbar-thumb{border-radius:3px;background-color:#dbdbdb;border:0;background-clip:content-box;opacity:.6;-webkit-transform:rotate(90deg);transform:rotate(90deg)}.f-discussion-group-edit .f-discussion-group-edit-footer .f-discussion-group-edit-toolbar .f-discussion-group-edit-toolbar-about .f-discussion-group-about-dropdown .f-discussion-group-about-dropdown-list-item{padding:3px 14px;list-style:none;-webkit-box-align:center;align-items:center}.f-discussion-group-edit .f-discussion-group-edit-footer .f-discussion-group-edit-toolbar .f-discussion-group-edit-toolbar-about .f-discussion-group-about-dropdown .f-discussion-group-about-dropdown-list-item .f-discussion-group-about-dropdown-list-detail{margin-left:6px}.f-discussion-group-edit .f-discussion-group-edit-footer .f-discussion-group-edit-toolbar .f-discussion-group-edit-toolbar-about .f-discussion-group-about-dropdown .f-discussion-group-about-dropdown-list-item .f-discussion-group-about-dropdown-list-detail .about-list-detail-text{line-height:20px;font-size:12px;color:#0a131a;margin:0 auto;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.f-discussion-group-edit .f-discussion-group-edit-footer .f-discussion-group-edit-toolbar .f-discussion-group-edit-toolbar-about .f-discussion-group-about-dropdown .f-discussion-group-about-dropdown-list-item .f-discussion-group-about-dropdown-list-detail .about-list-detail-subtext{font-size:12px;color:#8f9ca6;line-height:20px}.f-discussion-group-edit .f-discussion-group-edit-footer .f-discussion-group-edit-toolbar .f-discussion-group-edit-toolbar-about .f-discussion-group-about-dropdown .f-discussion-group-about-dropdown-list-item .f-icon-check{border:1px solid #d8d9d9;color:#fff;font-size:15px;border-radius:2px}.f-discussion-group-edit .f-discussion-group-edit-footer .f-discussion-group-edit-toolbar .f-discussion-group-edit-toolbar-about .f-discussion-group-about-dropdown .f-discussion-group-about-dropdown-list-item .f-icon-check::before{content:''}.f-discussion-group-edit .f-discussion-group-edit-footer .f-discussion-group-edit-toolbar .f-discussion-group-edit-toolbar-about .f-discussion-group-about-dropdown .f-discussion-group-about-dropdown-list-item.active .f-icon-check{border:none;background:#4c91ff}.f-discussion-group-edit .f-discussion-group-edit-footer .f-discussion-group-edit-toolbar .f-discussion-group-edit-toolbar-about .f-discussion-group-about-dropdown .f-discussion-group-about-dropdown-list-item.active .f-icon-check::before{content:'\\e118'}.f-discussion-group-edit .f-discussion-group-edit-footer .f-discussion-group-edit-toolbar .f-discussion-group-edit-toolbar-about .f-discussion-group-about-dropdown .f-discussion-group-about-dropdown-list-item .about-list-item-avatar{display:block;width:30px;height:30px;margin-left:6px;border-radius:50%;overflow:hidden}.f-discussion-group-edit .f-discussion-group-edit-footer .f-discussion-group-edit-toolbar .f-discussion-group-edit-toolbar-about .f-discussion-group-about-dropdown .f-discussion-group-about-dropdown-list-item .about-list-item-avatar-tip{width:32px;height:32px;margin-left:6px;font-size:12px;color:#fff;text-align:center;line-height:32px;border-radius:50%;background-color:#4796ff}.f-discussion-group-edit .f-discussion-group-edit-footer .f-discussion-group-edit-toolbar .f-discussion-group-edit-toolbar-about .f-discussion-group-about-dropdown .f-discussion-group-about-dropdown-list-item:hover{background:#e6f7ff}.f-discussion-group-edit .f-discussion-group-edit-footer .f-discussion-group-edit-toolbar .f-discussion-group-edit-toolbar-about .f-discussion-group-about-dropdown .f-discussion-group-about-dropdown-list-item.about-dropdown-list-item-empty{cursor:default}.f-discussion-group-edit .f-discussion-group-edit-footer .f-discussion-group-edit-toolbar .f-discussion-group-edit-toolbar-about .f-discussion-group-about-dropdown .f-discussion-group-about-dropdown-list-item.about-dropdown-list-item-empty:hover{background:#fff}.f-discussion-group-edit .f-discussion-group-edit-footer .f-discussion-group-edit-toolbar .f-discussion-group-edit-toolbar-about .f-discussion-group-about-dropdown .f-discussion-group-about-search{padding:0 14px}.f-discussion-group-edit .f-discussion-group-edit-footer .f-discussion-group-edit-toolbar .f-discussion-group-edit-toolbar-about .f-discussion-group-about-dropdown .f-about-list-btns{-webkit-box-pack:justify;justify-content:space-between;background:#faf9f9;border-top:1px solid #efefef;padding:10px 15px}.f-discussion-group-edit .f-discussion-group-edit-footer .f-discussion-group-edit-toolbar .f-discussion-group-edit-toolbar-about .f-discussion-group-about-dropdown .f-about-list-btns .btn{margin-right:10px}.f-discussion-group-edit .f-discussion-group-edit-footer .f-discussion-group-edit-toolbar .f-discussion-group-edit-toolbar-about .f-discussion-group-about-dropdown .f-about-list-btns .btn:last-child{margin-right:0}.f-discussion-group-edit .f-discussion-group-edit-footer .f-discussion-group-edit-toolbar .f-discussion-group-edit-toolbar-dropdown{position:relative}.f-discussion-group-edit .f-discussion-group-edit-footer .f-discussion-group-edit-toolbar .f-discussion-group-edit-toolbar-dropdown .toolbar-dropdown-text{cursor:pointer}.f-discussion-group-edit .f-discussion-group-edit-footer .f-discussion-group-edit-toolbar .f-discussion-group-edit-toolbar-dropdown .toolbar-icon{color:rgba(0,0,0,.25)}.f-discussion-group-edit .f-discussion-group-edit-footer .f-discussion-group-edit-toolbar .f-discussion-group-edit-toolbar-dropdown .toolbar-text{margin-left:0}.f-discussion-group-edit .f-discussion-group-edit-footer .f-discussion-group-edit-toolbar .f-discussion-group-edit-toolbar-dropdown .toolbar-dropdown-list{position:absolute;left:0;top:calc(100% + 6px);z-index:999;padding:2px 0;background:#fff;box-shadow:0 2px 8px 0 rgba(0,0,0,.15);border-radius:2px}.f-discussion-group-edit .f-discussion-group-edit-footer .f-discussion-group-edit-toolbar .f-discussion-group-edit-toolbar-dropdown .toolbar-dropdown-list ul{max-width:220px;overflow-y:auto}.f-discussion-group-edit .f-discussion-group-edit-footer .f-discussion-group-edit-toolbar .f-discussion-group-edit-toolbar-dropdown .toolbar-dropdown-list ul li{font:14px/28px Microsoft yahei;padding:0 15px 0 10px;word-break:keep-all}.f-discussion-group-edit .f-discussion-group-edit-footer .f-discussion-group-edit-toolbar .f-discussion-group-edit-toolbar-dropdown .toolbar-dropdown-list ul li:hover{background:#e6f7ff}.f-discussion-group-edit .f-discussion-group-edit-footer .f-discussion-group-edit-btns{flex-shrink:0}.f-discussion-group-edit .f-discussion-group-edit-footer .f-discussion-group-edit-btns .f-discussion-cancel{margin-right:12px;font-size:14px;color:rgba(0,0,0,.75)}.f-discussion-group-edit .f-discussion-group-edit-files{padding:10px 14px 0}.f-discussion-group-edit .f-discussion-group-edit-files .ffilepreview--filetype-icon{width:32px;height:32px}.farris-discussion-group-reply-tip{display:-webkit-box;display:flex;-webkit-box-align:center;align-items:center;margin-bottom:10px;font-size:14px;color:rgba(0,0,0,.75)}.f-discussion-group-file-upload{margin-top:10px}.f-discussion-dialog-content{display:-webkit-box;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;flex-direction:row;-webkit-box-pack:justify;justify-content:space-between;height:100%;padding:14px;overflow:hidden}.f-discussion-dialog-content-left{display:-webkit-box;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;flex-direction:column;width:600px;height:100%;padding:0}.f-discussion-dialog-content-left .f-discussion-personnel-search{flex-shrink:0;position:relative;margin-bottom:7px}.f-discussion-dialog-content-left .f-discussion-tab-content{border:1px solid #dcdcdc;border-radius:2px;padding:12px 0 7px}.f-discussion-dialog-content-left .f-discussion-tab-content .f-discussion-personnel-content .f-discussion-personnel-crumbs{flex-shrink:0;position:relative;width:100%;height:32px;padding:0 12px;overflow:hidden}.f-discussion-dialog-content-left .f-discussion-tab-content .f-discussion-personnel-content .f-discussion-personnel-crumbs .crumbs-list{width:100%;overflow:hidden}.f-discussion-dialog-content-left .f-discussion-tab-content .f-discussion-personnel-content .f-discussion-personnel-crumbs .crumbs-list-item{display:-webkit-box;display:flex;flex-wrap:nowrap;flex-shrink:0;-webkit-box-align:center;align-items:center;line-height:20px;font-size:14px;color:rgba(0,0,0,.85);cursor:pointer}.f-discussion-dialog-content-left .f-discussion-tab-content .f-discussion-personnel-content .f-discussion-personnel-crumbs .crumbs-list-item .crumbs-text{padding:0 2px;text-overflow:ellipsis;max-width:80px;max-height:20px;white-space:nowrap;overflow:hidden}.f-discussion-dialog-content-left .f-discussion-tab-content .f-discussion-personnel-content .f-discussion-personnel-crumbs .crumbs-list-item:first-child .crumbs-text{padding-left:0}.f-discussion-dialog-content-left .f-discussion-tab-content .f-discussion-personnel-content .f-discussion-personnel-crumbs .crumbs-list-item.crumbs-list-item-disabled{color:rgba(0,0,0,.55)}.f-discussion-dialog-content-left .f-discussion-tab-content .f-discussion-personnel-content .f-discussion-personnel-crumbs .crumbs-list-ellipsis{-webkit-box-align:center;align-items:center;position:absolute;left:12px;top:0;width:30px;height:32px;line-height:32px}.f-discussion-dialog-content-left .f-discussion-tab-content .f-discussion-personnel-content .f-discussion-personnel-crumbs .crumbs-list-padding{padding-left:30px}.f-discussion-dialog-content-left .f-discussion-tab-content .f-discussion-personnel-content.f-discussion-personnel-content-hide{display:none!important}.f-discussion-dialog-content-right{height:100%;margin-left:14px;padding:0;border:1px solid #dcdcdc;border-radius:2px}.f-discussion-dialog-content-right .f-discussion-selected-personnel-header{display:-webkit-box;display:flex;-webkit-box-align:center;align-items:center;-webkit-box-pack:justify;justify-content:space-between;height:36px;padding:0 14px;background:#fafafa}.f-discussion-dialog-content-right .f-discussion-selected-personnel-header-text{font-size:14px;line-height:20px}.f-discussion-dialog-content-right .f-discussion-selected-personnel-content{padding:8px 0}.f-discussion-dialog-content-right .f-discussion-selected-personnel-content .f-discussion-selected-list .f-discussion-selected-item{display:-webkit-box;display:flex;-webkit-box-align:center;align-items:center;-webkit-box-pack:justify;justify-content:space-between;padding:6px 12px}.f-discussion-dialog-content-right .f-discussion-selected-personnel-content .f-discussion-selected-list .f-discussion-selected-item-text{line-height:20px}.f-discussion-dialog-content-right .f-discussion-selected-personnel-content .f-discussion-selected-list .f-discussion-selected-item-text .f-discussion-selected-name{font-size:14px;color:rgba(0,0,0,.85)}.f-discussion-dialog-content-right .f-discussion-selected-personnel-content .f-discussion-selected-list .f-discussion-selected-item-tip{font-size:12px;color:rgba(0,0,0,.35);line-height:20px}.f-discussion-dialog-content-right .f-discussion-selected-personnel-content .f-discussion-selected-list .f-discussion-selected-item-remove{visibility:hidden;color:#388fff;cursor:pointer}.f-discussion-dialog-content-right .f-discussion-selected-personnel-content .f-discussion-selected-list .f-discussion-selected-item:hover{background:#f3fbff}.f-discussion-dialog-content-right .f-discussion-selected-personnel-content .f-discussion-selected-list .f-discussion-selected-item:hover .f-discussion-selected-item-remove{visibility:visible}.f-discussion-dialog-content .f-discussion-selected-item-remove{visibility:hidden}.f-discussion-dialog-content .f-discussion-personnel-item{display:-webkit-box;display:flex;-webkit-box-align:center;align-items:center;padding:3px 14px 3px 3px;cursor:pointer}.f-discussion-dialog-content .f-discussion-personnel-item-avatar{flex-shrink:0;width:36px;height:36px;margin-right:5px;border-radius:50%;overflow:hidden}.f-discussion-dialog-content .f-discussion-personnel-item-avatar img{display:block;width:100%}.f-discussion-dialog-content .f-discussion-personnel-item-text{flex-shrink:1;-webkit-box-flex:1;flex-grow:1;flex-basis:0;padding-right:10px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.f-discussion-dialog-content .f-discussion-personnel-item-text .f-discussion-personnel-name{line-height:20px;font-size:12px;color:#0a131a}.f-discussion-dialog-content .f-discussion-personnel-item-text .f-discussion-personnel-mail{line-height:20px;font-size:12px;color:#8f9ca6}.f-discussion-dialog-content .f-discussion-personnel-item-remove{display:none}.f-discussion-dialog-content .f-discussion-personnel-item:hover{background:#f3fbff}.f-discussion-dialog-content .f-discussion-personnel-item:hover .f-discussion-personnel-item-remove{display:block}.f-discussion-dialog-content .f-discussion-personnel-item.active{background:#def1ff}.f-discussion-dialog-content .f-discussion-personnel-item.selected{background:#fff;cursor:not-allowed}.f-discussion-dialog-content .f-discussion-personnel-item.selected .f-discussion-personnel-mail,.f-discussion-dialog-content .f-discussion-personnel-item.selected .f-discussion-personnel-name{color:#c1c1c1}.f-discussion-dialog-content .f-discussion-personnel-empty{padding:3px 14px;list-style:none;-webkit-box-align:center;align-items:center}.f-discussion-dialog-content .f-discussion-section-list-empty{display:-webkit-box;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;flex-direction:column;-webkit-box-align:center;align-items:center;-webkit-box-pack:center;justify-content:center;height:100%}.f-discussion-dialog-content .f-discussion-section-list-empty .f-icon{margin-bottom:8px;font-size:26px;color:#e2e6f0}.f-discussion-dialog-content .f-discussion-section-list-empty .section-list-empty-text{font-size:13px;color:rgba(0,0,0,.25)}.f-discussion-dialog-content .f-discussion-personnel-item-tip{width:36px;height:36px;font-size:12px;color:#fff;text-align:center;line-height:32px;border-radius:50%;background-color:#4796ff}.f-discussion-dialog-content .f-discussion-section-list .section-list-item{display:-webkit-box;display:flex;-webkit-box-align:center;align-items:center;-webkit-box-pack:justify;justify-content:space-between;height:32px;padding:0 12px;cursor:pointer}.f-discussion-dialog-content .f-discussion-section-list .section-list-item-name{font-size:14px;color:rgba(0,0,0,.85);line-height:32px}.f-discussion-dialog-content .f-discussion-section-list .section-list-item-next{flex-shrink:0;position:relative;padding-left:20px;padding-right:10px;line-height:20px;font-size:12px;color:#388fff;cursor:pointer}.f-discussion-dialog-content .f-discussion-section-list .section-list-item-next::before{position:absolute;left:0;top:50%;width:1px;height:12px;margin-top:-6px;background:#d9d9d9;content:''}.f-discussion-dialog-content .f-discussion-section-list .section-list-item:hover{background:#f3f8ff}.f-discussion-dialog-content .f-discussion-section-list .section-list-item .section-list-item-checkbox.custom-control.custom-checkbox{margin-right:0;padding:0;margin-bottom:0}.f-discussion-dialog-content .f-discussion-section-list .person-list-item{height:auto;padding-top:7px;padding-bottom:6px}.f-discussion-dialog-content .f-discussion-section-list .person-list-item-img{flex-shrink:0;width:36px;height:36px;border-radius:50%;overflow:hidden}.f-discussion-dialog-content .f-discussion-section-list .person-list-item-img img{display:block;width:100%;height:100%}.f-discussion-dialog-content .f-discussion-section-list .person-list-item-content{padding-left:6px}.f-discussion-dialog-content .f-discussion-section-list .person-list-item-content .section-list-item-name{font-size:14px;color:rgba(0,0,0,.85);line-height:20px}.f-discussion-dialog-content .f-discussion-section-list .person-list-item-content .section-list-item-tip{font-size:12px;color:rgba(0,0,0,.35);line-height:20px}.f-discussion-person-list-page{padding:10px 0;text-align:center;cursor:pointer}.f-discussion-person-list-page .section-page-text{font-size:14px;color:rgba(0,0,0,.55)}.f-discussion-person-list-page:hover .section-page-text{color:rgba(0,0,0,.85)}"]}]}],U.ctorParameters=function(){return[{type:y.Renderer2},{type:y.ElementRef},{type:y.ChangeDetectorRef},{type:b.NotifyService},{type:y.Injector},{type:x.HttpClient}]},U.propDecorators={personnelsPrimaryKey:[{type:y.Input}],personnelsDisplayKey:[{type:y.Input}],replyPersonnelsDisplayKey:[{type:y.Input}],cancelVisible:[{type:y.Input}],editHeight:[{type:y.Input}],type:[{type:y.Input}],orgUrl:[{type:y.Input}],personSearchUrl:[{type:y.Input}],treeIdField:[{type:y.Input}],treeDisplayText:[{type:y.Input}],sectionData:[{type:y.Input}],personnels:[{type:y.Input}],replyUser:[{type:y.Input}],attachFiles:[{type:y.Input}],selectionsChange:[{type:y.Output}],lineDataChange:[{type:y.Output}],valueChange:[{type:y.Output}],filePreview:[{type:y.Output}],fileRemove:[{type:y.Output}],fileUploadDone:[{type:y.Output}],personnelSearch:[{type:y.Output}],getOugUsers:[{type:y.Output}],editor:[{type:y.ViewChild,args:["editor"]}],personModal:[{type:y.ViewChild,args:["personModal"]}]},U);function U(e,i,s,t,n,o){this.renderer=e,this.elementRef=i,this.cd=s,this.notifyService=t,this.injector=n,this.http=o,this.personnelsPrimaryKey="id",this.personnelsDisplayKey="name",this.replyPersonnelsDisplayKey="userName",this.cancelVisible=!0,this.editHeight=130,this.type="user",this._personnels=[],this.selectionsChange=new y.EventEmitter,this.lineDataChange=new y.EventEmitter,this.valueChange=new y.EventEmitter,this.filePreview=new y.EventEmitter,this.fileRemove=new y.EventEmitter,this.fileUploadDone=new y.EventEmitter,this.personnelSearch=new y.EventEmitter,this.getOugUsers=new y.EventEmitter,this.textValue="",this.tempPersonnelsValue="",this.tempSectionValue="",this.personModalVisible=!1,this.selectedPersonnels=[],this.selectedSection=[],this.copyPersonnels=[],this.innerPersonnels=[],this.relativeVisible=!1,this.attachFilesModalVisible=!1,this.pageSize=20,this.searchPersonnelList={},this.showSearchList=!1,this.permissionList=[],this.groupIcon='<span class="f-icon f-icon-search"></span>',this.localeService=this.injector.get(p.LocaleService)}var M=(z.prototype.ngOnInit=function(){var i=this;this.allOrg=this.localeService.getValue("discussionGroup.allOrg");var e=this.initSectionData(this.sectionData,""),s=[{data:{id:"discussionParent",code:"parent",name:this.allOrg,layer:0,parentId:"",sortOrder:1,path:""},children:[],personnels:{count:0,pageCount:0,pageIndex:1,pageSize:0,totalCount:0,users:[]},parent:null,parents:[],parentsArr:[],checked:!1}];s[0].children=e,s[0].children.sort(function(e,i){return e.data.sortOrder-i.data.sortOrder}),this.initSectionTree(s[0].children),this.sectionDataTree=s,this.sectionDataTree&&this.sectionDataTree.length&&(this.sectionDataTiled=this.tileSectionData(this.sectionDataTree)),this.currentSection=this.sectionDataTree[0],this.sectionCrumbs=this.sectionDataTree[0].children.length?this.sectionDataTree[0].children[0].parentsArr:[],this.currentSectionData=this.sectionDataTree[0].children.length?this.sectionDataTree[0].children:[],this.currentSectionId=this.sectionDataTree[0].data.id,this.getPersonnel(this.currentSectionId,0).subscribe(function(e){e.hasOwnProperty("users")&&(i.sectionDataTree[0].personnels=e,i.currentSectionPerson=i.sectionDataTree[0].personnels)}),this.selectEmployee=this.localeService.getValue("discussionGroup.selectEmployee"),this.placeholder=this.localeService.getValue("discussionGroup.placeholder")},z.prototype.initSectionTree=function(e,s,t){var n=this;void 0===s&&(s="discussionParent"),void 0===t&&(t=this.allOrg),e&&e.length&&e.forEach(function(e){var i={id:s,name:t};e.parentsArr.unshift(i),e.parents.unshift(s),e.children.length&&n.initSectionTree(e.children)})},z.prototype.initSectionData=function(e,r,a,c,i){void 0===a&&(a="parentId"),void 0===c&&(c="id"),void 0===i&&(i=null);var l=new Map,d=[],u=[];return i&&l.set(i.data.id,i),e&&e.length&&(e.forEach(function(e){var i={data:e,children:[],personnels:{},parent:null,parents:[],parentsArr:[],checked:!1},s=e[c];l.set(s,i);var t=e[a];if(t===r||null===t)d.push(i);else{var n=l.get(t);if(n){var o={id:t,name:n.data.name};i.parent=t,i.parents=E(n.parents,[t]),i.parentsArr=E(n.parentsArr,[o]),n.children.push(i),n.children.sort(function(e,i){return e.data.sortOrder-i.data.sortOrder})}else u.push(i)}}),u.length&&u.forEach(function(e){var i=e.data[a],s=l.get(i);s&&(e.parent=i,e.parents=E(s.parents,[i]),e.parentsArr=E(s.parentsArr,[{id:i,name:s.data.name}]),s.children.push(e),s.children.sort(function(e,i){return e.data.sortOrder-i.data.sortOrder}))})),d},z.prototype.tileSectionData=function(e){var i=[];return this.getAllNodes(e,i),i},z.prototype.getAllNodes=function(e,i){var s=this;e.forEach(function(e){i.push(e),e.children.length&&s.getAllNodes(e.children,i)})},z.prototype.sectionNext=function(t){var n=this;this.showOrHideLoading(!0),r.forkJoin([this.getOrgByLayerHttp(t),this.getPersonByUrlHttp(t)]).subscribe(function(e){n.showOrHideLoading(!1);var i=e[0];!1!==i&&(n.initSectionData(i,"","parentId","id",t),n.sectionDataTiled=n.tileSectionData(n.sectionDataTree));var s=e[1];!1!==s&&(t.personnels={count:0,pageCount:0,pageIndex:1,pageSize:0,totalCount:0,users:[]},s.hasOwnProperty("users")?(t.personnels.count=s.count,t.personnels.pageCount=s.pageCount,t.personnels.pageIndex=s.pageIndex,t.personnels.pageSize=s.pageSize,t.personnels.totalCount=s.totalCount,t.personnels.users=E(t.personnels.users,s.users)):t.noPersonnel=!0),n.getNextData(t)})},z.prototype.getNextData=function(e){var i=this;if(e.children&&e.children.length||"{}"!==JSON.stringify(e.personnels)){var s=this.getSectionById(e.data.id);if(s){var t=s.checked;s.disabled=!!t,s.indeterminate||(s.children&&s.children.length&&s.children.forEach(function(e){e.checked=t,e.indeterminate=!1}),e.personnels.users&&e.personnels.users.length&&e.personnels.users.forEach(function(e){e.checked=t,e.indeterminate=!1}))}var n={id:s.data.id,name:s.data.name},o=E(s.parentsArr,[n]);this.sectionCrumbs=s.children.length?s.children[0].parentsArr:o,this.currentSectionData=s.children.length?s.children:[],this.currentSection=s,this.currentSectionId=s.data.id,this.currentSectionPerson=s.personnels,setTimeout(function(){i.initCrumbsList()},0),this.cd.detectChanges()}else this.currentSectionPerson=[]},z.prototype.getPersonnel=function(e,i,s){if(void 0===s&&(s=this.pageSize),this.orgUrl){var t=""+this.perfixStr+this.orgUrl+"?orgId="+e+"&pageSize="+s+"&pageIndex="+i;return this.http.get(t)}return r.of(!1)},z.prototype.getOrgByLayerHttp=function(e){if(e.data.isDetail||e.children&&0!=e.children.length||!this.urlGetOrgByLayer)return r.of(!1);var i=""+this.perfixStr+this.urlGetOrgByLayer+'?param={"parentId":"'+e.data.id+'"}';return this.http.get(i)},z.prototype.getPersonByUrlHttp=function(e){return"{}"!==JSON.stringify(e.personnels)||e.hasOwnProperty("noPersonnel")?r.of(!1):this.getPersonnel(e.data.id,0)},z.prototype.getSectionById=function(i){return this.sectionDataTiled.find(function(e){return e.data.id==i})},z.prototype.crumbsClick=function(e){var i=this;if(e.id!=this.currentSectionId){var s=this.getSectionById(e.id);this.sectionCrumbs=s.children.length?s.children[0].parentsArr:[],this.currentSectionData=s.children.length?s.children:[],this.currentSectionId=s.data.id,this.currentSectionPerson=s.personnels,this.currentSection=s,setTimeout(function(){i.initCrumbsList()},0)}},z.prototype.handleClick=function(e,s,i){var t=this;if(!this.currentSection.disabled)if(e.stopPropagation(),s.checked=!s.checked,s.indeterminate=!1,this.setSectionDataChecked(),s.checked){var n={parent:this.currentSection,data:s};if("user"==i){if(this._isSelectedInArray(s[this.listIdField],this.listIdField,this.selectedUsers))return;this.selectedUsers.push(n)}else"section"==i&&this.addSection(s)}else"user"==i?this._isSelectedInArray(s[this.listIdField],this.listIdField,this.selectedUsers)&&this.selectedUsers.forEach(function(e,i){e.data[t.listIdField]===s[t.listIdField]&&t.selectedUsers.splice(i,1)}):"section"==i&&this.removeSection(s)},z.prototype.handleSearchClick=function(e,s){var t=this;if(e.stopPropagation(),s.checked=!s.checked,s.checked){if(this._isSelectedInArray(s[this.listIdField],this.listIdField,this.selectedUsers))return;var i={parent:null,data:s};this.selectedUsers.push(i)}else this._isSelectedInArray(s[this.listIdField],this.listIdField,this.selectedUsers)&&this.selectedUsers.forEach(function(e,i){e.data[t.listIdField]===s[t.listIdField]&&t.selectedUsers.splice(i,1)})},z.prototype.setSectionDataChecked=function(){var s=this,e=!1,i=this.currentSection,t=[];if(i.children||i.personnels.users&&i.personnels.users.length){var n=(t=t.concat(i.children,i.personnels.users)).filter(function(e){if(e.hasOwnProperty("checked")&&e.checked)return e}),o=i.children.filter(function(e){if(e.hasOwnProperty("indeterminate")&&e.indeterminate)return e});this.currentSection.indeterminate=!(!o||!o.length),n&&n.length?n.length==t.length&&i.personnels.pageIndex>=i.personnels.pageCount-1?e=!0:this.currentSection.indeterminate=!0:e=!1,this.currentSection.checked=e}0<this.currentSection.parents.length&&this.currentSection.indeterminate&&this.currentSection.parents.forEach(function(e){var i=s.getSectionById(e);i&&(i.indeterminate=s.currentSection.indeterminate)})},z.prototype.setChildDisabledStatus=function(i){void 0===i&&(i=!0);var e=this.currentSection;(e.children||e.personnels.users&&e.personnels.users.length)&&(e.children.forEach(function(e){e.disabled=i}),e.personnels.users.forEach(function(e){e.disabled=i}))},z.prototype.getMoreData=function(){var i=this;if(this.currentSectionId){var s=this.getSectionById(this.currentSectionId);s&&this.getPersonnel(this.currentSectionId,s.personnels.pageIndex+1).subscribe(function(e){e.hasOwnProperty("users")&&(s.personnels.pageIndex=e.pageIndex,s.personnels.users=E(s.personnels.users,e.users),s.personnels.users.length&&s.checked&&s.personnels.users.forEach(function(e){e.checked=s.checked})),i.cd.detectChanges()})}},z.prototype.handleClickAll=function(e){if(!this.currentSection.disabled&&this.currentSection){this.currentSection.checked=!this.currentSection.checked,this.currentSection.indeterminate=!1;var i=this.currentSection.checked;this.currentSection.children.forEach(function(e){e.checked=i}),"{}"!=JSON.stringify(this.currentSection.personnels)&&this.currentSection.personnels.users.length&&this.currentSection.personnels.users.forEach(function(e){e.checked=i}),i?this.addSection(this.currentSection):this.removeSection(this.currentSection)}},z.prototype.addSection=function(e){this._isSelectedInArray(e.data[this.listIdField],this.listIdField,this.selectedSections)||this.selectedSections.push(e)},z.prototype.removeSection=function(s){var t=this;this._isSelectedInArray(s.data[this.listIdField],this.listIdField,this.selectedSections)&&this.selectedSections.forEach(function(e,i){e.data[t.listIdField]===s.data[t.listIdField]&&t.selectedSections.splice(i,1)})},z.prototype.searchUser=function(){this.searchText?(this.showSearchList=!0,this.searchTextChangeSubject.next(this.searchText)):this.showSearchList=!1},z.prototype.clearSearch=function(){this.showSearchList=!1,this.searchText="",this.errorText="",this.recordGetUserSubscribe&&(this.recordGetUserSubscribe.unsubscribe(),this.recordGetUserSubscribe=null),this.showOrHideLoading(!1)},z.prototype.dialogOpend=function(){var i=this;this.showOrHideLoading(!1),this.searchTextChangeSubject=new r.Subject,this.searchTextChangeSubject.pipe(s.debounceTime(200)).subscribe(function(e){i.errorText="",i.showOrHideLoading(!0),i.recordGetUserSubscribe=i.getSearchData(e,0).subscribe(function(e){i.showOrHideLoading(!1),e.hasOwnProperty("users")&&(i.searchUserList=e)},function(e){e&&e.statusText?i.errorText=e.statusText:i.errorText="出现异常",i.showOrHideLoading(!1)})})},z.prototype.getMoreSearchData=function(){var i=this;this.searchText&&this.personSearchUrl&&this.getSearchData(this.searchText,this.searchUserList.pageIndex+1).subscribe(function(e){e.hasOwnProperty("users")&&(i.searchUserList.pageIndex=e.pageIndex,i.searchUserList.users=E(i.searchUserList.users,e.users))})},z.prototype.getSearchData=function(e,i,s){if(void 0===s&&(s=this.pageSize),this.personSearchUrl){var t=""+this.perfixStr+this.personSearchUrl+"?param="+e+"&pageSize="+s+"&pageIndex="+i;return this.http.get(t)}return r.of(!0)},z.prototype.selectionRemove=function(i,e){var n=this;if(i){if("user"==e)0<=(s=this.selectedUsers.findIndex(function(e){return e.data.id==i.data.id}))&&this.selectedUsers.splice(s,1),i.data.checked=!1;else if("section"==e){var s;0<=(s=this.selectedSections.findIndex(function(e){return e.data.id==i.data.id}))&&this.selectedSections.splice(s,1),i.checked=!1}var o=null;if("section"==e?o=this.getSectionById(i.parent):"user"==e&&i.parent&&(o=this.getSectionById(i.parent.data.id)),o&&"user"==e&&-1<this.selectedSections.findIndex(function(e){return e.data.id==o.data.id}))return;if(o&&(o.checked=!1,o.children&&o.children.length||o.personnels.users&&o.personnels.users.length)){var t=o.children.filter(function(e){return e.checked}),r=o.personnels.users.filter(function(e){return e.checked});t&&t.length||r&&r.length?o.indeterminate=!0:o.indeterminate=!1,0<o.parents.length&&o.parents.forEach(function(e){var i=n.getSectionById(e);if(i.children&&i.children.length||i.personnels.users&&i.personnels.users.length){var s=i.children.filter(function(e){return e.checked}),t=i.personnels.users.filter(function(e){return e.checked});s&&s.length||t&&t.length?i.indeterminate=!0:o.indeterminate?i.indeterminate=o.indeterminate:i.indeterminate=!1}})}}},z.prototype.moveAllToLeft=function(){this.selectedUsers.forEach(function(e){e.data.checked=!1}),this.selectedSections.forEach(function(e){e.checked=!1}),this.sectionDataTiled.forEach(function(e){e.indeterminate=!1,e.checked=!1,e.disabled=!1,"{}"!=JSON.stringify(e.personnels)&&e.personnels.users.length&&e.personnels.users.forEach(function(e){e.checked=!1})}),this.selectedUsers=[],this.selectedSections=[],this.cd.markForCheck()},z.prototype.returnResult=function(e){this.finalText="",e?this.selectionsChange.emit({info:"confirm",data:{users:this.selectedUsers,section:this.selectedSections}}):this.selectionsChange.emit({info:"cancel",data:{users:[],section:[]}}),this.moveAllToLeft(),this.searchText="",this.searchUser(),this.personnelDialog.close()},z.prototype.initCrumbsList=function(){var e=this.crumbsList.nativeElement.offsetWidth-30,i=this.crumbsList.nativeElement.children,s=0;if(i&&i.length)for(var t=i.length-1;0<=t;t--)this.renderer.setStyle(i[t],"display","flex"),e<=(s+=i[t].offsetWidth)?this.renderer.setStyle(i[t],"display","none"):this.renderer.setStyle(i[t],"display","flex");this.crumbsEllipsis=e<=s},z.prototype.crumbsMore=function(){this.sectionCrumbs&&this.sectionCrumbs.length&&this.crumbsClick(this.sectionCrumbs[0])},z.prototype._isInArray=function(i,s,e){if(!s||!i)throw new Error("前2个参数必填");return!!e.find(function(e){return i===e[s]})},z.prototype._isSelectedInArray=function(i,s,e){if(!s||!i)throw new Error("前2个参数必填");return!!e.find(function(e){return i===e.data[s]})},z.prototype.closeDialog=function(){this.moveAllToLeft(),this.clearSearch(),this.searchUser()},z.prototype.showOrHideLoading=function(e){this.discussionContent&&this.loadingSer&&(e?this.loadingInstance||(this.loadingInstance=this.loadingSer.show({delay:500,container:this.discussionContent,type:1,message:"全力加载中..."})):this.loadingInstance&&(this.loadingSer.close(this.loadingInstance.id),this.loadingInstance=null))},z.decorators=[{type:y.Component,args:[{selector:"farris-discussion-personnel",template:'<div class="farris-discussion-personnel-wrapper">\r\n    <button class="btn btn-link" (click)="personnelDialog.show()">{{ \'discussionGroup.advancedQuery\' | locale }}</button>\r\n</div>\r\n<ng-template #buttonRef>\r\n    <div class="farris-input-wrap mr-auto f-utils-overflow-hidden" *ngIf="errorText" [title]="errorText">\r\n        <div class="farris-feedback f-state-invalid position-static text-ellipse"\r\n            style=" white-space: nowrap;text-overflow: ellipsis;overflow: hidden;">\r\n            <span class="f-icon f-icon-message_warning f-feedback-icon mr-2"></span>{{errorText}}\r\n        </div>\r\n    </div>\r\n    <button class="btn btn-secondary" (click)="returnResult(0)">{{ \'discussionGroup.cancel\' | locale }}</button>\r\n    <button class="btn btn-primary" (click)="returnResult(1)">{{ \'discussionGroup.confirm\' | locale }}</button>\r\n</ng-template>\r\n<farris-dialog #personnelDialog [buttons]="buttonRef" [width]="690" [height]="520" [resizable]="false" [title]="selectEmployee" (opened)="dialogOpend()" (closed)="closeDialog()">\r\n    <div class="f-discussion-dialog-content" #discussionContent>\r\n        <div class="f-discussion-dialog-content-left col-6 d-flex flex-column">\r\n            <div class="f-discussion-personnel-search">\r\n                <input-group [placeholder]="placeholder" [groupText]="groupIcon" [(ngModel)]="searchText" (clear)="clearSearch()" (valueChange)="searchUser()" (enterHandle)="searchUser()" (clickHandle)="searchUser()"></input-group>\r\n            </div>\r\n            <div class="f-discussion-tab-content f-utils-fill d-flex flex-column" >\r\n                <div class="f-discussion-personnel-content f-utils-fill d-flex flex-column" [ngClass]="{\'f-discussion-personnel-content-hide\': showSearchList}">\r\n                    <div class="f-discussion-personnel-crumbs d-flex">\r\n                        <ul class="crumbs-list d-flex" #crumbsList [ngClass]="{\'crumbs-list-padding\': crumbsEllipsis}" *ngIf="sectionCrumbs && sectionCrumbs.length">\r\n                            <li class="crumbs-list-item" *ngFor="let crumbs of sectionCrumbs;let first = first;let last = last;" (click)="crumbsClick(crumbs)"  \r\n                            [ngClass]="{\'crumbs-list-item-disabled\': !(first || !last)}">\r\n                                \x3c!-- bugNum：449399 --\x3e\r\n                                <span class="crumbs-text" [title]="crumbs.name">{{crumbs.name}}</span>\r\n                                <span class="crumbs-arrow f-icon f-icon-arrow-chevron-right" *ngIf="first || !last"></span>\r\n                            </li>\r\n                        </ul>\r\n                        <div class="crumbs-list-ellipsis crumbs-list-item" *ngIf="crumbsEllipsis" (click)="crumbsMore()">\r\n                            <span class="crumbs-text">...</span>\r\n                            <span class="crumbs-arrow f-icon f-icon-arrow-chevron-right"></span>\r\n                        </div>\r\n                    </div>\r\n                    <div class="f-discussion-section-content f-utils-fill">\r\n                        <perfect-scrollbar>\r\n                            <ul class="f-discussion-section-list">\r\n                                \x3c!-- <li class="section-list-item" *ngIf="currentSectionData.length || currentSectionPerson.users.length" (click)="handleClickAll($event)">\r\n                                    <div class="custom-control custom-checkbox  custom-control-inline section-list-item-checkbox">\r\n                                        <input type="checkbox" class="custom-control-input" [checked]="currentSection.checked" [disabled]="currentSection.disabled" [indeterminate]="currentSection.indeterminate">\r\n                                        <label class="custom-control-label"></label>\r\n                                    </div>\r\n                                    <div class="section-list-item-name f-utils-fill">\r\n                                        全选\r\n                                    </div>\r\n                                </li> --\x3e\r\n                                <li class="section-list-item" *ngFor="let section of currentSectionData">\r\n                                    <div class="custom-control custom-checkbox custom-control-inline section-list-item-checkbox" (click)="handleClick($event,section,\'section\')">\r\n                                        <input type="checkbox" class="custom-control-input" [checked]="section.checked" [indeterminate]="section.indeterminate" [disabled]="currentSection.disabled">\r\n                                        <label class="custom-control-label"></label>\r\n                                    </div>\r\n                                    <div class="section-list-item-name f-utils-fill" [attr.data-orgid]="section.data.id" [title]="section.data.name" (click)="handleClick($event,section,\'section\')">\r\n                                        {{section.data.name}}\r\n                                    </div>\r\n                                    <div class="section-list-item-next" (click)="sectionNext(section)">\r\n                                        {{ \'discussionGroup.next\' | locale }}\r\n                                    </div>\r\n                                </li>\r\n                                <ng-container *ngIf="currentSectionPerson">\r\n                                    <li class="section-list-item person-list-item" *ngFor="let person of currentSectionPerson.users" (click)="handleClick($event,person,\'user\')">\r\n                                        <div class="custom-control custom-checkbox  custom-control-inline section-list-item-checkbox">\r\n                                            <input type="checkbox" class="custom-control-input" [checked]="person.checked" [disabled]="currentSection.disabled">\r\n                                            <label class="custom-control-label"></label>\r\n                                        </div>\r\n                                        <div class="person-list-item-img">\r\n                                            <img [src]="person.imgData" alt="" *ngIf="person.imgData">\r\n                                            <div class="f-discussion-personnel-item-tip" *ngIf="!person.imgData" [innerHTML]="person | avatarHtml"></div>\r\n                                        </div>\r\n                                        <div class="person-list-item-content f-utils-fill">\r\n                                            <div class="section-list-item-name" [title]="person.name">\r\n                                                {{person.name}}\r\n                                            </div>\r\n                                            <div class="section-list-item-tip">\r\n                                                \x3c!-- {{person.email}} --\x3e\r\n                                                <span *ngIf="sectionCrumbs.length>=2">{{sectionCrumbs[sectionCrumbs.length - 2].name}}</span>\r\n                                                <span *ngIf="sectionCrumbs.length>=2">/</span>\r\n                                                <span>{{sectionCrumbs[sectionCrumbs.length - 1].name}}</span>\r\n                                            </div>\r\n                                        </div>\r\n                                        \x3c!-- 人员列表 --\x3e\r\n                                    </li>\r\n                                    <div class="f-discussion-person-list-page" *ngIf="currentSectionPerson[\'users\'] && currentSectionPerson[\'users\'].length">\r\n                                        <span class="section-page-more section-page-text" *ngIf="currentSectionPerson.pageIndex < currentSectionPerson.pageCount-1" (click)="getMoreData()">{{ \'discussionGroup.viewMore\' | locale }}</span>\r\n                                        \x3c!-- <span class="section-page-end section-page-text"  *ngIf="currentSectionPerson.pageIndex >= currentSectionPerson.pageCount-1">加载完成</span> --\x3e\r\n                                    </div>\r\n                                </ng-container>\r\n                            </ul>\r\n                            <div class="f-discussion-section-list-empty" *ngIf="!currentSectionData.length &&(currentSectionPerson.users && !currentSectionPerson.users.length)">\r\n                                <span class="f-icon f-icon-top_my"></span>\r\n                                <span class="section-list-empty-text">{{ \'discussionGroup.emptyList\' | locale }}</span>\r\n                            </div>\r\n                        </perfect-scrollbar>\r\n                    </div>\r\n                </div>\r\n                <div class="f-discussion-personnel-search-list f-utils-fill" [hidden]="!showSearchList">\r\n                    <perfect-scrollbar>\r\n                        <ul class="f-discussion-section-list" *ngIf="searchUserList && searchUserList.users && searchUserList.users.length">\r\n                            <li class="section-list-item person-list-item" *ngFor="let user of searchUserList.users" (click)="handleSearchClick($event,user)">\r\n                                <div class="custom-control custom-checkbox  custom-control-inline section-list-item-checkbox">\r\n                                    <input type="checkbox" class="custom-control-input" [checked]="user.checked">\r\n                                    <label class="custom-control-label"></label>\r\n                                </div>\r\n                                <div class="person-list-item-img">\r\n                                    <img [src]="user.imgData" alt="" *ngIf="user.imgData">\r\n                                    <div class="f-discussion-personnel-item-tip" *ngIf="!user.imgData" [innerHTML]="user | avatarHtml"></div>\r\n                                </div>\r\n                                <div class="person-list-item-content f-utils-fill">\r\n                                    <div class="section-list-item-name" [title]="user.name">\r\n                                        {{user.name}}\r\n                                    </div>\r\n                                    <div class="section-list-item-tip">\r\n                                        <span [innerHTML]="user | getOrgText:sectionData"></span>\r\n                                    </div>\r\n                                </div>\r\n                            </li>\r\n                            <div class="f-discussion-person-list-page">\r\n                                <span class="section-page-more section-page-text" *ngIf="searchUserList.pageIndex < searchUserList.pageCount-1" (click)="getMoreSearchData()">{{ \'discussionGroup.viewMore\' | locale }}</span>\r\n                            </div>\r\n                        </ul>\r\n                        <div class="f-discussion-section-list-empty" *ngIf="!searchUserList.users || !searchUserList.users.length">\r\n                            <span class="f-icon f-icon-top_my"></span>\r\n                            <span class="section-list-empty-text">{{ \'discussionGroup.emptyList\' | locale }}</span>\r\n                        </div>\r\n                    </perfect-scrollbar>\r\n                </div>\r\n            </div>\r\n        </div>\r\n        <div class="f-discussion-dialog-content-right f-utils-fill d-flex flex-column">\r\n            <div class="f-discussion-selected-personnel f-utils-fill d-flex flex-column">\r\n                <div class="f-discussion-selected-personnel-header">\r\n                    <div class="f-discussion-selected-personnel-header-text">\r\n                        <span>{{ \'discussionGroup.selected\' | locale }}</span>(<span>{{ \'discussionGroup.people\' | locale }}</span><span>{{selectedUsers.length}}</span><span>{{ \'discussionGroup.per\' | locale }}</span>，<span>{{ \'discussionGroup.section\' | locale }}</span><span>{{selectedSections.length}}</span><span>{{ \'discussionGroup.pcs\' | locale }}</span>)\r\n                    </div>\r\n                    <div class="f-discussion-selected-personnel-header-btn" (click)="moveAllToLeft()">\r\n                        <button class="btn btn-link">{{ \'discussionGroup.emptySelected\' | locale }}</button>\r\n                    </div>\r\n                </div>\r\n                <div class="f-discussion-selected-personnel-content f-utils-fill d-flex flex-column">\r\n                    <div class="f-discussion-selected-list f-utils-fill">\r\n                        <perfect-scrollbar>\r\n                            <div class="f-discussion-selected-item" *ngFor="let user of selectedUsers">\r\n                                <div class="f-discussion-personnel-item-avatar">\r\n                                    <img [src]="user.data.imgData" alt="" *ngIf="user.data.imgData">\r\n                                    <div class="f-discussion-personnel-item-tip" *ngIf="!user.data.imgData" [innerHTML]="user.data | avatarHtml"></div>\r\n                                </div>\r\n                                <div class="f-discussion-selected-item-text f-utils-fill">\r\n                                    <div class="f-discussion-selected-name">\r\n                                        {{user.data.name}}\r\n                                    </div>\r\n                                    <div class="f-discussion-selected-item-tip" *ngIf="user.parent">\r\n                                        <span *ngIf="user.parent.parentsArr.length>=1">{{user.parent.parentsArr[user.parent.parentsArr.length - 1].name}}</span>\r\n                                            <span *ngIf="user.parent.parentsArr.length>=1">/</span>\r\n                                            <span>{{user.parent.data.name}}</span>\r\n                                    </div>\r\n                                </div>\r\n                                <div class="f-discussion-selected-item-remove" (click)="selectionRemove(user,\'user\')">\r\n                                    <span class="f-icon f-icon-close-outline"></span>\r\n                                </div>\r\n                            </div>\r\n                            <div class="f-discussion-selected-item" *ngFor="let section of selectedSections">\r\n                                <div class="f-discussion-selected-item-text f-utils-fill">\r\n                                    <div class="f-discussion-selected-name">\r\n                                        {{section.data.name}}\r\n                                    </div>\r\n                                </div>\r\n                                <div class="f-discussion-selected-item-remove" (click)="selectionRemove(section,\'section\')">\r\n                                    <span class="f-icon f-icon-close-outline"></span>\r\n                                </div>\r\n                            </div>\r\n                            <div class="f-discussion-section-list-empty" *ngIf="!selectedUsers.length && !selectedSections.length">\r\n                                <span class="f-icon f-icon-top_my"></span>\r\n                                <span class="section-list-empty-text">{{ \'discussionGroup.emptyRight\' | locale }}</span>\r\n                            </div>\r\n                        </perfect-scrollbar>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</farris-dialog>\r\n',styles:[""]}]}],z.ctorParameters=function(){return[{type:y.Renderer2},{type:y.ElementRef},{type:y.NgZone},{type:x.HttpClient},{type:y.ChangeDetectorRef},{type:y.Injector}]},z.propDecorators={listIdField:[{type:y.Input}],listDisplayText:[{type:y.Input}],sectionData:[{type:y.Input}],orgUrl:[{type:y.Input}],personSearchUrl:[{type:y.Input}],urlGetOrgByLayer:[{type:y.Input}],personnelDialog:[{type:y.ViewChild,args:["personnelDialog"]}],selectionsChange:[{type:y.Output}],lineDataChange:[{type:y.Output}],openDialog:[{type:y.Output}],ougUsers:[{type:y.Output}],crumbsList:[{type:y.ViewChild,args:["crumbsList"]}],discussionContent:[{type:y.ViewChild,args:["discussionContent"]}]},z);function z(e,i,s,t,n,o){this.renderer=e,this.elementRef=i,this.ngZone=s,this.http=t,this.cd=n,this.injector=o,this.listIdField="id",this.listDisplayText="userName",this.urlGetOrgByLayer="/api/runtime/sys/v1.0/sysOrgs",this.selectionsChange=new y.EventEmitter,this.lineDataChange=new y.EventEmitter,this.openDialog=new y.EventEmitter,this.ougUsers=new y.EventEmitter,this.loadingInstance=null,this.selections=[],this.selectedSections=[],this.selectedUsers=[],this.finalText="",this.sectionDataTree=[],this.sectionDataTiled=[],this.currentSectionData=[],this.currentSection={},this.currentSectionPerson={},this.currentSectionId="",this.sectionCrumbs=[],this.pageSize=20,this.showSearchList=!1,this.crumbsEllipsis=!1,this.searchUserList={},this.selectEmployee="选择员工",this.placeholder="请输入员工姓名搜索",this.allOrg="全部组织",this.groupIcon='<span class="f-icon f-icon-search"></span>',this.recordGetUserSubscribe=null,this.searchTextChangeSubject=new r.Subject,this.errorText="",this.perfixStr="",this.localeService=this.injector.get(p.LocaleService),this.loadingSer=this.injector.get(u.LoadingService),a.WEBAPI_PREFIX_TOKEN&&(this.perfixStr=this.injector.get(a.WEBAPI_PREFIX_TOKEN,""))}var F=(Object.defineProperty(H.prototype,"discussionListData",{get:function(){return this._discussionListData},set:function(e){e&&(this._discussionListData=e,this.discussionListService.resetData(e))},enumerable:!0,configurable:!0}),H.decorators=[{type:y.Directive,args:[{selector:"[fDiscussionList]"}]}],H.ctorParameters=function(){return[{type:k}]},H.propDecorators={discussionListData:[{type:y.Input}]},H);function H(e){this.discussionListService=e,this._discussionListData=[]}var V=(j.prototype.transform=function(e){return this.sanitized.bypassSecurityTrustHtml(e)},j.decorators=[{type:y.Pipe,args:[{name:"safeHtml"}]}],j.ctorParameters=function(){return[{type:n.DomSanitizer}]},j);function j(e){this.sanitized=e}var A=(G.prototype.transform=function(e){var i=e.name;return i?i.substring(i.length-2,i.length):""},G.decorators=[{type:y.Pipe,args:[{name:"avatarHtml"}]}],G);function G(){}var _=(R.prototype.transform=function(e,i){var s=e.orgId;if(i&&i.length){var t=i.find(function(e){return e.id==s}),n="";if(t)if(""!=t.parentId){var o=i.find(function(e){return e.id==t.parentId});n=o?o.name+"/"+t.name:t.name}else n=t.name;return n}return""},R.decorators=[{type:y.Pipe,args:[{name:"getOrgText"}]}],R);function R(){}var K=(N.decorators=[{type:y.NgModule,args:[{declarations:[O,P,M,V,A,_,F],imports:[i.CommonModule,t.FormsModule,d.ModalModule,o.FarrisDialogModule,a.FarrisCommonModule,u.LoadingModule.forRoot(),g.PerfectScrollbarModule,l.TreeModule,m.PaginationModule,b.NotifyModule,x.HttpClientModule,c.DateHelperModule.forRoot(),p.LocaleModule.forRoot(),v.InputGroupModule],providers:[d.BsModalService,f.ComponentLoaderFactory,h.PositioningService,k],exports:[O,P,M,V,A,_,F],entryComponents:[M]}]}],N);function N(){}e.DiscussionGroupService=w,e.DiscussionListComponent=P,e.DiscussionEditorComponent=O,e.MsgInfo=T,e.DiscussionPersonnelComponent=M,e.DiscussionListDirective=F,e.DiscussionListService=k,e.DiscussionGroupModule=K,e.SafeHtmlPipe=V,e.AvatarHtmlPipe=A,e.GetOrgTextPipe=_,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=farris-discussion-group.umd.min.js.map
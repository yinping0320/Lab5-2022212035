{"version":3,"file":"farris-ui-edit-table.js.map","sources":["ng://@farris/ui-edit-table/lib/edit-table.service.ts","ng://@farris/ui-edit-table/lib/edit-table.component.ts","ng://@farris/ui-edit-table/lib/edit-table-editortype.pipe.ts","ng://@farris/ui-edit-table/lib/edit-table.module.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class EditTableService {\n\n  constructor() { }\n}\n","import { ChangeDetectorRef, Component, EventEmitter, Injector, Input, OnInit, Output } from \"@angular/core\";\nimport { IdService } from \"@farris/ui-common\";\nimport { MessagerService } from \"@farris/ui-messager\";\nimport { NotifyService } from \"@farris/ui-notify\";\n\nimport { EditTableColumn } from \"./edit-table.types\";\n\n@Component({\n    selector: \"farris-edit-table\",\n    templateUrl: './edit-table.component.html',\n    styles: [],\n})\nexport class EditTableComponent implements OnInit {\n\n    @Input() columns: Array<EditTableColumn>;\n    @Input() data = [];\n\n    @Input() selectId = '';\n\n    /** è¡æ°æ®æ è¯å­æ®µ */\n    @Input() idField = '_id';\n\n    @Output() dataChange = new EventEmitter();\n\n    private selectedItem: { index: number, data: any } = null;\n\n    constructor(private injector: Injector, private idSer: IdService, private cdr: ChangeDetectorRef, private msgSer: MessagerService, private notifySer: NotifyService) {}\n\n    ngOnInit() {}\n\n\n    private dataChanged() {\n        this.dataChange.emit(this.data);\n    }\n\n\n    private createNewData() {\n        return this.columns.reduce((p, n) => {\n            if (n.field.indexOf('.') > -1) {\n                p = Object.assign(p, n.defaultValue);\n            } else {\n                p[n.field] = n.defaultValue || null;\n            }\n\n            return p;\n        }, {_id: this.idSer.guid() })\n    }\n\n    /** æå¥æ°è¡ */\n    insertRow(index: number, $event?: MouseEvent) {\n        if ($event) {\n            $event.stopPropagation();\n        }\n        const newItem = this.createNewData();\n        const _newItem = Object.assign({}, newItem);\n        \n        this.data.splice(index + 1, 0, _newItem);\n        this.dataChanged();\n    }\n\n    /** æ°å¢è¡ */\n    appendNew($event: MouseEvent) {\n        $event.stopPropagation();\n        const newItem = this.createNewData();\n        this.data = [...this.data, newItem];\n        this.dataChanged();\n    }\n\n    /** éä¸­è¡ */\n    selectRow($event: MouseEvent, rowData, index) {\n        if ($event) {\n            $event.stopPropagation();\n        }\n        this.selectId = rowData[this.idField];\n        this.selectedItem  = {\n            data: rowData,\n            index\n        };\n    }\n\n    deleteRow($event: MouseEvent, index) {\n        if ($event) {\n            $event.stopPropagation();\n        }\n        this.data.splice(index, 1);\n        this.dataChanged();\n\n        if (this.selectedItem) {\n            if (index === this.selectedItem.index) {\n                \n                if ( this.data[index] ) {\n                    this.selectedItem = { index: index, data: this.data[index] };\n                } else {\n                    if ( this.data[index - 1] ) {\n                        this.selectedItem = { index: index - 1, data: this.data[index - 1] };\n                    } else {\n                        this.selectedItem = null;\n                    }\n                }\n            } else {\n                if (!this.data[this.selectedItem.index]) {\n                    if (this.selectedItem.index > index) {\n                        this.selectedItem.index = this.selectedItem.index - 1;\n                    } else {\n                        this.selectedItem.index = this.selectedItem.index + 1 ;\n                    }\n                }\n            }\n\n            this.cdr.detectChanges();\n        }\n    }\n\n    clear($event) {\n        this.msgSer.question('ç¡®è®¤è¦æ¸ç©ºå½åæææ¡ä»¶åï¼', () => {\n            this.data = [];\n            this.selectedItem = null;\n            this.selectId = '';\n            this.dataChanged();\n        });\n    }\n\n    moveRow($event, action: 'top'|'bottom'|'up'|'down') {\n        if ($event) {\n            $event.stopPropagation();\n        }\n\n        if (!this.selectedItem) {\n            this.notifySer.warning('è¯·éæ©è¦ç§»å¨çè¡');\n            return;\n        }\n\n        const index = this.selectedItem.index;\n        let tempArr = [];\n        switch(action) {\n            case 'top': \n                this.data.unshift(this.selectedItem.data);\n                this.data.splice(index + 1, 1);\n                this.selectedItem.index = 0;\n                break;\n            case 'bottom':\n                this.data.push(this.selectedItem.data);\n                this.data.splice(index, 1);\n                this.selectedItem.index = this.data.length - 1;\n                break;\n            case 'up':\n                tempArr = this.data.splice(index, 1);\n                this.data.splice(index - 1, 0, ...tempArr);\n                this.selectedItem.index = index - 1;\n                break;\n            case 'down':\n                tempArr = this.data.splice(index, 1);\n                this.data.splice(index + 1, 0, ...tempArr);\n                this.selectedItem.index = index + 1;\n                break;\n        }\n\n        this.dataChanged();  \n    }\n\n    onComboLookupValueChange($event, ctx) {\n        if (ctx && ctx.options && ctx.options.valueChange) {\n            const {rowData, field}  = ctx;\n            ctx.options.valueChange({...$event, data: rowData, field});\n        }\n    }\n}\n","import { Pipe, PipeTransform } from '@angular/core';\r\n\r\n@Pipe({\r\n    name: 'editortype'\r\n})\r\nexport class EditTableEditorTypePipe implements PipeTransform {\r\n    transform(data: any, ...args: any[]): any {\r\n        const col = args[0];\r\n        if (col.editor) {\r\n            return col.editor.type || 'text';\r\n        }\r\n\r\n        if (data) {\r\n            if (data.$editors) {\r\n                if (col && data.$editors[col.field]) {\r\n                    return data.$editors[col.field].type || 'text';\r\n                }\r\n                return 'text';\r\n            }\r\n            return 'text';\r\n        }\r\n\r\n        return null;\r\n    }\r\n}\r\n\r\n\r\n@Pipe({\r\n    name: 'editoropts'\r\n})\r\nexport class EditTableEditorOptionsPipe implements PipeTransform {\r\n    transform(data: any, ...args: any[]): any {\r\n        const col = args[0];\r\n        if (col.editor) {\r\n            return col.editor.options || null;\r\n        }\r\n\r\n        if (data) {\r\n            if (data.$editors) {\r\n                if (col) {\r\n                    return data.$editors[col.field] ? data.$editors[col.field].options : null;;\r\n                }\r\n                return null;\r\n            }\r\n            return null;\r\n        }\r\n\r\n        return null;\r\n    }\r\n}\r\n","import { CommonModule } from '@angular/common';\nimport { NgModule } from '@angular/core';\nimport { ComboListModule } from '@farris/ui-combo-list';\nimport { ComboLookupModule } from '@farris/ui-combo-lookup';\nimport { FarrisCommonModule } from '@farris/ui-common';\nimport { FarrisDatePickerModule } from '@farris/ui-datepicker';\nimport { InputGroupModule } from '@farris/ui-input-group';\nimport { LookupModule } from '@farris/ui-lookup';\nimport { MessagerModule } from '@farris/ui-messager';\nimport { ModalModule } from '@farris/ui-modal';\nimport { NotifyModule } from '@farris/ui-notify';\nimport { NumberSpinnerModule } from '@farris/ui-number-spinner';\nimport { SwitchModule } from '@farris/ui-switch';\nimport { TimePickerModule } from '@farris/ui-time-picker';\nimport { EditTableEditorOptionsPipe, EditTableEditorTypePipe } from './edit-table-editortype.pipe';\nimport { EditTableComponent } from './edit-table.component';\n\n@NgModule({\n  declarations: [\n    EditTableComponent,\n    EditTableEditorTypePipe,\n    EditTableEditorOptionsPipe\n  ],\n  imports: [\n    CommonModule,\n    FarrisCommonModule.forRoot(),\n    MessagerModule.forRoot(),\n    ComboListModule,\n    ComboLookupModule,\n    LookupModule,\n    InputGroupModule,\n    ModalModule,\n    FarrisDatePickerModule,\n    NumberSpinnerModule,\n    TimePickerModule,\n    SwitchModule,\n    NotifyModule.forRoot()\n  ],\n  exports: [EditTableComponent, EditTableEditorTypePipe, EditTableEditorOptionsPipe]\n})\nexport class EditTableModule { }\n"],"names":[],"mappings":"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"}

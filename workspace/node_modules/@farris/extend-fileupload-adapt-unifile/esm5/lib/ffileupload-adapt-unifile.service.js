/**
 * @fileoverview added by tsickle
 * Generated from: lib/ffileupload-adapt-unifile.service.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Injectable, Injector, Optional } from "@angular/core";
import { UploadServerService, UploadStatus, } from "@farris/extend-file-upload";
import { Observable, forkJoin, of, EMPTY, concat, Subject } from "rxjs";
import { UploadService, GspFormUploadListEntity, GspFormRemoveListEntity, GspFormDocInfo, GspFormUploadEntity, OperatingModes, } from "@gsp-svc/formdoc-upload";
import { FFileUploadAdaptUnifileConfigService, } from "./ffileupload-adapt-unifile.config";
import { catchError, delay, expand, last, map, switchMap, tap, } from "rxjs/operators";
import { LocaleService } from "@farris/ui-locale";
import * as i0 from "@angular/core";
import * as i1 from "@gsp-svc/formdoc-upload";
import * as i2 from "./ffileupload-adapt-unifile.config";
/**
 * @record
 */
export function UploadServerConfig() { }
if (false) {
    /** @type {?} */
    UploadServerConfig.prototype.sameNameAllowed;
    /** @type {?} */
    UploadServerConfig.prototype.maxFileSize;
    /** @type {?} */
    UploadServerConfig.prototype.allowedMultiUpload;
    /** @type {?|undefined} */
    UploadServerConfig.prototype.uploadedFileInfoList;
    /** @type {?|undefined} */
    UploadServerConfig.prototype.oldUploadedFileList;
}
var FfileuploadAdaptUnifileService = /** @class */ (function (_super) {
    tslib_1.__extends(FfileuploadAdaptUnifileService, _super);
    function FfileuploadAdaptUnifileService(uploadSer, configSer, inject) {
        var _this = _super.call(this) || this;
        _this.uploadSer = uploadSer;
        _this.configSer = configSer;
        _this.inject = inject;
        // 暂时用于简单合并
        _this.bufferSize = 1024 * 1024;
        _this.uploadedChunk = {};
        _this.fileTotalChunk = {};
        _this.serverConfig = null;
        _this.extendData = _this.configSer.getConfig();
        // 开始创建多语言服务
        /** @type {?} */
        var hasLocalSer = _this.configSer.setLocalState(null);
        if (_this.inject && !hasLocalSer) {
            // 如果存在inject，再次创建，inject是在某个版不能之后才出现的
            _this.configSer.setLocalState(_this.inject.get(LocaleService, null));
        }
        return _this;
    }
    /**
     * 因为被附件组件作为依赖类，导致此处获取不到最新的基路径值
     * @returns
     */
    /**
     * 因为被附件组件作为依赖类，导致此处获取不到最新的基路径值
     * @private
     * @return {?}
     */
    FfileuploadAdaptUnifileService.prototype.getPrefixStr = /**
     * 因为被附件组件作为依赖类，导致此处获取不到最新的基路径值
     * @private
     * @return {?}
     */
    function () {
        return this.configSer.getBasePath();
    };
    /**
     * @private
     * @return {?}
     */
    FfileuploadAdaptUnifileService.prototype.uuid = /**
     * @private
     * @return {?}
     */
    function () {
        /** @type {?} */
        var S4 = (/**
         * @return {?}
         */
        function () {
            return (((1 + Math.random()) * 0x10000) | 0).toString(16).substring(1);
        });
        /** @type {?} */
        var nGuid = S4() + S4() + '-' + S4() + '-' + S4() + '-' + S4() + '-' + S4() + S4() + S4();
        return nGuid;
    };
    /**
     * 删除文件
     * @param file
     * @param event
     */
    /**
     * 删除文件
     * @param {?} files
     * @param {?} event
     * @param {?} extendService
     * @return {?}
     */
    FfileuploadAdaptUnifileService.prototype.remove = /**
     * 删除文件
     * @param {?} files
     * @param {?} event
     * @param {?} extendService
     * @return {?}
     */
    function (files, event, extendService) {
        return this.innerRemoveList(files, event, extendService);
    };
    /**
     * @private
     * @param {?} files
     * @param {?} event
     * @param {?=} extendService
     * @return {?}
     */
    FfileuploadAdaptUnifileService.prototype.innerRemoveList = /**
     * @private
     * @param {?} files
     * @param {?} event
     * @param {?=} extendService
     * @return {?}
     */
    function (files, event, extendService) {
        var _this = this;
        if (extendService === void 0) { extendService = null; }
        return new Observable((/**
         * @param {?} observer
         * @return {?}
         */
        function (observer) {
            /** @type {?} */
            var removeFileInfo = new GspFormRemoveListEntity();
            /** @type {?} */
            var metadataIdList = [];
            files.forEach((/**
             * @param {?} fileItem
             * @return {?}
             */
            function (fileItem) {
                if (fileItem["response"]) {
                    metadataIdList.push(fileItem["response"]["metadataId"]);
                }
            }));
            removeFileInfo.mode = _this.getFinallyConfig("mode", extendService);
            /** @type {?} */
            var rootId = _this.getFinallyConfig("rootId", extendService);
            removeFileInfo.metadataIdList = [].concat(metadataIdList);
            _this.uploadSer.removeList(metadataIdList, rootId).subscribe((/**
             * @param {?} result
             * @return {?}
             */
            function (result) {
                // 没有需要整合的服务器端返回数据
                observer.next({ type: "removed", files: files });
            }), (/**
             * @param {?} error
             * @return {?}
             */
            function (error) {
                observer.error(error);
                observer.complete();
            }), (/**
             * @return {?}
             */
            function () {
                observer.complete();
            }));
        }));
    };
    /**
     * 上传文件
     * @param file
     * @param event
     */
    /**
     * 上传文件
     * @param {?} files
     * @param {?} event
     * @param {?} extendService
     * @return {?}
     */
    FfileuploadAdaptUnifileService.prototype.upload = /**
     * 上传文件
     * @param {?} files
     * @param {?} event
     * @param {?} extendService
     * @return {?}
     */
    function (files, event, extendService) {
        var _this = this;
        this.formId = this.getFinallyConfig("formId", extendService);
        this.rootId = this.getFinallyConfig("rootId", extendService);
        if (event.type == "sliceUpload") {
            /** @type {?} */
            var up$_1 = (/**
             * @return {?}
             */
            function () {
                if (_this.serverConfig && _this.serverConfig.allowedMultiUpload) {
                    if (!_this.serverConfig.sameNameAllowed) {
                        return _this.uploadSer.getUploadedFileInfoList(_this.formId, _this.rootId).pipe(switchMap((/**
                         * @param {?} res
                         * @return {?}
                         */
                        function (res) {
                            if (res != null && res.error == null) {
                                _this.serverConfig.uploadedFileInfoList = res;
                                _this.serverConfig.oldUploadedFileList = JSON.parse(JSON.stringify(res));
                                return _this.uploadBigFile2(files, event, extendService);
                            }
                            return of(res);
                        })));
                    }
                    else {
                        return _this.uploadBigFile2(files, event, extendService);
                    }
                }
                else {
                    return _this.uploadBigFile(files, event, extendService);
                }
            });
            if (!this.serverConfig) {
                return this.getServerConfig(this.rootId).pipe(switchMap((/**
                 * @param {?} res
                 * @return {?}
                 */
                function (res) {
                    if (res != null && res.error == null) {
                        _this.serverConfig = {
                            sameNameAllowed: res.sameNameAllowed,
                            allowedMultiUpload: res.allowedMultiUpload,
                            maxFileSize: parseInt(JSON.parse(res.validateConfiguration).maxFileSize)
                        };
                    }
                    return up$_1();
                })));
            }
            return up$_1();
        }
        return this.innerUploadList(files, event, extendService);
    };
    /**
     * 内部上传方式
     * @param files
     * @param event
     * @param extendService
     */
    /**
     * 内部上传方式
     * @private
     * @param {?} files
     * @param {?} event
     * @param {?} extendService
     * @return {?}
     */
    FfileuploadAdaptUnifileService.prototype.innerUploadList = /**
     * 内部上传方式
     * @private
     * @param {?} files
     * @param {?} event
     * @param {?} extendService
     * @return {?}
     */
    function (files, event, extendService) {
        var _this = this;
        return new Observable((/**
         * @param {?} observer
         * @return {?}
         */
        function (observer) {
            /** @type {?} */
            var uploadInfo = new GspFormUploadListEntity();
            uploadInfo.formId = _this.getFinallyConfig("formId", extendService);
            uploadInfo.mode = _this.getFinallyConfig("mode", extendService);
            /** @type {?} */
            var rootId = _this.getFinallyConfig("rootId", extendService);
            uploadInfo.docInfoList = [];
            /** @type {?} */
            var readerObserable = [];
            files.forEach((/**
             * @param {?} fileItem
             * @return {?}
             */
            function (fileItem) {
                /** @type {?} */
                var sub = new Observable((/**
                 * @param {?} obser
                 * @return {?}
                 */
                function (obser) {
                    /** @type {?} */
                    var reader = new FileReader();
                    // 暂不处理异常
                    reader.readAsBinaryString(fileItem.nativeFile);
                    reader.onload = (/**
                     * @param {?} e
                     * @return {?}
                     */
                    function (e) {
                        /** @type {?} */
                        var info = (/** @type {?} */ ({ fileName: "", fileContent: "" }));
                        info["fileName"] = fileItem.name;
                        info["fileContent"] = btoa(reader.result.toString());
                        // 如果data里有数据，并且属性是配置的扩展属性
                        if (event.hasOwnProperty("data") &&
                            event["data"] &&
                            event["data"].hasOwnProperty("extProperty")) {
                            //
                            info["extProperty"] = event["data"]["extProperty"];
                        }
                        uploadInfo.docInfoList.push(info);
                        obser.next();
                        obser.complete();
                    });
                }));
                readerObserable.push(sub);
            }));
            forkJoin(readerObserable).subscribe((/**
             * @param {?} datas
             * @return {?}
             */
            function (datas) {
                //     metadataId: string;
                //  fileName: string;
                _this.uploadSer.uploadList(uploadInfo, rootId).subscribe((/**
                 * @param {?} result
                 * @return {?}
                 */
                function (result) {
                    if (result.error) {
                        // 此接口一旦出现问题，所有附件都上传不通过
                        observer.error(_this.errorInfoFormat(result.error, files));
                        observer.complete();
                        return;
                    }
                    // 合并返回结果到此处
                    result.forEach((/**
                     * @param {?} item
                     * @return {?}
                     */
                    function (item) {
                        /** @type {?} */
                        var findIndex = _this.findFileIndexByFileName(files, item.fileName);
                        if (findIndex > -1) {
                            files[findIndex]["response"] = item;
                            files[findIndex]["progress"]["status"] = UploadStatus.Done;
                        }
                    }));
                    observer.next({ type: "done", files: files });
                }), (/**
                 * @param {?} error
                 * @return {?}
                 */
                function (error) {
                    observer.error(_this.errorInfoFormat(error, files));
                    observer.complete();
                }), (/**
                 * @return {?}
                 */
                function () {
                    observer.complete();
                }));
            }));
        }));
    };
    /**
     * 分片加载
     * @param file
     * @param event
     * @param extendService
     */
    /**
     * 分片加载
     * @param {?} file
     * @param {?} event
     * @param {?} extendService
     * @return {?}
     */
    FfileuploadAdaptUnifileService.prototype.multipartUpload = /**
     * 分片加载
     * @param {?} file
     * @param {?} event
     * @param {?} extendService
     * @return {?}
     */
    function (file, event, extendService) {
        var _this = this;
        return new Observable((/**
         * @param {?} observer
         * @return {?}
         */
        function (observer) {
            // let fileInfo: FileInfo;
            /** @type {?} */
            var uuid = _this.uuid();
            // let uuid = UUID.UUID();
            //reader.readAsBinaryString(selectedFile);
            //reader.onload = (e) => {
            /** @type {?} */
            var fileName = file.name;
            // fileInfo = {
            //   id: uuid,
            //   name: fileName,
            //   type: file.type,
            //   source: "",
            //   size: this.formatFileSize(file.size),
            //   fileSize: file.size,
            //   picListDisplayName: this.getMultipartDisplayName(fileName),
            //   queueListDisplayName: fileName,
            //   //content: reader.result.toString(),
            //   hasUploaded: false,
            //   mouseOn: false,
            //   selectd: false,
            //   isUploading: true,
            //   uploadResult: false,
            //   uploadProcess: 0,
            //   errorMessage: "",
            //   extensionDropListId: 0,
            //   extensionName: ""
            // }
            /** @type {?} */
            var chunkTotal = Math.ceil(file.size / _this.bufferSize);
            // 标记当前附件总的分片数
            _this.fileTotalChunk[uuid] = chunkTotal;
            /** @type {?} */
            var chunkIndex = 0;
            // 标记当前附件成功的分片数
            _this.uploadedChunk[uuid] = 0;
            var _loop_1 = function () {
                /** @type {?} */
                var uploadInfo = new GspFormUploadEntity();
                uploadInfo.mode = OperatingModes.Temp;
                uploadInfo.formId = _this.getFinallyConfig("formId", extendService);
                uploadInfo.rootId = _this.getFinallyConfig("rootId", extendService);
                /** @type {?} */
                var docInfo = new GspFormDocInfo();
                docInfo.fileName = fileName;
                docInfo.metadataId = uuid;
                docInfo.total = chunkTotal;
                // 如果data里有数据，并且属性是配置的扩展属性
                if (event.hasOwnProperty("data") &&
                    event["data"] &&
                    event["data"].hasOwnProperty("extProperty")) {
                    docInfo["extProperty"] = (/** @type {?} */ (event["data"]["extProperty"]));
                }
                // 下一个文件大小
                /** @type {?} */
                var nextSize = Math.min((chunkIndex + 1) * _this.bufferSize, file.size);
                // File类型
                /** @type {?} */
                var fileData = file["nativeFile"].slice(chunkIndex * _this.bufferSize, nextSize);
                // 读取文件
                /** @type {?} */
                var reader = new FileReader();
                reader.readAsBinaryString(fileData);
                /** @type {?} */
                var innerIndex = chunkIndex;
                reader.onload = (/**
                 * @return {?}
                 */
                function () {
                    // 附件上传
                    docInfo.fileContent = btoa(reader.result.toString());
                    docInfo.index = innerIndex;
                    uploadInfo.docInfo = docInfo;
                    /** @type {?} */
                    var info = uploadInfo;
                    _this.uploadSer.uploadFile(info).subscribe((/**
                     * @param {?} result
                     * @return {?}
                     */
                    function (result) {
                        if (result && result.error) {
                            // 分片上传有返回结果就是报错了
                            observer.error(_this.errorInfoFormat(result.error, [file]));
                            observer.complete();
                            return;
                        }
                        else {
                            _this.uploadedChunk[uuid]++;
                            if (_this.uploadedChunk[docInfo.metadataId] ==
                                _this.fileTotalChunk[docInfo.metadataId]) {
                                // 判断是所有分片都上传完成
                                file.progress = {
                                    status: UploadStatus.Done,
                                    data: {
                                        percentage: 100,
                                    },
                                };
                                file.response = docInfo;
                                delete _this.uploadedChunk[uuid];
                                delete _this.fileTotalChunk[uuid];
                                observer.next({ type: "done", files: [file] });
                                observer.complete();
                            }
                            else {
                                // 分片上传正常
                                /** @type {?} */
                                var percentage = Number.parseInt(((_this.uploadedChunk[uuid] / _this.fileTotalChunk[uuid]) *
                                    100).toFixed(0));
                                // 判断未上传完成
                                file.progress = {
                                    status: UploadStatus.Uploading,
                                    data: {
                                        percentage: percentage,
                                    },
                                };
                                observer.next({ type: "uploading", files: [file] });
                            }
                        }
                    }), (/**
                     * @param {?} error
                     * @return {?}
                     */
                    function (error) {
                        delete _this.uploadedChunk[uuid];
                        delete _this.fileTotalChunk[uuid];
                        observer.error(_this.errorInfoFormat(error, [file]));
                        observer.complete();
                    }));
                });
                chunkIndex = chunkIndex + 1;
            };
            while (chunkIndex < chunkTotal) {
                _loop_1();
            }
        }));
    };
    /**
     * 获取分片的附件大小
     * @param size
     */
    /**
     * 获取分片的附件大小
     * @private
     * @param {?} size
     * @return {?}
     */
    FfileuploadAdaptUnifileService.prototype.formatFileSize = /**
     * 获取分片的附件大小
     * @private
     * @param {?} size
     * @return {?}
     */
    function (size) {
        if (size < 102400)
            return (size / 1024).toFixed(1) + "K";
        else if (size < 1024 * 1024)
            return (size / 1024).toFixed(0) + "K";
        else if (size < 100 * 1024 * 1024)
            return (size / 1024 / 1024).toFixed(1) + "M";
        else if (size < 1024 * 1024 * 1024)
            return (size / 1024 / 1024).toFixed(0) + "M";
        else
            return (size / 1024 / 1024 / 1024).toFixed(1) + "G";
    };
    /**
     * 获取分片的 附件名称
     * @param fileName
     */
    /**
     * 获取分片的 附件名称
     * @private
     * @param {?} fileName
     * @return {?}
     */
    FfileuploadAdaptUnifileService.prototype.getMultipartDisplayName = /**
     * 获取分片的 附件名称
     * @private
     * @param {?} fileName
     * @return {?}
     */
    function (fileName) {
        if (fileName.length <= 10)
            return fileName;
        else {
            /** @type {?} */
            var headContent = fileName.substring(0, 2);
            /** @type {?} */
            var tailContent = fileName.substring(fileName.lastIndexOf(".") - 2);
            return headContent + "…" + tailContent;
        }
    };
    /**
     * @private
     * @param {?} error
     * @param {?} files
     * @return {?}
     */
    FfileuploadAdaptUnifileService.prototype.errorInfoFormat = /**
     * @private
     * @param {?} error
     * @param {?} files
     * @return {?}
     */
    function (error, files) {
        //
        /** @type {?} */
        var errorFiles = files.map((/**
         * @param {?} item
         * @return {?}
         */
        function (item) {
            return { id: item.id, name: item.name };
        }));
        /** @type {?} */
        var errorMsg = this.configSer.getLocalStr('uploadAdapt.uploadError');
        if (error) {
            return Object.assign(error, { files: errorFiles }, {
                message: error["Message"] || error["extensionMessage"] || errorMsg,
                type: "error",
            });
        }
        else {
            return Object.assign({ files: errorFiles }, { message: errorMsg, type: "error" });
        }
    };
    /**
     * 返回最终属性值
     * @param key
     * @param configValue
     * @param extendValue
     */
    /**
     * 返回最终属性值
     * @private
     * @param {?} key
     * @param {?} extendValue
     * @return {?}
     */
    FfileuploadAdaptUnifileService.prototype.getFinallyConfig = /**
     * 返回最终属性值
     * @private
     * @param {?} key
     * @param {?} extendValue
     * @return {?}
     */
    function (key, extendValue) {
        if (extendValue && extendValue.hasOwnProperty(key)) {
            return extendValue[key];
        }
        return this.extendData[key];
    };
    /**
     * @private
     * @param {?} files
     * @param {?} fileName
     * @return {?}
     */
    FfileuploadAdaptUnifileService.prototype.findFileIndexByFileName = /**
     * @private
     * @param {?} files
     * @param {?} fileName
     * @return {?}
     */
    function (files, fileName) {
        // 按照肯定能找到文件来处理
        /** @type {?} */
        var findIndex = files.findIndex((/**
         * @param {?} file
         * @return {?}
         */
        function (file) { return file.name == fileName; }));
        return findIndex;
    };
    //#region 大文件分片上传
    //#region 大文件分片上传
    /**
     * @param {?} files
     * @param {?} event
     * @param {?} extendService
     * @return {?}
     */
    FfileuploadAdaptUnifileService.prototype.uploadBigFile = 
    //#region 大文件分片上传
    /**
     * @param {?} files
     * @param {?} event
     * @param {?} extendService
     * @return {?}
     */
    function (files, event, extendService) {
        var _this = this;
        /** @type {?} */
        var uploadChunks$ = new Subject();
        /** @type {?} */
        var _files = files.map((/**
         * @param {?} n
         * @return {?}
         */
        function (n) {
            /** @type {?} */
            var chunks = _this._getBigFileChunks(n, event, extendService);
            return tslib_1.__assign({}, n, chunks);
        }));
        /** @type {?} */
        var uploadchunks$ = _files.map((/**
         * @param {?} f
         * @return {?}
         */
        function (f) {
            return _this.uploadChunks(f, uploadChunks$);
        }));
        concat.apply(void 0, tslib_1.__spread(uploadchunks$)).subscribe((/**
         * @param {?} f
         * @return {?}
         */
        function (f) {
            f.progress = {
                status: UploadStatus.Done,
                data: {
                    percentage: 100,
                },
            };
            f.response = JSON.parse(f.chunks[0].get("docInfo"));
            uploadChunks$.next({ type: "done", files: [f] });
        }), (/**
         * @param {?} error
         * @return {?}
         */
        function (error) {
            uploadChunks$.error(_this.errorInfoFormat(error, files));
            uploadChunks$.complete();
        }), (/**
         * @return {?}
         */
        function () {
            uploadChunks$.complete();
        }));
        return uploadChunks$.asObservable();
    };
    /**
     * @private
     * @param {?} file
     * @return {?}
     */
    FfileuploadAdaptUnifileService.prototype.uploadFileChunk = /**
     * @private
     * @param {?} file
     * @return {?}
     */
    function (file) {
        /** @type {?} */
        var url = this.getPrefixStr() + "/api/runtime/dfs/v1.0/formdoc/slice";
        return this.uploadSer["http"]["http"]
            .post(url, file.chunks[file.total])
            .pipe(switchMap((/**
         * @return {?}
         */
        function () {
            return of(file);
        })), catchError((/**
         * @param {?} error
         * @return {?}
         */
        function (error) {
            return of(error);
        })));
    };
    /**
     * @private
     * @param {?} file
     * @param {?} upChunk$
     * @return {?}
     */
    FfileuploadAdaptUnifileService.prototype.uploadChunks = /**
     * @private
     * @param {?} file
     * @param {?} upChunk$
     * @return {?}
     */
    function (file, upChunk$) {
        var _this = this;
        /** @type {?} */
        var doChunksRemain = (/**
         * @param {?} i
         * @return {?}
         */
        function (i) { return i > -1; });
        /** @type {?} */
        var completeUpload = (/**
         * @param {?} f
         * @return {?}
         */
        function (f) { return of(f); });
        /** @type {?} */
        var uploadChunk = (/**
         * @param {?} f
         * @return {?}
         */
        function (f) {
            return _this.uploadFileChunk(f).pipe(delay(100), map((/**
             * @param {?} f
             * @return {?}
             */
            function (f) {
                // 块数为0 时，即为此文件的所有块均上传成功
                f.progress = {
                    status: UploadStatus.Uploading,
                    data: {
                        percentage: ((f.total / f.chunks.length) * 100).toFixed(0),
                    },
                };
                upChunk$.next({ type: "uploading", files: [f] });
                return f;
            })));
        });
        /** @type {?} */
        var createMultipartUpload = (/**
         * @param {?} f
         * @return {?}
         */
        function (f) { return of(f); });
        return createMultipartUpload(file).pipe(
        // tap((f) => console.log("upload file", f.name)),
        expand((/**
         * @param {?} f
         * @return {?}
         */
        function (f) {
            if (doChunksRemain(--file.total)) {
                return uploadChunk(file);
            }
            return EMPTY;
        })), 
        // tap((f: any) => {
        //     console.log(`file: ${f.name} - remaining chunks: ${f.total}`);
        // }),
        last(), switchMap((/**
         * @param {?} res
         * @return {?}
         */
        function (res) {
            return completeUpload(file);
        })));
    };
    /**
     * @private
     * @param {?} file
     * @param {?} event
     * @param {?} extendService
     * @return {?}
     */
    FfileuploadAdaptUnifileService.prototype._getBigFileChunks = /**
     * @private
     * @param {?} file
     * @param {?} event
     * @param {?} extendService
     * @return {?}
     */
    function (file, event, extendService) {
        /** @type {?} */
        var uuid = this.uuid();
        /** @type {?} */
        var formId = this.getFinallyConfig("formId", extendService);
        /** @type {?} */
        var rootId = this.getFinallyConfig("rootId", extendService);
        /** @type {?} */
        var realChunkSize = (event.chunkSize || 1) * this.bufferSize;
        /** @type {?} */
        var chunkTotal = Math.ceil(file.size / realChunkSize);
        /** @type {?} */
        var chunkIndex = 0;
        /** @type {?} */
        var fileChunks = { chunks: [], total: chunkTotal };
        while (chunkIndex < chunkTotal) {
            /** @type {?} */
            var uploadInfo = new GspFormUploadEntity();
            uploadInfo.mode = OperatingModes.Temp;
            uploadInfo.formId = formId;
            uploadInfo.rootId = rootId;
            /** @type {?} */
            var docInfo = new GspFormDocInfo();
            docInfo.fileName = file.name;
            docInfo.metadataId = uuid;
            docInfo.total = chunkTotal;
            /** @type {?} */
            var nextSize = Math.min((chunkIndex + 1) * realChunkSize, file.size);
            // File类型
            /** @type {?} */
            var fileData = file["nativeFile"].slice(chunkIndex * realChunkSize, nextSize);
            docInfo.size = file.size;
            docInfo.index = chunkIndex;
            docInfo.fileContent = "";
            // 如果data里有数据，并且属性是配置的扩展属性
            if (event.hasOwnProperty("data") &&
                event["data"] &&
                event["data"].hasOwnProperty("extProperty")) {
                docInfo["extProperty"] = (/** @type {?} */ (event["data"]["extProperty"]));
            }
            uploadInfo.docInfo = docInfo;
            //封装请求formdata
            /** @type {?} */
            var formData = new FormData();
            formData.append("uploadInfo", JSON.stringify(uploadInfo));
            formData.append("docInfo", JSON.stringify(docInfo));
            formData.append("file", fileData);
            fileChunks.chunks.push(formData);
            chunkIndex = chunkIndex + 1;
        }
        return fileChunks;
    };
    /**
     * 获取跟目录的配置
     * @param rootId
     * @returns
     */
    /**
     * 获取跟目录的配置
     * @private
     * @param {?} rootId
     * @return {?}
     */
    FfileuploadAdaptUnifileService.prototype.getServerConfig = /**
     * 获取跟目录的配置
     * @private
     * @param {?} rootId
     * @return {?}
     */
    function (rootId) {
        return this.uploadSer.getUploadInfo(rootId);
    };
    //#endregion
    //#region 读取相关配置分片上传至云服务器
    //#endregion
    //#region 读取相关配置分片上传至云服务器
    /**
     * @private
     * @param {?} file
     * @param {?} uploadChunks$
     * @return {?}
     */
    FfileuploadAdaptUnifileService.prototype.unorderedUploadBigFile = 
    //#endregion
    //#region 读取相关配置分片上传至云服务器
    /**
     * @private
     * @param {?} file
     * @param {?} uploadChunks$
     * @return {?}
     */
    function (file, uploadChunks$) {
        var _this = this;
        if (!file.partList) {
            file.partList = [];
        }
        this.initMultiUpload(file).subscribe((/**
         * @param {?} r
         * @return {?}
         */
        function (r) {
            if (r && r.error) {
                uploadChunks$.error(_this.errorInfoFormat(r.error, [file]));
                uploadChunks$.complete();
                return;
            }
            file.chunks.forEach((/**
             * @param {?} n
             * @return {?}
             */
            function (n) {
                _this.multiUpload(n, r).subscribe((/**
                 * @param {?} res
                 * @return {?}
                 */
                function (res) {
                    if (res && res.error) {
                        uploadChunks$.error(_this.errorInfoFormat(res.error, [file]));
                        uploadChunks$.complete();
                        return;
                    }
                    file.progress = {
                        status: UploadStatus.Uploading,
                        data: {
                            percentage: (res.index / file.chunks.length * 100).toFixed(0)
                        }
                    };
                    uploadChunks$.next({ type: 'uploading', files: [file] });
                    if (res && res.result) {
                        file.partList.push(res.result);
                    }
                    if (file.partList.length === file.chunks.length) {
                        /** @type {?} */
                        var completeMultiUploadRequest = {};
                        completeMultiUploadRequest.metadataId = file.metadataId;
                        completeMultiUploadRequest.partList = file.partList;
                        completeMultiUploadRequest.rootId = _this.rootId;
                        completeMultiUploadRequest.uploadId = file.uploadId;
                        completeMultiUploadRequest.size = file.size;
                        _this.completeMultiUpload(completeMultiUploadRequest).subscribe((/**
                         * @param {?} cmur
                         * @return {?}
                         */
                        function (cmur) {
                            if (cmur && cmur.status != 200) {
                                uploadChunks$.error(_this.errorInfoFormat(cmur.error, [file]));
                                uploadChunks$.complete();
                                return;
                            }
                            file.progress = {
                                status: UploadStatus.Done,
                                data: {
                                    percentage: 100
                                }
                            };
                            file.response = JSON.parse(file.chunks[0].get("docInfo"));
                            uploadChunks$.next({ type: 'done', files: [file] });
                        }), (/**
                         * @param {?} error
                         * @return {?}
                         */
                        function (error) {
                            uploadChunks$.error(_this.errorInfoFormat(error, [file]));
                            uploadChunks$.complete();
                        }));
                    }
                }));
            }));
        }));
    };
    /**
     * @param {?} files
     * @param {?} event
     * @param {?} extendService
     * @return {?}
     */
    FfileuploadAdaptUnifileService.prototype.uploadBigFile2 = /**
     * @param {?} files
     * @param {?} event
     * @param {?} extendService
     * @return {?}
     */
    function (files, event, extendService) {
        var _this = this;
        /** @type {?} */
        var uploadChunks$ = new Subject();
        /** @type {?} */
        var formId = this.getFinallyConfig('formId', extendService);
        /** @type {?} */
        var rootId = this.getFinallyConfig('rootId', extendService);
        /** @type {?} */
        var _files = files.map((/**
         * @param {?} n
         * @return {?}
         */
        function (n) {
            /** @type {?} */
            var chunks = _this._getBigFileChunks2(n, event, extendService);
            return tslib_1.__assign({}, n, chunks, { formId: formId, rootId: rootId });
        }));
        // 无序上传
        _files.forEach((/**
         * @param {?} n
         * @return {?}
         */
        function (n) {
            _this.unorderedUploadBigFile(n, uploadChunks$);
        }));
        // 有序上传
        // const uploadchunks$: Observable<any>[] =  _files.map((f) => this.uploadChunks2(f, uploadChunks$));
        // concat(...uploadchunks$).pipe(
        //     switchMap((f: any) => {
        //         let completeMultiUploadRequest: any = {};
        //         completeMultiUploadRequest.metadataId = f.metadataId;
        //         completeMultiUploadRequest.partList = f.partList;
        //         completeMultiUploadRequest.rootId = this.rootId;
        //         completeMultiUploadRequest.uploadId = f.uploadId;
        //         completeMultiUploadRequest.size = f.size;
        //         return this.completeMultiUpload(completeMultiUploadRequest).pipe(
        //             map(() => f)
        //         );
        //     })
        // ).subscribe(
        //     (f: any) => {
        //         f.progress = {
        //             status: UploadStatus.Done,
        //             data:  {
        //                 percentage: 100
        //             }
        //         };
        //         f.response = JSON.parse(f.chunks[0].get("docInfo"));
        //         uploadChunks$.next({type: 'done', files:[f]});
        //     },
        //     error => {
        //         uploadChunks$.error(this.errorInfoFormat(error, files));
        //         uploadChunks$.complete();
        //     },
        //     () => {
        //         uploadChunks$.complete();
        //         // console.log("all files uploaded")
        //     }
        // );
        return uploadChunks$.asObservable();
    };
    /**
     * @private
     * @param {?} file
     * @return {?}
     */
    FfileuploadAdaptUnifileService.prototype.initMultiUpload = /**
     * @private
     * @param {?} file
     * @return {?}
     */
    function (file) {
        /** @type {?} */
        var initRequest = {};
        initRequest.path = file.formId;
        initRequest.metadataId = this.uuid();
        initRequest.rootId = file.rootId;
        initRequest.size = file.size;
        initRequest.fileName = file.name;
        /** @type {?} */
        var url = this.getPrefixStr() + "/api/runtime/dfs/v1.0/formdoc/multi/init";
        return this.uploadSer['http']['http'].post(url, initRequest).pipe(tap((/**
         * @param {?} res
         * @return {?}
         */
        function (res) {
            file.metadataId = initRequest.metadataId;
            file.uploadId = res.uploadId;
        })), catchError((/**
         * @param {?} error
         * @return {?}
         */
        function (error) {
            return of(error);
        })), map((/**
         * @param {?} res
         * @return {?}
         */
        function (res) {
            res.metadataId = initRequest.metadataId;
            return res;
        })));
    };
    /**
     * @private
     * @param {?} request
     * @return {?}
     */
    FfileuploadAdaptUnifileService.prototype.completeMultiUpload = /**
     * @private
     * @param {?} request
     * @return {?}
     */
    function (request) {
        /** @type {?} */
        var url = this.getPrefixStr() + "/api/runtime/dfs/v1.0/formdoc/multi/complete";
        return this.uploadSer['http']['http'].post(url, request).pipe(tap((/**
         * @param {?} res
         * @return {?}
         */
        function (res) { })), catchError((/**
         * @param {?} error
         * @return {?}
         */
        function (error) {
            return of(error);
        })));
    };
    /**
     * @private
     * @param {?} formdata
     * @param {?} r
     * @return {?}
     */
    FfileuploadAdaptUnifileService.prototype.multiUpload = /**
     * @private
     * @param {?} formdata
     * @param {?} r
     * @return {?}
     */
    function (formdata, r) {
        /** @type {?} */
        var url = this.getPrefixStr() + "/api/runtime/dfs/v1.0/formdoc/multi/upload";
        /** @type {?} */
        var mr = JSON.parse((/** @type {?} */ (formdata.get('multiRequest'))));
        mr.uploadId = r.uploadId;
        mr.metadataId = r.metadataId;
        formdata.set('multiRequest', JSON.stringify(mr));
        /** @type {?} */
        var di = JSON.parse((/** @type {?} */ (formdata.get('docInfo'))));
        di.metadataId = r.metadataId;
        formdata.set('docInfo', JSON.stringify(di));
        return this.uploadSer['http']['http'].post(url, formdata).pipe(tap((/**
         * @param {?} res
         * @return {?}
         */
        function (res) { })), catchError((/**
         * @param {?} error
         * @return {?}
         */
        function (error) {
            return of(error);
        })));
    };
    /**
     * @private
     * @param {?} file
     * @param {?} upChunk$
     * @return {?}
     */
    FfileuploadAdaptUnifileService.prototype.uploadChunks2 = /**
     * @private
     * @param {?} file
     * @param {?} upChunk$
     * @return {?}
     */
    function (file, upChunk$) {
        var _this = this;
        /** @type {?} */
        var total = file.total;
        /** @type {?} */
        var t = -1;
        /** @type {?} */
        var doChunksRemain = (/**
         * @param {?} i
         * @return {?}
         */
        function (i) { return i < total; });
        /** @type {?} */
        var completeUpload = (/**
         * @param {?} f
         * @return {?}
         */
        function (f) { return of(f); });
        /** @type {?} */
        var uploadChunk = (/**
         * @param {?} f
         * @param {?} uploadId
         * @return {?}
         */
        function (f, uploadId) {
            return _this.multiUpload(f, uploadId).pipe(delay(100), map((/**
             * @param {?} res
             * @return {?}
             */
            function (res) {
                // 块数为0 时，即为此文件的所有块均上传成功
                file.progress = {
                    status: UploadStatus.Uploading,
                    data: {
                        percentage: (res.index / file.chunks.length * 100).toFixed(0)
                    }
                };
                upChunk$.next({ type: 'uploading', files: [file] });
                if (res && res.result) {
                    if (!file.partList) {
                        file.partList = [];
                    }
                    file.partList.push(res.result);
                }
                return file;
            })));
        });
        /** @type {?} */
        var createMultipartUpload = (/**
         * @param {?} f
         * @return {?}
         */
        function (f) {
            return _this.initMultiUpload(f);
            // return of(f)
        });
        return createMultipartUpload(file).pipe(
        // tap((f) => console.log("upload file", f.name)),
        expand((/**
         * @param {?} r
         * @return {?}
         */
        function (r) {
            if (doChunksRemain(++t)) {
                return uploadChunk(file.chunks[t], r);
            }
            return EMPTY;
        })), 
        // tap((f: any) => {
        //     console.log(`file: ${f.name} - remaining chunks: ${f.total}`);
        // }),
        last(), switchMap((/**
         * @param {?} res
         * @return {?}
         */
        function (res) {
            return completeUpload(file);
        })));
    };
    /**
     * @private
     * @param {?} file
     * @param {?} event
     * @param {?} extendService
     * @return {?}
     */
    FfileuploadAdaptUnifileService.prototype._getBigFileChunks2 = /**
     * @private
     * @param {?} file
     * @param {?} event
     * @param {?} extendService
     * @return {?}
     */
    function (file, event, extendService) {
        /** @type {?} */
        var uuid = this.uuid();
        /** @type {?} */
        var _bifferSize = Math.max(event.chunkSize, 5) * this.bufferSize;
        /** @type {?} */
        var chunkTotal = Math.ceil(file.size / _bifferSize);
        /** @type {?} */
        var chunkIndex = 0;
        /** @type {?} */
        var fileChunks = { chunks: [], total: chunkTotal };
        /** @type {?} */
        var rootId = this.getFinallyConfig('rootId', extendService);
        while (chunkIndex < chunkTotal) {
            /** @type {?} */
            var nextSize = Math.min((chunkIndex + 1) * _bifferSize, file.size);
            // File类型
            /** @type {?} */
            var fileData = file['nativeFile'].slice(chunkIndex * _bifferSize, nextSize);
            /** @type {?} */
            var multiRequest = {};
            multiRequest.metadataId = uuid;
            multiRequest.rootId = rootId;
            // multiRequest.uploadId = uploadId;
            multiRequest.index = chunkIndex;
            multiRequest.total = chunkTotal;
            multiRequest.size = fileData.size;
            //封装请求formdata
            /** @type {?} */
            var formData = new FormData();
            formData.append('multiRequest', JSON.stringify(multiRequest));
            formData.append('file', fileData);
            /** @type {?} */
            var docInfo = new GspFormDocInfo();
            docInfo.fileName = file.name;
            docInfo.metadataId = uuid;
            docInfo.total = chunkTotal;
            docInfo.size = file.size;
            docInfo.index = chunkIndex;
            docInfo.fileContent = "";
            formData.append("docInfo", JSON.stringify(docInfo));
            // 如果data里有数据，并且属性是配置的扩展属性
            if (event.hasOwnProperty("data") &&
                event["data"] &&
                event["data"].hasOwnProperty("extProperty")) {
                docInfo["extProperty"] = (/** @type {?} */ (event["data"]["extProperty"]));
            }
            fileChunks.chunks.push(formData);
            chunkIndex = chunkIndex + 1;
        }
        return fileChunks;
    };
    FfileuploadAdaptUnifileService.previous = 0;
    FfileuploadAdaptUnifileService.decorators = [
        { type: Injectable, args: [{
                    providedIn: "root",
                },] }
    ];
    /** @nocollapse */
    FfileuploadAdaptUnifileService.ctorParameters = function () { return [
        { type: UploadService },
        { type: FFileUploadAdaptUnifileConfigService },
        { type: Injector, decorators: [{ type: Optional }] }
    ]; };
    /** @nocollapse */ FfileuploadAdaptUnifileService.ngInjectableDef = i0.defineInjectable({ factory: function FfileuploadAdaptUnifileService_Factory() { return new FfileuploadAdaptUnifileService(i0.inject(i1.UploadService), i0.inject(i2.FFileUploadAdaptUnifileConfigService), i0.inject(i0.INJECTOR, 8)); }, token: FfileuploadAdaptUnifileService, providedIn: "root" });
    return FfileuploadAdaptUnifileService;
}(UploadServerService));
export { FfileuploadAdaptUnifileService };
if (false) {
    /**
     * @type {?}
     * @private
     */
    FfileuploadAdaptUnifileService.previous;
    /** @type {?} */
    FfileuploadAdaptUnifileService.prototype.extendData;
    /** @type {?} */
    FfileuploadAdaptUnifileService.prototype.bufferSize;
    /**
     * @type {?}
     * @private
     */
    FfileuploadAdaptUnifileService.prototype.uploadedChunk;
    /**
     * @type {?}
     * @private
     */
    FfileuploadAdaptUnifileService.prototype.fileTotalChunk;
    /**
     * @type {?}
     * @private
     */
    FfileuploadAdaptUnifileService.prototype.formId;
    /**
     * @type {?}
     * @private
     */
    FfileuploadAdaptUnifileService.prototype.rootId;
    /**
     * @type {?}
     * @private
     */
    FfileuploadAdaptUnifileService.prototype.serverConfig;
    /**
     * @type {?}
     * @private
     */
    FfileuploadAdaptUnifileService.prototype.uploadSer;
    /**
     * @type {?}
     * @private
     */
    FfileuploadAdaptUnifileService.prototype.configSer;
    /**
     * @type {?}
     * @private
     */
    FfileuploadAdaptUnifileService.prototype.inject;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmZpbGV1cGxvYWQtYWRhcHQtdW5pZmlsZS5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy9leHRlbmQtZmlsZXVwbG9hZC1hZGFwdC11bmlmaWxlLyIsInNvdXJjZXMiOlsibGliL2ZmaWxldXBsb2FkLWFkYXB0LXVuaWZpbGUuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFDLFFBQVEsRUFBRSxRQUFRLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDOUQsT0FBTyxFQUNILG1CQUFtQixFQUduQixZQUFZLEdBQ2YsTUFBTSw0QkFBNEIsQ0FBQztBQUNwQyxPQUFPLEVBQUUsVUFBVSxFQUFFLFFBQVEsRUFBRSxFQUFFLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRSxPQUFPLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDeEUsT0FBTyxFQUNILGFBQWEsRUFDYix1QkFBdUIsRUFDdkIsdUJBQXVCLEVBQ3ZCLGNBQWMsRUFDZCxtQkFBbUIsRUFFbkIsY0FBYyxHQUVqQixNQUFNLHlCQUF5QixDQUFDO0FBQ2pDLE9BQU8sRUFDSCxvQ0FBb0MsR0FFdkMsTUFBTSxvQ0FBb0MsQ0FBQztBQUM1QyxPQUFPLEVBQ0gsVUFBVSxFQUNWLEtBQUssRUFDTCxNQUFNLEVBQ04sSUFBSSxFQUNKLEdBQUcsRUFDSCxTQUFTLEVBQ1QsR0FBRyxHQUNOLE1BQU0sZ0JBQWdCLENBQUM7QUFFeEIsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLG1CQUFtQixDQUFDOzs7Ozs7O0FBR2xELHdDQU1DOzs7SUFMRyw2Q0FBeUI7O0lBQ3pCLHlDQUFvQjs7SUFDcEIsZ0RBQTRCOztJQUM1QixrREFBMkI7O0lBQzNCLGlEQUEwQjs7QUFJOUI7SUFHb0QsMERBQW1CO0lBVW5FLHdDQUNZLFNBQXdCLEVBQ3hCLFNBQStDLEVBQ25DLE1BQWU7UUFIdkMsWUFLSSxpQkFBTyxTQVFWO1FBWlcsZUFBUyxHQUFULFNBQVMsQ0FB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ZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUsSW5qZWN0b3IsIE9wdGlvbmFsIH0gZnJvbSBcIkBhbmd1bGFyL2NvcmVcIjtcclxuaW1wb3J0IHtcclxuICAgIFVwbG9hZFNlcnZlclNlcnZpY2UsXHJcbiAgICBVcGxvYWRGaWxlLFxyXG4gICAgVXBsb2FkSW5wdXQsXHJcbiAgICBVcGxvYWRTdGF0dXMsXHJcbn0gZnJvbSBcIkBmYXJyaXMvZXh0ZW5kLWZpbGUtdXBsb2FkXCI7XHJcbmltcG9ydCB7IE9ic2VydmFibGUsIGZvcmtKb2luLCBvZiwgRU1QVFksIGNvbmNhdCwgU3ViamVjdCB9IGZyb20gXCJyeGpzXCI7XHJcbmltcG9ydCB7XHJcbiAgICBVcGxvYWRTZXJ2aWNlLFxyXG4gICAgR3NwRm9ybVVwbG9hZExpc3RFbnRpdHksXHJcbiAgICBHc3BGb3JtUmVtb3ZlTGlzdEVudGl0eSxcclxuICAgIEdzcEZvcm1Eb2NJbmZvLFxyXG4gICAgR3NwRm9ybVVwbG9hZEVudGl0eSxcclxuICAgIEZpbGVJbmZvLFxyXG4gICAgT3BlcmF0aW5nTW9kZXMsXHJcbiAgICBHc3BEb2NNZXRhUHJvcGVydHksXHJcbn0gZnJvbSBcIkBnc3Atc3ZjL2Zvcm1kb2MtdXBsb2FkXCI7XHJcbmltcG9ydCB7XHJcbiAgICBGRmlsZVVwbG9hZEFkYXB0VW5pZmlsZUNvbmZpZ1NlcnZpY2UsXHJcbiAgICBGRmlsZVVwbG9hZEFkYXB0VW5pZmlsZUNvbmZpZyxcclxufSBmcm9tIFwiLi9mZmlsZXVwbG9hZC1hZGFwdC11bmlmaWxlLmNvbmZpZ1wiO1xyXG5pbXBvcnQge1xyXG4gICAgY2F0Y2hFcnJvcixcclxuICAgIGRlbGF5LFxyXG4gICAgZXhwYW5kLFxyXG4gICAgbGFzdCxcclxuICAgIG1hcCxcclxuICAgIHN3aXRjaE1hcCxcclxuICAgIHRhcCxcclxufSBmcm9tIFwicnhqcy9vcGVyYXRvcnNcIjtcclxuaW1wb3J0IHsgSHR0cEVycm9yUmVzcG9uc2UgfSBmcm9tIFwiQGFuZ3VsYXIvY29tbW9uL2h0dHBcIjtcclxuaW1wb3J0IHsgTG9jYWxlU2VydmljZSB9IGZyb20gXCJAZmFycmlzL3VpLWxvY2FsZVwiO1xyXG5cclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgVXBsb2FkU2VydmVyQ29uZmlnIHtcclxuICAgIHNhbWVOYW1lQWxsb3dlZDogYm9vbGVhbjtcclxuICAgIG1heEZpbGVTaXplOiBudW1iZXI7XHJcbiAgICBhbGxvd2VkTXVsdGlVcGxvYWQ6IGJvb2xlYW47XHJcbiAgICB1cGxvYWRlZEZpbGVJbmZvTGlzdD86IGFueTtcclxuICAgIG9sZFVwbG9hZGVkRmlsZUxpc3Q/OiBhbnk7XHJcbn1cclxuXHJcblxyXG5ASW5qZWN0YWJsZSh7XHJcbiAgICBwcm92aWRlZEluOiBcInJvb3RcIixcclxufSlcclxuZXhwb3J0IGNsYXNzIEZmaWxldXBsb2FkQWRhcHRVbmlmaWxlU2VydmljZSBleHRlbmRzIFVwbG9hZFNlcnZlclNlcnZpY2Uge1xyXG4gICAgZXh0ZW5kRGF0YTsgLy8g5pqC5pe255So5LqO566A5Y2V5ZCI5bm2XHJcbiAgICBidWZmZXJTaXplID0gMTAyNCAqIDEwMjQ7XHJcbiAgICBwcml2YXRlIHN0YXRpYyBwcmV2aW91cyA9IDA7XHJcbiAgICBwcml2YXRlIHVwbG9hZGVkQ2h1bmsgPSB7fTtcclxuICAgIHByaXZhdGUgZmlsZVRvdGFsQ2h1bmsgPSB7fTtcclxuICAgIHByaXZhdGUgZm9ybUlkOiBzdHJpbmc7XHJcbiAgICBwcml2YXRlIHJvb3RJZDogc3RyaW5nO1xyXG4gICAgcHJpdmF0ZSBzZXJ2ZXJDb25maWcgOiBVcGxvYWRTZXJ2ZXJDb25maWcgPSBudWxsO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKFxyXG4gICAgICAgIHByaXZhdGUgdXBsb2FkU2VyOiBVcGxvYWRTZXJ2aWNlLFxyXG4gICAgICAgIHByaXZhdGUgY29uZmlnU2VyOiBGRmlsZVVwbG9hZEFkYXB0VW5pZmlsZUNvbmZpZ1NlcnZpY2UsXHJcbiAgICAgICAgQE9wdGlvbmFsKCkgcHJpdmF0ZSBpbmplY3Q6SW5qZWN0b3JcclxuICAgICkge1xyXG4gICAgICAgIHN1cGVyKCk7ICAgICAgICBcclxuICAgICAgICB0aGlzLmV4dGVuZERhdGEgPSB0aGlzLmNvbmZpZ1Nlci5nZXRDb25maWcoKTtcclxuICAgICAgICAvLyDlvIDlp4vliJvlu7rlpJror63oqIDmnI3liqFcclxuICAgICAgICBsZXQgaGFzTG9jYWxTZXI9dGhpcy5jb25maWdTZXIuc2V0TG9jYWxTdGF0ZShudWxsKTtcclxuICAgICAgICBpZiggdGhpcy5pbmplY3QgJiYgIWhhc0xvY2FsU2VyKXtcclxuICAgICAgICAgICAgLy8g5aaC5p6c5a2Y5ZyoaW5qZWN077yM5YaN5qyh5Yib5bu677yMaW5qZWN05piv5Zyo5p+Q5Liq54mI5LiN6IO95LmL5ZCO5omN5Ye6546w55qEXHJcbiAgICAgICAgICAgIHRoaXMuY29uZmlnU2VyLnNldExvY2FsU3RhdGUodGhpcy5pbmplY3QuZ2V0KExvY2FsZVNlcnZpY2UsbnVsbCkpO1xyXG4gICAgICAgICB9XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIOWboOS4uuiiq+mZhOS7tue7hOS7tuS9nOS4uuS+nei1luexu++8jOWvvOiHtOatpOWkhOiOt+WPluS4jeWIsOacgOaWsOeahOWfuui3r+W+hOWAvFxyXG4gICAgICogQHJldHVybnMgXHJcbiAgICAgKi9cclxuICAgIHByaXZhdGUgZ2V0UHJlZml4U3RyKCl7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY29uZmlnU2VyLmdldEJhc2VQYXRoKCk7XHJcbiAgICB9XHJcbiAgICBwcml2YXRlIHV1aWQoKSB7XHJcbiAgICAgICAgbGV0IFM0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gKCgoMSArIE1hdGgucmFuZG9tKCkpICogMHgxMDAwMCkgfCAwKS50b1N0cmluZygxNikuc3Vic3RyaW5nKDEpO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgbGV0IG5HdWlkID0gUzQoKSArIFM0KCkrICctJyArIFM0KCkrICctJyArIFM0KCkrICctJyArIFM0KCkrICctJyArIFM0KCkgKyBTNCgpICsgUzQoKTtcclxuICAgICAgICByZXR1cm4gbkd1aWQ7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIOWIoOmZpOaWh+S7tlxyXG4gICAgICogQHBhcmFtIGZpbGVcclxuICAgICAqIEBwYXJhbSBldmVudFxyXG4gICAgICovXHJcbiAgICByZW1vdmUoXHJcbiAgICAgICAgZmlsZXM6IFVwbG9hZEZpbGVbXSxcclxuICAgICAgICBldmVudDogVXBsb2FkSW5wdXQsXHJcbiAgICAgICAgZXh0ZW5kU2VydmljZTogRkZpbGVVcGxvYWRBZGFwdFVuaWZpbGVDb25maWdcclxuICAgICk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuaW5uZXJSZW1vdmVMaXN0KGZpbGVzLCBldmVudCwgZXh0ZW5kU2VydmljZSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBpbm5lclJlbW92ZUxpc3QoXHJcbiAgICAgICAgZmlsZXM6IFVwbG9hZEZpbGVbXSxcclxuICAgICAgICBldmVudDogVXBsb2FkSW5wdXQsXHJcbiAgICAgICAgZXh0ZW5kU2VydmljZSA9IG51bGxcclxuICAgICk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBPYnNlcnZhYmxlKChvYnNlcnZlcikgPT4ge1xyXG4gICAgICAgICAgICBsZXQgcmVtb3ZlRmlsZUluZm8gPSBuZXcgR3NwRm9ybVJlbW92ZUxpc3RFbnRpdHkoKTtcclxuICAgICAgICAgICAgbGV0IG1ldGFkYXRhSWRMaXN0ID0gW107XHJcbiAgICAgICAgICAgIGZpbGVzLmZvckVhY2goKGZpbGVJdGVtKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAoZmlsZUl0ZW1bXCJyZXNwb25zZVwiXSkge1xyXG4gICAgICAgICAgICAgICAgICAgIG1ldGFkYXRhSWRMaXN0LnB1c2goZmlsZUl0ZW1bXCJyZXNwb25zZVwiXVtcIm1ldGFkYXRhSWRcIl0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHJlbW92ZUZpbGVJbmZvLm1vZGUgPSB0aGlzLmdldEZpbmFsbHlDb25maWcoXCJtb2RlXCIsIGV4dGVuZFNlcnZpY2UpO1xyXG4gICAgICAgICAgICBsZXQgcm9vdElkID0gdGhpcy5nZXRGaW5hbGx5Q29uZmlnKFwicm9vdElkXCIsIGV4dGVuZFNlcnZpY2UpO1xyXG4gICAgICAgICAgICByZW1vdmVGaWxlSW5mby5tZXRhZGF0YUlkTGlzdCA9IFtdLmNvbmNhdChtZXRhZGF0YUlkTGlzdCk7XHJcblxyXG4gICAgICAgICAgICB0aGlzLnVwbG9hZFNlci5yZW1vdmVMaXN0KG1ldGFkYXRhSWRMaXN0LCByb290SWQpLnN1YnNjcmliZShcclxuICAgICAgICAgICAgICAgIChyZXN1bHQpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAvLyDmsqHmnInpnIDopoHmlbTlkIjnmoTmnI3liqHlmajnq6/ov5Tlm57mlbDmja5cclxuICAgICAgICAgICAgICAgICAgICBvYnNlcnZlci5uZXh0KHsgdHlwZTogXCJyZW1vdmVkXCIsIGZpbGVzOiBmaWxlcyB9KTtcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAoZXJyb3IpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBvYnNlcnZlci5lcnJvcihlcnJvcik7XHJcbiAgICAgICAgICAgICAgICAgICAgb2JzZXJ2ZXIuY29tcGxldGUoKTtcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgb2JzZXJ2ZXIuY29tcGxldGUoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICog5LiK5Lyg5paH5Lu2XHJcbiAgICAgKiBAcGFyYW0gZmlsZVxyXG4gICAgICogQHBhcmFtIGV2ZW50XHJcbiAgICAgKi9cclxuICAgIHVwbG9hZChcclxuICAgICAgICBmaWxlczogVXBsb2FkRmlsZVtdLFxyXG4gICAgICAgIGV2ZW50OiBVcGxvYWRJbnB1dCxcclxuICAgICAgICBleHRlbmRTZXJ2aWNlOiBGRmlsZVVwbG9hZEFkYXB0VW5pZmlsZUNvbmZpZ1xyXG4gICAgKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgICAgICB0aGlzLmZvcm1JZCA9IHRoaXMuZ2V0RmluYWxseUNvbmZpZyhcImZvcm1JZFwiLCBleHRlbmRTZXJ2aWNlKTtcclxuICAgICAgICB0aGlzLnJvb3RJZCA9IHRoaXMuZ2V0RmluYWxseUNvbmZpZyhcInJvb3RJZFwiLCBleHRlbmRTZXJ2aWNlKTtcclxuICAgICAgICBpZiAoZXZlbnQudHlwZSA9PSBcInNsaWNlVXBsb2FkXCIpIHtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IHVwJCA9ICgpID0+IHtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLnNlcnZlckNvbmZpZyAmJiB0aGlzLnNlcnZlckNvbmZpZy5hbGxvd2VkTXVsdGlVcGxvYWQpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMuc2VydmVyQ29uZmlnLnNhbWVOYW1lQWxsb3dlZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy51cGxvYWRTZXIuZ2V0VXBsb2FkZWRGaWxlSW5mb0xpc3QodGhpcy5mb3JtSWQsIHRoaXMucm9vdElkKS5waXBlKFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoTWFwKChyZXM6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXMgIT0gbnVsbCAmJiByZXMuZXJyb3IgPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNlcnZlckNvbmZpZy51cGxvYWRlZEZpbGVJbmZvTGlzdCA9IHJlcztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXJ2ZXJDb25maWcub2xkVXBsb2FkZWRGaWxlTGlzdCA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkocmVzKSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy51cGxvYWRCaWdGaWxlMihmaWxlcywgZXZlbnQsIGV4dGVuZFNlcnZpY2UpOyAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gb2YocmVzKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMudXBsb2FkQmlnRmlsZTIoZmlsZXMsIGV2ZW50LCBleHRlbmRTZXJ2aWNlKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnVwbG9hZEJpZ0ZpbGUoZmlsZXMsIGV2ZW50LCBleHRlbmRTZXJ2aWNlKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgICAgIGlmICghdGhpcy5zZXJ2ZXJDb25maWcpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmdldFNlcnZlckNvbmZpZyh0aGlzLnJvb3RJZCkucGlwZShcclxuICAgICAgICAgICAgICAgICAgICBzd2l0Y2hNYXAoKHJlczogYW55KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXMgIT0gbnVsbCAmJiByZXMuZXJyb3IgPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXJ2ZXJDb25maWcgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2FtZU5hbWVBbGxvd2VkOiByZXMuc2FtZU5hbWVBbGxvd2VkLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFsbG93ZWRNdWx0aVVwbG9hZDogcmVzLmFsbG93ZWRNdWx0aVVwbG9hZCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXhGaWxlU2l6ZTogcGFyc2VJbnQoXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEpTT04ucGFyc2UocmVzLnZhbGlkYXRlQ29uZmlndXJhdGlvbikubWF4RmlsZVNpemVcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVwJCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICApO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiB1cCQoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuaW5uZXJVcGxvYWRMaXN0KGZpbGVzLCBldmVudCwgZXh0ZW5kU2VydmljZSk7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIOWGhemDqOS4iuS8oOaWueW8j1xyXG4gICAgICogQHBhcmFtIGZpbGVzXHJcbiAgICAgKiBAcGFyYW0gZXZlbnRcclxuICAgICAqIEBwYXJhbSBleHRlbmRTZXJ2aWNlXHJcbiAgICAgKi9cclxuICAgIHByaXZhdGUgaW5uZXJVcGxvYWRMaXN0KFxyXG4gICAgICAgIGZpbGVzOiBVcGxvYWRGaWxlW10sXHJcbiAgICAgICAgZXZlbnQ6IFVwbG9hZElucHV0LFxyXG4gICAgICAgIGV4dGVuZFNlcnZpY2U6IEZGaWxlVXBsb2FkQWRhcHRVbmlmaWxlQ29uZmlnXHJcbiAgICApOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgICAgIHJldHVybiBuZXcgT2JzZXJ2YWJsZSgob2JzZXJ2ZXIpID0+IHtcclxuICAgICAgICAgICAgbGV0IHVwbG9hZEluZm8gPSBuZXcgR3NwRm9ybVVwbG9hZExpc3RFbnRpdHkoKTtcclxuICAgICAgICAgICAgdXBsb2FkSW5mby5mb3JtSWQgPSB0aGlzLmdldEZpbmFsbHlDb25maWcoXCJmb3JtSWRcIiwgZXh0ZW5kU2VydmljZSk7XHJcbiAgICAgICAgICAgIHVwbG9hZEluZm8ubW9kZSA9IHRoaXMuZ2V0RmluYWxseUNvbmZpZyhcIm1vZGVcIiwgZXh0ZW5kU2VydmljZSk7XHJcblxyXG4gICAgICAgICAgICBsZXQgcm9vdElkID0gdGhpcy5nZXRGaW5hbGx5Q29uZmlnKFwicm9vdElkXCIsIGV4dGVuZFNlcnZpY2UpO1xyXG4gICAgICAgICAgICB1cGxvYWRJbmZvLmRvY0luZm9MaXN0ID0gW107XHJcbiAgICAgICAgICAgIGxldCByZWFkZXJPYnNlcmFibGU6IE9ic2VydmFibGU8YW55PltdID0gW107XHJcbiAgICAgICAgICAgIGZpbGVzLmZvckVhY2goKGZpbGVJdGVtOiBVcGxvYWRGaWxlKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBsZXQgc3ViID0gbmV3IE9ic2VydmFibGUoKG9ic2VyKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8g5pqC5LiN5aSE55CG5byC5bi4XHJcbiAgICAgICAgICAgICAgICAgICAgcmVhZGVyLnJlYWRBc0JpbmFyeVN0cmluZyhmaWxlSXRlbS5uYXRpdmVGaWxlKTtcclxuICAgICAgICAgICAgICAgICAgICByZWFkZXIub25sb2FkID0gKGUpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGluZm8gPSB7IGZpbGVOYW1lOiBcIlwiLCBmaWxlQ29udGVudDogXCJcIiB9IGFzIGFueTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaW5mb1tcImZpbGVOYW1lXCJdID0gZmlsZUl0ZW0ubmFtZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaW5mb1tcImZpbGVDb250ZW50XCJdID0gYnRvYShyZWFkZXIucmVzdWx0LnRvU3RyaW5nKCkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyDlpoLmnpxkYXRh6YeM5pyJ5pWw5o2u77yM5bm25LiU5bGe5oCn5piv6YWN572u55qE5omp5bGV5bGe5oCnXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50Lmhhc093blByb3BlcnR5KFwiZGF0YVwiKSAmJlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnRbXCJkYXRhXCJdICYmXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBldmVudFtcImRhdGFcIl0uaGFzT3duUHJvcGVydHkoXCJleHRQcm9wZXJ0eVwiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmZvW1wiZXh0UHJvcGVydHlcIl0gPSBldmVudFtcImRhdGFcIl1bXCJleHRQcm9wZXJ0eVwiXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB1cGxvYWRJbmZvLmRvY0luZm9MaXN0LnB1c2goaW5mbyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9ic2VyLm5leHQoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgb2JzZXIuY29tcGxldGUoKTtcclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICByZWFkZXJPYnNlcmFibGUucHVzaChzdWIpO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIGZvcmtKb2luKHJlYWRlck9ic2VyYWJsZSkuc3Vic2NyaWJlKChkYXRhcykgPT4ge1xyXG4gICAgICAgICAgICAgICAgLy8gICAgIG1ldGFkYXRhSWQ6IHN0cmluZztcclxuICAgICAgICAgICAgICAgIC8vICBmaWxlTmFtZTogc3RyaW5nO1xyXG4gICAgICAgICAgICAgICAgdGhpcy51cGxvYWRTZXIudXBsb2FkTGlzdCh1cGxvYWRJbmZvLCByb290SWQpLnN1YnNjcmliZShcclxuICAgICAgICAgICAgICAgICAgICAocmVzdWx0KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQuZXJyb3IpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIOatpOaOpeWPo+S4gOaXpuWHuueOsOmXrumimO+8jOaJgOaciemZhOS7tumDveS4iuS8oOS4jemAmui/h1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JzZXJ2ZXIuZXJyb3IodGhpcy5lcnJvckluZm9Gb3JtYXQocmVzdWx0LmVycm9yLCBmaWxlcykpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JzZXJ2ZXIuY29tcGxldGUoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyDlkIjlubbov5Tlm57nu5PmnpzliLDmraTlpIRcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LmZvckVhY2goKGl0ZW0pID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBmaW5kSW5kZXggPSB0aGlzLmZpbmRGaWxlSW5kZXhCeUZpbGVOYW1lKFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVzLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0uZmlsZU5hbWVcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZmluZEluZGV4ID4gLTEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlc1tmaW5kSW5kZXhdW1wicmVzcG9uc2VcIl0gPSBpdGVtO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVzW2ZpbmRJbmRleF1bXCJwcm9ncmVzc1wiXVtcInN0YXR1c1wiXSA9IFVwbG9hZFN0YXR1cy5Eb25lO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9ic2VydmVyLm5leHQoeyB0eXBlOiBcImRvbmVcIiwgZmlsZXM6IGZpbGVzIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgKGVycm9yKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9ic2VydmVyLmVycm9yKHRoaXMuZXJyb3JJbmZvRm9ybWF0KGVycm9yLCBmaWxlcykpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvYnNlcnZlci5jb21wbGV0ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvYnNlcnZlci5jb21wbGV0ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiDliIbniYfliqDovb1cclxuICAgICAqIEBwYXJhbSBmaWxlXHJcbiAgICAgKiBAcGFyYW0gZXZlbnRcclxuICAgICAqIEBwYXJhbSBleHRlbmRTZXJ2aWNlXHJcbiAgICAgKi9cclxuICAgIG11bHRpcGFydFVwbG9hZChcclxuICAgICAgICBmaWxlOiBVcGxvYWRGaWxlLFxyXG4gICAgICAgIGV2ZW50OiBVcGxvYWRJbnB1dCxcclxuICAgICAgICBleHRlbmRTZXJ2aWNlOiBGRmlsZVVwbG9hZEFkYXB0VW5pZmlsZUNvbmZpZ1xyXG4gICAgKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgICAgICByZXR1cm4gbmV3IE9ic2VydmFibGUoKG9ic2VydmVyKSA9PiB7XHJcbiAgICAgICAgICAgIC8vIGxldCBmaWxlSW5mbzogRmlsZUluZm87XHJcbiAgICAgICAgICAgIGxldCB1dWlkID0gdGhpcy51dWlkKCk7XHJcbiAgICAgICAgICAgIC8vIGxldCB1dWlkID0gVVVJRC5VVUlEKCk7XHJcbiAgICAgICAgICAgIC8vcmVhZGVyLnJlYWRBc0JpbmFyeVN0cmluZyhzZWxlY3RlZEZpbGUpO1xyXG4gICAgICAgICAgICAvL3JlYWRlci5vbmxvYWQgPSAoZSkgPT4ge1xyXG4gICAgICAgICAgICBsZXQgZmlsZU5hbWUgPSBmaWxlLm5hbWU7XHJcbiAgICAgICAgICAgIC8vIGZpbGVJbmZvID0ge1xyXG4gICAgICAgICAgICAvLyAgIGlkOiB1dWlkLFxyXG4gICAgICAgICAgICAvLyAgIG5hbWU6IGZpbGVOYW1lLFxyXG4gICAgICAgICAgICAvLyAgIHR5cGU6IGZpbGUudHlwZSxcclxuICAgICAgICAgICAgLy8gICBzb3VyY2U6IFwiXCIsXHJcbiAgICAgICAgICAgIC8vICAgc2l6ZTogdGhpcy5mb3JtYXRGaWxlU2l6ZShmaWxlLnNpemUpLFxyXG4gICAgICAgICAgICAvLyAgIGZpbGVTaXplOiBmaWxlLnNpemUsXHJcbiAgICAgICAgICAgIC8vICAgcGljTGlzdERpc3BsYXlOYW1lOiB0aGlzLmdldE11bHRpcGFydERpc3BsYXlOYW1lKGZpbGVOYW1lKSxcclxuICAgICAgICAgICAgLy8gICBxdWV1ZUxpc3REaXNwbGF5TmFtZTogZmlsZU5hbWUsXHJcbiAgICAgICAgICAgIC8vICAgLy9jb250ZW50OiByZWFkZXIucmVzdWx0LnRvU3RyaW5nKCksXHJcbiAgICAgICAgICAgIC8vICAgaGFzVXBsb2FkZWQ6IGZhbHNlLFxyXG4gICAgICAgICAgICAvLyAgIG1vdXNlT246IGZhbHNlLFxyXG4gICAgICAgICAgICAvLyAgIHNlbGVjdGQ6IGZhbHNlLFxyXG4gICAgICAgICAgICAvLyAgIGlzVXBsb2FkaW5nOiB0cnVlLFxyXG4gICAgICAgICAgICAvLyAgIHVwbG9hZFJlc3VsdDogZmFsc2UsXHJcbiAgICAgICAgICAgIC8vICAgdXBsb2FkUHJvY2VzczogMCxcclxuICAgICAgICAgICAgLy8gICBlcnJvck1lc3NhZ2U6IFwiXCIsXHJcbiAgICAgICAgICAgIC8vICAgZXh0ZW5zaW9uRHJvcExpc3RJZDogMCxcclxuICAgICAgICAgICAgLy8gICBleHRlbnNpb25OYW1lOiBcIlwiXHJcbiAgICAgICAgICAgIC8vIH1cclxuXHJcbiAgICAgICAgICAgIGxldCBjaHVua1RvdGFsOiBudW1iZXIgPSBNYXRoLmNlaWwoZmlsZS5zaXplIC8gdGhpcy5idWZmZXJTaXplKTtcclxuICAgICAgICAgICAgLy8g5qCH6K6w5b2T5YmN6ZmE5Lu25oC755qE5YiG54mH5pWwXHJcbiAgICAgICAgICAgIHRoaXMuZmlsZVRvdGFsQ2h1bmtbdXVpZF0gPSBjaHVua1RvdGFsO1xyXG4gICAgICAgICAgICBsZXQgY2h1bmtJbmRleDogbnVtYmVyID0gMDtcclxuICAgICAgICAgICAgLy8g5qCH6K6w5b2T5YmN6ZmE5Lu25oiQ5Yqf55qE5YiG54mH5pWwXHJcbiAgICAgICAgICAgIHRoaXMudXBsb2FkZWRDaHVua1t1dWlkXSA9IDA7XHJcbiAgICAgICAgICAgIHdoaWxlIChjaHVua0luZGV4IDwgY2h1bmtUb3RhbCkge1xyXG4gICAgICAgICAgICAgICAgbGV0IHVwbG9hZEluZm8gPSBuZXcgR3NwRm9ybVVwbG9hZEVudGl0eSgpO1xyXG4gICAgICAgICAgICAgICAgdXBsb2FkSW5mby5tb2RlID0gT3BlcmF0aW5nTW9kZXMuVGVtcDtcclxuICAgICAgICAgICAgICAgIHVwbG9hZEluZm8uZm9ybUlkID0gdGhpcy5nZXRGaW5hbGx5Q29uZmlnKFwiZm9ybUlkXCIsIGV4dGVuZFNlcnZpY2UpO1xyXG4gICAgICAgICAgICAgICAgdXBsb2FkSW5mby5yb290SWQgPSB0aGlzLmdldEZpbmFsbHlDb25maWcoXCJyb290SWRcIiwgZXh0ZW5kU2VydmljZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgbGV0IGRvY0luZm86IEdzcEZvcm1Eb2NJbmZvID0gbmV3IEdzcEZvcm1Eb2NJbmZvKCk7XHJcbiAgICAgICAgICAgICAgICBkb2NJbmZvLmZpbGVOYW1lID0gZmlsZU5hbWU7XHJcbiAgICAgICAgICAgICAgICBkb2NJbmZvLm1ldGFkYXRhSWQgPSB1dWlkO1xyXG4gICAgICAgICAgICAgICAgZG9jSW5mby50b3RhbCA9IGNodW5rVG90YWw7XHJcbiAgICAgICAgICAgICAgICAvLyDlpoLmnpxkYXRh6YeM5pyJ5pWw5o2u77yM5bm25LiU5bGe5oCn5piv6YWN572u55qE5omp5bGV5bGe5oCnXHJcbiAgICAgICAgICAgICAgICBpZiAoXHJcbiAgICAgICAgICAgICAgICAgICAgZXZlbnQuaGFzT3duUHJvcGVydHkoXCJkYXRhXCIpICYmXHJcbiAgICAgICAgICAgICAgICAgICAgZXZlbnRbXCJkYXRhXCJdICYmXHJcbiAgICAgICAgICAgICAgICAgICAgZXZlbnRbXCJkYXRhXCJdLmhhc093blByb3BlcnR5KFwiZXh0UHJvcGVydHlcIilcclxuICAgICAgICAgICAgICAgICkge1xyXG4gICAgICAgICAgICAgICAgICAgIGRvY0luZm9bXCJleHRQcm9wZXJ0eVwiXSA9IGV2ZW50W1wiZGF0YVwiXVtcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJleHRQcm9wZXJ0eVwiXHJcbiAgICAgICAgICAgICAgICAgICAgXSBhcyBHc3BEb2NNZXRhUHJvcGVydHk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAvLyDkuIvkuIDkuKrmlofku7blpKflsI9cclxuICAgICAgICAgICAgICAgIGxldCBuZXh0U2l6ZSA9IE1hdGgubWluKChjaHVua0luZGV4ICsgMSkgKiB0aGlzLmJ1ZmZlclNpemUsIGZpbGUuc2l6ZSk7XHJcbiAgICAgICAgICAgICAgICAvLyBGaWxl57G75Z6LXHJcbiAgICAgICAgICAgICAgICBsZXQgZmlsZURhdGEgPSBmaWxlW1wibmF0aXZlRmlsZVwiXS5zbGljZShcclxuICAgICAgICAgICAgICAgICAgICBjaHVua0luZGV4ICogdGhpcy5idWZmZXJTaXplLFxyXG4gICAgICAgICAgICAgICAgICAgIG5leHRTaXplXHJcbiAgICAgICAgICAgICAgICApO1xyXG4gICAgICAgICAgICAgICAgLy8g6K+75Y+W5paH5Lu2XHJcbiAgICAgICAgICAgICAgICBsZXQgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTtcclxuICAgICAgICAgICAgICAgIHJlYWRlci5yZWFkQXNCaW5hcnlTdHJpbmcoZmlsZURhdGEpO1xyXG4gICAgICAgICAgICAgICAgbGV0IGlubmVySW5kZXggPSBjaHVua0luZGV4O1xyXG4gICAgICAgICAgICAgICAgcmVhZGVyLm9ubG9hZCA9ICgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAvLyDpmYTku7bkuIrkvKBcclxuICAgICAgICAgICAgICAgICAgICBkb2NJbmZvLmZpbGVDb250ZW50ID0gYnRvYShyZWFkZXIucmVzdWx0LnRvU3RyaW5nKCkpO1xyXG4gICAgICAgICAgICAgICAgICAgIGRvY0luZm8uaW5kZXggPSBpbm5lckluZGV4O1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB1cGxvYWRJbmZvLmRvY0luZm8gPSBkb2NJbmZvO1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCBpbmZvID0gdXBsb2FkSW5mbztcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy51cGxvYWRTZXIudXBsb2FkRmlsZShpbmZvKS5zdWJzY3JpYmUoXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIChyZXN1bHQpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQgJiYgcmVzdWx0LmVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8g5YiG54mH5LiK5Lyg5pyJ6L+U5Zue57uT5p6c5bCx5piv5oql6ZSZ5LqGXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JzZXJ2ZXIuZXJyb3IodGhpcy5lcnJvckluZm9Gb3JtYXQocmVzdWx0LmVycm9yLCBbZmlsZV0pKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYnNlcnZlci5jb21wbGV0ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy51cGxvYWRlZENodW5rW3V1aWRdKys7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnVwbG9hZGVkQ2h1bmtbZG9jSW5mby5tZXRhZGF0YUlkXSA9PVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmZpbGVUb3RhbENodW5rW2RvY0luZm8ubWV0YWRhdGFJZF1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8g5Yik5pat5piv5omA5pyJ5YiG54mH6YO95LiK5Lyg5a6M5oiQXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGUucHJvZ3Jlc3MgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0dXM6IFVwbG9hZFN0YXR1cy5Eb25lLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YToge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBlcmNlbnRhZ2U6IDEwMCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGUucmVzcG9uc2UgPSBkb2NJbmZvO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWxldGUgdGhpcy51cGxvYWRlZENodW5rW3V1aWRdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWxldGUgdGhpcy5maWxlVG90YWxDaHVua1t1dWlkXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JzZXJ2ZXIubmV4dCh7IHR5cGU6IFwiZG9uZVwiLCBmaWxlczogW2ZpbGVdIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYnNlcnZlci5jb21wbGV0ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIOWIhueJh+S4iuS8oOato+W4uFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBwZXJjZW50YWdlID0gTnVtYmVyLnBhcnNlSW50KFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICh0aGlzLnVwbG9hZGVkQ2h1bmtbdXVpZF0gLyB0aGlzLmZpbGVUb3RhbENodW5rW3V1aWRdKSAqXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgMTAwXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApLnRvRml4ZWQoMClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8g5Yik5pat5pyq5LiK5Lyg5a6M5oiQXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGUucHJvZ3Jlc3MgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0dXM6IFVwbG9hZFN0YXR1cy5VcGxvYWRpbmcsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGVyY2VudGFnZTogcGVyY2VudGFnZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9ic2VydmVyLm5leHQoeyB0eXBlOiBcInVwbG9hZGluZ1wiLCBmaWxlczogW2ZpbGVdIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgKGVycm9yKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWxldGUgdGhpcy51cGxvYWRlZENodW5rW3V1aWRdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIHRoaXMuZmlsZVRvdGFsQ2h1bmtbdXVpZF07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYnNlcnZlci5lcnJvcih0aGlzLmVycm9ySW5mb0Zvcm1hdChlcnJvciwgW2ZpbGVdKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYnNlcnZlci5jb21wbGV0ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICBjaHVua0luZGV4ID0gY2h1bmtJbmRleCArIDE7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICog6I635Y+W5YiG54mH55qE6ZmE5Lu25aSn5bCPXHJcbiAgICAgKiBAcGFyYW0gc2l6ZVxyXG4gICAgICovXHJcbiAgICBwcml2YXRlIGZvcm1hdEZpbGVTaXplKHNpemU6IG51bWJlcikge1xyXG4gICAgICAgIGlmIChzaXplIDwgMTAyNDAwKSByZXR1cm4gKHNpemUgLyAxMDI0KS50b0ZpeGVkKDEpICsgXCJLXCI7XHJcbiAgICAgICAgZWxzZSBpZiAoc2l6ZSA8IDEwMjQgKiAxMDI0KSByZXR1cm4gKHNpemUgLyAxMDI0KS50b0ZpeGVkKDApICsgXCJLXCI7XHJcbiAgICAgICAgZWxzZSBpZiAoc2l6ZSA8IDEwMCAqIDEwMjQgKiAxMDI0KVxyXG4gICAgICAgICAgICByZXR1cm4gKHNpemUgLyAxMDI0IC8gMTAyNCkudG9GaXhlZCgxKSArIFwiTVwiO1xyXG4gICAgICAgIGVsc2UgaWYgKHNpemUgPCAxMDI0ICogMTAyNCAqIDEwMjQpXHJcbiAgICAgICAgICAgIHJldHVybiAoc2l6ZSAvIDEwMjQgLyAxMDI0KS50b0ZpeGVkKDApICsgXCJNXCI7XHJcbiAgICAgICAgZWxzZSByZXR1cm4gKHNpemUgLyAxMDI0IC8gMTAyNCAvIDEwMjQpLnRvRml4ZWQoMSkgKyBcIkdcIjtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICog6I635Y+W5YiG54mH55qEIOmZhOS7tuWQjeensFxyXG4gICAgICogQHBhcmFtIGZpbGVOYW1lXHJcbiAgICAgKi9cclxuICAgIHByaXZhdGUgZ2V0TXVsdGlwYXJ0RGlzcGxheU5hbWUoZmlsZU5hbWU6IHN0cmluZykge1xyXG4gICAgICAgIGlmIChmaWxlTmFtZS5sZW5ndGggPD0gMTApIHJldHVybiBmaWxlTmFtZTtcclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgbGV0IGhlYWRDb250ZW50ID0gZmlsZU5hbWUuc3Vic3RyaW5nKDAsIDIpO1xyXG4gICAgICAgICAgICBsZXQgdGFpbENvbnRlbnQgPSBmaWxlTmFtZS5zdWJzdHJpbmcoZmlsZU5hbWUubGFzdEluZGV4T2YoXCIuXCIpIC0gMik7XHJcbiAgICAgICAgICAgIHJldHVybiBoZWFkQ29udGVudCArIFwi4oCmXCIgKyB0YWlsQ29udGVudDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBwcml2YXRlIGVycm9ySW5mb0Zvcm1hdChlcnJvciwgZmlsZXMpIHtcclxuICAgICAgICAvL1xyXG4gICAgICAgIGxldCBlcnJvckZpbGVzID0gZmlsZXMubWFwKChpdGVtKSA9PiB7XHJcbiAgICAgICAgICAgIHJldHVybiB7IGlkOiBpdGVtLmlkLCBuYW1lOiBpdGVtLm5hbWUgfTtcclxuICAgICAgICB9KTtcclxuICAgICAgICBsZXQgZXJyb3JNc2c9dGhpcy5jb25maWdTZXIuZ2V0TG9jYWxTdHIoJ3VwbG9hZEFkYXB0LnVwbG9hZEVycm9yJyk7XHJcbiAgICAgICAgaWYgKGVycm9yKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBPYmplY3QuYXNzaWduKFxyXG4gICAgICAgICAgICAgICAgZXJyb3IsXHJcbiAgICAgICAgICAgICAgICB7IGZpbGVzOiBlcnJvckZpbGVzIH0sXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogZXJyb3JbXCJNZXNzYWdlXCJdIHx8IGVycm9yW1wiZXh0ZW5zaW9uTWVzc2FnZVwiXSB8fCBlcnJvck1zZyxcclxuICAgICAgICAgICAgICAgICAgICB0eXBlOiBcImVycm9yXCIsXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcmV0dXJuIE9iamVjdC5hc3NpZ24oXHJcbiAgICAgICAgICAgICAgICB7IGZpbGVzOiBlcnJvckZpbGVzIH0sXHJcbiAgICAgICAgICAgICAgICB7IG1lc3NhZ2U6IGVycm9yTXNnLCB0eXBlOiBcImVycm9yXCIgfVxyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICog6L+U5Zue5pyA57uI5bGe5oCn5YC8XHJcbiAgICAgKiBAcGFyYW0ga2V5XHJcbiAgICAgKiBAcGFyYW0gY29uZmlnVmFsdWVcclxuICAgICAqIEBwYXJhbSBleHRlbmRWYWx1ZVxyXG4gICAgICovXHJcbiAgICBwcml2YXRlIGdldEZpbmFsbHlDb25maWcoa2V5LCBleHRlbmRWYWx1ZSkge1xyXG4gICAgICAgIGlmIChleHRlbmRWYWx1ZSAmJiBleHRlbmRWYWx1ZS5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBleHRlbmRWYWx1ZVtrZXldO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdGhpcy5leHRlbmREYXRhW2tleV07XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBmaW5kRmlsZUluZGV4QnlGaWxlTmFtZShmaWxlczogVXBsb2FkRmlsZVtdLCBmaWxlTmFtZSkge1xyXG4gICAgICAgIC8vIOaMieeFp+iCr+WumuiDveaJvuWIsOaWh+S7tuadpeWkhOeQhlxyXG4gICAgICAgIGxldCBmaW5kSW5kZXggPSBmaWxlcy5maW5kSW5kZXgoKGZpbGUpID0+IGZpbGUubmFtZSA9PSBmaWxlTmFtZSk7XHJcbiAgICAgICAgcmV0dXJuIGZpbmRJbmRleDtcclxuICAgIH1cclxuXHJcbiAgICAvLyNyZWdpb24g5aSn5paH5Lu25YiG54mH5LiK5LygXHJcblxyXG4gICAgdXBsb2FkQmlnRmlsZShcclxuICAgICAgICBmaWxlczogVXBsb2FkRmlsZVtdLFxyXG4gICAgICAgIGV2ZW50OiBVcGxvYWRJbnB1dCxcclxuICAgICAgICBleHRlbmRTZXJ2aWNlOiBGRmlsZVVwbG9hZEFkYXB0VW5pZmlsZUNvbmZpZ1xyXG4gICAgKSB7XHJcbiAgICAgICAgY29uc3QgdXBsb2FkQ2h1bmtzJCA9IG5ldyBTdWJqZWN0KCk7XHJcblxyXG4gICAgICAgIGNvbnN0IF9maWxlcyA9IGZpbGVzLm1hcCgobikgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBjaHVua3MgPSB0aGlzLl9nZXRCaWdGaWxlQ2h1bmtzKG4sIGV2ZW50LCBleHRlbmRTZXJ2aWNlKTtcclxuICAgICAgICAgICAgcmV0dXJuIHsgLi4ubiwgLi4uY2h1bmtzIH07XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGNvbnN0IHVwbG9hZGNodW5rcyQ6IE9ic2VydmFibGU8YW55PltdID0gX2ZpbGVzLm1hcCgoZikgPT5cclxuICAgICAgICAgICAgdGhpcy51cGxvYWRDaHVua3MoZiwgdXBsb2FkQ2h1bmtzJClcclxuICAgICAgICApO1xyXG4gICAgICAgIGNvbmNhdCguLi51cGxvYWRjaHVua3MkKS5zdWJzY3JpYmUoXHJcbiAgICAgICAgICAgIChmOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgICAgIGYucHJvZ3Jlc3MgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc3RhdHVzOiBVcGxvYWRTdGF0dXMuRG9uZSxcclxuICAgICAgICAgICAgICAgICAgICBkYXRhOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBlcmNlbnRhZ2U6IDEwMCxcclxuICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgIGYucmVzcG9uc2UgPSBKU09OLnBhcnNlKGYuY2h1bmtzWzBdLmdldChcImRvY0luZm9cIikpO1xyXG4gICAgICAgICAgICAgICAgdXBsb2FkQ2h1bmtzJC5uZXh0KHsgdHlwZTogXCJkb25lXCIsIGZpbGVzOiBbZl0gfSk7XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIChlcnJvcikgPT4ge1xyXG4gICAgICAgICAgICAgICAgdXBsb2FkQ2h1bmtzJC5lcnJvcih0aGlzLmVycm9ySW5mb0Zvcm1hdChlcnJvciwgZmlsZXMpKTtcclxuICAgICAgICAgICAgICAgIHVwbG9hZENodW5rcyQuY29tcGxldGUoKTtcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgdXBsb2FkQ2h1bmtzJC5jb21wbGV0ZSgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgKTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHVwbG9hZENodW5rcyQuYXNPYnNlcnZhYmxlKCk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSB1cGxvYWRGaWxlQ2h1bmsoZmlsZTogYW55KSB7XHJcbiAgICAgICAgY29uc3QgdXJsID0gYCR7dGhpcy5nZXRQcmVmaXhTdHIoKX0vYXBpL3J1bnRpbWUvZGZzL3YxLjAvZm9ybWRvYy9zbGljZWA7XHJcblxyXG4gICAgICAgIHJldHVybiB0aGlzLnVwbG9hZFNlcltcImh0dHBcIl1bXCJodHRwXCJdXHJcbiAgICAgICAgICAgIC5wb3N0KHVybCwgZmlsZS5jaHVua3NbZmlsZS50b3RhbF0pXHJcbiAgICAgICAgICAgIC5waXBlKFxyXG4gICAgICAgICAgICAgICAgc3dpdGNoTWFwKCgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gb2YoZmlsZSk7XHJcbiAgICAgICAgICAgICAgICB9KSxcclxuICAgICAgICAgICAgICAgIGNhdGNoRXJyb3IoKGVycm9yOiBIdHRwRXJyb3JSZXNwb25zZSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBvZihlcnJvcik7XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICApO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgdXBsb2FkQ2h1bmtzKGZpbGUsIHVwQ2h1bmskOiBTdWJqZWN0PGFueT4pIHtcclxuICAgICAgICBjb25zdCBkb0NodW5rc1JlbWFpbiA9IChpKSA9PiBpID4gLTE7XHJcbiAgICAgICAgY29uc3QgY29tcGxldGVVcGxvYWQgPSAoZikgPT4gb2YoZik7XHJcbiAgICAgICAgY29uc3QgdXBsb2FkQ2h1bmsgPSAoZikgPT4ge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy51cGxvYWRGaWxlQ2h1bmsoZikucGlwZShcclxuICAgICAgICAgICAgICAgIGRlbGF5KDEwMCksXHJcbiAgICAgICAgICAgICAgICBtYXAoKGY6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIOWdl+aVsOS4ujAg5pe277yM5Y2z5Li65q2k5paH5Lu255qE5omA5pyJ5Z2X5Z2H5LiK5Lyg5oiQ5YqfXHJcbiAgICAgICAgICAgICAgICAgICAgZi5wcm9ncmVzcyA9IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzOiBVcGxvYWRTdGF0dXMuVXBsb2FkaW5nLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwZXJjZW50YWdlOiAoKGYudG90YWwgLyBmLmNodW5rcy5sZW5ndGgpICogMTAwKS50b0ZpeGVkKDApLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICAgICAgdXBDaHVuayQubmV4dCh7IHR5cGU6IFwidXBsb2FkaW5nXCIsIGZpbGVzOiBbZl0gfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmO1xyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgKTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIGNvbnN0IGNyZWF0ZU11bHRpcGFydFVwbG9hZCA9IChmKSA9PiBvZihmKTtcclxuXHJcbiAgICAgICAgcmV0dXJuIGNyZWF0ZU11bHRpcGFydFVwbG9hZChmaWxlKS5waXBlKFxyXG4gICAgICAgICAgICAvLyB0YXAoKGYpID0+IGNvbnNvbGUubG9nKFwidXBsb2FkIGZpbGVcIiwgZi5uYW1lKSksXHJcbiAgICAgICAgICAgIGV4cGFuZCgoZikgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKGRvQ2h1bmtzUmVtYWluKC0tZmlsZS50b3RhbCkpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdXBsb2FkQ2h1bmsoZmlsZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gRU1QVFk7XHJcbiAgICAgICAgICAgIH0pLFxyXG4gICAgICAgICAgICAvLyB0YXAoKGY6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICAvLyAgICAgY29uc29sZS5sb2coYGZpbGU6ICR7Zi5uYW1lfSAtIHJlbWFpbmluZyBjaHVua3M6ICR7Zi50b3RhbH1gKTtcclxuICAgICAgICAgICAgLy8gfSksXHJcbiAgICAgICAgICAgIGxhc3QoKSxcclxuICAgICAgICAgICAgc3dpdGNoTWFwKChyZXM6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGNvbXBsZXRlVXBsb2FkKGZpbGUpO1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBfZ2V0QmlnRmlsZUNodW5rcyhcclxuICAgICAgICBmaWxlOiBVcGxvYWRGaWxlLFxyXG4gICAgICAgIGV2ZW50OiBVcGxvYWRJbnB1dCxcclxuICAgICAgICBleHRlbmRTZXJ2aWNlOiBGRmlsZVVwbG9hZEFkYXB0VW5pZmlsZUNvbmZpZ1xyXG4gICAgKSB7XHJcbiAgICAgICAgbGV0IHV1aWQgPSB0aGlzLnV1aWQoKTtcclxuXHJcbiAgICAgICAgY29uc3QgZm9ybUlkID0gdGhpcy5nZXRGaW5hbGx5Q29uZmlnKFwiZm9ybUlkXCIsIGV4dGVuZFNlcnZpY2UpO1xyXG4gICAgICAgIGNvbnN0IHJvb3RJZCA9IHRoaXMuZ2V0RmluYWxseUNvbmZpZyhcInJvb3RJZFwiLCBleHRlbmRTZXJ2aWNlKTtcclxuICAgICAgICBsZXQgcmVhbENodW5rU2l6ZT0oZXZlbnQuY2h1bmtTaXplIHx8IDEpKnRoaXMuYnVmZmVyU2l6ZTtcclxuICAgICAgICBsZXQgY2h1bmtUb3RhbDogbnVtYmVyID0gTWF0aC5jZWlsKGZpbGUuc2l6ZSAvIHJlYWxDaHVua1NpemUpO1xyXG4gICAgICAgIGxldCBjaHVua0luZGV4OiBudW1iZXIgPSAwO1xyXG4gICAgICAgIGNvbnN0IGZpbGVDaHVua3MgPSB7IGNodW5rczogW10sIHRvdGFsOiBjaHVua1RvdGFsIH07XHJcblxyXG4gICAgICAgIHdoaWxlIChjaHVua0luZGV4IDwgY2h1bmtUb3RhbCkge1xyXG4gICAgICAgICAgICBsZXQgdXBsb2FkSW5mbyA9IG5ldyBHc3BGb3JtVXBsb2FkRW50aXR5KCk7XHJcbiAgICAgICAgICAgIHVwbG9hZEluZm8ubW9kZSA9IE9wZXJhdGluZ01vZGVzLlRlbXA7XHJcbiAgICAgICAgICAgIHVwbG9hZEluZm8uZm9ybUlkID0gZm9ybUlkO1xyXG4gICAgICAgICAgICB1cGxvYWRJbmZvLnJvb3RJZCA9IHJvb3RJZDtcclxuXHJcbiAgICAgICAgICAgIGxldCBkb2NJbmZvOiBHc3BGb3JtRG9jSW5mbyA9IG5ldyBHc3BGb3JtRG9jSW5mbygpO1xyXG5cclxuICAgICAgICAgICAgZG9jSW5mby5maWxlTmFtZSA9IGZpbGUubmFtZTtcclxuICAgICAgICAgICAgZG9jSW5mby5tZXRhZGF0YUlkID0gdXVpZDtcclxuICAgICAgICAgICAgZG9jSW5mby50b3RhbCA9IGNodW5rVG90YWw7XHJcblxyXG4gICAgICAgICAgICBsZXQgbmV4dFNpemUgPSBNYXRoLm1pbigoY2h1bmtJbmRleCArIDEpICogcmVhbENodW5rU2l6ZSwgZmlsZS5zaXplKTtcclxuICAgICAgICAgICAgLy8gRmlsZeexu+Wei1xyXG4gICAgICAgICAgICBsZXQgZmlsZURhdGEgPSBmaWxlW1wibmF0aXZlRmlsZVwiXS5zbGljZShcclxuICAgICAgICAgICAgICAgIGNodW5rSW5kZXggKiByZWFsQ2h1bmtTaXplLFxyXG4gICAgICAgICAgICAgICAgbmV4dFNpemVcclxuICAgICAgICAgICAgKTtcclxuXHJcbiAgICAgICAgICAgIGRvY0luZm8uc2l6ZSA9IGZpbGUuc2l6ZTtcclxuICAgICAgICAgICAgZG9jSW5mby5pbmRleCA9IGNodW5rSW5kZXg7XHJcbiAgICAgICAgICAgIGRvY0luZm8uZmlsZUNvbnRlbnQgPSBcIlwiO1xyXG5cclxuICAgICAgICAgICAgLy8g5aaC5p6cZGF0YemHjOacieaVsOaNru+8jOW5tuS4lOWxnuaAp+aYr+mFjee9rueahOaJqeWxleWxnuaAp1xyXG4gICAgICAgICAgICBpZiAoXHJcbiAgICAgICAgICAgICAgICBldmVudC5oYXNPd25Qcm9wZXJ0eShcImRhdGFcIikgJiZcclxuICAgICAgICAgICAgICAgIGV2ZW50W1wiZGF0YVwiXSAmJlxyXG4gICAgICAgICAgICAgICAgZXZlbnRbXCJkYXRhXCJdLmhhc093blByb3BlcnR5KFwiZXh0UHJvcGVydHlcIilcclxuICAgICAgICAgICAgKSB7XHJcbiAgICAgICAgICAgICAgICBkb2NJbmZvW1wiZXh0UHJvcGVydHlcIl0gPSBldmVudFtcImRhdGFcIl1bXHJcbiAgICAgICAgICAgICAgICAgICAgXCJleHRQcm9wZXJ0eVwiXHJcbiAgICAgICAgICAgICAgICBdIGFzIEdzcERvY01ldGFQcm9wZXJ0eTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdXBsb2FkSW5mby5kb2NJbmZvID0gZG9jSW5mbztcclxuXHJcbiAgICAgICAgICAgIC8v5bCB6KOF6K+35rGCZm9ybWRhdGFcclxuICAgICAgICAgICAgbGV0IGZvcm1EYXRhID0gbmV3IEZvcm1EYXRhKCk7XHJcbiAgICAgICAgICAgIGZvcm1EYXRhLmFwcGVuZChcInVwbG9hZEluZm9cIiwgSlNPTi5zdHJpbmdpZnkodXBsb2FkSW5mbykpO1xyXG4gICAgICAgICAgICBmb3JtRGF0YS5hcHBlbmQoXCJkb2NJbmZvXCIsIEpTT04uc3RyaW5naWZ5KGRvY0luZm8pKTtcclxuICAgICAgICAgICAgZm9ybURhdGEuYXBwZW5kKFwiZmlsZVwiLCBmaWxlRGF0YSk7XHJcblxyXG4gICAgICAgICAgICBmaWxlQ2h1bmtzLmNodW5rcy5wdXNoKGZvcm1EYXRhKTtcclxuICAgICAgICAgICAgY2h1bmtJbmRleCA9IGNodW5rSW5kZXggKyAxO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIGZpbGVDaHVua3M7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIOiOt+WPlui3n+ebruW9leeahOmFjee9rlxyXG4gICAgICogQHBhcmFtIHJvb3RJZCBcclxuICAgICAqIEByZXR1cm5zIFxyXG4gICAgICovXHJcbiAgICBwcml2YXRlIGdldFNlcnZlckNvbmZpZyhyb290SWQ6IHN0cmluZykge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnVwbG9hZFNlci5nZXRVcGxvYWRJbmZvKHJvb3RJZCk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8jZW5kcmVnaW9uXHJcblxyXG5cclxuXHJcblxyXG4gICAgLy8jcmVnaW9uIOivu+WPluebuOWFs+mFjee9ruWIhueJh+S4iuS8oOiHs+S6keacjeWKoeWZqFxyXG5cclxuICAgIHByaXZhdGUgdW5vcmRlcmVkVXBsb2FkQmlnRmlsZShmaWxlOiBhbnksIHVwbG9hZENodW5rcyQpIHtcclxuXHJcbiAgICAgICAgaWYgKCAhZmlsZS5wYXJ0TGlzdCkge1xyXG4gICAgICAgICAgICBmaWxlLnBhcnRMaXN0ID0gW107XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLmluaXRNdWx0aVVwbG9hZChmaWxlKS5zdWJzY3JpYmUoKHI6IGFueSkgPT4ge1xyXG5cclxuICAgICAgICAgICAgaWYgKHIgJiYgci5lcnJvcikge1xyXG4gICAgICAgICAgICAgICAgdXBsb2FkQ2h1bmtzJC5lcnJvcih0aGlzLmVycm9ySW5mb0Zvcm1hdChyLmVycm9yLCBbZmlsZV0pKTtcclxuICAgICAgICAgICAgICAgIHVwbG9hZENodW5rcyQuY29tcGxldGUoKTtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgZmlsZS5jaHVua3MuZm9yRWFjaChuID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMubXVsdGlVcGxvYWQobiwgcikuc3Vic2NyaWJlKChyZXM6IGFueSkgPT4ge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAocmVzICYmIHJlcy5lcnJvcikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB1cGxvYWRDaHVua3MkLmVycm9yKHRoaXMuZXJyb3JJbmZvRm9ybWF0KHJlcy5lcnJvciwgW2ZpbGVdKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHVwbG9hZENodW5rcyQuY29tcGxldGUoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGZpbGUucHJvZ3Jlc3MgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1czogVXBsb2FkU3RhdHVzLlVwbG9hZGluZyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YTogIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBlcmNlbnRhZ2U6IChyZXMuaW5kZXggLyBmaWxlLmNodW5rcy5sZW5ndGggKiAxMDApLnRvRml4ZWQoMClcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICAgICAgdXBsb2FkQ2h1bmtzJC5uZXh0KHsgdHlwZTogJ3VwbG9hZGluZycsIGZpbGVzOiBbZmlsZV0gfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlcyAmJiByZXMucmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpbGUucGFydExpc3QucHVzaChyZXMucmVzdWx0KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGZpbGUucGFydExpc3QubGVuZ3RoID09PSBmaWxlLmNodW5rcy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGNvbXBsZXRlTXVsdGlVcGxvYWRSZXF1ZXN0OiBhbnkgPSB7fTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29tcGxldGVNdWx0aVVwbG9hZFJlcXVlc3QubWV0YWRhdGFJZCA9IGZpbGUubWV0YWRhdGFJZDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29tcGxldGVNdWx0aVVwbG9hZFJlcXVlc3QucGFydExpc3QgPSBmaWxlLnBhcnRMaXN0O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb21wbGV0ZU11bHRpVXBsb2FkUmVxdWVzdC5yb290SWQgPSB0aGlzLnJvb3RJZDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29tcGxldGVNdWx0aVVwbG9hZFJlcXVlc3QudXBsb2FkSWQgPSBmaWxlLnVwbG9hZElkO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb21wbGV0ZU11bHRpVXBsb2FkUmVxdWVzdC5zaXplID0gZmlsZS5zaXplO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jb21wbGV0ZU11bHRpVXBsb2FkKGNvbXBsZXRlTXVsdGlVcGxvYWRSZXF1ZXN0KS5zdWJzY3JpYmUoIChjbXVyOiBhbnkpID0+IHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY211ciAmJiBjbXVyLnN0YXR1cyAhPSAyMDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cGxvYWRDaHVua3MkLmVycm9yKHRoaXMuZXJyb3JJbmZvRm9ybWF0KGNtdXIuZXJyb3IsIFtmaWxlXSkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVwbG9hZENodW5rcyQuY29tcGxldGUoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZS5wcm9ncmVzcyA9IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0dXM6IFVwbG9hZFN0YXR1cy5Eb25lLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6ICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBlcmNlbnRhZ2U6IDEwMFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZS5yZXNwb25zZSA9IEpTT04ucGFyc2UoZmlsZS5jaHVua3NbMF0uZ2V0KFwiZG9jSW5mb1wiKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cGxvYWRDaHVua3MkLm5leHQoe3R5cGU6ICdkb25lJywgZmlsZXM6W2ZpbGVdfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVwbG9hZENodW5rcyQuZXJyb3IodGhpcy5lcnJvckluZm9Gb3JtYXQoZXJyb3IsIFtmaWxlXSkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdXBsb2FkQ2h1bmtzJC5jb21wbGV0ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcblxyXG4gICAgdXBsb2FkQmlnRmlsZTIoZmlsZXM6IFVwbG9hZEZpbGVbXSwgZXZlbnQ6IFVwbG9hZElucHV0LCBleHRlbmRTZXJ2aWNlOiBGRmlsZVVwbG9hZEFkYXB0VW5pZmlsZUNvbmZpZykge1xyXG5cclxuICAgICAgICBjb25zdCB1cGxvYWRDaHVua3MkID0gbmV3IFN1YmplY3QoKTtcclxuXHJcbiAgICAgICAgY29uc3QgZm9ybUlkID0gdGhpcy5nZXRGaW5hbGx5Q29uZmlnKCdmb3JtSWQnLCBleHRlbmRTZXJ2aWNlKTtcclxuICAgICAgICBjb25zdCByb290SWQgPSB0aGlzLmdldEZpbmFsbHlDb25maWcoJ3Jvb3RJZCcsIGV4dGVuZFNlcnZpY2UpO1xyXG5cclxuICAgICAgICBjb25zdCBfZmlsZXMgPSBmaWxlcy5tYXAobiA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGNodW5rcyA9IHRoaXMuX2dldEJpZ0ZpbGVDaHVua3MyKG4sIGV2ZW50LCBleHRlbmRTZXJ2aWNlKTtcclxuICAgICAgICAgICAgcmV0dXJuIHsgLi4ubiwgLi4uY2h1bmtzLCBmb3JtSWQsIHJvb3RJZH07XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIC8vIOaXoOW6j+S4iuS8oFxyXG4gICAgICAgIF9maWxlcy5mb3JFYWNoKG4gPT4ge1xyXG4gICAgICAgICAgICB0aGlzLnVub3JkZXJlZFVwbG9hZEJpZ0ZpbGUobiwgdXBsb2FkQ2h1bmtzJCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgXHJcblxyXG4gICAgICAgIC8vIOacieW6j+S4iuS8oFxyXG4gICAgICAgIC8vIGNvbnN0IHVwbG9hZGNodW5rcyQ6IE9ic2VydmFibGU8YW55PltdID0gIF9maWxlcy5tYXAoKGYpID0+IHRoaXMudXBsb2FkQ2h1bmtzMihmLCB1cGxvYWRDaHVua3MkKSk7XHJcbiAgICAgICAgLy8gY29uY2F0KC4uLnVwbG9hZGNodW5rcyQpLnBpcGUoXHJcbiAgICAgICAgLy8gICAgIHN3aXRjaE1hcCgoZjogYW55KSA9PiB7XHJcbiAgICAgICAgLy8gICAgICAgICBsZXQgY29tcGxldGVNdWx0aVVwbG9hZFJlcXVlc3Q6IGFueSA9IHt9O1xyXG4gICAgICAgIC8vICAgICAgICAgY29tcGxldGVNdWx0aVVwbG9hZFJlcXVlc3QubWV0YWRhdGFJZCA9IGYubWV0YWRhdGFJZDtcclxuICAgICAgICAvLyAgICAgICAgIGNvbXBsZXRlTXVsdGlVcGxvYWRSZXF1ZXN0LnBhcnRMaXN0ID0gZi5wYXJ0TGlzdDtcclxuICAgICAgICAvLyAgICAgICAgIGNvbXBsZXRlTXVsdGlVcGxvYWRSZXF1ZXN0LnJvb3RJZCA9IHRoaXMucm9vdElkO1xyXG4gICAgICAgIC8vICAgICAgICAgY29tcGxldGVNdWx0aVVwbG9hZFJlcXVlc3QudXBsb2FkSWQgPSBmLnVwbG9hZElkO1xyXG4gICAgICAgIC8vICAgICAgICAgY29tcGxldGVNdWx0aVVwbG9hZFJlcXVlc3Quc2l6ZSA9IGYuc2l6ZTtcclxuXHJcbiAgICAgICAgLy8gICAgICAgICByZXR1cm4gdGhpcy5jb21wbGV0ZU11bHRpVXBsb2FkKGNvbXBsZXRlTXVsdGlVcGxvYWRSZXF1ZXN0KS5waXBlKFxyXG4gICAgICAgIC8vICAgICAgICAgICAgIG1hcCgoKSA9PiBmKVxyXG4gICAgICAgIC8vICAgICAgICAgKTtcclxuICAgICAgICAvLyAgICAgfSlcclxuICAgICAgICAvLyApLnN1YnNjcmliZShcclxuICAgICAgICAvLyAgICAgKGY6IGFueSkgPT4ge1xyXG4gICAgICAgIC8vICAgICAgICAgZi5wcm9ncmVzcyA9IHtcclxuICAgICAgICAvLyAgICAgICAgICAgICBzdGF0dXM6IFVwbG9hZFN0YXR1cy5Eb25lLFxyXG4gICAgICAgIC8vICAgICAgICAgICAgIGRhdGE6ICB7XHJcbiAgICAgICAgLy8gICAgICAgICAgICAgICAgIHBlcmNlbnRhZ2U6IDEwMFxyXG4gICAgICAgIC8vICAgICAgICAgICAgIH1cclxuICAgICAgICAvLyAgICAgICAgIH07XHJcblxyXG4gICAgICAgIC8vICAgICAgICAgZi5yZXNwb25zZSA9IEpTT04ucGFyc2UoZi5jaHVua3NbMF0uZ2V0KFwiZG9jSW5mb1wiKSk7XHJcbiAgICAgICAgLy8gICAgICAgICB1cGxvYWRDaHVua3MkLm5leHQoe3R5cGU6ICdkb25lJywgZmlsZXM6W2ZdfSk7XHJcbiAgICAgICAgLy8gICAgIH0sXHJcbiAgICAgICAgLy8gICAgIGVycm9yID0+IHtcclxuICAgICAgICAvLyAgICAgICAgIHVwbG9hZENodW5rcyQuZXJyb3IodGhpcy5lcnJvckluZm9Gb3JtYXQoZXJyb3IsIGZpbGVzKSk7XHJcbiAgICAgICAgLy8gICAgICAgICB1cGxvYWRDaHVua3MkLmNvbXBsZXRlKCk7XHJcbiAgICAgICAgLy8gICAgIH0sXHJcbiAgICAgICAgLy8gICAgICgpID0+IHtcclxuICAgICAgICAvLyAgICAgICAgIHVwbG9hZENodW5rcyQuY29tcGxldGUoKTtcclxuICAgICAgICAvLyAgICAgICAgIC8vIGNvbnNvbGUubG9nKFwiYWxsIGZpbGVzIHVwbG9hZGVkXCIpXHJcbiAgICAgICAgLy8gICAgIH1cclxuICAgICAgICAvLyApO1xyXG5cclxuICAgICAgICByZXR1cm4gdXBsb2FkQ2h1bmtzJC5hc09ic2VydmFibGUoKTtcclxuICAgIH1cclxuXHJcblxyXG4gICAgcHJpdmF0ZSBpbml0TXVsdGlVcGxvYWQoZmlsZTogYW55KSB7XHJcbiAgICAgICAgbGV0IGluaXRSZXF1ZXN0OiBhbnkgPSB7fTtcclxuICAgICAgICBpbml0UmVxdWVzdC5wYXRoID0gZmlsZS5mb3JtSWQ7XHJcbiAgICAgICAgaW5pdFJlcXVlc3QubWV0YWRhdGFJZCA9IHRoaXMudXVpZCgpO1xyXG4gICAgICAgIGluaXRSZXF1ZXN0LnJvb3RJZCA9IGZpbGUucm9vdElkO1xyXG4gICAgICAgIGluaXRSZXF1ZXN0LnNpemUgPSBmaWxlLnNpemU7XHJcbiAgICAgICAgaW5pdFJlcXVlc3QuZmlsZU5hbWUgPSBmaWxlLm5hbWU7XHJcblxyXG4gICAgICAgIGxldCB1cmwgPSBgJHt0aGlzLmdldFByZWZpeFN0cigpfS9hcGkvcnVudGltZS9kZnMvdjEuMC9mb3JtZG9jL211bHRpL2luaXRgO1xyXG4gICAgICAgIFxyXG4gICAgICAgIHJldHVybiB0aGlzLnVwbG9hZFNlclsnaHR0cCddWydodHRwJ10ucG9zdCh1cmwsIGluaXRSZXF1ZXN0KS5waXBlKFxyXG4gICAgICAgICAgICB0YXAoKHJlczogYW55KSA9PiB7XHJcbiAgICAgICAgICAgICAgICBmaWxlLm1ldGFkYXRhSWQgPSBpbml0UmVxdWVzdC5tZXRhZGF0YUlkO1xyXG4gICAgICAgICAgICAgICAgZmlsZS51cGxvYWRJZCA9IHJlcy51cGxvYWRJZDtcclxuICAgICAgICAgICAgfSksXHJcbiAgICAgICAgICAgIGNhdGNoRXJyb3IoKGVycm9yOiBIdHRwRXJyb3JSZXNwb25zZSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG9mKGVycm9yKTtcclxuICAgICAgICAgICAgfSksXHJcbiAgICAgICAgICAgIG1hcCggKHJlczogYW55KSA9PiB7XHJcbiAgICAgICAgICAgICAgICByZXMubWV0YWRhdGFJZCA9IGluaXRSZXF1ZXN0Lm1ldGFkYXRhSWQ7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzO1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICk7XHJcblxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgY29tcGxldGVNdWx0aVVwbG9hZChyZXF1ZXN0OiBhbnkpOiBPYnNlcnZhYmxlPGFueT4ge1xyXG5cclxuICAgICAgICBsZXQgdXJsID0gYCR7dGhpcy5nZXRQcmVmaXhTdHIoKX0vYXBpL3J1bnRpbWUvZGZzL3YxLjAvZm9ybWRvYy9tdWx0aS9jb21wbGV0ZWA7XHJcbiAgICBcclxuICAgICAgICByZXR1cm4gdGhpcy51cGxvYWRTZXJbJ2h0dHAnXVsnaHR0cCddLnBvc3QodXJsLCByZXF1ZXN0KS5waXBlKFxyXG4gICAgICAgICAgICB0YXAoKHJlcykgPT4ge30pLFxyXG4gICAgICAgICAgICBjYXRjaEVycm9yKChlcnJvcjogSHR0cEVycm9yUmVzcG9uc2UpID0+IHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBvZihlcnJvcik7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIG11bHRpVXBsb2FkKGZvcm1kYXRhOiBGb3JtRGF0YSwgcjogYW55KTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgICAgICBsZXQgdXJsID1gJHt0aGlzLmdldFByZWZpeFN0cigpfS9hcGkvcnVudGltZS9kZnMvdjEuMC9mb3JtZG9jL211bHRpL3VwbG9hZGA7XHJcbiAgICAgICAgY29uc3QgbXIgPSBKU09OLnBhcnNlKGZvcm1kYXRhLmdldCgnbXVsdGlSZXF1ZXN0JykgYXMgYW55KTtcclxuICAgICAgICBtci51cGxvYWRJZCA9IHIudXBsb2FkSWQ7XHJcbiAgICAgICAgbXIubWV0YWRhdGFJZCA9IHIubWV0YWRhdGFJZDtcclxuICAgICAgICBmb3JtZGF0YS5zZXQoJ211bHRpUmVxdWVzdCcsIEpTT04uc3RyaW5naWZ5KG1yKSk7XHJcblxyXG4gICAgICAgIGNvbnN0IGRpID0gSlNPTi5wYXJzZShmb3JtZGF0YS5nZXQoJ2RvY0luZm8nKSBhcyBhbnkpO1xyXG4gICAgICAgIGRpLm1ldGFkYXRhSWQgPSByLm1ldGFkYXRhSWQ7XHJcbiAgICAgICAgZm9ybWRhdGEuc2V0KCdkb2NJbmZvJywgSlNPTi5zdHJpbmdpZnkoZGkpKTtcclxuXHJcbiAgICAgICAgcmV0dXJuICB0aGlzLnVwbG9hZFNlclsnaHR0cCddWydodHRwJ10ucG9zdCh1cmwsIGZvcm1kYXRhKS5waXBlKFxyXG4gICAgICAgICAgICB0YXAocmVzID0+IHsgfSksXHJcbiAgICAgICAgICAgIGNhdGNoRXJyb3IoKGVycm9yOiBIdHRwRXJyb3JSZXNwb25zZSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG9mKGVycm9yKTtcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICApO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgdXBsb2FkQ2h1bmtzMihmaWxlLCB1cENodW5rJDogU3ViamVjdDxhbnk+KSB7XHJcblxyXG4gICAgICAgIGNvbnN0IHRvdGFsID0gZmlsZS50b3RhbDtcclxuXHJcbiAgICAgICAgbGV0IHQgPSAtMTtcclxuXHJcblxyXG4gICAgICAgIGNvbnN0IGRvQ2h1bmtzUmVtYWluID0gKGkpID0+IGkgPCB0b3RhbDtcclxuICAgICAgICBjb25zdCBjb21wbGV0ZVVwbG9hZCA9IChmKSA9PiBvZihmKTtcclxuICAgICAgICBjb25zdCB1cGxvYWRDaHVuayA9IChmLCB1cGxvYWRJZDogYW55KSA9PiB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLm11bHRpVXBsb2FkKGYsIHVwbG9hZElkKS5waXBlKFxyXG4gICAgICAgICAgICAgICAgZGVsYXkoMTAwKSxcclxuICAgICAgICAgICAgICAgIG1hcCgocmVzOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAvLyDlnZfmlbDkuLowIOaXtu+8jOWNs+S4uuatpOaWh+S7tueahOaJgOacieWdl+Wdh+S4iuS8oOaIkOWKn1xyXG4gICAgICAgICAgICAgICAgICAgIGZpbGUucHJvZ3Jlc3MgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1czogVXBsb2FkU3RhdHVzLlVwbG9hZGluZyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YTogIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBlcmNlbnRhZ2U6IChyZXMuaW5kZXggLyBmaWxlLmNodW5rcy5sZW5ndGggKiAxMDApLnRvRml4ZWQoMClcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICAgICAgdXBDaHVuayQubmV4dCh7IHR5cGU6ICd1cGxvYWRpbmcnLCBmaWxlczogW2ZpbGVdIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXMgJiYgcmVzLnJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoICFmaWxlLnBhcnRMaXN0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlLnBhcnRMaXN0ID0gW107XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgZmlsZS5wYXJ0TGlzdC5wdXNoKHJlcy5yZXN1bHQpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmlsZTtcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIClcclxuICAgICAgICB9O1xyXG4gICAgICAgIGNvbnN0IGNyZWF0ZU11bHRpcGFydFVwbG9hZCA9IChmKSA9PiB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmluaXRNdWx0aVVwbG9hZChmKTtcclxuICAgICAgICAgICAgLy8gcmV0dXJuIG9mKGYpXHJcbiAgICAgICAgfTtcclxuXHJcblxyXG4gICAgICAgIHJldHVybiBjcmVhdGVNdWx0aXBhcnRVcGxvYWQoZmlsZSkucGlwZShcclxuICAgICAgICAgICAgLy8gdGFwKChmKSA9PiBjb25zb2xlLmxvZyhcInVwbG9hZCBmaWxlXCIsIGYubmFtZSkpLFxyXG4gICAgICAgICAgICBleHBhbmQoKHI6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKGRvQ2h1bmtzUmVtYWluKCsrdCkpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdXBsb2FkQ2h1bmsoZmlsZS5jaHVua3NbdF0sIHIpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIEVNUFRZO1xyXG4gICAgICAgICAgICB9KSxcclxuICAgICAgICAgICAgLy8gdGFwKChmOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgLy8gICAgIGNvbnNvbGUubG9nKGBmaWxlOiAke2YubmFtZX0gLSByZW1haW5pbmcgY2h1bmtzOiAke2YudG90YWx9YCk7XHJcbiAgICAgICAgICAgIC8vIH0pLFxyXG4gICAgICAgICAgICBsYXN0KCksXHJcbiAgICAgICAgICAgIHN3aXRjaE1hcCgocmVzOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBjb21wbGV0ZVVwbG9hZChmaWxlKTtcclxuXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIF9nZXRCaWdGaWxlQ2h1bmtzMihmaWxlOiBVcGxvYWRGaWxlLCBldmVudDogVXBsb2FkSW5wdXQsIGV4dGVuZFNlcnZpY2U6IEZGaWxlVXBsb2FkQWRhcHRVbmlmaWxlQ29uZmlnKSB7XHJcbiAgICAgICAgbGV0IHV1aWQgPSB0aGlzLnV1aWQoKTtcclxuICAgICAgICBcclxuICAgICAgICBjb25zdCBfYmlmZmVyU2l6ZSA9IE1hdGgubWF4KGV2ZW50LmNodW5rU2l6ZSw1KSp0aGlzLmJ1ZmZlclNpemU7XHJcblxyXG4gICAgICAgIGxldCBjaHVua1RvdGFsOiBudW1iZXIgPSBNYXRoLmNlaWwoZmlsZS5zaXplIC8gX2JpZmZlclNpemUpO1xyXG4gICAgICAgIGxldCBjaHVua0luZGV4OiBudW1iZXIgPSAwO1xyXG4gICAgICAgIGNvbnN0IGZpbGVDaHVua3MgPSB7Y2h1bmtzOiBbXSwgdG90YWw6IGNodW5rVG90YWx9O1xyXG5cclxuICAgICAgICBjb25zdCByb290SWQgPSB0aGlzLmdldEZpbmFsbHlDb25maWcoJ3Jvb3RJZCcsIGV4dGVuZFNlcnZpY2UpO1xyXG5cclxuXHJcbiAgICAgICAgd2hpbGUgKGNodW5rSW5kZXggPCBjaHVua1RvdGFsKSB7XHJcblxyXG4gICAgICAgICAgICBsZXQgbmV4dFNpemUgPSBNYXRoLm1pbigoY2h1bmtJbmRleCArIDEpICogX2JpZmZlclNpemUsIGZpbGUuc2l6ZSk7XHJcbiAgICAgICAgICAgIC8vIEZpbGXnsbvlnotcclxuICAgICAgICAgICAgbGV0IGZpbGVEYXRhID0gZmlsZVsnbmF0aXZlRmlsZSddLnNsaWNlKGNodW5rSW5kZXggKiBfYmlmZmVyU2l6ZSwgbmV4dFNpemUpO1xyXG5cclxuICAgICAgICAgICAgbGV0IG11bHRpUmVxdWVzdDogYW55ID0ge307XHJcbiAgICAgICAgICAgIG11bHRpUmVxdWVzdC5tZXRhZGF0YUlkID0gdXVpZDtcclxuICAgICAgICAgICAgbXVsdGlSZXF1ZXN0LnJvb3RJZCA9IHJvb3RJZDtcclxuICAgICAgICAgICAgLy8gbXVsdGlSZXF1ZXN0LnVwbG9hZElkID0gdXBsb2FkSWQ7XHJcbiAgICAgICAgICAgIG11bHRpUmVxdWVzdC5pbmRleCA9IGNodW5rSW5kZXg7XHJcbiAgICAgICAgICAgIG11bHRpUmVxdWVzdC50b3RhbCA9IGNodW5rVG90YWw7XHJcbiAgICAgICAgICAgIG11bHRpUmVxdWVzdC5zaXplID0gZmlsZURhdGEuc2l6ZTtcclxuICAgICAgXHJcbiAgICAgICAgICAgIC8v5bCB6KOF6K+35rGCZm9ybWRhdGFcclxuICAgICAgICAgICAgbGV0IGZvcm1EYXRhID0gbmV3IEZvcm1EYXRhKCk7XHJcbiAgICAgICAgICAgIGZvcm1EYXRhLmFwcGVuZCgnbXVsdGlSZXF1ZXN0JywgSlNPTi5zdHJpbmdpZnkobXVsdGlSZXF1ZXN0KSk7XHJcbiAgICAgICAgICAgIGZvcm1EYXRhLmFwcGVuZCgnZmlsZScsIGZpbGVEYXRhKTtcclxuXHJcblxyXG4gICAgICAgICAgICBsZXQgZG9jSW5mbzogR3NwRm9ybURvY0luZm8gPSBuZXcgR3NwRm9ybURvY0luZm8oKTtcclxuXHJcbiAgICAgICAgICAgIGRvY0luZm8uZmlsZU5hbWUgPSBmaWxlLm5hbWU7XHJcbiAgICAgICAgICAgIGRvY0luZm8ubWV0YWRhdGFJZCA9IHV1aWQ7XHJcbiAgICAgICAgICAgIGRvY0luZm8udG90YWwgPSBjaHVua1RvdGFsO1xyXG4gICAgICAgICAgICBkb2NJbmZvLnNpemUgPSBmaWxlLnNpemU7XHJcbiAgICAgICAgICAgIGRvY0luZm8uaW5kZXggPSBjaHVua0luZGV4O1xyXG4gICAgICAgICAgICBkb2NJbmZvLmZpbGVDb250ZW50ID0gXCJcIjtcclxuXHJcbiAgICAgICAgICAgIGZvcm1EYXRhLmFwcGVuZChcImRvY0luZm9cIiwgSlNPTi5zdHJpbmdpZnkoZG9jSW5mbykpO1xyXG5cclxuICAgICAgICAgICAgLy8g5aaC5p6cZGF0YemHjOacieaVsOaNru+8jOW5tuS4lOWxnuaAp+aYr+mFjee9rueahOaJqeWxleWxnuaAp1xyXG4gICAgICAgICAgICBpZiAoXHJcbiAgICAgICAgICAgICAgICBldmVudC5oYXNPd25Qcm9wZXJ0eShcImRhdGFcIikgJiZcclxuICAgICAgICAgICAgICAgIGV2ZW50W1wiZGF0YVwiXSAmJlxyXG4gICAgICAgICAgICAgICAgZXZlbnRbXCJkYXRhXCJdLmhhc093blByb3BlcnR5KFwiZXh0UHJvcGVydHlcIilcclxuICAgICAgICAgICAgKSB7XHJcbiAgICAgICAgICAgICAgICBkb2NJbmZvW1wiZXh0UHJvcGVydHlcIl0gPSBldmVudFtcImRhdGFcIl1bXHJcbiAgICAgICAgICAgICAgICAgICAgXCJleHRQcm9wZXJ0eVwiXHJcbiAgICAgICAgICAgICAgICBdIGFzIEdzcERvY01ldGFQcm9wZXJ0eTtcclxuICAgICAgICAgICAgfVxyXG5cclxuXHJcblxyXG4gICAgICAgICAgICBmaWxlQ2h1bmtzLmNodW5rcy5wdXNoKGZvcm1EYXRhKTtcclxuICAgICAgICAgICAgY2h1bmtJbmRleCA9IGNodW5rSW5kZXggKyAxO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIGZpbGVDaHVua3M7XHJcbiAgICBcclxuICAgIH1cclxuXHJcblxyXG5cclxuICAgIC8vI2VuZHJlZ2lvblxyXG5cclxufVxyXG4iXX0=
/**
 * @fileoverview added by tsickle
 * Generated from: lib/ffileupload-adapt-unifile.service.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Injectable, Injector, Optional } from "@angular/core";
import { UploadServerService, UploadStatus, } from "@farris/extend-file-upload";
import { Observable, forkJoin, of, EMPTY, concat, Subject } from "rxjs";
import { UploadService, GspFormUploadListEntity, GspFormRemoveListEntity, GspFormDocInfo, GspFormUploadEntity, OperatingModes, } from "@gsp-svc/formdoc-upload";
import { FFileUploadAdaptUnifileConfigService, } from "./ffileupload-adapt-unifile.config";
import { catchError, delay, expand, last, map, switchMap, tap, } from "rxjs/operators";
import { LocaleService } from "@farris/ui-locale";
import * as i0 from "@angular/core";
import * as i1 from "@gsp-svc/formdoc-upload";
import * as i2 from "./ffileupload-adapt-unifile.config";
/**
 * @record
 */
export function UploadServerConfig() { }
if (false) {
    /** @type {?} */
    UploadServerConfig.prototype.sameNameAllowed;
    /** @type {?} */
    UploadServerConfig.prototype.maxFileSize;
    /** @type {?} */
    UploadServerConfig.prototype.allowedMultiUpload;
    /** @type {?|undefined} */
    UploadServerConfig.prototype.uploadedFileInfoList;
    /** @type {?|undefined} */
    UploadServerConfig.prototype.oldUploadedFileList;
}
export class FfileuploadAdaptUnifileService extends UploadServerService {
    /**
     * @param {?} uploadSer
     * @param {?} configSer
     * @param {?} inject
     */
    constructor(uploadSer, configSer, inject) {
        super();
        this.uploadSer = uploadSer;
        this.configSer = configSer;
        this.inject = inject;
        // 暂时用于简单合并
        this.bufferSize = 1024 * 1024;
        this.uploadedChunk = {};
        this.fileTotalChunk = {};
        this.serverConfig = null;
        this.extendData = this.configSer.getConfig();
        // 开始创建多语言服务
        /** @type {?} */
        let hasLocalSer = this.configSer.setLocalState(null);
        if (this.inject && !hasLocalSer) {
            // 如果存在inject，再次创建，inject是在某个版不能之后才出现的
            this.configSer.setLocalState(this.inject.get(LocaleService, null));
        }
    }
    /**
     * 因为被附件组件作为依赖类，导致此处获取不到最新的基路径值
     * @private
     * @return {?}
     */
    getPrefixStr() {
        return this.configSer.getBasePath();
    }
    /**
     * @private
     * @return {?}
     */
    uuid() {
        /** @type {?} */
        let S4 = (/**
         * @return {?}
         */
        function () {
            return (((1 + Math.random()) * 0x10000) | 0).toString(16).substring(1);
        });
        /** @type {?} */
        let nGuid = S4() + S4() + '-' + S4() + '-' + S4() + '-' + S4() + '-' + S4() + S4() + S4();
        return nGuid;
    }
    /**
     * 删除文件
     * @param {?} files
     * @param {?} event
     * @param {?} extendService
     * @return {?}
     */
    remove(files, event, extendService) {
        return this.innerRemoveList(files, event, extendService);
    }
    /**
     * @private
     * @param {?} files
     * @param {?} event
     * @param {?=} extendService
     * @return {?}
     */
    innerRemoveList(files, event, extendService = null) {
        return new Observable((/**
         * @param {?} observer
         * @return {?}
         */
        (observer) => {
            /** @type {?} */
            let removeFileInfo = new GspFormRemoveListEntity();
            /** @type {?} */
            let metadataIdList = [];
            files.forEach((/**
             * @param {?} fileItem
             * @return {?}
             */
            (fileItem) => {
                if (fileItem["response"]) {
                    metadataIdList.push(fileItem["response"]["metadataId"]);
                }
            }));
            removeFileInfo.mode = this.getFinallyConfig("mode", extendService);
            /** @type {?} */
            let rootId = this.getFinallyConfig("rootId", extendService);
            removeFileInfo.metadataIdList = [].concat(metadataIdList);
            this.uploadSer.removeList(metadataIdList, rootId).subscribe((/**
             * @param {?} result
             * @return {?}
             */
            (result) => {
                // 没有需要整合的服务器端返回数据
                observer.next({ type: "removed", files: files });
            }), (/**
             * @param {?} error
             * @return {?}
             */
            (error) => {
                observer.error(error);
                observer.complete();
            }), (/**
             * @return {?}
             */
            () => {
                observer.complete();
            }));
        }));
    }
    /**
     * 上传文件
     * @param {?} files
     * @param {?} event
     * @param {?} extendService
     * @return {?}
     */
    upload(files, event, extendService) {
        this.formId = this.getFinallyConfig("formId", extendService);
        this.rootId = this.getFinallyConfig("rootId", extendService);
        if (event.type == "sliceUpload") {
            /** @type {?} */
            const up$ = (/**
             * @return {?}
             */
            () => {
                if (this.serverConfig && this.serverConfig.allowedMultiUpload) {
                    if (!this.serverConfig.sameNameAllowed) {
                        return this.uploadSer.getUploadedFileInfoList(this.formId, this.rootId).pipe(switchMap((/**
                         * @param {?} res
                         * @return {?}
                         */
                        (res) => {
                            if (res != null && res.error == null) {
                                this.serverConfig.uploadedFileInfoList = res;
                                this.serverConfig.oldUploadedFileList = JSON.parse(JSON.stringify(res));
                                return this.uploadBigFile2(files, event, extendService);
                            }
                            return of(res);
                        })));
                    }
                    else {
                        return this.uploadBigFile2(files, event, extendService);
                    }
                }
                else {
                    return this.uploadBigFile(files, event, extendService);
                }
            });
            if (!this.serverConfig) {
                return this.getServerConfig(this.rootId).pipe(switchMap((/**
                 * @param {?} res
                 * @return {?}
                 */
                (res) => {
                    if (res != null && res.error == null) {
                        this.serverConfig = {
                            sameNameAllowed: res.sameNameAllowed,
                            allowedMultiUpload: res.allowedMultiUpload,
                            maxFileSize: parseInt(JSON.parse(res.validateConfiguration).maxFileSize)
                        };
                    }
                    return up$();
                })));
            }
            return up$();
        }
        return this.innerUploadList(files, event, extendService);
    }
    /**
     * 内部上传方式
     * @private
     * @param {?} files
     * @param {?} event
     * @param {?} extendService
     * @return {?}
     */
    innerUploadList(files, event, extendService) {
        return new Observable((/**
         * @param {?} observer
         * @return {?}
         */
        (observer) => {
            /** @type {?} */
            let uploadInfo = new GspFormUploadListEntity();
            uploadInfo.formId = this.getFinallyConfig("formId", extendService);
            uploadInfo.mode = this.getFinallyConfig("mode", extendService);
            /** @type {?} */
            let rootId = this.getFinallyConfig("rootId", extendService);
            uploadInfo.docInfoList = [];
            /** @type {?} */
            let readerObserable = [];
            files.forEach((/**
             * @param {?} fileItem
             * @return {?}
             */
            (fileItem) => {
                /** @type {?} */
                let sub = new Observable((/**
                 * @param {?} obser
                 * @return {?}
                 */
                (obser) => {
                    /** @type {?} */
                    let reader = new FileReader();
                    // 暂不处理异常
                    reader.readAsBinaryString(fileItem.nativeFile);
                    reader.onload = (/**
                     * @param {?} e
                     * @return {?}
                     */
                    (e) => {
                        /** @type {?} */
                        let info = (/** @type {?} */ ({ fileName: "", fileContent: "" }));
                        info["fileName"] = fileItem.name;
                        info["fileContent"] = btoa(reader.result.toString());
                        // 如果data里有数据，并且属性是配置的扩展属性
                        if (event.hasOwnProperty("data") &&
                            event["data"] &&
                            event["data"].hasOwnProperty("extProperty")) {
                            //
                            info["extProperty"] = event["data"]["extProperty"];
                        }
                        uploadInfo.docInfoList.push(info);
                        obser.next();
                        obser.complete();
                    });
                }));
                readerObserable.push(sub);
            }));
            forkJoin(readerObserable).subscribe((/**
             * @param {?} datas
             * @return {?}
             */
            (datas) => {
                //     metadataId: string;
                //  fileName: string;
                this.uploadSer.uploadList(uploadInfo, rootId).subscribe((/**
                 * @param {?} result
                 * @return {?}
                 */
                (result) => {
                    if (result.error) {
                        // 此接口一旦出现问题，所有附件都上传不通过
                        observer.error(this.errorInfoFormat(result.error, files));
                        observer.complete();
                        return;
                    }
                    // 合并返回结果到此处
                    result.forEach((/**
                     * @param {?} item
                     * @return {?}
                     */
                    (item) => {
                        /** @type {?} */
                        var findIndex = this.findFileIndexByFileName(files, item.fileName);
                        if (findIndex > -1) {
                            files[findIndex]["response"] = item;
                            files[findIndex]["progress"]["status"] = UploadStatus.Done;
                        }
                    }));
                    observer.next({ type: "done", files: files });
                }), (/**
                 * @param {?} error
                 * @return {?}
                 */
                (error) => {
                    observer.error(this.errorInfoFormat(error, files));
                    observer.complete();
                }), (/**
                 * @return {?}
                 */
                () => {
                    observer.complete();
                }));
            }));
        }));
    }
    /**
     * 分片加载
     * @param {?} file
     * @param {?} event
     * @param {?} extendService
     * @return {?}
     */
    multipartUpload(file, event, extendService) {
        return new Observable((/**
         * @param {?} observer
         * @return {?}
         */
        (observer) => {
            // let fileInfo: FileInfo;
            /** @type {?} */
            let uuid = this.uuid();
            // let uuid = UUID.UUID();
            //reader.readAsBinaryString(selectedFile);
            //reader.onload = (e) => {
            /** @type {?} */
            let fileName = file.name;
            // fileInfo = {
            //   id: uuid,
            //   name: fileName,
            //   type: file.type,
            //   source: "",
            //   size: this.formatFileSize(file.size),
            //   fileSize: file.size,
            //   picListDisplayName: this.getMultipartDisplayName(fileName),
            //   queueListDisplayName: fileName,
            //   //content: reader.result.toString(),
            //   hasUploaded: false,
            //   mouseOn: false,
            //   selectd: false,
            //   isUploading: true,
            //   uploadResult: false,
            //   uploadProcess: 0,
            //   errorMessage: "",
            //   extensionDropListId: 0,
            //   extensionName: ""
            // }
            /** @type {?} */
            let chunkTotal = Math.ceil(file.size / this.bufferSize);
            // 标记当前附件总的分片数
            this.fileTotalChunk[uuid] = chunkTotal;
            /** @type {?} */
            let chunkIndex = 0;
            // 标记当前附件成功的分片数
            this.uploadedChunk[uuid] = 0;
            while (chunkIndex < chunkTotal) {
                /** @type {?} */
                let uploadInfo = new GspFormUploadEntity();
                uploadInfo.mode = OperatingModes.Temp;
                uploadInfo.formId = this.getFinallyConfig("formId", extendService);
                uploadInfo.rootId = this.getFinallyConfig("rootId", extendService);
                /** @type {?} */
                let docInfo = new GspFormDocInfo();
                docInfo.fileName = fileName;
                docInfo.metadataId = uuid;
                docInfo.total = chunkTotal;
                // 如果data里有数据，并且属性是配置的扩展属性
                if (event.hasOwnProperty("data") &&
                    event["data"] &&
                    event["data"].hasOwnProperty("extProperty")) {
                    docInfo["extProperty"] = (/** @type {?} */ (event["data"]["extProperty"]));
                }
                // 下一个文件大小
                /** @type {?} */
                let nextSize = Math.min((chunkIndex + 1) * this.bufferSize, file.size);
                // File类型
                /** @type {?} */
                let fileData = file["nativeFile"].slice(chunkIndex * this.bufferSize, nextSize);
                // 读取文件
                /** @type {?} */
                let reader = new FileReader();
                reader.readAsBinaryString(fileData);
                /** @type {?} */
                let innerIndex = chunkIndex;
                reader.onload = (/**
                 * @return {?}
                 */
                () => {
                    // 附件上传
                    docInfo.fileContent = btoa(reader.result.toString());
                    docInfo.index = innerIndex;
                    uploadInfo.docInfo = docInfo;
                    /** @type {?} */
                    let info = uploadInfo;
                    this.uploadSer.uploadFile(info).subscribe((/**
                     * @param {?} result
                     * @return {?}
                     */
                    (result) => {
                        if (result && result.error) {
                            // 分片上传有返回结果就是报错了
                            observer.error(this.errorInfoFormat(result.error, [file]));
                            observer.complete();
                            return;
                        }
                        else {
                            this.uploadedChunk[uuid]++;
                            if (this.uploadedChunk[docInfo.metadataId] ==
                                this.fileTotalChunk[docInfo.metadataId]) {
                                // 判断是所有分片都上传完成
                                file.progress = {
                                    status: UploadStatus.Done,
                                    data: {
                                        percentage: 100,
                                    },
                                };
                                file.response = docInfo;
                                delete this.uploadedChunk[uuid];
                                delete this.fileTotalChunk[uuid];
                                observer.next({ type: "done", files: [file] });
                                observer.complete();
                            }
                            else {
                                // 分片上传正常
                                /** @type {?} */
                                const percentage = Number.parseInt(((this.uploadedChunk[uuid] / this.fileTotalChunk[uuid]) *
                                    100).toFixed(0));
                                // 判断未上传完成
                                file.progress = {
                                    status: UploadStatus.Uploading,
                                    data: {
                                        percentage: percentage,
                                    },
                                };
                                observer.next({ type: "uploading", files: [file] });
                            }
                        }
                    }), (/**
                     * @param {?} error
                     * @return {?}
                     */
                    (error) => {
                        delete this.uploadedChunk[uuid];
                        delete this.fileTotalChunk[uuid];
                        observer.error(this.errorInfoFormat(error, [file]));
                        observer.complete();
                    }));
                });
                chunkIndex = chunkIndex + 1;
            }
        }));
    }
    /**
     * 获取分片的附件大小
     * @private
     * @param {?} size
     * @return {?}
     */
    formatFileSize(size) {
        if (size < 102400)
            return (size / 1024).toFixed(1) + "K";
        else if (size < 1024 * 1024)
            return (size / 1024).toFixed(0) + "K";
        else if (size < 100 * 1024 * 1024)
            return (size / 1024 / 1024).toFixed(1) + "M";
        else if (size < 1024 * 1024 * 1024)
            return (size / 1024 / 1024).toFixed(0) + "M";
        else
            return (size / 1024 / 1024 / 1024).toFixed(1) + "G";
    }
    /**
     * 获取分片的 附件名称
     * @private
     * @param {?} fileName
     * @return {?}
     */
    getMultipartDisplayName(fileName) {
        if (fileName.length <= 10)
            return fileName;
        else {
            /** @type {?} */
            let headContent = fileName.substring(0, 2);
            /** @type {?} */
            let tailContent = fileName.substring(fileName.lastIndexOf(".") - 2);
            return headContent + "…" + tailContent;
        }
    }
    /**
     * @private
     * @param {?} error
     * @param {?} files
     * @return {?}
     */
    errorInfoFormat(error, files) {
        //
        /** @type {?} */
        let errorFiles = files.map((/**
         * @param {?} item
         * @return {?}
         */
        (item) => {
            return { id: item.id, name: item.name };
        }));
        /** @type {?} */
        let errorMsg = this.configSer.getLocalStr('uploadAdapt.uploadError');
        if (error) {
            return Object.assign(error, { files: errorFiles }, {
                message: error["Message"] || error["extensionMessage"] || errorMsg,
                type: "error",
            });
        }
        else {
            return Object.assign({ files: errorFiles }, { message: errorMsg, type: "error" });
        }
    }
    /**
     * 返回最终属性值
     * @private
     * @param {?} key
     * @param {?} extendValue
     * @return {?}
     */
    getFinallyConfig(key, extendValue) {
        if (extendValue && extendValue.hasOwnProperty(key)) {
            return extendValue[key];
        }
        return this.extendData[key];
    }
    /**
     * @private
     * @param {?} files
     * @param {?} fileName
     * @return {?}
     */
    findFileIndexByFileName(files, fileName) {
        // 按照肯定能找到文件来处理
        /** @type {?} */
        let findIndex = files.findIndex((/**
         * @param {?} file
         * @return {?}
         */
        (file) => file.name == fileName));
        return findIndex;
    }
    //#region 大文件分片上传
    /**
     * @param {?} files
     * @param {?} event
     * @param {?} extendService
     * @return {?}
     */
    uploadBigFile(files, event, extendService) {
        /** @type {?} */
        const uploadChunks$ = new Subject();
        /** @type {?} */
        const _files = files.map((/**
         * @param {?} n
         * @return {?}
         */
        (n) => {
            /** @type {?} */
            const chunks = this._getBigFileChunks(n, event, extendService);
            return Object.assign({}, n, chunks);
        }));
        /** @type {?} */
        const uploadchunks$ = _files.map((/**
         * @param {?} f
         * @return {?}
         */
        (f) => this.uploadChunks(f, uploadChunks$)));
        concat(...uploadchunks$).subscribe((/**
         * @param {?} f
         * @return {?}
         */
        (f) => {
            f.progress = {
                status: UploadStatus.Done,
                data: {
                    percentage: 100,
                },
            };
            f.response = JSON.parse(f.chunks[0].get("docInfo"));
            uploadChunks$.next({ type: "done", files: [f] });
        }), (/**
         * @param {?} error
         * @return {?}
         */
        (error) => {
            uploadChunks$.error(this.errorInfoFormat(error, files));
            uploadChunks$.complete();
        }), (/**
         * @return {?}
         */
        () => {
            uploadChunks$.complete();
        }));
        return uploadChunks$.asObservable();
    }
    /**
     * @private
     * @param {?} file
     * @return {?}
     */
    uploadFileChunk(file) {
        /** @type {?} */
        const url = `${this.getPrefixStr()}/api/runtime/dfs/v1.0/formdoc/slice`;
        return this.uploadSer["http"]["http"]
            .post(url, file.chunks[file.total])
            .pipe(switchMap((/**
         * @return {?}
         */
        () => {
            return of(file);
        })), catchError((/**
         * @param {?} error
         * @return {?}
         */
        (error) => {
            return of(error);
        })));
    }
    /**
     * @private
     * @param {?} file
     * @param {?} upChunk$
     * @return {?}
     */
    uploadChunks(file, upChunk$) {
        /** @type {?} */
        const doChunksRemain = (/**
         * @param {?} i
         * @return {?}
         */
        (i) => i > -1);
        /** @type {?} */
        const completeUpload = (/**
         * @param {?} f
         * @return {?}
         */
        (f) => of(f));
        /** @type {?} */
        const uploadChunk = (/**
         * @param {?} f
         * @return {?}
         */
        (f) => {
            return this.uploadFileChunk(f).pipe(delay(100), map((/**
             * @param {?} f
             * @return {?}
             */
            (f) => {
                // 块数为0 时，即为此文件的所有块均上传成功
                f.progress = {
                    status: UploadStatus.Uploading,
                    data: {
                        percentage: ((f.total / f.chunks.length) * 100).toFixed(0),
                    },
                };
                upChunk$.next({ type: "uploading", files: [f] });
                return f;
            })));
        });
        /** @type {?} */
        const createMultipartUpload = (/**
         * @param {?} f
         * @return {?}
         */
        (f) => of(f));
        return createMultipartUpload(file).pipe(
        // tap((f) => console.log("upload file", f.name)),
        expand((/**
         * @param {?} f
         * @return {?}
         */
        (f) => {
            if (doChunksRemain(--file.total)) {
                return uploadChunk(file);
            }
            return EMPTY;
        })), 
        // tap((f: any) => {
        //     console.log(`file: ${f.name} - remaining chunks: ${f.total}`);
        // }),
        last(), switchMap((/**
         * @param {?} res
         * @return {?}
         */
        (res) => {
            return completeUpload(file);
        })));
    }
    /**
     * @private
     * @param {?} file
     * @param {?} event
     * @param {?} extendService
     * @return {?}
     */
    _getBigFileChunks(file, event, extendService) {
        /** @type {?} */
        let uuid = this.uuid();
        /** @type {?} */
        const formId = this.getFinallyConfig("formId", extendService);
        /** @type {?} */
        const rootId = this.getFinallyConfig("rootId", extendService);
        /** @type {?} */
        let realChunkSize = (event.chunkSize || 1) * this.bufferSize;
        /** @type {?} */
        let chunkTotal = Math.ceil(file.size / realChunkSize);
        /** @type {?} */
        let chunkIndex = 0;
        /** @type {?} */
        const fileChunks = { chunks: [], total: chunkTotal };
        while (chunkIndex < chunkTotal) {
            /** @type {?} */
            let uploadInfo = new GspFormUploadEntity();
            uploadInfo.mode = OperatingModes.Temp;
            uploadInfo.formId = formId;
            uploadInfo.rootId = rootId;
            /** @type {?} */
            let docInfo = new GspFormDocInfo();
            docInfo.fileName = file.name;
            docInfo.metadataId = uuid;
            docInfo.total = chunkTotal;
            /** @type {?} */
            let nextSize = Math.min((chunkIndex + 1) * realChunkSize, file.size);
            // File类型
            /** @type {?} */
            let fileData = file["nativeFile"].slice(chunkIndex * realChunkSize, nextSize);
            docInfo.size = file.size;
            docInfo.index = chunkIndex;
            docInfo.fileContent = "";
            // 如果data里有数据，并且属性是配置的扩展属性
            if (event.hasOwnProperty("data") &&
                event["data"] &&
                event["data"].hasOwnProperty("extProperty")) {
                docInfo["extProperty"] = (/** @type {?} */ (event["data"]["extProperty"]));
            }
            uploadInfo.docInfo = docInfo;
            //封装请求formdata
            /** @type {?} */
            let formData = new FormData();
            formData.append("uploadInfo", JSON.stringify(uploadInfo));
            formData.append("docInfo", JSON.stringify(docInfo));
            formData.append("file", fileData);
            fileChunks.chunks.push(formData);
            chunkIndex = chunkIndex + 1;
        }
        return fileChunks;
    }
    /**
     * 获取跟目录的配置
     * @private
     * @param {?} rootId
     * @return {?}
     */
    getServerConfig(rootId) {
        return this.uploadSer.getUploadInfo(rootId);
    }
    //#endregion
    //#region 读取相关配置分片上传至云服务器
    /**
     * @private
     * @param {?} file
     * @param {?} uploadChunks$
     * @return {?}
     */
    unorderedUploadBigFile(file, uploadChunks$) {
        if (!file.partList) {
            file.partList = [];
        }
        this.initMultiUpload(file).subscribe((/**
         * @param {?} r
         * @return {?}
         */
        (r) => {
            if (r && r.error) {
                uploadChunks$.error(this.errorInfoFormat(r.error, [file]));
                uploadChunks$.complete();
                return;
            }
            file.chunks.forEach((/**
             * @param {?} n
             * @return {?}
             */
            n => {
                this.multiUpload(n, r).subscribe((/**
                 * @param {?} res
                 * @return {?}
                 */
                (res) => {
                    if (res && res.error) {
                        uploadChunks$.error(this.errorInfoFormat(res.error, [file]));
                        uploadChunks$.complete();
                        return;
                    }
                    file.progress = {
                        status: UploadStatus.Uploading,
                        data: {
                            percentage: (res.index / file.chunks.length * 100).toFixed(0)
                        }
                    };
                    uploadChunks$.next({ type: 'uploading', files: [file] });
                    if (res && res.result) {
                        file.partList.push(res.result);
                    }
                    if (file.partList.length === file.chunks.length) {
                        /** @type {?} */
                        let completeMultiUploadRequest = {};
                        completeMultiUploadRequest.metadataId = file.metadataId;
                        completeMultiUploadRequest.partList = file.partList;
                        completeMultiUploadRequest.rootId = this.rootId;
                        completeMultiUploadRequest.uploadId = file.uploadId;
                        completeMultiUploadRequest.size = file.size;
                        this.completeMultiUpload(completeMultiUploadRequest).subscribe((/**
                         * @param {?} cmur
                         * @return {?}
                         */
                        (cmur) => {
                            if (cmur && cmur.status != 200) {
                                uploadChunks$.error(this.errorInfoFormat(cmur.error, [file]));
                                uploadChunks$.complete();
                                return;
                            }
                            file.progress = {
                                status: UploadStatus.Done,
                                data: {
                                    percentage: 100
                                }
                            };
                            file.response = JSON.parse(file.chunks[0].get("docInfo"));
                            uploadChunks$.next({ type: 'done', files: [file] });
                        }), (/**
                         * @param {?} error
                         * @return {?}
                         */
                        error => {
                            uploadChunks$.error(this.errorInfoFormat(error, [file]));
                            uploadChunks$.complete();
                        }));
                    }
                }));
            }));
        }));
    }
    /**
     * @param {?} files
     * @param {?} event
     * @param {?} extendService
     * @return {?}
     */
    uploadBigFile2(files, event, extendService) {
        /** @type {?} */
        const uploadChunks$ = new Subject();
        /** @type {?} */
        const formId = this.getFinallyConfig('formId', extendService);
        /** @type {?} */
        const rootId = this.getFinallyConfig('rootId', extendService);
        /** @type {?} */
        const _files = files.map((/**
         * @param {?} n
         * @return {?}
         */
        n => {
            /** @type {?} */
            const chunks = this._getBigFileChunks2(n, event, extendService);
            return Object.assign({}, n, chunks, { formId, rootId });
        }));
        // 无序上传
        _files.forEach((/**
         * @param {?} n
         * @return {?}
         */
        n => {
            this.unorderedUploadBigFile(n, uploadChunks$);
        }));
        // 有序上传
        // const uploadchunks$: Observable<any>[] =  _files.map((f) => this.uploadChunks2(f, uploadChunks$));
        // concat(...uploadchunks$).pipe(
        //     switchMap((f: any) => {
        //         let completeMultiUploadRequest: any = {};
        //         completeMultiUploadRequest.metadataId = f.metadataId;
        //         completeMultiUploadRequest.partList = f.partList;
        //         completeMultiUploadRequest.rootId = this.rootId;
        //         completeMultiUploadRequest.uploadId = f.uploadId;
        //         completeMultiUploadRequest.size = f.size;
        //         return this.completeMultiUpload(completeMultiUploadRequest).pipe(
        //             map(() => f)
        //         );
        //     })
        // ).subscribe(
        //     (f: any) => {
        //         f.progress = {
        //             status: UploadStatus.Done,
        //             data:  {
        //                 percentage: 100
        //             }
        //         };
        //         f.response = JSON.parse(f.chunks[0].get("docInfo"));
        //         uploadChunks$.next({type: 'done', files:[f]});
        //     },
        //     error => {
        //         uploadChunks$.error(this.errorInfoFormat(error, files));
        //         uploadChunks$.complete();
        //     },
        //     () => {
        //         uploadChunks$.complete();
        //         // console.log("all files uploaded")
        //     }
        // );
        return uploadChunks$.asObservable();
    }
    /**
     * @private
     * @param {?} file
     * @return {?}
     */
    initMultiUpload(file) {
        /** @type {?} */
        let initRequest = {};
        initRequest.path = file.formId;
        initRequest.metadataId = this.uuid();
        initRequest.rootId = file.rootId;
        initRequest.size = file.size;
        initRequest.fileName = file.name;
        /** @type {?} */
        let url = `${this.getPrefixStr()}/api/runtime/dfs/v1.0/formdoc/multi/init`;
        return this.uploadSer['http']['http'].post(url, initRequest).pipe(tap((/**
         * @param {?} res
         * @return {?}
         */
        (res) => {
            file.metadataId = initRequest.metadataId;
            file.uploadId = res.uploadId;
        })), catchError((/**
         * @param {?} error
         * @return {?}
         */
        (error) => {
            return of(error);
        })), map((/**
         * @param {?} res
         * @return {?}
         */
        (res) => {
            res.metadataId = initRequest.metadataId;
            return res;
        })));
    }
    /**
     * @private
     * @param {?} request
     * @return {?}
     */
    completeMultiUpload(request) {
        /** @type {?} */
        let url = `${this.getPrefixStr()}/api/runtime/dfs/v1.0/formdoc/multi/complete`;
        return this.uploadSer['http']['http'].post(url, request).pipe(tap((/**
         * @param {?} res
         * @return {?}
         */
        (res) => { })), catchError((/**
         * @param {?} error
         * @return {?}
         */
        (error) => {
            return of(error);
        })));
    }
    /**
     * @private
     * @param {?} formdata
     * @param {?} r
     * @return {?}
     */
    multiUpload(formdata, r) {
        /** @type {?} */
        let url = `${this.getPrefixStr()}/api/runtime/dfs/v1.0/formdoc/multi/upload`;
        /** @type {?} */
        const mr = JSON.parse((/** @type {?} */ (formdata.get('multiRequest'))));
        mr.uploadId = r.uploadId;
        mr.metadataId = r.metadataId;
        formdata.set('multiRequest', JSON.stringify(mr));
        /** @type {?} */
        const di = JSON.parse((/** @type {?} */ (formdata.get('docInfo'))));
        di.metadataId = r.metadataId;
        formdata.set('docInfo', JSON.stringify(di));
        return this.uploadSer['http']['http'].post(url, formdata).pipe(tap((/**
         * @param {?} res
         * @return {?}
         */
        res => { })), catchError((/**
         * @param {?} error
         * @return {?}
         */
        (error) => {
            return of(error);
        })));
    }
    /**
     * @private
     * @param {?} file
     * @param {?} upChunk$
     * @return {?}
     */
    uploadChunks2(file, upChunk$) {
        /** @type {?} */
        const total = file.total;
        /** @type {?} */
        let t = -1;
        /** @type {?} */
        const doChunksRemain = (/**
         * @param {?} i
         * @return {?}
         */
        (i) => i < total);
        /** @type {?} */
        const completeUpload = (/**
         * @param {?} f
         * @return {?}
         */
        (f) => of(f));
        /** @type {?} */
        const uploadChunk = (/**
         * @param {?} f
         * @param {?} uploadId
         * @return {?}
         */
        (f, uploadId) => {
            return this.multiUpload(f, uploadId).pipe(delay(100), map((/**
             * @param {?} res
             * @return {?}
             */
            (res) => {
                // 块数为0 时，即为此文件的所有块均上传成功
                file.progress = {
                    status: UploadStatus.Uploading,
                    data: {
                        percentage: (res.index / file.chunks.length * 100).toFixed(0)
                    }
                };
                upChunk$.next({ type: 'uploading', files: [file] });
                if (res && res.result) {
                    if (!file.partList) {
                        file.partList = [];
                    }
                    file.partList.push(res.result);
                }
                return file;
            })));
        });
        /** @type {?} */
        const createMultipartUpload = (/**
         * @param {?} f
         * @return {?}
         */
        (f) => {
            return this.initMultiUpload(f);
            // return of(f)
        });
        return createMultipartUpload(file).pipe(
        // tap((f) => console.log("upload file", f.name)),
        expand((/**
         * @param {?} r
         * @return {?}
         */
        (r) => {
            if (doChunksRemain(++t)) {
                return uploadChunk(file.chunks[t], r);
            }
            return EMPTY;
        })), 
        // tap((f: any) => {
        //     console.log(`file: ${f.name} - remaining chunks: ${f.total}`);
        // }),
        last(), switchMap((/**
         * @param {?} res
         * @return {?}
         */
        (res) => {
            return completeUpload(file);
        })));
    }
    /**
     * @private
     * @param {?} file
     * @param {?} event
     * @param {?} extendService
     * @return {?}
     */
    _getBigFileChunks2(file, event, extendService) {
        /** @type {?} */
        let uuid = this.uuid();
        /** @type {?} */
        const _bifferSize = Math.max(event.chunkSize, 5) * this.bufferSize;
        /** @type {?} */
        let chunkTotal = Math.ceil(file.size / _bifferSize);
        /** @type {?} */
        let chunkIndex = 0;
        /** @type {?} */
        const fileChunks = { chunks: [], total: chunkTotal };
        /** @type {?} */
        const rootId = this.getFinallyConfig('rootId', extendService);
        while (chunkIndex < chunkTotal) {
            /** @type {?} */
            let nextSize = Math.min((chunkIndex + 1) * _bifferSize, file.size);
            // File类型
            /** @type {?} */
            let fileData = file['nativeFile'].slice(chunkIndex * _bifferSize, nextSize);
            /** @type {?} */
            let multiRequest = {};
            multiRequest.metadataId = uuid;
            multiRequest.rootId = rootId;
            // multiRequest.uploadId = uploadId;
            multiRequest.index = chunkIndex;
            multiRequest.total = chunkTotal;
            multiRequest.size = fileData.size;
            //封装请求formdata
            /** @type {?} */
            let formData = new FormData();
            formData.append('multiRequest', JSON.stringify(multiRequest));
            formData.append('file', fileData);
            /** @type {?} */
            let docInfo = new GspFormDocInfo();
            docInfo.fileName = file.name;
            docInfo.metadataId = uuid;
            docInfo.total = chunkTotal;
            docInfo.size = file.size;
            docInfo.index = chunkIndex;
            docInfo.fileContent = "";
            formData.append("docInfo", JSON.stringify(docInfo));
            // 如果data里有数据，并且属性是配置的扩展属性
            if (event.hasOwnProperty("data") &&
                event["data"] &&
                event["data"].hasOwnProperty("extProperty")) {
                docInfo["extProperty"] = (/** @type {?} */ (event["data"]["extProperty"]));
            }
            fileChunks.chunks.push(formData);
            chunkIndex = chunkIndex + 1;
        }
        return fileChunks;
    }
}
FfileuploadAdaptUnifileService.previous = 0;
FfileuploadAdaptUnifileService.decorators = [
    { type: Injectable, args: [{
                providedIn: "root",
            },] }
];
/** @nocollapse */
FfileuploadAdaptUnifileService.ctorParameters = () => [
    { type: UploadService },
    { type: FFileUploadAdaptUnifileConfigService },
    { type: Injector, decorators: [{ type: Optional }] }
];
/** @nocollapse */ FfileuploadAdaptUnifileService.ngInjectableDef = i0.defineInjectable({ factory: function FfileuploadAdaptUnifileService_Factory() { return new FfileuploadAdaptUnifileService(i0.inject(i1.UploadService), i0.inject(i2.FFileUploadAdaptUnifileConfigService), i0.inject(i0.INJECTOR, 8)); }, token: FfileuploadAdaptUnifileService, providedIn: "root" });
if (false) {
    /**
     * @type {?}
     * @private
     */
    FfileuploadAdaptUnifileService.previous;
    /** @type {?} */
    FfileuploadAdaptUnifileService.prototype.extendData;
    /** @type {?} */
    FfileuploadAdaptUnifileService.prototype.bufferSize;
    /**
     * @type {?}
     * @private
     */
    FfileuploadAdaptUnifileService.prototype.uploadedChunk;
    /**
     * @type {?}
     * @private
     */
    FfileuploadAdaptUnifileService.prototype.fileTotalChunk;
    /**
     * @type {?}
     * @private
     */
    FfileuploadAdaptUnifileService.prototype.formId;
    /**
     * @type {?}
     * @private
     */
    FfileuploadAdaptUnifileService.prototype.rootId;
    /**
     * @type {?}
     * @private
     */
    FfileuploadAdaptUnifileService.prototype.serverConfig;
    /**
     * @type {?}
     * @private
     */
    FfileuploadAdaptUnifileService.prototype.uploadSer;
    /**
     * @type {?}
     * @private
     */
    FfileuploadAdaptUnifileService.prototype.configSer;
    /**
     * @type {?}
     * @private
     */
    FfileuploadAdaptUnifileService.prototype.inject;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmZpbGV1cGxvYWQtYWRhcHQtdW5pZmlsZS5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy9leHRlbmQtZmlsZXVwbG9hZC1hZGFwdC11bmlmaWxlLyIsInNvdXJjZXMiOlsibGliL2ZmaWxldXBsb2FkLWFkYXB0LXVuaWZpbGUuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUMsUUFBUSxFQUFFLFFBQVEsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUM5RCxPQUFPLEVBQ0gsbUJBQW1CLEVBR25CLFlBQVksR0FDZixNQUFNLDRCQUE0QixDQUFDO0FBQ3BDLE9BQU8sRUFBRSxVQUFVLEVBQUUsUUFBUSxFQUFFLEVBQUUsRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFFLE9BQU8sRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUN4RSxPQUFPLEVBQ0gsYUFBYSxFQUNiLHVCQUF1QixFQUN2Qix1QkFBdUIsRUFDdkIsY0FBYyxFQUNkLG1CQUFtQixFQUVuQixjQUFjLEdBRWpCLE1BQU0seUJBQXlCLENBQUM7QUFDakMsT0FBTyxFQUNILG9DQUFvQyxHQUV2QyxNQUFNLG9DQUFvQyxDQUFDO0FBQzVDLE9BQU8sRUFDSCxVQUFVLEVBQ1YsS0FBSyxFQUNMLE1BQU0sRUFDTixJQUFJLEVBQ0osR0FBRyxFQUNILFNBQVMsRUFDVCxHQUFHLEdBQ04sTUFBTSxnQkFBZ0IsQ0FBQztBQUV4QixPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sbUJBQW1CLENBQUM7Ozs7Ozs7QUFHbEQsd0NBTUM7OztJQUxHLDZDQUF5Qjs7SUFDekIseUNBQW9COztJQUNwQixnREFBNEI7O0lBQzVCLGtEQUEyQjs7SUFDM0IsaURBQTBCOztBQU85QixNQUFNLE9BQU8sOEJBQStCLFNBQVEsbUJBQW1COzs7Ozs7SUFVbkUsWUFDWSxTQUF3QixFQUN4QixTQUErQyxFQUNuQyxNQUFlO1FBRW5DLEtBQUssRUFBRSxDQUFDO1FBSkEs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RSxDQUFDO1lBRXpCLFFBQVEsQ0FBQyxNQUFNLENBQUMsU0FBUyxFQUFFLElBQUksQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQztZQUVwRCwwQkFBMEI7WUFDMUIsSUFDSSxLQUFLLENBQUMsY0FBYyxDQUFDLE1BQU0sQ0FBQztnQkFDNUIsS0FBSyxDQUFDLE1BQU0sQ0FBQztnQkFDYixLQUFLLENBQUMsTUFBTSxDQUFDLENBQUMsY0FBYyxDQUFDLGFBQWEsQ0FBQyxFQUM3QztnQkFDRSxPQUFPLENBQUMsYUFBYSxDQUFDLEdBQUcsbUJBQUEsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUNsQyxhQUFhLENBQ2hCLEVBQXNCLENBQUM7YUFDM0I7WUFJRCxVQUFVLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQztZQUNqQyxVQUFVLEdBQUcsVUFBVSxHQUFHLENBQUMsQ0FBQztTQUMvQjtRQUVELE9BQU8sVUFBVSxDQUFDO0lBRXRCLENBQUM7O0FBdjRCYyx1Q0FBUSxHQUFHLENBQUMsQ0FBQzs7WUFOL0IsVUFBVSxTQUFDO2dCQUNSLFVBQVUsRUFBRSxNQUFNO2FBQ3JCOzs7O1lBckNHLGFBQWE7WUFVYixvQ0FBb0M7WUFuQnBCLFFBQVEsdUJBNERuQixRQUFROzs7Ozs7OztJQVZiLHdDQUE0Qjs7SUFGNUIsb0RBQVc7O0lBQ1gsb0RBQXlCOzs7OztJQUV6Qix1REFBMkI7Ozs7O0lBQzNCLHdEQUE0Qjs7Ozs7SUFDNUIsZ0RBQXVCOzs7OztJQUN2QixnREFBdUI7Ozs7O0lBQ3ZCLHNEQUFpRDs7Ozs7SUFHN0MsbURBQWdDOzs7OztJQUNoQyxtREFBdUQ7Ozs7O0lBQ3ZELGdEQUFtQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUsSW5qZWN0b3IsIE9wdGlvbmFsIH0gZnJvbSBcIkBhbmd1bGFyL2NvcmVcIjtcclxuaW1wb3J0IHtcclxuICAgIFVwbG9hZFNlcnZlclNlcnZpY2UsXHJcbiAgICBVcGxvYWRGaWxlLFxyXG4gICAgVXBsb2FkSW5wdXQsXHJcbiAgICBVcGxvYWRTdGF0dXMsXHJcbn0gZnJvbSBcIkBmYXJyaXMvZXh0ZW5kLWZpbGUtdXBsb2FkXCI7XHJcbmltcG9ydCB7IE9ic2VydmFibGUsIGZvcmtKb2luLCBvZiwgRU1QVFksIGNvbmNhdCwgU3ViamVjdCB9IGZyb20gXCJyeGpzXCI7XHJcbmltcG9ydCB7XHJcbiAgICBVcGxvYWRTZXJ2aWNlLFxyXG4gICAgR3NwRm9ybVVwbG9hZExpc3RFbnRpdHksXHJcbiAgICBHc3BGb3JtUmVtb3ZlTGlzdEVudGl0eSxcclxuICAgIEdzcEZvcm1Eb2NJbmZvLFxyXG4gICAgR3NwRm9ybVVwbG9hZEVudGl0eSxcclxuICAgIEZpbGVJbmZvLFxyXG4gICAgT3BlcmF0aW5nTW9kZXMsXHJcbiAgICBHc3BEb2NNZXRhUHJvcGVydHksXHJcbn0gZnJvbSBcIkBnc3Atc3ZjL2Zvcm1kb2MtdXBsb2FkXCI7XHJcbmltcG9ydCB7XHJcbiAgICBGRmlsZVVwbG9hZEFkYXB0VW5pZmlsZUNvbmZpZ1NlcnZpY2UsXHJcbiAgICBGRmlsZVVwbG9hZEFkYXB0VW5pZmlsZUNvbmZpZyxcclxufSBmcm9tIFwiLi9mZmlsZXVwbG9hZC1hZGFwdC11bmlmaWxlLmNvbmZpZ1wiO1xyXG5pbXBvcnQge1xyXG4gICAgY2F0Y2hFcnJvcixcclxuICAgIGRlbGF5LFxyXG4gICAgZXhwYW5kLFxyXG4gICAgbGFzdCxcclxuICAgIG1hcCxcclxuICAgIHN3aXRjaE1hcCxcclxuICAgIHRhcCxcclxufSBmcm9tIFwicnhqcy9vcGVyYXRvcnNcIjtcclxuaW1wb3J0IHsgSHR0cEVycm9yUmVzcG9uc2UgfSBmcm9tIFwiQGFuZ3VsYXIvY29tbW9uL2h0dHBcIjtcclxuaW1wb3J0IHsgTG9jYWxlU2VydmljZSB9IGZyb20gXCJAZmFycmlzL3VpLWxvY2FsZVwiO1xyXG5cclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgVXBsb2FkU2VydmVyQ29uZmlnIHtcclxuICAgIHNhbWVOYW1lQWxsb3dlZDogYm9vbGVhbjtcclxuICAgIG1heEZpbGVTaXplOiBudW1iZXI7XHJcbiAgICBhbGxvd2VkTXVsdGlVcGxvYWQ6IGJvb2xlYW47XHJcbiAgICB1cGxvYWRlZEZpbGVJbmZvTGlzdD86IGFueTtcclxuICAgIG9sZFVwbG9hZGVkRmlsZUxpc3Q/OiBhbnk7XHJcbn1cclxuXHJcblxyXG5ASW5qZWN0YWJsZSh7XHJcbiAgICBwcm92aWRlZEluOiBcInJvb3RcIixcclxufSlcclxuZXhwb3J0IGNsYXNzIEZmaWxldXBsb2FkQWRhcHRVbmlmaWxlU2VydmljZSBleHRlbmRzIFVwbG9hZFNlcnZlclNlcnZpY2Uge1xyXG4gICAgZXh0ZW5kRGF0YTsgLy8g5pqC5pe255So5LqO566A5Y2V5ZCI5bm2XHJcbiAgICBidWZmZXJTaXplID0gMTAyNCAqIDEwMjQ7XHJcbiAgICBwcml2YXRlIHN0YXRpYyBwcmV2aW91cyA9IDA7XHJcbiAgICBwcml2YXRlIHVwbG9hZGVkQ2h1bmsgPSB7fTtcclxuICAgIHByaXZhdGUgZmlsZVRvdGFsQ2h1bmsgPSB7fTtcclxuICAgIHByaXZhdGUgZm9ybUlkOiBzdHJpbmc7XHJcbiAgICBwcml2YXRlIHJvb3RJZDogc3RyaW5nO1xyXG4gICAgcHJpdmF0ZSBzZXJ2ZXJDb25maWcgOiBVcGxvYWRTZXJ2ZXJDb25maWcgPSBudWxsO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKFxyXG4gICAgICAgIHByaXZhdGUgdXBsb2FkU2VyOiBVcGxvYWRTZXJ2aWNlLFxyXG4gICAgICAgIHByaXZhdGUgY29uZmlnU2VyOiBGRmlsZVVwbG9hZEFkYXB0VW5pZmlsZUNvbmZpZ1NlcnZpY2UsXHJcbiAgICAgICAgQE9wdGlvbmFsKCkgcHJpdmF0ZSBpbmplY3Q6SW5qZWN0b3JcclxuICAgICkge1xyXG4gICAgICAgIHN1cGVyKCk7ICAgICAgICBcclxuICAgICAgICB0aGlzLmV4dGVuZERhdGEgPSB0aGlzLmNvbmZpZ1Nlci5nZXRDb25maWcoKTtcclxuICAgICAgICAvLyDlvIDlp4vliJvlu7rlpJror63oqIDmnI3liqFcclxuICAgICAgICBsZXQgaGFzTG9jYWxTZXI9dGhpcy5jb25maWdTZXIuc2V0TG9jYWxTdGF0ZShudWxsKTtcclxuICAgICAgICBpZiggdGhpcy5pbmplY3QgJiYgIWhhc0xvY2FsU2VyKXtcclxuICAgICAgICAgICAgLy8g5aaC5p6c5a2Y5ZyoaW5qZWN077yM5YaN5qyh5Yib5bu677yMaW5qZWN05piv5Zyo5p+Q5Liq54mI5LiN6IO95LmL5ZCO5omN5Ye6546w55qEXHJcbiAgICAgICAgICAgIHRoaXMuY29uZmlnU2VyLnNldExvY2FsU3RhdGUodGhpcy5pbmplY3QuZ2V0KExvY2FsZVNlcnZpY2UsbnVsbCkpO1xyXG4gICAgICAgICB9XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIOWboOS4uuiiq+mZhOS7tue7hOS7tuS9nOS4uuS+nei1luexu++8jOWvvOiHtOatpOWkhOiOt+WPluS4jeWIsOacgOaWsOeahOWfuui3r+W+hOWAvFxyXG4gICAgICogQHJldHVybnMgXHJcbiAgICAgKi9cclxuICAgIHByaXZhdGUgZ2V0UHJlZml4U3RyKCl7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY29uZmlnU2VyLmdldEJhc2VQYXRoKCk7XHJcbiAgICB9XHJcbiAgICBwcml2YXRlIHV1aWQoKSB7XHJcbiAgICAgICAgbGV0IFM0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gKCgoMSArIE1hdGgucmFuZG9tKCkpICogMHgxMDAwMCkgfCAwKS50b1N0cmluZygxNikuc3Vic3RyaW5nKDEpO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgbGV0IG5HdWlkID0gUzQoKSArIFM0KCkrICctJyArIFM0KCkrICctJyArIFM0KCkrICctJyArIFM0KCkrICctJyArIFM0KCkgKyBTNCgpICsgUzQoKTtcclxuICAgICAgICByZXR1cm4gbkd1aWQ7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIOWIoOmZpOaWh+S7tlxyXG4gICAgICogQHBhcmFtIGZpbGVcclxuICAgICAqIEBwYXJhbSBldmVudFxyXG4gICAgICovXHJcbiAgICByZW1vdmUoXHJcbiAgICAgICAgZmlsZXM6IFVwbG9hZEZpbGVbXSxcclxuICAgICAgICBldmVudDogVXBsb2FkSW5wdXQsXHJcbiAgICAgICAgZXh0ZW5kU2VydmljZTogRkZpbGVVcGxvYWRBZGFwdFVuaWZpbGVDb25maWdcclxuICAgICk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuaW5uZXJSZW1vdmVMaXN0KGZpbGVzLCBldmVudCwgZXh0ZW5kU2VydmljZSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBpbm5lclJlbW92ZUxpc3QoXHJcbiAgICAgICAgZmlsZXM6IFVwbG9hZEZpbGVbXSxcclxuICAgICAgICBldmVudDogVXBsb2FkSW5wdXQsXHJcbiAgICAgICAgZXh0ZW5kU2VydmljZSA9IG51bGxcclxuICAgICk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBPYnNlcnZhYmxlKChvYnNlcnZlcikgPT4ge1xyXG4gICAgICAgICAgICBsZXQgcmVtb3ZlRmlsZUluZm8gPSBuZXcgR3NwRm9ybVJlbW92ZUxpc3RFbnRpdHkoKTtcclxuICAgICAgICAgICAgbGV0IG1ldGFkYXRhSWRMaXN0ID0gW107XHJcbiAgICAgICAgICAgIGZpbGVzLmZvckVhY2goKGZpbGVJdGVtKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAoZmlsZUl0ZW1bXCJyZXNwb25zZVwiXSkge1xyXG4gICAgICAgICAgICAgICAgICAgIG1ldGFkYXRhSWRMaXN0LnB1c2goZmlsZUl0ZW1bXCJyZXNwb25zZVwiXVtcIm1ldGFkYXRhSWRcIl0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHJlbW92ZUZpbGVJbmZvLm1vZGUgPSB0aGlzLmdldEZpbmFsbHlDb25maWcoXCJtb2RlXCIsIGV4dGVuZFNlcnZpY2UpO1xyXG4gICAgICAgICAgICBsZXQgcm9vdElkID0gdGhpcy5nZXRGaW5hbGx5Q29uZmlnKFwicm9vdElkXCIsIGV4dGVuZFNlcnZpY2UpO1xyXG4gICAgICAgICAgICByZW1vdmVGaWxlSW5mby5tZXRhZGF0YUlkTGlzdCA9IFtdLmNvbmNhdChtZXRhZGF0YUlkTGlzdCk7XHJcblxyXG4gICAgICAgICAgICB0aGlzLnVwbG9hZFNlci5yZW1vdmVMaXN0KG1ldGFkYXRhSWRMaXN0LCByb290SWQpLnN1YnNjcmliZShcclxuICAgICAgICAgICAgICAgIChyZXN1bHQpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAvLyDmsqHmnInpnIDopoHmlbTlkIjnmoTmnI3liqHlmajnq6/ov5Tlm57mlbDmja5cclxuICAgICAgICAgICAgICAgICAgICBvYnNlcnZlci5uZXh0KHsgdHlwZTogXCJyZW1vdmVkXCIsIGZpbGVzOiBmaWxlcyB9KTtcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAoZXJyb3IpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBvYnNlcnZlci5lcnJvcihlcnJvcik7XHJcbiAgICAgICAgICAgICAgICAgICAgb2JzZXJ2ZXIuY29tcGxldGUoKTtcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgb2JzZXJ2ZXIuY29tcGxldGUoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICog5LiK5Lyg5paH5Lu2XHJcbiAgICAgKiBAcGFyYW0gZmlsZVxyXG4gICAgICogQHBhcmFtIGV2ZW50XHJcbiAgICAgKi9cclxuICAgIHVwbG9hZChcclxuICAgICAgICBmaWxlczogVXBsb2FkRmlsZVtdLFxyXG4gICAgICAgIGV2ZW50OiBVcGxvYWRJbnB1dCxcclxuICAgICAgICBleHRlbmRTZXJ2aWNlOiBGRmlsZVVwbG9hZEFkYXB0VW5pZmlsZUNvbmZpZ1xyXG4gICAgKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgICAgICB0aGlzLmZvcm1JZCA9IHRoaXMuZ2V0RmluYWxseUNvbmZpZyhcImZvcm1JZFwiLCBleHRlbmRTZXJ2aWNlKTtcclxuICAgICAgICB0aGlzLnJvb3RJZCA9IHRoaXMuZ2V0RmluYWxseUNvbmZpZyhcInJvb3RJZFwiLCBleHRlbmRTZXJ2aWNlKTtcclxuICAgICAgICBpZiAoZXZlbnQudHlwZSA9PSBcInNsaWNlVXBsb2FkXCIpIHtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IHVwJCA9ICgpID0+IHtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLnNlcnZlckNvbmZpZyAmJiB0aGlzLnNlcnZlckNvbmZpZy5hbGxvd2VkTXVsdGlVcGxvYWQpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMuc2VydmVyQ29uZmlnLnNhbWVOYW1lQWxsb3dlZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy51cGxvYWRTZXIuZ2V0VXBsb2FkZWRGaWxlSW5mb0xpc3QodGhpcy5mb3JtSWQsIHRoaXMucm9vdElkKS5waXBlKFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoTWFwKChyZXM6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXMgIT0gbnVsbCAmJiByZXMuZXJyb3IgPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNlcnZlckNvbmZpZy51cGxvYWRlZEZpbGVJbmZvTGlzdCA9IHJlcztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXJ2ZXJDb25maWcub2xkVXBsb2FkZWRGaWxlTGlzdCA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkocmVzKSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy51cGxvYWRCaWdGaWxlMihmaWxlcywgZXZlbnQsIGV4dGVuZFNlcnZpY2UpOyAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gb2YocmVzKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMudXBsb2FkQmlnRmlsZTIoZmlsZXMsIGV2ZW50LCBleHRlbmRTZXJ2aWNlKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnVwbG9hZEJpZ0ZpbGUoZmlsZXMsIGV2ZW50LCBleHRlbmRTZXJ2aWNlKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgICAgIGlmICghdGhpcy5zZXJ2ZXJDb25maWcpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmdldFNlcnZlckNvbmZpZyh0aGlzLnJvb3RJZCkucGlwZShcclxuICAgICAgICAgICAgICAgICAgICBzd2l0Y2hNYXAoKHJlczogYW55KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXMgIT0gbnVsbCAmJiByZXMuZXJyb3IgPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXJ2ZXJDb25maWcgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2FtZU5hbWVBbGxvd2VkOiByZXMuc2FtZU5hbWVBbGxvd2VkLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFsbG93ZWRNdWx0aVVwbG9hZDogcmVzLmFsbG93ZWRNdWx0aVVwbG9hZCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXhGaWxlU2l6ZTogcGFyc2VJbnQoXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEpTT04ucGFyc2UocmVzLnZhbGlkYXRlQ29uZmlndXJhdGlvbikubWF4RmlsZVNpemVcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVwJCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICApO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiB1cCQoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuaW5uZXJVcGxvYWRMaXN0KGZpbGVzLCBldmVudCwgZXh0ZW5kU2VydmljZSk7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIOWGhemDqOS4iuS8oOaWueW8j1xyXG4gICAgICogQHBhcmFtIGZpbGVzXHJcbiAgICAgKiBAcGFyYW0gZXZlbnRcclxuICAgICAqIEBwYXJhbSBleHRlbmRTZXJ2aWNlXHJcbiAgICAgKi9cclxuICAgIHByaXZhdGUgaW5uZXJVcGxvYWRMaXN0KFxyXG4gICAgICAgIGZpbGVzOiBVcGxvYWRGaWxlW10sXHJcbiAgICAgICAgZXZlbnQ6IFVwbG9hZElucHV0LFxyXG4gICAgICAgIGV4dGVuZFNlcnZpY2U6IEZGaWxlVXBsb2FkQWRhcHRVbmlmaWxlQ29uZmlnXHJcbiAgICApOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgICAgIHJldHVybiBuZXcgT2JzZXJ2YWJsZSgob2JzZXJ2ZXIpID0+IHtcclxuICAgICAgICAgICAgbGV0IHVwbG9hZEluZm8gPSBuZXcgR3NwRm9ybVVwbG9hZExpc3RFbnRpdHkoKTtcclxuICAgICAgICAgICAgdXBsb2FkSW5mby5mb3JtSWQgPSB0aGlzLmdldEZpbmFsbHlDb25maWcoXCJmb3JtSWRcIiwgZXh0ZW5kU2VydmljZSk7XHJcbiAgICAgICAgICAgIHVwbG9hZEluZm8ubW9kZSA9IHRoaXMuZ2V0RmluYWxseUNvbmZpZyhcIm1vZGVcIiwgZXh0ZW5kU2VydmljZSk7XHJcblxyXG4gICAgICAgICAgICBsZXQgcm9vdElkID0gdGhpcy5nZXRGaW5hbGx5Q29uZmlnKFwicm9vdElkXCIsIGV4dGVuZFNlcnZpY2UpO1xyXG4gICAgICAgICAgICB1cGxvYWRJbmZvLmRvY0luZm9MaXN0ID0gW107XHJcbiAgICAgICAgICAgIGxldCByZWFkZXJPYnNlcmFibGU6IE9ic2VydmFibGU8YW55PltdID0gW107XHJcbiAgICAgICAgICAgIGZpbGVzLmZvckVhY2goKGZpbGVJdGVtOiBVcGxvYWRGaWxlKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBsZXQgc3ViID0gbmV3IE9ic2VydmFibGUoKG9ic2VyKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8g5pqC5LiN5aSE55CG5byC5bi4XHJcbiAgICAgICAgICAgICAgICAgICAgcmVhZGVyLnJlYWRBc0JpbmFyeVN0cmluZyhmaWxlSXRlbS5uYXRpdmVGaWxlKTtcclxuICAgICAgICAgICAgICAgICAgICByZWFkZXIub25sb2FkID0gKGUpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGluZm8gPSB7IGZpbGVOYW1lOiBcIlwiLCBmaWxlQ29udGVudDogXCJcIiB9IGFzIGFueTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaW5mb1tcImZpbGVOYW1lXCJdID0gZmlsZUl0ZW0ubmFtZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaW5mb1tcImZpbGVDb250ZW50XCJdID0gYnRvYShyZWFkZXIucmVzdWx0LnRvU3RyaW5nKCkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyDlpoLmnpxkYXRh6YeM5pyJ5pWw5o2u77yM5bm25LiU5bGe5oCn5piv6YWN572u55qE5omp5bGV5bGe5oCnXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50Lmhhc093blByb3BlcnR5KFwiZGF0YVwiKSAmJlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnRbXCJkYXRhXCJdICYmXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBldmVudFtcImRhdGFcIl0uaGFzT3duUHJvcGVydHkoXCJleHRQcm9wZXJ0eVwiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmZvW1wiZXh0UHJvcGVydHlcIl0gPSBldmVudFtcImRhdGFcIl1bXCJleHRQcm9wZXJ0eVwiXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB1cGxvYWRJbmZvLmRvY0luZm9MaXN0LnB1c2goaW5mbyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9ic2VyLm5leHQoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgb2JzZXIuY29tcGxldGUoKTtcclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICByZWFkZXJPYnNlcmFibGUucHVzaChzdWIpO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIGZvcmtKb2luKHJlYWRlck9ic2VyYWJsZSkuc3Vic2NyaWJlKChkYXRhcykgPT4ge1xyXG4gICAgICAgICAgICAgICAgLy8gICAgIG1ldGFkYXRhSWQ6IHN0cmluZztcclxuICAgICAgICAgICAgICAgIC8vICBmaWxlTmFtZTogc3RyaW5nO1xyXG4gICAgICAgICAgICAgICAgdGhpcy51cGxvYWRTZXIudXBsb2FkTGlzdCh1cGxvYWRJbmZvLCByb290SWQpLnN1YnNjcmliZShcclxuICAgICAgICAgICAgICAgICAgICAocmVzdWx0KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQuZXJyb3IpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIOatpOaOpeWPo+S4gOaXpuWHuueOsOmXrumimO+8jOaJgOaciemZhOS7tumDveS4iuS8oOS4jemAmui/h1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JzZXJ2ZXIuZXJyb3IodGhpcy5lcnJvckluZm9Gb3JtYXQocmVzdWx0LmVycm9yLCBmaWxlcykpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JzZXJ2ZXIuY29tcGxldGUoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyDlkIjlubbov5Tlm57nu5PmnpzliLDmraTlpIRcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LmZvckVhY2goKGl0ZW0pID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBmaW5kSW5kZXggPSB0aGlzLmZpbmRGaWxlSW5kZXhCeUZpbGVOYW1lKFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVzLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0uZmlsZU5hbWVcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZmluZEluZGV4ID4gLTEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlc1tmaW5kSW5kZXhdW1wicmVzcG9uc2VcIl0gPSBpdGVtO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVzW2ZpbmRJbmRleF1bXCJwcm9ncmVzc1wiXVtcInN0YXR1c1wiXSA9IFVwbG9hZFN0YXR1cy5Eb25lO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9ic2VydmVyLm5leHQoeyB0eXBlOiBcImRvbmVcIiwgZmlsZXM6IGZpbGVzIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgKGVycm9yKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9ic2VydmVyLmVycm9yKHRoaXMuZXJyb3JJbmZvRm9ybWF0KGVycm9yLCBmaWxlcykpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvYnNlcnZlci5jb21wbGV0ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvYnNlcnZlci5jb21wbGV0ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiDliIbniYfliqDovb1cclxuICAgICAqIEBwYXJhbSBmaWxlXHJcbiAgICAgKiBAcGFyYW0gZXZlbnRcclxuICAgICAqIEBwYXJhbSBleHRlbmRTZXJ2aWNlXHJcbiAgICAgKi9cclxuICAgIG11bHRpcGFydFVwbG9hZChcclxuICAgICAgICBmaWxlOiBVcGxvYWRGaWxlLFxyXG4gICAgICAgIGV2ZW50OiBVcGxvYWRJbnB1dCxcclxuICAgICAgICBleHRlbmRTZXJ2aWNlOiBGRmlsZVVwbG9hZEFkYXB0VW5pZmlsZUNvbmZpZ1xyXG4gICAgKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgICAgICByZXR1cm4gbmV3IE9ic2VydmFibGUoKG9ic2VydmVyKSA9PiB7XHJcbiAgICAgICAgICAgIC8vIGxldCBmaWxlSW5mbzogRmlsZUluZm87XHJcbiAgICAgICAgICAgIGxldCB1dWlkID0gdGhpcy51dWlkKCk7XHJcbiAgICAgICAgICAgIC8vIGxldCB1dWlkID0gVVVJRC5VVUlEKCk7XHJcbiAgICAgICAgICAgIC8vcmVhZGVyLnJlYWRBc0JpbmFyeVN0cmluZyhzZWxlY3RlZEZpbGUpO1xyXG4gICAgICAgICAgICAvL3JlYWRlci5vbmxvYWQgPSAoZSkgPT4ge1xyXG4gICAgICAgICAgICBsZXQgZmlsZU5hbWUgPSBmaWxlLm5hbWU7XHJcbiAgICAgICAgICAgIC8vIGZpbGVJbmZvID0ge1xyXG4gICAgICAgICAgICAvLyAgIGlkOiB1dWlkLFxyXG4gICAgICAgICAgICAvLyAgIG5hbWU6IGZpbGVOYW1lLFxyXG4gICAgICAgICAgICAvLyAgIHR5cGU6IGZpbGUudHlwZSxcclxuICAgICAgICAgICAgLy8gICBzb3VyY2U6IFwiXCIsXHJcbiAgICAgICAgICAgIC8vICAgc2l6ZTogdGhpcy5mb3JtYXRGaWxlU2l6ZShmaWxlLnNpemUpLFxyXG4gICAgICAgICAgICAvLyAgIGZpbGVTaXplOiBmaWxlLnNpemUsXHJcbiAgICAgICAgICAgIC8vICAgcGljTGlzdERpc3BsYXlOYW1lOiB0aGlzLmdldE11bHRpcGFydERpc3BsYXlOYW1lKGZpbGVOYW1lKSxcclxuICAgICAgICAgICAgLy8gICBxdWV1ZUxpc3REaXNwbGF5TmFtZTogZmlsZU5hbWUsXHJcbiAgICAgICAgICAgIC8vICAgLy9jb250ZW50OiByZWFkZXIucmVzdWx0LnRvU3RyaW5nKCksXHJcbiAgICAgICAgICAgIC8vICAgaGFzVXBsb2FkZWQ6IGZhbHNlLFxyXG4gICAgICAgICAgICAvLyAgIG1vdXNlT246IGZhbHNlLFxyXG4gICAgICAgICAgICAvLyAgIHNlbGVjdGQ6IGZhbHNlLFxyXG4gICAgICAgICAgICAvLyAgIGlzVXBsb2FkaW5nOiB0cnVlLFxyXG4gICAgICAgICAgICAvLyAgIHVwbG9hZFJlc3VsdDogZmFsc2UsXHJcbiAgICAgICAgICAgIC8vICAgdXBsb2FkUHJvY2VzczogMCxcclxuICAgICAgICAgICAgLy8gICBlcnJvck1lc3NhZ2U6IFwiXCIsXHJcbiAgICAgICAgICAgIC8vICAgZXh0ZW5zaW9uRHJvcExpc3RJZDogMCxcclxuICAgICAgICAgICAgLy8gICBleHRlbnNpb25OYW1lOiBcIlwiXHJcbiAgICAgICAgICAgIC8vIH1cclxuXHJcbiAgICAgICAgICAgIGxldCBjaHVua1RvdGFsOiBudW1iZXIgPSBNYXRoLmNlaWwoZmlsZS5zaXplIC8gdGhpcy5idWZmZXJTaXplKTtcclxuICAgICAgICAgICAgLy8g5qCH6K6w5b2T5YmN6ZmE5Lu25oC755qE5YiG54mH5pWwXHJcbiAgICAgICAgICAgIHRoaXMuZmlsZVRvdGFsQ2h1bmtbdXVpZF0gPSBjaHVua1RvdGFsO1xyXG4gICAgICAgICAgICBsZXQgY2h1bmtJbmRleDogbnVtYmVyID0gMDtcclxuICAgICAgICAgICAgLy8g5qCH6K6w5b2T5YmN6ZmE5Lu25oiQ5Yqf55qE5YiG54mH5pWwXHJcbiAgICAgICAgICAgIHRoaXMudXBsb2FkZWRDaHVua1t1dWlkXSA9IDA7XHJcbiAgICAgICAgICAgIHdoaWxlIChjaHVua0luZGV4IDwgY2h1bmtUb3RhbCkge1xyXG4gICAgICAgICAgICAgICAgbGV0IHVwbG9hZEluZm8gPSBuZXcgR3NwRm9ybVVwbG9hZEVudGl0eSgpO1xyXG4gICAgICAgICAgICAgICAgdXBsb2FkSW5mby5tb2RlID0gT3BlcmF0aW5nTW9kZXMuVGVtcDtcclxuICAgICAgICAgICAgICAgIHVwbG9hZEluZm8uZm9ybUlkID0gdGhpcy5nZXRGaW5hbGx5Q29uZmlnKFwiZm9ybUlkXCIsIGV4dGVuZFNlcnZpY2UpO1xyXG4gICAgICAgICAgICAgICAgdXBsb2FkSW5mby5yb290SWQgPSB0aGlzLmdldEZpbmFsbHlDb25maWcoXCJyb290SWRcIiwgZXh0ZW5kU2VydmljZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgbGV0IGRvY0luZm86IEdzcEZvcm1Eb2NJbmZvID0gbmV3IEdzcEZvcm1Eb2NJbmZvKCk7XHJcbiAgICAgICAgICAgICAgICBkb2NJbmZvLmZpbGVOYW1lID0gZmlsZU5hbWU7XHJcbiAgICAgICAgICAgICAgICBkb2NJbmZvLm1ldGFkYXRhSWQgPSB1dWlkO1xyXG4gICAgICAgICAgICAgICAgZG9jSW5mby50b3RhbCA9IGNodW5rVG90YWw7XHJcbiAgICAgICAgICAgICAgICAvLyDlpoLmnpxkYXRh6YeM5pyJ5pWw5o2u77yM5bm25LiU5bGe5oCn5piv6YWN572u55qE5omp5bGV5bGe5oCnXHJcbiAgICAgICAgICAgICAgICBpZiAoXHJcbiAgICAgICAgICAgICAgICAgICAgZXZlbnQuaGFzT3duUHJvcGVydHkoXCJkYXRhXCIpICYmXHJcbiAgICAgICAgICAgICAgICAgICAgZXZlbnRbXCJkYXRhXCJdICYmXHJcbiAgICAgICAgICAgICAgICAgICAgZXZlbnRbXCJkYXRhXCJdLmhhc093blByb3BlcnR5KFwiZXh0UHJvcGVydHlcIilcclxuICAgICAgICAgICAgICAgICkge1xyXG4gICAgICAgICAgICAgICAgICAgIGRvY0luZm9bXCJleHRQcm9wZXJ0eVwiXSA9IGV2ZW50W1wiZGF0YVwiXVtcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJleHRQcm9wZXJ0eVwiXHJcbiAgICAgICAgICAgICAgICAgICAgXSBhcyBHc3BEb2NNZXRhUHJvcGVydHk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAvLyDkuIvkuIDkuKrmlofku7blpKflsI9cclxuICAgICAgICAgICAgICAgIGxldCBuZXh0U2l6ZSA9IE1hdGgubWluKChjaHVua0luZGV4ICsgMSkgKiB0aGlzLmJ1ZmZlclNpemUsIGZpbGUuc2l6ZSk7XHJcbiAgICAgICAgICAgICAgICAvLyBGaWxl57G75Z6LXHJcbiAgICAgICAgICAgICAgICBsZXQgZmlsZURhdGEgPSBmaWxlW1wibmF0aXZlRmlsZVwiXS5zbGljZShcclxuICAgICAgICAgICAgICAgICAgICBjaHVua0luZGV4ICogdGhpcy5idWZmZXJTaXplLFxyXG4gICAgICAgICAgICAgICAgICAgIG5leHRTaXplXHJcbiAgICAgICAgICAgICAgICApO1xyXG4gICAgICAgICAgICAgICAgLy8g6K+75Y+W5paH5Lu2XHJcbiAgICAgICAgICAgICAgICBsZXQgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTtcclxuICAgICAgICAgICAgICAgIHJlYWRlci5yZWFkQXNCaW5hcnlTdHJpbmcoZmlsZURhdGEpO1xyXG4gICAgICAgICAgICAgICAgbGV0IGlubmVySW5kZXggPSBjaHVua0luZGV4O1xyXG4gICAgICAgICAgICAgICAgcmVhZGVyLm9ubG9hZCA9ICgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAvLyDpmYTku7bkuIrkvKBcclxuICAgICAgICAgICAgICAgICAgICBkb2NJbmZvLmZpbGVDb250ZW50ID0gYnRvYShyZWFkZXIucmVzdWx0LnRvU3RyaW5nKCkpO1xyXG4gICAgICAgICAgICAgICAgICAgIGRvY0luZm8uaW5kZXggPSBpbm5lckluZGV4O1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB1cGxvYWRJbmZvLmRvY0luZm8gPSBkb2NJbmZvO1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCBpbmZvID0gdXBsb2FkSW5mbztcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy51cGxvYWRTZXIudXBsb2FkRmlsZShpbmZvKS5zdWJzY3JpYmUoXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIChyZXN1bHQpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQgJiYgcmVzdWx0LmVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8g5YiG54mH5LiK5Lyg5pyJ6L+U5Zue57uT5p6c5bCx5piv5oql6ZSZ5LqGXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JzZXJ2ZXIuZXJyb3IodGhpcy5lcnJvckluZm9Gb3JtYXQocmVzdWx0LmVycm9yLCBbZmlsZV0pKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYnNlcnZlci5jb21wbGV0ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy51cGxvYWRlZENodW5rW3V1aWRdKys7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnVwbG9hZGVkQ2h1bmtbZG9jSW5mby5tZXRhZGF0YUlkXSA9PVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmZpbGVUb3RhbENodW5rW2RvY0luZm8ubWV0YWRhdGFJZF1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8g5Yik5pat5piv5omA5pyJ5YiG54mH6YO95LiK5Lyg5a6M5oiQXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGUucHJvZ3Jlc3MgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0dXM6IFVwbG9hZFN0YXR1cy5Eb25lLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YToge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBlcmNlbnRhZ2U6IDEwMCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGUucmVzcG9uc2UgPSBkb2NJbmZvO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWxldGUgdGhpcy51cGxvYWRlZENodW5rW3V1aWRdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWxldGUgdGhpcy5maWxlVG90YWxDaHVua1t1dWlkXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JzZXJ2ZXIubmV4dCh7IHR5cGU6IFwiZG9uZVwiLCBmaWxlczogW2ZpbGVdIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYnNlcnZlci5jb21wbGV0ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIOWIhueJh+S4iuS8oOato+W4uFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBwZXJjZW50YWdlID0gTnVtYmVyLnBhcnNlSW50KFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICh0aGlzLnVwbG9hZGVkQ2h1bmtbdXVpZF0gLyB0aGlzLmZpbGVUb3RhbENodW5rW3V1aWRdKSAqXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgMTAwXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApLnRvRml4ZWQoMClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8g5Yik5pat5pyq5LiK5Lyg5a6M5oiQXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGUucHJvZ3Jlc3MgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0dXM6IFVwbG9hZFN0YXR1cy5VcGxvYWRpbmcsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGVyY2VudGFnZTogcGVyY2VudGFnZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9ic2VydmVyLm5leHQoeyB0eXBlOiBcInVwbG9hZGluZ1wiLCBmaWxlczogW2ZpbGVdIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgKGVycm9yKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWxldGUgdGhpcy51cGxvYWRlZENodW5rW3V1aWRdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIHRoaXMuZmlsZVRvdGFsQ2h1bmtbdXVpZF07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYnNlcnZlci5lcnJvcih0aGlzLmVycm9ySW5mb0Zvcm1hdChlcnJvciwgW2ZpbGVdKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYnNlcnZlci5jb21wbGV0ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICBjaHVua0luZGV4ID0gY2h1bmtJbmRleCArIDE7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICog6I635Y+W5YiG54mH55qE6ZmE5Lu25aSn5bCPXHJcbiAgICAgKiBAcGFyYW0gc2l6ZVxyXG4gICAgICovXHJcbiAgICBwcml2YXRlIGZvcm1hdEZpbGVTaXplKHNpemU6IG51bWJlcikge1xyXG4gICAgICAgIGlmIChzaXplIDwgMTAyNDAwKSByZXR1cm4gKHNpemUgLyAxMDI0KS50b0ZpeGVkKDEpICsgXCJLXCI7XHJcbiAgICAgICAgZWxzZSBpZiAoc2l6ZSA8IDEwMjQgKiAxMDI0KSByZXR1cm4gKHNpemUgLyAxMDI0KS50b0ZpeGVkKDApICsgXCJLXCI7XHJcbiAgICAgICAgZWxzZSBpZiAoc2l6ZSA8IDEwMCAqIDEwMjQgKiAxMDI0KVxyXG4gICAgICAgICAgICByZXR1cm4gKHNpemUgLyAxMDI0IC8gMTAyNCkudG9GaXhlZCgxKSArIFwiTVwiO1xyXG4gICAgICAgIGVsc2UgaWYgKHNpemUgPCAxMDI0ICogMTAyNCAqIDEwMjQpXHJcbiAgICAgICAgICAgIHJldHVybiAoc2l6ZSAvIDEwMjQgLyAxMDI0KS50b0ZpeGVkKDApICsgXCJNXCI7XHJcbiAgICAgICAgZWxzZSByZXR1cm4gKHNpemUgLyAxMDI0IC8gMTAyNCAvIDEwMjQpLnRvRml4ZWQoMSkgKyBcIkdcIjtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICog6I635Y+W5YiG54mH55qEIOmZhOS7tuWQjeensFxyXG4gICAgICogQHBhcmFtIGZpbGVOYW1lXHJcbiAgICAgKi9cclxuICAgIHByaXZhdGUgZ2V0TXVsdGlwYXJ0RGlzcGxheU5hbWUoZmlsZU5hbWU6IHN0cmluZykge1xyXG4gICAgICAgIGlmIChmaWxlTmFtZS5sZW5ndGggPD0gMTApIHJldHVybiBmaWxlTmFtZTtcclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgbGV0IGhlYWRDb250ZW50ID0gZmlsZU5hbWUuc3Vic3RyaW5nKDAsIDIpO1xyXG4gICAgICAgICAgICBsZXQgdGFpbENvbnRlbnQgPSBmaWxlTmFtZS5zdWJzdHJpbmcoZmlsZU5hbWUubGFzdEluZGV4T2YoXCIuXCIpIC0gMik7XHJcbiAgICAgICAgICAgIHJldHVybiBoZWFkQ29udGVudCArIFwi4oCmXCIgKyB0YWlsQ29udGVudDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBwcml2YXRlIGVycm9ySW5mb0Zvcm1hdChlcnJvciwgZmlsZXMpIHtcclxuICAgICAgICAvL1xyXG4gICAgICAgIGxldCBlcnJvckZpbGVzID0gZmlsZXMubWFwKChpdGVtKSA9PiB7XHJcbiAgICAgICAgICAgIHJldHVybiB7IGlkOiBpdGVtLmlkLCBuYW1lOiBpdGVtLm5hbWUgfTtcclxuICAgICAgICB9KTtcclxuICAgICAgICBsZXQgZXJyb3JNc2c9dGhpcy5jb25maWdTZXIuZ2V0TG9jYWxTdHIoJ3VwbG9hZEFkYXB0LnVwbG9hZEVycm9yJyk7XHJcbiAgICAgICAgaWYgKGVycm9yKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBPYmplY3QuYXNzaWduKFxyXG4gICAgICAgICAgICAgICAgZXJyb3IsXHJcbiAgICAgICAgICAgICAgICB7IGZpbGVzOiBlcnJvckZpbGVzIH0sXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogZXJyb3JbXCJNZXNzYWdlXCJdIHx8IGVycm9yW1wiZXh0ZW5zaW9uTWVzc2FnZVwiXSB8fCBlcnJvck1zZyxcclxuICAgICAgICAgICAgICAgICAgICB0eXBlOiBcImVycm9yXCIsXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcmV0dXJuIE9iamVjdC5hc3NpZ24oXHJcbiAgICAgICAgICAgICAgICB7IGZpbGVzOiBlcnJvckZpbGVzIH0sXHJcbiAgICAgICAgICAgICAgICB7IG1lc3NhZ2U6IGVycm9yTXNnLCB0eXBlOiBcImVycm9yXCIgfVxyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICog6L+U5Zue5pyA57uI5bGe5oCn5YC8XHJcbiAgICAgKiBAcGFyYW0ga2V5XHJcbiAgICAgKiBAcGFyYW0gY29uZmlnVmFsdWVcclxuICAgICAqIEBwYXJhbSBleHRlbmRWYWx1ZVxyXG4gICAgICovXHJcbiAgICBwcml2YXRlIGdldEZpbmFsbHlDb25maWcoa2V5LCBleHRlbmRWYWx1ZSkge1xyXG4gICAgICAgIGlmIChleHRlbmRWYWx1ZSAmJiBleHRlbmRWYWx1ZS5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBleHRlbmRWYWx1ZVtrZXldO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdGhpcy5leHRlbmREYXRhW2tleV07XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBmaW5kRmlsZUluZGV4QnlGaWxlTmFtZShmaWxlczogVXBsb2FkRmlsZVtdLCBmaWxlTmFtZSkge1xyXG4gICAgICAgIC8vIOaMieeFp+iCr+WumuiDveaJvuWIsOaWh+S7tuadpeWkhOeQhlxyXG4gICAgICAgIGxldCBmaW5kSW5kZXggPSBmaWxlcy5maW5kSW5kZXgoKGZpbGUpID0+IGZpbGUubmFtZSA9PSBmaWxlTmFtZSk7XHJcbiAgICAgICAgcmV0dXJuIGZpbmRJbmRleDtcclxuICAgIH1cclxuXHJcbiAgICAvLyNyZWdpb24g5aSn5paH5Lu25YiG54mH5LiK5LygXHJcblxyXG4gICAgdXBsb2FkQmlnRmlsZShcclxuICAgICAgICBmaWxlczogVXBsb2FkRmlsZVtdLFxyXG4gICAgICAgIGV2ZW50OiBVcGxvYWRJbnB1dCxcclxuICAgICAgICBleHRlbmRTZXJ2aWNlOiBGRmlsZVVwbG9hZEFkYXB0VW5pZmlsZUNvbmZpZ1xyXG4gICAgKSB7XHJcbiAgICAgICAgY29uc3QgdXBsb2FkQ2h1bmtzJCA9IG5ldyBTdWJqZWN0KCk7XHJcblxyXG4gICAgICAgIGNvbnN0IF9maWxlcyA9IGZpbGVzLm1hcCgobikgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBjaHVua3MgPSB0aGlzLl9nZXRCaWdGaWxlQ2h1bmtzKG4sIGV2ZW50LCBleHRlbmRTZXJ2aWNlKTtcclxuICAgICAgICAgICAgcmV0dXJuIHsgLi4ubiwgLi4uY2h1bmtzIH07XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGNvbnN0IHVwbG9hZGNodW5rcyQ6IE9ic2VydmFibGU8YW55PltdID0gX2ZpbGVzLm1hcCgoZikgPT5cclxuICAgICAgICAgICAgdGhpcy51cGxvYWRDaHVua3MoZiwgdXBsb2FkQ2h1bmtzJClcclxuICAgICAgICApO1xyXG4gICAgICAgIGNvbmNhdCguLi51cGxvYWRjaHVua3MkKS5zdWJzY3JpYmUoXHJcbiAgICAgICAgICAgIChmOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgICAgIGYucHJvZ3Jlc3MgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc3RhdHVzOiBVcGxvYWRTdGF0dXMuRG9uZSxcclxuICAgICAgICAgICAgICAgICAgICBkYXRhOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBlcmNlbnRhZ2U6IDEwMCxcclxuICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgIGYucmVzcG9uc2UgPSBKU09OLnBhcnNlKGYuY2h1bmtzWzBdLmdldChcImRvY0luZm9cIikpO1xyXG4gICAgICAgICAgICAgICAgdXBsb2FkQ2h1bmtzJC5uZXh0KHsgdHlwZTogXCJkb25lXCIsIGZpbGVzOiBbZl0gfSk7XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIChlcnJvcikgPT4ge1xyXG4gICAgICAgICAgICAgICAgdXBsb2FkQ2h1bmtzJC5lcnJvcih0aGlzLmVycm9ySW5mb0Zvcm1hdChlcnJvciwgZmlsZXMpKTtcclxuICAgICAgICAgICAgICAgIHVwbG9hZENodW5rcyQuY29tcGxldGUoKTtcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgdXBsb2FkQ2h1bmtzJC5jb21wbGV0ZSgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgKTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHVwbG9hZENodW5rcyQuYXNPYnNlcnZhYmxlKCk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSB1cGxvYWRGaWxlQ2h1bmsoZmlsZTogYW55KSB7XHJcbiAgICAgICAgY29uc3QgdXJsID0gYCR7dGhpcy5nZXRQcmVmaXhTdHIoKX0vYXBpL3J1bnRpbWUvZGZzL3YxLjAvZm9ybWRvYy9zbGljZWA7XHJcblxyXG4gICAgICAgIHJldHVybiB0aGlzLnVwbG9hZFNlcltcImh0dHBcIl1bXCJodHRwXCJdXHJcbiAgICAgICAgICAgIC5wb3N0KHVybCwgZmlsZS5jaHVua3NbZmlsZS50b3RhbF0pXHJcbiAgICAgICAgICAgIC5waXBlKFxyXG4gICAgICAgICAgICAgICAgc3dpdGNoTWFwKCgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gb2YoZmlsZSk7XHJcbiAgICAgICAgICAgICAgICB9KSxcclxuICAgICAgICAgICAgICAgIGNhdGNoRXJyb3IoKGVycm9yOiBIdHRwRXJyb3JSZXNwb25zZSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBvZihlcnJvcik7XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICApO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgdXBsb2FkQ2h1bmtzKGZpbGUsIHVwQ2h1bmskOiBTdWJqZWN0PGFueT4pIHtcclxuICAgICAgICBjb25zdCBkb0NodW5rc1JlbWFpbiA9IChpKSA9PiBpID4gLTE7XHJcbiAgICAgICAgY29uc3QgY29tcGxldGVVcGxvYWQgPSAoZikgPT4gb2YoZik7XHJcbiAgICAgICAgY29uc3QgdXBsb2FkQ2h1bmsgPSAoZikgPT4ge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy51cGxvYWRGaWxlQ2h1bmsoZikucGlwZShcclxuICAgICAgICAgICAgICAgIGRlbGF5KDEwMCksXHJcbiAgICAgICAgICAgICAgICBtYXAoKGY6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIOWdl+aVsOS4ujAg5pe277yM5Y2z5Li65q2k5paH5Lu255qE5omA5pyJ5Z2X5Z2H5LiK5Lyg5oiQ5YqfXHJcbiAgICAgICAgICAgICAgICAgICAgZi5wcm9ncmVzcyA9IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzOiBVcGxvYWRTdGF0dXMuVXBsb2FkaW5nLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwZXJjZW50YWdlOiAoKGYudG90YWwgLyBmLmNodW5rcy5sZW5ndGgpICogMTAwKS50b0ZpeGVkKDApLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICAgICAgdXBDaHVuayQubmV4dCh7IHR5cGU6IFwidXBsb2FkaW5nXCIsIGZpbGVzOiBbZl0gfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmO1xyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgKTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIGNvbnN0IGNyZWF0ZU11bHRpcGFydFVwbG9hZCA9IChmKSA9PiBvZihmKTtcclxuXHJcbiAgICAgICAgcmV0dXJuIGNyZWF0ZU11bHRpcGFydFVwbG9hZChmaWxlKS5waXBlKFxyXG4gICAgICAgICAgICAvLyB0YXAoKGYpID0+IGNvbnNvbGUubG9nKFwidXBsb2FkIGZpbGVcIiwgZi5uYW1lKSksXHJcbiAgICAgICAgICAgIGV4cGFuZCgoZikgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKGRvQ2h1bmtzUmVtYWluKC0tZmlsZS50b3RhbCkpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdXBsb2FkQ2h1bmsoZmlsZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gRU1QVFk7XHJcbiAgICAgICAgICAgIH0pLFxyXG4gICAgICAgICAgICAvLyB0YXAoKGY6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICAvLyAgICAgY29uc29sZS5sb2coYGZpbGU6ICR7Zi5uYW1lfSAtIHJlbWFpbmluZyBjaHVua3M6ICR7Zi50b3RhbH1gKTtcclxuICAgICAgICAgICAgLy8gfSksXHJcbiAgICAgICAgICAgIGxhc3QoKSxcclxuICAgICAgICAgICAgc3dpdGNoTWFwKChyZXM6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGNvbXBsZXRlVXBsb2FkKGZpbGUpO1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBfZ2V0QmlnRmlsZUNodW5rcyhcclxuICAgICAgICBmaWxlOiBVcGxvYWRGaWxlLFxyXG4gICAgICAgIGV2ZW50OiBVcGxvYWRJbnB1dCxcclxuICAgICAgICBleHRlbmRTZXJ2aWNlOiBGRmlsZVVwbG9hZEFkYXB0VW5pZmlsZUNvbmZpZ1xyXG4gICAgKSB7XHJcbiAgICAgICAgbGV0IHV1aWQgPSB0aGlzLnV1aWQoKTtcclxuXHJcbiAgICAgICAgY29uc3QgZm9ybUlkID0gdGhpcy5nZXRGaW5hbGx5Q29uZmlnKFwiZm9ybUlkXCIsIGV4dGVuZFNlcnZpY2UpO1xyXG4gICAgICAgIGNvbnN0IHJvb3RJZCA9IHRoaXMuZ2V0RmluYWxseUNvbmZpZyhcInJvb3RJZFwiLCBleHRlbmRTZXJ2aWNlKTtcclxuICAgICAgICBsZXQgcmVhbENodW5rU2l6ZT0oZXZlbnQuY2h1bmtTaXplIHx8IDEpKnRoaXMuYnVmZmVyU2l6ZTtcclxuICAgICAgICBsZXQgY2h1bmtUb3RhbDogbnVtYmVyID0gTWF0aC5jZWlsKGZpbGUuc2l6ZSAvIHJlYWxDaHVua1NpemUpO1xyXG4gICAgICAgIGxldCBjaHVua0luZGV4OiBudW1iZXIgPSAwO1xyXG4gICAgICAgIGNvbnN0IGZpbGVDaHVua3MgPSB7IGNodW5rczogW10sIHRvdGFsOiBjaHVua1RvdGFsIH07XHJcblxyXG4gICAgICAgIHdoaWxlIChjaHVua0luZGV4IDwgY2h1bmtUb3RhbCkge1xyXG4gICAgICAgICAgICBsZXQgdXBsb2FkSW5mbyA9IG5ldyBHc3BGb3JtVXBsb2FkRW50aXR5KCk7XHJcbiAgICAgICAgICAgIHVwbG9hZEluZm8ubW9kZSA9IE9wZXJhdGluZ01vZGVzLlRlbXA7XHJcbiAgICAgICAgICAgIHVwbG9hZEluZm8uZm9ybUlkID0gZm9ybUlkO1xyXG4gICAgICAgICAgICB1cGxvYWRJbmZvLnJvb3RJZCA9IHJvb3RJZDtcclxuXHJcbiAgICAgICAgICAgIGxldCBkb2NJbmZvOiBHc3BGb3JtRG9jSW5mbyA9IG5ldyBHc3BGb3JtRG9jSW5mbygpO1xyXG5cclxuICAgICAgICAgICAgZG9jSW5mby5maWxlTmFtZSA9IGZpbGUubmFtZTtcclxuICAgICAgICAgICAgZG9jSW5mby5tZXRhZGF0YUlkID0gdXVpZDtcclxuICAgICAgICAgICAgZG9jSW5mby50b3RhbCA9IGNodW5rVG90YWw7XHJcblxyXG4gICAgICAgICAgICBsZXQgbmV4dFNpemUgPSBNYXRoLm1pbigoY2h1bmtJbmRleCArIDEpICogcmVhbENodW5rU2l6ZSwgZmlsZS5zaXplKTtcclxuICAgICAgICAgICAgLy8gRmlsZeexu+Wei1xyXG4gICAgICAgICAgICBsZXQgZmlsZURhdGEgPSBmaWxlW1wibmF0aXZlRmlsZVwiXS5zbGljZShcclxuICAgICAgICAgICAgICAgIGNodW5rSW5kZXggKiByZWFsQ2h1bmtTaXplLFxyXG4gICAgICAgICAgICAgICAgbmV4dFNpemVcclxuICAgICAgICAgICAgKTtcclxuXHJcbiAgICAgICAgICAgIGRvY0luZm8uc2l6ZSA9IGZpbGUuc2l6ZTtcclxuICAgICAgICAgICAgZG9jSW5mby5pbmRleCA9IGNodW5rSW5kZXg7XHJcbiAgICAgICAgICAgIGRvY0luZm8uZmlsZUNvbnRlbnQgPSBcIlwiO1xyXG5cclxuICAgICAgICAgICAgLy8g5aaC5p6cZGF0YemHjOacieaVsOaNru+8jOW5tuS4lOWxnuaAp+aYr+mFjee9rueahOaJqeWxleWxnuaAp1xyXG4gICAgICAgICAgICBpZiAoXHJcbiAgICAgICAgICAgICAgICBldmVudC5oYXNPd25Qcm9wZXJ0eShcImRhdGFcIikgJiZcclxuICAgICAgICAgICAgICAgIGV2ZW50W1wiZGF0YVwiXSAmJlxyXG4gICAgICAgICAgICAgICAgZXZlbnRbXCJkYXRhXCJdLmhhc093blByb3BlcnR5KFwiZXh0UHJvcGVydHlcIilcclxuICAgICAgICAgICAgKSB7XHJcbiAgICAgICAgICAgICAgICBkb2NJbmZvW1wiZXh0UHJvcGVydHlcIl0gPSBldmVudFtcImRhdGFcIl1bXHJcbiAgICAgICAgICAgICAgICAgICAgXCJleHRQcm9wZXJ0eVwiXHJcbiAgICAgICAgICAgICAgICBdIGFzIEdzcERvY01ldGFQcm9wZXJ0eTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdXBsb2FkSW5mby5kb2NJbmZvID0gZG9jSW5mbztcclxuXHJcbiAgICAgICAgICAgIC8v5bCB6KOF6K+35rGCZm9ybWRhdGFcclxuICAgICAgICAgICAgbGV0IGZvcm1EYXRhID0gbmV3IEZvcm1EYXRhKCk7XHJcbiAgICAgICAgICAgIGZvcm1EYXRhLmFwcGVuZChcInVwbG9hZEluZm9cIiwgSlNPTi5zdHJpbmdpZnkodXBsb2FkSW5mbykpO1xyXG4gICAgICAgICAgICBmb3JtRGF0YS5hcHBlbmQoXCJkb2NJbmZvXCIsIEpTT04uc3RyaW5naWZ5KGRvY0luZm8pKTtcclxuICAgICAgICAgICAgZm9ybURhdGEuYXBwZW5kKFwiZmlsZVwiLCBmaWxlRGF0YSk7XHJcblxyXG4gICAgICAgICAgICBmaWxlQ2h1bmtzLmNodW5rcy5wdXNoKGZvcm1EYXRhKTtcclxuICAgICAgICAgICAgY2h1bmtJbmRleCA9IGNodW5rSW5kZXggKyAxO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIGZpbGVDaHVua3M7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIOiOt+WPlui3n+ebruW9leeahOmFjee9rlxyXG4gICAgICogQHBhcmFtIHJvb3RJZCBcclxuICAgICAqIEByZXR1cm5zIFxyXG4gICAgICovXHJcbiAgICBwcml2YXRlIGdldFNlcnZlckNvbmZpZyhyb290SWQ6IHN0cmluZykge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnVwbG9hZFNlci5nZXRVcGxvYWRJbmZvKHJvb3RJZCk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8jZW5kcmVnaW9uXHJcblxyXG5cclxuXHJcblxyXG4gICAgLy8jcmVnaW9uIOivu+WPluebuOWFs+mFjee9ruWIhueJh+S4iuS8oOiHs+S6keacjeWKoeWZqFxyXG5cclxuICAgIHByaXZhdGUgdW5vcmRlcmVkVXBsb2FkQmlnRmlsZShmaWxlOiBhbnksIHVwbG9hZENodW5rcyQpIHtcclxuXHJcbiAgICAgICAgaWYgKCAhZmlsZS5wYXJ0TGlzdCkge1xyXG4gICAgICAgICAgICBmaWxlLnBhcnRMaXN0ID0gW107XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLmluaXRNdWx0aVVwbG9hZChmaWxlKS5zdWJzY3JpYmUoKHI6IGFueSkgPT4ge1xyXG5cclxuICAgICAgICAgICAgaWYgKHIgJiYgci5lcnJvcikge1xyXG4gICAgICAgICAgICAgICAgdXBsb2FkQ2h1bmtzJC5lcnJvcih0aGlzLmVycm9ySW5mb0Zvcm1hdChyLmVycm9yLCBbZmlsZV0pKTtcclxuICAgICAgICAgICAgICAgIHVwbG9hZENodW5rcyQuY29tcGxldGUoKTtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgZmlsZS5jaHVua3MuZm9yRWFjaChuID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMubXVsdGlVcGxvYWQobiwgcikuc3Vic2NyaWJlKChyZXM6IGFueSkgPT4ge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAocmVzICYmIHJlcy5lcnJvcikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB1cGxvYWRDaHVua3MkLmVycm9yKHRoaXMuZXJyb3JJbmZvRm9ybWF0KHJlcy5lcnJvciwgW2ZpbGVdKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHVwbG9hZENodW5rcyQuY29tcGxldGUoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGZpbGUucHJvZ3Jlc3MgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1czogVXBsb2FkU3RhdHVzLlVwbG9hZGluZyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YTogIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBlcmNlbnRhZ2U6IChyZXMuaW5kZXggLyBmaWxlLmNodW5rcy5sZW5ndGggKiAxMDApLnRvRml4ZWQoMClcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICAgICAgdXBsb2FkQ2h1bmtzJC5uZXh0KHsgdHlwZTogJ3VwbG9hZGluZycsIGZpbGVzOiBbZmlsZV0gfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlcyAmJiByZXMucmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpbGUucGFydExpc3QucHVzaChyZXMucmVzdWx0KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGZpbGUucGFydExpc3QubGVuZ3RoID09PSBmaWxlLmNodW5rcy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGNvbXBsZXRlTXVsdGlVcGxvYWRSZXF1ZXN0OiBhbnkgPSB7fTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29tcGxldGVNdWx0aVVwbG9hZFJlcXVlc3QubWV0YWRhdGFJZCA9IGZpbGUubWV0YWRhdGFJZDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29tcGxldGVNdWx0aVVwbG9hZFJlcXVlc3QucGFydExpc3QgPSBmaWxlLnBhcnRMaXN0O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb21wbGV0ZU11bHRpVXBsb2FkUmVxdWVzdC5yb290SWQgPSB0aGlzLnJvb3RJZDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29tcGxldGVNdWx0aVVwbG9hZFJlcXVlc3QudXBsb2FkSWQgPSBmaWxlLnVwbG9hZElkO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb21wbGV0ZU11bHRpVXBsb2FkUmVxdWVzdC5zaXplID0gZmlsZS5zaXplO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jb21wbGV0ZU11bHRpVXBsb2FkKGNvbXBsZXRlTXVsdGlVcGxvYWRSZXF1ZXN0KS5zdWJzY3JpYmUoIChjbXVyOiBhbnkpID0+IHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY211ciAmJiBjbXVyLnN0YXR1cyAhPSAyMDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cGxvYWRDaHVua3MkLmVycm9yKHRoaXMuZXJyb3JJbmZvRm9ybWF0KGNtdXIuZXJyb3IsIFtmaWxlXSkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVwbG9hZENodW5rcyQuY29tcGxldGUoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZS5wcm9ncmVzcyA9IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0dXM6IFVwbG9hZFN0YXR1cy5Eb25lLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6ICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBlcmNlbnRhZ2U6IDEwMFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZS5yZXNwb25zZSA9IEpTT04ucGFyc2UoZmlsZS5jaHVua3NbMF0uZ2V0KFwiZG9jSW5mb1wiKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cGxvYWRDaHVua3MkLm5leHQoe3R5cGU6ICdkb25lJywgZmlsZXM6W2ZpbGVdfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVwbG9hZENodW5rcyQuZXJyb3IodGhpcy5lcnJvckluZm9Gb3JtYXQoZXJyb3IsIFtmaWxlXSkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdXBsb2FkQ2h1bmtzJC5jb21wbGV0ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcblxyXG4gICAgdXBsb2FkQmlnRmlsZTIoZmlsZXM6IFVwbG9hZEZpbGVbXSwgZXZlbnQ6IFVwbG9hZElucHV0LCBleHRlbmRTZXJ2aWNlOiBGRmlsZVVwbG9hZEFkYXB0VW5pZmlsZUNvbmZpZykge1xyXG5cclxuICAgICAgICBjb25zdCB1cGxvYWRDaHVua3MkID0gbmV3IFN1YmplY3QoKTtcclxuXHJcbiAgICAgICAgY29uc3QgZm9ybUlkID0gdGhpcy5nZXRGaW5hbGx5Q29uZmlnKCdmb3JtSWQnLCBleHRlbmRTZXJ2aWNlKTtcclxuICAgICAgICBjb25zdCByb290SWQgPSB0aGlzLmdldEZpbmFsbHlDb25maWcoJ3Jvb3RJZCcsIGV4dGVuZFNlcnZpY2UpO1xyXG5cclxuICAgICAgICBjb25zdCBfZmlsZXMgPSBmaWxlcy5tYXAobiA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGNodW5rcyA9IHRoaXMuX2dldEJpZ0ZpbGVDaHVua3MyKG4sIGV2ZW50LCBleHRlbmRTZXJ2aWNlKTtcclxuICAgICAgICAgICAgcmV0dXJuIHsgLi4ubiwgLi4uY2h1bmtzLCBmb3JtSWQsIHJvb3RJZH07XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIC8vIOaXoOW6j+S4iuS8oFxyXG4gICAgICAgIF9maWxlcy5mb3JFYWNoKG4gPT4ge1xyXG4gICAgICAgICAgICB0aGlzLnVub3JkZXJlZFVwbG9hZEJpZ0ZpbGUobiwgdXBsb2FkQ2h1bmtzJCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgXHJcblxyXG4gICAgICAgIC8vIOacieW6j+S4iuS8oFxyXG4gICAgICAgIC8vIGNvbnN0IHVwbG9hZGNodW5rcyQ6IE9ic2VydmFibGU8YW55PltdID0gIF9maWxlcy5tYXAoKGYpID0+IHRoaXMudXBsb2FkQ2h1bmtzMihmLCB1cGxvYWRDaHVua3MkKSk7XHJcbiAgICAgICAgLy8gY29uY2F0KC4uLnVwbG9hZGNodW5rcyQpLnBpcGUoXHJcbiAgICAgICAgLy8gICAgIHN3aXRjaE1hcCgoZjogYW55KSA9PiB7XHJcbiAgICAgICAgLy8gICAgICAgICBsZXQgY29tcGxldGVNdWx0aVVwbG9hZFJlcXVlc3Q6IGFueSA9IHt9O1xyXG4gICAgICAgIC8vICAgICAgICAgY29tcGxldGVNdWx0aVVwbG9hZFJlcXVlc3QubWV0YWRhdGFJZCA9IGYubWV0YWRhdGFJZDtcclxuICAgICAgICAvLyAgICAgICAgIGNvbXBsZXRlTXVsdGlVcGxvYWRSZXF1ZXN0LnBhcnRMaXN0ID0gZi5wYXJ0TGlzdDtcclxuICAgICAgICAvLyAgICAgICAgIGNvbXBsZXRlTXVsdGlVcGxvYWRSZXF1ZXN0LnJvb3RJZCA9IHRoaXMucm9vdElkO1xyXG4gICAgICAgIC8vICAgICAgICAgY29tcGxldGVNdWx0aVVwbG9hZFJlcXVlc3QudXBsb2FkSWQgPSBmLnVwbG9hZElkO1xyXG4gICAgICAgIC8vICAgICAgICAgY29tcGxldGVNdWx0aVVwbG9hZFJlcXVlc3Quc2l6ZSA9IGYuc2l6ZTtcclxuXHJcbiAgICAgICAgLy8gICAgICAgICByZXR1cm4gdGhpcy5jb21wbGV0ZU11bHRpVXBsb2FkKGNvbXBsZXRlTXVsdGlVcGxvYWRSZXF1ZXN0KS5waXBlKFxyXG4gICAgICAgIC8vICAgICAgICAgICAgIG1hcCgoKSA9PiBmKVxyXG4gICAgICAgIC8vICAgICAgICAgKTtcclxuICAgICAgICAvLyAgICAgfSlcclxuICAgICAgICAvLyApLnN1YnNjcmliZShcclxuICAgICAgICAvLyAgICAgKGY6IGFueSkgPT4ge1xyXG4gICAgICAgIC8vICAgICAgICAgZi5wcm9ncmVzcyA9IHtcclxuICAgICAgICAvLyAgICAgICAgICAgICBzdGF0dXM6IFVwbG9hZFN0YXR1cy5Eb25lLFxyXG4gICAgICAgIC8vICAgICAgICAgICAgIGRhdGE6ICB7XHJcbiAgICAgICAgLy8gICAgICAgICAgICAgICAgIHBlcmNlbnRhZ2U6IDEwMFxyXG4gICAgICAgIC8vICAgICAgICAgICAgIH1cclxuICAgICAgICAvLyAgICAgICAgIH07XHJcblxyXG4gICAgICAgIC8vICAgICAgICAgZi5yZXNwb25zZSA9IEpTT04ucGFyc2UoZi5jaHVua3NbMF0uZ2V0KFwiZG9jSW5mb1wiKSk7XHJcbiAgICAgICAgLy8gICAgICAgICB1cGxvYWRDaHVua3MkLm5leHQoe3R5cGU6ICdkb25lJywgZmlsZXM6W2ZdfSk7XHJcbiAgICAgICAgLy8gICAgIH0sXHJcbiAgICAgICAgLy8gICAgIGVycm9yID0+IHtcclxuICAgICAgICAvLyAgICAgICAgIHVwbG9hZENodW5rcyQuZXJyb3IodGhpcy5lcnJvckluZm9Gb3JtYXQoZXJyb3IsIGZpbGVzKSk7XHJcbiAgICAgICAgLy8gICAgICAgICB1cGxvYWRDaHVua3MkLmNvbXBsZXRlKCk7XHJcbiAgICAgICAgLy8gICAgIH0sXHJcbiAgICAgICAgLy8gICAgICgpID0+IHtcclxuICAgICAgICAvLyAgICAgICAgIHVwbG9hZENodW5rcyQuY29tcGxldGUoKTtcclxuICAgICAgICAvLyAgICAgICAgIC8vIGNvbnNvbGUubG9nKFwiYWxsIGZpbGVzIHVwbG9hZGVkXCIpXHJcbiAgICAgICAgLy8gICAgIH1cclxuICAgICAgICAvLyApO1xyXG5cclxuICAgICAgICByZXR1cm4gdXBsb2FkQ2h1bmtzJC5hc09ic2VydmFibGUoKTtcclxuICAgIH1cclxuXHJcblxyXG4gICAgcHJpdmF0ZSBpbml0TXVsdGlVcGxvYWQoZmlsZTogYW55KSB7XHJcbiAgICAgICAgbGV0IGluaXRSZXF1ZXN0OiBhbnkgPSB7fTtcclxuICAgICAgICBpbml0UmVxdWVzdC5wYXRoID0gZmlsZS5mb3JtSWQ7XHJcbiAgICAgICAgaW5pdFJlcXVlc3QubWV0YWRhdGFJZCA9IHRoaXMudXVpZCgpO1xyXG4gICAgICAgIGluaXRSZXF1ZXN0LnJvb3RJZCA9IGZpbGUucm9vdElkO1xyXG4gICAgICAgIGluaXRSZXF1ZXN0LnNpemUgPSBmaWxlLnNpemU7XHJcbiAgICAgICAgaW5pdFJlcXVlc3QuZmlsZU5hbWUgPSBmaWxlLm5hbWU7XHJcblxyXG4gICAgICAgIGxldCB1cmwgPSBgJHt0aGlzLmdldFByZWZpeFN0cigpfS9hcGkvcnVudGltZS9kZnMvdjEuMC9mb3JtZG9jL211bHRpL2luaXRgO1xyXG4gICAgICAgIFxyXG4gICAgICAgIHJldHVybiB0aGlzLnVwbG9hZFNlclsnaHR0cCddWydodHRwJ10ucG9zdCh1cmwsIGluaXRSZXF1ZXN0KS5waXBlKFxyXG4gICAgICAgICAgICB0YXAoKHJlczogYW55KSA9PiB7XHJcbiAgICAgICAgICAgICAgICBmaWxlLm1ldGFkYXRhSWQgPSBpbml0UmVxdWVzdC5tZXRhZGF0YUlkO1xyXG4gICAgICAgICAgICAgICAgZmlsZS51cGxvYWRJZCA9IHJlcy51cGxvYWRJZDtcclxuICAgICAgICAgICAgfSksXHJcbiAgICAgICAgICAgIGNhdGNoRXJyb3IoKGVycm9yOiBIdHRwRXJyb3JSZXNwb25zZSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG9mKGVycm9yKTtcclxuICAgICAgICAgICAgfSksXHJcbiAgICAgICAgICAgIG1hcCggKHJlczogYW55KSA9PiB7XHJcbiAgICAgICAgICAgICAgICByZXMubWV0YWRhdGFJZCA9IGluaXRSZXF1ZXN0Lm1ldGFkYXRhSWQ7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzO1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICk7XHJcblxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgY29tcGxldGVNdWx0aVVwbG9hZChyZXF1ZXN0OiBhbnkpOiBPYnNlcnZhYmxlPGFueT4ge1xyXG5cclxuICAgICAgICBsZXQgdXJsID0gYCR7dGhpcy5nZXRQcmVmaXhTdHIoKX0vYXBpL3J1bnRpbWUvZGZzL3YxLjAvZm9ybWRvYy9tdWx0aS9jb21wbGV0ZWA7XHJcbiAgICBcclxuICAgICAgICByZXR1cm4gdGhpcy51cGxvYWRTZXJbJ2h0dHAnXVsnaHR0cCddLnBvc3QodXJsLCByZXF1ZXN0KS5waXBlKFxyXG4gICAgICAgICAgICB0YXAoKHJlcykgPT4ge30pLFxyXG4gICAgICAgICAgICBjYXRjaEVycm9yKChlcnJvcjogSHR0cEVycm9yUmVzcG9uc2UpID0+IHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBvZihlcnJvcik7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIG11bHRpVXBsb2FkKGZvcm1kYXRhOiBGb3JtRGF0YSwgcjogYW55KTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgICAgICBsZXQgdXJsID1gJHt0aGlzLmdldFByZWZpeFN0cigpfS9hcGkvcnVudGltZS9kZnMvdjEuMC9mb3JtZG9jL211bHRpL3VwbG9hZGA7XHJcbiAgICAgICAgY29uc3QgbXIgPSBKU09OLnBhcnNlKGZvcm1kYXRhLmdldCgnbXVsdGlSZXF1ZXN0JykgYXMgYW55KTtcclxuICAgICAgICBtci51cGxvYWRJZCA9IHIudXBsb2FkSWQ7XHJcbiAgICAgICAgbXIubWV0YWRhdGFJZCA9IHIubWV0YWRhdGFJZDtcclxuICAgICAgICBmb3JtZGF0YS5zZXQoJ211bHRpUmVxdWVzdCcsIEpTT04uc3RyaW5naWZ5KG1yKSk7XHJcblxyXG4gICAgICAgIGNvbnN0IGRpID0gSlNPTi5wYXJzZShmb3JtZGF0YS5nZXQoJ2RvY0luZm8nKSBhcyBhbnkpO1xyXG4gICAgICAgIGRpLm1ldGFkYXRhSWQgPSByLm1ldGFkYXRhSWQ7XHJcbiAgICAgICAgZm9ybWRhdGEuc2V0KCdkb2NJbmZvJywgSlNPTi5zdHJpbmdpZnkoZGkpKTtcclxuXHJcbiAgICAgICAgcmV0dXJuICB0aGlzLnVwbG9hZFNlclsnaHR0cCddWydodHRwJ10ucG9zdCh1cmwsIGZvcm1kYXRhKS5waXBlKFxyXG4gICAgICAgICAgICB0YXAocmVzID0+IHsgfSksXHJcbiAgICAgICAgICAgIGNhdGNoRXJyb3IoKGVycm9yOiBIdHRwRXJyb3JSZXNwb25zZSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG9mKGVycm9yKTtcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICApO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgdXBsb2FkQ2h1bmtzMihmaWxlLCB1cENodW5rJDogU3ViamVjdDxhbnk+KSB7XHJcblxyXG4gICAgICAgIGNvbnN0IHRvdGFsID0gZmlsZS50b3RhbDtcclxuXHJcbiAgICAgICAgbGV0IHQgPSAtMTtcclxuXHJcblxyXG4gICAgICAgIGNvbnN0IGRvQ2h1bmtzUmVtYWluID0gKGkpID0+IGkgPCB0b3RhbDtcclxuICAgICAgICBjb25zdCBjb21wbGV0ZVVwbG9hZCA9IChmKSA9PiBvZihmKTtcclxuICAgICAgICBjb25zdCB1cGxvYWRDaHVuayA9IChmLCB1cGxvYWRJZDogYW55KSA9PiB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLm11bHRpVXBsb2FkKGYsIHVwbG9hZElkKS5waXBlKFxyXG4gICAgICAgICAgICAgICAgZGVsYXkoMTAwKSxcclxuICAgICAgICAgICAgICAgIG1hcCgocmVzOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAvLyDlnZfmlbDkuLowIOaXtu+8jOWNs+S4uuatpOaWh+S7tueahOaJgOacieWdl+Wdh+S4iuS8oOaIkOWKn1xyXG4gICAgICAgICAgICAgICAgICAgIGZpbGUucHJvZ3Jlc3MgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1czogVXBsb2FkU3RhdHVzLlVwbG9hZGluZyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YTogIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBlcmNlbnRhZ2U6IChyZXMuaW5kZXggLyBmaWxlLmNodW5rcy5sZW5ndGggKiAxMDApLnRvRml4ZWQoMClcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICAgICAgdXBDaHVuayQubmV4dCh7IHR5cGU6ICd1cGxvYWRpbmcnLCBmaWxlczogW2ZpbGVdIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXMgJiYgcmVzLnJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoICFmaWxlLnBhcnRMaXN0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlLnBhcnRMaXN0ID0gW107XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgZmlsZS5wYXJ0TGlzdC5wdXNoKHJlcy5yZXN1bHQpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmlsZTtcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIClcclxuICAgICAgICB9O1xyXG4gICAgICAgIGNvbnN0IGNyZWF0ZU11bHRpcGFydFVwbG9hZCA9IChmKSA9PiB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmluaXRNdWx0aVVwbG9hZChmKTtcclxuICAgICAgICAgICAgLy8gcmV0dXJuIG9mKGYpXHJcbiAgICAgICAgfTtcclxuXHJcblxyXG4gICAgICAgIHJldHVybiBjcmVhdGVNdWx0aXBhcnRVcGxvYWQoZmlsZSkucGlwZShcclxuICAgICAgICAgICAgLy8gdGFwKChmKSA9PiBjb25zb2xlLmxvZyhcInVwbG9hZCBmaWxlXCIsIGYubmFtZSkpLFxyXG4gICAgICAgICAgICBleHBhbmQoKHI6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKGRvQ2h1bmtzUmVtYWluKCsrdCkpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdXBsb2FkQ2h1bmsoZmlsZS5jaHVua3NbdF0sIHIpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIEVNUFRZO1xyXG4gICAgICAgICAgICB9KSxcclxuICAgICAgICAgICAgLy8gdGFwKChmOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgLy8gICAgIGNvbnNvbGUubG9nKGBmaWxlOiAke2YubmFtZX0gLSByZW1haW5pbmcgY2h1bmtzOiAke2YudG90YWx9YCk7XHJcbiAgICAgICAgICAgIC8vIH0pLFxyXG4gICAgICAgICAgICBsYXN0KCksXHJcbiAgICAgICAgICAgIHN3aXRjaE1hcCgocmVzOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBjb21wbGV0ZVVwbG9hZChmaWxlKTtcclxuXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIF9nZXRCaWdGaWxlQ2h1bmtzMihmaWxlOiBVcGxvYWRGaWxlLCBldmVudDogVXBsb2FkSW5wdXQsIGV4dGVuZFNlcnZpY2U6IEZGaWxlVXBsb2FkQWRhcHRVbmlmaWxlQ29uZmlnKSB7XHJcbiAgICAgICAgbGV0IHV1aWQgPSB0aGlzLnV1aWQoKTtcclxuICAgICAgICBcclxuICAgICAgICBjb25zdCBfYmlmZmVyU2l6ZSA9IE1hdGgubWF4KGV2ZW50LmNodW5rU2l6ZSw1KSp0aGlzLmJ1ZmZlclNpemU7XHJcblxyXG4gICAgICAgIGxldCBjaHVua1RvdGFsOiBudW1iZXIgPSBNYXRoLmNlaWwoZmlsZS5zaXplIC8gX2JpZmZlclNpemUpO1xyXG4gICAgICAgIGxldCBjaHVua0luZGV4OiBudW1iZXIgPSAwO1xyXG4gICAgICAgIGNvbnN0IGZpbGVDaHVua3MgPSB7Y2h1bmtzOiBbXSwgdG90YWw6IGNodW5rVG90YWx9O1xyXG5cclxuICAgICAgICBjb25zdCByb290SWQgPSB0aGlzLmdldEZpbmFsbHlDb25maWcoJ3Jvb3RJZCcsIGV4dGVuZFNlcnZpY2UpO1xyXG5cclxuXHJcbiAgICAgICAgd2hpbGUgKGNodW5rSW5kZXggPCBjaHVua1RvdGFsKSB7XHJcblxyXG4gICAgICAgICAgICBsZXQgbmV4dFNpemUgPSBNYXRoLm1pbigoY2h1bmtJbmRleCArIDEpICogX2JpZmZlclNpemUsIGZpbGUuc2l6ZSk7XHJcbiAgICAgICAgICAgIC8vIEZpbGXnsbvlnotcclxuICAgICAgICAgICAgbGV0IGZpbGVEYXRhID0gZmlsZVsnbmF0aXZlRmlsZSddLnNsaWNlKGNodW5rSW5kZXggKiBfYmlmZmVyU2l6ZSwgbmV4dFNpemUpO1xyXG5cclxuICAgICAgICAgICAgbGV0IG11bHRpUmVxdWVzdDogYW55ID0ge307XHJcbiAgICAgICAgICAgIG11bHRpUmVxdWVzdC5tZXRhZGF0YUlkID0gdXVpZDtcclxuICAgICAgICAgICAgbXVsdGlSZXF1ZXN0LnJvb3RJZCA9IHJvb3RJZDtcclxuICAgICAgICAgICAgLy8gbXVsdGlSZXF1ZXN0LnVwbG9hZElkID0gdXBsb2FkSWQ7XHJcbiAgICAgICAgICAgIG11bHRpUmVxdWVzdC5pbmRleCA9IGNodW5rSW5kZXg7XHJcbiAgICAgICAgICAgIG11bHRpUmVxdWVzdC50b3RhbCA9IGNodW5rVG90YWw7XHJcbiAgICAgICAgICAgIG11bHRpUmVxdWVzdC5zaXplID0gZmlsZURhdGEuc2l6ZTtcclxuICAgICAgXHJcbiAgICAgICAgICAgIC8v5bCB6KOF6K+35rGCZm9ybWRhdGFcclxuICAgICAgICAgICAgbGV0IGZvcm1EYXRhID0gbmV3IEZvcm1EYXRhKCk7XHJcbiAgICAgICAgICAgIGZvcm1EYXRhLmFwcGVuZCgnbXVsdGlSZXF1ZXN0JywgSlNPTi5zdHJpbmdpZnkobXVsdGlSZXF1ZXN0KSk7XHJcbiAgICAgICAgICAgIGZvcm1EYXRhLmFwcGVuZCgnZmlsZScsIGZpbGVEYXRhKTtcclxuXHJcblxyXG4gICAgICAgICAgICBsZXQgZG9jSW5mbzogR3NwRm9ybURvY0luZm8gPSBuZXcgR3NwRm9ybURvY0luZm8oKTtcclxuXHJcbiAgICAgICAgICAgIGRvY0luZm8uZmlsZU5hbWUgPSBmaWxlLm5hbWU7XHJcbiAgICAgICAgICAgIGRvY0luZm8ubWV0YWRhdGFJZCA9IHV1aWQ7XHJcbiAgICAgICAgICAgIGRvY0luZm8udG90YWwgPSBjaHVua1RvdGFsO1xyXG4gICAgICAgICAgICBkb2NJbmZvLnNpemUgPSBmaWxlLnNpemU7XHJcbiAgICAgICAgICAgIGRvY0luZm8uaW5kZXggPSBjaHVua0luZGV4O1xyXG4gICAgICAgICAgICBkb2NJbmZvLmZpbGVDb250ZW50ID0gXCJcIjtcclxuXHJcbiAgICAgICAgICAgIGZvcm1EYXRhLmFwcGVuZChcImRvY0luZm9cIiwgSlNPTi5zdHJpbmdpZnkoZG9jSW5mbykpO1xyXG5cclxuICAgICAgICAgICAgLy8g5aaC5p6cZGF0YemHjOacieaVsOaNru+8jOW5tuS4lOWxnuaAp+aYr+mFjee9rueahOaJqeWxleWxnuaAp1xyXG4gICAgICAgICAgICBpZiAoXHJcbiAgICAgICAgICAgICAgICBldmVudC5oYXNPd25Qcm9wZXJ0eShcImRhdGFcIikgJiZcclxuICAgICAgICAgICAgICAgIGV2ZW50W1wiZGF0YVwiXSAmJlxyXG4gICAgICAgICAgICAgICAgZXZlbnRbXCJkYXRhXCJdLmhhc093blByb3BlcnR5KFwiZXh0UHJvcGVydHlcIilcclxuICAgICAgICAgICAgKSB7XHJcbiAgICAgICAgICAgICAgICBkb2NJbmZvW1wiZXh0UHJvcGVydHlcIl0gPSBldmVudFtcImRhdGFcIl1bXHJcbiAgICAgICAgICAgICAgICAgICAgXCJleHRQcm9wZXJ0eVwiXHJcbiAgICAgICAgICAgICAgICBdIGFzIEdzcERvY01ldGFQcm9wZXJ0eTtcclxuICAgICAgICAgICAgfVxyXG5cclxuXHJcblxyXG4gICAgICAgICAgICBmaWxlQ2h1bmtzLmNodW5rcy5wdXNoKGZvcm1EYXRhKTtcclxuICAgICAgICAgICAgY2h1bmtJbmRleCA9IGNodW5rSW5kZXggKyAxO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIGZpbGVDaHVua3M7XHJcbiAgICBcclxuICAgIH1cclxuXHJcblxyXG5cclxuICAgIC8vI2VuZHJlZ2lvblxyXG5cclxufVxyXG4iXX0=
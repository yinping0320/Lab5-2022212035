/**
 * @fileoverview added by tsickle
 * Generated from: lib/components/select-help-text-field/select-help-text-field.component.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Output, Input, EventEmitter, ViewChild, TemplateRef, HostBinding, NgZone } from '@angular/core';
import { LocaleService } from '@farris/ui-locale';
import { NotifyService } from '@farris/ui-notify';
import { TreeTableComponent } from '@farris/ui-treetable';
export class SelectHelpTextFieldComponent {
    /**
     * @param {?} notifyService
     * @param {?} ngZone
     * @param {?} localeService
     */
    constructor(notifyService, ngZone, localeService) {
        this.notifyService = notifyService;
        this.ngZone = ngZone;
        this.localeService = localeService;
        this.closeModal = new EventEmitter();
        this.submitModal = new EventEmitter();
        this.helpId = '';
        this.class = 'd-flex f-utils-fill-flex-column h-100';
        this.modalConfig = {
            title: '字段选择器',
            width: 900,
            height: 500,
            showButtons: true,
            showMaxButton: false
        };
        // 树表数据
        this.helpTreeData = [];
        // 树表列配置
        this.treeCols = [{ field: 'name', title: '名称' }, { field: 'label', title: '编号' }, { field: 'bindingPath', title: '绑定字段' }];
        this.fieldName = '名称';
        this.fieldLabel = '编号';
        this.fieldTitle = '绑定字段';
        this.fieldError = '已绑定字段不存在！';
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.fieldName = this.localeService.getValue('lookupConfig.name');
        this.fieldLabel = this.localeService.getValue('lookupConfig.code');
        this.fieldTitle = this.localeService.getValue('lookupConfig.bindingPath');
        this.fieldError = this.localeService.getValue('lookupConfig.fieldError');
        this.treeCols = [{ field: 'name', title: this.fieldName }, { field: 'label', title: this.fieldLabel }, { field: 'bindingPath', title: this.fieldTitle }];
        if (!this.schemaData) {
            return;
        }
        this.getHelpFields(this.schemaData);
    }
    /**
     * 获取帮助schema字段
     * @param {?} schema schema
     * @return {?}
     */
    getHelpFields(schema) {
        if (!schema || !schema.entities || schema.entities.length === 0) {
            return;
        }
        /** @type {?} */
        const mainTable = schema.entities[0];
        if (mainTable.type && mainTable.type.fields) {
            this.helpTreeData = this.assembleFields2Tree(mainTable.type.fields);
        }
        this.ngZone.runOutsideAngular((/**
         * @return {?}
         */
        () => {
            setTimeout((/**
             * @return {?}
             */
            () => {
                if (!this.value) {
                    return;
                }
                try {
                    this.treeTable.selectNode(this.value);
                }
                catch (e) {
                    this.treeTable.clearSelections();
                    this.notifyService.error(this.fieldError);
                }
            }));
        }));
    }
    /**
     * schema字段集合组装成树
     * @param {?} fields schema字段集合
     * @return {?}
     */
    assembleFields2Tree(fields) {
        /** @type {?} */
        const treeData = [];
        fields.forEach((/**
         * @param {?} element
         * @return {?}
         */
        element => {
            // 关联表字段 / UDT字段
            /** @type {?} */
            let children = [];
            if (element.type && element.type.fields && element.type.fields.length > 0) {
                children = this.assembleFields2Tree(element.type.fields);
            }
            // 适配旧的帮助元数据没有bindingPath属性
            if (!element.bindingPath) {
                element.bindingPath = element['parentPath'] ? element['parentPath'] + '.' + element.label : element.label;
            }
            treeData.push({
                data: element,
                children,
                expanded: true,
                selectable: children.length > 0 ? false : true
            });
        }));
        return treeData;
    }
    /**
     * 取消
     * @return {?}
     */
    clickCancel() {
        this.closeModal.emit();
    }
    /**
     * 确定
     * @return {?}
     */
    clickConfirm() {
        if (!this.treeTable.selectedRow) {
            this.notifyService.warning('请选择字段');
            return;
        }
        /** @type {?} */
        const selectedData = this.treeTable.selectedRow.data;
        this.submitModal.emit({ value: selectedData.bindingPath, name: selectedData.name });
    }
}
SelectHelpTextFieldComponent.decorators = [
    { type: Component, args: [{
                selector: 'app-select-help-text-field',
                template: "<farris-treetable #treeTable [data]=\"helpTreeData\" [columns]=\"treeCols\" [idField]=\"'bindingPath'\" [fixedHeader]=\"true\"\r\n    [fit]=\"true\" [singleSelect]=\"true\" [showFilterBar]=\"false\" [resizableColumns]=\"true\"\r\n    [showCheckAll]=\"false\" [showCheckbox]=\"false\" [checkOnSelect]=\"true\" [selectOnCheck]=\"true\">\r\n</farris-treetable>\r\n\r\n<ng-template #modalFooter>\r\n    <button type=\"button\" class=\"btn btn-secondary\" (click)=\"clickCancel()\">{{ 'lookupConfig.cancel' | locale }}</button>\r\n    <button type=\"button\" class=\"btn btn-primary\" (click)=\"clickConfirm()\">{{ 'lookupConfig.sure' | locale }}</button>\r\n</ng-template>"
            }] }
];
/** @nocollapse */
SelectHelpTextFieldComponent.ctorParameters = () => [
    { type: NotifyService },
    { type: NgZone },
    { type: LocaleService }
];
SelectHelpTextFieldComponent.propDecorators = {
    closeModal: [{ type: Output }],
    submitModal: [{ type: Output }],
    value: [{ type: Input }],
    helpId: [{ type: Input }],
    schemaData: [{ type: Input }],
    modalFooter: [{ type: ViewChild, args: ['modalFooter',] }],
    class: [{ type: HostBinding, args: ['class',] }],
    treeTable: [{ type: ViewChild, args: ['treeTable',] }]
};
if (false) {
    /** @type {?} */
    SelectHelpTextFieldComponent.prototype.closeModal;
    /** @type {?} */
    SelectHelpTextFieldComponent.prototype.submitModal;
    /** @type {?} */
    SelectHelpTextFieldComponent.prototype.value;
    /** @type {?} */
    SelectHelpTextFieldComponent.prototype.helpId;
    /** @type {?} */
    SelectHelpTextFieldComponent.prototype.schemaData;
    /** @type {?} */
    SelectHelpTextFieldComponent.prototype.modalFooter;
    /** @type {?} */
    SelectHelpTextFieldComponent.prototype.class;
    /** @type {?} */
    SelectHelpTextFieldComponent.prototype.modalConfig;
    /** @type {?} */
    SelectHelpTextFieldComponent.prototype.helpTreeData;
    /** @type {?} */
    SelectHelpTextFieldComponent.prototype.treeCols;
    /** @type {?} */
    SelectHelpTextFieldComponent.prototype.fieldName;
    /** @type {?} */
    SelectHelpTextFieldComponent.prototype.fieldLabel;
    /** @type {?} */
    SelectHelpTextFieldComponent.prototype.fieldTitle;
    /** @type {?} */
    SelectHelpTextFieldComponent.prototype.fieldError;
    /** @type {?} */
    SelectHelpTextFieldComponent.prototype.treeTable;
    /**
     * @type {?}
     * @private
     */
    SelectHelpTextFieldComponent.prototype.notifyService;
    /**
     * @type {?}
     * @private
     */
    SelectHelpTextFieldComponent.prototype.ngZone;
    /**
     * @type {?}
     * @private
     */
    SelectHelpTextFieldComponent.prototype.localeService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2VsZWN0LWhlbHAtdGV4dC1maWVsZC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL2xvb2t1cC1jb25maWcvIiwic291cmNlcyI6WyJsaWIvY29tcG9uZW50cy9zZWxlY3QtaGVscC10ZXh0LWZpZWxkL3NlbGVjdC1oZWxwLXRleHQtZmllbGQuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsT0FBTyxFQUFFLFNBQVMsRUFBVSxNQUFNLEVBQUUsS0FBSyxFQUFFLFlBQVksRUFBRSxTQUFTLEVBQUUsV0FBVyxFQUFFLFdBQVcsRUFBRSxNQUFNLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDNUgsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBQ2xELE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUNsRCxPQUFPLEVBQVksa0JBQWtCLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQU1wRSxNQUFNLE9BQU8sNEJBQTRCOzs7Ozs7SUE4QnJDLFlBQW9CLGFBQTRCLEVBQVUsTUFBYyxFQUFTLGFBQTRCO1FBQXpGLGtCQUFhLEdBQWIsYUFBYSxDQUFlO1FBQVUsV0FBTSxHQUFOLE1BQU0sQ0FBUTtRQUFTLGtCQUFhLEdBQWIsYUFBYSxDQUFlO1FBN0JuRyxlQUFVLEdBQUcsSUFBSSxZQUFZLEVBQU8sQ0FBQztRQUNyQyxnQkFBVyxHQUFHLElBQUksWUFBWSxFQUFPLENBQUM7UUFFdkMsV0FBTSxHQUFHLEVBQUUsQ0FBQztRQUtyQixVQUFLLEdBQUcsdUNBQXVDLENBQUM7UUFFaEQsZ0JBQVcsR0FBRztZQUNWLEtBQUssRUFBRSxPQUFPO1lBQ2QsS0FBSyxFQUFFLEdBQUc7WUFDVixNQUFNLEVBQUUsR0FBRztZQUNYLFdBQVcsRUFBRSxJQUFJO1lBQ2pCLGFBQWEsRUFBRSxLQUFLO1NBQ3ZCLENBQUM7O1FBR0YsaUJBQVksR0FBZSxFQUFFLENBQUM7O1FBRTlCLGFBQVEs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LElBQUksRUFBRSxDQUFDLENBQUM7SUFDeEYsQ0FBQzs7O1lBbEhKLFNBQVMsU0FBQztnQkFDUCxRQUFRLEVBQUUsNEJBQTRCO2dCQUN0Qyx3cUJBQXNEO2FBQ3pEOzs7O1lBTlEsYUFBYTtZQUZ3RSxNQUFNO1lBQzNGLGFBQWE7Ozt5QkFTakIsTUFBTTswQkFDTixNQUFNO29CQUNOLEtBQUs7cUJBQ0wsS0FBSzt5QkFDTCxLQUFLOzBCQUNMLFNBQVMsU0FBQyxhQUFhO29CQUV2QixXQUFXLFNBQUMsT0FBTzt3QkFvQm5CLFNBQVMsU0FBQyxXQUFXOzs7O0lBM0J0QixrREFBK0M7O0lBQy9DLG1EQUFnRDs7SUFDaEQsNkNBQWU7O0lBQ2YsOENBQXFCOztJQUNyQixrREFBb0I7O0lBQ3BCLG1EQUF3RDs7SUFFeEQsNkNBQ2dEOztJQUVoRCxtREFNRTs7SUFHRixvREFBOEI7O0lBRTlCLGdEQUFzSDs7SUFDdEgsaURBQWlCOztJQUNqQixrREFBa0I7O0lBQ2xCLGtEQUFvQjs7SUFDcEIsa0RBQXlCOztJQUV6QixpREFBc0Q7Ozs7O0lBRTFDLHFEQUFvQzs7Ozs7SUFBRSw4Q0FBc0I7Ozs7O0lBQUMscURBQW9DIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBPbkluaXQsIE91dHB1dCwgSW5wdXQsIEV2ZW50RW1pdHRlciwgVmlld0NoaWxkLCBUZW1wbGF0ZVJlZiwgSG9zdEJpbmRpbmcsIE5nWm9uZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBMb2NhbGVTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy91aS1sb2NhbGUnO1xyXG5pbXBvcnQgeyBOb3RpZnlTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy91aS1ub3RpZnknO1xyXG5pbXBvcnQgeyBUcmVlTm9kZSwgVHJlZVRhYmxlQ29tcG9uZW50IH0gZnJvbSAnQGZhcnJpcy91aS10cmVldGFibGUnO1xyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgICBzZWxlY3RvcjogJ2FwcC1zZWxlY3QtaGVscC10ZXh0LWZpZWxkJyxcclxuICAgIHRlbXBsYXRlVXJsOiAnLi9zZWxlY3QtaGVscC10ZXh0LWZpZWxkLmNvbXBvbmVudC5odG1sJ1xyXG59KVxyXG5leHBvcnQgY2xhc3MgU2VsZWN0SGVscFRleHRGaWVsZENvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCB7XHJcbiAgICBAT3V0cHV0KCkgY2xvc2VNb2RhbCA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xyXG4gICAgQE91dHB1dCgpIHN1Ym1pdE1vZGFsID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XHJcbiAgICBASW5wdXQoKSB2YWx1ZTtcclxuICAgIEBJbnB1dCgpIGhlbHBJZCA9ICcnO1xyXG4gICAgQElucHV0KCkgc2NoZW1hRGF0YTtcclxuICAgIEBWaWV3Q2hpbGQoJ21vZGFsRm9vdGVyJykgbW9kYWxGb290ZXI6IFRlbXBsYXRlUmVmPGFueT47XHJcblxyXG4gICAgQEhvc3RCaW5kaW5nKCdjbGFzcycpXHJcbiAgICBjbGFzcyA9ICdkLWZsZXggZi11dGlscy1maWxsLWZsZXgtY29sdW1uIGgtMTAwJztcclxuXHJcbiAgICBtb2RhbENvbmZpZyA9IHtcclxuICAgICAgICB0aXRsZTogJ+Wtl+autemAieaLqeWZqCcsXHJcbiAgICAgICAgd2lkdGg6IDkwMCxcclxuICAgICAgICBoZWlnaHQ6IDUwMCxcclxuICAgICAgICBzaG93QnV0dG9uczogdHJ1ZSxcclxuICAgICAgICBzaG93TWF4QnV0dG9uOiBmYWxzZVxyXG4gICAgfTtcclxuXHJcbiAgICAvLyDmoJHooajmlbDmja5cclxuICAgIGhlbHBUcmVlRGF0YTogVHJlZU5vZGVbXSA9IFtdO1xyXG4gICAgLy8g5qCR6KGo5YiX6YWN572uXHJcbiAgICB0cmVlQ29scyA9IFt7IGZpZWxkOiAnbmFtZScsIHRpdGxlOiAn5ZCN56ewJyB9LCB7IGZpZWxkOiAnbGFiZWwnLCB0aXRsZTogJ+e8luWPtycgfSwgeyBmaWVsZDogJ2JpbmRpbmdQYXRoJywgdGl0bGU6ICfnu5HlrprlrZfmrrUnIH1dO1xyXG4gICAgZmllbGROYW1lID0gJ+WQjeensCc7XHJcbiAgICBmaWVsZExhYmVsID0gJ+e8luWPtyc7XHJcbiAgICBmaWVsZFRpdGxlID0gJ+e7keWumuWtl+autSc7XHJcbiAgICBmaWVsZEVycm9yID0gJ+W3sue7keWumuWtl+auteS4jeWtmOWcqO+8gSc7XHJcbiAgICAvLyDmoJHooajlrp7kvotcclxuICAgIEBWaWV3Q2hpbGQoJ3RyZWVUYWJsZScpIHRyZWVUYWJsZTogVHJlZVRhYmxlQ29tcG9uZW50O1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgbm90aWZ5U2VydmljZTogTm90aWZ5U2VydmljZSwgcHJpdmF0ZSBuZ1pvbmU6IE5nWm9uZSxwcml2YXRlIGxvY2FsZVNlcnZpY2U6IExvY2FsZVNlcnZpY2UpIHsgfVxyXG5cclxuICAgIG5nT25Jbml0KCk6IHZvaWQge1xyXG4gICAgICAgIHRoaXMuZmllbGROYW1lID0gdGhpcy5sb2NhbGVTZXJ2aWNlLmdldFZhbHVlKCdsb29rdXBDb25maWcubmFtZScpO1xyXG4gICAgICAgIHRoaXMuZmllbGRMYWJlbCA9IHRoaXMubG9jYWxlU2VydmljZS5nZXRWYWx1ZSgnbG9va3VwQ29uZmlnLmNvZGUnKTtcclxuICAgICAgICB0aGlzLmZpZWxkVGl0bGUgPSB0aGlzLmxvY2FsZVNlcnZpY2UuZ2V0VmFsdWUoJ2xvb2t1cENvbmZpZy5iaW5kaW5nUGF0aCcpO1xyXG4gICAgICAgIHRoaXMuZmllbGRFcnJvciA9IHRoaXMubG9jYWxlU2VydmljZS5nZXRWYWx1ZSgnbG9va3VwQ29uZmlnLmZpZWxkRXJyb3InKTtcclxuICAgICAgICB0aGlzLnRyZWVDb2xzID0gW3sgZmllbGQ6ICduYW1lJywgdGl0bGU6IHRoaXMuZmllbGROYW1lIH0sIHsgZmllbGQ6ICdsYWJlbCcsIHRpdGxlOiB0aGlzLmZpZWxkTGFiZWwgfSwgeyBmaWVsZDogJ2JpbmRpbmdQYXRoJywgdGl0bGU6IHRoaXMuZmllbGRUaXRsZSB9XTtcclxuICAgICAgICBpZiAoIXRoaXMuc2NoZW1hRGF0YSkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuZ2V0SGVscEZpZWxkcyh0aGlzLnNjaGVtYURhdGEpO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiDojrflj5bluK7liqlzY2hlbWHlrZfmrrVcclxuICAgICAqIEBwYXJhbSBzY2hlbWEgc2NoZW1hXHJcbiAgICAgKi9cclxuICAgIGdldEhlbHBGaWVsZHMoc2NoZW1hKSB7XHJcbiAgICAgICAgaWYgKCFzY2hlbWEgfHwgIXNjaGVtYS5lbnRpdGllcyB8fCBzY2hlbWEuZW50aXRpZXMubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc3QgbWFpblRhYmxlID0gc2NoZW1hLmVudGl0aWVzWzBdO1xyXG4gICAgICAgIGlmIChtYWluVGFibGUudHlwZSAmJiBtYWluVGFibGUudHlwZS5maWVsZHMpIHtcclxuICAgICAgICAgICAgdGhpcy5oZWxwVHJlZURhdGEgPSB0aGlzLmFzc2VtYmxlRmllbGRzMlRyZWUobWFpblRhYmxlLnR5cGUuZmllbGRzKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5uZ1pvbmUucnVuT3V0c2lkZUFuZ3VsYXIoKCkgPT4ge1xyXG4gICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgICAgICAgIGlmICghdGhpcy52YWx1ZSkgeyByZXR1cm47IH1cclxuICAgICAgICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy50cmVlVGFibGUuc2VsZWN0Tm9kZSh0aGlzLnZhbHVlKTtcclxuICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnRyZWVUYWJsZS5jbGVhclNlbGVjdGlvbnMoKTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLm5vdGlmeVNlcnZpY2UuZXJyb3IodGhpcy5maWVsZEVycm9yKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIHNjaGVtYeWtl+autembhuWQiOe7hOijheaIkOagkVxyXG4gICAgICogQHBhcmFtIGZpZWxkcyBzY2hlbWHlrZfmrrXpm4blkIhcclxuICAgICAqL1xyXG4gICAgYXNzZW1ibGVGaWVsZHMyVHJlZShmaWVsZHMpIHtcclxuICAgICAgICBjb25zdCB0cmVlRGF0YSA9IFtdO1xyXG4gICAgICAgIGZpZWxkcy5mb3JFYWNoKGVsZW1lbnQgPT4ge1xyXG4gICAgICAgICAgICAvLyDlhbPogZTooajlrZfmrrUgLyBVRFTlrZfmrrVcclxuICAgICAgICAgICAgbGV0IGNoaWxkcmVuID0gW107XHJcbiAgICAgICAgICAgIGlmIChlbGVtZW50LnR5cGUgJiYgZWxlbWVudC50eXBlLmZpZWxkcyAmJiBlbGVtZW50LnR5cGUuZmllbGRzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgIGNoaWxkcmVuID0gdGhpcy5hc3NlbWJsZUZpZWxkczJUcmVlKGVsZW1lbnQudHlwZS5maWVsZHMpO1xyXG5cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvLyDpgILphY3ml6fnmoTluK7liqnlhYPmlbDmja7msqHmnIliaW5kaW5nUGF0aOWxnuaAp1xyXG4gICAgICAgICAgICBpZiAoIWVsZW1lbnQuYmluZGluZ1BhdGgpIHtcclxuICAgICAgICAgICAgICAgIGVsZW1lbnQuYmluZGluZ1BhdGggPSBlbGVtZW50WydwYXJlbnRQYXRoJ10gPyBlbGVtZW50WydwYXJlbnRQYXRoJ10gKyAnLicgKyBlbGVtZW50LmxhYmVsIDogZWxlbWVudC5sYWJlbDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0cmVlRGF0YS5wdXNoKHtcclxuICAgICAgICAgICAgICAgIGRhdGE6IGVsZW1lbnQsXHJcbiAgICAgICAgICAgICAgICBjaGlsZHJlbixcclxuICAgICAgICAgICAgICAgIGV4cGFuZGVkOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgc2VsZWN0YWJsZTogY2hpbGRyZW4ubGVuZ3RoID4gMCA/IGZhbHNlIDogdHJ1ZVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9KTtcclxuICAgICAgICByZXR1cm4gdHJlZURhdGE7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDlj5bmtohcclxuICAgICAqL1xyXG4gICAgY2xpY2tDYW5jZWwoKSB7XHJcbiAgICAgICAgdGhpcy5jbG9zZU1vZGFsLmVtaXQoKTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICog56Gu5a6aXHJcbiAgICAgKi9cclxuICAgIGNsaWNrQ29uZmlybSgpIHtcclxuICAgICAgICBpZiAoIXRoaXMudHJlZVRhYmxlLnNlbGVjdGVkUm93KSB7XHJcbiAgICAgICAgICAgIHRoaXMubm90aWZ5U2VydmljZS53YXJuaW5nKCfor7fpgInmi6nlrZfmrrUnKTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCBzZWxlY3RlZERhdGEgPSB0aGlzLnRyZWVUYWJsZS5zZWxlY3RlZFJvdy5kYXRhO1xyXG4gICAgICAgIHRoaXMuc3VibWl0TW9kYWwuZW1pdCh7IHZhbHVlOiBzZWxlY3RlZERhdGEuYmluZGluZ1BhdGgsIG5hbWU6IHNlbGVjdGVkRGF0YS5uYW1lIH0pO1xyXG4gICAgfVxyXG59XHJcbiJdfQ==
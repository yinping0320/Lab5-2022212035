/**
 * @fileoverview added by tsickle
 * Generated from: lib/lookup-config.service.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Injectable, ComponentFactoryResolver, Injector } from '@angular/core';
import { LookupConfigComponent } from './lookup-config.component';
import { BsModalService } from '@farris/ui-modal';
import { Subject } from 'rxjs';
import { NotifyService } from '@farris/ui-notify';
import { ConfigService } from './config.service';
import { HttpClient } from '@angular/common/http';
import { LocaleService } from '@farris/ui-locale';
import * as i0 from "@angular/core";
import * as i1 from "@farris/ui-modal";
import * as i2 from "@farris/ui-notify";
import * as i3 from "./config.service";
import * as i4 from "@angular/common/http";
export class LookupConfigService {
    /**
     * @param {?} cfr
     * @param {?} injector
     * @param {?} modalService
     * @param {?} notifyService
     * @param {?} configService
     * @param {?} http
     */
    constructor(cfr, injector, modalService, notifyService, configService, http) {
        this.cfr = cfr;
        this.injector = injector;
        this.modalService = modalService;
        this.notifyService = notifyService;
        this.configService = configService;
        this.http = http;
        this.lookupconfigData = new Subject();
        this.lookupconfigDatas = new Subject();
        this.lookupTitle = '帮助配置';
        this.modalSure = '确定';
        this.modalCancel = '取消';
        this.successSave = '保存成功';
        this.helpIdError = '请选择帮助元数据';
        this.localeService = this.injector.get(LocaleService);
        this.lookupTitle = this.localeService.getValue('lookupConfig.lookupTitle');
        this.modalSure = this.localeService.getValue('lookupConfig.sure');
        this.modalCancel = this.localeService.getValue('lookupConfig.cancel');
        this.successSave = this.localeService.getValue('lookupConfig.successSave');
        this.helpIdError = this.localeService.getValue('lookupConfig.helpIdError');
        // this.injectService();
    }
    /**
     * @param {?} option
     * @return {?}
     */
    showConfig(option) {
        /** @type {?} */
        const LookupConfigF = this.cfr.resolveComponentFactory(LookupConfigComponent);
        /** @type {?} */
        const LookupConfigR = LookupConfigF.create(this.injector);
        LookupConfigR.instance.configId = option.configId;
        if (option.hasOwnProperty('metadataPath')) {
            LookupConfigR.instance.metadataPath = option.metadataPath;
        }
        if (option.hasOwnProperty('readonly')) {
            LookupConfigR.instance.readonly = option.readonly;
        }
        // if (option.hasOwnProperty('isDeisgnerEnv')) {
        //   LookupConfigR.instance.isDeisgnerEnv = option.isDeisgnerEnv;
        // }
        this.lookupDlg = this.modalService.show(LookupConfigR, {
            title: this.lookupTitle,
            width: 1000,
            height: 800,
            buttons: [
                {
                    text: this.modalSure, cls: 'btn btn-primary', handle: (/**
                     * @param {?} e
                     * @return {?}
                     */
                    (e) => {
                        this.lookupData = LookupConfigR.instance.getdata();
                        if (this.lookupData.helpId === '') {
                            this.notifyService.error(this.helpIdError);
                        }
                        else {
                            /** @type {?} */
                            let params = this.configDataInit(this.lookupData);
                            this.configService.saveHelpConfig(params).subscribe((/**
                             * @param {?} metadata
                             * @return {?}
                             */
                            metadata => {
                                if (metadata) {
                                    this.lookupconfigData.next(metadata['id']);
                                    this.lookupconfigDatas.next(metadata);
                                    this.notifyService.success(this.successSave);
                                }
                                this.lookupDlg.close();
                            }), (/**
                             * @param {?} error
                             * @return {?}
                             */
                            error => {
                                if (error.message) {
                                    this.notifyService.error(error.message);
                                }
                            }));
                            // this.lookupconfigData.next(this.lookupData);
                        }
                    })
                },
                {
                    text: this.modalCancel, cls: 'btn btn-secondary', handle: (/**
                     * @param {?} e
                     * @return {?}
                     */
                    (e) => {
                        this.lookupDlg.close();
                    })
                }
            ],
            showButtons: true
        });
        // return this.el;
    }
    /**
     * @return {?}
     */
    getLookupData() {
        return this.lookupconfigData;
    }
    /**
     * @return {?}
     */
    getLookUpDatas() {
        return this.lookupconfigDatas;
    }
    /**
     * @param {?} lookupData
     * @return {?}
     */
    configDataInit(lookupData) {
        /** @type {?} */
        let data = {
            id: lookupData.configId,
            name: lookupData.name,
            code: lookupData.code,
            helpId: lookupData.helpId,
            queryParam: {
                filter: {
                    isUsePagination: false,
                    filterConditions: lookupData.filter
                },
                textField: lookupData.textField,
                loadTreeDataType: lookupData.loadDataType
            }
        };
        return data;
    }
}
LookupConfigService.decorators = [
    { type: Injectable, args: [{
                providedIn: 'root'
            },] }
];
/** @nocollapse */
LookupConfigService.ctorParameters = () => [
    { type: ComponentFactoryResolver },
    { type: Injector },
    { type: BsModalService },
    { type: NotifyService },
    { type: ConfigService },
    { type: HttpClient }
];
/** @nocollapse */ LookupConfigService.ngInjectableDef = i0.defineInjectable({ factory: function LookupConfigService_Factory() { return new LookupConfigService(i0.inject(i0.ComponentFactoryResolver), i0.inject(i0.INJECTOR), i0.inject(i1.BsModalService), i0.inject(i2.NotifyService), i0.inject(i3.ConfigService), i0.inject(i4.HttpClient)); }, token: LookupConfigService, providedIn: "root" });
if (false) {
    /** @type {?} */
    LookupConfigService.prototype.lookupDlg;
    /**
     * @type {?}
     * @private
     */
    LookupConfigService.prototype.lookupconfigData;
    /**
     * @type {?}
     * @private
     */
    LookupConfigService.prototype.lookupconfigDatas;
    /** @type {?} */
    LookupConfigService.prototype.lookupData;
    /** @type {?} */
    LookupConfigService.prototype.localeService;
    /** @type {?} */
    LookupConfigService.prototype.lookupTitle;
    /** @type {?} */
    LookupConfigService.prototype.modalSure;
    /** @type {?} */
    LookupConfigService.prototype.modalCancel;
    /** @type {?} */
    LookupConfigService.prototype.successSave;
    /** @type {?} */
    LookupConfigService.prototype.helpIdError;
    /**
     * @type {?}
     * @private
     */
    LookupConfigService.prototype.cfr;
    /**
     * @type {?}
     * @private
     */
    LookupConfigService.prototype.injector;
    /**
     * @type {?}
     * @private
     */
    LookupConfigService.prototype.modalService;
    /**
     * @type {?}
     * @private
     */
    LookupConfigService.prototype.notifyService;
    /**
     * @type {?}
     * @private
     */
    LookupConfigService.prototype.configService;
    /** @type {?} */
    LookupConfigService.prototype.http;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibG9va3VwLWNvbmZpZy5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy9sb29rdXAtY29uZmlnLyIsInNvdXJjZXMiOlsibGliL2xvb2t1cC1jb25maWcuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsd0JBQXdCLEVBQUUsUUFBUSxFQUF3QixNQUFNLGVBQWUsQ0FBQztBQUNyRyxPQUFPLEVBQUUscUJBQXFCLEVBQUUsTUFBTSwyQkFBMkIsQ0FBQztBQUNsRSxPQUFPLEVBQUUsY0FBYyxFQUFjLE1BQU0sa0JBQWtCLENBQUM7QUFDOUQsT0FBTyxFQUFNLE9BQU8sRUFBYyxNQUFNLE1BQU0sQ0FBQztBQUMvQyxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFDbEQsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLGtCQUFrQixDQUFDO0FBQ2pELE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUdsRCxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sbUJBQW1CLENBQUM7Ozs7OztBQUtsRCxNQUFNLE9BQU8sbUJBQW1COzs7Ozs7Ozs7SUFhOUIsWUFDVSxHQUE2QixFQUM3QixRQUFrQixFQUNsQixZQUE0QixFQUM1QixhQUE0QixFQUM1QixhQUE0QixFQUM3QixJQUFnQjtRQUxmLFFBQUcsR0FBSCxHQUFHLENBQTBCO1FBQzdCLGFBQVEsR0FBUixRQUFRLENBQVU7UUFDbEIsaUJBQVksR0FBWixZQUFZLENBQWdCO1FBQzVCLGtCQUFhLEdBQWIsYUFBYSxDQUFlO1FBQzVCLGtCQUFhLEdBQWIsYUFBYSxDQUFlO1FBQzdCLFNBQUksR0FBSixJQUFJLENBQVk7UUFoQmpCLHFCQUFnQixHQUFpQixJQUFJLE9BQU8sRUFBRSxDQUFDO1FBQy9DLHNCQUFpQixHQUFpQixJQUFJLE9BQU8sRUFBRSxDQUFDO1FBR3hELGdCQUFXLEdBQVcsTUFBTSxD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LENBQUMsWUFBWTthQUMxQztTQUNGO1FBQ0QsT0FBTyxJQUFJLENBQUM7SUFDZCxDQUFDOzs7WUFoSEYsVUFBVSxTQUFDO2dCQUNWLFVBQVUsRUFBRSxNQUFNO2FBQ25COzs7O1lBYm9CLHdCQUF3QjtZQUFFLFFBQVE7WUFFOUMsY0FBYztZQUVkLGFBQWE7WUFDYixhQUFhO1lBQ2IsVUFBVTs7Ozs7SUFVakIsd0NBQXNCOzs7OztJQUN0QiwrQ0FBdUQ7Ozs7O0lBQ3ZELGdEQUF3RDs7SUFDeEQseUNBQVc7O0lBQ1gsNENBQTZCOztJQUM3QiwwQ0FBNkI7O0lBQzdCLHdDQUF5Qjs7SUFDekIsMENBQTJCOztJQUMzQiwwQ0FBNkI7O0lBQzdCLDBDQUFpQzs7Ozs7SUFHL0Isa0NBQXFDOzs7OztJQUNyQyx1Q0FBMEI7Ozs7O0lBQzFCLDJDQUFvQzs7Ozs7SUFDcEMsNENBQW9DOzs7OztJQUNwQyw0Q0FBb0M7O0lBQ3BDLG1DQUF1QiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUsIENvbXBvbmVudEZhY3RvcnlSZXNvbHZlciwgSW5qZWN0b3IsIE91dHB1dCwgRXZlbnRFbWl0dGVyIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IExvb2t1cENvbmZpZ0NvbXBvbmVudCB9IGZyb20gJy4vbG9va3VwLWNvbmZpZy5jb21wb25lbnQnO1xyXG5pbXBvcnQgeyBCc01vZGFsU2VydmljZSwgQnNNb2RhbFJlZiB9IGZyb20gJ0BmYXJyaXMvdWktbW9kYWwnO1xyXG5pbXBvcnQgeyBvZiwgU3ViamVjdCwgT2JzZXJ2YWJsZSB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQgeyBOb3RpZnlTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy91aS1ub3RpZnknO1xyXG5pbXBvcnQgeyBDb25maWdTZXJ2aWNlIH0gZnJvbSAnLi9jb25maWcuc2VydmljZSc7XHJcbmltcG9ydCB7IEh0dHBDbGllbnQgfSBmcm9tICdAYW5ndWxhci9jb21tb24vaHR0cCc7XHJcbmltcG9ydCB7IFJlbW90ZVBhcmFtcyB9IGZyb20gJ0BmYXJyaXMvdWktbG9va3VwJztcclxuaW1wb3J0IHsgc3dpdGNoTWFwIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xyXG5pbXBvcnQgeyBMb2NhbGVTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy91aS1sb2NhbGUnO1xyXG5cclxuQEluamVjdGFibGUoe1xyXG4gIHByb3ZpZGVkSW46ICdyb290J1xyXG59KVxyXG5leHBvcnQgY2xhc3MgTG9va3VwQ29uZmlnU2VydmljZSB7XHJcblxyXG4gIGxvb2t1cERsZzogQnNNb2RhbFJlZjtcclxuICBwcml2YXRlIGxvb2t1cGNvbmZpZ0RhdGE6IFN1YmplY3Q8YW55PiA9IG5ldyBTdWJqZWN0KCk7XHJcbiAgcHJpdmF0ZSBsb29rdXBjb25maWdEYXRhczogU3ViamVjdDxhbnk+ID0gbmV3IFN1YmplY3QoKTtcclxuICBsb29rdXBEYXRhO1xyXG4gIGxvY2FsZVNlcnZpY2U6IExvY2FsZVNlcnZpY2U7XHJcbiAgbG9va3VwVGl0bGU6IHN0cmluZyA9ICfluK7liqnphY3nva4nO1xyXG4gIG1vZGFsU3VyZTogc3RyaW5nID0gJ+ehruWumic7XHJcbiAgbW9kYWxDYW5jZWw6IHN0cmluZyA9ICflj5bmtognO1xyXG4gIHN1Y2Nlc3NTYXZlOiBzdHJpbmcgPSAn5L+d5a2Y5oiQ5YqfJztcclxuICBoZWxwSWRFcnJvcjogc3RyaW5nID0gJ+ivt+mAieaLqeW4ruWKqeWFg+aVsOaNric7XHJcblxyXG4gIGNvbnN0cnVjdG9yKFxyXG4gICAgcHJpdmF0ZSBjZnI6IENvbXBvbmVudEZhY3RvcnlSZXNvbHZlcixcclxuICAgIHByaXZhdGUgaW5qZWN0b3I6IEluamVjdG9yLFxyXG4gICAgcHJpdmF0ZSBtb2RhbFNlcnZpY2U6IEJzTW9kYWxTZXJ2aWNlLFxyXG4gICAgcHJpdmF0ZSBub3RpZnlTZXJ2aWNlOiBOb3RpZnlTZXJ2aWNlLFxyXG4gICAgcHJpdmF0ZSBjb25maWdTZXJ2aWNlOiBDb25maWdTZXJ2aWNlLFxyXG4gICAgcHVibGljIGh0dHA6IEh0dHBDbGllbnRcclxuICApIHtcclxuICAgIHRoaXMubG9jYWxlU2VydmljZSA9IHRoaXMuaW5qZWN0b3IuZ2V0KExvY2FsZVNlcnZpY2UpO1xyXG4gICAgdGhpcy5sb29rdXBUaXRsZSA9IHRoaXMubG9jYWxlU2VydmljZS5nZXRWYWx1ZSgnbG9va3VwQ29uZmlnLmxvb2t1cFRpdGxlJyk7XHJcbiAgICB0aGlzLm1vZGFsU3VyZSA9IHRoaXMubG9jYWxlU2VydmljZS5nZXRWYWx1ZSgnbG9va3VwQ29uZmlnLnN1cmUnKTtcclxuICAgIHRoaXMubW9kYWxDYW5jZWwgPSB0aGlzLmxvY2FsZVNlcnZpY2UuZ2V0VmFsdWUoJ2xvb2t1cENvbmZpZy5jYW5jZWwnKTtcclxuICAgIHRoaXMuc3VjY2Vzc1NhdmUgPSB0aGlzLmxvY2FsZVNlcnZpY2UuZ2V0VmFsdWUoJ2xvb2t1cENvbmZpZy5zdWNjZXNzU2F2ZScpO1xyXG4gICAgdGhpcy5oZWxwSWRFcnJvciA9IHRoaXMubG9jYWxlU2VydmljZS5nZXRWYWx1ZSgnbG9va3VwQ29uZmlnLmhlbHBJZEVycm9yJyk7XHJcbiAgICAvLyB0aGlzLmluamVjdFNlcnZpY2UoKTtcclxuICB9XHJcbiAgc2hvd0NvbmZpZyhvcHRpb24pIHtcclxuICAgIGNvbnN0IExvb2t1cENvbmZpZ0YgPSB0aGlzLmNmci5yZXNvbHZlQ29tcG9uZW50RmFjdG9yeShMb29rdXBDb25maWdDb21wb25lbnQpO1xyXG4gICAgY29uc3QgTG9va3VwQ29uZmlnUiA9IExvb2t1cENvbmZpZ0YuY3JlYXRlKHRoaXMuaW5qZWN0b3IpO1xyXG4gICAgTG9va3VwQ29uZmlnUi5pbnN0YW5jZS5jb25maWdJZCA9IG9wdGlvbi5jb25maWdJZDtcclxuICAgIGlmIChvcHRpb24uaGFzT3duUHJvcGVydHkoJ21ldGFkYXRhUGF0aCcpKSB7XHJcbiAgICAgIExvb2t1cENvbmZpZ1IuaW5zdGFuY2UubWV0YWRhdGFQYXRoID0gb3B0aW9uLm1ldGFkYXRhUGF0aDtcclxuICAgIH1cclxuICAgIGlmIChvcHRpb24uaGFzT3duUHJvcGVydHkoJ3JlYWRvbmx5JykpIHtcclxuICAgICAgTG9va3VwQ29uZmlnUi5pbnN0YW5jZS5yZWFkb25seSA9IG9wdGlvbi5yZWFkb25seTtcclxuICAgIH1cclxuICAgIC8vIGlmIChvcHRpb24uaGFzT3duUHJvcGVydHkoJ2lzRGVpc2duZXJFbnYnKSkge1xyXG4gICAgLy8gICBMb29rdXBDb25maWdSLmluc3RhbmNlLmlzRGVpc2duZXJFbnYgPSBvcHRpb24uaXNEZWlzZ25lckVudjtcclxuICAgIC8vIH1cclxuXHJcblxyXG4gICAgdGhpcy5sb29rdXBEbGcgPSB0aGlzLm1vZGFsU2VydmljZS5zaG93KExvb2t1cENvbmZpZ1IsIHtcclxuICAgICAgdGl0bGU6IHRoaXMubG9va3VwVGl0bGUsXHJcbiAgICAgIHdpZHRoOiAxMDAwLFxyXG4gICAgICBoZWlnaHQ6IDgwMCxcclxuICAgICAgYnV0dG9uczogW1xyXG4gICAgICAgIHtcclxuICAgICAgICAgIHRleHQ6IHRoaXMubW9kYWxTdXJlLCBjbHM6ICdidG4gYnRuLXByaW1hcnknLCBoYW5kbGU6IChlKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMubG9va3VwRGF0YSA9IExvb2t1cENvbmZpZ1IuaW5zdGFuY2UuZ2V0ZGF0YSgpO1xyXG4gICAgICAgICAgICBpZiAodGhpcy5sb29rdXBEYXRhLmhlbHBJZCA9PT0gJycpIHtcclxuICAgICAgICAgICAgICB0aGlzLm5vdGlmeVNlcnZpY2UuZXJyb3IodGhpcy5oZWxwSWRFcnJvcik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgbGV0IHBhcmFtcyA9IHRoaXMuY29uZmlnRGF0YUluaXQodGhpcy5sb29rdXBEYXRhKTtcclxuICAgICAgICAgICAgICB0aGlzLmNvbmZpZ1NlcnZpY2Uuc2F2ZUhlbHBDb25maWcocGFyYW1zKS5zdWJzY3JpYmUobWV0YWRhdGEgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKG1ldGFkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgIHRoaXMubG9va3VwY29uZmlnRGF0YS5uZXh0KG1ldGFkYXRhWydpZCddKTtcclxuICAgICAgICAgICAgICAgICAgdGhpcy5sb29rdXBjb25maWdEYXRhcy5uZXh0KG1ldGFkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgdGhpcy5ub3RpZnlTZXJ2aWNlLnN1Y2Nlc3ModGhpcy5zdWNjZXNzU2F2ZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB0aGlzLmxvb2t1cERsZy5jbG9zZSgpO1xyXG4gICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBlcnJvciA9PiB7XHJcbiAgICAgICAgICAgICAgICAgIGlmIChlcnJvci5tZXNzYWdlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5ub3RpZnlTZXJ2aWNlLmVycm9yKGVycm9yLm1lc3NhZ2UpO1xyXG4gICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgKVxyXG4gICAgICAgICAgICAgIC8vIHRoaXMubG9va3VwY29uZmlnRGF0YS5uZXh0KHRoaXMubG9va3VwRGF0YSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH1cclxuICAgICAgICB9LFxyXG4gICAgICAgIHtcclxuICAgICAgICAgIHRleHQ6IHRoaXMubW9kYWxDYW5jZWwsIGNsczogJ2J0biBidG4tc2Vjb25kYXJ5JywgaGFuZGxlOiAoZSkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLmxvb2t1cERsZy5jbG9zZSgpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgXSxcclxuICAgICAgc2hvd0J1dHRvbnM6IHRydWVcclxuICAgIH0pO1xyXG5cclxuICAgIC8vIHJldHVybiB0aGlzLmVsO1xyXG4gIH1cclxuICBnZXRMb29rdXBEYXRhKCkge1xyXG4gICAgcmV0dXJuIHRoaXMubG9va3VwY29uZmlnRGF0YTtcclxuICB9XHJcbiAgZ2V0TG9va1VwRGF0YXMoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5sb29rdXBjb25maWdEYXRhcztcclxuICB9XHJcblxyXG4gIGNvbmZpZ0RhdGFJbml0KGxvb2t1cERhdGEpIHtcclxuICAgIGxldCBkYXRhID0ge1xyXG4gICAgICBpZDogbG9va3VwRGF0YS5jb25maWdJZCxcclxuICAgICAgbmFtZTogbG9va3VwRGF0YS5uYW1lLFxyXG4gICAgICBjb2RlOiBsb29rdXBEYXRhLmNvZGUsXHJcbiAgICAgIGhlbHBJZDogbG9va3VwRGF0YS5oZWxwSWQsXHJcbiAgICAgIHF1ZXJ5UGFyYW06IHtcclxuICAgICAgICBmaWx0ZXI6IHtcclxuICAgICAgICAgIGlzVXNlUGFnaW5hdGlvbjogZmFsc2UsXHJcbiAgICAgICAgICBmaWx0ZXJDb25kaXRpb25zOiBsb29rdXBEYXRhLmZpbHRlclxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgdGV4dEZpZWxkOiBsb29rdXBEYXRhLnRleHRGaWVsZCxcclxuICAgICAgICBsb2FkVHJlZURhdGFUeXBlOiBsb29rdXBEYXRhLmxvYWREYXRhVHlwZVxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gZGF0YTtcclxuICB9XHJcbn1cclxuIl19
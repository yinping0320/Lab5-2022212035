/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { EventEmitter } from '@angular/core';
import { Component, ElementRef, ChangeDetectorRef, Inject, Renderer2, Injector, Input, ViewChild, forwardRef, ViewEncapsulation, Output } from '@angular/core';
import { DOCUMENT } from '@angular/common';
import { take, debounceTime, delay } from 'rxjs/operators';
import { BaseComboComponent, ComboService } from '@farris/ui-combo-list';
import { NG_VALUE_ACCESSOR } from '@angular/forms';
import { LookupUtils } from '@farris/ui-lookup';
import { TreeTableComponent } from '@farris/ui-treetable';
import { DataTableComponent } from '@farris/ui-datatable';
import { Subject } from 'rxjs';
import { IdService } from '@farris/ui-common';
/** @type {?} */
var INPUT_COMBO_VALUE_ACCESSOR = {
    provide: NG_VALUE_ACCESSOR,
    // tslint:disable-next-line: no-use-before-declare
    useExisting: forwardRef((/**
     * @return {?}
     */
    function () { return ComboLookupComponent; })),
    multi: true
};
var ComboLookupComponent = /** @class */ (function (_super) {
    tslib_1.__extends(ComboLookupComponent, _super);
    function ComboLookupComponent(el, cdr, document, render, comboService, injector) {
        var _this = _super.call(this, el, cdr, document, render, comboService, injector) || this;
        _this.el = el;
        _this.cdr = cdr;
        _this.document = document;
        _this.render = render;
        _this.comboService = comboService;
        _this.injector = injector;
        _this.panelHeight = 300;
        _this.comPosition = {
            'height.px': _this.panelHeight
        };
        _this.showHeader = true;
        _this.useTreeView = false;
        /**
         * -1: 不展开； 0: 全部展开；>0: 展开到指定级数
         */
        _this.expandLevel = -1;
        /**
         * 树表启用过滤行
         */
        _this.enableFilterRow = false;
        _this.cascade = {
            enable: false,
            up: false,
            down: false
        };
        /**
         * 树形帮助数据加载方式： default: 内置取数； loadall: 加载所有 layerload：分层加载
         */
        _this.loadTreeDataType = 'default';
        /**
         * 启用构造完整树过滤
         */
        _this.enableFullTree = true;
        _this.pageChanged = new EventEmitter();
        _this.pageSizeChanged = new EventEmitter();
        /**
         * 使用表单映射，默认 false
         */
        _this.useFormDataMapping = false;
        _this.loadFinish = false;
        _this.pageInfo = { pageSize: 20, pageIndex: 1, total: 0 };
        _this.tt$ = new Subject();
        _this.loaded$ = new Subject();
        _this._searchKeyWords = '';
        _this.loadDataType = 'all';
        _this.idSer = _this.injector.get(IdService, null);
        if (!_this.idSer) {
            _this.idSer = new IdService();
        }
        return _this;
    }
    Object.defineProperty(ComboLookupComponent.prototype, "columns", {
        get: /**
         * @return {?}
         */
        function () {
            var _this = this;
            /** @type {?} */
            var cols = this._columns !== undefined && this._columns.length > 0 ? this._columns : this.comboService.columns;
            if (this.useTreeView && cols.length > 1) {
                cols = cols.filter((/**
                 * @param {?} n
                 * @return {?}
                 */
                function (n) { return n.field === _this.textField; }));
            }
            return cols;
        },
        // 树列表默认展开层级。 -1： 不展开； 0： 全部展开； >0:  展开到指定级数；
        set: 
        // 树列表默认展开层级。 -1： 不展开； 0： 全部展开； >0:  展开到指定级数；
        /**
         * @param {?} value
         * @return {?}
         */
        function (value) {
            this._columns = value;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(ComboLookupComponent.prototype, "pagination", {
        get: /**
         * @return {?}
         */
        function () {
            if (this._pagination !== undefined) {
                return this._pagination;
            }
            else {
                return this.comboService.pageInfo && this.pageInfo.enablePager ? this.pageInfo.enablePager : false;
            }
        },
        set: /**
         * @param {?} value
         * @return {?}
         */
        function (value) {
            this._pagination = value;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(ComboLookupComponent.prototype, "displayType", {
        get: /**
         * @return {?}
         */
        function () {
            return this.comboService.displayType;
        },
        set: /**
         * @param {?} val
         * @return {?}
         */
        function (val) {
            this.comboService.displayType = val + '';
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(ComboLookupComponent.prototype, "treeCmpRef", {
        get: /**
         * @return {?}
         */
        function () {
            return this._treeCmpRef;
        },
        set: /**
         * @param {?} cmf
         * @return {?}
         */
        function (cmf) {
            if (cmf) {
                cmf.cascadeCheck = this.cascade.enable;
                cmf.cascadeDown = this.cascade.down;
                cmf.cascadeUp = this.cascade.up;
                this.tt$.next(cmf);
            }
            this._treeCmpRef = cmf;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(ComboLookupComponent.prototype, "tableCmpRef", {
        set: /**
         * @param {?} cmf
         * @return {?}
         */
        function (cmf) {
            var _this = this;
            if (cmf && this.pagination) {
                this.loaded$.pipe(take(1)).subscribe((/**
                 * @param {?} e
                 * @return {?}
                 */
                function (e) {
                    // console.log(this._tableCmpRef, cmf);
                    cmf.loadData({
                        pageSize: _this.pageInfo.pageSize,
                        total: _this.pageInfo.total,
                        data: _this.data,
                        pageIndex: _this.pageInfo.pageIndex
                    });
                }));
            }
            if (!this._tableCmpRef && this.loadFinish && cmf) {
                cmf.loadData({
                    pageSize: this.pageInfo.pageSize,
                    total: this.pageInfo.total,
                    data: this.data,
                    pageIndex: this.pageInfo.pageIndex
                });
            }
            this._tableCmpRef = cmf;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    ComboLookupComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        _super.prototype.ngOnInit.call(this);
        this.treeClientSearch.pipe(debounceTime(300)).subscribe((/**
         * @param {?} value
         * @return {?}
         */
        function (value) {
            if (!_this.remoteSearch && _this.treeCmpRef) {
                _this.treeCmpRef.searchHandle.search(_this.textField, value);
            }
        }));
        this.comboService.treeInfo$.subscribe((/**
         * @param {?} t
         * @return {?}
         */
        function (t) {
            if (t) {
                if (_this.loadTreeDataType === 'default') {
                    _this.loadDataType = t.loadDataType;
                }
                _this.treeInfo = Object.assign(_this.treeInfo || {}, t);
            }
        }));
    };
    /**
     * @protected
     * @param {?} selections
     * @return {?}
     */
    ComboLookupComponent.prototype.onSelectionsChange = /**
     * @protected
     * @param {?} selections
     * @return {?}
     */
    function (selections) {
        var _this = this;
        if (this.displayType === 'LOOKUPLIST') {
            if (!this.multiSelect) {
                this.ownSelections = selections[0] ? selections[0] : {};
            }
            else {
                this.ownSelections = {};
                this.comboService.selections.forEach((/**
                 * @param {?} item
                 * @return {?}
                 */
                function (item) {
                    _this.ownSelections[item[_this.idField]] = item;
                }));
            }
            this.pageInfo = tslib_1.__assign({}, this.pageInfo, this.comboService.pageInfo);
            this.loadFinish = true;
            this.cdr.detectChanges();
            this.loaded$.next(this.pageInfo);
        }
        else {
            if (this.treeCmpRef) {
                this.initTreeData();
            }
            else {
                this.tt$.pipe(take(1)).subscribe((/**
                 * @param {?} cmf
                 * @return {?}
                 */
                function (cmf) {
                    _this.treeCmpRef = cmf;
                    _this.initTreeData();
                    // cmf.checkedNodes(ids, true, false);
                    // cmf.updateSerializedValue();
                }));
            }
        }
    };
    /**
     * @private
     * @param {?} nodes
     * @param {?} expandLayer
     * @return {?}
     */
    ComboLookupComponent.prototype.setTreeNodeExpandBy = /**
     * @private
     * @param {?} nodes
     * @param {?} expandLayer
     * @return {?}
     */
    function (nodes, expandLayer) {
        var _this = this;
        if (!nodes || !nodes.length) {
            return;
        }
        nodes.forEach((/**
         * @param {?} n
         * @return {?}
         */
        function (n) {
            /** @type {?} */
            var layer = n.data[_this.treeInfo.dataField].layer;
            n.expanded = layer <= expandLayer ? true : n.expanded;
            if (n.children && n.children.length && layer + 1 <= expandLayer) {
                _this.setTreeNodeExpandBy(n.children, expandLayer);
            }
        }));
    };
    /**
     * @private
     * @return {?}
     */
    ComboLookupComponent.prototype.initTreeData = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        /** @type {?} */
        var __selections = this.comboService.selections.filter((/**
         * @param {?} n
         * @return {?}
         */
        function (n) { return n !== null && n !== undefined; }));
        /** @type {?} */
        var ids = [];
        this.ownSelections = __selections.map((/**
         * @param {?} item
         * @return {?}
         */
        function (item) {
            ids.push(item[_this.idField]);
            return { data: item, id: item[_this.idField] };
        }));
        this.treeCmpRef.selections = this.ownSelections;
        this.treeCmpRef.checkeds = this.ownSelections;
        if (this.expandLevel != -1 && this.loadDataType == 'all') {
            if (this.expandLevel > 0) {
                this.setTreeNodeExpandBy(this.treeCmpRef.data, this.expandLevel);
                this.treeCmpRef.updateSerializedValue();
            }
            else {
                this.treeCmpRef.expandAll();
            }
        }
        if (this.comboService.data && this.comboService.data.length) {
            if (this.treeCmpRef.checkValues && this.treeCmpRef.checkValues.length) {
                if (this.multiSelect) {
                    this.treeCmpRef.checkedNodes(this.treeCmpRef.checkValues);
                    this.treeCmpRef.selectNodes(this.treeCmpRef.checkValues);
                }
                else {
                    this.treeCmpRef.selectNodes(this.treeCmpRef.checkValues);
                }
            }
        }
    };
    /**
     * @private
     * @return {?}
     */
    ComboLookupComponent.prototype.isTree = /**
     * @private
     * @return {?}
     */
    function () {
        return this.displayType === 'LOOKUPTREELIST';
    };
    /**
     * @param {?=} clearMapFields
     * @return {?}
     */
    ComboLookupComponent.prototype.updateMappingFieldValue = /**
     * @param {?=} clearMapFields
     * @return {?}
     */
    function (clearMapFields) {
        var _this = this;
        if (clearMapFields === void 0) { clearMapFields = false; }
        if (this.ngControl && this.ngControl.formDirective &&
            this.ngControl.formDirective.form && this.ngControl.formDirective.form.bindingData) {
            /** @type {?} */
            var bindingData_1 = this.ngControl.formDirective.form.bindingData;
            /** @type {?} */
            var bindingPath = this.ngControl.formDirective.form.bindingPath;
            /** @type {?} */
            var pathArr_1 = [];
            if (bindingPath) {
                pathArr_1 = bindingPath.split('/').filter((/**
                 * @param {?} n
                 * @return {?}
                 */
                function (n) { return n !== ''; }));
            }
            this.mappingField = this.mappingField ? this.mappingField : {};
            if (this.mapFields) {
                /** @type {?} */
                var helpFields = Object.keys(this.mapFields);
                helpFields.forEach((/**
                 * @param {?} f
                 * @return {?}
                 */
                function (f) {
                    /** @type {?} */
                    var fieldNames = _this.mapFields[f] ? _this.mapFields[f] : '';
                    /** @type {?} */
                    var value = '';
                    if (!clearMapFields) {
                        /** @type {?} */
                        var text = _this.comboService.selections && _this.comboService.selections.map((/**
                         * @param {?} item
                         * @return {?}
                         */
                        function (item) {
                            return _this.comboService.getValueByObj(f, item);
                        })).filter((/**
                         * @param {?} n
                         * @return {?}
                         */
                        function (n) { return n !== null; })).join(_this.separator);
                        // value = text ? text : this.displayText ? this.displayText : '';
                        value = text || '';
                    }
                    if (fieldNames) {
                        fieldNames.split(',').forEach((/**
                         * @param {?} fieldName
                         * @return {?}
                         */
                        function (fieldName) {
                            /** @type {?} */
                            var _val = value;
                            if (_this.nosearch && fieldName === _this.ngControl.name) {
                                _val = _this.displayText;
                            }
                            if (bindingData_1.setValue) {
                                if (!_this.useFormDataMapping) {
                                    bindingData_1.setValue(pathArr_1.concat(fieldName.split('.')), _val, true, true);
                                }
                            }
                            else {
                                _this.commonUtils.setValue(bindingData_1, fieldName, value);
                            }
                        }));
                    }
                }));
            }
        }
    };
    /**
     * @return {?}
     */
    ComboLookupComponent.prototype.updateSelectedValues = /**
     * @return {?}
     */
    function () {
        if (this.ngControl &&
            this.ngControl.formDirective &&
            this.ngControl.formDirective.form &&
            this.ngControl.formDirective.form.bindingData) {
            /** @type {?} */
            var bindingData = this.ngControl.formDirective.form.bindingData;
            /** @type {?} */
            var bindingPath = this.ngControl.formDirective.form.bindingPath;
            /** @type {?} */
            var pathArr = [];
            if (bindingPath) {
                pathArr = bindingPath.split('/').filter((/**
                 * @param {?} n
                 * @return {?}
                 */
                function (n) { return n !== ''; }));
            }
            /** @type {?} */
            var targetField = this.mappingField ? this.mapFields[this.idField] : '';
            if (targetField && targetField.indexOf(',') > -1) {
                targetField = targetField.split(',')[0];
            }
            // this.mappingField = this.mappingField ? this.mappingField : '';
            if (targetField && bindingData.getValue) {
                this.selectedValues = bindingData.getValue(pathArr.concat(targetField.split('.'))) || '';
            }
            else if (targetField) {
                this.selectedValues = this.commonUtils.getValue(targetField, bindingData) || '';
            }
            else {
                // 兼容为设置idField 字段映射的情况，此情况使用 valueField
                targetField = this.mappingField ? this.mapFields[this.textField] : '';
                if (targetField && bindingData.getValue) {
                    this.comboService['__SELECTEDIDS__'] = this.comboService.getValue(this.idField);
                    this.selectedValues = bindingData.getValue(pathArr.concat(targetField.split('.'))) || '';
                }
            }
        }
        else {
            // UI state binding
            if (this.el.nativeElement['__zone_symbol__UIStateBindingChangefalse']) {
                // this.selectedValues = this.comboService.getValue(this.textField);
                this.selectedValues = this.displayText;
            }
        }
    };
    /**
     * @param {?} row
     * @return {?}
     */
    ComboLookupComponent.prototype.onSelectRows = /**
     * @param {?} row
     * @return {?}
     */
    function (row) {
        if (this.displayType === 'LOOKUPLIST') {
            var data = row.data, index = row.index;
            this.comboService.selectItem(data, index);
            this.selectChange.emit({ data: data, index: index, instance: this }); // UI-STATE-BINDING 中使用
        }
        else if (this.displayType === 'LOOKUPTREELIST') {
            var node = row.node;
            if (row.nodes) {
                this.comboService.selectItem(row.nodes.map((/**
                 * @param {?} n
                 * @return {?}
                 */
                function (n) { return n.data; })));
            }
            else {
                this.comboService.selectItem(node.data);
            }
            this.selectChange.emit(node);
        }
        this.updateTextAndValues();
        if (!this.multiSelect) {
            this.comboService.isOpen$.next(false);
        }
    };
    /**
     * @param {?} row
     * @return {?}
     */
    ComboLookupComponent.prototype.onUnSelectRows = /**
     * @param {?} row
     * @return {?}
     */
    function (row) {
        if (this.displayType === 'LOOKUPLIST') {
            var data = row.data;
            this.comboService.unSelectItem(data);
        }
        else if (this.displayType === 'LOOKUPTREELIST') {
            var node = row.node;
            this.comboService.unSelectItem(node.data);
            this.selectChange.emit(node);
        }
        this.updateTextAndValues();
    };
    /**
     * @param {?} ev
     * @return {?}
     */
    ComboLookupComponent.prototype.onCheckAll = /**
     * @param {?} ev
     * @return {?}
     */
    function (ev) {
        /** @type {?} */
        var state;
        /** @type {?} */
        var selections = [];
        if (this.displayType === 'LOOKUPTREELIST') {
            state = ev.checked;
            selections = this.treeCmpRef.state.rowNodes
                .filter((/**
             * @param {?} n
             * @return {?}
             */
            function (n) { return n.node.selectable === undefined || n.node.selectable; }))
                .map((/**
             * @param {?} r
             * @return {?}
             */
            function (r) { return r.node.data; }));
        }
        else {
            state = ev;
            selections = this.data;
        }
        if (state) {
            this.comboService.selectAll(selections);
        }
        else {
            this.comboService.unSelectAll(selections);
        }
        this.updateTextAndValues();
    };
    /**
     * @private
     * @return {?}
     */
    ComboLookupComponent.prototype.updateTextAndValues = /**
     * @private
     * @return {?}
     */
    function () {
        this.comboService['__SELECTEDIDS__'] = this.comboService.getValue(this.idField);
        this.selectedValues = this.comboService['__SELECTEDIDS__'];
        if (!this.multiSelect) {
            this.updateSelectedValues();
        }
        /** @type {?} */
        var _displayText = this.comboService.getValue(this.textField);
        this.onValueChange({ text: _displayText, value: this.comboService['__SELECTEDIDS__'], selections: this.selections });
    };
    /**
     * @param {?} $event
     * @return {?}
     */
    ComboLookupComponent.prototype.onKeyup = /**
     * @param {?} $event
     * @return {?}
     */
    function ($event) {
        // console.log('key up', $event);
    };
    /**
     * @param {?} $event
     * @return {?}
     */
    ComboLookupComponent.prototype.onKeydown = /**
     * @param {?} $event
     * @return {?}
     */
    function ($event) {
        // console.log('key down', $event);
        if ($event.key === 'Tab') {
            this.hide(false);
        }
        if ($event.key === 'Enter') {
            $event.stopPropagation();
            if (this._searchKeyWords && !this.multiSelect) {
                if (this.displayType === 'LOOKUPLIST') {
                    this.onSelectRows({ data: this._tableCmpRef.selections });
                }
                else if (this.displayType === 'LOOKUPTREELIST') {
                    // this.treeCmpRef.selectNode()
                }
            }
        }
    };
    /**
     * @param {?} event
     * @return {?}
     */
    ComboLookupComponent.prototype.onPageChanged = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        var _this = this;
        if (this.uri) {
            this.getData(event).subscribe((/**
             * @param {?} data
             * @return {?}
             */
            function (data) { return _this.comboService.loadLookUpDataTable(data, !!event.sortName); }));
        }
        else {
            this.pageChanged.emit(event);
        }
    };
    /**
     * @param {?} event
     * @return {?}
     */
    ComboLookupComponent.prototype.onPageSizeChanged = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        var _this = this;
        if (this.uri) {
            this.getData(event).subscribe((/**
             * @param {?} data
             * @return {?}
             */
            function (data) { return _this.comboService.loadLookUpDataTable(data, !!event.sortName); }));
        }
        else {
            this.pageSizeChanged.emit(event);
        }
    };
    /**
     * @param {?} event
     * @return {?}
     */
    ComboLookupComponent.prototype.onColumnSorted = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        var _this = this;
        var _a = tslib_1.__assign({}, event), sortName = _a.sortName, sortOrder = _a.sortOrder;
        this.getData({ sortName: sortName, sortOrder: sortOrder }, 'search').subscribe((/**
         * @param {?} data
         * @return {?}
         */
        function (data) {
            _this.comboService.loadLookUpDataTable(data, true);
        }));
    };
    /**
     * @return {?}
     */
    ComboLookupComponent.prototype.onClear = /**
     * @return {?}
     */
    function () {
        this.ownSelections = [];
        if (this.isTree() && this.treeCmpRef) {
            this.treeCmpRef.clearAll();
        }
        _super.prototype.onClear.call(this);
    };
    /**
     * @private
     * @param {?} parentPath
     * @param {?} parentLayer
     * @param {?} searchData
     * @return {?}
     */
    ComboLookupComponent.prototype.getChildren = /**
     * @private
     * @param {?} parentPath
     * @param {?} parentLayer
     * @param {?} searchData
     * @return {?}
     */
    function (parentPath, parentLayer, searchData) {
        /** @type {?} */
        var search = tslib_1.__assign({ parentLayer: parentLayer, category: 'children' }, searchData);
        if (this.treeInfo.layerType === 'parentId') {
            search['parentId'] = parentPath;
        }
        else {
            search['parentPath'] = parentPath;
        }
        /** @type {?} */
        var param = {
            searchValue: JSON.stringify(search),
            customData: this.customData,
            enableFullTree: this.enableFullTree,
            loadTreeDataType: this.loadTreeDataType
        };
        if (this._searchKeyWords) {
            param.enableFullTree = false;
            param.loadTreeDataType = 'layerload';
            if (this.treeInfo.layerType === 'parentId') {
                // 树形帮助查询后，展开节点时将相关查询参数传递到后端 2022-09-13
                search.searchValue = '';
                search.searchField = '*';
            }
            param.searchValue = JSON.stringify(search);
        }
        /** @type {?} */
        var tt = (/** @type {?} */ (this.treeCmpRef));
        if (tt && tt.sortName) {
            Object.assign(param, {
                sortName: tt.sortName,
                sortOrder: tt.sortOrder
            });
        }
        return this.comboService.getData(param, 'get', true);
    };
    /**
     * @param {?=} event
     * @param {?=} type
     * @return {?}
     */
    ComboLookupComponent.prototype.getData = /**
     * @param {?=} event
     * @param {?=} type
     * @return {?}
     */
    function (event, type) {
        if (type === void 0) { type = 'all'; }
        event = event || {};
        if (this._searchKeyWords) {
            event.search = {
                field: '*',
                value: this._searchKeyWords
            };
        }
        /** @type {?} */
        var params = this.buildQueryParams(event, type);
        return this.comboService.getData(params);
    };
    /** 构选查询参数 */
    /**
     * 构选查询参数
     * @private
     * @param {?=} event
     * @param {?=} type
     * @return {?}
     */
    ComboLookupComponent.prototype.buildQueryParams = /**
     * 构选查询参数
     * @private
     * @param {?=} event
     * @param {?=} type
     * @return {?}
     */
    function (event, type) {
        if (type === void 0) { type = 'all'; }
        /** @type {?} */
        var params = {};
        /** @type {?} */
        var searchParam = { category: type };
        if (event) {
            if (event.pageInfo) {
                params['pageIndex'] = event.pageInfo.pageIndex;
                params['pageSize'] = event.pageInfo.pageSize;
            }
            if (event.search) {
                searchParam['searchField'] = event.search.field;
                searchParam['searchValue'] = event.search.value;
            }
            if (event.sortName) {
                searchParam['sortName'] = event.sortName;
            }
            if (event.sortOrder) {
                searchParam['sortOrder'] = event.sortOrder;
            }
        }
        params['searchValue'] = JSON.stringify(searchParam);
        if (this.customData) {
            params['customData'] = this.customData;
        }
        return params;
    };
    /**
     * @param {?} value
     * @param {?} field
     * @return {?}
     */
    ComboLookupComponent.prototype.filterDataOnServer = /**
     * @param {?} value
     * @param {?} field
     * @return {?}
     */
    function (value, field) {
        /** @type {?} */
        var search = { search: { field: field, value: value } };
        if (value) {
            this._searchKeyWords = value;
        }
        else {
            this._searchKeyWords = '';
            search = null;
        }
        /** @type {?} */
        var params = this.buildQueryParams(search, 'search');
        if (!this.isOpen) {
            if (this.nosearch) {
                return;
            }
            this.isOpen = true;
            this.comboService.isOpen$.next({ isOpen: this.isOpen, search: params });
            return;
        }
        this.comboService.serachValue$.next(params);
    };
    /**
     * @param {?} tn
     * @return {?}
     */
    ComboLookupComponent.prototype.onExpandNode = /**
     * @param {?} tn
     * @return {?}
     */
    function (tn) {
        var _this = this;
        if (tn.leaf || tn['showLoading']) {
            return;
        }
        if (!tn.children || !tn.children.length) {
            /** @type {?} */
            var parentPath = '';
            /** @type {?} */
            var parentLayer = -1;
            var _a = {
                value: this._searchKeyWords
            }, _b = _a.field, field = _b === void 0 ? '*' : _b, _c = _a.value, value = _c === void 0 ? '' : _c;
            /** @type {?} */
            var treeInfoField = this.treeInfo.dataField;
            if (this.treeInfo.layerType === 'parentId') {
                // 父ID加载方式
                parentPath = tn['id'];
                parentLayer = tn.data[treeInfoField][this.treeInfo.layerField];
            }
            else {
                if (treeInfoField) {
                    parentPath = tn.data[treeInfoField][this.treeInfo.pathField];
                    parentLayer = tn.data[treeInfoField][this.treeInfo.layerField];
                }
                else {
                    this.treeCmpRef.writeConsole('未找到分级信息。');
                }
            }
            this.getChildren(parentPath, parentLayer, {
                searchField: field === '*' ? '*' : field,
                searchValue: value
            }).subscribe((/**
             * @param {?} data
             * @return {?}
             */
            function (data) {
                if (tn && data.items && data.items.length) {
                    /** @type {?} */
                    var nodes = _this.comboService.checkNodeCanBeSelect(data.items, false);
                    _this.treeCmpRef.appendChildren(nodes, tn);
                }
                _this.treeCmpRef.detectChanges();
                // if (this.selectedValues && this.selectedValues.length) {
                //     this.treeCmpRef.checkedNodes(this.selectedValues.split(','));
                // }
                /** @type {?} */
                var ids = _this.comboService['__SELECTEDIDS__'];
                if (ids && ids.length) {
                    /** @type {?} */
                    var idArr = ids.split(_this.separator);
                    if (_this.multiSelect) {
                        _this.treeCmpRef.checkedNodes(idArr);
                    }
                    _this.treeCmpRef.selectNodes(idArr);
                }
                _this.treeCmpRef.psRef.directiveRef.update();
            }));
        }
    };
    /**
     * @protected
     * @return {?}
     */
    ComboLookupComponent.prototype.initDatasChangeAction = /**
     * @protected
     * @return {?}
     */
    function () {
        var _this = this;
        this.comboService.data$.pipe(delay(120)).subscribe((/**
         * @param {?} data
         * @return {?}
         */
        function (data) {
            // 帮助数据异步自定义取数；
            // 帮助配置界面
            if (!_this.uri && data && data.length) {
                _this.updateSelections(_this.selectedValues, data);
                // TFS 574365
                /** @type {?} */
                var txt = _this.comboService.getValue(_this.textField);
                txt = txt ? txt : _this.nosearch ? _this.displayText : '';
                _this.displayText = txt;
                _this['originalText'] = _this.displayText;
            }
            if (_this._searchKeyWords && data && data.length && !_this.multiSelect) {
                if (_this.displayType === 'LOOKUPLIST') {
                    _this._tableCmpRef.selections = data[0];
                    _this._tableCmpRef.cd.detectChanges();
                }
                else if (_this.displayType === 'LOOKUPTREELIST') {
                    // this.treeCmpRef.selectNode()
                    /** @type {?} */
                    var nodes = _this.comboService.checkNodeCanBeSelect(data.items, false);
                }
            }
        }));
    };
    ComboLookupComponent.decorators = [
        { type: Component, args: [{
                    // tslint:disable-next-line: component-selector
                    selector: 'farris-combo-lookup',
                    template: "<input-group\r\n    #input\r\n    [attr.title]=\"enableTitle ? displayText : ''\"\r\n    [class.actived]=\"isOpen\"\r\n    [(value)]=\"displayText\"\r\n    [forcePlaceholder]=\"forcePlaceholder\"\r\n    [disabled]=\"disabled\"\r\n    [readonly]=\"readonly\"\r\n    [editable]=\"editable\"\r\n    [groupText]=\"groupIcon\"\r\n    [placeholder]=\"placeholder\"\r\n    [enableClear]=\"enableClear\"\r\n    (clickHandle)=\"onClick()\"\r\n    (inputClick)=\"onInputclick($event)\"\r\n    (blurHandle)=\"onBlur($event)\"\r\n    (focusHandle)=\"onFocus($event)\"\r\n    (valueChange)=\"onTextChange($event)\"\r\n    (clear)=\"onClear()\"\r\n    (keyupHandle)=\"onKeyup($event)\"\r\n    (keydownHandle)=\"onKeydown($event)\"\r\n    [maxLength]=\"maxLength\" \r\n    style=\"display: block;\"\r\n>\r\n</input-group>\r\n<div class=\"comboPanel f-area-hide\" *ngIf=\"isOpen\"  #comboPanel style=\"overflow: hidden; height: 100%; width: 100%\" >\r\n    <farris-datatable\r\n        *ngIf=\"displayType === 'LOOKUPLIST'\"\r\n        #dt\r\n        [width]=\"panelWidth\"\r\n        [height]=\"panelHeight\"\r\n        [columns]=\"columns\"\r\n        [data]=\"comboService.data$ | async\"\r\n        [selections]=\"ownSelections\"\r\n        [idField]=\"idField\"\r\n        [singleSelect]=\"!multiSelect\"\r\n        [pagination] = \"pagination\"\r\n        [pageSize]=\"pageInfo.pageSize\"\r\n        [pageIndex]=\"pageInfo.pageIndex\"\r\n        [pageList]=\"pageInfo.pageList\"\r\n        [total]=\"pageInfo.total\"\r\n        [pagerViewMode]=\"'simple'\"\r\n        [showPageInfo]=\"false\" \r\n        [showPageNumber]=\"false\" \r\n        [showPageList]=\"false\"\r\n        [remoteSort]=\"false\"\r\n        [showHeader]=\"showHeader\"\r\n        (selectRows)=\"onSelectRows($event)\"\r\n        (unSelectRow)=\"onUnSelectRows($event)\"\r\n        (checkAll)=\"onCheckAll($event)\"\r\n        (pageChanged)=\"onPageChanged($event)\"\r\n        (pageSizeChanged)=\"onPageSizeChanged($event)\"\r\n        (columnSorted)=\"onColumnSorted($event)\"\r\n    ></farris-datatable>\r\n\r\n    <farris-treetable #tt\r\n        *ngIf=\"displayType === 'LOOKUPTREELIST'\"\r\n        [showHeader]=\"!useTreeView && showHeader\"\r\n        [showBorder]=\"!useTreeView\" \r\n        [showHeader]=\"!useTreeView\"\r\n        [expandLevel]=\"expandLevel\"\r\n        [virtualized]=\"true\"\r\n        [enableFilterRow]=\"enableFilterRow\"\r\n        [columns]=\"columns\"\r\n        [singleSelect]=\"!multiSelect\"\r\n        [idField]=\"idField\"\r\n        [data]=\"comboService.data$ | async\"\r\n        [checkOnSelect]=\"true\"\r\n        [selectOnCheck]=\"true\"\r\n        [fixedHeader]=\"true\"\r\n        [showCheckbox]=\"multiSelect\"\r\n        [fit]=\"true\"\r\n        [remoteSort]=\"false\"\r\n        [loadDataType]=\"loadDataType\"\r\n        (nodeSelected)=\"onSelectRows($event)\"\r\n        (nodeUnSelect)=\"onUnSelectRows($event)\"\r\n        (nodeChecked)=\"onSelectRows($event)\"\r\n        (nodeUnChecked)=\"onUnSelectRows($event)\"\r\n        (checkAll)=\"onCheckAll($event)\"\r\n        (unCheckAll)=\"onCheckAll($event)\"\r\n        (expand)=\"onExpandNode($event)\"\r\n        \r\n    ></farris-treetable>\r\n</div>\r\n<!--\r\n    [width]=\"panelWidth\"\r\n    [height]=\"panelHeight\"\r\n     -->",
                    encapsulation: ViewEncapsulation.None,
                    // styleUrls: ['./combo-lookup.component.scss'],
                    providers: [INPUT_COMBO_VALUE_ACCESSOR, ComboService, LookupUtils]
                }] }
    ];
    /** @nocollapse */
    ComboLookupComponent.ctorParameters = function () { return [
        { type: ElementRef },
        { type: ChangeDetectorRef },
        { type: undefined, decorators: [{ type: Inject, args: [DOCUMENT,] }] },
        { type: Renderer2 },
        { type: ComboService },
        { type: Injector }
    ]; };
    ComboLookupComponent.propDecorators = {
        showHeader: [{ type: Input }],
        useTreeView: [{ type: Input }],
        columns: [{ type: Input }],
        pagination: [{ type: Input }],
        displayType: [{ type: Input }],
        expandLevel: [{ type: Input }],
        enableFilterRow: [{ type: Input }],
        treeCmpRef: [{ type: ViewChild, args: ['tt',] }],
        tableCmpRef: [{ type: ViewChild, args: ['dt',] }],
        cascade: [{ type: Input }],
        treeInfo: [{ type: Input }],
        loadTreeDataType: [{ type: Input }],
        enableFullTree: [{ type: Input }],
        pageChanged: [{ type: Output }],
        pageSizeChanged: [{ type: Output }],
        useFormDataMapping: [{ type: Input }]
    };
    return ComboLookupComponent;
}(BaseComboComponent));
export { ComboLookupComponent };
if (false) {
    /** @type {?} */
    ComboLookupComponent.prototype.panelHeight;
    /** @type {?} */
    ComboLookupComponent.prototype.comPosition;
    /** @type {?} */
    ComboLookupComponent.prototype.showHeader;
    /** @type {?} */
    ComboLookupComponent.prototype.useTreeView;
    /**
     * -1: 不展开； 0: 全部展开；>0: 展开到指定级数
     * @type {?}
     */
    ComboLookupComponent.prototype.expandLevel;
    /**
     * 树表启用过滤行
     * @type {?}
     */
    ComboLookupComponent.prototype.enableFilterRow;
    /** @type {?} */
    ComboLookupComponent.prototype.cascade;
    /** @type {?} */
    ComboLookupComponent.prototype.treeInfo;
    /**
     * 树形帮助数据加载方式： default: 内置取数； loadall: 加载所有 layerload：分层加载
     * @type {?}
     */
    ComboLookupComponent.prototype.loadTreeDataType;
    /**
     * 启用构造完整树过滤
     * @type {?}
     */
    ComboLookupComponent.prototype.enableFullTree;
    /** @type {?} */
    ComboLookupComponent.prototype.pageChanged;
    /** @type {?} */
    ComboLookupComponent.prototype.pageSizeChanged;
    /**
     * 使用表单映射，默认 false
     * @type {?}
     */
    ComboLookupComponent.prototype.useFormDataMapping;
    /** @type {?} */
    ComboLookupComponent.prototype.ownSelections;
    /** @type {?} */
    ComboLookupComponent.prototype.loadFinish;
    /** @type {?} */
    ComboLookupComponent.prototype.pageInfo;
    /**
     * @type {?}
     * @private
     */
    ComboLookupComponent.prototype.tt$;
    /**
     * @type {?}
     * @private
     */
    ComboLookupComponent.prototype.loaded$;
    /**
     * @type {?}
     * @private
     */
    ComboLookupComponent.prototype._columns;
    /**
     * @type {?}
     * @private
     */
    ComboLookupComponent.prototype._pagination;
    /**
     * @type {?}
     * @private
     */
    ComboLookupComponent.prototype._tableCmpRef;
    /**
     * @type {?}
     * @private
     */
    ComboLookupComponent.prototype._treeCmpRef;
    /**
     * @type {?}
     * @private
     */
    ComboLookupComponent.prototype._searchKeyWords;
    /** @type {?} */
    ComboLookupComponent.prototype.loadDataType;
    /**
     * @type {?}
     * @private
     */
    ComboLookupComponent.prototype.idSer;
    /** @type {?} */
    ComboLookupComponent.prototype.el;
    /** @type {?} */
    ComboLookupComponent.prototype.cdr;
    /** @type {?} */
    ComboLookupComponent.prototype.document;
    /** @type {?} */
    ComboLookupComponent.prototype.render;
    /** @type {?} */
    ComboLookupComponent.prototype.comboService;
    /** @type {?} */
    ComboLookupComponent.prototype.injector;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29tYm8tbG9va3VwLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvdWktY29tYm8tbG9va3VwLyIsInNvdXJjZXMiOlsibGliL2NvbWJvLWxvb2t1cC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzdDLE9BQU8sRUFDSCxTQUFTLEVBQVUsVUFBVSxFQUFFLGlCQUFpQixFQUFFLE1BQU0sRUFBRSxTQUFTLEVBQ25FLFFBQVEsRUFBRSxLQUFLLEVBQUUsU0FBUyxFQUFFLFVBQVUsRUFBRSxpQkFBaUIsRUFBb0IsTUFBTSxFQUN0RixNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFDM0MsT0FBTyxFQUFRLElBQUksRUFBMEIsWUFBWSxFQUFFLEtBQUssRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ3pGLE9BQU8sRUFBRSxrQkFBa0IsRUFBRSxZQUFZLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQUN6RSxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUNuRCxPQUFPLEVBQUUsV0FBVyxFQUFZLE1BQU0sbUJBQW1CLENBQUM7QUFDMUQsT0FBTyxFQUFZLGtCQUFrQixFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFDcEUsT0FBTyxFQUFFLGtCQUFrQixFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFDMUQsT0FBTyxFQUFFLE9BQU8sRUFBMkIsTUFBTSxNQUFNLENBQUM7QUFDeEQsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLG1CQUFtQixDQUFDOztJQUV4QywwQkFBMEIsR0FBUTtJQUNwQyxPQUFPLEVBQUUsaUJBQWlCOztJQUUxQixXQUFXLEVBQUUsVUFBVTs7O0lBQUMsY0FBTSxPQUFBLG9CQUFvQixFQUFwQixDQUFvQixFQUFDO0lBQ25ELEtBQUssRUFBRSxJ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b250ZW50IjpbImltcG9ydCB7IEV2ZW50RW1pdHRlciB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQge1xyXG4gICAgQ29tcG9uZW50LCBPbkluaXQsIEVsZW1lbnRSZWYsIENoYW5nZURldGVjdG9yUmVmLCBJbmplY3QsIFJlbmRlcmVyMixcclxuICAgIEluamVjdG9yLCBJbnB1dCwgVmlld0NoaWxkLCBmb3J3YXJkUmVmLCBWaWV3RW5jYXBzdWxhdGlvbiwgQWZ0ZXJWaWV3Q2hlY2tlZCwgT3V0cHV0XHJcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IERPQ1VNRU5UIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uJztcclxuaW1wb3J0IHsgc2tpcCwgdGFrZSwgZmlsdGVyLCB0YWtlVW50aWwsIG1hcCwgZGVib3VuY2VUaW1lLCBkZWxheSB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcclxuaW1wb3J0IHsgQmFzZUNvbWJvQ29tcG9uZW50LCBDb21ib1NlcnZpY2UgfSBmcm9tICdAZmFycmlzL3VpLWNvbWJvLWxpc3QnO1xyXG5pbXBvcnQgeyBOR19WQUxVRV9BQ0NFU1NPUiB9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcclxuaW1wb3J0IHsgTG9va3VwVXRpbHMsIFRyZWVJbmZvIH0gZnJvbSAnQGZhcnJpcy91aS1sb29rdXAnO1xyXG5pbXBvcnQgeyBUcmVlTm9kZSwgVHJlZVRhYmxlQ29tcG9uZW50IH0gZnJvbSAnQGZhcnJpcy91aS10cmVldGFibGUnO1xyXG5pbXBvcnQgeyBEYXRhVGFibGVDb21wb25lbnQgfSBmcm9tICdAZmFycmlzL3VpLWRhdGF0YWJsZSc7XHJcbmltcG9ydCB7IFN1YmplY3QsIGZvcmtKb2luLCBpbnRlcnZhbCwgemlwIH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7IElkU2VydmljZSB9IGZyb20gJ0BmYXJyaXMvdWktY29tbW9uJztcclxuXHJcbmNvbnN0IElOUFVUX0NPTUJPX1ZBTFVFX0FDQ0VTU09SOiBhbnkgPSB7XHJcbiAgICBwcm92aWRlOiBOR19WQUxVRV9BQ0NFU1NPUixcclxuICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTogbm8tdXNlLWJlZm9yZS1kZWNsYXJlXHJcbiAgICB1c2VFeGlzdGluZzogZm9yd2FyZFJlZigoKSA9PiBDb21ib0xvb2t1cENvbXBvbmVudCksXHJcbiAgICBtdWx0aTogdHJ1ZVxyXG59O1xyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6IGNvbXBvbmVudC1zZWxlY3RvclxyXG4gICAgc2VsZWN0b3I6ICdmYXJyaXMtY29tYm8tbG9va3VwJyxcclxuICAgIHRlbXBsYXRlVXJsOiAnLi9jb21iby1sb29rdXAuY29tcG9uZW50Lmh0bWwnLFxyXG4gICAgZW5jYXBzdWxhdGlvbjogVmlld0VuY2Fwc3VsYXRpb24uTm9uZSxcclxuICAgIC8vIHN0eWxlVXJsczogWycuL2NvbWJvLWxvb2t1cC5jb21wb25lbnQuc2NzcyddLFxyXG4gICAgcHJvdmlkZXJzOiBbSU5QVVRfQ09NQk9fVkFMVUVfQUNDRVNTT1IsIENvbWJvU2VydmljZSwgTG9va3VwVXRpbHNdXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBDb21ib0xvb2t1cENvbXBvbmVudCBleHRlbmRzIEJhc2VDb21ib0NvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCB7XHJcbiAgICBwYW5lbEhlaWdodCA9IDMwMDtcclxuXHJcbiAgICBjb21Qb3NpdGlvbiA9IHtcclxuICAgICAgICAnaGVpZ2h0LnB4JzogdGhpcy5wYW5lbEhlaWdodFxyXG4gICAgfTtcclxuXHJcbiAgICBASW5wdXQoKSBzaG93SGVhZGVyID0gdHJ1ZTtcclxuXHJcbiAgICBASW5wdXQoKSB1c2VUcmVlVmlldyA9IGZhbHNlO1xyXG4gICAgLy8g5qCR5YiX6KGo6buY6K6k5bGV5byA5bGC57qn44CCIC0x77yaIOS4jeWxleW8gO+8myAw77yaIOWFqOmDqOWxleW8gO+8myA+MDogIOWxleW8gOWIsOaMh+Wumue6p+aVsO+8m1xyXG4gICAgQElucHV0KClcclxuICAgIHNldCBjb2x1bW5zKHZhbHVlOiBhbnlbXSkge1xyXG4gICAgICAgIHRoaXMuX2NvbHVtbnMgPSB2YWx1ZTtcclxuICAgIH1cclxuICAgIGdldCBjb2x1bW5zKCk6IGFueVtdIHtcclxuICAgICAgICBsZXQgY29scyA9IHRoaXMuX2NvbHVtbnMgIT09IHVuZGVmaW5lZCAmJiB0aGlzLl9jb2x1bW5zLmxlbmd0aCA+IDAgPyB0aGlzLl9jb2x1bW5zIDogdGhpcy5jb21ib1NlcnZpY2UuY29sdW1ucztcclxuICAgICAgICBpZiAodGhpcy51c2VUcmVlVmlldyAmJiBjb2xzLmxlbmd0aCA+IDEpIHtcclxuICAgICAgICAgICAgY29scyA9IGNvbHMuZmlsdGVyKG4gPT4gbi5maWVsZCA9PT0gdGhpcy50ZXh0RmllbGQpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gY29scztcclxuICAgIH1cclxuICAgIEBJbnB1dCgpXHJcbiAgICBzZXQgcGFnaW5hdGlvbih2YWx1ZTogYm9vbGVhbikge1xyXG4gICAgICAgIHRoaXMuX3BhZ2luYXRpb24gPSB2YWx1ZTtcclxuICAgIH1cclxuICAgIGdldCBwYWdpbmF0aW9uKCkge1xyXG4gICAgICAgIGlmICh0aGlzLl9wYWdpbmF0aW9uICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3BhZ2luYXRpb247XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuY29tYm9TZXJ2aWNlLnBhZ2VJbmZvICYmIHRoaXMucGFnZUluZm8uZW5hYmxlUGFnZXIgPyB0aGlzLnBhZ2VJbmZvLmVuYWJsZVBhZ2VyIDogZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgQElucHV0KClcclxuICAgIHNldCBkaXNwbGF5VHlwZSh2YWw6IHN0cmluZykge1xyXG4gICAgICAgIHRoaXMuY29tYm9TZXJ2aWNlLmRpc3BsYXlUeXBlID0gdmFsICsgJyc7XHJcbiAgICB9XHJcbiAgICBnZXQgZGlzcGxheVR5cGUoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY29tYm9TZXJ2aWNlLmRpc3BsYXlUeXBlO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKiAtMTog5LiN5bGV5byA77ybIDA6IOWFqOmDqOWxleW8gO+8mz4wOiDlsZXlvIDliLDmjIflrprnuqfmlbAgKi9cclxuICAgIEBJbnB1dCgpIGV4cGFuZExldmVsID0gLTE7XHJcblxyXG4gICAgLyoqIOagkeihqOWQr+eUqOi/h+a7pOihjCAqL1xyXG4gICAgQElucHV0KCkgZW5hYmxlRmlsdGVyUm93ID0gZmFsc2U7XHJcblxyXG4gICAgQFZpZXdDaGlsZCgndHQnKVxyXG4gICAgc2V0IHRyZWVDbXBSZWYoY21mOiBUcmVlVGFibGVDb21wb25lbnQpIHtcclxuICAgICAgICBpZiAoY21mKSB7XHJcbiAgICAgICAgICAgIGNtZi5jYXNjYWRlQ2hlY2sgPSB0aGlzLmNhc2NhZGUuZW5hYmxlO1xyXG4gICAgICAgICAgICBjbWYuY2FzY2FkZURvd24gPSB0aGlzLmNhc2NhZGUuZG93bjtcclxuICAgICAgICAgICAgY21mLmNhc2NhZGVVcCA9IHRoaXMuY2FzY2FkZS51cDtcclxuXHJcbiAgICAgICAgICAgIHRoaXMudHQkLm5leHQoY21mKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5fdHJlZUNtcFJlZiA9IGNtZjtcclxuICAgIH1cclxuICAgIGdldCB0cmVlQ21wUmVmKCk6IFRyZWVUYWJsZUNvbXBvbmVudCB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3RyZWVDbXBSZWY7XHJcbiAgICB9XHJcbiAgICBAVmlld0NoaWxkKCdkdCcpXHJcbiAgICBzZXQgdGFibGVDbXBSZWYoY21mOiBEYXRhVGFibGVDb21wb25lbnQpIHtcclxuICAgICAgICBpZiAoY21mICYmIHRoaXMucGFnaW5hdGlvbikge1xyXG4gICAgICAgICAgICB0aGlzLmxvYWRlZCQucGlwZSh0YWtlKDEpKS5zdWJzY3JpYmUoZSA9PiB7XHJcbiAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZyh0aGlzLl90YWJsZUNtcFJlZiwgY21mKTtcclxuICAgICAgICAgICAgICAgIGNtZi5sb2FkRGF0YSh7XHJcbiAgICAgICAgICAgICAgICAgICAgcGFnZVNpemU6IHRoaXMucGFnZUluZm8ucGFnZVNpemUsXHJcbiAgICAgICAgICAgICAgICAgICAgdG90YWw6IHRoaXMucGFnZUluZm8udG90YWwsXHJcbiAgICAgICAgICAgICAgICAgICAgZGF0YTogdGhpcy5kYXRhLFxyXG4gICAgICAgICAgICAgICAgICAgIHBhZ2VJbmRleDogdGhpcy5wYWdlSW5mby5wYWdlSW5kZXhcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKCF0aGlzLl90YWJsZUNtcFJlZiAmJiB0aGlzLmxvYWRGaW5pc2ggJiYgY21mKSB7XHJcbiAgICAgICAgICAgIGNtZi5sb2FkRGF0YSh7XHJcbiAgICAgICAgICAgICAgICBwYWdlU2l6ZTogdGhpcy5wYWdlSW5mby5wYWdlU2l6ZSxcclxuICAgICAgICAgICAgICAgIHRvdGFsOiB0aGlzLnBhZ2VJbmZvLnRvdGFsLFxyXG4gICAgICAgICAgICAgICAgZGF0YTogdGhpcy5kYXRhLFxyXG4gICAgICAgICAgICAgICAgcGFnZUluZGV4OiB0aGlzLnBhZ2VJbmZvLnBhZ2VJbmRleFxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5fdGFibGVDbXBSZWYgPSBjbWY7XHJcbiAgICB9XHJcblxyXG4gICAgQElucHV0KCkgY2FzY2FkZSA9IHtcclxuICAgICAgICBlbmFibGU6IGZhbHNlLFxyXG4gICAgICAgIHVwOiBmYWxzZSxcclxuICAgICAgICBkb3duOiBmYWxzZVxyXG4gICAgfTtcclxuXHJcbiAgICBASW5wdXQoKSB0cmVlSW5mbzogVHJlZUluZm87XHJcblxyXG4gICAgLyoqIOagkeW9ouW4ruWKqeaVsOaNruWKoOi9veaWueW8j++8miBkZWZhdWx0OiDlhoXnva7lj5bmlbDvvJsgbG9hZGFsbDog5Yqg6L295omA5pyJIGxheWVybG9hZO+8muWIhuWxguWKoOi9vSAqL1xyXG4gICAgQElucHV0KCkgbG9hZFRyZWVEYXRhVHlwZTogJ2RlZmF1bHQnIHwgJ2xvYWRhbGwnIHwgJ2xheWVybG9hZCcgPSAnZGVmYXVsdCc7XHJcbiAgICAvKiog5ZCv55So5p6E6YCg5a6M5pW05qCR6L+H5rukICovXHJcbiAgICBASW5wdXQoKSBlbmFibGVGdWxsVHJlZSA9IHRydWU7XHJcblxyXG4gICAgQE91dHB1dCgpIHBhZ2VDaGFuZ2VkID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG4gICAgQE91dHB1dCgpIHBhZ2VTaXplQ2hhbmdlZCA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuICAgIC8qKiDkvb/nlKjooajljZXmmKDlsITvvIzpu5jorqQgZmFsc2UgKi9cclxuICAgIEBJbnB1dCgpIHVzZUZvcm1EYXRhTWFwcGluZyA9IGZhbHNlO1xyXG5cclxuICAgIG93blNlbGVjdGlvbnM6IGFueTtcclxuICAgIGxvYWRGaW5pc2ggPSBmYWxzZTtcclxuICAgIHBhZ2VJbmZvOiBhbnkgPSB7IHBhZ2VTaXplOiAyMCwgcGFnZUluZGV4OiAxLCB0b3RhbDogMCB9O1xyXG4gICAgcHJpdmF0ZSB0dCQgPSBuZXcgU3ViamVjdCgpO1xyXG4gICAgcHJpdmF0ZSBsb2FkZWQkID0gbmV3IFN1YmplY3QoKTtcclxuICAgIHByaXZhdGUgX2NvbHVtbnM6IGFueVtdO1xyXG4gICAgcHJpdmF0ZSBfcGFnaW5hdGlvbjogYm9vbGVhbjtcclxuICAgIHByaXZhdGUgX3RhYmxlQ21wUmVmOiBhbnk7XHJcbiAgICBwcml2YXRlIF90cmVlQ21wUmVmOiBhbnk7XHJcbiAgICBwcml2YXRlIF9zZWFyY2hLZXlXb3JkcyA9ICcnO1xyXG5cclxuICAgIGxvYWREYXRhVHlwZSA9ICdhbGwnO1xyXG5cclxuICAgIHByaXZhdGUgaWRTZXI6IElkU2VydmljZTtcclxuXHJcbiAgICBjb25zdHJ1Y3RvcihcclxuICAgICAgICBwdWJsaWMgZWw6IEVsZW1lbnRSZWYsXHJcbiAgICAgICAgcHVibGljIGNkcjogQ2hhbmdlRGV0ZWN0b3JSZWYsXHJcbiAgICAgICAgQEluamVjdChET0NVTUVOVCkgcHVibGljIGRvY3VtZW50OiBhbnksXHJcbiAgICAgICAgcHVibGljIHJlbmRlcjogUmVuZGVyZXIyLFxyXG4gICAgICAgIHB1YmxpYyBjb21ib1NlcnZpY2U6IENvbWJvU2VydmljZSxcclxuICAgICAgICBwdWJsaWMgaW5qZWN0b3I6IEluamVjdG9yXHJcbiAgICApIHtcclxuICAgICAgICBzdXBlcihlbCwgY2RyLCBkb2N1bWVudCwgcmVuZGVyLCBjb21ib1NlcnZpY2UsIGluamVjdG9yKTtcclxuICAgICAgICB0aGlzLmlkU2VyID0gdGhpcy5pbmplY3Rvci5nZXQoSWRTZXJ2aWNlLCBudWxsKTtcclxuICAgICAgICBpZiAoIXRoaXMuaWRTZXIpIHtcclxuICAgICAgICAgICAgdGhpcy5pZFNlciA9IG5ldyBJZFNlcnZpY2UoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgbmdPbkluaXQoKSB7XHJcbiAgICAgICAgc3VwZXIubmdPbkluaXQoKTtcclxuXHJcbiAgICAgICAgdGhpcy50cmVlQ2xpZW50U2VhcmNoLnBpcGUoZGVib3VuY2VUaW1lKDMwMCkpLnN1YnNjcmliZSgodmFsdWU6IHN0cmluZykgPT4ge1xyXG4gICAgICAgICAgICBpZiAoIXRoaXMucmVtb3RlU2VhcmNoICYmIHRoaXMudHJlZUNtcFJlZikge1xyXG4gICAgICAgICAgICAgICAgdGhpcy50cmVlQ21wUmVmLnNlYXJjaEhhbmRsZS5zZWFyY2godGhpcy50ZXh0RmllbGQsIHZhbHVlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICB0aGlzLmNvbWJvU2VydmljZS50cmVlSW5mbyQuc3Vic2NyaWJlKCAodDogYW55KSA9PiB7XHJcbiAgICAgICAgICAgIGlmICh0KSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5sb2FkVHJlZURhdGFUeXBlID09PSAnZGVmYXVsdCcpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmxvYWREYXRhVHlwZSA9IHQubG9hZERhdGFUeXBlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHRoaXMudHJlZUluZm8gPSBPYmplY3QuYXNzaWduKHRoaXMudHJlZUluZm98fCB7fSwgdCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBwcm90ZWN0ZWQgb25TZWxlY3Rpb25zQ2hhbmdlKHNlbGVjdGlvbnM6IGFueVtdKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuZGlzcGxheVR5cGUgPT09ICdMT09LVVBMSVNUJykge1xyXG4gICAgICAgICAgICBpZiAoIXRoaXMubXVsdGlTZWxlY3QpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMub3duU2VsZWN0aW9ucyA9IHNlbGVjdGlvbnNbMF0gPyAgc2VsZWN0aW9uc1swXSA6IHt9O1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5vd25TZWxlY3Rpb25zID0ge307XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNvbWJvU2VydmljZS5zZWxlY3Rpb25zLmZvckVhY2goaXRlbSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5vd25TZWxlY3Rpb25zW2l0ZW1bdGhpcy5pZEZpZWxkXV0gPSBpdGVtO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5wYWdlSW5mbyA9IHsgLi4udGhpcy5wYWdlSW5mbywgLi4udGhpcy5jb21ib1NlcnZpY2UucGFnZUluZm8gfTtcclxuICAgICAgICAgICAgdGhpcy5sb2FkRmluaXNoID0gdHJ1ZTtcclxuICAgICAgICAgICAgdGhpcy5jZHIuZGV0ZWN0Q2hhbmdlcygpO1xyXG4gICAgICAgICAgICB0aGlzLmxvYWRlZCQubmV4dCh0aGlzLnBhZ2VJbmZvKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBpZiAodGhpcy50cmVlQ21wUmVmKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmluaXRUcmVlRGF0YSgpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdGhpcy50dCQucGlwZSh0YWtlKDEpKS5zdWJzY3JpYmUoKGNtZjogVHJlZVRhYmxlQ29tcG9uZW50KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy50cmVlQ21wUmVmID0gY21mO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaW5pdFRyZWVEYXRhKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gY21mLmNoZWNrZWROb2RlcyhpZHMsIHRydWUsIGZhbHNlKTtcclxuICAgICAgICAgICAgICAgICAgICAvLyBjbWYudXBkYXRlU2VyaWFsaXplZFZhbHVlKCk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHNldFRyZWVOb2RlRXhwYW5kQnkobm9kZXM6IFRyZWVOb2RlW10sIGV4cGFuZExheWVyKSB7XHJcbiAgICAgICAgaWYgKCFub2RlcyB8fCAhbm9kZXMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgbm9kZXMuZm9yRWFjaCgobjogVHJlZU5vZGUpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgbGF5ZXIgPSBuLmRhdGFbdGhpcy50cmVlSW5mby5kYXRhRmllbGRdLmxheWVyO1xyXG4gICAgICAgICAgICBuLmV4cGFuZGVkID0gbGF5ZXIgPD0gZXhwYW5kTGF5ZXIgPyB0cnVlIDogbi5leHBhbmRlZDtcclxuICAgICAgICAgICAgaWYgKG4uY2hpbGRyZW4gJiYgbi5jaGlsZHJlbi5sZW5ndGggJiYgbGF5ZXIgKyAxIDw9IGV4cGFuZExheWVyKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNldFRyZWVOb2RlRXhwYW5kQnkobi5jaGlsZHJlbiwgZXhwYW5kTGF5ZXIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBpbml0VHJlZURhdGEoKSB7XHJcbiAgICAgICAgY29uc3QgX19zZWxlY3Rpb25zID0gdGhpcy5jb21ib1NlcnZpY2Uuc2VsZWN0aW9ucy5maWx0ZXIobiA9PiBuICE9PSBudWxsICYmIG4gIT09IHVuZGVmaW5lZCk7XHJcbiAgICAgICAgY29uc3QgaWRzID0gW107XHJcbiAgICAgICAgdGhpcy5vd25TZWxlY3Rpb25zID0gX19zZWxlY3Rpb25zLm1hcChpdGVtID0+IHtcclxuICAgICAgICAgICAgaWRzLnB1c2goaXRlbVt0aGlzLmlkRmllbGRdKTtcclxuICAgICAgICAgICAgcmV0dXJuIHsgZGF0YTogaXRlbSwgaWQ6IGl0ZW1bdGhpcy5pZEZpZWxkXSB9O1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHRoaXMudHJlZUNtcFJlZi5zZWxlY3Rpb25zID0gdGhpcy5vd25TZWxlY3Rpb25zO1xyXG4gICAgICAgIHRoaXMudHJlZUNtcFJlZi5jaGVja2VkcyA9IHRoaXMub3duU2VsZWN0aW9ucztcclxuXHJcbiAgICAgICAgaWYgKHRoaXMuZXhwYW5kTGV2ZWwgIT0gLTEgJiYgdGhpcy5sb2FkRGF0YVR5cGUgPT0gJ2FsbCcgKSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmV4cGFuZExldmVsID4gMCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zZXRUcmVlTm9kZUV4cGFuZEJ5KHRoaXMudHJlZUNtcFJlZi5kYXRhLCB0aGlzLmV4cGFuZExldmVsKTtcclxuICAgICAgICAgICAgICAgIHRoaXMudHJlZUNtcFJlZi51cGRhdGVTZXJpYWxpemVkVmFsdWUoKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRoaXMudHJlZUNtcFJlZi5leHBhbmRBbGwoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHRoaXMuY29tYm9TZXJ2aWNlLmRhdGEgJiYgdGhpcy5jb21ib1NlcnZpY2UuZGF0YS5sZW5ndGgpIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMudHJlZUNtcFJlZi5jaGVja1ZhbHVlcyAmJiB0aGlzLnRyZWVDbXBSZWYuY2hlY2tWYWx1ZXMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5tdWx0aVNlbGVjdCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMudHJlZUNtcFJlZi5jaGVja2VkTm9kZXModGhpcy50cmVlQ21wUmVmLmNoZWNrVmFsdWVzKTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnRyZWVDbXBSZWYuc2VsZWN0Tm9kZXModGhpcy50cmVlQ21wUmVmLmNoZWNrVmFsdWVzKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy50cmVlQ21wUmVmLnNlbGVjdE5vZGVzKHRoaXMudHJlZUNtcFJlZi5jaGVja1ZhbHVlcyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG5cclxuICAgIHByaXZhdGUgaXNUcmVlKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmRpc3BsYXlUeXBlID09PSAnTE9PS1VQVFJFRUxJU1QnO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICB1cGRhdGVNYXBwaW5nRmllbGRWYWx1ZShjbGVhck1hcEZpZWxkcyA9IGZhbHNlKSB7XHJcbiAgICAgICAgaWYgKCB0aGlzLm5nQ29udHJvbCAmJiB0aGlzLm5nQ29udHJvbC5mb3JtRGlyZWN0aXZlICYmXHJcbiAgICAgICAgICAgIHRoaXMubmdDb250cm9sLmZvcm1EaXJlY3RpdmUuZm9ybSAmJiB0aGlzLm5nQ29udHJvbC5mb3JtRGlyZWN0aXZlLmZvcm0uYmluZGluZ0RhdGFcclxuICAgICAgICApIHtcclxuICAgICAgICAgICAgY29uc3QgYmluZGluZ0RhdGEgPSB0aGlzLm5nQ29udHJvbC5mb3JtRGlyZWN0aXZlLmZvcm0uYmluZGluZ0RhdGE7XHJcbiAgICAgICAgICAgIGNvbnN0IGJpbmRpbmdQYXRoID0gdGhpcy5uZ0NvbnRyb2wuZm9ybURpcmVjdGl2ZS5mb3JtLmJpbmRpbmdQYXRoO1xyXG4gICAgICAgICAgICBsZXQgcGF0aEFyciA9IFtdO1xyXG4gICAgICAgICAgICBpZiAoYmluZGluZ1BhdGgpIHtcclxuICAgICAgICAgICAgICAgIHBhdGhBcnIgPSBiaW5kaW5nUGF0aC5zcGxpdCgnLycpLmZpbHRlcihuID0+IG4gIT09ICcnKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLm1hcHBpbmdGaWVsZCA9IHRoaXMubWFwcGluZ0ZpZWxkID8gdGhpcy5tYXBwaW5nRmllbGQgOiB7fTtcclxuICAgICAgICAgICAgaWYgKHRoaXMubWFwRmllbGRzKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBoZWxwRmllbGRzID0gT2JqZWN0LmtleXModGhpcy5tYXBGaWVsZHMpO1xyXG4gICAgICAgICAgICAgICAgaGVscEZpZWxkcy5mb3JFYWNoKChmOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBmaWVsZE5hbWVzID0gdGhpcy5tYXBGaWVsZHNbZl0gPyB0aGlzLm1hcEZpZWxkc1tmXSA6ICcnO1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCB2YWx1ZSA9ICcnO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICghY2xlYXJNYXBGaWVsZHMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdGV4dCA9IHRoaXMuY29tYm9TZXJ2aWNlLnNlbGVjdGlvbnMgJiYgdGhpcy5jb21ib1NlcnZpY2Uuc2VsZWN0aW9ucy5tYXAoaXRlbSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5jb21ib1NlcnZpY2UuZ2V0VmFsdWVCeU9iaihmLCBpdGVtKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSkuZmlsdGVyKG4gPT4gbiAhPT0gbnVsbCkuam9pbih0aGlzLnNlcGFyYXRvcik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHZhbHVlID0gdGV4dCA/IHRleHQgOiB0aGlzLmRpc3BsYXlUZXh0ID8gdGhpcy5kaXNwbGF5VGV4dCA6ICcnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IHRleHQgfHwgJyc7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAoZmllbGROYW1lcykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBmaWVsZE5hbWVzLnNwbGl0KCcsJykuZm9yRWFjaCgoZmllbGROYW1lOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBfdmFsID0gdmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5ub3NlYXJjaCAmJiBmaWVsZE5hbWUgPT09IHRoaXMubmdDb250cm9sLm5hbWUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdmFsID0gdGhpcy5kaXNwbGF5VGV4dDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChiaW5kaW5nRGF0YS5zZXRWYWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICggIXRoaXMudXNlRm9ybURhdGFNYXBwaW5nKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJpbmRpbmdEYXRhLnNldFZhbHVlKCBwYXRoQXJyLmNvbmNhdChmaWVsZE5hbWUuc3BsaXQoJy4nKSksIF92YWwsIHRydWUsIHRydWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jb21tb25VdGlscy5zZXRWYWx1ZShiaW5kaW5nRGF0YSwgZmllbGROYW1lLCB2YWx1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICB1cGRhdGVTZWxlY3RlZFZhbHVlcygpIHtcclxuICAgICAgICBpZiAoXHJcbiAgICAgICAgICAgIHRoaXMubmdDb250cm9sICYmXHJcbiAgICAgICAgICAgIHRoaXMubmdDb250cm9sLmZvcm1EaXJlY3RpdmUgJiZcclxuICAgICAgICAgICAgdGhpcy5uZ0NvbnRyb2wuZm9ybURpcmVjdGl2ZS5mb3JtICYmXHJcbiAgICAgICAgICAgIHRoaXMubmdDb250cm9sLmZvcm1EaXJlY3RpdmUuZm9ybS5iaW5kaW5nRGF0YVxyXG4gICAgICAgICkge1xyXG4gICAgICAgICAgICBjb25zdCBiaW5kaW5nRGF0YSA9IHRoaXMubmdDb250cm9sLmZvcm1EaXJlY3RpdmUuZm9ybS5iaW5kaW5nRGF0YTtcclxuICAgICAgICAgICAgY29uc3QgYmluZGluZ1BhdGggPSB0aGlzLm5nQ29udHJvbC5mb3JtRGlyZWN0aXZlLmZvcm0uYmluZGluZ1BhdGg7XHJcbiAgICAgICAgICAgIGxldCBwYXRoQXJyID0gW107XHJcbiAgICAgICAgICAgIGlmIChiaW5kaW5nUGF0aCkge1xyXG4gICAgICAgICAgICAgICAgcGF0aEFyciA9IGJpbmRpbmdQYXRoLnNwbGl0KCcvJykuZmlsdGVyKG4gPT4gbiAhPT0gJycpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGxldCB0YXJnZXRGaWVsZCA9IHRoaXMubWFwcGluZ0ZpZWxkID8gdGhpcy5tYXBGaWVsZHNbdGhpcy5pZEZpZWxkXSA6ICcnO1xyXG5cclxuICAgICAgICAgICAgaWYgKHRhcmdldEZpZWxkICYmIHRhcmdldEZpZWxkLmluZGV4T2YoJywnKSA+IC0xKSB7XHJcbiAgICAgICAgICAgICAgICB0YXJnZXRGaWVsZCA9IHRhcmdldEZpZWxkLnNwbGl0KCcsJylbMF07XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIHRoaXMubWFwcGluZ0ZpZWxkID0gdGhpcy5tYXBwaW5nRmllbGQgPyB0aGlzLm1hcHBpbmdGaWVsZCA6ICcnO1xyXG4gICAgICAgICAgICBpZiAodGFyZ2V0RmllbGQgJiYgYmluZGluZ0RhdGEuZ2V0VmFsdWUpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRWYWx1ZXMgPSBiaW5kaW5nRGF0YS5nZXRWYWx1ZShwYXRoQXJyLmNvbmNhdCh0YXJnZXRGaWVsZC5zcGxpdCgnLicpKSkgfHwgJyc7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodGFyZ2V0RmllbGQpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRWYWx1ZXMgPSB0aGlzLmNvbW1vblV0aWxzLmdldFZhbHVlKHRhcmdldEZpZWxkLCBiaW5kaW5nRGF0YSkgfHwgJyc7XHJcbiAgICAgICAgICAgIH0gXHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgLy8g5YW85a655Li66K6+572uaWRGaWVsZCDlrZfmrrXmmKDlsITnmoTmg4XlhrXvvIzmraTmg4XlhrXkvb/nlKggdmFsdWVGaWVsZFxyXG4gICAgICAgICAgICAgICAgdGFyZ2V0RmllbGQgPSB0aGlzLm1hcHBpbmdGaWVsZCA/IHRoaXMubWFwRmllbGRzW3RoaXMudGV4dEZpZWxkXSA6ICcnO1xyXG4gICAgICAgICAgICAgICAgaWYgKHRhcmdldEZpZWxkICYmIGJpbmRpbmdEYXRhLmdldFZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jb21ib1NlcnZpY2VbJ19fU0VMRUNURURJRFNfXyddID0gdGhpcy5jb21ib1NlcnZpY2UuZ2V0VmFsdWUodGhpcy5pZEZpZWxkKTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGVkVmFsdWVzID0gIGJpbmRpbmdEYXRhLmdldFZhbHVlKHBhdGhBcnIuY29uY2F0KHRhcmdldEZpZWxkLnNwbGl0KCcuJykpKSB8fCAnJztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSBcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAvLyBVSSBzdGF0ZSBiaW5kaW5nXHJcbiAgICAgICAgICAgIGlmICh0aGlzLmVsLm5hdGl2ZUVsZW1lbnRbJ19fem9uZV9zeW1ib2xfX1VJU3RhdGVCaW5kaW5nQ2hhbmdlZmFsc2UnXSkge1xyXG4gICAgICAgICAgICAgICAgLy8gdGhpcy5zZWxlY3RlZFZhbHVlcyA9IHRoaXMuY29tYm9TZXJ2aWNlLmdldFZhbHVlKHRoaXMudGV4dEZpZWxkKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRWYWx1ZXMgPSB0aGlzLmRpc3BsYXlUZXh0O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIG9uU2VsZWN0Um93cyhyb3cpIHtcclxuICAgICAgICBpZiAodGhpcy5kaXNwbGF5VHlwZSA9PT0gJ0xPT0tVUExJU1QnKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHsgZGF0YSwgaW5kZXggfSA9IHJvdztcclxuICAgICAgICAgICAgdGhpcy5jb21ib1NlcnZpY2Uuc2VsZWN0SXRlbShkYXRhLCBpbmRleCk7XHJcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0Q2hhbmdlLmVtaXQoeyBkYXRhLCBpbmRleCwgaW5zdGFuY2U6IHRoaXMgfSk7IC8vIFVJLVNUQVRFLUJJTkRJTkcg5Lit5L2/55SoXHJcbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLmRpc3BsYXlUeXBlID09PSAnTE9PS1VQVFJFRUxJU1QnKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHsgbm9kZSB9ID0gcm93O1xyXG4gICAgICAgICAgICBpZiAocm93Lm5vZGVzKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNvbWJvU2VydmljZS5zZWxlY3RJdGVtKHJvdy5ub2Rlcy5tYXAobiA9PiBuLmRhdGEpKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuY29tYm9TZXJ2aWNlLnNlbGVjdEl0ZW0obm9kZS5kYXRhKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLnNlbGVjdENoYW5nZS5lbWl0KG5vZGUpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy51cGRhdGVUZXh0QW5kVmFsdWVzKCk7XHJcbiAgICAgICAgaWYgKCF0aGlzLm11bHRpU2VsZWN0KSB7XHJcbiAgICAgICAgICAgIHRoaXMuY29tYm9TZXJ2aWNlLmlzT3BlbiQubmV4dChmYWxzZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIG9uVW5TZWxlY3RSb3dzKHJvdykge1xyXG4gICAgICAgIGlmICh0aGlzLmRpc3BsYXlUeXBlID09PSAnTE9PS1VQTElTVCcpIHtcclxuICAgICAgICAgICAgY29uc3QgeyBkYXRhIH0gPSByb3c7XHJcbiAgICAgICAgICAgIHRoaXMuY29tYm9TZXJ2aWNlLnVuU2VsZWN0SXRlbShkYXRhKTtcclxuICAgICAgICB9IGVsc2UgaWYgKHRoaXMuZGlzcGxheVR5cGUgPT09ICdMT09LVVBUUkVFTElTVCcpIHtcclxuICAgICAgICAgICAgY29uc3QgeyBub2RlIH0gPSByb3c7XHJcbiAgICAgICAgICAgIHRoaXMuY29tYm9TZXJ2aWNlLnVuU2VsZWN0SXRlbShub2RlLmRhdGEpO1xyXG4gICAgICAgICAgICB0aGlzLnNlbGVjdENoYW5nZS5lbWl0KG5vZGUpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy51cGRhdGVUZXh0QW5kVmFsdWVzKCk7XHJcbiAgICB9XHJcblxyXG4gICAgb25DaGVja0FsbChldikge1xyXG4gICAgICAgIGxldCBzdGF0ZTtcclxuICAgICAgICBsZXQgc2VsZWN0aW9ucyA9IFtdO1xyXG4gICAgICAgIGlmICh0aGlzLmRpc3BsYXlUeXBlID09PSAnTE9PS1VQVFJFRUxJU1QnKSB7XHJcbiAgICAgICAgICAgIHN0YXRlID0gZXYuY2hlY2tlZDtcclxuICAgICAgICAgICAgc2VsZWN0aW9ucyA9IHRoaXMudHJlZUNtcFJlZi5zdGF0ZS5yb3dOb2Rlc1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmZpbHRlcihuID0+IG4ubm9kZS5zZWxlY3RhYmxlID09PSB1bmRlZmluZWQgfHwgbi5ub2RlLnNlbGVjdGFibGUgKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLm1hcChyID0+IHIubm9kZS5kYXRhKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBzdGF0ZSA9IGV2O1xyXG4gICAgICAgICAgICBzZWxlY3Rpb25zID0gdGhpcy5kYXRhO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHN0YXRlKSB7XHJcbiAgICAgICAgICAgIHRoaXMuY29tYm9TZXJ2aWNlLnNlbGVjdEFsbChzZWxlY3Rpb25zKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLmNvbWJvU2VydmljZS51blNlbGVjdEFsbChzZWxlY3Rpb25zKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMudXBkYXRlVGV4dEFuZFZhbHVlcygpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgdXBkYXRlVGV4dEFuZFZhbHVlcygpIHtcclxuICAgICAgICB0aGlzLmNvbWJvU2VydmljZVsnX19TRUxFQ1RFRElEU19fJ10gPSB0aGlzLmNvbWJvU2VydmljZS5nZXRWYWx1ZSh0aGlzLmlkRmllbGQpO1xyXG4gICAgICAgIHRoaXMuc2VsZWN0ZWRWYWx1ZXMgPSB0aGlzLmNvbWJvU2VydmljZVsnX19TRUxFQ1RFRElEU19fJ107XHJcbiAgICAgICAgaWYgKCF0aGlzLm11bHRpU2VsZWN0KSB7XHJcbiAgICAgICAgICAgIHRoaXMudXBkYXRlU2VsZWN0ZWRWYWx1ZXMoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc3QgX2Rpc3BsYXlUZXh0ID0gdGhpcy5jb21ib1NlcnZpY2UuZ2V0VmFsdWUodGhpcy50ZXh0RmllbGQpO1xyXG4gICAgICAgIHRoaXMub25WYWx1ZUNoYW5nZSh7IHRleHQ6IF9kaXNwbGF5VGV4dCwgdmFsdWU6IHRoaXMuY29tYm9TZXJ2aWNlWydfX1NFTEVDVEVESURTX18nXSwgc2VsZWN0aW9uczogdGhpcy5zZWxlY3Rpb25zIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIG9uS2V5dXAoJGV2ZW50KSB7XHJcbiAgICAgICAgLy8gY29uc29sZS5sb2coJ2tleSB1cCcsICRldmVudCk7XHJcblxyXG4gICAgfVxyXG5cclxuICAgIG9uS2V5ZG93bigkZXZlbnQ6IEtleWJvYXJkRXZlbnQpIHtcclxuICAgICAgICAvLyBjb25zb2xlLmxvZygna2V5IGRvd24nLCAkZXZlbnQpO1xyXG4gICAgICAgIGlmICgkZXZlbnQua2V5ID09PSAnVGFiJykge1xyXG4gICAgICAgICAgICB0aGlzLmhpZGUoZmFsc2UpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKCRldmVudC5rZXkgPT09ICdFbnRlcicpIHtcclxuICAgICAgICAgICAgJGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gICAgICAgICAgICBpZiAodGhpcy5fc2VhcmNoS2V5V29yZHMgJiYgIXRoaXMubXVsdGlTZWxlY3QpIHtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmRpc3BsYXlUeXBlID09PSAnTE9PS1VQTElTVCcpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLm9uU2VsZWN0Um93cyh7ZGF0YTogdGhpcy5fdGFibGVDbXBSZWYuc2VsZWN0aW9uc30pO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLmRpc3BsYXlUeXBlID09PSAnTE9PS1VQVFJFRUxJU1QnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gdGhpcy50cmVlQ21wUmVmLnNlbGVjdE5vZGUoKVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIG9uUGFnZUNoYW5nZWQoZXZlbnQpIHtcclxuICAgICAgICBpZiAodGhpcy51cmkpIHtcclxuICAgICAgICAgICAgdGhpcy5nZXREYXRhKGV2ZW50KS5zdWJzY3JpYmUoZGF0YSA9PiB0aGlzLmNvbWJvU2VydmljZS5sb2FkTG9va1VwRGF0YVRhYmxlKGRhdGEsICEhZXZlbnQuc29ydE5hbWUpKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLnBhZ2VDaGFuZ2VkLmVtaXQoZXZlbnQpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBvblBhZ2VTaXplQ2hhbmdlZChldmVudCkge1xyXG4gICAgICAgIGlmICh0aGlzLnVyaSkge1xyXG4gICAgICAgICAgICB0aGlzLmdldERhdGEoZXZlbnQpLnN1YnNjcmliZShkYXRhID0+IHRoaXMuY29tYm9TZXJ2aWNlLmxvYWRMb29rVXBEYXRhVGFibGUoZGF0YSwgISFldmVudC5zb3J0TmFtZSkpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMucGFnZVNpemVDaGFuZ2VkLmVtaXQoZXZlbnQpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBvbkNvbHVtblNvcnRlZChldmVudDogeyBzb3J0TmFtZTogc3RyaW5nOyBzb3J0T3JkZXI6IGFueSB9KSB7XHJcbiAgICAgICAgY29uc3QgeyBzb3J0TmFtZSwgc29ydE9yZGVyIH0gPSB7IC4uLmV2ZW50IH07XHJcbiAgICAgICAgdGhpcy5nZXREYXRhKHsgc29ydE5hbWUsIHNvcnRPcmRlciB9LCAnc2VhcmNoJykuc3Vic2NyaWJlKGRhdGEgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLmNvbWJvU2VydmljZS5sb2FkTG9va1VwRGF0YVRhYmxlKGRhdGEsIHRydWUpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIG9uQ2xlYXIoKSB7XHJcbiAgICAgICAgdGhpcy5vd25TZWxlY3Rpb25zID0gW107XHJcbiAgICAgICAgaWYgKHRoaXMuaXNUcmVlKCkgJiYgdGhpcy50cmVlQ21wUmVmKSB7XHJcbiAgICAgICAgICAgIHRoaXMudHJlZUNtcFJlZi5jbGVhckFsbCgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBzdXBlci5vbkNsZWFyKCk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBnZXRDaGlsZHJlbiggcGFyZW50UGF0aCxwYXJlbnRMYXllcixzZWFyY2hEYXRhOiB7IHNlYXJjaEZpZWxkOiBzdHJpbmc7IHNlYXJjaFZhbHVlOiBzdHJpbmcgfSkge1xyXG4gICAgICAgIGNvbnN0IHNlYXJjaCA9IHsgcGFyZW50TGF5ZXIsIGNhdGVnb3J5OiAnY2hpbGRyZW4nLCAuLi5zZWFyY2hEYXRhIH07XHJcbiAgICAgICAgaWYgKHRoaXMudHJlZUluZm8ubGF5ZXJUeXBlID09PSAncGFyZW50SWQnKSB7XHJcbiAgICAgICAgICAgIHNlYXJjaFsncGFyZW50SWQnXSA9IHBhcmVudFBhdGg7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgc2VhcmNoWydwYXJlbnRQYXRoJ10gPSBwYXJlbnRQYXRoO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgcGFyYW0gPSB7XHJcbiAgICAgICAgICAgIHNlYXJjaFZhbHVlOiBKU09OLnN0cmluZ2lmeShzZWFyY2gpLFxyXG4gICAgICAgICAgICBjdXN0b21EYXRhOiB0aGlzLmN1c3RvbURhdGEsXHJcbiAgICAgICAgICAgIGVuYWJsZUZ1bGxUcmVlOiB0aGlzLmVuYWJsZUZ1bGxUcmVlLFxyXG4gICAgICAgICAgICBsb2FkVHJlZURhdGFUeXBlOiB0aGlzLmxvYWRUcmVlRGF0YVR5cGVcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBpZiAodGhpcy5fc2VhcmNoS2V5V29yZHMpIHtcclxuICAgICAgICAgICAgcGFyYW0uZW5hYmxlRnVsbFRyZWUgPSBmYWxzZTtcclxuICAgICAgICAgICAgcGFyYW0ubG9hZFRyZWVEYXRhVHlwZSA9ICdsYXllcmxvYWQnO1xyXG5cclxuICAgICAgICAgICAgaWYgKHRoaXMudHJlZUluZm8ubGF5ZXJUeXBlID09PSAncGFyZW50SWQnKSB7XHJcbiAgICAgICAgICAgICAgICAvLyDmoJHlvaLluK7liqnmn6Xor6LlkI7vvIzlsZXlvIDoioLngrnml7blsIbnm7jlhbPmn6Xor6Llj4LmlbDkvKDpgJLliLDlkI7nq68gMjAyMi0wOS0xM1xyXG4gICAgICAgICAgICAgICAgc2VhcmNoLnNlYXJjaFZhbHVlID0gJyc7XHJcbiAgICAgICAgICAgICAgICBzZWFyY2guc2VhcmNoRmllbGQgPSAnKic7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcGFyYW0uc2VhcmNoVmFsdWUgPSBKU09OLnN0cmluZ2lmeShzZWFyY2gpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgdHQgPSB0aGlzLnRyZWVDbXBSZWYgYXMgVHJlZVRhYmxlQ29tcG9uZW50O1xyXG4gICAgICAgIGlmICh0dCAmJiB0dC5zb3J0TmFtZSkge1xyXG4gICAgICAgICAgICBPYmplY3QuYXNzaWduKHBhcmFtLCB7XHJcbiAgICAgICAgICAgICAgICBzb3J0TmFtZTogdHQuc29ydE5hbWUsXHJcbiAgICAgICAgICAgICAgICBzb3J0T3JkZXI6IHR0LnNvcnRPcmRlclxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY29tYm9TZXJ2aWNlLmdldERhdGEocGFyYW0sICdnZXQnLCB0cnVlKTtcclxuICAgIH1cclxuXHJcblxyXG4gICAgZ2V0RGF0YShldmVudD86IGFueSwgdHlwZSA9ICdhbGwnKSB7XHJcbiAgICAgICAgZXZlbnQgPSBldmVudCB8fCB7fTtcclxuICAgICAgICBpZiAodGhpcy5fc2VhcmNoS2V5V29yZHMpIHtcclxuICAgICAgICAgICAgZXZlbnQuc2VhcmNoID0ge1xyXG4gICAgICAgICAgICAgICAgZmllbGQ6ICcqJyxcclxuICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLl9zZWFyY2hLZXlXb3Jkc1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgcGFyYW1zID0gdGhpcy5idWlsZFF1ZXJ5UGFyYW1zKGV2ZW50LCB0eXBlKTtcclxuICAgICAgICByZXR1cm4gdGhpcy5jb21ib1NlcnZpY2UuZ2V0RGF0YShwYXJhbXMpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKiDmnoTpgInmn6Xor6Llj4LmlbAgKi9cclxuICAgIHByaXZhdGUgYnVpbGRRdWVyeVBhcmFtcyhldmVudD86IGFueSwgdHlwZSA9ICdhbGwnKSB7XHJcbiAgICAgICAgY29uc3QgcGFyYW1zOiBhbnkgPSB7fTtcclxuXHJcbiAgICAgICAgY29uc3Qgc2VhcmNoUGFyYW0gPSB7IGNhdGVnb3J5OiB0eXBlIH07XHJcbiAgICAgICAgaWYgKGV2ZW50KSB7XHJcbiAgICAgICAgICAgIGlmIChldmVudC5wYWdlSW5mbykge1xyXG4gICAgICAgICAgICAgICAgcGFyYW1zWydwYWdlSW5kZXgnXSA9IGV2ZW50LnBhZ2VJbmZvLnBhZ2VJbmRleDtcclxuICAgICAgICAgICAgICAgIHBhcmFtc1sncGFnZVNpemUnXSA9IGV2ZW50LnBhZ2VJbmZvLnBhZ2VTaXplO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAoZXZlbnQuc2VhcmNoKSB7XHJcbiAgICAgICAgICAgICAgICBzZWFyY2hQYXJhbVsnc2VhcmNoRmllbGQnXSA9IGV2ZW50LnNlYXJjaC5maWVsZDtcclxuICAgICAgICAgICAgICAgIHNlYXJjaFBhcmFtWydzZWFyY2hWYWx1ZSddID0gZXZlbnQuc2VhcmNoLnZhbHVlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAoZXZlbnQuc29ydE5hbWUpIHtcclxuICAgICAgICAgICAgICAgIHNlYXJjaFBhcmFtWydzb3J0TmFtZSddID0gZXZlbnQuc29ydE5hbWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKGV2ZW50LnNvcnRPcmRlcikge1xyXG4gICAgICAgICAgICAgICAgc2VhcmNoUGFyYW1bJ3NvcnRPcmRlciddID0gZXZlbnQuc29ydE9yZGVyO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwYXJhbXNbJ3NlYXJjaFZhbHVlJ10gPSBKU09OLnN0cmluZ2lmeShzZWFyY2hQYXJhbSk7XHJcbiAgICAgICAgaWYgKHRoaXMuY3VzdG9tRGF0YSkge1xyXG4gICAgICAgICAgICBwYXJhbXNbJ2N1c3RvbURhdGEnXSA9IHRoaXMuY3VzdG9tRGF0YTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBwYXJhbXM7XHJcbiAgICB9XHJcblxyXG4gICAgZmlsdGVyRGF0YU9uU2VydmVyKHZhbHVlLCBmaWVsZCkge1xyXG4gICAgICAgIGxldCBzZWFyY2ggPSB7IHNlYXJjaDogeyBmaWVsZCwgdmFsdWUgfX07XHJcbiAgICAgICAgaWYgKHZhbHVlKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX3NlYXJjaEtleVdvcmRzID0gdmFsdWU7XHJcblxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMuX3NlYXJjaEtleVdvcmRzID0gJyc7XHJcbiAgICAgICAgICAgIHNlYXJjaCA9IG51bGw7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCBwYXJhbXMgPSB0aGlzLmJ1aWxkUXVlcnlQYXJhbXMoc2VhcmNoLCAnc2VhcmNoJyApO1xyXG4gICAgICAgIGlmICghdGhpcy5pc09wZW4pIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMubm9zZWFyY2gpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLmlzT3BlbiA9IHRydWU7XHJcbiAgICAgICAgICAgIHRoaXMuY29tYm9TZXJ2aWNlLmlzT3BlbiQubmV4dCh7IGlzT3BlbjogdGhpcy5pc09wZW4sIHNlYXJjaDogcGFyYW1zfSk7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICAgICAgdGhpcy5jb21ib1NlcnZpY2Uuc2VyYWNoVmFsdWUkLm5leHQocGFyYW1zKTtcclxuICAgIH1cclxuXHJcbiAgICBvbkV4cGFuZE5vZGUodG46IFRyZWVOb2RlKSB7XHJcbiAgICAgICAgaWYgKHRuLmxlYWYgfHwgIHRuWydzaG93TG9hZGluZyddKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICghdG4uY2hpbGRyZW4gfHwgIXRuLmNoaWxkcmVuLmxlbmd0aCkge1xyXG4gICAgICAgICAgICBsZXQgcGFyZW50UGF0aCA9ICcnO1xyXG4gICAgICAgICAgICBsZXQgcGFyZW50TGF5ZXIgPSAtMTtcclxuICAgICAgICAgICAgY29uc3QgeyBmaWVsZCA9ICcqJywgdmFsdWUgPSAnJyB9ID0ge1xyXG4gICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMuX3NlYXJjaEtleVdvcmRzXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIGNvbnN0IHRyZWVJbmZvRmllbGQgPSB0aGlzLnRyZWVJbmZvLmRhdGFGaWVsZDtcclxuICAgICAgICAgICAgaWYgKHRoaXMudHJlZUluZm8ubGF5ZXJUeXBlID09PSAncGFyZW50SWQnKSB7XHJcbiAgICAgICAgICAgICAgICAvLyDniLZJROWKoOi9veaWueW8j1xyXG4gICAgICAgICAgICAgICAgcGFyZW50UGF0aCA9IHRuWydpZCddO1xyXG4gICAgICAgICAgICAgICAgcGFyZW50TGF5ZXIgPSB0bi5kYXRhW3RyZWVJbmZvRmllbGRdW3RoaXMudHJlZUluZm8ubGF5ZXJGaWVsZF07XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodHJlZUluZm9GaWVsZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHBhcmVudFBhdGggPSB0bi5kYXRhW3RyZWVJbmZvRmllbGRdW3RoaXMudHJlZUluZm8ucGF0aEZpZWxkXTtcclxuICAgICAgICAgICAgICAgICAgICBwYXJlbnRMYXllciA9IHRuLmRhdGFbdHJlZUluZm9GaWVsZF1bdGhpcy50cmVlSW5mby5sYXllckZpZWxkXTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy50cmVlQ21wUmVmLndyaXRlQ29uc29sZSgn5pyq5om+5Yiw5YiG57qn5L+h5oGv44CCJyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHRoaXMuZ2V0Q2hpbGRyZW4ocGFyZW50UGF0aCwgcGFyZW50TGF5ZXIsIHtcclxuICAgICAgICAgICAgICAgIHNlYXJjaEZpZWxkOiBmaWVsZCA9PT0gJyonID8gJyonIDogZmllbGQsXHJcbiAgICAgICAgICAgICAgICBzZWFyY2hWYWx1ZTogdmFsdWVcclxuICAgICAgICAgICAgfSkuc3Vic2NyaWJlKGRhdGEgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKHRuICYmIGRhdGEuaXRlbXMgJiYgZGF0YS5pdGVtcy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBub2RlcyA9IHRoaXMuY29tYm9TZXJ2aWNlLmNoZWNrTm9kZUNhbkJlU2VsZWN0KGRhdGEuaXRlbXMsIGZhbHNlKTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnRyZWVDbXBSZWYuYXBwZW5kQ2hpbGRyZW4obm9kZXMsIHRuKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHRoaXMudHJlZUNtcFJlZi5kZXRlY3RDaGFuZ2VzKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gaWYgKHRoaXMuc2VsZWN0ZWRWYWx1ZXMgJiYgdGhpcy5zZWxlY3RlZFZhbHVlcy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgIC8vICAgICB0aGlzLnRyZWVDbXBSZWYuY2hlY2tlZE5vZGVzKHRoaXMuc2VsZWN0ZWRWYWx1ZXMuc3BsaXQoJywnKSk7XHJcbiAgICAgICAgICAgICAgICAvLyB9XHJcbiAgICAgICAgICAgICAgICBjb25zdCBpZHMgPSB0aGlzLmNvbWJvU2VydmljZVsnX19TRUxFQ1RFRElEU19fJ107XHJcbiAgICAgICAgICAgICAgICBpZiAoaWRzICYmIGlkcy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBpZEFyciA9IGlkcy5zcGxpdCh0aGlzLnNlcGFyYXRvcik7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMubXVsdGlTZWxlY3QpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy50cmVlQ21wUmVmLmNoZWNrZWROb2RlcyhpZEFycik7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMudHJlZUNtcFJlZi5zZWxlY3ROb2RlcyhpZEFycik7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgdGhpcy50cmVlQ21wUmVmLnBzUmVmLmRpcmVjdGl2ZVJlZi51cGRhdGUoKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByb3RlY3RlZCBpbml0RGF0YXNDaGFuZ2VBY3Rpb24oKSB7XHJcbiAgICAgICAgdGhpcy5jb21ib1NlcnZpY2UuZGF0YSQucGlwZShcclxuICAgICAgICAgICAgZGVsYXkoMTIwKVxyXG4gICAgICAgICkuc3Vic2NyaWJlKGRhdGEgPT4ge1xyXG5cclxuICAgICAgICAgICAgLy8g5biu5Yqp5pWw5o2u5byC5q2l6Ieq5a6a5LmJ5Y+W5pWw77ybXHJcbiAgICAgICAgICAgIC8vIOW4ruWKqemFjee9rueVjOmdolxyXG4gICAgICAgICAgICBpZiAoIXRoaXMudXJpICYmIGRhdGEgJiYgZGF0YS5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlU2VsZWN0aW9ucyh0aGlzLnNlbGVjdGVkVmFsdWVzLCBkYXRhKTtcclxuICAgICAgICAgICAgICAgIC8vIFRGUyA1NzQzNjVcclxuICAgICAgICAgICAgICAgIGxldCB0eHQgPSB0aGlzLmNvbWJvU2VydmljZS5nZXRWYWx1ZSh0aGlzLnRleHRGaWVsZCk7XHJcbiAgICAgICAgICAgICAgICB0eHQgPSB0eHQgPyB0eHQgOiB0aGlzLm5vc2VhcmNoID8gdGhpcy5kaXNwbGF5VGV4dDogJyc7XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIHRoaXMuZGlzcGxheVRleHQgPSB0eHQ7XHJcbiAgICAgICAgICAgICAgICB0aGlzWydvcmlnaW5hbFRleHQnXSA9IHRoaXMuZGlzcGxheVRleHQ7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmICh0aGlzLl9zZWFyY2hLZXlXb3JkcyAmJiBkYXRhICYmIGRhdGEubGVuZ3RoICYmICF0aGlzLm11bHRpU2VsZWN0KSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5kaXNwbGF5VHlwZSA9PT0gJ0xPT0tVUExJU1QnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdGFibGVDbXBSZWYuc2VsZWN0aW9ucyA9IGRhdGFbMF07XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdGFibGVDbXBSZWYuY2QuZGV0ZWN0Q2hhbmdlcygpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLmRpc3BsYXlUeXBlID09PSAnTE9PS1VQVFJFRUxJU1QnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gdGhpcy50cmVlQ21wUmVmLnNlbGVjdE5vZGUoKVxyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG5vZGVzID0gdGhpcy5jb21ib1NlcnZpY2UuY2hlY2tOb2RlQ2FuQmVTZWxlY3QoZGF0YS5pdGVtcywgZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbn1cclxuIl19
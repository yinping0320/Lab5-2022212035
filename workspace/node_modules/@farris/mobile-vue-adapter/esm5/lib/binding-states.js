/**
 * @fileoverview added by tsickle
 * Generated from: lib/binding-states.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { recompute } from './recompute';
/**
 * 绑定状态
 */
var /**
 * 绑定状态
 */
BindingStates = /** @class */ (function () {
    /**
     * 构造函数
     * @param viewModelContext ViewModel上下文
     */
    function BindingStates(vueInstance) {
        this.vueInstance = vueInstance;
        /** @type {?} */
        var viewModel = (/** @type {?} */ (this.vueInstance.$getViewModel()));
        this.viewModelContext = viewModel.context;
        this.subscriptionsMap = new Map();
    }
    /**
     * 映射实体列表数据
     */
    /**
     * 映射实体列表数据
     * @return {?}
     */
    BindingStates.prototype.getEntityListData = /**
     * 映射实体列表数据
     * @return {?}
     */
    function () {
        var _this = this;
        /** @type {?} */
        var stateName = 'entityListData';
        if (this.subscriptionsMap.has(stateName) === false) {
            /** @type {?} */
            var subscription = this.viewModelContext.bindingData.changes.subscribe((/**
             * @param {?} change
             * @return {?}
             */
            function (change) {
                recompute(_this.vueInstance, stateName);
            }));
            this.subscriptionsMap.set(stateName, subscription);
        }
        return this.viewModelContext.bindingData.getList().toJSON();
    };
    /**
     * 映射当前实体数据
     */
    /**
     * 映射当前实体数据
     * @return {?}
     */
    BindingStates.prototype.getCurrentEntityData = /**
     * 映射当前实体数据
     * @return {?}
     */
    function () {
        var _this = this;
        /** @type {?} */
        var stateName = 'currentEntityData';
        if (this.subscriptionsMap.has(stateName) === false) {
            /** @type {?} */
            var subscription = this.viewModelContext.bindingData.changes.subscribe((/**
             * @param {?} change
             * @return {?}
             */
            function (change) {
                recompute(_this.vueInstance, stateName);
            }));
            this.subscriptionsMap.set(stateName, subscription);
        }
        return this.viewModelContext.bindingData.getObject().toJSON();
    };
    /**
     * 映射UIState数据
     */
    /**
     * 映射UIState数据
     * @return {?}
     */
    BindingStates.prototype.getUIState = /**
     * 映射UIState数据
     * @return {?}
     */
    function () {
        var _this = this;
        /** @type {?} */
        var stateName = 'uiState';
        if (this.subscriptionsMap.has(stateName) === false) {
            /** @type {?} */
            var subscription = this.viewModelContext.uiState.changes.subscribe((/**
             * @return {?}
             */
            function () {
                recompute(_this.vueInstance, stateName);
            }));
            this.subscriptionsMap.set(stateName, subscription);
        }
        return this.viewModelContext.uiState;
    };
    /**
     * 映射表单
     */
    /**
     * 映射表单
     * @return {?}
     */
    BindingStates.prototype.getForm = /**
     * 映射表单
     * @return {?}
     */
    function () {
        var _this = this;
        /** @type {?} */
        var stateName = 'form';
        if (this.subscriptionsMap.has(stateName) === false) {
            /** @type {?} */
            var subscription = this.viewModelContext.bindingData.changes.subscribe((/**
             * @param {?} change
             * @return {?}
             */
            function (change) {
                if (change && change.type === "ValueChanged") {
                    _this.viewModelContext.form.getFieldErrorByPath(change.path);
                }
                recompute(_this.vueInstance, stateName);
            }));
            /** @type {?} */
            var subscriptionV = this.viewModelContext.form.changes.subscribe((/**
             * @param {?} data
             * @return {?}
             */
            function (data) {
                if (data && data.type === 'validateFieldsFinished') {
                    recompute(_this.vueInstance, stateName);
                }
                else if (data && data.type === 'singleHanded') {
                    /** @type {?} */
                    var index = _this.vueInstance.$children.findIndex((/**
                     * @param {?} item
                     * @return {?}
                     */
                    function (item) { return item.$attrs.id === "form_" + data.value; }));
                    _this.vueInstance.$children[index].$forceUpdate();
                }
            }));
            this.subscriptionsMap.set(stateName, subscription);
            this.subscriptionsMap.set(stateName + 'V', subscriptionV);
        }
        return this.vueInstance.$getViewModel().form;
    };
    /**
     * 映射状态机
     */
    /**
     * 映射状态机
     * @return {?}
     */
    BindingStates.prototype.getStateMachine = /**
     * 映射状态机
     * @return {?}
     */
    function () {
        var _this = this;
        /** @type {?} */
        var stateName = 'stateMachine';
        if (this.subscriptionsMap.has(stateName) === false) {
            /** @type {?} */
            var subscription = this.viewModelContext.stateMachine.stateChange.subscribe((/**
             * @param {?} change
             * @return {?}
             */
            function (change) {
                recompute(_this.vueInstance, stateName);
            }));
            this.subscriptionsMap.set(stateName, subscription);
        }
        return this.viewModelContext.stateMachine.renderStates;
    };
    return BindingStates;
}());
if (false) {
    /**
     * Vue实例
     * @type {?}
     * @private
     */
    BindingStates.prototype.vueInstance;
    /**
     * Vue实例的ViewModelContext
     * @type {?}
     * @private
     */
    BindingStates.prototype.viewModelContext;
    /**
     * 订阅集合
     * @type {?}
     * @private
     */
    BindingStates.prototype.subscriptionsMap;
}
export { BindingStates };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmluZGluZy1zdGF0ZXMuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL21vYmlsZS12dWUtYWRhcHRlci8iLCJzb3VyY2VzIjpbImxpYi9iaW5kaW5nLXN0YXRlcy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUVBLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxhQUFhLENBQUM7Ozs7QUFLeEM7Ozs7SUFpQkU7OztPQUdHO0lBQ0gsdUJBQVksV0FBZ0I7UUFDMUIsSUFBSSxDQUFDLFdBQVcsR0FBRyxXQUFXLENBQUM7O1lBQ3pCLFNBQVMsR0FBRyxtQkFBQSxJQUFJLENBQUMsV0FBVyxDQUFDLGFBQWEsRUFBRSxFQUFhO1FBQy9ELElBQUksQ0FBQyxnQkFBZ0IsR0FBRyxTQUFTLENBQUMsT0FBTyxDQUFDO1FBQzFDLElBQUksQ0FBQyxnQkFBZ0IsR0FBRyxJQUFJLEdBQUcsRUFBd0IsQ0FBQztJQUMxRCxDQUFDO0lBRUQ7O09BRUc7Ozs7O0lBQ0kseUNBQWlCOzs7O0lBQXhCO1FBQUEsaUJBU0M7O1lBUk8sU0FBUyxHQUFHLGdCQUFnQjtRQUNsQyxJQUFJLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxHQUFHLENBQUMsU0FBUyxDQUFDLEtBQUssS0FBSyxFQUFFOztnQkFDNUMsWUFBWSxHQUFHLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxXQUFXLENBQUMsT0FBTyxDQUFDLFNBQVM7Ozs7WUFBQyxVQUFDLE1BQWM7Z0JBQ3RGLFNBQVMsQ0FBQyxLQUFJLENBQUMsV0FBVyxFQUFFLFNBQVMsQ0FBQyxDQUFDO1lBQ3pDLENBQUMsRUFBQztZQUNGLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxHQUFHLENBQUMsU0FBUyxFQUFFLFlBQVksQ0FBQyxDQUFDO1NBQ3BEO1FBQ0QsT0FBTyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsV0FBVyxDQUFDLE9BQU8sRUFBRSxDQUFDLE1BQU0sRUFBRSxDQUFDO0lBQzlELENBQUM7SUFFRDs7T0FFRzs7Ozs7SUFDSSw0Q0FB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QUFnQixDQUFDLEdBQUcsQ0FBQyxTQUFTLEdBQUcsR0FBRyxFQUFFLGFBQWEsQ0FBQyxDQUFDO1NBQzNEO1FBQ0QsT0FBTyxJQUFJLENBQUMsV0FBVyxDQUFDLGFBQWEsRUFBRSxDQUFDLElBQUksQ0FBQztJQUMvQyxDQUFDO0lBRUQ7O09BRUc7Ozs7O0lBQ0ksdUNBQWU7Ozs7SUFBdEI7UUFBQSxpQkFVQzs7WUFUTyxTQUFTLEdBQUcsY0FBYztRQUNoQyxJQUFJLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxHQUFHLENBQUMsU0FBUyxDQUFDLEtBQUssS0FBSyxFQUFFOztnQkFDNUMsWUFBWSxHQUFHLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxZQUFZLENBQUMsV0FBVyxDQUFDLFNBQVM7Ozs7WUFBQyxVQUFDLE1BQVc7Z0JBQ3hGLFNBQVMsQ0FBQyxLQUFJLENBQUMsV0FBVyxFQUFFLFNBQVMsQ0FBQyxDQUFDO1lBQ3pDLENBQUMsRUFBQztZQUNGLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxHQUFHLENBQUMsU0FBUyxFQUFFLFlBQVksQ0FBQyxDQUFDO1NBQ3BEO1FBRUQsT0FBTyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsWUFBWSxDQUFDLFlBQVksQ0FBQztJQUN6RCxDQUFDO0lBQ0gsb0JBQUM7QUFBRCxDQUFDLEFBOUdELElBOEdDOzs7Ozs7O0lBekdDLG9DQUF5Qjs7Ozs7O0lBS3pCLHlDQUEyQzs7Ozs7O0lBSzNDLHlDQUFvRDs7QUFpR3RELE9BQU8sRUFBRSxhQUFhLEVBQUUsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFN1YnNjcmlwdGlvbiB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQgeyBWaWV3TW9kZWwsIFZpZXdNb2RlbENvbnRleHQsIENoYW5nZSB9IGZyb20gJ0BmYXJyaXMvbW9iaWxlLWRldmtpdCc7XHJcbmltcG9ydCB7IHJlY29tcHV0ZSB9IGZyb20gJy4vcmVjb21wdXRlJztcclxuXHJcbi8qKlxyXG4gKiDnu5HlrprnirbmgIFcclxuICovXHJcbmNsYXNzIEJpbmRpbmdTdGF0ZXMge1xyXG5cclxuICAvKipcclxuICAgKiBWdWXlrp7kvotcclxuICAgKi9cclxuICBwcml2YXRlIHZ1ZUluc3RhbmNlOiBhbnk7XHJcblxyXG4gIC8qKlxyXG4gICAqIFZ1ZeWunuS+i+eahFZpZXdNb2RlbENvbnRleHRcclxuICAgKi9cclxuICBwcml2YXRlIHZpZXdNb2RlbENvbnRleHQ6IFZpZXdNb2RlbENvbnRleHQ7XHJcblxyXG4gIC8qKlxyXG4gICAqIOiuoumYhembhuWQiFxyXG4gICAqL1xyXG4gIHByaXZhdGUgc3Vic2NyaXB0aW9uc01hcDogTWFwPHN0cmluZywgU3Vic2NyaXB0aW9uPjtcclxuXHJcbiAgLyoqXHJcbiAgICog5p6E6YCg5Ye95pWwXHJcbiAgICogQHBhcmFtIHZpZXdNb2RlbENvbnRleHQgVmlld01vZGVs5LiK5LiL5paHXHJcbiAgICovXHJcbiAgY29uc3RydWN0b3IodnVlSW5zdGFuY2U6IGFueSkge1xyXG4gICAgdGhpcy52dWVJbnN0YW5jZSA9IHZ1ZUluc3RhbmNlO1xyXG4gICAgY29uc3Qgdmlld01vZGVsID0gdGhpcy52dWVJbnN0YW5jZS4kZ2V0Vmlld01vZGVsKCkgYXMgVmlld01vZGVsO1xyXG4gICAgdGhpcy52aWV3TW9kZWxDb250ZXh0ID0gdmlld01vZGVsLmNvbnRleHQ7XHJcbiAgICB0aGlzLnN1YnNjcmlwdGlvbnNNYXAgPSBuZXcgTWFwPHN0cmluZywgU3Vic2NyaXB0aW9uPigpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5pig5bCE5a6e5L2T5YiX6KGo5pWw5o2uXHJcbiAgICovXHJcbiAgcHVibGljIGdldEVudGl0eUxpc3REYXRhKCkge1xyXG4gICAgY29uc3Qgc3RhdGVOYW1lID0gJ2VudGl0eUxpc3REYXRhJztcclxuICAgIGlmICh0aGlzLnN1YnNjcmlwdGlvbnNNYXAuaGFzKHN0YXRlTmFtZSkgPT09IGZhbHNlKSB7XHJcbiAgICAgIGNvbnN0IHN1YnNjcmlwdGlvbiA9IHRoaXMudmlld01vZGVsQ29udGV4dC5iaW5kaW5nRGF0YS5jaGFuZ2VzLnN1YnNjcmliZSgoY2hhbmdlOiBDaGFuZ2UpID0+IHtcclxuICAgICAgICByZWNvbXB1dGUodGhpcy52dWVJbnN0YW5jZSwgc3RhdGVOYW1lKTtcclxuICAgICAgfSk7XHJcbiAgICAgIHRoaXMuc3Vic2NyaXB0aW9uc01hcC5zZXQoc3RhdGVOYW1lLCBzdWJzY3JpcHRpb24pO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHRoaXMudmlld01vZGVsQ29udGV4dC5iaW5kaW5nRGF0YS5nZXRMaXN0KCkudG9KU09OKCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDmmKDlsITlvZPliY3lrp7kvZPmlbDmja5cclxuICAgKi9cclxuICBwdWJsaWMgZ2V0Q3VycmVudEVudGl0eURhdGEoKSB7XHJcbiAgICBjb25zdCBzdGF0ZU5hbWUgPSAnY3VycmVudEVudGl0eURhdGEnO1xyXG4gICAgaWYgKHRoaXMuc3Vic2NyaXB0aW9uc01hcC5oYXMoc3RhdGVOYW1lKSA9PT0gZmFsc2UpIHtcclxuICAgICAgY29uc3Qgc3Vic2NyaXB0aW9uID0gdGhpcy52aWV3TW9kZWxDb250ZXh0LmJpbmRpbmdEYXRhLmNoYW5nZXMuc3Vic2NyaWJlKChjaGFuZ2U6IENoYW5nZSkgPT4ge1xyXG4gICAgICAgIHJlY29tcHV0ZSh0aGlzLnZ1ZUluc3RhbmNlLCBzdGF0ZU5hbWUpO1xyXG4gICAgICB9KTtcclxuICAgICAgdGhpcy5zdWJzY3JpcHRpb25zTWFwLnNldChzdGF0ZU5hbWUsIHN1YnNjcmlwdGlvbik7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdGhpcy52aWV3TW9kZWxDb250ZXh0LmJpbmRpbmdEYXRhLmdldE9iamVjdCgpLnRvSlNPTigpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5pig5bCEVUlTdGF0ZeaVsOaNrlxyXG4gICAqL1xyXG4gIHB1YmxpYyBnZXRVSVN0YXRlKCkge1xyXG4gICAgY29uc3Qgc3RhdGVOYW1lID0gJ3VpU3RhdGUnO1xyXG4gICAgaWYgKHRoaXMuc3Vic2NyaXB0aW9uc01hcC5oYXMoc3RhdGVOYW1lKSA9PT0gZmFsc2UpIHtcclxuICAgICAgY29uc3Qgc3Vic2NyaXB0aW9uID0gdGhpcy52aWV3TW9kZWxDb250ZXh0LnVpU3RhdGUuY2hhbmdlcy5zdWJzY3JpYmUoKCkgPT4ge1xyXG4gICAgICAgIHJlY29tcHV0ZSh0aGlzLnZ1ZUluc3RhbmNlLCBzdGF0ZU5hbWUpO1xyXG4gICAgICB9KTtcclxuICAgICAgdGhpcy5zdWJzY3JpcHRpb25zTWFwLnNldChzdGF0ZU5hbWUsIHN1YnNjcmlwdGlvbik7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdGhpcy52aWV3TW9kZWxDb250ZXh0LnVpU3RhdGU7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDmmKDlsITooajljZVcclxuICAgKi9cclxuICBwdWJsaWMgZ2V0Rm9ybSgpIHtcclxuICAgIGNvbnN0IHN0YXRlTmFtZSA9ICdmb3JtJztcclxuICAgIGlmICh0aGlzLnN1YnNjcmlwdGlvbnNNYXAuaGFzKHN0YXRlTmFtZSkgPT09IGZhbHNlKSB7XHJcbiAgICAgIGNvbnN0IHN1YnNjcmlwdGlvbiA9IHRoaXMudmlld01vZGVsQ29udGV4dC5iaW5kaW5nRGF0YS5jaGFuZ2VzLnN1YnNjcmliZSgoY2hhbmdlOiBDaGFuZ2UpID0+IHtcclxuICAgICAgICBpZiAoY2hhbmdlICYmIGNoYW5nZS50eXBlID09PSBcIlZhbHVlQ2hhbmdlZFwiKSB7XHJcbiAgICAgICAgICB0aGlzLnZpZXdNb2RlbENvbnRleHQuZm9ybS5nZXRGaWVsZEVycm9yQnlQYXRoKGNoYW5nZS5wYXRoKVxyXG4gICAgICAgIH1cclxuICAgICAgICByZWNvbXB1dGUodGhpcy52dWVJbnN0YW5jZSwgc3RhdGVOYW1lKTtcclxuICAgICAgfSk7XHJcbiAgICAgIGNvbnN0IHN1YnNjcmlwdGlvblYgPSB0aGlzLnZpZXdNb2RlbENvbnRleHQuZm9ybS5jaGFuZ2VzLnN1YnNjcmliZSgoZGF0YSkgPT4ge1xyXG4gICAgICAgIGlmIChkYXRhICYmIGRhdGEudHlwZSA9PT0gJ3ZhbGlkYXRlRmllbGRzRmluaXNoZWQnKSB7XHJcbiAgICAgICAgICByZWNvbXB1dGUodGhpcy52dWVJbnN0YW5jZSwgc3RhdGVOYW1lKTtcclxuICAgICAgICB9IGVsc2UgaWYgKGRhdGEgJiYgZGF0YS50eXBlID09PSAnc2luZ2xlSGFuZGVkJykge1xyXG4gICAgICAgICAgY29uc3QgaW5kZXggPSB0aGlzLnZ1ZUluc3RhbmNlLiRjaGlsZHJlbi5maW5kSW5kZXgoKGl0ZW0pID0+IHsgcmV0dXJuIGl0ZW0uJGF0dHJzLmlkID09PSBgZm9ybV8ke2RhdGEudmFsdWV9YCB9KVxyXG4gICAgICAgICAgdGhpcy52dWVJbnN0YW5jZS4kY2hpbGRyZW5baW5kZXhdLiRmb3JjZVVwZGF0ZSgpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcbiAgICAgIHRoaXMuc3Vic2NyaXB0aW9uc01hcC5zZXQoc3RhdGVOYW1lLCBzdWJzY3JpcHRpb24pO1xyXG4gICAgICB0aGlzLnN1YnNjcmlwdGlvbnNNYXAuc2V0KHN0YXRlTmFtZSArICdWJywgc3Vic2NyaXB0aW9uVik7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdGhpcy52dWVJbnN0YW5jZS4kZ2V0Vmlld01vZGVsKCkuZm9ybTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOaYoOWwhOeKtuaAgeaculxyXG4gICAqL1xyXG4gIHB1YmxpYyBnZXRTdGF0ZU1hY2hpbmUoKSB7XHJcbiAgICBjb25zdCBzdGF0ZU5hbWUgPSAnc3RhdGVNYWNoaW5lJztcclxuICAgIGlmICh0aGlzLnN1YnNjcmlwdGlvbnNNYXAuaGFzKHN0YXRlTmFtZSkgPT09IGZhbHNlKSB7XHJcbiAgICAgIGNvbnN0IHN1YnNjcmlwdGlvbiA9IHRoaXMudmlld01vZGVsQ29udGV4dC5zdGF0ZU1hY2hpbmUuc3RhdGVDaGFuZ2Uuc3Vic2NyaWJlKChjaGFuZ2U6IGFueSkgPT4ge1xyXG4gICAgICAgIHJlY29tcHV0ZSh0aGlzLnZ1ZUluc3RhbmNlLCBzdGF0ZU5hbWUpO1xyXG4gICAgICB9KTtcclxuICAgICAgdGhpcy5zdWJzY3JpcHRpb25zTWFwLnNldChzdGF0ZU5hbWUsIHN1YnNjcmlwdGlvbik7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHRoaXMudmlld01vZGVsQ29udGV4dC5zdGF0ZU1hY2hpbmUucmVuZGVyU3RhdGVzO1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IHsgQmluZGluZ1N0YXRlcyB9O1xyXG4iXX0=
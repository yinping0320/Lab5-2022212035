/**
 * @fileoverview added by tsickle
 * Generated from: lib/devkit.plugin.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { App } from '@farris/mobile-devkit';
import { BindingStates } from './binding-states';
import { ComponentExtenderManager } from './component-extenders/index';
import { EventUtil } from './utils/index';
import formatUtils from './utils/format-uitl';
import { RouterService, HistoryBackService } from '@farris/mobile-command-services';
var ɵ0 = /**
 * @param {?} app
 * @param {?} options
 * @return {?}
 */
function (app, options) {
    /**
     * 注册事件
     * @todo：暂时强制绑定，暂时无法根据特性灵活区分
     */
    app.config.globalProperties.$on = (/**
     * @param {?} eventName
     * @param {?} eventHandler
     * @return {?}
     */
    function (eventName, eventHandler) {
        /** @type {?} */
        var vnodeProps = this._.vnode.props;
        /** @type {?} */
        var eventHandlerKey = EventUtil.toHandlerKey(eventName);
        /** @type {?} */
        var oldEventHandler = vnodeProps[eventHandlerKey];
        if (oldEventHandler) {
            vnodeProps[eventHandlerKey] = (/**
             * @param {?} $event
             * @return {?}
             */
            function ($event) {
                eventHandler($event);
                oldEventHandler($event);
            });
        }
        else {
            vnodeProps[eventHandlerKey] = eventHandler;
        }
    });
    /**
     * 清空事件注册
     * @todo：暂时强制清空
     */
    app.config.globalProperties.$off = (/**
     * @param {?} eventName
     * @return {?}
     */
    function (eventName) {
        /** @type {?} */
        var vnodeProps = this._.vnode.props;
        /** @type {?} */
        var eventHandlerKey = EventUtil.toHandlerKey(eventName);
        vnodeProps[eventHandlerKey] = null;
    });
    /**
     * 组件的App实例
     */
    app.config.globalProperties.$app = null;
    /**
     * 组件的ViewModel实例
     */
    app.config.globalProperties.$viewModel = null;
    /**
     * 绑定状态
     */
    app.config.globalProperties.$bindingStates = null;
    /**
     * 绑定状态
     */
    app.config.globalProperties.$componentExtenderManager = null;
    /**
     * 组件App工厂方法
     */
    app.config.globalProperties.$createApp = (/**
     * @param {?} appOptions
     * @return {?}
     */
    function (appOptions) {
        if (this.$app) {
            throw new Error('App已经存在');
        }
        /** @type {?} */
        var historyBackService = new HistoryBackService();
        historyBackService.init();
        historyBackService.proxyBack();
        this.$app = new App(appOptions);
        /**
         * @param {?} event
         * @return {?}
         */
        function receiveMessage(event) {
            /** @type {?} */
            var commandOptions = this.$app.context.injector.get('DECLARATIONS_TOKEN');
            /** @type {?} */
            var messageData = JSON.parse(event.data);
            /** @type {?} */
            var commandName = messageData.data.command;
            /** @type {?} */
            var command = commandOptions.commands[commandName];
            /** @type {?} */
            var origin = event.origin;
            /** @type {?} */
            var source = event.source;
            /** @type {?} */
            var viewModelContext = this.$app.context.viewModelContextManager.getContextById(command.viewModelId);
            if (!!viewModelContext) {
                /** @type {?} */
                var methodResult$ = viewModelContext.viewModel[command.command]();
                methodResult$.pipe((/**
                 * @return {?}
                 */
                function () { }), (/**
                 * @return {?}
                 */
                function () { }), (/**
                 * @return {?}
                 */
                function () {
                    window.parent && window.parent.postMessage('success', event.origin);
                }));
            }
        }
        if (!window['IsDddedMessageEventListener']) {
            window.addEventListener("message", receiveMessage.bind(this), false);
            window['IsDddedMessageEventListener'] = true;
        }
    });
    /**
     * 获取AppContext
     */
    app.config.globalProperties.$getApp = (/**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var app = this.$app;
        /** @type {?} */
        var currentCmp = this;
        while (!app && currentCmp.$parent) {
            currentCmp = currentCmp.$parent;
            app = currentCmp.$app;
        }
        return app;
    });
    /**
     * 组件ViewModel工厂方法
     */
    app.config.globalProperties.$createViewModel = (/**
     * @param {?} viewModelOptions
     * @return {?}
     */
    function (viewModelOptions) {
        this.$app = this.$getApp();
        if (!this.$app) {
            throw new Error('请先创建App');
        }
        // 如果viewModel已经存在，则使用已有的
        /** @type {?} */
        var viewModelId = viewModelOptions.id;
        if (viewModelId) {
            /** @type {?} */
            var existedViewModelContext = this.$app.context.viewModelContextManager.getContextById(viewModelId);
            if (existedViewModelContext) {
                this.$viewModel = existedViewModelContext.viewModel;
            }
        }
        // 如果viewModel不存在，则创建新的viewModel，并建立父子关系
        if (!this.$viewModel) {
            /** @type {?} */
            var parentViewModel = this.$getViewModel();
            if (!viewModelOptions.parent) {
                viewModelOptions.parent = parentViewModel;
            }
            this.$viewModel = this.$app.createViewModel(viewModelOptions);
        }
        // 设置绑定状态
        this.$bindingStates = new BindingStates(this);
        // 映射路由状态
        /** @type {?} */
        var routerService = this.$viewModel.injector.get(RouterService);
        routerService.mappingToUIState();
        // 根据路由参数清理卡片缓存数据
        if (this.$viewModel && this.$viewModel.uiState && this.$viewModel.uiState.routerState && this.$viewModel.uiState.routerState.queryParams && this.$viewModel.uiState.routerState.queryParams.clearCachedDataForCard) {
            //清一下bingdingdate上的东西
            this.$viewModel.context.bindingData.getList().currentId = null;
        }
        // 根据路由参数清理列表缓存数据
        if (this.$viewModel && this.$viewModel.uiState && this.$viewModel.uiState.routerState && this.$viewModel.uiState.routerState.queryParams && this.$viewModel.uiState.routerState.queryParams.clearCachedDataForList) {
            //清一下bingdingdate上的东西
            this.$viewModel.repository.entityCollection.clear();
        }
    });
    /**
     * 获取ViewModel
     */
    app.config.globalProperties.$getViewModel = (/**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var currentCmp = this;
        /** @type {?} */
        var viewModel = currentCmp.$viewModel;
        while (!viewModel && currentCmp.$parent) {
            currentCmp = currentCmp.$parent;
            viewModel = currentCmp.$viewModel;
        }
        return viewModel;
    });
    /**
     * 初始化组件扩展管理
     */
    app.config.globalProperties.$initComponentExtenderManager = (/**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var viewModel = this.$getViewModel();
        this.$componentExtenderManager = new ComponentExtenderManager(viewModel.context);
    });
    /**
     * 获取组件扩展管理器
     */
    app.config.globalProperties.$getComponentExtenderManager = (/**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var currentCmp = this;
        /** @type {?} */
        var extenderManager = currentCmp.$componentExtenderManager;
        while (!extenderManager && currentCmp.$parent) {
            currentCmp = currentCmp.$parent;
            extenderManager = currentCmp.$componentExtenderManager;
        }
        return extenderManager;
    });
    app.config.globalProperties.$bindComponentExtenders = (/**
     * @param {?} refs
     * @return {?}
     */
    function (refs) {
        var _this = this;
        if (!this.$refs) {
            return;
        }
        /** @type {?} */
        var componentInstances = Object.values(this.$refs);
        componentInstances.forEach((/**
         * @param {?} componentInstance
         * @return {?}
         */
        function (componentInstance) {
            /** @type {?} */
            var componentType = componentInstance._.type.name;
            _this.$bindComponentExtender(componentInstance, componentType);
        }));
    });
    /**
     * 绑定组件扩展器
     */
    app.config.globalProperties.$bindComponentExtender = (/**
     * @param {?} componentInstance
     * @param {?} componentType
     * @return {?}
     */
    function (componentInstance, componentType) {
        if (componentInstance.$__component_extended === true) {
            return;
        }
        /** @type {?} */
        var extenderManager = this.$getComponentExtenderManager();
        /** @type {?} */
        var extender = extenderManager.getExtender(componentInstance, componentType);
        if (extender) {
            extender.extend();
            componentInstance.$__component_extended === true;
        }
    });
    /**
     * 清理所有组件扩展器
     * @param refs
     */
    app.config.globalProperties.$unbindComponentExtenders = (/**
     * @param {?} refs
     * @return {?}
     */
    function (refs) {
        var _this = this;
        if (!this.$refs) {
            return;
        }
        /** @type {?} */
        var componentInstances = Object.values(this.$refs);
        componentInstances.forEach((/**
         * @param {?} componentInstance
         * @return {?}
         */
        function (componentInstance) {
            _this.$unbindComponentExtender(componentInstance);
        }));
    });
    /**
     * 清理组件扩展器状态
     */
    app.config.globalProperties.$unbindComponentExtender = (/**
     * @param {?} componentInstance
     * @return {?}
     */
    function (componentInstance) {
        /** @type {?} */
        var extenderManager = this.$getComponentExtenderManager();
        /** @type {?} */
        var extender = extenderManager.getExtender(componentInstance);
        if (extender) {
            extender.dispose();
        }
    });
    app.config.globalProperties.$initPage = (/**
     * @param {?} viewModelOptions
     * @return {?}
     */
    function (viewModelOptions) {
        this.$createViewModel(viewModelOptions);
        this.$initComponentExtenderManager();
        this.$viewModel.uiState.pageTitle && this.$changeDocumentTitle(this.$viewModel.uiState.pageTitle);
        this.$initUistate();
    });
    app.config.globalProperties.$changeDocumentTitle = (/**
     * @param {?} title
     * @return {?}
     */
    function (title) {
        document.title = title || document.title;
    });
    /**
     * VUE上格式化工具类
     */
    app.config.globalProperties.$formatUtils = formatUtils;
    /**
     * 初始化uistate上记录的状态
     */
    app.config.globalProperties.$initUistate = (/**
     * @return {?}
     */
    function () {
        this.$viewModel.uiState.listaviewState = { refreshLoading: false, loadMoreLoading: false, loadMoreFinished: false };
        this.$viewModel.uiState.searchState = { keyword: '' };
        this.$viewModel.uiState.filterState = { filters: '', filterData: '' };
        this.$viewModel.uiState.tabState = { currentTab: '' };
    });
};
/** @type {?} */
var DevkitPlugin = {
    install: (ɵ0)
};
export { DevkitPlugin };
export { ɵ0 };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGV2a2l0LnBsdWdpbi5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvbW9iaWxlLXZ1ZS1hZGFwdGVyLyIsInNvdXJjZXMiOlsibGliL2RldmtpdC5wbHVnaW4udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQUUsR0FBRyxFQUFFLE1BQU0sdUJBQXVCLENBQUM7QUFDNUMsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLGtCQUFrQixDQUFDO0FBQ2pELE9BQU8sRUFBRSx3QkFBd0IsRUFBRSxNQUFNLDZCQUE2QixDQUFDO0FBQ3ZFLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDMUMsT0FBTyxXQUFXLE1BQU0scUJBQXFCLENBQUE7QUFDN0MsT0FBTyxFQUFFLGFBQWEsRUFBRSxrQkFBa0IsRUFBRSxNQUFNLGlDQUFpQyxDQUFDOzs7Ozs7QUFLekUsVUFBVSxHQUFRLEVBQUUsT0FBWTtJQUV2Qzs7O09BR0c7SUFDSCxHQUFHLENBQUMsTUFBTSxDQUFDLGdCQUFnQixDQUFDLEdBQUc7Ozs7O0lBQUcsVUFBVSxTQUFpQixFQUFFLFlBQWlCOztZQUN4RSxVQUFVLEdBQUcsSUFBSSxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsS0FBSzs7WUFDL0IsZUFBZSxHQUFHLFNBQVMsQ0FBQyxZQUFZLENBQUMsU0FBUyxDQUFDOztZQUNuRCxlQUFlLEdBQUcsVUFBVSxDQUFDLGVBQWUsQ0FBQztRQUNuRCxJQUFJLGVBQWUsRUFBRTtZQUNuQixVQUFVLENBQUMsZUFBZSxDQUFDOzs7O1lBQUcsVUFBVSxNQUFNO2dCQUM1QyxZQUFZLENBQUMsTUFBTSxDQUFDLENBQUM7Z0JBQ3JCLGVBQWUsQ0FBQyxNQUFNLENBQUMsQ0FBQztZQUMxQixDQUFDLENBQUEsQ0FBQTtTQUNGO2FBQU07WUFDTCxVQUFVLENBQUMsZUFBZSxDQUFDLEdBQUcsWUFBWSxDQUFDO1NBQzVDO0lBQ0gsQ0FBQyxDQUFBLENBQUE7SUFFRDs7O09BR0c7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LENBQUM7UUFDdEQsSUFBSSxDQUFDLFVBQVUsQ0FBQyxPQUFPLENBQUMsV0FBVyxHQUFHLEVBQUUsT0FBTyxFQUFFLEVBQUUsRUFBRSxVQUFVLEVBQUUsRUFBRSxFQUFFLENBQUM7UUFDdEUsSUFBSSxDQUFDLFVBQVUsQ0FBQyxPQUFPLENBQUMsUUFBUSxHQUFHLEVBQUUsVUFBVSxFQUFFLEVBQUUsRUFBRSxDQUFDO0lBQ3hELENBQUMsQ0FBQSxDQUFDO0FBRUosQ0FBQzs7SUE1UUcsWUFBWSxHQUFHO0lBRW5CLE9BQU8sTUEwUU47Q0FDRjtBQUVELE9BQU8sRUFBRSxZQUFZLEVBQUUsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFwcCB9IGZyb20gJ0BmYXJyaXMvbW9iaWxlLWRldmtpdCc7XHJcbmltcG9ydCB7IEJpbmRpbmdTdGF0ZXMgfSBmcm9tICcuL2JpbmRpbmctc3RhdGVzJztcclxuaW1wb3J0IHsgQ29tcG9uZW50RXh0ZW5kZXJNYW5hZ2VyIH0gZnJvbSAnLi9jb21wb25lbnQtZXh0ZW5kZXJzL2luZGV4JztcclxuaW1wb3J0IHsgRXZlbnRVdGlsIH0gZnJvbSAnLi91dGlscy9pbmRleCc7XHJcbmltcG9ydCBmb3JtYXRVdGlscyBmcm9tICcuL3V0aWxzL2Zvcm1hdC11aXRsJ1xyXG5pbXBvcnQgeyBSb3V0ZXJTZXJ2aWNlLCBIaXN0b3J5QmFja1NlcnZpY2UgfSBmcm9tICdAZmFycmlzL21vYmlsZS1jb21tYW5kLXNlcnZpY2VzJztcclxuXHJcblxyXG5jb25zdCBEZXZraXRQbHVnaW4gPSB7XHJcblxyXG4gIGluc3RhbGw6IGZ1bmN0aW9uIChhcHA6IGFueSwgb3B0aW9uczogYW55KSB7XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDms6jlhozkuovku7ZcclxuICAgICAqIEB0b2Rv77ya5pqC5pe25by65Yi257uR5a6a77yM5pqC5pe25peg5rOV5qC55o2u54m55oCn54G15rS75Yy65YiGXHJcbiAgICAgKi9cclxuICAgIGFwcC5jb25maWcuZ2xvYmFsUHJvcGVydGllcy4kb24gPSBmdW5jdGlvbiAoZXZlbnROYW1lOiBzdHJpbmcsIGV2ZW50SGFuZGxlcjogYW55KSB7XHJcbiAgICAgIGNvbnN0IHZub2RlUHJvcHMgPSB0aGlzLl8udm5vZGUucHJvcHM7XHJcbiAgICAgIGNvbnN0IGV2ZW50SGFuZGxlcktleSA9IEV2ZW50VXRpbC50b0hhbmRsZXJLZXkoZXZlbnROYW1lKTtcclxuICAgICAgY29uc3Qgb2xkRXZlbnRIYW5kbGVyID0gdm5vZGVQcm9wc1tldmVudEhhbmRsZXJLZXldO1xyXG4gICAgICBpZiAob2xkRXZlbnRIYW5kbGVyKSB7XHJcbiAgICAgICAgdm5vZGVQcm9wc1tldmVudEhhbmRsZXJLZXldID0gZnVuY3Rpb24gKCRldmVudCkge1xyXG4gICAgICAgICAgZXZlbnRIYW5kbGVyKCRldmVudCk7XHJcbiAgICAgICAgICBvbGRFdmVudEhhbmRsZXIoJGV2ZW50KTtcclxuICAgICAgICB9XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgdm5vZGVQcm9wc1tldmVudEhhbmRsZXJLZXldID0gZXZlbnRIYW5kbGVyO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDmuIXnqbrkuovku7bms6jlhoxcclxuICAgICAqIEB0b2Rv77ya5pqC5pe25by65Yi25riF56m6XHJcbiAgICAgKi9cclxuICAgIGFwcC5jb25maWcuZ2xvYmFsUHJvcGVydGllcy4kb2ZmID0gZnVuY3Rpb24gKGV2ZW50TmFtZTogc3RyaW5nKSB7XHJcbiAgICAgIGNvbnN0IHZub2RlUHJvcHMgPSB0aGlzLl8udm5vZGUucHJvcHM7XHJcbiAgICAgIGNvbnN0IGV2ZW50SGFuZGxlcktleSA9IEV2ZW50VXRpbC50b0hhbmRsZXJLZXkoZXZlbnROYW1lKTtcclxuICAgICAgdm5vZGVQcm9wc1tldmVudEhhbmRsZXJLZXldID0gbnVsbDtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOe7hOS7tueahEFwcOWunuS+i1xyXG4gICAgICovXHJcbiAgICBhcHAuY29uZmlnLmdsb2JhbFByb3BlcnRpZXMuJGFwcCA9IG51bGw7XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDnu4Tku7bnmoRWaWV3TW9kZWzlrp7kvotcclxuICAgICAqL1xyXG4gICAgYXBwLmNvbmZpZy5nbG9iYWxQcm9wZXJ0aWVzLiR2aWV3TW9kZWwgPSBudWxsO1xyXG5cclxuICAgIC8qKlxyXG4gICAgICog57uR5a6a54q25oCBXHJcbiAgICAgKi9cclxuICAgIGFwcC5jb25maWcuZ2xvYmFsUHJvcGVydGllcy4kYmluZGluZ1N0YXRlcyA9IG51bGw7XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDnu5HlrprnirbmgIFcclxuICAgICAqL1xyXG4gICAgYXBwLmNvbmZpZy5nbG9iYWxQcm9wZXJ0aWVzLiRjb21wb25lbnRFeHRlbmRlck1hbmFnZXIgPSBudWxsO1xyXG5cclxuICAgIC8qKlxyXG4gICAgICog57uE5Lu2QXBw5bel5Y6C5pa55rOVXHJcbiAgICAgKi9cclxuICAgIGFwcC5jb25maWcuZ2xvYmFsUHJvcGVydGllcy4kY3JlYXRlQXBwID0gZnVuY3Rpb24gKGFwcE9wdGlvbnMpIHtcclxuICAgICAgaWYgKHRoaXMuJGFwcCkge1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcignQXBw5bey57uP5a2Y5ZyoJyk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGNvbnN0IGhpc3RvcnlCYWNrU2VydmljZSA9IG5ldyBIaXN0b3J5QmFja1NlcnZpY2UoKTtcclxuXHJcbiAgICAgIGhpc3RvcnlCYWNrU2VydmljZS5pbml0KCk7XHJcbiAgICAgIFxyXG4gICAgICBoaXN0b3J5QmFja1NlcnZpY2UucHJveHlCYWNrKCk7XHJcblxyXG4gICAgICB0aGlzLiRhcHAgPSBuZXcgQXBwKGFwcE9wdGlvbnMpO1xyXG4gICAgICBmdW5jdGlvbiByZWNlaXZlTWVzc2FnZShldmVudCkge1xyXG4gICAgICAgIGNvbnN0IGNvbW1hbmRPcHRpb25zID0gdGhpcy4kYXBwLmNvbnRleHQuaW5qZWN0b3IuZ2V0KCdERUNMQVJBVElPTlNfVE9LRU4nKTtcclxuICAgICAgICB2YXIgbWVzc2FnZURhdGEgPSBKU09OLnBhcnNlKGV2ZW50LmRhdGEpO1xyXG4gICAgICAgIGNvbnN0IGNvbW1hbmROYW1lID0gbWVzc2FnZURhdGEuZGF0YS5jb21tYW5kO1xyXG4gICAgICAgIGNvbnN0IGNvbW1hbmQgPSBjb21tYW5kT3B0aW9ucy5jb21tYW5kc1tjb21tYW5kTmFtZV07XHJcbiAgICAgICAgdmFyIG9yaWdpbiA9IGV2ZW50Lm9yaWdpbjtcclxuICAgICAgICB2YXIgc291cmNlID0gZXZlbnQuc291cmNlO1xyXG4gICAgICAgIGNvbnN0IHZpZXdNb2RlbENvbnRleHQgPSB0aGlzLiRhcHAuY29udGV4dC52aWV3TW9kZWxDb250ZXh0TWFuYWdlci5nZXRDb250ZXh0QnlJZChjb21tYW5kLnZpZXdNb2RlbElkKVxyXG4gICAgICAgIGlmICghIXZpZXdNb2RlbENvbnRleHQpIHtcclxuICAgICAgICAgIGNvbnN0IG1ldGhvZFJlc3VsdCQgPSB2aWV3TW9kZWxDb250ZXh0LnZpZXdNb2RlbFtjb21tYW5kLmNvbW1hbmRdKCk7XHJcbiAgICAgICAgICBtZXRob2RSZXN1bHQkLnBpcGUoXHJcbiAgICAgICAgICAgICgpID0+IHsgfSxcclxuICAgICAgICAgICAgKCkgPT4geyB9LFxyXG4gICAgICAgICAgICAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgd2luZG93LnBhcmVudCAmJiB3aW5kb3cucGFyZW50LnBvc3RNZXNzYWdlKCdzdWNjZXNzJywgZXZlbnQub3JpZ2luKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgKVxyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgICBpZiAoIXdpbmRvd1snSXNEZGRlZE1lc3NhZ2VFdmVudExpc3RlbmVyJ10pIHtcclxuICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcIm1lc3NhZ2VcIiwgcmVjZWl2ZU1lc3NhZ2UuYmluZCh0aGlzKSwgZmFsc2UpXHJcbiAgICAgICAgd2luZG93WydJc0RkZGVkTWVzc2FnZUV2ZW50TGlzdGVuZXInXSA9IHRydWU7XHJcbiAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDojrflj5ZBcHBDb250ZXh0XHJcbiAgICAgKi9cclxuICAgIGFwcC5jb25maWcuZ2xvYmFsUHJvcGVydGllcy4kZ2V0QXBwID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICBsZXQgYXBwID0gdGhpcy4kYXBwO1xyXG4gICAgICBsZXQgY3VycmVudENtcCA9IHRoaXM7XHJcbiAgICAgIHdoaWxlICghYXBwICYmIGN1cnJlbnRDbXAuJHBhcmVudCkge1xyXG4gICAgICAgIGN1cnJlbnRDbXAgPSBjdXJyZW50Q21wLiRwYXJlbnQ7XHJcbiAgICAgICAgYXBwID0gY3VycmVudENtcC4kYXBwO1xyXG4gICAgICB9XHJcbiAgICAgIHJldHVybiBhcHA7XHJcbiAgICB9O1xyXG5cclxuICAgIC8qKlxyXG4gICAgICog57uE5Lu2Vmlld01vZGVs5bel5Y6C5pa55rOVXHJcbiAgICAgKi9cclxuICAgIGFwcC5jb25maWcuZ2xvYmFsUHJvcGVydGllcy4kY3JlYXRlVmlld01vZGVsID0gZnVuY3Rpb24gKHZpZXdNb2RlbE9wdGlvbnMpIHtcclxuICAgICAgdGhpcy4kYXBwID0gdGhpcy4kZ2V0QXBwKCk7XHJcbiAgICAgIGlmICghdGhpcy4kYXBwKSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCfor7flhYjliJvlu7pBcHAnKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8g5aaC5p6cdmlld01vZGVs5bey57uP5a2Y5Zyo77yM5YiZ5L2/55So5bey5pyJ55qEXHJcbiAgICAgIGNvbnN0IHZpZXdNb2RlbElkID0gdmlld01vZGVsT3B0aW9ucy5pZDtcclxuICAgICAgaWYgKHZpZXdNb2RlbElkKSB7XHJcbiAgICAgICAgY29uc3QgZXhpc3RlZFZpZXdNb2RlbENvbnRleHQgPSB0aGlzLiRhcHAuY29udGV4dC52aWV3TW9kZWxDb250ZXh0TWFuYWdlci5nZXRDb250ZXh0QnlJZCh2aWV3TW9kZWxJZCk7XHJcbiAgICAgICAgaWYgKGV4aXN0ZWRWaWV3TW9kZWxDb250ZXh0KSB7XHJcbiAgICAgICAgICB0aGlzLiR2aWV3TW9kZWwgPSBleGlzdGVkVmlld01vZGVsQ29udGV4dC52aWV3TW9kZWw7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyDlpoLmnpx2aWV3TW9kZWzkuI3lrZjlnKjvvIzliJnliJvlu7rmlrDnmoR2aWV3TW9kZWzvvIzlubblu7rnq4vniLblrZDlhbPns7tcclxuICAgICAgaWYgKCF0aGlzLiR2aWV3TW9kZWwpIHtcclxuICAgICAgICBjb25zdCBwYXJlbnRWaWV3TW9kZWwgPSB0aGlzLiRnZXRWaWV3TW9kZWwoKTtcclxuICAgICAgICBpZiAoIXZpZXdNb2RlbE9wdGlvbnMucGFyZW50KSB7XHJcbiAgICAgICAgICB2aWV3TW9kZWxPcHRpb25zLnBhcmVudCA9IHBhcmVudFZpZXdNb2RlbDtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy4kdmlld01vZGVsID0gdGhpcy4kYXBwLmNyZWF0ZVZpZXdNb2RlbCh2aWV3TW9kZWxPcHRpb25zKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8g6K6+572u57uR5a6a54q25oCBXHJcbiAgICAgIHRoaXMuJGJpbmRpbmdTdGF0ZXMgPSBuZXcgQmluZGluZ1N0YXRlcyh0aGlzKTtcclxuXHJcbiAgICAgIC8vIOaYoOWwhOi3r+eUseeKtuaAgVxyXG4gICAgICBjb25zdCByb3V0ZXJTZXJ2aWNlID0gdGhpcy4kdmlld01vZGVsLmluamVjdG9yLmdldChSb3V0ZXJTZXJ2aWNlKTtcclxuICAgICAgcm91dGVyU2VydmljZS5tYXBwaW5nVG9VSVN0YXRlKCk7XHJcblxyXG4gICAgICAvLyDmoLnmja7ot6/nlLHlj4LmlbDmuIXnkIbljaHniYfnvJPlrZjmlbDmja5cclxuICAgICAgaWYgKHRoaXMuJHZpZXdNb2RlbCAmJiB0aGlzLiR2aWV3TW9kZWwudWlTdGF0ZSAmJiB0aGlzLiR2aWV3TW9kZWwudWlTdGF0ZS5yb3V0ZXJTdGF0ZSAmJiB0aGlzLiR2aWV3TW9kZWwudWlTdGF0ZS5yb3V0ZXJTdGF0ZS5xdWVyeVBhcmFtcyAmJiB0aGlzLiR2aWV3TW9kZWwudWlTdGF0ZS5yb3V0ZXJTdGF0ZS5xdWVyeVBhcmFtcy5jbGVhckNhY2hlZERhdGFGb3JDYXJkKSB7XHJcbiAgICAgICAgLy/muIXkuIDkuItiaW5nZGluZ2RhdGXkuIrnmoTkuJzopb9cclxuICAgICAgICB0aGlzLiR2aWV3TW9kZWwuY29udGV4dC5iaW5kaW5nRGF0YS5nZXRMaXN0KCkuY3VycmVudElkID0gbnVsbDtcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8g5qC55o2u6Lev55Sx5Y+C5pWw5riF55CG5YiX6KGo57yT5a2Y5pWw5o2uXHJcbiAgICAgIGlmICh0aGlzLiR2aWV3TW9kZWwgJiYgdGhpcy4kdmlld01vZGVsLnVpU3RhdGUgJiYgdGhpcy4kdmlld01vZGVsLnVpU3RhdGUucm91dGVyU3RhdGUgJiYgdGhpcy4kdmlld01vZGVsLnVpU3RhdGUucm91dGVyU3RhdGUucXVlcnlQYXJhbXMgJiYgdGhpcy4kdmlld01vZGVsLnVpU3RhdGUucm91dGVyU3RhdGUucXVlcnlQYXJhbXMuY2xlYXJDYWNoZWREYXRhRm9yTGlzdCkge1xyXG4gICAgICAgIC8v5riF5LiA5LiLYmluZ2RpbmdkYXRl5LiK55qE5Lic6KW/XHJcbiAgICAgICAgdGhpcy4kdmlld01vZGVsLnJlcG9zaXRvcnkuZW50aXR5Q29sbGVjdGlvbi5jbGVhcigpO1xyXG4gICAgICB9XHJcblxyXG5cclxuICAgIH07XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDojrflj5ZWaWV3TW9kZWxcclxuICAgICAqL1xyXG4gICAgYXBwLmNvbmZpZy5nbG9iYWxQcm9wZXJ0aWVzLiRnZXRWaWV3TW9kZWwgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgIGxldCBjdXJyZW50Q21wID0gdGhpcztcclxuICAgICAgbGV0IHZpZXdNb2RlbCA9IGN1cnJlbnRDbXAuJHZpZXdNb2RlbDtcclxuICAgICAgd2hpbGUgKCF2aWV3TW9kZWwgJiYgY3VycmVudENtcC4kcGFyZW50KSB7XHJcbiAgICAgICAgY3VycmVudENtcCA9IGN1cnJlbnRDbXAuJHBhcmVudDtcclxuICAgICAgICB2aWV3TW9kZWwgPSBjdXJyZW50Q21wLiR2aWV3TW9kZWw7XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIHZpZXdNb2RlbDtcclxuICAgIH07XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDliJ3lp4vljJbnu4Tku7bmianlsZXnrqHnkIZcclxuICAgICAqL1xyXG4gICAgYXBwLmNvbmZpZy5nbG9iYWxQcm9wZXJ0aWVzLiRpbml0Q29tcG9uZW50RXh0ZW5kZXJNYW5hZ2VyID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICBjb25zdCB2aWV3TW9kZWwgPSB0aGlzLiRnZXRWaWV3TW9kZWwoKTtcclxuICAgICAgdGhpcy4kY29tcG9uZW50RXh0ZW5kZXJNYW5hZ2VyID0gbmV3IENvbXBvbmVudEV4dGVuZGVyTWFuYWdlcih2aWV3TW9kZWwuY29udGV4dCk7XHJcbiAgICB9O1xyXG5cclxuXHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDojrflj5bnu4Tku7bmianlsZXnrqHnkIblmahcclxuICAgICAqL1xyXG4gICAgYXBwLmNvbmZpZy5nbG9iYWxQcm9wZXJ0aWVzLiRnZXRDb21wb25lbnRFeHRlbmRlck1hbmFnZXIgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgIGxldCBjdXJyZW50Q21wID0gdGhpcztcclxuICAgICAgbGV0IGV4dGVuZGVyTWFuYWdlciA9IGN1cnJlbnRDbXAuJGNvbXBvbmVudEV4dGVuZGVyTWFuYWdlcjtcclxuICAgICAgd2hpbGUgKCFleHRlbmRlck1hbmFnZXIgJiYgY3VycmVudENtcC4kcGFyZW50KSB7XHJcbiAgICAgICAgY3VycmVudENtcCA9IGN1cnJlbnRDbXAuJHBhcmVudDtcclxuICAgICAgICBleHRlbmRlck1hbmFnZXIgPSBjdXJyZW50Q21wLiRjb21wb25lbnRFeHRlbmRlck1hbmFnZXI7XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIGV4dGVuZGVyTWFuYWdlcjtcclxuICAgIH07XHJcblxyXG4gICAgYXBwLmNvbmZpZy5nbG9iYWxQcm9wZXJ0aWVzLiRiaW5kQ29tcG9uZW50RXh0ZW5kZXJzID0gZnVuY3Rpb24gKHJlZnM6IGFueSkge1xyXG4gICAgICBpZiAoIXRoaXMuJHJlZnMpIHtcclxuICAgICAgICByZXR1cm47XHJcbiAgICAgIH1cclxuICAgICAgY29uc3QgY29tcG9uZW50SW5zdGFuY2VzID0gT2JqZWN0LnZhbHVlcyh0aGlzLiRyZWZzKTtcclxuICAgICAgY29tcG9uZW50SW5zdGFuY2VzLmZvckVhY2goKGNvbXBvbmVudEluc3RhbmNlOiBhbnkpID0+IHtcclxuICAgICAgICBjb25zdCBjb21wb25lbnRUeXBlID0gY29tcG9uZW50SW5zdGFuY2UuXy50eXBlLm5hbWU7XHJcbiAgICAgICAgdGhpcy4kYmluZENvbXBvbmVudEV4dGVuZGVyKGNvbXBvbmVudEluc3RhbmNlLCBjb21wb25lbnRUeXBlKTtcclxuICAgICAgfSk7XHJcbiAgICB9O1xyXG5cclxuICAgIC8qKlxyXG4gICAgICog57uR5a6a57uE5Lu25omp5bGV5ZmoXHJcbiAgICAgKi9cclxuICAgIGFwcC5jb25maWcuZ2xvYmFsUHJvcGVydGllcy4kYmluZENvbXBvbmVudEV4dGVuZGVyID0gZnVuY3Rpb24gKGNvbXBvbmVudEluc3RhbmNlLCBjb21wb25lbnRUeXBlKSB7XHJcbiAgICAgIGlmIChjb21wb25lbnRJbnN0YW5jZS4kX19jb21wb25lbnRfZXh0ZW5kZWQgPT09IHRydWUpIHtcclxuICAgICAgICByZXR1cm47XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGNvbnN0IGV4dGVuZGVyTWFuYWdlciA9IHRoaXMuJGdldENvbXBvbmVudEV4dGVuZGVyTWFuYWdlcigpO1xyXG4gICAgICBjb25zdCBleHRlbmRlciA9IGV4dGVuZGVyTWFuYWdlci5nZXRFeHRlbmRlcihjb21wb25lbnRJbnN0YW5jZSwgY29tcG9uZW50VHlwZSk7XHJcbiAgICAgIGlmIChleHRlbmRlcikge1xyXG4gICAgICAgIGV4dGVuZGVyLmV4dGVuZCgpO1xyXG4gICAgICAgIGNvbXBvbmVudEluc3RhbmNlLiRfX2NvbXBvbmVudF9leHRlbmRlZCA9PT0gdHJ1ZVxyXG4gICAgICB9XHJcbiAgICB9O1xyXG5cclxuICAgIC8qKlxyXG4gICAgICog5riF55CG5omA5pyJ57uE5Lu25omp5bGV5ZmoXHJcbiAgICAgKiBAcGFyYW0gcmVmcyBcclxuICAgICAqL1xyXG4gICAgYXBwLmNvbmZpZy5nbG9iYWxQcm9wZXJ0aWVzLiR1bmJpbmRDb21wb25lbnRFeHRlbmRlcnMgPSBmdW5jdGlvbiAocmVmczogYW55KSB7XHJcbiAgICAgIGlmICghdGhpcy4kcmVmcykge1xyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfVxyXG4gICAgICBjb25zdCBjb21wb25lbnRJbnN0YW5jZXMgPSBPYmplY3QudmFsdWVzKHRoaXMuJHJlZnMpO1xyXG4gICAgICBjb21wb25lbnRJbnN0YW5jZXMuZm9yRWFjaCgoY29tcG9uZW50SW5zdGFuY2U6IGFueSkgPT4ge1xyXG4gICAgICAgIHRoaXMuJHVuYmluZENvbXBvbmVudEV4dGVuZGVyKGNvbXBvbmVudEluc3RhbmNlKTtcclxuICAgICAgfSk7XHJcbiAgICB9O1xyXG5cclxuICAgIC8qKlxyXG4gICAgICog5riF55CG57uE5Lu25omp5bGV5Zmo54q25oCBXHJcbiAgICAgKi9cclxuICAgIGFwcC5jb25maWcuZ2xvYmFsUHJvcGVydGllcy4kdW5iaW5kQ29tcG9uZW50RXh0ZW5kZXIgPSBmdW5jdGlvbiAoY29tcG9uZW50SW5zdGFuY2UpIHtcclxuICAgICAgY29uc3QgZXh0ZW5kZXJNYW5hZ2VyID0gdGhpcy4kZ2V0Q29tcG9uZW50RXh0ZW5kZXJNYW5hZ2VyKCk7XHJcbiAgICAgIGNvbnN0IGV4dGVuZGVyID0gZXh0ZW5kZXJNYW5hZ2VyLmdldEV4dGVuZGVyKGNvbXBvbmVudEluc3RhbmNlKTtcclxuICAgICAgaWYgKGV4dGVuZGVyKSB7XHJcbiAgICAgICAgZXh0ZW5kZXIuZGlzcG9zZSgpO1xyXG4gICAgICB9XHJcbiAgICB9O1xyXG5cclxuICAgIGFwcC5jb25maWcuZ2xvYmFsUHJvcGVydGllcy4kaW5pdFBhZ2UgPSBmdW5jdGlvbiAodmlld01vZGVsT3B0aW9ucykge1xyXG4gICAgICB0aGlzLiRjcmVhdGVWaWV3TW9kZWwodmlld01vZGVsT3B0aW9ucyk7XHJcbiAgICAgIHRoaXMuJGluaXRDb21wb25lbnRFeHRlbmRlck1hbmFnZXIoKTtcclxuICAgICAgdGhpcy4kdmlld01vZGVsLnVpU3RhdGUucGFnZVRpdGxlICYmIHRoaXMuJGNoYW5nZURvY3VtZW50VGl0bGUodGhpcy4kdmlld01vZGVsLnVpU3RhdGUucGFnZVRpdGxlKTtcclxuICAgICAgdGhpcy4kaW5pdFVpc3RhdGUoKTtcclxuICAgIH07XHJcblxyXG4gICAgYXBwLmNvbmZpZy5nbG9iYWxQcm9wZXJ0aWVzLiRjaGFuZ2VEb2N1bWVudFRpdGxlID0gZnVuY3Rpb24gKHRpdGxlOiBzdHJpbmcpIHtcclxuICAgICAgZG9jdW1lbnQudGl0bGUgPSB0aXRsZSB8fCBkb2N1bWVudC50aXRsZVxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogVlVF5LiK5qC85byP5YyW5bel5YW357G7XHJcbiAgICAgKi9cclxuICAgIGFwcC5jb25maWcuZ2xvYmFsUHJvcGVydGllcy4kZm9ybWF0VXRpbHMgPSBmb3JtYXRVdGlscztcclxuXHJcbiAgICAvKipcclxuICAgICAqIOWIneWni+WMlnVpc3RhdGXkuIrorrDlvZXnmoTnirbmgIFcclxuICAgICAqL1xyXG4gICAgYXBwLmNvbmZpZy5nbG9iYWxQcm9wZXJ0aWVzLiRpbml0VWlzdGF0ZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgdGhpcy4kdmlld01vZGVsLnVpU3RhdGUubGlzdGF2aWV3U3RhdGUgPSB7IHJlZnJlc2hMb2FkaW5nOiBmYWxzZSwgbG9hZE1vcmVMb2FkaW5nOiBmYWxzZSwgbG9hZE1vcmVGaW5pc2hlZDogZmFsc2UgfTtcclxuICAgICAgdGhpcy4kdmlld01vZGVsLnVpU3RhdGUuc2VhcmNoU3RhdGUgPSB7IGtleXdvcmQ6ICcnIH07XHJcbiAgICAgIHRoaXMuJHZpZXdNb2RlbC51aVN0YXRlLmZpbHRlclN0YXRlID0geyBmaWx0ZXJzOiAnJywgZmlsdGVyRGF0YTogJycgfTtcclxuICAgICAgdGhpcy4kdmlld01vZGVsLnVpU3RhdGUudGFiU3RhdGUgPSB7IGN1cnJlbnRUYWI6ICcnIH07XHJcbiAgICB9O1xyXG5cclxuICB9XHJcbn07XHJcblxyXG5leHBvcnQgeyBEZXZraXRQbHVnaW4gfTtcclxuIl19
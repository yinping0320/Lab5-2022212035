/**
 * @fileoverview added by tsickle
 * Generated from: lib/attachment/cloud-plus-take-photo.service.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { JsBridgeService } from '@farris/mobile-command-services';
import { uuid } from '../utils';
var CloudPlusTakePhoto = /** @class */ (function () {
    function CloudPlusTakePhoto(collectFile) {
        this.collectFile = collectFile;
        this.jsBrigdeService = new JsBridgeService();
    }
    /**
     * @param {?} param
     * @return {?}
     */
    CloudPlusTakePhoto.prototype.takeShortVideo = /**
     * @param {?} param
     * @return {?}
     */
    function (param) {
        var _this = this;
        this.jsBrigdeService.takeVideo(param).subscribe((/**
         * @param {?} result
         * @return {?}
         */
        function (result) {
            /** @type {?} */
            var data = _this.processVideo(result);
            _this.collectFile.next(data);
        }));
    };
    /**
     * @param {?} param
     * @return {?}
     */
    CloudPlusTakePhoto.prototype.takePhotoAttachment = /**
     * @param {?} param
     * @return {?}
     */
    function (param) {
        var _this = this;
        this.jsBrigdeService.takePhoto(param).subscribe((/**
         * @param {?} result
         * @return {?}
         */
        function (result) {
            /** @type {?} */
            var data = _this.processPic(result);
            _this.collectFile.next(data);
        }));
    };
    /**
     * @param {?} param
     * @return {?}
     */
    CloudPlusTakePhoto.prototype.selectAttachments = /**
     * @param {?} param
     * @return {?}
     */
    function (param) {
        var _this = this;
        this.jsBrigdeService.selectPictureFromAlbum(param).subscribe((/**
         * @param {?} result
         * @return {?}
         */
        function (result) {
            /** @type {?} */
            var data = _this.processPic(result);
            _this.collectFile.next(data);
        }));
    };
    /**
     * @param {?} param
     * @return {?}
     */
    CloudPlusTakePhoto.prototype.selectFile = /**
     * @param {?} param
     * @return {?}
     */
    function (param) {
        var _this = this;
        this.jsBrigdeService.selectFile(param).subscribe((/**
         * @param {?} res
         * @return {?}
         */
        function (res) {
            /** @type {?} */
            var data = _this.processFile(res);
            _this.collectFile.next(data);
        }));
    };
    /**
     * @param {?} options
     * @return {?}
     */
    CloudPlusTakePhoto.prototype.downloadAttachment = /**
     * @param {?} options
     * @return {?}
     */
    function (options) {
        return this.jsBrigdeService.downloadFile(options);
    };
    /**
     * @return {?}
     */
    CloudPlusTakePhoto.prototype.getSysInfo = /**
     * @return {?}
     */
    function () {
        return this.jsBrigdeService.getSysInfo();
    };
    /**
     * 调起当前设备 播放短视频
     * @param path 视频路径
     */
    /**
     * 调起当前设备 播放短视频
     * @param {?} path 视频路径
     * @return {?}
     */
    CloudPlusTakePhoto.prototype.playShortVideo = /**
     * 调起当前设备 播放短视频
     * @param {?} path 视频路径
     * @return {?}
     */
    function (path) {
        var _this = this;
        window['iCityBridge'].ccworkPlayShortVideo({ path: path }, (/**
         * @param {?} res
         * @return {?}
         */
        function (res) {
            /** @type {?} */
            var result = res.result;
            /** @type {?} */
            var data = _this.processVideo(result);
            _this.collectFile.next(data);
        }));
    };
    /**
     * 预处理图片
     */
    /**
     * 预处理图片
     * @param {?} result
     * @return {?}
     */
    CloudPlusTakePhoto.prototype.processPic = /**
     * 预处理图片
     * @param {?} result
     * @return {?}
     */
    function (result) {
        /** @type {?} */
        var imgHeader = 'data:image/jpeg;base64,';
        /** @type {?} */
        var imgType = 'image/png';
        if (typeof result === 'string') {
            // ios takephoto
            return {
                file: new File([], "image_" + uuid().substring(0, 6) + ".png", { type: imgType }),
                content: "" + imgHeader + result
            };
        }
        return result.map((/**
         * @param {?} dataItem
         * @return {?}
         */
        function (dataItem) {
            // andriod selectPic
            if (typeof dataItem === 'string') {
                return {
                    file: new File([], "image_" + uuid().substring(0, 6) + ".png", { type: imgType }),
                    content: "" + imgHeader + dataItem
                };
            }
            // ios selectPic
            return {
                file: new File([], "image_" + uuid().substring(0, 6) + ".png", { type: imgType }),
                content: "" + imgHeader + dataItem.content
            };
        }));
    };
    /**
     * @param {?} result
     * @return {?}
     */
    CloudPlusTakePhoto.prototype.processFile = /**
     * @param {?} result
     * @return {?}
     */
    function (result) {
        /** @type {?} */
        var fileHeaders = {
            'jpg': 'data:image/jpeg;base64,',
            'png': 'data:image/jpeg;base64,',
            'doc': 'data:application/vnd.openxmlformats-officedocument.wordprocessingml.document;base64,',
            'docx': 'data:application/vnd.openxmlformats-officedocument.wordprocessingml.document;base64,',
            'xls': 'data:application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;base64,',
            'xlsx': 'data:application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;base64,',
            'ppt': 'data:application/vnd.ms-powerpoint;base64,',
            'pptx': 'data:application/vnd.ms-powerpoint;base64,',
            'txt': 'data:text/plain;base64,',
            'pdf': 'data:application/pdf;base64,',
            'mp4': 'data:video/mp4;base64,',
            'mov': 'data:video/mp4;base64,'
        };
        /** @type {?} */
        var fileTypes = {
            'jpg': 'image/png',
            'png': 'image/png',
            'doc': 'application/vnd.openxmlformats-officedocument.wordprocessingml.document',
            'docx': 'application/vnd.openxmlformats-officedocument.wordprocessingml.document',
            'xls': 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',
            'xlsx': 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',
            'ppt': 'application/vnd.ms-powerpoint',
            'pptx': 'application/vnd.ms-powerpoint',
            'txt': 'text/plain',
            'pdf': 'application/pdf',
            'mp4': 'video/mp4',
            'mov': 'video/mp4'
        };
        return result.map((/**
         * @param {?} dataItem
         * @return {?}
         */
        function (dataItem) {
            /** @type {?} */
            var suffix = dataItem.name.substring(dataItem.name.lastIndexOf('.') + 1);
            return {
                file: new File([], dataItem.name, { type: fileTypes[suffix.toLowerCase()] }),
                content: "" + fileHeaders[suffix.toLowerCase()] + dataItem.base64
            };
        }));
    };
    /**
     * 预处理视频
     * @param result
     */
    /**
     * 预处理视频
     * @param {?} result
     * @return {?}
     */
    CloudPlusTakePhoto.prototype.processVideo = /**
     * 预处理视频
     * @param {?} result
     * @return {?}
     */
    function (result) {
        /** @type {?} */
        var url = result.value;
        /** @type {?} */
        var base64value = result.base64value;
        /** @type {?} */
        var videoHeader = 'data:video/mp4;base64,';
        /** @type {?} */
        var videoType = 'video/mp4';
        /** @type {?} */
        var videoName = url.substring(url.lastIndexOf('/') + 1) + '.mp4';
        return {
            file: new File([], videoName, { type: videoType }),
            content: "" + videoHeader + base64value,
            type: videoType,
            url: url,
            name: url.substring(url.lastIndexOf('/') + 1) + '.mp4'
        };
    };
    return CloudPlusTakePhoto;
}());
export { CloudPlusTakePhoto };
if (false) {
    /**
     * @type {?}
     * @private
     */
    CloudPlusTakePhoto.prototype.jsBrigdeService;
    /**
     * @type {?}
     * @private
     */
    CloudPlusTakePhoto.prototype.collectFile;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2xvdWQtcGx1cy10YWtlLXBob3RvLnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL21vYmlsZS12dWUtYWRhcHRlci8iLCJzb3VyY2VzIjpbImxpYi9hdHRhY2htZW50L2Nsb3VkLXBsdXMtdGFrZS1waG90by5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBRUEsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLGlDQUFpQyxDQUFDO0FBQ2xFLE9BQU8sRUFBRSxJQUFJLEVBQUUsTUFBTSxVQUFVLENBQUM7QUFDaEM7SUFFSSw0QkFBb0IsV0FBeUI7UUFBekIsZ0JBQVcsR0FBWCxXQUFXLENBQWM7UUFDekMsSUFBSSxDQUFDLGVBQWUsR0FBRyxJQUFJLGVBQWUsRUFBRSxDQUFBO0lBQ2hELENBQUM7Ozs7O0lBQ00sMkNBQWM7Ozs7SUFBckIsVUFBc0IsS0FBVTtRQUFoQyxpQkFLQztRQUpHLElBQUksQ0FBQyxlQUFlLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxDQUFDLFNBQVM7Ozs7UUFBQyxVQUFBLE1BQU07O2dCQUM1QyxJQUFJLEdBQUcsS0FBSSxDQUFDLFlBQVksQ0FBQyxNQUFNLENBQUM7WUFDdEMsS0FBSSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDaEMsQ0FBQyxFQUFDLENBQUM7SUFDUCxDQUFDOzs7OztJQUVNLGdEQUFtQjs7OztJQUExQixVQUEyQixLQUFVO1FBQXJDLGlCQUtDO1FBSkcsSUFBSSxDQUFDLGVBQWUsQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLENBQUMsU0FBUzs7OztRQUFDLFVBQUEsTUFBTTs7Z0JBQzVDLElBQUksR0FBRyxLQUFJLENBQUMsVUFBVSxDQUFDLE1BQU0sQ0FBQztZQUNwQyxLQUFJLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUNoQyxDQUFDLEVBQUMsQ0FBQztJQUNQLENBQUM7Ozs7O0lBRU0sOENBQWlC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QyxNQUFNLENBQUMsV0FBVyxFQUFFLENBQUMsRUFBRSxDQUFDO2dCQUM1RSxPQUFPLEVBQUUsS0FBRyxXQUFXLENBQUMsTUFBTSxDQUFDLFdBQVcsRUFBRSxDQUFDLEdBQUcsUUFBUSxDQUFDLE1BQVE7YUFDcEUsQ0FBQztRQUNOLENBQUMsRUFBQyxDQUFDO0lBQ1AsQ0FBQztJQUVEOzs7T0FHRzs7Ozs7O0lBQ0gseUNBQVk7Ozs7O0lBQVosVUFBYSxNQUFXOztZQUNkLEdBQUcsR0FBRyxNQUFNLENBQUMsS0FBSzs7WUFDbEIsV0FBVyxHQUFHLE1BQU0sQ0FBQyxXQUFXOztZQUNoQyxXQUFXLEdBQUcsd0JBQXdCOztZQUN0QyxTQUFTLEdBQUcsV0FBVzs7WUFDdkIsU0FBUyxHQUFHLEdBQUcsQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLFdBQVcsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUMsR0FBRyxNQUFNO1FBQ2xFLE9BQU87WUFDSCxJQUFJLEVBQUUsSUFBSSxJQUFJLENBQUMsRUFBRSxFQUFFLFNBQVMsRUFBRSxFQUFFLElBQUksRUFBRSxTQUFTLEVBQUUsQ0FBQztZQUNsRCxPQUFPLEVBQUUsS0FBRyxXQUFXLEdBQUcsV0FBYTtZQUN2QyxJQUFJLEVBQUUsU0FBUztZQUNmLEdBQUcsS0FBQTtZQUNILElBQUksRUFBRSxHQUFHLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxXQUFXLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsTUFBTTtTQUN6RCxDQUFDO0lBQ04sQ0FBQztJQUdMLHlCQUFDO0FBQUQsQ0FBQyxBQTVJRCxJQTRJQzs7Ozs7OztJQTNJRyw2Q0FBeUM7Ozs7O0lBQzdCLHlDQUFpQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFN1YmplY3QgfSBmcm9tICdyeGpzJztcclxuaW1wb3J0IHsgVGFrZVBob3RvIH0gZnJvbSAnLi90YWtlLXBob3RvLmludGVyZmFjZSc7XHJcbmltcG9ydCB7IEpzQnJpZGdlU2VydmljZSB9IGZyb20gJ0BmYXJyaXMvbW9iaWxlLWNvbW1hbmQtc2VydmljZXMnO1xyXG5pbXBvcnQgeyB1dWlkIH0gZnJvbSAnLi4vdXRpbHMnO1xyXG5leHBvcnQgY2xhc3MgQ2xvdWRQbHVzVGFrZVBob3RvIGltcGxlbWVudHMgVGFrZVBob3RvIHtcclxuICAgIHByaXZhdGUganNCcmlnZGVTZXJ2aWNlOiBKc0JyaWRnZVNlcnZpY2U7XHJcbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIGNvbGxlY3RGaWxlOiBTdWJqZWN0PGFueT4pIHtcclxuICAgICAgICB0aGlzLmpzQnJpZ2RlU2VydmljZSA9IG5ldyBKc0JyaWRnZVNlcnZpY2UoKVxyXG4gICAgfVxyXG4gICAgcHVibGljIHRha2VTaG9ydFZpZGVvKHBhcmFtOiBhbnkpIHtcclxuICAgICAgICB0aGlzLmpzQnJpZ2RlU2VydmljZS50YWtlVmlkZW8ocGFyYW0pLnN1YnNjcmliZShyZXN1bHQgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBkYXRhID0gdGhpcy5wcm9jZXNzVmlkZW8ocmVzdWx0KTtcclxuICAgICAgICAgICAgdGhpcy5jb2xsZWN0RmlsZS5uZXh0KGRhdGEpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyB0YWtlUGhvdG9BdHRhY2htZW50KHBhcmFtOiBhbnkpIHtcclxuICAgICAgICB0aGlzLmpzQnJpZ2RlU2VydmljZS50YWtlUGhvdG8ocGFyYW0pLnN1YnNjcmliZShyZXN1bHQgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBkYXRhID0gdGhpcy5wcm9jZXNzUGljKHJlc3VsdCk7XHJcbiAgICAgICAgICAgIHRoaXMuY29sbGVjdEZpbGUubmV4dChkYXRhKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgc2VsZWN0QXR0YWNobWVudHMocGFyYW06IGFueSkge1xyXG4gICAgICAgIHRoaXMuanNCcmlnZGVTZXJ2aWNlLnNlbGVjdFBpY3R1cmVGcm9tQWxidW0ocGFyYW0pLnN1YnNjcmliZShyZXN1bHQgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBkYXRhID0gdGhpcy5wcm9jZXNzUGljKHJlc3VsdCk7XHJcbiAgICAgICAgICAgIHRoaXMuY29sbGVjdEZpbGUubmV4dChkYXRhKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgc2VsZWN0RmlsZShwYXJhbTogYW55KSB7XHJcbiAgICAgICAgdGhpcy5qc0JyaWdkZVNlcnZpY2Uuc2VsZWN0RmlsZShwYXJhbSkuc3Vic2NyaWJlKHJlcyA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLnByb2Nlc3NGaWxlKHJlcyk7XHJcbiAgICAgICAgICAgIHRoaXMuY29sbGVjdEZpbGUubmV4dChkYXRhKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgZG93bmxvYWRBdHRhY2htZW50KG9wdGlvbnM6IGFueSkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmpzQnJpZ2RlU2VydmljZS5kb3dubG9hZEZpbGUob3B0aW9ucyk7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGdldFN5c0luZm8oKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuanNCcmlnZGVTZXJ2aWNlLmdldFN5c0luZm8oKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOiwg+i1t+W9k+WJjeiuvuWkhyDmkq3mlL7nn63op4bpopFcclxuICAgICAqIEBwYXJhbSBwYXRoIOinhumikei3r+W+hFxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgcGxheVNob3J0VmlkZW8ocGF0aDogc3RyaW5nKSB7XHJcbiAgICAgICAgd2luZG93WydpQ2l0eUJyaWRnZSddLmNjd29ya1BsYXlTaG9ydFZpZGVvKHsgcGF0aCB9LCAocmVzKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IHJlcy5yZXN1bHQ7XHJcbiAgICAgICAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLnByb2Nlc3NWaWRlbyhyZXN1bHQpO1xyXG4gICAgICAgICAgICB0aGlzLmNvbGxlY3RGaWxlLm5leHQoZGF0YSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDpooTlpITnkIblm77niYdcclxuICAgICAqL1xyXG4gICAgcHJvY2Vzc1BpYyhyZXN1bHQ6IHN0cmluZ1tdKSB7XHJcbiAgICAgICAgY29uc3QgaW1nSGVhZGVyID0gJ2RhdGE6aW1hZ2UvanBlZztiYXNlNjQsJztcclxuICAgICAgICBjb25zdCBpbWdUeXBlID0gJ2ltYWdlL3BuZyc7XHJcbiAgICAgICAgaWYgKHR5cGVvZiByZXN1bHQgPT09ICdzdHJpbmcnKSB7XHJcbiAgICAgICAgICAgIC8vIGlvcyB0YWtlcGhvdG9cclxuICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgIGZpbGU6IG5ldyBGaWxlKFtdLCBgaW1hZ2VfJHt1dWlkKCkuc3Vic3RyaW5nKDAsIDYpfS5wbmdgLCB7IHR5cGU6IGltZ1R5cGUgfSksXHJcbiAgICAgICAgICAgICAgICBjb250ZW50OiBgJHtpbWdIZWFkZXJ9JHtyZXN1bHR9YFxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gcmVzdWx0Lm1hcCgoZGF0YUl0ZW06IGFueSkgPT4ge1xyXG4gICAgICAgICAgICAvLyBhbmRyaW9kIHNlbGVjdFBpY1xyXG4gICAgICAgICAgICBpZiAodHlwZW9mIGRhdGFJdGVtID09PSAnc3RyaW5nJykge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgICAgICBmaWxlOiBuZXcgRmlsZShbXSwgYGltYWdlXyR7dXVpZCgpLnN1YnN0cmluZygwLCA2KX0ucG5nYCwgeyB0eXBlOiBpbWdUeXBlIH0pLFxyXG4gICAgICAgICAgICAgICAgICAgIGNvbnRlbnQ6IGAke2ltZ0hlYWRlcn0ke2RhdGFJdGVtfWBcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLy8gaW9zIHNlbGVjdFBpY1xyXG4gICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgZmlsZTogbmV3IEZpbGUoW10sIGBpbWFnZV8ke3V1aWQoKS5zdWJzdHJpbmcoMCwgNil9LnBuZ2AsIHsgdHlwZTogaW1nVHlwZSB9KSxcclxuICAgICAgICAgICAgICAgIGNvbnRlbnQ6IGAke2ltZ0hlYWRlcn0ke2RhdGFJdGVtLmNvbnRlbnR9YFxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHByb2Nlc3NGaWxlKHJlc3VsdDogYW55W10pIHtcclxuICAgICAgICBjb25zdCBmaWxlSGVhZGVycyA9IHtcclxuICAgICAgICAgICAgJ2pwZyc6ICdkYXRhOmltYWdlL2pwZWc7YmFzZTY0LCcsXHJcbiAgICAgICAgICAgICdwbmcnOiAnZGF0YTppbWFnZS9qcGVnO2Jhc2U2NCwnLFxyXG4gICAgICAgICAgICAnZG9jJzogJ2RhdGE6YXBwbGljYXRpb24vdm5kLm9wZW54bWxmb3JtYXRzLW9mZmljZWRvY3VtZW50LndvcmRwcm9jZXNzaW5nbWwuZG9jdW1lbnQ7YmFzZTY0LCcsXHJcbiAgICAgICAgICAgICdkb2N4JzogJ2RhdGE6YXBwbGljYXRpb24vdm5kLm9wZW54bWxmb3JtYXRzLW9mZmljZWRvY3VtZW50LndvcmRwcm9jZXNzaW5nbWwuZG9jdW1lbnQ7YmFzZTY0LCcsXHJcbiAgICAgICAgICAgICd4bHMnOiAnZGF0YTphcHBsaWNhdGlvbi92bmQub3BlbnhtbGZvcm1hdHMtb2ZmaWNlZG9jdW1lbnQuc3ByZWFkc2hlZXRtbC5zaGVldDtiYXNlNjQsJyxcclxuICAgICAgICAgICAgJ3hsc3gnOiAnZGF0YTphcHBsaWNhdGlvbi92bmQub3BlbnhtbGZvcm1hdHMtb2ZmaWNlZG9jdW1lbnQuc3ByZWFkc2hlZXRtbC5zaGVldDtiYXNlNjQsJyxcclxuICAgICAgICAgICAgJ3BwdCc6ICdkYXRhOmFwcGxpY2F0aW9uL3ZuZC5tcy1wb3dlcnBvaW50O2Jhc2U2NCwnLFxyXG4gICAgICAgICAgICAncHB0eCc6ICdkYXRhOmFwcGxpY2F0aW9uL3ZuZC5tcy1wb3dlcnBvaW50O2Jhc2U2NCwnLFxyXG4gICAgICAgICAgICAndHh0JzogJ2RhdGE6dGV4dC9wbGFpbjtiYXNlNjQsJyxcclxuICAgICAgICAgICAgJ3BkZic6ICdkYXRhOmFwcGxpY2F0aW9uL3BkZjtiYXNlNjQsJyxcclxuICAgICAgICAgICAgJ21wNCc6ICdkYXRhOnZpZGVvL21wNDtiYXNlNjQsJyxcclxuICAgICAgICAgICAgJ21vdic6ICdkYXRhOnZpZGVvL21wNDtiYXNlNjQsJ1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgY29uc3QgZmlsZVR5cGVzID0ge1xyXG4gICAgICAgICAgICAnanBnJzogJ2ltYWdlL3BuZycsXHJcbiAgICAgICAgICAgICdwbmcnOiAnaW1hZ2UvcG5nJyxcclxuICAgICAgICAgICAgJ2RvYyc6ICdhcHBsaWNhdGlvbi92bmQub3BlbnhtbGZvcm1hdHMtb2ZmaWNlZG9jdW1lbnQud29yZHByb2Nlc3NpbmdtbC5kb2N1bWVudCcsXHJcbiAgICAgICAgICAgICdkb2N4JzogJ2FwcGxpY2F0aW9uL3ZuZC5vcGVueG1sZm9ybWF0cy1vZmZpY2Vkb2N1bWVudC53b3JkcHJvY2Vzc2luZ21sLmRvY3VtZW50JyxcclxuICAgICAgICAgICAgJ3hscyc6ICdhcHBsaWNhdGlvbi92bmQub3BlbnhtbGZvcm1hdHMtb2ZmaWNlZG9jdW1lbnQuc3ByZWFkc2hlZXRtbC5zaGVldCcsXHJcbiAgICAgICAgICAgICd4bHN4JzogJ2FwcGxpY2F0aW9uL3ZuZC5vcGVueG1sZm9ybWF0cy1vZmZpY2Vkb2N1bWVudC5zcHJlYWRzaGVldG1sLnNoZWV0JyxcclxuICAgICAgICAgICAgJ3BwdCc6ICdhcHBsaWNhdGlvbi92bmQubXMtcG93ZXJwb2ludCcsXHJcbiAgICAgICAgICAgICdwcHR4JzogJ2FwcGxpY2F0aW9uL3ZuZC5tcy1wb3dlcnBvaW50JyxcclxuICAgICAgICAgICAgJ3R4dCc6ICd0ZXh0L3BsYWluJyxcclxuICAgICAgICAgICAgJ3BkZic6ICdhcHBsaWNhdGlvbi9wZGYnLFxyXG4gICAgICAgICAgICAnbXA0JzogJ3ZpZGVvL21wNCcsXHJcbiAgICAgICAgICAgICdtb3YnOiAndmlkZW8vbXA0J1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgcmV0dXJuIHJlc3VsdC5tYXAoKGRhdGFJdGVtOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgY29uc3Qgc3VmZml4ID0gZGF0YUl0ZW0ubmFtZS5zdWJzdHJpbmcoZGF0YUl0ZW0ubmFtZS5sYXN0SW5kZXhPZignLicpICsgMSk7XHJcbiAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICBmaWxlOiBuZXcgRmlsZShbXSwgZGF0YUl0ZW0ubmFtZSwgeyB0eXBlOiBmaWxlVHlwZXNbc3VmZml4LnRvTG93ZXJDYXNlKCldIH0pLFxyXG4gICAgICAgICAgICAgICAgY29udGVudDogYCR7ZmlsZUhlYWRlcnNbc3VmZml4LnRvTG93ZXJDYXNlKCldfSR7ZGF0YUl0ZW0uYmFzZTY0fWBcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOmihOWkhOeQhuinhumikVxyXG4gICAgICogQHBhcmFtIHJlc3VsdFxyXG4gICAgICovXHJcbiAgICBwcm9jZXNzVmlkZW8ocmVzdWx0OiBhbnkpIHtcclxuICAgICAgICBjb25zdCB1cmwgPSByZXN1bHQudmFsdWU7XHJcbiAgICAgICAgY29uc3QgYmFzZTY0dmFsdWUgPSByZXN1bHQuYmFzZTY0dmFsdWU7XHJcbiAgICAgICAgY29uc3QgdmlkZW9IZWFkZXIgPSAnZGF0YTp2aWRlby9tcDQ7YmFzZTY0LCc7XHJcbiAgICAgICAgY29uc3QgdmlkZW9UeXBlID0gJ3ZpZGVvL21wNCc7XHJcbiAgICAgICAgY29uc3QgdmlkZW9OYW1lID0gdXJsLnN1YnN0cmluZyh1cmwubGFzdEluZGV4T2YoJy8nKSArIDEpICsgJy5tcDQnO1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIGZpbGU6IG5ldyBGaWxlKFtdLCB2aWRlb05hbWUsIHsgdHlwZTogdmlkZW9UeXBlIH0pLFxyXG4gICAgICAgICAgICBjb250ZW50OiBgJHt2aWRlb0hlYWRlcn0ke2Jhc2U2NHZhbHVlfWAsXHJcbiAgICAgICAgICAgIHR5cGU6IHZpZGVvVHlwZSxcclxuICAgICAgICAgICAgdXJsLFxyXG4gICAgICAgICAgICBuYW1lOiB1cmwuc3Vic3RyaW5nKHVybC5sYXN0SW5kZXhPZignLycpICsgMSkgKyAnLm1wNCdcclxuICAgICAgICB9O1xyXG4gICAgfVxyXG5cclxuXHJcbn1cclxuXHJcbiJdfQ==
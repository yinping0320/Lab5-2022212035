!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@farris/mobile-devkit"),require("vue"),require("@farris/mobile-command-services"),require("@farris/mobile-bef"),require("rxjs"),require("rxjs/operators")):"function"==typeof define&&define.amd?define("@farris/mobile-vue-adapter",["exports","@farris/mobile-devkit","vue","@farris/mobile-command-services","@farris/mobile-bef","rxjs","rxjs/operators"],e):e(((t=t||self).farris=t.farris||{},t.farris["mobile-vue-adapter"]={}),t.mobileDevkit,t.vue,t.mobileCommandServices,t.mobileBef,t.rxjs,t.rxjs.operators)}(this,(function(t,e,n,i,o,r,a){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */var s=function(t,e){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function c(t,e){function n(){this.constructor=t}s(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var p=function(){return(p=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};function u(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var i,o,r=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(i=r.next()).done;)a.push(i.value)}catch(t){o={error:t}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return a}function l(t,e){var i=n.reactive({stateVersion:0});return(function(){this.$__recomputables||(this.$__recomputables={}),this.$__recomputables[e]||(this.$__recomputables[e]=i);i.stateVersion;return t.call(this)})}function d(t,e){if(t.$__recomputables&&t.$__recomputables[e]){t.$__recomputables[e].stateVersion++;try{t.$forceUpdate()}catch(t){console.log("$forceUpdate",t)}}}var f=function(){function t(t){this.vueInstance=t;var e=this.vueInstance.$getViewModel();this.viewModelContext=e.context,this.subscriptionsMap=new Map}return t.prototype.getEntityListData=function(){var t=this;if(!1===this.subscriptionsMap.has("entityListData")){var e=this.viewModelContext.bindingData.changes.subscribe((function(e){d(t.vueInstance,"entityListData")}));this.subscriptionsMap.set("entityListData",e)}return this.viewModelContext.bindingData.getList().toJSON()},t.prototype.getCurrentEntityData=function(){var t=this;if(!1===this.subscriptionsMap.has("currentEntityData")){var e=this.viewModelContext.bindingData.changes.subscribe((function(e){d(t.vueInstance,"currentEntityData")}));this.subscriptionsMap.set("currentEntityData",e)}return this.viewModelContext.bindingData.getObject().toJSON()},t.prototype.getUIState=function(){var t=this;if(!1===this.subscriptionsMap.has("uiState")){var e=this.viewModelContext.uiState.changes.subscribe((function(){d(t.vueInstance,"uiState")}));this.subscriptionsMap.set("uiState",e)}return this.viewModelContext.uiState},t.prototype.getForm=function(){var t=this;if(!1===this.subscriptionsMap.has("form")){var e=this.viewModelContext.bindingData.changes.subscribe((function(e){e&&"ValueChanged"===e.type&&t.viewModelContext.form.getFieldErrorByPath(e.path),d(t.vueInstance,"form")})),n=this.viewModelContext.form.changes.subscribe((function(e){if(e&&"validateFieldsFinished"===e.type)d(t.vueInstance,"form");else if(e&&"singleHanded"===e.type){var n=t.vueInstance.$children.findIndex((function(t){return t.$attrs.id==="form_"+e.value}));t.vueInstance.$children[n].$forceUpdate()}}));this.subscriptionsMap.set("form",e),this.subscriptionsMap.set("formV",n)}return this.vueInstance.$getViewModel().form},t.prototype.getStateMachine=function(){var t=this;if(!1===this.subscriptionsMap.has("stateMachine")){var e=this.viewModelContext.stateMachine.stateChange.subscribe((function(e){d(t.vueInstance,"stateMachine")}));this.subscriptionsMap.set("stateMachine",e)}return this.viewModelContext.stateMachine.renderStates},t}();var h=function(){function t(t,e){this.listviewInstance=t,this.viewModelContext=e}return t.prototype.extend=function(){var t=this,e=this;this.viewModelContext.appContext.eventBus.subscribe(this.viewModelContext.id+"-listview-extend",(function(e){"listviewFinished"===e.type&&t.viewModelContext.uiState.setPropertyValue("listaviewState",p({},t.viewModelContext.uiState.listaviewState,{loadMoreFinished:!0})),"listviewUnFinished"===e.type&&t.viewModelContext.uiState.setPropertyValue("listaviewState",p({},t.viewModelContext.uiState.listaviewState,{loadMoreFinished:!1})),"loadDataFinished"===e.type&&t.viewModelContext.uiState.setPropertyValue("listaviewState",p({},t.viewModelContext.uiState.listaviewState,{refreshLoading:!1,loadMoreLoading:!1}))})),this.listviewInstance.$on("selectChange",(function(t){var n=t.data.id;e.viewModelContext.bindingData.getList().setCurrentId(n,!0,!0)})),this.listviewInstance.$on("itemClick",(function(){var t=e.listviewInstance.getSelectDataList(),n=[];t&&t.length>0&&(n=t.map((function(t){return t.id}))),e.viewModelContext.uiState.setPropertyValue("selectedIds",n)})),this.listviewInstance.$on("refresh",(function(){e.viewModelContext.repository.setPaginationInfo({pageIndex:1}),e.viewModelContext.uiState.setPropertyValue("listaviewState",p({},e.viewModelContext.uiState.listaviewState,{refreshLoading:!0,loadMoreLoading:!0})),e.viewModelContext.appContext.eventBus.triggerEvent({type:"LoadData"})})),this.listviewInstance.$on("load",(function(){if(!e.viewModelContext.uiState.listaviewState.loadMoreLoading){e.viewModelContext.uiState.setPropertyValue("listaviewState",p({},e.viewModelContext.uiState.listaviewState,{loadMoreLoading:!0}));var t=e.viewModelContext.repository.paginationInfo&&e.viewModelContext.repository.paginationInfo.pageIndex;t||(t=0),e.viewModelContext.repository.setPaginationInfo({pageIndex:t+=1}),e.viewModelContext.appContext.eventBus.triggerEvent({type:"LoadData"})}}))},t.prototype.dispose=function(){this.listviewInstance.$off("selectChange"),this.listviewInstance.$off("itemClick"),this.listviewInstance.$off("load"),this.viewModelContext.appContext.eventBus.unsubscribe(this.viewModelContext.id+"-listview-extend")},t}();var m=function(){function t(t,e){this.lookupInstance=t,this.viewModelContext=e}return t.prototype.extend=function(){},t.prototype.dispose=function(){console.log("Lookup disposed...")},t}();var v=function(){function t(t,e){this.attachmentInstance=t,this.viewModelContext=e}return t.prototype.extend=function(){var t=this;this.attachmentInstance.$on("beforeSelect",(function(e){var n=e.id;t.viewModelContext.bindingData.getList().setCurrentId(n,!0,!1)}))},t.prototype.dispose=function(){this.attachmentInstance.$off("beforeSelect")},t}();var g=function(){function t(t,e){this.filterInstance=t,this.viewModelContext=e}return t.prototype.extend=function(){var t=this;this.filterInstance.$on("clear",(function(){t.viewModelContext.uiState.setPropertyValue("filterState",{filters:null})})),this.filterInstance.$on("search",(function(e){t.viewModelContext.repository.setPaginationInfo({pageIndex:1}),t.viewModelContext.uiState.setPropertyValue("filterState",{filters:e.FilterConditions}),t.viewModelContext.appContext.eventBus.triggerEvent({type:"LoadData"})})),this.filterInstance.$on("confirm",(function(e){t.viewModelContext.repository.setPaginationInfo({pageIndex:1}),t.viewModelContext.uiState.setPropertyValue("filterState",{filters:e.FilterConditions}),t.viewModelContext.appContext.eventBus.triggerEvent({type:"LoadData"})}))},t.prototype.dispose=function(){this.filterInstance.$off("clear"),this.filterInstance.$off("change"),this.filterInstance.$off("confirm")},t}();var x=function(){function t(t,e){this.tabInstance=t,this.viewModelContext=e,this.viewModelContext.uiState.setPropertyValue("tabState",{currentTab:t.currentName})}return t.prototype.extend=function(){var t=this;this.tabInstance.$on("change",(function(e){window.MOBILE_ORIGIN_BACK&&window.MOBILE_ORIGIN_BACK.reflushOriginGoback(),e.name!==t.viewModelContext.uiState.tabState.currentTab&&(t.viewModelContext.uiState.setPropertyValue("tabState",{currentTab:e.name}),t.viewModelContext.repository.setPaginationInfo({pageIndex:1}),t.viewModelContext.appContext.eventBus.triggerEvent({type:"LoadData"}))}))},t.prototype.dispose=function(){this.tabInstance.$off("change")},t}();var b=function(){function t(t,e){this.searchInstance=t,this.viewModelContext=e}return t.prototype.extend=function(){var t=this;this.searchInstance.$on("cancel",(function(e){t.viewModelContext.repository.setPaginationInfo({pageIndex:1}),t.viewModelContext.appContext.eventBus.triggerEvent({type:"LoadData"})})),this.searchInstance.$on("search",(function(e){t.viewModelContext.repository.setPaginationInfo({pageIndex:1}),t.viewModelContext.appContext.eventBus.triggerEvent({type:"LoadData"})}))},t.prototype.dispose=function(){this.searchInstance.$off("cancel"),this.searchInstance.$off("search")},t}();var w=function(){function t(t,e){this.checkboxInstance=t,this.viewModelContext=e}return t.prototype.extend=function(){var t=this;this.checkboxInstance.$parent.listCheckStart(),this.checkboxInstance.$on("click",(function(){console.log("click"),t.checkboxInstance.$parent.checkboxFlag?t.checkboxInstance.$parent.listCheckAllCancel():t.checkboxInstance.$parent.listCheckAll(),t.checkboxInstance.$parent.checkboxFlag=!t.checkboxInstance.$parent.checkboxFlag;var e=t.checkboxInstance.$parent.getSelectDataList(),n=[];e&&e.length>0&&(n=e.map((function(t){return t.id}))),t.viewModelContext.uiState.setPropertyValue("selectedIds",n)}))},t.prototype.dispose=function(){this.checkboxInstance.$off("click")},t}();var y=function(){function t(t,e){this.mapInstance=t,this.viewModelContext=e}return t.prototype.extend=function(){var t=this;this.mapInstance.$on("markMap",(function(e){var n=e.lnglat,i=n.lng,o=n.lat,r=t.mapInstance.lngPath,a=t.mapInstance.latPath;t.viewModelContext.bindingData.setValue(t.getBindingPathArray().concat(r.split("/")),i,!0,!0),t.viewModelContext.bindingData.setValue(t.getBindingPathArray().concat(a.split("/")),o,!0,!0)}))},t.prototype.dispose=function(){this.mapInstance.$off("markMap")},t.prototype.getBindingPathArray=function(){var t=this.viewModelContext.bindingData.bindingPath;return t?t.split("/").filter((function(t){return""!==t})):[]},t}();var M=function(){function t(t){this.viewModelContext=t}return t.prototype.create=function(t,e){var n;switch(e){case"fm-listview":n=new h(t,this.viewModelContext);break;case"Lookup":n=new m(t,this.viewModelContext);break;case"fm-filter":n=new g(t,this.viewModelContext);break;case"fm-tabs":n=new x(t,this.viewModelContext);break;case"van-search":n=new b(t,this.viewModelContext);break;case"Checkbox":n=new w(t,this.viewModelContext);break;case"fm-attachment":n=new v(t,this.viewModelContext);break;case"Map":n=new y(t,this.viewModelContext);break;default:n=null}return n},t}();var C=function(){function t(t){this.viewModelContext=t,this.extenderMap=new Map,this.extenderFactory=new M(t)}return t.prototype.getExtender=function(t,e){if(this.extenderMap.has(t))return this.extenderMap.get(t);var n=this.extenderFactory.create(t,e);return this.extenderMap.set(t,n),n},t}();var $=function(t,e){if(t[e[0]])return e.reduce((function(t,e){return t[e]}),t)},I=function(t,e){var n=t.length<e.length?t.length:e.length,i="",o=0;for(o=0;o<n;o++)i+=t.substring(o,o+1),i+=e.substring(o,o+1);return i+=t.length<e.length?e.substring(o):t.substring(o)},S=function(t){var e=[1,2,3];t.length>24&&(t=t.substring(0,24));var n=Math.floor(t.length/3),i=t.substring(0,n),o=t.substring(n,2*n),r=t.substring(2*n,3*n),a=[],s=Math.ceil(3*Math.random());a.push(e[s-1]),e.splice(s-1,1),s=Math.ceil(2*Math.random()),a.push(e[s-1]),e.splice(s-1,1),a.push(e[0]);var c=Math.round((new Date).getTime()/1e3)+"";return c.substring(0,5)+"times"+a[0]+a[1]+a[2]+P(i,o,r,a[0])+P(i,o,r,a[1])+P(i,o,r,a[2])+"times"+c.substring(5)},P=function(t,e,n,i){switch(i){case 1:return t;case 2:return e;case 3:return n}},k={doc:"/platform/common/web/assets/fm-attachment/word.png",docx:"/platform/common/web/assets/fm-attachment/word.png",xls:"/platform/common/web/assets/fm-attachment/excel.png",xlsx:"/platform/common/web/assets/fm-attachment/excel.png",ppt:"/platform/common/web/assets/fm-attachment/ppt.png",pptx:"/platform/common/web/assets/fm-attachment/ppt.png",pdf:"/platform/common/web/assets/fm-attachment/pdf.png",txt:"/platform/common/web/assets/fm-attachment/txt.png",jpg:"/platform/common/web/assets/fm-attachment/img.png",jpeg:"/platform/common/web/assets/fm-attachment/img.png",png:"/platform/common/web/assets/fm-attachment/img.png"},E=function(t,e,n){return Object.keys(k).find((function(t){return t===n.toLowerCase()}))?k[n.toLowerCase()]:"/api/runtime/dfs/v1.0/doc/filecontent?metadataid="+t+"&rootid="+e+"&token="+S(I(t,e))},D=function(){function t(){}return t.toHandlerKey=function(t){return t?"on"+this.capitalize(t):""},t.camelize=function(t){return t.replace(/-(\w)/g,(function(t,e){return e?e.toUpperCase():""}))},t.capitalize=function(t){return t.charAt(0).toUpperCase()+t.slice(1)},t}(),L=function(){var t=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var n=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"===e?n:3&n|8).toString(16)}))},F={enum:function(t,n){return e.EnumUtil.format(t,n)},date:function(t,n){return e.DateUtil.format(t,n)},dateOperation:function(t,n){return e.DateUtil.dateOperation(t,n)},number:function(t,n){return e.NumberUtil.format(t,n)},string:function(t,n){return e.StringUtil.format(t,n)},bool:function(t,n){return e.BoolUtil.format(t,n)}},V={install:function(t,n){t.config.globalProperties.$on=function(t,e){var n=this._.vnode.props,i=D.toHandlerKey(t),o=n[i];n[i]=o?function(t){e(t),o(t)}:e},t.config.globalProperties.$off=function(t){this._.vnode.props[D.toHandlerKey(t)]=null},t.config.globalProperties.$app=null,t.config.globalProperties.$viewModel=null,t.config.globalProperties.$bindingStates=null,t.config.globalProperties.$componentExtenderManager=null,t.config.globalProperties.$createApp=function(t){if(this.$app)throw new Error("App已经存在");var n=new i.HistoryBackService;n.init(),n.proxyBack(),this.$app=new e.App(t),window.IsDddedMessageEventListener||(window.addEventListener("message",function(t){var e=this.$app.context.injector.get("DECLARATIONS_TOKEN"),n=JSON.parse(t.data).data.command,i=e.commands[n],o=(t.origin,t.source,this.$app.context.viewModelContextManager.getContextById(i.viewModelId));o&&o.viewModel[i.command]().pipe((function(){}),(function(){}),(function(){window.parent&&window.parent.postMessage("success",t.origin)}))}.bind(this),!1),window.IsDddedMessageEventListener=!0)},t.config.globalProperties.$getApp=function(){for(var t=this.$app,e=this;!t&&e.$parent;)t=(e=e.$parent).$app;return t},t.config.globalProperties.$createViewModel=function(t){if(this.$app=this.$getApp(),!this.$app)throw new Error("请先创建App");var e=t.id;if(e){var n=this.$app.context.viewModelContextManager.getContextById(e);n&&(this.$viewModel=n.viewModel)}if(!this.$viewModel){var o=this.$getViewModel();t.parent||(t.parent=o),this.$viewModel=this.$app.createViewModel(t)}this.$bindingStates=new f(this),this.$viewModel.injector.get(i.RouterService).mappingToUIState(),this.$viewModel&&this.$viewModel.uiState&&this.$viewModel.uiState.routerState&&this.$viewModel.uiState.routerState.queryParams&&this.$viewModel.uiState.routerState.queryParams.clearCachedDataForCard&&(this.$viewModel.context.bindingData.getList().currentId=null),this.$viewModel&&this.$viewModel.uiState&&this.$viewModel.uiState.routerState&&this.$viewModel.uiState.routerState.queryParams&&this.$viewModel.uiState.routerState.queryParams.clearCachedDataForList&&this.$viewModel.repository.entityCollection.clear()},t.config.globalProperties.$getViewModel=function(){for(var t=this,e=t.$viewModel;!e&&t.$parent;)e=(t=t.$parent).$viewModel;return e},t.config.globalProperties.$initComponentExtenderManager=function(){var t=this.$getViewModel();this.$componentExtenderManager=new C(t.context)},t.config.globalProperties.$getComponentExtenderManager=function(){for(var t=this,e=t.$componentExtenderManager;!e&&t.$parent;)e=(t=t.$parent).$componentExtenderManager;return e},t.config.globalProperties.$bindComponentExtenders=function(t){var e=this;this.$refs&&Object.values(this.$refs).forEach((function(t){var n=t._.type.name;e.$bindComponentExtender(t,n)}))},t.config.globalProperties.$bindComponentExtender=function(t,e){if(!0!==t.$__component_extended){var n=this.$getComponentExtenderManager().getExtender(t,e);n&&(n.extend(),t.$__component_extended)}},t.config.globalProperties.$unbindComponentExtenders=function(t){var e=this;this.$refs&&Object.values(this.$refs).forEach((function(t){e.$unbindComponentExtender(t)}))},t.config.globalProperties.$unbindComponentExtender=function(t){var e=this.$getComponentExtenderManager().getExtender(t);e&&e.dispose()},t.config.globalProperties.$initPage=function(t){this.$createViewModel(t),this.$initComponentExtenderManager(),this.$viewModel.uiState.pageTitle&&this.$changeDocumentTitle(this.$viewModel.uiState.pageTitle),this.$initUistate()},t.config.globalProperties.$changeDocumentTitle=function(t){document.title=t||document.title},t.config.globalProperties.$formatUtils=F,t.config.globalProperties.$initUistate=function(){this.$viewModel.uiState.listaviewState={refreshLoading:!1,loadMoreLoading:!1,loadMoreFinished:!1},this.$viewModel.uiState.searchState={keyword:""},this.$viewModel.uiState.filterState={filters:"",filterData:""},this.$viewModel.uiState.tabState={currentTab:""}}}};function _(){return l((function(){return this.$bindingStates.getEntityListData()}),"entityListData")}function O(){return l((function(){return this.$bindingStates.getCurrentEntityData()}),"currentEntityData")}function A(){return l((function(){return this.$bindingStates.getUIState()}),"uiState")}function B(){return l((function(){return this.$bindingStates.getForm()}),"form")}var j=function(){function t(){}return t.prototype.takePhotoAttachment=function(){},t.prototype.takeShortVideo=function(){},t.prototype.selectFile=function(){},t.prototype.downloadAttachment=function(){},t}();var T=function(){function t(){this.collectFile=new r.Subject}return t.prototype.takePhoto=function(t){this.takePhotoIns.takePhotoAttachment(t)},t.prototype.selectAttachment=function(t){this.takePhotoIns.selectAttachments(t)},t.prototype.takeShortVideo=function(t){this.takePhotoIns.takeShortVideo(t)},t.prototype.playShortVideo=function(t){this.takePhotoIns.playShortVideo(t)},t.prototype.selectFile=function(t){this.takePhotoIns.selectFile(t)},t.prototype.downloadAttachment=function(t){this.takePhotoIns.downloadAttachment(t)},t.prototype.getSysInfo=function(){return this.takePhotoIns.getSysInfo()},t}();var U=function(){function t(t){this.collectFile=t,this.jsBrigdeService=new i.JsBridgeService}return t.prototype.takeShortVideo=function(t){var e=this;this.jsBrigdeService.takeVideo(t).subscribe((function(t){var n=e.processVideo(t);e.collectFile.next(n)}))},t.prototype.takePhotoAttachment=function(t){var e=this;this.jsBrigdeService.takePhoto(t).subscribe((function(t){var n=e.processPic(t);e.collectFile.next(n)}))},t.prototype.selectAttachments=function(t){var e=this;this.jsBrigdeService.selectPictureFromAlbum(t).subscribe((function(t){var n=e.processPic(t);e.collectFile.next(n)}))},t.prototype.selectFile=function(t){var e=this;this.jsBrigdeService.selectFile(t).subscribe((function(t){var n=e.processFile(t);e.collectFile.next(n)}))},t.prototype.downloadAttachment=function(t){return this.jsBrigdeService.downloadFile(t)},t.prototype.getSysInfo=function(){return this.jsBrigdeService.getSysInfo()},t.prototype.playShortVideo=function(t){var e=this;window.iCityBridge.ccworkPlayShortVideo({path:t},(function(t){var n=t.result,i=e.processVideo(n);e.collectFile.next(i)}))},t.prototype.processPic=function(t){var e="data:image/jpeg;base64,";return"string"==typeof t?{file:new File([],"image_"+L().substring(0,6)+".png",{type:"image/png"}),content:""+e+t}:t.map((function(t){return"string"==typeof t?{file:new File([],"image_"+L().substring(0,6)+".png",{type:"image/png"}),content:""+e+t}:{file:new File([],"image_"+L().substring(0,6)+".png",{type:"image/png"}),content:""+e+t.content}}))},t.prototype.processFile=function(t){var e={jpg:"data:image/jpeg;base64,",png:"data:image/jpeg;base64,",doc:"data:application/vnd.openxmlformats-officedocument.wordprocessingml.document;base64,",docx:"data:application/vnd.openxmlformats-officedocument.wordprocessingml.document;base64,",xls:"data:application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;base64,",xlsx:"data:application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;base64,",ppt:"data:application/vnd.ms-powerpoint;base64,",pptx:"data:application/vnd.ms-powerpoint;base64,",txt:"data:text/plain;base64,",pdf:"data:application/pdf;base64,",mp4:"data:video/mp4;base64,",mov:"data:video/mp4;base64,"},n={jpg:"image/png",png:"image/png",doc:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",docx:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",xls:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",ppt:"application/vnd.ms-powerpoint",pptx:"application/vnd.ms-powerpoint",txt:"text/plain",pdf:"application/pdf",mp4:"video/mp4",mov:"video/mp4"};return t.map((function(t){var i=t.name.substring(t.name.lastIndexOf(".")+1);return{file:new File([],t.name,{type:n[i.toLowerCase()]}),content:""+e[i.toLowerCase()]+t.base64}}))},t.prototype.processVideo=function(t){var e=t.value,n=t.base64value,i=e.substring(e.lastIndexOf("/")+1)+".mp4";return{file:new File([],i,{type:"video/mp4"}),content:"data:video/mp4;base64,"+n,type:"video/mp4",url:e,name:e.substring(e.lastIndexOf("/")+1)+".mp4"}},t}();!function(t){function e(){var e=t.call(this)||this;return e.takePhotoIns=new j,e}c(e,t)}(T);var N=function(t){function e(){var e=t.call(this)||this;return e.takePhotoIns=new U(e.collectFile),e}return c(e,t),e}(T),q=function(){function t(t){this.befRepository=t}return t.prototype.upload=function(t,n){var i=this.befRepository.apiProxy,o=t.map((function(t){return{docInfo:{fileContent:t.content.substring(t.content.indexOf(",")+1),fileName:t.file.name,index:0,total:1,metadataId:t.id},formId:n.parentDirName,mode:1,rootId:n.rootId||"default-root"}})).map((function(t){var n={body:t};return i.request(e.HttpMethods.POST,"/api/runtime/dfs/v1.0/formdoc",n,!0)}));return r.forkJoin(o)},t.prototype.previewPdf=function(t,n){var i=this.befRepository.apiProxy,o={body:{storageType:2,filePath:JSON.stringify({rootId:t,metadataIdList:n})}};return i.request(e.HttpMethods.POST,"/api/runtime/dfs/v1.0/fileviewer/filelist",o).pipe(a.map((function(t){return"/platform/runtime/dfs/web/pdfjs/viewer.html?file="+encodeURIComponent(t[0].filePath)})))},t.prototype.previewDoc=function(t,n){var i=this.befRepository.apiProxy,o={body:{storageType:2,filePath:JSON.stringify({rootId:t,metadataIdList:n})}};return i.request(e.HttpMethods.POST,"/api/runtime/dfs/v1.0/fileviewer/filelist",o).pipe(a.mergeMap((function(t){return i.request(e.HttpMethods.POST,"/api/runtime/dfs/v1.0/docviewer/loaddocument",{body:{filePath:t[0].filePath}})})),a.map((function(t){return t.pages})))},t.prototype.getAttachmentPath=function(t,e){return"/api/runtime/dfs/v1.0/doc/filecontent?metadataid="+t+"&rootid="+e+"&token="+S(I(t,e))},t}();var H=function(){function t(t){this.viewModelContext=t}return t.prototype.mapFields=function(t,e){var n=this;if(console.log(t),e){var i=Object.keys(e),o=i.findIndex((function(t){return"id"===t}));i.includes("id")&&0!==o&&(i.splice(o,1),i=function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(u(arguments[e]));return t}(["id"],i));var r=this;i.forEach((function(i){var o="";t&&(o=t instanceof Array?t.map((function(t){return n.getValue(i,t)})).join(","):r.getValue(i,t));var a=r.getBindingPathArray();e[i].split(",").forEach((function(e){t&&r.viewModelContext.bindingData.setValue(a.concat(e.split(".")),o,!0,!0)}))}))}},t.prototype.getFieldValue=function(t){var e=this.getBindingPathArray().concat(t.split("."));return this.viewModelContext.bindingData.getValue(e)},t.prototype.getValue=function(t,e){return-1===t.indexOf(".")?e[t]:t.split(".").reduce((function(t,e){return t[e]}),e)},t.prototype.getBindingPathArray=function(){var t=this.viewModelContext.bindingData.bindingPath;return t?t.split("/").filter((function(t){return""!==t})):[]},t}();var R=function(){function t(t){this.location$=t}return t.prototype.getCurrentLoc=function(){var t=this;window.iCityBridge&&window.iCityBridge.ccworkGetLocation((function(e){alert(JSON.stringify(e)),t.location$.next(t.assembleMarkers(e))}))},t.prototype.locationCallback=function(t){alert(JSON.stringify(t)),this.location$.next(this.assembleMarkers(t))},t.prototype.assembleMarkers=function(t){var e=t.result;return[{position:[Number(e.lng),Number(e.lat)],visible:!0,draggable:!0}]},t}();var J=function(){function t(){this.location$=new r.Subject}return t.prototype.getCurrentLocation=function(){this.locationInstance.getCurrentLoc()},t.prototype.getMapMarkers=function(){return this.location$},t.prototype.setMapMarkers=function(){},t}();var z=function(t){function e(){var e=t.call(this)||this;return e.locationInstance=new R(e.location$),e}return c(e,t),e}(J);var K={mounted:function(t,e,n,i){var o=n.componentInstance;console.log(o),o.$bindComponentExtender(o,"Listview")},unmounted:function(t,e,n,i){var o=n.componentInstance;o.$unbindComponentExtender(o)}},G={mounted:function(t,e,n,i){var o=n.componentInstance;o.$bindComponentExtender(o,"Lookup")},unmounted:function(t,e,n,i){var o=n.componentInstance;o.$unbindComponentExtender(o)}},Q={mounted:function(t,e,n,i){var o=n.componentInstance;o.$bindComponentExtender(o,"Filter")},unmounted:function(t,e,n,i){var o=n.componentInstance;o.$unbindComponentExtender(o)}},W={mounted:function(t,e,n,i){var o=n.componentInstance;o.$bindComponentExtender(o,"Tab")},unmounted:function(t,e,n,i){var o=n.componentInstance;o.$unbindComponentExtender(o)}},X={mounted:function(t,e,n,i){var o=n.children[0].children[0].componentInstance;o.$bindComponentExtender(o,"Search")},unmounted:function(t,e,n,i){var o=n.children[0].children[0].componentInstance;o.$unbindComponentExtender(o)}},Y={mounted:function(t,e,n,i){var o=n.componentInstance;o.$bindComponentExtender(o,"Reflesh")},unmounted:function(t,e,n,i){var o=n.componentInstance;o.$unbindComponentExtender(o)}},Z={mounted:function(t,e,n,i){var o=n.componentInstance;o.$bindComponentExtender(o,"Checkbox")},unmounted:function(t,e,n,i){var o=n.componentInstance;o.$unbindComponentExtender(o)}},tt={mounted:function(t,e,n,i){var o=n.componentInstance;o.$bindComponentExtender(o,"Attachment")},unmounted:function(t,e,n,i){var o=n.componentInstance;o.$unbindComponentExtender(o)}},et={mounted:function(t,e,n,i){var o=n.componentInstance,r=e.value;o.lngPath=r.lngPath,o.latPath=r.latPath,o.$bindComponentExtender(o,"Map")},unmounted:function(t,e,n,i){var o=n.componentInstance;o.$unbindComponentExtender(o)}},nt=function(){function t(t){this.format=t}return t.prototype.convertFrom=function(t){if(!t)return"0001-01-01T00:00:00";var n=this.format?this.format:"yyyy-MM-dd HH:mm:ss";return e.DateUtil.format(t,n)},t.prototype.convertTo=function(t){return!0===e.DateUtil.isEmptyDateString(t)?null:e.DateUtil.parse(t)},t}();var it=function(){function t(t){void 0===t&&(t=","),this.separator=t}return t.prototype.convertFrom=function(t){return t.join(this.separator)},t.prototype.convertTo=function(t){return t.split(this.separator)},t}();var ot=function(){function t(){}return t.createApp=function(t){return this.app=n.createApp(t),this.app.use(V),this.app},t.createDirective=function(t,e){this.app.directive(t,e)},t.app=null,t}();t.AppCreator=ot,t.BindingStates=f,t.DateConverter=nt,t.DevkitPlugin=V,t.LookupMappingService=H,t.StringArrayConverter=it,t.bindAttachmentExtenderDir=tt,t.bindCheckboxExtenderDir=Z,t.bindFilterExtenderDir=Q,t.bindListviewExtenderDir=K,t.bindLookupExtenderDir=G,t.bindMapExtenderDir=et,t.bindRefleshExtenderDir=Y,t.bindSearchExtenderDir=X,t.bindTabExtenderDir=W,t.filterData=function(t,e,n,i){void 0===i&&(i=!0);var o=e.split("/").filter((function(t){return t}));if(!i){var r=$(t,o),a="/platform/common/web/assets/imgs/no-pic.png";if(!r||!r.attachmentId)return a;var s=r.fileName.substring(r.fileName.lastIndexOf(".")+1);return a=E(r.attachmentId,n,s)}return t.map((function(t){var e=$(t,o),i="/platform/common/web/assets/imgs/no-pic.png";if(!e||!e.attachmentId)return{url:i,id:t.id,attachmentId:e.attachmentId,name:"",size:0,createTime:""};var r=e.fileName.substring(e.fileName.lastIndexOf(".")+1);return{url:i=E(e.attachmentId,n,r),id:t.id,attachmentId:e.attachmentId,name:e.fileName,size:e.fileSize,createTime:e.fileCreateTime}}))},t.filterMapData=function(t,e,n){return[{position:[$(t,e.split("/"))||117.12212,$(t,n.split("/"))||35.3243]}]},t.mapBindingStates=function(t){var e={entityListData:_(),currentEntityData:O(),uiState:A(),form:B(),stateMachine:l((function(){return this.$bindingStates.getStateMachine()}),"stateMachine")};return Object.assign({},e,t)},t.mapCommandMethods=function(t){var e={};return t.forEach((function(t){e[t]=function(e){return this.$viewModel[t](e)}})),e},t.mapCurrentEntityData=O,t.mapEntityListData=_,t.mapForm=B,t.mapProviders=function(){return function(){var t=this.$getViewModel(),e=new o.BefLookupDataService(t.context),n=new H(t.context),i=new N;return{LookupHttpService:e,LookupMappingFn:n,uploadAttachmentService:new q(t.context.repository),attachmentService:i,mapService:new z}}},t.mapUIState=A,t.recomputable=l,t.recompute=d,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=farris-mobile-vue-adapter.umd.min.js.map
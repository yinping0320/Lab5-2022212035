/**
 * @fileoverview added by tsickle
 * Generated from: lib/attachment/cloud-plus-take-photo.service.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { JsBridgeService } from '@farris/mobile-command-services';
import { uuid } from '../utils';
export class CloudPlusTakePhoto {
    /**
     * @param {?} collectFile
     */
    constructor(collectFile) {
        this.collectFile = collectFile;
        this.jsBrigdeService = new JsBridgeService();
    }
    /**
     * @param {?} param
     * @return {?}
     */
    takeShortVideo(param) {
        this.jsBrigdeService.takeVideo(param).subscribe((/**
         * @param {?} result
         * @return {?}
         */
        result => {
            /** @type {?} */
            const data = this.processVideo(result);
            this.collectFile.next(data);
        }));
    }
    /**
     * @param {?} param
     * @return {?}
     */
    takePhotoAttachment(param) {
        this.jsBrigdeService.takePhoto(param).subscribe((/**
         * @param {?} result
         * @return {?}
         */
        result => {
            /** @type {?} */
            const data = this.processPic(result);
            this.collectFile.next(data);
        }));
    }
    /**
     * @param {?} param
     * @return {?}
     */
    selectAttachments(param) {
        this.jsBrigdeService.selectPictureFromAlbum(param).subscribe((/**
         * @param {?} result
         * @return {?}
         */
        result => {
            /** @type {?} */
            const data = this.processPic(result);
            this.collectFile.next(data);
        }));
    }
    /**
     * @param {?} param
     * @return {?}
     */
    selectFile(param) {
        this.jsBrigdeService.selectFile(param).subscribe((/**
         * @param {?} res
         * @return {?}
         */
        res => {
            /** @type {?} */
            const data = this.processFile(res);
            this.collectFile.next(data);
        }));
    }
    /**
     * @param {?} options
     * @return {?}
     */
    downloadAttachment(options) {
        return this.jsBrigdeService.downloadFile(options);
    }
    /**
     * @return {?}
     */
    getSysInfo() {
        return this.jsBrigdeService.getSysInfo();
    }
    /**
     * 调起当前设备 播放短视频
     * @param {?} path 视频路径
     * @return {?}
     */
    playShortVideo(path) {
        window['iCityBridge'].ccworkPlayShortVideo({ path }, (/**
         * @param {?} res
         * @return {?}
         */
        (res) => {
            /** @type {?} */
            const result = res.result;
            /** @type {?} */
            const data = this.processVideo(result);
            this.collectFile.next(data);
        }));
    }
    /**
     * 预处理图片
     * @param {?} result
     * @return {?}
     */
    processPic(result) {
        /** @type {?} */
        const imgHeader = 'data:image/jpeg;base64,';
        /** @type {?} */
        const imgType = 'image/png';
        if (typeof result === 'string') {
            // ios takephoto
            return {
                file: new File([], `image_${uuid().substring(0, 6)}.png`, { type: imgType }),
                content: `${imgHeader}${result}`
            };
        }
        return result.map((/**
         * @param {?} dataItem
         * @return {?}
         */
        (dataItem) => {
            // andriod selectPic
            if (typeof dataItem === 'string') {
                return {
                    file: new File([], `image_${uuid().substring(0, 6)}.png`, { type: imgType }),
                    content: `${imgHeader}${dataItem}`
                };
            }
            // ios selectPic
            return {
                file: new File([], `image_${uuid().substring(0, 6)}.png`, { type: imgType }),
                content: `${imgHeader}${dataItem.content}`
            };
        }));
    }
    /**
     * @param {?} result
     * @return {?}
     */
    processFile(result) {
        /** @type {?} */
        const fileHeaders = {
            'jpg': 'data:image/jpeg;base64,',
            'png': 'data:image/jpeg;base64,',
            'doc': 'data:application/vnd.openxmlformats-officedocument.wordprocessingml.document;base64,',
            'docx': 'data:application/vnd.openxmlformats-officedocument.wordprocessingml.document;base64,',
            'xls': 'data:application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;base64,',
            'xlsx': 'data:application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;base64,',
            'ppt': 'data:application/vnd.ms-powerpoint;base64,',
            'pptx': 'data:application/vnd.ms-powerpoint;base64,',
            'txt': 'data:text/plain;base64,',
            'pdf': 'data:application/pdf;base64,',
            'mp4': 'data:video/mp4;base64,',
            'mov': 'data:video/mp4;base64,'
        };
        /** @type {?} */
        const fileTypes = {
            'jpg': 'image/png',
            'png': 'image/png',
            'doc': 'application/vnd.openxmlformats-officedocument.wordprocessingml.document',
            'docx': 'application/vnd.openxmlformats-officedocument.wordprocessingml.document',
            'xls': 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',
            'xlsx': 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',
            'ppt': 'application/vnd.ms-powerpoint',
            'pptx': 'application/vnd.ms-powerpoint',
            'txt': 'text/plain',
            'pdf': 'application/pdf',
            'mp4': 'video/mp4',
            'mov': 'video/mp4'
        };
        return result.map((/**
         * @param {?} dataItem
         * @return {?}
         */
        (dataItem) => {
            /** @type {?} */
            const suffix = dataItem.name.substring(dataItem.name.lastIndexOf('.') + 1);
            return {
                file: new File([], dataItem.name, { type: fileTypes[suffix.toLowerCase()] }),
                content: `${fileHeaders[suffix.toLowerCase()]}${dataItem.base64}`
            };
        }));
    }
    /**
     * 预处理视频
     * @param {?} result
     * @return {?}
     */
    processVideo(result) {
        /** @type {?} */
        const url = result.value;
        /** @type {?} */
        const base64value = result.base64value;
        /** @type {?} */
        const videoHeader = 'data:video/mp4;base64,';
        /** @type {?} */
        const videoType = 'video/mp4';
        /** @type {?} */
        const videoName = url.substring(url.lastIndexOf('/') + 1) + '.mp4';
        return {
            file: new File([], videoName, { type: videoType }),
            content: `${videoHeader}${base64value}`,
            type: videoType,
            url,
            name: url.substring(url.lastIndexOf('/') + 1) + '.mp4'
        };
    }
}
if (false) {
    /**
     * @type {?}
     * @private
     */
    CloudPlusTakePhoto.prototype.jsBrigdeService;
    /**
     * @type {?}
     * @private
     */
    CloudPlusTakePhoto.prototype.collectFile;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2xvdWQtcGx1cy10YWtlLXBob3RvLnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL21vYmlsZS12dWUtYWRhcHRlci8iLCJzb3VyY2VzIjpbImxpYi9hdHRhY2htZW50L2Nsb3VkLXBsdXMtdGFrZS1waG90by5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBRUEsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLGlDQUFpQyxDQUFDO0FBQ2xFLE9BQU8sRUFBRSxJQUFJLEVBQUUsTUFBTSxVQUFVLENBQUM7QUFDaEMsTUFBTSxPQUFPLGtCQUFrQjs7OztJQUUzQixZQUFvQixXQUF5QjtRQUF6QixnQkFBVyxHQUFYLFdBQVcsQ0FBYztRQUN6QyxJQUFJLENBQUMsZUFBZSxHQUFHLElBQUksZUFBZSxFQUFFLENBQUE7SUFDaEQsQ0FBQzs7Ozs7SUFDTSxjQUFjLENBQUMsS0FBVTtRQUM1QixJQUFJLENBQUMsZUFBZSxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxTQUFTOzs7O1FBQUMsTUFBTSxDQUFDLEVBQUU7O2tCQUMvQyxJQUFJLEdBQUcsSUFBSSxDQUFDLFlBQVksQ0FBQyxNQUFNLENBQUM7WUFDdEMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDaEMsQ0FBQyxFQUFDLENBQUM7SUFDUCxDQUFDOzs7OztJQUVNLG1CQUFtQixDQUFDLEtBQVU7UUFDakMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLENBQUMsU0FBUzs7OztRQUFDLE1BQU0sQ0FBQyxFQUFFOztrQkFDL0MsSUFBSSxHQUFHLElBQUksQ0FBQyxVQUFVLENBQUMsTUFBTSxDQUFDO1lBQ3BDLElBQUksQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ2hDLENBQUMsRUFBQyxDQUFDO0lBQ1AsQ0FBQzs7Ozs7SUFFTSxpQkFBaUIsQ0FBQyxLQUFVO1FB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QUFDLEdBQUcsUUFBUSxDQUFDLE1BQU0sRUFBRTthQUNwRSxDQUFDO1FBQ04sQ0FBQyxFQUFDLENBQUM7SUFDUCxDQUFDOzs7Ozs7SUFNRCxZQUFZLENBQUMsTUFBVzs7Y0FDZCxHQUFHLEdBQUcsTUFBTSxDQUFDLEtBQUs7O2NBQ2xCLFdBQVcsR0FBRyxNQUFNLENBQUMsV0FBVzs7Y0FDaEMsV0FBVyxHQUFHLHdCQUF3Qjs7Y0FDdEMsU0FBUyxHQUFHLFdBQVc7O2NBQ3ZCLFNBQVMsR0FBRyxHQUFHLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxXQUFXLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsTUFBTTtRQUNsRSxPQUFPO1lBQ0gsSUFBSSxFQUFFLElBQUksSUFBSSxDQUFDLEVBQUUsRUFBRSxTQUFTLEVBQUUsRUFBRSxJQUFJLEVBQUUsU0FBUyxFQUFFLENBQUM7WUFDbEQsT0FBTyxFQUFFLEdBQUcsV0FBVyxHQUFHLFdBQVcsRUFBRTtZQUN2QyxJQUFJLEVBQUUsU0FBUztZQUNmLEdBQUc7WUFDSCxJQUFJLEVBQUUsR0FBRyxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsV0FBVyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLE1BQU07U0FDekQsQ0FBQztJQUNOLENBQUM7Q0FHSjs7Ozs7O0lBM0lHLDZDQUF5Qzs7Ozs7SUFDN0IseUNBQWlDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgU3ViamVjdCB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQgeyBUYWtlUGhvdG8gfSBmcm9tICcuL3Rha2UtcGhvdG8uaW50ZXJmYWNlJztcclxuaW1wb3J0IHsgSnNCcmlkZ2VTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy9tb2JpbGUtY29tbWFuZC1zZXJ2aWNlcyc7XHJcbmltcG9ydCB7IHV1aWQgfSBmcm9tICcuLi91dGlscyc7XHJcbmV4cG9ydCBjbGFzcyBDbG91ZFBsdXNUYWtlUGhvdG8gaW1wbGVtZW50cyBUYWtlUGhvdG8ge1xyXG4gICAgcHJpdmF0ZSBqc0JyaWdkZVNlcnZpY2U6IEpzQnJpZGdlU2VydmljZTtcclxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgY29sbGVjdEZpbGU6IFN1YmplY3Q8YW55Pikge1xyXG4gICAgICAgIHRoaXMuanNCcmlnZGVTZXJ2aWNlID0gbmV3IEpzQnJpZGdlU2VydmljZSgpXHJcbiAgICB9XHJcbiAgICBwdWJsaWMgdGFrZVNob3J0VmlkZW8ocGFyYW06IGFueSkge1xyXG4gICAgICAgIHRoaXMuanNCcmlnZGVTZXJ2aWNlLnRha2VWaWRlbyhwYXJhbSkuc3Vic2NyaWJlKHJlc3VsdCA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLnByb2Nlc3NWaWRlbyhyZXN1bHQpO1xyXG4gICAgICAgICAgICB0aGlzLmNvbGxlY3RGaWxlLm5leHQoZGF0YSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHRha2VQaG90b0F0dGFjaG1lbnQocGFyYW06IGFueSkge1xyXG4gICAgICAgIHRoaXMuanNCcmlnZGVTZXJ2aWNlLnRha2VQaG90byhwYXJhbSkuc3Vic2NyaWJlKHJlc3VsdCA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLnByb2Nlc3NQaWMocmVzdWx0KTtcclxuICAgICAgICAgICAgdGhpcy5jb2xsZWN0RmlsZS5uZXh0KGRhdGEpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBzZWxlY3RBdHRhY2htZW50cyhwYXJhbTogYW55KSB7XHJcbiAgICAgICAgdGhpcy5qc0JyaWdkZVNlcnZpY2Uuc2VsZWN0UGljdHVyZUZyb21BbGJ1bShwYXJhbSkuc3Vic2NyaWJlKHJlc3VsdCA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLnByb2Nlc3NQaWMocmVzdWx0KTtcclxuICAgICAgICAgICAgdGhpcy5jb2xsZWN0RmlsZS5uZXh0KGRhdGEpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBzZWxlY3RGaWxlKHBhcmFtOiBhbnkpIHtcclxuICAgICAgICB0aGlzLmpzQnJpZ2RlU2VydmljZS5zZWxlY3RGaWxlKHBhcmFtKS5zdWJzY3JpYmUocmVzID0+IHtcclxuICAgICAgICAgICAgY29uc3QgZGF0YSA9IHRoaXMucHJvY2Vzc0ZpbGUocmVzKTtcclxuICAgICAgICAgICAgdGhpcy5jb2xsZWN0RmlsZS5uZXh0KGRhdGEpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBkb3dubG9hZEF0dGFjaG1lbnQob3B0aW9uczogYW55KSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuanNCcmlnZGVTZXJ2aWNlLmRvd25sb2FkRmlsZShvcHRpb25zKTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgZ2V0U3lzSW5mbygpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5qc0JyaWdkZVNlcnZpY2UuZ2V0U3lzSW5mbygpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog6LCD6LW35b2T5YmN6K6+5aSHIOaSreaUvuefreinhumikVxyXG4gICAgICogQHBhcmFtIHBhdGgg6KeG6aKR6Lev5b6EXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBwbGF5U2hvcnRWaWRlbyhwYXRoOiBzdHJpbmcpIHtcclxuICAgICAgICB3aW5kb3dbJ2lDaXR5QnJpZGdlJ10uY2N3b3JrUGxheVNob3J0VmlkZW8oeyBwYXRoIH0sIChyZXMpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gcmVzLnJlc3VsdDtcclxuICAgICAgICAgICAgY29uc3QgZGF0YSA9IHRoaXMucHJvY2Vzc1ZpZGVvKHJlc3VsdCk7XHJcbiAgICAgICAgICAgIHRoaXMuY29sbGVjdEZpbGUubmV4dChkYXRhKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOmihOWkhOeQhuWbvueJh1xyXG4gICAgICovXHJcbiAgICBwcm9jZXNzUGljKHJlc3VsdDogc3RyaW5nW10pIHtcclxuICAgICAgICBjb25zdCBpbWdIZWFkZXIgPSAnZGF0YTppbWFnZS9qcGVnO2Jhc2U2NCwnO1xyXG4gICAgICAgIGNvbnN0IGltZ1R5cGUgPSAnaW1hZ2UvcG5nJztcclxuICAgICAgICBpZiAodHlwZW9mIHJlc3VsdCA9PT0gJ3N0cmluZycpIHtcclxuICAgICAgICAgICAgLy8gaW9zIHRha2VwaG90b1xyXG4gICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgZmlsZTogbmV3IEZpbGUoW10sIGBpbWFnZV8ke3V1aWQoKS5zdWJzdHJpbmcoMCwgNil9LnBuZ2AsIHsgdHlwZTogaW1nVHlwZSB9KSxcclxuICAgICAgICAgICAgICAgIGNvbnRlbnQ6IGAke2ltZ0hlYWRlcn0ke3Jlc3VsdH1gXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiByZXN1bHQubWFwKChkYXRhSXRlbTogYW55KSA9PiB7XHJcbiAgICAgICAgICAgIC8vIGFuZHJpb2Qgc2VsZWN0UGljXHJcbiAgICAgICAgICAgIGlmICh0eXBlb2YgZGF0YUl0ZW0gPT09ICdzdHJpbmcnKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGZpbGU6IG5ldyBGaWxlKFtdLCBgaW1hZ2VfJHt1dWlkKCkuc3Vic3RyaW5nKDAsIDYpfS5wbmdgLCB7IHR5cGU6IGltZ1R5cGUgfSksXHJcbiAgICAgICAgICAgICAgICAgICAgY29udGVudDogYCR7aW1nSGVhZGVyfSR7ZGF0YUl0ZW19YFxyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvLyBpb3Mgc2VsZWN0UGljXHJcbiAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICBmaWxlOiBuZXcgRmlsZShbXSwgYGltYWdlXyR7dXVpZCgpLnN1YnN0cmluZygwLCA2KX0ucG5nYCwgeyB0eXBlOiBpbWdUeXBlIH0pLFxyXG4gICAgICAgICAgICAgICAgY29udGVudDogYCR7aW1nSGVhZGVyfSR7ZGF0YUl0ZW0uY29udGVudH1gXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJvY2Vzc0ZpbGUocmVzdWx0OiBhbnlbXSkge1xyXG4gICAgICAgIGNvbnN0IGZpbGVIZWFkZXJzID0ge1xyXG4gICAgICAgICAgICAnanBnJzogJ2RhdGE6aW1hZ2UvanBlZztiYXNlNjQsJyxcclxuICAgICAgICAgICAgJ3BuZyc6ICdkYXRhOmltYWdlL2pwZWc7YmFzZTY0LCcsXHJcbiAgICAgICAgICAgICdkb2MnOiAnZGF0YTphcHBsaWNhdGlvbi92bmQub3BlbnhtbGZvcm1hdHMtb2ZmaWNlZG9jdW1lbnQud29yZHByb2Nlc3NpbmdtbC5kb2N1bWVudDtiYXNlNjQsJyxcclxuICAgICAgICAgICAgJ2RvY3gnOiAnZGF0YTphcHBsaWNhdGlvbi92bmQub3BlbnhtbGZvcm1hdHMtb2ZmaWNlZG9jdW1lbnQud29yZHByb2Nlc3NpbmdtbC5kb2N1bWVudDtiYXNlNjQsJyxcclxuICAgICAgICAgICAgJ3hscyc6ICdkYXRhOmFwcGxpY2F0aW9uL3ZuZC5vcGVueG1sZm9ybWF0cy1vZmZpY2Vkb2N1bWVudC5zcHJlYWRzaGVldG1sLnNoZWV0O2Jhc2U2NCwnLFxyXG4gICAgICAgICAgICAneGxzeCc6ICdkYXRhOmFwcGxpY2F0aW9uL3ZuZC5vcGVueG1sZm9ybWF0cy1vZmZpY2Vkb2N1bWVudC5zcHJlYWRzaGVldG1sLnNoZWV0O2Jhc2U2NCwnLFxyXG4gICAgICAgICAgICAncHB0JzogJ2RhdGE6YXBwbGljYXRpb24vdm5kLm1zLXBvd2VycG9pbnQ7YmFzZTY0LCcsXHJcbiAgICAgICAgICAgICdwcHR4JzogJ2RhdGE6YXBwbGljYXRpb24vdm5kLm1zLXBvd2VycG9pbnQ7YmFzZTY0LCcsXHJcbiAgICAgICAgICAgICd0eHQnOiAnZGF0YTp0ZXh0L3BsYWluO2Jhc2U2NCwnLFxyXG4gICAgICAgICAgICAncGRmJzogJ2RhdGE6YXBwbGljYXRpb24vcGRmO2Jhc2U2NCwnLFxyXG4gICAgICAgICAgICAnbXA0JzogJ2RhdGE6dmlkZW8vbXA0O2Jhc2U2NCwnLFxyXG4gICAgICAgICAgICAnbW92JzogJ2RhdGE6dmlkZW8vbXA0O2Jhc2U2NCwnXHJcbiAgICAgICAgfTtcclxuICAgICAgICBjb25zdCBmaWxlVHlwZXMgPSB7XHJcbiAgICAgICAgICAgICdqcGcnOiAnaW1hZ2UvcG5nJyxcclxuICAgICAgICAgICAgJ3BuZyc6ICdpbWFnZS9wbmcnLFxyXG4gICAgICAgICAgICAnZG9jJzogJ2FwcGxpY2F0aW9uL3ZuZC5vcGVueG1sZm9ybWF0cy1vZmZpY2Vkb2N1bWVudC53b3JkcHJvY2Vzc2luZ21sLmRvY3VtZW50JyxcclxuICAgICAgICAgICAgJ2RvY3gnOiAnYXBwbGljYXRpb24vdm5kLm9wZW54bWxmb3JtYXRzLW9mZmljZWRvY3VtZW50LndvcmRwcm9jZXNzaW5nbWwuZG9jdW1lbnQnLFxyXG4gICAgICAgICAgICAneGxzJzogJ2FwcGxpY2F0aW9uL3ZuZC5vcGVueG1sZm9ybWF0cy1vZmZpY2Vkb2N1bWVudC5zcHJlYWRzaGVldG1sLnNoZWV0JyxcclxuICAgICAgICAgICAgJ3hsc3gnOiAnYXBwbGljYXRpb24vdm5kLm9wZW54bWxmb3JtYXRzLW9mZmljZWRvY3VtZW50LnNwcmVhZHNoZWV0bWwuc2hlZXQnLFxyXG4gICAgICAgICAgICAncHB0JzogJ2FwcGxpY2F0aW9uL3ZuZC5tcy1wb3dlcnBvaW50JyxcclxuICAgICAgICAgICAgJ3BwdHgnOiAnYXBwbGljYXRpb24vdm5kLm1zLXBvd2VycG9pbnQnLFxyXG4gICAgICAgICAgICAndHh0JzogJ3RleHQvcGxhaW4nLFxyXG4gICAgICAgICAgICAncGRmJzogJ2FwcGxpY2F0aW9uL3BkZicsXHJcbiAgICAgICAgICAgICdtcDQnOiAndmlkZW8vbXA0JyxcclxuICAgICAgICAgICAgJ21vdic6ICd2aWRlby9tcDQnXHJcbiAgICAgICAgfTtcclxuICAgICAgICByZXR1cm4gcmVzdWx0Lm1hcCgoZGF0YUl0ZW06IGFueSkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBzdWZmaXggPSBkYXRhSXRlbS5uYW1lLnN1YnN0cmluZyhkYXRhSXRlbS5uYW1lLmxhc3RJbmRleE9mKCcuJykgKyAxKTtcclxuICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgIGZpbGU6IG5ldyBGaWxlKFtdLCBkYXRhSXRlbS5uYW1lLCB7IHR5cGU6IGZpbGVUeXBlc1tzdWZmaXgudG9Mb3dlckNhc2UoKV0gfSksXHJcbiAgICAgICAgICAgICAgICBjb250ZW50OiBgJHtmaWxlSGVhZGVyc1tzdWZmaXgudG9Mb3dlckNhc2UoKV19JHtkYXRhSXRlbS5iYXNlNjR9YFxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog6aKE5aSE55CG6KeG6aKRXHJcbiAgICAgKiBAcGFyYW0gcmVzdWx0XHJcbiAgICAgKi9cclxuICAgIHByb2Nlc3NWaWRlbyhyZXN1bHQ6IGFueSkge1xyXG4gICAgICAgIGNvbnN0IHVybCA9IHJlc3VsdC52YWx1ZTtcclxuICAgICAgICBjb25zdCBiYXNlNjR2YWx1ZSA9IHJlc3VsdC5iYXNlNjR2YWx1ZTtcclxuICAgICAgICBjb25zdCB2aWRlb0hlYWRlciA9ICdkYXRhOnZpZGVvL21wNDtiYXNlNjQsJztcclxuICAgICAgICBjb25zdCB2aWRlb1R5cGUgPSAndmlkZW8vbXA0JztcclxuICAgICAgICBjb25zdCB2aWRlb05hbWUgPSB1cmwuc3Vic3RyaW5nKHVybC5sYXN0SW5kZXhPZignLycpICsgMSkgKyAnLm1wNCc7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgZmlsZTogbmV3IEZpbGUoW10sIHZpZGVvTmFtZSwgeyB0eXBlOiB2aWRlb1R5cGUgfSksXHJcbiAgICAgICAgICAgIGNvbnRlbnQ6IGAke3ZpZGVvSGVhZGVyfSR7YmFzZTY0dmFsdWV9YCxcclxuICAgICAgICAgICAgdHlwZTogdmlkZW9UeXBlLFxyXG4gICAgICAgICAgICB1cmwsXHJcbiAgICAgICAgICAgIG5hbWU6IHVybC5zdWJzdHJpbmcodXJsLmxhc3RJbmRleE9mKCcvJykgKyAxKSArICcubXA0J1xyXG4gICAgICAgIH07XHJcbiAgICB9XHJcblxyXG5cclxufVxyXG5cclxuIl19
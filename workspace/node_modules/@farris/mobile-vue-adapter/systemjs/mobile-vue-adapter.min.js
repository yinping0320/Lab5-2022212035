System.register(["@farris/mobile-devkit","vue","@farris/mobile-command-services","@farris/mobile-bef","rxjs","rxjs/operators"],(function(t){"use strict";var e,n,o,i,a,r,s,c,p,u,l,d,f,h,m,v,g;return{setters:[function(t){e=t.DateUtil,n=t.App,o=t.EnumUtil,i=t.NumberUtil,a=t.StringUtil,r=t.BoolUtil,s=t.HttpMethods},function(t){c=t.reactive,p=t.createApp},function(t){u=t.HistoryBackService,l=t.RouterService,d=t.JsBridgeService},function(t){f=t.BefLookupDataService},function(t){h=t.Subject,m=t.forkJoin},function(t){v=t.map,g=t.mergeMap}],execute:function(){t({mapBindingStates:function(t){var e={entityListData:q(),currentEntityData:z(),uiState:K(),form:G(),stateMachine:M((function(){return this.$bindingStates.getStateMachine()}),"stateMachine")};return Object.assign({},e,t)},mapCommandMethods:function(t){var e={};return t.forEach((function(t){e[t]=function(e){return this.$viewModel[t](e)}})),e},mapCurrentEntityData:z,mapEntityListData:q,mapForm:G,mapProviders:function(){return function(){var t=this.$getViewModel(),e=new f(t.context),n=new tt(t.context),o=new Y;return{LookupHttpService:e,LookupMappingFn:n,uploadAttachmentService:new Z(t.context.repository),attachmentService:o,mapService:new nt}}},mapUIState:K,recomputable:M,recompute:C});var x=function(t,e){return(x=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function w(t,e){function n(){this.constructor=t}x(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var b=function(){return(b=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function y(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var o,i,a=n.call(t),r=[];try{for(;(void 0===e||e-- >0)&&!(o=a.next()).done;)r.push(o.value)}catch(t){i={error:t}}finally{try{o&&!o.done&&(n=a.return)&&n.call(a)}finally{if(i)throw i.error}}return r}function M(t,e){var n=c({stateVersion:0});return function(){var o=this;return o.$__recomputables||(o.$__recomputables={}),o.$__recomputables[e]||(o.$__recomputables[e]=n),n.stateVersion,t.call(o)}}function C(t,e){if(t.$__recomputables&&t.$__recomputables[e]){t.$__recomputables[e].stateVersion++;try{t.$forceUpdate()}catch(t){console.log("$forceUpdate",t)}}}var $=t("BindingStates",function(){function t(t){this.vueInstance=t;var e=this.vueInstance.$getViewModel();this.viewModelContext=e.context,this.subscriptionsMap=new Map}return t.prototype.getEntityListData=function(){var t=this,e="entityListData";if(!1===this.subscriptionsMap.has(e)){var n=this.viewModelContext.bindingData.changes.subscribe((function(n){C(t.vueInstance,e)}));this.subscriptionsMap.set(e,n)}return this.viewModelContext.bindingData.getList().toJSON()},t.prototype.getCurrentEntityData=function(){var t=this,e="currentEntityData";if(!1===this.subscriptionsMap.has(e)){var n=this.viewModelContext.bindingData.changes.subscribe((function(n){C(t.vueInstance,e)}));this.subscriptionsMap.set(e,n)}return this.viewModelContext.bindingData.getObject().toJSON()},t.prototype.getUIState=function(){var t=this,e="uiState";if(!1===this.subscriptionsMap.has(e)){var n=this.viewModelContext.uiState.changes.subscribe((function(){C(t.vueInstance,e)}));this.subscriptionsMap.set(e,n)}return this.viewModelContext.uiState},t.prototype.getForm=function(){var t=this,e="form";if(!1===this.subscriptionsMap.has(e)){var n=this.viewModelContext.bindingData.changes.subscribe((function(n){n&&"ValueChanged"===n.type&&t.viewModelContext.form.getFieldErrorByPath(n.path),C(t.vueInstance,e)})),o=this.viewModelContext.form.changes.subscribe((function(n){if(n&&"validateFieldsFinished"===n.type)C(t.vueInstance,e);else if(n&&"singleHanded"===n.type){var o=t.vueInstance.$children.findIndex((function(t){return t.$attrs.id==="form_"+n.value}));t.vueInstance.$children[o].$forceUpdate()}}));this.subscriptionsMap.set(e,n),this.subscriptionsMap.set("formV",o)}return this.vueInstance.$getViewModel().form},t.prototype.getStateMachine=function(){var t=this,e="stateMachine";if(!1===this.subscriptionsMap.has(e)){var n=this.viewModelContext.stateMachine.stateChange.subscribe((function(n){C(t.vueInstance,e)}));this.subscriptionsMap.set(e,n)}return this.viewModelContext.stateMachine.renderStates},t}()),I=function(){function t(t,e){this.listviewInstance=t,this.viewModelContext=e}return t.prototype.extend=function(){var t=this,e=this;this.viewModelContext.appContext.eventBus.subscribe(this.viewModelContext.id+"-listview-extend",(function(e){"listviewFinished"===e.type&&t.viewModelContext.uiState.setPropertyValue("listaviewState",b({},t.viewModelContext.uiState.listaviewState,{loadMoreFinished:!0})),"listviewUnFinished"===e.type&&t.viewModelContext.uiState.setPropertyValue("listaviewState",b({},t.viewModelContext.uiState.listaviewState,{loadMoreFinished:!1})),"loadDataFinished"===e.type&&t.viewModelContext.uiState.setPropertyValue("listaviewState",b({},t.viewModelContext.uiState.listaviewState,{refreshLoading:!1,loadMoreLoading:!1}))})),this.listviewInstance.$on("selectChange",(function(t){var n=t.data.id;e.viewModelContext.bindingData.getList().setCurrentId(n,!0,!0)})),this.listviewInstance.$on("itemClick",(function(){var t=e.listviewInstance.getSelectDataList(),n=[];t&&t.length>0&&(n=t.map((function(t){return t.id}))),e.viewModelContext.uiState.setPropertyValue("selectedIds",n)})),this.listviewInstance.$on("refresh",(function(){e.viewModelContext.repository.setPaginationInfo({pageIndex:1}),e.viewModelContext.uiState.setPropertyValue("listaviewState",b({},e.viewModelContext.uiState.listaviewState,{refreshLoading:!0,loadMoreLoading:!0})),e.viewModelContext.appContext.eventBus.triggerEvent({type:"LoadData"})})),this.listviewInstance.$on("load",(function(){if(!e.viewModelContext.uiState.listaviewState.loadMoreLoading){e.viewModelContext.uiState.setPropertyValue("listaviewState",b({},e.viewModelContext.uiState.listaviewState,{loadMoreLoading:!0}));var t=e.viewModelContext.repository.paginationInfo&&e.viewModelContext.repository.paginationInfo.pageIndex;t||(t=0),e.viewModelContext.repository.setPaginationInfo({pageIndex:t+=1}),e.viewModelContext.appContext.eventBus.triggerEvent({type:"LoadData"})}}))},t.prototype.dispose=function(){this.listviewInstance.$off("selectChange"),this.listviewInstance.$off("itemClick"),this.listviewInstance.$off("load"),this.viewModelContext.appContext.eventBus.unsubscribe(this.viewModelContext.id+"-listview-extend")},t}(),S=function(){function t(t,e){this.lookupInstance=t,this.viewModelContext=e}return t.prototype.extend=function(){},t.prototype.dispose=function(){console.log("Lookup disposed...")},t}(),P=function(){function t(t,e){this.attachmentInstance=t,this.viewModelContext=e}return t.prototype.extend=function(){var t=this;this.attachmentInstance.$on("beforeSelect",(function(e){var n=e.id;t.viewModelContext.bindingData.getList().setCurrentId(n,!0,!1)}))},t.prototype.dispose=function(){this.attachmentInstance.$off("beforeSelect")},t}(),k=function(){function t(t,e){this.filterInstance=t,this.viewModelContext=e}return t.prototype.extend=function(){var t=this;this.filterInstance.$on("clear",(function(){t.viewModelContext.uiState.setPropertyValue("filterState",{filters:null})})),this.filterInstance.$on("search",(function(e){t.viewModelContext.repository.setPaginationInfo({pageIndex:1}),t.viewModelContext.uiState.setPropertyValue("filterState",{filters:e.FilterConditions}),t.viewModelContext.appContext.eventBus.triggerEvent({type:"LoadData"})})),this.filterInstance.$on("confirm",(function(e){t.viewModelContext.repository.setPaginationInfo({pageIndex:1}),t.viewModelContext.uiState.setPropertyValue("filterState",{filters:e.FilterConditions}),t.viewModelContext.appContext.eventBus.triggerEvent({type:"LoadData"})}))},t.prototype.dispose=function(){this.filterInstance.$off("clear"),this.filterInstance.$off("change"),this.filterInstance.$off("confirm")},t}(),E=function(){function t(t,e){this.tabInstance=t,this.viewModelContext=e,this.viewModelContext.uiState.setPropertyValue("tabState",{currentTab:t.currentName})}return t.prototype.extend=function(){var t=this;this.tabInstance.$on("change",(function(e){window.MOBILE_ORIGIN_BACK&&window.MOBILE_ORIGIN_BACK.reflushOriginGoback(),e.name!==t.viewModelContext.uiState.tabState.currentTab&&(t.viewModelContext.uiState.setPropertyValue("tabState",{currentTab:e.name}),t.viewModelContext.repository.setPaginationInfo({pageIndex:1}),t.viewModelContext.appContext.eventBus.triggerEvent({type:"LoadData"}))}))},t.prototype.dispose=function(){this.tabInstance.$off("change")},t}(),D=function(){function t(t,e){this.searchInstance=t,this.viewModelContext=e}return t.prototype.extend=function(){var t=this;this.searchInstance.$on("cancel",(function(e){t.viewModelContext.repository.setPaginationInfo({pageIndex:1}),t.viewModelContext.appContext.eventBus.triggerEvent({type:"LoadData"})})),this.searchInstance.$on("search",(function(e){t.viewModelContext.repository.setPaginationInfo({pageIndex:1}),t.viewModelContext.appContext.eventBus.triggerEvent({type:"LoadData"})}))},t.prototype.dispose=function(){this.searchInstance.$off("cancel"),this.searchInstance.$off("search")},t}(),L=function(){function t(t,e){this.checkboxInstance=t,this.viewModelContext=e}return t.prototype.extend=function(){var t=this;this.checkboxInstance.$parent.listCheckStart(),this.checkboxInstance.$on("click",(function(){console.log("click"),t.checkboxInstance.$parent.checkboxFlag?t.checkboxInstance.$parent.listCheckAllCancel():t.checkboxInstance.$parent.listCheckAll(),t.checkboxInstance.$parent.checkboxFlag=!t.checkboxInstance.$parent.checkboxFlag;var e=t.checkboxInstance.$parent.getSelectDataList(),n=[];e&&e.length>0&&(n=e.map((function(t){return t.id}))),t.viewModelContext.uiState.setPropertyValue("selectedIds",n)}))},t.prototype.dispose=function(){this.checkboxInstance.$off("click")},t}(),F=function(){function t(t,e){this.mapInstance=t,this.viewModelContext=e}return t.prototype.extend=function(){var t=this;this.mapInstance.$on("markMap",(function(e){var n=e.lnglat,o=n.lng,i=n.lat,a=t.mapInstance.lngPath,r=t.mapInstance.latPath;t.viewModelContext.bindingData.setValue(t.getBindingPathArray().concat(a.split("/")),o,!0,!0),t.viewModelContext.bindingData.setValue(t.getBindingPathArray().concat(r.split("/")),i,!0,!0)}))},t.prototype.dispose=function(){this.mapInstance.$off("markMap")},t.prototype.getBindingPathArray=function(){var t=this.viewModelContext.bindingData.bindingPath;return t?t.split("/").filter((function(t){return""!==t})):[]},t}(),V=function(){function t(t){this.viewModelContext=t}return t.prototype.create=function(t,e){var n;switch(e){case"fm-listview":n=new I(t,this.viewModelContext);break;case"Lookup":n=new S(t,this.viewModelContext);break;case"fm-filter":n=new k(t,this.viewModelContext);break;case"fm-tabs":n=new E(t,this.viewModelContext);break;case"van-search":n=new D(t,this.viewModelContext);break;case"Checkbox":n=new L(t,this.viewModelContext);break;case"fm-attachment":n=new P(t,this.viewModelContext);break;case"Map":n=new F(t,this.viewModelContext);break;default:n=null}return n},t}(),A=function(){function t(t){this.viewModelContext=t,this.extenderMap=new Map,this.extenderFactory=new V(t)}return t.prototype.getExtender=function(t,e){if(this.extenderMap.has(t))return this.extenderMap.get(t);var n=this.extenderFactory.create(t,e);return this.extenderMap.set(t,n),n},t}(),O=function(t,e){if(t[e[0]])return e.reduce((function(t,e){return t[e]}),t)},_=function(t,e){var n=t.length<e.length?t.length:e.length,o="",i=0;for(i=0;i<n;i++)o+=t.substring(i,i+1),o+=e.substring(i,i+1);return o+=t.length<e.length?e.substring(i):t.substring(i)},B=function(t){var e=[1,2,3];t.length>24&&(t=t.substring(0,24));var n=Math.floor(t.length/3),o=t.substring(0,n),i=t.substring(n,2*n),a=t.substring(2*n,3*n),r=[],s=Math.ceil(3*Math.random());r.push(e[s-1]),e.splice(s-1,1),s=Math.ceil(2*Math.random()),r.push(e[s-1]),e.splice(s-1,1),r.push(e[0]);var c=Math.round((new Date).getTime()/1e3)+"";return c.substring(0,5)+"times"+r[0]+r[1]+r[2]+j(o,i,a,r[0])+j(o,i,a,r[1])+j(o,i,a,r[2])+"times"+c.substring(5)},j=function(t,e,n,o){switch(o){case 1:return t;case 2:return e;case 3:return n}},T={doc:"/platform/common/web/assets/fm-attachment/word.png",docx:"/platform/common/web/assets/fm-attachment/word.png",xls:"/platform/common/web/assets/fm-attachment/excel.png",xlsx:"/platform/common/web/assets/fm-attachment/excel.png",ppt:"/platform/common/web/assets/fm-attachment/ppt.png",pptx:"/platform/common/web/assets/fm-attachment/ppt.png",pdf:"/platform/common/web/assets/fm-attachment/pdf.png",txt:"/platform/common/web/assets/fm-attachment/txt.png",jpg:"/platform/common/web/assets/fm-attachment/img.png",jpeg:"/platform/common/web/assets/fm-attachment/img.png",png:"/platform/common/web/assets/fm-attachment/img.png"},N=function(t,e,n){return Object.keys(T).find((function(t){return t===n.toLowerCase()}))?T[n.toLowerCase()]:"/api/runtime/dfs/v1.0/doc/filecontent?metadataid="+t+"&rootid="+e+"&token="+B(_(t,e))},U=function(){function t(){}return t.toHandlerKey=function(t){return t?"on"+this.capitalize(t):""},t.camelize=function(t){return t.replace(/-(\w)/g,(function(t,e){return e?e.toUpperCase():""}))},t.capitalize=function(t){return t.charAt(0).toUpperCase()+t.slice(1)},t}(),R=function(){var t=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var n=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"===e?n:3&n|8).toString(16)}))},H={enum:function(t,e){return o.format(t,e)},date:function(t,n){return e.format(t,n)},dateOperation:function(t,n){return e.dateOperation(t,n)},number:function(t,e){return i.format(t,e)},string:function(t,e){return a.format(t,e)},bool:function(t,e){return r.format(t,e)}},J=t("DevkitPlugin",{install:function(t,e){t.config.globalProperties.$on=function(t,e){var n=this._.vnode.props,o=U.toHandlerKey(t),i=n[o];n[o]=i?function(t){e(t),i(t)}:e},t.config.globalProperties.$off=function(t){this._.vnode.props[U.toHandlerKey(t)]=null},t.config.globalProperties.$app=null,t.config.globalProperties.$viewModel=null,t.config.globalProperties.$bindingStates=null,t.config.globalProperties.$componentExtenderManager=null,t.config.globalProperties.$createApp=function(t){if(this.$app)throw new Error("App已经存在");var e=new u;e.init(),e.proxyBack(),this.$app=new n(t),window.IsDddedMessageEventListener||(window.addEventListener("message",function(t){var e=this.$app.context.injector.get("DECLARATIONS_TOKEN"),n=JSON.parse(t.data).data.command,o=e.commands[n];t.origin,t.source;var i=this.$app.context.viewModelContextManager.getContextById(o.viewModelId);i&&i.viewModel[o.command]().pipe((function(){}),(function(){}),(function(){window.parent&&window.parent.postMessage("success",t.origin)}))}.bind(this),!1),window.IsDddedMessageEventListener=!0)},t.config.globalProperties.$getApp=function(){for(var t=this.$app,e=this;!t&&e.$parent;)t=(e=e.$parent).$app;return t},t.config.globalProperties.$createViewModel=function(t){if(this.$app=this.$getApp(),!this.$app)throw new Error("请先创建App");var e=t.id;if(e){var n=this.$app.context.viewModelContextManager.getContextById(e);n&&(this.$viewModel=n.viewModel)}if(!this.$viewModel){var o=this.$getViewModel();t.parent||(t.parent=o),this.$viewModel=this.$app.createViewModel(t)}this.$bindingStates=new $(this),this.$viewModel.injector.get(l).mappingToUIState(),this.$viewModel&&this.$viewModel.uiState&&this.$viewModel.uiState.routerState&&this.$viewModel.uiState.routerState.queryParams&&this.$viewModel.uiState.routerState.queryParams.clearCachedDataForCard&&(this.$viewModel.context.bindingData.getList().currentId=null),this.$viewModel&&this.$viewModel.uiState&&this.$viewModel.uiState.routerState&&this.$viewModel.uiState.routerState.queryParams&&this.$viewModel.uiState.routerState.queryParams.clearCachedDataForList&&this.$viewModel.repository.entityCollection.clear()},t.config.globalProperties.$getViewModel=function(){for(var t=this,e=t.$viewModel;!e&&t.$parent;)e=(t=t.$parent).$viewModel;return e},t.config.globalProperties.$initComponentExtenderManager=function(){var t=this.$getViewModel();this.$componentExtenderManager=new A(t.context)},t.config.globalProperties.$getComponentExtenderManager=function(){for(var t=this,e=t.$componentExtenderManager;!e&&t.$parent;)e=(t=t.$parent).$componentExtenderManager;return e},t.config.globalProperties.$bindComponentExtenders=function(t){var e=this;this.$refs&&Object.values(this.$refs).forEach((function(t){var n=t._.type.name;e.$bindComponentExtender(t,n)}))},t.config.globalProperties.$bindComponentExtender=function(t,e){if(!0!==t.$__component_extended){var n=this.$getComponentExtenderManager().getExtender(t,e);n&&(n.extend(),t.$__component_extended)}},t.config.globalProperties.$unbindComponentExtenders=function(t){var e=this;this.$refs&&Object.values(this.$refs).forEach((function(t){e.$unbindComponentExtender(t)}))},t.config.globalProperties.$unbindComponentExtender=function(t){var e=this.$getComponentExtenderManager().getExtender(t);e&&e.dispose()},t.config.globalProperties.$initPage=function(t){this.$createViewModel(t),this.$initComponentExtenderManager(),this.$viewModel.uiState.pageTitle&&this.$changeDocumentTitle(this.$viewModel.uiState.pageTitle),this.$initUistate()},t.config.globalProperties.$changeDocumentTitle=function(t){document.title=t||document.title},t.config.globalProperties.$formatUtils=H,t.config.globalProperties.$initUistate=function(){this.$viewModel.uiState.listaviewState={refreshLoading:!1,loadMoreLoading:!1,loadMoreFinished:!1},this.$viewModel.uiState.searchState={keyword:""},this.$viewModel.uiState.filterState={filters:"",filterData:""},this.$viewModel.uiState.tabState={currentTab:""}}}});function q(){return M((function(){return this.$bindingStates.getEntityListData()}),"entityListData")}function z(){return M((function(){return this.$bindingStates.getCurrentEntityData()}),"currentEntityData")}function K(){return M((function(){return this.$bindingStates.getUIState()}),"uiState")}function G(){return M((function(){return this.$bindingStates.getForm()}),"form")}var Q=function(){function t(){}return t.prototype.takePhotoAttachment=function(){},t.prototype.takeShortVideo=function(){},t.prototype.selectFile=function(){},t.prototype.downloadAttachment=function(){},t}(),W=function(){function t(){this.collectFile=new h}return t.prototype.takePhoto=function(t){this.takePhotoIns.takePhotoAttachment(t)},t.prototype.selectAttachment=function(t){this.takePhotoIns.selectAttachments(t)},t.prototype.takeShortVideo=function(t){this.takePhotoIns.takeShortVideo(t)},t.prototype.playShortVideo=function(t){this.takePhotoIns.playShortVideo(t)},t.prototype.selectFile=function(t){this.takePhotoIns.selectFile(t)},t.prototype.downloadAttachment=function(t){this.takePhotoIns.downloadAttachment(t)},t.prototype.getSysInfo=function(){return this.takePhotoIns.getSysInfo()},t}(),X=function(){function t(t){this.collectFile=t,this.jsBrigdeService=new d}return t.prototype.takeShortVideo=function(t){var e=this;this.jsBrigdeService.takeVideo(t).subscribe((function(t){var n=e.processVideo(t);e.collectFile.next(n)}))},t.prototype.takePhotoAttachment=function(t){var e=this;this.jsBrigdeService.takePhoto(t).subscribe((function(t){var n=e.processPic(t);e.collectFile.next(n)}))},t.prototype.selectAttachments=function(t){var e=this;this.jsBrigdeService.selectPictureFromAlbum(t).subscribe((function(t){var n=e.processPic(t);e.collectFile.next(n)}))},t.prototype.selectFile=function(t){var e=this;this.jsBrigdeService.selectFile(t).subscribe((function(t){var n=e.processFile(t);e.collectFile.next(n)}))},t.prototype.downloadAttachment=function(t){return this.jsBrigdeService.downloadFile(t)},t.prototype.getSysInfo=function(){return this.jsBrigdeService.getSysInfo()},t.prototype.playShortVideo=function(t){var e=this;window.iCityBridge.ccworkPlayShortVideo({path:t},(function(t){var n=t.result,o=e.processVideo(n);e.collectFile.next(o)}))},t.prototype.processPic=function(t){var e="data:image/jpeg;base64,",n="image/png";return"string"==typeof t?{file:new File([],"image_"+R().substring(0,6)+".png",{type:n}),content:""+e+t}:t.map((function(t){return"string"==typeof t?{file:new File([],"image_"+R().substring(0,6)+".png",{type:n}),content:""+e+t}:{file:new File([],"image_"+R().substring(0,6)+".png",{type:n}),content:""+e+t.content}}))},t.prototype.processFile=function(t){var e={jpg:"data:image/jpeg;base64,",png:"data:image/jpeg;base64,",doc:"data:application/vnd.openxmlformats-officedocument.wordprocessingml.document;base64,",docx:"data:application/vnd.openxmlformats-officedocument.wordprocessingml.document;base64,",xls:"data:application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;base64,",xlsx:"data:application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;base64,",ppt:"data:application/vnd.ms-powerpoint;base64,",pptx:"data:application/vnd.ms-powerpoint;base64,",txt:"data:text/plain;base64,",pdf:"data:application/pdf;base64,",mp4:"data:video/mp4;base64,",mov:"data:video/mp4;base64,"},n={jpg:"image/png",png:"image/png",doc:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",docx:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",xls:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",ppt:"application/vnd.ms-powerpoint",pptx:"application/vnd.ms-powerpoint",txt:"text/plain",pdf:"application/pdf",mp4:"video/mp4",mov:"video/mp4"};return t.map((function(t){var o=t.name.substring(t.name.lastIndexOf(".")+1);return{file:new File([],t.name,{type:n[o.toLowerCase()]}),content:""+e[o.toLowerCase()]+t.base64}}))},t.prototype.processVideo=function(t){var e=t.value,n=t.base64value,o="video/mp4",i=e.substring(e.lastIndexOf("/")+1)+".mp4";return{file:new File([],i,{type:o}),content:"data:video/mp4;base64,"+n,type:o,url:e,name:e.substring(e.lastIndexOf("/")+1)+".mp4"}},t}();!function(t){function e(){var e=t.call(this)||this;return e.takePhotoIns=new Q,e}w(e,t)}(W);var Y=function(t){function e(){var e=t.call(this)||this;return e.takePhotoIns=new X(e.collectFile),e}return w(e,t),e}(W),Z=function(){function t(t){this.befRepository=t}return t.prototype.upload=function(t,e){var n=this.befRepository.apiProxy,o=t.map((function(t){return{docInfo:{fileContent:t.content.substring(t.content.indexOf(",")+1),fileName:t.file.name,index:0,total:1,metadataId:t.id},formId:e.parentDirName,mode:1,rootId:e.rootId||"default-root"}})).map((function(t){var e={body:t};return n.request(s.POST,"/api/runtime/dfs/v1.0/formdoc",e,!0)}));return m(o)},t.prototype.previewPdf=function(t,e){var n=this.befRepository.apiProxy,o={body:{storageType:2,filePath:JSON.stringify({rootId:t,metadataIdList:e})}};return n.request(s.POST,"/api/runtime/dfs/v1.0/fileviewer/filelist",o).pipe(v((function(t){return"/platform/runtime/dfs/web/pdfjs/viewer.html?file="+encodeURIComponent(t[0].filePath)})))},t.prototype.previewDoc=function(t,e){var n=this.befRepository.apiProxy,o={body:{storageType:2,filePath:JSON.stringify({rootId:t,metadataIdList:e})}};return n.request(s.POST,"/api/runtime/dfs/v1.0/fileviewer/filelist",o).pipe(g((function(t){return n.request(s.POST,"/api/runtime/dfs/v1.0/docviewer/loaddocument",{body:{filePath:t[0].filePath}})})),v((function(t){return t.pages})))},t.prototype.getAttachmentPath=function(t,e){return"/api/runtime/dfs/v1.0/doc/filecontent?metadataid="+t+"&rootid="+e+"&token="+B(_(t,e))},t}(),tt=t("LookupMappingService",function(){function t(t){this.viewModelContext=t}return t.prototype.mapFields=function(t,e){var n=this;if(console.log(t),e){var o=Object.keys(e),i=o.findIndex((function(t){return"id"===t}));o.includes("id")&&0!==i&&(o.splice(i,1),o=function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(y(arguments[e]));return t}(["id"],o));var a=this;o.forEach((function(o){var i="";t&&(i=t instanceof Array?t.map((function(t){return n.getValue(o,t)})).join(","):a.getValue(o,t));var r=a.getBindingPathArray();e[o].split(",").forEach((function(e){t&&a.viewModelContext.bindingData.setValue(r.concat(e.split(".")),i,!0,!0)}))}))}},t.prototype.getFieldValue=function(t){var e=this.getBindingPathArray().concat(t.split("."));return this.viewModelContext.bindingData.getValue(e)},t.prototype.getValue=function(t,e){return-1===t.indexOf(".")?e[t]:t.split(".").reduce((function(t,e){return t[e]}),e)},t.prototype.getBindingPathArray=function(){var t=this.viewModelContext.bindingData.bindingPath;return t?t.split("/").filter((function(t){return""!==t})):[]},t}()),et=function(){function t(t){this.location$=t}return t.prototype.getCurrentLoc=function(){var t=this;window.iCityBridge&&window.iCityBridge.ccworkGetLocation((function(e){alert(JSON.stringify(e)),t.location$.next(t.assembleMarkers(e))}))},t.prototype.locationCallback=function(t){alert(JSON.stringify(t)),this.location$.next(this.assembleMarkers(t))},t.prototype.assembleMarkers=function(t){var e=t.result;return[{position:[Number(e.lng),Number(e.lat)],visible:!0,draggable:!0}]},t}(),nt=function(t){function e(){var e=t.call(this)||this;return e.locationInstance=new et(e.location$),e}return w(e,t),e}(function(){function t(){this.location$=new h}return t.prototype.getCurrentLocation=function(){this.locationInstance.getCurrentLoc()},t.prototype.getMapMarkers=function(){return this.location$},t.prototype.setMapMarkers=function(){},t}());t("bindListviewExtenderDir",{mounted:function(t,e,n,o){var i=n.componentInstance;console.log(i),i.$bindComponentExtender(i,"Listview")},unmounted:function(t,e,n,o){var i=n.componentInstance;i.$unbindComponentExtender(i)}}),t("bindLookupExtenderDir",{mounted:function(t,e,n,o){var i=n.componentInstance;i.$bindComponentExtender(i,"Lookup")},unmounted:function(t,e,n,o){var i=n.componentInstance;i.$unbindComponentExtender(i)}}),t("bindFilterExtenderDir",{mounted:function(t,e,n,o){var i=n.componentInstance;i.$bindComponentExtender(i,"Filter")},unmounted:function(t,e,n,o){var i=n.componentInstance;i.$unbindComponentExtender(i)}}),t("bindTabExtenderDir",{mounted:function(t,e,n,o){var i=n.componentInstance;i.$bindComponentExtender(i,"Tab")},unmounted:function(t,e,n,o){var i=n.componentInstance;i.$unbindComponentExtender(i)}}),t("bindSearchExtenderDir",{mounted:function(t,e,n,o){var i=n.children[0].children[0].componentInstance;i.$bindComponentExtender(i,"Search")},unmounted:function(t,e,n,o){var i=n.children[0].children[0].componentInstance;i.$unbindComponentExtender(i)}}),t("bindRefleshExtenderDir",{mounted:function(t,e,n,o){var i=n.componentInstance;i.$bindComponentExtender(i,"Reflesh")},unmounted:function(t,e,n,o){var i=n.componentInstance;i.$unbindComponentExtender(i)}}),t("bindCheckboxExtenderDir",{mounted:function(t,e,n,o){var i=n.componentInstance;i.$bindComponentExtender(i,"Checkbox")},unmounted:function(t,e,n,o){var i=n.componentInstance;i.$unbindComponentExtender(i)}}),t("bindAttachmentExtenderDir",{mounted:function(t,e,n,o){var i=n.componentInstance;i.$bindComponentExtender(i,"Attachment")},unmounted:function(t,e,n,o){var i=n.componentInstance;i.$unbindComponentExtender(i)}}),t("bindMapExtenderDir",{mounted:function(t,e,n,o){var i=n.componentInstance,a=e.value;i.lngPath=a.lngPath,i.latPath=a.latPath,i.$bindComponentExtender(i,"Map")},unmounted:function(t,e,n,o){var i=n.componentInstance;i.$unbindComponentExtender(i)}}),t("DateConverter",function(){function t(t){this.format=t}return t.prototype.convertFrom=function(t){if(!t)return"0001-01-01T00:00:00";var n=this.format?this.format:"yyyy-MM-dd HH:mm:ss";return e.format(t,n)},t.prototype.convertTo=function(t){return!0===e.isEmptyDateString(t)?null:e.parse(t)},t}()),t("StringArrayConverter",function(){function t(t){void 0===t&&(t=","),this.separator=t}return t.prototype.convertFrom=function(t){return t.join(this.separator)},t.prototype.convertTo=function(t){return t.split(this.separator)},t}()),t("filterData",(function(t,e,n,o){void 0===o&&(o=!0);var i=e.split("/").filter((function(t){return t}));if(!o){var a=O(t,i),r="/platform/common/web/assets/imgs/no-pic.png";if(!a||!a.attachmentId)return r;var s=a.fileName.substring(a.fileName.lastIndexOf(".")+1);return r=N(a.attachmentId,n,s)}return t.map((function(t){var e=O(t,i),o="/platform/common/web/assets/imgs/no-pic.png";if(!e||!e.attachmentId)return{url:o,id:t.id,attachmentId:e.attachmentId,name:"",size:0,createTime:""};var a=e.fileName.substring(e.fileName.lastIndexOf(".")+1);return{url:o=N(e.attachmentId,n,a),id:t.id,attachmentId:e.attachmentId,name:e.fileName,size:e.fileSize,createTime:e.fileCreateTime}}))})),t("filterMapData",(function(t,e,n){return[{position:[O(t,e.split("/"))||117.12212,O(t,n.split("/"))||35.3243]}]})),t("AppCreator",function(){function t(){}return t.createApp=function(t){return this.app=p(t),this.app.use(J),this.app},t.createDirective=function(t,e){this.app.directive(t,e)},t.app=null,t}())}}}));

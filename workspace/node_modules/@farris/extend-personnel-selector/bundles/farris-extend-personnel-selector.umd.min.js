!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@farris/devkit"),require("@angular/core"),require("@farris/ui-personnel-selector"),require("@farris/ui-messager")):"function"==typeof define&&define.amd?define("@farris/extend-personnel-selector",["exports","@farris/devkit","@angular/core","@farris/ui-personnel-selector","@farris/ui-messager"],t):t((e.farris=e.farris||{},e.farris["extend-personnel-selector"]={}),e.devkit,e.ng.core,e.uiPersonnelSelector,e.uiMessager)}(this,function(e,t,n,r,o){"use strict";function i(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),a=[];try{for(;(void 0===t||0<t--)&&!(r=i.next()).done;)a.push(r.value)}catch(s){o={error:s}}finally{try{r&&!r.done&&(n=i["return"])&&n.call(i)}finally{if(o)throw o.error}}return a}function s(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(i(arguments[t]));return e}var a=(l.prototype.ngOnInit=function(){var n=this;this.targetComponent.selectionsChange.subscribe(function(e){var t=n.mapFields;e.data&&e.data.length?n.mappingData(e.data,t):n.mappingData(null,t)}),this.targetComponent.inputClear.subscribe(function(){var e=n.mapFields;n.mappingData(null,e)}),this.targetComponent.tagRemoved.subscribe(function(e){var t=n.mapFields;n.tagRemovedMappingData(e.deleteIndex,t)}),this.targetComponent.mapFields||(this.targetComponent.mapFields=this.mapFields)},l.prototype.ngAfterViewInit=function(){},l.prototype.ngOnDestroy=function(){},l.prototype.tagRemovedMappingData=function(n,e){var r,t,o,i,a=this;e&&this.targetComponent.ngControl&&this.targetComponent.ngControl.formDirective&&this.targetComponent.ngControl.formDirective.form&&this.targetComponent.ngControl.formDirective.form.bindingData&&((r=this.targetComponent.ngControl.formDirective.form.bindingData).setValue&&((t=this.vm.frameContext.appContext).changeDetectionController.detach(),e=(o=Object.keys(e)).findIndex(function(e){return e===a.targetComponent.idField}),o.includes(this.targetComponent.idField)&&0!==e&&(o.splice(e,1),o=s([this.targetComponent.idField],o)),i=this.getBindingPathArray(),e=this.mapFields[o[0]].split(","),(!(e=r.getValue(i.concat(e[0])))||e.split(",").length<2)&&o.reverse(),o.forEach(function(e){a.mapFields[e].split(",").forEach(function(e){var t=i.concat(e.split("."));a.targetComponent.ngControl.path.join()!==t.join()&&((e=r.getValue(t))?((e=e.split(",")).splice(n,1),(e=e.join())?r.setValue(t,e,!0,!0):r.clearValue(t,!0,!0)):r.clearValue(t,!0,!0))})}),t.changeDetectionController.reattach()))},l.prototype.mappingData=function(o,e){var t,n,r,i=this;e&&((t=this.vm.frameContext.appContext).changeDetectionController.detach(),r=(n=Object.keys(e)).findIndex(function(e){return e===i.targetComponent.idField}),n.includes(this.targetComponent.idField)&&0!==r&&(n.splice(r,1),n=s([this.targetComponent.idField],n)),o||n.reverse(),n.forEach(function(t){var n="";o&&(n=o instanceof Array?o.map(function(e){return i.getValue(t,e)}).join(","):i.getValue(t,o));var r=i.getBindingPathArray();e[t].split(",").forEach(function(e){i.targetComponent.ngControl.path.join()!==e&&(o?i.vm.bindingData.setValue(r.concat(e.split(".")),n,!0,!0):i.vm.bindingData.clearValue(r.concat(e.split(".")),!0,!0))})}),t.changeDetectionController.reattach())},l.prototype.getValue=function(e,t){return-1===e.indexOf(".")?t[e]:e.split(".").reduce(function(e,t){return e[t]},t)},l.prototype.getBindingPathArray=function(){var e=this.vm.bindingPath;return e?e.split("/").filter(function(e){return""!==e}):[]},l.decorators=[{type:n.Directive,args:[{selector:"[personnel-selector-data-mapping]"}]}],l.ctorParameters=function(){return[{type:t.ViewModel,decorators:[{type:n.Optional}]},{type:r.PersonnelSelectorComponent,decorators:[{type:n.Optional},{type:n.Self}]},{type:n.Injector}]},l.propDecorators={mapFields:[{type:n.Input}]},l);function l(e,t,n){this.vm=e,this.targetComponent=t,this.injector=n}p.decorators=[{type:n.NgModule,args:[{declarations:[a],imports:[r.PersonnelSelectorModule,o.MessagerModule],exports:[a]}]}],o=p;function p(){}e.PersonnelSelectorDataMappingDirective=a,e.ExtendPersonnelSelectorModule=o,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=farris-extend-personnel-selector.umd.min.js.map
/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
/**
 * 使用方法：
 * [mapFields]="{ id: 'user.userId', name: 'user.userName' }"
 * key 为帮助上的字段， value 为 表单中的字段名
 * 帮助上的同一个字段可以映射到表单中的多个字段中，{ ... id: 'user.userid, user.addusid'}
 * 多字段以逗号隔开
 *
 */
import { Directive, Optional, Self, Input, Injector } from '@angular/core';
import { ViewModel } from '@farris/devkit';
import { PersonnelSelectorComponent } from '@farris/ui-personnel-selector';
var PersonnelSelectorDataMappingDirective = /** @class */ (function () {
    function PersonnelSelectorDataMappingDirective(vm, targetComponent, injector) {
        this.vm = vm;
        this.targetComponent = targetComponent;
        this.injector = injector;
    }
    /**
     * @return {?}
     */
    PersonnelSelectorDataMappingDirective.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.targetComponent.selectionsChange.subscribe((/**
         * @param {?} data
         * @return {?}
         */
        function (data) {
            /** @type {?} */
            var mapfields = _this.mapFields;
            if (data.data && data.data.length) {
                _this.mappingData(data.data, mapfields);
            }
            else {
                _this.mappingData(null, mapfields);
            }
        }));
        this.targetComponent.inputClear.subscribe((/**
         * @return {?}
         */
        function () {
            /** @type {?} */
            var mapfields = _this.mapFields;
            _this.mappingData(null, mapfields);
        }));
        this.targetComponent.tagRemoved.subscribe((/**
         * @param {?} data
         * @return {?}
         */
        function (data) {
            /** @type {?} */
            var mapfields = _this.mapFields;
            _this.tagRemovedMappingData(data.deleteIndex, mapfields);
            // if (this.targetComponent.selections && this.targetComponent.selections.length) {
            //     this.mappingData(this.targetComponent.selections, mapfields);
            // } else {
            //     this.mappingData(null, mapfields);
            // }
        }));
        if (!this.targetComponent.mapFields) {
            this.targetComponent.mapFields = this.mapFields;
        }
    };
    /**
     * @return {?}
     */
    PersonnelSelectorDataMappingDirective.prototype.ngAfterViewInit = /**
     * @return {?}
     */
    function () {
    };
    /**
     * @return {?}
     */
    PersonnelSelectorDataMappingDirective.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
    };
    /**
     * @param {?} index
     * @param {?} mapFields
     * @return {?}
     */
    PersonnelSelectorDataMappingDirective.prototype.tagRemovedMappingData = /**
     * @param {?} index
     * @param {?} mapFields
     * @return {?}
     */
    function (index, mapFields) {
        var _this = this;
        if (!mapFields) {
            return;
        }
        if (this.targetComponent.ngControl &&
            this.targetComponent.ngControl.formDirective &&
            this.targetComponent.ngControl.formDirective.form &&
            this.targetComponent.ngControl.formDirective.form.bindingData) {
            /** @type {?} */
            var bindingData_1 = this.targetComponent.ngControl.formDirective.form.bindingData;
            if (bindingData_1.setValue) {
                // 关闭变更检测
                /** @type {?} */
                var appContext = this.vm.frameContext.appContext;
                appContext.changeDetectionController.detach();
                /** @type {?} */
                var helpFields = Object.keys(mapFields);
                /** @type {?} */
                var idIndex = helpFields.findIndex((/**
                 * @param {?} item
                 * @return {?}
                 */
                function (item) { return item === _this.targetComponent.idField; }));
                if (helpFields.includes(this.targetComponent.idField) && idIndex !== 0) {
                    helpFields.splice(idIndex, 1);
                    helpFields = tslib_1.__spread([this.targetComponent.idField], helpFields);
                }
                /** @type {?} */
                var pathArr_1 = this.getBindingPathArray();
                /** @type {?} */
                var anyFieldArr = this.mapFields[helpFields[0]].split(',');
                /** @type {?} */
                var formAnyData = bindingData_1.getValue(pathArr_1.concat(anyFieldArr[0]));
                if (!formAnyData || formAnyData.split(',').length < 2) {
                    helpFields.reverse();
                }
                helpFields.forEach((/**
                 * @param {?} field
                 * @return {?}
                 */
                function (field) {
                    /** @type {?} */
                    var fieldArr = _this.mapFields[field].split(',');
                    fieldArr.forEach((/**
                     * @param {?} fa
                     * @return {?}
                     */
                    function (fa) {
                        /** @type {?} */
                        var path = pathArr_1.concat(fa.split('.'));
                        if (_this.targetComponent.ngControl.path.join() === path.join()) {
                            return;
                        }
                        /** @type {?} */
                        var resStr = bindingData_1.getValue(path);
                        if (!resStr) {
                            bindingData_1.clearValue(path, true, true);
                        }
                        else {
                            /** @type {?} */
                            var resArr = resStr.split(',');
                            resArr.splice(index, 1);
                            /** @type {?} */
                            var result = resArr.join();
                            if (!result) {
                                bindingData_1.clearValue(path, true, true);
                            }
                            else {
                                bindingData_1.setValue(path, result, true, true);
                            }
                        }
                    }));
                }));
                // 重新打开变更检测
                appContext.changeDetectionController.reattach();
            }
        }
    };
    /**
     *
     * @param helpData 清空时，值为null
     * @param mapFields 格式形如：{id: "assoField.assoField", code: "assoField.assoField_Code", name: "assoField.assoField_Name"}
     */
    /**
     *
     * @param {?} helpData 清空时，值为null
     * @param {?} mapFields 格式形如：{id: "assoField.assoField", code: "assoField.assoField_Code", name: "assoField.assoField_Name"}
     * @return {?}
     */
    PersonnelSelectorDataMappingDirective.prototype.mappingData = /**
     *
     * @param {?} helpData 清空时，值为null
     * @param {?} mapFields 格式形如：{id: "assoField.assoField", code: "assoField.assoField_Code", name: "assoField.assoField_Name"}
     * @return {?}
     */
    function (helpData, mapFields) {
        var _this = this;
        if (!mapFields) {
            return;
        }
        // 关闭变更检测
        /** @type {?} */
        var appContext = this.vm.frameContext.appContext;
        appContext.changeDetectionController.detach();
        /** @type {?} */
        var helpFields = Object.keys(mapFields);
        /** @type {?} */
        var idIndex = helpFields.findIndex((/**
         * @param {?} item
         * @return {?}
         */
        function (item) { return item === _this.targetComponent.idField; }));
        if (helpFields.includes(this.targetComponent.idField) && idIndex !== 0) {
            helpFields.splice(idIndex, 1);
            helpFields = tslib_1.__spread([this.targetComponent.idField], helpFields);
        }
        if (!helpData) {
            helpFields.reverse();
        }
        helpFields.forEach((/**
         * @param {?} f
         * @return {?}
         */
        function (f) {
            // 1、获取字段值
            // 如果helpData有选中值，则获取帮助数据源里对应你字段的值；
            // 如果helpData没有值（清空场景），则返回一个空字符串
            /** @type {?} */
            var val = '';
            if (helpData) {
                if (helpData instanceof Array) {
                    val = helpData.map((/**
                     * @param {?} h
                     * @return {?}
                     */
                    function (h) {
                        return _this.getValue(f, h);
                    })).join(',');
                }
                else {
                    val = _this.getValue(f, helpData);
                }
            }
            // 2、设置字段值
            // 如果helpData不存在（清空场景），获取BindingData里对应字段的值，如果是数值，则设置0，其他设置上一步中的空字符串；
            // 如果helpData存在：直接设置上一步中获取的值。
            /** @type {?} */
            var pathArr = _this.getBindingPathArray();
            mapFields[f].split(',').forEach((/**
             * @param {?} ff
             * @return {?}
             */
            function (ff) {
                if (_this.targetComponent.ngControl.path.join() === ff) {
                    return;
                }
                if (!helpData) {
                    _this.vm.bindingData.clearValue(pathArr.concat(ff.split('.')), true, true);
                }
                else {
                    _this.vm.bindingData.setValue(pathArr.concat(ff.split('.')), val, true, true);
                }
            }));
        }));
        // 重新打开变更检测
        appContext.changeDetectionController.reattach();
    };
    /**
     * @private
     * @param {?} f
     * @param {?} data
     * @return {?}
     */
    PersonnelSelectorDataMappingDirective.prototype.getValue = /**
     * @private
     * @param {?} f
     * @param {?} data
     * @return {?}
     */
    function (f, data) {
        /** @type {?} */
        var val = '';
        if (f.indexOf('.') === -1) {
            val = data[f];
        }
        else {
            val = f.split('.').reduce((/**
             * @param {?} a
             * @param {?} b
             * @return {?}
             */
            function (a, b) {
                return a[b];
            }), data);
        }
        return val;
    };
    /**
     * @private
     * @return {?}
     */
    PersonnelSelectorDataMappingDirective.prototype.getBindingPathArray = /**
     * @private
     * @return {?}
     */
    function () {
        /** @type {?} */
        var path = this.vm.bindingPath;
        if (path) {
            return path.split('/').filter((/**
             * @param {?} n
             * @return {?}
             */
            function (n) { return n !== ''; }));
        }
        return [];
    };
    PersonnelSelectorDataMappingDirective.decorators = [
        { type: Directive, args: [{
                    // tslint:disable-next-line:directive-selector
                    selector: '[personnel-selector-data-mapping]'
                },] }
    ];
    /** @nocollapse */
    PersonnelSelectorDataMappingDirective.ctorParameters = function () { return [
        { type: ViewModel, decorators: [{ type: Optional }] },
        { type: PersonnelSelectorComponent, decorators: [{ type: Optional }, { type: Self }] },
        { type: Injector }
    ]; };
    PersonnelSelectorDataMappingDirective.propDecorators = {
        mapFields: [{ type: Input }]
    };
    return PersonnelSelectorDataMappingDirective;
}());
export { PersonnelSelectorDataMappingDirective };
if (false) {
    /** @type {?} */
    PersonnelSelectorDataMappingDirective.prototype.mapFields;
    /**
     * @type {?}
     * @private
     */
    PersonnelSelectorDataMappingDirective.prototype.vm;
    /**
     * @type {?}
     * @private
     */
    PersonnelSelectorDataMappingDirective.prototype.targetComponent;
    /**
     * @type {?}
     * @private
     */
    PersonnelSelectorDataMappingDirective.prototype.injector;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmFycmlzLWV4dGVuZC1wZXJzb25uZWwtc2VsZWN0b3IuZGlyZWN0aXZlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy9leHRlbmQtcGVyc29ubmVsLXNlbGVjdG9yLyIsInNvdXJjZXMiOlsibGliL2ZhcnJpcy1leHRlbmQtcGVyc29ubmVsLXNlbGVjdG9yLmRpcmVjdGl2ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7O0FBU0EsT0FBTyxFQUFFLFNBQVMsRUFBVSxRQUFRLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBNEIsUUFBUSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzdHLE9BQU8sRUFBc0IsU0FBUyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFFL0QsT0FBTyxFQUFFLDBCQUEwQixFQUFFLE1BQU0sK0JBQStCLENBQUM7QUFDM0U7SUFRSSwrQ0FDd0IsRUFBYSxFQUNMLGVBQTJDLEVBQy9ELFFBQWtCO1FBRk4sT0FBRSxHQUFGLEVBQUUsQ0FBVztRQUNMLG9CQUFlLEdBQWYsZUFBZSxDQUE0QjtRQUMvRCxhQUFRLEdBQVIsUUFBUSxDQUFVO0lBQzFCLENBQUM7Ozs7SUFFTCx3REFBUTs7O0lBQVI7UUFBQSxpQkEyQkM7UUExQkcsSUFBSSxDQUFDLGVBQWUsQ0FBQyxnQkFBZ0IsQ0FBQyxTQUFTOzs7O1FBQUMsVUFBQyxJQUFTOztnQkFDaEQsU0FBUyxHQUFHLEtBQUksQ0FBQyxTQUFTO1lBQ2hDLElBQUksSUFBSSxDQUFDLElBQUksSUFBSSxJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRTtnQkFDL0IsS0FBSSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLFNBQVMsQ0FBQyxDQUFDO2FBQzFDO2lCQUFNO2dCQUNILEtBQUksQ0FBQyxXQUFXLENBQUMsSUFBSSxFQUFFLFNBQVMsQ0FBQyxDQUFDO2FBQ3JDO1FBQ0wsQ0FBQyxFQUFDLENBQUM7UUFFSCxJQUFJLENBQUMsZUFBZSxDQUFDLFVBQVUsQ0FB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Q0FBQyxHQUFHLENBQUMsQ0FBQyxNQUFNOzs7OztZQUFDLFVBQUMsQ0FBQyxFQUFFLENBQUM7Z0JBQzNCLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ2hCLENBQUMsR0FBRSxJQUFJLENBQUMsQ0FBQztTQUNaO1FBRUQsT0FBTyxHQUFHLENBQUM7SUFDZixDQUFDOzs7OztJQUVPLG1FQUFtQjs7OztJQUEzQjs7WUFDVSxJQUFJLEdBQUcsSUFBSSxDQUFDLEVBQUUsQ0FBQyxXQUFXO1FBQ2hDLElBQUksSUFBSSxFQUFFO1lBQ04sT0FBTyxJQUFJLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDLE1BQU07Ozs7WUFBQyxVQUFBLENBQUMsSUFBSSxPQUFBLENBQUMsS0FBSyxFQUFFLEVBQVIsQ0FBUSxFQUFDLENBQUM7U0FDaEQ7UUFDRCxPQUFPLEVBQUUsQ0FBQztJQUNkLENBQUM7O2dCQXpMSixTQUFTLFNBQUM7O29CQUVQLFFBQVEsRUFBRSxtQ0FBbUM7aUJBQ2hEOzs7O2dCQU40QixTQUFTLHVCQVk3QixRQUFRO2dCQVZSLDBCQUEwQix1QkFXMUIsUUFBUSxZQUFJLElBQUk7Z0JBZG9ELFFBQVE7Ozs0QkFVaEYsS0FBSzs7SUFxTFYsNENBQUM7Q0FBQSxBQTNMRCxJQTJMQztTQXZMWSxxQ0FBcUM7OztJQUU5QywwREFBd0I7Ozs7O0lBR3BCLG1EQUFpQzs7Ozs7SUFDakMsZ0VBQXVFOzs7OztJQUN2RSx5REFBMEIiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIOS9v+eUqOaWueazle+8mlxuICogW21hcEZpZWxkc109XCJ7IGlkOiAndXNlci51c2VySWQnLCBuYW1lOiAndXNlci51c2VyTmFtZScgfVwiXG4gKiBrZXkg5Li65biu5Yqp5LiK55qE5a2X5q6177yMIHZhbHVlIOS4uiDooajljZXkuK3nmoTlrZfmrrXlkI1cbiAqIOW4ruWKqeS4iueahOWQjOS4gOS4quWtl+auteWPr+S7peaYoOWwhOWIsOihqOWNleS4reeahOWkmuS4quWtl+auteS4re+8jHsgLi4uIGlkOiAndXNlci51c2VyaWQsIHVzZXIuYWRkdXNpZCd9XG4gKiDlpJrlrZfmrrXku6XpgJflj7fpmpTlvIBcbiAqXG4gKi9cblxuaW1wb3J0IHsgRGlyZWN0aXZlLCBPbkluaXQsIE9wdGlvbmFsLCBTZWxmLCBJbnB1dCwgT25EZXN0cm95LCBBZnRlclZpZXdJbml0LCBJbmplY3RvciB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgQ2hhbmdlLCBDaGFuZ2VUeXBlLCBWaWV3TW9kZWwgfSBmcm9tICdAZmFycmlzL2RldmtpdCc7XG5pbXBvcnQgeyBNZXNzYWdlclNlcnZpY2UgfSBmcm9tICdAZmFycmlzL3VpLW1lc3NhZ2VyJztcbmltcG9ydCB7IFBlcnNvbm5lbFNlbGVjdG9yQ29tcG9uZW50IH0gZnJvbSAnQGZhcnJpcy91aS1wZXJzb25uZWwtc2VsZWN0b3InO1xuQERpcmVjdGl2ZSh7XG4gICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOmRpcmVjdGl2ZS1zZWxlY3RvclxuICAgIHNlbGVjdG9yOiAnW3BlcnNvbm5lbC1zZWxlY3Rvci1kYXRhLW1hcHBpbmddJ1xufSlcbmV4cG9ydCBjbGFzcyBQZXJzb25uZWxTZWxlY3RvckRhdGFNYXBwaW5nRGlyZWN0aXZlIGltcGxlbWVudHMgT25Jbml0LCBBZnRlclZpZXdJbml0LCBPbkRlc3Ryb3kge1xuXG4gICAgQElucHV0KCkgbWFwRmllbGRzOiBhbnk7XG5cbiAgICBjb25zdHJ1Y3RvcihcbiAgICAgICAgQE9wdGlvbmFsKCkgcHJpdmF0ZSB2bTogVmlld01vZGVsLFxuICAgICAgICBAT3B0aW9uYWwoKSBAU2VsZigpIHByaXZhdGUgdGFyZ2V0Q29tcG9uZW50OiBQZXJzb25uZWxTZWxlY3RvckNvbXBvbmVudCxcbiAgICAgICAgcHJpdmF0ZSBpbmplY3RvcjogSW5qZWN0b3JcbiAgICApIHsgfVxuXG4gICAgbmdPbkluaXQoKSB7XG4gICAgICAgIHRoaXMudGFyZ2V0Q29tcG9uZW50LnNlbGVjdGlvbnNDaGFuZ2Uuc3Vic2NyaWJlKChkYXRhOiBhbnkpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IG1hcGZpZWxkcyA9IHRoaXMubWFwRmllbGRzO1xuICAgICAgICAgICAgaWYgKGRhdGEuZGF0YSAmJiBkYXRhLmRhdGEubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5tYXBwaW5nRGF0YShkYXRhLmRhdGEsIG1hcGZpZWxkcyk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMubWFwcGluZ0RhdGEobnVsbCwgbWFwZmllbGRzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy50YXJnZXRDb21wb25lbnQuaW5wdXRDbGVhci5zdWJzY3JpYmUoKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgbWFwZmllbGRzID0gdGhpcy5tYXBGaWVsZHM7XG4gICAgICAgICAgICB0aGlzLm1hcHBpbmdEYXRhKG51bGwsIG1hcGZpZWxkcyk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMudGFyZ2V0Q29tcG9uZW50LnRhZ1JlbW92ZWQuc3Vic2NyaWJlKChkYXRhKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBtYXBmaWVsZHMgPSB0aGlzLm1hcEZpZWxkcztcbiAgICAgICAgICAgIHRoaXMudGFnUmVtb3ZlZE1hcHBpbmdEYXRhKGRhdGEuZGVsZXRlSW5kZXgsIG1hcGZpZWxkcyk7XG4gICAgICAgICAgICAvLyBpZiAodGhpcy50YXJnZXRDb21wb25lbnQuc2VsZWN0aW9ucyAmJiB0aGlzLnRhcmdldENvbXBvbmVudC5zZWxlY3Rpb25zLmxlbmd0aCkge1xuICAgICAgICAgICAgLy8gICAgIHRoaXMubWFwcGluZ0RhdGEodGhpcy50YXJnZXRDb21wb25lbnQuc2VsZWN0aW9ucywgbWFwZmllbGRzKTtcbiAgICAgICAgICAgIC8vIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyAgICAgdGhpcy5tYXBwaW5nRGF0YShudWxsLCBtYXBmaWVsZHMpO1xuICAgICAgICAgICAgLy8gfVxuICAgICAgICB9KTtcbiAgICAgICAgaWYgKCF0aGlzLnRhcmdldENvbXBvbmVudC5tYXBGaWVsZHMpIHtcbiAgICAgICAgICAgIHRoaXMudGFyZ2V0Q29tcG9uZW50Lm1hcEZpZWxkcyA9IHRoaXMubWFwRmllbGRzO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgbmdBZnRlclZpZXdJbml0KCk6IHZvaWQge1xuXG4gICAgfVxuXG4gICAgbmdPbkRlc3Ryb3koKTogdm9pZCB7XG5cbiAgICB9XG5cbiAgICB0YWdSZW1vdmVkTWFwcGluZ0RhdGEoaW5kZXgsIG1hcEZpZWxkcykge1xuICAgICAgICBpZiAoIW1hcEZpZWxkcykge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmIChcbiAgICAgICAgICAgIHRoaXMudGFyZ2V0Q29tcG9uZW50Lm5nQ29udHJvbCAmJlxuICAgICAgICAgICAgdGhpcy50YXJnZXRDb21wb25lbnQubmdDb250cm9sLmZvcm1EaXJlY3RpdmUgJiZcbiAgICAgICAgICAgIHRoaXMudGFyZ2V0Q29tcG9uZW50Lm5nQ29udHJvbC5mb3JtRGlyZWN0aXZlLmZvcm0gJiZcbiAgICAgICAgICAgIHRoaXMudGFyZ2V0Q29tcG9uZW50Lm5nQ29udHJvbC5mb3JtRGlyZWN0aXZlLmZvcm0uYmluZGluZ0RhdGFcbiAgICAgICAgKSB7XG4gICAgICAgICAgICBjb25zdCBiaW5kaW5nRGF0YSA9IHRoaXMudGFyZ2V0Q29tcG9uZW50Lm5nQ29udHJvbC5mb3JtRGlyZWN0aXZlLmZvcm0uYmluZGluZ0RhdGE7XG4gICAgICAgICAgICBpZiAoYmluZGluZ0RhdGEuc2V0VmFsdWUpIHtcbiAgICAgICAgICAgICAgICAvLyDlhbPpl63lj5jmm7Tmo4DmtYtcbiAgICAgICAgICAgICAgICBjb25zdCBhcHBDb250ZXh0ID0gdGhpcy52bS5mcmFtZUNvbnRleHQuYXBwQ29udGV4dDtcbiAgICAgICAgICAgICAgICBhcHBDb250ZXh0LmNoYW5nZURldGVjdGlvbkNvbnRyb2xsZXIuZGV0YWNoKCk7XG5cbiAgICAgICAgICAgICAgICBsZXQgaGVscEZpZWxkcyA9IE9iamVjdC5rZXlzKG1hcEZpZWxkcyk7XG4gICAgICAgICAgICAgICAgY29uc3QgaWRJbmRleCA9IGhlbHBGaWVsZHMuZmluZEluZGV4KGl0ZW0gPT4gaXRlbSA9PT0gdGhpcy50YXJnZXRDb21wb25lbnQuaWRGaWVsZCk7XG4gICAgICAgICAgICAgICAgaWYgKGhlbHBGaWVsZHMuaW5jbHVkZXModGhpcy50YXJnZXRDb21wb25lbnQuaWRGaWVsZCkgJiYgaWRJbmRleCAhPT0gMCkge1xuICAgICAgICAgICAgICAgICAgICBoZWxwRmllbGRzLnNwbGljZShpZEluZGV4LCAxKTtcbiAgICAgICAgICAgICAgICAgICAgaGVscEZpZWxkcyA9IFt0aGlzLnRhcmdldENvbXBvbmVudC5pZEZpZWxkLCAuLi5oZWxwRmllbGRzXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY29uc3QgcGF0aEFyciA9IHRoaXMuZ2V0QmluZGluZ1BhdGhBcnJheSgpO1xuICAgICAgICAgICAgICAgIGNvbnN0IGFueUZpZWxkQXJyID0gdGhpcy5tYXBGaWVsZHNbaGVscEZpZWxkc1swXV0uc3BsaXQoJywnKTtcbiAgICAgICAgICAgICAgICBjb25zdCBmb3JtQW55RGF0YSA9IGJpbmRpbmdEYXRhLmdldFZhbHVlKHBhdGhBcnIuY29uY2F0KGFueUZpZWxkQXJyWzBdKSk7XG5cbiAgICAgICAgICAgICAgICBpZiAoIWZvcm1BbnlEYXRhIHx8IGZvcm1BbnlEYXRhLnNwbGl0KCcsJykubGVuZ3RoIDwgMikge1xuICAgICAgICAgICAgICAgICAgICBoZWxwRmllbGRzLnJldmVyc2UoKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBoZWxwRmllbGRzLmZvckVhY2goKGZpZWxkOiBhbnkpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZmllbGRBcnIgPSB0aGlzLm1hcEZpZWxkc1tmaWVsZF0uc3BsaXQoJywnKTtcbiAgICAgICAgICAgICAgICAgICAgZmllbGRBcnIuZm9yRWFjaChmYSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBwYXRoID0gcGF0aEFyci5jb25jYXQoZmEuc3BsaXQoJy4nKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy50YXJnZXRDb21wb25lbnQubmdDb250cm9sLnBhdGguam9pbigpID09PSBwYXRoLmpvaW4oKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlc1N0ciA9IGJpbmRpbmdEYXRhLmdldFZhbHVlKHBhdGgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFyZXNTdHIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBiaW5kaW5nRGF0YS5jbGVhclZhbHVlKHBhdGgsIHRydWUsIHRydWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCByZXNBcnIgPSByZXNTdHIuc3BsaXQoJywnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNBcnIuc3BsaWNlKGluZGV4LCAxKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCByZXN1bHQgPSByZXNBcnIuam9pbigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghcmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJpbmRpbmdEYXRhLmNsZWFyVmFsdWUocGF0aCwgdHJ1ZSwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYmluZGluZ0RhdGEuc2V0VmFsdWUocGF0aCwgcmVzdWx0LCB0cnVlLCB0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIC8vIOmHjeaWsOaJk+W8gOWPmOabtOajgOa1i1xuICAgICAgICAgICAgICAgIGFwcENvbnRleHQuY2hhbmdlRGV0ZWN0aW9uQ29udHJvbGxlci5yZWF0dGFjaCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuICAgICAqXG4gICAgICogQHBhcmFtIGhlbHBEYXRhIOa4heepuuaXtu+8jOWAvOS4um51bGxcbiAgICAgKiBAcGFyYW0gbWFwRmllbGRzIOagvOW8j+W9ouWmgu+8mntpZDogXCJhc3NvRmllbGQuYXNzb0ZpZWxkXCIsIGNvZGU6IFwiYXNzb0ZpZWxkLmFzc29GaWVsZF9Db2RlXCIsIG5hbWU6IFwiYXNzb0ZpZWxkLmFzc29GaWVsZF9OYW1lXCJ9XG4gICAgICovXG4gICAgbWFwcGluZ0RhdGEoaGVscERhdGE6IGFueSwgbWFwRmllbGRzOiBhbnkpIHtcbiAgICAgICAgaWYgKCFtYXBGaWVsZHMpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIOWFs+mXreWPmOabtOajgOa1i1xuICAgICAgICBjb25zdCBhcHBDb250ZXh0ID0gdGhpcy52bS5mcmFtZUNvbnRleHQuYXBwQ29udGV4dDtcbiAgICAgICAgYXBwQ29udGV4dC5jaGFuZ2VEZXRlY3Rpb25Db250cm9sbGVyLmRldGFjaCgpO1xuXG4gICAgICAgIGxldCBoZWxwRmllbGRzID0gT2JqZWN0LmtleXMobWFwRmllbGRzKTtcbiAgICAgICAgY29uc3QgaWRJbmRleCA9IGhlbHBGaWVsZHMuZmluZEluZGV4KGl0ZW0gPT4gaXRlbSA9PT0gdGhpcy50YXJnZXRDb21wb25lbnQuaWRGaWVsZCk7XG4gICAgICAgIGlmIChoZWxwRmllbGRzLmluY2x1ZGVzKHRoaXMudGFyZ2V0Q29tcG9uZW50LmlkRmllbGQpICYmIGlkSW5kZXggIT09IDApIHtcbiAgICAgICAgICAgIGhlbHBGaWVsZHMuc3BsaWNlKGlkSW5kZXgsIDEpO1xuICAgICAgICAgICAgaGVscEZpZWxkcyA9IFt0aGlzLnRhcmdldENvbXBvbmVudC5pZEZpZWxkLCAuLi5oZWxwRmllbGRzXTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIWhlbHBEYXRhKSB7XG4gICAgICAgICAgICBoZWxwRmllbGRzLnJldmVyc2UoKTtcbiAgICAgICAgfVxuICAgICAgICBoZWxwRmllbGRzLmZvckVhY2goKGY6IGFueSkgPT4ge1xuICAgICAgICAgICAgLy8gMeOAgeiOt+WPluWtl+auteWAvFxuICAgICAgICAgICAgLy8g5aaC5p6caGVscERhdGHmnInpgInkuK3lgLzvvIzliJnojrflj5bluK7liqnmlbDmja7mupDph4zlr7nlupTkvaDlrZfmrrXnmoTlgLzvvJtcbiAgICAgICAgICAgIC8vIOWmguaenGhlbHBEYXRh5rKh5pyJ5YC877yI5riF56m65Zy65pmv77yJ77yM5YiZ6L+U5Zue5LiA5Liq56m65a2X56ym5LiyXG4gICAgICAgICAgICBsZXQgdmFsOiBhbnkgPSAnJztcbiAgICAgICAgICAgIGlmIChoZWxwRGF0YSkge1xuICAgICAgICAgICAgICAgIGlmIChoZWxwRGF0YSBpbnN0YW5jZW9mIEFycmF5KSB7XG4gICAgICAgICAgICAgICAgICAgIHZhbCA9IGhlbHBEYXRhLm1hcCgoaDogYW55KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5nZXRWYWx1ZShmLCBoKTtcbiAgICAgICAgICAgICAgICAgICAgfSkuam9pbignLCcpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHZhbCA9IHRoaXMuZ2V0VmFsdWUoZiwgaGVscERhdGEpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gMuOAgeiuvue9ruWtl+auteWAvFxuICAgICAgICAgICAgLy8g5aaC5p6caGVscERhdGHkuI3lrZjlnKjvvIjmuIXnqbrlnLrmma/vvInvvIzojrflj5ZCaW5kaW5nRGF0YemHjOWvueW6lOWtl+auteeahOWAvO+8jOWmguaenOaYr+aVsOWAvO+8jOWImeiuvue9rjDvvIzlhbbku5borr7nva7kuIrkuIDmraXkuK3nmoTnqbrlrZfnrKbkuLLvvJtcbiAgICAgICAgICAgIC8vIOWmguaenGhlbHBEYXRh5a2Y5Zyo77ya55u05o6l6K6+572u5LiK5LiA5q2l5Lit6I635Y+W55qE5YC844CCXG4gICAgICAgICAgICBjb25zdCBwYXRoQXJyID0gdGhpcy5nZXRCaW5kaW5nUGF0aEFycmF5KCk7XG4gICAgICAgICAgICBtYXBGaWVsZHNbZl0uc3BsaXQoJywnKS5mb3JFYWNoKChmZjogYW55KSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMudGFyZ2V0Q29tcG9uZW50Lm5nQ29udHJvbC5wYXRoLmpvaW4oKSA9PT0gZmYpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoIWhlbHBEYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudm0uYmluZGluZ0RhdGEuY2xlYXJWYWx1ZShwYXRoQXJyLmNvbmNhdChmZi5zcGxpdCgnLicpKSwgdHJ1ZSwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy52bS5iaW5kaW5nRGF0YS5zZXRWYWx1ZShwYXRoQXJyLmNvbmNhdChmZi5zcGxpdCgnLicpKSwgdmFsLCB0cnVlLCB0cnVlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8g6YeN5paw5omT5byA5Y+Y5pu05qOA5rWLXG4gICAgICAgIGFwcENvbnRleHQuY2hhbmdlRGV0ZWN0aW9uQ29udHJvbGxlci5yZWF0dGFjaCgpO1xuICAgIH1cblxuICAgIHByaXZhdGUgZ2V0VmFsdWUoZjogc3RyaW5nLCBkYXRhOiBhbnkpIHtcbiAgICAgICAgbGV0IHZhbCA9ICcnO1xuICAgICAgICBpZiAoZi5pbmRleE9mKCcuJykgPT09IC0xKSB7XG4gICAgICAgICAgICB2YWwgPSBkYXRhW2ZdO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdmFsID0gZi5zcGxpdCgnLicpLnJlZHVjZSgoYSwgYikgPT4ge1xuICAgICAgICAgICAgICAgIHJldHVybiBhW2JdO1xuICAgICAgICAgICAgfSwgZGF0YSk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdmFsO1xuICAgIH1cblxuICAgIHByaXZhdGUgZ2V0QmluZGluZ1BhdGhBcnJheSgpOiBhbnlbXSB7XG4gICAgICAgIGNvbnN0IHBhdGggPSB0aGlzLnZtLmJpbmRpbmdQYXRoO1xuICAgICAgICBpZiAocGF0aCkge1xuICAgICAgICAgICAgcmV0dXJuIHBhdGguc3BsaXQoJy8nKS5maWx0ZXIobiA9PiBuICE9PSAnJyk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIFtdO1xuICAgIH1cblxufVxuIl19
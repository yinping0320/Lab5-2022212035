/**
 * @fileoverview added by tsickle
 * Generated from: utils/favorites.tool.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { HttpClient, HttpHeaders } from '@angular/common/http';
import { Injectable } from '@angular/core';
import { Subject } from 'rxjs';
var FavoritesTool = /** @class */ (function () {
    function FavoritesTool(http) {
        this.http = http;
        this.absOrgType = 'System_organization';
        this.busNum = 'common';
        this.idField = 'userId';
        this.favoritesList = [];
        this.absRfQueryUrl = '/api/runtime/sys/v1.0/absRecentContacts/query';
        this.absRfModifyUrl = '/api/runtime/sys/v1.0/absRecentContacts/modify';
        this.subject = new Subject();
    }
    /**
     * 操作最近联系人或收藏夹
     * @param param any
     * @returns observable
     */
    /**
     * 操作最近联系人或收藏夹
     * @param {?} actionToken
     * @param {?} param any
     * @return {?} observable
     */
    FavoritesTool.prototype.curdRecentContactsOrFavorites = /**
     * 操作最近联系人或收藏夹
     * @param {?} actionToken
     * @param {?} param any
     * @return {?} observable
     */
    function (actionToken, param) {
        /** @type {?} */
        var url = this.absRfQueryUrl;
        if (actionToken === 'modify') {
            url = this.absRfModifyUrl;
        }
        /** @type {?} */
        var options = {
            headers: new HttpHeaders({
                'Content-Type': 'application/json',
            })
        };
        return this.http.post(url, param, options);
    };
    Object.defineProperty(FavoritesTool.prototype, "favoritesSubject", {
        get: /**
         * @return {?}
         */
        function () {
            return this.subject.asObservable();
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @param {?} value
     * @return {?}
     */
    FavoritesTool.prototype.setFavoritesList = /**
     * @param {?} value
     * @return {?}
     */
    function (value) {
        this.subject.next(value);
    };
    /**
     * 获取收藏夹中人员列表
     */
    /**
     * 获取收藏夹中人员列表
     * @return {?}
     */
    FavoritesTool.prototype.getFavoritesList = /**
     * 获取收藏夹中人员列表
     * @return {?}
     */
    function () {
        /** @type {?} */
        var param = {
            absOrgType: this.absOrgType,
            bizId: this.busNum,
            objectValue: 'CollectOrg'
        };
        return this.curdRecentContactsOrFavorites('query', param);
    };
    /**
     * 加入或取消收藏
     * @param e 鼠标事件
     * @param id 标识
     * @returns Observable
     */
    /**
     * 加入或取消收藏
     * @param {?} e 鼠标事件
     * @param {?} object
     * @return {?} Observable
     */
    FavoritesTool.prototype.toggleFavorites = /**
     * 加入或取消收藏
     * @param {?} e 鼠标事件
     * @param {?} object
     * @return {?} Observable
     */
    function (e, object) {
        var _this = this;
        /** @type {?} */
        var id = object[this.idField];
        /** @type {?} */
        var action = 'add';
        /** @type {?} */
        var param = {
            absOrgType: this.absOrgType,
            bizId: this.busNum,
            objectValue: 'CollectOrg'
        };
        if (this.favoritesList.findIndex((/**
         * @param {?} item
         * @return {?}
         */
        function (item) { return item[_this.idField] === id; })) !== -1) {
            param.deleteList = [id];
            action = 'delete';
        }
        else {
            param.addList = [id];
        }
        this.curdRecentContactsOrFavorites('modify', param).subscribe((/**
         * @return {?}
         */
        function () {
            if (action === 'add') {
                /** @type {?} */
                var index = _this.favoritesList.findIndex((/**
                 * @param {?} item
                 * @return {?}
                 */
                function (item) { return item[_this.idField] === id; }));
                if (index === -1) {
                    _this.favoritesList.push(object);
                }
            }
            else {
                _this.favoritesList = _this.favoritesList.filter((/**
                 * @param {?} item
                 * @return {?}
                 */
                function (item) { return item[_this.idField] !== id; }));
            }
            _this.setFavoritesList(_this.favoritesList);
        }));
        e.cancelBubble = true;
        e.stopPropagation();
    };
    /**
     * 清空我的收藏
     */
    /**
     * 清空我的收藏
     * @return {?}
     */
    FavoritesTool.prototype.clearFavoritesList = /**
     * 清空我的收藏
     * @return {?}
     */
    function () {
        var _this = this;
        if (!this.favoritesList.length) {
            this.setFavoritesList(this.favoritesList);
            return;
        }
        /** @type {?} */
        var ids = this.favoritesList.map((/**
         * @param {?} item
         * @return {?}
         */
        function (item) { return item[_this.idField]; }));
        /** @type {?} */
        var param = {
            absOrgType: this.absOrgType,
            bizId: this.busNum,
            objectValue: 'CollectOrg',
            addList: [],
            deleteList: ids
        };
        this.curdRecentContactsOrFavorites('modify', param).subscribe((/**
         * @param {?} val
         * @return {?}
         */
        function (val) {
            _this.favoritesList = [];
            _this.setFavoritesList(_this.favoritesList);
        }));
    };
    FavoritesTool.decorators = [
        { type: Injectable }
    ];
    /** @nocollapse */
    FavoritesTool.ctorParameters = function () { return [
        { type: HttpClient }
    ]; };
    return FavoritesTool;
}());
export { FavoritesTool };
if (false) {
    /** @type {?} */
    FavoritesTool.prototype.absOrgType;
    /** @type {?} */
    FavoritesTool.prototype.busNum;
    /** @type {?} */
    FavoritesTool.prototype.idField;
    /** @type {?} */
    FavoritesTool.prototype.favoritesList;
    /** @type {?} */
    FavoritesTool.prototype.absRfQueryUrl;
    /** @type {?} */
    FavoritesTool.prototype.absRfModifyUrl;
    /**
     * @type {?}
     * @private
     */
    FavoritesTool.prototype.subject;
    /**
     * @type {?}
     * @private
     */
    FavoritesTool.prototype.http;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmF2b3JpdGVzLnRvb2wuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL3VpLW9yZ2FuaXphdGlvbi1zZWxlY3Rvci8iLCJzb3VyY2VzIjpbInV0aWxzL2Zhdm9yaXRlcy50b29sLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsT0FBTyxFQUFFLFVBQVUsRUFBRSxXQUFXLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUMvRCxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzNDLE9BQU8sRUFBa0IsT0FBTyxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBRS9DO0lBV0ksdUJBQW9CLElBQWdCO1FBQWhCLFNBQUksR0FBSixJQUFJLENBQVk7UUFScEMsZUFBVSxHQUFHLHFCQUFxQixDQUFDO1FBQ25DLFdBQU0sR0FBRyxRQUFRLENBQUM7UUFDbEIsWUFBTyxHQUFHLFFBQVEsQ0FBQztRQUNuQixrQkFBYSxHQUFHLEVBQUUsQ0FBQztRQUNuQixrQkFBYSxHQUFHLCtDQUErQyxDQUFDO1FBQ2hFLG1CQUFjLEdBQUcsZ0RBQWdELENBQUM7UUFDMUQsWUFBTyxHQUFHLElBQUksT0FBTyxFQUFPLENBQUM7SUFJckMsQ0FBQztJQUVEOzs7O09BSUc7Ozs7Ozs7SUFDSCxxREFBNkI7Ozs7OztJQUE3QixVQUE4QixXQUFtQixFQUFFLEtBQVU7O1lBQ3JELEdBQUcsR0FBRyxJQUFJLENBQUMsYUFBYTtRQUM1QixJQUFJLFdBQVcsS0FBSyxRQUFRLEVBQUU7WUFDMUIsR0FBRyxHQUFHLElBQUksQ0FBQyxjQUFjLENBQUM7U0FDN0I7O1lBQ0ssT0FBTyxHQUFHO1lBQ1osT0FBTyxFQUFFLElBQUksV0FBVyxDQUFDO2dCQUNyQixjQUFjLEVBQUUsa0JBQWtCO2FBQ3JDLENBQUM7U0FDTDtRQUNELE9BQU8sSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxFQUFFLEtBQUssRUFBRSxPQUFPLENBQUMsQ0FBQztJQUMvQyxDQUFDO0lB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Q0FBQyxFQUFsQixDQUFrQixFQUFDOztZQUN4RCxLQUFLLEdBQVE7WUFDZixVQUFVLEVBQUUsSUFBSSxDQUFDLFVBQVU7WUFDM0IsS0FBSyxFQUFFLElBQUksQ0FBQyxNQUFNO1lBQ2xCLFdBQVcsRUFBRSxZQUFZO1lBQ3pCLE9BQU8sRUFBRSxFQUFFO1lBQ1gsVUFBVSxFQUFFLEdBQUc7U0FDbEI7UUFFRCxJQUFJLENBQUMsNkJBQTZCLENBQUMsUUFBUSxFQUFFLEtBQUssQ0FBQyxDQUFDLFNBQVM7Ozs7UUFBQyxVQUFDLEdBQUc7WUFDOUQsS0FBSSxDQUFDLGFBQWEsR0FBRyxFQUFFLENBQUM7WUFDeEIsS0FBSSxDQUFDLGdCQUFnQixDQUFDLEtBQUksQ0FBQyxhQUFhLENBQUMsQ0FBQztRQUM5QyxDQUFDLEVBQUMsQ0FBQztJQUNQLENBQUM7O2dCQTdHSixVQUFVOzs7O2dCQUpGLFVBQVU7O0lBa0huQixvQkFBQztDQUFBLEFBOUdELElBOEdDO1NBN0dZLGFBQWE7OztJQUV0QixtQ0FBbUM7O0lBQ25DLCtCQUFrQjs7SUFDbEIsZ0NBQW1COztJQUNuQixzQ0FBbUI7O0lBQ25CLHNDQUFnRTs7SUFDaEUsdUNBQWtFOzs7OztJQUNsRSxnQ0FBcUM7Ozs7O0lBRXpCLDZCQUF3QiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEh0dHBDbGllbnQsIEh0dHBIZWFkZXJzIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uL2h0dHAnO1xyXG5pbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IE9ic2VydmFibGUsIG9mLCBTdWJqZWN0IH0gZnJvbSAncnhqcyc7XHJcblxyXG5ASW5qZWN0YWJsZSgpXHJcbmV4cG9ydCBjbGFzcyBGYXZvcml0ZXNUb29sIHtcclxuXHJcbiAgICBhYnNPcmdUeXBlID0gJ1N5c3RlbV9vcmdhbml6YXRpb24nO1xyXG4gICAgYnVzTnVtID0gJ2NvbW1vbic7XHJcbiAgICBpZEZpZWxkID0gJ3VzZXJJZCc7XHJcbiAgICBmYXZvcml0ZXNMaXN0ID0gW107XHJcbiAgICBhYnNSZlF1ZXJ5VXJsID0gJy9hcGkvcnVudGltZS9zeXMvdjEuMC9hYnNSZWNlbnRDb250YWN0cy9xdWVyeSc7XHJcbiAgICBhYnNSZk1vZGlmeVVybCA9ICcvYXBpL3J1bnRpbWUvc3lzL3YxLjAvYWJzUmVjZW50Q29udGFjdHMvbW9kaWZ5JztcclxuICAgIHByaXZhdGUgc3ViamVjdCA9IG5ldyBTdWJqZWN0PGFueT4oKTtcclxuXHJcbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIGh0dHA6IEh0dHBDbGllbnQpIHtcclxuXHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDmk43kvZzmnIDov5HogZTns7vkurrmiJbmlLbol4/lpLlcclxuICAgICAqIEBwYXJhbSBwYXJhbSBhbnlcclxuICAgICAqIEByZXR1cm5zIG9ic2VydmFibGVcclxuICAgICAqL1xyXG4gICAgY3VyZFJlY2VudENvbnRhY3RzT3JGYXZvcml0ZXMoYWN0aW9uVG9rZW46IHN0cmluZywgcGFyYW06IGFueSkge1xyXG4gICAgICAgIGxldCB1cmwgPSB0aGlzLmFic1JmUXVlcnlVcmw7XHJcbiAgICAgICAgaWYgKGFjdGlvblRva2VuID09PSAnbW9kaWZ5Jykge1xyXG4gICAgICAgICAgICB1cmwgPSB0aGlzLmFic1JmTW9kaWZ5VXJsO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCBvcHRpb25zID0ge1xyXG4gICAgICAgICAgICBoZWFkZXJzOiBuZXcgSHR0cEhlYWRlcnMoe1xyXG4gICAgICAgICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyxcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICB9O1xyXG4gICAgICAgIHJldHVybiB0aGlzLmh0dHAucG9zdCh1cmwsIHBhcmFtLCBvcHRpb25zKTtcclxuICAgIH1cclxuXHJcbiAgICBnZXQgZmF2b3JpdGVzU3ViamVjdCgpOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnN1YmplY3QuYXNPYnNlcnZhYmxlKCk7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0RmF2b3JpdGVzTGlzdCh2YWx1ZTogYW55KSB7XHJcbiAgICAgICAgdGhpcy5zdWJqZWN0Lm5leHQodmFsdWUpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog6I635Y+W5pS26JeP5aS55Lit5Lq65ZGY5YiX6KGoXHJcbiAgICAgKi9cclxuICAgIGdldEZhdm9yaXRlc0xpc3QoKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgICAgICBjb25zdCBwYXJhbTogYW55ID0ge1xyXG4gICAgICAgICAgICBhYnNPcmdUeXBlOiB0aGlzLmFic09yZ1R5cGUsXHJcbiAgICAgICAgICAgIGJpeklkOiB0aGlzLmJ1c051bSxcclxuICAgICAgICAgICAgb2JqZWN0VmFsdWU6ICdDb2xsZWN0T3JnJ1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY3VyZFJlY2VudENvbnRhY3RzT3JGYXZvcml0ZXMoJ3F1ZXJ5JywgcGFyYW0pO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5Yqg5YWl5oiW5Y+W5raI5pS26JePXHJcbiAgICAgKiBAcGFyYW0gZSDpvKDmoIfkuovku7ZcclxuICAgICAqIEBwYXJhbSBpZCDmoIfor4ZcclxuICAgICAqIEByZXR1cm5zIE9ic2VydmFibGVcclxuICAgICAqL1xyXG4gICAgdG9nZ2xlRmF2b3JpdGVzKGU6IGFueSwgb2JqZWN0OiBhbnkpIHtcclxuICAgICAgICBjb25zdCBpZCA9IG9iamVjdFt0aGlzLmlkRmllbGRdO1xyXG4gICAgICAgIGxldCBhY3Rpb24gPSAnYWRkJztcclxuICAgICAgICBjb25zdCBwYXJhbTogYW55ID0ge1xyXG4gICAgICAgICAgICBhYnNPcmdUeXBlOiB0aGlzLmFic09yZ1R5cGUsXHJcbiAgICAgICAgICAgIGJpeklkOiB0aGlzLmJ1c051bSxcclxuICAgICAgICAgICAgb2JqZWN0VmFsdWU6ICdDb2xsZWN0T3JnJ1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgaWYgKHRoaXMuZmF2b3JpdGVzTGlzdC5maW5kSW5kZXgoaXRlbSA9PiBpdGVtW3RoaXMuaWRGaWVsZF0gPT09IGlkKSAhPT0gLTEpIHtcclxuICAgICAgICAgICAgcGFyYW0uZGVsZXRlTGlzdCA9IFtpZF07XHJcbiAgICAgICAgICAgIGFjdGlvbiA9ICdkZWxldGUnO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHBhcmFtLmFkZExpc3QgPSBbaWRdO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmN1cmRSZWNlbnRDb250YWN0c09yRmF2b3JpdGVzKCdtb2RpZnknLCBwYXJhbSkuc3Vic2NyaWJlKCgpID0+IHtcclxuICAgICAgICAgICAgaWYgKGFjdGlvbiA9PT0gJ2FkZCcpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGluZGV4ID0gdGhpcy5mYXZvcml0ZXNMaXN0LmZpbmRJbmRleChpdGVtID0+IGl0ZW1bdGhpcy5pZEZpZWxkXSA9PT0gaWQpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGluZGV4ID09PSAtMSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZmF2b3JpdGVzTGlzdC5wdXNoKG9iamVjdCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmZhdm9yaXRlc0xpc3QgPSB0aGlzLmZhdm9yaXRlc0xpc3QuZmlsdGVyKGl0ZW0gPT4gaXRlbVt0aGlzLmlkRmllbGRdICE9PSBpZCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5zZXRGYXZvcml0ZXNMaXN0KHRoaXMuZmF2b3JpdGVzTGlzdCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgZS5jYW5jZWxCdWJibGUgPSB0cnVlO1xyXG4gICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDmuIXnqbrmiJHnmoTmlLbol49cclxuICAgICAqL1xyXG4gICAgY2xlYXJGYXZvcml0ZXNMaXN0KCkge1xyXG4gICAgICAgIGlmICghdGhpcy5mYXZvcml0ZXNMaXN0Lmxlbmd0aCkge1xyXG4gICAgICAgICAgICB0aGlzLnNldEZhdm9yaXRlc0xpc3QodGhpcy5mYXZvcml0ZXNMaXN0KTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCBpZHMgPSB0aGlzLmZhdm9yaXRlc0xpc3QubWFwKGl0ZW0gPT4gaXRlbVt0aGlzLmlkRmllbGRdKTtcclxuICAgICAgICBjb25zdCBwYXJhbTogYW55ID0ge1xyXG4gICAgICAgICAgICBhYnNPcmdUeXBlOiB0aGlzLmFic09yZ1R5cGUsXHJcbiAgICAgICAgICAgIGJpeklkOiB0aGlzLmJ1c051bSxcclxuICAgICAgICAgICAgb2JqZWN0VmFsdWU6ICdDb2xsZWN0T3JnJyxcclxuICAgICAgICAgICAgYWRkTGlzdDogW10sXHJcbiAgICAgICAgICAgIGRlbGV0ZUxpc3Q6IGlkc1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHRoaXMuY3VyZFJlY2VudENvbnRhY3RzT3JGYXZvcml0ZXMoJ21vZGlmeScsIHBhcmFtKS5zdWJzY3JpYmUoKHZhbCkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLmZhdm9yaXRlc0xpc3QgPSBbXTtcclxuICAgICAgICAgICAgdGhpcy5zZXRGYXZvcml0ZXNMaXN0KHRoaXMuZmF2b3JpdGVzTGlzdCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbn1cclxuIl19
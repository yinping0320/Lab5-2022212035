/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Component, HostBinding, Input, Output, EventEmitter, Injector, ViewChild, ElementRef } from '@angular/core';
import { MessagerService } from '@farris/ui-messager';
import { cloneDeep } from 'lodash-es';
import { SortTypes, SortType } from '@farris/ui-common/types';
import { DomSanitizer } from '@angular/platform-browser';
import { LocaleService } from '@farris/ui-locale';
import { PerfectScrollbarComponent } from '@farris/ui-perfect-scrollbar';
var SortEditorComponent = /** @class */ (function () {
    function SortEditorComponent(messagerService, sanitizer, injector) {
        this.messagerService = messagerService;
        this.sanitizer = sanitizer;
        this.injector = injector;
        this.sortTypes = SortTypes;
        this.columnSizeData = [30, 120, 60];
        this.cls = 'f-sort-editor f-utils-flex-column f-utils-absolute-all';
        this.fieldEditor = { type: 'select', options: null };
        this.conditions = [];
        this.columns = [];
        this.sortsChanged = new EventEmitter();
        this.newCondition = {
            sortField: '',
            sortType: SortType.Asc,
        };
        this.currentCondition = null;
        this.localeService = this.injector.get(LocaleService);
        this.sortTypes = [
            { label: this.localeService.getValue('sortEditor.asc'), value: SortType.Asc },
            { label: this.localeService.getValue('sortEditor.desc'), value: SortType.Desc }
        ];
    }
    /**
     * @return {?}
     */
    SortEditorComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
    };
    // private psUpdate() {
    //     if (this.psRef && this.psRef.directiveRef) {
    //         this.psRef.directiveRef.update();
    //     }
    // }
    // private psUpdate() {
    //     if (this.psRef && this.psRef.directiveRef) {
    //         this.psRef.directiveRef.update();
    //     }
    // }
    /**
     * @private
     * @return {?}
     */
    SortEditorComponent.prototype.itemIntoView = 
    // private psUpdate() {
    //     if (this.psRef && this.psRef.directiveRef) {
    //         this.psRef.directiveRef.update();
    //     }
    // }
    /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        if (this.tablebodybox) {
            setTimeout((/**
             * @return {?}
             */
            function () {
                /** @type {?} */
                var tr = _this.tablebodybox.nativeElement.querySelector('tr.selected');
                if (tr) {
                    if (tr.scrollIntoViewIfNeeded) {
                        tr.scrollIntoViewIfNeeded(false);
                    }
                    else {
                        tr.scrollIntoView({ block: 'nearest' });
                    }
                }
            }), 50);
        }
    };
    /**
     * @param {?} $event
     * @return {?}
     */
    SortEditorComponent.prototype.selected = /**
     * @param {?} $event
     * @return {?}
     */
    function ($event) {
        this.currentCondition = $event;
    };
    /**
     * @param {?} $event
     * @return {?}
     */
    SortEditorComponent.prototype.isSelected = /**
     * @param {?} $event
     * @return {?}
     */
    function ($event) {
        if (this.currentCondition) {
            return this.currentCondition.index === $event;
        }
        return false;
    };
    /**
     * @param {?} index
     * @return {?}
     */
    SortEditorComponent.prototype.insertCondition = /**
     * @param {?} index
     * @return {?}
     */
    function (index) {
        /** @type {?} */
        var _newCondition = Object.assign({}, this.newCondition);
        if (index === 0) {
            this.conditions = tslib_1.__spread([_newCondition], this.conditions);
        }
        else {
            /** @type {?} */
            var _data = cloneDeep(this.conditions);
            _data.splice(index, 0, _newCondition);
            this.conditions = tslib_1.__spread(_data);
        }
        this.changeConditionList('insert');
    };
    /**
     * @param {?} index
     * @return {?}
     */
    SortEditorComponent.prototype.removeCondition = /**
     * @param {?} index
     * @return {?}
     */
    function (index) {
        this.conditions.splice(index, 1);
        this.changeConditionList('remove');
        if (this.currentCondition) {
            if (index === this.currentCondition.index) {
                if (this.conditions[index]) {
                    this.currentCondition = { index: index, condition: this.conditions[index] };
                }
                else {
                    if (this.conditions[index - 1]) {
                        this.currentCondition = { index: index - 1, condition: this.conditions[index - 1] };
                    }
                    else {
                        this.currentCondition = null;
                    }
                }
            }
            else {
                if (!this.conditions[this.currentCondition.index]) {
                    if (this.currentCondition.index > index) {
                        this.currentCondition.index = this.currentCondition.index - 1;
                    }
                    else {
                        this.currentCondition.index = this.currentCondition.index + 1;
                    }
                }
            }
        }
    };
    /**
     * @return {?}
     */
    SortEditorComponent.prototype.onAdd = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var newItem = Object.assign({}, this.newCondition);
        this.conditions = tslib_1.__spread(this.conditions, [newItem]);
        this.changeConditionList('add');
        /** @type {?} */
        var newIdx = this.conditions.length - 1;
        this.currentCondition = { index: newIdx, condition: newItem };
    };
    /**
     * @return {?}
     */
    SortEditorComponent.prototype.onClear = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.messagerService.question('确认要清空当前所有排序字段吗？', (/**
         * @return {?}
         */
        function () {
            _this.conditions = [];
            _this.currentCondition = null;
            _this.changeConditionList('clear');
        }));
    };
    /**
     * @return {?}
     */
    SortEditorComponent.prototype.onMoveTop = /**
     * @return {?}
     */
    function () {
        if (this.currentCondition) {
            this.conditions.unshift(this.currentCondition.condition);
            this.conditions.splice(this.currentCondition.index + 1, 1);
            this.currentCondition.index = 0;
            this.changeConditionList('moveTop');
        }
    };
    /**
     * @return {?}
     */
    SortEditorComponent.prototype.onMovePrev = /**
     * @return {?}
     */
    function () {
        var _a;
        if (this.currentCondition) {
            /** @type {?} */
            var index = this.currentCondition.index;
            /** @type {?} */
            var tempArr = this.conditions.splice(index, 1);
            (_a = this.conditions).splice.apply(_a, tslib_1.__spread([index - 1, 0], tempArr));
            this.currentCondition.index = index - 1;
            this.changeConditionList('movePrev');
        }
    };
    /**
     * @return {?}
     */
    SortEditorComponent.prototype.onMoveNext = /**
     * @return {?}
     */
    function () {
        var _a;
        if (this.currentCondition) {
            /** @type {?} */
            var index = this.currentCondition.index;
            /** @type {?} */
            var tempArr = this.conditions.splice(index, 1);
            (_a = this.conditions).splice.apply(_a, tslib_1.__spread([index + 1, 0], tempArr));
            this.currentCondition.index = index + 1;
            this.changeConditionList('moveNext');
        }
    };
    /**
     * @return {?}
     */
    SortEditorComponent.prototype.onMoveBottom = /**
     * @return {?}
     */
    function () {
        if (this.currentCondition) {
            this.conditions.push(this.currentCondition.condition);
            this.conditions.splice(this.currentCondition.index, 1);
            this.currentCondition.index = this.conditions.length - 1;
            this.changeConditionList('moveBottom');
        }
    };
    /**
     * @return {?}
     */
    SortEditorComponent.prototype.canUse = /**
     * @return {?}
     */
    function () {
        if (this.currentCondition) {
            return this.conditions.length > 1;
        }
        return false;
    };
    /**
     * @return {?}
     */
    SortEditorComponent.prototype.canMoveUp = /**
     * @return {?}
     */
    function () {
        if (this.canUse()) {
            return this.currentCondition.index > 0;
        }
        return false;
    };
    /**
     * @return {?}
     */
    SortEditorComponent.prototype.canMoveDown = /**
     * @return {?}
     */
    function () {
        if (this.canUse()) {
            return this.currentCondition.index < this.conditions.length - 1;
        }
        return false;
    };
    /**
     * @private
     * @param {?} action
     * @return {?}
     */
    SortEditorComponent.prototype.changeConditionList = /**
     * @private
     * @param {?} action
     * @return {?}
     */
    function (action) {
        var _this = this;
        this.sortsChanged.emit({ action: action, data: this.conditions });
        setTimeout((/**
         * @return {?}
         */
        function () {
            _this.itemIntoView();
            // this.setContainerStyles();
        }));
    };
    SortEditorComponent.decorators = [
        { type: Component, args: [{
                    selector: 'sort-editor',
                    template: "<!-- <div class=\"table-header \" style=\"max-height: 35px;\">\r\n    <table class=\"table table-bordered sort-col-header\" style=\"margin-bottom: 0\">\r\n        <colgroup>\r\n            <col *ngFor=\"let s of columnSizeData\" [width]=\" s + 'px'\">\r\n        </colgroup>\r\n        <thead>\r\n            <tr>\r\n                <th></th>\r\n                <th>&nbsp;<b>{{ 'sortEditor.field'| locale }}</b></th>\r\n                <th>&nbsp;<b>{{ 'sortEditor.order'| locale }}</b></th>\r\n            </tr>\r\n        </thead>\r\n    </table>\r\n</div> -->\r\n<div style=\"\r\n    border-top: 1px solid  white;\r\n    position: absolute;\r\n    top: 0;\r\n    width: 100%;\r\n    z-index: 2;\r\n\"></div>\r\n<div class=\"table-body flex-fill  win11Scroll show nobtn\" style=\"margin-left:14px; margin-right: 0; overflow-y: scroll;\" #tablebodybox>\r\n    <!-- <perfect-scrollbar [config]=\"{}\" style=\"height: 100%\" #ps> -->\r\n        <table class=\"table table-bordered\" style=\"margin: 0;\">\r\n            <thead style=\"position: sticky; top: 0; z-index: 1;\">\r\n                <tr>\r\n                    <th style=\"width: 30px\"></th>\r\n                    <th style=\"width: 120px\">&nbsp;<b>{{ 'sortEditor.field'| locale }}</b></th>\r\n                    <th style=\"width: 60px\">&nbsp;<b>{{ 'sortEditor.order'| locale }}</b></th>\r\n                </tr>\r\n            </thead>\r\n            <tbody>\r\n                <tr *ngFor=\"let condition of conditions; let index=index;\" (click)=\"selected({'index':index, 'condition': condition})\" [class.selected]=\"isSelected(index)\" >\r\n                    <td style=\"padding-left: 0; padding-right: 0; text-align: center\">\r\n                        <button type=\"button\" (click)=\"insertCondition(index)\" class=\"k-button k-button-icon k-flat\"><span class=\"k-icon k-i-plus\"></span></button>\r\n                        <button type=\"button\" (click)=\"removeCondition(index)\" class=\"k-button k-button-icon k-flat\"><span class=\"k-icon k-i-minus\"></span></button>\r\n                    </td>\r\n                    <td>\r\n\r\n                        <ng-container *ngIf=\"fieldEditor.type === 'select'\" >\r\n                            <select class=\"form-control filter-select\" [(ngModel)]=\"condition.sortField\" name=\"sortField\"  \r\n                            single-select [panelRef]=\"selectcolpanel\" [items]=\"columns\" [container]=\"tablebodybox\">\r\n                                <!-- <option *ngFor=\"let col of columns\" [value]=\"col.value\">{{ col.label }}</option> -->\r\n                            </select>\r\n\r\n                            <div #selectcolpanel class=\"single-select-panel f-area-hide\" style=\"max-height: 200px;overflow: auto;\">\r\n                                <ul class=\"dropdown-menu show\" style=\"position:relative;min-width: 100%;border:none; box-shadow: none;\">\r\n                                    <li class=\"dropdown-item\" *ngFor=\"let col of columns\" [attr.value]=\"col.value\" [class.active]=\"condition.sortField === col.value\">{{ col.label }}</li>\r\n                                </ul>\r\n                            </div>\r\n                        </ng-container>\r\n                        <farris-combo-lookup *ngIf=\"fieldEditor.type === 'combo-tree'\" name=\"sortField\"\r\n                            [idField]=\"fieldEditor?.options?.idField ||'value'\"\r\n                            [textField]=\"fieldEditor?.options?.textField ||'label'\"\r\n                            [displayType]=\"'LOOKUPTREELIST'\" [useValue]=\"true\"\r\n                            [useTreeView]=\"true\"\r\n                            [columns]=\"fieldEditor?.options?.columns || []\"\r\n                            [data]=\"columns\"\r\n                            [(ngModel)]=\"condition.sortField\"\r\n                            [remoteSearch]=\"false\"\r\n                            [autoWidth]=\"fieldEditor?.options?.autoWidth\"\r\n                            [panelWidth]=\"fieldEditor?.options?.panelWidth || 200\"\r\n                        >\r\n                        </farris-combo-lookup>\r\n\r\n                    </td>\r\n                    <td>\r\n                        <select class=\"form-control filter-select\" [(ngModel)]=\"condition.sortType\" name=\"sortType\"   single-select [panelRef]=\"selectpanel\" [items]=\"sortTypes\"  [container]=\"tablebodybox\">\r\n                            <!-- <option *ngFor=\"let item of sortTypes\" [value]=\"item.value\">{{ item.label }}</option> -->\r\n                        </select>\r\n\r\n                        <div #selectpanel class=\"single-select-panel f-area-hide\" style=\"max-height: 200px;overflow: auto;\">\r\n                            <ul class=\"dropdown-menu show\" style=\"position:relative;min-width: 100%;\" >\r\n                                <li class=\"dropdown-item\" *ngFor=\"let col of sortTypes\" [attr.value]=\"col.value\" [class.active]=\"condition.sortType === col.value\">{{ col.label }}</li>\r\n                            </ul>\r\n                        </div>\r\n                    </td>\r\n                </tr>\r\n            </tbody>\r\n        </table>\r\n    <!-- </perfect-scrollbar> -->\r\n</div>\r\n<div class=\"footer-container px-2\" style=\"flex-shrink: 0;margin: 0 14px; height: 36px; \">\r\n    <button type=\"button\" (click)=\"onAdd()\"\r\n        class=\"k-button k-button-icontext k-flat \"><span class=\"f-icon f-icon-add\"></span> {{ 'sortEditor.add'| locale }}</button>\r\n    <button type=\"button\" (click)=\"onClear()\" [disabled]=\"!conditions.length\"\r\n        class=\"k-button k-button-icontext k-flat \"><span class=\"f-icon f-icon-close\"></span> {{ 'sortEditor.clear'| locale }}</button>\r\n    <button type=\"button\" [disabled]=\"!canMoveUp()\" (click)=\"onMoveTop()\"\r\n        class=\"k-button k-button-icontext k-flat \"><span class=\"f-icon f-icon-arrow-end-up\"></span> {{ 'sortEditor.moveTop'| locale }}</button>\r\n    <button type=\"button\" [disabled]=\"!canMoveUp()\" (click)=\"onMovePrev()\"\r\n        class=\"k-button k-button-icontext k-flat \"><span class=\"f-icon f-icon-arrow-60-up\"></span> {{ 'sortEditor.moveUp'| locale }}</button>\r\n    <button type=\"button\" [disabled]=\"!canMoveDown()\" (click)=\"onMoveNext()\"\r\n        class=\"k-button k-button-icontext k-flat \"><span class=\"f-icon f-icon-arrow-60-down\"></span> {{ 'sortEditor.moveDown'| locale }}</button>\r\n    <button type=\"button\" [disabled]=\"!canMoveDown()\" (click)=\"onMoveBottom()\"\r\n        class=\"k-button k-button-icontext k-flat\"><span class=\"f-icon f-icon-arrow-end-down\"></span> {{ 'sortEditor.moveBottom'| locale }}</button>\r\n</div>",
                    styles: ["\n        .sort-col-header thead th { padding: 0; line-height: 35px;}\n        .filter-select { width:100%; padding-left: 0; padding-right: 0; }\n        .selected { background: #c2e4ff; }\n        "]
                }] }
    ];
    /** @nocollapse */
    SortEditorComponent.ctorParameters = function () { return [
        { type: MessagerService },
        { type: DomSanitizer },
        { type: Injector }
    ]; };
    SortEditorComponent.propDecorators = {
        cls: [{ type: HostBinding, args: ['class',] }],
        fieldEditor: [{ type: Input }],
        conditions: [{ type: Input }],
        columns: [{ type: Input }],
        height: [{ type: Input }],
        psRef: [{ type: ViewChild, args: ['ps',] }],
        tablebodybox: [{ type: ViewChild, args: ['tablebodybox',] }],
        sortsChanged: [{ type: Output }]
    };
    return SortEditorComponent;
}());
export { SortEditorComponent };
if (false) {
    /** @type {?} */
    SortEditorComponent.prototype.sortTypes;
    /** @type {?} */
    SortEditorComponent.prototype.columnSizeData;
    /** @type {?} */
    SortEditorComponent.prototype.cls;
    /** @type {?} */
    SortEditorComponent.prototype.fieldEditor;
    /** @type {?} */
    SortEditorComponent.prototype.conditions;
    /** @type {?} */
    SortEditorComponent.prototype.columns;
    /** @type {?} */
    SortEditorComponent.prototype.height;
    /** @type {?} */
    SortEditorComponent.prototype.psRef;
    /** @type {?} */
    SortEditorComponent.prototype.tablebodybox;
    /** @type {?} */
    SortEditorComponent.prototype.sortsChanged;
    /**
     * @type {?}
     * @private
     */
    SortEditorComponent.prototype.newCondition;
    /** @type {?} */
    SortEditorComponent.prototype.currentCondition;
    /** @type {?} */
    SortEditorComponent.prototype.localeService;
    /**
     * @type {?}
     * @private
     */
    SortEditorComponent.prototype.messagerService;
    /**
     * @type {?}
     * @private
     */
    SortEditorComponent.prototype.sanitizer;
    /**
     * @type {?}
     * @private
     */
    SortEditorComponent.prototype.injector;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic29ydC1lZGl0b3IuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy91aS1zb3J0LWVkaXRvci8iLCJzb3VyY2VzIjpbImxpYi9zb3J0LWVkaXRvci5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFVLFdBQVcsRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFFLFlBQVksRUFBRSxRQUFRLEVBQUUsU0FBUyxFQUFFLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUM3SCxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDdEQsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLFdBQVcsQ0FBQztBQUN0QyxPQUFPLEVBQWlCLFNBQVMsRUFBRSxRQUFRLEVBQUUsTUFBTSx5QkFBeUIsQ0FBQztBQUM3RSxPQUFPLEVBQWEsWUFBWSxFQUFFLE1BQU0sMkJBQTJCLENBQUM7QUFDcEUsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBQ2xELE9BQU8sRUFBRSx5QkFBeUIsRUFBRSxNQUFNLDhCQUE4QixDQUFDO0FBRXpFO0lBcUNJLDZCQUFvQixlQUFnQyxFQUFVLFNBQXVCLEVBQVUsUUFBa0I7UUFBN0Ysb0JBQWUsR0FBZixlQUFlLENBQWlCO1FBQVUsY0FBUyxHQUFULFNBQVMsQ0FBYztRQUFVLGFBQVEsR0FBUixRQUFRLENBQVU7UUF2QmpILGNBQVMsR0FBRyxTQUFTLENBQUM7UUFFdEIsbUJBQWMsR0FBRyxDQUFDLEVBQUUsRUFBRSxHQUFHLEVBQUUsRUFBRSxDQUFDLENBQUM7UUFFVCxRQUFHLEdBQUcsd0RBQXdELENBQUM7UUFFNUUsZ0JBQVcsR0FBRyxFQUFFLElBQUksRUFBRSxRQUFRLEVBQUUsT0FBTyxFQUFFLElBQUksRUFBQyxDQUFDO1FBQy9DLGVBQVUsR0FBb0IsRUFBRSxDQUFDO1FBQ2pDLFlBQU8sR0FBcUMsRUFBRSxDQUFDO1FBTTlDLGlCQUFZLEdBQUcsSUFBSSxZQUFZLEVBQUUsQ0FBQztRQUVwQyxpQkFBWSxHQUFHO1lBQ25CLFNBQVMsRUFBRSxFQUFFO1lBQ2IsUUFBUSxFQUFFLFFBQVEsQ0FBQyxHQUFHO1NBQ3pCLENBQUM7UUFFRixxQkFBZ0IsR0FBZ0QsSUFBSSxDQUFDO1FBR2pFLElBQUksQ0FBQyxhQUFhLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsYUFBYSxDQUFDLENBQUM7UUFFdEQsSUFBSSxDQUFDLFNBQVMsR0FBRztZQUNiLEVBQUUsS0FBSyxFQUFFLElBQUksQ0FBQyxhQUFhLENBQUMsUUFBUSxDQUFDLGdCQUFnQixDQUFDLEVBQUUsS0FBSyxFQUFFLFFBQVEsQ0FBQyxHQUFHLEVBQUU7WUFDN0UsRUFBRSxLQUFLLEVBQUUsSUFBSSxDQUFDLGFBQWEsQ0FBQyxRQUFRLENBQUMsaUJBQWlCLENBQUMsRUFBRSxLQUFLLEVBQUUsUUFBUSxDQUFDLElBQUksRUFBRTtTQUNsRixDQUFDO0lBQ04sQ0FBQzs7OztJQUVELHNDQUFROzs7SUFBUjtJQUNBLENBQUM7SUFFRCx1QkFBdUI7SUFDdkIsbURBQW1EO0lBQ25ELDRDQUE0QztJQUM1QyxRQUFRO0lBQ1IsSUFBSTs7Ozs7Ozs7OztJQUVJLDBDQUFZOzs7Ozs7Ozs7O0lBQXBCO1FBQUEsaUJBYUM7UUFaRyxJQUFJLElBQUksQ0FBQyxZQUFZLEVBQUU7WUFDbkIsVUFBVTs7O1lBQUM7O29CQUNELEVBQUUsR0FBRyxLQUFJLENBQUMsWUFBWSxDQUFDLGFBQWEsQ0FBQyxhQUFhLENBQUMsYUFBYSxDQUFDO2dCQUN2RSxJQUFJLEVBQUUsRUFBRTtvQkFDQSxJQUFJLEVBQUUsQ0FBQyxzQkFBc0IsRUFBRTt3QkFDM0IsRUFBRSxDQUFDLHNCQUFzQixDQUFDLEtBQUssQ0FBQyxDQUFDO3FCQUNwQzt5QkFBTTt3QkFDSCxFQUFFLENBQUMsY0FBYyxDQUFDLEVBQUMsS0FBSyxFQUFFLFNBQVMsRUFBQyxDQUFDLENBQUM7cUJBQ3pDO2lCQUNKO1lBQ1QsQ0FBQyxHQUFFLEVBQUUsQ0FBQyxDQUFDO1NBQ1Y7SUFDTCxDQUFDOzs7OztJQUdELHNDQUFROzs7O0lBQVIsVUFBUyxNQUFNO1FBQ1gsSUFBSSxDQUFDLGdCQUFnQixHQUFHLE1BQU0sQ0FBQztJQUNuQyxDQUFDOzs7OztJQUVELHdDQUFVOzs7O0lBQVYsVUFBVyxNQUFjO1FBQ3JCLElBQUksSUFBSSxDQUFDLGdCQUFnQixFQUFFO1lBQ3ZCLE9BQU8sSUFBSSxDQUFDLGdCQUFnQixDQUFDLEtBQUssS0FBSyxNQUFNLENBQUM7U0FDakQ7UUFDRCxPQUFPLEtBQUssQ0FBQztJQUNqQixDQUFDOzs7OztJQUVELDZDQUFlOzs7O0lBQWYsVUFBZ0IsS0FBYTs7WUFDbkIsYUFBYSxHQUFHLE1BQU0sQ0FBQyxNQUFNLENBQUMsRUFBRSxFQUFFLElBQUksQ0FBQyxZQUFZLENBQUM7UUFDMUQsSUFBSSxLQUFLLEtBQU0sQ0FBQyxFQUFFO1lBQ2QsSUFBSSxDQUFDLFVBQVUscUJBQUksYUFBYSxHQUFLLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQztTQUN6RDthQUFNOztnQkFDRyxLQUFLLEdBQUcsU0FBUyxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUM7WUFDeEMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxLQUFLLEVBQUUsQ0FBQyxFQUFFLGFBQWEsQ0FBQyxDQUFDO1lBQ3RDLElBQUksQ0FBQyxVQUFVLG9CQUFPLEtBQUssQ0FBQyxDQUFDO1NBQ2hDO1FBQ0QsSUFBSSxDQUFDLG1CQUFtQixDQUFDLFFBQVEsQ0FBQyxDQUFDO0lBQ3ZDLENBQUM7Ozs7O0lBRUQsNkNBQWU7Ozs7SUFBZixVQUFnQixLQUFhO1FBQ3pCLElBQUksQ0FBQyxVQUFVLENBQUMsTUFBTSxDQUFDLEtBQUssRUFBRSxDQUFDLENBQUMsQ0FBQztRQUNqQyxJQUFJLENBQUMsbUJBQW1CLENBQUMsUUFBUSxDQUFDLENBQUM7UUFFbkMsSUFBSSxJQUFJLENBQUMsZ0JBQWdCLEVBQUU7WUFDdkIsSUFBSSxLQUFLLEtBQUssSUFBSSxDQUFDLGdCQUFnQixDQUFDLEtBQUssRUFBRTtnQkFFdkMsSUFBSyxJQUFJLENBQUMsVUFBVSxDQUFDLEtBQUssQ0FBQyxFQUFHO29CQUMxQixJQUFJLENBQUMsZ0JBQWdCLEdBQUcsRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLFNBQVMsRUFBRSxJQUFJLENBQUMsVUFBVSxDQUFDLEtBQUssQ0FBQyxFQUFFLENBQUM7aUJBQy9FO3FCQUFNO29CQUNILElBQUssSUFBSSxDQUFDLFVBQVUsQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFDLEVBQUc7d0JBQzlCLElBQUksQ0FBQyxnQkFBZ0IsR0FBRyxFQUFFLEtBQUssRUFBRSxLQUFLLEdBQUcsQ0FBQyxFQUFFLFNBQVMsRUFBRSxJQUFJLENBQUMsVUFBVSxDQUFDLEtBQUssR0FBRyxDQUFDLENBQUMsRUFBRSxDQUFDO3FCQUN2Rjt5QkFBTTt3QkFDSCxJQUFJLENBQUMsZ0JBQWdCLEdBQUcsSUFBSSxDQUFDO3FCQUNoQztpQkFDSjthQUNKO2lCQUFNO2dCQUNILElBQUksQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxLQUFLLENBQUMsRUFBRTtvQkFDL0MsSUFBSSxJQUFJLENBQUMsZ0JBQWdCLENBQUMsS0FBSyxHQUFHLEtBQUssRUFBRTt3QkFDckMsSUFBSSxDQUFDLGdCQUFnQixDQUFDLEtBQUssR0FBRyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsS0FBSyxHQUFHLENBQUMsQ0FBQztxQkFDakU7eUJBQU07d0JBQ0gsSUFBSSxDQUFDLGdCQUFnQixDQUFDLEtBQUssR0FBRyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsS0FBSyxHQUFHLENBQUMsQ0FBRTtxQkFDbEU7aUJBQ0o7YUFDSjtTQUNKO0lBQ0wsQ0FBQzs7OztJQUVELG1DQUFLOzs7SUFBTDs7WUFDVSxPQUFPLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBQyxFQUFFLEVBQUUsSUFBSSxDQUFDLFlBQVksQ0FBQztRQUNwRCxJQUFJLENBQUMsVUFBVSxvQkFBTyxJQUFJLENBQUMsVUFBVSxHQUFFLE9BQU8sRUFBQyxDQUFDO1FBQ2hELElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxLQUFLLENBQUMsQ0FBQzs7WUFDMUIsTUFBTSxHQUFHLElBQUksQ0FBQyxVQUFVLENBQUMsTUFBTSxHQUFHLENBQUM7UUFDekMsSUFBSSxDQUFDLGdCQUFnQixHQUFHLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRSxTQUFTLEVBQUUsT0FBTyxFQUFFLENBQUM7SUFDbEUsQ0FBQzs7OztJQUVELHFDQUFPOzs7SUFBUDtRQUFBLGlCQU1DO1FBTEcsSUFBSSxDQUFDLGVBQWUsQ0FBQyxRQUFRLENBQUMsaUJBQWlCOzs7UUFBRTtZQUM3QyxLQUFJLENBQUMsVUFBVSxHQUFHLEVBQUUsQ0FBQztZQUNyQixLQUFJLENBQUMsZ0JBQWdCLEdBQUcsSUFBSSxDQUFDO1lBQzdCLEtBQUksQ0FBQyxtQkFBbUIsQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUN0QyxDQUFDLEVBQUMsQ0FBQztJQUNQLENBQUM7Ozs7SUFFRCx1Q0FBUzs7O0lBQVQ7UUFDSSxJQUFJLElBQUksQ0FBQyxnQkFBZ0IsRUFBRTtZQUN2QixJQUFJLENBQUMsVUFBVSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsU0FBUyxDQUFDLENBQUM7WUFDekQsSUFBSSxDQUFDLFVBQVUsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLGdCQUFnQixDQUFDLEtBQUssR0FBRyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7WUFFM0QsSUFBSSxDQUFDLGdCQUFnQixDQUFDLEtBQUssR0FBRyxDQUFDLENBQUM7WUFDaEMsSUFBSSxDQUFDLG1CQUFtQixDQUFDLFNBQVMsQ0FBQyxDQUFDO1NBQ3ZDO0lBQ0wsQ0FBQzs7OztJQUVELHdDQUFVOzs7SUFBVjs7UUFDSSxJQUFJLElBQUksQ0FBQyxnQkFBZ0IsRUFBRTs7Z0JBQ2pCLEtBQUssR0FBRyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsS0FBSzs7Z0JBQ25DLE9BQU8sR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDLE1BQU0sQ0FBQyxLQUFLLEVBQUUsQ0FBQyxDQUFDO1lBQ2hELENBQUEsS0FBQSxJQUFJLENBQUMsVUFBVSxDQUFBLENBQUMsTUFBTSw2QkFBQyxLQUFLLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBSyxPQUFPLEdBQUU7WUFFakQsSUFBSSxDQUFDLGdCQUFnQixDQUFDLEtBQUssR0FBRyxLQUFLLEdBQUcsQ0FBQyxDQUFDO1lBQ3hDLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxVQUFVLENBQUMsQ0FBQztTQUN4QztJQUNMLENBQUM7Ozs7SUFDRCx3Q0FBVTs7O0lBQVY7O1FBQ0ksSUFBSSxJQUFJLENBQUMsZ0JBQWdCLEVBQUU7O2dCQUNqQixLQUFLLEdBQUcsSUFBSSxDQUFDLGdCQUFnQixDQUFDLEtBQUs7O2dCQUNuQyxPQUFPLEdBQUcsSUFBSSxDQUFDLFVBQVUsQ0FBQyxNQUFNLENBQUMsS0FBSyxFQUFFLENBQUMsQ0FBQztZQUNoRCxDQUFBLEtBQUEsSUFBSSxDQUFDLFVBQVUsQ0FBQSxDQUFDLE1BQU0sNkJBQUMsS0FBSyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUssT0FBTyxHQUFFO1lBRWpELElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxLQUFLLEdBQUcsS0FBSyxHQUFHLENBQUMsQ0FBQztZQUN4QyxJQUFJLENBQUMsbUJBQW1CLENBQUMsVUFBVSxDQUFDLENBQUM7U0FDeEM7SUFDTCxDQUFDOzs7O0lBQ0QsMENBQVk7OztJQUFaO1FBQ0ksSUFBSSxJQUFJLENBQUMsZ0JBQWdCLEVBQUU7WUFDdkIsSUFBSSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLGdCQUFnQixDQUFDLFNBQVMsQ0FBQyxDQUFDO1lBQ3RELElBQUksQ0FBQyxVQUFVLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxLQUFLLEVBQUUsQ0FBQyxDQUFDLENBQUM7WUFDdkQsSUFBSSxDQUFDLGdCQUFnQixDQUFDLEtBQUssR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUM7WUFDekQsSUFBSSxDQUFDLG1CQUFtQixDQUFDLFlBQVksQ0FBQyxDQUFDO1NBQzFDO0lBQ0wsQ0FBQzs7OztJQUVELG9DQUFNOzs7SUFBTjtRQUNJLElBQUksSUFBSSxDQUFDLGdCQUFnQixFQUFFO1lBQ3ZCLE9BQU8sSUFBSSxDQUFDLFVBQVUsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDO1NBQ3JDO1FBRUQsT0FBTyxLQUFLLENBQUM7SUFDakIsQ0FBQzs7OztJQUVELHVDQUFTOzs7SUFBVDtRQUNJLElBQUksSUFBSSxDQUFDLE1BQU0sRUFBRSxFQUFFO1lBQ2YsT0FBTyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsS0FBSyxHQUFHLENBQUMsQ0FBQztTQUMxQztRQUVELE9BQU8sS0FBSyxDQUFDO0lBQ2pCLENBQUM7Ozs7SUFFRCx5Q0FBVzs7O0lBQVg7UUFDSSxJQUFJLElBQUksQ0FBQyxNQUFNLEVBQUUsRUFBRTtZQUNmLE9BQU8sSUFBSSxDQUFDLGdCQUFnQixDQUFDLEtBQUssR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUM7U0FDbkU7UUFFRCxPQUFPLEtBQUssQ0FBQztJQUNqQixDQUFDOzs7Ozs7SUFFTyxpREFBbUI7Ozs7O0lBQTNCLFVBQTRCLE1BQWtGO1FBQTlHLGlCQU1DO1FBTEcsSUFBSSxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsRUFBRSxNQUFNLFFBQUEsRUFBRSxJQUFJLEVBQUUsSUFBSSxDQUFDLFVBQVUsRUFBQyxDQUFDLENBQUM7UUFDekQsVUFBVTs7O1FBQUM7WUFDUCxLQUFJLENBQUMsWUFBWSxFQUFFLENBQUM7WUFDcEIsNkJBQTZCO1FBQ2pDLENBQUMsRUFBQyxDQUFDO0lBQ1AsQ0FBQzs7Z0JBL01KLFNBQVMsU0FBQztvQkFDUCxRQUFRLEVBQUUsYUFBYTtvQkFDdkIsNGxOQUF5Qzs2QkFFckMsd01BSUM7aUJBRVI7Ozs7Z0JBakJRLGVBQWU7Z0JBR0osWUFBWTtnQkFKc0MsUUFBUTs7O3NCQTBCekUsV0FBVyxTQUFDLE9BQU87OEJBRW5CLEtBQUs7NkJBQ0wsS0FBSzswQkFDTCxLQUFLO3lCQUNMLEtBQUs7d0JBRUwsU0FBUyxTQUFDLElBQUk7K0JBQ2QsU0FBUyxTQUFDLGNBQWM7K0JBRXhCLE1BQU07O0lBK0xYLDBCQUFDO0NBQUEsQUEzTkQsSUEyTkM7U0EvTVksbUJBQW1COzs7SUFFNUIsd0NBQXNCOztJQUV0Qiw2Q0FBK0I7O0lBRS9CLGtDQUFxRjs7SUFFckYsMENBQXdEOztJQUN4RCx5Q0FBMEM7O0lBQzFDLHNDQUF3RDs7SUFDeEQscUNBQXdCOztJQUV4QixvQ0FBa0Q7O0lBQ2xELDJDQUFvRDs7SUFFcEQsMkNBQTRDOzs7OztJQUU1QywyQ0FHRTs7SUFFRiwrQ0FBcUU7O0lBQ3JFLDRDQUE2Qjs7Ozs7SUFDakIsOENBQXdDOzs7OztJQUFFLHdDQUErQjs7Ozs7SUFBRSx1Q0FBMEIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIE9uSW5pdCwgSG9zdEJpbmRpbmcsIElucHV0LCBPdXRwdXQsIEV2ZW50RW1pdHRlciwgSW5qZWN0b3IsIFZpZXdDaGlsZCwgRWxlbWVudFJlZiB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBNZXNzYWdlclNlcnZpY2UgfSBmcm9tICdAZmFycmlzL3VpLW1lc3NhZ2VyJztcclxuaW1wb3J0IHsgY2xvbmVEZWVwIH0gZnJvbSAnbG9kYXNoLWVzJztcclxuaW1wb3J0IHsgU29ydENvbmRpdGlvbiwgU29ydFR5cGVzLCBTb3J0VHlwZSB9IGZyb20gJ0BmYXJyaXMvdWktY29tbW9uL3R5cGVzJztcclxuaW1wb3J0IHsgU2FmZVN0eWxlLCBEb21TYW5pdGl6ZXIgfSBmcm9tICdAYW5ndWxhci9wbGF0Zm9ybS1icm93c2VyJztcclxuaW1wb3J0IHsgTG9jYWxlU2VydmljZSB9IGZyb20gJ0BmYXJyaXMvdWktbG9jYWxlJztcclxuaW1wb3J0IHsgUGVyZmVjdFNjcm9sbGJhckNvbXBvbmVudCB9IGZyb20gJ0BmYXJyaXMvdWktcGVyZmVjdC1zY3JvbGxiYXInO1xyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgICBzZWxlY3RvcjogJ3NvcnQtZWRpdG9yJyxcclxuICAgIHRlbXBsYXRlVXJsOiAnc29ydC1lZGl0b3IuY29tcG9uZW50Lmh0bWwnLFxyXG4gICAgc3R5bGVzOiBbXHJcbiAgICAgICAgYFxyXG4gICAgICAgIC5zb3J0LWNvbC1oZWFkZXIgdGhlYWQgdGggeyBwYWRkaW5nOiAwOyBsaW5lLWhlaWdodDogMzVweDt9XHJcbiAgICAgICAgLmZpbHRlci1zZWxlY3QgeyB3aWR0aDoxMDAlOyBwYWRkaW5nLWxlZnQ6IDA7IHBhZGRpbmctcmlnaHQ6IDA7IH1cclxuICAgICAgICAuc2VsZWN0ZWQgeyBiYWNrZ3JvdW5kOiAjYzJlNGZmOyB9XHJcbiAgICAgICAgYFxyXG4gICAgXVxyXG59KVxyXG5cclxuZXhwb3J0IGNsYXNzIFNvcnRFZGl0b3JDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xyXG5cclxuICAgIHNvcnRUeXBlcyA9IFNvcnRUeXBlcztcclxuXHJcbiAgICBjb2x1bW5TaXplRGF0YSA9IFszMCwgMTIwLCA2MF07XHJcblxyXG4gICAgQEhvc3RCaW5kaW5nKCdjbGFzcycpIGNscyA9ICdmLXNvcnQtZWRpdG9yIGYtdXRpbHMtZmxleC1jb2x1bW4gZi11dGlscy1hYnNvbHV0ZS1hbGwnO1xyXG5cclxuICAgIEBJbnB1dCgpIGZpZWxkRWRpdG9yID0geyB0eXBlOiAnc2VsZWN0Jywgb3B0aW9uczogbnVsbH07XHJcbiAgICBASW5wdXQoKSBjb25kaXRpb25zOiBTb3J0Q29uZGl0aW9uW10gPSBbXTtcclxuICAgIEBJbnB1dCgpIGNvbHVtbnM6IHtsYWJlbDogc3RyaW5nLCB2YWx1ZTogc3RyaW5nfVtdID0gW107XHJcbiAgICBASW5wdXQoKSBoZWlnaHQ6IG51bWJlcjtcclxuXHJcbiAgICBAVmlld0NoaWxkKCdwcycpIHBzUmVmOiBQZXJmZWN0U2Nyb2xsYmFyQ29tcG9uZW50O1xyXG4gICAgQFZpZXdDaGlsZCgndGFibGVib2R5Ym94JykgdGFibGVib2R5Ym94OiBFbGVtZW50UmVmO1xyXG5cclxuICAgIEBPdXRwdXQoKSBzb3J0c0NoYW5nZWQgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcblxyXG4gICAgcHJpdmF0ZSBuZXdDb25kaXRpb24gPSB7XHJcbiAgICAgICAgc29ydEZpZWxkOiAnJyxcclxuICAgICAgICBzb3J0VHlwZTogU29ydFR5cGUuQXNjLFxyXG4gICAgfTtcclxuXHJcbiAgICBjdXJyZW50Q29uZGl0aW9uOiB7IGluZGV4OiBudW1iZXIsIGNvbmRpdGlvbjogU29ydENvbmRpdGlvbiB9ID0gbnVsbDtcclxuICAgIGxvY2FsZVNlcnZpY2U6IExvY2FsZVNlcnZpY2U7XHJcbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIG1lc3NhZ2VyU2VydmljZTogTWVzc2FnZXJTZXJ2aWNlLCBwcml2YXRlIHNhbml0aXplcjogRG9tU2FuaXRpemVyLCBwcml2YXRlIGluamVjdG9yOiBJbmplY3Rvcikge1xyXG4gICAgICAgIHRoaXMubG9jYWxlU2VydmljZSA9IHRoaXMuaW5qZWN0b3IuZ2V0KExvY2FsZVNlcnZpY2UpO1xyXG5cclxuICAgICAgICB0aGlzLnNvcnRUeXBlcyA9IFtcclxuICAgICAgICAgICAgeyBsYWJlbDogdGhpcy5sb2NhbGVTZXJ2aWNlLmdldFZhbHVlKCdzb3J0RWRpdG9yLmFzYycpLCB2YWx1ZTogU29ydFR5cGUuQXNjIH0sXHJcbiAgICAgICAgICAgIHsgbGFiZWw6IHRoaXMubG9jYWxlU2VydmljZS5nZXRWYWx1ZSgnc29ydEVkaXRvci5kZXNjJyksIHZhbHVlOiBTb3J0VHlwZS5EZXNjIH1cclxuICAgICAgICBdO1xyXG4gICAgfVxyXG5cclxuICAgIG5nT25Jbml0KCkge1xyXG4gICAgfVxyXG5cclxuICAgIC8vIHByaXZhdGUgcHNVcGRhdGUoKSB7XHJcbiAgICAvLyAgICAgaWYgKHRoaXMucHNSZWYgJiYgdGhpcy5wc1JlZi5kaXJlY3RpdmVSZWYpIHtcclxuICAgIC8vICAgICAgICAgdGhpcy5wc1JlZi5kaXJlY3RpdmVSZWYudXBkYXRlKCk7XHJcbiAgICAvLyAgICAgfVxyXG4gICAgLy8gfVxyXG5cclxuICAgIHByaXZhdGUgaXRlbUludG9WaWV3KCkge1xyXG4gICAgICAgIGlmICh0aGlzLnRhYmxlYm9keWJveCkge1xyXG4gICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHRyID0gdGhpcy50YWJsZWJvZHlib3gubmF0aXZlRWxlbWVudC5xdWVyeVNlbGVjdG9yKCd0ci5zZWxlY3RlZCcpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHRyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0ci5zY3JvbGxJbnRvVmlld0lmTmVlZGVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ci5zY3JvbGxJbnRvVmlld0lmTmVlZGVkKGZhbHNlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyLnNjcm9sbEludG9WaWV3KHtibG9jazogJ25lYXJlc3QnfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sIDUwKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG5cclxuICAgIHNlbGVjdGVkKCRldmVudCkge1xyXG4gICAgICAgIHRoaXMuY3VycmVudENvbmRpdGlvbiA9ICRldmVudDtcclxuICAgIH1cclxuXHJcbiAgICBpc1NlbGVjdGVkKCRldmVudDogbnVtYmVyKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuY3VycmVudENvbmRpdGlvbikge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5jdXJyZW50Q29uZGl0aW9uLmluZGV4ID09PSAkZXZlbnQ7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuXHJcbiAgICBpbnNlcnRDb25kaXRpb24oaW5kZXg6IG51bWJlcikge1xyXG4gICAgICAgIGNvbnN0IF9uZXdDb25kaXRpb24gPSBPYmplY3QuYXNzaWduKHt9LCB0aGlzLm5ld0NvbmRpdGlvbik7XHJcbiAgICAgICAgaWYgKGluZGV4ICA9PT0gMCkge1xyXG4gICAgICAgICAgICB0aGlzLmNvbmRpdGlvbnMgPSBbX25ld0NvbmRpdGlvbiwgLi4udGhpcy5jb25kaXRpb25zXTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBjb25zdCBfZGF0YSA9IGNsb25lRGVlcCh0aGlzLmNvbmRpdGlvbnMpO1xyXG4gICAgICAgICAgICBfZGF0YS5zcGxpY2UoaW5kZXgsIDAsIF9uZXdDb25kaXRpb24pO1xyXG4gICAgICAgICAgICB0aGlzLmNvbmRpdGlvbnMgPSBbLi4uX2RhdGFdO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmNoYW5nZUNvbmRpdGlvbkxpc3QoJ2luc2VydCcpO1xyXG4gICAgfVxyXG5cclxuICAgIHJlbW92ZUNvbmRpdGlvbihpbmRleDogbnVtYmVyKSB7XHJcbiAgICAgICAgdGhpcy5jb25kaXRpb25zLnNwbGljZShpbmRleCwgMSk7XHJcbiAgICAgICAgdGhpcy5jaGFuZ2VDb25kaXRpb25MaXN0KCdyZW1vdmUnKTtcclxuXHJcbiAgICAgICAgaWYgKHRoaXMuY3VycmVudENvbmRpdGlvbikge1xyXG4gICAgICAgICAgICBpZiAoaW5kZXggPT09IHRoaXMuY3VycmVudENvbmRpdGlvbi5pbmRleCkge1xyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICBpZiAoIHRoaXMuY29uZGl0aW9uc1tpbmRleF0gKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50Q29uZGl0aW9uID0geyBpbmRleDogaW5kZXgsIGNvbmRpdGlvbjogdGhpcy5jb25kaXRpb25zW2luZGV4XSB9O1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIHRoaXMuY29uZGl0aW9uc1tpbmRleCAtIDFdICkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmN1cnJlbnRDb25kaXRpb24gPSB7IGluZGV4OiBpbmRleCAtIDEsIGNvbmRpdGlvbjogdGhpcy5jb25kaXRpb25zW2luZGV4IC0gMV0gfTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmN1cnJlbnRDb25kaXRpb24gPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGlmICghdGhpcy5jb25kaXRpb25zW3RoaXMuY3VycmVudENvbmRpdGlvbi5pbmRleF0pIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5jdXJyZW50Q29uZGl0aW9uLmluZGV4ID4gaW5kZXgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50Q29uZGl0aW9uLmluZGV4ID0gdGhpcy5jdXJyZW50Q29uZGl0aW9uLmluZGV4IC0gMTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmN1cnJlbnRDb25kaXRpb24uaW5kZXggPSB0aGlzLmN1cnJlbnRDb25kaXRpb24uaW5kZXggKyAxIDtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgb25BZGQoKSB7XHJcbiAgICAgICAgY29uc3QgbmV3SXRlbSA9IE9iamVjdC5hc3NpZ24oe30sIHRoaXMubmV3Q29uZGl0aW9uKTtcclxuICAgICAgICB0aGlzLmNvbmRpdGlvbnMgPSBbLi4udGhpcy5jb25kaXRpb25zLCBuZXdJdGVtXTtcclxuICAgICAgICB0aGlzLmNoYW5nZUNvbmRpdGlvbkxpc3QoJ2FkZCcpO1xyXG4gICAgICAgIGNvbnN0IG5ld0lkeCA9IHRoaXMuY29uZGl0aW9ucy5sZW5ndGggLSAxO1xyXG4gICAgICAgIHRoaXMuY3VycmVudENvbmRpdGlvbiA9IHsgaW5kZXg6IG5ld0lkeCwgY29uZGl0aW9uOiBuZXdJdGVtIH07XHJcbiAgICB9XHJcblxyXG4gICAgb25DbGVhcigpIHtcclxuICAgICAgICB0aGlzLm1lc3NhZ2VyU2VydmljZS5xdWVzdGlvbign56Gu6K6k6KaB5riF56m65b2T5YmN5omA5pyJ5o6S5bqP5a2X5q615ZCX77yfJywgKCkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLmNvbmRpdGlvbnMgPSBbXTtcclxuICAgICAgICAgICAgdGhpcy5jdXJyZW50Q29uZGl0aW9uID0gbnVsbDtcclxuICAgICAgICAgICAgdGhpcy5jaGFuZ2VDb25kaXRpb25MaXN0KCdjbGVhcicpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIG9uTW92ZVRvcCgpIHtcclxuICAgICAgICBpZiAodGhpcy5jdXJyZW50Q29uZGl0aW9uKSB7XHJcbiAgICAgICAgICAgIHRoaXMuY29uZGl0aW9ucy51bnNoaWZ0KHRoaXMuY3VycmVudENvbmRpdGlvbi5jb25kaXRpb24pO1xyXG4gICAgICAgICAgICB0aGlzLmNvbmRpdGlvbnMuc3BsaWNlKHRoaXMuY3VycmVudENvbmRpdGlvbi5pbmRleCArIDEsIDEpO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5jdXJyZW50Q29uZGl0aW9uLmluZGV4ID0gMDtcclxuICAgICAgICAgICAgdGhpcy5jaGFuZ2VDb25kaXRpb25MaXN0KCdtb3ZlVG9wJyk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIG9uTW92ZVByZXYoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuY3VycmVudENvbmRpdGlvbikge1xyXG4gICAgICAgICAgICBjb25zdCBpbmRleCA9IHRoaXMuY3VycmVudENvbmRpdGlvbi5pbmRleDtcclxuICAgICAgICAgICAgY29uc3QgdGVtcEFyciA9IHRoaXMuY29uZGl0aW9ucy5zcGxpY2UoaW5kZXgsIDEpO1xyXG4gICAgICAgICAgICB0aGlzLmNvbmRpdGlvbnMuc3BsaWNlKGluZGV4IC0gMSwgMCwgLi4udGVtcEFycik7XHJcblxyXG4gICAgICAgICAgICB0aGlzLmN1cnJlbnRDb25kaXRpb24uaW5kZXggPSBpbmRleCAtIDE7XHJcbiAgICAgICAgICAgIHRoaXMuY2hhbmdlQ29uZGl0aW9uTGlzdCgnbW92ZVByZXYnKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBvbk1vdmVOZXh0KCkge1xyXG4gICAgICAgIGlmICh0aGlzLmN1cnJlbnRDb25kaXRpb24pIHtcclxuICAgICAgICAgICAgY29uc3QgaW5kZXggPSB0aGlzLmN1cnJlbnRDb25kaXRpb24uaW5kZXg7XHJcbiAgICAgICAgICAgIGNvbnN0IHRlbXBBcnIgPSB0aGlzLmNvbmRpdGlvbnMuc3BsaWNlKGluZGV4LCAxKTtcclxuICAgICAgICAgICAgdGhpcy5jb25kaXRpb25zLnNwbGljZShpbmRleCArIDEsIDAsIC4uLnRlbXBBcnIpO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5jdXJyZW50Q29uZGl0aW9uLmluZGV4ID0gaW5kZXggKyAxO1xyXG4gICAgICAgICAgICB0aGlzLmNoYW5nZUNvbmRpdGlvbkxpc3QoJ21vdmVOZXh0Jyk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgb25Nb3ZlQm90dG9tKCkge1xyXG4gICAgICAgIGlmICh0aGlzLmN1cnJlbnRDb25kaXRpb24pIHtcclxuICAgICAgICAgICAgdGhpcy5jb25kaXRpb25zLnB1c2godGhpcy5jdXJyZW50Q29uZGl0aW9uLmNvbmRpdGlvbik7XHJcbiAgICAgICAgICAgIHRoaXMuY29uZGl0aW9ucy5zcGxpY2UodGhpcy5jdXJyZW50Q29uZGl0aW9uLmluZGV4LCAxKTtcclxuICAgICAgICAgICAgdGhpcy5jdXJyZW50Q29uZGl0aW9uLmluZGV4ID0gdGhpcy5jb25kaXRpb25zLmxlbmd0aCAtIDE7XHJcbiAgICAgICAgICAgIHRoaXMuY2hhbmdlQ29uZGl0aW9uTGlzdCgnbW92ZUJvdHRvbScpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBjYW5Vc2UoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuY3VycmVudENvbmRpdGlvbikge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5jb25kaXRpb25zLmxlbmd0aCA+IDE7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcblxyXG4gICAgY2FuTW92ZVVwKCkge1xyXG4gICAgICAgIGlmICh0aGlzLmNhblVzZSgpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmN1cnJlbnRDb25kaXRpb24uaW5kZXggPiAwO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG5cclxuICAgIGNhbk1vdmVEb3duKCkge1xyXG4gICAgICAgIGlmICh0aGlzLmNhblVzZSgpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmN1cnJlbnRDb25kaXRpb24uaW5kZXggPCB0aGlzLmNvbmRpdGlvbnMubGVuZ3RoIC0gMTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGNoYW5nZUNvbmRpdGlvbkxpc3QoYWN0aW9uOiAnYWRkJ3wnbW92ZVRvcCd8J21vdmVCb3R0b20nfCdtb3ZlUHJldid8J21vdmVOZXh0J3wnaW5zZXJ0J3wnY2xlYXInfHN0cmluZykge1xyXG4gICAgICAgIHRoaXMuc29ydHNDaGFuZ2VkLmVtaXQoeyBhY3Rpb24sIGRhdGE6IHRoaXMuY29uZGl0aW9uc30pO1xyXG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLml0ZW1JbnRvVmlldygpO1xyXG4gICAgICAgICAgICAvLyB0aGlzLnNldENvbnRhaW5lclN0eWxlcygpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIHByaXZhdGUgc2V0Q29udGFpbmVyU3R5bGVzKCkge1xyXG4gICAgLy8gICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgLy8gICAgICAgICBjb25zdCBjb250YWluZXIgPSB0aGlzLnRhYmxlYm9keWJveC5uYXRpdmVFbGVtZW50O1xyXG4gICAgLy8gICAgICAgICBpZiAoY29udGFpbmVyLm9mZnNldEhlaWdodCA8IGNvbnRhaW5lci5zY3JvbGxIZWlnaHQpIHtcclxuICAgIC8vICAgICAgICAgICAgIGNvbnRhaW5lci5zdHlsZS5tYXJnaW5SaWdodCA9ICcwcHgnXHJcbiAgICAvLyAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAvLyAgICAgICAgICAgICBjb250YWluZXIuc3R5bGUubWFyZ2luUmlnaHQgPSAnMTRweCdcclxuICAgIC8vICAgICAgICAgfVxyXG4gICAgLy8gICAgIH0pO1xyXG4gICAgLy8gfVxyXG59XHJcbiJdfQ==
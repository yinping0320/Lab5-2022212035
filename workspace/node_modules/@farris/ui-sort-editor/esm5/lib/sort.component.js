/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { ChangeDetectorRef } from '@angular/core';
/*
* @Author: 疯狂秀才(lucas huang)
* @Date: 2018-11-23 08:33:37
 * @LastEditors: 疯狂秀才(Lucas Huang)
 * @LastEditTime: 2019-10-17 16:38:53
* @Company: Inspur
* @Version: v0.0.1
*/
import { Component, Input, Output, EventEmitter, ViewChild, TemplateRef, Injector, ComponentFactoryResolver, ElementRef, forwardRef, HostListener, HostBinding } from '@angular/core';
import { cloneDeep } from 'lodash-es';
import { LookupComponent } from '@farris/ui-lookup';
import { BsModalService } from '@farris/ui-modal';
import { SortEditorComponent } from './sort-editor.component';
import { NG_VALUE_ACCESSOR } from '@angular/forms';
import { LocaleService } from '@farris/ui-locale';
import { CommonUtils } from '@farris/ui-common';
/**
 * @record
 */
export function SORT_FIELD_EDITOR() { }
if (false) {
    /** @type {?} */
    SORT_FIELD_EDITOR.prototype.type;
    /** @type {?|undefined} */
    SORT_FIELD_EDITOR.prototype.options;
}
/** @type {?} */
export var SORTER_LOOKUPGRID_VALUE_ACCESSOR = {
    provide: NG_VALUE_ACCESSOR,
    useExisting: forwardRef((/**
     * @return {?}
     */
    function () { return SorterComponent; })),
    multi: true
};
var SorterComponent = /** @class */ (function (_super) {
    tslib_1.__extends(SorterComponent, _super);
    function SorterComponent(injector, cfr, modalService, el) {
        var _this = _super.call(this, injector, el) || this;
        _this.cfr = cfr;
        _this.modalService = modalService;
        _this.el = el;
        _this.hostCls = 'f-cmp-inputgroup';
        _this.text = '';
        _this.conditions = [];
        _this.originalData = [];
        _this.columns = [];
        _this.fieldEditor = { type: 'select', options: {} };
        _this.returnType = 'object';
        _this.enableClear = true;
        _this.openDialog = new EventEmitter();
        _this.cd = null;
        _this.showClearButton = false;
        _this.commonUtils = null;
        _this.localeService = _this.injector.get(LocaleService);
        _this.cd = _this.injector.get(ChangeDetectorRef, null);
        _this.commonUtils = _this.injector.get(CommonUtils, null) || new CommonUtils();
        return _this;
    }
    /**
     * @return {?}
     */
    SorterComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () { };
    /**
     * @return {?}
     */
    SorterComponent.prototype.onmouseover = /**
     * @return {?}
     */
    function () {
        this.showClearButton = true;
    };
    /**
     * @return {?}
     */
    SorterComponent.prototype.onmouseleave = /**
     * @return {?}
     */
    function () {
        this.showClearButton = false;
    };
    /**
     * @return {?}
     */
    SorterComponent.prototype.showDialog = /**
     * @return {?}
     */
    function () {
        var _this = this;
        if (!this.disabled) {
            if (this.fieldEditor && this.fieldEditor.type === 'combo-tree') {
                this.fieldEditor.options = this.fieldEditor.options || {};
                if (this.fieldEditor.options.autoWidth === undefined) {
                    this.fieldEditor.options.autoWidth = true;
                }
                if (!this.fieldEditor.options.columns) {
                    this.fieldEditor.options.columns = [{ field: 'label', title: 'label', width: 100 }];
                }
                if (!this.fieldEditor.options.textField) {
                    this.fieldEditor.options.textField = 'label';
                }
                if (!this.fieldEditor.options.idField) {
                    this.fieldEditor.options.idField = 'value';
                }
            }
            /** @type {?} */
            var sortEditorFactory = this.cfr.resolveComponentFactory(SortEditorComponent);
            this.sortEditorRef = sortEditorFactory.create(this.injector);
            this.sortEditorRef.instance.columns = this.columns;
            this.sortEditorRef.instance.conditions = this.conditions;
            this.originalData = cloneDeep(this.conditions);
            this.dlgRef = this.modalService.show(this.sortEditorRef, {
                width: 500, height: 400,
                title: this.localeService.getValue('sortEditor.title'),
                enableScroll: false,
                minHeight: 298, minWidth: 498, iconCls: 'f-icon f-icon-col-defaultsort',
                buttons: this.btnRef,
                showMaxButton: false, buttonAlign: 'right',
                // dialogFooterStyles: { background: '#F4F6F9' },
                initialState: {
                    fieldEditor: this.fieldEditor
                }
            });
            this.sortEditorRef.instance.height = this.dlgRef.dialog.instance.getContainerSize().height;
            this.dlgRef.dialog.instance.resized.subscribe((/**
             * @param {?} size
             * @return {?}
             */
            function (size) {
                _this.sortEditorRef.instance.height = size.containerHeight;
            }));
            this.sortEditorRef.instance.sortsChanged.subscribe((/**
             * @param {?} e
             * @return {?}
             */
            function (e) {
                _this.conditions = e.data;
            }));
            this.sortEditorRef.changeDetectorRef.detectChanges();
            this.dlgRef.dialog.changeDetectorRef.reattach();
            this.openDialog.emit();
        }
    };
    /**
     * @param {?} val
     * @return {?}
     */
    SorterComponent.prototype.writeValue = /**
     * @param {?} val
     * @return {?}
     */
    function (val) {
        if (val) {
            if (typeof val === 'string') {
                val = JSON.parse(val);
            }
            this.conditions = val || [];
            this.text = this.commonUtils.buildSortString(val);
        }
    };
    /**
     * @return {?}
     */
    SorterComponent.prototype.save = /**
     * @return {?}
     */
    function () {
        if (this.conditions.length) {
            this.conditions = this.conditions.filter((/**
             * @param {?} c
             * @return {?}
             */
            function (c) { return c.sortField; }));
            this.text = this.commonUtils.buildSortString(this.conditions);
        }
        else {
            this.text = '';
        }
        this.closeDialog();
        if (this.cd) {
            this.cd.detectChanges();
        }
    };
    /**
     * @return {?}
     */
    SorterComponent.prototype.cancel = /**
     * @return {?}
     */
    function () {
        this.conditions = this.originalData;
        this.closeDialog();
    };
    /**
     * @return {?}
     */
    SorterComponent.prototype.closeDialog = /**
     * @return {?}
     */
    function () {
        this.updateModel();
        this.sortEditorRef = null;
        this.dlgRef.close();
    };
    /**
     * @return {?}
     */
    SorterComponent.prototype.clear = /**
     * @return {?}
     */
    function () {
        this.text = '';
        this.conditions = [];
        this.updateModel();
    };
    /**
     * @private
     * @return {?}
     */
    SorterComponent.prototype.updateModel = /**
     * @private
     * @return {?}
     */
    function () {
        /** @type {?} */
        var v = this.conditions;
        if (this.returnType === 'string') {
            v = JSON.stringify(this.conditions);
        }
        this.onModelChange(v);
        this.onModelTouched(v);
    };
    SorterComponent.decorators = [
        { type: Component, args: [{
                    selector: 'sorter',
                    template: "\n    <div class=\"input-group\">\n        <input class=\"form-control\" [value]=\"text\" #txtbox\n            [readonly]=\"!editable || readonly\"\n            [class.f-state-disabled] = \"disabled\"\n            [class.f-state-readonly] = \"readonly\"\n            [class.f-state-editable] = \"!editable\"\n            [disabled]=\"disabled\"/>\n        <div class=\"input-group-append\" *ngIf=\"!readonly && !disabled\">\n            <span *ngIf=\"showClearButton && enableClear\" class=\"input-group-text input-group-clear\" (click)=\"clear()\">\n                <i class=\"f-icon modal_close\"></i>\n            </span>\n            <span class=\"f-select input-group-text\"  (click)=\"showDialog()\">\n                <i class=\"f-icon f-icon-lookup\"></i>\n            </span>\n        </div>\n    </div>\n\n    <ng-template #defaultButtonRef>\n        <button class=\"btn btn-outline-secondary\" (click)=\"cancel()\"> {{ 'sortEditor.cancel'| locale }} </button>&nbsp;\n        <button class=\"btn btn-primary\" (click)=\"save()\"> {{ 'sortEditor.ok'| locale }} </button>\n    </ng-template>\n    ",
                    providers: [
                        SORTER_LOOKUPGRID_VALUE_ACCESSOR
                    ],
                    styles: ["\n        .lookup-clear { cursor: pointer; background: #fff!important;}\n        .lookup-clear:hover { background: #e9ecef!important;}\n        "]
                }] }
    ];
    /** @nocollapse */
    SorterComponent.ctorParameters = function () { return [
        { type: Injector },
        { type: ComponentFactoryResolver },
        { type: BsModalService },
        { type: ElementRef }
    ]; };
    SorterComponent.propDecorators = {
        hostCls: [{ type: HostBinding, args: ['class',] }],
        columns: [{ type: Input }],
        fieldEditor: [{ type: Input }],
        returnType: [{ type: Input }],
        enableClear: [{ type: Input }],
        openDialog: [{ type: Output }],
        btnRef: [{ type: ViewChild, args: ['defaultButtonRef',] }],
        textbox: [{ type: ViewChild, args: ['txtbox',] }],
        onmouseover: [{ type: HostListener, args: ['mouseover',] }],
        onmouseleave: [{ type: HostListener, args: ['mouseleave',] }]
    };
    return SorterComponent;
}(LookupComponent));
export { SorterComponent };
if (false) {
    /** @type {?} */
    SorterComponent.prototype.hostCls;
    /** @type {?} */
    SorterComponent.prototype.text;
    /** @type {?} */
    SorterComponent.prototype.conditions;
    /** @type {?} */
    SorterComponent.prototype.originalData;
    /** @type {?} */
    SorterComponent.prototype.columns;
    /** @type {?} */
    SorterComponent.prototype.fieldEditor;
    /** @type {?} */
    SorterComponent.prototype.returnType;
    /** @type {?} */
    SorterComponent.prototype.enableClear;
    /** @type {?} */
    SorterComponent.prototype.openDialog;
    /** @type {?} */
    SorterComponent.prototype.btnRef;
    /** @type {?} */
    SorterComponent.prototype.textbox;
    /** @type {?} */
    SorterComponent.prototype.dlgRef;
    /** @type {?} */
    SorterComponent.prototype.sortEditorRef;
    /** @type {?} */
    SorterComponent.prototype.cd;
    /** @type {?} */
    SorterComponent.prototype.showClearButton;
    /** @type {?} */
    SorterComponent.prototype.localeService;
    /** @type {?} */
    SorterComponent.prototype.commonUtils;
    /**
     * @type {?}
     * @private
     */
    SorterComponent.prototype.cfr;
    /**
     * @type {?}
     * @private
     */
    SorterComponent.prototype.modalService;
    /** @type {?} */
    SorterComponent.prototype.el;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic29ydC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL3VpLXNvcnQtZWRpdG9yLyIsInNvdXJjZXMiOlsibGliL3NvcnQuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sZUFBZSxDQUFDOzs7Ozs7Ozs7QUFVbEQsT0FBTyxFQUFFLFNBQVMsRUFBVSxLQUFLLEVBQUUsTUFBTSxFQUFFLFlBQVksRUFBRSxTQUFTLEVBQUUsV0FBVyxFQUM3RCxRQUFRLEVBQUUsd0JBQXdCLEVBQUUsVUFBVSxFQUFFLFVBQVUsRUFBRSxZQUFZLEVBQUUsV0FBVyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQy9ILE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxXQUFXLENBQUM7QUFDdEMsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBRXBELE9BQU8sRUFBYyxjQUFjLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQztBQUM5RCxPQUFPLEVBQUUsbUJBQW1CLEVBQUUsTUFBTSx5QkFBeUIsQ0FBQztBQUM5RCxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUNuRCxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFDbEQsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLG1CQUFtQixDQUFDOzs7O0FBQ2hELHVDQUdDOzs7SUFGRyxpQ0FBeUM7O0lBQ3pDLG9DQUFjOzs7QUFFbEIsTUFBTSxLQUFPLGdDQUFnQyxHQUFRO0lBQ2pELE9BQU8sRUFBRSxpQkFBaUI7SUFDMUIsV0FBVyxFQUFFLFVBQVU7OztJQUFDLGNBQU0sT0FBQSxlQUFlLEVBQWYsQ0FBZSxFQUFDO0lBQzlDLEtBQUssRUFBRSxJQUFJO0NBQ2Q7QUFFRDtJQW9DcUMsMkNBQWU7SUF5QmhELHlCQUNJLFFBQWtCLEVBQVUsR0FBNkIsRUFDakQsWUFBNEIsRUFBUyxF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OztnQkFyRGlCLFFBQVE7Z0JBQUUsd0JBQXdCO2dCQUkvQixjQUFjO2dCQUptQixVQUFVOzs7MEJBeUQzRCxXQUFXLFNBQUMsT0FBTzswQkFNbkIsS0FBSzs4QkFDTCxLQUFLOzZCQUNMLEtBQUs7OEJBQ0wsS0FBSzs2QkFFTCxNQUFNO3lCQUVOLFNBQVMsU0FBQyxrQkFBa0I7MEJBQzVCLFNBQVMsU0FBQyxRQUFROzhCQW9CbEIsWUFBWSxTQUFDLFdBQVc7K0JBS3hCLFlBQVksU0FBQyxZQUFZOztJQXVIOUIsc0JBQUM7Q0FBQSxBQXBNRCxDQW9DcUMsZUFBZSxHQWdLbkQ7U0FoS1ksZUFBZTs7O0lBRXhCLGtDQUFtRDs7SUFFbkQsK0JBQVU7O0lBQ1YscUNBQWlDOztJQUNqQyx1Q0FBbUM7O0lBRW5DLGtDQUF3RDs7SUFDeEQsc0NBQXlFOztJQUN6RSxxQ0FBb0Q7O0lBQ3BELHNDQUE0Qjs7SUFFNUIscUNBQTBDOztJQUUxQyxpQ0FBd0Q7O0lBQ3hELGtDQUE4Qzs7SUFFOUMsaUNBQW1COztJQUNuQix3Q0FBaUQ7O0lBQ2pELDZCQUE2Qjs7SUFFN0IsMENBQXdCOztJQUN4Qix3Q0FBNkI7O0lBQzdCLHNDQUFnQzs7Ozs7SUFFUiw4QkFBcUM7Ozs7O0lBQ3pELHVDQUFvQzs7SUFBRSw2QkFBcUIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDaGFuZ2VEZXRlY3RvclJlZiB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG4vKlxyXG4qIEBBdXRob3I6IOeWr+eLguengOaJjShsdWNhcyBodWFuZylcclxuKiBARGF0ZTogMjAxOC0xMS0yMyAwODozMzozN1xyXG4gKiBATGFzdEVkaXRvcnM6IOeWr+eLguengOaJjShMdWNhcyBIdWFuZylcclxuICogQExhc3RFZGl0VGltZTogMjAxOS0xMC0xNyAxNjozODo1M1xyXG4qIEBDb21wYW55OiBJbnNwdXJcclxuKiBAVmVyc2lvbjogdjAuMC4xXHJcbiovXHJcblxyXG5pbXBvcnQgeyBDb21wb25lbnQsIE9uSW5pdCwgSW5wdXQsIE91dHB1dCwgRXZlbnRFbWl0dGVyLCBWaWV3Q2hpbGQsIFRlbXBsYXRlUmVmLFxyXG4gICAgQ29tcG9uZW50UmVmLCBJbmplY3RvciwgQ29tcG9uZW50RmFjdG9yeVJlc29sdmVyLCBFbGVtZW50UmVmLCBmb3J3YXJkUmVmLCBIb3N0TGlzdGVuZXIsIEhvc3RCaW5kaW5nIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IGNsb25lRGVlcCB9IGZyb20gJ2xvZGFzaC1lcyc7XHJcbmltcG9ydCB7IExvb2t1cENvbXBvbmVudCB9IGZyb20gJ0BmYXJyaXMvdWktbG9va3VwJztcclxuaW1wb3J0IHsgU29ydENvbmRpdGlvbiwgU29ydFR5cGUgfSBmcm9tICdAZmFycmlzL3VpLWNvbW1vbi90eXBlcyc7XHJcbmltcG9ydCB7IEJzTW9kYWxSZWYsIEJzTW9kYWxTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy91aS1tb2RhbCc7XHJcbmltcG9ydCB7IFNvcnRFZGl0b3JDb21wb25lbnQgfSBmcm9tICcuL3NvcnQtZWRpdG9yLmNvbXBvbmVudCc7XHJcbmltcG9ydCB7IE5HX1ZBTFVFX0FDQ0VTU09SIH0gZnJvbSAnQGFuZ3VsYXIvZm9ybXMnO1xyXG5pbXBvcnQgeyBMb2NhbGVTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy91aS1sb2NhbGUnO1xyXG5pbXBvcnQgeyBDb21tb25VdGlscyB9IGZyb20gJ0BmYXJyaXMvdWktY29tbW9uJztcclxuZXhwb3J0IGludGVyZmFjZSBTT1JUX0ZJRUxEX0VESVRPUiB7XHJcbiAgICB0eXBlOiAnc2VsZWN0JyB8ICdjb21iby10cmVlJyB8ICdsb29rdXAnO1xyXG4gICAgb3B0aW9ucz86IGFueTtcclxufVxyXG5leHBvcnQgY29uc3QgU09SVEVSX0xPT0tVUEdSSURfVkFMVUVfQUNDRVNTT1I6IGFueSA9IHtcclxuICAgIHByb3ZpZGU6IE5HX1ZBTFVFX0FDQ0VTU09SLFxyXG4gICAgdXNlRXhpc3Rpbmc6IGZvcndhcmRSZWYoKCkgPT4gU29ydGVyQ29tcG9uZW50KSxcclxuICAgIG11bHRpOiB0cnVlXHJcbn07XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICAgIHNlbGVjdG9yOiAnc29ydGVyJyxcclxuICAgIHRlbXBsYXRlOiBgXHJcbiAgICA8ZGl2IGNsYXNzPVwiaW5wdXQtZ3JvdXBcIj5cclxuICAgICAgICA8aW5wdXQgY2xhc3M9XCJmb3JtLWNvbnRyb2xcIiBbdmFsdWVdPVwidGV4dFwiICN0eHRib3hcclxuICAgICAgICAgICAgW3JlYWRvbmx5XT1cIiFlZGl0YWJsZSB8fCByZWFkb25seVwiXHJcbiAgICAgICAgICAgIFtjbGFzcy5mLXN0YXRlLWRpc2FibGVkXSA9IFwiZGlzYWJsZWRcIlxyXG4gICAgICAgICAgICBbY2xhc3MuZi1zdGF0ZS1yZWFkb25seV0gPSBcInJlYWRvbmx5XCJcclxuICAgICAgICAgICAgW2NsYXNzLmYtc3RhdGUtZWRpdGFibGVdID0gXCIhZWRpdGFibGVcIlxyXG4gICAgICAgICAgICBbZGlzYWJsZWRdPVwiZGlzYWJsZWRcIi8+XHJcbiAgICAgICAgPGRpdiBjbGFzcz1cImlucHV0LWdyb3VwLWFwcGVuZFwiICpuZ0lmPVwiIXJlYWRvbmx5ICYmICFkaXNhYmxlZFwiPlxyXG4gICAgICAgICAgICA8c3BhbiAqbmdJZj1cInNob3dDbGVhckJ1dHRvbiAmJiBlbmFibGVDbGVhclwiIGNsYXNzPVwiaW5wdXQtZ3JvdXAtdGV4dCBpbnB1dC1ncm91cC1jbGVhclwiIChjbGljayk9XCJjbGVhcigpXCI+XHJcbiAgICAgICAgICAgICAgICA8aSBjbGFzcz1cImYtaWNvbiBtb2RhbF9jbG9zZVwiPjwvaT5cclxuICAgICAgICAgICAgPC9zcGFuPlxyXG4gICAgICAgICAgICA8c3BhbiBjbGFzcz1cImYtc2VsZWN0IGlucHV0LWdyb3VwLXRleHRcIiAgKGNsaWNrKT1cInNob3dEaWFsb2coKVwiPlxyXG4gICAgICAgICAgICAgICAgPGkgY2xhc3M9XCJmLWljb24gZi1pY29uLWxvb2t1cFwiPjwvaT5cclxuICAgICAgICAgICAgPC9zcGFuPlxyXG4gICAgICAgIDwvZGl2PlxyXG4gICAgPC9kaXY+XHJcblxyXG4gICAgPG5nLXRlbXBsYXRlICNkZWZhdWx0QnV0dG9uUmVmPlxyXG4gICAgICAgIDxidXR0b24gY2xhc3M9XCJidG4gYnRuLW91dGxpbmUtc2Vjb25kYXJ5XCIgKGNsaWNrKT1cImNhbmNlbCgpXCI+IHt7ICdzb3J0RWRpdG9yLmNhbmNlbCd8IGxvY2FsZSB9fSA8L2J1dHRvbj4mbmJzcDtcclxuICAgICAgICA8YnV0dG9uIGNsYXNzPVwiYnRuIGJ0bi1wcmltYXJ5XCIgKGNsaWNrKT1cInNhdmUoKVwiPiB7eyAnc29ydEVkaXRvci5vayd8IGxvY2FsZSB9fSA8L2J1dHRvbj5cclxuICAgIDwvbmctdGVtcGxhdGU+XHJcbiAgICBgLFxyXG4gICAgcHJvdmlkZXJzOiBbXHJcbiAgICAgICAgU09SVEVSX0xPT0tVUEdSSURfVkFMVUVfQUNDRVNTT1JcclxuICAgIF0sXHJcbiAgICBzdHlsZXM6IFtcclxuICAgICAgICBgXHJcbiAgICAgICAgLmxvb2t1cC1jbGVhciB7IGN1cnNvcjogcG9pbnRlcjsgYmFja2dyb3VuZDogI2ZmZiFpbXBvcnRhbnQ7fVxyXG4gICAgICAgIC5sb29rdXAtY2xlYXI6aG92ZXIgeyBiYWNrZ3JvdW5kOiAjZTllY2VmIWltcG9ydGFudDt9XHJcbiAgICAgICAgYFxyXG4gICAgXVxyXG59KVxyXG5cclxuZXhwb3J0IGNsYXNzIFNvcnRlckNvbXBvbmVudCBleHRlbmRzIExvb2t1cENvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCB7XHJcblxyXG4gICAgQEhvc3RCaW5kaW5nKCdjbGFzcycpIGhvc3RDbHMgPSAnZi1jbXAtaW5wdXRncm91cCc7XHJcblxyXG4gICAgdGV4dCA9ICcnO1xyXG4gICAgY29uZGl0aW9uczogU29ydENvbmRpdGlvbltdID0gW107XHJcbiAgICBvcmlnaW5hbERhdGE6IFNvcnRDb25kaXRpb25bXSA9IFtdO1xyXG5cclxuICAgIEBJbnB1dCgpIGNvbHVtbnM6IHtsYWJlbDogc3RyaW5nLCB2YWx1ZTogc3RyaW5nfVtdID0gW107XHJcbiAgICBASW5wdXQoKSBmaWVsZEVkaXRvcjogU09SVF9GSUVMRF9FRElUT1IgPSB7IHR5cGU6ICdzZWxlY3QnLCBvcHRpb25zOiB7fX07XHJcbiAgICBASW5wdXQoKSByZXR1cm5UeXBlOiAnb2JqZWN0JyB8ICdzdHJpbmcnID0gJ29iamVjdCc7XHJcbiAgICBASW5wdXQoKSBlbmFibGVDbGVhciA9IHRydWU7XHJcblxyXG4gICAgQE91dHB1dCgpIG9wZW5EaWFsb2cgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcbiAgICBcclxuICAgIEBWaWV3Q2hpbGQoJ2RlZmF1bHRCdXR0b25SZWYnKSBidG5SZWY6IFRlbXBsYXRlUmVmPGFueT47XHJcbiAgICBAVmlld0NoaWxkKCd0eHRib3gnKSB0ZXh0Ym94OiBFbGVtZW50UmVmPGFueT47XHJcbiAgICBcclxuICAgIGRsZ1JlZjogQnNNb2RhbFJlZjtcclxuICAgIHNvcnRFZGl0b3JSZWY6IENvbXBvbmVudFJlZjxTb3J0RWRpdG9yQ29tcG9uZW50PjtcclxuICAgIGNkOiBDaGFuZ2VEZXRlY3RvclJlZiA9IG51bGw7XHJcblxyXG4gICAgc2hvd0NsZWFyQnV0dG9uID0gZmFsc2U7XHJcbiAgICBsb2NhbGVTZXJ2aWNlOiBMb2NhbGVTZXJ2aWNlO1xyXG4gICAgY29tbW9uVXRpbHM6IENvbW1vblV0aWxzID0gbnVsbDtcclxuICAgIGNvbnN0cnVjdG9yKFxyXG4gICAgICAgIGluamVjdG9yOiBJbmplY3RvciwgcHJpdmF0ZSBjZnI6IENvbXBvbmVudEZhY3RvcnlSZXNvbHZlcixcclxuICAgICAgICBwcml2YXRlIG1vZGFsU2VydmljZTogQnNNb2RhbFNlcnZpY2UsIHB1YmxpYyBlbDogRWxlbWVudFJlZikge1xyXG4gICAgICAgIHN1cGVyKGluamVjdG9yLCBlbCk7XHJcbiAgICAgICAgdGhpcy5sb2NhbGVTZXJ2aWNlID0gdGhpcy5pbmplY3Rvci5nZXQoTG9jYWxlU2VydmljZSk7XHJcbiAgICAgICAgdGhpcy5jZCA9IHRoaXMuaW5qZWN0b3IuZ2V0KENoYW5nZURldGVjdG9yUmVmLCBudWxsKTtcclxuICAgICAgICB0aGlzLmNvbW1vblV0aWxzID0gdGhpcy5pbmplY3Rvci5nZXQoQ29tbW9uVXRpbHMsIG51bGwpIHx8IG5ldyBDb21tb25VdGlscygpO1xyXG4gICAgfVxyXG5cclxuICAgIG5nT25Jbml0KCkgeyAgICB9XHJcblxyXG4gICAgQEhvc3RMaXN0ZW5lcignbW91c2VvdmVyJylcclxuICAgIG9ubW91c2VvdmVyKCkge1xyXG4gICAgICAgIHRoaXMuc2hvd0NsZWFyQnV0dG9uID0gdHJ1ZTtcclxuICAgIH1cclxuXHJcbiAgICBASG9zdExpc3RlbmVyKCdtb3VzZWxlYXZlJylcclxuICAgIG9ubW91c2VsZWF2ZSgpIHtcclxuICAgICAgICB0aGlzLnNob3dDbGVhckJ1dHRvbiA9IGZhbHNlO1xyXG4gICAgfVxyXG5cclxuICAgIHNob3dEaWFsb2coKSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLmRpc2FibGVkKSB7XHJcblxyXG4gICAgICAgICAgICBpZiAodGhpcy5maWVsZEVkaXRvciAmJiB0aGlzLmZpZWxkRWRpdG9yLnR5cGUgPT09ICdjb21iby10cmVlJykge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5maWVsZEVkaXRvci5vcHRpb25zID0gdGhpcy5maWVsZEVkaXRvci5vcHRpb25zIHx8IHt9O1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuZmllbGRFZGl0b3Iub3B0aW9ucy5hdXRvV2lkdGggPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZmllbGRFZGl0b3Iub3B0aW9ucy5hdXRvV2lkdGggPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGlmICghdGhpcy5maWVsZEVkaXRvci5vcHRpb25zLmNvbHVtbnMpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmZpZWxkRWRpdG9yLm9wdGlvbnMuY29sdW1ucyA9IFsgeyBmaWVsZDogJ2xhYmVsJywgdGl0bGU6ICdsYWJlbCcsIHdpZHRoOiAxMDAgfSBdO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGlmICghdGhpcy5maWVsZEVkaXRvci5vcHRpb25zLnRleHRGaWVsZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZmllbGRFZGl0b3Iub3B0aW9ucy50ZXh0RmllbGQgPSAnbGFiZWwnO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGlmICghdGhpcy5maWVsZEVkaXRvci5vcHRpb25zLmlkRmllbGQpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmZpZWxkRWRpdG9yLm9wdGlvbnMuaWRGaWVsZCA9ICd2YWx1ZSc7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgICAgICBjb25zdCBzb3J0RWRpdG9yRmFjdG9yeSA9IHRoaXMuY2ZyLnJlc29sdmVDb21wb25lbnRGYWN0b3J5KFNvcnRFZGl0b3JDb21wb25lbnQpO1xyXG4gICAgICAgICAgICB0aGlzLnNvcnRFZGl0b3JSZWYgPSBzb3J0RWRpdG9yRmFjdG9yeS5jcmVhdGUodGhpcy5pbmplY3Rvcik7XHJcbiAgICAgICAgICAgIHRoaXMuc29ydEVkaXRvclJlZi5pbnN0YW5jZS5jb2x1bW5zID0gdGhpcy5jb2x1bW5zO1xyXG4gICAgICAgICAgICB0aGlzLnNvcnRFZGl0b3JSZWYuaW5zdGFuY2UuY29uZGl0aW9ucyA9IHRoaXMuY29uZGl0aW9ucztcclxuICAgICAgICAgICAgdGhpcy5vcmlnaW5hbERhdGEgPSBjbG9uZURlZXAodGhpcy5jb25kaXRpb25zKTtcclxuICAgICAgICAgICAgdGhpcy5kbGdSZWYgPSB0aGlzLm1vZGFsU2VydmljZS5zaG93KHRoaXMuc29ydEVkaXRvclJlZiwge1xyXG4gICAgICAgICAgICAgICAgd2lkdGg6IDUwMCwgaGVpZ2h0OiA0MDAsXHJcbiAgICAgICAgICAgICAgICB0aXRsZTogdGhpcy5sb2NhbGVTZXJ2aWNlLmdldFZhbHVlKCdzb3J0RWRpdG9yLnRpdGxlJyksXHJcbiAgICAgICAgICAgICAgICBlbmFibGVTY3JvbGw6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgbWluSGVpZ2h0OiAyOTgsIG1pbldpZHRoOiA0OTgsIGljb25DbHM6ICdmLWljb24gZi1pY29uLWNvbC1kZWZhdWx0c29ydCcsXHJcbiAgICAgICAgICAgICAgICBidXR0b25zOiB0aGlzLmJ0blJlZixcclxuICAgICAgICAgICAgICAgIHNob3dNYXhCdXR0b246IGZhbHNlLCBidXR0b25BbGlnbjogJ3JpZ2h0JyxcclxuICAgICAgICAgICAgICAgIC8vIGRpYWxvZ0Zvb3RlclN0eWxlczogeyBiYWNrZ3JvdW5kOiAnI0Y0RjZGOScgfSxcclxuICAgICAgICAgICAgICAgIGluaXRpYWxTdGF0ZToge1xyXG4gICAgICAgICAgICAgICAgICAgIGZpZWxkRWRpdG9yOiB0aGlzLmZpZWxkRWRpdG9yXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5zb3J0RWRpdG9yUmVmLmluc3RhbmNlLmhlaWdodCA9IHRoaXMuZGxnUmVmLmRpYWxvZy5pbnN0YW5jZS5nZXRDb250YWluZXJTaXplKCkuaGVpZ2h0O1xyXG5cclxuICAgICAgICAgICAgdGhpcy5kbGdSZWYuZGlhbG9nLmluc3RhbmNlLnJlc2l6ZWQuc3Vic2NyaWJlKCBzaXplID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMuc29ydEVkaXRvclJlZi5pbnN0YW5jZS5oZWlnaHQgPSBzaXplLmNvbnRhaW5lckhlaWdodDtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICB0aGlzLnNvcnRFZGl0b3JSZWYuaW5zdGFuY2Uuc29ydHNDaGFuZ2VkLnN1YnNjcmliZSggKGU6IHthY3Rpb246IHN0cmluZywgZGF0YTogYW55W119KSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNvbmRpdGlvbnMgPSBlLmRhdGE7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5zb3J0RWRpdG9yUmVmLmNoYW5nZURldGVjdG9yUmVmLmRldGVjdENoYW5nZXMoKTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuZGxnUmVmLmRpYWxvZy5jaGFuZ2VEZXRlY3RvclJlZi5yZWF0dGFjaCgpO1xyXG4gICAgICAgICAgICB0aGlzLm9wZW5EaWFsb2cuZW1pdCgpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICB3cml0ZVZhbHVlKHZhbDogYW55KSB7XHJcbiAgICAgICAgaWYgKHZhbCkge1xyXG4gICAgICAgICAgICBpZiAodHlwZW9mIHZhbCA9PT0gJ3N0cmluZycpIHtcclxuICAgICAgICAgICAgICAgIHZhbCA9IEpTT04ucGFyc2UodmFsKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdGhpcy5jb25kaXRpb25zID0gdmFsIHx8IFtdO1xyXG4gICAgICAgICAgICB0aGlzLnRleHQgPSB0aGlzLmNvbW1vblV0aWxzLmJ1aWxkU29ydFN0cmluZyh2YWwpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBzYXZlKCkge1xyXG4gICAgICAgIGlmICh0aGlzLmNvbmRpdGlvbnMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIHRoaXMuY29uZGl0aW9ucyA9IHRoaXMuY29uZGl0aW9ucy5maWx0ZXIoYyA9PiBjLnNvcnRGaWVsZCk7XHJcbiAgICAgICAgICAgIHRoaXMudGV4dCA9IHRoaXMuY29tbW9uVXRpbHMuYnVpbGRTb3J0U3RyaW5nKHRoaXMuY29uZGl0aW9ucyk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy50ZXh0ID0gJyc7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLmNsb3NlRGlhbG9nKCk7XHJcblxyXG4gICAgICAgIGlmICh0aGlzLmNkKSB7XHJcbiAgICAgICAgICAgIHRoaXMuY2QuZGV0ZWN0Q2hhbmdlcygpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBjYW5jZWwoKSB7XHJcbiAgICAgICAgdGhpcy5jb25kaXRpb25zID0gdGhpcy5vcmlnaW5hbERhdGE7XHJcbiAgICAgICAgdGhpcy5jbG9zZURpYWxvZygpO1xyXG4gICAgfVxyXG5cclxuICAgIGNsb3NlRGlhbG9nKCkge1xyXG4gICAgICAgIHRoaXMudXBkYXRlTW9kZWwoKTtcclxuICAgICAgICB0aGlzLnNvcnRFZGl0b3JSZWYgPSBudWxsO1xyXG4gICAgICAgIHRoaXMuZGxnUmVmLmNsb3NlKCk7XHJcbiAgICB9XHJcblxyXG4gICAgY2xlYXIoKSB7XHJcbiAgICAgICAgdGhpcy50ZXh0ID0gJyc7XHJcbiAgICAgICAgdGhpcy5jb25kaXRpb25zID0gW107XHJcbiAgICAgICAgdGhpcy51cGRhdGVNb2RlbCgpO1xyXG4gICAgfVxyXG5cclxuXHJcblxyXG4gICAgcHJpdmF0ZSB1cGRhdGVNb2RlbCgpIHtcclxuICAgICAgICBsZXQgdjogYW55ID0gdGhpcy5jb25kaXRpb25zO1xyXG4gICAgICAgIGlmICh0aGlzLnJldHVyblR5cGUgPT09ICdzdHJpbmcnKSB7XHJcbiAgICAgICAgICAgIHYgPSBKU09OLnN0cmluZ2lmeSh0aGlzLmNvbmRpdGlvbnMpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5vbk1vZGVsQ2hhbmdlKHYpO1xyXG4gICAgICAgIHRoaXMub25Nb2RlbFRvdWNoZWQodik7XHJcblxyXG4gICAgfVxyXG5cclxufVxyXG4iXX0=
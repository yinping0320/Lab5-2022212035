/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { ChangeDetectorRef } from '@angular/core';
/*
* @Author: 疯狂秀才(lucas huang)
* @Date: 2018-11-23 08:33:37
 * @LastEditors: 疯狂秀才(Lucas Huang)
 * @LastEditTime: 2019-10-17 16:38:53
* @Company: Inspur
* @Version: v0.0.1
*/
import { Component, Input, Output, EventEmitter, ViewChild, TemplateRef, Injector, ComponentFactoryResolver, ElementRef, forwardRef, HostListener, HostBinding } from '@angular/core';
import { cloneDeep } from 'lodash-es';
import { LookupComponent } from '@farris/ui-lookup';
import { BsModalService } from '@farris/ui-modal';
import { SortEditorComponent } from './sort-editor.component';
import { NG_VALUE_ACCESSOR } from '@angular/forms';
import { LocaleService } from '@farris/ui-locale';
import { CommonUtils } from '@farris/ui-common';
/**
 * @record
 */
export function SORT_FIELD_EDITOR() { }
if (false) {
    /** @type {?} */
    SORT_FIELD_EDITOR.prototype.type;
    /** @type {?|undefined} */
    SORT_FIELD_EDITOR.prototype.options;
}
/** @type {?} */
export const SORTER_LOOKUPGRID_VALUE_ACCESSOR = {
    provide: NG_VALUE_ACCESSOR,
    useExisting: forwardRef((/**
     * @return {?}
     */
    () => SorterComponent)),
    multi: true
};
export class SorterComponent extends LookupComponent {
    /**
     * @param {?} injector
     * @param {?} cfr
     * @param {?} modalService
     * @param {?} el
     */
    constructor(injector, cfr, modalService, el) {
        super(injector, el);
        this.cfr = cfr;
        this.modalService = modalService;
        this.el = el;
        this.hostCls = 'f-cmp-inputgroup';
        this.text = '';
        this.conditions = [];
        this.originalData = [];
        this.columns = [];
        this.fieldEditor = { type: 'select', options: {} };
        this.returnType = 'object';
        this.enableClear = true;
        this.openDialog = new EventEmitter();
        this.cd = null;
        this.showClearButton = false;
        this.commonUtils = null;
        this.localeService = this.injector.get(LocaleService);
        this.cd = this.injector.get(ChangeDetectorRef, null);
        this.commonUtils = this.injector.get(CommonUtils, null) || new CommonUtils();
    }
    /**
     * @return {?}
     */
    ngOnInit() { }
    /**
     * @return {?}
     */
    onmouseover() {
        this.showClearButton = true;
    }
    /**
     * @return {?}
     */
    onmouseleave() {
        this.showClearButton = false;
    }
    /**
     * @return {?}
     */
    showDialog() {
        if (!this.disabled) {
            if (this.fieldEditor && this.fieldEditor.type === 'combo-tree') {
                this.fieldEditor.options = this.fieldEditor.options || {};
                if (this.fieldEditor.options.autoWidth === undefined) {
                    this.fieldEditor.options.autoWidth = true;
                }
                if (!this.fieldEditor.options.columns) {
                    this.fieldEditor.options.columns = [{ field: 'label', title: 'label', width: 100 }];
                }
                if (!this.fieldEditor.options.textField) {
                    this.fieldEditor.options.textField = 'label';
                }
                if (!this.fieldEditor.options.idField) {
                    this.fieldEditor.options.idField = 'value';
                }
            }
            /** @type {?} */
            const sortEditorFactory = this.cfr.resolveComponentFactory(SortEditorComponent);
            this.sortEditorRef = sortEditorFactory.create(this.injector);
            this.sortEditorRef.instance.columns = this.columns;
            this.sortEditorRef.instance.conditions = this.conditions;
            this.originalData = cloneDeep(this.conditions);
            this.dlgRef = this.modalService.show(this.sortEditorRef, {
                width: 500, height: 400,
                title: this.localeService.getValue('sortEditor.title'),
                enableScroll: false,
                minHeight: 298, minWidth: 498, iconCls: 'f-icon f-icon-col-defaultsort',
                buttons: this.btnRef,
                showMaxButton: false, buttonAlign: 'right',
                // dialogFooterStyles: { background: '#F4F6F9' },
                initialState: {
                    fieldEditor: this.fieldEditor
                }
            });
            this.sortEditorRef.instance.height = this.dlgRef.dialog.instance.getContainerSize().height;
            this.dlgRef.dialog.instance.resized.subscribe((/**
             * @param {?} size
             * @return {?}
             */
            size => {
                this.sortEditorRef.instance.height = size.containerHeight;
            }));
            this.sortEditorRef.instance.sortsChanged.subscribe((/**
             * @param {?} e
             * @return {?}
             */
            (e) => {
                this.conditions = e.data;
            }));
            this.sortEditorRef.changeDetectorRef.detectChanges();
            this.dlgRef.dialog.changeDetectorRef.reattach();
            this.openDialog.emit();
        }
    }
    /**
     * @param {?} val
     * @return {?}
     */
    writeValue(val) {
        if (val) {
            if (typeof val === 'string') {
                val = JSON.parse(val);
            }
            this.conditions = val || [];
            this.text = this.commonUtils.buildSortString(val);
        }
    }
    /**
     * @return {?}
     */
    save() {
        if (this.conditions.length) {
            this.conditions = this.conditions.filter((/**
             * @param {?} c
             * @return {?}
             */
            c => c.sortField));
            this.text = this.commonUtils.buildSortString(this.conditions);
        }
        else {
            this.text = '';
        }
        this.closeDialog();
        if (this.cd) {
            this.cd.detectChanges();
        }
    }
    /**
     * @return {?}
     */
    cancel() {
        this.conditions = this.originalData;
        this.closeDialog();
    }
    /**
     * @return {?}
     */
    closeDialog() {
        this.updateModel();
        this.sortEditorRef = null;
        this.dlgRef.close();
    }
    /**
     * @return {?}
     */
    clear() {
        this.text = '';
        this.conditions = [];
        this.updateModel();
    }
    /**
     * @private
     * @return {?}
     */
    updateModel() {
        /** @type {?} */
        let v = this.conditions;
        if (this.returnType === 'string') {
            v = JSON.stringify(this.conditions);
        }
        this.onModelChange(v);
        this.onModelTouched(v);
    }
}
SorterComponent.decorators = [
    { type: Component, args: [{
                selector: 'sorter',
                template: `
    <div class="input-group">
        <input class="form-control" [value]="text" #txtbox
            [readonly]="!editable || readonly"
            [class.f-state-disabled] = "disabled"
            [class.f-state-readonly] = "readonly"
            [class.f-state-editable] = "!editable"
            [disabled]="disabled"/>
        <div class="input-group-append" *ngIf="!readonly && !disabled">
            <span *ngIf="showClearButton && enableClear" class="input-group-text input-group-clear" (click)="clear()">
                <i class="f-icon modal_close"></i>
            </span>
            <span class="f-select input-group-text"  (click)="showDialog()">
                <i class="f-icon f-icon-lookup"></i>
            </span>
        </div>
    </div>

    <ng-template #defaultButtonRef>
        <button class="btn btn-outline-secondary" (click)="cancel()"> {{ 'sortEditor.cancel'| locale }} </button>&nbsp;
        <button class="btn btn-primary" (click)="save()"> {{ 'sortEditor.ok'| locale }} </button>
    </ng-template>
    `,
                providers: [
                    SORTER_LOOKUPGRID_VALUE_ACCESSOR
                ],
                styles: [`
        .lookup-clear { cursor: pointer; background: #fff!important;}
        .lookup-clear:hover { background: #e9ecef!important;}
        `]
            }] }
];
/** @nocollapse */
SorterComponent.ctorParameters = () => [
    { type: Injector },
    { type: ComponentFactoryResolver },
    { type: BsModalService },
    { type: ElementRef }
];
SorterComponent.propDecorators = {
    hostCls: [{ type: HostBinding, args: ['class',] }],
    columns: [{ type: Input }],
    fieldEditor: [{ type: Input }],
    returnType: [{ type: Input }],
    enableClear: [{ type: Input }],
    openDialog: [{ type: Output }],
    btnRef: [{ type: ViewChild, args: ['defaultButtonRef',] }],
    textbox: [{ type: ViewChild, args: ['txtbox',] }],
    onmouseover: [{ type: HostListener, args: ['mouseover',] }],
    onmouseleave: [{ type: HostListener, args: ['mouseleave',] }]
};
if (false) {
    /** @type {?} */
    SorterComponent.prototype.hostCls;
    /** @type {?} */
    SorterComponent.prototype.text;
    /** @type {?} */
    SorterComponent.prototype.conditions;
    /** @type {?} */
    SorterComponent.prototype.originalData;
    /** @type {?} */
    SorterComponent.prototype.columns;
    /** @type {?} */
    SorterComponent.prototype.fieldEditor;
    /** @type {?} */
    SorterComponent.prototype.returnType;
    /** @type {?} */
    SorterComponent.prototype.enableClear;
    /** @type {?} */
    SorterComponent.prototype.openDialog;
    /** @type {?} */
    SorterComponent.prototype.btnRef;
    /** @type {?} */
    SorterComponent.prototype.textbox;
    /** @type {?} */
    SorterComponent.prototype.dlgRef;
    /** @type {?} */
    SorterComponent.prototype.sortEditorRef;
    /** @type {?} */
    SorterComponent.prototype.cd;
    /** @type {?} */
    SorterComponent.prototype.showClearButton;
    /** @type {?} */
    SorterComponent.prototype.localeService;
    /** @type {?} */
    SorterComponent.prototype.commonUtils;
    /**
     * @type {?}
     * @private
     */
    SorterComponent.prototype.cfr;
    /**
     * @type {?}
     * @private
     */
    SorterComponent.prototype.modalService;
    /** @type {?} */
    SorterComponent.prototype.el;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic29ydC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL3VpLXNvcnQtZWRpdG9yLyIsInNvdXJjZXMiOlsibGliL3NvcnQuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxlQUFlLENBQUM7Ozs7Ozs7OztBQVVsRCxPQUFPLEVBQUUsU0FBUyxFQUFVLEtBQUssRUFBRSxNQUFNLEVBQUUsWUFBWSxFQUFFLFNBQVMsRUFBRSxXQUFXLEVBQzdELFFBQVEsRUFBRSx3QkFBd0IsRUFBRSxVQUFVLEVBQUUsVUFBVSxFQUFFLFlBQVksRUFBRSxXQUFXLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDL0gsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLFdBQVcsQ0FBQztBQUN0QyxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFFcEQsT0FBTyxFQUFjLGNBQWMsRUFBRSxNQUFNLGtCQUFrQixDQUFDO0FBQzlELE9BQU8sRUFBRSxtQkFBbUIsRUFBRSxNQUFNLHlCQUF5QixDQUFDO0FBQzlELE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ25ELE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUNsRCxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sbUJBQW1CLENBQUM7Ozs7QUFDaEQsdUNBR0M7OztJQUZHLGlDQUF5Qzs7SUFDekMsb0NBQWM7OztBQUVsQixNQUFNLE9BQU8sZ0NBQWdDLEdBQVE7SUFDakQsT0FBTyxFQUFFLGlCQUFpQjtJQUMxQixXQUFXLEVBQUUsVUFBVTs7O0lBQUMsR0FBRyxFQUFFLENBQUMsZUFBZSxFQUFDO0lBQzlDLEtBQUssRUFBRSxJQUFJO0NBQ2Q7QUFzQ0QsTUFBTSxPQUFPLGVBQWdCLFNBQVEsZUFBZTs7Ozs7OztJQXlCaEQsWUFDSSxRQUFrQixFQUFVLEdBQTZCLEVBQ2pE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LE9BQU87c0JBTW5CLEtBQUs7MEJBQ0wsS0FBSzt5QkFDTCxLQUFLOzBCQUNMLEtBQUs7eUJBRUwsTUFBTTtxQkFFTixTQUFTLFNBQUMsa0JBQWtCO3NCQUM1QixTQUFTLFNBQUMsUUFBUTswQkFvQmxCLFlBQVksU0FBQyxXQUFXOzJCQUt4QixZQUFZLFNBQUMsWUFBWTs7OztJQXZDMUIsa0NBQW1EOztJQUVuRCwrQkFBVTs7SUFDVixxQ0FBaUM7O0lBQ2pDLHVDQUFtQzs7SUFFbkMsa0NBQXdEOztJQUN4RCxzQ0FBeUU7O0lBQ3pFLHFDQUFvRDs7SUFDcEQsc0NBQTRCOztJQUU1QixxQ0FBMEM7O0lBRTFDLGlDQUF3RDs7SUFDeEQsa0NBQThDOztJQUU5QyxpQ0FBbUI7O0lBQ25CLHdDQUFpRDs7SUFDakQsNkJBQTZCOztJQUU3QiwwQ0FBd0I7O0lBQ3hCLHdDQUE2Qjs7SUFDN0Isc0NBQWdDOzs7OztJQUVSLDhCQUFxQzs7Ozs7SUFDekQsdUNBQW9DOztJQUFFLDZCQUFxQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENoYW5nZURldGVjdG9yUmVmIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbi8qXHJcbiogQEF1dGhvcjog55av54uC56eA5omNKGx1Y2FzIGh1YW5nKVxyXG4qIEBEYXRlOiAyMDE4LTExLTIzIDA4OjMzOjM3XHJcbiAqIEBMYXN0RWRpdG9yczog55av54uC56eA5omNKEx1Y2FzIEh1YW5nKVxyXG4gKiBATGFzdEVkaXRUaW1lOiAyMDE5LTEwLTE3IDE2OjM4OjUzXHJcbiogQENvbXBhbnk6IEluc3B1clxyXG4qIEBWZXJzaW9uOiB2MC4wLjFcclxuKi9cclxuXHJcbmltcG9ydCB7IENvbXBvbmVudCwgT25Jbml0LCBJbnB1dCwgT3V0cHV0LCBFdmVudEVtaXR0ZXIsIFZpZXdDaGlsZCwgVGVtcGxhdGVSZWYsXHJcbiAgICBDb21wb25lbnRSZWYsIEluamVjdG9yLCBDb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIsIEVsZW1lbnRSZWYsIGZvcndhcmRSZWYsIEhvc3RMaXN0ZW5lciwgSG9zdEJpbmRpbmcgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgY2xvbmVEZWVwIH0gZnJvbSAnbG9kYXNoLWVzJztcclxuaW1wb3J0IHsgTG9va3VwQ29tcG9uZW50IH0gZnJvbSAnQGZhcnJpcy91aS1sb29rdXAnO1xyXG5pbXBvcnQgeyBTb3J0Q29uZGl0aW9uLCBTb3J0VHlwZSB9IGZyb20gJ0BmYXJyaXMvdWktY29tbW9uL3R5cGVzJztcclxuaW1wb3J0IHsgQnNNb2RhbFJlZiwgQnNNb2RhbFNlcnZpY2UgfSBmcm9tICdAZmFycmlzL3VpLW1vZGFsJztcclxuaW1wb3J0IHsgU29ydEVkaXRvckNvbXBvbmVudCB9IGZyb20gJy4vc29ydC1lZGl0b3IuY29tcG9uZW50JztcclxuaW1wb3J0IHsgTkdfVkFMVUVfQUNDRVNTT1IgfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XHJcbmltcG9ydCB7IExvY2FsZVNlcnZpY2UgfSBmcm9tICdAZmFycmlzL3VpLWxvY2FsZSc7XHJcbmltcG9ydCB7IENvbW1vblV0aWxzIH0gZnJvbSAnQGZhcnJpcy91aS1jb21tb24nO1xyXG5leHBvcnQgaW50ZXJmYWNlIFNPUlRfRklFTERfRURJVE9SIHtcclxuICAgIHR5cGU6ICdzZWxlY3QnIHwgJ2NvbWJvLXRyZWUnIHwgJ2xvb2t1cCc7XHJcbiAgICBvcHRpb25zPzogYW55O1xyXG59XHJcbmV4cG9ydCBjb25zdCBTT1JURVJfTE9PS1VQR1JJRF9WQUxVRV9BQ0NFU1NPUjogYW55ID0ge1xyXG4gICAgcHJvdmlkZTogTkdfVkFMVUVfQUNDRVNTT1IsXHJcbiAgICB1c2VFeGlzdGluZzogZm9yd2FyZFJlZigoKSA9PiBTb3J0ZXJDb21wb25lbnQpLFxyXG4gICAgbXVsdGk6IHRydWVcclxufTtcclxuXHJcbkBDb21wb25lbnQoe1xyXG4gICAgc2VsZWN0b3I6ICdzb3J0ZXInLFxyXG4gICAgdGVtcGxhdGU6IGBcclxuICAgIDxkaXYgY2xhc3M9XCJpbnB1dC1ncm91cFwiPlxyXG4gICAgICAgIDxpbnB1dCBjbGFzcz1cImZvcm0tY29udHJvbFwiIFt2YWx1ZV09XCJ0ZXh0XCIgI3R4dGJveFxyXG4gICAgICAgICAgICBbcmVhZG9ubHldPVwiIWVkaXRhYmxlIHx8IHJlYWRvbmx5XCJcclxuICAgICAgICAgICAgW2NsYXNzLmYtc3RhdGUtZGlzYWJsZWRdID0gXCJkaXNhYmxlZFwiXHJcbiAgICAgICAgICAgIFtjbGFzcy5mLXN0YXRlLXJlYWRvbmx5XSA9IFwicmVhZG9ubHlcIlxyXG4gICAgICAgICAgICBbY2xhc3MuZi1zdGF0ZS1lZGl0YWJsZV0gPSBcIiFlZGl0YWJsZVwiXHJcbiAgICAgICAgICAgIFtkaXNhYmxlZF09XCJkaXNhYmxlZFwiLz5cclxuICAgICAgICA8ZGl2IGNsYXNzPVwiaW5wdXQtZ3JvdXAtYXBwZW5kXCIgKm5nSWY9XCIhcmVhZG9ubHkgJiYgIWRpc2FibGVkXCI+XHJcbiAgICAgICAgICAgIDxzcGFuICpuZ0lmPVwic2hvd0NsZWFyQnV0dG9uICYmIGVuYWJsZUNsZWFyXCIgY2xhc3M9XCJpbnB1dC1ncm91cC10ZXh0IGlucHV0LWdyb3VwLWNsZWFyXCIgKGNsaWNrKT1cImNsZWFyKClcIj5cclxuICAgICAgICAgICAgICAgIDxpIGNsYXNzPVwiZi1pY29uIG1vZGFsX2Nsb3NlXCI+PC9pPlxyXG4gICAgICAgICAgICA8L3NwYW4+XHJcbiAgICAgICAgICAgIDxzcGFuIGNsYXNzPVwiZi1zZWxlY3QgaW5wdXQtZ3JvdXAtdGV4dFwiICAoY2xpY2spPVwic2hvd0RpYWxvZygpXCI+XHJcbiAgICAgICAgICAgICAgICA8aSBjbGFzcz1cImYtaWNvbiBmLWljb24tbG9va3VwXCI+PC9pPlxyXG4gICAgICAgICAgICA8L3NwYW4+XHJcbiAgICAgICAgPC9kaXY+XHJcbiAgICA8L2Rpdj5cclxuXHJcbiAgICA8bmctdGVtcGxhdGUgI2RlZmF1bHRCdXR0b25SZWY+XHJcbiAgICAgICAgPGJ1dHRvbiBjbGFzcz1cImJ0biBidG4tb3V0bGluZS1zZWNvbmRhcnlcIiAoY2xpY2spPVwiY2FuY2VsKClcIj4ge3sgJ3NvcnRFZGl0b3IuY2FuY2VsJ3wgbG9jYWxlIH19IDwvYnV0dG9uPiZuYnNwO1xyXG4gICAgICAgIDxidXR0b24gY2xhc3M9XCJidG4gYnRuLXByaW1hcnlcIiAoY2xpY2spPVwic2F2ZSgpXCI+IHt7ICdzb3J0RWRpdG9yLm9rJ3wgbG9jYWxlIH19IDwvYnV0dG9uPlxyXG4gICAgPC9uZy10ZW1wbGF0ZT5cclxuICAgIGAsXHJcbiAgICBwcm92aWRlcnM6IFtcclxuICAgICAgICBTT1JURVJfTE9PS1VQR1JJRF9WQUxVRV9BQ0NFU1NPUlxyXG4gICAgXSxcclxuICAgIHN0eWxlczogW1xyXG4gICAgICAgIGBcclxuICAgICAgICAubG9va3VwLWNsZWFyIHsgY3Vyc29yOiBwb2ludGVyOyBiYWNrZ3JvdW5kOiAjZmZmIWltcG9ydGFudDt9XHJcbiAgICAgICAgLmxvb2t1cC1jbGVhcjpob3ZlciB7IGJhY2tncm91bmQ6ICNlOWVjZWYhaW1wb3J0YW50O31cclxuICAgICAgICBgXHJcbiAgICBdXHJcbn0pXHJcblxyXG5leHBvcnQgY2xhc3MgU29ydGVyQ29tcG9uZW50IGV4dGVuZHMgTG9va3VwQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcclxuXHJcbiAgICBASG9zdEJpbmRpbmcoJ2NsYXNzJykgaG9zdENscyA9ICdmLWNtcC1pbnB1dGdyb3VwJztcclxuXHJcbiAgICB0ZXh0ID0gJyc7XHJcbiAgICBjb25kaXRpb25zOiBTb3J0Q29uZGl0aW9uW10gPSBbXTtcclxuICAgIG9yaWdpbmFsRGF0YTogU29ydENvbmRpdGlvbltdID0gW107XHJcblxyXG4gICAgQElucHV0KCkgY29sdW1uczoge2xhYmVsOiBzdHJpbmcsIHZhbHVlOiBzdHJpbmd9W10gPSBbXTtcclxuICAgIEBJbnB1dCgpIGZpZWxkRWRpdG9yOiBTT1JUX0ZJRUxEX0VESVRPUiA9IHsgdHlwZTogJ3NlbGVjdCcsIG9wdGlvbnM6IHt9fTtcclxuICAgIEBJbnB1dCgpIHJldHVyblR5cGU6ICdvYmplY3QnIHwgJ3N0cmluZycgPSAnb2JqZWN0JztcclxuICAgIEBJbnB1dCgpIGVuYWJsZUNsZWFyID0gdHJ1ZTtcclxuXHJcbiAgICBAT3V0cHV0KCkgb3BlbkRpYWxvZyA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuICAgIFxyXG4gICAgQFZpZXdDaGlsZCgnZGVmYXVsdEJ1dHRvblJlZicpIGJ0blJlZjogVGVtcGxhdGVSZWY8YW55PjtcclxuICAgIEBWaWV3Q2hpbGQoJ3R4dGJveCcpIHRleHRib3g6IEVsZW1lbnRSZWY8YW55PjtcclxuICAgIFxyXG4gICAgZGxnUmVmOiBCc01vZGFsUmVmO1xyXG4gICAgc29ydEVkaXRvclJlZjogQ29tcG9uZW50UmVmPFNvcnRFZGl0b3JDb21wb25lbnQ+O1xyXG4gICAgY2Q6IENoYW5nZURldGVjdG9yUmVmID0gbnVsbDtcclxuXHJcbiAgICBzaG93Q2xlYXJCdXR0b24gPSBmYWxzZTtcclxuICAgIGxvY2FsZVNlcnZpY2U6IExvY2FsZVNlcnZpY2U7XHJcbiAgICBjb21tb25VdGlsczogQ29tbW9uVXRpbHMgPSBudWxsO1xyXG4gICAgY29uc3RydWN0b3IoXHJcbiAgICAgICAgaW5qZWN0b3I6IEluamVjdG9yLCBwcml2YXRlIGNmcjogQ29tcG9uZW50RmFjdG9yeVJlc29sdmVyLFxyXG4gICAgICAgIHByaXZhdGUgbW9kYWxTZXJ2aWNlOiBCc01vZGFsU2VydmljZSwgcHVibGljIGVsOiBFbGVtZW50UmVmKSB7XHJcbiAgICAgICAgc3VwZXIoaW5qZWN0b3IsIGVsKTtcclxuICAgICAgICB0aGlzLmxvY2FsZVNlcnZpY2UgPSB0aGlzLmluamVjdG9yLmdldChMb2NhbGVTZXJ2aWNlKTtcclxuICAgICAgICB0aGlzLmNkID0gdGhpcy5pbmplY3Rvci5nZXQoQ2hhbmdlRGV0ZWN0b3JSZWYsIG51bGwpO1xyXG4gICAgICAgIHRoaXMuY29tbW9uVXRpbHMgPSB0aGlzLmluamVjdG9yLmdldChDb21tb25VdGlscywgbnVsbCkgfHwgbmV3IENvbW1vblV0aWxzKCk7XHJcbiAgICB9XHJcblxyXG4gICAgbmdPbkluaXQoKSB7ICAgIH1cclxuXHJcbiAgICBASG9zdExpc3RlbmVyKCdtb3VzZW92ZXInKVxyXG4gICAgb25tb3VzZW92ZXIoKSB7XHJcbiAgICAgICAgdGhpcy5zaG93Q2xlYXJCdXR0b24gPSB0cnVlO1xyXG4gICAgfVxyXG5cclxuICAgIEBIb3N0TGlzdGVuZXIoJ21vdXNlbGVhdmUnKVxyXG4gICAgb25tb3VzZWxlYXZlKCkge1xyXG4gICAgICAgIHRoaXMuc2hvd0NsZWFyQnV0dG9uID0gZmFsc2U7XHJcbiAgICB9XHJcblxyXG4gICAgc2hvd0RpYWxvZygpIHtcclxuICAgICAgICBpZiAoIXRoaXMuZGlzYWJsZWQpIHtcclxuXHJcbiAgICAgICAgICAgIGlmICh0aGlzLmZpZWxkRWRpdG9yICYmIHRoaXMuZmllbGRFZGl0b3IudHlwZSA9PT0gJ2NvbWJvLXRyZWUnKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmZpZWxkRWRpdG9yLm9wdGlvbnMgPSB0aGlzLmZpZWxkRWRpdG9yLm9wdGlvbnMgfHwge307XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5maWVsZEVkaXRvci5vcHRpb25zLmF1dG9XaWR0aCA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5maWVsZEVkaXRvci5vcHRpb25zLmF1dG9XaWR0aCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLmZpZWxkRWRpdG9yLm9wdGlvbnMuY29sdW1ucykge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZmllbGRFZGl0b3Iub3B0aW9ucy5jb2x1bW5zID0gWyB7IGZpZWxkOiAnbGFiZWwnLCB0aXRsZTogJ2xhYmVsJywgd2lkdGg6IDEwMCB9IF07XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLmZpZWxkRWRpdG9yLm9wdGlvbnMudGV4dEZpZWxkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5maWVsZEVkaXRvci5vcHRpb25zLnRleHRGaWVsZCA9ICdsYWJlbCc7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLmZpZWxkRWRpdG9yLm9wdGlvbnMuaWRGaWVsZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZmllbGRFZGl0b3Iub3B0aW9ucy5pZEZpZWxkID0gJ3ZhbHVlJztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgICAgIGNvbnN0IHNvcnRFZGl0b3JGYWN0b3J5ID0gdGhpcy5jZnIucmVzb2x2ZUNvbXBvbmVudEZhY3RvcnkoU29ydEVkaXRvckNvbXBvbmVudCk7XHJcbiAgICAgICAgICAgIHRoaXMuc29ydEVkaXRvclJlZiA9IHNvcnRFZGl0b3JGYWN0b3J5LmNyZWF0ZSh0aGlzLmluamVjdG9yKTtcclxuICAgICAgICAgICAgdGhpcy5zb3J0RWRpdG9yUmVmLmluc3RhbmNlLmNvbHVtbnMgPSB0aGlzLmNvbHVtbnM7XHJcbiAgICAgICAgICAgIHRoaXMuc29ydEVkaXRvclJlZi5pbnN0YW5jZS5jb25kaXRpb25zID0gdGhpcy5jb25kaXRpb25zO1xyXG4gICAgICAgICAgICB0aGlzLm9yaWdpbmFsRGF0YSA9IGNsb25lRGVlcCh0aGlzLmNvbmRpdGlvbnMpO1xyXG4gICAgICAgICAgICB0aGlzLmRsZ1JlZiA9IHRoaXMubW9kYWxTZXJ2aWNlLnNob3codGhpcy5zb3J0RWRpdG9yUmVmLCB7XHJcbiAgICAgICAgICAgICAgICB3aWR0aDogNTAwLCBoZWlnaHQ6IDQwMCxcclxuICAgICAgICAgICAgICAgIHRpdGxlOiB0aGlzLmxvY2FsZVNlcnZpY2UuZ2V0VmFsdWUoJ3NvcnRFZGl0b3IudGl0bGUnKSxcclxuICAgICAgICAgICAgICAgIGVuYWJsZVNjcm9sbDogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICBtaW5IZWlnaHQ6IDI5OCwgbWluV2lkdGg6IDQ5OCwgaWNvbkNsczogJ2YtaWNvbiBmLWljb24tY29sLWRlZmF1bHRzb3J0JyxcclxuICAgICAgICAgICAgICAgIGJ1dHRvbnM6IHRoaXMuYnRuUmVmLFxyXG4gICAgICAgICAgICAgICAgc2hvd01heEJ1dHRvbjogZmFsc2UsIGJ1dHRvbkFsaWduOiAncmlnaHQnLFxyXG4gICAgICAgICAgICAgICAgLy8gZGlhbG9nRm9vdGVyU3R5bGVzOiB7IGJhY2tncm91bmQ6ICcjRjRGNkY5JyB9LFxyXG4gICAgICAgICAgICAgICAgaW5pdGlhbFN0YXRlOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgZmllbGRFZGl0b3I6IHRoaXMuZmllbGRFZGl0b3JcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICB0aGlzLnNvcnRFZGl0b3JSZWYuaW5zdGFuY2UuaGVpZ2h0ID0gdGhpcy5kbGdSZWYuZGlhbG9nLmluc3RhbmNlLmdldENvbnRhaW5lclNpemUoKS5oZWlnaHQ7XHJcblxyXG4gICAgICAgICAgICB0aGlzLmRsZ1JlZi5kaWFsb2cuaW5zdGFuY2UucmVzaXplZC5zdWJzY3JpYmUoIHNpemUgPT4ge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zb3J0RWRpdG9yUmVmLmluc3RhbmNlLmhlaWdodCA9IHNpemUuY29udGFpbmVySGVpZ2h0O1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuc29ydEVkaXRvclJlZi5pbnN0YW5jZS5zb3J0c0NoYW5nZWQuc3Vic2NyaWJlKCAoZToge2FjdGlvbjogc3RyaW5nLCBkYXRhOiBhbnlbXX0pID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMuY29uZGl0aW9ucyA9IGUuZGF0YTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICB0aGlzLnNvcnRFZGl0b3JSZWYuY2hhbmdlRGV0ZWN0b3JSZWYuZGV0ZWN0Q2hhbmdlcygpO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5kbGdSZWYuZGlhbG9nLmNoYW5nZURldGVjdG9yUmVmLnJlYXR0YWNoKCk7XHJcbiAgICAgICAgICAgIHRoaXMub3BlbkRpYWxvZy5lbWl0KCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHdyaXRlVmFsdWUodmFsOiBhbnkpIHtcclxuICAgICAgICBpZiAodmFsKSB7XHJcbiAgICAgICAgICAgIGlmICh0eXBlb2YgdmFsID09PSAnc3RyaW5nJykge1xyXG4gICAgICAgICAgICAgICAgdmFsID0gSlNPTi5wYXJzZSh2YWwpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB0aGlzLmNvbmRpdGlvbnMgPSB2YWwgfHwgW107XHJcbiAgICAgICAgICAgIHRoaXMudGV4dCA9IHRoaXMuY29tbW9uVXRpbHMuYnVpbGRTb3J0U3RyaW5nKHZhbCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHNhdmUoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuY29uZGl0aW9ucy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgdGhpcy5jb25kaXRpb25zID0gdGhpcy5jb25kaXRpb25zLmZpbHRlcihjID0+IGMuc29ydEZpZWxkKTtcclxuICAgICAgICAgICAgdGhpcy50ZXh0ID0gdGhpcy5jb21tb25VdGlscy5idWlsZFNvcnRTdHJpbmcodGhpcy5jb25kaXRpb25zKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLnRleHQgPSAnJztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuY2xvc2VEaWFsb2coKTtcclxuXHJcbiAgICAgICAgaWYgKHRoaXMuY2QpIHtcclxuICAgICAgICAgICAgdGhpcy5jZC5kZXRlY3RDaGFuZ2VzKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGNhbmNlbCgpIHtcclxuICAgICAgICB0aGlzLmNvbmRpdGlvbnMgPSB0aGlzLm9yaWdpbmFsRGF0YTtcclxuICAgICAgICB0aGlzLmNsb3NlRGlhbG9nKCk7XHJcbiAgICB9XHJcblxyXG4gICAgY2xvc2VEaWFsb2coKSB7XHJcbiAgICAgICAgdGhpcy51cGRhdGVNb2RlbCgpO1xyXG4gICAgICAgIHRoaXMuc29ydEVkaXRvclJlZiA9IG51bGw7XHJcbiAgICAgICAgdGhpcy5kbGdSZWYuY2xvc2UoKTtcclxuICAgIH1cclxuXHJcbiAgICBjbGVhcigpIHtcclxuICAgICAgICB0aGlzLnRleHQgPSAnJztcclxuICAgICAgICB0aGlzLmNvbmRpdGlvbnMgPSBbXTtcclxuICAgICAgICB0aGlzLnVwZGF0ZU1vZGVsKCk7XHJcbiAgICB9XHJcblxyXG5cclxuXHJcbiAgICBwcml2YXRlIHVwZGF0ZU1vZGVsKCkge1xyXG4gICAgICAgIGxldCB2OiBhbnkgPSB0aGlzLmNvbmRpdGlvbnM7XHJcbiAgICAgICAgaWYgKHRoaXMucmV0dXJuVHlwZSA9PT0gJ3N0cmluZycpIHtcclxuICAgICAgICAgICAgdiA9IEpTT04uc3RyaW5naWZ5KHRoaXMuY29uZGl0aW9ucyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLm9uTW9kZWxDaGFuZ2Uodik7XHJcbiAgICAgICAgdGhpcy5vbk1vZGVsVG91Y2hlZCh2KTtcclxuXHJcbiAgICB9XHJcblxyXG59XHJcbiJdfQ==
/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Injector, Input, NgZone } from '@angular/core';
import { HttpService } from '@farris/ide-devkit';
import { MessagerService } from '@farris/ui-messager';
import { LocaleService } from '@farris/ui-locale';
export class GspAppManagerComponent {
    /**
     * @param {?} http
     * @param {?} injector
     * @param {?} ngZone
     * @param {?} messagerSer
     */
    constructor(http, injector, ngZone, messagerSer) {
        this.http = http;
        this.injector = injector;
        this.ngZone = ngZone;
        this.messagerSer = messagerSer;
        this.serverIp = '';
        this.path = '';
        /**
         * 所有app数据
         */
        this.allAppTreeData = [];
        this.appIdField = 'id';
        this.showMask = true;
        this.appModel = {
            appInvoks: [],
            code: '',
            creator: '',
            description: '',
            id: this.uuid(),
            layer: '4',
            name: '',
            parentId: '',
            url: ''
        };
        this.localeSer = this.injector.get(LocaleService, null);
    }
    /**
     * @private
     * @return {?}
     */
    get APP_URI() {
        return this.serverIp + '/api/runtime/sys/v1.0/gspapp/all';
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.initAllAppTree();
        this.appModel.url = this.path;
        this.addInvoke();
    }
    /**
     * @param {?} changes
     * @return {?}
     */
    ngOnChanges(changes) {
    }
    /**
     * @return {?}
     */
    validate() {
        /** @type {?} */
        let msg = '';
        if (!this.appModel.code) {
            msg += this.localeSer.getValue('publishmenu.app.message.appcode'); // '<br> 应用编号不能为空。';
        }
        if (!this.appModel.name) {
            msg += this.localeSer.getValue('publishmenu.app.message.appname'); // '<br> 应用名称不能为空。';
        }
        if (!this.appModel.url) {
            msg += this.localeSer.getValue('publishmenu.app.message.url'); // '<br> 部署路径不能为空。';
        }
        if (!this.appModel.appInvoks || !this.appModel.appInvoks.length) {
            msg += this.localeSer.getValue('publishmenu.app.message.appInvoks'); // '请设置应用入口点';
        }
        else {
            // const inValidInvoks = this.appModel.appInvoks.filter(n => {
            //     return !n.code || !n.name || !n.appEntrance;
            // });
            /** @type {?} */
            const _invoksMsg = this.appModel.appInvoks.map((/**
             * @param {?} n
             * @param {?} idx
             * @return {?}
             */
            (n, idx) => {
                /** @type {?} */
                const m = { idx, msg: '' };
                if (!n.name) {
                    m.msg += this.localeSer.getValue('publishmenu.app.message.invoksCode'); // "<br>入口名称不能为空。";
                }
                if (!n.code) {
                    m.msg += this.localeSer.getValue('publishmenu.app.message.invoksName'); // "<br>入口编号不能为空。";
                }
                if (!n.appEntrance) {
                    m.msg += this.localeSer.getValue('publishmenu.app.message.invoksAppEntrance'); // "<br>路由标识不能为空。";
                }
                return m;
            }));
            if (_invoksMsg.length > 0) {
                /** @type {?} */
                const appMain = this.localeSer.getValue('publishmenu.app.entry');
                /** @type {?} */
                const line = this.localeSer.getValue('publishmenu.line');
                _invoksMsg.forEach((/**
                 * @param {?} m
                 * @return {?}
                 */
                m => {
                    msg += `<b>${appMain}:</b> <br> ${line.replace('{line}', m.idx + 1)} , ${m.msg} <br>`;
                }));
                // msg += this.localeSer.getValue('publishmenu.app.message.inValidInvoks'); // '应用入口点信息不完整，请检查。';
            }
        }
        if (msg) {
            this.messagerSer.show('warning', msg, { safeHtml: false });
            return false;
        }
        else {
            return true;
        }
    }
    /**
     * @param {?} e
     * @return {?}
     */
    treeNodeClicked(e) {
        this.appModel.parentId = e.node.data.id;
        this.showMask = false;
    }
    /**
     * @return {?}
     */
    uuid() {
        return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, (/**
         * @param {?} c
         * @return {?}
         */
        (c) => {
            /** @type {?} */
            const r = Math.random() * 16 | 0;
            /** @type {?} */
            const v = c === 'x' ? r : (r & 0x3 | 0x8);
            return v.toString(16);
        }));
    }
    /**
     * @return {?}
     */
    addInvoke() {
        this.appModel.appInvoks.push(this.createNewAppInvok());
    }
    /**
     * @param {?} id
     * @return {?}
     */
    removeInvoke(id) {
        this.appModel.appInvoks = this.appModel.appInvoks.filter((/**
         * @param {?} n
         * @return {?}
         */
        n => n.id !== id));
    }
    /**
     * @private
     * @return {?}
     */
    initAllAppTree() {
        this.http.get(this.APP_URI).subscribe((/**
         * @param {?} data
         * @return {?}
         */
        data => {
            if (data) {
                this.allAppTreeData = this.convert2TreeNodes(data);
                // console.log(this.allAppTreeData);
            }
        }));
    }
    /**
     * @private
     * @param {?} data
     * @param {?=} parentId
     * @return {?}
     */
    convert2TreeNodes(data, parentId = '') {
        if (data.length) {
            /** @type {?} */
            const nodes = data.filter((/**
             * @param {?} v
             * @return {?}
             */
            (v) => {
                /** @type {?} */
                let pid = v.parentId;
                if (pid === undefined || pid === null) {
                    pid = '';
                }
                return pid === parentId;
            }));
            return nodes.map((/**
             * @param {?} item
             * @return {?}
             */
            item => {
                /** @type {?} */
                const node = {
                    data: item,
                    children: [],
                    selectable: item.layer === '3'
                };
                node.children = this.convert2TreeNodes(data, item.id);
                return node;
            }));
        }
        return [];
    }
    /**
     * @private
     * @return {?}
     */
    createNewAppInvok() {
        return {
            id: this.uuid(),
            appId: this.appModel.id,
            code: '',
            appEntrance: '',
            // 路由标识
            name: ''
        };
    }
}
GspAppManagerComponent.decorators = [
    { type: Component, args: [{
                selector: 'gsp-app-mangaer',
                template: "<div class=\"d-flex flex-row\" style=\"width: 760px; height: 400px;border:0px solid #ae00e6\">\r\n    <!-- Left -->\r\n    <div region=\"west\" class=\"west\" style=\"width: 280px;min-width:280px; height: 100%; background-color: #fff;border-right: 1px solid #e2e8f0;\">\r\n        <!-- \u83DC\u5355\u6811 -->\r\n        <perfect-scrollbar style=\"position: relative; width: 280px; height: 100%;\">\r\n            <farris-treetable #tt [data]=\"allAppTreeData\" [idField]=\"appIdField\" [striped]=\"false\" [findField]=\"'name'\"\r\n                [singleSelect]=\"true\" [showIcon]=\"true\" [showFilterBar]=\"false\" [selectOnCheck]=\"true\"\r\n                (nodeSelected)=\"treeNodeClicked($event)\"\r\n                [checkOnSelect]=\"true\" [sortName]=\"'name'\" [sortOrder]=\"'asc'\" [remoteSort]=\"false\">\r\n                <ng-template farrisTemplate=\"body\" let-rowNode let-treeNode=\"node\" let-rowData=\"rowData\">\r\n                    <tr #row=\"row\" [selectRow]=\"rowNode\" [selectRowDisabled]=\"!rowNode.node.selectable\" [dblclick]=\"true\">\r\n                        <td style=\"border: 0; cursor: pointer;\" [style.color]=\"row.selectRowDisabled? '#595959': '#000000'\">\r\n                            <farris-treeTableToggler [rowNode]=\"rowNode\"></farris-treeTableToggler>\r\n                            <span [innerHTML]=\"rowData['name'] | highlight: tt.findValue: 'name' : 'name'\"></span>\r\n                        </td>\r\n                    </tr>\r\n                </ng-template>\r\n            </farris-treetable>\r\n        </perfect-scrollbar>\r\n    </div>\r\n\r\n    <!-- main -->\r\n    <div region=\"center\" class=\"center flex-fill public-menu-main\" style=\"color: #000000; overflow: auto;\">\r\n\r\n        <div class=\"mengbanban\" *ngIf=\"showMask\" style=\"\r\n            position: absolute;\r\n            z-index: 10;\r\n            top: 0;\r\n            width: 100%;\r\n            height: 100%;\r\n            opacity: 0.5;\r\n            background: #fff;\r\n            display: block;\r\n            font-size: 40px;\r\n        \"><h1 style=\"\r\n            margin-top: 145px;\r\n            color: #000;\r\n            margin-left: 20px;\r\n        \">\u2190 {{ 'publishmenu.app.message.info' | locale }}</h1></div>\r\n\r\n        <div class=\"row\" style=\"margin: 10px 15px;\">\r\n            <div class=\"col-12\">\r\n                <div class=\"form-group\">\r\n                    <label for=\"txtAppCode\">{{ 'publishmenu.app.id' | locale }}</label>\r\n                    <input type=\"text\" disabled [ngModel]=\"appModel.id\" class=\"form-control\" id=\"txtappid\">\r\n                </div>\r\n                <div class=\"form-group\">\r\n                    <label for=\"txtAppCode\"><span class=\"farris-label-info text-danger\">*</span>{{ 'publishmenu.app.code' | locale }}</label>\r\n                    <input type=\"text\" class=\"form-control\" [(ngModel)]=\"appModel.code\" id=\"txtAppCode\" >\r\n                </div>\r\n                <div class=\"form-group\">\r\n                    <label for=\"txtAppName\"><span class=\"farris-label-info text-danger\">*</span>{{ 'publishmenu.app.name' | locale }}</label>\r\n                    <input type=\"text\" class=\"form-control\" id=\"txtAppName\"  [(ngModel)]=\"appModel.name\">\r\n                </div>\r\n                <div class=\"form-group\">\r\n                    <label for=\"txtAppAction\"><span class=\"farris-label-info text-danger\">*</span>{{ 'publishmenu.app.path' | locale }}</label>\r\n                    <input type=\"text\" class=\"form-control\" id=\"txtAppAction\" [(ngModel)]=\"appModel.url\">\r\n                </div>\r\n                <div class=\"form-group\">\r\n                    <label for=\"txtAppRemark\">{{ 'publishmenu.app.remark' | locale }}</label>\r\n                    <input type=\"text\" class=\"form-control\" [(ngModel)]=\"appModel.description\">\r\n                </div>\r\n                <div class=\"form-group\">\r\n                    <label for=\"txtAppRemark\"><span class=\"farris-label-info text-danger\">*</span>{{ 'publishmenu.app.entry' | locale }}</label>\r\n                    <table class=\"table table-bordered\">\r\n                        <colgroup>\r\n                            <col width=\"50\">\r\n                            <col width=\"50\">\r\n                            <col width=\"50\">\r\n                            <col width=\"30\">\r\n                        </colgroup>\r\n                        <thead>\r\n                            <tr>\r\n                                <td>\r\n                                    {{ 'publishmenu.app.entryname' | locale }}\r\n                                </td>\r\n                                <td>\r\n                                    {{ 'publishmenu.app.entrycode' | locale }}\r\n                                </td>\r\n                                <td>\r\n                                    {{ 'publishmenu.app.routeid' | locale }}\r\n                                </td>\r\n                                <td align=\"center\">\r\n                                    {{ 'publishmenu.app.action' | locale }}\r\n                                </td>\r\n                            </tr>\r\n                        </thead>\r\n                        <tbody>\r\n                            <tr *ngFor=\"let n of appModel.appInvoks\">\r\n                                <td>\r\n                                    <input type=\"text\" [(ngModel)]=\"n.name\" class=\"form-control\">\r\n                                </td>\r\n                                <td>\r\n                                    <input type=\"text\" class=\"form-control\" [(ngModel)]=\"n.code\" >\r\n                                </td>\r\n                                <td>\r\n                                    <input type=\"text\" class=\"form-control\" [(ngModel)]=\"n.appEntrance\" >\r\n                                </td>\r\n                                <td style=\"padding-left: 0; padding-right: 0; text-align: center\">\r\n                                    <button type=\"button\" (click)=\"removeInvoke(n.id)\" class=\"btn\">\r\n                                        <span class=\"k-icon k-i-minus\"></span></button>\r\n                                </td>\r\n                            </tr>\r\n                        </tbody>\r\n                        <tfoot>\r\n                            <tr>\r\n                                <td colspan=\"4\">\r\n                                    <button type=\"button\" (click)=\"addInvoke()\" class=\"btn btn-primary\">\r\n                                        <span class=\"k-icon k-i-plus\"></span> {{ 'publishmenu.app.addentry' | locale }}</button>\r\n                                </td>\r\n                            </tr>\r\n                        </tfoot>\r\n                    </table>\r\n\r\n                </div>\r\n\r\n            </div>\r\n        </div>\r\n\r\n    </div>\r\n</div>"
            }] }
];
/** @nocollapse */
GspAppManagerComponent.ctorParameters = () => [
    { type: HttpService },
    { type: Injector },
    { type: NgZone },
    { type: MessagerService }
];
GspAppManagerComponent.propDecorators = {
    serverIp: [{ type: Input }],
    path: [{ type: Input }]
};
if (false) {
    /** @type {?} */
    GspAppManagerComponent.prototype.serverIp;
    /** @type {?} */
    GspAppManagerComponent.prototype.path;
    /**
     * 所有app数据
     * @type {?}
     */
    GspAppManagerComponent.prototype.allAppTreeData;
    /** @type {?} */
    GspAppManagerComponent.prototype.appIdField;
    /** @type {?} */
    GspAppManagerComponent.prototype.showMask;
    /** @type {?} */
    GspAppManagerComponent.prototype.appModel;
    /** @type {?} */
    GspAppManagerComponent.prototype.localeSer;
    /**
     * @type {?}
     * @private
     */
    GspAppManagerComponent.prototype.http;
    /**
     * @type {?}
     * @private
     */
    GspAppManagerComponent.prototype.injector;
    /**
     * @type {?}
     * @private
     */
    GspAppManagerComponent.prototype.ngZone;
    /**
     * @type {?}
     * @private
     */
    GspAppManagerComponent.prototype.messagerSer;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ3NwLWFwcC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL2lkZS1wdWJsaXNoLW1lbnUvIiwic291cmNlcyI6WyJsaWIvZ3NwLWFwcC9nc3AtYXBwLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQ0EsT0FBTyxFQUFFLFNBQVMsRUFBVSxRQUFRLEVBQzVCLEtBQUssRUFBdUMsTUFBTSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ2xGLE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQztBQUVqRCxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDdEQsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBS2xELE1BQU0sT0FBTyxzQkFBc0I7Ozs7Ozs7SUE4Qi9CLFlBQ1ksSUFBaUIsRUFDakIsUUFBa0IsRUFDbEIsTUFBYyxFQUNkLFdBQTRCO1FBSDVCLFNBQUksR0FBSixJQUFJLENBQWE7UUFDakIsYUFBUSxHQUFSLFFBQVEsQ0FBVTtRQUNsQixXQUFNLEdBQU4sTUFBTSxDQUFRO1FBQ2QsZ0JBQVcsR0FBWCxXQUFXLENBQWlCO1FBaEMvQixhQUFRLEdBQUcsRUFBRSxDQUFDO1FBQ2QsU0FBSSxHQUFHLEVBQUUsQ0FBQzs7OztRQUVuQixtQkFBYyxHQUFHLEVBQUUsQ0FBQztRQUNwQixlQUFVLEdBQUcsSUFBSSxDQUFDO1FBRWxCLGFBQVEsR0FBRyxJQUFJLENBQUM7UUFFaEIsYUFBUSxHQUFnQjtZQUNwQixTQUFTLEVBQUUsRUFDVjtZQUNELElBQUksRUFBRSxFQUFFO1lBQ1IsT0FBTyxFQUFFLEVBQUU7WUFDWCxXQUFXLEVBQUUsRUFBRTtZQUNmLEVBQUUsRUFBRSxJQUFJLENBQUMsSUFBSSxFQUFFO1lBQ2YsS0FBSyxFQUFFLEdBQUc7WUFDVixJQUFJLEVBQUUsRUFBRTtZQUNSLFFBQVEsRUFBRSxFQUFFO1lBQ1osR0FBRyxFQUFFLEVBQUU7U0FD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LENBQUM7U0FDTjtRQUNELE9BQU8sRUFBRSxDQUFDO0lBQ2QsQ0FBQzs7Ozs7SUFFTyxpQkFBaUI7UUFDckIsT0FBTztZQUNILEVBQUUsRUFBRSxJQUFJLENBQUMsSUFBSSxFQUFFO1lBQ2YsS0FBSyxFQUFFLElBQUksQ0FBQyxRQUFRLENBQUMsRUFBRTtZQUN2QixJQUFJLEVBQUUsRUFBRTtZQUNSLFdBQVcsRUFBRSxFQUFFOztZQUNmLElBQUksRUFBRSxFQUFFO1NBQ1gsQ0FBQztJQUNOLENBQUM7OztZQTlLSixTQUFTLFNBQUM7Z0JBQ1AsUUFBUSxFQUFFLGlCQUFpQjtnQkFDM0IsODNOQUF1QzthQUMxQzs7OztZQVBRLFdBQVc7WUFGUSxRQUFRO1lBQ2dCLE1BQU07WUFHakQsZUFBZTs7O3VCQVFuQixLQUFLO21CQUNMLEtBQUs7Ozs7SUFETiwwQ0FBdUI7O0lBQ3ZCLHNDQUFtQjs7Ozs7SUFFbkIsZ0RBQW9COztJQUNwQiw0Q0FBa0I7O0lBRWxCLDBDQUFnQjs7SUFFaEIsMENBV0U7O0lBR0YsMkNBQXlCOzs7OztJQU9yQixzQ0FBeUI7Ozs7O0lBQ3pCLDBDQUEwQjs7Ozs7SUFDMUIsd0NBQXNCOzs7OztJQUN0Qiw2Q0FBb0MiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBHc3BBcHBNb2RlbCB9IGZyb20gJy4vLi4vbW9kZWxzL2dzcC1hcHAubW9kZWwnO1xyXG5pbXBvcnQgeyBDb21wb25lbnQsIE9uSW5pdCwgSW5qZWN0b3IsIExPQ0FMRV9JRCxcclxuICAgICAgICBJbnB1dCwgT25DaGFuZ2VzLCBTaW1wbGVDaGFuZ2VzLCBWaWV3Q2hpbGQsIE5nWm9uZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBIdHRwU2VydmljZSB9IGZyb20gJ0BmYXJyaXMvaWRlLWRldmtpdCc7XHJcbmltcG9ydCB7IFRyZWVOb2RlIH0gZnJvbSAnQGZhcnJpcy91aS10cmVldGFibGUnO1xyXG5pbXBvcnQgeyBNZXNzYWdlclNlcnZpY2UgfSBmcm9tICdAZmFycmlzL3VpLW1lc3NhZ2VyJztcclxuaW1wb3J0IHsgTG9jYWxlU2VydmljZSB9IGZyb20gJ0BmYXJyaXMvdWktbG9jYWxlJztcclxuQENvbXBvbmVudCh7XHJcbiAgICBzZWxlY3RvcjogJ2dzcC1hcHAtbWFuZ2FlcicsXHJcbiAgICB0ZW1wbGF0ZVVybDogJy4vZ3NwLWFwcC5jb21wb25lbnQuaHRtbCdcclxufSlcclxuZXhwb3J0IGNsYXNzIEdzcEFwcE1hbmFnZXJDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIE9uQ2hhbmdlcyB7XHJcblxyXG4gICAgQElucHV0KCkgc2VydmVySXAgPSAnJztcclxuICAgIEBJbnB1dCgpIHBhdGggPSAnJztcclxuICAgIC8qKiDmiYDmnIlhcHDmlbDmja4gKi9cclxuICAgIGFsbEFwcFRyZWVEYXRhID0gW107XHJcbiAgICBhcHBJZEZpZWxkID0gJ2lkJztcclxuXHJcbiAgICBzaG93TWFzayA9IHRydWU7XHJcblxyXG4gICAgYXBwTW9kZWw6IEdzcEFwcE1vZGVsID0ge1xyXG4gICAgICAgIGFwcEludm9rczogW1xyXG4gICAgICAgIF0sXHJcbiAgICAgICAgY29kZTogJycsXHJcbiAgICAgICAgY3JlYXRvcjogJycsXHJcbiAgICAgICAgZGVzY3JpcHRpb246ICcnLFxyXG4gICAgICAgIGlkOiB0aGlzLnV1aWQoKSxcclxuICAgICAgICBsYXllcjogJzQnLFxyXG4gICAgICAgIG5hbWU6ICcnLFxyXG4gICAgICAgIHBhcmVudElkOiAnJyxcclxuICAgICAgICB1cmw6ICcnXHJcbiAgICB9O1xyXG5cclxuXHJcbiAgICBsb2NhbGVTZXI6IExvY2FsZVNlcnZpY2U7XHJcblxyXG4gICAgcHJpdmF0ZSBnZXQgQVBQX1VSSSgpIHtcclxuICAgICAgICByZXR1cm4gIHRoaXMuc2VydmVySXAgKyAnL2FwaS9ydW50aW1lL3N5cy92MS4wL2dzcGFwcC9hbGwnO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0cnVjdG9yKFxyXG4gICAgICAgIHByaXZhdGUgaHR0cDogSHR0cFNlcnZpY2UsXHJcbiAgICAgICAgcHJpdmF0ZSBpbmplY3RvcjogSW5qZWN0b3IsXHJcbiAgICAgICAgcHJpdmF0ZSBuZ1pvbmU6IE5nWm9uZSxcclxuICAgICAgICBwcml2YXRlIG1lc3NhZ2VyU2VyOiBNZXNzYWdlclNlcnZpY2VcclxuICAgICkge1xyXG5cclxuICAgICAgICB0aGlzLmxvY2FsZVNlciA9IHRoaXMuaW5qZWN0b3IuZ2V0KExvY2FsZVNlcnZpY2UsIG51bGwpO1xyXG4gICAgfVxyXG5cclxuICAgIG5nT25Jbml0KCkge1xyXG4gICAgICAgIHRoaXMuaW5pdEFsbEFwcFRyZWUoKTtcclxuICAgICAgICB0aGlzLmFwcE1vZGVsLnVybCA9IHRoaXMucGF0aDtcclxuICAgICAgICB0aGlzLmFkZEludm9rZSgpO1xyXG4gICAgfVxyXG5cclxuICAgIG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpIHtcclxuXHJcbiAgICB9XHJcblxyXG4gICAgdmFsaWRhdGUoKSB7XHJcbiAgICAgICAgbGV0IG1zZyA9ICcnO1xyXG5cclxuXHJcbiAgICAgICAgaWYgKCF0aGlzLmFwcE1vZGVsLmNvZGUpIHtcclxuICAgICAgICAgICAgbXNnICs9IHRoaXMubG9jYWxlU2VyLmdldFZhbHVlKCdwdWJsaXNobWVudS5hcHAubWVzc2FnZS5hcHBjb2RlJyk7IC8vICc8YnI+IOW6lOeUqOe8luWPt+S4jeiDveS4uuepuuOAgic7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoIXRoaXMuYXBwTW9kZWwubmFtZSkge1xyXG4gICAgICAgICAgICBtc2cgKz0gdGhpcy5sb2NhbGVTZXIuZ2V0VmFsdWUoJ3B1Ymxpc2htZW51LmFwcC5tZXNzYWdlLmFwcG5hbWUnKTsgLy8gJzxicj4g5bqU55So5ZCN56ew5LiN6IO95Li656m644CCJztcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICBpZiAoIXRoaXMuYXBwTW9kZWwudXJsKSB7XHJcbiAgICAgICAgICAgIG1zZyArPSB0aGlzLmxvY2FsZVNlci5nZXRWYWx1ZSgncHVibGlzaG1lbnUuYXBwLm1lc3NhZ2UudXJsJyk7IC8vICc8YnI+IOmDqOe9sui3r+W+hOS4jeiDveS4uuepuuOAgic7XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgaWYgKCF0aGlzLmFwcE1vZGVsLmFwcEludm9rcyB8fCAhdGhpcy5hcHBNb2RlbC5hcHBJbnZva3MubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIG1zZyArPSB0aGlzLmxvY2FsZVNlci5nZXRWYWx1ZSgncHVibGlzaG1lbnUuYXBwLm1lc3NhZ2UuYXBwSW52b2tzJyk7IC8vICfor7forr7nva7lupTnlKjlhaXlj6PngrknO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIC8vIGNvbnN0IGluVmFsaWRJbnZva3MgPSB0aGlzLmFwcE1vZGVsLmFwcEludm9rcy5maWx0ZXIobiA9PiB7XHJcbiAgICAgICAgICAgIC8vICAgICByZXR1cm4gIW4uY29kZSB8fCAhbi5uYW1lIHx8ICFuLmFwcEVudHJhbmNlO1xyXG4gICAgICAgICAgICAvLyB9KTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IF9pbnZva3NNc2cgPSB0aGlzLmFwcE1vZGVsLmFwcEludm9rcy5tYXAoKG4sIGlkeCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgbSA9IHsgaWR4LCBtc2c6ICcnfTtcclxuICAgICAgICAgICAgICAgIGlmICghbi5uYW1lKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbS5tc2cgKz0gdGhpcy5sb2NhbGVTZXIuZ2V0VmFsdWUoJ3B1Ymxpc2htZW51LmFwcC5tZXNzYWdlLmludm9rc0NvZGUnKTsgLy8gXCI8YnI+5YWl5Y+j5ZCN56ew5LiN6IO95Li656m644CCXCI7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAoIW4uY29kZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIG0ubXNnICs9IHRoaXMubG9jYWxlU2VyLmdldFZhbHVlKCdwdWJsaXNobWVudS5hcHAubWVzc2FnZS5pbnZva3NOYW1lJyk7IC8vIFwiPGJyPuWFpeWPo+e8luWPt+S4jeiDveS4uuepuuOAglwiO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKCFuLmFwcEVudHJhbmNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbS5tc2cgKz0gIHRoaXMubG9jYWxlU2VyLmdldFZhbHVlKCdwdWJsaXNobWVudS5hcHAubWVzc2FnZS5pbnZva3NBcHBFbnRyYW5jZScpOyAvLyBcIjxicj7ot6/nlLHmoIfor4bkuI3og73kuLrnqbrjgIJcIjtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBpZiAoX2ludm9rc01zZy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBhcHBNYWluID0gdGhpcy5sb2NhbGVTZXIuZ2V0VmFsdWUoJ3B1Ymxpc2htZW51LmFwcC5lbnRyeScpO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgbGluZSA9ICB0aGlzLmxvY2FsZVNlci5nZXRWYWx1ZSgncHVibGlzaG1lbnUubGluZScpO1xyXG4gICAgICAgICAgICAgICAgX2ludm9rc01zZy5mb3JFYWNoKG0gPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIG1zZyArPSBgPGI+JHthcHBNYWlufTo8L2I+IDxicj4gJHsgbGluZS5yZXBsYWNlKCd7bGluZX0nLCBtLmlkeCArIDEpfSAsICR7bS5tc2d9IDxicj5gO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAvLyBtc2cgKz0gdGhpcy5sb2NhbGVTZXIuZ2V0VmFsdWUoJ3B1Ymxpc2htZW51LmFwcC5tZXNzYWdlLmluVmFsaWRJbnZva3MnKTsgLy8gJ+W6lOeUqOWFpeWPo+eCueS/oeaBr+S4jeWujOaVtO+8jOivt+ajgOafpeOAgic7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICBpZiAobXNnKSB7XHJcbiAgICAgICAgICAgIHRoaXMubWVzc2FnZXJTZXIuc2hvdygnd2FybmluZycsIG1zZywgeyBzYWZlSHRtbDogZmFsc2UgfSk7XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgdHJlZU5vZGVDbGlja2VkKGUpIHtcclxuICAgICAgICB0aGlzLmFwcE1vZGVsLnBhcmVudElkID0gZS5ub2RlLmRhdGEuaWQ7XHJcbiAgICAgICAgdGhpcy5zaG93TWFzayA9IGZhbHNlO1xyXG4gICAgfVxyXG5cclxuICAgIHV1aWQoKSB7XHJcbiAgICAgICAgcmV0dXJuICd4eHh4eHh4eC14eHh4LTR4eHgteXh4eC14eHh4eHh4eHh4eHgnLnJlcGxhY2UoL1t4eV0vZywgKGMpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgciA9IE1hdGgucmFuZG9tKCkgKiAxNiB8IDAsIHYgPSBjID09PSAneCcgPyByIDogKHIgJiAweDMgfCAweDgpO1xyXG4gICAgICAgICAgICByZXR1cm4gdi50b1N0cmluZygxNik7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgYWRkSW52b2tlKCkge1xyXG4gICAgICAgIHRoaXMuYXBwTW9kZWwuYXBwSW52b2tzLnB1c2godGhpcy5jcmVhdGVOZXdBcHBJbnZvaygpKTtcclxuICAgIH1cclxuXHJcbiAgICByZW1vdmVJbnZva2UoaWQpIHtcclxuICAgICAgICB0aGlzLmFwcE1vZGVsLmFwcEludm9rcyA9IHRoaXMuYXBwTW9kZWwuYXBwSW52b2tzLmZpbHRlcihuID0+IG4uaWQgIT09IGlkKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGluaXRBbGxBcHBUcmVlKCkge1xyXG4gICAgICAgIHRoaXMuaHR0cC5nZXQodGhpcy5BUFBfVVJJKS5zdWJzY3JpYmUoZGF0YSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmFsbEFwcFRyZWVEYXRhID0gdGhpcy5jb252ZXJ0MlRyZWVOb2RlcyhkYXRhKTtcclxuICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKHRoaXMuYWxsQXBwVHJlZURhdGEpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG5cclxuICAgIHByaXZhdGUgY29udmVydDJUcmVlTm9kZXMoZGF0YTogYW55W10sIHBhcmVudElkID0gJycpOiBUcmVlTm9kZVtdIHtcclxuICAgICAgICBpZiAoZGF0YS5sZW5ndGgpIHtcclxuICAgICAgICAgICAgY29uc3Qgbm9kZXMgPSBkYXRhLmZpbHRlcigodikgPT4ge1xyXG4gICAgICAgICAgICAgICAgbGV0IHBpZCA9IHYucGFyZW50SWQ7XHJcbiAgICAgICAgICAgICAgICBpZiAocGlkID09PSB1bmRlZmluZWQgfHwgcGlkID09PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcGlkID0gJyc7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcGlkID09PSBwYXJlbnRJZDtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIHJldHVybiBub2Rlcy5tYXAoaXRlbSA9PiB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBub2RlID0ge1xyXG4gICAgICAgICAgICAgICAgICAgIGRhdGE6IGl0ZW0sXHJcbiAgICAgICAgICAgICAgICAgICAgY2hpbGRyZW46IFtdLFxyXG4gICAgICAgICAgICAgICAgICAgIHNlbGVjdGFibGU6IGl0ZW0ubGF5ZXIgPT09ICczJ1xyXG4gICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICBub2RlLmNoaWxkcmVuID0gdGhpcy5jb252ZXJ0MlRyZWVOb2RlcyhkYXRhLCBpdGVtLmlkKTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBub2RlO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIFtdO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgY3JlYXRlTmV3QXBwSW52b2soKSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgaWQ6IHRoaXMudXVpZCgpLFxyXG4gICAgICAgICAgICBhcHBJZDogdGhpcy5hcHBNb2RlbC5pZCxcclxuICAgICAgICAgICAgY29kZTogJycsXHJcbiAgICAgICAgICAgIGFwcEVudHJhbmNlOiAnJywgLy8g6Lev55Sx5qCH6K+GXHJcbiAgICAgICAgICAgIG5hbWU6ICcnXHJcbiAgICAgICAgfTtcclxuICAgIH1cclxufVxyXG4iXX0=
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("lodash-es"),require("rxjs"),require("@farris/ui-loading"),require("@farris/ui-messager"),require("@farris/ui-common"),require("@farris/ui-modal"),require("@angular/core"),require("@angular/common"),require("@angular/forms"),require("@farris/ui-treetable"),require("@farris/ui-perfect-scrollbar"),require("@farris/ide-devkit"),require("@farris/ui-datagrid"),require("@farris/ui-locale"),require("@farris/ui-language-textbox")):"function"==typeof define&&define.amd?define("@farris/ide-publish-menu",["exports","lodash-es","rxjs","@farris/ui-loading","@farris/ui-messager","@farris/ui-common","@farris/ui-modal","@angular/core","@angular/common","@angular/forms","@farris/ui-treetable","@farris/ui-perfect-scrollbar","@farris/ide-devkit","@farris/ui-datagrid","@farris/ui-locale","@farris/ui-language-textbox"],t):t((e.farris=e.farris||{},e.farris["ide-publish-menu"]={}),e.lodashEs,e.rxjs,e.uiLoading,e.uiMessager,e.uiCommon,e.uiModal,e.ng.core,e.ng.common,e.ng.forms,e.uiTreetable,e.uiPerfectScrollbar,e.ideDevkit,e.uiDatagrid,e.uiLocale,e.uiLanguageTextbox)}(this,function(e,n,r,t,a,l,o,s,i,p,c,d,u,h,b,f){"use strict";var m=(g.decorators=[{type:s.Injectable,args:[{providedIn:"root"}]}],g.ctorParameters=function(){return[]},g.ngInjectableDef=s.defineInjectable({factory:function(){return new g},token:g,providedIn:"root"}),g);function g(){}var v=(Object.defineProperty(y.prototype,"APP_URI",{get:function(){return this.serverIp+"/api/runtime/sys/v1.0/gspapp/all"},enumerable:!0,configurable:!0}),y.prototype.ngOnInit=function(){this.initAllAppTree(),this.appModel.url=this.path,this.addInvoke()},y.prototype.ngOnChanges=function(e){},y.prototype.validate=function(){var n=this,t="";if(this.appModel.code||(t+=this.localeSer.getValue("publishmenu.app.message.appcode")),this.appModel.name||(t+=this.localeSer.getValue("publishmenu.app.message.appname")),this.appModel.url||(t+=this.localeSer.getValue("publishmenu.app.message.url")),this.appModel.appInvoks&&this.appModel.appInvoks.length){var e=this.appModel.appInvoks.map(function(e,t){var r={idx:t,msg:""};return e.name||(r.msg+=n.localeSer.getValue("publishmenu.app.message.invoksCode")),e.code||(r.msg+=n.localeSer.getValue("publishmenu.app.message.invoksName")),e.appEntrance||(r.msg+=n.localeSer.getValue("publishmenu.app.message.invoksAppEntrance")),r});if(0<e.length){var r=this.localeSer.getValue("publishmenu.app.entry"),a=this.localeSer.getValue("publishmenu.line");e.forEach(function(e){t+="<b>"+r+":</b> <br> "+a.replace("{line}",e.idx+1)+" , "+e.msg+" <br>"})}}else t+=this.localeSer.getValue("publishmenu.app.message.appInvoks");return!t||(this.messagerSer.show("warning",t,{safeHtml:!1}),!1)},y.prototype.treeNodeClicked=function(e){this.appModel.parentId=e.node.data.id,this.showMask=!1},y.prototype.uuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})},y.prototype.addInvoke=function(){this.appModel.appInvoks.push(this.createNewAppInvok())},y.prototype.removeInvoke=function(t){this.appModel.appInvoks=this.appModel.appInvoks.filter(function(e){return e.id!==t})},y.prototype.initAllAppTree=function(){var t=this;this.http.get(this.APP_URI).subscribe(function(e){e&&(t.allAppTreeData=t.convert2TreeNodes(e))})},y.prototype.convert2TreeNodes=function(r,n){var a=this;return void 0===n&&(n=""),r.length?r.filter(function(e){var t=e.parentId;return t!==undefined&&null!==t||(t=""),t===n}).map(function(e){var t={data:e,children:[],selectable:"3"===e.layer};return t.children=a.convert2TreeNodes(r,e.id),t}):[]},y.prototype.createNewAppInvok=function(){return{id:this.uuid(),appId:this.appModel.id,code:"",appEntrance:"",name:""}},y.decorators=[{type:s.Component,args:[{selector:"gsp-app-mangaer",template:'<div class="d-flex flex-row" style="width: 760px; height: 400px;border:0px solid #ae00e6">\r\n    \x3c!-- Left --\x3e\r\n    <div region="west" class="west" style="width: 280px;min-width:280px; height: 100%; background-color: #fff;border-right: 1px solid #e2e8f0;">\r\n        \x3c!-- 菜单树 --\x3e\r\n        <perfect-scrollbar style="position: relative; width: 280px; height: 100%;">\r\n            <farris-treetable #tt [data]="allAppTreeData" [idField]="appIdField" [striped]="false" [findField]="\'name\'"\r\n                [singleSelect]="true" [showIcon]="true" [showFilterBar]="false" [selectOnCheck]="true"\r\n                (nodeSelected)="treeNodeClicked($event)"\r\n                [checkOnSelect]="true" [sortName]="\'name\'" [sortOrder]="\'asc\'" [remoteSort]="false">\r\n                <ng-template farrisTemplate="body" let-rowNode let-treeNode="node" let-rowData="rowData">\r\n                    <tr #row="row" [selectRow]="rowNode" [selectRowDisabled]="!rowNode.node.selectable" [dblclick]="true">\r\n                        <td style="border: 0; cursor: pointer;" [style.color]="row.selectRowDisabled? \'#595959\': \'#000000\'">\r\n                            <farris-treeTableToggler [rowNode]="rowNode"></farris-treeTableToggler>\r\n                            <span [innerHTML]="rowData[\'name\'] | highlight: tt.findValue: \'name\' : \'name\'"></span>\r\n                        </td>\r\n                    </tr>\r\n                </ng-template>\r\n            </farris-treetable>\r\n        </perfect-scrollbar>\r\n    </div>\r\n\r\n    \x3c!-- main --\x3e\r\n    <div region="center" class="center flex-fill public-menu-main" style="color: #000000; overflow: auto;">\r\n\r\n        <div class="mengbanban" *ngIf="showMask" style="\r\n            position: absolute;\r\n            z-index: 10;\r\n            top: 0;\r\n            width: 100%;\r\n            height: 100%;\r\n            opacity: 0.5;\r\n            background: #fff;\r\n            display: block;\r\n            font-size: 40px;\r\n        "><h1 style="\r\n            margin-top: 145px;\r\n            color: #000;\r\n            margin-left: 20px;\r\n        ">← {{ \'publishmenu.app.message.info\' | locale }}</h1></div>\r\n\r\n        <div class="row" style="margin: 10px 15px;">\r\n            <div class="col-12">\r\n                <div class="form-group">\r\n                    <label for="txtAppCode">{{ \'publishmenu.app.id\' | locale }}</label>\r\n                    <input type="text" disabled [ngModel]="appModel.id" class="form-control" id="txtappid">\r\n                </div>\r\n                <div class="form-group">\r\n                    <label for="txtAppCode"><span class="farris-label-info text-danger">*</span>{{ \'publishmenu.app.code\' | locale }}</label>\r\n                    <input type="text" class="form-control" [(ngModel)]="appModel.code" id="txtAppCode" >\r\n                </div>\r\n                <div class="form-group">\r\n                    <label for="txtAppName"><span class="farris-label-info text-danger">*</span>{{ \'publishmenu.app.name\' | locale }}</label>\r\n                    <input type="text" class="form-control" id="txtAppName"  [(ngModel)]="appModel.name">\r\n                </div>\r\n                <div class="form-group">\r\n                    <label for="txtAppAction"><span class="farris-label-info text-danger">*</span>{{ \'publishmenu.app.path\' | locale }}</label>\r\n                    <input type="text" class="form-control" id="txtAppAction" [(ngModel)]="appModel.url">\r\n                </div>\r\n                <div class="form-group">\r\n                    <label for="txtAppRemark">{{ \'publishmenu.app.remark\' | locale }}</label>\r\n                    <input type="text" class="form-control" [(ngModel)]="appModel.description">\r\n                </div>\r\n                <div class="form-group">\r\n                    <label for="txtAppRemark"><span class="farris-label-info text-danger">*</span>{{ \'publishmenu.app.entry\' | locale }}</label>\r\n                    <table class="table table-bordered">\r\n                        <colgroup>\r\n                            <col width="50">\r\n                            <col width="50">\r\n                            <col width="50">\r\n                            <col width="30">\r\n                        </colgroup>\r\n                        <thead>\r\n                            <tr>\r\n                                <td>\r\n                                    {{ \'publishmenu.app.entryname\' | locale }}\r\n                                </td>\r\n                                <td>\r\n                                    {{ \'publishmenu.app.entrycode\' | locale }}\r\n                                </td>\r\n                                <td>\r\n                                    {{ \'publishmenu.app.routeid\' | locale }}\r\n                                </td>\r\n                                <td align="center">\r\n                                    {{ \'publishmenu.app.action\' | locale }}\r\n                                </td>\r\n                            </tr>\r\n                        </thead>\r\n                        <tbody>\r\n                            <tr *ngFor="let n of appModel.appInvoks">\r\n                                <td>\r\n                                    <input type="text" [(ngModel)]="n.name" class="form-control">\r\n                                </td>\r\n                                <td>\r\n                                    <input type="text" class="form-control" [(ngModel)]="n.code" >\r\n                                </td>\r\n                                <td>\r\n                                    <input type="text" class="form-control" [(ngModel)]="n.appEntrance" >\r\n                                </td>\r\n                                <td style="padding-left: 0; padding-right: 0; text-align: center">\r\n                                    <button type="button" (click)="removeInvoke(n.id)" class="btn">\r\n                                        <span class="k-icon k-i-minus"></span></button>\r\n                                </td>\r\n                            </tr>\r\n                        </tbody>\r\n                        <tfoot>\r\n                            <tr>\r\n                                <td colspan="4">\r\n                                    <button type="button" (click)="addInvoke()" class="btn btn-primary">\r\n                                        <span class="k-icon k-i-plus"></span> {{ \'publishmenu.app.addentry\' | locale }}</button>\r\n                                </td>\r\n                            </tr>\r\n                        </tfoot>\r\n                    </table>\r\n\r\n                </div>\r\n\r\n            </div>\r\n        </div>\r\n\r\n    </div>\r\n</div>'}]}],y.ctorParameters=function(){return[{type:u.HttpService},{type:s.Injector},{type:s.NgZone},{type:a.MessagerService}]},y.propDecorators={serverIp:[{type:s.Input}],path:[{type:s.Input}]},y);function y(e,t,r,n){this.http=e,this.injector=t,this.ngZone=r,this.messagerSer=n,this.serverIp="",this.path="",this.allAppTreeData=[],this.appIdField="id",this.showMask=!0,this.appModel={appInvoks:[],code:"",creator:"",description:"",id:this.uuid(),layer:"4",name:"",parentId:"",url:""},this.localeSer=this.injector.get(b.LocaleService,null)}var x=(Object.defineProperty(I.prototype,"BIZ_OBJECT_URI",{get:function(){return this.serverIp+"/api/dev/main/v1.0/business-objects"},enumerable:!0,configurable:!0}),Object.defineProperty(I.prototype,"FUNCTION_OPERATORS_URI",{get:function(){return this.serverIp+"/api/runtime/sys/v1.0/funcOperations/all"},enumerable:!0,configurable:!0}),Object.defineProperty(I.prototype,"bizObjectId",{get:function(){return this.tt.selectedRow?this.tt.selectedRow:""},enumerable:!0,configurable:!0}),Object.defineProperty(I.prototype,"bizOpId",{get:function(){return this.grid.selectedRow?this.grid.selectedRow:""},enumerable:!0,configurable:!0}),I.prototype.ngOnInit=function(){this.initTreeData(),this.columns=[{title:this.localeSer.getValue("publishmenu.app.column.code"),field:"code",width:200},{title:this.localeSer.getValue("publishmenu.app.column.name"),field:"name",width:150}]},I.prototype.treeNodeClicked=function(t){if(this.grid.clearAll(),this.items=this.allOperators.filter(function(e){return e.businessId===t.node.data.id}),this.funcModel&&Object.keys(this.funcModel).length){var e=this.funcModel.bizOpId;if(!e)return;this.grid.selectRow(e,!1)}},I.prototype.treeNodeUnSelect=function(){this.items=this.allOperators},I.prototype.initTreeData=function(){var r=this;this.http.get(this.BIZ_OBJECT_URI).subscribe(function(e){e&&(r.treeData=r.convert2TreeNodes(e),setTimeout(function(){if(r.funcModel&&Object.keys(r.funcModel).length){var e=r.funcModel.bizObjectId;if(!e)return;var t=r.tt.findRowNode(e);t&&t.parents.forEach(function(e){r.tt.expandNode(e)}),r.selectBizObjectId=e}},200))}),this.http.get(this.FUNCTION_OPERATORS_URI).subscribe(function(e){e&&(r.items=e.filter(function(e){return 0===e.type}),r.allOperators=n.cloneDeep(r.items))})},I.prototype.convert2TreeNodes=function(r,n){var a=this;return void 0===n&&(n=null),r.length?r.filter(function(e){return e.parentID===n}).map(function(e){var t={data:e,children:[],expanded:null===n,selectable:1===Number(e.isDetail)};return t.children=a.convert2TreeNodes(r,e.id),t}):[]},I.decorators=[{type:s.Component,args:[{selector:"bizobj-operators",template:'<div class="d-flex flex-row" style="width: 760px; height: 400px;border:0px solid #ae00e6">\r\n        \x3c!-- Left --\x3e\r\n        <div region="west" class="west" style="width: 280px;min-width:280px; height: 100%; background-color: #fff;border-right: 1px solid #e2e8f0;">\r\n            \x3c!-- 菜单树 --\x3e\r\n            <perfect-scrollbar style="position: relative; width: 280px; height: 100%;">\r\n                <farris-treetable #tt [data]="treeData" [idField]="\'id\'" [striped]="false" [findField]="\'name\'"\r\n                    [singleSelect]="true" [showIcon]="true" [showFilterBar]="false" [selectOnCheck]="true"\r\n                    (nodeSelected)="treeNodeClicked($event)" [keepSelect]="true"\r\n                    (nodeUnSelect)="treeNodeUnSelect()"\r\n                    [selectValue]="selectBizObjectId"\r\n                    [checkOnSelect]="true" [sortName]="\'name\'" [sortOrder]="\'asc\'" [remoteSort]="false">\r\n                    <ng-template farrisTemplate="body" let-rowNode let-treeNode="node" let-rowData="rowData">\r\n                        <tr #row="row" [selectRow]="rowNode" [selectRowDisabled]="!rowNode.node.selectable" [dblclick]="true">\r\n                            <td style="border: 0; cursor: pointer;" [style.color]="row.selectRowDisabled? \'#595959\': \'#000000\'">\r\n                                <farris-treeTableToggler [rowNode]="rowNode"></farris-treeTableToggler>\r\n                                <span [innerHTML]="rowData[\'name\'] | highlight: tt.findValue: \'name\' : \'name\'"></span>\r\n                            </td>\r\n                        </tr>\r\n                    </ng-template>\r\n                </farris-treetable>\r\n            </perfect-scrollbar>\r\n        </div>\r\n    \r\n        \x3c!-- main --\x3e\r\n        <div region="center" class="center f-utils-fill ">\r\n    \r\n            <farris-datagrid [sizeType]="\'md\'" [fitColumns]="true"\r\n                [columns]="columns" [fit]="true" \r\n                [showCheckbox]="true"\r\n                [selectOnCheck]="true" [checkOnSelect]="true"\r\n                [pagination]="false" #grid\r\n                [data]="items">\r\n            </farris-datagrid>\r\n    \r\n        </div>\r\n    </div>'}]}],I.ctorParameters=function(){return[{type:u.HttpService},{type:s.Injector},{type:s.NgZone}]},I.propDecorators={serverIp:[{type:s.Input}],grid:[{type:s.ViewChild,args:["grid"]}],tt:[{type:s.ViewChild,args:["tt"]}]},I);function I(e,t,r){this.http=e,this.injector=t,this.ngZone=r,this.serverIp="",this.treeData=[],this.columns=[],this.items=[],this.allOperators=[],this.funcModel={},this.selectBizObjectId="",this.selectBizOpId="",this.localeSer=this.injector.get(b.LocaleService,null)}var w=(Object.defineProperty(k.prototype,"APP_URI",{get:function(){return this.serverIp+"/api/runtime/sys/v1.0/gspapp/all"},enumerable:!0,configurable:!0}),Object.defineProperty(k.prototype,"appId",{get:function(){return this.tt&&this.tt.selectedRow?this.tt.selectedRow.data.id:""},enumerable:!0,configurable:!0}),Object.defineProperty(k.prototype,"appInvokId",{get:function(){return this.grid&&this.grid.selectedRow?this.grid.selectedRow.id:""},enumerable:!0,configurable:!0}),k.prototype.ngOnInit=function(){this.initTreeData(),this.columns=[{title:this.localeSer.getValue("publishmenu.app.column.code"),field:"code",width:200},{title:this.localeSer.getValue("publishmenu.app.column.name"),field:"name",width:150}]},k.prototype.treeNodeClicked=function(e){var t=this;this.items=e.node.data.appInvoks||[],setTimeout(function(){if(t.funcModel&&Object.keys(t.funcModel).length){var e=t.funcModel.appInvokId;if(!e)return;t.grid.selectRow(e,!1)}},100)},k.prototype.initTreeData=function(){var r=this;this.http.get(this.APP_URI).subscribe(function(e){e&&(r.treeData=r.convert2TreeNodes(e),setTimeout(function(){if(r.funcModel&&Object.keys(r.funcModel).length){var e=r.funcModel.appId;if(!e)return;var t=r.tt.findRowNode(e);t&&t.parents.forEach(function(e){r.tt.expandNode(e)}),r.selectedAppID=e}},200))})},k.prototype.convert2TreeNodes=function(r,n){var a=this;return void 0===n&&(n=""),r.length?r.filter(function(e){var t=e.parentId;return t!==undefined&&null!==t||(t=""),t===n}).map(function(e){var t={data:e,children:[],selectable:"4"===e.layer};return t.children=a.convert2TreeNodes(r,e.id),t}):[]},k.decorators=[{type:s.Component,args:[{selector:"select-app",template:'<div class="d-flex flex-row" style="width: 760px; height: 400px;border:0px solid #ae00e6">\r\n        \x3c!-- Left --\x3e\r\n        <div region="west" class="west" style="width: 280px;min-width:280px; height: 100%; background-color: #fff;border-right: 1px solid #e2e8f0;">\r\n            \x3c!-- 菜单树 --\x3e\r\n            <perfect-scrollbar style="position: relative; width: 280px; height: 100%;">\r\n                <farris-treetable #tt [data]="treeData" [idField]="\'id\'" [striped]="false" [findField]="\'name\'"\r\n                    [singleSelect]="true" [showIcon]="true" [showFilterBar]="false" [selectOnCheck]="true"\r\n                    (nodeSelected)="treeNodeClicked($event)"\r\n                    [selectValue]="selectedAppID"\r\n                    [checkOnSelect]="true" [sortName]="\'name\'" [sortOrder]="\'asc\'" [remoteSort]="false">\r\n                    <ng-template farrisTemplate="body" let-rowNode let-treeNode="node" let-rowData="rowData">\r\n                        <tr #row="row" [selectRow]="rowNode" [selectRowDisabled]="!rowNode.node.selectable" [dblclick]="true">\r\n                            <td style="border: 0; cursor: pointer;" [style.color]="row.selectRowDisabled? \'#595959\': \'#000000\'">\r\n                                <farris-treeTableToggler [rowNode]="rowNode"></farris-treeTableToggler>\r\n                                <span [innerHTML]="rowData[\'name\'] | highlight: tt.findValue: \'name\' : \'name\'"></span>\r\n                            </td>\r\n                        </tr>\r\n                    </ng-template>\r\n                </farris-treetable>\r\n            </perfect-scrollbar>\r\n        </div>\r\n    \r\n        \x3c!-- main --\x3e\r\n        <div region="center" class="center f-utils-fill " >\r\n    \r\n            <farris-datagrid [sizeType]="\'md\'" [fitColumns]="true"\r\n                [columns]="columns" [fit]="true" \r\n                [showCheckbox]="true"\r\n                [selectOnCheck]="true" [checkOnSelect]="true"\r\n                [pagination]="false" #grid\r\n                [data]="items">\r\n            </farris-datagrid>\r\n    \r\n        </div>\r\n    </div>'}]}],k.ctorParameters=function(){return[{type:u.HttpService},{type:s.Injector},{type:s.NgZone}]},k.propDecorators={serverIp:[{type:s.Input}],grid:[{type:s.ViewChild,args:["grid"]}],tt:[{type:s.ViewChild,args:["tt"]}]},k);function k(e,t,r){this.http=e,this.injector=t,this.ngZone=r,this.serverIp="",this.treeData=[],this.funcModel={},this.columns=[],this.items=[],this.selectedAppID="",this.localeSer=this.injector.get(b.LocaleService,null)}var M={"zh-CHS":{publishmenu:{app:{id:"应用标识",code:"应用编号",name:"应用名称",path:"部署路径",remark:"应用描述",entry:"应用入口",entryname:"入口名称",entrycode:"入口编号",routeid:"路由标识",action:"操作",addentry:"新增入口",message:{info:"选择上级应用",appInvoks:"请设置应用入口信息",inValidInvoks:"应用入口点信息不完整，请检查",appcode:"应用编号不能为空!<br>",appname:"应用名称不能为空!<br>",url:"部署路径不能为空!<br>",invoksCode:"入口名称不能为空!<br>",invoksName:"入口编号不能为空!<br>",invoksAppEntrance:"路由标识不能为空!<br>"},column:{code:"编号",name:"名称"}},func:{id:"功能标识",code:"功能编号",name:"功能名称",action:"功能操作",selectBiz:"选择",remark:"功能描述",selectapp:"选择",addapp:"新建",linkapp:"关联应用",appentry:"应用入口",appParam:"参数设置",paramName:"参数名称",paramValue:"参数值",paramAction:"操作",addParam:"新增参数",placeholder:{code:"请输入功能编号",name:"请输入功能名称",biz:"选择业务对象操作",remark:"请输入功能描述",selectapp:"选择应用"},message:{info:"选择上级菜单",code:"功能编号不能为空！<br>",name:"功能名称不能为空！<br>",parentId:"请在左侧选择上级菜单！<br>",appid:"请选择关联应用！<br>",appInvokId:"请选择关联应用入口！<br>",bizObjectId:"请选择左侧业务操作对象！ <br>",bizOpId:"请选择功能操作！ <br>"}},dialog:{title:"发布新菜单",btnOk:"确定",btnCancel:"取消",success:"新菜单发布成功！",selectapp:"选择关联应用",selectInfo:"请选择应用",appentry:"请选择应用入口",bizOptitle:"选择业务操作",bizwarn:"请选择左侧业务操作对象",bizaction:"请选择业务操作",app:"应用管理"},line:"第 {line} 行"}},"zh-CHT":{publishmenu:{app:{id:"應用標識",code:"應用編號",name:"應用名稱",path:"部署路徑",entry:"應用入口",entryname:"入口名稱",entrycode:"入口編號",routeid:"路由標識",remark:"應用描述",action:"操作",addentry:"新增入口",message:{info:"選擇上級應用",appInvoks:"請設置應用入口信息",inValidInvoks:"應用入口信息不完整，請檢查",appcode:"應用編號不能為空！<br>",appname:"應用名稱不能為空！<br>",url:"部署路徑不能為空！<br>",invoksCode:"入口名稱不能為空！<br>",invoksName:"入口編號不能為空！<br>",invoksAppEntrance:"路由標識不能為空！<br>"},column:{code:"編號",name:"名稱"}},func:{id:"功能標識",code:"功能編號",name:"功能名稱",action:"功能操作",selectBiz:"選擇",remark:"功能描述",selectapp:"選擇",addapp:"新建",linkapp:"關聯應用",appentry:"應用入口",appParam:"參數設置",paramName:"參數名稱",paramValue:"參數值",paramAction:"操作",addParam:"新增參數",placeholder:{code:"請輸入功能編號",name:"請輸入功能名稱",biz:"選擇業務對象操作",remark:"請輸入功能描述",selectapp:"選擇應用"},message:{info:"選擇上級菜單",code:"功能編號不能為空！<br>",name:"功能名稱不能為空！<br>",parentId:"請在左側選擇上級菜單！<br>",appid:"請選擇關聯應用！<br>",appInvokId:"請選擇關聯應用入口！<br>",bizObjectId:"請選擇左側業務操作對象！ <br>",bizOpId:"請選擇功能操作！ <br>"}},dialog:{title:"發布新菜單",btnOk:"確定",btnCancel:"取消",success:"新菜單發布成功！",selectapp:"選擇關聯應用",selectInfo:"請選擇應用",appentry:"請選擇應用入口",bizOptitle:"選擇業務操作",bizwarn:"請選擇左側業務操作對象",bizaction:"請選擇業務操作",app:"應用管理"},line:"第 {line} 行"}},en:{publishmenu:{app:{id:"AppId",code:"AppCode",name:"AppName",path:"DeploymentPayh",entry:"ProtalSettings",entryname:"Protal Name",entrycode:"Protal Code",routeid:"RoutingID",action:"Operation",remark:"AppDesc",addentry:"New Protal",message:{info:"Please select parent.<br>",appInvoks:"Please set app protal.<br>",inValidInvoks:"Please check the protal info.<br>",appcode:"The App Code should not be empty.<br>",appname:"The App Name should not be empty.<br>",url:"The Url should not be empty.<br>",invoksCode:"Entry name cannot be empty.<br>",invoksName:"Entrance number cannot be empty.<br>",invoksAppEntrance:"Route ID cannot be empty.<br>"},column:{code:"Code",name:"Name"}},func:{id:"Function ID",code:"Function code",name:"Function name",action:"Function operation",selectBiz:"Select",remark:"Function description",selectapp:"Select App",addapp:"New App",linkapp:"Invoke information",appentry:"ProtalSettings",appParam:"Static params setting",paramName:"Param Name",paramValue:"Param Value",paramAction:"\tOperation",addParam:"Add new params",placeholder:{code:"Function code",name:"Function Name",biz:"Please Select Business Type.",remark:"Function description",selectapp:"Select App"},message:{info:"Please aelect a parent menu.",code:"The function Code should not be empty！<br>",name:"The function Name should not be empty！<br>",parentId:"Please select the upper menu on the left！<br>",appid:"Please select the associated application！<br>",appInvokId:"Please select the associated application portal！<br>",bizObjectId:"Please select the business operation object on the left！ <br>",bizOpId:"Please select function operation！ <br>"}},dialog:{title:"New menu publish",btnOk:"OK",btnCancel:"Cancel",success:"New menu publish success！",selectapp:"Select associated application",selectInfo:"Please select a application.",appentry:"Please select an application portal.",bizOptitle:"Select business operation.",bizwarn:"Please select the business operation object on the left.",bizaction:"Please select business operation.",app:"Application Manager"},line:"Line {line} "}}},S=(Object.defineProperty(O.prototype,"FUNC_URI",{get:function(){return this.serverIp+"/api/runtime/sys/v1.0/functions/allFuncs"},enumerable:!0,configurable:!0}),Object.defineProperty(O.prototype,"APP_URI",{get:function(){return this.serverIp+"/api/runtime/sys/v1.0/gspapp/all"},enumerable:!0,configurable:!0}),Object.defineProperty(O.prototype,"APP_POST_URI",{get:function(){return this.serverIp+"/api/runtime/sys/v1.0/gspapp"},enumerable:!0,configurable:!0}),Object.defineProperty(O.prototype,"FUNC_POST_URI",{get:function(){return this.serverIp+"/api/runtime/sys/v1.0/functions"},enumerable:!0,configurable:!0}),O.prototype.ngOnInit=function(){},O.prototype.ngOnChanges=function(e){},O.prototype.emptyData=function(){this.funcModel={appId:"",appInvokId:"",bizObjectId:"",bizOpId:"",code:"",creator:"",description:"",funcType:"4",id:this.uuid.generate(),icon:"",isDetail:!0,isDisplayed:!0,isSysInit:!1,layer:"4",menuType:"1",name:"",parentId:"",path:"",staticParams:[{name:"mode",value:"spa"}],url:"",nameLanguage:null}},O.prototype.validate=function(){var e="";return this.funcModel.parentId||(e+=this.localeSer.getValue("publishmenu.func.message.parentId")),e||(this.funcModel.code||(e+=this.localeSer.getValue("publishmenu.func.message.code")),this.funcModel.name||(e+=this.localeSer.getValue("publishmenu.func.message.name")),this.funcModel.bizOpId||(e+=this.localeSer.getValue("publishmenu.func.message.bizOpId")),this.funcModel.appId||(e+=this.localeSer.getValue("publishmenu.func.message.appid")),this.funcModel.appInvokId||(e+=this.localeSer.getValue("publishmenu.func.message.appInvokId"))),!e||(this.messagerSer.show("warning",e,{safeHtml:!1,height:300}),!1)},O.prototype.saveMenu=function(){if(this.funcModel.name=this.funcModel.nameLanguage?this.funcModel.nameLanguage[this.localeId]:"",this.validate()){var e=JSON.stringify(this.funcModel.staticParams),t=n.cloneDeep(this.funcModel);return t.staticParams=e,t.name=t.nameLanguage[this.localeId],this.http.post(this.FUNC_POST_URI,t)}return r.of(!1)},O.prototype.show=function(){var n=this,t=this.modalService.show(this.dlgContent,{title:this.localeSer.getValue("publishmenu.dialog.title"),width:760,height:500,showMaxButton:!1,resizable:!1,enableScroll:!1,buttons:[{text:this.localeSer.getValue("publishmenu.dialog.btnOk"),cls:"btn btn-primary",handle:function(){n.saveMenu().subscribe(function(e){e&&(n.messagerSer.success(n.localeSer.getValue("publishmenu.dialog.success")),t.close(),n.showMask=!0)},function(e){if(console.error(e),e){var t=e.error;if(t){var r=t.Message;n.messagerSer.warning(r)}}})}},{text:this.localeSer.getValue("publishmenu.dialog.btnCancel"),cls:"btn btn-secondary",handle:function(){t.close(),n.showMask=!0}}],opened:function(){n.initAllFuncTree()}});return this.emptyData(),t},O.prototype.showSelectAppModal=function(){var r=this,n=this.modalService.show(w,{title:this.localeSer.getValue("publishmenu.dialog.selectapp"),width:760,height:500,enableScroll:!1,showMaxButton:!1,resizable:!1,initialState:{serverIp:this.serverIp,funcModel:this.funcModel},buttons:[{text:this.localeSer.getValue("publishmenu.dialog.btnOk"),cls:"btn btn-primary",handle:function(){var e=n.content,t="";e.appId&&e.appInvokId&&(r.funcModel.appId=e.appId,r.funcModel.appInvokId=e.appInvokId,t=""),e.appId?e.appInvokId||(t=r.localeSer.getValue("publishmenu.dialog.appentry")):t=r.localeSer.getValue("publishmenu.dialog.selectInfo"),t?r.messagerSer.warning(t):n.close()}},{text:this.localeSer.getValue("publishmenu.dialog.btnCancel"),cls:"btn btn-secondary",handle:function(){n.close()}}]});return n},O.prototype.showBizObjectOperatorModal=function(){var a=this,o=this.modalService.show(x,{title:this.localeSer.getValue("publishmenu.dialog.bizOptitle"),width:760,height:500,enableScroll:!1,showMaxButton:!1,resizable:!1,initialState:{serverIp:this.serverIp,funcModel:this.funcModel},buttons:[{text:this.localeSer.getValue("publishmenu.dialog.btnOk"),cls:"btn btn-primary",handle:function(){var e=o.content,t=e.bizObjectId,r=e.bizOpId;if(r){var n="";(n=t?t.id:r.data.businessId)?(a.funcModel.bizObjectId=n,a.funcModel.bizOpId=r.id,o.close()):a.messagerSer.warning(a.localeSer.getValue("publishmenu.dialog.bizwarn"))}else a.messagerSer.warning(a.localeSer.getValue("publishmenu.dialog.bizaction"))}},{text:this.localeSer.getValue("publishmenu.dialog.btnCancel"),cls:"btn btn-secondary",handle:function(){o.close()}}]});return o},O.prototype.showAppModal=function(){var r=this,n=this.modalService.show(v,{title:this.localeSer.getValue("publishmenu.dialog.app"),width:760,height:500,showMaxButton:!1,resizable:!1,enableScroll:!1,initialState:{serverIp:this.serverIp,path:(this.publishPath||"").replace("index.htmlindex.html","index.html"),funcModel:this.funcModel},buttons:[{text:this.localeSer.getValue("publishmenu.dialog.btnOk"),cls:"btn btn-primary",handle:function(){var t=n.content;t.validate()&&(r.loadingSer.show(),r.http.post(r.APP_POST_URI,t.appModel).subscribe(function(e){e&&(r.funcModel.appId=t.appModel.id,r.funcModel.appInvokId=t.appModel.appInvoks[0].id,r.loadingSer.close(),n.close())}))}},{text:this.localeSer.getValue("publishmenu.dialog.btnCancel"),cls:"btn btn-secondary",handle:function(){n.close()}}]});return n},O.prototype.treeNodeClicked=function(e){this.funcModel.parentId=e.node.data.id,this.showMask=!1,this.cd.detectChanges();var t=document.querySelector("#txtFuncCode");t&&(t.click(),t.focus())},O.prototype.removeStaticParams=function(t){this.funcModel.staticParams=this.funcModel.staticParams.filter(function(e){return e.name!==t})},O.prototype.addStaticParams=function(){this.funcModel.staticParams.push({name:"",value:""})},O.prototype.initAllFuncTree=function(){var t=this;this.http.get(this.FUNC_URI).subscribe(function(e){e&&(t.allFuncTreeData=t.convert2TreeNodes(e))})},O.prototype.convert2TreeNodes=function(r,t){var n=this;return void 0===t&&(t="0"),r.length?r.filter(function(e){return e.parentId===t}).map(function(e){var t={data:e,children:[],selectable:"3"===e.layer};return t.children=n.convert2TreeNodes(r,e.id),t}):[]},O.decorators=[{type:s.Component,args:[{selector:"publish-menu",template:'\r\n<ng-template #dlgContent>\r\n\r\n<div class="d-flex flex-row" style="width: 760px; height: 400px;border:0px solid #ae00e6">\r\n    \x3c!-- Left --\x3e\r\n    <div region="west" class="west" style="width: 280px;min-width:280px; height: 100%; background-color: #fff;border-right: 1px solid #e2e8f0;">\r\n        \x3c!-- 菜单树 --\x3e\r\n        <div class="ps" style="position: relative; height: 100%;" [perfectScrollbar]="{}">\r\n            <farris-treetable #tt="treeTable" [data]="allFuncTreeData" [idField]="funcIdField" [striped]="false" [fit]="true"\r\n            [findField]="\'name\'" (nodeSelected)="treeNodeClicked($event)"\r\n            [singleSelect]="true" [showIcon]="true" [showFilterBar]="false" [selectOnCheck]="true" [checkOnSelect]="true">\r\n                <ng-template farrisTemplate="body" let-rowNode let-treeNode="node" let-rowData="rowData" >\r\n                    <tr #row="row" [selectRow]="rowNode" [selectRowDisabled]="!rowNode.node.selectable" [dblclick]="true">\r\n                        <td style="border: 0; cursor: pointer;" [style.color]="row.selectRowDisabled? \'#595959\': \'#000000\'">\r\n                            <farris-treeTableToggler [rowNode]="rowNode"></farris-treeTableToggler>\r\n                            <span [innerHTML]="rowData[\'name\'] | highlight: tt.findValue : \'name\' : \'name\'"></span>\r\n                        </td>\r\n                    </tr>\r\n                </ng-template>\r\n            </farris-treetable>\r\n        </div>\r\n    </div>\r\n\r\n    \x3c!-- main --\x3e\r\n    <div region="center" class="center flex-fill public-menu-main" style="color: #000000;overflow: auto;">\r\n        <div class="mengbanban" *ngIf="showMask" \r\n        style="position: absolute; z-index: 10; top: 0; width: 100%; height: 100%;opacity: 0.5; background: #fff; display: block; font-size: 40px; ">\r\n            <h1 style="margin-top: 145px; color: #000; margin-left: 20px; ">← {{ \'publishmenu.func.message.info\' | locale }}</h1>\r\n        </div>\r\n        <div class="row" style="margin: 10px 15px;">\r\n            <div class="col-12">\r\n                <div class="form-group">\r\n                    <label for="txtFuncId">{{ \'publishmenu.func.id\' | locale: \'功能标识\' }}</label>\r\n                    <input type="text" class="form-control" id="txtFuncId" disabled [ngModel]="funcModel.id">\r\n                </div>\r\n                <div class="form-group">\r\n                    <label for="txtFuncCode"><span class="farris-label-info text-danger">*</span>{{ \'publishmenu.func.code\' | locale: \'功能编号\' }}</label>\r\n                    <input type="text" class="form-control" id="txtFuncCode" [(ngModel)]="funcModel.code">\r\n                </div>\r\n                <div class="form-group">\r\n                    <label for="txtFuncName"><span class="farris-label-info text-danger">*</span>{{ \'publishmenu.func.name\' | locale: \'功能名称\' }}</label>\r\n                    \x3c!-- <input type="text" class="form-control" id="txtFuncName" [(ngModel)]="funcModel.name" > --\x3e\r\n                    <language-textbox \r\n                    [languages]="languages" [(ngModel)]="funcModel.nameLanguage"\r\n                    [enableClear]="false"\r\n                    [readonly]="false"\r\n                    [disabled]="false"\r\n                    [autoFocus]="true"\r\n                    ></language-textbox>\r\n                </div>\r\n                <div class="form-group">\r\n                    <label for="txtFuncAction"><span class="farris-label-info text-danger">*</span>{{ \'publishmenu.func.action\' | locale: \'功能操作\' }}</label>\r\n\r\n                    <div class="input-group">\r\n                        <input type="text" class="form-control" [(ngModel)]="funcModel.bizOpId" readonly >\r\n                        <div class="input-group-append">\r\n                            <button class="btn btn-outline-secondary" (click)="showBizObjectOperatorModal()" type="button">{{ \'publishmenu.func.selectBiz\' | locale: \'选择\' }}</button>\r\n                        </div>\r\n                    </div>\r\n\r\n                </div>\r\n                <div class="form-group">\r\n                    <label for="txtFuncRemark">{{ \'publishmenu.func.remark\' | locale: \'功能描述\' }}</label>\r\n                    <input type="text" class="form-control" id="txtFuncRemark" [(ngModel)]="funcModel.description" >\r\n                </div>\r\n\r\n                <div class="form-group">\r\n                    <label><span class="farris-label-info text-danger">*</span>{{ \'publishmenu.func.linkapp\' | locale: \'关联应用\' }}</label>\r\n                    <div class="input-group">\r\n                        <input type="text" class="form-control" [(ngModel)]="funcModel.appId" readonly>\r\n                        <div class="input-group-append">\r\n                            <button class="btn btn-outline-secondary" type="button" (click)="showSelectAppModal()">{{ \'publishmenu.func.selectapp\' | locale: \'选择\' }}</button>\r\n                            <button class="btn btn-outline-secondary" type="button" (click)="showAppModal()">{{ \'publishmenu.func.addapp\' | locale: \'新建\' }}</button>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                <div class="form-group">\r\n                    <label for="txtappInvokid"><span class="farris-label-info text-danger">*</span>{{ \'publishmenu.func.appentry\' | locale: \'应用入口\' }}</label>\r\n                    <input type="text" class="form-control" id="txtappInvokid" [ngModel]="funcModel.appInvokId" disabled>\r\n                </div>\r\n\r\n                <div class="form-group">\r\n                    <label for="txtAppRemark">{{ \'publishmenu.func.appParam\' | locale: \'参数设置\' }}</label>\r\n                    <table class="table table-bordered">\r\n                        <colgroup>\r\n                            <col width="140">\r\n                            <col width="200">\r\n                            <col width="">\r\n                        </colgroup>\r\n                        <thead>\r\n                            <tr>\r\n                                <td>\r\n                                    {{ \'publishmenu.func.paramName\' | locale: \'参数名称\' }}\r\n                                </td>\r\n                                <td>\r\n                                    {{ \'publishmenu.func.paramValue\' | locale: \'参数值\' }}\r\n                                </td>\r\n                                <td align="center">\r\n                                    {{ \'publishmenu.func.paramAction\' | locale: \'操作\' }}\r\n                                </td>\r\n                            </tr>\r\n                        </thead>\r\n                        <tbody>\r\n                            <tr *ngFor="let n of funcModel.staticParams">\r\n                                <td>\r\n                                    <input type="text" [(ngModel)]="n.name" class="form-control">\r\n                                </td>\r\n                                <td>\r\n                                    <input type="text" class="form-control" [(ngModel)]="n.value" >\r\n                                </td>\r\n                                <td style="padding-left: 0; padding-right: 0; text-align: center">\r\n                                    <button type="button" (click)="removeStaticParams(n.name)" class="btn">\r\n                                        <span class="k-icon k-i-minus"></span></button>\r\n                                </td>\r\n                            </tr>\r\n                        </tbody>\r\n                        <tfoot>\r\n                            <tr>\r\n                                <td colspan="3">\r\n                                    <button type="button" (click)="addStaticParams()" class="btn btn-primary">\r\n                                        <span class="k-icon k-i-plus"></span> {{ \'publishmenu.func.addParam\' | locale: \'新增参数\' }}</button>\r\n                                </td>\r\n                            </tr>\r\n                        </tfoot>\r\n                    </table>\r\n\r\n                </div>\r\n\r\n                <div class="form-group">\r\n                    <label for="txtFuncRemark">ParentId</label>\r\n                    <input type="text" class="form-control" id="txtFuncRemark" [ngModel]="funcModel.parentId" disabled>\r\n                </div>\r\n                    \r\n            </div>\r\n        </div>\r\n\r\n    </div>\r\n</div>\r\n\r\n\r\n</ng-template>',exportAs:"publishMenu",encapsulation:s.ViewEncapsulation.None,styles:["\n        .public-menu-main::-webkit-scrollbar-track-piece{width:8px;background-color:#e2e2e2;}\n        .public-menu-main::-webkit-scrollbar{width:8px;height:6px;}\n        .public-menu-main::-webkit-scrollbar-thumb{height:50px;background:#9fa1a0; cursor:pointer;}\n        .public-menu-main::-webkit-scrollbar-thumb:hover{background:#686868; cursor:pointer\n        "]}]}],O.ctorParameters=function(){return[{type:u.HttpService},{type:s.Injector},{type:o.BsModalService},{type:l.IdService},{type:a.MessagerService},{type:t.LoadingService},{type:s.ChangeDetectorRef}]},O.propDecorators={serverIp:[{type:s.Input}],dlgContent:[{type:s.ViewChild,args:["dlgContent"]}],publishPath:[{type:s.Input}]},O);function O(e,t,r,n,a,o,i){this.http=e,this.injector=t,this.modalService=r,this.uuid=n,this.messagerSer=a,this.loadingSer=o,this.cd=i,this.serverIp="",this.publishPath="",this.allFuncTreeData=[],this.funcIdField="id",this.showMask=!0,this.languages=[{code:"zh-CHS",name:"中文简体"},{code:"en",name:"English"},{code:"zh-CHT",name:"中文繁体"}],this.funcModel=null,this.localeId="zh-CHS",this.commonUtil=this.injector.get(l.CommonUtils),this.localeId=this.injector.get(s.LOCALE_ID,"zh-CHS"),"zh"===this.localeId&&(this.localeId="zh-CHS"),this.localeSer||(this.localeSer=this.injector.get(b.LocaleService,null),this.localeSer?this.localeSer.langData.publishmenu||this.localeSer.setLocaleData(M):this.localeSer=new b.LocaleService(this.localeId,this.commonUtil,M))}var N=(P.decorators=[{type:s.NgModule,args:[{declarations:[S,v,x,w],imports:[i.CommonModule,p.FormsModule,b.LocaleModule.forRoot(M),f.LanguageTextboxModule,l.FarrisCommonModule.forRoot(),d.PerfectScrollbarModule,o.ModalModule.forRoot(),a.MessagerModule.forRoot(),u.CacheModule.forRoot(),t.LoadingModule.forRoot(),u.GSPHttpModule,h.DatagridModule,c.TreeTableModule],entryComponents:[v,x,w],exports:[S,v,x,w]}]}],P);function P(){}e.PublishMenuService=m,e.PublishMenuComponent=S,e.PublishMenuModule=N,e.ɵb=x,e.ɵa=v,e.ɵd=M,e.ɵc=w,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=farris-ide-publish-menu.umd.min.js.map
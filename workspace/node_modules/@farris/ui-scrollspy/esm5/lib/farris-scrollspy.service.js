/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Injectable, NgZone } from '@angular/core';
import { fromEvent, Subject } from 'rxjs';
import { throttleTime, debounceTime } from 'rxjs/operators';
import { animationFrame } from 'rxjs/internal/scheduler/animationFrame';
import * as i0 from "@angular/core";
/**
 * @record
 */
function ScrollElement() { }
if (false) {
    /** @type {?} */
    ScrollElement.prototype.element;
    /** @type {?} */
    ScrollElement.prototype.id;
}
/**
 * @record
 */
function ScrollSpy() { }
if (false) {
    /** @type {?} */
    ScrollSpy.prototype.elements;
    /** @type {?} */
    ScrollSpy.prototype.currentSectionId;
    /** @type {?} */
    ScrollSpy.prototype.subject;
    /** @type {?|undefined} */
    ScrollSpy.prototype.clickChange;
}
/**
 * @record
 */
function ScrollSpies() { }
/**
 * @record
 */
function ScrollFollow() { }
if (false) {
    /** @type {?} */
    ScrollFollow.prototype.element;
    /** @type {?} */
    ScrollFollow.prototype.id;
}
/**
 * @record
 */
function ScrollFollowSpipes() { }
/**
 * @record
 */
function ScrollContents() { }
/**
 * @record
 */
function Offsets() { }
/**
 * @record
 */
function ScrollChange() { }
/**
 * @record
 */
function CurrentId() { }
if (false) {
    /** @type {?} */
    CurrentId.prototype.subject;
    /** @type {?} */
    CurrentId.prototype.idValue;
}
/**
 * @record
 */
function CurrentIdObj() { }
var FarrisScrollSpyService = /** @class */ (function () {
    function FarrisScrollSpyService(ngzone) {
        this.ngzone = ngzone;
        // 监听区块当前时候的样式
        this.scrollSpyPartActiveClsName = 'f-scrollspy-part-active';
        this.fixedTabContainerClsName = 'f-scrollspy-container-fixed';
        this.parentFixedTabContainerClsName = 'f-scrollspy-container-fixed-parent';
        /**
         * 被监听滚动的contents
         */
        this.scrollContents = {};
        /**
         * 被监听滚动的sections
         */
        this.scrollSpies = {};
        /**
         * 监听滚动的锚点部分
         */
        this.scrollFollowSpipes = {};
        this.scrollSpyListFollowTypeChanges = {};
        /**
         * 滚动监听偏移距离
         */
        this.offsets = {};
        /**
         * 默认监听分组名称
         */
        this.defaultId = 'default';
        // currentSectionId: Subject<any> = new Subject();
        this.currentSectionIdObj = {};
        this.scrollChange = {};
    }
    //获取currentid
    //获取currentid
    /**
     * @param {?} groupId
     * @return {?}
     */
    FarrisScrollSpyService.prototype.getCurrentSectionId = 
    //获取currentid
    /**
     * @param {?} groupId
     * @return {?}
     */
    function (groupId) {
        if (!groupId) {
            groupId = this.defaultId;
        }
        return this.currentSectionIdObj[groupId].subject;
        // return this.currentSectionId;
    };
    //滚动变化时改变currentid
    //滚动变化时改变currentid
    /**
     * @param {?} groupId
     * @param {?} value
     * @return {?}
     */
    FarrisScrollSpyService.prototype.setCurrentSectionId = 
    //滚动变化时改变currentid
    /**
     * @param {?} groupId
     * @param {?} value
     * @return {?}
     */
    function (groupId, value) {
        if (!groupId) {
            groupId = this.defaultId;
        }
        this.currentSectionIdObj[groupId].subject.next(value);
        //console.log(this.currentSectionIdObj);
        // this.currentSectionId.next(value);
    };
    //设置不同group组的currentid
    //设置不同group组的currentid
    /**
     * @param {?} groupId
     * @param {?} value
     * @return {?}
     */
    FarrisScrollSpyService.prototype.setCurrentSectionIdObj = 
    //设置不同group组的currentid
    /**
     * @param {?} groupId
     * @param {?} value
     * @return {?}
     */
    function (groupId, value) {
        var _this = this;
        if (!groupId) {
            groupId = this.defaultId;
        }
        if (!this.currentSectionIdObj[groupId]) {
            this.currentSectionIdObj[groupId] = (/** @type {?} */ ({
                subject: new Subject(),
                idValue: value
            }));
        }
        else {
            this.currentSectionIdObj[groupId].idValue = value;
        }
        setTimeout((/**
         * @return {?}
         */
        function () {
            if (_this.scrollFollowSpipes[groupId] && _this.scrollFollowSpipes[groupId].length) {
                /** @type {?} */
                var item = _this.scrollFollowSpipes[groupId].find((/**
                 * @param {?} scrollFollowItem
                 * @return {?}
                 */
                function (scrollFollowItem) {
                    return scrollFollowItem['id'] == _this.currentSectionIdObj[groupId].idValue;
                }));
                if (item) {
                    _this.fScrollFollowClick(groupId, item);
                }
            }
        }), 0);
        // this.fScrollFollowClick(key,follow);
    };
    /**
     * @return {?}
     */
    FarrisScrollSpyService.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        this.scrollSubscription.unsubscribe();
    };
    /**Observer部分 供指令初始化调用 */
    // public getCurrentSection$(scrollSpyId: string = this.defaultId): Observable<string> {
    //   if(scrollSpyId !== ''){
    //     return this.scrollChange[scrollSpyId];
    //   }
    //   else{
    //     return this.scrollChange[this.defaultId];
    //   }
    // }
    /**
     * Observer部分 供指令初始化调用
     * @param {?=} scrollSpyId
     * @return {?}
     */
    // public getCurrentSection$(scrollSpyId: string = this.defaultId): Observable<string> {
    //   if(scrollSpyId !== ''){
    //     return this.scrollChange[scrollSpyId];
    //   }
    //   else{
    //     return this.scrollChange[this.defaultId];
    //   }
    // }
    FarrisScrollSpyService.prototype.updateScrollGroup = /**
     * Observer部分 供指令初始化调用
     * @param {?=} scrollSpyId
     * @return {?}
     */
    // public getCurrentSection$(scrollSpyId: string = this.defaultId): Observable<string> {
    //   if(scrollSpyId !== ''){
    //     return this.scrollChange[scrollSpyId];
    //   }
    //   else{
    //     return this.scrollChange[this.defaultId];
    //   }
    // }
    function (scrollSpyId) {
        if (scrollSpyId === void 0) { scrollSpyId = this.defaultId; }
        /** @type {?} */
        var groupId = scrollSpyId !== '' ? scrollSpyId : this.defaultId;
        if (!this.scrollChange[groupId]) {
            this.scrollChange[groupId] = new Subject();
        }
        return this.scrollChange[groupId];
    };
    /**
     * @private
     * @param {?} eles
     * @param {?} $scrollContainer
     * @param {?} offset
     * @return {?}
     */
    FarrisScrollSpyService.prototype.findMinInToViewElement = /**
     * @private
     * @param {?} eles
     * @param {?} $scrollContainer
     * @param {?} offset
     * @return {?}
     */
    function (eles, $scrollContainer, offset) {
        // 获取信息
        /** @type {?} */
        var scrollInfo = this.getBoundaryInfo($scrollContainer, offset);
        /** @type {?} */
        var len = eles.length;
        // [{el:元素,top:顶,height:高度}]
        /** @type {?} */
        var recordEles = [];
        /** @type {?} */
        var result = [];
        // 判断是否在视口
        /** @type {?} */
        var findInView = false;
        for (var k = 0; k < len; k++) {
            recordEles.push({ id: eles[k].id, top: eles[k].element.offsetTop, height: eles[k].element.offsetHeight });
            // recordEles[k]['ratio']=(recordEles[k]['top']+recordEles[k]['height'])/scrollInfo.contentHeight
        }
        /** @type {?} */
        var minIndex;
        /** @type {?} */
        var temp;
        for (var i = 0; i < len - 1; i++) {
            minIndex = i;
            for (var j = i + 1; j < len; j++) {
                if (recordEles[j].top < recordEles[minIndex].top) { //寻找最小的数
                    minIndex = j; //将最小数的索引保存
                }
            }
            temp = recordEles[i];
            recordEles[i] = recordEles[minIndex];
            recordEles[minIndex] = temp;
        }
        if (scrollInfo.top > scrollInfo.min) {
            // scrollTop 滚动到最后剩下在界面上的元素多个元素不能根据offsetTop来判断，应该显示哪个，按照比例来计算
            /** @type {?} */
            var scrollTopRatio = (scrollInfo.top - scrollInfo.min) / scrollInfo.boundary;
            // 判断top的位置
            //let ratioReferHeight=scrollInfo.boundary+scrollInfo.fixedHeight;
            /** @type {?} */
            var elRatio = 0;
            for (var k = 0; k < len; k++) {
                //recordEles[k]['radio']=(recordEles[k]['top']+recordEles[k]['height']-scrollInfo.min)/ratioReferHeight;
                if (recordEles[k].top - scrollInfo.offset >= scrollInfo.top || recordEles[k].top + recordEles[k].height - scrollInfo.offset > scrollInfo.top) {
                    elRatio = (recordEles[k]['top'] + recordEles[k]['height']) / scrollInfo.contentHeight;
                    if (!findInView && scrollTopRatio <= elRatio) {
                        findInView = true;
                        result.push(recordEles[k].id);
                        break;
                    }
                }
            }
            if (result.length == 0) {
                // 没找到，就返回最大的
                return [recordEles[len - 1].id];
            }
            return [result[0]];
        }
        else {
            // 页面较长时，按照scrollTop和offsetTop比较
            for (var k = 0; k < len; k++) {
                // 小于等于，考虑到容器有内上间距的情况
                if (recordEles[k].top - scrollInfo.offset <= scrollInfo.top && recordEles[k].top + recordEles[k].height - scrollInfo.offset >= scrollInfo.top) {
                    result.push(recordEles[k].id);
                    break;
                }
            }
            if (result.length == 0) {
                // 没找到，就返回最小的
                return [recordEles[0].id];
            }
            return [result[result.length - 1]];
        }
    };
    /**
     * @private
     * @param {?} $scrollContainer
     * @param {?} offset
     * @return {?}
     */
    FarrisScrollSpyService.prototype.getBoundaryInfo = /**
     * @private
     * @param {?} $scrollContainer
     * @param {?} offset
     * @return {?}
     */
    function ($scrollContainer, offset) {
        /** @type {?} */
        var fixedHeight = $scrollContainer.offsetHeight;
        /** @type {?} */
        var realRatio = ($scrollContainer.scrollHeight - fixedHeight) / fixedHeight;
        /** @type {?} */
        var maxRound = Math.ceil(realRatio);
        /** @type {?} */
        var minRound = maxRound - 1 > 0 ? maxRound - 1 : 0;
        // // 上下间距,此处影响比例的计算，试想容器有内上间距，元素的offsetTop不可能为0，但是容器的scrollTop初始为0
        /** @type {?} */
        var scrollContainerPaddingTop = parseFloat(getComputedStyle($scrollContainer, null).paddingTop);
        // let(element.currentStyle? element.currentStyle : window.getComputedStyle(element, null)).height);
        return {
            offset: offset ? offset : scrollContainerPaddingTop,
            top: $scrollContainer.scrollTop,
            bottom: $scrollContainer.scrollTop + fixedHeight,
            fixedHeight: fixedHeight,
            contentHeight: $scrollContainer.scrollHeight,
            min: minRound * fixedHeight,
            boundary: $scrollContainer.scrollHeight - (minRound + 1) * fixedHeight
        }; // 以offsetHeight为度量，记录offsetTop不足一个高度的具体长度,
    };
    /**content部分滚动事件监听 */
    /**
     * content部分滚动事件监听
     * @private
     * @param {?} key
     * @return {?}
     */
    FarrisScrollSpyService.prototype.subscribeScroll = /**
     * content部分滚动事件监听
     * @private
     * @param {?} key
     * @return {?}
     */
    function (key) {
        var _this = this;
        this.ngzone.runOutsideAngular((/**
         * @return {?}
         */
        function () {
            _this.scrollSubscription = fromEvent(_this.scrollContents[key], 'scroll')
                .pipe(debounceTime(100, animationFrame))
                .subscribe((/**
             * @return {?}
             */
            function () {
                if (_this.scrollSpies[key]) {
                    var _a = _this.scrollSpies[key], currentSectionId = _a.currentSectionId, elements = _a.elements, subject_1 = _a.subject;
                    /** @type {?} */
                    var findMinInViewIds = _this.findMinInToViewElement(elements, _this.scrollContents[key], _this.offsets[key]);
                    if (!findMinInViewIds || !findMinInViewIds.length) {
                        return;
                    }
                    /** @type {?} */
                    var topElementId_1 = findMinInViewIds[0];
                    //判断 点击是否是点击引起的滚动
                    if (_this.scrollSpies[key].clickChange) {
                        _this.scrollSpies[key].clickChange = false;
                        return;
                    }
                    else {
                        _this.scrollSpies[key].clickChange = false;
                        if (topElementId_1 !== currentSectionId) {
                            _this.scrollSpies[key].currentSectionId = topElementId_1;
                            _this.ngzone.run((/**
                             * @return {?}
                             */
                            function () {
                                subject_1.next(topElementId_1);
                            }));
                        }
                    }
                }
            }));
        }));
    };
    /**tab部分点击事件监听 */
    /**
     * tab部分点击事件监听
     * @private
     * @param {?} key
     * @return {?}
     */
    FarrisScrollSpyService.prototype.subscribeClick = /**
     * tab部分点击事件监听
     * @private
     * @param {?} key
     * @return {?}
     */
    function (key) {
        var _this = this;
        //Object.keys(this.scrollFollowSpipes).forEach((key:string):void=>{
        if (this.scrollFollowSpipes[key] && this.scrollFollowSpipes[key].length) {
            this.scrollFollowSpipes[key].forEach((/**
             * @param {?} follow
             * @return {?}
             */
            function (follow) {
                fromEvent(follow.element, 'click')
                    .pipe(throttleTime(100))
                    .subscribe((/**
                 * @param {?} event
                 * @return {?}
                 */
                function (event) {
                    event.stopPropagation();
                    _this.fScrollFollowClick(key, follow);
                    // if(this.scrollSpies[key]){
                    //   const { currentSectionId, elements, subject } = this.scrollSpies[key];
                    //   this.scrollSpies[key].clickChange = true;
                    //   if(follow.id !== currentSectionId){
                    //     const topElementInView = elements.find(el => el.id === follow.id);
                    //     if(!topElementInView) { return; }
                    //     this.scrollSpies[key].currentSectionId = follow.id;
                    //     //this.scrollContents[key].offsetTop
                    //     this.scrollContents[key].scrollTop = Math.round(topElementInView.element.offsetTop - this.offsets[key]);
                    //     subject.next(follow.id);
                    //   }
                    // }
                }));
            }));
        }
        //});
    };
    /**
     * @param {?} key
     * @param {?} follow
     * @return {?}
     */
    FarrisScrollSpyService.prototype.fScrollFollowClick = /**
     * @param {?} key
     * @param {?} follow
     * @return {?}
     */
    function (key, follow) {
        if (this.scrollSpies[key]) {
            var _a = this.scrollSpies[key], currentSectionId = _a.currentSectionId, elements = _a.elements, subject = _a.subject;
            this.scrollSpies[key].clickChange = true;
            if (follow.id !== currentSectionId) {
                /** @type {?} */
                var topElementInView = elements.find((/**
                 * @param {?} el
                 * @return {?}
                 */
                function (el) { return el.id === follow.id; }));
                if (!topElementInView) {
                    return;
                }
                this.scrollSpies[key].currentSectionId = follow.id;
                //this.scrollContents[key].offsetTop
                if (this.scrollContents[key]) {
                    // 内容去有滚动
                    this.scrollContents[key].scrollTop = Math.round(topElementInView.element.offsetTop - this.offsets[key] - parseInt(getComputedStyle(this.scrollContents[key]).paddingTop, 10));
                }
                subject.next(follow.id);
            }
        }
    };
    /**添加需要被滚动监听部分 */
    /**
     * 添加需要被滚动监听部分
     * @param {?} element
     * @param {?=} contentId
     * @return {?}
     */
    FarrisScrollSpyService.prototype.addContentElement = /**
     * 添加需要被滚动监听部分
     * @param {?} element
     * @param {?=} contentId
     * @return {?}
     */
    function (element, contentId) {
        if (contentId === void 0) { contentId = this.defaultId; }
        if (contentId !== '') {
            this.scrollContents[contentId] = element;
            this.subscribeScroll(contentId);
        }
        else {
            this.scrollContents[this.defaultId] = element;
            this.subscribeScroll(this.defaultId);
        }
        // 判断是有待改变的状态
        this.updateContainerClsName(contentId);
    };
    /**移除需要被滚动监听部分元素 */
    /**
     * 移除需要被滚动监听部分元素
     * @param {?=} contentId
     * @return {?}
     */
    FarrisScrollSpyService.prototype.removeContentElement = /**
     * 移除需要被滚动监听部分元素
     * @param {?=} contentId
     * @return {?}
     */
    function (contentId) {
        if (contentId === void 0) { contentId = this.defaultId; }
        /** @type {?} */
        var removeId = contentId !== '' ? contentId : this.defaultId;
        delete this.scrollSpies[removeId];
    };
    /**添加滚动监听tab部分元素*/
    /**
     * 添加滚动监听tab部分元素
     * @param {?} element
     * @param {?} followId
     * @param {?=} followContentId
     * @return {?}
     */
    FarrisScrollSpyService.prototype.addFollowElement = /**
     * 添加滚动监听tab部分元素
     * @param {?} element
     * @param {?} followId
     * @param {?=} followContentId
     * @return {?}
     */
    function (element, followId, followContentId) {
        if (followContentId === void 0) { followContentId = this.defaultId; }
        /** @type {?} */
        var groupId = followContentId !== '' ? followContentId : this.defaultId;
        /** @type {?} */
        var follow = {
            element: element,
            id: followId
        };
        if (!this.scrollFollowSpipes[groupId]) {
            this.scrollFollowSpipes[groupId] = [];
        }
        //-------------------------此处没有处理重复ID
        /** @type {?} */
        var follows = this.scrollFollowSpipes[groupId];
        follows.push(follow);
        this.scrollFollowSpipes[groupId] = follows;
        this.subscribeClick(groupId);
    };
    /**移除滚动监听tab部分元素 */
    /**
     * 移除滚动监听tab部分元素
     * @param {?} followId
     * @param {?=} followContentId
     * @return {?}
     */
    FarrisScrollSpyService.prototype.removeFollowElement = /**
     * 移除滚动监听tab部分元素
     * @param {?} followId
     * @param {?=} followContentId
     * @return {?}
     */
    function (followId, followContentId) {
        if (followContentId === void 0) { followContentId = this.defaultId; }
        /** @type {?} */
        var elements = this.scrollFollowSpipes[followContentId].filter((/**
         * @param {?} el
         * @return {?}
         */
        function (el) {
            return el.id !== followId;
        }));
        if (!elements.length) {
            delete this.scrollFollowSpipes[followContentId];
            return;
        }
        this.scrollFollowSpipes[followContentId] = elements;
    };
    /**添加滚动监听锚点部分元素 */
    /**
     * 添加滚动监听锚点部分元素
     * @param {?} element
     * @param {?} scrollId
     * @param {?=} scrollGroupId
     * @return {?}
     */
    FarrisScrollSpyService.prototype.addElement = /**
     * 添加滚动监听锚点部分元素
     * @param {?} element
     * @param {?} scrollId
     * @param {?=} scrollGroupId
     * @return {?}
     */
    function (element, scrollId, scrollGroupId) {
        var _this = this;
        if (scrollGroupId === void 0) { scrollGroupId = this.defaultId; }
        if (!this.scrollSpies[scrollGroupId]) {
            this.scrollSpies[scrollGroupId] = (/** @type {?} */ ({
                elements: [],
                currentSectionId: '',
                subject: new Subject(),
            }));
            this.scrollSpies[scrollGroupId].subject
                .subscribe((/**
             * @param {?} currentSection
             * @return {?}
             */
            function (currentSection) {
                if (_this.scrollChange[scrollGroupId]) {
                    _this.scrollChange[scrollGroupId].next(currentSection);
                }
            }));
        }
        if (this.hasElement(scrollId, scrollGroupId)) {
            return;
        }
        /** @type {?} */
        var el = {
            element: element,
            id: scrollId
        }
        // 加入时，判断是否是当前
        ;
        // 加入时，判断是否是当前
        this.updateScrollSpyActiveClsName(scrollGroupId, el);
        /** @type {?} */
        var elements = this.scrollSpies[scrollGroupId].elements;
        elements.push(el);
        elements.sort((/**
         * @param {?} a
         * @param {?} b
         * @return {?}
         */
        function (a, b) { return b.element.getBoundingClientRect().top - a.element.getBoundingClientRect().top; }));
        this.scrollSpies[scrollGroupId].elements = elements;
    };
    /**移除滚动监听锚点部分元素 */
    /**
     * 移除滚动监听锚点部分元素
     * @param {?} scrollId
     * @param {?=} scrollGroupId
     * @return {?}
     */
    FarrisScrollSpyService.prototype.removeElement = /**
     * 移除滚动监听锚点部分元素
     * @param {?} scrollId
     * @param {?=} scrollGroupId
     * @return {?}
     */
    function (scrollId, scrollGroupId) {
        if (scrollGroupId === void 0) { scrollGroupId = this.defaultId; }
        /** @type {?} */
        var elements = this.scrollSpies[scrollGroupId].elements.filter((/**
         * @param {?} el
         * @return {?}
         */
        function (el) {
            return el.id !== scrollId;
        }));
        if (!elements.length) {
            delete this.scrollSpies[scrollGroupId];
            return;
        }
        this.scrollSpies[scrollGroupId].elements = elements;
    };
    /**判断scrollGroupId 是否有id名为elementId 的元素 */
    /**
     * 判断scrollGroupId 是否有id名为elementId 的元素
     * @private
     * @param {?} elementId
     * @param {?} scrollGroupId
     * @return {?}
     */
    FarrisScrollSpyService.prototype.hasElement = /**
     * 判断scrollGroupId 是否有id名为elementId 的元素
     * @private
     * @param {?} elementId
     * @param {?} scrollGroupId
     * @return {?}
     */
    function (elementId, scrollGroupId) {
        return this.scrollSpies[scrollGroupId].elements.some((/**
         * @param {?} element
         * @return {?}
         */
        function (element) { return element.id === elementId; }));
    };
    /**设置offset */
    /**
     * 设置offset
     * @param {?=} offset
     * @param {?=} contentId
     * @return {?}
     */
    FarrisScrollSpyService.prototype.setOffset = /**
     * 设置offset
     * @param {?=} offset
     * @param {?=} contentId
     * @return {?}
     */
    function (offset, contentId) {
        if (offset === void 0) { offset = 0; }
        if (contentId === void 0) { contentId = this.defaultId; }
        if (contentId !== '') {
            this.offsets[contentId] = offset;
        }
        else {
            this.offsets[this.defaultId] = offset;
        }
    };
    /*ScrollSpy组件(锚点列表区域）初始化预设defaultId */
    /*ScrollSpy组件(锚点列表区域）初始化预设defaultId */
    /**
     * @param {?} groupid
     * @return {?}
     */
    FarrisScrollSpyService.prototype.setGroupId = /*ScrollSpy组件(锚点列表区域）初始化预设defaultId */
    /**
     * @param {?} groupid
     * @return {?}
     */
    function (groupid) {
        if (groupid) {
            this.defaultId = groupid;
        }
    };
    /**
     * @return {?}
     */
    FarrisScrollSpyService.prototype.getGroupId = /**
     * @return {?}
     */
    function () {
        return this.defaultId;
    };
    /*改变 ScrollSpy组件（锚点列表区域）的显示状态时 */
    /*改变 ScrollSpy组件（锚点列表区域）的显示状态时 */
    /**
     * @param {?} groupid
     * @param {?} followTypeData
     * @return {?}
     */
    FarrisScrollSpyService.prototype.changeGroupIdFollowType = /*改变 ScrollSpy组件（锚点列表区域）的显示状态时 */
    /**
     * @param {?} groupid
     * @param {?} followTypeData
     * @return {?}
     */
    function (groupid, followTypeData) {
        this.scrollSpyListFollowTypeChanges[groupid] = followTypeData;
        this.updateContainerClsName(groupid);
    };
    /**
     * @private
     * @param {?} groupid
     * @return {?}
     */
    FarrisScrollSpyService.prototype.updateContainerClsName = /**
     * @private
     * @param {?} groupid
     * @return {?}
     */
    function (groupid) {
        // 没有待更新变化
        if (!this.scrollSpyListFollowTypeChanges.hasOwnProperty(groupid)) {
            return;
        }
        // container并不存在的时候
        if (!this.scrollContents.hasOwnProperty(groupid)) {
            return;
        }
        /** @type {?} */
        var followTypeData = this.scrollSpyListFollowTypeChanges[groupid];
        /** @type {?} */
        var containerEl = this.scrollContents[groupid];
        // Container的Element 
        if (followTypeData['prev'] == 'fixedTab') {
            //移除class
            containerEl.className = containerEl.className.replace(this.fixedTabContainerClsName, '');
            containerEl.parentElement.classList.remove(this.parentFixedTabContainerClsName);
        }
        else if (followTypeData['next'] == 'fixedTab') {
            // 增加class
            containerEl.className += ' ' + this.fixedTabContainerClsName;
            // 给父元素增加高度
            containerEl.parentElement.classList.add(this.parentFixedTabContainerClsName);
        }
        this.scrollSpyListFollowTypeChanges[groupid] = null;
    };
    /**
     * @param {?} groupId
     * @param {?} currentId
     * @return {?}
     */
    FarrisScrollSpyService.prototype.updateScrollSpiesActiveClsName = /**
     * @param {?} groupId
     * @param {?} currentId
     * @return {?}
     */
    function (groupId, currentId) {
        var _this = this;
        // 追加、移除class
        this.scrollSpies[groupId].elements.map((/**
         * @param {?} item
         * @return {?}
         */
        function (item) {
            if (item.id == currentId) {
                // 找到当前
                if (item.element.className.indexOf(_this.scrollSpyPartActiveClsName) < 0) {
                    item.element.className += ' ' + _this.scrollSpyPartActiveClsName;
                }
            }
            else {
                // 其他
                item.element.className = item.element.className.replace(_this.scrollSpyPartActiveClsName, '');
            }
        }));
    };
    /**
     * 当追加ScrollSpy块的时候，判断是否是已经设置的当前
     * @param groupId
     * @param scrollEl
     */
    /**
     * 当追加ScrollSpy块的时候，判断是否是已经设置的当前
     * @private
     * @param {?} groupId
     * @param {?} scrollEl
     * @return {?}
     */
    FarrisScrollSpyService.prototype.updateScrollSpyActiveClsName = /**
     * 当追加ScrollSpy块的时候，判断是否是已经设置的当前
     * @private
     * @param {?} groupId
     * @param {?} scrollEl
     * @return {?}
     */
    function (groupId, scrollEl) {
        // 如果已设置
        if (this.currentSectionIdObj[groupId]) {
            if (this.currentSectionIdObj[groupId]['idValue'] == scrollEl.id) {
                scrollEl.element.className += ' ' + this.scrollSpyPartActiveClsName;
            }
        }
    };
    FarrisScrollSpyService.decorators = [
        { type: Injectable, args: [{
                    providedIn: 'root'
                },] }
    ];
    /** @nocollapse */
    FarrisScrollSpyService.ctorParameters = function () { return [
        { type: NgZone }
    ]; };
    /** @nocollapse */ FarrisScrollSpyService.ngInjectableDef = i0.defineInjectable({ factory: function FarrisScrollSpyService_Factory() { return new FarrisScrollSpyService(i0.inject(i0.NgZone)); }, token: FarrisScrollSpyService, providedIn: "root" });
    return FarrisScrollSpyService;
}());
export { FarrisScrollSpyService };
if (false) {
    /**
     * @type {?}
     * @private
     */
    FarrisScrollSpyService.prototype.scrollSpyPartActiveClsName;
    /**
     * @type {?}
     * @private
     */
    FarrisScrollSpyService.prototype.fixedTabContainerClsName;
    /**
     * @type {?}
     * @private
     */
    FarrisScrollSpyService.prototype.parentFixedTabContainerClsName;
    /**
     * @type {?}
     * @private
     */
    FarrisScrollSpyService.prototype.scrollSubscription;
    /**
     * 被监听滚动的contents
     * @type {?}
     */
    FarrisScrollSpyService.prototype.scrollContents;
    /**
     * 被监听滚动的sections
     * @type {?}
     */
    FarrisScrollSpyService.prototype.scrollSpies;
    /**
     * 监听滚动的锚点部分
     * @type {?}
     */
    FarrisScrollSpyService.prototype.scrollFollowSpipes;
    /**
     * @type {?}
     * @private
     */
    FarrisScrollSpyService.prototype.scrollSpyListFollowTypeChanges;
    /**
     * 滚动监听偏移距离
     * @type {?}
     */
    FarrisScrollSpyService.prototype.offsets;
    /**
     * 默认监听分组名称
     * @type {?}
     */
    FarrisScrollSpyService.prototype.defaultId;
    /** @type {?} */
    FarrisScrollSpyService.prototype.currentSectionIdObj;
    /** @type {?} */
    FarrisScrollSpyService.prototype.scrollChange;
    /** @type {?} */
    FarrisScrollSpyService.prototype.ngzone;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmFycmlzLXNjcm9sbHNweS5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy91aS1zY3JvbGxzcHkvIiwic291cmNlcyI6WyJsaWIvZmFycmlzLXNjcm9sbHNweS5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFhLE1BQU0sRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUM5RCxPQUFPLEVBQUUsU0FBUyxFQUFFLE9BQU8sRUFBNEIsTUFBTSxNQUFNLENBQUM7QUFDcEUsT0FBTyxFQUFFLFlBQVksRUFBRSxZQUFZLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUM1RCxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sd0NBQXdDLENBQUM7Ozs7O0FBRXhFLDRCQUdDOzs7SUFGQyxnQ0FBcUI7O0lBQ3JCLDJCQUFVOzs7OztBQUdaLHdCQUtDOzs7SUFKQyw2QkFBMEI7O0lBQzFCLHFDQUF5Qjs7SUFDekIsNEJBQXlCOztJQUN6QixnQ0FBcUI7Ozs7O0FBR3ZCLDBCQUVDOzs7O0FBRUQsMkJBR0M7OztJQUZDLCtCQUFxQjs7SUFDckIsMEJBQVU7Ozs7O0FBRVosaUNBRUM7Ozs7QUFFRCw2QkFFQzs7OztBQUNELHNCQUVDOzs7O0FBRUQsMkJBRUM7Ozs7QUFFRCx3QkFHQzs7O0lBRkMsNEJBQXlCOztJQUN6Qiw0QkFBZTs7Ozs7QUFFakIsMkJBRUM7QUFFRDtJQTBFRSxnQ0FBbUIsTUFBYztRQUFkLFdBQU0sR0FBTixNQUFNLENBQVE7O1FBckV6QiwrQkFBMEIsR0FBRyx5QkFBeUIsQ0FBQztRQUN2RCw2QkFBd0IsR0FBRyw2QkFBNkIsQ0FBQztRQUN6RCxtQ0FBOEIsR0FBQyxvQ0FBb0MsQ0FBQzs7OztRQUc1RSxtQkFBYyxHQUFtQixFQUFFLENBQUM7Ozs7UUFFcEMsZ0JBQVcsR0FBZ0IsRUFBRSxDQUFDOzs7O1FBRTlCLHVCQUFrQixHQUF1QixFQUFFLENBQUM7UUFDcEMsbUNBQThCLEdBQUcs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LDREQUErRDs7Ozs7SUFDL0QsMERBQWlFOzs7OztJQUNqRSxnRUFBNEU7Ozs7O0lBQzVFLG9EQUF5Qzs7Ozs7SUFFekMsZ0RBQW9DOzs7OztJQUVwQyw2Q0FBOEI7Ozs7O0lBRTlCLG9EQUE0Qzs7Ozs7SUFDNUMsZ0VBQTRDOzs7OztJQUk1Qyx5Q0FBc0I7Ozs7O0lBRXRCLDJDQUE4Qjs7SUFJOUIscURBQXVDOztJQThDdkMsOENBQWdDOztJQUdwQix3Q0FBcUIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlLCBPbkRlc3Ryb3ksIE5nWm9uZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBmcm9tRXZlbnQsIFN1YmplY3QsIE9ic2VydmFibGUsIFN1YnNjcmlwdGlvbiB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQgeyB0aHJvdHRsZVRpbWUsIGRlYm91bmNlVGltZSB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcclxuaW1wb3J0IHsgYW5pbWF0aW9uRnJhbWUgfSBmcm9tICdyeGpzL2ludGVybmFsL3NjaGVkdWxlci9hbmltYXRpb25GcmFtZSc7XHJcblxyXG5pbnRlcmZhY2UgU2Nyb2xsRWxlbWVudCB7XHJcbiAgZWxlbWVudDogSFRNTEVsZW1lbnQsXHJcbiAgaWQ6IHN0cmluZ1xyXG59XHJcblxyXG5pbnRlcmZhY2UgU2Nyb2xsU3B5IHtcclxuICBlbGVtZW50czogU2Nyb2xsRWxlbWVudFtdO1xyXG4gIGN1cnJlbnRTZWN0aW9uSWQ6IHN0cmluZztcclxuICBzdWJqZWN0OiBTdWJqZWN0PHN0cmluZz47XHJcbiAgY2xpY2tDaGFuZ2U/OiBib29sZWFuIC8v5Yik5pat5piv5ZCm5piv54K55Ye75a+86Ie055qE6aG16Z2i5rua5YqoXHJcbn1cclxuXHJcbmludGVyZmFjZSBTY3JvbGxTcGllcyB7XHJcbiAgW3Njcm9sbFNweUlkOiBzdHJpbmddOiBTY3JvbGxTcHlcclxufVxyXG5cclxuaW50ZXJmYWNlIFNjcm9sbEZvbGxvdyB7XHJcbiAgZWxlbWVudDogSFRNTEVsZW1lbnQsXHJcbiAgaWQ6IHN0cmluZ1xyXG59XHJcbmludGVyZmFjZSBTY3JvbGxGb2xsb3dTcGlwZXMge1xyXG4gIFtzY3JvbGxGb2xsb3dJZDogc3RyaW5nXTogU2Nyb2xsRm9sbG93W11cclxufVxyXG5cclxuaW50ZXJmYWNlIFNjcm9sbENvbnRlbnRzIHtcclxuICBbc2Nyb2xsRm9sbG93SWQ6IHN0cmluZ106IEhUTUxFbGVtZW50XHJcbn1cclxuaW50ZXJmYWNlIE9mZnNldHMge1xyXG4gIFtzY3JvbGxGb2xsb3dJZDogc3RyaW5nXTogbnVtYmVyXHJcbn1cclxuXHJcbmludGVyZmFjZSBTY3JvbGxDaGFuZ2Uge1xyXG4gIFtzY3JvbGxGb2xsb3dJZDogc3RyaW5nXTogU3ViamVjdDxhbnk+XHJcbn1cclxuXHJcbmludGVyZmFjZSBDdXJyZW50SWQge1xyXG4gIHN1YmplY3Q6IFN1YmplY3Q8c3RyaW5nPjtcclxuICBpZFZhbHVlOiBzdHJpbmdcclxufVxyXG5pbnRlcmZhY2UgQ3VycmVudElkT2JqIHtcclxuICBbZ3JvdXBJZDogc3RyaW5nXTogQ3VycmVudElkXHJcbn1cclxuXHJcbkBJbmplY3RhYmxlKHtcclxuICBwcm92aWRlZEluOiAncm9vdCdcclxufSlcclxuZXhwb3J0IGNsYXNzIEZhcnJpc1Njcm9sbFNweVNlcnZpY2UgaW1wbGVtZW50cyBPbkRlc3Ryb3kge1xyXG4gIC8vIOebkeWQrOWMuuWdl+W9k+WJjeaXtuWAmeeahOagt+W8j1xyXG4gIHByaXZhdGUgc2Nyb2xsU3B5UGFydEFjdGl2ZUNsc05hbWUgPSAnZi1zY3JvbGxzcHktcGFydC1hY3RpdmUnO1xyXG4gIHByaXZhdGUgZml4ZWRUYWJDb250YWluZXJDbHNOYW1lID0gJ2Ytc2Nyb2xsc3B5LWNvbnRhaW5lci1maXhlZCc7XHJcbiAgcHJpdmF0ZSBwYXJlbnRGaXhlZFRhYkNvbnRhaW5lckNsc05hbWU9J2Ytc2Nyb2xsc3B5LWNvbnRhaW5lci1maXhlZC1wYXJlbnQnO1xyXG4gIHByaXZhdGUgc2Nyb2xsU3Vic2NyaXB0aW9uOiBTdWJzY3JpcHRpb247XHJcbiAgLyoq6KKr55uR5ZCs5rua5Yqo55qEY29udGVudHMgKi9cclxuICBzY3JvbGxDb250ZW50czogU2Nyb2xsQ29udGVudHMgPSB7fTtcclxuICAvKirooqvnm5HlkKzmu5rliqjnmoRzZWN0aW9ucyovXHJcbiAgc2Nyb2xsU3BpZXM6IFNjcm9sbFNwaWVzID0ge307XHJcbiAgLyoq55uR5ZCs5rua5Yqo55qE6ZSa54K56YOo5YiGICovXHJcbiAgc2Nyb2xsRm9sbG93U3BpcGVzOiBTY3JvbGxGb2xsb3dTcGlwZXMgPSB7fTtcclxuICBwcml2YXRlIHNjcm9sbFNweUxpc3RGb2xsb3dUeXBlQ2hhbmdlcyA9IHt9O1xyXG5cclxuXHJcbiAgLyoq5rua5Yqo55uR5ZCs5YGP56e76Led56a7ICovXHJcbiAgb2Zmc2V0czogT2Zmc2V0cyA9IHt9O1xyXG4gIC8qKum7mOiupOebkeWQrOWIhue7hOWQjeensCAqL1xyXG4gIGRlZmF1bHRJZDogc3RyaW5nID0gJ2RlZmF1bHQnO1xyXG5cclxuICAvLyBjdXJyZW50U2VjdGlvbklkOiBTdWJqZWN0PGFueT4gPSBuZXcgU3ViamVjdCgpO1xyXG5cclxuICBjdXJyZW50U2VjdGlvbklkT2JqOiBDdXJyZW50SWRPYmogPSB7fTtcclxuICAvL+iOt+WPlmN1cnJlbnRpZFxyXG4gIGdldEN1cnJlbnRTZWN0aW9uSWQoZ3JvdXBJZDogc3RyaW5nKSB7XHJcbiAgICBpZiAoIWdyb3VwSWQpIHtcclxuICAgICAgZ3JvdXBJZCA9IHRoaXMuZGVmYXVsdElkO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHRoaXMuY3VycmVudFNlY3Rpb25JZE9ialtncm91cElkXS5zdWJqZWN0O1xyXG4gICAgLy8gcmV0dXJuIHRoaXMuY3VycmVudFNlY3Rpb25JZDtcclxuICB9XHJcbiAgLy/mu5rliqjlj5jljJbml7bmlLnlj5hjdXJyZW50aWRcclxuICBzZXRDdXJyZW50U2VjdGlvbklkKGdyb3VwSWQ6IHN0cmluZywgdmFsdWU6IHN0cmluZykge1xyXG4gICAgaWYgKCFncm91cElkKSB7XHJcbiAgICAgIGdyb3VwSWQgPSB0aGlzLmRlZmF1bHRJZDtcclxuICAgIH1cclxuICAgIHRoaXMuY3VycmVudFNlY3Rpb25JZE9ialtncm91cElkXS5zdWJqZWN0Lm5leHQodmFsdWUpO1xyXG4gICAgLy9jb25zb2xlLmxvZyh0aGlzLmN1cnJlbnRTZWN0aW9uSWRPYmopO1xyXG4gICAgLy8gdGhpcy5jdXJyZW50U2VjdGlvbklkLm5leHQodmFsdWUpO1xyXG4gIH1cclxuICAvL+iuvue9ruS4jeWQjGdyb3Vw57uE55qEY3VycmVudGlkXHJcbiAgc2V0Q3VycmVudFNlY3Rpb25JZE9iaihncm91cElkOiBzdHJpbmcsIHZhbHVlOiBzdHJpbmcpIHtcclxuICAgIGlmICghZ3JvdXBJZCkge1xyXG4gICAgICBncm91cElkID0gdGhpcy5kZWZhdWx0SWQ7XHJcbiAgICB9XHJcbiAgICBpZiAoIXRoaXMuY3VycmVudFNlY3Rpb25JZE9ialtncm91cElkXSkge1xyXG4gICAgICB0aGlzLmN1cnJlbnRTZWN0aW9uSWRPYmpbZ3JvdXBJZF0gPSB7XHJcbiAgICAgICAgc3ViamVjdDogbmV3IFN1YmplY3QoKSxcclxuICAgICAgICBpZFZhbHVlOiB2YWx1ZVxyXG4gICAgICB9IGFzIEN1cnJlbnRJZDtcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICB0aGlzLmN1cnJlbnRTZWN0aW9uSWRPYmpbZ3JvdXBJZF0uaWRWYWx1ZSA9IHZhbHVlO1xyXG4gICAgfVxyXG4gICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgIGlmKHRoaXMuc2Nyb2xsRm9sbG93U3BpcGVzW2dyb3VwSWRdICYmIHRoaXMuc2Nyb2xsRm9sbG93U3BpcGVzW2dyb3VwSWRdLmxlbmd0aCl7XHJcbiAgICAgICAgbGV0IGl0ZW0gPSB0aGlzLnNjcm9sbEZvbGxvd1NwaXBlc1tncm91cElkXS5maW5kKHNjcm9sbEZvbGxvd0l0ZW09PntcclxuICAgICAgICAgIHJldHVybiBzY3JvbGxGb2xsb3dJdGVtWydpZCddID09IHRoaXMuY3VycmVudFNlY3Rpb25JZE9ialtncm91cElkXS5pZFZhbHVlO1xyXG4gICAgICAgIH0pXHJcbiAgICAgICAgaWYoaXRlbSl7XHJcbiAgICAgICAgICB0aGlzLmZTY3JvbGxGb2xsb3dDbGljayhncm91cElkLGl0ZW0pO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfSwgMCk7XHJcbiAgICAvLyB0aGlzLmZTY3JvbGxGb2xsb3dDbGljayhrZXksZm9sbG93KTtcclxuICB9XHJcblxyXG5cclxuICBzY3JvbGxDaGFuZ2U6IFNjcm9sbENoYW5nZSA9IHt9O1xyXG5cclxuXHJcbiAgY29uc3RydWN0b3IocHVibGljIG5nem9uZTogTmdab25lKSB7IH1cclxuXHJcbiAgcHVibGljIG5nT25EZXN0cm95KCk6IHZvaWQge1xyXG4gICAgdGhpcy5zY3JvbGxTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcclxuICB9XHJcblxyXG4gIC8qKk9ic2VydmVy6YOo5YiGIOS+m+aMh+S7pOWIneWni+WMluiwg+eUqCAqL1xyXG4gIC8vIHB1YmxpYyBnZXRDdXJyZW50U2VjdGlvbiQoc2Nyb2xsU3B5SWQ6IHN0cmluZyA9IHRoaXMuZGVmYXVsdElkKTogT2JzZXJ2YWJsZTxzdHJpbmc+IHtcclxuICAvLyAgIGlmKHNjcm9sbFNweUlkICE9PSAnJyl7XHJcbiAgLy8gICAgIHJldHVybiB0aGlzLnNjcm9sbENoYW5nZVtzY3JvbGxTcHlJZF07XHJcbiAgLy8gICB9XHJcbiAgLy8gICBlbHNle1xyXG4gIC8vICAgICByZXR1cm4gdGhpcy5zY3JvbGxDaGFuZ2VbdGhpcy5kZWZhdWx0SWRdO1xyXG4gIC8vICAgfVxyXG4gIC8vIH1cclxuXHJcbiAgcHVibGljIHVwZGF0ZVNjcm9sbEdyb3VwKHNjcm9sbFNweUlkOiBzdHJpbmcgPSB0aGlzLmRlZmF1bHRJZCkge1xyXG4gICAgY29uc3QgZ3JvdXBJZCA9IHNjcm9sbFNweUlkICE9PSAnJyA/IHNjcm9sbFNweUlkIDogdGhpcy5kZWZhdWx0SWQ7XHJcbiAgICBpZiAoIXRoaXMuc2Nyb2xsQ2hhbmdlW2dyb3VwSWRdKSB7XHJcbiAgICAgIHRoaXMuc2Nyb2xsQ2hhbmdlW2dyb3VwSWRdID0gbmV3IFN1YmplY3QoKTtcclxuICAgIH1cclxuICAgIHJldHVybiB0aGlzLnNjcm9sbENoYW5nZVtncm91cElkXTtcclxuICB9XHJcbiAgICBwcml2YXRlIGZpbmRNaW5JblRvVmlld0VsZW1lbnQoZWxlcywgJHNjcm9sbENvbnRhaW5lcixvZmZzZXQpe1xyXG4gICAgIC8vIOiOt+WPluS/oeaBr1xyXG4gICAgIGxldCBzY3JvbGxJbmZvPXRoaXMuZ2V0Qm91bmRhcnlJbmZvKCAkc2Nyb2xsQ29udGFpbmVyLG9mZnNldCk7XHJcbiAgICAgICAgICAgICAgXHJcbiAgICAgbGV0IGxlbiA9IGVsZXMubGVuZ3RoO1xyXG4gICAgIC8vIFt7ZWw65YWD57SgLHRvcDrpobYsaGVpZ2h0OumrmOW6pn1dXHJcbiAgICAgbGV0IHJlY29yZEVsZXMgPSBbXTtcclxuICAgICBsZXQgcmVzdWx0PVtdO1xyXG4gICAgIC8vIOWIpOaWreaYr+WQpuWcqOinhuWPo1xyXG4gICAgIGxldCBmaW5kSW5WaWV3ID0gZmFsc2U7XHJcbiAgICAgZm9yICh2YXIgayA9IDA7IGsgPCBsZW47IGsrKykge1xyXG4gICAgICAgcmVjb3JkRWxlcy5wdXNoKHsgaWQ6IGVsZXNba10uaWQsIHRvcDogZWxlc1trXS5lbGVtZW50Lm9mZnNldFRvcCwgaGVpZ2h0OiBlbGVzW2tdLmVsZW1lbnQub2Zmc2V0SGVpZ2h0fSk7XHJcbiAgICAgIC8vIHJlY29yZEVsZXNba11bJ3JhdGlvJ109KHJlY29yZEVsZXNba11bJ3RvcCddK3JlY29yZEVsZXNba11bJ2hlaWdodCddKS9zY3JvbGxJbmZvLmNvbnRlbnRIZWlnaHRcclxuICAgICB9XHJcbiAgICAgICB2YXIgbWluSW5kZXgsIHRlbXA7XHJcbiAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbiAtIDE7IGkrKykge1xyXG4gICAgICAgICAgIG1pbkluZGV4ID0gaTtcclxuICAgICAgICAgICBmb3IgKHZhciBqID0gaSArIDE7IGogPCBsZW47IGorKykge1xyXG4gICAgICAgICAgICAgICBpZiAocmVjb3JkRWxlc1tqXS50b3AgPCByZWNvcmRFbGVzW21pbkluZGV4XS50b3ApIHsvL+Wvu+aJvuacgOWwj+eahOaVsFxyXG4gICAgICAgICAgICAgICAgICAgbWluSW5kZXggPSBqOyAgLy/lsIbmnIDlsI/mlbDnmoTntKLlvJXkv53lrZhcclxuICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgIH1cclxuICAgICAgICAgICB0ZW1wID0gcmVjb3JkRWxlc1tpXTtcclxuICAgICAgICAgICByZWNvcmRFbGVzW2ldID0gcmVjb3JkRWxlc1ttaW5JbmRleF07XHJcbiAgICAgICAgICAgcmVjb3JkRWxlc1ttaW5JbmRleF0gPSB0ZW1wO1xyXG4gICAgICAgfVxyXG4gICAgIGlmKHNjcm9sbEluZm8udG9wPnNjcm9sbEluZm8ubWluKXtcclxuICAgICAgICAgLy8gc2Nyb2xsVG9wIOa7muWKqOWIsOacgOWQjuWJqeS4i+WcqOeVjOmdouS4iueahOWFg+e0oOWkmuS4quWFg+e0oOS4jeiDveagueaNrm9mZnNldFRvcOadpeWIpOaWre+8jOW6lOivpeaYvuekuuWTquS4qu+8jOaMieeFp+avlOS+i+adpeiuoeeul1xyXG4gICAgICAgICBsZXQgc2Nyb2xsVG9wUmF0aW89KHNjcm9sbEluZm8udG9wLXNjcm9sbEluZm8ubWluKS9zY3JvbGxJbmZvLmJvdW5kYXJ5O1xyXG4gICAgICAgICAgICAgICAgLy8g5Yik5patdG9w55qE5L2N572uXHJcbiAgICAgICAgLy9sZXQgcmF0aW9SZWZlckhlaWdodD1zY3JvbGxJbmZvLmJvdW5kYXJ5K3Njcm9sbEluZm8uZml4ZWRIZWlnaHQ7XHJcbiAgICAgICAgbGV0IGVsUmF0aW89MDtcclxuICAgICAgICAgICAgICAgIGZvcih2YXIgaz0wO2s8bGVuO2srKyl7XHJcbiAgICAgICAgICAgIC8vcmVjb3JkRWxlc1trXVsncmFkaW8nXT0ocmVjb3JkRWxlc1trXVsndG9wJ10rcmVjb3JkRWxlc1trXVsnaGVpZ2h0J10tc2Nyb2xsSW5mby5taW4pL3JhdGlvUmVmZXJIZWlnaHQ7XHJcbiAgICAgICAgICAgIGlmKHJlY29yZEVsZXNba10udG9wLXNjcm9sbEluZm8ub2Zmc2V0Pj1zY3JvbGxJbmZvLnRvcHx8cmVjb3JkRWxlc1trXS50b3ArcmVjb3JkRWxlc1trXS5oZWlnaHQtc2Nyb2xsSW5mby5vZmZzZXQ+c2Nyb2xsSW5mby50b3Ape1xyXG4gICAgICAgICAgICAgZWxSYXRpbz0ocmVjb3JkRWxlc1trXVsndG9wJ10rcmVjb3JkRWxlc1trXVsnaGVpZ2h0J10pL3Njcm9sbEluZm8uY29udGVudEhlaWdodDtcclxuICAgICAgICAgICAgIGlmKCFmaW5kSW5WaWV3JiZzY3JvbGxUb3BSYXRpbzw9ZWxSYXRpbyl7XHJcbiAgICAgICAgICAgICAgIGZpbmRJblZpZXc9dHJ1ZTtcclxuICAgICAgICAgICAgICAgcmVzdWx0LnB1c2gocmVjb3JkRWxlc1trXS5pZCk7XHJcbiAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgfVxyXG4gICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICBpZihyZXN1bHQubGVuZ3RoPT0wKXtcclxuICAgICAgICAgLy8g5rKh5om+5Yiw77yM5bCx6L+U5Zue5pyA5aSn55qEXHJcbiAgICAgICAgIHJldHVybiBbcmVjb3JkRWxlc1tsZW4tMV0uaWRdO1xyXG4gICAgICAgfVxyXG4gICAgICAgcmV0dXJuIFtyZXN1bHRbMF1dOyBcclxuICAgICB9ZWxzZXtcclxuICAgICAgIC8vIOmhtemdoui+g+mVv+aXtu+8jOaMieeFp3Njcm9sbFRvcOWSjG9mZnNldFRvcOavlOi+g1xyXG4gICAgICAgZm9yKHZhciBrPTA7azxsZW47aysrKXtcclxuICAgICAgICAgLy8g5bCP5LqO562J5LqO77yM6ICD6JmR5Yiw5a655Zmo5pyJ5YaF5LiK6Ze06Led55qE5oOF5Ya1XHJcbiAgICAgICAgICBpZihyZWNvcmRFbGVzW2tdLnRvcC1zY3JvbGxJbmZvLm9mZnNldDw9c2Nyb2xsSW5mby50b3AmJnJlY29yZEVsZXNba10udG9wK3JlY29yZEVsZXNba10uaGVpZ2h0LXNjcm9sbEluZm8ub2Zmc2V0Pj1zY3JvbGxJbmZvLnRvcCl7XHJcbiAgICAgICAgICAgICByZXN1bHQucHVzaChyZWNvcmRFbGVzW2tdLmlkKTtcclxuICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICB9XHJcbiAgICAgICB9XHJcbiAgICAgICBpZihyZXN1bHQubGVuZ3RoPT0wKXtcclxuICAgICAgICAgLy8g5rKh5om+5Yiw77yM5bCx6L+U5Zue5pyA5bCP55qEXHJcbiAgICAgICAgIHJldHVybiBbcmVjb3JkRWxlc1swXS5pZF07XHJcbiAgICAgICB9ICAgICAgIFxyXG4gICAgICAgcmV0dXJuIFtyZXN1bHRbcmVzdWx0Lmxlbmd0aC0xXV07IFxyXG4gICAgIH0gICAgICAgICAgICAgICAgICAgICAgIFxyXG4gICAgfVxyXG4gIHByaXZhdGUgZ2V0Qm91bmRhcnlJbmZvKCRzY3JvbGxDb250YWluZXIsb2Zmc2V0KXtcclxuICAgIGxldCBmaXhlZEhlaWdodD0kc2Nyb2xsQ29udGFpbmVyLm9mZnNldEhlaWdodDtcclxuICAgIGxldCByZWFsUmF0aW89KCRzY3JvbGxDb250YWluZXIuc2Nyb2xsSGVpZ2h0LWZpeGVkSGVpZ2h0ICkvZml4ZWRIZWlnaHQ7XHJcbiAgICAgICAgbGV0IG1heFJvdW5kPU1hdGguY2VpbChyZWFsUmF0aW8pO1xyXG4gICAgICAgIGxldCBtaW5Sb3VuZD1tYXhSb3VuZC0xPjA/bWF4Um91bmQtMTowO1xyXG4gICAgLy8gLy8g5LiK5LiL6Ze06LedLOatpOWkhOW9seWTjeavlOS+i+eahOiuoeeul++8jOivleaDs+WuueWZqOacieWGheS4iumXtOi3ne+8jOWFg+e0oOeahG9mZnNldFRvcOS4jeWPr+iDveS4ujDvvIzkvYbmmK/lrrnlmajnmoRzY3JvbGxUb3DliJ3lp4vkuLowXHJcbiAgICBsZXQgc2Nyb2xsQ29udGFpbmVyUGFkZGluZ1RvcD1wYXJzZUZsb2F0KGdldENvbXB1dGVkU3R5bGUoJHNjcm9sbENvbnRhaW5lcixudWxsKS5wYWRkaW5nVG9wKTtcclxuICAgIC8vIGxldChlbGVtZW50LmN1cnJlbnRTdHlsZT8gZWxlbWVudC5jdXJyZW50U3R5bGUgOiB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZShlbGVtZW50LCBudWxsKSkuaGVpZ2h0KTtcclxuICAgIHJldHVybiAge1xyXG4gICAgICBvZmZzZXQ6b2Zmc2V0P29mZnNldDpzY3JvbGxDb250YWluZXJQYWRkaW5nVG9wLFxyXG4gICAgICB0b3A6JHNjcm9sbENvbnRhaW5lci5zY3JvbGxUb3AsXHJcbiAgICAgIGJvdHRvbTokc2Nyb2xsQ29udGFpbmVyLnNjcm9sbFRvcCArIGZpeGVkSGVpZ2h0LFxyXG4gICAgICBmaXhlZEhlaWdodDpmaXhlZEhlaWdodCxcclxuICAgICAgY29udGVudEhlaWdodDokc2Nyb2xsQ29udGFpbmVyLnNjcm9sbEhlaWdodCxcclxuICAgICAgbWluOm1pblJvdW5kKmZpeGVkSGVpZ2h0LFxyXG4gICAgICBib3VuZGFyeTokc2Nyb2xsQ29udGFpbmVyLnNjcm9sbEhlaWdodC0obWluUm91bmQrMSkqZml4ZWRIZWlnaHRcclxuICAgIH0vLyDku6VvZmZzZXRIZWlnaHTkuLrluqbph4/vvIzorrDlvZVvZmZzZXRUb3DkuI3otrPkuIDkuKrpq5jluqbnmoTlhbfkvZPplb/luqYsXHJcbiAgfVxyXG4gIC8qKmNvbnRlbnTpg6jliIbmu5rliqjkuovku7bnm5HlkKwgKi9cclxuICBwcml2YXRlIHN1YnNjcmliZVNjcm9sbChrZXk6IHN0cmluZyk6IHZvaWQge1xyXG4gICAgdGhpcy5uZ3pvbmUucnVuT3V0c2lkZUFuZ3VsYXIoKCkgPT4ge1xyXG4gICAgICB0aGlzLnNjcm9sbFN1YnNjcmlwdGlvbiA9IGZyb21FdmVudCh0aGlzLnNjcm9sbENvbnRlbnRzW2tleV0sICdzY3JvbGwnKVxyXG4gICAgICAgIC5waXBlKGRlYm91bmNlVGltZSgxMDAsIGFuaW1hdGlvbkZyYW1lKSlcclxuICAgICAgICAuc3Vic2NyaWJlKCgpOiB2b2lkID0+IHtcclxuICAgICAgICAgIGlmICh0aGlzLnNjcm9sbFNwaWVzW2tleV0pIHtcclxuICAgICAgICAgICAgY29uc3QgeyBjdXJyZW50U2VjdGlvbklkLCBlbGVtZW50cywgc3ViamVjdCB9ID0gdGhpcy5zY3JvbGxTcGllc1trZXldO1xyXG4gICAgICAgICAgICBjb25zdCBmaW5kTWluSW5WaWV3SWRzPSB0aGlzLmZpbmRNaW5JblRvVmlld0VsZW1lbnQoZWxlbWVudHMsdGhpcy5zY3JvbGxDb250ZW50c1trZXldLHRoaXMub2Zmc2V0c1trZXldKTsgICAgICAgICAgXHJcbiAgICAgICAgICAgIGlmICghZmluZE1pbkluVmlld0lkcyB8fCAhZmluZE1pbkluVmlld0lkcy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY29uc3QgdG9wRWxlbWVudElkOiBzdHJpbmcgPWZpbmRNaW5JblZpZXdJZHNbMF07XHJcbiAgICAgICAgICAgIC8v5Yik5patIOeCueWHu+aYr+WQpuaYr+eCueWHu+W8lei1t+eahOa7muWKqFxyXG4gICAgICAgICAgICBpZiAodGhpcy5zY3JvbGxTcGllc1trZXldLmNsaWNrQ2hhbmdlKSB7XHJcbiAgICAgICAgICAgICAgdGhpcy5zY3JvbGxTcGllc1trZXldLmNsaWNrQ2hhbmdlID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgIHRoaXMuc2Nyb2xsU3BpZXNba2V5XS5jbGlja0NoYW5nZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgIGlmICh0b3BFbGVtZW50SWQgIT09IGN1cnJlbnRTZWN0aW9uSWQpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2Nyb2xsU3BpZXNba2V5XS5jdXJyZW50U2VjdGlvbklkID0gdG9wRWxlbWVudElkO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5uZ3pvbmUucnVuKCgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgc3ViamVjdC5uZXh0KHRvcEVsZW1lbnRJZCk7XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pXHJcblxyXG4gICAgfSk7XHJcbiAgfVxyXG4gIC8qKnRhYumDqOWIhueCueWHu+S6i+S7tuebkeWQrCAqL1xyXG4gIHByaXZhdGUgc3Vic2NyaWJlQ2xpY2soa2V5KTogdm9pZCB7XHJcbiAgICAvL09iamVjdC5rZXlzKHRoaXMuc2Nyb2xsRm9sbG93U3BpcGVzKS5mb3JFYWNoKChrZXk6c3RyaW5nKTp2b2lkPT57XHJcbiAgICBpZiAodGhpcy5zY3JvbGxGb2xsb3dTcGlwZXNba2V5XSAmJiB0aGlzLnNjcm9sbEZvbGxvd1NwaXBlc1trZXldLmxlbmd0aCkge1xyXG4gICAgICB0aGlzLnNjcm9sbEZvbGxvd1NwaXBlc1trZXldLmZvckVhY2goKGZvbGxvdykgPT4ge1xyXG4gICAgICAgIGZyb21FdmVudChmb2xsb3cuZWxlbWVudCwgJ2NsaWNrJylcclxuICAgICAgICAgIC5waXBlKHRocm90dGxlVGltZSgxMDApKVxyXG4gICAgICAgICAgLnN1YnNjcmliZSgoZXZlbnQpID0+IHtcclxuICAgICAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICAgICAgICAgIHRoaXMuZlNjcm9sbEZvbGxvd0NsaWNrKGtleSwgZm9sbG93KTtcclxuICAgICAgICAgICAgLy8gaWYodGhpcy5zY3JvbGxTcGllc1trZXldKXtcclxuXHJcbiAgICAgICAgICAgIC8vICAgY29uc3QgeyBjdXJyZW50U2VjdGlvbklkLCBlbGVtZW50cywgc3ViamVjdCB9ID0gdGhpcy5zY3JvbGxTcGllc1trZXldO1xyXG4gICAgICAgICAgICAvLyAgIHRoaXMuc2Nyb2xsU3BpZXNba2V5XS5jbGlja0NoYW5nZSA9IHRydWU7XHJcbiAgICAgICAgICAgIC8vICAgaWYoZm9sbG93LmlkICE9PSBjdXJyZW50U2VjdGlvbklkKXtcclxuICAgICAgICAgICAgLy8gICAgIGNvbnN0IHRvcEVsZW1lbnRJblZpZXcgPSBlbGVtZW50cy5maW5kKGVsID0+IGVsLmlkID09PSBmb2xsb3cuaWQpO1xyXG4gICAgICAgICAgICAvLyAgICAgaWYoIXRvcEVsZW1lbnRJblZpZXcpIHsgcmV0dXJuOyB9XHJcbiAgICAgICAgICAgIC8vICAgICB0aGlzLnNjcm9sbFNwaWVzW2tleV0uY3VycmVudFNlY3Rpb25JZCA9IGZvbGxvdy5pZDtcclxuICAgICAgICAgICAgLy8gICAgIC8vdGhpcy5zY3JvbGxDb250ZW50c1trZXldLm9mZnNldFRvcFxyXG4gICAgICAgICAgICAvLyAgICAgdGhpcy5zY3JvbGxDb250ZW50c1trZXldLnNjcm9sbFRvcCA9IE1hdGgucm91bmQodG9wRWxlbWVudEluVmlldy5lbGVtZW50Lm9mZnNldFRvcCAtIHRoaXMub2Zmc2V0c1trZXldKTtcclxuICAgICAgICAgICAgLy8gICAgIHN1YmplY3QubmV4dChmb2xsb3cuaWQpO1xyXG4gICAgICAgICAgICAvLyAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIH1cclxuXHJcbiAgICAgICAgICB9KVxyXG4gICAgICB9KVxyXG4gICAgfVxyXG4gICAgLy99KTtcclxuICB9XHJcblxyXG4gIGZTY3JvbGxGb2xsb3dDbGljayhrZXksIGZvbGxvdyl7XHJcbiAgICBpZih0aGlzLnNjcm9sbFNwaWVzW2tleV0pe1xyXG4gICAgICBjb25zdCB7IGN1cnJlbnRTZWN0aW9uSWQsIGVsZW1lbnRzLCBzdWJqZWN0IH0gPSB0aGlzLnNjcm9sbFNwaWVzW2tleV07XHJcbiAgICAgIHRoaXMuc2Nyb2xsU3BpZXNba2V5XS5jbGlja0NoYW5nZSA9IHRydWU7XHJcbiAgICAgIGlmIChmb2xsb3cuaWQgIT09IGN1cnJlbnRTZWN0aW9uSWQpIHtcclxuICAgICAgICBjb25zdCB0b3BFbGVtZW50SW5WaWV3ID0gZWxlbWVudHMuZmluZChlbCA9PiBlbC5pZCA9PT0gZm9sbG93LmlkKTtcclxuICAgICAgICBpZiAoIXRvcEVsZW1lbnRJblZpZXcpIHsgcmV0dXJuOyB9XHJcbiAgICAgICAgdGhpcy5zY3JvbGxTcGllc1trZXldLmN1cnJlbnRTZWN0aW9uSWQgPSBmb2xsb3cuaWQ7XHJcbiAgICAgICAgLy90aGlzLnNjcm9sbENvbnRlbnRzW2tleV0ub2Zmc2V0VG9wXHJcbiAgICAgICAgaWYgKHRoaXMuc2Nyb2xsQ29udGVudHNba2V5XSkge1xyXG4gICAgICAgICAgLy8g5YaF5a655Y675pyJ5rua5YqoXHJcbiAgICAgICAgICB0aGlzLnNjcm9sbENvbnRlbnRzW2tleV0uc2Nyb2xsVG9wID0gTWF0aC5yb3VuZCh0b3BFbGVtZW50SW5WaWV3LmVsZW1lbnQub2Zmc2V0VG9wIC0gdGhpcy5vZmZzZXRzW2tleV0tIHBhcnNlSW50KGdldENvbXB1dGVkU3R5bGUodGhpcy5zY3JvbGxDb250ZW50c1trZXldKS5wYWRkaW5nVG9wLDEwKSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHN1YmplY3QubmV4dChmb2xsb3cuaWQpO1xyXG4gICAgICB9XHJcblxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoq5re75Yqg6ZyA6KaB6KKr5rua5Yqo55uR5ZCs6YOo5YiGICovXHJcbiAgcHVibGljIGFkZENvbnRlbnRFbGVtZW50KGVsZW1lbnQ6IEhUTUxFbGVtZW50LCBjb250ZW50SWQgPSB0aGlzLmRlZmF1bHRJZCk6IHZvaWQge1xyXG4gICAgaWYgKGNvbnRlbnRJZCAhPT0gJycpIHtcclxuICAgICAgdGhpcy5zY3JvbGxDb250ZW50c1tjb250ZW50SWRdID0gZWxlbWVudDtcclxuICAgICAgdGhpcy5zdWJzY3JpYmVTY3JvbGwoY29udGVudElkKTtcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICB0aGlzLnNjcm9sbENvbnRlbnRzW3RoaXMuZGVmYXVsdElkXSA9IGVsZW1lbnQ7XHJcbiAgICAgIHRoaXMuc3Vic2NyaWJlU2Nyb2xsKHRoaXMuZGVmYXVsdElkKTtcclxuICAgIH1cclxuICAgIC8vIOWIpOaWreaYr+acieW+heaUueWPmOeahOeKtuaAgVxyXG4gICAgdGhpcy51cGRhdGVDb250YWluZXJDbHNOYW1lKGNvbnRlbnRJZCk7XHJcbiAgfVxyXG4gIC8qKuenu+mZpOmcgOimgeiiq+a7muWKqOebkeWQrOmDqOWIhuWFg+e0oCAqL1xyXG4gIHB1YmxpYyByZW1vdmVDb250ZW50RWxlbWVudChjb250ZW50SWQgPSB0aGlzLmRlZmF1bHRJZCk6IHZvaWQge1xyXG4gICAgY29uc3QgcmVtb3ZlSWQgPSBjb250ZW50SWQgIT09ICcnID8gY29udGVudElkIDogdGhpcy5kZWZhdWx0SWQ7XHJcbiAgICBkZWxldGUgdGhpcy5zY3JvbGxTcGllc1tyZW1vdmVJZF07XHJcbiAgfVxyXG4gIC8qKua3u+WKoOa7muWKqOebkeWQrHRhYumDqOWIhuWFg+e0oCovXHJcbiAgcHVibGljIGFkZEZvbGxvd0VsZW1lbnQoZWxlbWVudDogSFRNTEVsZW1lbnQsIGZvbGxvd0lkLCBmb2xsb3dDb250ZW50SWQgPSB0aGlzLmRlZmF1bHRJZCk6IHZvaWQge1xyXG4gICAgY29uc3QgZ3JvdXBJZCA9IGZvbGxvd0NvbnRlbnRJZCAhPT0gJycgPyBmb2xsb3dDb250ZW50SWQgOiB0aGlzLmRlZmF1bHRJZDtcclxuXHJcbiAgICBjb25zdCBmb2xsb3cgPSB7XHJcbiAgICAgIGVsZW1lbnQ6IGVsZW1lbnQsXHJcbiAgICAgIGlkOiBmb2xsb3dJZFxyXG4gICAgfTtcclxuICAgIGlmICghdGhpcy5zY3JvbGxGb2xsb3dTcGlwZXNbZ3JvdXBJZF0pIHtcclxuICAgICAgdGhpcy5zY3JvbGxGb2xsb3dTcGlwZXNbZ3JvdXBJZF0gPSBbXVxyXG4gICAgfVxyXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t5q2k5aSE5rKh5pyJ5aSE55CG6YeN5aSNSURcclxuICAgIGNvbnN0IGZvbGxvd3MgPSB0aGlzLnNjcm9sbEZvbGxvd1NwaXBlc1tncm91cElkXTtcclxuICAgIGZvbGxvd3MucHVzaChmb2xsb3cpO1xyXG4gICAgdGhpcy5zY3JvbGxGb2xsb3dTcGlwZXNbZ3JvdXBJZF0gPSBmb2xsb3dzO1xyXG4gICAgdGhpcy5zdWJzY3JpYmVDbGljayhncm91cElkKTtcclxuICB9XHJcbiAgLyoq56e76Zmk5rua5Yqo55uR5ZCsdGFi6YOo5YiG5YWD57SgICovXHJcbiAgcHVibGljIHJlbW92ZUZvbGxvd0VsZW1lbnQoZm9sbG93SWQsIGZvbGxvd0NvbnRlbnRJZCA9IHRoaXMuZGVmYXVsdElkKTogdm9pZCB7XHJcbiAgICBjb25zdCBlbGVtZW50cyA9IHRoaXMuc2Nyb2xsRm9sbG93U3BpcGVzW2ZvbGxvd0NvbnRlbnRJZF0uZmlsdGVyKGVsID0+IHtcclxuICAgICAgcmV0dXJuIGVsLmlkICE9PSBmb2xsb3dJZDtcclxuICAgIH0pXHJcbiAgICBpZiAoIWVsZW1lbnRzLmxlbmd0aCkge1xyXG4gICAgICBkZWxldGUgdGhpcy5zY3JvbGxGb2xsb3dTcGlwZXNbZm9sbG93Q29udGVudElkXTtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgdGhpcy5zY3JvbGxGb2xsb3dTcGlwZXNbZm9sbG93Q29udGVudElkXSA9IGVsZW1lbnRzO1xyXG4gIH1cclxuICAvKirmt7vliqDmu5rliqjnm5HlkKzplJrngrnpg6jliIblhYPntKAgKi9cclxuICBwdWJsaWMgYWRkRWxlbWVudChlbGVtZW50OiBIVE1MRWxlbWVudCwgc2Nyb2xsSWQ6IHN0cmluZywgc2Nyb2xsR3JvdXBJZDogc3RyaW5nID0gdGhpcy5kZWZhdWx0SWQpOiB2b2lkIHtcclxuICAgIGlmICghdGhpcy5zY3JvbGxTcGllc1tzY3JvbGxHcm91cElkXSkge1xyXG4gICAgICB0aGlzLnNjcm9sbFNwaWVzW3Njcm9sbEdyb3VwSWRdID0ge1xyXG4gICAgICAgIGVsZW1lbnRzOiBbXSxcclxuICAgICAgICBjdXJyZW50U2VjdGlvbklkOiAnJyxcclxuICAgICAgICBzdWJqZWN0OiBuZXcgU3ViamVjdCgpLFxyXG4gICAgICB9IGFzIFNjcm9sbFNweTtcclxuXHJcbiAgICAgIHRoaXMuc2Nyb2xsU3BpZXNbc2Nyb2xsR3JvdXBJZF0uc3ViamVjdFxyXG4gICAgICAgIC5zdWJzY3JpYmUoKGN1cnJlbnRTZWN0aW9uOiBzdHJpbmcpOiB2b2lkID0+IHtcclxuICAgICAgICAgIGlmICh0aGlzLnNjcm9sbENoYW5nZVtzY3JvbGxHcm91cElkXSkge1xyXG4gICAgICAgICAgICB0aGlzLnNjcm9sbENoYW5nZVtzY3JvbGxHcm91cElkXS5uZXh0KGN1cnJlbnRTZWN0aW9uKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHRoaXMuaGFzRWxlbWVudChzY3JvbGxJZCwgc2Nyb2xsR3JvdXBJZCkpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IGVsOiBTY3JvbGxFbGVtZW50ID0ge1xyXG4gICAgICBlbGVtZW50OiBlbGVtZW50LFxyXG4gICAgICBpZDogc2Nyb2xsSWRcclxuICAgIH1cclxuICAgIC8vIOWKoOWFpeaXtu+8jOWIpOaWreaYr+WQpuaYr+W9k+WJjVxyXG4gICAgdGhpcy51cGRhdGVTY3JvbGxTcHlBY3RpdmVDbHNOYW1lKHNjcm9sbEdyb3VwSWQsZWwpO1xyXG4gICAgY29uc3QgZWxlbWVudHM6IGFueVtdID0gdGhpcy5zY3JvbGxTcGllc1tzY3JvbGxHcm91cElkXS5lbGVtZW50cztcclxuICAgIGVsZW1lbnRzLnB1c2goZWwpO1xyXG4gICAgZWxlbWVudHMuc29ydCgoYSwgYik6IG51bWJlciA9PiBiLmVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkudG9wIC0gYS5lbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLnRvcCk7XHJcblxyXG4gICAgdGhpcy5zY3JvbGxTcGllc1tzY3JvbGxHcm91cElkXS5lbGVtZW50cyA9IGVsZW1lbnRzO1xyXG4gIH1cclxuICAvKirnp7vpmaTmu5rliqjnm5HlkKzplJrngrnpg6jliIblhYPntKAgKi9cclxuICBwdWJsaWMgcmVtb3ZlRWxlbWVudChzY3JvbGxJZDogc3RyaW5nLCBzY3JvbGxHcm91cElkOiBzdHJpbmcgPSB0aGlzLmRlZmF1bHRJZCk6IHZvaWQge1xyXG4gICAgY29uc3QgZWxlbWVudHMgPSB0aGlzLnNjcm9sbFNwaWVzW3Njcm9sbEdyb3VwSWRdLmVsZW1lbnRzLmZpbHRlcigoZWwpOiBib29sZWFuID0+IHtcclxuICAgICAgcmV0dXJuIGVsLmlkICE9PSBzY3JvbGxJZFxyXG4gICAgfVxyXG4gICAgKTtcclxuICAgIGlmICghZWxlbWVudHMubGVuZ3RoKSB7XHJcbiAgICAgIGRlbGV0ZSB0aGlzLnNjcm9sbFNwaWVzW3Njcm9sbEdyb3VwSWRdO1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICB0aGlzLnNjcm9sbFNwaWVzW3Njcm9sbEdyb3VwSWRdLmVsZW1lbnRzID0gZWxlbWVudHM7XHJcbiAgfVxyXG4gIC8qKuWIpOaWrXNjcm9sbEdyb3VwSWQg5piv5ZCm5pyJaWTlkI3kuLplbGVtZW50SWQg55qE5YWD57SgICovXHJcbiAgcHJpdmF0ZSBoYXNFbGVtZW50KGVsZW1lbnRJZDogc3RyaW5nLCBzY3JvbGxHcm91cElkOiBzdHJpbmcpOiBib29sZWFuIHtcclxuICAgIHJldHVybiB0aGlzLnNjcm9sbFNwaWVzW3Njcm9sbEdyb3VwSWRdLmVsZW1lbnRzLnNvbWUoKGVsZW1lbnQpOiBib29sZWFuID0+IGVsZW1lbnQuaWQgPT09IGVsZW1lbnRJZCk7XHJcbiAgfVxyXG4gIC8qKuiuvue9rm9mZnNldCAqL1xyXG4gIHB1YmxpYyBzZXRPZmZzZXQob2Zmc2V0OiBudW1iZXIgPSAwLCBjb250ZW50SWQ6IHN0cmluZyA9IHRoaXMuZGVmYXVsdElkKTogdm9pZCB7XHJcbiAgICBpZiAoY29udGVudElkICE9PSAnJykge1xyXG4gICAgICB0aGlzLm9mZnNldHNbY29udGVudElkXSA9IG9mZnNldDtcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICB0aGlzLm9mZnNldHNbdGhpcy5kZWZhdWx0SWRdID0gb2Zmc2V0O1xyXG4gICAgfVxyXG4gIH1cclxuICAvKlNjcm9sbFNweee7hOS7tijplJrngrnliJfooajljLrln5/vvInliJ3lp4vljJbpooTorr5kZWZhdWx0SWQgKi9cclxuICBzZXRHcm91cElkKGdyb3VwaWQpIHtcclxuICAgIGlmIChncm91cGlkKSB7XHJcbiAgICAgIHRoaXMuZGVmYXVsdElkID0gZ3JvdXBpZDtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGdldEdyb3VwSWQoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5kZWZhdWx0SWQ7XHJcbiAgfVxyXG4gIC8q5pS55Y+YIFNjcm9sbFNweee7hOS7tu+8iOmUmueCueWIl+ihqOWMuuWfn++8ieeahOaYvuekuueKtuaAgeaXtiAqL1xyXG4gIGNoYW5nZUdyb3VwSWRGb2xsb3dUeXBlKGdyb3VwaWQsIGZvbGxvd1R5cGVEYXRhKSB7XHJcbiAgICB0aGlzLnNjcm9sbFNweUxpc3RGb2xsb3dUeXBlQ2hhbmdlc1tncm91cGlkXSA9IGZvbGxvd1R5cGVEYXRhO1xyXG4gICAgdGhpcy51cGRhdGVDb250YWluZXJDbHNOYW1lKGdyb3VwaWQpO1xyXG4gIH1cclxuICBwcml2YXRlIHVwZGF0ZUNvbnRhaW5lckNsc05hbWUoZ3JvdXBpZCkge1xyXG4gICAgLy8g5rKh5pyJ5b6F5pu05paw5Y+Y5YyWXHJcbiAgICBpZiAoIXRoaXMuc2Nyb2xsU3B5TGlzdEZvbGxvd1R5cGVDaGFuZ2VzLmhhc093blByb3BlcnR5KGdyb3VwaWQpKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIC8vIGNvbnRhaW5lcuW5tuS4jeWtmOWcqOeahOaXtuWAmVxyXG4gICAgaWYgKCF0aGlzLnNjcm9sbENvbnRlbnRzLmhhc093blByb3BlcnR5KGdyb3VwaWQpKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGxldCBmb2xsb3dUeXBlRGF0YSA9IHRoaXMuc2Nyb2xsU3B5TGlzdEZvbGxvd1R5cGVDaGFuZ2VzW2dyb3VwaWRdO1xyXG4gICAgbGV0IGNvbnRhaW5lckVsID0gdGhpcy5zY3JvbGxDb250ZW50c1tncm91cGlkXTtcclxuICAgIC8vIENvbnRhaW5lcueahEVsZW1lbnQgXHJcbiAgICBpZiAoZm9sbG93VHlwZURhdGFbJ3ByZXYnXSA9PSAnZml4ZWRUYWInKSB7XHJcbiAgICAgIC8v56e76ZmkY2xhc3NcclxuICAgICAgY29udGFpbmVyRWwuY2xhc3NOYW1lID0gY29udGFpbmVyRWwuY2xhc3NOYW1lLnJlcGxhY2UodGhpcy5maXhlZFRhYkNvbnRhaW5lckNsc05hbWUsICcnKTtcclxuICAgICAgY29udGFpbmVyRWwucGFyZW50RWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKHRoaXMucGFyZW50Rml4ZWRUYWJDb250YWluZXJDbHNOYW1lKTtcclxuICAgIH0gZWxzZSBpZiAoZm9sbG93VHlwZURhdGFbJ25leHQnXSA9PSAnZml4ZWRUYWInKSB7XHJcbiAgICAgIC8vIOWinuWKoGNsYXNzXHJcbiAgICAgIGNvbnRhaW5lckVsLmNsYXNzTmFtZSArPSAnICcgKyB0aGlzLmZpeGVkVGFiQ29udGFpbmVyQ2xzTmFtZTtcclxuICAgICAgLy8g57uZ54i25YWD57Sg5aKe5Yqg6auY5bqmXHJcbiAgICAgIGNvbnRhaW5lckVsLnBhcmVudEVsZW1lbnQuY2xhc3NMaXN0LmFkZCh0aGlzLnBhcmVudEZpeGVkVGFiQ29udGFpbmVyQ2xzTmFtZSk7XHJcbiAgICB9XHJcbiAgICB0aGlzLnNjcm9sbFNweUxpc3RGb2xsb3dUeXBlQ2hhbmdlc1tncm91cGlkXSA9IG51bGw7XHJcbiAgfVxyXG5cclxuICB1cGRhdGVTY3JvbGxTcGllc0FjdGl2ZUNsc05hbWUoZ3JvdXBJZCxjdXJyZW50SWQpIHtcclxuICAgIC8vIOi/veWKoOOAgeenu+mZpGNsYXNzXHJcbiAgICB0aGlzLnNjcm9sbFNwaWVzW2dyb3VwSWRdLmVsZW1lbnRzLm1hcCgoaXRlbTogU2Nyb2xsRWxlbWVudCkgPT4ge1xyXG4gICAgICBpZiAoaXRlbS5pZCA9PSBjdXJyZW50SWQpIHtcclxuICAgICAgICAvLyDmib7liLDlvZPliY1cclxuICAgICAgICBpZiAoaXRlbS5lbGVtZW50LmNsYXNzTmFtZS5pbmRleE9mKHRoaXMuc2Nyb2xsU3B5UGFydEFjdGl2ZUNsc05hbWUpIDwgMCkge1xyXG4gICAgICAgICAgaXRlbS5lbGVtZW50LmNsYXNzTmFtZSArPSAnICcgKyB0aGlzLnNjcm9sbFNweVBhcnRBY3RpdmVDbHNOYW1lO1xyXG4gICAgICAgIH1cclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICAvLyDlhbbku5ZcclxuICAgICAgICBpdGVtLmVsZW1lbnQuY2xhc3NOYW1lID0gaXRlbS5lbGVtZW50LmNsYXNzTmFtZS5yZXBsYWNlKHRoaXMuc2Nyb2xsU3B5UGFydEFjdGl2ZUNsc05hbWUsICcnKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOW9k+i/veWKoFNjcm9sbFNweeWdl+eahOaXtuWAme+8jOWIpOaWreaYr+WQpuaYr+W3sue7j+iuvue9rueahOW9k+WJjVxyXG4gICAqIEBwYXJhbSBncm91cElkIFxyXG4gICAqIEBwYXJhbSBzY3JvbGxFbCBcclxuICAgKi9cclxuICBwcml2YXRlICB1cGRhdGVTY3JvbGxTcHlBY3RpdmVDbHNOYW1lKGdyb3VwSWQsc2Nyb2xsRWw6U2Nyb2xsRWxlbWVudCl7XHJcbiAgICAvLyDlpoLmnpzlt7Lorr7nva5cclxuICAgIGlmKHRoaXMuY3VycmVudFNlY3Rpb25JZE9ialtncm91cElkXSl7XHJcbiAgICAgIGlmKHRoaXMuY3VycmVudFNlY3Rpb25JZE9ialtncm91cElkXVsnaWRWYWx1ZSddPT1zY3JvbGxFbC5pZCl7XHJcbiAgICAgICAgc2Nyb2xsRWwuZWxlbWVudC5jbGFzc05hbWUrPScgJyt0aGlzLnNjcm9sbFNweVBhcnRBY3RpdmVDbHNOYW1lO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG5cclxufVxyXG4iXX0=
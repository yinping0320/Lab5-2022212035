/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, EventEmitter, Injector, Input, NgZone, Output, Renderer2, ViewEncapsulation, } from "@angular/core";
import { AppointmentCalendarComponent } from "../appointment-calendar.component";
import { flatten } from "lodash-es";
import { BaseViewComponent } from "./base.view.component";
export class DayViewComponent extends BaseViewComponent {
    /**
     * @param {?} injector
     * @param {?} ngzone
     * @param {?} calendarRef
     */
    constructor(injector, ngzone, calendarRef) {
        super(injector, ngzone, calendarRef);
        this.reservationTitle = '预订';
        this.cellClick = new EventEmitter();
        this.cells = new Array(23);
        this.render = null;
        this.render = this.injector.get(Renderer2, null);
    }
    /**
     * @param {?} item
     * @param {?=} typ
     * @return {?}
     */
    getCustomCls(item, typ = "cls") {
        /** @type {?} */
        let result = null;
        if (this.customCls) {
            const { cls, styles } = this.customCls(item);
            if (!cls && !styles && typ === "cls") {
                result = this.customCls(item);
            }
            else {
                if (typ == "cls") {
                    result = cls || null;
                }
                else {
                    result = styles || null;
                }
            }
        }
        // if (result && typ === 'styles') {
        //     Object.keys(result).forEach((n: any) => {
        //         if (result[n].indexOf('important') === -1) {
        //             result[n] = result[n] +' !important' ;
        //         }
        //     });
        // }
        return result;
    }
    /**
     * @param {?=} id
     * @return {?}
     */
    setActiveItem(id) {
        /** @type {?} */
        let _id = id;
        if (!id) {
            _id = this.selectId;
        }
        if (_id) {
            this.activeItem = flatten(this.data.map((/**
             * @param {?} n
             * @return {?}
             */
            (n) => n.reserves))).find((/**
             * @param {?} n
             * @return {?}
             */
            (n) => n.id == _id));
        }
    }
    /**
     * @param {?} $event
     * @param {?} cellIndex
     * @param {?} roomInfo
     * @return {?}
     */
    onCellClick($event, cellIndex, roomInfo) {
        /** @type {?} */
        const _h = ('' + cellIndex).padStart(2, '0');
        /** @type {?} */
        const _endH = ('' + (cellIndex + 1)).padStart(2, '0');
        /** @type {?} */
        const p = {
            start: `${this.calendarRef["currentDateStr"]} ${_h}:00:00`,
            end: `${this.calendarRef["currentDateStr"]} ${_endH}:00:00`,
            place: roomInfo.data,
        };
        this.cellClick.emit(p);
    }
    /**
     * @param {?} $event
     * @return {?}
     */
    onMouseEnter($event) {
        $event.stopPropagation();
        /** @type {?} */
        const parentCell = $event.target['parentElement'].querySelector('.addnew');
        if (parentCell) {
            parentCell.style.opacity = 0;
        }
    }
    /**
     * @param {?} $event
     * @return {?}
     */
    onMouseLeave($event) {
        $event.stopPropagation();
        /** @type {?} */
        const parentCell = $event.target['parentElement'].querySelector('.addnew');
        if (parentCell) {
            parentCell.removeAttribute('style');
        }
    }
}
DayViewComponent.decorators = [
    { type: Component, args: [{
                selector: "day-view",
                template: "<div class=\"header\" #header>\r\n\r\n    <div class=\"header-row\" [style.width.px]=\"calendarRef.rowWidth\">\r\n\r\n        <div class=\"header-cell roomname fixed-left\" [style.width.px]=\"calendarRef.placeNameWidth\">\r\n            <span class=\"time ml-2\">{{calendarRef.placeTitle}}</span>\r\n        </div>\r\n\r\n        <div class=\"header-cell time-cell\" style=\"width: 50px\">\r\n        </div>\r\n        <div class=\"header-cell time-cell\" >\r\n            <span class=\"time\">00:00</span>\r\n        </div>\r\n        <div class=\"header-cell time-cell\">\r\n            <span class=\"time\">01:00</span>\r\n        </div>\r\n        <div class=\"header-cell time-cell\">\r\n            <span class=\"time\">02:00</span>\r\n        </div>\r\n        <div class=\"header-cell time-cell\">\r\n            <span class=\"time\">03:00</span>\r\n        </div>\r\n        <div class=\"header-cell time-cell\">\r\n            <span class=\"time\">04:00</span>\r\n        </div>\r\n        <div class=\"header-cell time-cell\">\r\n            <span class=\"time\">05:00</span>\r\n        </div>\r\n        <div class=\"header-cell time-cell\">\r\n            <span class=\"time\">06:00</span>\r\n        </div>\r\n        <div class=\"header-cell time-cell\">\r\n            <span class=\"time\">07:00</span>\r\n        </div>\r\n        <div class=\"header-cell time-cell\">\r\n            <span class=\"time\">08:00</span>\r\n        </div>\r\n        <div class=\"header-cell time-cell\">\r\n            <span class=\"time\">09:00</span>\r\n        </div>\r\n        <div class=\"header-cell time-cell\">\r\n            <span class=\"time\">10:00</span>\r\n        </div>\r\n        <div class=\"header-cell time-cell\">\r\n            <span class=\"time\">11:00</span>\r\n        </div>\r\n        <div class=\"header-cell time-cell\">\r\n            <span class=\"time\">12:00</span>\r\n        </div>\r\n        <div class=\"header-cell time-cell\">\r\n            <span class=\"time\">13:00</span>\r\n        </div>\r\n        <div class=\"header-cell time-cell\">\r\n            <span class=\"time\">14:00</span>\r\n        </div>\r\n        <div class=\"header-cell time-cell\">\r\n            <span class=\"time\">15:00</span>\r\n        </div>\r\n        <div class=\"header-cell time-cell\">\r\n            <span class=\"time\">16:00</span>\r\n        </div>\r\n        <div class=\"header-cell time-cell\">\r\n            <span class=\"time\">17:00</span>\r\n        </div>\r\n        <div class=\"header-cell time-cell\">\r\n            <span class=\"time\">18:00</span>\r\n        </div>\r\n        <div class=\"header-cell time-cell\">\r\n            <span class=\"time\">19:00</span>\r\n        </div>\r\n        <div class=\"header-cell time-cell\">\r\n            <span class=\"time\">20:00</span>\r\n        </div>\r\n        <div class=\"header-cell time-cell\">\r\n            <span class=\"time\">21:00</span>\r\n        </div>\r\n        <div class=\"header-cell time-cell\">\r\n            <span class=\"time\">22:00</span>\r\n        </div>\r\n        <div class=\"header-cell time-cell\"  style=\"width: 100px\">\r\n            <span class=\"time\">23:00</span>\r\n        </div>\r\n           \r\n    </div>\r\n\r\n</div>\r\n<div class=\"body win11Scroll nobtn\" #body>\r\n\r\n    <div class=\"room-row\" *ngFor=\"let room of data\" [style.height.px]=\"calendarRef.rowHeight\"  [style.width.px]=\"calendarRef.rowWidth\"  [attr.id]=\"'row_'+room.id\">\r\n\r\n        <div class=\"room-cell roomname fixed-left\" [style.width.px]=\"calendarRef.placeNameWidth\">\r\n            <span *ngIf=\"!calendarRef.placeNameTemplate\">{{ room.data[calendarRef.placeNameField] }}</span>\r\n            <ng-container [ngTemplateOutlet]=\"calendarRef.placeNameTemplate\" [ngTemplateOutletContext]=\"{ $implicit: {data: room.data}, item: room.data }\"></ng-container>\r\n        </div>\r\n        <div class=\"room-cell time-cell\" style=\"width: 50px\">\r\n        </div>\r\n        <div class=\"room-cell time-cell\">\r\n            <div class=\"item-content\" *ngFor=\"let item of room?.reserves\" \r\n                [item-dblclick]=\"item\" (dblclickHandler)=\"ondblClick($event)\"\r\n                [style.width.px]=\"item.position?.width\" [style.left.px]=\"item.position?.left\"\r\n                (click)=\"onSubjectClick($event, item)\" \r\n                (mousedown)=\"onMouseDown($event)\" (mouseup)=\"onMouseUp($event)\"\r\n                 (mouseenter)=\"onMouseEnter($event)\" (mouseleave)=\"onMouseLeave($event)\">\r\n                <div class=\"item-content-wrap\" [ngClass]=\"customCls && getCustomCls(item)\" [ngStyle]=\"customCls && getCustomCls(item, 'styles')\" [class.selected]=\"activeItem && activeItem.id === item.id\">\r\n                    <div class=\"room-subject p-2 gray\" *ngIf=\"!calendarRef.contentTemplate\">\r\n                        <dl> \r\n                            <dt>{{ calendarRef.utils.getValue(calendarRef.reserveInfoFields.title, item.data) }}</dt>\r\n                            <dd class=\"other-info\">\r\n                                <span>\r\n                                    {{ calendarRef.utils.getValue(calendarRef.reserveInfoFields.startDate, item.data) |dateformat: 'HH:mm'}}\r\n                                    ~\r\n                                    {{ calendarRef.utils.getValue(calendarRef.reserveInfoFields.endDate, item.data) |dateformat: 'HH:mm'}}\r\n                                </span>\r\n                            </dd>\r\n                        </dl>\r\n                    </div>\r\n                    <ng-container [ngTemplateOutlet]=\"calendarRef.contentTemplate\" [ngTemplateOutletContext]=\"{ $implicit: {data: item.data}, item: item.data }\"></ng-container>\r\n                </div>\r\n            </div>\r\n\r\n\r\n            <ng-container *ngIf=\"!(room.disableCells && room.disableCells.indexOf(0) > -1)\">\r\n\r\n                <div class=\"addnew\" (click)=\"onCellClick($event, 0, room)\">\r\n                    <span class=\"f-icon f-icon-add\" style=\"position: relative;\r\n                    top: 1px;margin-right: 3px;\"></span> {{reservationTitle}}\r\n                </div>\r\n\r\n            </ng-container>\r\n        </div>\r\n        <div class=\"room-cell time-cell\" *ngFor=\"let c of cells; let i= index\" [class.isUsed]=\"room.disableCells && room.disableCells.indexOf(i+1) > -1 \" >\r\n\r\n\r\n            <ng-container *ngIf=\"!(room.disableCells && room.disableCells.indexOf(i+1) > -1)\">\r\n\r\n                <div class=\"addnew\" (click)=\"onCellClick($event, (i + 1), room)\">\r\n                    <span class=\"f-icon f-icon-add\" style=\"position: relative;\r\n                    top: 1px;\r\n                    margin-right: 3px;\"></span> {{reservationTitle}}\r\n                </div>\r\n\r\n            </ng-container>\r\n\r\n        </div>\r\n    </div>\r\n\r\n</div>\r\n",
                encapsulation: ViewEncapsulation.None,
                styles: [`
        .rtv-container .main .room-row .time-cell .addnew{
  width: 100%;
  height: 100%;
  display: flex;
  justify-content: center;
  align-items: center;
  border: 1px solid #2a87ff;
  background: #edf5ff;
  cursor: pointer;
  opacity: 0;
  transition: all 0.12s ease;
  color: #045dd3;
  font-size: 14px;
  border-radius: 4px;
}

.rtv-container .main .room-row .time-cell:hover>.addnew {
  opacity: 1;
}

        `]
            }] }
];
/** @nocollapse */
DayViewComponent.ctorParameters = () => [
    { type: Injector },
    { type: NgZone },
    { type: AppointmentCalendarComponent }
];
DayViewComponent.propDecorators = {
    customCls: [{ type: Input }],
    reservationTitle: [{ type: Input }],
    cellClick: [{ type: Output }]
};
if (false) {
    /** @type {?} */
    DayViewComponent.prototype.customCls;
    /** @type {?} */
    DayViewComponent.prototype.reservationTitle;
    /** @type {?} */
    DayViewComponent.prototype.cellClick;
    /** @type {?} */
    DayViewComponent.prototype.cells;
    /** @type {?} */
    DayViewComponent.prototype.render;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF5LXZpZXcuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy9hcHBvaW50bWVudC1jYWxlbmRhci8iLCJzb3VyY2VzIjpbImxpYi92aWV3cy9kYXktdmlldy5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFDSCxTQUFTLEVBQ1QsWUFBWSxFQUNaLFFBQVEsRUFDUixLQUFLLEVBQ0wsTUFBTSxFQUNOLE1BQU0sRUFDTixTQUFTLEVBQ1QsaUJBQWlCLEdBQ3BCLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBRSw0QkFBNEIsRUFBRSxNQUFNLG1DQUFtQyxDQUFDO0FBQ2pGLE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxXQUFXLENBQUM7QUFDcEMsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sdUJBQXVCLENBQUM7QUE4QjFELE1BQU0sT0FBTyxnQkFBaUIsU0FBUSxpQkFBaUI7Ozs7OztJQVVuRCxZQUNJLFFBQWtCLEVBQ2xCLE1BQWMsRUFDZCxXQUF5QztRQUV6QyxLQUFLLENBQUMsUUFBUSxFQUFFLE1BQU0sRUFBRSxXQUFXLENBQUMsQ0FBQztRQWJoQyxxQkFBZ0IsR0FBRyxJQUFJLENBQUM7UUFDdkIsY0FBUyxHQUFHLElBQUksWUFBWSxFQUFFLENBQUM7UUFFekMsVUFBSyxHQUFHLElBQUksS0FBSyxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBRXRCLFdBQU0sR0FBYyxJQUFJLENBQUM7UUFTckIsSUFBSSxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxTQUFTLEVBQUUsSUFBSSxDQUFDLENBQUM7SUFDckQsQ0FBQzs7Ozs7O0lBRUQsWUFBWSxDQUFDLElBQUksRUFBRSxNQUF3QixLQUFLOztZQUN4QyxNQUFNLEdBQUcsSUFBSTtRQUNqQixJQUFJLElBQUksQ0FBQyxTQUFTLEVBQUU7a0JBQ1YsRUFBRSxHQUFHLEVBQUUsTUFBTSxFQUFFLEdBQUcs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Q2hDLEtBQUs7K0JBQ0wsS0FBSzt3QkFDTCxNQUFNOzs7O0lBRlAscUNBQTZEOztJQUM3RCw0Q0FBaUM7O0lBQ2pDLHFDQUF5Qzs7SUFFekMsaUNBQXNCOztJQUV0QixrQ0FBeUIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xyXG4gICAgQ29tcG9uZW50LFxyXG4gICAgRXZlbnRFbWl0dGVyLFxyXG4gICAgSW5qZWN0b3IsXHJcbiAgICBJbnB1dCxcclxuICAgIE5nWm9uZSxcclxuICAgIE91dHB1dCxcclxuICAgIFJlbmRlcmVyMixcclxuICAgIFZpZXdFbmNhcHN1bGF0aW9uLFxyXG59IGZyb20gXCJAYW5ndWxhci9jb3JlXCI7XHJcbmltcG9ydCB7IEFwcG9pbnRtZW50Q2FsZW5kYXJDb21wb25lbnQgfSBmcm9tIFwiLi4vYXBwb2ludG1lbnQtY2FsZW5kYXIuY29tcG9uZW50XCI7XHJcbmltcG9ydCB7IGZsYXR0ZW4gfSBmcm9tIFwibG9kYXNoLWVzXCI7XHJcbmltcG9ydCB7IEJhc2VWaWV3Q29tcG9uZW50IH0gZnJvbSBcIi4vYmFzZS52aWV3LmNvbXBvbmVudFwiO1xyXG5AQ29tcG9uZW50KHtcclxuICAgIHNlbGVjdG9yOiBcImRheS12aWV3XCIsXHJcbiAgICB0ZW1wbGF0ZVVybDogXCJkYXktdmlldy5jb21wb25lbnQuaHRtbFwiLFxyXG4gICAgZW5jYXBzdWxhdGlvbjogVmlld0VuY2Fwc3VsYXRpb24uTm9uZSxcclxuICAgIHN0eWxlczpbXHJcbiAgICAgICAgYFxyXG4gICAgICAgIC5ydHYtY29udGFpbmVyIC5tYWluIC5yb29tLXJvdyAudGltZS1jZWxsIC5hZGRuZXd7XHJcbiAgd2lkdGg6IDEwMCU7XHJcbiAgaGVpZ2h0OiAxMDAlO1xyXG4gIGRpc3BsYXk6IGZsZXg7XHJcbiAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7XHJcbiAgYWxpZ24taXRlbXM6IGNlbnRlcjtcclxuICBib3JkZXI6IDFweCBzb2xpZCAjMmE4N2ZmO1xyXG4gIGJhY2tncm91bmQ6ICNlZGY1ZmY7XHJcbiAgY3Vyc29yOiBwb2ludGVyO1xyXG4gIG9wYWNpdHk6IDA7XHJcbiAgdHJhbnNpdGlvbjogYWxsIDAuMTJzIGVhc2U7XHJcbiAgY29sb3I6ICMwNDVkZDM7XHJcbiAgZm9udC1zaXplOiAxNHB4O1xyXG4gIGJvcmRlci1yYWRpdXM6IDRweDtcclxufVxyXG5cclxuLnJ0di1jb250YWluZXIgLm1haW4gLnJvb20tcm93IC50aW1lLWNlbGw6aG92ZXI+LmFkZG5ldyB7XHJcbiAgb3BhY2l0eTogMTtcclxufVxyXG5cclxuICAgICAgICBgXHJcbiAgICBdXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBEYXlWaWV3Q29tcG9uZW50IGV4dGVuZHMgQmFzZVZpZXdDb21wb25lbnQge1xyXG4gICAgQElucHV0KCkgY3VzdG9tQ2xzOiAoeyBpdGVtIH0pID0+IHsgW2Nsczogc3RyaW5nXTogYm9vbGVhbiB9O1xyXG4gICAgQElucHV0KCkgcmVzZXJ2YXRpb25UaXRsZSA9ICfpooTorqInO1xyXG4gICAgQE91dHB1dCgpIGNlbGxDbGljayA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuXHJcbiAgICBjZWxscyA9IG5ldyBBcnJheSgyMyk7XHJcblxyXG4gICAgcmVuZGVyOiBSZW5kZXJlcjIgPSBudWxsO1xyXG5cclxuXHJcbiAgICBjb25zdHJ1Y3RvcihcclxuICAgICAgICBpbmplY3RvcjogSW5qZWN0b3IsXHJcbiAgICAgICAgbmd6b25lOiBOZ1pvbmUsXHJcbiAgICAgICAgY2FsZW5kYXJSZWY6IEFwcG9pbnRtZW50Q2FsZW5kYXJDb21wb25lbnRcclxuICAgICkge1xyXG4gICAgICAgIHN1cGVyKGluamVjdG9yLCBuZ3pvbmUsIGNhbGVuZGFyUmVmKTtcclxuICAgICAgICB0aGlzLnJlbmRlciA9IHRoaXMuaW5qZWN0b3IuZ2V0KFJlbmRlcmVyMiwgbnVsbCk7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0Q3VzdG9tQ2xzKGl0ZW0sIHR5cDogXCJjbHNcIiB8IFwic3R5bGVzXCIgPSBcImNsc1wiKSB7XHJcbiAgICAgICAgbGV0IHJlc3VsdCA9IG51bGw7XHJcbiAgICAgICAgaWYgKHRoaXMuY3VzdG9tQ2xzKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHsgY2xzLCBzdHlsZXMgfSA9IHRoaXMuY3VzdG9tQ2xzKGl0ZW0pO1xyXG4gICAgICAgICAgICBpZiAoIWNscyAmJiAhc3R5bGVzICYmIHR5cCA9PT0gXCJjbHNcIikge1xyXG4gICAgICAgICAgICAgICAgcmVzdWx0ID0gdGhpcy5jdXN0b21DbHMoaXRlbSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodHlwID09IFwiY2xzXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSBjbHMgfHwgbnVsbDtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gc3R5bGVzIHx8IG51bGw7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIGlmIChyZXN1bHQgJiYgdHlwID09PSAnc3R5bGVzJykge1xyXG4gICAgICAgIC8vICAgICBPYmplY3Qua2V5cyhyZXN1bHQpLmZvckVhY2goKG46IGFueSkgPT4ge1xyXG4gICAgICAgIC8vICAgICAgICAgaWYgKHJlc3VsdFtuXS5pbmRleE9mKCdpbXBvcnRhbnQnKSA9PT0gLTEpIHtcclxuICAgICAgICAvLyAgICAgICAgICAgICByZXN1bHRbbl0gPSByZXN1bHRbbl0gKycgIWltcG9ydGFudCcgO1xyXG4gICAgICAgIC8vICAgICAgICAgfVxyXG4gICAgICAgIC8vICAgICB9KTtcclxuICAgICAgICAvLyB9XHJcblxyXG4gICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0QWN0aXZlSXRlbShpZD86IGFueSkge1xyXG4gICAgICAgIGxldCBfaWQgPSBpZDtcclxuICAgICAgICBpZiAoIWlkKSB7XHJcbiAgICAgICAgICAgIF9pZCA9IHRoaXMuc2VsZWN0SWQ7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChfaWQpIHtcclxuICAgICAgICAgICAgdGhpcy5hY3RpdmVJdGVtID0gZmxhdHRlbihcclxuICAgICAgICAgICAgICAgIHRoaXMuZGF0YS5tYXAoKG46IGFueSkgPT4gbi5yZXNlcnZlcylcclxuICAgICAgICAgICAgKS5maW5kKChuKSA9PiBuLmlkID09IF9pZCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIG9uQ2VsbENsaWNrKCRldmVudDogTW91c2VFdmVudCwgY2VsbEluZGV4LCByb29tSW5mbykge1xyXG4gICAgICAgIGNvbnN0IF9oID0gKCcnK2NlbGxJbmRleCkucGFkU3RhcnQoMiwgJzAnKTtcclxuICAgICAgICBjb25zdCBfZW5kSCA9ICgnJysoY2VsbEluZGV4ICsgMSkpLnBhZFN0YXJ0KDIsICcwJyk7XHJcbiAgICAgICAgY29uc3QgcCA9IHtcclxuICAgICAgICAgICAgc3RhcnQ6IGAke3RoaXMuY2FsZW5kYXJSZWZbXCJjdXJyZW50RGF0ZVN0clwiXX0gJHtfaH06MDA6MDBgLFxyXG4gICAgICAgICAgICBlbmQ6IGAke3RoaXMuY2FsZW5kYXJSZWZbXCJjdXJyZW50RGF0ZVN0clwiXX0gJHtfZW5kSH06MDA6MDBgLFxyXG4gICAgICAgICAgICBwbGFjZTogcm9vbUluZm8uZGF0YSxcclxuICAgICAgICB9O1xyXG4gICAgICAgIHRoaXMuY2VsbENsaWNrLmVtaXQocCk7XHJcbiAgICB9XHJcblxyXG5cclxuICAgIG9uTW91c2VFbnRlcigkZXZlbnQ6IE1vdXNlRXZlbnQpIHtcclxuICAgICAgICAkZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICAgICAgY29uc3QgcGFyZW50Q2VsbCA9ICRldmVudC50YXJnZXRbJ3BhcmVudEVsZW1lbnQnXS5xdWVyeVNlbGVjdG9yKCcuYWRkbmV3Jyk7XHJcbiAgICAgICAgaWYgKHBhcmVudENlbGwpIHtcclxuICAgICAgICAgICAgcGFyZW50Q2VsbC5zdHlsZS5vcGFjaXR5ID0gMDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgb25Nb3VzZUxlYXZlKCRldmVudDogTW91c2VFdmVudCkge1xyXG4gICAgICAgICRldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcclxuICAgICAgICBjb25zdCBwYXJlbnRDZWxsID0gJGV2ZW50LnRhcmdldFsncGFyZW50RWxlbWVudCddLnF1ZXJ5U2VsZWN0b3IoJy5hZGRuZXcnKTtcclxuICAgICAgICBpZiAocGFyZW50Q2VsbCkge1xyXG4gICAgICAgICAgICBwYXJlbnRDZWxsLnJlbW92ZUF0dHJpYnV0ZSgnc3R5bGUnKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gIFxyXG59XHJcbiJdfQ==
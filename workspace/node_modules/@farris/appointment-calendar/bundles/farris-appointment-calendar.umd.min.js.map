{"version":3,"sources":["ng://@farris/appointment-calendar/lib/appointment-calendar.service.ts","node_modules/tslib/tslib.es6.js","ng://@farris/appointment-calendar/lib/appointment-locales.ts","ng://@farris/appointment-calendar/lib/appointment-calendar.component.ts","ng://@farris/appointment-calendar/lib/views/base.view.component.ts","ng://@farris/appointment-calendar/lib/views/day-view.component.ts","ng://@farris/appointment-calendar/lib/views/week-view.component.ts","ng://@farris/appointment-calendar/lib/views/toolbar.component.ts","ng://@farris/appointment-calendar/lib/dblclick.directive.ts","ng://@farris/appointment-calendar/lib/views/detail-view.component.ts","ng://@farris/appointment-calendar/lib/appointment-calendar.module.ts"],"names":["AppointmentCalendarService","Injectable","this","cardBtnClick$","Subject","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__extends","__","constructor","prototype","create","__assign","assign","t","s","i","n","arguments","length","call","apply","__read","o","m","Symbol","iterator","r","e","ar","next","done","push","value","error","APPOINTMENT_CALENDAR_LOCALES","en","appointment","today","thisWeek","day","week","prevDay","prevWeek","nextDay","nextWeek","dateFormat","datePlace","weeks","一","二","三","四","五","六","日","detail","edit","del","close","zh-CHS","zh-CHT","AppointmentCalendarComponent","ngOnInit","groupData","mergeDate","showEditButton","editHandler","observers","showDeleteButton","removeHandler","minWeekViewWidth","weekCellWidth","placeNameWidth","rowWidth","ngOnChanges","changes","reserveData","isFirstChange","dataChanged","placeItems","ngOnDestroy","cardBtnClickSub","unsubscribe","ngAfterViewInit","loadReserveData","data","cd","detectChanges","loadPlaceData","_this","clearTimeout","setTimeout","roomBodyEl","elRef","nativeElement","querySelector","_a","_currentScrollPos","viewType","x","y","left","startTime","scrollLeft","scrollTop","scrollTo","onViewTypeChanged","$event","weekDays","dateValue","place","currentDateStr","currentDateRangeStr","filterChange","emit","onPlaceSelected","getUsedCells","reserves","startField_1","reserveInfoFields","startDate","endField_1","endDate","cells","map","startValue","utils","getValue","_startTimes","getTimes","endValue","_endTimes","beginIndex","hour","endIndex","c","flatten","filter","placeid","placeIdField","isSameDay","Date","id","idField","position","getReservePositionInfo","disableCells","weekday","date","items","sort","a","dateHlp","differenceInMinutes","dateStr","_startDate","formatTo","getHours","minute","getMinutes","split","reserveItem","startField","endField","width","startDateStr","endDateStr","onSelectChange","selectedId","item","currentSelectItem","room","tar","target","closest","getPositionForDetailPanel","detailCls","detailCustomCls","showDetail","selectChange","onItemDblClick","itemDblClick","selectItem","reserveId","undefined","clearSelect","clearSelected","ins","getFrameheaderHeight","_frameHeaderHeight","tabset","document","h","offsetHeight","frameHeader","getBoundingClientRect","top","right","bottom","height","panelSize","_left","_top","_right","window","innerWidth","_bottom","innerHeight","closeDetailPanel","roomSer","action","onAddNew","reservation","onScrollChange","typ","type","detailEventHandlers","Component","args","selector","template","providers","encapsulation","ViewEncapsulation","None","Injector","ChangeDetectorRef","NgZone","Renderer2","DateTimeHelperService","ElementRef","CommonUtils","LocaleService","Input","Output","ViewChild","injector","ngZone","render","localeSer","placeNameField","placeFullNameField","title","placeTitle","rowHeight","weekRowHeight","showCloseButton","detailColumnWidth","EventEmitter","reservationTitle","_CLICK_DELAY_","subscribe","setLocaleData","BaseViewComponent","setActiveItem","ngzone","runOutsideAngular","bodyRef","addEventListener","headerRef","calendarRef","scrollChange","overlaySer","registerMouseEvent","detailRef","el","contains","isClick","classList","nodeName","mouseUp","destory","selectId","getRoomData","roomid","find","onSubjectClick","stopPropagation","scrollIntoViewIfNeeded","activeItem","itemClick","ondblClick","onMouseDown","currentMousePointX","Math","floor","screenX","currentMousePointY","screenY","onMouseUp","OverLayHiddenService","get","tslib_1.__extends","DayViewComponent","getCustomCls","result","customCls","cls","styles","_id","onCellClick","cellIndex","roomInfo","_h","padStart","_endH","start","end","cellClick","onMouseEnter","parentCell","style","opacity","onMouseLeave","removeAttribute","_super","WeekViewComponent","arr","ToolbarComponent","initDate","rooms","places","__spread","concat","currentViewType","currentDateRange","currentDate","currentWeekDays","getWeekDate","baselineDate","_dateChanged","changeCalendarView","onDateButtonClicked","newDateStr","subDays","addDays","range","onDateChanged","isChanged","_date","newDate","dateChanged","onPlaceSelectChanged","placeChanged","ItemDblClickDirective","ondblclick","event","dblclickHandler","Directive","HostListener","ReserveDetailComponent","rooNameField","placeFieldConfigs","fullName","name","toolbarBtnClick","ser","getLength","str","strLength","Len","charCode","charCodeAt","subStrNum","len","strLen","strCut","charStr","charAt","encodeURI","fieldConfigs","titleLength","AppointmentCalendarModule","NgModule","declarations","imports","CommonModule","FormsModule","FarrisDatePickerModule","ComboListModule","FarrisCommonModule","forRoot","DateHelperModule","LocaleModule","DataColumnModule","exports"],"mappings":"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","sourcesContent":["import { Injectable } from '@angular/core';\r\nimport { Subject } from 'rxjs';\r\n\r\n@Injectable()\r\nexport class AppointmentCalendarService {\r\n\r\n  cardBtnClick$ = new Subject();\r\n\r\n  constructor() { }\r\n}\r\n","/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\nthis file except in compliance with the License. You may obtain a copy of the\r\nLicense at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\nMERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\nSee the Apache Version 2.0 License for specific language governing permissions\r\nand limitations under the License.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport function __exportStar(m, exports) {\r\n    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];\r\n}\r\n\r\nexport function __values(o) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator], i = 0;\r\n    if (m) return m.call(o);\r\n    return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\r\n    result.default = mod;\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n","export const APPOINTMENT_CALENDAR_LOCALES = {\r\n    'en': {\r\n        appointment: {\r\n            today: 'Today',\r\n            thisWeek: 'This week',\r\n            day: 'Day',\r\n            week: 'Week',\r\n            prevDay: 'Prev day',\r\n            prevWeek: 'Prev week',\r\n            nextDay: 'Next day',\r\n            nextWeek: 'Next week',\r\n            dateFormat: 'yyyy-MM-dd',\r\n            datePlace: 'Pleasy select a date.',\r\n            weeks: { ä¸: 'Mon', äº: 'Tue', ä¸: 'Wed', å: 'Thu', äº: 'Fri', å­: 'Sat',æ¥: 'Sun'},\r\n            detail: {\r\n                edit: 'Edit',\r\n                del: 'Delete',\r\n                close: 'Close',\r\n                dateFormat: 'MM-dd'\r\n            }\r\n        }\r\n    },\r\n    'zh-CHS': {\r\n        appointment: {\r\n            today: 'ä»å¤©',\r\n            thisWeek: 'æ¬å¨',\r\n            day: 'æ¥',\r\n            week: 'å¨',\r\n            prevDay: 'åä¸å¤©',\r\n            prevWeek: 'åä¸å¨',\r\n            nextDay: 'ä¸ä¸å¤©',\r\n            nextWeek: 'ä¸ä¸å¨',\r\n            dateFormat: 'yyyyå¹´MMæddæ¥',\r\n            datePlace: 'è¯·éæ©',\r\n            weeks: { ä¸: 'å¨ä¸', äº: 'å¨äº', ä¸: 'å¨ä¸', å: 'å¨å', äº: 'å¨äº', å­: 'å¨å­',æ¥: 'å¨æ¥' },\r\n            detail: {\r\n                edit: 'ç¼è¾',\r\n                del: 'å é¤',\r\n                close: 'å³é­',\r\n                dateFormat: 'MMæddæ¥'\r\n            }\r\n        }\r\n    },\r\n    'zh-CHT': {\r\n        appointment: {\r\n            today: 'ä»å¤©',\r\n            thisWeek: 'æ¬å¨',\r\n            day: 'æ¥',\r\n            week: 'å¨',\r\n            prevDay: 'åä¸å¤©',\r\n            prevWeek: 'åä¸å¨',\r\n            nextDay: 'ä¸ä¸å¤©',\r\n            nextWeek: 'ä¸ä¸å¨',\r\n            dateFormat: 'yyyyå¹´MMæddæ¥',\r\n            datePlace: 'è«é¸æ',\r\n            weeks: {  ä¸: 'å¨ä¸', äº: 'å¨äº', ä¸: 'å¨ä¸', å: 'å¨å', äº: 'å¨äº', å­: 'å¨å­', æ¥: 'å¨æ¥' },\r\n            detail: {\r\n                edit: 'ç·¨è¼¯',\r\n                del: 'åªé¤',\r\n                close: 'éé',\r\n                dateFormat: 'MMæddæ¥'\r\n            }\r\n        }\r\n    }\r\n}","import { AfterViewInit, ChangeDetectorRef, Component, ElementRef, EventEmitter, Injector, Input, NgZone, OnChanges, OnDestroy, OnInit, Output, Renderer2, SimpleChange, SimpleChanges, TemplateRef, ViewChild, ViewEncapsulation } from \"@angular/core\";\r\nimport { DateTimeHelperService } from \"@farris/ui-common/date\";\r\nimport { differenceInMinutes, isSameDay } from \"date-fns\";\r\nimport { CalendarViewType, AppointmentData, ViewTypeChangedParam, WeekDayItem, DetailColumn, DetailToolbarButton } from \"./models/calenday.types\";\r\nimport { AppointmentCalendarService } from \"./appointment-calendar.service\";\r\nimport { CommonUtils } from \"@farris/ui-common\";\r\nimport { Subscription } from \"rxjs\";\r\nimport { ReserveDetailComponent } from \"./views/detail-view.component\";\r\nimport { LocaleService } from \"@farris/ui-locale\";\r\nimport { APPOINTMENT_CALENDAR_LOCALES } from \"./appointment-locales\";\r\nimport { flatten } from \"lodash-es\";\r\n\r\n\r\n@Component({\r\n    selector: \"farris-appointment-calendar\",\r\n    templateUrl: './appointment-calendar.component.html',\r\n    // styleUrls: ['./appointment-calendar.component.css'],\r\n    providers: [\r\n        AppointmentCalendarService\r\n    ],\r\n    encapsulation: ViewEncapsulation.None\r\n})\r\nexport class AppointmentCalendarComponent implements OnInit, AfterViewInit, OnDestroy, OnChanges {\r\n\r\n    /** é¢å®æ°æ® */\r\n    @Input() reserveData = [];\r\n    /** æ¿é´åè¡¨æ°æ® */\r\n    @Input() placeItems = [];\r\n\r\n    /** æ¿é´æ è¯å­æ®µ é»è®¤ id */\r\n    @Input() placeIdField = 'id';\r\n    /** æ¿é´åç§°å­æ®µ */\r\n    @Input() placeNameField = 'name';\r\n    /** é¢å®å°ç¹å¨åç§° */\r\n    @Input() placeFullNameField = '';\r\n\r\n    /** é¢å®æ¶é´å­æ®µ */\r\n    @Input() reserveInfoFields = {\r\n        /** é¢è®¢æ è¯å­æ®µ */\r\n        idField: 'id',\r\n        /** å¼å§æ¶é´å­æ®µ */\r\n        startDate: 'start',\r\n        /** ç»ææ¶é´å­æ®µ */\r\n        endDate: 'end',\r\n        /** å¯¹åºæ¿é´ID å­æ®µ */\r\n        placeid: 'roomid',\r\n        /** é¢è®¢ä¸»é¢åç§°å­æ®µ */\r\n        title: 'title'\r\n    }\r\n\r\n    /** æ¿é´åç§°æ ¼å¼å */\r\n    @Input() roomNameFormatter: (item) => string;\r\n    /** æ¿é´åç§°èªå®ä¹æ¨¡æ¿ */\r\n    @Input() placeNameTemplate: TemplateRef<any>;\r\n    /** é¢å®åå®¹æ¨¡æ¿ */\r\n    @Input() contentTemplate: TemplateRef<any>;\r\n    /** è¯¦æå¡çæ¨¡æ¿ */\r\n    @Input() detailTemplate: TemplateRef<any>;\r\n    /** è¯¦æå¡çå¾½ç« æ¨¡æ¿ */\r\n    @Input() detailBadgeTemplate: TemplateRef<any>;\r\n    /** è¯¦æå¡çèªå®ä¹css ç±» */\r\n    @Input() detailCls:  ({item}) => { cls: { [className: string]: boolean}, styles: { [key: string]: any }};\r\n    /** æ¥è§å¾èªå®ä¹æ ·å¼ç±» */\r\n    @Input() dayViewCls: ({item}) => { cls: { [className: string]: boolean}, styles: { [key: string]: any }};\r\n\r\n    @Input() placeTitle = 'åç§°';\r\n\r\n    /** å¤©è§å¾è¡é«ï¼ é»è®¤ 62px */\r\n    @Input() rowHeight = 62;\r\n    /** å¨è§å¾è¡é«ï¼é»è®¤ 85px */\r\n    @Input() weekRowHeight = 85;\r\n    /** å¨è§å¾ååæ ¼å®½åº¦ï¼é»è®¤ 150px */\r\n    @Input() weekCellWidth = 150;\r\n    /** æ¿é´åå®½åº¦ï¼é»è®¤ 300px */\r\n    @Input() placeNameWidth = 300;\r\n    /** é»è®¤è§å¾ day æ¥ï¼ week å¨ã é»è®¤ day */\r\n    @Input() viewType: CalendarViewType = 'day';\r\n    /** æ¥è§å¾ä¸å¼å§æ¶é´ */\r\n    @Input() startTime = 7;\r\n\r\n    /** éä¸­é¢è®¢ä¿¡æ¯ID */\r\n    @Input() selectedId = '';\r\n    /** è¯¦æå¡çåä¿¡æ¯ */\r\n    @Input() detailColumns: Array<DetailColumn>;\r\n    /** è¯¦æå¡çæ¾ç¤ºç¼è¾æé® */\r\n    @Input() showEditButton = true;\r\n    /** è¯¦æå¡çæ¾ç¤ºå é¤æé® */\r\n    @Input() showDeleteButton = true;\r\n    @Input() showCloseButton = true;\r\n    /** è¯¦æå¡çæé®éç½® */\r\n    @Input() detailToolbars:Array<DetailToolbarButton>;\r\n    /** è¯¦æå¡çæ é¢åå®½åº¦ï¼é»è®¤ 56px æ¾ç¤ºä¸º4ä¸ªå­ */\r\n    @Input() detailColumnWidth = 56;\r\n\r\n    /** åå»äºä»¶ */\r\n    @Output() itemDblClick = new EventEmitter();\r\n\r\n    /** æ¥è§å¾ï¼é¼ æ æ»è¿ç©ºç½ååæ ¼æ¾ç¤ºææ¬ */\r\n    @Input() reservationTitle = 'é¢è®¢';\r\n\r\n    /** è¿æ»¤äºä»¶ */\r\n    @Output() filterChange = new EventEmitter();\r\n    /** éä¸­äºä»¶ */\r\n    @Output() selectChange = new EventEmitter();\r\n    /** å¡çè¯¦æç¼è¾äºä»¶ */\r\n    @Output() editHandler = new EventEmitter();\r\n    /** å¡çè¯¦æå é¤äºä»¶ */\r\n    @Output() removeHandler = new EventEmitter();\r\n    /** æ¸é¤éä¸­é¡¹ */\r\n    @Output() clearSelected = new EventEmitter();\r\n    /** æ¥è§å¾ååæ ¼ç¹å»äºä»¶ */\r\n    @Output() reservation = new EventEmitter();\r\n    \r\n    @ViewChild('detailRef') detailRef: ReserveDetailComponent;\r\n    \r\n    weekDays: Array<WeekDayItem> = [];\r\n    groupData: AppointmentData[] = [];\r\n\r\n    private currentDateRangeStr = '';\r\n    private currentDateStr = '';\r\n\r\n    currentSelectItem: { room: any, data: any } = null;\r\n    position = null;\r\n    showDetail = false;\r\n    detailCustomCls: {[clsName: string]: any} = null;\r\n\r\n    _CLICK_DELAY_ = 180;\r\n    // æ¡æ¶å¤´é«é«åº¦ï¼\r\n    _frameHeaderHeight = 0;\r\n\r\n    minWeekViewWidth = 0;\r\n\r\n    private _currentScrollPos: { [viewType: string]: { x: number, y: number } } = { 'day': {x: null,y: 0}, 'week': {x: null,y: 0}};\r\n    \r\n    rowWidth = 2450;\r\n\r\n    private cardBtnClickSub: Subscription;\r\n    constructor(private injector: Injector, private cd: ChangeDetectorRef, private ngZone: NgZone, private render: Renderer2, public roomSer: AppointmentCalendarService,\r\n            private dateHlp: DateTimeHelperService, private elRef: ElementRef, public utils: CommonUtils, private localeSer: LocaleService) {\r\n        this.cardBtnClickSub = this.roomSer.cardBtnClick$.subscribe((e: any) => {\r\n            this.detailEventHandlers(e);\r\n        });\r\n\r\n        this.localeSer.setLocaleData(APPOINTMENT_CALENDAR_LOCALES);\r\n    }\r\n\r\n    ngOnInit() {\r\n        this.groupData = this.mergeDate();\r\n\r\n        this.showEditButton = !!this.editHandler.observers.length;\r\n        this.showDeleteButton = !!this.removeHandler.observers.length;\r\n\r\n        this.minWeekViewWidth = (this.weekCellWidth || 150) * 7 + this.placeNameWidth;\r\n\r\n        this.rowWidth += this.placeNameWidth;\r\n    }\r\n\r\n    ngOnChanges(changes: SimpleChanges) {\r\n        if (changes.reserveData && !changes.reserveData.isFirstChange()) {\r\n            this.dataChanged();\r\n        }\r\n\r\n        if (changes.placeItems && !changes.placeItems.isFirstChange()) {\r\n            this.dataChanged();\r\n        }\r\n    }\r\n\r\n    ngOnDestroy(): void {\r\n        if ( this.cardBtnClickSub ) {\r\n            this.cardBtnClickSub.unsubscribe();\r\n            this.cardBtnClickSub = null;\r\n        }\r\n    }\r\n\r\n    ngAfterViewInit() {\r\n    }\r\n\r\n    loadReserveData(data: []) {\r\n        this.reserveData = data;\r\n        this.dataChanged();\r\n        this.cd.detectChanges();\r\n    }\r\n\r\n    loadPlaceData(data: []) {\r\n        this.placeItems = data;\r\n        this.dataChanged();\r\n        this.cd.detectChanges();\r\n    }\r\n\r\n    private dataChanged() {\r\n        this.groupData = this.mergeDate();\r\n        if (this['CALENDAR_SCROLL_POSITION']) {\r\n            clearTimeout(this['CALENDAR_SCROLL_POSITION']);\r\n        }\r\n        this['CALENDAR_SCROLL_POSITION'] = setTimeout(() => {\r\n            const roomBodyEl = this.elRef.nativeElement.querySelector('.body');\r\n            const { x, y } = this._currentScrollPos[this.viewType] || { x: null, y: null};\r\n            if (roomBodyEl) {\r\n                let left = x;\r\n                if (this.viewType === 'day' && x === null) {\r\n                    left = this.startTime * 100;\r\n                }\r\n                \r\n                roomBodyEl.scrollLeft = left;\r\n                roomBodyEl.scrollTop = y || 0;\r\n                roomBodyEl.scrollTo(left, y || 0)\r\n            }\r\n        }, 100);\r\n    }\r\n\r\n    onViewTypeChanged($event: ViewTypeChangedParam) {\r\n        const { viewType, weekDays, dateValue, place } = $event;\r\n        this.viewType = viewType;\r\n        this.weekDays = weekDays;\r\n\r\n        if (this.viewType === 'day') {\r\n            this.currentDateStr = dateValue;\r\n        } else {\r\n            this.currentDateRangeStr = dateValue;\r\n        }\r\n\r\n        this.dataChanged();\r\n\r\n        this.filterChange.emit( { viewType, dateValue, place });\r\n        this.cd.detectChanges();\r\n    }\r\n\r\n    onPlaceSelected($event: ViewTypeChangedParam) {\r\n        // TODO: æ¿é´åæ¢åï¼å®¢æ·ç«¯è¿æ»¤æ¿é´åè¡¨\r\n\r\n    }\r\n\r\n\r\n    private getUsedCells(reserves) {\r\n        if (reserves && reserves.length) {\r\n\r\n            const startField = this.reserveInfoFields.startDate;\r\n            const endField = this.reserveInfoFields.endDate;\r\n\r\n            const cells = reserves.map(n => {\r\n                const startValue = this.utils.getValue(startField, n.data);\r\n                const _startTimes = this.getTimes(startValue);\r\n\r\n                const endValue = this.utils.getValue(endField, n.data);\r\n                const _endTimes = this.getTimes(endValue);\r\n\r\n                const beginIndex = _startTimes.hour;\r\n                let endIndex = _endTimes.hour - 1;\r\n                // if (_endTimes.minute > 0) {\r\n                //     endIndex++;\r\n                // } else {\r\n                //     endIndex--;\r\n                // }\r\n\r\n                var c = [];\r\n                for(let i=beginIndex - 1; i< endIndex; i++) {\r\n                    c.push(i+1)\r\n                }\r\n\r\n                return c;\r\n            });\r\n\r\n            return flatten(cells);\r\n        }\r\n\r\n    }\r\n\r\n\r\n    private mergeDate(): AppointmentData[] {\r\n        if (this.placeItems && this.placeItems.length) {\r\n            if (this.viewType === 'day') {\r\n                return this.placeItems.map(n => {\r\n                    const reserves =  this.reserveData.filter(\r\n                        d => this.utils.getValue(this.reserveInfoFields.placeid,d) === this.utils.getValue(this.placeIdField, n) && \r\n                        isSameDay(new Date(this.utils.getValue(this.reserveInfoFields.startDate, d)), new Date(this.currentDateStr))\r\n                    ).map(r => {\r\n                        return {\r\n                            data: r,\r\n                            id: r[this.reserveInfoFields.idField],\r\n                            position: this.getReservePositionInfo(r),\r\n                        }\r\n                    });\r\n                    return {\r\n                        id: n[this.placeIdField],\r\n                        data: n,\r\n                        reserves,\r\n                        disableCells: this.getUsedCells(reserves)\r\n                    };\r\n                });\r\n            } else {\r\n                return this.placeItems.map(n => {\r\n                    return {\r\n                        id: n[this.placeIdField],\r\n                        data: n,\r\n                        reserves: this.weekDays.map((weekday: WeekDayItem) => {\r\n                            return {\r\n                                date: weekday,\r\n                                items: this.reserveData.filter(d => this.utils.getValue(\r\n                                    this.reserveInfoFields.placeid,d) === this.utils.getValue(this.placeIdField, n)  && \r\n                                    isSameDay(new Date(this.utils.getValue(this.reserveInfoFields.startDate, d)), weekday.date)\r\n                                ).map(r => {\r\n                                    return {\r\n                                        data: r,\r\n                                        id: r[this.reserveInfoFields.idField],\r\n                                    }\r\n                                }).sort((a, b) => {\r\n                                    const r = this.dateHlp.differenceInMinutes(new Date(this.utils.getValue(this.reserveInfoFields.startDate, a.data)), new Date(this.utils.getValue(this.reserveInfoFields.endDate, b.data)))\r\n                                    return r > 0 ? 1: r< 0? -1: 0;\r\n                                })\r\n                            }\r\n                        })\r\n                    };\r\n                });\r\n            }\r\n        }\r\n\r\n        return [];\r\n    }\r\n\r\n    getTimes(dateStr: string) {\r\n        if (dateStr) {\r\n            const _startDate = this.dateHlp.formatTo(dateStr, 'yyyy-MM-dd HH:mm:ss');\r\n            if (_startDate) {\r\n                const startDate = new Date(_startDate);\r\n                const hour = startDate.getHours();\r\n                const minute = startDate.getMinutes();\r\n\r\n                return {\r\n                    hour, minute, date: new Date(_startDate.split(' ')[0])\r\n                };\r\n            }\r\n        }\r\n\r\n        return null;\r\n    }\r\n\r\n    private getReservePositionInfo(reserveItem: any) {\r\n        const startField = this.reserveInfoFields.startDate;\r\n        const endField = this.reserveInfoFields.endDate;\r\n        let left = 0;\r\n        let width = 0;\r\n\r\n        const startDateStr = reserveItem[startField];\r\n        const endDateStr =  reserveItem[endField];\r\n\r\n        if (startDateStr) {\r\n            const _startTimes = this.getTimes(startDateStr);\r\n            if (_startTimes) {\r\n                const {hour, minute} = _startTimes;\r\n\r\n                left = (hour) * 100;\r\n                if (minute) {\r\n                    left += minute / 60 * 100;\r\n                }\r\n\r\n                if (endDateStr) {\r\n                    \r\n                    const minutes = differenceInMinutes(new Date(endDateStr), new Date(startDateStr));\r\n                    width = minutes / 60 * 100;\r\n                }\r\n            }\r\n        }\r\n\r\n        return {left, width};\r\n    }\r\n\r\n    onSelectChange($event) {\r\n        this.selectedId = $event.item.id;\r\n        this.currentSelectItem = {room: $event.room, data: $event.item.data};\r\n\r\n        let tar = null;\r\n        if (this.viewType === 'week') {\r\n            tar = $event.$event.target.closest('li')\r\n        } else {\r\n            tar = $event.$event.target.closest('.item-content')\r\n        }\r\n        this.getPositionForDetailPanel(tar);\r\n\r\n        if (this.detailCls) {\r\n            this.detailCustomCls = this.detailCls($event.item);\r\n        }\r\n\r\n        this.showDetail = true;\r\n\r\n        this.selectChange.emit($event);\r\n    }\r\n\r\n    onItemDblClick($event) {\r\n        this.selectedId = $event.item.id;\r\n        this.currentSelectItem = {room: $event.room, data: $event.item.data};\r\n        this.itemDblClick.emit($event);\r\n    }\r\n\r\n    selectItem(reserveId: any) {\r\n        this.selectedId = reserveId;\r\n        this.cd.detectChanges();\r\n        if (this.selectedId === null || this.selectedId === undefined || this.selectedId === '') {\r\n            this.clearSelect();\r\n        }\r\n    }\r\n\r\n    clearSelect() {\r\n        this.selectedId = null;\r\n        this.clearSelected.emit({ins: this});\r\n    }\r\n\r\n    private getFrameheaderHeight() {\r\n\r\n        if(this._frameHeaderHeight) {\r\n            return this._frameHeaderHeight;\r\n        }\r\n\r\n        const tabset: any = document.querySelector('.framework-tab-origin.gw-container-tabset.tab-container');\r\n        let h = 0;\r\n        if (tabset) {\r\n            h += tabset.offsetHeight;\r\n        }\r\n\r\n        const frameHeader: any = document.querySelector('.gw-header--wrapper.framework-tool-origin');\r\n        if (frameHeader) {\r\n            h += frameHeader.offsetHeight;\r\n        }\r\n\r\n        this._frameHeaderHeight = h;\r\n        return this._frameHeaderHeight;\r\n    }\r\n\r\n    private getPositionForDetailPanel(target: HTMLElement) {\r\n        const { left, top, right, bottom, width, height } = target.getBoundingClientRect();\r\n        const panelSize = { width: 368, height: 436 };\r\n\r\n        let _left = left;\r\n        let _top = top;\r\n\r\n        const _right = window.innerWidth - right;\r\n        const _bottom = window.innerHeight - bottom;\r\n\r\n\r\n        if (_left > _right) {\r\n            if ( _left > panelSize.width) {\r\n                _left = _left - panelSize.width;\r\n            } else {\r\n                if (window.innerWidth - left > panelSize.width) {\r\n                    _left = left;\r\n                } else {\r\n                    if (right > panelSize.width) {\r\n                        _left = right - panelSize.width;\r\n                    } else {\r\n                        _left = (window.innerWidth - panelSize.width) / 2;\r\n                    }\r\n                }\r\n            }\r\n        } else {\r\n            if (_right > panelSize.width) {\r\n                _left = right;\r\n            } else {\r\n                if(right > panelSize.width) {\r\n                    _left = left;\r\n                } else {\r\n                    _left = (window.innerWidth - panelSize.width) / 2;\r\n                }\r\n            }\r\n        }\r\n\r\n        if (_top > _bottom) {\r\n            if (_top > panelSize.height) {\r\n                if (left > panelSize.width || _right > panelSize.width) {\r\n                    if (window.innerHeight - _top < height + 40) {\r\n                        _top = window.innerHeight - panelSize.height - 20;\r\n                    } else {\r\n                        _top = top - panelSize.height + height + 40;\r\n                        if (_top < this.getFrameheaderHeight()) {\r\n                            _top = this.getFrameheaderHeight() + 10;\r\n                        }\r\n                    }\r\n                } else {\r\n                    _top = top - panelSize.height;\r\n                }\r\n            } else {\r\n                _top = 10 + this.getFrameheaderHeight();\r\n            }\r\n        } else {\r\n            if (_bottom > panelSize.height) {\r\n                if ( _right > panelSize.width || left > panelSize.width ) {\r\n                    _top = bottom - height - 40;\r\n                } else {\r\n                    _top = bottom;\r\n                }\r\n            } else {\r\n                _top = 10 + this.getFrameheaderHeight();\r\n            }\r\n        }\r\n\r\n        this.position = { left: _left, top: _top};\r\n    }\r\n\r\n    closeDetailPanel() {\r\n        this.roomSer.cardBtnClick$.next({action: 'close'});\r\n    }\r\n    \r\n    onAddNew($event) {\r\n        this.reservation.emit($event);\r\n    }\r\n\r\n    onScrollChange($event, typ) {\r\n        this._currentScrollPos[this.viewType] = {...$event, type: typ};\r\n    }\r\n\r\n    private detailEventHandlers(e: any) {\r\n        const { action, item, $event } = e;\r\n        let p = null;\r\n        if (item) {\r\n            p = { item: { data: item , id: this.utils.getValue(this.reserveInfoFields.idField, item) }};\r\n        }\r\n        switch(action) {\r\n            case 'edit':\r\n                this.editHandler.emit(p);\r\n                break;\r\n            case 'del':\r\n                this.removeHandler.emit(p);\r\n                break;\r\n            case 'close':\r\n                this.showDetail = false;\r\n                break;\r\n        }\r\n    }\r\n}\r\n","import { AfterViewInit, Component, ElementRef, EventEmitter, Injector, Input, NgZone, OnChanges, OnDestroy, OnInit, Output, SimpleChanges, ViewChild } from '@angular/core';\r\nimport { CommonUtils, OverLayHiddenService } from '@farris/ui-common';\r\nimport { AppointmentCalendarComponent } from '../appointment-calendar.component';\r\n\r\n@Component({\r\n    selector: 'appointment-base-view',\r\n    template: ''\r\n})\r\n\r\nexport class BaseViewComponent implements OnChanges, OnInit, AfterViewInit, OnDestroy {\r\n\r\n    @Input() data: [];\r\n    @Input() selectId = '';\r\n\r\n    @Output() itemClick = new EventEmitter();\r\n    @Output() itemDblClick = new EventEmitter();\r\n    \r\n\r\n    @ViewChild('header') headerRef: ElementRef<HTMLElement>;\r\n    @ViewChild('body') bodyRef: ElementRef<HTMLElement>;\r\n\r\n    @Output() scrollChange = new EventEmitter();\r\n\r\n    activeItem = null;\r\n\r\n    private overlaySer: OverLayHiddenService;\r\n    protected utils: CommonUtils;\r\n\r\n    private currentMousePointX = 0;\r\n    private currentMousePointY = 0;\r\n    private isClick = true;\r\n\r\n    constructor(protected injector: Injector, protected ngzone: NgZone, public calendarRef: AppointmentCalendarComponent) {\r\n        this.overlaySer = new OverLayHiddenService();\r\n        this.utils = this.injector.get(CommonUtils);\r\n    }\r\n\r\n    ngOnInit() {\r\n        this.setActiveItem();\r\n    }\r\n\r\n    ngAfterViewInit() {\r\n        this.ngzone.runOutsideAngular(() => {\r\n            this.bodyRef.nativeElement.addEventListener('scroll', (e) => {\r\n                const x = this.bodyRef.nativeElement.scrollLeft;\r\n                const y = this.bodyRef.nativeElement.scrollTop;\r\n                this.headerRef.nativeElement.scrollLeft = this.bodyRef.nativeElement.scrollLeft;\r\n                this.calendarRef.closeDetailPanel();\r\n\r\n                this.scrollChange.emit({ x, y });\r\n            });\r\n        });\r\n\r\n        if (this.overlaySer) {\r\n            this.overlaySer.registerMouseEvent(this.bodyRef.nativeElement, (e) => {\r\n                if (this.calendarRef.detailRef) {\r\n\r\n                    if (this.calendarRef.detailRef.el.nativeElement.contains(e.target)) {\r\n                        return;\r\n                    }\r\n\r\n                    if ( e.type !== 'mousewheel' && this.isClick) {\r\n                        if (this.calendarRef.viewType === 'week') {\r\n                            if (e.target.closest('li') && e.target.closest('li').classList.contains('week-day-subject') ) {\r\n                                return;\r\n                            }\r\n                        }\r\n    \r\n                        if (this.calendarRef.viewType === 'day') {\r\n                            if ( e.target.closest('div.item-content')) {\r\n                                return;\r\n                            }\r\n                        }\r\n                    }\r\n                    \r\n\r\n                    if (e.target.classList.contains('farris-modal') || e.target.closest('.farris-modal') ) {\r\n                        if (e.target.closest('farris-messager') && e.target.nodeName !== 'BUTTON') {\r\n                            return;\r\n                        }\r\n                    }\r\n\r\n                    this.calendarRef.closeDetailPanel();\r\n                }\r\n            }, { mouseUp: true });\r\n        }\r\n    }\r\n\r\n    ngOnDestroy(): void {\r\n        if (this.overlaySer) {\r\n            this.overlaySer.destory(this.bodyRef.nativeElement);\r\n            this.overlaySer = null;\r\n        }\r\n    }\r\n\r\n    ngOnChanges(changes: SimpleChanges): void {\r\n        if (changes.selectId && !changes.selectId.isFirstChange()) {\r\n            this.setActiveItem();\r\n        }\r\n\r\n        if (changes.data && !changes.data.isFirstChange()) {\r\n            this.setActiveItem();\r\n        }\r\n    }\r\n\r\n    setActiveItem(id?: any) {}\r\n\r\n    getRoomData(data) {\r\n        const roomid = this.utils.getValue(this.calendarRef.reserveInfoFields.placeid, data);\r\n        const room: any = this.data.find((n: any) => n.id === roomid);\r\n        if (room){\r\n            return room.data;\r\n        }\r\n        return null;\r\n    }\r\n\r\n\r\n    onSubjectClick($event, item) {\r\n        $event.stopPropagation();\r\n        if (!this.isClick) {\r\n            this.calendarRef.closeDetailPanel();\r\n            return;\r\n        }\r\n        if (this.calendarRef.viewType === 'week') {\r\n            $event.target.scrollIntoViewIfNeeded();\r\n        }\r\n\r\n        if (this['clickTimer']) {\r\n            clearTimeout(this['clickTimer']);\r\n        }\r\n        this['clickTimer'] = setTimeout(() => {\r\n            this.activeItem = item;\r\n            const room = this.getRoomData(item.data);\r\n            this.itemClick.emit({ item, $event, room });\r\n        }, this.calendarRef._CLICK_DELAY_);\r\n        \r\n    }\r\n\r\n    ondblClick($event: {item: any, $event: any}) {\r\n        if (this['clickTimer']) {\r\n            clearTimeout(this['clickTimer'])\r\n        }\r\n        this.activeItem = $event.item;\r\n        const room = this.getRoomData($event.item.data);\r\n        $event['room'] = room;\r\n        this.itemDblClick.emit($event);\r\n    }\r\n\r\n    onMouseDown($event) {\r\n        this.currentMousePointX = Math.floor($event.screenX);\r\n        this.currentMousePointY = Math.floor($event.screenY);\r\n    }\r\n\r\n    onMouseUp($event) {\r\n        this.isClick = this.currentMousePointX == Math.floor($event.screenX) && this.currentMousePointY == Math.floor($event.screenY);\r\n    }\r\n}","import {\r\n    Component,\r\n    EventEmitter,\r\n    Injector,\r\n    Input,\r\n    NgZone,\r\n    Output,\r\n    Renderer2,\r\n    ViewEncapsulation,\r\n} from \"@angular/core\";\r\nimport { AppointmentCalendarComponent } from \"../appointment-calendar.component\";\r\nimport { flatten } from \"lodash-es\";\r\nimport { BaseViewComponent } from \"./base.view.component\";\r\n@Component({\r\n    selector: \"day-view\",\r\n    templateUrl: \"day-view.component.html\",\r\n    encapsulation: ViewEncapsulation.None,\r\n    styles:[\r\n        `\r\n        .rtv-container .main .room-row .time-cell .addnew{\r\n  width: 100%;\r\n  height: 100%;\r\n  display: flex;\r\n  justify-content: center;\r\n  align-items: center;\r\n  border: 1px solid #2a87ff;\r\n  background: #edf5ff;\r\n  cursor: pointer;\r\n  opacity: 0;\r\n  transition: all 0.12s ease;\r\n  color: #045dd3;\r\n  font-size: 14px;\r\n  border-radius: 4px;\r\n}\r\n\r\n.rtv-container .main .room-row .time-cell:hover>.addnew {\r\n  opacity: 1;\r\n}\r\n\r\n        `\r\n    ]\r\n})\r\nexport class DayViewComponent extends BaseViewComponent {\r\n    @Input() customCls: ({ item }) => { [cls: string]: boolean };\r\n    @Input() reservationTitle = 'é¢è®¢';\r\n    @Output() cellClick = new EventEmitter();\r\n\r\n    cells = new Array(23);\r\n\r\n    render: Renderer2 = null;\r\n\r\n\r\n    constructor(\r\n        injector: Injector,\r\n        ngzone: NgZone,\r\n        calendarRef: AppointmentCalendarComponent\r\n    ) {\r\n        super(injector, ngzone, calendarRef);\r\n        this.render = this.injector.get(Renderer2, null);\r\n    }\r\n\r\n    getCustomCls(item, typ: \"cls\" | \"styles\" = \"cls\") {\r\n        let result = null;\r\n        if (this.customCls) {\r\n            const { cls, styles } = this.customCls(item);\r\n            if (!cls && !styles && typ === \"cls\") {\r\n                result = this.customCls(item);\r\n            } else {\r\n                if (typ == \"cls\") {\r\n                    result = cls || null;\r\n                } else {\r\n                    result = styles || null;\r\n                }\r\n            }\r\n        }\r\n\r\n        // if (result && typ === 'styles') {\r\n        //     Object.keys(result).forEach((n: any) => {\r\n        //         if (result[n].indexOf('important') === -1) {\r\n        //             result[n] = result[n] +' !important' ;\r\n        //         }\r\n        //     });\r\n        // }\r\n\r\n        return result;\r\n    }\r\n\r\n    setActiveItem(id?: any) {\r\n        let _id = id;\r\n        if (!id) {\r\n            _id = this.selectId;\r\n        }\r\n        if (_id) {\r\n            this.activeItem = flatten(\r\n                this.data.map((n: any) => n.reserves)\r\n            ).find((n) => n.id == _id);\r\n        }\r\n    }\r\n\r\n    onCellClick($event: MouseEvent, cellIndex, roomInfo) {\r\n        const _h = (''+cellIndex).padStart(2, '0');\r\n        const _endH = (''+(cellIndex + 1)).padStart(2, '0');\r\n        const p = {\r\n            start: `${this.calendarRef[\"currentDateStr\"]} ${_h}:00:00`,\r\n            end: `${this.calendarRef[\"currentDateStr\"]} ${_endH}:00:00`,\r\n            place: roomInfo.data,\r\n        };\r\n        this.cellClick.emit(p);\r\n    }\r\n\r\n\r\n    onMouseEnter($event: MouseEvent) {\r\n        $event.stopPropagation();\r\n        const parentCell = $event.target['parentElement'].querySelector('.addnew');\r\n        if (parentCell) {\r\n            parentCell.style.opacity = 0;\r\n        }\r\n    }\r\n\r\n    onMouseLeave($event: MouseEvent) {\r\n        $event.stopPropagation();\r\n        const parentCell = $event.target['parentElement'].querySelector('.addnew');\r\n        if (parentCell) {\r\n            parentCell.removeAttribute('style');\r\n        }\r\n    }\r\n\r\n  \r\n}\r\n","import { Component, Injector, Input, NgZone, ViewEncapsulation } from '@angular/core';\r\nimport { WeekDayItem } from '../models/calenday.types';\r\nimport { AppointmentCalendarComponent } from '../appointment-calendar.component';\r\nimport { flatten } from 'lodash-es';\r\nimport { BaseViewComponent } from './base.view.component';\r\n\r\n@Component({\r\n    selector: 'week-view',\r\n    templateUrl: 'week-view.component.html',\r\n    encapsulation: ViewEncapsulation.None\r\n})\r\n\r\nexport class WeekViewComponent extends BaseViewComponent {\r\n\r\n    @Input() weekDays: Array<WeekDayItem> = [];\r\n    @Input() width; \r\n\r\n    constructor(injector: Injector, ngzone: NgZone, calendarRef: AppointmentCalendarComponent) {\r\n        super(injector, ngzone, calendarRef)\r\n    }\r\n\r\n    setActiveItem(id?: any) {\r\n        let _id = id;\r\n        if (!id) {\r\n            _id = this.selectId;\r\n        }\r\n        if (_id) {\r\n            const arr =  flatten(this.data.map((n: any)=>n.reserves.map(t => t.items)));\r\n            this.activeItem = flatten(arr).find(n => n.id == _id);\r\n        }\r\n    }\r\n}","import { AfterViewInit, Component, EventEmitter, Injector, Input, OnChanges, OnInit, Output, SimpleChanges, ViewEncapsulation } from '@angular/core';\r\nimport { DateTimeHelperService } from '@farris/ui-common/date';\r\nimport { addDays, subDays } from 'date-fns';\r\nimport { AppointmentCalendarComponent } from '../appointment-calendar.component';\r\nimport { CalendarViewType, ViewTypeChangedParam } from '../models/calenday.types';\r\n\r\n@Component({\r\n    selector: 'toolbar',\r\n    templateUrl: 'toolbar.component.html',\r\n    encapsulation: ViewEncapsulation.None\r\n})\r\n\r\nexport class ToolbarComponent implements OnInit, OnChanges, AfterViewInit {\r\n\r\n    @Output() dateChanged = new EventEmitter<ViewTypeChangedParam>();\r\n    @Output() placeChanged = new EventEmitter();\r\n\r\n    currentDate = '';\r\n    currentDateRange = '';\r\n    currentWeekDays = [];\r\n    \r\n    @Input() currentViewType: CalendarViewType = 'day';\r\n    @Input() places = [];\r\n    @Input() placeIdField = 'id';\r\n    @Input() placeNameField = 'name';\r\n\r\n\r\n    constructor(private dateHlp: DateTimeHelperService, private injector: Injector, public calendarRef: AppointmentCalendarComponent) { }\r\n\r\n    ngOnInit() {\r\n        this.initDate();\r\n    }\r\n\r\n    ngOnChanges(changes: SimpleChanges): void {\r\n        if (changes.rooms && !changes.rooms.isFirstChange()) {\r\n            this.places = [{ [this.placeIdField]: '', [this.placeNameField]: 'å¨é¨åºæ' }, ...this.places];\r\n        }\r\n    }\r\n\r\n    ngAfterViewInit() {}\r\n\r\n    private initDate() {\r\n        if (this.currentViewType === 'week' && !this.currentDateRange ) {\r\n            this.currentWeekDays = this.dateHlp.getWeekDate({ baselineDate: new Date()});\r\n            this.currentDateRange = this.currentWeekDays[0].dateStr + '~' + this.currentWeekDays[6].dateStr;\r\n        } else {\r\n            if (!this.currentDate) {\r\n                this.currentDate = this.dateHlp.formatTo(new Date(), 'yyyy-MM-dd');\r\n            }\r\n        }\r\n\r\n        this._dateChanged();\r\n    }\r\n\r\n    changeCalendarView($event: MouseEvent, viewType: CalendarViewType) {\r\n        if ($event) {\r\n            $event.stopPropagation();\r\n        }\r\n        this.currentViewType = viewType;\r\n        this.initDate();\r\n    }\r\n\r\n    onDateButtonClicked($event: MouseEvent, typ: number) {\r\n        let baselineDate: any = new Date();\r\n        if (this.currentViewType === 'day') {\r\n\r\n            if (this.currentDate) {\r\n                baselineDate = new Date(this.currentDate);\r\n            }\r\n\r\n            let newDateStr = this.dateHlp.formatTo(new Date(), 'yyyy-MM-dd');\r\n            if (typ === -1) {\r\n                const d = this.dateHlp.formatTo(subDays(baselineDate, 1), 'yyyy-MM-dd')\r\n                newDateStr = this.dateHlp.formatTo(d);\r\n            } else if (typ === 1) {\r\n                const d = this.dateHlp.formatTo(addDays(baselineDate, 1), 'yyyy-MM-dd')\r\n                newDateStr = this.dateHlp.formatTo(d);\r\n            }\r\n\r\n            this.currentDate = newDateStr;\r\n           \r\n        } else {\r\n            \r\n            if (this.currentWeekDays && this.currentWeekDays.length) {\r\n                baselineDate = this.currentWeekDays[4].date;\r\n            }\r\n            // ä¸å¨\r\n            if (typ === 1) {\r\n                this.currentWeekDays = this.dateHlp.getWeekDate({ baselineDate, range: 7});\r\n            } else if (typ === -1) { // ä¸å¨\r\n                this.currentWeekDays = this.dateHlp.getWeekDate({ baselineDate, range: -7});\r\n            } else { // å½åå¨\r\n                baselineDate = new Date();\r\n                this.currentWeekDays =  this.dateHlp.getWeekDate({ baselineDate});\r\n            }\r\n\r\n            this.currentDateRange = this.currentWeekDays[0].dateStr + '~' + this.currentWeekDays[6].dateStr;\r\n            // console.log(this.currentWeekDays);\r\n        }\r\n\r\n        this._dateChanged();\r\n    }\r\n\r\n    onDateChanged($event: string) {\r\n\r\n        let isChanged = false;\r\n        if (this.currentViewType == 'week') {\r\n            const _date = $event.split('~')[0];\r\n            this.currentWeekDays =  this.dateHlp.getWeekDate({ baselineDate: new Date(_date)});\r\n\r\n            isChanged = this.currentDateRange !== $event;\r\n        } else {\r\n            isChanged = this.currentDate !== $event;\r\n        }\r\n        \r\n        if (isChanged) {\r\n            this._dateChanged($event);\r\n        }\r\n    }\r\n\r\n    private _dateChanged(newDate?: string) {\r\n        if (newDate) {\r\n            if (this.currentViewType === 'day' ) {\r\n                this.currentDate = newDate;\r\n            } else {\r\n                this.currentDateRange = newDate;\r\n            }\r\n        }\r\n\r\n        this.dateChanged.emit({ \r\n            viewType: this.currentViewType,\r\n            dateValue: this.currentViewType === 'day' ? this.currentDate : this.currentDateRange, \r\n            weekDays: this.currentWeekDays\r\n        });\r\n\r\n        this.calendarRef.closeDetailPanel();\r\n    }\r\n\r\n    onPlaceSelectChanged($event) {\r\n        const { data } = $event;\r\n        this.placeChanged.emit({ \r\n            viewType: this.currentViewType,\r\n            dateValue: this.currentViewType === 'day' ? this.currentDate : this.currentDateRange, \r\n            weekDays: this.currentWeekDays,\r\n            room: data.id ? data : null\r\n        });\r\n    }\r\n}","import { EventEmitter, Directive, ElementRef, HostListener, Input, Output } from '@angular/core';\r\n\r\n\r\n@Directive({ selector: '[item-dblclick]' })\r\nexport class ItemDblClickDirective {\r\n\r\n    @Input('item-dblclick') data;\r\n    @Output() dblclickHandler = new EventEmitter();\r\n\r\n    constructor(public el: ElementRef) {\r\n    }\r\n\r\n    ngOnInit() {}\r\n\r\n    @HostListener('dblclick', ['$event'])\r\n    ondblclick(event: Event) {\r\n        event.stopPropagation();\r\n        this.dblclickHandler.emit({ item: this.data, $event: event });\r\n    }\r\n\r\n}","\r\nimport { Component, ElementRef, Injector, Input, OnInit, TemplateRef, EventEmitter } from '@angular/core';\r\nimport { AppointmentCalendarService } from '../appointment-calendar.service';\r\nimport { DetailColumn, DetailToolbarButton } from '../models/calenday.types';\r\n\r\n@Component({\r\n    selector: 'reserve-detail',\r\n    template: `\r\n      <div class=\"reserve-detail-container\" style=\"position: fixed; z-index: 99\" [style.left.px]=\"position?.left\" [style.top.px]=\"position?.top\">\r\n        <div class=\"detail-header\" [ngClass]=\"getCustomCls()\" [ngStyle]=\"getCustomCls('styles')\">\r\n            <div class=\"detail-toolbar\" *ngIf=\"!toolbarButtons || !toolbarButtons.length\">\r\n                <span *ngIf=\"showEditButton\" class=\"f-icon f-icon f-icon-new-edit\" title=\"{{ 'appointment.detail.edit' | locale }}\" (click)=\"toolbarBtnClick($event, 'edit')\"></span>\r\n                <span *ngIf=\"showDeleteButton\" class=\"f-icon f-icon-trash\" title=\"{{ 'appointment.detail.del' | locale }}\" (click)=\"toolbarBtnClick($event, 'del')\"></span>\r\n                <span *ngIf=\"showCloseButton\" class=\"f-icon f-icon-close\" title=\"{{ 'appointment.detail.close' | locale }}\" (click)=\"toolbarBtnClick($event, 'close')\"></span>\r\n            </div>\r\n\r\n            <div class=\"detail-toolbar\" *ngIf=\"toolbarButtons && toolbarButtons.length\">\r\n                <span *ngFor=\"let btn of toolbarButtons\" class=\"{{ btn.icon }}\" title=\"{{ btn.title }}\" [style.display]=\"btn.visible ? '': 'none'\"\r\n                    (click)=\"!btn.disable && btn.handler && btn.handler({ item: data, $event: $event })\"></span>\r\n                <span *ngIf=\"showCloseButton\" class=\"f-icon f-icon-close\" title=\"{{ 'appointment.detail.close' | locale }}\" (click)=\"toolbarBtnClick($event, 'close')\"></span>\r\n            </div>\r\n\r\n            <div class=\"detail-title\">\r\n \r\n                <span class=\"detail-place\">\r\n                    {{rooNameField | getvalue: placeInfo}}\r\n                </span>\r\n                <div class=\"title-content\" style='word-break:break-all; font-family:-apple-system,BlinkMacSystemFont,\"Segoe UI\",\"PingFang SC\",\"Hiragino Sans GB\",\"Microsoft YaHei\",\"Helvetica Neue\",Helvetica,Arial,sans-serif' title=\"{{fieldConfigs.title}}\">\r\n                    {{subStrNum(fieldConfigs.title | getvalue: data, titleLength)}}\r\n                    <!-- <span class=\"detail-label\">ä¸é¡¹ä¼è®®</span> -->\r\n                    <ng-container [ngTemplateOutlet]=\"badgeTemplate\" [ngTemplateOutletContext]=\"{ $implicit: {data: data}, item: data }\"></ng-container>\r\n                </div>\r\n                <div class=\"detail-timer\">\r\n                    {{ fieldConfigs.startDate| getvalue: data | dateformat: ('appointment.detail.dateFormat'|locale) }} {{ fieldConfigs.startDate| getvalue: data | dateformat: 'HH:mm' }} \r\n                    &nbsp;-&nbsp;\r\n                    {{ fieldConfigs.endDate | getvalue: data | dateformat: ('appointment.detail.dateFormat'|locale) }} {{ fieldConfigs.endDate | getvalue: data | dateformat: 'HH:mm' }} \r\n                    <!-- 9æ4æ¥ï¼ä»å¤©ï¼08:00 â 9æ7æ¥ï¼å¨ä¸ï¼17:30 -->\r\n                </div>\r\n            </div>\r\n        </div>\r\n        <div class=\"detail-info-content  win11Scroll nobtn\" [ngStyle]=\"getCustomCls('detail')\">\r\n            <ng-container [ngTemplateOutlet]=\"detailTemplate\" [ngTemplateOutletContext]=\"{ $implicit: {data: data}, item: data }\"></ng-container>\r\n            <ul *ngIf=\"!detailTemplate\">\r\n                <li *ngFor=\"let col of columns\">\r\n                    <ng-container *ngIf=\"!col.template\">\r\n                        <span class=\"detail-subtitle\" [style.width.px]=\"detailColumnWidth\" [style.minWidth.px]=\"detailColumnWidth\" [title]=\"col.title\">{{col.title}}</span> \r\n                        <span class=\"detail-content  d-flex flex-row\" *ngIf=\"!col.formatter\">\r\n                            <span class=\"colon\"></span>    \r\n                            <span class=\"text\">{{ col.field | getvalue: data: true}}</span>\r\n                        </span>\r\n                        <span class=\"detail-content  d-flex flex-row\" *ngIf=\"col.formatter\">\r\n                            <span class=\"colon\"></span>\r\n                            <span class=\"text\" [innerHtml]=\" col.field | getvalue: data | columnformatter: col : data | safe: 'html'\"></span>\r\n                        </span>\r\n                    </ng-container>\r\n                    <ng-container *ngIf=\"col.template\"  [ngTemplateOutlet]=\"col.template\" [ngTemplateOutletContext]=\"{ $implicit: {data: data, field: col.field, label: col.title}, item: data }\">\r\n                    </ng-container>\r\n                </li>\r\n                \r\n            </ul>\r\n        </div>\r\n    </div>\r\n\r\n    `,\r\n    styles: [\r\n        `\r\n            .detail-subtitle {\r\n               text-align: justify;text-align-last: justify;white-space: nowrap;overflow: hidden;text-overflow: ellipsis;\r\n            }\r\n            .detail-content>.colon:before {\r\n                content: 'ï¼'\r\n            }\r\n\r\n            .detail-content>.text {\r\n                word-break: break-all;\r\n            }\r\n        `\r\n    ]\r\n})\r\n\r\nexport class ReserveDetailComponent implements OnInit {\r\n    /** é¢å®æ°æ® */\r\n    @Input() data: any;\r\n    /** å¼¹åºé¢æ¿ä½ç½® */\r\n    @Input() position: { left: number, top: number } = null;\r\n    /** é¢å®è¯¦æå­æ®µ */\r\n    @Input() columns: Array<DetailColumn>\r\n    /** é¢å®è¯¦ææ¨¡æ¿ */\r\n    @Input() detailTemplate: TemplateRef<any>;\r\n    /** å¾½ç« æ¢°æ¿ */\r\n    @Input() badgeTemplate: TemplateRef<any>;\r\n    /** é¢å®ä¿¡æ¯å­æ®µéç½® */\r\n    @Input() fieldConfigs = null;\r\n    /** é¢å®å°ç¹ä¿¡æ¯ */\r\n    @Input() placeInfo: any;\r\n    /** é¢å®å°ç¹å­æ®µéç½® */\r\n    @Input() placeFieldConfigs = null;\r\n\r\n    @Input() customCls: { [className:string]: any } = null;\r\n\r\n    @Input() showEditButton = true;\r\n    @Input() showDeleteButton = true;\r\n    @Input() showCloseButton = true;\r\n    @Input() toolbarButtons: Array<DetailToolbarButton>;\r\n\r\n    @Input() detailColumnWidth = 56;\r\n\r\n    @Input() titleLength = 52;\r\n\r\n    rooNameField = 'name';\r\n\r\n    constructor(private injector: Injector, private ser: AppointmentCalendarService, public el: ElementRef) { }\r\n\r\n    ngOnInit() {\r\n        this.rooNameField = this.placeFieldConfigs.fullName || this.placeFieldConfigs.name;\r\n    }\r\n\r\n\r\n    toolbarBtnClick($event: MouseEvent, t) {\r\n        $event.stopPropagation();\r\n        this.ser.cardBtnClick$.next({ $event, action: t, item: this.data });\r\n    }\r\n\r\n    getCustomCls(typ: 'cls' | 'styles' | 'detail' = 'cls') {\r\n        let result = null;\r\n        if (this.customCls) {\r\n            if (!this.customCls['cls'] && !this.customCls['cls'] && typ == 'cls') {\r\n                result = this.customCls;\r\n            } else {\r\n                result = this.customCls[typ] || {};\r\n            }\r\n        }\r\n\r\n        // if (typ === 'styles' || typ === 'detail') {\r\n        //     Object.keys(result).forEach((n: any) => {\r\n        //         if (result[n].indexOf('important') === -1) {\r\n        //             result[n] = result[n] +' !important' ;\r\n        //         }\r\n        //     });\r\n        // }\r\n\r\n        return result;\r\n    }\r\n    getLength(str){\r\n        let strLength=0; // è®°å½strçæ»é¿åº¦\r\n        const Len = str.length;\r\n        for(let i=0;i<Len;i++){\r\n            var charCode = str.charCodeAt(i);// ä½¿ç¨charCodeAtè¿ååä¸ªå­ç¬¦çUnicodeç¼ç \r\n            if(charCode>=0 && charCode<=128){\r\n                strLength++; //è±æå­ç¬¦å 1\r\n            }else {\r\n                strLength= strLength+2;//ä¸­æå­ç¬¦å 2\r\n            }\r\n        }\r\n        return strLength;\r\n    }\r\n\r\n    subStrNum(str,len) {\r\n        const strLen = str.length;\r\n        let strCut = '';\r\n        let strLength =0;\r\n        for(let i=0;i<strLen;i++){\r\n            var charStr = str.charAt(i); //ä½¿ç¨charAtè·ååä¸ªå­ç¬¦ï¼\r\n            strLength++\r\n            if(encodeURI(charStr).length>4){ //ä½¿ç¨encodeURIè·åç¼ç é¿åº¦\r\n                strLength++;\r\n            }\r\n            strCut = strCut.concat(charStr);//åä¸ªå­ç¬¦è¿è¡åå¹¶\r\n            if(strLength >= len){\r\n                strCut = strCut.concat('...') //å¤§äºæå®é¿åº¦ååå¹¶'...'å¹¶è¿åæ­¤å­ç¬¦ä¸²\r\n                return strCut;\r\n            }\r\n        }\r\n        if(strLength<len){\r\n            return str;\r\n        }\r\n    }\r\n}","import { CommonModule } from \"@angular/common\";\r\nimport { NgModule } from \"@angular/core\";\r\nimport { FormsModule } from \"@angular/forms\";\r\nimport { ComboListModule } from \"@farris/ui-combo-list\";\r\nimport { FarrisCommonModule } from \"@farris/ui-common\";\r\nimport { DateHelperModule } from \"@farris/ui-common/date\";\r\nimport { FarrisDatePickerModule } from \"@farris/ui-datepicker\";\r\n\r\nimport { AppointmentCalendarComponent } from \"./appointment-calendar.component\";\r\nimport { DayViewComponent } from \"./views/day-view.component\";\r\nimport { WeekViewComponent } from \"./views/week-view.component\";\r\nimport { ToolbarComponent } from \"./views/toolbar.component\";\r\nimport { ItemDblClickDirective } from \"./dblclick.directive\";\r\nimport { ReserveDetailComponent } from \"./views/detail-view.component\";\r\nimport { BaseViewComponent } from \"./views/base.view.component\";\r\nimport { LocaleModule } from \"@farris/ui-locale\";\r\nimport { DataColumnModule } from \"@farris/ui-common/column\";\r\n\r\n@NgModule({\r\n    declarations: [\r\n        ToolbarComponent,\r\n        DayViewComponent,\r\n        WeekViewComponent,\r\n        AppointmentCalendarComponent,\r\n        ItemDblClickDirective,\r\n        ReserveDetailComponent,\r\n        BaseViewComponent\r\n    ],\r\n    imports: [\r\n        CommonModule,\r\n        FormsModule,\r\n        FarrisDatePickerModule,\r\n        ComboListModule,\r\n        FarrisCommonModule.forRoot(),\r\n        DateHelperModule.forRoot(),\r\n        LocaleModule.forRoot(),\r\n        DataColumnModule.forRoot(),\r\n    ],\r\n    exports: [\r\n        ToolbarComponent,\r\n        DayViewComponent,\r\n        WeekViewComponent,\r\n        AppointmentCalendarComponent,\r\n        ItemDblClickDirective,\r\n        ReserveDetailComponent,\r\n        BaseViewComponent\r\n    ],\r\n})\r\nexport class AppointmentCalendarModule {}\r\n"]}
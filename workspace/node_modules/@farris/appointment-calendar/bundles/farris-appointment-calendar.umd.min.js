!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("rxjs"),require("@angular/common"),require("@angular/forms"),require("@farris/ui-combo-list"),require("@farris/ui-datepicker"),require("@farris/ui-common"),require("lodash-es"),require("@farris/ui-common/date"),require("date-fns"),require("@angular/core"),require("@farris/ui-locale"),require("@farris/ui-common/column")):"function"==typeof define&&define.amd?define("@farris/appointment-calendar",["exports","rxjs","@angular/common","@angular/forms","@farris/ui-combo-list","@farris/ui-datepicker","@farris/ui-common","lodash-es","@farris/ui-common/date","date-fns","@angular/core","@farris/ui-locale","@farris/ui-common/column"],t):t((e.farris=e.farris||{},e.farris["appointment-calendar"]={}),e.rxjs,e.ng.common,e.ng.forms,e.uiComboList,e.uiDatepicker,e.uiCommon,e.lodashEs,e.date,e.dateFns,e.ng.core,e.uiLocale,e.column)}(this,function(e,t,n,a,i,r,l,s,o,d,p,c,u){"use strict";var m=(h.decorators=[{type:p.Injectable}],h.ctorParameters=function(){return[]},h);function h(){this.cardBtnClick$=new t.Subject}var f=function(e,t){return(f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function y(e,t){function n(){this.constructor=e}f(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var v=function(){return(v=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function g(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var a,i,r=n.call(e),l=[];try{for(;(void 0===t||0<t--)&&!(a=r.next()).done;)l.push(a.value)}catch(s){i={error:s}}finally{try{a&&!a.done&&(n=r["return"])&&n.call(r)}finally{if(i)throw i.error}}return l}var w={en:{appointment:{today:"Today",thisWeek:"This week",day:"Day",week:"Week",prevDay:"Prev day",prevWeek:"Prev week",nextDay:"Next day",nextWeek:"Next week",dateFormat:"yyyy-MM-dd",datePlace:"Pleasy select a date.",weeks:{"一":"Mon","二":"Tue","三":"Wed","四":"Thu","五":"Fri","六":"Sat","日":"Sun"},detail:{edit:"Edit",del:"Delete",close:"Close",dateFormat:"MM-dd"}}},"zh-CHS":{appointment:{today:"今天",thisWeek:"本周",day:"日",week:"周",prevDay:"前一天",prevWeek:"前一周",nextDay:"下一天",nextWeek:"下一周",dateFormat:"yyyy年MM月dd日",datePlace:"请选择",weeks:{"一":"周一","二":"周二","三":"周三","四":"周四","五":"周五","六":"周六","日":"周日"},detail:{edit:"编辑",del:"删除",close:"关闭",dateFormat:"MM月dd日"}}},"zh-CHT":{appointment:{today:"今天",thisWeek:"本周",day:"日",week:"周",prevDay:"前一天",prevWeek:"前一周",nextDay:"下一天",nextWeek:"下一周",dateFormat:"yyyy年MM月dd日",datePlace:"請選擇",weeks:{"一":"周一","二":"周二","三":"周三","四":"周四","五":"周五","六":"周六","日":"周日"},detail:{edit:"編輯",del:"刪除",close:"關閉",dateFormat:"MM月dd日"}}}},C=(D.prototype.ngOnInit=function(){this.groupData=this.mergeDate(),this.showEditButton=!!this.editHandler.observers.length,this.showDeleteButton=!!this.removeHandler.observers.length,this.minWeekViewWidth=7*(this.weekCellWidth||150)+this.placeNameWidth,this.rowWidth+=this.placeNameWidth},D.prototype.ngOnChanges=function(e){e.reserveData&&!e.reserveData.isFirstChange()&&this.dataChanged(),e.placeItems&&!e.placeItems.isFirstChange()&&this.dataChanged()},D.prototype.ngOnDestroy=function(){this.cardBtnClickSub&&(this.cardBtnClickSub.unsubscribe(),this.cardBtnClickSub=null)},D.prototype.ngAfterViewInit=function(){},D.prototype.loadReserveData=function(e){this.reserveData=e,this.dataChanged(),this.cd.detectChanges()},D.prototype.loadPlaceData=function(e){this.placeItems=e,this.dataChanged(),this.cd.detectChanges()},D.prototype.dataChanged=function(){var r=this;this.groupData=this.mergeDate(),this.CALENDAR_SCROLL_POSITION&&clearTimeout(this.CALENDAR_SCROLL_POSITION),this.CALENDAR_SCROLL_POSITION=setTimeout(function(){var e=r.elRef.nativeElement.querySelector(".body"),t=r._currentScrollPos[r.viewType]||{x:null,y:null},n=t.x,a=t.y;if(e){var i=n;"day"===r.viewType&&null===n&&(i=100*r.startTime),e.scrollLeft=i,e.scrollTop=a||0,e.scrollTo(i,a||0)}},100)},D.prototype.onViewTypeChanged=function(e){var t=e.viewType,n=e.weekDays,a=e.dateValue,i=e.place;this.viewType=t,this.weekDays=n,"day"===this.viewType?this.currentDateStr=a:this.currentDateRangeStr=a,this.dataChanged(),this.filterChange.emit({viewType:t,dateValue:a,place:i}),this.cd.detectChanges()},D.prototype.onPlaceSelected=function(e){},D.prototype.getUsedCells=function(e){var c=this;if(e&&e.length){var d=this.reserveInfoFields.startDate,p=this.reserveInfoFields.endDate,t=e.map(function(e){for(var t=c.utils.getValue(d,e.data),n=c.getTimes(t),a=c.utils.getValue(p,e.data),i=c.getTimes(a),r=n.hour,l=i.hour-1,s=[],o=r-1;o<l;o++)s.push(o+1);return s});return s.flatten(t)}},D.prototype.mergeDate=function(){var a=this;return this.placeItems&&this.placeItems.length?"day"===this.viewType?this.placeItems.map(function(t){var e=a.reserveData.filter(function(e){return a.utils.getValue(a.reserveInfoFields.placeid,e)===a.utils.getValue(a.placeIdField,t)&&d.isSameDay(new Date(a.utils.getValue(a.reserveInfoFields.startDate,e)),new Date(a.currentDateStr))}).map(function(e){return{data:e,id:e[a.reserveInfoFields.idField],position:a.getReservePositionInfo(e)}});return{id:t[a.placeIdField],data:t,reserves:e,disableCells:a.getUsedCells(e)}}):this.placeItems.map(function(n){return{id:n[a.placeIdField],data:n,reserves:a.weekDays.map(function(t){return{date:t,items:a.reserveData.filter(function(e){return a.utils.getValue(a.reserveInfoFields.placeid,e)===a.utils.getValue(a.placeIdField,n)&&d.isSameDay(new Date(a.utils.getValue(a.reserveInfoFields.startDate,e)),t.date)}).map(function(e){return{data:e,id:e[a.reserveInfoFields.idField]}}).sort(function(e,t){var n=a.dateHlp.differenceInMinutes(new Date(a.utils.getValue(a.reserveInfoFields.startDate,e.data)),new Date(a.utils.getValue(a.reserveInfoFields.endDate,t.data)));return 0<n?1:n<0?-1:0})}})}}):[]},D.prototype.getTimes=function(e){if(e){var t=this.dateHlp.formatTo(e,"yyyy-MM-dd HH:mm:ss");if(t){var n=new Date(t);return{hour:n.getHours(),minute:n.getMinutes(),date:new Date(t.split(" ")[0])}}}return null},D.prototype.getReservePositionInfo=function(e){var t=this.reserveInfoFields.startDate,n=this.reserveInfoFields.endDate,a=0,i=0,r=e[t],l=e[n];if(r){var s=this.getTimes(r);if(s){var o=s.hour,c=s.minute;a=100*o,c&&(a+=c/60*100),l&&(i=d.differenceInMinutes(new Date(l),new Date(r))/60*100)}}return{left:a,width:i}},D.prototype.onSelectChange=function(e){this.selectedId=e.item.id,this.currentSelectItem={room:e.room,data:e.item.data};var t=null;t="week"===this.viewType?e.$event.target.closest("li"):e.$event.target.closest(".item-content"),this.getPositionForDetailPanel(t),this.detailCls&&(this.detailCustomCls=this.detailCls(e.item)),this.showDetail=!0,this.selectChange.emit(e)},D.prototype.onItemDblClick=function(e){this.selectedId=e.item.id,this.currentSelectItem={room:e.room,data:e.item.data},this.itemDblClick.emit(e)},D.prototype.selectItem=function(e){this.selectedId=e,this.cd.detectChanges(),null!==this.selectedId&&this.selectedId!==undefined&&""!==this.selectedId||this.clearSelect()},D.prototype.clearSelect=function(){this.selectedId=null,this.clearSelected.emit({ins:this})},D.prototype.getFrameheaderHeight=function(){if(this._frameHeaderHeight)return this._frameHeaderHeight;var e=document.querySelector(".framework-tab-origin.gw-container-tabset.tab-container"),t=0;e&&(t+=e.offsetHeight);var n=document.querySelector(".gw-header--wrapper.framework-tool-origin");return n&&(t+=n.offsetHeight),this._frameHeaderHeight=t,this._frameHeaderHeight},D.prototype.getPositionForDetailPanel=function(e){var t=e.getBoundingClientRect(),n=t.left,a=t.top,i=t.right,r=t.bottom,l=(t.width,t.height),s=368,o=436,c=n,d=a,p=window.innerWidth-i,u=window.innerHeight-r;p<c?s<c?c-=s:c=window.innerWidth-n>s?n:s<i?i-s:(window.innerWidth-s)/2:c=s<p?i:s<i?n:(window.innerWidth-s)/2,u<d?o<d?s<n||s<p?window.innerHeight-d<l+40?d=window.innerHeight-o-20:(d=a-o+l+40)<this.getFrameheaderHeight()&&(d=this.getFrameheaderHeight()+10):d=a-o:d=10+this.getFrameheaderHeight():d=o<u?s<p||s<n?r-l-40:r:10+this.getFrameheaderHeight(),this.position={left:c,top:d}},D.prototype.closeDetailPanel=function(){this.roomSer.cardBtnClick$.next({action:"close"})},D.prototype.onAddNew=function(e){this.reservation.emit(e)},D.prototype.onScrollChange=function(e,t){this._currentScrollPos[this.viewType]=v({},e,{type:t})},D.prototype.detailEventHandlers=function(e){var t=e.action,n=e.item,a=(e.$event,null);switch(n&&(a={item:{data:n,id:this.utils.getValue(this.reserveInfoFields.idField,n)}}),t){case"edit":this.editHandler.emit(a);break;case"del":this.removeHandler.emit(a);break;case"close":this.showDetail=!1}},D.decorators=[{type:p.Component,args:[{selector:"farris-appointment-calendar",template:'<div class="rtv-container" resizeObserver (resize)="closeDetailPanel()" [class.rtv-container-week]="viewType === \'week\'">\r\n    <toolbar (placeChanged)="onPlaceSelected($event)" (dateChanged)="onViewTypeChanged($event)" [currentViewType]="viewType" [places]="placeItems"></toolbar>\r\n    <div class="main" style="position:relative" #viewContainer>\r\n        \x3c!-- <div style="border-right: 0.5px solid #0e6ded;height: 100%;position: absolute;left: 230px;width: 1px;z-index: 99;"></div> --\x3e\r\n\r\n        <day-view [data]="groupData" class="h-100 d-flex flex-column" *ngIf="viewType === \'day\'" [customCls]="dayViewCls" [reservationTitle]="reservationTitle"\r\n         (itemClick)="onSelectChange($event)" (itemDblClick)="onItemDblClick($event)" [selectId]="selectedId" (cellClick)="onAddNew($event)" (scrollChange)="onScrollChange($event, \'day\')"></day-view>\r\n        <week-view [data]="groupData" class="h-100 d-flex flex-column" *ngIf="viewType === \'week\'" [weekDays]="weekDays" (scrollChange)="onScrollChange($event, \'week\')"\r\n         (itemClick)="onSelectChange($event)" (itemDblClick)="onItemDblClick($event)" [width]="viewContainer.offsetWidth < minWeekViewWidth ? minWeekViewWidth: viewContainer.offsetWidth" [selectId]="selectedId"></week-view>\r\n    </div>\r\n</div>\r\n\r\n<reserve-detail *ngIf="showDetail" #detailRef\r\n    [data]="currentSelectItem?.data"\r\n    [position]="position"\r\n    [detailTemplate]="detailTemplate"\r\n    [columns]="detailColumns"\r\n    [placeInfo]="currentSelectItem?.room"\r\n    [placeFieldConfigs]="{ name: placeNameField, fullName: placeFullNameField, id: placeIdField }"\r\n    [fieldConfigs]="reserveInfoFields"\r\n    [badgeTemplate]="detailBadgeTemplate"\r\n    [customCls]="detailCustomCls"\r\n    [showCloseButton]="showCloseButton"\r\n    [showDeleteButton]="showDeleteButton"\r\n    [showEditButton]="showEditButton"\r\n    [toolbarButtons]="detailToolbars"\r\n    [detailColumnWidth]="detailColumnWidth"></reserve-detail>',providers:[m],encapsulation:p.ViewEncapsulation.None}]}],D.ctorParameters=function(){return[{type:p.Injector},{type:p.ChangeDetectorRef},{type:p.NgZone},{type:p.Renderer2},{type:m},{type:o.DateTimeHelperService},{type:p.ElementRef},{type:l.CommonUtils},{type:c.LocaleService}]},D.propDecorators={reserveData:[{type:p.Input}],placeItems:[{type:p.Input}],placeIdField:[{type:p.Input}],placeNameField:[{type:p.Input}],placeFullNameField:[{type:p.Input}],reserveInfoFields:[{type:p.Input}],roomNameFormatter:[{type:p.Input}],placeNameTemplate:[{type:p.Input}],contentTemplate:[{type:p.Input}],detailTemplate:[{type:p.Input}],detailBadgeTemplate:[{type:p.Input}],detailCls:[{type:p.Input}],dayViewCls:[{type:p.Input}],placeTitle:[{type:p.Input}],rowHeight:[{type:p.Input}],weekRowHeight:[{type:p.Input}],weekCellWidth:[{type:p.Input}],placeNameWidth:[{type:p.Input}],viewType:[{type:p.Input}],startTime:[{type:p.Input}],selectedId:[{type:p.Input}],detailColumns:[{type:p.Input}],showEditButton:[{type:p.Input}],showDeleteButton:[{type:p.Input}],showCloseButton:[{type:p.Input}],detailToolbars:[{type:p.Input}],detailColumnWidth:[{type:p.Input}],itemDblClick:[{type:p.Output}],reservationTitle:[{type:p.Input}],filterChange:[{type:p.Output}],selectChange:[{type:p.Output}],editHandler:[{type:p.Output}],removeHandler:[{type:p.Output}],clearSelected:[{type:p.Output}],reservation:[{type:p.Output}],detailRef:[{type:p.ViewChild,args:["detailRef"]}]},D);function D(e,t,n,a,i,r,l,s,o){var c=this;this.injector=e,this.cd=t,this.ngZone=n,this.render=a,this.roomSer=i,this.dateHlp=r,this.elRef=l,this.utils=s,this.localeSer=o,this.reserveData=[],this.placeItems=[],this.placeIdField="id",this.placeNameField="name",this.placeFullNameField="",this.reserveInfoFields={idField:"id",startDate:"start",endDate:"end",placeid:"roomid",title:"title"},this.placeTitle="名称",this.rowHeight=62,this.weekRowHeight=85,this.weekCellWidth=150,this.placeNameWidth=300,this.viewType="day",this.startTime=7,this.selectedId="",this.showEditButton=!0,this.showDeleteButton=!0,this.showCloseButton=!0,this.detailColumnWidth=56,this.itemDblClick=new p.EventEmitter,this.reservationTitle="预订",this.filterChange=new p.EventEmitter,this.selectChange=new p.EventEmitter,this.editHandler=new p.EventEmitter,this.removeHandler=new p.EventEmitter,this.clearSelected=new p.EventEmitter,this.reservation=new p.EventEmitter,this.weekDays=[],this.groupData=[],this.currentDateRangeStr="",this.currentDateStr="",this.currentSelectItem=null,this.position=null,this.showDetail=!1,this.detailCustomCls=null,this._CLICK_DELAY_=180,this._frameHeaderHeight=0,this.minWeekViewWidth=0,this._currentScrollPos={day:{x:null,y:0},week:{x:null,y:0}},this.rowWidth=2450,this.cardBtnClickSub=this.roomSer.cardBtnClick$.subscribe(function(e){c.detailEventHandlers(e)}),this.localeSer.setLocaleData(w)}var I=(k.prototype.ngOnInit=function(){this.setActiveItem()},k.prototype.ngAfterViewInit=function(){var a=this;this.ngzone.runOutsideAngular(function(){a.bodyRef.nativeElement.addEventListener("scroll",function(e){var t=a.bodyRef.nativeElement.scrollLeft,n=a.bodyRef.nativeElement.scrollTop;a.headerRef.nativeElement.scrollLeft=a.bodyRef.nativeElement.scrollLeft,a.calendarRef.closeDetailPanel(),a.scrollChange.emit({x:t,y:n})})}),this.overlaySer&&this.overlaySer.registerMouseEvent(this.bodyRef.nativeElement,function(e){if(a.calendarRef.detailRef){if(a.calendarRef.detailRef.el.nativeElement.contains(e.target))return;if("mousewheel"!==e.type&&a.isClick){if("week"===a.calendarRef.viewType&&e.target.closest("li")&&e.target.closest("li").classList.contains("week-day-subject"))return;if("day"===a.calendarRef.viewType&&e.target.closest("div.item-content"))return}if((e.target.classList.contains("farris-modal")||e.target.closest(".farris-modal"))&&e.target.closest("farris-messager")&&"BUTTON"!==e.target.nodeName)return;a.calendarRef.closeDetailPanel()}},{mouseUp:!0})},k.prototype.ngOnDestroy=function(){this.overlaySer&&(this.overlaySer.destory(this.bodyRef.nativeElement),this.overlaySer=null)},k.prototype.ngOnChanges=function(e){e.selectId&&!e.selectId.isFirstChange()&&this.setActiveItem(),e.data&&!e.data.isFirstChange()&&this.setActiveItem()},k.prototype.setActiveItem=function(e){},k.prototype.getRoomData=function(e){var t=this.utils.getValue(this.calendarRef.reserveInfoFields.placeid,e),n=this.data.find(function(e){return e.id===t});return n?n.data:null},k.prototype.onSubjectClick=function(t,n){var a=this;t.stopPropagation(),this.isClick?("week"===this.calendarRef.viewType&&t.target.scrollIntoViewIfNeeded(),this.clickTimer&&clearTimeout(this.clickTimer),this.clickTimer=setTimeout(function(){a.activeItem=n;var e=a.getRoomData(n.data);a.itemClick.emit({item:n,$event:t,room:e})},this.calendarRef._CLICK_DELAY_)):this.calendarRef.closeDetailPanel()},k.prototype.ondblClick=function(e){this.clickTimer&&clearTimeout(this.clickTimer),this.activeItem=e.item;var t=this.getRoomData(e.item.data);e.room=t,this.itemDblClick.emit(e)},k.prototype.onMouseDown=function(e){this.currentMousePointX=Math.floor(e.screenX),this.currentMousePointY=Math.floor(e.screenY)},k.prototype.onMouseUp=function(e){this.isClick=this.currentMousePointX==Math.floor(e.screenX)&&this.currentMousePointY==Math.floor(e.screenY)},k.decorators=[{type:p.Component,args:[{selector:"appointment-base-view",template:""}]}],k.ctorParameters=function(){return[{type:p.Injector},{type:p.NgZone},{type:C}]},k.propDecorators={data:[{type:p.Input}],selectId:[{type:p.Input}],itemClick:[{type:p.Output}],itemDblClick:[{type:p.Output}],headerRef:[{type:p.ViewChild,args:["header"]}],bodyRef:[{type:p.ViewChild,args:["body"]}],scrollChange:[{type:p.Output}]},k);function k(e,t,n){this.injector=e,this.ngzone=t,this.calendarRef=n,this.selectId="",this.itemClick=new p.EventEmitter,this.itemDblClick=new p.EventEmitter,this.scrollChange=new p.EventEmitter,this.activeItem=null,this.currentMousePointX=0,this.currentMousePointY=0,this.isClick=!0,this.overlaySer=new l.OverLayHiddenService,this.utils=this.injector.get(l.CommonUtils)}var b,T=(y(x,b=I),x.prototype.getCustomCls=function(e,t){void 0===t&&(t="cls");var n=null;if(this.customCls){var a=this.customCls(e),i=a.cls,r=a.styles;n=i||r||"cls"!==t?"cls"==t?i||null:r||null:this.customCls(e)}return n},x.prototype.setActiveItem=function(e){var t=e;e||(t=this.selectId),t&&(this.activeItem=s.flatten(this.data.map(function(e){return e.reserves})).find(function(e){return e.id==t}))},x.prototype.onCellClick=function(e,t,n){var a=(""+t).padStart(2,"0"),i=(""+(t+1)).padStart(2,"0"),r={start:this.calendarRef.currentDateStr+" "+a+":00:00",end:this.calendarRef.currentDateStr+" "+i+":00:00",place:n.data};this.cellClick.emit(r)},x.prototype.onMouseEnter=function(e){e.stopPropagation();var t=e.target.parentElement.querySelector(".addnew");t&&(t.style.opacity=0)},x.prototype.onMouseLeave=function(e){e.stopPropagation();var t=e.target.parentElement.querySelector(".addnew");t&&t.removeAttribute("style")},x.decorators=[{type:p.Component,args:[{selector:"day-view",template:'<div class="header" #header>\r\n\r\n    <div class="header-row" [style.width.px]="calendarRef.rowWidth">\r\n\r\n        <div class="header-cell roomname fixed-left" [style.width.px]="calendarRef.placeNameWidth">\r\n            <span class="time ml-2">{{calendarRef.placeTitle}}</span>\r\n        </div>\r\n\r\n        <div class="header-cell time-cell" style="width: 50px">\r\n        </div>\r\n        <div class="header-cell time-cell" >\r\n            <span class="time">00:00</span>\r\n        </div>\r\n        <div class="header-cell time-cell">\r\n            <span class="time">01:00</span>\r\n        </div>\r\n        <div class="header-cell time-cell">\r\n            <span class="time">02:00</span>\r\n        </div>\r\n        <div class="header-cell time-cell">\r\n            <span class="time">03:00</span>\r\n        </div>\r\n        <div class="header-cell time-cell">\r\n            <span class="time">04:00</span>\r\n        </div>\r\n        <div class="header-cell time-cell">\r\n            <span class="time">05:00</span>\r\n        </div>\r\n        <div class="header-cell time-cell">\r\n            <span class="time">06:00</span>\r\n        </div>\r\n        <div class="header-cell time-cell">\r\n            <span class="time">07:00</span>\r\n        </div>\r\n        <div class="header-cell time-cell">\r\n            <span class="time">08:00</span>\r\n        </div>\r\n        <div class="header-cell time-cell">\r\n            <span class="time">09:00</span>\r\n        </div>\r\n        <div class="header-cell time-cell">\r\n            <span class="time">10:00</span>\r\n        </div>\r\n        <div class="header-cell time-cell">\r\n            <span class="time">11:00</span>\r\n        </div>\r\n        <div class="header-cell time-cell">\r\n            <span class="time">12:00</span>\r\n        </div>\r\n        <div class="header-cell time-cell">\r\n            <span class="time">13:00</span>\r\n        </div>\r\n        <div class="header-cell time-cell">\r\n            <span class="time">14:00</span>\r\n        </div>\r\n        <div class="header-cell time-cell">\r\n            <span class="time">15:00</span>\r\n        </div>\r\n        <div class="header-cell time-cell">\r\n            <span class="time">16:00</span>\r\n        </div>\r\n        <div class="header-cell time-cell">\r\n            <span class="time">17:00</span>\r\n        </div>\r\n        <div class="header-cell time-cell">\r\n            <span class="time">18:00</span>\r\n        </div>\r\n        <div class="header-cell time-cell">\r\n            <span class="time">19:00</span>\r\n        </div>\r\n        <div class="header-cell time-cell">\r\n            <span class="time">20:00</span>\r\n        </div>\r\n        <div class="header-cell time-cell">\r\n            <span class="time">21:00</span>\r\n        </div>\r\n        <div class="header-cell time-cell">\r\n            <span class="time">22:00</span>\r\n        </div>\r\n        <div class="header-cell time-cell"  style="width: 100px">\r\n            <span class="time">23:00</span>\r\n        </div>\r\n           \r\n    </div>\r\n\r\n</div>\r\n<div class="body win11Scroll nobtn" #body>\r\n\r\n    <div class="room-row" *ngFor="let room of data" [style.height.px]="calendarRef.rowHeight"  [style.width.px]="calendarRef.rowWidth"  [attr.id]="\'row_\'+room.id">\r\n\r\n        <div class="room-cell roomname fixed-left" [style.width.px]="calendarRef.placeNameWidth">\r\n            <span *ngIf="!calendarRef.placeNameTemplate">{{ room.data[calendarRef.placeNameField] }}</span>\r\n            <ng-container [ngTemplateOutlet]="calendarRef.placeNameTemplate" [ngTemplateOutletContext]="{ $implicit: {data: room.data}, item: room.data }"></ng-container>\r\n        </div>\r\n        <div class="room-cell time-cell" style="width: 50px">\r\n        </div>\r\n        <div class="room-cell time-cell">\r\n            <div class="item-content" *ngFor="let item of room?.reserves" \r\n                [item-dblclick]="item" (dblclickHandler)="ondblClick($event)"\r\n                [style.width.px]="item.position?.width" [style.left.px]="item.position?.left"\r\n                (click)="onSubjectClick($event, item)" \r\n                (mousedown)="onMouseDown($event)" (mouseup)="onMouseUp($event)"\r\n                 (mouseenter)="onMouseEnter($event)" (mouseleave)="onMouseLeave($event)">\r\n                <div class="item-content-wrap" [ngClass]="customCls && getCustomCls(item)" [ngStyle]="customCls && getCustomCls(item, \'styles\')" [class.selected]="activeItem && activeItem.id === item.id">\r\n                    <div class="room-subject p-2 gray" *ngIf="!calendarRef.contentTemplate">\r\n                        <dl> \r\n                            <dt>{{ calendarRef.utils.getValue(calendarRef.reserveInfoFields.title, item.data) }}</dt>\r\n                            <dd class="other-info">\r\n                                <span>\r\n                                    {{ calendarRef.utils.getValue(calendarRef.reserveInfoFields.startDate, item.data) |dateformat: \'HH:mm\'}}\r\n                                    ~\r\n                                    {{ calendarRef.utils.getValue(calendarRef.reserveInfoFields.endDate, item.data) |dateformat: \'HH:mm\'}}\r\n                                </span>\r\n                            </dd>\r\n                        </dl>\r\n                    </div>\r\n                    <ng-container [ngTemplateOutlet]="calendarRef.contentTemplate" [ngTemplateOutletContext]="{ $implicit: {data: item.data}, item: item.data }"></ng-container>\r\n                </div>\r\n            </div>\r\n\r\n\r\n            <ng-container *ngIf="!(room.disableCells && room.disableCells.indexOf(0) > -1)">\r\n\r\n                <div class="addnew" (click)="onCellClick($event, 0, room)">\r\n                    <span class="f-icon f-icon-add" style="position: relative;\r\n                    top: 1px;margin-right: 3px;"></span> {{reservationTitle}}\r\n                </div>\r\n\r\n            </ng-container>\r\n        </div>\r\n        <div class="room-cell time-cell" *ngFor="let c of cells; let i= index" [class.isUsed]="room.disableCells && room.disableCells.indexOf(i+1) > -1 " >\r\n\r\n\r\n            <ng-container *ngIf="!(room.disableCells && room.disableCells.indexOf(i+1) > -1)">\r\n\r\n                <div class="addnew" (click)="onCellClick($event, (i + 1), room)">\r\n                    <span class="f-icon f-icon-add" style="position: relative;\r\n                    top: 1px;\r\n                    margin-right: 3px;"></span> {{reservationTitle}}\r\n                </div>\r\n\r\n            </ng-container>\r\n\r\n        </div>\r\n    </div>\r\n\r\n</div>\r\n',encapsulation:p.ViewEncapsulation.None,styles:["\n        .rtv-container .main .room-row .time-cell .addnew{\n  width: 100%;\n  height: 100%;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  border: 1px solid #2a87ff;\n  background: #edf5ff;\n  cursor: pointer;\n  opacity: 0;\n  transition: all 0.12s ease;\n  color: #045dd3;\n  font-size: 14px;\n  border-radius: 4px;\n}\n\n.rtv-container .main .room-row .time-cell:hover>.addnew {\n  opacity: 1;\n}\n\n        "]}]}],x.ctorParameters=function(){return[{type:p.Injector},{type:p.NgZone},{type:C}]},x.propDecorators={customCls:[{type:p.Input}],reservationTitle:[{type:p.Input}],cellClick:[{type:p.Output}]},x);function x(e,t,n){var a=b.call(this,e,t,n)||this;return a.reservationTitle="预订",a.cellClick=new p.EventEmitter,a.cells=new Array(23),a.render=null,a.render=a.injector.get(p.Renderer2,null),a}var F,R=(y(S,F=I),S.prototype.setActiveItem=function(e){var t=e;if(e||(t=this.selectId),t){var n=s.flatten(this.data.map(function(e){return e.reserves.map(function(e){return e.items})}));this.activeItem=s.flatten(n).find(function(e){return e.id==t})}},S.decorators=[{type:p.Component,args:[{selector:"week-view",template:'<div class="header" #header>\r\n\r\n    <div class="header-row" [attr.style]="\'width: \' +  width + \'px!important\' | safe: \'style\'">\r\n\r\n        <div class="header-cell roomname fixed-left" [style.width.px]="calendarRef.placeNameWidth">\r\n            <span class="time ml-2">{{calendarRef.placeTitle}}</span>\r\n        </div>\r\n\r\n        <div style="flex: 7;display: flex;">\r\n            <div class="header-cell time-cell" *ngFor="let item of weekDays" title="{{ item.dateStr }}  {{ \'appointment.weeks.\' + item.week | locale}}" [style.width.px]="calendarRef.weekCellWidth">\r\n                <span class="rtv-week-day" [class.active]="item.isToday">{{item.day}}</span> <span>\r\n                    {{ \'appointment.weeks.\' + item.week | locale}}</span>\r\n            </div>\r\n        </div>\r\n       \r\n           \r\n    </div>\r\n\r\n</div>\r\n<div class="body win11Scroll nobtn" #body style="padding-bottom: 15px">\r\n\r\n    <div class="room-row" *ngFor="let room of data" [attr.style]="\'width: \' +  width + \'px!important; height:\' + calendarRef.weekRowHeight + \'px\' | safe: \'style\'">\r\n\r\n        <div class="room-cell roomname fixed-left" [style.width.px]="calendarRef.placeNameWidth">\r\n            <span *ngIf="!calendarRef.placeNameTemplate">{{ room.data[calendarRef.placeNameField] }}</span>\r\n            <ng-container [ngTemplateOutlet]="calendarRef.placeNameTemplate" [ngTemplateOutletContext]="{ $implicit: {data: room.data}, item: room.data }"></ng-container>        \r\n        </div>\r\n        <div style="flex: 7;display: flex;">\r\n            <div class="room-cell time-cell win11Scroll nobtn" *ngFor="let res of room?.reserves" style="align-items: start;" [style.width.px]="calendarRef.weekCellWidth">\r\n                <div style="width: 100%;overflow: hidden;" class="p-1" *ngIf="res.items && res.items.length">\r\n                    <ul style="list-style: none;word-break: keep-all;">\r\n                        <li class="week-day-subject mb-1" *ngFor="let item of res.items" \r\n                            [class.selected]="activeItem && activeItem.id === item.id" (mousedown)="onMouseDown($event)" (mouseup)="onMouseUp($event)"\r\n                            (click)="onSubjectClick($event, item)" [item-dblclick]="item" (dblclickHandler)="ondblClick($event)">\r\n                            <div style="display: flex;flex-direction: row;" class="rtv-week-day-item">\r\n                                <div style="flex-grow: 1;overflow: hidden;text-overflow: ellipsis;white-space: nowrap;" title="{{ calendarRef.reserveInfoFields.title | getvalue: item.data }}">\r\n                                    {{ calendarRef.utils.getValue(calendarRef.reserveInfoFields.title || \'title\', item.data) }}\r\n                                </div>\r\n                                <div  style="flex: none;text-align: right; padding-left: 3px;">\r\n                                    {{ item.data[calendarRef.reserveInfoFields.startDate] | dateformat: \'HH:mm\'}}\r\n                                </div>\r\n                            </div>                        \r\n                        </li>\r\n                    </ul>\r\n                </div>\r\n            </div>\r\n        </div>\r\n\r\n    </div>\r\n\r\n</div>\r\n',encapsulation:p.ViewEncapsulation.None}]}],S.ctorParameters=function(){return[{type:p.Injector},{type:p.NgZone},{type:C}]},S.propDecorators={weekDays:[{type:p.Input}],width:[{type:p.Input}]},S);function S(e,t,n){var a=F.call(this,e,t,n)||this;return a.weekDays=[],a}var H=(W.prototype.ngOnInit=function(){this.initDate()},W.prototype.ngOnChanges=function(e){var t;e.rooms&&!e.rooms.isFirstChange()&&(this.places=function n(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(g(arguments[t]));return e}([(t={},t[this.placeIdField]="",t[this.placeNameField]="全部场所",t)],this.places))},W.prototype.ngAfterViewInit=function(){},W.prototype.initDate=function(){"week"!==this.currentViewType||this.currentDateRange?this.currentDate||(this.currentDate=this.dateHlp.formatTo(new Date,"yyyy-MM-dd")):(this.currentWeekDays=this.dateHlp.getWeekDate({baselineDate:new Date}),this.currentDateRange=this.currentWeekDays[0].dateStr+"~"+this.currentWeekDays[6].dateStr),this._dateChanged()},W.prototype.changeCalendarView=function(e,t){e&&e.stopPropagation(),this.currentViewType=t,this.initDate()},W.prototype.onDateButtonClicked=function(e,t){var n=new Date;if("day"===this.currentViewType){this.currentDate&&(n=new Date(this.currentDate));var a=this.dateHlp.formatTo(new Date,"yyyy-MM-dd");if(-1===t){var i=this.dateHlp.formatTo(d.subDays(n,1),"yyyy-MM-dd");a=this.dateHlp.formatTo(i)}else 1===t&&(i=this.dateHlp.formatTo(d.addDays(n,1),"yyyy-MM-dd"),a=this.dateHlp.formatTo(i));this.currentDate=a}else this.currentWeekDays&&this.currentWeekDays.length&&(n=this.currentWeekDays[4].date),1===t?this.currentWeekDays=this.dateHlp.getWeekDate({baselineDate:n,range:7}):-1===t?this.currentWeekDays=this.dateHlp.getWeekDate({baselineDate:n,range:-7}):(n=new Date,this.currentWeekDays=this.dateHlp.getWeekDate({baselineDate:n})),this.currentDateRange=this.currentWeekDays[0].dateStr+"~"+this.currentWeekDays[6].dateStr;this._dateChanged()},W.prototype.onDateChanged=function(e){var t=!1;if("week"==this.currentViewType){var n=e.split("~")[0];this.currentWeekDays=this.dateHlp.getWeekDate({baselineDate:new Date(n)}),t=this.currentDateRange!==e}else t=this.currentDate!==e;t&&this._dateChanged(e)},W.prototype._dateChanged=function(e){e&&("day"===this.currentViewType?this.currentDate=e:this.currentDateRange=e),this.dateChanged.emit({viewType:this.currentViewType,dateValue:"day"===this.currentViewType?this.currentDate:this.currentDateRange,weekDays:this.currentWeekDays}),this.calendarRef.closeDetailPanel()},W.prototype.onPlaceSelectChanged=function(e){var t=e.data;this.placeChanged.emit({viewType:this.currentViewType,dateValue:"day"===this.currentViewType?this.currentDate:this.currentDateRange,weekDays:this.currentWeekDays,room:t.id?t:null})},W.decorators=[{type:p.Component,args:[{selector:"toolbar",template:'<div class="toolbar" style="overflow-x: auto ;">\r\n\r\n    <div class="view-type ">\r\n        <button class="btn-day" type="button" [class.btn-active]="currentViewType === \'day\'" (click)="changeCalendarView($event, \'day\')">{{\'appointment.day\'|locale}}</button>\r\n        <button class="btn-day" type="button" [class.btn-active]="currentViewType === \'week\'" (click)="changeCalendarView($event, \'week\')">{{\'appointment.week\'|locale}}</button>\r\n    </div>\r\n    <span class="line"></span>\r\n    <div class="btns">\r\n        <button class="btn-today" (click)="onDateButtonClicked($event, 0)">{{ currentViewType === \'day\'? (\'appointment.today\'|locale ): (\'appointment.thisWeek\'|locale)}}</button>\r\n\r\n        <div class="btn-group">\r\n            <button class="btn-prev" (click)="onDateButtonClicked($event, -1)" title="{{ currentViewType === \'day\'? (\'appointment.prevDay\'|locale): (\'appointment.prevWeek\'|locale) }}">\r\n                <i class="f-icon f-icon-arrow-chevron-left"></i>\r\n            </button>\r\n            <button class="btn-next" (click)="onDateButtonClicked($event, 1)" title="{{ currentViewType === \'day\'? (\'appointment.nextDay\'|locale): (\'appointment.nextWeek\'|locale) }}">\r\n                <i class="f-icon f-icon-arrow-chevron-right"></i>\r\n            </button>\r\n        </div>\r\n    </div>\r\n\r\n    <div class="inputs d-flex">\r\n        <div class="datebox mr-4" [style.width.px]="currentViewType === \'day\'? 180 : 260">\r\n            <farris-datepicker [ngModel]="currentDate" [editable]="false"\r\n                dateFormat="{{\'appointment.dateFormat\'|locale}}" returnFormat="yyyy-MM-dd" \r\n                placeholder="请选择" *ngIf="currentViewType === \'day\'" [showClear]="false"\r\n                (valueChange)="onDateChanged($event.returnFormatted)"></farris-datepicker>\r\n            <farris-datepicker [ngModel]="currentDateRange"  [editable]="false" [dateRange]="true"\r\n                dateFormat="{{\'appointment.dateFormat\'|locale}}" returnFormat="yyyy-MM-dd" [showType]="4" \r\n                *ngIf="currentViewType === \'week\'" [showClear]="false"\r\n                (valueChange)="onDateChanged($event.returnFormatted)"></farris-datepicker>\r\n        </div>\r\n        <div class="roomlist-input" style="width: 176px; display: none;">\r\n            <farris-combo-list #cmb1 \r\n                [placeholder]="\'appointment.datePlace\'|locale"\r\n                [enableClear]="true"\r\n                [idField]="placeIdField"\r\n                [textField]="placeNameField"\r\n                [data]="places" \r\n                [panelHeight]="260"\r\n                [readonly]="false"\r\n                [disabled]="false"\r\n                [editable]="true"\r\n                (selectChange)="onPlaceSelectChanged($event)">\r\n            </farris-combo-list>\r\n        </div>\r\n    </div>\r\n\r\n</div>',encapsulation:p.ViewEncapsulation.None}]}],W.ctorParameters=function(){return[{type:o.DateTimeHelperService},{type:p.Injector},{type:C}]},W.propDecorators={dateChanged:[{type:p.Output}],placeChanged:[{type:p.Output}],currentViewType:[{type:p.Input}],places:[{type:p.Input}],placeIdField:[{type:p.Input}],placeNameField:[{type:p.Input}]},W);function W(e,t,n){this.dateHlp=e,this.injector=t,this.calendarRef=n,this.dateChanged=new p.EventEmitter,this.placeChanged=new p.EventEmitter,this.currentDate="",this.currentDateRange="",this.currentWeekDays=[],this.currentViewType="day",this.places=[],this.placeIdField="id",this.placeNameField="name"}var E=(M.prototype.ngOnInit=function(){},M.prototype.ondblclick=function(e){e.stopPropagation(),this.dblclickHandler.emit({item:this.data,$event:e})},M.decorators=[{type:p.Directive,args:[{selector:"[item-dblclick]"}]}],M.ctorParameters=function(){return[{type:p.ElementRef}]},M.propDecorators={data:[{type:p.Input,args:["item-dblclick"]}],dblclickHandler:[{type:p.Output}],ondblclick:[{type:p.HostListener,args:["dblclick",["$event"]]}]},M);function M(e){this.el=e,this.dblclickHandler=new p.EventEmitter}var V=(O.prototype.ngOnInit=function(){this.rooNameField=this.placeFieldConfigs.fullName||this.placeFieldConfigs.name},O.prototype.toolbarBtnClick=function(e,t){e.stopPropagation(),this.ser.cardBtnClick$.next({$event:e,action:t,item:this.data})},O.prototype.getCustomCls=function(e){void 0===e&&(e="cls");var t=null;return this.customCls&&(t=this.customCls.cls||this.customCls.cls||"cls"!=e?this.customCls[e]||{}:this.customCls),t},O.prototype.getLength=function(e){for(var t=0,n=e.length,a=0;a<n;a++){var i=e.charCodeAt(a);0<=i&&i<=128?t++:t+=2}return t},O.prototype.subStrNum=function(e,t){for(var n=e.length,a="",i=0,r=0;r<n;r++){var l=e.charAt(r);if(i++,4<encodeURI(l).length&&i++,a=a.concat(l),t<=i)return a=a.concat("...")}if(i<t)return e},O.decorators=[{type:p.Component,args:[{selector:"reserve-detail",template:'\n      <div class="reserve-detail-container" style="position: fixed; z-index: 99" [style.left.px]="position?.left" [style.top.px]="position?.top">\n        <div class="detail-header" [ngClass]="getCustomCls()" [ngStyle]="getCustomCls(\'styles\')">\n            <div class="detail-toolbar" *ngIf="!toolbarButtons || !toolbarButtons.length">\n                <span *ngIf="showEditButton" class="f-icon f-icon f-icon-new-edit" title="{{ \'appointment.detail.edit\' | locale }}" (click)="toolbarBtnClick($event, \'edit\')"></span>\n                <span *ngIf="showDeleteButton" class="f-icon f-icon-trash" title="{{ \'appointment.detail.del\' | locale }}" (click)="toolbarBtnClick($event, \'del\')"></span>\n                <span *ngIf="showCloseButton" class="f-icon f-icon-close" title="{{ \'appointment.detail.close\' | locale }}" (click)="toolbarBtnClick($event, \'close\')"></span>\n            </div>\n\n            <div class="detail-toolbar" *ngIf="toolbarButtons && toolbarButtons.length">\n                <span *ngFor="let btn of toolbarButtons" class="{{ btn.icon }}" title="{{ btn.title }}" [style.display]="btn.visible ? \'\': \'none\'"\n                    (click)="!btn.disable && btn.handler && btn.handler({ item: data, $event: $event })"></span>\n                <span *ngIf="showCloseButton" class="f-icon f-icon-close" title="{{ \'appointment.detail.close\' | locale }}" (click)="toolbarBtnClick($event, \'close\')"></span>\n            </div>\n\n            <div class="detail-title">\n \n                <span class="detail-place">\n                    {{rooNameField | getvalue: placeInfo}}\n                </span>\n                <div class="title-content" style=\'word-break:break-all; font-family:-apple-system,BlinkMacSystemFont,"Segoe UI","PingFang SC","Hiragino Sans GB","Microsoft YaHei","Helvetica Neue",Helvetica,Arial,sans-serif\' title="{{fieldConfigs.title}}">\n                    {{subStrNum(fieldConfigs.title | getvalue: data, titleLength)}}\n                    \x3c!-- <span class="detail-label">专项会议</span> --\x3e\n                    <ng-container [ngTemplateOutlet]="badgeTemplate" [ngTemplateOutletContext]="{ $implicit: {data: data}, item: data }"></ng-container>\n                </div>\n                <div class="detail-timer">\n                    {{ fieldConfigs.startDate| getvalue: data | dateformat: (\'appointment.detail.dateFormat\'|locale) }} {{ fieldConfigs.startDate| getvalue: data | dateformat: \'HH:mm\' }} \n                    &nbsp;-&nbsp;\n                    {{ fieldConfigs.endDate | getvalue: data | dateformat: (\'appointment.detail.dateFormat\'|locale) }} {{ fieldConfigs.endDate | getvalue: data | dateformat: \'HH:mm\' }} \n                    \x3c!-- 9月4日（今天）08:00 — 9月7日（周三）17:30 --\x3e\n                </div>\n            </div>\n        </div>\n        <div class="detail-info-content  win11Scroll nobtn" [ngStyle]="getCustomCls(\'detail\')">\n            <ng-container [ngTemplateOutlet]="detailTemplate" [ngTemplateOutletContext]="{ $implicit: {data: data}, item: data }"></ng-container>\n            <ul *ngIf="!detailTemplate">\n                <li *ngFor="let col of columns">\n                    <ng-container *ngIf="!col.template">\n                        <span class="detail-subtitle" [style.width.px]="detailColumnWidth" [style.minWidth.px]="detailColumnWidth" [title]="col.title">{{col.title}}</span> \n                        <span class="detail-content  d-flex flex-row" *ngIf="!col.formatter">\n                            <span class="colon"></span>    \n                            <span class="text">{{ col.field | getvalue: data: true}}</span>\n                        </span>\n                        <span class="detail-content  d-flex flex-row" *ngIf="col.formatter">\n                            <span class="colon"></span>\n                            <span class="text" [innerHtml]=" col.field | getvalue: data | columnformatter: col : data | safe: \'html\'"></span>\n                        </span>\n                    </ng-container>\n                    <ng-container *ngIf="col.template"  [ngTemplateOutlet]="col.template" [ngTemplateOutletContext]="{ $implicit: {data: data, field: col.field, label: col.title}, item: data }">\n                    </ng-container>\n                </li>\n                \n            </ul>\n        </div>\n    </div>\n\n    ',styles:["\n            .detail-subtitle {\n               text-align: justify;text-align-last: justify;white-space: nowrap;overflow: hidden;text-overflow: ellipsis;\n            }\n            .detail-content>.colon:before {\n                content: '：'\n            }\n\n            .detail-content>.text {\n                word-break: break-all;\n            }\n        "]}]}],O.ctorParameters=function(){return[{type:p.Injector},{type:m},{type:p.ElementRef}]},O.propDecorators={data:[{type:p.Input}],position:[{type:p.Input}],columns:[{type:p.Input}],detailTemplate:[{type:p.Input}],badgeTemplate:[{type:p.Input}],fieldConfigs:[{type:p.Input}],placeInfo:[{type:p.Input}],placeFieldConfigs:[{type:p.Input}],customCls:[{type:p.Input}],showEditButton:[{type:p.Input}],showDeleteButton:[{type:p.Input}],showCloseButton:[{type:p.Input}],toolbarButtons:[{type:p.Input}],detailColumnWidth:[{type:p.Input}],titleLength:[{type:p.Input}]},O);function O(e,t,n){this.injector=e,this.ser=t,this.el=n,this.position=null,this.fieldConfigs=null,this.placeFieldConfigs=null,this.customCls=null,this.showEditButton=!0,this.showDeleteButton=!0,this.showCloseButton=!0,this.detailColumnWidth=56,this.titleLength=52,this.rooNameField="name"}var N=(P.decorators=[{type:p.NgModule,args:[{declarations:[H,T,R,C,E,V,I],imports:[n.CommonModule,a.FormsModule,r.FarrisDatePickerModule,i.ComboListModule,l.FarrisCommonModule.forRoot(),o.DateHelperModule.forRoot(),c.LocaleModule.forRoot(),u.DataColumnModule.forRoot()],exports:[H,T,R,C,E,V,I]}]}],P);function P(){}e.ItemDblClickDirective=E,e.AppointmentCalendarService=m,e.AppointmentCalendarComponent=C,e.AppointmentCalendarModule=N,e.DayViewComponent=T,e.WeekViewComponent=R,e.ToolbarComponent=H,e.ReserveDetailComponent=V,e.BaseViewComponent=I,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=farris-appointment-calendar.umd.min.js.map
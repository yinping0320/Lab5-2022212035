/**
 * @fileoverview added by tsickle
 * Generated from: utils/favorites.tool.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { HttpClient, HttpHeaders } from '@angular/common/http';
import { Injectable } from '@angular/core';
import { of, Subject } from 'rxjs';
var FavoritesTool = /** @class */ (function () {
    function FavoritesTool(http) {
        this.http = http;
        this.absOrgType = 'System_organization';
        this.busNum = 'common';
        this.idField = 'userId';
        this.disableCurrentUser = false;
        this.withPermission = false;
        this.favoritesList = [];
        this.enableFavorites = true;
        this.initFavorites = false;
        this.enableSecurityControl = false;
        this.absRfQueryUrl = '/api/runtime/sys/v1.0/absRecentContacts/query';
        this.absRfModifyUrl = '/api/runtime/sys/v1.0/absRecentContacts/modify';
        this.subject = new Subject();
    }
    /**
     * 操作最近联系人或收藏夹
     * @param param RfRequestParam
     * @returns observable
     */
    /**
     * 操作最近联系人或收藏夹
     * @param {?} actionToken
     * @param {?} param RfRequestParam
     * @return {?} observable
     */
    FavoritesTool.prototype.curdRecentContactsOrFavorites = /**
     * 操作最近联系人或收藏夹
     * @param {?} actionToken
     * @param {?} param RfRequestParam
     * @return {?} observable
     */
    function (actionToken, param) {
        /** @type {?} */
        var url = this.absRfQueryUrl;
        if (actionToken === 'modify') {
            url = this.absRfModifyUrl;
        }
        /** @type {?} */
        var options = {
            headers: new HttpHeaders({
                'Content-Type': 'application/json',
            })
        };
        return this.http.post(url, param, options);
    };
    Object.defineProperty(FavoritesTool.prototype, "favoritesSubject", {
        get: /**
         * @return {?}
         */
        function () {
            return this.subject.asObservable();
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @param {?} value
     * @return {?}
     */
    FavoritesTool.prototype.setFavoritesList = /**
     * @param {?} value
     * @return {?}
     */
    function (value) {
        this.subject.next(value);
    };
    /**
     * 获取收藏夹中人员列表
     */
    /**
     * 获取收藏夹中人员列表
     * @return {?}
     */
    FavoritesTool.prototype.getFavoritesList = /**
     * 获取收藏夹中人员列表
     * @return {?}
     */
    function () {
        if (this.enableFavorites) {
            /** @type {?} */
            var param = {
                absOrgType: this.absOrgType,
                bizId: this.busNum,
                objectValue: 'CollectUser'
            };
            if (this.disableCurrentUser) {
                /** @type {?} */
                var currentUserId = ((/** @type {?} */ (window))).gspframeworkService.common.userInfos.get().id;
                param.filterUserIds = [currentUserId];
            }
            if (this.withPermission) {
                param.withPermission = true;
                param.authOp = 'UserManage';
            }
            if (this.enableSecurityControl) {
                param.securityControl = true;
                param.securityLevel = this.securityLevel;
            }
            return this.curdRecentContactsOrFavorites('query', param);
        }
        return of(null);
    };
    /**
     * 加入或取消收藏
     * @param e 鼠标事件
     * @param id 标识
     * @returns Observable
     */
    /**
     * 加入或取消收藏
     * @param {?} e 鼠标事件
     * @param {?} object
     * @return {?} Observable
     */
    FavoritesTool.prototype.toggleFavorites = /**
     * 加入或取消收藏
     * @param {?} e 鼠标事件
     * @param {?} object
     * @return {?} Observable
     */
    function (e, object) {
        var _this = this;
        /** @type {?} */
        var id = object[this.idField];
        /** @type {?} */
        var action = 'add';
        /** @type {?} */
        var param = {
            absOrgType: this.absOrgType,
            bizId: this.busNum,
            objectValue: 'CollectUser'
        };
        if (this.favoritesList.findIndex((/**
         * @param {?} item
         * @return {?}
         */
        function (item) { return item[_this.idField] === id; })) !== -1) {
            param.deleteList = [id];
            action = 'delete';
        }
        else {
            param.addList = [id];
        }
        this.curdRecentContactsOrFavorites('modify', param).subscribe((/**
         * @return {?}
         */
        function () {
            if (action === 'add') {
                /** @type {?} */
                var index = _this.favoritesList.findIndex((/**
                 * @param {?} item
                 * @return {?}
                 */
                function (item) { return item[_this.idField] === id; }));
                if (index === -1) {
                    _this.favoritesList.push(object);
                }
            }
            else {
                _this.favoritesList = _this.favoritesList.filter((/**
                 * @param {?} item
                 * @return {?}
                 */
                function (item) { return item[_this.idField] !== id; }));
            }
            _this.setFavoritesList(_this.favoritesList);
        }));
        e.cancelBubble = true;
        e.stopPropagation();
    };
    /**
     * 清空我的收藏
     */
    /**
     * 清空我的收藏
     * @return {?}
     */
    FavoritesTool.prototype.clearFavoritesList = /**
     * 清空我的收藏
     * @return {?}
     */
    function () {
        var _this = this;
        if (!this.favoritesList.length) {
            this.setFavoritesList(this.favoritesList);
            return;
        }
        /** @type {?} */
        var ids = this.favoritesList.map((/**
         * @param {?} item
         * @return {?}
         */
        function (item) { return item[_this.idField]; }));
        /** @type {?} */
        var param = {
            absOrgType: this.absOrgType,
            bizId: this.busNum,
            objectValue: 'CollectUser',
            addList: [],
            deleteList: ids
        };
        this.curdRecentContactsOrFavorites('modify', param).subscribe((/**
         * @param {?} val
         * @return {?}
         */
        function (val) {
            _this.favoritesList = [];
            _this.setFavoritesList(_this.favoritesList);
        }));
    };
    FavoritesTool.decorators = [
        { type: Injectable }
    ];
    /** @nocollapse */
    FavoritesTool.ctorParameters = function () { return [
        { type: HttpClient }
    ]; };
    return FavoritesTool;
}());
export { FavoritesTool };
if (false) {
    /** @type {?} */
    FavoritesTool.prototype.absOrgType;
    /** @type {?} */
    FavoritesTool.prototype.busNum;
    /** @type {?} */
    FavoritesTool.prototype.idField;
    /** @type {?} */
    FavoritesTool.prototype.disableCurrentUser;
    /** @type {?} */
    FavoritesTool.prototype.withPermission;
    /** @type {?} */
    FavoritesTool.prototype.favoritesList;
    /** @type {?} */
    FavoritesTool.prototype.enableFavorites;
    /** @type {?} */
    FavoritesTool.prototype.initFavorites;
    /** @type {?} */
    FavoritesTool.prototype.enableSecurityControl;
    /** @type {?} */
    FavoritesTool.prototype.securityLevel;
    /** @type {?} */
    FavoritesTool.prototype.absRfQueryUrl;
    /** @type {?} */
    FavoritesTool.prototype.absRfModifyUrl;
    /**
     * @type {?}
     * @private
     */
    FavoritesTool.prototype.subject;
    /**
     * @type {?}
     * @private
     */
    FavoritesTool.prototype.http;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmF2b3JpdGVzLnRvb2wuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL3VpLXBlcnNvbm5lbC1zZWxlY3Rvci8iLCJzb3VyY2VzIjpbInV0aWxzL2Zhdm9yaXRlcy50b29sLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsT0FBTyxFQUFFLFVBQVUsRUFBRSxXQUFXLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUMvRCxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzNDLE9BQU8sRUFBYyxFQUFFLEVBQUUsT0FBTyxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBRy9DO0lBbUJJLHVCQUFvQixJQUFnQjtRQUFoQixTQUFJLEdBQUosSUFBSSxDQUFZO1FBaEJwQyxlQUFVLEdBQUcscUJBQXFCLENBQUM7UUFDbkMsV0FBTSxHQUFHLFFBQVEsQ0FBQztRQUNsQixZQUFPLEdBQUcsUUFBUSxDQUFDO1FBQ25CLHVCQUFrQixHQUFHLEtBQUssQ0FBQztRQUMzQixtQkFBYyxHQUFHLEtBQUssQ0FBQztRQUN2QixrQkFBYSxHQUFHLEVBQUUsQ0FBQztRQUNuQixvQkFBZSxHQUFHLElBQUksQ0FBQztRQUN2QixrQkFBYSxHQUFHLEtBQUssQ0FBQztRQUN0QiwwQkFBcUIsR0FBWSxLQUFLLENBQUM7UUFHdkMsa0JBQWEsR0FBRywrQ0FBK0MsQ0FBQztRQUNoRSxtQkFBYyxHQUFHLGdEQUFnRCxDQUFDO1FBRTFELFlBQU8sR0FBRyxJQUFJLE9BQU8sRUFBTyxDQUFDO0lBSXJDLENBQUM7SUFFRDs7OztPQUlHOzs7Ozs7O0lBQ0YscURBQTZCOzs7Ozs7SUFBN0IsVUFBOEIsV0FBbUIsRUFBRSxLQUFxQjs7WUFDakUsR0FBRyxHQUFHLElBQUksQ0FBQyxhQUFhO1FBQzVCLElBQUksV0FBVyxLQUFLLFFBQVEsRUFBRTtZQUMxQixHQUFHLEdBQUcsSUFBSSxDQUFDLGNBQWMsQ0FBQztTQUM3Qjs7WUFDSyxPQUFPLEdBQUc7WUFDWixPQUFPLEVB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Q0FBQyxhQUFhLEdBQUcsRUFBRSxDQUFDO1lBQ3hCLEtBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxLQUFJLENBQUMsYUFBYSxDQUFDLENBQUM7UUFDOUMsQ0FBQyxFQUFDLENBQUM7SUFDUCxDQUFDOztnQkFwSUosVUFBVTs7OztnQkFMRixVQUFVOztJQTBJbkIsb0JBQUM7Q0FBQSxBQXJJRCxJQXFJQztTQXBJWSxhQUFhOzs7SUFFdEIsbUNBQW1DOztJQUNuQywrQkFBa0I7O0lBQ2xCLGdDQUFtQjs7SUFDbkIsMkNBQTJCOztJQUMzQix1Q0FBdUI7O0lBQ3ZCLHNDQUFtQjs7SUFDbkIsd0NBQXVCOztJQUN2QixzQ0FBc0I7O0lBQ3RCLDhDQUF1Qzs7SUFDdkMsc0NBQTZCOztJQUU3QixzQ0FBZ0U7O0lBQ2hFLHVDQUFrRTs7Ozs7SUFFbEUsZ0NBQXFDOzs7OztJQUV6Qiw2QkFBd0IiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBIdHRwQ2xpZW50LCBIdHRwSGVhZGVycyB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbi9odHRwJztcclxuaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBPYnNlcnZhYmxlLCBvZiwgU3ViamVjdCB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQgeyBSZlJlcXVlc3RQYXJhbSwgU2VjdXJpdHlMZXZlbCB9IGZyb20gJy4vdXNlci50eXBlJztcclxuXHJcbkBJbmplY3RhYmxlKClcclxuZXhwb3J0IGNsYXNzIEZhdm9yaXRlc1Rvb2wge1xyXG5cclxuICAgIGFic09yZ1R5cGUgPSAnU3lzdGVtX29yZ2FuaXphdGlvbic7XHJcbiAgICBidXNOdW0gPSAnY29tbW9uJztcclxuICAgIGlkRmllbGQgPSAndXNlcklkJztcclxuICAgIGRpc2FibGVDdXJyZW50VXNlciA9IGZhbHNlO1xyXG4gICAgd2l0aFBlcm1pc3Npb24gPSBmYWxzZTtcclxuICAgIGZhdm9yaXRlc0xpc3QgPSBbXTtcclxuICAgIGVuYWJsZUZhdm9yaXRlcyA9IHRydWU7XHJcbiAgICBpbml0RmF2b3JpdGVzID0gZmFsc2U7XHJcbiAgICBlbmFibGVTZWN1cml0eUNvbnRyb2w6IGJvb2xlYW4gPSBmYWxzZTtcclxuICAgIHNlY3VyaXR5TGV2ZWw6IFNlY3VyaXR5TGV2ZWw7XHJcblxyXG4gICAgYWJzUmZRdWVyeVVybCA9ICcvYXBpL3J1bnRpbWUvc3lzL3YxLjAvYWJzUmVjZW50Q29udGFjdHMvcXVlcnknO1xyXG4gICAgYWJzUmZNb2RpZnlVcmwgPSAnL2FwaS9ydW50aW1lL3N5cy92MS4wL2Fic1JlY2VudENvbnRhY3RzL21vZGlmeSc7XHJcblxyXG4gICAgcHJpdmF0ZSBzdWJqZWN0ID0gbmV3IFN1YmplY3Q8YW55PigpO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgaHR0cDogSHR0cENsaWVudCkge1xyXG5cclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOaTjeS9nOacgOi/keiBlOezu+S6uuaIluaUtuiXj+WkuVxyXG4gICAgICogQHBhcmFtIHBhcmFtIFJmUmVxdWVzdFBhcmFtXHJcbiAgICAgKiBAcmV0dXJucyBvYnNlcnZhYmxlXHJcbiAgICAgKi9cclxuICAgICBjdXJkUmVjZW50Q29udGFjdHNPckZhdm9yaXRlcyhhY3Rpb25Ub2tlbjogc3RyaW5nLCBwYXJhbTogUmZSZXF1ZXN0UGFyYW0pIHtcclxuICAgICAgICBsZXQgdXJsID0gdGhpcy5hYnNSZlF1ZXJ5VXJsO1xyXG4gICAgICAgIGlmIChhY3Rpb25Ub2tlbiA9PT0gJ21vZGlmeScpIHtcclxuICAgICAgICAgICAgdXJsID0gdGhpcy5hYnNSZk1vZGlmeVVybDtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc3Qgb3B0aW9ucyA9IHtcclxuICAgICAgICAgICAgaGVhZGVyczogbmV3IEh0dHBIZWFkZXJzKHtcclxuICAgICAgICAgICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgfTtcclxuICAgICAgICByZXR1cm4gdGhpcy5odHRwLnBvc3QodXJsLCBwYXJhbSwgb3B0aW9ucyk7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IGZhdm9yaXRlc1N1YmplY3QoKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgICAgICByZXR1cm4gdGhpcy5zdWJqZWN0LmFzT2JzZXJ2YWJsZSgpO1xyXG4gICAgfVxyXG5cclxuICAgIHNldEZhdm9yaXRlc0xpc3QodmFsdWU6IGFueSkge1xyXG4gICAgICAgIHRoaXMuc3ViamVjdC5uZXh0KHZhbHVlKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOiOt+WPluaUtuiXj+WkueS4reS6uuWRmOWIl+ihqFxyXG4gICAgICovXHJcbiAgICBnZXRGYXZvcml0ZXNMaXN0KCk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICAgICAgaWYgKHRoaXMuZW5hYmxlRmF2b3JpdGVzKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHBhcmFtOiBSZlJlcXVlc3RQYXJhbSA9IHtcclxuICAgICAgICAgICAgICAgIGFic09yZ1R5cGU6IHRoaXMuYWJzT3JnVHlwZSxcclxuICAgICAgICAgICAgICAgIGJpeklkOiB0aGlzLmJ1c051bSxcclxuICAgICAgICAgICAgICAgIG9iamVjdFZhbHVlOiAnQ29sbGVjdFVzZXInXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmRpc2FibGVDdXJyZW50VXNlcikge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgY3VycmVudFVzZXJJZCA9ICh3aW5kb3cgYXMgYW55KS5nc3BmcmFtZXdvcmtTZXJ2aWNlLmNvbW1vbi51c2VySW5mb3MuZ2V0KCkuaWQ7XHJcbiAgICAgICAgICAgICAgICBwYXJhbS5maWx0ZXJVc2VySWRzID0gW2N1cnJlbnRVc2VySWRdO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICh0aGlzLndpdGhQZXJtaXNzaW9uKSB7XHJcbiAgICAgICAgICAgICAgICBwYXJhbS53aXRoUGVybWlzc2lvbiA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICBwYXJhbS5hdXRoT3AgPSAnVXNlck1hbmFnZSc7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHRoaXMuZW5hYmxlU2VjdXJpdHlDb250cm9sKSB7XHJcbiAgICAgICAgICAgICAgICBwYXJhbS5zZWN1cml0eUNvbnRyb2wgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgcGFyYW0uc2VjdXJpdHlMZXZlbCA9IHRoaXMuc2VjdXJpdHlMZXZlbDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5jdXJkUmVjZW50Q29udGFjdHNPckZhdm9yaXRlcygncXVlcnknLCBwYXJhbSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBvZihudWxsKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOWKoOWFpeaIluWPlua2iOaUtuiXj1xyXG4gICAgICogQHBhcmFtIGUg6byg5qCH5LqL5Lu2XHJcbiAgICAgKiBAcGFyYW0gaWQg5qCH6K+GXHJcbiAgICAgKiBAcmV0dXJucyBPYnNlcnZhYmxlXHJcbiAgICAgKi9cclxuICAgIHRvZ2dsZUZhdm9yaXRlcyhlOiBhbnksIG9iamVjdDogYW55KSB7XHJcbiAgICAgICAgY29uc3QgaWQgPSBvYmplY3RbdGhpcy5pZEZpZWxkXTtcclxuICAgICAgICBsZXQgYWN0aW9uID0gJ2FkZCc7XHJcbiAgICAgICAgY29uc3QgcGFyYW06IFJmUmVxdWVzdFBhcmFtID0ge1xyXG4gICAgICAgICAgICBhYnNPcmdUeXBlOiB0aGlzLmFic09yZ1R5cGUsXHJcbiAgICAgICAgICAgIGJpeklkOiB0aGlzLmJ1c051bSxcclxuICAgICAgICAgICAgb2JqZWN0VmFsdWU6ICdDb2xsZWN0VXNlcidcclxuICAgICAgICB9O1xyXG4gICAgICAgIGlmICh0aGlzLmZhdm9yaXRlc0xpc3QuZmluZEluZGV4KGl0ZW0gPT4gaXRlbVt0aGlzLmlkRmllbGRdID09PSBpZCkgIT09IC0xKSB7XHJcbiAgICAgICAgICAgIHBhcmFtLmRlbGV0ZUxpc3QgPSBbaWRdO1xyXG4gICAgICAgICAgICBhY3Rpb24gPSAnZGVsZXRlJztcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBwYXJhbS5hZGRMaXN0ID0gW2lkXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5jdXJkUmVjZW50Q29udGFjdHNPckZhdm9yaXRlcygnbW9kaWZ5JywgcGFyYW0pLnN1YnNjcmliZSgoKSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChhY3Rpb24gPT09ICdhZGQnKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBpbmRleCA9IHRoaXMuZmF2b3JpdGVzTGlzdC5maW5kSW5kZXgoaXRlbSA9PiBpdGVtW3RoaXMuaWRGaWVsZF0gPT09IGlkKTtcclxuICAgICAgICAgICAgICAgIGlmIChpbmRleCA9PT0gLTEpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmZhdm9yaXRlc0xpc3QucHVzaChvYmplY3QpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5mYXZvcml0ZXNMaXN0ID0gdGhpcy5mYXZvcml0ZXNMaXN0LmZpbHRlcihpdGVtID0+IGl0ZW1bdGhpcy5pZEZpZWxkXSAhPT0gaWQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMuc2V0RmF2b3JpdGVzTGlzdCh0aGlzLmZhdm9yaXRlc0xpc3QpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIGUuY2FuY2VsQnViYmxlID0gdHJ1ZTtcclxuICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5riF56m65oiR55qE5pS26JePXHJcbiAgICAgKi9cclxuICAgIGNsZWFyRmF2b3JpdGVzTGlzdCgpIHtcclxuICAgICAgICBpZiAoIXRoaXMuZmF2b3JpdGVzTGlzdC5sZW5ndGgpIHtcclxuICAgICAgICAgICAgdGhpcy5zZXRGYXZvcml0ZXNMaXN0KHRoaXMuZmF2b3JpdGVzTGlzdCk7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc3QgaWRzID0gdGhpcy5mYXZvcml0ZXNMaXN0Lm1hcChpdGVtID0+IGl0ZW1bdGhpcy5pZEZpZWxkXSk7XHJcbiAgICAgICAgY29uc3QgcGFyYW06IFJmUmVxdWVzdFBhcmFtID0ge1xyXG4gICAgICAgICAgICBhYnNPcmdUeXBlOiB0aGlzLmFic09yZ1R5cGUsXHJcbiAgICAgICAgICAgIGJpeklkOiB0aGlzLmJ1c051bSxcclxuICAgICAgICAgICAgb2JqZWN0VmFsdWU6ICdDb2xsZWN0VXNlcicsXHJcbiAgICAgICAgICAgIGFkZExpc3Q6IFtdLFxyXG4gICAgICAgICAgICBkZWxldGVMaXN0OiBpZHNcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB0aGlzLmN1cmRSZWNlbnRDb250YWN0c09yRmF2b3JpdGVzKCdtb2RpZnknLCBwYXJhbSkuc3Vic2NyaWJlKCh2YWwpID0+IHtcclxuICAgICAgICAgICAgdGhpcy5mYXZvcml0ZXNMaXN0ID0gW107XHJcbiAgICAgICAgICAgIHRoaXMuc2V0RmF2b3JpdGVzTGlzdCh0aGlzLmZhdm9yaXRlc0xpc3QpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG59XHJcbiJdfQ==
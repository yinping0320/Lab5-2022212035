/**
 * @fileoverview added by tsickle
 * Generated from: lib/grid-personnel-selector.component.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Component, ElementRef, EventEmitter, Injector, Renderer2, ViewChild } from '@angular/core';
import { CommonUtils, RuntimeStateService } from '@farris/ui-common';
import { GRID_EDITORS } from '@farris/ui-datagrid';
import { DatagridBaseEditorDirective } from '@farris/ui-datagrid-editors';
import * as _ from 'lodash-es';
import { isNull, isUndefined, omitBy, trim } from 'lodash-es';
/** @type {?} */
var personnelSelectorDefautOption = {
    absOrgType: 'System_organization',
    // 数据源类型
    readonly: false,
    // 是否只读
    placeholder: '请选择',
    viewType: 'tag',
    busNum: 'common',
    idField: 'userId'
};
var DatagridPersonnelSelectorComponent = /** @class */ (function (_super) {
    tslib_1.__extends(DatagridPersonnelSelectorComponent, _super);
    function DatagridPersonnelSelectorComponent(render, el, rts, utils, injector) {
        var _this = _super.call(this, render, el, injector) || this;
        _this.rts = rts;
        _this.utils = utils;
        _this.lookupFieldMap = (/**
         * @param {?} helpData
         * @param {?} mapFields
         * @param {?} dataObj
         * @return {?}
         */
        function (helpData, mapFields, dataObj) {
            if (mapFields) {
                /** @type {?} */
                var helpFields = Object.keys(mapFields);
                helpFields.forEach((/**
                 * @param {?} f
                 * @return {?}
                 */
                function (f) {
                    /** @type {?} */
                    var val = '';
                    if (helpData) {
                        if (helpData instanceof Array) {
                            val = helpData.map((/**
                             * @param {?} h
                             * @return {?}
                             */
                            function (h) {
                                return _this.utils.getValue(f, h);
                            })).join(',');
                        }
                        else {
                            val = _this.utils.getValue(f, helpData);
                        }
                    }
                    mapFields[f].split(',').forEach((/**
                     * @param {?} ff
                     * @return {?}
                     */
                    function (ff) {
                        /** @type {?} */
                        var field = trim(ff);
                        _this.utils.setValue(dataObj, field, val);
                    }));
                }));
            }
        });
        return _this;
    }
    /**
     * @return {?}
     */
    DatagridPersonnelSelectorComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        _super.prototype.ngOnInit.call(this);
        // 这里添加了过滤 this.options 中null、undefined,万一 jit 生成了 undefined 的呢，
        this.options = Object.assign({}, personnelSelectorDefautOption, omitBy(this.options, (/**
         * @param {?} itemValue
         * @return {?}
         */
        function (itemValue) { return isUndefined(itemValue) || isNull(itemValue); })));
        this.instance.selectedData = new EventEmitter();
        this.instance.clear = new EventEmitter();
    };
    /**
     * @return {?}
     */
    DatagridPersonnelSelectorComponent.prototype.ngAfterViewInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.inputElement = this.el.nativeElement;
        _super.prototype.ngAfterViewInit.call(this);
        if (this.instance.ngControl &&
            this.instance.ngControl.formDirective &&
            this.instance.ngControl.formDirective.form &&
            this.instance.ngControl.formDirective.form.bindingData) {
            this.bindingData = this.instance.ngControl.formDirective.form.bindingData;
            this.bindingData.setValue = (/**
             * @param {?} fieldPath
             * @return {?}
             */
            function (fieldPath) {
                return _this.utils.setValue(fieldPath.join('.'), _this.bindingData, true);
            });
            this.bindingData.getValue = (/**
             * @param {?} fieldPath
             * @return {?}
             */
            function (fieldPath) {
                return _this.utils.getValue(fieldPath.join('.'), _this.bindingData, true);
            });
        }
    };
    /**
     * @return {?}
     */
    DatagridPersonnelSelectorComponent.prototype.inputClear = /**
     * @return {?}
     */
    function () {
        this.updateControlValue(null);
        this.instance.clear.emit();
        if (this.options.inputClear) {
            // 设计器上配置的清空事件
            this.options.inputClear();
        }
    };
    /**
     * @param {?} removedItem
     * @return {?}
     */
    DatagridPersonnelSelectorComponent.prototype.tagRemoved = /**
     * @param {?} removedItem
     * @return {?}
     */
    function (removedItem) {
        var _this = this;
        /** @type {?} */
        var mapFields = this.instance.mapFields;
        /** @type {?} */
        var helpFields = Object.keys(mapFields);
        /** @type {?} */
        var bindingData = _.cloneDeep(this.bindingData);
        /** @type {?} */
        var selectedData = [];
        helpFields.forEach((/**
         * @param {?} key
         * @return {?}
         */
        function (key) {
            /** @type {?} */
            var value = _this.utils.getValue(mapFields[key], bindingData);
            /** @type {?} */
            var vArr = value.split(',');
            vArr.splice(removedItem.deleteIndex, 1);
            vArr.forEach((/**
             * @param {?} v
             * @param {?} i
             * @return {?}
             */
            function (v, i) {
                if (!selectedData[i]) {
                    selectedData.push({ index: i });
                    selectedData[i][key] = v;
                }
                else {
                    selectedData[i][key] = v;
                }
            }));
            value = vArr.join(',');
            _this.utils.setValue(_this.bindingData, mapFields[key], value);
        }));
        if (selectedData.length) {
            this.instance.selectedData.emit(selectedData);
        }
        else {
            this.instance.clear.emit();
        }
        // 设计器上配置的删除单个标签事件
        if (this.options.tagRemoved) {
            this.options.tagRemoved(this.eventPrams(removedItem));
        }
    };
    /**
     * @param {?} changeData
     * @return {?}
     */
    DatagridPersonnelSelectorComponent.prototype.selectionsChange = /**
     * @param {?} changeData
     * @return {?}
     */
    function (changeData) {
        /** @type {?} */
        var formedSelections = this.formSelectedRowData();
        this.updateControlValue(formedSelections);
        this.instance.selectedData.emit(formedSelections);
        // 设计器上配置的选中数据后事件
        if (this.options.selectionsChange) {
            this.options.selectionsChange(this.eventPrams(changeData));
        }
    };
    /**
     * @param {?} selectedRow
     * @return {?}
     */
    DatagridPersonnelSelectorComponent.prototype.updateControlValue = /**
     * @param {?} selectedRow
     * @return {?}
     */
    function (selectedRow) {
        if (this.instance.mapFields && this.bindingData) {
            this.lookupFieldMap(selectedRow, this.instance.mapFields, this.bindingData);
        }
    };
    /**
     * @return {?}
     */
    DatagridPersonnelSelectorComponent.prototype.formSelectedRowData = /**
     * @return {?}
     */
    function () {
        var _this = this;
        /** @type {?} */
        var selectedRowData = [];
        this.instance.selections.forEach((/**
         * @param {?} item
         * @return {?}
         */
        function (item) {
            /** @type {?} */
            var defaultDisplayName = _this.instance.displayField ? item[_this.instance.displayField] : "[" + item.code + "]" + item.name;
            /** @type {?} */
            var displayName = _this.instance.formatFn ? _this.instance.formatFn(item) : defaultDisplayName;
            selectedRowData.push(Object.assign({}, item, { displayName: displayName }));
        }));
        return selectedRowData.length ? selectedRowData : null;
    };
    /**
     * @private
     * @param {?} $event
     * @return {?}
     */
    DatagridPersonnelSelectorComponent.prototype.eventPrams = /**
     * @private
     * @param {?} $event
     * @return {?}
     */
    function ($event) {
        /** @type {?} */
        var p = this.eventParams($event);
        p['instance'] = this.instance;
        p['editor'] = this;
        return p;
    };
    DatagridPersonnelSelectorComponent.decorators = [
        { type: Component, args: [{
                    selector: 'grid-personnel-selector',
                    template: "\n    <div [formGroup]=\"group\" class=\"f-datagrid-cell-formgroup farris-group-auto\">\n            <farris-personnel-selector #selection\n            style=\"width: 100%\"\n            [placeholder]=\"options.placeholder\"\n            [enableQuick]=\"false\"\n            [readonly]=\"options.readonly\"\n            [absOrgType]=\"options.absOrgType\"\n            [viewType]=\"options.viewType\"\n            [multiSelect]=\"options.multiSelect\"\n            [busNum]=\"options.busNum\"\n            [mapFields]=\"options.mapFields\"\n            [formatFn]=\"options.formatter\"\n            [formControlName]=\"column.field\"\n            [idField]=\"options.idField\"\n            [displayField]=\"options.textField\"\n            [showTabIds]=\"options.showTabIds\"\n            [enableHierarchicalLoading]=\"options.enableHierarchicalLoading\"\n            [filterId]=\"options.filterId\"\n            (inputClear)=\"inputClear()\"\n            (selectionsChange)=\"selectionsChange($event)\"\n            (tagRemoved)=\"tagRemoved($event)\"\n            >\n            </farris-personnel-selector>\n    </div>\n    "
                }] }
    ];
    /** @nocollapse */
    DatagridPersonnelSelectorComponent.ctorParameters = function () { return [
        { type: Renderer2 },
        { type: ElementRef },
        { type: RuntimeStateService },
        { type: CommonUtils },
        { type: Injector }
    ]; };
    DatagridPersonnelSelectorComponent.propDecorators = {
        instance: [{ type: ViewChild, args: ['selection',] }]
    };
    return DatagridPersonnelSelectorComponent;
}(DatagridBaseEditorDirective));
export { DatagridPersonnelSelectorComponent };
if (false) {
    /** @type {?} */
    DatagridPersonnelSelectorComponent.prototype.instance;
    /** @type {?} */
    DatagridPersonnelSelectorComponent.prototype.bindingData;
    /** @type {?} */
    DatagridPersonnelSelectorComponent.prototype.lookupFieldMap;
    /**
     * @type {?}
     * @private
     */
    DatagridPersonnelSelectorComponent.prototype.rts;
    /** @type {?} */
    DatagridPersonnelSelectorComponent.prototype.utils;
}
/** @type {?} */
export var PersonnelSelectorDataGridEditorProvider = { provide: GRID_EDITORS, useValue: { name: 'PersonnelSelector', value: DatagridPersonnelSelectorComponent }, multi: true };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ3JpZC1wZXJzb25uZWwtc2VsZWN0b3IuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy91aS1wZXJzb25uZWwtc2VsZWN0b3IvIiwic291cmNlcyI6WyJsaWIvZ3JpZC1wZXJzb25uZWwtc2VsZWN0b3IuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBLE9BQU8sRUFBaUIsU0FBUyxFQUFFLFVBQVUsRUFBRSxZQUFZLEVBQUUsUUFBUSxFQUFVLFNBQVMsRUFBRSxTQUFTLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDM0gsT0FBTyxFQUFFLFdBQVcsRUFBRSxtQkFBbUIsRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBQ3JFLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUNuRCxPQUFPLEVBQUUsMkJBQTJCLEVBQUUsTUFBTSw2QkFBNkIsQ0FBQztBQUMxRSxPQUFPLEtBQUssQ0FBQyxNQUFNLFdBQVcsQ0FBQztBQUMvQixPQUFPLEVBQUUsTUFBTSxFQUFFLFdBQVcsRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFLE1BQU0sV0FBVyxDQUFDOztJQUd4RCw2QkFBNkIsR0FBRztJQUNwQyxVQUFVLEVBQUUscUJBQXFCOztJQUNqQyxRQUFRLEVBQUUsS0FBSzs7SUFDZixXQUFXLEVBQUUsS0FBSztJQUNsQixRQUFRLEVBQUUsS0FBSztJQUNmLE1BQU0sRUFBRSxRQUFRO0lBQ2hCLE9BQU8sRUFBRSxRQUFRO0NBQ2xCO0FBRUQ7SUE2QndELDhEQUEyQjtJQU1qRiw0Q0FDRSxNQUFpQixFQUNqQixFQUFjLEVBQ04sR0FBd0IsRUFDekIsS0FBa0IsRUFDekIsUUFBa0I7UUFMcEIsWUFNRSxrQkFBTSxNQUFNLEVBQUUsRUFBRSxFQUFFLFFBQVEsQ0FBQyxTQUM1QjtRQUpTLFNBQUcsR0FBSCxHQUFHLENBQXFCO1FBQ3pCLFdBQUssR0FBTCxLQUFLLENBQWE7UUEwQzNCLG9CQUFjOzs7Ozs7UUFBRyxV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OztZQUNqQixDQUFDLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQyxNQUFNLENBQUM7UUFDbEMsQ0FBQyxDQUFDLFVBQVUsQ0FBQyxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUM7UUFDOUIsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxHQUFHLElBQUksQ0FBQztRQUNuQixPQUFPLENBQUMsQ0FBQztJQUNYLENBQUM7O2dCQWpMRixTQUFTLFNBQUM7b0JBQ1QsUUFBUSxFQUFFLHlCQUF5QjtvQkFDbkMsUUFBUSxFQUFFLHltQ0F5QlA7aUJBQ0o7Ozs7Z0JBN0M4RSxTQUFTO2dCQUFyRCxVQUFVO2dCQUN2QixtQkFBbUI7Z0JBQWhDLFdBQVc7Z0JBRHlDLFFBQVE7OzsyQkFnRGxFLFNBQVMsU0FBQyxXQUFXOztJQW1KeEIseUNBQUM7Q0FBQSxBQWxMRCxDQTZCd0QsMkJBQTJCLEdBcUpsRjtTQXJKWSxrQ0FBa0M7OztJQUU3QyxzREFBNkg7O0lBRTdILHlEQUFpQjs7SUFnRGpCLDREQXNCQzs7Ozs7SUFqRUMsaURBQWdDOztJQUNoQyxtREFBeUI7OztBQThJN0IsTUFBTSxLQUFPLHVDQUF1QyxHQUFHLEVBQUUsT0FBTyxFQUFFLFlBQVksRUFBRSxRQUFRLEVBQUUsRUFBRSxJQUFJLEVBQUUsbUJBQW1CLEVBQUUsS0FBSyxFQUFFLGtDQUFrQyxFQUFFLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFmdGVyVmlld0luaXQsIENvbXBvbmVudCwgRWxlbWVudFJlZiwgRXZlbnRFbWl0dGVyLCBJbmplY3RvciwgT25Jbml0LCBSZW5kZXJlcjIsIFZpZXdDaGlsZCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBDb21tb25VdGlscywgUnVudGltZVN0YXRlU2VydmljZSB9IGZyb20gJ0BmYXJyaXMvdWktY29tbW9uJztcclxuaW1wb3J0IHsgR1JJRF9FRElUT1JTIH0gZnJvbSAnQGZhcnJpcy91aS1kYXRhZ3JpZCc7XHJcbmltcG9ydCB7IERhdGFncmlkQmFzZUVkaXRvckRpcmVjdGl2ZSB9IGZyb20gJ0BmYXJyaXMvdWktZGF0YWdyaWQtZWRpdG9ycyc7XHJcbmltcG9ydCAqIGFzIF8gZnJvbSAnbG9kYXNoLWVzJztcclxuaW1wb3J0IHsgaXNOdWxsLCBpc1VuZGVmaW5lZCwgb21pdEJ5LCB0cmltIH0gZnJvbSAnbG9kYXNoLWVzJztcclxuaW1wb3J0IHsgUGVyc29ubmVsU2VsZWN0b3JDb21wb25lbnQgfSBmcm9tICcuL3NlbGVjdGlvbi5jb21wb25lbnQnO1xyXG5cclxuY29uc3QgcGVyc29ubmVsU2VsZWN0b3JEZWZhdXRPcHRpb24gPSB7XHJcbiAgYWJzT3JnVHlwZTogJ1N5c3RlbV9vcmdhbml6YXRpb24nLCAvLyDmlbDmja7mupDnsbvlnotcclxuICByZWFkb25seTogZmFsc2UsIC8vIOaYr+WQpuWPquivu1xyXG4gIHBsYWNlaG9sZGVyOiAn6K+36YCJ5oupJyxcclxuICB2aWV3VHlwZTogJ3RhZycsXHJcbiAgYnVzTnVtOiAnY29tbW9uJyxcclxuICBpZEZpZWxkOiAndXNlcklkJ1xyXG59O1xyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgc2VsZWN0b3I6ICdncmlkLXBlcnNvbm5lbC1zZWxlY3RvcicsXHJcbiAgdGVtcGxhdGU6IGBcclxuICAgIDxkaXYgW2Zvcm1Hcm91cF09XCJncm91cFwiIGNsYXNzPVwiZi1kYXRhZ3JpZC1jZWxsLWZvcm1ncm91cCBmYXJyaXMtZ3JvdXAtYXV0b1wiPlxyXG4gICAgICAgICAgICA8ZmFycmlzLXBlcnNvbm5lbC1zZWxlY3RvciAjc2VsZWN0aW9uXHJcbiAgICAgICAgICAgIHN0eWxlPVwid2lkdGg6IDEwMCVcIlxyXG4gICAgICAgICAgICBbcGxhY2Vob2xkZXJdPVwib3B0aW9ucy5wbGFjZWhvbGRlclwiXHJcbiAgICAgICAgICAgIFtlbmFibGVRdWlja109XCJmYWxzZVwiXHJcbiAgICAgICAgICAgIFtyZWFkb25seV09XCJvcHRpb25zLnJlYWRvbmx5XCJcclxuICAgICAgICAgICAgW2Fic09yZ1R5cGVdPVwib3B0aW9ucy5hYnNPcmdUeXBlXCJcclxuICAgICAgICAgICAgW3ZpZXdUeXBlXT1cIm9wdGlvbnMudmlld1R5cGVcIlxyXG4gICAgICAgICAgICBbbXVsdGlTZWxlY3RdPVwib3B0aW9ucy5tdWx0aVNlbGVjdFwiXHJcbiAgICAgICAgICAgIFtidXNOdW1dPVwib3B0aW9ucy5idXNOdW1cIlxyXG4gICAgICAgICAgICBbbWFwRmllbGRzXT1cIm9wdGlvbnMubWFwRmllbGRzXCJcclxuICAgICAgICAgICAgW2Zvcm1hdEZuXT1cIm9wdGlvbnMuZm9ybWF0dGVyXCJcclxuICAgICAgICAgICAgW2Zvcm1Db250cm9sTmFtZV09XCJjb2x1bW4uZmllbGRcIlxyXG4gICAgICAgICAgICBbaWRGaWVsZF09XCJvcHRpb25zLmlkRmllbGRcIlxyXG4gICAgICAgICAgICBbZGlzcGxheUZpZWxkXT1cIm9wdGlvbnMudGV4dEZpZWxkXCJcclxuICAgICAgICAgICAgW3Nob3dUYWJJZHNdPVwib3B0aW9ucy5zaG93VGFiSWRzXCJcclxuICAgICAgICAgICAgW2VuYWJsZUhpZXJhcmNoaWNhbExvYWRpbmddPVwib3B0aW9ucy5lbmFibGVIaWVyYXJjaGljYWxMb2FkaW5nXCJcclxuICAgICAgICAgICAgW2ZpbHRlcklkXT1cIm9wdGlvbnMuZmlsdGVySWRcIlxyXG4gICAgICAgICAgICAoaW5wdXRDbGVhcik9XCJpbnB1dENsZWFyKClcIlxyXG4gICAgICAgICAgICAoc2VsZWN0aW9uc0NoYW5nZSk9XCJzZWxlY3Rpb25zQ2hhbmdlKCRldmVudClcIlxyXG4gICAgICAgICAgICAodGFnUmVtb3ZlZCk9XCJ0YWdSZW1vdmVkKCRldmVudClcIlxyXG4gICAgICAgICAgICA+XHJcbiAgICAgICAgICAgIDwvZmFycmlzLXBlcnNvbm5lbC1zZWxlY3Rvcj5cclxuICAgIDwvZGl2PlxyXG4gICAgYCxcclxufSlcclxuZXhwb3J0IGNsYXNzIERhdGFncmlkUGVyc29ubmVsU2VsZWN0b3JDb21wb25lbnQgZXh0ZW5kcyBEYXRhZ3JpZEJhc2VFZGl0b3JEaXJlY3RpdmUgaW1wbGVtZW50cyBPbkluaXQsIEFmdGVyVmlld0luaXQge1xyXG5cclxuICBAVmlld0NoaWxkKCdzZWxlY3Rpb24nKSBpbnN0YW5jZTogUGVyc29ubmVsU2VsZWN0b3JDb21wb25lbnQgJiB7IGNsZWFyOiBFdmVudEVtaXR0ZXI8YW55Pjsgc2VsZWN0ZWREYXRhOiBFdmVudEVtaXR0ZXI8YW55PiB9O1xyXG5cclxuICBiaW5kaW5nRGF0YTogYW55O1xyXG5cclxuICBjb25zdHJ1Y3RvcihcclxuICAgIHJlbmRlcjogUmVuZGVyZXIyLFxyXG4gICAgZWw6IEVsZW1lbnRSZWYsXHJcbiAgICBwcml2YXRlIHJ0czogUnVudGltZVN0YXRlU2VydmljZSxcclxuICAgIHB1YmxpYyB1dGlsczogQ29tbW9uVXRpbHMsXHJcbiAgICBpbmplY3RvcjogSW5qZWN0b3IpIHtcclxuICAgIHN1cGVyKHJlbmRlciwgZWwsIGluamVjdG9yKTtcclxuICB9XHJcblxyXG4gIG5nT25Jbml0KCk6IHZvaWQge1xyXG4gICAgc3VwZXIubmdPbkluaXQoKTtcclxuICAgIC8vIOi/memHjOa3u+WKoOS6hui/h+a7pCB0aGlzLm9wdGlvbnMg5LitbnVsbOOAgXVuZGVmaW5lZCzkuIfkuIAgaml0IOeUn+aIkOS6hiB1bmRlZmluZWQg55qE5ZGi77yMXHJcbiAgICB0aGlzLm9wdGlvbnMgPSBPYmplY3QuYXNzaWduKHt9LCBwZXJzb25uZWxTZWxlY3RvckRlZmF1dE9wdGlvbiwgb21pdEJ5KHRoaXMub3B0aW9ucywgKGl0ZW1WYWx1ZSkgPT4gaXNVbmRlZmluZWQoaXRlbVZhbHVlKSB8fCBpc051bGwoaXRlbVZhbHVlKSkpO1xyXG4gICAgdGhpcy5pbnN0YW5jZS5zZWxlY3RlZERhdGEgPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcclxuICAgIHRoaXMuaW5zdGFuY2UuY2xlYXIgPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcclxuICB9XHJcblxyXG4gIG5nQWZ0ZXJWaWV3SW5pdCgpIHtcclxuICAgIHRoaXMuaW5wdXRFbGVtZW50ID0gdGhpcy5lbC5uYXRpdmVFbGVtZW50O1xyXG4gICAgc3VwZXIubmdBZnRlclZpZXdJbml0KCk7XHJcbiAgICBpZiAoXHJcbiAgICAgIHRoaXMuaW5zdGFuY2UubmdDb250cm9sICYmXHJcbiAgICAgIHRoaXMuaW5zdGFuY2UubmdDb250cm9sLmZvcm1EaXJlY3RpdmUgJiZcclxuICAgICAgdGhpcy5pbnN0YW5jZS5uZ0NvbnRyb2wuZm9ybURpcmVjdGl2ZS5mb3JtICYmXHJcbiAgICAgIHRoaXMuaW5zdGFuY2UubmdDb250cm9sLmZvcm1EaXJlY3RpdmUuZm9ybS5iaW5kaW5nRGF0YVxyXG4gICAgKSB7XHJcbiAgICAgIHRoaXMuYmluZGluZ0RhdGEgPSB0aGlzLmluc3RhbmNlLm5nQ29udHJvbC5mb3JtRGlyZWN0aXZlLmZvcm0uYmluZGluZ0RhdGE7XHJcbiAgICAgIHRoaXMuYmluZGluZ0RhdGEuc2V0VmFsdWUgPSAoZmllbGRQYXRoKSA9PiB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMudXRpbHMuc2V0VmFsdWUoZmllbGRQYXRoLmpvaW4oJy4nKSwgdGhpcy5iaW5kaW5nRGF0YSwgdHJ1ZSk7XHJcbiAgICAgIH07XHJcbiAgICAgIHRoaXMuYmluZGluZ0RhdGEuZ2V0VmFsdWUgPSAoZmllbGRQYXRoKSA9PiB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMudXRpbHMuZ2V0VmFsdWUoZmllbGRQYXRoLmpvaW4oJy4nKSwgdGhpcy5iaW5kaW5nRGF0YSwgdHJ1ZSk7XHJcbiAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gIH1cclxuXHJcbiAgaW5wdXRDbGVhcigpIHtcclxuICAgIHRoaXMudXBkYXRlQ29udHJvbFZhbHVlKG51bGwpO1xyXG4gICAgdGhpcy5pbnN0YW5jZS5jbGVhci5lbWl0KCk7XHJcbiAgICBpZiAodGhpcy5vcHRpb25zLmlucHV0Q2xlYXIpIHtcclxuICAgICAgLy8g6K6+6K6h5Zmo5LiK6YWN572u55qE5riF56m65LqL5Lu2XHJcbiAgICAgIHRoaXMub3B0aW9ucy5pbnB1dENsZWFyKCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBsb29rdXBGaWVsZE1hcCA9IChoZWxwRGF0YSwgbWFwRmllbGRzLCBkYXRhT2JqKSA9PiB7XHJcbiAgICBpZiAobWFwRmllbGRzKSB7XHJcbiAgICAgIGNvbnN0IGhlbHBGaWVsZHMgPSBPYmplY3Qua2V5cyhtYXBGaWVsZHMpO1xyXG4gICAgICBoZWxwRmllbGRzLmZvckVhY2goKGY6IGFueSkgPT4ge1xyXG4gICAgICAgIGxldCB2YWwgPSAnJztcclxuICAgICAgICBpZiAoaGVscERhdGEpIHtcclxuICAgICAgICAgIGlmIChoZWxwRGF0YSBpbnN0YW5jZW9mIEFycmF5KSB7XHJcbiAgICAgICAgICAgIHZhbCA9IGhlbHBEYXRhLm1hcCgoaDogYW55KSA9PiB7XHJcbiAgICAgICAgICAgICAgcmV0dXJuIHRoaXMudXRpbHMuZ2V0VmFsdWUoZiwgaCk7XHJcbiAgICAgICAgICAgIH0pLmpvaW4oJywnKTtcclxuICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHZhbCA9IHRoaXMudXRpbHMuZ2V0VmFsdWUoZiwgaGVscERhdGEpO1xyXG4gICAgICAgICAgfVxyXG5cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIG1hcEZpZWxkc1tmXS5zcGxpdCgnLCcpLmZvckVhY2goKGZmOiBhbnkpID0+IHtcclxuICAgICAgICAgIGNvbnN0IGZpZWxkID0gdHJpbShmZik7XHJcbiAgICAgICAgICB0aGlzLnV0aWxzLnNldFZhbHVlKGRhdGFPYmosIGZpZWxkLCB2YWwpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9KTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHRhZ1JlbW92ZWQocmVtb3ZlZEl0ZW06IHtcclxuICAgIGRlbGV0ZUl0ZW06IGFueSxcclxuICAgIGRlbGV0ZUluZGV4OiBOdW1iZXIsXHJcbiAgICBzZWxlY3Rpb25zOiBBcnJheTxhbnk+XHJcbiAgfSkge1xyXG4gICAgY29uc3QgbWFwRmllbGRzID0gdGhpcy5pbnN0YW5jZS5tYXBGaWVsZHM7XHJcbiAgICBjb25zdCBoZWxwRmllbGRzID0gT2JqZWN0LmtleXMobWFwRmllbGRzKTtcclxuICAgIGNvbnN0IGJpbmRpbmdEYXRhID0gXy5jbG9uZURlZXAodGhpcy5iaW5kaW5nRGF0YSk7XHJcbiAgICBjb25zdCBzZWxlY3RlZERhdGEgPSBbXTtcclxuXHJcbiAgICBoZWxwRmllbGRzLmZvckVhY2goa2V5ID0+IHtcclxuICAgICAgbGV0IHZhbHVlID0gdGhpcy51dGlscy5nZXRWYWx1ZShtYXBGaWVsZHNba2V5XSwgYmluZGluZ0RhdGEpO1xyXG4gICAgICBjb25zdCB2QXJyID0gdmFsdWUuc3BsaXQoJywnKTtcclxuICAgICAgdkFyci5zcGxpY2UocmVtb3ZlZEl0ZW0uZGVsZXRlSW5kZXgsIDEpO1xyXG4gICAgICB2QXJyLmZvckVhY2goKHYsIGkpID0+IHtcclxuICAgICAgICBpZiAoIXNlbGVjdGVkRGF0YVtpXSkge1xyXG4gICAgICAgICAgc2VsZWN0ZWREYXRhLnB1c2goeyBpbmRleDogaSB9KTtcclxuICAgICAgICAgIHNlbGVjdGVkRGF0YVtpXVtrZXldID0gdjtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgc2VsZWN0ZWREYXRhW2ldW2tleV0gPSB2O1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcbiAgICAgIHZhbHVlID0gdkFyci5qb2luKCcsJyk7XHJcbiAgICAgIHRoaXMudXRpbHMuc2V0VmFsdWUodGhpcy5iaW5kaW5nRGF0YSwgbWFwRmllbGRzW2tleV0sIHZhbHVlKTtcclxuICAgIH0pO1xyXG4gICAgaWYgKHNlbGVjdGVkRGF0YS5sZW5ndGgpIHtcclxuICAgICAgdGhpcy5pbnN0YW5jZS5zZWxlY3RlZERhdGEuZW1pdChzZWxlY3RlZERhdGEpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5pbnN0YW5jZS5jbGVhci5lbWl0KCk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8g6K6+6K6h5Zmo5LiK6YWN572u55qE5Yig6Zmk5Y2V5Liq5qCH562+5LqL5Lu2XHJcbiAgICBpZiAodGhpcy5vcHRpb25zLnRhZ1JlbW92ZWQpIHtcclxuICAgICAgdGhpcy5vcHRpb25zLnRhZ1JlbW92ZWQodGhpcy5ldmVudFByYW1zKHJlbW92ZWRJdGVtKSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBzZWxlY3Rpb25zQ2hhbmdlKGNoYW5nZURhdGE6IHtcclxuICAgIGluZm86IHN0cmluZyxcclxuICAgIGRhdGE6IEFycmF5PGFueT5cclxuICB9KSB7XHJcbiAgICBjb25zdCBmb3JtZWRTZWxlY3Rpb25zID0gdGhpcy5mb3JtU2VsZWN0ZWRSb3dEYXRhKClcclxuICAgIHRoaXMudXBkYXRlQ29udHJvbFZhbHVlKGZvcm1lZFNlbGVjdGlvbnMpO1xyXG4gICAgdGhpcy5pbnN0YW5jZS5zZWxlY3RlZERhdGEuZW1pdChmb3JtZWRTZWxlY3Rpb25zKTtcclxuICAgIC8vIOiuvuiuoeWZqOS4iumFjee9rueahOmAieS4reaVsOaNruWQjuS6i+S7tlxyXG4gICAgaWYgKHRoaXMub3B0aW9ucy5zZWxlY3Rpb25zQ2hhbmdlKSB7XHJcbiAgICAgIHRoaXMub3B0aW9ucy5zZWxlY3Rpb25zQ2hhbmdlKHRoaXMuZXZlbnRQcmFtcyhjaGFuZ2VEYXRhKSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICB1cGRhdGVDb250cm9sVmFsdWUoc2VsZWN0ZWRSb3cpIHtcclxuICAgIGlmICh0aGlzLmluc3RhbmNlLm1hcEZpZWxkcyAmJiB0aGlzLmJpbmRpbmdEYXRhKSB7XHJcbiAgICAgIHRoaXMubG9va3VwRmllbGRNYXAoc2VsZWN0ZWRSb3csIHRoaXMuaW5zdGFuY2UubWFwRmllbGRzLCB0aGlzLmJpbmRpbmdEYXRhKTtcclxuICAgIH1cclxuICB9XHJcblxyXG5cclxuICBmb3JtU2VsZWN0ZWRSb3dEYXRhKCkge1xyXG4gICAgbGV0IHNlbGVjdGVkUm93RGF0YSA9IFtdO1xyXG4gICAgdGhpcy5pbnN0YW5jZS5zZWxlY3Rpb25zLmZvckVhY2goKGl0ZW0pID0+IHtcclxuICAgICAgY29uc3QgZGVmYXVsdERpc3BsYXlOYW1lID0gdGhpcy5pbnN0YW5jZS5kaXNwbGF5RmllbGQgPyBpdGVtW3RoaXMuaW5zdGFuY2UuZGlzcGxheUZpZWxkXSA6IGBbJHtpdGVtLmNvZGV9XSR7aXRlbS5uYW1lfWA7XHJcbiAgICAgIGNvbnN0IGRpc3BsYXlOYW1lID0gdGhpcy5pbnN0YW5jZS5mb3JtYXRGbiA/IHRoaXMuaW5zdGFuY2UuZm9ybWF0Rm4oaXRlbSkgOiBkZWZhdWx0RGlzcGxheU5hbWU7XHJcbiAgICAgIHNlbGVjdGVkUm93RGF0YS5wdXNoKE9iamVjdC5hc3NpZ24oe30sIGl0ZW0sIHsgZGlzcGxheU5hbWUgfSkpO1xyXG4gICAgfSlcclxuICAgIHJldHVybiBzZWxlY3RlZFJvd0RhdGEubGVuZ3RoID8gc2VsZWN0ZWRSb3dEYXRhIDogbnVsbDtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgZXZlbnRQcmFtcygkZXZlbnQpOiBhbnkge1xyXG4gICAgY29uc3QgcCA9IHRoaXMuZXZlbnRQYXJhbXMoJGV2ZW50KTtcclxuICAgIHBbJ2luc3RhbmNlJ10gPSB0aGlzLmluc3RhbmNlO1xyXG4gICAgcFsnZWRpdG9yJ10gPSB0aGlzO1xyXG4gICAgcmV0dXJuIHA7XHJcbiAgfVxyXG59XHJcblxyXG5cclxuZXhwb3J0IGNvbnN0IFBlcnNvbm5lbFNlbGVjdG9yRGF0YUdyaWRFZGl0b3JQcm92aWRlciA9IHsgcHJvdmlkZTogR1JJRF9FRElUT1JTLCB1c2VWYWx1ZTogeyBuYW1lOiAnUGVyc29ubmVsU2VsZWN0b3InLCB2YWx1ZTogRGF0YWdyaWRQZXJzb25uZWxTZWxlY3RvckNvbXBvbmVudCB9LCBtdWx0aTogdHJ1ZSB9Il19
/**
 * @fileoverview added by tsickle
 * Generated from: utils/favorites.tool.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { HttpClient, HttpHeaders } from '@angular/common/http';
import { Injectable } from '@angular/core';
import { of, Subject } from 'rxjs';
export class FavoritesTool {
    /**
     * @param {?} http
     */
    constructor(http) {
        this.http = http;
        this.absOrgType = 'System_organization';
        this.busNum = 'common';
        this.idField = 'userId';
        this.disableCurrentUser = false;
        this.withPermission = false;
        this.favoritesList = [];
        this.enableFavorites = true;
        this.initFavorites = false;
        this.enableSecurityControl = false;
        this.absRfQueryUrl = '/api/runtime/sys/v1.0/absRecentContacts/query';
        this.absRfModifyUrl = '/api/runtime/sys/v1.0/absRecentContacts/modify';
        this.subject = new Subject();
    }
    /**
     * 操作最近联系人或收藏夹
     * @param {?} actionToken
     * @param {?} param RfRequestParam
     * @return {?} observable
     */
    curdRecentContactsOrFavorites(actionToken, param) {
        /** @type {?} */
        let url = this.absRfQueryUrl;
        if (actionToken === 'modify') {
            url = this.absRfModifyUrl;
        }
        /** @type {?} */
        const options = {
            headers: new HttpHeaders({
                'Content-Type': 'application/json',
            })
        };
        return this.http.post(url, param, options);
    }
    /**
     * @return {?}
     */
    get favoritesSubject() {
        return this.subject.asObservable();
    }
    /**
     * @param {?} value
     * @return {?}
     */
    setFavoritesList(value) {
        this.subject.next(value);
    }
    /**
     * 获取收藏夹中人员列表
     * @return {?}
     */
    getFavoritesList() {
        if (this.enableFavorites) {
            /** @type {?} */
            const param = {
                absOrgType: this.absOrgType,
                bizId: this.busNum,
                objectValue: 'CollectUser'
            };
            if (this.disableCurrentUser) {
                /** @type {?} */
                const currentUserId = ((/** @type {?} */ (window))).gspframeworkService.common.userInfos.get().id;
                param.filterUserIds = [currentUserId];
            }
            if (this.withPermission) {
                param.withPermission = true;
                param.authOp = 'UserManage';
            }
            if (this.enableSecurityControl) {
                param.securityControl = true;
                param.securityLevel = this.securityLevel;
            }
            return this.curdRecentContactsOrFavorites('query', param);
        }
        return of(null);
    }
    /**
     * 加入或取消收藏
     * @param {?} e 鼠标事件
     * @param {?} object
     * @return {?} Observable
     */
    toggleFavorites(e, object) {
        /** @type {?} */
        const id = object[this.idField];
        /** @type {?} */
        let action = 'add';
        /** @type {?} */
        const param = {
            absOrgType: this.absOrgType,
            bizId: this.busNum,
            objectValue: 'CollectUser'
        };
        if (this.favoritesList.findIndex((/**
         * @param {?} item
         * @return {?}
         */
        item => item[this.idField] === id)) !== -1) {
            param.deleteList = [id];
            action = 'delete';
        }
        else {
            param.addList = [id];
        }
        this.curdRecentContactsOrFavorites('modify', param).subscribe((/**
         * @return {?}
         */
        () => {
            if (action === 'add') {
                /** @type {?} */
                const index = this.favoritesList.findIndex((/**
                 * @param {?} item
                 * @return {?}
                 */
                item => item[this.idField] === id));
                if (index === -1) {
                    this.favoritesList.push(object);
                }
            }
            else {
                this.favoritesList = this.favoritesList.filter((/**
                 * @param {?} item
                 * @return {?}
                 */
                item => item[this.idField] !== id));
            }
            this.setFavoritesList(this.favoritesList);
        }));
        e.cancelBubble = true;
        e.stopPropagation();
    }
    /**
     * 清空我的收藏
     * @return {?}
     */
    clearFavoritesList() {
        if (!this.favoritesList.length) {
            this.setFavoritesList(this.favoritesList);
            return;
        }
        /** @type {?} */
        const ids = this.favoritesList.map((/**
         * @param {?} item
         * @return {?}
         */
        item => item[this.idField]));
        /** @type {?} */
        const param = {
            absOrgType: this.absOrgType,
            bizId: this.busNum,
            objectValue: 'CollectUser',
            addList: [],
            deleteList: ids
        };
        this.curdRecentContactsOrFavorites('modify', param).subscribe((/**
         * @param {?} val
         * @return {?}
         */
        (val) => {
            this.favoritesList = [];
            this.setFavoritesList(this.favoritesList);
        }));
    }
}
FavoritesTool.decorators = [
    { type: Injectable }
];
/** @nocollapse */
FavoritesTool.ctorParameters = () => [
    { type: HttpClient }
];
if (false) {
    /** @type {?} */
    FavoritesTool.prototype.absOrgType;
    /** @type {?} */
    FavoritesTool.prototype.busNum;
    /** @type {?} */
    FavoritesTool.prototype.idField;
    /** @type {?} */
    FavoritesTool.prototype.disableCurrentUser;
    /** @type {?} */
    FavoritesTool.prototype.withPermission;
    /** @type {?} */
    FavoritesTool.prototype.favoritesList;
    /** @type {?} */
    FavoritesTool.prototype.enableFavorites;
    /** @type {?} */
    FavoritesTool.prototype.initFavorites;
    /** @type {?} */
    FavoritesTool.prototype.enableSecurityControl;
    /** @type {?} */
    FavoritesTool.prototype.securityLevel;
    /** @type {?} */
    FavoritesTool.prototype.absRfQueryUrl;
    /** @type {?} */
    FavoritesTool.prototype.absRfModifyUrl;
    /**
     * @type {?}
     * @private
     */
    FavoritesTool.prototype.subject;
    /**
     * @type {?}
     * @private
     */
    FavoritesTool.prototype.http;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmF2b3JpdGVzLnRvb2wuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL3VpLXBlcnNvbm5lbC1zZWxlY3Rvci8iLCJzb3VyY2VzIjpbInV0aWxzL2Zhdm9yaXRlcy50b29sLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsT0FBTyxFQUFFLFVBQVUsRUFBRSxXQUFXLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUMvRCxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzNDLE9BQU8sRUFBYyxFQUFFLEVBQUUsT0FBTyxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBSS9DLE1BQU0sT0FBTyxhQUFhOzs7O0lBa0J0QixZQUFvQixJQUFnQjtRQUFoQixTQUFJLEdBQUosSUFBSSxDQUFZO1FBaEJwQyxlQUFVLEdBQUcscUJBQXFCLENBQUM7UUFDbkMsV0FBTSxHQUFHLFFBQVEsQ0FBQztRQUNsQixZQUFPLEdBQUcsUUFBUSxDQUFDO1FBQ25CLHVCQUFrQixHQUFHLEtBQUssQ0FBQztRQUMzQixtQkFBYyxHQUFHLEtBQUssQ0FBQztRQUN2QixrQkFBYSxHQUFHLEVBQUUsQ0FBQztRQUNuQixvQkFBZSxHQUFHLElBQUksQ0FBQztRQUN2QixrQkFBYSxHQUFHLEtBQUssQ0FBQztRQUN0QiwwQkFBcUIsR0FBWSxLQUFLLENBQUM7UUFHdkMsa0JBQWEsR0FBRywrQ0FBK0MsQ0FBQztRQUNoRSxtQkFBYyxHQUFHLGdEQUFnRCxDQUFDO1FBRTFELFlBQU8sR0FBRyxJQUFJLE9BQU8sRUFBTyxDQUFDO0lBSXJDLENBQUM7Ozs7Ozs7SUFPQSw2QkFBNkIsQ0FBQyxXQUFtQixFQUFFLEtBQXFCOztZQUNqRSxHQUFHLEdBQUcsSUFBSSxDQUFDLGFBQWE7UUFDNUIsSUFBSSxXQUFXLEtBQUssUUFBUSxFQUFFO1lBQzFCLEdBQUcsR0FBRyxJQUFJLENBQUMsY0FBYyxDQUFDO1NBQzdCOztjQUNLLE9BQU8sR0FBRztZQUNaLE9BQU8sRUFBRSxJQUFJ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O0lBQ25DLCtCQUFrQjs7SUFDbEIsZ0NBQW1COztJQUNuQiwyQ0FBMkI7O0lBQzNCLHVDQUF1Qjs7SUFDdkIsc0NBQW1COztJQUNuQix3Q0FBdUI7O0lBQ3ZCLHNDQUFzQjs7SUFDdEIsOENBQXVDOztJQUN2QyxzQ0FBNkI7O0lBRTdCLHNDQUFnRTs7SUFDaEUsdUNBQWtFOzs7OztJQUVsRSxnQ0FBcUM7Ozs7O0lBRXpCLDZCQUF3QiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEh0dHBDbGllbnQsIEh0dHBIZWFkZXJzIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uL2h0dHAnO1xyXG5pbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IE9ic2VydmFibGUsIG9mLCBTdWJqZWN0IH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7IFJmUmVxdWVzdFBhcmFtLCBTZWN1cml0eUxldmVsIH0gZnJvbSAnLi91c2VyLnR5cGUnO1xyXG5cclxuQEluamVjdGFibGUoKVxyXG5leHBvcnQgY2xhc3MgRmF2b3JpdGVzVG9vbCB7XHJcblxyXG4gICAgYWJzT3JnVHlwZSA9ICdTeXN0ZW1fb3JnYW5pemF0aW9uJztcclxuICAgIGJ1c051bSA9ICdjb21tb24nO1xyXG4gICAgaWRGaWVsZCA9ICd1c2VySWQnO1xyXG4gICAgZGlzYWJsZUN1cnJlbnRVc2VyID0gZmFsc2U7XHJcbiAgICB3aXRoUGVybWlzc2lvbiA9IGZhbHNlO1xyXG4gICAgZmF2b3JpdGVzTGlzdCA9IFtdO1xyXG4gICAgZW5hYmxlRmF2b3JpdGVzID0gdHJ1ZTtcclxuICAgIGluaXRGYXZvcml0ZXMgPSBmYWxzZTtcclxuICAgIGVuYWJsZVNlY3VyaXR5Q29udHJvbDogYm9vbGVhbiA9IGZhbHNlO1xyXG4gICAgc2VjdXJpdHlMZXZlbDogU2VjdXJpdHlMZXZlbDtcclxuXHJcbiAgICBhYnNSZlF1ZXJ5VXJsID0gJy9hcGkvcnVudGltZS9zeXMvdjEuMC9hYnNSZWNlbnRDb250YWN0cy9xdWVyeSc7XHJcbiAgICBhYnNSZk1vZGlmeVVybCA9ICcvYXBpL3J1bnRpbWUvc3lzL3YxLjAvYWJzUmVjZW50Q29udGFjdHMvbW9kaWZ5JztcclxuXHJcbiAgICBwcml2YXRlIHN1YmplY3QgPSBuZXcgU3ViamVjdDxhbnk+KCk7XHJcblxyXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBodHRwOiBIdHRwQ2xpZW50KSB7XHJcblxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5pON5L2c5pyA6L+R6IGU57O75Lq65oiW5pS26JeP5aS5XHJcbiAgICAgKiBAcGFyYW0gcGFyYW0gUmZSZXF1ZXN0UGFyYW1cclxuICAgICAqIEByZXR1cm5zIG9ic2VydmFibGVcclxuICAgICAqL1xyXG4gICAgIGN1cmRSZWNlbnRDb250YWN0c09yRmF2b3JpdGVzKGFjdGlvblRva2VuOiBzdHJpbmcsIHBhcmFtOiBSZlJlcXVlc3RQYXJhbSkge1xyXG4gICAgICAgIGxldCB1cmwgPSB0aGlzLmFic1JmUXVlcnlVcmw7XHJcbiAgICAgICAgaWYgKGFjdGlvblRva2VuID09PSAnbW9kaWZ5Jykge1xyXG4gICAgICAgICAgICB1cmwgPSB0aGlzLmFic1JmTW9kaWZ5VXJsO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCBvcHRpb25zID0ge1xyXG4gICAgICAgICAgICBoZWFkZXJzOiBuZXcgSHR0cEhlYWRlcnMoe1xyXG4gICAgICAgICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyxcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICB9O1xyXG4gICAgICAgIHJldHVybiB0aGlzLmh0dHAucG9zdCh1cmwsIHBhcmFtLCBvcHRpb25zKTtcclxuICAgIH1cclxuXHJcbiAgICBnZXQgZmF2b3JpdGVzU3ViamVjdCgpOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnN1YmplY3QuYXNPYnNlcnZhYmxlKCk7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0RmF2b3JpdGVzTGlzdCh2YWx1ZTogYW55KSB7XHJcbiAgICAgICAgdGhpcy5zdWJqZWN0Lm5leHQodmFsdWUpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog6I635Y+W5pS26JeP5aS55Lit5Lq65ZGY5YiX6KGoXHJcbiAgICAgKi9cclxuICAgIGdldEZhdm9yaXRlc0xpc3QoKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgICAgICBpZiAodGhpcy5lbmFibGVGYXZvcml0ZXMpIHtcclxuICAgICAgICAgICAgY29uc3QgcGFyYW06IFJmUmVxdWVzdFBhcmFtID0ge1xyXG4gICAgICAgICAgICAgICAgYWJzT3JnVHlwZTogdGhpcy5hYnNPcmdUeXBlLFxyXG4gICAgICAgICAgICAgICAgYml6SWQ6IHRoaXMuYnVzTnVtLFxyXG4gICAgICAgICAgICAgICAgb2JqZWN0VmFsdWU6ICdDb2xsZWN0VXNlcidcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgaWYgKHRoaXMuZGlzYWJsZUN1cnJlbnRVc2VyKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBjdXJyZW50VXNlcklkID0gKHdpbmRvdyBhcyBhbnkpLmdzcGZyYW1ld29ya1NlcnZpY2UuY29tbW9uLnVzZXJJbmZvcy5nZXQoKS5pZDtcclxuICAgICAgICAgICAgICAgIHBhcmFtLmZpbHRlclVzZXJJZHMgPSBbY3VycmVudFVzZXJJZF07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHRoaXMud2l0aFBlcm1pc3Npb24pIHtcclxuICAgICAgICAgICAgICAgIHBhcmFtLndpdGhQZXJtaXNzaW9uID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIHBhcmFtLmF1dGhPcCA9ICdVc2VyTWFuYWdlJztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAodGhpcy5lbmFibGVTZWN1cml0eUNvbnRyb2wpIHtcclxuICAgICAgICAgICAgICAgIHBhcmFtLnNlY3VyaXR5Q29udHJvbCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICBwYXJhbS5zZWN1cml0eUxldmVsID0gdGhpcy5zZWN1cml0eUxldmVsO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmN1cmRSZWNlbnRDb250YWN0c09yRmF2b3JpdGVzKCdxdWVyeScsIHBhcmFtKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIG9mKG51bGwpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5Yqg5YWl5oiW5Y+W5raI5pS26JePXHJcbiAgICAgKiBAcGFyYW0gZSDpvKDmoIfkuovku7ZcclxuICAgICAqIEBwYXJhbSBpZCDmoIfor4ZcclxuICAgICAqIEByZXR1cm5zIE9ic2VydmFibGVcclxuICAgICAqL1xyXG4gICAgdG9nZ2xlRmF2b3JpdGVzKGU6IGFueSwgb2JqZWN0OiBhbnkpIHtcclxuICAgICAgICBjb25zdCBpZCA9IG9iamVjdFt0aGlzLmlkRmllbGRdO1xyXG4gICAgICAgIGxldCBhY3Rpb24gPSAnYWRkJztcclxuICAgICAgICBjb25zdCBwYXJhbTogUmZSZXF1ZXN0UGFyYW0gPSB7XHJcbiAgICAgICAgICAgIGFic09yZ1R5cGU6IHRoaXMuYWJzT3JnVHlwZSxcclxuICAgICAgICAgICAgYml6SWQ6IHRoaXMuYnVzTnVtLFxyXG4gICAgICAgICAgICBvYmplY3RWYWx1ZTogJ0NvbGxlY3RVc2VyJ1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgaWYgKHRoaXMuZmF2b3JpdGVzTGlzdC5maW5kSW5kZXgoaXRlbSA9PiBpdGVtW3RoaXMuaWRGaWVsZF0gPT09IGlkKSAhPT0gLTEpIHtcclxuICAgICAgICAgICAgcGFyYW0uZGVsZXRlTGlzdCA9IFtpZF07XHJcbiAgICAgICAgICAgIGFjdGlvbiA9ICdkZWxldGUnO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHBhcmFtLmFkZExpc3QgPSBbaWRdO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmN1cmRSZWNlbnRDb250YWN0c09yRmF2b3JpdGVzKCdtb2RpZnknLCBwYXJhbSkuc3Vic2NyaWJlKCgpID0+IHtcclxuICAgICAgICAgICAgaWYgKGFjdGlvbiA9PT0gJ2FkZCcpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGluZGV4ID0gdGhpcy5mYXZvcml0ZXNMaXN0LmZpbmRJbmRleChpdGVtID0+IGl0ZW1bdGhpcy5pZEZpZWxkXSA9PT0gaWQpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGluZGV4ID09PSAtMSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZmF2b3JpdGVzTGlzdC5wdXNoKG9iamVjdCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmZhdm9yaXRlc0xpc3QgPSB0aGlzLmZhdm9yaXRlc0xpc3QuZmlsdGVyKGl0ZW0gPT4gaXRlbVt0aGlzLmlkRmllbGRdICE9PSBpZCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5zZXRGYXZvcml0ZXNMaXN0KHRoaXMuZmF2b3JpdGVzTGlzdCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgZS5jYW5jZWxCdWJibGUgPSB0cnVlO1xyXG4gICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDmuIXnqbrmiJHnmoTmlLbol49cclxuICAgICAqL1xyXG4gICAgY2xlYXJGYXZvcml0ZXNMaXN0KCkge1xyXG4gICAgICAgIGlmICghdGhpcy5mYXZvcml0ZXNMaXN0Lmxlbmd0aCkge1xyXG4gICAgICAgICAgICB0aGlzLnNldEZhdm9yaXRlc0xpc3QodGhpcy5mYXZvcml0ZXNMaXN0KTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCBpZHMgPSB0aGlzLmZhdm9yaXRlc0xpc3QubWFwKGl0ZW0gPT4gaXRlbVt0aGlzLmlkRmllbGRdKTtcclxuICAgICAgICBjb25zdCBwYXJhbTogUmZSZXF1ZXN0UGFyYW0gPSB7XHJcbiAgICAgICAgICAgIGFic09yZ1R5cGU6IHRoaXMuYWJzT3JnVHlwZSxcclxuICAgICAgICAgICAgYml6SWQ6IHRoaXMuYnVzTnVtLFxyXG4gICAgICAgICAgICBvYmplY3RWYWx1ZTogJ0NvbGxlY3RVc2VyJyxcclxuICAgICAgICAgICAgYWRkTGlzdDogW10sXHJcbiAgICAgICAgICAgIGRlbGV0ZUxpc3Q6IGlkc1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHRoaXMuY3VyZFJlY2VudENvbnRhY3RzT3JGYXZvcml0ZXMoJ21vZGlmeScsIHBhcmFtKS5zdWJzY3JpYmUoKHZhbCkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLmZhdm9yaXRlc0xpc3QgPSBbXTtcclxuICAgICAgICAgICAgdGhpcy5zZXRGYXZvcml0ZXNMaXN0KHRoaXMuZmF2b3JpdGVzTGlzdCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbn1cclxuIl19
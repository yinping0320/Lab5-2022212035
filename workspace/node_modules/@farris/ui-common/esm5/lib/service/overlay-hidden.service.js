/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Injectable } from "@angular/core";
/**
 * @record
 */
export function OverLayOption() { }
if (false) {
    /**
     * 仅监听top Window 中的事件
     * @type {?|undefined}
     */
    OverLayOption.prototype.onlyTopWindow;
    /**
     * 仅处理滚轮滚动事件
     * @type {?|undefined}
     */
    OverLayOption.prototype.mouseWheel;
    /** @type {?|undefined} */
    OverLayOption.prototype.mouseDown;
    /** @type {?|undefined} */
    OverLayOption.prototype.scroll;
    /** @type {?|undefined} */
    OverLayOption.prototype.mouseUp;
    /** @type {?|undefined} */
    OverLayOption.prototype.click;
}
/** @type {?} */
var OverLayOptionDefaults = {
    onlyTopWindow: false,
    mouseWheel: true,
    mouseDown: true,
    scroll: false,
    mouseUp: false,
    click: false
};
var OverLayHiddenService = /** @class */ (function () {
    function OverLayHiddenService() {
        this.eventsMap = new WeakMap();
    }
    /**
     * @private
     * @param {?} el
     * @param {?} action
     * @return {?}
     */
    OverLayHiddenService.prototype.iframeEventHandle = /**
     * @private
     * @param {?} el
     * @param {?} action
     * @return {?}
     */
    function (el, action) {
        var e_1, _a;
        /** @type {?} */
        var iframes = Array.from(document.querySelectorAll('iframe'));
        if (iframes && iframes.length) {
            /** @type {?} */
            var _documentClickEvent = this.eventsMap.get(el);
            try {
                for (var iframes_1 = tslib_1.__values(iframes), iframes_1_1 = iframes_1.next(); !iframes_1_1.done; iframes_1_1 = iframes_1.next()) {
                    var iframe = iframes_1_1.value;
                    /** @type {?} */
                    var iframeDoc = iframe.contentDocument;
                    if (iframeDoc) {
                        iframeDoc[action]('mousedown', _documentClickEvent);
                        iframeDoc[action]('mousewheel', _documentClickEvent);
                        iframeDoc[action]('DOMMouseScroll', _documentClickEvent);
                    }
                }
            }
            catch (e_1_1) { e_1 = { error: e_1_1 }; }
            finally {
                try {
                    if (iframes_1_1 && !iframes_1_1.done && (_a = iframes_1.return)) _a.call(iframes_1);
                }
                finally { if (e_1) throw e_1.error; }
            }
        }
    };
    /**
     * @private
     * @param {?} el
     * @return {?}
     */
    OverLayHiddenService.prototype.removeMouseEvent = /**
     * @private
     * @param {?} el
     * @return {?}
     */
    function (el) {
        /** @type {?} */
        var _documentClickEvent = this.eventsMap.get(el);
        if (_documentClickEvent) {
            document.removeEventListener('mousedown', _documentClickEvent, true);
            document.removeEventListener('mousewheel', _documentClickEvent, true);
            document.removeEventListener('DOMMouseScroll', _documentClickEvent, true);
            if (top !== window) {
                top.document.body.removeEventListener('mousedown', _documentClickEvent, true);
            }
            this.iframeEventHandle(el, 'removeEventListener');
            _documentClickEvent = null;
            this.eventsMap.delete(el);
        }
    };
    /**
     * @param {?} el
     * @return {?}
     */
    OverLayHiddenService.prototype.destory = /**
     * @param {?} el
     * @return {?}
     */
    function (el) {
        this.removeMouseEvent(el);
    };
    /**
     * @param {?} el
     * @param {?} _documentClickEvent
     * @param {?=} options
     * @return {?}
     */
    OverLayHiddenService.prototype.registerMouseEvent = /**
     * @param {?} el
     * @param {?} _documentClickEvent
     * @param {?=} options
     * @return {?}
     */
    function (el, _documentClickEvent, options) {
        // const _documentClickEvent1 = (e) => {
        //     if (e && e.target && e.target.nodeName.toLowerCase() == 'svg') {
        //         return;
        //     }
        var _this = this;
        //     _documentClickEvent(e);
        // }
        if (this.eventsMap.has(el)) {
            return;
        }
        else {
            this.eventsMap.set(el, _documentClickEvent);
        }
        if (!options) {
            options = OverLayOptionDefaults;
        }
        else {
            options = Object.assign({}, OverLayOptionDefaults, options);
        }
        if (options.onlyTopWindow && top !== window) {
            top.document.body.addEventListener('mousedown', _documentClickEvent, true);
        }
        else {
            if (options.mouseDown) {
                // 注册 mousedown 事件 隐藏panel
                document.addEventListener('mousedown', _documentClickEvent, true);
            }
            if (options.mouseWheel) {
                document.addEventListener('mousewheel', _documentClickEvent, true);
                document.addEventListener('DOMMouseScroll', _documentClickEvent, true);
            }
            if (options.scroll) {
                document.addEventListener('scroll', _documentClickEvent, true);
            }
            if (options.mouseUp) {
                document.addEventListener('mouseup', _documentClickEvent);
            }
            if (options.click) {
                document.addEventListener('click', _documentClickEvent);
            }
            if (top !== window) {
                top.document.body.addEventListener('mousedown', _documentClickEvent, true);
            }
            this.iframeEventHandle(el, 'addEventListener');
        }
        return (/**
         * @return {?}
         */
        function () {
            _this.destory(el);
        });
    };
    OverLayHiddenService.decorators = [
        { type: Injectable }
    ];
    return OverLayHiddenService;
}());
export { OverLayHiddenService };
if (false) {
    /**
     * @type {?}
     * @private
     */
    OverLayHiddenService.prototype.eventsMap;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoib3ZlcmxheS1oaWRkZW4uc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvdWktY29tbW9uLyIsInNvdXJjZXMiOlsibGliL3NlcnZpY2Uvb3ZlcmxheS1oaWRkZW4uc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7Ozs7QUFHM0MsbUNBU0M7Ozs7OztJQVBHLHNDQUF3Qjs7Ozs7SUFFeEIsbUNBQXFCOztJQUNyQixrQ0FBb0I7O0lBQ3BCLCtCQUFpQjs7SUFDakIsZ0NBQWtCOztJQUNsQiw4QkFBZ0I7OztJQUdkLHFCQUFxQixHQUFrQjtJQUN6QyxhQUFhLEVBQUUsS0FBSztJQUNwQixVQUFVLEVBQUUsSUFBSTtJQUNoQixTQUFTLEVBQUUsSUFBSTtJQUNmLE1BQU0sRUFBRSxLQUFLO0lBQ2IsT0FBTyxFQUFFLEtBQUs7SUFDZCxLQUFLLEVBQUUsS0FBSztDQUNmO0FBQ0Q7SUFBQTtRQUdZLGNBQVMsR0FBRyxJQUFJLE9BQU8sRUFBRSxDQUFDO0lBcUd0QyxDQUFDOzs7Ozs7O0lBbkdXLGdEQUFpQjs7Ozs7O0lBQXpCLFVBQTBCLEVBQU8sRUFBRSxNQUFrRDs7O1lBQzNFLE9BQU8sR0FBRyxLQUFLLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxnQkFBZ0IsQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUMvRCxJQUFJLE9BQU8sSUFBSSxPQUFPLENBQUMsTUFBTSxFQUFFOztnQkFDdkIsbUJBQW1CLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDOztnQkFDaEQsS0FBcUIsSUFBQSxZQUFBLGlCQUFBLE9BQU8sQ0FBQSxnQ0FBQSxxREFBRTtvQkFBekIsSUFBTSxNQUFNLG9CQUFBOzt3QkFDUCxTQUFTLEdBQUcsTUFBTSxDQUFDLGVBQWU7b0JBQ3hDLElBQUksU0FBUyxFQUFFO3dCQUNYLFNBQVMsQ0FBQyxNQUFNLENBQUMs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QUFtQixFQUFFLElBQUksQ0FBQyxDQUFDO2FBQ2xFO1lBRUQsSUFBSSxPQUFPLENBQUMsT0FBTyxFQUFFO2dCQUNqQixRQUFRLENBQUMsZ0JBQWdCLENBQUMsU0FBUyxFQUFFLG1CQUFtQixDQUFDLENBQUM7YUFDN0Q7WUFFRCxJQUFJLE9BQU8sQ0FBQyxLQUFLLEVBQUU7Z0JBQ2YsUUFBUSxDQUFDLGdCQUFnQixDQUFDLE9BQU8sRUFBRSxtQkFBbUIsQ0FBQyxDQUFDO2FBQzNEO1lBR0QsSUFBSSxHQUFHLEtBQUssTUFBTSxFQUFFO2dCQUNoQixHQUFHLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxXQUFXLEVBQUUsbUJBQW1CLEVBQUUsSUFBSSxDQUFDLENBQUM7YUFDOUU7WUFFRCxJQUFJLENBQUMsaUJBQWlCLENBQUMsRUFBRSxFQUFFLGtCQUFrQixDQUFDLENBQUM7U0FDbEQ7UUFFRDs7O1FBQU87WUFDSCxLQUFJLENBQUMsT0FBTyxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBQ3JCLENBQUMsRUFBQTtJQUNMLENBQUM7O2dCQXZHSixVQUFVOztJQXdHWCwyQkFBQztDQUFBLEFBeEdELElBd0dDO1NBdkdZLG9CQUFvQjs7Ozs7O0lBRTdCLHlDQUFrQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tIFwiQGFuZ3VsYXIvY29yZVwiO1xyXG5cclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgT3ZlckxheU9wdGlvbiB7XHJcbiAgICAvKiog5LuF55uR5ZCsdG9wIFdpbmRvdyDkuK3nmoTkuovku7YgKi9cclxuICAgIG9ubHlUb3BXaW5kb3c/OiBib29sZWFuO1xyXG4gICAgLyoqIOS7heWkhOeQhua7mui9rua7muWKqOS6i+S7tiAqL1xyXG4gICAgbW91c2VXaGVlbD86IGJvb2xlYW47XHJcbiAgICBtb3VzZURvd24/OiBib29sZWFuO1xyXG4gICAgc2Nyb2xsPzogYm9vbGVhbjtcclxuICAgIG1vdXNlVXA/OiBib29sZWFuO1xyXG4gICAgY2xpY2s/OiBib29sZWFuO1xyXG59XHJcblxyXG5jb25zdCBPdmVyTGF5T3B0aW9uRGVmYXVsdHM6IE92ZXJMYXlPcHRpb24gPSB7XHJcbiAgICBvbmx5VG9wV2luZG93OiBmYWxzZSxcclxuICAgIG1vdXNlV2hlZWw6IHRydWUsXHJcbiAgICBtb3VzZURvd246IHRydWUsXHJcbiAgICBzY3JvbGw6IGZhbHNlLFxyXG4gICAgbW91c2VVcDogZmFsc2UsXHJcbiAgICBjbGljazogZmFsc2VcclxufVxyXG5ASW5qZWN0YWJsZSgpXHJcbmV4cG9ydCBjbGFzcyBPdmVyTGF5SGlkZGVuU2VydmljZSB7XHJcbiAgICBcclxuICAgIHByaXZhdGUgZXZlbnRzTWFwID0gbmV3IFdlYWtNYXAoKTtcclxuXHJcbiAgICBwcml2YXRlIGlmcmFtZUV2ZW50SGFuZGxlKGVsOiBhbnksIGFjdGlvbjogJ2FkZEV2ZW50TGlzdGVuZXInIHwgJ3JlbW92ZUV2ZW50TGlzdGVuZXInKSB7XHJcbiAgICAgICAgY29uc3QgaWZyYW1lcyA9IEFycmF5LmZyb20oZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnaWZyYW1lJykpO1xyXG4gICAgICAgIGlmIChpZnJhbWVzICYmIGlmcmFtZXMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIGxldCBfZG9jdW1lbnRDbGlja0V2ZW50ID0gdGhpcy5ldmVudHNNYXAuZ2V0KGVsKTtcclxuICAgICAgICAgICAgZm9yIChjb25zdCBpZnJhbWUgb2YgaWZyYW1lcykge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgaWZyYW1lRG9jID0gaWZyYW1lLmNvbnRlbnREb2N1bWVudDtcclxuICAgICAgICAgICAgICAgIGlmIChpZnJhbWVEb2MpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZnJhbWVEb2NbYWN0aW9uXSgnbW91c2Vkb3duJywgX2RvY3VtZW50Q2xpY2tFdmVudCk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWZyYW1lRG9jW2FjdGlvbl0oJ21vdXNld2hlZWwnLCBfZG9jdW1lbnRDbGlja0V2ZW50KTtcclxuICAgICAgICAgICAgICAgICAgICBpZnJhbWVEb2NbYWN0aW9uXSgnRE9NTW91c2VTY3JvbGwnLCBfZG9jdW1lbnRDbGlja0V2ZW50KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHJlbW92ZU1vdXNlRXZlbnQoZWw6IEVsZW1lbnQpIHtcclxuICAgICAgICBsZXQgX2RvY3VtZW50Q2xpY2tFdmVudCA9IHRoaXMuZXZlbnRzTWFwLmdldChlbClcclxuICAgICAgICBpZiAoX2RvY3VtZW50Q2xpY2tFdmVudCkge1xyXG4gICAgICAgICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdtb3VzZWRvd24nLCBfZG9jdW1lbnRDbGlja0V2ZW50LCB0cnVlKTtcclxuICAgICAgICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignbW91c2V3aGVlbCcsIF9kb2N1bWVudENsaWNrRXZlbnQsIHRydWUpO1xyXG4gICAgICAgICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdET01Nb3VzZVNjcm9sbCcsIF9kb2N1bWVudENsaWNrRXZlbnQsIHRydWUpO1xyXG5cclxuICAgICAgICAgICAgaWYgKHRvcCAhPT0gd2luZG93KSB7XHJcbiAgICAgICAgICAgICAgICB0b3AuZG9jdW1lbnQuYm9keS5yZW1vdmVFdmVudExpc3RlbmVyKCdtb3VzZWRvd24nLCBfZG9jdW1lbnRDbGlja0V2ZW50LCB0cnVlKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdGhpcy5pZnJhbWVFdmVudEhhbmRsZShlbCwgJ3JlbW92ZUV2ZW50TGlzdGVuZXInKTtcclxuICAgICAgICAgICAgX2RvY3VtZW50Q2xpY2tFdmVudCA9IG51bGw7XHJcblxyXG4gICAgICAgICAgICB0aGlzLmV2ZW50c01hcC5kZWxldGUoZWwpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBkZXN0b3J5KGVsKSB7XHJcbiAgICAgICAgdGhpcy5yZW1vdmVNb3VzZUV2ZW50KGVsKTtcclxuICAgIH1cclxuXHJcbiAgICByZWdpc3Rlck1vdXNlRXZlbnQoZWw6IGFueSwgX2RvY3VtZW50Q2xpY2tFdmVudDogKGUpID0+IHZvaWQsIG9wdGlvbnM/OiBPdmVyTGF5T3B0aW9uKSB7XHJcbiAgICAgICAgXHJcbiAgICAgICAgLy8gY29uc3QgX2RvY3VtZW50Q2xpY2tFdmVudDEgPSAoZSkgPT4ge1xyXG4gICAgICAgIC8vICAgICBpZiAoZSAmJiBlLnRhcmdldCAmJiBlLnRhcmdldC5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpID09ICdzdmcnKSB7XHJcbiAgICAgICAgLy8gICAgICAgICByZXR1cm47XHJcbiAgICAgICAgLy8gICAgIH1cclxuXHJcbiAgICAgICAgLy8gICAgIF9kb2N1bWVudENsaWNrRXZlbnQoZSk7XHJcbiAgICAgICAgLy8gfVxyXG5cclxuXHJcbiAgICAgICAgaWYgKHRoaXMuZXZlbnRzTWFwLmhhcyhlbCkpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMuZXZlbnRzTWFwLnNldChlbCwgX2RvY3VtZW50Q2xpY2tFdmVudCk7XHJcblxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKCFvcHRpb25zKSB7XHJcbiAgICAgICAgICAgIG9wdGlvbnMgPSBPdmVyTGF5T3B0aW9uRGVmYXVsdHM7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgb3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oIHt9LCBPdmVyTGF5T3B0aW9uRGVmYXVsdHMsIG9wdGlvbnMpO1xyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIGlmIChvcHRpb25zLm9ubHlUb3BXaW5kb3cgJiYgdG9wICE9PSB3aW5kb3cpIHtcclxuICAgICAgICAgICAgdG9wLmRvY3VtZW50LmJvZHkuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vkb3duJywgX2RvY3VtZW50Q2xpY2tFdmVudCwgdHJ1ZSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgaWYgKG9wdGlvbnMubW91c2VEb3duKSB7XHJcbiAgICAgICAgICAgICAgICAvLyDms6jlhowgbW91c2Vkb3duIOS6i+S7tiDpmpDol49wYW5lbFxyXG4gICAgICAgICAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vkb3duJywgX2RvY3VtZW50Q2xpY2tFdmVudCwgdHJ1ZSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmIChvcHRpb25zLm1vdXNlV2hlZWwpIHtcclxuICAgICAgICAgICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNld2hlZWwnLCBfZG9jdW1lbnRDbGlja0V2ZW50LCB0cnVlKTtcclxuICAgICAgICAgICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTU1vdXNlU2Nyb2xsJywgX2RvY3VtZW50Q2xpY2tFdmVudCwgdHJ1ZSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmIChvcHRpb25zLnNjcm9sbCkge1xyXG4gICAgICAgICAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignc2Nyb2xsJywgX2RvY3VtZW50Q2xpY2tFdmVudCwgdHJ1ZSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmIChvcHRpb25zLm1vdXNlVXApIHtcclxuICAgICAgICAgICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNldXAnLCBfZG9jdW1lbnRDbGlja0V2ZW50KTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKG9wdGlvbnMuY2xpY2spIHtcclxuICAgICAgICAgICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgX2RvY3VtZW50Q2xpY2tFdmVudCk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgICAgICBpZiAodG9wICE9PSB3aW5kb3cpIHtcclxuICAgICAgICAgICAgICAgIHRvcC5kb2N1bWVudC5ib2R5LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlZG93bicsIF9kb2N1bWVudENsaWNrRXZlbnQsIHRydWUpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB0aGlzLmlmcmFtZUV2ZW50SGFuZGxlKGVsLCAnYWRkRXZlbnRMaXN0ZW5lcicpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuICgpID0+IHtcclxuICAgICAgICAgICAgdGhpcy5kZXN0b3J5KGVsKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn0iXX0=
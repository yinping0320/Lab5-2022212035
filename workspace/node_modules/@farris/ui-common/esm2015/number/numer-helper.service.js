/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Injectable } from '@angular/core';
import { BigNumber } from 'bignumber.js';
import * as i0 from "@angular/core";
export class NumberHelperService {
    constructor() { }
    /**
     * @param {?} value
     * @param {?=} opts
     * @return {?}
     */
    formatMoney(value, opts = {}) {
        return this.formatValue(value, opts);
    }
    /**
     * @param {?} value
     * @param {?=} opts
     * @return {?}
     */
    formatNumber(value, opts = {}) {
        return this.formatValue(value, opts);
    }
    /**
     * @param {?} value
     * @param {?=} opts
     * @return {?}
     */
    unformat(value, opts = {}) {
        return this._unformat(value, opts);
    }
    /**
     * 获取最大值
     * @param {?} n1
     * @param {?=} n2
     * @return {?}
     */
    max(n1, n2 = null) {
        if (Array.isArray(n1)) {
            return BigNumber.max.apply(null, n1).toFixed();
        }
        else {
            if (n1 && n2) {
                return BigNumber.maximum(n1, n2).toFixed();
            }
            else {
                console.error(`请提供比较的值n1、n2.`);
            }
        }
    }
    /**
     * 最小值
     * @param {?} n1
     * @param {?=} n2
     * @return {?}
     */
    min(n1, n2 = null) {
        if (Array.isArray(n1)) {
            return BigNumber.min.apply(null, n1).toFixed();
        }
        else {
            if (n1 && n2) {
                return BigNumber.minimum(n1, n2).toFixed();
            }
            else {
                console.error(`请提供比较的值n1、n2.`);
            }
        }
    }
    /**
     * 求和
     * @param {?} n1
     * @return {?}
     */
    sum(n1) {
        return BigNumber.sum.apply(null, n1).toFixed();
    }
    /**
     * 平均数
     * @param {?} n1
     * @param {?} len
     * @return {?}
     */
    avg(n1, len) {
        return new BigNumber(n1).div(len).toFixed();
    }
    /**
     * 加法
     * @param {?} n1
     * @param {?} n2
     * @return {?}
     */
    plus(n1, n2) {
        return new BigNumber(n1).plus(n2).toFixed();
    }
    /**
     * 乘法
     * @param {?} n1
     * @param {?} n2
     * @return {?}
     */
    multiplied(n1, n2) {
        new BigNumber(n1).times(n2).toFixed();
    }
    /**
     * 减法
     * @param {?} n1
     * @param {?} n2
     * @return {?}
     */
    minus(n1, n2) {
        return new BigNumber(n1).minus(n2).toFixed();
    }
    /**
     * 是否相等
     * @param {?} n1
     * @param {?} n2
     * @return {?}
     */
    eq(n1, n2) {
        return new BigNumber(n1).eq(n2);
    }
    /**
     * @param {?} n1
     * @param {?} n2
     * @return {?}
     */
    lt(n1, n2) {
        return new BigNumber(n1).lt(n2);
    }
    /**
     * @param {?} n1
     * @param {?} n2
     * @return {?}
     */
    gt(n1, n2) {
        return new BigNumber(n1).gt(n2);
    }
    /**
     * @param {?} n1
     * @return {?}
     */
    toNumber(n1) {
        return new BigNumber(n1).toNumber();
    }
    /**
     * @param {?} n1
     * @param {?=} precision
     * @return {?}
     */
    toFixed(n1, precision = 0) {
        return new BigNumber(n1).toFixed(precision);
    }
    /**
     * @param {?} money
     * @return {?}
     */
    convertCurrency(money) {
        // 汉字的数字
        /** @type {?} */
        const cnNums = new Array('零', '壹', '贰', '叁', '肆', '伍', '陆', '柒', '捌', '玖');
        // 基本单位
        /** @type {?} */
        const cnIntRadice = new Array('', '拾', '佰', '仟');
        // 对应整数部分扩展单位
        /** @type {?} */
        const cnIntUnits = new Array('', '万', '亿', '兆');
        // 对应小数部分单位
        /** @type {?} */
        const cnDecUnits = new Array('角', '分', '毫', '厘');
        // 整数金额时后面跟的字符
        /** @type {?} */
        const cnInteger = '整';
        // 整型完以后的单位
        /** @type {?} */
        const cnIntLast = '元';
        // 最大处理的数字
        /** @type {?} */
        const maxNum = 999999999999999.9999;
        // 金额整数部分
        /** @type {?} */
        let integerNum;
        // 金额小数部分
        /** @type {?} */
        let decimalNum;
        // 输出的中文金额字符串
        /** @type {?} */
        let chineseStr = '';
        // 分离金额后用的数组，预定义
        /** @type {?} */
        let parts;
        if (money == '') {
            return '';
        }
        money = parseFloat(money);
        if (money >= maxNum) {
            // 超出最大处理数字
            return '';
        }
        if (money === 0) {
            chineseStr = cnNums[0] + cnIntLast + cnInteger;
            return chineseStr;
        }
        // 转换为字符串
        money = money.toString();
        if (money.indexOf('.') === -1) {
            integerNum = money;
            decimalNum = '';
        }
        else {
            parts = money.split('.');
            integerNum = parts[0];
            decimalNum = parts[1].substr(0, 4);
        }
        // 获取整型部分转换
        if (parseInt(integerNum, 10) > 0) {
            /** @type {?} */
            let zeroCount = 0;
            /** @type {?} */
            const IntLen = integerNum.length;
            for (let i = 0; i < IntLen; i++) {
                /** @type {?} */
                const n = integerNum.substr(i, 1);
                /** @type {?} */
                const p = IntLen - i - 1;
                /** @type {?} */
                const q = p / 4;
                /** @type {?} */
                const m = p % 4;
                if (n == '0') {
                    zeroCount++;
                }
                else {
                    if (zeroCount > 0) {
                        chineseStr += cnNums[0];
                    }
                    // 归零
                    zeroCount = 0;
                    chineseStr += cnNums[parseInt(n, 10)] + cnIntRadice[m];
                }
                if (m == 0 && zeroCount < 4) {
                    chineseStr += cnIntUnits[q];
                }
            }
            chineseStr += cnIntLast;
        }
        // 小数部分
        if (decimalNum !== '') {
            /** @type {?} */
            const decLen = decimalNum.length;
            for (let i = 0; i < decLen; i++) {
                /** @type {?} */
                let n = decimalNum.substr(i, 1);
                if (n !== '0') {
                    chineseStr += cnNums[Number(n)] + cnDecUnits[i];
                }
            }
        }
        if (chineseStr === '') {
            chineseStr += cnNums[0] + cnIntLast + cnInteger;
        }
        else if (decimalNum === '') {
            chineseStr += cnInteger;
        }
        return chineseStr;
    }
    /**
     * @private
     * @param {?} val
     * @param {?} opts
     * @return {?}
     */
    _unformat(val, opts) {
        val = (val === null || val === undefined || isNaN(val)) ? '' : String(val);
        if (opts) {
            // 去前缀
            if (opts.prefix) {
                val = val.replace(new RegExp(opts.prefix, 'g'), '');
            }
            // 去后缀
            if (opts.suffix) {
                val = val.replace(new RegExp(opts.suffix, 'g'), '');
            }
            // 去掉千分位分隔符
            val = val.replace(/\,/g, '');
        }
        return val;
    }
    /**
     * @private
     * @param {?} value
     * @param {?} opts
     * @return {?}
     */
    formatValue(value, opts) {
        /** @type {?} */
        const bignum = new BigNumber(value);
        /** @type {?} */
        const fmt = {
            prefix: opts.prefix || '',
            suffix: opts.suffix || '',
            decimalSeparator: opts.decimal || '.',
            groupSeparator: opts.thousand || '',
            groupSize: 3
        };
        if (bignum.isNaN()) {
            return '';
        }
        /** @type {?} */
        let precision = opts.precision || 0;
        precision = Number(precision);
        return bignum.toFormat(precision, fmt);
    }
}
NumberHelperService.decorators = [
    { type: Injectable, args: [{
                providedIn: 'root'
            },] }
];
/** @nocollapse */
NumberHelperService.ctorParameters = () => [];
/** @nocollapse */ NumberHelperService.ngInjectableDef = i0.defineInjectable({ factory: function NumberHelperService_Factory() { return new NumberHelperService(); }, token: NumberHelperService, providedIn: "root" });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibnVtZXItaGVscGVyLnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL3VpLWNvbW1vbi9udW1iZXIvIiwic291cmNlcyI6WyJudW1lci1oZWxwZXIuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUMzQyxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sY0FBYyxDQUFDOztBQU96QyxNQUFNLE9BQU8sbUJBQW1CO0lBQzVCLGdCQUFnQixDQUFDOzs7Ozs7SUFFakIsV0FBVyxDQUFDLEtBQUssRUFBRSxPQUFZLEVBQUU7UUFDN0IsT0FBTyxJQUFJLENBQUMsV0FBVyxDQUFDLEtBQUssRUFBRSxJQUFJLENBQUMsQ0FBQztJQUN6QyxDQUFDOzs7Ozs7SUFFRCxZQUFZLENBQUMsS0FBSyxFQUFFLE9BQVksRUFBRTtRQUM5QixPQUFPLElBQUksQ0FBQyxXQUFXLENBQUMsS0FBSyxFQUFFLElBQUksQ0FBQyxDQUFDO0lBQ3pDLENBQUM7Ozs7OztJQUVELFFBQVEsQ0FBQyxLQUFLLEVBQUUsT0FBWSxFQUFFO1FBQzFCLE9BQU8sSUFBSSxDQUFDLFNBQVMsQ0FBQyxLQUFLLEVBQUUsSUFBSSxDQUFDLENBQUM7SUFDdkMsQ0FBQzs7Ozs7OztJQUdELEdBQUcsQ0FBQyxFQUFPLEVBQUUsRUFBRSxHQUFHLElBQUk7UUFDbEIsSUFBSSxLQUFLLENBQUMsT0FBTyxDQUFDLEVBQUUsQ0FBQyxFQUFFO1lBQ25CLE9BQU8sU0FBUyxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsSUFBSSxFQUFFLEVBQUUsQ0FBQyxDQUFDLE9BQU8sRUFBRSxDQUFDO1NBQ2xEO2FBQU07WUFDSCxJQUFJLEVBQUUsSUFBSSxFQUFFLEVBQUU7Z0JBQ1YsT0FBTyxTQUFTLENBQUMsT0FBTyxDQUFDLEVBQUUsRUFBRSxFQUFFLENBQUMsQ0FBQyxPQUFPLEVBQUUsQ0FBQzthQUM5QztpQkFBTTtn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QUM7YUFDdkQ7WUFFRCxXQUFXO1lBQ1gsR0FBRyxHQUFHLEdBQUcsQ0FBQyxPQUFPLENBQUMsS0FBSyxFQUFFLEVBQUUsQ0FBQyxDQUFDO1NBQ2hDO1FBQ0QsT0FBTyxHQUFHLENBQUM7SUFDZixDQUFDOzs7Ozs7O0lBRU8sV0FBVyxDQUFDLEtBQUssRUFBRSxJQUFTOztjQUMxQixNQUFNLEdBQUcsSUFBSSxTQUFTLENBQUMsS0FBSyxDQUFDOztjQUM3QixHQUFHLEdBQUc7WUFDUixNQUFNLEVBQUUsSUFBSSxDQUFDLE1BQU0sSUFBSSxFQUFFO1lBQ3pCLE1BQU0sRUFBRSxJQUFJLENBQUMsTUFBTSxJQUFJLEVBQUU7WUFDekIsZ0JBQWdCLEVBQUUsSUFBSSxDQUFDLE9BQU8sSUFBSSxHQUFHO1lBQ3JDLGNBQWMsRUFBRSxJQUFJLENBQUMsUUFBUSxJQUFJLEVBQUU7WUFDbkMsU0FBUyxFQUFFLENBQUM7U0FDZjtRQUVELElBQUksTUFBTSxDQUFDLEtBQUssRUFBRSxFQUFFO1lBQ2hCLE9BQU8sRUFBRSxDQUFDO1NBQ2I7O1lBRUcsU0FBUyxHQUFHLElBQUksQ0FBQyxTQUFTLElBQUksQ0FBQztRQUNuQyxTQUFTLEdBQUcsTUFBTSxDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBRTlCLE9BQU8sTUFBTSxDQUFDLFFBQVEsQ0FBQyxTQUFTLEVBQUUsR0FBRyxDQUFDLENBQUM7SUFDM0MsQ0FBQzs7O1lBck5KLFVBQVUsU0FBQztnQkFDUixVQUFVLEVBQUUsTUFBTTthQUNyQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgQmlnTnVtYmVyIH0gZnJvbSAnYmlnbnVtYmVyLmpzJztcclxuXHJcbmV4cG9ydCB0eXBlIE51bWJlclR5cGUgPSBzdHJpbmcgfCBudW1iZXI7XHJcblxyXG5ASW5qZWN0YWJsZSh7XHJcbiAgICBwcm92aWRlZEluOiAncm9vdCdcclxufSlcclxuZXhwb3J0IGNsYXNzIE51bWJlckhlbHBlclNlcnZpY2Uge1xyXG4gICAgY29uc3RydWN0b3IoKSB7IH1cclxuXHJcbiAgICBmb3JtYXRNb25leSh2YWx1ZSwgb3B0czogYW55ID0ge30pOiBzdHJpbmcge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmZvcm1hdFZhbHVlKHZhbHVlLCBvcHRzKTtcclxuICAgIH1cclxuXHJcbiAgICBmb3JtYXROdW1iZXIodmFsdWUsIG9wdHM6IGFueSA9IHt9KTogc3RyaW5nIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5mb3JtYXRWYWx1ZSh2YWx1ZSwgb3B0cyk7XHJcbiAgICB9XHJcblxyXG4gICAgdW5mb3JtYXQodmFsdWUsIG9wdHM6IGFueSA9IHt9KSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3VuZm9ybWF0KHZhbHVlLCBvcHRzKTtcclxuICAgIH1cclxuXHJcbiAgICAvKiog6I635Y+W5pyA5aSn5YC8ICovXHJcbiAgICBtYXgobjE6IGFueSwgbjIgPSBudWxsKSB7XHJcbiAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkobjEpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBCaWdOdW1iZXIubWF4LmFwcGx5KG51bGwsIG4xKS50b0ZpeGVkKCk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgaWYgKG4xICYmIG4yKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gQmlnTnVtYmVyLm1heGltdW0objEsIG4yKS50b0ZpeGVkKCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGDor7fmj5Dkvpvmr5TovoPnmoTlgLxuMeOAgW4yLmApO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8qKiDmnIDlsI/lgLwgKi9cclxuICAgIG1pbihuMTogYW55LCBuMiA9IG51bGwpIHtcclxuICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShuMSkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIEJpZ051bWJlci5taW4uYXBwbHkobnVsbCwgbjEpLnRvRml4ZWQoKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBpZiAobjEgJiYgbjIpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBCaWdOdW1iZXIubWluaW11bShuMSwgbjIpLnRvRml4ZWQoKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYOivt+aPkOS+m+avlOi+g+eahOWAvG4x44CBbjIuYCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLyoqIOaxguWSjCAqL1xyXG4gICAgc3VtKG4xOiBOdW1iZXJUeXBlW10pIHtcclxuICAgICAgICByZXR1cm4gQmlnTnVtYmVyLnN1bS5hcHBseShudWxsLCBuMSkudG9GaXhlZCgpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKiDlubPlnYfmlbAgKi9cclxuICAgIGF2ZyhuMTogTnVtYmVyVHlwZSwgbGVuOiBudW1iZXIpIHtcclxuICAgICAgICByZXR1cm4gbmV3IEJpZ051bWJlcihuMSkuZGl2KGxlbikudG9GaXhlZCgpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKiAg5Yqg5rOVICovXHJcbiAgICBwbHVzKG4xOiBOdW1iZXJUeXBlLCBuMjogTnVtYmVyVHlwZSkge1xyXG4gICAgICAgIHJldHVybiBuZXcgQmlnTnVtYmVyKG4xKS5wbHVzKG4yKS50b0ZpeGVkKCk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqIOS5mOazlSAqL1xyXG4gICAgbXVsdGlwbGllZChuMTogTnVtYmVyVHlwZSwgbjI6IE51bWJlclR5cGUpIHtcclxuICAgICAgICBuZXcgQmlnTnVtYmVyKG4xKS50aW1lcyhuMikudG9GaXhlZCgpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKiDlh4/ms5UgKi9cclxuICAgIG1pbnVzKG4xOiBOdW1iZXJUeXBlLCBuMjogTnVtYmVyVHlwZSkge1xyXG4gICAgICAgIHJldHVybiBuZXcgQmlnTnVtYmVyKG4xKS5taW51cyhuMikudG9GaXhlZCgpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKiDmmK/lkKbnm7jnrYkgKi9cclxuICAgIGVxKG4xOiBOdW1iZXJUeXBlLCBuMjogTnVtYmVyVHlwZSk6IGJvb2xlYW4ge1xyXG4gICAgICAgIHJldHVybiBuZXcgQmlnTnVtYmVyKG4xKS5lcShuMik7XHJcbiAgICB9XHJcblxyXG4gICAgbHQobjE6IE51bWJlclR5cGUsIG4yOiBOdW1iZXJUeXBlKTogYm9vbGVhbiB7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBCaWdOdW1iZXIobjEpLmx0KG4yKTtcclxuICAgIH1cclxuICAgIGd0KG4xOiBOdW1iZXJUeXBlLCBuMjogTnVtYmVyVHlwZSk6IGJvb2xlYW4ge1xyXG4gICAgICAgIHJldHVybiBuZXcgQmlnTnVtYmVyKG4xKS5ndChuMik7XHJcbiAgICB9XHJcblxyXG4gICAgdG9OdW1iZXIobjE6IHN0cmluZykge1xyXG4gICAgICAgIHJldHVybiBuZXcgQmlnTnVtYmVyKG4xKS50b051bWJlcigpO1xyXG4gICAgfVxyXG5cclxuICAgIHRvRml4ZWQobjE6IHN0cmluZywgcHJlY2lzaW9uOiBudW1iZXIgPSAwKSB7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBCaWdOdW1iZXIobjEpLnRvRml4ZWQocHJlY2lzaW9uKTtcclxuICAgIH1cclxuXHJcbiAgICBjb252ZXJ0Q3VycmVuY3kobW9uZXkpIHtcclxuICAgICAgICAvLyDmsYnlrZfnmoTmlbDlrZdcclxuICAgICAgICBjb25zdCBjbk51bXMgPSBuZXcgQXJyYXkoJ+mbticsICflo7knLCAn6LSwJywgJ+WPgScsICfogoYnLCAn5LyNJywgJ+mZhicsICfmn5InLCAn5o2MJywgJ+eOlicpO1xyXG4gICAgICAgIC8vIOWfuuacrOWNleS9jVxyXG4gICAgICAgIGNvbnN0IGNuSW50UmFkaWNlID0gbmV3IEFycmF5KCcnLCAn5ou+JywgJ+S9sCcsICfku58nKTtcclxuICAgICAgICAvLyDlr7nlupTmlbTmlbDpg6jliIbmianlsZXljZXkvY1cclxuICAgICAgICBjb25zdCBjbkludFVuaXRzID0gbmV3IEFycmF5KCcnLCAn5LiHJywgJ+S6vycsICflhYYnKTtcclxuICAgICAgICAvLyDlr7nlupTlsI/mlbDpg6jliIbljZXkvY1cclxuICAgICAgICBjb25zdCBjbkRlY1VuaXRzID0gbmV3IEFycmF5KCfop5InLCAn5YiGJywgJ+avqycsICfljpgnKTtcclxuICAgICAgICAvLyDmlbTmlbDph5Hpop3ml7blkI7pnaLot5/nmoTlrZfnrKZcclxuICAgICAgICBjb25zdCBjbkludGVnZXIgPSAn5pW0JztcclxuICAgICAgICAvLyDmlbTlnovlrozku6XlkI7nmoTljZXkvY1cclxuICAgICAgICBjb25zdCBjbkludExhc3QgPSAn5YWDJztcclxuICAgICAgICAvLyDmnIDlpKflpITnkIbnmoTmlbDlrZdcclxuICAgICAgICBjb25zdCBtYXhOdW0gPSA5OTk5OTk5OTk5OTk5OTkuOTk5OTtcclxuICAgICAgICAvLyDph5Hpop3mlbTmlbDpg6jliIZcclxuICAgICAgICBsZXQgaW50ZWdlck51bTtcclxuICAgICAgICAvLyDph5Hpop3lsI/mlbDpg6jliIZcclxuICAgICAgICBsZXQgZGVjaW1hbE51bTtcclxuICAgICAgICAvLyDovpPlh7rnmoTkuK3mlofph5Hpop3lrZfnrKbkuLJcclxuICAgICAgICBsZXQgY2hpbmVzZVN0ciA9ICcnO1xyXG4gICAgICAgIC8vIOWIhuemu+mHkemineWQjueUqOeahOaVsOe7hO+8jOmihOWumuS5iVxyXG4gICAgICAgIGxldCBwYXJ0cztcclxuICAgICAgICBpZiAobW9uZXkgPT0gJycpIHsgcmV0dXJuICcnOyB9XHJcbiAgICAgICAgbW9uZXkgPSBwYXJzZUZsb2F0KG1vbmV5KTtcclxuICAgICAgICBpZiAobW9uZXkgPj0gbWF4TnVtKSB7XHJcbiAgICAgICAgICAgIC8vIOi2heWHuuacgOWkp+WkhOeQhuaVsOWtl1xyXG4gICAgICAgICAgICByZXR1cm4gJyc7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChtb25leSA9PT0gMCkge1xyXG4gICAgICAgICAgICBjaGluZXNlU3RyID0gY25OdW1zWzBdICsgY25JbnRMYXN0ICsgY25JbnRlZ2VyO1xyXG4gICAgICAgICAgICByZXR1cm4gY2hpbmVzZVN0cjtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8g6L2s5o2i5Li65a2X56ym5LiyXHJcbiAgICAgICAgbW9uZXkgPSBtb25leS50b1N0cmluZygpO1xyXG4gICAgICAgIGlmIChtb25leS5pbmRleE9mKCcuJykgPT09IC0xKSB7XHJcbiAgICAgICAgICAgIGludGVnZXJOdW0gPSBtb25leTtcclxuICAgICAgICAgICAgZGVjaW1hbE51bSA9ICcnO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHBhcnRzID0gbW9uZXkuc3BsaXQoJy4nKTtcclxuICAgICAgICAgICAgaW50ZWdlck51bSA9IHBhcnRzWzBdO1xyXG4gICAgICAgICAgICBkZWNpbWFsTnVtID0gcGFydHNbMV0uc3Vic3RyKDAsIDQpO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyDojrflj5bmlbTlnovpg6jliIbovazmjaJcclxuICAgICAgICBpZiAocGFyc2VJbnQoaW50ZWdlck51bSwgMTApID4gMCkge1xyXG4gICAgICAgICAgICBsZXQgemVyb0NvdW50ID0gMDtcclxuICAgICAgICAgICAgY29uc3QgSW50TGVuID0gaW50ZWdlck51bS5sZW5ndGg7XHJcbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgSW50TGVuOyBpKyspIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IG4gPSBpbnRlZ2VyTnVtLnN1YnN0cihpLCAxKTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHAgPSBJbnRMZW4gLSBpIC0gMTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHEgPSBwIC8gNDtcclxuICAgICAgICAgICAgICAgIGNvbnN0IG0gPSBwICUgNDtcclxuICAgICAgICAgICAgICAgIGlmIChuID09ICcwJykge1xyXG4gICAgICAgICAgICAgICAgICAgIHplcm9Db3VudCsrO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoemVyb0NvdW50ID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjaGluZXNlU3RyICs9IGNuTnVtc1swXTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgLy8g5b2S6Zu2XHJcbiAgICAgICAgICAgICAgICAgICAgemVyb0NvdW50ID0gMDtcclxuICAgICAgICAgICAgICAgICAgICBjaGluZXNlU3RyICs9IGNuTnVtc1twYXJzZUludChuLCAxMCldICsgY25JbnRSYWRpY2VbbV07XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAobSA9PSAwICYmIHplcm9Db3VudCA8IDQpIHtcclxuICAgICAgICAgICAgICAgICAgICBjaGluZXNlU3RyICs9IGNuSW50VW5pdHNbcV07XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY2hpbmVzZVN0ciArPSBjbkludExhc3Q7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIOWwj+aVsOmDqOWIhlxyXG4gICAgICAgIGlmIChkZWNpbWFsTnVtICE9PSAnJykge1xyXG4gICAgICAgICAgICBjb25zdCBkZWNMZW4gPSBkZWNpbWFsTnVtLmxlbmd0aDtcclxuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBkZWNMZW47IGkrKykge1xyXG4gICAgICAgICAgICAgICAgbGV0IG4gPSBkZWNpbWFsTnVtLnN1YnN0cihpLCAxKTtcclxuICAgICAgICAgICAgICAgIGlmIChuICE9PSAnMCcpIHtcclxuICAgICAgICAgICAgICAgICAgICBjaGluZXNlU3RyICs9IGNuTnVtc1tOdW1iZXIobildICsgY25EZWNVbml0c1tpXTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoY2hpbmVzZVN0ciA9PT0gJycpIHtcclxuICAgICAgICAgICAgY2hpbmVzZVN0ciArPSBjbk51bXNbMF0gKyBjbkludExhc3QgKyBjbkludGVnZXI7XHJcbiAgICAgICAgfSBlbHNlIGlmIChkZWNpbWFsTnVtID09PSAnJykge1xyXG4gICAgICAgICAgICBjaGluZXNlU3RyICs9IGNuSW50ZWdlcjtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGNoaW5lc2VTdHI7XHJcblxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgX3VuZm9ybWF0KHZhbCwgb3B0cykge1xyXG4gICAgICAgIHZhbCA9ICh2YWwgPT09IG51bGwgfHwgdmFsID09PSB1bmRlZmluZWQgfHwgaXNOYU4odmFsKSkgPyAnJyA6IFN0cmluZyh2YWwpO1xyXG4gICAgICAgIGlmIChvcHRzKSB7XHJcbiAgICAgICAgICAgIC8vIOWOu+WJjee8gFxyXG4gICAgICAgICAgICBpZiAob3B0cy5wcmVmaXgpIHtcclxuICAgICAgICAgICAgICAgIHZhbCA9IHZhbC5yZXBsYWNlKG5ldyBSZWdFeHAob3B0cy5wcmVmaXgsICdnJyksICcnKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8g5Y675ZCO57yAXHJcbiAgICAgICAgICAgIGlmIChvcHRzLnN1ZmZpeCkge1xyXG4gICAgICAgICAgICAgICAgdmFsID0gdmFsLnJlcGxhY2UobmV3IFJlZ0V4cChvcHRzLnN1ZmZpeCwgJ2cnKSwgJycpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyDljrvmjonljYPliIbkvY3liIbpmpTnrKZcclxuICAgICAgICAgICAgdmFsID0gdmFsLnJlcGxhY2UoL1xcLC9nLCAnJyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB2YWw7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBmb3JtYXRWYWx1ZSh2YWx1ZSwgb3B0czogYW55KSB7XHJcbiAgICAgICAgY29uc3QgYmlnbnVtID0gbmV3IEJpZ051bWJlcih2YWx1ZSk7XHJcbiAgICAgICAgY29uc3QgZm10ID0ge1xyXG4gICAgICAgICAgICBwcmVmaXg6IG9wdHMucHJlZml4IHx8ICcnLFxyXG4gICAgICAgICAgICBzdWZmaXg6IG9wdHMuc3VmZml4IHx8ICcnLFxyXG4gICAgICAgICAgICBkZWNpbWFsU2VwYXJhdG9yOiBvcHRzLmRlY2ltYWwgfHwgJy4nLFxyXG4gICAgICAgICAgICBncm91cFNlcGFyYXRvcjogb3B0cy50aG91c2FuZCB8fCAnJyxcclxuICAgICAgICAgICAgZ3JvdXBTaXplOiAzXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgaWYgKGJpZ251bS5pc05hTigpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAnJztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGxldCBwcmVjaXNpb24gPSBvcHRzLnByZWNpc2lvbiB8fCAwO1xyXG4gICAgICAgIHByZWNpc2lvbiA9IE51bWJlcihwcmVjaXNpb24pO1xyXG5cclxuICAgICAgICByZXR1cm4gYmlnbnVtLnRvRm9ybWF0KHByZWNpc2lvbiwgZm10KTtcclxuICAgIH1cclxufVxyXG4iXX0=
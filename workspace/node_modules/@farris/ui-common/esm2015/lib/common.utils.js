/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Injectable } from '@angular/core';
import { ColumnFormatService } from '@farris/ui-common/column';
import * as i0 from "@angular/core";
export class CommonUtils {
    constructor() {
        this.cfs = null;
        if (!this.cfs) {
            this.cfs = new ColumnFormatService(null, null);
        }
    }
    /**
     * @param {?} field
     * @param {?} data
     * @return {?}
     */
    keyIsInData(field, data) {
        /** @type {?} */
        const noProperty = 'no property';
        /** @type {?} */
        const val = field.split('.').reduce((/**
         * @param {?} obj
         * @param {?} key
         * @return {?}
         */
        (obj, key) => {
            if (obj && obj.hasOwnProperty(key)) {
                return obj[key];
            }
            else {
                return noProperty;
            }
        }), data);
        return val != noProperty;
    }
    /**
     * 获取对象中指定字段的值。 field: 可以为带有层级结构的路径，如： user.firstName | name 等
     * data: 获取字段的数据源，一般为JSON对象
     * safe: 为true, 将html字符进行转码输出，默认为 false
     * @param {?} field
     * @param {?} data
     * @param {?=} safe
     * @return {?}
     */
    getValue(field, data, safe = false) {
        if (!data) {
            return '';
        }
        /** @type {?} */
        let resultVal = '';
        if (field.indexOf('.') === -1 && data.hasOwnProperty(field)) {
            resultVal = data[field];
        }
        else {
            resultVal = field.split('.').reduce((/**
             * @param {?} obj
             * @param {?} key
             * @return {?}
             */
            (obj, key) => {
                if (obj) {
                    return obj[key];
                }
                else {
                    return null;
                }
            }), data);
        }
        if (safe) {
            return this.formatterValue(resultVal);
        }
        else {
            return resultVal;
        }
    }
    /**
     * 更新指定对象中某个字段的值
     * @param {?} obj 被更新对象
     * @param {?} field 被更新字段
     * @param {?} val 新值
     * @param {?=} nest 是否为嵌套，默认为 true
     * @return {?}
     */
    setValue(obj, field, val, nest = true) {
        if (field) {
            if (field.indexOf('.') > -1 && nest) {
                /** @type {?} */
                let lastObj = null;
                /** @type {?} */
                const _fields = field.split('.');
                _fields.reduce((/**
                 * @param {?} c
                 * @param {?} p
                 * @return {?}
                 */
                (c, p) => {
                    lastObj = c;
                    return c[p];
                }), obj);
                if (lastObj) {
                    lastObj[_fields.pop()] = val;
                }
            }
            else {
                obj[field] = val;
            }
        }
    }
    /**
     * @param {?} value
     * @param {?} enumData
     * @param {?} valueField
     * @return {?}
     */
    getEnumItem(value, enumData, valueField) {
        /** @type {?} */
        const item = enumData.find((/**
         * @param {?} n
         * @return {?}
         */
        n => n[valueField] == value));
        return item;
    }
    /**
     * @private
     * @param {?} value
     * @param {?} col
     * @return {?}
     */
    _getEnumTitleFromColumn(value, col) {
        /** @type {?} */
        const _col = (/** @type {?} */ (col));
        /** @type {?} */
        const formatter = (/** @type {?} */ (_col.formatter));
        if (formatter && typeof formatter === 'object') {
            if (formatter.type === 'enum' && formatter.options) {
                return this.getEnumTitleFromColumnOptions(value, formatter.options);
            }
        }
        return value;
    }
    /**
     * @param {?} col
     * @param {?} data
     * @return {?}
     */
    getEnumTitle(col, data) {
        /** @type {?} */
        const val = this.getValue(col.field, data);
        return this._getEnumTitleFromColumn(val, col);
    }
    /**
     * @param {?} value
     * @param {?} opts
     * @return {?}
     */
    getEnumTitleFromColumnOptions(value, opts) {
        const { data, valueField, textField } = opts;
        /** @type {?} */
        const item = this.getEnumItem(value, data, valueField);
        if (item) {
            return item[textField];
        }
        else {
            return value;
        }
    }
    /**
     * @param {?} str
     * @return {?}
     */
    escapeHtml(str) {
        if (str === null || str === undefined) {
            return '';
        }
        return str
            .replace(/&/g, '&amp;')
            .replace(/</g, '&lt;')
            .replace(/>/g, '&gt;')
            .replace(/\"/g, '&quot;')
            .replace(/\'/g, '&#39;')
            .replace(/\//g, '&#x2F;');
    }
    /**
     * @param {?} str
     * @return {?}
     */
    unescapeHtml(str) {
        if (str === null || str === undefined) {
            return '';
        }
        return str
            .replace(/&amp;/g, '&')
            .replace(/&lt;/g, '<')
            .replace(/&gt;/g, '>')
            .replace(/&quot;/g, '"')
            .replace(/&#39;/g, '\'')
            .replace(/&#x2F;/g, '/');
    }
    /**
     * @private
     * @param {?} val
     * @return {?}
     */
    formatterValue(val) {
        if (val === null || val === undefined || val === '') {
            return '';
        }
        if (typeof val === 'string') {
            return this.escapeHtml(val);
        }
        return val;
    }
    /**
     * 获取字符串在页面中的真实宽度
     * @param {?} txt
     * @param {?} font
     * @return {?}
     */
    getTextWidth(txt, font) {
        // const frag = document.createDocumentFragment();
        /** @type {?} */
        const canvas = document.createElement('canvas');
        /** @type {?} */
        const context = canvas.getContext('2d');
        context.font = font;
        /** @type {?} */
        const metrics = context.measureText(txt);
        return Math.round(metrics.width);
    }
    /**
     * @param {?} id
     * @return {?}
     */
    removeStyleSheet(id) {
        /** @type {?} */
        const styleElement = document.querySelector('#' + id);
        if (styleElement) {
            styleElement.remove();
        }
    }
    /**
     * @param {?} styleSheetId
     * @return {?}
     */
    createStyleSheet(styleSheetId) {
        /** @type {?} */
        const htmlHead = document.querySelector('head');
        /** @type {?} */
        const styleEleId = styleSheetId;
        /** @type {?} */
        let styleElement = null;
        if (document.querySelector('#' + styleEleId)) {
            styleElement = document.querySelector('#' + styleEleId);
            styleElement.innerText = '';
        }
        else {
            styleElement = document.createElement('style');
            styleElement.id = styleEleId;
            htmlHead.appendChild(styleElement);
        }
        return styleElement;
    }
    /**
     * @param {?} styleSheetId
     * @return {?}
     */
    getStyleSheet(styleSheetId) {
        /** @type {?} */
        const styleSheets = (/** @type {?} */ (document.styleSheets));
        /** @type {?} */
        let styleSheet = null;
        for (const stylesheet of styleSheets) {
            if ((stylesheet.ownerNode || stylesheet['owningElement']).id === styleSheetId) {
                styleSheet = stylesheet;
                break;
            }
        }
        return styleSheet;
    }
    /**
     * 与现有样式合并
     * @param {?} rules
     * @param {?} styleSheet
     * @return {?}
     */
    appendCssRules(rules, styleSheet) {
        for (const rule of rules) {
            /** @type {?} */
            const ruleName = rule.slice(0, rule.indexOf('{'));
            /** @type {?} */
            const removedCssRule = this.removeCssRule(ruleName, styleSheet);
            /** @type {?} */
            let cssText = '';
            if (removedCssRule) {
                cssText += removedCssRule.cssText.slice(removedCssRule.cssText.indexOf('{') + 1, removedCssRule.cssText.indexOf('}'));
            }
            cssText += rule.slice(rule.indexOf('{') + 1, rule.indexOf('}')).replace(/"/g, '').replace(/,/g, ';') + ';';
            if (styleSheet.addRule) {
                styleSheet.addRule(ruleName, cssText, 0);
            }
            else {
                /** @type {?} */
                const _newRule = `${ruleName}{ ${cssText} }`;
                styleSheet.insertRule(_newRule, 0);
            }
        }
    }
    /**
     * 覆盖现有的样式
     * @param {?} rules
     * @param {?} styleSheet
     * @return {?}
     */
    appendCssRules2(rules, styleSheet) {
        for (const rule of rules) {
            /** @type {?} */
            const ruleName = rule.slice(0, rule.indexOf('{'));
            /** @type {?} */
            const removedCssRule = this.removeCssRule(ruleName, styleSheet);
            /** @type {?} */
            const cssText = rule.slice(rule.indexOf('{') + 1, rule.indexOf('}')).replace(/"/g, '').replace(/,/g, ';') + ';';
            if (styleSheet.addRule) {
                styleSheet.addRule(ruleName, cssText, 0);
            }
            else {
                /** @type {?} */
                const _newRule = `${ruleName}{ ${cssText} }`;
                styleSheet.insertRule(_newRule, 0);
            }
        }
    }
    /**
     * @param {?} ruleName
     * @param {?} styleSheet
     * @return {?}
     */
    getCssRule(ruleName, styleSheet) {
        /** @type {?} */
        const cssRules = (/** @type {?} */ ((styleSheet.cssRules || styleSheet.rules)));
        /** @type {?} */
        let r = null;
        for (const rule of cssRules) {
            if (rule.selectorText == ruleName) {
                r = rule;
            }
        }
        return r;
    }
    /**
     * @param {?} ruleName
     * @param {?} styleSheet
     * @return {?}
     */
    removeCssRule(ruleName, styleSheet) {
        /** @type {?} */
        const cssRules = (/** @type {?} */ ((styleSheet.cssRules || styleSheet.rules)));
        /** @type {?} */
        let ii = 0;
        /** @type {?} */
        let cssRule = false;
        do {
            cssRule = cssRules[ii];
            if (cssRule) {
                if (cssRule.selectorText.toLowerCase() == ruleName.toLowerCase()) {
                    if (styleSheet.cssRules) {
                        styleSheet.deleteRule(ii);
                    }
                    else {
                        styleSheet.removeRule(ii);
                    }
                    return cssRule;
                }
            }
            ii++;
        } while (cssRule);
    }
    /**
     * @param {?} val
     * @return {?}
     */
    isNullOrUndefined(val) {
        return val === null || val === undefined;
    }
    /**
     * @return {?}
     */
    isIE() {
        /** @type {?} */
        const uA = window.navigator.userAgent;
        return /msie\s|trident\/|edge\//i.test(uA) && !!('uniqueID' in document || 'documentMode' in document || ('ActiveXObject' in window) || 'MSInputMethodContext' in window);
    }
    /**
     * @param {?} sorts
     * @return {?}
     */
    buildSortString(sorts) {
        return this.cfs.buildSortString(sorts);
    }
    /**
     * @param {?} conditions
     * @return {?}
     */
    buildSqlWhere(conditions) {
        return this.cfs.buildSqlWhere(conditions);
    }
    /**
     * @return {?}
     */
    getBrowserType() {
        /** @type {?} */
        const ua = navigator.userAgent.toLowerCase();
        // 获取用户端信息
        /** @type {?} */
        const info = {
            ie: /msie/.test(ua) && !/opera/.test(ua),
            //  匹配IE浏览器
            op: /opera/.test(ua),
            //  匹配Opera浏览器
            sa: /version.*safari/.test(ua),
            // 匹配Safari浏览器
            ch: /chrome/.test(ua),
            //  匹配Chrome浏览器
            ff: /gecko/.test(ua) && !/webkit/.test(ua) // 匹配Firefox浏览器
        };
        return info;
    }
    /**
     * @return {?}
     */
    getFFVer() {
        /** @type {?} */
        const ua = navigator.userAgent;
        /** @type {?} */
        const b = ua.indexOf('Firefox/');
        if (b < 0) {
            return 0;
        }
        return parseFloat(ua.substring(b + 8, ua.lastIndexOf('\.')));
    }
    /**
     * @param {?} name
     * @param {?=} locationSearch
     * @return {?}
     */
    getQueryString(name, locationSearch = '') {
        /** @type {?} */
        var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i");
        /** @type {?} */
        let _search = window.location.search;
        if (locationSearch) {
            _search = locationSearch;
        }
        /** @type {?} */
        var r = _search.substring(1).match(reg);
        if (r != null)
            return (r[2]);
        return null;
    }
    /**
     * 获取页面中body下所有元素的zIndex, 并返回下个浮层的新zindex
     * @param {?=} upperLayers
     * @return {?}
     */
    getFloatingLayerIndex(upperLayers = 1) {
        /** @type {?} */
        const selectors = [
            'body>.f-datagrid-settings-simple-host',
            'body>div',
            'body>farris-dialog>.farris-modal.show',
            'body>.farris-modal.show',
            'body>farris-filter-panel>.f-filter-panel-wrapper',
            'body .f-sidebar-show>.f-sidebar-main',
            'body>.popover.show',
            'body>filter-row-panel>.f-datagrid-filter-panel',
            'body>.f-section-maximize'
        ];
        /** @type {?} */
        const overlays = Array.from(document.body.querySelectorAll(selectors.join(','))).filter((/**
         * @param {?} n
         * @return {?}
         */
        n => n)).map((/**
         * @param {?} n
         * @return {?}
         */
        n => {
            const { display, zIndex } = window.getComputedStyle(n);
            if (display === 'none') {
                return 0;
            }
            return parseInt(zIndex, 10);
        })).filter((/**
         * @param {?} n
         * @return {?}
         */
        n => n));
        /** @type {?} */
        let maxZindex = Math.max(...overlays);
        if (maxZindex < 1040) {
            maxZindex = 1040;
        }
        return maxZindex + upperLayers;
    }
    /**
     * 点击N次后，执行callback; 默认点击10次后执行
     * @param {?} callback
     * @param {?=} clickTatgatNum
     * @return {?}
     */
    clickContinuity(callback, clickTatgatNum = 10) {
        if (this['clickCountNow'] === undefined) {
            this['clickCountNow'] = 0;
        }
        // 连续点击次数小于指定次数时
        if (this['clickCountNow'] < clickTatgatNum - 1) {
            // 清除定时器
            if (this['clickTimer']) {
                clearTimeout(this['clickTimer']);
                this['clickTimer'] = null;
            }
            // 点击次数+1
            this['clickCountNow']++;
            // 打印次数日志
            // console.log(`clickCountNow`, this['clickCountNow'])
            // 设置定时器，大于300毫秒点击不算连续点击
            this['clickTimer'] = setTimeout((/**
             * @return {?}
             */
            () => {
                this['clickCountNow'] = 0;
            }), 300);
        }
        else {
            // 点击次数+1（此时已大于等于指定点击次数）
            this['clickCountNow']++;
            // 打印日志
            // console.log(`连续点击了${this['clickCountNow']}次`, `做点什么`)
            if (callback) {
                callback();
            }
            // 清除定时器
            if (this['clickTimer']) {
                clearTimeout(this['clickTimer']);
                this['clickTimer'] = null;
            }
            // 点击次数归零，重新计数
            this['clickCountNow'] = 0;
        }
    }
    /**
     * @param {?=} enterFn
     * @param {?=} escFn
     * @return {?}
     */
    regBodyKeydownEvent(enterFn, escFn) {
        /** @type {?} */
        const keydownHandle = (/**
         * @param {?} $event
         * @return {?}
         */
        ($event) => {
            if ($event.key !== 'Escape' && $event.key !== 'Enter') {
                return;
            }
            $event.preventDefault();
            $event.stopPropagation();
            if ($event.key == 'Enter' && enterFn) {
                // 执行查询
                enterFn();
            }
            else {
                escFn && escFn();
            }
        });
        document.body.addEventListener('keydown', keydownHandle, true);
        return (/**
         * @return {?}
         */
        () => {
            document.body.removeEventListener('keydown', keydownHandle, true);
        });
    }
}
CommonUtils.decorators = [
    { type: Injectable, args: [{
                providedIn: 'root'
            },] }
];
/** @nocollapse */
CommonUtils.ctorParameters = () => [];
/** @nocollapse */ CommonUtils.ngInjectableDef = i0.defineInjectable({ factory: function CommonUtils_Factory() { return new CommonUtils(); }, token: CommonUtils, providedIn: "root" });
if (false) {
    /**
     * @type {?}
     * @private
     */
    CommonUtils.prototype.cfs;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29tbW9uLnV0aWxzLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy91aS1jb21tb24vIiwic291cmNlcyI6WyJsaWIvY29tbW9uLnV0aWxzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFZLE1BQU0sZUFBZSxDQUFDO0FBQ3JELE9BQU8sRUFBa0QsbUJBQW1CLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQzs7QUFLL0csTUFBTSxPQUFPLFdBQVc7SUFFcEI7UUFEUSxRQUFHLEdBQXdCLElBQUksQ0FBQztRQUVwQyxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsRUFBRTtZQUNYLElBQUksQ0FBQyxHQUFHLEdBQUcsSUFBSSxtQkFBbUIsQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUM7U0FDbEQ7SUFDTCxDQUFDOzs7Ozs7SUFFRCxXQUFXLENBQUMsS0FBSyxFQUFFLElBQUk7O2NBQ2IsVUFBVSxHQUFHLGFBQWE7O2NBQzFCLEdBQUcsR0FBRyxLQUFLLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDLE1BQU07Ozs7O1FBQUMsQ0FBQyxHQUFHLEVBQUUsR0FBRyxFQUFFLEVBQUU7WUFDN0MsSUFBSSxHQUFHLElBQUksR0FBRyxDQUFDLGNBQWMsQ0FBQyxHQUFHLENBQUMsRUFBRTtnQkFDaEMsT0FBTyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUM7YUFDbkI7aUJBQU07Z0JBQ0gsT0FBTyxVQUFVLENBQUM7YUFDckI7UUFDTCxDQUFDLEdBQUUsSUFBSSxDQUFDO1FBRVIsT0FBTyxHQUFHLElBQUksVUFBVSxDQUFDO0lBQzdCLENBQUM7Ozs7Ozs7Ozs7SUFPRCxRQUFRLENBQUMsS0FBYSxFQUFFLElBQVMsRUFBRSxJQUFJLEdBQUcsS0FBSztRQUMzQyxJQUFJLENBQUMsSUFBSSxFQUFFO1lBQ1AsT0FBUSxFQUFFLENBQUM7U0FDZDs7WUFDRyxTQUFTLEdBQUcsRUFBRTtRQUNsQixJQUFJLEtBQUssQ0FBQyxP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Q0QsUUFBUSxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxTQUFTLEVBQUUsYUFBYSxFQUFHLElBQUksQ0FBQyxDQUFDO1FBQ2hFOzs7UUFBTyxHQUFHLEVBQUU7WUFDUixRQUFRLENBQUMsSUFBSSxDQUFDLG1CQUFtQixDQUFDLFNBQVMsRUFBRSxhQUFhLEVBQUUsSUFBSSxDQUFDLENBQUM7UUFDdEUsQ0FBQyxFQUFBO0lBQ0wsQ0FBQzs7O1lBdFpKLFVBQVUsU0FBQztnQkFDUixVQUFVLEVBQUUsTUFBTTthQUNyQjs7Ozs7Ozs7OztJQUVHLDBCQUF3QyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUsIE9wdGlvbmFsIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IERhdGFDb2x1bW4sIENvbHVtbkZvcm1hdHRlciwgRW51bUZvcm1hdE9wdGlvbnMsIENvbHVtbkZvcm1hdFNlcnZpY2UgfSBmcm9tICdAZmFycmlzL3VpLWNvbW1vbi9jb2x1bW4nO1xyXG5cclxuQEluamVjdGFibGUoe1xyXG4gICAgcHJvdmlkZWRJbjogJ3Jvb3QnXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBDb21tb25VdGlscyB7XHJcbiAgICBwcml2YXRlIGNmczogQ29sdW1uRm9ybWF0U2VydmljZSA9IG51bGw7XHJcbiAgICBjb25zdHJ1Y3RvcigpIHtcclxuICAgICAgICBpZiAoIXRoaXMuY2ZzKSB7XHJcbiAgICAgICAgICAgIHRoaXMuY2ZzID0gbmV3IENvbHVtbkZvcm1hdFNlcnZpY2UobnVsbCwgbnVsbCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGtleUlzSW5EYXRhKGZpZWxkLCBkYXRhKSB7XHJcbiAgICAgICAgY29uc3Qgbm9Qcm9wZXJ0eSA9ICdubyBwcm9wZXJ0eSc7XHJcbiAgICAgICAgY29uc3QgdmFsID0gZmllbGQuc3BsaXQoJy4nKS5yZWR1Y2UoKG9iaiwga2V5KSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChvYmogJiYgb2JqLmhhc093blByb3BlcnR5KGtleSkpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBvYmpba2V5XTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBub1Byb3BlcnR5O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSwgZGF0YSk7XHJcblxyXG4gICAgICAgIHJldHVybiB2YWwgIT0gbm9Qcm9wZXJ0eTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOiOt+WPluWvueixoeS4reaMh+WumuWtl+auteeahOWAvOOAgiBmaWVsZDog5Y+v5Lul5Li65bim5pyJ5bGC57qn57uT5p6E55qE6Lev5b6E77yM5aaC77yaIHVzZXIuZmlyc3ROYW1lIHwgbmFtZSDnrYlcclxuICAgICAqIGRhdGE6IOiOt+WPluWtl+auteeahOaVsOaNrua6kO+8jOS4gOiIrOS4ukpTT07lr7nosaFcclxuICAgICAqIHNhZmU6IOS4unRydWUsIOWwhmh0bWzlrZfnrKbov5vooYzovaznoIHovpPlh7rvvIzpu5jorqTkuLogZmFsc2VcclxuICAgICAqL1xyXG4gICAgZ2V0VmFsdWUoZmllbGQ6IHN0cmluZywgZGF0YTogYW55LCBzYWZlID0gZmFsc2UpIHtcclxuICAgICAgICBpZiAoIWRhdGEpIHtcclxuICAgICAgICAgICAgcmV0dXJuICAnJztcclxuICAgICAgICB9XHJcbiAgICAgICAgbGV0IHJlc3VsdFZhbCA9ICcnO1xyXG4gICAgICAgIGlmIChmaWVsZC5pbmRleE9mKCcuJykgPT09IC0xICYmIGRhdGEuaGFzT3duUHJvcGVydHkoZmllbGQpKSB7XHJcbiAgICAgICAgICAgIHJlc3VsdFZhbCA9IGRhdGFbZmllbGRdO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJlc3VsdFZhbCA9IGZpZWxkLnNwbGl0KCcuJykucmVkdWNlKChvYmosIGtleSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKG9iaikge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBvYmpba2V5XTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sIGRhdGEpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHNhZmUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZm9ybWF0dGVyVmFsdWUocmVzdWx0VmFsKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0VmFsO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOabtOaWsOaMh+WumuWvueixoeS4reafkOS4quWtl+auteeahOWAvFxyXG4gICAgICogQHBhcmFtIG9iaiDooqvmm7TmlrDlr7nosaFcclxuICAgICAqIEBwYXJhbSBmaWVsZCDooqvmm7TmlrDlrZfmrrVcclxuICAgICAqIEBwYXJhbSB2YWwg5paw5YC8XHJcbiAgICAgKiBAcGFyYW0gbmVzdCDmmK/lkKbkuLrltYzlpZfvvIzpu5jorqTkuLogdHJ1ZVxyXG4gICAgICovXHJcbiAgICBzZXRWYWx1ZShvYmo6IHsgW2tleTogc3RyaW5nXTogYW55IH0sIGZpZWxkOiBzdHJpbmcsIHZhbDogYW55LCBuZXN0ID0gdHJ1ZSkge1xyXG4gICAgICAgIGlmIChmaWVsZCkge1xyXG4gICAgICAgICAgICBpZiAoZmllbGQuaW5kZXhPZignLicpID4gLTEgJiYgbmVzdCkge1xyXG4gICAgICAgICAgICAgICAgbGV0IGxhc3RPYmogPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgX2ZpZWxkcyA9IGZpZWxkLnNwbGl0KCcuJyk7XHJcbiAgICAgICAgICAgICAgICBfZmllbGRzLnJlZHVjZSggKGMsIHApID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBsYXN0T2JqID0gYztcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gY1twXTtcclxuICAgICAgICAgICAgICAgIH0sIG9iaik7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKGxhc3RPYmopIHtcclxuICAgICAgICAgICAgICAgICAgICBsYXN0T2JqW19maWVsZHMucG9wKCldID0gdmFsO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgb2JqW2ZpZWxkXSA9IHZhbDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBnZXRFbnVtSXRlbSh2YWx1ZTogYW55LCBlbnVtRGF0YTogYW55W10sIHZhbHVlRmllbGQpIHtcclxuICAgICAgICBjb25zdCBpdGVtID0gZW51bURhdGEuZmluZChuID0+IG5bdmFsdWVGaWVsZF0gPT0gdmFsdWUpO1xyXG4gICAgICAgIHJldHVybiBpdGVtO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgX2dldEVudW1UaXRsZUZyb21Db2x1bW4odmFsdWU6IGFueSwgY29sOiBhbnkpIHtcclxuICAgICAgICBjb25zdCBfY29sID0gY29sIGFzIERhdGFDb2x1bW47XHJcbiAgICAgICAgY29uc3QgZm9ybWF0dGVyID0gX2NvbC5mb3JtYXR0ZXIgYXMgQ29sdW1uRm9ybWF0dGVyO1xyXG4gICAgICAgIGlmIChmb3JtYXR0ZXIgJiYgdHlwZW9mIGZvcm1hdHRlciA9PT0gJ29iamVjdCcpIHtcclxuICAgICAgICAgICAgaWYgKGZvcm1hdHRlci50eXBlID09PSAnZW51bScgJiYgZm9ybWF0dGVyLm9wdGlvbnMpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmdldEVudW1UaXRsZUZyb21Db2x1bW5PcHRpb25zKHZhbHVlLCBmb3JtYXR0ZXIub3B0aW9ucyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHZhbHVlO1xyXG4gICAgfVxyXG5cclxuICAgIGdldEVudW1UaXRsZShjb2w6IERhdGFDb2x1bW4sIGRhdGE6IGFueSApIHtcclxuICAgICAgICBjb25zdCB2YWwgPSB0aGlzLmdldFZhbHVlKGNvbC5maWVsZCwgZGF0YSk7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2dldEVudW1UaXRsZUZyb21Db2x1bW4odmFsLCBjb2wpO1xyXG4gICAgfVxyXG5cclxuICAgIGdldEVudW1UaXRsZUZyb21Db2x1bW5PcHRpb25zKHZhbHVlOiBhbnksIG9wdHM6IGFueSkge1xyXG4gICAgICAgIGNvbnN0IHsgZGF0YSwgdmFsdWVGaWVsZCwgdGV4dEZpZWxkIH0gPSBvcHRzO1xyXG4gICAgICAgIGNvbnN0IGl0ZW0gPSB0aGlzLmdldEVudW1JdGVtKHZhbHVlLCBkYXRhLCB2YWx1ZUZpZWxkKTtcclxuICAgICAgICBpZiAoaXRlbSkge1xyXG4gICAgICAgICAgICByZXR1cm4gaXRlbVt0ZXh0RmllbGRdO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiB2YWx1ZTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgZXNjYXBlSHRtbChzdHIpIHtcclxuICAgICAgICBpZiAoc3RyID09PSBudWxsIHx8IHN0ciA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAgJyc7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBzdHJcclxuICAgICAgICAucmVwbGFjZSgvJi9nLCAnJmFtcDsnKVxyXG4gICAgICAgIC5yZXBsYWNlKC88L2csICcmbHQ7JylcclxuICAgICAgICAucmVwbGFjZSgvPi9nLCAnJmd0OycpXHJcbiAgICAgICAgLnJlcGxhY2UoL1xcXCIvZywgJyZxdW90OycpXHJcbiAgICAgICAgLnJlcGxhY2UoL1xcJy9nLCAnJiMzOTsnKVxyXG4gICAgICAgIC5yZXBsYWNlKC9cXC8vZywgJyYjeDJGOycpO1xyXG4gICAgfVxyXG5cclxuICAgIHVuZXNjYXBlSHRtbChzdHIpIHtcclxuICAgICAgICBpZiAoc3RyID09PSBudWxsIHx8IHN0ciA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAgJyc7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBzdHJcclxuICAgICAgICAucmVwbGFjZSgvJmFtcDsvZywgJyYnKVxyXG4gICAgICAgIC5yZXBsYWNlKC8mbHQ7L2csICc8JylcclxuICAgICAgICAucmVwbGFjZSgvJmd0Oy9nLCAnPicpXHJcbiAgICAgICAgLnJlcGxhY2UoLyZxdW90Oy9nLCAnXCInKVxyXG4gICAgICAgIC5yZXBsYWNlKC8mIzM5Oy9nLCAnXFwnJylcclxuICAgICAgICAucmVwbGFjZSgvJiN4MkY7L2csICcvJyk7XHJcbiAgICB9XHJcblxyXG5cclxuICAgIHByaXZhdGUgZm9ybWF0dGVyVmFsdWUodmFsOiBhbnkpIHtcclxuICAgICAgICBpZiAodmFsID09PSBudWxsIHx8IHZhbCA9PT0gdW5kZWZpbmVkIHx8IHZhbCA9PT0gJycpIHtcclxuICAgICAgICAgICAgcmV0dXJuICcnO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHR5cGVvZiB2YWwgPT09ICdzdHJpbmcnKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmVzY2FwZUh0bWwodmFsKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiB2YWw7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqIOiOt+WPluWtl+espuS4suWcqOmhtemdouS4reeahOecn+WunuWuveW6piAqL1xyXG4gICAgZ2V0VGV4dFdpZHRoKHR4dDogc3RyaW5nLCBmb250KSB7XHJcbiAgICAgICAgLy8gY29uc3QgZnJhZyA9IGRvY3VtZW50LmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKTtcclxuICAgICAgICBjb25zdCBjYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKTtcclxuICAgICAgICBjb25zdCBjb250ZXh0ID0gY2FudmFzLmdldENvbnRleHQoJzJkJyk7XHJcbiAgICAgICAgY29udGV4dC5mb250ID0gZm9udDtcclxuICAgICAgICBjb25zdCBtZXRyaWNzID0gY29udGV4dC5tZWFzdXJlVGV4dCh0eHQpO1xyXG4gICAgICAgIHJldHVybiBNYXRoLnJvdW5kKG1ldHJpY3Mud2lkdGgpO1xyXG4gICAgfVxyXG5cclxuICAgIHJlbW92ZVN0eWxlU2hlZXQoaWQ6IHN0cmluZykge1xyXG4gICAgICAgIGNvbnN0IHN0eWxlRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyMnICsgaWQpO1xyXG4gICAgICAgIGlmIChzdHlsZUVsZW1lbnQpIHtcclxuICAgICAgICAgICAgc3R5bGVFbGVtZW50LnJlbW92ZSgpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBjcmVhdGVTdHlsZVNoZWV0KHN0eWxlU2hlZXRJZDogc3RyaW5nKTogSFRNTFN0eWxlRWxlbWVudCB7XHJcbiAgICAgICAgY29uc3QgaHRtbEhlYWQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdoZWFkJyk7XHJcblxyXG4gICAgICAgIGNvbnN0IHN0eWxlRWxlSWQgPSBzdHlsZVNoZWV0SWQ7XHJcbiAgICAgICAgbGV0IHN0eWxlRWxlbWVudCA9IG51bGw7XHJcbiAgICAgICAgaWYgKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyMnICsgc3R5bGVFbGVJZCkpIHtcclxuICAgICAgICAgICAgc3R5bGVFbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignIycgKyBzdHlsZUVsZUlkKTtcclxuICAgICAgICAgICAgc3R5bGVFbGVtZW50LmlubmVyVGV4dCA9ICcnO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHN0eWxlRWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3N0eWxlJyk7XHJcbiAgICAgICAgICAgIHN0eWxlRWxlbWVudC5pZCA9IHN0eWxlRWxlSWQ7XHJcbiAgICAgICAgICAgIGh0bWxIZWFkLmFwcGVuZENoaWxkKHN0eWxlRWxlbWVudCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gc3R5bGVFbGVtZW50O1xyXG4gICAgfVxyXG5cclxuICAgIGdldFN0eWxlU2hlZXQoc3R5bGVTaGVldElkKSB7XHJcbiAgICAgICAgY29uc3Qgc3R5bGVTaGVldHMgPSBkb2N1bWVudC5zdHlsZVNoZWV0cyBhcyBhbnk7XHJcbiAgICAgICAgbGV0IHN0eWxlU2hlZXQgPSBudWxsO1xyXG4gICAgICAgIGZvciAoY29uc3Qgc3R5bGVzaGVldCBvZiBzdHlsZVNoZWV0cykge1xyXG4gICAgICAgICAgICBpZiAoKHN0eWxlc2hlZXQub3duZXJOb2RlIHx8IHN0eWxlc2hlZXRbJ293bmluZ0VsZW1lbnQnXSkuaWQgPT09IHN0eWxlU2hlZXRJZCkge1xyXG4gICAgICAgICAgICAgICAgc3R5bGVTaGVldCA9IHN0eWxlc2hlZXQ7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHN0eWxlU2hlZXQ7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqIOS4jueOsOacieagt+W8j+WQiOW5tiAqL1xyXG4gICAgYXBwZW5kQ3NzUnVsZXMocnVsZXM6IHN0cmluZ1tdLCBzdHlsZVNoZWV0KSB7XHJcbiAgICAgICAgZm9yIChjb25zdCBydWxlIG9mIHJ1bGVzKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHJ1bGVOYW1lID0gcnVsZS5zbGljZSgwLCBydWxlLmluZGV4T2YoJ3snKSk7XHJcbiAgICAgICAgICAgIGNvbnN0IHJlbW92ZWRDc3NSdWxlID0gdGhpcy5yZW1vdmVDc3NSdWxlKHJ1bGVOYW1lLCBzdHlsZVNoZWV0KTtcclxuICAgICAgICAgICAgbGV0IGNzc1RleHQgPSAnJztcclxuICAgICAgICAgICAgaWYgKHJlbW92ZWRDc3NSdWxlKSB7XHJcbiAgICAgICAgICAgICAgICBjc3NUZXh0ICs9IHJlbW92ZWRDc3NSdWxlLmNzc1RleHQuc2xpY2UocmVtb3ZlZENzc1J1bGUuY3NzVGV4dC5pbmRleE9mKCd7JykgKyAxLCByZW1vdmVkQ3NzUnVsZS5jc3NUZXh0LmluZGV4T2YoJ30nKSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY3NzVGV4dCArPSBydWxlLnNsaWNlKHJ1bGUuaW5kZXhPZigneycpICsgMSwgcnVsZS5pbmRleE9mKCd9JykpLnJlcGxhY2UoL1wiL2csICcnKS5yZXBsYWNlKC8sL2csICc7JykgKyAnOyc7XHJcbiAgICAgICAgICAgIGlmIChzdHlsZVNoZWV0LmFkZFJ1bGUpIHtcclxuICAgICAgICAgICAgICAgIHN0eWxlU2hlZXQuYWRkUnVsZShydWxlTmFtZSwgY3NzVGV4dCwgMCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBfbmV3UnVsZSA9IGAke3J1bGVOYW1lfXsgJHtjc3NUZXh0fSB9YDtcclxuICAgICAgICAgICAgICAgIHN0eWxlU2hlZXQuaW5zZXJ0UnVsZShfbmV3UnVsZSwgMCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLyoqIOimhueblueOsOacieeahOagt+W8jyAqL1xyXG4gICAgYXBwZW5kQ3NzUnVsZXMyKHJ1bGVzOiBzdHJpbmdbXSwgc3R5bGVTaGVldCkge1xyXG4gICAgICAgIGZvciAoY29uc3QgcnVsZSBvZiBydWxlcykge1xyXG4gICAgICAgICAgICBjb25zdCBydWxlTmFtZSA9IHJ1bGUuc2xpY2UoMCwgcnVsZS5pbmRleE9mKCd7JykpO1xyXG4gICAgICAgICAgICBjb25zdCByZW1vdmVkQ3NzUnVsZSA9IHRoaXMucmVtb3ZlQ3NzUnVsZShydWxlTmFtZSwgc3R5bGVTaGVldCk7XHJcbiAgICAgICAgICAgIGNvbnN0IGNzc1RleHQgPSBydWxlLnNsaWNlKHJ1bGUuaW5kZXhPZigneycpICsgMSwgcnVsZS5pbmRleE9mKCd9JykpLnJlcGxhY2UoL1wiL2csICcnKS5yZXBsYWNlKC8sL2csICc7JykgKyAnOyc7XHJcbiAgICAgICAgICAgIGlmIChzdHlsZVNoZWV0LmFkZFJ1bGUpIHtcclxuICAgICAgICAgICAgICAgIHN0eWxlU2hlZXQuYWRkUnVsZShydWxlTmFtZSwgY3NzVGV4dCwgMCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBfbmV3UnVsZSA9IGAke3J1bGVOYW1lfXsgJHtjc3NUZXh0fSB9YDtcclxuICAgICAgICAgICAgICAgIHN0eWxlU2hlZXQuaW5zZXJ0UnVsZShfbmV3UnVsZSwgMCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0Q3NzUnVsZShydWxlTmFtZTogc3RyaW5nLCBzdHlsZVNoZWV0KSB7XHJcbiAgICAgICAgY29uc3QgY3NzUnVsZXMgPSAoc3R5bGVTaGVldC5jc3NSdWxlcyB8fCBzdHlsZVNoZWV0LnJ1bGVzKSBhcyBhbnk7XHJcbiAgICAgICAgbGV0IHIgPSBudWxsO1xyXG4gICAgICAgIGZvciAoY29uc3QgcnVsZSBvZiBjc3NSdWxlcykge1xyXG4gICAgICAgICAgICBpZiAocnVsZS5zZWxlY3RvclRleHQgPT0gcnVsZU5hbWUpIHtcclxuICAgICAgICAgICAgICAgIHIgPSBydWxlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gcjtcclxuICAgIH1cclxuXHJcbiAgICByZW1vdmVDc3NSdWxlKHJ1bGVOYW1lOiBzdHJpbmcsIHN0eWxlU2hlZXQgKSB7XHJcbiAgICAgICAgY29uc3QgY3NzUnVsZXMgPSAoc3R5bGVTaGVldC5jc3NSdWxlcyB8fCBzdHlsZVNoZWV0LnJ1bGVzKSBhcyBhbnk7XHJcbiAgICAgICAgbGV0IGlpID0gMDtcclxuICAgICAgICBsZXQgY3NzUnVsZTogYW55ID0gZmFsc2U7XHJcbiAgICAgICAgZG8ge1xyXG4gICAgICAgICAgICBjc3NSdWxlID0gY3NzUnVsZXNbaWldO1xyXG4gICAgICAgICAgICBpZiAoY3NzUnVsZSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKGNzc1J1bGUuc2VsZWN0b3JUZXh0LnRvTG93ZXJDYXNlKCkgPT0gcnVsZU5hbWUudG9Mb3dlckNhc2UoKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChzdHlsZVNoZWV0LmNzc1J1bGVzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0eWxlU2hlZXQuZGVsZXRlUnVsZShpaSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc3R5bGVTaGVldC5yZW1vdmVSdWxlKGlpKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBjc3NSdWxlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlpKys7XHJcbiAgICAgICAgfSB3aGlsZSAoY3NzUnVsZSk7XHJcbiAgICB9XHJcblxyXG4gICAgaXNOdWxsT3JVbmRlZmluZWQodmFsOiBhbnkpIHtcclxuICAgICAgICByZXR1cm4gdmFsID09PSBudWxsIHx8IHZhbCA9PT0gdW5kZWZpbmVkO1xyXG4gICAgfVxyXG5cclxuICAgIGlzSUUoKSB7XHJcbiAgICAgICAgY29uc3QgdUEgPSB3aW5kb3cubmF2aWdhdG9yLnVzZXJBZ2VudDtcclxuICAgICAgICByZXR1cm4gL21zaWVcXHN8dHJpZGVudFxcL3xlZGdlXFwvL2kudGVzdCh1QSkgJiYgISEoJ3VuaXF1ZUlEJyBpbiBkb2N1bWVudCB8fCAnZG9jdW1lbnRNb2RlJyBpbiBkb2N1bWVudCB8fCAoJ0FjdGl2ZVhPYmplY3QnIGluIHdpbmRvdykgfHwgJ01TSW5wdXRNZXRob2RDb250ZXh0JyBpbiB3aW5kb3cpO1xyXG4gICAgfVxyXG5cclxuICAgIGJ1aWxkU29ydFN0cmluZyhzb3J0czogYW55W10pOiBzdHJpbmcge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmNmcy5idWlsZFNvcnRTdHJpbmcoc29ydHMpO1xyXG4gICAgfVxyXG5cclxuICAgIGJ1aWxkU3FsV2hlcmUoY29uZGl0aW9uczogYW55W10pOiBzdHJpbmcge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmNmcy5idWlsZFNxbFdoZXJlKGNvbmRpdGlvbnMpO1xyXG4gICAgfVxyXG5cclxuICAgIGdldEJyb3dzZXJUeXBlKCkge1xyXG4gICAgICAgIGNvbnN0IHVhID0gbmF2aWdhdG9yLnVzZXJBZ2VudC50b0xvd2VyQ2FzZSgpOyAgLy8g6I635Y+W55So5oi356uv5L+h5oGvXHJcbiAgICAgICAgY29uc3QgaW5mbyA9IHtcclxuICAgICAgICAgICAgaWUgOiAvbXNpZS8gLnRlc3QodWEpICYmICEvb3BlcmEvIC50ZXN0KHVhKSwgIC8vICDljLnphY1JRea1j+iniOWZqFxyXG4gICAgICAgICAgICBvcCA6IC9vcGVyYS8gLnRlc3QodWEpLCAgLy8gIOWMuemFjU9wZXJh5rWP6KeI5ZmoXHJcbiAgICAgICAgICAgIHNhIDogL3ZlcnNpb24uKnNhZmFyaS8udGVzdCh1YSksICAvLyDljLnphY1TYWZhcmnmtY/op4jlmahcclxuICAgICAgICAgICAgY2ggOiAvY2hyb21lLy50ZXN0KHVhKSwgIC8vICDljLnphY1DaHJvbWXmtY/op4jlmahcclxuICAgICAgICAgICAgZmYgOiAvZ2Vja28vLnRlc3QodWEpICYmICEvd2Via2l0Ly50ZXN0KHVhKSAgLy8g5Yy56YWNRmlyZWZveOa1j+iniOWZqFxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHJldHVybiBpbmZvO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICBnZXRGRlZlcigpIHtcclxuICAgICAgICBjb25zdCB1YSA9IG5hdmlnYXRvci51c2VyQWdlbnQ7XHJcbiAgICAgICAgY29uc3QgYiA9IHVhLmluZGV4T2YoJ0ZpcmVmb3gvJyk7XHJcbiAgICAgICAgaWYgKGIgPCAwKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAwO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gcGFyc2VGbG9hdCAodWEuc3Vic3RyaW5nKGIgKyA4LCB1YS5sYXN0SW5kZXhPZignXFwuJykpKTtcclxuICAgIH1cclxuXHJcbiAgICBnZXRRdWVyeVN0cmluZyhuYW1lLCBsb2NhdGlvblNlYXJjaCA9ICcnKSB7XHJcbiAgICAgICAgdmFyIHJlZyA9IG5ldyBSZWdFeHAoXCIoXnwmKVwiICsgbmFtZSArIFwiPShbXiZdKikoJnwkKVwiLCBcImlcIik7XHJcbiAgICAgICAgbGV0IF9zZWFyY2ggPSB3aW5kb3cubG9jYXRpb24uc2VhcmNoO1xyXG4gICAgICAgIGlmIChsb2NhdGlvblNlYXJjaCkge1xyXG4gICAgICAgICAgICBfc2VhcmNoID0gbG9jYXRpb25TZWFyY2g7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhciByID0gX3NlYXJjaC5zdWJzdHJpbmcoMSkubWF0Y2gocmVnKTtcclxuICAgICAgICBpZiAociAhPSBudWxsKSByZXR1cm4gKHJbMl0pOyByZXR1cm4gbnVsbDtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOiOt+WPlumhtemdouS4rWJvZHnkuIvmiYDmnInlhYPntKDnmoR6SW5kZXgsIOW5tui/lOWbnuS4i+S4qua1ruWxgueahOaWsHppbmRleFxyXG4gICAgICovXHJcbiAgICBnZXRGbG9hdGluZ0xheWVySW5kZXgodXBwZXJMYXllcnMgPSAxKSB7XHJcblxyXG4gICAgICAgIGNvbnN0IHNlbGVjdG9ycyA9IFtcclxuICAgICAgICAgICAgJ2JvZHk+LmYtZGF0YWdyaWQtc2V0dGluZ3Mtc2ltcGxlLWhvc3QnLFxyXG4gICAgICAgICAgICAnYm9keT5kaXYnLCBcclxuICAgICAgICAgICAgJ2JvZHk+ZmFycmlzLWRpYWxvZz4uZmFycmlzLW1vZGFsLnNob3cnLFxyXG4gICAgICAgICAgICAnYm9keT4uZmFycmlzLW1vZGFsLnNob3cnLCBcclxuICAgICAgICAgICAgJ2JvZHk+ZmFycmlzLWZpbHRlci1wYW5lbD4uZi1maWx0ZXItcGFuZWwtd3JhcHBlcicsIFxyXG4gICAgICAgICAgICAnYm9keSAuZi1zaWRlYmFyLXNob3c+LmYtc2lkZWJhci1tYWluJyxcclxuICAgICAgICAgICAgJ2JvZHk+LnBvcG92ZXIuc2hvdycsXHJcbiAgICAgICAgICAgICdib2R5PmZpbHRlci1yb3ctcGFuZWw+LmYtZGF0YWdyaWQtZmlsdGVyLXBhbmVsJyxcclxuICAgICAgICAgICAgJ2JvZHk+LmYtc2VjdGlvbi1tYXhpbWl6ZSdcclxuICAgICAgICBdO1xyXG5cclxuICAgICAgICBjb25zdCBvdmVybGF5cyA9IEFycmF5LmZyb20oZG9jdW1lbnQuYm9keS5xdWVyeVNlbGVjdG9yQWxsKHNlbGVjdG9ycy5qb2luKCcsJykpKS5maWx0ZXIobiA9PiBuKS5tYXAobiA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IHsgZGlzcGxheSwgekluZGV4IH0gPSB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZShuKTtcclxuICAgICAgICAgICAgaWYgKGRpc3BsYXkgPT09ICdub25lJykge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIDA7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIHBhcnNlSW50KHpJbmRleCwgMTApO1xyXG4gICAgICAgIH0pLmZpbHRlcihuID0+IG4pO1xyXG4gICAgICAgIGxldCBtYXhaaW5kZXggPSBNYXRoLm1heCguLi5vdmVybGF5cyk7XHJcbiAgICAgICAgaWYgKG1heFppbmRleCA8IDEwNDApIHtcclxuICAgICAgICAgICAgbWF4WmluZGV4ID0gMTA0MDtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIG1heFppbmRleCArIHVwcGVyTGF5ZXJzO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKiDngrnlh7tO5qyh5ZCO77yM5omn6KGMY2FsbGJhY2s7IOm7mOiupOeCueWHuzEw5qyh5ZCO5omn6KGMICovXHJcbiAgICBjbGlja0NvbnRpbnVpdHkoY2FsbGJhY2s6ICgpID0+IHZvaWQsY2xpY2tUYXRnYXROdW0gPSAxMCkge1xyXG5cclxuICAgICAgICBpZiAodGhpc1snY2xpY2tDb3VudE5vdyddID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgdGhpc1snY2xpY2tDb3VudE5vdyddID0gMDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIOi/nue7reeCueWHu+asoeaVsOWwj+S6juaMh+WumuasoeaVsOaXtlxyXG4gICAgICAgIGlmICh0aGlzWydjbGlja0NvdW50Tm93J10gPCBjbGlja1RhdGdhdE51bSAtIDEpIHtcclxuICAgICAgICAgICAgLy8g5riF6Zmk5a6a5pe25ZmoXHJcbiAgICAgICAgICAgIGlmICh0aGlzWydjbGlja1RpbWVyJ10pIHtcclxuICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aGlzWydjbGlja1RpbWVyJ10pO1xyXG4gICAgICAgICAgICAgICAgdGhpc1snY2xpY2tUaW1lciddID0gbnVsbDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvLyDngrnlh7vmrKHmlbArMVxyXG4gICAgICAgICAgICB0aGlzWydjbGlja0NvdW50Tm93J10rKztcclxuICAgICAgICAgICAgLy8g5omT5Y2w5qyh5pWw5pel5b+XXHJcbiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKGBjbGlja0NvdW50Tm93YCwgdGhpc1snY2xpY2tDb3VudE5vdyddKVxyXG4gICAgICAgICAgICAvLyDorr7nva7lrprml7blmajvvIzlpKfkuo4zMDDmr6vnp5Lngrnlh7vkuI3nrpfov57nu63ngrnlh7tcclxuICAgICAgICAgICAgdGhpc1snY2xpY2tUaW1lciddID0gc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzWydjbGlja0NvdW50Tm93J10gPSAwO1xyXG4gICAgICAgICAgICB9LCAzMDApXHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgLy8g54K55Ye75qyh5pWwKzHvvIjmraTml7blt7LlpKfkuo7nrYnkuo7mjIflrprngrnlh7vmrKHmlbDvvIlcclxuICAgICAgICAgICAgdGhpc1snY2xpY2tDb3VudE5vdyddKys7XHJcbiAgICAgICAgICAgIC8vIOaJk+WNsOaXpeW/l1xyXG4gICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhg6L+e57ut54K55Ye75LqGJHt0aGlzWydjbGlja0NvdW50Tm93J1195qyhYCwgYOWBmueCueS7gOS5iGApXHJcblxyXG4gICAgICAgICAgICBpZiAoY2FsbGJhY2spIHtcclxuICAgICAgICAgICAgICAgIGNhbGxiYWNrKCk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIOa4hemZpOWumuaXtuWZqFxyXG4gICAgICAgICAgICBpZiAodGhpc1snY2xpY2tUaW1lciddKSB7XHJcbiAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQodGhpc1snY2xpY2tUaW1lciddKTtcclxuICAgICAgICAgICAgICAgIHRoaXNbJ2NsaWNrVGltZXInXSA9IG51bGw7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLy8g54K55Ye75qyh5pWw5b2S6Zu277yM6YeN5paw6K6h5pWwXHJcbiAgICAgICAgICAgIHRoaXNbJ2NsaWNrQ291bnROb3cnXSA9IDA7XHJcbiAgICBcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBcclxuICAgIHJlZ0JvZHlLZXlkb3duRXZlbnQoZW50ZXJGbj86ICgpID0+IHZvaWQsIGVzY0ZuPzogKCkgPT4gdm9pZCkge1xyXG4gICAgICAgIGNvbnN0IGtleWRvd25IYW5kbGUgPSAoJGV2ZW50OiBLZXlib2FyZEV2ZW50KSA9PiB7XHJcbiAgICAgICAgICAgIGlmICgkZXZlbnQua2V5ICE9PSAnRXNjYXBlJyAmJiAkZXZlbnQua2V5ICE9PSAnRW50ZXInKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgJGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgICAgICRldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcclxuXHJcbiAgICAgICAgICAgIGlmICgkZXZlbnQua2V5ID09ICdFbnRlcicgJiYgZW50ZXJGbikge1xyXG4gICAgICAgICAgICAgICAgLy8g5omn6KGM5p+l6K+iXHJcbiAgICAgICAgICAgICAgICBlbnRlckZuKCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBlc2NGbiAmJiBlc2NGbigpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGRvY3VtZW50LmJvZHkuYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIGtleWRvd25IYW5kbGUgLCB0cnVlKTtcclxuICAgICAgICByZXR1cm4gKCkgPT4ge1xyXG4gICAgICAgICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCBrZXlkb3duSGFuZGxlLCB0cnVlKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuIl19
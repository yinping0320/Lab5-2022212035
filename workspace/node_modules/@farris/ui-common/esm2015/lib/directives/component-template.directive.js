/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { ComponentFactoryResolver, ComponentRef, Directive, ElementRef, Injector, Input } from '@angular/core';
/**
 * @record
 */
export function ITemplateComponent() { }
if (false) {
    /** @type {?} */
    ITemplateComponent.prototype.ctx;
    /** @type {?|undefined} */
    ITemplateComponent.prototype.renderContext;
}
export class FarrisComponentTemplateDirective {
    /**
     * @param {?} injector
     * @param {?} el
     * @param {?} cfr
     */
    constructor(injector, el, cfr) {
        this.injector = injector;
        this.el = el;
        this.cfr = cfr;
        this.cmpRef = null;
        this.templateType = 'cell';
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.renderTemplate();
    }
    /**
     * @param {?} changes
     * @return {?}
     */
    ngOnChanges(changes) {
        if (changes.ctx && !changes.ctx.isFirstChange()) {
            this._expandCtxToThis();
        }
    }
    /**
     * @private
     * @return {?}
     */
    _expandCtxToThis() {
        this.expandContext(this.ctx);
        this.expandContext(this.renderContext);
    }
    /**
     * @private
     * @param {?} ctx
     * @return {?}
     */
    expandContext(ctx) {
        if (this.templateComponentIns && ctx) {
            Object.keys(ctx).forEach((/**
             * @param {?} n
             * @return {?}
             */
            n => {
                this.templateComponentIns.instance[n] = ctx[n];
            }));
        }
    }
    /**
     * @private
     * @return {?}
     */
    renderTemplate() {
        this.templateComponentIns = this._getCmpRef();
        if (this.templateComponentIns) {
            this._expandCtxToThis();
            this.templateComponentIns.instance.ctx = this.ctx;
            this.el.nativeElement.append(this.templateComponentIns.location.nativeElement);
            this.templateComponentIns.changeDetectorRef.detectChanges();
        }
    }
    /**
     * @private
     * @return {?}
     */
    _getCmpRef() {
        if (this.cmpRef) {
            return this.createInstance(this.cmpRef);
        }
        if (this.column) {
            if (this.templateType == 'cell') {
                if (this.column.componentType) {
                    return this.createInstance(this.column.componentType);
                }
            }
            else {
                if (this.column.headerComponentType) {
                    return this.createInstance(this.column.headerComponentType);
                }
            }
        }
        return null;
    }
    /**
     * @private
     * @param {?} cmptype
     * @return {?}
     */
    createInstance(cmptype) {
        if (!cmptype) {
            return null;
        }
        /** @type {?} */
        let templateComponentIns = null;
        if (!cmptype.ngBaseDef && typeof cmptype === 'function') {
            templateComponentIns = cmptype();
        }
        else {
            if (!cmptype['instance']) {
                /** @type {?} */
                const cellTemplateCmp = this.cfr.resolveComponentFactory((/** @type {?} */ (cmptype)));
                templateComponentIns = cellTemplateCmp.create(this.injector);
            }
            else {
                templateComponentIns = cmptype;
            }
        }
        return templateComponentIns;
    }
}
FarrisComponentTemplateDirective.decorators = [
    { type: Directive, args: [{ selector: '[component-template]' },] }
];
/** @nocollapse */
FarrisComponentTemplateDirective.ctorParameters = () => [
    { type: Injector },
    { type: ElementRef },
    { type: ComponentFactoryResolver }
];
FarrisComponentTemplateDirective.propDecorators = {
    column: [{ type: Input, args: ['component-template',] }],
    cmpRef: [{ type: Input }],
    ctx: [{ type: Input }],
    renderContext: [{ type: Input }],
    templateType: [{ type: Input }]
};
if (false) {
    /** @type {?} */
    FarrisComponentTemplateDirective.prototype.column;
    /** @type {?} */
    FarrisComponentTemplateDirective.prototype.cmpRef;
    /** @type {?} */
    FarrisComponentTemplateDirective.prototype.ctx;
    /** @type {?} */
    FarrisComponentTemplateDirective.prototype.renderContext;
    /** @type {?} */
    FarrisComponentTemplateDirective.prototype.templateType;
    /** @type {?} */
    FarrisComponentTemplateDirective.prototype.templateComponentIns;
    /**
     * @type {?}
     * @private
     */
    FarrisComponentTemplateDirective.prototype.injector;
    /**
     * @type {?}
     * @private
     */
    FarrisComponentTemplateDirective.prototype.el;
    /**
     * @type {?}
     * @private
     */
    FarrisComponentTemplateDirective.prototype.cfr;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29tcG9uZW50LXRlbXBsYXRlLmRpcmVjdGl2ZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvdWktY29tbW9uLyIsInNvdXJjZXMiOlsibGliL2RpcmVjdGl2ZXMvY29tcG9uZW50LXRlbXBsYXRlLmRpcmVjdGl2ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFFLHdCQUF3QixFQUFFLFlBQVksRUFBRSxTQUFTLEVBQUUsVUFBVSxFQUFFLFFBQVEsRUFBRSxLQUFLLEVBQWtELE1BQU0sZUFBZSxDQUFDOzs7O0FBRy9KLHdDQUdDOzs7SUFGRyxpQ0FBUzs7SUFDVCwyQ0FBb0I7O0FBT3hCLE1BQU0sT0FBTyxnQ0FBZ0M7Ozs7OztJQVV6QyxZQUFvQixRQUFrQixFQUFVLEVBQWMsRUFBVSxHQUE2QjtRQUFqRixhQUFRLEdBQVIsUUFBUSxDQUFVO1FBQVUsT0FBRSxHQUFGLEVBQUUsQ0FBWTtRQUFVLFFBQUcsR0FBSCxHQUFHLENBQTBCO1FBUDVGLFdBQU0sR0FBc0IsSUFBSSxDQUFDO1FBS2pDLGlCQUFZLEdBQTRDLE1BQU0sQ0FBQztJQUVpQyxDQUFDOzs7O0lBRTFHLFFBQVE7UUFDSixJQUFJLENBQUMsY0FBYyxFQUFFLENBQUM7SUFDMUIsQ0FBQzs7Ozs7SUFFRCxXQUFXLENBQUMsT0FBc0I7UUFDOUIsSUFBSSxPQUFPLENBQUMsR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxhQUFhLEVBQUUsRUFBRTtZQUM3QyxJQUFJLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQztTQUMzQjtJQUNMLENBQUM7Ozs7O0lBR08sZ0JBQWdCO1FBQ3BCLElBQUksQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQzdCLElBQUksQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxDQUFDO0lBQzNDLENBQUM7Ozs7OztJQUVPLGFBQWEsQ0FBQyxHQUFRO1FBQzFCLElBQUksSUFBSSxDQUFD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dCI6WyJpbXBvcnQgeyBDb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIsIENvbXBvbmVudFJlZiwgRGlyZWN0aXZlLCBFbGVtZW50UmVmLCBJbmplY3RvciwgSW5wdXQsIE9uQ2hhbmdlcywgT25Jbml0LCBTaW1wbGVDaGFuZ2UsIFNpbXBsZUNoYW5nZXMgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgRGF0YUNvbHVtbiB9IGZyb20gJ0BmYXJyaXMvdWktY29tbW9uL2NvbHVtbic7XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIElUZW1wbGF0ZUNvbXBvbmVudCB7XHJcbiAgICBjdHg6IGFueSxcclxuICAgIHJlbmRlckNvbnRleHQ/OiBhbnk7XHJcbn1cclxuXHJcbmV4cG9ydCB0eXBlIENvbXBvbmVudFRlbXBsYXRlRm4gPSAoKSA9PiBQYXJ0aWFsPElUZW1wbGF0ZUNvbXBvbmVudD4gfCBDb21wb25lbnRSZWY8UGFydGlhbDxJVGVtcGxhdGVDb21wb25lbnQ+PjtcclxuZXhwb3J0IHR5cGUgQ29tcG9uZW50VGVtcGxhdGVSZWYgPSBQYXJ0aWFsPElUZW1wbGF0ZUNvbXBvbmVudD4gfCBDb21wb25lbnRSZWY8UGFydGlhbDxJVGVtcGxhdGVDb21wb25lbnQ+PiB8IENvbXBvbmVudFRlbXBsYXRlRm47XHJcblxyXG5ARGlyZWN0aXZlKHsgc2VsZWN0b3I6ICdbY29tcG9uZW50LXRlbXBsYXRlXScgfSlcclxuZXhwb3J0IGNsYXNzIEZhcnJpc0NvbXBvbmVudFRlbXBsYXRlRGlyZWN0aXZlIGltcGxlbWVudHMgT25Jbml0LCBPbkNoYW5nZXMge1xyXG5cclxuICAgIEBJbnB1dCgnY29tcG9uZW50LXRlbXBsYXRlJykgY29sdW1uOiBEYXRhQ29sdW1uO1xyXG4gICAgQElucHV0KCkgY21wUmVmOiBDb21wb25lbnRSZWY8YW55PiA9IG51bGw7XHJcblxyXG4gICAgQElucHV0KCkgY3R4OiBhbnk7XHJcbiAgICBASW5wdXQoKSByZW5kZXJDb250ZXh0OiBhbnlcclxuXHJcbiAgICBASW5wdXQoKSB0ZW1wbGF0ZVR5cGU6ICdoZWFkJ3wnY2VsbCd8J2Zvb3Rlcid8J2VtcHR5J3wnbm9ybWFsJyA9ICdjZWxsJztcclxuICAgIHRlbXBsYXRlQ29tcG9uZW50SW5zOiBDb21wb25lbnRSZWY8YW55PjtcclxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgaW5qZWN0b3I6IEluamVjdG9yLCBwcml2YXRlIGVsOiBFbGVtZW50UmVmLCBwcml2YXRlIGNmcjogQ29tcG9uZW50RmFjdG9yeVJlc29sdmVyKSB7IH1cclxuXHJcbiAgICBuZ09uSW5pdCgpIHtcclxuICAgICAgICB0aGlzLnJlbmRlclRlbXBsYXRlKCk7XHJcbiAgICB9XHJcblxyXG4gICAgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcykge1xyXG4gICAgICAgIGlmIChjaGFuZ2VzLmN0eCAmJiAhY2hhbmdlcy5jdHguaXNGaXJzdENoYW5nZSgpKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX2V4cGFuZEN0eFRvVGhpcygpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcblxyXG4gICAgcHJpdmF0ZSBfZXhwYW5kQ3R4VG9UaGlzKCkge1xyXG4gICAgICAgIHRoaXMuZXhwYW5kQ29udGV4dCh0aGlzLmN0eCk7XHJcbiAgICAgICAgdGhpcy5leHBhbmRDb250ZXh0KHRoaXMucmVuZGVyQ29udGV4dCk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBleHBhbmRDb250ZXh0KGN0eDogYW55KSB7XHJcbiAgICAgICAgaWYgKHRoaXMudGVtcGxhdGVDb21wb25lbnRJbnMgJiYgY3R4KSB7XHJcbiAgICAgICAgICAgIE9iamVjdC5rZXlzKGN0eCkuZm9yRWFjaChuID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMudGVtcGxhdGVDb21wb25lbnRJbnMuaW5zdGFuY2Vbbl0gPSBjdHhbbl07XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHJlbmRlclRlbXBsYXRlKCkge1xyXG4gICAgICAgIHRoaXMudGVtcGxhdGVDb21wb25lbnRJbnMgPSB0aGlzLl9nZXRDbXBSZWYoKTtcclxuICAgICAgICBpZiAodGhpcy50ZW1wbGF0ZUNvbXBvbmVudElucykge1xyXG4gICAgICAgICAgICB0aGlzLl9leHBhbmRDdHhUb1RoaXMoKTtcclxuICAgICAgICAgICAgdGhpcy50ZW1wbGF0ZUNvbXBvbmVudElucy5pbnN0YW5jZS5jdHggPSB0aGlzLmN0eDtcclxuICAgICAgICAgICAgdGhpcy5lbC5uYXRpdmVFbGVtZW50LmFwcGVuZCh0aGlzLnRlbXBsYXRlQ29tcG9uZW50SW5zLmxvY2F0aW9uLm5hdGl2ZUVsZW1lbnQpO1xyXG4gICAgICAgICAgICB0aGlzLnRlbXBsYXRlQ29tcG9uZW50SW5zLmNoYW5nZURldGVjdG9yUmVmLmRldGVjdENoYW5nZXMoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBfZ2V0Q21wUmVmKCkge1xyXG4gICAgICAgIGlmICh0aGlzLmNtcFJlZikge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5jcmVhdGVJbnN0YW5jZSh0aGlzLmNtcFJlZik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodGhpcy5jb2x1bW4pIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMudGVtcGxhdGVUeXBlID09ICdjZWxsJykge1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuY29sdW1uLmNvbXBvbmVudFR5cGUpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5jcmVhdGVJbnN0YW5jZSh0aGlzLmNvbHVtbi5jb21wb25lbnRUeXBlKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmNvbHVtbi5oZWFkZXJDb21wb25lbnRUeXBlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuY3JlYXRlSW5zdGFuY2UodGhpcy5jb2x1bW4uaGVhZGVyQ29tcG9uZW50VHlwZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgY3JlYXRlSW5zdGFuY2UoY21wdHlwZTogYW55KTogQ29tcG9uZW50UmVmPGFueT4ge1xyXG5cclxuICAgICAgICBpZiAoIWNtcHR5cGUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBsZXQgdGVtcGxhdGVDb21wb25lbnRJbnMgPSBudWxsO1xyXG4gICAgICAgIGlmICghY21wdHlwZS5uZ0Jhc2VEZWYgJiYgdHlwZW9mIGNtcHR5cGUgPT09ICdmdW5jdGlvbicpIHtcclxuICAgICAgICAgICAgdGVtcGxhdGVDb21wb25lbnRJbnMgPSBjbXB0eXBlKCk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgaWYgKCFjbXB0eXBlWydpbnN0YW5jZSddKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBjZWxsVGVtcGxhdGVDbXAgPSB0aGlzLmNmci5yZXNvbHZlQ29tcG9uZW50RmFjdG9yeShjbXB0eXBlIGFzIGFueSk7XHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZUNvbXBvbmVudElucyA9IGNlbGxUZW1wbGF0ZUNtcC5jcmVhdGUodGhpcy5pbmplY3Rvcik7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZUNvbXBvbmVudElucyA9IGNtcHR5cGU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiB0ZW1wbGF0ZUNvbXBvbmVudEluc1xyXG4gICAgfVxyXG59XHJcbiJdfQ==
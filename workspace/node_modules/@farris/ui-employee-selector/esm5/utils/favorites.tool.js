/**
 * @fileoverview added by tsickle
 * Generated from: utils/favorites.tool.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { HttpClient, HttpHeaders } from '@angular/common/http';
import { Injectable } from '@angular/core';
import { of, Subject } from 'rxjs';
var FavoritesTool = /** @class */ (function () {
    function FavoritesTool(http) {
        this.http = http;
        this.absOrgType = 'System_organization';
        this.busNum = 'common';
        this.idField = 'id';
        this.favoritesList = [];
        this.enableFavorites = true;
        this.absRfQueryUrl = '/api/runtime/sys/v1.0/absRecentContacts/query';
        this.absRfModifyUrl = '/api/runtime/sys/v1.0/absRecentContacts/modify';
        this.subject = new Subject();
    }
    /**
     * 操作最近联系人或收藏夹
     * @param param RfRequestParam
     * @returns observable
     */
    /**
     * 操作最近联系人或收藏夹
     * @param {?} actionToken
     * @param {?} param RfRequestParam
     * @return {?} observable
     */
    FavoritesTool.prototype.curdRecentContactsOrFavorites = /**
     * 操作最近联系人或收藏夹
     * @param {?} actionToken
     * @param {?} param RfRequestParam
     * @return {?} observable
     */
    function (actionToken, param) {
        /** @type {?} */
        var url = this.absRfQueryUrl;
        if (actionToken === 'modify') {
            url = this.absRfModifyUrl;
        }
        /** @type {?} */
        var options = {
            headers: new HttpHeaders({
                'Content-Type': 'application/json',
            })
        };
        return this.http.post(url, param, options);
    };
    Object.defineProperty(FavoritesTool.prototype, "favoritesSubject", {
        get: /**
         * @return {?}
         */
        function () {
            return this.subject.asObservable();
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @param {?} value
     * @return {?}
     */
    FavoritesTool.prototype.setFavoritesList = /**
     * @param {?} value
     * @return {?}
     */
    function (value) {
        this.subject.next(value);
    };
    /**
     * 获取收藏夹中人员列表
     */
    /**
     * 获取收藏夹中人员列表
     * @param {?=} withPermission
     * @return {?}
     */
    FavoritesTool.prototype.getFavoritesList = /**
     * 获取收藏夹中人员列表
     * @param {?=} withPermission
     * @return {?}
     */
    function (withPermission) {
        if (withPermission === void 0) { withPermission = false; }
        if (this.enableFavorites) {
            /** @type {?} */
            var param = {
                absOrgType: this.absOrgType,
                bizId: this.busNum,
                objectValue: 'CollectUser'
            };
            if (withPermission) {
                param.withPermission = true;
                param.authOp = 'UserManage';
            }
            return this.curdRecentContactsOrFavorites('query', param);
        }
        return of([]);
    };
    /**
     * 加入或取消收藏
     * @param e 鼠标事件
     * @param id 标识
     * @returns Observable
     */
    /**
     * 加入或取消收藏
     * @param {?} e 鼠标事件
     * @param {?} object
     * @return {?} Observable
     */
    FavoritesTool.prototype.toggleFavorites = /**
     * 加入或取消收藏
     * @param {?} e 鼠标事件
     * @param {?} object
     * @return {?} Observable
     */
    function (e, object) {
        var _this = this;
        /** @type {?} */
        var id = object[this.idField];
        /** @type {?} */
        var action = 'add';
        /** @type {?} */
        var param = {
            absOrgType: this.absOrgType,
            bizId: this.busNum,
            objectValue: 'CollectUser'
        };
        if (this.favoritesList.findIndex((/**
         * @param {?} item
         * @return {?}
         */
        function (item) { return item[_this.idField] === id; })) !== -1) {
            param.deleteList = [id];
            action = 'delete';
        }
        else {
            param.addList = [id];
        }
        this.curdRecentContactsOrFavorites('modify', param).subscribe((/**
         * @return {?}
         */
        function () {
            if (action === 'add') {
                /** @type {?} */
                var index = _this.favoritesList.findIndex((/**
                 * @param {?} item
                 * @return {?}
                 */
                function (item) { return item[_this.idField] === id; }));
                if (index === -1) {
                    _this.favoritesList.push(object);
                }
            }
            else {
                _this.favoritesList = _this.favoritesList.filter((/**
                 * @param {?} item
                 * @return {?}
                 */
                function (item) { return item[_this.idField] !== id; }));
            }
            _this.setFavoritesList(_this.favoritesList);
        }));
        e.cancelBubble = true;
        e.stopPropagation();
    };
    /**
     * 清空我的收藏
     */
    /**
     * 清空我的收藏
     * @return {?}
     */
    FavoritesTool.prototype.clearFavoritesList = /**
     * 清空我的收藏
     * @return {?}
     */
    function () {
        var _this = this;
        if (!this.favoritesList.length) {
            this.setFavoritesList(this.favoritesList);
            return;
        }
        /** @type {?} */
        var ids = this.favoritesList.map((/**
         * @param {?} item
         * @return {?}
         */
        function (item) { return item[_this.idField]; }));
        /** @type {?} */
        var param = {
            absOrgType: this.absOrgType,
            bizId: this.busNum,
            objectValue: 'CollectUser',
            addList: [],
            deleteList: ids
        };
        this.curdRecentContactsOrFavorites('modify', param).subscribe((/**
         * @param {?} val
         * @return {?}
         */
        function (val) {
            _this.favoritesList = [];
            _this.setFavoritesList(_this.favoritesList);
        }));
    };
    FavoritesTool.decorators = [
        { type: Injectable }
    ];
    /** @nocollapse */
    FavoritesTool.ctorParameters = function () { return [
        { type: HttpClient }
    ]; };
    return FavoritesTool;
}());
export { FavoritesTool };
if (false) {
    /** @type {?} */
    FavoritesTool.prototype.absOrgType;
    /** @type {?} */
    FavoritesTool.prototype.busNum;
    /** @type {?} */
    FavoritesTool.prototype.idField;
    /** @type {?} */
    FavoritesTool.prototype.favoritesList;
    /** @type {?} */
    FavoritesTool.prototype.enableFavorites;
    /** @type {?} */
    FavoritesTool.prototype.absRfQueryUrl;
    /** @type {?} */
    FavoritesTool.prototype.absRfModifyUrl;
    /**
     * @type {?}
     * @private
     */
    FavoritesTool.prototype.subject;
    /**
     * @type {?}
     * @private
     */
    FavoritesTool.prototype.http;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmF2b3JpdGVzLnRvb2wuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL3VpLWVtcGxveWVlLXNlbGVjdG9yLyIsInNvdXJjZXMiOlsidXRpbHMvZmF2b3JpdGVzLnRvb2wudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLFdBQVcsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBQy9ELE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDM0MsT0FBTyxFQUFjLEVBQUUsRUFBRSxPQUFPLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFHL0M7SUFjSSx1QkFBb0IsSUFBZ0I7UUFBaEIsU0FBSSxHQUFKLElBQUksQ0FBWTtRQVhwQyxlQUFVLEdBQUcscUJBQXFCLENBQUM7UUFDbkMsV0FBTSxHQUFHLFFBQVEsQ0FBQztRQUNsQixZQUFPLEdBQUcsSUFBSSxDQUFDO1FBQ2Ysa0JBQWEsR0FBRyxFQUFFLENBQUM7UUFDbkIsb0JBQWUsR0FBRyxJQUFJLENBQUM7UUFFdkIsa0JBQWEsR0FBRywrQ0FBK0MsQ0FBQztRQUNoRSxtQkFBYyxHQUFHLGdEQUFnRCxDQUFDO1FBRTFELFlBQU8sR0FBRyxJQUFJLE9BQU8sRUFBTyxDQUFDO0lBSXJDLENBQUM7SUFFRDs7OztPQUlHOzs7Ozs7O0lBQ0YscURBQTZCOzs7Ozs7SUFBN0IsVUFBOEIsV0FBbUIsRUFBRSxLQUFxQjs7WUFDakUsR0FBRyxHQUFHLElBQUksQ0FBQyxhQUFhO1FBQzVCLElBQUksV0FBVyxLQUFLLFFBQVEsRUFBRTtZQUMxQixHQUFHLEdBQUcsSUFBSSxDQUFDLGNBQWMsQ0FBQztTQUM3Qjs7WUFDSyxPQUFPLEdBQUc7WUFDWixPQUFPLEVBQUUsSUFBSSxXQUFXLENBQUM7Z0JBQ3JCLGNBQWMsRUFBRSxrQkFBa0I7YUFDckMsQ0FBQztTQUNMO1FBQ0QsT0FBTyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLEVBQUUsS0FBSyxF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QUVHOzs7OztJQUNILDBDQUFrQjs7OztJQUFsQjtRQUFBLGlCQWtCQztRQWpCRyxJQUFJLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxNQUFNLEVBQUU7WUFDNUIsSUFBSSxDQUFDLGdCQUFnQixDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsQ0FBQztZQUMxQyxPQUFPO1NBQ1Y7O1lBQ0ssR0FBRyxHQUFHLElBQUksQ0FBQyxhQUFhLENBQUMsR0FBRzs7OztRQUFDLFVBQUEsSUFBSSxJQUFJLE9BQUEsSUFBSSxDQUFDLEtBQUksQ0FBQyxPQUFPLENBQUMsRUFBbEIsQ0FBa0IsRUFBQzs7WUFDeEQsS0FBSyxHQUFtQjtZQUMxQixVQUFVLEVBQUUsSUFBSSxDQUFDLFVBQVU7WUFDM0IsS0FBSyxFQUFFLElBQUksQ0FBQyxNQUFNO1lBQ2xCLFdBQVcsRUFBRSxhQUFhO1lBQzFCLE9BQU8sRUFBRSxFQUFFO1lBQ1gsVUFBVSxFQUFFLEdBQUc7U0FDbEI7UUFFRCxJQUFJLENBQUMsNkJBQTZCLENBQUMsUUFBUSxFQUFFLEtBQUssQ0FBQyxDQUFDLFNBQVM7Ozs7UUFBQyxVQUFDLEdBQUc7WUFDOUQsS0FBSSxDQUFDLGFBQWEsR0FBRyxFQUFFLENBQUM7WUFDeEIsS0FBSSxDQUFDLGdCQUFnQixDQUFDLEtBQUksQ0FBQyxhQUFhLENBQUMsQ0FBQztRQUM5QyxDQUFDLEVBQUMsQ0FBQztJQUNQLENBQUM7O2dCQXZISixVQUFVOzs7O2dCQUxGLFVBQVU7O0lBNkhuQixvQkFBQztDQUFBLEFBeEhELElBd0hDO1NBdkhZLGFBQWE7OztJQUV0QixtQ0FBbUM7O0lBQ25DLCtCQUFrQjs7SUFDbEIsZ0NBQWU7O0lBQ2Ysc0NBQW1COztJQUNuQix3Q0FBdUI7O0lBRXZCLHNDQUFnRTs7SUFDaEUsdUNBQWtFOzs7OztJQUVsRSxnQ0FBcUM7Ozs7O0lBRXpCLDZCQUF3QiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEh0dHBDbGllbnQsIEh0dHBIZWFkZXJzIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uL2h0dHAnO1xyXG5pbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IE9ic2VydmFibGUsIG9mLCBTdWJqZWN0IH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7IFJmUmVxdWVzdFBhcmFtIH0gZnJvbSAnLi91c2VyLnR5cGUnO1xyXG5cclxuQEluamVjdGFibGUoKVxyXG5leHBvcnQgY2xhc3MgRmF2b3JpdGVzVG9vbCB7XHJcblxyXG4gICAgYWJzT3JnVHlwZSA9ICdTeXN0ZW1fb3JnYW5pemF0aW9uJztcclxuICAgIGJ1c051bSA9ICdjb21tb24nO1xyXG4gICAgaWRGaWVsZCA9ICdpZCc7XHJcbiAgICBmYXZvcml0ZXNMaXN0ID0gW107XHJcbiAgICBlbmFibGVGYXZvcml0ZXMgPSB0cnVlO1xyXG5cclxuICAgIGFic1JmUXVlcnlVcmwgPSAnL2FwaS9ydW50aW1lL3N5cy92MS4wL2Fic1JlY2VudENvbnRhY3RzL3F1ZXJ5JztcclxuICAgIGFic1JmTW9kaWZ5VXJsID0gJy9hcGkvcnVudGltZS9zeXMvdjEuMC9hYnNSZWNlbnRDb250YWN0cy9tb2RpZnknO1xyXG5cclxuICAgIHByaXZhdGUgc3ViamVjdCA9IG5ldyBTdWJqZWN0PGFueT4oKTtcclxuXHJcbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIGh0dHA6IEh0dHBDbGllbnQpIHtcclxuXHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDmk43kvZzmnIDov5HogZTns7vkurrmiJbmlLbol4/lpLlcclxuICAgICAqIEBwYXJhbSBwYXJhbSBSZlJlcXVlc3RQYXJhbVxyXG4gICAgICogQHJldHVybnMgb2JzZXJ2YWJsZVxyXG4gICAgICovXHJcbiAgICAgY3VyZFJlY2VudENvbnRhY3RzT3JGYXZvcml0ZXMoYWN0aW9uVG9rZW46IHN0cmluZywgcGFyYW06IFJmUmVxdWVzdFBhcmFtKSB7XHJcbiAgICAgICAgbGV0IHVybCA9IHRoaXMuYWJzUmZRdWVyeVVybDtcclxuICAgICAgICBpZiAoYWN0aW9uVG9rZW4gPT09ICdtb2RpZnknKSB7XHJcbiAgICAgICAgICAgIHVybCA9IHRoaXMuYWJzUmZNb2RpZnlVcmw7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IG9wdGlvbnMgPSB7XHJcbiAgICAgICAgICAgIGhlYWRlcnM6IG5ldyBIdHRwSGVhZGVycyh7XHJcbiAgICAgICAgICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nLFxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuaHR0cC5wb3N0KHVybCwgcGFyYW0sIG9wdGlvbnMpO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBmYXZvcml0ZXNTdWJqZWN0KCk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuc3ViamVjdC5hc09ic2VydmFibGUoKTtcclxuICAgIH1cclxuXHJcbiAgICBzZXRGYXZvcml0ZXNMaXN0KHZhbHVlOiBhbnkpIHtcclxuICAgICAgICB0aGlzLnN1YmplY3QubmV4dCh2YWx1ZSk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDojrflj5bmlLbol4/lpLnkuK3kurrlkZjliJfooahcclxuICAgICAqL1xyXG4gICAgZ2V0RmF2b3JpdGVzTGlzdCh3aXRoUGVybWlzc2lvbjogYm9vbGVhbiA9IGZhbHNlKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgICAgICBpZiAodGhpcy5lbmFibGVGYXZvcml0ZXMpIHtcclxuICAgICAgICAgICAgY29uc3QgcGFyYW06IFJmUmVxdWVzdFBhcmFtID0ge1xyXG4gICAgICAgICAgICAgICAgYWJzT3JnVHlwZTogdGhpcy5hYnNPcmdUeXBlLFxyXG4gICAgICAgICAgICAgICAgYml6SWQ6IHRoaXMuYnVzTnVtLFxyXG4gICAgICAgICAgICAgICAgb2JqZWN0VmFsdWU6ICdDb2xsZWN0VXNlcidcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgaWYod2l0aFBlcm1pc3Npb24pIHtcclxuICAgICAgICAgICAgICAgIHBhcmFtLndpdGhQZXJtaXNzaW9uID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIHBhcmFtLmF1dGhPcCA9ICdVc2VyTWFuYWdlJztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5jdXJkUmVjZW50Q29udGFjdHNPckZhdm9yaXRlcygncXVlcnknLCBwYXJhbSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBvZihbXSk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDliqDlhaXmiJblj5bmtojmlLbol49cclxuICAgICAqIEBwYXJhbSBlIOm8oOagh+S6i+S7tlxyXG4gICAgICogQHBhcmFtIGlkIOagh+ivhlxyXG4gICAgICogQHJldHVybnMgT2JzZXJ2YWJsZVxyXG4gICAgICovXHJcbiAgICB0b2dnbGVGYXZvcml0ZXMoZTogYW55LCBvYmplY3Q6IGFueSkge1xyXG4gICAgICAgIGNvbnN0IGlkID0gb2JqZWN0W3RoaXMuaWRGaWVsZF07XHJcbiAgICAgICAgbGV0IGFjdGlvbiA9ICdhZGQnO1xyXG4gICAgICAgIGNvbnN0IHBhcmFtOiBSZlJlcXVlc3RQYXJhbSA9IHtcclxuICAgICAgICAgICAgYWJzT3JnVHlwZTogdGhpcy5hYnNPcmdUeXBlLFxyXG4gICAgICAgICAgICBiaXpJZDogdGhpcy5idXNOdW0sXHJcbiAgICAgICAgICAgIG9iamVjdFZhbHVlOiAnQ29sbGVjdFVzZXInXHJcbiAgICAgICAgfTtcclxuICAgICAgICBpZiAodGhpcy5mYXZvcml0ZXNMaXN0LmZpbmRJbmRleChpdGVtID0+IGl0ZW1bdGhpcy5pZEZpZWxkXSA9PT0gaWQpICE9PSAtMSkge1xyXG4gICAgICAgICAgICBwYXJhbS5kZWxldGVMaXN0ID0gW2lkXTtcclxuICAgICAgICAgICAgYWN0aW9uID0gJ2RlbGV0ZSc7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcGFyYW0uYWRkTGlzdCA9IFtpZF07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuY3VyZFJlY2VudENvbnRhY3RzT3JGYXZvcml0ZXMoJ21vZGlmeScsIHBhcmFtKS5zdWJzY3JpYmUoKCkgPT4ge1xyXG4gICAgICAgICAgICBpZiAoYWN0aW9uID09PSAnYWRkJykge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgaW5kZXggPSB0aGlzLmZhdm9yaXRlc0xpc3QuZmluZEluZGV4KGl0ZW0gPT4gaXRlbVt0aGlzLmlkRmllbGRdID09PSBpZCk7XHJcbiAgICAgICAgICAgICAgICBpZiAoaW5kZXggPT09IC0xKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5mYXZvcml0ZXNMaXN0LnB1c2gob2JqZWN0KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZmF2b3JpdGVzTGlzdCA9IHRoaXMuZmF2b3JpdGVzTGlzdC5maWx0ZXIoaXRlbSA9PiBpdGVtW3RoaXMuaWRGaWVsZF0gIT09IGlkKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLnNldEZhdm9yaXRlc0xpc3QodGhpcy5mYXZvcml0ZXNMaXN0KTtcclxuICAgICAgICB9KTtcclxuICAgICAgICBlLmNhbmNlbEJ1YmJsZSA9IHRydWU7XHJcbiAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOa4heepuuaIkeeahOaUtuiXj1xyXG4gICAgICovXHJcbiAgICBjbGVhckZhdm9yaXRlc0xpc3QoKSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLmZhdm9yaXRlc0xpc3QubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIHRoaXMuc2V0RmF2b3JpdGVzTGlzdCh0aGlzLmZhdm9yaXRlc0xpc3QpO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IGlkcyA9IHRoaXMuZmF2b3JpdGVzTGlzdC5tYXAoaXRlbSA9PiBpdGVtW3RoaXMuaWRGaWVsZF0pO1xyXG4gICAgICAgIGNvbnN0IHBhcmFtOiBSZlJlcXVlc3RQYXJhbSA9IHtcclxuICAgICAgICAgICAgYWJzT3JnVHlwZTogdGhpcy5hYnNPcmdUeXBlLFxyXG4gICAgICAgICAgICBiaXpJZDogdGhpcy5idXNOdW0sXHJcbiAgICAgICAgICAgIG9iamVjdFZhbHVlOiAnQ29sbGVjdFVzZXInLFxyXG4gICAgICAgICAgICBhZGRMaXN0OiBbXSxcclxuICAgICAgICAgICAgZGVsZXRlTGlzdDogaWRzXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdGhpcy5jdXJkUmVjZW50Q29udGFjdHNPckZhdm9yaXRlcygnbW9kaWZ5JywgcGFyYW0pLnN1YnNjcmliZSgodmFsKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuZmF2b3JpdGVzTGlzdCA9IFtdO1xyXG4gICAgICAgICAgICB0aGlzLnNldEZhdm9yaXRlc0xpc3QodGhpcy5mYXZvcml0ZXNMaXN0KTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxufVxyXG4iXX0=
/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Optional, Injector } from '@angular/core';
/*
 * @Author: 胡玉洋(Yuyang)
 * @Date: 2019-08-29
 * @LastEditors:  胡玉洋(Yuyang)
 * @LastEditTime: 2019-08-29
 * @QQ: 664927877
 * @Version: v0.0.8
 */
import { Component, Input, forwardRef, Output, EventEmitter } from '@angular/core';
import { NG_VALUE_ACCESSOR } from '@angular/forms';
import { IdService, CommonUtils } from '@farris/ui-common';
var FarrisCheckboxGroupComponent = /** @class */ (function () {
    function FarrisCheckboxGroupComponent(idSer, inject) {
        this.idSer = idSer;
        this.inject = inject;
        this.tabIndex = 0;
        /* radio 数组 */
        this.data = [];
        /* 分隔符 默认逗号*/
        this.separator = ',';
        /* 值类型是否是string */
        this.isStringValue = true;
        this.textField = 'name';
        this.valueField = 'value';
        this.changeValue = new EventEmitter();
        /* checkbox赋值事件 */
        this.setCheckboxData = new EventEmitter();
        this.controlChange = (/**
         * @return {?}
         */
        function () { });
        this.controlTouch = (/**
         * @return {?}
         */
        function () { });
        if (this.inject) {
            this.commonUtils = this.inject.get(CommonUtils);
        }
    }
    /**
     * @return {?}
     */
    FarrisCheckboxGroupComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        // 初始化name
        this.name = this.idSer.generate().replace(/-/g, '_');
        this.setCheckboxData.emit(this);
        // todo 取值可以实现promise
        if (this.loadData) {
            this.loadDataSubscription = this.loadData().subscribe((/**
             * @param {?} res
             * @return {?}
             */
            function (res) { return _this.data = res.data; }));
        }
    };
    /**
     * @param {?} changes
     * @return {?}
     */
    FarrisCheckboxGroupComponent.prototype.ngOnChanges = /**
     * @param {?} changes
     * @return {?}
     */
    function (changes) {
    };
    /**
     * @return {?}
     */
    FarrisCheckboxGroupComponent.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        if (this.loadDataSubscription) {
            this.loadDataSubscription.unsubscribe();
        }
    };
    /**
     * @param {?} item
     * @return {?}
     */
    FarrisCheckboxGroupComponent.prototype._getText = /**
     * @param {?} item
     * @return {?}
     */
    function (item) {
        if (item) {
            if (this.commonUtils && this.commonUtils.getValue) {
                return this.commonUtils.getValue(this.textField, item);
            }
            else {
                return item[this.textField];
            }
        }
        else {
            return '';
        }
    };
    /**
     * @param {?} item
     * @return {?}
     */
    FarrisCheckboxGroupComponent.prototype._getValue = /**
     * @param {?} item
     * @return {?}
     */
    function (item) {
        if (item) {
            if (this.commonUtils && this.commonUtils.getValue) {
                return this.commonUtils.getValue(this.valueField, item);
            }
            else {
                return item[this.valueField];
            }
        }
        else {
            return '';
        }
    };
    /* 选中input值 */
    /* 选中input值 */
    /**
     * @param {?} item
     * @param {?} index
     * @return {?}
     */
    FarrisCheckboxGroupComponent.prototype.clickHandler = /* 选中input值 */
    /**
     * @param {?} item
     * @param {?} index
     * @return {?}
     */
    function (item, index) {
        /** @type {?} */
        var arrValue = this.transformToArr(this.value) || [];
        /** @type {?} */
        var val = String(this._getValue(item));
        if (!arrValue || !arrValue.length) {
            arrValue.push(val);
        }
        else {
            if (arrValue.some((/**
             * @param {?} item
             * @return {?}
             */
            function (item) { return item == val; }))) {
                arrValue = arrValue.filter((/**
                 * @param {?} n
                 * @return {?}
                 */
                function (n) { return n !== val; }));
            }
            else {
                arrValue.push(val);
            }
        }
        // 更新value值
        this.value = this.transformToStr(arrValue);
        // 传值formcontrol
        this.controlChange(this.value);
        this.controlTouch(this.value);
        this.changeValue.emit(this.value);
    };
    /* 被选中 */
    /* 被选中 */
    /**
     * @param {?} item
     * @return {?}
     */
    FarrisCheckboxGroupComponent.prototype.checked = /* 被选中 */
    /**
     * @param {?} item
     * @return {?}
     */
    function (item) {
        /** @type {?} */
        var val = String(this._getValue(item));
        /** @type {?} */
        var checkedValue = this.transformToArr(this.value);
        // 多值
        return checkedValue.some((/**
         * @param {?} item
         * @return {?}
         */
        function (item) { return item == val; }));
    };
    /* 值到数组值的转换 */
    /* 值到数组值的转换 */
    /**
     * @param {?} value
     * @return {?}
     */
    FarrisCheckboxGroupComponent.prototype.transformToArr = /* 值到数组值的转换 */
    /**
     * @param {?} value
     * @return {?}
     */
    function (value) {
        if (!value) {
            return [];
        }
        if (!this.isStringValue) {
            return value;
        }
        return value.split(this.separator);
    };
    /* 值到字符串值的转换 */
    /* 值到字符串值的转换 */
    /**
     * @param {?} value
     * @return {?}
     */
    FarrisCheckboxGroupComponent.prototype.transformToStr = /* 值到字符串值的转换 */
    /**
     * @param {?} value
     * @return {?}
     */
    function (value) {
        var _this = this;
        /** @type {?} */
        var allVals = this.data.map((/**
         * @param {?} n
         * @return {?}
         */
        function (n) { return _this._getValue(n); }));
        /** @type {?} */
        var r = [];
        allVals.forEach((/**
         * @param {?} n
         * @return {?}
         */
        function (n) {
            if (value.some((/**
             * @param {?} item
             * @return {?}
             */
            function (item) { return item == n; }))) {
                r.push(n);
            }
        }));
        if (!this.isStringValue) {
            return r;
        }
        return r.join(this.separator);
    };
    /**
     * @param {?} value
     * @return {?}
     */
    FarrisCheckboxGroupComponent.prototype.writeValue = /**
     * @param {?} value
     * @return {?}
     */
    function (value) {
        this.value = value;
    };
    /* change操作值变化  方法重写*/
    /* change操作值变化  方法重写*/
    /**
     * @param {?} fn
     * @return {?}
     */
    FarrisCheckboxGroupComponent.prototype.registerOnChange = /* change操作值变化  方法重写*/
    /**
     * @param {?} fn
     * @return {?}
     */
    function (fn) {
        this.controlChange = fn;
    };
    /* blur值变化  方法重写*/
    /* blur值变化  方法重写*/
    /**
     * @param {?} fn
     * @return {?}
     */
    FarrisCheckboxGroupComponent.prototype.registerOnTouched = /* blur值变化  方法重写*/
    /**
     * @param {?} fn
     * @return {?}
     */
    function (fn) {
        this.controlTouch = fn;
    };
    FarrisCheckboxGroupComponent.decorators = [
        { type: Component, args: [{
                    selector: 'farris-checkboxgroup',
                    template: "<div class=\"farris-input-wrap\" [class.farris-checkradio-hor]=\"horizontal\">\r\n    <div class=\"custom-control custom-checkbox\" *ngFor=\"let item of data; let i = index\">\r\n        <input #input class=\"custom-control-input\" [name]=\"name\" id=\"{{ 'checkbox_' + name + i }}\"\r\n            type=\"checkbox\" [value]=\"_getValue(item)\" [checked]=\"checked(item)\" [disabled]=\"disable\" (click)=\"clickHandler(item, i)\" \r\n            tabindex=\"{{ tabIndex + i }}\" />\r\n        <label class=\"custom-control-label\" for=\"{{ 'checkbox_' + name + i }}\" title=\"{{_getText(item)}}\">{{ _getText(item) }}</label>\r\n    </div>\r\n</div>\r\n",
                    providers: [{
                            provide: NG_VALUE_ACCESSOR,
                            useExisting: forwardRef((/**
                             * @return {?}
                             */
                            function () { return FarrisCheckboxGroupComponent; })),
                            multi: true,
                        }],
                    exportAs: 'FarrisCheckboxGroupComponent'
                }] }
    ];
    /** @nocollapse */
    FarrisCheckboxGroupComponent.ctorParameters = function () { return [
        { type: IdService },
        { type: Injector, decorators: [{ type: Optional }] }
    ]; };
    FarrisCheckboxGroupComponent.propDecorators = {
        tabIndex: [{ type: Input, args: ['tab-index',] }],
        data: [{ type: Input }],
        type: [{ type: Input }],
        name: [{ type: Input }],
        horizontal: [{ type: Input }],
        separator: [{ type: Input }],
        disable: [{ type: Input }],
        value: [{ type: Input }],
        isStringValue: [{ type: Input }],
        textField: [{ type: Input }],
        valueField: [{ type: Input }],
        loadData: [{ type: Input }],
        changeValue: [{ type: Output }],
        setCheckboxData: [{ type: Output }]
    };
    return FarrisCheckboxGroupComponent;
}());
export { FarrisCheckboxGroupComponent };
if (false) {
    /** @type {?} */
    FarrisCheckboxGroupComponent.prototype.tabIndex;
    /** @type {?} */
    FarrisCheckboxGroupComponent.prototype.data;
    /** @type {?} */
    FarrisCheckboxGroupComponent.prototype.type;
    /** @type {?} */
    FarrisCheckboxGroupComponent.prototype.name;
    /** @type {?} */
    FarrisCheckboxGroupComponent.prototype.horizontal;
    /** @type {?} */
    FarrisCheckboxGroupComponent.prototype.separator;
    /** @type {?} */
    FarrisCheckboxGroupComponent.prototype.disable;
    /** @type {?} */
    FarrisCheckboxGroupComponent.prototype.value;
    /** @type {?} */
    FarrisCheckboxGroupComponent.prototype.isStringValue;
    /** @type {?} */
    FarrisCheckboxGroupComponent.prototype.textField;
    /** @type {?} */
    FarrisCheckboxGroupComponent.prototype.valueField;
    /**
     * 加载数据事件
     * @type {?}
     */
    FarrisCheckboxGroupComponent.prototype.loadData;
    /** @type {?} */
    FarrisCheckboxGroupComponent.prototype.loadDataSubscription;
    /** @type {?} */
    FarrisCheckboxGroupComponent.prototype.changeValue;
    /** @type {?} */
    FarrisCheckboxGroupComponent.prototype.setCheckboxData;
    /**
     * @type {?}
     * @private
     */
    FarrisCheckboxGroupComponent.prototype.commonUtils;
    /**
     * @type {?}
     * @private
     */
    FarrisCheckboxGroupComponent.prototype.controlChange;
    /**
     * @type {?}
     * @private
     */
    FarrisCheckboxGroupComponent.prototype.controlTouch;
    /**
     * @type {?}
     * @private
     */
    FarrisCheckboxGroupComponent.prototype.idSer;
    /**
     * @type {?}
     * @private
     */
    FarrisCheckboxGroupComponent.prototype.inject;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2hlY2tib3hncm91cC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL3VpLWZvcm1zLyIsInNvdXJjZXMiOlsibGliL2NoZWNrYm94L2NoZWNrYm94Z3JvdXAuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQXVDLFFBQVEsRUFBRSxRQUFRLEVBQUUsTUFBTSxlQUFlLENBQUM7Ozs7Ozs7OztBQVN4RixPQUFPLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBRSxVQUFVLEVBQVUsTUFBTSxFQUFFLFlBQVksRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUMzRixPQUFPLEVBQUUsaUJBQWlCLEVBQXdCLE1BQU0sZ0JBQWdCLENBQUM7QUFDekUsT0FBTyxFQUFFLFNBQVMsRUFBRSxXQUFXLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUkzRDtJQW9ESSxzQ0FBb0IsS0FBZ0IsRUFBc0IsTUFBZ0I7UUFBdEQsVUFBSyxHQUFMLEtBQUssQ0FBVztRQUFzQixXQUFNLEdBQU4sTUFBTSxDQUFVO1FBeEN0RCxhQUFRLEdBQUcsQ0FBQyxDQUFDOztRQUd4QixTQUFJLEdBQVUsRUFBRSxDQUFDOztRQVlqQixjQUFTLEdBQUcsR0FBRyxDQUFDOztRQVNoQixrQkFBYSxHQUFHLElBQUksQ0FBQztRQUVyQixjQUFTLEdBQUcsTUFBTSxDQUFDO1FBQ25CLGVBQVUsR0FBRyxPQUFPLENBQUM7UUFNcEIsZ0JBQVcsR0FBRyxJQUFJLFlBQVksRUFBTyxDQUFDOztRQUd0QyxvQkFBZSxHQUFHLElBQUksWUFBWSxFQUFPLENBQUM7UUFrSTVDLGtCQUFhOzs7UUFBeUIsY0FBUSxDQUFDLEVBQUM7UUFDaEQsaUJBQVk7OztRQUF5QixjQUFRLENBQUMsRUFBQztRQTlIbkQsSUFBSSxJQUFJLENBQUMsTUFBTSxFQUFFO1lBQ2IsSUFBSSxDQUFDLFdBQVcsR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxXQUFXLENBQUMs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R0wsS0FBSzt3QkFHTCxLQUFLO2dDQUdMLEtBQUs7NEJBRUwsS0FBSzs2QkFDTCxLQUFLOzJCQUdMLEtBQUs7OEJBR0wsTUFBTTtrQ0FHTixNQUFNOztJQXFJWCxtQ0FBQztDQUFBLEFBckxELElBcUxDO1NBM0tZLDRCQUE0Qjs7O0lBRXJDLGdEQUFpQzs7SUFHakMsNENBQTBCOztJQUcxQiw0Q0FBc0I7O0lBR3RCLDRDQUFzQjs7SUFHdEIsa0RBQTZCOztJQUc3QixpREFBeUI7O0lBR3pCLCtDQUEwQjs7SUFHMUIsNkNBQW9COztJQUdwQixxREFBOEI7O0lBRTlCLGlEQUE0Qjs7SUFDNUIsa0RBQThCOzs7OztJQUc5QixnREFBMEQ7O0lBQzFELDREQUFtQzs7SUFFbkMsbURBQWdEOztJQUdoRCx1REFBb0Q7Ozs7O0lBRXBELG1EQUFpQzs7Ozs7SUFnSWpDLHFEQUF3RDs7Ozs7SUFDeEQsb0RBQXVEOzs7OztJQS9IM0MsNkNBQXdCOzs7OztJQUFFLDhDQUFvQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE9uRGVzdHJveSwgU2ltcGxlQ2hhbmdlcywgT25DaGFuZ2VzLCBPcHRpb25hbCwgSW5qZWN0b3IgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuLypcclxuICogQEF1dGhvcjog6IOh546J5rSLKFl1eWFuZylcclxuICogQERhdGU6IDIwMTktMDgtMjlcclxuICogQExhc3RFZGl0b3JzOiAg6IOh546J5rSLKFl1eWFuZylcclxuICogQExhc3RFZGl0VGltZTogMjAxOS0wOC0yOVxyXG4gKiBAUVE6IDY2NDkyNzg3N1xyXG4gKiBAVmVyc2lvbjogdjAuMC44XHJcbiAqL1xyXG5pbXBvcnQgeyBDb21wb25lbnQsIElucHV0LCBmb3J3YXJkUmVmLCBPbkluaXQsIE91dHB1dCwgRXZlbnRFbWl0dGVyIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IE5HX1ZBTFVFX0FDQ0VTU09SLCBDb250cm9sVmFsdWVBY2Nlc3NvciB9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcclxuaW1wb3J0IHsgSWRTZXJ2aWNlLCBDb21tb25VdGlscyB9IGZyb20gJ0BmYXJyaXMvdWktY29tbW9uJztcclxuaW1wb3J0IHsgSHR0cENsaWVudCB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbi9odHRwJztcclxuaW1wb3J0IHsgT2JzZXJ2YWJsZSwgU3Vic2NyaXB0aW9uIH0gZnJvbSAncnhqcyc7XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICAgIHNlbGVjdG9yOiAnZmFycmlzLWNoZWNrYm94Z3JvdXAnLFxyXG4gICAgdGVtcGxhdGVVcmw6ICcuL2NoZWNrYm94Z3JvdXAuY29tcG9uZW50Lmh0bWwnLFxyXG4gICAgcHJvdmlkZXJzOiBbe1xyXG4gICAgICAgIHByb3ZpZGU6IE5HX1ZBTFVFX0FDQ0VTU09SLFxyXG4gICAgICAgIHVzZUV4aXN0aW5nOiBmb3J3YXJkUmVmKCgpID0+IEZhcnJpc0NoZWNrYm94R3JvdXBDb21wb25lbnQpLFxyXG4gICAgICAgIG11bHRpOiB0cnVlLFxyXG4gICAgfV0sXHJcbiAgICBleHBvcnRBczogJ0ZhcnJpc0NoZWNrYm94R3JvdXBDb21wb25lbnQnXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBGYXJyaXNDaGVja2JveEdyb3VwQ29tcG9uZW50IGltcGxlbWVudHMgQ29udHJvbFZhbHVlQWNjZXNzb3IsIE9uSW5pdCwgT25EZXN0cm95LCBPbkNoYW5nZXMge1xyXG5cclxuICAgIEBJbnB1dCgndGFiLWluZGV4JykgdGFiSW5kZXggPSAwO1xyXG5cclxuICAgIC8qIHJhZGlvIOaVsOe7hCAqL1xyXG4gICAgQElucHV0KCkgZGF0YTogYW55W10gPSBbXTtcclxuXHJcbiAgICAvKiBjaGVja2JveCDnsbvlnosgICDljp/nlJ/miJbogIXmjInpkq7nsbvlnosqL1xyXG4gICAgQElucHV0KCkgdHlwZTogc3RyaW5nO1xyXG5cclxuICAgIC8qIOWkjemAieahhm5hbWUgKi9cclxuICAgIEBJbnB1dCgpIG5hbWU6IHN0cmluZztcclxuXHJcbiAgICAvKiDmmK/lkKbmsLTlubPliIbluIMgKi9cclxuICAgIEBJbnB1dCgpIGhvcml6b250YWw6IGJvb2xlYW47XHJcblxyXG4gICAgLyog5YiG6ZqU56ymIOm7mOiupOmAl+WPtyovXHJcbiAgICBASW5wdXQoKSBzZXBhcmF0b3IgPSAnLCc7XHJcblxyXG4gICAgLyog56aB55SoICovXHJcbiAgICBASW5wdXQoKSBkaXNhYmxlOiBib29sZWFuO1xyXG5cclxuICAgIC8qIOWkjemAieahhue7hOeahOWAvCAqL1xyXG4gICAgQElucHV0KCkgdmFsdWU6IGFueTtcclxuXHJcbiAgICAvKiDlgLznsbvlnovmmK/lkKbmmK9zdHJpbmcgKi9cclxuICAgIEBJbnB1dCgpIGlzU3RyaW5nVmFsdWUgPSB0cnVlO1xyXG5cclxuICAgIEBJbnB1dCgpIHRleHRGaWVsZCA9ICduYW1lJztcclxuICAgIEBJbnB1dCgpIHZhbHVlRmllbGQgPSAndmFsdWUnO1xyXG5cclxuICAgIC8qKiDliqDovb3mlbDmja7kuovku7YgKi9cclxuICAgIEBJbnB1dCgpIGxvYWREYXRhOiAoZW1wdHlEYXRhPzogYW55W10pID0+IE9ic2VydmFibGU8YW55PjtcclxuICAgIGxvYWREYXRhU3Vic2NyaXB0aW9uOiBTdWJzY3JpcHRpb247XHJcblxyXG4gICAgQE91dHB1dCgpIGNoYW5nZVZhbHVlID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XHJcblxyXG4gICAgLyogY2hlY2tib3jotYvlgLzkuovku7YgKi9cclxuICAgIEBPdXRwdXQoKSBzZXRDaGVja2JveERhdGEgPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcclxuXHJcbiAgICBwcml2YXRlIGNvbW1vblV0aWxzOiBDb21tb25VdGlscztcclxuXHJcbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIGlkU2VyOiBJZFNlcnZpY2UsIEBPcHRpb25hbCgpIHByaXZhdGUgaW5qZWN0OiBJbmplY3Rvcikge1xyXG4gICAgICAgIGlmICh0aGlzLmluamVjdCkge1xyXG4gICAgICAgICAgICB0aGlzLmNvbW1vblV0aWxzID0gdGhpcy5pbmplY3QuZ2V0KENvbW1vblV0aWxzKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgbmdPbkluaXQoKSB7XHJcbiAgICAgICAgLy8g5Yid5aeL5YyWbmFtZVxyXG4gICAgICAgIHRoaXMubmFtZSA9IHRoaXMuaWRTZXIuZ2VuZXJhdGUoKS5yZXBsYWNlKC8tL2csICdfJyk7XHJcblxyXG4gICAgICAgIHRoaXMuc2V0Q2hlY2tib3hEYXRhLmVtaXQodGhpcyk7XHJcbiAgICAgICAgLy8gdG9kbyDlj5blgLzlj6/ku6Xlrp7njrBwcm9taXNlXHJcbiAgICAgICAgaWYgKHRoaXMubG9hZERhdGEpIHtcclxuICAgICAgICAgICAgdGhpcy5sb2FkRGF0YVN1YnNjcmlwdGlvbiA9IHRoaXMubG9hZERhdGEoKS5zdWJzY3JpYmUocmVzID0+IHRoaXMuZGF0YSA9IHJlcy5kYXRhKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcykge1xyXG4gICAgfVxyXG5cclxuICAgIG5nT25EZXN0cm95KCkge1xyXG4gICAgICAgIGlmICh0aGlzLmxvYWREYXRhU3Vic2NyaXB0aW9uKSB7XHJcbiAgICAgICAgICAgIHRoaXMubG9hZERhdGFTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgX2dldFRleHQoaXRlbSkge1xyXG4gICAgICAgIGlmIChpdGVtKSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmNvbW1vblV0aWxzICYmIHRoaXMuY29tbW9uVXRpbHMuZ2V0VmFsdWUpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmNvbW1vblV0aWxzLmdldFZhbHVlKHRoaXMudGV4dEZpZWxkLCBpdGVtKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBpdGVtW3RoaXMudGV4dEZpZWxkXTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiAnJztcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgX2dldFZhbHVlKGl0ZW0pIHtcclxuICAgICAgICBpZiAoaXRlbSkge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5jb21tb25VdGlscyAmJiB0aGlzLmNvbW1vblV0aWxzLmdldFZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5jb21tb25VdGlscy5nZXRWYWx1ZSh0aGlzLnZhbHVlRmllbGQsIGl0ZW0pO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGl0ZW1bdGhpcy52YWx1ZUZpZWxkXTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiAnJztcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLyog6YCJ5LitaW5wdXTlgLwgKi9cclxuICAgIGNsaWNrSGFuZGxlcihpdGVtOiBhbnksIGluZGV4OiBudW1iZXIpIHtcclxuICAgICAgICBsZXQgYXJyVmFsdWUgPSB0aGlzLnRyYW5zZm9ybVRvQXJyKHRoaXMudmFsdWUpIHx8IFtdO1xyXG5cclxuICAgICAgICBjb25zdCB2YWwgPSBTdHJpbmcodGhpcy5fZ2V0VmFsdWUoaXRlbSkpO1xyXG4gICAgICAgIGlmICghYXJyVmFsdWUgfHwgIWFyclZhbHVlLmxlbmd0aCkge1xyXG4gICAgICAgICAgICBhcnJWYWx1ZS5wdXNoKHZhbCk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgaWYgKGFyclZhbHVlLnNvbWUoaXRlbSA9PiBpdGVtID09IHZhbCkpIHtcclxuICAgICAgICAgICAgICAgIGFyclZhbHVlID0gYXJyVmFsdWUuZmlsdGVyKG4gPT4gbiAhPT0gdmFsKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGFyclZhbHVlLnB1c2godmFsKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8g5pu05pawdmFsdWXlgLxcclxuICAgICAgICB0aGlzLnZhbHVlID0gdGhpcy50cmFuc2Zvcm1Ub1N0cihhcnJWYWx1ZSk7XHJcblxyXG4gICAgICAgIC8vIOS8oOWAvGZvcm1jb250cm9sXHJcbiAgICAgICAgdGhpcy5jb250cm9sQ2hhbmdlKHRoaXMudmFsdWUpO1xyXG4gICAgICAgIHRoaXMuY29udHJvbFRvdWNoKHRoaXMudmFsdWUpO1xyXG4gICAgICAgIHRoaXMuY2hhbmdlVmFsdWUuZW1pdCh0aGlzLnZhbHVlKTtcclxuICAgIH1cclxuXHJcbiAgICAvKiDooqvpgInkuK0gKi9cclxuICAgIGNoZWNrZWQoaXRlbTogYW55KSB7XHJcbiAgICAgICAgY29uc3QgdmFsID0gU3RyaW5nKHRoaXMuX2dldFZhbHVlKGl0ZW0pKTtcclxuICAgICAgICBjb25zdCBjaGVja2VkVmFsdWUgPSB0aGlzLnRyYW5zZm9ybVRvQXJyKHRoaXMudmFsdWUpO1xyXG4gICAgICAgIC8vIOWkmuWAvFxyXG4gICAgICAgIHJldHVybiBjaGVja2VkVmFsdWUuc29tZShpdGVtID0+IGl0ZW0gPT0gdmFsKTtcclxuICAgIH1cclxuXHJcbiAgICAvKiDlgLzliLDmlbDnu4TlgLznmoTovazmjaIgKi9cclxuICAgIHRyYW5zZm9ybVRvQXJyKHZhbHVlOiBhbnkpOiBzdHJpbmdbXSB7XHJcbiAgICAgICAgaWYgKCF2YWx1ZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gW107XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICghdGhpcy5pc1N0cmluZ1ZhbHVlKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB2YWx1ZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiB2YWx1ZS5zcGxpdCh0aGlzLnNlcGFyYXRvcik7XHJcbiAgICB9XHJcblxyXG4gICAgLyog5YC85Yiw5a2X56ym5Liy5YC855qE6L2s5o2iICovXHJcbiAgICB0cmFuc2Zvcm1Ub1N0cih2YWx1ZTogQXJyYXk8c3RyaW5nPikge1xyXG5cclxuICAgICAgICBjb25zdCBhbGxWYWxzID0gdGhpcy5kYXRhLm1hcChuID0+IHRoaXMuX2dldFZhbHVlKG4pKTtcclxuICAgICAgICBjb25zdCByID0gW107XHJcbiAgICAgICAgYWxsVmFscy5mb3JFYWNoKG4gPT4ge1xyXG4gICAgICAgICAgICBpZiAodmFsdWUuc29tZShpdGVtID0+IGl0ZW0gPT0gbikpIHtcclxuICAgICAgICAgICAgICAgIHIucHVzaChuKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpZiAoIXRoaXMuaXNTdHJpbmdWYWx1ZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gcjtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHIuam9pbih0aGlzLnNlcGFyYXRvcik7XHJcbiAgICB9XHJcblxyXG5cclxuICAgIHdyaXRlVmFsdWUodmFsdWU6IGFueSk6IHZvaWQge1xyXG4gICAgICAgIHRoaXMudmFsdWUgPSB2YWx1ZTtcclxuICAgIH1cclxuXHJcbiAgICAvKiBjaGFuZ2Xmk43kvZzlgLzlj5jljJYgIOaWueazlemHjeWGmSovXHJcbiAgICByZWdpc3Rlck9uQ2hhbmdlKGZuOiAoKSA9PiB2b2lkKTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy5jb250cm9sQ2hhbmdlID0gZm47XHJcbiAgICB9XHJcblxyXG4gICAgLyogYmx1cuWAvOWPmOWMliAg5pa55rOV6YeN5YaZKi9cclxuICAgIHJlZ2lzdGVyT25Ub3VjaGVkKGZuOiAoKSA9PiB2b2lkKTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy5jb250cm9sVG91Y2ggPSBmbjtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGNvbnRyb2xDaGFuZ2U6ICh2YWx1ZTogYW55KSA9PiB2b2lkID0gKCkgPT4geyB9O1xyXG4gICAgcHJpdmF0ZSBjb250cm9sVG91Y2g6ICh2YWx1ZTogYW55KSA9PiB2b2lkID0gKCkgPT4geyB9O1xyXG5cclxufVxyXG4iXX0=
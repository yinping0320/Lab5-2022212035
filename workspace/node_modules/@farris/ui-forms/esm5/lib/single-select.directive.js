/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Directive, ElementRef, Injector, Input, NgZone, Renderer2 } from '@angular/core';
import { NgControl } from '@angular/forms';
import { OverLayHiddenService } from '@farris/ui-common';
import { of } from 'rxjs';
import { debounceTime } from 'rxjs/operators';
var SingleSelectDirective = /** @class */ (function () {
    function SingleSelectDirective(injector, elRef, render) {
        var _this = this;
        this.injector = injector;
        this.elRef = elRef;
        this.render = render;
        this.items = [];
        this.position = 'below';
        this.container = null;
        this.selectEl = null;
        this.overlayHandler = null;
        this.displayTextEl = null;
        this.ngZone = null;
        this.beforeShow = null;
        this.overlaySer = this.injector.get(OverLayHiddenService, new OverLayHiddenService());
        this.ngZone = this.injector.get(NgZone, null);
        if (this.overlaySer) {
            if (this.ngZone) {
                this.ngZone.runOutsideAngular((/**
                 * @return {?}
                 */
                function () {
                    _this.registerMouseEvent();
                }));
            }
            else {
                this.registerMouseEvent();
            }
        }
    }
    /**
     * @private
     * @return {?}
     */
    SingleSelectDirective.prototype.registerMouseEvent = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        this.overlayHandler = this.overlaySer.registerMouseEvent(this.elRef.nativeElement, (/**
         * @param {?} e
         * @return {?}
         */
        function (e) {
            if (!_this.panelRef.classList.contains('f-area-show')) {
                return;
            }
            if (_this.panelRef.contains(e.target)) {
                return;
            }
            if (_this.selectEl.contains(e.target)) {
                return;
            }
            _this.panelRef.classList.remove('f-area-show');
        }));
    };
    /**
     * @return {?}
     */
    SingleSelectDirective.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.ngCtrl = this.injector.get(NgControl);
        if (this.ngCtrl) {
            this.ngCtrl.valueChanges.subscribe((/**
             * @param {?} v
             * @return {?}
             */
            function (v) {
                _this.updateDisplayText();
            }));
        }
    };
    /**
     * @return {?}
     */
    SingleSelectDirective.prototype.ngAfterViewInit = /**
     * @return {?}
     */
    function () {
        var container = this.createMySelect().container;
        this.selectEl = container;
        this.elRef.nativeElement.style.display = 'none';
    };
    /**
     * @return {?}
     */
    SingleSelectDirective.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        if (this.overlayHandler) {
            this.overlayHandler();
        }
    };
    /**
     * @private
     * @return {?}
     */
    SingleSelectDirective.prototype.createMySelect = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        /** @type {?} */
        var selectContainerEl = document.createElement('div');
        selectContainerEl.className = 'input-group f-cmp-inputgroup';
        if (this.width) {
            selectContainerEl.style.width = this.width + "px";
        }
        selectContainerEl.style.userSelect = 'none';
        selectContainerEl.style.overflow = 'hidden';
        /** @type {?} */
        var selectTextEl = document.createElement('div');
        selectTextEl.className = 'form-control f-utils-fill text-left px-1 d-flex';
        selectTextEl.style.alignItems = 'center';
        selectTextEl.style.whiteSpace = 'nowrap';
        this.displayTextEl = selectTextEl;
        /** @type {?} */
        var selectArrowEl = document.createElement('div');
        selectArrowEl.className = 'input-group-append';
        selectArrowEl.innerHTML = "<span class=\"input-group-text\"><i class=\"f-icon f-icon-arrow-s\"></i></span>";
        selectContainerEl.appendChild(selectTextEl);
        selectContainerEl.appendChild(selectArrowEl);
        this.elRef.nativeElement.after(selectContainerEl);
        this.render.listen(selectContainerEl, 'click', (/**
         * @param {?} e
         * @return {?}
         */
        function (e) {
            if (_this.panelRef.classList.contains('f-area-show')) {
                _this.panelRef.classList.remove('f-area-show');
                return;
            }
            if (!_this.beforeShow) {
                _this.beforeShow = (/**
                 * @return {?}
                 */
                function () {
                    return of(true);
                });
            }
            _this.updatePosition();
            _this.beforeShow({ instance: _this }).pipe(debounceTime(10)).subscribe((/**
             * @param {?} r
             * @return {?}
             */
            function (r) {
                if (r) {
                    _this.panelRef.classList.add('f-area-show');
                }
            }));
        }));
        this.render.listen(this.panelRef, 'click', (/**
         * @param {?} e
         * @return {?}
         */
        function (e) {
            if (e.target.nodeName === 'LI') {
                /** @type {?} */
                var val = e.target.getAttribute('value');
                _this.ngCtrl.control.setValue(val);
                _this.panelRef.classList.remove('f-area-show');
                selectTextEl.innerHTML = e.target.innerHTML;
            }
        }));
        this.panelRef.style.cssText = "\n        position:fixed;z-index: 100;\n        box-shadow: 0 2px 8px 0 rgba(0,0,0,.15);\n        border-radius: 3px;max-height:300px;overflow:auto;\n        transition: all 0.08s linear;";
        this.panelRef.querySelector('ul').style.cssText = "position:relative;min-width: 100%;border:none; box-shadow: none;";
        this.updateDisplayText();
        return { container: selectContainerEl };
    };
    /**
     * @private
     * @return {?}
     */
    SingleSelectDirective.prototype.updateDisplayText = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        setTimeout((/**
         * @return {?}
         */
        function () {
            /** @type {?} */
            var li = _this.panelRef.querySelector("[value=\"" + _this.ngCtrl.value + "\"]");
            _this.displayTextEl.innerHTML = li ? li.innerHTML : '';
            if (_this.items && !_this.items.length) {
                /** @type {?} */
                var item = _this.items.find((/**
                 * @param {?} n
                 * @return {?}
                 */
                function (n) { return n.value == _this.ngCtrl.value; }));
                if (item) {
                    _this.displayTextEl.innerHTML = item.label;
                }
            }
            _this.displayTextEl.title = _this.displayTextEl.innerText;
        }));
    };
    /**
     * @private
     * @return {?}
     */
    SingleSelectDirective.prototype.updatePosition = /**
     * @private
     * @return {?}
     */
    function () {
        /** @type {?} */
        var ul = this.panelRef.querySelector('ul');
        if (this.position === 'above') {
            ul.style.position = 'relative';
            /** @type {?} */
            var t = this.selectEl.offsetTop - ul.offsetHeight - 6;
            /** @type {?} */
            var top_1 = t + "px";
            this.panelRef.style.top = top_1;
            this.panelRef.style.transformOrigin = 'bottom';
        }
        else {
            this.panelRef.style.top = 'auto';
            if (this.container) {
                this.panelRef.style.top = (this.panelRef.offsetTop - this.container.scrollTop) + 'px';
            }
        }
        // if ( this.selectEl.offsetLeft) {
        //     this.panelRef.style.left = this.selectEl.offsetLeft + 'px';
        // }
        if (!this.width) {
            this.panelRef.style.width = this.selectEl.offsetWidth + 'px';
            ul.style.width = '100%';
        }
        else {
            this.panelRef.style.width = this.width + 'px';
        }
    };
    SingleSelectDirective.decorators = [
        { type: Directive, args: [{
                    selector: '[single-select]',
                    exportAs: 'singleSelect'
                },] }
    ];
    /** @nocollapse */
    SingleSelectDirective.ctorParameters = function () { return [
        { type: Injector },
        { type: ElementRef },
        { type: Renderer2 }
    ]; };
    SingleSelectDirective.propDecorators = {
        items: [{ type: Input }],
        panelRef: [{ type: Input }],
        width: [{ type: Input }],
        position: [{ type: Input }],
        container: [{ type: Input }]
    };
    return SingleSelectDirective;
}());
export { SingleSelectDirective };
if (false) {
    /** @type {?} */
    SingleSelectDirective.prototype.items;
    /** @type {?} */
    SingleSelectDirective.prototype.panelRef;
    /** @type {?} */
    SingleSelectDirective.prototype.width;
    /** @type {?} */
    SingleSelectDirective.prototype.position;
    /** @type {?} */
    SingleSelectDirective.prototype.container;
    /**
     * @type {?}
     * @private
     */
    SingleSelectDirective.prototype.ngCtrl;
    /**
     * @type {?}
     * @private
     */
    SingleSelectDirective.prototype.overlaySer;
    /** @type {?} */
    SingleSelectDirective.prototype.selectEl;
    /**
     * @type {?}
     * @private
     */
    SingleSelectDirective.prototype.overlayHandler;
    /**
     * @type {?}
     * @private
     */
    SingleSelectDirective.prototype.displayTextEl;
    /**
     * @type {?}
     * @private
     */
    SingleSelectDirective.prototype.ngZone;
    /** @type {?} */
    SingleSelectDirective.prototype.beforeShow;
    /**
     * @type {?}
     * @private
     */
    SingleSelectDirective.prototype.injector;
    /**
     * @type {?}
     * @private
     */
    SingleSelectDirective.prototype.elRef;
    /**
     * @type {?}
     * @private
     */
    SingleSelectDirective.prototype.render;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2luZ2xlLXNlbGVjdC5kaXJlY3RpdmUuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL3VpLWZvcm1zLyIsInNvdXJjZXMiOlsibGliL3NpbmdsZS1zZWxlY3QuZGlyZWN0aXZlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQWlCLFNBQVMsRUFBRSxVQUFVLEVBQUUsUUFBUSxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQXFCLFNBQVMsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUM1SCxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDM0MsT0FBTyxFQUFFLG9CQUFvQixFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFDekQsT0FBTyxFQUFjLEVBQUUsRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUN0QyxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFFOUM7SUFtQkksK0JBQW9CLFFBQWtCLEVBQVUsS0FBaUIsRUFBVSxNQUFpQjtRQUE1RixpQkFhQztRQWJtQixhQUFRLEdBQVIsUUFBUSxDQUFVO1FBQVUsVUFBSyxHQUFMLEtBQUssQ0FBWTtRQUFVLFdBQU0sR0FBTixNQUFNLENBQVc7UUFkbkYsVUFBSyxHQUE0QyxFQUFFLENBQUM7UUFHcEQsYUFBUSxHQUFvQixPQUFPLENBQUM7UUFDcEMsY0FBUyxHQUFHLElBQUksQ0FBQztRQUcxQixhQUFRLEdBQUcsSUFBSSxDQUFDO1FBQ1IsbUJBQWMsR0FBRyxJQUFJLENBQUM7UUFDdEIsa0JBQWEsR0FBRyxJQUFJLENBQUM7UUFDckIsV0FBTSxHQUFXLElBQUksQ0FBQztRQUU5QixlQUFVLEdBQXFDLElBQUksQ0FBQztRQUdoRCxJQUFJLENBQUMsVUFBVSxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLG9CQUFvQixFQUFFLElBQUksb0JBQW9CLEVBQUUsQ0FBQyxDQUFDO1FBQ3RGLElBQUksQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFD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QUMsU0FBUyxDQUFDLFNBQVMsQ0FBQyxHQUFHLElBQUksQ0FBQzthQUN6RjtTQUNKO1FBRUQsbUNBQW1DO1FBQ25DLGtFQUFrRTtRQUNsRSxJQUFJO1FBRUosSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLEVBQUU7WUFDYixJQUFJLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxXQUFXLEdBQUcsSUFBSSxDQUFDO1lBQzdELEVBQUUsQ0FBQyxLQUFLLENBQUMsS0FBSyxHQUFHLE1BQU0sQ0FBQztTQUMzQjthQUFNO1lBQ0gsSUFBSSxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDO1NBQ2pEO0lBRUwsQ0FBQzs7Z0JBOUxKLFNBQVMsU0FBQztvQkFDUCxRQUFRLEVBQUUsaUJBQWlCO29CQUMzQixRQUFRLEVBQUUsY0FBYztpQkFDM0I7Ozs7Z0JBVDhDLFFBQVE7Z0JBQXBCLFVBQVU7Z0JBQThDLFNBQVM7Ozt3QkFXL0YsS0FBSzsyQkFDTCxLQUFLO3dCQUNMLEtBQUs7MkJBQ0wsS0FBSzs0QkFDTCxLQUFLOztJQXVMViw0QkFBQztDQUFBLEFBaE1ELElBZ01DO1NBNUxZLHFCQUFxQjs7O0lBQzlCLHNDQUE2RDs7SUFDN0QseUNBQStCOztJQUMvQixzQ0FBdUI7O0lBQ3ZCLHlDQUE2Qzs7SUFDN0MsMENBQTBCOzs7OztJQUMxQix1Q0FBMEI7Ozs7O0lBQzFCLDJDQUF5Qzs7SUFDekMseUNBQWdCOzs7OztJQUNoQiwrQ0FBOEI7Ozs7O0lBQzlCLDhDQUE2Qjs7Ozs7SUFDN0IsdUNBQThCOztJQUU5QiwyQ0FBb0Q7Ozs7O0lBRXhDLHlDQUEwQjs7Ozs7SUFBRSxzQ0FBeUI7Ozs7O0lBQUUsdUNBQXlCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQWZ0ZXJWaWV3SW5pdCwgRGlyZWN0aXZlLCBFbGVtZW50UmVmLCBJbmplY3RvciwgSW5wdXQsIE5nWm9uZSwgT25EZXN0cm95LCBPbkluaXQsIFJlbmRlcmVyMiB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBOZ0NvbnRyb2wgfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XHJcbmltcG9ydCB7IE92ZXJMYXlIaWRkZW5TZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy91aS1jb21tb24nO1xyXG5pbXBvcnQgeyBPYnNlcnZhYmxlLCBvZiB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQgeyBkZWJvdW5jZVRpbWUgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XHJcblxyXG5ARGlyZWN0aXZlKHsgXHJcbiAgICBzZWxlY3RvcjogJ1tzaW5nbGUtc2VsZWN0XScsXHJcbiAgICBleHBvcnRBczogJ3NpbmdsZVNlbGVjdCdcclxufSlcclxuZXhwb3J0IGNsYXNzIFNpbmdsZVNlbGVjdERpcmVjdGl2ZSBpbXBsZW1lbnRzIE9uSW5pdCwgQWZ0ZXJWaWV3SW5pdCwgT25EZXN0cm95IHtcclxuICAgIEBJbnB1dCgpIGl0ZW1zOiBBcnJheTx7IGxhYmVsOiBzdHJpbmcsIHZhbHVlOiBzdHJpbmcgfT4gPSBbXTtcclxuICAgIEBJbnB1dCgpIHBhbmVsUmVmOiBIVE1MRWxlbWVudDtcclxuICAgIEBJbnB1dCgpIHdpZHRoOiBudW1iZXI7XHJcbiAgICBASW5wdXQoKSBwb3NpdGlvbjogJ2Fib3ZlJ3wnYmVsb3cnID0gJ2JlbG93JztcclxuICAgIEBJbnB1dCgpIGNvbnRhaW5lciA9IG51bGw7XHJcbiAgICBwcml2YXRlIG5nQ3RybDogTmdDb250cm9sO1xyXG4gICAgcHJpdmF0ZSBvdmVybGF5U2VyOiBPdmVyTGF5SGlkZGVuU2VydmljZTtcclxuICAgIHNlbGVjdEVsID0gbnVsbDtcclxuICAgIHByaXZhdGUgb3ZlcmxheUhhbmRsZXIgPSBudWxsO1xyXG4gICAgcHJpdmF0ZSBkaXNwbGF5VGV4dEVsID0gbnVsbDtcclxuICAgIHByaXZhdGUgbmdab25lOiBOZ1pvbmUgPSBudWxsO1xyXG5cclxuICAgIGJlZm9yZVNob3c6IChlPzogYW55KSA9PiBPYnNlcnZhYmxlPGJvb2xlYW4+ID0gbnVsbDtcclxuXHJcbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIGluamVjdG9yOiBJbmplY3RvciwgcHJpdmF0ZSBlbFJlZjogRWxlbWVudFJlZiwgcHJpdmF0ZSByZW5kZXI6IFJlbmRlcmVyMikge1xyXG4gICAgICAgIHRoaXMub3ZlcmxheVNlciA9IHRoaXMuaW5qZWN0b3IuZ2V0KE92ZXJMYXlIaWRkZW5TZXJ2aWNlLCBuZXcgT3ZlckxheUhpZGRlblNlcnZpY2UoKSk7XHJcbiAgICAgICAgdGhpcy5uZ1pvbmUgPSB0aGlzLmluamVjdG9yLmdldChOZ1pvbmUsIG51bGwpO1xyXG4gICAgICAgIGlmICh0aGlzLm92ZXJsYXlTZXIpIHtcclxuXHJcbiAgICAgICAgICAgIGlmICh0aGlzLm5nWm9uZSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5uZ1pvbmUucnVuT3V0c2lkZUFuZ3VsYXIoKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMucmVnaXN0ZXJNb3VzZUV2ZW50KCk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRoaXMucmVnaXN0ZXJNb3VzZUV2ZW50KCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSByZWdpc3Rlck1vdXNlRXZlbnQoKSB7XHJcbiAgICAgICAgdGhpcy5vdmVybGF5SGFuZGxlciA9IHRoaXMub3ZlcmxheVNlci5yZWdpc3Rlck1vdXNlRXZlbnQodGhpcy5lbFJlZi5uYXRpdmVFbGVtZW50LCAoZSkgPT4ge1xyXG4gICAgICAgICAgICBpZiAoIXRoaXMucGFuZWxSZWYuY2xhc3NMaXN0LmNvbnRhaW5zKCdmLWFyZWEtc2hvdycpKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmICh0aGlzLnBhbmVsUmVmLmNvbnRhaW5zKGUudGFyZ2V0KSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAodGhpcy5zZWxlY3RFbC5jb250YWlucyhlLnRhcmdldCkpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdGhpcy5wYW5lbFJlZi5jbGFzc0xpc3QucmVtb3ZlKCdmLWFyZWEtc2hvdycpO1xyXG4gICAgICAgIH0pOyBcclxuICAgIH1cclxuXHJcbiAgICBuZ09uSW5pdCgpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLm5nQ3RybCA9IHRoaXMuaW5qZWN0b3IuZ2V0KE5nQ29udHJvbCk7XHJcblxyXG4gICAgICAgIGlmICh0aGlzLm5nQ3RybCkge1xyXG4gICAgICAgICAgICB0aGlzLm5nQ3RybC52YWx1ZUNoYW5nZXMuc3Vic2NyaWJlKCh2OiBhbnkpID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlRGlzcGxheVRleHQoKTtcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG5cclxuICAgIG5nQWZ0ZXJWaWV3SW5pdCgpOiB2b2lkIHtcclxuICAgICAgICBjb25zdCB7IGNvbnRhaW5lciAgfSA9IHRoaXMuY3JlYXRlTXlTZWxlY3QoKTtcclxuICAgICAgICB0aGlzLnNlbGVjdEVsID0gY29udGFpbmVyO1xyXG4gICAgICAgIHRoaXMuZWxSZWYubmF0aXZlRWxlbWVudC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xyXG4gICAgfVxyXG5cclxuICAgIG5nT25EZXN0cm95KCkge1xyXG4gICAgICAgIGlmICh0aGlzLm92ZXJsYXlIYW5kbGVyKSB7XHJcbiAgICAgICAgICAgIHRoaXMub3ZlcmxheUhhbmRsZXIoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBjcmVhdGVNeVNlbGVjdCgpIHtcclxuICAgICAgICBjb25zdCBzZWxlY3RDb250YWluZXJFbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICAgICAgIHNlbGVjdENvbnRhaW5lckVsLmNsYXNzTmFtZSA9ICdpbnB1dC1ncm91cCBmLWNtcC1pbnB1dGdyb3VwJztcclxuICAgICAgICBpZiAodGhpcy53aWR0aCkge1xyXG4gICAgICAgICAgICBzZWxlY3RDb250YWluZXJFbC5zdHlsZS53aWR0aCA9IGAke3RoaXMud2lkdGh9cHhgO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgc2VsZWN0Q29udGFpbmVyRWwuc3R5bGUudXNlclNlbGVjdCA9ICdub25lJztcclxuICAgICAgICBzZWxlY3RDb250YWluZXJFbC5zdHlsZS5vdmVyZmxvdyA9ICdoaWRkZW4nO1xyXG5cclxuICAgICAgICBjb25zdCBzZWxlY3RUZXh0RWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICAgICAgICBzZWxlY3RUZXh0RWwuY2xhc3NOYW1lID0gJ2Zvcm0tY29udHJvbCBmLXV0aWxzLWZpbGwgdGV4dC1sZWZ0IHB4LTEgZC1mbGV4JztcclxuICAgICAgICBzZWxlY3RUZXh0RWwuc3R5bGUuYWxpZ25JdGVtcyA9ICdjZW50ZXInO1xyXG4gICAgICAgIHNlbGVjdFRleHRFbC5zdHlsZS53aGl0ZVNwYWNlID0gJ25vd3JhcCc7XHJcbiAgICAgICAgdGhpcy5kaXNwbGF5VGV4dEVsID0gc2VsZWN0VGV4dEVsO1xyXG5cclxuICAgICAgICBjb25zdCBzZWxlY3RBcnJvd0VsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgICAgICAgc2VsZWN0QXJyb3dFbC5jbGFzc05hbWUgPSAnaW5wdXQtZ3JvdXAtYXBwZW5kJztcclxuICAgICAgICBzZWxlY3RBcnJvd0VsLmlubmVySFRNTCA9IGA8c3BhbiBjbGFzcz1cImlucHV0LWdyb3VwLXRleHRcIj48aSBjbGFzcz1cImYtaWNvbiBmLWljb24tYXJyb3ctc1wiPjwvaT48L3NwYW4+YDtcclxuXHJcbiAgICAgICAgc2VsZWN0Q29udGFpbmVyRWwuYXBwZW5kQ2hpbGQoc2VsZWN0VGV4dEVsKTtcclxuICAgICAgICBzZWxlY3RDb250YWluZXJFbC5hcHBlbmRDaGlsZChzZWxlY3RBcnJvd0VsKTtcclxuXHJcblxyXG4gICAgICAgIHRoaXMuZWxSZWYubmF0aXZlRWxlbWVudC5hZnRlcihzZWxlY3RDb250YWluZXJFbCk7XHJcblxyXG5cclxuXHJcbiAgICAgICAgdGhpcy5yZW5kZXIubGlzdGVuKHNlbGVjdENvbnRhaW5lckVsLCAnY2xpY2snLCAoZSkgPT4ge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5wYW5lbFJlZi5jbGFzc0xpc3QuY29udGFpbnMoJ2YtYXJlYS1zaG93JykpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMucGFuZWxSZWYuY2xhc3NMaXN0LnJlbW92ZSgnZi1hcmVhLXNob3cnKTtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKCF0aGlzLmJlZm9yZVNob3cpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuYmVmb3JlU2hvdyA9ICgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gb2YodHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHRoaXMudXBkYXRlUG9zaXRpb24oKTtcclxuICAgICAgICAgICAgdGhpcy5iZWZvcmVTaG93KHtpbnN0YW5jZTogdGhpc30pLnBpcGUoXHJcbiAgICAgICAgICAgICAgICBkZWJvdW5jZVRpbWUoMTApXHJcbiAgICAgICAgICAgICkuc3Vic2NyaWJlKHIgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKHIpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnBhbmVsUmVmLmNsYXNzTGlzdC5hZGQoJ2YtYXJlYS1zaG93Jyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICB0aGlzLnJlbmRlci5saXN0ZW4odGhpcy5wYW5lbFJlZiwgJ2NsaWNrJywgKGUpID0+IHtcclxuICAgICAgICAgICAgaWYgKGUudGFyZ2V0Lm5vZGVOYW1lID09PSAnTEknKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCB2YWwgPSBlLnRhcmdldC5nZXRBdHRyaWJ1dGUoJ3ZhbHVlJyk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLm5nQ3RybC5jb250cm9sLnNldFZhbHVlKHZhbCk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnBhbmVsUmVmLmNsYXNzTGlzdC5yZW1vdmUoJ2YtYXJlYS1zaG93Jyk7XHJcbiAgICAgICAgICAgICAgICBzZWxlY3RUZXh0RWwuaW5uZXJIVE1MID0gZS50YXJnZXQuaW5uZXJIVE1MO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHRoaXMucGFuZWxSZWYuc3R5bGUuY3NzVGV4dCA9IGBcclxuICAgICAgICBwb3NpdGlvbjpmaXhlZDt6LWluZGV4OiAxMDA7XHJcbiAgICAgICAgYm94LXNoYWRvdzogMCAycHggOHB4IDAgcmdiYSgwLDAsMCwuMTUpO1xyXG4gICAgICAgIGJvcmRlci1yYWRpdXM6IDNweDttYXgtaGVpZ2h0OjMwMHB4O292ZXJmbG93OmF1dG87XHJcbiAgICAgICAgdHJhbnNpdGlvbjogYWxsIDAuMDhzIGxpbmVhcjtgO1xyXG5cclxuICAgICAgICB0aGlzLnBhbmVsUmVmLnF1ZXJ5U2VsZWN0b3IoJ3VsJykuc3R5bGUuY3NzVGV4dCA9IGBwb3NpdGlvbjpyZWxhdGl2ZTttaW4td2lkdGg6IDEwMCU7Ym9yZGVyOm5vbmU7IGJveC1zaGFkb3c6IG5vbmU7YDtcclxuICAgICAgICBcclxuICAgICAgICB0aGlzLnVwZGF0ZURpc3BsYXlUZXh0KCk7XHJcblxyXG4gICAgICAgIHJldHVybiB7IGNvbnRhaW5lcjogc2VsZWN0Q29udGFpbmVyRWwgfTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHVwZGF0ZURpc3BsYXlUZXh0KCkge1xyXG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG5cclxuICAgICAgICAgICAgY29uc3QgbGkgPSB0aGlzLnBhbmVsUmVmLnF1ZXJ5U2VsZWN0b3IoYFt2YWx1ZT1cIiR7dGhpcy5uZ0N0cmwudmFsdWV9XCJdYCk7XHJcbiAgICAgICAgICAgIHRoaXMuZGlzcGxheVRleHRFbC5pbm5lckhUTUwgPSBsaSA/IGxpLmlubmVySFRNTCA6ICcnO1xyXG5cclxuICAgICAgICAgICAgaWYgKHRoaXMuaXRlbXMgJiYgIXRoaXMuaXRlbXMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBpdGVtID0gdGhpcy5pdGVtcy5maW5kKG4gPT4gbi52YWx1ZSA9PSB0aGlzLm5nQ3RybC52YWx1ZSk7XHJcbiAgICAgICAgICAgICAgICBpZiAoaXRlbSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGlzcGxheVRleHRFbC5pbm5lckhUTUwgPSBpdGVtLmxhYmVsO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB0aGlzLmRpc3BsYXlUZXh0RWwudGl0bGUgPSB0aGlzLmRpc3BsYXlUZXh0RWwuaW5uZXJUZXh0O1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgdXBkYXRlUG9zaXRpb24oKSB7XHJcbiAgICAgICAgY29uc3QgdWw6IGFueSA9IHRoaXMucGFuZWxSZWYucXVlcnlTZWxlY3RvcigndWwnKTtcclxuICAgICAgICBpZiAodGhpcy5wb3NpdGlvbiA9PT0gJ2Fib3ZlJykge1xyXG4gICAgICAgICAgICB1bC5zdHlsZS5wb3NpdGlvbiA9ICdyZWxhdGl2ZSc7XHJcbiAgICAgICAgICAgIGNvbnN0IHQgPSB0aGlzLnNlbGVjdEVsLm9mZnNldFRvcCAtIHVsLm9mZnNldEhlaWdodCAtIDY7XHJcbiAgICAgICAgICAgIGNvbnN0IHRvcCA9IGAke3R9cHhgO1xyXG4gICAgICAgICAgICB0aGlzLnBhbmVsUmVmLnN0eWxlLnRvcCA9IHRvcDtcclxuICAgICAgICAgICAgdGhpcy5wYW5lbFJlZi5zdHlsZS50cmFuc2Zvcm1PcmlnaW4gPSAnYm90dG9tJztcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLnBhbmVsUmVmLnN0eWxlLnRvcCA9ICdhdXRvJztcclxuICAgICAgICAgICAgaWYgKHRoaXMuY29udGFpbmVyKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnBhbmVsUmVmLnN0eWxlLnRvcCA9ICh0aGlzLnBhbmVsUmVmLm9mZnNldFRvcCAtIHRoaXMuY29udGFpbmVyLnNjcm9sbFRvcCkgKyAncHgnO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBpZiAoIHRoaXMuc2VsZWN0RWwub2Zmc2V0TGVmdCkge1xyXG4gICAgICAgIC8vICAgICB0aGlzLnBhbmVsUmVmLnN0eWxlLmxlZnQgPSB0aGlzLnNlbGVjdEVsLm9mZnNldExlZnQgKyAncHgnO1xyXG4gICAgICAgIC8vIH1cclxuXHJcbiAgICAgICAgaWYgKCF0aGlzLndpZHRoKSB7XHJcbiAgICAgICAgICAgIHRoaXMucGFuZWxSZWYuc3R5bGUud2lkdGggPSB0aGlzLnNlbGVjdEVsLm9mZnNldFdpZHRoICsgJ3B4JztcclxuICAgICAgICAgICAgdWwuc3R5bGUud2lkdGggPSAnMTAwJSc7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5wYW5lbFJlZi5zdHlsZS53aWR0aCA9IHRoaXMud2lkdGggKyAncHgnO1xyXG4gICAgICAgIH1cclxuICAgICAgIFxyXG4gICAgfVxyXG4gICBcclxufSJdfQ==
/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Directive, Input, Injector, ElementRef, HostListener } from '@angular/core';
import { NgControl } from '@angular/forms';
var TextareaAutoSizeDirective = /** @class */ (function () {
    function TextareaAutoSizeDirective(el, ngControl, injector) {
        this.el = el;
        this.ngControl = ngControl;
        this.injector = injector;
        this.enable = true;
        this.previousValue = null;
        this.isUserResized = false;
        this.textarea = this.el.nativeElement;
    }
    /**
     * @return {?}
     */
    TextareaAutoSizeDirective.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        this.init();
    };
    /**
     * @param {?} changes
     * @return {?}
     */
    TextareaAutoSizeDirective.prototype.ngOnChanges = /**
     * @param {?} changes
     * @return {?}
     */
    function (changes) {
        if (changes.enable && !changes.enable.isFirstChange()) {
            this.sizeToFit();
        }
    };
    /**
     * @return {?}
     */
    TextareaAutoSizeDirective.prototype.ngAfterViewInit = /**
     * @return {?}
     */
    function () {
        if (!this.enable) {
            return;
        }
        if (this.maxHeight) {
            this.textarea.style.maxHeight = this.maxHeight + "px";
        }
        this.minHeight = this.textarea.getBoundingClientRect().height;
        if (this.minHeight) {
            this.textarea.style.minHeight = this.minHeight + "px";
        }
    };
    /**
     * @private
     * @return {?}
     */
    TextareaAutoSizeDirective.prototype.init = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        if (this.enable) {
            this.document = this.textarea.ownerDocument;
            this.documentElement = this.document.documentElement;
            if (this.textarea) {
                if (this.textarea.value) {
                    this.sizeToFit();
                }
            }
            if (this.ngControl) {
                this.ngControl.valueChanges.subscribe((/**
                 * @param {?} v
                 * @return {?}
                 */
                function (v) {
                    if (v !== _this.previousValue) {
                        _this.sizeToFit();
                    }
                }));
            }
        }
    };
    /**
     * @return {?}
     */
    TextareaAutoSizeDirective.prototype.onInput = /**
     * @return {?}
     */
    function () {
        this.sizeToFit();
    };
    /**
     * @return {?}
     */
    TextareaAutoSizeDirective.prototype.onValueChange = /**
     * @return {?}
     */
    function () {
        this.sizeToFit();
    };
    /**
     * @private
     * @return {?}
     */
    TextareaAutoSizeDirective.prototype.overflowOffset = /**
     * @private
     * @return {?}
     */
    function () {
        /** @type {?} */
        var offsetTop = 0;
        /** @type {?} */
        var el = this.textarea;
        while (el !== document.body && el !== null) {
            offsetTop += el.offsetTop || 0;
            el = el.offsetParent;
        }
        /** @type {?} */
        var top = offsetTop - document.defaultView.pageYOffset;
        /** @type {?} */
        var bottom = this.documentElement.clientHeight - (top + this.textarea.offsetHeight);
        return { top: top, bottom: bottom };
    };
    /**
     * @private
     * @return {?}
     */
    TextareaAutoSizeDirective.prototype.sizeToFit = /**
     * @private
     * @return {?}
     */
    function () {
        if (!this.enable) {
            return;
        }
        /** @type {?} */
        var textarea = this.textarea;
        /** @type {?} */
        var viewportMarginBottom = 100;
        if (this.isUserResized) {
            return;
        }
        if (this.textarea.value === this.previousValue) {
            return;
        }
        if (this.textarea.offsetWidth <= 0 && this.textarea.offsetHeight <= 0) {
            return;
        }
        // const { top, bottom } = this.overflowOffset();
        // if (top < 0 || bottom < 0) {
        //     return;
        // }
        /** @type {?} */
        var textareaStyle = getComputedStyle(textarea);
        /** @type {?} */
        var topBorderWidth = Number(textareaStyle.borderTopWidth.replace(/px/, ''));
        /** @type {?} */
        var bottomBorderWidth = Number(textareaStyle.borderBottomWidth.replace(/px/, ''));
        /** @type {?} */
        var isBorderBox = textareaStyle.boxSizing === 'border-box';
        /** @type {?} */
        var borderAddOn = isBorderBox ? topBorderWidth + bottomBorderWidth : 0;
        // const maxHeight = Number(textareaStyle.height.replace(/px/, '')) + bottom;
        // const adjustedViewportMarginBottom = bottom < viewportMarginBottom ? bottom : viewportMarginBottom;
        // textarea.style.maxHeight = `${maxHeight - adjustedViewportMarginBottom}px`;
        /** @type {?} */
        var container = textarea.parentElement;
        if (container instanceof HTMLElement) {
            /** @type {?} */
            var containerHeight = container.style.height;
            container.style.height = getComputedStyle(container).height;
            textarea.style.height = 'auto';
            /** @type {?} */
            var h = textarea.scrollHeight + borderAddOn;
            if (this.minHeight > h) {
                h = this.minHeight;
            }
            textarea.style.height = h + "px";
            container.style.height = containerHeight;
        }
        this.previousValue = textarea.value;
    };
    TextareaAutoSizeDirective.decorators = [
        { type: Directive, args: [{
                    selector: '[auto-size]',
                },] }
    ];
    /** @nocollapse */
    TextareaAutoSizeDirective.ctorParameters = function () { return [
        { type: ElementRef },
        { type: NgControl },
        { type: Injector }
    ]; };
    TextareaAutoSizeDirective.propDecorators = {
        enable: [{ type: Input, args: ['auto-size',] }],
        maxHeight: [{ type: Input }],
        onInput: [{ type: HostListener, args: ['input',] }],
        onValueChange: [{ type: HostListener, args: ['change',] }]
    };
    return TextareaAutoSizeDirective;
}());
export { TextareaAutoSizeDirective };
if (false) {
    /** @type {?} */
    TextareaAutoSizeDirective.prototype.enable;
    /** @type {?} */
    TextareaAutoSizeDirective.prototype.maxHeight;
    /**
     * @type {?}
     * @private
     */
    TextareaAutoSizeDirective.prototype.previousValue;
    /**
     * @type {?}
     * @private
     */
    TextareaAutoSizeDirective.prototype.isUserResized;
    /**
     * @type {?}
     * @private
     */
    TextareaAutoSizeDirective.prototype.textarea;
    /**
     * @type {?}
     * @private
     */
    TextareaAutoSizeDirective.prototype.document;
    /**
     * @type {?}
     * @private
     */
    TextareaAutoSizeDirective.prototype.documentElement;
    /**
     * @type {?}
     * @private
     */
    TextareaAutoSizeDirective.prototype.minHeight;
    /**
     * @type {?}
     * @private
     */
    TextareaAutoSizeDirective.prototype.el;
    /**
     * @type {?}
     * @private
     */
    TextareaAutoSizeDirective.prototype.ngControl;
    /**
     * @type {?}
     * @private
     */
    TextareaAutoSizeDirective.prototype.injector;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGV4dGFyZWEtYXV0b3NpemUuZGlyZWN0aXZlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy91aS1mb3Jtcy8iLCJzb3VyY2VzIjpbImxpYi90ZXh0YXJlYS1hdXRvc2l6ZS5kaXJlY3RpdmUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsS0FBSyxFQUFFLFFBQVEsRUFBVSxVQUFVLEVBQUUsWUFBWSxFQUEyQyxNQUFNLGVBQWUsQ0FBQztBQUN0SSxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFFM0M7SUFlSSxtQ0FBb0IsRUFBYyxFQUFVLFNBQW9CLEVBQVUsUUFBa0I7UUFBeEUsT0FBRSxHQUFGLEVBQUUsQ0FBWTtRQUFVLGNBQVMsR0FBVCxTQUFTLENBQVc7UUFBVSxhQUFRLEdBQVIsUUFBUSxDQUFVO1FBWHhFLFdBQU0sR0FBRyxJQUFJLENBQUM7UUFHMUIsa0JBQWEsR0FBRyxJQUFJLENBQUM7UUFDckIsa0JBQWEsR0FBRyxLQUFLLENBQUM7UUFRMUIsSUFBSSxDQUFDLFFBQVEsR0FBRyxJQUFJLENBQUMsRUFBRSxDQUFDLGFBQWEsQ0FBQztJQUMxQyxDQUFDOzs7O0lBRUQsNENBQVE7OztJQUFSO1FBQ0ksSUFBSSxDQUFDLElBQUksRUFBRSxDQUFDO0lBQ2hCLENBQUM7Ozs7O0lBRUQsK0NBQVc7Ozs7SUFBWCxVQUFZLE9BQXNCO1FBQzlCLElBQUksT0FBTyxDQUFDLE1BQU0sSUFBSSxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsYUFBYSxFQUFFLEVBQUU7WUFDbkQsSUFBSSxDQUFDLFNBQVMsRUFBRSxDQUFDO1NBQ3BCO0lBQ0wsQ0FBQzs7OztJQUVELG1EQUFlOzs7SUFBZjtRQUNJLElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFO1lBQ2QsT0FBTztTQUNWO1FBRUQsSUFBSSxJQUFJLENBQUMsU0FBUyxFQUFFO1lBQ2hCLElBQUksQ0FBQyxRQUFRLENBQUMs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QkFBeUI7OztJQUNsQywyQ0FBa0M7O0lBQ2xDLDhDQUEyQjs7Ozs7SUFFM0Isa0RBQTZCOzs7OztJQUM3QixrREFBOEI7Ozs7O0lBRTlCLDZDQUFpQjs7Ozs7SUFDakIsNkNBQWlCOzs7OztJQUNqQixvREFBd0I7Ozs7O0lBQ3hCLDhDQUFrQjs7Ozs7SUFFTix1Q0FBc0I7Ozs7O0lBQUUsOENBQTRCOzs7OztJQUFFLDZDQUEwQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IERpcmVjdGl2ZSwgSW5wdXQsIEluamVjdG9yLCBPbkluaXQsIEVsZW1lbnRSZWYsIEhvc3RMaXN0ZW5lciwgQWZ0ZXJWaWV3SW5pdCwgT25DaGFuZ2VzLCBTaW1wbGVDaGFuZ2VzIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IE5nQ29udHJvbCB9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcclxuXHJcbkBEaXJlY3RpdmUoe1xyXG4gICAgc2VsZWN0b3I6ICdbYXV0by1zaXplXScsXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBUZXh0YXJlYUF1dG9TaXplRGlyZWN0aXZlIGltcGxlbWVudHMgT25Jbml0LCBBZnRlclZpZXdJbml0LCBPbkNoYW5nZXN7XHJcbiAgICBASW5wdXQoJ2F1dG8tc2l6ZScpIGVuYWJsZSA9IHRydWU7XHJcbiAgICBASW5wdXQoKSBtYXhIZWlnaHQ6IG51bWJlcjtcclxuXHJcbiAgICBwcml2YXRlIHByZXZpb3VzVmFsdWUgPSBudWxsO1xyXG4gICAgcHJpdmF0ZSBpc1VzZXJSZXNpemVkID0gZmFsc2U7XHJcblxyXG4gICAgcHJpdmF0ZSB0ZXh0YXJlYTtcclxuICAgIHByaXZhdGUgZG9jdW1lbnQ7XHJcbiAgICBwcml2YXRlIGRvY3VtZW50RWxlbWVudDtcclxuICAgIHByaXZhdGUgbWluSGVpZ2h0O1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgZWw6IEVsZW1lbnRSZWYsIHByaXZhdGUgbmdDb250cm9sOiBOZ0NvbnRyb2wsIHByaXZhdGUgaW5qZWN0b3I6IEluamVjdG9yKSB7XHJcbiAgICAgICAgdGhpcy50ZXh0YXJlYSA9IHRoaXMuZWwubmF0aXZlRWxlbWVudDtcclxuICAgIH1cclxuXHJcbiAgICBuZ09uSW5pdCgpIHtcclxuICAgICAgICB0aGlzLmluaXQoKTtcclxuICAgIH1cclxuXHJcbiAgICBuZ09uQ2hhbmdlcyhjaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKSB7XHJcbiAgICAgICAgaWYgKGNoYW5nZXMuZW5hYmxlICYmICFjaGFuZ2VzLmVuYWJsZS5pc0ZpcnN0Q2hhbmdlKCkpIHtcclxuICAgICAgICAgICAgdGhpcy5zaXplVG9GaXQoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgbmdBZnRlclZpZXdJbml0KCkge1xyXG4gICAgICAgIGlmICghdGhpcy5lbmFibGUpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgICAgICBpZiAodGhpcy5tYXhIZWlnaHQpIHtcclxuICAgICAgICAgICAgdGhpcy50ZXh0YXJlYS5zdHlsZS5tYXhIZWlnaHQgPSBgJHt0aGlzLm1heEhlaWdodH1weGA7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIHRoaXMubWluSGVpZ2h0ID0gdGhpcy50ZXh0YXJlYS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS5oZWlnaHQ7XHJcbiAgICAgICAgaWYgKHRoaXMubWluSGVpZ2h0KSB7XHJcbiAgICAgICAgICAgIHRoaXMudGV4dGFyZWEuc3R5bGUubWluSGVpZ2h0ID0gYCR7dGhpcy5taW5IZWlnaHR9cHhgO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGluaXQoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuZW5hYmxlKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZG9jdW1lbnQgPSB0aGlzLnRleHRhcmVhLm93bmVyRG9jdW1lbnQ7XHJcbiAgICAgICAgICAgIHRoaXMuZG9jdW1lbnRFbGVtZW50ID0gdGhpcy5kb2N1bWVudC5kb2N1bWVudEVsZW1lbnQ7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLnRleHRhcmVhKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy50ZXh0YXJlYS52YWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2l6ZVRvRml0KCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmICh0aGlzLm5nQ29udHJvbCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5uZ0NvbnRyb2wudmFsdWVDaGFuZ2VzLnN1YnNjcmliZSh2ID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodiAhPT0gdGhpcy5wcmV2aW91c1ZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2l6ZVRvRml0KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgQEhvc3RMaXN0ZW5lcignaW5wdXQnKVxyXG4gICAgb25JbnB1dCgpIHtcclxuICAgICAgICB0aGlzLnNpemVUb0ZpdCgpO1xyXG4gICAgfVxyXG5cclxuICAgIEBIb3N0TGlzdGVuZXIoJ2NoYW5nZScpXHJcbiAgICBvblZhbHVlQ2hhbmdlKCkge1xyXG4gICAgICAgIHRoaXMuc2l6ZVRvRml0KCk7XHJcbiAgICB9XHJcblxyXG5cclxuICAgIHByaXZhdGUgb3ZlcmZsb3dPZmZzZXQoKSB7XHJcbiAgICAgICAgbGV0IG9mZnNldFRvcCA9IDA7XHJcbiAgICAgICAgbGV0IGVsID0gdGhpcy50ZXh0YXJlYTtcclxuXHJcbiAgICAgICAgd2hpbGUgKGVsICE9PSBkb2N1bWVudC5ib2R5ICYmIGVsICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgIG9mZnNldFRvcCArPSBlbC5vZmZzZXRUb3AgfHwgMDtcclxuICAgICAgICAgICAgZWwgPSBlbC5vZmZzZXRQYXJlbnQ7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCB0b3AgPSBvZmZzZXRUb3AgLSBkb2N1bWVudC5kZWZhdWx0Vmlldy5wYWdlWU9mZnNldDtcclxuICAgICAgICBjb25zdCBib3R0b20gPSB0aGlzLmRvY3VtZW50RWxlbWVudC5jbGllbnRIZWlnaHQgLSAodG9wICsgdGhpcy50ZXh0YXJlYS5vZmZzZXRIZWlnaHQpO1xyXG4gICAgICAgIHJldHVybiB7IHRvcCwgYm90dG9tIH07XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBzaXplVG9GaXQoKSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLmVuYWJsZSkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCB0ZXh0YXJlYSA9IHRoaXMudGV4dGFyZWE7XHJcbiAgICAgICAgY29uc3Qgdmlld3BvcnRNYXJnaW5Cb3R0b20gPSAxMDA7XHJcbiAgICAgICAgaWYgKHRoaXMuaXNVc2VyUmVzaXplZCkgeyByZXR1cm47IH1cclxuICAgICAgICBpZiAodGhpcy50ZXh0YXJlYS52YWx1ZSA9PT0gdGhpcy5wcmV2aW91c1ZhbHVlKSB7IHJldHVybjsgfVxyXG4gICAgICAgIGlmICh0aGlzLnRleHRhcmVhLm9mZnNldFdpZHRoIDw9IDAgJiYgdGhpcy50ZXh0YXJlYS5vZmZzZXRIZWlnaHQgPD0gMCkgeyByZXR1cm47IH1cclxuXHJcbiAgICAgICAgLy8gY29uc3QgeyB0b3AsIGJvdHRvbSB9ID0gdGhpcy5vdmVyZmxvd09mZnNldCgpO1xyXG4gICAgICAgIC8vIGlmICh0b3AgPCAwIHx8IGJvdHRvbSA8IDApIHtcclxuICAgICAgICAvLyAgICAgcmV0dXJuO1xyXG4gICAgICAgIC8vIH1cclxuXHJcbiAgICAgICAgY29uc3QgdGV4dGFyZWFTdHlsZSA9IGdldENvbXB1dGVkU3R5bGUodGV4dGFyZWEpO1xyXG5cclxuICAgICAgICBjb25zdCB0b3BCb3JkZXJXaWR0aCA9IE51bWJlcih0ZXh0YXJlYVN0eWxlLmJvcmRlclRvcFdpZHRoLnJlcGxhY2UoL3B4LywgJycpKTtcclxuICAgICAgICBjb25zdCBib3R0b21Cb3JkZXJXaWR0aCA9IE51bWJlcih0ZXh0YXJlYVN0eWxlLmJvcmRlckJvdHRvbVdpZHRoLnJlcGxhY2UoL3B4LywgJycpKTtcclxuXHJcbiAgICAgICAgY29uc3QgaXNCb3JkZXJCb3ggPSB0ZXh0YXJlYVN0eWxlLmJveFNpemluZyA9PT0gJ2JvcmRlci1ib3gnO1xyXG4gICAgICAgIGNvbnN0IGJvcmRlckFkZE9uID0gaXNCb3JkZXJCb3ggPyB0b3BCb3JkZXJXaWR0aCArIGJvdHRvbUJvcmRlcldpZHRoIDogMDtcclxuXHJcbiAgICAgICAgLy8gY29uc3QgbWF4SGVpZ2h0ID0gTnVtYmVyKHRleHRhcmVhU3R5bGUuaGVpZ2h0LnJlcGxhY2UoL3B4LywgJycpKSArIGJvdHRvbTtcclxuICAgICAgICAvLyBjb25zdCBhZGp1c3RlZFZpZXdwb3J0TWFyZ2luQm90dG9tID0gYm90dG9tIDwgdmlld3BvcnRNYXJnaW5Cb3R0b20gPyBib3R0b20gOiB2aWV3cG9ydE1hcmdpbkJvdHRvbTtcclxuICAgICAgICAvLyB0ZXh0YXJlYS5zdHlsZS5tYXhIZWlnaHQgPSBgJHttYXhIZWlnaHQgLSBhZGp1c3RlZFZpZXdwb3J0TWFyZ2luQm90dG9tfXB4YDtcclxuXHJcblxyXG4gICAgICAgIGNvbnN0IGNvbnRhaW5lciA9IHRleHRhcmVhLnBhcmVudEVsZW1lbnQ7XHJcbiAgICAgICAgaWYgKGNvbnRhaW5lciBpbnN0YW5jZW9mIEhUTUxFbGVtZW50KSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGNvbnRhaW5lckhlaWdodCA9IGNvbnRhaW5lci5zdHlsZS5oZWlnaHQ7XHJcbiAgICAgICAgICAgIGNvbnRhaW5lci5zdHlsZS5oZWlnaHQgPSBnZXRDb21wdXRlZFN0eWxlKGNvbnRhaW5lcikuaGVpZ2h0O1xyXG4gICAgICAgICAgICB0ZXh0YXJlYS5zdHlsZS5oZWlnaHQgPSAnYXV0byc7XHJcblxyXG4gICAgICAgICAgICBsZXQgaCA9IHRleHRhcmVhLnNjcm9sbEhlaWdodCArIGJvcmRlckFkZE9uO1xyXG4gICAgICAgICAgICBpZiAodGhpcy5taW5IZWlnaHQgPiBoKSB7XHJcbiAgICAgICAgICAgICAgICBoID0gdGhpcy5taW5IZWlnaHQ7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGV4dGFyZWEuc3R5bGUuaGVpZ2h0ID0gYCR7aH1weGA7XHJcbiAgICAgICAgICAgIGNvbnRhaW5lci5zdHlsZS5oZWlnaHQgPSBjb250YWluZXJIZWlnaHQ7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLnByZXZpb3VzVmFsdWUgPSB0ZXh0YXJlYS52YWx1ZTtcclxuICAgIH1cclxufVxyXG4iXX0=
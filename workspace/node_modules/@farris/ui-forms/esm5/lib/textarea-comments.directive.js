/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { ComponentFactoryResolver, Directive, ElementRef, Injector, Input, Renderer2 } from "@angular/core";
import { NgControl } from "@angular/forms";
import { CommonUtils, OverLayHiddenService } from "@farris/ui-common";
import { LocaleService } from "@farris/ui-locale";
import { CommentsHttpToken } from "./comments/get-data.interface";
import { SingleListComponent } from "./comments/single-list.component";
var TextareaCommentsDirective = /** @class */ (function () {
    function TextareaCommentsDirective(injector, el, render, localeSer, cfr) {
        this.injector = injector;
        this.el = el;
        this.render = render;
        this.localeSer = localeSer;
        this.cfr = cfr;
        this.useComments = true;
        this.maxHeight = 300;
        this.title = '';
        this.mgrText = '';
        this.commentsBtnElement = null;
        this.singListRef = null;
        this.listPanelElRef = null;
        this.commentSer = this.injector.get(CommentsHttpToken, null);
        this.overlaySer = this.injector.get(OverLayHiddenService, null);
        this.commonUtil = this.injector.get(CommonUtils, null);
        if (!this.overlaySer) {
            this.overlaySer = new OverLayHiddenService();
        }
    }
    /**
     * @return {?}
     */
    TextareaCommentsDirective.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        this.ngControl = this.injector.get(NgControl, null);
    };
    /**
     * @return {?}
     */
    TextareaCommentsDirective.prototype.ngAfterViewInit = /**
     * @return {?}
     */
    function () {
        this.init();
        this.listenAttributesChanged();
    };
    /**
     * @param {?} changes
     * @return {?}
     */
    TextareaCommentsDirective.prototype.ngOnChanges = /**
     * @param {?} changes
     * @return {?}
     */
    function (changes) {
        if (changes.useComments && !changes.useComments.isFirstChange()) {
            this.init();
        }
    };
    /**
     * @private
     * @return {?}
     */
    TextareaCommentsDirective.prototype.init = /**
     * @private
     * @return {?}
     */
    function () {
        /** @type {?} */
        var readonly = this.el.nativeElement.readOnly;
        /** @type {?} */
        var disabled = this.el.nativeElement.disabled;
        if (this.useComments && (!readonly && !disabled)) {
            this.createCommentsButton();
        }
        else {
            this.destroy();
        }
    };
    /**
     * @return {?}
     */
    TextareaCommentsDirective.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        this.destroy();
        this.hideListPanel();
        // 停止观察属性变化
        this.observer.disconnect();
        this.observer = null;
    };
    /**
     * @return {?}
     */
    TextareaCommentsDirective.prototype.listenAttributesChanged = /**
     * @return {?}
     */
    function () {
        var _this = this;
        // 选择需要观察变动的节点
        /** @type {?} */
        var targetNode = this.el.nativeElement;
        // 观察器的配置（需要观察什么变动）
        /** @type {?} */
        var config = { attributes: true };
        // 当观察到变动时执行的回调函数
        /** @type {?} */
        var callback = (/**
         * @param {?} mutationsList
         * @param {?} observer
         * @return {?}
         */
        function (mutationsList, observer) {
            var e_1, _a;
            try {
                // Use traditional 'for loops' for IE 11
                for (var mutationsList_1 = tslib_1.__values(mutationsList), mutationsList_1_1 = mutationsList_1.next(); !mutationsList_1_1.done; mutationsList_1_1 = mutationsList_1.next()) {
                    var mutation = mutationsList_1_1.value;
                    if (mutation.type === 'attributes' && (mutation.attributeName === 'readonly' || mutation.attributeName === 'disabled')) {
                        _this.init();
                    }
                }
            }
            catch (e_1_1) { e_1 = { error: e_1_1 }; }
            finally {
                try {
                    if (mutationsList_1_1 && !mutationsList_1_1.done && (_a = mutationsList_1.return)) _a.call(mutationsList_1);
                }
                finally { if (e_1) throw e_1.error; }
            }
        });
        // 创建一个观察器实例并传入回调函数
        this.observer = new MutationObserver(callback);
        // 以上述配置开始观察目标节点
        this.observer.observe(targetNode, config);
    };
    /**
     * @return {?}
     */
    TextareaCommentsDirective.prototype.destroy = /**
     * @return {?}
     */
    function () {
        if (this.commentsBtnElement) {
            this.commentsBtnElement.remove();
        }
    };
    /**
     * @private
     * @return {?}
     */
    TextareaCommentsDirective.prototype.createID = /**
     * @private
     * @return {?}
     */
    function () {
        /** @type {?} */
        var tagName = this.el.nativeElement.tagName;
        if (this.ngControl) {
            /** @type {?} */
            var ctrlName = this.ngControl.name;
            return tagName + "_COMMENTS_" + ctrlName;
        }
        else {
            if (this.el.nativeElement.id) {
                return tagName + "_COMMENTS_" + this.el.nativeElement.id;
            }
        }
        return '';
    };
    /**
     * @private
     * @return {?}
     */
    TextareaCommentsDirective.prototype.createCommentsButton = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        /** @type {?} */
        var commentsBtn = this.render.createElement('span');
        commentsBtn.className = 'dropdown-toggle';
        commentsBtn.title = this.title ? this.title : (this.localeSer.getValue('text.comments.title') || '常用意见');
        /** @type {?} */
        var id = this.createID();
        if (id) {
            commentsBtn.id = id;
        }
        this.render.setStyle(commentsBtn, 'position', 'absolute');
        this.render.setStyle(commentsBtn, 'left', '3px');
        this.render.setStyle(commentsBtn, 'bottom', '0px');
        this.render.setStyle(commentsBtn, 'cursor', 'pointer');
        /** @type {?} */
        var icon = this.render.createElement('span');
        this.render.appendChild(commentsBtn, icon);
        icon.className = 'f-icon f-icon-message';
        this.render.setStyle(icon, 'position', 'relative');
        // this.render.setStyle(icon, 'margin-right', '3px');
        this.render.setStyle(icon, 'top', '1px');
        this.render.setStyle(icon, 'font-size', '13px');
        this.el.nativeElement.after(commentsBtn);
        this.commentsBtnElement = commentsBtn;
        this.render.listen(commentsBtn, 'click', (/**
         * @param {?} e
         * @return {?}
         */
        function (e) {
            e.stopPropagation();
            if (!_this.listPanelElRef) {
                _this.showListPanel();
            }
            else {
                _this.hideListPanel();
            }
        }));
    };
    /**
     * @private
     * @return {?}
     */
    TextareaCommentsDirective.prototype.showListPanel = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        /** @type {?} */
        var listPanelEl = this.render.createElement('div');
        /** @type {?} */
        var zindex = this.commonUtil.getFloatingLayerIndex();
        var _a = this.commentsBtnElement.getBoundingClientRect(), left = _a.left, bottom = _a.bottom;
        this.render.setStyle(listPanelEl, 'width', '200px');
        this.render.setStyle(listPanelEl, 'max-height', this.maxHeight + "px");
        this.render.setStyle(listPanelEl, 'position', 'absolute');
        this.render.setStyle(listPanelEl, 'left', left + "px");
        this.render.setStyle(listPanelEl, 'top', '0px');
        this.render.setStyle(listPanelEl, 'z-index', zindex);
        this.render.setStyle(listPanelEl, 'box-shadow', '0 2px 8px 0 #dedede');
        this.render.setStyle(listPanelEl, 'border-radius', '6px');
        this.render.setStyle(listPanelEl, 'background', 'white');
        this.render.setStyle(listPanelEl, 'visibility', 'hidden');
        document.body.append(listPanelEl);
        this.listPanelElRef = listPanelEl;
        /** @type {?} */
        var singListCmf = this.cfr.resolveComponentFactory(SingleListComponent);
        this.singListRef = singListCmf.create(this.injector);
        this.singListRef.instance.showButtons = true;
        this.singListRef.instance.emptyDataMsg = this.localeSer.getValue('text.comments.empty');
        this.singListRef.instance.buttons = [
            {
                text: this.mgrText ? this.mgrText : this.localeSer.getValue('text.comments.manager'),
                iconCls: 'f-icon f-icon-home-setup', handler: (/**
                 * @return {?}
                 */
                function () {
                    if (_this.commentSer) {
                        _this.hideListPanel();
                        _this.commentSer.showCommentManageDialog({ type: 'forms' }).subscribe((/**
                         * @param {?} e
                         * @return {?}
                         */
                        function (e) {
                            console.log(e);
                        }));
                    }
                })
            }
        ];
        this.singListRef.instance.textField = 'message';
        this.singListRef.instance.maxItems = 999999;
        this.singListRef.instance.itemClick.subscribe((/**
         * @param {?} e
         * @return {?}
         */
        function (e) {
            /** @type {?} */
            var val = e.data['message'];
            /** @type {?} */
            var _text = _this.el.nativeElement.value || '';
            _text += val;
            if (_this.ngControl) {
                _this.ngControl.control.patchValue(_text);
            }
            else {
                _this.el.nativeElement.value = _text;
            }
            _this.hideListPanel();
        }));
        listPanelEl.appendChild(this.singListRef.location.nativeElement);
        this.singListRef.changeDetectorRef.detectChanges();
        this.loadData(this.singListRef);
        this.overlaySer.registerMouseEvent(listPanelEl, (/**
         * @param {?} e
         * @return {?}
         */
        function (e) {
            if (_this.listPanelElRef.contains(e.target) || _this.commentsBtnElement === e.target || _this.commentsBtnElement.contains(e.target)) {
                return;
            }
            _this.hideListPanel();
        }));
    };
    /**
     * @return {?}
     */
    TextareaCommentsDirective.prototype.hideListPanel = /**
     * @return {?}
     */
    function () {
        if (this.singListRef) {
            this.singListRef.destroy();
            this.singListRef = null;
        }
        if (this.listPanelElRef) {
            this.listPanelElRef.remove();
            this.overlaySer.destory(this.listPanelElRef);
            this.listPanelElRef = null;
        }
    };
    /**
     * @private
     * @param {?} singListRef
     * @return {?}
     */
    TextareaCommentsDirective.prototype.loadData = /**
     * @private
     * @param {?} singListRef
     * @return {?}
     */
    function (singListRef) {
        var _this = this;
        if (this.commentSer) {
            this.commentSer.getCommonComments({ type: 'forms' }).subscribe((/**
             * @param {?} data
             * @return {?}
             */
            function (data) {
                singListRef.instance.loadData(data);
                setTimeout((/**
                 * @return {?}
                 */
                function () {
                    _this.resetPosition();
                }));
            }));
        }
    };
    /**
     * @private
     * @return {?}
     */
    TextareaCommentsDirective.prototype.resetPosition = /**
     * @private
     * @return {?}
     */
    function () {
        var _a = this.commentsBtnElement.getBoundingClientRect(), top = _a.top, bottom = _a.bottom, left = _a.left;
        /** @type {?} */
        var panelHeight = this.listPanelElRef.offsetHeight;
        if (window.innerHeight - bottom > this.maxHeight || window.innerHeight - bottom > panelHeight) {
            this.render.setStyle(this.listPanelElRef, 'top', bottom + "px");
            this.render.removeStyle(this.listPanelElRef, 'visibility');
            return;
        }
        else {
            if (top > this.maxHeight || top > panelHeight) {
                this.render.setStyle(this.listPanelElRef, 'top', top - panelHeight + "px");
            }
            else {
                this.render.setStyle(this.listPanelElRef, 'top', '0px');
                if (left > 200) {
                    this.render.setStyle(this.listPanelElRef, 'left', left - 200 + "px");
                }
            }
            this.render.removeStyle(this.listPanelElRef, 'visibility');
        }
    };
    TextareaCommentsDirective.decorators = [
        { type: Directive, args: [{
                    selector: '[common-comments]',
                },] }
    ];
    /** @nocollapse */
    TextareaCommentsDirective.ctorParameters = function () { return [
        { type: Injector },
        { type: ElementRef },
        { type: Renderer2 },
        { type: LocaleService },
        { type: ComponentFactoryResolver }
    ]; };
    TextareaCommentsDirective.propDecorators = {
        useComments: [{ type: Input, args: ['common-comments',] }],
        maxHeight: [{ type: Input }],
        title: [{ type: Input }],
        mgrText: [{ type: Input }]
    };
    return TextareaCommentsDirective;
}());
export { TextareaCommentsDirective };
if (false) {
    /** @type {?} */
    TextareaCommentsDirective.prototype.useComments;
    /** @type {?} */
    TextareaCommentsDirective.prototype.maxHeight;
    /** @type {?} */
    TextareaCommentsDirective.prototype.title;
    /** @type {?} */
    TextareaCommentsDirective.prototype.mgrText;
    /**
     * @type {?}
     * @private
     */
    TextareaCommentsDirective.prototype.commentSer;
    /**
     * @type {?}
     * @private
     */
    TextareaCommentsDirective.prototype.eventManager;
    /**
     * @type {?}
     * @private
     */
    TextareaCommentsDirective.prototype.ngControl;
    /** @type {?} */
    TextareaCommentsDirective.prototype.commentsBtnElement;
    /** @type {?} */
    TextareaCommentsDirective.prototype.singListRef;
    /** @type {?} */
    TextareaCommentsDirective.prototype.listPanelElRef;
    /**
     * @type {?}
     * @private
     */
    TextareaCommentsDirective.prototype.overlaySer;
    /**
     * @type {?}
     * @private
     */
    TextareaCommentsDirective.prototype.observer;
    /**
     * @type {?}
     * @private
     */
    TextareaCommentsDirective.prototype.commonUtil;
    /**
     * @type {?}
     * @private
     */
    TextareaCommentsDirective.prototype.injector;
    /**
     * @type {?}
     * @private
     */
    TextareaCommentsDirective.prototype.el;
    /**
     * @type {?}
     * @private
     */
    TextareaCommentsDirective.prototype.render;
    /**
     * @type {?}
     * @private
     */
    TextareaCommentsDirective.prototype.localeSer;
    /**
     * @type {?}
     * @private
     */
    TextareaCommentsDirective.prototype.cfr;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGV4dGFyZWEtY29tbWVudHMuZGlyZWN0aXZlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy91aS1mb3Jtcy8iLCJzb3VyY2VzIjpbImxpYi90ZXh0YXJlYS1jb21tZW50cy5kaXJlY3RpdmUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQWlCLHdCQUF3QixFQUFnQixTQUFTLEVBQUUsVUFBVSxFQUFFLFFBQVEsRUFBRSxLQUFLLEVBQWdDLFNBQVMsRUFBaUIsTUFBTSxlQUFlLENBQUM7QUFDdEwsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBRTNDLE9BQU8sRUFBRSxXQUFXLEVBQUUsb0JBQW9CLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUN0RSxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFDbEQsT0FBTyxFQUFFLGlCQUFpQixFQUF3QixNQUFNLCtCQUErQixDQUFDO0FBQ3hGLE9BQU8sRUFBRSxtQkFBbUIsRUFBRSxNQUFNLGtDQUFrQyxDQUFDO0FBR3ZFO0lBb0JJLG1DQUFvQixRQUFrQixFQUFVLEVBQWMsRUFBVSxNQUFpQixFQUM3RSxTQUF3QixFQUFVLEdBQTZCO1FBRHZELGFBQVEsR0FBUixRQUFRLENBQVU7UUFBVSxPQUFFLEdBQUYsRUFBRSxDQUFZO1FBQVUsV0FBTSxHQUFOLE1BQU0sQ0FBVztRQUM3RSxjQUFTLEdBQVQsU0FBUyxDQUFlO1FBQVUsUUFBRyxHQUFILEdBQUcsQ0FBMEI7UUFoQmpELGdCQUFXLEdBQUcsSUFBSSxDQUFDO1FBQ3BDLGNBQVMsR0FBRyxHQUFHLENBQUM7UUFDaEIsVUFBSyxHQUFHLEVBQUUsQ0FBQztRQUNYLFlBQU8sR0FBRyxFQUFFLENBQUM7UUFLdEIsdUJBQWtCLEdBQUcsSUFBSSxDQUFDO1FBQzFCLGdCQUFXLEdBQXNDLElBQUksQ0FBQztRQUN0RCxtQkFBYyxHQUFHLElBQUksQ0FBQztRQU9sQixJQUFJLENBQUMsVUFB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OztJQUVsQyxnREFBNkM7O0lBQzdDLDhDQUF5Qjs7SUFDekIsMENBQW9COztJQUNwQiw0Q0FBc0I7Ozs7O0lBRXRCLCtDQUF5Qzs7Ozs7SUFDekMsaURBQW1DOzs7OztJQUNuQyw4Q0FBNkI7O0lBQzdCLHVEQUEwQjs7SUFDMUIsZ0RBQXNEOztJQUN0RCxtREFBc0I7Ozs7O0lBQ3RCLCtDQUF5Qzs7Ozs7SUFFekMsNkNBQW1DOzs7OztJQUNuQywrQ0FBZ0M7Ozs7O0lBQ3BCLDZDQUEwQjs7Ozs7SUFBRSx1Q0FBc0I7Ozs7O0lBQUUsMkNBQXlCOzs7OztJQUNyRiw4Q0FBZ0M7Ozs7O0lBQUUsd0NBQXFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQWZ0ZXJWaWV3SW5pdCwgQ29tcG9uZW50RmFjdG9yeVJlc29sdmVyLCBDb21wb25lbnRSZWYsIERpcmVjdGl2ZSwgRWxlbWVudFJlZiwgSW5qZWN0b3IsIElucHV0LCBPbkNoYW5nZXMsIE9uRGVzdHJveSwgT25Jbml0LCBSZW5kZXJlcjIsIFNpbXBsZUNoYW5nZXMgfSBmcm9tIFwiQGFuZ3VsYXIvY29yZVwiO1xyXG5pbXBvcnQgeyBOZ0NvbnRyb2wgfSBmcm9tIFwiQGFuZ3VsYXIvZm9ybXNcIjtcclxuaW1wb3J0IHsgRXZlbnRNYW5hZ2VyIH0gZnJvbSBcIkBhbmd1bGFyL3BsYXRmb3JtLWJyb3dzZXJcIjtcclxuaW1wb3J0IHsgQ29tbW9uVXRpbHMsIE92ZXJMYXlIaWRkZW5TZXJ2aWNlIH0gZnJvbSBcIkBmYXJyaXMvdWktY29tbW9uXCI7XHJcbmltcG9ydCB7IExvY2FsZVNlcnZpY2UgfSBmcm9tIFwiQGZhcnJpcy91aS1sb2NhbGVcIjtcclxuaW1wb3J0IHsgQ29tbWVudHNIdHRwVG9rZW4sIElDb21tZW50c0h0dHBTZXJ2aWNlIH0gZnJvbSBcIi4vY29tbWVudHMvZ2V0LWRhdGEuaW50ZXJmYWNlXCI7XHJcbmltcG9ydCB7IFNpbmdsZUxpc3RDb21wb25lbnQgfSBmcm9tIFwiLi9jb21tZW50cy9zaW5nbGUtbGlzdC5jb21wb25lbnRcIjtcclxuXHJcblxyXG5ARGlyZWN0aXZlKHtcclxuICAgIHNlbGVjdG9yOiAnW2NvbW1vbi1jb21tZW50c10nLFxyXG59KVxyXG5leHBvcnQgY2xhc3MgVGV4dGFyZWFDb21tZW50c0RpcmVjdGl2ZSBpbXBsZW1lbnRzIE9uSW5pdCwgQWZ0ZXJWaWV3SW5pdCwgT25DaGFuZ2VzLCBPbkRlc3Ryb3kge1xyXG5cclxuICAgIEBJbnB1dCgnY29tbW9uLWNvbW1lbnRzJykgdXNlQ29tbWVudHMgPSB0cnVlO1xyXG4gICAgQElucHV0KCkgbWF4SGVpZ2h0ID0gMzAwO1xyXG4gICAgQElucHV0KCkgdGl0bGUgPSAnJztcclxuICAgIEBJbnB1dCgpIG1nclRleHQgPSAnJztcclxuXHJcbiAgICBwcml2YXRlIGNvbW1lbnRTZXI6IElDb21tZW50c0h0dHBTZXJ2aWNlO1xyXG4gICAgcHJpdmF0ZSBldmVudE1hbmFnZXI6IEV2ZW50TWFuYWdlcjtcclxuICAgIHByaXZhdGUgbmdDb250cm9sOiBOZ0NvbnRyb2w7XHJcbiAgICBjb21tZW50c0J0bkVsZW1lbnQgPSBudWxsO1xyXG4gICAgc2luZ0xpc3RSZWY6IENvbXBvbmVudFJlZjxTaW5nbGVMaXN0Q29tcG9uZW50PiA9IG51bGw7XHJcbiAgICBsaXN0UGFuZWxFbFJlZiA9IG51bGw7XHJcbiAgICBwcml2YXRlIG92ZXJsYXlTZXI6IE92ZXJMYXlIaWRkZW5TZXJ2aWNlO1xyXG5cclxuICAgIHByaXZhdGUgb2JzZXJ2ZXI6IE11dGF0aW9uT2JzZXJ2ZXI7XHJcbiAgICBwcml2YXRlIGNvbW1vblV0aWw6IENvbW1vblV0aWxzO1xyXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBpbmplY3RvcjogSW5qZWN0b3IsIHByaXZhdGUgZWw6IEVsZW1lbnRSZWYsIHByaXZhdGUgcmVuZGVyOiBSZW5kZXJlcjIsIFxyXG4gICAgICAgIHByaXZhdGUgbG9jYWxlU2VyOiBMb2NhbGVTZXJ2aWNlLCBwcml2YXRlIGNmcjogQ29tcG9uZW50RmFjdG9yeVJlc29sdmVyKSB7XHJcbiAgICAgICAgdGhpcy5jb21tZW50U2VyID0gdGhpcy5pbmplY3Rvci5nZXQoQ29tbWVudHNIdHRwVG9rZW4sIG51bGwpO1xyXG4gICAgICAgIHRoaXMub3ZlcmxheVNlciA9IHRoaXMuaW5qZWN0b3IuZ2V0KE92ZXJMYXlIaWRkZW5TZXJ2aWNlLCBudWxsKTtcclxuICAgICAgICB0aGlzLmNvbW1vblV0aWwgPSB0aGlzLmluamVjdG9yLmdldChDb21tb25VdGlscywgbnVsbCk7XHJcbiAgICAgICAgaWYgKCF0aGlzLm92ZXJsYXlTZXIpIHtcclxuICAgICAgICAgICAgdGhpcy5vdmVybGF5U2VyID0gbmV3IE92ZXJMYXlIaWRkZW5TZXJ2aWNlKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIG5nT25Jbml0KCk6IHZvaWQge1xyXG4gICAgICAgIHRoaXMubmdDb250cm9sID0gdGhpcy5pbmplY3Rvci5nZXQoTmdDb250cm9sLCBudWxsKTtcclxuICAgIH1cclxuXHJcbiAgICBuZ0FmdGVyVmlld0luaXQoKSB7XHJcbiAgICAgICAgdGhpcy5pbml0KCk7XHJcbiAgICAgICAgdGhpcy5saXN0ZW5BdHRyaWJ1dGVzQ2hhbmdlZCgpO1xyXG4gICAgfVxyXG5cclxuICAgIG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpIHtcclxuICAgICAgICBpZiAoY2hhbmdlcy51c2VDb21tZW50cyAmJiAhY2hhbmdlcy51c2VDb21tZW50cy5pc0ZpcnN0Q2hhbmdlKCkpIHtcclxuICAgICAgICAgICAgdGhpcy5pbml0KCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgaW5pdCgpIHtcclxuICAgICAgICBjb25zdCByZWFkb25seSA9IHRoaXMuZWwubmF0aXZlRWxlbWVudC5yZWFkT25seTtcclxuICAgICAgICBjb25zdCBkaXNhYmxlZCA9IHRoaXMuZWwubmF0aXZlRWxlbWVudC5kaXNhYmxlZDtcclxuICAgICAgICBpZiAodGhpcy51c2VDb21tZW50cyAmJiAoIXJlYWRvbmx5ICYmICFkaXNhYmxlZCkpIHtcclxuICAgICAgICAgICAgdGhpcy5jcmVhdGVDb21tZW50c0J1dHRvbigpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMuZGVzdHJveSgpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBuZ09uRGVzdHJveSgpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLmRlc3Ryb3koKTtcclxuICAgICAgICB0aGlzLmhpZGVMaXN0UGFuZWwoKTtcclxuICAgICAgICAvLyDlgZzmraLop4Llr5/lsZ7mgKflj5jljJZcclxuICAgICAgICB0aGlzLm9ic2VydmVyLmRpc2Nvbm5lY3QoKTtcclxuICAgICAgICB0aGlzLm9ic2VydmVyID0gbnVsbDtcclxuICAgIH1cclxuXHJcbiAgICBsaXN0ZW5BdHRyaWJ1dGVzQ2hhbmdlZCgpIHtcclxuICAgICAgICAvLyDpgInmi6npnIDopoHop4Llr5/lj5jliqjnmoToioLngrlcclxuICAgICAgICBjb25zdCB0YXJnZXROb2RlID0gdGhpcy5lbC5uYXRpdmVFbGVtZW50O1xyXG5cclxuICAgICAgICAvLyDop4Llr5/lmajnmoTphY3nva7vvIjpnIDopoHop4Llr5/ku4DkuYjlj5jliqjvvIlcclxuICAgICAgICBjb25zdCBjb25maWcgPSB7IGF0dHJpYnV0ZXM6IHRydWUgfTtcclxuXHJcbiAgICAgICAgLy8g5b2T6KeC5a+f5Yiw5Y+Y5Yqo5pe25omn6KGM55qE5Zue6LCD5Ye95pWwXHJcbiAgICAgICAgY29uc3QgY2FsbGJhY2sgPSAobXV0YXRpb25zTGlzdCwgb2JzZXJ2ZXIpID0+IHtcclxuICAgICAgICAgICAgLy8gVXNlIHRyYWRpdGlvbmFsICdmb3IgbG9vcHMnIGZvciBJRSAxMVxyXG4gICAgICAgICAgICBmb3IobGV0IG11dGF0aW9uIG9mIG11dGF0aW9uc0xpc3QpIHtcclxuICAgICAgICAgICAgICAgIGlmIChtdXRhdGlvbi50eXBlID09PSAnYXR0cmlidXRlcycgJiYgKG11dGF0aW9uLmF0dHJpYnV0ZU5hbWUgPT09ICdyZWFkb25seScgfHwgbXV0YXRpb24uYXR0cmlidXRlTmFtZSA9PT0gJ2Rpc2FibGVkJykpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmluaXQoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIC8vIOWIm+W7uuS4gOS4quinguWvn+WZqOWunuS+i+W5tuS8oOWFpeWbnuiwg+WHveaVsFxyXG4gICAgICAgIHRoaXMub2JzZXJ2ZXIgPSBuZXcgTXV0YXRpb25PYnNlcnZlcihjYWxsYmFjayk7XHJcblxyXG4gICAgICAgIC8vIOS7peS4iui/sOmFjee9ruW8gOWni+inguWvn+ebruagh+iKgueCuVxyXG4gICAgICAgIHRoaXMub2JzZXJ2ZXIub2JzZXJ2ZSh0YXJnZXROb2RlLCBjb25maWcpO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICBkZXN0cm95KCkge1xyXG4gICAgICAgIGlmICh0aGlzLmNvbW1lbnRzQnRuRWxlbWVudCkge1xyXG4gICAgICAgICAgICB0aGlzLmNvbW1lbnRzQnRuRWxlbWVudC5yZW1vdmUoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBjcmVhdGVJRCgpIHtcclxuICAgICAgICBjb25zdCB0YWdOYW1lID0gdGhpcy5lbC5uYXRpdmVFbGVtZW50LnRhZ05hbWU7XHJcbiAgICAgICAgaWYgKHRoaXMubmdDb250cm9sKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGN0cmxOYW1lID0gdGhpcy5uZ0NvbnRyb2wubmFtZTtcclxuICAgICAgICAgICAgcmV0dXJuIGAke3RhZ05hbWV9X0NPTU1FTlRTXyR7Y3RybE5hbWV9YDtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5lbC5uYXRpdmVFbGVtZW50LmlkKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gYCR7dGFnTmFtZX1fQ09NTUVOVFNfJHt0aGlzLmVsLm5hdGl2ZUVsZW1lbnQuaWR9YDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gJyc7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBjcmVhdGVDb21tZW50c0J1dHRvbigpIHtcclxuICAgICAgICBjb25zdCBjb21tZW50c0J0biA9IHRoaXMucmVuZGVyLmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKTtcclxuICAgICAgICBjb21tZW50c0J0bi5jbGFzc05hbWUgPSAnZHJvcGRvd24tdG9nZ2xlJztcclxuICAgICAgICBjb21tZW50c0J0bi50aXRsZSA9IHRoaXMudGl0bGUgPyB0aGlzLnRpdGxlIDogKHRoaXMubG9jYWxlU2VyLmdldFZhbHVlKCd0ZXh0LmNvbW1lbnRzLnRpdGxlJykgfHwgJ+W4uOeUqOaEj+ingScpO1xyXG4gICAgICAgIGNvbnN0IGlkID0gdGhpcy5jcmVhdGVJRCgpO1xyXG4gICAgICAgIGlmIChpZCkge1xyXG4gICAgICAgICAgICBjb21tZW50c0J0bi5pZCA9IGlkO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5yZW5kZXIuc2V0U3R5bGUoY29tbWVudHNCdG4sICdwb3NpdGlvbicsICdhYnNvbHV0ZScpO1xyXG4gICAgICAgIHRoaXMucmVuZGVyLnNldFN0eWxlKGNvbW1lbnRzQnRuLCAnbGVmdCcsICczcHgnKTtcclxuICAgICAgICB0aGlzLnJlbmRlci5zZXRTdHlsZShjb21tZW50c0J0biwgJ2JvdHRvbScsICcwcHgnKTtcclxuICAgICAgICB0aGlzLnJlbmRlci5zZXRTdHlsZShjb21tZW50c0J0biwgJ2N1cnNvcicsICdwb2ludGVyJyk7XHJcblxyXG4gICAgICAgIGNvbnN0IGljb24gPSB0aGlzLnJlbmRlci5jcmVhdGVFbGVtZW50KCdzcGFuJyk7XHJcbiAgICAgICAgdGhpcy5yZW5kZXIuYXBwZW5kQ2hpbGQoY29tbWVudHNCdG4sIGljb24pO1xyXG5cclxuICAgICAgICBpY29uLmNsYXNzTmFtZSA9ICdmLWljb24gZi1pY29uLW1lc3NhZ2UnO1xyXG4gICAgICAgIHRoaXMucmVuZGVyLnNldFN0eWxlKGljb24sICdwb3NpdGlvbicsICdyZWxhdGl2ZScpO1xyXG4gICAgICAgIC8vIHRoaXMucmVuZGVyLnNldFN0eWxlKGljb24sICdtYXJnaW4tcmlnaHQnLCAnM3B4Jyk7XHJcbiAgICAgICAgdGhpcy5yZW5kZXIuc2V0U3R5bGUoaWNvbiwgJ3RvcCcsICcxcHgnKTtcclxuICAgICAgICB0aGlzLnJlbmRlci5zZXRTdHlsZShpY29uLCAnZm9udC1zaXplJywgJzEzcHgnKTtcclxuXHJcbiAgICAgICAgdGhpcy5lbC5uYXRpdmVFbGVtZW50LmFmdGVyKGNvbW1lbnRzQnRuKTtcclxuICAgICAgICB0aGlzLmNvbW1lbnRzQnRuRWxlbWVudCA9IGNvbW1lbnRzQnRuO1xyXG5cclxuICAgICAgICB0aGlzLnJlbmRlci5saXN0ZW4oY29tbWVudHNCdG4sICdjbGljaycsIChlOiBNb3VzZUV2ZW50KSA9PiB7XHJcbiAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICAgICAgICAgIGlmICghdGhpcy5saXN0UGFuZWxFbFJlZikge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zaG93TGlzdFBhbmVsKCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmhpZGVMaXN0UGFuZWwoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pXHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBzaG93TGlzdFBhbmVsKCkge1xyXG4gICAgICAgIGNvbnN0IGxpc3RQYW5lbEVsID0gdGhpcy5yZW5kZXIuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcblxyXG5cclxuICAgICAgICBjb25zdCB6aW5kZXggPSB0aGlzLmNvbW1vblV0aWwuZ2V0RmxvYXRpbmdMYXllckluZGV4KCk7XHJcblxyXG4gICAgICAgIGNvbnN0IHsgbGVmdCwgYm90dG9tIH0gPSB0aGlzLmNvbW1lbnRzQnRuRWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcclxuICAgICAgICB0aGlzLnJlbmRlci5zZXRTdHlsZShsaXN0UGFuZWxFbCwgJ3dpZHRoJywgJzIwMHB4Jyk7XHJcbiAgICAgICAgdGhpcy5yZW5kZXIuc2V0U3R5bGUobGlzdFBhbmVsRWwsICdtYXgtaGVpZ2h0JywgYCR7dGhpcy5tYXhIZWlnaHR9cHhgKTtcclxuICAgICAgICB0aGlzLnJlbmRlci5zZXRTdHlsZShsaXN0UGFuZWxFbCwgJ3Bvc2l0aW9uJywgJ2Fic29sdXRlJyk7XHJcbiAgICAgICAgdGhpcy5yZW5kZXIuc2V0U3R5bGUobGlzdFBhbmVsRWwsICdsZWZ0JywgYCR7bGVmdH1weGApO1xyXG4gICAgICAgIHRoaXMucmVuZGVyLnNldFN0eWxlKGxpc3RQYW5lbEVsLCAndG9wJywgJzBweCcpO1xyXG4gICAgICAgIHRoaXMucmVuZGVyLnNldFN0eWxlKGxpc3RQYW5lbEVsLCAnei1pbmRleCcsIHppbmRleCk7XHJcbiAgICAgICAgdGhpcy5yZW5kZXIuc2V0U3R5bGUobGlzdFBhbmVsRWwsICdib3gtc2hhZG93JywgJzAgMnB4IDhweCAwICNkZWRlZGUnKTtcclxuICAgICAgICB0aGlzLnJlbmRlci5zZXRTdHlsZShsaXN0UGFuZWxFbCwgJ2JvcmRlci1yYWRpdXMnLCAnNnB4Jyk7XHJcbiAgICAgICAgdGhpcy5yZW5kZXIuc2V0U3R5bGUobGlzdFBhbmVsRWwsICdiYWNrZ3JvdW5kJywgJ3doaXRlJyk7XHJcbiAgICAgICAgdGhpcy5yZW5kZXIuc2V0U3R5bGUobGlzdFBhbmVsRWwsICd2aXNpYmlsaXR5JywgJ2hpZGRlbicpO1xyXG4gICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kKGxpc3RQYW5lbEVsKTtcclxuXHJcbiAgICAgICAgdGhpcy5saXN0UGFuZWxFbFJlZiA9IGxpc3RQYW5lbEVsO1xyXG5cclxuICAgICAgICBjb25zdCBzaW5nTGlzdENtZiA9IHRoaXMuY2ZyLnJlc29sdmVDb21wb25lbnRGYWN0b3J5KFNpbmdsZUxpc3RDb21wb25lbnQpO1xyXG4gICAgICAgIHRoaXMuc2luZ0xpc3RSZWYgPSBzaW5nTGlzdENtZi5jcmVhdGUodGhpcy5pbmplY3Rvcik7XHJcblxyXG4gICAgICAgIHRoaXMuc2luZ0xpc3RSZWYuaW5zdGFuY2Uuc2hvd0J1dHRvbnMgPSB0cnVlO1xyXG4gICAgICAgIHRoaXMuc2luZ0xpc3RSZWYuaW5zdGFuY2UuZW1wdHlEYXRhTXNnID0gdGhpcy5sb2NhbGVTZXIuZ2V0VmFsdWUoJ3RleHQuY29tbWVudHMuZW1wdHknKTtcclxuICAgICAgICB0aGlzLnNpbmdMaXN0UmVmLmluc3RhbmNlLmJ1dHRvbnMgPSBbXHJcbiAgICAgICAgICAgIHsgXHJcbiAgICAgICAgICAgICAgICB0ZXh0OiB0aGlzLm1nclRleHQgPyB0aGlzLm1nclRleHQgOiB0aGlzLmxvY2FsZVNlci5nZXRWYWx1ZSgndGV4dC5jb21tZW50cy5tYW5hZ2VyJyksIFxyXG4gICAgICAgICAgICAgICAgaWNvbkNsczogJ2YtaWNvbiBmLWljb24taG9tZS1zZXR1cCcsIGhhbmRsZXI6ICgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5jb21tZW50U2VyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaGlkZUxpc3RQYW5lbCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbW1lbnRTZXIuc2hvd0NvbW1lbnRNYW5hZ2VEaWFsb2coe3R5cGU6ICdmb3Jtcyd9KS5zdWJzY3JpYmUoKGUpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIF07XHJcbiAgICAgICAgdGhpcy5zaW5nTGlzdFJlZi5pbnN0YW5jZS50ZXh0RmllbGQgPSAnbWVzc2FnZSc7XHJcbiAgICAgICAgdGhpcy5zaW5nTGlzdFJlZi5pbnN0YW5jZS5tYXhJdGVtcyA9IDk5OTk5OTtcclxuXHJcbiAgICAgICAgdGhpcy5zaW5nTGlzdFJlZi5pbnN0YW5jZS5pdGVtQ2xpY2suc3Vic2NyaWJlKChlKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IHZhbCA9IGUuZGF0YVsnbWVzc2FnZSddO1xyXG4gICAgICAgICAgICBsZXQgX3RleHQgPSB0aGlzLmVsLm5hdGl2ZUVsZW1lbnQudmFsdWUgfHwgJyc7XHJcbiAgICAgICAgICAgIF90ZXh0ICs9IHZhbDtcclxuICAgICAgICAgICAgaWYgKHRoaXMubmdDb250cm9sKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLm5nQ29udHJvbC5jb250cm9sLnBhdGNoVmFsdWUoX3RleHQpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5lbC5uYXRpdmVFbGVtZW50LnZhbHVlID0gX3RleHQ7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHRoaXMuaGlkZUxpc3RQYW5lbCgpO1xyXG4gICAgICAgIH0pXHJcblxyXG4gICAgICAgIGxpc3RQYW5lbEVsLmFwcGVuZENoaWxkKHRoaXMuc2luZ0xpc3RSZWYubG9jYXRpb24ubmF0aXZlRWxlbWVudCk7XHJcbiAgICAgICAgdGhpcy5zaW5nTGlzdFJlZi5jaGFuZ2VEZXRlY3RvclJlZi5kZXRlY3RDaGFuZ2VzKCk7XHJcblxyXG4gICAgICAgIHRoaXMubG9hZERhdGEodGhpcy5zaW5nTGlzdFJlZik7XHJcblxyXG5cclxuICAgICAgICB0aGlzLm92ZXJsYXlTZXIucmVnaXN0ZXJNb3VzZUV2ZW50KGxpc3RQYW5lbEVsLCAoZSkgPT4ge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5saXN0UGFuZWxFbFJlZi5jb250YWlucyhlLnRhcmdldCkgfHwgdGhpcy5jb21tZW50c0J0bkVsZW1lbnQgPT09IGUudGFyZ2V0IHx8IHRoaXMuY29tbWVudHNCdG5FbGVtZW50LmNvbnRhaW5zKGUudGFyZ2V0KSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMuaGlkZUxpc3RQYW5lbCgpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIGhpZGVMaXN0UGFuZWwoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuc2luZ0xpc3RSZWYpIHtcclxuICAgICAgICAgICAgdGhpcy5zaW5nTGlzdFJlZi5kZXN0cm95KCk7XHJcbiAgICAgICAgICAgIHRoaXMuc2luZ0xpc3RSZWYgPSBudWxsO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHRoaXMubGlzdFBhbmVsRWxSZWYpIHtcclxuICAgICAgICAgICAgdGhpcy5saXN0UGFuZWxFbFJlZi5yZW1vdmUoKTtcclxuICAgICAgICAgICAgdGhpcy5vdmVybGF5U2VyLmRlc3RvcnkodGhpcy5saXN0UGFuZWxFbFJlZik7XHJcbiAgICAgICAgICAgIHRoaXMubGlzdFBhbmVsRWxSZWYgPSBudWxsO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGxvYWREYXRhKHNpbmdMaXN0UmVmOiBDb21wb25lbnRSZWY8U2luZ2xlTGlzdENvbXBvbmVudD4pIHtcclxuICAgICAgICBpZiAodGhpcy5jb21tZW50U2VyKSB7XHJcbiAgICAgICAgICAgIHRoaXMuY29tbWVudFNlci5nZXRDb21tb25Db21tZW50cyh7dHlwZTogJ2Zvcm1zJ30pLnN1YnNjcmliZSgoZGF0YSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgc2luZ0xpc3RSZWYuaW5zdGFuY2UubG9hZERhdGEoZGF0YSk7XHJcbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnJlc2V0UG9zaXRpb24oKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSByZXNldFBvc2l0aW9uKCkge1xyXG4gICAgICAgIGNvbnN0IHsgdG9wLCBib3R0b20sIGxlZnQgfSA9IHRoaXMuY29tbWVudHNCdG5FbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xyXG4gICAgICAgIGNvbnN0IHBhbmVsSGVpZ2h0ID0gdGhpcy5saXN0UGFuZWxFbFJlZi5vZmZzZXRIZWlnaHQ7XHJcbiAgICAgICAgaWYgKHdpbmRvdy5pbm5lckhlaWdodCAtIGJvdHRvbSAgPiB0aGlzLm1heEhlaWdodCB8fCB3aW5kb3cuaW5uZXJIZWlnaHQgLSBib3R0b20gPiBwYW5lbEhlaWdodCkge1xyXG4gICAgICAgICAgICB0aGlzLnJlbmRlci5zZXRTdHlsZSh0aGlzLmxpc3RQYW5lbEVsUmVmLCAndG9wJywgYCR7Ym90dG9tfXB4YCk7XHJcbiAgICAgICAgICAgIHRoaXMucmVuZGVyLnJlbW92ZVN0eWxlKHRoaXMubGlzdFBhbmVsRWxSZWYsICd2aXNpYmlsaXR5Jyk7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBpZiAodG9wID4gdGhpcy5tYXhIZWlnaHQgfHwgdG9wID4gcGFuZWxIZWlnaHQpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyLnNldFN0eWxlKHRoaXMubGlzdFBhbmVsRWxSZWYsICd0b3AnLCBgJHt0b3AgLSBwYW5lbEhlaWdodH1weGApO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5yZW5kZXIuc2V0U3R5bGUodGhpcy5saXN0UGFuZWxFbFJlZiwgJ3RvcCcsICcwcHgnKTtcclxuICAgICAgICAgICAgICAgIGlmIChsZWZ0ID4gMjAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW5kZXIuc2V0U3R5bGUodGhpcy5saXN0UGFuZWxFbFJlZiwgJ2xlZnQnLCBgJHsgbGVmdCAtIDIwMCB9cHhgICk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5yZW5kZXIucmVtb3ZlU3R5bGUodGhpcy5saXN0UGFuZWxFbFJlZiwgJ3Zpc2liaWxpdHknKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn0iXX0=
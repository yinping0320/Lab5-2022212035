/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Optional, Injector } from '@angular/core';
/*
 * @Author: 胡玉洋(Yuyang)
 * @Date: 2019-08-29
 * @LastEditors:  胡玉洋(Yuyang)
 * @LastEditTime: 2019-08-29
 * @QQ: 664927877
 * @Version: v0.0.8
 */
import { Component, Input, forwardRef, Output, EventEmitter } from '@angular/core';
import { NG_VALUE_ACCESSOR } from '@angular/forms';
import { IdService, CommonUtils } from '@farris/ui-common';
export class FarrisCheckboxGroupComponent {
    /**
     * @param {?} idSer
     * @param {?} inject
     */
    constructor(idSer, inject) {
        this.idSer = idSer;
        this.inject = inject;
        this.tabIndex = 0;
        /* radio 数组 */
        this.data = [];
        /* 分隔符 默认逗号*/
        this.separator = ',';
        /* 值类型是否是string */
        this.isStringValue = true;
        this.textField = 'name';
        this.valueField = 'value';
        this.changeValue = new EventEmitter();
        /* checkbox赋值事件 */
        this.setCheckboxData = new EventEmitter();
        this.controlChange = (/**
         * @return {?}
         */
        () => { });
        this.controlTouch = (/**
         * @return {?}
         */
        () => { });
        if (this.inject) {
            this.commonUtils = this.inject.get(CommonUtils);
        }
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        // 初始化name
        this.name = this.idSer.generate().replace(/-/g, '_');
        this.setCheckboxData.emit(this);
        // todo 取值可以实现promise
        if (this.loadData) {
            this.loadDataSubscription = this.loadData().subscribe((/**
             * @param {?} res
             * @return {?}
             */
            res => this.data = res.data));
        }
    }
    /**
     * @param {?} changes
     * @return {?}
     */
    ngOnChanges(changes) {
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        if (this.loadDataSubscription) {
            this.loadDataSubscription.unsubscribe();
        }
    }
    /**
     * @param {?} item
     * @return {?}
     */
    _getText(item) {
        if (item) {
            if (this.commonUtils && this.commonUtils.getValue) {
                return this.commonUtils.getValue(this.textField, item);
            }
            else {
                return item[this.textField];
            }
        }
        else {
            return '';
        }
    }
    /**
     * @param {?} item
     * @return {?}
     */
    _getValue(item) {
        if (item) {
            if (this.commonUtils && this.commonUtils.getValue) {
                return this.commonUtils.getValue(this.valueField, item);
            }
            else {
                return item[this.valueField];
            }
        }
        else {
            return '';
        }
    }
    /* 选中input值 */
    /**
     * @param {?} item
     * @param {?} index
     * @return {?}
     */
    clickHandler(item, index) {
        /** @type {?} */
        let arrValue = this.transformToArr(this.value) || [];
        /** @type {?} */
        const val = String(this._getValue(item));
        if (!arrValue || !arrValue.length) {
            arrValue.push(val);
        }
        else {
            if (arrValue.some((/**
             * @param {?} item
             * @return {?}
             */
            item => item == val))) {
                arrValue = arrValue.filter((/**
                 * @param {?} n
                 * @return {?}
                 */
                n => n !== val));
            }
            else {
                arrValue.push(val);
            }
        }
        // 更新value值
        this.value = this.transformToStr(arrValue);
        // 传值formcontrol
        this.controlChange(this.value);
        this.controlTouch(this.value);
        this.changeValue.emit(this.value);
    }
    /* 被选中 */
    /**
     * @param {?} item
     * @return {?}
     */
    checked(item) {
        /** @type {?} */
        const val = String(this._getValue(item));
        /** @type {?} */
        const checkedValue = this.transformToArr(this.value);
        // 多值
        return checkedValue.some((/**
         * @param {?} item
         * @return {?}
         */
        item => item == val));
    }
    /* 值到数组值的转换 */
    /**
     * @param {?} value
     * @return {?}
     */
    transformToArr(value) {
        if (!value) {
            return [];
        }
        if (!this.isStringValue) {
            return value;
        }
        return value.split(this.separator);
    }
    /* 值到字符串值的转换 */
    /**
     * @param {?} value
     * @return {?}
     */
    transformToStr(value) {
        /** @type {?} */
        const allVals = this.data.map((/**
         * @param {?} n
         * @return {?}
         */
        n => this._getValue(n)));
        /** @type {?} */
        const r = [];
        allVals.forEach((/**
         * @param {?} n
         * @return {?}
         */
        n => {
            if (value.some((/**
             * @param {?} item
             * @return {?}
             */
            item => item == n))) {
                r.push(n);
            }
        }));
        if (!this.isStringValue) {
            return r;
        }
        return r.join(this.separator);
    }
    /**
     * @param {?} value
     * @return {?}
     */
    writeValue(value) {
        this.value = value;
    }
    /* change操作值变化  方法重写*/
    /**
     * @param {?} fn
     * @return {?}
     */
    registerOnChange(fn) {
        this.controlChange = fn;
    }
    /* blur值变化  方法重写*/
    /**
     * @param {?} fn
     * @return {?}
     */
    registerOnTouched(fn) {
        this.controlTouch = fn;
    }
}
FarrisCheckboxGroupComponent.decorators = [
    { type: Component, args: [{
                selector: 'farris-checkboxgroup',
                template: "<div class=\"farris-input-wrap\" [class.farris-checkradio-hor]=\"horizontal\">\r\n    <div class=\"custom-control custom-checkbox\" *ngFor=\"let item of data; let i = index\">\r\n        <input #input class=\"custom-control-input\" [name]=\"name\" id=\"{{ 'checkbox_' + name + i }}\"\r\n            type=\"checkbox\" [value]=\"_getValue(item)\" [checked]=\"checked(item)\" [disabled]=\"disable\" (click)=\"clickHandler(item, i)\" \r\n            tabindex=\"{{ tabIndex + i }}\" />\r\n        <label class=\"custom-control-label\" for=\"{{ 'checkbox_' + name + i }}\" title=\"{{_getText(item)}}\">{{ _getText(item) }}</label>\r\n    </div>\r\n</div>\r\n",
                providers: [{
                        provide: NG_VALUE_ACCESSOR,
                        useExisting: forwardRef((/**
                         * @return {?}
                         */
                        () => FarrisCheckboxGroupComponent)),
                        multi: true,
                    }],
                exportAs: 'FarrisCheckboxGroupComponent'
            }] }
];
/** @nocollapse */
FarrisCheckboxGroupComponent.ctorParameters = () => [
    { type: IdService },
    { type: Injector, decorators: [{ type: Optional }] }
];
FarrisCheckboxGroupComponent.propDecorators = {
    tabIndex: [{ type: Input, args: ['tab-index',] }],
    data: [{ type: Input }],
    type: [{ type: Input }],
    name: [{ type: Input }],
    horizontal: [{ type: Input }],
    separator: [{ type: Input }],
    disable: [{ type: Input }],
    value: [{ type: Input }],
    isStringValue: [{ type: Input }],
    textField: [{ type: Input }],
    valueField: [{ type: Input }],
    loadData: [{ type: Input }],
    changeValue: [{ type: Output }],
    setCheckboxData: [{ type: Output }]
};
if (false) {
    /** @type {?} */
    FarrisCheckboxGroupComponent.prototype.tabIndex;
    /** @type {?} */
    FarrisCheckboxGroupComponent.prototype.data;
    /** @type {?} */
    FarrisCheckboxGroupComponent.prototype.type;
    /** @type {?} */
    FarrisCheckboxGroupComponent.prototype.name;
    /** @type {?} */
    FarrisCheckboxGroupComponent.prototype.horizontal;
    /** @type {?} */
    FarrisCheckboxGroupComponent.prototype.separator;
    /** @type {?} */
    FarrisCheckboxGroupComponent.prototype.disable;
    /** @type {?} */
    FarrisCheckboxGroupComponent.prototype.value;
    /** @type {?} */
    FarrisCheckboxGroupComponent.prototype.isStringValue;
    /** @type {?} */
    FarrisCheckboxGroupComponent.prototype.textField;
    /** @type {?} */
    FarrisCheckboxGroupComponent.prototype.valueField;
    /**
     * 加载数据事件
     * @type {?}
     */
    FarrisCheckboxGroupComponent.prototype.loadData;
    /** @type {?} */
    FarrisCheckboxGroupComponent.prototype.loadDataSubscription;
    /** @type {?} */
    FarrisCheckboxGroupComponent.prototype.changeValue;
    /** @type {?} */
    FarrisCheckboxGroupComponent.prototype.setCheckboxData;
    /**
     * @type {?}
     * @private
     */
    FarrisCheckboxGroupComponent.prototype.commonUtils;
    /**
     * @type {?}
     * @private
     */
    FarrisCheckboxGroupComponent.prototype.controlChange;
    /**
     * @type {?}
     * @private
     */
    FarrisCheckboxGroupComponent.prototype.controlTouch;
    /**
     * @type {?}
     * @private
     */
    FarrisCheckboxGroupComponent.prototype.idSer;
    /**
     * @type {?}
     * @private
     */
    FarrisCheckboxGroupComponent.prototype.inject;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2hlY2tib3hncm91cC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL3VpLWZvcm1zLyIsInNvdXJjZXMiOlsibGliL2NoZWNrYm94L2NoZWNrYm94Z3JvdXAuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQXVDLFFBQVEsRUFBRSxRQUFRLEVBQUUsTUFBTSxlQUFlLENBQUM7Ozs7Ozs7OztBQVN4RixPQUFPLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBRSxVQUFVLEVBQVUsTUFBTSxFQUFFLFlBQVksRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUMzRixPQUFPLEVBQUUsaUJBQWlCLEVBQXdCLE1BQU0sZ0JBQWdCLENBQUM7QUFDekUsT0FBTyxFQUFFLFNBQVMsRUFBRSxXQUFXLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQWMzRCxNQUFNLE9BQU8sNEJBQTRCOzs7OztJQTBDckMsWUFBb0IsS0FBZ0IsRUFBc0IsTUFBZ0I7UUFBdEQsVUFBSyxHQUFMLEtBQUssQ0FBVztRQUFzQixXQUFNLEdBQU4sTUFBTSxDQUFVO1FBeEN0RCxhQUFRLEdBQUcsQ0FBQyxDQUFDOztRQUd4QixTQUFJLEdBQVUsRUFBRSxDQUFDOztRQVlqQixjQUFTLEdBQUcsR0FBRyxDQUFDOztRQVNoQixrQkFBYSxHQUFHLElBQUksQ0FBQztRQUVyQixjQUFTLEdBQUcsTUFBTSxDQUFDO1FBQ25CLGVBQVUsR0FBRyxPQUFPLENBQUM7UUFNcEIsZ0JBQVcsR0FBRyxJQUFJLFlBQVksRUFBTyxDQUFDOztRQUd0QyxvQkFBZSxHQUFHLElBQUksWUFBWSxFQUFPLENBQUM7UUFrSTVDLGtCQUFhOzs7UUFBeUIsR0FBRyxFQUFFLEdBQUcsQ0FBQyxFQUFDO1FBQ2hELGlCQUFZOzs7UUFBeUIsR0FBRyxFQUFFLEdBQUcsQ0FBQyxFQUFDO1FBOUhuRCxJQUFJLElBQUksQ0FBQyxNQUFNLEVBQUU7WUFDYixJQUFJLENBQUMsV0FBVyxHQUFH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QzVCLGtEQUE4Qjs7Ozs7SUFHOUIsZ0RBQTBEOztJQUMxRCw0REFBbUM7O0lBRW5DLG1EQUFnRDs7SUFHaEQsdURBQW9EOzs7OztJQUVwRCxtREFBaUM7Ozs7O0lBZ0lqQyxxREFBd0Q7Ozs7O0lBQ3hELG9EQUF1RDs7Ozs7SUEvSDNDLDZDQUF3Qjs7Ozs7SUFBRSw4Q0FBb0MiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBPbkRlc3Ryb3ksIFNpbXBsZUNoYW5nZXMsIE9uQ2hhbmdlcywgT3B0aW9uYWwsIEluamVjdG9yIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbi8qXHJcbiAqIEBBdXRob3I6IOiDoeeOiea0iyhZdXlhbmcpXHJcbiAqIEBEYXRlOiAyMDE5LTA4LTI5XHJcbiAqIEBMYXN0RWRpdG9yczogIOiDoeeOiea0iyhZdXlhbmcpXHJcbiAqIEBMYXN0RWRpdFRpbWU6IDIwMTktMDgtMjlcclxuICogQFFROiA2NjQ5Mjc4NzdcclxuICogQFZlcnNpb246IHYwLjAuOFxyXG4gKi9cclxuaW1wb3J0IHsgQ29tcG9uZW50LCBJbnB1dCwgZm9yd2FyZFJlZiwgT25Jbml0LCBPdXRwdXQsIEV2ZW50RW1pdHRlciB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBOR19WQUxVRV9BQ0NFU1NPUiwgQ29udHJvbFZhbHVlQWNjZXNzb3IgfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XHJcbmltcG9ydCB7IElkU2VydmljZSwgQ29tbW9uVXRpbHMgfSBmcm9tICdAZmFycmlzL3VpLWNvbW1vbic7XHJcbmltcG9ydCB7IEh0dHBDbGllbnQgfSBmcm9tICdAYW5ndWxhci9jb21tb24vaHR0cCc7XHJcbmltcG9ydCB7IE9ic2VydmFibGUsIFN1YnNjcmlwdGlvbiB9IGZyb20gJ3J4anMnO1xyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgICBzZWxlY3RvcjogJ2ZhcnJpcy1jaGVja2JveGdyb3VwJyxcclxuICAgIHRlbXBsYXRlVXJsOiAnLi9jaGVja2JveGdyb3VwLmNvbXBvbmVudC5odG1sJyxcclxuICAgIHByb3ZpZGVyczogW3tcclxuICAgICAgICBwcm92aWRlOiBOR19WQUxVRV9BQ0NFU1NPUixcclxuICAgICAgICB1c2VFeGlzdGluZzogZm9yd2FyZFJlZigoKSA9PiBGYXJyaXNDaGVja2JveEdyb3VwQ29tcG9uZW50KSxcclxuICAgICAgICBtdWx0aTogdHJ1ZSxcclxuICAgIH1dLFxyXG4gICAgZXhwb3J0QXM6ICdGYXJyaXNDaGVja2JveEdyb3VwQ29tcG9uZW50J1xyXG59KVxyXG5leHBvcnQgY2xhc3MgRmFycmlzQ2hlY2tib3hHcm91cENvbXBvbmVudCBpbXBsZW1lbnRzIENvbnRyb2xWYWx1ZUFjY2Vzc29yLCBPbkluaXQsIE9uRGVzdHJveSwgT25DaGFuZ2VzIHtcclxuXHJcbiAgICBASW5wdXQoJ3RhYi1pbmRleCcpIHRhYkluZGV4ID0gMDtcclxuXHJcbiAgICAvKiByYWRpbyDmlbDnu4QgKi9cclxuICAgIEBJbnB1dCgpIGRhdGE6IGFueVtdID0gW107XHJcblxyXG4gICAgLyogY2hlY2tib3gg57G75Z6LICAg5Y6f55Sf5oiW6ICF5oyJ6ZKu57G75Z6LKi9cclxuICAgIEBJbnB1dCgpIHR5cGU6IHN0cmluZztcclxuXHJcbiAgICAvKiDlpI3pgInmoYZuYW1lICovXHJcbiAgICBASW5wdXQoKSBuYW1lOiBzdHJpbmc7XHJcblxyXG4gICAgLyog5piv5ZCm5rC05bmz5YiG5biDICovXHJcbiAgICBASW5wdXQoKSBob3Jpem9udGFsOiBib29sZWFuO1xyXG5cclxuICAgIC8qIOWIhumalOespiDpu5jorqTpgJflj7cqL1xyXG4gICAgQElucHV0KCkgc2VwYXJhdG9yID0gJywnO1xyXG5cclxuICAgIC8qIOemgeeUqCAqL1xyXG4gICAgQElucHV0KCkgZGlzYWJsZTogYm9vbGVhbjtcclxuXHJcbiAgICAvKiDlpI3pgInmoYbnu4TnmoTlgLwgKi9cclxuICAgIEBJbnB1dCgpIHZhbHVlOiBhbnk7XHJcblxyXG4gICAgLyog5YC857G75Z6L5piv5ZCm5pivc3RyaW5nICovXHJcbiAgICBASW5wdXQoKSBpc1N0cmluZ1ZhbHVlID0gdHJ1ZTtcclxuXHJcbiAgICBASW5wdXQoKSB0ZXh0RmllbGQgPSAnbmFtZSc7XHJcbiAgICBASW5wdXQoKSB2YWx1ZUZpZWxkID0gJ3ZhbHVlJztcclxuXHJcbiAgICAvKiog5Yqg6L295pWw5o2u5LqL5Lu2ICovXHJcbiAgICBASW5wdXQoKSBsb2FkRGF0YTogKGVtcHR5RGF0YT86IGFueVtdKSA9PiBPYnNlcnZhYmxlPGFueT47XHJcbiAgICBsb2FkRGF0YVN1YnNjcmlwdGlvbjogU3Vic2NyaXB0aW9uO1xyXG5cclxuICAgIEBPdXRwdXQoKSBjaGFuZ2VWYWx1ZSA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xyXG5cclxuICAgIC8qIGNoZWNrYm946LWL5YC85LqL5Lu2ICovXHJcbiAgICBAT3V0cHV0KCkgc2V0Q2hlY2tib3hEYXRhID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XHJcblxyXG4gICAgcHJpdmF0ZSBjb21tb25VdGlsczogQ29tbW9uVXRpbHM7XHJcblxyXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBpZFNlcjogSWRTZXJ2aWNlLCBAT3B0aW9uYWwoKSBwcml2YXRlIGluamVjdDogSW5qZWN0b3IpIHtcclxuICAgICAgICBpZiAodGhpcy5pbmplY3QpIHtcclxuICAgICAgICAgICAgdGhpcy5jb21tb25VdGlscyA9IHRoaXMuaW5qZWN0LmdldChDb21tb25VdGlscyk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIG5nT25Jbml0KCkge1xyXG4gICAgICAgIC8vIOWIneWni+WMlm5hbWVcclxuICAgICAgICB0aGlzLm5hbWUgPSB0aGlzLmlkU2VyLmdlbmVyYXRlKCkucmVwbGFjZSgvLS9nLCAnXycpO1xyXG5cclxuICAgICAgICB0aGlzLnNldENoZWNrYm94RGF0YS5lbWl0KHRoaXMpO1xyXG4gICAgICAgIC8vIHRvZG8g5Y+W5YC85Y+v5Lul5a6e546wcHJvbWlzZVxyXG4gICAgICAgIGlmICh0aGlzLmxvYWREYXRhKSB7XHJcbiAgICAgICAgICAgIHRoaXMubG9hZERhdGFTdWJzY3JpcHRpb24gPSB0aGlzLmxvYWREYXRhKCkuc3Vic2NyaWJlKHJlcyA9PiB0aGlzLmRhdGEgPSByZXMuZGF0YSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpIHtcclxuICAgIH1cclxuXHJcbiAgICBuZ09uRGVzdHJveSgpIHtcclxuICAgICAgICBpZiAodGhpcy5sb2FkRGF0YVN1YnNjcmlwdGlvbikge1xyXG4gICAgICAgICAgICB0aGlzLmxvYWREYXRhU3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIF9nZXRUZXh0KGl0ZW0pIHtcclxuICAgICAgICBpZiAoaXRlbSkge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5jb21tb25VdGlscyAmJiB0aGlzLmNvbW1vblV0aWxzLmdldFZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5jb21tb25VdGlscy5nZXRWYWx1ZSh0aGlzLnRleHRGaWVsZCwgaXRlbSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gaXRlbVt0aGlzLnRleHRGaWVsZF07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICByZXR1cm4gJyc7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIF9nZXRWYWx1ZShpdGVtKSB7XHJcbiAgICAgICAgaWYgKGl0ZW0pIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMuY29tbW9uVXRpbHMgJiYgdGhpcy5jb21tb25VdGlscy5nZXRWYWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuY29tbW9uVXRpbHMuZ2V0VmFsdWUodGhpcy52YWx1ZUZpZWxkLCBpdGVtKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBpdGVtW3RoaXMudmFsdWVGaWVsZF07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICByZXR1cm4gJyc7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8qIOmAieS4rWlucHV05YC8ICovXHJcbiAgICBjbGlja0hhbmRsZXIoaXRlbTogYW55LCBpbmRleDogbnVtYmVyKSB7XHJcbiAgICAgICAgbGV0IGFyclZhbHVlID0gdGhpcy50cmFuc2Zvcm1Ub0Fycih0aGlzLnZhbHVlKSB8fCBbXTtcclxuXHJcbiAgICAgICAgY29uc3QgdmFsID0gU3RyaW5nKHRoaXMuX2dldFZhbHVlKGl0ZW0pKTtcclxuICAgICAgICBpZiAoIWFyclZhbHVlIHx8ICFhcnJWYWx1ZS5sZW5ndGgpIHtcclxuICAgICAgICAgICAgYXJyVmFsdWUucHVzaCh2YWwpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGlmIChhcnJWYWx1ZS5zb21lKGl0ZW0gPT4gaXRlbSA9PSB2YWwpKSB7XHJcbiAgICAgICAgICAgICAgICBhcnJWYWx1ZSA9IGFyclZhbHVlLmZpbHRlcihuID0+IG4gIT09IHZhbCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBhcnJWYWx1ZS5wdXNoKHZhbCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIOabtOaWsHZhbHVl5YC8XHJcbiAgICAgICAgdGhpcy52YWx1ZSA9IHRoaXMudHJhbnNmb3JtVG9TdHIoYXJyVmFsdWUpO1xyXG5cclxuICAgICAgICAvLyDkvKDlgLxmb3JtY29udHJvbFxyXG4gICAgICAgIHRoaXMuY29udHJvbENoYW5nZSh0aGlzLnZhbHVlKTtcclxuICAgICAgICB0aGlzLmNvbnRyb2xUb3VjaCh0aGlzLnZhbHVlKTtcclxuICAgICAgICB0aGlzLmNoYW5nZVZhbHVlLmVtaXQodGhpcy52YWx1ZSk7XHJcbiAgICB9XHJcblxyXG4gICAgLyog6KKr6YCJ5LitICovXHJcbiAgICBjaGVja2VkKGl0ZW06IGFueSkge1xyXG4gICAgICAgIGNvbnN0IHZhbCA9IFN0cmluZyh0aGlzLl9nZXRWYWx1ZShpdGVtKSk7XHJcbiAgICAgICAgY29uc3QgY2hlY2tlZFZhbHVlID0gdGhpcy50cmFuc2Zvcm1Ub0Fycih0aGlzLnZhbHVlKTtcclxuICAgICAgICAvLyDlpJrlgLxcclxuICAgICAgICByZXR1cm4gY2hlY2tlZFZhbHVlLnNvbWUoaXRlbSA9PiBpdGVtID09IHZhbCk7XHJcbiAgICB9XHJcblxyXG4gICAgLyog5YC85Yiw5pWw57uE5YC855qE6L2s5o2iICovXHJcbiAgICB0cmFuc2Zvcm1Ub0Fycih2YWx1ZTogYW55KTogc3RyaW5nW10ge1xyXG4gICAgICAgIGlmICghdmFsdWUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIFtdO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoIXRoaXMuaXNTdHJpbmdWYWx1ZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gdmFsdWU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gdmFsdWUuc3BsaXQodGhpcy5zZXBhcmF0b3IpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qIOWAvOWIsOWtl+espuS4suWAvOeahOi9rOaNoiAqL1xyXG4gICAgdHJhbnNmb3JtVG9TdHIodmFsdWU6IEFycmF5PHN0cmluZz4pIHtcclxuXHJcbiAgICAgICAgY29uc3QgYWxsVmFscyA9IHRoaXMuZGF0YS5tYXAobiA9PiB0aGlzLl9nZXRWYWx1ZShuKSk7XHJcbiAgICAgICAgY29uc3QgciA9IFtdO1xyXG4gICAgICAgIGFsbFZhbHMuZm9yRWFjaChuID0+IHtcclxuICAgICAgICAgICAgaWYgKHZhbHVlLnNvbWUoaXRlbSA9PiBpdGVtID09IG4pKSB7XHJcbiAgICAgICAgICAgICAgICByLnB1c2gobik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaWYgKCF0aGlzLmlzU3RyaW5nVmFsdWUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHI7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiByLmpvaW4odGhpcy5zZXBhcmF0b3IpO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICB3cml0ZVZhbHVlKHZhbHVlOiBhbnkpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLnZhbHVlID0gdmFsdWU7XHJcbiAgICB9XHJcblxyXG4gICAgLyogY2hhbmdl5pON5L2c5YC85Y+Y5YyWICDmlrnms5Xph43lhpkqL1xyXG4gICAgcmVnaXN0ZXJPbkNoYW5nZShmbjogKCkgPT4gdm9pZCk6IHZvaWQge1xyXG4gICAgICAgIHRoaXMuY29udHJvbENoYW5nZSA9IGZuO1xyXG4gICAgfVxyXG5cclxuICAgIC8qIGJsdXLlgLzlj5jljJYgIOaWueazlemHjeWGmSovXHJcbiAgICByZWdpc3Rlck9uVG91Y2hlZChmbjogKCkgPT4gdm9pZCk6IHZvaWQge1xyXG4gICAgICAgIHRoaXMuY29udHJvbFRvdWNoID0gZm47XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBjb250cm9sQ2hhbmdlOiAodmFsdWU6IGFueSkgPT4gdm9pZCA9ICgpID0+IHsgfTtcclxuICAgIHByaXZhdGUgY29udHJvbFRvdWNoOiAodmFsdWU6IGFueSkgPT4gdm9pZCA9ICgpID0+IHsgfTtcclxuXHJcbn1cclxuIl19
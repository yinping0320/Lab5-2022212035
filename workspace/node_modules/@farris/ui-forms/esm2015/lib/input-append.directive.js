/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Directive, ElementRef, Renderer2, Injector, Input, Output, ViewContainerRef, NgZone } from '@angular/core';
import { EventEmitter } from '@angular/core';
export class InputAppendDirective {
    // private ngControl: NgControl;
    /**
     * @param {?} viewRef
     * @param {?} el
     * @param {?} render
     * @param {?} injector
     */
    constructor(viewRef, el, render, injector) {
        this.viewRef = viewRef;
        this.el = el;
        this.render = render;
        this.injector = injector;
        this._enableAppend = true;
        // 应用场景，默认这个功能是在简单表格 Table
        // 追加一个场景在普通表单上 Form
        this._appendScene = 'Table';
        // 追加到哪个类型下 TextBox、MultiTextBox、 StaticText
        this.inputAppendControlType = 'InputGroup';
        // 根据类型不一样，在控件处于禁用、只读时，决定颜色是否可用
        // 有两种：按钮 button 文本 text
        this._appendType = 'button';
        // 追加的文本
        this._inputAppendText = '';
        // 模板
        // @Input() inputAppendTmpl: TemplateRef<any>;
        this._disabled = false;
        // 当_appendCls为空时，
        this._appendCls = 'input-group-text';
        /*
            * 文本点击事件
            */
        this.inputAppendClickEvent = new EventEmitter();
        // 标记native的外层
        this.elWrapElement = null;
        // 标记元素
        this.appendWrapElement = null;
        // 暂时不用
        this.appendTextElement = null;
        this.clickHandler = null;
        this.disabledCls = 'f-state-disabled';
        this.ngZone = null;
        this.ngZone = this.injector.get(NgZone);
    }
    // 相当于启用禁用此功能
    /**
     * @param {?} value
     * @return {?}
     */
    set enableAppend(value) {
        if (value === '' || value) {
            this._enableAppend = true;
            // 需要
            if (!this.appendWrapElement) {
                this.createStruct();
            }
        }
        else {
            this._enableAppend = false;
            if (this.appendWrapElement) {
                this.resetStruct();
            }
        }
    }
    /**
     * @return {?}
     */
    get enableAppend() {
        return this._enableAppend;
    }
    /**
     * @param {?} val
     * @return {?}
     */
    set inputAppendScene(val) {
        // 支持这两个场景
        val = val == 'Form' ? 'Form' : 'Table';
        if (val != this._appendScene) {
            switch (this.inputAppendControlType) {
                case 'StaticText':
                    this.render.removeClass(this.el.nativeElement, 'f-cmp-input-append-' + this._appendScene.toLowerCase());
                    this.render.addClass(this.el.nativeElement, 'f-cmp-input-append-' + val.toLowerCase());
                    break;
                case 'TextBox':
                case 'MultiTextBox':
                    if (this.elWrapElement) {
                        this.elWrapElement.className = this.elWrapElement.className.replace('f-cmp-input-append-' + this._appendScene.toLowerCase(), 'f-cmp-input-append-' + val.toLowerCase());
                    }
                    break;
            }
            this._appendScene = val;
            this.modifyPaddingRight();
        }
    }
    /**
     * @return {?}
     */
    get inputAppendScene() {
        return this._appendScene;
    }
    /**
     * @param {?} value
     * @return {?}
     */
    set inputAppendType(value) {
        if (value) {
            if (['button', 'text'].findIndex((/**
             * @param {?} item
             * @return {?}
             */
            item => item == value)) < 0) {
                // 类型在支持范围内
                value = 'button';
            }
            if (value != this._appendType) {
                if (this.appendWrapElement) {
                    // 移除原来，追加新的
                    this.render.removeClass(this.appendWrapElement, 'input-append-' + this._appendType);
                    this.render.addClass(this.appendWrapElement, 'input-append-' + value);
                    if (this._appendType == 'button') {
                        // 原来是按钮
                        if (this.clickHandler) {
                            this.clickHandler();
                            this.clickHandler = null;
                        }
                    }
                    else {
                        this.clickHandler = this.render.listen(this.appendWrapElement, 'click', (/**
                         * @param {?} ev
                         * @return {?}
                         */
                        (ev) => {
                            this.inputAppendClickEvent.emit(ev);
                        }));
                    }
                }
                this._appendType = value;
                this.modifyPaddingRight();
            }
        }
    }
    /**
     * @return {?}
     */
    get inputAppendType() {
        return this._appendType;
    }
    /**
     * @param {?} value
     * @return {?}
     */
    set inputAppendText(value) {
        if (value != this._inputAppendText) {
            this._inputAppendText = value;
            if (this.appendWrapElement && this._enableAppend) {
                this.render.removeChild(this.appendWrapElement, this.appendTextElement);
                this.appendTextElement.innerHTML = value;
                this.render.appendChild(this.appendWrapElement, this.appendTextElement);
                this.modifyPaddingRight();
            }
            else {
                this.createStruct();
            }
        }
    }
    /**
     * @return {?}
     */
    get inputAppendText() {
        return this._inputAppendText;
    }
    /**
     * @param {?} value
     * @return {?}
     */
    set inputAppendDisabled(value) {
        if (value != this._disabled) {
            this._disabled = value;
            if (this.appendWrapElement) {
                value && this.render.addClass(this.appendWrapElement, this.disabledCls);
                !value && this.render.removeClass(this.appendWrapElement, this.disabledCls);
            }
            this.modifyPaddingRight();
        }
    }
    /**
     * @return {?}
     */
    get inputAppendDisabled() {
        return this._disabled;
    }
    /**
     * @param {?} val
     * @return {?}
     */
    set inputAppendCls(val) {
        if (val != this._appendCls) {
            val = val ? val : 'input-group-text';
            if (this.appendTextElement) {
                this.appendTextElement.className = val;
            }
            this._appendCls = val;
        }
    }
    /**
     * @return {?}
     */
    get inputAppendCls() {
        return this._appendCls;
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        //this.ngControl = this.injector.get(NgControl, null);
    }
    /**
     * @return {?}
     */
    ngAfterViewInit() {
        this.createStruct();
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        //this.resetStruct();
        if (this.clickHandler) {
            this.clickHandler();
            this.clickHandler = null;
        }
        if (this.appendWrapElement) {
            this.appendWrapElement.remove();
            this.appendWrapElement = null;
        }
        if (this.elWrapElement) {
            this.elWrapElement.remove();
            this.elWrapElement = null;
        }
    }
    /**
     * 重置
     * @private
     * @return {?}
     */
    resetStruct() {
        if (this.clickHandler) {
            this.clickHandler();
            this.clickHandler = null;
        }
        // 分类型移除不同新增加的结构或样式
        switch (this.inputAppendControlType) {
            case 'StaticText':
                this.render.removeClass(this.el.nativeElement, 'f-cmp-static-text-input-append');
                this.render.removeClass(this.el.nativeElement, 'f-cmp-input-append-' + this.inputAppendScene.toLowerCase());
                break;
            case 'TextBox':
            case 'MultiTextBox':
                if (this.elWrapElement) {
                    /** @type {?} */
                    let wrapParent = this.render.parentNode(this.elWrapElement);
                    this.render.appendChild(wrapParent, this.el.nativeElement);
                    this.elWrapElement.remove();
                    this.elWrapElement = null;
                }
                break;
        }
        if (this.appendWrapElement) {
            this.appendWrapElement.remove();
            this.appendWrapElement = null;
        }
        this.modifyPaddingRight();
    }
    /**
     * 创建插入结构
     * @private
     * @return {?}
     */
    createStruct() {
        if (!this.inputAppendText || !this.enableAppend || this.appendWrapElement) {
            return;
        }
        /** @type {?} */
        const buttonWrap = this.render.createElement('div');
        buttonWrap.className = 'input-group-append input-append-wrapper';
        buttonWrap.className += ' input-append-' + this.inputAppendType;
        if (this._disabled) {
            buttonWrap.className += ' ' + this.disabledCls;
        }
        /** @type {?} */
        const buttonTextWrap = this.render.createElement('div');
        buttonTextWrap.className = this.inputAppendCls;
        buttonTextWrap.innerHTML = this.inputAppendText;
        this.appendTextElement = buttonTextWrap;
        this.appendWrapElement = buttonWrap;
        this.render.appendChild(buttonWrap, buttonTextWrap);
        switch (this.inputAppendControlType) {
            case 'StaticText':
                // 此时还没有生成内部的样式
                // let textareaEl = this.el.nativeElement.querySelector('.f-form-control-textarea');
                /** @type {?} */
                let clsNames = 'f-cmp-static-text-input-append' + (' f-cmp-input-append-' + this.inputAppendScene.toLowerCase()) + (this._disabled ? ' ' + this.disabledCls : '');
                clsNames.split(' ').map((/**
                 * @param {?} tclsName
                 * @return {?}
                 */
                (tclsName) => {
                    this.render.addClass(this.el.nativeElement, tclsName);
                }));
                this.render.appendChild(this.el.nativeElement, buttonWrap);
                break;
            case 'TextBox':
            case 'MultiTextBox':
                /** @type {?} */
                let textParent = this.render.parentNode(this.el.nativeElement);
                /** @type {?} */
                const inputWrap = this.render.createElement('div');
                inputWrap.className = 'f-cmp-text-input-append f-cmp-input-append-' + this.inputAppendScene.toLowerCase() + (this._disabled ? ' ' + this.disabledCls : '');
                if (this.el.nativeElement.outerHTML.indexOf('textarea') > -1) {
                    inputWrap.className = 'f-cmp-textarea-input-append f-cmp-input-append-' + this.inputAppendScene.toLowerCase() + (this._disabled ? ' ' + this.disabledCls : '');
                }
                this.elWrapElement = inputWrap;
                this.render.appendChild(inputWrap, this.el.nativeElement);
                this.render.appendChild(inputWrap, buttonWrap);
                this.render.appendChild(textParent, inputWrap);
                break;
            default:
                // 存在类似下拉这样的控件，内部调用input-group结构还没有初始化
                /** @type {?} */
                let inputGroupEl = this.el.nativeElement.querySelector('.input-group');
                if (inputGroupEl) {
                    this.render.appendChild(inputGroupEl, buttonWrap);
                }
                else {
                    if (this.ngZone) {
                        this.ngZone.runOutsideAngular((/**
                         * @return {?}
                         */
                        () => {
                            setTimeout((/**
                             * @return {?}
                             */
                            () => {
                                /** @type {?} */
                                let inputGroupEl2 = this.el.nativeElement.querySelector('.input-group');
                                this.render.appendChild(inputGroupEl2, buttonWrap);
                            }));
                        }));
                    }
                }
        }
        if (this.inputAppendType == 'button') {
            this.clickHandler = this.render.listen(this.appendWrapElement, 'click', (/**
             * @param {?} ev
             * @return {?}
             */
            (ev) => {
                if (!this.inputAppendDisabled) {
                    this.inputAppendClickEvent.emit(ev);
                }
            }));
        }
        this.modifyPaddingRight();
    }
    /**
     * 因为在普通输入框、静态文本、多行文本框展示时，界面样式问题。
     * 所以需要单独处理，通过absolute定位，设置间距，保持界面一致
     * @private
     * @return {?}
     */
    modifyPaddingRight() {
        /** @type {?} */
        let findType = ['StaticText', 'TextBox', 'MultiTextBox'].find((/**
         * @param {?} typeItem
         * @return {?}
         */
        typeItem => typeItem == this.inputAppendControlType));
        if (this.inputAppendScene == 'Form' && findType) {
            /** @type {?} */
            let changeEl = findType == 'StaticText' ? this.el.nativeElement.querySelector('span') : this.el.nativeElement;
            if (this.enableAppend && !this._disabled && this.appendWrapElement) {
                //window.getComputhis.appendWrapElement
                /** @type {?} */
                const tRectObj = this.appendWrapElement.getBoundingClientRect();
                this.render.setStyle(changeEl, 'paddingRight', tRectObj.width + 'px');
            }
            else {
                this.render.removeStyle(changeEl, 'paddingRight');
            }
        }
    }
}
InputAppendDirective.decorators = [
    { type: Directive, args: [{
                selector: '[input-append]',
            },] }
];
/** @nocollapse */
InputAppendDirective.ctorParameters = () => [
    { type: ViewContainerRef },
    { type: ElementRef },
    { type: Renderer2 },
    { type: Injector }
];
InputAppendDirective.propDecorators = {
    enableAppend: [{ type: Input, args: ['input-append',] }],
    inputAppendScene: [{ type: Input }],
    inputAppendControlType: [{ type: Input }],
    inputAppendType: [{ type: Input }],
    inputAppendText: [{ type: Input }],
    inputAppendDisabled: [{ type: Input }],
    inputAppendCls: [{ type: Input }],
    inputAppendClickEvent: [{ type: Output }]
};
if (false) {
    /**
     * @type {?}
     * @private
     */
    InputAppendDirective.prototype._enableAppend;
    /**
     * @type {?}
     * @private
     */
    InputAppendDirective.prototype._appendScene;
    /** @type {?} */
    InputAppendDirective.prototype.inputAppendControlType;
    /**
     * @type {?}
     * @private
     */
    InputAppendDirective.prototype._appendType;
    /**
     * @type {?}
     * @private
     */
    InputAppendDirective.prototype._inputAppendText;
    /**
     * @type {?}
     * @private
     */
    InputAppendDirective.prototype._disabled;
    /**
     * @type {?}
     * @private
     */
    InputAppendDirective.prototype._appendCls;
    /** @type {?} */
    InputAppendDirective.prototype.inputAppendClickEvent;
    /**
     * @type {?}
     * @private
     */
    InputAppendDirective.prototype.elWrapElement;
    /**
     * @type {?}
     * @private
     */
    InputAppendDirective.prototype.appendWrapElement;
    /**
     * @type {?}
     * @private
     */
    InputAppendDirective.prototype.appendTextElement;
    /**
     * @type {?}
     * @private
     */
    InputAppendDirective.prototype.clickHandler;
    /**
     * @type {?}
     * @private
     */
    InputAppendDirective.prototype.disabledCls;
    /**
     * @type {?}
     * @private
     */
    InputAppendDirective.prototype.ngZone;
    /**
     * @type {?}
     * @private
     */
    InputAppendDirective.prototype.viewRef;
    /**
     * @type {?}
     * @private
     */
    InputAppendDirective.prototype.el;
    /**
     * @type {?}
     * @private
     */
    InputAppendDirective.prototype.render;
    /**
     * @type {?}
     * @private
     */
    InputAppendDirective.prototype.injector;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5wdXQtYXBwZW5kLmRpcmVjdGl2ZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvdWktZm9ybXMvIiwic291cmNlcyI6WyJsaWIvaW5wdXQtYXBwZW5kLmRpcmVjdGl2ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUNILFNBQVMsRUFBRSxVQUFVLEVBQUUsU0FBUyxFQUFFLFFBQVEsRUFBVSxLQUFLLEVBQ0wsTUFBTSxFQUFFLGdCQUFnQixFQUFlLE1BQU0sRUFDcEcsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLGVBQWUsQ0FBQztBQU03QyxNQUFNLE9BQU8sb0JBQW9COzs7Ozs7OztJQXVKN0IsWUFBb0IsT0FBeUIsRUFBVSxFQUFjLEVBQVUsTUFBaUIsRUFBVSxRQUFrQjtRQUF4RyxZQUFPLEdBQVAsT0FBTyxDQUFrQjtRQUFVLE9BQUUsR0FBRixFQUFFLENBQVk7UUFBVSxXQUFNLEdBQU4sTUFBTSxDQUFXO1FBQVUsYUFBUSxHQUFSLFFBQVEsQ0FBVTtRQXRKcEgsa0JBQWEsR0FBRyxJQUFJLENBQUM7OztRQXNCckIsaUJBQVksR0FBQyxPQUFPLENBQUM7O1FBMEJwQiwyQkFBc0IsR0FBRyxZQUFZLENBQUM7OztRQUd2QyxnQkFBVyxHQUFHLFFBQVEsQ0FBQzs7UUFtQ3ZCLHFCQUFnQixHQUFHLEVBQUUsQ0FBQzs7O1FBb0J0QixjQUFTLEdBQUcsS0FBSyxDQUFDOztRQWdCbEIsZUFBVSxHQUFDLGtCQUFrQixDQUFDOzs7O1FBaUI1QiwwQkFBcUIsR0FBRyxJQUFJLFlBQVksRUFBRSxDQUFDOztRQUU3QyxrQkFBYSxHQUFHLElBQUksQ0FBQzs7UUFFckIsc0JBQWlCLEdBQUcsSUFBSSxDQUFDOztRQUV6QixzQkFBaUIsR0FBRyxJQUFJLENBQUM7UUFDekIsaUJBQVksR0FBRyxJQUFJLENBQUM7UUFDcEIsZ0JBQVcsR0FBRyxrQkFBa0IsQ0FBQztRQUNqQyxXQUFNLEdBQVcs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ckcsSUFBRyxJQUFJLENBQUMsWUFBWSxJQUFFLENBQUMsSUFBSSxDQUFDLFNBQVMsSUFBRSxJQUFJLENBQUMsaUJBQWlCLEVBQUM7OztzQkFFcEQsUUFBUSxHQUFDLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxxQkFBcUIsRUFBRTtnQkFDN0QsSUFBSSxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUMsUUFBUSxFQUFFLGNBQWMsRUFBQyxRQUFRLENBQUMsS0FBSyxHQUFDLElBQUksQ0FBQyxDQUFDO2FBQ3RFO2lCQUFJO2dCQUNELElBQUksQ0FBQyxNQUFNLENBQUMsV0FBVyxDQUFDLFFBQVEsRUFBRSxjQUFjLENBQUMsQ0FBQzthQUNyRDtTQUNKO0lBRUwsQ0FBQzs7O1lBMVNKLFNBQVMsU0FBQztnQkFDUCxRQUFRLEVBQUUsZ0JBQWdCO2FBQzdCOzs7O1lBUCtELGdCQUFnQjtZQURqRSxVQUFVO1lBQUUsU0FBUztZQUFFLFFBQVE7OzsyQkFZekMsS0FBSyxTQUFDLGNBQWM7K0JBcUJwQixLQUFLO3FDQXlCTCxLQUFLOzhCQUlMLEtBQUs7OEJBbUNMLEtBQUs7a0NBb0JMLEtBQUs7NkJBZ0JMLEtBQUs7b0NBZ0JMLE1BQU07Ozs7Ozs7SUEzSVAsNkNBQTZCOzs7OztJQXNCN0IsNENBQTZCOztJQTBCN0Isc0RBQStDOzs7OztJQUcvQywyQ0FBK0I7Ozs7O0lBbUMvQixnREFBOEI7Ozs7O0lBb0I5Qix5Q0FBMEI7Ozs7O0lBZ0IxQiwwQ0FBc0M7O0lBaUJ0QyxxREFBcUQ7Ozs7O0lBRXJELDZDQUE2Qjs7Ozs7SUFFN0IsaURBQWlDOzs7OztJQUVqQyxpREFBaUM7Ozs7O0lBQ2pDLDRDQUE0Qjs7Ozs7SUFDNUIsMkNBQXlDOzs7OztJQUN6QyxzQ0FBOEI7Ozs7O0lBRWxCLHVDQUFpQzs7Ozs7SUFBRSxrQ0FBc0I7Ozs7O0lBQUUsc0NBQXlCOzs7OztJQUFFLHdDQUEwQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XHJcbiAgICBEaXJlY3RpdmUsIEVsZW1lbnRSZWYsIFJlbmRlcmVyMiwgSW5qZWN0b3IsIE9uSW5pdCwgSW5wdXQsXHJcbiAgICBBZnRlclZpZXdJbml0LCBPbkRlc3Ryb3ksIE9uQ2hhbmdlcywgU2ltcGxlQ2hhbmdlcywgT3V0cHV0LCBWaWV3Q29udGFpbmVyUmVmLCBUZW1wbGF0ZVJlZiwgTmdab25lXHJcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IEV2ZW50RW1pdHRlciB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5cclxuXHJcbkBEaXJlY3RpdmUoe1xyXG4gICAgc2VsZWN0b3I6ICdbaW5wdXQtYXBwZW5kXScsXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBJbnB1dEFwcGVuZERpcmVjdGl2ZSBpbXBsZW1lbnRzIE9uSW5pdCwgQWZ0ZXJWaWV3SW5pdCwgT25EZXN0cm95IHtcclxuICAgIHByaXZhdGUgX2VuYWJsZUFwcGVuZCA9IHRydWU7XHJcbiAgICAvLyDnm7jlvZPkuo7lkK/nlKjnpoHnlKjmraTlip/og71cclxuICAgIEBJbnB1dCgnaW5wdXQtYXBwZW5kJylcclxuICAgIHNldCBlbmFibGVBcHBlbmQodmFsdWU6IHN0cmluZyB8IGJvb2xlYW4pIHtcclxuICAgICAgICBpZiAodmFsdWUgPT09ICcnIHx8IHZhbHVlKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX2VuYWJsZUFwcGVuZCA9IHRydWU7XHJcbiAgICAgICAgICAgIC8vIOmcgOimgVxyXG4gICAgICAgICAgICBpZiAoIXRoaXMuYXBwZW5kV3JhcEVsZW1lbnQpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuY3JlYXRlU3RydWN0KCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLl9lbmFibGVBcHBlbmQgPSBmYWxzZTtcclxuICAgICAgICAgICAgaWYgKHRoaXMuYXBwZW5kV3JhcEVsZW1lbnQpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMucmVzZXRTdHJ1Y3QoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGdldCBlbmFibGVBcHBlbmQoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2VuYWJsZUFwcGVuZDtcclxuICAgIH1cclxuICAgIC8vIOW6lOeUqOWcuuaZr++8jOm7mOiupOi/meS4quWKn+iDveaYr+WcqOeugOWNleihqOagvCBUYWJsZVxyXG4gICAgLy8g6L+95Yqg5LiA5Liq5Zy65pmv5Zyo5pmu6YCa6KGo5Y2V5LiKIEZvcm1cclxuICAgIHByaXZhdGUgX2FwcGVuZFNjZW5lPSdUYWJsZSc7XHJcbiAgICBASW5wdXQoKSBcclxuICAgIHNldCBpbnB1dEFwcGVuZFNjZW5lKHZhbDpzdHJpbmcpe1xyXG4gICAgICAgIC8vIOaUr+aMgei/meS4pOS4quWcuuaZr1xyXG4gICAgICAgIHZhbD12YWw9PSdGb3JtJz8nRm9ybSc6J1RhYmxlJztcclxuICAgICAgICBpZih2YWwhPXRoaXMuX2FwcGVuZFNjZW5lKXtcclxuICAgICAgICAgICAgc3dpdGNoICh0aGlzLmlucHV0QXBwZW5kQ29udHJvbFR5cGUpIHtcclxuICAgICAgICAgICAgICAgIGNhc2UgJ1N0YXRpY1RleHQnOlxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyLnJlbW92ZUNsYXNzKHRoaXMuZWwubmF0aXZlRWxlbWVudCwgJ2YtY21wLWlucHV0LWFwcGVuZC0nK3RoaXMuX2FwcGVuZFNjZW5lLnRvTG93ZXJDYXNlKCkpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyLmFkZENsYXNzKHRoaXMuZWwubmF0aXZlRWxlbWVudCwgJ2YtY21wLWlucHV0LWFwcGVuZC0nK3ZhbC50b0xvd2VyQ2FzZSgpKTtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgJ1RleHRCb3gnOlxyXG4gICAgICAgICAgICAgICAgY2FzZSAnTXVsdGlUZXh0Qm94JzpcclxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5lbFdyYXBFbGVtZW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZWxXcmFwRWxlbWVudC5jbGFzc05hbWU9IHRoaXMuZWxXcmFwRWxlbWVudC5jbGFzc05hbWUucmVwbGFjZSgnZi1jbXAtaW5wdXQtYXBwZW5kLScrdGhpcy5fYXBwZW5kU2NlbmUudG9Mb3dlckNhc2UoKSwnZi1jbXAtaW5wdXQtYXBwZW5kLScrdmFsLnRvTG93ZXJDYXNlKCkpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLl9hcHBlbmRTY2VuZT12YWw7XHJcbiAgICAgICAgICAgIHRoaXMubW9kaWZ5UGFkZGluZ1JpZ2h0KCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgZ2V0IGlucHV0QXBwZW5kU2NlbmUoKXtcclxuICAgICAgICByZXR1cm4gdGhpcy5fYXBwZW5kU2NlbmU7XHJcbiAgICB9XHJcbiAgICAvLyDov73liqDliLDlk6rkuKrnsbvlnovkuIsgVGV4dEJveOOAgU11bHRpVGV4dEJveOOAgSBTdGF0aWNUZXh0XHJcbiAgICBASW5wdXQoKSBpbnB1dEFwcGVuZENvbnRyb2xUeXBlID0gJ0lucHV0R3JvdXAnO1xyXG4gICAgLy8g5qC55o2u57G75Z6L5LiN5LiA5qC377yM5Zyo5o6n5Lu25aSE5LqO56aB55So44CB5Y+q6K+75pe277yM5Yaz5a6a6aKc6Imy5piv5ZCm5Y+v55SoXHJcbiAgICAvLyDmnInkuKTnp43vvJrmjInpkq4gYnV0dG9uIOaWh+acrCB0ZXh0XHJcbiAgICBwcml2YXRlIF9hcHBlbmRUeXBlID0gJ2J1dHRvbic7XHJcbiAgICBASW5wdXQoKVxyXG4gICAgc2V0IGlucHV0QXBwZW5kVHlwZSh2YWx1ZTogc3RyaW5nKSB7XHJcbiAgICAgICAgaWYgKHZhbHVlKSB7XHJcbiAgICAgICAgICAgIGlmIChbJ2J1dHRvbicsICd0ZXh0J10uZmluZEluZGV4KGl0ZW0gPT4gaXRlbSA9PSB2YWx1ZSkgPCAwKSB7XHJcbiAgICAgICAgICAgICAgICAvLyDnsbvlnovlnKjmlK/mjIHojIPlm7TlhoVcclxuICAgICAgICAgICAgICAgIHZhbHVlID0gJ2J1dHRvbic7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHZhbHVlICE9IHRoaXMuX2FwcGVuZFR5cGUpIHtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmFwcGVuZFdyYXBFbGVtZW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8g56e76Zmk5Y6f5p2l77yM6L+95Yqg5paw55qEXHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW5kZXIucmVtb3ZlQ2xhc3ModGhpcy5hcHBlbmRXcmFwRWxlbWVudCwgJ2lucHV0LWFwcGVuZC0nICsgdGhpcy5fYXBwZW5kVHlwZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW5kZXIuYWRkQ2xhc3ModGhpcy5hcHBlbmRXcmFwRWxlbWVudCwgJ2lucHV0LWFwcGVuZC0nICsgdmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLl9hcHBlbmRUeXBlID09ICdidXR0b24nKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIOWOn+adpeaYr+aMiemSrlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5jbGlja0hhbmRsZXIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY2xpY2tIYW5kbGVyKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNsaWNrSGFuZGxlciA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNsaWNrSGFuZGxlciA9IHRoaXMucmVuZGVyLmxpc3Rlbih0aGlzLmFwcGVuZFdyYXBFbGVtZW50LCAnY2xpY2snLCAoZXYpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaW5wdXRBcHBlbmRDbGlja0V2ZW50LmVtaXQoZXYpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9hcHBlbmRUeXBlID0gdmFsdWU7XHJcbiAgICAgICAgICAgICAgICB0aGlzLm1vZGlmeVBhZGRpbmdSaWdodCgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgIH1cclxuICAgIGdldCBpbnB1dEFwcGVuZFR5cGUoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2FwcGVuZFR5cGU7XHJcbiAgICB9XHJcbiAgICAvLyDov73liqDnmoTmlofmnKxcclxuICAgIHByaXZhdGUgX2lucHV0QXBwZW5kVGV4dCA9ICcnO1xyXG4gICAgQElucHV0KClcclxuICAgIHNldCBpbnB1dEFwcGVuZFRleHQodmFsdWU6IHN0cmluZykge1xyXG4gICAgICAgIGlmICh2YWx1ZSAhPSB0aGlzLl9pbnB1dEFwcGVuZFRleHQpIHtcclxuICAgICAgICAgICAgdGhpcy5faW5wdXRBcHBlbmRUZXh0ID0gdmFsdWU7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmFwcGVuZFdyYXBFbGVtZW50ICYmIHRoaXMuX2VuYWJsZUFwcGVuZCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5yZW5kZXIucmVtb3ZlQ2hpbGQodGhpcy5hcHBlbmRXcmFwRWxlbWVudCwgdGhpcy5hcHBlbmRUZXh0RWxlbWVudCk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmFwcGVuZFRleHRFbGVtZW50LmlubmVySFRNTCA9IHZhbHVlO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5yZW5kZXIuYXBwZW5kQ2hpbGQodGhpcy5hcHBlbmRXcmFwRWxlbWVudCwgdGhpcy5hcHBlbmRUZXh0RWxlbWVudCk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLm1vZGlmeVBhZGRpbmdSaWdodCgpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jcmVhdGVTdHJ1Y3QoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGdldCBpbnB1dEFwcGVuZFRleHQoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2lucHV0QXBwZW5kVGV4dDtcclxuICAgIH1cclxuICAgIC8vIOaooeadv1xyXG4gICAgLy8gQElucHV0KCkgaW5wdXRBcHBlbmRUbXBsOiBUZW1wbGF0ZVJlZjxhbnk+O1xyXG4gICAgcHJpdmF0ZSBfZGlzYWJsZWQgPSBmYWxzZTtcclxuICAgIEBJbnB1dCgpXHJcbiAgICBzZXQgaW5wdXRBcHBlbmREaXNhYmxlZCh2YWx1ZSkge1xyXG4gICAgICAgIGlmICh2YWx1ZSAhPSB0aGlzLl9kaXNhYmxlZCkge1xyXG4gICAgICAgICAgICB0aGlzLl9kaXNhYmxlZCA9IHZhbHVlO1xyXG4gICAgICAgICAgICBpZiAodGhpcy5hcHBlbmRXcmFwRWxlbWVudCkge1xyXG4gICAgICAgICAgICAgICAgdmFsdWUgJiYgdGhpcy5yZW5kZXIuYWRkQ2xhc3ModGhpcy5hcHBlbmRXcmFwRWxlbWVudCwgdGhpcy5kaXNhYmxlZENscyk7XHJcbiAgICAgICAgICAgICAgICAhdmFsdWUgJiYgdGhpcy5yZW5kZXIucmVtb3ZlQ2xhc3ModGhpcy5hcHBlbmRXcmFwRWxlbWVudCwgdGhpcy5kaXNhYmxlZENscyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5tb2RpZnlQYWRkaW5nUmlnaHQoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBnZXQgaW5wdXRBcHBlbmREaXNhYmxlZCgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fZGlzYWJsZWQ7XHJcbiAgICB9XHJcbiAgICAvLyDlvZNfYXBwZW5kQ2xz5Li656m65pe277yMXHJcbiAgICBwcml2YXRlIF9hcHBlbmRDbHM9J2lucHV0LWdyb3VwLXRleHQnO1xyXG4gICAgQElucHV0KCkgXHJcbiAgICBzZXQgaW5wdXRBcHBlbmRDbHModmFsOnN0cmluZyl7XHJcbiAgICAgICAgaWYodmFsIT10aGlzLl9hcHBlbmRDbHMpeyBcclxuICAgICAgICAgICAgdmFsPXZhbD92YWw6J2lucHV0LWdyb3VwLXRleHQnO1xyXG4gICAgICAgICAgICBpZih0aGlzLmFwcGVuZFRleHRFbGVtZW50KXtcclxuICAgICAgICAgICAgICAgIHRoaXMuYXBwZW5kVGV4dEVsZW1lbnQuY2xhc3NOYW1lPXZhbDsgIFxyXG4gICAgICAgICAgICB9ICAgICAgXHJcbiAgICAgICAgICAgIHRoaXMuX2FwcGVuZENscz12YWw7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgZ2V0IGlucHV0QXBwZW5kQ2xzKCl7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2FwcGVuZENsc1xyXG4gICAgfVxyXG4gICAgLypcclxuICAgICog5paH5pys54K55Ye75LqL5Lu2XHJcbiAgICAqL1xyXG4gICAgQE91dHB1dCgpIGlucHV0QXBwZW5kQ2xpY2tFdmVudCA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuICAgIC8vIOagh+iusG5hdGl2ZeeahOWkluWxglxyXG4gICAgcHJpdmF0ZSBlbFdyYXBFbGVtZW50ID0gbnVsbDtcclxuICAgIC8vIOagh+iusOWFg+e0oFxyXG4gICAgcHJpdmF0ZSBhcHBlbmRXcmFwRWxlbWVudCA9IG51bGw7XHJcbiAgICAvLyDmmoLml7bkuI3nlKhcclxuICAgIHByaXZhdGUgYXBwZW5kVGV4dEVsZW1lbnQgPSBudWxsO1xyXG4gICAgcHJpdmF0ZSBjbGlja0hhbmRsZXIgPSBudWxsO1xyXG4gICAgcHJpdmF0ZSBkaXNhYmxlZENscyA9ICdmLXN0YXRlLWRpc2FibGVkJztcclxuICAgIHByaXZhdGUgbmdab25lOiBOZ1pvbmUgPSBudWxsO1xyXG4gICAgLy8gcHJpdmF0ZSBuZ0NvbnRyb2w6IE5nQ29udHJvbDtcclxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgdmlld1JlZjogVmlld0NvbnRhaW5lclJlZiwgcHJpdmF0ZSBlbDogRWxlbWVudFJlZiwgcHJpdmF0ZSByZW5kZXI6IFJlbmRlcmVyMiwgcHJpdmF0ZSBpbmplY3RvcjogSW5qZWN0b3IpIHtcclxuICAgICAgICB0aGlzLm5nWm9uZSA9IHRoaXMuaW5qZWN0b3IuZ2V0KE5nWm9uZSk7XHJcbiAgICB9XHJcblxyXG4gICAgbmdPbkluaXQoKSB7XHJcbiAgICAgICAgLy90aGlzLm5nQ29udHJvbCA9IHRoaXMuaW5qZWN0b3IuZ2V0KE5nQ29udHJvbCwgbnVsbCk7XHJcbiAgICB9XHJcblxyXG5cclxuICAgIG5nQWZ0ZXJWaWV3SW5pdCgpIHtcclxuICAgICAgICB0aGlzLmNyZWF0ZVN0cnVjdCgpO1xyXG4gICAgfVxyXG5cclxuICAgIG5nT25EZXN0cm95KCkge1xyXG4gICAgICAgIC8vdGhpcy5yZXNldFN0cnVjdCgpO1xyXG4gICAgICAgIGlmICh0aGlzLmNsaWNrSGFuZGxlcikge1xyXG4gICAgICAgICAgICB0aGlzLmNsaWNrSGFuZGxlcigpO1xyXG4gICAgICAgICAgICB0aGlzLmNsaWNrSGFuZGxlciA9IG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0aGlzLmFwcGVuZFdyYXBFbGVtZW50KSB7XHJcbiAgICAgICAgICAgIHRoaXMuYXBwZW5kV3JhcEVsZW1lbnQucmVtb3ZlKCk7XHJcbiAgICAgICAgICAgIHRoaXMuYXBwZW5kV3JhcEVsZW1lbnQgPSBudWxsO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGhpcy5lbFdyYXBFbGVtZW50KSB7XHJcbiAgICAgICAgICAgIHRoaXMuZWxXcmFwRWxlbWVudC5yZW1vdmUoKTtcclxuICAgICAgICAgICAgdGhpcy5lbFdyYXBFbGVtZW50ID0gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIOmHjee9rlxyXG4gICAgICovXHJcbiAgICBwcml2YXRlIHJlc2V0U3RydWN0KCkge1xyXG4gICAgICAgIGlmICh0aGlzLmNsaWNrSGFuZGxlcikge1xyXG4gICAgICAgICAgICB0aGlzLmNsaWNrSGFuZGxlcigpO1xyXG4gICAgICAgICAgICB0aGlzLmNsaWNrSGFuZGxlciA9IG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIOWIhuexu+Wei+enu+mZpOS4jeWQjOaWsOWinuWKoOeahOe7k+aehOaIluagt+W8j1xyXG4gICAgICAgIHN3aXRjaCAodGhpcy5pbnB1dEFwcGVuZENvbnRyb2xUeXBlKSB7XHJcbiAgICAgICAgICAgIGNhc2UgJ1N0YXRpY1RleHQnOlxyXG4gICAgICAgICAgICAgICAgdGhpcy5yZW5kZXIucmVtb3ZlQ2xhc3ModGhpcy5lbC5uYXRpdmVFbGVtZW50LCAnZi1jbXAtc3RhdGljLXRleHQtaW5wdXQtYXBwZW5kJyk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnJlbmRlci5yZW1vdmVDbGFzcyh0aGlzLmVsLm5hdGl2ZUVsZW1lbnQsICdmLWNtcC1pbnB1dC1hcHBlbmQtJyt0aGlzLmlucHV0QXBwZW5kU2NlbmUudG9Mb3dlckNhc2UoKSk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSAnVGV4dEJveCc6XHJcbiAgICAgICAgICAgIGNhc2UgJ011bHRpVGV4dEJveCc6XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5lbFdyYXBFbGVtZW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IHdyYXBQYXJlbnQgPSB0aGlzLnJlbmRlci5wYXJlbnROb2RlKHRoaXMuZWxXcmFwRWxlbWVudCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW5kZXIuYXBwZW5kQ2hpbGQod3JhcFBhcmVudCwgdGhpcy5lbC5uYXRpdmVFbGVtZW50KTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmVsV3JhcEVsZW1lbnQucmVtb3ZlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5lbFdyYXBFbGVtZW50ID0gbnVsbDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGhpcy5hcHBlbmRXcmFwRWxlbWVudCkge1xyXG4gICAgICAgICAgICB0aGlzLmFwcGVuZFdyYXBFbGVtZW50LnJlbW92ZSgpO1xyXG4gICAgICAgICAgICB0aGlzLmFwcGVuZFdyYXBFbGVtZW50ID0gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5tb2RpZnlQYWRkaW5nUmlnaHQoKTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICog5Yib5bu65o+S5YWl57uT5p6EXHJcbiAgICAgKi9cclxuICAgIHByaXZhdGUgY3JlYXRlU3RydWN0KCkge1xyXG4gICAgICAgIGlmICghdGhpcy5pbnB1dEFwcGVuZFRleHQgfHwgIXRoaXMuZW5hYmxlQXBwZW5kIHx8IHRoaXMuYXBwZW5kV3JhcEVsZW1lbnQpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCBidXR0b25XcmFwID0gdGhpcy5yZW5kZXIuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgICAgICAgYnV0dG9uV3JhcC5jbGFzc05hbWUgPSAnaW5wdXQtZ3JvdXAtYXBwZW5kIGlucHV0LWFwcGVuZC13cmFwcGVyJztcclxuICAgICAgICBidXR0b25XcmFwLmNsYXNzTmFtZSArPSAnIGlucHV0LWFwcGVuZC0nICsgdGhpcy5pbnB1dEFwcGVuZFR5cGU7XHJcbiAgICAgICAgaWYgKHRoaXMuX2Rpc2FibGVkKSB7XHJcbiAgICAgICAgICAgIGJ1dHRvbldyYXAuY2xhc3NOYW1lICs9ICcgJyArIHRoaXMuZGlzYWJsZWRDbHM7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IGJ1dHRvblRleHRXcmFwID0gdGhpcy5yZW5kZXIuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgICAgICAgYnV0dG9uVGV4dFdyYXAuY2xhc3NOYW1lID0gdGhpcy5pbnB1dEFwcGVuZENscztcclxuICAgICAgICBidXR0b25UZXh0V3JhcC5pbm5lckhUTUwgPSB0aGlzLmlucHV0QXBwZW5kVGV4dDtcclxuICAgICAgICB0aGlzLmFwcGVuZFRleHRFbGVtZW50ID0gYnV0dG9uVGV4dFdyYXA7XHJcbiAgICAgICAgdGhpcy5hcHBlbmRXcmFwRWxlbWVudCA9IGJ1dHRvbldyYXA7XHJcbiAgICAgICAgdGhpcy5yZW5kZXIuYXBwZW5kQ2hpbGQoYnV0dG9uV3JhcCwgYnV0dG9uVGV4dFdyYXApO1xyXG4gICAgICAgIHN3aXRjaCAodGhpcy5pbnB1dEFwcGVuZENvbnRyb2xUeXBlKSB7XHJcbiAgICAgICAgICAgIGNhc2UgJ1N0YXRpY1RleHQnOlxyXG4gICAgICAgICAgICAgICAgLy8g5q2k5pe26L+Y5rKh5pyJ55Sf5oiQ5YaF6YOo55qE5qC35byPXHJcbiAgICAgICAgICAgICAgICAvLyBsZXQgdGV4dGFyZWFFbCA9IHRoaXMuZWwubmF0aXZlRWxlbWVudC5xdWVyeVNlbGVjdG9yKCcuZi1mb3JtLWNvbnRyb2wtdGV4dGFyZWEnKTtcclxuICAgICAgICAgICAgICAgIGxldCBjbHNOYW1lcz0nZi1jbXAtc3RhdGljLXRleHQtaW5wdXQtYXBwZW5kJysoJyBmLWNtcC1pbnB1dC1hcHBlbmQtJyt0aGlzLmlucHV0QXBwZW5kU2NlbmUudG9Mb3dlckNhc2UoKSkgKyAodGhpcy5fZGlzYWJsZWQgPyAnICcgKyB0aGlzLmRpc2FibGVkQ2xzIDogJycpO1xyXG4gICAgICAgICAgICAgICAgY2xzTmFtZXMuc3BsaXQoJyAnKS5tYXAoKHRjbHNOYW1lKT0+e1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyLmFkZENsYXNzKHRoaXMuZWwubmF0aXZlRWxlbWVudCx0Y2xzTmFtZSk7XHJcbiAgICAgICAgICAgICAgICB9KTsgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyLmFwcGVuZENoaWxkKHRoaXMuZWwubmF0aXZlRWxlbWVudCwgYnV0dG9uV3JhcCk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSAnVGV4dEJveCc6XHJcbiAgICAgICAgICAgIGNhc2UgJ011bHRpVGV4dEJveCc6XHJcbiAgICAgICAgICAgICAgICBsZXQgdGV4dFBhcmVudCA9IHRoaXMucmVuZGVyLnBhcmVudE5vZGUodGhpcy5lbC5uYXRpdmVFbGVtZW50KTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGlucHV0V3JhcCA9IHRoaXMucmVuZGVyLmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICAgICAgICAgICAgICAgaW5wdXRXcmFwLmNsYXNzTmFtZSA9ICdmLWNtcC10ZXh0LWlucHV0LWFwcGVuZCBmLWNtcC1pbnB1dC1hcHBlbmQtJyt0aGlzLmlucHV0QXBwZW5kU2NlbmUudG9Mb3dlckNhc2UoKSArICh0aGlzLl9kaXNhYmxlZCA/ICcgJyArIHRoaXMuZGlzYWJsZWRDbHMgOiAnJyk7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5lbC5uYXRpdmVFbGVtZW50Lm91dGVySFRNTC5pbmRleE9mKCd0ZXh0YXJlYScpID4gLTEpIHtcclxuICAgICAgICAgICAgICAgICAgICBpbnB1dFdyYXAuY2xhc3NOYW1lID0gJ2YtY21wLXRleHRhcmVhLWlucHV0LWFwcGVuZCBmLWNtcC1pbnB1dC1hcHBlbmQtJyt0aGlzLmlucHV0QXBwZW5kU2NlbmUudG9Mb3dlckNhc2UoKSArICh0aGlzLl9kaXNhYmxlZCA/ICcgJyArIHRoaXMuZGlzYWJsZWRDbHMgOiAnJyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB0aGlzLmVsV3JhcEVsZW1lbnQgPSBpbnB1dFdyYXA7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnJlbmRlci5hcHBlbmRDaGlsZChpbnB1dFdyYXAsIHRoaXMuZWwubmF0aXZlRWxlbWVudCk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnJlbmRlci5hcHBlbmRDaGlsZChpbnB1dFdyYXAsIGJ1dHRvbldyYXApO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5yZW5kZXIuYXBwZW5kQ2hpbGQodGV4dFBhcmVudCwgaW5wdXRXcmFwKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgLy8g5a2Y5Zyo57G75Ly85LiL5ouJ6L+Z5qC355qE5o6n5Lu277yM5YaF6YOo6LCD55SoaW5wdXQtZ3JvdXDnu5PmnoTov5jmsqHmnInliJ3lp4vljJZcclxuICAgICAgICAgICAgICAgIGxldCBpbnB1dEdyb3VwRWwgPSB0aGlzLmVsLm5hdGl2ZUVsZW1lbnQucXVlcnlTZWxlY3RvcignLmlucHV0LWdyb3VwJyk7XHJcbiAgICAgICAgICAgICAgICBpZiAoaW5wdXRHcm91cEVsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW5kZXIuYXBwZW5kQ2hpbGQoaW5wdXRHcm91cEVsLCBidXR0b25XcmFwKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMubmdab25lKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubmdab25lLnJ1bk91dHNpZGVBbmd1bGFyKCgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBpbnB1dEdyb3VwRWwyID0gdGhpcy5lbC5uYXRpdmVFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5pbnB1dC1ncm91cCcpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyLmFwcGVuZENoaWxkKGlucHV0R3JvdXBFbDIsIGJ1dHRvbldyYXApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodGhpcy5pbnB1dEFwcGVuZFR5cGUgPT0gJ2J1dHRvbicpIHtcclxuICAgICAgICAgICAgdGhpcy5jbGlja0hhbmRsZXIgPSB0aGlzLnJlbmRlci5saXN0ZW4odGhpcy5hcHBlbmRXcmFwRWxlbWVudCwgJ2NsaWNrJywgKGV2KSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZighdGhpcy5pbnB1dEFwcGVuZERpc2FibGVkKXtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmlucHV0QXBwZW5kQ2xpY2tFdmVudC5lbWl0KGV2KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMubW9kaWZ5UGFkZGluZ1JpZ2h0KCk7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIOWboOS4uuWcqOaZrumAmui+k+WFpeahhuOAgemdmeaAgeaWh+acrOOAgeWkmuihjOaWh+acrOahhuWxleekuuaXtu+8jOeVjOmdouagt+W8j+mXrumimOOAglxyXG4gICAgICog5omA5Lul6ZyA6KaB5Y2V54us5aSE55CG77yM6YCa6L+HYWJzb2x1dGXlrprkvY3vvIzorr7nva7pl7Tot53vvIzkv53mjIHnlYzpnaLkuIDoh7RcclxuICAgICAqL1xyXG4gICAgcHJpdmF0ZSBtb2RpZnlQYWRkaW5nUmlnaHQoKXtcclxuICAgICAgICBsZXQgZmluZFR5cGU9WydTdGF0aWNUZXh0JywnVGV4dEJveCcsJ011bHRpVGV4dEJveCddLmZpbmQodHlwZUl0ZW09PnR5cGVJdGVtPT10aGlzLmlucHV0QXBwZW5kQ29udHJvbFR5cGUpO1xyXG4gICAgICAgIGlmKHRoaXMuaW5wdXRBcHBlbmRTY2VuZT09J0Zvcm0nJiZmaW5kVHlwZSl7XHJcbiAgICAgICAgICAgIGxldCBjaGFuZ2VFbD1maW5kVHlwZT09J1N0YXRpY1RleHQnP3RoaXMuZWwubmF0aXZlRWxlbWVudC5xdWVyeVNlbGVjdG9yKCdzcGFuJyk6dGhpcy5lbC5uYXRpdmVFbGVtZW50O1xyXG4gICAgICAgICAgICBpZih0aGlzLmVuYWJsZUFwcGVuZCYmIXRoaXMuX2Rpc2FibGVkJiZ0aGlzLmFwcGVuZFdyYXBFbGVtZW50KXtcclxuICAgICAgICAgICAgICAgIC8vd2luZG93LmdldENvbXB1dGhpcy5hcHBlbmRXcmFwRWxlbWVudFxyXG4gICAgICAgICAgICAgICAgY29uc3QgdFJlY3RPYmo9dGhpcy5hcHBlbmRXcmFwRWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcclxuICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyLnNldFN0eWxlKGNoYW5nZUVsLCAncGFkZGluZ1JpZ2h0Jyx0UmVjdE9iai53aWR0aCsncHgnKTsgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICAgICAgdGhpcy5yZW5kZXIucmVtb3ZlU3R5bGUoY2hhbmdlRWwsICdwYWRkaW5nUmlnaHQnKTsgICAgXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICB9XHJcbn1cclxuIl19
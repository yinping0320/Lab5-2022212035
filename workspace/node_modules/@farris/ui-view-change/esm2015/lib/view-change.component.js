/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input, Output, EventEmitter, ElementRef, ViewChild, Renderer2, ViewEncapsulation, Optional, NgZone, Injector } from '@angular/core';
import ResizeObserver from "resize-observer-polyfill";
import { ViewChangeService } from './view-change.service';
export class ViewChangeComponent {
    /**
     * @param {?} _renderer
     * @param {?} viewChangeService
     * @param {?} inject
     */
    constructor(_renderer, viewChangeService, inject) {
        this._renderer = _renderer;
        this.viewChangeService = viewChangeService;
        this.inject = inject;
        // 视图类型的呈现方式，tile小磁贴类型，dropdown下拉类型
        this.viewType = 'tile';
        // 视图组
        this.viewGroupId = 'default';
        // 视图类型切换时，抛出的事件
        this.toolTypeChange = new EventEmitter();
        // 记录Module的标记，用来获取当前module下的服务
        this.guid = "";
        // 处理ngzone
        this.ngZone = null;
        // 记录元素尺寸变更
        this.ro = null;
        if (!this.viewChangeService) {
            this.viewChangeService = new ViewChangeService();
        }
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.guid = this.viewChangeService.createViewChangeCmp({ groupId: this.viewGroupId, count: this.toolbarData.length }, this.viewchangewrapper.nativeElement.parentElement);
        this.viewChangeManageSer = this.viewChangeService.getModuleInfo(this.guid);
        if (this.toolbarData && this.toolbarData.length) {
            if (this.defaultType) {
                /** @type {?} */
                let item = this.toolbarData.find((/**
                 * @param {?} bar
                 * @return {?}
                 */
                (bar) => {
                    return bar['type'] === this.defaultType;
                }));
                this.activeTypeItem = item;
                this.toolTypeChange.emit(this.activeTypeItem);
            }
            else {
                this.activeTypeItem = this.toolbarData[0];
                this.toolTypeChange.emit(this.activeTypeItem);
            }
        }
    }
    /**
     * @return {?}
     */
    ngAfterViewInit() {
        this.observerElement();
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        if (this.ro) {
            this.ro.unobserve(this.viewchangewrapper.nativeElement);
            this.ro = null;
        }
    }
    /**
     * @param {?} item
     * @return {?}
     */
    listItemClick(item) {
        if (item.disable || this.activeTypeItem['type'] === item['type']) {
            return;
        }
        this.activeTypeItem = item;
        this.viewChangeManageSer.updateCurrentViewId(this.activeTypeItem['type'], this.viewGroupId);
        this.toolTypeChange.emit(item);
        if (this.typelist) {
            this._renderer.setStyle(this.typelist.nativeElement, 'display', 'none');
        }
    }
    /**
     * @return {?}
     */
    dropdownMouseEnter() {
        this._renderer.setStyle(this.typelist.nativeElement, 'display', 'block');
    }
    /**
     * @return {?}
     */
    dropdownMouseLeave() {
        this._renderer.setStyle(this.typelist.nativeElement, 'display', 'none');
    }
    /**
     * 解决卡片和列表两个菜单同时打开，同步数据时候，当前的标签显示不对的问题
     * @private
     * @return {?}
     */
    observerElement() {
        if (!this.inject) {
            // 初始更新一次当前类型
            this.viewChangeManageSer['changeCurrentViewIdFromCMP'](this.activeTypeItem['type'], this.viewGroupId);
            return;
        }
        if (!this.ngZone) {
            this.ngZone = this.inject.get(NgZone, null);
        }
        if (!this.ro) {
            this.ngZone.runOutsideAngular((/**
             * @return {?}
             */
            () => {
                this.ro = new ResizeObserver((/**
                 * @param {?} entries
                 * @param {?} observer
                 * @return {?}
                 */
                (entries, observer) => {
                    if (entries[0].contentRect.width > 0) {
                        this.viewChangeManageSer['changeCurrentViewIdFromCMP'](this.activeTypeItem['type'], this.viewGroupId);
                    }
                }));
                this.ro.observe(this.viewchangewrapper.nativeElement);
            }));
        }
    }
}
ViewChangeComponent.decorators = [
    { type: Component, args: [{
                selector: 'farris-view-change',
                template: "<div class=\"f-view-change\" #viewchangewrapper>\r\n    <div class=\"f-view-change-tile\" *ngIf=\"viewType === 'tile'; else dropdown\">\r\n        <div class=\"f-view-change-tile-btn\" *ngFor=\"let item of toolbarData\" [ngClass]=\"{'tile-btn-active': item.type === activeTypeItem.type,'tile-btn-disable': item.disable}\" (click)=\"listItemClick(item)\" [title]=\"item.title\">\r\n            <span class=\"tile-btn-icon {{item.iconName}}\"></span>\r\n        </div>\r\n    </div>\r\n    <ng-template #dropdown>\r\n        <div class=\"f-view-change-dropdown\" \r\n        (mouseenter)=\"dropdownMouseEnter()\"\r\n        (mouseleave)=\"dropdownMouseLeave()\"> \r\n            <div class=\"f-view-change-toggle\" *ngIf=\"this.toolbarData.length\">\r\n                <span class=\"toggle-btn-icon {{activeTypeItem.iconName}}\"></span>\r\n            </div>\r\n            <div class=\"f-view-change-typelist\" #typelist>\r\n                <div class=\"f-view-change-typelist-content\">\r\n                    <div class=\"f-view-change-typelist-arrow\"></div>\r\n                    <ul class=\"f-view-change-typelist-list\">\r\n                        <li class=\"typelist-item\" *ngFor=\"let item of toolbarData\" [ngClass]=\"{'typelist-item-active': item.type === activeTypeItem.type,'typelist-item-disable': item.disable}\" (click)=\"listItemClick(item)\">\r\n                                <span class=\"typelist-item-icon {{item.iconName}}\"></span>\r\n                                <span class=\"typelist-item-title\">{{item.title}}</span>\r\n                            </li>\r\n                    </ul>\r\n                </div>\r\n            </div>\r\n            <!-- <ul class=\"f-view-change-typelist\" #typelist>\r\n                <li class=\"f-view-change-typelist-arrow\"></li>\r\n                <li class=\"typelist-item\" *ngFor=\"let item of toolbarData\" [ngClass]=\"{'typelist-item-active': item.type === activeTypeItem.type,'typelist-item-disable': item.disable}\" (click)=\"listItemClick(item)\">\r\n                    <span class=\"typelist-item-icon {{item.iconName}}\"></span>\r\n                    <span class=\"typelist-item-title\">{{item.title}}</span>\r\n                </li>\r\n            </ul> -->\r\n        </div>\r\n    </ng-template>\r\n</div>",
                encapsulation: ViewEncapsulation.None
                // providers:[ ViewChangeService ]
                ,
                styles: [".f-viewchange-view-none{display:none!important}"]
            }] }
];
/** @nocollapse */
ViewChangeComponent.ctorParameters = () => [
    { type: Renderer2 },
    { type: ViewChangeService, decorators: [{ type: Optional }] },
    { type: Injector, decorators: [{ type: Optional }] }
];
ViewChangeComponent.propDecorators = {
    toolbarData: [{ type: Input }],
    viewType: [{ type: Input }],
    defaultType: [{ type: Input }],
    viewGroupId: [{ type: Input }],
    toolTypeChange: [{ type: Output }],
    typelist: [{ type: ViewChild, args: ['typelist',] }],
    viewchangewrapper: [{ type: ViewChild, args: ['viewchangewrapper',] }]
};
if (false) {
    /** @type {?} */
    ViewChangeComponent.prototype.toolbarData;
    /** @type {?} */
    ViewChangeComponent.prototype.viewType;
    /** @type {?} */
    ViewChangeComponent.prototype.defaultType;
    /** @type {?} */
    ViewChangeComponent.prototype.viewGroupId;
    /** @type {?} */
    ViewChangeComponent.prototype.activeTypeItem;
    /** @type {?} */
    ViewChangeComponent.prototype.toolTypeChange;
    /** @type {?} */
    ViewChangeComponent.prototype.typelist;
    /** @type {?} */
    ViewChangeComponent.prototype.viewchangewrapper;
    /**
     * @type {?}
     * @private
     */
    ViewChangeComponent.prototype.guid;
    /**
     * @type {?}
     * @private
     */
    ViewChangeComponent.prototype.ngZone;
    /**
     * @type {?}
     * @private
     */
    ViewChangeComponent.prototype.ro;
    /**
     * @type {?}
     * @private
     */
    ViewChangeComponent.prototype.viewChangeManageSer;
    /**
     * @type {?}
     * @private
     */
    ViewChangeComponent.prototype._renderer;
    /**
     * @type {?}
     * @private
     */
    ViewChangeComponent.prototype.viewChangeService;
    /**
     * @type {?}
     * @private
     */
    ViewChangeComponent.prototype.inject;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidmlldy1jaGFuZ2UuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy91aS12aWV3LWNoYW5nZS8iLCJzb3VyY2VzIjpbImxpYi92aWV3LWNoYW5nZS5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQVUsS0FBSyxFQUFFLE1BQU0sRUFBRSxZQUFZLEVBQUUsVUFBVSxFQUFFLFNBQVMsRUFBRSxTQUFTLEVBQWlCLGlCQUFpQixFQUFFLFFBQVEsRUFBRSxNQUFNLEVBQUUsUUFBUSxFQUFhLE1BQU0sZUFBZSxDQUFDO0FBQzFMLE9BQU8sY0FBYyxNQUFNLDBCQUEwQixDQUFDO0FBQ3RELE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLHVCQUF1QixDQUFDO0FBUzFELE1BQU0sT0FBTyxtQkFBbUI7Ozs7OztJQXdCOUIsWUFBb0IsU0FBb0IsRUFDbEIsaUJBQW9DLEVBQXNCLE1BQWdCO1FBRDVFLGNBQVMsR0FBVCxTQUFTLENBQVc7UUFDbEIsc0JBQWlCLEdBQWpCLGlCQUFpQixDQUFtQjtRQUFzQixXQUFNLEdBQU4sTUFBTSxDQUFVOztRQXJCdkYsYUFBUSxHQUFXLE1BQU0sQ0FBQzs7UUFJMUIsZ0JBQVcsR0FBVSxTQUFTLENBQUM7O1FBRzlCLG1CQUFjLEdBQUcsSUFBSSxZQUFZLEVBQUUsQ0FBQzs7UUFLdEMsU0FBSSxHQUFDLEVBQUUsQ0FBQzs7UUFFVCxXQUFNLEdBQUcsSUFBSSxDQUFDOztRQUVkLE9BQUUsR0FBMEIsSUFBSSxDQUFDO1FBTXBDLElBQUcsQ0FBQyxJQUFJLENBQUMsaUJBQWlCLEVBQUM7WUFDekIsSUFBSSxDQUFDLGlCQUFpQixHQUFFLElBQUksaUJBQWlCLEVBQUUsQ0FBQztTQUNqRDtJQUNILENBQUM7Ozs7SUFFSCxRQUFRO1FBQ04sSUFBSSxDQUFDLElBQUksR0FBQyxJQUFJLENBQUMsaUJBQWlCLENBQUMsbUJBQW1CLENBQUMsRUFBQyxPQUFPLEVB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NkI7O0lBRTdCLDBDQUF3Qzs7SUFDeEMsNkNBQWU7O0lBRWYsNkNBQThDOztJQUU5Qyx1Q0FBNEM7O0lBQzVDLGdEQUE4RDs7Ozs7SUFFOUQsbUNBQWdCOzs7OztJQUVqQixxQ0FBc0I7Ozs7O0lBRXRCLGlDQUF5Qzs7Ozs7SUFDekMsa0RBQTRCOzs7OztJQUdmLHdDQUE0Qjs7Ozs7SUFDdEMsZ0RBQXdEOzs7OztJQUFFLHFDQUFvQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgT25Jbml0LCBJbnB1dCwgT3V0cHV0LCBFdmVudEVtaXR0ZXIsIEVsZW1lbnRSZWYsIFZpZXdDaGlsZCwgUmVuZGVyZXIyLCBBZnRlclZpZXdJbml0LCBWaWV3RW5jYXBzdWxhdGlvbiwgT3B0aW9uYWwsIE5nWm9uZSwgSW5qZWN0b3IsIE9uRGVzdHJveSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgUmVzaXplT2JzZXJ2ZXIgZnJvbSBcInJlc2l6ZS1vYnNlcnZlci1wb2x5ZmlsbFwiO1xyXG5pbXBvcnQgeyBWaWV3Q2hhbmdlU2VydmljZSB9IGZyb20gJy4vdmlldy1jaGFuZ2Uuc2VydmljZSc7XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICBzZWxlY3RvcjogJ2ZhcnJpcy12aWV3LWNoYW5nZScsXHJcbiAgdGVtcGxhdGVVcmw6ICcuL3ZpZXctY2hhbmdlLmNvbXBvbmVudC5odG1sJyxcclxuICBzdHlsZVVybHM6IFsnLi92aWV3LWNoYW5nZS5jb21wb25lbnQuc2NzcyddLFxyXG4gIGVuY2Fwc3VsYXRpb246IFZpZXdFbmNhcHN1bGF0aW9uLk5vbmVcclxuICAvLyBwcm92aWRlcnM6WyBWaWV3Q2hhbmdlU2VydmljZSBdXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBWaWV3Q2hhbmdlQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0ICxBZnRlclZpZXdJbml0LE9uRGVzdHJveXtcclxuXHJcbiAgQElucHV0KCkgdG9vbGJhckRhdGE7XHJcbiAgLy8g6KeG5Zu+57G75Z6L55qE5ZGI546w5pa55byP77yMdGlsZeWwj+ejgei0tOexu+Wei++8jGRyb3Bkb3du5LiL5ouJ57G75Z6LXHJcbiAgQElucHV0KCkgdmlld1R5cGU6IHN0cmluZyA9ICd0aWxlJztcclxuICAvLyDpu5jorqTnmoTop4blm77nsbvlnotcclxuICBASW5wdXQoKSBkZWZhdWx0VHlwZTogc3RyaW5nO1xyXG4gIC8vIOinhuWbvue7hFxyXG4gIEBJbnB1dCgpIHZpZXdHcm91cElkOnN0cmluZyA9ICdkZWZhdWx0JztcclxuICBhY3RpdmVUeXBlSXRlbTtcclxuICAvLyDop4blm77nsbvlnovliIfmjaLml7bvvIzmipvlh7rnmoTkuovku7ZcclxuICBAT3V0cHV0KCkgdG9vbFR5cGVDaGFuZ2UgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcblxyXG4gIEBWaWV3Q2hpbGQoJ3R5cGVsaXN0JykgdHlwZWxpc3Q6IEVsZW1lbnRSZWY7XHJcbiAgQFZpZXdDaGlsZCgndmlld2NoYW5nZXdyYXBwZXInKSB2aWV3Y2hhbmdld3JhcHBlcjogRWxlbWVudFJlZjtcclxuICAvLyDorrDlvZVNb2R1bGXnmoTmoIforrDvvIznlKjmnaXojrflj5blvZPliY1tb2R1bGXkuIvnmoTmnI3liqFcclxuICBwcml2YXRlIGd1aWQ9XCJcIjtcclxuIC8vIOWkhOeQhm5nem9uZVxyXG4gcHJpdmF0ZSBuZ1pvbmUgPSBudWxsO1xyXG4gLy8g6K6w5b2V5YWD57Sg5bC65a+45Y+Y5pu0XHJcbiBwcml2YXRlIHJvOiBSZXNpemVPYnNlcnZlciB8IG51bGwgPSBudWxsO1xyXG4gcHJpdmF0ZSB2aWV3Q2hhbmdlTWFuYWdlU2VyO1xyXG4gXHJcblxyXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgX3JlbmRlcmVyOiBSZW5kZXJlcjIsXHJcbiAgICBAT3B0aW9uYWwoKSBwcml2YXRlIHZpZXdDaGFuZ2VTZXJ2aWNlOiBWaWV3Q2hhbmdlU2VydmljZSwgQE9wdGlvbmFsKCkgcHJpdmF0ZSBpbmplY3Q6IEluamVjdG9yKSB7IFxyXG4gICAgICBpZighdGhpcy52aWV3Q2hhbmdlU2VydmljZSl7XHJcbiAgICAgICAgdGhpcy52aWV3Q2hhbmdlU2VydmljZT0gbmV3IFZpZXdDaGFuZ2VTZXJ2aWNlKCk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgbmdPbkluaXQoKSB7XHJcbiAgICB0aGlzLmd1aWQ9dGhpcy52aWV3Q2hhbmdlU2VydmljZS5jcmVhdGVWaWV3Q2hhbmdlQ21wKHtncm91cElkOnRoaXMudmlld0dyb3VwSWQsY291bnQ6dGhpcy50b29sYmFyRGF0YS5sZW5ndGh9LHRoaXMudmlld2NoYW5nZXdyYXBwZXIubmF0aXZlRWxlbWVudC5wYXJlbnRFbGVtZW50KTtcclxuICAgIHRoaXMudmlld0NoYW5nZU1hbmFnZVNlcj10aGlzLnZpZXdDaGFuZ2VTZXJ2aWNlLmdldE1vZHVsZUluZm8odGhpcy5ndWlkKTtcclxuICAgIGlmICh0aGlzLnRvb2xiYXJEYXRhICYmIHRoaXMudG9vbGJhckRhdGEubGVuZ3RoKSB7XHJcbiAgICAgIGlmICh0aGlzLmRlZmF1bHRUeXBlKSB7XHJcbiAgICAgICAgbGV0IGl0ZW0gPSB0aGlzLnRvb2xiYXJEYXRhLmZpbmQoKGJhcikgPT4ge1xyXG4gICAgICAgICAgcmV0dXJuIGJhclsndHlwZSddID09PSB0aGlzLmRlZmF1bHRUeXBlO1xyXG4gICAgICAgIH0pXHJcbiAgICAgICAgdGhpcy5hY3RpdmVUeXBlSXRlbSA9IGl0ZW07XHJcbiAgICAgICAgdGhpcy50b29sVHlwZUNoYW5nZS5lbWl0KHRoaXMuYWN0aXZlVHlwZUl0ZW0pO1xyXG4gICAgICB9XHJcbiAgICAgIGVsc2Uge1xyXG4gICAgICAgIHRoaXMuYWN0aXZlVHlwZUl0ZW0gPSB0aGlzLnRvb2xiYXJEYXRhWzBdO1xyXG4gICAgICAgIHRoaXMudG9vbFR5cGVDaGFuZ2UuZW1pdCh0aGlzLmFjdGl2ZVR5cGVJdGVtKTtcclxuICAgICAgfSAgICAgICAgIFxyXG4gICAgfSAgICBcclxuICB9XHJcbiAgbmdBZnRlclZpZXdJbml0KCk6IHZvaWQge1xyXG4gICAgdGhpcy5vYnNlcnZlckVsZW1lbnQoKTsgICAgXHJcbiAgfVxyXG4gIG5nT25EZXN0cm95KCk6IHZvaWQge1xyXG4gICAgaWYodGhpcy5ybyl7XHJcbiAgICAgIHRoaXMucm8udW5vYnNlcnZlKHRoaXMudmlld2NoYW5nZXdyYXBwZXIubmF0aXZlRWxlbWVudCk7XHJcbiAgICAgIHRoaXMucm8gPSBudWxsO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgbGlzdEl0ZW1DbGljayhpdGVtKSB7XHJcbiAgICBpZiAoaXRlbS5kaXNhYmxlIHx8IHRoaXMuYWN0aXZlVHlwZUl0ZW1bJ3R5cGUnXSA9PT0gaXRlbVsndHlwZSddKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIHRoaXMuYWN0aXZlVHlwZUl0ZW0gPSBpdGVtO1xyXG4gICAgdGhpcy52aWV3Q2hhbmdlTWFuYWdlU2VyLnVwZGF0ZUN1cnJlbnRWaWV3SWQodGhpcy5hY3RpdmVUeXBlSXRlbVsndHlwZSddLHRoaXMudmlld0dyb3VwSWQpO1xyXG4gICAgdGhpcy50b29sVHlwZUNoYW5nZS5lbWl0KGl0ZW0pO1xyXG4gICAgaWYgKHRoaXMudHlwZWxpc3QpIHtcclxuICAgICAgdGhpcy5fcmVuZGVyZXIuc2V0U3R5bGUoXHJcbiAgICAgICAgdGhpcy50eXBlbGlzdC5uYXRpdmVFbGVtZW50LFxyXG4gICAgICAgICdkaXNwbGF5JyxcclxuICAgICAgICAnbm9uZSdcclxuICAgICAgKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGRyb3Bkb3duTW91c2VFbnRlcigpIHtcclxuICAgIHRoaXMuX3JlbmRlcmVyLnNldFN0eWxlKFxyXG4gICAgICB0aGlzLnR5cGVsaXN0Lm5hdGl2ZUVsZW1lbnQsXHJcbiAgICAgICdkaXNwbGF5JyxcclxuICAgICAgJ2Jsb2NrJ1xyXG4gICAgKTtcclxuICB9XHJcbiAgZHJvcGRvd25Nb3VzZUxlYXZlKCkge1xyXG4gICAgdGhpcy5fcmVuZGVyZXIuc2V0U3R5bGUoXHJcbiAgICAgIHRoaXMudHlwZWxpc3QubmF0aXZlRWxlbWVudCxcclxuICAgICAgJ2Rpc3BsYXknLFxyXG4gICAgICAnbm9uZSdcclxuICAgICk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOino+WGs+WNoeeJh+WSjOWIl+ihqOS4pOS4quiPnOWNleWQjOaXtuaJk+W8gO+8jOWQjOatpeaVsOaNruaXtuWAme+8jOW9k+WJjeeahOagh+etvuaYvuekuuS4jeWvueeahOmXrumimFxyXG4gICAqL1xyXG4gIHByaXZhdGUgb2JzZXJ2ZXJFbGVtZW50KCkge1xyXG4gICAgICAgIGlmKCF0aGlzLmluamVjdCl7XHJcbiAgICAgICAgICAvLyDliJ3lp4vmm7TmlrDkuIDmrKHlvZPliY3nsbvlnotcclxuICAgICAgICAgIHRoaXMudmlld0NoYW5nZU1hbmFnZVNlclsnY2hhbmdlQ3VycmVudFZpZXdJZEZyb21DTVAnXSh0aGlzLmFjdGl2ZVR5cGVJdGVtWyd0eXBlJ10sdGhpcy52aWV3R3JvdXBJZCk7XHJcbiAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICghdGhpcy5uZ1pvbmUpIHtcclxuICAgICAgICAgICAgdGhpcy5uZ1pvbmUgPSB0aGlzLmluamVjdC5nZXQ8Tmdab25lPihOZ1pvbmUsIG51bGwpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoIXRoaXMucm8pIHtcclxuICAgICAgICAgICAgICAgIHRoaXMubmdab25lLnJ1bk91dHNpZGVBbmd1bGFyKCgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnJvID0gbmV3IFJlc2l6ZU9ic2VydmVyKChlbnRyaWVzLCBvYnNlcnZlcikgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgaWYoZW50cmllc1swXS5jb250ZW50UmVjdC53aWR0aD4wKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy52aWV3Q2hhbmdlTWFuYWdlU2VyWydjaGFuZ2VDdXJyZW50Vmlld0lkRnJvbUNNUCddKHRoaXMuYWN0aXZlVHlwZUl0ZW1bJ3R5cGUnXSx0aGlzLnZpZXdHcm91cElkKTtcclxuICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnJvLm9ic2VydmUodGhpcy52aWV3Y2hhbmdld3JhcHBlci5uYXRpdmVFbGVtZW50KTtcclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgfVxyXG4gIH1cclxufVxyXG4iXX0=
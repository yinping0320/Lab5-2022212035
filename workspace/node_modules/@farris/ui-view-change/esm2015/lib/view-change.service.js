/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Injectable } from '@angular/core';
import { ViewChangeManageService } from './view-change-manage.service';
import { BehaviorSubject } from 'rxjs';
import * as i0 from "@angular/core";
/**
 * @record
 */
function StoreViewService() { }
/**
 * @record
 */
function StoreCurrentInfo() { }
if (false) {
    /** @type {?} */
    StoreCurrentInfo.prototype.guid;
    /** @type {?} */
    StoreCurrentInfo.prototype.groupId;
    /** @type {?} */
    StoreCurrentInfo.prototype.count;
}
/**
 * @record
 */
function StoreCurrentDirectiveIns() { }
if (false) {
    /** @type {?} */
    StoreCurrentDirectiveIns.prototype.groupId;
    /** @type {?} */
    StoreCurrentDirectiveIns.prototype.instances;
}
/**
 * @record
 */
function StoreViewChangeCmp() { }
if (false) {
    /** @type {?} */
    StoreViewChangeCmp.prototype.groupId;
    /** @type {?} */
    StoreViewChangeCmp.prototype.cmpId;
    /** @type {?} */
    StoreViewChangeCmp.prototype.cmpEl;
    /** @type {?} */
    StoreViewChangeCmp.prototype.guid;
    /** @type {?} */
    StoreViewChangeCmp.prototype.count;
    /** @type {?} */
    StoreViewChangeCmp.prototype.parentEl;
}
/**
 * ximena
 * 20240301修改
 * 1、此服务原本的功能被拆分到view-change-manage.service.ts里
 * 2、解决：在框架里打开不同表单，但是分组id一样引起的切换菜单后看不到界面的问题
 * 3、方式：拆分root的服务到一个普通服务里，root服务只用来区分Module
 * ----------------------------可能问题
 *  1、存在显示隐藏切换ngIf方式切换的view-change元素，归集不到一个模块id下
 * 归集到其他的模块下，但是不影响展示
 *
 */
/**
 * ximena
 * 20240410修改
 * 上次版本修改：利用module初始化，创建单一guid，区分不同表单下的多视图。
 * 缺点：
 * 1、module只能初始化一次，后面因为缓存机制，不会再次初始化，导致第二次打开单据可能出现问题
 * 2、同一个组件被多个菜单组合不支持
 * 本次修改方案：
 * 1、通过currentInfos，存储组件创建时的guid对象，当对应的指令初始化完毕，删除这个对象
 * 2、通过BehaviorSubject，组件创建时的guid对象时，next变量currentInfos
 * 3、通过storeDirectiveInstances，解决组件和指令创建顺序先后的问题
 * 4、通过storeViewChangeCmps，解决在标签页下，指令初始化一次，多视图组件会被多次初始化，此时双方无法匹配的问题
 * 支持的场景
 * 1、同一个组件被多个菜单组合，可以正常显示
 * 2、同个表单内，多个多视图，只要组件、指令匹配，无论groupid是否一样，可以正常显示
 * 3、同个表单内，在某个多视图的指令内再嵌套其他多视图，可以正常显示
 * 4、标签页上使用时，多个多视图，可以正常显示
 */
export class ViewChangeService {
    constructor() {
        /**
         * 每次view-change组件创建完会创建current对象，然后放到此处保存。
         * 当对应的指令都初始化后，开始销毁
         */
        this.currentInfos = [];
        this.current = {
            guid: '',
            groupId: '',
            count: 0
        };
        this.storeDirectiveInstances = [];
        this.currentDirectiveInstance = [];
        this.guidChangeSubject = new BehaviorSubject([{
                guid: '',
                groupId: '',
                count: 0
            }]);
        this.storeViewChangeSer = {};
        /**
         * 解决标签页上有组件和指令
         * 当组件销毁时，指令还存在，这样根据原来的逻辑找不到组件与指令的对应关系
         */
        this.storeViewChangeCmps = [];
    }
    /**
     * 获取当前模块信息
     * @param {?=} id
     * @return {?}
     */
    getModuleInfo(id = '') {
        id = id ? id : this.current.guid;
        return this.storeViewChangeSer[id];
    }
    /**
     * 删除对应的模块信息
     * @param {?} guid
     * @return {?}
     */
    removeModuleInfo(guid) {
        if (guid && this.storeViewChangeSer.hasOwnProperty(guid)) {
            this.storeViewChangeSer[guid] = null;
            delete this.storeViewChangeSer[guid];
            /** @type {?} */
            let findCmpIndex = this.storeViewChangeCmps.findIndex((/**
             * @param {?} item
             * @return {?}
             */
            item => item.guid == guid));
            this.storeViewChangeCmps.splice(findCmpIndex, 1);
        }
    }
    /**
     * 被用于指令绑定
     * @return {?}
     */
    getModuleChange() {
        return this.guidChangeSubject;
    }
    /**
     * 创建实例
     * @param {?} moduleCount
     * @param {?} viewChangeCmpEl
     * @return {?}
     */
    createViewChangeCmp(moduleCount, viewChangeCmpEl) {
        // 比如场景标签页上有视图组件，但是标签页内容区域有指令，视图组件会初始化多次
        /** @type {?} */
        let existsGuid = this.getGuidFromStoreViewChangeCmp(moduleCount["groupId"], viewChangeCmpEl);
        if (existsGuid) {
            return existsGuid;
        }
        // 存在当前模型ID
        this.current = Object.assign({
            guid: this.createGuid(),
        }, moduleCount);
        // 创建对象
        if (!this.storeViewChangeSer.hasOwnProperty(this.current.guid)) {
            this.storeViewChangeSer[this.current.guid] = new ViewChangeManageService();
        }
        /** @type {?} */
        let tCurrent = Object.assign({}, this.current);
        // 保存当前对应信息
        this.currentInfos.push(tCurrent);
        // 存储起来
        this.storeViewChangeCmps.push(Object.assign({ cmpId: viewChangeCmpEl.id, cmpEl: viewChangeCmpEl, parentEl: null }, this.current));
        if (this.currentDirectiveInstance.length > 0) {
            // 当前指令实例存储区有值
            /** @type {?} */
            let curInsGroupId = this.currentDirectiveInstance[0]['fViewGroupId'];
            if (this.current.groupId == curInsGroupId) {
                // 属于同一个分组
                this.doDirectiveInstanceInit(this.currentDirectiveInstance, this.current.guid);
            }
            else {
                // 检查之前存储是否有值  
                this.storeDirectiveInstances.push({ groupId: curInsGroupId, instances: [].concat(this.currentDirectiveInstance) });
                this.currentDirectiveInstance = [];
                this.findInstoreDirectiveInstances();
            }
        }
        else {
            this.findInstoreDirectiveInstances();
        }
        this.guidChangeSubject.next(this.currentInfos);
        return tCurrent.guid;
    }
    /**
     *
     * @private
     * @return {?}
     */
    findInstoreDirectiveInstances() {
        //查找 已有的实例里面是否有对应的groupdId
        /** @type {?} */
        let findGroupIdIndex = this.storeDirectiveInstances.findIndex((/**
         * @param {?} item
         * @return {?}
         */
        item => item['groupId'] == this.current.groupId));
        if (findGroupIdIndex > -1) {
            this.doDirectiveInstanceInit(this.storeDirectiveInstances[findGroupIdIndex]['instances'], this.current.guid);
        }
    }
    /**
     * 执行指令实例的初始化
     * @private
     * @param {?} instances
     * @param {?} guid
     * @return {?}
     */
    doDirectiveInstanceInit(instances, guid) {
        /** @type {?} */
        let maxLen = instances.length;
        for (var k = 0; k < maxLen; k++) {
            if (!instances || instances.length != maxLen) {
                break;
            }
            else {
                instances[k]["viewChangeOnInit"](guid);
            }
        }
        if (instances && instances.length > 0) {
            if (instances.length != maxLen) {
                // 在外面被删除
                this.doDirectiveInstanceInit(instances, guid);
            }
        }
    }
    /**
     * 存储指令实例
     * @param {?} tInstance
     * @return {?}
     */
    storeViewChangeDirectiveInstance(tInstance) {
        if (!this.current.groupId || this.current.groupId == tInstance['fViewGroupId']) {
            // 与当前匹配
            this.currentDirectiveInstance.push(tInstance);
        }
        else {
            // 与当前不匹配
            /** @type {?} */
            let findGroupInfo = this.storeDirectiveInstances.find((/**
             * @param {?} item
             * @return {?}
             */
            (item) => item['groupId'] == tInstance['fViewGroupId']));
            if (findGroupInfo) {
                findGroupInfo.instances.push(tInstance);
            }
            else {
                this.storeDirectiveInstances.push({ groupId: tInstance['fViewGroupId'], instances: [tInstance] });
            }
        }
    }
    /**
     * 移除指令实例
     * @param {?} viewItemType
     * @param {?} guid
     * @return {?}
     */
    removeViewChangeDirectiveInstance(viewItemType, guid) {
        if (guid == this.current.guid) {
            if (this.currentDirectiveInstance.length > 0) {
                /** @type {?} */
                let tfindIndex = this.currentDirectiveInstance.findIndex((/**
                 * @param {?} item
                 * @return {?}
                 */
                (item) => item['viewItemType'] == viewItemType));
                if (tfindIndex > -1) {
                    this.currentDirectiveInstance.splice(tfindIndex, 1);
                }
            }
        }
        /** @type {?} */
        let findModuleIndex = this.currentInfos.findIndex((/**
         * @param {?} item
         * @return {?}
         */
        item => item.guid == guid));
        if (findModuleIndex > -1) {
            /** @type {?} */
            let findModuleInfo = this.currentInfos[findModuleIndex];
            findModuleInfo['count'] = findModuleInfo['count'] - 1;
            if (findModuleInfo['count'] <= 0) {
                this.currentInfos.splice(findModuleIndex, 1);
                /** @type {?} */
                let findGroupIndex = this.storeDirectiveInstances.findIndex((/**
                 * @param {?} item
                 * @return {?}
                 */
                (item) => item['groupId'] == findModuleInfo["groupId"]));
                this.storeDirectiveInstances.splice(findGroupIndex, 1);
                if (this.current.guid == guid) {
                    // 重置当前
                    this.current = { guid: '',
                        groupId: '',
                        count: 0
                    };
                }
            }
        }
    }
    /**
     * @private
     * @return {?}
     */
    createGuid() {
        /** @type {?} */
        const S4 = (/**
         * @return {?}
         */
        function () {
            return (((1 + Math.random()) * 0x10000) | 0).toString(16).substring(1);
        });
        return S4() + S4() + "-" + S4() + "-" + S4() + "-" + S4() + "-" + S4() + S4() + S4();
    }
    /**
     * 更新多视图组件
     * @param {?} guid
     * @param {?} groupId
     * @param {?} viewChangeDirectiveEl
     * @return {?}
     */
    updatedStoreViewChangeCmp(guid, groupId, viewChangeDirectiveEl) {
        /** @type {?} */
        let findStoreViewChangeCmp = this.storeViewChangeCmps.find((/**
         * @param {?} item
         * @return {?}
         */
        item => !item["parentEl"] && item['guid'] == guid));
        if (findStoreViewChangeCmp) {
            // 没有赋值的元素
            /** @type {?} */
            let findParent = this.findCommonParent(viewChangeDirectiveEl, findStoreViewChangeCmp.cmpEl);
            findStoreViewChangeCmp["parentEl"] = findParent;
            findStoreViewChangeCmp["cmpEl"] = null;
        }
    }
    /**
     * 找两个元素的公共父元素
     * @private
     * @param {?} element1
     * @param {?} element2
     * @return {?}
     */
    findCommonParent(element1, element2) {
        /** @type {?} */
        var parent1 = element1;
        while (parent1 !== null) {
            if (parent1.contains(element2)) {
                return parent1;
            }
            parent1 = parent1.parentElement;
        }
        return null; // 如果没有共同父元素，则返回 null
    }
    /**
     * @private
     * @param {?} groupId
     * @param {?} cmpEl
     * @return {?}
     */
    getGuidFromStoreViewChangeCmp(groupId, cmpEl) {
        /** @type {?} */
        let findCmp = this.storeViewChangeCmps.find((/**
         * @param {?} item
         * @return {?}
         */
        item => {
            if (item["groupId"] == groupId && item["cmpId"] == cmpEl.id) {
                return item["parentEl"] ? item["parentEl"].contains(cmpEl) : false;
            }
        }));
        return findCmp ? findCmp["guid"] : "";
    }
}
ViewChangeService.decorators = [
    { type: Injectable, args: [{
                providedIn: 'root'
            },] }
];
/** @nocollapse */
ViewChangeService.ctorParameters = () => [];
/** @nocollapse */ ViewChangeService.ngInjectableDef = i0.defineInjectable({ factory: function ViewChangeService_Factory() { return new ViewChangeService(); }, token: ViewChangeService, providedIn: "root" });
if (false) {
    /**
     * 每次view-change组件创建完会创建current对象，然后放到此处保存。
     * 当对应的指令都初始化后，开始销毁
     * @type {?}
     * @private
     */
    ViewChangeService.prototype.currentInfos;
    /**
     * @type {?}
     * @private
     */
    ViewChangeService.prototype.current;
    /**
     * @type {?}
     * @private
     */
    ViewChangeService.prototype.storeDirectiveInstances;
    /**
     * @type {?}
     * @private
     */
    ViewChangeService.prototype.currentDirectiveInstance;
    /**
     * @type {?}
     * @private
     */
    ViewChangeService.prototype.guidChangeSubject;
    /**
     * @type {?}
     * @private
     */
    ViewChangeService.prototype.storeViewChangeSer;
    /**
     * 解决标签页上有组件和指令
     * 当组件销毁时，指令还存在，这样根据原来的逻辑找不到组件与指令的对应关系
     * @type {?}
     * @private
     */
    ViewChangeService.prototype.storeViewChangeCmps;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidmlldy1jaGFuZ2Uuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvdWktdmlldy1jaGFuZ2UvIiwic291cmNlcyI6WyJsaWIvdmlldy1jaGFuZ2Uuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUMzQyxPQUFPLEVBQUUsdUJBQXVCLEVBQUUsTUFBTSw4QkFBOEIsQ0FBQztBQUN2RSxPQUFPLEVBQUUsZUFBZSxFQUFXLE1BQU0sTUFBTSxDQUFDOzs7OztBQUVoRCwrQkFFQzs7OztBQUVELCtCQUlDOzs7SUFIQyxnQ0FBYTs7SUFDYixtQ0FBZ0I7O0lBQ2hCLGlDQUFjOzs7OztBQUVoQix1Q0FHQzs7O0lBRkMsMkNBQWdCOztJQUNoQiw2Q0FBc0I7Ozs7O0FBRXhCLGlDQU9DOzs7SUFOQyxxQ0FBZTs7SUFDZixtQ0FBYTs7SUFDYixtQ0FBdUI7O0lBQ3ZCLGtDQUFZOztJQUNaLG1DQUFhOztJQUNiLHNDQUEwQjs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQWtDNUIsTUFBTSxPQUFPLGlCQUFpQjtJQXlCNUI7Ozs7O1FBcEJRLGlCQUFZLEdBQTRCLEVBQUUsQ0FBQztRQUMzQyxZQUFPLEdBQXFCO1lBQ2xDLElBQUksRUFBRSxFQUFFO1lBQ1IsT0FBTyxFQUFFLEVBQUU7WUFDWCxLQUFLLEVBQUUsQ0FBQztTQUNULENBQUM7UUFDTSw0QkFBdUIsR0FBb0MsRUFBRSxDQUFDO1FBQzlELDZCQUF3QixHQUFHLEVBQUUsQ0FBQztRQUM5QixzQkFBaUIsR0FBRyxJQUFJLGVBQWUsQ0FBMEIsQ0FBQztnQkFDeEUsSUFBSSxFQUFFLEVBQUU7Z0JBQ1IsT0FBTyxFQUFFLEVBQUU7Z0JBQ1gsS0FBSyxFQUFFLENBQUM7YUFDVCxDQUFDLENBQUMsQ0FBQztRQUNJLHVCQUFrQixHQUFxQixFQUFFLENBQUM7Ozs7O1FBSzFDLHdCQUFtQixHQUEyQixFQUFFLENBQUM7SUFFMUMsQ0FBQzs7Ozs7O0lBS2hCLGFBQWEsQ0FBQyxFQUFFLEdBQUcsRUFBRTtRQUNuQixFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDO1FBQ2pDLE9BQU8sSUFBSSxDQUFDLGtCQUFrQixDQUFDLEVBQUUsQ0FBQyxDQUFDO0lBQ3JDLENBQUM7Ozs7OztJQUtELGdCQUFnQixDQUFDLElBQUk7UUFDbkIsSUFBSSxJQUFJLElBQUksSUFBSSxDQUFDLGtCQUFrQixDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUMsRUFBRTtZQUN4RCxJQUFJLENBQUMsa0JBQWtCLENBQUMsSUFBSSxDQUFDLEdBQUcsSUFBSSxDQUFDO1lBQ3JDLE9BQU8sSUFBSSxDQUFDLGtCQUFrQixDQUFDLElBQUksQ0FBQyxDQUFDOztnQkFDakMsWUFBWSxHQUFDLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxTQUFTOzs7O1lBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsSUFBSSxJQUFJLElBQUksRUFBQztZQUM5RSxJQUFJLENBQUMsbUJBQW1CLENBQUMsTUFBTSxDQUFDLFlBQVksRUFBRSxDQUFDLENBQUMsQ0FBQztTQUNsRDtJQUNILENBQUM7Ozs7O0lBS0QsZUFBZTtRQUNiLE9BQU8sSUFBSSxDQUFDLGlCQUFpQixDQUFDO0lBQ2hDLENBQUM7Ozs7Ozs7SUFJRCxtQkFBbUIsQ0FBQyxXQUFXLEVBQUMsZUFBMkI7OztZQUVwRCxVQUFVLEdBQUMsSUFBSSxDQUFDLDZCQUE2QixDQUFDLFdBQVcsQ0FBQyxTQUFTLENBQUMsRUFBQyxlQUFlLENBQUM7UUFDekYsSUFBRyxVQUFVLEVBQUM7WUFDYixPQUFPLFVBQVUsQ0FBQTtTQUNqQjtRQUNGLFdBQVc7UUFDWCxJQUFJLENBQUMsT0FBTyxHQUFHLE1BQU0sQ0FBQyxNQUFNLENBQUM7WUFDM0IsSUFBSSxFQUFFLElBQUksQ0FBQyxVQUFVLEVBQUU7U0FDeEIsRUFBRSxXQUFXLENBQUMsQ0FBQztRQUNoQixPQUFPO1FBQ1AsSUFBSSxDQUFDLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxjQUFjLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsRUFBRTtZQUM5RCxJQUFJLENBQUMsa0JBQWtCLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsR0FBRyxJQUFJLHVCQUF1QixFQUFFLENBQUM7U0FDNUU7O1lBQ0csUUFBUSxHQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsRUFBRSxFQUFDLElBQUksQ0FBQyxPQUFPLENBQUM7UUFDM0MsV0FBVztRQUNYLElBQUksQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBQ2pDLE9BQU87UUFDUCxJQUFJLENBQUMsbUJBQW1CLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsRUFBQyxLQUFLLEVBQUMsZUFBZSxDQUFDLEVBQUUsRUFBQyxLQUFLLEVBQUMsZUFBZSxFQUFDLFFBQVEsRUFBQyxJQUFJLEVBQUMsRUFBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQztRQUMxSCxJQUFJLElBQUksQ0FBQyx3QkFBd0IsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFOzs7Z0JBRXhDLGFBQWEsR0FBRyxJQUFJLENBQUMsd0JBQXdCLENBQUMsQ0FBQyxDQUFDLENBQUMsY0FBYyxDQUFDO1lBQ3BFLElBQUksSUFBSSxDQUFDLE9BQU8sQ0FBQyxPQUFPLElBQUksYUFBYSxFQUFFO2dCQUN6QyxVQUFVO2dCQUNWLElBQUksQ0FBQyx1QkFBdUIsQ0FBQyxJQUFJLENBQUMsd0JBQXdCLEVBQUUsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQzthQUNoRjtpQkFBTTtnQkFDTCxlQUFlO2dCQUNmLElBQUksQ0FBQyx1QkFBdUIsQ0FBQyxJQUFJLENBQUMsRUFBRSxPQUFPLEVBQUUsYUFBYSxFQUFFLFNBQVMsRUFBRSxFQUFFLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyx3QkFBd0IsQ0FBQyxFQUFFLENBQUMsQ0FBQztnQkFDbkgsSUFBSSxDQUFDLHdCQUF3QixHQUFHLEVBQUUsQ0FBQztnQkFDbkMsSUFBSSxDQUFDLDZCQUE2QixFQUFFLENBQUM7YUFDdEM7U0FDRjthQUFNO1lBQ0wsSUFBSSxDQUFDLDZCQUE2QixFQUFFLENBQUM7U0FDdEM7UUFDRCxJQUFJLENBQUMsaUJBQWlCLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQztRQUMvQyxPQUFPLFFBQVEsQ0FBQyxJQUFJLENBQUM7SUFDdkIsQ0FBQzs7Ozs7O0lBSU8sNkJBQTZCOzs7WUFFL0IsZ0JBQWdCLEdBQUcsSUFBSSxDQUFDLHVCQUF1QixDQUFDLFNBQVM7Ozs7UUFBQyxJQUFJLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxJQUFJLENBQUMsT0FBTyxDQUFDLE9BQU8sRUFBQztRQUM5RyxJQUFJLGdCQUFnQixHQUFHLENBQUMsQ0FBQyxFQUFFO1lBQ3pCLElBQUksQ0FBQyx1QkFBdUIsQ0FBQyxJQUFJLENBQUMsdUJBQXVCLENBQUMsZ0JBQWdCLENBQUMsQ0FBQyxXQUFXLENBQUMsRUFBRSxJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDO1NBQzlHO0lBQ0gsQ0FBQzs7Ozs7Ozs7SUFJTyx1QkFBdUIsQ0FBQyxTQUFTLEVBQUUsSUFBSTs7WUFDekMsTUFBTSxHQUFHLFNBQVMsQ0FBQyxNQUFNO1FBQzdCLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxNQUFNLEVBQUUsQ0FBQyxFQUFFLEVBQUU7WUFDL0IsSUFBSSxDQUFDLFNBQVMsSUFBSSxTQUFTLENBQUMsTUFBTSxJQUFJLE1BQU0sRUFBRTtnQkFDNUMsTUFBTTthQUNQO2lCQUFNO2dCQUNMLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDO2FBQ3hDO1NBQ0Y7UUFDRCxJQUFJLFNBQVMsSUFBSSxTQUFTLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRTtZQUNyQyxJQUFJLFNBQVMsQ0FBQyxNQUFNLElBQUksTUFBTSxFQUFFO2dCQUM5QixTQUFTO2dCQUNULElBQUksQ0FBQyx1QkFBdUIsQ0FBQyxTQUFTLEVBQUUsSUFBSSxDQUFDLENBQUM7YUFDL0M7U0FDRjtJQUNILENBQUM7Ozs7OztJQUtELGdDQUFnQyxDQUFDLFNBQVM7UUFDeEMsSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsT0FBTyxJQUFJLElBQUksQ0FBQyxPQUFPLENBQUMsT0FBTyxJQUFJLFNBQVMsQ0FBQyxjQUFjLENBQUMsRUFBRTtZQUM5RSxRQUFRO1lBQ1IsSUFBSSxDQUFDLHdCQUF3QixDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQztTQUMvQzthQUFNOzs7Z0JBRUQsYUFBYSxHQUFHLElBQUksQ0FBQyx1QkFBdUIsQ0FBQyxJQUFJOzs7O1lBQUMsQ0FBQyxJQUFJLEVBQUUsRUFBRSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxTQUFTLENBQUMsY0FBYyxDQUFDLEVBQUM7WUFDN0csSUFBSSxhQUFhLEVBQUU7Z0JBQ2pCLGFBQWEsQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDO2FBQ3pDO2lCQUFNO2dCQUNMLElBQUksQ0FBQyx1QkFBdUIsQ0FBQyxJQUFJLENBQUMsRUFBRSxPQUFPLEVBQUUsU0FBUyxDQUFDLGNBQWMsQ0FBQyxFQUFFLFNBQVMsRUFBRSxDQUFDLFNBQVMsQ0FBQyxFQUFFLENBQUMsQ0FBQTthQUNsRztTQUNGO0lBQ0gsQ0FBQzs7Ozs7OztJQUtELGlDQUFpQyxDQUFDLFlBQW9CLEVBQUUsSUFBWTtRQUNsRSxJQUFJLElBQUksSUFBSSxJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksRUFBRTtZQUM3QixJQUFJLElBQUksQ0FBQyx3QkFBd0IsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFOztvQkFDeEMsVUFBVSxHQUFHLElBQUksQ0FBQyx3QkFBd0IsQ0FBQyxTQUFTOzs7O2dCQUFDLENBQUMsSUFBSSxFQUFFLEVBQUUsQ0FBQyxJQUFJLENBQUMsY0FBYyxDQUFDLElBQUksWUFBWSxFQUFDO2dCQUN4RyxJQUFJLFVBQVUsR0FBRyxDQUFDLENBQUMsRUFBRTtvQkFDbkIsSUFBSSxDQUFDLHdCQUF3QixDQUFDLE1BQU0sQ0FBQyxVQUFVLEVBQUUsQ0FBQyxDQUFDLENBQUM7aUJBQ3JEO2FBQ0Y7U0FDRjs7WUFDRyxlQUFlLEdBQUcsSUFBSSxDQUFDLFlBQVksQ0FBQyxTQUFTOzs7O1FBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsSUFBSSxJQUFJLElBQUksRUFBQztRQUM1RSxJQUFJLGVBQWUsR0FBRyxDQUFDLENBQUMsRUFBRTs7Z0JBQ3BCLGNBQWMsR0FBRyxJQUFJLENBQUMsWUFBWSxDQUFDLGVBQWUsQ0FBQztZQUN2RCxjQUFjLENBQUMsT0FBTyxDQUFDLEdBQUcsY0FBYyxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUN0RCxJQUFJLGNBQWMsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLEVBQUU7Z0JBQ2hDLElBQUksQ0FBQyxZQUFZLENBQUMsTUFBTSxDQUFDLGVBQWUsRUFBRSxDQUFDLENBQUMsQ0FBQzs7b0JBQ3pDLGNBQWMsR0FBRyxJQUFJLENBQUMsdUJBQXVCLENBQUMsU0FBUzs7OztnQkFBQyxDQUFDLElBQUksRUFBRSxFQUFFLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLGNBQWMsQ0FBQyxTQUFTLENBQUMsRUFBQztnQkFDbkgsSUFBSSxDQUFDLHVCQUF1QixDQUFDLE1BQU0sQ0FBQyxjQUFjLEVBQUUsQ0FBQyxDQUFDLENBQUM7Z0JBQ3ZELElBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLElBQUUsSUFBSSxFQUFDO29CQUN6QixPQUFPO29CQUNQLElBQUksQ0FBQyxPQUFPLEdBQUMsRUFBQyxJQUFJLEVBQUUsRUFBRTt3QkFDcEIsT0FBTyxFQUFFLEVBQUU7d0JBQ1gsS0FBSyxFQUFFLENBQUM7cUJBQ1QsQ0FBQTtpQkFDRjthQUNGO1NBQ0Y7SUFDSCxDQUFDOzs7OztJQUNPLFVBQVU7O2NBQ1YsRUFBRTs7O1FBQUc7WUFDVCxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUMsTUFBTSxFQUFFLENBQUMsR0FBRyxPQUFPLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ3pFLENBQUMsQ0FBQTtRQUNELE9BQU8sRUFBRSxFQUFFLEdBQUcsRUFBRSxFQUFFLEdBQUcsR0FBRyxHQUFHLEVBQUUsRUFBRSxHQUFHLEdBQUcsR0FBRyxFQUFFLEVBQUUsR0FBRyxHQUFHLEdBQUcsRUFBRSxFQUFFLEdBQUcsR0FBRyxHQUFHLEVBQUUsRUFBRSxHQUFHLEVBQUUsRUFBRSxHQUFHLEVBQUUsRUFBRSxDQUFDO0lBQ3ZGLENBQUM7Ozs7Ozs7O0lBT0QseUJBQXlCLENBQUMsSUFBVyxFQUFDLE9BQWMsRUFBQyxxQkFBaUM7O1lBQzlFLHNCQUFzQixHQUFDLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxJQUFJOzs7O1FBQUMsSUFBSSxDQUFBLEVBQUUsQ0FBQSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsSUFBRSxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUUsSUFBSSxFQUFDO1FBQ3JHLElBQUcsc0JBQXNCLEVBQUM7OztnQkFFcEIsVUFBVSxHQUFFLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxxQkFBcUIsRUFBQyxzQkFBc0IsQ0FBQyxLQUFLLENBQUM7WUFDekYsc0JBQXNCLENBQUMsVUFBVSxDQUFDLEdBQUMsVUFBVSxDQUFDO1lBQzlDLHNCQUFzQixDQUFDLE9BQU8sQ0FBQyxHQUFDLElBQUksQ0FBQztTQUN0QztJQUNMLENBQUM7Ozs7Ozs7O0lBT08sZ0JBQWdCLENBQUMsUUFBUSxFQUFFLFFBQVE7O1lBQ3JDLE9BQU8sR0FBRyxRQUFRO1FBRXRCLE9BQU8sT0FBTyxLQUFLLElBQUksRUFBRTtZQUN2QixJQUFJLE9BQU8sQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDLEVBQUU7Z0JBQzlCLE9BQU8sT0FBTyxDQUFDO2FBQ2hCO1lBQ0QsT0FBTyxHQUFHLE9BQU8sQ0FBQyxhQUFhLENBQUM7U0FDakM7UUFDRCxPQUFPLElBQUksQ0FBQyxDQUFDLHFCQUFxQjtJQUNwQyxDQUFDOzs7Ozs7O0lBRU8sNkJBQTZCLENBQUMsT0FBTyxFQUFDLEtBQUs7O1lBQzdDLE9BQU8sR0FBQyxJQUFJLENBQUMsbUJBQW1CLENBQUMsSUFBSTs7OztRQUFDLElBQUksQ0FBQSxFQUFFO1lBQzlDLElBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFFLE9BQU8sSUFBRSxJQUFJLENBQUMsT0FBTyxDQUFDLElBQUUsS0FBSyxDQUFDLEVBQUUsRUFBQztnQkFDakQsT0FBTyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUEsQ0FBQyxDQUFBLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLENBQUEsQ0FBQyxDQUFBLEtBQUssQ0FBQzthQUNsRTtRQUNILENBQUMsRUFBQztRQUNGLE9BQU8sT0FBTyxDQUFBLENBQUMsQ0FBQSxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUEsQ0FBQyxDQUFBLEVBQUUsQ0FBQTtJQUNuQyxDQUFDOzs7WUE1TkYsVUFBVSxTQUFDO2dCQUNWLFVBQVUsRUFBRSxNQUFNO2FBQ25COzs7Ozs7Ozs7Ozs7SUFNQyx5Q0FBbUQ7Ozs7O0lBQ25ELG9DQUlFOzs7OztJQUNGLG9EQUFzRTs7Ozs7SUFDdEUscURBQXNDOzs7OztJQUN0Qyw4Q0FJSTs7Ozs7SUFDSiwrQ0FBa0Q7Ozs7Ozs7SUFLbEQsZ0RBQXlEIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBWaWV3Q2hhbmdlTWFuYWdlU2VydmljZSB9IGZyb20gJy4vdmlldy1jaGFuZ2UtbWFuYWdlLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBCZWhhdmlvclN1YmplY3QsIFN1YmplY3QgfSBmcm9tICdyeGpzJztcclxuXHJcbmludGVyZmFjZSBTdG9yZVZpZXdTZXJ2aWNlIHtcclxuICBbZ3VpZDogc3RyaW5nXTogVmlld0NoYW5nZU1hbmFnZVNlcnZpY2U7XHJcbn1cclxuXHJcbmludGVyZmFjZSBTdG9yZUN1cnJlbnRJbmZvIHtcclxuICBndWlkOiBzdHJpbmc7XHJcbiAgZ3JvdXBJZDogc3RyaW5nO1xyXG4gIGNvdW50OiBudW1iZXI7XHJcbn1cclxuaW50ZXJmYWNlIFN0b3JlQ3VycmVudERpcmVjdGl2ZUlucyB7XHJcbiAgZ3JvdXBJZDogc3RyaW5nO1xyXG4gIGluc3RhbmNlczogQXJyYXk8YW55PjtcclxufVxyXG5pbnRlcmZhY2UgU3RvcmVWaWV3Q2hhbmdlQ21we1xyXG4gIGdyb3VwSWQ6c3RyaW5nO1xyXG4gIGNtcElkOnN0cmluZztcclxuICBjbXBFbDpIVE1MRWxlbWVudHxudWxsO1xyXG4gIGd1aWQ6c3RyaW5nO1xyXG4gIGNvdW50Om51bWJlcjtcclxuICBwYXJlbnRFbDpIVE1MRWxlbWVudHxudWxsOy8v5b2T5oyH5Luk5Yid5aeL5YyW5Lul5ZCO5qyh5bGe5oCn5omN5Lya5pyJ5YC8XHJcbn1cclxuLyoqXHJcbiAqIHhpbWVuYVxyXG4gKiAyMDI0MDMwMeS/ruaUuVxyXG4gKiAx44CB5q2k5pyN5Yqh5Y6f5pys55qE5Yqf6IO96KKr5ouG5YiG5Yiwdmlldy1jaGFuZ2UtbWFuYWdlLnNlcnZpY2UudHPph4xcclxuICogMuOAgeino+WGs++8muWcqOahhuaetumHjOaJk+W8gOS4jeWQjOihqOWNle+8jOS9huaYr+WIhue7hGlk5LiA5qC35byV6LW355qE5YiH5o2i6I+c5Y2V5ZCO55yL5LiN5Yiw55WM6Z2i55qE6Zeu6aKYXHJcbiAqIDPjgIHmlrnlvI/vvJrmi4bliIZyb29055qE5pyN5Yqh5Yiw5LiA5Liq5pmu6YCa5pyN5Yqh6YeM77yMcm9vdOacjeWKoeWPqueUqOadpeWMuuWIhk1vZHVsZVxyXG4gKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t5Y+v6IO96Zeu6aKYXHJcbiAqICAx44CB5a2Y5Zyo5pi+56S66ZqQ6JeP5YiH5o2ibmdJZuaWueW8j+WIh+aNoueahHZpZXctY2hhbmdl5YWD57Sg77yM5b2S6ZuG5LiN5Yiw5LiA5Liq5qih5Z2XaWTkuItcclxuICog5b2S6ZuG5Yiw5YW25LuW55qE5qih5Z2X5LiL77yM5L2G5piv5LiN5b2x5ZON5bGV56S6XHJcbiAqIFxyXG4gKi9cclxuLyoqXHJcbiAqIHhpbWVuYVxyXG4gKiAyMDI0MDQxMOS/ruaUuVxyXG4gKiDkuIrmrKHniYjmnKzkv67mlLnvvJrliKnnlKhtb2R1bGXliJ3lp4vljJbvvIzliJvlu7rljZXkuIBndWlk77yM5Yy65YiG5LiN5ZCM6KGo5Y2V5LiL55qE5aSa6KeG5Zu+44CCXHJcbiAqIOe8uueCue+8mlxyXG4gKiAx44CBbW9kdWxl5Y+q6IO95Yid5aeL5YyW5LiA5qyh77yM5ZCO6Z2i5Zug5Li657yT5a2Y5py65Yi277yM5LiN5Lya5YaN5qyh5Yid5aeL5YyW77yM5a+86Ie056ys5LqM5qyh5omT5byA5Y2V5o2u5Y+v6IO95Ye6546w6Zeu6aKYXHJcbiAqIDLjgIHlkIzkuIDkuKrnu4Tku7booqvlpJrkuKroj5zljZXnu4TlkIjkuI3mlK/mjIFcclxuICog5pys5qyh5L+u5pS55pa55qGI77yaXHJcbiAqIDHjgIHpgJrov4djdXJyZW50SW5mb3PvvIzlrZjlgqjnu4Tku7bliJvlu7rml7bnmoRndWlk5a+56LGh77yM5b2T5a+55bqU55qE5oyH5Luk5Yid5aeL5YyW5a6M5q+V77yM5Yig6Zmk6L+Z5Liq5a+56LGhXHJcbiAqIDLjgIHpgJrov4dCZWhhdmlvclN1YmplY3TvvIznu4Tku7bliJvlu7rml7bnmoRndWlk5a+56LGh5pe277yMbmV4dOWPmOmHj2N1cnJlbnRJbmZvc1xyXG4gKiAz44CB6YCa6L+Hc3RvcmVEaXJlY3RpdmVJbnN0YW5jZXPvvIzop6PlhrPnu4Tku7blkozmjIfku6TliJvlu7rpobrluo/lhYjlkI7nmoTpl67pophcclxuICogNOOAgemAmui/h3N0b3JlVmlld0NoYW5nZUNtcHPvvIzop6PlhrPlnKjmoIfnrb7pobXkuIvvvIzmjIfku6TliJ3lp4vljJbkuIDmrKHvvIzlpJrop4blm77nu4Tku7bkvJrooqvlpJrmrKHliJ3lp4vljJbvvIzmraTml7blj4zmlrnml6Dms5XljLnphY3nmoTpl67popggXHJcbiAqIOaUr+aMgeeahOWcuuaZr1xyXG4gKiAx44CB5ZCM5LiA5Liq57uE5Lu26KKr5aSa5Liq6I+c5Y2V57uE5ZCI77yM5Y+v5Lul5q2j5bi45pi+56S6XHJcbiAqIDLjgIHlkIzkuKrooajljZXlhoXvvIzlpJrkuKrlpJrop4blm77vvIzlj6ropoHnu4Tku7bjgIHmjIfku6TljLnphY3vvIzml6Dorrpncm91cGlk5piv5ZCm5LiA5qC377yM5Y+v5Lul5q2j5bi45pi+56S6XHJcbiAqIDPjgIHlkIzkuKrooajljZXlhoXvvIzlnKjmn5DkuKrlpJrop4blm77nmoTmjIfku6TlhoXlho3ltYzlpZflhbbku5blpJrop4blm77vvIzlj6/ku6XmraPluLjmmL7npLpcclxuICogNOOAgeagh+etvumhteS4iuS9v+eUqOaXtu+8jOWkmuS4quWkmuinhuWbvu+8jOWPr+S7peato+W4uOaYvuekulxyXG4gKi9cclxuQEluamVjdGFibGUoe1xyXG4gIHByb3ZpZGVkSW46ICdyb290J1xyXG59KVxyXG5leHBvcnQgY2xhc3MgVmlld0NoYW5nZVNlcnZpY2Uge1xyXG4gIC8qKlxyXG4gICAqIOavj+asoXZpZXctY2hhbmdl57uE5Lu25Yib5bu65a6M5Lya5Yib5bu6Y3VycmVudOWvueixoe+8jOeEtuWQjuaUvuWIsOatpOWkhOS/neWtmOOAglxyXG4gICAqIOW9k+WvueW6lOeahOaMh+S7pOmDveWIneWni+WMluWQju+8jOW8gOWni+mUgOavgVxyXG4gICAqL1xyXG4gIHByaXZhdGUgY3VycmVudEluZm9zOiBBcnJheTxTdG9yZUN1cnJlbnRJbmZvPiA9IFtdO1xyXG4gIHByaXZhdGUgY3VycmVudDogU3RvcmVDdXJyZW50SW5mbyA9IHtcclxuICAgIGd1aWQ6ICcnLFxyXG4gICAgZ3JvdXBJZDogJycsXHJcbiAgICBjb3VudDogMFxyXG4gIH07XHJcbiAgcHJpdmF0ZSBzdG9yZURpcmVjdGl2ZUluc3RhbmNlczogQXJyYXk8U3RvcmVDdXJyZW50RGlyZWN0aXZlSW5zPiA9IFtdO1xyXG4gIHByaXZhdGUgY3VycmVudERpcmVjdGl2ZUluc3RhbmNlID0gW107XHJcbiAgcHJpdmF0ZSBndWlkQ2hhbmdlU3ViamVjdCA9IG5ldyBCZWhhdmlvclN1YmplY3Q8QXJyYXk8U3RvcmVDdXJyZW50SW5mbz4+KFt7XHJcbiAgICBndWlkOiAnJyxcclxuICAgIGdyb3VwSWQ6ICcnLFxyXG4gICAgY291bnQ6IDBcclxuICB9XSk7XHJcbiAgcHJpdmF0ZSBzdG9yZVZpZXdDaGFuZ2VTZXI6IFN0b3JlVmlld1NlcnZpY2UgPSB7fTtcclxuICAvKipcclxuICAgKiDop6PlhrPmoIfnrb7pobXkuIrmnInnu4Tku7blkozmjIfku6RcclxuICAgKiDlvZPnu4Tku7bplIDmr4Hml7bvvIzmjIfku6Tov5jlrZjlnKjvvIzov5nmoLfmoLnmja7ljp/mnaXnmoTpgLvovpHmib7kuI3liLDnu4Tku7bkuI7mjIfku6TnmoTlr7nlupTlhbPns7tcclxuICAgKi9cclxuICBwcml2YXRlIHN0b3JlVmlld0NoYW5nZUNtcHM6QXJyYXk8U3RvcmVWaWV3Q2hhbmdlQ21wPj1bXTtcclxuXHJcbiAgY29uc3RydWN0b3IoKSB7fVxyXG4gIC8qKlxyXG4gICAqIOiOt+WPluW9k+WJjeaooeWdl+S/oeaBr1xyXG4gICAqIEBwYXJhbSBpZCBcclxuICAgKi9cclxuICBnZXRNb2R1bGVJbmZvKGlkID0gJycpIHtcclxuICAgIGlkID0gaWQgPyBpZCA6IHRoaXMuY3VycmVudC5ndWlkO1xyXG4gICAgcmV0dXJuIHRoaXMuc3RvcmVWaWV3Q2hhbmdlU2VyW2lkXTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5Yig6Zmk5a+55bqU55qE5qih5Z2X5L+h5oGvXHJcbiAgICogQHBhcmFtIGlkIFxyXG4gICAqL1xyXG4gIHJlbW92ZU1vZHVsZUluZm8oZ3VpZCkge1xyXG4gICAgaWYgKGd1aWQgJiYgdGhpcy5zdG9yZVZpZXdDaGFuZ2VTZXIuaGFzT3duUHJvcGVydHkoZ3VpZCkpIHtcclxuICAgICAgdGhpcy5zdG9yZVZpZXdDaGFuZ2VTZXJbZ3VpZF0gPSBudWxsO1xyXG4gICAgICBkZWxldGUgdGhpcy5zdG9yZVZpZXdDaGFuZ2VTZXJbZ3VpZF07ICAgICAgXHJcbiAgICAgIGxldCBmaW5kQ21wSW5kZXg9dGhpcy5zdG9yZVZpZXdDaGFuZ2VDbXBzLmZpbmRJbmRleChpdGVtID0+IGl0ZW0uZ3VpZCA9PSBndWlkKTtcclxuICAgICAgdGhpcy5zdG9yZVZpZXdDaGFuZ2VDbXBzLnNwbGljZShmaW5kQ21wSW5kZXgsIDEpOyAgXHJcbiAgICB9XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOiiq+eUqOS6juaMh+S7pOe7keWumlxyXG4gICAqIEByZXR1cm5zIFxyXG4gICAqL1xyXG4gIGdldE1vZHVsZUNoYW5nZSgpIHtcclxuICAgIHJldHVybiB0aGlzLmd1aWRDaGFuZ2VTdWJqZWN0O1xyXG4gIH1cclxuICAvKipcclxuICAgKiDliJvlu7rlrp7kvotcclxuICAgKi9cclxuICBjcmVhdGVWaWV3Q2hhbmdlQ21wKG1vZHVsZUNvdW50LHZpZXdDaGFuZ2VDbXBFbDpIVE1MRWxlbWVudCkge1xyXG4gICAgLy8g5q+U5aaC5Zy65pmv5qCH562+6aG15LiK5pyJ6KeG5Zu+57uE5Lu277yM5L2G5piv5qCH562+6aG15YaF5a655Yy65Z+f5pyJ5oyH5Luk77yM6KeG5Zu+57uE5Lu25Lya5Yid5aeL5YyW5aSa5qyhXHJcbiAgICAgbGV0IGV4aXN0c0d1aWQ9dGhpcy5nZXRHdWlkRnJvbVN0b3JlVmlld0NoYW5nZUNtcChtb2R1bGVDb3VudFtcImdyb3VwSWRcIl0sdmlld0NoYW5nZUNtcEVsKTtcclxuICAgICBpZihleGlzdHNHdWlkKXtcclxuICAgICAgcmV0dXJuIGV4aXN0c0d1aWRcclxuICAgICB9XHJcbiAgICAvLyDlrZjlnKjlvZPliY3mqKHlnotJRFxyXG4gICAgdGhpcy5jdXJyZW50ID0gT2JqZWN0LmFzc2lnbih7XHJcbiAgICAgIGd1aWQ6IHRoaXMuY3JlYXRlR3VpZCgpLFxyXG4gICAgfSwgbW9kdWxlQ291bnQpO1xyXG4gICAgLy8g5Yib5bu65a+56LGhXHJcbiAgICBpZiAoIXRoaXMuc3RvcmVWaWV3Q2hhbmdlU2VyLmhhc093blByb3BlcnR5KHRoaXMuY3VycmVudC5ndWlkKSkge1xyXG4gICAgICB0aGlzLnN0b3JlVmlld0NoYW5nZVNlclt0aGlzLmN1cnJlbnQuZ3VpZF0gPSBuZXcgVmlld0NoYW5nZU1hbmFnZVNlcnZpY2UoKTtcclxuICAgIH1cclxuICAgIGxldCB0Q3VycmVudD1PYmplY3QuYXNzaWduKHt9LHRoaXMuY3VycmVudCk7ICAgIFxyXG4gICAgLy8g5L+d5a2Y5b2T5YmN5a+55bqU5L+h5oGvXHJcbiAgICB0aGlzLmN1cnJlbnRJbmZvcy5wdXNoKHRDdXJyZW50KTtcclxuICAgIC8vIOWtmOWCqOi1t+adpVxyXG4gICAgdGhpcy5zdG9yZVZpZXdDaGFuZ2VDbXBzLnB1c2goT2JqZWN0LmFzc2lnbih7Y21wSWQ6dmlld0NoYW5nZUNtcEVsLmlkLGNtcEVsOnZpZXdDaGFuZ2VDbXBFbCxwYXJlbnRFbDpudWxsfSx0aGlzLmN1cnJlbnQpKTtcclxuICAgIGlmICh0aGlzLmN1cnJlbnREaXJlY3RpdmVJbnN0YW5jZS5sZW5ndGggPiAwKSB7XHJcbiAgICAgIC8vIOW9k+WJjeaMh+S7pOWunuS+i+WtmOWCqOWMuuacieWAvFxyXG4gICAgICBsZXQgY3VySW5zR3JvdXBJZCA9IHRoaXMuY3VycmVudERpcmVjdGl2ZUluc3RhbmNlWzBdWydmVmlld0dyb3VwSWQnXTtcclxuICAgICAgaWYgKHRoaXMuY3VycmVudC5ncm91cElkID09IGN1ckluc0dyb3VwSWQpIHtcclxuICAgICAgICAvLyDlsZ7kuo7lkIzkuIDkuKrliIbnu4RcclxuICAgICAgICB0aGlzLmRvRGlyZWN0aXZlSW5zdGFuY2VJbml0KHRoaXMuY3VycmVudERpcmVjdGl2ZUluc3RhbmNlLCB0aGlzLmN1cnJlbnQuZ3VpZCk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgLy8g5qOA5p+l5LmL5YmN5a2Y5YKo5piv5ZCm5pyJ5YC8ICBcclxuICAgICAgICB0aGlzLnN0b3JlRGlyZWN0aXZlSW5zdGFuY2VzLnB1c2goeyBncm91cElkOiBjdXJJbnNHcm91cElkLCBpbnN0YW5jZXM6IFtdLmNvbmNhdCh0aGlzLmN1cnJlbnREaXJlY3RpdmVJbnN0YW5jZSkgfSk7XHJcbiAgICAgICAgdGhpcy5jdXJyZW50RGlyZWN0aXZlSW5zdGFuY2UgPSBbXTtcclxuICAgICAgICB0aGlzLmZpbmRJbnN0b3JlRGlyZWN0aXZlSW5zdGFuY2VzKCk7XHJcbiAgICAgIH1cclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMuZmluZEluc3RvcmVEaXJlY3RpdmVJbnN0YW5jZXMoKTtcclxuICAgIH0gICAgXHJcbiAgICB0aGlzLmd1aWRDaGFuZ2VTdWJqZWN0Lm5leHQodGhpcy5jdXJyZW50SW5mb3MpOyAgICBcclxuICAgIHJldHVybiB0Q3VycmVudC5ndWlkO1xyXG4gIH1cclxuICAvKipcclxuICAgKiBcclxuICAgKi9cclxuICBwcml2YXRlIGZpbmRJbnN0b3JlRGlyZWN0aXZlSW5zdGFuY2VzKCkge1xyXG4gICAgLy/mn6Xmib4g5bey5pyJ55qE5a6e5L6L6YeM6Z2i5piv5ZCm5pyJ5a+55bqU55qEZ3JvdXBkSWRcclxuICAgIGxldCBmaW5kR3JvdXBJZEluZGV4ID0gdGhpcy5zdG9yZURpcmVjdGl2ZUluc3RhbmNlcy5maW5kSW5kZXgoaXRlbSA9PiBpdGVtWydncm91cElkJ10gPT0gdGhpcy5jdXJyZW50Lmdyb3VwSWQpO1xyXG4gICAgaWYgKGZpbmRHcm91cElkSW5kZXggPiAtMSkge1xyXG4gICAgICB0aGlzLmRvRGlyZWN0aXZlSW5zdGFuY2VJbml0KHRoaXMuc3RvcmVEaXJlY3RpdmVJbnN0YW5jZXNbZmluZEdyb3VwSWRJbmRleF1bJ2luc3RhbmNlcyddLCB0aGlzLmN1cnJlbnQuZ3VpZCk7XHJcbiAgICB9XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOaJp+ihjOaMh+S7pOWunuS+i+eahOWIneWni+WMllxyXG4gICAqL1xyXG4gIHByaXZhdGUgZG9EaXJlY3RpdmVJbnN0YW5jZUluaXQoaW5zdGFuY2VzLCBndWlkKSB7XHJcbiAgICBsZXQgbWF4TGVuID0gaW5zdGFuY2VzLmxlbmd0aDtcclxuICAgIGZvciAodmFyIGsgPSAwOyBrIDwgbWF4TGVuOyBrKyspIHtcclxuICAgICAgaWYgKCFpbnN0YW5jZXMgfHwgaW5zdGFuY2VzLmxlbmd0aCAhPSBtYXhMZW4pIHtcclxuICAgICAgICBicmVhaztcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBpbnN0YW5jZXNba11bXCJ2aWV3Q2hhbmdlT25Jbml0XCJdKGd1aWQpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICBpZiAoaW5zdGFuY2VzICYmIGluc3RhbmNlcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgIGlmIChpbnN0YW5jZXMubGVuZ3RoICE9IG1heExlbikge1xyXG4gICAgICAgIC8vIOWcqOWklumdouiiq+WIoOmZpFxyXG4gICAgICAgIHRoaXMuZG9EaXJlY3RpdmVJbnN0YW5jZUluaXQoaW5zdGFuY2VzLCBndWlkKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuICAvKipcclxuICAgKiDlrZjlgqjmjIfku6Tlrp7kvotcclxuICAgKiBAcGFyYW0gdEluc3RhbmNlIFxyXG4gICAqL1xyXG4gIHN0b3JlVmlld0NoYW5nZURpcmVjdGl2ZUluc3RhbmNlKHRJbnN0YW5jZSkge1xyXG4gICAgaWYgKCF0aGlzLmN1cnJlbnQuZ3JvdXBJZCB8fCB0aGlzLmN1cnJlbnQuZ3JvdXBJZCA9PSB0SW5zdGFuY2VbJ2ZWaWV3R3JvdXBJZCddKSB7XHJcbiAgICAgIC8vIOS4juW9k+WJjeWMuemFjVxyXG4gICAgICB0aGlzLmN1cnJlbnREaXJlY3RpdmVJbnN0YW5jZS5wdXNoKHRJbnN0YW5jZSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAvLyDkuI7lvZPliY3kuI3ljLnphY1cclxuICAgICAgbGV0IGZpbmRHcm91cEluZm8gPSB0aGlzLnN0b3JlRGlyZWN0aXZlSW5zdGFuY2VzLmZpbmQoKGl0ZW0pID0+IGl0ZW1bJ2dyb3VwSWQnXSA9PSB0SW5zdGFuY2VbJ2ZWaWV3R3JvdXBJZCddKTtcclxuICAgICAgaWYgKGZpbmRHcm91cEluZm8pIHtcclxuICAgICAgICBmaW5kR3JvdXBJbmZvLmluc3RhbmNlcy5wdXNoKHRJbnN0YW5jZSk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgdGhpcy5zdG9yZURpcmVjdGl2ZUluc3RhbmNlcy5wdXNoKHsgZ3JvdXBJZDogdEluc3RhbmNlWydmVmlld0dyb3VwSWQnXSwgaW5zdGFuY2VzOiBbdEluc3RhbmNlXSB9KVxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOenu+mZpOaMh+S7pOWunuS+i1xyXG4gICAqIEBwYXJhbSB0SW5zdGFuY2UgXHJcbiAgICovXHJcbiAgcmVtb3ZlVmlld0NoYW5nZURpcmVjdGl2ZUluc3RhbmNlKHZpZXdJdGVtVHlwZTogc3RyaW5nLCBndWlkOiBzdHJpbmcpIHtcclxuICAgIGlmIChndWlkID09IHRoaXMuY3VycmVudC5ndWlkKSB7XHJcbiAgICAgIGlmICh0aGlzLmN1cnJlbnREaXJlY3RpdmVJbnN0YW5jZS5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgbGV0IHRmaW5kSW5kZXggPSB0aGlzLmN1cnJlbnREaXJlY3RpdmVJbnN0YW5jZS5maW5kSW5kZXgoKGl0ZW0pID0+IGl0ZW1bJ3ZpZXdJdGVtVHlwZSddID09IHZpZXdJdGVtVHlwZSk7XHJcbiAgICAgICAgaWYgKHRmaW5kSW5kZXggPiAtMSkge1xyXG4gICAgICAgICAgdGhpcy5jdXJyZW50RGlyZWN0aXZlSW5zdGFuY2Uuc3BsaWNlKHRmaW5kSW5kZXgsIDEpO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgbGV0IGZpbmRNb2R1bGVJbmRleCA9IHRoaXMuY3VycmVudEluZm9zLmZpbmRJbmRleChpdGVtID0+IGl0ZW0uZ3VpZCA9PSBndWlkKTtcclxuICAgIGlmIChmaW5kTW9kdWxlSW5kZXggPiAtMSkge1xyXG4gICAgICBsZXQgZmluZE1vZHVsZUluZm8gPSB0aGlzLmN1cnJlbnRJbmZvc1tmaW5kTW9kdWxlSW5kZXhdO1xyXG4gICAgICBmaW5kTW9kdWxlSW5mb1snY291bnQnXSA9IGZpbmRNb2R1bGVJbmZvWydjb3VudCddIC0gMTtcclxuICAgICAgaWYgKGZpbmRNb2R1bGVJbmZvWydjb3VudCddIDw9IDApIHtcclxuICAgICAgICB0aGlzLmN1cnJlbnRJbmZvcy5zcGxpY2UoZmluZE1vZHVsZUluZGV4LCAxKTtcclxuICAgICAgICBsZXQgZmluZEdyb3VwSW5kZXggPSB0aGlzLnN0b3JlRGlyZWN0aXZlSW5zdGFuY2VzLmZpbmRJbmRleCgoaXRlbSkgPT4gaXRlbVsnZ3JvdXBJZCddID09IGZpbmRNb2R1bGVJbmZvW1wiZ3JvdXBJZFwiXSk7XHJcbiAgICAgICAgdGhpcy5zdG9yZURpcmVjdGl2ZUluc3RhbmNlcy5zcGxpY2UoZmluZEdyb3VwSW5kZXgsIDEpOyAgICAgIFxyXG4gICAgICAgIGlmKHRoaXMuY3VycmVudC5ndWlkPT1ndWlkKXtcclxuICAgICAgICAgIC8vIOmHjee9ruW9k+WJjVxyXG4gICAgICAgICAgdGhpcy5jdXJyZW50PXtndWlkOiAnJyxcclxuICAgICAgICAgICAgZ3JvdXBJZDogJycsXHJcbiAgICAgICAgICAgIGNvdW50OiAwXHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG4gIHByaXZhdGUgY3JlYXRlR3VpZCgpe1xyXG4gICAgY29uc3QgUzQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgIHJldHVybiAoKCgxICsgTWF0aC5yYW5kb20oKSkgKiAweDEwMDAwKSB8IDApLnRvU3RyaW5nKDE2KS5zdWJzdHJpbmcoMSk7XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIFM0KCkgKyBTNCgpICsgXCItXCIgKyBTNCgpICsgXCItXCIgKyBTNCgpICsgXCItXCIgKyBTNCgpICsgXCItXCIgKyBTNCgpICsgUzQoKSArIFM0KCk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOabtOaWsOWkmuinhuWbvue7hOS7tlxyXG4gICAqIEBwYXJhbSBndWlkIFxyXG4gICAqIEBwYXJhbSBncm91cElkIFxyXG4gICAqIEBwYXJhbSB2aWV3Q2hhbmdlRGlyZWN0aXZlRWwgXHJcbiAgICovXHJcbiAgdXBkYXRlZFN0b3JlVmlld0NoYW5nZUNtcChndWlkOnN0cmluZyxncm91cElkOnN0cmluZyx2aWV3Q2hhbmdlRGlyZWN0aXZlRWw6SFRNTEVsZW1lbnQpe1xyXG4gICAgICBsZXQgZmluZFN0b3JlVmlld0NoYW5nZUNtcD10aGlzLnN0b3JlVmlld0NoYW5nZUNtcHMuZmluZChpdGVtPT4haXRlbVtcInBhcmVudEVsXCJdJiZpdGVtWydndWlkJ109PWd1aWQpO1xyXG4gICAgICBpZihmaW5kU3RvcmVWaWV3Q2hhbmdlQ21wKXtcclxuICAgICAgICAvLyDmsqHmnInotYvlgLznmoTlhYPntKBcclxuICAgICAgICBsZXQgZmluZFBhcmVudD0gdGhpcy5maW5kQ29tbW9uUGFyZW50KHZpZXdDaGFuZ2VEaXJlY3RpdmVFbCxmaW5kU3RvcmVWaWV3Q2hhbmdlQ21wLmNtcEVsKTtcclxuICAgICAgICBmaW5kU3RvcmVWaWV3Q2hhbmdlQ21wW1wicGFyZW50RWxcIl09ZmluZFBhcmVudDtcclxuICAgICAgICBmaW5kU3RvcmVWaWV3Q2hhbmdlQ21wW1wiY21wRWxcIl09bnVsbDtcclxuICAgICAgfSAgIFxyXG4gIH1cclxuICAvKipcclxuICAgKiDmib7kuKTkuKrlhYPntKDnmoTlhazlhbHniLblhYPntKBcclxuICAgKiBAcGFyYW0gZWxlbWVudDEgXHJcbiAgICogQHBhcmFtIGVsZW1lbnQyIFxyXG4gICAqIEByZXR1cm5zIFxyXG4gICAqL1xyXG4gIHByaXZhdGUgZmluZENvbW1vblBhcmVudChlbGVtZW50MSwgZWxlbWVudDIpIHtcclxuICAgIHZhciBwYXJlbnQxID0gZWxlbWVudDE7XHJcbiAgICBcclxuICAgIHdoaWxlIChwYXJlbnQxICE9PSBudWxsKSB7XHJcbiAgICAgIGlmIChwYXJlbnQxLmNvbnRhaW5zKGVsZW1lbnQyKSkge1xyXG4gICAgICAgIHJldHVybiBwYXJlbnQxO1xyXG4gICAgICB9XHJcbiAgICAgIHBhcmVudDEgPSBwYXJlbnQxLnBhcmVudEVsZW1lbnQ7XHJcbiAgICB9ICAgIFxyXG4gICAgcmV0dXJuIG51bGw7IC8vIOWmguaenOayoeacieWFseWQjOeItuWFg+e0oO+8jOWImei/lOWbniBudWxsXHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGdldEd1aWRGcm9tU3RvcmVWaWV3Q2hhbmdlQ21wKGdyb3VwSWQsY21wRWwpe1xyXG4gICAgbGV0IGZpbmRDbXA9dGhpcy5zdG9yZVZpZXdDaGFuZ2VDbXBzLmZpbmQoaXRlbT0+e1xyXG4gICAgICBpZihpdGVtW1wiZ3JvdXBJZFwiXT09Z3JvdXBJZCYmaXRlbVtcImNtcElkXCJdPT1jbXBFbC5pZCl7XHJcbiAgICAgICAgICByZXR1cm4gaXRlbVtcInBhcmVudEVsXCJdP2l0ZW1bXCJwYXJlbnRFbFwiXS5jb250YWlucyhjbXBFbCk6ZmFsc2U7XHJcbiAgICAgIH0gXHJcbiAgICB9KTtcclxuICAgIHJldHVybiBmaW5kQ21wP2ZpbmRDbXBbXCJndWlkXCJdOlwiXCJcclxuICB9XHJcbn1cclxuIl19
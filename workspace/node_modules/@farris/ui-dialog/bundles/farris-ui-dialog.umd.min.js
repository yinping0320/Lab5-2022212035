!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("rxjs"),require("rxjs/operators"),require("@angular/common"),require("@angular/core"),require("@farris/ui-perfect-scrollbar"),require("@farris/ui-draggable"),require("@farris/ui-modal")):"function"==typeof define&&define.amd?define("@farris/ui-dialog",["exports","rxjs","rxjs/operators","@angular/common","@angular/core","@farris/ui-perfect-scrollbar","@farris/ui-draggable","@farris/ui-modal"],e):e((t.farris=t.farris||{},t.farris["ui-dialog"]={}),t.rxjs,t.rxjs.operators,t.ng.common,t.ng.core,t.uiPerfectScrollbar,t.uiDraggable,t.uiModal)}(this,function(t,n,e,i,o,s,h,r){"use strict";var a=(l.prototype.hasDialogOpened=function(t){var i=0,e="farris-dialog,.overlay-pane";t&&(e+=","+t);var n=window.document.querySelectorAll(e);return Array.from(n).filter(function(t){return!Array.from(n[0].classList).some(function(t){return"f-combo-list"==t})}).forEach(function(t){var e="";""!==(e="DIV"===t.tagName?window.getComputedStyle(t).display:window.getComputedStyle(t.querySelector("div")).display)&&"block"!==e||i++}),0<i},l.decorators=[{type:o.Injectable}],l);function l(){}var d=function(){return(d=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var o in e=arguments[i])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},g=(Object.defineProperty(p.prototype,"size",{get:function(){var t=this.getDialogHeaderLineHeight(),e=this.getDialogFooterHeight(),i=this.height-t;return this.showButtons&&(i-=e),{width:this.width,height:this.height,contentHeight:i,contentWidth:this.width,header:t,footer:e}},enumerable:!0,configurable:!0}),p.prototype.ngOnInit=function(){var t=this;this.hostId="farris-dialog_"+(new Date).getTime(),this.render2.setProperty(this.el.nativeElement,"id",this.hostId),this.beforeOpen||(this.beforeOpen=function(){return!0}),this.beforeClose||(this.beforeClose=function(){return!0}),this.modal.onShown.subscribe(function(){t.opened.emit()}),this.modal.onHidden.subscribe(function(){return t.closed.emit()}),this.checkDialogSize(),setTimeout(function(){t.parentElement?t.parentElement.appendChild(t.el.nativeElement):document.body.appendChild(t.el.nativeElement),t.showHeader&&t.modalHeader&&(t.dragHandle=t.modalHeader.nativeElement)},100)},p.prototype.ngOnChanges=function(t){},p.prototype.ngOnDestroy=function(){var t=this;setTimeout(function(){t.destroy(),t.el=null,t.parentElement&&(t.parentElement=null),t._mutationObserver&&(t._mutationObserver.disconnect(),t._mutationObserver=null)},150)},p.prototype.getScreenSize=function(){var t=this.maxPadding?20:0;return{width:window.innerWidth-t,height:window.innerHeight-t,padding:t?10:0}},p.prototype.ngAfterViewInit=function(){var o=this;if(this.dialogEl?this._dialogEl=this.dialogEl.nativeElement:this._dialogEl=this.el.nativeElement.querySelector(".modal-dialog"),this.dlgHeaderLineHeight=this.getDialogHeaderLineHeight(),this.dialogHeaderHeight&&this.modalHeader&&(this.modalHeader.nativeElement.style.height=this.dialogHeaderHeight+"px"),this.dialogFooterHeight){var t=this.modalContent.nativeElement.querySelector(".modal-footer");t&&(t.style.height=this.dialogFooterHeight+"px")}this.originalHeight=this.height,this.originalWidth=this.width,this.resetPosition(),this.windowResize$=n.fromEvent(window,"resize").pipe(e.debounceTime(50)).subscribe(function(t){var e=o.getScreenSize(),i=e.width,n=e.height;o.width<=i&&o.height<=n?o._windowResizeToMax?(o.revertDialog(),o._windowResizeToMax=!1):o.isMax&&o.maxDialog(!1):o.isMax?o.maxDialog(!1):(o._windowResizeToMax=!0,o.maxDialog()),o.toCenter(0,0)})},p.prototype.toCenter=function(t,e){this.resetPosition(),this.draggbar.position={x:t,y:e},this.draggbar.resetPosition()},p.prototype.destroy=function(){this.parentElement?this.parentElement.querySelector("#"+this.hostId)&&this.parentElement.removeChild(this.el.nativeElement):document.body.querySelector("#"+this.hostId)&&document.body.removeChild(this.el.nativeElement),this.windowResize$&&(this.windowResize$.unsubscribe(),this.windowResize$=null)},p.prototype.getDialogHeaderLineHeight=function(){if(this.modalHeader){this.dlgHeaderLineHeight||(this.dlgHeaderLineHeight=0);var t=Math.ceil(this.modalHeader.nativeElement.getBoundingClientRect().height);return this.dlgHeaderLineHeight=t,this.dlgHeaderLineHeight}return 0},p.prototype.getDialogFooterHeight=function(){if(!this.footerEl){var t=this.modalContent.nativeElement.querySelector(".modal-footer");this.footerEl=t}if(this.dlgFooterLineHeight||(this.dlgFooterLineHeight=0),this.footerEl){this.footerEl.style.height="auto";var e=Math.ceil(this.footerEl.getBoundingClientRect().height);this.dlgFooterLineHeight=e}return this.dlgFooterLineHeight},p.prototype._checkDialogSize=function(t,e){var i={width:document.body.offsetWidth,height:window.innerHeight};return this.parentElement&&(i.width=this.parentElement.offsetWidth,i.height=this.parentElement.offsetHeight),i.width&&i.width<t&&(t=i.width),i.height&&i.height<e&&(e=i.height),{width:t,height:e}},p.prototype.checkDialogSize=function(){var t=this._checkDialogSize(this.width,this.height);this.width!==t.width&&(this.width=t.width-20,this.widthChange.emit(this.width)),this.height!==t.height&&(this.height=t.height-20,this.heightChange.emit(this.height))},p.prototype.updateModalBodyHeight=function(){var t=this.el.nativeElement.querySelector(".modal-body"),e=this.size.contentHeight;this.render2.setStyle(t,"height",e+"px")},p.prototype.updatePosition=function(){var t=Number.parseInt(""+-this.width/2),e=Number.parseInt(""+-this.height/2);this.postitionStyles={marginLeft:t+"px",marginTop:e+"px",transform:"translate3d(0px, 0px, 0px)",top:window.innerHeight/2+e+"px",left:window.innerWidth/2+t+"px",top1:this.isMax?"10px":"50%",left1:this.isMax?"10px":"50%"}},p.prototype.resetPosition=function(){if(this.updatePosition(),this._dialogEl){var t=this._dialogEl;this.render2.setStyle(t,"top",this.postitionStyles.top),this.render2.setStyle(t,"left",this.postitionStyles.left),this.render2.setStyle(t,"transform",this.postitionStyles.transform)}},p.prototype.openDialog=function(t){t&&(this.resetPosition(),this.draggbar.resetPosition(),this.modal.show())},p.prototype.closeDialog=function(t){t&&this.modal.hide()},p.prototype.show=function(){var e=this,t=this.beforeOpen();"boolean"==typeof t?this.openDialog(t):t instanceof n.Observable?t.subscribe(function(t){e.openDialog(t)}):t instanceof Promise&&t.then(function(t){e.openDialog(t)})},p.prototype.close=function(t){var e=this;t&&t.stopPropagation();var i=this.beforeClose();"boolean"==typeof i?this.closeDialog(i):i instanceof n.Observable?i.subscribe(function(t){e.closeDialog(t)}):i instanceof Promise&&i.then(function(t){e.closeDialog(t)})},p.prototype.reSize=function(t){t.width&&(this.width=t.width),t.height&&(this.height=t.height),this.resetPosition(),this.draggbar.resetPosition(),this.widthChange.emit(this.width),this.heightChange.emit(this.height),this.resized.emit({size:{width:this.width,height:this.height}})},p.prototype.onResizing=function(t){t.size.width=t.size.width<100?100:t.size.width,t.size.height=t.size.height<100?100:t.size.height,this.width=t.size.width,this.height=t.size.height,this.resizing.emit(t)},p.prototype.resizeStop=function(t){t.size.width=t.size.width<100?100:t.size.width,t.size.height=t.size.height<100?100:t.size.height,this.width=t.size.width,this.height=t.size.height,this.updateModalBodyHeight(),this.widthChange.emit(this.width),this.heightChange.emit(this.height),this.resized.emit(t)},p.prototype.dropdown=function(t){},p.prototype.maxDialog=function(t){if(void 0===t&&(t=!0),this.el){t&&(this.prevWidth=this.width,this.prevHeight=this.height);var e=this.getScreenSize(),i=e.width,n=e.height,o=e.padding;this.width=i,this.height=n,this.draggable=!1,this.resizable=!1,this.isMax=!0,this.toCenter(0,0);var s=this.el.nativeElement.querySelector(".modal-dialog");this.render2.setStyle(s,"top",o),this.render2.setStyle(s,"left",o),this.resized.emit({size:{width:this.width,height:this.height}}),this.maxed.emit({size:{width:this.width,height:this.height}})}},p.prototype.revertDialog=function(){this.isMax=!1;var t=this.getScreenSize(),e=t.width,i=t.height;this.width=this.prevWidth==e?this.originalWidth:this.prevWidth,this.height=this.prevHeight==i?this.originalHeight:this.prevHeight,this.width>e&&(this.width=e),this.height>i&&(this.height=i),this.draggable=!0,this.resizable=!0,this.resetPosition(),this.draggbar.resetPosition(),this.resized.emit({size:{width:this.width,height:this.height}}),this.maxed.emit({size:{width:this.width,height:this.height}})},p.prototype.changeDialogSize=function(){this.isMax?this.revertDialog():this.maxDialog(),this._windowResizeToMax=!1},p.prototype.onMoving=function(t){this.moving.emit(d({target:this.dialogEl.nativeElement},t))},p.decorators=[{type:o.Component,args:[{selector:"farris-dialog",template:'<div #backdropEl class="modal farris-modal fade" bsModal #staticModal="bs-modal" [config]="{backdrop: \'static\'}"\r\n    tabindex="-1" role="dialog" aria-labelledby="dialog-static-name">\r\n    <div [ngDraggable]="draggable" [ngResizable]="resizable" rzHandles="all" [handle]="dragHandle"\r\n        (rzStop)="resizeStop($event)" (rzResizing)="onResizing($event)" (stopped)="dropdown($event)" (movingOffset)="onMoving($event)"\r\n        [rzMinWidth]="minWidth" [rzMaxWidth]="maxWidth" [rzMinHeight]="minHeight" [rzMaxHeight]="maxHeight"\r\n        [inBounds]="true" [bounds]="backdropEl" [rzContainment]="backdropEl" class="modal-dialog m-0" [style.width.px]="width"\r\n        [style.height]="height + \'px\'" #dialogEl style="margin-left: 0!important; margin-top: 0!important">\r\n        <div #modalContent class="modal-content" style="overflow: hidden;">\r\n            <div #header class="modal-header" *ngIf="showHeader">\r\n                <div class="modal-title">\r\n                    <span *ngIf="iconCls" [class]="iconCls"></span>\r\n                    <span class="modal-title-label">{{ title }}</span>\r\n                </div>\r\n                <div class="actions">\r\n\r\n                    <ul>\r\n                        <li *ngIf="toolTemplate">\r\n                            <ng-template [ngTemplateOutlet]="toolTemplate">\r\n\r\n                            </ng-template>\r\n                        </li>\r\n                        <li *ngIf="showMinButton" class="f-btn-icon f-bare"><span class="f-icon modal_minimize"></span>\r\n                        </li>\r\n                        <li *ngIf="showMaxButton" (click)="changeDialogSize()" class="f-btn-icon f-bare"><span\r\n                                class="f-icon modal_maximize" [class.modalrevert]="isMax"></span></li>\r\n                        <li *ngIf="showCloseButton" (click)="close($event)" class="f-btn-icon f-bare"><span\r\n                                class="f-icon modal_close"></span></li>\r\n                    </ul>\r\n                </div>\r\n            </div>\r\n            <div class="modal-body" [style.height.px]="size?.contentHeight" style=" cursor:default;">\r\n                <perfect-scrollbar [disabled]="!enableScroll" [config]="scrollConfig">\r\n                    <ng-content></ng-content>\r\n                </perfect-scrollbar>\r\n            </div>\r\n            <div class="modal-footer" *ngIf="showButtons" [style.textAlign]="buttonAlign" style=" cursor:default;">\r\n                <ng-container [ngTemplateOutlet]="buttons"></ng-container>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>',styles:[""]}]}],p.ctorParameters=function(){return[{type:o.Renderer2},{type:o.ElementRef}]},p.propDecorators={title:[{type:o.Input}],iconCls:[{type:o.Input}],width:[{type:o.Input}],height:[{type:o.Input}],minWidth:[{type:o.Input}],minHeight:[{type:o.Input}],maxWidth:[{type:o.Input}],maxHeight:[{type:o.Input}],showButtons:[{type:o.Input}],showCloseButton:[{type:o.Input}],showMaxButton:[{type:o.Input}],showMinButton:[{type:o.Input}],resizable:[{type:o.Input}],draggable:[{type:o.Input}],buttonAlign:[{type:o.Input}],scrollConfig:[{type:o.Input}],beforeOpen:[{type:o.Input}],beforeClose:[{type:o.Input}],modal:[{type:o.ViewChild,args:[r.ModalDirective]}],draggbar:[{type:o.ViewChild,args:[h.AngularDraggableDirective]}],opened:[{type:o.Output}],closed:[{type:o.Output}],resized:[{type:o.Output}],resizing:[{type:o.Output}],maxed:[{type:o.Output}],widthChange:[{type:o.Output}],heightChange:[{type:o.Output}],moving:[{type:o.Output}],enableScroll:[{type:o.Input}],buttons:[{type:o.Input}],dialogHeaderHeight:[{type:o.Input}],dialogFooterHeight:[{type:o.Input}],parentElement:[{type:o.Input}],showHeader:[{type:o.Input}],dragHandle:[{type:o.Input}],toolTemplate:[{type:o.ContentChild,args:["toolTemplate"]}],modalContent:[{type:o.ViewChild,args:["modalContent"]}],modalHeader:[{type:o.ViewChild,args:["header"]}],dialogEl:[{type:o.ViewChild,args:["dialogEl"]}],maxPadding:[{type:o.Input}]},p);function p(t,e){this.render2=t,this.el=e,this.title="我是标题",this.iconCls=undefined,this.width=300,this.height=200,this.minWidth=100,this.minHeight=100,this.maxWidth=null,this.maxHeight=null,this.showButtons=!0,this.showCloseButton=!0,this.showMaxButton=!0,this.showMinButton=!1,this.resizable=!0,this.draggable=!0,this.buttonAlign="center",this.scrollConfig={},this.opened=new o.EventEmitter,this.closed=new o.EventEmitter,this.resized=new o.EventEmitter,this.resizing=new o.EventEmitter,this.maxed=new o.EventEmitter,this.widthChange=new o.EventEmitter,this.heightChange=new o.EventEmitter,this.moving=new o.EventEmitter,this.enableScroll=!0,this.dialogHeaderHeight=0,this.dialogFooterHeight=0,this.parentElement=null,this.showHeader=!0,this.isMax=!1,this.hostId="",this.maxPadding=!0,this.windowResize$=null,this.postitionStyles={},this._windowResizeToMax=!1,this._mutationObserver=null,this._dialogEl=null,this.footerEl=null}var u=(c.forRoot=function(){return{ngModule:c,providers:[a]}},c.decorators=[{type:o.NgModule,args:[{declarations:[g],imports:[s.PerfectScrollbarModule,h.AngularDraggableModule,r.ModalModule,i.CommonModule],exports:[g,r.ModalModule]}]}],c);function c(){}t.DialogService=a,t.DialogComponent=g,t.FarrisDialogModule=u,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=farris-ui-dialog.umd.min.js.map
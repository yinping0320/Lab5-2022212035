/**
 * @fileoverview added by tsickle
 * Generated from: lib/page-sidebar.component.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input, EventEmitter, Output, Renderer2, ElementRef, ViewChild, HostBinding, HostListener } from '@angular/core';
import { DomSanitizer } from "@angular/platform-browser";
import { FPageModalDISMISS_REASONS, FEPageModalOptions } from './page-modal-options.class';
export class FEPageModalSidebarComponent {
    /**
     * @param {?} options
     * @param {?} el
     * @param {?} _renderer
     * @param {?} sanitizer
     */
    constructor(options, el, _renderer, sanitizer) {
        this.el = el;
        this._renderer = _renderer;
        this.sanitizer = sanitizer;
        this.isShown = false;
        this.closed = new EventEmitter();
        this.opened = new EventEmitter();
        this.resized = new EventEmitter();
        this.modalID = `MODALID_${Date.now().toPrecision()}`;
        this.iframeSrc = '';
        this._iframe = '';
        this.isModalHiding = false;
        this.canRemoveInitNoAnimateCls = true;
        this.sidebarCls = {
            'parent': 'f-sidebar-parent',
            'openParent': 'f-sidebar-parent-expand',
            'closeParent': 'f-sidebar-parent-collapse',
            'init': 'animated-none'
        };
        this.isOpen = false;
        this.config = Object.assign({}, options);
    }
    /**
     * @param {?} value
     * @return {?}
     */
    set iframe(value) {
        if (this.sanitizer) {
            this._iframe = value;
            this.iframeSrc = this.sanitizer.bypassSecurityTrustResourceUrl(value);
        }
    }
    /**
     * @return {?}
     */
    get iframe() {
        return this._iframe;
    }
    /**
     * @param {?} event
     * @return {?}
     */
    onClick(event) {
        /** @type {?} */
        const tag = (/** @type {?} */ (event.target));
        if (this.config.ignoreBackdropClick || this.config.backdrop === 'static' || event.target !== this.el.nativeElement) {
            event.stopPropagation();
            return;
        }
        this.bsModalService.setDismissReason(FPageModalDISMISS_REASONS.BACKRDOP);
        this.close();
    }
    /**
     * @param {?} event
     * @return {?}
     */
    onEsc(event) {
        if (!this.isShown) {
            return;
        }
        if (event.keyCode === 27) {
            event.preventDefault();
        }
        if (this.config.keyboard &&
            this.level === this.bsModalService.getModalsCount()) {
            this.bsModalService.setDismissReason(FPageModalDISMISS_REASONS.ESC);
            this.close(event);
        }
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.parentEl = this.el.nativeElement.parentElement;
        this._renderer.addClass(this.parentEl, this.sidebarCls.parent);
        this.removeNoneAnimateCls();
        setTimeout((/**
         * @return {?}
         */
        () => {
            this.isShown = true;
            this.isOpen = true;
            // this._renderer.addClass(
            //     this.el.nativeElement, FEPageModalCLASS_NAME.SHOW
            // );
            // Parent
            this._renderer.removeClass(this.parentEl, this.sidebarCls.closeParent);
            this._renderer.addClass(this.parentEl, this.sidebarCls.openParent);
            // this._renderer.setStyle(this.el.nativeElement, 'display', 'block');
            // if (this.config.fitContent && this.el.nativeElement.className.indexOf('f-modal-fitContent-scroll') > -1) {
            //   this.el.nativeElement.scrollTop = 0;
            // }
            // if (document && document.body) {
            //     const modalLen = this.bsModalService.getModalsCount();
            //     if (modalLen === 1) {
            //         this.bsModalService.checkScrollbar();
            //         this.bsModalService.setScrollbar();
            //     }
            //     if (!document.body.classList.contains(FEPageModalCLASS_NAME.OPEN)) {
            //         this._renderer.addClass(document.body, FEPageModalCLASS_NAME.OPEN);
            //     }
            // }
            this.opened.emit({ modal: this });
        }), 0);
        if (this.el.nativeElement) {
            this.el.nativeElement.focus();
        }
    }
    /**
     * @return {?}
     */
    ngAfterContentInit() {
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        if (this.isShown) {
            this.close();
        }
    }
    /**
     * @return {?}
     */
    hasIframe() {
        return this._iframe != '';
    }
    /**
     * @return {?}
     */
    closeSideBar() {
        // this.removeNoneAnimateCls();
        // if (this.beforeClose) {
        //     this.beforeClose().subscribe((isOpen: boolean) => {
        //         this.isOpen = !isOpen;
        //     })
        // } else {
        //     this.isOpen = false;
        // }
        this._renderer.removeClass(this.parentEl, this.sidebarCls.openParent);
        this._renderer.addClass(this.parentEl, this.sidebarCls.closeParent);
    }
    /**
     * @return {?}
     */
    openSideBar() {
        this.removeNoneAnimateCls();
        this.isOpen = true;
        this._renderer.removeClass(this.parentEl, this.sidebarCls.closeParent);
        this._renderer.addClass(this.parentEl, this.sidebarCls.openParent);
    }
    /*侧边栏初始因为动画收起时，会被看到, 移除 */
    /**
     * @private
     * @return {?}
     */
    removeNoneAnimateCls() {
        if (!this.canRemoveInitNoAnimateCls) {
            return;
        }
        if (this.sidebarMainEl) {
            this._renderer.removeClass(this.sidebarMainEl.nativeElement, this.sidebarCls.init);
            this.canRemoveInitNoAnimateCls = false;
        }
    }
    // 侧边栏宽度计算
    /**
     * @return {?}
     */
    getSidebarWidth() {
        if (typeof this.config['width'] == 'string') {
            return this.config['width'];
        }
        else {
            return this.config['width'] + 'px';
        }
    }
    // 必须带的方法
    /**
     * @param {?=} e
     * @param {?=} isCloseButton
     * @return {?}
     */
    close(e, isCloseButton = false) {
        if (e) {
            e.stopPropagation();
        }
        if (this.isModalHiding || !this.isShown) {
            return;
        }
        this.config.beforeClose(this).subscribe((/**
         * @param {?} r
         * @return {?}
         */
        r => {
            if (!r) {
                return false;
            }
            //动画结束执行其他操作
            this.sidebarMainEl.nativeElement.parentElement.addEventListener('transitionend', (/**
             * @param {?} e
             * @return {?}
             */
            (e) => {
                this.bsModalService.hide(this.level);
                this.isModalHiding = false;
                if (this.config.closed) {
                    this.config.closed(isCloseButton);
                }
                this.closed.emit(this.level);
            }), false);
            this.isModalHiding = true;
            this.isShown = false;
            this._renderer.removeClass(this.parentEl, this.sidebarCls.openParent);
            this._renderer.addClass(this.parentEl, this.sidebarCls.closeParent);
        }));
    }
    /**
     * @return {?}
     */
    toCenter() {
    }
}
FEPageModalSidebarComponent.decorators = [
    { type: Component, args: [{
                selector: 'fe-page-sidebar',
                template: "<div [attr.id]=\"modalID\" class=\"f-cmp-sidebar f-sidebar-slide fe-page-sidebar\" [class]=\"config.class+' '+'f-sidebar-pos-'+config.sidebar['showPos']\"\r\n  [ngClass]=\"{'f-sidebar-show': isShown||isOpen, 'f-sidebar-collapse': !isShown||!isOpen}\">\r\n  <div class=\"f-sidebar-main animated-none\" [ngClass]=\"{'f-sidebar-main--has-actions':config.showCloseButton}\" #sidebarMain [ngStyle]=\"{width:config.width}\"\r\n    [f-area-response]=\"!iframe&&config.areaResponse\">\r\n    <perfect-scrollbar [config]=\"{}\" [disabled]=\"!config.enableScroll||config.fitContent\" *ngIf=\"!iframe\">\r\n      <ng-content></ng-content>\r\n    </perfect-scrollbar>\r\n    <iframe *ngIf=\"iframe\" class=\"f-utils-fill\" width=\"100%\" frameborder=\"0\" [src]=\"iframeSrc\"></iframe>\r\n    <div class=\"f-sidebar--action-list\" *ngIf=\"config.showCloseButton\">\r\n      <div class=\"action-list--item\" (click)=\"close($event,true)\">\r\n        <span class=\"action-list--icon close-icon\">\r\n          <i class=\"f-icon f-icon-close\"></i>\r\n        </span>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</div>",
                host: {
                    class: 'fe-cmp-page-modal'
                }
            }] }
];
/** @nocollapse */
FEPageModalSidebarComponent.ctorParameters = () => [
    { type: FEPageModalOptions },
    { type: ElementRef },
    { type: Renderer2 },
    { type: DomSanitizer }
];
FEPageModalSidebarComponent.propDecorators = {
    closed: [{ type: Output }],
    opened: [{ type: Output }],
    resized: [{ type: Output }],
    modalID: [{ type: HostBinding, args: ['id',] }],
    iframe: [{ type: Input }],
    onClick: [{ type: HostListener, args: ['click', ['$event'],] }],
    onEsc: [{ type: HostListener, args: ['window:keydown.esc', ['$event'],] }],
    sidebarMainEl: [{ type: ViewChild, args: ['sidebarMain',] }]
};
if (false) {
    /** @type {?} */
    FEPageModalSidebarComponent.prototype.config;
    /** @type {?} */
    FEPageModalSidebarComponent.prototype.isShown;
    /** @type {?} */
    FEPageModalSidebarComponent.prototype.level;
    /** @type {?} */
    FEPageModalSidebarComponent.prototype.isAnimated;
    /** @type {?} */
    FEPageModalSidebarComponent.prototype.bsModalService;
    /** @type {?} */
    FEPageModalSidebarComponent.prototype.dialogType;
    /** @type {?} */
    FEPageModalSidebarComponent.prototype.closed;
    /** @type {?} */
    FEPageModalSidebarComponent.prototype.opened;
    /** @type {?} */
    FEPageModalSidebarComponent.prototype.resized;
    /** @type {?} */
    FEPageModalSidebarComponent.prototype.modalID;
    /** @type {?} */
    FEPageModalSidebarComponent.prototype.iframeSrc;
    /**
     * @type {?}
     * @private
     */
    FEPageModalSidebarComponent.prototype._iframe;
    /**
     * @type {?}
     * @private
     */
    FEPageModalSidebarComponent.prototype.isModalHiding;
    /**
     * @type {?}
     * @private
     */
    FEPageModalSidebarComponent.prototype.sidebarMainEl;
    /**
     * @type {?}
     * @private
     */
    FEPageModalSidebarComponent.prototype.canRemoveInitNoAnimateCls;
    /**
     * @type {?}
     * @private
     */
    FEPageModalSidebarComponent.prototype.parentEl;
    /**
     * @type {?}
     * @private
     */
    FEPageModalSidebarComponent.prototype.sidebarCls;
    /** @type {?} */
    FEPageModalSidebarComponent.prototype.isOpen;
    /**
     * @type {?}
     * @protected
     */
    FEPageModalSidebarComponent.prototype.el;
    /**
     * @type {?}
     * @private
     */
    FEPageModalSidebarComponent.prototype._renderer;
    /**
     * @type {?}
     * @private
     */
    FEPageModalSidebarComponent.prototype.sanitizer;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGFnZS1zaWRlYmFyLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvZXh0ZW5kLXBhZ2UtbW9kYWwvIiwic291cmNlcyI6WyJsaWIvcGFnZS1zaWRlYmFyLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQVUsS0FBSyxFQUFnQixZQUFZLEVBQUUsTUFBTSxFQUFFLFNBQVMsRUFBRSxVQUFVLEVBQW1DLFNBQVMsRUFBNEIsV0FBVyxFQUFFLFlBQVksRUFBYSxNQUFNLGVBQWUsQ0FBQztBQUVoTyxPQUFPLEVBQUUsWUFBWSxFQUFtQixNQUFNLDJCQUEyQixDQUFDO0FBQzFFLE9BQU8sRUFDb0IseUJBQXlCLEVBQ2hELGtCQUFrQixFQUNyQixNQUFNLDRCQUE0QixDQUFDO0FBWXBDLE1BQU0sT0FBTywyQkFBMkI7Ozs7Ozs7SUFtRXBDLFlBQ0ksT0FBMkIsRUFDakIsRUFBYyxFQUNoQixTQUFvQixFQUNwQixTQUF1QjtRQUZyQixPQUFFLEdBQUYsRUFBRSxDQUFZO1FBQ2hCLGNBQVMsR0FBVCxTQUFTLENBQVc7UUFDcEIsY0FBUyxHQUFULFNBQVMsQ0FBYztRQXJFbkMsWUFBTyxHQUFHLEtBQUssQ0FBQztRQUtOLFdBQU0sR0FBRyxJQUFJLFlBQVksRUFBRSxDQUFDO1FBQzVCLFdBQU0sR0FBRyxJQUFJLFlBQVksRUFBRSxDQUFDO1FBQzVCLFlBQU8sR0FBRyxJQUFJLFlBQVksRUFBRSxDQUFDO1FBQ3BCLFlBQU8sR0FBRyxXQUFXLElBQUksQ0FBQyxHQUFHLEVBQUUsQ0FBQyxXQUFXLEVBQUUsRUFBRSxDQUFDO1FBQ25FLGNBQVMsR0FBb0IsRUFBRSxDQUFDO1FBQ3hCLFlBQU8sR0FBRyxFQUFFLENBQUM7UUEwQ2Isa0JBQWEsR0FBRyxLQUFLLENBQUM7UUFJdEIsOEJBQXlCLEdBQUcsSUFBSSxDQUFDO1FBRWpDLGVBQVUsR0FBRztZQUNqQixRQUFRLEVBQUUsa0JBQWtCO1lBQzVCLFlBQVksRUFBRSx5QkFBeUI7WUFDdkMsYUFBYSxFQUFFLDJCQUEyQjtZQUMxQyxNQUFNLEVBQUUsZUFBZTtTQUMxQixDQUFBO1FBQ0QsV0FBTSxHQUFHLEtBQUssQ0FBQztRQU1YLElBQUksQ0FBQyxNQUFNLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBQyxFQUFFLEVBQUUsT0FBTyxDQUFDLENBQUM7SUFDN0MsQ0FBQzs7Ozs7SUE1REQsSUFDVyxNQUFNLENBQUMsS0FBYTtRQUMzQixJQUFJLElBQUksQ0FBQyxTQUFTLEVBQUU7WUFDaEIsSUFBSSxDQUFDLE9BQU8sR0FBRyxLQUFLLENBQUM7WUFDckIsSUFBSSxDQUFDLFNBQVMsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLDhCQUE4QixDQUFDLEtBQUssQ0FBQyxDQUFDO1NBQ3pFO0lBQ0wsQ0FBQzs7OztJQUNELElBQVcsTUFBTTtRQUNiLE9BQU8sSUFBSSxDQUFDLE9BQU8sQ0FBQztJQUN4QixDQUFDOzs7OztJQUdELE9BQU8sQ0FBQyxLQUFpQjs7Y0FDZixHQUFHLEdBQUcsbUJBQUEsS0FBSyxDQUFDLE1BQU0sRUFBTztRQUMvQixJQUFJLElBQUksQ0FBQyxNQUFNLENBQUMsbUJBQW1CLElBQUksSUFBSSxDQUFDLE1BQU0sQ0FBQyxRQUFRLEtBQUssUUFBUSxJQUFJLEtBQUssQ0FBQyxNQUFNLEtBQUssSUFBSSxDQUFDLEVBQUUsQ0FBQyxhQUFhLEVBQUU7WUFDaEgsS0FBSyxDQUFDLGVBQWUsRUFBRSxDQUFDO1lBQ3hCLE9BQU87U0FDVjtRQUVELElBQUksQ0FBQyxjQUFjLENBQUMsZ0JBQWdCLENBQUMseUJBQXlCLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDekUsSUFBSSxDQUFDLEtBQUssRUFBRSxDQUFDO0lBQ2pCLENBQUM7Ozs7O0lBR0QsS0FBSyxDQUFDLEtBQVU7UUFDWixJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sRUFBRTtZQUNmLE9BQU87U0FDVjtRQUVELElBQUksS0FBSyxDQUFDLE9BQU8sS0FBSyxFQUFFLEVBQUU7WUFDdEIsS0FBSyxDQUFDLGNBQWMsRUFBRSxDQUFDO1NBQzFCO1FBRUQsSUFDSSxJQUFJLENBQUMsTUFBTSxDQUFDLFFBQVE7WUFDcEIsSUFBSSxDQUFDLEtBQUssS0FBSyxJQUFJLENBQUMsY0FBYyxDQUFDLGNBQWMsRUFBRSxFQUNyRDtZQUNFLElBQUksQ0FBQyxjQUFjLENBQUMsZ0JBQWdCLENBQUMseUJBQXlCLENBQUMsR0FBRyxDQUFDLENBQUM7WUFDcEUsSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQztTQUNyQjtJQUNMLENBQUM7Ozs7SUFzQkQsUUFBUTtRQUNKLElBQUksQ0FBQyxRQUFRLEdBQUcsSUFBSSxDQUFDLEVBQUUsQ0FBQyxhQUFhLENBQUMsYUFBYSxDQUFDO1FBQ3BELElBQUksQ0FBQyxTQUFTLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxRQUFRLEVBQUUsSUFBSSxDQUFDLFVBQVUsQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUMvRCxJQUFJLENBQUMsb0JBQW9CLEVBQUUsQ0FBQztRQUM1QixVQUFVOzs7UUFBQyxHQUFHLEVBQUU7WUFDWixJQUFJLENBQUMsT0FBTyxHQUFHLElBQUksQ0FBQztZQUNwQixJQUFJLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQztZQUNuQiwyQkFBMkI7WUFDM0Isd0RBQXdEO1lBQ3hELEtBQUs7WUFDTCxTQUFTO1lBQ1QsSUFBSSxDQUFDLFNBQVMsQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFBRSxJQUFJLENBQUMsVUFBVSxDQUFDLFdBQVcsQ0FBQyxDQUFDO1lBQ3ZFLElBQUksQ0FBQyxTQUFTLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxRQUFRLEVBQUUsSUFBSSxDQUFDLFVBQVUsQ0FBQyxVQUFVLENBQUMsQ0FBQztZQUNuRSxzRUFBc0U7WUFDdEUsNkdBQTZHO1lBQzdHLHlDQUF5QztZQUN6QyxJQUFJO1lBRUosbUNBQW1DO1lBQ25DLDZEQUE2RDtZQUM3RCw0QkFBNEI7WUFDNUIsZ0RBQWdEO1lBQ2hELDhDQUE4QztZQUM5QyxRQUFRO1lBQ1IsMkVBQTJFO1lBQzNFLDhFQUE4RTtZQUM5RSxRQUFRO1lBQ1IsSUFBSTtZQUNKLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxDQUFDLENBQUM7UUFDdEMsQ0FBQyxHQUFFLENBQUMsQ0FBQyxDQUFDO1FBQ04sSUFBSSxJQUFJLENBQUMsRUFBRSxDQUFDLGFBQWEsRUFBRTtZQUN2QixJQUFJLENBQUMsRUFBRSxDQUFDLGFBQWEsQ0FBQyxLQUFLLEVBQUUsQ0FBQztTQUNqQztJQUVMLENBQUM7Ozs7SUFDRCxrQkFBa0I7SUFDbEIsQ0FBQzs7OztJQUNELFdBQVc7UUFDUCxJQUFJLElBQUksQ0FBQyxPQUFPLEVBQUU7WUFDZCxJQUFJLENBQUMsS0FBSyxFQUFFLENBQUM7U0FDaEI7SUFDTCxDQUFDOzs7O0lBQ0QsU0FBUztRQUNMLE9BQU8sSUFBSSxDQUFDLE9BQU8sSUFBSSxFQUFFLENBQUM7SUFDOUIsQ0FBQzs7OztJQUNELFlBQVk7UUFDUiwrQkFBK0I7UUFDL0IsMEJBQTBCO1FBQzFCLDBEQUEwRDtRQUMxRCxpQ0FBaUM7UUFDakMsU0FBUztRQUNULFdBQVc7UUFDWCwyQkFBMkI7UUFDM0IsSUFBSTtRQUNKLElBQUksQ0FBQyxTQUFTLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxRQUFRLEVBQUUsSUFBSSxDQUFDLFVBQVUsQ0FBQyxVQUFVLENBQUMsQ0FBQztRQUN0RSxJQUFJLENBQUMsU0FBUyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsUUFBUSxFQUFFLElBQUksQ0FBQyxVQUFVLENBQUMsV0FBVyxDQUFDLENBQUM7SUFDeEUsQ0FBQzs7OztJQUNELFdBQVc7UUFDUCxJQUFJLENBQUMsb0JBQW9CLEVBQUUsQ0FBQztRQUM1QixJQUFJLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQztRQUNuQixJQUFJLENBQUMsU0FBUyxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsUUFBUSxFQUFFLElBQUksQ0FBQyxVQUFVLENBQUMsV0FBVyxDQUFDLENBQUM7UUFDdkUsSUFBSSxDQUFDLFNBQVMsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFBRSxJQUFJLENBQUMsVUFBVSxDQUFDLFVBQVUsQ0FBQyxDQUFDO0lBQ3ZFLENBQUM7Ozs7OztJQUdPLG9CQUFvQjtRQUN4QixJQUFJLENBQUMsSUFBSSxDQUFDLHlCQUF5QixFQUFFO1lBQ2pDLE9BQU87U0FDVjtRQUNELElBQUksSUFBSSxDQUFDLGFBQWEsRUFBRTtZQUNwQixJQUFJLENBQUMsU0FBUyxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLGFBQWEsRUFBRSxJQUFJLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQ25GLElBQUksQ0FBQyx5QkFBeUIsR0FBRyxLQUFLLENBQUM7U0FDMUM7SUFDTCxDQUFDOzs7OztJQUVELGVBQWU7UUFDWCxJQUFJLE9BQU8sSUFBSSxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsSUFBSSxRQUFRLEVBQUU7WUFDekMsT0FBTyxJQUFJLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1NBQy9CO2FBQU07WUFDSCxPQUFPLElBQUksQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLEdBQUcsSUFBSSxDQUFDO1NBQ3RDO0lBRUwsQ0FBQzs7Ozs7OztJQUVELEtBQUssQ0FBQyxDQUFjLEVBQUUsYUFBYSxHQUFHLEtBQUs7UUFDdkMsSUFBSSxDQUFDLEVBQUU7WUFDSCxDQUFDLENBQUMsZUFBZSxFQUFFLENBQUM7U0FDdkI7UUFDRCxJQUFJLElBQUksQ0FBQyxhQUFhLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFO1lBQ3JDLE9BQU87U0FDVjtRQUVELElBQUksQ0FBQyxNQUFNLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxDQUFDLFNBQVM7Ozs7UUFBQyxDQUFDLENBQUMsRUFBRTtZQUN4QyxJQUFJLENBQUMsQ0FBQyxFQUFFO2dCQUNKLE9BQU8sS0FBSyxDQUFDO2FBQ2hCO1lBQ0QsWUFBWTtZQUNaLElBQUksQ0FBQyxhQUFhLENBQUMsYUFBYSxDQUFDLGFBQWEsQ0FBQyxnQkFBZ0IsQ0FBQyxlQUFlOzs7O1lBQUUsQ0FBQyxDQUFNLEVBQUUsRUFBRTtnQkFDeEYsSUFBSSxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO2dCQUNyQyxJQUFJLENBQUMsYUFBYSxHQUFHLEtBQUssQ0FBQztnQkFDM0IsSUFBSSxJQUFJLENBQUMsTUFBTSxDQUFDLE1BQU0sRUFBRTtvQkFDcEIsSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsYUFBYSxDQUFDLENBQUM7aUJBQ3JDO2dCQUNELElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUNqQyxDQUFDLEdBQUUsS0FBSyxDQUFDLENBQUM7WUFDVixJQUFJLENBQUMsYUFBYSxHQUFHLElBQUksQ0FBQztZQUMxQixJQUFJLENBQUMsT0FBTyxHQUFHLEtBQUssQ0FBQztZQUNyQixJQUFJLENBQUMsU0FBUyxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsUUFBUSxFQUFFLElBQUksQ0FBQyxVQUFVLENBQUMsVUFBVSxDQUFDLENBQUM7WUFDdEUsSUFBSSxDQUFDLFNBQVMsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFBRSxJQUFJLENBQUMsVUFBVSxDQUFDLFdBQVcsQ0FBQyxDQUFDO1FBQ3hFLENBQUMsRUFBQyxDQUFDO0lBQ1AsQ0FBQzs7OztJQUNELFFBQVE7SUFFUixDQUFDOzs7WUFwTUosU0FBUyxTQUFDO2dCQUNQLFFBQVEsRUFBRSxpQkFBaUI7Z0JBQzNCLDZsQ0FBNEM7Z0JBRTVDLElBQUksRUFBRTtvQkFDRixLQUFLLEVBQUUsbUJBQW1CO2lCQUM3QjthQUNKOzs7O1lBWkcsa0JBQWtCO1lBTDRELFVBQVU7WUFBckIsU0FBUztZQUV2RSxZQUFZOzs7cUJBdUJoQixNQUFNO3FCQUNOLE1BQU07c0JBQ04sTUFBTTtzQkFDTixXQUFXLFNBQUMsSUFBSTtxQkFHaEIsS0FBSztzQkFXTCxZQUFZLFNBQUMsT0FBTyxFQUFFLENBQUMsUUFBUSxDQUFDO29CQVloQyxZQUFZLFNBQUMsb0JBQW9CLEVBQUUsQ0FBQyxRQUFRLENBQUM7NEJBcUI3QyxTQUFTLFNBQUMsYUFBYTs7OztJQXhEeEIsNkNBQTJCOztJQUMzQiw4Q0FBZ0I7O0lBQ2hCLDRDQUFjOztJQUNkLGlEQUFvQjs7SUFDcEIscURBQW1DOztJQUNuQyxpREFBbUI7O0lBQ25CLDZDQUFzQzs7SUFDdEMsNkNBQXNDOztJQUN0Qyw4Q0FBdUM7O0lBQ3ZDLDhDQUFtRTs7SUFDbkUsZ0RBQWdDOzs7OztJQUNoQyw4Q0FBcUI7Ozs7O0lBMENyQixvREFBOEI7Ozs7O0lBRzlCLG9EQUE0RDs7Ozs7SUFDNUQsZ0VBQXlDOzs7OztJQUN6QywrQ0FBOEI7Ozs7O0lBQzlCLGlEQUtDOztJQUNELDZDQUFlOzs7OztJQUdYLHlDQUF3Qjs7Ozs7SUFDeEIsZ0RBQTRCOzs7OztJQUM1QixnREFBK0IiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIE9uSW5pdCwgSW5wdXQsIENvbnRlbnRDaGlsZCwgRXZlbnRFbWl0dGVyLCBPdXRwdXQsIFJlbmRlcmVyMiwgRWxlbWVudFJlZiwgQWZ0ZXJDb250ZW50SW5pdCwgQWZ0ZXJWaWV3SW5pdCwgVmlld0NoaWxkLCBTaW1wbGVDaGFuZ2VzLCBPbkNoYW5nZXMsIEhvc3RCaW5kaW5nLCBIb3N0TGlzdGVuZXIsIE9uRGVzdHJveSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBBbmd1bGFyRHJhZ2dhYmxlRGlyZWN0aXZlIH0gZnJvbSAnQGZhcnJpcy91aS1kcmFnZ2FibGUnO1xyXG5pbXBvcnQgeyBEb21TYW5pdGl6ZXIsIFNhZmVSZXNvdXJjZVVybCB9IGZyb20gXCJAYW5ndWxhci9wbGF0Zm9ybS1icm93c2VyXCI7XHJcbmltcG9ydCB7XHJcbiAgICBGRVBhZ2VNb2RhbENMQVNTX05BTUUsIEZQYWdlTW9kYWxESVNNSVNTX1JFQVNPTlMsXHJcbiAgICBGRVBhZ2VNb2RhbE9wdGlvbnMsIEZQYWdlTW9kYWxUUkFOU0lUSU9OX0RVUkFUSU9OU1xyXG59IGZyb20gJy4vcGFnZS1tb2RhbC1vcHRpb25zLmNsYXNzJztcclxuaW1wb3J0IHsgRkVQYWdlTW9kYWxTZXJ2aWNlIH0gZnJvbSAnLi9wYWdlLW1vZGFsLnNlcnZpY2UnO1xyXG5cclxuXHJcbkBDb21wb25lbnQoe1xyXG4gICAgc2VsZWN0b3I6ICdmZS1wYWdlLXNpZGViYXInLFxyXG4gICAgdGVtcGxhdGVVcmw6ICcuL3BhZ2Utc2lkZWJhci5jb21wb25lbnQuaHRtbCcsXHJcbiAgICBzdHlsZVVybHM6IFtdLFxyXG4gICAgaG9zdDoge1xyXG4gICAgICAgIGNsYXNzOiAnZmUtY21wLXBhZ2UtbW9kYWwnXHJcbiAgICB9XHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBGRVBhZ2VNb2RhbFNpZGViYXJDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIE9uRGVzdHJveSxBZnRlckNvbnRlbnRJbml0IHtcclxuICAgIGNvbmZpZzogRkVQYWdlTW9kYWxPcHRpb25zO1xyXG4gICAgaXNTaG93biA9IGZhbHNlO1xyXG4gICAgbGV2ZWw6IG51bWJlcjtcclxuICAgIGlzQW5pbWF0ZWQ6IGJvb2xlYW47XHJcbiAgICBic01vZGFsU2VydmljZTogRkVQYWdlTW9kYWxTZXJ2aWNlO1xyXG4gICAgZGlhbG9nVHlwZTogc3RyaW5nO1xyXG4gICAgQE91dHB1dCgpIGNsb3NlZCA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuICAgIEBPdXRwdXQoKSBvcGVuZWQgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcbiAgICBAT3V0cHV0KCkgcmVzaXplZCA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuICAgIEBIb3N0QmluZGluZygnaWQnKSBtb2RhbElEID0gYE1PREFMSURfJHtEYXRlLm5vdygpLnRvUHJlY2lzaW9uKCl9YDtcclxuICAgIGlmcmFtZVNyYzogU2FmZVJlc291cmNlVXJsID0gJyc7XHJcbiAgICBwcml2YXRlIF9pZnJhbWUgPSAnJztcclxuICAgIEBJbnB1dCgpXHJcbiAgICBwdWJsaWMgc2V0IGlmcmFtZSh2YWx1ZTogc3RyaW5nKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuc2FuaXRpemVyKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX2lmcmFtZSA9IHZhbHVlO1xyXG4gICAgICAgICAgICB0aGlzLmlmcmFtZVNyYyA9IHRoaXMuc2FuaXRpemVyLmJ5cGFzc1NlY3VyaXR5VHJ1c3RSZXNvdXJjZVVybCh2YWx1ZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgcHVibGljIGdldCBpZnJhbWUoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2lmcmFtZTtcclxuICAgIH1cclxuXHJcbiAgICBASG9zdExpc3RlbmVyKCdjbGljaycsIFsnJGV2ZW50J10pXHJcbiAgICBvbkNsaWNrKGV2ZW50OiBNb3VzZUV2ZW50KSB7XHJcbiAgICAgICAgY29uc3QgdGFnID0gZXZlbnQudGFyZ2V0IGFzIGFueTtcclxuICAgICAgICBpZiAodGhpcy5jb25maWcuaWdub3JlQmFja2Ryb3BDbGljayB8fCB0aGlzLmNvbmZpZy5iYWNrZHJvcCA9PT0gJ3N0YXRpYycgfHwgZXZlbnQudGFyZ2V0ICE9PSB0aGlzLmVsLm5hdGl2ZUVsZW1lbnQpIHtcclxuICAgICAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7ICBcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5ic01vZGFsU2VydmljZS5zZXREaXNtaXNzUmVhc29uKEZQYWdlTW9kYWxESVNNSVNTX1JFQVNPTlMuQkFDS1JET1ApO1xyXG4gICAgICAgIHRoaXMuY2xvc2UoKTtcclxuICAgIH1cclxuXHJcbiAgICBASG9zdExpc3RlbmVyKCd3aW5kb3c6a2V5ZG93bi5lc2MnLCBbJyRldmVudCddKVxyXG4gICAgb25Fc2MoZXZlbnQ6IGFueSk6IHZvaWQge1xyXG4gICAgICAgIGlmICghdGhpcy5pc1Nob3duKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChldmVudC5rZXlDb2RlID09PSAyNykge1xyXG4gICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKFxyXG4gICAgICAgICAgICB0aGlzLmNvbmZpZy5rZXlib2FyZCAmJlxyXG4gICAgICAgICAgICB0aGlzLmxldmVsID09PSB0aGlzLmJzTW9kYWxTZXJ2aWNlLmdldE1vZGFsc0NvdW50KClcclxuICAgICAgICApIHtcclxuICAgICAgICAgICAgdGhpcy5ic01vZGFsU2VydmljZS5zZXREaXNtaXNzUmVhc29uKEZQYWdlTW9kYWxESVNNSVNTX1JFQVNPTlMuRVNDKTtcclxuICAgICAgICAgICAgdGhpcy5jbG9zZShldmVudCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgcHJpdmF0ZSBpc01vZGFsSGlkaW5nID0gZmFsc2U7XHJcblxyXG4gICAgLy8g5L6n6L655qCP5omA54us5pyJXHJcbiAgICBAVmlld0NoaWxkKCdzaWRlYmFyTWFpbicpIHByaXZhdGUgc2lkZWJhck1haW5FbDogRWxlbWVudFJlZjtcclxuICAgIHByaXZhdGUgY2FuUmVtb3ZlSW5pdE5vQW5pbWF0ZUNscyA9IHRydWU7XHJcbiAgICBwcml2YXRlIHBhcmVudEVsOiBIVE1MRWxlbWVudDtcclxuICAgIHByaXZhdGUgc2lkZWJhckNscyA9IHtcclxuICAgICAgICAncGFyZW50JzogJ2Ytc2lkZWJhci1wYXJlbnQnLFxyXG4gICAgICAgICdvcGVuUGFyZW50JzogJ2Ytc2lkZWJhci1wYXJlbnQtZXhwYW5kJyxcclxuICAgICAgICAnY2xvc2VQYXJlbnQnOiAnZi1zaWRlYmFyLXBhcmVudC1jb2xsYXBzZScsXHJcbiAgICAgICAgJ2luaXQnOiAnYW5pbWF0ZWQtbm9uZSdcclxuICAgIH1cclxuICAgIGlzT3BlbiA9IGZhbHNlO1xyXG4gICAgY29uc3RydWN0b3IoXHJcbiAgICAgICAgb3B0aW9uczogRkVQYWdlTW9kYWxPcHRpb25zLFxyXG4gICAgICAgIHByb3RlY3RlZCBlbDogRWxlbWVudFJlZixcclxuICAgICAgICBwcml2YXRlIF9yZW5kZXJlcjogUmVuZGVyZXIyLFxyXG4gICAgICAgIHByaXZhdGUgc2FuaXRpemVyOiBEb21TYW5pdGl6ZXIpIHtcclxuICAgICAgICB0aGlzLmNvbmZpZyA9IE9iamVjdC5hc3NpZ24oe30sIG9wdGlvbnMpO1xyXG4gICAgfVxyXG5cclxuICAgIG5nT25Jbml0KCk6IHZvaWQge1xyXG4gICAgICAgIHRoaXMucGFyZW50RWwgPSB0aGlzLmVsLm5hdGl2ZUVsZW1lbnQucGFyZW50RWxlbWVudDtcclxuICAgICAgICB0aGlzLl9yZW5kZXJlci5hZGRDbGFzcyh0aGlzLnBhcmVudEVsLCB0aGlzLnNpZGViYXJDbHMucGFyZW50KTtcclxuICAgICAgICB0aGlzLnJlbW92ZU5vbmVBbmltYXRlQ2xzKCk7XHJcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuaXNTaG93biA9IHRydWU7XHJcbiAgICAgICAgICAgIHRoaXMuaXNPcGVuID0gdHJ1ZTtcclxuICAgICAgICAgICAgLy8gdGhpcy5fcmVuZGVyZXIuYWRkQ2xhc3MoXHJcbiAgICAgICAgICAgIC8vICAgICB0aGlzLmVsLm5hdGl2ZUVsZW1lbnQsIEZFUGFnZU1vZGFsQ0xBU1NfTkFNRS5TSE9XXHJcbiAgICAgICAgICAgIC8vICk7XHJcbiAgICAgICAgICAgIC8vIFBhcmVudFxyXG4gICAgICAgICAgICB0aGlzLl9yZW5kZXJlci5yZW1vdmVDbGFzcyh0aGlzLnBhcmVudEVsLCB0aGlzLnNpZGViYXJDbHMuY2xvc2VQYXJlbnQpO1xyXG4gICAgICAgICAgICB0aGlzLl9yZW5kZXJlci5hZGRDbGFzcyh0aGlzLnBhcmVudEVsLCB0aGlzLnNpZGViYXJDbHMub3BlblBhcmVudCk7XHJcbiAgICAgICAgICAgIC8vIHRoaXMuX3JlbmRlcmVyLnNldFN0eWxlKHRoaXMuZWwubmF0aXZlRWxlbWVudCwgJ2Rpc3BsYXknLCAnYmxvY2snKTtcclxuICAgICAgICAgICAgLy8gaWYgKHRoaXMuY29uZmlnLmZpdENvbnRlbnQgJiYgdGhpcy5lbC5uYXRpdmVFbGVtZW50LmNsYXNzTmFtZS5pbmRleE9mKCdmLW1vZGFsLWZpdENvbnRlbnQtc2Nyb2xsJykgPiAtMSkge1xyXG4gICAgICAgICAgICAvLyAgIHRoaXMuZWwubmF0aXZlRWxlbWVudC5zY3JvbGxUb3AgPSAwO1xyXG4gICAgICAgICAgICAvLyB9XHJcblxyXG4gICAgICAgICAgICAvLyBpZiAoZG9jdW1lbnQgJiYgZG9jdW1lbnQuYm9keSkge1xyXG4gICAgICAgICAgICAvLyAgICAgY29uc3QgbW9kYWxMZW4gPSB0aGlzLmJzTW9kYWxTZXJ2aWNlLmdldE1vZGFsc0NvdW50KCk7XHJcbiAgICAgICAgICAgIC8vICAgICBpZiAobW9kYWxMZW4gPT09IDEpIHtcclxuICAgICAgICAgICAgLy8gICAgICAgICB0aGlzLmJzTW9kYWxTZXJ2aWNlLmNoZWNrU2Nyb2xsYmFyKCk7XHJcbiAgICAgICAgICAgIC8vICAgICAgICAgdGhpcy5ic01vZGFsU2VydmljZS5zZXRTY3JvbGxiYXIoKTtcclxuICAgICAgICAgICAgLy8gICAgIH1cclxuICAgICAgICAgICAgLy8gICAgIGlmICghZG9jdW1lbnQuYm9keS5jbGFzc0xpc3QuY29udGFpbnMoRkVQYWdlTW9kYWxDTEFTU19OQU1FLk9QRU4pKSB7XHJcbiAgICAgICAgICAgIC8vICAgICAgICAgdGhpcy5fcmVuZGVyZXIuYWRkQ2xhc3MoZG9jdW1lbnQuYm9keSwgRkVQYWdlTW9kYWxDTEFTU19OQU1FLk9QRU4pO1xyXG4gICAgICAgICAgICAvLyAgICAgfVxyXG4gICAgICAgICAgICAvLyB9XHJcbiAgICAgICAgICAgIHRoaXMub3BlbmVkLmVtaXQoeyBtb2RhbDogdGhpcyB9KTtcclxuICAgICAgICB9LCAwKTtcclxuICAgICAgICBpZiAodGhpcy5lbC5uYXRpdmVFbGVtZW50KSB7XHJcbiAgICAgICAgICAgIHRoaXMuZWwubmF0aXZlRWxlbWVudC5mb2N1cygpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICB9XHJcbiAgICBuZ0FmdGVyQ29udGVudEluaXQoKSB7XHJcbiAgICB9XHJcbiAgICBuZ09uRGVzdHJveSgpOiB2b2lkIHtcclxuICAgICAgICBpZiAodGhpcy5pc1Nob3duKSB7XHJcbiAgICAgICAgICAgIHRoaXMuY2xvc2UoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBoYXNJZnJhbWUoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2lmcmFtZSAhPSAnJztcclxuICAgIH1cclxuICAgIGNsb3NlU2lkZUJhcigpIHtcclxuICAgICAgICAvLyB0aGlzLnJlbW92ZU5vbmVBbmltYXRlQ2xzKCk7XHJcbiAgICAgICAgLy8gaWYgKHRoaXMuYmVmb3JlQ2xvc2UpIHtcclxuICAgICAgICAvLyAgICAgdGhpcy5iZWZvcmVDbG9zZSgpLnN1YnNjcmliZSgoaXNPcGVuOiBib29sZWFuKSA9PiB7XHJcbiAgICAgICAgLy8gICAgICAgICB0aGlzLmlzT3BlbiA9ICFpc09wZW47XHJcbiAgICAgICAgLy8gICAgIH0pXHJcbiAgICAgICAgLy8gfSBlbHNlIHtcclxuICAgICAgICAvLyAgICAgdGhpcy5pc09wZW4gPSBmYWxzZTtcclxuICAgICAgICAvLyB9XHJcbiAgICAgICAgdGhpcy5fcmVuZGVyZXIucmVtb3ZlQ2xhc3ModGhpcy5wYXJlbnRFbCwgdGhpcy5zaWRlYmFyQ2xzLm9wZW5QYXJlbnQpO1xyXG4gICAgICAgIHRoaXMuX3JlbmRlcmVyLmFkZENsYXNzKHRoaXMucGFyZW50RWwsIHRoaXMuc2lkZWJhckNscy5jbG9zZVBhcmVudCk7XHJcbiAgICB9XHJcbiAgICBvcGVuU2lkZUJhcigpIHtcclxuICAgICAgICB0aGlzLnJlbW92ZU5vbmVBbmltYXRlQ2xzKCk7XHJcbiAgICAgICAgdGhpcy5pc09wZW4gPSB0cnVlO1xyXG4gICAgICAgIHRoaXMuX3JlbmRlcmVyLnJlbW92ZUNsYXNzKHRoaXMucGFyZW50RWwsIHRoaXMuc2lkZWJhckNscy5jbG9zZVBhcmVudCk7XHJcbiAgICAgICAgdGhpcy5fcmVuZGVyZXIuYWRkQ2xhc3ModGhpcy5wYXJlbnRFbCwgdGhpcy5zaWRlYmFyQ2xzLm9wZW5QYXJlbnQpO1xyXG4gICAgfVxyXG5cclxuICAgIC8q5L6n6L655qCP5Yid5aeL5Zug5Li65Yqo55S75pS26LW35pe277yM5Lya6KKr55yL5YiwLCDnp7vpmaQgKi9cclxuICAgIHByaXZhdGUgcmVtb3ZlTm9uZUFuaW1hdGVDbHMoKSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLmNhblJlbW92ZUluaXROb0FuaW1hdGVDbHMpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGhpcy5zaWRlYmFyTWFpbkVsKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX3JlbmRlcmVyLnJlbW92ZUNsYXNzKHRoaXMuc2lkZWJhck1haW5FbC5uYXRpdmVFbGVtZW50LCB0aGlzLnNpZGViYXJDbHMuaW5pdCk7XHJcbiAgICAgICAgICAgIHRoaXMuY2FuUmVtb3ZlSW5pdE5vQW5pbWF0ZUNscyA9IGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIC8vIOS+p+i+ueagj+WuveW6puiuoeeul1xyXG4gICAgZ2V0U2lkZWJhcldpZHRoKCkge1xyXG4gICAgICAgIGlmICh0eXBlb2YgdGhpcy5jb25maWdbJ3dpZHRoJ10gPT0gJ3N0cmluZycpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuY29uZmlnWyd3aWR0aCddO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmNvbmZpZ1snd2lkdGgnXSArICdweCc7XHJcbiAgICAgICAgfVxyXG5cclxuICAgIH1cclxuICAgIC8vIOW/hemhu+W4pueahOaWueazlVxyXG4gICAgY2xvc2UoZT86IE1vdXNlRXZlbnQsIGlzQ2xvc2VCdXR0b24gPSBmYWxzZSk6IHZvaWQge1xyXG4gICAgICAgIGlmIChlKSB7XHJcbiAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0aGlzLmlzTW9kYWxIaWRpbmcgfHwgIXRoaXMuaXNTaG93bikge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLmNvbmZpZy5iZWZvcmVDbG9zZSh0aGlzKS5zdWJzY3JpYmUociA9PiB7XHJcbiAgICAgICAgICAgIGlmICghcikge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8v5Yqo55S757uT5p2f5omn6KGM5YW25LuW5pON5L2cXHJcbiAgICAgICAgICAgIHRoaXMuc2lkZWJhck1haW5FbC5uYXRpdmVFbGVtZW50LnBhcmVudEVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigndHJhbnNpdGlvbmVuZCcsIChlOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMuYnNNb2RhbFNlcnZpY2UuaGlkZSh0aGlzLmxldmVsKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuaXNNb2RhbEhpZGluZyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuY29uZmlnLmNsb3NlZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY29uZmlnLmNsb3NlZChpc0Nsb3NlQnV0dG9uKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHRoaXMuY2xvc2VkLmVtaXQodGhpcy5sZXZlbCk7XHJcbiAgICAgICAgICAgIH0sIGZhbHNlKTtcclxuICAgICAgICAgICAgdGhpcy5pc01vZGFsSGlkaW5nID0gdHJ1ZTtcclxuICAgICAgICAgICAgdGhpcy5pc1Nob3duID0gZmFsc2U7XHJcbiAgICAgICAgICAgIHRoaXMuX3JlbmRlcmVyLnJlbW92ZUNsYXNzKHRoaXMucGFyZW50RWwsIHRoaXMuc2lkZWJhckNscy5vcGVuUGFyZW50KTtcclxuICAgICAgICAgICAgdGhpcy5fcmVuZGVyZXIuYWRkQ2xhc3ModGhpcy5wYXJlbnRFbCwgdGhpcy5zaWRlYmFyQ2xzLmNsb3NlUGFyZW50KTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuICAgIHRvQ2VudGVyKCkge1xyXG5cclxuICAgIH1cclxuXHJcbn1cclxuIl19
/**
 * @fileoverview added by tsickle
 * Generated from: lib/page-sidebar.component.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input, EventEmitter, Output, Renderer2, ElementRef, ViewChild, HostBinding, HostListener } from '@angular/core';
import { DomSanitizer } from "@angular/platform-browser";
import { FPageModalDISMISS_REASONS, FEPageModalOptions } from './page-modal-options.class';
var FEPageModalSidebarComponent = /** @class */ (function () {
    function FEPageModalSidebarComponent(options, el, _renderer, sanitizer) {
        this.el = el;
        this._renderer = _renderer;
        this.sanitizer = sanitizer;
        this.isShown = false;
        this.closed = new EventEmitter();
        this.opened = new EventEmitter();
        this.resized = new EventEmitter();
        this.modalID = "MODALID_" + Date.now().toPrecision();
        this.iframeSrc = '';
        this._iframe = '';
        this.isModalHiding = false;
        this.canRemoveInitNoAnimateCls = true;
        this.sidebarCls = {
            'parent': 'f-sidebar-parent',
            'openParent': 'f-sidebar-parent-expand',
            'closeParent': 'f-sidebar-parent-collapse',
            'init': 'animated-none'
        };
        this.isOpen = false;
        this.config = Object.assign({}, options);
    }
    Object.defineProperty(FEPageModalSidebarComponent.prototype, "iframe", {
        get: /**
         * @return {?}
         */
        function () {
            return this._iframe;
        },
        set: /**
         * @param {?} value
         * @return {?}
         */
        function (value) {
            if (this.sanitizer) {
                this._iframe = value;
                this.iframeSrc = this.sanitizer.bypassSecurityTrustResourceUrl(value);
            }
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @param {?} event
     * @return {?}
     */
    FEPageModalSidebarComponent.prototype.onClick = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        /** @type {?} */
        var tag = (/** @type {?} */ (event.target));
        if (this.config.ignoreBackdropClick || this.config.backdrop === 'static' || event.target !== this.el.nativeElement) {
            event.stopPropagation();
            return;
        }
        this.bsModalService.setDismissReason(FPageModalDISMISS_REASONS.BACKRDOP);
        this.close();
    };
    /**
     * @param {?} event
     * @return {?}
     */
    FEPageModalSidebarComponent.prototype.onEsc = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        if (!this.isShown) {
            return;
        }
        if (event.keyCode === 27) {
            event.preventDefault();
        }
        if (this.config.keyboard &&
            this.level === this.bsModalService.getModalsCount()) {
            this.bsModalService.setDismissReason(FPageModalDISMISS_REASONS.ESC);
            this.close(event);
        }
    };
    /**
     * @return {?}
     */
    FEPageModalSidebarComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.parentEl = this.el.nativeElement.parentElement;
        this._renderer.addClass(this.parentEl, this.sidebarCls.parent);
        this.removeNoneAnimateCls();
        setTimeout((/**
         * @return {?}
         */
        function () {
            _this.isShown = true;
            _this.isOpen = true;
            // this._renderer.addClass(
            //     this.el.nativeElement, FEPageModalCLASS_NAME.SHOW
            // );
            // Parent
            _this._renderer.removeClass(_this.parentEl, _this.sidebarCls.closeParent);
            _this._renderer.addClass(_this.parentEl, _this.sidebarCls.openParent);
            // this._renderer.setStyle(this.el.nativeElement, 'display', 'block');
            // if (this.config.fitContent && this.el.nativeElement.className.indexOf('f-modal-fitContent-scroll') > -1) {
            //   this.el.nativeElement.scrollTop = 0;
            // }
            // if (document && document.body) {
            //     const modalLen = this.bsModalService.getModalsCount();
            //     if (modalLen === 1) {
            //         this.bsModalService.checkScrollbar();
            //         this.bsModalService.setScrollbar();
            //     }
            //     if (!document.body.classList.contains(FEPageModalCLASS_NAME.OPEN)) {
            //         this._renderer.addClass(document.body, FEPageModalCLASS_NAME.OPEN);
            //     }
            // }
            _this.opened.emit({ modal: _this });
        }), 0);
        if (this.el.nativeElement) {
            this.el.nativeElement.focus();
        }
    };
    /**
     * @return {?}
     */
    FEPageModalSidebarComponent.prototype.ngAfterContentInit = /**
     * @return {?}
     */
    function () {
    };
    /**
     * @return {?}
     */
    FEPageModalSidebarComponent.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        if (this.isShown) {
            this.close();
        }
    };
    /**
     * @return {?}
     */
    FEPageModalSidebarComponent.prototype.hasIframe = /**
     * @return {?}
     */
    function () {
        return this._iframe != '';
    };
    /**
     * @return {?}
     */
    FEPageModalSidebarComponent.prototype.closeSideBar = /**
     * @return {?}
     */
    function () {
        // this.removeNoneAnimateCls();
        // if (this.beforeClose) {
        //     this.beforeClose().subscribe((isOpen: boolean) => {
        //         this.isOpen = !isOpen;
        //     })
        // } else {
        //     this.isOpen = false;
        // }
        this._renderer.removeClass(this.parentEl, this.sidebarCls.openParent);
        this._renderer.addClass(this.parentEl, this.sidebarCls.closeParent);
    };
    /**
     * @return {?}
     */
    FEPageModalSidebarComponent.prototype.openSideBar = /**
     * @return {?}
     */
    function () {
        this.removeNoneAnimateCls();
        this.isOpen = true;
        this._renderer.removeClass(this.parentEl, this.sidebarCls.closeParent);
        this._renderer.addClass(this.parentEl, this.sidebarCls.openParent);
    };
    /*侧边栏初始因为动画收起时，会被看到, 移除 */
    /*侧边栏初始因为动画收起时，会被看到, 移除 */
    /**
     * @private
     * @return {?}
     */
    FEPageModalSidebarComponent.prototype.removeNoneAnimateCls = /*侧边栏初始因为动画收起时，会被看到, 移除 */
    /**
     * @private
     * @return {?}
     */
    function () {
        if (!this.canRemoveInitNoAnimateCls) {
            return;
        }
        if (this.sidebarMainEl) {
            this._renderer.removeClass(this.sidebarMainEl.nativeElement, this.sidebarCls.init);
            this.canRemoveInitNoAnimateCls = false;
        }
    };
    // 侧边栏宽度计算
    // 侧边栏宽度计算
    /**
     * @return {?}
     */
    FEPageModalSidebarComponent.prototype.getSidebarWidth = 
    // 侧边栏宽度计算
    /**
     * @return {?}
     */
    function () {
        if (typeof this.config['width'] == 'string') {
            return this.config['width'];
        }
        else {
            return this.config['width'] + 'px';
        }
    };
    // 必须带的方法
    // 必须带的方法
    /**
     * @param {?=} e
     * @param {?=} isCloseButton
     * @return {?}
     */
    FEPageModalSidebarComponent.prototype.close = 
    // 必须带的方法
    /**
     * @param {?=} e
     * @param {?=} isCloseButton
     * @return {?}
     */
    function (e, isCloseButton) {
        var _this = this;
        if (isCloseButton === void 0) { isCloseButton = false; }
        if (e) {
            e.stopPropagation();
        }
        if (this.isModalHiding || !this.isShown) {
            return;
        }
        this.config.beforeClose(this).subscribe((/**
         * @param {?} r
         * @return {?}
         */
        function (r) {
            if (!r) {
                return false;
            }
            //动画结束执行其他操作
            _this.sidebarMainEl.nativeElement.parentElement.addEventListener('transitionend', (/**
             * @param {?} e
             * @return {?}
             */
            function (e) {
                _this.bsModalService.hide(_this.level);
                _this.isModalHiding = false;
                if (_this.config.closed) {
                    _this.config.closed(isCloseButton);
                }
                _this.closed.emit(_this.level);
            }), false);
            _this.isModalHiding = true;
            _this.isShown = false;
            _this._renderer.removeClass(_this.parentEl, _this.sidebarCls.openParent);
            _this._renderer.addClass(_this.parentEl, _this.sidebarCls.closeParent);
        }));
    };
    /**
     * @return {?}
     */
    FEPageModalSidebarComponent.prototype.toCenter = /**
     * @return {?}
     */
    function () {
    };
    FEPageModalSidebarComponent.decorators = [
        { type: Component, args: [{
                    selector: 'fe-page-sidebar',
                    template: "<div [attr.id]=\"modalID\" class=\"f-cmp-sidebar f-sidebar-slide fe-page-sidebar\" [class]=\"config.class+' '+'f-sidebar-pos-'+config.sidebar['showPos']\"\r\n  [ngClass]=\"{'f-sidebar-show': isShown||isOpen, 'f-sidebar-collapse': !isShown||!isOpen}\">\r\n  <div class=\"f-sidebar-main animated-none\" [ngClass]=\"{'f-sidebar-main--has-actions':config.showCloseButton}\" #sidebarMain [ngStyle]=\"{width:config.width}\"\r\n    [f-area-response]=\"!iframe&&config.areaResponse\">\r\n    <perfect-scrollbar [config]=\"{}\" [disabled]=\"!config.enableScroll||config.fitContent\" *ngIf=\"!iframe\">\r\n      <ng-content></ng-content>\r\n    </perfect-scrollbar>\r\n    <iframe *ngIf=\"iframe\" class=\"f-utils-fill\" width=\"100%\" frameborder=\"0\" [src]=\"iframeSrc\"></iframe>\r\n    <div class=\"f-sidebar--action-list\" *ngIf=\"config.showCloseButton\">\r\n      <div class=\"action-list--item\" (click)=\"close($event,true)\">\r\n        <span class=\"action-list--icon close-icon\">\r\n          <i class=\"f-icon f-icon-close\"></i>\r\n        </span>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</div>",
                    host: {
                        class: 'fe-cmp-page-modal'
                    }
                }] }
    ];
    /** @nocollapse */
    FEPageModalSidebarComponent.ctorParameters = function () { return [
        { type: FEPageModalOptions },
        { type: ElementRef },
        { type: Renderer2 },
        { type: DomSanitizer }
    ]; };
    FEPageModalSidebarComponent.propDecorators = {
        closed: [{ type: Output }],
        opened: [{ type: Output }],
        resized: [{ type: Output }],
        modalID: [{ type: HostBinding, args: ['id',] }],
        iframe: [{ type: Input }],
        onClick: [{ type: HostListener, args: ['click', ['$event'],] }],
        onEsc: [{ type: HostListener, args: ['window:keydown.esc', ['$event'],] }],
        sidebarMainEl: [{ type: ViewChild, args: ['sidebarMain',] }]
    };
    return FEPageModalSidebarComponent;
}());
export { FEPageModalSidebarComponent };
if (false) {
    /** @type {?} */
    FEPageModalSidebarComponent.prototype.config;
    /** @type {?} */
    FEPageModalSidebarComponent.prototype.isShown;
    /** @type {?} */
    FEPageModalSidebarComponent.prototype.level;
    /** @type {?} */
    FEPageModalSidebarComponent.prototype.isAnimated;
    /** @type {?} */
    FEPageModalSidebarComponent.prototype.bsModalService;
    /** @type {?} */
    FEPageModalSidebarComponent.prototype.dialogType;
    /** @type {?} */
    FEPageModalSidebarComponent.prototype.closed;
    /** @type {?} */
    FEPageModalSidebarComponent.prototype.opened;
    /** @type {?} */
    FEPageModalSidebarComponent.prototype.resized;
    /** @type {?} */
    FEPageModalSidebarComponent.prototype.modalID;
    /** @type {?} */
    FEPageModalSidebarComponent.prototype.iframeSrc;
    /**
     * @type {?}
     * @private
     */
    FEPageModalSidebarComponent.prototype._iframe;
    /**
     * @type {?}
     * @private
     */
    FEPageModalSidebarComponent.prototype.isModalHiding;
    /**
     * @type {?}
     * @private
     */
    FEPageModalSidebarComponent.prototype.sidebarMainEl;
    /**
     * @type {?}
     * @private
     */
    FEPageModalSidebarComponent.prototype.canRemoveInitNoAnimateCls;
    /**
     * @type {?}
     * @private
     */
    FEPageModalSidebarComponent.prototype.parentEl;
    /**
     * @type {?}
     * @private
     */
    FEPageModalSidebarComponent.prototype.sidebarCls;
    /** @type {?} */
    FEPageModalSidebarComponent.prototype.isOpen;
    /**
     * @type {?}
     * @protected
     */
    FEPageModalSidebarComponent.prototype.el;
    /**
     * @type {?}
     * @private
     */
    FEPageModalSidebarComponent.prototype._renderer;
    /**
     * @type {?}
     * @private
     */
    FEPageModalSidebarComponent.prototype.sanitizer;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGFnZS1zaWRlYmFyLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvZXh0ZW5kLXBhZ2UtbW9kYWwvIiwic291cmNlcyI6WyJsaWIvcGFnZS1zaWRlYmFyLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQVUsS0FBSyxFQUFnQixZQUFZLEVBQUUsTUFBTSxFQUFFLFNBQVMsRUFBRSxVQUFVLEVBQW1DLFNBQVMsRUFBNEIsV0FBVyxFQUFFLFlBQVksRUFBYSxNQUFNLGVBQWUsQ0FBQztBQUVoTyxPQUFPLEVBQUUsWUFBWSxFQUFtQixNQUFNLDJCQUEyQixDQUFDO0FBQzFFLE9BQU8sRUFDb0IseUJBQXlCLEVBQ2hELGtCQUFrQixFQUNyQixNQUFNLDRCQUE0QixDQUFDO0FBSXBDO0lBMkVJLHFDQUNJLE9BQTJCLEVBQ2pCLEVBQWMsRUFDaEIsU0FBb0IsRUFDcEIsU0FBdUI7UUFGckIsT0FBRSxHQUFGLEVBQUUsQ0FBWTtRQUNoQixjQUFTLEdBQVQsU0FBUyxDQUFXO1FBQ3BCLGNBQVMsR0FBVCxTQUFTLENBQWM7UUFyRW5DLFlBQU8sR0FBRyxLQUFLLENBQUM7UUFLTixXQUFNLEdBQUcsSUFBSSxZQUFZLEVBQUUsQ0FBQztRQUM1QixXQUFNLEdBQUcsSUFBSSxZQUFZLEVBQUUsQ0FBQztRQUM1QixZQUFPLEdBQUcsSUFBSSxZQUFZLEVBQUUsQ0FBQztRQUNwQixZQUFPLEdBQUcsYUFBVyxJQUFJLENBQUMsR0FBRyxFQUFFLENBQUMsV0FBVyxFQUFJLENBQUM7UUFDbkUsY0FBUyxHQUFvQixFQUFFLENBQUM7UUFDeEIsWUFBTyxHQUFHLEVBQUUsQ0FBQztRQTBDYixrQkFBYSxHQUFHLEtBQUssQ0FBQztRQUl0Qiw4QkFBeUIsR0FBRyxJQUFJLENBQUM7UUFFakMsZUFBVSxHQUFHO1lBQ2pCLFFBQVEsRUFBRSxrQkFBa0I7WUFDNUIsWUFBWSxFQUFFLHlCQUF5QjtZQUN2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QkFBbUI7cUJBQzdCO2lCQUNKOzs7O2dCQVpHLGtCQUFrQjtnQkFMNEQsVUFBVTtnQkFBckIsU0FBUztnQkFFdkUsWUFBWTs7O3lCQXVCaEIsTUFBTTt5QkFDTixNQUFNOzBCQUNOLE1BQU07MEJBQ04sV0FBVyxTQUFDLElBQUk7eUJBR2hCLEtBQUs7MEJBV0wsWUFBWSxTQUFDLE9BQU8sRUFBRSxDQUFDLFFBQVEsQ0FBQzt3QkFZaEMsWUFBWSxTQUFDLG9CQUFvQixFQUFFLENBQUMsUUFBUSxDQUFDO2dDQXFCN0MsU0FBUyxTQUFDLGFBQWE7O0lBcUk1QixrQ0FBQztDQUFBLEFBdE1ELElBc01DO1NBOUxZLDJCQUEyQjs7O0lBQ3BDLDZDQUEyQjs7SUFDM0IsOENBQWdCOztJQUNoQiw0Q0FBYzs7SUFDZCxpREFBb0I7O0lBQ3BCLHFEQUFtQzs7SUFDbkMsaURBQW1COztJQUNuQiw2Q0FBc0M7O0lBQ3RDLDZDQUFzQzs7SUFDdEMsOENBQXVDOztJQUN2Qyw4Q0FBbUU7O0lBQ25FLGdEQUFnQzs7Ozs7SUFDaEMsOENBQXFCOzs7OztJQTBDckIsb0RBQThCOzs7OztJQUc5QixvREFBNEQ7Ozs7O0lBQzVELGdFQUF5Qzs7Ozs7SUFDekMsK0NBQThCOzs7OztJQUM5QixpREFLQzs7SUFDRCw2Q0FBZTs7Ozs7SUFHWCx5Q0FBd0I7Ozs7O0lBQ3hCLGdEQUE0Qjs7Ozs7SUFDNUIsZ0RBQStCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBPbkluaXQsIElucHV0LCBDb250ZW50Q2hpbGQsIEV2ZW50RW1pdHRlciwgT3V0cHV0LCBSZW5kZXJlcjIsIEVsZW1lbnRSZWYsIEFmdGVyQ29udGVudEluaXQsIEFmdGVyVmlld0luaXQsIFZpZXdDaGlsZCwgU2ltcGxlQ2hhbmdlcywgT25DaGFuZ2VzLCBIb3N0QmluZGluZywgSG9zdExpc3RlbmVyLCBPbkRlc3Ryb3kgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgQW5ndWxhckRyYWdnYWJsZURpcmVjdGl2ZSB9IGZyb20gJ0BmYXJyaXMvdWktZHJhZ2dhYmxlJztcclxuaW1wb3J0IHsgRG9tU2FuaXRpemVyLCBTYWZlUmVzb3VyY2VVcmwgfSBmcm9tIFwiQGFuZ3VsYXIvcGxhdGZvcm0tYnJvd3NlclwiO1xyXG5pbXBvcnQge1xyXG4gICAgRkVQYWdlTW9kYWxDTEFTU19OQU1FLCBGUGFnZU1vZGFsRElTTUlTU19SRUFTT05TLFxyXG4gICAgRkVQYWdlTW9kYWxPcHRpb25zLCBGUGFnZU1vZGFsVFJBTlNJVElPTl9EVVJBVElPTlNcclxufSBmcm9tICcuL3BhZ2UtbW9kYWwtb3B0aW9ucy5jbGFzcyc7XHJcbmltcG9ydCB7IEZFUGFnZU1vZGFsU2VydmljZSB9IGZyb20gJy4vcGFnZS1tb2RhbC5zZXJ2aWNlJztcclxuXHJcblxyXG5AQ29tcG9uZW50KHtcclxuICAgIHNlbGVjdG9yOiAnZmUtcGFnZS1zaWRlYmFyJyxcclxuICAgIHRlbXBsYXRlVXJsOiAnLi9wYWdlLXNpZGViYXIuY29tcG9uZW50Lmh0bWwnLFxyXG4gICAgc3R5bGVVcmxzOiBbXSxcclxuICAgIGhvc3Q6IHtcclxuICAgICAgICBjbGFzczogJ2ZlLWNtcC1wYWdlLW1vZGFsJ1xyXG4gICAgfVxyXG59KVxyXG5leHBvcnQgY2xhc3MgRkVQYWdlTW9kYWxTaWRlYmFyQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBPbkRlc3Ryb3ksQWZ0ZXJDb250ZW50SW5pdCB7XHJcbiAgICBjb25maWc6IEZFUGFnZU1vZGFsT3B0aW9ucztcclxuICAgIGlzU2hvd24gPSBmYWxzZTtcclxuICAgIGxldmVsOiBudW1iZXI7XHJcbiAgICBpc0FuaW1hdGVkOiBib29sZWFuO1xyXG4gICAgYnNNb2RhbFNlcnZpY2U6IEZFUGFnZU1vZGFsU2VydmljZTtcclxuICAgIGRpYWxvZ1R5cGU6IHN0cmluZztcclxuICAgIEBPdXRwdXQoKSBjbG9zZWQgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcbiAgICBAT3V0cHV0KCkgb3BlbmVkID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG4gICAgQE91dHB1dCgpIHJlc2l6ZWQgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcbiAgICBASG9zdEJpbmRpbmcoJ2lkJykgbW9kYWxJRCA9IGBNT0RBTElEXyR7RGF0ZS5ub3coKS50b1ByZWNpc2lvbigpfWA7XHJcbiAgICBpZnJhbWVTcmM6IFNhZmVSZXNvdXJjZVVybCA9ICcnO1xyXG4gICAgcHJpdmF0ZSBfaWZyYW1lID0gJyc7XHJcbiAgICBASW5wdXQoKVxyXG4gICAgcHVibGljIHNldCBpZnJhbWUodmFsdWU6IHN0cmluZykge1xyXG4gICAgICAgIGlmICh0aGlzLnNhbml0aXplcikge1xyXG4gICAgICAgICAgICB0aGlzLl9pZnJhbWUgPSB2YWx1ZTtcclxuICAgICAgICAgICAgdGhpcy5pZnJhbWVTcmMgPSB0aGlzLnNhbml0aXplci5ieXBhc3NTZWN1cml0eVRydXN0UmVzb3VyY2VVcmwodmFsdWUpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHB1YmxpYyBnZXQgaWZyYW1lKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9pZnJhbWU7XHJcbiAgICB9XHJcblxyXG4gICAgQEhvc3RMaXN0ZW5lcignY2xpY2snLCBbJyRldmVudCddKVxyXG4gICAgb25DbGljayhldmVudDogTW91c2VFdmVudCkge1xyXG4gICAgICAgIGNvbnN0IHRhZyA9IGV2ZW50LnRhcmdldCBhcyBhbnk7XHJcbiAgICAgICAgaWYgKHRoaXMuY29uZmlnLmlnbm9yZUJhY2tkcm9wQ2xpY2sgfHwgdGhpcy5jb25maWcuYmFja2Ryb3AgPT09ICdzdGF0aWMnIHx8IGV2ZW50LnRhcmdldCAhPT0gdGhpcy5lbC5uYXRpdmVFbGVtZW50KSB7XHJcbiAgICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpOyAgXHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuYnNNb2RhbFNlcnZpY2Uuc2V0RGlzbWlzc1JlYXNvbihGUGFnZU1vZGFsRElTTUlTU19SRUFTT05TLkJBQ0tSRE9QKTtcclxuICAgICAgICB0aGlzLmNsb3NlKCk7XHJcbiAgICB9XHJcblxyXG4gICAgQEhvc3RMaXN0ZW5lcignd2luZG93OmtleWRvd24uZXNjJywgWyckZXZlbnQnXSlcclxuICAgIG9uRXNjKGV2ZW50OiBhbnkpOiB2b2lkIHtcclxuICAgICAgICBpZiAoIXRoaXMuaXNTaG93bikge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoZXZlbnQua2V5Q29kZSA9PT0gMjcpIHtcclxuICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChcclxuICAgICAgICAgICAgdGhpcy5jb25maWcua2V5Ym9hcmQgJiZcclxuICAgICAgICAgICAgdGhpcy5sZXZlbCA9PT0gdGhpcy5ic01vZGFsU2VydmljZS5nZXRNb2RhbHNDb3VudCgpXHJcbiAgICAgICAgKSB7XHJcbiAgICAgICAgICAgIHRoaXMuYnNNb2RhbFNlcnZpY2Uuc2V0RGlzbWlzc1JlYXNvbihGUGFnZU1vZGFsRElTTUlTU19SRUFTT05TLkVTQyk7XHJcbiAgICAgICAgICAgIHRoaXMuY2xvc2UoZXZlbnQpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHByaXZhdGUgaXNNb2RhbEhpZGluZyA9IGZhbHNlO1xyXG5cclxuICAgIC8vIOS+p+i+ueagj+aJgOeLrOaciVxyXG4gICAgQFZpZXdDaGlsZCgnc2lkZWJhck1haW4nKSBwcml2YXRlIHNpZGViYXJNYWluRWw6IEVsZW1lbnRSZWY7XHJcbiAgICBwcml2YXRlIGNhblJlbW92ZUluaXROb0FuaW1hdGVDbHMgPSB0cnVlO1xyXG4gICAgcHJpdmF0ZSBwYXJlbnRFbDogSFRNTEVsZW1lbnQ7XHJcbiAgICBwcml2YXRlIHNpZGViYXJDbHMgPSB7XHJcbiAgICAgICAgJ3BhcmVudCc6ICdmLXNpZGViYXItcGFyZW50JyxcclxuICAgICAgICAnb3BlblBhcmVudCc6ICdmLXNpZGViYXItcGFyZW50LWV4cGFuZCcsXHJcbiAgICAgICAgJ2Nsb3NlUGFyZW50JzogJ2Ytc2lkZWJhci1wYXJlbnQtY29sbGFwc2UnLFxyXG4gICAgICAgICdpbml0JzogJ2FuaW1hdGVkLW5vbmUnXHJcbiAgICB9XHJcbiAgICBpc09wZW4gPSBmYWxzZTtcclxuICAgIGNvbnN0cnVjdG9yKFxyXG4gICAgICAgIG9wdGlvbnM6IEZFUGFnZU1vZGFsT3B0aW9ucyxcclxuICAgICAgICBwcm90ZWN0ZWQgZWw6IEVsZW1lbnRSZWYsXHJcbiAgICAgICAgcHJpdmF0ZSBfcmVuZGVyZXI6IFJlbmRlcmVyMixcclxuICAgICAgICBwcml2YXRlIHNhbml0aXplcjogRG9tU2FuaXRpemVyKSB7XHJcbiAgICAgICAgdGhpcy5jb25maWcgPSBPYmplY3QuYXNzaWduKHt9LCBvcHRpb25zKTtcclxuICAgIH1cclxuXHJcbiAgICBuZ09uSW5pdCgpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLnBhcmVudEVsID0gdGhpcy5lbC5uYXRpdmVFbGVtZW50LnBhcmVudEVsZW1lbnQ7XHJcbiAgICAgICAgdGhpcy5fcmVuZGVyZXIuYWRkQ2xhc3ModGhpcy5wYXJlbnRFbCwgdGhpcy5zaWRlYmFyQ2xzLnBhcmVudCk7XHJcbiAgICAgICAgdGhpcy5yZW1vdmVOb25lQW5pbWF0ZUNscygpO1xyXG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLmlzU2hvd24gPSB0cnVlO1xyXG4gICAgICAgICAgICB0aGlzLmlzT3BlbiA9IHRydWU7XHJcbiAgICAgICAgICAgIC8vIHRoaXMuX3JlbmRlcmVyLmFkZENsYXNzKFxyXG4gICAgICAgICAgICAvLyAgICAgdGhpcy5lbC5uYXRpdmVFbGVtZW50LCBGRVBhZ2VNb2RhbENMQVNTX05BTUUuU0hPV1xyXG4gICAgICAgICAgICAvLyApO1xyXG4gICAgICAgICAgICAvLyBQYXJlbnRcclxuICAgICAgICAgICAgdGhpcy5fcmVuZGVyZXIucmVtb3ZlQ2xhc3ModGhpcy5wYXJlbnRFbCwgdGhpcy5zaWRlYmFyQ2xzLmNsb3NlUGFyZW50KTtcclxuICAgICAgICAgICAgdGhpcy5fcmVuZGVyZXIuYWRkQ2xhc3ModGhpcy5wYXJlbnRFbCwgdGhpcy5zaWRlYmFyQ2xzLm9wZW5QYXJlbnQpO1xyXG4gICAgICAgICAgICAvLyB0aGlzLl9yZW5kZXJlci5zZXRTdHlsZSh0aGlzLmVsLm5hdGl2ZUVsZW1lbnQsICdkaXNwbGF5JywgJ2Jsb2NrJyk7XHJcbiAgICAgICAgICAgIC8vIGlmICh0aGlzLmNvbmZpZy5maXRDb250ZW50ICYmIHRoaXMuZWwubmF0aXZlRWxlbWVudC5jbGFzc05hbWUuaW5kZXhPZignZi1tb2RhbC1maXRDb250ZW50LXNjcm9sbCcpID4gLTEpIHtcclxuICAgICAgICAgICAgLy8gICB0aGlzLmVsLm5hdGl2ZUVsZW1lbnQuc2Nyb2xsVG9wID0gMDtcclxuICAgICAgICAgICAgLy8gfVxyXG5cclxuICAgICAgICAgICAgLy8gaWYgKGRvY3VtZW50ICYmIGRvY3VtZW50LmJvZHkpIHtcclxuICAgICAgICAgICAgLy8gICAgIGNvbnN0IG1vZGFsTGVuID0gdGhpcy5ic01vZGFsU2VydmljZS5nZXRNb2RhbHNDb3VudCgpO1xyXG4gICAgICAgICAgICAvLyAgICAgaWYgKG1vZGFsTGVuID09PSAxKSB7XHJcbiAgICAgICAgICAgIC8vICAgICAgICAgdGhpcy5ic01vZGFsU2VydmljZS5jaGVja1Njcm9sbGJhcigpO1xyXG4gICAgICAgICAgICAvLyAgICAgICAgIHRoaXMuYnNNb2RhbFNlcnZpY2Uuc2V0U2Nyb2xsYmFyKCk7XHJcbiAgICAgICAgICAgIC8vICAgICB9XHJcbiAgICAgICAgICAgIC8vICAgICBpZiAoIWRvY3VtZW50LmJvZHkuY2xhc3NMaXN0LmNvbnRhaW5zKEZFUGFnZU1vZGFsQ0xBU1NfTkFNRS5PUEVOKSkge1xyXG4gICAgICAgICAgICAvLyAgICAgICAgIHRoaXMuX3JlbmRlcmVyLmFkZENsYXNzKGRvY3VtZW50LmJvZHksIEZFUGFnZU1vZGFsQ0xBU1NfTkFNRS5PUEVOKTtcclxuICAgICAgICAgICAgLy8gICAgIH1cclxuICAgICAgICAgICAgLy8gfVxyXG4gICAgICAgICAgICB0aGlzLm9wZW5lZC5lbWl0KHsgbW9kYWw6IHRoaXMgfSk7XHJcbiAgICAgICAgfSwgMCk7XHJcbiAgICAgICAgaWYgKHRoaXMuZWwubmF0aXZlRWxlbWVudCkge1xyXG4gICAgICAgICAgICB0aGlzLmVsLm5hdGl2ZUVsZW1lbnQuZm9jdXMoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgfVxyXG4gICAgbmdBZnRlckNvbnRlbnRJbml0KCkge1xyXG4gICAgfVxyXG4gICAgbmdPbkRlc3Ryb3koKTogdm9pZCB7XHJcbiAgICAgICAgaWYgKHRoaXMuaXNTaG93bikge1xyXG4gICAgICAgICAgICB0aGlzLmNsb3NlKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgaGFzSWZyYW1lKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9pZnJhbWUgIT0gJyc7XHJcbiAgICB9XHJcbiAgICBjbG9zZVNpZGVCYXIoKSB7XHJcbiAgICAgICAgLy8gdGhpcy5yZW1vdmVOb25lQW5pbWF0ZUNscygpO1xyXG4gICAgICAgIC8vIGlmICh0aGlzLmJlZm9yZUNsb3NlKSB7XHJcbiAgICAgICAgLy8gICAgIHRoaXMuYmVmb3JlQ2xvc2UoKS5zdWJzY3JpYmUoKGlzT3BlbjogYm9vbGVhbikgPT4ge1xyXG4gICAgICAgIC8vICAgICAgICAgdGhpcy5pc09wZW4gPSAhaXNPcGVuO1xyXG4gICAgICAgIC8vICAgICB9KVxyXG4gICAgICAgIC8vIH0gZWxzZSB7XHJcbiAgICAgICAgLy8gICAgIHRoaXMuaXNPcGVuID0gZmFsc2U7XHJcbiAgICAgICAgLy8gfVxyXG4gICAgICAgIHRoaXMuX3JlbmRlcmVyLnJlbW92ZUNsYXNzKHRoaXMucGFyZW50RWwsIHRoaXMuc2lkZWJhckNscy5vcGVuUGFyZW50KTtcclxuICAgICAgICB0aGlzLl9yZW5kZXJlci5hZGRDbGFzcyh0aGlzLnBhcmVudEVsLCB0aGlzLnNpZGViYXJDbHMuY2xvc2VQYXJlbnQpO1xyXG4gICAgfVxyXG4gICAgb3BlblNpZGVCYXIoKSB7XHJcbiAgICAgICAgdGhpcy5yZW1vdmVOb25lQW5pbWF0ZUNscygpO1xyXG4gICAgICAgIHRoaXMuaXNPcGVuID0gdHJ1ZTtcclxuICAgICAgICB0aGlzLl9yZW5kZXJlci5yZW1vdmVDbGFzcyh0aGlzLnBhcmVudEVsLCB0aGlzLnNpZGViYXJDbHMuY2xvc2VQYXJlbnQpO1xyXG4gICAgICAgIHRoaXMuX3JlbmRlcmVyLmFkZENsYXNzKHRoaXMucGFyZW50RWwsIHRoaXMuc2lkZWJhckNscy5vcGVuUGFyZW50KTtcclxuICAgIH1cclxuXHJcbiAgICAvKuS+p+i+ueagj+WIneWni+WboOS4uuWKqOeUu+aUtui1t+aXtu+8jOS8muiiq+eci+WIsCwg56e76ZmkICovXHJcbiAgICBwcml2YXRlIHJlbW92ZU5vbmVBbmltYXRlQ2xzKCkge1xyXG4gICAgICAgIGlmICghdGhpcy5jYW5SZW1vdmVJbml0Tm9BbmltYXRlQ2xzKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHRoaXMuc2lkZWJhck1haW5FbCkge1xyXG4gICAgICAgICAgICB0aGlzLl9yZW5kZXJlci5yZW1vdmVDbGFzcyh0aGlzLnNpZGViYXJNYWluRWwubmF0aXZlRWxlbWVudCwgdGhpcy5zaWRlYmFyQ2xzLmluaXQpO1xyXG4gICAgICAgICAgICB0aGlzLmNhblJlbW92ZUluaXROb0FuaW1hdGVDbHMgPSBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICAvLyDkvqfovrnmoI/lrr3luqborqHnrpdcclxuICAgIGdldFNpZGViYXJXaWR0aCgpIHtcclxuICAgICAgICBpZiAodHlwZW9mIHRoaXMuY29uZmlnWyd3aWR0aCddID09ICdzdHJpbmcnKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmNvbmZpZ1snd2lkdGgnXTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5jb25maWdbJ3dpZHRoJ10gKyAncHgnO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICB9XHJcbiAgICAvLyDlv4XpobvluKbnmoTmlrnms5VcclxuICAgIGNsb3NlKGU/OiBNb3VzZUV2ZW50LCBpc0Nsb3NlQnV0dG9uID0gZmFsc2UpOiB2b2lkIHtcclxuICAgICAgICBpZiAoZSkge1xyXG4gICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGhpcy5pc01vZGFsSGlkaW5nIHx8ICF0aGlzLmlzU2hvd24pIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5jb25maWcuYmVmb3JlQ2xvc2UodGhpcykuc3Vic2NyaWJlKHIgPT4ge1xyXG4gICAgICAgICAgICBpZiAoIXIpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvL+WKqOeUu+e7k+adn+aJp+ihjOWFtuS7luaTjeS9nFxyXG4gICAgICAgICAgICB0aGlzLnNpZGViYXJNYWluRWwubmF0aXZlRWxlbWVudC5wYXJlbnRFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ3RyYW5zaXRpb25lbmQnLCAoZTogYW55KSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmJzTW9kYWxTZXJ2aWNlLmhpZGUodGhpcy5sZXZlbCk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmlzTW9kYWxIaWRpbmcgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmNvbmZpZy5jbG9zZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbmZpZy5jbG9zZWQoaXNDbG9zZUJ1dHRvbik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNsb3NlZC5lbWl0KHRoaXMubGV2ZWwpO1xyXG4gICAgICAgICAgICB9LCBmYWxzZSk7XHJcbiAgICAgICAgICAgIHRoaXMuaXNNb2RhbEhpZGluZyA9IHRydWU7XHJcbiAgICAgICAgICAgIHRoaXMuaXNTaG93biA9IGZhbHNlO1xyXG4gICAgICAgICAgICB0aGlzLl9yZW5kZXJlci5yZW1vdmVDbGFzcyh0aGlzLnBhcmVudEVsLCB0aGlzLnNpZGViYXJDbHMub3BlblBhcmVudCk7XHJcbiAgICAgICAgICAgIHRoaXMuX3JlbmRlcmVyLmFkZENsYXNzKHRoaXMucGFyZW50RWwsIHRoaXMuc2lkZWJhckNscy5jbG9zZVBhcmVudCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICB0b0NlbnRlcigpIHtcclxuXHJcbiAgICB9XHJcblxyXG59XHJcbiJdfQ==
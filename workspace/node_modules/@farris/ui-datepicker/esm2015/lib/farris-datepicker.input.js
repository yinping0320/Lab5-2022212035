/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Directive, Input, ElementRef, ViewContainerRef, Renderer2, ChangeDetectorRef, ComponentFactoryResolver, forwardRef, EventEmitter, Output, HostListener, NgZone } from '@angular/core';
import { NG_VALIDATORS, NG_VALUE_ACCESSOR } from '@angular/forms';
import { CalendarComponent } from './components/calendar/calendar.component';
import { UtilService, DatepickerLocaleService, DefaultConfigService } from './services/public-api';
import { KeyCode, CalToggle, Year, ResetDateType } from './enums/public-api';
import { KEYUP, BLUR, EMPTY_STR, DISABLED, CLICK, VALUE, OPTIONS, DEFAULT_MONTH, LOCALE, OBJECT, PX } from './constants/constants';
/** @type {?} */
const NGX_DP_VALUE_ACCESSOR = {
    provide: NG_VALUE_ACCESSOR,
    useExisting: forwardRef((/**
     * @return {?}
     */
    () => FarrisDatePickerDirective)),
    multi: true
};
/** @type {?} */
const NGX_DP_VALIDATORS = {
    provide: NG_VALIDATORS,
    useExisting: forwardRef((/**
     * @return {?}
     */
    () => FarrisDatePickerDirective)),
    multi: true
};
export class FarrisDatePickerDirective {
    /**
     * @param {?} localeService
     * @param {?} utilService
     * @param {?} vcRef
     * @param {?} cfr
     * @param {?} renderer
     * @param {?} cdr
     * @param {?} elem
     * @param {?} config
     * @param {?} zone
     */
    constructor(localeService, utilService, vcRef, cfr, renderer, cdr, elem, config, zone) {
        this.localeService = localeService;
        this.utilService = utilService;
        this.vcRef = vcRef;
        this.cfr = cfr;
        this.renderer = renderer;
        this.cdr = cdr;
        this.elem = elem;
        this.config = config;
        this.zone = zone;
        this.dateChanged = new EventEmitter();
        this.inputFieldChanged = new EventEmitter();
        this.calendarViewChanged = new EventEmitter();
        this.calendarToggle = new EventEmitter();
        this.rangeDateSelection = new EventEmitter();
        this.cRef = null;
        this.inputText = '';
        this.preventClose = false;
        this.disabled = false;
        // scrollFn: any = (e) => {
        //     console.log((e.target as any).scrollTop);
        // };
        this.onChangeCb = (/**
         * @return {?}
         */
        () => { });
        this.onTouchedCb = (/**
         * @return {?}
         */
        () => { });
        // wrapper with arrow function to preserve the use of 'this' word
        this.onClickWrapper = (/**
         * @param {?} ev
         * @return {?}
         */
        (ev) => {
            this.onClick(ev);
        });
        this.opts = this.config.getDefaultConfig();
        this.parseOptions(this.opts);
    }
    /**
     * @param {?} event
     * @return {?}
     */
    onKeyUp(event) {
        /** @type {?} */
        const keyCode = this.utilService.getKeyCodeFromEvent(event);
        if (this.ignoreKeyPress(keyCode)) {
            return;
        }
        else if (keyCode === KeyCode.esc) {
            this.closeSelector(CalToggle.CloseByEsc);
        }
        else {
            const { value } = this.elem.nativeElement;
            /** @type {?} */
            let valid = false;
            if (!this.opts.dateRange) {
                /** @type {?} */
                const date = this.utilService.isDateValid(value, this.opts);
                valid = this.utilService.isInitializedDate(date);
            }
            else {
                const { begin, end } = this.utilService.isDateValidDateRange(value, this.opts);
                valid =
                    this.utilService.isInitializedDate(begin) &&
                        this.utilService.isInitializedDate(end);
            }
            this.emitInputFieldChanged(value, valid);
        }
    }
    /**
     * @return {?}
     */
    onBlur() {
        const { inputFieldValidation, dateRange } = this.opts;
        if (inputFieldValidation) {
            const { value } = this.elem.nativeElement;
            /** @type {?} */
            let valid = false;
            if (!dateRange) {
                /** @type {?} */
                const date = this.utilService.isDateValid(value, this.opts);
                valid = this.utilService.isInitializedDate(date);
            }
            else {
                /** @type {?} */
                const _dateRange = this.utilService.isDateValidDateRange(value, this.opts);
                const { begin, end } = _dateRange;
                valid =
                    this.utilService.isInitializedDate(begin) &&
                        this.utilService.isInitializedDate(end);
            }
            if (!valid && this.inputText !== value) {
                this.clearDate();
            }
            this.onChangeCb(value);
        }
        this.onTouchedCb();
    }
    /**
     * @param {?} evt
     * @return {?}
     */
    onClick(evt) {
        if (this.opts.closeSelectorOnDocumentClick &&
            !this.preventClose &&
            evt.target &&
            this.cRef !== null &&
            this.elem.nativeElement !== evt.target &&
            !this.cRef.location.nativeElement.contains(evt.target) &&
            !this.disabled) {
            this.closeSelector(CalToggle.CloseByOutClick);
        }
    }
    /**
     * @param {?} changes
     * @return {?}
     */
    ngOnChanges(changes) {
        if (changes.hasOwnProperty(LOCALE)) {
            this.setLocaleOptions();
        }
        if (changes.hasOwnProperty(DEFAULT_MONTH)) {
            /** @type {?} */
            let dm = changes[DEFAULT_MONTH].currentValue;
            if (typeof dm === OBJECT) {
                dm = dm.defMonth;
            }
            this.defaultMonth = dm;
        }
        if (changes.hasOwnProperty(OPTIONS)) {
            this.parseOptions(changes[OPTIONS].currentValue);
        }
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        this.closeCalendar();
    }
    /**
     * @return {?}
     */
    setLocaleOptions() {
        /** @type {?} */
        const opts = this.localeService.getLocaleOptions(this.locale);
        Object.keys(opts).forEach((/**
         * @param {?} k
         * @return {?}
         */
        k => {
            ((/** @type {?} */ (this.opts)))[k] = opts[k];
        }));
    }
    /**
     * @param {?} opts
     * @return {?}
     */
    parseOptions(opts) {
        if (opts !== undefined) {
            Object.keys(opts).forEach((/**
             * @param {?} k
             * @return {?}
             */
            k => {
                if (opts[k] !== undefined && opts[k] !== '') {
                    ((/** @type {?} */ (this.opts)))[k] = opts[k];
                }
            }));
        }
        if (this.opts.minYear < Year.min) {
            this.opts.minYear = Year.min;
        }
        if (this.opts.maxYear > Year.max) {
            this.opts.maxYear = Year.max;
        }
    }
    /**
     * @param {?} value
     * @return {?}
     */
    formatDate(value) {
        const { dateRange, dateFormat, monthLabels, dateRangeDatesDelimiter, returnFormat } = this.opts;
        if (!dateRange) {
            // Single date mode
            /** @type {?} */
            const date = this.utilService.isDateValid(value, this.opts);
            return this.utilService.getDateModel(date, null, dateFormat, monthLabels, dateRangeDatesDelimiter, returnFormat);
        }
        else {
            // Date range mode
            /** @type {?} */
            const _dateRange = this.utilService.isDateValidDateRange(value, this.opts);
            return this.utilService.getDateModel(null, _dateRange, dateFormat, monthLabels, dateRangeDatesDelimiter, returnFormat);
        }
    }
    /**
     * @param {?} value
     * @return {?}
     */
    writeValue(value) {
        if (this.disabled) {
            return;
        }
        if (value) {
            value = this.formatDate(value);
        }
        if (!value) {
            this.setInputValue(EMPTY_STR);
            this.emitInputFieldChanged(EMPTY_STR, false);
            if (this.cRef !== null) {
                this.cRef.instance.resetDateValue(ResetDateType.both);
            }
        }
        else if (value.isRange === false && value.singleDate) {
            // single date
            const { date, formatted } = value.singleDate;
            /** @type {?} */
            const valid = this.utilService.isInitializedDate(date);
            if (valid) {
                this.setInputValue(formatted);
                this.emitInputFieldChanged(formatted, valid);
                if (this.cRef !== null) {
                    this.cRef.instance.resetDateValue(ResetDateType.dateRange);
                }
            }
        }
        else if (value.isRange === true && value.dateRange) {
            // date range
            const { beginDate, endDate, formatted } = value.dateRange;
            if (beginDate && endDate) {
                /** @type {?} */
                const valid = this.utilService.isInitializedDate(beginDate) &&
                    this.utilService.isInitializedDate(endDate);
                if (valid) {
                    this.setInputValue(formatted);
                    this.emitInputFieldChanged(formatted, valid);
                    if (this.cRef !== null) {
                        this.cRef.instance.resetDateValue(ResetDateType.singleDate);
                    }
                }
            }
        }
    }
    /**
     * @param {?} fn
     * @return {?}
     */
    registerOnChange(fn) {
        this.onChangeCb = fn;
    }
    /**
     * @param {?} fn
     * @return {?}
     */
    registerOnTouched(fn) {
        this.onTouchedCb = fn;
    }
    /**
     * @param {?} isDisabled
     * @return {?}
     */
    setDisabledState(isDisabled) {
        this.disabled = isDisabled;
        this.renderer.setProperty(this.elem.nativeElement, DISABLED, isDisabled);
        if (isDisabled) {
            this.closeCalendar();
        }
    }
    /**
     * @param {?} c
     * @return {?}
     */
    validate(c) {
        return null;
    }
    /**
     * @return {?}
     */
    openCalendar() {
        if (this.disabled) {
            return;
        }
        this.preventClose = true;
        this.cdr.detectChanges();
        if (this.cRef === null) {
            this.cRef = this.vcRef.createComponent(this.cfr.resolveComponentFactory(CalendarComponent));
            this.appendSelector(this.cRef.location.nativeElement);
            this.cRef.instance.initialize(this.opts, this.defaultMonth, this.getSelectorPosition(this.elem.nativeElement), this.elem.nativeElement.value, (/**
             * @param {?} dm
             * @param {?} close
             * @return {?}
             */
            (dm, close) => {
                this.focusToInput();
                this.updateModel(dm);
                if (close) {
                    this.closeSelector(CalToggle.CloseByDateSel);
                }
                this.emitDateChanged(dm);
                this.emitInputFieldChanged(this.utilService.getFormattedDate(dm), true);
            }), (/**
             * @param {?} cvc
             * @return {?}
             */
            (cvc) => {
                this.emitCalendarChanged(cvc);
            }), (/**
             * @param {?} rds
             * @return {?}
             */
            (rds) => {
                this.emitRangeDateSelection(rds);
            }), (/**
             * @return {?}
             */
            () => {
                this.closeSelector(CalToggle.CloseByEsc);
            }));
            this.emitCalendarToggle(CalToggle.Open);
            this.cdr.detectChanges();
        }
        else {
            this.appendSelector(this.cRef.location.nativeElement);
        }
        this.preventClose = false;
    }
    /**
     * @return {?}
     */
    closeCalendar() {
        this.closeSelector(CalToggle.CloseByCalBtn);
    }
    /**
     * @param {?} event
     * @return {?}
     */
    toggleCalendar(event) {
        event.stopPropagation();
        if (this.disabled) {
            return;
        }
        if (this.cRef === null) {
            document.addEventListener(CLICK, this.onClickWrapper, true);
            this.openCalendar();
            /** @type {?} */
            const container = document.querySelector('.date-overlay-container');
            this.renderer.setStyle(container, 'pointer-events', 'auto');
        }
        else {
            /** @type {?} */
            let flag = true;
            /** @type {?} */
            const container = document.querySelector('.date-overlay-container');
            if (container && this.cRef.location) {
                if (container.hasChildNodes()) {
                    container.childNodes.forEach((/**
                     * @param {?} el
                     * @return {?}
                     */
                    el => {
                        if (el === this.cRef.location.nativeElement) {
                            flag = false;
                        }
                    }));
                }
            }
            if (flag) {
                this.renderer.setStyle(container, 'pointer-events', 'auto');
                this.openCalendar();
            }
            else {
                document.removeEventListener(CLICK, this.onClickWrapper);
                this.closeSelector(CalToggle.CloseByCalBtn);
                this.renderer.setStyle(container, 'pointer-events', '');
            }
        }
    }
    /**
     * @return {?}
     */
    clearDate() {
        if (this.disabled) {
            return;
        }
        this.setInputValue(EMPTY_STR);
        this.emitDateChanged({
            isRange: this.opts.dateRange,
            singleDate: {
                date: this.utilService.resetDate(),
                jsDate: null,
                formatted: EMPTY_STR,
                epoc: 0
            },
            dateRange: {
                beginDate: this.utilService.resetDate(),
                beginJsDate: null,
                beginEpoc: 0,
                endDate: this.utilService.resetDate(),
                endJsDate: null,
                endEpoc: 0,
                formatted: EMPTY_STR
            }
        });
        this.onChangeCb(null);
        this.onTouchedCb();
        this.closeSelector(CalToggle.CloseByCalBtn);
    }
    /**
     * @return {?}
     */
    isDateValid() {
        const { value } = this.elem.nativeElement;
        if (value !== EMPTY_STR) {
            /** @type {?} */
            const date = this.utilService.isDateValid(value, this.opts);
            if (this.utilService.isInitializedDate(date)) {
                this.emitInputFieldChanged(value, true);
                return true;
            }
        }
        this.emitInputFieldChanged(value, false);
        return false;
    }
    /**
     * @private
     * @param {?} keyCode
     * @return {?}
     */
    ignoreKeyPress(keyCode) {
        // keyCode === KeyCode.tab ||
        return (keyCode === KeyCode.leftArrow ||
            keyCode === KeyCode.rightArrow ||
            keyCode === KeyCode.upArrow ||
            keyCode === KeyCode.downArrow ||
            keyCode === KeyCode.shift);
    }
    /**
     * @private
     * @param {?} reason
     * @return {?}
     */
    closeSelector(reason) {
        if (this.cRef !== null) {
            this.vcRef.remove(this.vcRef.indexOf(this.cRef.hostView));
            this.cRef = null;
            this.cdr.detectChanges();
            this.emitCalendarToggle(reason);
            /** @type {?} */
            const container = document.querySelector('.date-overlay-container');
            this.renderer.setStyle(container, 'pointer-events', '');
        }
    }
    /**
     * @private
     * @param {?} model
     * @return {?}
     */
    updateModel(model) {
        this.setInputValue(this.utilService.getFormattedDate(model));
        this.onChangeCb(this.utilService.getFormattedDate(model));
        this.onTouchedCb();
    }
    /**
     * @private
     * @param {?} value
     * @return {?}
     */
    setInputValue(value) {
        this.inputText = value;
        this.renderer.setProperty(this.elem.nativeElement, VALUE, value);
    }
    /**
     * @private
     * @return {?}
     */
    focusToInput() {
        if (this.opts.focusInputOnDateSelect) {
            this.elem.nativeElement.focus();
        }
    }
    /**
     * @private
     * @param {?} dateModel
     * @return {?}
     */
    emitDateChanged(dateModel) {
        this.dateChanged.emit(dateModel);
    }
    /**
     * @private
     * @param {?} value
     * @param {?} valid
     * @return {?}
     */
    emitInputFieldChanged(value, valid) {
        this.inputFieldChanged.emit({
            value,
            dateFormat: this.opts.dateFormat,
            valid
        });
    }
    /**
     * @private
     * @param {?} cvc
     * @return {?}
     */
    emitCalendarChanged(cvc) {
        this.calendarViewChanged.emit(cvc);
    }
    /**
     * @private
     * @param {?} rds
     * @return {?}
     */
    emitRangeDateSelection(rds) {
        this.rangeDateSelection.emit(rds);
    }
    /**
     * @private
     * @param {?} reason
     * @return {?}
     */
    emitCalendarToggle(reason) {
        this.calendarToggle.emit(reason);
    }
    /**
     * @private
     * @param {?} date
     * @return {?}
     */
    jsDateToMyDate(date) {
        return {
            year: date.getFullYear(),
            month: date.getMonth() + 1,
            day: date.getDate()
        };
    }
    /**
     * @private
     * @param {?} elem
     * @return {?}
     */
    appendSelector(elem) {
        /** @type {?} */
        let container = document.querySelector('.date-overlay-container');
        if (container) {
            if (container.hasChildNodes()) {
                container.childNodes.forEach((/**
                 * @param {?} el
                 * @return {?}
                 */
                el => {
                    if (el !== elem) {
                        container.removeChild(el);
                    }
                }));
            }
        }
        else {
            container = document.createElement('div');
            container.classList.add('date-overlay-container');
            container.classList.add('overlay-container');
            document.body.appendChild(container);
        }
        container.appendChild(elem);
    }
    /**
     * @private
     * @param {?} elem
     * @return {?}
     */
    getSelectorPosition(elem) {
        /** @type {?} */
        let top = 0;
        /** @type {?} */
        let left = 0;
        /** @type {?} */
        let _selectorHeight = 0;
        /** @type {?} */
        let _selectorWidth = 0;
        const { selectorHeight, selectorWidth, showTime, dateRange } = this.opts;
        /** @type {?} */
        const b = document.body.getBoundingClientRect();
        /** @type {?} */
        const e = elem.getBoundingClientRect();
        top = e.top - b.top;
        left = e.left - b.left;
        /** @type {?} */
        let position = 'bottom';
        if (dateRange) {
            _selectorWidth = this.getSelectorDimension(selectorWidth) * 2;
        }
        else {
            _selectorWidth = this.getSelectorDimension(selectorWidth);
        }
        if (showTime) {
            _selectorHeight = this.getSelectorDimension(selectorHeight) + 36;
        }
        else {
            _selectorHeight = this.getSelectorDimension(selectorHeight);
        }
        if (top + elem.offsetHeight + _selectorHeight > window.innerHeight && top - _selectorHeight - 2 > 0) {
            top = top - _selectorHeight - 2;
            position = 'top';
        }
        else {
            top = top + elem.offsetHeight + 2;
        }
        if (left + _selectorWidth > b.width) {
            left = b.width - _selectorWidth - 15;
        }
        left = left > 0 ? left : 0;
        return { top, left, position };
    }
    /**
     * @private
     * @param {?} value
     * @return {?}
     */
    getSelectorDimension(value) {
        return Number(value.replace(PX, EMPTY_STR));
    }
}
FarrisDatePickerDirective.decorators = [
    { type: Directive, args: [{
                selector: '[farris-datepicker]',
                exportAs: 'farris-datepicker',
                providers: [
                    UtilService,
                    DatepickerLocaleService,
                    DefaultConfigService,
                    NGX_DP_VALUE_ACCESSOR,
                    NGX_DP_VALIDATORS
                ]
            },] }
];
/** @nocollapse */
FarrisDatePickerDirective.ctorParameters = () => [
    { type: DatepickerLocaleService },
    { type: UtilService },
    { type: ViewContainerRef },
    { type: ComponentFactoryResolver },
    { type: Renderer2 },
    { type: ChangeDetectorRef },
    { type: ElementRef },
    { type: DefaultConfigService },
    { type: NgZone }
];
FarrisDatePickerDirective.propDecorators = {
    options: [{ type: Input }],
    locale: [{ type: Input }],
    defaultMonth: [{ type: Input }],
    dateChanged: [{ type: Output }],
    inputFieldChanged: [{ type: Output }],
    calendarViewChanged: [{ type: Output }],
    calendarToggle: [{ type: Output }],
    rangeDateSelection: [{ type: Output }],
    onKeyUp: [{ type: HostListener, args: [KEYUP, ['$event'],] }],
    onBlur: [{ type: HostListener, args: [BLUR,] }]
};
if (false) {
    /** @type {?} */
    FarrisDatePickerDirective.prototype.options;
    /** @type {?} */
    FarrisDatePickerDirective.prototype.locale;
    /** @type {?} */
    FarrisDatePickerDirective.prototype.defaultMonth;
    /** @type {?} */
    FarrisDatePickerDirective.prototype.dateChanged;
    /** @type {?} */
    FarrisDatePickerDirective.prototype.inputFieldChanged;
    /** @type {?} */
    FarrisDatePickerDirective.prototype.calendarViewChanged;
    /** @type {?} */
    FarrisDatePickerDirective.prototype.calendarToggle;
    /** @type {?} */
    FarrisDatePickerDirective.prototype.rangeDateSelection;
    /**
     * @type {?}
     * @private
     */
    FarrisDatePickerDirective.prototype.cRef;
    /**
     * @type {?}
     * @private
     */
    FarrisDatePickerDirective.prototype.inputText;
    /**
     * @type {?}
     * @private
     */
    FarrisDatePickerDirective.prototype.preventClose;
    /**
     * @type {?}
     * @private
     */
    FarrisDatePickerDirective.prototype.disabled;
    /**
     * @type {?}
     * @private
     */
    FarrisDatePickerDirective.prototype.opts;
    /** @type {?} */
    FarrisDatePickerDirective.prototype.onChangeCb;
    /** @type {?} */
    FarrisDatePickerDirective.prototype.onTouchedCb;
    /**
     * @type {?}
     * @private
     */
    FarrisDatePickerDirective.prototype.onClickWrapper;
    /** @type {?} */
    FarrisDatePickerDirective.prototype.localeService;
    /**
     * @type {?}
     * @private
     */
    FarrisDatePickerDirective.prototype.utilService;
    /**
     * @type {?}
     * @private
     */
    FarrisDatePickerDirective.prototype.vcRef;
    /**
     * @type {?}
     * @private
     */
    FarrisDatePickerDirective.prototype.cfr;
    /**
     * @type {?}
     * @private
     */
    FarrisDatePickerDirective.prototype.renderer;
    /**
     * @type {?}
     * @private
     */
    FarrisDatePickerDirective.prototype.cdr;
    /**
     * @type {?}
     * @private
     */
    FarrisDatePickerDirective.prototype.elem;
    /**
     * @type {?}
     * @private
     */
    FarrisDatePickerDirective.prototype.config;
    /**
     * @type {?}
     * @private
     */
    FarrisDatePickerDirective.prototype.zone;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmFycmlzLWRhdGVwaWNrZXIuaW5wdXQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL3VpLWRhdGVwaWNrZXIvIiwic291cmNlcyI6WyJsaWIvZmFycmlzLWRhdGVwaWNrZXIuaW5wdXQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFDSCxTQUFTLEVBQ1QsS0FBSyxFQUVMLFVBQVUsRUFDVixnQkFBZ0IsRUFDaEIsU0FBUyxFQUNULGlCQUFpQixFQUNqQix3QkFBd0IsRUFDeEIsVUFBVSxFQUNWLFlBQVksRUFDWixNQUFNLEVBR04sWUFBWSxFQUVaLE1BQU0sRUFDVCxNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBR0gsYUFBYSxFQUNiLGlCQUFpQixFQUVwQixNQUFNLGdCQUFnQixDQUFDO0FBQ3hCLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLDBDQUEwQyxDQUFDO0FBYTdFLE9BQU8sRUFDSCxXQUFXLEVBQ1gsdUJBQXVCLEVBQ3ZCLG9CQUFvQixFQUN2QixNQUFNLHVCQUF1QixDQUFDO0FBRS9CLE9BQU8sRUFBRSxPQUFPLEVBQUUsU0FBUyxFQUFFLElBQUksRUFBRSxhQUFhLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQztBQUU3RSxPQUFPLEVBQ0gsS0FBSyxFQUNMLElBQUksRUFDSixTQUFTLEVBQ1QsUUFBUSxFQUNSLEtBQUssRUFFTCxLQUFLLEVBQ0wsT0FBTyxFQUNQLGFBQWEsRUFDYixNQUFNLEVBQ04sTUFBTSxFQUNOLEVBQUUsRUFDTCxNQUFNLHVCQUF1QixDQUFDOztNQUV6QixxQkFBcUIsR0FBRztJQUMxQixPQUFPLEVBQUUsaUJBQWlCO0lBQzFCLFdBQVcsRUFBRSxVQUFVOzs7SUFBQyxHQUFHLEVBQUUsQ0FBQyx5QkFBeUIsRUFBQztJQUN4RCxLQUFLLEVBQUUsSUFBSTtDQUNkOztNQUVLLGlCQUFpQixHQUFHO0lBQ3RCLE9BQU8sRUFBRSxhQUFhO0lBQ3RCLFdBQVcsRUFBRSxVQUFVOzs7SUFBQyxH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SUE1RWxCLDRDQUE2Qjs7SUFDN0IsMkNBQXdCOztJQUN4QixpREFBOEI7O0lBRTlCLGdEQUVJOztJQUNKLHNEQUU2Qzs7SUFDN0Msd0RBRStDOztJQUMvQyxtREFBNEU7O0lBQzVFLHVEQUU4Qzs7Ozs7SUFFOUMseUNBQXFEOzs7OztJQUNyRCw4Q0FBdUI7Ozs7O0lBQ3ZCLGlEQUE2Qjs7Ozs7SUFDN0IsNkNBQXlCOzs7OztJQUV6Qix5Q0FBeUI7O0lBTXpCLCtDQUF3Qzs7SUFDeEMsZ0RBQW1DOzs7OztJQWtGbkMsbURBRUM7O0lBakZHLGtEQUE2Qzs7Ozs7SUFDN0MsZ0RBQWdDOzs7OztJQUNoQywwQ0FBK0I7Ozs7O0lBQy9CLHdDQUFxQzs7Ozs7SUFDckMsNkNBQTJCOzs7OztJQUMzQix3Q0FBOEI7Ozs7O0lBQzlCLHlDQUF3Qjs7Ozs7SUFDeEIsMkNBQW9DOzs7OztJQUNwQyx5Q0FBb0IiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xyXG4gICAgRGlyZWN0aXZlLFxyXG4gICAgSW5wdXQsXHJcbiAgICBDb21wb25lbnRSZWYsXHJcbiAgICBFbGVtZW50UmVmLFxyXG4gICAgVmlld0NvbnRhaW5lclJlZixcclxuICAgIFJlbmRlcmVyMixcclxuICAgIENoYW5nZURldGVjdG9yUmVmLFxyXG4gICAgQ29tcG9uZW50RmFjdG9yeVJlc29sdmVyLFxyXG4gICAgZm9yd2FyZFJlZixcclxuICAgIEV2ZW50RW1pdHRlcixcclxuICAgIE91dHB1dCxcclxuICAgIFNpbXBsZUNoYW5nZXMsXHJcbiAgICBPbkNoYW5nZXMsXHJcbiAgICBIb3N0TGlzdGVuZXIsXHJcbiAgICBPbkRlc3Ryb3ksXHJcbiAgICBOZ1pvbmVcclxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHtcclxuICAgIEFic3RyYWN0Q29udHJvbCxcclxuICAgIENvbnRyb2xWYWx1ZUFjY2Vzc29yLFxyXG4gICAgTkdfVkFMSURBVE9SUyxcclxuICAgIE5HX1ZBTFVFX0FDQ0VTU09SLFxyXG4gICAgVmFsaWRhdG9yXHJcbn0gZnJvbSAnQGFuZ3VsYXIvZm9ybXMnO1xyXG5pbXBvcnQgeyBDYWxlbmRhckNvbXBvbmVudCB9IGZyb20gJy4vY29tcG9uZW50cy9jYWxlbmRhci9jYWxlbmRhci5jb21wb25lbnQnO1xyXG5cclxuaW1wb3J0IHtcclxuICAgIElNeU9wdGlvbnMsXHJcbiAgICBJTXlEYXRlLFxyXG4gICAgSU15RGF0ZU1vZGVsLFxyXG4gICAgSU15RGF0ZVJhbmdlLFxyXG4gICAgSU15UmFuZ2VEYXRlU2VsZWN0aW9uLFxyXG4gICAgSU15Q2FsZW5kYXJWaWV3Q2hhbmdlZCxcclxuICAgIElNeUlucHV0RmllbGRDaGFuZ2VkLFxyXG4gICAgSU15U2VsZWN0b3JQb3NpdGlvblxyXG59IGZyb20gJy4vaW50ZXJmYWNlcy9wdWJsaWMtYXBpJztcclxuXHJcbmltcG9ydCB7XHJcbiAgICBVdGlsU2VydmljZSxcclxuICAgIERhdGVwaWNrZXJMb2NhbGVTZXJ2aWNlLFxyXG4gICAgRGVmYXVsdENvbmZpZ1NlcnZpY2VcclxufSBmcm9tICcuL3NlcnZpY2VzL3B1YmxpYy1hcGknO1xyXG5cclxuaW1wb3J0IHsgS2V5Q29kZSwgQ2FsVG9nZ2xlLCBZZWFyLCBSZXNldERhdGVUeXBlIH0gZnJvbSAnLi9lbnVtcy9wdWJsaWMtYXBpJztcclxuXHJcbmltcG9ydCB7XHJcbiAgICBLRVlVUCxcclxuICAgIEJMVVIsXHJcbiAgICBFTVBUWV9TVFIsXHJcbiAgICBESVNBQkxFRCxcclxuICAgIENMSUNLLFxyXG4gICAgQk9EWSxcclxuICAgIFZBTFVFLFxyXG4gICAgT1BUSU9OUyxcclxuICAgIERFRkFVTFRfTU9OVEgsXHJcbiAgICBMT0NBTEUsXHJcbiAgICBPQkpFQ1QsXHJcbiAgICBQWFxyXG59IGZyb20gJy4vY29uc3RhbnRzL2NvbnN0YW50cyc7XHJcblxyXG5jb25zdCBOR1hfRFBfVkFMVUVfQUNDRVNTT1IgPSB7XHJcbiAgICBwcm92aWRlOiBOR19WQUxVRV9BQ0NFU1NPUixcclxuICAgIHVzZUV4aXN0aW5nOiBmb3J3YXJkUmVmKCgpID0+IEZhcnJpc0RhdGVQaWNrZXJEaXJlY3RpdmUpLFxyXG4gICAgbXVsdGk6IHRydWVcclxufTtcclxuXHJcbmNvbnN0IE5HWF9EUF9WQUxJREFUT1JTID0ge1xyXG4gICAgcHJvdmlkZTogTkdfVkFMSURBVE9SUyxcclxuICAgIHVzZUV4aXN0aW5nOiBmb3J3YXJkUmVmKCgpID0+IEZhcnJpc0RhdGVQaWNrZXJEaXJlY3RpdmUpLFxyXG4gICAgbXVsdGk6IHRydWVcclxufTtcclxuXHJcbkBEaXJlY3RpdmUoe1xyXG4gICAgc2VsZWN0b3I6ICdbZmFycmlzLWRhdGVwaWNrZXJdJyxcclxuICAgIGV4cG9ydEFzOiAnZmFycmlzLWRhdGVwaWNrZXInLFxyXG4gICAgcHJvdmlkZXJzOiBbXHJcbiAgICAgICAgVXRpbFNlcnZpY2UsXHJcbiAgICAgICAgRGF0ZXBpY2tlckxvY2FsZVNlcnZpY2UsXHJcbiAgICAgICAgRGVmYXVsdENvbmZpZ1NlcnZpY2UsXHJcbiAgICAgICAgTkdYX0RQX1ZBTFVFX0FDQ0VTU09SLFxyXG4gICAgICAgIE5HWF9EUF9WQUxJREFUT1JTXHJcbiAgICBdXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBGYXJyaXNEYXRlUGlja2VyRGlyZWN0aXZlXHJcbiAgICBpbXBsZW1lbnRzIE9uQ2hhbmdlcywgT25EZXN0cm95LCBDb250cm9sVmFsdWVBY2Nlc3NvciwgVmFsaWRhdG9yIHtcclxuICAgIEBJbnB1dCgpIG9wdGlvbnM6IElNeU9wdGlvbnM7XHJcbiAgICBASW5wdXQoKSBsb2NhbGU6IHN0cmluZztcclxuICAgIEBJbnB1dCgpIGRlZmF1bHRNb250aDogc3RyaW5nO1xyXG5cclxuICAgIEBPdXRwdXQoKSBkYXRlQ2hhbmdlZDogRXZlbnRFbWl0dGVyPElNeURhdGVNb2RlbD4gPSBuZXcgRXZlbnRFbWl0dGVyPFxyXG4gICAgICAgIElNeURhdGVNb2RlbFxyXG4gICAgPigpO1xyXG4gICAgQE91dHB1dCgpIGlucHV0RmllbGRDaGFuZ2VkOiBFdmVudEVtaXR0ZXI8XHJcbiAgICAgICAgSU15SW5wdXRGaWVsZENoYW5nZWRcclxuICAgID4gPSBuZXcgRXZlbnRFbWl0dGVyPElNeUlucHV0RmllbGRDaGFuZ2VkPigpO1xyXG4gICAgQE91dHB1dCgpIGNhbGVuZGFyVmlld0NoYW5nZWQ6IEV2ZW50RW1pdHRlcjxcclxuICAgICAgICBJTXlDYWxlbmRhclZpZXdDaGFuZ2VkXHJcbiAgICA+ID0gbmV3IEV2ZW50RW1pdHRlcjxJTXlDYWxlbmRhclZpZXdDaGFuZ2VkPigpO1xyXG4gICAgQE91dHB1dCgpIGNhbGVuZGFyVG9nZ2xlOiBFdmVudEVtaXR0ZXI8bnVtYmVyPiA9IG5ldyBFdmVudEVtaXR0ZXI8bnVtYmVyPigpO1xyXG4gICAgQE91dHB1dCgpIHJhbmdlRGF0ZVNlbGVjdGlvbjogRXZlbnRFbWl0dGVyPFxyXG4gICAgICAgIElNeVJhbmdlRGF0ZVNlbGVjdGlvblxyXG4gICAgPiA9IG5ldyBFdmVudEVtaXR0ZXI8SU15UmFuZ2VEYXRlU2VsZWN0aW9uPigpO1xyXG5cclxuICAgIHByaXZhdGUgY1JlZjogQ29tcG9uZW50UmVmPENhbGVuZGFyQ29tcG9uZW50PiA9IG51bGw7XHJcbiAgICBwcml2YXRlIGlucHV0VGV4dCA9ICcnO1xyXG4gICAgcHJpdmF0ZSBwcmV2ZW50Q2xvc2UgPSBmYWxzZTtcclxuICAgIHByaXZhdGUgZGlzYWJsZWQgPSBmYWxzZTtcclxuXHJcbiAgICBwcml2YXRlIG9wdHM6IElNeU9wdGlvbnM7XHJcblxyXG4gICAgLy8gc2Nyb2xsRm46IGFueSA9IChlKSA9PiB7XHJcbiAgICAvLyAgICAgY29uc29sZS5sb2coKGUudGFyZ2V0IGFzIGFueSkuc2Nyb2xsVG9wKTtcclxuICAgIC8vIH07XHJcblxyXG4gICAgb25DaGFuZ2VDYjogKF86IGFueSkgPT4gdm9pZCA9ICgpID0+IHt9O1xyXG4gICAgb25Ub3VjaGVkQ2I6ICgpID0+IHZvaWQgPSAoKSA9PiB7fTtcclxuXHJcbiAgICBjb25zdHJ1Y3RvcihcclxuICAgICAgICBwdWJsaWMgbG9jYWxlU2VydmljZTogRGF0ZXBpY2tlckxvY2FsZVNlcnZpY2UsXHJcbiAgICAgICAgcHJpdmF0ZSB1dGlsU2VydmljZTogVXRpbFNlcnZpY2UsXHJcbiAgICAgICAgcHJpdmF0ZSB2Y1JlZjogVmlld0NvbnRhaW5lclJlZixcclxuICAgICAgICBwcml2YXRlIGNmcjogQ29tcG9uZW50RmFjdG9yeVJlc29sdmVyLFxyXG4gICAgICAgIHByaXZhdGUgcmVuZGVyZXI6IFJlbmRlcmVyMixcclxuICAgICAgICBwcml2YXRlIGNkcjogQ2hhbmdlRGV0ZWN0b3JSZWYsXHJcbiAgICAgICAgcHJpdmF0ZSBlbGVtOiBFbGVtZW50UmVmLFxyXG4gICAgICAgIHByaXZhdGUgY29uZmlnOiBEZWZhdWx0Q29uZmlnU2VydmljZSxcclxuICAgICAgICBwcml2YXRlIHpvbmU6IE5nWm9uZVxyXG4gICAgKSB7XHJcbiAgICAgICAgdGhpcy5vcHRzID0gdGhpcy5jb25maWcuZ2V0RGVmYXVsdENvbmZpZygpO1xyXG4gICAgICAgIHRoaXMucGFyc2VPcHRpb25zKHRoaXMub3B0cyk7XHJcbiAgICB9XHJcblxyXG4gICAgQEhvc3RMaXN0ZW5lcihLRVlVUCwgWyckZXZlbnQnXSkgb25LZXlVcChldmVudDogS2V5Ym9hcmRFdmVudCkge1xyXG4gICAgICAgIGNvbnN0IGtleUNvZGU6IG51bWJlciA9IHRoaXMudXRpbFNlcnZpY2UuZ2V0S2V5Q29kZUZyb21FdmVudChldmVudCk7XHJcbiAgICAgICAgaWYgKHRoaXMuaWdub3JlS2V5UHJlc3Moa2V5Q29kZSkpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH0gZWxzZSBpZiAoa2V5Q29kZSA9PT0gS2V5Q29kZS5lc2MpIHtcclxuICAgICAgICAgICAgdGhpcy5jbG9zZVNlbGVjdG9yKENhbFRvZ2dsZS5DbG9zZUJ5RXNjKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBjb25zdCB7IHZhbHVlIH0gPSB0aGlzLmVsZW0ubmF0aXZlRWxlbWVudDtcclxuXHJcbiAgICAgICAgICAgIGxldCB2YWxpZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICBpZiAoIXRoaXMub3B0cy5kYXRlUmFuZ2UpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGRhdGU6IElNeURhdGUgPSB0aGlzLnV0aWxTZXJ2aWNlLmlzRGF0ZVZhbGlkKFxyXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlLFxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMub3B0c1xyXG4gICAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgICAgIHZhbGlkID0gdGhpcy51dGlsU2VydmljZS5pc0luaXRpYWxpemVkRGF0ZShkYXRlKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHsgYmVnaW4sIGVuZCB9ID0gdGhpcy51dGlsU2VydmljZS5pc0RhdGVWYWxpZERhdGVSYW5nZShcclxuICAgICAgICAgICAgICAgICAgICB2YWx1ZSxcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLm9wdHNcclxuICAgICAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgICAgICB2YWxpZCA9XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy51dGlsU2VydmljZS5pc0luaXRpYWxpemVkRGF0ZShiZWdpbikgJiZcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnV0aWxTZXJ2aWNlLmlzSW5pdGlhbGl6ZWREYXRlKGVuZCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5lbWl0SW5wdXRGaWVsZENoYW5nZWQodmFsdWUsIHZhbGlkKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgQEhvc3RMaXN0ZW5lcihCTFVSKSBvbkJsdXIoKSB7XHJcbiAgICAgICAgY29uc3Qge1xyXG4gICAgICAgICAgICBpbnB1dEZpZWxkVmFsaWRhdGlvbixcclxuICAgICAgICAgICAgZGF0ZVJhbmdlXHJcbiAgICAgICAgfSA9IHRoaXMub3B0cztcclxuXHJcbiAgICAgICAgaWYgKGlucHV0RmllbGRWYWxpZGF0aW9uKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHsgdmFsdWUgfSA9IHRoaXMuZWxlbS5uYXRpdmVFbGVtZW50O1xyXG4gICAgICAgICAgICBsZXQgdmFsaWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgaWYgKCFkYXRlUmFuZ2UpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGRhdGU6IElNeURhdGUgPSB0aGlzLnV0aWxTZXJ2aWNlLmlzRGF0ZVZhbGlkKFxyXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlLFxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMub3B0c1xyXG4gICAgICAgICAgICAgICAgKTtcclxuXHJcbiAgICAgICAgICAgICAgICB2YWxpZCA9IHRoaXMudXRpbFNlcnZpY2UuaXNJbml0aWFsaXplZERhdGUoZGF0ZSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBfZGF0ZVJhbmdlOiBJTXlEYXRlUmFuZ2UgPSB0aGlzLnV0aWxTZXJ2aWNlLmlzRGF0ZVZhbGlkRGF0ZVJhbmdlKFxyXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlLFxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMub3B0c1xyXG4gICAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHsgYmVnaW4sIGVuZCB9ID0gX2RhdGVSYW5nZTtcclxuICAgICAgICAgICAgICAgIHZhbGlkID1cclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnV0aWxTZXJ2aWNlLmlzSW5pdGlhbGl6ZWREYXRlKGJlZ2luKSAmJlxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMudXRpbFNlcnZpY2UuaXNJbml0aWFsaXplZERhdGUoZW5kKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKCF2YWxpZCAmJiB0aGlzLmlucHV0VGV4dCAhPT0gdmFsdWUpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuY2xlYXJEYXRlKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5vbkNoYW5nZUNiKHZhbHVlKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5vblRvdWNoZWRDYigpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIHdyYXBwZXIgd2l0aCBhcnJvdyBmdW5jdGlvbiB0byBwcmVzZXJ2ZSB0aGUgdXNlIG9mICd0aGlzJyB3b3JkXHJcbiAgICBwcml2YXRlIG9uQ2xpY2tXcmFwcGVyID0gKGV2OiBNb3VzZUV2ZW50KSA9PiB7XHJcbiAgICAgICAgdGhpcy5vbkNsaWNrKGV2KTtcclxuICAgIH1cclxuXHJcbiAgICBvbkNsaWNrKGV2dDogTW91c2VFdmVudCkge1xyXG4gICAgICAgIGlmIChcclxuICAgICAgICAgICAgdGhpcy5vcHRzLmNsb3NlU2VsZWN0b3JPbkRvY3VtZW50Q2xpY2sgJiZcclxuICAgICAgICAgICAgIXRoaXMucHJldmVudENsb3NlICYmXHJcbiAgICAgICAgICAgIGV2dC50YXJnZXQgJiZcclxuICAgICAgICAgICAgdGhpcy5jUmVmICE9PSBudWxsICYmXHJcbiAgICAgICAgICAgIHRoaXMuZWxlbS5uYXRpdmVFbGVtZW50ICE9PSBldnQudGFyZ2V0ICYmXHJcbiAgICAgICAgICAgICF0aGlzLmNSZWYubG9jYXRpb24ubmF0aXZlRWxlbWVudC5jb250YWlucyhldnQudGFyZ2V0KSAmJlxyXG4gICAgICAgICAgICAhdGhpcy5kaXNhYmxlZFxyXG4gICAgICAgICkge1xyXG4gICAgICAgICAgICB0aGlzLmNsb3NlU2VsZWN0b3IoQ2FsVG9nZ2xlLkNsb3NlQnlPdXRDbGljayk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgcHVibGljIG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpOiB2b2lkIHtcclxuICAgICAgICBpZiAoY2hhbmdlcy5oYXNPd25Qcm9wZXJ0eShMT0NBTEUpKSB7XHJcbiAgICAgICAgICAgIHRoaXMuc2V0TG9jYWxlT3B0aW9ucygpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKGNoYW5nZXMuaGFzT3duUHJvcGVydHkoREVGQVVMVF9NT05USCkpIHtcclxuICAgICAgICAgICAgbGV0IGRtOiBhbnkgPSBjaGFuZ2VzW0RFRkFVTFRfTU9OVEhdLmN1cnJlbnRWYWx1ZTtcclxuICAgICAgICAgICAgaWYgKHR5cGVvZiBkbSA9PT0gT0JKRUNUKSB7XHJcbiAgICAgICAgICAgICAgICBkbSA9IGRtLmRlZk1vbnRoO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMuZGVmYXVsdE1vbnRoID0gZG07XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoY2hhbmdlcy5oYXNPd25Qcm9wZXJ0eShPUFRJT05TKSkge1xyXG4gICAgICAgICAgICB0aGlzLnBhcnNlT3B0aW9ucyhjaGFuZ2VzW09QVElPTlNdLmN1cnJlbnRWYWx1ZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBuZ09uRGVzdHJveSgpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLmNsb3NlQ2FsZW5kYXIoKTtcclxuICAgIH1cclxuXHJcbiAgICBzZXRMb2NhbGVPcHRpb25zKCk6IHZvaWQge1xyXG4gICAgICAgIGNvbnN0IG9wdHM6IElNeU9wdGlvbnMgPSB0aGlzLmxvY2FsZVNlcnZpY2UuZ2V0TG9jYWxlT3B0aW9ucyhcclxuICAgICAgICAgICAgdGhpcy5sb2NhbGVcclxuICAgICAgICApO1xyXG4gICAgICAgIE9iamVjdC5rZXlzKG9wdHMpLmZvckVhY2goayA9PiB7XHJcbiAgICAgICAgICAgICh0aGlzLm9wdHMgYXMgSU15T3B0aW9ucylba10gPSBvcHRzW2tdO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBwYXJzZU9wdGlvbnMob3B0czogSU15T3B0aW9ucyk6IHZvaWQge1xyXG4gICAgICAgIGlmIChvcHRzICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgT2JqZWN0LmtleXMob3B0cykuZm9yRWFjaChrID0+IHtcclxuICAgICAgICAgICAgICAgIGlmIChvcHRzW2tdICE9PSB1bmRlZmluZWQgJiYgb3B0c1trXSAhPT0gJycpIHtcclxuICAgICAgICAgICAgICAgICAgICAodGhpcy5vcHRzIGFzIElNeU9wdGlvbnMpW2tdID0gb3B0c1trXTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0aGlzLm9wdHMubWluWWVhciA8IFllYXIubWluKSB7XHJcbiAgICAgICAgICAgIHRoaXMub3B0cy5taW5ZZWFyID0gWWVhci5taW47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0aGlzLm9wdHMubWF4WWVhciA+IFllYXIubWF4KSB7XHJcbiAgICAgICAgICAgIHRoaXMub3B0cy5tYXhZZWFyID0gWWVhci5tYXg7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgZm9ybWF0RGF0ZSh2YWx1ZTogYW55KSB7XHJcbiAgICAgICAgY29uc3Qge1xyXG4gICAgICAgICAgICBkYXRlUmFuZ2UsXHJcbiAgICAgICAgICAgIGRhdGVGb3JtYXQsXHJcbiAgICAgICAgICAgIG1vbnRoTGFiZWxzLFxyXG4gICAgICAgICAgICBkYXRlUmFuZ2VEYXRlc0RlbGltaXRlcixcclxuICAgICAgICAgICAgcmV0dXJuRm9ybWF0XHJcbiAgICAgICAgfSA9IHRoaXMub3B0cztcclxuICAgICAgICBpZiAoIWRhdGVSYW5nZSkge1xyXG4gICAgICAgICAgICAvLyBTaW5nbGUgZGF0ZSBtb2RlXHJcbiAgICAgICAgICAgIGNvbnN0IGRhdGU6IElNeURhdGUgPSB0aGlzLnV0aWxTZXJ2aWNlLmlzRGF0ZVZhbGlkKFxyXG4gICAgICAgICAgICAgICAgdmFsdWUsXHJcbiAgICAgICAgICAgICAgICB0aGlzLm9wdHNcclxuICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMudXRpbFNlcnZpY2UuZ2V0RGF0ZU1vZGVsKFxyXG4gICAgICAgICAgICAgICAgZGF0ZSxcclxuICAgICAgICAgICAgICAgIG51bGwsXHJcbiAgICAgICAgICAgICAgICBkYXRlRm9ybWF0LFxyXG4gICAgICAgICAgICAgICAgbW9udGhMYWJlbHMsXHJcbiAgICAgICAgICAgICAgICBkYXRlUmFuZ2VEYXRlc0RlbGltaXRlcixcclxuICAgICAgICAgICAgICAgIHJldHVybkZvcm1hdFxyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIC8vIERhdGUgcmFuZ2UgbW9kZVxyXG4gICAgICAgICAgICBjb25zdCBfZGF0ZVJhbmdlID0gdGhpcy51dGlsU2VydmljZS5pc0RhdGVWYWxpZERhdGVSYW5nZShcclxuICAgICAgICAgICAgICAgIHZhbHVlLFxyXG4gICAgICAgICAgICAgICAgdGhpcy5vcHRzXHJcbiAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnV0aWxTZXJ2aWNlLmdldERhdGVNb2RlbChcclxuICAgICAgICAgICAgICAgIG51bGwsXHJcbiAgICAgICAgICAgICAgICBfZGF0ZVJhbmdlLFxyXG4gICAgICAgICAgICAgICAgZGF0ZUZvcm1hdCxcclxuICAgICAgICAgICAgICAgIG1vbnRoTGFiZWxzLFxyXG4gICAgICAgICAgICAgICAgZGF0ZVJhbmdlRGF0ZXNEZWxpbWl0ZXIsXHJcbiAgICAgICAgICAgICAgICByZXR1cm5Gb3JtYXRcclxuICAgICAgICAgICAgKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBwdWJsaWMgd3JpdGVWYWx1ZSh2YWx1ZTogYW55KTogdm9pZCB7XHJcbiAgICAgICAgaWYgKHRoaXMuZGlzYWJsZWQpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodmFsdWUpIHtcclxuICAgICAgICAgICAgdmFsdWUgPSB0aGlzLmZvcm1hdERhdGUodmFsdWUpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKCF2YWx1ZSkge1xyXG4gICAgICAgICAgICB0aGlzLnNldElucHV0VmFsdWUoRU1QVFlfU1RSKTtcclxuICAgICAgICAgICAgdGhpcy5lbWl0SW5wdXRGaWVsZENoYW5nZWQoRU1QVFlfU1RSLCBmYWxzZSk7XHJcblxyXG4gICAgICAgICAgICBpZiAodGhpcy5jUmVmICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNSZWYuaW5zdGFuY2UucmVzZXREYXRlVmFsdWUoUmVzZXREYXRlVHlwZS5ib3RoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSBpZiAodmFsdWUuaXNSYW5nZSA9PT0gZmFsc2UgJiYgdmFsdWUuc2luZ2xlRGF0ZSkge1xyXG4gICAgICAgICAgICAvLyBzaW5nbGUgZGF0ZVxyXG4gICAgICAgICAgICBjb25zdCB7IGRhdGUsIGZvcm1hdHRlZCB9ID0gdmFsdWUuc2luZ2xlRGF0ZTtcclxuICAgICAgICAgICAgY29uc3QgdmFsaWQ6IGJvb2xlYW4gPSB0aGlzLnV0aWxTZXJ2aWNlLmlzSW5pdGlhbGl6ZWREYXRlKGRhdGUpO1xyXG4gICAgICAgICAgICBpZiAodmFsaWQpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2V0SW5wdXRWYWx1ZShmb3JtYXR0ZWQpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5lbWl0SW5wdXRGaWVsZENoYW5nZWQoZm9ybWF0dGVkLCB2YWxpZCk7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuY1JlZiAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY1JlZi5pbnN0YW5jZS5yZXNldERhdGVWYWx1ZShSZXNldERhdGVUeXBlLmRhdGVSYW5nZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2UgaWYgKHZhbHVlLmlzUmFuZ2UgPT09IHRydWUgJiYgdmFsdWUuZGF0ZVJhbmdlKSB7XHJcbiAgICAgICAgICAgIC8vIGRhdGUgcmFuZ2VcclxuICAgICAgICAgICAgY29uc3QgeyBiZWdpbkRhdGUsIGVuZERhdGUsIGZvcm1hdHRlZCB9ID0gdmFsdWUuZGF0ZVJhbmdlO1xyXG5cclxuICAgICAgICAgICAgaWYgKGJlZ2luRGF0ZSAmJiBlbmREYXRlKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCB2YWxpZDogYm9vbGVhbiA9XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy51dGlsU2VydmljZS5pc0luaXRpYWxpemVkRGF0ZShiZWdpbkRhdGUpICYmXHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy51dGlsU2VydmljZS5pc0luaXRpYWxpemVkRGF0ZShlbmREYXRlKTtcclxuICAgICAgICAgICAgICAgIGlmICh2YWxpZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0SW5wdXRWYWx1ZShmb3JtYXR0ZWQpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZW1pdElucHV0RmllbGRDaGFuZ2VkKGZvcm1hdHRlZCwgdmFsaWQpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5jUmVmICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY1JlZi5pbnN0YW5jZS5yZXNldERhdGVWYWx1ZShcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFJlc2V0RGF0ZVR5cGUuc2luZ2xlRGF0ZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICApO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgcmVnaXN0ZXJPbkNoYW5nZShmbjogYW55KTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy5vbkNoYW5nZUNiID0gZm47XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHJlZ2lzdGVyT25Ub3VjaGVkKGZuOiBhbnkpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLm9uVG91Y2hlZENiID0gZm47XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHNldERpc2FibGVkU3RhdGUoaXNEaXNhYmxlZDogYm9vbGVhbik6IHZvaWQge1xyXG4gICAgICAgIHRoaXMuZGlzYWJsZWQgPSBpc0Rpc2FibGVkO1xyXG4gICAgICAgIHRoaXMucmVuZGVyZXIuc2V0UHJvcGVydHkoXHJcbiAgICAgICAgICAgIHRoaXMuZWxlbS5uYXRpdmVFbGVtZW50LFxyXG4gICAgICAgICAgICBESVNBQkxFRCxcclxuICAgICAgICAgICAgaXNEaXNhYmxlZFxyXG4gICAgICAgICk7XHJcblxyXG4gICAgICAgIGlmIChpc0Rpc2FibGVkKSB7XHJcbiAgICAgICAgICAgIHRoaXMuY2xvc2VDYWxlbmRhcigpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgdmFsaWRhdGUoYzogQWJzdHJhY3RDb250cm9sKTogeyBbcDogc3RyaW5nXTogYW55IH0ge1xyXG4gICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBvcGVuQ2FsZW5kYXIoKTogdm9pZCB7XHJcbiAgICAgICAgaWYgKHRoaXMuZGlzYWJsZWQpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLnByZXZlbnRDbG9zZSA9IHRydWU7XHJcbiAgICAgICAgdGhpcy5jZHIuZGV0ZWN0Q2hhbmdlcygpO1xyXG4gICAgICAgIGlmICh0aGlzLmNSZWYgPT09IG51bGwpIHtcclxuICAgICAgICAgICAgdGhpcy5jUmVmID0gdGhpcy52Y1JlZi5jcmVhdGVDb21wb25lbnQoXHJcbiAgICAgICAgICAgICAgICB0aGlzLmNmci5yZXNvbHZlQ29tcG9uZW50RmFjdG9yeShDYWxlbmRhckNvbXBvbmVudClcclxuICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgdGhpcy5hcHBlbmRTZWxlY3Rvcih0aGlzLmNSZWYubG9jYXRpb24ubmF0aXZlRWxlbWVudCk7XHJcbiAgICAgICAgICAgIHRoaXMuY1JlZi5pbnN0YW5jZS5pbml0aWFsaXplKFxyXG4gICAgICAgICAgICAgICAgdGhpcy5vcHRzLFxyXG4gICAgICAgICAgICAgICAgdGhpcy5kZWZhdWx0TW9udGgsXHJcbiAgICAgICAgICAgICAgICB0aGlzLmdldFNlbGVjdG9yUG9zaXRpb24odGhpcy5lbGVtLm5hdGl2ZUVsZW1lbnQpLFxyXG4gICAgICAgICAgICAgICAgdGhpcy5lbGVtLm5hdGl2ZUVsZW1lbnQudmFsdWUsXHJcbiAgICAgICAgICAgICAgICAoZG06IElNeURhdGVNb2RlbCwgY2xvc2U6IGJvb2xlYW4pID0+IHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmZvY3VzVG9JbnB1dCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlTW9kZWwoZG0pO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChjbG9zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNsb3NlU2VsZWN0b3IoQ2FsVG9nZ2xlLkNsb3NlQnlEYXRlU2VsKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5lbWl0RGF0ZUNoYW5nZWQoZG0pO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZW1pdElucHV0RmllbGRDaGFuZ2VkKFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnV0aWxTZXJ2aWNlLmdldEZvcm1hdHRlZERhdGUoZG0pLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0cnVlXHJcbiAgICAgICAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAoY3ZjOiBJTXlDYWxlbmRhclZpZXdDaGFuZ2VkKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5lbWl0Q2FsZW5kYXJDaGFuZ2VkKGN2Yyk7XHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgKHJkczogSU15UmFuZ2VEYXRlU2VsZWN0aW9uKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5lbWl0UmFuZ2VEYXRlU2VsZWN0aW9uKHJkcyk7XHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2xvc2VTZWxlY3RvcihDYWxUb2dnbGUuQ2xvc2VCeUVzYyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgIHRoaXMuZW1pdENhbGVuZGFyVG9nZ2xlKENhbFRvZ2dsZS5PcGVuKTtcclxuICAgICAgICAgICAgdGhpcy5jZHIuZGV0ZWN0Q2hhbmdlcygpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMuYXBwZW5kU2VsZWN0b3IodGhpcy5jUmVmLmxvY2F0aW9uLm5hdGl2ZUVsZW1lbnQpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLnByZXZlbnRDbG9zZSA9IGZhbHNlO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBjbG9zZUNhbGVuZGFyKCk6IHZvaWQge1xyXG4gICAgICAgIHRoaXMuY2xvc2VTZWxlY3RvcihDYWxUb2dnbGUuQ2xvc2VCeUNhbEJ0bik7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHRvZ2dsZUNhbGVuZGFyKGV2ZW50OiBNb3VzZUV2ZW50KTogdm9pZCB7XHJcbiAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICAgICAgaWYgKHRoaXMuZGlzYWJsZWQpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGhpcy5jUmVmID09PSBudWxsKSB7XHJcbiAgICAgICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoQ0xJQ0ssIHRoaXMub25DbGlja1dyYXBwZXIsIHRydWUpO1xyXG4gICAgICAgICAgICB0aGlzLm9wZW5DYWxlbmRhcigpO1xyXG4gICAgICAgICAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuZGF0ZS1vdmVybGF5LWNvbnRhaW5lcicpO1xyXG4gICAgICAgICAgICB0aGlzLnJlbmRlcmVyLnNldFN0eWxlKGNvbnRhaW5lciwgJ3BvaW50ZXItZXZlbnRzJywgJ2F1dG8nKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBsZXQgZmxhZyA9IHRydWU7XHJcbiAgICAgICAgICAgIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5kYXRlLW92ZXJsYXktY29udGFpbmVyJyk7XHJcbiAgICAgICAgICAgIGlmIChjb250YWluZXIgJiYgdGhpcy5jUmVmLmxvY2F0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoY29udGFpbmVyLmhhc0NoaWxkTm9kZXMoKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnRhaW5lci5jaGlsZE5vZGVzLmZvckVhY2goZWwgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZWwgPT09IHRoaXMuY1JlZi5sb2NhdGlvbi5uYXRpdmVFbGVtZW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmbGFnID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoZmxhZykge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5yZW5kZXJlci5zZXRTdHlsZShjb250YWluZXIsICdwb2ludGVyLWV2ZW50cycsICdhdXRvJyk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLm9wZW5DYWxlbmRhcigpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihDTElDSywgdGhpcy5vbkNsaWNrV3JhcHBlcik7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNsb3NlU2VsZWN0b3IoQ2FsVG9nZ2xlLkNsb3NlQnlDYWxCdG4pO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5yZW5kZXJlci5zZXRTdHlsZShjb250YWluZXIsICdwb2ludGVyLWV2ZW50cycsICcnKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgY2xlYXJEYXRlKCk6IHZvaWQge1xyXG4gICAgICAgIGlmICh0aGlzLmRpc2FibGVkKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5zZXRJbnB1dFZhbHVlKEVNUFRZX1NUUik7XHJcbiAgICAgICAgdGhpcy5lbWl0RGF0ZUNoYW5nZWQoe1xyXG4gICAgICAgICAgICBpc1JhbmdlOiB0aGlzLm9wdHMuZGF0ZVJhbmdlLFxyXG4gICAgICAgICAgICBzaW5nbGVEYXRlOiB7XHJcbiAgICAgICAgICAgICAgICBkYXRlOiB0aGlzLnV0aWxTZXJ2aWNlLnJlc2V0RGF0ZSgpLFxyXG4gICAgICAgICAgICAgICAganNEYXRlOiBudWxsLFxyXG4gICAgICAgICAgICAgICAgZm9ybWF0dGVkOiBFTVBUWV9TVFIsXHJcbiAgICAgICAgICAgICAgICBlcG9jOiAwXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGRhdGVSYW5nZToge1xyXG4gICAgICAgICAgICAgICAgYmVnaW5EYXRlOiB0aGlzLnV0aWxTZXJ2aWNlLnJlc2V0RGF0ZSgpLFxyXG4gICAgICAgICAgICAgICAgYmVnaW5Kc0RhdGU6IG51bGwsXHJcbiAgICAgICAgICAgICAgICBiZWdpbkVwb2M6IDAsXHJcbiAgICAgICAgICAgICAgICBlbmREYXRlOiB0aGlzLnV0aWxTZXJ2aWNlLnJlc2V0RGF0ZSgpLFxyXG4gICAgICAgICAgICAgICAgZW5kSnNEYXRlOiBudWxsLFxyXG4gICAgICAgICAgICAgICAgZW5kRXBvYzogMCxcclxuICAgICAgICAgICAgICAgIGZvcm1hdHRlZDogRU1QVFlfU1RSXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICB0aGlzLm9uQ2hhbmdlQ2IobnVsbCk7XHJcbiAgICAgICAgdGhpcy5vblRvdWNoZWRDYigpO1xyXG4gICAgICAgIHRoaXMuY2xvc2VTZWxlY3RvcihDYWxUb2dnbGUuQ2xvc2VCeUNhbEJ0bik7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGlzRGF0ZVZhbGlkKCk6IGJvb2xlYW4ge1xyXG4gICAgICAgIGNvbnN0IHsgdmFsdWUgfSA9IHRoaXMuZWxlbS5uYXRpdmVFbGVtZW50O1xyXG5cclxuICAgICAgICBpZiAodmFsdWUgIT09IEVNUFRZX1NUUikge1xyXG4gICAgICAgICAgICBjb25zdCBkYXRlOiBJTXlEYXRlID0gdGhpcy51dGlsU2VydmljZS5pc0RhdGVWYWxpZChcclxuICAgICAgICAgICAgICAgIHZhbHVlLFxyXG4gICAgICAgICAgICAgICAgdGhpcy5vcHRzXHJcbiAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLnV0aWxTZXJ2aWNlLmlzSW5pdGlhbGl6ZWREYXRlKGRhdGUpKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmVtaXRJbnB1dEZpZWxkQ2hhbmdlZCh2YWx1ZSwgdHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmVtaXRJbnB1dEZpZWxkQ2hhbmdlZCh2YWx1ZSwgZmFsc2UpO1xyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGlnbm9yZUtleVByZXNzKGtleUNvZGU6IG51bWJlcik6IGJvb2xlYW4ge1xyXG4gICAgICAgIC8vIGtleUNvZGUgPT09IEtleUNvZGUudGFiIHx8XHJcblxyXG4gICAgICAgIHJldHVybiAoXHJcbiAgICAgICAgICAgIGtleUNvZGUgPT09IEtleUNvZGUubGVmdEFycm93IHx8XHJcbiAgICAgICAgICAgIGtleUNvZGUgPT09IEtleUNvZGUucmlnaHRBcnJvdyB8fFxyXG4gICAgICAgICAgICBrZXlDb2RlID09PSBLZXlDb2RlLnVwQXJyb3cgfHxcclxuICAgICAgICAgICAga2V5Q29kZSA9PT0gS2V5Q29kZS5kb3duQXJyb3cgfHxcclxuICAgICAgICAgICAga2V5Q29kZSA9PT0gS2V5Q29kZS5zaGlmdFxyXG4gICAgICAgICk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBjbG9zZVNlbGVjdG9yKHJlYXNvbjogbnVtYmVyKTogdm9pZCB7XHJcbiAgICAgICAgaWYgKHRoaXMuY1JlZiAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICB0aGlzLnZjUmVmLnJlbW92ZSh0aGlzLnZjUmVmLmluZGV4T2YodGhpcy5jUmVmLmhvc3RWaWV3KSk7XHJcbiAgICAgICAgICAgIHRoaXMuY1JlZiA9IG51bGw7XHJcbiAgICAgICAgICAgIHRoaXMuY2RyLmRldGVjdENoYW5nZXMoKTtcclxuICAgICAgICAgICAgdGhpcy5lbWl0Q2FsZW5kYXJUb2dnbGUocmVhc29uKTtcclxuICAgICAgICAgICAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmRhdGUtb3ZlcmxheS1jb250YWluZXInKTtcclxuICAgICAgICAgICAgdGhpcy5yZW5kZXJlci5zZXRTdHlsZShjb250YWluZXIsICdwb2ludGVyLWV2ZW50cycsICcnKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSB1cGRhdGVNb2RlbChtb2RlbDogSU15RGF0ZU1vZGVsKTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy5zZXRJbnB1dFZhbHVlKHRoaXMudXRpbFNlcnZpY2UuZ2V0Rm9ybWF0dGVkRGF0ZShtb2RlbCkpO1xyXG4gICAgICAgIHRoaXMub25DaGFuZ2VDYih0aGlzLnV0aWxTZXJ2aWNlLmdldEZvcm1hdHRlZERhdGUobW9kZWwpKTtcclxuICAgICAgICB0aGlzLm9uVG91Y2hlZENiKCk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBzZXRJbnB1dFZhbHVlKHZhbHVlOiBzdHJpbmcpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLmlucHV0VGV4dCA9IHZhbHVlO1xyXG4gICAgICAgIHRoaXMucmVuZGVyZXIuc2V0UHJvcGVydHkodGhpcy5lbGVtLm5hdGl2ZUVsZW1lbnQsIFZBTFVFLCB2YWx1ZSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBmb2N1c1RvSW5wdXQoKTogdm9pZCB7XHJcbiAgICAgICAgaWYgKHRoaXMub3B0cy5mb2N1c0lucHV0T25EYXRlU2VsZWN0KSB7XHJcbiAgICAgICAgICAgIHRoaXMuZWxlbS5uYXRpdmVFbGVtZW50LmZvY3VzKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZW1pdERhdGVDaGFuZ2VkKGRhdGVNb2RlbDogSU15RGF0ZU1vZGVsKTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy5kYXRlQ2hhbmdlZC5lbWl0KGRhdGVNb2RlbCk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBlbWl0SW5wdXRGaWVsZENoYW5nZWQodmFsdWU6IHN0cmluZywgdmFsaWQ6IGJvb2xlYW4pOiB2b2lkIHtcclxuICAgICAgICB0aGlzLmlucHV0RmllbGRDaGFuZ2VkLmVtaXQoe1xyXG4gICAgICAgICAgICB2YWx1ZSxcclxuICAgICAgICAgICAgZGF0ZUZvcm1hdDogdGhpcy5vcHRzLmRhdGVGb3JtYXQsXHJcbiAgICAgICAgICAgIHZhbGlkXHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBlbWl0Q2FsZW5kYXJDaGFuZ2VkKGN2YzogSU15Q2FsZW5kYXJWaWV3Q2hhbmdlZCkge1xyXG4gICAgICAgIHRoaXMuY2FsZW5kYXJWaWV3Q2hhbmdlZC5lbWl0KGN2Yyk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBlbWl0UmFuZ2VEYXRlU2VsZWN0aW9uKHJkczogSU15UmFuZ2VEYXRlU2VsZWN0aW9uKSB7XHJcbiAgICAgICAgdGhpcy5yYW5nZURhdGVTZWxlY3Rpb24uZW1pdChyZHMpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZW1pdENhbGVuZGFyVG9nZ2xlKHJlYXNvbjogbnVtYmVyKTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy5jYWxlbmRhclRvZ2dsZS5lbWl0KHJlYXNvbik7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBqc0RhdGVUb015RGF0ZShkYXRlOiBEYXRlKTogSU15RGF0ZSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgeWVhcjogZGF0ZS5nZXRGdWxsWWVhcigpLFxyXG4gICAgICAgICAgICBtb250aDogZGF0ZS5nZXRNb250aCgpICsgMSxcclxuICAgICAgICAgICAgZGF5OiBkYXRlLmdldERhdGUoKVxyXG4gICAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBhcHBlbmRTZWxlY3RvcihlbGVtOiBhbnkpOiB2b2lkIHtcclxuICAgICAgICBsZXQgY29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmRhdGUtb3ZlcmxheS1jb250YWluZXInKTtcclxuICAgICAgICBpZiAoY29udGFpbmVyKSB7XHJcbiAgICAgICAgICAgIGlmIChjb250YWluZXIuaGFzQ2hpbGROb2RlcygpKSB7XHJcbiAgICAgICAgICAgICAgICBjb250YWluZXIuY2hpbGROb2Rlcy5mb3JFYWNoKGVsID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZWwgIT09IGVsZW0pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29udGFpbmVyLnJlbW92ZUNoaWxkKGVsKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICAgICAgICAgICBjb250YWluZXIuY2xhc3NMaXN0LmFkZCgnZGF0ZS1vdmVybGF5LWNvbnRhaW5lcicpO1xyXG4gICAgICAgICAgICBjb250YWluZXIuY2xhc3NMaXN0LmFkZCgnb3ZlcmxheS1jb250YWluZXInKTtcclxuICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChjb250YWluZXIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQoZWxlbSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBnZXRTZWxlY3RvclBvc2l0aW9uKGVsZW06IGFueSk6IElNeVNlbGVjdG9yUG9zaXRpb24ge1xyXG4gICAgICAgIGxldCB0b3AgPSAwO1xyXG4gICAgICAgIGxldCBsZWZ0ID0gMDtcclxuICAgICAgICBsZXQgX3NlbGVjdG9ySGVpZ2h0ID0gMDtcclxuICAgICAgICBsZXQgX3NlbGVjdG9yV2lkdGggPSAwO1xyXG4gICAgICAgIGNvbnN0IHtcclxuICAgICAgICAgICAgc2VsZWN0b3JIZWlnaHQsXHJcbiAgICAgICAgICAgIHNlbGVjdG9yV2lkdGgsXHJcbiAgICAgICAgICAgIHNob3dUaW1lLFxyXG4gICAgICAgICAgICBkYXRlUmFuZ2VcclxuICAgICAgICB9ID0gdGhpcy5vcHRzO1xyXG5cclxuICAgICAgICBjb25zdCBiOiBhbnkgPSBkb2N1bWVudC5ib2R5LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xyXG4gICAgICAgIGNvbnN0IGU6IGFueSA9IGVsZW0uZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XHJcbiAgICAgICAgdG9wID0gZS50b3AgLSBiLnRvcDtcclxuICAgICAgICBsZWZ0ID0gZS5sZWZ0IC0gYi5sZWZ0O1xyXG4gICAgICAgIGxldCBwb3NpdGlvbiA9ICdib3R0b20nO1xyXG4gICAgICAgIGlmIChkYXRlUmFuZ2UpIHtcclxuICAgICAgICAgICAgX3NlbGVjdG9yV2lkdGggPSB0aGlzLmdldFNlbGVjdG9yRGltZW5zaW9uKHNlbGVjdG9yV2lkdGgpICogMjtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBfc2VsZWN0b3JXaWR0aCA9IHRoaXMuZ2V0U2VsZWN0b3JEaW1lbnNpb24oc2VsZWN0b3JXaWR0aCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoc2hvd1RpbWUpIHtcclxuICAgICAgICAgICAgX3NlbGVjdG9ySGVpZ2h0ID0gdGhpcy5nZXRTZWxlY3RvckRpbWVuc2lvbihzZWxlY3RvckhlaWdodCkgKyAzNjtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBfc2VsZWN0b3JIZWlnaHQgPSB0aGlzLmdldFNlbGVjdG9yRGltZW5zaW9uKHNlbGVjdG9ySGVpZ2h0KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHRvcCArIGVsZW0ub2Zmc2V0SGVpZ2h0ICsgX3NlbGVjdG9ySGVpZ2h0ID4gd2luZG93LmlubmVySGVpZ2h0ICYmIHRvcCAtIF9zZWxlY3RvckhlaWdodCAtIDIgPiAwKSB7XHJcbiAgICAgICAgICAgIHRvcCA9IHRvcCAtIF9zZWxlY3RvckhlaWdodCAtIDI7XHJcbiAgICAgICAgICAgIHBvc2l0aW9uID0gJ3RvcCc7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdG9wID0gdG9wICsgZWxlbS5vZmZzZXRIZWlnaHQgKyAyO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKGxlZnQgKyBfc2VsZWN0b3JXaWR0aCA+IGIud2lkdGgpIHtcclxuICAgICAgICAgICAgbGVmdCA9IGIud2lkdGggLSBfc2VsZWN0b3JXaWR0aCAtIDE1O1xyXG4gICAgICAgIH1cclxuICAgICAgICBsZWZ0ID0gbGVmdCA+IDAgPyBsZWZ0IDogMDtcclxuICAgICAgICByZXR1cm4geyB0b3AgLCBsZWZ0LCBwb3NpdGlvbiB9O1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZ2V0U2VsZWN0b3JEaW1lbnNpb24odmFsdWU6IHN0cmluZyk6IG51bWJlciB7XHJcbiAgICAgICAgcmV0dXJuIE51bWJlcih2YWx1ZS5yZXBsYWNlKFBYLCBFTVBUWV9TVFIpKTtcclxuICAgIH1cclxufVxyXG4iXX0=
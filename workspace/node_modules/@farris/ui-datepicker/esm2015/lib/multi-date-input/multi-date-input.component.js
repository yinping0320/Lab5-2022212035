/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { ChangeDetectorRef, Component, ElementRef, EventEmitter, Injector, Input, Output, Renderer2, ViewChild } from '@angular/core';
import { CommonUtils, OverLayHiddenService } from '@farris/ui-common';
import { BehaviorSubject } from 'rxjs';
import { UtilService } from '../services/farris-datepicker.util.service';
export class MultiSelectDateInputComponent {
    /**
     * @param {?} injector
     * @param {?} render
     * @param {?} el
     * @param {?} overLayService
     * @param {?} cd
     * @param {?} utilService
     */
    constructor(injector, render, el, overLayService, cd, utilService) {
        this.injector = injector;
        this.render = render;
        this.el = el;
        this.overLayService = overLayService;
        this.cd = cd;
        this.utilService = utilService;
        this.dates = '';
        this.separator = ',';
        this.placeholder = '';
        this.editable = true;
        this.orderBy = 'none';
        this.clickHandle = new EventEmitter();
        this.remove = new EventEmitter();
        this._dateItems = [];
        this.hiddenItemsCount$ = new BehaviorSubject(0);
        this.commonUtils = null;
        this.commonUtils = this.injector.get(CommonUtils, null);
    }
    /**
     * @return {?}
     */
    ngOnInit() {
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        if (this.overLayService) {
            this.overLayService.destory(this.shadowBox.nativeElement);
        }
        if (this.shadowBox) {
            this.shadowBox.nativeElement.remove();
        }
    }
    /**
     * @param {?} changes
     * @return {?}
     */
    ngOnChanges(changes) {
        if (changes.dates && !changes.dates.isFirstChange()) {
            this.initDateItems();
        }
    }
    /**
     * @private
     * @return {?}
     */
    initDateItems() {
        /** @type {?} */
        const _dateItems = this.dates.split(this.separator).filter((/**
         * @param {?} n
         * @return {?}
         */
        n => n));
        this._dateItems = this.utilService.orderSelectedDates(_dateItems, this.orderBy);
        setTimeout((/**
         * @return {?}
         */
        () => {
            this.setHiddenCount();
        }));
    }
    /**
     * @return {?}
     */
    ngAfterViewInit() {
        this.initDateItems();
        setTimeout((/**
         * @return {?}
         */
        () => {
            this.moveShadowToBody();
        }));
    }
    /**
     * @param {?} $event
     * @return {?}
     */
    onClick($event) {
        $event.stopPropagation();
        this.toggleShadowBox($event, false);
        this.clickHandle.emit($event);
    }
    /**
     * @param {?} $event
     * @param {?} txt
     * @param {?} index
     * @return {?}
     */
    onRemove($event, txt, index) {
        if ($event) {
            $event.stopPropagation();
        }
        this.remove.emit({ index, value: txt });
    }
    /**
     * @param {?} $event
     * @return {?}
     */
    onResized($event) {
        this.updateShadowBoxPosition($event);
        setTimeout((/**
         * @return {?}
         */
        () => {
            this.setHiddenCount();
            this.cd.detectChanges();
        }));
    }
    /**
     * @private
     * @return {?}
     */
    setHiddenCount() {
        /** @type {?} */
        let len = 0;
        if (!this._dateItems || !this._dateItems.length) {
            this.hiddenItemsCount$.next(len);
            return;
        }
        /** @type {?} */
        const items = Array.from(this.container.nativeElement.querySelectorAll('span.search-tag-item'));
        if (items && items.length) {
            len = items.map((/**
             * @param {?} n
             * @return {?}
             */
            (n) => {
                return n.offsetTop;
            })).filter((/**
             * @param {?} n
             * @return {?}
             */
            n => n > 20)).length;
        }
        this.hiddenItemsCount$.next(len);
    }
    /**
     * @param {?=} __0
     * @return {?}
     */
    updateShadowBoxPosition({ top, left, width } = { top: null, left: null, width: null }) {
        if (!top && !left && !width) {
            /** @type {?} */
            const e = this.el.nativeElement.getBoundingClientRect();
            top = e.top;
            left = e.left;
            width = e.width;
        }
        this.render.setStyle(this.shadowBox.nativeElement, 'left', left + 'px');
        this.render.setStyle(this.shadowBox.nativeElement, 'top', top + 'px');
        this.render.setStyle(this.shadowBox.nativeElement, 'width', width + 'px');
        this.render.setStyle(this.shadowBox.nativeElement, 'zIndex', this.commonUtils.getFloatingLayerIndex());
    }
    /**
     * @private
     * @return {?}
     */
    moveShadowToBody() {
        this.updateShadowBoxPosition();
        document.body.append(this.shadowBox.nativeElement);
        this.overLayService.registerMouseEvent(this.shadowBox.nativeElement, (/**
         * @param {?} e
         * @return {?}
         */
        (e) => {
            if (e.target && e.target.className.indexOf('search-box_delete-keys') > -1) {
                return;
            }
            if (!this.shadowBox || this.shadowBox.nativeElement.contains(e.target)) {
                return;
            }
            this.toggleShadowBox(null, false);
        }));
    }
    /**
     * @param {?} $event
     * @param {?=} show
     * @return {?}
     */
    toggleShadowBox($event, show = true) {
        if ($event) {
            $event.stopPropagation();
        }
        if (!this.hiddenItemsCount$.value) {
            show = false;
        }
        if (show) {
            this.updateShadowBoxPosition();
            this.render.removeStyle(this.shadowBox.nativeElement, 'display');
            this.container.nativeElement.style.visibility = 'hidden';
        }
        else {
            this.container.nativeElement.style.visibility = 'visible';
            this.render.setStyle(this.shadowBox.nativeElement, 'display', 'none');
        }
    }
}
MultiSelectDateInputComponent.decorators = [
    { type: Component, args: [{
                selector: 'multi-select-input',
                template: "\r\n<div #searchbox class=\"input-group f-search-box f-multi-select-date\" [class.f-state-disabled]=\"!editable\" resizeObserver (resize)=\"onResized($event)\"\r\n[attr.title]=\"dates\" (mousedown)=\"$event.preventDefault()\">\r\n    <div class=\"form-control f-cmp-inputgroup--multi-wrapper multi-more\" style=\"min-height: 26px;padding: 0px 5px;\" [style.height]=\"'26px'\" (click)=\"toggleShadowBox($event)\">\r\n        <div class=\"multi--content d-flex flex-row multi-date-display\" #tagContainer \r\n        [attr.placeholder]=\"placeholder\">\r\n            <span class=\"multi--item search-tag-item\" [class.multi-date-display-readonly]=\"!editable\" *ngFor=\"let txt of _dateItems; index as i\" >\r\n                <span class=\"search-tag\" >{{txt}}</span>\r\n                <i class=\"f-icon f-icon-close search-box_delete-keys\" *ngIf=\"editable\" style=\"top:5px\" (click)=\"onRemove($event, txt, i)\"></i>\r\n            </span>\r\n        </div>\r\n\r\n        <div class=\"d-flex flex-row\" style=\"cursor: pointer;align-items: center;color: #2A87FF;font-weight: 600;\" *ngIf=\"hiddenItemsCount$ | async\">\r\n            <span class=\"multi--more-text\">+{{hiddenItemsCount$ | async}}</span>\r\n        </div>\r\n    </div>\r\n    <div class=\"input-group-append f-cmp-iconbtn-wrapper\" *ngIf=\"editable\" style=\"position: relative;\" (mouseenter)=\"$event.stopPropagation()\">\r\n        <span class=\"input-group-text input-group-clear datepicker-clear \" \r\n            style=\"position: absolute; height: 100%; right: 0px; top: 0px; z-index: 100; visibility: hidden;\">\r\n            <i class=\"f-icon modal_close\"></i></span>\r\n        <button class=\"btn f-cmp-iconbtn\" type=\"button\" (click)=\"onClick($event)\"><span class=\"f-icon f-icon-date\"></span></button>\r\n    </div>\r\n    \r\n</div>\r\n\r\n\r\n\r\n<div #searchbox2 class=\"input-group f-search-box f-cmp-inputgroup f-multi-select-date\" [class.f-state-disabled]=\"!editable\" style=\"position:absolute;display: none; z-index: 2999;\"\r\n (mousedown)=\"$event.preventDefault()\" >\r\n    <div class=\"form-control f-cmp-inputgroup--multi-wrapper multi-more  d-flex\" style=\"height: auto; min-height: 26px;padding: 0px 5px;\">\r\n        <div class=\"multi--content d-flex flex-row\" style=\"width: 100%;flex-wrap: wrap;align-items: center;\" #tagContainer>\r\n            <span class=\"multi--item search-tag-item\" [class.multi-date-display-readonly]=\"!editable\" *ngFor=\"let txt of _dateItems; index as i\">\r\n                <span class=\"search-tag\">{{txt}}</span>\r\n                <i class=\"f-icon f-icon-close search-box_delete-keys\" *ngIf=\"editable\" style=\"top:5px\" (click)=\"onRemove($event, txt, i)\"></i>\r\n            </span>\r\n\r\n        </div>\r\n    </div>\r\n    <div class=\"input-group-append f-cmp-iconbtn-wrapper\" *ngIf=\"editable\" style=\"position: relative;\" (mouseenter)=\"$event.stopPropagation()\">\r\n        <span class=\"input-group-text input-group-clear datepicker-clear \" \r\n            style=\"position: absolute; height: 100%; right: 0px; top: 0px; z-index: 100; visibility: hidden;\">\r\n            <i class=\"f-icon modal_close\"></i></span>\r\n        <button class=\"btn f-cmp-iconbtn\" type=\"button\" (click)=\"onClick($event)\"><span class=\"f-icon f-icon-date\"></span></button>\r\n    </div>\r\n</div>\r\n",
                styles: [`
        .multi-date-display {
            width: 100%;flex-wrap: wrap;align-items: center;cursor: text;
        }

        .multi-date-display:empty:before {
            content: attr(placeholder);
            color: #c4c4c4;
        }

        .multi-date-display-readonly {
            padding-right: 5px;
        }

        .f-multi-select-date.f-state-disabled .search-tag-item {
            background: #F1F3F7;
            border: 1px solid #F1F3F7;
            color:  #2D2F33;
        }

        .f-multi-select-date.f-state-disabled .multi--more-text {
            color: #c7c7c7;
        }

        `]
            }] }
];
/** @nocollapse */
MultiSelectDateInputComponent.ctorParameters = () => [
    { type: Injector },
    { type: Renderer2 },
    { type: ElementRef },
    { type: OverLayHiddenService },
    { type: ChangeDetectorRef },
    { type: UtilService }
];
MultiSelectDateInputComponent.propDecorators = {
    dates: [{ type: Input }],
    separator: [{ type: Input }],
    placeholder: [{ type: Input }],
    editable: [{ type: Input }],
    orderBy: [{ type: Input }],
    clickHandle: [{ type: Output }],
    remove: [{ type: Output }],
    shadowBox: [{ type: ViewChild, args: ['searchbox2',] }],
    container: [{ type: ViewChild, args: ['searchbox',] }]
};
if (false) {
    /** @type {?} */
    MultiSelectDateInputComponent.prototype.dates;
    /** @type {?} */
    MultiSelectDateInputComponent.prototype.separator;
    /** @type {?} */
    MultiSelectDateInputComponent.prototype.placeholder;
    /** @type {?} */
    MultiSelectDateInputComponent.prototype.editable;
    /** @type {?} */
    MultiSelectDateInputComponent.prototype.orderBy;
    /** @type {?} */
    MultiSelectDateInputComponent.prototype.clickHandle;
    /** @type {?} */
    MultiSelectDateInputComponent.prototype.remove;
    /** @type {?} */
    MultiSelectDateInputComponent.prototype.shadowBox;
    /** @type {?} */
    MultiSelectDateInputComponent.prototype.container;
    /** @type {?} */
    MultiSelectDateInputComponent.prototype._dateItems;
    /** @type {?} */
    MultiSelectDateInputComponent.prototype.hiddenItemsCount$;
    /** @type {?} */
    MultiSelectDateInputComponent.prototype.commonUtils;
    /**
     * @type {?}
     * @private
     */
    MultiSelectDateInputComponent.prototype.injector;
    /**
     * @type {?}
     * @private
     */
    MultiSelectDateInputComponent.prototype.render;
    /**
     * @type {?}
     * @private
     */
    MultiSelectDateInputComponent.prototype.el;
    /** @type {?} */
    MultiSelectDateInputComponent.prototype.overLayService;
    /**
     * @type {?}
     * @protected
     */
    MultiSelectDateInputComponent.prototype.cd;
    /**
     * @type {?}
     * @private
     */
    MultiSelectDateInputComponent.prototype.utilService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibXVsdGktZGF0ZS1pbnB1dC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL3VpLWRhdGVwaWNrZXIvIiwic291cmNlcyI6WyJsaWIvbXVsdGktZGF0ZS1pbnB1dC9tdWx0aS1kYXRlLWlucHV0LmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFpQixpQkFBaUIsRUFBRSxTQUFTLEVBQUUsVUFBVSxFQUFFLFlBQVksRUFBRSxRQUFRLEVBQUUsS0FBSyxFQUFnQyxNQUFNLEVBQUUsU0FBUyxFQUFpQixTQUFTLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDbE0sT0FBTyxFQUFFLFdBQVcsRUFBRSxvQkFBb0IsRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBQ3RFLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDdkMsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLDRDQUE0QyxDQUFDO0FBbUN6RSxNQUFNLE9BQU8sNkJBQTZCOzs7Ozs7Ozs7SUFtQnRDLFlBQW9CLFFBQWtCLEVBQVUsTUFBaUIsRUFBVSxFQUFjLEVBQVMsY0FBb0MsRUFBWSxFQUFxQixFQUMzSixXQUF3QjtRQURoQixhQUFRLEdBQVIsUUFBUSxDQUFVO1FBQVUsV0FBTSxHQUFOLE1BQU0sQ0FBVztRQUFVLE9BQUUsR0FBRixFQUFFLENBQVk7UUFBUyxtQkFBYyxHQUFkLGNBQWMsQ0FBc0I7UUFBWSxPQUFFLEdBQUYsRUFBRSxDQUFtQjtRQUMzSixnQkFBVyxHQUFYLFdBQVcsQ0FBYTtRQWxCM0IsVUFBSyxHQUFHLEVBQUUsQ0FBQztRQUNYLGNBQVMsR0FBRyxHQUFHLENBQUM7UUFDaEIsZ0JBQVcsR0FBRyxFQUFFLENBQUM7UUFDakIsYUFBUSxHQUFHLElBQUksQ0FBQztRQUNoQixZQUFPLEdBQXlCLE1BQU0sQ0FBQztRQUV0QyxnQkFBVyxHQUFHLElBQUksWUFBWSxFQUFFLENBQUM7UUFDakMsV0FBTSxHQUFHLElB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O0lBRVAsaURBQTBCOzs7OztJQUFFLCtDQUF5Qjs7Ozs7SUFBRSwyQ0FBc0I7O0lBQUUsdURBQTJDOzs7OztJQUFFLDJDQUErQjs7Ozs7SUFDbkssb0RBQWdDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQWZ0ZXJWaWV3SW5pdCwgQ2hhbmdlRGV0ZWN0b3JSZWYsIENvbXBvbmVudCwgRWxlbWVudFJlZiwgRXZlbnRFbWl0dGVyLCBJbmplY3RvciwgSW5wdXQsIE9uQ2hhbmdlcywgT25EZXN0cm95LCBPbkluaXQsIE91dHB1dCwgUmVuZGVyZXIyLCBTaW1wbGVDaGFuZ2VzLCBWaWV3Q2hpbGQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgQ29tbW9uVXRpbHMsIE92ZXJMYXlIaWRkZW5TZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy91aS1jb21tb24nO1xyXG5pbXBvcnQgeyBCZWhhdmlvclN1YmplY3QgfSBmcm9tICdyeGpzJztcclxuaW1wb3J0IHsgVXRpbFNlcnZpY2UgfSBmcm9tICcuLi9zZXJ2aWNlcy9mYXJyaXMtZGF0ZXBpY2tlci51dGlsLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBNdWx0aVNlbGVjdGVkT3JkZXJCeSB9IGZyb20gJy4uL2ludGVyZmFjZXMvbXktb3B0aW9ucy5pbnRlcmZhY2UnO1xyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgICBzZWxlY3RvcjogJ211bHRpLXNlbGVjdC1pbnB1dCcsXHJcbiAgICB0ZW1wbGF0ZVVybDogJy4vbXVsdGktZGF0ZS1pbnB1dC5jb21wb25lbnQuaHRtbCcsXHJcbiAgICBzdHlsZXM6IFtcclxuICAgICAgICBgXHJcbiAgICAgICAgLm11bHRpLWRhdGUtZGlzcGxheSB7XHJcbiAgICAgICAgICAgIHdpZHRoOiAxMDAlO2ZsZXgtd3JhcDogd3JhcDthbGlnbi1pdGVtczogY2VudGVyO2N1cnNvcjogdGV4dDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC5tdWx0aS1kYXRlLWRpc3BsYXk6ZW1wdHk6YmVmb3JlIHtcclxuICAgICAgICAgICAgY29udGVudDogYXR0cihwbGFjZWhvbGRlcik7XHJcbiAgICAgICAgICAgIGNvbG9yOiAjYzRjNGM0O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLm11bHRpLWRhdGUtZGlzcGxheS1yZWFkb25seSB7XHJcbiAgICAgICAgICAgIHBhZGRpbmctcmlnaHQ6IDVweDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC5mLW11bHRpLXNlbGVjdC1kYXRlLmYtc3RhdGUtZGlzYWJsZWQgLnNlYXJjaC10YWctaXRlbSB7XHJcbiAgICAgICAgICAgIGJhY2tncm91bmQ6ICNGMUYzRjc7XHJcbiAgICAgICAgICAgIGJvcmRlcjogMXB4IHNvbGlkICNGMUYzRjc7XHJcbiAgICAgICAgICAgIGNvbG9yOiAgIzJEMkYzMztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC5mLW11bHRpLXNlbGVjdC1kYXRlLmYtc3RhdGUtZGlzYWJsZWQgLm11bHRpLS1tb3JlLXRleHQge1xyXG4gICAgICAgICAgICBjb2xvcjogI2M3YzdjNztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGBcclxuICAgIF1cclxufSlcclxuXHJcbmV4cG9ydCBjbGFzcyBNdWx0aVNlbGVjdERhdGVJbnB1dENvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgT25DaGFuZ2VzLCBBZnRlclZpZXdJbml0LCBPbkRlc3Ryb3kge1xyXG5cclxuICAgIEBJbnB1dCgpIGRhdGVzID0gJyc7XHJcbiAgICBASW5wdXQoKSBzZXBhcmF0b3IgPSAnLCc7XHJcbiAgICBASW5wdXQoKSBwbGFjZWhvbGRlciA9ICcnO1xyXG4gICAgQElucHV0KCkgZWRpdGFibGUgPSB0cnVlO1xyXG4gICAgQElucHV0KCkgb3JkZXJCeTogTXVsdGlTZWxlY3RlZE9yZGVyQnkgPSAnbm9uZSc7XHJcblxyXG4gICAgQE91dHB1dCgpIGNsaWNrSGFuZGxlID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG4gICAgQE91dHB1dCgpIHJlbW92ZSA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuXHJcbiAgICBAVmlld0NoaWxkKCdzZWFyY2hib3gyJykgc2hhZG93Qm94OiBFbGVtZW50UmVmO1xyXG4gICAgQFZpZXdDaGlsZCgnc2VhcmNoYm94JykgY29udGFpbmVyOiBFbGVtZW50UmVmO1xyXG5cclxuICAgIF9kYXRlSXRlbXMgPSBbXTtcclxuXHJcbiAgICBoaWRkZW5JdGVtc0NvdW50JCA9IG5ldyBCZWhhdmlvclN1YmplY3QoMCk7XHJcbiAgICBjb21tb25VdGlscyA9IG51bGw7XHJcblxyXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBpbmplY3RvcjogSW5qZWN0b3IsIHByaXZhdGUgcmVuZGVyOiBSZW5kZXJlcjIsIHByaXZhdGUgZWw6IEVsZW1lbnRSZWYsIHB1YmxpYyBvdmVyTGF5U2VydmljZTogT3ZlckxheUhpZGRlblNlcnZpY2UsIHByb3RlY3RlZCBjZDogQ2hhbmdlRGV0ZWN0b3JSZWYsXHJcbiAgICAgICAgcHJpdmF0ZSB1dGlsU2VydmljZTogVXRpbFNlcnZpY2UpIHtcclxuICAgICAgICB0aGlzLmNvbW1vblV0aWxzID0gdGhpcy5pbmplY3Rvci5nZXQoQ29tbW9uVXRpbHMsIG51bGwpO1xyXG4gICAgfVxyXG5cclxuICAgIG5nT25Jbml0KCkge1xyXG4gICAgICAgIFxyXG4gICAgfVxyXG5cclxuICAgIG5nT25EZXN0cm95KCkge1xyXG4gICAgICAgIGlmICh0aGlzLm92ZXJMYXlTZXJ2aWNlKSB7XHJcbiAgICAgICAgICAgIHRoaXMub3ZlckxheVNlcnZpY2UuZGVzdG9yeSh0aGlzLnNoYWRvd0JveC5uYXRpdmVFbGVtZW50KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHRoaXMuc2hhZG93Qm94KSB7XHJcbiAgICAgICAgICAgIHRoaXMuc2hhZG93Qm94Lm5hdGl2ZUVsZW1lbnQucmVtb3ZlKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpIHtcclxuICAgICAgICBpZiAoY2hhbmdlcy5kYXRlcyAmJiAhY2hhbmdlcy5kYXRlcy5pc0ZpcnN0Q2hhbmdlKCkpIHtcclxuICAgICAgICAgICAgdGhpcy5pbml0RGF0ZUl0ZW1zKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgaW5pdERhdGVJdGVtcygpIHtcclxuICAgICAgICBjb25zdCBfZGF0ZUl0ZW1zID0gdGhpcy5kYXRlcy5zcGxpdCh0aGlzLnNlcGFyYXRvcikuZmlsdGVyKG4gPT4gbik7XHJcbiAgICAgICAgdGhpcy5fZGF0ZUl0ZW1zID0gdGhpcy51dGlsU2VydmljZS5vcmRlclNlbGVjdGVkRGF0ZXMoX2RhdGVJdGVtcywgdGhpcy5vcmRlckJ5KTtcclxuXHJcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuc2V0SGlkZGVuQ291bnQoKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBuZ0FmdGVyVmlld0luaXQoKSB7XHJcblxyXG4gICAgICAgIHRoaXMuaW5pdERhdGVJdGVtcygpO1xyXG5cclxuICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgICAgdGhpcy5tb3ZlU2hhZG93VG9Cb2R5KCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgb25DbGljaygkZXZlbnQ6IE1vdXNlRXZlbnQpIHtcclxuICAgICAgICAkZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICAgICAgdGhpcy50b2dnbGVTaGFkb3dCb3goJGV2ZW50LCBmYWxzZSk7XHJcbiAgICAgICAgdGhpcy5jbGlja0hhbmRsZS5lbWl0KCRldmVudCk7XHJcbiAgICB9XHJcblxyXG4gICAgb25SZW1vdmUoJGV2ZW50OiBNb3VzZUV2ZW50LCB0eHQsIGluZGV4KSB7XHJcbiAgICAgICAgaWYgKCRldmVudCkge1xyXG4gICAgICAgICAgICAkZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMucmVtb3ZlLmVtaXQoe2luZGV4LCB2YWx1ZTogdHh0fSk7XHJcbiAgICB9XHJcblxyXG4gICAgXHJcbiAgICBvblJlc2l6ZWQoJGV2ZW50KSB7XHJcbiAgICAgICAgdGhpcy51cGRhdGVTaGFkb3dCb3hQb3NpdGlvbigkZXZlbnQpO1xyXG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLnNldEhpZGRlbkNvdW50KCk7XHJcbiAgICAgICAgICAgIHRoaXMuY2QuZGV0ZWN0Q2hhbmdlcygpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICBwcml2YXRlIHNldEhpZGRlbkNvdW50KCkge1xyXG4gICAgICAgIGxldCBsZW4gPSAwO1xyXG4gICAgICAgIGlmICghdGhpcy5fZGF0ZUl0ZW1zIHx8ICF0aGlzLl9kYXRlSXRlbXMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIHRoaXMuaGlkZGVuSXRlbXNDb3VudCQubmV4dChsZW4pO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IGl0ZW1zID0gQXJyYXkuZnJvbSh0aGlzLmNvbnRhaW5lci5uYXRpdmVFbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ3NwYW4uc2VhcmNoLXRhZy1pdGVtJykpO1xyXG4gICAgICAgIGlmIChpdGVtcyAmJiBpdGVtcy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgbGVuID0gaXRlbXMubWFwKChuOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBuLm9mZnNldFRvcDtcclxuICAgICAgICAgICAgfSkuZmlsdGVyKG4gPT4gbiA+IDIwKS5sZW5ndGhcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5oaWRkZW5JdGVtc0NvdW50JC5uZXh0KGxlbik7XHJcbiAgICB9XHJcblxyXG4gICAgXHJcbiAgICB1cGRhdGVTaGFkb3dCb3hQb3NpdGlvbih7dG9wLCBsZWZ0LCB3aWR0aH0gPSB7dG9wOiBudWxsLCBsZWZ0OiBudWxsLCB3aWR0aDogbnVsbH0pIHtcclxuICAgICAgICBpZiAoIXRvcCAmJiAhbGVmdCAmJiAhd2lkdGgpIHtcclxuICAgICAgICAgICAgY29uc3QgZSA9IHRoaXMuZWwubmF0aXZlRWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcclxuICAgICAgICAgICAgdG9wID0gZS50b3A7XHJcbiAgICAgICAgICAgIGxlZnQgPSBlLmxlZnQ7XHJcbiAgICAgICAgICAgIHdpZHRoID0gZS53aWR0aDtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5yZW5kZXIuc2V0U3R5bGUodGhpcy5zaGFkb3dCb3gubmF0aXZlRWxlbWVudCwgJ2xlZnQnLCBsZWZ0ICsgJ3B4Jyk7XHJcbiAgICAgICAgdGhpcy5yZW5kZXIuc2V0U3R5bGUodGhpcy5zaGFkb3dCb3gubmF0aXZlRWxlbWVudCwgJ3RvcCcsIHRvcCArICdweCcpO1xyXG4gICAgICAgIHRoaXMucmVuZGVyLnNldFN0eWxlKHRoaXMuc2hhZG93Qm94Lm5hdGl2ZUVsZW1lbnQsICd3aWR0aCcsIHdpZHRoICsgJ3B4Jyk7XHJcblxyXG4gICAgICAgIHRoaXMucmVuZGVyLnNldFN0eWxlKHRoaXMuc2hhZG93Qm94Lm5hdGl2ZUVsZW1lbnQsICd6SW5kZXgnLCB0aGlzLmNvbW1vblV0aWxzLmdldEZsb2F0aW5nTGF5ZXJJbmRleCgpKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIG1vdmVTaGFkb3dUb0JvZHkoKSB7XHJcbiAgICAgICAgdGhpcy51cGRhdGVTaGFkb3dCb3hQb3NpdGlvbigpO1xyXG4gICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kKHRoaXMuc2hhZG93Qm94Lm5hdGl2ZUVsZW1lbnQpO1xyXG5cclxuICAgICAgICB0aGlzLm92ZXJMYXlTZXJ2aWNlLnJlZ2lzdGVyTW91c2VFdmVudCh0aGlzLnNoYWRvd0JveC5uYXRpdmVFbGVtZW50LCAoZSkgPT4ge1xyXG4gICAgICAgICAgICBpZiAoZS50YXJnZXQgJiYgZS50YXJnZXQuY2xhc3NOYW1lLmluZGV4T2YoJ3NlYXJjaC1ib3hfZGVsZXRlLWtleXMnKSA+IC0xKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmICghdGhpcy5zaGFkb3dCb3ggfHwgdGhpcy5zaGFkb3dCb3gubmF0aXZlRWxlbWVudC5jb250YWlucyhlLnRhcmdldCkpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdGhpcy50b2dnbGVTaGFkb3dCb3gobnVsbCwgZmFsc2UpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgIH1cclxuXHJcbiAgICB0b2dnbGVTaGFkb3dCb3goJGV2ZW50LCBzaG93ID0gdHJ1ZSkge1xyXG4gICAgICAgIGlmICgkZXZlbnQpIHtcclxuICAgICAgICAgICAgJGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoIXRoaXMuaGlkZGVuSXRlbXNDb3VudCQudmFsdWUpIHtcclxuICAgICAgICAgICAgc2hvdyA9IGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoc2hvdykge1xyXG4gICAgICAgICAgICB0aGlzLnVwZGF0ZVNoYWRvd0JveFBvc2l0aW9uKCk7XHJcbiAgICAgICAgICAgIHRoaXMucmVuZGVyLnJlbW92ZVN0eWxlKHRoaXMuc2hhZG93Qm94Lm5hdGl2ZUVsZW1lbnQsICdkaXNwbGF5Jyk7XHJcbiAgICAgICAgICAgIHRoaXMuY29udGFpbmVyLm5hdGl2ZUVsZW1lbnQuc3R5bGUudmlzaWJpbGl0eSA9ICdoaWRkZW4nO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMuY29udGFpbmVyLm5hdGl2ZUVsZW1lbnQuc3R5bGUudmlzaWJpbGl0eSA9ICd2aXNpYmxlJztcclxuICAgICAgICAgICAgdGhpcy5yZW5kZXIuc2V0U3R5bGUodGhpcy5zaGFkb3dCb3gubmF0aXZlRWxlbWVudCwgJ2Rpc3BsYXknLCAnbm9uZScpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufSJdfQ==
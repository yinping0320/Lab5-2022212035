/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input, HostBinding, EventEmitter, Output } from '@angular/core';
import { ControlType } from '../../entity/controltype';
import { EnumType } from '../../entity/controltype/dropdownlist/enumtype';
import { EnumIntegerValue } from '../../entity/controltype/dropdownlist/integerenumvalue';
import { EnumStringValue } from '../../entity/controltype/dropdownlist/stringenumvalue';
import { EnumBoolValue } from '../../entity/controltype/dropdownlist/boolenumvalue';
import { SolutionService } from '../../service/solution.service';
var DropDownComponent = /** @class */ (function () {
    function DropDownComponent(solutionService) {
        this.solutionService = solutionService;
        this.enableClear = true;
        this.searchHandle = new EventEmitter();
        this.dropDownListDataSource = new Array();
        /**
         * 判断是否是在扩展区域展示
         */
        this.extend = false;
        /**
         * 判断是否显示label
         */
        this.showlabel = true;
    }
    Object.defineProperty(DropDownComponent.prototype, "isExtend", {
        get: /**
         * @return {?}
         */
        function () {
            return !this.extend && this.autoLabel;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(DropDownComponent.prototype, "hidenLabel", {
        get: /**
         * @return {?}
         */
        function () {
            return !this.showlabel;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    DropDownComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        // this.getDataSource();
        // const initialValue = this.item.value as DropDownListValue;
        // initialValue.value && (this.selectedItemId = initialValue.value.getEnumValue());
        if (this.item) {
            this.placeholder = this.item.placeHolder;
            // const type = Object.prototype.toString.call(this.item.placeHolder);
            // if(type == '[object Undefined]'){
            //     if(this.item.control && this.item.control.hasOwnProperty('placeholder')){
            //         this.placeholder = this.item.control.placeholder;
            //     }
            // }
            // else{
            //     this.placeholder = this.item.placeHolder;
            // }
        }
        this.getDataSource();
        /** @type {?} */
        var initialValue = (/** @type {?} */ (this.item.value));
        initialValue.value && (this.selectedItemId = initialValue.value);
        if (this.item && this.item.control && this.item.control.hasOwnProperty('isExtend')) {
            this.extend = this.item.control.isExtend;
            if (!this.extend) {
                this.showlabel = this.item.control.showLabel;
            }
        }
        // this.testId = this.solutionService.getGuid();
    };
    /**
     * @return {?}
     */
    DropDownComponent.prototype.ngOnChanges = /**
     * @return {?}
     */
    function () {
        this.getDataSource();
        //console.log(this.dropDownListDataSource);
    };
    /**
     * @return {?}
     */
    DropDownComponent.prototype.getDataSource = /**
     * @return {?}
     */
    function () {
        var _this = this;
        if (this.item && this.item.value
            && this.item.control && this.item.control.getControlType() == ControlType.DropDown) {
            /** @type {?} */
            var dropDownList = ((/** @type {?} */ (this.item.control)));
            if (dropDownList.valueType == EnumType.BoolType) {
                this.dropDownListDataSource = Array();
                if (dropDownList.enumValues && dropDownList.enumValues.length > 0) {
                    dropDownList.enumValues.forEach((/**
                     * @param {?} element
                     * @return {?}
                     */
                    function (element) {
                        _this.dropDownListDataSource.push(Object.assign(new EnumBoolValue(), element));
                    }));
                }
            }
            else if (dropDownList.valueType == EnumType.IntType) {
                this.dropDownListDataSource = Array();
                if (dropDownList.enumValues && dropDownList.enumValues.length > 0) {
                    dropDownList.enumValues.forEach((/**
                     * @param {?} element
                     * @return {?}
                     */
                    function (element) {
                        _this.dropDownListDataSource.push(Object.assign(new EnumIntegerValue(), element));
                    }));
                }
            }
            else if (dropDownList.valueType == EnumType.StringType) {
                this.dropDownListDataSource = Array();
                if (dropDownList.enumValues && dropDownList.enumValues.length > 0) {
                    dropDownList.enumValues.forEach((/**
                     * @param {?} element
                     * @return {?}
                     */
                    function (element) {
                        _this.dropDownListDataSource.push(Object.assign(new EnumStringValue(), element));
                    }));
                }
            }
        }
    };
    // getConditionItemStyle(field: QueryCondition, controlType: any) {
    //     return this.solutionService.getConditionItemStyle(field,controlType);
    // }
    // getConditionItemStyle(field: QueryCondition, controlType: any) {
    //     return this.solutionService.getConditionItemStyle(field,controlType);
    // }
    /**
     * @param {?} field
     * @return {?}
     */
    DropDownComponent.prototype.getConditionItemTitle = 
    // getConditionItemStyle(field: QueryCondition, controlType: any) {
    //     return this.solutionService.getConditionItemStyle(field,controlType);
    // }
    /**
     * @param {?} field
     * @return {?}
     */
    function (field) {
        return this.solutionService.getConditionItemTitle(field);
    };
    /**
     * @param {?} event
     * @return {?}
     */
    DropDownComponent.prototype.onSearch = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        if (event) {
            ((/** @type {?} */ (this.item.value))).value = event.data.value;
        }
        else {
            ((/** @type {?} */ (this.item.value))).value = '';
        }
        if (this.disabled) {
            return;
        }
        this.searchHandle.emit();
    };
    /**
     * @param {?} event
     * @return {?}
     */
    DropDownComponent.prototype.onClear = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        ((/** @type {?} */ (this.item.value))).value = '';
        this.searchHandle.emit();
    };
    DropDownComponent.decorators = [
        { type: Component, args: [{
                    selector: 'app-filter-dropdown',
                    template: "<label class=\"col-form-label\" *ngIf=\"item && showlabel\" title=\"{{getConditionItemTitle(item)}}\">\r\n    <span class=\"farris-label-info text-danger\" *ngIf=\"item.control.required\">*</span>\r\n    <span class=\"farris-label-text\">{{item.fieldName}}</span>\r\n</label>\r\n<div class=\"farris-input-wrap\" *ngIf=\"item\">\r\n    <farris-combo-list\r\n        [idField]=\"'value'\"\r\n        [textField]=\"'name'\"\r\n        [data]=\"dropDownListDataSource\"\r\n        [(ngModel)]=\"selectedItemId\"\r\n        [readonly]=\"disabled\"\r\n        [editable]=\"false\"\r\n        (selectChange)=\"onSearch($event)\"\r\n        (clear)=\"onClear($event)\"\r\n        [placeholder]=\"placeholder\"\r\n        [enableClear]=\"enableClear\"\r\n    ></farris-combo-list>\r\n\r\n</div>\r\n\r\n<!-- (valueChange)=\"onSearch($event)\" -->"
                }] }
    ];
    /** @nocollapse */
    DropDownComponent.ctorParameters = function () { return [
        { type: SolutionService }
    ]; };
    DropDownComponent.propDecorators = {
        item: [{ type: Input }],
        autoLabel: [{ type: Input }],
        disabled: [{ type: Input }],
        enableClear: [{ type: Input }],
        searchHandle: [{ type: Output, args: ['searchHandle',] }],
        isExtend: [{ type: HostBinding, args: ['class.filter-item-wrap',] }],
        hidenLabel: [{ type: HostBinding, args: ['class.filter-item-hiddenlabel',] }]
    };
    return DropDownComponent;
}());
export { DropDownComponent };
if (false) {
    /**
     * QueryCondition类型
     * @type {?}
     */
    DropDownComponent.prototype.item;
    /** @type {?} */
    DropDownComponent.prototype.autoLabel;
    /** @type {?} */
    DropDownComponent.prototype.disabled;
    /** @type {?} */
    DropDownComponent.prototype.enableClear;
    /** @type {?} */
    DropDownComponent.prototype.searchHandle;
    /** @type {?} */
    DropDownComponent.prototype.dropDownListDataSource;
    /**
     * 判断是否是在扩展区域展示
     * @type {?}
     */
    DropDownComponent.prototype.extend;
    /**
     * 判断是否显示label
     * @type {?}
     */
    DropDownComponent.prototype.showlabel;
    /** @type {?} */
    DropDownComponent.prototype.selectedItemId;
    /** @type {?} */
    DropDownComponent.prototype.placeholder;
    /**
     * @type {?}
     * @private
     */
    DropDownComponent.prototype.solutionService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZHJvcGRvd24uY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy91aS1maWx0ZXIvIiwic291cmNlcyI6WyJsaWIvY29tcG9uZW50cy9kcm9wZG93bmNvbXBvbmVudC9kcm9wZG93bi5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsS0FBSyxFQUFxQixXQUFXLEVBQUUsWUFBWSxFQUFFLE1BQU0sRUFBQyxNQUFNLGVBQWUsQ0FBQztBQUV0RyxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sMEJBQTBCLENBQUM7QUFFdkQsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLGdEQUFnRCxDQUFDO0FBQzFFLE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLHdEQUF3RCxDQUFDO0FBQzFGLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSx1REFBdUQsQ0FBQztBQUN4RixPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0scURBQXFELENBQUM7QUFDcEYsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLGdDQUFnQyxDQUFDO0FBR2pFO0lBbUNJLDJCQUFvQixlQUErQjtRQUEvQixvQkFBZSxHQUFmLGVBQWUsQ0FBZ0I7UUF0QjFDLGdCQUFXLEdBQUcsSUFBSSxDQUFDO1FBQ0osaUJBQVksR0FBRyxJQUFJLFlBQVksRUFBRSxDQUFDO1FBRTFELDJCQUFzQixHQUFZLElBQUksS0FBSyxFQUFPLENBQUM7Ozs7UUFFbkQsV0FBTSxHQUFXLEtBQUssQ0FBQzs7OztRQUV2QixjQUFTLEdBQVcsSUFBSSxDQUFDO0lBZTRCLENBQUM7SUFUdEQsc0JBQ0ksdUNBQVE7Ozs7UUFEWjtZQUVJLE9BQU8sQ0FBQyxJQUFJLENBQUMsTUFBTSxJQUFJLElBQUksQ0FBQyxTQUFTLENBQUM7UUFDMUMsQ0FBQzs7O09BQUE7SUFDRCxzQkFDSSx5Q0FBVTs7OztRQURkO1lBRUksT0FBTyxDQUFDLElBQUksQ0FBQyxTQUFTLENB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QUMsSUFBSSxDQUFDLEtBQUssRUFBcUIsQ0FBQyxDQUFDLEtBQUssR0FBRyxFQUFFLENBQUM7UUFDbEQsSUFBSSxDQUFDLFlBQVksQ0FBQyxJQUFJLEVBQUUsQ0FBQztJQUM3QixDQUFDOztnQkEzSEosU0FBUyxTQUFDO29CQUNQLFFBQVEsRUFBRSxxQkFBcUI7b0JBQy9CLGcxQkFBd0M7aUJBQzNDOzs7O2dCQU5RLGVBQWU7Ozt1QkFhbkIsS0FBSzs0QkFDTCxLQUFLOzJCQUNMLEtBQUs7OEJBQ0wsS0FBSzsrQkFDTCxNQUFNLFNBQUMsY0FBYzsyQkFZckIsV0FBVyxTQUFDLHdCQUF3Qjs2QkFJcEMsV0FBVyxTQUFDLCtCQUErQjs7SUE4RmhELHdCQUFDO0NBQUEsQUE1SEQsSUE0SEM7U0F2SFksaUJBQWlCOzs7Ozs7SUFLMUIsaUNBQWtCOztJQUNsQixzQ0FBMkI7O0lBQzNCLHFDQUEwQjs7SUFDMUIsd0NBQTRCOztJQUM1Qix5Q0FBMEQ7O0lBRTFELG1EQUFtRDs7Ozs7SUFFbkQsbUNBQXVCOzs7OztJQUV2QixzQ0FBeUI7O0lBRXpCLDJDQUFvQjs7SUFDcEIsd0NBQW9COzs7OztJQVlSLDRDQUF1QyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgSW5wdXQsIE9uSW5pdCwgT25DaGFuZ2VzLCBIb3N0QmluZGluZywgRXZlbnRFbWl0dGVyLCBPdXRwdXR9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBRdWVyeUNvbmRpdGlvbiB9IGZyb20gJy4uLy4uL2VudGl0eS9xdWVyeWNvbmRpdGlvbic7XHJcbmltcG9ydCB7IENvbnRyb2xUeXBlIH0gZnJvbSAnLi4vLi4vZW50aXR5L2NvbnRyb2x0eXBlJztcclxuaW1wb3J0IHsgRHJvcERvd25Db250cm9sIH0gZnJvbSAnLi4vLi4vZW50aXR5L2NvbnRyb2x0eXBlL2Ryb3Bkb3dubGlzdC9kcm9wZG93bmNvbnRyb2wnO1xyXG5pbXBvcnQgeyBFbnVtVHlwZSB9IGZyb20gJy4uLy4uL2VudGl0eS9jb250cm9sdHlwZS9kcm9wZG93bmxpc3QvZW51bXR5cGUnO1xyXG5pbXBvcnQgeyBFbnVtSW50ZWdlclZhbHVlIH0gZnJvbSAnLi4vLi4vZW50aXR5L2NvbnRyb2x0eXBlL2Ryb3Bkb3dubGlzdC9pbnRlZ2VyZW51bXZhbHVlJztcclxuaW1wb3J0IHsgRW51bVN0cmluZ1ZhbHVlIH0gZnJvbSAnLi4vLi4vZW50aXR5L2NvbnRyb2x0eXBlL2Ryb3Bkb3dubGlzdC9zdHJpbmdlbnVtdmFsdWUnO1xyXG5pbXBvcnQgeyBFbnVtQm9vbFZhbHVlIH0gZnJvbSAnLi4vLi4vZW50aXR5L2NvbnRyb2x0eXBlL2Ryb3Bkb3dubGlzdC9ib29sZW51bXZhbHVlJztcclxuaW1wb3J0IHsgU29sdXRpb25TZXJ2aWNlIH0gZnJvbSAnLi4vLi4vc2VydmljZS9zb2x1dGlvbi5zZXJ2aWNlJztcclxuaW1wb3J0IHsgRHJvcERvd25MaXN0VmFsdWUgfSBmcm9tICcuLi8uLi9lbnRpdHkvY29uZGl0aW9udmFsdWUvZHJvcGRvd25saXN0dmFsdWUnO1xyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgICBzZWxlY3RvcjogJ2FwcC1maWx0ZXItZHJvcGRvd24nLFxyXG4gICAgdGVtcGxhdGVVcmw6ICcuL2Ryb3Bkb3duLmNvbXBvbmVudC5odG1sJ1xyXG59KVxyXG5cclxuZXhwb3J0IGNsYXNzIERyb3BEb3duQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LE9uQ2hhbmdlc3tcclxuICAgXHJcbiAgICAvKipcclxuICAgICAqIFF1ZXJ5Q29uZGl0aW9u57G75Z6LXHJcbiAgICAgKi9cclxuICAgIEBJbnB1dCgpIGl0ZW06YW55O1xyXG4gICAgQElucHV0KCkgYXV0b0xhYmVsOmJvb2xlYW47XHJcbiAgICBASW5wdXQoKSBkaXNhYmxlZDpib29sZWFuO1xyXG4gICAgQElucHV0KCkgZW5hYmxlQ2xlYXIgPSB0cnVlO1xyXG4gICAgQE91dHB1dCgnc2VhcmNoSGFuZGxlJykgc2VhcmNoSGFuZGxlID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG5cclxuICAgIGRyb3BEb3duTGlzdERhdGFTb3VyY2U6QXJyYXk8YW55Pj1uZXcgQXJyYXk8YW55PigpO1xyXG4gICAgLyoq5Yik5pat5piv5ZCm5piv5Zyo5omp5bGV5Yy65Z+f5bGV56S6ICovXHJcbiAgICBleHRlbmQ6Ym9vbGVhbiA9IGZhbHNlO1xyXG4gICAgLyoq5Yik5pat5piv5ZCm5pi+56S6bGFiZWwgKi9cclxuICAgIHNob3dsYWJlbDpib29sZWFuID0gdHJ1ZTtcclxuICAgIFxyXG4gICAgc2VsZWN0ZWRJdGVtSWQ6IGFueTtcclxuICAgIHBsYWNlaG9sZGVyOiBzdHJpbmc7XHJcblxyXG5cclxuICAgIEBIb3N0QmluZGluZygnY2xhc3MuZmlsdGVyLWl0ZW0td3JhcCcpXHJcbiAgICBnZXQgaXNFeHRlbmQoKTogYm9vbGVhbiB7XHJcbiAgICAgICAgcmV0dXJuICF0aGlzLmV4dGVuZCAmJiB0aGlzLmF1dG9MYWJlbDtcclxuICAgIH1cclxuICAgIEBIb3N0QmluZGluZygnY2xhc3MuZmlsdGVyLWl0ZW0taGlkZGVubGFiZWwnKVxyXG4gICAgZ2V0IGhpZGVuTGFiZWwoKTogYm9vbGVhbiB7XHJcbiAgICAgICAgcmV0dXJuICF0aGlzLnNob3dsYWJlbDtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIHNvbHV0aW9uU2VydmljZTpTb2x1dGlvblNlcnZpY2Upe31cclxuXHJcbiAgICBuZ09uSW5pdCgpOiB2b2lkIHtcclxuICAgICAgICAvLyB0aGlzLmdldERhdGFTb3VyY2UoKTtcclxuICAgICAgICAvLyBjb25zdCBpbml0aWFsVmFsdWUgPSB0aGlzLml0ZW0udmFsdWUgYXMgRHJvcERvd25MaXN0VmFsdWU7XHJcbiAgICAgICAgLy8gaW5pdGlhbFZhbHVlLnZhbHVlICYmICh0aGlzLnNlbGVjdGVkSXRlbUlkID0gaW5pdGlhbFZhbHVlLnZhbHVlLmdldEVudW1WYWx1ZSgpKTtcclxuICAgICAgICBpZih0aGlzLml0ZW0pe1xyXG4gICAgICAgICAgICB0aGlzLnBsYWNlaG9sZGVyID0gdGhpcy5pdGVtLnBsYWNlSG9sZGVyO1xyXG4gICAgICAgICAgICAvLyBjb25zdCB0eXBlID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHRoaXMuaXRlbS5wbGFjZUhvbGRlcik7XHJcbiAgICAgICAgICAgIC8vIGlmKHR5cGUgPT0gJ1tvYmplY3QgVW5kZWZpbmVkXScpe1xyXG4gICAgICAgICAgICAvLyAgICAgaWYodGhpcy5pdGVtLmNvbnRyb2wgJiYgdGhpcy5pdGVtLmNvbnRyb2wuaGFzT3duUHJvcGVydHkoJ3BsYWNlaG9sZGVyJykpe1xyXG4gICAgICAgICAgICAvLyAgICAgICAgIHRoaXMucGxhY2Vob2xkZXIgPSB0aGlzLml0ZW0uY29udHJvbC5wbGFjZWhvbGRlcjtcclxuICAgICAgICAgICAgLy8gICAgIH1cclxuICAgICAgICAgICAgLy8gfVxyXG4gICAgICAgICAgICAvLyBlbHNle1xyXG4gICAgICAgICAgICAvLyAgICAgdGhpcy5wbGFjZWhvbGRlciA9IHRoaXMuaXRlbS5wbGFjZUhvbGRlcjtcclxuICAgICAgICAgICAgLy8gfVxyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmdldERhdGFTb3VyY2UoKTtcclxuICAgICAgICBjb25zdCBpbml0aWFsVmFsdWUgPSB0aGlzLml0ZW0udmFsdWUgYXMgRHJvcERvd25MaXN0VmFsdWU7XHJcbiAgICAgICAgaW5pdGlhbFZhbHVlLnZhbHVlICYmICh0aGlzLnNlbGVjdGVkSXRlbUlkID0gaW5pdGlhbFZhbHVlLnZhbHVlKTtcclxuICAgICAgICBpZih0aGlzLml0ZW0gJiYgdGhpcy5pdGVtLmNvbnRyb2wgJiYgdGhpcy5pdGVtLmNvbnRyb2wuaGFzT3duUHJvcGVydHkoJ2lzRXh0ZW5kJykpe1xyXG4gICAgICAgICAgICB0aGlzLmV4dGVuZCA9IHRoaXMuaXRlbS5jb250cm9sLmlzRXh0ZW5kO1xyXG4gICAgICAgICAgICBpZighdGhpcy5leHRlbmQpe1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zaG93bGFiZWwgPSB0aGlzLml0ZW0uY29udHJvbC5zaG93TGFiZWw7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICAgICAgLy8gdGhpcy50ZXN0SWQgPSB0aGlzLnNvbHV0aW9uU2VydmljZS5nZXRHdWlkKCk7XHJcbiAgICB9XHJcblxyXG4gICAgbmdPbkNoYW5nZXMoKTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy5nZXREYXRhU291cmNlKCk7XHJcbiAgICAgICAgLy9jb25zb2xlLmxvZyh0aGlzLmRyb3BEb3duTGlzdERhdGFTb3VyY2UpO1xyXG4gICAgfVxyXG5cclxuICAgIGdldERhdGFTb3VyY2UoKXtcclxuICAgICAgICBpZih0aGlzLml0ZW0mJnRoaXMuaXRlbS52YWx1ZVxyXG4gICAgICAgICAgICAmJnRoaXMuaXRlbS5jb250cm9sJiZ0aGlzLml0ZW0uY29udHJvbC5nZXRDb250cm9sVHlwZSgpPT1Db250cm9sVHlwZS5Ecm9wRG93bil7XHJcbiAgICAgICAgICAgICAgICBsZXQgZHJvcERvd25MaXN0PSh0aGlzLml0ZW0uY29udHJvbCBhcyBEcm9wRG93bkNvbnRyb2wpO1xyXG4gICAgICAgICAgICAgICAgaWYoZHJvcERvd25MaXN0LnZhbHVlVHlwZT09RW51bVR5cGUuQm9vbFR5cGUpe1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZHJvcERvd25MaXN0RGF0YVNvdXJjZT1BcnJheTxFbnVtQm9vbFZhbHVlPigpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmKGRyb3BEb3duTGlzdC5lbnVtVmFsdWVzJiZkcm9wRG93bkxpc3QuZW51bVZhbHVlcy5sZW5ndGg+MCl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRyb3BEb3duTGlzdC5lbnVtVmFsdWVzLmZvckVhY2goZWxlbWVudCA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRyb3BEb3duTGlzdERhdGFTb3VyY2UucHVzaChPYmplY3QuYXNzaWduKG5ldyBFbnVtQm9vbFZhbHVlKCksZWxlbWVudCkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIGlmKGRyb3BEb3duTGlzdC52YWx1ZVR5cGU9PUVudW1UeXBlLkludFR5cGUpe1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZHJvcERvd25MaXN0RGF0YVNvdXJjZT1BcnJheTxFbnVtSW50ZWdlclZhbHVlPigpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmKGRyb3BEb3duTGlzdC5lbnVtVmFsdWVzJiZkcm9wRG93bkxpc3QuZW51bVZhbHVlcy5sZW5ndGg+MCl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRyb3BEb3duTGlzdC5lbnVtVmFsdWVzLmZvckVhY2goZWxlbWVudCA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRyb3BEb3duTGlzdERhdGFTb3VyY2UucHVzaChPYmplY3QuYXNzaWduKG5ldyBFbnVtSW50ZWdlclZhbHVlKCksZWxlbWVudCkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIGlmKGRyb3BEb3duTGlzdC52YWx1ZVR5cGU9PUVudW1UeXBlLlN0cmluZ1R5cGUpe1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZHJvcERvd25MaXN0RGF0YVNvdXJjZT1BcnJheTxFbnVtU3RyaW5nVmFsdWU+KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYoZHJvcERvd25MaXN0LmVudW1WYWx1ZXMmJmRyb3BEb3duTGlzdC5lbnVtVmFsdWVzLmxlbmd0aD4wKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZHJvcERvd25MaXN0LmVudW1WYWx1ZXMuZm9yRWFjaChlbGVtZW50ID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZHJvcERvd25MaXN0RGF0YVNvdXJjZS5wdXNoKE9iamVjdC5hc3NpZ24obmV3IEVudW1TdHJpbmdWYWx1ZSgpLGVsZW1lbnQpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLy8gZ2V0Q29uZGl0aW9uSXRlbVN0eWxlKGZpZWxkOiBRdWVyeUNvbmRpdGlvbiwgY29udHJvbFR5cGU6IGFueSkge1xyXG4gICAgLy8gICAgIHJldHVybiB0aGlzLnNvbHV0aW9uU2VydmljZS5nZXRDb25kaXRpb25JdGVtU3R5bGUoZmllbGQsY29udHJvbFR5cGUpO1xyXG4gICAgLy8gfVxyXG5cclxuICAgIGdldENvbmRpdGlvbkl0ZW1UaXRsZShmaWVsZDpRdWVyeUNvbmRpdGlvbil7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuc29sdXRpb25TZXJ2aWNlLmdldENvbmRpdGlvbkl0ZW1UaXRsZShmaWVsZCk7XHJcbiAgICB9XHJcblxyXG4gICAgb25TZWFyY2goZXZlbnQpe1xyXG4gICAgICAgIGlmKGV2ZW50KXtcclxuICAgICAgICAgICAgKHRoaXMuaXRlbS52YWx1ZSBhcyBEcm9wRG93bkxpc3RWYWx1ZSkudmFsdWUgPSBldmVudC5kYXRhLnZhbHVlO1xyXG4gICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICAodGhpcy5pdGVtLnZhbHVlIGFzIERyb3BEb3duTGlzdFZhbHVlKS52YWx1ZSA9ICcnO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZih0aGlzLmRpc2FibGVkKXtyZXR1cm47fVxyXG4gICAgICAgIHRoaXMuc2VhcmNoSGFuZGxlLmVtaXQoKTtcclxuICAgIH1cclxuXHJcbiAgICBvbkNsZWFyKGV2ZW50KXtcclxuICAgICAgICAodGhpcy5pdGVtLnZhbHVlIGFzIERyb3BEb3duTGlzdFZhbHVlKS52YWx1ZSA9ICcnO1xyXG4gICAgICAgIHRoaXMuc2VhcmNoSGFuZGxlLmVtaXQoKTtcclxuICAgIH1cclxufSJdfQ==
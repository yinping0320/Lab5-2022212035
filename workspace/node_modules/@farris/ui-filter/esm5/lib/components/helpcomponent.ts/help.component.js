/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input, HostBinding, Output, EventEmitter } from '@angular/core';
import { ControlType } from '../../entity/controltype';
import { deepCopy } from '../../utils';
import { SolutionService } from '../../service/solution.service';
// import { ServerSideToken } from '@farris/ui-lookup';
// import { LookupHttpBeQueryService } from './service/Lookup-http.service';
import { of } from 'rxjs';
var HelpComponent = /** @class */ (function () {
    function HelpComponent(solutionService) {
        var _this = this;
        this.solutionService = solutionService;
        this.searchHandle = new EventEmitter();
        /**
         * 判断是否是在扩展区域展示
         */
        this.extend = false;
        /**
         * 判断是否显示label
         */
        this.showlabel = true;
        this.onSearch = (/**
         * @return {?}
         */
        function () {
            if (_this.disabled) {
                return;
            }
            _this.searchHandle.emit();
            return of(true);
        });
    }
    Object.defineProperty(HelpComponent.prototype, "isExtend", {
        get: /**
         * @return {?}
         */
        function () {
            return !this.extend && this.autoLabel;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(HelpComponent.prototype, "hidenLabel", {
        get: /**
         * @return {?}
         */
        function () {
            return !this.showlabel;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    HelpComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        if (this.item) {
            this.placeholder = this.item.placeHolder;
            // const type = Object.prototype.toString.call(this.item.placeHolder);
            // if(type == '[object Undefined]'){
            //     if(this.item.control && this.item.control.hasOwnProperty('placeholder')){
            //         this.placeholder = this.item.control.placeholder;
            //     }
            // }
            // else{
            //     this.placeholder = this.item.placeHolder;
            // }
        }
        this.getHelpBindingInfo();
        if (this.item && this.item.control && this.item.control.hasOwnProperty('isExtend')) {
            this.extend = this.item.control.isExtend;
            if (!this.extend) {
                this.showlabel = this.item.control.showLabel;
            }
        }
    };
    /**
     * @return {?}
     */
    HelpComponent.prototype.ngOnChanges = /**
     * @return {?}
     */
    function () {
        this.getHelpBindingInfo();
    };
    /**
     * @param {?} selectedItem
     * @return {?}
     */
    HelpComponent.prototype.selectedDataHandler = /**
     * @param {?} selectedItem
     * @return {?}
     */
    function (selectedItem) {
        // console.log(selectedItem);
        //    let mapFields=new Function('return'+(this.item.control as HelpContol).mapFields);
        //    let mapFieldsKeys=Object.keys(mapFields());
        //    (this.item.value as HelpValue).value=new Object();
        //    mapFieldsKeys.forEach(mapFeildKey => {
        //     (this.item.value as HelpValue).value[mapFeildKey]=selectedItem[mapFeildKey];
        //    });
        //    (this.item.value as HelpValue).valueField=(this.item.control as HelpContol).valueField;
        //    let textField=(this.item.control as HelpContol).textField;
        //    this.textValue=(this.item.value as HelpValue).value[textField];
        // console.log(selectedItem);
        //    let mapFields=new Function('return'+(this.item.control as HelpContol).mapFields);
        //    let mapFieldsKeys=Object.keys(mapFields());
        //    (this.item.value as HelpValue).value=new Object();
        //    mapFieldsKeys.forEach(mapFeildKey => {
        //     (this.item.value as HelpValue).value[mapFeildKey]=selectedItem[mapFeildKey];
        //    });
        //    (this.item.value as HelpValue).valueField=(this.item.control as HelpContol).valueField;
        //    let textField=(this.item.control as HelpContol).textField;
        //    this.textValue=(this.item.value as HelpValue).value[textField];
        /** @type {?} */
        var helpValue = ((/** @type {?} */ (this.item.value)));
        helpValue.value = this.singleSelect ? [selectedItem] : selectedItem; //单选返回对象，多选返回数组
        helpValue.valueField = this.valueField;
        helpValue.textValue = helpValue.getTextValue(this.textField);
        this.textValue = helpValue.textValue;
        // this.conditionChange.emit();
        if (this.disabled) {
            return;
        }
        this.searchHandle.emit();
    };
    /**
     * @return {?}
     */
    HelpComponent.prototype.getHelpBindingInfo = /**
     * @return {?}
     */
    function () {
        var _this = this;
        if (this.item && this.item.control && this.item.control.getControlType() == ControlType.Help) {
            /** @type {?} */
            var helpList_1 = ((/** @type {?} */ (this.item.control)));
            this.uri = helpList_1.uri;
            this.textField = helpList_1.textField;
            this.valueField = helpList_1.valueField;
            this.idField = helpList_1.idField;
            this.mapFields = helpList_1.mapFields;
            this.context = helpList_1.context;
            this.preEventCmd = helpList_1.preEventCmd;
            this.postEventCmd = helpList_1.postEventCmd;
            if (helpList_1.preEventCmd) {
                this.preEventCmd = (/**
                 * @param {?} e
                 * @return {?}
                 */
                function (e) {
                    e['hostRef'] = _this.hostRef;
                    return helpList_1.preEventCmd(e);
                });
            }
            if (helpList_1.postEventCmd) {
                this.postEventCmd = (/**
                 * @param {?} e
                 * @return {?}
                 */
                function (e) {
                    /** @type {?} */
                    var selectItem = deepCopy(e);
                    selectItem['hostRef'] = _this.hostRef;
                    return helpList_1.postEventCmd(selectItem);
                });
            }
            this.singleSelect = helpList_1.singleSelect;
            this.enableFullTree = helpList_1.enableFullTree;
            this.loadTreeDataType = helpList_1.loadTreeDataType;
            this.expandLevel = helpList_1.expandLevel;
            this.enableCascade = helpList_1.enableCascade;
            this.helpId = helpList_1.helpId;
            /** @type {?} */
            var helpValue = ((/** @type {?} */ (this.item.value)));
            // if (helpValue && helpValue.value) {
            //     // this.textValue = (this.item.value as HelpValue).value[this.textField];
            //     this.textValue = HelpValue.getPropValue(helpValue.value, this.textField.split('.'));
            // }
            this.displayType = helpList_1.displayType;
            if (helpValue.textValue == 'help-text-value-null') { // 旧数据兼容
                this.textValue = helpValue.getTextValue(this.textField);
            }
            else {
                this.textValue = helpValue.textValue;
            }
        }
    };
    // getConditionItemStyle(field: QueryCondition, controlType: any) {
    //     return this.solutionService.getConditionItemStyle(field,controlType);
    // }
    // getConditionItemStyle(field: QueryCondition, controlType: any) {
    //     return this.solutionService.getConditionItemStyle(field,controlType);
    // }
    /**
     * @param {?} field
     * @return {?}
     */
    HelpComponent.prototype.getConditionItemTitle = 
    // getConditionItemStyle(field: QueryCondition, controlType: any) {
    //     return this.solutionService.getConditionItemStyle(field,controlType);
    // }
    /**
     * @param {?} field
     * @return {?}
     */
    function (field) {
        return this.solutionService.getConditionItemTitle(field);
    };
    // clearData(event){
    //     (this.item.value as HelpValue).value = null;
    //     (this.item.value as HelpValue).valueField = null;
    //     this.searchHandle.emit();
    // }
    // clearData(event){
    //     (this.item.value as HelpValue).value = null;
    //     (this.item.value as HelpValue).valueField = null;
    //     this.searchHandle.emit();
    // }
    /**
     * @param {?} data
     * @return {?}
     */
    HelpComponent.prototype.clearData = 
    // clearData(event){
    //     (this.item.value as HelpValue).value = null;
    //     (this.item.value as HelpValue).valueField = null;
    //     this.searchHandle.emit();
    // }
    /**
     * @param {?} data
     * @return {?}
     */
    function (data) {
        ((/** @type {?} */ (this.item.value))).clearValue();
        this.searchHandle.emit();
    };
    HelpComponent.decorators = [
        { type: Component, args: [{
                    selector: 'app-filter-help',
                    template: "<label class=\"col-form-label\" *ngIf=\"item && showlabel\" title=\"{{getConditionItemTitle(item)}}\">\r\n    <span class=\"farris-label-info text-danger\" *ngIf=\"item.control.required\">*</span>\r\n    <span class=\"farris-label-text\">{{item.fieldName}}</span>\r\n</label>\r\n<div class=\"farris-input-wrap\" *ngIf=\"item\">\r\n    <farris-lookup-grid\r\n        id=\"{{instanceId}}\"\r\n        [uri]=\"uri\" \r\n        [idField]=\"idField\" \r\n        [textField]=\"textField\" \r\n        [valueField]=\"valueField\" \r\n        [(ngModel)]=\"textValue\"\r\n        [displayType]=\"displayType\"\r\n        [editable]=\"false\"\r\n        [readonly]=\"disabled\"\r\n        (clear)=\"clearData($event)\"\r\n        (selectedData)=\"selectedDataHandler($event)\"\r\n        [placeholder]=\"placeholder\"\r\n        [mapFields]=\"mapFields\"\r\n        [dictPicking]=\"preEventCmd\"\r\n        [dictPicked]=\"postEventCmd\"\r\n        [context]=\"context\"\r\n        [enableFullTree]=\"enableFullTree\"\r\n        [loadTreeDataType]=\"loadTreeDataType\"\r\n        [singleSelect]=\"singleSelect\"\r\n        [expandLevel]=\"expandLevel\"\r\n        [enableCascade]=\"enableCascade\"\r\n        [useFavorite]=\"true\"\r\n    >\r\n    </farris-lookup-grid>\r\n\r\n    <!-- [dictPicked]=\"onSearch\" -->\r\n    <!-- (selectedData)=\"selectedDataHandler($event)\" -->\r\n</div>"
                    // providers: [{ provide: ServerSideToken, useClass: LookupHttpBeQueryService }]
                }] }
    ];
    /** @nocollapse */
    HelpComponent.ctorParameters = function () { return [
        { type: SolutionService }
    ]; };
    HelpComponent.propDecorators = {
        item: [{ type: Input }],
        autoLabel: [{ type: Input }],
        disabled: [{ type: Input }],
        hostRef: [{ type: Input }],
        instanceId: [{ type: Input }],
        searchHandle: [{ type: Output, args: ['searchHandle',] }],
        isExtend: [{ type: HostBinding, args: ['class.filter-item-wrap',] }],
        hidenLabel: [{ type: HostBinding, args: ['class.filter-item-hiddenlabel',] }]
    };
    return HelpComponent;
}());
export { HelpComponent };
if (false) {
    /**
     * QueryCondition类型
     * @type {?}
     */
    HelpComponent.prototype.item;
    /** @type {?} */
    HelpComponent.prototype.autoLabel;
    /** @type {?} */
    HelpComponent.prototype.disabled;
    /** @type {?} */
    HelpComponent.prototype.hostRef;
    /** @type {?} */
    HelpComponent.prototype.instanceId;
    /** @type {?} */
    HelpComponent.prototype.searchHandle;
    /** @type {?} */
    HelpComponent.prototype.uri;
    /** @type {?} */
    HelpComponent.prototype.textField;
    /** @type {?} */
    HelpComponent.prototype.idField;
    /** @type {?} */
    HelpComponent.prototype.valueField;
    /** @type {?} */
    HelpComponent.prototype.textValue;
    /** @type {?} */
    HelpComponent.prototype.displayType;
    /** @type {?} */
    HelpComponent.prototype.mapFields;
    /** @type {?} */
    HelpComponent.prototype.context;
    /** @type {?} */
    HelpComponent.prototype.preEventCmd;
    /** @type {?} */
    HelpComponent.prototype.postEventCmd;
    /** @type {?} */
    HelpComponent.prototype.enableFullTree;
    /** @type {?} */
    HelpComponent.prototype.loadTreeDataType;
    /** @type {?} */
    HelpComponent.prototype.singleSelect;
    /** @type {?} */
    HelpComponent.prototype.expandLevel;
    /** @type {?} */
    HelpComponent.prototype.enableCascade;
    /** @type {?} */
    HelpComponent.prototype.helpId;
    /**
     * 判断是否是在扩展区域展示
     * @type {?}
     */
    HelpComponent.prototype.extend;
    /**
     * 判断是否显示label
     * @type {?}
     */
    HelpComponent.prototype.showlabel;
    /** @type {?} */
    HelpComponent.prototype.placeholder;
    /** @type {?} */
    HelpComponent.prototype.onSearch;
    /**
     * @type {?}
     * @private
     */
    HelpComponent.prototype.solutionService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaGVscC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL3VpLWZpbHRlci8iLCJzb3VyY2VzIjpbImxpYi9jb21wb25lbnRzL2hlbHBjb21wb25lbnQudHMvaGVscC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsS0FBSyxFQUFxQixXQUFXLEVBQUUsTUFBTSxFQUFFLFlBQVksRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUV2RyxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sMEJBQTBCLENBQUM7QUFHdkQsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLGFBQWEsQ0FBQztBQUN2QyxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sZ0NBQWdDLENBQUM7OztBQU1qRSxPQUFPLEVBQUUsRUFBRSxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBRTFCO0lBcURJLHVCQUFvQixlQUFnQztRQUFwRCxpQkFBeUQ7UUFBckMsb0JBQWUsR0FBZixlQUFlLENBQWlCO1FBbEM1QixpQkFBWSxHQUFHLElBQUksWUFBWSxFQUFFLENBQUM7Ozs7UUFvQjFELFdBQU0sR0FBWSxLQUFLLENBQUM7Ozs7UUFFeEIsY0FBUyxHQUFZLElBQUksQ0FBQztRQXdIMUIsYUFBUTs7O1FBQUc7WUFDUCxJQUFJLEtBQUksQ0FBQyxRQUFRLEVBQUU7Z0JBQUUsT0FBTzthQUFFO1lBQzlCLEtBQUksQ0FBQyxZQUFZLENBQUMsSUFBSSxFQUFFLENBQUM7WUFDekIsT0FBTyxFQUFFLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDcEIsQ0FBQyxFQUFBO0lBaEh1RCxDQUFDO0lBVHpELHNCQUNJLG1DQUFROzs7O1FBRFo7WUFFSSxPQUFPLENBQUMsSUFBSSxDQUFDLE1BQU0sSUFBSSxJQUFJLENBQUMsU0FBUyxDQUFDO1FBQzFDLENBQUM7OztPQUFBO0lBQ0Qsc0JBQ0kscUNBQVU7Ozs7UUFEZDtZQUVJLE9BQU8sQ0FBQyxJQUFJLENB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QUE0Qjs7SUFDNUIsaUNBQTJCOztJQUUzQixnQ0FBc0I7O0lBRXRCLG1DQUE0Qjs7SUFFNUIscUNBQTBEOztJQUUxRCw0QkFBWTs7SUFDWixrQ0FBa0I7O0lBQ2xCLGdDQUFnQjs7SUFDaEIsbUNBQWdCOztJQUNoQixrQ0FBZTs7SUFDZixvQ0FBeUI7O0lBQ3pCLGtDQUFlOztJQUNmLGdDQUFhOztJQUNiLG9DQUFpQjs7SUFDakIscUNBQWtCOztJQUNsQix1Q0FBd0I7O0lBQ3hCLHlDQUFzRDs7SUFDdEQscUNBQXNCOztJQUN0QixvQ0FBb0I7O0lBQ3BCLHNDQUF1Qjs7SUFDdkIsK0JBQWU7Ozs7O0lBR2YsK0JBQXdCOzs7OztJQUV4QixrQ0FBMEI7O0lBQzFCLG9DQUFvQjs7SUF1SHBCLGlDQUlDOzs7OztJQWhIVyx3Q0FBd0MiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIElucHV0LCBPbkluaXQsIE9uQ2hhbmdlcywgSG9zdEJpbmRpbmcsIE91dHB1dCwgRXZlbnRFbWl0dGVyIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IFF1ZXJ5Q29uZGl0aW9uIH0gZnJvbSAnLi4vLi4vZW50aXR5L3F1ZXJ5Y29uZGl0aW9uJztcclxuaW1wb3J0IHsgQ29udHJvbFR5cGUgfSBmcm9tICcuLi8uLi9lbnRpdHkvY29udHJvbHR5cGUnO1xyXG5pbXBvcnQgeyBIZWxwQ29udG9sIH0gZnJvbSAnLi4vLi4vZW50aXR5L2NvbnRyb2x0eXBlL2hlbHAvaGVscGNvbnRyb2wnO1xyXG5pbXBvcnQgeyBJQ29udHJvbCB9IGZyb20gJy4uLy4uL2VudGl0eS9jb250cm9sdHlwZS9pY29udHJvbCc7XHJcbmltcG9ydCB7IGRlZXBDb3B5IH0gZnJvbSAnLi4vLi4vdXRpbHMnO1xyXG5pbXBvcnQgeyBTb2x1dGlvblNlcnZpY2UgfSBmcm9tICcuLi8uLi9zZXJ2aWNlL3NvbHV0aW9uLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBIZWxwVmFsdWUgfSBmcm9tICcuLi8uLi9lbnRpdHkvY29uZGl0aW9udmFsdWUvaGVscHZhbHVlJztcclxuaW1wb3J0IHsgRGlzcGxheVR5cGUgfSBmcm9tICcuLi8uLi9lbnRpdHkvY29udHJvbHR5cGUvaGVscC9kaXNwbGF5VHlwZSc7XHJcblxyXG4vLyBpbXBvcnQgeyBTZXJ2ZXJTaWRlVG9rZW4gfSBmcm9tICdAZmFycmlzL3VpLWxvb2t1cCc7XHJcbi8vIGltcG9ydCB7IExvb2t1cEh0dHBCZVF1ZXJ5U2VydmljZSB9IGZyb20gJy4vc2VydmljZS9Mb29rdXAtaHR0cC5zZXJ2aWNlJztcclxuaW1wb3J0IHsgb2YgfSBmcm9tICdyeGpzJztcclxuXHJcbkBDb21wb25lbnQoe1xyXG4gICAgc2VsZWN0b3I6ICdhcHAtZmlsdGVyLWhlbHAnLFxyXG4gICAgdGVtcGxhdGVVcmw6ICcuL2hlbHAuY29tcG9uZW50Lmh0bWwnXHJcbiAgICAvLyBwcm92aWRlcnM6IFt7IHByb3ZpZGU6IFNlcnZlclNpZGVUb2tlbiwgdXNlQ2xhc3M6IExvb2t1cEh0dHBCZVF1ZXJ5U2VydmljZSB9XVxyXG59KVxyXG5cclxuZXhwb3J0IGNsYXNzIEhlbHBDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIE9uQ2hhbmdlcyB7XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBRdWVyeUNvbmRpdGlvbuexu+Wei1xyXG4gICAgICovXHJcbiAgICBASW5wdXQoKSBpdGVtOiBhbnk7XHJcbiAgICBASW5wdXQoKSBhdXRvTGFiZWw6IGJvb2xlYW47XHJcbiAgICBASW5wdXQoKSBkaXNhYmxlZDogYm9vbGVhbjtcclxuXHJcbiAgICBASW5wdXQoKSBob3N0UmVmOiBhbnk7XHJcblxyXG4gICAgQElucHV0KCkgaW5zdGFuY2VJZDogc3RyaW5nO1xyXG5cclxuICAgIEBPdXRwdXQoJ3NlYXJjaEhhbmRsZScpIHNlYXJjaEhhbmRsZSA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuXHJcbiAgICB1cmk6IHN0cmluZztcclxuICAgIHRleHRGaWVsZDogc3RyaW5nO1xyXG4gICAgaWRGaWVsZDogc3RyaW5nO1xyXG4gICAgdmFsdWVGaWVsZDogYW55O1xyXG4gICAgdGV4dFZhbHVlOiBhbnk7XHJcbiAgICBkaXNwbGF5VHlwZTogRGlzcGxheVR5cGU7XHJcbiAgICBtYXBGaWVsZHM6IGFueTtcclxuICAgIGNvbnRleHQ6IGFueTtcclxuICAgIHByZUV2ZW50Q21kOiBhbnk7XHJcbiAgICBwb3N0RXZlbnRDbWQ6IGFueTtcclxuICAgIGVuYWJsZUZ1bGxUcmVlOiBib29sZWFuO1xyXG4gICAgbG9hZFRyZWVEYXRhVHlwZTogJ2RlZmF1bHQnIHwgJ2xvYWRhbGwnIHwgJ2xheWVybG9hZCc7XHJcbiAgICBzaW5nbGVTZWxlY3Q6IGJvb2xlYW47XHJcbiAgICBleHBhbmRMZXZlbDogbnVtYmVyO1xyXG4gICAgZW5hYmxlQ2FzY2FkZTogYm9vbGVhbjtcclxuICAgIGhlbHBJZDogc3RyaW5nO1xyXG5cclxuICAgIC8qKuWIpOaWreaYr+WQpuaYr+WcqOaJqeWxleWMuuWfn+WxleekuiAqL1xyXG4gICAgZXh0ZW5kOiBib29sZWFuID0gZmFsc2U7XHJcbiAgICAvKirliKTmlq3mmK/lkKbmmL7npLpsYWJlbCAqL1xyXG4gICAgc2hvd2xhYmVsOiBib29sZWFuID0gdHJ1ZTtcclxuICAgIHBsYWNlaG9sZGVyOiBzdHJpbmc7XHJcblxyXG4gICAgQEhvc3RCaW5kaW5nKCdjbGFzcy5maWx0ZXItaXRlbS13cmFwJylcclxuICAgIGdldCBpc0V4dGVuZCgpOiBib29sZWFuIHtcclxuICAgICAgICByZXR1cm4gIXRoaXMuZXh0ZW5kICYmIHRoaXMuYXV0b0xhYmVsO1xyXG4gICAgfVxyXG4gICAgQEhvc3RCaW5kaW5nKCdjbGFzcy5maWx0ZXItaXRlbS1oaWRkZW5sYWJlbCcpXHJcbiAgICBnZXQgaGlkZW5MYWJlbCgpOiBib29sZWFuIHtcclxuICAgICAgICByZXR1cm4gIXRoaXMuc2hvd2xhYmVsO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgc29sdXRpb25TZXJ2aWNlOiBTb2x1dGlvblNlcnZpY2UpIHsgfVxyXG5cclxuICAgIG5nT25Jbml0KCk6IHZvaWQge1xyXG4gICAgICAgIGlmICh0aGlzLml0ZW0pIHtcclxuICAgICAgICAgICAgdGhpcy5wbGFjZWhvbGRlciA9IHRoaXMuaXRlbS5wbGFjZUhvbGRlcjtcclxuICAgICAgICAgICAgLy8gY29uc3QgdHlwZSA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh0aGlzLml0ZW0ucGxhY2VIb2xkZXIpO1xyXG4gICAgICAgICAgICAvLyBpZih0eXBlID09ICdbb2JqZWN0IFVuZGVmaW5lZF0nKXtcclxuICAgICAgICAgICAgLy8gICAgIGlmKHRoaXMuaXRlbS5jb250cm9sICYmIHRoaXMuaXRlbS5jb250cm9sLmhhc093blByb3BlcnR5KCdwbGFjZWhvbGRlcicpKXtcclxuICAgICAgICAgICAgLy8gICAgICAgICB0aGlzLnBsYWNlaG9sZGVyID0gdGhpcy5pdGVtLmNvbnRyb2wucGxhY2Vob2xkZXI7XHJcbiAgICAgICAgICAgIC8vICAgICB9XHJcbiAgICAgICAgICAgIC8vIH1cclxuICAgICAgICAgICAgLy8gZWxzZXtcclxuICAgICAgICAgICAgLy8gICAgIHRoaXMucGxhY2Vob2xkZXIgPSB0aGlzLml0ZW0ucGxhY2VIb2xkZXI7XHJcbiAgICAgICAgICAgIC8vIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5nZXRIZWxwQmluZGluZ0luZm8oKTtcclxuICAgICAgICBpZiAodGhpcy5pdGVtICYmIHRoaXMuaXRlbS5jb250cm9sICYmIHRoaXMuaXRlbS5jb250cm9sLmhhc093blByb3BlcnR5KCdpc0V4dGVuZCcpKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZXh0ZW5kID0gdGhpcy5pdGVtLmNvbnRyb2wuaXNFeHRlbmQ7XHJcbiAgICAgICAgICAgIGlmICghdGhpcy5leHRlbmQpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2hvd2xhYmVsID0gdGhpcy5pdGVtLmNvbnRyb2wuc2hvd0xhYmVsO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIG5nT25DaGFuZ2VzKCk6IHZvaWQge1xyXG4gICAgICAgIHRoaXMuZ2V0SGVscEJpbmRpbmdJbmZvKCk7XHJcbiAgICB9XHJcblxyXG4gICAgc2VsZWN0ZWREYXRhSGFuZGxlcihzZWxlY3RlZEl0ZW06IGFueSkge1xyXG4gICAgICAgIC8vIGNvbnNvbGUubG9nKHNlbGVjdGVkSXRlbSk7XHJcbiAgICAgICAgLy8gICAgbGV0IG1hcEZpZWxkcz1uZXcgRnVuY3Rpb24oJ3JldHVybicrKHRoaXMuaXRlbS5jb250cm9sIGFzIEhlbHBDb250b2wpLm1hcEZpZWxkcyk7XHJcbiAgICAgICAgLy8gICAgbGV0IG1hcEZpZWxkc0tleXM9T2JqZWN0LmtleXMobWFwRmllbGRzKCkpO1xyXG4gICAgICAgIC8vICAgICh0aGlzLml0ZW0udmFsdWUgYXMgSGVscFZhbHVlKS52YWx1ZT1uZXcgT2JqZWN0KCk7XHJcbiAgICAgICAgLy8gICAgbWFwRmllbGRzS2V5cy5mb3JFYWNoKG1hcEZlaWxkS2V5ID0+IHtcclxuICAgICAgICAvLyAgICAgKHRoaXMuaXRlbS52YWx1ZSBhcyBIZWxwVmFsdWUpLnZhbHVlW21hcEZlaWxkS2V5XT1zZWxlY3RlZEl0ZW1bbWFwRmVpbGRLZXldO1xyXG4gICAgICAgIC8vICAgIH0pO1xyXG4gICAgICAgIC8vICAgICh0aGlzLml0ZW0udmFsdWUgYXMgSGVscFZhbHVlKS52YWx1ZUZpZWxkPSh0aGlzLml0ZW0uY29udHJvbCBhcyBIZWxwQ29udG9sKS52YWx1ZUZpZWxkO1xyXG4gICAgICAgIC8vICAgIGxldCB0ZXh0RmllbGQ9KHRoaXMuaXRlbS5jb250cm9sIGFzIEhlbHBDb250b2wpLnRleHRGaWVsZDtcclxuICAgICAgICAvLyAgICB0aGlzLnRleHRWYWx1ZT0odGhpcy5pdGVtLnZhbHVlIGFzIEhlbHBWYWx1ZSkudmFsdWVbdGV4dEZpZWxkXTtcclxuXHJcbiAgICAgICAgY29uc3QgaGVscFZhbHVlID0gKHRoaXMuaXRlbS52YWx1ZSBhcyBIZWxwVmFsdWUpO1xyXG4gICAgICAgIGhlbHBWYWx1ZS52YWx1ZSA9IHRoaXMuc2luZ2xlU2VsZWN0ID8gW3NlbGVjdGVkSXRlbV0gOiBzZWxlY3RlZEl0ZW07Ly/ljZXpgInov5Tlm57lr7nosaHvvIzlpJrpgInov5Tlm57mlbDnu4RcclxuICAgICAgICBoZWxwVmFsdWUudmFsdWVGaWVsZCA9IHRoaXMudmFsdWVGaWVsZDtcclxuICAgICAgICBoZWxwVmFsdWUudGV4dFZhbHVlID0gaGVscFZhbHVlLmdldFRleHRWYWx1ZSh0aGlzLnRleHRGaWVsZCk7XHJcbiAgICAgICAgdGhpcy50ZXh0VmFsdWUgPSBoZWxwVmFsdWUudGV4dFZhbHVlO1xyXG4gICAgICAgIC8vIHRoaXMuY29uZGl0aW9uQ2hhbmdlLmVtaXQoKTtcclxuICAgICAgICBpZiAodGhpcy5kaXNhYmxlZCkgeyByZXR1cm47IH1cclxuICAgICAgICB0aGlzLnNlYXJjaEhhbmRsZS5lbWl0KCk7XHJcblxyXG4gICAgfVxyXG5cclxuICAgIGdldEhlbHBCaW5kaW5nSW5mbygpIHtcclxuICAgICAgICBpZiAodGhpcy5pdGVtICYmIHRoaXMuaXRlbS5jb250cm9sICYmIHRoaXMuaXRlbS5jb250cm9sLmdldENvbnRyb2xUeXBlKCkgPT0gQ29udHJvbFR5cGUuSGVscCkge1xyXG4gICAgICAgICAgICBsZXQgaGVscExpc3QgPSAodGhpcy5pdGVtLmNvbnRyb2wgYXMgSGVscENvbnRvbCk7XHJcbiAgICAgICAgICAgIHRoaXMudXJpID0gaGVscExpc3QudXJpO1xyXG4gICAgICAgICAgICB0aGlzLnRleHRGaWVsZCA9IGhlbHBMaXN0LnRleHRGaWVsZDtcclxuICAgICAgICAgICAgdGhpcy52YWx1ZUZpZWxkID0gaGVscExpc3QudmFsdWVGaWVsZDtcclxuICAgICAgICAgICAgdGhpcy5pZEZpZWxkID0gaGVscExpc3QuaWRGaWVsZDtcclxuICAgICAgICAgICAgdGhpcy5tYXBGaWVsZHMgPSBoZWxwTGlzdC5tYXBGaWVsZHM7XHJcbiAgICAgICAgICAgIHRoaXMuY29udGV4dCA9IGhlbHBMaXN0LmNvbnRleHQ7XHJcbiAgICAgICAgICAgIHRoaXMucHJlRXZlbnRDbWQgPSBoZWxwTGlzdC5wcmVFdmVudENtZDtcclxuICAgICAgICAgICAgdGhpcy5wb3N0RXZlbnRDbWQgPSBoZWxwTGlzdC5wb3N0RXZlbnRDbWQ7XHJcblxyXG4gICAgICAgICAgICBpZiAoaGVscExpc3QucHJlRXZlbnRDbWQpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMucHJlRXZlbnRDbWQgPSAoZSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGVbJ2hvc3RSZWYnXSA9IHRoaXMuaG9zdFJlZjtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gaGVscExpc3QucHJlRXZlbnRDbWQoZSk7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAoaGVscExpc3QucG9zdEV2ZW50Q21kKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnBvc3RFdmVudENtZCA9IChlKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IHNlbGVjdEl0ZW0gPSBkZWVwQ29weShlKTtcclxuICAgICAgICAgICAgICAgICAgICBzZWxlY3RJdGVtWydob3N0UmVmJ10gPSB0aGlzLmhvc3RSZWY7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGhlbHBMaXN0LnBvc3RFdmVudENtZChzZWxlY3RJdGVtKTtcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgICAgICB0aGlzLnNpbmdsZVNlbGVjdCA9IGhlbHBMaXN0LnNpbmdsZVNlbGVjdDtcclxuICAgICAgICAgICAgdGhpcy5lbmFibGVGdWxsVHJlZSA9IGhlbHBMaXN0LmVuYWJsZUZ1bGxUcmVlO1xyXG4gICAgICAgICAgICB0aGlzLmxvYWRUcmVlRGF0YVR5cGUgPSBoZWxwTGlzdC5sb2FkVHJlZURhdGFUeXBlO1xyXG4gICAgICAgICAgICB0aGlzLmV4cGFuZExldmVsID0gaGVscExpc3QuZXhwYW5kTGV2ZWw7XHJcbiAgICAgICAgICAgIHRoaXMuZW5hYmxlQ2FzY2FkZSA9IGhlbHBMaXN0LmVuYWJsZUNhc2NhZGU7XHJcbiAgICAgICAgICAgIHRoaXMuaGVscElkID0gaGVscExpc3QuaGVscElkO1xyXG4gICAgICAgICAgICBjb25zdCBoZWxwVmFsdWUgPSAodGhpcy5pdGVtLnZhbHVlIGFzIEhlbHBWYWx1ZSk7XHJcbiAgICAgICAgICAgIC8vIGlmIChoZWxwVmFsdWUgJiYgaGVscFZhbHVlLnZhbHVlKSB7XHJcbiAgICAgICAgICAgIC8vICAgICAvLyB0aGlzLnRleHRWYWx1ZSA9ICh0aGlzLml0ZW0udmFsdWUgYXMgSGVscFZhbHVlKS52YWx1ZVt0aGlzLnRleHRGaWVsZF07XHJcbiAgICAgICAgICAgIC8vICAgICB0aGlzLnRleHRWYWx1ZSA9IEhlbHBWYWx1ZS5nZXRQcm9wVmFsdWUoaGVscFZhbHVlLnZhbHVlLCB0aGlzLnRleHRGaWVsZC5zcGxpdCgnLicpKTtcclxuICAgICAgICAgICAgLy8gfVxyXG4gICAgICAgICAgICB0aGlzLmRpc3BsYXlUeXBlID0gaGVscExpc3QuZGlzcGxheVR5cGU7XHJcbiAgICAgICAgICAgIGlmIChoZWxwVmFsdWUudGV4dFZhbHVlID09ICdoZWxwLXRleHQtdmFsdWUtbnVsbCcpIHsvLyDml6fmlbDmja7lhbzlrrlcclxuICAgICAgICAgICAgICAgIHRoaXMudGV4dFZhbHVlID0gaGVscFZhbHVlLmdldFRleHRWYWx1ZSh0aGlzLnRleHRGaWVsZCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnRleHRWYWx1ZSA9IGhlbHBWYWx1ZS50ZXh0VmFsdWU7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8vIGdldENvbmRpdGlvbkl0ZW1TdHlsZShmaWVsZDogUXVlcnlDb25kaXRpb24sIGNvbnRyb2xUeXBlOiBhbnkpIHtcclxuICAgIC8vICAgICByZXR1cm4gdGhpcy5zb2x1dGlvblNlcnZpY2UuZ2V0Q29uZGl0aW9uSXRlbVN0eWxlKGZpZWxkLGNvbnRyb2xUeXBlKTtcclxuICAgIC8vIH1cclxuXHJcbiAgICBnZXRDb25kaXRpb25JdGVtVGl0bGUoZmllbGQ6IFF1ZXJ5Q29uZGl0aW9uKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuc29sdXRpb25TZXJ2aWNlLmdldENvbmRpdGlvbkl0ZW1UaXRsZShmaWVsZCk7XHJcbiAgICB9XHJcblxyXG4gICAgb25TZWFyY2ggPSAoKSA9PiB7XHJcbiAgICAgICAgaWYgKHRoaXMuZGlzYWJsZWQpIHsgcmV0dXJuOyB9XHJcbiAgICAgICAgdGhpcy5zZWFyY2hIYW5kbGUuZW1pdCgpO1xyXG4gICAgICAgIHJldHVybiBvZih0cnVlKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBjbGVhckRhdGEoZXZlbnQpe1xyXG4gICAgLy8gICAgICh0aGlzLml0ZW0udmFsdWUgYXMgSGVscFZhbHVlKS52YWx1ZSA9IG51bGw7XHJcbiAgICAvLyAgICAgKHRoaXMuaXRlbS52YWx1ZSBhcyBIZWxwVmFsdWUpLnZhbHVlRmllbGQgPSBudWxsO1xyXG4gICAgLy8gICAgIHRoaXMuc2VhcmNoSGFuZGxlLmVtaXQoKTtcclxuICAgIC8vIH1cclxuXHJcbiAgICBjbGVhckRhdGEoZGF0YTogYW55KSB7XHJcbiAgICAgICAgKHRoaXMuaXRlbS52YWx1ZSBhcyBIZWxwVmFsdWUpLmNsZWFyVmFsdWUoKTtcclxuICAgICAgICB0aGlzLnNlYXJjaEhhbmRsZS5lbWl0KCk7XHJcbiAgICB9XHJcblxyXG59XHJcbiJdfQ==
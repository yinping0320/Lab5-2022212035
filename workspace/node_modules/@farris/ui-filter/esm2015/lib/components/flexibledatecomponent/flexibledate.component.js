/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input, EventEmitter, Output, HostBinding } from '@angular/core';
import { LocaleService } from '@farris/ui-locale';
import { SolutionService } from '../../service/solution.service';
export class FlexibleDateComponent {
    /**
     * @param {?} localeService
     * @param {?} solutionService
     */
    constructor(localeService, solutionService) {
        this.localeService = localeService;
        this.solutionService = solutionService;
        this.searchHandle = new EventEmitter();
        /**
         * 判断是否是在扩展区域展示
         */
        this.extend = false;
        /**
         * 判断是否显示label
         */
        this.showlabel = true;
    }
    /**
     * @return {?}
     */
    get isExtend() {
        return !this.extend && this.autoLabel;
    }
    /**
     * @return {?}
     */
    get hidenLabel() {
        return !this.showlabel;
    }
    /**
     * @param {?} nr
     * @return {?}
     */
    set item(nr) {
        this._item = nr;
        if (this._item) {
            if (!this._item.hasOwnProperty('value')) {
                this._item.value = {
                    startValue: null,
                    endValue: null,
                    value: null,
                    single: true
                };
            }
            if (!this._item.control.hasOwnProperty('single')) {
                this._item.control.single = true;
            }
            this.beginPlaceHolder = (this._item.hasOwnProperty('beginPlaceHolder') && this._item.beginPlaceHolder) ? this._item.beginPlaceHolder : this.localeService.getValue('filterPanel.dateBeginPlaceHolder');
            this.endPlaceHolder = (this._item.hasOwnProperty('endPlaceHolder') && this._item.beginPlaceHolder) ? this._item.endPlaceHolder : this.localeService.getValue('filterPanel.dateEndPlaceHolder');
            this.placeholder = (this._item.hasOwnProperty('placeHolder') && this._item.placeHolder) ? this._item.placeHolder : '';
            this.single = this._item.control.single;
            this._item.value.single = this.single;
            this.showTime = (this._item.control.hasOwnProperty('showTime') && this._item.control.showTime) ? this._item.control.showTime : '';
            this.showType = (this._item.control.hasOwnProperty('showType') && this._item.control.showType) ? this._item.control.showType : '';
            /** @type {?} */
            let itemDateFormat = this._item.control.format;
            if (this.showTime && itemDateFormat) {
                if (itemDateFormat.length > 0 && itemDateFormat.indexOf('HH:mm') == -1) {
                    itemDateFormat = itemDateFormat + ' HH:mm:ss';
                }
            }
            /** @type {?} */
            const format = this.showTime ? 'yyyy-MM-dd HH:mm:ss' : (this.showType == '2' ? 'yyyy-MM' : (this.showType == '3' ? 'yyyy' : 'yyyy-MM-dd'));
            this.dateFormat = itemDateFormat ? itemDateFormat : format;
        }
        this.constructMultiFieldDateRange(nr.value);
    }
    /**
     * @return {?}
     */
    get item() {
        return this._item;
    }
    /**
     * @return {?}
     */
    ngOnInit() { }
    /**
     * @param {?} field
     * @return {?}
     */
    getConditionItemTitle(field) {
        return this.solutionService.getConditionItemTitle(field);
    }
    /**
     * @param {?} value
     * @return {?}
     */
    constructMultiFieldDateRange(value) {
        if (this.single) {
            this.value = value.value == null ? null : value.value;
        }
        else {
            this.startValue = value.startValue == null ? null : value.startValue;
            this.endValue = value.endValue == null ? null : value.endValue;
        }
    }
    /**
     * @param {?} event
     * @return {?}
     */
    onDateChange(event) {
        this._item.value.value = event.returnFormatted ? event.returnFormatted : null;
        this._item.valueText = event.formatted;
        if (this.disabled) {
            return;
        }
        this.searchHandle.emit();
    }
    /**
     * @param {?} event
     * @return {?}
     */
    beginValueChange(event) {
        this._item.value.startValue = event.returnFormatted ? event.returnFormatted : null;
        this._item.value.startValueText = event.formatted;
        this.setValueText();
        if (this.disabled) {
            return;
        }
        this.searchHandle.emit();
    }
    /**
     * @param {?} event
     * @return {?}
     */
    endValueChange(event) {
        this._item.value.endValue = event.returnFormatted ? event.returnFormatted : null;
        this._item.value.endValueText = event.formatted;
        this.setValueText();
        if (this.disabled) {
            return;
        }
        this.searchHandle.emit();
    }
    /**
     * @return {?}
     */
    setValueText() {
        if (Object.keys(this._item.value).length === 0 || (!this._item.value.startValue && !this._item.value.endValue)) {
            this._item.valueText = '';
        }
        else if (!this._item.value.startValueText) {
            this._item.valueText = '~' + this._item.value.endValueText;
        }
        else if (!this._item.value.endValueText) {
            this._item.valueText = this._item.value.startValueText + '~';
        }
        else {
            this._item.valueText = this._item.value.startValueText + '~' + this._item.value.endValueText;
        }
    }
}
FlexibleDateComponent.decorators = [
    { type: Component, args: [{
                selector: 'app-filter-flexibledate',
                template: "<label class=\"col-form-label\" *ngIf=\"item && showlabel\" title=\"{{getConditionItemTitle(item)}}\">\r\n    <span class=\"farris-label-info text-danger\" *ngIf=\"item.control.required\">*</span>\r\n    <span class=\"farris-label-text\">{{item.fieldName}}</span>\r\n</label>\r\n<div class=\"farris-input-wrap\">\r\n    <ng-container *ngIf=\"single; else elseTemplate\">\r\n        <ng-container *ngIf=\"showTime;else singleDefaultdate\">\r\n            <farris-datepicker [(ngModel)]=\"value\" [editable]=\"false\" [returnFormat]=\"showTime ? 'yyyy-MM-dd HH:mm:ss' : 'yyyy-MM-dd'\" [dateFormat]=\"dateFormat\" (valueChange)=\"onDateChange($event)\" [placeholder]=\"placeholder\" [showTime]=\"showTime\" #datepicker></farris-datepicker>\r\n        </ng-container>\r\n        <ng-template #singleDefaultdate>\r\n            <farris-datepicker [(ngModel)]=\"value\" [editable]=\"false\" [returnFormat]=\"showType == '2'? 'yyyy-MM': (showType == '3'? 'yyyy':'yyyy-MM-dd')\" [dateFormat]=\"dateFormat\" (valueChange)=\"onDateChange($event)\" [placeholder]=\"placeholder\" [showType]=\"showType\" #datepicker></farris-datepicker>\r\n        </ng-template>\r\n    </ng-container>\r\n    <ng-template #elseTemplate>\r\n        <div class=\"d-flex align-items-center\">\r\n            <ng-container *ngIf=\"showTime;else startDefaultdate\">\r\n                <farris-datepicker [(ngModel)]=\"startValue\" [editable]=\"false\" [returnFormat]=\"showTime ? 'yyyy-MM-dd HH:mm:ss' : 'yyyy-MM-dd'\" [dateFormat]=\"dateFormat\" (valueChange)=\"beginValueChange($event)\" [placeholder]=\"beginPlaceHolder\" [showTime]=\"showTime\" [maxDate]=\"endValue\" #datepicker></farris-datepicker>\r\n            </ng-container>\r\n            <ng-template #startDefaultdate>\r\n                <farris-datepicker [(ngModel)]=\"startValue\" [editable]=\"false\" [returnFormat]=\"showType == '2'? 'yyyy-MM': (showType == '3'? 'yyyy':'yyyy-MM-dd')\" [dateFormat]=\"dateFormat\" (valueChange)=\"beginValueChange($event)\" [placeholder]=\"beginPlaceHolder\" [showType]=\"showType\" [maxDate]=\"endValue\" #datepicker></farris-datepicker>\r\n            </ng-template>\r\n            <span class=\"f-icon f-icon-orientation-arrow f-filter-panel-flexible-icon\"></span>\r\n            <ng-container *ngIf=\"showTime;else endDefaultdate\">\r\n                <farris-datepicker [(ngModel)]=\"endValue\" [editable]=\"false\" [returnFormat]=\"showTime ? 'yyyy-MM-dd HH:mm:ss' : 'yyyy-MM-dd'\" [dateFormat]=\"dateFormat\" (valueChange)=\"endValueChange($event)\" [placeholder]=\"endPlaceHolder\" [showTime]=\"showTime\" [minDate]=\"startValue\" #datepicker></farris-datepicker>\r\n            </ng-container>\r\n            <ng-template #endDefaultdate>\r\n                <farris-datepicker [(ngModel)]=\"endValue\" [editable]=\"false\" [returnFormat]=\"showType == '2'? 'yyyy-MM': (showType == '3'? 'yyyy':'yyyy-MM-dd')\" [dateFormat]=\"dateFormat\" (valueChange)=\"endValueChange($event)\" [placeholder]=\"endPlaceHolder\" [showType]=\"showType\" [minDate]=\"startValue\" #datepicker></farris-datepicker>\r\n            </ng-template>\r\n        </div>\r\n    </ng-template>\r\n</div>"
            }] }
];
/** @nocollapse */
FlexibleDateComponent.ctorParameters = () => [
    { type: LocaleService },
    { type: SolutionService }
];
FlexibleDateComponent.propDecorators = {
    autoLabel: [{ type: Input }],
    disabled: [{ type: Input }],
    searchHandle: [{ type: Output, args: ['searchHandle',] }],
    isExtend: [{ type: HostBinding, args: ['class.filter-item-wrap',] }],
    hidenLabel: [{ type: HostBinding, args: ['class.filter-item-hiddenlabel',] }],
    item: [{ type: Input }]
};
if (false) {
    /** @type {?} */
    FlexibleDateComponent.prototype.autoLabel;
    /** @type {?} */
    FlexibleDateComponent.prototype.disabled;
    /** @type {?} */
    FlexibleDateComponent.prototype.searchHandle;
    /**
     * 判断是否是在扩展区域展示
     * @type {?}
     */
    FlexibleDateComponent.prototype.extend;
    /**
     * 判断是否显示label
     * @type {?}
     */
    FlexibleDateComponent.prototype.showlabel;
    /** @type {?} */
    FlexibleDateComponent.prototype.placeholder;
    /** @type {?} */
    FlexibleDateComponent.prototype.beginPlaceHolder;
    /** @type {?} */
    FlexibleDateComponent.prototype.endPlaceHolder;
    /** @type {?} */
    FlexibleDateComponent.prototype.single;
    /** @type {?} */
    FlexibleDateComponent.prototype.showTime;
    /** @type {?} */
    FlexibleDateComponent.prototype.showType;
    /** @type {?} */
    FlexibleDateComponent.prototype.dateFormat;
    /** @type {?} */
    FlexibleDateComponent.prototype.value;
    /** @type {?} */
    FlexibleDateComponent.prototype.startValue;
    /** @type {?} */
    FlexibleDateComponent.prototype.endValue;
    /** @type {?} */
    FlexibleDateComponent.prototype._item;
    /**
     * @type {?}
     * @private
     */
    FlexibleDateComponent.prototype.localeService;
    /**
     * @type {?}
     * @private
     */
    FlexibleDateComponent.prototype.solutionService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmxleGlibGVkYXRlLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvdWktZmlsdGVyLyIsInNvdXJjZXMiOlsibGliL2NvbXBvbmVudHMvZmxleGlibGVkYXRlY29tcG9uZW50L2ZsZXhpYmxlZGF0ZS5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsS0FBSyxFQUFVLFlBQVksRUFBRSxNQUFNLEVBQUUsV0FBVyxFQUFDLE1BQU0sZUFBZSxDQUFDO0FBQzNGLE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUVsRCxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sZ0NBQWdDLENBQUM7QUFPakUsTUFBTSxPQUFPLHFCQUFxQjs7Ozs7SUFvRTlCLFlBQW9CLGFBQTRCLEVBQVMsZUFBZ0M7UUFBckUsa0JBQWEsR0FBYixhQUFhLENBQWU7UUFBUyxvQkFBZSxHQUFmLGVBQWUsQ0FBaUI7UUFoRWpFLGlCQUFZLEdBQUcsSUFBSSxZQUFZLEVBQUUsQ0FBQzs7OztRQUcxRCxXQUFNLEdBQVksS0FBSyxDQUFDOzs7O1FBRXhCLGNBQVMsR0FBWSxJQUFJLENBQUM7SUEyRGlFLENBQUM7Ozs7SUE5QzVGLElBQ0ksUUFBUTtRQUNSLE9BQU8sQ0FBQyxJQUFJLENBQUMsTUFBTSxJQUFJLElBQUksQ0FBQyxTQUFTLENBQUM7SUFDMUMsQ0FBQzs7OztJQUNELElBQ0ksVUFBVTtRQUNWLE9BQU8sQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDO0lBQzNCLENBQUM7Ozs7O0lBR0QsSUFDSSxJQUFJLENBQUMsRUFBTztRQUNaLElBQUksQ0FBQyxLQUFLLEdBQUcsRUFBRSxDQUFDO1FBQ2hCLElBQUcsSUFBSSxDQUFDLEtBQUssRUFBQztZQUNWLElBQUcsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLGNBQWMsQ0FBQyxPQUFPLENBQUMsRUFBRTtnQkFDcEMsSUFBSSxDQUFDLEtB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Q3BCLGlEQUF3Qjs7SUFDeEIsK0NBQXNCOztJQUN0Qix1Q0FBZTs7SUFDZix5Q0FBa0I7O0lBQ2xCLHlDQUFnQjs7SUFDaEIsMkNBQW1COztJQUNuQixzQ0FBWTs7SUFDWiwyQ0FBaUI7O0lBQ2pCLHlDQUFlOztJQVdmLHNDQUFXOzs7OztJQXFDQyw4Q0FBb0M7Ozs7O0lBQUMsZ0RBQXdDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBJbnB1dCwgT25Jbml0LCBFdmVudEVtaXR0ZXIsIE91dHB1dCwgSG9zdEJpbmRpbmd9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBMb2NhbGVTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy91aS1sb2NhbGUnO1xyXG5pbXBvcnQgeyBRdWVyeUNvbmRpdGlvbiB9IGZyb20gJy4uLy4uL2VudGl0eS9xdWVyeWNvbmRpdGlvbic7XHJcbmltcG9ydCB7IFNvbHV0aW9uU2VydmljZSB9IGZyb20gJy4uLy4uL3NlcnZpY2Uvc29sdXRpb24uc2VydmljZSc7XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICAgIHNlbGVjdG9yOiAnYXBwLWZpbHRlci1mbGV4aWJsZWRhdGUnLFxyXG4gICAgdGVtcGxhdGVVcmw6ICcuL2ZsZXhpYmxlZGF0ZS5jb21wb25lbnQuaHRtbCdcclxufSlcclxuXHJcbmV4cG9ydCBjbGFzcyBGbGV4aWJsZURhdGVDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXR7XHJcbiAgIFxyXG4gICAgQElucHV0KCkgYXV0b0xhYmVsOiBib29sZWFuO1xyXG4gICAgQElucHV0KCkgZGlzYWJsZWQ6IGJvb2xlYW47XHJcbiAgICBAT3V0cHV0KCdzZWFyY2hIYW5kbGUnKSBzZWFyY2hIYW5kbGUgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcblxyXG4gICAgLyoq5Yik5pat5piv5ZCm5piv5Zyo5omp5bGV5Yy65Z+f5bGV56S6ICovXHJcbiAgICBleHRlbmQ6IGJvb2xlYW4gPSBmYWxzZTtcclxuICAgIC8qKuWIpOaWreaYr+WQpuaYvuekumxhYmVsICovXHJcbiAgICBzaG93bGFiZWw6IGJvb2xlYW4gPSB0cnVlO1xyXG5cclxuICAgIHBsYWNlaG9sZGVyOiBzdHJpbmc7XHJcbiAgICBiZWdpblBsYWNlSG9sZGVyOnN0cmluZztcclxuICAgIGVuZFBsYWNlSG9sZGVyOnN0cmluZztcclxuICAgIHNpbmdsZTpib29sZWFuOy8v5piv5ZCm5Li65Y2V5pel5pyfXHJcbiAgICBzaG93VGltZTogYm9vbGVhbjsvL+aYr+WQpuaYvuekuuaXtumXtFxyXG4gICAgc2hvd1R5cGU6c3RyaW5nOy8v5pi+56S657G75Z6LXHJcbiAgICBkYXRlRm9ybWF0OiBzdHJpbmc7Ly/moLzlvI9cclxuICAgIHZhbHVlOiBEYXRlO1xyXG4gICAgc3RhcnRWYWx1ZTogRGF0ZTtcclxuICAgIGVuZFZhbHVlOiBEYXRlO1xyXG5cclxuICAgIEBIb3N0QmluZGluZygnY2xhc3MuZmlsdGVyLWl0ZW0td3JhcCcpXHJcbiAgICBnZXQgaXNFeHRlbmQoKTogYm9vbGVhbiB7XHJcbiAgICAgICAgcmV0dXJuICF0aGlzLmV4dGVuZCAmJiB0aGlzLmF1dG9MYWJlbDtcclxuICAgIH1cclxuICAgIEBIb3N0QmluZGluZygnY2xhc3MuZmlsdGVyLWl0ZW0taGlkZGVubGFiZWwnKVxyXG4gICAgZ2V0IGhpZGVuTGFiZWwoKTogYm9vbGVhbiB7XHJcbiAgICAgICAgcmV0dXJuICF0aGlzLnNob3dsYWJlbDtcclxuICAgIH1cclxuXHJcbiAgICBfaXRlbTogYW55O1xyXG4gICAgQElucHV0KCkgXHJcbiAgICBzZXQgaXRlbShucjogYW55KXtcclxuICAgICAgICB0aGlzLl9pdGVtID0gbnI7XHJcbiAgICAgICAgaWYodGhpcy5faXRlbSl7XHJcbiAgICAgICAgICAgIGlmKCF0aGlzLl9pdGVtLmhhc093blByb3BlcnR5KCd2YWx1ZScpKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9pdGVtLnZhbHVlID0ge1xyXG4gICAgICAgICAgICAgICAgICAgIHN0YXJ0VmFsdWUgOiBudWxsLFxyXG4gICAgICAgICAgICAgICAgICAgIGVuZFZhbHVlIDogbnVsbCxcclxuICAgICAgICAgICAgICAgICAgICB2YWx1ZTogbnVsbCxcclxuICAgICAgICAgICAgICAgICAgICBzaW5nbGU6dHJ1ZVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmKCF0aGlzLl9pdGVtLmNvbnRyb2wuaGFzT3duUHJvcGVydHkoJ3NpbmdsZScpKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9pdGVtLmNvbnRyb2wuc2luZ2xlID0gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLmJlZ2luUGxhY2VIb2xkZXIgPSAodGhpcy5faXRlbS5oYXNPd25Qcm9wZXJ0eSgnYmVnaW5QbGFjZUhvbGRlcicpICYmIHRoaXMuX2l0ZW0uYmVnaW5QbGFjZUhvbGRlcikgPyB0aGlzLl9pdGVtLmJlZ2luUGxhY2VIb2xkZXI6IHRoaXMubG9jYWxlU2VydmljZS5nZXRWYWx1ZSgnZmlsdGVyUGFuZWwuZGF0ZUJlZ2luUGxhY2VIb2xkZXInKTtcclxuICAgICAgICAgICAgdGhpcy5lbmRQbGFjZUhvbGRlciA9ICh0aGlzLl9pdGVtLmhhc093blByb3BlcnR5KCdlbmRQbGFjZUhvbGRlcicpICYmIHRoaXMuX2l0ZW0uYmVnaW5QbGFjZUhvbGRlcikgPyB0aGlzLl9pdGVtLmVuZFBsYWNlSG9sZGVyOiB0aGlzLmxvY2FsZVNlcnZpY2UuZ2V0VmFsdWUoJ2ZpbHRlclBhbmVsLmRhdGVFbmRQbGFjZUhvbGRlcicpO1xyXG4gICAgICAgICAgICB0aGlzLnBsYWNlaG9sZGVyID0gKHRoaXMuX2l0ZW0uaGFzT3duUHJvcGVydHkoJ3BsYWNlSG9sZGVyJykgJiYgdGhpcy5faXRlbS5wbGFjZUhvbGRlcikgPyB0aGlzLl9pdGVtLnBsYWNlSG9sZGVyOicnO1xyXG4gICAgICAgICAgICB0aGlzLnNpbmdsZSA9IHRoaXMuX2l0ZW0uY29udHJvbC5zaW5nbGU7XHJcbiAgICAgICAgICAgIHRoaXMuX2l0ZW0udmFsdWUuc2luZ2xlID0gdGhpcy5zaW5nbGU7XHJcbiAgICAgICAgICAgIHRoaXMuc2hvd1RpbWUgPSAodGhpcy5faXRlbS5jb250cm9sLmhhc093blByb3BlcnR5KCdzaG93VGltZScpICYmIHRoaXMuX2l0ZW0uY29udHJvbC5zaG93VGltZSkgPyB0aGlzLl9pdGVtLmNvbnRyb2wuc2hvd1RpbWU6Jyc7XHJcbiAgICAgICAgICAgIHRoaXMuc2hvd1R5cGUgPSAodGhpcy5faXRlbS5jb250cm9sLmhhc093blByb3BlcnR5KCdzaG93VHlwZScpICYmIHRoaXMuX2l0ZW0uY29udHJvbC5zaG93VHlwZSkgPyB0aGlzLl9pdGVtLmNvbnRyb2wuc2hvd1R5cGU6Jyc7XHJcbiAgICAgICAgICAgIGxldCBpdGVtRGF0ZUZvcm1hdCA9IHRoaXMuX2l0ZW0uY29udHJvbC5mb3JtYXQ7XHJcbiAgICAgICAgICAgIGlmKHRoaXMuc2hvd1RpbWUgJiYgaXRlbURhdGVGb3JtYXQpe1xyXG4gICAgICAgICAgICAgICAgaWYoaXRlbURhdGVGb3JtYXQubGVuZ3RoID4gMCAmJiBpdGVtRGF0ZUZvcm1hdC5pbmRleE9mKCdISDptbScpID09IC0xKXtcclxuICAgICAgICAgICAgICAgICAgICBpdGVtRGF0ZUZvcm1hdCA9IGl0ZW1EYXRlRm9ybWF0ICsgJyBISDptbTpzcyc7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY29uc3QgZm9ybWF0ID0gdGhpcy5zaG93VGltZSA/ICd5eXl5LU1NLWRkIEhIOm1tOnNzJzogKHRoaXMuc2hvd1R5cGUgPT0gJzInPyAneXl5eS1NTSc6ICh0aGlzLnNob3dUeXBlID09ICczJz8gJ3l5eXknOid5eXl5LU1NLWRkJykpO1xyXG4gICAgICAgICAgICB0aGlzLmRhdGVGb3JtYXQgPSBpdGVtRGF0ZUZvcm1hdD9pdGVtRGF0ZUZvcm1hdDpmb3JtYXQ7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuY29uc3RydWN0TXVsdGlGaWVsZERhdGVSYW5nZShuci52YWx1ZSk7XHJcbiAgICB9XHJcbiAgICBnZXQgaXRlbSgpe1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9pdGVtO1xyXG4gICAgfVxyXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBsb2NhbGVTZXJ2aWNlOiBMb2NhbGVTZXJ2aWNlLHByaXZhdGUgc29sdXRpb25TZXJ2aWNlOiBTb2x1dGlvblNlcnZpY2Upe31cclxuXHJcbiAgICBuZ09uSW5pdCgpOiB2b2lkIHt9XHJcbiAgICBnZXRDb25kaXRpb25JdGVtVGl0bGUoZmllbGQ6IFF1ZXJ5Q29uZGl0aW9uKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuc29sdXRpb25TZXJ2aWNlLmdldENvbmRpdGlvbkl0ZW1UaXRsZShmaWVsZCk7XHJcbiAgICB9XHJcbiAgICBjb25zdHJ1Y3RNdWx0aUZpZWxkRGF0ZVJhbmdlKHZhbHVlKSB7XHJcbiAgICAgICAgaWYodGhpcy5zaW5nbGUpe1xyXG4gICAgICAgICAgICB0aGlzLnZhbHVlID0gdmFsdWUudmFsdWUgPT0gbnVsbCA/IG51bGwgOiB2YWx1ZS52YWx1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZXtcclxuICAgICAgICAgICAgdGhpcy5zdGFydFZhbHVlID0gdmFsdWUuc3RhcnRWYWx1ZSA9PSBudWxsID8gbnVsbCA6IHZhbHVlLnN0YXJ0VmFsdWU7XHJcbiAgICAgICAgICAgIHRoaXMuZW5kVmFsdWUgPSB2YWx1ZS5lbmRWYWx1ZSA9PSBudWxsID8gbnVsbCA6IHZhbHVlLmVuZFZhbHVlO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBvbkRhdGVDaGFuZ2UoZXZlbnQ6YW55KXtcclxuICAgICAgICB0aGlzLl9pdGVtLnZhbHVlLnZhbHVlID0gZXZlbnQucmV0dXJuRm9ybWF0dGVkID8gZXZlbnQucmV0dXJuRm9ybWF0dGVkIDpudWxsO1xyXG4gICAgICAgIHRoaXMuX2l0ZW0udmFsdWVUZXh0ID0gZXZlbnQuZm9ybWF0dGVkO1xyXG4gICAgICAgIGlmKHRoaXMuZGlzYWJsZWQpe3JldHVybjt9XHJcbiAgICAgICAgdGhpcy5zZWFyY2hIYW5kbGUuZW1pdCgpO1xyXG4gICAgfVxyXG5cclxuICAgIGJlZ2luVmFsdWVDaGFuZ2UoZXZlbnQpIHtcclxuICAgICAgICB0aGlzLl9pdGVtLnZhbHVlLnN0YXJ0VmFsdWUgPSBldmVudC5yZXR1cm5Gb3JtYXR0ZWQgPyBldmVudC5yZXR1cm5Gb3JtYXR0ZWQgOiBudWxsO1xyXG4gICAgICAgIHRoaXMuX2l0ZW0udmFsdWUuc3RhcnRWYWx1ZVRleHQgPSBldmVudC5mb3JtYXR0ZWQ7XHJcbiAgICAgICAgdGhpcy5zZXRWYWx1ZVRleHQoKTtcclxuICAgICAgICBpZih0aGlzLmRpc2FibGVkKXtyZXR1cm47fVxyXG4gICAgICAgIHRoaXMuc2VhcmNoSGFuZGxlLmVtaXQoKTtcclxuICAgIH1cclxuXHJcbiAgICBlbmRWYWx1ZUNoYW5nZShldmVudCkge1xyXG4gICAgICAgIHRoaXMuX2l0ZW0udmFsdWUuZW5kVmFsdWUgPSBldmVudC5yZXR1cm5Gb3JtYXR0ZWQgPyBldmVudC5yZXR1cm5Gb3JtYXR0ZWQgOiBudWxsO1xyXG4gICAgICAgIHRoaXMuX2l0ZW0udmFsdWUuZW5kVmFsdWVUZXh0ID0gZXZlbnQuZm9ybWF0dGVkO1xyXG4gICAgICAgIHRoaXMuc2V0VmFsdWVUZXh0KCk7XHJcbiAgICAgICAgaWYodGhpcy5kaXNhYmxlZCl7cmV0dXJuO31cclxuICAgICAgICB0aGlzLnNlYXJjaEhhbmRsZS5lbWl0KCk7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0VmFsdWVUZXh0KCl7XHJcbiAgICAgICAgaWYgKE9iamVjdC5rZXlzKHRoaXMuX2l0ZW0udmFsdWUpLmxlbmd0aCA9PT0gMCB8fCAoIXRoaXMuX2l0ZW0udmFsdWUuc3RhcnRWYWx1ZSAmJiAhdGhpcy5faXRlbS52YWx1ZS5lbmRWYWx1ZSkpIHtcclxuICAgICAgICAgICAgdGhpcy5faXRlbS52YWx1ZVRleHQgPSAnJ1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmKCF0aGlzLl9pdGVtLnZhbHVlLnN0YXJ0VmFsdWVUZXh0KXtcclxuICAgICAgICAgICAgdGhpcy5faXRlbS52YWx1ZVRleHQgPSAnficgKyB0aGlzLl9pdGVtLnZhbHVlLmVuZFZhbHVlVGV4dDtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZighdGhpcy5faXRlbS52YWx1ZS5lbmRWYWx1ZVRleHQpe1xyXG4gICAgICAgICAgICB0aGlzLl9pdGVtLnZhbHVlVGV4dCA9IHRoaXMuX2l0ZW0udmFsdWUuc3RhcnRWYWx1ZVRleHQgKyAnfic7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2V7XHJcbiAgICAgICAgICAgIHRoaXMuX2l0ZW0udmFsdWVUZXh0ID0gdGhpcy5faXRlbS52YWx1ZS5zdGFydFZhbHVlVGV4dCArICd+JyArIHRoaXMuX2l0ZW0udmFsdWUuZW5kVmFsdWVUZXh0O1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufSJdfQ==
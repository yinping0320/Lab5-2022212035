/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input, HostBinding, Output, EventEmitter } from '@angular/core';
import { SolutionService } from '../../service/solution.service';
export class DateRangeComponent {
    /**
     * @param {?} solutionService
     */
    constructor(solutionService) {
        this.solutionService = solutionService;
        this.searchHandle = new EventEmitter();
        //TODO: need 2 placeholder text for date range
        // rangeDate = {
        //     begin:null,
        //     end:null
        // };
        /**
         * 判断是否是在扩展区域展示
         */
        this.extend = false;
        /**
         * 判断是否显示label
         */
        this.showlabel = true;
    }
    /**
     * @return {?}
     */
    get isExtend() {
        return !this.extend && this.autoLabel;
    }
    /**
     * @return {?}
     */
    get hidenLabel() {
        return !this.showlabel;
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.initDate();
        if (this.item) {
            this.beginPlaceHolder = this.item.beginPlaceHolder || '';
            this.endPlaceHolder = this.item.endPlaceHolder || '';
            // const type = Object.prototype.toString.call(this.item.placeHolder);
            // if(type == '[object Undefined]'){
            //     if(this.item.control && this.item.control.hasOwnProperty('placeholder')){
            //         this.placeholder = this.item.control.placeholder;
            //     }
            // }
            // else{
            //     this.placeholder = this.item.placeHolder;
            // }
            // const beginplac = Object.prototype.toString.call(this.item.beginPlaceHolder);
            // if(beginplac == '[object Undefined]'){
            //     if(this.item.control && this.item.control.hasOwnProperty('placeholder')){
            //         this.beginPlaceHolder = this.item.control.beginPlaceHolder;
            //     }
            // }
            // else{
            //     this.beginPlaceHolder = this.item.beginPlaceHolder;
            // }
            // const endplac = Object.prototype.toString.call(this.item.endPlaceHolder);
            // if(endplac == '[object Undefined]'){
            //     if(this.item.control && this.item.control.hasOwnProperty('placeholder')){
            //         this.endPlaceHolder = this.item.control.endPlaceHolder;
            //     }
            // }
            // else{
            //     this.endPlaceHolder = this.item.endPlaceHolder;
            // }
        }
    }
    /**
     * @return {?}
     */
    ngOnChanges() {
        this.initDate();
    }
    /**
     * @return {?}
     */
    initDate() {
        // if(this.item && this.item.control && this.item.control.hasOwnProperty('format') && this.item.control.format){
        //     this.dateFormat = this.item.control.format;
        //     if(this.showTime){
        //         if(this.dateFormat.length > 0 && this.dateFormat.indexOf('HH:mm') == -1){
        //             this.dateFormat = this.dateFormat + ' HH:mm:ss';
        //         }
        //     }
        // }
        // else{
        //     this.dateFormat = this.showTime? 'yyyy-MM-dd HH:mm:ss':'yyyy-MM-dd';
        // }
        if (this.item && this.item.control && this.item.control.hasOwnProperty('format')) {
            /** @type {?} */
            let itemDateFormat = this.item.control.format;
            if (this.showTime) {
                if (itemDateFormat.length > 0 && itemDateFormat.indexOf('HH:mm') == -1) {
                    itemDateFormat = itemDateFormat + ' HH:mm:ss';
                }
            }
            /** @type {?} */
            const format = this.showTime ? 'yyyy-MM-dd HH:mm:ss' : (this.showType == '2' ? 'yyyy-MM' : (this.showType == '3' ? 'yyyy' : 'yyyy-MM-dd'));
            this.dateFormat = itemDateFormat ? itemDateFormat : format;
        }
        /** @type {?} */
        const rangeDateValue = this.item && this.item.value;
        if (rangeDateValue.startTime && rangeDateValue.endTime) {
            this.rangeDate = `${rangeDateValue.startTime}~${rangeDateValue.endTime}`;
        }
    }
    /**
     * @param {?} dateString
     * @return {?}
     */
    getDate(dateString) {
        // let arr1:Array<any> = dateString.split(" "); 
        // let sdate = arr1[0].split('-'); 
        // let date = new Date(sdate[0], sdate[1]-1, sdate[2]);
        /** @type {?} */
        let date = new Date(dateString);
        return date;
    }
    /**
     * @param {?} event
     * @return {?}
     */
    onDateChange(event) {
        if (event.returnFormatted) {
            ((/** @type {?} */ (this.item.value))).startTime = event.returnFormatted.split('~')[0];
            ((/** @type {?} */ (this.item.value))).endTime = event.returnFormatted.split('~')[1];
        }
        else {
            // this.item.value = new DateRangeValue();
            this.item.value.startTime = '';
            this.item.value.endTime = '';
        }
        this.item.valueText = event.formatted;
        if (this.disabled) {
            return;
        }
        this.searchHandle.emit(event);
    }
    /**
     * @param {?} field
     * @return {?}
     */
    getConditionItemTitle(field) {
        return this.solutionService.getConditionItemTitle(field);
    }
}
DateRangeComponent.decorators = [
    { type: Component, args: [{
                selector: 'app-filter-daterange',
                template: "<label class=\"col-form-label\" *ngIf=\"item && showlabel\" title=\"{{getConditionItemTitle(item)}}\">\r\n    <span class=\"farris-label-info text-danger\" *ngIf=\"item.control.required\">*</span>\r\n    <span class=\"farris-label-text\">{{item.fieldName}}</span>\r\n</label>\r\n<div class=\"farris-input-wrap\" *ngIf=\"item\">\r\n    <!-- <farris-datepicker [(ngModel)]=\"rangeDate\" [dateRange]=\"true\" [readonly]=\"disabled\" [editable]=\"false\" [returnFormat]=\"showTime ? 'yyyy-MM-dd HH:mm:ss' : 'yyyy-MM-dd'\" [dateFormat]=\"dateFormat\" (valueChange)=\"onDateChange($event)\" [beginPlaceholder]=\"beginPlaceHolder\" [endPlaceholder]=\"endPlaceHolder\" [placeholder]=\"placeholder\" [showTime]=\"showTime\"></farris-datepicker> -->\r\n\r\n    <ng-container *ngIf=\"showTime;else defaultdate\">\r\n        <farris-datepicker [(ngModel)]=\"rangeDate\" [dateRange]=\"true\" [readonly]=\"disabled\" [editable]=\"false\" [returnFormat]=\"showTime ? 'yyyy-MM-dd HH:mm:ss' : 'yyyy-MM-dd'\" [dateFormat]=\"dateFormat\" (valueChange)=\"onDateChange($event)\" [beginPlaceholder]=\"beginPlaceHolder\" [endPlaceholder]=\"endPlaceHolder\" [placeholder]=\"placeholder\" [showTime]=\"showTime\"></farris-datepicker>\r\n    </ng-container>\r\n    <ng-template #defaultdate>\r\n        <farris-datepicker [(ngModel)]=\"rangeDate\" [dateRange]=\"true\" [readonly]=\"disabled\" [editable]=\"false\" [returnFormat]=\"showTime ? 'yyyy-MM-dd HH:mm:ss': (showType == '2'? 'yyyy-MM': (showType == '3'? 'yyyy':'yyyy-MM-dd'))\" [dateFormat]=\"dateFormat\" (valueChange)=\"onDateChange($event)\" [beginPlaceholder]=\"beginPlaceHolder\" [endPlaceholder]=\"endPlaceHolder\" [placeholder]=\"placeholder\" [showType]=\"showType\"></farris-datepicker>\r\n    </ng-template>\r\n\r\n    <!-- <farris-datepicker [ngModel]=\"rangeDate\" [dateRange]=\"true\" [returnFormat]=\"'yyyy-MM-dd'\" [dateFormat]=\"item.control.format\" (ngModelChange)=\"onDateChange($event)\"></farris-datepicker> -->\r\n</div>\r\n<!-- [(ngModel)]=\"rangeDate\" -->"
            }] }
];
/** @nocollapse */
DateRangeComponent.ctorParameters = () => [
    { type: SolutionService }
];
DateRangeComponent.propDecorators = {
    item: [{ type: Input }],
    autoLabel: [{ type: Input }],
    disabled: [{ type: Input }],
    showTime: [{ type: Input }],
    showType: [{ type: Input }],
    searchHandle: [{ type: Output, args: ['searchHandle',] }],
    isExtend: [{ type: HostBinding, args: ['class.filter-item-wrap',] }],
    hidenLabel: [{ type: HostBinding, args: ['class.filter-item-hiddenlabel',] }]
};
if (false) {
    /**
     * QueryCondition类型
     * @type {?}
     */
    DateRangeComponent.prototype.item;
    /** @type {?} */
    DateRangeComponent.prototype.autoLabel;
    /** @type {?} */
    DateRangeComponent.prototype.disabled;
    /** @type {?} */
    DateRangeComponent.prototype.showTime;
    /** @type {?} */
    DateRangeComponent.prototype.showType;
    /** @type {?} */
    DateRangeComponent.prototype.searchHandle;
    /** @type {?} */
    DateRangeComponent.prototype.startTime;
    /** @type {?} */
    DateRangeComponent.prototype.endTime;
    /**
     * 判断是否是在扩展区域展示
     * @type {?}
     */
    DateRangeComponent.prototype.extend;
    /**
     * 判断是否显示label
     * @type {?}
     */
    DateRangeComponent.prototype.showlabel;
    /** @type {?} */
    DateRangeComponent.prototype.rangeDate;
    /** @type {?} */
    DateRangeComponent.prototype.placeholder;
    /** @type {?} */
    DateRangeComponent.prototype.beginPlaceHolder;
    /** @type {?} */
    DateRangeComponent.prototype.endPlaceHolder;
    /** @type {?} */
    DateRangeComponent.prototype.dateFormat;
    /**
     * @type {?}
     * @private
     */
    DateRangeComponent.prototype.solutionService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0ZXJhbmdlLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvdWktZmlsdGVyLyIsInNvdXJjZXMiOlsibGliL2NvbXBvbmVudHMvZGF0ZXJhbmdlY29tcG9uZW50L2RhdGVyYW5nZS5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsS0FBSyxFQUFxQixXQUFXLEVBQUUsTUFBTSxFQUFFLFlBQVksRUFBQyxNQUFNLGVBQWUsQ0FBQztBQUd0RyxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sZ0NBQWdDLENBQUM7QUFPakUsTUFBTSxPQUFPLGtCQUFrQjs7OztJQXVDM0IsWUFBb0IsZUFBK0I7UUFBL0Isb0JBQWUsR0FBZixlQUFlLENBQWdCO1FBN0IzQixpQkFBWSxHQUFHLElBQUksWUFBWSxFQUFFLENBQUM7Ozs7Ozs7OztRQVUxRCxXQUFNLEdBQVcsS0FBSyxDQUFDOzs7O1FBRXZCLGNBQVMsR0FBVyxJQUFJLENBQUM7SUFpQjRCLENBQUM7Ozs7SUFUdEQsSUFDSSxRQUFRO1FBQ1IsT0FBTyxDQUFDLElBQUksQ0FBQyxNQUFNLElBQUksSUFBSSxDQUFDLFNBQVMsQ0FBQztJQUMxQyxDQUFDOzs7O0lBQ0QsSUFDSSxVQUFVO1FBQ1YsT0FBTyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUM7SUFDM0IsQ0FBQzs7OztJQUlELFFBQVE7UUFDSixJQUFJLENBQUMsUUFBUSxFQUFFLENBQUM7UUFDaEIsSUFBRyxJQUFJLENBQUMsSUFBSSxFQUFDO1lBQ1QsSUFBSSxDQUFDLGdCQUFnQixHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsZ0JBQWdCLElBQUksRUFBRSxDQUFDO1lBQ3pELElBQUksQ0FBQyxjQUFjLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxjQUFjLElBQUksRUFBRSxDQUFDO1lBQ3JELHNFQUFzRTtZQUN0RSxvQ0FBb0M7WUFDcEMsZ0ZBQWdGO1lBQ2hGLDREQUE0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LENBQUM7WUFDL0IsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxHQUFHLEVBQUUsQ0FBQztTQUNoQztRQUNELElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxHQUFHLEtBQUssQ0FBQyxTQUFTLENBQUM7UUFDdEMsSUFBRyxJQUFJLENBQUMsUUFBUSxFQUFDO1lBQUMsT0FBTztTQUFDO1FBQzFCLElBQUksQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQ2xDLENBQUM7Ozs7O0lBQ0QscUJBQXFCLENBQUMsS0FBb0I7UUFDdEMsT0FBTyxJQUFJLENBQUMsZUFBZSxDQUFDLHFCQUFxQixDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQzdELENBQUM7OztZQXhJSixTQUFTLFNBQUM7Z0JBQ1AsUUFBUSxFQUFFLHNCQUFzQjtnQkFDaEMsdytEQUF5QzthQUM1Qzs7OztZQUxRLGVBQWU7OzttQkFZbkIsS0FBSzt3QkFDTCxLQUFLO3VCQUNMLEtBQUs7dUJBQ0wsS0FBSzt1QkFDTCxLQUFLOzJCQUNMLE1BQU0sU0FBQyxjQUFjO3VCQW9CckIsV0FBVyxTQUFDLHdCQUF3Qjt5QkFJcEMsV0FBVyxTQUFDLCtCQUErQjs7Ozs7OztJQTdCNUMsa0NBQWtCOztJQUNsQix1Q0FBMkI7O0lBQzNCLHNDQUEwQjs7SUFDMUIsc0NBQTBCOztJQUMxQixzQ0FBeUI7O0lBQ3pCLDBDQUEwRDs7SUFFMUQsdUNBQWU7O0lBQ2YscUNBQWE7Ozs7O0lBT2Isb0NBQXVCOzs7OztJQUV2Qix1Q0FBeUI7O0lBRXpCLHVDQUFrQjs7SUFDbEIseUNBQW9COztJQUNwQiw4Q0FBd0I7O0lBQ3hCLDRDQUFzQjs7SUFDdEIsd0NBQWtCOzs7OztJQVdOLDZDQUF1QyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgSW5wdXQsIE9uSW5pdCwgT25DaGFuZ2VzLCBIb3N0QmluZGluZywgT3V0cHV0LCBFdmVudEVtaXR0ZXJ9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBRdWVyeUNvbmRpdGlvbiB9IGZyb20gJy4uLy4uL2VudGl0eS9xdWVyeWNvbmRpdGlvbic7XHJcbmltcG9ydCB7IERhdGVSYW5nZVZhbHVlIH0gZnJvbSAnLi4vLi4vZW50aXR5L2NvbmRpdGlvbnZhbHVlL2RhdGVyYW5nZXZhbHVlJztcclxuaW1wb3J0IHsgU29sdXRpb25TZXJ2aWNlIH0gZnJvbSAnLi4vLi4vc2VydmljZS9zb2x1dGlvbi5zZXJ2aWNlJztcclxuXHJcbkBDb21wb25lbnQoe1xyXG4gICAgc2VsZWN0b3I6ICdhcHAtZmlsdGVyLWRhdGVyYW5nZScsXHJcbiAgICB0ZW1wbGF0ZVVybDogJy4vZGF0ZXJhbmdlLmNvbXBvbmVudC5odG1sJ1xyXG59KVxyXG5cclxuZXhwb3J0IGNsYXNzIERhdGVSYW5nZUNvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCxPbkNoYW5nZXN7XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBRdWVyeUNvbmRpdGlvbuexu+Wei1xyXG4gICAgICovXHJcbiAgICBASW5wdXQoKSBpdGVtOmFueTtcclxuICAgIEBJbnB1dCgpIGF1dG9MYWJlbDpib29sZWFuO1xyXG4gICAgQElucHV0KCkgZGlzYWJsZWQ6Ym9vbGVhbjtcclxuICAgIEBJbnB1dCgpIHNob3dUaW1lOmJvb2xlYW47XHJcbiAgICBASW5wdXQoKSBzaG93VHlwZTpzdHJpbmc7XHJcbiAgICBAT3V0cHV0KCdzZWFyY2hIYW5kbGUnKSBzZWFyY2hIYW5kbGUgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcblxyXG4gICAgc3RhcnRUaW1lOkRhdGU7XHJcbiAgICBlbmRUaW1lOkRhdGU7XHJcbiAgICAvL1RPRE86IG5lZWQgMiBwbGFjZWhvbGRlciB0ZXh0IGZvciBkYXRlIHJhbmdlXHJcbiAgICAvLyByYW5nZURhdGUgPSB7XHJcbiAgICAvLyAgICAgYmVnaW46bnVsbCxcclxuICAgIC8vICAgICBlbmQ6bnVsbFxyXG4gICAgLy8gfTtcclxuICAgIC8qKuWIpOaWreaYr+WQpuaYr+WcqOaJqeWxleWMuuWfn+WxleekuiAqL1xyXG4gICAgZXh0ZW5kOmJvb2xlYW4gPSBmYWxzZTtcclxuICAgIC8qKuWIpOaWreaYr+WQpuaYvuekumxhYmVsICovXHJcbiAgICBzaG93bGFiZWw6Ym9vbGVhbiA9IHRydWU7XHJcblxyXG4gICAgcmFuZ2VEYXRlOiBzdHJpbmc7XHJcbiAgICBwbGFjZWhvbGRlcjogc3RyaW5nO1xyXG4gICAgYmVnaW5QbGFjZUhvbGRlcjpzdHJpbmc7XHJcbiAgICBlbmRQbGFjZUhvbGRlcjpzdHJpbmc7XHJcbiAgICBkYXRlRm9ybWF0OnN0cmluZztcclxuXHJcbiAgICBASG9zdEJpbmRpbmcoJ2NsYXNzLmZpbHRlci1pdGVtLXdyYXAnKVxyXG4gICAgZ2V0IGlzRXh0ZW5kKCk6IGJvb2xlYW4ge1xyXG4gICAgICAgIHJldHVybiAhdGhpcy5leHRlbmQgJiYgdGhpcy5hdXRvTGFiZWw7XHJcbiAgICB9XHJcbiAgICBASG9zdEJpbmRpbmcoJ2NsYXNzLmZpbHRlci1pdGVtLWhpZGRlbmxhYmVsJylcclxuICAgIGdldCBoaWRlbkxhYmVsKCk6IGJvb2xlYW4ge1xyXG4gICAgICAgIHJldHVybiAhdGhpcy5zaG93bGFiZWw7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBzb2x1dGlvblNlcnZpY2U6U29sdXRpb25TZXJ2aWNlKXt9XHJcblxyXG4gICAgbmdPbkluaXQoKTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy5pbml0RGF0ZSgpO1xyXG4gICAgICAgIGlmKHRoaXMuaXRlbSl7XHJcbiAgICAgICAgICAgIHRoaXMuYmVnaW5QbGFjZUhvbGRlciA9IHRoaXMuaXRlbS5iZWdpblBsYWNlSG9sZGVyIHx8ICcnO1xyXG4gICAgICAgICAgICB0aGlzLmVuZFBsYWNlSG9sZGVyID0gdGhpcy5pdGVtLmVuZFBsYWNlSG9sZGVyIHx8ICcnO1xyXG4gICAgICAgICAgICAvLyBjb25zdCB0eXBlID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHRoaXMuaXRlbS5wbGFjZUhvbGRlcik7XHJcbiAgICAgICAgICAgIC8vIGlmKHR5cGUgPT0gJ1tvYmplY3QgVW5kZWZpbmVkXScpe1xyXG4gICAgICAgICAgICAvLyAgICAgaWYodGhpcy5pdGVtLmNvbnRyb2wgJiYgdGhpcy5pdGVtLmNvbnRyb2wuaGFzT3duUHJvcGVydHkoJ3BsYWNlaG9sZGVyJykpe1xyXG4gICAgICAgICAgICAvLyAgICAgICAgIHRoaXMucGxhY2Vob2xkZXIgPSB0aGlzLml0ZW0uY29udHJvbC5wbGFjZWhvbGRlcjtcclxuICAgICAgICAgICAgLy8gICAgIH1cclxuICAgICAgICAgICAgLy8gfVxyXG4gICAgICAgICAgICAvLyBlbHNle1xyXG4gICAgICAgICAgICAvLyAgICAgdGhpcy5wbGFjZWhvbGRlciA9IHRoaXMuaXRlbS5wbGFjZUhvbGRlcjtcclxuICAgICAgICAgICAgLy8gfVxyXG4gICAgICAgICAgICAvLyBjb25zdCBiZWdpbnBsYWMgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodGhpcy5pdGVtLmJlZ2luUGxhY2VIb2xkZXIpO1xyXG4gICAgICAgICAgICAvLyBpZihiZWdpbnBsYWMgPT0gJ1tvYmplY3QgVW5kZWZpbmVkXScpe1xyXG4gICAgICAgICAgICAvLyAgICAgaWYodGhpcy5pdGVtLmNvbnRyb2wgJiYgdGhpcy5pdGVtLmNvbnRyb2wuaGFzT3duUHJvcGVydHkoJ3BsYWNlaG9sZGVyJykpe1xyXG4gICAgICAgICAgICAvLyAgICAgICAgIHRoaXMuYmVnaW5QbGFjZUhvbGRlciA9IHRoaXMuaXRlbS5jb250cm9sLmJlZ2luUGxhY2VIb2xkZXI7XHJcbiAgICAgICAgICAgIC8vICAgICB9XHJcbiAgICAgICAgICAgIC8vIH1cclxuICAgICAgICAgICAgLy8gZWxzZXtcclxuICAgICAgICAgICAgLy8gICAgIHRoaXMuYmVnaW5QbGFjZUhvbGRlciA9IHRoaXMuaXRlbS5iZWdpblBsYWNlSG9sZGVyO1xyXG4gICAgICAgICAgICAvLyB9XHJcbiAgICAgICAgICAgIC8vIGNvbnN0IGVuZHBsYWMgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodGhpcy5pdGVtLmVuZFBsYWNlSG9sZGVyKTtcclxuICAgICAgICAgICAgLy8gaWYoZW5kcGxhYyA9PSAnW29iamVjdCBVbmRlZmluZWRdJyl7XHJcbiAgICAgICAgICAgIC8vICAgICBpZih0aGlzLml0ZW0uY29udHJvbCAmJiB0aGlzLml0ZW0uY29udHJvbC5oYXNPd25Qcm9wZXJ0eSgncGxhY2Vob2xkZXInKSl7XHJcbiAgICAgICAgICAgIC8vICAgICAgICAgdGhpcy5lbmRQbGFjZUhvbGRlciA9IHRoaXMuaXRlbS5jb250cm9sLmVuZFBsYWNlSG9sZGVyO1xyXG4gICAgICAgICAgICAvLyAgICAgfVxyXG4gICAgICAgICAgICAvLyB9XHJcbiAgICAgICAgICAgIC8vIGVsc2V7XHJcbiAgICAgICAgICAgIC8vICAgICB0aGlzLmVuZFBsYWNlSG9sZGVyID0gdGhpcy5pdGVtLmVuZFBsYWNlSG9sZGVyO1xyXG4gICAgICAgICAgICAvLyB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIG5nT25DaGFuZ2VzKCk6IHZvaWQge1xyXG4gICAgICAgIHRoaXMuaW5pdERhdGUoKTtcclxuICAgIH1cclxuXHJcbiAgICBpbml0RGF0ZSgpe1xyXG4gICAgICAgIC8vIGlmKHRoaXMuaXRlbSAmJiB0aGlzLml0ZW0uY29udHJvbCAmJiB0aGlzLml0ZW0uY29udHJvbC5oYXNPd25Qcm9wZXJ0eSgnZm9ybWF0JykgJiYgdGhpcy5pdGVtLmNvbnRyb2wuZm9ybWF0KXtcclxuICAgICAgICAvLyAgICAgdGhpcy5kYXRlRm9ybWF0ID0gdGhpcy5pdGVtLmNvbnRyb2wuZm9ybWF0O1xyXG4gICAgICAgIC8vICAgICBpZih0aGlzLnNob3dUaW1lKXtcclxuICAgICAgICAvLyAgICAgICAgIGlmKHRoaXMuZGF0ZUZvcm1hdC5sZW5ndGggPiAwICYmIHRoaXMuZGF0ZUZvcm1hdC5pbmRleE9mKCdISDptbScpID09IC0xKXtcclxuICAgICAgICAvLyAgICAgICAgICAgICB0aGlzLmRhdGVGb3JtYXQgPSB0aGlzLmRhdGVGb3JtYXQgKyAnIEhIOm1tOnNzJztcclxuICAgICAgICAvLyAgICAgICAgIH1cclxuICAgICAgICAvLyAgICAgfVxyXG4gICAgICAgIC8vIH1cclxuICAgICAgICAvLyBlbHNle1xyXG4gICAgICAgIC8vICAgICB0aGlzLmRhdGVGb3JtYXQgPSB0aGlzLnNob3dUaW1lPyAneXl5eS1NTS1kZCBISDptbTpzcyc6J3l5eXktTU0tZGQnO1xyXG4gICAgICAgIC8vIH1cclxuICAgICAgICBpZih0aGlzLml0ZW0gJiYgdGhpcy5pdGVtLmNvbnRyb2wgJiYgdGhpcy5pdGVtLmNvbnRyb2wuaGFzT3duUHJvcGVydHkoJ2Zvcm1hdCcpKXtcclxuICAgICAgICAgICAgbGV0IGl0ZW1EYXRlRm9ybWF0ID0gdGhpcy5pdGVtLmNvbnRyb2wuZm9ybWF0O1xyXG4gICAgICAgICAgICBpZih0aGlzLnNob3dUaW1lKXtcclxuICAgICAgICAgICAgICAgIGlmKGl0ZW1EYXRlRm9ybWF0Lmxlbmd0aCA+IDAgJiYgaXRlbURhdGVGb3JtYXQuaW5kZXhPZignSEg6bW0nKSA9PSAtMSl7XHJcbiAgICAgICAgICAgICAgICAgICAgaXRlbURhdGVGb3JtYXQgPSBpdGVtRGF0ZUZvcm1hdCArICcgSEg6bW06c3MnO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNvbnN0IGZvcm1hdCA9IHRoaXMuc2hvd1RpbWUgPyAneXl5eS1NTS1kZCBISDptbTpzcyc6ICh0aGlzLnNob3dUeXBlID09ICcyJz8gJ3l5eXktTU0nOiAodGhpcy5zaG93VHlwZSA9PSAnMyc/ICd5eXl5JzoneXl5eS1NTS1kZCcpKTtcclxuICAgICAgICAgICAgdGhpcy5kYXRlRm9ybWF0ID0gaXRlbURhdGVGb3JtYXQ/aXRlbURhdGVGb3JtYXQ6Zm9ybWF0O1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCByYW5nZURhdGVWYWx1ZSA6IERhdGVSYW5nZVZhbHVlID0gdGhpcy5pdGVtICYmIHRoaXMuaXRlbS52YWx1ZTtcclxuICAgICAgICBpZihyYW5nZURhdGVWYWx1ZS5zdGFydFRpbWUgJiYgcmFuZ2VEYXRlVmFsdWUuZW5kVGltZSl7XHJcbiAgICAgICAgICAgIHRoaXMucmFuZ2VEYXRlID0gYCR7cmFuZ2VEYXRlVmFsdWUuc3RhcnRUaW1lfX4ke3JhbmdlRGF0ZVZhbHVlLmVuZFRpbWV9YDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0RGF0ZShkYXRlU3RyaW5nOkRhdGUpOkRhdGV7XHJcbiAgICAgICAgLy8gbGV0IGFycjE6QXJyYXk8YW55PiA9IGRhdGVTdHJpbmcuc3BsaXQoXCIgXCIpOyBcclxuICAgICAgICAvLyBsZXQgc2RhdGUgPSBhcnIxWzBdLnNwbGl0KCctJyk7IFxyXG4gICAgICAgIC8vIGxldCBkYXRlID0gbmV3IERhdGUoc2RhdGVbMF0sIHNkYXRlWzFdLTEsIHNkYXRlWzJdKTtcclxuICAgICAgICBsZXQgZGF0ZSA9IG5ldyBEYXRlKGRhdGVTdHJpbmcpOyBcclxuICAgICAgICByZXR1cm4gZGF0ZTtcclxuICAgIH1cclxuICAgXHJcbiAgICBvbkRhdGVDaGFuZ2UoZXZlbnQ6YW55KXtcclxuICAgICAgICBpZihldmVudC5yZXR1cm5Gb3JtYXR0ZWQpe1xyXG4gICAgICAgICAgICAodGhpcy5pdGVtLnZhbHVlIGFzIERhdGVSYW5nZVZhbHVlKS5zdGFydFRpbWUgPSBldmVudC5yZXR1cm5Gb3JtYXR0ZWQuc3BsaXQoJ34nKVswXTtcclxuICAgICAgICAgICAgKHRoaXMuaXRlbS52YWx1ZSBhcyBEYXRlUmFuZ2VWYWx1ZSkuZW5kVGltZSA9IGV2ZW50LnJldHVybkZvcm1hdHRlZC5zcGxpdCgnficpWzFdO1xyXG4gICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICAvLyB0aGlzLml0ZW0udmFsdWUgPSBuZXcgRGF0ZVJhbmdlVmFsdWUoKTtcclxuICAgICAgICAgICAgdGhpcy5pdGVtLnZhbHVlLnN0YXJ0VGltZSA9ICcnO1xyXG4gICAgICAgICAgICB0aGlzLml0ZW0udmFsdWUuZW5kVGltZSA9ICcnO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLml0ZW0udmFsdWVUZXh0ID0gZXZlbnQuZm9ybWF0dGVkO1xyXG4gICAgICAgIGlmKHRoaXMuZGlzYWJsZWQpe3JldHVybjt9XHJcbiAgICAgICAgdGhpcy5zZWFyY2hIYW5kbGUuZW1pdChldmVudCk7XHJcbiAgICB9XHJcbiAgICBnZXRDb25kaXRpb25JdGVtVGl0bGUoZmllbGQ6UXVlcnlDb25kaXRpb24pe1xyXG4gICAgICAgIHJldHVybiB0aGlzLnNvbHV0aW9uU2VydmljZS5nZXRDb25kaXRpb25JdGVtVGl0bGUoZmllbGQpO1xyXG4gICAgfVxyXG59Il19
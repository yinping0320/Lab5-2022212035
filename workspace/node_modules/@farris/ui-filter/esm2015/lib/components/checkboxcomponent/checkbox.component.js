/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input, HostBinding, EventEmitter, Output } from '@angular/core';
import { ControlType } from '../../entity/controltype';
import { SolutionService } from '../../service/solution.service';
import { CheckboxValue } from '../../entity/controltype/checkbox/checkboxvalue';
import { CheckboxGroupValue } from '../../entity/conditionvalue/checkboxgroupvalue';
export class filterCheckboxComponent {
    /**
     * @param {?} solutionService
     */
    constructor(solutionService) {
        this.solutionService = solutionService;
        this.searchHandle = new EventEmitter();
        /**
         * 判断是否是在扩展区域展示
         */
        this.extend = false;
        /**
         * 判断是否显示label
         */
        this.showlabel = true;
        this.boolcheck = false;
        this.indeterminate = true;
        this.boolCheckState = 'indeterminate';
        this.selectCheck = [];
        this.cla = true;
        this.checkboxDataSource = new Array();
    }
    /**
     * @return {?}
     */
    get isExtend() {
        return !this.extend && this.autoLabel;
    }
    /**
     * @return {?}
     */
    get isCheckExtend() {
        return !this.extend;
    }
    /**
     * @return {?}
     */
    get hidenLabel() {
        return !this.showlabel;
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        //this.checkValue = this.item.value.getOriginalValue();
        if (this.item && this.item.control && this.item.control.hasOwnProperty('isExtend')) {
            this.extend = this.item.control.isExtend;
            this.boolcheck = this.item.control.boolcheck;
            if (!this.extend) {
                this.showlabel = this.item.control.showLabel;
            }
        }
        this.getDataSource();
    }
    /**
     * @return {?}
     */
    ngOnChanges() {
        this.getDataSource();
    }
    /**
     * @return {?}
     */
    getDataSource() {
        this.checkValue = this.item.value.getOriginalValue();
        if (this.boolcheck) {
            if (this.checkValue.length) {
                this.boolchecked = this.checkValue[0];
                if (this.boolchecked)
                    this.boolCheckState = 'checked';
                else
                    this.boolCheckState = 'unchecked';
            }
            else
                this.boolCheckState = 'indeterminate';
        }
        if (this.item && this.item.control && this.item.control.getControlType() == ControlType.CheckboxGroup) {
            /** @type {?} */
            let checkboxList = ((/** @type {?} */ (this.item.control)));
            this.checkboxDataSource = Array();
            if (checkboxList.enumValues && checkboxList.enumValues.length > 0) {
                checkboxList.enumValues.forEach((/**
                 * @param {?} element
                 * @return {?}
                 */
                element => {
                    this.checkboxDataSource.push(Object.assign(new CheckboxValue(), element));
                }));
            }
        }
        // if(this.item && this.item.control && this.item.control.hasOwnProperty('isExtend')){
        //     this.extend = this.item.control.isExtend;
        // }
    }
    // getConditionItemStyle(field: QueryCondition, controlType: any) {
    //     return this.solutionService.getConditionItemStyle(field,controlType);
    // }
    /**
     * @param {?} field
     * @return {?}
     */
    getConditionItemTitle(field) {
        return this.solutionService.getConditionItemTitle(field);
    }
    /**
     * @param {?} event
     * @return {?}
     */
    onSearch(event) {
        /** @type {?} */
        let checkboxValue = [];
        if (event) {
            // let checkboxList = event.split(',');
            /** @type {?} */
            let checkboxList = event;
            if (checkboxList && checkboxList.length) {
                checkboxValue = checkboxList;
            }
            this.item.value.value = checkboxValue;
        }
        else {
            this.item.value.value = new CheckboxGroupValue();
        }
        if (this.disabled) {
            return;
        }
        this.searchHandle.emit();
    }
    /**
     * @return {?}
     */
    handleClick() {
        if (this.boolCheckState == 'indeterminate') {
            this.boolCheckState = 'checked';
            this.boolchecked = true;
            this.item.value.value = [true];
        }
        else if (this.boolCheckState == 'checked') {
            this.boolCheckState = 'unchecked';
            this.boolchecked = false;
            this.item.value.value = [false];
        }
        else if (this.boolCheckState == 'unchecked') {
            this.boolCheckState = 'indeterminate';
            this.boolchecked = null;
            this.item.value.value = [];
        }
        if (this.disabled) {
            return;
        }
        this.searchHandle.emit();
    }
}
filterCheckboxComponent.decorators = [
    { type: Component, args: [{
                selector: 'app-filter-checkbox',
                template: "<label class=\"col-form-label\" *ngIf=\"item && showlabel && !boolcheck\" title=\"{{getConditionItemTitle(item)}}\">\r\n    <span class=\"farris-label-info text-danger\" *ngIf=\"item.control.required\">*</span>\r\n    <span class=\"farris-label-text\" *ngIf=\"!boolcheck\">{{item.fieldName}}</span>\r\n</label>\r\n<div class=\"farris-input-wrap\" *ngIf=\"item\">\r\n    <ng-container *ngIf=\"!boolcheck; else elseTemplate\">\r\n        <farris-checkboxgroup [value]=\"checkValue\" [horizontal]=\"true\" [disable]=\"disabled\" [data]=\"checkboxDataSource\"\r\n            [isStringValue]=\"false\" (changeValue)=\"onSearch($event)\">\r\n        </farris-checkboxgroup>\r\n    </ng-container>\r\n    <ng-template #elseTemplate>\r\n        <div class=\"custom-control custom-checkbox custom-control-inline filter-bool-checkbox\">\r\n            <input type=\"checkbox\" class=\"custom-control-input\" [checked]=\"boolchecked\" [indeterminate]=\"boolCheckState == 'indeterminate'\">\r\n            <label class=\"custom-control-label\" (click)=\"handleClick()\">{{item.fieldName}}</label>\r\n        </div>\r\n    </ng-template>\r\n</div>"
                // encapsulation: ViewEncapsulation.None
            }] }
];
/** @nocollapse */
filterCheckboxComponent.ctorParameters = () => [
    { type: SolutionService }
];
filterCheckboxComponent.propDecorators = {
    item: [{ type: Input }],
    autoLabel: [{ type: Input }],
    disabled: [{ type: Input }],
    searchHandle: [{ type: Output, args: ['searchHandle',] }],
    isExtend: [{ type: HostBinding, args: ['class.filter-item-wrap',] }],
    isCheckExtend: [{ type: HostBinding, args: ['class.filter-item-checbox-wrap',] }],
    cla: [{ type: HostBinding, args: ['class.filter-item-checkboxgroup',] }],
    hidenLabel: [{ type: HostBinding, args: ['class.filter-item-hiddenlabel',] }]
};
if (false) {
    /**
     * QueryCondition类型
     * @type {?}
     */
    filterCheckboxComponent.prototype.item;
    /** @type {?} */
    filterCheckboxComponent.prototype.autoLabel;
    /** @type {?} */
    filterCheckboxComponent.prototype.disabled;
    /** @type {?} */
    filterCheckboxComponent.prototype.searchHandle;
    /**
     * 判断是否是在扩展区域展示
     * @type {?}
     */
    filterCheckboxComponent.prototype.extend;
    /**
     * 判断是否显示label
     * @type {?}
     */
    filterCheckboxComponent.prototype.showlabel;
    /** @type {?} */
    filterCheckboxComponent.prototype.boolcheck;
    /** @type {?} */
    filterCheckboxComponent.prototype.checkValue;
    /** @type {?} */
    filterCheckboxComponent.prototype.indeterminate;
    /** @type {?} */
    filterCheckboxComponent.prototype.boolchecked;
    /** @type {?} */
    filterCheckboxComponent.prototype.boolCheckState;
    /** @type {?} */
    filterCheckboxComponent.prototype.selectCheck;
    /** @type {?} */
    filterCheckboxComponent.prototype.cla;
    /** @type {?} */
    filterCheckboxComponent.prototype.checkboxDataSource;
    /**
     * @type {?}
     * @private
     */
    filterCheckboxComponent.prototype.solutionService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2hlY2tib3guY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy91aS1maWx0ZXIvIiwic291cmNlcyI6WyJsaWIvY29tcG9uZW50cy9jaGVja2JveGNvbXBvbmVudC9jaGVja2JveC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsS0FBSyxFQUF3QyxXQUFXLEVBQUUsWUFBWSxFQUFFLE1BQU0sRUFBQyxNQUFNLGVBQWUsQ0FBQztBQUV6SCxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sMEJBQTBCLENBQUM7QUFDdkQsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLGdDQUFnQyxDQUFDO0FBRWpFLE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSxpREFBaUQsQ0FBQztBQUNoRixPQUFPLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSxnREFBZ0QsQ0FBQztBQVFwRixNQUFNLE9BQU8sdUJBQXVCOzs7O0lBdUNoQyxZQUFvQixlQUErQjtRQUEvQixvQkFBZSxHQUFmLGVBQWUsQ0FBZ0I7UUEvQjNCLGlCQUFZLEdBQUcsSUFBSSxZQUFZLEVBQUUsQ0FBQzs7OztRQUUxRCxXQUFNLEdBQVcsS0FBSyxDQUFDOzs7O1FBRXZCLGNBQVMsR0FBVyxJQUFJLENBQUM7UUFDekIsY0FBUyxHQUFXLEtBQUssQ0FBQztRQUUxQixrQkFBYSxHQUFXLElBQUksQ0FBQztRQUU3QixtQkFBYyxHQUFVLGVBQWUsQ0FBQztRQUV4QyxnQkFBVyxHQUFHLEVBQUUsQ0FBQztRQVkrQixRQUFHLEdBQUcsSUFBSSxDQUFDO1FBTTNELHVCQUFrQixHQUFZLElBQUksS0FBSyxFQUFPLENBQUM7SUFFTSxDQUFDOzs7O0lBbEJ0RCxJQUNJLFFBQVE7UUFDUixPQUFPLENBQUMsSUFBSSxDQUFDLE1BQU0sSUFBSSxJQUFJLENBQUMsU0FBUyxDQUFDO0lBQzFDLENBQUM7Ozs7SUFFRCxJQUNJLGFBQWE7UUFDYixPQUFPLENB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QUF3QzthQUMzQzs7OztZQVRRLGVBQWU7OzttQkFnQm5CLEtBQUs7d0JBQ0wsS0FBSzt1QkFDTCxLQUFLOzJCQUNMLE1BQU0sU0FBQyxjQUFjO3VCQWFyQixXQUFXLFNBQUMsd0JBQXdCOzRCQUtwQyxXQUFXLFNBQUMsZ0NBQWdDO2tCQUs1QyxXQUFXLFNBQUMsaUNBQWlDO3lCQUM3QyxXQUFXLFNBQUMsK0JBQStCOzs7Ozs7O0lBM0I1Qyx1Q0FBa0I7O0lBQ2xCLDRDQUEyQjs7SUFDM0IsMkNBQTBCOztJQUMxQiwrQ0FBMEQ7Ozs7O0lBRTFELHlDQUF1Qjs7Ozs7SUFFdkIsNENBQXlCOztJQUN6Qiw0Q0FBMEI7O0lBQzFCLDZDQUFrQjs7SUFDbEIsZ0RBQTZCOztJQUM3Qiw4Q0FBb0I7O0lBQ3BCLGlEQUF3Qzs7SUFFeEMsOENBQWlCOztJQVlqQixzQ0FBMkQ7O0lBTTNELHFEQUErQzs7Ozs7SUFFbkMsa0RBQXVDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBJbnB1dCwgT25Jbml0LCBPbkNoYW5nZXMsIFZpZXdFbmNhcHN1bGF0aW9uLCBIb3N0QmluZGluZywgRXZlbnRFbWl0dGVyLCBPdXRwdXR9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBRdWVyeUNvbmRpdGlvbiB9IGZyb20gJy4uLy4uL2VudGl0eS9xdWVyeWNvbmRpdGlvbic7XHJcbmltcG9ydCB7IENvbnRyb2xUeXBlIH0gZnJvbSAnLi4vLi4vZW50aXR5L2NvbnRyb2x0eXBlJztcclxuaW1wb3J0IHsgU29sdXRpb25TZXJ2aWNlIH0gZnJvbSAnLi4vLi4vc2VydmljZS9zb2x1dGlvbi5zZXJ2aWNlJztcclxuaW1wb3J0IHsgQ2hlY2tib3hHcm91cENvbnRyb2wgfSBmcm9tICcuLi8uLi9lbnRpdHkvY29udHJvbHR5cGUvY2hlY2tib3gvY2hlY2tib3hjb250cm9sJztcclxuaW1wb3J0IHsgQ2hlY2tib3hWYWx1ZSB9IGZyb20gJy4uLy4uL2VudGl0eS9jb250cm9sdHlwZS9jaGVja2JveC9jaGVja2JveHZhbHVlJztcclxuaW1wb3J0IHsgQ2hlY2tib3hHcm91cFZhbHVlIH0gZnJvbSAnLi4vLi4vZW50aXR5L2NvbmRpdGlvbnZhbHVlL2NoZWNrYm94Z3JvdXB2YWx1ZSc7XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICAgIHNlbGVjdG9yOiAnYXBwLWZpbHRlci1jaGVja2JveCcsXHJcbiAgICB0ZW1wbGF0ZVVybDogJy4vY2hlY2tib3guY29tcG9uZW50Lmh0bWwnXHJcbiAgICAvLyBlbmNhcHN1bGF0aW9uOiBWaWV3RW5jYXBzdWxhdGlvbi5Ob25lXHJcbn0pXHJcblxyXG5leHBvcnQgY2xhc3MgZmlsdGVyQ2hlY2tib3hDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsT25DaGFuZ2Vze1xyXG4gICBcclxuICAgIC8qKlxyXG4gICAgICogUXVlcnlDb25kaXRpb27nsbvlnotcclxuICAgICAqL1xyXG4gICAgQElucHV0KCkgaXRlbTphbnk7XHJcbiAgICBASW5wdXQoKSBhdXRvTGFiZWw6Ym9vbGVhbjtcclxuICAgIEBJbnB1dCgpIGRpc2FibGVkOmJvb2xlYW47XHJcbiAgICBAT3V0cHV0KCdzZWFyY2hIYW5kbGUnKSBzZWFyY2hIYW5kbGUgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcbiAgICAvKirliKTmlq3mmK/lkKbmmK/lnKjmianlsZXljLrln5/lsZXnpLogKi9cclxuICAgIGV4dGVuZDpib29sZWFuID0gZmFsc2U7XHJcbiAgICAvKirliKTmlq3mmK/lkKbmmL7npLpsYWJlbCAqL1xyXG4gICAgc2hvd2xhYmVsOmJvb2xlYW4gPSB0cnVlO1xyXG4gICAgYm9vbGNoZWNrOmJvb2xlYW4gPSBmYWxzZTtcclxuICAgIGNoZWNrVmFsdWU6IGFueVtdO1xyXG4gICAgaW5kZXRlcm1pbmF0ZTpib29sZWFuID0gdHJ1ZTtcclxuICAgIGJvb2xjaGVja2VkOmJvb2xlYW47XHJcbiAgICBib29sQ2hlY2tTdGF0ZTpzdHJpbmcgPSAnaW5kZXRlcm1pbmF0ZSc7XHJcblxyXG4gICAgc2VsZWN0Q2hlY2sgPSBbXTtcclxuXHJcbiAgICBASG9zdEJpbmRpbmcoJ2NsYXNzLmZpbHRlci1pdGVtLXdyYXAnKVxyXG4gICAgZ2V0IGlzRXh0ZW5kKCk6IGJvb2xlYW4ge1xyXG4gICAgICAgIHJldHVybiAhdGhpcy5leHRlbmQgJiYgdGhpcy5hdXRvTGFiZWw7XHJcbiAgICB9XHJcblxyXG4gICAgQEhvc3RCaW5kaW5nKCdjbGFzcy5maWx0ZXItaXRlbS1jaGVjYm94LXdyYXAnKVxyXG4gICAgZ2V0IGlzQ2hlY2tFeHRlbmQoKTogYm9vbGVhbiB7XHJcbiAgICAgICAgcmV0dXJuICF0aGlzLmV4dGVuZDtcclxuICAgIH1cclxuXHJcbiAgICBASG9zdEJpbmRpbmcoJ2NsYXNzLmZpbHRlci1pdGVtLWNoZWNrYm94Z3JvdXAnKSBjbGEgPSB0cnVlO1xyXG4gICAgQEhvc3RCaW5kaW5nKCdjbGFzcy5maWx0ZXItaXRlbS1oaWRkZW5sYWJlbCcpXHJcbiAgICBnZXQgaGlkZW5MYWJlbCgpOiBib29sZWFuIHtcclxuICAgICAgICByZXR1cm4gIXRoaXMuc2hvd2xhYmVsO1xyXG4gICAgfVxyXG5cclxuICAgIGNoZWNrYm94RGF0YVNvdXJjZTpBcnJheTxhbnk+PW5ldyBBcnJheTxhbnk+KCk7XHJcblxyXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBzb2x1dGlvblNlcnZpY2U6U29sdXRpb25TZXJ2aWNlKXt9XHJcblxyXG4gICAgbmdPbkluaXQoKTogdm9pZCB7XHJcbiAgICAgICAgLy90aGlzLmNoZWNrVmFsdWUgPSB0aGlzLml0ZW0udmFsdWUuZ2V0T3JpZ2luYWxWYWx1ZSgpO1xyXG4gICAgICAgIGlmKHRoaXMuaXRlbSAmJiB0aGlzLml0ZW0uY29udHJvbCAmJiB0aGlzLml0ZW0uY29udHJvbC5oYXNPd25Qcm9wZXJ0eSgnaXNFeHRlbmQnKSl7XHJcbiAgICAgICAgICAgIHRoaXMuZXh0ZW5kID0gdGhpcy5pdGVtLmNvbnRyb2wuaXNFeHRlbmQ7XHJcbiAgICAgICAgICAgIHRoaXMuYm9vbGNoZWNrID0gdGhpcy5pdGVtLmNvbnRyb2wuYm9vbGNoZWNrO1xyXG4gICAgICAgICAgICBpZighdGhpcy5leHRlbmQpe1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zaG93bGFiZWwgPSB0aGlzLml0ZW0uY29udHJvbC5zaG93TGFiZWw7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5nZXREYXRhU291cmNlKCk7XHJcbiAgICB9XHJcblxyXG4gICAgbmdPbkNoYW5nZXMoKTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy5nZXREYXRhU291cmNlKCk7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0RGF0YVNvdXJjZSgpe1xyXG4gICAgICAgIHRoaXMuY2hlY2tWYWx1ZSA9IHRoaXMuaXRlbS52YWx1ZS5nZXRPcmlnaW5hbFZhbHVlKCk7XHJcbiAgICAgICAgaWYodGhpcy5ib29sY2hlY2spe1xyXG4gICAgICAgICAgICBpZih0aGlzLmNoZWNrVmFsdWUubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmJvb2xjaGVja2VkID0gdGhpcy5jaGVja1ZhbHVlWzBdO1xyXG4gICAgICAgICAgICAgICAgaWYodGhpcy5ib29sY2hlY2tlZCkgdGhpcy5ib29sQ2hlY2tTdGF0ZSA9ICdjaGVja2VkJztcclxuICAgICAgICAgICAgICAgIGVsc2UgdGhpcy5ib29sQ2hlY2tTdGF0ZSA9ICd1bmNoZWNrZWQnO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2UgdGhpcy5ib29sQ2hlY2tTdGF0ZSA9ICdpbmRldGVybWluYXRlJztcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYodGhpcy5pdGVtICYmIHRoaXMuaXRlbS5jb250cm9sICYmIHRoaXMuaXRlbS5jb250cm9sLmdldENvbnRyb2xUeXBlKCk9PUNvbnRyb2xUeXBlLkNoZWNrYm94R3JvdXApe1xyXG4gICAgICAgICAgICBsZXQgY2hlY2tib3hMaXN0PSh0aGlzLml0ZW0uY29udHJvbCBhcyBDaGVja2JveEdyb3VwQ29udHJvbCk7XHJcbiAgICAgICAgICAgIHRoaXMuY2hlY2tib3hEYXRhU291cmNlID0gQXJyYXk8Q2hlY2tib3hWYWx1ZT4oKTtcclxuXHJcbiAgICAgICAgICAgIGlmKGNoZWNrYm94TGlzdC5lbnVtVmFsdWVzICYmIGNoZWNrYm94TGlzdC5lbnVtVmFsdWVzLmxlbmd0aD4wKXtcclxuICAgICAgICAgICAgICAgIGNoZWNrYm94TGlzdC5lbnVtVmFsdWVzLmZvckVhY2goZWxlbWVudCA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jaGVja2JveERhdGFTb3VyY2UucHVzaChPYmplY3QuYXNzaWduKG5ldyBDaGVja2JveFZhbHVlKCksZWxlbWVudCkpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gaWYodGhpcy5pdGVtICYmIHRoaXMuaXRlbS5jb250cm9sICYmIHRoaXMuaXRlbS5jb250cm9sLmhhc093blByb3BlcnR5KCdpc0V4dGVuZCcpKXtcclxuICAgICAgICAvLyAgICAgdGhpcy5leHRlbmQgPSB0aGlzLml0ZW0uY29udHJvbC5pc0V4dGVuZDtcclxuICAgICAgICAvLyB9XHJcbiAgICB9XHJcblxyXG4gICAgLy8gZ2V0Q29uZGl0aW9uSXRlbVN0eWxlKGZpZWxkOiBRdWVyeUNvbmRpdGlvbiwgY29udHJvbFR5cGU6IGFueSkge1xyXG4gICAgLy8gICAgIHJldHVybiB0aGlzLnNvbHV0aW9uU2VydmljZS5nZXRDb25kaXRpb25JdGVtU3R5bGUoZmllbGQsY29udHJvbFR5cGUpO1xyXG4gICAgLy8gfVxyXG5cclxuICAgIGdldENvbmRpdGlvbkl0ZW1UaXRsZShmaWVsZDpRdWVyeUNvbmRpdGlvbil7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuc29sdXRpb25TZXJ2aWNlLmdldENvbmRpdGlvbkl0ZW1UaXRsZShmaWVsZCk7XHJcbiAgICB9XHJcblxyXG4gICAgb25TZWFyY2goZXZlbnQpe1xyXG4gICAgICAgIGxldCBjaGVja2JveFZhbHVlID0gW107XHJcbiAgICAgICAgaWYoZXZlbnQpe1xyXG4gICAgICAgICAgICAvLyBsZXQgY2hlY2tib3hMaXN0ID0gZXZlbnQuc3BsaXQoJywnKTtcclxuICAgICAgICAgICAgbGV0IGNoZWNrYm94TGlzdCA9IGV2ZW50O1xyXG4gICAgICAgICAgICBpZihjaGVja2JveExpc3QgJiYgY2hlY2tib3hMaXN0Lmxlbmd0aCl7XHJcbiAgICAgICAgICAgICAgICBjaGVja2JveFZhbHVlID0gY2hlY2tib3hMaXN0O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMuaXRlbS52YWx1ZS52YWx1ZSA9IGNoZWNrYm94VmFsdWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2V7XHJcbiAgICAgICAgICAgIHRoaXMuaXRlbS52YWx1ZS52YWx1ZSA9IG5ldyBDaGVja2JveEdyb3VwVmFsdWUoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYodGhpcy5kaXNhYmxlZCl7cmV0dXJuO31cclxuICAgICAgICB0aGlzLnNlYXJjaEhhbmRsZS5lbWl0KCk7XHJcbiAgICB9XHJcblxyXG4gICAgaGFuZGxlQ2xpY2soKSB7XHJcbiAgICAgICAgaWYodGhpcy5ib29sQ2hlY2tTdGF0ZSA9PSAnaW5kZXRlcm1pbmF0ZScpe1xyXG4gICAgICAgICAgICB0aGlzLmJvb2xDaGVja1N0YXRlID0gJ2NoZWNrZWQnO1xyXG4gICAgICAgICAgICB0aGlzLmJvb2xjaGVja2VkID0gdHJ1ZTtcclxuICAgICAgICAgICAgdGhpcy5pdGVtLnZhbHVlLnZhbHVlID0gW3RydWVdO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmKHRoaXMuYm9vbENoZWNrU3RhdGUgPT0gJ2NoZWNrZWQnKXtcclxuICAgICAgICAgICAgdGhpcy5ib29sQ2hlY2tTdGF0ZSA9ICd1bmNoZWNrZWQnO1xyXG4gICAgICAgICAgICB0aGlzLmJvb2xjaGVja2VkID0gZmFsc2U7XHJcbiAgICAgICAgICAgIHRoaXMuaXRlbS52YWx1ZS52YWx1ZSA9IFtmYWxzZV07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYodGhpcy5ib29sQ2hlY2tTdGF0ZSA9PSAndW5jaGVja2VkJyl7XHJcbiAgICAgICAgICAgIHRoaXMuYm9vbENoZWNrU3RhdGUgPSAnaW5kZXRlcm1pbmF0ZSc7XHJcbiAgICAgICAgICAgIHRoaXMuYm9vbGNoZWNrZWQgPSBudWxsO1xyXG4gICAgICAgICAgICB0aGlzLml0ZW0udmFsdWUudmFsdWUgPSBbXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYodGhpcy5kaXNhYmxlZCl7cmV0dXJuO31cclxuICAgICAgICB0aGlzLnNlYXJjaEhhbmRsZS5lbWl0KCk7XHJcbiAgICB9XHJcbn0iXX0=
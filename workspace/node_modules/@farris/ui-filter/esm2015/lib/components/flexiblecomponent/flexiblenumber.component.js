/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input, HostBinding, EventEmitter, Output, ElementRef } from '@angular/core';
import { SolutionService } from '../../service/solution.service';
import { LocaleService } from '@farris/ui-locale';
export class FlexibleNumberComponent {
    /**
     * @param {?} solutionService
     * @param {?} element
     * @param {?} localeService
     */
    constructor(solutionService, element, localeService) {
        this.solutionService = solutionService;
        this.element = element;
        this.localeService = localeService;
        this.searchHandle = new EventEmitter();
        /**
         * 判断是否是在扩展区域展示
         */
        this.extend = false;
        /**
         * 判断是否显示label
         */
        this.showlabel = true;
        this.canNull = true;
    }
    /**
     * @return {?}
     */
    get isExtend() {
        return !this.extend && this.autoLabel;
    }
    /**
     * @return {?}
     */
    get hidenLabel() {
        return !this.showlabel;
    }
    /**
     * @param {?} nr
     * @return {?}
     */
    set item(nr) {
        this._item = nr;
        this.precision = nr.control.precision;
        this.bigNumber = nr.control.bigNumber;
        if (!this.bigNumber) {
            this.min = -2147483648;
            this.max = 2147483647;
        }
        if (this._item && this._item.control && this._item.control.hasOwnProperty('isExtend')) {
            this.extend = this._item.control.isExtend;
            if (!this.extend) {
                this.showlabel = this._item.control.showLabel;
            }
        }
        this.beginPlaceHolder = (this._item.hasOwnProperty('beginPlaceHolder') && this._item.beginPlaceHolder) ? this._item.beginPlaceHolder : this.localeService.getValue('filterPanel.beginPlaceHolder');
        this.endPlaceHolder = (this._item.hasOwnProperty('endPlaceHolder') && this._item.beginPlaceHolder) ? this._item.endPlaceHolder : this.localeService.getValue('filterPanel.endPlaceHolder');
        this.placeholder = (this._item.hasOwnProperty('placeHolder') && this._item.placeHolder) ? this._item.placeHolder : '';
        this.single = this._item.control.single;
        this._item.value.single = this.single;
        this.constructMultiFieldNumberRange((/** @type {?} */ (nr.value)));
    }
    /**
     * @return {?}
     */
    get item() {
        return this._item;
    }
    /**
     * @return {?}
     */
    ngOnInit() { }
    /**
     * @return {?}
     */
    ngAfterViewInit() { }
    /**
     * @param {?} field
     * @return {?}
     */
    getConditionItemTitle(field) {
        return this.solutionService.getConditionItemTitle(field);
    }
    /**
     * @param {?} value
     * @return {?}
     */
    constructMultiFieldNumberRange(value) {
        if (this.single) {
            this.value = value.value == null ? null : value.value;
        }
        else {
            this.beginValue = value.startValue == null ? null : value.startValue;
            this.endValue = value.endValue == null ? null : value.endValue;
        }
    }
    /**
     * @param {?} event
     * @return {?}
     */
    numberChange(event) {
        if (event) {
            this._item.value.value = event;
        }
        else {
            this._item.value.value = null;
        }
        if (Object.keys(this._item.value).length === 0) {
            this._item.valueText = '';
        }
        else {
            this._item.valueText = '' + this._item.value.value;
        }
        if (this.disabled) {
            return;
        }
        this.searchHandle.emit();
    }
    /**
     * @param {?} event
     * @return {?}
     */
    beginValueChange(event) {
        this._item.value.startValue = event;
        this.setValueText();
        if (this.disabled) {
            return;
        }
        this.searchHandle.emit();
    }
    /**
     * @param {?} event
     * @return {?}
     */
    endValueChange(event) {
        this._item.value.endValue = event;
        this.setValueText();
        if (this.disabled) {
            return;
        }
        this.searchHandle.emit();
    }
    /**
     * @return {?}
     */
    setValueText() {
        if (Object.keys(this._item.value).length === 0 || (this._item.value.startValue == null && this._item.value.endValue == null)) {
            this._item.valueText = '';
        }
        else if (this._item.value.startValue == null) {
            this._item.valueText = '~' + this._item.value.endValue;
        }
        else if (this._item.value.endValue == null) {
            this._item.valueText = this._item.value.startValue + '~';
        }
        else {
            this._item.valueText = this._item.value.startValue + '~' + this._item.value.endValue;
        }
    }
}
FlexibleNumberComponent.decorators = [
    { type: Component, args: [{
                selector: 'app-filter-flexiblenumber',
                template: "<label class=\"col-form-label\" *ngIf=\"item && showlabel\" title=\"{{getConditionItemTitle(item)}}\">\r\n    <span class=\"farris-label-info text-danger\" *ngIf=\"item.control.required\">*</span>\r\n    <span class=\"farris-label-text\">{{item.fieldName}}</span>\r\n</label>\r\n<div class=\"farris-input-wrap d-flex\">\r\n    <ng-container *ngIf=\"single; else elseTemplate\">\r\n        <farris-number-spinner class=\"f-utils-fill-flex-row\" [(ngModel)]=\"value\" [canNull]=\"canNull\" [disabled]=\"disabled\"\r\n            [precision]=\"precision\" [bigNumber]=\"bigNumber\" [min]=\"min\" [max]=\"max\" [placeholder]=\"placeholder\"\r\n            (valueChange)=\"numberChange($event)\" #numberText></farris-number-spinner>\r\n    </ng-container>\r\n    <ng-template #elseTemplate>\r\n        <div class=\"d-flex align-items-center\">\r\n            <farris-number-spinner [(ngModel)]=\"beginValue\" [canNull]=\"canNull\" [precision]=\"precision\" [disabled]=\"disabled\"\r\n                [bigNumber]=\"bigNumber\" [min]=\"min\" [max]=\"endValue?endValue:max\" [placeholder]=\"beginPlaceHolder\"\r\n                (valueChange)=\"beginValueChange($event)\" #beginNumberText></farris-number-spinner>\r\n            <span class=\"f-icon f-icon-orientation-arrow f-filter-panel-flexible-icon\"></span>\r\n            <farris-number-spinner [(ngModel)]=\"endValue\" [canNull]=\"canNull\" [precision]=\"precision\"\r\n                [bigNumber]=\"bigNumber\" [min]=\"beginValue?beginValue:min\" [max]=\"max\" [placeholder]=\"endPlaceHolder\"\r\n                (valueChange)=\"endValueChange($event)\"></farris-number-spinner>\r\n        </div>\r\n    </ng-template>\r\n</div>"
            }] }
];
/** @nocollapse */
FlexibleNumberComponent.ctorParameters = () => [
    { type: SolutionService },
    { type: ElementRef },
    { type: LocaleService }
];
FlexibleNumberComponent.propDecorators = {
    autoLabel: [{ type: Input }],
    disabled: [{ type: Input }],
    searchHandle: [{ type: Output, args: ['searchHandle',] }],
    isExtend: [{ type: HostBinding, args: ['class.filter-item-wrap',] }],
    hidenLabel: [{ type: HostBinding, args: ['class.filter-item-hiddenlabel',] }],
    item: [{ type: Input }]
};
if (false) {
    /** @type {?} */
    FlexibleNumberComponent.prototype.autoLabel;
    /** @type {?} */
    FlexibleNumberComponent.prototype.disabled;
    /** @type {?} */
    FlexibleNumberComponent.prototype.searchHandle;
    /**
     * 判断是否是在扩展区域展示
     * @type {?}
     */
    FlexibleNumberComponent.prototype.extend;
    /**
     * 判断是否显示label
     * @type {?}
     */
    FlexibleNumberComponent.prototype.showlabel;
    /** @type {?} */
    FlexibleNumberComponent.prototype.canNull;
    /** @type {?} */
    FlexibleNumberComponent.prototype.number;
    /** @type {?} */
    FlexibleNumberComponent.prototype.value;
    /** @type {?} */
    FlexibleNumberComponent.prototype.beginValue;
    /** @type {?} */
    FlexibleNumberComponent.prototype.endValue;
    /** @type {?} */
    FlexibleNumberComponent.prototype.precision;
    /** @type {?} */
    FlexibleNumberComponent.prototype.placeholder;
    /** @type {?} */
    FlexibleNumberComponent.prototype.beginPlaceHolder;
    /** @type {?} */
    FlexibleNumberComponent.prototype.endPlaceHolder;
    /** @type {?} */
    FlexibleNumberComponent.prototype.bigNumber;
    /** @type {?} */
    FlexibleNumberComponent.prototype.max;
    /** @type {?} */
    FlexibleNumberComponent.prototype.min;
    /** @type {?} */
    FlexibleNumberComponent.prototype.single;
    /** @type {?} */
    FlexibleNumberComponent.prototype._item;
    /**
     * @type {?}
     * @private
     */
    FlexibleNumberComponent.prototype.solutionService;
    /**
     * @type {?}
     * @private
     */
    FlexibleNumberComponent.prototype.element;
    /**
     * @type {?}
     * @private
     */
    FlexibleNumberComponent.prototype.localeService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmxleGlibGVudW1iZXIuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy91aS1maWx0ZXIvIiwic291cmNlcyI6WyJsaWIvY29tcG9uZW50cy9mbGV4aWJsZWNvbXBvbmVudC9mbGV4aWJsZW51bWJlci5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsS0FBSyxFQUFVLFdBQVcsRUFBRSxZQUFZLEVBQUUsTUFBTSxFQUFpQixVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFFdkgsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLGdDQUFnQyxDQUFDO0FBQ2pFLE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQVNsRCxNQUFNLE9BQU8sdUJBQXVCOzs7Ozs7SUErRGhDLFlBQW9CLGVBQWdDLEVBQW1CLE9BQW1CLEVBQVUsYUFBNEI7UUFBNUcsb0JBQWUsR0FBZixlQUFlLENBQWlCO1FBQW1CLFlBQU8sR0FBUCxPQUFPLENBQVk7UUFBVSxrQkFBYSxHQUFiLGFBQWEsQ0FBZTtRQTFEeEcsaUJBQVksR0FBRyxJQUFJLFlBQVksRUFBRSxDQUFDOzs7O1FBRzFELFdBQU0sR0FBWSxLQUFLLENBQUM7Ozs7UUFFeEIsY0FBUyxHQUFZLElBQUksQ0FBQztRQUMxQixZQUFPLEdBQVksSUFBSSxDQUFDO0lBb0Q0RyxDQUFDOzs7O0lBckNySSxJQUNJLFFBQVE7UUFDUixPQUFPLENBQUMsSUFBSSxDQUFDLE1BQU0sSUFBSSxJQUFJLENBQUMsU0FBUyxDQUFDO0lBQzFDLENBQUM7Ozs7SUFDRCxJQUNJLFVBQVU7UUFDVixPQUFPLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQztJQUMzQixDQUFDOzs7OztJQUdELElBQ0ksSUFBSSxDQUFDLEVBQU87UUFDWixJQUFJLENBQUMsS0FBSyxHQUFHLEVBQUUsQ0FBQztRQUNoQixJQUFJLENBQUMsU0FBUyxHQUFHLEVBQUUsQ0FB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USxlQUFlO1lBRjZELFVBQVU7WUFHdEYsYUFBYTs7O3dCQVlqQixLQUFLO3VCQUNMLEtBQUs7MkJBQ0wsTUFBTSxTQUFDLGNBQWM7dUJBcUJyQixXQUFXLFNBQUMsd0JBQXdCO3lCQUlwQyxXQUFXLFNBQUMsK0JBQStCO21CQU0zQyxLQUFLOzs7O0lBakNOLDRDQUE0Qjs7SUFDNUIsMkNBQTJCOztJQUMzQiwrQ0FBMEQ7Ozs7O0lBRzFELHlDQUF3Qjs7Ozs7SUFFeEIsNENBQTBCOztJQUMxQiwwQ0FBd0I7O0lBRXhCLHlDQUFlOztJQUNmLHdDQUFXOztJQUNYLDZDQUFnQjs7SUFDaEIsMkNBQWM7O0lBQ2QsNENBQWtCOztJQUNsQiw4Q0FBb0I7O0lBQ3BCLG1EQUF5Qjs7SUFDekIsaURBQXVCOztJQUN2Qiw0Q0FBbUI7O0lBQ25CLHNDQUFZOztJQUNaLHNDQUFZOztJQUNaLHlDQUFnQjs7SUFXaEIsd0NBQVc7Ozs7O0lBNEJDLGtEQUF3Qzs7Ozs7SUFBRSwwQ0FBb0M7Ozs7O0lBQUUsZ0RBQW9DIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBJbnB1dCwgT25Jbml0LCBIb3N0QmluZGluZywgRXZlbnRFbWl0dGVyLCBPdXRwdXQsIEFmdGVyVmlld0luaXQsIEVsZW1lbnRSZWYgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgUXVlcnlDb25kaXRpb24gfSBmcm9tICcuLi8uLi9lbnRpdHkvcXVlcnljb25kaXRpb24nO1xyXG5pbXBvcnQgeyBTb2x1dGlvblNlcnZpY2UgfSBmcm9tICcuLi8uLi9zZXJ2aWNlL3NvbHV0aW9uLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBMb2NhbGVTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy91aS1sb2NhbGUnO1xyXG5pbXBvcnQgeyBGbGV4aWJsZU51bWJlclZhbHVlIH0gZnJvbSAnLi4vLi4vZW50aXR5L2NvbmRpdGlvbnZhbHVlL2ZsZXhpYmxlbnVtYmVydmFsdWUnO1xyXG5cclxuXHJcbkBDb21wb25lbnQoe1xyXG4gICAgc2VsZWN0b3I6ICdhcHAtZmlsdGVyLWZsZXhpYmxlbnVtYmVyJyxcclxuICAgIHRlbXBsYXRlVXJsOiAnLi9mbGV4aWJsZW51bWJlci5jb21wb25lbnQuaHRtbCdcclxufSlcclxuXHJcbmV4cG9ydCBjbGFzcyBGbGV4aWJsZU51bWJlckNvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgQWZ0ZXJWaWV3SW5pdCB7XHJcblxyXG4gICAgLy8gQElucHV0KCkgaXRlbTphbnk7XHJcbiAgICBASW5wdXQoKSBhdXRvTGFiZWw6IGJvb2xlYW47XHJcbiAgICBASW5wdXQoKSBkaXNhYmxlZDogYm9vbGVhbjtcclxuICAgIEBPdXRwdXQoJ3NlYXJjaEhhbmRsZScpIHNlYXJjaEhhbmRsZSA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuXHJcbiAgICAvKirliKTmlq3mmK/lkKbmmK/lnKjmianlsZXljLrln5/lsZXnpLogKi9cclxuICAgIGV4dGVuZDogYm9vbGVhbiA9IGZhbHNlO1xyXG4gICAgLyoq5Yik5pat5piv5ZCm5pi+56S6bGFiZWwgKi9cclxuICAgIHNob3dsYWJlbDogYm9vbGVhbiA9IHRydWU7XHJcbiAgICBjYW5OdWxsOiBib29sZWFuID0gdHJ1ZTtcclxuXHJcbiAgICBudW1iZXI6IHN0cmluZztcclxuICAgIHZhbHVlOiBhbnk7XHJcbiAgICBiZWdpblZhbHVlOiBhbnk7XHJcbiAgICBlbmRWYWx1ZTogYW55O1xyXG4gICAgcHJlY2lzaW9uOiBudW1iZXI7XHJcbiAgICBwbGFjZWhvbGRlcjogc3RyaW5nO1xyXG4gICAgYmVnaW5QbGFjZUhvbGRlcjogc3RyaW5nO1xyXG4gICAgZW5kUGxhY2VIb2xkZXI6IHN0cmluZztcclxuICAgIGJpZ051bWJlcjogYm9vbGVhbjtcclxuICAgIG1heDogbnVtYmVyO1xyXG4gICAgbWluOiBudW1iZXI7XHJcbiAgICBzaW5nbGU6IGJvb2xlYW47XHJcblxyXG4gICAgQEhvc3RCaW5kaW5nKCdjbGFzcy5maWx0ZXItaXRlbS13cmFwJylcclxuICAgIGdldCBpc0V4dGVuZCgpOiBib29sZWFuIHtcclxuICAgICAgICByZXR1cm4gIXRoaXMuZXh0ZW5kICYmIHRoaXMuYXV0b0xhYmVsO1xyXG4gICAgfVxyXG4gICAgQEhvc3RCaW5kaW5nKCdjbGFzcy5maWx0ZXItaXRlbS1oaWRkZW5sYWJlbCcpXHJcbiAgICBnZXQgaGlkZW5MYWJlbCgpOiBib29sZWFuIHtcclxuICAgICAgICByZXR1cm4gIXRoaXMuc2hvd2xhYmVsO1xyXG4gICAgfVxyXG5cclxuICAgIF9pdGVtOiBhbnk7XHJcbiAgICBASW5wdXQoKVxyXG4gICAgc2V0IGl0ZW0obnI6IGFueSkge1xyXG4gICAgICAgIHRoaXMuX2l0ZW0gPSBucjtcclxuICAgICAgICB0aGlzLnByZWNpc2lvbiA9IG5yLmNvbnRyb2wucHJlY2lzaW9uO1xyXG4gICAgICAgIHRoaXMuYmlnTnVtYmVyID0gbnIuY29udHJvbC5iaWdOdW1iZXI7XHJcbiAgICAgICAgaWYgKCF0aGlzLmJpZ051bWJlcikge1xyXG4gICAgICAgICAgICB0aGlzLm1pbiA9IC0yMTQ3NDgzNjQ4O1xyXG4gICAgICAgICAgICB0aGlzLm1heCA9IDIxNDc0ODM2NDc7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0aGlzLl9pdGVtICYmIHRoaXMuX2l0ZW0uY29udHJvbCAmJiB0aGlzLl9pdGVtLmNvbnRyb2wuaGFzT3duUHJvcGVydHkoJ2lzRXh0ZW5kJykpIHtcclxuICAgICAgICAgICAgdGhpcy5leHRlbmQgPSB0aGlzLl9pdGVtLmNvbnRyb2wuaXNFeHRlbmQ7XHJcbiAgICAgICAgICAgIGlmICghdGhpcy5leHRlbmQpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2hvd2xhYmVsID0gdGhpcy5faXRlbS5jb250cm9sLnNob3dMYWJlbDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmJlZ2luUGxhY2VIb2xkZXIgPSAodGhpcy5faXRlbS5oYXNPd25Qcm9wZXJ0eSgnYmVnaW5QbGFjZUhvbGRlcicpICYmIHRoaXMuX2l0ZW0uYmVnaW5QbGFjZUhvbGRlcikgPyB0aGlzLl9pdGVtLmJlZ2luUGxhY2VIb2xkZXIgOiB0aGlzLmxvY2FsZVNlcnZpY2UuZ2V0VmFsdWUoJ2ZpbHRlclBhbmVsLmJlZ2luUGxhY2VIb2xkZXInKTtcclxuICAgICAgICB0aGlzLmVuZFBsYWNlSG9sZGVyID0gKHRoaXMuX2l0ZW0uaGFzT3duUHJvcGVydHkoJ2VuZFBsYWNlSG9sZGVyJykgJiYgdGhpcy5faXRlbS5iZWdpblBsYWNlSG9sZGVyKSA/IHRoaXMuX2l0ZW0uZW5kUGxhY2VIb2xkZXIgOiB0aGlzLmxvY2FsZVNlcnZpY2UuZ2V0VmFsdWUoJ2ZpbHRlclBhbmVsLmVuZFBsYWNlSG9sZGVyJyk7XHJcbiAgICAgICAgdGhpcy5wbGFjZWhvbGRlciA9ICh0aGlzLl9pdGVtLmhhc093blByb3BlcnR5KCdwbGFjZUhvbGRlcicpICYmIHRoaXMuX2l0ZW0ucGxhY2VIb2xkZXIpID8gdGhpcy5faXRlbS5wbGFjZUhvbGRlciA6ICcnO1xyXG4gICAgICAgIHRoaXMuc2luZ2xlID0gdGhpcy5faXRlbS5jb250cm9sLnNpbmdsZTtcclxuICAgICAgICB0aGlzLl9pdGVtLnZhbHVlLnNpbmdsZSA9IHRoaXMuc2luZ2xlO1xyXG4gICAgICAgIHRoaXMuY29uc3RydWN0TXVsdGlGaWVsZE51bWJlclJhbmdlKG5yLnZhbHVlIGFzIEZsZXhpYmxlTnVtYmVyVmFsdWUpO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBpdGVtKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9pdGVtO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgc29sdXRpb25TZXJ2aWNlOiBTb2x1dGlvblNlcnZpY2UsIHByaXZhdGUgcmVhZG9ubHkgZWxlbWVudDogRWxlbWVudFJlZiwgcHJpdmF0ZSBsb2NhbGVTZXJ2aWNlOiBMb2NhbGVTZXJ2aWNlKSB7IH1cclxuXHJcbiAgICBuZ09uSW5pdCgpOiB2b2lkIHsgfVxyXG5cclxuICAgIG5nQWZ0ZXJWaWV3SW5pdCgpIHsgfVxyXG5cclxuICAgIGdldENvbmRpdGlvbkl0ZW1UaXRsZShmaWVsZDogUXVlcnlDb25kaXRpb24pIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5zb2x1dGlvblNlcnZpY2UuZ2V0Q29uZGl0aW9uSXRlbVRpdGxlKGZpZWxkKTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdHJ1Y3RNdWx0aUZpZWxkTnVtYmVyUmFuZ2UodmFsdWU6IEZsZXhpYmxlTnVtYmVyVmFsdWUpIHtcclxuICAgICAgICBpZiAodGhpcy5zaW5nbGUpIHtcclxuICAgICAgICAgICAgdGhpcy52YWx1ZSA9IHZhbHVlLnZhbHVlID09IG51bGwgPyBudWxsIDogdmFsdWUudmFsdWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLmJlZ2luVmFsdWUgPSB2YWx1ZS5zdGFydFZhbHVlID09IG51bGwgPyBudWxsIDogdmFsdWUuc3RhcnRWYWx1ZTtcclxuICAgICAgICAgICAgdGhpcy5lbmRWYWx1ZSA9IHZhbHVlLmVuZFZhbHVlID09IG51bGwgPyBudWxsIDogdmFsdWUuZW5kVmFsdWU7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIG51bWJlckNoYW5nZShldmVudCkge1xyXG4gICAgICAgIGlmIChldmVudCkge1xyXG4gICAgICAgICAgICB0aGlzLl9pdGVtLnZhbHVlLnZhbHVlID0gZXZlbnQ7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLl9pdGVtLnZhbHVlLnZhbHVlID0gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKE9iamVjdC5rZXlzKHRoaXMuX2l0ZW0udmFsdWUpLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICAgICAgICB0aGlzLl9pdGVtLnZhbHVlVGV4dCA9ICcnXHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLl9pdGVtLnZhbHVlVGV4dCA9ICcnICsgdGhpcy5faXRlbS52YWx1ZS52YWx1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYodGhpcy5kaXNhYmxlZCl7cmV0dXJuO31cclxuICAgICAgICB0aGlzLnNlYXJjaEhhbmRsZS5lbWl0KCk7XHJcbiAgICB9XHJcblxyXG4gICAgYmVnaW5WYWx1ZUNoYW5nZShldmVudCkge1xyXG4gICAgICAgIHRoaXMuX2l0ZW0udmFsdWUuc3RhcnRWYWx1ZSA9IGV2ZW50O1xyXG4gICAgICAgIHRoaXMuc2V0VmFsdWVUZXh0KCk7XHJcbiAgICAgICAgaWYodGhpcy5kaXNhYmxlZCl7cmV0dXJuO31cclxuICAgICAgICB0aGlzLnNlYXJjaEhhbmRsZS5lbWl0KCk7XHJcbiAgICB9XHJcblxyXG4gICAgZW5kVmFsdWVDaGFuZ2UoZXZlbnQpIHtcclxuICAgICAgICB0aGlzLl9pdGVtLnZhbHVlLmVuZFZhbHVlID0gZXZlbnQ7XHJcbiAgICAgICAgdGhpcy5zZXRWYWx1ZVRleHQoKTtcclxuICAgICAgICBpZih0aGlzLmRpc2FibGVkKXtyZXR1cm47fVxyXG4gICAgICAgIHRoaXMuc2VhcmNoSGFuZGxlLmVtaXQoKTtcclxuICAgIH1cclxuICAgIHNldFZhbHVlVGV4dCgpIHtcclxuICAgICAgICBpZiAoT2JqZWN0LmtleXModGhpcy5faXRlbS52YWx1ZSkubGVuZ3RoID09PSAwIHx8ICh0aGlzLl9pdGVtLnZhbHVlLnN0YXJ0VmFsdWUgPT0gbnVsbCAmJiB0aGlzLl9pdGVtLnZhbHVlLmVuZFZhbHVlID09IG51bGwpKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX2l0ZW0udmFsdWVUZXh0ID0gJydcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAodGhpcy5faXRlbS52YWx1ZS5zdGFydFZhbHVlID09IG51bGwpIHtcclxuICAgICAgICAgICAgdGhpcy5faXRlbS52YWx1ZVRleHQgPSAnficgKyB0aGlzLl9pdGVtLnZhbHVlLmVuZFZhbHVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmICh0aGlzLl9pdGVtLnZhbHVlLmVuZFZhbHVlID09IG51bGwpIHtcclxuICAgICAgICAgICAgdGhpcy5faXRlbS52YWx1ZVRleHQgPSB0aGlzLl9pdGVtLnZhbHVlLnN0YXJ0VmFsdWUgKyAnfic7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLl9pdGVtLnZhbHVlVGV4dCA9IHRoaXMuX2l0ZW0udmFsdWUuc3RhcnRWYWx1ZSArICd+JyArIHRoaXMuX2l0ZW0udmFsdWUuZW5kVmFsdWU7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59Il19
/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input, EventEmitter, Output } from '@angular/core';
import { cloneDeep } from 'lodash-es';
var PanelInputGroupComponent = /** @class */ (function () {
    function PanelInputGroupComponent() {
        this.searchHandle = new EventEmitter();
        this.submitChange = new EventEmitter();
        this.isTextFromDialog = false;
    }
    Object.defineProperty(PanelInputGroupComponent.prototype, "item", {
        get: /**
         * @return {?}
         */
        function () {
            return this.constructTextItem(this._item);
        },
        set: /**
         * @param {?} data
         * @return {?}
         */
        function (data) {
            this._item = data;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @param {?} textItem
     * @return {?}
     */
    PanelInputGroupComponent.prototype.constructTextItem = /**
     * @param {?} textItem
     * @return {?}
     */
    function (textItem) {
        if (!this._item.hasOwnProperty('value')) {
            this._item.value = {
                value: [],
                textValue: '',
                textField: '',
                isInputText: ''
            };
        }
        /** @type {?} */
        var textValueObj = textItem.value;
        textValueObj.textValue = textValueObj.textValue && textValueObj.textValue.trim();
        textItem.value = textValueObj;
        this.textValue = textValueObj.textValue;
        this.setSubmitChange();
        return textItem;
    };
    /**
     * @return {?}
     */
    PanelInputGroupComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        this.testId = this.getGuid();
        this.getInputGroupBindingInfo();
    };
    /**
     * @private
     * @return {?}
     */
    PanelInputGroupComponent.prototype.getGuid = /**
     * @private
     * @return {?}
     */
    function () {
        return (this.s4() + this.s4() + "-" + this.s4() + "-" + this.s4() + "-" + this.s4() + "-" + this.s4() + this.s4() + this.s4());
    };
    /**
     * @private
     * @return {?}
     */
    PanelInputGroupComponent.prototype.s4 = /**
     * @private
     * @return {?}
     */
    function () {
        return (((1 + Math.random()) * 0x10000) | 0).toString(16).substring(1);
    };
    /**
     * @return {?}
     */
    PanelInputGroupComponent.prototype.getInputGroupBindingInfo = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var inputGroupControl = (this.item.control);
        this.usageMode = inputGroupControl.usageMode;
        if (this.usageMode == 'open-modal' || this.usageMode == 'open-remote-modal') {
            this.dialogOptions = inputGroupControl.dialogOptions;
            if (this.dialogOptions.mapFields) {
                this.textField = JSON.stringify(this.dialogOptions.mapFields).split('"')[1];
            }
        }
    };
    /**
     * @param {?} event
     * @return {?}
     */
    PanelInputGroupComponent.prototype.onClick = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        var _this = this;
        if (this.usageMode == 'text') {
            this.item.control.click();
        }
        else {
            /** @type {?} */
            var options = this.dialogOptions;
            options.handle = (/**
             * @param {?} selectedItem
             * @return {?}
             */
            function (selectedItem) {
                // let modalData = item[0];
                // this.item.value.value = modalData[this.targetField];
                /** @type {?} */
                var selectedItems = selectedItem.filter((/**
                 * @param {?} n
                 * @return {?}
                 */
                function (n) { return n; }));
                if (selectedItems && _this.textField) {
                    _this.item.value.value = selectedItems;
                    //this.item.value.textValue = this.item.value.getTextValue(this.textField);
                    _this.item.value.textValue = _this.getTextValue(_this.textField, _this.item.value.value);
                    _this.item.value.textField = _this.textField;
                    _this.item.value.isInputText = false;
                    _this.item.textValue = _this.item.value.textValue;
                    _this.textValue = _this.item.textValue;
                    _this.isTextFromDialog = true;
                    _this.textFormDialog = _this.item.value.textValue;
                }
            });
            this.item.control.click({ event: event, options: options });
        }
    };
    /**
     * @param {?} targetField
     * @param {?} value
     * @return {?}
     */
    PanelInputGroupComponent.prototype.getTextValue = /**
     * @param {?} targetField
     * @param {?} value
     * @return {?}
     */
    function (targetField, value) {
        var _this = this;
        /** @type {?} */
        var args = targetField.split('.');
        /** @type {?} */
        var textArr = value.map((/**
         * @param {?} item
         * @return {?}
         */
        function (item) { return _this.getPropValue(item, cloneDeep(args)); }));
        return textArr && textArr.length ? textArr.join(',') : '';
    };
    /**
     * @param {?} item
     * @param {?} args
     * @return {?}
     */
    PanelInputGroupComponent.prototype.getPropValue = /**
     * @param {?} item
     * @param {?} args
     * @return {?}
     */
    function (item, args) {
        if (args.length > 1) {
            /** @type {?} */
            var arg = args.shift();
            if (arg) {
                return item[arg] ? this.getPropValue(item[arg], args) : '';
            }
            else {
                return '';
            }
        }
        return item[args[0]];
    };
    /**
     * @param {?} event
     * @return {?}
     */
    PanelInputGroupComponent.prototype.onBlur = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        if (this.usageMode == 'text') {
            this.item.value.isInputText = true;
        }
        if (this.usageMode == 'open-modal' || this.usageMode == 'open-remote-modal') {
            if (!this.isTextFromDialog) {
                this.item.value.isInputText = true;
            }
            if (this.item.value.textValue != this.textFormDialog) {
                this.isTextFromDialog = false;
                this.item.value.value = [];
                this.item.value.textField = undefined;
                this.item.value.isInputText = true;
            }
        }
        this.setSubmitChange();
        this.searchHandle.emit(event);
    };
    /**
     * @return {?}
     */
    PanelInputGroupComponent.prototype.setSubmitChange = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var val = this._item.value;
        if (Object.keys(val).length < 0 || !val.textValue) {
            this.submitChange.emit(false);
        }
        else {
            this.submitChange.emit(true);
        }
    };
    PanelInputGroupComponent.decorators = [
        { type: Component, args: [{
                    selector: 'panel-filter-inputgroup',
                    template: "\r\n<input-group \r\n    [(ngModel)]=\"item.value.textValue\" \r\n    name=\"{{item.fieldName}}\" \r\n    id=\"{{testId}}\"\r\n    [groupText]=\"item.control.groupText\"\r\n    [editable]=\"item.control.editable\"\r\n    [placeholder]=\"item.placeHolder\"\r\n    (clickHandle)=\"onClick($event)\"\r\n    (blurHandle)=\"onBlur($event)\"\r\n    (enterHandle)=\"onBlur($event)\"\r\n    >\r\n</input-group>\r\n"
                }] }
    ];
    /** @nocollapse */
    PanelInputGroupComponent.ctorParameters = function () { return []; };
    PanelInputGroupComponent.propDecorators = {
        item: [{ type: Input }],
        searchHandle: [{ type: Output }],
        submitChange: [{ type: Output }]
    };
    return PanelInputGroupComponent;
}());
export { PanelInputGroupComponent };
if (false) {
    /** @type {?} */
    PanelInputGroupComponent.prototype._item;
    /** @type {?} */
    PanelInputGroupComponent.prototype.testId;
    /** @type {?} */
    PanelInputGroupComponent.prototype.usageMode;
    /** @type {?} */
    PanelInputGroupComponent.prototype.dialogOptions;
    /** @type {?} */
    PanelInputGroupComponent.prototype.textValue;
    /** @type {?} */
    PanelInputGroupComponent.prototype.searchHandle;
    /** @type {?} */
    PanelInputGroupComponent.prototype.submitChange;
    /** @type {?} */
    PanelInputGroupComponent.prototype.textField;
    /** @type {?} */
    PanelInputGroupComponent.prototype.isTextFromDialog;
    /** @type {?} */
    PanelInputGroupComponent.prototype.textFormDialog;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5wdXRncm91cC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL3VpLWZpbHRlci1wYW5lbC8iLCJzb3VyY2VzIjpbImxpYi9jb21wb25lbnRzL2lucHV0Z3JvdXBjb21wb25lbnQvaW5wdXRncm91cC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsS0FBSyxFQUFxQixZQUFZLEVBQUUsTUFBTSxFQUFlLE1BQU0sZUFBZSxDQUFDO0FBQ3ZHLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxXQUFXLENBQUM7QUFHdEM7SUFnREk7UUF4QlUsaUJBQVksR0FBRyxJQUFJLFlBQVksRUFBRSxDQUFDO1FBQ2xDLGlCQUFZLEdBQUcsSUFBSSxZQUFZLEVBQUUsQ0FBQztRQUc1QyxxQkFBZ0IsR0FBRyxLQUFLLENBQUM7SUFvQlQsQ0FBQztJQWhDakIsc0JBQ0ksMENBQUk7Ozs7UUFHUjtZQUNJLE9BQU8sSUFBSSxDQUFDLGlCQUFpQixDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUM5QyxDQUFDOzs7OztRQU5ELFVBQ1MsSUFBUztZQUNkLElBQUksQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDO1FBQ3RCLENBQUM7OztPQUFBOzs7OztJQVlELG9EQUFpQjs7OztJQUFqQixVQUFrQixRQUFRO1FBQ3RCLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLGNBQWMsQ0FBQyxPQUFPLENBQUMsRUFBRTtZQUNyQyxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssR0FBRztnQkFDZixLQUFLLEVBQUUsRUFBRTtnQkFDVCxTQUFTLEVBQUUsRUFBRTtnQkFDYixTQUFTLEVBQUUsRUFBRTtnQkFDYixXQUFXLEVBQUUsRUFBRTthQUNsQixDQUFDO1NBQ0w7O1lBQ0ssWUFBWSxHQUFHLFFBQVEsQ0FBQyxLQUFLO1FBQ25DLFlBQVksQ0FBQyxTQUFTLEdBQUcsWUFBWSxDQUFDLFNBQVMs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Q0FBQztRQUN2QixJQUFJLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUNsQyxDQUFDOzs7O0lBRUQsa0RBQWU7OztJQUFmOztZQUNVLEdBQUcsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUs7UUFDNUIsSUFBSSxNQUFNLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLE1BQU0sR0FBRyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsU0FBUyxFQUFFO1lBQy9DLElBQUksQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1NBQ2pDO2FBQU07WUFDSCxJQUFJLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztTQUNoQztJQUNMLENBQUM7O2dCQS9JSixTQUFTLFNBQUM7b0JBQ1AsUUFBUSxFQUFFLHlCQUF5QjtvQkFDbkMsa2FBQTBDO2lCQUM3Qzs7Ozs7dUJBYUksS0FBSzsrQkFRTCxNQUFNOytCQUNOLE1BQU07O0lBdUhYLCtCQUFDO0NBQUEsQUFoSkQsSUFnSkM7U0EzSVksd0JBQXdCOzs7SUFDakMseUNBQVc7O0lBRVgsMENBQWU7O0lBRWYsNkNBQWtCOztJQUVsQixpREFBbUI7O0lBRW5CLDZDQUFlOztJQVVmLGdEQUE0Qzs7SUFDNUMsZ0RBQTRDOztJQUU1Qyw2Q0FBa0I7O0lBQ2xCLG9EQUF5Qjs7SUFDekIsa0RBQXVCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBJbnB1dCwgT25Jbml0LCBPbkNoYW5nZXMsIEV2ZW50RW1pdHRlciwgT3V0cHV0LCBIb3N0QmluZGluZyB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBjbG9uZURlZXAgfSBmcm9tICdsb2Rhc2gtZXMnO1xyXG5cclxuXHJcbkBDb21wb25lbnQoe1xyXG4gICAgc2VsZWN0b3I6ICdwYW5lbC1maWx0ZXItaW5wdXRncm91cCcsXHJcbiAgICB0ZW1wbGF0ZVVybDogJy4vaW5wdXRncm91cC5jb21wb25lbnQuaHRtbCcsXHJcbn0pXHJcblxyXG5leHBvcnQgY2xhc3MgUGFuZWxJbnB1dEdyb3VwQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcclxuICAgIF9pdGVtOiBhbnk7XHJcblxyXG4gICAgdGVzdElkOiBzdHJpbmc7XHJcblxyXG4gICAgdXNhZ2VNb2RlOiBzdHJpbmc7XHJcblxyXG4gICAgZGlhbG9nT3B0aW9uczogYW55O1xyXG5cclxuICAgIHRleHRWYWx1ZTogYW55O1xyXG5cclxuICAgIEBJbnB1dCgpXHJcbiAgICBzZXQgaXRlbShkYXRhOiBhbnkpIHtcclxuICAgICAgICB0aGlzLl9pdGVtID0gZGF0YTtcclxuICAgIH1cclxuICAgIGdldCBpdGVtKCk6IGFueSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY29uc3RydWN0VGV4dEl0ZW0odGhpcy5faXRlbSk7XHJcbiAgICB9XHJcblxyXG4gICAgQE91dHB1dCgpIHNlYXJjaEhhbmRsZSA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuICAgIEBPdXRwdXQoKSBzdWJtaXRDaGFuZ2UgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcblxyXG4gICAgdGV4dEZpZWxkOiBzdHJpbmc7XHJcbiAgICBpc1RleHRGcm9tRGlhbG9nID0gZmFsc2U7XHJcbiAgICB0ZXh0Rm9ybURpYWxvZzogc3RyaW5nO1xyXG5cclxuICAgIGNvbnN0cnVjdFRleHRJdGVtKHRleHRJdGVtKSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLl9pdGVtLmhhc093blByb3BlcnR5KCd2YWx1ZScpKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX2l0ZW0udmFsdWUgPSB7XHJcbiAgICAgICAgICAgICAgICB2YWx1ZTogW10sXHJcbiAgICAgICAgICAgICAgICB0ZXh0VmFsdWU6ICcnLFxyXG4gICAgICAgICAgICAgICAgdGV4dEZpZWxkOiAnJyxcclxuICAgICAgICAgICAgICAgIGlzSW5wdXRUZXh0OiAnJ1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCB0ZXh0VmFsdWVPYmogPSB0ZXh0SXRlbS52YWx1ZTtcclxuICAgICAgICB0ZXh0VmFsdWVPYmoudGV4dFZhbHVlID0gdGV4dFZhbHVlT2JqLnRleHRWYWx1ZSAmJiB0ZXh0VmFsdWVPYmoudGV4dFZhbHVlLnRyaW0oKTtcclxuICAgICAgICB0ZXh0SXRlbS52YWx1ZSA9IHRleHRWYWx1ZU9iajtcclxuICAgICAgICB0aGlzLnRleHRWYWx1ZT10ZXh0VmFsdWVPYmoudGV4dFZhbHVlO1xyXG4gICAgICAgIHRoaXMuc2V0U3VibWl0Q2hhbmdlKCk7XHJcbiAgICAgICAgcmV0dXJuIHRleHRJdGVtO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0cnVjdG9yKCkgeyB9XHJcblxyXG4gICAgbmdPbkluaXQoKTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy50ZXN0SWQgPSB0aGlzLmdldEd1aWQoKTtcclxuICAgICAgICB0aGlzLmdldElucHV0R3JvdXBCaW5kaW5nSW5mbygpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZ2V0R3VpZCgpIHtcclxuICAgICAgICByZXR1cm4gKHRoaXMuczQoKSArIHRoaXMuczQoKSArIFwiLVwiICsgdGhpcy5zNCgpICsgXCItXCIgKyB0aGlzLnM0KCkgKyBcIi1cIiArIHRoaXMuczQoKSArIFwiLVwiICsgdGhpcy5zNCgpICsgdGhpcy5zNCgpICsgdGhpcy5zNCgpKTtcclxuICAgIH1cclxuICAgIHByaXZhdGUgczQoKSB7XHJcbiAgICAgICAgcmV0dXJuICgoKDEgKyBNYXRoLnJhbmRvbSgpKSAqIDB4MTAwMDApIHwgMCkudG9TdHJpbmcoMTYpLnN1YnN0cmluZygxKTtcclxuICAgIH1cclxuXHJcbiAgICBnZXRJbnB1dEdyb3VwQmluZGluZ0luZm8oKSB7XHJcbiAgICAgICAgY29uc3QgaW5wdXRHcm91cENvbnRyb2wgPSAodGhpcy5pdGVtLmNvbnRyb2wpO1xyXG4gICAgICAgIHRoaXMudXNhZ2VNb2RlID0gaW5wdXRHcm91cENvbnRyb2wudXNhZ2VNb2RlO1xyXG4gICAgICAgIGlmICh0aGlzLnVzYWdlTW9kZSA9PSAnb3Blbi1tb2RhbCcgfHwgdGhpcy51c2FnZU1vZGUgPT0gJ29wZW4tcmVtb3RlLW1vZGFsJykge1xyXG4gICAgICAgICAgICB0aGlzLmRpYWxvZ09wdGlvbnMgPSBpbnB1dEdyb3VwQ29udHJvbC5kaWFsb2dPcHRpb25zO1xyXG4gICAgICAgICAgICBpZiAodGhpcy5kaWFsb2dPcHRpb25zLm1hcEZpZWxkcykge1xyXG4gICAgICAgICAgICAgICAgdGhpcy50ZXh0RmllbGQgPSBKU09OLnN0cmluZ2lmeSh0aGlzLmRpYWxvZ09wdGlvbnMubWFwRmllbGRzKS5zcGxpdCgnXCInKVsxXTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBvbkNsaWNrKGV2ZW50OiBhbnkpIHtcclxuICAgICAgICBpZiAodGhpcy51c2FnZU1vZGUgPT0gJ3RleHQnKSB7XHJcbiAgICAgICAgICAgIHRoaXMuaXRlbS5jb250cm9sLmNsaWNrKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBjb25zdCBvcHRpb25zID0gdGhpcy5kaWFsb2dPcHRpb25zO1xyXG4gICAgICAgICAgICBvcHRpb25zLmhhbmRsZSA9IChzZWxlY3RlZEl0ZW0pID0+IHtcclxuICAgICAgICAgICAgICAgIC8vIGxldCBtb2RhbERhdGEgPSBpdGVtWzBdO1xyXG4gICAgICAgICAgICAgICAgLy8gdGhpcy5pdGVtLnZhbHVlLnZhbHVlID0gbW9kYWxEYXRhW3RoaXMudGFyZ2V0RmllbGRdO1xyXG4gICAgICAgICAgICAgICAgbGV0IHNlbGVjdGVkSXRlbXMgPSBzZWxlY3RlZEl0ZW0uZmlsdGVyKG4gPT4gbik7XHJcbiAgICAgICAgICAgICAgICBpZiAoc2VsZWN0ZWRJdGVtcyAmJiB0aGlzLnRleHRGaWVsZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaXRlbS52YWx1ZS52YWx1ZSA9IHNlbGVjdGVkSXRlbXM7XHJcbiAgICAgICAgICAgICAgICAgICAgLy90aGlzLml0ZW0udmFsdWUudGV4dFZhbHVlID0gdGhpcy5pdGVtLnZhbHVlLmdldFRleHRWYWx1ZSh0aGlzLnRleHRGaWVsZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pdGVtLnZhbHVlLnRleHRWYWx1ZSA9IHRoaXMuZ2V0VGV4dFZhbHVlKHRoaXMudGV4dEZpZWxkLCB0aGlzLml0ZW0udmFsdWUudmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaXRlbS52YWx1ZS50ZXh0RmllbGQgPSB0aGlzLnRleHRGaWVsZDtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLml0ZW0udmFsdWUuaXNJbnB1dFRleHQgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLml0ZW0udGV4dFZhbHVlPXRoaXMuaXRlbS52YWx1ZS50ZXh0VmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy50ZXh0VmFsdWU9dGhpcy5pdGVtLnRleHRWYWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmlzVGV4dEZyb21EaWFsb2cgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMudGV4dEZvcm1EaWFsb2cgPSB0aGlzLml0ZW0udmFsdWUudGV4dFZhbHVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMuaXRlbS5jb250cm9sLmNsaWNrKHsgZXZlbnQsIG9wdGlvbnMgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGdldFRleHRWYWx1ZSh0YXJnZXRGaWVsZDogc3RyaW5nLCB2YWx1ZSk6IHN0cmluZyB7XHJcbiAgICAgICAgY29uc3QgYXJncyA9IHRhcmdldEZpZWxkLnNwbGl0KCcuJyk7XHJcbiAgICAgICAgY29uc3QgdGV4dEFyciA9IHZhbHVlLm1hcChpdGVtID0+IHRoaXMuZ2V0UHJvcFZhbHVlKGl0ZW0sIGNsb25lRGVlcChhcmdzKSkpO1xyXG4gICAgICAgIHJldHVybiB0ZXh0QXJyICYmIHRleHRBcnIubGVuZ3RoID8gdGV4dEFyci5qb2luKCcsJykgOiAnJztcclxuICAgIH1cclxuICAgIGdldFByb3BWYWx1ZShpdGVtOiBhbnksIGFyZ3M6IEFycmF5PHN0cmluZz4pOiBhbnkge1xyXG4gICAgICAgIGlmIChhcmdzLmxlbmd0aCA+IDEpIHtcclxuICAgICAgICAgICAgY29uc3QgYXJnID0gYXJncy5zaGlmdCgpO1xyXG4gICAgICAgICAgICBpZiAoYXJnKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gaXRlbVthcmddID8gdGhpcy5nZXRQcm9wVmFsdWUoaXRlbVthcmddLCBhcmdzKSA6ICcnO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuICcnO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBpdGVtW2FyZ3NbMF1dO1xyXG4gICAgfVxyXG5cclxuICAgIG9uQmx1cihldmVudCkge1xyXG4gICAgICAgIGlmICh0aGlzLnVzYWdlTW9kZSA9PSAndGV4dCcpIHtcclxuICAgICAgICAgICAgdGhpcy5pdGVtLnZhbHVlLmlzSW5wdXRUZXh0ID0gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHRoaXMudXNhZ2VNb2RlID09ICdvcGVuLW1vZGFsJyB8fCB0aGlzLnVzYWdlTW9kZSA9PSAnb3Blbi1yZW1vdGUtbW9kYWwnKSB7XHJcbiAgICAgICAgICAgIGlmICghdGhpcy5pc1RleHRGcm9tRGlhbG9nKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLml0ZW0udmFsdWUuaXNJbnB1dFRleHQgPSB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICh0aGlzLml0ZW0udmFsdWUudGV4dFZhbHVlICE9IHRoaXMudGV4dEZvcm1EaWFsb2cpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuaXNUZXh0RnJvbURpYWxvZyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5pdGVtLnZhbHVlLnZhbHVlID0gW107XHJcbiAgICAgICAgICAgICAgICB0aGlzLml0ZW0udmFsdWUudGV4dEZpZWxkID0gdW5kZWZpbmVkO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5pdGVtLnZhbHVlLmlzSW5wdXRUZXh0ID0gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLnNldFN1Ym1pdENoYW5nZSgpO1xyXG4gICAgICAgIHRoaXMuc2VhcmNoSGFuZGxlLmVtaXQoZXZlbnQpO1xyXG4gICAgfVxyXG5cclxuICAgIHNldFN1Ym1pdENoYW5nZSgpIHtcclxuICAgICAgICBjb25zdCB2YWwgPSB0aGlzLl9pdGVtLnZhbHVlO1xyXG4gICAgICAgIGlmIChPYmplY3Qua2V5cyh2YWwpLmxlbmd0aCA8IDAgfHwgIXZhbC50ZXh0VmFsdWUpIHtcclxuICAgICAgICAgICAgdGhpcy5zdWJtaXRDaGFuZ2UuZW1pdChmYWxzZSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5zdWJtaXRDaGFuZ2UuZW1pdCh0cnVlKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuIl19
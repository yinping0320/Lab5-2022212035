/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input, EventEmitter, Output, ViewChild } from '@angular/core';
import { FarrisDatepickerComponent } from '@farris/ui-datepicker';
import { LocaleService } from '@farris/ui-locale';
import { getLastNumMonth, getToday } from '../daterangecomponent/utils';
var PanelFlexibleDateComponent = /** @class */ (function () {
    function PanelFlexibleDateComponent(localeService) {
        this.localeService = localeService;
        this.itemChange = new EventEmitter();
        this.searchHandle = new EventEmitter();
        this.submitChange = new EventEmitter();
        this.canNull = true;
        this.date = new Date();
        this.dateTags = [];
        this.dayTags = [];
    }
    Object.defineProperty(PanelFlexibleDateComponent.prototype, "item", {
        get: /**
         * @return {?}
         */
        function () {
            return this._item;
        },
        set: /**
         * @param {?} nr
         * @return {?}
         */
        function (nr) {
            this._item = nr;
            if (this._item) {
                if (!this._item.hasOwnProperty('value')) {
                    this._item.value = {
                        startValue: null,
                        endValue: null,
                        value: null,
                        single: true
                    };
                }
                if (!this._item.control.hasOwnProperty('single')) {
                    this._item.control.single = true;
                }
                this.beginPlaceHolder = (this._item.hasOwnProperty('beginPlaceHolder') && this._item.beginPlaceHolder) ? this._item.beginPlaceHolder : this.localeService.getValue('filterPanel.dateBeginPlaceHolder');
                this.endPlaceHolder = (this._item.hasOwnProperty('endPlaceHolder') && this._item.beginPlaceHolder) ? this._item.endPlaceHolder : this.localeService.getValue('filterPanel.dateEndPlaceHolder');
                this.placeholder = (this._item.hasOwnProperty('placeHolder') && this._item.placeHolder) ? this._item.placeHolder : '';
                this.single = this._item.control.single;
                this.showTime = (this._item.control.hasOwnProperty('showTime') && this._item.control.showTime) ? this._item.control.showTime : '';
                this.showType = (this._item.control.hasOwnProperty('showType') && this._item.control.showType) ? this._item.control.showType : '';
                /** @type {?} */
                var itemDateFormat = this._item.control.format;
                if (this.showTime && itemDateFormat) {
                    if (itemDateFormat.length > 0 && itemDateFormat.indexOf('HH:mm') == -1) {
                        itemDateFormat = itemDateFormat + ' HH:mm:ss';
                    }
                }
                /** @type {?} */
                var format = this.showTime ? 'yyyy-MM-dd HH:mm:ss' : (this.showType == '2' ? 'yyyy-MM' : (this.showType == '3' ? 'yyyy' : 'yyyy-MM-dd'));
                this.dateFormat = itemDateFormat ? itemDateFormat : format;
            }
            this.activedDateTagId = '';
            this.activedDayTagId = '';
            this.constructMultiFieldDateRange(nr.value);
            this.dateSubmitChange();
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    PanelFlexibleDateComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        this.dateTags = [
            {
                id: 'tag1',
                text: this.localeService.getValue('filterPanel.last1Month')
            },
            {
                id: 'tag2',
                text: this.localeService.getValue('filterPanel.last3Month')
            },
            {
                id: 'tag3',
                text: this.localeService.getValue('filterPanel.last6Month')
            }
        ];
        this.dayTags = [
            {
                id: 'yesterday',
                text: this.localeService.getValue('filterPanel.yesterday')
            },
            {
                id: 'today',
                text: this.localeService.getValue('filterPanel.today')
            }
        ];
    };
    /**
     * @param {?} value
     * @return {?}
     */
    PanelFlexibleDateComponent.prototype.constructMultiFieldDateRange = /**
     * @param {?} value
     * @return {?}
     */
    function (value) {
        if (this.single) {
            this.value = value.value == null ? null : value.value;
        }
        else {
            this.startValue = value.startValue == null ? null : value.startValue;
            this.endValue = value.endValue == null ? null : value.endValue;
        }
    };
    /**
     * @param {?} event
     * @return {?}
     */
    PanelFlexibleDateComponent.prototype.onDateChange = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        this._item.value.value = event.returnFormatted ? event.returnFormatted : null;
        this._item.valueText = event.formatted;
        this.activedDateTagId = '';
        this.activedDayTagId = '';
        this.searchHandle.emit(event);
        this.dateSubmitChange();
    };
    /**
     * @param {?} event
     * @return {?}
     */
    PanelFlexibleDateComponent.prototype.beginValueChange = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        this._item.value.startValue = event.returnFormatted ? event.returnFormatted : null;
        this._item.value.startValueText = event.formatted;
        this.activedDateTagId = '';
        this.activedDayTagId = '';
        this.setValueText();
        this.dateSubmitChange();
    };
    /**
     * @param {?} event
     * @return {?}
     */
    PanelFlexibleDateComponent.prototype.endValueChange = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        this._item.value.endValue = event.returnFormatted ? event.returnFormatted : null;
        this._item.value.endValueText = event.formatted;
        this.activedDateTagId = '';
        this.activedDayTagId = '';
        this.setValueText();
        this.dateSubmitChange();
    };
    /**
     * @return {?}
     */
    PanelFlexibleDateComponent.prototype.setValueText = /**
     * @return {?}
     */
    function () {
        if (Object.keys(this._item.value).length === 0 || (!this._item.value.startValue && !this._item.value.endValue)) {
            this._item.valueText = '';
        }
        else if (!this._item.value.startValueText) {
            this._item.valueText = '~' + this._item.value.endValueText;
        }
        else if (!this._item.value.endValueText) {
            this._item.valueText = this._item.value.startValueText + '~';
        }
        else {
            this._item.valueText = this._item.value.startValueText + '~' + this._item.value.endValueText;
        }
    };
    /**
     * @return {?}
     */
    PanelFlexibleDateComponent.prototype.dateSubmitChange = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var val = this._item.value;
        if (this.single) {
            if (Object.keys(val).length < 0 || !val.value) {
                this.submitChange.emit(false);
            }
            else {
                this.submitChange.emit(true);
            }
        }
        else {
            if (Object.keys(val).length === 0 || (!val.startValue && !val.endValue)) {
                this.submitChange.emit(false);
            }
            else {
                this.submitChange.emit(true);
            }
        }
    };
    /**
     * @param {?} event
     * @return {?}
     */
    PanelFlexibleDateComponent.prototype.onChange = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        this.single = !event;
        this._item.control.single = this.single;
        this._item.value.single = this.single;
        this.itemChange.emit(this.item);
        this.dateSubmitChange();
    };
    /**
     * @param {?} tag
     * @return {?}
     */
    PanelFlexibleDateComponent.prototype.clickTag = /**
     * @param {?} tag
     * @return {?}
     */
    function (tag) {
        this.activedDateTagId = tag.id;
        /** @type {?} */
        var tagDate;
        if (tag.id == 'tag1') {
            tagDate = getLastNumMonth(1, this.showTime, this.showType);
        }
        else if (tag.id == 'tag2') {
            tagDate = getLastNumMonth(3, this.showTime, this.showType);
        }
        else if (tag.id == 'tag3') {
            tagDate = getLastNumMonth(6, this.showTime, this.showType);
        }
        this._item.value.startValue = tagDate['startTime'];
        this._item.value.endValue = tagDate['endTime'];
        this._item.value.startValueText = this.datepickerEle.dateTo(new Date(this._item.value.startValue));
        this._item.value.endValueText = this.datepickerEle.dateTo(new Date(this._item.value.endValue));
        this.startValue = this._item.value.startValue;
        this.endValue = this._item.value.endValue;
        this.setValueText();
        this.dateSubmitChange();
    };
    /**
     * @param {?} tag
     * @return {?}
     */
    PanelFlexibleDateComponent.prototype.clickDayTag = /**
     * @param {?} tag
     * @return {?}
     */
    function (tag) {
        this.activedDayTagId = tag.id;
        /** @type {?} */
        var dayTag = getToday(this.activedDayTagId, this.showTime);
        this._item.value.value = dayTag;
        this.value = this._item.value.value;
        this._item.valueText = this.datepickerEle.dateTo(new Date(this._item.value.value));
        this.dateSubmitChange();
    };
    PanelFlexibleDateComponent.decorators = [
        { type: Component, args: [{
                    selector: 'panel-filter-flexibledate',
                    template: "<div class=\"f-panel-filter-tip\">\r\n    <span class=\"panel-filter-tip-text\">{{ 'filterPanel.intervalFilter' | locale }}</span>\r\n    <farris-switch size=\"small\" [checked]=\"!single\" (valueChange)=\"onChange($event)\"></farris-switch>\r\n</div>\r\n<div class=\"f-panel-filter-content\">\r\n    <ng-container *ngIf=\"single; else elseTemplate\">\r\n        <ng-container *ngIf=\"showTime;else singleDefaultdate\">\r\n            <farris-datepicker [(ngModel)]=\"value\" [editable]=\"false\" [returnFormat]=\"'yyyy-MM-dd HH:mm:ss'\" [dateFormat]=\"dateFormat\" (valueChange)=\"onDateChange($event)\" [placeholder]=\"placeholder\" [showTime]=\"showTime\" #datepicker></farris-datepicker>\r\n        </ng-container>\r\n        <ng-template #singleDefaultdate>\r\n            <farris-datepicker [(ngModel)]=\"value\" [editable]=\"false\" [returnFormat]=\"showType == '2'? 'yyyy-MM': (showType == '3'? 'yyyy':'yyyy-MM-dd')\" [dateFormat]=\"dateFormat\" (valueChange)=\"onDateChange($event)\" [placeholder]=\"placeholder\" [showType]=\"showType\" #datepicker></farris-datepicker>\r\n        </ng-template>\r\n    </ng-container>\r\n    <ng-template #elseTemplate>\r\n        <div class=\"d-flex panel-flexible-range-wrapper\">\r\n            <ng-container *ngIf=\"showTime;else startDefaultdate\">\r\n                <farris-datepicker [(ngModel)]=\"startValue\" [editable]=\"false\" [returnFormat]=\"'yyyy-MM-dd HH:mm:ss'\" [dateFormat]=\"dateFormat\" (valueChange)=\"beginValueChange($event)\" [placeholder]=\"beginPlaceHolder\" [showTime]=\"showTime\" [maxDate]=\"endValue\" #datepicker></farris-datepicker>\r\n            </ng-container>\r\n            <ng-template #startDefaultdate>\r\n                <farris-datepicker [(ngModel)]=\"startValue\" [editable]=\"false\" [returnFormat]=\"showType == '2'? 'yyyy-MM': (showType == '3'? 'yyyy':'yyyy-MM-dd')\" [dateFormat]=\"dateFormat\" (valueChange)=\"beginValueChange($event)\" [placeholder]=\"beginPlaceHolder\" [showType]=\"showType\" [maxDate]=\"endValue\" #datepicker></farris-datepicker>\r\n            </ng-template>\r\n            <span class=\"f-icon f-icon-orientation-arrow\"></span>\r\n            <ng-container *ngIf=\"showTime;else endDefaultdate\">\r\n                <farris-datepicker [(ngModel)]=\"endValue\" [editable]=\"false\" [returnFormat]=\"'yyyy-MM-dd HH:mm:ss'\" [dateFormat]=\"dateFormat\" (valueChange)=\"endValueChange($event)\" [placeholder]=\"endPlaceHolder\" [showTime]=\"showTime\" [minDate]=\"startValue\" #datepicker></farris-datepicker>\r\n            </ng-container>\r\n            <ng-template #endDefaultdate>\r\n                <farris-datepicker [(ngModel)]=\"endValue\" [editable]=\"false\" [returnFormat]=\"showType == '2'? 'yyyy-MM': (showType == '3'? 'yyyy':'yyyy-MM-dd')\" [dateFormat]=\"dateFormat\" (valueChange)=\"endValueChange($event)\" [placeholder]=\"endPlaceHolder\" [showType]=\"showType\" [minDate]=\"startValue\" #datepicker></farris-datepicker>\r\n            </ng-template>\r\n        </div>\r\n    </ng-template>\r\n\r\n</div>\r\n<div class=\"f-filter-panel-date-tags\" *ngIf=\"!single && showType !== '3'\">\r\n    <div class=\"panel-date-tag\" \r\n    *ngFor=\"let tag of dateTags\" \r\n    (click)=\"clickTag(tag)\"\r\n    [ngClass]=\"{'active': tag.id == activedDateTagId}\"\r\n    >\r\n        {{tag.text}}\r\n    </div>\r\n</div>\r\n\r\n<div class=\"f-filter-panel-date-tags\" *ngIf=\"single && showType !== '3' && showType !== '2'\">\r\n    <div class=\"panel-date-tag\" \r\n    *ngFor=\"let day of dayTags\" \r\n    (click)=\"clickDayTag(day)\"\r\n    [ngClass]=\"{'active': day.id == activedDayTagId}\"\r\n    >\r\n        {{day.text}}\r\n    </div>\r\n</div>"
                }] }
    ];
    /** @nocollapse */
    PanelFlexibleDateComponent.ctorParameters = function () { return [
        { type: LocaleService }
    ]; };
    PanelFlexibleDateComponent.propDecorators = {
        itemChange: [{ type: Output }],
        searchHandle: [{ type: Output, args: ['searchHandle',] }],
        submitChange: [{ type: Output, args: ['submitChange',] }],
        datepickerEle: [{ type: ViewChild, args: ['datepicker',] }],
        item: [{ type: Input }]
    };
    return PanelFlexibleDateComponent;
}());
export { PanelFlexibleDateComponent };
if (false) {
    /** @type {?} */
    PanelFlexibleDateComponent.prototype.itemChange;
    /** @type {?} */
    PanelFlexibleDateComponent.prototype.searchHandle;
    /** @type {?} */
    PanelFlexibleDateComponent.prototype.submitChange;
    /** @type {?} */
    PanelFlexibleDateComponent.prototype.datepickerEle;
    /** @type {?} */
    PanelFlexibleDateComponent.prototype.canNull;
    /** @type {?} */
    PanelFlexibleDateComponent.prototype.placeholder;
    /** @type {?} */
    PanelFlexibleDateComponent.prototype.beginPlaceHolder;
    /** @type {?} */
    PanelFlexibleDateComponent.prototype.endPlaceHolder;
    /** @type {?} */
    PanelFlexibleDateComponent.prototype.single;
    /** @type {?} */
    PanelFlexibleDateComponent.prototype.showTime;
    /** @type {?} */
    PanelFlexibleDateComponent.prototype.showType;
    /** @type {?} */
    PanelFlexibleDateComponent.prototype.dateFormat;
    /** @type {?} */
    PanelFlexibleDateComponent.prototype.value;
    /** @type {?} */
    PanelFlexibleDateComponent.prototype.startValue;
    /** @type {?} */
    PanelFlexibleDateComponent.prototype.endValue;
    /** @type {?} */
    PanelFlexibleDateComponent.prototype.date;
    /** @type {?} */
    PanelFlexibleDateComponent.prototype.dateTags;
    /** @type {?} */
    PanelFlexibleDateComponent.prototype.dayTags;
    /** @type {?} */
    PanelFlexibleDateComponent.prototype.activedDateTagId;
    /** @type {?} */
    PanelFlexibleDateComponent.prototype.activedDayTagId;
    /** @type {?} */
    PanelFlexibleDateComponent.prototype._item;
    /**
     * @type {?}
     * @private
     */
    PanelFlexibleDateComponent.prototype.localeService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmxleGlibGVkYXRlLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvdWktZmlsdGVyLXBhbmVsLyIsInNvdXJjZXMiOlsibGliL2NvbXBvbmVudHMvZmxleGlibGVkYXRlY29tcG9uZW50L2ZsZXhpYmxlZGF0ZS5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsS0FBSyxFQUFVLFlBQVksRUFBRSxNQUFNLEVBQUUsU0FBUyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzFGLE9BQU8sRUFBRSx5QkFBeUIsRUFBRSxNQUFNLHVCQUF1QixDQUFDO0FBQ2xFLE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUNsRCxPQUFPLEVBQUUsZUFBZSxFQUFFLFFBQVEsRUFBRSxNQUFNLDZCQUE2QixDQUFDO0FBRXhFO0lBbUVJLG9DQUFvQixhQUE0QjtRQUE1QixrQkFBYSxHQUFiLGFBQWEsQ0FBZTtRQTdEdEMsZUFBVSxHQUFHLElBQUksWUFBWSxFQUFFLENBQUM7UUFDbEIsaUJBQVksR0FBRyxJQUFJLFlBQVksRUFBRSxDQUFDO1FBQ2xDLGlCQUFZLEdBQUcsSUFBSSxZQUFZLEVBQUUsQ0FBQztRQUUxRCxZQUFPLEdBQVksSUFBSSxDQUFDO1FBWXhCLFNBQUksR0FBRyxJQUFJLElBQUksRUFBRSxDQUFDO1FBQ2xCLGFBQVEsR0FBRyxFQUFFLENBQUM7UUFDZCxZQUFPLEdBQUcsRUFBRSxDQUFDO0lBMkN1QyxDQUFDO0lBdENyRCxzQkFDSSw0Q0FBSTs7OztRQWtDUjtZQUNJLE9BQU8sSUFBSSxDQUFDLEtBQUssQ0FBQztRQUN0QixDQUFDOzs7OztRQXJDRCxVQUNTLEVBQU87WUFDWixJQUFJLENBQUMsS0FBSyxHQUFHLEVBQUUsQ0FBQztZQUNoQixJQUFJLElBQUksQ0FBQyxLQUFLLEVBQUU7Z0JBQ1osSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsY0FB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LEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO1FBQ25GLElBQUksQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDO0lBQzVCLENBQUM7O2dCQTdNSixTQUFTLFNBQUM7b0JBQ1AsUUFBUSxFQUFFLDJCQUEyQjtvQkFDckMsNm1IQUE0QztpQkFDL0M7Ozs7Z0JBTlEsYUFBYTs7OzZCQVNqQixNQUFNOytCQUNOLE1BQU0sU0FBQyxjQUFjOytCQUNyQixNQUFNLFNBQUMsY0FBYztnQ0FDckIsU0FBUyxTQUFDLFlBQVk7dUJBb0J0QixLQUFLOztJQWlMVixpQ0FBQztDQUFBLEFBOU1ELElBOE1DO1NBek1ZLDBCQUEwQjs7O0lBQ25DLGdEQUEwQzs7SUFDMUMsa0RBQTBEOztJQUMxRCxrREFBMEQ7O0lBQzFELG1EQUFrRTs7SUFDbEUsNkNBQXdCOztJQUV4QixpREFBb0I7O0lBQ3BCLHNEQUF5Qjs7SUFDekIsb0RBQXVCOztJQUN2Qiw0Q0FBZ0I7O0lBQ2hCLDhDQUFrQjs7SUFDbEIsOENBQWlCOztJQUNqQixnREFBbUI7O0lBQ25CLDJDQUFZOztJQUNaLGdEQUFpQjs7SUFDakIsOENBQWU7O0lBQ2YsMENBQWtCOztJQUNsQiw4Q0FBYzs7SUFDZCw2Q0FBYTs7SUFDYixzREFBaUI7O0lBQ2pCLHFEQUFnQjs7SUFFaEIsMkNBQVc7Ozs7O0lBdUNDLG1EQUFvQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgSW5wdXQsIE9uSW5pdCwgRXZlbnRFbWl0dGVyLCBPdXRwdXQsIFZpZXdDaGlsZCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBGYXJyaXNEYXRlcGlja2VyQ29tcG9uZW50IH0gZnJvbSAnQGZhcnJpcy91aS1kYXRlcGlja2VyJztcclxuaW1wb3J0IHsgTG9jYWxlU2VydmljZSB9IGZyb20gJ0BmYXJyaXMvdWktbG9jYWxlJztcclxuaW1wb3J0IHsgZ2V0TGFzdE51bU1vbnRoLCBnZXRUb2RheSB9IGZyb20gJy4uL2RhdGVyYW5nZWNvbXBvbmVudC91dGlscyc7XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICAgIHNlbGVjdG9yOiAncGFuZWwtZmlsdGVyLWZsZXhpYmxlZGF0ZScsXHJcbiAgICB0ZW1wbGF0ZVVybDogJy4vZmxleGlibGVkYXRlLmNvbXBvbmVudC5odG1sJ1xyXG59KVxyXG5cclxuZXhwb3J0IGNsYXNzIFBhbmVsRmxleGlibGVEYXRlQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcclxuICAgIEBPdXRwdXQoKSBpdGVtQ2hhbmdlID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG4gICAgQE91dHB1dCgnc2VhcmNoSGFuZGxlJykgc2VhcmNoSGFuZGxlID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG4gICAgQE91dHB1dCgnc3VibWl0Q2hhbmdlJykgc3VibWl0Q2hhbmdlID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG4gICAgQFZpZXdDaGlsZCgnZGF0ZXBpY2tlcicpIGRhdGVwaWNrZXJFbGU6IEZhcnJpc0RhdGVwaWNrZXJDb21wb25lbnQ7XHJcbiAgICBjYW5OdWxsOiBib29sZWFuID0gdHJ1ZTtcclxuXHJcbiAgICBwbGFjZWhvbGRlcjogc3RyaW5nO1xyXG4gICAgYmVnaW5QbGFjZUhvbGRlcjogc3RyaW5nO1xyXG4gICAgZW5kUGxhY2VIb2xkZXI6IHN0cmluZztcclxuICAgIHNpbmdsZTogYm9vbGVhbjsvL+aYr+WQpuS4uuWNleaXpeacn1xyXG4gICAgc2hvd1RpbWU6IGJvb2xlYW47Ly/mmK/lkKbmmL7npLrml7bpl7RcclxuICAgIHNob3dUeXBlOiBzdHJpbmc7Ly/mmL7npLrnsbvlnotcclxuICAgIGRhdGVGb3JtYXQ6IHN0cmluZzsvL+agvOW8j1xyXG4gICAgdmFsdWU6IERhdGU7XHJcbiAgICBzdGFydFZhbHVlOiBEYXRlO1xyXG4gICAgZW5kVmFsdWU6IERhdGU7XHJcbiAgICBkYXRlID0gbmV3IERhdGUoKTtcclxuICAgIGRhdGVUYWdzID0gW107XHJcbiAgICBkYXlUYWdzID0gW107XHJcbiAgICBhY3RpdmVkRGF0ZVRhZ0lkO1xyXG4gICAgYWN0aXZlZERheVRhZ0lkO1xyXG5cclxuICAgIF9pdGVtOiBhbnk7XHJcbiAgICBASW5wdXQoKVxyXG4gICAgc2V0IGl0ZW0obnI6IGFueSkge1xyXG4gICAgICAgIHRoaXMuX2l0ZW0gPSBucjtcclxuICAgICAgICBpZiAodGhpcy5faXRlbSkge1xyXG4gICAgICAgICAgICBpZiAoIXRoaXMuX2l0ZW0uaGFzT3duUHJvcGVydHkoJ3ZhbHVlJykpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuX2l0ZW0udmFsdWUgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc3RhcnRWYWx1ZTogbnVsbCxcclxuICAgICAgICAgICAgICAgICAgICBlbmRWYWx1ZTogbnVsbCxcclxuICAgICAgICAgICAgICAgICAgICB2YWx1ZTogbnVsbCxcclxuICAgICAgICAgICAgICAgICAgICBzaW5nbGU6IHRydWVcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoIXRoaXMuX2l0ZW0uY29udHJvbC5oYXNPd25Qcm9wZXJ0eSgnc2luZ2xlJykpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuX2l0ZW0uY29udHJvbC5zaW5nbGUgPSB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMuYmVnaW5QbGFjZUhvbGRlciA9ICh0aGlzLl9pdGVtLmhhc093blByb3BlcnR5KCdiZWdpblBsYWNlSG9sZGVyJykgJiYgdGhpcy5faXRlbS5iZWdpblBsYWNlSG9sZGVyKSA/IHRoaXMuX2l0ZW0uYmVnaW5QbGFjZUhvbGRlciA6IHRoaXMubG9jYWxlU2VydmljZS5nZXRWYWx1ZSgnZmlsdGVyUGFuZWwuZGF0ZUJlZ2luUGxhY2VIb2xkZXInKTtcclxuICAgICAgICAgICAgdGhpcy5lbmRQbGFjZUhvbGRlciA9ICh0aGlzLl9pdGVtLmhhc093blByb3BlcnR5KCdlbmRQbGFjZUhvbGRlcicpICYmIHRoaXMuX2l0ZW0uYmVnaW5QbGFjZUhvbGRlcikgPyB0aGlzLl9pdGVtLmVuZFBsYWNlSG9sZGVyIDogdGhpcy5sb2NhbGVTZXJ2aWNlLmdldFZhbHVlKCdmaWx0ZXJQYW5lbC5kYXRlRW5kUGxhY2VIb2xkZXInKTtcclxuICAgICAgICAgICAgdGhpcy5wbGFjZWhvbGRlciA9ICh0aGlzLl9pdGVtLmhhc093blByb3BlcnR5KCdwbGFjZUhvbGRlcicpICYmIHRoaXMuX2l0ZW0ucGxhY2VIb2xkZXIpID8gdGhpcy5faXRlbS5wbGFjZUhvbGRlciA6ICcnO1xyXG4gICAgICAgICAgICB0aGlzLnNpbmdsZSA9IHRoaXMuX2l0ZW0uY29udHJvbC5zaW5nbGU7XHJcbiAgICAgICAgICAgIHRoaXMuc2hvd1RpbWUgPSAodGhpcy5faXRlbS5jb250cm9sLmhhc093blByb3BlcnR5KCdzaG93VGltZScpICYmIHRoaXMuX2l0ZW0uY29udHJvbC5zaG93VGltZSkgPyB0aGlzLl9pdGVtLmNvbnRyb2wuc2hvd1RpbWUgOiAnJztcclxuICAgICAgICAgICAgdGhpcy5zaG93VHlwZSA9ICh0aGlzLl9pdGVtLmNvbnRyb2wuaGFzT3duUHJvcGVydHkoJ3Nob3dUeXBlJykgJiYgdGhpcy5faXRlbS5jb250cm9sLnNob3dUeXBlKSA/IHRoaXMuX2l0ZW0uY29udHJvbC5zaG93VHlwZSA6ICcnO1xyXG4gICAgICAgICAgICBsZXQgaXRlbURhdGVGb3JtYXQgPSB0aGlzLl9pdGVtLmNvbnRyb2wuZm9ybWF0O1xyXG4gICAgICAgICAgICBpZiAodGhpcy5zaG93VGltZSAmJiBpdGVtRGF0ZUZvcm1hdCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKGl0ZW1EYXRlRm9ybWF0Lmxlbmd0aCA+IDAgJiYgaXRlbURhdGVGb3JtYXQuaW5kZXhPZignSEg6bW0nKSA9PSAtMSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGl0ZW1EYXRlRm9ybWF0ID0gaXRlbURhdGVGb3JtYXQgKyAnIEhIOm1tOnNzJztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjb25zdCBmb3JtYXQgPSB0aGlzLnNob3dUaW1lID8gJ3l5eXktTU0tZGQgSEg6bW06c3MnIDogKHRoaXMuc2hvd1R5cGUgPT0gJzInID8gJ3l5eXktTU0nIDogKHRoaXMuc2hvd1R5cGUgPT0gJzMnID8gJ3l5eXknIDogJ3l5eXktTU0tZGQnKSk7XHJcbiAgICAgICAgICAgIHRoaXMuZGF0ZUZvcm1hdCA9IGl0ZW1EYXRlRm9ybWF0ID8gaXRlbURhdGVGb3JtYXQgOiBmb3JtYXQ7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuYWN0aXZlZERhdGVUYWdJZCA9ICcnO1xyXG4gICAgICAgIHRoaXMuYWN0aXZlZERheVRhZ0lkID0gJyc7XHJcbiAgICAgICAgdGhpcy5jb25zdHJ1Y3RNdWx0aUZpZWxkRGF0ZVJhbmdlKG5yLnZhbHVlKTtcclxuICAgICAgICB0aGlzLmRhdGVTdWJtaXRDaGFuZ2UoKTtcclxuICAgIH1cclxuICAgIGdldCBpdGVtKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9pdGVtO1xyXG4gICAgfVxyXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBsb2NhbGVTZXJ2aWNlOiBMb2NhbGVTZXJ2aWNlKSB7IH1cclxuXHJcbiAgICBuZ09uSW5pdCgpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLmRhdGVUYWdzID0gW1xyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpZDogJ3RhZzEnLFxyXG4gICAgICAgICAgICAgICAgdGV4dDogdGhpcy5sb2NhbGVTZXJ2aWNlLmdldFZhbHVlKCdmaWx0ZXJQYW5lbC5sYXN0MU1vbnRoJylcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaWQ6ICd0YWcyJyxcclxuICAgICAgICAgICAgICAgIHRleHQ6IHRoaXMubG9jYWxlU2VydmljZS5nZXRWYWx1ZSgnZmlsdGVyUGFuZWwubGFzdDNNb250aCcpXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGlkOiAndGFnMycsXHJcbiAgICAgICAgICAgICAgICB0ZXh0OiB0aGlzLmxvY2FsZVNlcnZpY2UuZ2V0VmFsdWUoJ2ZpbHRlclBhbmVsLmxhc3Q2TW9udGgnKVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgXTtcclxuICAgICAgICB0aGlzLmRheVRhZ3MgPSBbXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGlkOiAneWVzdGVyZGF5JyxcclxuICAgICAgICAgICAgICAgIHRleHQ6IHRoaXMubG9jYWxlU2VydmljZS5nZXRWYWx1ZSgnZmlsdGVyUGFuZWwueWVzdGVyZGF5JylcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaWQ6ICd0b2RheScsXHJcbiAgICAgICAgICAgICAgICB0ZXh0OiB0aGlzLmxvY2FsZVNlcnZpY2UuZ2V0VmFsdWUoJ2ZpbHRlclBhbmVsLnRvZGF5JylcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIF07XHJcbiAgICB9XHJcbiAgICBjb25zdHJ1Y3RNdWx0aUZpZWxkRGF0ZVJhbmdlKHZhbHVlKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuc2luZ2xlKSB7XHJcbiAgICAgICAgICAgIHRoaXMudmFsdWUgPSB2YWx1ZS52YWx1ZSA9PSBudWxsID8gbnVsbCA6IHZhbHVlLnZhbHVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5zdGFydFZhbHVlID0gdmFsdWUuc3RhcnRWYWx1ZSA9PSBudWxsID8gbnVsbCA6IHZhbHVlLnN0YXJ0VmFsdWU7XHJcbiAgICAgICAgICAgIHRoaXMuZW5kVmFsdWUgPSB2YWx1ZS5lbmRWYWx1ZSA9PSBudWxsID8gbnVsbCA6IHZhbHVlLmVuZFZhbHVlO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBvbkRhdGVDaGFuZ2UoZXZlbnQ6IGFueSkge1xyXG4gICAgICAgIHRoaXMuX2l0ZW0udmFsdWUudmFsdWUgPSBldmVudC5yZXR1cm5Gb3JtYXR0ZWQgPyBldmVudC5yZXR1cm5Gb3JtYXR0ZWQgOiBudWxsO1xyXG4gICAgICAgIHRoaXMuX2l0ZW0udmFsdWVUZXh0ID0gZXZlbnQuZm9ybWF0dGVkO1xyXG4gICAgICAgIHRoaXMuYWN0aXZlZERhdGVUYWdJZCA9ICcnO1xyXG4gICAgICAgIHRoaXMuYWN0aXZlZERheVRhZ0lkID0gJyc7XHJcbiAgICAgICAgdGhpcy5zZWFyY2hIYW5kbGUuZW1pdChldmVudCk7XHJcbiAgICAgICAgdGhpcy5kYXRlU3VibWl0Q2hhbmdlKCk7XHJcbiAgICB9XHJcblxyXG4gICAgYmVnaW5WYWx1ZUNoYW5nZShldmVudCkge1xyXG4gICAgICAgIHRoaXMuX2l0ZW0udmFsdWUuc3RhcnRWYWx1ZSA9IGV2ZW50LnJldHVybkZvcm1hdHRlZCA/IGV2ZW50LnJldHVybkZvcm1hdHRlZCA6IG51bGw7XHJcbiAgICAgICAgdGhpcy5faXRlbS52YWx1ZS5zdGFydFZhbHVlVGV4dCA9IGV2ZW50LmZvcm1hdHRlZDtcclxuICAgICAgICB0aGlzLmFjdGl2ZWREYXRlVGFnSWQgPSAnJztcclxuICAgICAgICB0aGlzLmFjdGl2ZWREYXlUYWdJZCA9ICcnO1xyXG4gICAgICAgIHRoaXMuc2V0VmFsdWVUZXh0KCk7XHJcbiAgICAgICAgdGhpcy5kYXRlU3VibWl0Q2hhbmdlKCk7XHJcbiAgICB9XHJcblxyXG4gICAgZW5kVmFsdWVDaGFuZ2UoZXZlbnQpIHtcclxuICAgICAgICB0aGlzLl9pdGVtLnZhbHVlLmVuZFZhbHVlID0gZXZlbnQucmV0dXJuRm9ybWF0dGVkID8gZXZlbnQucmV0dXJuRm9ybWF0dGVkIDogbnVsbDtcclxuICAgICAgICB0aGlzLl9pdGVtLnZhbHVlLmVuZFZhbHVlVGV4dCA9IGV2ZW50LmZvcm1hdHRlZDtcclxuICAgICAgICB0aGlzLmFjdGl2ZWREYXRlVGFnSWQgPSAnJztcclxuICAgICAgICB0aGlzLmFjdGl2ZWREYXlUYWdJZCA9ICcnO1xyXG4gICAgICAgIHRoaXMuc2V0VmFsdWVUZXh0KCk7XHJcbiAgICAgICAgdGhpcy5kYXRlU3VibWl0Q2hhbmdlKCk7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0VmFsdWVUZXh0KCkge1xyXG4gICAgICAgIGlmIChPYmplY3Qua2V5cyh0aGlzLl9pdGVtLnZhbHVlKS5sZW5ndGggPT09IDAgfHwgKCF0aGlzLl9pdGVtLnZhbHVlLnN0YXJ0VmFsdWUgJiYgIXRoaXMuX2l0ZW0udmFsdWUuZW5kVmFsdWUpKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX2l0ZW0udmFsdWVUZXh0ID0gJydcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAoIXRoaXMuX2l0ZW0udmFsdWUuc3RhcnRWYWx1ZVRleHQpIHtcclxuICAgICAgICAgICAgdGhpcy5faXRlbS52YWx1ZVRleHQgPSAnficgKyB0aGlzLl9pdGVtLnZhbHVlLmVuZFZhbHVlVGV4dDtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAoIXRoaXMuX2l0ZW0udmFsdWUuZW5kVmFsdWVUZXh0KSB7XHJcbiAgICAgICAgICAgIHRoaXMuX2l0ZW0udmFsdWVUZXh0ID0gdGhpcy5faXRlbS52YWx1ZS5zdGFydFZhbHVlVGV4dCArICd+JztcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMuX2l0ZW0udmFsdWVUZXh0ID0gdGhpcy5faXRlbS52YWx1ZS5zdGFydFZhbHVlVGV4dCArICd+JyArIHRoaXMuX2l0ZW0udmFsdWUuZW5kVmFsdWVUZXh0O1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBkYXRlU3VibWl0Q2hhbmdlKCkge1xyXG4gICAgICAgIGNvbnN0IHZhbCA9IHRoaXMuX2l0ZW0udmFsdWU7XHJcbiAgICAgICAgaWYgKHRoaXMuc2luZ2xlKSB7XHJcbiAgICAgICAgICAgIGlmIChPYmplY3Qua2V5cyh2YWwpLmxlbmd0aCA8IDAgfHwgIXZhbC52YWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zdWJtaXRDaGFuZ2UuZW1pdChmYWxzZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnN1Ym1pdENoYW5nZS5lbWl0KHRydWUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBpZiAoT2JqZWN0LmtleXModmFsKS5sZW5ndGggPT09IDAgfHwgKCF2YWwuc3RhcnRWYWx1ZSAmJiAhdmFsLmVuZFZhbHVlKSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zdWJtaXRDaGFuZ2UuZW1pdChmYWxzZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnN1Ym1pdENoYW5nZS5lbWl0KHRydWUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIG9uQ2hhbmdlKGV2ZW50KSB7XHJcbiAgICAgICAgdGhpcy5zaW5nbGUgPSAhZXZlbnQ7XHJcbiAgICAgICAgdGhpcy5faXRlbS5jb250cm9sLnNpbmdsZSA9IHRoaXMuc2luZ2xlO1xyXG4gICAgICAgIHRoaXMuX2l0ZW0udmFsdWUuc2luZ2xlID0gdGhpcy5zaW5nbGU7XHJcbiAgICAgICAgdGhpcy5pdGVtQ2hhbmdlLmVtaXQodGhpcy5pdGVtKTtcclxuICAgICAgICB0aGlzLmRhdGVTdWJtaXRDaGFuZ2UoKTtcclxuICAgIH1cclxuXHJcblxyXG4gICAgY2xpY2tUYWcodGFnKSB7XHJcbiAgICAgICAgdGhpcy5hY3RpdmVkRGF0ZVRhZ0lkID0gdGFnLmlkO1xyXG4gICAgICAgIGxldCB0YWdEYXRlO1xyXG4gICAgICAgIGlmICh0YWcuaWQgPT0gJ3RhZzEnKSB7XHJcbiAgICAgICAgICAgIHRhZ0RhdGUgPSBnZXRMYXN0TnVtTW9udGgoMSwgdGhpcy5zaG93VGltZSwgdGhpcy5zaG93VHlwZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKHRhZy5pZCA9PSAndGFnMicpIHtcclxuICAgICAgICAgICAgdGFnRGF0ZSA9IGdldExhc3ROdW1Nb250aCgzLCB0aGlzLnNob3dUaW1lLCB0aGlzLnNob3dUeXBlKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAodGFnLmlkID09ICd0YWczJykge1xyXG4gICAgICAgICAgICB0YWdEYXRlID0gZ2V0TGFzdE51bU1vbnRoKDYsIHRoaXMuc2hvd1RpbWUsIHRoaXMuc2hvd1R5cGUpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLl9pdGVtLnZhbHVlLnN0YXJ0VmFsdWUgPSB0YWdEYXRlWydzdGFydFRpbWUnXTtcclxuICAgICAgICB0aGlzLl9pdGVtLnZhbHVlLmVuZFZhbHVlID0gdGFnRGF0ZVsnZW5kVGltZSddO1xyXG4gICAgICAgIHRoaXMuX2l0ZW0udmFsdWUuc3RhcnRWYWx1ZVRleHQgPSB0aGlzLmRhdGVwaWNrZXJFbGUuZGF0ZVRvKG5ldyBEYXRlKHRoaXMuX2l0ZW0udmFsdWUuc3RhcnRWYWx1ZSkpO1xyXG4gICAgICAgIHRoaXMuX2l0ZW0udmFsdWUuZW5kVmFsdWVUZXh0ID0gdGhpcy5kYXRlcGlja2VyRWxlLmRhdGVUbyhuZXcgRGF0ZSh0aGlzLl9pdGVtLnZhbHVlLmVuZFZhbHVlKSk7XHJcbiAgICAgICAgdGhpcy5zdGFydFZhbHVlID0gdGhpcy5faXRlbS52YWx1ZS5zdGFydFZhbHVlO1xyXG4gICAgICAgIHRoaXMuZW5kVmFsdWUgPSB0aGlzLl9pdGVtLnZhbHVlLmVuZFZhbHVlO1xyXG4gICAgICAgIHRoaXMuc2V0VmFsdWVUZXh0KCk7XHJcbiAgICAgICAgdGhpcy5kYXRlU3VibWl0Q2hhbmdlKCk7XHJcbiAgICB9XHJcblxyXG4gICAgY2xpY2tEYXlUYWcodGFnKXtcclxuICAgICAgICB0aGlzLmFjdGl2ZWREYXlUYWdJZCA9IHRhZy5pZDtcclxuICAgICAgICBsZXQgZGF5VGFnID0gZ2V0VG9kYXkodGhpcy5hY3RpdmVkRGF5VGFnSWQsIHRoaXMuc2hvd1RpbWUpO1xyXG4gICAgICAgIHRoaXMuX2l0ZW0udmFsdWUudmFsdWUgPSBkYXlUYWc7XHJcbiAgICAgICAgdGhpcy52YWx1ZSA9IHRoaXMuX2l0ZW0udmFsdWUudmFsdWU7XHJcbiAgICAgICAgdGhpcy5faXRlbS52YWx1ZVRleHQgPSB0aGlzLmRhdGVwaWNrZXJFbGUuZGF0ZVRvKG5ldyBEYXRlKHRoaXMuX2l0ZW0udmFsdWUudmFsdWUpKTtcclxuICAgICAgICB0aGlzLmRhdGVTdWJtaXRDaGFuZ2UoKTtcclxuICAgIH1cclxufSJdfQ==
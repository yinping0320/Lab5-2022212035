/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input, Output, EventEmitter, ViewChild } from '@angular/core';
import { getLastNumMonth } from './utils';
import { LocaleService } from '@farris/ui-locale';
import { FarrisDatepickerComponent } from '@farris/ui-datepicker';
var PanelDateRangeComponent = /** @class */ (function () {
    function PanelDateRangeComponent(localeService) {
        this.localeService = localeService;
        this.searchHandle = new EventEmitter();
        this.submitChange = new EventEmitter();
        this.date = new Date();
        this.dateTags = [];
    }
    Object.defineProperty(PanelDateRangeComponent.prototype, "item", {
        get: /**
         * @return {?}
         */
        function () {
            return this._item;
        },
        set: /**
         * @param {?} data
         * @return {?}
         */
        function (data) {
            var _this = this;
            this._item = data;
            setTimeout((/**
             * @return {?}
             */
            function () {
                _this.initDate();
            }), 0);
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    PanelDateRangeComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        //this.initDate();
        this.dateTags = [
            {
                id: 'tag1',
                text: this.localeService.getValue('filterPanel.last1Month')
            },
            {
                id: 'tag2',
                text: this.localeService.getValue('filterPanel.last3Month')
            },
            {
                id: 'tag3',
                text: this.localeService.getValue('filterPanel.last6Month')
            }
        ];
    };
    /**
     * @return {?}
     */
    PanelDateRangeComponent.prototype.initDate = /**
     * @return {?}
     */
    function () {
        if (!this._item.hasOwnProperty('value')) {
            this._item.value = {
                startTime: '',
                endTime: ''
            };
        }
        if (this._item.beginPlaceHolder) {
            this.beginPlaceHolder = this._item.beginPlaceHolder || '';
        }
        if (this._item.endPlaceHolder) {
            this.endPlaceHolder = this._item.endPlaceHolder || '';
        }
        if (this.item && this._item.control) {
            /** @type {?} */
            var itemDateFormat = this._item.control.format;
            if (this.showTime && itemDateFormat) {
                if (itemDateFormat.length > 0 && itemDateFormat.indexOf('HH:mm') == -1) {
                    itemDateFormat = itemDateFormat + ' HH:mm:ss';
                }
            }
            /** @type {?} */
            var format = this.showTime ? 'yyyy-MM-dd HH:mm:ss' : (this.showType == '2' ? 'yyyy-MM' : (this.showType == '3' ? 'yyyy' : 'yyyy-MM-dd'));
            this.dateFormat = itemDateFormat ? itemDateFormat : format;
        }
        /** @type {?} */
        var rangeDateValue = this._item && this._item.value;
        this.activedDateTagId = '';
        if (rangeDateValue.startTime && rangeDateValue.endTime) {
            this.rangeDate = rangeDateValue.startTime + "~" + rangeDateValue.endTime;
        }
        else {
            this.rangeDate = '';
        }
        this.setSubmitChange();
    };
    /**
     * @param {?} dateString
     * @return {?}
     */
    PanelDateRangeComponent.prototype.getDate = /**
     * @param {?} dateString
     * @return {?}
     */
    function (dateString) {
        /** @type {?} */
        var date = new Date(dateString);
        return date;
    };
    /**
     * @param {?} event
     * @return {?}
     */
    PanelDateRangeComponent.prototype.onDateChange = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        if (event.returnFormatted) {
            (this._item.value).startTime = event.returnFormatted.split('~')[0];
            (this._item.value).endTime = event.returnFormatted.split('~')[1];
        }
        else {
            this._item.value.startTime = '';
            this._item.value.endTime = '';
        }
        // if (Object.keys(this._item.value).length === 0 || (!this._item.value.startTime && !this._item.value.endTime)) {
        //     this._item.valueText = ''
        // }
        // else {
        //     this._item.valueText = this._item.value.startTime + '~' + this._item.value.endTime;
        // }
        this._item.valueText = event.formatted;
        this.activedDateTagId = '';
        this.setSubmitChange();
        this.searchHandle.emit(event);
    };
    /**
     * @param {?} tag
     * @return {?}
     */
    PanelDateRangeComponent.prototype.clickTag = /**
     * @param {?} tag
     * @return {?}
     */
    function (tag) {
        this.activedDateTagId = tag.id;
        /** @type {?} */
        var tagDate;
        if (tag.id == 'tag1') {
            tagDate = getLastNumMonth(1, this.showTime, this.showType);
        }
        else if (tag.id == 'tag2') {
            tagDate = getLastNumMonth(3, this.showTime, this.showType);
        }
        else if (tag.id == 'tag3') {
            tagDate = getLastNumMonth(6, this.showTime, this.showType);
        }
        this._item.value.startTime = tagDate['startTime'];
        this._item.value.endTime = tagDate['endTime'];
        /** @type {?} */
        var rangeDateValue = this._item && this._item.value;
        if (rangeDateValue.startTime && rangeDateValue.endTime) {
            this.rangeDate = rangeDateValue.startTime + "~" + rangeDateValue.endTime;
        }
        else {
            this.rangeDate = '';
        }
        // this._item.valueText = this._item.value.startTime + '~' + this._item.value.endTime;
        this._item.valueText = this.datepickerEle.dateTo(new Date(this._item.value.startTime)) + '~' + this.datepickerEle.dateTo(new Date(this._item.value.endTime));
        this.setSubmitChange();
    };
    /**
     * @return {?}
     */
    PanelDateRangeComponent.prototype.setSubmitChange = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var val = this._item.value;
        if (Object.keys(val).length < 0 || (!val.startTime && !val.endTime)) {
            this.submitChange.emit(false);
        }
        else {
            this.submitChange.emit(true);
        }
    };
    PanelDateRangeComponent.decorators = [
        { type: Component, args: [{
                    selector: 'panel-filter-daterange',
                    template: "<!-- <farris-datepicker [(ngModel)]=\"rangeDate\" [dateRange]=\"true\" [editable]=\"false\" [returnFormat]=\"showTime ? 'yyyy-MM-dd HH:mm:ss' : 'yyyy-MM-dd'\" [dateFormat]=\"dateFormat\" (valueChange)=\"onDateChange($event)\" [beginPlaceholder]=\"beginPlaceHolder\" [endPlaceholder]=\"endPlaceHolder\" [placeholder]=\"placeholder\" [showTime]=\"showTime\"></farris-datepicker> -->\r\n\r\n<ng-container *ngIf=\"showTime;else defaultdate\">\r\n    <farris-datepicker [(ngModel)]=\"rangeDate\" [dateRange]=\"true\" [editable]=\"false\" [returnFormat]=\"showTime ? 'yyyy-MM-dd HH:mm:ss' : 'yyyy-MM-dd'\" [dateFormat]=\"dateFormat\" (valueChange)=\"onDateChange($event)\" [beginPlaceholder]=\"beginPlaceHolder\" [endPlaceholder]=\"endPlaceHolder\" [showTime]=\"showTime\" #datepicker></farris-datepicker>\r\n</ng-container>\r\n<ng-template #defaultdate>\r\n    <farris-datepicker [(ngModel)]=\"rangeDate\" [dateRange]=\"true\" [editable]=\"false\" [returnFormat]=\"showType == '2'? 'yyyy-MM': (showType == '3'? 'yyyy':'yyyy-MM-dd')\" [dateFormat]=\"dateFormat\" (valueChange)=\"onDateChange($event)\" [beginPlaceholder]=\"beginPlaceHolder\" [endPlaceholder]=\"endPlaceHolder\" [showType]=\"showType\" #datepicker></farris-datepicker>\r\n</ng-template>\r\n\r\n<div class=\"f-filter-panel-date-tags\" *ngIf=\"showType !== '3'\">\r\n    <div class=\"panel-date-tag\" \r\n    *ngFor=\"let tag of dateTags\" \r\n    (click)=\"clickTag(tag)\"\r\n    [ngClass]=\"{'active': tag.id == activedDateTagId}\"\r\n    >\r\n        {{tag.text}}\r\n    </div>\r\n</div>"
                }] }
    ];
    /** @nocollapse */
    PanelDateRangeComponent.ctorParameters = function () { return [
        { type: LocaleService }
    ]; };
    PanelDateRangeComponent.propDecorators = {
        item: [{ type: Input }],
        showTime: [{ type: Input }],
        showType: [{ type: Input }],
        searchHandle: [{ type: Output, args: ['searchHandle',] }],
        submitChange: [{ type: Output, args: ['submitChange',] }],
        datepickerEle: [{ type: ViewChild, args: ['datepicker',] }]
    };
    return PanelDateRangeComponent;
}());
export { PanelDateRangeComponent };
if (false) {
    /** @type {?} */
    PanelDateRangeComponent.prototype._item;
    /** @type {?} */
    PanelDateRangeComponent.prototype.showTime;
    /** @type {?} */
    PanelDateRangeComponent.prototype.showType;
    /** @type {?} */
    PanelDateRangeComponent.prototype.searchHandle;
    /** @type {?} */
    PanelDateRangeComponent.prototype.submitChange;
    /** @type {?} */
    PanelDateRangeComponent.prototype.datepickerEle;
    /** @type {?} */
    PanelDateRangeComponent.prototype.startTime;
    /** @type {?} */
    PanelDateRangeComponent.prototype.endTime;
    /** @type {?} */
    PanelDateRangeComponent.prototype.rangeDate;
    /** @type {?} */
    PanelDateRangeComponent.prototype.placeholder;
    /** @type {?} */
    PanelDateRangeComponent.prototype.beginPlaceHolder;
    /** @type {?} */
    PanelDateRangeComponent.prototype.endPlaceHolder;
    /** @type {?} */
    PanelDateRangeComponent.prototype.dateFormat;
    /** @type {?} */
    PanelDateRangeComponent.prototype.date;
    /** @type {?} */
    PanelDateRangeComponent.prototype.dateTags;
    /** @type {?} */
    PanelDateRangeComponent.prototype.activedDateTagId;
    /** @type {?} */
    PanelDateRangeComponent.prototype.localeService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0ZXJhbmdlLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvdWktZmlsdGVyLXBhbmVsLyIsInNvdXJjZXMiOlsibGliL2NvbXBvbmVudHMvZGF0ZXJhbmdlY29tcG9uZW50L2RhdGVyYW5nZS5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsS0FBSyxFQUFVLE1BQU0sRUFBRSxZQUFZLEVBQUUsU0FBUyxFQUFjLE1BQU0sZUFBZSxDQUFDO0FBQ3RHLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxTQUFTLENBQUM7QUFDMUMsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBQ2xELE9BQU8sRUFBRSx5QkFBeUIsRUFBRSxNQUFNLHVCQUF1QixDQUFDO0FBRWxFO0lBb0NJLGlDQUFtQixhQUE0QjtRQUE1QixrQkFBYSxHQUFiLGFBQWEsQ0FBZTtRQWhCdkIsaUJBQVksR0FBRyxJQUFJLFlBQVksRUFBRSxDQUFDO1FBQ2xDLGlCQUFZLEdBQUcsSUFBSSxZQUFZLEVBQUUsQ0FBQztRQVcxRCxTQUFJLEdBQUcsSUFBSSxJQUFJLEVBQUUsQ0FBQztRQUNsQixhQUFRLEdBQUcsRUFBRSxDQUFDO0lBR3FDLENBQUM7SUE1QnBELHNCQUNJLHlDQUFJOzs7O1FBRFI7WUFFSSxPQUFPLElBQUksQ0FBQyxLQUFLLENBQUM7UUFDdEIsQ0FBQzs7Ozs7UUFDRCxVQUFTLElBQUk7WUFBYixpQkFLQztZQUpHLElBQUksQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDO1lBQ2xCLFVBQVU7OztZQUFDO2dCQUNQLEtBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQztZQUNwQixDQUFDLEdBQUUsQ0FBQyxDQUFDLENBQUM7UUFDVixDQUFDOzs7T0FOQTs7OztJQTJCRCwwQ0FBUTs7O0lBQVI7UUFDSSxrQkFBa0I7UUFDbEIsSUFBSSxDQUFDLFFBQVEsR0FBRztZQUNaO2dCQUNJLEVB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LENBQUMsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxHQUFHLENBQUMsU0FBUyxJQUFJLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxFQUFDO1lBQy9ELElBQUksQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1NBQ2pDO2FBQ0c7WUFDQSxJQUFJLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztTQUNoQztJQUNMLENBQUM7O2dCQXRKSixTQUFTLFNBQUM7b0JBQ1AsUUFBUSxFQUFFLHdCQUF3QjtvQkFDbEMsd2hEQUF5QztpQkFDNUM7Ozs7Z0JBTlEsYUFBYTs7O3VCQVdqQixLQUFLOzJCQVVMLEtBQUs7MkJBQ0wsS0FBSzsrQkFDTCxNQUFNLFNBQUMsY0FBYzsrQkFDckIsTUFBTSxTQUFDLGNBQWM7Z0NBQ3JCLFNBQVMsU0FBQyxZQUFZOztJQWlJM0IsOEJBQUM7Q0FBQSxBQXZKRCxJQXVKQztTQWxKWSx1QkFBdUI7OztJQUVoQyx3Q0FBVzs7SUFXWCwyQ0FBMkI7O0lBQzNCLDJDQUF5Qjs7SUFDekIsK0NBQTBEOztJQUMxRCwrQ0FBMEQ7O0lBQzFELGdEQUFpRTs7SUFFakUsNENBQWdCOztJQUNoQiwwQ0FBYzs7SUFFZCw0Q0FBa0I7O0lBQ2xCLDhDQUFvQjs7SUFDcEIsbURBQXlCOztJQUN6QixpREFBdUI7O0lBQ3ZCLDZDQUFtQjs7SUFDbkIsdUNBQWtCOztJQUNsQiwyQ0FBYzs7SUFDZCxtREFBaUI7O0lBRUwsZ0RBQW1DIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBJbnB1dCwgT25Jbml0LCBPdXRwdXQsIEV2ZW50RW1pdHRlciwgVmlld0NoaWxkLCBFbGVtZW50UmVmIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IGdldExhc3ROdW1Nb250aCB9IGZyb20gJy4vdXRpbHMnO1xyXG5pbXBvcnQgeyBMb2NhbGVTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy91aS1sb2NhbGUnO1xyXG5pbXBvcnQgeyBGYXJyaXNEYXRlcGlja2VyQ29tcG9uZW50IH0gZnJvbSAnQGZhcnJpcy91aS1kYXRlcGlja2VyJztcclxuXHJcbkBDb21wb25lbnQoe1xyXG4gICAgc2VsZWN0b3I6ICdwYW5lbC1maWx0ZXItZGF0ZXJhbmdlJyxcclxuICAgIHRlbXBsYXRlVXJsOiAnLi9kYXRlcmFuZ2UuY29tcG9uZW50Lmh0bWwnXHJcbn0pXHJcblxyXG5leHBvcnQgY2xhc3MgUGFuZWxEYXRlUmFuZ2VDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xyXG4gICAgLy8gQElucHV0KCkgaXRlbTphbnk7XHJcbiAgICBfaXRlbTogYW55O1xyXG4gICAgQElucHV0KClcclxuICAgIGdldCBpdGVtKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9pdGVtO1xyXG4gICAgfVxyXG4gICAgc2V0IGl0ZW0oZGF0YSkge1xyXG4gICAgICAgIHRoaXMuX2l0ZW0gPSBkYXRhO1xyXG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLmluaXREYXRlKCk7XHJcbiAgICAgICAgfSwgMCk7XHJcbiAgICB9XHJcbiAgICBASW5wdXQoKSBzaG93VGltZTogYm9vbGVhbjtcclxuICAgIEBJbnB1dCgpIHNob3dUeXBlOnN0cmluZztcclxuICAgIEBPdXRwdXQoJ3NlYXJjaEhhbmRsZScpIHNlYXJjaEhhbmRsZSA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuICAgIEBPdXRwdXQoJ3N1Ym1pdENoYW5nZScpIHN1Ym1pdENoYW5nZSA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuICAgIEBWaWV3Q2hpbGQoJ2RhdGVwaWNrZXInKSBkYXRlcGlja2VyRWxlOkZhcnJpc0RhdGVwaWNrZXJDb21wb25lbnQ7XHJcblxyXG4gICAgc3RhcnRUaW1lOiBEYXRlO1xyXG4gICAgZW5kVGltZTogRGF0ZTtcclxuXHJcbiAgICByYW5nZURhdGU6IHN0cmluZztcclxuICAgIHBsYWNlaG9sZGVyOiBzdHJpbmc7XHJcbiAgICBiZWdpblBsYWNlSG9sZGVyOiBzdHJpbmc7XHJcbiAgICBlbmRQbGFjZUhvbGRlcjogc3RyaW5nO1xyXG4gICAgZGF0ZUZvcm1hdDogc3RyaW5nO1xyXG4gICAgZGF0ZSA9IG5ldyBEYXRlKCk7XHJcbiAgICBkYXRlVGFncyA9IFtdO1xyXG4gICAgYWN0aXZlZERhdGVUYWdJZDtcclxuXHJcbiAgICBjb25zdHJ1Y3RvcihwdWJsaWMgbG9jYWxlU2VydmljZTogTG9jYWxlU2VydmljZSkgeyB9XHJcblxyXG4gICAgbmdPbkluaXQoKTogdm9pZCB7XHJcbiAgICAgICAgLy90aGlzLmluaXREYXRlKCk7XHJcbiAgICAgICAgdGhpcy5kYXRlVGFncyA9IFtcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaWQ6ICd0YWcxJyxcclxuICAgICAgICAgICAgICAgIHRleHQ6IHRoaXMubG9jYWxlU2VydmljZS5nZXRWYWx1ZSgnZmlsdGVyUGFuZWwubGFzdDFNb250aCcpXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGlkOiAndGFnMicsXHJcbiAgICAgICAgICAgICAgICB0ZXh0OiB0aGlzLmxvY2FsZVNlcnZpY2UuZ2V0VmFsdWUoJ2ZpbHRlclBhbmVsLmxhc3QzTW9udGgnKVxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpZDogJ3RhZzMnLFxyXG4gICAgICAgICAgICAgICAgdGV4dDogdGhpcy5sb2NhbGVTZXJ2aWNlLmdldFZhbHVlKCdmaWx0ZXJQYW5lbC5sYXN0Nk1vbnRoJylcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIF07XHJcbiAgICB9XHJcblxyXG4gICAgaW5pdERhdGUoKSB7XHJcbiAgICAgICAgaWYoIXRoaXMuX2l0ZW0uaGFzT3duUHJvcGVydHkoJ3ZhbHVlJykpIHtcclxuICAgICAgICAgICAgdGhpcy5faXRlbS52YWx1ZSA9IHtcclxuICAgICAgICAgICAgICAgIHN0YXJ0VGltZSA6ICcnLFxyXG4gICAgICAgICAgICAgICAgZW5kVGltZSA6ICcnXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0aGlzLl9pdGVtLmJlZ2luUGxhY2VIb2xkZXIpIHtcclxuICAgICAgICAgICAgdGhpcy5iZWdpblBsYWNlSG9sZGVyID0gdGhpcy5faXRlbS5iZWdpblBsYWNlSG9sZGVyIHx8ICcnO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHRoaXMuX2l0ZW0uZW5kUGxhY2VIb2xkZXIgKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZW5kUGxhY2VIb2xkZXIgPSB0aGlzLl9pdGVtLmVuZFBsYWNlSG9sZGVyIHx8ICcnO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZih0aGlzLml0ZW0gJiYgdGhpcy5faXRlbS5jb250cm9sKXtcclxuICAgICAgICAgICAgbGV0IGl0ZW1EYXRlRm9ybWF0ID0gdGhpcy5faXRlbS5jb250cm9sLmZvcm1hdDtcclxuICAgICAgICAgICAgaWYodGhpcy5zaG93VGltZSAmJiBpdGVtRGF0ZUZvcm1hdCl7XHJcbiAgICAgICAgICAgICAgICBpZihpdGVtRGF0ZUZvcm1hdC5sZW5ndGggPiAwICYmIGl0ZW1EYXRlRm9ybWF0LmluZGV4T2YoJ0hIOm1tJykgPT0gLTEpe1xyXG4gICAgICAgICAgICAgICAgICAgIGl0ZW1EYXRlRm9ybWF0ID0gaXRlbURhdGVGb3JtYXQgKyAnIEhIOm1tOnNzJztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjb25zdCBmb3JtYXQgPSB0aGlzLnNob3dUaW1lID8gJ3l5eXktTU0tZGQgSEg6bW06c3MnOiAodGhpcy5zaG93VHlwZSA9PSAnMic/ICd5eXl5LU1NJzogKHRoaXMuc2hvd1R5cGUgPT0gJzMnPyAneXl5eSc6J3l5eXktTU0tZGQnKSk7XHJcbiAgICAgICAgICAgIHRoaXMuZGF0ZUZvcm1hdCA9IGl0ZW1EYXRlRm9ybWF0P2l0ZW1EYXRlRm9ybWF0OmZvcm1hdDtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc3QgcmFuZ2VEYXRlVmFsdWUgPSB0aGlzLl9pdGVtICYmIHRoaXMuX2l0ZW0udmFsdWU7XHJcbiAgICAgICAgdGhpcy5hY3RpdmVkRGF0ZVRhZ0lkID0gJyc7XHJcbiAgICAgICAgaWYgKHJhbmdlRGF0ZVZhbHVlLnN0YXJ0VGltZSAmJiByYW5nZURhdGVWYWx1ZS5lbmRUaW1lKSB7XHJcbiAgICAgICAgICAgIHRoaXMucmFuZ2VEYXRlID0gYCR7cmFuZ2VEYXRlVmFsdWUuc3RhcnRUaW1lfX4ke3JhbmdlRGF0ZVZhbHVlLmVuZFRpbWV9YDtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMucmFuZ2VEYXRlID0gJyc7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuc2V0U3VibWl0Q2hhbmdlKCk7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0RGF0ZShkYXRlU3RyaW5nOiBEYXRlKTogRGF0ZSB7XHJcbiAgICAgICAgbGV0IGRhdGUgPSBuZXcgRGF0ZShkYXRlU3RyaW5nKTtcclxuICAgICAgICByZXR1cm4gZGF0ZTtcclxuICAgIH1cclxuXHJcbiAgICBvbkRhdGVDaGFuZ2UoZXZlbnQ6IGFueSkge1xyXG4gICAgICAgIGlmIChldmVudC5yZXR1cm5Gb3JtYXR0ZWQpIHtcclxuICAgICAgICAgICAgKHRoaXMuX2l0ZW0udmFsdWUpLnN0YXJ0VGltZSA9IGV2ZW50LnJldHVybkZvcm1hdHRlZC5zcGxpdCgnficpWzBdO1xyXG4gICAgICAgICAgICAodGhpcy5faXRlbS52YWx1ZSkuZW5kVGltZSA9IGV2ZW50LnJldHVybkZvcm1hdHRlZC5zcGxpdCgnficpWzFdO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMuX2l0ZW0udmFsdWUuc3RhcnRUaW1lID0gJyc7XHJcbiAgICAgICAgICAgIHRoaXMuX2l0ZW0udmFsdWUuZW5kVGltZSA9ICcnO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyBpZiAoT2JqZWN0LmtleXModGhpcy5faXRlbS52YWx1ZSkubGVuZ3RoID09PSAwIHx8ICghdGhpcy5faXRlbS52YWx1ZS5zdGFydFRpbWUgJiYgIXRoaXMuX2l0ZW0udmFsdWUuZW5kVGltZSkpIHtcclxuICAgICAgICAvLyAgICAgdGhpcy5faXRlbS52YWx1ZVRleHQgPSAnJ1xyXG4gICAgICAgIC8vIH1cclxuICAgICAgICAvLyBlbHNlIHtcclxuICAgICAgICAvLyAgICAgdGhpcy5faXRlbS52YWx1ZVRleHQgPSB0aGlzLl9pdGVtLnZhbHVlLnN0YXJ0VGltZSArICd+JyArIHRoaXMuX2l0ZW0udmFsdWUuZW5kVGltZTtcclxuICAgICAgICAvLyB9XHJcbiAgICAgICAgdGhpcy5faXRlbS52YWx1ZVRleHQgPSBldmVudC5mb3JtYXR0ZWQ7XHJcbiAgICAgICAgdGhpcy5hY3RpdmVkRGF0ZVRhZ0lkID0gJyc7XHJcbiAgICAgICAgdGhpcy5zZXRTdWJtaXRDaGFuZ2UoKTtcclxuICAgICAgICB0aGlzLnNlYXJjaEhhbmRsZS5lbWl0KGV2ZW50KTtcclxuICAgIH1cclxuXHJcbiAgICBjbGlja1RhZyh0YWcpIHtcclxuICAgICAgICB0aGlzLmFjdGl2ZWREYXRlVGFnSWQgPSB0YWcuaWQ7XHJcbiAgICAgICAgbGV0IHRhZ0RhdGU7XHJcbiAgICAgICAgaWYodGFnLmlkID09ICd0YWcxJyl7XHJcbiAgICAgICAgICAgIHRhZ0RhdGUgPSBnZXRMYXN0TnVtTW9udGgoMSx0aGlzLnNob3dUaW1lLHRoaXMuc2hvd1R5cGUpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmKHRhZy5pZCA9PSAndGFnMicpe1xyXG4gICAgICAgICAgICB0YWdEYXRlID0gZ2V0TGFzdE51bU1vbnRoKDMsdGhpcy5zaG93VGltZSx0aGlzLnNob3dUeXBlKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZih0YWcuaWQgPT0gJ3RhZzMnKXtcclxuICAgICAgICAgICAgdGFnRGF0ZSA9IGdldExhc3ROdW1Nb250aCg2LHRoaXMuc2hvd1RpbWUsdGhpcy5zaG93VHlwZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuX2l0ZW0udmFsdWUuc3RhcnRUaW1lID0gdGFnRGF0ZVsnc3RhcnRUaW1lJ107XHJcbiAgICAgICAgdGhpcy5faXRlbS52YWx1ZS5lbmRUaW1lID0gdGFnRGF0ZVsnZW5kVGltZSddO1xyXG4gICAgICAgIGNvbnN0IHJhbmdlRGF0ZVZhbHVlID0gdGhpcy5faXRlbSAmJiB0aGlzLl9pdGVtLnZhbHVlO1xyXG4gICAgICAgIGlmIChyYW5nZURhdGVWYWx1ZS5zdGFydFRpbWUgJiYgcmFuZ2VEYXRlVmFsdWUuZW5kVGltZSkge1xyXG4gICAgICAgICAgICB0aGlzLnJhbmdlRGF0ZSA9IGAke3JhbmdlRGF0ZVZhbHVlLnN0YXJ0VGltZX1+JHtyYW5nZURhdGVWYWx1ZS5lbmRUaW1lfWA7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLnJhbmdlRGF0ZSA9ICcnO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyB0aGlzLl9pdGVtLnZhbHVlVGV4dCA9IHRoaXMuX2l0ZW0udmFsdWUuc3RhcnRUaW1lICsgJ34nICsgdGhpcy5faXRlbS52YWx1ZS5lbmRUaW1lO1xyXG4gICAgICAgIHRoaXMuX2l0ZW0udmFsdWVUZXh0ID0gdGhpcy5kYXRlcGlja2VyRWxlLmRhdGVUbyhuZXcgRGF0ZSh0aGlzLl9pdGVtLnZhbHVlLnN0YXJ0VGltZSkpICsgJ34nICsgdGhpcy5kYXRlcGlja2VyRWxlLmRhdGVUbyhuZXcgRGF0ZSh0aGlzLl9pdGVtLnZhbHVlLmVuZFRpbWUpKVxyXG4gICAgICAgIHRoaXMuc2V0U3VibWl0Q2hhbmdlKCk7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0U3VibWl0Q2hhbmdlKCl7XHJcbiAgICAgICAgY29uc3QgdmFsID0gdGhpcy5faXRlbS52YWx1ZTtcclxuICAgICAgICBpZihPYmplY3Qua2V5cyh2YWwpLmxlbmd0aCA8IDAgfHwgKCF2YWwuc3RhcnRUaW1lICYmICF2YWwuZW5kVGltZSkpe1xyXG4gICAgICAgICAgICB0aGlzLnN1Ym1pdENoYW5nZS5lbWl0KGZhbHNlKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZXtcclxuICAgICAgICAgICAgdGhpcy5zdWJtaXRDaGFuZ2UuZW1pdCh0cnVlKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn0iXX0=
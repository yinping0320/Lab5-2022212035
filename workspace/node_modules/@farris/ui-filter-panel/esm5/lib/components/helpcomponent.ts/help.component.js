/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input, Output, EventEmitter, Injector } from '@angular/core';
// import { ServerSideToken } from '@farris/ui-lookup';
// import { LookupHttpBeQueryService } from './service/Lookup-http.service';
import { of } from 'rxjs';
import { cloneDeep } from 'lodash-es';
var PanelHelpComponent = /** @class */ (function () {
    function PanelHelpComponent(injector) {
        var _this = this;
        this.injector = injector;
        this.searchHandle = new EventEmitter();
        this.submitChange = new EventEmitter();
        this.onSearch = (/**
         * @return {?}
         */
        function () {
            _this.searchHandle.emit();
            return of(true);
        });
    }
    Object.defineProperty(PanelHelpComponent.prototype, "item", {
        get: /**
         * @return {?}
         */
        function () {
            return this._item;
        },
        set: /**
         * @param {?} data
         * @return {?}
         */
        function (data) {
            this._item = data;
            if (this._item.placeHolder) {
                this.placeholder = this._item.placeHolder;
            }
            if (!this._item.hasOwnProperty('value')) {
                this._item.value = {
                    value: [],
                    valueField: '',
                    textValue: ''
                };
            }
            this.getHelpBindingInfo();
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    PanelHelpComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        // if(this.item.control && this.item.control.hasOwnProperty('placeholder')){
        //     this.placeholder = this.item.control.placeholder;
        // }
        // this.getHelpBindingInfo();
    };
    /**
     * @param {?} selectedItem
     * @return {?}
     */
    PanelHelpComponent.prototype.selectedDataHandler = /**
     * @param {?} selectedItem
     * @return {?}
     */
    function (selectedItem) {
        /** @type {?} */
        var helpValue = (this._item.value);
        helpValue.value = this.singleSelect ? [selectedItem] : selectedItem; // 单选返回对象，多选返回数组
        helpValue.valueField = this.valueField;
        helpValue.textValue = this.getTextValue(this.textField, helpValue.value);
        this.textValue = helpValue.textValue;
        this._item.valueText = this._item.value.textValue;
        this.setSubmitChange();
        this.searchHandle.emit();
    };
    /**
     * @return {?}
     */
    PanelHelpComponent.prototype.getHelpBindingInfo = /**
     * @return {?}
     */
    function () {
        if (this._item && this._item.control) {
            /** @type {?} */
            var helpOpts = this._item.control;
            this.uri = helpOpts.uri;
            this.title = helpOpts.title;
            this.textField = helpOpts.textField;
            this.valueField = helpOpts.valueField;
            this.idField = helpOpts.idField;
            this.mapFields = helpOpts.mapFields;
            this.context = helpOpts.context;
            this.preEventCmd = helpOpts.preEventCmd;
            this.postEventCmd = helpOpts.postEventCmd;
            this.singleSelect = helpOpts.singleSelect;
            this.enableFullTree = helpOpts.enableFullTree;
            this.loadTreeDataType = helpOpts.loadTreeDataType;
            this.expandLevel = helpOpts.expandLevel;
            this.enableCascade = helpOpts.enableCascade;
            this.helpId = helpOpts.helpId;
            /** @type {?} */
            var helpValue = (this._item.value);
            // if (helpValue && helpValue.value) {
            //     // this.textValue = (this.item.value as HelpValue).value[this.textField];
            //     this.textValue = HelpValue.getPropValue(helpValue.value, this.textField.split('.'));
            // }
            this.displayType = helpOpts.displayType;
            if (helpValue.textValue == 'help-text-value-null') { // 旧数据兼容
                this.textValue = helpValue.getTextValue(this.textField);
            }
            else {
                this.textValue = helpValue.textValue;
            }
        }
        this.setSubmitChange();
    };
    /**
     * @param {?} data
     * @return {?}
     */
    PanelHelpComponent.prototype.clearData = /**
     * @param {?} data
     * @return {?}
     */
    function (data) {
        (this._item.value).clearValue();
        this.setSubmitChange();
        this.searchHandle.emit();
    };
    /**
     * @param {?} helpItem
     * @param {?} args
     * @return {?}
     */
    PanelHelpComponent.prototype.getPropValue = /**
     * @param {?} helpItem
     * @param {?} args
     * @return {?}
     */
    function (helpItem, args) {
        if (args.length > 1) {
            /** @type {?} */
            var arg = args.shift();
            return helpItem[arg] ? this.getPropValue(helpItem[arg], args) : null;
        }
        return helpItem[args[0]];
    };
    /**
     * @param {?} textField
     * @param {?} value
     * @return {?}
     */
    PanelHelpComponent.prototype.getTextValue = /**
     * @param {?} textField
     * @param {?} value
     * @return {?}
     */
    function (textField, value) {
        var _this = this;
        /** @type {?} */
        var args = textField.split('.');
        /** @type {?} */
        var textArr = value.map((/**
         * @param {?} helpItem
         * @return {?}
         */
        function (helpItem) { return _this.getPropValue(helpItem, cloneDeep(args)); }));
        return textArr && textArr.length ? textArr.join(',') : '';
    };
    /**
     * @return {?}
     */
    PanelHelpComponent.prototype.setSubmitChange = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var val = this._item.value;
        if (Object.keys(val).length < 0 || !val.value || !val.valueField) {
            this.submitChange.emit(false);
        }
        else {
            this.submitChange.emit(true);
        }
    };
    PanelHelpComponent.decorators = [
        { type: Component, args: [{
                    selector: 'panel-filter-help',
                    template: "<farris-lookup-grid\r\n    id=\"{{instanceId}}\"\r\n    [uri]=\"uri\"\r\n    [title]=\"title\"\r\n    [idField]=\"idField\" \r\n    [textField]=\"textField\" \r\n    [valueField]=\"valueField\" \r\n    [(ngModel)]=\"textValue\"\r\n    [displayType]=\"displayType\"\r\n    [editable]=\"false\"\r\n    (clear)=\"clearData($event)\"\r\n    (selectedData)=\"selectedDataHandler($event)\"\r\n    [placeholder]=\"placeholder\"\r\n    [mapFields]=\"mapFields\"\r\n    [dictPicking]=\"preEventCmd\"\r\n    [dictPicked]=\"postEventCmd\"\r\n    [context]=\"context\"\r\n    [enableFullTree]=\"enableFullTree\"\r\n    [loadTreeDataType]=\"loadTreeDataType\"\r\n    [singleSelect]=\"singleSelect\"\r\n    [expandLevel]=\"expandLevel\"\r\n    [enableCascade]=\"enableCascade\"\r\n    [useFavorite]=\"true\"\r\n>\r\n</farris-lookup-grid>"
                    // providers: [{ provide: ServerSideToken, useClass: LookupHttpBeQueryService }]
                }] }
    ];
    /** @nocollapse */
    PanelHelpComponent.ctorParameters = function () { return [
        { type: Injector }
    ]; };
    PanelHelpComponent.propDecorators = {
        item: [{ type: Input }],
        instanceId: [{ type: Input }],
        searchHandle: [{ type: Output }],
        submitChange: [{ type: Output }]
    };
    return PanelHelpComponent;
}());
export { PanelHelpComponent };
if (false) {
    /** @type {?} */
    PanelHelpComponent.prototype._item;
    /** @type {?} */
    PanelHelpComponent.prototype.instanceId;
    /** @type {?} */
    PanelHelpComponent.prototype.searchHandle;
    /** @type {?} */
    PanelHelpComponent.prototype.submitChange;
    /** @type {?} */
    PanelHelpComponent.prototype.uri;
    /** @type {?} */
    PanelHelpComponent.prototype.textField;
    /** @type {?} */
    PanelHelpComponent.prototype.idField;
    /** @type {?} */
    PanelHelpComponent.prototype.valueField;
    /** @type {?} */
    PanelHelpComponent.prototype.textValue;
    /** @type {?} */
    PanelHelpComponent.prototype.displayType;
    /** @type {?} */
    PanelHelpComponent.prototype.mapFields;
    /** @type {?} */
    PanelHelpComponent.prototype.context;
    /** @type {?} */
    PanelHelpComponent.prototype.preEventCmd;
    /** @type {?} */
    PanelHelpComponent.prototype.postEventCmd;
    /** @type {?} */
    PanelHelpComponent.prototype.enableFullTree;
    /** @type {?} */
    PanelHelpComponent.prototype.loadTreeDataType;
    /** @type {?} */
    PanelHelpComponent.prototype.singleSelect;
    /** @type {?} */
    PanelHelpComponent.prototype.expandLevel;
    /** @type {?} */
    PanelHelpComponent.prototype.enableCascade;
    /** @type {?} */
    PanelHelpComponent.prototype.placeholder;
    /** @type {?} */
    PanelHelpComponent.prototype.helpId;
    /** @type {?} */
    PanelHelpComponent.prototype.title;
    /** @type {?} */
    PanelHelpComponent.prototype.onSearch;
    /**
     * @type {?}
     * @private
     */
    PanelHelpComponent.prototype.injector;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaGVscC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL3VpLWZpbHRlci1wYW5lbC8iLCJzb3VyY2VzIjpbImxpYi9jb21wb25lbnRzL2hlbHBjb21wb25lbnQudHMvaGVscC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsS0FBSyxFQUFVLE1BQU0sRUFBRSxZQUFZLEVBQUUsUUFBUSxFQUFFLE1BQU0sZUFBZSxDQUFDOzs7QUFJekYsT0FBTyxFQUFFLEVBQUUsRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUMxQixPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sV0FBVyxDQUFDO0FBRXRDO0lBc0RJLDRCQUFvQixRQUFrQjtRQUF0QyxpQkFBMkM7UUFBdkIsYUFBUSxHQUFSLFFBQVEsQ0FBVTtRQXRCNUIsaUJBQVksR0FBRyxJQUFJLFlBQVksRUFBRSxDQUFDO1FBQ2xDLGlCQUFZLEdBQUcsSUFBSSxZQUFZLEVBQUUsQ0FBQztRQTRFNUMsYUFBUTs7O1FBQUc7WUFDUCxLQUFJLENBQUMsWUFBWSxDQUFDLElBQUksRUFBRSxDQUFDO1lBQ3pCLE9BQU8sRUFBRSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ3BCLENBQUMsRUFBQTtJQTFEeUMsQ0FBQztJQTNDM0Msc0JBQ0ksb0NBQUk7Ozs7UUFEUjtZQUVJLE9BQU8sSUFBSSxDQUFDLEtBQUssQ0FBQztRQUN0QixDQUFDOzs7OztRQUNELFVBQVMsSUFBSTtZQUNULElBQUksQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDO1lBQ2xCLElBQUksSUFBSSxDQUFDLEtBQUssQ0FBQyxXQUFXLEVBQUU7Z0JBQ3hCLElBQUksQ0FBQyxXQUFXLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxXQUFXLENBQUM7YUFDN0M7WUFDRCxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxjQUFjLENBQUMsT0FBTyxDQUFDLEVBQUU7Z0JBQ3JDLElBQUks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Q2YsbUNBQWM7O0lBeURkLHNDQUdDOzs7OztJQTFEVyxzQ0FBMEIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIElucHV0LCBPbkluaXQsIE91dHB1dCwgRXZlbnRFbWl0dGVyLCBJbmplY3RvciB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5cclxuLy8gaW1wb3J0IHsgU2VydmVyU2lkZVRva2VuIH0gZnJvbSAnQGZhcnJpcy91aS1sb29rdXAnO1xyXG4vLyBpbXBvcnQgeyBMb29rdXBIdHRwQmVRdWVyeVNlcnZpY2UgfSBmcm9tICcuL3NlcnZpY2UvTG9va3VwLWh0dHAuc2VydmljZSc7XHJcbmltcG9ydCB7IG9mIH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7IGNsb25lRGVlcCB9IGZyb20gJ2xvZGFzaC1lcyc7XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICAgIHNlbGVjdG9yOiAncGFuZWwtZmlsdGVyLWhlbHAnLFxyXG4gICAgdGVtcGxhdGVVcmw6ICcuL2hlbHAuY29tcG9uZW50Lmh0bWwnXHJcbiAgICAvLyBwcm92aWRlcnM6IFt7IHByb3ZpZGU6IFNlcnZlclNpZGVUb2tlbiwgdXNlQ2xhc3M6IExvb2t1cEh0dHBCZVF1ZXJ5U2VydmljZSB9XVxyXG59KVxyXG5cclxuZXhwb3J0IGNsYXNzIFBhbmVsSGVscENvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCB7XHJcblxyXG4gICAgLy8gQElucHV0KCkgaXRlbTphbnk7XHJcblxyXG4gICAgX2l0ZW06IGFueTtcclxuICAgIEBJbnB1dCgpXHJcbiAgICBnZXQgaXRlbSgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5faXRlbTtcclxuICAgIH1cclxuICAgIHNldCBpdGVtKGRhdGEpIHtcclxuICAgICAgICB0aGlzLl9pdGVtID0gZGF0YTtcclxuICAgICAgICBpZiAodGhpcy5faXRlbS5wbGFjZUhvbGRlcikge1xyXG4gICAgICAgICAgICB0aGlzLnBsYWNlaG9sZGVyID0gdGhpcy5faXRlbS5wbGFjZUhvbGRlcjtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKCF0aGlzLl9pdGVtLmhhc093blByb3BlcnR5KCd2YWx1ZScpKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX2l0ZW0udmFsdWUgPSB7XHJcbiAgICAgICAgICAgICAgICB2YWx1ZTogW10sXHJcbiAgICAgICAgICAgICAgICB2YWx1ZUZpZWxkOiAnJyxcclxuICAgICAgICAgICAgICAgIHRleHRWYWx1ZTogJydcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5nZXRIZWxwQmluZGluZ0luZm8oKTtcclxuICAgIH1cclxuXHJcbiAgICBASW5wdXQoKSBpbnN0YW5jZUlkOiBzdHJpbmc7XHJcblxyXG4gICAgQE91dHB1dCgpIHNlYXJjaEhhbmRsZSA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuICAgIEBPdXRwdXQoKSBzdWJtaXRDaGFuZ2UgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcblxyXG4gICAgdXJpOiBzdHJpbmc7XHJcbiAgICB0ZXh0RmllbGQ6IHN0cmluZztcclxuICAgIGlkRmllbGQ6IHN0cmluZztcclxuICAgIHZhbHVlRmllbGQ6IGFueTtcclxuICAgIHRleHRWYWx1ZTogYW55O1xyXG4gICAgZGlzcGxheVR5cGU7XHJcbiAgICBtYXBGaWVsZHM6IGFueTtcclxuICAgIGNvbnRleHQ6IGFueTtcclxuICAgIHByZUV2ZW50Q21kOiBhbnk7XHJcbiAgICBwb3N0RXZlbnRDbWQ6IGFueTtcclxuICAgIGVuYWJsZUZ1bGxUcmVlOiBib29sZWFuO1xyXG4gICAgbG9hZFRyZWVEYXRhVHlwZTogJ2RlZmF1bHQnIHwgJ2xvYWRhbGwnIHwgJ2xheWVybG9hZCc7XHJcbiAgICBzaW5nbGVTZWxlY3Q6IGJvb2xlYW47XHJcbiAgICBleHBhbmRMZXZlbDogbnVtYmVyO1xyXG4gICAgZW5hYmxlQ2FzY2FkZTogYm9vbGVhbjtcclxuICAgIHBsYWNlaG9sZGVyOiBzdHJpbmc7XHJcbiAgICBoZWxwSWQ6IHN0cmluZztcclxuICAgIHRpdGxlOiBzdHJpbmc7XHJcblxyXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBpbmplY3RvcjogSW5qZWN0b3IpIHsgfVxyXG5cclxuICAgIG5nT25Jbml0KCk6IHZvaWQge1xyXG4gICAgICAgIC8vIGlmKHRoaXMuaXRlbS5jb250cm9sICYmIHRoaXMuaXRlbS5jb250cm9sLmhhc093blByb3BlcnR5KCdwbGFjZWhvbGRlcicpKXtcclxuICAgICAgICAvLyAgICAgdGhpcy5wbGFjZWhvbGRlciA9IHRoaXMuaXRlbS5jb250cm9sLnBsYWNlaG9sZGVyO1xyXG4gICAgICAgIC8vIH1cclxuICAgICAgICAvLyB0aGlzLmdldEhlbHBCaW5kaW5nSW5mbygpO1xyXG4gICAgfVxyXG5cclxuICAgIHNlbGVjdGVkRGF0YUhhbmRsZXIoc2VsZWN0ZWRJdGVtOiBhbnkpIHtcclxuICAgICAgICBjb25zdCBoZWxwVmFsdWUgPSAodGhpcy5faXRlbS52YWx1ZSk7XHJcbiAgICAgICAgaGVscFZhbHVlLnZhbHVlID0gdGhpcy5zaW5nbGVTZWxlY3QgPyBbc2VsZWN0ZWRJdGVtXSA6IHNlbGVjdGVkSXRlbTsgLy8g5Y2V6YCJ6L+U5Zue5a+56LGh77yM5aSa6YCJ6L+U5Zue5pWw57uEXHJcbiAgICAgICAgaGVscFZhbHVlLnZhbHVlRmllbGQgPSB0aGlzLnZhbHVlRmllbGQ7XHJcbiAgICAgICAgaGVscFZhbHVlLnRleHRWYWx1ZSA9IHRoaXMuZ2V0VGV4dFZhbHVlKHRoaXMudGV4dEZpZWxkLCBoZWxwVmFsdWUudmFsdWUpO1xyXG4gICAgICAgIHRoaXMudGV4dFZhbHVlID0gaGVscFZhbHVlLnRleHRWYWx1ZTtcclxuICAgICAgICB0aGlzLl9pdGVtLnZhbHVlVGV4dCA9IHRoaXMuX2l0ZW0udmFsdWUudGV4dFZhbHVlO1xyXG4gICAgICAgIHRoaXMuc2V0U3VibWl0Q2hhbmdlKCk7XHJcbiAgICAgICAgdGhpcy5zZWFyY2hIYW5kbGUuZW1pdCgpO1xyXG4gICAgfVxyXG5cclxuICAgIGdldEhlbHBCaW5kaW5nSW5mbygpIHtcclxuICAgICAgICBpZiAodGhpcy5faXRlbSAmJiB0aGlzLl9pdGVtLmNvbnRyb2wpIHtcclxuICAgICAgICAgICAgY29uc3QgaGVscE9wdHMgPSB0aGlzLl9pdGVtLmNvbnRyb2w7XHJcbiAgICAgICAgICAgIHRoaXMudXJpID0gaGVscE9wdHMudXJpO1xyXG4gICAgICAgICAgICB0aGlzLnRpdGxlID0gaGVscE9wdHMudGl0bGU7XHJcbiAgICAgICAgICAgIHRoaXMudGV4dEZpZWxkID0gaGVscE9wdHMudGV4dEZpZWxkO1xyXG4gICAgICAgICAgICB0aGlzLnZhbHVlRmllbGQgPSBoZWxwT3B0cy52YWx1ZUZpZWxkO1xyXG4gICAgICAgICAgICB0aGlzLmlkRmllbGQgPSBoZWxwT3B0cy5pZEZpZWxkO1xyXG4gICAgICAgICAgICB0aGlzLm1hcEZpZWxkcyA9IGhlbHBPcHRzLm1hcEZpZWxkcztcclxuICAgICAgICAgICAgdGhpcy5jb250ZXh0ID0gaGVscE9wdHMuY29udGV4dDtcclxuICAgICAgICAgICAgdGhpcy5wcmVFdmVudENtZCA9IGhlbHBPcHRzLnByZUV2ZW50Q21kO1xyXG4gICAgICAgICAgICB0aGlzLnBvc3RFdmVudENtZCA9IGhlbHBPcHRzLnBvc3RFdmVudENtZDtcclxuICAgICAgICAgICAgdGhpcy5zaW5nbGVTZWxlY3QgPSBoZWxwT3B0cy5zaW5nbGVTZWxlY3Q7XHJcbiAgICAgICAgICAgIHRoaXMuZW5hYmxlRnVsbFRyZWUgPSBoZWxwT3B0cy5lbmFibGVGdWxsVHJlZTtcclxuICAgICAgICAgICAgdGhpcy5sb2FkVHJlZURhdGFUeXBlID0gaGVscE9wdHMubG9hZFRyZWVEYXRhVHlwZTtcclxuICAgICAgICAgICAgdGhpcy5leHBhbmRMZXZlbCA9IGhlbHBPcHRzLmV4cGFuZExldmVsO1xyXG4gICAgICAgICAgICB0aGlzLmVuYWJsZUNhc2NhZGUgPSBoZWxwT3B0cy5lbmFibGVDYXNjYWRlO1xyXG4gICAgICAgICAgICB0aGlzLmhlbHBJZCA9IGhlbHBPcHRzLmhlbHBJZDtcclxuICAgICAgICAgICAgY29uc3QgaGVscFZhbHVlID0gKHRoaXMuX2l0ZW0udmFsdWUpO1xyXG4gICAgICAgICAgICAvLyBpZiAoaGVscFZhbHVlICYmIGhlbHBWYWx1ZS52YWx1ZSkge1xyXG4gICAgICAgICAgICAvLyAgICAgLy8gdGhpcy50ZXh0VmFsdWUgPSAodGhpcy5pdGVtLnZhbHVlIGFzIEhlbHBWYWx1ZSkudmFsdWVbdGhpcy50ZXh0RmllbGRdO1xyXG4gICAgICAgICAgICAvLyAgICAgdGhpcy50ZXh0VmFsdWUgPSBIZWxwVmFsdWUuZ2V0UHJvcFZhbHVlKGhlbHBWYWx1ZS52YWx1ZSwgdGhpcy50ZXh0RmllbGQuc3BsaXQoJy4nKSk7XHJcbiAgICAgICAgICAgIC8vIH1cclxuICAgICAgICAgICAgdGhpcy5kaXNwbGF5VHlwZSA9IGhlbHBPcHRzLmRpc3BsYXlUeXBlO1xyXG4gICAgICAgICAgICBpZiAoaGVscFZhbHVlLnRleHRWYWx1ZSA9PSAnaGVscC10ZXh0LXZhbHVlLW51bGwnKSB7Ly8g5pen5pWw5o2u5YW85a65XHJcbiAgICAgICAgICAgICAgICB0aGlzLnRleHRWYWx1ZSA9IGhlbHBWYWx1ZS5nZXRUZXh0VmFsdWUodGhpcy50ZXh0RmllbGQpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdGhpcy50ZXh0VmFsdWUgPSBoZWxwVmFsdWUudGV4dFZhbHVlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLnNldFN1Ym1pdENoYW5nZSgpO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICBvblNlYXJjaCA9ICgpID0+IHtcclxuICAgICAgICB0aGlzLnNlYXJjaEhhbmRsZS5lbWl0KCk7XHJcbiAgICAgICAgcmV0dXJuIG9mKHRydWUpO1xyXG4gICAgfVxyXG5cclxuICAgIGNsZWFyRGF0YShkYXRhOiBhbnkpIHtcclxuICAgICAgICAodGhpcy5faXRlbS52YWx1ZSkuY2xlYXJWYWx1ZSgpO1xyXG4gICAgICAgIHRoaXMuc2V0U3VibWl0Q2hhbmdlKCk7XHJcbiAgICAgICAgdGhpcy5zZWFyY2hIYW5kbGUuZW1pdCgpO1xyXG4gICAgfVxyXG5cclxuICAgIGdldFByb3BWYWx1ZShoZWxwSXRlbTogYW55LCBhcmdzOiBBcnJheTxzdHJpbmc+KTogYW55IHtcclxuICAgICAgICBpZiAoYXJncy5sZW5ndGggPiAxKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGFyZyA9IGFyZ3Muc2hpZnQoKTtcclxuICAgICAgICAgICAgcmV0dXJuIGhlbHBJdGVtW2FyZ10gPyB0aGlzLmdldFByb3BWYWx1ZShoZWxwSXRlbVthcmddLCBhcmdzKSA6IG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBoZWxwSXRlbVthcmdzWzBdXTtcclxuICAgIH1cclxuXHJcbiAgICBnZXRUZXh0VmFsdWUodGV4dEZpZWxkOiBzdHJpbmcsIHZhbHVlKTogc3RyaW5nIHtcclxuICAgICAgICBjb25zdCBhcmdzID0gdGV4dEZpZWxkLnNwbGl0KCcuJyk7XHJcbiAgICAgICAgY29uc3QgdGV4dEFyciA9IHZhbHVlLm1hcChoZWxwSXRlbSA9PiB0aGlzLmdldFByb3BWYWx1ZShoZWxwSXRlbSwgY2xvbmVEZWVwKGFyZ3MpKSk7XHJcbiAgICAgICAgcmV0dXJuIHRleHRBcnIgJiYgdGV4dEFyci5sZW5ndGggPyB0ZXh0QXJyLmpvaW4oJywnKSA6ICcnO1xyXG4gICAgfVxyXG5cclxuICAgIHNldFN1Ym1pdENoYW5nZSgpIHtcclxuICAgICAgICBjb25zdCB2YWwgPSB0aGlzLl9pdGVtLnZhbHVlO1xyXG4gICAgICAgIGlmIChPYmplY3Qua2V5cyh2YWwpLmxlbmd0aCA8IDAgfHwgIXZhbC52YWx1ZSB8fCAhdmFsLnZhbHVlRmllbGQpIHtcclxuICAgICAgICAgICAgdGhpcy5zdWJtaXRDaGFuZ2UuZW1pdChmYWxzZSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5zdWJtaXRDaGFuZ2UuZW1pdCh0cnVlKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG59XHJcbiJdfQ==
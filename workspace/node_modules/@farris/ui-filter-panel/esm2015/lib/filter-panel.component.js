/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input, Output, EventEmitter, Renderer2, ElementRef, ViewChild, ViewEncapsulation, HostListener } from '@angular/core';
import { QuerySolutionService } from '@farris/ui-filter-condition';
import { deepCopy } from './utils';
import { IdService } from '@farris/ui-common';
import { cloneDeep } from 'lodash-es';
// 用于显示点击 简单筛选 项的下拉面板
export class FilterPanelComponent {
    /**
     * @param {?} renderer
     * @param {?} elementRef
     * @param {?} filterConditionSer
     */
    constructor(renderer, elementRef, filterConditionSer) {
        this.renderer = renderer;
        this.elementRef = elementRef;
        this.filterConditionSer = filterConditionSer;
        this._hide = false;
        this.hidePanel = new EventEmitter();
        this.submit = new EventEmitter();
        this.filterSubmit = new EventEmitter();
        this.clearFilter = new EventEmitter();
        this.dataChange = new EventEmitter();
        this.canSubmit = false;
        this.fiexedLeft = true;
        // 全局标识，初始化标识元素没有发生mousemove
        this.hasMove = false;
        this._documentMouseUpEvent = null;
        this.currentItem = null;
        this.zIndex = 1060;
        this.isNil = (/**
         * @param {?} val
         * @return {?}
         */
        (val) => val === null || val === undefined || val === '');
        this.el = this.elementRef.nativeElement;
    }
    /**
     * @param {?} val
     * @return {?}
     */
    set hide(val) {
        this._hide = val;
    }
    /**
     * @return {?}
     */
    get hide() {
        return this._hide;
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        /** @type {?} */
        const self = this;
        this._documentMouseUpEvent = this.renderer.listen(this.filterPanel.nativeElement, 'mouseup', (/**
         * @param {?} event
         * @return {?}
         */
        (event) => {
            event.stopPropagation();
            /** @type {?} */
            const tar = event.target;
            if (tar.closest('#mainContainerTabset')) {
                // self.hidePanel.emit(event);
                this.panelFilterCancel(event);
                return;
            }
            if (this.hasMove) {
                return;
            }
            if (!tar.closest('.f-filter-panel')
                && !tar.closest('.modal')
                && !tar.closest('.overlay-container') && !tar.closest('.overlay-pane')) {
                // self.hidePanel.emit(event);
                this.panelFilterCancel(event);
            }
            this.hasMove = false;
        }));
        if (this.option.item && (this.option.item.control.controltype == 'dropdown' || this.option.item.control.controltype == 'radio')) {
            this.canSubmit = true;
        }
        if (this.injector) {
            this.idService = this.injector.get(IdService);
        }
        this.currentItem = cloneDeep({ value: Object.assign({}, this.option.item.value), type: this.option.item.control.controltype, id: this.option.item.id });
    }
    /**
     * @return {?}
     */
    ngAfterViewInit() {
        /** @type {?} */
        const _panel = this.el.querySelector('.f-filter-panel');
        if (_panel && this.option.target) {
            /** @type {?} */
            const h = _panel.offsetHeight;
            /** @type {?} */
            const rect = this.option.target.getBoundingClientRect();
            if (window['innerHeight'] - this.option.top < h) {
                if (rect.top > h) {
                    this.option.top = rect.top - h - 14;
                }
                else {
                    this.option.top = 32;
                }
                /** @type {?} */
                const arrow = this.el.querySelector('.f-filter-panel-arrow');
                if (arrow) {
                    arrow.style.display = 'none';
                }
            }
        }
        if (_panel && this.option.right) {
            if (this.option.left + _panel.offsetWidth > window['innerWidth']) {
                // 超出显示在做
                this.fiexedLeft = false;
                this.option.left = this.option.right - _panel.offsetWidth;
            }
            else {
                this.fiexedLeft = true;
            }
        }
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        if (this._documentMouseUpEvent) {
            this._documentMouseUpEvent();
            this._documentMouseUpEvent = null;
        }
    }
    /**
     * @param {?} $event
     * @return {?}
     */
    onMouseDown($event) {
        this.hasMove = false;
    }
    /**
     * @param {?} $event
     * @return {?}
     */
    onMouseMove($event) {
        this.hasMove = true;
    }
    /**
     * @param {?} event
     * @return {?}
     */
    onSearch(event) {
        if (this.option.item.control.controltype == 'radio') {
            this.panelFilterSubmit();
        }
        else if (this.option.item.control.controltype == 'text' && event['type'] && event['type'] === 'enter') {
            this.panelFilterSubmit();
        }
        // this.filterItem = event;
    }
    /**
     * @param {?} $event
     * @return {?}
     */
    panelFilterCancel($event) {
        // $event._instanceId = this.id;
        this.hidePanel.emit($event);
    }
    /**
     * @param {?=} clear
     * @return {?}
     */
    panelFilterSubmit(clear = false) {
        if (!clear && !this.canSubmit) {
            return;
        }
        if (this.option.item.control.controltype === 'text') {
            /** @type {?} */
            const farrisSearchRecord = this.option.item.valueText;
            /** @type {?} */
            let farrisSearchRecordArray = [];
            /** @type {?} */
            const storagelabelCode = this.option.item.labelCode;
            /** @type {?} */
            let filterPanelArray = JSON.parse(localStorage.getItem(this.option.localStorageKey));
            if (Array.isArray(filterPanelArray)) {
                filterPanelArray = null;
            }
            if (!filterPanelArray || !filterPanelArray[storagelabelCode] || !filterPanelArray[storagelabelCode].length
                && farrisSearchRecord && farrisSearchRecord.length) {
                farrisSearchRecordArray.push(farrisSearchRecord);
            }
            else {
                farrisSearchRecordArray = filterPanelArray[storagelabelCode];
                /** @type {?} */
                const index = filterPanelArray[storagelabelCode].indexOf(farrisSearchRecord);
                if (index < 0 && farrisSearchRecord && farrisSearchRecord.length) {
                    farrisSearchRecordArray.unshift(farrisSearchRecord);
                }
                farrisSearchRecordArray = farrisSearchRecordArray.slice(0, 6);
            }
            if (filterPanelArray == null) {
                filterPanelArray = {};
            }
            filterPanelArray[storagelabelCode] = farrisSearchRecordArray;
            localStorage.setItem(this.option.localStorageKey, JSON.stringify(filterPanelArray));
        }
        /** @type {?} */
        const conditions = this.filterConditionSer.setFilterConditions(this.option.item);
        if (!clear) {
            this.filterSubmit.emit({
                item: this.option.item,
                filter: conditions
            });
        }
        this.submit.emit(this.option.item);
    }
    /**
     * @return {?}
     */
    panelFilterClear() {
        this.panelFilterempty();
        this.panelFilterSubmit(true);
        this.clearFilter.emit(this.option.item);
    }
    /**
     * @return {?}
     */
    panelFilterempty() {
        this.filterClearValue(this.option.item);
        this.option.item.valueText = '';
        this.option.item.filled = false;
        this.option.item = deepCopy(this.option.item);
        this.canSubmit = false;
    }
    /**
     * @param {?} item
     * @return {?}
     */
    filterClearValue(item) {
        switch (item.control.controltype) {
            case 'text':
            case 'search':
            case 'singleDate':
            case 'year':
            case 'month':
            case 'dropdown':
            case 'singlenumber':
            case 'radio':
                item.value.value = null;
                break;
            case 'date':
            case 'datetime':
            case 'monthRange':
            case 'yearRange':
                item.value.startTime = null;
                item.value.endTime = null;
                break;
            case 'number':
                item.value.startValue = null;
                item.value.endValue = null;
                break;
            case 'help':
                item.value.value = [];
                item.value.valueField = null;
                item.value.textValue = null;
                break;
            case 'checkboxgroup':
            case 'bool-check':
                item.value.value = [];
                break;
            case 'input-group':
                item.value.value = [];
                item.value.textValue = null;
                item.value.textField = null;
                item.value.isInputText = null;
                break;
            case 'flexibleNumber':
            case 'flexibleDate':
                item.value.startValue = null;
                item.value.endValue = null;
                item.value.value = null;
                break;
            default:
                item.value.value = null;
                break;
        }
    }
    /**
     * @param {?} event
     * @return {?}
     */
    onSubmitChange(event) {
        this.canSubmit = event;
    }
    /**
     * @param {?} value
     * @return {?}
     */
    buildSmartHelpKey(value) {
        if (this.idService) {
            /** @type {?} */
            let prefix = '';
            if (location.hash) {
                /** @type {?} */
                const pathArr = location.hash.split('?');
                prefix = pathArr ? pathArr[0] : '';
            }
            else {
                /** @type {?} */
                const pathArr = location.pathname.split('/');
                prefix = pathArr ? pathArr[pathArr.length - 1] : '';
            }
            return this.idService.encrypt(prefix + '/list-filter/' + value);
        }
        else {
            return 'list-filter/' + value;
        }
    }
    /**
     * @param {?} $event
     * @return {?}
     */
    updateCurrentItem($event) {
        this.currentItem = cloneDeep({ value: Object.assign({}, $event.value), type: $event.control.controltype, id: $event.id });
        this.dataChange.emit(this.currentItem);
    }
    /**
     * @return {?}
     */
    canClearSearch() {
        /** @type {?} */
        const item = this.currentItem;
        if (!item) {
            return true;
        }
        switch (item.type) {
            case 'text':
            case 'search':
            case 'singleDate':
            case 'year':
            case 'month':
            case 'dropdown':
            case 'singlenumber':
            case 'radio':
                return !this.isNil(item.value.value);
            case 'date':
            case 'datetime':
            case 'monthRange':
            case 'yearRange':
                return !this.isNil(item.value.startTime) || !this.isNil(item.value.endTime);
            case 'help':
            case 'checkboxgroup':
            case 'bool-check':
                return item.value.value && item.value.value.length;
            case 'input-group':
                return (item.value.value && item.value.value.length) || item.value.textValue;
            case 'number':
            case 'flexibleNumber':
            case 'flexibleDate':
                if (item.value.single) {
                    return !this.isNil(item.value.value);
                }
                return !this.isNil(item.value.startValue) || !this.isNil(item.value.endValue);
            default:
                return !this.isNil(item.value.value);
        }
    }
}
FilterPanelComponent.decorators = [
    { type: Component, args: [{
                selector: 'farris-filter-panel',
                template: "<div class=\"f-filter-panel-wrapper\" #filterPanel [ngClass]=\"{'d-none': hide}\" [style.zIndex]=\"zIndex\">\r\n    <div  [class]=\"'f-filter-panel f-filter-panel-'+(option.item && option.item.control.controltype)\"\r\n        [ngStyle]=\"{\r\n            'left': option.left > 0 ? option.left+'px' : '0px',\r\n            'top': option.top > 0 ? option.top+'px' : '0px',\r\n            'width': (option.width && option.width > 0) ? option.width+'px':'',\r\n            'height': (option.height && option.height > 0) ? option.height+'px':'',\r\n            'max-width': (option.maxWidth && option.maxWidth > 0) ? option.maxWidth+'px':'',\r\n            'max-height': (option.maxHeight && option.maxHeight > 0) ? option.maxHeight+'px':''\r\n        }\">\r\n        <div class=\"f-filter-panel-inner\" [ngClass]=\"{'f-filter-panel-inner-xs': option.item && option.item.control.controltype == 'radio','f-filter-panel-inner-auto': !option.item}\">\r\n            <div class=\"f-filter-panel-arrow\" [ngStyle]=\"{'left':fiexedLeft?'26px':'auto','right':fiexedLeft?'auto':'26px'}\"></div>\r\n            <div class=\"f-filter-panel-extend\" *ngIf=\"option.panelExtendTemplate\">\r\n                <ng-container [ngTemplateOutlet]=\"option.panelExtendTemplate\"></ng-container>\r\n            </div>\r\n            <div class=\"f-filter-panel-header\" *ngIf=\"option.showLable && option.item && option.item.control.controltype != 'radio'\">\r\n                <div class=\"panel-header-title\">\r\n                    {{ 'filterPanel.filter' | locale }}\r\n                </div>\r\n                <!-- <div class=\"panel-header-toolbar\"></div> -->\r\n            </div>\r\n            <div class=\"f-filter-panel-content\" *ngIf=\"option.item\">\r\n                <div class=\"f-filter-panel-form\">\r\n                    <ng-container [ngSwitch]=\"option.item.control.controltype\">\r\n                        <div class=\"filter-input-item filter-type-input position-relative\" *ngSwitchCase=\"'text'\">\r\n                            <panel-filter-input [item]=\"option.item\" [localStorageKey]=\"option.localStorageKey\"\r\n                                (searchHandle)=\"onSearch($event)\" (submitChange)=\"onSubmitChange($event)\" class=\"form-group farris-form-group\"></panel-filter-input>\r\n                        </div>\r\n                        <div class=\"filter-input-item filter-type-search\" *ngSwitchCase=\"'search'\">\r\n                            <panel-filter-search [item]=\"option.item\"\r\n                                (searchHandle)=\"onSearch($event)\" (submitChange)=\"onSubmitChange($event)\" class=\"form-group farris-form-group\"></panel-filter-search>\r\n                        </div>\r\n                        <div class=\"filter-input-item filter-type-date\" *ngSwitchCase=\"'singleDate'\">\r\n                            <panel-filter-date [item]=\"option.item\"\r\n                                (searchHandle)=\"onSearch($event)\" (submitChange)=\"onSubmitChange($event)\" class=\"form-group farris-form-group\"></panel-filter-date>\r\n                        </div>\r\n                        <div class=\"filter-input-item filter-type-date\" *ngSwitchCase=\"'year'\">\r\n                            <panel-filter-date [item]=\"option.item\"\r\n                                (searchHandle)=\"onSearch($event)\" class=\"form-group farris-form-group\" [showType]=\"'3'\" (submitChange)=\"onSubmitChange($event)\"></panel-filter-date>\r\n                        </div>\r\n                        <div class=\"filter-input-item filter-type-date\" *ngSwitchCase=\"'month'\">\r\n                            <panel-filter-date [item]=\"option.item\"\r\n                                (searchHandle)=\"onSearch($event)\" class=\"form-group farris-form-group\" [showType]=\"'2'\" (submitChange)=\"onSubmitChange($event)\"></panel-filter-date>\r\n                        </div>\r\n                        <div class=\"filter-input-item filter-type-date\" *ngSwitchCase=\"'date'\">\r\n                            <panel-filter-daterange [item]=\"option.item\"\r\n                                (searchHandle)=\"onSearch($event)\" class=\"form-group farris-form-group\" (submitChange)=\"onSubmitChange($event)\"></panel-filter-daterange>\r\n                        </div>\r\n                        <div class=\"filter-input-item filter-type-date\" *ngSwitchCase=\"'datetime'\">\r\n                            <panel-filter-daterange [item]=\"option.item\" [showTime]=\"true\"\r\n                                (searchHandle)=\"onSearch($event)\" class=\"form-group farris-form-group\" (submitChange)=\"onSubmitChange($event)\"></panel-filter-daterange>\r\n                        </div>\r\n                        <div class=\"filter-input-item filter-type-date\" *ngSwitchCase=\"'monthRange'\">\r\n                            <panel-filter-daterange [item]=\"option.item\"\r\n                                (searchHandle)=\"onSearch($event)\" class=\"form-group farris-form-group\" [showType]=\"'2'\" (submitChange)=\"onSubmitChange($event)\"></panel-filter-daterange>\r\n                        </div>\r\n                        <div class=\"filter-input-item filter-type-date\" *ngSwitchCase=\"'yearRange'\">\r\n                            <panel-filter-daterange [item]=\"option.item\"\r\n                                (searchHandle)=\"onSearch($event)\" class=\"form-group farris-form-group\" [showType]=\"'3'\" (submitChange)=\"onSubmitChange($event)\"></panel-filter-daterange>\r\n                        </div>\r\n                        <div class=\"filter-input-item filter-type-dropdown\" *ngSwitchCase=\"'dropdown'\">\r\n                            <panel-filter-dropdown [item]=\"option.item\"\r\n                                (searchHandle)=\"onSearch($event)\" class=\"form-group farris-form-group\"  (submitChange)=\"onSubmitChange($event)\"></panel-filter-dropdown>\r\n                        </div>\r\n                        <div class=\"filter-input-item filter-type-number\" *ngSwitchCase=\"'number'\">\r\n                            <panel-filter-number [item]=\"option.item\"\r\n                                (searchHandle)=\"onSearch($event)\" class=\"form-group farris-form-group\" (submitChange)=\"onSubmitChange($event)\"></panel-filter-number>\r\n                        </div>\r\n                        <div class=\"filter-input-item filter-type-single-number\" *ngSwitchCase=\"'singlenumber'\">\r\n                            <panel-filter-single-number [item]=\"option.item\"\r\n                                (searchHandle)=\"onSearch($event)\" class=\"form-group farris-form-group\" (submitChange)=\"onSubmitChange($event)\"></panel-filter-single-number>\r\n                        </div>\r\n                        <div class=\"filter-input-item filter-type-help\" *ngSwitchCase=\"'help'\">\r\n                            <panel-filter-help [item]=\"option.item\" [instanceId]=\"buildSmartHelpKey(option.item.fieldCode)\"\r\n                                (searchHandle)=\"onSearch($event)\" class=\"form-group farris-form-group\" (submitChange)=\"onSubmitChange($event)\"></panel-filter-help>\r\n                        </div>\r\n                        <div class=\"filter-input-item filter-type-checkboxgroup\" [class.checkboxgroup-has-search]=\"option.item.control.enableSearch\" *ngSwitchCase=\"'checkboxgroup'\">\r\n                            <panel-filter-checkbox [item]=\"option.item\"\r\n                                (searchHandle)=\"onSearch($event)\" class=\"form-group farris-form-group\"\r\n                                style=\"white-space: nowrap;\" (submitChange)=\"onSubmitChange($event)\"></panel-filter-checkbox>\r\n                        </div>\r\n                        <div class=\"filter-input-item filter-type-radio\" *ngSwitchCase=\"'radio'\">\r\n                            <panel-filter-radio [item]=\"option.item\"\r\n                                (searchHandle)=\"onSearch($event)\" class=\"form-group farris-form-group\"\r\n                                style=\"white-space: nowrap;\"></panel-filter-radio>\r\n                        </div>\r\n                        <div class=\"filter-input-item filter-type-radio\" *ngSwitchCase=\"'input-group'\">\r\n                            <panel-filter-inputgroup [item]=\"option.item\"\r\n                                (searchHandle)=\"onSearch($event)\" class=\"form-group farris-form-group\"\r\n                                style=\"white-space: nowrap;\"  (submitChange)=\"onSubmitChange($event)\"></panel-filter-inputgroup>\r\n                        </div>\r\n                        <div class=\"filter-input-item filter-type-flexiblenumber\" *ngSwitchCase=\"'flexibleNumber'\">\r\n                            <panel-filter-flexiblenumber [item]=\"option.item\" (itemChange)=\"updateCurrentItem($event)\"\r\n                                (searchHandle)=\"onSearch($event)\" class=\"form-group farris-form-group\"\r\n                                style=\"white-space: nowrap;\" (submitChange)=\"onSubmitChange($event)\"></panel-filter-flexiblenumber>\r\n                        </div>\r\n                        <div class=\"filter-input-item filter-type-flexibledate\" *ngSwitchCase=\"'flexibleDate'\">\r\n                            <panel-filter-flexibledate [item]=\"option.item\"  (itemChange)=\"updateCurrentItem($event)\"\r\n                                (searchHandle)=\"onSearch($event)\" class=\"form-group farris-form-group\"\r\n                                style=\"white-space: nowrap;\" (submitChange)=\"onSubmitChange($event)\"></panel-filter-flexibledate>\r\n                        </div>\r\n                        <div class=\"filter-input-item filter-type-boolcheck\" *ngSwitchCase=\"'bool-check'\">\r\n                            <panel-filter-checkbox [item]=\"option.item\" [boolcheck]=\"true\"\r\n                                (searchHandle)=\"onSearch($event)\" class=\"form-group farris-form-group\"\r\n                                style=\"white-space: nowrap;\" (submitChange)=\"onSubmitChange($event)\"></panel-filter-checkbox>\r\n                        </div>\r\n                        <div class=\"filter-input-item filter-type-default\" *ngSwitchDefault>\r\n                            <panel-filter-input [item]=\"option.item\" [localStorageKey]=\"option.localStorageKey\"\r\n                                (searchHandle)=\"onSearch($event)\" (submitChange)=\"onSubmitChange($event)\" class=\"form-group farris-form-group\"></panel-filter-input>\r\n                        </div>\r\n                    </ng-container>\r\n                </div>\r\n\r\n            </div>\r\n            <div class=\"f-filter-panel-footer\" *ngIf=\"option.item && option.item.control.controltype != 'radio'\">\r\n                <div class=\"filer-panel-clear\">\r\n                    <button class=\"btn btn-link\" (click)=\"panelFilterClear()\"  [disabled]=\"!canClearSearch()\">{{ 'filterPanel.reset' | locale }}</button>\r\n                    <!-- tfs 549371 2023-03-24 -->\r\n                    <!-- <button class=\"btn btn-link btn-empty\" (click)=\"panelFilterempty()\">{{ 'filterPanel.empty' | locale }}</button> -->\r\n                </div>\r\n                <div class=\"filter-panel-btns\">\r\n                    <button class=\"btn btn-secondary\" (click)=\"panelFilterCancel($event)\">{{ 'filterPanel.cancel' | locale }}</button>\r\n                    <button class=\"filter-panel-submit btn btn-primary\" (click)=\"panelFilterSubmit()\" [disabled]=\"!canSubmit\">{{ 'filterPanel.confirm' | locale }}</button>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>",
                encapsulation: ViewEncapsulation.None,
                styles: [".filter-type-checkboxgroup.checkboxgroup-has-search{padding-top:0;position:relative;}"]
            }] }
];
/** @nocollapse */
FilterPanelComponent.ctorParameters = () => [
    { type: Renderer2 },
    { type: ElementRef },
    { type: QuerySolutionService }
];
FilterPanelComponent.propDecorators = {
    option: [{ type: Input }],
    hide: [{ type: Input }],
    hidePanel: [{ type: Output }],
    submit: [{ type: Output }],
    filterSubmit: [{ type: Output }],
    clearFilter: [{ type: Output }],
    dataChange: [{ type: Output }],
    filterPanel: [{ type: ViewChild, args: ['filterPanel',] }],
    onMouseDown: [{ type: HostListener, args: ['mousedown', ['$event'],] }],
    onMouseMove: [{ type: HostListener, args: ['mousemove', ['$event'],] }]
};
if (false) {
    /**
     * @type {?}
     * @private
     */
    FilterPanelComponent.prototype.el;
    /** @type {?} */
    FilterPanelComponent.prototype.option;
    /** @type {?} */
    FilterPanelComponent.prototype._hide;
    /** @type {?} */
    FilterPanelComponent.prototype.hidePanel;
    /** @type {?} */
    FilterPanelComponent.prototype.submit;
    /** @type {?} */
    FilterPanelComponent.prototype.filterSubmit;
    /** @type {?} */
    FilterPanelComponent.prototype.clearFilter;
    /** @type {?} */
    FilterPanelComponent.prototype.dataChange;
    /** @type {?} */
    FilterPanelComponent.prototype.filterPanel;
    /** @type {?} */
    FilterPanelComponent.prototype.canSubmit;
    /** @type {?} */
    FilterPanelComponent.prototype.fiexedLeft;
    /**
     * @type {?}
     * @private
     */
    FilterPanelComponent.prototype.hasMove;
    /**
     * @type {?}
     * @private
     */
    FilterPanelComponent.prototype._documentMouseUpEvent;
    /** @type {?} */
    FilterPanelComponent.prototype.injector;
    /**
     * @type {?}
     * @private
     */
    FilterPanelComponent.prototype.idService;
    /**
     * @type {?}
     * @private
     */
    FilterPanelComponent.prototype.currentItem;
    /** @type {?} */
    FilterPanelComponent.prototype.zIndex;
    /**
     * @type {?}
     * @private
     */
    FilterPanelComponent.prototype.isNil;
    /**
     * @type {?}
     * @private
     */
    FilterPanelComponent.prototype.renderer;
    /**
     * @type {?}
     * @private
     */
    FilterPanelComponent.prototype.elementRef;
    /**
     * @type {?}
     * @private
     */
    FilterPanelComponent.prototype.filterConditionSer;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmlsdGVyLXBhbmVsLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvdWktZmlsdGVyLXBhbmVsLyIsInNvdXJjZXMiOlsibGliL2ZpbHRlci1wYW5lbC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQVUsS0FBSyxFQUFFLE1BQU0sRUFBRSxZQUFZLEVBQUUsU0FBUyxFQUMxRCxVQUFVLEVBQUUsU0FBUyxFQUFFLGlCQUFpQixFQUFFLFlBQVksRUFBNEIsTUFBTSxlQUFlLENBQUM7QUFFaEgsT0FBTyxFQUFFLG9CQUFvQixFQUFFLE1BQU0sNkJBQTZCLENBQUM7QUFDbkUsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLFNBQVMsQ0FBQztBQUNuQyxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFDOUMsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLFdBQVcsQ0FBQzs7QUFRdEMsTUFBTSxPQUFPLG9CQUFvQjs7Ozs7O0lBNEI3QixZQUFvQixRQUFtQixFQUFVLFVBQXNCLEVBQVUsa0JBQXdDO1FBQXJHLGFBQVEsR0FBUixRQUFRLENBQVc7UUFBVSxlQUFVLEdBQVYsVUFBVSxDQUFZO1FBQVUsdUJBQWtCLEdBQWxCLGtCQUFrQixDQUFzQjtRQXpCekgsVUFBSyxHQUFHLEtBQUssQ0FBQztRQVFKLGNBQVMsR0FBRyxJQUFJLFlBQVksRUFBRSxDQUFDO1FBQy9CLFdBQU0sR0FBRyxJQUFJLFlBQVksRUFBRSxDQUFDO1FBQzVCLGlCQUFZLEdBQUcsSUFBSSxZQUFZLEVBQUUsQ0FBQztRQUNsQyxnQkFBVyxHQUFHLElBQUksWUFBWSxFQUFFLENBQUM7UUFDakMsZUFBVSxHQUFHLElBQUksWUFBWSxFQUFFLENBQUM7UUFFMUMsY0FBUyxHQUFHLEtBQUssQ0FBQztRQUNsQixlQUFVLEdBQUMsSUFBSSxDQUFDOztRQUVSLFlBQU8sR0FBRyxLQUFLLENBQUM7UUFD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QUUsQ0FBQyxRQUFRLENBQUM7MEJBS3BDLFlBQVksU0FBQyxXQUFXLEVBQUUsQ0FBQyxRQUFRLENBQUM7Ozs7Ozs7SUF6R3JDLGtDQUF3Qjs7SUFDeEIsc0NBQW1DOztJQUNuQyxxQ0FBYzs7SUFRZCx5Q0FBeUM7O0lBQ3pDLHNDQUFzQzs7SUFDdEMsNENBQTRDOztJQUM1QywyQ0FBMkM7O0lBQzNDLDBDQUEwQzs7SUFDMUMsMkNBQWtEOztJQUNsRCx5Q0FBa0I7O0lBQ2xCLDBDQUFnQjs7Ozs7SUFFaEIsdUNBQXdCOzs7OztJQUN4QixxREFBcUM7O0lBQ3JDLHdDQUFTOzs7OztJQUNULHlDQUE2Qjs7Ozs7SUFDN0IsMkNBQTJCOztJQUUzQixzQ0FBYzs7Ozs7SUFpT2QscUNBQStFOzs7OztJQS9ObkUsd0NBQTJCOzs7OztJQUFFLDBDQUE4Qjs7Ozs7SUFBRSxrREFBZ0QiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIE9uSW5pdCwgSW5wdXQsIE91dHB1dCwgRXZlbnRFbWl0dGVyLCBSZW5kZXJlcjIsXHJcbiAgICAgICAgRWxlbWVudFJlZiwgVmlld0NoaWxkLCBWaWV3RW5jYXBzdWxhdGlvbiwgSG9zdExpc3RlbmVyLCBPbkRlc3Ryb3ksIEFmdGVyVmlld0luaXQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgRmlsdGVyUGFuZWxPcHRpb24gfSBmcm9tICcuL2ZpbHRlci1wYW5lbC5pbnRlcmZhY2UnO1xyXG5pbXBvcnQgeyBRdWVyeVNvbHV0aW9uU2VydmljZSB9IGZyb20gJ0BmYXJyaXMvdWktZmlsdGVyLWNvbmRpdGlvbic7XHJcbmltcG9ydCB7IGRlZXBDb3B5IH0gZnJvbSAnLi91dGlscyc7XHJcbmltcG9ydCB7IElkU2VydmljZSB9IGZyb20gJ0BmYXJyaXMvdWktY29tbW9uJztcclxuaW1wb3J0IHsgY2xvbmVEZWVwIH0gZnJvbSAnbG9kYXNoLWVzJztcclxuLy8g55So5LqO5pi+56S654K55Ye7IOeugOWNleetm+mAiSDpobnnmoTkuIvmi4npnaLmnb9cclxuQENvbXBvbmVudCh7XHJcbiAgICBzZWxlY3RvcjogJ2ZhcnJpcy1maWx0ZXItcGFuZWwnLFxyXG4gICAgdGVtcGxhdGVVcmw6ICcuL2ZpbHRlci1wYW5lbC5jb21wb25lbnQuaHRtbCcsXHJcbiAgICBlbmNhcHN1bGF0aW9uOiBWaWV3RW5jYXBzdWxhdGlvbi5Ob25lLFxyXG4gICAgc3R5bGVzOltcIi5maWx0ZXItdHlwZS1jaGVja2JveGdyb3VwLmNoZWNrYm94Z3JvdXAtaGFzLXNlYXJjaHtwYWRkaW5nLXRvcDowO3Bvc2l0aW9uOnJlbGF0aXZlO31cIl1cclxufSlcclxuZXhwb3J0IGNsYXNzIEZpbHRlclBhbmVsQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBPbkRlc3Ryb3ksIEFmdGVyVmlld0luaXQge1xyXG4gICAgcHJpdmF0ZSBlbDogSFRNTEVsZW1lbnQ7XHJcbiAgICBASW5wdXQoKSBvcHRpb246IEZpbHRlclBhbmVsT3B0aW9uO1xyXG4gICAgX2hpZGUgPSBmYWxzZTtcclxuICAgIEBJbnB1dCgpXHJcbiAgICBzZXQgaGlkZSh2YWwpIHtcclxuICAgICAgICB0aGlzLl9oaWRlID0gdmFsO1xyXG4gICAgfVxyXG4gICAgZ2V0IGhpZGUoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2hpZGU7XHJcbiAgICB9XHJcbiAgICBAT3V0cHV0KCkgaGlkZVBhbmVsID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG4gICAgQE91dHB1dCgpIHN1Ym1pdCA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuICAgIEBPdXRwdXQoKSBmaWx0ZXJTdWJtaXQgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcbiAgICBAT3V0cHV0KCkgY2xlYXJGaWx0ZXIgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcbiAgICBAT3V0cHV0KCkgZGF0YUNoYW5nZSA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuICAgIEBWaWV3Q2hpbGQoJ2ZpbHRlclBhbmVsJykgZmlsdGVyUGFuZWw6IEVsZW1lbnRSZWY7XHJcbiAgICBjYW5TdWJtaXQgPSBmYWxzZTtcclxuICAgIGZpZXhlZExlZnQ9dHJ1ZTtcclxuICAgIC8vIOWFqOWxgOagh+ivhu+8jOWIneWni+WMluagh+ivhuWFg+e0oOayoeacieWPkeeUn21vdXNlbW92ZVxyXG4gICAgcHJpdmF0ZSBoYXNNb3ZlID0gZmFsc2U7XHJcbiAgICBwcml2YXRlIF9kb2N1bWVudE1vdXNlVXBFdmVudCA9IG51bGw7XHJcbiAgICBpbmplY3RvcjtcclxuICAgIHByaXZhdGUgaWRTZXJ2aWNlOiBJZFNlcnZpY2U7XHJcbiAgICBwcml2YXRlIGN1cnJlbnRJdGVtID0gbnVsbDtcclxuXHJcbiAgICB6SW5kZXggPSAxMDYwO1xyXG4gICAgXHJcbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIHJlbmRlcmVyOiBSZW5kZXJlcjIsIHByaXZhdGUgZWxlbWVudFJlZjogRWxlbWVudFJlZiwgcHJpdmF0ZSBmaWx0ZXJDb25kaXRpb25TZXI6IFF1ZXJ5U29sdXRpb25TZXJ2aWNlKSB7XHJcbiAgICAgICAgdGhpcy5lbCA9IHRoaXMuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50O1xyXG4gICAgfVxyXG4gICAgbmdPbkluaXQoKSB7XHJcbiAgICAgICAgY29uc3Qgc2VsZiA9IHRoaXM7XHJcbiAgICAgICAgdGhpcy5fZG9jdW1lbnRNb3VzZVVwRXZlbnQgPSB0aGlzLnJlbmRlcmVyLmxpc3Rlbih0aGlzLmZpbHRlclBhbmVsLm5hdGl2ZUVsZW1lbnQsICdtb3VzZXVwJywgKGV2ZW50OiBNb3VzZUV2ZW50KSA9PiB7XHJcbiAgICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gICAgICAgICAgICBjb25zdCB0YXI6IGFueSA9IGV2ZW50LnRhcmdldDtcclxuICAgICAgICAgICAgaWYgKHRhci5jbG9zZXN0KCcjbWFpbkNvbnRhaW5lclRhYnNldCcpKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBzZWxmLmhpZGVQYW5lbC5lbWl0KGV2ZW50KTtcclxuICAgICAgICAgICAgICAgIHRoaXMucGFuZWxGaWx0ZXJDYW5jZWwoZXZlbnQpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAodGhpcy5oYXNNb3ZlKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmICghdGFyLmNsb3Nlc3QoJy5mLWZpbHRlci1wYW5lbCcpXHJcbiAgICAgICAgICAgICAgICAmJiAhdGFyLmNsb3Nlc3QoJy5tb2RhbCcpXHJcbiAgICAgICAgICAgICAgICAmJiAhdGFyLmNsb3Nlc3QoJy5vdmVybGF5LWNvbnRhaW5lcicpICYmICF0YXIuY2xvc2VzdCgnLm92ZXJsYXktcGFuZScpKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBzZWxmLmhpZGVQYW5lbC5lbWl0KGV2ZW50KTtcclxuICAgICAgICAgICAgICAgIHRoaXMucGFuZWxGaWx0ZXJDYW5jZWwoZXZlbnQpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB0aGlzLmhhc01vdmUgPSBmYWxzZTtcclxuICAgICAgICB9KTtcclxuICAgICAgICBpZiAodGhpcy5vcHRpb24uaXRlbSAmJiAodGhpcy5vcHRpb24uaXRlbS5jb250cm9sLmNvbnRyb2x0eXBlID09ICdkcm9wZG93bicgfHwgdGhpcy5vcHRpb24uaXRlbS5jb250cm9sLmNvbnRyb2x0eXBlID09ICdyYWRpbycpKSB7XHJcbiAgICAgICAgICAgIHRoaXMuY2FuU3VibWl0ID0gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYodGhpcy5pbmplY3Rvcikge1xyXG4gICAgICAgICAgICB0aGlzLmlkU2VydmljZSA9IHRoaXMuaW5qZWN0b3IuZ2V0KElkU2VydmljZSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLmN1cnJlbnRJdGVtID0gY2xvbmVEZWVwKHt2YWx1ZTogey4uLnRoaXMub3B0aW9uLml0ZW0udmFsdWV9LCB0eXBlOiB0aGlzLm9wdGlvbi5pdGVtLmNvbnRyb2wuY29udHJvbHR5cGUsIGlkOiB0aGlzLm9wdGlvbi5pdGVtLmlkfSk7XHJcbiAgICB9XHJcblxyXG4gICAgbmdBZnRlclZpZXdJbml0KCkge1xyXG4gICAgICAgIGNvbnN0IF9wYW5lbDogYW55ID0gdGhpcy5lbC5xdWVyeVNlbGVjdG9yKCcuZi1maWx0ZXItcGFuZWwnKTtcclxuICAgICAgICBpZiAoX3BhbmVsICYmIHRoaXMub3B0aW9uLnRhcmdldCkge1xyXG4gICAgICAgICAgICBjb25zdCBoID0gX3BhbmVsLm9mZnNldEhlaWdodDtcclxuICAgICAgICAgICAgY29uc3QgcmVjdCA9IHRoaXMub3B0aW9uLnRhcmdldC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcclxuICAgICAgICAgICAgaWYgKHdpbmRvd1snaW5uZXJIZWlnaHQnXSAtIHRoaXMub3B0aW9uLnRvcCA8IGgpIHtcclxuICAgICAgICAgICAgICAgIGlmIChyZWN0LnRvcCA+IGgpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLm9wdGlvbi50b3AgPSByZWN0LnRvcCAtIGggLSAxNDtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5vcHRpb24udG9wID0gMzI7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBjb25zdCBhcnJvdzogYW55ID0gdGhpcy5lbC5xdWVyeVNlbGVjdG9yKCcuZi1maWx0ZXItcGFuZWwtYXJyb3cnKTtcclxuICAgICAgICAgICAgICAgIGlmIChhcnJvdykge1xyXG4gICAgICAgICAgICAgICAgICAgIGFycm93LnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgaWYoX3BhbmVsJiZ0aGlzLm9wdGlvbi5yaWdodCl7XHJcbiAgICAgICAgICAgIGlmKHRoaXMub3B0aW9uLmxlZnQrX3BhbmVsLm9mZnNldFdpZHRoPndpbmRvd1snaW5uZXJXaWR0aCddKXtcclxuICAgICAgICAgICAgICAgIC8vIOi2heWHuuaYvuekuuWcqOWBmlxyXG4gICAgICAgICAgICAgICAgdGhpcy5maWV4ZWRMZWZ0PWZhbHNlO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5vcHRpb24ubGVmdD10aGlzLm9wdGlvbi5yaWdodC1fcGFuZWwub2Zmc2V0V2lkdGg7XHJcbiAgICAgICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICAgICAgdGhpcy5maWV4ZWRMZWZ0PXRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgbmdPbkRlc3Ryb3koKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuX2RvY3VtZW50TW91c2VVcEV2ZW50KSB7XHJcbiAgICAgICAgICAgIHRoaXMuX2RvY3VtZW50TW91c2VVcEV2ZW50KCk7XHJcbiAgICAgICAgICAgIHRoaXMuX2RvY3VtZW50TW91c2VVcEV2ZW50ID0gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG5cclxuICAgIEBIb3N0TGlzdGVuZXIoJ21vdXNlZG93bicsIFsnJGV2ZW50J10pXHJcbiAgICBvbk1vdXNlRG93bigkZXZlbnQpIHtcclxuICAgICAgICB0aGlzLmhhc01vdmUgPSBmYWxzZTtcclxuICAgIH1cclxuXHJcbiAgICBASG9zdExpc3RlbmVyKCdtb3VzZW1vdmUnLCBbJyRldmVudCddKVxyXG4gICAgb25Nb3VzZU1vdmUoJGV2ZW50KSB7XHJcbiAgICAgICAgdGhpcy5oYXNNb3ZlID0gdHJ1ZTtcclxuICAgIH1cclxuXHJcblxyXG4gICAgb25TZWFyY2goZXZlbnQpIHtcclxuICAgICAgICBpZiAodGhpcy5vcHRpb24uaXRlbS5jb250cm9sLmNvbnRyb2x0eXBlID09ICdyYWRpbycpIHtcclxuICAgICAgICAgICAgdGhpcy5wYW5lbEZpbHRlclN1Ym1pdCgpO1xyXG4gICAgICAgIH1lbHNlIGlmKHRoaXMub3B0aW9uLml0ZW0uY29udHJvbC5jb250cm9sdHlwZSA9PSAndGV4dCcgJiYgIGV2ZW50Wyd0eXBlJ10gJiYgZXZlbnRbJ3R5cGUnXSA9PT0gJ2VudGVyJyl7XHJcbiAgICAgICAgICAgIHRoaXMucGFuZWxGaWx0ZXJTdWJtaXQoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gdGhpcy5maWx0ZXJJdGVtID0gZXZlbnQ7XHJcbiAgICB9XHJcblxyXG4gICAgcGFuZWxGaWx0ZXJDYW5jZWwoJGV2ZW50KSB7XHJcbiAgICAgICAgLy8gJGV2ZW50Ll9pbnN0YW5jZUlkID0gdGhpcy5pZDtcclxuICAgICAgICB0aGlzLmhpZGVQYW5lbC5lbWl0KCRldmVudCk7XHJcbiAgICB9XHJcbiAgICBwYW5lbEZpbHRlclN1Ym1pdChjbGVhcjogYm9vbGVhbiA9IGZhbHNlKSB7XHJcbiAgICAgICAgaWYgKCFjbGVhciAmJiAhdGhpcy5jYW5TdWJtaXQpIHtyZXR1cm47IH1cclxuICAgICAgICBpZiAodGhpcy5vcHRpb24uaXRlbS5jb250cm9sLmNvbnRyb2x0eXBlID09PSAndGV4dCcpIHtcclxuICAgICAgICAgICAgY29uc3QgZmFycmlzU2VhcmNoUmVjb3JkID0gdGhpcy5vcHRpb24uaXRlbS52YWx1ZVRleHQ7XHJcbiAgICAgICAgICAgIGxldCBmYXJyaXNTZWFyY2hSZWNvcmRBcnJheSA9IFtdO1xyXG4gICAgICAgICAgICBjb25zdCBzdG9yYWdlbGFiZWxDb2RlID0gdGhpcy5vcHRpb24uaXRlbS5sYWJlbENvZGU7XHJcbiAgICAgICAgICAgIGxldCBmaWx0ZXJQYW5lbEFycmF5ID0gSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2UuZ2V0SXRlbSh0aGlzLm9wdGlvbi5sb2NhbFN0b3JhZ2VLZXkpKTtcclxuICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoZmlsdGVyUGFuZWxBcnJheSkpIHtcclxuICAgICAgICAgICAgICAgIGZpbHRlclBhbmVsQXJyYXkgPSBudWxsO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICghZmlsdGVyUGFuZWxBcnJheSB8fCAhZmlsdGVyUGFuZWxBcnJheVtzdG9yYWdlbGFiZWxDb2RlXSB8fCAhZmlsdGVyUGFuZWxBcnJheVtzdG9yYWdlbGFiZWxDb2RlXS5sZW5ndGhcclxuICAgICAgICAgICAgICAgICAgICAmJiBmYXJyaXNTZWFyY2hSZWNvcmQgJiYgZmFycmlzU2VhcmNoUmVjb3JkLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgZmFycmlzU2VhcmNoUmVjb3JkQXJyYXkucHVzaChmYXJyaXNTZWFyY2hSZWNvcmQpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgZmFycmlzU2VhcmNoUmVjb3JkQXJyYXkgPSBmaWx0ZXJQYW5lbEFycmF5W3N0b3JhZ2VsYWJlbENvZGVdO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgaW5kZXggPSBmaWx0ZXJQYW5lbEFycmF5W3N0b3JhZ2VsYWJlbENvZGVdLmluZGV4T2YoZmFycmlzU2VhcmNoUmVjb3JkKTtcclxuICAgICAgICAgICAgICAgIGlmIChpbmRleCA8IDAgJiYgZmFycmlzU2VhcmNoUmVjb3JkICYmIGZhcnJpc1NlYXJjaFJlY29yZC5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICBmYXJyaXNTZWFyY2hSZWNvcmRBcnJheS51bnNoaWZ0KGZhcnJpc1NlYXJjaFJlY29yZCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBmYXJyaXNTZWFyY2hSZWNvcmRBcnJheSA9IGZhcnJpc1NlYXJjaFJlY29yZEFycmF5LnNsaWNlKDAsIDYpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChmaWx0ZXJQYW5lbEFycmF5ID09IG51bGwpIHsgZmlsdGVyUGFuZWxBcnJheSA9IHt9OyB9XHJcbiAgICAgICAgICAgIGZpbHRlclBhbmVsQXJyYXlbc3RvcmFnZWxhYmVsQ29kZV0gPSBmYXJyaXNTZWFyY2hSZWNvcmRBcnJheTtcclxuICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0odGhpcy5vcHRpb24ubG9jYWxTdG9yYWdlS2V5LCBKU09OLnN0cmluZ2lmeShmaWx0ZXJQYW5lbEFycmF5KSk7XHJcblxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgY29uZGl0aW9ucyA9IHRoaXMuZmlsdGVyQ29uZGl0aW9uU2VyLnNldEZpbHRlckNvbmRpdGlvbnModGhpcy5vcHRpb24uaXRlbSk7XHJcbiAgICAgICAgaWYgKCFjbGVhcikge1xyXG4gICAgICAgICAgICB0aGlzLmZpbHRlclN1Ym1pdC5lbWl0KHtcclxuICAgICAgICAgICAgICAgIGl0ZW06IHRoaXMub3B0aW9uLml0ZW0sXHJcbiAgICAgICAgICAgICAgICBmaWx0ZXI6IGNvbmRpdGlvbnNcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuc3VibWl0LmVtaXQodGhpcy5vcHRpb24uaXRlbSk7XHJcbiAgICB9XHJcblxyXG4gICAgcGFuZWxGaWx0ZXJDbGVhcigpIHtcclxuICAgICAgICB0aGlzLnBhbmVsRmlsdGVyZW1wdHkoKTtcclxuICAgICAgICB0aGlzLnBhbmVsRmlsdGVyU3VibWl0KHRydWUpO1xyXG4gICAgICAgIHRoaXMuY2xlYXJGaWx0ZXIuZW1pdCh0aGlzLm9wdGlvbi5pdGVtKTtcclxuICAgIH1cclxuICAgIHBhbmVsRmlsdGVyZW1wdHkoKSB7XHJcbiAgICAgICAgdGhpcy5maWx0ZXJDbGVhclZhbHVlKHRoaXMub3B0aW9uLml0ZW0pO1xyXG4gICAgICAgIHRoaXMub3B0aW9uLml0ZW0udmFsdWVUZXh0ID0gJyc7XHJcbiAgICAgICAgdGhpcy5vcHRpb24uaXRlbS5maWxsZWQgPSBmYWxzZTtcclxuICAgICAgICB0aGlzLm9wdGlvbi5pdGVtID0gZGVlcENvcHkodGhpcy5vcHRpb24uaXRlbSk7XHJcbiAgICAgICAgdGhpcy5jYW5TdWJtaXQgPSBmYWxzZTtcclxuICAgIH1cclxuXHJcbiAgICBmaWx0ZXJDbGVhclZhbHVlKGl0ZW0pIHtcclxuICAgICAgICBzd2l0Y2ggKGl0ZW0uY29udHJvbC5jb250cm9sdHlwZSkge1xyXG4gICAgICAgICAgICBjYXNlICd0ZXh0JzpcclxuICAgICAgICAgICAgY2FzZSAnc2VhcmNoJzpcclxuICAgICAgICAgICAgY2FzZSAnc2luZ2xlRGF0ZSc6XHJcbiAgICAgICAgICAgIGNhc2UgJ3llYXInOlxyXG4gICAgICAgICAgICBjYXNlICdtb250aCc6XHJcbiAgICAgICAgICAgIGNhc2UgJ2Ryb3Bkb3duJzpcclxuICAgICAgICAgICAgY2FzZSAnc2luZ2xlbnVtYmVyJzpcclxuICAgICAgICAgICAgY2FzZSAncmFkaW8nOlxyXG4gICAgICAgICAgICAgICAgaXRlbS52YWx1ZS52YWx1ZSA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSAnZGF0ZSc6XHJcbiAgICAgICAgICAgIGNhc2UgJ2RhdGV0aW1lJzpcclxuICAgICAgICAgICAgY2FzZSAnbW9udGhSYW5nZSc6XHJcbiAgICAgICAgICAgIGNhc2UgJ3llYXJSYW5nZSc6XHJcbiAgICAgICAgICAgICAgICBpdGVtLnZhbHVlLnN0YXJ0VGltZSA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICBpdGVtLnZhbHVlLmVuZFRpbWUgPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgJ251bWJlcic6XHJcbiAgICAgICAgICAgICAgICBpdGVtLnZhbHVlLnN0YXJ0VmFsdWUgPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgaXRlbS52YWx1ZS5lbmRWYWx1ZSA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSAnaGVscCc6XHJcbiAgICAgICAgICAgICAgICBpdGVtLnZhbHVlLnZhbHVlID0gW107XHJcbiAgICAgICAgICAgICAgICBpdGVtLnZhbHVlLnZhbHVlRmllbGQgPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgaXRlbS52YWx1ZS50ZXh0VmFsdWUgPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgJ2NoZWNrYm94Z3JvdXAnOlxyXG4gICAgICAgICAgICBjYXNlICdib29sLWNoZWNrJzpcclxuICAgICAgICAgICAgICAgIGl0ZW0udmFsdWUudmFsdWUgPSBbXTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlICdpbnB1dC1ncm91cCc6XHJcbiAgICAgICAgICAgICAgICBpdGVtLnZhbHVlLnZhbHVlID0gW107XHJcbiAgICAgICAgICAgICAgICBpdGVtLnZhbHVlLnRleHRWYWx1ZSA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICBpdGVtLnZhbHVlLnRleHRGaWVsZCA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICBpdGVtLnZhbHVlLmlzSW5wdXRUZXh0ID0gbnVsbDtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlICdmbGV4aWJsZU51bWJlcic6XHJcbiAgICAgICAgICAgIGNhc2UgJ2ZsZXhpYmxlRGF0ZSc6XHJcbiAgICAgICAgICAgICAgICBpdGVtLnZhbHVlLnN0YXJ0VmFsdWUgPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgaXRlbS52YWx1ZS5lbmRWYWx1ZSA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICBpdGVtLnZhbHVlLnZhbHVlID0gbnVsbDtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgIGl0ZW0udmFsdWUudmFsdWUgPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIG9uU3VibWl0Q2hhbmdlKGV2ZW50KSB7XHJcbiAgICAgICAgdGhpcy5jYW5TdWJtaXQgPSBldmVudDtcclxuICAgIH1cclxuXHJcbiAgICBidWlsZFNtYXJ0SGVscEtleSh2YWx1ZTogc3RyaW5nKSB7XHJcbiAgICAgICAgaWYodGhpcy5pZFNlcnZpY2UpIHtcclxuICAgICAgICAgICAgbGV0IHByZWZpeCA9ICcnO1xyXG4gICAgICAgICAgICBpZiAobG9jYXRpb24uaGFzaCkge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgcGF0aEFyciA9IGxvY2F0aW9uLmhhc2guc3BsaXQoJz8nKTtcclxuICAgICAgICAgICAgICAgIHByZWZpeCA9IHBhdGhBcnIgPyBwYXRoQXJyWzBdIDogJyc7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBwYXRoQXJyICA9IGxvY2F0aW9uLnBhdGhuYW1lLnNwbGl0KCcvJyk7XHJcbiAgICAgICAgICAgICAgICBwcmVmaXggPSBwYXRoQXJyID8gcGF0aEFycltwYXRoQXJyLmxlbmd0aCAtIDFdIDogJyc7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuaWRTZXJ2aWNlLmVuY3J5cHQocHJlZml4ICsgJy9saXN0LWZpbHRlci8nICsgdmFsdWUpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiAnbGlzdC1maWx0ZXIvJyArIHZhbHVlO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICB1cGRhdGVDdXJyZW50SXRlbSgkZXZlbnQpIHtcclxuICAgICAgICB0aGlzLmN1cnJlbnRJdGVtID0gY2xvbmVEZWVwKHt2YWx1ZTogey4uLiRldmVudC52YWx1ZX0sIHR5cGU6ICRldmVudC5jb250cm9sLmNvbnRyb2x0eXBlLCBpZDogJGV2ZW50LmlkfSk7XHJcbiAgICAgICAgdGhpcy5kYXRhQ2hhbmdlLmVtaXQodGhpcy5jdXJyZW50SXRlbSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBpc05pbCA9ICh2YWw6IGFueSkgPT4gdmFsID09PSBudWxsICB8fCB2YWwgPT09IHVuZGVmaW5lZCB8fCB2YWwgPT09ICcnO1xyXG5cclxuICAgIGNhbkNsZWFyU2VhcmNoKCkge1xyXG4gICAgICAgIGNvbnN0IGl0ZW0gPSB0aGlzLmN1cnJlbnRJdGVtO1xyXG4gICAgICAgIGlmICghaXRlbSkge1xyXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgc3dpdGNoIChpdGVtLnR5cGUpIHtcclxuICAgICAgICAgICAgY2FzZSAndGV4dCc6XHJcbiAgICAgICAgICAgIGNhc2UgJ3NlYXJjaCc6XHJcbiAgICAgICAgICAgIGNhc2UgJ3NpbmdsZURhdGUnOlxyXG4gICAgICAgICAgICBjYXNlICd5ZWFyJzpcclxuICAgICAgICAgICAgY2FzZSAnbW9udGgnOlxyXG4gICAgICAgICAgICBjYXNlICdkcm9wZG93bic6XHJcbiAgICAgICAgICAgIGNhc2UgJ3NpbmdsZW51bWJlcic6XHJcbiAgICAgICAgICAgIGNhc2UgJ3JhZGlvJzpcclxuICAgICAgICAgICAgICAgIHJldHVybiAhdGhpcy5pc05pbChpdGVtLnZhbHVlLnZhbHVlKTtcclxuICAgICAgICAgICAgY2FzZSAnZGF0ZSc6XHJcbiAgICAgICAgICAgIGNhc2UgJ2RhdGV0aW1lJzpcclxuICAgICAgICAgICAgY2FzZSAnbW9udGhSYW5nZSc6XHJcbiAgICAgICAgICAgIGNhc2UgJ3llYXJSYW5nZSc6XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gIXRoaXMuaXNOaWwoaXRlbS52YWx1ZS5zdGFydFRpbWUpIHx8ICF0aGlzLmlzTmlsKGl0ZW0udmFsdWUuZW5kVGltZSk7XHJcbiAgICAgICAgICAgIGNhc2UgJ2hlbHAnOlxyXG4gICAgICAgICAgICBjYXNlICdjaGVja2JveGdyb3VwJzpcclxuICAgICAgICAgICAgY2FzZSAnYm9vbC1jaGVjayc6XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gaXRlbS52YWx1ZS52YWx1ZSAmJiBpdGVtLnZhbHVlLnZhbHVlLmxlbmd0aDtcclxuICAgICAgICAgICAgY2FzZSAnaW5wdXQtZ3JvdXAnOlxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIChpdGVtLnZhbHVlLnZhbHVlICYmIGl0ZW0udmFsdWUudmFsdWUubGVuZ3RoKSB8fCBpdGVtLnZhbHVlLnRleHRWYWx1ZTtcclxuICAgICAgICAgICAgY2FzZSAnbnVtYmVyJzpcclxuICAgICAgICAgICAgY2FzZSAnZmxleGlibGVOdW1iZXInOlxyXG4gICAgICAgICAgICBjYXNlICdmbGV4aWJsZURhdGUnOlxyXG4gICAgICAgICAgICAgICAgaWYgKGl0ZW0udmFsdWUuc2luZ2xlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICF0aGlzLmlzTmlsKGl0ZW0udmFsdWUudmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuICF0aGlzLmlzTmlsKGl0ZW0udmFsdWUuc3RhcnRWYWx1ZSkgfHwgIXRoaXMuaXNOaWwoaXRlbS52YWx1ZS5lbmRWYWx1ZSk7XHJcbiAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gIXRoaXMuaXNOaWwoaXRlbS52YWx1ZS52YWx1ZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbiJdfQ==
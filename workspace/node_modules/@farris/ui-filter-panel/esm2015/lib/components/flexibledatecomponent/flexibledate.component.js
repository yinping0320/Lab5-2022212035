/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input, EventEmitter, Output, ViewChild } from '@angular/core';
import { FarrisDatepickerComponent } from '@farris/ui-datepicker';
import { LocaleService } from '@farris/ui-locale';
import { getLastNumMonth, getToday } from '../daterangecomponent/utils';
export class PanelFlexibleDateComponent {
    /**
     * @param {?} localeService
     */
    constructor(localeService) {
        this.localeService = localeService;
        this.itemChange = new EventEmitter();
        this.searchHandle = new EventEmitter();
        this.submitChange = new EventEmitter();
        this.canNull = true;
        this.date = new Date();
        this.dateTags = [];
        this.dayTags = [];
    }
    /**
     * @param {?} nr
     * @return {?}
     */
    set item(nr) {
        this._item = nr;
        if (this._item) {
            if (!this._item.hasOwnProperty('value')) {
                this._item.value = {
                    startValue: null,
                    endValue: null,
                    value: null,
                    single: true
                };
            }
            if (!this._item.control.hasOwnProperty('single')) {
                this._item.control.single = true;
            }
            this.beginPlaceHolder = (this._item.hasOwnProperty('beginPlaceHolder') && this._item.beginPlaceHolder) ? this._item.beginPlaceHolder : this.localeService.getValue('filterPanel.dateBeginPlaceHolder');
            this.endPlaceHolder = (this._item.hasOwnProperty('endPlaceHolder') && this._item.beginPlaceHolder) ? this._item.endPlaceHolder : this.localeService.getValue('filterPanel.dateEndPlaceHolder');
            this.placeholder = (this._item.hasOwnProperty('placeHolder') && this._item.placeHolder) ? this._item.placeHolder : '';
            this.single = this._item.control.single;
            this.showTime = (this._item.control.hasOwnProperty('showTime') && this._item.control.showTime) ? this._item.control.showTime : '';
            this.showType = (this._item.control.hasOwnProperty('showType') && this._item.control.showType) ? this._item.control.showType : '';
            /** @type {?} */
            let itemDateFormat = this._item.control.format;
            if (this.showTime && itemDateFormat) {
                if (itemDateFormat.length > 0 && itemDateFormat.indexOf('HH:mm') == -1) {
                    itemDateFormat = itemDateFormat + ' HH:mm:ss';
                }
            }
            /** @type {?} */
            const format = this.showTime ? 'yyyy-MM-dd HH:mm:ss' : (this.showType == '2' ? 'yyyy-MM' : (this.showType == '3' ? 'yyyy' : 'yyyy-MM-dd'));
            this.dateFormat = itemDateFormat ? itemDateFormat : format;
        }
        this.activedDateTagId = '';
        this.activedDayTagId = '';
        this.constructMultiFieldDateRange(nr.value);
        this.dateSubmitChange();
    }
    /**
     * @return {?}
     */
    get item() {
        return this._item;
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.dateTags = [
            {
                id: 'tag1',
                text: this.localeService.getValue('filterPanel.last1Month')
            },
            {
                id: 'tag2',
                text: this.localeService.getValue('filterPanel.last3Month')
            },
            {
                id: 'tag3',
                text: this.localeService.getValue('filterPanel.last6Month')
            }
        ];
        this.dayTags = [
            {
                id: 'yesterday',
                text: this.localeService.getValue('filterPanel.yesterday')
            },
            {
                id: 'today',
                text: this.localeService.getValue('filterPanel.today')
            }
        ];
    }
    /**
     * @param {?} value
     * @return {?}
     */
    constructMultiFieldDateRange(value) {
        if (this.single) {
            this.value = value.value == null ? null : value.value;
        }
        else {
            this.startValue = value.startValue == null ? null : value.startValue;
            this.endValue = value.endValue == null ? null : value.endValue;
        }
    }
    /**
     * @param {?} event
     * @return {?}
     */
    onDateChange(event) {
        this._item.value.value = event.returnFormatted ? event.returnFormatted : null;
        this._item.valueText = event.formatted;
        this.activedDateTagId = '';
        this.activedDayTagId = '';
        this.searchHandle.emit(event);
        this.dateSubmitChange();
    }
    /**
     * @param {?} event
     * @return {?}
     */
    beginValueChange(event) {
        this._item.value.startValue = event.returnFormatted ? event.returnFormatted : null;
        this._item.value.startValueText = event.formatted;
        this.activedDateTagId = '';
        this.activedDayTagId = '';
        this.setValueText();
        this.dateSubmitChange();
    }
    /**
     * @param {?} event
     * @return {?}
     */
    endValueChange(event) {
        this._item.value.endValue = event.returnFormatted ? event.returnFormatted : null;
        this._item.value.endValueText = event.formatted;
        this.activedDateTagId = '';
        this.activedDayTagId = '';
        this.setValueText();
        this.dateSubmitChange();
    }
    /**
     * @return {?}
     */
    setValueText() {
        if (Object.keys(this._item.value).length === 0 || (!this._item.value.startValue && !this._item.value.endValue)) {
            this._item.valueText = '';
        }
        else if (!this._item.value.startValueText) {
            this._item.valueText = '~' + this._item.value.endValueText;
        }
        else if (!this._item.value.endValueText) {
            this._item.valueText = this._item.value.startValueText + '~';
        }
        else {
            this._item.valueText = this._item.value.startValueText + '~' + this._item.value.endValueText;
        }
    }
    /**
     * @return {?}
     */
    dateSubmitChange() {
        /** @type {?} */
        const val = this._item.value;
        if (this.single) {
            if (Object.keys(val).length < 0 || !val.value) {
                this.submitChange.emit(false);
            }
            else {
                this.submitChange.emit(true);
            }
        }
        else {
            if (Object.keys(val).length === 0 || (!val.startValue && !val.endValue)) {
                this.submitChange.emit(false);
            }
            else {
                this.submitChange.emit(true);
            }
        }
    }
    /**
     * @param {?} event
     * @return {?}
     */
    onChange(event) {
        this.single = !event;
        this._item.control.single = this.single;
        this._item.value.single = this.single;
        this.itemChange.emit(this.item);
        this.dateSubmitChange();
    }
    /**
     * @param {?} tag
     * @return {?}
     */
    clickTag(tag) {
        this.activedDateTagId = tag.id;
        /** @type {?} */
        let tagDate;
        if (tag.id == 'tag1') {
            tagDate = getLastNumMonth(1, this.showTime, this.showType);
        }
        else if (tag.id == 'tag2') {
            tagDate = getLastNumMonth(3, this.showTime, this.showType);
        }
        else if (tag.id == 'tag3') {
            tagDate = getLastNumMonth(6, this.showTime, this.showType);
        }
        this._item.value.startValue = tagDate['startTime'];
        this._item.value.endValue = tagDate['endTime'];
        this._item.value.startValueText = this.datepickerEle.dateTo(new Date(this._item.value.startValue));
        this._item.value.endValueText = this.datepickerEle.dateTo(new Date(this._item.value.endValue));
        this.startValue = this._item.value.startValue;
        this.endValue = this._item.value.endValue;
        this.setValueText();
        this.dateSubmitChange();
    }
    /**
     * @param {?} tag
     * @return {?}
     */
    clickDayTag(tag) {
        this.activedDayTagId = tag.id;
        /** @type {?} */
        let dayTag = getToday(this.activedDayTagId, this.showTime);
        this._item.value.value = dayTag;
        this.value = this._item.value.value;
        this._item.valueText = this.datepickerEle.dateTo(new Date(this._item.value.value));
        this.dateSubmitChange();
    }
}
PanelFlexibleDateComponent.decorators = [
    { type: Component, args: [{
                selector: 'panel-filter-flexibledate',
                template: "<div class=\"f-panel-filter-tip\">\r\n    <span class=\"panel-filter-tip-text\">{{ 'filterPanel.intervalFilter' | locale }}</span>\r\n    <farris-switch size=\"small\" [checked]=\"!single\" (valueChange)=\"onChange($event)\"></farris-switch>\r\n</div>\r\n<div class=\"f-panel-filter-content\">\r\n    <ng-container *ngIf=\"single; else elseTemplate\">\r\n        <ng-container *ngIf=\"showTime;else singleDefaultdate\">\r\n            <farris-datepicker [(ngModel)]=\"value\" [editable]=\"false\" [returnFormat]=\"'yyyy-MM-dd HH:mm:ss'\" [dateFormat]=\"dateFormat\" (valueChange)=\"onDateChange($event)\" [placeholder]=\"placeholder\" [showTime]=\"showTime\" #datepicker></farris-datepicker>\r\n        </ng-container>\r\n        <ng-template #singleDefaultdate>\r\n            <farris-datepicker [(ngModel)]=\"value\" [editable]=\"false\" [returnFormat]=\"showType == '2'? 'yyyy-MM': (showType == '3'? 'yyyy':'yyyy-MM-dd')\" [dateFormat]=\"dateFormat\" (valueChange)=\"onDateChange($event)\" [placeholder]=\"placeholder\" [showType]=\"showType\" #datepicker></farris-datepicker>\r\n        </ng-template>\r\n    </ng-container>\r\n    <ng-template #elseTemplate>\r\n        <div class=\"d-flex panel-flexible-range-wrapper\">\r\n            <ng-container *ngIf=\"showTime;else startDefaultdate\">\r\n                <farris-datepicker [(ngModel)]=\"startValue\" [editable]=\"false\" [returnFormat]=\"'yyyy-MM-dd HH:mm:ss'\" [dateFormat]=\"dateFormat\" (valueChange)=\"beginValueChange($event)\" [placeholder]=\"beginPlaceHolder\" [showTime]=\"showTime\" [maxDate]=\"endValue\" #datepicker></farris-datepicker>\r\n            </ng-container>\r\n            <ng-template #startDefaultdate>\r\n                <farris-datepicker [(ngModel)]=\"startValue\" [editable]=\"false\" [returnFormat]=\"showType == '2'? 'yyyy-MM': (showType == '3'? 'yyyy':'yyyy-MM-dd')\" [dateFormat]=\"dateFormat\" (valueChange)=\"beginValueChange($event)\" [placeholder]=\"beginPlaceHolder\" [showType]=\"showType\" [maxDate]=\"endValue\" #datepicker></farris-datepicker>\r\n            </ng-template>\r\n            <span class=\"f-icon f-icon-orientation-arrow\"></span>\r\n            <ng-container *ngIf=\"showTime;else endDefaultdate\">\r\n                <farris-datepicker [(ngModel)]=\"endValue\" [editable]=\"false\" [returnFormat]=\"'yyyy-MM-dd HH:mm:ss'\" [dateFormat]=\"dateFormat\" (valueChange)=\"endValueChange($event)\" [placeholder]=\"endPlaceHolder\" [showTime]=\"showTime\" [minDate]=\"startValue\" #datepicker></farris-datepicker>\r\n            </ng-container>\r\n            <ng-template #endDefaultdate>\r\n                <farris-datepicker [(ngModel)]=\"endValue\" [editable]=\"false\" [returnFormat]=\"showType == '2'? 'yyyy-MM': (showType == '3'? 'yyyy':'yyyy-MM-dd')\" [dateFormat]=\"dateFormat\" (valueChange)=\"endValueChange($event)\" [placeholder]=\"endPlaceHolder\" [showType]=\"showType\" [minDate]=\"startValue\" #datepicker></farris-datepicker>\r\n            </ng-template>\r\n        </div>\r\n    </ng-template>\r\n\r\n</div>\r\n<div class=\"f-filter-panel-date-tags\" *ngIf=\"!single && showType !== '3'\">\r\n    <div class=\"panel-date-tag\" \r\n    *ngFor=\"let tag of dateTags\" \r\n    (click)=\"clickTag(tag)\"\r\n    [ngClass]=\"{'active': tag.id == activedDateTagId}\"\r\n    >\r\n        {{tag.text}}\r\n    </div>\r\n</div>\r\n\r\n<div class=\"f-filter-panel-date-tags\" *ngIf=\"single && showType !== '3' && showType !== '2'\">\r\n    <div class=\"panel-date-tag\" \r\n    *ngFor=\"let day of dayTags\" \r\n    (click)=\"clickDayTag(day)\"\r\n    [ngClass]=\"{'active': day.id == activedDayTagId}\"\r\n    >\r\n        {{day.text}}\r\n    </div>\r\n</div>"
            }] }
];
/** @nocollapse */
PanelFlexibleDateComponent.ctorParameters = () => [
    { type: LocaleService }
];
PanelFlexibleDateComponent.propDecorators = {
    itemChange: [{ type: Output }],
    searchHandle: [{ type: Output, args: ['searchHandle',] }],
    submitChange: [{ type: Output, args: ['submitChange',] }],
    datepickerEle: [{ type: ViewChild, args: ['datepicker',] }],
    item: [{ type: Input }]
};
if (false) {
    /** @type {?} */
    PanelFlexibleDateComponent.prototype.itemChange;
    /** @type {?} */
    PanelFlexibleDateComponent.prototype.searchHandle;
    /** @type {?} */
    PanelFlexibleDateComponent.prototype.submitChange;
    /** @type {?} */
    PanelFlexibleDateComponent.prototype.datepickerEle;
    /** @type {?} */
    PanelFlexibleDateComponent.prototype.canNull;
    /** @type {?} */
    PanelFlexibleDateComponent.prototype.placeholder;
    /** @type {?} */
    PanelFlexibleDateComponent.prototype.beginPlaceHolder;
    /** @type {?} */
    PanelFlexibleDateComponent.prototype.endPlaceHolder;
    /** @type {?} */
    PanelFlexibleDateComponent.prototype.single;
    /** @type {?} */
    PanelFlexibleDateComponent.prototype.showTime;
    /** @type {?} */
    PanelFlexibleDateComponent.prototype.showType;
    /** @type {?} */
    PanelFlexibleDateComponent.prototype.dateFormat;
    /** @type {?} */
    PanelFlexibleDateComponent.prototype.value;
    /** @type {?} */
    PanelFlexibleDateComponent.prototype.startValue;
    /** @type {?} */
    PanelFlexibleDateComponent.prototype.endValue;
    /** @type {?} */
    PanelFlexibleDateComponent.prototype.date;
    /** @type {?} */
    PanelFlexibleDateComponent.prototype.dateTags;
    /** @type {?} */
    PanelFlexibleDateComponent.prototype.dayTags;
    /** @type {?} */
    PanelFlexibleDateComponent.prototype.activedDateTagId;
    /** @type {?} */
    PanelFlexibleDateComponent.prototype.activedDayTagId;
    /** @type {?} */
    PanelFlexibleDateComponent.prototype._item;
    /**
     * @type {?}
     * @private
     */
    PanelFlexibleDateComponent.prototype.localeService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmxleGlibGVkYXRlLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvdWktZmlsdGVyLXBhbmVsLyIsInNvdXJjZXMiOlsibGliL2NvbXBvbmVudHMvZmxleGlibGVkYXRlY29tcG9uZW50L2ZsZXhpYmxlZGF0ZS5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsS0FBSyxFQUFVLFlBQVksRUFBRSxNQUFNLEVBQUUsU0FBUyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzFGLE9BQU8sRUFBRSx5QkFBeUIsRUFBRSxNQUFNLHVCQUF1QixDQUFDO0FBQ2xFLE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUNsRCxPQUFPLEVBQUUsZUFBZSxFQUFFLFFBQVEsRUFBRSxNQUFNLDZCQUE2QixDQUFDO0FBT3hFLE1BQU0sT0FBTywwQkFBMEI7Ozs7SUE4RG5DLFlBQW9CLGFBQTRCO1FBQTVCLGtCQUFhLEdBQWIsYUFBYSxDQUFlO1FBN0R0QyxlQUFVLEdBQUcsSUFBSSxZQUFZLEVBQUUsQ0FBQztRQUNsQixpQkFBWSxHQUFHLElBQUksWUFBWSxFQUFFLENBQUM7UUFDbEMsaUJBQVksR0FBRyxJQUFJLFlBQVksRUFBRSxDQUFDO1FBRTFELFlBQU8sR0FBWSxJQUFJLENBQUM7UUFZeEIsU0FBSSxHQUFHLElBQUksSUFBSSxFQUFFLENBQUM7UUFDbEIsYUFBUSxHQUFHLEVBQUUsQ0FBQztRQUNkLFlBQU8sR0FBRyxFQUFFLENBQUM7SUEyQ3VDLENBQUM7Ozs7O0lBdENyRCxJQUNJLElBQUksQ0FBQyxFQUFPO1FBQ1osSUFBSSxDQUFDLEtBQUssR0FBRyxFQUFFLENBQUM7UUFDaEIsSUFBSSxJQUFJLENBQUMsS0FBSyxFQUFFO1lBQ1osSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsY0FBYyxDQUFDLE9BQU8sQ0FBQyxFQUFFO2dCQUNyQyxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssR0FBRztvQkFDZixVQUFVLEVBQUUsSUFBSTtvQkFDaEIsUUFBUSxFQUFFLElBQUk7b0JBQ2QsS0FBSyxFQUFFLElBQUk7b0JBQ1gsTUFBTSxFQUFFLElBQUk7aUJBQ2YsQ0FBQTthQUNKO1lBQ0QsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLGNBQWMsQ0FBQyxRQUFRLENBQUMsRUFBRTtnQkFDOUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQzthQUNwQztZQUNELElBQUksQ0FBQyxnQkFBZ0IsR0FBRyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsY0FBYyxDQUFDLGtCQUFrQixDQUFDLElBQUksSUFBSSxDQUFDLEtBQUssQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLGdCQUFnQixDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLFFBQVEsQ0FBQyxrQ0FBa0MsQ0FBQyxDQUFDO1lBQ3ZNLElBQUksQ0FBQyxjQUFjLEdBQUcsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLGNBQWMsQ0FBQyxnQkFBZ0IsQ0FBQyxJQUFJLElBQUksQ0FBQyxLQUFLLENBQUMsZ0JBQWdCLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxjQUFjLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsUUFBUSxDQUFDLGdDQUFnQyxDQUFDLENBQUM7WUFDL0wsSUFBSSxDQUFDLFdBQVcsR0FBRyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsY0FBYyxDQUFDLGFBQWEsQ0FBQyxJQUFJLElBQUksQ0FBQyxLQUFLLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUM7WUFDdEgsSUFBSSxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUM7WUFDeEMsSUFBSSxDQUFDLFFBQVEsR0FBRyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLGNBQWMsQ0FBQyxVQUFVLENBQUMsSUFBSSxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUM7WUFDbEksSUFBSSxDQUFDLFFBQVEsR0FBRyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLGNBQWMsQ0FBQyxVQUFVLENBQUMsSUFBSSxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUM7O2dCQUM5SCxjQUFjLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsTUFBTTtZQUM5QyxJQUFJLElBQUksQ0FBQyxRQUFRLElBQUksY0FBYyxFQUFFO2dCQUNqQyxJQUFJLGNBQWMsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxJQUFJLGNBQWMsQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDLEVBQUU7b0JBQ3BFLGNBQWMsR0FBRyxjQUFjLEdBQUcsV0FBVyxDQUFDO2lCQUNqRDthQUNKOztrQkFDSyxNQUFNLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMscUJBQXFCLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLFFBQVEsSUFBSSxHQUFHLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsUUFBUSxJQUFJLEdBQUcsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxZQUFZLENBQUMsQ0FBQztZQUMxSSxJQUFJLENBQUMsVUFBVSxHQUFHLGNBQWMsQ0FBQyxDQUFDLENBQUMsY0FBYyxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUM7U0FDOUQ7UUFDRCxJQUFJLENBQUMsZ0JBQWdCLEdBQUcsRUFBRSxDQUFDO1FBQzNCLElBQUksQ0FBQyxlQUFlLEdBQUcsRUFBRSxDQUFDO1FBQzFCLElBQUksQ0FBQyw0QkFBNEIsQ0FBQyxFQUFFLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDNUMsSUFBSSxDQUFDLGdCQUFnQixFQUFFLENBQUM7SUFDNUIsQ0FBQzs7OztJQUNELElBQUksSUFBSTtRQUNKLE9BQU8sSUFBSSxDQUFDLEtBQUssQ0FBQztJQUN0QixDQUFDOzs7O0lBR0QsUUFBUTtRQUNKLElBQUksQ0FBQyxRQUFRLEdBQUc7WUFDWjtnQkFDSSxFQUFFLEVBQUUsTUFBTTtnQkFDVixJQUFJLEVBQUUsSUFBSSxDQUFDLGFBQWEsQ0FBQyxRQUFRLENBQUMsd0JBQXdCLENBQUM7YUFDOUQ7WUFDRDtnQkFDSSxFQUFFLEVBQUUsTUFBTTtnQkFDVixJQUFJLEVBQUUsSUFBSSxDQUFDLGFBQWEsQ0FBQyxRQUFRLENBQUMsd0JBQXdCLENBQUM7YUFDOUQ7WUFDRDtnQkFDSSxFQUFFLEVBQUUsTUFBTTtnQkFDVixJQUFJLEVBQUUsSUFBSSxDQUFDLGFBQWEsQ0FBQyxRQUFRLENBQUMsd0JBQXdCLENBQUM7YUFDOUQ7U0FDSixDQUFDO1FBQ0YsSUFBSSxDQUFDLE9BQU8sR0FBRztZQUNYO2dCQUNJLEVBQUUsRUFBRSxXQUFXO2dCQUNmLElBQUksRUFBRSxJQUFJLENBQUMsYUFBYSxDQUFDLFFBQVEsQ0FBQyx1QkFBdUIsQ0FBQzthQUM3RDtZQUNEO2dCQUNJLEVBQUUsRUFBRSxPQUFPO2dCQUNYLElBQUksRUFBRSxJQUFJLENBQUMsYUFBYSxDQUFDLFFBQVEsQ0FBQyxtQkFBbUIsQ0FBQzthQUN6RDtTQUNKLENBQUM7SUFDTixDQUFDOzs7OztJQUNELDRCQUE0QixDQUFDLEtBQUs7UUFDOUIsSUFBSSxJQUFJLENBQUMsTUFBTSxFQUFFO1lBQ2IsSUFBSSxDQUFDLEtBQUssR0FBRyxLQUFLLENBQUMsS0FBSyxJQUFJLElBQUksQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDO1NBQ3pEO2FBQ0k7WUFDRCxJQUFJLENBQUMsVUFBVSxHQUFHLEtBQUssQ0FBQyxVQUFVLElBQUksSUFBSSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxVQUFVLENBQUM7WUFDckUsSUFBSSxDQUFDLFFBQVEsR0FBRyxLQUFLLENBQUMsUUFBUSxJQUFJLElBQUksQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDO1NBQ2xFO0lBQ0wsQ0FBQzs7Ozs7SUFFRCxZQUFZLENBQUMsS0FBVTtRQUNuQixJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxLQUFLLEdBQUcsS0FBSyxDQUFDLGVBQWUsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLGVBQWUsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDO1FBQzlFLElBQUksQ0FBQyxLQUFLLENBQUMsU0FBUyxHQUFHLEtBQUssQ0FBQyxTQUFTLENBQUM7UUFDdkMsSUFBSSxDQUFDLGdCQUFnQixHQUFHLEVBQUUsQ0FBQztRQUMzQixJQUFJLENBQUMsZUFBZSxHQUFHLEVBQUUsQ0FBQztRQUMxQixJQUFJLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUM5QixJQUFJLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQztJQUM1QixDQUFDOzs7OztJQUVELGdCQUFnQixDQUFDLEtBQUs7UUFDbEIsSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsVUFBVSxHQUFHLEtBQUssQ0FBQyxlQUFlLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxlQUFlLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQztRQUNuRixJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxjQUFjLEdBQUcsS0FBSyxDQUFDLFNBQVMsQ0FBQztRQUNsRCxJQUFJLENBQUMsZ0JBQWdCLEdBQUcsRUFBRSxDQUFDO1FBQzNCLElBQUksQ0FBQyxlQUFlLEdBQUcsRUFBRSxDQUFDO1FBQzFCLElBQUksQ0FBQyxZQUFZLEVBQUUsQ0FBQztRQUNwQixJQUFJLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQztJQUM1QixDQUFDOzs7OztJQUVELGNBQWMsQ0FBQyxLQUFLO1FBQ2hCLElBQUksQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLFFBQVEsR0FBRyxLQUFLLENBQUMsZUFBZSxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsZUFBZSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUM7UUFDakYsSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsWUFBWSxHQUFHLEtBQUssQ0FBQyxTQUFTLENBQUM7UUFDaEQsSUFBSSxDQUFDLGdCQUFnQixHQUFHLEVBQUUsQ0FBQztRQUMzQixJQUFJLENBQUMsZUFBZSxHQUFHLEVBQUUsQ0FBQztRQUMxQixJQUFJLENBQUMsWUFBWSxFQUFFLENBQUM7UUFDcEIsSUFBSSxDQUFDLGdCQUFnQixFQUFFLENBQUM7SUFDNUIsQ0FBQzs7OztJQUVELFlBQVk7UUFDUixJQUFJLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQyxNQUFNLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxVQUFVLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUMsRUFBRTtZQUM1RyxJQUFJLENBQUMsS0FBSyxDQUFDLFNBQVMsR0FBRyxFQUFFLENBQUE7U0FDNUI7YUFDSSxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsY0FBYyxFQUFFO1lBQ3ZDLElBQUksQ0FBQyxLQUFLLENBQUMsU0FBUyxHQUFHLEdBQUcsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxZQUFZLENBQUM7U0FDOUQ7YUFDSSxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsWUFBWSxFQUFFO1lBQ3JDLElBQUksQ0FBQyxLQUFLLENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLGNBQWMsR0FBRyxHQUFHLENBQUM7U0FDaEU7YUFDSTtZQUNELElBQUksQ0FBQyxLQUFLLENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLGNBQWMsR0FBRyxHQUFHLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsWUFBWSxDQUFDO1NBQ2hHO0lBQ0wsQ0FBQzs7OztJQUVELGdCQUFnQjs7Y0FDTixHQUFHLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLO1FBQzVCLElBQUksSUFBSSxDQUFDLE1BQU0sRUFBRTtZQUNiLElBQUksTUFBTSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLEtBQUssRUFBRTtnQkFDM0MsSUFBSSxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7YUFDakM7aUJBQ0k7Z0JBQ0QsSUFBSSxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7YUFDaEM7U0FDSjthQUNJO1lBQ0QsSUFBSSxNQUFNLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLE1BQU0sS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDLEdBQUcsQ0FBQyxVQUFVLElBQUksQ0FBQyxHQUFHLENBQUMsUUFBUSxDQUFDLEVBQUU7Z0JBQ3JFLElBQUksQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO2FBQ2pDO2lCQUNJO2dCQUNELElBQUksQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO2FBQ2hDO1NBQ0o7SUFDTCxDQUFDOzs7OztJQUVELFFBQVEsQ0FBQyxLQUFLO1FBQ1YsSUFBSSxDQUFDLE1BQU0sR0FBRyxDQUFDLEtBQUssQ0FBQztRQUNyQixJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQztRQUN4QyxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQztRQUN0QyxJQUFJLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDaEMsSUFBSSxDQUFDLGdCQUFnQixFQUFFLENBQUM7SUFDNUIsQ0FBQzs7Ozs7SUFHRCxRQUFRLENBQUMsR0FBRztRQUNSLElBQUksQ0FBQyxnQkFBZ0IsR0FBRyxHQUFHLENBQUMsRUFBRSxDQUFDOztZQUMzQixPQUFPO1FBQ1gsSUFBSSxHQUFHLENBQUMsRUFBRSxJQUFJLE1BQU0sRUFBRTtZQUNsQixPQUFPLEdBQUcsZUFBZSxDQUFDLENBQUMsRUFBRSxJQUFJLENBQUMsUUFBUSxFQUFFLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQztTQUM5RDthQUNJLElBQUksR0FBRyxDQUFDLEVBQUUsSUFBSSxNQUFNLEVBQUU7WUFDdkIsT0FBTyxHQUFHLGVBQWUsQ0FBQyxDQUFDLEVBQUUsSUFBSSxDQUFDLFFBQVEsRUFBRSxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7U0FDOUQ7YUFDSSxJQUFJLEdBQUcsQ0FBQyxFQUFFLElBQUksTUFBTSxFQUFFO1lBQ3ZCLE9BQU8sR0FBRyxlQUFlLENBQUMsQ0FBQyxFQUFFLElBQUksQ0FBQyxRQUFRLEVBQUUsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1NBQzlEO1FBQ0QsSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsVUFBVSxHQUFHLE9BQU8sQ0FBQyxXQUFXLENBQUMsQ0FBQztRQUNuRCxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxRQUFRLEdBQUcsT0FBTyxDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBQy9DLElBQUksQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLGNBQWMsR0FBRyxJQUFJLENBQUMsYUFBYSxDQUFDLE1BQU0sQ0FBQyxJQUFJLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDO1FBQ25HLElBQUksQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLFlBQVksR0FBRyxJQUFJLENBQUMsYUFBYSxDQUFDLE1BQU0sQ0FBQyxJQUFJLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDO1FBQy9GLElBQUksQ0FBQyxVQUFVLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsVUFBVSxDQUFDO1FBQzlDLElBQUksQ0FBQyxRQUFRLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDO1FBQzFDLElBQUksQ0FBQyxZQUFZLEVBQUUsQ0FBQztRQUNwQixJQUFJLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQztJQUM1QixDQUFDOzs7OztJQUVELFdBQVcsQ0FBQyxHQUFHO1FBQ1gsSUFBSSxDQUFDLGVBQWUsR0FBRyxHQUFHLENBQUMsRUFBRSxDQUFDOztZQUMxQixNQUFNLEdBQUcsUUFBUSxDQUFDLElBQUksQ0FBQyxlQUFlLEVBQUUsSUFBSSxDQUFDLFFBQVEsQ0FBQztRQUMxRCxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxLQUFLLEdBQUcsTUFBTSxDQUFDO1FBQ2hDLElBQUksQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDO1FBQ3BDLElBQUksQ0FBQyxLQUFLLENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQyxhQUFhLENBQUMsTUFBTSxDQUFDLElBQUksSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7UUFDbkYsSUFBSSxDQUFDLGdCQUFnQixFQUFFLENBQUM7SUFDNUIsQ0FBQzs7O1lBN01KLFNBQVMsU0FBQztnQkFDUCxRQUFRLEVBQUUsMkJBQTJCO2dCQUNyQyw2bUhBQTRDO2FBQy9DOzs7O1lBTlEsYUFBYTs7O3lCQVNqQixNQUFNOzJCQUNOLE1BQU0sU0FBQyxjQUFjOzJCQUNyQixNQUFNLFNBQUMsY0FBYzs0QkFDckIsU0FBUyxTQUFDLFlBQVk7bUJBb0J0QixLQUFLOzs7O0lBdkJOLGdEQUEwQzs7SUFDMUMsa0RBQTBEOztJQUMxRCxrREFBMEQ7O0lBQzFELG1EQUFrRTs7SUFDbEUsNkNBQXdCOztJQUV4QixpREFBb0I7O0lBQ3BCLHNEQUF5Qjs7SUFDekIsb0RBQXVCOztJQUN2Qiw0Q0FBZ0I7O0lBQ2hCLDhDQUFrQjs7SUFDbEIsOENBQWlCOztJQUNqQixnREFBbUI7O0lBQ25CLDJDQUFZOztJQUNaLGdEQUFpQjs7SUFDakIsOENBQWU7O0lBQ2YsMENBQWtCOztJQUNsQiw4Q0FBYzs7SUFDZCw2Q0FBYTs7SUFDYixzREFBaUI7O0lBQ2pCLHFEQUFnQjs7SUFFaEIsMkNBQVc7Ozs7O0lBdUNDLG1EQUFvQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgSW5wdXQsIE9uSW5pdCwgRXZlbnRFbWl0dGVyLCBPdXRwdXQsIFZpZXdDaGlsZCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBGYXJyaXNEYXRlcGlja2VyQ29tcG9uZW50IH0gZnJvbSAnQGZhcnJpcy91aS1kYXRlcGlja2VyJztcclxuaW1wb3J0IHsgTG9jYWxlU2VydmljZSB9IGZyb20gJ0BmYXJyaXMvdWktbG9jYWxlJztcclxuaW1wb3J0IHsgZ2V0TGFzdE51bU1vbnRoLCBnZXRUb2RheSB9IGZyb20gJy4uL2RhdGVyYW5nZWNvbXBvbmVudC91dGlscyc7XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICAgIHNlbGVjdG9yOiAncGFuZWwtZmlsdGVyLWZsZXhpYmxlZGF0ZScsXHJcbiAgICB0ZW1wbGF0ZVVybDogJy4vZmxleGlibGVkYXRlLmNvbXBvbmVudC5odG1sJ1xyXG59KVxyXG5cclxuZXhwb3J0IGNsYXNzIFBhbmVsRmxleGlibGVEYXRlQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcclxuICAgIEBPdXRwdXQoKSBpdGVtQ2hhbmdlID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG4gICAgQE91dHB1dCgnc2VhcmNoSGFuZGxlJykgc2VhcmNoSGFuZGxlID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG4gICAgQE91dHB1dCgnc3VibWl0Q2hhbmdlJykgc3VibWl0Q2hhbmdlID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG4gICAgQFZpZXdDaGlsZCgnZGF0ZXBpY2tlcicpIGRhdGVwaWNrZXJFbGU6IEZhcnJpc0RhdGVwaWNrZXJDb21wb25lbnQ7XHJcbiAgICBjYW5OdWxsOiBib29sZWFuID0gdHJ1ZTtcclxuXHJcbiAgICBwbGFjZWhvbGRlcjogc3RyaW5nO1xyXG4gICAgYmVnaW5QbGFjZUhvbGRlcjogc3RyaW5nO1xyXG4gICAgZW5kUGxhY2VIb2xkZXI6IHN0cmluZztcclxuICAgIHNpbmdsZTogYm9vbGVhbjsvL+aYr+WQpuS4uuWNleaXpeacn1xyXG4gICAgc2hvd1RpbWU6IGJvb2xlYW47Ly/mmK/lkKbmmL7npLrml7bpl7RcclxuICAgIHNob3dUeXBlOiBzdHJpbmc7Ly/mmL7npLrnsbvlnotcclxuICAgIGRhdGVGb3JtYXQ6IHN0cmluZzsvL+agvOW8j1xyXG4gICAgdmFsdWU6IERhdGU7XHJcbiAgICBzdGFydFZhbHVlOiBEYXRlO1xyXG4gICAgZW5kVmFsdWU6IERhdGU7XHJcbiAgICBkYXRlID0gbmV3IERhdGUoKTtcclxuICAgIGRhdGVUYWdzID0gW107XHJcbiAgICBkYXlUYWdzID0gW107XHJcbiAgICBhY3RpdmVkRGF0ZVRhZ0lkO1xyXG4gICAgYWN0aXZlZERheVRhZ0lkO1xyXG5cclxuICAgIF9pdGVtOiBhbnk7XHJcbiAgICBASW5wdXQoKVxyXG4gICAgc2V0IGl0ZW0obnI6IGFueSkge1xyXG4gICAgICAgIHRoaXMuX2l0ZW0gPSBucjtcclxuICAgICAgICBpZiAodGhpcy5faXRlbSkge1xyXG4gICAgICAgICAgICBpZiAoIXRoaXMuX2l0ZW0uaGFzT3duUHJvcGVydHkoJ3ZhbHVlJykpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuX2l0ZW0udmFsdWUgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc3RhcnRWYWx1ZTogbnVsbCxcclxuICAgICAgICAgICAgICAgICAgICBlbmRWYWx1ZTogbnVsbCxcclxuICAgICAgICAgICAgICAgICAgICB2YWx1ZTogbnVsbCxcclxuICAgICAgICAgICAgICAgICAgICBzaW5nbGU6IHRydWVcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoIXRoaXMuX2l0ZW0uY29udHJvbC5oYXNPd25Qcm9wZXJ0eSgnc2luZ2xlJykpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuX2l0ZW0uY29udHJvbC5zaW5nbGUgPSB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMuYmVnaW5QbGFjZUhvbGRlciA9ICh0aGlzLl9pdGVtLmhhc093blByb3BlcnR5KCdiZWdpblBsYWNlSG9sZGVyJykgJiYgdGhpcy5faXRlbS5iZWdpblBsYWNlSG9sZGVyKSA/IHRoaXMuX2l0ZW0uYmVnaW5QbGFjZUhvbGRlciA6IHRoaXMubG9jYWxlU2VydmljZS5nZXRWYWx1ZSgnZmlsdGVyUGFuZWwuZGF0ZUJlZ2luUGxhY2VIb2xkZXInKTtcclxuICAgICAgICAgICAgdGhpcy5lbmRQbGFjZUhvbGRlciA9ICh0aGlzLl9pdGVtLmhhc093blByb3BlcnR5KCdlbmRQbGFjZUhvbGRlcicpICYmIHRoaXMuX2l0ZW0uYmVnaW5QbGFjZUhvbGRlcikgPyB0aGlzLl9pdGVtLmVuZFBsYWNlSG9sZGVyIDogdGhpcy5sb2NhbGVTZXJ2aWNlLmdldFZhbHVlKCdmaWx0ZXJQYW5lbC5kYXRlRW5kUGxhY2VIb2xkZXInKTtcclxuICAgICAgICAgICAgdGhpcy5wbGFjZWhvbGRlciA9ICh0aGlzLl9pdGVtLmhhc093blByb3BlcnR5KCdwbGFjZUhvbGRlcicpICYmIHRoaXMuX2l0ZW0ucGxhY2VIb2xkZXIpID8gdGhpcy5faXRlbS5wbGFjZUhvbGRlciA6ICcnO1xyXG4gICAgICAgICAgICB0aGlzLnNpbmdsZSA9IHRoaXMuX2l0ZW0uY29udHJvbC5zaW5nbGU7XHJcbiAgICAgICAgICAgIHRoaXMuc2hvd1RpbWUgPSAodGhpcy5faXRlbS5jb250cm9sLmhhc093blByb3BlcnR5KCdzaG93VGltZScpICYmIHRoaXMuX2l0ZW0uY29udHJvbC5zaG93VGltZSkgPyB0aGlzLl9pdGVtLmNvbnRyb2wuc2hvd1RpbWUgOiAnJztcclxuICAgICAgICAgICAgdGhpcy5zaG93VHlwZSA9ICh0aGlzLl9pdGVtLmNvbnRyb2wuaGFzT3duUHJvcGVydHkoJ3Nob3dUeXBlJykgJiYgdGhpcy5faXRlbS5jb250cm9sLnNob3dUeXBlKSA/IHRoaXMuX2l0ZW0uY29udHJvbC5zaG93VHlwZSA6ICcnO1xyXG4gICAgICAgICAgICBsZXQgaXRlbURhdGVGb3JtYXQgPSB0aGlzLl9pdGVtLmNvbnRyb2wuZm9ybWF0O1xyXG4gICAgICAgICAgICBpZiAodGhpcy5zaG93VGltZSAmJiBpdGVtRGF0ZUZvcm1hdCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKGl0ZW1EYXRlRm9ybWF0Lmxlbmd0aCA+IDAgJiYgaXRlbURhdGVGb3JtYXQuaW5kZXhPZignSEg6bW0nKSA9PSAtMSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGl0ZW1EYXRlRm9ybWF0ID0gaXRlbURhdGVGb3JtYXQgKyAnIEhIOm1tOnNzJztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjb25zdCBmb3JtYXQgPSB0aGlzLnNob3dUaW1lID8gJ3l5eXktTU0tZGQgSEg6bW06c3MnIDogKHRoaXMuc2hvd1R5cGUgPT0gJzInID8gJ3l5eXktTU0nIDogKHRoaXMuc2hvd1R5cGUgPT0gJzMnID8gJ3l5eXknIDogJ3l5eXktTU0tZGQnKSk7XHJcbiAgICAgICAgICAgIHRoaXMuZGF0ZUZvcm1hdCA9IGl0ZW1EYXRlRm9ybWF0ID8gaXRlbURhdGVGb3JtYXQgOiBmb3JtYXQ7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuYWN0aXZlZERhdGVUYWdJZCA9ICcnO1xyXG4gICAgICAgIHRoaXMuYWN0aXZlZERheVRhZ0lkID0gJyc7XHJcbiAgICAgICAgdGhpcy5jb25zdHJ1Y3RNdWx0aUZpZWxkRGF0ZVJhbmdlKG5yLnZhbHVlKTtcclxuICAgICAgICB0aGlzLmRhdGVTdWJtaXRDaGFuZ2UoKTtcclxuICAgIH1cclxuICAgIGdldCBpdGVtKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9pdGVtO1xyXG4gICAgfVxyXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBsb2NhbGVTZXJ2aWNlOiBMb2NhbGVTZXJ2aWNlKSB7IH1cclxuXHJcbiAgICBuZ09uSW5pdCgpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLmRhdGVUYWdzID0gW1xyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpZDogJ3RhZzEnLFxyXG4gICAgICAgICAgICAgICAgdGV4dDogdGhpcy5sb2NhbGVTZXJ2aWNlLmdldFZhbHVlKCdmaWx0ZXJQYW5lbC5sYXN0MU1vbnRoJylcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaWQ6ICd0YWcyJyxcclxuICAgICAgICAgICAgICAgIHRleHQ6IHRoaXMubG9jYWxlU2VydmljZS5nZXRWYWx1ZSgnZmlsdGVyUGFuZWwubGFzdDNNb250aCcpXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGlkOiAndGFnMycsXHJcbiAgICAgICAgICAgICAgICB0ZXh0OiB0aGlzLmxvY2FsZVNlcnZpY2UuZ2V0VmFsdWUoJ2ZpbHRlclBhbmVsLmxhc3Q2TW9udGgnKVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgXTtcclxuICAgICAgICB0aGlzLmRheVRhZ3MgPSBbXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGlkOiAneWVzdGVyZGF5JyxcclxuICAgICAgICAgICAgICAgIHRleHQ6IHRoaXMubG9jYWxlU2VydmljZS5nZXRWYWx1ZSgnZmlsdGVyUGFuZWwueWVzdGVyZGF5JylcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaWQ6ICd0b2RheScsXHJcbiAgICAgICAgICAgICAgICB0ZXh0OiB0aGlzLmxvY2FsZVNlcnZpY2UuZ2V0VmFsdWUoJ2ZpbHRlclBhbmVsLnRvZGF5JylcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIF07XHJcbiAgICB9XHJcbiAgICBjb25zdHJ1Y3RNdWx0aUZpZWxkRGF0ZVJhbmdlKHZhbHVlKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuc2luZ2xlKSB7XHJcbiAgICAgICAgICAgIHRoaXMudmFsdWUgPSB2YWx1ZS52YWx1ZSA9PSBudWxsID8gbnVsbCA6IHZhbHVlLnZhbHVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5zdGFydFZhbHVlID0gdmFsdWUuc3RhcnRWYWx1ZSA9PSBudWxsID8gbnVsbCA6IHZhbHVlLnN0YXJ0VmFsdWU7XHJcbiAgICAgICAgICAgIHRoaXMuZW5kVmFsdWUgPSB2YWx1ZS5lbmRWYWx1ZSA9PSBudWxsID8gbnVsbCA6IHZhbHVlLmVuZFZhbHVlO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBvbkRhdGVDaGFuZ2UoZXZlbnQ6IGFueSkge1xyXG4gICAgICAgIHRoaXMuX2l0ZW0udmFsdWUudmFsdWUgPSBldmVudC5yZXR1cm5Gb3JtYXR0ZWQgPyBldmVudC5yZXR1cm5Gb3JtYXR0ZWQgOiBudWxsO1xyXG4gICAgICAgIHRoaXMuX2l0ZW0udmFsdWVUZXh0ID0gZXZlbnQuZm9ybWF0dGVkO1xyXG4gICAgICAgIHRoaXMuYWN0aXZlZERhdGVUYWdJZCA9ICcnO1xyXG4gICAgICAgIHRoaXMuYWN0aXZlZERheVRhZ0lkID0gJyc7XHJcbiAgICAgICAgdGhpcy5zZWFyY2hIYW5kbGUuZW1pdChldmVudCk7XHJcbiAgICAgICAgdGhpcy5kYXRlU3VibWl0Q2hhbmdlKCk7XHJcbiAgICB9XHJcblxyXG4gICAgYmVnaW5WYWx1ZUNoYW5nZShldmVudCkge1xyXG4gICAgICAgIHRoaXMuX2l0ZW0udmFsdWUuc3RhcnRWYWx1ZSA9IGV2ZW50LnJldHVybkZvcm1hdHRlZCA/IGV2ZW50LnJldHVybkZvcm1hdHRlZCA6IG51bGw7XHJcbiAgICAgICAgdGhpcy5faXRlbS52YWx1ZS5zdGFydFZhbHVlVGV4dCA9IGV2ZW50LmZvcm1hdHRlZDtcclxuICAgICAgICB0aGlzLmFjdGl2ZWREYXRlVGFnSWQgPSAnJztcclxuICAgICAgICB0aGlzLmFjdGl2ZWREYXlUYWdJZCA9ICcnO1xyXG4gICAgICAgIHRoaXMuc2V0VmFsdWVUZXh0KCk7XHJcbiAgICAgICAgdGhpcy5kYXRlU3VibWl0Q2hhbmdlKCk7XHJcbiAgICB9XHJcblxyXG4gICAgZW5kVmFsdWVDaGFuZ2UoZXZlbnQpIHtcclxuICAgICAgICB0aGlzLl9pdGVtLnZhbHVlLmVuZFZhbHVlID0gZXZlbnQucmV0dXJuRm9ybWF0dGVkID8gZXZlbnQucmV0dXJuRm9ybWF0dGVkIDogbnVsbDtcclxuICAgICAgICB0aGlzLl9pdGVtLnZhbHVlLmVuZFZhbHVlVGV4dCA9IGV2ZW50LmZvcm1hdHRlZDtcclxuICAgICAgICB0aGlzLmFjdGl2ZWREYXRlVGFnSWQgPSAnJztcclxuICAgICAgICB0aGlzLmFjdGl2ZWREYXlUYWdJZCA9ICcnO1xyXG4gICAgICAgIHRoaXMuc2V0VmFsdWVUZXh0KCk7XHJcbiAgICAgICAgdGhpcy5kYXRlU3VibWl0Q2hhbmdlKCk7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0VmFsdWVUZXh0KCkge1xyXG4gICAgICAgIGlmIChPYmplY3Qua2V5cyh0aGlzLl9pdGVtLnZhbHVlKS5sZW5ndGggPT09IDAgfHwgKCF0aGlzLl9pdGVtLnZhbHVlLnN0YXJ0VmFsdWUgJiYgIXRoaXMuX2l0ZW0udmFsdWUuZW5kVmFsdWUpKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX2l0ZW0udmFsdWVUZXh0ID0gJydcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAoIXRoaXMuX2l0ZW0udmFsdWUuc3RhcnRWYWx1ZVRleHQpIHtcclxuICAgICAgICAgICAgdGhpcy5faXRlbS52YWx1ZVRleHQgPSAnficgKyB0aGlzLl9pdGVtLnZhbHVlLmVuZFZhbHVlVGV4dDtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAoIXRoaXMuX2l0ZW0udmFsdWUuZW5kVmFsdWVUZXh0KSB7XHJcbiAgICAgICAgICAgIHRoaXMuX2l0ZW0udmFsdWVUZXh0ID0gdGhpcy5faXRlbS52YWx1ZS5zdGFydFZhbHVlVGV4dCArICd+JztcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMuX2l0ZW0udmFsdWVUZXh0ID0gdGhpcy5faXRlbS52YWx1ZS5zdGFydFZhbHVlVGV4dCArICd+JyArIHRoaXMuX2l0ZW0udmFsdWUuZW5kVmFsdWVUZXh0O1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBkYXRlU3VibWl0Q2hhbmdlKCkge1xyXG4gICAgICAgIGNvbnN0IHZhbCA9IHRoaXMuX2l0ZW0udmFsdWU7XHJcbiAgICAgICAgaWYgKHRoaXMuc2luZ2xlKSB7XHJcbiAgICAgICAgICAgIGlmIChPYmplY3Qua2V5cyh2YWwpLmxlbmd0aCA8IDAgfHwgIXZhbC52YWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zdWJtaXRDaGFuZ2UuZW1pdChmYWxzZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnN1Ym1pdENoYW5nZS5lbWl0KHRydWUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBpZiAoT2JqZWN0LmtleXModmFsKS5sZW5ndGggPT09IDAgfHwgKCF2YWwuc3RhcnRWYWx1ZSAmJiAhdmFsLmVuZFZhbHVlKSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zdWJtaXRDaGFuZ2UuZW1pdChmYWxzZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnN1Ym1pdENoYW5nZS5lbWl0KHRydWUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIG9uQ2hhbmdlKGV2ZW50KSB7XHJcbiAgICAgICAgdGhpcy5zaW5nbGUgPSAhZXZlbnQ7XHJcbiAgICAgICAgdGhpcy5faXRlbS5jb250cm9sLnNpbmdsZSA9IHRoaXMuc2luZ2xlO1xyXG4gICAgICAgIHRoaXMuX2l0ZW0udmFsdWUuc2luZ2xlID0gdGhpcy5zaW5nbGU7XHJcbiAgICAgICAgdGhpcy5pdGVtQ2hhbmdlLmVtaXQodGhpcy5pdGVtKTtcclxuICAgICAgICB0aGlzLmRhdGVTdWJtaXRDaGFuZ2UoKTtcclxuICAgIH1cclxuXHJcblxyXG4gICAgY2xpY2tUYWcodGFnKSB7XHJcbiAgICAgICAgdGhpcy5hY3RpdmVkRGF0ZVRhZ0lkID0gdGFnLmlkO1xyXG4gICAgICAgIGxldCB0YWdEYXRlO1xyXG4gICAgICAgIGlmICh0YWcuaWQgPT0gJ3RhZzEnKSB7XHJcbiAgICAgICAgICAgIHRhZ0RhdGUgPSBnZXRMYXN0TnVtTW9udGgoMSwgdGhpcy5zaG93VGltZSwgdGhpcy5zaG93VHlwZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKHRhZy5pZCA9PSAndGFnMicpIHtcclxuICAgICAgICAgICAgdGFnRGF0ZSA9IGdldExhc3ROdW1Nb250aCgzLCB0aGlzLnNob3dUaW1lLCB0aGlzLnNob3dUeXBlKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAodGFnLmlkID09ICd0YWczJykge1xyXG4gICAgICAgICAgICB0YWdEYXRlID0gZ2V0TGFzdE51bU1vbnRoKDYsIHRoaXMuc2hvd1RpbWUsIHRoaXMuc2hvd1R5cGUpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLl9pdGVtLnZhbHVlLnN0YXJ0VmFsdWUgPSB0YWdEYXRlWydzdGFydFRpbWUnXTtcclxuICAgICAgICB0aGlzLl9pdGVtLnZhbHVlLmVuZFZhbHVlID0gdGFnRGF0ZVsnZW5kVGltZSddO1xyXG4gICAgICAgIHRoaXMuX2l0ZW0udmFsdWUuc3RhcnRWYWx1ZVRleHQgPSB0aGlzLmRhdGVwaWNrZXJFbGUuZGF0ZVRvKG5ldyBEYXRlKHRoaXMuX2l0ZW0udmFsdWUuc3RhcnRWYWx1ZSkpO1xyXG4gICAgICAgIHRoaXMuX2l0ZW0udmFsdWUuZW5kVmFsdWVUZXh0ID0gdGhpcy5kYXRlcGlja2VyRWxlLmRhdGVUbyhuZXcgRGF0ZSh0aGlzLl9pdGVtLnZhbHVlLmVuZFZhbHVlKSk7XHJcbiAgICAgICAgdGhpcy5zdGFydFZhbHVlID0gdGhpcy5faXRlbS52YWx1ZS5zdGFydFZhbHVlO1xyXG4gICAgICAgIHRoaXMuZW5kVmFsdWUgPSB0aGlzLl9pdGVtLnZhbHVlLmVuZFZhbHVlO1xyXG4gICAgICAgIHRoaXMuc2V0VmFsdWVUZXh0KCk7XHJcbiAgICAgICAgdGhpcy5kYXRlU3VibWl0Q2hhbmdlKCk7XHJcbiAgICB9XHJcblxyXG4gICAgY2xpY2tEYXlUYWcodGFnKXtcclxuICAgICAgICB0aGlzLmFjdGl2ZWREYXlUYWdJZCA9IHRhZy5pZDtcclxuICAgICAgICBsZXQgZGF5VGFnID0gZ2V0VG9kYXkodGhpcy5hY3RpdmVkRGF5VGFnSWQsIHRoaXMuc2hvd1RpbWUpO1xyXG4gICAgICAgIHRoaXMuX2l0ZW0udmFsdWUudmFsdWUgPSBkYXlUYWc7XHJcbiAgICAgICAgdGhpcy52YWx1ZSA9IHRoaXMuX2l0ZW0udmFsdWUudmFsdWU7XHJcbiAgICAgICAgdGhpcy5faXRlbS52YWx1ZVRleHQgPSB0aGlzLmRhdGVwaWNrZXJFbGUuZGF0ZVRvKG5ldyBEYXRlKHRoaXMuX2l0ZW0udmFsdWUudmFsdWUpKTtcclxuICAgICAgICB0aGlzLmRhdGVTdWJtaXRDaGFuZ2UoKTtcclxuICAgIH1cclxufSJdfQ==
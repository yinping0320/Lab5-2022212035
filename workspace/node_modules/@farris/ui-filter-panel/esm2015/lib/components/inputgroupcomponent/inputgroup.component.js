/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input, EventEmitter, Output } from '@angular/core';
import { cloneDeep } from 'lodash-es';
export class PanelInputGroupComponent {
    constructor() {
        this.searchHandle = new EventEmitter();
        this.submitChange = new EventEmitter();
        this.isTextFromDialog = false;
    }
    /**
     * @param {?} data
     * @return {?}
     */
    set item(data) {
        this._item = data;
    }
    /**
     * @return {?}
     */
    get item() {
        return this.constructTextItem(this._item);
    }
    /**
     * @param {?} textItem
     * @return {?}
     */
    constructTextItem(textItem) {
        if (!this._item.hasOwnProperty('value')) {
            this._item.value = {
                value: [],
                textValue: '',
                textField: '',
                isInputText: ''
            };
        }
        /** @type {?} */
        const textValueObj = textItem.value;
        textValueObj.textValue = textValueObj.textValue && textValueObj.textValue.trim();
        textItem.value = textValueObj;
        this.textValue = textValueObj.textValue;
        this.setSubmitChange();
        return textItem;
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.testId = this.getGuid();
        this.getInputGroupBindingInfo();
    }
    /**
     * @private
     * @return {?}
     */
    getGuid() {
        return (this.s4() + this.s4() + "-" + this.s4() + "-" + this.s4() + "-" + this.s4() + "-" + this.s4() + this.s4() + this.s4());
    }
    /**
     * @private
     * @return {?}
     */
    s4() {
        return (((1 + Math.random()) * 0x10000) | 0).toString(16).substring(1);
    }
    /**
     * @return {?}
     */
    getInputGroupBindingInfo() {
        /** @type {?} */
        const inputGroupControl = (this.item.control);
        this.usageMode = inputGroupControl.usageMode;
        if (this.usageMode == 'open-modal' || this.usageMode == 'open-remote-modal') {
            this.dialogOptions = inputGroupControl.dialogOptions;
            if (this.dialogOptions.mapFields) {
                this.textField = JSON.stringify(this.dialogOptions.mapFields).split('"')[1];
            }
        }
    }
    /**
     * @param {?} event
     * @return {?}
     */
    onClick(event) {
        if (this.usageMode == 'text') {
            this.item.control.click();
        }
        else {
            /** @type {?} */
            const options = this.dialogOptions;
            options.handle = (/**
             * @param {?} selectedItem
             * @return {?}
             */
            (selectedItem) => {
                // let modalData = item[0];
                // this.item.value.value = modalData[this.targetField];
                /** @type {?} */
                let selectedItems = selectedItem.filter((/**
                 * @param {?} n
                 * @return {?}
                 */
                n => n));
                if (selectedItems && this.textField) {
                    this.item.value.value = selectedItems;
                    //this.item.value.textValue = this.item.value.getTextValue(this.textField);
                    this.item.value.textValue = this.getTextValue(this.textField, this.item.value.value);
                    this.item.value.textField = this.textField;
                    this.item.value.isInputText = false;
                    this.item.textValue = this.item.value.textValue;
                    this.textValue = this.item.textValue;
                    this.isTextFromDialog = true;
                    this.textFormDialog = this.item.value.textValue;
                }
            });
            this.item.control.click({ event, options });
        }
    }
    /**
     * @param {?} targetField
     * @param {?} value
     * @return {?}
     */
    getTextValue(targetField, value) {
        /** @type {?} */
        const args = targetField.split('.');
        /** @type {?} */
        const textArr = value.map((/**
         * @param {?} item
         * @return {?}
         */
        item => this.getPropValue(item, cloneDeep(args))));
        return textArr && textArr.length ? textArr.join(',') : '';
    }
    /**
     * @param {?} item
     * @param {?} args
     * @return {?}
     */
    getPropValue(item, args) {
        if (args.length > 1) {
            /** @type {?} */
            const arg = args.shift();
            if (arg) {
                return item[arg] ? this.getPropValue(item[arg], args) : '';
            }
            else {
                return '';
            }
        }
        return item[args[0]];
    }
    /**
     * @param {?} event
     * @return {?}
     */
    onBlur(event) {
        if (this.usageMode == 'text') {
            this.item.value.isInputText = true;
        }
        if (this.usageMode == 'open-modal' || this.usageMode == 'open-remote-modal') {
            if (!this.isTextFromDialog) {
                this.item.value.isInputText = true;
            }
            if (this.item.value.textValue != this.textFormDialog) {
                this.isTextFromDialog = false;
                this.item.value.value = [];
                this.item.value.textField = undefined;
                this.item.value.isInputText = true;
            }
        }
        this.setSubmitChange();
        this.searchHandle.emit(event);
    }
    /**
     * @return {?}
     */
    setSubmitChange() {
        /** @type {?} */
        const val = this._item.value;
        if (Object.keys(val).length < 0 || !val.textValue) {
            this.submitChange.emit(false);
        }
        else {
            this.submitChange.emit(true);
        }
    }
}
PanelInputGroupComponent.decorators = [
    { type: Component, args: [{
                selector: 'panel-filter-inputgroup',
                template: "\r\n<input-group \r\n    [(ngModel)]=\"item.value.textValue\" \r\n    name=\"{{item.fieldName}}\" \r\n    id=\"{{testId}}\"\r\n    [groupText]=\"item.control.groupText\"\r\n    [editable]=\"item.control.editable\"\r\n    [placeholder]=\"item.placeHolder\"\r\n    (clickHandle)=\"onClick($event)\"\r\n    (blurHandle)=\"onBlur($event)\"\r\n    (enterHandle)=\"onBlur($event)\"\r\n    >\r\n</input-group>\r\n"
            }] }
];
/** @nocollapse */
PanelInputGroupComponent.ctorParameters = () => [];
PanelInputGroupComponent.propDecorators = {
    item: [{ type: Input }],
    searchHandle: [{ type: Output }],
    submitChange: [{ type: Output }]
};
if (false) {
    /** @type {?} */
    PanelInputGroupComponent.prototype._item;
    /** @type {?} */
    PanelInputGroupComponent.prototype.testId;
    /** @type {?} */
    PanelInputGroupComponent.prototype.usageMode;
    /** @type {?} */
    PanelInputGroupComponent.prototype.dialogOptions;
    /** @type {?} */
    PanelInputGroupComponent.prototype.textValue;
    /** @type {?} */
    PanelInputGroupComponent.prototype.searchHandle;
    /** @type {?} */
    PanelInputGroupComponent.prototype.submitChange;
    /** @type {?} */
    PanelInputGroupComponent.prototype.textField;
    /** @type {?} */
    PanelInputGroupComponent.prototype.isTextFromDialog;
    /** @type {?} */
    PanelInputGroupComponent.prototype.textFormDialog;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5wdXRncm91cC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL3VpLWZpbHRlci1wYW5lbC8iLCJzb3VyY2VzIjpbImxpYi9jb21wb25lbnRzL2lucHV0Z3JvdXBjb21wb25lbnQvaW5wdXRncm91cC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsS0FBSyxFQUFxQixZQUFZLEVBQUUsTUFBTSxFQUFlLE1BQU0sZUFBZSxDQUFDO0FBQ3ZHLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxXQUFXLENBQUM7QUFRdEMsTUFBTSxPQUFPLHdCQUF3QjtJQTJDakM7UUF4QlUsaUJBQVksR0FBRyxJQUFJLFlBQVksRUFBRSxDQUFDO1FBQ2xDLGlCQUFZLEdBQUcsSUFBSSxZQUFZLEVBQUUsQ0FBQztRQUc1QyxxQkFBZ0IsR0FBRyxLQUFLLENBQUM7SUFvQlQsQ0FBQzs7Ozs7SUFoQ2pCLElBQ0ksSUFBSSxDQUFDLElBQVM7UUFDZCxJQUFJLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQztJQUN0QixDQUFDOzs7O0lBQ0QsSUFBSSxJQUFJO1FBQ0osT0FBTyxJQUFJLENBQUMsaUJBQWlCLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQzlDLENBQUM7Ozs7O0lBU0QsaUJBQWlCLENBQUMsUUFBUTtRQUN0QixJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxjQUFjLENBQUMsT0FBTyxDQUFDLEVBQUU7WUFDckMsSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLEdBQUc7Z0JBQ2YsS0FBSyxFQUFFLEVBQUU7Z0JBQ1QsU0FBUyxFQUFFLEVBQUU7Z0JBQ2IsU0FBUyxFQUFFLEVBQUU7Z0JBQ2IsV0FBVyxFQUFFLEVBQUU7YUFDbEIsQ0FBQztTQUNMOztjQUNLLFlBQVksR0FBRyxRQUFRLENBQUMsS0FBSztRQUNuQyxZQUFZLENBQUMsU0FBUyxHQUFHLFlBQVksQ0FBQyxT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LEtBQUs7UUFDNUIsSUFBSSxNQUFNLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLE1BQU0sR0FBRyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsU0FBUyxFQUFFO1lBQy9DLElBQUksQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1NBQ2pDO2FBQU07WUFDSCxJQUFJLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztTQUNoQztJQUNMLENBQUM7OztZQS9JSixTQUFTLFNBQUM7Z0JBQ1AsUUFBUSxFQUFFLHlCQUF5QjtnQkFDbkMsa2FBQTBDO2FBQzdDOzs7OzttQkFhSSxLQUFLOzJCQVFMLE1BQU07MkJBQ04sTUFBTTs7OztJQW5CUCx5Q0FBVzs7SUFFWCwwQ0FBZTs7SUFFZiw2Q0FBa0I7O0lBRWxCLGlEQUFtQjs7SUFFbkIsNkNBQWU7O0lBVWYsZ0RBQTRDOztJQUM1QyxnREFBNEM7O0lBRTVDLDZDQUFrQjs7SUFDbEIsb0RBQXlCOztJQUN6QixrREFBdUIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIElucHV0LCBPbkluaXQsIE9uQ2hhbmdlcywgRXZlbnRFbWl0dGVyLCBPdXRwdXQsIEhvc3RCaW5kaW5nIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IGNsb25lRGVlcCB9IGZyb20gJ2xvZGFzaC1lcyc7XHJcblxyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgICBzZWxlY3RvcjogJ3BhbmVsLWZpbHRlci1pbnB1dGdyb3VwJyxcclxuICAgIHRlbXBsYXRlVXJsOiAnLi9pbnB1dGdyb3VwLmNvbXBvbmVudC5odG1sJyxcclxufSlcclxuXHJcbmV4cG9ydCBjbGFzcyBQYW5lbElucHV0R3JvdXBDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xyXG4gICAgX2l0ZW06IGFueTtcclxuXHJcbiAgICB0ZXN0SWQ6IHN0cmluZztcclxuXHJcbiAgICB1c2FnZU1vZGU6IHN0cmluZztcclxuXHJcbiAgICBkaWFsb2dPcHRpb25zOiBhbnk7XHJcblxyXG4gICAgdGV4dFZhbHVlOiBhbnk7XHJcblxyXG4gICAgQElucHV0KClcclxuICAgIHNldCBpdGVtKGRhdGE6IGFueSkge1xyXG4gICAgICAgIHRoaXMuX2l0ZW0gPSBkYXRhO1xyXG4gICAgfVxyXG4gICAgZ2V0IGl0ZW0oKTogYW55IHtcclxuICAgICAgICByZXR1cm4gdGhpcy5jb25zdHJ1Y3RUZXh0SXRlbSh0aGlzLl9pdGVtKTtcclxuICAgIH1cclxuXHJcbiAgICBAT3V0cHV0KCkgc2VhcmNoSGFuZGxlID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG4gICAgQE91dHB1dCgpIHN1Ym1pdENoYW5nZSA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuXHJcbiAgICB0ZXh0RmllbGQ6IHN0cmluZztcclxuICAgIGlzVGV4dEZyb21EaWFsb2cgPSBmYWxzZTtcclxuICAgIHRleHRGb3JtRGlhbG9nOiBzdHJpbmc7XHJcblxyXG4gICAgY29uc3RydWN0VGV4dEl0ZW0odGV4dEl0ZW0pIHtcclxuICAgICAgICBpZiAoIXRoaXMuX2l0ZW0uaGFzT3duUHJvcGVydHkoJ3ZhbHVlJykpIHtcclxuICAgICAgICAgICAgdGhpcy5faXRlbS52YWx1ZSA9IHtcclxuICAgICAgICAgICAgICAgIHZhbHVlOiBbXSxcclxuICAgICAgICAgICAgICAgIHRleHRWYWx1ZTogJycsXHJcbiAgICAgICAgICAgICAgICB0ZXh0RmllbGQ6ICcnLFxyXG4gICAgICAgICAgICAgICAgaXNJbnB1dFRleHQ6ICcnXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IHRleHRWYWx1ZU9iaiA9IHRleHRJdGVtLnZhbHVlO1xyXG4gICAgICAgIHRleHRWYWx1ZU9iai50ZXh0VmFsdWUgPSB0ZXh0VmFsdWVPYmoudGV4dFZhbHVlICYmIHRleHRWYWx1ZU9iai50ZXh0VmFsdWUudHJpbSgpO1xyXG4gICAgICAgIHRleHRJdGVtLnZhbHVlID0gdGV4dFZhbHVlT2JqO1xyXG4gICAgICAgIHRoaXMudGV4dFZhbHVlPXRleHRWYWx1ZU9iai50ZXh0VmFsdWU7XHJcbiAgICAgICAgdGhpcy5zZXRTdWJtaXRDaGFuZ2UoKTtcclxuICAgICAgICByZXR1cm4gdGV4dEl0ZW07XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3RydWN0b3IoKSB7IH1cclxuXHJcbiAgICBuZ09uSW5pdCgpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLnRlc3RJZCA9IHRoaXMuZ2V0R3VpZCgpO1xyXG4gICAgICAgIHRoaXMuZ2V0SW5wdXRHcm91cEJpbmRpbmdJbmZvKCk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBnZXRHdWlkKCkge1xyXG4gICAgICAgIHJldHVybiAodGhpcy5zNCgpICsgdGhpcy5zNCgpICsgXCItXCIgKyB0aGlzLnM0KCkgKyBcIi1cIiArIHRoaXMuczQoKSArIFwiLVwiICsgdGhpcy5zNCgpICsgXCItXCIgKyB0aGlzLnM0KCkgKyB0aGlzLnM0KCkgKyB0aGlzLnM0KCkpO1xyXG4gICAgfVxyXG4gICAgcHJpdmF0ZSBzNCgpIHtcclxuICAgICAgICByZXR1cm4gKCgoMSArIE1hdGgucmFuZG9tKCkpICogMHgxMDAwMCkgfCAwKS50b1N0cmluZygxNikuc3Vic3RyaW5nKDEpO1xyXG4gICAgfVxyXG5cclxuICAgIGdldElucHV0R3JvdXBCaW5kaW5nSW5mbygpIHtcclxuICAgICAgICBjb25zdCBpbnB1dEdyb3VwQ29udHJvbCA9ICh0aGlzLml0ZW0uY29udHJvbCk7XHJcbiAgICAgICAgdGhpcy51c2FnZU1vZGUgPSBpbnB1dEdyb3VwQ29udHJvbC51c2FnZU1vZGU7XHJcbiAgICAgICAgaWYgKHRoaXMudXNhZ2VNb2RlID09ICdvcGVuLW1vZGFsJyB8fCB0aGlzLnVzYWdlTW9kZSA9PSAnb3Blbi1yZW1vdGUtbW9kYWwnKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZGlhbG9nT3B0aW9ucyA9IGlucHV0R3JvdXBDb250cm9sLmRpYWxvZ09wdGlvbnM7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmRpYWxvZ09wdGlvbnMubWFwRmllbGRzKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnRleHRGaWVsZCA9IEpTT04uc3RyaW5naWZ5KHRoaXMuZGlhbG9nT3B0aW9ucy5tYXBGaWVsZHMpLnNwbGl0KCdcIicpWzFdO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIG9uQ2xpY2soZXZlbnQ6IGFueSkge1xyXG4gICAgICAgIGlmICh0aGlzLnVzYWdlTW9kZSA9PSAndGV4dCcpIHtcclxuICAgICAgICAgICAgdGhpcy5pdGVtLmNvbnRyb2wuY2xpY2soKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIGNvbnN0IG9wdGlvbnMgPSB0aGlzLmRpYWxvZ09wdGlvbnM7XHJcbiAgICAgICAgICAgIG9wdGlvbnMuaGFuZGxlID0gKHNlbGVjdGVkSXRlbSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgLy8gbGV0IG1vZGFsRGF0YSA9IGl0ZW1bMF07XHJcbiAgICAgICAgICAgICAgICAvLyB0aGlzLml0ZW0udmFsdWUudmFsdWUgPSBtb2RhbERhdGFbdGhpcy50YXJnZXRGaWVsZF07XHJcbiAgICAgICAgICAgICAgICBsZXQgc2VsZWN0ZWRJdGVtcyA9IHNlbGVjdGVkSXRlbS5maWx0ZXIobiA9PiBuKTtcclxuICAgICAgICAgICAgICAgIGlmIChzZWxlY3RlZEl0ZW1zICYmIHRoaXMudGV4dEZpZWxkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pdGVtLnZhbHVlLnZhbHVlID0gc2VsZWN0ZWRJdGVtcztcclxuICAgICAgICAgICAgICAgICAgICAvL3RoaXMuaXRlbS52YWx1ZS50ZXh0VmFsdWUgPSB0aGlzLml0ZW0udmFsdWUuZ2V0VGV4dFZhbHVlKHRoaXMudGV4dEZpZWxkKTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLml0ZW0udmFsdWUudGV4dFZhbHVlID0gdGhpcy5nZXRUZXh0VmFsdWUodGhpcy50ZXh0RmllbGQsIHRoaXMuaXRlbS52YWx1ZS52YWx1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pdGVtLnZhbHVlLnRleHRGaWVsZCA9IHRoaXMudGV4dEZpZWxkO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaXRlbS52YWx1ZS5pc0lucHV0VGV4dCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaXRlbS50ZXh0VmFsdWU9dGhpcy5pdGVtLnZhbHVlLnRleHRWYWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnRleHRWYWx1ZT10aGlzLml0ZW0udGV4dFZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaXNUZXh0RnJvbURpYWxvZyA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy50ZXh0Rm9ybURpYWxvZyA9IHRoaXMuaXRlbS52YWx1ZS50ZXh0VmFsdWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5pdGVtLmNvbnRyb2wuY2xpY2soeyBldmVudCwgb3B0aW9ucyB9KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0VGV4dFZhbHVlKHRhcmdldEZpZWxkOiBzdHJpbmcsIHZhbHVlKTogc3RyaW5nIHtcclxuICAgICAgICBjb25zdCBhcmdzID0gdGFyZ2V0RmllbGQuc3BsaXQoJy4nKTtcclxuICAgICAgICBjb25zdCB0ZXh0QXJyID0gdmFsdWUubWFwKGl0ZW0gPT4gdGhpcy5nZXRQcm9wVmFsdWUoaXRlbSwgY2xvbmVEZWVwKGFyZ3MpKSk7XHJcbiAgICAgICAgcmV0dXJuIHRleHRBcnIgJiYgdGV4dEFyci5sZW5ndGggPyB0ZXh0QXJyLmpvaW4oJywnKSA6ICcnO1xyXG4gICAgfVxyXG4gICAgZ2V0UHJvcFZhbHVlKGl0ZW06IGFueSwgYXJnczogQXJyYXk8c3RyaW5nPik6IGFueSB7XHJcbiAgICAgICAgaWYgKGFyZ3MubGVuZ3RoID4gMSkge1xyXG4gICAgICAgICAgICBjb25zdCBhcmcgPSBhcmdzLnNoaWZ0KCk7XHJcbiAgICAgICAgICAgIGlmIChhcmcpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBpdGVtW2FyZ10gPyB0aGlzLmdldFByb3BWYWx1ZShpdGVtW2FyZ10sIGFyZ3MpIDogJyc7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gJyc7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGl0ZW1bYXJnc1swXV07XHJcbiAgICB9XHJcblxyXG4gICAgb25CbHVyKGV2ZW50KSB7XHJcbiAgICAgICAgaWYgKHRoaXMudXNhZ2VNb2RlID09ICd0ZXh0Jykge1xyXG4gICAgICAgICAgICB0aGlzLml0ZW0udmFsdWUuaXNJbnB1dFRleHQgPSB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGhpcy51c2FnZU1vZGUgPT0gJ29wZW4tbW9kYWwnIHx8IHRoaXMudXNhZ2VNb2RlID09ICdvcGVuLXJlbW90ZS1tb2RhbCcpIHtcclxuICAgICAgICAgICAgaWYgKCF0aGlzLmlzVGV4dEZyb21EaWFsb2cpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuaXRlbS52YWx1ZS5pc0lucHV0VGV4dCA9IHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHRoaXMuaXRlbS52YWx1ZS50ZXh0VmFsdWUgIT0gdGhpcy50ZXh0Rm9ybURpYWxvZykge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5pc1RleHRGcm9tRGlhbG9nID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB0aGlzLml0ZW0udmFsdWUudmFsdWUgPSBbXTtcclxuICAgICAgICAgICAgICAgIHRoaXMuaXRlbS52YWx1ZS50ZXh0RmllbGQgPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgICAgICAgICB0aGlzLml0ZW0udmFsdWUuaXNJbnB1dFRleHQgPSB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuc2V0U3VibWl0Q2hhbmdlKCk7XHJcbiAgICAgICAgdGhpcy5zZWFyY2hIYW5kbGUuZW1pdChldmVudCk7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0U3VibWl0Q2hhbmdlKCkge1xyXG4gICAgICAgIGNvbnN0IHZhbCA9IHRoaXMuX2l0ZW0udmFsdWU7XHJcbiAgICAgICAgaWYgKE9iamVjdC5rZXlzKHZhbCkubGVuZ3RoIDwgMCB8fCAhdmFsLnRleHRWYWx1ZSkge1xyXG4gICAgICAgICAgICB0aGlzLnN1Ym1pdENoYW5nZS5lbWl0KGZhbHNlKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLnN1Ym1pdENoYW5nZS5lbWl0KHRydWUpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG4iXX0=
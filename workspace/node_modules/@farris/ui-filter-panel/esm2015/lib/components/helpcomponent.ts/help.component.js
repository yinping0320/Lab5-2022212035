/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input, Output, EventEmitter, Injector } from '@angular/core';
// import { ServerSideToken } from '@farris/ui-lookup';
// import { LookupHttpBeQueryService } from './service/Lookup-http.service';
import { of } from 'rxjs';
import { cloneDeep } from 'lodash-es';
export class PanelHelpComponent {
    /**
     * @param {?} injector
     */
    constructor(injector) {
        this.injector = injector;
        this.searchHandle = new EventEmitter();
        this.submitChange = new EventEmitter();
        this.onSearch = (/**
         * @return {?}
         */
        () => {
            this.searchHandle.emit();
            return of(true);
        });
    }
    /**
     * @return {?}
     */
    get item() {
        return this._item;
    }
    /**
     * @param {?} data
     * @return {?}
     */
    set item(data) {
        this._item = data;
        if (this._item.placeHolder) {
            this.placeholder = this._item.placeHolder;
        }
        if (!this._item.hasOwnProperty('value')) {
            this._item.value = {
                value: [],
                valueField: '',
                textValue: ''
            };
        }
        this.getHelpBindingInfo();
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        // if(this.item.control && this.item.control.hasOwnProperty('placeholder')){
        //     this.placeholder = this.item.control.placeholder;
        // }
        // this.getHelpBindingInfo();
    }
    /**
     * @param {?} selectedItem
     * @return {?}
     */
    selectedDataHandler(selectedItem) {
        /** @type {?} */
        const helpValue = (this._item.value);
        helpValue.value = this.singleSelect ? [selectedItem] : selectedItem; // 单选返回对象，多选返回数组
        helpValue.valueField = this.valueField;
        helpValue.textValue = this.getTextValue(this.textField, helpValue.value);
        this.textValue = helpValue.textValue;
        this._item.valueText = this._item.value.textValue;
        this.setSubmitChange();
        this.searchHandle.emit();
    }
    /**
     * @return {?}
     */
    getHelpBindingInfo() {
        if (this._item && this._item.control) {
            /** @type {?} */
            const helpOpts = this._item.control;
            this.uri = helpOpts.uri;
            this.title = helpOpts.title;
            this.textField = helpOpts.textField;
            this.valueField = helpOpts.valueField;
            this.idField = helpOpts.idField;
            this.mapFields = helpOpts.mapFields;
            this.context = helpOpts.context;
            this.preEventCmd = helpOpts.preEventCmd;
            this.postEventCmd = helpOpts.postEventCmd;
            this.singleSelect = helpOpts.singleSelect;
            this.enableFullTree = helpOpts.enableFullTree;
            this.loadTreeDataType = helpOpts.loadTreeDataType;
            this.expandLevel = helpOpts.expandLevel;
            this.enableCascade = helpOpts.enableCascade;
            this.helpId = helpOpts.helpId;
            /** @type {?} */
            const helpValue = (this._item.value);
            // if (helpValue && helpValue.value) {
            //     // this.textValue = (this.item.value as HelpValue).value[this.textField];
            //     this.textValue = HelpValue.getPropValue(helpValue.value, this.textField.split('.'));
            // }
            this.displayType = helpOpts.displayType;
            if (helpValue.textValue == 'help-text-value-null') { // 旧数据兼容
                this.textValue = helpValue.getTextValue(this.textField);
            }
            else {
                this.textValue = helpValue.textValue;
            }
        }
        this.setSubmitChange();
    }
    /**
     * @param {?} data
     * @return {?}
     */
    clearData(data) {
        (this._item.value).clearValue();
        this.setSubmitChange();
        this.searchHandle.emit();
    }
    /**
     * @param {?} helpItem
     * @param {?} args
     * @return {?}
     */
    getPropValue(helpItem, args) {
        if (args.length > 1) {
            /** @type {?} */
            const arg = args.shift();
            return helpItem[arg] ? this.getPropValue(helpItem[arg], args) : null;
        }
        return helpItem[args[0]];
    }
    /**
     * @param {?} textField
     * @param {?} value
     * @return {?}
     */
    getTextValue(textField, value) {
        /** @type {?} */
        const args = textField.split('.');
        /** @type {?} */
        const textArr = value.map((/**
         * @param {?} helpItem
         * @return {?}
         */
        helpItem => this.getPropValue(helpItem, cloneDeep(args))));
        return textArr && textArr.length ? textArr.join(',') : '';
    }
    /**
     * @return {?}
     */
    setSubmitChange() {
        /** @type {?} */
        const val = this._item.value;
        if (Object.keys(val).length < 0 || !val.value || !val.valueField) {
            this.submitChange.emit(false);
        }
        else {
            this.submitChange.emit(true);
        }
    }
}
PanelHelpComponent.decorators = [
    { type: Component, args: [{
                selector: 'panel-filter-help',
                template: "<farris-lookup-grid\r\n    id=\"{{instanceId}}\"\r\n    [uri]=\"uri\"\r\n    [title]=\"title\"\r\n    [idField]=\"idField\" \r\n    [textField]=\"textField\" \r\n    [valueField]=\"valueField\" \r\n    [(ngModel)]=\"textValue\"\r\n    [displayType]=\"displayType\"\r\n    [editable]=\"false\"\r\n    (clear)=\"clearData($event)\"\r\n    (selectedData)=\"selectedDataHandler($event)\"\r\n    [placeholder]=\"placeholder\"\r\n    [mapFields]=\"mapFields\"\r\n    [dictPicking]=\"preEventCmd\"\r\n    [dictPicked]=\"postEventCmd\"\r\n    [context]=\"context\"\r\n    [enableFullTree]=\"enableFullTree\"\r\n    [loadTreeDataType]=\"loadTreeDataType\"\r\n    [singleSelect]=\"singleSelect\"\r\n    [expandLevel]=\"expandLevel\"\r\n    [enableCascade]=\"enableCascade\"\r\n    [useFavorite]=\"true\"\r\n>\r\n</farris-lookup-grid>"
                // providers: [{ provide: ServerSideToken, useClass: LookupHttpBeQueryService }]
            }] }
];
/** @nocollapse */
PanelHelpComponent.ctorParameters = () => [
    { type: Injector }
];
PanelHelpComponent.propDecorators = {
    item: [{ type: Input }],
    instanceId: [{ type: Input }],
    searchHandle: [{ type: Output }],
    submitChange: [{ type: Output }]
};
if (false) {
    /** @type {?} */
    PanelHelpComponent.prototype._item;
    /** @type {?} */
    PanelHelpComponent.prototype.instanceId;
    /** @type {?} */
    PanelHelpComponent.prototype.searchHandle;
    /** @type {?} */
    PanelHelpComponent.prototype.submitChange;
    /** @type {?} */
    PanelHelpComponent.prototype.uri;
    /** @type {?} */
    PanelHelpComponent.prototype.textField;
    /** @type {?} */
    PanelHelpComponent.prototype.idField;
    /** @type {?} */
    PanelHelpComponent.prototype.valueField;
    /** @type {?} */
    PanelHelpComponent.prototype.textValue;
    /** @type {?} */
    PanelHelpComponent.prototype.displayType;
    /** @type {?} */
    PanelHelpComponent.prototype.mapFields;
    /** @type {?} */
    PanelHelpComponent.prototype.context;
    /** @type {?} */
    PanelHelpComponent.prototype.preEventCmd;
    /** @type {?} */
    PanelHelpComponent.prototype.postEventCmd;
    /** @type {?} */
    PanelHelpComponent.prototype.enableFullTree;
    /** @type {?} */
    PanelHelpComponent.prototype.loadTreeDataType;
    /** @type {?} */
    PanelHelpComponent.prototype.singleSelect;
    /** @type {?} */
    PanelHelpComponent.prototype.expandLevel;
    /** @type {?} */
    PanelHelpComponent.prototype.enableCascade;
    /** @type {?} */
    PanelHelpComponent.prototype.placeholder;
    /** @type {?} */
    PanelHelpComponent.prototype.helpId;
    /** @type {?} */
    PanelHelpComponent.prototype.title;
    /** @type {?} */
    PanelHelpComponent.prototype.onSearch;
    /**
     * @type {?}
     * @private
     */
    PanelHelpComponent.prototype.injector;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaGVscC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL3VpLWZpbHRlci1wYW5lbC8iLCJzb3VyY2VzIjpbImxpYi9jb21wb25lbnRzL2hlbHBjb21wb25lbnQudHMvaGVscC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsS0FBSyxFQUFVLE1BQU0sRUFBRSxZQUFZLEVBQUUsUUFBUSxFQUFFLE1BQU0sZUFBZSxDQUFDOzs7QUFJekYsT0FBTyxFQUFFLEVBQUUsRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUMxQixPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sV0FBVyxDQUFDO0FBUXRDLE1BQU0sT0FBTyxrQkFBa0I7Ozs7SUFnRDNCLFlBQW9CLFFBQWtCO1FBQWxCLGFBQVEsR0FBUixRQUFRLENBQVU7UUF0QjVCLGlCQUFZLEdBQUcsSUFBSSxZQUFZLEVBQUUsQ0FBQztRQUNsQyxpQkFBWSxHQUFHLElBQUksWUFBWSxFQUFFLENBQUM7UUE0RTVDLGFBQVE7OztRQUFHLEdBQUcsRUFBRTtZQUNaLElBQUksQ0FBQyxZQUFZLENBQUMsSUFBSSxFQUFFLENBQUM7WUFDekIsT0FBTyxFQUFFLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDcEIsQ0FBQyxFQUFBO0lBMUR5QyxDQUFDOzs7O0lBM0MzQyxJQUNJLElBQUk7UUFDSixPQUFPLElBQUksQ0FBQyxLQUFLLENBQUM7SUFDdEIsQ0FBQzs7Ozs7SUFDRCxJQUFJLElBQUksQ0FBQyxJQUFJO1FBQ1QsSUFBSSxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUM7UUFDbEIsSUFBSSxJQUFJLENBQUMsS0FBSyxDQUFDLFdBQVcsRUFBRTtZQUN4QixJQUFJLENBQUMsV0FBVyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsV0FBVyxDQUFDO1NBQzdDO1FBQ0QsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsY0FBYyxDQUFDLE9BQU8sQ0FB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SUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUM7SUFDOUQsQ0FBQzs7OztJQUVELGVBQWU7O2NBQ0wsR0FBRyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsS0FBSztRQUM1QixJQUFJLE1BQU0sQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsTUFBTSxHQUFHLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsVUFBVSxFQUFFO1lBQzlELElBQUksQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1NBQ2pDO2FBQU07WUFDSCxJQUFJLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztTQUNoQztJQUNMLENBQUM7OztZQTdJSixTQUFTLFNBQUM7Z0JBQ1AsUUFBUSxFQUFFLG1CQUFtQjtnQkFDN0IsbTBCQUFvQztnQkFDcEMsZ0ZBQWdGO2FBQ25GOzs7O1lBWHdELFFBQVE7OzttQkFrQjVELEtBQUs7eUJBbUJMLEtBQUs7MkJBRUwsTUFBTTsyQkFDTixNQUFNOzs7O0lBdkJQLG1DQUFXOztJQW9CWCx3Q0FBNEI7O0lBRTVCLDBDQUE0Qzs7SUFDNUMsMENBQTRDOztJQUU1QyxpQ0FBWTs7SUFDWix1Q0FBa0I7O0lBQ2xCLHFDQUFnQjs7SUFDaEIsd0NBQWdCOztJQUNoQix1Q0FBZTs7SUFDZix5Q0FBWTs7SUFDWix1Q0FBZTs7SUFDZixxQ0FBYTs7SUFDYix5Q0FBaUI7O0lBQ2pCLDBDQUFrQjs7SUFDbEIsNENBQXdCOztJQUN4Qiw4Q0FBc0Q7O0lBQ3RELDBDQUFzQjs7SUFDdEIseUNBQW9COztJQUNwQiwyQ0FBdUI7O0lBQ3ZCLHlDQUFvQjs7SUFDcEIsb0NBQWU7O0lBQ2YsbUNBQWM7O0lBeURkLHNDQUdDOzs7OztJQTFEVyxzQ0FBMEIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIElucHV0LCBPbkluaXQsIE91dHB1dCwgRXZlbnRFbWl0dGVyLCBJbmplY3RvciB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5cclxuLy8gaW1wb3J0IHsgU2VydmVyU2lkZVRva2VuIH0gZnJvbSAnQGZhcnJpcy91aS1sb29rdXAnO1xyXG4vLyBpbXBvcnQgeyBMb29rdXBIdHRwQmVRdWVyeVNlcnZpY2UgfSBmcm9tICcuL3NlcnZpY2UvTG9va3VwLWh0dHAuc2VydmljZSc7XHJcbmltcG9ydCB7IG9mIH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7IGNsb25lRGVlcCB9IGZyb20gJ2xvZGFzaC1lcyc7XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICAgIHNlbGVjdG9yOiAncGFuZWwtZmlsdGVyLWhlbHAnLFxyXG4gICAgdGVtcGxhdGVVcmw6ICcuL2hlbHAuY29tcG9uZW50Lmh0bWwnXHJcbiAgICAvLyBwcm92aWRlcnM6IFt7IHByb3ZpZGU6IFNlcnZlclNpZGVUb2tlbiwgdXNlQ2xhc3M6IExvb2t1cEh0dHBCZVF1ZXJ5U2VydmljZSB9XVxyXG59KVxyXG5cclxuZXhwb3J0IGNsYXNzIFBhbmVsSGVscENvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCB7XHJcblxyXG4gICAgLy8gQElucHV0KCkgaXRlbTphbnk7XHJcblxyXG4gICAgX2l0ZW06IGFueTtcclxuICAgIEBJbnB1dCgpXHJcbiAgICBnZXQgaXRlbSgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5faXRlbTtcclxuICAgIH1cclxuICAgIHNldCBpdGVtKGRhdGEpIHtcclxuICAgICAgICB0aGlzLl9pdGVtID0gZGF0YTtcclxuICAgICAgICBpZiAodGhpcy5faXRlbS5wbGFjZUhvbGRlcikge1xyXG4gICAgICAgICAgICB0aGlzLnBsYWNlaG9sZGVyID0gdGhpcy5faXRlbS5wbGFjZUhvbGRlcjtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKCF0aGlzLl9pdGVtLmhhc093blByb3BlcnR5KCd2YWx1ZScpKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX2l0ZW0udmFsdWUgPSB7XHJcbiAgICAgICAgICAgICAgICB2YWx1ZTogW10sXHJcbiAgICAgICAgICAgICAgICB2YWx1ZUZpZWxkOiAnJyxcclxuICAgICAgICAgICAgICAgIHRleHRWYWx1ZTogJydcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5nZXRIZWxwQmluZGluZ0luZm8oKTtcclxuICAgIH1cclxuXHJcbiAgICBASW5wdXQoKSBpbnN0YW5jZUlkOiBzdHJpbmc7XHJcblxyXG4gICAgQE91dHB1dCgpIHNlYXJjaEhhbmRsZSA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuICAgIEBPdXRwdXQoKSBzdWJtaXRDaGFuZ2UgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcblxyXG4gICAgdXJpOiBzdHJpbmc7XHJcbiAgICB0ZXh0RmllbGQ6IHN0cmluZztcclxuICAgIGlkRmllbGQ6IHN0cmluZztcclxuICAgIHZhbHVlRmllbGQ6IGFueTtcclxuICAgIHRleHRWYWx1ZTogYW55O1xyXG4gICAgZGlzcGxheVR5cGU7XHJcbiAgICBtYXBGaWVsZHM6IGFueTtcclxuICAgIGNvbnRleHQ6IGFueTtcclxuICAgIHByZUV2ZW50Q21kOiBhbnk7XHJcbiAgICBwb3N0RXZlbnRDbWQ6IGFueTtcclxuICAgIGVuYWJsZUZ1bGxUcmVlOiBib29sZWFuO1xyXG4gICAgbG9hZFRyZWVEYXRhVHlwZTogJ2RlZmF1bHQnIHwgJ2xvYWRhbGwnIHwgJ2xheWVybG9hZCc7XHJcbiAgICBzaW5nbGVTZWxlY3Q6IGJvb2xlYW47XHJcbiAgICBleHBhbmRMZXZlbDogbnVtYmVyO1xyXG4gICAgZW5hYmxlQ2FzY2FkZTogYm9vbGVhbjtcclxuICAgIHBsYWNlaG9sZGVyOiBzdHJpbmc7XHJcbiAgICBoZWxwSWQ6IHN0cmluZztcclxuICAgIHRpdGxlOiBzdHJpbmc7XHJcblxyXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBpbmplY3RvcjogSW5qZWN0b3IpIHsgfVxyXG5cclxuICAgIG5nT25Jbml0KCk6IHZvaWQge1xyXG4gICAgICAgIC8vIGlmKHRoaXMuaXRlbS5jb250cm9sICYmIHRoaXMuaXRlbS5jb250cm9sLmhhc093blByb3BlcnR5KCdwbGFjZWhvbGRlcicpKXtcclxuICAgICAgICAvLyAgICAgdGhpcy5wbGFjZWhvbGRlciA9IHRoaXMuaXRlbS5jb250cm9sLnBsYWNlaG9sZGVyO1xyXG4gICAgICAgIC8vIH1cclxuICAgICAgICAvLyB0aGlzLmdldEhlbHBCaW5kaW5nSW5mbygpO1xyXG4gICAgfVxyXG5cclxuICAgIHNlbGVjdGVkRGF0YUhhbmRsZXIoc2VsZWN0ZWRJdGVtOiBhbnkpIHtcclxuICAgICAgICBjb25zdCBoZWxwVmFsdWUgPSAodGhpcy5faXRlbS52YWx1ZSk7XHJcbiAgICAgICAgaGVscFZhbHVlLnZhbHVlID0gdGhpcy5zaW5nbGVTZWxlY3QgPyBbc2VsZWN0ZWRJdGVtXSA6IHNlbGVjdGVkSXRlbTsgLy8g5Y2V6YCJ6L+U5Zue5a+56LGh77yM5aSa6YCJ6L+U5Zue5pWw57uEXHJcbiAgICAgICAgaGVscFZhbHVlLnZhbHVlRmllbGQgPSB0aGlzLnZhbHVlRmllbGQ7XHJcbiAgICAgICAgaGVscFZhbHVlLnRleHRWYWx1ZSA9IHRoaXMuZ2V0VGV4dFZhbHVlKHRoaXMudGV4dEZpZWxkLCBoZWxwVmFsdWUudmFsdWUpO1xyXG4gICAgICAgIHRoaXMudGV4dFZhbHVlID0gaGVscFZhbHVlLnRleHRWYWx1ZTtcclxuICAgICAgICB0aGlzLl9pdGVtLnZhbHVlVGV4dCA9IHRoaXMuX2l0ZW0udmFsdWUudGV4dFZhbHVlO1xyXG4gICAgICAgIHRoaXMuc2V0U3VibWl0Q2hhbmdlKCk7XHJcbiAgICAgICAgdGhpcy5zZWFyY2hIYW5kbGUuZW1pdCgpO1xyXG4gICAgfVxyXG5cclxuICAgIGdldEhlbHBCaW5kaW5nSW5mbygpIHtcclxuICAgICAgICBpZiAodGhpcy5faXRlbSAmJiB0aGlzLl9pdGVtLmNvbnRyb2wpIHtcclxuICAgICAgICAgICAgY29uc3QgaGVscE9wdHMgPSB0aGlzLl9pdGVtLmNvbnRyb2w7XHJcbiAgICAgICAgICAgIHRoaXMudXJpID0gaGVscE9wdHMudXJpO1xyXG4gICAgICAgICAgICB0aGlzLnRpdGxlID0gaGVscE9wdHMudGl0bGU7XHJcbiAgICAgICAgICAgIHRoaXMudGV4dEZpZWxkID0gaGVscE9wdHMudGV4dEZpZWxkO1xyXG4gICAgICAgICAgICB0aGlzLnZhbHVlRmllbGQgPSBoZWxwT3B0cy52YWx1ZUZpZWxkO1xyXG4gICAgICAgICAgICB0aGlzLmlkRmllbGQgPSBoZWxwT3B0cy5pZEZpZWxkO1xyXG4gICAgICAgICAgICB0aGlzLm1hcEZpZWxkcyA9IGhlbHBPcHRzLm1hcEZpZWxkcztcclxuICAgICAgICAgICAgdGhpcy5jb250ZXh0ID0gaGVscE9wdHMuY29udGV4dDtcclxuICAgICAgICAgICAgdGhpcy5wcmVFdmVudENtZCA9IGhlbHBPcHRzLnByZUV2ZW50Q21kO1xyXG4gICAgICAgICAgICB0aGlzLnBvc3RFdmVudENtZCA9IGhlbHBPcHRzLnBvc3RFdmVudENtZDtcclxuICAgICAgICAgICAgdGhpcy5zaW5nbGVTZWxlY3QgPSBoZWxwT3B0cy5zaW5nbGVTZWxlY3Q7XHJcbiAgICAgICAgICAgIHRoaXMuZW5hYmxlRnVsbFRyZWUgPSBoZWxwT3B0cy5lbmFibGVGdWxsVHJlZTtcclxuICAgICAgICAgICAgdGhpcy5sb2FkVHJlZURhdGFUeXBlID0gaGVscE9wdHMubG9hZFRyZWVEYXRhVHlwZTtcclxuICAgICAgICAgICAgdGhpcy5leHBhbmRMZXZlbCA9IGhlbHBPcHRzLmV4cGFuZExldmVsO1xyXG4gICAgICAgICAgICB0aGlzLmVuYWJsZUNhc2NhZGUgPSBoZWxwT3B0cy5lbmFibGVDYXNjYWRlO1xyXG4gICAgICAgICAgICB0aGlzLmhlbHBJZCA9IGhlbHBPcHRzLmhlbHBJZDtcclxuICAgICAgICAgICAgY29uc3QgaGVscFZhbHVlID0gKHRoaXMuX2l0ZW0udmFsdWUpO1xyXG4gICAgICAgICAgICAvLyBpZiAoaGVscFZhbHVlICYmIGhlbHBWYWx1ZS52YWx1ZSkge1xyXG4gICAgICAgICAgICAvLyAgICAgLy8gdGhpcy50ZXh0VmFsdWUgPSAodGhpcy5pdGVtLnZhbHVlIGFzIEhlbHBWYWx1ZSkudmFsdWVbdGhpcy50ZXh0RmllbGRdO1xyXG4gICAgICAgICAgICAvLyAgICAgdGhpcy50ZXh0VmFsdWUgPSBIZWxwVmFsdWUuZ2V0UHJvcFZhbHVlKGhlbHBWYWx1ZS52YWx1ZSwgdGhpcy50ZXh0RmllbGQuc3BsaXQoJy4nKSk7XHJcbiAgICAgICAgICAgIC8vIH1cclxuICAgICAgICAgICAgdGhpcy5kaXNwbGF5VHlwZSA9IGhlbHBPcHRzLmRpc3BsYXlUeXBlO1xyXG4gICAgICAgICAgICBpZiAoaGVscFZhbHVlLnRleHRWYWx1ZSA9PSAnaGVscC10ZXh0LXZhbHVlLW51bGwnKSB7Ly8g5pen5pWw5o2u5YW85a65XHJcbiAgICAgICAgICAgICAgICB0aGlzLnRleHRWYWx1ZSA9IGhlbHBWYWx1ZS5nZXRUZXh0VmFsdWUodGhpcy50ZXh0RmllbGQpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdGhpcy50ZXh0VmFsdWUgPSBoZWxwVmFsdWUudGV4dFZhbHVlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLnNldFN1Ym1pdENoYW5nZSgpO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICBvblNlYXJjaCA9ICgpID0+IHtcclxuICAgICAgICB0aGlzLnNlYXJjaEhhbmRsZS5lbWl0KCk7XHJcbiAgICAgICAgcmV0dXJuIG9mKHRydWUpO1xyXG4gICAgfVxyXG5cclxuICAgIGNsZWFyRGF0YShkYXRhOiBhbnkpIHtcclxuICAgICAgICAodGhpcy5faXRlbS52YWx1ZSkuY2xlYXJWYWx1ZSgpO1xyXG4gICAgICAgIHRoaXMuc2V0U3VibWl0Q2hhbmdlKCk7XHJcbiAgICAgICAgdGhpcy5zZWFyY2hIYW5kbGUuZW1pdCgpO1xyXG4gICAgfVxyXG5cclxuICAgIGdldFByb3BWYWx1ZShoZWxwSXRlbTogYW55LCBhcmdzOiBBcnJheTxzdHJpbmc+KTogYW55IHtcclxuICAgICAgICBpZiAoYXJncy5sZW5ndGggPiAxKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGFyZyA9IGFyZ3Muc2hpZnQoKTtcclxuICAgICAgICAgICAgcmV0dXJuIGhlbHBJdGVtW2FyZ10gPyB0aGlzLmdldFByb3BWYWx1ZShoZWxwSXRlbVthcmddLCBhcmdzKSA6IG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBoZWxwSXRlbVthcmdzWzBdXTtcclxuICAgIH1cclxuXHJcbiAgICBnZXRUZXh0VmFsdWUodGV4dEZpZWxkOiBzdHJpbmcsIHZhbHVlKTogc3RyaW5nIHtcclxuICAgICAgICBjb25zdCBhcmdzID0gdGV4dEZpZWxkLnNwbGl0KCcuJyk7XHJcbiAgICAgICAgY29uc3QgdGV4dEFyciA9IHZhbHVlLm1hcChoZWxwSXRlbSA9PiB0aGlzLmdldFByb3BWYWx1ZShoZWxwSXRlbSwgY2xvbmVEZWVwKGFyZ3MpKSk7XHJcbiAgICAgICAgcmV0dXJuIHRleHRBcnIgJiYgdGV4dEFyci5sZW5ndGggPyB0ZXh0QXJyLmpvaW4oJywnKSA6ICcnO1xyXG4gICAgfVxyXG5cclxuICAgIHNldFN1Ym1pdENoYW5nZSgpIHtcclxuICAgICAgICBjb25zdCB2YWwgPSB0aGlzLl9pdGVtLnZhbHVlO1xyXG4gICAgICAgIGlmIChPYmplY3Qua2V5cyh2YWwpLmxlbmd0aCA8IDAgfHwgIXZhbC52YWx1ZSB8fCAhdmFsLnZhbHVlRmllbGQpIHtcclxuICAgICAgICAgICAgdGhpcy5zdWJtaXRDaGFuZ2UuZW1pdChmYWxzZSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5zdWJtaXRDaGFuZ2UuZW1pdCh0cnVlKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG59XHJcbiJdfQ==
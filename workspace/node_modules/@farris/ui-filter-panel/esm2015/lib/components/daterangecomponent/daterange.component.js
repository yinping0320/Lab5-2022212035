/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input, Output, EventEmitter, ViewChild } from '@angular/core';
import { getLastNumMonth } from './utils';
import { LocaleService } from '@farris/ui-locale';
import { FarrisDatepickerComponent } from '@farris/ui-datepicker';
export class PanelDateRangeComponent {
    /**
     * @param {?} localeService
     */
    constructor(localeService) {
        this.localeService = localeService;
        this.searchHandle = new EventEmitter();
        this.submitChange = new EventEmitter();
        this.date = new Date();
        this.dateTags = [];
    }
    /**
     * @return {?}
     */
    get item() {
        return this._item;
    }
    /**
     * @param {?} data
     * @return {?}
     */
    set item(data) {
        this._item = data;
        setTimeout((/**
         * @return {?}
         */
        () => {
            this.initDate();
        }), 0);
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        //this.initDate();
        this.dateTags = [
            {
                id: 'tag1',
                text: this.localeService.getValue('filterPanel.last1Month')
            },
            {
                id: 'tag2',
                text: this.localeService.getValue('filterPanel.last3Month')
            },
            {
                id: 'tag3',
                text: this.localeService.getValue('filterPanel.last6Month')
            }
        ];
    }
    /**
     * @return {?}
     */
    initDate() {
        if (!this._item.hasOwnProperty('value')) {
            this._item.value = {
                startTime: '',
                endTime: ''
            };
        }
        if (this._item.beginPlaceHolder) {
            this.beginPlaceHolder = this._item.beginPlaceHolder || '';
        }
        if (this._item.endPlaceHolder) {
            this.endPlaceHolder = this._item.endPlaceHolder || '';
        }
        if (this.item && this._item.control) {
            /** @type {?} */
            let itemDateFormat = this._item.control.format;
            if (this.showTime && itemDateFormat) {
                if (itemDateFormat.length > 0 && itemDateFormat.indexOf('HH:mm') == -1) {
                    itemDateFormat = itemDateFormat + ' HH:mm:ss';
                }
            }
            /** @type {?} */
            const format = this.showTime ? 'yyyy-MM-dd HH:mm:ss' : (this.showType == '2' ? 'yyyy-MM' : (this.showType == '3' ? 'yyyy' : 'yyyy-MM-dd'));
            this.dateFormat = itemDateFormat ? itemDateFormat : format;
        }
        /** @type {?} */
        const rangeDateValue = this._item && this._item.value;
        this.activedDateTagId = '';
        if (rangeDateValue.startTime && rangeDateValue.endTime) {
            this.rangeDate = `${rangeDateValue.startTime}~${rangeDateValue.endTime}`;
        }
        else {
            this.rangeDate = '';
        }
        this.setSubmitChange();
    }
    /**
     * @param {?} dateString
     * @return {?}
     */
    getDate(dateString) {
        /** @type {?} */
        let date = new Date(dateString);
        return date;
    }
    /**
     * @param {?} event
     * @return {?}
     */
    onDateChange(event) {
        if (event.returnFormatted) {
            (this._item.value).startTime = event.returnFormatted.split('~')[0];
            (this._item.value).endTime = event.returnFormatted.split('~')[1];
        }
        else {
            this._item.value.startTime = '';
            this._item.value.endTime = '';
        }
        // if (Object.keys(this._item.value).length === 0 || (!this._item.value.startTime && !this._item.value.endTime)) {
        //     this._item.valueText = ''
        // }
        // else {
        //     this._item.valueText = this._item.value.startTime + '~' + this._item.value.endTime;
        // }
        this._item.valueText = event.formatted;
        this.activedDateTagId = '';
        this.setSubmitChange();
        this.searchHandle.emit(event);
    }
    /**
     * @param {?} tag
     * @return {?}
     */
    clickTag(tag) {
        this.activedDateTagId = tag.id;
        /** @type {?} */
        let tagDate;
        if (tag.id == 'tag1') {
            tagDate = getLastNumMonth(1, this.showTime, this.showType);
        }
        else if (tag.id == 'tag2') {
            tagDate = getLastNumMonth(3, this.showTime, this.showType);
        }
        else if (tag.id == 'tag3') {
            tagDate = getLastNumMonth(6, this.showTime, this.showType);
        }
        this._item.value.startTime = tagDate['startTime'];
        this._item.value.endTime = tagDate['endTime'];
        /** @type {?} */
        const rangeDateValue = this._item && this._item.value;
        if (rangeDateValue.startTime && rangeDateValue.endTime) {
            this.rangeDate = `${rangeDateValue.startTime}~${rangeDateValue.endTime}`;
        }
        else {
            this.rangeDate = '';
        }
        // this._item.valueText = this._item.value.startTime + '~' + this._item.value.endTime;
        this._item.valueText = this.datepickerEle.dateTo(new Date(this._item.value.startTime)) + '~' + this.datepickerEle.dateTo(new Date(this._item.value.endTime));
        this.setSubmitChange();
    }
    /**
     * @return {?}
     */
    setSubmitChange() {
        /** @type {?} */
        const val = this._item.value;
        if (Object.keys(val).length < 0 || (!val.startTime && !val.endTime)) {
            this.submitChange.emit(false);
        }
        else {
            this.submitChange.emit(true);
        }
    }
}
PanelDateRangeComponent.decorators = [
    { type: Component, args: [{
                selector: 'panel-filter-daterange',
                template: "<!-- <farris-datepicker [(ngModel)]=\"rangeDate\" [dateRange]=\"true\" [editable]=\"false\" [returnFormat]=\"showTime ? 'yyyy-MM-dd HH:mm:ss' : 'yyyy-MM-dd'\" [dateFormat]=\"dateFormat\" (valueChange)=\"onDateChange($event)\" [beginPlaceholder]=\"beginPlaceHolder\" [endPlaceholder]=\"endPlaceHolder\" [placeholder]=\"placeholder\" [showTime]=\"showTime\"></farris-datepicker> -->\r\n\r\n<ng-container *ngIf=\"showTime;else defaultdate\">\r\n    <farris-datepicker [(ngModel)]=\"rangeDate\" [dateRange]=\"true\" [editable]=\"false\" [returnFormat]=\"showTime ? 'yyyy-MM-dd HH:mm:ss' : 'yyyy-MM-dd'\" [dateFormat]=\"dateFormat\" (valueChange)=\"onDateChange($event)\" [beginPlaceholder]=\"beginPlaceHolder\" [endPlaceholder]=\"endPlaceHolder\" [showTime]=\"showTime\" #datepicker></farris-datepicker>\r\n</ng-container>\r\n<ng-template #defaultdate>\r\n    <farris-datepicker [(ngModel)]=\"rangeDate\" [dateRange]=\"true\" [editable]=\"false\" [returnFormat]=\"showType == '2'? 'yyyy-MM': (showType == '3'? 'yyyy':'yyyy-MM-dd')\" [dateFormat]=\"dateFormat\" (valueChange)=\"onDateChange($event)\" [beginPlaceholder]=\"beginPlaceHolder\" [endPlaceholder]=\"endPlaceHolder\" [showType]=\"showType\" #datepicker></farris-datepicker>\r\n</ng-template>\r\n\r\n<div class=\"f-filter-panel-date-tags\" *ngIf=\"showType !== '3'\">\r\n    <div class=\"panel-date-tag\" \r\n    *ngFor=\"let tag of dateTags\" \r\n    (click)=\"clickTag(tag)\"\r\n    [ngClass]=\"{'active': tag.id == activedDateTagId}\"\r\n    >\r\n        {{tag.text}}\r\n    </div>\r\n</div>"
            }] }
];
/** @nocollapse */
PanelDateRangeComponent.ctorParameters = () => [
    { type: LocaleService }
];
PanelDateRangeComponent.propDecorators = {
    item: [{ type: Input }],
    showTime: [{ type: Input }],
    showType: [{ type: Input }],
    searchHandle: [{ type: Output, args: ['searchHandle',] }],
    submitChange: [{ type: Output, args: ['submitChange',] }],
    datepickerEle: [{ type: ViewChild, args: ['datepicker',] }]
};
if (false) {
    /** @type {?} */
    PanelDateRangeComponent.prototype._item;
    /** @type {?} */
    PanelDateRangeComponent.prototype.showTime;
    /** @type {?} */
    PanelDateRangeComponent.prototype.showType;
    /** @type {?} */
    PanelDateRangeComponent.prototype.searchHandle;
    /** @type {?} */
    PanelDateRangeComponent.prototype.submitChange;
    /** @type {?} */
    PanelDateRangeComponent.prototype.datepickerEle;
    /** @type {?} */
    PanelDateRangeComponent.prototype.startTime;
    /** @type {?} */
    PanelDateRangeComponent.prototype.endTime;
    /** @type {?} */
    PanelDateRangeComponent.prototype.rangeDate;
    /** @type {?} */
    PanelDateRangeComponent.prototype.placeholder;
    /** @type {?} */
    PanelDateRangeComponent.prototype.beginPlaceHolder;
    /** @type {?} */
    PanelDateRangeComponent.prototype.endPlaceHolder;
    /** @type {?} */
    PanelDateRangeComponent.prototype.dateFormat;
    /** @type {?} */
    PanelDateRangeComponent.prototype.date;
    /** @type {?} */
    PanelDateRangeComponent.prototype.dateTags;
    /** @type {?} */
    PanelDateRangeComponent.prototype.activedDateTagId;
    /** @type {?} */
    PanelDateRangeComponent.prototype.localeService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0ZXJhbmdlLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvdWktZmlsdGVyLXBhbmVsLyIsInNvdXJjZXMiOlsibGliL2NvbXBvbmVudHMvZGF0ZXJhbmdlY29tcG9uZW50L2RhdGVyYW5nZS5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsS0FBSyxFQUFVLE1BQU0sRUFBRSxZQUFZLEVBQUUsU0FBUyxFQUFjLE1BQU0sZUFBZSxDQUFDO0FBQ3RHLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxTQUFTLENBQUM7QUFDMUMsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBQ2xELE9BQU8sRUFBRSx5QkFBeUIsRUFBRSxNQUFNLHVCQUF1QixDQUFDO0FBT2xFLE1BQU0sT0FBTyx1QkFBdUI7Ozs7SUErQmhDLFlBQW1CLGFBQTRCO1FBQTVCLGtCQUFhLEdBQWIsYUFBYSxDQUFlO1FBaEJ2QixpQkFBWSxHQUFHLElBQUksWUFBWSxFQUFFLENBQUM7UUFDbEMsaUJBQVksR0FBRyxJQUFJLFlBQVksRUFBRSxDQUFDO1FBVzFELFNBQUksR0FBRyxJQUFJLElBQUksRUFBRSxDQUFDO1FBQ2xCLGFBQVEsR0FBRyxFQUFFLENBQUM7SUFHcUMsQ0FBQzs7OztJQTVCcEQsSUFDSSxJQUFJO1FBQ0osT0FBTyxJQUFJLENBQUMsS0FBSyxDQUFDO0lBQ3RCLENBQUM7Ozs7O0lBQ0QsSUFBSSxJQUFJLENBQUMsSUFBSTtRQUNULElBQUksQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDO1FBQ2xCLFVBQVU7OztRQUFDLEdBQUcsRUFBRTtZQUNaLElBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQztRQUNwQixDQUFDLEdBQUUsQ0FBQyxDQUFDLENBQUM7SUFDVixDQUFDOzs7O0lBcUJELFFBQVE7UUFDSixrQkFBa0I7UUFDbEIsSUFBSSxDQUFDLFFBQVEsR0FBRztZQUNaO2dC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QUFHLENBQUMsSUFBSSxDQUFDLENBQUMsR0FBRyxDQUFDLFNBQVMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsRUFBQztZQUMvRCxJQUFJLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztTQUNqQzthQUNHO1lBQ0EsSUFBSSxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7U0FDaEM7SUFDTCxDQUFDOzs7WUF0SkosU0FBUyxTQUFDO2dCQUNQLFFBQVEsRUFBRSx3QkFBd0I7Z0JBQ2xDLHdoREFBeUM7YUFDNUM7Ozs7WUFOUSxhQUFhOzs7bUJBV2pCLEtBQUs7dUJBVUwsS0FBSzt1QkFDTCxLQUFLOzJCQUNMLE1BQU0sU0FBQyxjQUFjOzJCQUNyQixNQUFNLFNBQUMsY0FBYzs0QkFDckIsU0FBUyxTQUFDLFlBQVk7Ozs7SUFmdkIsd0NBQVc7O0lBV1gsMkNBQTJCOztJQUMzQiwyQ0FBeUI7O0lBQ3pCLCtDQUEwRDs7SUFDMUQsK0NBQTBEOztJQUMxRCxnREFBaUU7O0lBRWpFLDRDQUFnQjs7SUFDaEIsMENBQWM7O0lBRWQsNENBQWtCOztJQUNsQiw4Q0FBb0I7O0lBQ3BCLG1EQUF5Qjs7SUFDekIsaURBQXVCOztJQUN2Qiw2Q0FBbUI7O0lBQ25CLHVDQUFrQjs7SUFDbEIsMkNBQWM7O0lBQ2QsbURBQWlCOztJQUVMLGdEQUFtQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgSW5wdXQsIE9uSW5pdCwgT3V0cHV0LCBFdmVudEVtaXR0ZXIsIFZpZXdDaGlsZCwgRWxlbWVudFJlZiB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBnZXRMYXN0TnVtTW9udGggfSBmcm9tICcuL3V0aWxzJztcclxuaW1wb3J0IHsgTG9jYWxlU2VydmljZSB9IGZyb20gJ0BmYXJyaXMvdWktbG9jYWxlJztcclxuaW1wb3J0IHsgRmFycmlzRGF0ZXBpY2tlckNvbXBvbmVudCB9IGZyb20gJ0BmYXJyaXMvdWktZGF0ZXBpY2tlcic7XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICAgIHNlbGVjdG9yOiAncGFuZWwtZmlsdGVyLWRhdGVyYW5nZScsXHJcbiAgICB0ZW1wbGF0ZVVybDogJy4vZGF0ZXJhbmdlLmNvbXBvbmVudC5odG1sJ1xyXG59KVxyXG5cclxuZXhwb3J0IGNsYXNzIFBhbmVsRGF0ZVJhbmdlQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcclxuICAgIC8vIEBJbnB1dCgpIGl0ZW06YW55O1xyXG4gICAgX2l0ZW06IGFueTtcclxuICAgIEBJbnB1dCgpXHJcbiAgICBnZXQgaXRlbSgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5faXRlbTtcclxuICAgIH1cclxuICAgIHNldCBpdGVtKGRhdGEpIHtcclxuICAgICAgICB0aGlzLl9pdGVtID0gZGF0YTtcclxuICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgICAgdGhpcy5pbml0RGF0ZSgpO1xyXG4gICAgICAgIH0sIDApO1xyXG4gICAgfVxyXG4gICAgQElucHV0KCkgc2hvd1RpbWU6IGJvb2xlYW47XHJcbiAgICBASW5wdXQoKSBzaG93VHlwZTpzdHJpbmc7XHJcbiAgICBAT3V0cHV0KCdzZWFyY2hIYW5kbGUnKSBzZWFyY2hIYW5kbGUgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcbiAgICBAT3V0cHV0KCdzdWJtaXRDaGFuZ2UnKSBzdWJtaXRDaGFuZ2UgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcbiAgICBAVmlld0NoaWxkKCdkYXRlcGlja2VyJykgZGF0ZXBpY2tlckVsZTpGYXJyaXNEYXRlcGlja2VyQ29tcG9uZW50O1xyXG5cclxuICAgIHN0YXJ0VGltZTogRGF0ZTtcclxuICAgIGVuZFRpbWU6IERhdGU7XHJcblxyXG4gICAgcmFuZ2VEYXRlOiBzdHJpbmc7XHJcbiAgICBwbGFjZWhvbGRlcjogc3RyaW5nO1xyXG4gICAgYmVnaW5QbGFjZUhvbGRlcjogc3RyaW5nO1xyXG4gICAgZW5kUGxhY2VIb2xkZXI6IHN0cmluZztcclxuICAgIGRhdGVGb3JtYXQ6IHN0cmluZztcclxuICAgIGRhdGUgPSBuZXcgRGF0ZSgpO1xyXG4gICAgZGF0ZVRhZ3MgPSBbXTtcclxuICAgIGFjdGl2ZWREYXRlVGFnSWQ7XHJcblxyXG4gICAgY29uc3RydWN0b3IocHVibGljIGxvY2FsZVNlcnZpY2U6IExvY2FsZVNlcnZpY2UpIHsgfVxyXG5cclxuICAgIG5nT25Jbml0KCk6IHZvaWQge1xyXG4gICAgICAgIC8vdGhpcy5pbml0RGF0ZSgpO1xyXG4gICAgICAgIHRoaXMuZGF0ZVRhZ3MgPSBbXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGlkOiAndGFnMScsXHJcbiAgICAgICAgICAgICAgICB0ZXh0OiB0aGlzLmxvY2FsZVNlcnZpY2UuZ2V0VmFsdWUoJ2ZpbHRlclBhbmVsLmxhc3QxTW9udGgnKVxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpZDogJ3RhZzInLFxyXG4gICAgICAgICAgICAgICAgdGV4dDogdGhpcy5sb2NhbGVTZXJ2aWNlLmdldFZhbHVlKCdmaWx0ZXJQYW5lbC5sYXN0M01vbnRoJylcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaWQ6ICd0YWczJyxcclxuICAgICAgICAgICAgICAgIHRleHQ6IHRoaXMubG9jYWxlU2VydmljZS5nZXRWYWx1ZSgnZmlsdGVyUGFuZWwubGFzdDZNb250aCcpXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICBdO1xyXG4gICAgfVxyXG5cclxuICAgIGluaXREYXRlKCkge1xyXG4gICAgICAgIGlmKCF0aGlzLl9pdGVtLmhhc093blByb3BlcnR5KCd2YWx1ZScpKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX2l0ZW0udmFsdWUgPSB7XHJcbiAgICAgICAgICAgICAgICBzdGFydFRpbWUgOiAnJyxcclxuICAgICAgICAgICAgICAgIGVuZFRpbWUgOiAnJ1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGhpcy5faXRlbS5iZWdpblBsYWNlSG9sZGVyKSB7XHJcbiAgICAgICAgICAgIHRoaXMuYmVnaW5QbGFjZUhvbGRlciA9IHRoaXMuX2l0ZW0uYmVnaW5QbGFjZUhvbGRlciB8fCAnJztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh0aGlzLl9pdGVtLmVuZFBsYWNlSG9sZGVyICkge1xyXG4gICAgICAgICAgICB0aGlzLmVuZFBsYWNlSG9sZGVyID0gdGhpcy5faXRlbS5lbmRQbGFjZUhvbGRlciB8fCAnJztcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYodGhpcy5pdGVtICYmIHRoaXMuX2l0ZW0uY29udHJvbCl7XHJcbiAgICAgICAgICAgIGxldCBpdGVtRGF0ZUZvcm1hdCA9IHRoaXMuX2l0ZW0uY29udHJvbC5mb3JtYXQ7XHJcbiAgICAgICAgICAgIGlmKHRoaXMuc2hvd1RpbWUgJiYgaXRlbURhdGVGb3JtYXQpe1xyXG4gICAgICAgICAgICAgICAgaWYoaXRlbURhdGVGb3JtYXQubGVuZ3RoID4gMCAmJiBpdGVtRGF0ZUZvcm1hdC5pbmRleE9mKCdISDptbScpID09IC0xKXtcclxuICAgICAgICAgICAgICAgICAgICBpdGVtRGF0ZUZvcm1hdCA9IGl0ZW1EYXRlRm9ybWF0ICsgJyBISDptbTpzcyc7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY29uc3QgZm9ybWF0ID0gdGhpcy5zaG93VGltZSA/ICd5eXl5LU1NLWRkIEhIOm1tOnNzJzogKHRoaXMuc2hvd1R5cGUgPT0gJzInPyAneXl5eS1NTSc6ICh0aGlzLnNob3dUeXBlID09ICczJz8gJ3l5eXknOid5eXl5LU1NLWRkJykpO1xyXG4gICAgICAgICAgICB0aGlzLmRhdGVGb3JtYXQgPSBpdGVtRGF0ZUZvcm1hdD9pdGVtRGF0ZUZvcm1hdDpmb3JtYXQ7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IHJhbmdlRGF0ZVZhbHVlID0gdGhpcy5faXRlbSAmJiB0aGlzLl9pdGVtLnZhbHVlO1xyXG4gICAgICAgIHRoaXMuYWN0aXZlZERhdGVUYWdJZCA9ICcnO1xyXG4gICAgICAgIGlmIChyYW5nZURhdGVWYWx1ZS5zdGFydFRpbWUgJiYgcmFuZ2VEYXRlVmFsdWUuZW5kVGltZSkge1xyXG4gICAgICAgICAgICB0aGlzLnJhbmdlRGF0ZSA9IGAke3JhbmdlRGF0ZVZhbHVlLnN0YXJ0VGltZX1+JHtyYW5nZURhdGVWYWx1ZS5lbmRUaW1lfWA7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLnJhbmdlRGF0ZSA9ICcnO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLnNldFN1Ym1pdENoYW5nZSgpO1xyXG4gICAgfVxyXG5cclxuICAgIGdldERhdGUoZGF0ZVN0cmluZzogRGF0ZSk6IERhdGUge1xyXG4gICAgICAgIGxldCBkYXRlID0gbmV3IERhdGUoZGF0ZVN0cmluZyk7XHJcbiAgICAgICAgcmV0dXJuIGRhdGU7XHJcbiAgICB9XHJcblxyXG4gICAgb25EYXRlQ2hhbmdlKGV2ZW50OiBhbnkpIHtcclxuICAgICAgICBpZiAoZXZlbnQucmV0dXJuRm9ybWF0dGVkKSB7XHJcbiAgICAgICAgICAgICh0aGlzLl9pdGVtLnZhbHVlKS5zdGFydFRpbWUgPSBldmVudC5yZXR1cm5Gb3JtYXR0ZWQuc3BsaXQoJ34nKVswXTtcclxuICAgICAgICAgICAgKHRoaXMuX2l0ZW0udmFsdWUpLmVuZFRpbWUgPSBldmVudC5yZXR1cm5Gb3JtYXR0ZWQuc3BsaXQoJ34nKVsxXTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLl9pdGVtLnZhbHVlLnN0YXJ0VGltZSA9ICcnO1xyXG4gICAgICAgICAgICB0aGlzLl9pdGVtLnZhbHVlLmVuZFRpbWUgPSAnJztcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gaWYgKE9iamVjdC5rZXlzKHRoaXMuX2l0ZW0udmFsdWUpLmxlbmd0aCA9PT0gMCB8fCAoIXRoaXMuX2l0ZW0udmFsdWUuc3RhcnRUaW1lICYmICF0aGlzLl9pdGVtLnZhbHVlLmVuZFRpbWUpKSB7XHJcbiAgICAgICAgLy8gICAgIHRoaXMuX2l0ZW0udmFsdWVUZXh0ID0gJydcclxuICAgICAgICAvLyB9XHJcbiAgICAgICAgLy8gZWxzZSB7XHJcbiAgICAgICAgLy8gICAgIHRoaXMuX2l0ZW0udmFsdWVUZXh0ID0gdGhpcy5faXRlbS52YWx1ZS5zdGFydFRpbWUgKyAnficgKyB0aGlzLl9pdGVtLnZhbHVlLmVuZFRpbWU7XHJcbiAgICAgICAgLy8gfVxyXG4gICAgICAgIHRoaXMuX2l0ZW0udmFsdWVUZXh0ID0gZXZlbnQuZm9ybWF0dGVkO1xyXG4gICAgICAgIHRoaXMuYWN0aXZlZERhdGVUYWdJZCA9ICcnO1xyXG4gICAgICAgIHRoaXMuc2V0U3VibWl0Q2hhbmdlKCk7XHJcbiAgICAgICAgdGhpcy5zZWFyY2hIYW5kbGUuZW1pdChldmVudCk7XHJcbiAgICB9XHJcblxyXG4gICAgY2xpY2tUYWcodGFnKSB7XHJcbiAgICAgICAgdGhpcy5hY3RpdmVkRGF0ZVRhZ0lkID0gdGFnLmlkO1xyXG4gICAgICAgIGxldCB0YWdEYXRlO1xyXG4gICAgICAgIGlmKHRhZy5pZCA9PSAndGFnMScpe1xyXG4gICAgICAgICAgICB0YWdEYXRlID0gZ2V0TGFzdE51bU1vbnRoKDEsdGhpcy5zaG93VGltZSx0aGlzLnNob3dUeXBlKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZih0YWcuaWQgPT0gJ3RhZzInKXtcclxuICAgICAgICAgICAgdGFnRGF0ZSA9IGdldExhc3ROdW1Nb250aCgzLHRoaXMuc2hvd1RpbWUsdGhpcy5zaG93VHlwZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYodGFnLmlkID09ICd0YWczJyl7XHJcbiAgICAgICAgICAgIHRhZ0RhdGUgPSBnZXRMYXN0TnVtTW9udGgoNix0aGlzLnNob3dUaW1lLHRoaXMuc2hvd1R5cGUpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLl9pdGVtLnZhbHVlLnN0YXJ0VGltZSA9IHRhZ0RhdGVbJ3N0YXJ0VGltZSddO1xyXG4gICAgICAgIHRoaXMuX2l0ZW0udmFsdWUuZW5kVGltZSA9IHRhZ0RhdGVbJ2VuZFRpbWUnXTtcclxuICAgICAgICBjb25zdCByYW5nZURhdGVWYWx1ZSA9IHRoaXMuX2l0ZW0gJiYgdGhpcy5faXRlbS52YWx1ZTtcclxuICAgICAgICBpZiAocmFuZ2VEYXRlVmFsdWUuc3RhcnRUaW1lICYmIHJhbmdlRGF0ZVZhbHVlLmVuZFRpbWUpIHtcclxuICAgICAgICAgICAgdGhpcy5yYW5nZURhdGUgPSBgJHtyYW5nZURhdGVWYWx1ZS5zdGFydFRpbWV9fiR7cmFuZ2VEYXRlVmFsdWUuZW5kVGltZX1gO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5yYW5nZURhdGUgPSAnJztcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gdGhpcy5faXRlbS52YWx1ZVRleHQgPSB0aGlzLl9pdGVtLnZhbHVlLnN0YXJ0VGltZSArICd+JyArIHRoaXMuX2l0ZW0udmFsdWUuZW5kVGltZTtcclxuICAgICAgICB0aGlzLl9pdGVtLnZhbHVlVGV4dCA9IHRoaXMuZGF0ZXBpY2tlckVsZS5kYXRlVG8obmV3IERhdGUodGhpcy5faXRlbS52YWx1ZS5zdGFydFRpbWUpKSArICd+JyArIHRoaXMuZGF0ZXBpY2tlckVsZS5kYXRlVG8obmV3IERhdGUodGhpcy5faXRlbS52YWx1ZS5lbmRUaW1lKSlcclxuICAgICAgICB0aGlzLnNldFN1Ym1pdENoYW5nZSgpO1xyXG4gICAgfVxyXG5cclxuICAgIHNldFN1Ym1pdENoYW5nZSgpe1xyXG4gICAgICAgIGNvbnN0IHZhbCA9IHRoaXMuX2l0ZW0udmFsdWU7XHJcbiAgICAgICAgaWYoT2JqZWN0LmtleXModmFsKS5sZW5ndGggPCAwIHx8ICghdmFsLnN0YXJ0VGltZSAmJiAhdmFsLmVuZFRpbWUpKXtcclxuICAgICAgICAgICAgdGhpcy5zdWJtaXRDaGFuZ2UuZW1pdChmYWxzZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2V7XHJcbiAgICAgICAgICAgIHRoaXMuc3VibWl0Q2hhbmdlLmVtaXQodHJ1ZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59Il19
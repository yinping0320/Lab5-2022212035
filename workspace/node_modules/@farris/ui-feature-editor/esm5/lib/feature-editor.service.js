/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { ComponentFactoryResolver, EventEmitter, Injectable, Injector, LOCALE_ID } from '@angular/core';
import { BsModalService } from '@farris/ui-modal';
import { LocaleService } from '@farris/ui-locale';
import { FeatureEditorComponent } from './feature-editor.component';
import { I18nService } from './i18n-service';
import { isObservable, of } from 'rxjs';
import { EventManager } from '@angular/platform-browser';
var FeatureEditorService = /** @class */ (function () {
    function FeatureEditorService(injector, modalService, componentFactoryResolver, localeService, languageService) {
        this.injector = injector;
        this.modalService = modalService;
        this.componentFactoryResolver = componentFactoryResolver;
        this.localeService = localeService;
        this.languageService = languageService;
        this.dialog = null;
        this.componentRef = null;
        this.keyDownHandler = null;
        this.onUserConfirmed = new EventEmitter();
        if (!this.languageService) {
            /** @type {?} */
            var localeId = this.injector.get(LOCALE_ID, 'zh-CHS');
            this.languageService = new I18nService(localeId);
        }
        this.eventManager = this.injector.get(EventManager, null);
    }
    /**
     * 弹出特性编辑器
     * @param features 特征数组
     * @param options 弹窗配置
     * @returns
     */
    /**
     * 弹出特性编辑器
     * @param {?} features 特征数组
     * @param {?=} options 弹窗配置
     * @return {?}
     */
    FeatureEditorService.prototype.show = /**
     * 弹出特性编辑器
     * @param {?} features 特征数组
     * @param {?=} options 弹窗配置
     * @return {?}
     */
    function (features, options) {
        var _this = this;
        if (!features || features.length < 1) {
            return;
        }
        this.canOpen(options).subscribe((/**
         * @param {?} canOpen
         * @return {?}
         */
        function (canOpen) {
            if (!canOpen) {
                return;
            }
            /** @type {?} */
            var componentFactory = _this.componentFactoryResolver.resolveComponentFactory(FeatureEditorComponent);
            _this.componentRef = componentFactory.create(_this.injector);
            _this.componentRef.instance.features = features;
            /** @type {?} */
            var titleText = _this.languageService.title;
            /** @type {?} */
            var okText = _this.localeService.getValue('batchEditDialog.okText');
            /** @type {?} */
            var cancelText = _this.localeService.getValue('batchEditDialog.cancelText');
            var _a = options || {}, _b = _a.width, width = _b === void 0 ? 470 : _b, _c = _a.height, height = _c === void 0 ? 500 : _c, _d = _a.title, title = _d === void 0 ? titleText : _d;
            /** @type {?} */
            var modalOptions = {
                title: title,
                width: width,
                height: height,
                buttons: [
                    {
                        text: cancelText, cls: 'btn btn-secondary', handle: (/**
                         * @return {?}
                         */
                        function () {
                            _this.dialog.close();
                        })
                    },
                    {
                        text: okText, cls: 'btn btn-primary',
                        handle: (/**
                         * @return {?}
                         */
                        function () {
                            _this.onConfirmClick(options);
                        })
                    }
                ],
                showButtons: true,
                areaResponse: true,
                opened: (/**
                 * @param {?} e
                 * @return {?}
                 */
                function (e) {
                    _this.registerShortcutKey(options, e.instance);
                }),
                closed: (/**
                 * @return {?}
                 */
                function () {
                    if (_this.keyDownHandler) {
                        _this.keyDownHandler();
                        _this.keyDownHandler = null;
                    }
                })
            };
            _this.dialog = _this.modalService.show(_this.componentRef, modalOptions);
        }));
    };
    /**
     * @private
     * @param {?} options
     * @param {?} dialogRef
     * @return {?}
     */
    FeatureEditorService.prototype.registerShortcutKey = /**
     * @private
     * @param {?} options
     * @param {?} dialogRef
     * @return {?}
     */
    function (options, dialogRef) {
        var _this = this;
        // 回车，与确定按钮处理逻辑一至。
        /** @type {?} */
        var dlgContainerDom = dialogRef.dialog.location.nativeElement;
        if (dlgContainerDom && !this.keyDownHandler) {
            this.keyDownHandler = this.eventManager.addEventListener(dlgContainerDom, 'keydown', (/**
             * @param {?} e
             * @return {?}
             */
            function (e) {
                e.stopPropagation();
                if (e.key === 'Enter') {
                    // if (e.target['nodeName'] === 'INPUT' && !e.ctrlKey) {
                    //     return;
                    // }
                    _this.onConfirmClick(options);
                }
                else if (e.key === 'Escape') {
                    _this.dialog.close();
                }
                else if (e.key === 'Tab') {
                    _this.onTabKeydownHandler(e.target);
                }
            }));
        }
        if (this.componentRef) {
            this.setFirstInputFocus();
        }
    };
    /**
     * @private
     * @return {?}
     */
    FeatureEditorService.prototype.setFirstInputFocus = /**
     * @private
     * @return {?}
     */
    function () {
        /** @type {?} */
        var firstInputEl = this.componentRef.location.nativeElement.querySelector('input,textarea');
        if (firstInputEl) {
            firstInputEl.focus();
        }
    };
    /**
     * @private
     * @param {?} currentTarget
     * @return {?}
     */
    FeatureEditorService.prototype.onTabKeydownHandler = /**
     * @private
     * @param {?} currentTarget
     * @return {?}
     */
    function (currentTarget) {
        /** @type {?} */
        var allInputs = this.componentRef.location.nativeElement.querySelectorAll('input,textarea');
        allInputs = Array.from(allInputs);
        /** @type {?} */
        var currentInputIndex = allInputs.findIndex((/**
         * @param {?} n
         * @return {?}
         */
        function (n) { return n === currentTarget; }));
        /** @type {?} */
        var nextInputIndex = currentInputIndex + 1;
        if (nextInputIndex >= allInputs.length) {
            nextInputIndex = 0;
        }
        /** @type {?} */
        var nextInputTarget = allInputs[nextInputIndex];
        if (nextInputTarget) {
            setTimeout((/**
             * @return {?}
             */
            function () {
                nextInputTarget.focus();
            }));
        }
    };
    /**
     * 用户点击确认按钮
     */
    /**
     * 用户点击确认按钮
     * @private
     * @param {?=} options
     * @return {?}
     */
    FeatureEditorService.prototype.onConfirmClick = /**
     * 用户点击确认按钮
     * @private
     * @param {?=} options
     * @return {?}
     */
    function (options) {
        var _this = this;
        this.canClose(options).subscribe((/**
         * @param {?} result
         * @return {?}
         */
        function (result) {
            if (result === true) {
                _this.onConfirm(options);
            }
        }));
    };
    /**
     * 确认
     * @param options options
     */
    /**
     * 确认
     * @private
     * @param {?=} options options
     * @return {?}
     */
    FeatureEditorService.prototype.onConfirm = /**
     * 确认
     * @private
     * @param {?=} options options
     * @return {?}
     */
    function (options) {
        /** @type {?} */
        var features = this.componentRef && this.componentRef.instance && this.componentRef.instance.features || [];
        this.dialog.close();
        if (options.onConfirm && typeof options.onConfirm) {
            options.onConfirm(features);
        }
        this.onUserConfirmed.next(features);
    };
    /**
     * 是否可以关闭
     * @param options options
     * @returns
     */
    /**
     * 是否可以关闭
     * @private
     * @param {?=} options options
     * @return {?}
     */
    FeatureEditorService.prototype.canClose = /**
     * 是否可以关闭
     * @private
     * @param {?=} options options
     * @return {?}
     */
    function (options) {
        /** @type {?} */
        var features = this.componentRef && this.componentRef.instance && this.componentRef.instance.features || [];
        /** @type {?} */
        var onConfirmingRef = options && options.onConfirming || null;
        if (!onConfirmingRef) {
            return of(true);
        }
        // 有确认前事件
        /** @type {?} */
        var onConfirming = onConfirmingRef(features);
        if (isObservable(onConfirming)) {
            return onConfirming;
        }
        else {
            return of(onConfirming);
        }
    };
    /**
     * 是否可以弹出特性编辑器
     * @param options options
     * @returns
     */
    /**
     * 是否可以弹出特性编辑器
     * @private
     * @param {?=} options options
     * @return {?}
     */
    FeatureEditorService.prototype.canOpen = /**
     * 是否可以弹出特性编辑器
     * @private
     * @param {?=} options options
     * @return {?}
     */
    function (options) {
        /** @type {?} */
        var onOpeningHandlerRef = options && options.onOpening || null;
        if (!onOpeningHandlerRef) {
            return of(true);
        }
        /** @type {?} */
        var onOpeningHandler = onOpeningHandlerRef(options);
        if (isObservable(onOpeningHandler)) {
            return onOpeningHandler;
        }
        else {
            return of(onOpeningHandler);
        }
    };
    FeatureEditorService.decorators = [
        { type: Injectable }
    ];
    /** @nocollapse */
    FeatureEditorService.ctorParameters = function () { return [
        { type: Injector },
        { type: BsModalService },
        { type: ComponentFactoryResolver },
        { type: LocaleService },
        { type: I18nService }
    ]; };
    return FeatureEditorService;
}());
export { FeatureEditorService };
if (false) {
    /** @type {?} */
    FeatureEditorService.prototype.dialog;
    /**
     * @type {?}
     * @private
     */
    FeatureEditorService.prototype.componentRef;
    /**
     * @type {?}
     * @private
     */
    FeatureEditorService.prototype.keyDownHandler;
    /** @type {?} */
    FeatureEditorService.prototype.onUserConfirmed;
    /**
     * @type {?}
     * @private
     */
    FeatureEditorService.prototype.eventManager;
    /** @type {?} */
    FeatureEditorService.prototype.injector;
    /**
     * @type {?}
     * @private
     */
    FeatureEditorService.prototype.modalService;
    /**
     * @type {?}
     * @private
     */
    FeatureEditorService.prototype.componentFactoryResolver;
    /**
     * @type {?}
     * @private
     */
    FeatureEditorService.prototype.localeService;
    /**
     * @type {?}
     * @private
     */
    FeatureEditorService.prototype.languageService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmVhdHVyZS1lZGl0b3Iuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvdWktZmVhdHVyZS1lZGl0b3IvIiwic291cmNlcyI6WyJsaWIvZmVhdHVyZS1lZGl0b3Iuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFFLHdCQUF3QixFQUFnQixZQUFZLEVBQUUsVUFBVSxFQUFFLFFBQVEsRUFBRSxTQUFTLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDdEgsT0FBTyxFQUFFLGNBQWMsRUFBYyxNQUFNLGtCQUFrQixDQUFDO0FBQzlELE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUVsRCxPQUFPLEVBQUUsc0JBQXNCLEVBQUUsTUFBTSw0QkFBNEIsQ0FBQztBQUNwRSxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDN0MsT0FBTyxFQUFFLFlBQVksRUFBYyxFQUFFLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDcEQsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLDJCQUEyQixDQUFDO0FBRXpEO0lBT0ksOEJBQ1csUUFBa0IsRUFDakIsWUFBNEIsRUFDNUIsd0JBQWtELEVBQ2xELGFBQTRCLEVBQzVCLGVBQTRCO1FBSjdCLGFBQVEsR0FBUixRQUFRLENBQVU7UUFDakIsaUJBQVksR0FBWixZQUFZLENBQWdCO1FBQzVCLDZCQUF3QixHQUF4Qix3QkFBd0IsQ0FBMEI7UUFDbEQsa0JBQWEsR0FBYixhQUFhLENBQWU7UUFDNUIsb0JBQWUsR0FBZixlQUFlLENBQWE7UUFWakMsV0FBTSxHQUFlLElBQUksQ0FBQztRQUN6QixpQkFBWSxHQUF5QyxJQUFJLENBQUM7UUFDMUQsbUJBQWMsR0FBRyxJQUFJLENBQUM7UUFDOUIsb0JBQWUsR0FBc0IsSUFBSSxZQUFZLEVBQU8sQ0FBQztRQVN6RCxJQUFJLENBQUMsSUFBSSxDQUFDLGVBQWUsRUFBRTs7Z0JBQ2pCLFFBQVEsR0FB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LHdCQUF3QjtnQkFFeEIsYUFBYTtnQkFHYixXQUFXOztJQTBMcEIsMkJBQUM7Q0FBQSxBQXRMRCxJQXNMQztTQXJMWSxvQkFBb0I7OztJQUM3QixzQ0FBaUM7Ozs7O0lBQ2pDLDRDQUFrRTs7Ozs7SUFDbEUsOENBQThCOztJQUM5QiwrQ0FBNkQ7Ozs7O0lBQzdELDRDQUFtQzs7SUFFL0Isd0NBQXlCOzs7OztJQUN6Qiw0Q0FBb0M7Ozs7O0lBQ3BDLHdEQUEwRDs7Ozs7SUFDMUQsNkNBQW9DOzs7OztJQUNwQywrQ0FBb0MiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIsIENvbXBvbmVudFJlZiwgRXZlbnRFbWl0dGVyLCBJbmplY3RhYmxlLCBJbmplY3RvciwgTE9DQUxFX0lEIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IEJzTW9kYWxTZXJ2aWNlLCBCc01vZGFsUmVmIH0gZnJvbSAnQGZhcnJpcy91aS1tb2RhbCc7XHJcbmltcG9ydCB7IExvY2FsZVNlcnZpY2UgfSBmcm9tICdAZmFycmlzL3VpLWxvY2FsZSc7XHJcbmltcG9ydCB7IElGZWF0dXJlLCBJRmVhdHVyZUVkaXRvck9wdGlvbnMgfSBmcm9tICcuL3R5cGUnO1xyXG5pbXBvcnQgeyBGZWF0dXJlRWRpdG9yQ29tcG9uZW50IH0gZnJvbSAnLi9mZWF0dXJlLWVkaXRvci5jb21wb25lbnQnO1xyXG5pbXBvcnQgeyBJMThuU2VydmljZSB9IGZyb20gJy4vaTE4bi1zZXJ2aWNlJztcclxuaW1wb3J0IHsgaXNPYnNlcnZhYmxlLCBPYnNlcnZhYmxlLCBvZiB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQgeyBFdmVudE1hbmFnZXIgfSBmcm9tICdAYW5ndWxhci9wbGF0Zm9ybS1icm93c2VyJztcclxuXHJcbkBJbmplY3RhYmxlKClcclxuZXhwb3J0IGNsYXNzIEZlYXR1cmVFZGl0b3JTZXJ2aWNlIHtcclxuICAgIHB1YmxpYyBkaWFsb2c6IEJzTW9kYWxSZWYgPSBudWxsO1xyXG4gICAgcHJpdmF0ZSBjb21wb25lbnRSZWY6IENvbXBvbmVudFJlZjxGZWF0dXJlRWRpdG9yQ29tcG9uZW50PiA9IG51bGw7XHJcbiAgICBwcml2YXRlIGtleURvd25IYW5kbGVyID0gbnVsbDtcclxuICAgIG9uVXNlckNvbmZpcm1lZDogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcclxuICAgIHByaXZhdGUgZXZlbnRNYW5hZ2VyOiBFdmVudE1hbmFnZXI7XHJcbiAgICBjb25zdHJ1Y3RvcihcclxuICAgICAgICBwdWJsaWMgaW5qZWN0b3I6IEluamVjdG9yLFxyXG4gICAgICAgIHByaXZhdGUgbW9kYWxTZXJ2aWNlOiBCc01vZGFsU2VydmljZSxcclxuICAgICAgICBwcml2YXRlIGNvbXBvbmVudEZhY3RvcnlSZXNvbHZlcjogQ29tcG9uZW50RmFjdG9yeVJlc29sdmVyLFxyXG4gICAgICAgIHByaXZhdGUgbG9jYWxlU2VydmljZTogTG9jYWxlU2VydmljZSxcclxuICAgICAgICBwcml2YXRlIGxhbmd1YWdlU2VydmljZTogSTE4blNlcnZpY2VcclxuICAgICkge1xyXG4gICAgICAgIGlmICghdGhpcy5sYW5ndWFnZVNlcnZpY2UpIHtcclxuICAgICAgICAgICAgY29uc3QgbG9jYWxlSWQgPSB0aGlzLmluamVjdG9yLmdldDxzdHJpbmc+KExPQ0FMRV9JRCwgJ3poLUNIUycpO1xyXG4gICAgICAgICAgICB0aGlzLmxhbmd1YWdlU2VydmljZSA9IG5ldyBJMThuU2VydmljZShsb2NhbGVJZCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLmV2ZW50TWFuYWdlciA9IHRoaXMuaW5qZWN0b3IuZ2V0KEV2ZW50TWFuYWdlciwgbnVsbCk7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIOW8ueWHuueJueaAp+e8lui+keWZqFxyXG4gICAgICogQHBhcmFtIGZlYXR1cmVzIOeJueW+geaVsOe7hFxyXG4gICAgICogQHBhcmFtIG9wdGlvbnMg5by556qX6YWN572uXHJcbiAgICAgKiBAcmV0dXJucyBcclxuICAgICAqL1xyXG4gICAgcHVibGljIHNob3coZmVhdHVyZXM6IEFycmF5PElGZWF0dXJlPiwgb3B0aW9ucz86IElGZWF0dXJlRWRpdG9yT3B0aW9ucyk6IHZvaWQge1xyXG4gICAgICAgIGlmICghZmVhdHVyZXMgfHwgZmVhdHVyZXMubGVuZ3RoIDwgMSkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuY2FuT3BlbihvcHRpb25zKS5zdWJzY3JpYmUoKGNhbk9wZW46IGJvb2xlYW4pID0+IHtcclxuICAgICAgICAgICAgaWYgKCFjYW5PcGVuKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY29uc3QgY29tcG9uZW50RmFjdG9yeSA9IHRoaXMuY29tcG9uZW50RmFjdG9yeVJlc29sdmVyLnJlc29sdmVDb21wb25lbnRGYWN0b3J5KEZlYXR1cmVFZGl0b3JDb21wb25lbnQpO1xyXG4gICAgICAgICAgICB0aGlzLmNvbXBvbmVudFJlZiA9IGNvbXBvbmVudEZhY3RvcnkuY3JlYXRlKHRoaXMuaW5qZWN0b3IpO1xyXG4gICAgICAgICAgICB0aGlzLmNvbXBvbmVudFJlZi5pbnN0YW5jZS5mZWF0dXJlcyA9IGZlYXR1cmVzO1xyXG4gICAgICAgICAgICBjb25zdCB0aXRsZVRleHQgPSB0aGlzLmxhbmd1YWdlU2VydmljZS50aXRsZTtcclxuICAgICAgICAgICAgY29uc3Qgb2tUZXh0ID0gdGhpcy5sb2NhbGVTZXJ2aWNlLmdldFZhbHVlKCdiYXRjaEVkaXREaWFsb2cub2tUZXh0Jyk7XHJcbiAgICAgICAgICAgIGNvbnN0IGNhbmNlbFRleHQgPSB0aGlzLmxvY2FsZVNlcnZpY2UuZ2V0VmFsdWUoJ2JhdGNoRWRpdERpYWxvZy5jYW5jZWxUZXh0Jyk7XHJcbiAgICAgICAgICAgIGNvbnN0IHsgd2lkdGggPSA0NzAsIGhlaWdodCA9IDUwMCwgdGl0bGUgPSB0aXRsZVRleHQgfSA9IG9wdGlvbnMgfHwge307XHJcbiAgICAgICAgICAgIGNvbnN0IG1vZGFsT3B0aW9uczogYW55ID0ge1xyXG4gICAgICAgICAgICAgICAgdGl0bGUsXHJcbiAgICAgICAgICAgICAgICB3aWR0aCxcclxuICAgICAgICAgICAgICAgIGhlaWdodCxcclxuICAgICAgICAgICAgICAgIGJ1dHRvbnM6IFtcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6IGNhbmNlbFRleHQsIGNsczogJ2J0biBidG4tc2Vjb25kYXJ5JywgaGFuZGxlOiAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRpYWxvZy5jbG9zZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6IG9rVGV4dCwgY2xzOiAnYnRuIGJ0bi1wcmltYXJ5JyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgaGFuZGxlOiAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm9uQ29uZmlybUNsaWNrKG9wdGlvbnMpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgXSxcclxuICAgICAgICAgICAgICAgIHNob3dCdXR0b25zOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgYXJlYVJlc3BvbnNlOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgb3BlbmVkOiAoZSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMucmVnaXN0ZXJTaG9ydGN1dEtleShvcHRpb25zLCBlLmluc3RhbmNlKTtcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBjbG9zZWQ6ICgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5rZXlEb3duSGFuZGxlcikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmtleURvd25IYW5kbGVyKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMua2V5RG93bkhhbmRsZXIgPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgdGhpcy5kaWFsb2cgPSB0aGlzLm1vZGFsU2VydmljZS5zaG93KHRoaXMuY29tcG9uZW50UmVmLCBtb2RhbE9wdGlvbnMpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICBwcml2YXRlIHJlZ2lzdGVyU2hvcnRjdXRLZXkob3B0aW9ucywgZGlhbG9nUmVmKSB7XHJcbiAgICAgICAgLy8g5Zue6L2m77yM5LiO56Gu5a6a5oyJ6ZKu5aSE55CG6YC76L6R5LiA6Iez44CCXHJcbiAgICAgICAgY29uc3QgZGxnQ29udGFpbmVyRG9tID0gZGlhbG9nUmVmLmRpYWxvZy5sb2NhdGlvbi5uYXRpdmVFbGVtZW50O1xyXG5cclxuICAgICAgICBpZiAoZGxnQ29udGFpbmVyRG9tICYmICF0aGlzLmtleURvd25IYW5kbGVyKSB7XHJcbiAgICAgICAgICAgIHRoaXMua2V5RG93bkhhbmRsZXIgPSB0aGlzLmV2ZW50TWFuYWdlci5hZGRFdmVudExpc3RlbmVyKGRsZ0NvbnRhaW5lckRvbSwgJ2tleWRvd24nLCAoZTogS2V5Ym9hcmRFdmVudCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcclxuICAgICAgICAgICAgICAgIGlmIChlLmtleSA9PT0gJ0VudGVyJykge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIGlmIChlLnRhcmdldFsnbm9kZU5hbWUnXSA9PT0gJ0lOUFVUJyAmJiAhZS5jdHJsS2V5KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgICAgICAvLyB9XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5vbkNvbmZpcm1DbGljayhvcHRpb25zKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZS5rZXkgPT09ICdFc2NhcGUnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kaWFsb2cuY2xvc2UoKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZS5rZXkgPT09ICdUYWInKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5vblRhYktleWRvd25IYW5kbGVyKGUudGFyZ2V0KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodGhpcy5jb21wb25lbnRSZWYpIHtcclxuICAgICAgICAgICAgdGhpcy5zZXRGaXJzdElucHV0Rm9jdXMoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBzZXRGaXJzdElucHV0Rm9jdXMoKSB7XHJcbiAgICAgICAgY29uc3QgZmlyc3RJbnB1dEVsID0gdGhpcy5jb21wb25lbnRSZWYubG9jYXRpb24ubmF0aXZlRWxlbWVudC5xdWVyeVNlbGVjdG9yKCdpbnB1dCx0ZXh0YXJlYScpO1xyXG4gICAgICAgIGlmIChmaXJzdElucHV0RWwpIHtcclxuICAgICAgICAgICAgZmlyc3RJbnB1dEVsLmZvY3VzKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgb25UYWJLZXlkb3duSGFuZGxlcihjdXJyZW50VGFyZ2V0KSB7XHJcbiAgICAgICAgbGV0IGFsbElucHV0cyA9IHRoaXMuY29tcG9uZW50UmVmLmxvY2F0aW9uLm5hdGl2ZUVsZW1lbnQucXVlcnlTZWxlY3RvckFsbCgnaW5wdXQsdGV4dGFyZWEnKTtcclxuICAgICAgICBhbGxJbnB1dHMgPSBBcnJheS5mcm9tKGFsbElucHV0cyk7XHJcbiAgICAgICAgY29uc3QgY3VycmVudElucHV0SW5kZXggPSBhbGxJbnB1dHMuZmluZEluZGV4KG4gPT4gbiA9PT0gY3VycmVudFRhcmdldCk7XHJcbiAgICAgICAgbGV0IG5leHRJbnB1dEluZGV4ID0gY3VycmVudElucHV0SW5kZXggKyAxO1xyXG4gICAgICAgIGlmIChuZXh0SW5wdXRJbmRleCA+PSBhbGxJbnB1dHMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIG5leHRJbnB1dEluZGV4ID0gMDtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc3QgbmV4dElucHV0VGFyZ2V0ID0gYWxsSW5wdXRzW25leHRJbnB1dEluZGV4XTtcclxuICAgICAgICBpZiAobmV4dElucHV0VGFyZ2V0KSB7XHJcbiAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgbmV4dElucHV0VGFyZ2V0LmZvY3VzKCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOeUqOaIt+eCueWHu+ehruiupOaMiemSrlxyXG4gICAgICovXHJcbiAgICBwcml2YXRlIG9uQ29uZmlybUNsaWNrKG9wdGlvbnM/OiBJRmVhdHVyZUVkaXRvck9wdGlvbnMpIHtcclxuICAgICAgICB0aGlzLmNhbkNsb3NlKG9wdGlvbnMpLnN1YnNjcmliZSgocmVzdWx0OiBib29sZWFuKSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChyZXN1bHQgPT09IHRydWUpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMub25Db25maXJtKG9wdGlvbnMpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIOehruiupFxyXG4gICAgICogQHBhcmFtIG9wdGlvbnMgb3B0aW9uc1xyXG4gICAgICovXHJcbiAgICBwcml2YXRlIG9uQ29uZmlybShvcHRpb25zPzogSUZlYXR1cmVFZGl0b3JPcHRpb25zKSB7XHJcbiAgICAgICAgY29uc3QgZmVhdHVyZXMgPSB0aGlzLmNvbXBvbmVudFJlZiAmJiB0aGlzLmNvbXBvbmVudFJlZi5pbnN0YW5jZSAmJiB0aGlzLmNvbXBvbmVudFJlZi5pbnN0YW5jZS5mZWF0dXJlcyB8fCBbXTtcclxuICAgICAgICB0aGlzLmRpYWxvZy5jbG9zZSgpO1xyXG4gICAgICAgIGlmIChvcHRpb25zLm9uQ29uZmlybSAmJiB0eXBlb2Ygb3B0aW9ucy5vbkNvbmZpcm0pIHtcclxuICAgICAgICAgICAgb3B0aW9ucy5vbkNvbmZpcm0oZmVhdHVyZXMpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLm9uVXNlckNvbmZpcm1lZC5uZXh0KGZlYXR1cmVzKTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICog5piv5ZCm5Y+v5Lul5YWz6ZetXHJcbiAgICAgKiBAcGFyYW0gb3B0aW9ucyBvcHRpb25zXHJcbiAgICAgKiBAcmV0dXJucyBcclxuICAgICAqL1xyXG4gICAgcHJpdmF0ZSBjYW5DbG9zZShvcHRpb25zPzogSUZlYXR1cmVFZGl0b3JPcHRpb25zKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgICAgICBjb25zdCBmZWF0dXJlcyA9IHRoaXMuY29tcG9uZW50UmVmICYmIHRoaXMuY29tcG9uZW50UmVmLmluc3RhbmNlICYmIHRoaXMuY29tcG9uZW50UmVmLmluc3RhbmNlLmZlYXR1cmVzIHx8IFtdO1xyXG4gICAgICAgIGNvbnN0IG9uQ29uZmlybWluZ1JlZiA9IG9wdGlvbnMgJiYgb3B0aW9ucy5vbkNvbmZpcm1pbmcgfHwgbnVsbDtcclxuICAgICAgICBpZiAoIW9uQ29uZmlybWluZ1JlZikge1xyXG4gICAgICAgICAgICByZXR1cm4gb2YodHJ1ZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIOacieehruiupOWJjeS6i+S7tlxyXG4gICAgICAgIGNvbnN0IG9uQ29uZmlybWluZyA9IG9uQ29uZmlybWluZ1JlZihmZWF0dXJlcyk7XHJcbiAgICAgICAgaWYgKGlzT2JzZXJ2YWJsZShvbkNvbmZpcm1pbmcpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBvbkNvbmZpcm1pbmc7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcmV0dXJuIG9mKG9uQ29uZmlybWluZyk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiDmmK/lkKblj6/ku6XlvLnlh7rnibnmgKfnvJbovpHlmahcclxuICAgICAqIEBwYXJhbSBvcHRpb25zIG9wdGlvbnNcclxuICAgICAqIEByZXR1cm5zIFxyXG4gICAgICovXHJcbiAgICBwcml2YXRlIGNhbk9wZW4ob3B0aW9ucz86IElGZWF0dXJlRWRpdG9yT3B0aW9ucyk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICAgICAgY29uc3Qgb25PcGVuaW5nSGFuZGxlclJlZiA9IG9wdGlvbnMgJiYgb3B0aW9ucy5vbk9wZW5pbmcgfHwgbnVsbDtcclxuICAgICAgICBpZiAoIW9uT3BlbmluZ0hhbmRsZXJSZWYpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG9mKHRydWUpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCBvbk9wZW5pbmdIYW5kbGVyID0gb25PcGVuaW5nSGFuZGxlclJlZihvcHRpb25zKTtcclxuICAgICAgICBpZiAoaXNPYnNlcnZhYmxlKG9uT3BlbmluZ0hhbmRsZXIpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBvbk9wZW5pbmdIYW5kbGVyO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiBvZihvbk9wZW5pbmdIYW5kbGVyKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuIl19
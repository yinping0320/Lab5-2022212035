!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/common/http"),require("rxjs/operators"),require("@angular/platform-browser"),require("@angular/common"),require("@angular/forms"),require("@farris/ui-forms"),require("@farris/ui-lookup"),require("@farris/ui-combo-list"),require("@farris/ui-input-group"),require("@farris/ui-modal"),require("@farris/ui-datepicker"),require("@farris/ui-number-spinner"),require("@farris/ui-time-picker"),require("@farris/ui-locale"),require("@farris/ui-switch"),require("@farris/ui-section"),require("@angular/core"),require("rxjs")):"function"==typeof define&&define.amd?define("@farris/ui-feature-editor",["exports","@angular/common/http","rxjs/operators","@angular/platform-browser","@angular/common","@angular/forms","@farris/ui-forms","@farris/ui-lookup","@farris/ui-combo-list","@farris/ui-input-group","@farris/ui-modal","@farris/ui-datepicker","@farris/ui-number-spinner","@farris/ui-time-picker","@farris/ui-locale","@farris/ui-switch","@farris/ui-section","@angular/core","rxjs"],t):t((e.farris=e.farris||{},e.farris["ui-feature-editor"]={}),e.ng.common.http,e.rxjs.operators,e.ng.platformBrowser,e.ng.common,e.ng.forms,e.uiForms,e.uiLookup,e.uiComboList,e.uiInputGroup,e.uiModal,e.uiDatepicker,e.uiNumberSpinner,e.uiTimePicker,e.uiLocale,e.uiSwitch,e.uiSection,e.ng.core,e.rxjs)}(this,function(e,t,a,s,r,n,o,i,l,u,c,p,f,d,m,g,h,v,y){"use strict";var x=(b.prototype.getData=function(e,t){var r=e.split(":"),n="1"===r[0]?"9e2dca82-0aa2-4394-b26d-cb91164f44d5":"344ffc53-7167-48d1-866b-a84083404e9e",o="setid:"+r[1]+"&state_isenabled:1",i={};return t&&(t.pageIndex&&(i.pageIndex=JSON.stringify(t.pageIndex-0)),t.pageSize&&(i.pageSize=JSON.stringify(t.pageSize-0)),t.condition&&(i.condition=JSON.stringify(t.condition)),t.searchValue&&(i.search=t.searchValue)),this.http.put("/api/scm/scmfnd/v1.0/scmcommoncmpservice/service/gethelpdata",{helpID:n,queryParam:JSON.stringify(i),filterStr:o}).pipe(a.map(function(e){return JSON.parse(e.returnValue)}))},b.decorators=[{type:v.Injectable}],b.ctorParameters=function(){return[{type:t.HttpClient}]},b);function b(e){this.http=e}var k=(S.prototype.ngOnInit=function(){},S.prototype.onSelectRows=function(e){var t=e||{},r=t.code,n=void 0===r?null:r,o=t.rows,i=void 0===o?[]:o;n&&(this.features.find(function(e){return e.field===n}).results=i)},S.decorators=[{type:v.Component,args:[{selector:"farris-feature-editor",template:'<farris-section class="f-section-form f-section-in-mainsubcard" [showHeader]="false" [enableMaximize]="false">\r\n  <div class="f-form-layout farris-form-controls-inline" [class.farris-form-controls-inline]="true">\r\n    <div class="col-12 col-md-6 col-xl-3 col-el-2"  *ngFor="let feature of features;let row = index">\r\n      <div class="farris-group-wrap">\r\n        <div class="form-group farris-form-group">\r\n          <label class="col-form-label" title="feature?.title" for="{{feature?.id}}"><span\r\n              class="farris-label-info text-danger" *ngIf="feature?.options.required">*</span><span\r\n              class="farris-label-text">{{feature?.title}}</span></label>\r\n          <div class="farris-input-wrap">\r\n            \x3c!--帮助--\x3e\r\n          <ng-template [ngIf]="feature?.editor?.controlType===\'lookup\'">\r\n            \x3c!-- <ng-container *ngTemplateOutlet="lookupTemplate;context:input"></ng-container> --\x3e\r\n            <farris-lookup-grid #lookupGrid [lookup-extra]="feature?.field" [ins]="lookupGrid" [enableClear]=\'feature?.options?.enableClear || false\'\r\n              (onSelectRows)="onSelectRows($event)" input-end-edit [uri]="feature?.options?.uri" [editable]="feature?.options?.editable || false"\r\n              [mapFields]="feature?.options?.mapFields" [displayType]="feature?.options?.displayType || \'List\'"\r\n              [idField]="feature?.options?.idField" [singleSelect]="feature?.options?.singleSelect || true"\r\n              [pageSize]="feature?.options?.pageSize" [pageIndex]="1" [pagination]="feature?.options?.pagination"\r\n              [textField]="feature?.options?.textField" [valueField]="feature?.options?.valueField"\r\n              [title]="feature?.options?.dialogTitle" [showMaxButton]="feature?.options?.showMaxButton"\r\n              [showCloseButton]="feature?.options?.showCloseButton" [resizable]="feature?.options?.resizable"\r\n              [context]="feature?.options?.context" [expandLevel]="feature?.options?.expandLevel"\r\n              [isRecordSize]="feature?.options?.isRecordSize" [enableFullTree]="feature?.options?.enableFullTree"\r\n              [loadTreeDataType]="\'default\'" [(ngModel)]="feature.value" [bindingData]="feature?.options?.data" [dictPicking]="feature?.options?.dictPicking" [dictPicked]="feature?.options?.dictPicked">\r\n            </farris-lookup-grid>\r\n          </ng-template>\r\n          \x3c!--输入框--\x3e\r\n          <ng-template\r\n            [ngIf]="feature?.editor?.controlType===\'textbox\' ||feature?.editor?.controlType===\'textarea\' || feature?.editor?.controlType === \'input-group\'">\r\n            \x3c!-- <ng-container *ngTemplateOutlet="textboxTemplate;context:input"></ng-container> --\x3e\r\n            <input-group [(ngModel)]="feature.value"></input-group>\r\n          </ng-template>\r\n          \x3c!--日期--\x3e\r\n          <ng-template [ngIf]="feature?.editor?.controlType === \'datepicker\'">\r\n            \x3c!-- <ng-container *ngTemplateOutlet="datepickerTemplate;context:input"></ng-container> --\x3e\r\n            <farris-datepicker [(ngModel)]="feature.value" [dateRange]="feature?.options?.dateRange">\r\n            </farris-datepicker>\r\n          </ng-template>\r\n          \x3c!--数字--\x3e\r\n          <ng-template [ngIf]="feature?.editor?.controlType === \'numberbox\'">\r\n            \x3c!-- <ng-container *ngTemplateOutlet="numberboxTemplate;context:input"></ng-container> --\x3e\r\n            <farris-number-spinner [(ngModel)]="feature.value" [min]="feature?.options?.min"\r\n              [max]="feature?.options?.max" [precision]="feature?.options?.precision" [step]="feature?.options?.step">\r\n            </farris-number-spinner>\r\n          </ng-template>\r\n          \x3c!--下拉--\x3e\r\n          <ng-template\r\n            [ngIf]="feature?.editor?.controlType === \'combolist\' || feature?.editor?.controlType === \'select\'">\r\n            \x3c!-- <ng-container *ngTemplateOutlet="combolistTemplate;context:input"></ng-container> --\x3e\r\n            <farris-combo-list [(ngModel)]="feature.value"\r\n              [idField]="feature?.options?.valueField || feature?.options?.idField || \'id\'"\r\n              [textField]="feature?.options?.textField ||\'label\'" [data]="feature?.options?.data">\r\n            </farris-combo-list>\r\n          </ng-template>\r\n          \x3c!--时间--\x3e\r\n          <ng-template [ngIf]="feature?.editor?.controlType === \'timepicker\'">\r\n            \x3c!-- <ng-container *ngTemplateOutlet="timepickerTemplate;context:input"></ng-container> --\x3e\r\n            <farris-time-picker [(ngModel)]="feature.value" [use12Hours]="feature?.options?.use12Hours">\r\n            </farris-time-picker>\r\n          </ng-template>\r\n          \x3c!--复选框--\x3e\r\n          <ng-template [ngIf]="feature?.editor?.controlType === \'checkbox\'">\r\n            <div class="custom-control custom-checkbox f-checkradio-single pl-5">\r\n              <input [id]="feature.id" class="custom-control-input" type="checkbox" [(ngModel)]="feature.value">\r\n              <label class="custom-control-label" [for]="feature.id"></label>\r\n            </div>\r\n          </ng-template>\r\n          \x3c!--开关--\x3e\r\n          <ng-template [ngIf]="feature?.editor?.controlType === \'switch\'">\r\n            <farris-switch [(ngModel)]="feature.value" class="ml-5">\r\n            </farris-switch>\r\n          </ng-template>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</farris-section>',styles:["feature-editor.component.css"]}]}],S.ctorParameters=function(){return[{type:m.LocaleService}]},S.propDecorators={features:[{type:v.Input}]},S);function S(e){this.localeService=e,this.localeService&&(this.localeId=this.localeService.localeId)}var w=(Object.defineProperty(T.prototype,"title",{get:function(){var e="特性编辑器";switch(this.localeId){case"en":e="Feature Editor";break;case"zh-CHT":e="特性編輯器"}return e},enumerable:!0,configurable:!0}),T.decorators=[{type:v.Injectable}],T.ctorParameters=function(){return[{type:String,decorators:[{type:v.Optional},{type:v.Inject,args:[v.LOCALE_ID]}]}]},T);function T(e){this.localeId=e}var I=(F.prototype.show=function(c,p){var f=this;!c||c.length<1||this.canOpen(p).subscribe(function(e){if(e){var t=f.componentFactoryResolver.resolveComponentFactory(k);f.componentRef=t.create(f.injector),f.componentRef.instance.features=c;var r=f.languageService.title,n=f.localeService.getValue("batchEditDialog.okText"),o=f.localeService.getValue("batchEditDialog.cancelText"),i=p||{},a=i.width,s=i.height,l=i.title,u={title:void 0===l?r:l,width:void 0===a?470:a,height:void 0===s?500:s,buttons:[{text:o,cls:"btn btn-secondary",handle:function(){f.dialog.close()}},{text:n,cls:"btn btn-primary",handle:function(){f.onConfirmClick(p)}}],showButtons:!0,areaResponse:!0,opened:function(e){f.registerShortcutKey(p,e.instance)},closed:function(){f.keyDownHandler&&(f.keyDownHandler(),f.keyDownHandler=null)}};f.dialog=f.modalService.show(f.componentRef,u)}})},F.prototype.registerShortcutKey=function(t,e){var r=this,n=e.dialog.location.nativeElement;n&&!this.keyDownHandler&&(this.keyDownHandler=this.eventManager.addEventListener(n,"keydown",function(e){e.stopPropagation(),"Enter"===e.key?r.onConfirmClick(t):"Escape"===e.key?r.dialog.close():"Tab"===e.key&&r.onTabKeydownHandler(e.target)})),this.componentRef&&this.setFirstInputFocus()},F.prototype.setFirstInputFocus=function(){var e=this.componentRef.location.nativeElement.querySelector("input,textarea");e&&e.focus()},F.prototype.onTabKeydownHandler=function(t){var e=this.componentRef.location.nativeElement.querySelectorAll("input,textarea"),r=(e=Array.from(e)).findIndex(function(e){return e===t})+1;r>=e.length&&(r=0);var n=e[r];n&&setTimeout(function(){n.focus()})},F.prototype.onConfirmClick=function(t){var r=this;this.canClose(t).subscribe(function(e){!0===e&&r.onConfirm(t)})},F.prototype.onConfirm=function(e){var t=this.componentRef&&this.componentRef.instance&&this.componentRef.instance.features||[];this.dialog.close(),e.onConfirm&&(e.onConfirm,1)&&e.onConfirm(t),this.onUserConfirmed.next(t)},F.prototype.canClose=function(e){var t=this.componentRef&&this.componentRef.instance&&this.componentRef.instance.features||[],r=e&&e.onConfirming||null;if(!r)return y.of(!0);var n=r(t);return y.isObservable(n)?n:y.of(n)},F.prototype.canOpen=function(e){var t=e&&e.onOpening||null;if(!t)return y.of(!0);var r=t(e);return y.isObservable(r)?r:y.of(r)},F.decorators=[{type:v.Injectable}],F.ctorParameters=function(){return[{type:v.Injector},{type:c.BsModalService},{type:v.ComponentFactoryResolver},{type:m.LocaleService},{type:w}]},F);function F(e,t,r,n,o){if(this.injector=e,this.modalService=t,this.componentFactoryResolver=r,this.localeService=n,this.languageService=o,this.dialog=null,this.componentRef=null,this.keyDownHandler=null,this.onUserConfirmed=new v.EventEmitter,!this.languageService){var i=this.injector.get(v.LOCALE_ID,"zh-CHS");this.languageService=new w(i)}this.eventManager=this.injector.get(s.EventManager,null)}var C=(M.prototype.ngAfterViewInit=function(){var t=this;this.lookup&&(this.lookup.dictPicked=function(e){return t.onSelectRows&&t.onSelectRows.emit({code:t.code,rows:[].concat(e)}),y.of({closeDialog:!0})})},M.decorators=[{type:v.Directive,args:[{selector:"[lookup-extra]"}]}],M.ctorParameters=function(){return[]},M.propDecorators={code:[{type:v.Input,args:["lookup-extra"]}],lookup:[{type:v.Input,args:["ins"]}],onSelectRows:[{type:v.Output}]},M);function M(){this.onSelectRows=new v.EventEmitter}var R=(O.decorators=[{type:v.NgModule,args:[{declarations:[k,C],imports:[r.CommonModule,n.FormsModule,o.FarrisFormsModule,i.LookupModule,l.ComboListModule,u.InputGroupModule,c.ModalModule,p.FarrisDatePickerModule,f.NumberSpinnerModule,d.TimePickerModule,g.SwitchModule,h.FarrisSectionModule,m.LocaleModule.forRoot()],exports:[k,C],entryComponents:[k],providers:[w]}]}],O);function O(){}e.InputType={Help:"Help",String:"String",Enum:"Enum",Date:"Date"},e.LookupService=x,e.FeatureEditorService=I,e.I18nService=w,e.FeatureEditorComponent=k,e.FeatureEditorModule=R,e.ɵa=C,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=farris-ui-feature-editor.umd.min.js.map
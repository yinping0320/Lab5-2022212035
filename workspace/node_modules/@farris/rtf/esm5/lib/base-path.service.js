/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Injectable } from '@angular/core';
import { GSPFrameworkService } from './core/gsp-framework.service';
var BasePathService = /** @class */ (function () {
    function BasePathService() {
    }
    /**
     * @return {?}
     */
    BasePathService.getService = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var gspFrameworkService = GSPFrameworkService.getGSPFrameworkService();
        /** @type {?} */
        var service = gspFrameworkService && gspFrameworkService.common;
        return service;
    };
    /**
     * 获取基路径.
     * @param defaultValue - 当基路径为空或不存在时使用的默认值，默认为空字符.
     * @returns
     */
    /**
     * 获取基路径.
     * @param {?=} defaultValue - 当基路径为空或不存在时使用的默认值，默认为空字符.
     * @return {?}
     */
    BasePathService.getBasePath = /**
     * 获取基路径.
     * @param {?=} defaultValue - 当基路径为空或不存在时使用的默认值，默认为空字符.
     * @return {?}
     */
    function (defaultValue) {
        if (defaultValue === void 0) { defaultValue = ''; }
        /** @type {?} */
        var service = this.getService();
        if (service && service.getBasePath) {
            return service && service.getBasePath && service.getBasePath.get() || defaultValue;
        }
        else {
            /** @type {?} */
            var hash = window.location.hash;
            /** @type {?} */
            var params = this.parseParam(hash);
            /** @type {?} */
            var basePath = params['base-path'] || '';
            return basePath;
        }
    };
    /**
     * 在绝对路径的基础上增加基路径.
     * @param path - 原始地址.
     * @param defaultValue - 默认值.
     * @returns
     */
    /**
     * 在绝对路径的基础上增加基路径.
     * @param {?} path - 原始地址.
     * @param {?=} defaultValue - 默认值.
     * @return {?}
     */
    BasePathService.convertPath = /**
     * 在绝对路径的基础上增加基路径.
     * @param {?} path - 原始地址.
     * @param {?=} defaultValue - 默认值.
     * @return {?}
     */
    function (path, defaultValue) {
        if (defaultValue === void 0) { defaultValue = ''; }
        if (!path) {
            return path;
        }
        /** @type {?} */
        var basePath = this.getBasePath(defaultValue);
        if (basePath) {
            /** @type {?} */
            var basePaths = basePath.split('/').filter(function (p) { return p; });
            if (basePaths.length > 0) {
                /** @type {?} */
                var baseURL = basePaths.join('/');
                if (path.indexOf('://') > 0 || path.indexOf('//') === 0) {
                    // absolute url, like http://localhost:5200/api/runtime/xxx or http://localhost or //localhost
                    if (path.startsWith('//')) {
                        /** @type {?} */
                        var url = path.slice(2);
                        // url中是否包含基路径
                        if (url.indexOf('/') === -1) {
                            // 不包含基路径，域名+端口, convert from //localhost:5200 to //localhost:5200/base_path
                            return path + '/' + baseURL;
                        }
                        else {
                            // 包含基路径
                            url = url.slice(0, url.indexOf('/')) + '/' + baseURL + url.slice(url.indexOf('/'));
                            return '//' + url;
                        }
                    }
                    else {
                        // like http://localhost:5200
                        /** @type {?} */
                        var protocol = path.slice(0, path.indexOf(':') + 1);
                        /** @type {?} */
                        var url = path.slice(path.indexOf(':') + 1);
                        url = url.slice(2);
                        if (url.indexOf('/') === -1) {
                            // 不包含基路径，域名+端口, convert from //localhost:5200 to //localhost:5200/base_path
                            return path + '/' + baseURL;
                        }
                        else {
                            // 包含基路径
                            url = url.slice(0, url.indexOf('/')) + '/' + baseURL + url.slice(url.indexOf('/'));
                            return protocol + '//' + url;
                        }
                    }
                    // return path.endsWith('/') ? `${path}${baseURL}/` : `${path}/${baseURL}`;
                }
                else {
                    return path.startsWith('/') ? "/" + baseURL + path : "/" + baseURL + "/" + path;
                }
            }
            else {
                return path;
            }
        }
        else {
            return path;
        }
    };
    /**
     * @param {?} queryString
     * @return {?}
     */
    BasePathService.parseParam = /**
     * @param {?} queryString
     * @return {?}
     */
    function (queryString) {
        if (!queryString) {
            return {};
        }
        /** @type {?} */
        var hashes = queryString.slice(queryString.indexOf('?') + 1).split('&');
        return hashes.reduce(function (params, hash) {
            var _a;
            /** @type {?} */
            var split = hash.indexOf('=');
            /** @type {?} */
            var key = hash.slice(0, split);
            /** @type {?} */
            var val = hash.slice(split + 1);
            return Object.assign(params, (_a = {}, _a[key] = decodeURIComponent(val), _a));
        }, {});
    };
    BasePathService.decorators = [
        { type: Injectable }
    ];
    /** @nocollapse */
    BasePathService.ctorParameters = function () { return []; };
    return BasePathService;
}());
export { BasePathService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmFzZS1wYXRoLnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL3J0Zi8iLCJzb3VyY2VzIjpbImxpYi9iYXNlLXBhdGguc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUMzQyxPQUFPLEVBQUUsbUJBQW1CLEVBQUUsTUFBTSw4QkFBOEIsQ0FBQztBQUVuRTtJQUVFO0lBQWdCLENBQUM7Ozs7SUFDSCwwQkFBVTs7O0lBQXhCOztZQUNRLG1CQUFtQixHQUFHLG1CQUFtQixDQUFDLHNCQUFzQixFQUFFOztZQUNsRSxPQUFPLEdBQUcsbUJBQW1CLElBQUksbUJBQW1CLENBQUMsTUFBTTtRQUNqRSxPQUFPLE9BQU8sQ0FBQztJQUNqQixDQUFDO0lBQ0Q7Ozs7T0FJRzs7Ozs7O0lBQ1csMkJBQVc7Ozs7O0lBQXpCLFVBQTBCLFlBQXlCO1FBQXpCLDZCQUFBLEVBQUEsaUJBQXlCOztZQUMzQyxPQUFPLEdBQUcsSUFBSSxDQUFDLFVBQVUsRUFBRTtRQUNqQyxJQUFJLE9BQU8sSUFBSSxPQUFPLENBQUMsV0FBVyxFQUFFO1lBQ2xDLE9BQU8sT0FBTyxJQUFJLE9BQU8sQ0FBQyxXQUFXLElBQUksT0FBTyxDQUFDLFdBQVcsQ0FBQyxHQUFHLEVBQUUsSUFBSSxZQUFZLENBQUM7U0FDcEY7YUFBTTs7Z0JBQ0MsSUFBSSxHQUFHLE1BQU0sQ0FBQyxRQUFRLENBQUMsSUFBSTs7Z0JBQzNCLE1BQU0sR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQzs7Z0JBQzlCLFFBQVEsR0FBRyxNQUFNLENBQUMsV0FBVyxDQUFDLElBQUksRUFBRTtZQUMxQyxPQUFPLFFBQVEsQ0FBQztTQUNqQjtJQUNILENBQUM7SUFDRDs7Ozs7T0FLRzs7Ozs7OztJQUNXLDJCQUFXOzs7Ozs7SUFBekIsVUFBMEIsSUFBWSxFQUFFLFlBQXlCO1FBQXpCLDZCQUFBLEVBQUEsaUJB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QUNYOztZQUNLLE1BQU0sR0FBRyxXQUFXLENBQUMsS0FBSyxDQUFDLFdBQVcsQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQztRQUN6RSxPQUFPLE1BQU0sQ0FBQyxNQUFNLENBQUMsVUFBQyxNQUFNLEVBQUUsSUFBSTs7O2dCQUMxQixLQUFLLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUM7O2dCQUN6QixHQUFHLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUUsS0FBSyxDQUFDOztnQkFDMUIsR0FBRyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsS0FBSyxHQUFHLENBQUMsQ0FBQztZQUNqQyxPQUFPLE1BQU0sQ0FBQyxNQUFNLENBQUMsTUFBTSxZQUFJLEdBQUMsR0FBRyxJQUFHLGtCQUFrQixDQUFDLEdBQUcsQ0FBQyxNQUFHLENBQUM7UUFDbkUsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDO0lBQ1QsQ0FBQzs7Z0JBeEZGLFVBQVU7Ozs7SUF5Rlgsc0JBQUM7Q0FBQSxBQXpGRCxJQXlGQztTQXhGWSxlQUFlIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBHU1BGcmFtZXdvcmtTZXJ2aWNlIH0gZnJvbSAnLi9jb3JlL2dzcC1mcmFtZXdvcmsuc2VydmljZSc7XHJcblxyXG5ASW5qZWN0YWJsZSgpXHJcbmV4cG9ydCBjbGFzcyBCYXNlUGF0aFNlcnZpY2Uge1xyXG4gIGNvbnN0cnVjdG9yKCkgeyB9XHJcbiAgcHVibGljIHN0YXRpYyBnZXRTZXJ2aWNlKCkge1xyXG4gICAgY29uc3QgZ3NwRnJhbWV3b3JrU2VydmljZSA9IEdTUEZyYW1ld29ya1NlcnZpY2UuZ2V0R1NQRnJhbWV3b3JrU2VydmljZSgpO1xyXG4gICAgY29uc3Qgc2VydmljZSA9IGdzcEZyYW1ld29ya1NlcnZpY2UgJiYgZ3NwRnJhbWV3b3JrU2VydmljZS5jb21tb247XHJcbiAgICByZXR1cm4gc2VydmljZTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog6I635Y+W5Z+66Lev5b6ELlxyXG4gICAqIEBwYXJhbSBkZWZhdWx0VmFsdWUgLSDlvZPln7rot6/lvoTkuLrnqbrmiJbkuI3lrZjlnKjml7bkvb/nlKjnmoTpu5jorqTlgLzvvIzpu5jorqTkuLrnqbrlrZfnrKYuXHJcbiAgICogQHJldHVybnNcclxuICAgKi9cclxuICBwdWJsaWMgc3RhdGljIGdldEJhc2VQYXRoKGRlZmF1bHRWYWx1ZTogc3RyaW5nID0gJycpIHtcclxuICAgIGNvbnN0IHNlcnZpY2UgPSB0aGlzLmdldFNlcnZpY2UoKTtcclxuICAgIGlmIChzZXJ2aWNlICYmIHNlcnZpY2UuZ2V0QmFzZVBhdGgpIHtcclxuICAgICAgcmV0dXJuIHNlcnZpY2UgJiYgc2VydmljZS5nZXRCYXNlUGF0aCAmJiBzZXJ2aWNlLmdldEJhc2VQYXRoLmdldCgpIHx8IGRlZmF1bHRWYWx1ZTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGNvbnN0IGhhc2ggPSB3aW5kb3cubG9jYXRpb24uaGFzaDtcclxuICAgICAgY29uc3QgcGFyYW1zID0gdGhpcy5wYXJzZVBhcmFtKGhhc2gpO1xyXG4gICAgICBjb25zdCBiYXNlUGF0aCA9IHBhcmFtc1snYmFzZS1wYXRoJ10gfHwgJyc7XHJcbiAgICAgIHJldHVybiBiYXNlUGF0aDtcclxuICAgIH1cclxuICB9XHJcbiAgLyoqXHJcbiAgICog5Zyo57ud5a+56Lev5b6E55qE5Z+656GA5LiK5aKe5Yqg5Z+66Lev5b6ELlxyXG4gICAqIEBwYXJhbSBwYXRoIC0g5Y6f5aeL5Zyw5Z2ALlxyXG4gICAqIEBwYXJhbSBkZWZhdWx0VmFsdWUgLSDpu5jorqTlgLwuXHJcbiAgICogQHJldHVybnNcclxuICAgKi9cclxuICBwdWJsaWMgc3RhdGljIGNvbnZlcnRQYXRoKHBhdGg6IHN0cmluZywgZGVmYXVsdFZhbHVlOiBzdHJpbmcgPSAnJykge1xyXG4gICAgaWYgKCFwYXRoKSB7XHJcbiAgICAgIHJldHVybiBwYXRoO1xyXG4gICAgfVxyXG4gICAgY29uc3QgYmFzZVBhdGggPSB0aGlzLmdldEJhc2VQYXRoKGRlZmF1bHRWYWx1ZSk7XHJcbiAgICBpZiAoYmFzZVBhdGgpIHtcclxuICAgICAgY29uc3QgYmFzZVBhdGhzID0gYmFzZVBhdGguc3BsaXQoJy8nKS5maWx0ZXIoKHApID0+IHApO1xyXG4gICAgICBpZiAoYmFzZVBhdGhzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICBjb25zdCBiYXNlVVJMID0gYmFzZVBhdGhzLmpvaW4oJy8nKTtcclxuICAgICAgICBpZiAocGF0aC5pbmRleE9mKCc6Ly8nKSA+IDAgfHwgcGF0aC5pbmRleE9mKCcvLycpID09PSAwKSB7XHJcbiAgICAgICAgICAvLyBhYnNvbHV0ZSB1cmwsIGxpa2UgaHR0cDovL2xvY2FsaG9zdDo1MjAwL2FwaS9ydW50aW1lL3h4eCBvciBodHRwOi8vbG9jYWxob3N0IG9yIC8vbG9jYWxob3N0XHJcbiAgICAgICAgICBpZiAocGF0aC5zdGFydHNXaXRoKCcvLycpKSB7XHJcbiAgICAgICAgICAgIGxldCB1cmwgPSBwYXRoLnNsaWNlKDIpO1xyXG4gICAgICAgICAgICAvLyB1cmzkuK3mmK/lkKbljIXlkKvln7rot6/lvoRcclxuICAgICAgICAgICAgaWYgKHVybC5pbmRleE9mKCcvJykgPT09IC0xKSB7XHJcbiAgICAgICAgICAgICAgLy8g5LiN5YyF5ZCr5Z+66Lev5b6E77yM5Z+f5ZCNK+err+WPoywgY29udmVydCBmcm9tIC8vbG9jYWxob3N0OjUyMDAgdG8gLy9sb2NhbGhvc3Q6NTIwMC9iYXNlX3BhdGhcclxuICAgICAgICAgICAgICByZXR1cm4gcGF0aCArICcvJyArIGJhc2VVUkw7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgLy8g5YyF5ZCr5Z+66Lev5b6EXHJcbiAgICAgICAgICAgICAgdXJsID0gdXJsLnNsaWNlKDAsIHVybC5pbmRleE9mKCcvJykpICsgJy8nICsgYmFzZVVSTCArIHVybC5zbGljZSh1cmwuaW5kZXhPZignLycpKTtcclxuICAgICAgICAgICAgICByZXR1cm4gJy8vJyArIHVybDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgLy8gbGlrZSBodHRwOi8vbG9jYWxob3N0OjUyMDBcclxuICAgICAgICAgICAgY29uc3QgcHJvdG9jb2wgPSBwYXRoLnNsaWNlKDAsIHBhdGguaW5kZXhPZignOicpICsgMSk7XHJcbiAgICAgICAgICAgIGxldCB1cmwgPSBwYXRoLnNsaWNlKHBhdGguaW5kZXhPZignOicpICsgMSk7XHJcbiAgICAgICAgICAgIHVybCA9IHVybC5zbGljZSgyKTtcclxuICAgICAgICAgICAgaWYgKHVybC5pbmRleE9mKCcvJykgPT09IC0xKSB7XHJcbiAgICAgICAgICAgICAgLy8g5LiN5YyF5ZCr5Z+66Lev5b6E77yM5Z+f5ZCNK+err+WPoywgY29udmVydCBmcm9tIC8vbG9jYWxob3N0OjUyMDAgdG8gLy9sb2NhbGhvc3Q6NTIwMC9iYXNlX3BhdGhcclxuICAgICAgICAgICAgICByZXR1cm4gcGF0aCArICcvJyArIGJhc2VVUkw7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgLy8g5YyF5ZCr5Z+66Lev5b6EXHJcbiAgICAgICAgICAgICAgdXJsID0gdXJsLnNsaWNlKDAsIHVybC5pbmRleE9mKCcvJykpICsgJy8nICsgYmFzZVVSTCArIHVybC5zbGljZSh1cmwuaW5kZXhPZignLycpKTtcclxuICAgICAgICAgICAgICByZXR1cm4gcHJvdG9jb2wgKyAnLy8nICsgdXJsO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICAvLyByZXR1cm4gcGF0aC5lbmRzV2l0aCgnLycpID8gYCR7cGF0aH0ke2Jhc2VVUkx9L2AgOiBgJHtwYXRofS8ke2Jhc2VVUkx9YDtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgcmV0dXJuIHBhdGguc3RhcnRzV2l0aCgnLycpID8gYC8ke2Jhc2VVUkx9JHtwYXRofWAgOiBgLyR7YmFzZVVSTH0vJHtwYXRofWA7XHJcbiAgICAgICAgfVxyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHJldHVybiBwYXRoO1xyXG4gICAgICB9XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICByZXR1cm4gcGF0aDtcclxuICAgIH1cclxuICB9XHJcbiAgcHVibGljIHN0YXRpYyBwYXJzZVBhcmFtKHF1ZXJ5U3RyaW5nOiBzdHJpbmcpOiB7IFtwcm9wTmFtZTogc3RyaW5nXTogYW55IH0ge1xyXG4gICAgaWYgKCFxdWVyeVN0cmluZykge1xyXG4gICAgICByZXR1cm4ge307XHJcbiAgICB9XHJcbiAgICBjb25zdCBoYXNoZXMgPSBxdWVyeVN0cmluZy5zbGljZShxdWVyeVN0cmluZy5pbmRleE9mKCc/JykgKyAxKS5zcGxpdCgnJicpO1xyXG4gICAgcmV0dXJuIGhhc2hlcy5yZWR1Y2UoKHBhcmFtcywgaGFzaCkgPT4ge1xyXG4gICAgICBjb25zdCBzcGxpdCA9IGhhc2guaW5kZXhPZignPScpO1xyXG4gICAgICBjb25zdCBrZXkgPSBoYXNoLnNsaWNlKDAsIHNwbGl0KTtcclxuICAgICAgY29uc3QgdmFsID0gaGFzaC5zbGljZShzcGxpdCArIDEpO1xyXG4gICAgICByZXR1cm4gT2JqZWN0LmFzc2lnbihwYXJhbXMsIHsgW2tleV06IGRlY29kZVVSSUNvbXBvbmVudCh2YWwpIH0pO1xyXG4gICAgfSwge30pO1xyXG4gIH1cclxufVxyXG4iXX0=
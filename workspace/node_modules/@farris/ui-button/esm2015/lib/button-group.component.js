/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { NgZone, ChangeDetectionStrategy, } from "@angular/core";
import { ChangeDetectorRef, } from "@angular/core";
import { Component, Input, Output, EventEmitter, ViewChild, ElementRef, } from "@angular/core";
import { Subject } from "rxjs";
import { CommonUtils, IdService, OverLayHiddenService } from "@farris/ui-common";
/**
 * @return {?}
 */
function hideBtnMenu() {
    /** @type {?} */
    const ddm = document.querySelector(".ff-btn-group-dropdown-menu.show");
    if (ddm) {
        ddm.className = ddm.className.replace("show", "");
    }
}
/**
 * @param {?} e
 * @return {?}
 */
function hideButtonMenu(e) {
    if (!e.target) {
        return;
    }
    /** @type {?} */
    var classList = Array.from(e.target.classList || []);
    if (e.target.nodeName !== "LI" && !e.target.closest('li.dropdown-item') && !classList.includes("dropdown-item")) {
        hideBtnMenu();
    }
}
export class FarrisButtonGroupComponent {
    /**
     * @param {?} changeRef
     * @param {?} ngZone
     */
    constructor(changeRef, ngZone) {
        this.changeRef = changeRef;
        this.ngZone = ngZone;
        // 是否自动纠正位置
        this.autoRectify = true;
        /*
            * 按钮适应外层宽度
            * 默认是：false 不限定按钮宽度，true 按钮适应外层宽度，显示不全，按钮文字出现省略号和提示
            */
        this.adaptToOuterWidth = false;
        // 计算方向的真正placement
        this.realPlacement = "bottom-right";
        // 重新计算后的placement
        this.rectifyPlacement = "bottom-right";
        /* 显示的按钮数量  默认为2 */
        this.count = 2;
        /* 按钮大小 */
        this.size = "small";
        /* 按钮样式 */
        this.type = "primary";
        /* 按钮展示位置 */
        this._placement = "bottom";
        /* menu size */
        /**
         * 2021.06.12 废弃，因为使用者不知道在中英文情况下，下拉面板的宽度和高度
         */
        this.width = 120;
        this.height = 250;
        this._menuWidth = 0;
        this._menuHeight = 0;
        /* 下拉按钮 触发事件 */
        this.changeState = new EventEmitter();
        /* 下拉菜单项点击事件 */
        this.change = new EventEmitter();
        this.click = new EventEmitter();
        /* 触发下拉按钮面板区域之外的事件 */
        this.clickMenuOut = new EventEmitter();
        /**
         * 2021.06.12 废弃，因为当autoSize为true的时候，按钮显示不出来。
         */
        this.autoSize = false;
        /* 下拉面板显示 */
        this.show = false;
        this.setPosition$ = new Subject();
        this.btnmenuid = 'btn-menu-';
        this.previous = 0;
        this.commonUtils = new CommonUtils();
    }
    /**
     * @param {?} value
     * @return {?}
     */
    set placement(value) {
        if (!value) {
            return;
        }
        if (value !== this._placement) {
            this.realPlacement = this.getRealPlacement(value);
            this._placement = value;
        }
    }
    /**
     * @return {?}
     */
    get placement() {
        return this._placement;
    }
    /* 显示出来的按钮组 */
    /**
     * @return {?}
     */
    get flatButtons() {
        return this.data && this.data.slice(0, this.count);
    }
    /**
     * @return {?}
     */
    get dpButtons() {
        // this.height = this.dpButtons.length * 35;
        return this.data && this.data.slice(this.count);
    }
    /**
     * @private
     * @return {?}
     */
    btnmenuId() {
        /** @type {?} */
        const idSer = new IdService();
        this.btnmenuid += idSer.guid();
        this.overLayService = new OverLayHiddenService();
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.btnmenuId();
    }
    /**
     * @param {?} simpleChanges
     * @return {?}
     */
    ngOnChanges(simpleChanges) {
        if (simpleChanges["data"]) {
            // this.flatButtons = this.data.slice(0, this.count);
            // this.dpButtons = this.data.slice(this.count);
            // this.height = this.dpButtons.length * 35;
        }
    }
    /**
     * @return {?}
     */
    ngAfterViewInit() { }
    /**
     * @return {?}
     */
    ngAfterViewChecked() {
        if (this.show) {
            // const { height, width } = this.dpMenu.nativeElement.getBoundingClientRect();
            this.setPosition(this.event);
            // this.setPosition$.subscribe(res => this.setPosition(res, width, height));
        }
    }
    /**
     * @param {?} e
     * @return {?}
     */
    clickEvent(e) {
        e.stopPropagation();
        this.show = !(this.show && this.dpMenu.nativeElement.className.indexOf('show') > -1);
        // body添加面板
        if (this.show) {
            /** 移除现有的下拉展示菜单 */
            hideBtnMenu();
            this.appendBody();
            // this.setPosition(e);
            // this.setPosition$.next(e);
            // 注册鼠标滚轮，点击事件，用于隐藏Panel
            this.overLayService.registerMouseEvent(this.dpBtn.nativeElement, (/**
             * @param {?} e
             * @return {?}
             */
            (e) => {
                hideButtonMenu(e);
            }));
            this.event = e;
            // 绑定相应的事件
            this.ngZone.runOutsideAngular((/**
             * @return {?}
             */
            () => {
                this.bindMenuMouseenter();
                this.bindiMenuMouseleave();
                // this.bindDocClick();
                this.mouseNotEnterLeave();
            }));
        }
        // 面板显示 脏值检测
        this.changeRef.detectChanges();
        this.changeRef.markForCheck();
        // this.changeState.emit({ originEvent: e, show: this.show });
        this.changeState.emit(this.show);
    }
    /* 按钮触发事件 */
    /**
     * @param {?} e
     * @param {?} btn
     * @return {?}
     */
    toggle(e, btn) {
        e.stopPropagation();
        if (btn.disabled)
            return;
        this.show = false;
        // this.unbindDocClick();
        // 关闭下拉按钮面板  脏值检测
        this.changeRef.detectChanges();
        this.changeRef.markForCheck();
        this.change.emit(btn.id);
        this.click.emit(btn);
        if (this.dpBtn) {
            this.overLayService.destory(this.dpBtn.nativeElement);
        }
    }
    // 下拉按钮显示到body中  可改变面板方向
    /**
     * @return {?}
     */
    appendBody() {
        if (this.dpMenu.nativeElement && !document.querySelector('body>#' + this.btnmenuid)) {
            // 添加到body  便于全部显示
            document.body.appendChild(this.dpMenu.nativeElement);
        }
        this.dpMenu.nativeElement.className = this.dpMenu.nativeElement.className + ' show';
        this.dpMenu.nativeElement.style.zIndex = this.commonUtils.getFloatingLayerIndex();
    }
    /**
     * @return {?}
     */
    removeMenuPanel() {
        if (this.dpMenu.nativeElement && document.querySelector('body>#' + this.btnmenuid)) {
            this.dpMenu.nativeElement.remove();
        }
    }
    /**
     * 当下拉超出边界时  转换方向,
     * 并未处理，边界不够下拉展示的情况
     * @param {?} btnSize
     * @return {?}
     */
    changePlacement(btnSize) {
        if (!this.autoRectify) {
            return;
        }
        /** @type {?} */
        let referPosition = this.getReferencePosition();
        /** @type {?} */
        let newPlacement = this.realPlacement;
        if (newPlacement.indexOf("bottom") > -1) {
            if (this._menuHeight > referPosition.bottom - btnSize.bottom) {
                newPlacement = newPlacement.replace("bottom", "top");
            }
        }
        else if (newPlacement.indexOf("top") > -1) {
            if (this._menuHeight > btnSize.top - referPosition.top) {
                newPlacement = newPlacement.replace("top", "bottom");
            }
        }
        if (newPlacement.indexOf("left") > -1) {
            if (this._menuWidth > btnSize.left - referPosition.left) {
                newPlacement = newPlacement.replace("left", "right");
            }
        }
        else if (newPlacement.indexOf("right") > -1) {
            if (this._menuWidth > referPosition.right - btnSize.right) {
                newPlacement = newPlacement.replace("right", "left");
            }
        }
        this.rectifyPlacement = newPlacement;
    }
    /**
     * 确认参照的边界
     * @private
     * @return {?}
     */
    getReferencePosition() {
        /** @type {?} */
        let rRight = document.documentElement.clientWidth;
        /** @type {?} */
        let rBottom = document.documentElement.clientHeight;
        /** @type {?} */
        let rTop = 0;
        /** @type {?} */
        let rLeft = 0;
        // 横向参照
        if (this.rectifyReferenceH) {
            rRight = this.rectifyReferenceH.getBoundingClientRect().right;
            rLeft = this.rectifyReferenceH.getBoundingClientRect().left;
        }
        // 纵向参照
        if (this.rectifyReferenceV) {
            rBottom = this.rectifyReferenceV.getBoundingClientRect().bottom;
            rTop = this.rectifyReferenceV.getBoundingClientRect().top;
        }
        return { top: rTop, left: rLeft, right: rRight, bottom: rBottom };
    }
    /**
     * 变化对应的class
     * @param {?} position
     * @return {?}
     */
    _getClsName(position) {
        /** @type {?} */
        let className = "";
        switch (position) {
            case "top-right":
            case "top":
                // 朝上，朝上-朝右
                className = "dropup";
                break;
            case "top-left":
                // 朝上-朝左
                className = "dropup-left";
                break;
            case "left-bottom":
            case "left":
                // 横向——朝左——朝下
                className = "dropleft";
                break;
            case "left-top":
                // 横向——朝左——朝上
                className = "dropleft-up";
                break;
            case "right-bottom":
            case "right":
                // 横向——朝右——朝下
                className = "dropright";
                break;
            case "right-top":
                // 横向——朝右——朝上
                className = "dropright-up";
                break;
            case "bottom-left":
                // 朝下——朝左
                className = "dropdown-left";
                break;
            case "bottom-right":
                className = "dropdown";
                break;
            default:
                // 朝下，朝下——朝右
                className = "dropdown";
        }
        return className;
    }
    /**
     * @private
     * @param {?} pment
     * @return {?}
     */
    getRealPlacement(pment) {
        /** @type {?} */
        var result = "bottom-right";
        switch (pment) {
            case "top":
                result = "top-right";
                break;
            case "left":
                result = "left-bottom";
                break;
            case "right":
                result = "right-bottom";
                break;
            case "bottom":
                result = "bottom-right";
                break;
            default:
                result = pment;
        }
        return result;
    }
    /*
         * 计算的位置区分忒细化
         */
    /**
     * @private
     * @param {?} btnSize
     * @return {?}
     */
    changePosition(btnSize) {
        /** @type {?} */
        let rplacement = "";
        if (this.autoRectify) {
            rplacement = this.rectifyPlacement;
        }
        else {
            rplacement = this.realPlacement;
        }
        /** @type {?} */
        let styleTop = 0;
        /** @type {?} */
        let styleLeft = 0;
        if (rplacement.indexOf("top") > -1) {
            styleTop = btnSize.top - this._menuHeight;
        }
        else if (rplacement.indexOf("bottom") > -1) {
            styleTop = btnSize.bottom;
        }
        if (rplacement.indexOf("right") > -1) {
            styleLeft = btnSize.right;
        }
        else if (rplacement.indexOf("left") > -1) {
            styleLeft = btnSize.left - this._menuWidth;
        }
        // 开头
        if (rplacement.indexOf("-top") > -1) {
            styleTop = styleTop - btnSize.height;
        }
        else if (rplacement.indexOf("-bottom") > -1) {
            styleTop = styleTop + btnSize.height;
        }
        this.dpMenu.nativeElement.style.top = styleTop + "px";
        this.dpMenu.nativeElement.style.left = styleLeft + "px";
    }
    /* 绑定下拉面板鼠标进入事件 */
    /**
     * @return {?}
     */
    bindMenuMouseenter() {
        this.unbindMenuMouseenter();
        this.mouseenterEvent = this.changeFlagToTrue.bind(this);
        this.dpMenu.nativeElement.addEventListener("mouseenter", this.mouseenterEvent);
    }
    /* 绑定下拉面板鼠标离开事件  */
    /**
     * @return {?}
     */
    bindiMenuMouseleave() {
        this.unbindiMenuMouseleave();
        this.mouseleaveEvent = this.mouseLeave.bind(this);
        this.dpMenu.nativeElement.addEventListener("mouseleave", this.mouseleaveEvent);
    }
    /* 绑定点击面板区域之外触发的事件 */
    // bindDocClick() {
    //   this.documentClickEvent = this.clickDoc.bind(this);
    //   document.addEventListener('click', this.documentClickEvent);
    // }
    /* 解绑事件 */
    /**
     * @return {?}
     */
    unbindMenuMouseenter() {
        if (this.mouseenterEvent) {
            this.dpMenu.nativeElement.removeEventListener("mouseenter", this.mouseenterEvent);
        }
    }
    /**
     * @return {?}
     */
    unbindiMenuMouseleave() {
        if (this.mouseleaveEvent) {
            this.dpMenu.nativeElement.removeEventListener("mouseleave", this.mouseleaveEvent);
        }
    }
    // unbindDocClick() {
    //   if (this.documentClickEvent) {
    //     document.removeEventListener('click', this.documentClickEvent);
    //   }
    // }
    /* flag true */
    /**
     * @return {?}
     */
    changeFlagToTrue() {
        this.dpFlag = true;
    }
    /* flag false */
    /**
     * @return {?}
     */
    changeFlagToFalse() {
        this.dpFlag = false;
    }
    /* 鼠标离开时  关闭menu */
    /**
     * @return {?}
     */
    mouseLeave() {
        if (this.dpFlag) {
            this.changeFlagToFalse();
            // this.unbindDocClick();
            this.unbindiMenuMouseleave();
            this.unbindMenuMouseenter();
            this.close();
            if (this.setTimeObj) {
                this.ngZone.runOutsideAngular((/**
                 * @return {?}
                 */
                () => {
                    clearTimeout(this.setTimeObj);
                }));
            }
        }
    }
    /* 鼠标没有进入到面板  一段时间后面板自动消失 */
    /**
     * @return {?}
     */
    mouseNotEnterLeave() {
        this.ngZone.runOutsideAngular((/**
         * @return {?}
         */
        () => {
            if (this.setTimeObj) {
                clearTimeout(this.setTimeObj);
            }
            this.setTimeObj = setTimeout((/**
             * @return {?}
             */
            () => {
                if (!this.dpFlag) {
                    this.changeFlagToFalse();
                    // this.unbindDocClick();
                    this.unbindiMenuMouseleave();
                    this.unbindMenuMouseenter();
                    this.close();
                    if (this.setTimeObj) {
                        clearTimeout(this.setTimeObj);
                    }
                }
            }), 2000);
        }));
    }
    /* 关闭下拉面板 */
    /**
     * @return {?}
     */
    close() {
        this.show = false;
        // 关闭下拉按钮面板  脏值检测
        if (!this.changeRef["destroyed"]) {
            this.changeRef.detectChanges();
            this.changeRef.markForCheck();
        }
        this.dpBtn.nativeElement.blur();
        if (this.dpBtn && this.overLayService) {
            this.overLayService.destory(this.dpBtn.nativeElement);
        }
    }
    /* 动态指定menu在body中的位置 */
    /**
     * @private
     * @param {?} e
     * @return {?}
     */
    setPosition(e) {
        // 下拉按钮
        /** @type {?} */
        const btnSize = this.dpBtn.nativeElement.getBoundingClientRect();
        // 下拉面板
        /** @type {?} */
        let menuRect = this.dpMenu.nativeElement.getBoundingClientRect();
        this._menuHeight = menuRect.height;
        this._menuWidth = menuRect.width;
        // 如果要自动纠正方向
        if (this.autoRectify) {
            this.changePlacement(btnSize);
        }
        this.changePosition(btnSize);
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        // this.removeMenuPanel();
        if (this.dpBtn && this.dpBtn.nativeElement) {
            this.overLayService.destory(this.dpBtn.nativeElement);
        }
        this.overLayService = null;
    }
}
FarrisButtonGroupComponent.decorators = [
    { type: Component, args: [{
                selector: "farris-button-group",
                template: "<div class=\"f-btn-group\" [ngClass]=\"adaptToOuterWidth?'has-max-width':''\">\r\n    <div [class]=\"(size==='large'?'btn-group-lg':'btn-group-sm')+' btn-group f-btn-group-links'\">\r\n        <ng-container *ngFor=\"let btn of flatButtons\">\r\n            <ng-container *ngIf=\"btn.icon\">\r\n                <button [id]=\"btn.id\" class=\"btn btn-link btn-icontext\" [disabled]=\"btn.disabled\" (click)=\"toggle($event,btn)\">\r\n                    <i class=\"f-icon\"  [ngClass]=\"btn.icon\"></i>\r\n                </button>\r\n            </ng-container>\r\n            <ng-container *ngIf=\"!btn.icon\">\r\n            <button [id]=\"btn.id\"\r\n                [class]=\"'btn '+(btn.type?'btn-'+btn.type:'btn-link')+' '+ (btn.type && btn.type !== 'link' ? 'f-btn-ml' :'')\"\r\n                [disabled]=\"btn.disabled\" (click)=\"toggle($event,btn)\" [title]=\"adaptToOuterWidth?btn.text:''\">\r\n                {{btn.text}}\r\n            </button> \r\n            </ng-container>\r\n        </ng-container>\r\n    </div>\r\n    <ng-container *ngIf=\"dpButtons.length\">\r\n        <div class=\"btn-group f-btn-group-dropdown\">\r\n            <button #dpBtn type=\"button\" class=\"f-btn-dropdown\" (click)=\"clickEvent($event)\">\r\n                <span class=\"f-icon f-icon-lookup\"></span>\r\n            </button>\r\n            <div #dpMenu class=\"dropdown-menu ff-btn-group-dropdown-menu\" [class.show]=\"show\"  style=\"position:fixed;\" id=\"{{btnmenuid}}\">\r\n                <ng-container *ngFor=\"let dpBtn of dpButtons\">\r\n                    <div class=\"dropdown-divider\" *ngIf=\"dpBtn.divider\"></div>\r\n                    <li [id]=\"dpBtn.id\" class=\"dropdown-item\" [class.disabled]=\"dpBtn.disabled\"\r\n                        (click)=\"toggle($event,dpBtn)\">\r\n                        <ng-container *ngIf=\"dpBtn.icon\">\r\n                            <i class=\"f-icon dropdown-item-icon\" [ngClass]=\"dpBtn.icon\"></i>\r\n                        </ng-container>\r\n                        <span>{{dpBtn.text}}</span>\r\n                    </li>\r\n                </ng-container>\r\n            </div>\r\n        </div>\r\n    </ng-container>\r\n</div>",
                changeDetection: ChangeDetectionStrategy.OnPush,
                styles: [".f-btn-group.has-max-width{display:-webkit-box;display:flex;-webkit-box-align:center;align-items:center}.f-btn-group.has-max-width .f-btn-group-links{overflow:hidden}.f-btn-group.has-max-width .f-btn-group-links .btn{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}"]
            }] }
];
/** @nocollapse */
FarrisButtonGroupComponent.ctorParameters = () => [
    { type: ChangeDetectorRef },
    { type: NgZone }
];
FarrisButtonGroupComponent.propDecorators = {
    dpBtn: [{ type: ViewChild, args: ["dpBtn",] }],
    dpMenu: [{ type: ViewChild, args: ["dpMenu",] }],
    rectifyReferenceH: [{ type: Input }],
    rectifyReferenceV: [{ type: Input }],
    autoRectify: [{ type: Input }],
    adaptToOuterWidth: [{ type: Input }],
    data: [{ type: Input }],
    count: [{ type: Input }],
    size: [{ type: Input }],
    type: [{ type: Input }],
    placement: [{ type: Input }],
    width: [{ type: Input }],
    height: [{ type: Input }],
    changeState: [{ type: Output }],
    change: [{ type: Output }],
    click: [{ type: Output }],
    clickMenuOut: [{ type: Output }],
    autoSize: [{ type: Input }]
};
if (false) {
    /** @type {?} */
    FarrisButtonGroupComponent.prototype.dpBtn;
    /** @type {?} */
    FarrisButtonGroupComponent.prototype.dpMenu;
    /** @type {?} */
    FarrisButtonGroupComponent.prototype.rectifyReferenceH;
    /** @type {?} */
    FarrisButtonGroupComponent.prototype.rectifyReferenceV;
    /** @type {?} */
    FarrisButtonGroupComponent.prototype.autoRectify;
    /** @type {?} */
    FarrisButtonGroupComponent.prototype.adaptToOuterWidth;
    /**
     * @type {?}
     * @private
     */
    FarrisButtonGroupComponent.prototype.realPlacement;
    /** @type {?} */
    FarrisButtonGroupComponent.prototype.rectifyPlacement;
    /** @type {?} */
    FarrisButtonGroupComponent.prototype.data;
    /** @type {?} */
    FarrisButtonGroupComponent.prototype.count;
    /** @type {?} */
    FarrisButtonGroupComponent.prototype.size;
    /** @type {?} */
    FarrisButtonGroupComponent.prototype.type;
    /**
     * @type {?}
     * @private
     */
    FarrisButtonGroupComponent.prototype._placement;
    /**
     * 2021.06.12 废弃，因为使用者不知道在中英文情况下，下拉面板的宽度和高度
     * @type {?}
     */
    FarrisButtonGroupComponent.prototype.width;
    /** @type {?} */
    FarrisButtonGroupComponent.prototype.height;
    /**
     * @type {?}
     * @private
     */
    FarrisButtonGroupComponent.prototype._menuWidth;
    /**
     * @type {?}
     * @private
     */
    FarrisButtonGroupComponent.prototype._menuHeight;
    /** @type {?} */
    FarrisButtonGroupComponent.prototype.changeState;
    /** @type {?} */
    FarrisButtonGroupComponent.prototype.change;
    /** @type {?} */
    FarrisButtonGroupComponent.prototype.click;
    /** @type {?} */
    FarrisButtonGroupComponent.prototype.clickMenuOut;
    /**
     * 2021.06.12 废弃，因为当autoSize为true的时候，按钮显示不出来。
     * @type {?}
     */
    FarrisButtonGroupComponent.prototype.autoSize;
    /** @type {?} */
    FarrisButtonGroupComponent.prototype.show;
    /** @type {?} */
    FarrisButtonGroupComponent.prototype.setPosition$;
    /** @type {?} */
    FarrisButtonGroupComponent.prototype.event;
    /** @type {?} */
    FarrisButtonGroupComponent.prototype.dpFlag;
    /** @type {?} */
    FarrisButtonGroupComponent.prototype.mouseenterEvent;
    /** @type {?} */
    FarrisButtonGroupComponent.prototype.mouseleaveEvent;
    /** @type {?} */
    FarrisButtonGroupComponent.prototype.documentClickEvent;
    /** @type {?} */
    FarrisButtonGroupComponent.prototype.btnSize;
    /** @type {?} */
    FarrisButtonGroupComponent.prototype.setTimeObj;
    /** @type {?} */
    FarrisButtonGroupComponent.prototype.btnmenuid;
    /**
     * @type {?}
     * @private
     */
    FarrisButtonGroupComponent.prototype.previous;
    /** @type {?} */
    FarrisButtonGroupComponent.prototype.overLayService;
    /** @type {?} */
    FarrisButtonGroupComponent.prototype.commonUtils;
    /**
     * @type {?}
     * @private
     */
    FarrisButtonGroupComponent.prototype.changeRef;
    /**
     * @type {?}
     * @private
     */
    FarrisButtonGroupComponent.prototype.ngZone;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYnV0dG9uLWdyb3VwLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvdWktYnV0dG9uLyIsInNvdXJjZXMiOlsibGliL2J1dHRvbi1ncm91cC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFFSCxNQUFNLEVBQ04sdUJBQXVCLEdBSTFCLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFHSCxpQkFBaUIsR0FDcEIsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUNILFNBQVMsRUFFVCxLQUFLLEVBQ0wsTUFBTSxFQUNOLFlBQVksRUFDWixTQUFTLEVBQ1QsVUFBVSxHQUNiLE1BQU0sZUFBZSxDQUFDO0FBRXZCLE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDL0IsT0FBTyxFQUFFLFdBQVcsRUFBRSxTQUFTLEVBQUUsb0JBQW9CLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQzs7OztBQUVqRixTQUFTLFdBQVc7O1VBQ1YsR0FBRyxHQUFHLFFBQVEsQ0FBQyxhQUFhLENBQUMsa0NBQWtDLENBQUM7SUFDdEUsSUFBSSxHQUFHLEVBQUU7UUFDTCxHQUFHLENBQUMsU0FBUyxHQUFHLEdBQUcsQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDLE1BQU0sRUFBRSxFQUFFLENBQUMsQ0FBQztLQUNyRDtBQUNMLENBQUM7Ozs7O0FBRUQsU0FBUyxjQUFjLENBQUMsQ0FBQztJQUNyQixJQUFJLENBQUMsQ0FBQyxDQUFDLE1BQU0sRUFBRTtRQUNYLE9BQU87S0FDVjs7UUFFRyxTQUFTLEdBQUcsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLFNBQVMsSUFBSSxFQUFFLENBQUM7SUFFcEQsSUFBSSxDQUFDLENBQUMsTUFBTSxDQUFDLFFBQVEsS0FBSyxJQUFJLElBQUksQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxrQkFBa0IsQ0FBQyxJQUFJLENBQUMs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OztJQUcxQixnREFBOEI7Ozs7O0lBbUI5QiwyQ0FBcUI7O0lBQ3JCLDRDQUFzQjs7Ozs7SUFDdEIsZ0RBQXVCOzs7OztJQUN2QixpREFBd0I7O0lBR3hCLGlEQUFnRDs7SUFHaEQsNENBQTJDOztJQUMzQywyQ0FBMEM7O0lBRzFDLGtEQUFpRDs7Ozs7SUFLakQsOENBQTBCOztJQUcxQiwwQ0FBYTs7SUFZYixrREFBNkI7O0lBQzdCLDJDQUFXOztJQUdYLDRDQUFnQjs7SUFHaEIscURBQXFCOztJQUNyQixxREFBcUI7O0lBQ3JCLHdEQUF3Qjs7SUFHeEIsNkNBQWE7O0lBR2IsZ0RBQWdCOztJQUVuQiwrQ0FBd0I7Ozs7O0lBQ3hCLDhDQUFxQjs7SUFDbEIsb0RBQXFDOztJQUNyQyxpREFBeUI7Ozs7O0lBQ2IsK0NBQW9DOzs7OztJQUFFLDRDQUFzQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XHJcbiAgICBPbkRlc3Ryb3ksXHJcbiAgICBOZ1pvbmUsXHJcbiAgICBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneSxcclxuICAgIFJlbmRlcmVyMixcclxuICAgIE9uQ2hhbmdlcyxcclxuICAgIFNpbXBsZUNoYW5nZXMsXHJcbn0gZnJvbSBcIkBhbmd1bGFyL2NvcmVcIjtcclxuaW1wb3J0IHtcclxuICAgIEFmdGVyVmlld0luaXQsXHJcbiAgICBBZnRlclZpZXdDaGVja2VkLFxyXG4gICAgQ2hhbmdlRGV0ZWN0b3JSZWYsXHJcbn0gZnJvbSBcIkBhbmd1bGFyL2NvcmVcIjtcclxuaW1wb3J0IHtcclxuICAgIENvbXBvbmVudCxcclxuICAgIE9uSW5pdCxcclxuICAgIElucHV0LFxyXG4gICAgT3V0cHV0LFxyXG4gICAgRXZlbnRFbWl0dGVyLFxyXG4gICAgVmlld0NoaWxkLFxyXG4gICAgRWxlbWVudFJlZixcclxufSBmcm9tIFwiQGFuZ3VsYXIvY29yZVwiO1xyXG5pbXBvcnQgeyBCdXR0b24gfSBmcm9tIFwiLi9idXR0b25cIjtcclxuaW1wb3J0IHsgU3ViamVjdCB9IGZyb20gXCJyeGpzXCI7XHJcbmltcG9ydCB7IENvbW1vblV0aWxzLCBJZFNlcnZpY2UsIE92ZXJMYXlIaWRkZW5TZXJ2aWNlIH0gZnJvbSBcIkBmYXJyaXMvdWktY29tbW9uXCI7XHJcblxyXG5mdW5jdGlvbiBoaWRlQnRuTWVudSgpIHtcclxuICAgIGNvbnN0IGRkbSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZmYtYnRuLWdyb3VwLWRyb3Bkb3duLW1lbnUuc2hvd1wiKTtcclxuICAgIGlmIChkZG0pIHtcclxuICAgICAgICBkZG0uY2xhc3NOYW1lID0gZGRtLmNsYXNzTmFtZS5yZXBsYWNlKFwic2hvd1wiLCBcIlwiKTtcclxuICAgIH1cclxufVxyXG5cclxuZnVuY3Rpb24gaGlkZUJ1dHRvbk1lbnUoZSkge1xyXG4gICAgaWYgKCFlLnRhcmdldCkge1xyXG4gICAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICB2YXIgY2xhc3NMaXN0ID0gQXJyYXkuZnJvbShlLnRhcmdldC5jbGFzc0xpc3QgfHwgW10pO1xyXG5cclxuICAgIGlmIChlLnRhcmdldC5ub2RlTmFtZSAhPT0gXCJMSVwiICYmICFlLnRhcmdldC5jbG9zZXN0KCdsaS5kcm9wZG93bi1pdGVtJykgJiYgIWNsYXNzTGlzdC5pbmNsdWRlcyhcImRyb3Bkb3duLWl0ZW1cIikpIHtcclxuICAgICAgICBoaWRlQnRuTWVudSgpO1xyXG4gICAgfVxyXG59XHJcblxyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgICBzZWxlY3RvcjogXCJmYXJyaXMtYnV0dG9uLWdyb3VwXCIsXHJcbiAgICB0ZW1wbGF0ZVVybDogYC4vYnV0dG9uLWdyb3VwLmNvbXBvbmVudC5odG1sYCxcclxuICAgIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoLFxyXG4gICAgc3R5bGVVcmxzOltcIi4vYnV0dG9uLWdyb3VwLmNvbXBvbmVudC5zY3NzXCJdXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBGYXJyaXNCdXR0b25Hcm91cENvbXBvbmVudFxyXG4gICAgaW1wbGVtZW50cyBPbkluaXQsIE9uQ2hhbmdlcywgQWZ0ZXJWaWV3SW5pdCwgQWZ0ZXJWaWV3Q2hlY2tlZCwgT25EZXN0cm95XHJcbntcclxuICAgIEBWaWV3Q2hpbGQoXCJkcEJ0blwiKSBkcEJ0bjogRWxlbWVudFJlZjtcclxuICAgIEBWaWV3Q2hpbGQoXCJkcE1lbnVcIikgZHBNZW51OiBFbGVtZW50UmVmO1xyXG4gICAgLy8g5qiq5ZCR57qg5q2j55qE5Y+C54WnXHJcbiAgICBASW5wdXQoKSByZWN0aWZ5UmVmZXJlbmNlSDogSFRNTEVsZW1lbnQ7XHJcbiAgICAvLyDnurXlkJHnuqDmraPnmoTlj4LnhadcclxuICAgIEBJbnB1dCgpIHJlY3RpZnlSZWZlcmVuY2VWOiBIVE1MRWxlbWVudDtcclxuICAgIC8vIOaYr+WQpuiHquWKqOe6oOato+S9jee9rlxyXG4gICAgQElucHV0KCkgYXV0b1JlY3RpZnkgPSB0cnVlO1xyXG4gICAgLypcclxuICAgICog5oyJ6ZKu6YCC5bqU5aSW5bGC5a695bqmXHJcbiAgICAqIOm7mOiupOaYr++8mmZhbHNlIOS4jemZkOWumuaMiemSruWuveW6pu+8jHRydWUg5oyJ6ZKu6YCC5bqU5aSW5bGC5a695bqm77yM5pi+56S65LiN5YWo77yM5oyJ6ZKu5paH5a2X5Ye6546w55yB55Wl5Y+35ZKM5o+Q56S6XHJcbiAgICAqL1xyXG4gICAgQElucHV0KCkgYWRhcHRUb091dGVyV2lkdGg9ZmFsc2U7XHJcbiAgICAvLyDorqHnrpfmlrnlkJHnmoTnnJ/mraNwbGFjZW1lbnRcclxuICAgIHByaXZhdGUgcmVhbFBsYWNlbWVudCA9IFwiYm90dG9tLXJpZ2h0XCI7XHJcbiAgICAvLyDph43mlrDorqHnrpflkI7nmoRwbGFjZW1lbnRcclxuICAgIHJlY3RpZnlQbGFjZW1lbnQgPSBcImJvdHRvbS1yaWdodFwiO1xyXG5cclxuICAgIC8qIOaMiemSruS/oeaBryAqL1xyXG4gICAgQElucHV0KCkgZGF0YTogQnV0dG9uW107XHJcblxyXG4gICAgLyog5pi+56S655qE5oyJ6ZKu5pWw6YePICDpu5jorqTkuLoyICovXHJcbiAgICBASW5wdXQoKSBjb3VudCA9IDI7XHJcblxyXG4gICAgLyog5oyJ6ZKu5aSn5bCPICovXHJcbiAgICBASW5wdXQoKSBzaXplID0gXCJzbWFsbFwiO1xyXG5cclxuICAgIC8qIOaMiemSruagt+W8jyAqL1xyXG4gICAgQElucHV0KCkgdHlwZSA9IFwicHJpbWFyeVwiO1xyXG5cclxuICAgIC8qIOaMiemSruWxleekuuS9jee9riAqL1xyXG4gICAgcHJpdmF0ZSBfcGxhY2VtZW50ID0gXCJib3R0b21cIjtcclxuICAgIEBJbnB1dCgpXHJcbiAgICBzZXQgcGxhY2VtZW50KHZhbHVlKSB7XHJcbiAgICAgICAgaWYgKCF2YWx1ZSkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh2YWx1ZSAhPT0gdGhpcy5fcGxhY2VtZW50KSB7XHJcbiAgICAgICAgICAgIHRoaXMucmVhbFBsYWNlbWVudCA9IHRoaXMuZ2V0UmVhbFBsYWNlbWVudCh2YWx1ZSk7XHJcbiAgICAgICAgICAgIHRoaXMuX3BsYWNlbWVudCA9IHZhbHVlO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGdldCBwbGFjZW1lbnQoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3BsYWNlbWVudDtcclxuICAgIH1cclxuXHJcbiAgICAvKiBtZW51IHNpemUgKi9cclxuICAgIC8qKlxyXG4gICAgICoyMDIxLjA2LjEyIOW6n+W8g++8jOWboOS4uuS9v+eUqOiAheS4jeefpemBk+WcqOS4reiLseaWh+aDheWGteS4i++8jOS4i+aLiemdouadv+eahOWuveW6puWSjOmrmOW6plxyXG4gICAgICovXHJcbiAgICBASW5wdXQoKSB3aWR0aCA9IDEyMDtcclxuICAgIEBJbnB1dCgpIGhlaWdodCA9IDI1MDtcclxuICAgIHByaXZhdGUgX21lbnVXaWR0aCA9IDA7XHJcbiAgICBwcml2YXRlIF9tZW51SGVpZ2h0ID0gMDtcclxuXHJcbiAgICAvKiDkuIvmi4nmjInpkq4g6Kem5Y+R5LqL5Lu2ICovXHJcbiAgICBAT3V0cHV0KCkgY2hhbmdlU3RhdGUgPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcclxuXHJcbiAgICAvKiDkuIvmi4noj5zljZXpobnngrnlh7vkuovku7YgKi9cclxuICAgIEBPdXRwdXQoKSBjaGFuZ2UgPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcclxuICAgIEBPdXRwdXQoKSBjbGljayA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xyXG5cclxuICAgIC8qIOinpuWPkeS4i+aLieaMiemSrumdouadv+WMuuWfn+S5i+WklueahOS6i+S7tiAqL1xyXG4gICAgQE91dHB1dCgpIGNsaWNrTWVudU91dCA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogMjAyMS4wNi4xMiDlup/lvIPvvIzlm6DkuLrlvZNhdXRvU2l6ZeS4unRydWXnmoTml7blgJnvvIzmjInpkq7mmL7npLrkuI3lh7rmnaXjgIJcclxuICAgICAqL1xyXG4gICAgQElucHV0KCkgYXV0b1NpemUgPSBmYWxzZTtcclxuXHJcbiAgICAvKiDkuIvmi4npnaLmnb/mmL7npLogKi9cclxuICAgIHNob3cgPSBmYWxzZTtcclxuICAgIC8qIOaYvuekuuWHuuadpeeahOaMiemSrue7hCAqL1xyXG4gICAgZ2V0IGZsYXRCdXR0b25zKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmRhdGEgJiYgdGhpcy5kYXRhLnNsaWNlKDAsIHRoaXMuY291bnQpO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBkcEJ1dHRvbnMoKSB7XHJcbiAgICAgICAgLy8gdGhpcy5oZWlnaHQgPSB0aGlzLmRwQnV0dG9ucy5sZW5ndGggKiAzNTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZGF0YSAmJiB0aGlzLmRhdGEuc2xpY2UodGhpcy5jb3VudCk7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0UG9zaXRpb24kID0gbmV3IFN1YmplY3QoKTtcclxuICAgIGV2ZW50OiBhbnk7XHJcblxyXG4gICAgLyog5LiL5ouJ6Z2i5p2/5pi+56S65qCH5b+XICovXHJcbiAgICBkcEZsYWc6IGJvb2xlYW47XHJcblxyXG4gICAgLyog5LqL5Lu2ICovXHJcbiAgICBtb3VzZWVudGVyRXZlbnQ6IGFueTtcclxuICAgIG1vdXNlbGVhdmVFdmVudDogYW55O1xyXG4gICAgZG9jdW1lbnRDbGlja0V2ZW50OiBhbnk7XHJcblxyXG4gICAgLyog5LiJ5Liq54K55oyJ6ZKu5bC65a+4ICovXHJcbiAgICBidG5TaXplOiBhbnk7XHJcblxyXG4gICAgLyogICovXHJcbiAgICBzZXRUaW1lT2JqOiBhbnk7XHJcblxyXG5cdGJ0bm1lbnVpZCA9ICdidG4tbWVudS0nO1xyXG5cdHByaXZhdGUgcHJldmlvdXMgPSAwO1xyXG4gICAgb3ZlckxheVNlcnZpY2U6IE92ZXJMYXlIaWRkZW5TZXJ2aWNlO1xyXG4gICAgY29tbW9uVXRpbHM6IENvbW1vblV0aWxzO1xyXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBjaGFuZ2VSZWY6IENoYW5nZURldGVjdG9yUmVmLCBwcml2YXRlIG5nWm9uZTogTmdab25lKSB7XHJcbiAgICAgICAgdGhpcy5jb21tb25VdGlscyA9IG5ldyBDb21tb25VdGlscygpO1xyXG4gICAgfVxyXG5cclxuXHRwcml2YXRlIGJ0bm1lbnVJZCgpIHtcclxuXHRcdGNvbnN0IGlkU2VyID0gbmV3IElkU2VydmljZSgpO1xyXG5cdFx0dGhpcy5idG5tZW51aWQgKz0gaWRTZXIuZ3VpZCgpO1xyXG4gICAgICAgIHRoaXMub3ZlckxheVNlcnZpY2UgPSBuZXcgT3ZlckxheUhpZGRlblNlcnZpY2UoKTtcclxuXHR9XHJcblxyXG4gICAgbmdPbkluaXQoKSB7XHJcbiAgICAgICAgdGhpcy5idG5tZW51SWQoKTtcclxuICAgIH1cclxuXHJcbiAgICBuZ09uQ2hhbmdlcyhzaW1wbGVDaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKSB7XHJcbiAgICAgICAgaWYgKHNpbXBsZUNoYW5nZXNbXCJkYXRhXCJdKSB7XHJcbiAgICAgICAgICAgIC8vIHRoaXMuZmxhdEJ1dHRvbnMgPSB0aGlzLmRhdGEuc2xpY2UoMCwgdGhpcy5jb3VudCk7XHJcbiAgICAgICAgICAgIC8vIHRoaXMuZHBCdXR0b25zID0gdGhpcy5kYXRhLnNsaWNlKHRoaXMuY291bnQpO1xyXG4gICAgICAgICAgICAvLyB0aGlzLmhlaWdodCA9IHRoaXMuZHBCdXR0b25zLmxlbmd0aCAqIDM1O1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBuZ0FmdGVyVmlld0luaXQoKSB7fVxyXG5cclxuICAgIG5nQWZ0ZXJWaWV3Q2hlY2tlZCgpIHtcclxuICAgICAgICBpZiAodGhpcy5zaG93KSB7XHJcbiAgICAgICAgICAgIC8vIGNvbnN0IHsgaGVpZ2h0LCB3aWR0aCB9ID0gdGhpcy5kcE1lbnUubmF0aXZlRWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcclxuICAgICAgICAgICAgdGhpcy5zZXRQb3NpdGlvbih0aGlzLmV2ZW50KTtcclxuICAgICAgICAgICAgLy8gdGhpcy5zZXRQb3NpdGlvbiQuc3Vic2NyaWJlKHJlcyA9PiB0aGlzLnNldFBvc2l0aW9uKHJlcywgd2lkdGgsIGhlaWdodCkpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBjbGlja0V2ZW50KGU6IGFueSkge1xyXG4gICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICAgICAgdGhpcy5zaG93ID0gISh0aGlzLnNob3cgJiYgdGhpcy5kcE1lbnUubmF0aXZlRWxlbWVudC5jbGFzc05hbWUuaW5kZXhPZignc2hvdycpID4gLTEpO1xyXG4gICAgICAgIC8vIGJvZHnmt7vliqDpnaLmnb9cclxuICAgICAgICBpZiAodGhpcy5zaG93KSB7XHJcblx0XHRcdC8qKiDnp7vpmaTnjrDmnInnmoTkuIvmi4nlsZXnpLroj5zljZUgKi9cclxuXHRcdFx0aGlkZUJ0bk1lbnUoKTtcclxuICAgICAgICAgICAgdGhpcy5hcHBlbmRCb2R5KCk7XHJcbiAgICAgICAgICAgIC8vIHRoaXMuc2V0UG9zaXRpb24oZSk7XHJcbiAgICAgICAgICAgIC8vIHRoaXMuc2V0UG9zaXRpb24kLm5leHQoZSk7XHJcblxyXG4gICAgICAgICAgICAvLyDms6jlhozpvKDmoIfmu5rova7vvIzngrnlh7vkuovku7bvvIznlKjkuo7pmpDol49QYW5lbFxyXG4gICAgICAgICAgICB0aGlzLm92ZXJMYXlTZXJ2aWNlLnJlZ2lzdGVyTW91c2VFdmVudCh0aGlzLmRwQnRuLm5hdGl2ZUVsZW1lbnQsIChlOiBNb3VzZUV2ZW50KSA9PiB7XHJcbiAgICAgICAgICAgICAgICBoaWRlQnV0dG9uTWVudShlKTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG5cclxuXHJcbiAgICAgICAgICAgIHRoaXMuZXZlbnQgPSBlO1xyXG4gICAgICAgICAgICAvLyDnu5Hlrprnm7jlupTnmoTkuovku7ZcclxuICAgICAgICAgICAgdGhpcy5uZ1pvbmUucnVuT3V0c2lkZUFuZ3VsYXIoKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5iaW5kTWVudU1vdXNlZW50ZXIoKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuYmluZGlNZW51TW91c2VsZWF2ZSgpO1xyXG4gICAgICAgICAgICAgICAgLy8gdGhpcy5iaW5kRG9jQ2xpY2soKTtcclxuICAgICAgICAgICAgICAgIHRoaXMubW91c2VOb3RFbnRlckxlYXZlKCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyDpnaLmnb/mmL7npLog6ISP5YC85qOA5rWLXHJcbiAgICAgICAgdGhpcy5jaGFuZ2VSZWYuZGV0ZWN0Q2hhbmdlcygpO1xyXG4gICAgICAgIHRoaXMuY2hhbmdlUmVmLm1hcmtGb3JDaGVjaygpO1xyXG4gICAgICAgIC8vIHRoaXMuY2hhbmdlU3RhdGUuZW1pdCh7IG9yaWdpbkV2ZW50OiBlLCBzaG93OiB0aGlzLnNob3cgfSk7XHJcbiAgICAgICAgdGhpcy5jaGFuZ2VTdGF0ZS5lbWl0KHRoaXMuc2hvdyk7XHJcbiAgICB9XHJcblxyXG4gICAgLyog5oyJ6ZKu6Kem5Y+R5LqL5Lu2ICovXHJcbiAgICB0b2dnbGUoZTogYW55LCBidG4pIHtcclxuICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gICAgICAgIGlmIChidG4uZGlzYWJsZWQpIHJldHVybjtcclxuICAgICAgICB0aGlzLnNob3cgPSBmYWxzZTtcclxuICAgICAgICAvLyB0aGlzLnVuYmluZERvY0NsaWNrKCk7XHJcbiAgICAgICAgLy8g5YWz6Zet5LiL5ouJ5oyJ6ZKu6Z2i5p2/ICDohI/lgLzmo4DmtYtcclxuICAgICAgICB0aGlzLmNoYW5nZVJlZi5kZXRlY3RDaGFuZ2VzKCk7XHJcbiAgICAgICAgdGhpcy5jaGFuZ2VSZWYubWFya0ZvckNoZWNrKCk7XHJcbiAgICAgICAgdGhpcy5jaGFuZ2UuZW1pdChidG4uaWQpO1xyXG4gICAgICAgIHRoaXMuY2xpY2suZW1pdChidG4pO1xyXG5cclxuICAgICAgICBpZiAodGhpcy5kcEJ0bikge1xyXG4gICAgICAgICAgICB0aGlzLm92ZXJMYXlTZXJ2aWNlLmRlc3RvcnkodGhpcy5kcEJ0bi5uYXRpdmVFbGVtZW50KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLy8g5LiL5ouJ5oyJ6ZKu5pi+56S65YiwYm9keeS4rSAg5Y+v5pS55Y+Y6Z2i5p2/5pa55ZCRXHJcbiAgICBhcHBlbmRCb2R5KCkge1xyXG4gICAgICAgIGlmICh0aGlzLmRwTWVudS5uYXRpdmVFbGVtZW50ICYmICFkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdib2R5PiMnICsgdGhpcy5idG5tZW51aWQpKSB7XHJcbiAgICAgICAgICAgIC8vIOa3u+WKoOWIsGJvZHkgIOS+v+S6juWFqOmDqOaYvuekulxyXG4gICAgICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHRoaXMuZHBNZW51Lm5hdGl2ZUVsZW1lbnQpO1xyXG4gICAgICAgIH1cclxuXHRcdHRoaXMuZHBNZW51Lm5hdGl2ZUVsZW1lbnQuY2xhc3NOYW1lID0gdGhpcy5kcE1lbnUubmF0aXZlRWxlbWVudC5jbGFzc05hbWUgKyAnIHNob3cnO1xyXG4gICAgICAgIHRoaXMuZHBNZW51Lm5hdGl2ZUVsZW1lbnQuc3R5bGUuekluZGV4ID0gdGhpcy5jb21tb25VdGlscy5nZXRGbG9hdGluZ0xheWVySW5kZXgoKTtcclxuICAgIH1cclxuXHJcbiAgICByZW1vdmVNZW51UGFuZWwoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuZHBNZW51Lm5hdGl2ZUVsZW1lbnQgJiYgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignYm9keT4jJyArIHRoaXMuYnRubWVudWlkKSkge1xyXG4gICAgICAgICAgICB0aGlzLmRwTWVudS5uYXRpdmVFbGVtZW50LnJlbW92ZSgpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOW9k+S4i+aLiei2heWHuui+ueeVjOaXtiAg6L2s5o2i5pa55ZCRLFxyXG4gICAgICog5bm25pyq5aSE55CG77yM6L6555WM5LiN5aSf5LiL5ouJ5bGV56S655qE5oOF5Ya1XHJcbiAgICAgKiBAcGFyYW0gYnRuU2l6ZVxyXG4gICAgICovXHJcbiAgICBjaGFuZ2VQbGFjZW1lbnQoYnRuU2l6ZTogYW55KSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLmF1dG9SZWN0aWZ5KSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgbGV0IHJlZmVyUG9zaXRpb24gPSB0aGlzLmdldFJlZmVyZW5jZVBvc2l0aW9uKCk7XHJcbiAgICAgICAgbGV0IG5ld1BsYWNlbWVudCA9IHRoaXMucmVhbFBsYWNlbWVudDtcclxuICAgICAgICBpZiAobmV3UGxhY2VtZW50LmluZGV4T2YoXCJib3R0b21cIikgPiAtMSkge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5fbWVudUhlaWdodCA+IHJlZmVyUG9zaXRpb24uYm90dG9tIC0gYnRuU2l6ZS5ib3R0b20pIHtcclxuICAgICAgICAgICAgICAgIG5ld1BsYWNlbWVudCA9IG5ld1BsYWNlbWVudC5yZXBsYWNlKFwiYm90dG9tXCIsIFwidG9wXCIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIGlmIChuZXdQbGFjZW1lbnQuaW5kZXhPZihcInRvcFwiKSA+IC0xKSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLl9tZW51SGVpZ2h0ID4gYnRuU2l6ZS50b3AgLSByZWZlclBvc2l0aW9uLnRvcCkge1xyXG4gICAgICAgICAgICAgICAgbmV3UGxhY2VtZW50ID0gbmV3UGxhY2VtZW50LnJlcGxhY2UoXCJ0b3BcIiwgXCJib3R0b21cIik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKG5ld1BsYWNlbWVudC5pbmRleE9mKFwibGVmdFwiKSA+IC0xKSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLl9tZW51V2lkdGggPiBidG5TaXplLmxlZnQgLSByZWZlclBvc2l0aW9uLmxlZnQpIHtcclxuICAgICAgICAgICAgICAgIG5ld1BsYWNlbWVudCA9IG5ld1BsYWNlbWVudC5yZXBsYWNlKFwibGVmdFwiLCBcInJpZ2h0XCIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIGlmIChuZXdQbGFjZW1lbnQuaW5kZXhPZihcInJpZ2h0XCIpID4gLTEpIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMuX21lbnVXaWR0aCA+IHJlZmVyUG9zaXRpb24ucmlnaHQgLSBidG5TaXplLnJpZ2h0KSB7XHJcbiAgICAgICAgICAgICAgICBuZXdQbGFjZW1lbnQgPSBuZXdQbGFjZW1lbnQucmVwbGFjZShcInJpZ2h0XCIsIFwibGVmdFwiKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLnJlY3RpZnlQbGFjZW1lbnQgPSBuZXdQbGFjZW1lbnQ7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIOehruiupOWPgueFp+eahOi+ueeVjFxyXG4gICAgICovXHJcbiAgICBwcml2YXRlIGdldFJlZmVyZW5jZVBvc2l0aW9uKCkge1xyXG4gICAgICAgIGxldCByUmlnaHQgPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50V2lkdGg7XHJcbiAgICAgICAgbGV0IHJCb3R0b20gPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50SGVpZ2h0O1xyXG4gICAgICAgIGxldCByVG9wID0gMDtcclxuICAgICAgICBsZXQgckxlZnQgPSAwO1xyXG4gICAgICAgIC8vIOaoquWQkeWPgueFp1xyXG4gICAgICAgIGlmICh0aGlzLnJlY3RpZnlSZWZlcmVuY2VIKSB7XHJcbiAgICAgICAgICAgIHJSaWdodCA9IHRoaXMucmVjdGlmeVJlZmVyZW5jZUguZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkucmlnaHQ7XHJcbiAgICAgICAgICAgIHJMZWZ0ID0gdGhpcy5yZWN0aWZ5UmVmZXJlbmNlSC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS5sZWZ0O1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyDnurXlkJHlj4LnhadcclxuICAgICAgICBpZiAodGhpcy5yZWN0aWZ5UmVmZXJlbmNlVikge1xyXG4gICAgICAgICAgICByQm90dG9tID0gdGhpcy5yZWN0aWZ5UmVmZXJlbmNlVi5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS5ib3R0b207XHJcbiAgICAgICAgICAgIHJUb3AgPSB0aGlzLnJlY3RpZnlSZWZlcmVuY2VWLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLnRvcDtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHsgdG9wOiByVG9wLCBsZWZ0OiByTGVmdCwgcmlnaHQ6IHJSaWdodCwgYm90dG9tOiByQm90dG9tIH07XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIOWPmOWMluWvueW6lOeahGNsYXNzXHJcbiAgICAgKiBAcGFyYW0gcG9zaXRpb25cclxuICAgICAqL1xyXG4gICAgX2dldENsc05hbWUocG9zaXRpb24pIHtcclxuICAgICAgICBsZXQgY2xhc3NOYW1lID0gXCJcIjtcclxuICAgICAgICBzd2l0Y2ggKHBvc2l0aW9uKSB7XHJcbiAgICAgICAgICAgIGNhc2UgXCJ0b3AtcmlnaHRcIjpcclxuICAgICAgICAgICAgY2FzZSBcInRvcFwiOlxyXG4gICAgICAgICAgICAgICAgLy8g5pyd5LiK77yM5pyd5LiKLeacneWPs1xyXG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lID0gXCJkcm9wdXBcIjtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlIFwidG9wLWxlZnRcIjpcclxuICAgICAgICAgICAgICAgIC8vIOacneS4ii3mnJ3lt6ZcclxuICAgICAgICAgICAgICAgIGNsYXNzTmFtZSA9IFwiZHJvcHVwLWxlZnRcIjtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlIFwibGVmdC1ib3R0b21cIjpcclxuICAgICAgICAgICAgY2FzZSBcImxlZnRcIjpcclxuICAgICAgICAgICAgICAgIC8vIOaoquWQkeKAlOKAlOacneW3puKAlOKAlOacneS4i1xyXG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lID0gXCJkcm9wbGVmdFwiO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgXCJsZWZ0LXRvcFwiOlxyXG4gICAgICAgICAgICAgICAgLy8g5qiq5ZCR4oCU4oCU5pyd5bem4oCU4oCU5pyd5LiKXHJcbiAgICAgICAgICAgICAgICBjbGFzc05hbWUgPSBcImRyb3BsZWZ0LXVwXCI7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSBcInJpZ2h0LWJvdHRvbVwiOlxyXG4gICAgICAgICAgICBjYXNlIFwicmlnaHRcIjpcclxuICAgICAgICAgICAgICAgIC8vIOaoquWQkeKAlOKAlOacneWPs+KAlOKAlOacneS4i1xyXG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lID0gXCJkcm9wcmlnaHRcIjtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlIFwicmlnaHQtdG9wXCI6XHJcbiAgICAgICAgICAgICAgICAvLyDmqKrlkJHigJTigJTmnJ3lj7PigJTigJTmnJ3kuIpcclxuICAgICAgICAgICAgICAgIGNsYXNzTmFtZSA9IFwiZHJvcHJpZ2h0LXVwXCI7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSBcImJvdHRvbS1sZWZ0XCI6XHJcbiAgICAgICAgICAgICAgICAvLyDmnJ3kuIvigJTigJTmnJ3lt6ZcclxuICAgICAgICAgICAgICAgIGNsYXNzTmFtZSA9IFwiZHJvcGRvd24tbGVmdFwiO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgXCJib3R0b20tcmlnaHRcIjpcclxuICAgICAgICAgICAgICAgIGNsYXNzTmFtZSA9IFwiZHJvcGRvd25cIjtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgLy8g5pyd5LiL77yM5pyd5LiL4oCU4oCU5pyd5Y+zXHJcbiAgICAgICAgICAgICAgICBjbGFzc05hbWUgPSBcImRyb3Bkb3duXCI7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBjbGFzc05hbWU7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBnZXRSZWFsUGxhY2VtZW50KHBtZW50KSB7XHJcbiAgICAgICAgdmFyIHJlc3VsdCA9IFwiYm90dG9tLXJpZ2h0XCI7XHJcbiAgICAgICAgc3dpdGNoIChwbWVudCkge1xyXG4gICAgICAgICAgICBjYXNlIFwidG9wXCI6XHJcbiAgICAgICAgICAgICAgICByZXN1bHQgPSBcInRvcC1yaWdodFwiO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgXCJsZWZ0XCI6XHJcbiAgICAgICAgICAgICAgICByZXN1bHQgPSBcImxlZnQtYm90dG9tXCI7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSBcInJpZ2h0XCI6XHJcbiAgICAgICAgICAgICAgICByZXN1bHQgPSBcInJpZ2h0LWJvdHRvbVwiO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgXCJib3R0b21cIjpcclxuICAgICAgICAgICAgICAgIHJlc3VsdCA9IFwiYm90dG9tLXJpZ2h0XCI7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgIHJlc3VsdCA9IHBtZW50O1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgfVxyXG5cclxuICAgIC8qXHJcbiAgICAgKiDorqHnrpfnmoTkvY3nva7ljLrliIblv5Lnu4bljJZcclxuICAgICAqL1xyXG4gICAgcHJpdmF0ZSBjaGFuZ2VQb3NpdGlvbihidG5TaXplOiBhbnkpIHtcclxuICAgICAgICBsZXQgcnBsYWNlbWVudCA9IFwiXCI7XHJcbiAgICAgICAgaWYgKHRoaXMuYXV0b1JlY3RpZnkpIHtcclxuICAgICAgICAgICAgcnBsYWNlbWVudCA9IHRoaXMucmVjdGlmeVBsYWNlbWVudDtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBycGxhY2VtZW50ID0gdGhpcy5yZWFsUGxhY2VtZW50O1xyXG4gICAgICAgIH1cclxuICAgICAgICBsZXQgc3R5bGVUb3AgPSAwO1xyXG4gICAgICAgIGxldCBzdHlsZUxlZnQgPSAwO1xyXG4gICAgICAgIGlmIChycGxhY2VtZW50LmluZGV4T2YoXCJ0b3BcIikgPiAtMSkge1xyXG4gICAgICAgICAgICBzdHlsZVRvcCA9IGJ0blNpemUudG9wIC0gdGhpcy5fbWVudUhlaWdodDtcclxuICAgICAgICB9IGVsc2UgaWYgKHJwbGFjZW1lbnQuaW5kZXhPZihcImJvdHRvbVwiKSA+IC0xKSB7XHJcbiAgICAgICAgICAgIHN0eWxlVG9wID0gYnRuU2l6ZS5ib3R0b207XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChycGxhY2VtZW50LmluZGV4T2YoXCJyaWdodFwiKSA+IC0xKSB7XHJcbiAgICAgICAgICAgIHN0eWxlTGVmdCA9IGJ0blNpemUucmlnaHQ7XHJcbiAgICAgICAgfSBlbHNlIGlmIChycGxhY2VtZW50LmluZGV4T2YoXCJsZWZ0XCIpID4gLTEpIHtcclxuICAgICAgICAgICAgc3R5bGVMZWZ0ID0gYnRuU2l6ZS5sZWZ0IC0gdGhpcy5fbWVudVdpZHRoO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyDlvIDlpLRcclxuICAgICAgICBpZiAocnBsYWNlbWVudC5pbmRleE9mKFwiLXRvcFwiKSA+IC0xKSB7XHJcbiAgICAgICAgICAgIHN0eWxlVG9wID0gc3R5bGVUb3AgLSBidG5TaXplLmhlaWdodDtcclxuICAgICAgICB9IGVsc2UgaWYgKHJwbGFjZW1lbnQuaW5kZXhPZihcIi1ib3R0b21cIikgPiAtMSkge1xyXG4gICAgICAgICAgICBzdHlsZVRvcCA9IHN0eWxlVG9wICsgYnRuU2l6ZS5oZWlnaHQ7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuZHBNZW51Lm5hdGl2ZUVsZW1lbnQuc3R5bGUudG9wID0gc3R5bGVUb3AgKyBcInB4XCI7XHJcbiAgICAgICAgdGhpcy5kcE1lbnUubmF0aXZlRWxlbWVudC5zdHlsZS5sZWZ0ID0gc3R5bGVMZWZ0ICsgXCJweFwiO1xyXG4gICAgfVxyXG5cclxuICAgIC8qIOe7keWumuS4i+aLiemdouadv+m8oOagh+i/m+WFpeS6i+S7tiAqL1xyXG4gICAgYmluZE1lbnVNb3VzZWVudGVyKCkge1xyXG4gICAgICAgIHRoaXMudW5iaW5kTWVudU1vdXNlZW50ZXIoKTtcclxuICAgICAgICB0aGlzLm1vdXNlZW50ZXJFdmVudCA9IHRoaXMuY2hhbmdlRmxhZ1RvVHJ1ZS5iaW5kKHRoaXMpO1xyXG4gICAgICAgIHRoaXMuZHBNZW51Lm5hdGl2ZUVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcclxuICAgICAgICAgICAgXCJtb3VzZWVudGVyXCIsXHJcbiAgICAgICAgICAgIHRoaXMubW91c2VlbnRlckV2ZW50XHJcbiAgICAgICAgKTtcclxuICAgIH1cclxuXHJcbiAgICAvKiDnu5HlrprkuIvmi4npnaLmnb/pvKDmoIfnprvlvIDkuovku7YgICovXHJcbiAgICBiaW5kaU1lbnVNb3VzZWxlYXZlKCkge1xyXG4gICAgICAgIHRoaXMudW5iaW5kaU1lbnVNb3VzZWxlYXZlKCk7XHJcbiAgICAgICAgdGhpcy5tb3VzZWxlYXZlRXZlbnQgPSB0aGlzLm1vdXNlTGVhdmUuYmluZCh0aGlzKTtcclxuICAgICAgICB0aGlzLmRwTWVudS5uYXRpdmVFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXHJcbiAgICAgICAgICAgIFwibW91c2VsZWF2ZVwiLFxyXG4gICAgICAgICAgICB0aGlzLm1vdXNlbGVhdmVFdmVudFxyXG4gICAgICAgICk7XHJcbiAgICB9XHJcblxyXG4gICAgLyog57uR5a6a54K55Ye76Z2i5p2/5Yy65Z+f5LmL5aSW6Kem5Y+R55qE5LqL5Lu2ICovXHJcbiAgICAvLyBiaW5kRG9jQ2xpY2soKSB7XHJcbiAgICAvLyAgIHRoaXMuZG9jdW1lbnRDbGlja0V2ZW50ID0gdGhpcy5jbGlja0RvYy5iaW5kKHRoaXMpO1xyXG4gICAgLy8gICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMuZG9jdW1lbnRDbGlja0V2ZW50KTtcclxuICAgIC8vIH1cclxuXHJcbiAgICAvKiDop6Pnu5Hkuovku7YgKi9cclxuICAgIHVuYmluZE1lbnVNb3VzZWVudGVyKCkge1xyXG4gICAgICAgIGlmICh0aGlzLm1vdXNlZW50ZXJFdmVudCkge1xyXG4gICAgICAgICAgICB0aGlzLmRwTWVudS5uYXRpdmVFbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXHJcbiAgICAgICAgICAgICAgICBcIm1vdXNlZW50ZXJcIixcclxuICAgICAgICAgICAgICAgIHRoaXMubW91c2VlbnRlckV2ZW50XHJcbiAgICAgICAgICAgICk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgdW5iaW5kaU1lbnVNb3VzZWxlYXZlKCkge1xyXG4gICAgICAgIGlmICh0aGlzLm1vdXNlbGVhdmVFdmVudCkge1xyXG4gICAgICAgICAgICB0aGlzLmRwTWVudS5uYXRpdmVFbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXHJcbiAgICAgICAgICAgICAgICBcIm1vdXNlbGVhdmVcIixcclxuICAgICAgICAgICAgICAgIHRoaXMubW91c2VsZWF2ZUV2ZW50XHJcbiAgICAgICAgICAgICk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgLy8gdW5iaW5kRG9jQ2xpY2soKSB7XHJcbiAgICAvLyAgIGlmICh0aGlzLmRvY3VtZW50Q2xpY2tFdmVudCkge1xyXG4gICAgLy8gICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5kb2N1bWVudENsaWNrRXZlbnQpO1xyXG4gICAgLy8gICB9XHJcbiAgICAvLyB9XHJcblxyXG4gICAgLyogZmxhZyB0cnVlICovXHJcbiAgICBjaGFuZ2VGbGFnVG9UcnVlKCkge1xyXG4gICAgICAgIHRoaXMuZHBGbGFnID0gdHJ1ZTtcclxuICAgIH1cclxuXHJcbiAgICAvKiBmbGFnIGZhbHNlICovXHJcbiAgICBjaGFuZ2VGbGFnVG9GYWxzZSgpIHtcclxuICAgICAgICB0aGlzLmRwRmxhZyA9IGZhbHNlO1xyXG4gICAgfVxyXG5cclxuICAgIC8qIOm8oOagh+emu+W8gOaXtiAg5YWz6ZetbWVudSAqL1xyXG4gICAgbW91c2VMZWF2ZSgpIHtcclxuICAgICAgICBpZiAodGhpcy5kcEZsYWcpIHtcclxuICAgICAgICAgICAgdGhpcy5jaGFuZ2VGbGFnVG9GYWxzZSgpO1xyXG4gICAgICAgICAgICAvLyB0aGlzLnVuYmluZERvY0NsaWNrKCk7XHJcbiAgICAgICAgICAgIHRoaXMudW5iaW5kaU1lbnVNb3VzZWxlYXZlKCk7XHJcbiAgICAgICAgICAgIHRoaXMudW5iaW5kTWVudU1vdXNlZW50ZXIoKTtcclxuICAgICAgICAgICAgdGhpcy5jbG9zZSgpO1xyXG4gICAgICAgICAgICBpZiAodGhpcy5zZXRUaW1lT2JqKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLm5nWm9uZS5ydW5PdXRzaWRlQW5ndWxhcigoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXMuc2V0VGltZU9iaik7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvKiDpvKDmoIfmsqHmnInov5vlhaXliLDpnaLmnb8gIOS4gOauteaXtumXtOWQjumdouadv+iHquWKqOa2iOWksSAqL1xyXG4gICAgbW91c2VOb3RFbnRlckxlYXZlKCkge1xyXG4gICAgICAgIHRoaXMubmdab25lLnJ1bk91dHNpZGVBbmd1bGFyKCgpID0+IHtcclxuXHRcdFx0aWYgKHRoaXMuc2V0VGltZU9iaikge1xyXG5cdFx0XHRcdGNsZWFyVGltZW91dCh0aGlzLnNldFRpbWVPYmopO1xyXG5cdFx0XHR9XHJcbiAgICAgICAgICAgIHRoaXMuc2V0VGltZU9iaiA9IHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLmRwRmxhZykge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2hhbmdlRmxhZ1RvRmFsc2UoKTtcclxuICAgICAgICAgICAgICAgICAgICAvLyB0aGlzLnVuYmluZERvY0NsaWNrKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy51bmJpbmRpTWVudU1vdXNlbGVhdmUoKTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnVuYmluZE1lbnVNb3VzZWVudGVyKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jbG9zZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnNldFRpbWVPYmopIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXMuc2V0VGltZU9iaik7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LCAyMDAwKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICAvKiDlhbPpl63kuIvmi4npnaLmnb8gKi9cclxuICAgIGNsb3NlKCkge1xyXG4gICAgICAgIHRoaXMuc2hvdyA9IGZhbHNlO1xyXG4gICAgICAgIC8vIOWFs+mXreS4i+aLieaMiemSrumdouadvyAg6ISP5YC85qOA5rWLXHJcbiAgICAgICAgaWYgKCF0aGlzLmNoYW5nZVJlZltcImRlc3Ryb3llZFwiXSkge1xyXG4gICAgICAgICAgICB0aGlzLmNoYW5nZVJlZi5kZXRlY3RDaGFuZ2VzKCk7XHJcbiAgICAgICAgICAgIHRoaXMuY2hhbmdlUmVmLm1hcmtGb3JDaGVjaygpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmRwQnRuLm5hdGl2ZUVsZW1lbnQuYmx1cigpO1xyXG4gICAgICAgIGlmICh0aGlzLmRwQnRuICYmIHRoaXMub3ZlckxheVNlcnZpY2UpIHtcclxuICAgICAgICAgICAgdGhpcy5vdmVyTGF5U2VydmljZS5kZXN0b3J5KHRoaXMuZHBCdG4ubmF0aXZlRWxlbWVudCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8qIOWKqOaAgeaMh+Wumm1lbnXlnKhib2R55Lit55qE5L2N572uICovXHJcbiAgICBwcml2YXRlIHNldFBvc2l0aW9uKGUpIHtcclxuICAgICAgICAvLyDkuIvmi4nmjInpkq5cclxuICAgICAgICBjb25zdCBidG5TaXplID0gdGhpcy5kcEJ0bi5uYXRpdmVFbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xyXG4gICAgICAgIC8vIOS4i+aLiemdouadv1xyXG4gICAgICAgIGxldCBtZW51UmVjdCA9IHRoaXMuZHBNZW51Lm5hdGl2ZUVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XHJcbiAgICAgICAgdGhpcy5fbWVudUhlaWdodCA9IG1lbnVSZWN0LmhlaWdodDtcclxuICAgICAgICB0aGlzLl9tZW51V2lkdGggPSBtZW51UmVjdC53aWR0aDtcclxuICAgICAgICAvLyDlpoLmnpzopoHoh6rliqjnuqDmraPmlrnlkJFcclxuICAgICAgICBpZiAodGhpcy5hdXRvUmVjdGlmeSkge1xyXG4gICAgICAgICAgICB0aGlzLmNoYW5nZVBsYWNlbWVudChidG5TaXplKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5jaGFuZ2VQb3NpdGlvbihidG5TaXplKTtcclxuICAgIH1cclxuXHJcbiAgICBuZ09uRGVzdHJveSgpIHtcclxuICAgICAgICAvLyB0aGlzLnJlbW92ZU1lbnVQYW5lbCgpO1xyXG4gICAgICAgIGlmICh0aGlzLmRwQnRuICYmIHRoaXMuZHBCdG4ubmF0aXZlRWxlbWVudCkge1xyXG4gICAgICAgICAgICB0aGlzLm92ZXJMYXlTZXJ2aWNlLmRlc3RvcnkodGhpcy5kcEJ0bi5uYXRpdmVFbGVtZW50KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5vdmVyTGF5U2VydmljZSA9IG51bGw7XHJcbiAgICB9XHJcbn1cclxuIl19
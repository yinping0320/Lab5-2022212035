/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { cloneDeep } from 'lodash-es';
/*
* @Author: 疯狂秀才(lucas huang)
* @Date: 2018-10-27 10:55:02
 * @LastEditors: 疯狂秀才(Lucas Huang)
 * @LastEditTime: 2019-10-16 14:14:14
* @Company: Inspur
* @Version: v0.0.1
*/
import { Component, Input, ViewChild, Output, EventEmitter, TemplateRef, ContentChildren, QueryList, Injector, ChangeDetectorRef, ElementRef, Renderer2 } from '@angular/core';
import { MessagerService } from '@farris/ui-messager';
import { TreeTableComponent } from '@farris/ui-treetable';
import { CommonUtils, FarrisTemplateDirective } from '@farris/ui-common';
import { LocaleService } from '@farris/ui-locale';
export class MultiSelectComponent {
    /**
     * @param {?} mesagerSer
     * @param {?} injector
     * @param {?} cd
     */
    constructor(mesagerSer, injector, cd) {
        this.mesagerSer = mesagerSer;
        this.injector = injector;
        this.cd = cd;
        this.allTreeNodes = [];
        this._ds = [];
        this.displayType = 'List';
        /**
         * 显示右侧上移下移按钮
         */
        this.enableTargetSort = true;
        this.height = 445;
        this.fit = true;
        this.noDataMoveMessage = '请选择要移动的数据。';
        /**
         * 树结构时，是否显示级联选择控制选项
         */
        this.showCascadeControl = false;
        this.leftTitle = '未选择';
        this.rightTitle = '已选择';
        this.enableSearch = true;
        /**
         * 目标数据源显示checkbox 允许多选
         */
        this.showCheckbox = false;
        /**
         * 右侧已选启用重置，在启用复选框时，是否显示重置按钮，即取消右侧所有勾选项，默认为 false
         */
        this.enableReset = false;
        /**
         * 启用折行
         */
        this.wordWrap = false;
        /**
         * 启用多条记录一起移动；默认 false
         */
        this.enableMoveMore = false;
        /**
         * 查询时对value字段进行查询，默认为 true; false时仅查询文本字段
         */
        this.searchValueField = true;
        this.dataChange = new EventEmitter();
        this.selected = new EventEmitter();
        this.unSelected = new EventEmitter();
        this.selectedIdChange = new EventEmitter();
        this.beforeMove = new EventEmitter();
        this.afterMove = new EventEmitter();
        this.sortMove = new EventEmitter();
        // 左侧选中的数据 { [keyVal]: obj, [keyVal]: obj ... }
        this._leftCheckeds = {};
        // 右侧数据
        this._rightData = [];
        this.canCheckLength = 0;
        this.leftCount = 0;
        this._searchValue = '';
        // 级联选择控制选项
        this.enableCascase = true;
        this.updateTimer1 = null;
        this.updateTimer2 = null;
        this.rightSelectedItem = null;
        this.rightActiveIndex = -1;
        this.trackByItems = (/**
         * @param {?} index
         * @param {?} item
         * @return {?}
         */
        (index, item) => {
            return index;
        });
        if (!Object.values) {
            Object.values = (/**
             * @param {?} obj
             * @return {?}
             */
            function (obj) {
                return Object.keys(obj).map((/**
                 * @param {?} e
                 * @return {?}
                 */
                function (e) {
                    return obj[e];
                }));
            });
        }
        this.el = this.injector.get(ElementRef);
        this.render = this.injector.get(Renderer2);
        this.localeService = this.injector.get(LocaleService);
        this.commonUtils = this.injector.get(CommonUtils, null);
    }
    /**
     * @return {?}
     */
    get dataSource() {
        return this._ds;
    }
    /**
     * @param {?} val
     * @return {?}
     */
    set dataSource(val) {
        val = val || [];
        this._ds = val;
        if (!this.searchValue) {
            if (val.length) {
                if (val[0].toJSON) {
                    this.copyDataSource = val.map((/**
                     * @param {?} n
                     * @return {?}
                     */
                    n => n.toJSON()));
                }
                else {
                    this.copyDataSource = cloneDeep(val);
                }
            }
            setTimeout((/**
             * @return {?}
             */
            () => {
                this.initRightData(this.selectedId, false);
            }));
        }
    }
    /**
     * @return {?}
     */
    get selections() {
        return this._rightData;
    }
    /**
     * @param {?} val
     * @return {?}
     */
    set selections(val) {
        this._rightData = val.filter((/**
         * @param {?} n
         * @return {?}
         */
        n => n !== undefined && n !== null));
        this.cd.detectChanges();
    }
    /**
     * @return {?}
     */
    get searchValue() {
        return this._searchValue;
    }
    /**
     * @param {?} value
     * @return {?}
     */
    set searchValue(value) {
        this._searchValue = value;
        // this.copyDataSource = [...this.dataSource];
        if (value === undefined || value === null || value === '') {
            /** @type {?} */
            let leftCheckitems = Object.assign({}, this._leftCheckeds);
            if (this.displayType === 'Tree') {
                this.tt.selections.forEach((/**
                 * @param {?} n
                 * @return {?}
                 */
                n => {
                    leftCheckitems[n.id] = n.data;
                }));
            }
            this.dataSource = this.copyDataSource;
            if (this.displayType === 'Tree') {
                setTimeout((/**
                 * @return {?}
                 */
                () => {
                    /** @type {?} */
                    const ids = Object.keys(leftCheckitems);
                    if (ids && ids.length) {
                        this.tt.checkedNodes(ids);
                    }
                }));
            }
            else {
                this._leftCheckeds = Object.assign({}, leftCheckitems);
            }
            return;
        }
        if (this.displayType === 'Tree') {
            // const newDataSource = this.getTreeDataBySearch(this._searchValue, this.allTreeNodes);
            this.tt.searchHandle.search(`${this.textField},${this.valueField}`, this._searchValue);
        }
        else {
            this.dataSource = this.getListDataBySearch(this._searchValue, this.copyDataSource);
        }
        if (this.updateTimer1) {
            clearTimeout(this.updateTimer1);
        }
        this.updateTimer1 = setTimeout((/**
         * @return {?}
         */
        () => {
            this.canCheckLength = this.getCanCheckLength();
        }));
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        // this.copyDataSource = this.dataSource ? [...this.dataSource] : [];
        this.emptyData = this.localeService.getValue('multiSelect.emptyData') || '暂无数据';
        this.initRightData(this.selectedId);
        this.moveItem();
        if (!this.showCheckbox && this.enableMoveMore) {
            this.showCheckbox = true;
        }
    }
    /**
     * @return {?}
     */
    ngAfterViewInit() {
        /** @type {?} */
        const elt = this.el.nativeElement;
        this.render.addClass(elt, 'row');
        this.render.addClass(elt, 'f-multi-select');
        if (this.fit === true) {
            this.render.addClass(elt, 'f-utils-fill');
            this.render.setStyle(elt, 'height', '100%');
        }
        else {
            if (!!this.height) {
                this.render.setStyle(elt, 'height', this.height + 'px');
            }
        }
        this.noDataMoveMessage =
            this.noDataMoveMessage === '请选择要移动的数据。' ? this.localeService.getValue('multiSelect.noDataMoveMessage') : this.noDataMoveMessage;
        if (this.tt && this.selectedId) {
            this.tt.checkedNodes(this.selectedId);
        }
    }
    /**
     * @return {?}
     */
    ngAfterContentInit() {
        this.templates.forEach((/**
         * @param {?} item
         * @return {?}
         */
        (item) => {
            switch (item.getType()) {
                case 'text':
                    this.displayTemplate = item.template;
                    break;
            }
        }));
    }
    /**
     * @param {?} changes
     * @return {?}
     */
    ngOnChanges(changes) {
        if (changes.dataSource && !changes.dataSource.isFirstChange()) {
            this._leftCheckeds = {};
            this._rightData = [];
        }
        if (changes.selectedId && !changes.selectedId.isFirstChange()) {
            /** @type {?} */
            const cv = changes.selectedId.currentValue || [];
            /** @type {?} */
            const pv = changes.selectedId.previousValue || [];
            // 当设置选中的ID 为空时，执行清空右侧数据
            if (!cv.length) {
                this.clearSelections();
                // TFS 611928
                this.canCheckLength = this.getCanCheckLength();
                return;
            }
            if (cv.length != pv.length || JSON.stringify(cv) !== JSON.stringify(pv)) {
                this.initRightData(changes.selectedId.currentValue);
            }
        }
    }
    /**
     * @return {?}
     */
    getCanCheckLength() {
        /** @type {?} */
        let n = 0;
        /** @type {?} */
        let total = 0;
        if (this.isTree()) {
            this.tt.serializedValue.forEach((/**
             * @param {?} rn
             * @return {?}
             */
            rn => {
                if (rn.node.selectable) {
                    if (this.canChecked(rn.node)) {
                        n++;
                    }
                }
            }));
            total = this.tt.serializedValue.length;
        }
        else {
            this.dataSource.forEach((/**
             * @param {?} d
             * @return {?}
             */
            d => {
                if (this.canChecked(d)) {
                    n++;
                }
            }));
            total = this.dataSource.length;
        }
        this.leftCount = total;
        return n;
    }
    /**
     * 获取搜索的数据，List结构
     * @private
     * @param {?} value 搜索的字符
     * @param {?} data 数据
     * @return {?}
     */
    getListDataBySearch(value, data) {
        /** @type {?} */
        const result = [];
        value = '' + value;
        if (data instanceof Array) {
            data.forEach((/**
             * @param {?} item
             * @return {?}
             */
            item => {
                /** @type {?} */
                let txt = '';
                /** @type {?} */
                let val = '';
                if (this.textField) {
                    txt = '' + this.getText(item);
                }
                if (this.valueField) {
                    val = '' + this.getValue(item);
                }
                /** @type {?} */
                const textCompare = (/**
                 * @return {?}
                 */
                () => {
                    return txt.toLowerCase().indexOf(value.toLowerCase()) !== -1;
                });
                /** @type {?} */
                const valueCompare = (/**
                 * @return {?}
                 */
                () => {
                    return val.toLowerCase().indexOf(value.toLowerCase()) !== -1;
                });
                if (this.searchValueField) {
                    if (this.textField && this.valueField) {
                        if (textCompare() || valueCompare()) {
                            result.push(item);
                        }
                    }
                    else if (this.textField && !this.valueField) {
                        if (textCompare()) {
                            result.push(item);
                        }
                    }
                    else if (!this.textField && this.valueField) {
                        if (valueCompare()) {
                            result.push(item);
                        }
                    }
                }
                else {
                    if (textCompare()) {
                        result.push(item);
                    }
                }
            }));
        }
        return result;
    }
    /**
         * 获取包含value值得节点
         */
    // private getTreeDataByRecursive(value: string, data: any[], newData: any[]) {
    //     value = '' + value;
    //     data.forEach(item => {
    //         let txt = '';
    //         let val = '';
    //         if (this.textField) {
    //             txt = '' + this.getText(item.data);
    //         }
    //         if (this.valueField) {
    //             val = '' + this.getValue(item.data);
    //         }
    //         const textCompare = () => {
    //             return txt.toLowerCase().indexOf(value.toLowerCase()) !== -1;
    //         }
    //         const valueCompare = () => {
    //             return val.toLowerCase().indexOf(value.toLowerCase()) !== -1;
    //         }
    //         if (this.textField && this.valueField) {
    //             if (textCompare() || valueCompare()) {
    //                 newData.push(item);
    //             }
    //         } else if (this.textField && !this.valueField) {
    //             if (textCompare()) {
    //                 newData.push(item);
    //             }
    //         } else if (!this.textField && this.valueField) {
    //             if (valueCompare()) {
    //                 newData.push(item);
    //             }
    //         }
    //         if (item.children && item.children.length) {
    //             this.getTreeDataByRecursive(value, item.children, newData);
    //         }
    //     });
    // }
    /**
         * 获取根节点
         */
    // private getTreeRootNode(data: any[], rootData: any[]) {
    //     data.forEach(item => {
    //         if (item.parent === null) {
    //             rootData.push(item);
    //         } else {
    //             this.getTreeRootNode(new Array(item.parent), rootData);
    //         }
    //     });
    // }
    /**
     * 获取搜索的数据，Tree结构
     * @private
     * @param {?} ids
     * @param {?=} clearRight
     * @return {?}
     */
    // private getTreeDataBySearch(value: string, data: any[]): any[] {
    //     const rootNodes = [];
    //     const nodes = [];
    //     const finalRes = [];
    //     const uniqueId = [];
    //     // 获取包含value值得节点
    //     this.getTreeDataByRecursive(value, data, nodes);
    //     // 获取根节点
    //     this.getTreeRootNode(nodes, rootNodes);
    //     // 去重
    //     rootNodes.forEach(node => {
    //         if (!uniqueId.some(item => item == node.id)) {
    //             finalRes.push(node);
    //             uniqueId.push(node.id);
    //         }
    //     });
    //     return finalRes;
    // }
    initRightData(ids, clearRight = true) {
        /** @type {?} */
        let dataSource = [];
        if (!ids || !ids.length) {
            ids = this.selections.map((/**
             * @param {?} i
             * @return {?}
             */
            i => {
                return i[this.idField];
            }));
        }
        if (ids && ids.length) {
            if (this.isTree()) {
                this.convertTreeDataToPlainData(this.copyDataSource, dataSource);
                this._rightData = this.getTreeSelectionsById(ids, dataSource);
            }
            else {
                this._rightData = this.getListSelectionsById(ids, this.copyDataSource);
            }
        }
        else {
            if (clearRight) {
                this.moveAllToLeft();
            }
        }
        this.checkLeftData(ids);
    }
    /**
     * @param {?} ids
     * @return {?}
     */
    checkLeftData(ids) {
        if (ids && ids.length) {
            /** @type {?} */
            const checkeds = Object.assign({}, this._leftCheckeds);
            this._leftCheckeds = ids.reduce((/**
             * @param {?} r
             * @param {?} id
             * @return {?}
             */
            (r, id) => {
                r[id] = this._rightData.find((/**
                 * @param {?} n
                 * @return {?}
                 */
                n => n[this.idField] == id));
                return r;
            }), {});
            for (let k in this._leftCheckeds) {
                if (!this._leftCheckeds[k]) {
                    delete this._leftCheckeds[k];
                }
            }
            this._leftCheckeds = Object.assign({}, checkeds, this._leftCheckeds);
        }
        this.updateAllTreeNodes(ids);
    }
    /**
     * @private
     * @param {?} ids
     * @return {?}
     */
    updateAllTreeNodes(ids) {
        if (this.updateTimer2) {
            clearTimeout(this.updateTimer2);
        }
        this.updateTimer2 = setTimeout((/**
         * @return {?}
         */
        () => {
            this.canCheckLength = this.getCanCheckLength();
            if (this.tt) {
                if (ids && ids.length) {
                    this.tt.checkedNodes(ids, true, false, true);
                }
                this.allTreeNodes = cloneDeep(this.tt.state.rowNodes.map((/**
                 * @param {?} n
                 * @return {?}
                 */
                n => n.node)));
            }
        }));
    }
    /**
     * @private
     * @param {?} ids 选中数据的id
     * @param {?} dataSource 原始数据
     * @return {?}
     */
    getListSelectionsById(ids, dataSource) {
        /** @type {?} */
        let result = [];
        /** @type {?} */
        const _this = this;
        if ((typeof ids === 'string' && !!ids) || typeof ids === 'number') {
            /** @type {?} */
            const reusltObj = dataSource.find((/**
             * @param {?} item
             * @return {?}
             */
            item => {
                return item[_this.idField] === ids;
            }));
            if (reusltObj) {
                result.push(reusltObj);
            }
        }
        else if (Array.isArray(ids)) {
            if (Array.isArray(dataSource)) {
                result = ids.map((/**
                 * @param {?} id
                 * @return {?}
                 */
                id => dataSource.find((/**
                 * @param {?} item
                 * @return {?}
                 */
                item => item[this.idField] === id)))).filter((/**
                 * @param {?} n
                 * @return {?}
                 */
                n => n));
            }
            else {
                result = [];
            }
        }
        else {
            result = [];
        }
        return result;
    }
    /**
     *
     * @private
     * @param {?} ids 选中数据的id
     * @param {?} dataSource 原始数据
     * @return {?}
     */
    getTreeSelectionsById(ids, dataSource) {
        /** @type {?} */
        let result = [];
        /** @type {?} */
        const _this = this;
        if ((typeof ids === 'string' && !!ids) || typeof ids === 'number') {
            /** @type {?} */
            const reusltObj = dataSource.find((/**
             * @param {?} item
             * @return {?}
             */
            item => {
                return item.data[_this.idField] === ids;
            }));
            if (reusltObj && reusltObj.data) {
                result.push(reusltObj.data);
            }
        }
        else if (Array.isArray(ids)) {
            if (Array.isArray(dataSource)) {
                result = ids.map((/**
                 * @param {?} id
                 * @return {?}
                 */
                id => {
                    return dataSource.find((/**
                     * @param {?} item
                     * @return {?}
                     */
                    item => item.data[this.idField] === id));
                })).filter((/**
                 * @param {?} n
                 * @return {?}
                 */
                n => n)).map((/**
                 * @param {?} n
                 * @return {?}
                 */
                n => n.data));
            }
            else {
                result = [];
            }
        }
        else {
            result = [];
        }
        return result;
    }
    /**
     * 判断是否选中
     * @param {?} data 要验证的数据
     * @param {?} direction 验证的数据所在的位置 L: 左侧，R: 右侧
     * @return {?}
     */
    isChecked(data, direction) {
        /** @type {?} */
        const keyVal = data[this.idField];
        if (direction === 'L') {
            return (this._leftCheckeds && this._leftCheckeds[keyVal] !== undefined); // || !this.canChecked(data);
        }
        else {
            if (this._rightCheckeds) {
                return this._rightCheckeds[keyVal] !== undefined;
            }
            else {
                return false;
            }
        }
    }
    /**
     * @param {?} item
     * @return {?}
     */
    canChecked(item) {
        /** @type {?} */
        let data = item;
        if (this.isTree()) {
            data = item.data;
            if (item.selectable !== undefined && !item.selectable) {
                return false;
            }
        }
        if (!this.selections || this.selections.length === 0) {
            return true;
        }
        return this.selections.findIndex((/**
         * @param {?} c
         * @return {?}
         */
        c => c && c[this.idField] === data[this.idField])) === -1;
    }
    /**
     * @param {?} ids
     * @return {?}
     */
    onCheckValueChange(ids) {
    }
    /**
     * @return {?}
     */
    isTree() {
        return this.displayType === 'Tree';
    }
    /**
     * @param {?} data
     * @return {?}
     */
    leftDataChecked(data) {
        if (data && data.length) {
            data.forEach((/**
             * @param {?} node
             * @return {?}
             */
            node => {
                /** @type {?} */
                let d = node;
                if (this.isTree()) {
                    d = node.data;
                }
                if (this.canChecked(node)) {
                    if (this.isChecked(d, 'L')) {
                        delete this._leftCheckeds[d[this.idField]];
                    }
                    else {
                        if (!this._leftCheckeds) {
                            this._leftCheckeds = {};
                        }
                        this._leftCheckeds[d[this.idField]] = d;
                    }
                }
            }));
        }
    }
    /**
     * @param {?} dir
     * @return {?}
     */
    hasCheckeds(dir) {
        if (dir === 'L') {
            if (this.isTree()) {
                return this.tt.checkeds && this.tt.checkeds.length || (this.tt.selections && this.tt.selections.length);
            }
            if (this._leftCheckeds) {
                return Object.keys(this._leftCheckeds).length > 0;
            }
            else {
                return false;
            }
        }
        else {
            if (this._rightCheckeds) {
                return Object.keys(this._rightCheckeds).length > 0;
            }
            else {
                return false;
            }
        }
    }
    /**
     * @param {?} item
     * @param {?=} emit
     * @return {?}
     */
    rightDataChecked(item, emit = true) {
        /** @type {?} */
        const isCheck = this.isChecked(item, 'R');
        if (isCheck) {
            if (this.showCheckbox) {
                delete this._rightCheckeds[item[this.idField]];
            }
            else {
                this._rightCheckeds = {};
            }
            this.rightSelectedItem = null;
            this.unSelected.emit({ data: item });
            return;
        }
        else {
            if (this.showCheckbox) {
                this._rightCheckeds = this._rightCheckeds || {};
            }
            else {
                this._rightCheckeds = {};
            }
            this.rightSelectedItem = item;
            this._rightCheckeds[item[this.idField]] = item;
        }
        this.cd.detectChanges();
        this.selected.emit({ selected: !isCheck, data: item });
    }
    /**
     * @param {?} id
     * @param {?=} emit
     * @return {?}
     */
    selectItem(id, emit = true) {
        if (this.selections && this.selections.length) {
            /** @type {?} */
            const item = this.selections.find((/**
             * @param {?} n
             * @return {?}
             */
            n => n[this.idField] === id));
            if (item) {
                this.rightDataChecked(item, emit);
            }
        }
    }
    /**
     * @param {?=} emit
     * @return {?}
     */
    clearSelections(emit = false) {
        this._rightCheckeds = {};
        this._leftCheckeds = {};
        this._rightData = [];
        this.selectedId = [];
        if (this.isTree() && this.tt) {
            /** @type {?} */
            const _chkids = this.tt.checkeds.map((/**
             * @param {?} n
             * @return {?}
             */
            n => n.id));
            this.tt.clearAll();
            this.tt.state.rowNodes.forEach((/**
             * @param {?} n
             * @return {?}
             */
            n => {
                if (_chkids.find((/**
                 * @param {?} i
                 * @return {?}
                 */
                i => i == n.id))) {
                    n.node.selectable = true;
                }
            }));
        }
        if (emit) {
            this.selectedIdChange.emit([]);
        }
    }
    /**
     * 将树结构数据转换为扁平数组
     * @private
     * @param {?} nodes 树节点数组
     * @param {?=} r 新的空数组
     * @return {?}
     */
    convertTreeDataToPlainData(nodes, r = []) {
        if (nodes) {
            nodes.forEach((/**
             * @param {?} n
             * @return {?}
             */
            n => {
                r.push(n);
                if (n.children) {
                    this.convertTreeDataToPlainData(n.children, r);
                }
            }));
        }
        return r;
    }
    //#region 左右移动
    /**
     * @private
     * @return {?}
     */
    moveItem() {
        this.beforeMove.subscribe((/**
         * @param {?} obj
         * @return {?}
         */
        (obj) => {
            /** @type {?} */
            const items = obj.items;
            /** @type {?} */
            let direction = 1;
            switch (obj.target) {
                case 'right':
                    Object.keys(items).forEach((/**
                     * @param {?} id
                     * @return {?}
                     */
                    id => {
                        if (!this._rightData.find((/**
                         * @param {?} n
                         * @return {?}
                         */
                        n => n[this.idField].toString() === id))) {
                            this._rightData.push(items[id]);
                        }
                    }));
                    this._rightData = [...this._rightData];
                    if (this.isTree()) {
                        this.tt.clearAll();
                    }
                    direction = 1;
                    break;
                case 'rightAll':
                    items.forEach((/**
                     * @param {?} data
                     * @return {?}
                     */
                    data => {
                        if (this._rightData.findIndex((/**
                         * @param {?} n
                         * @return {?}
                         */
                        n => n[this.idField] === data[this.idField])) === -1) {
                            this._rightData.push(data);
                        }
                    }));
                    if (this.isTree()) {
                        this.tt.clearAll();
                    }
                    direction = 1;
                    break;
                case 'left':
                    /** @type {?} */
                    let ids = Object.keys(items);
                    this._rightData = this._rightData.filter((/**
                     * @param {?} v
                     * @return {?}
                     */
                    v => {
                        return ids.indexOf('' + v[this.idField]) === -1;
                    }));
                    this._rightCheckeds = {};
                    ids.forEach((/**
                     * @param {?} id
                     * @return {?}
                     */
                    id => {
                        delete this._leftCheckeds[id];
                    }));
                    if (this.rightSelectedItem) {
                        if (ids.indexOf('' + this.rightSelectedItem[this.idField]) > -1) {
                            this.rightSelectedItem = null;
                        }
                    }
                    direction = -1;
                    if (this.isTree()) {
                        this.tt.findRowNodes(ids).forEach((/**
                         * @param {?} n
                         * @return {?}
                         */
                        n => {
                            n.node.selectable = true;
                        }));
                        this.tt.unCheckedNodes(ids, true);
                    }
                    break;
                case 'leftAll':
                    this._rightCheckeds = {};
                    this.rightSelectedItem = null;
                    this._rightData = [];
                    direction = -1;
                    this._leftCheckeds = {};
                    if (this.isTree() && this.tt) {
                        this.tt.clearAll();
                        /** @type {?} */
                        const _ids = items.map((/**
                         * @param {?} n
                         * @return {?}
                         */
                        n => n[this.idField]));
                        this.tt.findRowNodes(_ids).forEach((/**
                         * @param {?} n
                         * @return {?}
                         */
                        n => {
                            n.node.selectable = true;
                        }));
                    }
                    break;
            }
            this.selectionsChange();
            this.changeSelectIds(direction);
            this.afterMove.emit(Object.values(items));
        }));
    }
    /**
     * 右移
     * @param {?=} moveData
     * @return {?}
     */
    moveToRight(moveData) {
        if (moveData) {
            this.beforeMove.emit({ items: { [moveData[this.idField]]: moveData }, target: 'right' });
        }
        else {
            if (this.hasCheckeds('L')) {
                if (this.isTree()) {
                    this._leftCheckeds = {};
                    if (!this.tt.checkeds.filter((/**
                     * @param {?} n
                     * @return {?}
                     */
                    n => this._rightData.findIndex((/**
                     * @param {?} r
                     * @return {?}
                     */
                    r => r.id === n.id)) === -1)).length) {
                        this.mesagerSer.warning(this.noDataMoveMessage);
                        return;
                    }
                    this.tt.checkeds.forEach((/**
                     * @param {?} n
                     * @return {?}
                     */
                    n => {
                        this._leftCheckeds[n.data[this.idField]] = n.data;
                    }));
                    this.tt.selections.forEach((/**
                     * @param {?} n
                     * @return {?}
                     */
                    n => {
                        this._leftCheckeds[n.id] = n.data;
                    }));
                }
                else {
                    /** @type {?} */
                    const newCheckeds = Object.keys(this._leftCheckeds).filter((/**
                     * @param {?} id
                     * @return {?}
                     */
                    id => {
                        return this._rightData.findIndex((/**
                         * @param {?} n
                         * @return {?}
                         */
                        n => n.id === id)) === -1;
                    }));
                    if (!newCheckeds.length) {
                        this.mesagerSer.warning(this.noDataMoveMessage);
                        return;
                    }
                }
                this.beforeMove.emit({ items: this._leftCheckeds, target: 'right' });
            }
            else {
                this.mesagerSer.warning(this.noDataMoveMessage);
            }
        }
    }
    /**
     * 全部右移
     * @return {?}
     */
    moveAllToRight() {
        if (this.searchValue === '') {
            this._rightData = [];
        }
        if (this.displayType === 'List') {
            /** @type {?} */
            const items = this.dataSource;
            // if (this.searchValue && this._leftCheckeds) {
            //     const checkids = Object.keys(this._leftCheckeds);
            //     if (checkids.length) {
            //         checkids.forEach(id => {
            //             if (!items.find(n => n[this.idField] === id)) {
            //                 items.push(this._leftCheckeds[id]);
            //             }
            //         });
            //     }
            // }
            this.beforeMove.emit({ items, target: 'rightAll' });
        }
        else {
            if (!this.searchValue) {
                /** @type {?} */
                let _dataSource = [];
                this.convertTreeDataToPlainData(this.dataSource, _dataSource);
                _dataSource = _dataSource.filter((/**
                 * @param {?} n
                 * @return {?}
                 */
                n => n.selectable && (n.visible || n.visible === undefined))).map((/**
                 * @param {?} n
                 * @return {?}
                 */
                n => n.data));
                this.beforeMove.emit({ items: _dataSource, target: 'rightAll' });
            }
            else {
                /** @type {?} */
                const _dataSource = this.tt.serializedValue.map((/**
                 * @param {?} n
                 * @return {?}
                 */
                n => n.node.data));
                this.beforeMove.emit({ items: _dataSource, target: 'rightAll' });
            }
        }
    }
    /**
     * 左移
     * @param {?=} moveData
     * @return {?}
     */
    moveToLeft(moveData) {
        if (moveData) {
            this.beforeMove.emit({ items: { [moveData[this.idField]]: moveData }, target: 'left' });
        }
        else {
            if (this.hasCheckeds('R')) {
                this.beforeMove.emit({ items: this._rightCheckeds, target: 'left' });
            }
            else {
                this.mesagerSer.warning(this.noDataMoveMessage);
            }
        }
    }
    /**
     * 全部左移
     * @return {?}
     */
    moveAllToLeft() {
        this.beforeMove.emit({ items: this._rightData, target: 'leftAll' });
    }
    //#endregion
    //#region 上下移动显示列顺序
    /**
     * @return {?}
     */
    _getSelectInfo() {
        if (this.rightSelectedItem) {
            // const key = Object.keys(this._rightCheckeds)[0];
            /** @type {?} */
            const key = this.rightSelectedItem[this.idField];
            /** @type {?} */
            const index = this._rightData.findIndex((/**
             * @param {?} c
             * @return {?}
             */
            c => '' + c[this.idField] == key));
            return {
                key, index
            };
        }
        return null;
    }
    /**
     * 置顶
     * @return {?}
     */
    moveTop() {
        if (this.enableMoveMore && this._rightCheckeds && Object.keys(this._rightCheckeds).length) {
            this.moveMore('top');
            return;
        }
        /** @type {?} */
        const obj = this._getSelectInfo();
        if (obj) {
            this._rightData.unshift(this._rightData[obj.index]);
            this._rightData.splice(obj.index + 1, 1);
            this.selectionsChange();
            this.changeSelectIds(0);
        }
        else {
            this.mesagerSer.warning(this.noDataMoveMessage);
        }
    }
    /**
     * 上移
     * @return {?}
     */
    moveUp() {
        if (this.enableMoveMore && this._rightCheckeds && Object.keys(this._rightCheckeds).length) {
            this.moveMore2('up');
            return;
        }
        /** @type {?} */
        const obj = this._getSelectInfo();
        if (obj) {
            /** @type {?} */
            const index = obj.index;
            if (index !== 0) {
                /** @type {?} */
                const tempArr = this._rightData.splice(index, 1);
                this._rightData.splice(index - 1, 0, ...tempArr);
            }
            this.selectionsChange();
            this.changeSelectIds(0);
        }
        else {
            this.mesagerSer.warning(this.noDataMoveMessage);
        }
    }
    /**
     * 下移
     * @return {?}
     */
    moveDown() {
        if (this.enableMoveMore && this._rightCheckeds && Object.keys(this._rightCheckeds).length) {
            this.moveMore2('down');
            return;
        }
        /** @type {?} */
        const obj = this._getSelectInfo();
        if (obj) {
            /** @type {?} */
            const len = this._rightData.length;
            /** @type {?} */
            const index = obj.index;
            if (index === 0 || index !== len - 1) {
                /** @type {?} */
                const tempArr = this._rightData.splice(index, 1);
                this._rightData.splice(index + 1, 0, ...tempArr);
            }
            this.selectionsChange();
            this.changeSelectIds(0);
        }
        else {
            this.mesagerSer.warning(this.noDataMoveMessage);
        }
    }
    /**
     * 置底
     * @return {?}
     */
    moveBottom() {
        if (this.enableMoveMore && this._rightCheckeds && Object.keys(this._rightCheckeds).length) {
            this.moveMore('bottom');
            return;
        }
        /** @type {?} */
        const obj = this._getSelectInfo();
        if (obj) {
            this._rightData.push(this._rightData[obj.index]);
            this._rightData.splice(obj.index, 1);
            this.selectionsChange();
            this.changeSelectIds(0);
        }
        else {
            this.mesagerSer.warning(this.noDataMoveMessage);
        }
    }
    /**
     * 触发选择中id
     * @private
     * @param {?} number 1代表左侧数据右移，-1,代表数据左移，0代表上移下移
     * @return {?}
     */
    changeSelectIds(number) {
        /** @type {?} */
        const ids = this._rightData.map((/**
         * @param {?} item
         * @return {?}
         */
        item => {
            return item[this.idField];
        }));
        if (number === 0) {
            if (typeof this.selectedId === 'string') {
                this.selectedId = ids.join(',');
            }
            else if (Array.isArray(this.selectedId)) {
                this.selectedId = ids;
            }
            this.selectedIdChange.emit(this.selectedId);
            /** @type {?} */
            const rightActiveDom = this.el.nativeElement.querySelector('.f-multi-select-list-group--right li.active');
            if (rightActiveDom) {
                if (rightActiveDom.scrollIntoViewIfNeeded) {
                    rightActiveDom.scrollIntoViewIfNeeded();
                }
                else {
                    rightActiveDom.scrollIntoView();
                }
            }
            return;
        }
        if (!this.selectedId) {
            this.selectedId = [];
        }
        if (number === 1 || number === -1) {
            if (!ids.length) {
                this.selectedId = [];
            }
            else {
                this.selectedId = ids;
            }
            if (this.isTree()) {
                if (ids && ids.length) {
                    this.tt.checkedNodes(ids, true, false, true);
                }
            }
        }
        this.canCheckLength = this.getCanCheckLength();
        this.selectedIdChange.emit(this.selectedId);
    }
    //#endregion
    /**
     * @private
     * @return {?}
     */
    selectionsChange() {
        this.dataChange.emit(this._rightData);
        this.cd.detectChanges();
    }
    /**
     * @param {?} item
     * @param {?=} textField
     * @return {?}
     */
    getText(item, textField = this.textField) {
        if (item) {
            if (this.commonUtils && this.commonUtils.getValue && textField) {
                return this.commonUtils.getValue(textField, item);
            }
            else {
                return item[textField];
            }
        }
        else {
            return '';
        }
    }
    /**
     * @param {?} item
     * @param {?=} valueField
     * @return {?}
     */
    getValue(item, valueField = this.valueField) {
        if (item) {
            if (this.commonUtils && this.commonUtils.getValue && valueField) {
                return this.commonUtils.getValue(valueField, item);
            }
            else {
                return item[valueField];
            }
        }
        else {
            return '';
        }
    }
    //#region  右侧同时移动多条记录
    /**
     * 从右侧数据源中获取选中的记录
     * @private
     * @return {?}
     */
    getCheckedItemsFromDataSource() {
        if (this._rightData && this._rightData.length) {
            return this._rightData.filter((/**
             * @param {?} n
             * @return {?}
             */
            n => this._rightCheckeds[n[this.idField]]));
        }
        return [];
    }
    /**
     * @private
     * @return {?}
     */
    getCheckedFirstIndexAndLastIndex() {
        /** @type {?} */
        const _chkItems = this.getCheckedItemsFromDataSource();
        if (_chkItems && _chkItems.length) {
            /** @type {?} */
            const first = _chkItems[0];
            /** @type {?} */
            const last = _chkItems[_chkItems.length - 1];
            /** @type {?} */
            const firstIndex = this._rightData.findIndex((/**
             * @param {?} n
             * @return {?}
             */
            n => n[this.idField] == first[this.idField]));
            /** @type {?} */
            const lastIndex = this._rightData.findIndex((/**
             * @param {?} n
             * @return {?}
             */
            n => n[this.idField] == first[last.idField]));
            return { first: firstIndex, last: lastIndex };
        }
        return { first: -1, last: -1 };
    }
    /**
     * @private
     * @param {?} type
     * @return {?}
     */
    moveMore(type) {
        if (this._rightCheckeds && Object.keys(this._rightCheckeds).length) {
            /** @type {?} */
            const _chkItems = this.getCheckedItemsFromDataSource();
            /** @type {?} */
            const items = this._rightData.filter((/**
             * @param {?} n
             * @return {?}
             */
            n => !_chkItems.find((/**
             * @param {?} r
             * @return {?}
             */
            r => r[this.idField] == n[this.idField]))));
            if (type === 'top') {
                items.splice(0, 0, ..._chkItems);
            }
            else if (type === 'bottom') {
                items.push(..._chkItems);
            }
            this._rightData = [...items];
            this.updateActiveIndex();
            this.selectionsChange();
            this.changeSelectIds(0);
        }
    }
    /**
     * @private
     * @param {?} type
     * @return {?}
     */
    moveMore2(type) {
        const { first, last } = this.getCheckedFirstIndexAndLastIndex();
        /** @type {?} */
        const _chkItems = this.getCheckedItemsFromDataSource();
        // 获取排除已选中的记录
        /** @type {?} */
        const items = this._rightData.filter((/**
         * @param {?} n
         * @return {?}
         */
        n => !_chkItems.find((/**
         * @param {?} r
         * @return {?}
         */
        r => r[this.idField] == n[this.idField]))));
        if (type === 'up') {
            /** @type {?} */
            let tarIndex = first - 1;
            if (tarIndex < 0) {
                this.moveMore('top');
                return;
            }
            else {
                items.splice(tarIndex, 0, ..._chkItems);
            }
        }
        else if (type === 'down') {
            /** @type {?} */
            let downIdx = first + 1;
            if (downIdx >= this._rightData.length) {
                this.moveMore('bottom');
                return;
            }
            else {
                items.splice(downIdx, 0, ..._chkItems);
            }
        }
        this._rightData = [...items];
        this.updateActiveIndex();
        this.selectionsChange();
        this.changeSelectIds(0);
    }
    /**
     * @private
     * @return {?}
     */
    updateActiveIndex() {
        /** @type {?} */
        let idx = -1;
        if (this.rightSelectedItem) {
            idx = this._rightData.findIndex((/**
             * @param {?} n
             * @return {?}
             */
            n => n[this.idField] === this.rightSelectedItem[this.idField]));
        }
        this.rightActiveIndex = idx;
    }
    /**
     * @param {?} $event
     * @param {?} item
     * @param {?} index
     * @return {?}
     */
    rightDataClicked($event, item, index) {
        /** @type {?} */
        const isCtrlKey = $event.ctrlKey;
        /** @type {?} */
        const isShiftKey = $event.shiftKey;
        this.rightSelectedItem = item;
        /** @type {?} */
        const target = $event.target;
        /** @type {?} */
        const ul = target.closest('ul');
        if (isShiftKey) {
            if (ul) {
                ul.style.userSelect = 'none';
            }
        }
        if (!isCtrlKey && !isShiftKey) {
            this.rightActiveIndex = index;
            /** @type {?} */
            const isCheckboxClicked = target.className.indexOf('custom-checkbox') > -1 || target.closest('.custom-checkbox');
            if (isCheckboxClicked) {
                if (this._rightCheckeds && this._rightCheckeds[item[this.idField]]) {
                    this.rightSelectedItem = null;
                    delete this._rightCheckeds[item[this.idField]];
                }
                else {
                    this._rightCheckeds = this._rightCheckeds || {};
                    this._rightCheckeds[item[this.idField]] = item;
                }
            }
            else {
                this.clearRightCheckeds();
                this._rightCheckeds = this._rightCheckeds || {};
                this._rightCheckeds[item[this.idField]] = item;
            }
        }
        else {
            /** @type {?} */
            const setCheckItems = (/**
             * @param {?=} isAdd
             * @return {?}
             */
            (isAdd = true) => {
                /** @type {?} */
                let focusIndex = this.rightActiveIndex;
                if (focusIndex === -1) {
                    focusIndex = 0;
                }
                /** @type {?} */
                const endIndex = index;
                /** @type {?} */
                let start = focusIndex;
                /** @type {?} */
                let end = endIndex;
                if (focusIndex > endIndex) {
                    start = endIndex;
                    end = focusIndex;
                }
                /** @type {?} */
                const selectItems = [...this._rightData].splice(start, end - start + 1);
                if (!isAdd) {
                    this._rightCheckeds = [];
                }
                selectItems.forEach((/**
                 * @param {?} n
                 * @return {?}
                 */
                n => {
                    this._rightCheckeds[n[this.idField]] = n;
                }));
            });
            if (isCtrlKey) {
                if (this._rightCheckeds[item[this.idField]]) {
                    delete this._rightCheckeds[item[this.idField]];
                    this.rightSelectedItem = null;
                }
                else {
                    this._rightCheckeds[item[this.idField]] = item;
                }
                if (isShiftKey) {
                    setCheckItems();
                }
                this.rightActiveIndex = index;
            }
            else if (isShiftKey) {
                setCheckItems(isCtrlKey);
            }
        }
        if (ul) {
            ul.style.userSelect = 'none';
        }
    }
    /**
     * @param {?} $event
     * @param {?} item
     * @param {?} index
     * @return {?}
     */
    onRightItemClick($event, item, index) {
        if (this.enableMoveMore) {
            this.rightDataClicked($event, item, index);
        }
        else {
            this.rightDataChecked(item);
        }
    }
    //#endregion
    /**
     * @return {?}
     */
    clearRightCheckeds() {
        this._rightCheckeds = {};
        this.cd.detectChanges();
    }
}
MultiSelectComponent.decorators = [
    { type: Component, args: [{
                selector: 'multi-select',
                template: "<div class=\"f-utils-fill f-multi-select-list d-flex flex-column\">\r\n    <div class=\"f-utils-flex-column f-multi-select-list-content f-utils-fill\">\r\n        <legend class=\"f-multi-select-list-title\">\r\n            {{leftTitle === '\u672A\u9009\u62E9' ? ('multiSelect.leftTitle'|locale) : leftTitle}} ( {{ canCheckLength }} / {{ leftCount }} )\r\n            <span *ngIf=\"displayType === 'Tree' && showCascadeControl\" style=\"display: flex; align-items: center;\">\r\n                <input type=\"checkbox\" style=\"margin-right:2px\" [(ngModel)]=\"enableCascase\" id=\"fms_chkenablecascade\"><label for=\"fms_chkenablecascade\" style=\"margin:0\">\u7EA7\u8054\u9009\u62E9</label>\r\n            </span>\r\n            <ng-content select=\".left-title\"></ng-content>\r\n        </legend>\r\n        <div class=\"input-group\" *ngIf=\"enableSearch\" style=\"margin: 5px; width: auto\">\r\n            <input type=\"text\" class=\"form-control\" [(ngModel)]=\"searchValue\" placeholder=\"{{ 'multiSelect.filterPlaceholder' | locale }}\" />\r\n            <div class=\"input-group-append\" style=\"background: transparent;display: flex;align-items: center;padding: 0 5px;\">\r\n                <span class=\"f-icon f-icon-search\" *ngIf=\"!searchValue\" ></span>\r\n                <span class=\"f-icon f-icon-close\" style=\"cursor: pointer;\" *ngIf=\"searchValue\" (click)=\"searchValue = '';\"></span>\r\n            </div>\r\n        </div>\r\n        <div class=\"container columns-box f-utils-fill\" [class.pl-2]=\"displayType !== 'List'\">\r\n            <perfect-scrollbar [config]=\"{}\">\r\n                <ng-container *ngIf=\"displayType === 'List'; else tree\">\r\n                    <ul class=\"f-multi-select-list-group multi-select-list-group-flush f-multi-select-list-group--left\" [class.f-multi-select-norecords]=\"!dataSource || !dataSource.length\">\r\n                        <ng-template [ngIf]=\"dataSource && dataSource.length\">\r\n                            <li class=\"f-multi-select-list-group-item\" (click)=\"leftDataChecked([data])\"\r\n                                *ngFor=\"let data of dataSource;trackBy: trackByItems\" [ngClass]=\"{'f-state-disabled':!canChecked(data),'active':isChecked(data, 'L')}\">\r\n                                <div class=\"custom-control custom-checkbox  custom-control-inline\">\r\n                                    <input type=\"checkbox\" class=\"custom-control-input\" [checked]=\"isChecked(data, 'L')\"\r\n                                        [disabled]=\"!canChecked(data)\">\r\n                                    <label class=\"custom-control-label\" [style.white-space]=\"wordWrap ? 'break-spaces': 'nowrap'\" [style.word-wrap]=\"wordWrap? 'break-word': 'normal'\">\r\n                                        <display-text [template]=\"displayTemplate\" [data]=\"data\"></display-text>\r\n                                    </label>\r\n                                </div>\r\n                            </li>\r\n                        </ng-template>\r\n                        <ng-template [ngIf]=\"!dataSource || !dataSource.length\">\r\n                            <li class=\"f-multi-select-norecords-content\"> {{emptyData}} </li>\r\n                        </ng-template>\r\n                    </ul>\r\n                </ng-container>\r\n\r\n                <ng-template #tree>\r\n                    <farris-treetable #tt [data]=\"dataSource\" [idField]=\"idField\" [striped]=\"false\" [cascadeCheck]=\"enableCascase\" [cascadeDown]=\"enableCascase\" [cascadeUp]=\"enableCascase\"\r\n                        [singleSelect]=\"false\" [showIcon]=\"false\" [showFilterBar]=\"false\" [showCheckbox]=\"true\"\r\n                        [selectOnCheck]=\"true\" [checkOnSelect]=\"true\" [showBorder]=\"false\" (checkValuesChange)=\"onCheckValueChange($event)\">\r\n                        <ng-template farrisTemplate=\"body\" let-rowNode let-treeNode=\"node\" let-rowData=\"rowData\">\r\n                            <tr #row=\"row\" [selectRow]=\"rowNode\" [dblclick]=\"true\"\r\n                                [selectRowDisabled]=\"!canChecked(treeNode)\" [attr.id]=\"rowNode.id\">\r\n                                <td style=\"border: 0; line-height: 26px;padding: 0px\" [style.color]=\"row.selectRowDisabled? '#a6a6a6': '#333'\">\r\n                                    <farris-treeTableToggler [disabled]=\"!canChecked(treeNode)\" [rowNode]=\"rowNode\">\r\n                                    </farris-treeTableToggler>\r\n                                    <display-text [template]=\"displayTemplate\" [data]=\"rowData\"></display-text>\r\n                                </td>\r\n                            </tr>\r\n                        </ng-template>\r\n                    </farris-treetable>\r\n                </ng-template>\r\n            </perfect-scrollbar>\r\n        </div>\r\n    </div>\r\n</div>\r\n<div class=\"f-multi-select-list-btns\" [class.col-2]=\"!enableTargetSort\">\r\n \r\n    <button [title]=\"'multiSelect.allShiftRight' | locale\" class=\"btn btn-secondary f-btn-icon \" type=\"button\"\r\n        (click)=\"moveAllToRight()\">\r\n        <span class=\"f-icon f-icon-arrow-seek-right\"></span>\r\n    </button>\r\n    <button [title]=\"'multiSelect.shiftRight' | locale\" class=\"btn btn-secondary f-btn-icon right-all\" type=\"button\"\r\n    (click)=\"moveToRight()\">\r\n    <span class=\"f-icon f-icon-arrow-chevron-right\"></span>\r\n</button>\r\n    <button [title]=\"'multiSelect.shiftLeft' | locale\" class=\"btn btn-secondary f-btn-icon\" type=\"button\"\r\n        (click)=\"moveToLeft()\">\r\n        <span class=\"f-icon f-icon-arrow-chevron-left\"></span>\r\n    </button>\r\n    <button [title]=\"'multiSelect.allShiftLeft' | locale\" class=\"btn btn-secondary f-btn-icon\" type=\"button\"\r\n        (click)=\"moveAllToLeft()\">\r\n        <span class=\"f-icon f-icon-arrow-seek-left\"></span>\r\n    </button>\r\n</div>\r\n<div class=\"f-utils-fill f-multi-select-list d-flex flex-column\">\r\n    <div class=\"f-utils-flex-column f-multi-select-list-content f-utils-fill\">\r\n        <legend class=\"f-multi-select-list-title\">\r\n            {{rightTitle === '\u5DF2\u9009\u62E9' ? ('multiSelect.rightTitle'|locale) : rightTitle}} ({{selections && selections.length}})\r\n\r\n            <div *ngIf=\"enableReset && showCheckbox\">\r\n                <button class=\"btn btn-link\" title=\"\u53D6\u6D88\u6240\u6709\u52FE\u9009\" (click)=\"clearRightCheckeds()\">\u91CD\u7F6E</button>\r\n            </div>\r\n            <ng-content select=\".right-title\"></ng-content>\r\n        </legend>\r\n        <div class=\"container columns-box f-utils-fill\">\r\n            <perfect-scrollbar [config]=\"{}\">\r\n                <ul class=\"f-multi-select-list-group multi-select-list-group-flush f-multi-select-list-group--right\">\r\n                    <li class=\"f-multi-select-list-group-item\" *ngFor=\"let data of selections;trackBy: trackByItems; index as i\"\r\n                        (click)=\"onRightItemClick($event, data, i)\"  [ngClass]=\"{'item--show-checkbox':showCheckbox && data['showCheckbox'] !== false}\"\r\n                        [class.active]=\"!enableMoveMore ?rightSelectedItem && rightSelectedItem[this.idField] === data[idField] : (_rightCheckeds? !!_rightCheckeds[data[idField]] : false)\"\r\n                        [ngStyle]=\"wordWrap ? { overflow: 'hidden',textOverflow: 'ellipsis'} : null\">\r\n                        <ng-container *ngIf=\"showCheckbox && data['showCheckbox'] !== false\">\r\n                            <div class=\"custom-control custom-checkbox f-checkradio-single\">\r\n                               <input type=\"checkbox\" class=\"custom-control-input\" [checked]=\"isChecked(data, 'R')\">\r\n                               <label class=\"custom-control-label\"></label>\r\n                            </div>  \r\n                        </ng-container>\r\n                        <display-text [template]=\"displayTemplate\" [data]=\"data\" [side]=\"'R'\" \r\n                            [style.word-wrap]=\"wordWrap? 'break-word': 'normal'\"\r\n                            [style.white-space]=\"wordWrap ? 'break-spaces': 'nowrap'\" ></display-text>\r\n                    </li>\r\n                </ul>\r\n            </perfect-scrollbar>\r\n        </div>\r\n    </div>\r\n</div>\r\n<div class=\"f-multi-select-list-btns\" *ngIf=\"enableTargetSort\">\r\n    <button [title]=\"'multiSelect.top' | locale\" class=\"btn btn-secondary f-btn-icon\" type=\"button\" (click)=\"moveTop()\">\r\n        <span class=\"f-icon f-icon-roofing\"></span>\r\n    </button>\r\n    <button [title]=\"'multiSelect.shiftUp' | locale\" class=\"btn btn-secondary f-btn-icon right-all\" type=\"button\"\r\n        (click)=\"moveUp()\">\r\n        <span class=\"f-icon f-icon-arrow-chevron-up\"></span>\r\n    </button>\r\n    <button [title]=\"'multiSelect.shiftDown' | locale\" class=\"btn btn-secondary f-btn-icon\" type=\"button\"\r\n        (click)=\"moveDown()\">\r\n        <span class=\"f-icon f-icon-arrow-chevron-down\"></span>\r\n    </button>\r\n    <button [title]=\"'multiSelect.bottom' | locale\" class=\"btn btn-secondary f-btn-icon\" type=\"button\"\r\n        (click)=\"moveBottom()\">\r\n        <span class=\"f-icon f-icon-bottomsetting\"></span>\r\n    </button>\r\n</div>",
                styles: [".f-multi-select-list .search{position:relative}.f-multi-select-list .search .form-control{line-height:1.875;height:1.875;outline:0}.f-multi-select-list .f-table-norecords-content{margin:-10.0625rem 0 0 -.225rem}"]
            }] }
];
/** @nocollapse */
MultiSelectComponent.ctorParameters = () => [
    { type: MessagerService },
    { type: Injector },
    { type: ChangeDetectorRef }
];
MultiSelectComponent.propDecorators = {
    dataSource: [{ type: Input }],
    displayType: [{ type: Input }],
    enableTargetSort: [{ type: Input }],
    idField: [{ type: Input }],
    textField: [{ type: Input }],
    valueField: [{ type: Input }],
    height: [{ type: Input }],
    fit: [{ type: Input }],
    noDataMoveMessage: [{ type: Input }],
    showCascadeControl: [{ type: Input }],
    leftTitle: [{ type: Input }],
    rightTitle: [{ type: Input }],
    selectedId: [{ type: Input }],
    enableSearch: [{ type: Input }],
    showCheckbox: [{ type: Input }],
    enableReset: [{ type: Input }],
    wordWrap: [{ type: Input }],
    enableMoveMore: [{ type: Input }],
    searchValueField: [{ type: Input }],
    dataChange: [{ type: Output }],
    selected: [{ type: Output }],
    unSelected: [{ type: Output }],
    selectedIdChange: [{ type: Output }],
    beforeMove: [{ type: Output }],
    afterMove: [{ type: Output }],
    sortMove: [{ type: Output }],
    templates: [{ type: ContentChildren, args: [FarrisTemplateDirective,] }],
    tt: [{ type: ViewChild, args: ['tt',] }]
};
if (false) {
    /**
     * @type {?}
     * @private
     */
    MultiSelectComponent.prototype.allTreeNodes;
    /**
     * @type {?}
     * @private
     */
    MultiSelectComponent.prototype._ds;
    /** @type {?} */
    MultiSelectComponent.prototype.displayType;
    /**
     * 显示右侧上移下移按钮
     * @type {?}
     */
    MultiSelectComponent.prototype.enableTargetSort;
    /** @type {?} */
    MultiSelectComponent.prototype.idField;
    /** @type {?} */
    MultiSelectComponent.prototype.textField;
    /** @type {?} */
    MultiSelectComponent.prototype.valueField;
    /** @type {?} */
    MultiSelectComponent.prototype.height;
    /** @type {?} */
    MultiSelectComponent.prototype.fit;
    /** @type {?} */
    MultiSelectComponent.prototype.noDataMoveMessage;
    /**
     * 树结构时，是否显示级联选择控制选项
     * @type {?}
     */
    MultiSelectComponent.prototype.showCascadeControl;
    /** @type {?} */
    MultiSelectComponent.prototype.leftTitle;
    /** @type {?} */
    MultiSelectComponent.prototype.rightTitle;
    /** @type {?} */
    MultiSelectComponent.prototype.selectedId;
    /** @type {?} */
    MultiSelectComponent.prototype.enableSearch;
    /**
     * 目标数据源显示checkbox 允许多选
     * @type {?}
     */
    MultiSelectComponent.prototype.showCheckbox;
    /**
     * 右侧已选启用重置，在启用复选框时，是否显示重置按钮，即取消右侧所有勾选项，默认为 false
     * @type {?}
     */
    MultiSelectComponent.prototype.enableReset;
    /**
     * 启用折行
     * @type {?}
     */
    MultiSelectComponent.prototype.wordWrap;
    /**
     * 启用多条记录一起移动；默认 false
     * @type {?}
     */
    MultiSelectComponent.prototype.enableMoveMore;
    /**
     * 查询时对value字段进行查询，默认为 true; false时仅查询文本字段
     * @type {?}
     */
    MultiSelectComponent.prototype.searchValueField;
    /** @type {?} */
    MultiSelectComponent.prototype.dataChange;
    /** @type {?} */
    MultiSelectComponent.prototype.selected;
    /** @type {?} */
    MultiSelectComponent.prototype.unSelected;
    /** @type {?} */
    MultiSelectComponent.prototype.selectedIdChange;
    /** @type {?} */
    MultiSelectComponent.prototype.beforeMove;
    /** @type {?} */
    MultiSelectComponent.prototype.afterMove;
    /** @type {?} */
    MultiSelectComponent.prototype.sortMove;
    /** @type {?} */
    MultiSelectComponent.prototype.templates;
    /** @type {?} */
    MultiSelectComponent.prototype.tt;
    /** @type {?} */
    MultiSelectComponent.prototype._rightCheckeds;
    /** @type {?} */
    MultiSelectComponent.prototype._leftCheckeds;
    /** @type {?} */
    MultiSelectComponent.prototype._rightData;
    /** @type {?} */
    MultiSelectComponent.prototype.canCheckLength;
    /** @type {?} */
    MultiSelectComponent.prototype.leftCount;
    /** @type {?} */
    MultiSelectComponent.prototype._searchValue;
    /**
     * @type {?}
     * @private
     */
    MultiSelectComponent.prototype.copyDataSource;
    /** @type {?} */
    MultiSelectComponent.prototype.treeDataLength;
    /** @type {?} */
    MultiSelectComponent.prototype.displayTemplate;
    /** @type {?} */
    MultiSelectComponent.prototype.emptyData;
    /** @type {?} */
    MultiSelectComponent.prototype.el;
    /** @type {?} */
    MultiSelectComponent.prototype.render;
    /** @type {?} */
    MultiSelectComponent.prototype.localeService;
    /** @type {?} */
    MultiSelectComponent.prototype.commonUtils;
    /** @type {?} */
    MultiSelectComponent.prototype.enableCascase;
    /**
     * @type {?}
     * @private
     */
    MultiSelectComponent.prototype.updateTimer1;
    /**
     * @type {?}
     * @private
     */
    MultiSelectComponent.prototype.updateTimer2;
    /** @type {?} */
    MultiSelectComponent.prototype.rightSelectedItem;
    /** @type {?} */
    MultiSelectComponent.prototype.rightActiveIndex;
    /** @type {?} */
    MultiSelectComponent.prototype.trackByItems;
    /**
     * @type {?}
     * @private
     */
    MultiSelectComponent.prototype.mesagerSer;
    /**
     * @type {?}
     * @private
     */
    MultiSelectComponent.prototype.injector;
    /**
     * @type {?}
     * @private
     */
    MultiSelectComponent.prototype.cd;
}
export class DisplayTextComponent {
    /**
     * @param {?} ms
     */
    constructor(ms) {
        this.ms = ms;
        this.side = 'L';
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        // console.log(this.data);
    }
    /**
     * @param {?} item
     * @return {?}
     */
    _getText(item) {
        return this.ms.getText(item);
    }
}
DisplayTextComponent.decorators = [
    { type: Component, args: [{
                selector: 'display-text',
                template: `
        <ng-container *ngIf="template" >
            <ng-container
                *ngTemplateOutlet="template; context: {$implicit: data,instance: ms, side: side, selected: ms.isChecked(data, 'R') }">
            </ng-container>
        </ng-container>
        <ng-container *ngIf="!template">{{_getText(data)}}</ng-container>
    `
            }] }
];
/** @nocollapse */
DisplayTextComponent.ctorParameters = () => [
    { type: MultiSelectComponent }
];
DisplayTextComponent.propDecorators = {
    template: [{ type: Input }],
    data: [{ type: Input }],
    side: [{ type: Input }]
};
if (false) {
    /** @type {?} */
    DisplayTextComponent.prototype.template;
    /** @type {?} */
    DisplayTextComponent.prototype.data;
    /** @type {?} */
    DisplayTextComponent.prototype.side;
    /** @type {?} */
    DisplayTextComponent.prototype.ms;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibXVsdGktc2VsZWN0LmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvdWktbXVsdGktc2VsZWN0LyIsInNvdXJjZXMiOlsibGliL211bHRpLXNlbGVjdC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxXQUFXLENBQUM7Ozs7Ozs7OztBQVV0QyxPQUFPLEVBQ0gsU0FBUyxFQUFVLEtBQUssRUFBRSxTQUFTLEVBQUUsTUFBTSxFQUFFLFlBQVksRUFDekQsV0FBVyxFQUFFLGVBQWUsRUFBRSxTQUFTLEVBQ2IsUUFBUSxFQUFFLGlCQUFpQixFQUFFLFVBQVUsRUFBRSxTQUFTLEVBQy9FLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUN0RCxPQUFPLEVBQUUsa0JBQWtCLEVBQVksTUFBTSxzQkFBc0IsQ0FBQztBQUNwRSxPQUFPLEVBQUUsV0FBVyxFQUFFLHVCQUF1QixFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFDekUsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBVWxELE1BQU0sT0FBTyxvQkFBb0I7Ozs7OztJQThKN0IsWUFBb0IsVUFBMkIsRUFBVSxRQUFrQixFQUFVLEVBQXFCO1FBQXRGLGVBQVUsR0FBVixVQUFVLENBQWlCO1FBQVUsYUFBUSxHQUFSLFFBQVEsQ0FBVTtRQUFVLE9BQUUsR0FBRixFQUFFLENBQW1CO1FBNUpsRyxpQkFBWSxHQUFHLEVBQUUsQ0FBQztRQUNsQixRQUFHLEdBQVEsRUFBRSxDQUFDO1FBc0JiLGdCQUFXLEdBQW9CLE1BQU0sQ0FBQzs7OztRQUV0QyxxQkFBZ0IsR0FBRyxJQUFJLENBQUM7UUFPeEIsV0FBTSxHQUFHLEdBQUcsQ0FBQztRQUNiLFFBQUcsR0FBRyxJQUFJLENBQUM7UUFDWCxzQkFBaUIsR0FBRyxZQUFZLENBQUM7Ozs7UUFFakMs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Ozs7SUFFbEIsOENBQTRCOztJQUU1Qiw4Q0FBdUI7O0lBQ3ZCLCtDQUFrQzs7SUFHbEMseUNBQVU7O0lBQ1Ysa0NBQWU7O0lBQ2Ysc0NBQWtCOztJQUNsQiw2Q0FBNkI7O0lBQzdCLDJDQUF5Qjs7SUFFekIsNkNBQXFCOzs7OztJQUVyQiw0Q0FBNEI7Ozs7O0lBQzVCLDRDQUE0Qjs7SUFFNUIsaURBQXlCOztJQUN6QixnREFBc0I7O0lBazJCdEIsNENBRUM7Ozs7O0lBbDJCVywwQ0FBbUM7Ozs7O0lBQUUsd0NBQTBCOzs7OztJQUFFLGtDQUE2Qjs7QUF1aUM5RyxNQUFNLE9BQU8sb0JBQW9COzs7O0lBSzdCLFlBQW1CLEVBQXdCO1FBQXhCLE9BQUUsR0FBRixFQUFFLENBQXNCO1FBRmxDLFNBQUksR0FBRyxHQUFHLENBQUM7SUFFMkIsQ0FBQzs7OztJQUVoRCxRQUFRO1FBQ0osMEJBQTBCO0lBQzlCLENBQUM7Ozs7O0lBRUQsUUFBUSxDQUFDLElBQUk7UUFDVCxPQUFPLElBQUksQ0FBQyxFQUFFLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQ2pDLENBQUM7OztZQXhCSixTQUFTLFNBQUM7Z0JBQ1AsUUFBUSxFQUFFLGNBQWM7Z0JBQ3hCLFFBQVEsRUFBRTs7Ozs7OztLQU9UO2FBQ0o7Ozs7WUFNMEIsb0JBQW9COzs7dUJBSjFDLEtBQUs7bUJBQ0wsS0FBSzttQkFDTCxLQUFLOzs7O0lBRk4sd0NBQW9DOztJQUNwQyxvQ0FBbUI7O0lBQ25CLG9DQUFvQjs7SUFFUixrQ0FBK0IiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBjbG9uZURlZXAgfSBmcm9tICdsb2Rhc2gtZXMnO1xyXG4vKlxyXG4qIEBBdXRob3I6IOeWr+eLguengOaJjShsdWNhcyBodWFuZylcclxuKiBARGF0ZTogMjAxOC0xMC0yNyAxMDo1NTowMlxyXG4gKiBATGFzdEVkaXRvcnM6IOeWr+eLguengOaJjShMdWNhcyBIdWFuZylcclxuICogQExhc3RFZGl0VGltZTogMjAxOS0xMC0xNiAxNDoxNDoxNFxyXG4qIEBDb21wYW55OiBJbnNwdXJcclxuKiBAVmVyc2lvbjogdjAuMC4xXHJcbiovXHJcblxyXG5pbXBvcnQge1xyXG4gICAgQ29tcG9uZW50LCBPbkluaXQsIElucHV0LCBWaWV3Q2hpbGQsIE91dHB1dCwgRXZlbnRFbWl0dGVyLFxyXG4gICAgVGVtcGxhdGVSZWYsIENvbnRlbnRDaGlsZHJlbiwgUXVlcnlMaXN0LCBBZnRlckNvbnRlbnRJbml0LCBBZnRlclZpZXdJbml0LFxyXG4gICAgT25DaGFuZ2VzLCBTaW1wbGVDaGFuZ2VzLCBJbmplY3RvciwgQ2hhbmdlRGV0ZWN0b3JSZWYsIEVsZW1lbnRSZWYsIFJlbmRlcmVyMlxyXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBNZXNzYWdlclNlcnZpY2UgfSBmcm9tICdAZmFycmlzL3VpLW1lc3NhZ2VyJztcclxuaW1wb3J0IHsgVHJlZVRhYmxlQ29tcG9uZW50LCBUcmVlTm9kZSB9IGZyb20gJ0BmYXJyaXMvdWktdHJlZXRhYmxlJztcclxuaW1wb3J0IHsgQ29tbW9uVXRpbHMsIEZhcnJpc1RlbXBsYXRlRGlyZWN0aXZlIH0gZnJvbSAnQGZhcnJpcy91aS1jb21tb24nO1xyXG5pbXBvcnQgeyBMb2NhbGVTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy91aS1sb2NhbGUnO1xyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgICBzZWxlY3RvcjogJ211bHRpLXNlbGVjdCcsXHJcbiAgICB0ZW1wbGF0ZVVybDogJy4vbXVsdGktc2VsZWN0LmNvbXBvbmVudC5odG1sJyxcclxuICAgIHN0eWxlVXJsczogW1xyXG4gICAgICAgICcuL211bHRpLXNlbGVjdC5jc3MnXHJcbiAgICBdXHJcbn0pXHJcblxyXG5leHBvcnQgY2xhc3MgTXVsdGlTZWxlY3RDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIE9uQ2hhbmdlcywgQWZ0ZXJWaWV3SW5pdCwgQWZ0ZXJDb250ZW50SW5pdCB7XHJcblxyXG4gICAgcHJpdmF0ZSBhbGxUcmVlTm9kZXMgPSBbXTtcclxuICAgIHByaXZhdGUgX2RzOiBhbnkgPSBbXTtcclxuICAgIGdldCBkYXRhU291cmNlKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9kcztcclxuICAgIH1cclxuICAgIEBJbnB1dCgpIHNldCBkYXRhU291cmNlKHZhbDogYW55KSB7XHJcbiAgICAgICAgdmFsID0gdmFsICB8fCBbXTtcclxuICAgICAgICB0aGlzLl9kcyA9IHZhbDtcclxuICAgICAgICBpZiAoIXRoaXMuc2VhcmNoVmFsdWUpIHtcclxuICAgICAgICAgICAgaWYgKHZhbC5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgIGlmICh2YWxbMF0udG9KU09OKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jb3B5RGF0YVNvdXJjZSA9IHZhbC5tYXAobiA9PiBuLnRvSlNPTigpKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jb3B5RGF0YVNvdXJjZSA9IGNsb25lRGVlcCh2YWwpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMuaW5pdFJpZ2h0RGF0YSh0aGlzLnNlbGVjdGVkSWQsIGZhbHNlKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIEBJbnB1dCgpIGRpc3BsYXlUeXBlOiAnTGlzdCcgfCAnVHJlZScgPSAnTGlzdCc7XHJcbiAgICAvKiog5pi+56S65Y+z5L6n5LiK56e75LiL56e75oyJ6ZKuICovXHJcbiAgICBASW5wdXQoKSBlbmFibGVUYXJnZXRTb3J0ID0gdHJ1ZTtcclxuXHJcbiAgICBASW5wdXQoKSBpZEZpZWxkOiBzdHJpbmc7XHJcblxyXG4gICAgQElucHV0KCkgdGV4dEZpZWxkOiBzdHJpbmc7XHJcbiAgICBASW5wdXQoKSB2YWx1ZUZpZWxkOiBzdHJpbmc7XHJcblxyXG4gICAgQElucHV0KCkgaGVpZ2h0ID0gNDQ1O1xyXG4gICAgQElucHV0KCkgZml0ID0gdHJ1ZTtcclxuICAgIEBJbnB1dCgpIG5vRGF0YU1vdmVNZXNzYWdlID0gJ+ivt+mAieaLqeimgeenu+WKqOeahOaVsOaNruOAgic7XHJcbiAgICAvKiog5qCR57uT5p6E5pe277yM5piv5ZCm5pi+56S657qn6IGU6YCJ5oup5o6n5Yi26YCJ6aG5ICovXHJcbiAgICBASW5wdXQoKSBzaG93Q2FzY2FkZUNvbnRyb2wgPSBmYWxzZTtcclxuXHJcbiAgICBASW5wdXQoKSBsZWZ0VGl0bGUgPSAn5pyq6YCJ5oupJztcclxuICAgIEBJbnB1dCgpIHJpZ2h0VGl0bGUgPSAn5bey6YCJ5oupJztcclxuICAgIEBJbnB1dCgpIHNlbGVjdGVkSWQ6IGFueTtcclxuICAgIEBJbnB1dCgpIGVuYWJsZVNlYXJjaCA9IHRydWU7XHJcbiAgICAvKiog55uu5qCH5pWw5o2u5rqQ5pi+56S6Y2hlY2tib3gg5YWB6K645aSa6YCJICovXHJcbiAgICBASW5wdXQoKSBzaG93Q2hlY2tib3ggPSBmYWxzZTtcclxuICAgIC8qKiDlj7Pkvqflt7LpgInlkK/nlKjph43nva7vvIzlnKjlkK/nlKjlpI3pgInmoYbml7bvvIzmmK/lkKbmmL7npLrph43nva7mjInpkq7vvIzljbPlj5bmtojlj7PkvqfmiYDmnInli77pgInpobnvvIzpu5jorqTkuLogZmFsc2UgKi9cclxuICAgIEBJbnB1dCgpIGVuYWJsZVJlc2V0ID0gZmFsc2U7XHJcblxyXG4gICAgLyoqIOWQr+eUqOaKmOihjCAqL1xyXG4gICAgQElucHV0KCkgd29yZFdyYXAgPSBmYWxzZTtcclxuICAgIC8qKiDlkK/nlKjlpJrmnaHorrDlvZXkuIDotbfnp7vliqjvvJvpu5jorqQgZmFsc2UgKi9cclxuICAgIEBJbnB1dCgpIGVuYWJsZU1vdmVNb3JlID0gZmFsc2U7XHJcblxyXG4gICAgLyoqIOafpeivouaXtuWvuXZhbHVl5a2X5q616L+b6KGM5p+l6K+i77yM6buY6K6k5Li6IHRydWU7IGZhbHNl5pe25LuF5p+l6K+i5paH5pys5a2X5q61ICovXHJcbiAgICBASW5wdXQoKSBzZWFyY2hWYWx1ZUZpZWxkID0gdHJ1ZTtcclxuICAgXHJcblxyXG4gICAgQE91dHB1dCgpIGRhdGFDaGFuZ2UgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcbiAgICBAT3V0cHV0KCkgc2VsZWN0ZWQgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcbiAgICBAT3V0cHV0KCkgdW5TZWxlY3RlZCA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuICAgIEBPdXRwdXQoKSBzZWxlY3RlZElkQ2hhbmdlID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG5cclxuICAgIEBPdXRwdXQoKSBiZWZvcmVNb3ZlID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG4gICAgQE91dHB1dCgpIGFmdGVyTW92ZSA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuXHJcbiAgICBAT3V0cHV0KCkgc29ydE1vdmUgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcblxyXG4gICAgQENvbnRlbnRDaGlsZHJlbihGYXJyaXNUZW1wbGF0ZURpcmVjdGl2ZSkgdGVtcGxhdGVzOiBRdWVyeUxpc3Q8RmFycmlzVGVtcGxhdGVEaXJlY3RpdmU+O1xyXG4gICAgQFZpZXdDaGlsZCgndHQnKSB0dDogVHJlZVRhYmxlQ29tcG9uZW50O1xyXG5cclxuXHJcbiAgICAvLyDlj7PkvqfpgInkuK3nmoTmlbDmja4geyBba2V5VmFsXTogb2JqLCBba2V5VmFsXTogb2JqIC4uLiB9XHJcbiAgICBfcmlnaHRDaGVja2VkczogYW55O1xyXG4gICAgLy8g5bem5L6n6YCJ5Lit55qE5pWw5o2uIHsgW2tleVZhbF06IG9iaiwgW2tleVZhbF06IG9iaiAuLi4gfVxyXG4gICAgX2xlZnRDaGVja2VkczogYW55ID0ge307XHJcblxyXG4gICAgLy8g5Y+z5L6n5pWw5o2uXHJcbiAgICBfcmlnaHREYXRhID0gW107XHJcbiAgICBnZXQgc2VsZWN0aW9ucygpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fcmlnaHREYXRhO1xyXG4gICAgfVxyXG4gICAgc2V0IHNlbGVjdGlvbnModmFsOiBhbnkpIHtcclxuICAgICAgICB0aGlzLl9yaWdodERhdGEgPSB2YWwuZmlsdGVyKG4gPT4gbiAhPT0gdW5kZWZpbmVkICYmIG4gIT09IG51bGwpO1xyXG4gICAgICAgIHRoaXMuY2QuZGV0ZWN0Q2hhbmdlcygpO1xyXG4gICAgfVxyXG4gICAgZ2V0IHNlYXJjaFZhbHVlKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9zZWFyY2hWYWx1ZTtcclxuICAgIH1cclxuICAgIHNldCBzZWFyY2hWYWx1ZSh2YWx1ZTogc3RyaW5nKSB7XHJcbiAgICAgICAgdGhpcy5fc2VhcmNoVmFsdWUgPSB2YWx1ZTtcclxuXHJcbiAgICAgICAgLy8gdGhpcy5jb3B5RGF0YVNvdXJjZSA9IFsuLi50aGlzLmRhdGFTb3VyY2VdO1xyXG5cclxuICAgICAgICBpZiAodmFsdWUgPT09IHVuZGVmaW5lZCB8fCB2YWx1ZSA9PT0gbnVsbCB8fCB2YWx1ZSA9PT0gJycpIHtcclxuICAgICAgICAgICAgbGV0IGxlZnRDaGVja2l0ZW1zID0gey4uLnRoaXMuX2xlZnRDaGVja2Vkc307XHJcblxyXG4gICAgICAgICAgICBpZiAodGhpcy5kaXNwbGF5VHlwZSA9PT0gJ1RyZWUnKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnR0LnNlbGVjdGlvbnMuZm9yRWFjaChuID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBsZWZ0Q2hlY2tpdGVtc1tuLmlkXSA9IG4uZGF0YTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMuZGF0YVNvdXJjZSA9IHRoaXMuY29weURhdGFTb3VyY2U7XHJcblxyXG5cclxuICAgICAgICAgICAgaWYgKHRoaXMuZGlzcGxheVR5cGUgPT09ICdUcmVlJykge1xyXG4gICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgaWRzID0gT2JqZWN0LmtleXMobGVmdENoZWNraXRlbXMpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChpZHMgJiYgaWRzLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnR0LmNoZWNrZWROb2RlcyhpZHMpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9IGVsc2UgIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuX2xlZnRDaGVja2VkcyA9IHsuLi5sZWZ0Q2hlY2tpdGVtc307XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHRoaXMuZGlzcGxheVR5cGUgPT09ICdUcmVlJykge1xyXG4gICAgICAgICAgICAvLyBjb25zdCBuZXdEYXRhU291cmNlID0gdGhpcy5nZXRUcmVlRGF0YUJ5U2VhcmNoKHRoaXMuX3NlYXJjaFZhbHVlLCB0aGlzLmFsbFRyZWVOb2Rlcyk7XHJcbiAgICAgICAgICAgIHRoaXMudHQuc2VhcmNoSGFuZGxlLnNlYXJjaChgJHt0aGlzLnRleHRGaWVsZH0sJHt0aGlzLnZhbHVlRmllbGR9YCwgdGhpcy5fc2VhcmNoVmFsdWUpXHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMuZGF0YVNvdXJjZSA9IHRoaXMuZ2V0TGlzdERhdGFCeVNlYXJjaCh0aGlzLl9zZWFyY2hWYWx1ZSwgdGhpcy5jb3B5RGF0YVNvdXJjZSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodGhpcy51cGRhdGVUaW1lcjEpIHtcclxuICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXMudXBkYXRlVGltZXIxKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy51cGRhdGVUaW1lcjEgPSBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgICAgdGhpcy5jYW5DaGVja0xlbmd0aCA9IHRoaXMuZ2V0Q2FuQ2hlY2tMZW5ndGgoKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBjYW5DaGVja0xlbmd0aCA9IDA7XHJcbiAgICBsZWZ0Q291bnQgPSAwO1xyXG4gICAgX3NlYXJjaFZhbHVlID0gJyc7XHJcbiAgICAvLyDlpI3liLbkuIDku73mlbDmja7mupBcclxuICAgIHByaXZhdGUgY29weURhdGFTb3VyY2U6IGFueTtcclxuICAgIC8vIOagkeW9oue7k+aehOeahOaVsOaNrmxlbmd0aFxyXG4gICAgdHJlZURhdGFMZW5ndGg6IG51bWJlcjtcclxuICAgIGRpc3BsYXlUZW1wbGF0ZTogVGVtcGxhdGVSZWY8YW55PjtcclxuXHJcblxyXG4gICAgZW1wdHlEYXRhO1xyXG4gICAgZWw6IEVsZW1lbnRSZWY7XHJcbiAgICByZW5kZXI6IFJlbmRlcmVyMjtcclxuICAgIGxvY2FsZVNlcnZpY2U6IExvY2FsZVNlcnZpY2U7XHJcbiAgICBjb21tb25VdGlsczogQ29tbW9uVXRpbHM7XHJcbiAgICAvLyDnuqfogZTpgInmi6nmjqfliLbpgInpoblcclxuICAgIGVuYWJsZUNhc2Nhc2UgPSB0cnVlO1xyXG5cclxuICAgIHByaXZhdGUgdXBkYXRlVGltZXIxID0gbnVsbDtcclxuICAgIHByaXZhdGUgdXBkYXRlVGltZXIyID0gbnVsbDtcclxuXHJcbiAgICByaWdodFNlbGVjdGVkSXRlbSA9IG51bGw7XHJcbiAgICByaWdodEFjdGl2ZUluZGV4ID0gLTE7XHJcblxyXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBtZXNhZ2VyU2VyOiBNZXNzYWdlclNlcnZpY2UsIHByaXZhdGUgaW5qZWN0b3I6IEluamVjdG9yLCBwcml2YXRlIGNkOiBDaGFuZ2VEZXRlY3RvclJlZikge1xyXG4gICAgICAgIGlmICghT2JqZWN0LnZhbHVlcykge1xyXG4gICAgICAgICAgICBPYmplY3QudmFsdWVzID0gZnVuY3Rpb24gKG9iaikge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIE9iamVjdC5rZXlzKG9iaikubWFwKGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9ialtlXTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmVsID0gdGhpcy5pbmplY3Rvci5nZXQ8RWxlbWVudFJlZj4oRWxlbWVudFJlZik7XHJcbiAgICAgICAgdGhpcy5yZW5kZXIgPSB0aGlzLmluamVjdG9yLmdldChSZW5kZXJlcjIpO1xyXG4gICAgICAgIHRoaXMubG9jYWxlU2VydmljZSA9IHRoaXMuaW5qZWN0b3IuZ2V0KExvY2FsZVNlcnZpY2UpO1xyXG5cclxuICAgICAgICB0aGlzLmNvbW1vblV0aWxzID0gdGhpcy5pbmplY3Rvci5nZXQoQ29tbW9uVXRpbHMsIG51bGwpO1xyXG4gICAgfVxyXG5cclxuICAgIG5nT25Jbml0KCkge1xyXG4gICAgICAgIC8vIHRoaXMuY29weURhdGFTb3VyY2UgPSB0aGlzLmRhdGFTb3VyY2UgPyBbLi4udGhpcy5kYXRhU291cmNlXSA6IFtdO1xyXG4gICAgICAgIHRoaXMuZW1wdHlEYXRhID0gdGhpcy5sb2NhbGVTZXJ2aWNlLmdldFZhbHVlKCdtdWx0aVNlbGVjdC5lbXB0eURhdGEnKSB8fCAn5pqC5peg5pWw5o2uJztcclxuICAgICAgICB0aGlzLmluaXRSaWdodERhdGEodGhpcy5zZWxlY3RlZElkKTtcclxuICAgICAgICB0aGlzLm1vdmVJdGVtKCk7XHJcblxyXG4gICAgICAgIGlmICghdGhpcy5zaG93Q2hlY2tib3ggJiYgdGhpcy5lbmFibGVNb3ZlTW9yZSl7XHJcbiAgICAgICAgICAgIHRoaXMuc2hvd0NoZWNrYm94ID0gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgbmdBZnRlclZpZXdJbml0KCkge1xyXG4gICAgICAgIGNvbnN0IGVsdCA9IHRoaXMuZWwubmF0aXZlRWxlbWVudDtcclxuICAgICAgICB0aGlzLnJlbmRlci5hZGRDbGFzcyhlbHQsICdyb3cnKTtcclxuICAgICAgICB0aGlzLnJlbmRlci5hZGRDbGFzcyhlbHQsICdmLW11bHRpLXNlbGVjdCcpO1xyXG4gICAgICAgIGlmICh0aGlzLmZpdCA9PT0gdHJ1ZSkge1xyXG4gICAgICAgICAgICB0aGlzLnJlbmRlci5hZGRDbGFzcyhlbHQsICdmLXV0aWxzLWZpbGwnKTtcclxuICAgICAgICAgICAgdGhpcy5yZW5kZXIuc2V0U3R5bGUoZWx0LCAnaGVpZ2h0JywgJzEwMCUnKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBpZiAoISF0aGlzLmhlaWdodCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5yZW5kZXIuc2V0U3R5bGUoZWx0LCAnaGVpZ2h0JywgdGhpcy5oZWlnaHQgKyAncHgnKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5ub0RhdGFNb3ZlTWVzc2FnZSA9XHJcbiAgICAgICAgICAgIHRoaXMubm9EYXRhTW92ZU1lc3NhZ2UgPT09ICfor7fpgInmi6nopoHnp7vliqjnmoTmlbDmja7jgIInID8gdGhpcy5sb2NhbGVTZXJ2aWNlLmdldFZhbHVlKCdtdWx0aVNlbGVjdC5ub0RhdGFNb3ZlTWVzc2FnZScpIDogdGhpcy5ub0RhdGFNb3ZlTWVzc2FnZTtcclxuXHJcbiAgICAgICAgaWYgKHRoaXMudHQgJiYgdGhpcy5zZWxlY3RlZElkKSB7XHJcbiAgICAgICAgICAgIHRoaXMudHQuY2hlY2tlZE5vZGVzKHRoaXMuc2VsZWN0ZWRJZCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIG5nQWZ0ZXJDb250ZW50SW5pdCgpIHtcclxuICAgICAgICB0aGlzLnRlbXBsYXRlcy5mb3JFYWNoKChpdGVtKSA9PiB7XHJcbiAgICAgICAgICAgIHN3aXRjaCAoaXRlbS5nZXRUeXBlKCkpIHtcclxuICAgICAgICAgICAgICAgIGNhc2UgJ3RleHQnOlxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGlzcGxheVRlbXBsYXRlID0gaXRlbS50ZW1wbGF0ZTtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpIHtcclxuICAgICAgICBpZiAoY2hhbmdlcy5kYXRhU291cmNlICYmICFjaGFuZ2VzLmRhdGFTb3VyY2UuaXNGaXJzdENoYW5nZSgpKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX2xlZnRDaGVja2VkcyA9IHt9O1xyXG4gICAgICAgICAgICB0aGlzLl9yaWdodERhdGEgPSBbXTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChjaGFuZ2VzLnNlbGVjdGVkSWQgJiYgIWNoYW5nZXMuc2VsZWN0ZWRJZC5pc0ZpcnN0Q2hhbmdlKCkpIHtcclxuICAgICAgICAgICAgY29uc3QgY3YgPSBjaGFuZ2VzLnNlbGVjdGVkSWQuY3VycmVudFZhbHVlIHx8IFtdO1xyXG4gICAgICAgICAgICBjb25zdCBwdiA9IGNoYW5nZXMuc2VsZWN0ZWRJZC5wcmV2aW91c1ZhbHVlIHx8IFtdO1xyXG5cclxuXHJcbiAgICAgICAgICAgIC8vIOW9k+iuvue9rumAieS4reeahElEIOS4uuepuuaXtu+8jOaJp+ihjOa4heepuuWPs+S+p+aVsOaNrlxyXG4gICAgICAgICAgICBpZiAoIWN2Lmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jbGVhclNlbGVjdGlvbnMoKTtcclxuICAgICAgICAgICAgICAgIC8vIFRGUyA2MTE5MjhcclxuICAgICAgICAgICAgICAgIHRoaXMuY2FuQ2hlY2tMZW5ndGggPSB0aGlzLmdldENhbkNoZWNrTGVuZ3RoKCk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmIChjdi5sZW5ndGggIT0gcHYubGVuZ3RoIHx8IEpTT04uc3RyaW5naWZ5KGN2KSAhPT0gSlNPTi5zdHJpbmdpZnkocHYpKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmluaXRSaWdodERhdGEoY2hhbmdlcy5zZWxlY3RlZElkLmN1cnJlbnRWYWx1ZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0Q2FuQ2hlY2tMZW5ndGgoKSB7XHJcbiAgICAgICAgbGV0IG4gPSAwO1xyXG4gICAgICAgIGxldCB0b3RhbCA9IDA7XHJcbiAgICAgICAgaWYgKHRoaXMuaXNUcmVlKCkpIHtcclxuICAgICAgICAgICAgdGhpcy50dC5zZXJpYWxpemVkVmFsdWUuZm9yRWFjaChybiA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAocm4ubm9kZS5zZWxlY3RhYmxlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuY2FuQ2hlY2tlZChybi5ub2RlKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBuKys7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgdG90YWwgPSB0aGlzLnR0LnNlcmlhbGl6ZWRWYWx1ZS5sZW5ndGg7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5kYXRhU291cmNlLmZvckVhY2goZCA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5jYW5DaGVja2VkKGQpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbisrO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgdG90YWwgPSB0aGlzLmRhdGFTb3VyY2UubGVuZ3RoO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmxlZnRDb3VudCA9IHRvdGFsO1xyXG4gICAgICAgIHJldHVybiBuO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog6I635Y+W5pCc57Si55qE5pWw5o2u77yMTGlzdOe7k+aehFxyXG4gICAgICogQHBhcmFtIHZhbHVlIOaQnOe0oueahOWtl+esplxyXG4gICAgICogQHBhcmFtIGRhdGEg5pWw5o2uXHJcbiAgICAgKi9cclxuICAgIHByaXZhdGUgZ2V0TGlzdERhdGFCeVNlYXJjaCh2YWx1ZTogc3RyaW5nLCBkYXRhOiBhbnlbXSk6IGFueVtdIHtcclxuICAgICAgICBjb25zdCByZXN1bHQgPSBbXTtcclxuICAgICAgICB2YWx1ZSA9ICcnICsgdmFsdWU7XHJcbiAgICAgICAgaWYgKGRhdGEgaW5zdGFuY2VvZiBBcnJheSkge1xyXG4gICAgICAgICAgICBkYXRhLmZvckVhY2goaXRlbSA9PiB7XHJcblxyXG4gICAgICAgICAgICAgICAgbGV0IHR4dCA9ICcnO1xyXG4gICAgICAgICAgICAgICAgbGV0IHZhbCA9ICcnO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLnRleHRGaWVsZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHR4dCA9ICcnICsgdGhpcy5nZXRUZXh0KGl0ZW0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLnZhbHVlRmllbGQpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YWwgPSAnJyArIHRoaXMuZ2V0VmFsdWUoaXRlbSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgY29uc3QgdGV4dENvbXBhcmUgPSAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHR4dC50b0xvd2VyQ2FzZSgpLmluZGV4T2YodmFsdWUudG9Mb3dlckNhc2UoKSkgIT09IC0xO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGNvbnN0IHZhbHVlQ29tcGFyZSA9ICgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdmFsLnRvTG93ZXJDYXNlKCkuaW5kZXhPZih2YWx1ZS50b0xvd2VyQ2FzZSgpKSAhPT0gLTE7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLnNlYXJjaFZhbHVlRmllbGQpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy50ZXh0RmllbGQgJiYgdGhpcy52YWx1ZUZpZWxkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0ZXh0Q29tcGFyZSgpIHx8IHZhbHVlQ29tcGFyZSgpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQucHVzaChpdGVtKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy50ZXh0RmllbGQgJiYgIXRoaXMudmFsdWVGaWVsZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGV4dENvbXBhcmUoKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goaXRlbSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCF0aGlzLnRleHRGaWVsZCAmJiB0aGlzLnZhbHVlRmllbGQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlQ29tcGFyZSgpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQucHVzaChpdGVtKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRleHRDb21wYXJlKCkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goaXRlbSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOiOt+WPluWMheWQq3ZhbHVl5YC85b6X6IqC54K5XHJcbiAgICAgKi9cclxuICAgIC8vIHByaXZhdGUgZ2V0VHJlZURhdGFCeVJlY3Vyc2l2ZSh2YWx1ZTogc3RyaW5nLCBkYXRhOiBhbnlbXSwgbmV3RGF0YTogYW55W10pIHtcclxuICAgIC8vICAgICB2YWx1ZSA9ICcnICsgdmFsdWU7XHJcblxyXG4gICAgLy8gICAgIGRhdGEuZm9yRWFjaChpdGVtID0+IHtcclxuXHJcbiAgICAvLyAgICAgICAgIGxldCB0eHQgPSAnJztcclxuICAgIC8vICAgICAgICAgbGV0IHZhbCA9ICcnO1xyXG5cclxuICAgIC8vICAgICAgICAgaWYgKHRoaXMudGV4dEZpZWxkKSB7XHJcbiAgICAvLyAgICAgICAgICAgICB0eHQgPSAnJyArIHRoaXMuZ2V0VGV4dChpdGVtLmRhdGEpO1xyXG4gICAgLy8gICAgICAgICB9XHJcblxyXG4gICAgLy8gICAgICAgICBpZiAodGhpcy52YWx1ZUZpZWxkKSB7XHJcbiAgICAvLyAgICAgICAgICAgICB2YWwgPSAnJyArIHRoaXMuZ2V0VmFsdWUoaXRlbS5kYXRhKTtcclxuICAgIC8vICAgICAgICAgfVxyXG5cclxuICAgIC8vICAgICAgICAgY29uc3QgdGV4dENvbXBhcmUgPSAoKSA9PiB7XHJcbiAgICAvLyAgICAgICAgICAgICByZXR1cm4gdHh0LnRvTG93ZXJDYXNlKCkuaW5kZXhPZih2YWx1ZS50b0xvd2VyQ2FzZSgpKSAhPT0gLTE7XHJcbiAgICAvLyAgICAgICAgIH1cclxuXHJcbiAgICAvLyAgICAgICAgIGNvbnN0IHZhbHVlQ29tcGFyZSA9ICgpID0+IHtcclxuICAgIC8vICAgICAgICAgICAgIHJldHVybiB2YWwudG9Mb3dlckNhc2UoKS5pbmRleE9mKHZhbHVlLnRvTG93ZXJDYXNlKCkpICE9PSAtMTtcclxuICAgIC8vICAgICAgICAgfVxyXG5cclxuXHJcbiAgICAvLyAgICAgICAgIGlmICh0aGlzLnRleHRGaWVsZCAmJiB0aGlzLnZhbHVlRmllbGQpIHtcclxuICAgIC8vICAgICAgICAgICAgIGlmICh0ZXh0Q29tcGFyZSgpIHx8IHZhbHVlQ29tcGFyZSgpKSB7XHJcbiAgICAvLyAgICAgICAgICAgICAgICAgbmV3RGF0YS5wdXNoKGl0ZW0pO1xyXG4gICAgLy8gICAgICAgICAgICAgfVxyXG4gICAgLy8gICAgICAgICB9IGVsc2UgaWYgKHRoaXMudGV4dEZpZWxkICYmICF0aGlzLnZhbHVlRmllbGQpIHtcclxuICAgIC8vICAgICAgICAgICAgIGlmICh0ZXh0Q29tcGFyZSgpKSB7XHJcbiAgICAvLyAgICAgICAgICAgICAgICAgbmV3RGF0YS5wdXNoKGl0ZW0pO1xyXG4gICAgLy8gICAgICAgICAgICAgfVxyXG4gICAgLy8gICAgICAgICB9IGVsc2UgaWYgKCF0aGlzLnRleHRGaWVsZCAmJiB0aGlzLnZhbHVlRmllbGQpIHtcclxuICAgIC8vICAgICAgICAgICAgIGlmICh2YWx1ZUNvbXBhcmUoKSkge1xyXG4gICAgLy8gICAgICAgICAgICAgICAgIG5ld0RhdGEucHVzaChpdGVtKTtcclxuICAgIC8vICAgICAgICAgICAgIH1cclxuICAgIC8vICAgICAgICAgfVxyXG4gICAgLy8gICAgICAgICBpZiAoaXRlbS5jaGlsZHJlbiAmJiBpdGVtLmNoaWxkcmVuLmxlbmd0aCkge1xyXG4gICAgLy8gICAgICAgICAgICAgdGhpcy5nZXRUcmVlRGF0YUJ5UmVjdXJzaXZlKHZhbHVlLCBpdGVtLmNoaWxkcmVuLCBuZXdEYXRhKTtcclxuICAgIC8vICAgICAgICAgfVxyXG4gICAgLy8gICAgIH0pO1xyXG4gICAgLy8gfVxyXG4gICAgLyoqXHJcbiAgICAgKiDojrflj5bmoLnoioLngrlcclxuICAgICAqL1xyXG4gICAgLy8gcHJpdmF0ZSBnZXRUcmVlUm9vdE5vZGUoZGF0YTogYW55W10sIHJvb3REYXRhOiBhbnlbXSkge1xyXG4gICAgLy8gICAgIGRhdGEuZm9yRWFjaChpdGVtID0+IHtcclxuICAgIC8vICAgICAgICAgaWYgKGl0ZW0ucGFyZW50ID09PSBudWxsKSB7XHJcbiAgICAvLyAgICAgICAgICAgICByb290RGF0YS5wdXNoKGl0ZW0pO1xyXG4gICAgLy8gICAgICAgICB9IGVsc2Uge1xyXG4gICAgLy8gICAgICAgICAgICAgdGhpcy5nZXRUcmVlUm9vdE5vZGUobmV3IEFycmF5KGl0ZW0ucGFyZW50KSwgcm9vdERhdGEpO1xyXG4gICAgLy8gICAgICAgICB9XHJcbiAgICAvLyAgICAgfSk7XHJcbiAgICAvLyB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDojrflj5bmkJzntKLnmoTmlbDmja7vvIxUcmVl57uT5p6EXHJcbiAgICAgKiBAcGFyYW0gdmFsdWUg5pCc57Si55qE5a2X56ymXHJcbiAgICAgKiBAcGFyYW0gZGF0YSDmlbDmja5cclxuICAgICAqL1xyXG4gICAgLy8gcHJpdmF0ZSBnZXRUcmVlRGF0YUJ5U2VhcmNoKHZhbHVlOiBzdHJpbmcsIGRhdGE6IGFueVtdKTogYW55W10ge1xyXG4gICAgLy8gICAgIGNvbnN0IHJvb3ROb2RlcyA9IFtdO1xyXG4gICAgLy8gICAgIGNvbnN0IG5vZGVzID0gW107XHJcbiAgICAvLyAgICAgY29uc3QgZmluYWxSZXMgPSBbXTtcclxuICAgIC8vICAgICBjb25zdCB1bmlxdWVJZCA9IFtdO1xyXG4gICAgLy8gICAgIC8vIOiOt+WPluWMheWQq3ZhbHVl5YC85b6X6IqC54K5XHJcbiAgICAvLyAgICAgdGhpcy5nZXRUcmVlRGF0YUJ5UmVjdXJzaXZlKHZhbHVlLCBkYXRhLCBub2Rlcyk7XHJcbiAgICAvLyAgICAgLy8g6I635Y+W5qC56IqC54K5XHJcbiAgICAvLyAgICAgdGhpcy5nZXRUcmVlUm9vdE5vZGUobm9kZXMsIHJvb3ROb2Rlcyk7XHJcbiAgICAvLyAgICAgLy8g5Y676YeNXHJcbiAgICAvLyAgICAgcm9vdE5vZGVzLmZvckVhY2gobm9kZSA9PiB7XHJcbiAgICAvLyAgICAgICAgIGlmICghdW5pcXVlSWQuc29tZShpdGVtID0+IGl0ZW0gPT0gbm9kZS5pZCkpIHtcclxuICAgIC8vICAgICAgICAgICAgIGZpbmFsUmVzLnB1c2gobm9kZSk7XHJcbiAgICAvLyAgICAgICAgICAgICB1bmlxdWVJZC5wdXNoKG5vZGUuaWQpO1xyXG4gICAgLy8gICAgICAgICB9XHJcbiAgICAvLyAgICAgfSk7XHJcbiAgICAvLyAgICAgcmV0dXJuIGZpbmFsUmVzO1xyXG4gICAgLy8gfVxyXG5cclxuICAgIHByaXZhdGUgaW5pdFJpZ2h0RGF0YShpZHMsIGNsZWFyUmlnaHQgPSB0cnVlKSB7XHJcbiAgICAgICAgbGV0IGRhdGFTb3VyY2U6IGFueSA9IFtdO1xyXG5cclxuICAgICAgICBpZiAoIWlkcyB8fCAhaWRzLmxlbmd0aCApIHtcclxuICAgICAgICAgICAgaWRzID0gdGhpcy5zZWxlY3Rpb25zLm1hcChpID0+IHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBpW3RoaXMuaWRGaWVsZF07XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIFxyXG5cclxuICAgICAgICBpZiAoaWRzICYmIGlkcy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMuaXNUcmVlKCkpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuY29udmVydFRyZWVEYXRhVG9QbGFpbkRhdGEodGhpcy5jb3B5RGF0YVNvdXJjZSwgZGF0YVNvdXJjZSk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9yaWdodERhdGEgPSB0aGlzLmdldFRyZWVTZWxlY3Rpb25zQnlJZChpZHMsIGRhdGFTb3VyY2UpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fcmlnaHREYXRhID0gdGhpcy5nZXRMaXN0U2VsZWN0aW9uc0J5SWQoaWRzLCB0aGlzLmNvcHlEYXRhU291cmNlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgXHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgaWYgKGNsZWFyUmlnaHQpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMubW92ZUFsbFRvTGVmdCgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLmNoZWNrTGVmdERhdGEoaWRzKTtcclxuICAgIH1cclxuXHJcbiAgICBjaGVja0xlZnREYXRhKGlkczogYW55KSB7XHJcbiAgICAgICAgaWYgKGlkcyAmJiBpZHMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGNoZWNrZWRzID0gey4uLnRoaXMuX2xlZnRDaGVja2Vkc307XHJcbiAgICAgICAgICAgIHRoaXMuX2xlZnRDaGVja2VkcyA9IGlkcy5yZWR1Y2UoKHIsIGlkKSA9PiB7XHJcbiAgICAgICAgICAgICAgICByW2lkXSA9IHRoaXMuX3JpZ2h0RGF0YS5maW5kKG4gPT4gblt0aGlzLmlkRmllbGRdID09IGlkKTtcclxuICAgICAgICAgICAgICAgIHJldHVybiByO1xyXG4gICAgICAgICAgICB9LCB7fSk7XHJcblxyXG4gICAgICAgICAgICBmb3IgKGxldCBrIGluIHRoaXMuX2xlZnRDaGVja2Vkcykge1xyXG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLl9sZWZ0Q2hlY2tlZHNba10pIHtcclxuICAgICAgICAgICAgICAgICAgICBkZWxldGUgdGhpcy5fbGVmdENoZWNrZWRzW2tdO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB0aGlzLl9sZWZ0Q2hlY2tlZHMgPSBPYmplY3QuYXNzaWduKHt9LCBjaGVja2VkcywgdGhpcy5fbGVmdENoZWNrZWRzKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMudXBkYXRlQWxsVHJlZU5vZGVzKGlkcyk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSB1cGRhdGVBbGxUcmVlTm9kZXMoaWRzKSB7XHJcbiAgICAgICAgaWYgKHRoaXMudXBkYXRlVGltZXIyKSB7XHJcbiAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aGlzLnVwZGF0ZVRpbWVyMik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLnVwZGF0ZVRpbWVyMiA9IHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLmNhbkNoZWNrTGVuZ3RoID0gdGhpcy5nZXRDYW5DaGVja0xlbmd0aCgpO1xyXG4gICAgICAgICAgICBpZiAodGhpcy50dCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKGlkcyAmJiBpZHMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy50dC5jaGVja2VkTm9kZXMoaWRzLCB0cnVlLCBmYWxzZSwgdHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB0aGlzLmFsbFRyZWVOb2RlcyA9IGNsb25lRGVlcCh0aGlzLnR0LnN0YXRlLnJvd05vZGVzLm1hcChuID0+IG4ubm9kZSkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBAcGFyYW0gaWRzIOmAieS4reaVsOaNrueahGlkXHJcbiAgICAgKiBAcGFyYW0gZGF0YVNvdXJjZSDljp/lp4vmlbDmja5cclxuICAgICAqL1xyXG4gICAgcHJpdmF0ZSBnZXRMaXN0U2VsZWN0aW9uc0J5SWQoaWRzOiBhbnksIGRhdGFTb3VyY2U6IGFueSkge1xyXG4gICAgICAgIGxldCByZXN1bHQgPSBbXTtcclxuICAgICAgICBjb25zdCBfdGhpcyA9IHRoaXM7XHJcbiAgICAgICAgaWYgKCh0eXBlb2YgaWRzID09PSAnc3RyaW5nJyAmJiAhIWlkcykgfHwgdHlwZW9mIGlkcyA9PT0gJ251bWJlcicpIHtcclxuICAgICAgICAgICAgY29uc3QgcmV1c2x0T2JqID0gZGF0YVNvdXJjZS5maW5kKGl0ZW0gPT4ge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGl0ZW1bX3RoaXMuaWRGaWVsZF0gPT09IGlkcztcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIGlmIChyZXVzbHRPYmopIHtcclxuICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKHJldXNsdE9iaik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkoaWRzKSkge1xyXG4gICAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShkYXRhU291cmNlKSkge1xyXG4gICAgICAgICAgICAgICAgcmVzdWx0ID0gaWRzLm1hcChpZCA9PiBkYXRhU291cmNlLmZpbmQoaXRlbSA9PiBpdGVtW3RoaXMuaWRGaWVsZF0gPT09IGlkKSkuZmlsdGVyKG4gPT4gbik7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICByZXN1bHQgPSBbXTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJlc3VsdCA9IFtdO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBpZHMg6YCJ5Lit5pWw5o2u55qEaWRcclxuICAgICAqIEBwYXJhbSBkYXRhU291cmNlIOWOn+Wni+aVsOaNrlxyXG4gICAgICovXHJcbiAgICBwcml2YXRlIGdldFRyZWVTZWxlY3Rpb25zQnlJZChpZHM6IGFueSwgZGF0YVNvdXJjZTogYW55KSB7XHJcbiAgICAgICAgbGV0IHJlc3VsdCA9IFtdO1xyXG4gICAgICAgIGNvbnN0IF90aGlzID0gdGhpcztcclxuICAgICAgICBpZiAoKHR5cGVvZiBpZHMgPT09ICdzdHJpbmcnICYmICEhaWRzKSB8fCB0eXBlb2YgaWRzID09PSAnbnVtYmVyJykge1xyXG4gICAgICAgICAgICBjb25zdCByZXVzbHRPYmogPSBkYXRhU291cmNlLmZpbmQoaXRlbSA9PiB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gaXRlbS5kYXRhW190aGlzLmlkRmllbGRdID09PSBpZHM7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBpZiAocmV1c2x0T2JqICYmIHJldXNsdE9iai5kYXRhKSB7XHJcbiAgICAgICAgICAgICAgICByZXN1bHQucHVzaChyZXVzbHRPYmouZGF0YSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkoaWRzKSkge1xyXG4gICAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShkYXRhU291cmNlKSkge1xyXG4gICAgICAgICAgICAgICAgcmVzdWx0ID0gaWRzLm1hcChpZCA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRhdGFTb3VyY2UuZmluZChpdGVtID0+IGl0ZW0uZGF0YVt0aGlzLmlkRmllbGRdID09PSBpZCk7XHJcbiAgICAgICAgICAgICAgICB9KS5maWx0ZXIobiA9PiBuKS5tYXAobiA9PiBuLmRhdGEpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgcmVzdWx0ID0gW107XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICByZXN1bHQgPSBbXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICog5Yik5pat5piv5ZCm6YCJ5LitXHJcbiAgICAgKiBAcGFyYW0gZGF0YSDopoHpqozor4HnmoTmlbDmja5cclxuICAgICAqIEBwYXJhbSBkaXJlY3Rpb24g6aqM6K+B55qE5pWw5o2u5omA5Zyo55qE5L2N572uIEw6IOW3puS+p++8jFI6IOWPs+S+p1xyXG4gICAgICovXHJcbiAgICBpc0NoZWNrZWQoZGF0YTogYW55LCBkaXJlY3Rpb246ICdMJyB8ICdSJyk6IGJvb2xlYW4ge1xyXG4gICAgICAgIGNvbnN0IGtleVZhbCA9IGRhdGFbdGhpcy5pZEZpZWxkXTtcclxuICAgICAgICBpZiAoZGlyZWN0aW9uID09PSAnTCcpIHtcclxuICAgICAgICAgICAgcmV0dXJuICh0aGlzLl9sZWZ0Q2hlY2tlZHMgJiYgdGhpcy5fbGVmdENoZWNrZWRzW2tleVZhbF0gIT09IHVuZGVmaW5lZCk7IC8vIHx8ICF0aGlzLmNhbkNoZWNrZWQoZGF0YSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMuX3JpZ2h0Q2hlY2tlZHMpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9yaWdodENoZWNrZWRzW2tleVZhbF0gIT09IHVuZGVmaW5lZDtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBjYW5DaGVja2VkKGl0ZW06IGFueSkge1xyXG4gICAgICAgIGxldCBkYXRhID0gaXRlbTtcclxuXHJcbiAgICAgICAgaWYgKHRoaXMuaXNUcmVlKCkpIHtcclxuICAgICAgICAgICAgZGF0YSA9IGl0ZW0uZGF0YTtcclxuXHJcbiAgICAgICAgICAgIGlmIChpdGVtLnNlbGVjdGFibGUgIT09IHVuZGVmaW5lZCAmJiAhaXRlbS5zZWxlY3RhYmxlKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICghdGhpcy5zZWxlY3Rpb25zIHx8IHRoaXMuc2VsZWN0aW9ucy5sZW5ndGggPT09IDApIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB0aGlzLnNlbGVjdGlvbnMuZmluZEluZGV4KGMgPT4gYyAmJiBjW3RoaXMuaWRGaWVsZF0gPT09IGRhdGFbdGhpcy5pZEZpZWxkXSkgPT09IC0xO1xyXG4gICAgfVxyXG5cclxuICAgIG9uQ2hlY2tWYWx1ZUNoYW5nZShpZHM6IHN0cmluZ1tdKSB7XHJcbiAgICAgICAgXHJcbiAgICB9XHJcblxyXG4gICAgaXNUcmVlKCk6IGFueSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZGlzcGxheVR5cGUgPT09ICdUcmVlJztcclxuICAgIH1cclxuXHJcbiAgICBsZWZ0RGF0YUNoZWNrZWQoZGF0YTogYW55W10pIHtcclxuICAgICAgICBpZiAoZGF0YSAmJiBkYXRhLmxlbmd0aCkge1xyXG4gICAgICAgICAgICBkYXRhLmZvckVhY2gobm9kZSA9PiB7XHJcbiAgICAgICAgICAgICAgICBsZXQgZCA9IG5vZGU7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5pc1RyZWUoKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGQgPSBub2RlLmRhdGE7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5jYW5DaGVja2VkKG5vZGUpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuaXNDaGVja2VkKGQsICdMJykpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIHRoaXMuX2xlZnRDaGVja2Vkc1tkW3RoaXMuaWRGaWVsZF1dO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5fbGVmdENoZWNrZWRzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9sZWZ0Q2hlY2tlZHMgPSB7fTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9sZWZ0Q2hlY2tlZHNbZFt0aGlzLmlkRmllbGRdXSA9IGQ7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgaGFzQ2hlY2tlZHMoZGlyOiAnTCcgfCAnUicpIHtcclxuICAgICAgICBpZiAoZGlyID09PSAnTCcpIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMuaXNUcmVlKCkpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnR0LmNoZWNrZWRzICYmIHRoaXMudHQuY2hlY2tlZHMubGVuZ3RoIHx8ICggdGhpcy50dC5zZWxlY3Rpb25zICYmIHRoaXMudHQuc2VsZWN0aW9ucy5sZW5ndGgpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAodGhpcy5fbGVmdENoZWNrZWRzKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gT2JqZWN0LmtleXModGhpcy5fbGVmdENoZWNrZWRzKS5sZW5ndGggPiAwO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMuX3JpZ2h0Q2hlY2tlZHMpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBPYmplY3Qua2V5cyh0aGlzLl9yaWdodENoZWNrZWRzKS5sZW5ndGggPiAwO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHJpZ2h0RGF0YUNoZWNrZWQoaXRlbSwgZW1pdCA9IHRydWUpIHtcclxuICAgICAgICBjb25zdCBpc0NoZWNrID0gdGhpcy5pc0NoZWNrZWQoaXRlbSwgJ1InKTtcclxuICAgICAgICBpZiAoaXNDaGVjaykge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5zaG93Q2hlY2tib3gpIHtcclxuICAgICAgICAgICAgICAgIGRlbGV0ZSB0aGlzLl9yaWdodENoZWNrZWRzW2l0ZW1bdGhpcy5pZEZpZWxkXV07XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9yaWdodENoZWNrZWRzID0ge307XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5yaWdodFNlbGVjdGVkSXRlbSA9IG51bGw7XHJcbiAgICAgICAgICAgIHRoaXMudW5TZWxlY3RlZC5lbWl0KHtkYXRhOml0ZW19KTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLnNob3dDaGVja2JveCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fcmlnaHRDaGVja2VkcyA9IHRoaXMuX3JpZ2h0Q2hlY2tlZHMgfHwge307XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9yaWdodENoZWNrZWRzID0ge307XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5yaWdodFNlbGVjdGVkSXRlbSA9IGl0ZW07XHJcbiAgICAgICAgICAgIHRoaXMuX3JpZ2h0Q2hlY2tlZHNbaXRlbVt0aGlzLmlkRmllbGRdXSA9IGl0ZW07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuY2QuZGV0ZWN0Q2hhbmdlcygpO1xyXG4gICAgICAgIHRoaXMuc2VsZWN0ZWQuZW1pdCh7IHNlbGVjdGVkOiAhaXNDaGVjaywgZGF0YTogaXRlbSB9KTtcclxuICAgIH1cclxuXHJcbiAgICBzZWxlY3RJdGVtKGlkLCBlbWl0ID0gdHJ1ZSkge1xyXG4gICAgICAgIGlmICh0aGlzLnNlbGVjdGlvbnMgJiYgdGhpcy5zZWxlY3Rpb25zLmxlbmd0aCkge1xyXG4gICAgICAgICAgICBjb25zdCBpdGVtID0gdGhpcy5zZWxlY3Rpb25zLmZpbmQobiA9PiBuW3RoaXMuaWRGaWVsZF0gPT09IGlkKTtcclxuICAgICAgICAgICAgaWYgKGl0ZW0pIHtcclxuICAgICAgICAgICAgICAgIHRoaXMucmlnaHREYXRhQ2hlY2tlZChpdGVtLCBlbWl0KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBjbGVhclNlbGVjdGlvbnMoZW1pdCA9IGZhbHNlKSB7XHJcbiAgICAgICAgdGhpcy5fcmlnaHRDaGVja2VkcyA9IHt9O1xyXG4gICAgICAgIHRoaXMuX2xlZnRDaGVja2VkcyA9IHt9O1xyXG4gICAgICAgIHRoaXMuX3JpZ2h0RGF0YSA9IFtdO1xyXG4gICAgICAgIHRoaXMuc2VsZWN0ZWRJZCA9IFtdO1xyXG4gICAgICAgIGlmICh0aGlzLmlzVHJlZSgpICYmIHRoaXMudHQpIHtcclxuICAgICAgICAgICAgY29uc3QgX2Noa2lkcyA9IHRoaXMudHQuY2hlY2tlZHMubWFwKG4gPT4gbi5pZCk7XHJcbiAgICAgICAgICAgIHRoaXMudHQuY2xlYXJBbGwoKTtcclxuICAgICAgICAgICAgdGhpcy50dC5zdGF0ZS5yb3dOb2Rlcy5mb3JFYWNoKG4gPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKF9jaGtpZHMuZmluZChpID0+IGkgPT0gbi5pZCkpIHtcclxuICAgICAgICAgICAgICAgICAgICBuLm5vZGUuc2VsZWN0YWJsZSA9ICB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChlbWl0KSB7XHJcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRJZENoYW5nZS5lbWl0KFtdKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDlsIbmoJHnu5PmnoTmlbDmja7ovazmjaLkuLrmiYHlubPmlbDnu4RcclxuICAgICAqIEBwYXJhbSBub2RlcyDmoJHoioLngrnmlbDnu4RcclxuICAgICAqIEBwYXJhbSByIOaWsOeahOepuuaVsOe7hFxyXG4gICAgICovXHJcbiAgICBwcml2YXRlIGNvbnZlcnRUcmVlRGF0YVRvUGxhaW5EYXRhKG5vZGVzOiBUcmVlTm9kZVtdLCByOiBhbnlbXSA9IFtdKSB7XHJcbiAgICAgICAgaWYgKG5vZGVzKSB7XHJcbiAgICAgICAgICAgIG5vZGVzLmZvckVhY2gobiA9PiB7XHJcbiAgICAgICAgICAgICAgICByLnB1c2gobik7XHJcbiAgICAgICAgICAgICAgICBpZiAobi5jaGlsZHJlbikge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY29udmVydFRyZWVEYXRhVG9QbGFpbkRhdGEobi5jaGlsZHJlbiwgcik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHI7XHJcbiAgICB9XHJcblxyXG4gICAgLy8jcmVnaW9uIOW3puWPs+enu+WKqFxyXG5cclxuICAgIHByaXZhdGUgbW92ZUl0ZW0oKSB7XHJcbiAgICAgICAgdGhpcy5iZWZvcmVNb3ZlLnN1YnNjcmliZSgob2JqOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgaXRlbXMgPSBvYmouaXRlbXM7XHJcbiAgICAgICAgICAgIGxldCBkaXJlY3Rpb24gPSAxO1xyXG4gICAgICAgICAgICBzd2l0Y2ggKG9iai50YXJnZXQpIHtcclxuICAgICAgICAgICAgICAgIGNhc2UgJ3JpZ2h0JzpcclxuICAgICAgICAgICAgICAgICAgICBPYmplY3Qua2V5cyhpdGVtcykuZm9yRWFjaChpZCA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5fcmlnaHREYXRhLmZpbmQobiA9PiBuW3RoaXMuaWRGaWVsZF0udG9TdHJpbmcoKSA9PT0gaWQpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9yaWdodERhdGEucHVzaChpdGVtc1tpZF0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fcmlnaHREYXRhID0gWy4uLnRoaXMuX3JpZ2h0RGF0YV07XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuaXNUcmVlKCkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy50dC5jbGVhckFsbCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBkaXJlY3Rpb24gPSAxO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgY2FzZSAncmlnaHRBbGwnOlxyXG4gICAgICAgICAgICAgICAgICAgIGl0ZW1zLmZvckVhY2goZGF0YSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLl9yaWdodERhdGEuZmluZEluZGV4KG4gPT4gblt0aGlzLmlkRmllbGRdID09PSBkYXRhW3RoaXMuaWRGaWVsZF0pID09PSAtMSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fcmlnaHREYXRhLnB1c2goZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5pc1RyZWUoKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnR0LmNsZWFyQWxsKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICBkaXJlY3Rpb24gPSAxO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgY2FzZSAnbGVmdCc6XHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IGlkcyA9IE9iamVjdC5rZXlzKGl0ZW1zKTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9yaWdodERhdGEgPSB0aGlzLl9yaWdodERhdGEuZmlsdGVyKHYgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gaWRzLmluZGV4T2YoJycgKyB2W3RoaXMuaWRGaWVsZF0pID09PSAtMTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9yaWdodENoZWNrZWRzID0ge307XHJcbiAgICAgICAgICAgICAgICAgICAgaWRzLmZvckVhY2goaWQgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkZWxldGUgdGhpcy5fbGVmdENoZWNrZWRzW2lkXTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMucmlnaHRTZWxlY3RlZEl0ZW0pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlkcy5pbmRleE9mKCcnICsgdGhpcy5yaWdodFNlbGVjdGVkSXRlbVt0aGlzLmlkRmllbGRdKSA+IC0xKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJpZ2h0U2VsZWN0ZWRJdGVtID0gbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgZGlyZWN0aW9uID0gLTE7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmlzVHJlZSgpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudHQuZmluZFJvd05vZGVzKGlkcykuZm9yRWFjaChuID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG4ubm9kZS5zZWxlY3RhYmxlID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudHQudW5DaGVja2VkTm9kZXMoaWRzLCB0cnVlKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgY2FzZSAnbGVmdEFsbCc6XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fcmlnaHRDaGVja2VkcyA9IHt9O1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMucmlnaHRTZWxlY3RlZEl0ZW0gPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3JpZ2h0RGF0YSA9IFtdO1xyXG4gICAgICAgICAgICAgICAgICAgIGRpcmVjdGlvbiA9IC0xO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2xlZnRDaGVja2VkcyA9IHt9O1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmlzVHJlZSgpICYmIHRoaXMudHQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy50dC5jbGVhckFsbCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBfaWRzID0gaXRlbXMubWFwKG4gPT4gblt0aGlzLmlkRmllbGRdKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy50dC5maW5kUm93Tm9kZXMoX2lkcykuZm9yRWFjaChuID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG4ubm9kZS5zZWxlY3RhYmxlID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB0aGlzLnNlbGVjdGlvbnNDaGFuZ2UoKTtcclxuICAgICAgICAgICAgdGhpcy5jaGFuZ2VTZWxlY3RJZHMoZGlyZWN0aW9uKTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuYWZ0ZXJNb3ZlLmVtaXQoT2JqZWN0LnZhbHVlcyhpdGVtcykpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICAvKiog5Y+z56e7ICovXHJcbiAgICBtb3ZlVG9SaWdodChtb3ZlRGF0YT86IGFueSkge1xyXG5cclxuICAgICAgICBpZiAobW92ZURhdGEpIHtcclxuICAgICAgICAgICAgdGhpcy5iZWZvcmVNb3ZlLmVtaXQoeyBpdGVtczogeyBbbW92ZURhdGFbdGhpcy5pZEZpZWxkXV06IG1vdmVEYXRhIH0sIHRhcmdldDogJ3JpZ2h0JyB9KTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5oYXNDaGVja2VkcygnTCcpKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5pc1RyZWUoKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2xlZnRDaGVja2VkcyA9IHt9O1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMudHQuY2hlY2tlZHMuZmlsdGVyKG4gPT4gdGhpcy5fcmlnaHREYXRhLmZpbmRJbmRleChyID0+IHIuaWQgPT09IG4uaWQpID09PSAtMSApLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm1lc2FnZXJTZXIud2FybmluZyh0aGlzLm5vRGF0YU1vdmVNZXNzYWdlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOyAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnR0LmNoZWNrZWRzLmZvckVhY2gobiA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2xlZnRDaGVja2Vkc1tuLmRhdGFbdGhpcy5pZEZpZWxkXV0gPSBuLmRhdGE7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMudHQuc2VsZWN0aW9ucy5mb3JFYWNoKG4gPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9sZWZ0Q2hlY2tlZHNbbi5pZF0gPSBuLmRhdGE7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBuZXdDaGVja2VkcyA9IE9iamVjdC5rZXlzKHRoaXMuX2xlZnRDaGVja2VkcykuZmlsdGVyKGlkID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3JpZ2h0RGF0YS5maW5kSW5kZXgobiA9PiBuLmlkID09PSBpZCkgPT09IC0xXHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFuZXdDaGVja2Vkcy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5tZXNhZ2VyU2VyLndhcm5pbmcodGhpcy5ub0RhdGFNb3ZlTWVzc2FnZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgdGhpcy5iZWZvcmVNb3ZlLmVtaXQoeyBpdGVtczogdGhpcy5fbGVmdENoZWNrZWRzLCB0YXJnZXQ6ICdyaWdodCcgfSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLm1lc2FnZXJTZXIud2FybmluZyh0aGlzLm5vRGF0YU1vdmVNZXNzYWdlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvKiog5YWo6YOo5Y+z56e7ICovXHJcbiAgICBtb3ZlQWxsVG9SaWdodCgpIHtcclxuICAgICAgICBpZiAodGhpcy5zZWFyY2hWYWx1ZSA9PT0gJycpIHtcclxuICAgICAgICAgICAgdGhpcy5fcmlnaHREYXRhID0gW107XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0aGlzLmRpc3BsYXlUeXBlID09PSAnTGlzdCcpIHtcclxuICAgICAgICAgICAgY29uc3QgaXRlbXMgPSB0aGlzLmRhdGFTb3VyY2U7XHJcbiAgICAgICAgICAgIC8vIGlmICh0aGlzLnNlYXJjaFZhbHVlICYmIHRoaXMuX2xlZnRDaGVja2Vkcykge1xyXG4gICAgICAgICAgICAvLyAgICAgY29uc3QgY2hlY2tpZHMgPSBPYmplY3Qua2V5cyh0aGlzLl9sZWZ0Q2hlY2tlZHMpO1xyXG4gICAgICAgICAgICAvLyAgICAgaWYgKGNoZWNraWRzLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAvLyAgICAgICAgIGNoZWNraWRzLmZvckVhY2goaWQgPT4ge1xyXG4gICAgICAgICAgICAvLyAgICAgICAgICAgICBpZiAoIWl0ZW1zLmZpbmQobiA9PiBuW3RoaXMuaWRGaWVsZF0gPT09IGlkKSkge1xyXG4gICAgICAgICAgICAvLyAgICAgICAgICAgICAgICAgaXRlbXMucHVzaCh0aGlzLl9sZWZ0Q2hlY2tlZHNbaWRdKTtcclxuICAgICAgICAgICAgLy8gICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvLyAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAvLyAgICAgfVxyXG4gICAgICAgICAgICAvLyB9XHJcbiAgICAgICAgICAgIHRoaXMuYmVmb3JlTW92ZS5lbWl0KHsgaXRlbXMgLCB0YXJnZXQ6ICdyaWdodEFsbCcgfSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgaWYgKCF0aGlzLnNlYXJjaFZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICBsZXQgX2RhdGFTb3VyY2UgPSBbXTtcclxuICAgICAgICAgICAgICAgIHRoaXMuY29udmVydFRyZWVEYXRhVG9QbGFpbkRhdGEodGhpcy5kYXRhU291cmNlLCBfZGF0YVNvdXJjZSk7XHJcbiAgICAgICAgICAgICAgICBfZGF0YVNvdXJjZSA9IF9kYXRhU291cmNlLmZpbHRlcihuID0+IG4uc2VsZWN0YWJsZSAmJiAobi52aXNpYmxlIHx8IG4udmlzaWJsZSA9PT0gdW5kZWZpbmVkKSkubWFwKG4gPT4gbi5kYXRhKTtcclxuXHJcbiAgICAgICAgICAgICAgICB0aGlzLmJlZm9yZU1vdmUuZW1pdCh7IGl0ZW1zOiBfZGF0YVNvdXJjZSwgdGFyZ2V0OiAncmlnaHRBbGwnIH0pO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgX2RhdGFTb3VyY2UgPSB0aGlzLnR0LnNlcmlhbGl6ZWRWYWx1ZS5tYXAobiA9PiBuLm5vZGUuZGF0YSk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmJlZm9yZU1vdmUuZW1pdCh7IGl0ZW1zOiBfZGF0YVNvdXJjZSwgdGFyZ2V0OiAncmlnaHRBbGwnIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgIH1cclxuXHJcbiAgICAvKiog5bem56e7ICovXHJcbiAgICBtb3ZlVG9MZWZ0KG1vdmVEYXRhPzogYW55KSB7XHJcblxyXG4gICAgICAgIGlmIChtb3ZlRGF0YSkge1xyXG4gICAgICAgICAgICB0aGlzLmJlZm9yZU1vdmUuZW1pdCh7IGl0ZW1zOiB7IFttb3ZlRGF0YVt0aGlzLmlkRmllbGRdXTogbW92ZURhdGEgfSwgdGFyZ2V0OiAnbGVmdCcgfSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMuaGFzQ2hlY2tlZHMoJ1InKSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5iZWZvcmVNb3ZlLmVtaXQoeyBpdGVtczogdGhpcy5fcmlnaHRDaGVja2VkcywgdGFyZ2V0OiAnbGVmdCcgfSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLm1lc2FnZXJTZXIud2FybmluZyh0aGlzLm5vRGF0YU1vdmVNZXNzYWdlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvKiog5YWo6YOo5bem56e7ICovXHJcbiAgICBtb3ZlQWxsVG9MZWZ0KCkge1xyXG4gICAgICAgIHRoaXMuYmVmb3JlTW92ZS5lbWl0KHsgaXRlbXM6IHRoaXMuX3JpZ2h0RGF0YSwgdGFyZ2V0OiAnbGVmdEFsbCcgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8jZW5kcmVnaW9uXHJcblxyXG4gICAgLy8jcmVnaW9uIOS4iuS4i+enu+WKqOaYvuekuuWIl+mhuuW6j1xyXG5cclxuICAgIF9nZXRTZWxlY3RJbmZvKCkge1xyXG4gICAgICAgIGlmICh0aGlzLnJpZ2h0U2VsZWN0ZWRJdGVtKSB7XHJcbiAgICAgICAgICAgIC8vIGNvbnN0IGtleSA9IE9iamVjdC5rZXlzKHRoaXMuX3JpZ2h0Q2hlY2tlZHMpWzBdO1xyXG4gICAgICAgICAgICBjb25zdCBrZXkgPSB0aGlzLnJpZ2h0U2VsZWN0ZWRJdGVtW3RoaXMuaWRGaWVsZF07XHJcbiAgICAgICAgICAgIGNvbnN0IGluZGV4ID0gdGhpcy5fcmlnaHREYXRhLmZpbmRJbmRleChjID0+ICcnICsgY1t0aGlzLmlkRmllbGRdID09ICBrZXkpO1xyXG4gICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAga2V5LCBpbmRleFxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9XHJcbiAgICAvKiog572u6aG2ICovXHJcbiAgICBtb3ZlVG9wKCkge1xyXG4gICAgICAgIGlmICh0aGlzLmVuYWJsZU1vdmVNb3JlICYmIHRoaXMuX3JpZ2h0Q2hlY2tlZHMgJiYgT2JqZWN0LmtleXModGhpcy5fcmlnaHRDaGVja2VkcykubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIHRoaXMubW92ZU1vcmUoJ3RvcCcpO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IG9iaiA9IHRoaXMuX2dldFNlbGVjdEluZm8oKTtcclxuICAgICAgICBpZiAob2JqKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX3JpZ2h0RGF0YS51bnNoaWZ0KHRoaXMuX3JpZ2h0RGF0YVtvYmouaW5kZXhdKTtcclxuICAgICAgICAgICAgdGhpcy5fcmlnaHREYXRhLnNwbGljZShvYmouaW5kZXggKyAxLCAxKTtcclxuICAgICAgICAgICAgdGhpcy5zZWxlY3Rpb25zQ2hhbmdlKCk7XHJcbiAgICAgICAgICAgIHRoaXMuY2hhbmdlU2VsZWN0SWRzKDApO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMubWVzYWdlclNlci53YXJuaW5nKHRoaXMubm9EYXRhTW92ZU1lc3NhZ2UpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvKiog5LiK56e7ICovXHJcbiAgICBtb3ZlVXAoKSB7XHJcblxyXG5cclxuICAgICAgICBpZiAodGhpcy5lbmFibGVNb3ZlTW9yZSAmJiB0aGlzLl9yaWdodENoZWNrZWRzICYmIE9iamVjdC5rZXlzKHRoaXMuX3JpZ2h0Q2hlY2tlZHMpLmxlbmd0aCkge1xyXG4gICAgICAgICAgICB0aGlzLm1vdmVNb3JlMigndXAnKTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3Qgb2JqID0gdGhpcy5fZ2V0U2VsZWN0SW5mbygpO1xyXG4gICAgICAgIGlmIChvYmopIHtcclxuICAgICAgICAgICAgY29uc3QgaW5kZXggPSBvYmouaW5kZXg7XHJcbiAgICAgICAgICAgIGlmIChpbmRleCAhPT0gMCkge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgdGVtcEFyciA9IHRoaXMuX3JpZ2h0RGF0YS5zcGxpY2UoaW5kZXgsIDEpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fcmlnaHREYXRhLnNwbGljZShpbmRleCAtIDEsIDAsIC4uLnRlbXBBcnIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0aW9uc0NoYW5nZSgpO1xyXG4gICAgICAgICAgICB0aGlzLmNoYW5nZVNlbGVjdElkcygwKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLm1lc2FnZXJTZXIud2FybmluZyh0aGlzLm5vRGF0YU1vdmVNZXNzYWdlKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLyoqIOS4i+enuyAqL1xyXG4gICAgbW92ZURvd24oKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuZW5hYmxlTW92ZU1vcmUgJiYgdGhpcy5fcmlnaHRDaGVja2VkcyAmJiBPYmplY3Qua2V5cyh0aGlzLl9yaWdodENoZWNrZWRzKS5sZW5ndGgpIHtcclxuICAgICAgICAgICAgdGhpcy5tb3ZlTW9yZTIoJ2Rvd24nKTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3Qgb2JqID0gdGhpcy5fZ2V0U2VsZWN0SW5mbygpO1xyXG4gICAgICAgIGlmIChvYmopIHtcclxuICAgICAgICAgICAgY29uc3QgbGVuID0gdGhpcy5fcmlnaHREYXRhLmxlbmd0aDtcclxuICAgICAgICAgICAgY29uc3QgaW5kZXggPSBvYmouaW5kZXg7XHJcbiAgICAgICAgICAgIGlmIChpbmRleCA9PT0gMCB8fCBpbmRleCAhPT0gbGVuIC0gMSkge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgdGVtcEFyciA9IHRoaXMuX3JpZ2h0RGF0YS5zcGxpY2UoaW5kZXgsIDEpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fcmlnaHREYXRhLnNwbGljZShpbmRleCArIDEsIDAsIC4uLnRlbXBBcnIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0aW9uc0NoYW5nZSgpO1xyXG4gICAgICAgICAgICB0aGlzLmNoYW5nZVNlbGVjdElkcygwKTtcclxuXHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5tZXNhZ2VyU2VyLndhcm5pbmcodGhpcy5ub0RhdGFNb3ZlTWVzc2FnZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8qKiDnva7lupUgKi9cclxuICAgIG1vdmVCb3R0b20oKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuZW5hYmxlTW92ZU1vcmUgJiYgdGhpcy5fcmlnaHRDaGVja2VkcyAmJiBPYmplY3Qua2V5cyh0aGlzLl9yaWdodENoZWNrZWRzKS5sZW5ndGgpIHtcclxuICAgICAgICAgICAgdGhpcy5tb3ZlTW9yZSgnYm90dG9tJyk7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc3Qgb2JqID0gdGhpcy5fZ2V0U2VsZWN0SW5mbygpO1xyXG4gICAgICAgIGlmIChvYmopIHtcclxuICAgICAgICAgICAgdGhpcy5fcmlnaHREYXRhLnB1c2godGhpcy5fcmlnaHREYXRhW29iai5pbmRleF0pO1xyXG4gICAgICAgICAgICB0aGlzLl9yaWdodERhdGEuc3BsaWNlKG9iai5pbmRleCwgMSk7XHJcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0aW9uc0NoYW5nZSgpO1xyXG4gICAgICAgICAgICB0aGlzLmNoYW5nZVNlbGVjdElkcygwKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLm1lc2FnZXJTZXIud2FybmluZyh0aGlzLm5vRGF0YU1vdmVNZXNzYWdlKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIOinpuWPkemAieaLqeS4rWlkXHJcbiAgICAgKiBAcGFyYW0gbnVtYmVyIDHku6Pooajlt6bkvqfmlbDmja7lj7Pnp7vvvIwtMSzku6PooajmlbDmja7lt6bnp7vvvIww5Luj6KGo5LiK56e75LiL56e7XHJcbiAgICAgKi9cclxuICAgIHByaXZhdGUgY2hhbmdlU2VsZWN0SWRzKG51bWJlcjogbnVtYmVyKSB7XHJcbiAgICAgICAgY29uc3QgaWRzID0gdGhpcy5fcmlnaHREYXRhLm1hcChpdGVtID0+IHtcclxuICAgICAgICAgICAgcmV0dXJuIGl0ZW1bdGhpcy5pZEZpZWxkXTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaWYgKG51bWJlciA9PT0gMCkge1xyXG4gICAgICAgICAgICBpZiAodHlwZW9mIHRoaXMuc2VsZWN0ZWRJZCA9PT0gJ3N0cmluZycpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRJZCA9IGlkcy5qb2luKCcsJyk7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheSh0aGlzLnNlbGVjdGVkSWQpKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGVkSWQgPSBpZHM7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5zZWxlY3RlZElkQ2hhbmdlLmVtaXQodGhpcy5zZWxlY3RlZElkKTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IHJpZ2h0QWN0aXZlRG9tID0gdGhpcy5lbC5uYXRpdmVFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5mLW11bHRpLXNlbGVjdC1saXN0LWdyb3VwLS1yaWdodCBsaS5hY3RpdmUnKTtcclxuICAgICAgICAgICAgaWYgKHJpZ2h0QWN0aXZlRG9tKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAocmlnaHRBY3RpdmVEb20uc2Nyb2xsSW50b1ZpZXdJZk5lZWRlZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJpZ2h0QWN0aXZlRG9tLnNjcm9sbEludG9WaWV3SWZOZWVkZWQoKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmlnaHRBY3RpdmVEb20uc2Nyb2xsSW50b1ZpZXcoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoIXRoaXMuc2VsZWN0ZWRJZCkge1xyXG4gICAgICAgICAgICB0aGlzLnNlbGVjdGVkSWQgPSBbXTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChudW1iZXIgPT09IDEgfHwgbnVtYmVyID09PSAtMSkge1xyXG4gICAgICAgICAgICBpZiAoIWlkcy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRJZCA9IFtdO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZElkID0gaWRzO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAodGhpcy5pc1RyZWUoKSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKGlkcyAmJiBpZHMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy50dC5jaGVja2VkTm9kZXMoaWRzLCB0cnVlLCBmYWxzZSwgdHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5jYW5DaGVja0xlbmd0aCA9IHRoaXMuZ2V0Q2FuQ2hlY2tMZW5ndGgoKTtcclxuICAgICAgICB0aGlzLnNlbGVjdGVkSWRDaGFuZ2UuZW1pdCh0aGlzLnNlbGVjdGVkSWQpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vI2VuZHJlZ2lvblxyXG5cclxuICAgIHByaXZhdGUgc2VsZWN0aW9uc0NoYW5nZSgpIHtcclxuICAgICAgICB0aGlzLmRhdGFDaGFuZ2UuZW1pdCh0aGlzLl9yaWdodERhdGEpO1xyXG4gICAgICAgIHRoaXMuY2QuZGV0ZWN0Q2hhbmdlcygpO1xyXG4gICAgfVxyXG5cclxuICAgIGdldFRleHQoaXRlbSwgdGV4dEZpZWxkID0gdGhpcy50ZXh0RmllbGQpIHtcclxuICAgICAgICBpZiAoaXRlbSkge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5jb21tb25VdGlscyAmJiB0aGlzLmNvbW1vblV0aWxzLmdldFZhbHVlICYmIHRleHRGaWVsZCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuY29tbW9uVXRpbHMuZ2V0VmFsdWUodGV4dEZpZWxkLCBpdGVtKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBpdGVtW3RleHRGaWVsZF07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICByZXR1cm4gJyc7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGdldFZhbHVlKGl0ZW0sIHZhbHVlRmllbGQgPSB0aGlzLnZhbHVlRmllbGQpIHtcclxuICAgICAgICBpZiAoaXRlbSkge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5jb21tb25VdGlscyAmJiB0aGlzLmNvbW1vblV0aWxzLmdldFZhbHVlICYmIHZhbHVlRmllbGQpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmNvbW1vblV0aWxzLmdldFZhbHVlKHZhbHVlRmllbGQsIGl0ZW0pO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGl0ZW1bdmFsdWVGaWVsZF07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICByZXR1cm4gJyc7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHRyYWNrQnlJdGVtcyA9IChpbmRleCwgaXRlbSkgPT4ge1xyXG4gICAgICAgIHJldHVybiBpbmRleDtcclxuICAgIH1cclxuXHJcblxyXG4gICAgLy8jcmVnaW9uICDlj7PkvqflkIzml7bnp7vliqjlpJrmnaHorrDlvZVcclxuXHJcbiAgICAvKiog5LuO5Y+z5L6n5pWw5o2u5rqQ5Lit6I635Y+W6YCJ5Lit55qE6K6w5b2VICovXHJcbiAgICBwcml2YXRlIGdldENoZWNrZWRJdGVtc0Zyb21EYXRhU291cmNlKCkge1xyXG4gICAgICAgIGlmICh0aGlzLl9yaWdodERhdGEgJiYgdGhpcy5fcmlnaHREYXRhLmxlbmd0aCkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fcmlnaHREYXRhLmZpbHRlcihuID0+IHRoaXMuX3JpZ2h0Q2hlY2tlZHNbblt0aGlzLmlkRmllbGRdXSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBbXTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGdldENoZWNrZWRGaXJzdEluZGV4QW5kTGFzdEluZGV4KCkge1xyXG4gICAgICAgIGNvbnN0IF9jaGtJdGVtcyA9IHRoaXMuZ2V0Q2hlY2tlZEl0ZW1zRnJvbURhdGFTb3VyY2UoKTtcclxuICAgICAgICBpZiAoX2Noa0l0ZW1zICYmIF9jaGtJdGVtcy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgY29uc3QgZmlyc3QgPSBfY2hrSXRlbXNbMF07XHJcbiAgICAgICAgICAgIGNvbnN0IGxhc3QgPSBfY2hrSXRlbXNbX2Noa0l0ZW1zLmxlbmd0aCAtIDFdO1xyXG5cclxuXHJcbiAgICAgICAgICAgIGNvbnN0IGZpcnN0SW5kZXggPSB0aGlzLl9yaWdodERhdGEuZmluZEluZGV4KG4gPT4gblt0aGlzLmlkRmllbGRdID09IGZpcnN0W3RoaXMuaWRGaWVsZF0pO1xyXG4gICAgICAgICAgICBjb25zdCBsYXN0SW5kZXggPSB0aGlzLl9yaWdodERhdGEuZmluZEluZGV4KG4gPT4gblt0aGlzLmlkRmllbGRdID09IGZpcnN0W2xhc3QuaWRGaWVsZF0pO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHtmaXJzdDogZmlyc3RJbmRleCwgbGFzdDogbGFzdEluZGV4fTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiB7IGZpcnN0OiAtMSwgbGFzdDogLTF9O1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgbW92ZU1vcmUodHlwZTogJ3RvcCd8J2JvdHRvbScpIHtcclxuICAgICAgICBpZiAodGhpcy5fcmlnaHRDaGVja2VkcyAmJiBPYmplY3Qua2V5cyh0aGlzLl9yaWdodENoZWNrZWRzKS5sZW5ndGgpIHtcclxuICAgICAgICAgICAgY29uc3QgX2Noa0l0ZW1zID0gdGhpcy5nZXRDaGVja2VkSXRlbXNGcm9tRGF0YVNvdXJjZSgpO1xyXG4gICAgICAgICAgICBjb25zdCBpdGVtcyA9IHRoaXMuX3JpZ2h0RGF0YS5maWx0ZXIobiA9PiAhX2Noa0l0ZW1zLmZpbmQociA9PiByW3RoaXMuaWRGaWVsZF0gPT0gblt0aGlzLmlkRmllbGRdKSApO1xyXG4gICAgICAgICAgICBpZiAodHlwZSA9PT0gJ3RvcCcpIHtcclxuICAgICAgICAgICAgICAgIGl0ZW1zLnNwbGljZSgwLCAwLCAuLi5fY2hrSXRlbXMpO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKHR5cGUgPT09ICdib3R0b20nKSB7XHJcbiAgICAgICAgICAgICAgICBpdGVtcy5wdXNoKC4uLl9jaGtJdGVtcyk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHRoaXMuX3JpZ2h0RGF0YSA9IFsuLi5pdGVtc107XHJcbiAgICAgICAgICAgIHRoaXMudXBkYXRlQWN0aXZlSW5kZXgoKTtcclxuICAgICAgICAgICAgdGhpcy5zZWxlY3Rpb25zQ2hhbmdlKCk7XHJcbiAgICAgICAgICAgIHRoaXMuY2hhbmdlU2VsZWN0SWRzKDApO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIG1vdmVNb3JlMih0eXBlOiAndXAnfCAnZG93bicpIHtcclxuICAgICAgICBjb25zdCB7IGZpcnN0LCBsYXN0IH0gPSB0aGlzLmdldENoZWNrZWRGaXJzdEluZGV4QW5kTGFzdEluZGV4KCk7XHJcbiAgICAgICAgY29uc3QgX2Noa0l0ZW1zID0gdGhpcy5nZXRDaGVja2VkSXRlbXNGcm9tRGF0YVNvdXJjZSgpO1xyXG4gICAgICAgIC8vIOiOt+WPluaOkumZpOW3sumAieS4reeahOiusOW9lVxyXG4gICAgICAgIGNvbnN0IGl0ZW1zID0gdGhpcy5fcmlnaHREYXRhLmZpbHRlcihuID0+ICFfY2hrSXRlbXMuZmluZChyID0+IHJbdGhpcy5pZEZpZWxkXSA9PSBuW3RoaXMuaWRGaWVsZF0pICk7XHJcblxyXG4gICAgICAgIGlmICh0eXBlID09PSAndXAnKSB7XHJcbiAgICAgICAgICAgIGxldCB0YXJJbmRleCA9IGZpcnN0IC0gMTtcclxuICAgICAgICAgICAgaWYgKHRhckluZGV4IDwgMCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5tb3ZlTW9yZSgndG9wJyk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBpdGVtcy5zcGxpY2UodGFySW5kZXgsIDAsIC4uLl9jaGtJdGVtcyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2UgaWYgKHR5cGUgPT09ICdkb3duJykge1xyXG4gICAgICAgICAgICBsZXQgZG93bklkeCA9IGZpcnN0ICsgMTtcclxuICAgICAgICAgICAgaWYgKGRvd25JZHggPj0gdGhpcy5fcmlnaHREYXRhLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5tb3ZlTW9yZSgnYm90dG9tJyk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBpdGVtcy5zcGxpY2UoZG93bklkeCwgMCwgLi4uX2Noa0l0ZW1zKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLl9yaWdodERhdGEgPSBbLi4uaXRlbXNdO1xyXG4gICAgICAgIHRoaXMudXBkYXRlQWN0aXZlSW5kZXgoKTtcclxuICAgICAgICB0aGlzLnNlbGVjdGlvbnNDaGFuZ2UoKTtcclxuICAgICAgICB0aGlzLmNoYW5nZVNlbGVjdElkcygwKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHVwZGF0ZUFjdGl2ZUluZGV4KCkge1xyXG4gICAgICAgIGxldCBpZHggPSAtMTtcclxuICAgICAgICBpZiAodGhpcy5yaWdodFNlbGVjdGVkSXRlbSkge1xyXG4gICAgICAgICAgICBpZHggPSB0aGlzLl9yaWdodERhdGEuZmluZEluZGV4KG4gPT4gblt0aGlzLmlkRmllbGRdID09PSB0aGlzLnJpZ2h0U2VsZWN0ZWRJdGVtW3RoaXMuaWRGaWVsZF0pXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLnJpZ2h0QWN0aXZlSW5kZXggPSBpZHg7XHJcbiAgICB9XHJcblxyXG4gICAgXHJcbiAgICByaWdodERhdGFDbGlja2VkKCRldmVudDogTW91c2VFdmVudCwgaXRlbTogYW55LCBpbmRleDogbnVtYmVyKSB7XHJcbiAgICAgICAgY29uc3QgaXNDdHJsS2V5ID0gJGV2ZW50LmN0cmxLZXk7XHJcbiAgICAgICAgY29uc3QgaXNTaGlmdEtleSA9ICRldmVudC5zaGlmdEtleTtcclxuICAgICAgICB0aGlzLnJpZ2h0U2VsZWN0ZWRJdGVtID0gaXRlbTtcclxuICAgICAgICBjb25zdCB0YXJnZXQ6IGFueSA9ICRldmVudC50YXJnZXQ7XHJcblxyXG4gICAgICAgIGNvbnN0IHVsID0gdGFyZ2V0LmNsb3Nlc3QoJ3VsJyk7XHJcbiAgICAgICAgaWYgKGlzU2hpZnRLZXkpIHtcclxuICAgICAgICAgICAgaWYgKHVsKSB7XHJcbiAgICAgICAgICAgICAgICB1bC5zdHlsZS51c2VyU2VsZWN0ID0gJ25vbmUnO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoIWlzQ3RybEtleSAmJiAhaXNTaGlmdEtleSkge1xyXG4gICAgICAgICAgICB0aGlzLnJpZ2h0QWN0aXZlSW5kZXggPSBpbmRleDtcclxuICAgICAgICAgICAgY29uc3QgaXNDaGVja2JveENsaWNrZWQgPSB0YXJnZXQuY2xhc3NOYW1lLmluZGV4T2YoJ2N1c3RvbS1jaGVja2JveCcpID4gLTEgfHwgdGFyZ2V0LmNsb3Nlc3QoJy5jdXN0b20tY2hlY2tib3gnKTtcclxuXHJcblxyXG5cclxuICAgICAgICAgICAgaWYgKGlzQ2hlY2tib3hDbGlja2VkKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5fcmlnaHRDaGVja2VkcyAmJiB0aGlzLl9yaWdodENoZWNrZWRzW2l0ZW1bdGhpcy5pZEZpZWxkXV0pIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnJpZ2h0U2VsZWN0ZWRJdGVtID0gbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICBkZWxldGUgdGhpcy5fcmlnaHRDaGVja2Vkc1tpdGVtW3RoaXMuaWRGaWVsZF1dO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9yaWdodENoZWNrZWRzID0gdGhpcy5fcmlnaHRDaGVja2VkcyB8fCB7fTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9yaWdodENoZWNrZWRzW2l0ZW1bdGhpcy5pZEZpZWxkXV0gPSBpdGVtO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jbGVhclJpZ2h0Q2hlY2tlZHMoKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuX3JpZ2h0Q2hlY2tlZHMgPSB0aGlzLl9yaWdodENoZWNrZWRzIHx8IHt9O1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fcmlnaHRDaGVja2Vkc1tpdGVtW3RoaXMuaWRGaWVsZF1dID0gaXRlbTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSB7XHJcblxyXG4gICAgICAgICAgICBjb25zdCBzZXRDaGVja0l0ZW1zID0gKGlzQWRkID0gdHJ1ZSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgbGV0IGZvY3VzSW5kZXggPSB0aGlzLnJpZ2h0QWN0aXZlSW5kZXg7XHJcbiAgICAgICAgICAgICAgICBpZiAoZm9jdXNJbmRleCA9PT0gLTEpIHtcclxuICAgICAgICAgICAgICAgICAgICBmb2N1c0luZGV4ID0gMDtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBjb25zdCBlbmRJbmRleCA9IGluZGV4O1xyXG4gICAgICAgICAgICAgICAgbGV0IHN0YXJ0ID0gZm9jdXNJbmRleDtcclxuICAgICAgICAgICAgICAgIGxldCBlbmQgPSBlbmRJbmRleDtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoZm9jdXNJbmRleCA+IGVuZEluZGV4KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc3RhcnQgPSBlbmRJbmRleDtcclxuICAgICAgICAgICAgICAgICAgICBlbmQgPSBmb2N1c0luZGV4O1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGNvbnN0IHNlbGVjdEl0ZW1zID0gWy4uLnRoaXMuX3JpZ2h0RGF0YV0uc3BsaWNlKHN0YXJ0LCBlbmQgLSBzdGFydCArIDEpO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmICghaXNBZGQpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9yaWdodENoZWNrZWRzID0gW107XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgc2VsZWN0SXRlbXMuZm9yRWFjaChuID0+IHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9yaWdodENoZWNrZWRzW25bdGhpcy5pZEZpZWxkXV0gPSBuO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgICAgICBpZiAoaXNDdHJsS2V5KSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5fcmlnaHRDaGVja2Vkc1tpdGVtW3RoaXMuaWRGaWVsZF1dKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZGVsZXRlIHRoaXMuX3JpZ2h0Q2hlY2tlZHNbaXRlbVt0aGlzLmlkRmllbGRdXTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnJpZ2h0U2VsZWN0ZWRJdGVtID0gbnVsbDtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fcmlnaHRDaGVja2Vkc1tpdGVtW3RoaXMuaWRGaWVsZF1dID0gaXRlbTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoaXNTaGlmdEtleSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHNldENoZWNrSXRlbXMoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHRoaXMucmlnaHRBY3RpdmVJbmRleCA9IGluZGV4O1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKGlzU2hpZnRLZXkpIHtcclxuICAgICAgICAgICAgICAgIHNldENoZWNrSXRlbXMoaXNDdHJsS2V5KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHVsKSB7XHJcbiAgICAgICAgICAgIHVsLnN0eWxlLnVzZXJTZWxlY3QgPSAnbm9uZSc7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIG9uUmlnaHRJdGVtQ2xpY2soJGV2ZW50LCBpdGVtLCBpbmRleCkge1xyXG4gICAgICAgIGlmICh0aGlzLmVuYWJsZU1vdmVNb3JlKSB7XHJcbiAgICAgICAgICAgIHRoaXMucmlnaHREYXRhQ2xpY2tlZCgkZXZlbnQsIGl0ZW0sIGluZGV4KTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLnJpZ2h0RGF0YUNoZWNrZWQoaXRlbSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuXHJcbiAgICAvLyNlbmRyZWdpb25cclxuXHJcbiAgICBjbGVhclJpZ2h0Q2hlY2tlZHMoKSB7XHJcbiAgICAgICAgdGhpcy5fcmlnaHRDaGVja2VkcyA9IHt9O1xyXG4gICAgICAgIHRoaXMuY2QuZGV0ZWN0Q2hhbmdlcygpO1xyXG4gICAgfVxyXG59XHJcblxyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgICBzZWxlY3RvcjogJ2Rpc3BsYXktdGV4dCcsXHJcbiAgICB0ZW1wbGF0ZTogYFxyXG4gICAgICAgIDxuZy1jb250YWluZXIgKm5nSWY9XCJ0ZW1wbGF0ZVwiID5cclxuICAgICAgICAgICAgPG5nLWNvbnRhaW5lclxyXG4gICAgICAgICAgICAgICAgKm5nVGVtcGxhdGVPdXRsZXQ9XCJ0ZW1wbGF0ZTsgY29udGV4dDogeyRpbXBsaWNpdDogZGF0YSxpbnN0YW5jZTogbXMsIHNpZGU6IHNpZGUsIHNlbGVjdGVkOiBtcy5pc0NoZWNrZWQoZGF0YSwgJ1InKSB9XCI+XHJcbiAgICAgICAgICAgIDwvbmctY29udGFpbmVyPlxyXG4gICAgICAgIDwvbmctY29udGFpbmVyPlxyXG4gICAgICAgIDxuZy1jb250YWluZXIgKm5nSWY9XCIhdGVtcGxhdGVcIj57e19nZXRUZXh0KGRhdGEpfX08L25nLWNvbnRhaW5lcj5cclxuICAgIGBcclxufSlcclxuZXhwb3J0IGNsYXNzIERpc3BsYXlUZXh0Q29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcclxuICAgIEBJbnB1dCgpIHRlbXBsYXRlOiBUZW1wbGF0ZVJlZjxhbnk+O1xyXG4gICAgQElucHV0KCkgZGF0YTogYW55O1xyXG4gICAgQElucHV0KCkgc2lkZSA9ICdMJztcclxuXHJcbiAgICBjb25zdHJ1Y3RvcihwdWJsaWMgbXM6IE11bHRpU2VsZWN0Q29tcG9uZW50KSB7IH1cclxuXHJcbiAgICBuZ09uSW5pdCgpIHtcclxuICAgICAgICAvLyBjb25zb2xlLmxvZyh0aGlzLmRhdGEpO1xyXG4gICAgfVxyXG5cclxuICAgIF9nZXRUZXh0KGl0ZW0pIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5tcy5nZXRUZXh0KGl0ZW0pO1xyXG4gICAgfVxyXG59XHJcbiJdfQ==
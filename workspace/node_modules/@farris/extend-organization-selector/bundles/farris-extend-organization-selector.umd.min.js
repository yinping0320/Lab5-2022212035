!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@farris/devkit"),require("@angular/core"),require("@farris/ui-organization-selector")):"function"==typeof define&&define.amd?define("@farris/extend-organization-selector",["exports","@farris/devkit","@angular/core","@farris/ui-organization-selector"],e):e((t.farris=t.farris||{},t.farris["extend-organization-selector"]={}),t.devkit,t.ng.core,t.uiOrganizationSelector)}(this,function(t,e,n,r){"use strict";function i(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),a=[];try{for(;(void 0===e||0<e--)&&!(r=o.next()).done;)a.push(r.value)}catch(c){i={error:c}}finally{try{r&&!r.done&&(n=o["return"])&&n.call(o)}finally{if(i)throw i.error}}return a}function s(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(i(arguments[e]));return t}var o=(a.prototype.ngOnInit=function(){var n=this;this.targetComponent.selectionsChange.subscribe(function(t){var e=n.mapFields;t.selections&&t.selections.length?n.mappingData(t.selections,e):n.mappingData(null,e)}),this.targetComponent.inputClear.subscribe(function(){var t=n.mapFields;n.mappingData(null,t)}),this.targetComponent.tagRemoved.subscribe(function(t){var e=n.mapFields;n.tagRemovedMappingData(t.deleteIndex,e)}),this.targetComponent.mapFields||(this.targetComponent.mapFields=this.mapFields)},a.prototype.ngAfterViewInit=function(){},a.prototype.ngOnDestroy=function(){},a.prototype.getFieldBinding=function(){var t=this.targetComponent&&this.targetComponent.ngControl&&this.targetComponent.ngControl,e=t&&t.formDirective&&t.formDirective.form&&t.formDirective.form&&t.formDirective.form.ngFormControls,n=t&&t.name;return e&&e[n]&&e[n].binding},a.prototype.tagRemovedMappingData=function(o,t){var a=this;if(t&&this.targetComponent.ngControl&&this.targetComponent.ngControl.formDirective&&this.targetComponent.ngControl.formDirective.form&&this.targetComponent.ngControl.formDirective.form.bindingData){var c=this.targetComponent.ngControl.formDirective.form.bindingData;if(c.setValue){var e=this.vm.frameContext.appContext;e.changeDetectionController.detach();var n=Object.keys(t),r=n.findIndex(function(t){return t===a.targetComponent.primaryField});n.includes(this.targetComponent.primaryField)&&0!==r&&(n.splice(r,1),n=s([this.targetComponent.primaryField],n));var p=this.getBindingPathArray(),i=this.mapFields[n[0]].split(","),l=c.getValue(p.concat(i[0]));(!l||l.split(",").length<2)&&n.reverse(),n.forEach(function(t){a.mapFields[t].split(",").forEach(function(t){var e=p.concat(t.split("."));if(a.getFieldBinding()!==t){var n=c.getValue(e);if(n){var r=n.split(",");r.splice(o,1);var i=r.join();i?c.setValue(e,i,!0,!0):c.clearValue(e,!0,!0)}else c.clearValue(e,!0,!0)}})}),e.changeDetectionController.reattach()}}},a.prototype.mappingData=function(i,t){var o=this;if(t){var e=this.vm.frameContext.appContext;e.changeDetectionController.detach();var n=Object.keys(t),r=n.findIndex(function(t){return t===o.targetComponent.primaryField});n.includes(this.targetComponent.primaryField)&&0!==r&&(n.splice(r,1),n=s([this.targetComponent.primaryField],n)),i||n.reverse(),n.forEach(function(e){var n="";i&&(n=i instanceof Array?i.map(function(t){return o.getValue(e,t)}).join(","):o.getValue(e,i));var r=o.getBindingPathArray();t[e].split(",").forEach(function(t){o.getFieldBinding()!==t&&(i?o.vm.bindingData.setValue(r.concat(t.split(".")),n,!0,!0):o.vm.bindingData.clearValue(r.concat(t.split(".")),!0,!0))})}),e.changeDetectionController.reattach()}},a.prototype.getValue=function(t,e){return-1===t.indexOf(".")?e[t]:t.split(".").reduce(function(t,e){return t[e]},e)},a.prototype.getBindingPathArray=function(){var t=this.vm.bindingPath;return t?t.split("/").filter(function(t){return""!==t}):[]},a.decorators=[{type:n.Directive,args:[{selector:"[organization-selector-data-mapping]"}]}],a.ctorParameters=function(){return[{type:e.ViewModel,decorators:[{type:n.Optional}]},{type:r.OrganizationSelectorComponent,decorators:[{type:n.Optional},{type:n.Self}]},{type:n.Injector}]},a.propDecorators={mapFields:[{type:n.Input}]},a);function a(t,e,n){this.vm=t,this.targetComponent=e,this.injector=n}var c=(p.decorators=[{type:n.NgModule,args:[{declarations:[o],imports:[r.OrganizationSelectorModule],exports:[o]}]}],p);function p(){}t.OrganizationSelectorDataMappingDirective=o,t.OrganizationSelectorDataMappingModule=c,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=farris-extend-organization-selector.umd.min.js.map
/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { debounceTime } from 'rxjs/operators';
import { Injector } from '@angular/core';
/*
 * @Author: 疯狂秀才(Lucas Huang)
 * @Date: 2019-08-14 11:41:00
 * @LastEditors: 疯狂秀才(Lucas Huang)
 * @LastEditTime: 2019-10-14 13:00:48
 * @QQ: 1055818239
 * @Version: v0.0.1
 */
import { Component, Renderer2, ElementRef, ViewChild } from '@angular/core';
import { DatagridBaseEditorDirective } from '../datagrid-base-editor.directive';
import { LookupDefaultOptions } from '../editor-default-options';
import { LookupGridComponent } from '@farris/ui-lookup';
import { RuntimeStateService } from '@farris/ui-common';
// 
var DatagridLookupComponent = /** @class */ (function (_super) {
    tslib_1.__extends(DatagridLookupComponent, _super);
    function DatagridLookupComponent(render, el, rts, injector) {
        var _this = _super.call(this, render, el, injector) || this;
        _this.rts = rts;
        _this.stopPropagation = false;
        _this.extInfoFormatter = (/**
         * @param {?} e
         * @return {?}
         */
        function (e) {
            if (_this.options.extInfoFormatter) {
                return _this.options.extInfoFormatter({ bindingData: _this.dr.rowData, instance: e.instance });
            }
            return '';
        });
        return _this;
    }
    Object.defineProperty(DatagridLookupComponent.prototype, "controlId", {
        set: /**
         * @param {?} id
         * @return {?}
         */
        function (id) {
            this.instance.controlId = id;
            if (this.instance.uri) {
                this.instance.controlId += '_' + this.instance.uri;
            }
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    DatagridLookupComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        _super.prototype.ngOnInit.call(this);
        if (!this.options.valueField) {
            this.options.valueField = this.options.idField;
        }
        if (this.options.showNavigation === undefined || this.options.showNavigation === null) {
            this.options.showNavigation = true;
        }
        this.options = Object.assign({}, LookupDefaultOptions, this.options);
    };
    /**
     * @return {?}
     */
    DatagridLookupComponent.prototype.ngAfterViewInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.instance.changeDetector.detectChanges();
        if (this.options.viewType === 'tag') {
            this.inputElement = this.instance.tagbox.nativeElement;
        }
        else {
            this.inputElement = this.instance.inputGroup.textbox.nativeElement;
        }
        _super.prototype.ngAfterViewInit.call(this);
        if (this.options.loader) {
            if (this.instance['http']) {
                /** @type {?} */
                var getDataFn = this.instance['http'];
                this.instance['http'] = tslib_1.__assign({}, getDataFn, { getData: this.options.loader });
            }
            else {
                this.instance['http'] = { getData: this.options.loader };
            }
        }
        this.instance['host'] = this.dg;
        this.rts.state$.pipe(debounceTime(10)).subscribe((/**
         * @param {?} state
         * @return {?}
         */
        function (state) {
            if (state && state.form && state.form.lookup && _this.dg) {
                _this.pending = state.form.lookup.pending;
                _this.dg.pending = _this.pending;
            }
        }));
    };
    /**
     * @return {?}
     */
    DatagridLookupComponent.prototype.onDialogClosed = /**
     * @return {?}
     */
    function () {
        // this.lookup.changeDetector.detectChanges();
    };
    /**
     * @return {?}
     */
    DatagridLookupComponent.prototype.onDialogOpen = /**
     * @return {?}
     */
    function () {
        this.instance.changeDetector.detectChanges();
    };
    /**
     * @return {?}
     */
    DatagridLookupComponent.prototype.onLoadSuccess = /**
     * @return {?}
     */
    function () {
        this.instance.changeDetector.detectChanges();
    };
    /**
     * @param {?} event
     * @return {?}
     */
    DatagridLookupComponent.prototype.onClear = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        // const rowData = this.instance.selectionMgr.getBindingData();
        // this.instance['defaultMapping'].lookupFieldMap(null, this.instance.mapFields, rowData);
        this.instance.changeDetector.detectChanges();
        if (this.options.clear) {
            this.options.clear();
        }
    };
    /**
     * @param {?} $evnet
     * @return {?}
     */
    DatagridLookupComponent.prototype.onTagRemoved = /**
     * @param {?} $evnet
     * @return {?}
     */
    function ($evnet) {
        if (this.options.tagRemoved) {
            this.options.tagRemoved($evnet);
        }
    };
    DatagridLookupComponent.decorators = [
        { type: Component, args: [{
                    selector: 'grid-editor-lookup',
                    template: "\n    <div [formGroup]=\"group\" class=\"f-datagrid-cell-formgroup farris-group-auto\">\n        <datagrid-tooltip [control]=\"formControl\" [tooltipPosition]=\"'top-left'\" [message]=\"errorMessage\">\n            <farris-lookup-grid #lookup style=\"width: 100%\"\n                id=\"{{ controlId }}\"\n                [formControlName]=\"column.field\"\n                [uri]=\"options.uri\"\n                [helpId]=\"options.helpId\"\n                [displayType]=\"options.displayType\"\n                [singleSelect]=\"options.singleSelect\"\n                [idField]=\"options.idField\"\n                [pageSize]=\"options.pageSize || 20\"\n                [pageIndex]=\"options.pageSize || 1\"\n                [pagination]=\"options.pageination\"\n                [textField]=\"options.textField\"\n                [valueField]=\"options.valueField\"\n                [title]=\"options.title\"\n                [useFavorite]=\"options.useFavorite\"\n                [isRecordSize]=\"options.isRecordSize\"\n                [useTip]=\"options.useTip\"\n                [editable]=\"options.editable\"\n                [readonly]=\"options.readonly\"\n                [dialogWidth]=\"options.dialogWidth\"\n                [dialogHeight]=\"options.dialogHeight\"\n                [showMaxButton]=\"options.showMaxButton\"\n                [showCloseButton]=\"options.showCloseButton\"\n                [resizable]=\"options.resizable\"\n                [buttonAlign]=\"options.buttonAlign\"\n                [enableClear]=\"options.enableClear\"\n                [searchOnServer]=\"options.searchOnServer\"\n                [nosearch]=\"options.nosearch\"\n                [maxLength]=\"options.maxLength\"\n                [mappingFn]=\"options.mappingFn\"\n                [mapFields]=\"options.mapFields\"\n                [context]=\"options.context\"\n                [expandLevel]=\"options.expandLevel\"\n                [dictPicking]=\"options.dictPicking\"\n                [dictPicked]=\"options.dictPicked\"\n                [enableFullTree]=\"options.enableFullTree\"\n                [loadTreeDataType]=\"options.loadTreeDataType\"\n                [enableCascade]=\"options.enableCascade\"\n                [cascadeStatus]=\"options.cascadeStatus\"\n                [useExtendInfo]=\"options.useExtendInfo\"\n                [extInfoFields]=\"options.extInfoFields\"\n                [extInfoFormatter]=\"options.extInfoFormatter\"\n                [textAlign]=\"options.textAlign\"\n                [loadDataWhenOpen]=\"options.loadDataWhenOpen\"\n                [selectFirstInNav]=\"options.selectFirstInNav\"\n                [customNavFormatter]=\"options.customNavFormatter\"\n                [customFormatter]=\"options.customFormatter\"\n                [treeInfo]=\"options?.treeInfo\"\n                [treeTableOptions]=\"options?.treeTableOptions\"\n                [showCheckAll]=\"options?.showCheckAll\"\n                [viewType]=\"options?.viewType\"\n                [quickSelect]=\"options?.quickSelect\"\n                [treeToList]=\"options?.treeToList\"\n                [navTreeToList]=\"options?.navTreeToList\"\n                [showCascadeControl]=\"options.showCascadeControl\"\n                [showNavigation]=\"options.showNavigation\"\n                [showSelected]=\"options.showSelected\"\n                [beforeLoadData]=\"options.beforeLoadData\"\n                [beforeSelectData]=\"options.beforeSelectData\"\n                [searchBarMode]=\"options.searchBarMode\"\n                [enableMultiFieldSearch]=\"options.enableMultiFieldSearch\"\n                [useNewLayout]=\"options.useNewLayout\"\n                (dialogClosed)=\"onDialogClosed()\"\n                (dialogOpened)=\"onDialogOpen()\"\n                (clear)=\"onClear($event)\"\n                (loadSuccess)=\"onLoadSuccess()\"\n                (tagRemoved)=\"onTagRemoved($event)\"\n                [multipleChoiceSeparator]=\"options.multipleChoiceSeparator\"\n                [labels]=\"options.labels\"\n                [allowQueryFields]=\"options.allowQueryFields\"\n            ></farris-lookup-grid>\n        </datagrid-tooltip>\n    </div>\n    "
                }] }
    ];
    /** @nocollapse */
    DatagridLookupComponent.ctorParameters = function () { return [
        { type: Renderer2 },
        { type: ElementRef },
        { type: RuntimeStateService },
        { type: Injector }
    ]; };
    DatagridLookupComponent.propDecorators = {
        instance: [{ type: ViewChild, args: ['lookup',] }]
    };
    return DatagridLookupComponent;
}(DatagridBaseEditorDirective));
export { DatagridLookupComponent };
if (false) {
    /** @type {?} */
    DatagridLookupComponent.prototype.instance;
    /** @type {?} */
    DatagridLookupComponent.prototype.stopPropagation;
    /** @type {?} */
    DatagridLookupComponent.prototype.extInfoFormatter;
    /**
     * @type {?}
     * @private
     */
    DatagridLookupComponent.prototype.rts;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0YWdyaWQtbG9va3VwLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvdWktZGF0YWdyaWQtZWRpdG9ycy8iLCJzb3VyY2VzIjpbImxpYi9lZGl0b3JzL2RhdGFncmlkLWxvb2t1cC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDOUMsT0FBTyxFQUFxRCxRQUFRLEVBQUUsTUFBTSxlQUFlLENBQUM7Ozs7Ozs7OztBQVM1RixPQUFPLEVBQUUsU0FBUyxFQUFVLFNBQVMsRUFBRSxVQUFVLEVBQUUsU0FBUyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ3BGLE9BQU8sRUFBRSwyQkFBMkIsRUFBRSxNQUFNLG1DQUFtQyxDQUFDO0FBQ2hGLE9BQU8sRUFBRSxvQkFBb0IsRUFBRSxNQUFNLDJCQUEyQixDQUFDO0FBQ2pFLE9BQU8sRUFBRSxtQkFBbUIsRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBQ3hELE9BQU8sRUFBRSxtQkFBbUIsRUFBRSxNQUFNLG1CQUFtQixDQUFDOztBQUl4RDtJQWdGNkMsbURBQTJCO0lBWXBFLGlDQUFZLE1BQWlCLEVBQUUsRUFBYyxFQUFVLEdBQXdCLEVBQ25FLFFBQWtCO1FBRDlCLFlBRUksa0JBQU0sTUFBTSxFQUFFLEVBQUUsRUFBRSxRQUFRLENBQUMsU0FDOUI7UUFIc0QsU0FBRyxHQUFILEdBQUcsQ0FBcUI7UUFEL0UscUJBQWUsR0FBRyxLQUFLLENBQUM7UUE2RXhCLHNCQUFnQjs7OztRQUFHLFVBQUMsQ0FBQztZQUNqQixJQUFJLEtBQUksQ0FBQyxPQUFPLENBQUMsZ0JBQWdCLEVBQUU7Z0JBQy9CLE9BQU8sS0FBSSxDQUFDLE9BQU8sQ0FBQyxnQkFBZ0IsQ0FBQyxFQUFFLFdBQVcsRUFBRSxLQUFJLENBQUMsRUFBRSxDQUFDLE9BQU8sRUFBRSxRQUFRLEVBQUUsQ0FBQyxDQUFDLFFBQVEsRUFBRSxD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QThDO0lBQ2xELENBQUM7Ozs7SUFFRCw4Q0FBWTs7O0lBQVo7UUFDSSxJQUFJLENBQUMsUUFBUSxDQUFDLGNBQWMsQ0FBQyxhQUFhLEVBQUUsQ0FBQztJQUNqRCxDQUFDOzs7O0lBRUQsK0NBQWE7OztJQUFiO1FBQ0ksSUFBSSxDQUFDLFFBQVEsQ0FBQyxjQUFjLENBQUMsYUFBYSxFQUFFLENBQUM7SUFDakQsQ0FBQzs7Ozs7SUFFRCx5Q0FBTzs7OztJQUFQLFVBQVEsS0FBaUI7UUFDckIsK0RBQStEO1FBQy9ELDBGQUEwRjtRQUUxRixJQUFJLENBQUMsUUFBUSxDQUFDLGNBQWMsQ0FBQyxhQUFhLEVBQUUsQ0FBQztRQUM3QyxJQUFJLElBQUksQ0FBQyxPQUFPLENBQUMsS0FBSyxFQUFFO1lBQ3BCLElBQUksQ0FBQyxPQUFPLENBQUMsS0FBSyxFQUFFLENBQUM7U0FDeEI7SUFDTCxDQUFDOzs7OztJQUVELDhDQUFZOzs7O0lBQVosVUFBYSxNQUFNO1FBQ2YsSUFBSSxJQUFJLENBQUMsT0FBTyxDQUFDLFVBQVUsRUFBRTtZQUN6QixJQUFJLENBQUMsT0FBTyxDQUFDLFVBQVUsQ0FBQyxNQUFNLENBQUMsQ0FBQztTQUNuQztJQUNMLENBQUM7O2dCQXRLSixTQUFTLFNBQUM7b0JBQ1AsUUFBUSxFQUFFLG9CQUFvQjtvQkFDOUIsUUFBUSxFQUFFLDBtSUE0RVQ7aUJBQ0o7Ozs7Z0JBdkYyQixTQUFTO2dCQUFFLFVBQVU7Z0JBSXhDLG1CQUFtQjtnQkFiZ0MsUUFBUTs7OzJCQWtHL0QsU0FBUyxTQUFDLFFBQVE7O0lBOEZ2Qiw4QkFBQztDQUFBLEFBL0tELENBZ0Y2QywyQkFBMkIsR0ErRnZFO1NBL0ZZLHVCQUF1Qjs7O0lBQ2hDLDJDQUFtRDs7SUFVbkQsa0RBQXdCOztJQTZFeEIsbURBTUM7Ozs7O0lBbEY4QyxzQ0FBZ0MiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBkZWJvdW5jZVRpbWUgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XHJcbmltcG9ydCB7IEFmdGVyVmlld0luaXQsIEFwcGxpY2F0aW9uUmVmLCBJbmplY3QsIGZvcndhcmRSZWYsIEluamVjdG9yIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbi8qXHJcbiAqIEBBdXRob3I6IOeWr+eLguengOaJjShMdWNhcyBIdWFuZylcclxuICogQERhdGU6IDIwMTktMDgtMTQgMTE6NDE6MDBcclxuICogQExhc3RFZGl0b3JzOiDnlq/ni4Lnp4DmiY0oTHVjYXMgSHVhbmcpXHJcbiAqIEBMYXN0RWRpdFRpbWU6IDIwMTktMTAtMTQgMTM6MDA6NDhcclxuICogQFFROiAxMDU1ODE4MjM5XHJcbiAqIEBWZXJzaW9uOiB2MC4wLjFcclxuICovXHJcbmltcG9ydCB7IENvbXBvbmVudCwgT25Jbml0LCBSZW5kZXJlcjIsIEVsZW1lbnRSZWYsIFZpZXdDaGlsZCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBEYXRhZ3JpZEJhc2VFZGl0b3JEaXJlY3RpdmUgfSBmcm9tICcuLi9kYXRhZ3JpZC1iYXNlLWVkaXRvci5kaXJlY3RpdmUnO1xyXG5pbXBvcnQgeyBMb29rdXBEZWZhdWx0T3B0aW9ucyB9IGZyb20gJy4uL2VkaXRvci1kZWZhdWx0LW9wdGlvbnMnO1xyXG5pbXBvcnQgeyBMb29rdXBHcmlkQ29tcG9uZW50IH0gZnJvbSAnQGZhcnJpcy91aS1sb29rdXAnO1xyXG5pbXBvcnQgeyBSdW50aW1lU3RhdGVTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy91aS1jb21tb24nO1xyXG5cclxuXHJcbi8vIFxyXG5AQ29tcG9uZW50KHtcclxuICAgIHNlbGVjdG9yOiAnZ3JpZC1lZGl0b3ItbG9va3VwJyxcclxuICAgIHRlbXBsYXRlOiBgXHJcbiAgICA8ZGl2IFtmb3JtR3JvdXBdPVwiZ3JvdXBcIiBjbGFzcz1cImYtZGF0YWdyaWQtY2VsbC1mb3JtZ3JvdXAgZmFycmlzLWdyb3VwLWF1dG9cIj5cclxuICAgICAgICA8ZGF0YWdyaWQtdG9vbHRpcCBbY29udHJvbF09XCJmb3JtQ29udHJvbFwiIFt0b29sdGlwUG9zaXRpb25dPVwiJ3RvcC1sZWZ0J1wiIFttZXNzYWdlXT1cImVycm9yTWVzc2FnZVwiPlxyXG4gICAgICAgICAgICA8ZmFycmlzLWxvb2t1cC1ncmlkICNsb29rdXAgc3R5bGU9XCJ3aWR0aDogMTAwJVwiXHJcbiAgICAgICAgICAgICAgICBpZD1cInt7IGNvbnRyb2xJZCB9fVwiXHJcbiAgICAgICAgICAgICAgICBbZm9ybUNvbnRyb2xOYW1lXT1cImNvbHVtbi5maWVsZFwiXHJcbiAgICAgICAgICAgICAgICBbdXJpXT1cIm9wdGlvbnMudXJpXCJcclxuICAgICAgICAgICAgICAgIFtoZWxwSWRdPVwib3B0aW9ucy5oZWxwSWRcIlxyXG4gICAgICAgICAgICAgICAgW2Rpc3BsYXlUeXBlXT1cIm9wdGlvbnMuZGlzcGxheVR5cGVcIlxyXG4gICAgICAgICAgICAgICAgW3NpbmdsZVNlbGVjdF09XCJvcHRpb25zLnNpbmdsZVNlbGVjdFwiXHJcbiAgICAgICAgICAgICAgICBbaWRGaWVsZF09XCJvcHRpb25zLmlkRmllbGRcIlxyXG4gICAgICAgICAgICAgICAgW3BhZ2VTaXplXT1cIm9wdGlvbnMucGFnZVNpemUgfHwgMjBcIlxyXG4gICAgICAgICAgICAgICAgW3BhZ2VJbmRleF09XCJvcHRpb25zLnBhZ2VTaXplIHx8IDFcIlxyXG4gICAgICAgICAgICAgICAgW3BhZ2luYXRpb25dPVwib3B0aW9ucy5wYWdlaW5hdGlvblwiXHJcbiAgICAgICAgICAgICAgICBbdGV4dEZpZWxkXT1cIm9wdGlvbnMudGV4dEZpZWxkXCJcclxuICAgICAgICAgICAgICAgIFt2YWx1ZUZpZWxkXT1cIm9wdGlvbnMudmFsdWVGaWVsZFwiXHJcbiAgICAgICAgICAgICAgICBbdGl0bGVdPVwib3B0aW9ucy50aXRsZVwiXHJcbiAgICAgICAgICAgICAgICBbdXNlRmF2b3JpdGVdPVwib3B0aW9ucy51c2VGYXZvcml0ZVwiXHJcbiAgICAgICAgICAgICAgICBbaXNSZWNvcmRTaXplXT1cIm9wdGlvbnMuaXNSZWNvcmRTaXplXCJcclxuICAgICAgICAgICAgICAgIFt1c2VUaXBdPVwib3B0aW9ucy51c2VUaXBcIlxyXG4gICAgICAgICAgICAgICAgW2VkaXRhYmxlXT1cIm9wdGlvbnMuZWRpdGFibGVcIlxyXG4gICAgICAgICAgICAgICAgW3JlYWRvbmx5XT1cIm9wdGlvbnMucmVhZG9ubHlcIlxyXG4gICAgICAgICAgICAgICAgW2RpYWxvZ1dpZHRoXT1cIm9wdGlvbnMuZGlhbG9nV2lkdGhcIlxyXG4gICAgICAgICAgICAgICAgW2RpYWxvZ0hlaWdodF09XCJvcHRpb25zLmRpYWxvZ0hlaWdodFwiXHJcbiAgICAgICAgICAgICAgICBbc2hvd01heEJ1dHRvbl09XCJvcHRpb25zLnNob3dNYXhCdXR0b25cIlxyXG4gICAgICAgICAgICAgICAgW3Nob3dDbG9zZUJ1dHRvbl09XCJvcHRpb25zLnNob3dDbG9zZUJ1dHRvblwiXHJcbiAgICAgICAgICAgICAgICBbcmVzaXphYmxlXT1cIm9wdGlvbnMucmVzaXphYmxlXCJcclxuICAgICAgICAgICAgICAgIFtidXR0b25BbGlnbl09XCJvcHRpb25zLmJ1dHRvbkFsaWduXCJcclxuICAgICAgICAgICAgICAgIFtlbmFibGVDbGVhcl09XCJvcHRpb25zLmVuYWJsZUNsZWFyXCJcclxuICAgICAgICAgICAgICAgIFtzZWFyY2hPblNlcnZlcl09XCJvcHRpb25zLnNlYXJjaE9uU2VydmVyXCJcclxuICAgICAgICAgICAgICAgIFtub3NlYXJjaF09XCJvcHRpb25zLm5vc2VhcmNoXCJcclxuICAgICAgICAgICAgICAgIFttYXhMZW5ndGhdPVwib3B0aW9ucy5tYXhMZW5ndGhcIlxyXG4gICAgICAgICAgICAgICAgW21hcHBpbmdGbl09XCJvcHRpb25zLm1hcHBpbmdGblwiXHJcbiAgICAgICAgICAgICAgICBbbWFwRmllbGRzXT1cIm9wdGlvbnMubWFwRmllbGRzXCJcclxuICAgICAgICAgICAgICAgIFtjb250ZXh0XT1cIm9wdGlvbnMuY29udGV4dFwiXHJcbiAgICAgICAgICAgICAgICBbZXhwYW5kTGV2ZWxdPVwib3B0aW9ucy5leHBhbmRMZXZlbFwiXHJcbiAgICAgICAgICAgICAgICBbZGljdFBpY2tpbmddPVwib3B0aW9ucy5kaWN0UGlja2luZ1wiXHJcbiAgICAgICAgICAgICAgICBbZGljdFBpY2tlZF09XCJvcHRpb25zLmRpY3RQaWNrZWRcIlxyXG4gICAgICAgICAgICAgICAgW2VuYWJsZUZ1bGxUcmVlXT1cIm9wdGlvbnMuZW5hYmxlRnVsbFRyZWVcIlxyXG4gICAgICAgICAgICAgICAgW2xvYWRUcmVlRGF0YVR5cGVdPVwib3B0aW9ucy5sb2FkVHJlZURhdGFUeXBlXCJcclxuICAgICAgICAgICAgICAgIFtlbmFibGVDYXNjYWRlXT1cIm9wdGlvbnMuZW5hYmxlQ2FzY2FkZVwiXHJcbiAgICAgICAgICAgICAgICBbY2FzY2FkZVN0YXR1c109XCJvcHRpb25zLmNhc2NhZGVTdGF0dXNcIlxyXG4gICAgICAgICAgICAgICAgW3VzZUV4dGVuZEluZm9dPVwib3B0aW9ucy51c2VFeHRlbmRJbmZvXCJcclxuICAgICAgICAgICAgICAgIFtleHRJbmZvRmllbGRzXT1cIm9wdGlvbnMuZXh0SW5mb0ZpZWxkc1wiXHJcbiAgICAgICAgICAgICAgICBbZXh0SW5mb0Zvcm1hdHRlcl09XCJvcHRpb25zLmV4dEluZm9Gb3JtYXR0ZXJcIlxyXG4gICAgICAgICAgICAgICAgW3RleHRBbGlnbl09XCJvcHRpb25zLnRleHRBbGlnblwiXHJcbiAgICAgICAgICAgICAgICBbbG9hZERhdGFXaGVuT3Blbl09XCJvcHRpb25zLmxvYWREYXRhV2hlbk9wZW5cIlxyXG4gICAgICAgICAgICAgICAgW3NlbGVjdEZpcnN0SW5OYXZdPVwib3B0aW9ucy5zZWxlY3RGaXJzdEluTmF2XCJcclxuICAgICAgICAgICAgICAgIFtjdXN0b21OYXZGb3JtYXR0ZXJdPVwib3B0aW9ucy5jdXN0b21OYXZGb3JtYXR0ZXJcIlxyXG4gICAgICAgICAgICAgICAgW2N1c3RvbUZvcm1hdHRlcl09XCJvcHRpb25zLmN1c3RvbUZvcm1hdHRlclwiXHJcbiAgICAgICAgICAgICAgICBbdHJlZUluZm9dPVwib3B0aW9ucz8udHJlZUluZm9cIlxyXG4gICAgICAgICAgICAgICAgW3RyZWVUYWJsZU9wdGlvbnNdPVwib3B0aW9ucz8udHJlZVRhYmxlT3B0aW9uc1wiXHJcbiAgICAgICAgICAgICAgICBbc2hvd0NoZWNrQWxsXT1cIm9wdGlvbnM/LnNob3dDaGVja0FsbFwiXHJcbiAgICAgICAgICAgICAgICBbdmlld1R5cGVdPVwib3B0aW9ucz8udmlld1R5cGVcIlxyXG4gICAgICAgICAgICAgICAgW3F1aWNrU2VsZWN0XT1cIm9wdGlvbnM/LnF1aWNrU2VsZWN0XCJcclxuICAgICAgICAgICAgICAgIFt0cmVlVG9MaXN0XT1cIm9wdGlvbnM/LnRyZWVUb0xpc3RcIlxyXG4gICAgICAgICAgICAgICAgW25hdlRyZWVUb0xpc3RdPVwib3B0aW9ucz8ubmF2VHJlZVRvTGlzdFwiXHJcbiAgICAgICAgICAgICAgICBbc2hvd0Nhc2NhZGVDb250cm9sXT1cIm9wdGlvbnMuc2hvd0Nhc2NhZGVDb250cm9sXCJcclxuICAgICAgICAgICAgICAgIFtzaG93TmF2aWdhdGlvbl09XCJvcHRpb25zLnNob3dOYXZpZ2F0aW9uXCJcclxuICAgICAgICAgICAgICAgIFtzaG93U2VsZWN0ZWRdPVwib3B0aW9ucy5zaG93U2VsZWN0ZWRcIlxyXG4gICAgICAgICAgICAgICAgW2JlZm9yZUxvYWREYXRhXT1cIm9wdGlvbnMuYmVmb3JlTG9hZERhdGFcIlxyXG4gICAgICAgICAgICAgICAgW2JlZm9yZVNlbGVjdERhdGFdPVwib3B0aW9ucy5iZWZvcmVTZWxlY3REYXRhXCJcclxuICAgICAgICAgICAgICAgIFtzZWFyY2hCYXJNb2RlXT1cIm9wdGlvbnMuc2VhcmNoQmFyTW9kZVwiXHJcbiAgICAgICAgICAgICAgICBbZW5hYmxlTXVsdGlGaWVsZFNlYXJjaF09XCJvcHRpb25zLmVuYWJsZU11bHRpRmllbGRTZWFyY2hcIlxyXG4gICAgICAgICAgICAgICAgW3VzZU5ld0xheW91dF09XCJvcHRpb25zLnVzZU5ld0xheW91dFwiXHJcbiAgICAgICAgICAgICAgICAoZGlhbG9nQ2xvc2VkKT1cIm9uRGlhbG9nQ2xvc2VkKClcIlxyXG4gICAgICAgICAgICAgICAgKGRpYWxvZ09wZW5lZCk9XCJvbkRpYWxvZ09wZW4oKVwiXHJcbiAgICAgICAgICAgICAgICAoY2xlYXIpPVwib25DbGVhcigkZXZlbnQpXCJcclxuICAgICAgICAgICAgICAgIChsb2FkU3VjY2Vzcyk9XCJvbkxvYWRTdWNjZXNzKClcIlxyXG4gICAgICAgICAgICAgICAgKHRhZ1JlbW92ZWQpPVwib25UYWdSZW1vdmVkKCRldmVudClcIlxyXG4gICAgICAgICAgICAgICAgW211bHRpcGxlQ2hvaWNlU2VwYXJhdG9yXT1cIm9wdGlvbnMubXVsdGlwbGVDaG9pY2VTZXBhcmF0b3JcIlxyXG4gICAgICAgICAgICAgICAgW2xhYmVsc109XCJvcHRpb25zLmxhYmVsc1wiXHJcbiAgICAgICAgICAgICAgICBbYWxsb3dRdWVyeUZpZWxkc109XCJvcHRpb25zLmFsbG93UXVlcnlGaWVsZHNcIlxyXG4gICAgICAgICAgICA+PC9mYXJyaXMtbG9va3VwLWdyaWQ+XHJcbiAgICAgICAgPC9kYXRhZ3JpZC10b29sdGlwPlxyXG4gICAgPC9kaXY+XHJcbiAgICBgLFxyXG59KVxyXG5leHBvcnQgY2xhc3MgRGF0YWdyaWRMb29rdXBDb21wb25lbnQgZXh0ZW5kcyBEYXRhZ3JpZEJhc2VFZGl0b3JEaXJlY3RpdmUgaW1wbGVtZW50cyBPbkluaXQsIEFmdGVyVmlld0luaXQge1xyXG4gICAgQFZpZXdDaGlsZCgnbG9va3VwJykgaW5zdGFuY2U6IExvb2t1cEdyaWRDb21wb25lbnQ7XHJcblxyXG5cclxuICAgIHNldCBjb250cm9sSWQoaWQpIHtcclxuICAgICAgICB0aGlzLmluc3RhbmNlLmNvbnRyb2xJZCA9IGlkO1xyXG4gICAgICAgIGlmICh0aGlzLmluc3RhbmNlLnVyaSkge1xyXG4gICAgICAgICAgICB0aGlzLmluc3RhbmNlLmNvbnRyb2xJZCArPSAnXycgKyB0aGlzLmluc3RhbmNlLnVyaTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgc3RvcFByb3BhZ2F0aW9uID0gZmFsc2U7XHJcbiAgICBjb25zdHJ1Y3RvcihyZW5kZXI6IFJlbmRlcmVyMiwgZWw6IEVsZW1lbnRSZWYsIHByaXZhdGUgcnRzOiBSdW50aW1lU3RhdGVTZXJ2aWNlLFxyXG4gICAgICAgICAgICAgICAgaW5qZWN0b3I6IEluamVjdG9yKSB7XHJcbiAgICAgICAgc3VwZXIocmVuZGVyLCBlbCwgaW5qZWN0b3IpO1xyXG4gICAgfVxyXG5cclxuICAgIG5nT25Jbml0KCk6IHZvaWQge1xyXG4gICAgICAgIHN1cGVyLm5nT25Jbml0KCk7XHJcblxyXG4gICAgICAgIGlmICghdGhpcy5vcHRpb25zLnZhbHVlRmllbGQpIHtcclxuICAgICAgICAgICAgdGhpcy5vcHRpb25zLnZhbHVlRmllbGQgPSB0aGlzLm9wdGlvbnMuaWRGaWVsZFxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5zaG93TmF2aWdhdGlvbiA9PT0gdW5kZWZpbmVkIHx8IHRoaXMub3B0aW9ucy5zaG93TmF2aWdhdGlvbiA9PT0gbnVsbCkge1xyXG4gICAgICAgICAgICB0aGlzLm9wdGlvbnMuc2hvd05hdmlnYXRpb24gPSB0cnVlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5vcHRpb25zID0gT2JqZWN0LmFzc2lnbigge30gLCBMb29rdXBEZWZhdWx0T3B0aW9ucywgdGhpcy5vcHRpb25zKTtcclxuICAgIH1cclxuXHJcbiAgICBuZ0FmdGVyVmlld0luaXQoKSB7XHJcbiAgICAgICAgdGhpcy5pbnN0YW5jZS5jaGFuZ2VEZXRlY3Rvci5kZXRlY3RDaGFuZ2VzKCk7XHJcbiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy52aWV3VHlwZSA9PT0gJ3RhZycpIHtcclxuICAgICAgICAgICAgdGhpcy5pbnB1dEVsZW1lbnQgPSB0aGlzLmluc3RhbmNlLnRhZ2JveC5uYXRpdmVFbGVtZW50O1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMuaW5wdXRFbGVtZW50ID0gdGhpcy5pbnN0YW5jZS5pbnB1dEdyb3VwLnRleHRib3gubmF0aXZlRWxlbWVudDtcclxuICAgICAgICB9XHJcbiAgICAgICAgc3VwZXIubmdBZnRlclZpZXdJbml0KCk7XHJcbiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5sb2FkZXIpIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMuaW5zdGFuY2VbJ2h0dHAnXSkge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgZ2V0RGF0YUZuID0gdGhpcy5pbnN0YW5jZVsnaHR0cCddO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5pbnN0YW5jZVsnaHR0cCddID0gey4uLmdldERhdGFGbiwgZ2V0RGF0YTogdGhpcy5vcHRpb25zLmxvYWRlcn07XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmluc3RhbmNlWydodHRwJ10gPSB7Z2V0RGF0YTogdGhpcy5vcHRpb25zLmxvYWRlcn07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuaW5zdGFuY2VbJ2hvc3QnXSA9IHRoaXMuZGc7XHJcblxyXG4gICAgICAgIHRoaXMucnRzLnN0YXRlJC5waXBlKFxyXG4gICAgICAgICAgICBkZWJvdW5jZVRpbWUoMTApXHJcbiAgICAgICAgKS5zdWJzY3JpYmUoc3RhdGUgPT4ge1xyXG4gICAgICAgICAgICBpZiAoc3RhdGUgJiYgc3RhdGUuZm9ybSAmJiBzdGF0ZS5mb3JtLmxvb2t1cCAmJiB0aGlzLmRnKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnBlbmRpbmcgPSBzdGF0ZS5mb3JtLmxvb2t1cC5wZW5kaW5nO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5kZy5wZW5kaW5nID0gdGhpcy5wZW5kaW5nO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgb25EaWFsb2dDbG9zZWQoKSB7XHJcbiAgICAgICAgLy8gdGhpcy5sb29rdXAuY2hhbmdlRGV0ZWN0b3IuZGV0ZWN0Q2hhbmdlcygpO1xyXG4gICAgfVxyXG5cclxuICAgIG9uRGlhbG9nT3BlbigpIHtcclxuICAgICAgICB0aGlzLmluc3RhbmNlLmNoYW5nZURldGVjdG9yLmRldGVjdENoYW5nZXMoKTtcclxuICAgIH1cclxuXHJcbiAgICBvbkxvYWRTdWNjZXNzKCkge1xyXG4gICAgICAgIHRoaXMuaW5zdGFuY2UuY2hhbmdlRGV0ZWN0b3IuZGV0ZWN0Q2hhbmdlcygpO1xyXG4gICAgfVxyXG5cclxuICAgIG9uQ2xlYXIoZXZlbnQ6IE1vdXNlRXZlbnQpIHtcclxuICAgICAgICAvLyBjb25zdCByb3dEYXRhID0gdGhpcy5pbnN0YW5jZS5zZWxlY3Rpb25NZ3IuZ2V0QmluZGluZ0RhdGEoKTtcclxuICAgICAgICAvLyB0aGlzLmluc3RhbmNlWydkZWZhdWx0TWFwcGluZyddLmxvb2t1cEZpZWxkTWFwKG51bGwsIHRoaXMuaW5zdGFuY2UubWFwRmllbGRzLCByb3dEYXRhKTtcclxuXHJcbiAgICAgICAgdGhpcy5pbnN0YW5jZS5jaGFuZ2VEZXRlY3Rvci5kZXRlY3RDaGFuZ2VzKCk7XHJcbiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5jbGVhcikge1xyXG4gICAgICAgICAgICB0aGlzLm9wdGlvbnMuY2xlYXIoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgb25UYWdSZW1vdmVkKCRldm5ldCkge1xyXG4gICAgICAgIGlmICh0aGlzLm9wdGlvbnMudGFnUmVtb3ZlZCkge1xyXG4gICAgICAgICAgICB0aGlzLm9wdGlvbnMudGFnUmVtb3ZlZCgkZXZuZXQpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBleHRJbmZvRm9ybWF0dGVyID0gKGUpID0+IHtcclxuICAgICAgICBpZiAodGhpcy5vcHRpb25zLmV4dEluZm9Gb3JtYXR0ZXIpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMub3B0aW9ucy5leHRJbmZvRm9ybWF0dGVyKHsgYmluZGluZ0RhdGE6IHRoaXMuZHIucm93RGF0YSwgaW5zdGFuY2U6IGUuaW5zdGFuY2UgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gJyc7XHJcbiAgICB9XHJcbn1cclxuIl19
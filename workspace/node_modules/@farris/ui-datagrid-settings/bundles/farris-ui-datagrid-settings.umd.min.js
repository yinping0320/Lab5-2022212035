!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("rxjs/operators"),require("rxjs"),require("@angular/core"),require("@farris/ui-modal"),require("@farris/ui-messager"),require("@farris/ui-locale"),require("@angular/forms"),require("@farris/ui-treetable"),require("@farris/ui-notify"),require("@farris/ui-datagrid"),require("lodash-es"),require("@farris/ui-common"),require("@farris/ui-multi-select"),require("@angular/common"),require("@farris/ui-combo-list"),require("@farris/ui-switch"),require("@farris/ui-tooltip"),require("@farris/ui-organization-selector"),require("@farris/smooth-dnd"),require("@farris/ui-language-textbox")):"function"==typeof define&&define.amd?define("@farris/ui-datagrid-settings",["exports","rxjs/operators","rxjs","@angular/core","@farris/ui-modal","@farris/ui-messager","@farris/ui-locale","@angular/forms","@farris/ui-treetable","@farris/ui-notify","@farris/ui-datagrid","lodash-es","@farris/ui-common","@farris/ui-multi-select","@angular/common","@farris/ui-combo-list","@farris/ui-switch","@farris/ui-tooltip","@farris/ui-organization-selector","@farris/smooth-dnd","@farris/ui-language-textbox"],t):t(((e=e||self).farris=e.farris||{},e.farris["ui-datagrid-settings"]={}),e.rxjs.operators,e.rxjs,e.ng.core,e.uiModal,e.uiMessager,e.uiLocale,e.ng.forms,e.uiTreetable,e.uiNotify,e.uiDatagrid,e.lodashEs,e.uiCommon,e.uiMultiSelect,e.ng.common,e.uiComboList,e.uiSwitch,e.uiTooltip,e.uiOrganizationSelector,e.smoothDnd,e.uiLanguageTextbox)}(this,function(e,t,n,i,r,s,o,l,a,c,u,d,h,p,f,m,g,v,y,b,S){"use strict";var C=function(){return(C=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};function w(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var i,r,s=n.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(i=s.next()).done;)o.push(i.value)}catch(l){r={error:l}}finally{try{i&&!i.done&&(n=s["return"])&&n.call(s)}finally{if(r)throw r.error}}return o}function I(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(w(arguments[t]));return e}var x=function(){function e(){this.label="表头名称",this.placeholder="输入表头名称"}return e.prototype.ngOnInit=function(){},e.decorators=[{type:i.Component,args:[{selector:"group-header-form",template:'\n    <div class="d-flex flex-row" style="align-items: center;height: 100%;">\n        <span style="width: 90px;text-align: right;">{{label}}</span>\n        <input #txt placeholder="{{placeholder}}" type="text" [(ngModel)]="title" class="form-control ml-2" style="width: 210px">\n    </div>\n    '}]}],e.ctorParameters=function(){return[]},e.propDecorators={label:[{type:i.Input}],title:[{type:i.Input}],placeholder:[{type:i.Input}],input:[{type:i.ViewChild,args:["txt"]}]},e}(),F=function(){function e(){this.data=[],this.checkedItems=[],this.selectedIds=[]}return e.prototype.ngOnInit=function(){this.selectedIds=(this.checkedItems||[]).map(function(e){return e.id}),this.data&&this.data.forEach(function(e){e.id||(e.id=e.field)})},e.decorators=[{type:i.Component,args:[{selector:"set-columns",template:'<multi-select [dataSource]="data"\r\n[idField]="\'id\'" [valueField]="\'field\'" [textField]="\'title\'" [displayType]="\'List\'"\r\n[enableTargetSort]="true" [showCheckbox]="true" [enableMoveMore]="true" [(selectedId)]="selectedIds">\r\n</multi-select>'}]}],e.ctorParameters=function(){return[]},e.propDecorators={data:[{type:i.Input}],checkedItems:[{type:i.Input}]},e}();function D(e){e.id=e.id||e.field,e.colspan&&e.colspan>1&&(e.groupHeader=!0,e.id="groupHeader_"+e.id)}function H(e){var t=[];return e[0].filter(function(e){return"_datagrid-setting-control_"!==e.field}).forEach(function(e){D(e);var n={data:e,children:[],level:0,expanded:!0,visible:!0};t.push(n)}),t.forEach(function(t){!function n(e,t){if(e.data.colspan&&t[e.level+1]&&t[e.level+1].length){var i=0;do{var r=t[e.level+1].splice(0,1)[0];i+=r.colspan||1,D(r);var s={data:r,children:[],level:e.level+1,expanded:!0,visible:!0};e.children.push(s),r.colspan&&r.colspan>1&&n(s,t)}while(i<e.data.colspan&&t[e.level+1].length)}}(t,e)}),t}var k=function(e){var t=e.dfs._state.initialOptions,n={viewColumns:[],columnFormat:[]};if(t.sort){var i=t.sort.sortOrder?t.sort.sortOrder.split(","):[],r=t.sort.sortName?t.sort.sortName.split(","):[];n.sortInfo={sortName:r,sortOrder:i}}else n.sortInfo={};return n.groupField=t.groupField?t.groupField.split(","):[],n.expandGroupRows=!!t.expandGroupRows,n.multiHeaders={treeData:null,viewCols:[]},{settings:n,multiHeaderOptions:{columns:t.groupHeaderFields,treeData:null}}};function E(e,t){if(e&&t){var n=d.flatten(t.designerColumns);return d.cloneDeep(e).map(function(e){return e.map(function(e){if((!e.field||e.field.indexOf("farris-datagrid-column_")>-1)&&(e.filter=!1),!e.colspan||1===e.colspan){var t=n.find(function(t){return t.field===e.field||t.field===e.id});if(t){var i=Object.assign({},t,e);return e.colspan||delete i.colspan,i.rowspan||delete i.rowspan,i}}return e}).filter(function(e){return e})})}}function _(e,t){if(t&&Object.keys(t).length){var n=t.sortName,i=t.sortOrder;n&&n.length&&e.forEach(function(e){e.forEach(function(e){var t=n.indexOf(e.field);t>-1?(e.sortable=!0,e.order=i[t]||"asc"):e.order=""})})}}function O(e){return!(!e||!e.length)&&d.flatten(e).filter(function(e){return e.field&&(!e.colspan||1===e.colspan)}).length}function R(e){return d.flatten(e).filter(function(e){return e.field&&(!e.colspan||1===e.colspan)})}var T=function(){function e(e,t,r,s,l,a,c){var u=this;this.injector=e,this.ngzone=t,this.cd=r,this.render=s,this.modalService=l,this.el=a,this.notitySer=c,this.options={},this.inModal=!1,this.nodeSelected=new i.EventEmitter,this.fields=[],this.treecols=[],this.treeData=[],this.contextMenus=[],this.HOU_XUAN_LIE_ID="__HOU_XUAN_LIE_ID__",this.GROUP_HEADER_ICON="f-icon f-icon-file-folder-close",this.Hou_Xuan_Qu={id:this.HOU_XUAN_LIE_ID,title:"(候选列)",houxuanquNode:!0},this.languageRes={title:"多表头",preview:"预览效果",tips:"在（候选列）中的字段，将不在列表中显示; 点击字段名称，在右侧显示相关操作按钮。",contextMenus:{"new":"新建表头",newChild:"新建子级表头",setDataField:"分配数据列",rename:"重命名",top:"置顶",up:"上移",down:"下移",bottom:"置底",cancelGroup:"取消分组",remove:"在分组内移除"},candidate:"(候选列)",setHeader:"设为表头",ok:"确定",cancel:"取消",required:"请输入表头名称！",defaultGroupHeaderName:"分组表头1",newHeaderPlaceholder:"请输入名称",newHeaderLabel:"表头名称"},this.localeSer=null,this.moveMenuItemVisiblily=function(e){if(e){var t=e.node.data;return!t||t.id!=u.HOU_XUAN_LIE_ID}return!0},this.isGroupHeader=function(e){if(e){var t=e.node.data;return!t||!!t.groupHeader}return!0},this.onBeforeShowContextMenu=function(e){return e&&e.data.parents.indexOf(u.HOU_XUAN_LIE_ID)>-1?n.of({show:!1}):n.of({show:!0})},this.localeSer=this.injector.get(o.LocaleService,null)}return e.prototype.ngOnInit=function(){var e=this,t=this.dg.dfs._state.initialOptions.groupHeaderFields,n=d.flatten(t).filter(function(e){return!e.colspan||1==e.colspan});this.fields=n.filter(function(t){return t.field&&t.field!==e.dg.ControlPanelFeild}),this.treecols=[{field:"title",title:"名称",template:this.cellTemp}],this.languageRes=this.localeSer.getValue("headerGroup"),this.Hou_Xuan_Qu.title=this.languageRes.candidate,this.initTreeData(),this.initTreenodeContextMenus(),this.listenTreeTableEvent()},e.prototype.ngOnChanges=function(e){e.options&&!e.options.isFirstChange()&&(this.initTreeData(),this.tt.clearSelections())},e.prototype.ngAfterViewInit=function(){},e.prototype.ngOnDestroy=function(){},e.prototype.listenTreeTableEvent=function(){var e=this;this.tt.removed.subscribe(function(t){if(t&&t.parent&&(t.parent.leaf=!(t.parent.children&&t.parent.children.length),t.parent.leaf&&(t.parent.icon=e.GROUP_HEADER_ICON)),!t.node.data.groupHeader){var n=e.getHouXuanNode();t.parent||(e.treeData=e.treeData.filter(function(e){return e.data.id!==t.id})),e.tt.append(t.node.data,n.node)}})},e.prototype.initTreenodeContextMenus=function(){var e=this;this.contextMenus=[{id:1,title:this.languageRes.contextMenus["new"],icon:"f-icon f-icon-add",handle:function(t){e.addNewGroup(t.data,!1)}},{id:2,title:this.languageRes.contextMenus.newChild,visible:function(t){return e.isGroupHeader(t.data)&&t.data.level+1<e.dg.maxMultiHeaders-1},handle:function(t){e.addNewGroup(t.data,!0)}},{id:3,title:this.languageRes.contextMenus.setDataField,visible:function(t){return e.isGroupHeader(t.data)},handle:function(t){e.setColumnsForGroupHeader(null,t.data)}},{id:31,title:this.languageRes.contextMenus.rename,icon:"f-icon f-icon-edit",handle:function(t){e.resetHeaderName(null,t.data)}},"-",{id:4,title:this.languageRes.contextMenus.top,icon:"f-icon f-icon-roofing",visible:function(t){return e.moveMenuItemVisiblily(t.data)},handle:function(t){e.moveTop(null,t.data)}},{id:5,title:this.languageRes.contextMenus.up,icon:"f-icon f-icon-arrow-chevron-up",visible:function(t){return e.moveMenuItemVisiblily(t.data)},handle:function(t){e.moveUp(null,t.data)}},{id:6,title:this.languageRes.contextMenus.down,icon:"f-icon f-icon-arrow-chevron-down",visible:function(t){return e.moveMenuItemVisiblily(t.data)},handle:function(t){e.moveDown(null,t.data)}},{id:7,title:this.languageRes.contextMenus.bottom,icon:"f-icon f-icon-bottomsetting",visible:function(t){return e.moveMenuItemVisiblily(t.data)},handle:function(t){e.moveBottom(null,t.data)}},"-",{id:8,title:this.languageRes.contextMenus.remove,icon:"f-icon f-icon-minus",visible:function(e){return!e.data.node.data.houxuanquNode&&!e.data.node.data.groupHeader},handle:function(t){e.tt.remove(t.data.id)}},{id:9,title:this.languageRes.contextMenus.cancelGroup,icon:"f-icon f-icon-x",visible:function(e){return e.data.node.data.groupHeader},handle:function(t){e.removeGroup(null,t.data)}}]},e.prototype.initTreeData=function(){var e=this;if(this.options){var t=this.options.treeData;if(t)return void(this.treeData=t)}if(this.options.columns&&this.options.columns.length>1){var n=H(d.cloneDeep(this.options.columns)),i=this.fields.filter(function(t){return!d.flatten(e.options.columns).find(function(e){return e.field===t.field})}).map(function(e){return{data:e,children:[],visible:!0}});n.push({data:this.Hou_Xuan_Qu,children:i,expanded:!0}),this.treeData=n}else this.treeData=[{data:{id:"groupHeader_1",title:this.languageRes.defaultGroupHeaderName,halign:"left",groupHeader:!0},children:this.fields.map(function(e,t){return e.index=t,e.id=e.field,{data:e,children:[],visible:!0}}),icon:this.GROUP_HEADER_ICON,expanded:!0,visible:!0},{data:this.Hou_Xuan_Qu,children:[],expanded:!0,icon:this.GROUP_HEADER_ICON}]},e.prototype.getHouXuanNode=function(){return this.tt.findRowNode(this.HOU_XUAN_LIE_ID)},e.prototype.onTreeSelected=function(e){this.nodeSelected.emit(e)},e.prototype.showNewHeaderDialog=function(e,t){var n=this.modalService.show(x,{title:t,width:340,height:190,showMaxButton:!1,resizable:!1,initialState:{title:"",placeholder:this.languageRes.newHeaderPlaceholder,label:this.languageRes.newHeaderLabel},buttons:[{text:this.languageRes.cancel,cls:"btn btn-secondary",handle:function(){n.close()}},{text:this.languageRes.ok,cls:"btn btn-primary",handle:e}]});return n},e.prototype.generateGroupHeaderId=function(){return"groupHeader_"+(new Date).getTime()},e.prototype.createNewGroupHeader=function(e,t,n){void 0===n&&(n=!1);var i={data:{id:this.generateGroupHeaderId(),title:t,groupHeader:!0,halign:"left",fixed:"UNFIXED"},children:[],expanded:!0,visible:!0,icon:this.GROUP_HEADER_ICON};if(n)i.data.fixed=e.node.data.fixed,this.tt.appendChildren([i],e.node);else if(e.parent)i.data.fixed=e.parent.data.fixed,this.tt.appendChildren([i],e.parent);else{var r=this.treeData.findIndex(function(t){return t.data.id===e.id})+1;this.treeData.splice(r,0,i),this.treeData=this.treeData.slice()}},e.prototype.removeGroup=function(e,t){this.tt.selectedRow&&t.id===this.tt.selectedRow.id&&this.nodeSelected.emit(null);var n=this.tt.serializedValue.filter(function(e){return e.parents.indexOf(t.id)>-1&&!e.node.data.groupHeader}).map(function(e){return e.node});this.treeData=this.treeData.filter(function(e){return e.data.id!==t.id}),this.tt.remove(t.id),this.tt.appendChildren(n,this.getHouXuanNode().node)},e.prototype.addNewGroup=function(e,t){var n=this;void 0===t&&(t=!1);var i=this.showNewHeaderDialog(function(){var r=i.content;r.title?(e&&e.id!==n.HOU_XUAN_LIE_ID?n.createNewGroupHeader(e,r.title,t):(n.treeData.splice(0,0,{data:{id:n.generateGroupHeaderId(),halign:"left",title:r.title,groupHeader:!0,fixed:"UNFIXED"},icon:n.GROUP_HEADER_ICON,children:[]}),n.tt.updateSerializedValue()),i.close()):(n.notitySer.info(n.languageRes.required),r.input.nativeElement.focus())},t?this.languageRes.contextMenus.newChild:this.languageRes.contextMenus["new"])},e.prototype.onMoreBtnClick=function(e,t){t&&t.id&&this.tt.selectNode(t.id),this.tt.ctxMenu.onContextMenu(e)},e.prototype.getCanSelectColumns=function(e){var t=this.getHouXuanNode(),n=e?e.node.children:[];return n=n.filter(function(e){return!e.data.groupHeader}),t.node.children.concat(n).map(function(e){return e.data})},e.prototype.showSetColumnsDialog=function(e,t,n){var i=this.modalService.show(F,{title:this.languageRes.contextMenus.setDataField,width:600,height:500,showMaxButton:!1,resizable:!1,initialState:{data:this.getCanSelectColumns(n),checkedItems:t,groupEditorRef:this},buttons:[{text:this.languageRes.cancel,cls:"btn btn-secondary",handle:function(){i.close()}},{text:this.languageRes.ok,cls:"btn btn-primary",handle:function(){e(i.content.selectedIds)}}]});return i},e.prototype.setColumnsForGroupHeader=function(e,t){var n=this,i=t&&t.node.children?t.node.children.map(function(e){return e.data}):[],r=this.showSetColumnsDialog(function(e){var i=e.map(function(e){return n.fields.find(function(t){return t.field==e})}).filter(function(e){return e}),s=n.getHouXuanNode();s.node.children=(s.node.children||[]).filter(function(e){return-1===i.findIndex(function(t){return t.field==e.id})});var o=(t.node.children||[]).filter(function(e){return!e.data.groupHeader&&-1==i.findIndex(function(t){return t.field===e.id})}).filter(function(e){return e});o&&o.length&&o.forEach(function(e){n.tt.remove(e.id)});var l=i.filter(function(e){return-1===(t.node.children||[]).findIndex(function(t){return t.id===e.field})}).map(function(e){return e.id||(e.id=e.field),e});l&&l.length&&(l.forEach(function(e){var i=n.fields.find(function(t){return t.field==e.field});i&&(i.fixed=t.node.data.fixed)}),n.tt.appendChildren(l.map(function(e){return{data:e,children:[],expanded:!0}}),t.node),n.tt.expandNode(t.id));var a=o.map(function(e){return{data:e.data,children:[]}});n.tt.appendChildren(a,s.node),r.close()},i,t)},e.prototype.setColumnHeader=function(e,t){var n=this.treeData.length-1;this.treeData.splice(n,0,{data:t,children:[]});var i=this.getHouXuanNode();i&&(i.node.children=i.node.children.filter(function(e){return e.data.id!==t.id}),i.node.leaf=!(i.node.children&&i.node.children.length),i.node.leaf&&(i.node.icon=this.GROUP_HEADER_ICON),this.tt.clearSelections(),this.tt.updateSerializedValue(),this.tt.selectNode(t.id,!0))},e.prototype.moveUp=function(e,t){var n=this.treeData;t.parent&&(n=t.parent.children);var i=n.findIndex(function(e){return e.data.id===t.id});if(0!==i){var r=n.splice(i,1);n.splice.apply(n,I([i-1,0],r)),this.tt.updateSerializedValue()}},e.prototype.moveDown=function(e,t){var n=this.treeData;t.parent&&(n=t.parent.children);var i=n.findIndex(function(e){return e.data.id===t.id});if(i!==n.length-2){var r=n.splice(i,1);n.splice.apply(n,I([i+1,0],r)),this.tt.updateSerializedValue()}else this.moveBottom(e,t)},e.prototype.moveTop=function(e,t){var n=this.treeData;t.parent&&(n=t.parent.children);var i=n.findIndex(function(e){return e.data.id===t.id});n.unshift(t.node),n.splice(i+1,1),this.tt.updateSerializedValue()},e.prototype.moveBottom=function(e,t){var n=this.treeData;t.parent&&(n=t.parent.children);var i=n.findIndex(function(e){return e.data.id===t.id});n.push(t.node),n.splice(i,1),t.parent?this.tt.updateSerializedValue():this.moveUp(e,t)},e.prototype.getPreviewGroupColumns=function(){var e=this.getAllNodes();return this.convert2Array(e)},e.prototype.getHouXuanFields=function(){var e=this.treeData.find(function(e){return e.data.houxuanquNode});return e?e.children:[]},e.prototype.getAllNodes=function(){var e=this.getHouXuanFields();return this.tt.serializedValue.filter(function(t){return!t.node.data.houxuanquNode&&-1===e.findIndex(function(e){return e.data.id===t.id})})},e.prototype.convert2Array=function(e){var t,n,i=this,r=[],s=(t=e,n=function(e){return e.level},Math.max.apply(Math,I(t.map("function"==typeof n?n:function(e){return e[n]})))),o=(e=e.filter(function(e){return e.node.children&&e.node.children.length&&e.node.data.groupHeader||!e.node.data.groupHeader})).filter(function(e){return!e.parent});if(!o.filter(function(e){return!e.node.data.fixed||"UNFIXED"===e.node.data.fixed}).length){var l=o.filter(function(e){return"left"===e.node.data.fixed}),a=o.filter(function(e){return"right"===e.node.data.fixed});l.length==o.length||a.length==o.length?e.forEach(function(e){o.find(function(t){return t.id===e.id})&&(e.node.data.fixed="")}):1===a.length?l.forEach(function(t){e.forEach(function(e){t.id===e.id&&(e.node.data.fixed="")})}):a.forEach(function(t){e.forEach(function(e){t.id===e.id&&(e.node.data.fixed="")})})}for(var c=function(t){r.push(e.filter(function(e){return e.level===t}).map(function(t){var n=t.node.data,r=t.parent?i.tt.getRoot(t.id).node.data.fixed:n.fixed||"",o=(t.node.children?e.filter(function(e){return e.parents.indexOf(t.id)>-1&&-1==e.id.indexOf("groupHeader_")}).length:1)||1,l=t.node.children&&t.node.children.length>0?1:s-t.level+1,a={field:n.field,title:n.title,sortable:n.sortable,order:n.order,halign:n.halign||"left",align:n.align||"left",visible:!0,allowGrouping:n.allowGrouping,groupFooter:n.groupFooter,footer:n.footer,width:n.size?n.size.width:100,dataType:n.dataType||"string",fixed:"UNFIXED"===r?"":r,id:t.id,parentId:t.node.parent?t.node.parent.id:null,rowspan:l,colspan:o},c={field:n.field,title:n.title,halign:n.halign||"left",align:n.align||"left",visible:!0,groupFooter:{},footer:{},width:n.size?n.size.width:100,dataType:n.dataType||"string",fixed:"UNFIXED"===r?"":r,id:t.id,parentId:t.node.parent?t.node.parent.id:null,rowspan:l,colspan:o};return t.node.data.groupHeader?c:a}))},u=0;u<=s;u++)c(u);return r},e.prototype.clearTreeNodesData=function(e){var t=this;e.forEach(function(e){delete e.parent,delete e.elementRef,e.children&&e.children.length&&t.clearTreeNodesData(e.children)})},e.prototype.getSettings=function(){return this.clearTreeNodesData(this.treeData),{viewCols:this.getPreviewGroupColumns(),treeData:this.treeData}},e.prototype.hiddenCol=function(e,t){e.stopPropagation(),this.tt.selectedRow&&t===this.tt.selectedRow.id&&(this.tt.clearSelections(),this.nodeSelected.emit(null)),this.tt.remove(t)},e.prototype.resetHeaderName=function(e,t){var n=this,i=this.showNewHeaderDialog(function(){var e=i.content;e.title?(t.node.data.title=e.title,i.close()):(n.notitySer.info(n.languageRes.required),e.input.nativeElement.focus())},this.languageRes.contextMenus.rename);i.content.title=t.node.data.title},e.decorators=[{type:i.Component,args:[{selector:"column-tree",template:'<farris-treetable #tt [data]="treeData" [columns]="treecols"\r\n        [idField]="\'id\'" [striped]="false" [showBorder]="false"\r\n        [singleSelect]="true" [showIcon]="true" [showFilterBar]="false" [selectOnCheck]="true" [checkOnSelect]="true"\r\n        [fixedHeader]="false" [fit] ="false" [showHeader]="false"\r\n        [collapseIcon]="\'f-icon f-icon-file-folder-close\'" [expandIcon]="\'f-icon f-icon-file-folder-open\'"\r\n        [enableContextMenu]="true" [contextMenuItems]="contextMenus" [dblClickExpand]="false" [beforeShowContextMenu]="onBeforeShowContextMenu"\r\n        (nodeSelected)="onTreeSelected($event)"\r\n></farris-treetable>\r\n<ng-template #nodeTemplate let-ctx>\r\n    <div class="d-flex flex-row multi-headers-toolbars" id="{{ ctx.rowData[\'id\'] }}">\r\n        <div class="f-utils-fill">{{ctx.rowData[\'title\']}}</div>\r\n        <div class="d-flex align-items-center multi-headers-toolbars-buttons hide" [class.show]="tt.selectValue === ctx.rowData[\'id\']">\r\n            \r\n            <button class="btn btn-link d-flex align-items-center more treenode-more-btn" \r\n                *ngIf="ctx.rowData[\'id\'] !== \'__HOU_XUAN_LIE_ID__\' && isGroupHeader(ctx.rowNode)" title="{{languageRes.contextMenus.cancelGroup}}"\r\n                (click)="removeGroup($event, ctx.rowNode);">\r\n                <span class="f-icon f-icon-x"></span>\r\n            </button>\r\n            <button class="btn btn-link d-flex align-items-center more treenode-more-btn" \r\n                *ngIf="ctx.rowData[\'id\'] !== \'__HOU_XUAN_LIE_ID__\' && ctx.rowNode.parents && ctx.rowNode.parents[0] !== \'__HOU_XUAN_LIE_ID__\' && !isGroupHeader(ctx.rowNode)"\r\n                 title="{{languageRes.contextMenus.remove}}"\r\n                (click)="hiddenCol($event,ctx.rowNode.id)">\r\n                <span class="f-icon f-icon-x"></span>\r\n            </button>\r\n            \r\n            <button class="btn btn-link mr-0 d-flex align-items-center more treenode-more-btn" \r\n                *ngIf="ctx.rowData[\'id\'] !== \'__HOU_XUAN_LIE_ID__\' && ctx.rowNode.parents && ctx.rowNode.parents[0] !== \'__HOU_XUAN_LIE_ID__\'" title=""\r\n                (click)="onMoreBtnClick($event, ctx.rowData)">\r\n                <span class="f-icon f-icon-more-horizontal"></span>\r\n            </button>\r\n            <button class="btn btn-link mr-0 d-flex align-items-center more treenode-more-btn" title="{{languageRes.contextMenus.new}}" \r\n                *ngIf="ctx.rowData[\'id\'] === \'__HOU_XUAN_LIE_ID__\'"\r\n                (click)="addNewGroup(null, !1)">\r\n                <span class="f-icon f-icon-plus-circle font16 t-2"></span>\r\n            </button>\r\n\r\n            <button class="btn btn-link mr-0 d-flex align-items-center more treenode-more-btn" \r\n                *ngIf="ctx.rowNode.parents && ctx.rowNode.parents[0] === \'__HOU_XUAN_LIE_ID__\'" title="{{languageRes.setHeader}}"\r\n                (click)="setColumnHeader($event, ctx.rowData)">\r\n                <span class="f-icon f-icon-add"></span>\r\n            </button>\r\n        </div>\r\n    </div>\r\n\r\n</ng-template>',exportAs:"groupHeaderTree",encapsulation:i.ViewEncapsulation.None,styles:[".multi-headers-toolbars .multi-headers-toolbars-buttons{margin-right:-11px}.multi-headers-toolbars .multi-headers-toolbars-buttons.hide{display:none!important}.multi-headers-toolbars .multi-headers-toolbars-buttons.show{display:flex!important}.multi-headers-toolbars .multi-headers-toolbars-buttons button.more{height:26px;width:26px;background:0 0;border-radius:0;border:0;padding:2px}.multi-headers-toolbars .multi-headers-toolbars-buttons button.more .f-icon{font-size:14px;position:relative;left:3px}.multi-headers-toolbars .multi-headers-toolbars-buttons .font16{font-size:16px}.multi-headers-toolbars:hover .multi-headers-toolbars-buttons,.table-hover tbody tr:hover .multi-headers-toolbars .multi-headers-toolbars-buttons{display:flex!important}"]}]}],e.ctorParameters=function(){return[{type:i.Injector},{type:i.NgZone},{type:i.ChangeDetectorRef},{type:i.Renderer2},{type:r.BsModalService},{type:i.ElementRef},{type:c.NotifyService}]},e.propDecorators={dg:[{type:i.Input}],options:[{type:i.Input}],inModal:[{type:i.Input}],nodeSelected:[{type:i.Output}],cellTemp:[{type:i.ViewChild,args:["nodeTemplate"]}],tt:[{type:i.ViewChild,args:["tt"]}]},e}(),M=function(){function e(e,t,n){this.injector=e,this.gridSettingComponentRef=t,this.cd=n,this.columns=[],this.fields=[],this.formatChange=new i.EventEmitter,this.fieldsChange=new i.EventEmitter,this.allCols=[],this.formatData=[],this.columnType="all",this.activeField=null,this.showGridFooter=!1,this.searchItems=[],this.alignItems=[],this.summaryItems=[],this.summaryItems2=[],this.fixedItems=[],this.isEn=!1,this.switchValue=!1,this._searchResult={checkAll:!1,unCheckAll:!1},this.multiHeaderOptions={},this.enableMultipleHeaders=!1,this.selectTreeNode=null,this.showGridFooter=this.gridSettingComponentRef.gridInstance.showFooter&&!this.gridSettingComponentRef.gridInstance.footerTemplate,this.localeSer=this.injector.get(o.LocaleService,null)}return Object.defineProperty(e.prototype,"isShowfixed",{get:function(){if(this.groupHeadersRef&&this.selectTreeNode&&"__HOU_XUAN_LIE_ID__"!==this.selectTreeNode.id){var e=this.groupHeadersRef.tt.findRowNode(this.selectTreeNode.id);return e&&!e.level}return!0},enumerable:!0,configurable:!0}),e.prototype.ngOnChanges=function(e){e.columns&&!e.columns.isFirstChange()&&(this.setFormatData(),this.allCols=this.columns[0],this.setActiveField(),this.checkColumnOptions(),this._searchResult=this.seachResultIsCheckAll()),e.multiHeaderOptions&&!e.multiHeaderOptions.isFirstChange()&&this.setActiveField()},e.prototype.ngOnInit=function(){this.isEn="en"===this.localeSer.localeId,this.initData()},e.prototype.ngAfterViewInit=function(){var e=this;this.setActiveField(),setTimeout(function(){e.colForm&&e.colForm.valueChanges.subscribe(function(t){e.formatChange.emit(e.formatData)})},50)},e.prototype.setActiveField=function(){var e=this;setTimeout(function(){if(e.enableMultipleHeaders&&e.multiHeaderOptions){var t=e.multiHeaderOptions.columns;t&&t.length?e.groupHeadersRef.tt.selectFirstNode():e.activeField=null}else e.activeField=e.columns[0][0]})},e.prototype.setFormatData=function(){this.formatData=this.columns[0]},e.prototype.initData=function(){this.alignItems=this.gridSettingComponentRef.alignItems,this.searchItems=this.gridSettingComponentRef.searchItems,this.summaryItems=this.gridSettingComponentRef.summaryItems,this.summaryItems2=this.gridSettingComponentRef.summaryItems2,this.fixedItems=this.gridSettingComponentRef.fixedItems,this.setFormatData(),this.allCols=this.columns[0],this.checkColumnOptions(),this.filterColumns()},e.prototype.checkColumnOptions=function(){this.activeField&&(this.activeField.allowGrouping===undefined&&(this.activeField.allowGrouping=!0),this.activeField.groupFooter===undefined?this.activeField.groupFooter={options:{calculationType:-1}}:(this.activeField.groupFooter.options=this.activeField.groupFooter.options||{calculationType:-1},this.activeField.groupFooter.options.calculationType===undefined&&(this.activeField.groupFooter.options.calculationType=-1)),this.activeField.footer===undefined?this.activeField.footer={options:{calculationType:-1}}:(this.activeField.footer.options=this.activeField.footer.options||{calculationType:-1},this.activeField.footer.options.calculationType===undefined&&(this.activeField.footer.options.calculationType=-1)),(!this.activeField.fixed||"left"!==this.activeField.fixed&&"right"!==this.activeField.fixed)&&(this.activeField.fixed="UNFIXED"))},e.prototype.filterColumns=function(e){var t=this;void 0===e&&(e="");var n=[];n=this.switchValue?this.columns[0].filter(function(e){return t.fields.indexOf(e.field)>-1}):this.columns[0],e&&(n=n.filter(function(t){return t.title.toLowerCase().indexOf(e)>-1})),this.allCols=n,this._searchResult=this.seachResultIsCheckAll(this.allCols.filter(function(e){return e.visible}))},e.prototype.seachResultIsCheckAll=function(e){var t=this.allCols.filter(function(e){return"_datagrid-setting-control_"!=e.field}).length,n=this.fields.filter(function(e){return"_datagrid-setting-control_"!=e}).length;return e&&(n=e.length),{checkAll:t&&t===n,unCheckAll:e?!n:!this.fields.length}},e.prototype.onFieldClick=function(e,t){this.activeField=e,this.checkColumnOptions()},e.prototype.onFieldsChanged=function(){this.setFormatData(),this.fieldsChange.emit(this.fields)},e.prototype.onDblClick=function(e,t){e.target.style.userSelect="none",this.onCheckboxClick(e,t),e.target.style.userSelect=""},e.prototype.onCheckboxClick=function(e,t){var n=this;e.stopPropagation();var i=this.fields.indexOf(t.field);-1===i?this.fields.push(t.field):this.fields.splice(i,1),this.columns[0].forEach(function(e){e.visible=n.fields.indexOf(e.field)>-1}),this.fields=this.columns[0].filter(function(e){return e.visible}).map(function(e){return e.field});var r=this.allCols.filter(function(e){return e.visible}).map(function(e){return e.field});this._searchResult=this.seachResultIsCheckAll(r),this.onFieldsChanged()},e.prototype.searchColumn=function(e){this.switchValue=!1;var t=e.target.value;this.filterColumns(t)},e.prototype.onFieldDrop=function(e,t,n){var i,r=e.removedIndex,s=e.addedIndex,o=this.allCols[r],l=this.allCols[s],a=this.columns[0].findIndex(function(e){return e.field===o.field}),c=this.columns[0].findIndex(function(e){return e.field===l.field}),u=this.columns[0].splice(a,1);(i=this.columns[0]).splice.apply(i,I([c,0],u)),this.fields=this.columns[0].filter(function(e){return e.visible}).map(function(e){return e.field}),this.onFieldsChanged(),this.filterColumns(t)},e.prototype.getCheckAllState=function(e){if(void 0===e&&(e=!1),0===this.fields.length)return 0;if(e){if(this._searchResult.checkAll)return 1}else if(this.fields.length===this.columns[0].length)return 1;return 2},e.prototype.onCheckAllClick=function(e,t){var n=this;if(this.allCols&&this.allCols.length){var i=this.getCheckAllState(t),r=0===i||2===i,s=null;""==t?r?(this.columns[0].forEach(function(e){return e.visible=!0}),this.fields=this.columns[0].map(function(e){return e.field})):(this.columns[0].forEach(function(e){return e.visible=!1}),this.fields=[]):(this.allCols.forEach(function(e){n.columns[0].find(function(t){return e.field===t.field}).visible=r,e.visible=r}),s=this.allCols.filter(function(e){return e.visible}).map(function(e){return e.field}),this.fields=this.columns[0].filter(function(e){return e.visible}).map(function(e){return e.field})),this._searchResult=this.seachResultIsCheckAll(t?s:null),this.cd.detectChanges(),this.onFieldsChanged()}},e.prototype.onlySeeVisibleColumns=function(e,t){this.switchValue=e,this.filterColumns(t)},e.prototype.clearSearch=function(e,t){t&&t.value&&(this.filterColumns(""),t.value="")},e.prototype.onNodeSelected=function(e){e&&"__HOU_XUAN_LIE_ID__"!==e.node.id?(this.activeField=e.node.data,this.selectTreeNode=e.node,this.checkColumnOptions()):(this.activeField=null,this.selectTreeNode=null)},e.prototype.getMultiHeaders=function(){return this.groupHeadersRef?this.groupHeadersRef.getSettings():null},e.decorators=[{type:i.Component,args:[{selector:"column-format-setting",template:'<div class="d-flex flex-row flex-fill dg-column-format-setting" style="height: 100%">\r\n    <div region="west" class="west d-flex flex-column " *ngIf="!enableMultipleHeaders">\r\n        <div style="margin: 0 6px;">\r\n\r\n            <div class="input-group mb-2 scheme-manager__search-box">\r\n                <input #inputWord type="text" class="form-control" placeholder="{{\'datagrid.settings.searchPlaceholder\' | locale}}" (input)="searchColumn($event)" style="height: 30px;">\r\n                <div  class="input-group-append" style="cursor: pointer">\r\n                    <span  class="f-icon f-icon-search" [class.f-icon-close]="inputWord.value" (click)="clearSearch($event, inputWord)"></span>\r\n                </div>\r\n            </div>\r\n            <div style="padding: 5px 0px;background-color: #fff;justify-content: space-between;align-items: center;" class="d-flex flex-row">\r\n                <button class="btn btn-link" style="height: 32px;padding-left: 4px;" [disabled]="!(allCols && allCols.length)" (click)="onCheckAllClick($event, inputWord.value)">\r\n                    <span class="f-icon f-icon-minus-outline checkbox" \r\n                    [class.f-icon-checkbox]="_searchResult.unCheckAll" \r\n                    [class.f-icon-checkbox-checked]="_searchResult.checkAll "></span>\r\n                    {{ \'datagrid.settings.checkall\' | locale }}\r\n                </button>\r\n\r\n                <div [class.d-flex]="!inputWord.value"  class="flex-row" [style.display]="inputWord.value ? \'none\': \'\'" >{{\'datagrid-scheme.onlyshowcolumns\' | locale}} \r\n                    <farris-switch style="position: relative;\r\n                    top: 2px;\r\n                    margin-left: 5px;"\r\n                    id="only-visible-columns"\r\n                    [square]="false" [size]="\'small\'"\r\n                    [ngModel]="switchValue" \r\n                    (valueChange)="onlySeeVisibleColumns($event, inputWord.value)"\r\n                    ></farris-switch>\r\n                </div>\r\n            </div>\r\n        </div>\r\n        <div style="overflow: auto;padding-right:3px; cursor: pointer;" class="flex-fill">\r\n            <ul class="list-group  list-group-flush" #ul column-visible-drag (drop)="onFieldDrop($event, inputWord.value, ul)">\r\n                <li class="list-group-item list-group-item-action smooth-dnd-draggable-wrapper format-setting-column" *ngFor="let col of allCols" \r\n                    (click)="onFieldClick(col, $event)" [class.active]="activeField && activeField.field === col.field"\r\n                    f-dbl-click (dblClickHandler)="onDblClick($event, col)">\r\n                    <span class="f-icon checkbox"\r\n                        [class.f-icon-checkbox-checked]="fields.indexOf(col.field) > -1"\r\n                        [class.f-icon-checkbox]="fields.indexOf(col.field) == -1"\r\n                        (click)="onCheckboxClick($event, col)"></span>\r\n                    {{ col.title}} \r\n\r\n                    <span class="f-icon f-icon-drag-vertical field-drag-handle" *ngIf="!inputWord.value"></span>\r\n                </li>\r\n            </ul>\r\n        </div>\r\n    </div>\r\n\r\n    <div region="west" class="west d-flex flex-column " *ngIf="enableMultipleHeaders">\r\n        <div style="margin: 0 6px;" class="mb-2">\r\n            <div class="d-flex flex-row mb-2" style="align-items: center; height: 24px;">\r\n                <h5 class="count m-0" style="font-size: 18px;"> {{ \'headerGroup.title\' | locale }}</h5>\r\n                <div class="d-flex flex-row " style="align-items: center;justify-content: end;" [class.f-utils-fill]="enableMultipleHeaders">\r\n                    <button class="btn btn-link" style="height: 32px;padding-left: 4px;" [preview-headers]="gh" *ngIf="enableMultipleHeaders"> {{ \'headerGroup.preview\' | locale }}</button>\r\n                </div>\r\n            </div>\r\n\r\n            <div class="tip p-2" style="background: #f7faff; border-radius: 4px;" >\r\n                {{ \'headerGroup.tips\' | locale }}\r\n            </div>\r\n        </div>\r\n        <div style="overflow: auto;padding-right:3px; cursor: pointer;" class="flex-fill">\r\n            <column-tree #gh="groupHeaderTree" [dg]="gridSettingComponentRef?.gridInstance" [options]="multiHeaderOptions"\r\n             class="flex-fill d-flex pt-2" [inModal]="true" (nodeSelected)="onNodeSelected($event)"></column-tree>\r\n        </div>\r\n    </div>\r\n\r\n    <div region="center" class="center flex-fill" style="overflow:auto;padding: 0 10px; padding-left: 20px;border-right: 0;">\r\n\r\n        <h6 style="margin: 15px 0px;font-weight: bold;">{{ \'datagrid.settings.properties\' | locale }}</h6>\r\n\r\n        <form #colformatform="ngForm" style="margin-top: 5px;" *ngIf="activeField">\r\n            \x3c!-- 列标题 --\x3e\r\n            <div class="farris-group-wrap mb-3">\r\n                <div class="form-group farris-form-group">\r\n                    <label for="hpinput01" class="col-form-label">\r\n                        <span class="farris-label-text" >{{ \'datagrid-settings.column.title\' | locale }}</span>\r\n                    </label>\r\n                    <div class="farris-input-wrap">\r\n                        <input class="form-control" name="title" [(ngModel)]="activeField.title" type="text">\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            \x3c!-- 表头对齐 --\x3e\r\n            <div class="farris-group-wrap mb-3">\r\n                <div class="form-group farris-form-group">\r\n                    <label for="hpinput01" class="col-form-label">\r\n                        <span class="farris-label-text" >{{ \'datagrid.settings.headeralign\' | locale }}</span>\r\n                    </label>\r\n                    <div class="farris-input-wrap">\r\n                        <farris-combo-list name="halign" \r\n                        [data]="alignItems" \r\n                        [editable]="false"\r\n                        [(ngModel)]="activeField.halign"\r\n                        [idField]="\'value\'"\r\n                        [textField]="\'title\'"\r\n                        [enableClear]="false"></farris-combo-list>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            \x3c!-- 数据对齐 --\x3e\r\n            <div class="farris-group-wrap  mb-3" *ngIf="activeField && !activeField.groupHeader">\r\n                <div class="form-group farris-form-group">\r\n                    <label for="hpinput01" class="col-form-label">\r\n                        <span class="farris-label-text">{{ \'datagrid.settings.dataalign\' | locale }}</span>\r\n                    </label>\r\n                    <div class="farris-input-wrap">\r\n                        <farris-combo-list name="align" \r\n                        [data]="alignItems" \r\n                        [editable]="false"\r\n                        [(ngModel)]="activeField.align"\r\n                        [idField]="\'value\'"\r\n                        [textField]="\'title\'"\r\n                        [enableClear]="false"></farris-combo-list>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            \x3c!-- 是否固定 --\x3e\r\n            <div class="farris-group-wrap  mb-3" *ngIf="isShowfixed">\r\n                <div class="form-group farris-form-group">\r\n                    <label for="hpinput01" class="col-form-label">\r\n                        <span class="farris-label-text">{{ \'datagrid-settings.column.fixed\' | locale }}</span>\r\n                    </label>\r\n                    <div class="farris-input-wrap">\r\n                        <farris-combo-list name="fixed" \r\n                        [data]="fixedItems" \r\n                        [editable]="false"\r\n                        [(ngModel)]="activeField.fixed"\r\n                        [idField]="\'value\'"\r\n                        [textField]="\'title\'"\r\n                        [enableClear]="false"></farris-combo-list>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            \x3c!-- 合计 --\x3e\r\n            <div class="farris-group-wrap  mb-3" *ngIf="showGridFooter && activeField && !activeField.groupHeader" >\r\n                <div class="form-group farris-form-group">\r\n                    <label for="hpinput01" class="col-form-label">\r\n                        <span class="farris-label-text">{{ \'datagrid.settings.summarytype\' | locale }}</span>\r\n                    </label>\r\n                    <div class="farris-input-wrap ">\r\n                       \r\n                        <farris-combo-list name="footer.options.calculationType" \r\n                        [data]=" activeField.dataType === \'number\'?  summaryItems : summaryItems2 " \r\n                        [editable]="false"\r\n                        [(ngModel)]="activeField.footer.options.calculationType"\r\n                        [idField]="\'value\'"\r\n                        [textField]="\'title\'"\r\n                        [enableClear]="false"></farris-combo-list>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            <div class="farris-group-wrap  mb-3" *ngIf="activeField && !activeField.groupHeader && showGridFooter && ( \r\n                (!activeField.footer.options.calculationType && activeField.footer.options.calculationType != 0)  ||activeField.footer.options.calculationType == -1)">\r\n                <div class="form-group farris-form-group">\r\n                    <label for="hpinput01" class="col-form-label">\r\n                        <span class="farris-label-text">{{ \'datagrid.settings.summarytext\' | locale }}</span>\r\n                    </label>\r\n                    <div class="farris-input-wrap">\r\n                        <input type="input" name="footer.options.text" class="form-control" [(ngModel)]="activeField.footer.options.text">\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </form>\r\n    </div>\r\n   \r\n</div>',encapsulation:i.ViewEncapsulation.None}]}],e.ctorParameters=function(){return[{type:i.Injector},{type:N},{type:i.ChangeDetectorRef}]},e.propDecorators={columns:[{type:i.Input}],fields:[{type:i.Input}],colForm:[{type:i.ViewChild,args:["colformatform"]}],groupHeadersRef:[{type:i.ViewChild,args:["gh"]}],formatChange:[{type:i.Output}],fieldsChange:[{type:i.Output}],multiHeaderOptions:[{type:i.Input}],enableMultipleHeaders:[{type:i.Input}]},e}(),N=function(){function e(e,t){this.cd=e,this.inject=t,this.activeTabIndex=1,this.sortTreeData=[],this.sortNames=[],this.sortInfo={},this.viewColumns=[],this.columnFormat=[],this.groupField=[],this.expandGroupRows=!0,this.canSetColumnSort=!0,this.canSetColumnVisible=!0,this.enableReset=!1,this.cancelHandle=new i.EventEmitter,this.submitHandle=new i.EventEmitter,this.reset=new i.EventEmitter,this.concise=new i.EventEmitter,this.schemeInfo=null,this.searchItems=[],this.alignItems=[],this.summaryItems=[],this.summaryItems2=[],this.enableGroupFooter=!1,this.fixedItems=[],this.multiHeaders={},this.enableMultipleHeaders=!1,this.schemeName="",this.tabWidth=70,this.messager=this.inject.get(s.MessagerService,null),this.localeSer=this.inject.get(o.LocaleService),this.render2=this.inject.get(i.Renderer2,null),this.notifySer=this.inject.get(c.NotifyService,null),this.searchItems=[{value:"all",title:this.localeSer.getValue("datagrid.settings.allColumns")},{value:"visible",title:this.localeSer.getValue("datagrid.settings.visibleColumns")},{value:"hidden",title:this.localeSer.getValue("datagrid.settings.hiddenColumns")}],this.alignItems=[{value:"left",title:this.localeSer.getValue("datagrid.settings.alignLeft")},{value:"center",title:this.localeSer.getValue("datagrid.settings.alignCenter")},{value:"right",title:this.localeSer.getValue("datagrid.settings.alignRight")}],this.summaryItems=[{value:-1,title:this.localeSer.getValue("datagrid.settings.summaryNone")},{value:2,title:this.localeSer.getValue("datagrid.settings.summarySum")},{value:0,title:this.localeSer.getValue("datagrid.settings.summaryMax")},{value:1,title:this.localeSer.getValue("datagrid.settings.summaryMin")},{value:3,title:this.localeSer.getValue("datagrid.settings.summaryAverage")},{value:4,title:this.localeSer.getValue("datagrid.settings.summarCount")}],this.summaryItems2=[{value:-1,title:this.localeSer.getValue("datagrid.settings.summaryNone")},{value:4,title:this.localeSer.getValue("datagrid.settings.summarCount")}],this.fixedItems=[{value:"UNFIXED",title:this.localeSer.getValue("datagrid-settings.column.unFixed")},{value:"left",title:this.localeSer.getValue("datagrid-settings.column.leftFixed")},{value:"right",title:this.localeSer.getValue("datagrid-settings.column.rightFixed")}],"en"===this.localeSer.localeId&&(this.tabWidth=80)}return e.prototype.initData=function(){this.sortNames=this.gridInstance.sortName?this.gridInstance.sortName.split(","):[];var e=this.gridInstance.sortOrder?this.gridInstance.sortOrder.split(","):[];this.viewColumns=this.getViewColumns(),this.sortInfo={sortName:this.sortNames,sortOrder:e},this.columnFormat=I(this.columns[0]),this.groupField=this.gridInstance.groupField?this.gridInstance.groupField.split(","):[],this.expandGroupRows=this.gridInstance.expandGroupRows,this.enableGroupFooter=this.gridInstance.groupFooter},e.prototype.ngOnInit=function(){this.gridInstance.enableScheme?this.schemeInfo?(this.sortInfo=this.schemeInfo.sortInfo||{},this.sortInfo&&(this.sortNames=this.sortInfo.sortName||""),this.viewColumns=this.schemeInfo.viewColumns,this.columnFormat=this.schemeInfo.columnFormat,this.columnFormat||(this.columnFormat=I(this.columns[0])),this.schemeInfo.groupField?"string"==typeof this.schemeInfo.groupField?this.groupField=this.schemeInfo.groupField.split(","):this.groupField=this.schemeInfo.groupField||[]:this.groupField=[],this.expandGroupRows=!!this.schemeInfo.expandGroupRows):this.reset2Default():this.initData()},e.prototype.ngOnChanges=function(e){},e.prototype.close=function(e){e.stopPropagation(),this.modalRef&&this.modalRef.close()},e.prototype.setCurrentTab=function(e){if(void 0===e&&(e=null),this.render2){var t=0,n=Array.from(this.header.nativeElement.querySelectorAll(".navitem")),i=this.activeTabIndex;switch(3!==n.length&&(i=n.findIndex(function(t){return t===e})+1),i){case 2:t="en"===this.localeSer.localeId?78:68;break;case 3:t="en"===this.localeSer.localeId?158:138;break;default:t=0}this.render2.setStyle(this.activeTab.nativeElement,"transform","translate3d("+t+"px, 0px, 0px)")}},e.prototype.changeTabs=function(e,t){e.stopPropagation();var n=this.getCurrentGroupHeaders();1===this.activeTabIndex&&this.enableMultipleHeaders?this.setCurrentGroupHeaders(n):this.multiHeaders.treeData=n?n.treeData:[],2===t&&this.enableMultipleHeaders&&(this.sortTreeData=R(n.viewCols).filter(function(e){return-1==e.field.indexOf("farris-datagrid-column_")&&e.sortable})),3===t&&(this.enableMultipleHeaders?this.columnFormat=n&&n.viewCols?R(n.viewCols).filter(function(e){return-1==e.field.indexOf("farris-datagrid-column_")}):[]:this.columnFormat=R(this.columns)),this.activeTabIndex=t;var i=e.target;!i.classList.contains("navitem")&&i.closest(".navitem")&&(i=i.closest(".navitem")),this.setCurrentTab(i)},e.prototype.onSortInfoChange=function(e){this.sortInfo=e},e.prototype.getViewColumns=function(){var e=this,t=[];return this.columns.length>1?this.columns.forEach(function(n){t=t.concat(e._getViewColumns(n))}):t=this.columns[0].filter(function(e){return e.visible||e.visible===undefined}),t.map(function(e){return e.field})},e.prototype._getViewColumns=function(e){return e.filter(function(e){return!e.colspan&&(e.visible||e.visible===undefined)})},e.prototype.mergeColumnFormats=function(){var e=this;if(this.sortInfo&&Object.keys(this.sortInfo).length&&this.columnFormat&&this.columnFormat.length){var t=this.sortInfo,n=t.sortName,i=t.sortOrder;n&&n.length&&n.forEach(function(t,n){var r=e.columnFormat.find(function(e){return e.field===t});r&&(r.sortable=!0,r.order=i[n]||"asc")})}var r=this.columnFormat;if(!r.filter(function(e){return(!e.fixed||"UNFIXED"===e.fixed)&&e.visible}).length){var s=r.length,o=r.filter(function(e){return"right"===e.fixed}),l=r.filter(function(e){return"left"===e.fixed});l.length==s||o.length==s?r.forEach(function(e){e.fixed=""}):1===o.length?l.forEach(function(e){e.fixed=""}):o.forEach(function(e){e.fixed=""})}},e.prototype.onColumnFormatChange=function(e){this.columnFormat=e},e.prototype._showMessager=function(e){this.notifySer?this.notifySer.info(e):this.messager.info(e)},e.prototype.onSubmitClick=function(e){if(this.enableMultipleHeaders){var t=this.getCurrentGroupHeaders();if(t&&!O(t.viewCols))return void this._showMessager("请设置表头。");_(t.viewCols,this.sortInfo),this.multiHeaders=t}else this.multiHeaders=null,this.mergeColumnFormats();this.submitHandle.emit(e)},e.prototype.onCancelClick=function(e){this.cancelHandle.emit(e)},e.prototype.onSettingReset=function(e){var t=this,n=this.localeSer.getValue("datagrid.settings.restoreDefaultSettingsText")||"确认要恢复默认设置吗？";this.messager.confirm(n).subscribe(function(e){if(e)if(t.enableMultipleHeaders){var n=k(t.gridInstance),i=n.settings,r=n.multiHeaderOptions,s=i.viewColumns,o=(i.columnFormat,i.sortInfo),l=i.groupField,a=i.expandGroupRows,c=i.multiHeaders;t.viewColumns=s,t.sortInfo=o,t.sortNames=o.sortName||[],t.groupField=l,t.expandGroupRows=a,t.multiHeaders={columns:r.columns,treeData:c.treeData},t.columnFormat=R(r.columns),t.setCurrentGroupHeaders({viewCols:r.columns,treeData:null})}else t.reset2Default()})},e.prototype.reset2Default=function(){var e=this,t=this.gridInstance.dfs._state.initialOptions;if(t.columnFields&&t.columnFields.length){var n=[];t.columnFields.forEach(function(t){if("_datagrid-setting-control_"!==t.field){var i=e.gridInstance.columns[0].find(function(e){return e.field===t.field});i&&(i.visible=t.visible,i.halign=t.halign,i.align=t.align,i.width=t.width,i.footer=C({},t.footer||{}),i.groupFooter=C({},t.groupFooter||{}),i.title=t.title,i.fixed=t.fixed||"",n.push(i))}}),this.columns=[n]}if(this.viewColumns=this.getViewColumns(),t.sort){var i=t.sort.sortOrder?t.sort.sortOrder.split(","):[];this.sortNames=t.sort.sortName?t.sort.sortName.split(","):[],this.sortInfo={sortName:this.sortNames,sortOrder:i}}else this.sortNames=[],this.sortInfo={};this.columnFormat=I(this.columns[0]),this.groupField=t.groupField?t.groupField.split(","):[],this.expandGroupRows=!!t.expandGroupRows,this.enableGroupFooter=!!t.enableGroupFooter},e.prototype.showConcise=function(e){e&&e.stopPropagation(),this.enableMultipleHeaders&&(this.multiHeaders=this.getCurrentGroupHeaders()),this.mergeColumnFormats(),this.concise.emit()},e.prototype.setCurrentGroupHeaders=function(e){this.GROUP_HEADERS=e},e.prototype.getCurrentGroupHeaders=function(){return this.colFormatSettings?this.colFormatSettings.getMultiHeaders():this.GROUP_HEADERS},e.decorators=[{type:i.Component,args:[{selector:"datagrid-settings",template:'<div class="f-datagrid-settings d-flex flex-column" style="height: 100%;">\r\n\r\n    <div class="d-flex justify-content-between header" #header>\r\n        <div class="title">{{\'datagrid.settings.title\' | locale}}</div>\r\n\r\n        <div style="width: 100%;" class="tabs">\r\n            <div class="d-flex justify-content-center">\r\n                <div class="d-flex tabs-labels" (mousedown)="$event.stopPropagation()">\r\n\r\n                    <div class="active-tab" #activeTab [style.width.px]="tabWidth - 2"></div>\r\n\r\n                    <div class="navitem text-center" [class.active]="activeTabIndex === 1" (click)="changeTabs($event, 1)"\r\n                        style="border: 0; z-index:2; " [style.width.px]="tabWidth">{{\'datagrid.settings.visible\' | locale}}</div>\r\n                    <div class="navitem text-center" *ngIf="canSetColumnSort" [class.active]="activeTabIndex === 2 && canSetColumnSort" (click)="changeTabs($event, 2)" \r\n                    style="border: 0;z-index:2;" [style.width.px]="tabWidth">{{\'datagrid.settings.sortting\' | locale}}</div>\r\n                    <div class="navitem text-center" *ngIf="gridInstance?.groupRows"\r\n                        [class.active]="activeTabIndex === 3" (click)="changeTabs($event, 3)" \r\n                        style="border: 0;z-index:2;" [style.width.px]="tabWidth">{{\'datagrid.settings.groupping\' | locale}}</div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n\r\n        <div class="close">\r\n            <span class="f-icon modal_close" (click)="onCancelClick($event)"></span>\r\n        </div>\r\n    </div>\r\n\r\n    <div class="f-utils-fill tabs-container" [ngSwitch]="activeTabIndex" >\r\n        <ng-container *ngSwitchCase="1">\r\n            <column-format-setting [(fields)]="viewColumns" [columns]="columns" #colFormatSettings\r\n                (formatChange)="onColumnFormatChange($event)" \r\n                [enableMultipleHeaders]="enableMultipleHeaders"\r\n                [multiHeaderOptions]="multiHeaders"></column-format-setting>\r\n        </ng-container>\r\n        <ng-container *ngSwitchCase="2">\r\n            <sort-setting [treeData]="sortTreeData" [selectedIds]="sortNames"\r\n                (sortInfoChange)="onSortInfoChange($event)"></sort-setting>\r\n        </ng-container>\r\n\r\n        <ng-container *ngSwitchCase="3">\r\n            <column-group-setting [enabelGroupFooter]="gridInstance.groupFooter" [(formatColumns)]="columnFormat"\r\n            [(groupFields)]="groupField" [(expandGroupRows)]="expandGroupRows" [columns]="columns"></column-group-setting>\r\n        </ng-container>\r\n    </div>\r\n\r\n    <div class="buttons">\r\n        <button class="btn btn-link" (click)="showConcise($event)" *ngIf="gridInstance.enableSimpleMode"\r\n            style="width: 66px;height: 32px; float: left;">{{ \'datagrid.settings.conciseMode\' | locale: \'简洁模式\' }}</button>\r\n\r\n        <button class="btn btn-link reset" style="\r\n        color: black;\r\n        width: auto;\r\n        float: left;\r\n        margin-left: 20px;\r\n        cursor: default;" *ngIf="gridInstance.enableScheme">{{\'datagrid-scheme.currentSheme\' | locale: \'当前方案\'}}<span>{{ schemeName }}</span></button>\r\n\r\n        <button class="btn btn-link reset" (click)="onSettingReset($event)"\r\n            *ngIf="enableReset">{{ \'datagrid.settings.reset\' | locale: \'恢复默认\' }}</button>\r\n        <button class="btn btn-secondary cancel"\r\n            (click)="onCancelClick($event)">{{\'datagrid.settings.cancel\' | locale}}</button>\r\n        <button class="btn btn-primary ok"\r\n            (click)="onSubmitClick($event)">{{\'datagrid.settings.ok\' | locale}}</button>\r\n    </div>\r\n\r\n</div>',encapsulation:i.ViewEncapsulation.None}]}],e.ctorParameters=function(){return[{type:i.ChangeDetectorRef},{type:i.Injector}]},e.propDecorators={enableReset:[{type:i.Input}],columns:[{type:i.Input}],cancelHandle:[{type:i.Output}],submitHandle:[{type:i.Output}],reset:[{type:i.Output}],concise:[{type:i.Output}],schemeInfo:[{type:i.Input}],header:[{type:i.ViewChild,args:["header"]}],activeTab:[{type:i.ViewChild,args:["activeTab"]}],colFormatSettings:[{type:i.ViewChild,args:["colFormatSettings"]}]},e}();function A(e,t){if(e&&"object"==typeof e&&Object.keys(e).length>0){var n=e[t=t||"zh-CHS"];return n!==undefined?n:""}return""}var G=function(){function e(e,t){this.injector=e,this.cd=t,this.enableScheme=!1,this.seartTypes=[],this.columns=[],this.fields=[],this.clickToHidden=!0,this.top=0,this._schemeList=[],this.cls="f-datagrid-settings-simple-host",this.formatChange=new i.EventEmitter,this.fieldsChange=new i.EventEmitter,this.submit=new i.EventEmitter,this.submitForGroupHeader=new i.EventEmitter,this.closed=new i.EventEmitter,this.advanced=new i.EventEmitter,this.canceld=new i.EventEmitter,this.addNewScheme=new i.EventEmitter,this.showSchemeList=new i.EventEmitter,this.activeItemChange=new i.EventEmitter,this.schemeChanged=new i.EventEmitter,this.allCols=[],this.columnType="all",this.isEn=!1,this.showSchemePanel=!1,this.switchValue=!1,this.currentSchemeItem=null,this.searchResultIsVisibleAll={checkAll:!1,unCheckAll:!1},this.defaultSchemeName="系统预制",this.multiHeaderOptions={},this.enableMultipleHeaders=!1,this.prevSchemeItem=null,this.settings={},this.schemeSer=null,this.noDisplyColumnTip="",this.localeSer=this.injector.get(o.LocaleService,null),this.messager=this.injector.get(s.MessagerService,null),this.notify=this.injector.get(c.NotifyService,null),this.noDisplyColumnTip=this.localeSer.getValue("datagrid-scheme.noDisplyColumnTip")}return Object.defineProperty(e.prototype,"schemeList",{get:function(){return this._schemeList},set:function(e){var t=this;e&&e.length&&(e=e.filter(function(e){return JSON.parse(e.name)[t.localeSer.localeId]})).forEach(function(e){e._title_=A(JSON.parse(e.name),t.localeSer.localeId),t.currentSchemeItem&&e.id===t.currentSchemeItem.id&&(t.currentSchemeItem._title_=e._title_)}),this._schemeList=e||[]},enumerable:!0,configurable:!0}),e.prototype.onClick=function(e){e.stopPropagation(),(e.target.className||"").indexOf("f-datagrid-settings-simple-host")>-1&&this.clickToHidden&&this.cancel(),this.showSchemePanel=!1},e.prototype.onEscKeydown=function(e){e.stopPropagation(),document.querySelector("modal-container")||this.close()},e.prototype.onEnterKeydown=function(e){e.stopPropagation(),document.querySelector("modal-container")||this.onSubmitClick()},e.prototype.onControlGKeydown=function(e){if(e.ctrlKey&&!document.querySelector("modal-container")){var t=e.key.toLowerCase();["g","r","s"].includes(t)&&(e.preventDefault(),e.stopPropagation()),"g"===t?this.showAdvanced(e):"r"===t?this.onSettingReset():"s"===t&&this.searchInput.nativeElement.focus()}},e.prototype.getCurrentSchemeSettings=function(){return this.currentSchemeItem&&this.currentSchemeItem.queryConditionString?JSON.parse(this.currentSchemeItem.queryConditionString)[this.localeSer.localeId]:null},e.prototype.ngOnInit=function(){this.enableMultipleHeaders=this.gridInstance.enableSetMultiHeaders,this.allCols=this.columns[0],this.gridInstance.enableScheme&&(this.prevSchemeItem||(this.prevSchemeItem=d.cloneDeep(this.currentSchemeItem)),this.currentSchemeItem?this.settings=this.getCurrentSchemeSettings()||{}:this.settings&&Object.keys(this.settings).length||this._reset2Default());var e=this.settings.multiHeaders;this.multiHeaderOptions={columns:this.columns,treeData:e?e.treeData:null},this.enableMultipleHeaders||(this.settings&&this.settings.viewColumns?(this.fields=this.settings.viewColumns.filter(function(e){return"_datagrid-setting-control_"!=e}),this.dirtySettings(!0)):this.fields=this.getViewColumns()),this.container.nativeElement.focus(),this.searchResultIsVisibleAll=this.seachResultIsCheckAll(),this.defaultSchemeName=this.localeSer.getValue("datagrid-scheme.syspreset")||this.gridInstance.defaultSchemeName,this.schemeSer&&(this.settings&&!Object.keys(this.settings).length&&(this.gridInstance.enableScheme?this.resetToDefault():this.settings=this.getCurrentSettings()),this.schemeSer.setSettings(this.settings),this.defaultSettings())},e.prototype.ngAfterViewInit=function(){},e.prototype.getViewColumns=function(){var e=this,t=[];return this.columns.length>1?this.columns.forEach(function(n){t=t.concat(e._getViewColumns(n))}):t=this.columns[0].filter(function(e){return e.visible||e.visible===undefined}),t.map(function(e){return e.field})},e.prototype._getViewColumns=function(e){return e.filter(function(e){return!e.colspan&&(e.visible||e.visible===undefined)})},e.prototype.filterColumns=function(e){var t=this;void 0===e&&(e="");var n=[];n=this.switchValue?this.columns[0].filter(function(e){return t.fields.indexOf(e.field)>-1}):this.columns[0],e&&(n=n.filter(function(t){return t.title.toLowerCase().indexOf(e.toLowerCase())>-1})),this.allCols=n,this.searchResultIsVisibleAll=this.seachResultIsCheckAll(this.allCols.filter(function(e){return e.visible}))},e.prototype.seachResultIsCheckAll=function(e){var t=this.allCols.filter(function(e){return"_datagrid-setting-control_"!=e.field}).length,n=this.fields.filter(function(e){return"_datagrid-setting-control_"!=e}).length;return e&&(n=e.length),{checkAll:t&&t===n,unCheckAll:e?!n:!this.fields.length}},e.prototype.onFieldsChanged=function(){this.gridInstance.enableScheme||this.fieldsChange.emit(this.fields)},e.prototype.onDblClick=function(e,t){this.onCheckboxClick(e,t)},e.prototype.onCheckboxClick=function(e,t){var n=this;e.stopPropagation(),this.showSchemePanel=!1;var i=this.fields.indexOf(t.field);-1===i?this.fields.push(t.field):this.fields.splice(i,1),this.columns[0].forEach(function(e){e.visible=n.fields.indexOf(e.field)>-1}),this.fields=this.columns[0].filter(function(e){return e.visible}).map(function(e){return e.field});var r=this.allCols.filter(function(e){return e.visible}).map(function(e){return e.field});this.searchResultIsVisibleAll=this.seachResultIsCheckAll(r),this.dirtySettings(!0),this.onFieldsChanged()},e.prototype.searchColumn=function(e){this.switchValue=!1;var t=e.target.value;this.filterColumns(t)},e.prototype.onFieldDrop=function(e,t,n){var i;this.showSchemePanel=!1;var r=e.removedIndex,s=e.addedIndex,o=this.allCols[r],l=this.allCols[s],a=this.columns[0].findIndex(function(e){return e.field===o.field}),c=this.columns[0].findIndex(function(e){return e.field===l.field}),u=this.columns[0].splice(a,1);(i=this.columns[0]).splice.apply(i,I([c,0],u)),this.fields=this.columns[0].filter(function(e){return e.visible}).map(function(e){return e.field}),this.onFieldsChanged(),this.filterColumns(t)},e.prototype.getCheckAllState=function(){if(!this.searchInput.nativeElement.value)return 0===this.fields.length?0:this.fields.length===this.columns[0].length?1:2;var e=this.allCols.filter(function(e){return e.visible}).length;return e===this.allCols.length?1:e<this.allCols.length?0===e?0:1:void 0},e.prototype.onCheckAllClick=function(e,t){var n=this;if(e.stopPropagation(),this.allCols&&this.allCols.length){this.showSchemePanel=!1;var i=this.getCheckAllState(),r=0===i||2===i,s=null;t?(this.columns[0].forEach(function(e){var t=n.allCols.find(function(t){return e.field==t.field});t&&(e.visible=r,t.visible=r)}),s=this.allCols.filter(function(e){return e.visible}).map(function(e){return e.field})):this.columns[0].forEach(function(e){return e.visible=r}),this.fields=this.columns[0].filter(function(e){return e.visible}).map(function(e){return e.field}),this.searchResultIsVisibleAll=this.seachResultIsCheckAll(t?s:null),this.dirtySettings(!0),this.cd.detectChanges(),this.onFieldsChanged()}},e.prototype.close=function(e){e&&e.stopPropagation(),this.closed.emit()},e.prototype.cancel=function(e){this.currentSchemeItem=this.prevSchemeItem,this.close(e),this.canceld.emit()},e.prototype.showAdvanced=function(e){this.close(e),this.settings=this.getCurrentSettings(),this.enableMultipleHeaders&&this.multiHeaderRef&&(this.settings.multiHeaders=this.multiHeaderRef.getSettings()),this.advanced.emit({viewFields:this.fields,settings:this.settings,columns:this.columns})},e.prototype.onSettingReset=function(e){var t=this;e&&e.stopPropagation(),this.showSchemePanel=!1;var n=this.localeSer.getValue("datagrid.settings.restoreDefaultSettingsText")||"您确定要恢复默认设置吗？";this.messager.confirm(n,2035).subscribe(function(e){e&&(t.resetToDefault(),t.dirtySettings(!0),t.searchResultIsVisibleAll=t.seachResultIsCheckAll())})},e.prototype.resetToDefault=function(){this.enableMultipleHeaders?this._reset2DefalutFormMultiHeaders():this._reset2Default()},e.prototype._reset2DefalutFormMultiHeaders=function(){var e=k(this.gridInstance),t=e.settings,n=e.multiHeaderOptions;this.settings=t,this.multiHeaderOptions=n},e.prototype._reset2Default=function(){var e=this,t=this.gridInstance.dfs._state.initialOptions;if(t.columnFields&&t.columnFields.length){var n=[];t.columnFields.forEach(function(t){if("_datagrid-setting-control_"!==t.field){var i=e.columns[0].find(function(e){return e.field===t.field});i&&(i.visible=t.visible,i.halign=t.halign,i.align=t.align,i.width=t.width,i.footer=C({},t.footer||{}),i.groupFooter=C({},t.groupFooter||{}),i.title=t.title,i.fixed=t.fixed||"",n.push(i))}}),this.columns=[n]}if(this.allCols=this.columns[0],this.settings={},this.fields=this.getViewColumns(),this.settings.viewColumns=this.fields,this.settings.columnFormat=I(this.columns[0]),t.sort){var i=t.sort.sortOrder?t.sort.sortOrder.split(","):[],r=t.sort.sortName?t.sort.sortName.split(","):[];this.settings.sortInfo={sortName:r,sortOrder:i}}else this.settings.sortInfo={};this.settings.groupField=t.groupField?t.groupField.split(","):[],this.settings.expandGroupRows=!!t.expandGroupRows},e.prototype.getCurrentSettings=function(){var e={};return e.viewColumns=this.fields,this.enableScheme?e=Object.assign(this.settings||{},e):(e.columnFormat||(e.columnFormat=I(this.columns[0])),e.sortInfo||(e.sortInfo={sortName:this.gridInstance.sortName?this.gridInstance.sortName.split(","):[],sortOrder:this.gridInstance.sortOrder?this.gridInstance.sortOrder.split(","):[]}),e.groupField===undefined&&(e.groupField=this.gridInstance.groupField?this.gridInstance.groupField.split(","):[])),e.expandGroupRows==undefined&&(e.expandGroupRows=this.gridInstance.expandGroupRows),e},e.prototype.onSubmitClick=function(e){if(e&&e.stopPropagation(),this.enableMultipleHeaders||this.fields&&this.fields.length)if(this.prevSchemeItem=this.currentSchemeItem,this.showSchemePanel=!1,this.settings=this.getCurrentSettings(),this.enableMultipleHeaders){if(this.multiHeaderRef){var t=this.multiHeaderRef.getSettings();if(!O(t.viewCols))return void this.notify.info(this.noDisplyColumnTip);_(t.viewCols,this.settings.sortInfo),this.settings.multiHeaders=t}this.submitForGroupHeader.emit({content:this.settings,close:this.close.bind(this),target:this.btnOk.nativeElement,currentScheme:this.currentSchemeItem})}else this.submit.emit({content:this.settings,close:this.close.bind(this),target:this.btnOk.nativeElement,currentScheme:this.currentSchemeItem});else this.notify.warning(this.noDisplyColumnTip)},e.prototype.collectSettings=function(){if(this.settings=this.getCurrentSettings(),this.enableMultipleHeaders&&this.multiHeaderRef){var e=this.multiHeaderRef.getSettings();if(!O(e.viewCols))return void this.notify.info(this.noDisplyColumnTip);_(e.viewCols,this.settings.sortInfo),this.settings.multiHeaders=e}return C({},this.settings)},e.prototype.onChooseScheme=function(e){var t=this;e&&e.stopPropagation(),this.showSchemePanel=!this.showSchemePanel,setTimeout(function(){if(t.schemeitemsEleRef&&t.currentSchemeItem){var e=t.schemeitemsEleRef.nativeElement.querySelector("#schemeitem_"+t.currentSchemeItem.id);e&&(e.scrollIntoViewIfNeeded?e.scrollIntoViewIfNeeded():e.scrollIntoView())}})},e.prototype.onlySeeVisibleColumns=function(e,t){this.switchValue=e,this.filterColumns(t)},e.prototype.refresh=function(){this.cd.destroyed||this.cd.detectChanges()},e.prototype.hidePanel=function(){this.showSchemePanel=!1,this.refresh()},e.prototype.onNewSchemeClick=function(e,t){void 0===t&&(t="new"),e&&e.stopPropagation(),this.hidePanel(),this.addNewScheme.emit({type:t||"new"})},e.prototype.onShowSchemeList=function(e){e&&e.stopPropagation(),this.hidePanel(),this.showSchemeList.emit()},e.prototype.schemeChangedForSingleHeader=function(e){var t=this;e?(this.settings=e,this.fields=e.viewColumns,this.columns[0].forEach(function(e){e.visible=t.fields.indexOf(e.field)>-1})):this._reset2Default(),this.searchResultIsVisibleAll=this.seachResultIsCheckAll()},e.prototype.schemeChangedForMultiHeaders=function(e){if(e){this.settings=e;var t=this.gridInstance.dfs._state.initialOptions;this.multiHeaderOptions={treeData:this.settings.multiHeaders?this.settings.multiHeaders.treeData:null,columns:t.groupHeaderFields}}else this._reset2DefalutFormMultiHeaders()},e.prototype.onSchemeItemClick=function(e,t){var n=this;setTimeout(function(){n.currentSchemeItem=t,n.showSchemePanel=!1;var e=null;t&&t.queryConditionString&&(e=(e=JSON.parse(t.queryConditionString))[n.localeSer.localeId]),n.enableMultipleHeaders?n.schemeChangedForMultiHeaders(e):n.schemeChangedForSingleHeader(e),n.schemeSer.setSettings(n.settings),n.defaultSettings(t),n.schemeChanged.emit(t),n.refresh()})},e.prototype.defaultSettings=function(e){var t=this;this.enableMultipleHeaders&&(!e||this.settings&&this.settings.multiHeaders&&!this.settings.multiHeaders.treeData)&&setTimeout(function(){t.settings.multiHeaders=t.multiHeaderRef.getSettings(),t.schemeSer.setSettings(t.settings)})},e.prototype.dirtySettings=function(e){},e.prototype.clearSearch=function(e,t){t&&t.value&&(this.filterColumns(""),t.value="")},e.decorators=[{type:i.Component,args:[{selector:"datagrid-settings-simple",template:'<div class="d-flex flex-column f-datagrid-settings-simple" tabindex="0" #colcontainer\r\n    [style.top.px]="top" [style.height]="\'calc(100vh - \' +  top + \'px)\'" >\r\n\r\n    <div class="header d-flex">\r\n        <div class="f-utils-fill title d-flex flex-row"> {{ \'datagrid.settings.simple.title\' | locale }} \r\n            <button #btnSchemeName class="btn ml-3 px-2 scheme-name d-flex flex-row"  *ngIf="enableScheme" (click)="onChooseScheme($event)">\r\n                \x3c!-- <span *ngIf="isChanged">*</span> --\x3e\r\n                <span>{{ currentSchemeItem? currentSchemeItem._title_ : defaultSchemeName }}</span>\r\n                <span class="f-icon f-icon-arrow-chevron-down ml-2" style="font-size: 12px;"></span>\r\n            </button>\r\n        </div>\r\n        <div class="closed" (click)="cancel($event)">\r\n            <span class="f-icon f-icon-close" style="font-size: 20px;"></span>\r\n        </div>\r\n    </div>\r\n    <div class="scheme-manager-dropdown" [style.display]="showSchemePanel? \'\': \'none\'" [style.left.px]="btnRef? btnRef.nativeElement.offsetLeft : 97"  (click)="$event.stopPropagation()">\r\n        <div class="f-utils-fill f-utils-flex-column m-2">\r\n            <div class="pb-2" style="max-height: calc(100vh - 300px);overflow: auto">\r\n                <ul #schemeitems>\r\n                    <li class="scheme-manager__item" [class.active]="!currentSchemeItem" (click)="onSchemeItemClick($event, null)"> \r\n                        \x3c!-- <span *ngIf="isChanged && !activeSchemeItem">*</span> --\x3e\r\n                        {{\'datagrid-scheme.syspreset\' | locale}}\r\n                    </li>\r\n                    <li [attr.id]="\'schemeitem_\'+ item.id" class="scheme-manager__item d-flex flex-row" \r\n                        [class.active]="currentSchemeItem && currentSchemeItem?.id === item.id"  \r\n                        *ngFor="let item of schemeList" (click)="onSchemeItemClick($event, item)" title="{{item._title_}}">\r\n                        \x3c!-- <span *ngIf="isChanged && activeSchemeItem?.id==item.id">*</span> --\x3e\r\n                        <span class="f-utils-fill mr-1" style="text-overflow: ellipsis;">{{item._title_}}</span>\r\n                        <span class="scheme-manager__label default" *ngIf="item.isDefault">{{\'datagrid-scheme.isDefault\' | locale}}</span>\r\n                        <span class="scheme-manager__label public" *ngIf="item.type === \'public\'">{{\'datagrid-scheme.isPublic\' | locale}}</span>\r\n                        <span class="scheme-manager__label private" *ngIf="!item.isDefault && item.type === \'private\'">{{\'datagrid-scheme.isPrivate\' | locale}}</span>\r\n                        <span class="scheme-manager__label org" *ngIf="item.type === \'org\'">{{\'datagrid-scheme.isOrg\' | locale}}</span>\r\n                    </li>\r\n                </ul>\r\n            </div>\r\n\r\n            <div class="d-flex scheme-manager__button-add">\r\n                <button (click)="onNewSchemeClick($event)">\r\n                    <span class="f-icon f-icon-plus"></span>{{\'datagrid-scheme.newScheme\' | locale}}\r\n                </button>\r\n            </div>\r\n\r\n            <div class="p-2 mt-2">\r\n                <div class="btn-toolbar" style="justify-content: flex-end;">\r\n                    <button class="btn btn-link mr-3" (click)="onShowSchemeList($event)">{{\'datagrid-scheme.mgrScheme\' | locale}}</button>\r\n                    <button class="btn btn-primary mr-1" (click)="onNewSchemeClick($event, \'saveas\')">{{\'datagrid-scheme.saveas\' | locale}} </button>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <div class="f-utils-fill content d-flex flex-column mb-0">\r\n        <div class="d-flex flex-column">\r\n            <div class="d-flex flex-row mb-2" style="align-items: center; height: 24px;">\r\n                <h5 *ngIf="!enableMultipleHeaders" class="count f-utils-fill m-0" [innerHTML]="\'datagrid.settings.simple.count\' | locale | replaceX: fields.length"></h5>\r\n                <h5 *ngIf="enableMultipleHeaders" class="count m-0" style="font-size: 18px;">{{ \'headerGroup.title\' | locale }}</h5>\r\n                <div class="d-flex flex-row " style="align-items: center;justify-content: end;" [class.f-utils-fill]="enableMultipleHeaders" >\r\n                    <div [class.d-flex]="!inputWord.value"  class="flex-row" [style.display]="inputWord.value ? \'none\': \'\'"  *ngIf="!enableMultipleHeaders">{{\'datagrid-scheme.onlyshowcolumns\' | locale}} \r\n                        <farris-switch style="position: relative;\r\n                        top: 2px;\r\n                        margin-left: 5px;"\r\n                        id="only-visible-columns"\r\n                        [square]="false" [size]="\'small\'"\r\n                        [ngModel]="switchValue" \r\n                        (valueChange)="onlySeeVisibleColumns($event, inputWord.value)"\r\n                      \r\n                        ></farris-switch>\r\n                    </div>\r\n                   \r\n                    <button class="btn btn-link" style="height: 32px;padding-left: 4px;" [preview-headers]="gh" [dlgTitle]="\'headerGroup.preview\'|locale" *ngIf="enableMultipleHeaders"> {{ \'headerGroup.preview\' | locale }}</button>\r\n                    <farris-switch style="position: relative; top: 2px; margin-left: 5px; display: none;" id="only-visible-columns"\r\n                        [square]="false" [size]="\'small\'" [(ngModel)]="enableMultipleHeaders"></farris-switch>\r\n                </div>\r\n            </div>\r\n\r\n            <div class="tip">\r\n                <ng-container  *ngIf="!enableMultipleHeaders">\r\n                    {{ \'datagrid.settings.simple.tip\' | locale }}\r\n                </ng-container>\r\n                <ng-container *ngIf="enableMultipleHeaders">\r\n                    {{ \'headerGroup.tips\' | locale }}\r\n                </ng-container>\r\n            </div>\r\n            <div class="input-group mb-2 scheme-manager__search-box" [style.display]="enableMultipleHeaders?\'none\':\'\'">\r\n                <input #inputWord type="text" class="form-control" placeholder="{{\'datagrid.settings.searchPlaceholder\' | locale}}"\r\n                (input)="searchColumn($event)" style="height: 26px;">\r\n                <div  class="input-group-append" style="cursor: pointer">\r\n                    <span  class="fa f-icon-search" [class.f-icon-close]="inputWord.value" (click)="clearSearch($event, inputWord)"></span>\r\n                </div>\r\n            </div>\r\n        </div>\r\n\r\n        <div style="padding: 5px 0px;" class="d-flex flex-row" *ngIf="!enableMultipleHeaders">\r\n            <button class="btn btn-link " style="height: 32px;padding-left: 4px;" (click)="onCheckAllClick($event,inputWord.value)" [disabled]="!(allCols && allCols.length)">\r\n                <span class="f-icon f-icon-minus-outline checkall" \r\n                    [class.f-icon-checkbox]="searchResultIsVisibleAll.unCheckAll"\r\n                    [class.f-icon-checkbox-checked]="searchResultIsVisibleAll.checkAll"></span>\r\n                {{ \'datagrid.settings.checkall\' | locale }}\r\n            </button>\r\n        </div>\r\n\r\n        <div style="overflow: auto;padding-right:3px;" class="f-utils-fill" [ngStyle]="enableMultipleHeaders? {border: \'1px solid #dae9ff\',\'border-radius\': \'6px\'} : {}">\r\n            <ul [style.display]="enableMultipleHeaders? \'none\':\'\'" class="list-group list-group-flush" #ul column-visible-drag (drop)="onFieldDrop($event, inputWord.value, ul)">\r\n                <li class="list-group-item list-group-item-action smooth-dnd-draggable-wrapper format-setting-column" *ngFor="let col of allCols" \r\n                    (click)="onDblClick($event, col)">\r\n                    <span class="f-icon checkbox"\r\n                        [class.f-icon-checkbox-checked]="fields.length && fields.indexOf(col.field) > -1"\r\n                        [class.f-icon-checkbox]="!fields.length || fields.indexOf(col.field) == -1"\r\n                        (click)="onCheckboxClick($event, col)"></span>\r\n                    {{ col.title}} \r\n\r\n                    <span class="f-icon f-icon-drag-vertical field-drag-handle" *ngIf="!inputWord.value"></span>\r\n                </li>\r\n            </ul>\r\n            <column-tree #gh="groupHeaderTree" [dg]="gridInstance" [options]="multiHeaderOptions"\r\n                [style.display]="enableMultipleHeaders? \'block\': \'none\'" style="height: 100%;padding-top: 5px;"></column-tree>\r\n        </div>\r\n\r\n    </div>\r\n    <div class="footer">\r\n\r\n        <div class="buttons">\r\n            <button class="btn btn-link advanced" (click)="showAdvanced($event)">{{ \'datagrid.settings.advancedMode\' | locale: \'高级模式\' }}</button>\r\n            <button class="btn btn-link reset" (click)="onSettingReset($event)">{{ \'datagrid.settings.reset\' | locale: \'恢复默认\' }}</button>\r\n            <button class="btn btn-secondary cancel"\r\n                (click)="cancel($event)">{{\'datagrid.settings.cancel\' | locale}}</button>\r\n            <button class="btn btn-primary ok" #okbtn\r\n                (click)="onSubmitClick($event)">{{\'datagrid.settings.ok\' | locale}}</button>\r\n        </div>\r\n\r\n    </div>\r\n\r\n</div>\r\n\r\n\r\n',encapsulation:i.ViewEncapsulation.None}]}],e.ctorParameters=function(){return[{type:i.Injector},{type:i.ChangeDetectorRef}]},e.propDecorators={enableScheme:[{type:i.Input}],seartTypes:[{type:i.Input}],columns:[{type:i.Input}],fields:[{type:i.Input}],clickToHidden:[{type:i.Input}],top:[{type:i.Input}],schemeList:[{type:i.Input}],cls:[{type:i.HostBinding,args:["class"]}],container:[{type:i.ViewChild,args:["colcontainer"]}],btnOk:[{type:i.ViewChild,args:["okbtn"]}],searchInput:[{type:i.ViewChild,args:["inputWord"]}],schemeitemsEleRef:[{type:i.ViewChild,args:["schemeitems"]}],btnRef:[{type:i.ViewChild,args:["btnSchemeName"]}],multiHeaderRef:[{type:i.ViewChild,args:["gh"]}],formatChange:[{type:i.Output}],fieldsChange:[{type:i.Output}],submit:[{type:i.Output}],submitForGroupHeader:[{type:i.Output}],closed:[{type:i.Output}],advanced:[{type:i.Output}],canceld:[{type:i.Output}],addNewScheme:[{type:i.Output}],showSchemeList:[{type:i.Output}],activeItemChange:[{type:i.Output}],schemeChanged:[{type:i.Output}],onClick:[{type:i.HostListener,args:["click",["$event"]]}],onEscKeydown:[{type:i.HostListener,args:["window:keydown.esc",["$event"]]}],onEnterKeydown:[{type:i.HostListener,args:["window:keydown.enter",["$event"]]}],onControlGKeydown:[{type:i.HostListener,args:["keydown",["$event"]]}]},e}(),P="/api/runtime/sys/v1.0/querysolution",V=P+"/belongId/",L=P+"/batch",U="/api/runtime/sys/v1.0/querysolution/componentType/Datagrid",j="/api/runtime/sys/v1.0/loginInfo?infoType=supportedLanguage",$=function(){function e(e){this.inject=e,this.restService=null,this.state={},this.perfixStr="",this.schemeList$=new n.Subject,this.schemeApi={SCHEME_WEBAPI:P,SCHEME_WEBAPI_QUERY:V,SCHEME_WEBAPI_UPDATE:L,SCHEME_WEBAPI_Auth:U,LANGUAGE_WEBAPI:j},this.schemeKey={},this.currentSchemeSettings=null}return e.prototype.setUriPerfix=function(e){this.perfixStr=e||""},e.prototype.update=function(e,t){this.state[t]||(this.state[t]={}),this.state[t]=Object.assign(this.state[t],e)},e.prototype.setRestService=function(e){e&&e.befRepository&&(this.restService=e.befRepository.restService)},e.prototype.mergeUri=function(e,t){return h.appendPerfixForUri?h.appendPerfixForUri(e,t):e},e.prototype.getWebFormKey=function(){var e=window.location.hash.split("?")[0];return e.substring(e.lastIndexOf("/")+1)},e.prototype.destory=function(e){delete this.schemeKey[e]},e.prototype.getSchemeKey=function(e){if(!this.schemeKey[e]){var t=this.getWebFormKey();this.schemeKey[e]=t+"_DatagridScheme_"+e}return this.schemeKey[e]},e.prototype.getSchemeList=function(e,t){void 0===t&&(t=!1);var n=this.schemeApi.SCHEME_WEBAPI_QUERY+this.getBelongId(e,t);if(n=this.mergeUri(n,this.perfixStr),this.restService)return this.restService.invoke(n,"GET",null,null,!1)},e.prototype.updateSchemeData=function(e,t){var n=this.getStateValue(e,"list");(n=n.filter(function(e){return e.id!==t.id})).push(t),this.setSchemeList(e,n)},e.prototype.getBelongId=function(e,t){void 0===t&&(t=!1);var n=this.getSchemeKey(e);return t&&(n+="-$MULTIHEADER$"),n},e.prototype.saveScheme=function(e,t,n,i){if(void 0===n&&(n=!1),void 0===i&&(i=!1),this.restService){var r=n?"PUT":"POST";e.belongId=this.getBelongId(t,i);var s=this.mergeUri(this.schemeApi.SCHEME_WEBAPI,this.perfixStr);return this.restService.invoke(s,r,null,{body:e},!1)}},e.prototype.updateScheme=function(e,t,i){if(void 0===i&&(i=!1),!e)return n.of(!1);var r=this.getBelongId(t,i);if(e.belongId=r,e.belongId){var s=this.mergeUri(this.schemeApi.SCHEME_WEBAPI_UPDATE,this.perfixStr);return this.restService.invoke(s,"PUT",null,{body:e},!1)}},e.prototype.getStateValue=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var i=this.state[e];return i?t&&t.length?t.reduce(function(e,t){return e[t]},i):i:null},e.prototype.updateStateValue=function(e,t,n){var i;this.update(((i={})[t]=n,i),e)},e.prototype.setSchemeList=function(e,t){this.updateStateValue(e,"list",t),this.schemeList$.next(t)},e.prototype.hasSchemeName=function(e,t){var n=this.getStateValue(e,"list");if(!n||!n.length)return!1;if("string"==typeof t)return!!n.find(function(e){return e.name===t.trim()});if("object"==typeof t){var i=[];return n.forEach(function(e){if(e.name){var n=JSON.parse(e.name);for(var r in t)n[r]===t[r]&&i.push(r)}}),i}},e.prototype.checkAuthority=function(){var e=this.mergeUri(this.schemeApi.SCHEME_WEBAPI_Auth,this.perfixStr);return this.restService.invoke(e,"GET",null,null,!1)},e.prototype.getLanguages=function(){if(this.restService){var e=this.mergeUri(this.schemeApi.LANGUAGE_WEBAPI,this.perfixStr);return this.restService.invoke(e,"GET",null,null,!1)}return n.of([])},e.prototype.createSchemeTaskID=function(){var e=new h.IdService;this.SCHEME_TASK_ID=e.guid(),this.currentSchemeSettings=null},e.prototype.setSettings=function(e){this.currentSchemeSettings={taskid:this.SCHEME_TASK_ID,values:d.cloneDeep(e)}},e.prototype.getSettings=function(){return this.currentSchemeSettings},e.prototype.isSchemeChanged=function(e,t){var n=e.sortInfo,i=e.viewColumns,r=e.groupField,s=e.columnFormat,o=e.expandGroupRows,l=e.multiHeaders,a=this.getSettings().values,c=a.sortInfo,u=a.viewColumns,d=a.groupField,h=a.columnFormat,p=a.expandGroupRows,f=a.multiHeaders,m=function(e){return e&&Object.keys(e).length||(e={sortName:[],sortOrder:[]}),e};n=m(n),c=m(c);var g,v,y=function(e){return e||(e=[]),e};r=y(r),d=y(d),t?(g={sortInfo:n,expandGroupRows:o,groupField:r,multiHeaders:l},v={sortInfo:c,expandGroupRows:p,groupField:d,multiHeaders:f}):(g={columnFormat:s,expandGroupRows:o,groupField:r,sortInfo:n,viewColumns:i},v={columnFormat:h,expandGroupRows:p,groupField:d,sortInfo:c,viewColumns:u});var b=function(e){return JSON.stringify(e).replace(/UNFIXED/g,"").replace(/"calculationType":-1,/g,"").replace(/"calculationType":-1/g,"")};return b(g)!=b(v)},e}(),z=function(){function e(e){this.cd=e,this.dataPermissionIds=[],this.closeModal=new i.EventEmitter,this.submitModal=new i.EventEmitter,this.checkAuthority=new i.EventEmitter,this.schemeInfo={name:"",isDefault:!1,type:"private",orgids:""},this.schemeType="private",this.noPublicAuthority=!1,this.noOrgAuthority=!1,this.languages=[{code:"zh-CHS",name:"中文简体","default":!0},{code:"en",name:"English"},{code:"zh-CHT",name:"中文繁体"}],this.nameMaxLength={"zh-CHS":9,"zh-CHT":9,en:20}}return e.prototype.ngOnInit=function(){},e.prototype.close=function(e){this.closeModal.emit()},e.prototype.submit=function(e){this.submitModal.emit(this.schemeInfo)},e.prototype.onCancelClick=function(e){this.close(e)},e.prototype.onSelectedOrg=function(e){if(e.selections&&e.selections.length){var t=e.selections.map(function(e){return e.orgId});this.schemeInfo.orgids=t}},e.prototype.onSetRangeType=function(e,t){e.stopPropagation(),this.schemeType=t,"public"===t||"org"===t?this.checkAuthority.emit({value:t,schemeInfo:this.schemeInfo}):this.schemeInfo.type=t},e.prototype.refresh=function(e){void 0===e&&(e={"public":!0,org:!0}),this.schemeInfo=C({},this.schemeInfo),this.schemeType=this.schemeInfo.type,this.noPublicAuthority=!e["public"],this.noOrgAuthority=!e.org,this.cd.detectChanges()},e.prototype.getSelectedId=function(e){e.selections&&e.selections.length?this.schemeInfo.orgids=e.selections.map(function(e){return e.orgId}):this.schemeInfo.orgids=""},e.prototype.clearAllOrgs=function(){this.schemeInfo.orgids=""},e.decorators=[{type:i.Component,args:[{selector:"new-scheme",template:'\r\n\r\n\r\n<div class="f-datagrid-save-scheme d-flex flex-column" style="height: 100%;">\r\n\r\n    <div class="d-flex justify-content-between header" #header >\r\n        <div class="title">{{\'datagrid-scheme.saveTitle\' | locale}}</div>\r\n        <div class="close" style="margin-right: 20px;">\r\n            <span class="f-icon modal_close" (click)="close($event)"></span>\r\n        </div>\r\n    </div>\r\n\r\n    <div class="f-utils-fill  mx-3 p-3 mt-1" >\r\n        \x3c!-- <div class="input-group mb-3 scheme-manager__search-box">\r\n            <input #schemeName type="text" class="form-control" maxlength="9" placeholder="{{\'datagrid-scheme.namePlaceholder\' | locale}}" style="height: 26px;" name="name" [(ngModel)]="schemeInfo.name">\r\n        </div> --\x3e\r\n        <div class=" mb-3">\r\n            <language-textbox [(ngModel)]="schemeInfo.name" [editable]="true" [languages]="languages" [maxWords]="nameMaxLength"></language-textbox>\r\n        </div>\r\n            \r\n    \r\n        <div class="input-group mb-2" style="border: 0;">\r\n          \r\n            <div class="custom-control custom-radio  custom-control-inline " style="align-items: center">\r\n                <input class="custom-control-input" type="radio" id="private-scheme"  name="schemeType"  (click)="onSetRangeType($event, \'private\')" value="private" [checked]="schemeType === \'private\'">\r\n                <label class="custom-control-label" for="private-scheme">{{\'datagrid-scheme.setPrivate\' | locale}}</label>\r\n                <span class="icon-question" farrisTooltip [zIndex]="2040" [placement]="\'right\'" [delay]="500" [content]="\'datagrid-scheme.privateTip\' | locale">?</span>\r\n            </div>\r\n            <div class="custom-control custom-radio  custom-control-inline " style="align-items: center">\r\n                <input class="custom-control-input" type="radio" id="public-scheme" name="schemeType" (click)="onSetRangeType($event, \'public\')" value="public" [checked]="schemeType === \'public\'" >\r\n                <label class="custom-control-label" for="public-scheme">{{\'datagrid-scheme.setPublic\' | locale}}</label>\r\n                <span class="icon-question" farrisTooltip [zIndex]="2040" [placement]="\'right\'" [delay]="500" [content]="\'datagrid-scheme.publicTip\' | locale">?</span>\r\n            </div>\r\n            <div class="custom-control custom-radio  custom-control-inline " style="align-items: center">\r\n                <input class="custom-control-input" type="radio" id="org-scheme" name="schemeType" (click)="onSetRangeType($event, \'org\')"  value="org" [checked]="schemeType === \'org\'" >\r\n                <label class="custom-control-label" for="org-scheme">{{\'datagrid-scheme.setOrg\' | locale}}</label>\r\n                <span class="icon-question" farrisTooltip [zIndex]="2040" [placement]="\'right\'" [delay]="500" [content]="\'datagrid-scheme.orgTip\' | locale">?</span>\r\n            </div>\r\n        </div>\r\n        <div class="input-group mb-2" style="border: 0;" *ngIf="schemeInfo.type === \'private\'">\r\n            <div class="custom-control custom-checkbox  custom-control-inline " style="align-items: center">\r\n                <input class="custom-control-input" type="checkbox" id="default-scheme" name="isDefault" [(ngModel)]="schemeInfo.isDefault">\r\n                <label class="custom-control-label" for="default-scheme">{{\'datagrid-scheme.setDefault\' | locale}} <i class="scheme-org-tip">({{\'datagrid-scheme.defaultTip\' | locale}})</i></label>\r\n                \x3c!-- <span class="icon-question" farrisTooltip [placement]="\'right\'" [delay]="500" [content]="\'下次进入此功能时，默认加载该方案\'">?</span> --\x3e\r\n            </div>\r\n        </div>\r\n\r\n        <div class="input-group mb-2" style="border: 0;" *ngIf="schemeInfo.type === \'org\' && !noOrgAuthority">\r\n            <div class="input-group mb-3">\r\n                <farris-organization-selector\r\n                    [primaryField]="\'orgId\'" [displayField]="\'name\'"\r\n                    [absOrgType]="\'System_organization\'"\r\n                    [layer]="1" [multiSelect]="true" [showTabIds]="\'organization\'"\r\n                    [enableHierarchicalLoading]="true" \r\n                    [cascadeCheck]="true" [cascadeDown]="true"\r\n                    (selectionsChange)="onSelectedOrg($event)"\r\n                    [cascadeUp]="false"\r\n                    [orgIds]="dataPermissionIds"\r\n                    (inputClear)="clearAllOrgs()" (tagRemoved)="getSelectedId($event)"\r\n                    [dataPermission]="true" [dataPermissionIds]="dataPermissionIds" \r\n                ></farris-organization-selector>\r\n            </div>\r\n        </div>\r\n    </div>\r\n\r\n    <div class="p-3 mb-3" style="height: 50px;text-align: right;">\r\n        <button class="btn btn-secondary cancel btn-lg mr-3" style="width: 70px"\r\n            (click)="onCancelClick($event)">{{\'datagrid.settings.cancel\' | locale}}</button>\r\n        <button class="btn btn-primary ok btn-lg" style="width: 70px"\r\n            (click)="submit($event)">{{\'datagrid.settings.ok\' | locale}}</button>\r\n    </div>\r\n\r\n</div>',encapsulation:i.ViewEncapsulation.None}]}],e.ctorParameters=function(){return[{type:i.ChangeDetectorRef}]},e.propDecorators={header:[{type:i.ViewChild,args:["header"]}],dataPermissionIds:[{type:i.Input}],closeModal:[{type:i.Output}],submitModal:[{type:i.Output}],checkAuthority:[{type:i.Output}]},e}(),q=function(){function e(e,t,n){this.cd=e,this.localeSer=t,this.injector=n,this.items=[],this.closeModal=new i.EventEmitter,this.submitModal=new i.EventEmitter,this.removeItem=!0,this.currentSchemeId="",this.columns=[],this.currentUserId="",this.changes=null}return e.prototype.ngOnInit=function(){var e=this,t=this.localeSer.getValue("datagrid-scheme.columns.name")||"名称",n=this.localeSer.getValue("datagrid-scheme.columns.type")||"属性",i=this.localeSer.getValue("datagrid-scheme.columns.isDefault")||"默认",r=this.localeSer.getValue("datagrid-scheme.columns.username")||"创建人",s=this.localeSer.getValue("datagrid-scheme.columns.mgr")||"管理",o=this.localeSer.getValue("datagrid-scheme.isPublic")||"公共",l=this.localeSer.getValue("datagrid-scheme.isPrivate")||"个人",a=this.localeSer.getValue("datagrid-scheme.isOrg")||"组织";this.columns=[{field:"name",title:t,width:150,formatter:function(t){return A(JSON.parse(t),e.localeSer.localeId)}},{field:"type",title:n,width:50,halign:"center",align:"center",formatter:function(e,t){switch(e){case"public":return'<span class="scheme-manager__label px-1 public">'+o+"</span>";case"org":return'<span class="scheme-manager__label px-1 org">'+a+"</span>";case"private":default:return'<span class="scheme-manager__label px-1 private">'+l+"</span>"}}},{field:"isDefault",title:i,width:50,halign:"center",align:"center",template:this.schemeIsDefault},{field:"userName",title:r,width:80},{title:s,width:50,template:this.btnDel,halign:"center",align:"center"}]},e.prototype.onClose=function(e){this.closeModal.emit()},e.prototype.onSubmitClick=function(e){this.submitModal.emit(this.changes)},e.prototype.onCancelClick=function(e){this.closeModal.emit()},e.prototype.setDefault=function(e,t){var n="1"==e;this.items.forEach(function(e){e.isDefault=!1,e.id===t.rowData.id&&n&&(e.isDefault=n)}),this.items=I(this.items);var i=this.items.find(function(e){return e.isDefault});i&&(this.changes=this.changes||{},this.changes.defaultId=i.id)},e.prototype.onSchemeDel=function(e,t){if(this.currentUserId===t.rowData.userId&&"private"==t.rowData.type||this.removeItem){e.stopPropagation();var n=t.rowData.id;this.items=this.items.filter(function(e){return e.id!==n}),this.changes=this.changes||{},this.changes.deletedIds=I(this.changes.deletedIds||[],[n]),n===this.changes.defaultId&&(this.changes.defaultId="",delete this.changes.defaultId)}},e.decorators=[{type:i.Component,args:[{selector:"scheme-list",template:'\r\n<div class="f-datagrid-save-scheme d-flex flex-column" style="height: 100%;">\r\n    <div class="d-flex justify-content-between header" #header >\r\n        <div class="title">{{\'datagrid-scheme.schemeList\' | locale}}</div>\r\n        <div class="close" style="margin-right: 20px;">\r\n            <span class="f-icon modal_close" (click)="onClose($event)"></span>\r\n        </div>\r\n    </div>\r\n\r\n    <div class="f-utils-fill mx-3 mt-1" >\r\n        <farris-datagrid #dg\r\n            [columns]="columns"\r\n            [data]="items"\r\n            [fit]="true"\r\n            [fitColumns]="true"\r\n            [pagination]="false"\r\n            [editable]="false">\r\n        </farris-datagrid>\r\n    </div>\r\n\r\n    <div class="p-3 mb-3" style="height: 50px;text-align: right;">\r\n        <button class="btn btn-secondary cancel btn-lg mr-3" style="width: 70px"\r\n            (click)="onCancelClick($event)">{{\'datagrid.settings.cancel\' | locale}}</button>\r\n        <button class="btn btn-primary ok btn-lg" style="width: 70px" [disabled]="!(items && items.length) && !changes"\r\n            (click)="onSubmitClick($event)">{{\'datagrid.settings.ok\' | locale}}</button>\r\n    </div>\r\n</div>\r\n\r\n<ng-template #schemeName let-ctx>\r\n    <div class="input-group">\r\n        <input type="text" class="form-control" [(ngModel)]="ctx.rowData[\'name\']">\r\n    </div>\r\n</ng-template>\r\n<ng-template #schemeIsDefault let-ctx>\r\n    <div class="f-datagrid-cell-formgroup farris-group-auto f-datagrid_scheme-switch" [style.opacity]="ctx.rowData[\'type\'] !== \'private\' ? 0.6: 1" style="line-height:100%" #ctrlbox hidefocus="true">\r\n        <farris-switch [(ngModel)]="ctx.rowData[\'isDefault\']" trueValue="1" falseValue="0"\r\n        (valueChange)="setDefault($event, ctx)"  [disabled]="ctx.rowData[\'type\'] !== \'private\' || ctx.rowData[\'isDefault\']"></farris-switch>\r\n    </div>\r\n</ng-template>\r\n\r\n<ng-template let-ctx #btnDel>\r\n    <a href="javascript:void(0)" (click)="onSchemeDel($event, ctx)" title="{{\'datagrid-scheme.delete\' | locale}}" \r\n    *ngIf="(removeItem || (ctx.rowData[\'userId\'] === currentUserId && ctx.rowData[\'type\']==\'private\')) && currentSchemeId !== ctx.rowData[\'id\']">\r\n        <span class="f-icon f-icon-yxs_delete"></span>\r\n    </a>\r\n</ng-template>'}]}],e.ctorParameters=function(){return[{type:i.ChangeDetectorRef},{type:o.LocaleService},{type:i.Injector}]},e.propDecorators={items:[{type:i.Input}],closeModal:[{type:i.Output}],submitModal:[{type:i.Output}],removeItem:[{type:i.Input}],currentSchemeId:[{type:i.Input}],header:[{type:i.ViewChild,args:["header"]}],schemeName:[{type:i.ViewChild,args:["schemeName"]}],schemeIsDefault:[{type:i.ViewChild,args:["schemeIsDefault"]}],btnDel:[{type:i.ViewChild,args:["btnDel"]}],dg:[{type:i.ViewChild,args:["dg"]}]},e}(),W={en:{"datagrid-settings":{noAuth:{"public":"You do not have permission to set the usage scope of the scheme as public.",org:"You do not have permission to set the usage range of the scheme as organization."},has:{exist:"The scheme name already exists, please modify it.",chs:"Simplified Chinese name already exists.",cht:"Traditional Chinese name already exists.",en:"English name already exists."},required:{schemeName:"Please enter a scheme name.",chs:"Please enter a simplified Chinese name.",cht:"Please enter a name in Traditional Chinese.",en:"Please enter an English name.",org:"Please select an organization."},groupRowStatus:{label:"Group Row Status",expand:"open",collapse:"fold"},column:{title:"Column title",fixed:"Fixed type",unFixed:"Unfixed",leftFixed:"Left fixed",rightFixed:"Right fixed"}},"datagrid-scheme":{saveTitle:"Save Scheme",namePlaceholder:"Please enter a scheme name (no more than 9 characters)",setPrivate:"Private",privateTip:"When set as private, you can only view and use the scheme yourself",setPublic:"Public",publicTip:"When public, all users can view and use the scheme",setOrg:"Organization",orgTip:"When it is set to organization, users in the organization can view and use the scheme",setDefault:"Default",defaultTip:"The next time you enter this function, the scheme will be loaded by default",syspreset:"System preset",isDefault:"Default",isPublic:"Public",isOrg:"Org",isPrivate:"Private",newScheme:"Add New Scheme",mgrScheme:"Manage",saveas:"Save as",onlyshowcolumns:"only the display column",schemeList:"Scheme list","delete":"Delete this shceme",columns:{name:"Name",type:"Type",isDefault:"IsDefault",username:"Creator",mgr:"Manage"},currentSheme:"Current scheme：",schemeChanged:{title:"The scheme has been changed. Do you want to save it as a new scheme?",tips:"cancel: discard modifications; No: save the current scheme; Yes: save as a new scheme.",yes:"Yes",no:"No",cancel:"Cancel"},noDisplyColumnTip:"Please set the fields to be displayed."},headerGroup:{title:"Multiple meter heads",preview:"Preview effect",tips:"The fields in the (candidate column) will not be displayed in the list; Click on the field name and display the relevant operation buttons on the right.",contextMenus:{"new":"New Header",newChild:"New Child Header",setDataField:"Assign Data Columns",rename:"Rename",top:"Top",up:"Up",down:"Down",bottom:"Bottom",cancelGroup:"Cancel",remove:"Remove"},candidate:"Candidate columns",setHeader:"Set as header",ok:"Ok",cancel:"Cancel",required:"Please enter a header name!",defaultGroupHeaderName:"NewHeader",newHeaderPlaceholder:"Please enter a header name.",newHeaderLabel:"Header Name"}},"zh-CHS":{"datagrid-settings":{noAuth:{"public":"您没有将方案的使用范围设置为公共的权限。",org:"您没有将方案的使用范围设置为组织的权限。"},has:{exist:"方案名称已存在，请修改。",chs:"简体中文名称已存在。",cht:"繁体中文名称已存在。",en:"英文名称已存在。"},required:{schemeName:"请输入方案名称。",chs:"请输入简体中文名称。",cht:"请输入繁体中文名称。",en:"请输入英文名称。",org:"请选择组织。"},groupRowStatus:{label:"分组行状态",expand:"展开",collapse:"折叠"},column:{title:"列标题",fixed:"固定列",unFixed:"不固定",leftFixed:"固定在左侧",rightFixed:"固定在右侧"}},"datagrid-scheme":{saveTitle:"保存方案",namePlaceholder:"请输入方案名称（最多不超过9个字符）",setPrivate:"设为个人",privateTip:"设为个人时，只能自己查看、使用该方案",setPublic:"设为公共",publicTip:"设为公共时，所有用户都可查看、使用该方案",setOrg:"设为组织",orgTip:"设为组织时，组织内的用户均能查看、使用该方案",setDefault:"设为默认",defaultTip:"下次进入此功能时，默认加载该方案",syspreset:"系统预制",isDefault:"默认",isPublic:"公共",isOrg:"组织",isPrivate:"个人",newScheme:"新增方案",mgrScheme:"管理",saveas:"另存为",onlyshowcolumns:"仅看展示列",schemeList:"方案列表","delete":"删除",columns:{name:"名称",type:"属性",isDefault:"默认",username:"创建人",mgr:"管理"},currentSheme:"当前方案：",schemeChanged:{title:"方案已更改，是否另存为新方案？",tips:"取消：放弃修改；否：保存当前方案；是：方案另存为",yes:"是",no:"否",cancel:"取消"},noDisplyColumnTip:"请设置要显示的字段"},headerGroup:{title:"多表头",preview:"预览效果",tips:"在（候选列）中的字段，将不在列表中显示; 点击字段名称，在右侧显示相关操作按钮。",contextMenus:{"new":"新建表头",newChild:"新建子级表头",setDataField:"分配数据列",rename:"重命名",top:"置顶",up:"上移",down:"下移",bottom:"置底",cancelGroup:"取消分组",remove:"移除"},candidate:"(候选列)",setHeader:"设为表头",ok:"确定",cancel:"取消",required:"请输入表头名称！",defaultGroupHeaderName:"分组表头1",newHeaderPlaceholder:"请输入名称",newHeaderLabel:"表头名称"}},"zh-CHT":{"datagrid-settings":{noAuth:{"public":"您沒有將方案的使用範圍設置爲公共的權限。",org:"您沒有將方案的使用範圍設置爲組織的權限。"},has:{exist:"方案名稱已存在，請修改。",chs:"簡體中文名稱已存在。",cht:"繁體中文名稱已存在。",en:"英文名稱已存在。"},required:{schemeName:"請輸入方案名稱.",chs:"請輸入簡體中文名稱。",cht:"請輸入繁體中文名稱。",en:"請輸入英文名稱。",org:"請選擇組織。"},groupRowStatus:{label:"分組行狀態",expand:"展開",collapse:"折疊"},column:{title:"列標題",fixed:"固定列",unFixed:"不固定",leftFixed:"固定在左側",rightFixed:"固定在右側"}},"datagrid-scheme":{saveTitle:"保存方案",namePlaceholder:"請輸入方案名稱（最多不超過9個字符）",setPrivate:"設爲個人",privateTip:"設爲個人時，只能自己查看、使用該方案",setPublic:"設爲公共",publicTip:"設爲公共时，所有用戶都可查看、使用該方案",setOrg:"設爲組織",orgTip:"設爲組織時，組織內的用戶均能查看、使用該方案",setDefault:"設爲默認",defaultTip:"下次進入此功能時，默認加載該方案",syspreset:"系統預制",isDefault:"默認",isPublic:"公共",isOrg:"組織",isPrivate:"個人",newScheme:"新增方案",mgrScheme:"管理",saveas:"另存爲",onlyshowcolumns:"僅看展示列",schemeList:"方案列表","delete":"刪除",columns:{name:"名稱",type:"屬性",isDefault:"默認",username:"創建人",mgr:"管理"},currentSheme:"當前方案：",schemeChanged:{title:"方案已更改，是否另存爲新方案？",tips:"取消：放棄修改；否：保存當前方案；是：方案另存爲",yes:"是",no:"否",cancel:"取消"},noDisplyColumnTip:"請設置要顯示的字段"},headerGroup:{title:"多表頭",preview:"預覽效果",tips:"在（候選列）中的字段，將不在列表中顯示; 點擊字段名稱，在右側顯示相關操作按鈕。",contextMenus:{"new":"新建表頭",newChild:"新建子級表頭",setDataField:"分配數據列",rename:"重命名",top:"置頂",up:"上移",down:"下移",bottom:"置底",cancelGroup:"取消分組",remove:"移除"},candidate:"(候選列)",setHeader:"設爲表頭",ok:"確定",cancel:"取消",newHeaderPlaceholder:"請輸入名稱",newHeaderLabel:"表頭名稱"}}},B=new i.InjectionToken(" Farris DataGrid User Setting WebApi URI."),X=function(){function e(e,t,n,r,s){this.injector=e,this.modalSer=t,this.messager=n,this.idService=r,this.localeSer=s,this.multiSortMsg="列表中未开启多列排序的功能。 请检查！",this.columnsSortableMsg="未开启列的排序功能。请检查！",this.notShowDialog="多表头暂不支持列显示设置；同时未启用列排序功能。",this._httpRestService=null,this.languages=[],this.gridRefs=null,this.activeSchemeItem=null,this.saving=!1,this.cfr=null,this.app=null,this.schemeListSubscription=null,this.currentSchemeitem=null,this.prevSchemeItem=null,this.debugSer=null,this.cfr=this.injector.get(i.ComponentFactoryResolver),this.app=this.injector.get(i.ApplicationRef),this.notifyService=this.injector.get(c.NotifyService,null),this.debugSer=this.injector.get(h.DebugService,null),this.commonUtils=this.injector.get(h.CommonUtils,new h.CommonUtils),this.schemeService=new $(this.injector),this.localeSer.setLocaleData(W)}return Object.defineProperty(e.prototype,"httpRestService",{get:function(){return this._httpRestService},set:function(e){this._httpRestService=e,this.schemeService&&this.schemeService.setRestService(e)},enumerable:!0,configurable:!0}),e.prototype.setUriPerfixStr=function(e){if(""==e&&window.gspframeworkService&&window.gspframeworkService.common){var t=window.gspframeworkService.common.getBasePath;t&&t.get&&(e=t.get())}""!=e&&null!==e&&this.schemeService.setUriPerfix(e)},e.prototype.destroy=function(e){this.gridRefs&&(e&&this.gridRefs[e]?(this.gridRefs[e]=null,delete this.gridRefs[e]):Object.keys(this.gridRefs).length||(this.gridRefs=null)),this.saving=!1,this.setActiveSchemeItem(e,null),this.schemeService.destory(e)},e.prototype.writeDebugMsg=function(e,t){void 0===t&&(t="warn"),this.debugSer&&(this.debugSer[t]?this.debugSer[t](e):console[t](e))},e.prototype.registerGridInstance=function(e){if(e){var t=e.id;this.gridRefs=this.gridRefs||{},this.gridRefs[t]||(this.gridRefs[t]=e)}else this.writeDebugMsg("DatagridSettingService: grid instance is null.")},e.prototype.getGridInstance=function(e){return this.gridRefs?this.gridRefs[e]:null},e.prototype.updateSchemeSettings=function(e,t){if(e&&t){var n=e.queryConditionString?JSON.parse(e.queryConditionString):{};if(n){if(n[this.localeSer.localeId]){var i=n[this.localeSer.localeId]||{};n[this.localeSer.localeId]=Object.assign(i,t)}else n[this.localeSer.localeId]=t;e.queryConditionString=JSON.stringify(n)}}},e.prototype.updateActiveSchemeItemSettings=function(e,t){var n=this.getActiveSchemeItem(e);this.updateSchemeSettings(n,t),n&&this.schemeService.updateSchemeData(e,n)},e.prototype.setActiveSchemeItem=function(e,t){var n=this.schemeService.getSchemeKey(e);this.activeSchemeItem=this.activeSchemeItem||{},t?this.activeSchemeItem[n]=d.cloneDeep(t):delete this.activeSchemeItem[n]},e.prototype.getActiveSchemeItem=function(e){var t=this.schemeService.getSchemeKey(e);return this.activeSchemeItem?this.activeSchemeItem[t]:null},e.prototype.getSearchTypes=function(){return[{value:"all",title:this.localeSer.getValue("datagrid.settings.allColumns")},{value:"visible",title:this.localeSer.getValue("datagrid.settings.visibleColumns")},{value:"hidden",title:this.localeSer.getValue("datagrid.settings.hiddenColumns")}]},e.prototype.showSimple=function(e,i,r){var s=this,o=this.getCurrentConfigs().columns||e.columns,l=this.convertColumnsToSimple(o);l[0]=I(l[0].filter(function(t){return t.field&&t.field!==e.ControlPanelFeild}));var a=this.getSearchTypes();if(this.cfr){var c=this.cfr.resolveComponentFactory(G).create(this.injector);if(this.app.attachView(c.hostView),c.instance.columns=l,c.instance.seartTypes=a,c.instance.gridInstance=e,c.instance.schemeSer=this.schemeService,document.querySelector("#page-wrapper")&&(c.instance.top=76),c.instance.enableScheme=e.enableScheme,i||(i=this.getCurrentConfigs()),e.enableScheme){var u=this.getActiveSchemeItem(e.id);i?(!c.instance.prevSchemeItem&&this.prevSchemeItem&&(c.instance.prevSchemeItem=d.cloneDeep(this.prevSchemeItem)),r?(this.updateSchemeSettings(r,i),c.instance.currentSchemeItem=r):u?(this.currentSchemeitem=u,this.prevSchemeItem=d.cloneDeep(u),c.instance.currentSchemeItem=u):(Object.keys(i).length||(i=this.getLocalSettings(this.createConfigKey(e.id))),c.instance.currentSchemeItem=null,c.instance.settings=i)):(this.currentSchemeitem=u,this.prevSchemeItem=d.cloneDeep(u),c.instance.currentSchemeItem=u)}else e.enableSetMultiHeaders?c.instance.settings=this.getCurrentConfigs():c.instance.settings=i;var h=this.commonUtils.getFloatingLayerIndex();return c.location.nativeElement.style.zIndex=""+h,document.body.appendChild(c.location.nativeElement),c.instance.canceld.subscribe(function(){s.restoreScheme(e)}),c.instance.closed.pipe(t.switchMap(function(){if(c)return c.instance.container.nativeElement.style.right="-500px",n.timer(500)})).subscribe(function(){c.location.nativeElement.remove(),c.destroy(),c=null,s.schemeListSubscription&&s.schemeListSubscription.unsubscribe();var t=s.getActiveSchemeItem(e.id);if((!s.currentSchemeitem||t&&t.id!==s.currentSchemeitem.id)&&t&&t.queryConditionString){var n=JSON.parse(t.queryConditionString)[s.localeSer.localeId];n&&l[0].forEach(function(e){e.visible=n.viewColumns.indexOf(e.field)>-1})}}),c.instance.advanced.subscribe(function(t){t.viewFields;var n=t.settings,i=t.columns;s.setCurrentConfigs(C({},n,{columns:i})),s.prevSchemeItem=c.instance.prevSchemeItem,s.SCHEME_DEFAULT_TITLE=c.instance.defaultSchemeName,s.showAdvanced(e,null,c.instance.currentSchemeItem)}),c.instance.submit.subscribe(function(t){s.applySettings(t,e)}),c.instance.submitForGroupHeader.subscribe(function(t){s.applySettings(t,e)}),c.instance.addNewScheme.subscribe(function(t){s.showNewSchemeDialog(e,t,c.instance.collectSettings(),{ok:function(e){c.instance.onSchemeItemClick(null,e),s.saveUserConfig}})}),c.instance.schemeList=this.schemeService.getStateValue(e.id,"list")||[],c.instance.showSchemeList.subscribe(function(){s.getSchemeList(e.id).pipe(t.switchMap(function(e){return s.schemeService.checkAuthority().pipe(t.map(function(t){return C({list:e},t)}))})).subscribe(function(t){s.schemeService.setSchemeList(e.id,t.list||[]),s.showSchemeListDialog(e,d.cloneDeep(t.list||[]),t,c)})}),this.schemeListSubscription=this.schemeService.schemeList$.subscribe(function(t){if(c.instance.schemeList=t,t&&t.length){var n=s.getActiveSchemeItem(e.id);if(n){var i=t.find(function(e){return e.id===n.id});i||(i=s.getDefaultScheme(t),s.setActiveSchemeItem(e.id,i||null)),c.instance.currentSchemeItem=i}}else s.setActiveSchemeItem(e.id,null)}),c.instance.schemeChanged.subscribe(function(t){s.currentSchemeitem=t,s.setActiveSchemeItem(e.id,d.cloneDeep(t))}),c.hostView.detectChanges(),c.instance.cd.detectChanges(),c.instance.container.nativeElement.style.right="0px",c}},e.prototype.show=function(e,t){return this.registerGridInstance(e),e.enableSimpleMode?(this.schemeService.createSchemeTaskID(),this.showSimple(e)):this.showAdvanced(e,t)},e.prototype.restoreScheme=function(e){e.enableScheme?(this.setActiveSchemeItem(e.id,this.prevSchemeItem),this.prevSchemeItem||this.setCurrentConfigs(null)):this.setCurrentConfigs(null)},e.prototype.showAdvanced=function(e,t,n){var i=this,r=!0;!0!==this.canSetColumnSort(e)&&(r=!1);var s=!e.isMultiHeader()||e.isMultiHeader()&&e.enableSetMultiHeaders,o=s?1:r?2:-1;if(-1!==o){var l=this.convertColumnsToSimple(this.getCurrentConfigs().columns||e.columns),a=this.getCurrentConfigs(),c=a&&a.multiHeaders?a.multiHeaders.treeData:null;if(n&&n.queryConditionString){var u=JSON.parse(n.queryConditionString)[this.localeSer.localeId];(a=Object.assign(u||{},a||{})).columnFormat&&a.columnFormat.length&&(l[0]=l[0].map(function(e){var t=a.columnFormat.find(function(t){return t.field===e.field});return t&&(e=Object.assign(e,t)),e}))}!e.enableSetMultiHeaders&&a.viewColumns&&a.viewColumns.length&&l[0].forEach(function(e){e.visible=a.viewColumns.indexOf(e.field)>-1}),l[0]=l[0].filter(function(t){return t.field&&t.field!==e.ControlPanelFeild});var h=R(d.cloneDeep(l)).filter(function(e){return-1==e.field.indexOf("farris-datagrid-column_")&&e.sortable});e.enableSetMultiHeaders&&a&&a.multiHeaders&&(h=R(a.multiHeaders.viewCols).filter(function(e){return-1==e.field.indexOf("farris-datagrid-column_")&&e.sortable}));var p=null,f={width:760,height:560,showHeader:!1,title:"控制面板",initialState:{columns:l,sortTreeData:h,gridInstance:e,canSetColumnSort:r,canSetColumnVisible:s,activeTabIndex:o,schemeInfo:a,enableMultipleHeaders:e.enableSetMultiHeaders,multiHeaders:{columns:l,treeData:c},schemeName:n?n._title_:this.SCHEME_DEFAULT_TITLE},showButtons:!1,closed:function(t,n){var r=n.event;r&&"Escape"===r.code&&i.restoreScheme(e)}},m=Object.assign(f,t||{}),g=(p=this.modalSer.show(N,m)).content;return g.enableReset=!0,g.modalRef=p,g.canSetColumnSort=r,g.canSetColumnVisible=s,g.submitHandle.subscribe(function(t){i.applySettings(t,e,{modalRef:p,currentScheme:n})}),g.cancelHandle.subscribe(function(t){p.close(),i.restoreScheme(e)}),g.concise.subscribe(function(t){p.close();var r=p.content,s=r.sortInfo,o=r.viewColumns,l=r.columnFormat,a=r.groupField,c=r.multiHeaders;i.setCurrentConfigs({sortInfo:s,viewColumns:o,columnFormat:l,groupField:a,multiHeaders:c}),i.showSimple(e,{sortInfo:s,viewColumns:o,columnFormat:l,groupField:a,multiHeaders:c},d.cloneDeep(n))}),p.dialog.instance.draggbar.handle=g.header.nativeElement,p}this.messager.warning(this.notShowDialog)},e.prototype.canSetColumnSort=function(e){return!(!e.multiSort||!this.hasEnableSortColumns(e))||(this.hasEnableSortColumns(e)?e.multiSort?void 0:this.multiSortMsg:this.columnsSortableMsg)},e.prototype.hasEnableSortColumns=function(e){return e.flatColumns.reduce(function(e,t){return t.sortable?e+1:e},0)>0},e.prototype._convertColumnsToSimple=function(e){var t=e.columns,n=e.dfs._state.initialOptions;if(n.columnFields){var i=n.columnFields,r=[];i.forEach(function(t){if("_datagrid-setting-control_"!==t.field){var n=e.columns[0].find(function(e){return e.field===t.field});n&&r.push(n)}}),t=[r]}return t},e.prototype.convertColumnsToSimple=function(e){return Array.isArray(e[0])||(e=[e]),e.map(function(e){return e.map(function(e){if("_datagrid-setting-control_"!==e.field)return{field:e.field,title:e.title,colspan:e.colspan,rowspan:e.rowspan,sortable:e.sortable,order:e.order,halign:e.halign||"left",align:e.align||"left",visible:e.visible,allowGrouping:e.allowGrouping,groupFooter:e.groupFooter,footer:e.footer,width:e.width||100,dataType:e.dataType||"string",fixed:e.fixed||"UNFIXED"}}).filter(function(e){return e})})},e.prototype.resetGridView=function(e){if(e){var t=e.dfs;if(t){var n=t._state.initialOptions;if(n.sort&&(n.sort.sortName&&(e.sortName=n.sort.sortName),n.sort.sortOrder&&(e.sortOrder=n.sort.sortOrder)),e.groupField=n.groupField||"",n.columnFields&&n.columnFields.length){var i=[];n.columnFields.forEach(function(t){var n=e.columns[0].find(function(e){return e.field===t.field});n&&(n.visible=t.visible,n.halign=t.halign,n.align=t.align,n.width=t.width,n.footer=t.footer,n.groupFooter=t.groupFooter,i.push(n))}),e.columns[0]=i}e.columnsChanged()}}},e.prototype.updateGridView=function(e,t,n,i){var r=this;void 0===n&&(n=null),void 0===i&&(i=null);var s,o,l,a=e.content;if(a){var c=a.sortInfo,u=a.viewColumns,h=a.columnFormat,p=a.groupField,f=a.expandGroupRows,m=a.multiHeaders,g=h?this.convertColumnsToSimple(h)[0]:[];this.saving=!0;var v="";t.groupRows&&p&&p.length&&("string"==typeof p?v=p:Array.isArray(p)&&(v=p.join(",")));var y=c;t.enableSetMultiHeaders&&m&&(v&&(s=m.viewCols,o=v.split(","),l=R(s),v=o.map(function(e){return l.find(function(t){return t.field===e})}).filter(function(e){return e}).map(function(e){return e.field})),c&&c.sortName&&c.sortName.length&&(y=function(e,t){var n=R(e);return{sortName:t.sortName.map(function(e,i){var r=n.find(function(t){return t.field===e});return r||t.sortOrder.splice(i,1),r}).filter(function(e){return e}).map(function(e){return e.field}),sortOrder:t.sortOrder}}(m.viewCols,c)));var b={sortInfo:y,viewColumns:u,groupField:v,columnFormat:g,expandGroupRows:f,multiHeaders:m},S=function(){if(t.groupRows&&(t.expandGroupRows=f,t.groupField=v),t.enableSetMultiHeaders?function(e,t){if(e){var n=e.dfs._state.initialOptions;t&&n&&(e.columns=E(t,n))}}(t,m.viewCols||[]):u&&u.length&&(t.columns=t.columns.map(function(e){return r.updateColumnFormat(e,h,t),r.newVisibleOrderColumns(e,u,h,t)})),t.columnsChanged(!0),c&&Object.keys(c).length){var e=c.sortName,n=c.sortOrder;e&&e.length?t.sort(e.join(","),n.join(",")):t.clearSort()}else t.clearSort()},C=function(){r.setUserConfig(t.id,b).subscribe(function(){n&&(n.disabled=!1),r.saving=!1,S(),r.setActiveSchemeItem(t.id,i),r.prevSchemeItem=i,r.updateActiveSchemeItemSettings(t.id,b),r.setCurrentConfigs(b),e.close()})};if(t.showConfirmWhenSchemeChanged&&t.enableScheme){var w=this.localeSer.getValue("datagrid-scheme.schemeChanged");if(this.schemeService.isSchemeChanged(b,t.enableSetMultiHeaders))var I=this.messager.question2(w.title,[{text:w.cancel,cls:"btn btn-light",handle:function(){r.saving=!1,e.close(),I.close(),r.restoreScheme(t)}},{text:w.no,cls:"btn btn-secondary",handle:function(){I.close(),C()}},{text:w.yes,cls:"btn btn-primary",handle:function(){r.showNewSchemeDialog(t,{type:"saveas"},b,{ok:function(n){r.saving=!1,e.close(),r.currentSchemeitem=n,r.setActiveSchemeItem(t.id,d.cloneDeep(n)),S()},cancel:function(){r.saving=!1,n&&(n.disabled=!1)}}),I.close()}}]);else this.currentSchemeitem&&this.prevSchemeItem&&this.currentSchemeitem.id===this.prevSchemeItem.id?(this.saving=!1,e.close(),S()):C()}else C()}else e.close()},e.prototype.newVisibleOrderColumns=function(e,t,n,i){var r=this,s=[];e.forEach(function(e,o){r.isNewAddColumn(e.field,n)&&"_datagrid-setting-control_"!==e.field&&!i.enableScheme?t.push(e.field):(e.visible=t.includes(e.field),e.visible||s.push(e))});var o=t.map(function(t){return e.find(function(e){return e.field===t})}).filter(function(e){return e});return s.length&&(o=o.concat(s)),o.filter(function(e){return e&&e.field&&"_datagrid-setting-control_"!==e.field})},e.prototype.isNewAddColumn=function(e,t){return!(t=t||[]).find(function(t){return t.field===e})},e.prototype.updateColumnFormat=function(e,t,n){t&&t.length&&e.forEach(function(e){var i=t.find(function(t){return t.field===e.field});i&&(e.width=i.width,e.halign=i.halign||"left",e.align=i.align||"left",e.fixed="UNFIXED"===i.fixed?"":i.fixed,e.title=i.title,n.groupRows&&(e.allowGrouping||e.allowGrouping===undefined)&&(e.groupFooter||(e.groupFooter=i.groupFooter),e.groupFooter&&e.groupFooter.options&&(i.groupFooter.options||(i.groupFooter.options={}),e.groupFooter.options.text=i.groupFooter.options.text||"",e.groupFooter.options.calculationType=i.groupFooter.options.calculationType!==undefined&&null!==i.groupFooter.options.calculationType?parseInt(i.groupFooter.options.calculationType,10):-1)),n.showFooter&&!n.footerTemplate&&(e.footer||(e.footer=i.footer),e.footer&&e.footer.options&&(i.footer.options||(i.footer.options={}),e.footer.options.text=i.footer.options.text||"",e.footer.options.calculationType=i.footer.options.calculationType!==undefined&&null!==i.footer.options.calculationType?parseInt(i.footer.options.calculationType,10):-1)))})},e.prototype.createConfigKey=function(e){var t=this.getGridInstance(e);if(t)return t.dgs.createConfigKey(e);this.writeDebugMsg("DatagridSettingService: Can not find the grid instance.")},e.prototype.getCurrentUserSettings=function(e){var t=this.getGridInstance(e),n={sortInfo:{},viewColumns:[],groupField:"",columnFormat:[]};if(t){var i=t.sortName,r=t.sortOrder,s=t.columns;if(i){var o={sortName:i.split(","),sortOrder:r.split(",")};n.sortInfo=o}var l=s[0].filter(function(e){return e.visible||e.visible===undefined}).map(function(e){return e.field});n.viewColumns=l,n.columnFormat=this.convertColumnsToSimple(this._convertColumnsToSimple(t))[0],t.groupRows&&(n.groupField=t.groupField)}return n},e.prototype.saveUserConfig=function(e){var t=this.getCurrentUserSettings(e);return this.setUserConfig(e,t)},e.prototype.setUserConfig=function(e,i){var r=this,s=this.getGridInstance(e),o=this.createConfigKey(e),l=this.localeSer.localeId,a=localStorage.getItem(o),c=(a?JSON.parse(a):{})||{};if(i?(c&&(c[l]=i),s&&s.enableSetMultiHeaders&&(c.isMultiHeader=!0),localStorage.setItem(o,JSON.stringify(c))):localStorage.removeItem(o),this.httpRestService){if(s&&s.enableScheme){var u=this.getActiveSchemeItem(e);return u?(this.updateSchemeSettings(u,i),"private"===u.type?this.schemeService.saveScheme(u,e,!0,s.enableSetMultiHeaders):this.schemeService.checkAuthority().pipe(t.switchMap(function(t){if(t.success){var i=t.authOrganizationData&&t.authOrganizationData.length;if("public"===u.type||"org"===u.type&&i)return r.schemeService.saveScheme(u,e,!0,s.enableSetMultiHeaders)}return n.of(!0)}))):this._saveUserConfig(o,i?c:"")}return this._saveUserConfig(o,i?c:"")}return n.of(!0)},e.prototype.getUserConfig=function(e,t){return void 0===t&&(t=!1),this.httpRestService?this._getUserConfig(e,t):n.of(this.getLocalSettings(e,t))},e.prototype.getLocalSettings=function(e,t){void 0===t&&(t=!1);var n=localStorage.getItem(e);if(n){var i=JSON.parse(n);return t&&!i.isMultiHeader?null:i.isMultiHeader?null:i[this.localeSer.localeId]?i[this.localeSer.localeId]:Object.keys(i).indexOf("viewColumns")>-1?i:null}return null},e.prototype.getDefaultScheme=function(e){var t=this,n=null;if(!(e=e.filter(function(e){return JSON.parse(e.name)[t.localeSer.localeId]}))||!e.length)return n;if(!(n=e.find(function(e){return e.isDefault}))){var i=e.filter(function(e){return"public"===e.type});i.length||(i=e.filter(function(e){return"org"===e.type})),n=i.length?i[0]:e[0]}return n},e.prototype.getSettings=function(e){var i=this,r=this.createConfigKey(e),s=this.getGridInstance(e),o=n.of([]);return s&&s.enableScheme&&(o=this.getSchemeList(e)),n.forkJoin(o,this.getUserConfig(r),this.schemeService.getLanguages()).pipe(t.map(function(t){var n=w(t,3),s=n[0],o=n[1],l=n[2];if(s=s||[],i.languages=l,s.length){i.setSchemeList(s,e);var a=i.getDefaultScheme(s);if(a){i.setActiveSchemeItem(e,a);var c=null;if(a.queryConditionString&&(c=JSON.parse(a.queryConditionString)),c){var u=i.localeSer.localeId;return c[u]?(localStorage.setItem(r,JSON.stringify(c)),c[u]):(c[u]=null,localStorage.setItem(r,JSON.stringify(c)),null)}return null}return o}return o}))},e.prototype._saveUserConfig=function(e,t){try{var n={configkey1:e,configkey2:"",configkey3:"",textvalue:t?JSON.stringify(t):""};return this.httpRestService.saveUserSettings(n)}catch(i){this.writeDebugMsg(i,"error")}},e.prototype.resetUserConfig=function(e,i){var r=this,s=this.localeSer.getValue("datagrid.settings.restoreDefaultSettingsText")||"确认要恢复默认设置吗？";this.messager.confirm(s).pipe(t.switchMap(function(t){return t?r.setUserConfig(e.id,""):n.of(t)})).subscribe(function(t){t&&(r.resetGridView(e),i.close())})},e.prototype._getUserConfig=function(e,n){var i=this;void 0===n&&(n=!1);try{return this.httpRestService.getUserSettings(e).pipe(t.map(function(t){if(t&&t.textValue){var r=JSON.parse(t.textValue);return r?n&&!r.isMultiHeader?null:r.isMultiHeader?null:r[i.localeSer.localeId]?(localStorage.setItem(e,t.textValue),r[i.localeSer.localeId]):(r[i.localeSer.localeId]=null,localStorage.setItem(e,JSON.stringify(r)),null):null}return null}))}catch(r){this.debugSer&&this.debugSer.error(r)}},e.prototype.buildSubmitData=function(e,t){void 0===t&&(t=null);var n=this.localeSer.localeId;t||(t=this.getCurrentUserSettings(e));var i=this.createConfigKey(e),r=localStorage.getItem(i),s=(r?JSON.parse(r):{})||{};return s&&(s[n]=t),s},e.prototype.showSchemeListDialog=function(e,t,n,i){var r=this,s={width:760,height:577,showHeader:!1,title:"控制面板",initialState:{items:(t||[]).filter(function(e){return JSON.parse(e.name)[r.localeSer.localeId]}),removeItem:n.success,currentUserId:n.currentUserId,currentSchemeId:this.currentSchemeitem?this.currentSchemeitem.id:""},showButtons:!1},o=this.modalSer.show(q,s),l=o.content;l.closeModal.subscribe(function(){o.close()}),l.submitModal.subscribe(function(n){r.schemeService.updateScheme(n,e.id,e.enableSetMultiHeaders).subscribe(function(s){if(!1!==s){var l="列设置方案保存成功。";r.notifyService?r.notifyService.success(l):r.messager.success(l),n.defaultId&&t.forEach(function(e){e.isDefault=!1,e.id===n.defaultId&&(e.isDefault=!0)});var a=t;n.deletedIds&&n.deletedIds.length&&(a=t.filter(function(e){return!n.deletedIds.includes(e.id)})),r.schemeService.setSchemeList(e.id,a),o.close(),r.getActiveSchemeItem(e.id)||(r.setActiveSchemeItem(e.id,null),i.instance.currentSchemeItem=null,i.instance.resetToDefault(),r.prevSchemeItem=null,i.instance.onSubmitClick())}else o.close()})}),o.dialog.instance.draggbar.handle=l.header.nativeElement},e.prototype.showNewSchemeDialog=function(e,n,i,r){var s=this,o={width:480,height:269,showHeader:!1,title:"控制面板",initialState:{languages:this.languages},showButtons:!1,resizable:!1},l=this.modalSer.show(z,o),a=l.content;a.closeModal.subscribe(function(){l.close(),r&&r.cancel&&r.cancel()}),a.submitModal.pipe(t.switchMap(function(t){return s.createNewScheme(e.id,t,"new"===n.type,i)})).subscribe(function(t){if(!1!==t.flag){var n=s.schemeService.getStateValue(e.id,"list")||[];t.isDefault&&n.forEach(function(e){e.isDefault=!1}),n.push(t),s.schemeService.setSchemeList(e.id,n),r&&r.ok&&r.ok(t),l.close()}else{var i=t.msg,o=i;i&&(o=i.indexOf("|")>-1?i.split("|").map(function(e){return s.localeSer.getValue("datagrid-settings."+e)}).join(""):s.localeSer.getValue("datagrid-settings."+i),s.notifyService?s.notifyService.info(o):s.messager.info(o))}}),a.checkAuthority.pipe(t.switchMap(function(e){return s.schemeService.checkAuthority().pipe(t.map(function(t){return C({type:e},t)}))})).subscribe(function(e){var t={"public":!0,org:!0},n="noAuth.public";"org"===e.type.value&&(n="noAuth.org");var i=s.localeSer.getValue("datagrid-settings."+n);if(e.success){var r=e.authOperationData&&e.authOperationData.length;t["public"]=r;var o=e.authOrganizationData&&e.authOrganizationData.length;t.org=o,"public"===e.type.value?a.schemeInfo.type=e.type.value:"org"===e.type.value&&(o?(a.schemeInfo.type=e.type.value,a.schemeInfo.orgids=e.authOrganizationData.join(","),a.dataPermissionIds=e.authOrganizationData):s.notifyService.warning(i))}else s.notifyService.warning(i),t={"public":!1,org:!1};a.refresh(t)}),l.dialog.instance.draggbar.handle=a.header.nativeElement},e.prototype.getSchemeList=function(e){var t=this.getGridInstance(e);return this.schemeService.getSchemeList(e,t.enableSetMultiHeaders)},e.prototype.createNewScheme=function(e,i,r,s){var o;if(void 0===r&&(r=!0),!i.name)return n.of({flag:!1,msg:"required.schemeName"});var l=this.schemeService.hasSchemeName(e,i.name);if("boolean"==typeof l&&l)return n.of({flag:!1,msg:"has.exist"});if(Array.isArray(l)&&l.length){var a=function(e){return"zh-CHS"===e?"has.chs":"zh-CHT"===e?"has.cht":"has.en"};if(l.includes(this.localeSer.localeId)){var c=a(this.localeSer.localeId);return n.of({flag:!1,msg:c})}var u=l.map(function(e){return a(e)});return n.of({flag:!1,msg:u.join("|")})}var d=[];if(i.name[this.localeSer.localeId]||d.push(this.localeSer.localeId),d.length){u=d.map(function(e){return"zh-CHS"===e?"required.chs":"zh-CHT"===e?"required.cht":"required.en"});return n.of({flag:!1,msg:u.join("|")})}if(i.type&&"org"===i.type&&(!i.orgids||!i.orgids.length))return n.of({flag:!1,msg:"required.org"});var h=null;if(!r){var p=this.localeSer.localeId;s&&s.columnFormat&&(s.columnFormat=this.convertColumnsToSimple(s.columnFormat)),(o={})[p]=s,h=o}var f=this.idService.guid(),m=i.isDefault;m&&"private"!==i.type&&(m=!1),i.name&&"object"==typeof i.name&&(i.name=JSON.stringify(i.name));var g=this.getGridInstance(e);g&&g.enableSetMultiHeaders&&h&&(h.isMultiHeader=g.enableSetMultiHeaders);var v={id:f,belongId:"",code:"",name:i.name,type:i.type,isDefault:m,isSystem:!1,extendId:"datagrid-settings-scheme",extendInfo:this.buildOrgAndSchemeRelations(f,i.orgids),queryConditionString:h?JSON.stringify(h):""};return this.schemeService.saveScheme(v,e,!1,g.enableSetMultiHeaders).pipe(t.map(function(){return v}))},e.prototype.setSchemeList=function(e,t){this.schemeService.update({list:e},t)},e.prototype.buildOrgAndSchemeRelations=function(e,t){var n=this;return t&&t.length?("string"==typeof t&&(t=t.split(",")),t.map(function(t){return{id:n.idService.guid(),orgId:t,relatedId:e}})):[]},e.prototype.getCurrentSchemeSettings=function(e){var t=this.getActiveSchemeItem(e);return t&&t.queryConditionString?JSON.parse(t.queryConditionString):null},e.prototype.setCurrentConfigs=function(e){this.CURRENT_CONFIGS=e},e.prototype.getCurrentConfigs=function(){return this.CURRENT_CONFIGS||{}},e.prototype.applySettings=function(e,t,n){if(e.target.disabled=!0,!this.saving&&!this.saving){var i=void 0,r=void 0;if(n)r=n.modalRef,i=n.currentScheme;else r=e,i=e.currentScheme;this.updateGridView(r,t,e.target,i)}},e.prototype.getMultiHeaderColumns=function(e,t){return E(e,t)},e.decorators=[{type:i.Injectable}],e.ctorParameters=function(){return[{type:i.Injector},{type:r.BsModalService},{type:s.MessagerService},{type:h.IdService},{type:o.LocaleService}]},e}(),J=function(){function e(e,t){this.injector=e,this.cd=t,this.idField="field",this.valueField="field",this.textField="title",this.selectedIds=[],this.treeData=[],this.sortInfoChange=new i.EventEmitter}return e.prototype.ngOnInit=function(){},e.prototype.setFieldSortOrder=function(e,t,n){return e.stopPropagation(),t.sortable=!0,t.order=n,n||this.ms.moveToLeft(t),this.cd.detectChanges(),this.onSelectionsChange(null),!1},e.prototype.getSortInfo=function(){if(this.ms.selections){var e=[],t=[];return this.ms.selections.forEach(function(n){n.order=n.order||"asc",e.push(n.field),t.push(n.order)}),{sortName:e,sortOrder:t}}return""},e.prototype.onSelectionsChange=function(e){var t=this.getSortInfo();this.sortInfoChange.emit(t)},e.prototype.onBeforeMove=function(e){var t=e.items;if(e.target.indexOf("rightAll")>-1)for(var n in t)e.items[n]&&(e.items[n].order="asc");else if("right"===e.target)for(var n in t)e.items[n]&&(e.items[n].order="asc")},e.decorators=[{type:i.Component,args:[{selector:"sort-setting",template:'<div style="padding: 10px;height: 100%;">\r\n<multi-select [dataSource]="treeData" [idField]="idField" [valueField]="valueField"\r\n[textField]="textField" [displayType]="\'List\'" style="height: 100%" [height]="0" [showCheckbox]="false"\r\n[(selectedId)]="selectedIds" [leftTitle]="\'datagrid.settings.canchoose\'|locale" [rightTitle]="\'datagrid.settings.choosed\'|locale" #ms (dataChange)="onSelectionsChange($event)" (beforeMove)="onBeforeMove($event)">\r\n    <ng-template farrisTemplate="text" let-data let-side="side" let-selected="selected" >\r\n        <ng-container *ngIf="side === \'L\'">\r\n            {{ data[textField] }}\r\n        </ng-container>\r\n        <ng-container *ngIf="side === \'R\' ">\r\n            \x3c!-- <span class="f-icon f-icon-sort-asc-sm sort-label" title="升序" *ngIf="data.sortable && data.order === \'asc\'"></span>\r\n            <span class="f-icon f-icon-sort-desc-sm  sort-label" title="降序" *ngIf="data.sortable && data.order === \'desc\'"></span> --\x3e\r\n            <div class="d-flex">\r\n                <div style="width: 120px;white-space: nowrap;min-width: 60px">\r\n                    {{ data[textField] }} \r\n                </div>\r\n                <div class="farris-input-wrap  farris-checkradio-hor flex-fill" style="justify-content: right;flex-wrap:nowrap">\r\n                    <button type="button" class="btn btn-link btn-icontext mr-2" style="font-size: 12px;" (click)="setFieldSortOrder($event, data, \'asc\')">\r\n                        <span class="f-icon" [class.f-icon-radiobutton]=" data.order && data.order !== \'asc\'" [class.f-icon-check-circle]="!data.order || data.order === \'asc\'"></span>\r\n                        {{\'datagrid.settings.asc\'|locale}}\r\n                    </button>\r\n                    \r\n                    <button type="button" class="btn btn-link btn-icontext mr-2" style="font-size: 12px;" (click)="setFieldSortOrder($event, data, \'desc\')">\r\n                        <span class="f-icon" [class.f-icon-radiobutton]="data.order !== \'desc\'" [class.f-icon-check-circle]="data.order === \'desc\'"></span>\r\n                        {{\'datagrid.settings.desc\'|locale}}\r\n                    </button>\r\n\r\n                    <button type="button" class="btn btn-link btn-icontext sort-btns" style="font-size: 12px;" style="margin-right: 0;" (click)="setFieldSortOrder($event, data, \'\')" title="{{\'datagrid.settings.cancelSort\'|locale}}">\r\n                        <span class="f-icon  f-icon-unsort"></span>\r\n                    </button>\r\n                </div>\r\n            </div>\r\n\r\n        </ng-container>\r\n    </ng-template>\r\n</multi-select>\r\n</div>'}]}],e.ctorParameters=function(){return[{type:i.Injector},{type:i.ChangeDetectorRef}]},e.propDecorators={idField:[{type:i.Input}],valueField:[{type:i.Input}],textField:[{type:i.Input}],selectedIds:[{type:i.Input}],treeData:[{type:i.Input}],ms:[{type:i.ViewChild,args:["ms"]}],sortInfoChange:[{type:i.Output}]},e}(),K=function(){function e(e,t,n){this.injector=e,this.gridSettingComponentRef=t,this.cd=n,this.fields=[],this.formatColumns=[],this.groupFields=[],this.expandGroupRows=!0,this.enabelGroupFooter=!1,this.groupFieldsChange=new i.EventEmitter,this.formatColumnsChange=new i.EventEmitter,this.expandGroupRowsChange=new i.EventEmitter,this.groupColumns=[],this.allowGroupColumns=[],this.activeCalculationCol=null,this.showSelectColumnsPanel=!1,this.summaryItems=[],this.summaryItems2=[]}return e.prototype.ngOnInit=function(){var e=this;this.summaryItems=this.gridSettingComponentRef.summaryItems,this.summaryItems2=this.gridSettingComponentRef.summaryItems2,this.setGroupColumns(),this.registerEventHandle(),this.initCalculationColumns(),this.colForm&&this.colForm.valueChanges.subscribe(function(t){e.colForm.pristine||e.formatColumnsChange.emit(e.formatColumns)}),this.formatColumns.forEach(function(t){e.checkColumnOptions(t)})},e.prototype.ngOnChanges=function(e){var t=this;e.formatColumns&&!e.formatColumns.isFirstChange()&&(this.formatColumns.forEach(function(e){t.checkColumnOptions(e)}),this.setGroupColumns(),this.initCalculationColumns())},e.prototype.initCalculationColumns=function(){this.formatColumns&&(this.activeCalculationCol=this.formatColumns[0])},e.prototype.registerEventHandle=function(){var e=this;this.groupingSettingEl.nativeElement.addEventListener("click",function(t){t.target!==e.selectcolumnspanel.nativeElement&&(e.showSelectColumnsPanel=!1)},!1)},e.prototype.setGroupColumns=function(){if(this.groupFields&&this.groupFields.length){var e=this.formatColumns;this.groupColumns=this.groupFields.map(function(t){return e.find(function(e){return e.field===t})}).filter(function(e){return e}),this.groupFields=this.groupColumns.map(function(e){return e.field}),this.groupFieldsChange.emit(this.groupFields)}else this.groupColumns=[];this.onGroupFieldsChange()},e.prototype.getAllowGroupingColumns=function(){return this.formatColumns.filter(function(e){return!(e.field.indexOf("farris-datagrid-column_")>-1)&&(e.allowGrouping||e.allowGrouping===undefined)})},e.prototype.onGroupFieldsChange=function(){this.groupFieldsChange.emit(this.groupFields)},e.prototype.checkColumnOptions=function(e){e&&(e.groupFooter===undefined?e.groupFooter={options:{calculationType:-1}}:(e.groupFooter.options=e.groupFooter.options||{calculationType:-1},e.groupFooter.options.calculationType===undefined&&(e.groupFooter.options.calculationType=-1)))},e.prototype.toggleGroupingColumnPanel=function(e){e.stopPropagation(),this.showSelectColumnsPanel=!this.showSelectColumnsPanel,this.allowGroupColumns=this.getAllowGroupingColumns()},e.prototype.addGroupColumn=function(e,t){e.stopPropagation(),-1===this.groupFields.indexOf(t.field)&&(this.groupColumns=I(this.groupColumns,[t]),this.groupFields=this.groupColumns.map(function(e){return e.field}),this.onGroupFieldsChange(),this.showSelectColumnsPanel=!1)},e.prototype.onRemoveGroupingField=function(e,t){e.stopPropagation(),this.groupFields=this.groupFields.filter(function(e){return e!==t.field}),this.setGroupColumns()},e.prototype.onGroupingFieldDropped=function(e){var t,n=e.removedIndex,i=e.addedIndex,r=this.groupFields.splice(n,1);(t=this.groupFields).splice.apply(t,I([i,0],r)),this.setGroupColumns()},e.prototype.onFieldClick=function(e,t){this.activeCalculationCol=t},e.decorators=[{type:i.Component,args:[{selector:"column-group-setting",template:'<div #groupingSetting class="d-flex flex-column flex-fill column-group-setting">\r\n\r\n    <div region="north" class="north d-flex flex-column group-fields" style="height: 78px; ">\r\n        <div class="title d-flex flex-row" style="justify-content: space-between;">\r\n            <div>{{\'datagrid.settings.grouppingField\' | locale }}\r\n                <span class="text-warning"> ({{\'datagrid.settings.moreGrouppingFieldWarningMessage\' | locale }})</span>\r\n            </div>\r\n            <div *ngIf="groupColumns && groupColumns.length">\r\n                {{\'datagrid-settings.groupRowStatus.label\' | locale}}：  <farris-switch style="display: inline-block;"\r\n                [square]="false"\r\n                [checked]="true"\r\n                [(ngModel)]="expandGroupRows"\r\n                [checkedLabel]="\'datagrid-settings.groupRowStatus.expand\' | locale" [uncheckedLabel]="\'datagrid-settings.groupRowStatus.collapse\' | locale" \r\n                (valueChange)="expandGroupRowsChange.emit(!!$event)"\r\n                ></farris-switch>\r\n            </div>\r\n        </div>\r\n        <div #groupfieldcontainer class="flex-fill p-2 all-fields">\r\n            <ul class="list-group" style="display: inline-block;"  column-group-drag (drop)="onGroupingFieldDropped($event)">\r\n                <li class="list-group-item list-group-item-action btn btn-light smooth-dnd-draggable-wrapper group-field"\r\n                *ngFor="let item of groupColumns">\r\n                    {{ item.title }}\r\n                    <span class="f-icon f-icon-close" style="cursor: pointer;" title="{{\'datagrid.settings.removeGrouppingFieldTip\' | locale }}" (click)="onRemoveGroupingField($event, item)"></span>\r\n                </li>\r\n\r\n                <li class="list-group-item list-group-item-action btn btn-light btn-add-groupfield" title="{{\'datagrid.settings.addGrouppingFieldTip\' | locale }}"\r\n                    *ngIf="!groupFields || groupFields.length < 3" (click)="toggleGroupingColumnPanel($event)" style="border-radius: 20px!important;">\r\n                   <span class="f-icon f-icon-add" style="font-size: 24px;"></span>\r\n                </li>\r\n            </ul>\r\n            <div #selectcolumnspanel class="group-field-panel" [style.display]="showSelectColumnsPanel? \'\': \'none\'"\r\n            [style.width.px]="groupfieldcontainer.offsetWidth - 16">\r\n                <ul class="list-group">\r\n                    <li class="list-group-item list-group-item-action btn btn-light" *ngFor="let item of allowGroupColumns"\r\n                    (click)="addGroupColumn($event, item)" [style.display]="groupFields?.indexOf(item.field) > -1 ? \'none\': \'\'">\r\n                        {{ item.title }}\r\n                    </li>\r\n                </ul>\r\n\r\n            </div>\r\n        </div>\r\n\r\n    </div>\r\n    <div region="center" class="center  d-flex flex-column flex-fill" style="overflow:hidden;" *ngIf="enabelGroupFooter">\r\n        <div class="group-sum-fields">\r\n            {{\'datagrid.settings.grouppingSummary\' | locale}}\r\n        </div>\r\n        <div class="flex-fill p-2" style=" background-color: #fff; overflow: auto;">\r\n            <div class="d-flex flex-row flex-fill dg-column-format-setting" style="height: 100%">\r\n                <div region="west" class="west d-flex flex-column" style="width: 360px; min-width:260px;overflow: hidden;">\r\n                    <div style="overflow: auto;padding-right: 5px;" class="flex-fill">\r\n                        <ul class="list-group  list-group-flush">\r\n                            <li class="list-group-item list-group-item-action format-setting-column"\r\n                            *ngFor="let item of formatColumns"\r\n                            [class.active]="activeCalculationCol && activeCalculationCol.field === item.field"\r\n                            (click)="onFieldClick($event, item)"\r\n                             >\r\n                                {{ item.title }}\r\n                            </li>\r\n                        </ul>\r\n                    </div>\r\n                 \r\n                </div>\r\n                <div region="center" class="center flex-fill" style="overflow:auto;padding: 0 10px; padding-left: 20px; border-right: 0px">\r\n                    <form #groupSumform="ngForm">\r\n                        <div class="farris-group-wrap">\r\n                            <div class="form-group farris-form-group">\r\n                                <label for="hpinput01" class="col-form-label">\r\n                                    <span class="farris-label-text">{{\'datagrid.settings.grouppingSummaryType\' | locale}}</span>\r\n                                </label>\r\n                                <div class="farris-input-wrap">\r\n                                   \r\n                                    <farris-combo-list name="groupFooter.options.calculationType" \r\n                                    [data]=" activeCalculationCol?.dataType === \'number\'?  summaryItems : summaryItems2 " \r\n                                    [editable]="false"\r\n                                    [(ngModel)]="activeCalculationCol?.groupFooter.options.calculationType"\r\n                                    [idField]="\'value\'"\r\n                                    [textField]="\'title\'"\r\n                                    [enableClear]="false"></farris-combo-list>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                        <div class="farris-group-wrap" *ngIf="activeCalculationCol?.groupFooter.options.calculationType == -1">\r\n                            <div class="form-group farris-form-group">\r\n                                <label for="hpinput01" class="col-form-label">\r\n                                    <span class="farris-label-text">{{\'datagrid.settings.grouppingSummaryText\' | locale}}</span>\r\n                                </label>\r\n                                <div class="farris-input-wrap">\r\n                                    <input type="input" name="groupFooter.options.text" class="form-control" [(ngModel)]="activeCalculationCol?.groupFooter.options.text">\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </form>\r\n                </div>\r\n               \r\n            </div>\r\n\r\n\r\n\r\n        </div>\r\n    </div>\r\n\r\n</div>',encapsulation:i.ViewEncapsulation.None}]}],e.ctorParameters=function(){return[{type:i.Injector},{type:N},{type:i.ChangeDetectorRef}]},e.propDecorators={columns:[{type:i.Input}],fields:[{type:i.Input}],formatColumns:[{type:i.Input}],groupFields:[{type:i.Input}],expandGroupRows:[{type:i.Input}],enabelGroupFooter:[{type:i.Input}],groupFieldsChange:[{type:i.Output}],formatColumnsChange:[{type:i.Output}],expandGroupRowsChange:[{type:i.Output}],groupingSettingEl:[{type:i.ViewChild,args:["groupingSetting"]}],selectcolumnspanel:[{type:i.ViewChild,args:["selectcolumnspanel"]}],colForm:[{type:i.ViewChild,args:["groupSumform"]}]},e}();b.constants.wrapperClass,b.constants.animationClass;b.smoothDnD.dropHandler=b.dropHandlers.reactDropHandler().handler,b.smoothDnD.wrapChild=!1;var Y=function(){function e(e,t,n,r){var s=this;this.ngzone=e,this.injector=t,this.render=n,this.el=r,this.drop=new i.EventEmitter,this.options={behaviour:"move",dragHandleSelector:".field-drag-handle",dropPlaceholder:{className:"drop-group-field"},getGhostParent:function(){return document.body},getChildPayload:this.getChildPayload.bind(this),shouldAcceptDrop:function(e,t){return!0},onDropReady:function(e){s.ngzone.run(function(){s.onDropReady(e)})},onDrop:function(e){s.ngzone.run(function(){s.drop.emit(e)})},onDragEnter:function(){s.ngzone.run(function(){s.onDragEnter()})},onDragStart:function(e){s.ngzone.run(function(){s.onDragStart(e)})},onDragEnd:function(e){s.ngzone.run(function(){s.onDragEnd(e)})}}}return e.prototype.ngAfterViewInit=function(){this.initDnD()},e.prototype.ngOnDestroy=function(){this.disposeDnd()},e.prototype.disposeDnd=function(){this.container&&(this.container.dispose(),this.container=null)},e.prototype.initDnD=function(){this.disposeDnd(),this.container=b.smoothDnD(this.el.nativeElement,this.options)},e.prototype.getChildPayload=function(e){return e},e.prototype.onDropReady=function(e){},e.prototype.onDragStart=function(e){},e.prototype.onDragEnd=function(e){},e.prototype.onDragEnter=function(){},e.decorators=[{type:i.Directive,args:[{selector:"[column-visible-drag]"}]}],e.ctorParameters=function(){return[{type:i.NgZone},{type:i.Injector},{type:i.Renderer2},{type:i.ElementRef}]},e.propDecorators={drop:[{type:i.Output}],options:[{type:i.Input}]},e}();b.smoothDnD.dropHandler=b.dropHandlers.reactDropHandler().handler,b.smoothDnD.wrapChild=!1;var Q=function(){function e(e,t,n,r){var s=this;this.ngzone=e,this.injector=t,this.render=n,this.el=r,this.drop=new i.EventEmitter,this.options={orientation:"horizontal",behaviour:"move",dropPlaceholder:{className:"drop-group-field"},getGhostParent:function(){return document.body},getChildPayload:this.getChildPayload.bind(this),shouldAcceptDrop:function(e,t){return!0},onDropReady:function(e){s.ngzone.run(function(){s.onDropReady(e)})},onDrop:function(e){s.ngzone.run(function(){s.drop.emit(e)})},onDragEnter:function(){s.ngzone.run(function(){s.onDragEnter()})},onDragStart:function(e){s.ngzone.run(function(){s.onDragStart(e)})},onDragEnd:function(e){s.ngzone.run(function(){s.onDragEnd(e)})}}}return e.prototype.ngAfterViewInit=function(){this.initDnD()},e.prototype.ngOnDestroy=function(){this.disposeDnd()},e.prototype.disposeDnd=function(){this.container&&(this.container.dispose(),this.container=null)},e.prototype.initDnD=function(){this.disposeDnd(),this.container=b.smoothDnD(this.el.nativeElement,this.options)},e.prototype.getChildPayload=function(e){return e},e.prototype.onDropReady=function(e){},e.prototype.onDragStart=function(e){},e.prototype.onDragEnd=function(e){},e.prototype.onDragEnter=function(){},e.decorators=[{type:i.Directive,args:[{selector:"[column-group-drag]"}]}],e.ctorParameters=function(){return[{type:i.NgZone},{type:i.Injector},{type:i.Renderer2},{type:i.ElementRef}]},e.propDecorators={drop:[{type:i.Output}],options:[{type:i.Input}]},e}(),Z=function(){function e(e){this.el=e,this.dblClickHandler=new i.EventEmitter,this._click$=null}return e.prototype.ngOnInit=function(){var e=this,i=n.fromEvent(this.el.nativeElement,"click").pipe(t.filter(function(e){return 0===e.button})),r=i.pipe(t.debounceTime(250)),s=i.pipe(t.bufferCount(2)),o=n.race(r,s).pipe(t.first(),t.repeat());this._click$=i.pipe(t.buffer(o),t.filter(function(e){return e.length>1})).subscribe(function(t){e.dblClickHandler.emit(t[0])})},e.prototype.ngOnDestroy=function(){this._click$&&(this._click$.unsubscribe(),this._click$=null)},e.decorators=[{type:i.Directive,args:[{selector:"[f-dbl-click]"}]}],e.ctorParameters=function(){return[{type:i.ElementRef}]},e.propDecorators={options:[{type:i.Input,args:["f-dbl-click"]}],dblClickHandler:[{type:i.Output}]},e}(),ee=function(){function e(){}return e.prototype.onWheel=function(e,t){var n=t.scrollWidth,i=t.offsetWidth;if(n>i){var r=n-i,s=t.scrollLeft;s<r&&e.deltaY>0&&(e.preventDefault(),t.scrollLeft=s+50),s>0&&e.deltaY<0&&(e.preventDefault(),t.scrollLeft=s-50)}},e.decorators=[{type:i.Component,args:[{selector:"preview-table",template:'\r\n<div #tablebox class="p-2 h-100 d-flex align-items-center" style="overflow-x: auto;" (wheel)="onWheel($event, tablebox)">\r\n    <table class="table table-bordered bg-light" style=" border-color: #cbcbcb; table-layout: revert;">\r\n\r\n        <tr *ngFor="let cls of previewGroupColumns" style="height: 36px">\r\n            <ng-container *ngFor="let c of cls">\r\n                <ng-container *ngIf="c.colspan && c.colspan > 1">\r\n                    <td style=" vertical-align: middle;  border-color: #cbcbcb" [attr.colspan]="c.colspan" [attr.align]="c.halign || \'left\'">{{ c.title }}</td>\r\n                </ng-container>\r\n\r\n                <ng-container *ngIf="!c.colspan || c.colspan == 1">\r\n                    <td [style.width.px]="c.width" [attr.align]="c.halign || \'left\'"\r\n                        [attr.rowspan]="c.rowspan || 1" style=" vertical-align: middle;  border-color: #cbcbcb">{{ c.title }}</td>\r\n                </ng-container>\r\n            </ng-container>\r\n        </tr>\r\n    </table>\r\n</div>'}]}],e.propDecorators={previewGroupColumns:[{type:i.Input}]},e}(),te=function(){function e(e,t,n){this.el=e,this.cfr=t,this.modalSer=n,this.dlgTitle="效果预览"}return e.prototype.onPreviewBtnClick=function(e){this.modalSer.show(ee,{title:this.dlgTitle,width:600,height:300,showMaxButton:!0,resizable:!0,initialState:{previewGroupColumns:this.treeIns.getPreviewGroupColumns()},showButtons:!1})},e.decorators=[{type:i.Directive,args:[{selector:"[preview-headers]"}]}],e.ctorParameters=function(){return[{type:i.ElementRef},{type:i.ComponentFactoryResolver},{type:r.BsModalService}]},e.propDecorators={treeIns:[{type:i.Input,args:["preview-headers"]}],dlgTitle:[{type:i.Input}],onPreviewBtnClick:[{type:i.HostListener,args:["click",["$event"]]}]},e}(),ne=function(){function e(){}return e.forRoot=function(t){return{ngModule:e,providers:[{provide:u.GRID_SETTINGS_SERVICE,useClass:X}]}},e.decorators=[{type:i.NgModule,args:[{declarations:[N,J,M,K,Y,Q,G,z,q,T,x,F,Z,ee,te],imports:[f.CommonModule,l.FormsModule,p.MultiSelectModule,m.ComboListModule,u.DatagridModule,h.FarrisCommonModule.forRoot(),s.MessagerModule.forRoot(),o.LocaleModule.forRoot(),r.ModalModule.forRoot(),g.SwitchModule,v.FarrisTooltipModule,c.NotifyModule.forRoot(),y.OrganizationSelectorModule,S.LanguageTextboxModule,a.TreeTableModule],entryComponents:[N,G,z,q,x,F,ee],exports:[N,G,z,q,Z]}]}],e}();e.ColumnFormatSettingComponent=M,e.ColumnGroupDragDirective=Q,e.ColumnGroupSettingComponent=K,e.ColumnTreeComponent=T,e.ColumnVisibleDragDirective=Y,e.DatagridSettingsComponent=N,e.DatagridSettingsModule=ne,e.DatagridSettingsService=X,e.DatagridSortSettingComponent=J,e.FarrisDblClickDirective=Z,e.GRID_SETTINGS_WEBAPI=B,e.IS_MULTI_HEADER_STRING="-$MULTIHEADER$",e.NewHeaderFormComponent=x,e.NewSchemeComponent=z,e.PreviewMultiHeadersComponent=ee,e.SchemeListComponent=q,e.SetColumnsComponent=F,e.ShowPreviewDirective=te,e.SimpleColumnsComponent=G,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=farris-ui-datagrid-settings.umd.min.js.map
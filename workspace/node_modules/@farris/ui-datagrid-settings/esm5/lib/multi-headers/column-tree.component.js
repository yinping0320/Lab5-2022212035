/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { ChangeDetectorRef, EventEmitter, Component, ElementRef, Injector, Input, NgZone, Output, Renderer2, TemplateRef, ViewChild, ViewEncapsulation } from "@angular/core";
import { of } from "rxjs";
import { BsModalService } from "@farris/ui-modal";
import { TreeTableComponent } from "@farris/ui-treetable";
import { NotifyService } from '@farris/ui-notify';
import { DatagridComponent } from '@farris/ui-datagrid';
import { NewHeaderFormComponent } from "./new-header.component";
import { SetColumnsComponent } from "./setcolumns.component";
import { columnsToTreeNodes } from "../mutli-headers.helper";
import { cloneDeep, flatten } from "lodash-es";
import { LocaleService } from "@farris/ui-locale";
var ColumnTreeComponent = /** @class */ (function () {
    function ColumnTreeComponent(injector, ngzone, cd, render, modalService, el, notitySer) {
        var _this = this;
        this.injector = injector;
        this.ngzone = ngzone;
        this.cd = cd;
        this.render = render;
        this.modalService = modalService;
        this.el = el;
        this.notitySer = notitySer;
        this.options = {};
        this.inModal = false;
        this.nodeSelected = new EventEmitter();
        this.fields = [];
        this.treecols = [];
        this.treeData = [];
        this.contextMenus = [];
        /**
         * 值 __HOU_XUAN_LIE_ID__
         */
        this.HOU_XUAN_LIE_ID = '__HOU_XUAN_LIE_ID__';
        this.GROUP_HEADER_ICON = 'f-icon f-icon-file-folder-close';
        this.Hou_Xuan_Qu = { id: this.HOU_XUAN_LIE_ID, title: '(候选列)', houxuanquNode: true };
        this.languageRes = {
            title: '多表头',
            preview: '预览效果',
            tips: '在（候选列）中的字段，将不在列表中显示; 点击字段名称，在右侧显示相关操作按钮。',
            contextMenus: {
                new: '新建表头',
                newChild: '新建子级表头',
                setDataField: '分配数据列',
                rename: '重命名',
                top: '置顶',
                up: '上移',
                down: '下移',
                bottom: '置底',
                cancelGroup: '取消分组',
                remove: '在分组内移除'
            },
            candidate: '(候选列)',
            setHeader: '设为表头',
            ok: '确定',
            cancel: '取消',
            required: '请输入表头名称！',
            defaultGroupHeaderName: '分组表头1',
            newHeaderPlaceholder: '请输入名称',
            newHeaderLabel: '表头名称'
        };
        this.localeSer = null;
        /**
         * 移动命令项是否显示
         */
        this.moveMenuItemVisiblily = (/**
         * @param {?} t
         * @return {?}
         */
        function (t) {
            if (t) {
                /** @type {?} */
                var rowData = t.node.data;
                if (rowData) {
                    return rowData['id'] != _this.HOU_XUAN_LIE_ID;
                }
                return true;
            }
            return true;
        });
        this.isGroupHeader = (/**
         * @param {?} t
         * @return {?}
         */
        function (t) {
            if (t) {
                /** @type {?} */
                var rowData = t.node.data;
                if (rowData) {
                    return !!rowData['groupHeader'];
                }
                return true;
            }
            return true;
        });
        this.onBeforeShowContextMenu = (/**
         * @param {?} t
         * @return {?}
         */
        function (t) {
            if (t && t.data.parents.indexOf(_this.HOU_XUAN_LIE_ID) > -1) {
                // 待选区中的数据列禁用右键菜单
                return of({ show: false });
            }
            return of({ show: true });
        });
        this.localeSer = this.injector.get(LocaleService, null);
    }
    /**
     * @return {?}
     */
    ColumnTreeComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        /** @type {?} */
        var groupHeaders = this.dg.dfs['_state'].initialOptions.groupHeaderFields;
        /** @type {?} */
        var allDataFields = flatten(groupHeaders).filter((/**
         * @param {?} col
         * @return {?}
         */
        function (col) { return !col.colspan || col.colspan == 1; }));
        this.fields = allDataFields.filter((/**
         * @param {?} n
         * @return {?}
         */
        function (n) { return n.field && n.field !== _this.dg.ControlPanelFeild; }));
        // 树组件列信息
        this.treecols = [
            { field: 'title', title: '名称', template: this.cellTemp }
        ];
        this.languageRes = this.localeSer.getValue('headerGroup');
        this.Hou_Xuan_Qu.title = this.languageRes.candidate;
        this.initTreeData();
        this.initTreenodeContextMenus();
        this.listenTreeTableEvent();
    };
    /**
     * @param {?} changes
     * @return {?}
     */
    ColumnTreeComponent.prototype.ngOnChanges = /**
     * @param {?} changes
     * @return {?}
     */
    function (changes) {
        if (changes.options && !changes.options.isFirstChange()) {
            this.initTreeData();
            this.tt.clearSelections();
        }
    };
    /**
     * @return {?}
     */
    ColumnTreeComponent.prototype.ngAfterViewInit = /**
     * @return {?}
     */
    function () {
    };
    /**
     * @return {?}
     */
    ColumnTreeComponent.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
    };
    /**
     * @private
     * @return {?}
     */
    ColumnTreeComponent.prototype.listenTreeTableEvent = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        this.tt.removed.subscribe((/**
         * @param {?} rowNode
         * @return {?}
         */
        function (rowNode) {
            if (rowNode && rowNode.parent) {
                rowNode.parent.leaf = !(rowNode.parent.children && rowNode.parent.children.length);
                if (rowNode.parent.leaf) {
                    rowNode.parent.icon = _this.GROUP_HEADER_ICON;
                }
            }
            if (!rowNode.node.data.groupHeader) {
                /** @type {?} */
                var hxl = _this.getHouXuanNode();
                if (!rowNode.parent) {
                    _this.treeData = _this.treeData.filter((/**
                     * @param {?} n
                     * @return {?}
                     */
                    function (n) { return n.data.id !== rowNode.id; }));
                }
                _this.tt.append(rowNode.node.data, hxl.node);
            }
        }));
    };
    /**
     * @private
     * @return {?}
     */
    ColumnTreeComponent.prototype.initTreenodeContextMenus = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        this.contextMenus = [
            { id: 1, title: this.languageRes.contextMenus.new, icon: 'f-icon f-icon-add',
                handle: (/**
                 * @param {?} t
                 * @return {?}
                 */
                function (t) {
                    // console.log(t);
                    _this.addNewGroup(t.data, false);
                })
            },
            { id: 2, title: this.languageRes.contextMenus.newChild, visible: (/**
                 * @param {?} t
                 * @return {?}
                 */
                function (t) {
                    return _this.isGroupHeader(t.data) && t.data.level + 1 < _this.dg.maxMultiHeaders - 1;
                }),
                handle: (/**
                 * @param {?} t
                 * @return {?}
                 */
                function (t) {
                    _this.addNewGroup(t.data, true);
                })
            },
            { id: 3, title: this.languageRes.contextMenus.setDataField, visible: (/**
                 * @param {?} t
                 * @return {?}
                 */
                function (t) { return _this.isGroupHeader(t.data); }),
                handle: (/**
                 * @param {?} t
                 * @return {?}
                 */
                function (t) {
                    _this.setColumnsForGroupHeader(null, t.data);
                })
            },
            { id: 31, title: this.languageRes.contextMenus.rename, icon: 'f-icon f-icon-edit',
                handle: (/**
                 * @param {?} t
                 * @return {?}
                 */
                function (t) {
                    _this.resetHeaderName(null, t.data);
                })
            },
            '-',
            {
                id: 4, title: this.languageRes.contextMenus.top, icon: 'f-icon f-icon-roofing',
                visible: (/**
                 * @param {?} t
                 * @return {?}
                 */
                function (t) {
                    return _this.moveMenuItemVisiblily(t.data);
                }),
                handle: (/**
                 * @param {?} t
                 * @return {?}
                 */
                function (t) {
                    _this.moveTop(null, t.data);
                })
            },
            {
                id: 5, title: this.languageRes.contextMenus.up, icon: 'f-icon f-icon-arrow-chevron-up',
                visible: (/**
                 * @param {?} t
                 * @return {?}
                 */
                function (t) { return _this.moveMenuItemVisiblily(t.data); }),
                handle: (/**
                 * @param {?} t
                 * @return {?}
                 */
                function (t) {
                    _this.moveUp(null, t.data);
                })
            },
            {
                id: 6, title: this.languageRes.contextMenus.down, icon: 'f-icon f-icon-arrow-chevron-down',
                visible: (/**
                 * @param {?} t
                 * @return {?}
                 */
                function (t) { return _this.moveMenuItemVisiblily(t.data); }),
                handle: (/**
                 * @param {?} t
                 * @return {?}
                 */
                function (t) {
                    _this.moveDown(null, t.data);
                })
            },
            {
                id: 7, title: this.languageRes.contextMenus.bottom, icon: 'f-icon f-icon-bottomsetting',
                visible: (/**
                 * @param {?} t
                 * @return {?}
                 */
                function (t) { return _this.moveMenuItemVisiblily(t.data); }),
                handle: (/**
                 * @param {?} t
                 * @return {?}
                 */
                function (t) {
                    _this.moveBottom(null, t.data);
                })
            },
            '-',
            {
                id: 8, title: this.languageRes.contextMenus.remove, icon: 'f-icon f-icon-minus',
                visible: (/**
                 * @param {?} t
                 * @return {?}
                 */
                function (t) {
                    return !t.data.node.data.houxuanquNode && !t.data.node.data.groupHeader;
                }),
                handle: (/**
                 * @param {?} t
                 * @return {?}
                 */
                function (t) {
                    _this.tt.remove(t.data.id);
                })
            },
            {
                id: 9, title: this.languageRes.contextMenus.cancelGroup, icon: 'f-icon f-icon-x',
                visible: (/**
                 * @param {?} t
                 * @return {?}
                 */
                function (t) {
                    return t.data.node.data.groupHeader;
                }),
                handle: (/**
                 * @param {?} t
                 * @return {?}
                 */
                function (t) {
                    _this.removeGroup(null, t.data);
                })
            }
        ];
    };
    /**
     * @return {?}
     */
    ColumnTreeComponent.prototype.initTreeData = /**
     * @return {?}
     */
    function () {
        var _this = this;
        if (this.options) {
            var treeData = this.options.treeData;
            if (treeData) {
                this.treeData = treeData;
                return;
            }
        }
        if (this.options.columns && this.options.columns.length > 1) {
            /** @type {?} */
            var _treeData = columnsToTreeNodes(cloneDeep(this.options.columns));
            /** @type {?} */
            var houXuanLie = this.fields.filter((/**
             * @param {?} f
             * @return {?}
             */
            function (f) { return !flatten(_this.options.columns).find((/**
             * @param {?} col
             * @return {?}
             */
            function (col) { return col.field === f.field; })); })).map((/**
             * @param {?} a
             * @return {?}
             */
            function (a) {
                return {
                    data: a,
                    children: [],
                    visible: true
                };
            }));
            _treeData.push({
                data: this.Hou_Xuan_Qu,
                children: houXuanLie,
                expanded: true
            });
            this.treeData = _treeData;
        }
        else {
            this.treeData = [{
                    data: { id: 'groupHeader_1', title: this.languageRes.defaultGroupHeaderName, halign: 'left', groupHeader: true },
                    children: this.fields.map((/**
                     * @param {?} n
                     * @param {?} i
                     * @return {?}
                     */
                    function (n, i) {
                        n['index'] = i;
                        n['id'] = n['field'];
                        return {
                            data: n,
                            children: [],
                            visible: true
                        };
                    })),
                    icon: this.GROUP_HEADER_ICON,
                    expanded: true, visible: true
                }, {
                    data: this.Hou_Xuan_Qu,
                    children: [],
                    expanded: true,
                    icon: this.GROUP_HEADER_ICON
                }];
        }
    };
    /**
     * @private
     * @return {?}
     */
    ColumnTreeComponent.prototype.getHouXuanNode = /**
     * @private
     * @return {?}
     */
    function () {
        return this.tt.findRowNode(this.HOU_XUAN_LIE_ID);
    };
    /**
     * @param {?} $event
     * @return {?}
     */
    ColumnTreeComponent.prototype.onTreeSelected = /**
     * @param {?} $event
     * @return {?}
     */
    function ($event) {
        this.nodeSelected.emit($event);
    };
    /**
     * @private
     * @param {?} okCallback
     * @param {?} dlgTitle
     * @return {?}
     */
    ColumnTreeComponent.prototype.showNewHeaderDialog = /**
     * @private
     * @param {?} okCallback
     * @param {?} dlgTitle
     * @return {?}
     */
    function (okCallback, dlgTitle) {
        /** @type {?} */
        var modalRef = this.modalService.show(NewHeaderFormComponent, {
            title: dlgTitle,
            width: 340,
            height: 190,
            showMaxButton: false,
            resizable: false,
            initialState: {
                title: '',
                placeholder: this.languageRes.newHeaderPlaceholder,
                label: this.languageRes.newHeaderLabel
            },
            buttons: [
                {
                    text: this.languageRes.cancel,
                    cls: 'btn btn-secondary',
                    handle: (/**
                     * @return {?}
                     */
                    function () {
                        modalRef.close();
                    })
                },
                {
                    text: this.languageRes.ok,
                    cls: 'btn btn-primary',
                    handle: okCallback
                }
            ]
        });
        return modalRef;
    };
    /**
     * @private
     * @return {?}
     */
    ColumnTreeComponent.prototype.generateGroupHeaderId = /**
     * @private
     * @return {?}
     */
    function () {
        return "groupHeader_" + new Date().getTime();
    };
    /**
     * @private
     * @param {?} rn
     * @param {?} title
     * @param {?=} child
     * @return {?}
     */
    ColumnTreeComponent.prototype.createNewGroupHeader = /**
     * @private
     * @param {?} rn
     * @param {?} title
     * @param {?=} child
     * @return {?}
     */
    function (rn, title, child) {
        if (child === void 0) { child = false; }
        /** @type {?} */
        var ghid = this.generateGroupHeaderId();
        /** @type {?} */
        var data = { id: ghid, title: title, groupHeader: true, halign: 'left', fixed: 'UNFIXED' };
        /** @type {?} */
        var gh = {
            data: data,
            children: [],
            expanded: true,
            visible: true,
            icon: this.GROUP_HEADER_ICON,
        };
        if (!child) {
            if (!rn.parent) {
                /** @type {?} */
                var i = this.treeData.findIndex((/**
                 * @param {?} n
                 * @return {?}
                 */
                function (n) { return n.data.id === rn.id; })) + 1;
                this.treeData.splice(i, 0, gh);
                this.treeData = this.treeData.slice();
            }
            else {
                gh.data.fixed = rn.parent.data.fixed;
                this.tt.appendChildren([gh], rn.parent);
            }
        }
        else {
            gh.data.fixed = rn.node.data.fixed;
            this.tt.appendChildren([gh], rn.node);
        }
    };
    // 删除分组
    // 删除分组
    /**
     * @param {?} event
     * @param {?} rowNode
     * @return {?}
     */
    ColumnTreeComponent.prototype.removeGroup = 
    // 删除分组
    /**
     * @param {?} event
     * @param {?} rowNode
     * @return {?}
     */
    function (event, rowNode) {
        if (this.tt.selectedRow && rowNode.id === this.tt.selectedRow.id) {
            this.nodeSelected.emit(null);
        }
        /** @type {?} */
        var childs = this.tt.serializedValue.filter((/**
         * @param {?} n
         * @return {?}
         */
        function (n) { return n.parents.indexOf(rowNode.id) > -1 && !n.node.data.groupHeader; })).map((/**
         * @param {?} n
         * @return {?}
         */
        function (n) { return n.node; }));
        this.treeData = this.treeData.filter((/**
         * @param {?} n
         * @return {?}
         */
        function (n) { return n.data.id !== rowNode.id; }));
        this.tt.remove(rowNode.id);
        this.tt.appendChildren(childs, this.getHouXuanNode().node);
    };
    // 新增分组
    // 新增分组
    /**
     * @param {?} rn
     * @param {?=} child
     * @return {?}
     */
    ColumnTreeComponent.prototype.addNewGroup = 
    // 新增分组
    /**
     * @param {?} rn
     * @param {?=} child
     * @return {?}
     */
    function (rn, child) {
        var _this = this;
        if (child === void 0) { child = false; }
        /** @type {?} */
        var modalRef = this.showNewHeaderDialog((/**
         * @return {?}
         */
        function () {
            /** @type {?} */
            var ghfRef = (/** @type {?} */ (modalRef.content));
            if (ghfRef.title) {
                if (!rn || rn.id === _this.HOU_XUAN_LIE_ID) {
                    _this.treeData.splice(0, 0, {
                        data: {
                            id: _this.generateGroupHeaderId(), halign: 'left',
                            title: ghfRef.title, groupHeader: true, fixed: 'UNFIXED'
                        },
                        icon: _this.GROUP_HEADER_ICON,
                        children: []
                    });
                    _this.tt.updateSerializedValue();
                }
                else {
                    _this.createNewGroupHeader(rn, ghfRef.title, child);
                }
                modalRef.close();
            }
            else {
                _this.notitySer.info(_this.languageRes.required);
                ghfRef.input.nativeElement.focus();
            }
        }), child ? this.languageRes.contextMenus.newChild : this.languageRes.contextMenus.new);
    };
    // 显示更新按钮
    // 显示更新按钮
    /**
     * @param {?} $event
     * @param {?} nodeData
     * @return {?}
     */
    ColumnTreeComponent.prototype.onMoreBtnClick = 
    // 显示更新按钮
    /**
     * @param {?} $event
     * @param {?} nodeData
     * @return {?}
     */
    function ($event, nodeData) {
        if (nodeData && nodeData.id) {
            this.tt.selectNode(nodeData.id);
        }
        this.tt.ctxMenu.onContextMenu($event);
    };
    /**
     * @private
     * @param {?} rowNode
     * @return {?}
     */
    ColumnTreeComponent.prototype.getCanSelectColumns = /**
     * @private
     * @param {?} rowNode
     * @return {?}
     */
    function (rowNode) {
        // 可分配列
        // 候选区数据 + 子节点
        // 可分配列
        // 候选区数据 + 子节点
        /** @type {?} */
        var hxl = this.getHouXuanNode();
        /** @type {?} */
        var fields = rowNode ? rowNode.node.children : [];
        fields = fields.filter((/**
         * @param {?} n
         * @return {?}
         */
        function (n) { return !n.data.groupHeader; }));
        return hxl.node.children.concat(fields).map((/**
         * @param {?} n
         * @return {?}
         */
        function (n) { return n.data; }));
    };
    /**
     * @private
     * @param {?} okCallback
     * @param {?} selectedItems
     * @param {?} rowNode
     * @return {?}
     */
    ColumnTreeComponent.prototype.showSetColumnsDialog = /**
     * @private
     * @param {?} okCallback
     * @param {?} selectedItems
     * @param {?} rowNode
     * @return {?}
     */
    function (okCallback, selectedItems, rowNode) {
        /** @type {?} */
        var modalRef = this.modalService.show(SetColumnsComponent, {
            title: this.languageRes.contextMenus.setDataField,
            width: 600,
            height: 500,
            showMaxButton: false,
            resizable: false,
            initialState: {
                data: this.getCanSelectColumns(rowNode),
                checkedItems: selectedItems,
                groupEditorRef: this
            },
            buttons: [
                {
                    text: this.languageRes.cancel,
                    cls: 'btn btn-secondary',
                    handle: (/**
                     * @return {?}
                     */
                    function () {
                        modalRef.close();
                    })
                },
                {
                    text: this.languageRes.ok,
                    cls: 'btn btn-primary',
                    handle: (/**
                     * @return {?}
                     */
                    function () {
                        okCallback(modalRef.content.selectedIds);
                    })
                }
            ]
        });
        return modalRef;
    };
    /** 为分组表头分配数据列 */
    /**
     * 为分组表头分配数据列
     * @param {?} $event
     * @param {?} rowNode
     * @return {?}
     */
    ColumnTreeComponent.prototype.setColumnsForGroupHeader = /**
     * 为分组表头分配数据列
     * @param {?} $event
     * @param {?} rowNode
     * @return {?}
     */
    function ($event, rowNode) {
        var _this = this;
        /** @type {?} */
        var childs = rowNode ? rowNode.node.children ? rowNode.node.children.map((/**
         * @param {?} n
         * @return {?}
         */
        function (n) { return n.data; })) : [] : [];
        /** @type {?} */
        var modalRef = this.showSetColumnsDialog((/**
         * @param {?} selectedIds
         * @return {?}
         */
        function (selectedIds) {
            // 分组下的列
            /** @type {?} */
            var cols = selectedIds.map((/**
             * @param {?} n
             * @return {?}
             */
            function (n) {
                return _this.fields.find((/**
                 * @param {?} f
                 * @return {?}
                 */
                function (f) { return f.field == n; }));
            })).filter((/**
             * @param {?} n
             * @return {?}
             */
            function (n) { return n; }));
            // 候选区
            /** @type {?} */
            var hxl = _this.getHouXuanNode();
            // 清理候选数据，将已分配的列在候选区移除
            hxl.node.children = (hxl.node.children || []).filter((/**
             * @param {?} n
             * @return {?}
             */
            function (n) { return cols.findIndex((/**
             * @param {?} c
             * @return {?}
             */
            function (c) { return c.field == n.id; })) === -1; }));
            // 查找需要移除的
            /** @type {?} */
            var needRemoveNodes = (rowNode.node.children || []).filter((/**
             * @param {?} n
             * @return {?}
             */
            function (n) {
                return !n.data.groupHeader && cols.findIndex((/**
                 * @param {?} c
                 * @return {?}
                 */
                function (c) { return c.field === n.id; })) == -1;
            })).filter((/**
             * @param {?} n
             * @return {?}
             */
            function (n) { return n; }));
            if (needRemoveNodes && needRemoveNodes.length) {
                needRemoveNodes.forEach((/**
                 * @param {?} n
                 * @return {?}
                 */
                function (n) {
                    _this.tt.remove(n.id);
                }));
            }
            // 查找需要新增的
            /** @type {?} */
            var needAppendNodes = cols.filter((/**
             * @param {?} n
             * @return {?}
             */
            function (n) { return (rowNode.node.children || []).findIndex((/**
             * @param {?} c
             * @return {?}
             */
            function (c) { return c.id === n.field; })) === -1; })).map((/**
             * @param {?} n
             * @return {?}
             */
            function (n) {
                if (!n.id) {
                    n.id = n.field;
                }
                return n;
            }));
            if (needAppendNodes && needAppendNodes.length) {
                needAppendNodes.forEach((/**
                 * @param {?} n
                 * @return {?}
                 */
                function (n) {
                    /** @type {?} */
                    var col = _this.fields.find((/**
                     * @param {?} f
                     * @return {?}
                     */
                    function (f) { return f.field == n.field; }));
                    if (col) {
                        col.fixed = rowNode.node.data.fixed;
                    }
                }));
                _this.tt.appendChildren(needAppendNodes.map((/**
                 * @param {?} n
                 * @return {?}
                 */
                function (n) {
                    return {
                        data: n,
                        children: [],
                        expanded: true
                    };
                })), rowNode.node);
                _this.tt.expandNode(rowNode.id);
            }
            // 更新待选区
            /** @type {?} */
            var hxlCols = needRemoveNodes.map((/**
             * @param {?} n
             * @return {?}
             */
            function (n) {
                return {
                    data: n.data,
                    children: []
                };
            }));
            _this.tt.appendChildren(hxlCols, hxl.node);
            modalRef.close();
        }), childs, rowNode);
    };
    // 将待选区中的数据列直接设为表头
    // 将待选区中的数据列直接设为表头
    /**
     * @param {?} event
     * @param {?} col
     * @return {?}
     */
    ColumnTreeComponent.prototype.setColumnHeader = 
    // 将待选区中的数据列直接设为表头
    /**
     * @param {?} event
     * @param {?} col
     * @return {?}
     */
    function (event, col) {
        /** @type {?} */
        var i = this.treeData.length - 1;
        this.treeData.splice(i, 0, { data: col, children: [] });
        /** @type {?} */
        var hxl = this.getHouXuanNode();
        if (hxl) {
            hxl.node.children = hxl.node.children.filter((/**
             * @param {?} n
             * @return {?}
             */
            function (n) { return n.data.id !== col.id; }));
            hxl.node.leaf = !(hxl.node.children && hxl.node.children.length);
            if (hxl.node.leaf) {
                hxl.node.icon = this.GROUP_HEADER_ICON;
            }
            this.tt.clearSelections();
            this.tt.updateSerializedValue();
            this.tt.selectNode(col.id, true);
        }
    };
    /**
     * @param {?} event
     * @param {?} rowNode
     * @return {?}
     */
    ColumnTreeComponent.prototype.moveUp = /**
     * @param {?} event
     * @param {?} rowNode
     * @return {?}
     */
    function (event, rowNode) {
        /** @type {?} */
        var data = this.treeData;
        if (rowNode.parent) {
            data = rowNode.parent.children;
        }
        /** @type {?} */
        var index = data.findIndex((/**
         * @param {?} n
         * @return {?}
         */
        function (n) { return n.data.id === rowNode.id; }));
        if (index !== 0) {
            /** @type {?} */
            var tempArr = data.splice(index, 1);
            data.splice.apply(data, tslib_1.__spread([index - 1, 0], tempArr));
            this.tt.updateSerializedValue();
        }
    };
    /**
     * @param {?} event
     * @param {?} rowNode
     * @return {?}
     */
    ColumnTreeComponent.prototype.moveDown = /**
     * @param {?} event
     * @param {?} rowNode
     * @return {?}
     */
    function (event, rowNode) {
        /** @type {?} */
        var data = this.treeData;
        if (rowNode.parent) {
            data = rowNode.parent.children;
        }
        /** @type {?} */
        var index = data.findIndex((/**
         * @param {?} n
         * @return {?}
         */
        function (n) { return n.data.id === rowNode.id; }));
        /** @type {?} */
        var len = data.length;
        if (index !== len - 2) {
            /** @type {?} */
            var tempArr = data.splice(index, 1);
            data.splice.apply(data, tslib_1.__spread([index + 1, 0], tempArr));
            this.tt.updateSerializedValue();
        }
        else {
            this.moveBottom(event, rowNode);
        }
    };
    /**
     * @param {?} event
     * @param {?} rowNode
     * @return {?}
     */
    ColumnTreeComponent.prototype.moveTop = /**
     * @param {?} event
     * @param {?} rowNode
     * @return {?}
     */
    function (event, rowNode) {
        /** @type {?} */
        var data = this.treeData;
        if (rowNode.parent) {
            data = rowNode.parent.children;
        }
        /** @type {?} */
        var index = data.findIndex((/**
         * @param {?} n
         * @return {?}
         */
        function (n) { return n.data.id === rowNode.id; }));
        data.unshift(rowNode.node);
        data.splice(index + 1, 1);
        this.tt.updateSerializedValue();
    };
    /**
     * @param {?} event
     * @param {?} rowNode
     * @return {?}
     */
    ColumnTreeComponent.prototype.moveBottom = /**
     * @param {?} event
     * @param {?} rowNode
     * @return {?}
     */
    function (event, rowNode) {
        /** @type {?} */
        var data = this.treeData;
        if (rowNode.parent) {
            data = rowNode.parent.children;
        }
        /** @type {?} */
        var index = data.findIndex((/**
         * @param {?} n
         * @return {?}
         */
        function (n) { return n.data.id === rowNode.id; }));
        data.push(rowNode.node);
        data.splice(index, 1);
        if (!rowNode.parent) {
            this.moveUp(event, rowNode);
        }
        else {
            this.tt.updateSerializedValue();
        }
    };
    /** 获取多表头数据 */
    /**
     * 获取多表头数据
     * @return {?}
     */
    ColumnTreeComponent.prototype.getPreviewGroupColumns = /**
     * 获取多表头数据
     * @return {?}
     */
    function () {
        /** @type {?} */
        var treeNodes = this.getAllNodes();
        return this.convert2Array(treeNodes);
    };
    /** 获取候选列 */
    /**
     * 获取候选列
     * @return {?}
     */
    ColumnTreeComponent.prototype.getHouXuanFields = /**
     * 获取候选列
     * @return {?}
     */
    function () {
        /** @type {?} */
        var hxl = this.treeData.find((/**
         * @param {?} n
         * @return {?}
         */
        function (n) { return n.data.houxuanquNode; }));
        if (hxl) {
            return hxl.children;
        }
        else {
            return [];
        }
    };
    /**
     * @private
     * @return {?}
     */
    ColumnTreeComponent.prototype.getAllNodes = /**
     * @private
     * @return {?}
     */
    function () {
        /** @type {?} */
        var hxl = this.getHouXuanFields();
        return this.tt.serializedValue.filter((/**
         * @param {?} n
         * @return {?}
         */
        function (n) {
            return !n.node.data.houxuanquNode && hxl.findIndex((/**
             * @param {?} k
             * @return {?}
             */
            function (k) { return k.data.id === n.id; })) === -1;
        }));
    };
    /** 将树节点数据转换为 多表头结构 */
    /**
     * 将树节点数据转换为 多表头结构
     * @param {?} rowNodes
     * @return {?}
     */
    ColumnTreeComponent.prototype.convert2Array = /**
     * 将树节点数据转换为 多表头结构
     * @param {?} rowNodes
     * @return {?}
     */
    function (rowNodes) {
        var _this = this;
        /** @type {?} */
        var r = [];
        /** @type {?} */
        var maxBy = (/**
         * @param {?} arr
         * @param {?} fn
         * @return {?}
         */
        function (arr, fn) { return Math.max.apply(Math, tslib_1.__spread(arr.map(typeof fn === 'function' ? fn : (/**
         * @param {?} val
         * @return {?}
         */
        function (val) { return val[fn]; })))); });
        /** @type {?} */
        var maxlevel = maxBy(rowNodes, (/**
         * @param {?} n
         * @return {?}
         */
        function (n) { return n.level; }));
        // 排除没有数据字段的表头
        rowNodes = rowNodes.filter((/**
         * @param {?} n
         * @return {?}
         */
        function (n) { return (n.node.children && n.node.children.length && n.node.data.groupHeader) || !n.node.data.groupHeader; }));
        /**
         * 1、只有一组表头，且固定在左侧或右侧时，按无固定列方式处理
         * 2、只有左侧、右侧固定列而没有其他正常列时，取消右侧固定列
         * 3、只有左侧或右侧固定时，按无固定列处理
         * @type {?}
         */
        var parents = rowNodes.filter((/**
         * @param {?} e
         * @return {?}
         */
        function (e) { return !e.parent; }));
        if (!parents.filter((/**
         * @param {?} n
         * @return {?}
         */
        function (n) { return !n.node.data.fixed || n.node.data.fixed === 'UNFIXED'; })).length) {
            /** @type {?} */
            var leftCols = parents.filter((/**
             * @param {?} n
             * @return {?}
             */
            function (n) { return n.node.data.fixed === 'left'; }));
            /** @type {?} */
            var rightCols = parents.filter((/**
             * @param {?} n
             * @return {?}
             */
            function (n) { return n.node.data.fixed === 'right'; }));
            if (leftCols.length == parents.length || rightCols.length == parents.length) {
                rowNodes.forEach((/**
                 * @param {?} n
                 * @return {?}
                 */
                function (n) {
                    if (parents.find((/**
                     * @param {?} p
                     * @return {?}
                     */
                    function (p) { return p.id === n.id; }))) {
                        n.node.data.fixed = '';
                    }
                }));
            }
            else {
                if (rightCols.length === 1) {
                    leftCols.forEach((/**
                     * @param {?} t
                     * @return {?}
                     */
                    function (t) {
                        rowNodes.forEach((/**
                         * @param {?} n
                         * @return {?}
                         */
                        function (n) {
                            if (t.id === n.id) {
                                n.node.data.fixed = '';
                            }
                        }));
                    }));
                }
                else {
                    rightCols.forEach((/**
                     * @param {?} t
                     * @return {?}
                     */
                    function (t) {
                        rowNodes.forEach((/**
                         * @param {?} n
                         * @return {?}
                         */
                        function (n) {
                            if (t.id === n.id) {
                                n.node.data.fixed = '';
                            }
                        }));
                    }));
                }
            }
        }
        var _loop_1 = function (i) {
            r.push(rowNodes.filter((/**
             * @param {?} n
             * @return {?}
             */
            function (n) { return n.level === i; })).map((/**
             * @param {?} n
             * @return {?}
             */
            function (n) {
                /** @type {?} */
                var data = n.node.data;
                /** @type {?} */
                var _fixed = n.parent ? _this.tt.getRoot(n.id).node.data.fixed : (data.fixed || '');
                /** @type {?} */
                var _colspan = (n.node.children ? rowNodes.filter((/**
                 * @param {?} k
                 * @return {?}
                 */
                function (k) { return k.parents.indexOf(n.id) > -1 && k.id.indexOf('groupHeader_') == -1; })).length : 1) || 1;
                /** @type {?} */
                var _rowspan = (n.node.children && n.node.children.length > 0) ? 1 : (maxlevel - n.level + 1);
                /** @type {?} */
                var newCol = {
                    field: data.field,
                    title: data.title,
                    sortable: data.sortable,
                    order: data.order,
                    halign: data.halign || 'left',
                    align: data.align || 'left',
                    visible: true,
                    allowGrouping: data.allowGrouping,
                    groupFooter: data.groupFooter,
                    footer: data.footer,
                    width: (data.size ? data.size.width : 100),
                    dataType: data.dataType || 'string',
                    fixed: _fixed === 'UNFIXED' ? '' : _fixed,
                    id: n.id,
                    parentId: n.node.parent ? n.node.parent.id : null,
                    rowspan: _rowspan,
                    colspan: _colspan
                };
                /** @type {?} */
                var newCol2 = {
                    field: data.field,
                    title: data.title,
                    halign: data.halign || 'left',
                    align: data.align || 'left',
                    visible: true,
                    groupFooter: {},
                    footer: {},
                    width: (data.size ? data.size.width : 100),
                    dataType: data.dataType || 'string',
                    fixed: _fixed === 'UNFIXED' ? '' : _fixed,
                    id: n.id,
                    parentId: n.node.parent ? n.node.parent.id : null,
                    rowspan: _rowspan,
                    colspan: _colspan
                };
                return n.node.data.groupHeader ? newCol2 : newCol;
            })));
        };
        for (var i = 0; i <= maxlevel; i++) {
            _loop_1(i);
        }
        return r;
    };
    /**
     * @private
     * @param {?} nodes
     * @return {?}
     */
    ColumnTreeComponent.prototype.clearTreeNodesData = /**
     * @private
     * @param {?} nodes
     * @return {?}
     */
    function (nodes) {
        var _this = this;
        nodes.forEach((/**
         * @param {?} n
         * @return {?}
         */
        function (n) {
            delete n.parent;
            delete n.elementRef;
            if (n.children && n.children.length) {
                _this.clearTreeNodesData(n.children);
            }
        }));
    };
    /**
     * @return {?}
     */
    ColumnTreeComponent.prototype.getSettings = /**
     * @return {?}
     */
    function () {
        this.clearTreeNodesData(this.treeData);
        return {
            viewCols: this.getPreviewGroupColumns(),
            treeData: this.treeData
        };
    };
    /**
     * @param {?} $event
     * @param {?} id
     * @return {?}
     */
    ColumnTreeComponent.prototype.hiddenCol = /**
     * @param {?} $event
     * @param {?} id
     * @return {?}
     */
    function ($event, id) {
        $event.stopPropagation();
        if (this.tt.selectedRow && id === this.tt.selectedRow.id) {
            this.tt.clearSelections();
            this.nodeSelected.emit(null);
        }
        this.tt.remove(id);
    };
    /**
     * @param {?} $event
     * @param {?} rowNode
     * @return {?}
     */
    ColumnTreeComponent.prototype.resetHeaderName = /**
     * @param {?} $event
     * @param {?} rowNode
     * @return {?}
     */
    function ($event, rowNode) {
        var _this = this;
        /** @type {?} */
        var modalRef = this.showNewHeaderDialog((/**
         * @return {?}
         */
        function () {
            /** @type {?} */
            var ghfRef = (/** @type {?} */ (modalRef.content));
            if (ghfRef.title) {
                rowNode.node.data.title = ghfRef.title;
                modalRef.close();
            }
            else {
                _this.notitySer.info(_this.languageRes.required);
                ghfRef.input.nativeElement.focus();
            }
        }), this.languageRes.contextMenus.rename);
        /** @type {?} */
        var ghfRef = (/** @type {?} */ (modalRef.content));
        ghfRef.title = rowNode.node.data.title;
    };
    ColumnTreeComponent.decorators = [
        { type: Component, args: [{
                    selector: 'column-tree',
                    template: "<farris-treetable #tt [data]=\"treeData\" [columns]=\"treecols\"\r\n        [idField]=\"'id'\" [striped]=\"false\" [showBorder]=\"false\"\r\n        [singleSelect]=\"true\" [showIcon]=\"true\" [showFilterBar]=\"false\" [selectOnCheck]=\"true\" [checkOnSelect]=\"true\"\r\n        [fixedHeader]=\"false\" [fit] =\"false\" [showHeader]=\"false\"\r\n        [collapseIcon]=\"'f-icon f-icon-file-folder-close'\" [expandIcon]=\"'f-icon f-icon-file-folder-open'\"\r\n        [enableContextMenu]=\"true\" [contextMenuItems]=\"contextMenus\" [dblClickExpand]=\"false\" [beforeShowContextMenu]=\"onBeforeShowContextMenu\"\r\n        (nodeSelected)=\"onTreeSelected($event)\"\r\n></farris-treetable>\r\n<ng-template #nodeTemplate let-ctx>\r\n    <div class=\"d-flex flex-row multi-headers-toolbars\" id=\"{{ ctx.rowData['id'] }}\">\r\n        <div class=\"f-utils-fill\">{{ctx.rowData['title']}}</div>\r\n        <div class=\"d-flex align-items-center multi-headers-toolbars-buttons hide\" [class.show]=\"tt.selectValue === ctx.rowData['id']\">\r\n            \r\n            <button class=\"btn btn-link d-flex align-items-center more treenode-more-btn\" \r\n                *ngIf=\"ctx.rowData['id'] !== '__HOU_XUAN_LIE_ID__' && isGroupHeader(ctx.rowNode)\" title=\"{{languageRes.contextMenus.cancelGroup}}\"\r\n                (click)=\"removeGroup($event, ctx.rowNode);\">\r\n                <span class=\"f-icon f-icon-x\"></span>\r\n            </button>\r\n            <button class=\"btn btn-link d-flex align-items-center more treenode-more-btn\" \r\n                *ngIf=\"ctx.rowData['id'] !== '__HOU_XUAN_LIE_ID__' && ctx.rowNode.parents && ctx.rowNode.parents[0] !== '__HOU_XUAN_LIE_ID__' && !isGroupHeader(ctx.rowNode)\"\r\n                 title=\"{{languageRes.contextMenus.remove}}\"\r\n                (click)=\"hiddenCol($event,ctx.rowNode.id)\">\r\n                <span class=\"f-icon f-icon-x\"></span>\r\n            </button>\r\n            \r\n            <button class=\"btn btn-link mr-0 d-flex align-items-center more treenode-more-btn\" \r\n                *ngIf=\"ctx.rowData['id'] !== '__HOU_XUAN_LIE_ID__' && ctx.rowNode.parents && ctx.rowNode.parents[0] !== '__HOU_XUAN_LIE_ID__'\" title=\"\"\r\n                (click)=\"onMoreBtnClick($event, ctx.rowData)\">\r\n                <span class=\"f-icon f-icon-more-horizontal\"></span>\r\n            </button>\r\n            <button class=\"btn btn-link mr-0 d-flex align-items-center more treenode-more-btn\" title=\"{{languageRes.contextMenus.new}}\" \r\n                *ngIf=\"ctx.rowData['id'] === '__HOU_XUAN_LIE_ID__'\"\r\n                (click)=\"addNewGroup(null, !1)\">\r\n                <span class=\"f-icon f-icon-plus-circle font16 t-2\"></span>\r\n            </button>\r\n\r\n            <button class=\"btn btn-link mr-0 d-flex align-items-center more treenode-more-btn\" \r\n                *ngIf=\"ctx.rowNode.parents && ctx.rowNode.parents[0] === '__HOU_XUAN_LIE_ID__'\" title=\"{{languageRes.setHeader}}\"\r\n                (click)=\"setColumnHeader($event, ctx.rowData)\">\r\n                <span class=\"f-icon f-icon-add\"></span>\r\n            </button>\r\n        </div>\r\n    </div>\r\n\r\n</ng-template>",
                    exportAs: 'groupHeaderTree',
                    encapsulation: ViewEncapsulation.None,
                    styles: [".multi-headers-toolbars .multi-headers-toolbars-buttons{margin-right:-11px}.multi-headers-toolbars .multi-headers-toolbars-buttons.hide{display:none!important}.multi-headers-toolbars .multi-headers-toolbars-buttons.show{display:flex!important}.multi-headers-toolbars .multi-headers-toolbars-buttons button.more{height:26px;width:26px;background:0 0;border-radius:0;border:0;padding:2px}.multi-headers-toolbars .multi-headers-toolbars-buttons button.more .f-icon{font-size:14px;position:relative;left:3px}.multi-headers-toolbars .multi-headers-toolbars-buttons .font16{font-size:16px}.multi-headers-toolbars:hover .multi-headers-toolbars-buttons,.table-hover tbody tr:hover .multi-headers-toolbars .multi-headers-toolbars-buttons{display:flex!important}"]
                }] }
    ];
    /** @nocollapse */
    ColumnTreeComponent.ctorParameters = function () { return [
        { type: Injector },
        { type: NgZone },
        { type: ChangeDetectorRef },
        { type: Renderer2 },
        { type: BsModalService },
        { type: ElementRef },
        { type: NotifyService }
    ]; };
    ColumnTreeComponent.propDecorators = {
        dg: [{ type: Input }],
        options: [{ type: Input }],
        inModal: [{ type: Input }],
        nodeSelected: [{ type: Output }],
        cellTemp: [{ type: ViewChild, args: ['nodeTemplate',] }],
        tt: [{ type: ViewChild, args: ['tt',] }]
    };
    return ColumnTreeComponent;
}());
export { ColumnTreeComponent };
if (false) {
    /** @type {?} */
    ColumnTreeComponent.prototype.dg;
    /** @type {?} */
    ColumnTreeComponent.prototype.options;
    /** @type {?} */
    ColumnTreeComponent.prototype.inModal;
    /** @type {?} */
    ColumnTreeComponent.prototype.nodeSelected;
    /** @type {?} */
    ColumnTreeComponent.prototype.cellTemp;
    /** @type {?} */
    ColumnTreeComponent.prototype.tt;
    /** @type {?} */
    ColumnTreeComponent.prototype.fields;
    /** @type {?} */
    ColumnTreeComponent.prototype.treecols;
    /** @type {?} */
    ColumnTreeComponent.prototype.treeData;
    /** @type {?} */
    ColumnTreeComponent.prototype.contextMenus;
    /**
     * 值 __HOU_XUAN_LIE_ID__
     * @type {?}
     */
    ColumnTreeComponent.prototype.HOU_XUAN_LIE_ID;
    /** @type {?} */
    ColumnTreeComponent.prototype.GROUP_HEADER_ICON;
    /** @type {?} */
    ColumnTreeComponent.prototype.Hou_Xuan_Qu;
    /** @type {?} */
    ColumnTreeComponent.prototype.languageRes;
    /**
     * @type {?}
     * @private
     */
    ColumnTreeComponent.prototype.localeSer;
    /**
     * 移动命令项是否显示
     * @type {?}
     */
    ColumnTreeComponent.prototype.moveMenuItemVisiblily;
    /** @type {?} */
    ColumnTreeComponent.prototype.isGroupHeader;
    /** @type {?} */
    ColumnTreeComponent.prototype.onBeforeShowContextMenu;
    /**
     * @type {?}
     * @private
     */
    ColumnTreeComponent.prototype.injector;
    /**
     * @type {?}
     * @private
     */
    ColumnTreeComponent.prototype.ngzone;
    /**
     * @type {?}
     * @private
     */
    ColumnTreeComponent.prototype.cd;
    /**
     * @type {?}
     * @private
     */
    ColumnTreeComponent.prototype.render;
    /**
     * @type {?}
     * @private
     */
    ColumnTreeComponent.prototype.modalService;
    /**
     * @type {?}
     * @private
     */
    ColumnTreeComponent.prototype.el;
    /**
     * @type {?}
     * @private
     */
    ColumnTreeComponent.prototype.notitySer;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29sdW1uLXRyZWUuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy91aS1kYXRhZ3JpZC1zZXR0aW5ncy8iLCJzb3VyY2VzIjpbImxpYi9tdWx0aS1oZWFkZXJzL2NvbHVtbi10cmVlLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFBaUIsaUJBQWlCLEVBQUMsWUFBWSxFQUFFLFNBQVMsRUFBRSxVQUFVLEVBQUUsUUFBUSxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQWdDLE1BQU0sRUFBRSxTQUFTLEVBQWlCLFdBQVcsRUFBRSxTQUFTLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFFek8sT0FBTyxFQUFFLEVBQUUsRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUUxQixPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sa0JBQWtCLENBQUM7QUFDbEQsT0FBTyxFQUFxQixrQkFBa0IsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBRTdFLE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUNsRCxPQUFPLEVBQUUsaUJBQWlCLEVBQWMsTUFBTSxxQkFBcUIsQ0FBQztBQUVwRSxPQUFPLEVBQUUsc0JBQXNCLEVBQUUsTUFBTSx3QkFBd0IsQ0FBQztBQUNoRSxPQUFPLEVBQUUsbUJBQW1CLEVBQUUsTUFBTSx3QkFBd0IsQ0FBQztBQUM3RCxPQUFPLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSx5QkFBeUIsQ0FBQztBQUM3RCxPQUFPLEVBQUUsU0FBUyxFQUFFLE9BQU8sRUFBRSxNQUFNLFdBQVcsQ0FBQztBQUUvQyxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFHbEQ7SUE0REksNkJBQW9CLFFBQWtCLEVBQVUsTUFBYyxFQUFVLEVBQXFCLEVBQVUsTUFBaUIsRUFDNUcsWUFBNEIsRUFBVSxFQUFjLEVBQ3BELFNBQXdCO1FBRnBDLGlCQUlLO1FBSmUsYUFBUSxHQUFSLFFBQVEsQ0FBVTtRQUFVLFdBQU0sR0FBTixNQUFNLENBQVE7UUFBVSxPQUFFLEdBQUYsRUFBRSxDQUFtQjtRQUFVLFdBQU0sR0FBTixNQUFNLENBQVc7UUFDNUcsaUJBQVksR0FBWixZQUFZLENBQWdCO1FBQVUsT0FBRSxHQUFGLEVBQUUsQ0FBWTtRQUNwRCxjQUFTLEdBQVQsU0FBUyxDQUFlO1FBcEQzQixZQUFPLEdBQStCLEVBQUUsQ0FBQztRQUV6QyxZQUFPLEdBQUcsS0FBSyxDQUFDO1FBRWYsaUJBQVksR0FBRyxJQUFJLFlBQVksRUFBTyxDQUFDO1FBS2pELFdBQU0sR0FBRyxFQUFFLENBQUM7UUFDWixhQUFRLEdBQUcsRUFBRSxDQUFDO1FBQ2QsYUFBUSxHQUFHLEVBQUUsQ0FBQztRQUNkLGlCQUFZLEdBQUcsRUFBRSxDQUFDOzs7O1FBR2xCLG9CQUFlLEdBQUcscUJBQXFCLENBQUM7UUFHeEMsc0JBQWlCLEdBQUcsaUNBQWlDLENBQUM7UUFFdEQsZ0JBQVcsR0FBRyxFQUFFLEVBQUUsRUFBRSxJQUFJLENBQUMsZUFBZSxFQUFFLEtBQUssRUFBRSxPQUFPLEVBQUUsYUFBYSxFQUFFLElBQUksRUFBRSxDQUFDO1FBR2hGLGdCQUFXLEdBQUc7WUFDVixLQUFLLEVBQUUsS0FBSztZQUNaLE9BQU8sRUFBRSxNQUFNO1lBQ2YsSUFBSSxFQUFFLDBDQUEwQztZQUNoRCxZQUFZLEVBQUU7Z0JBQ1YsR0FBRyxFQUFFLE1BQU07Z0JBQ1gsUUFBUSxFQUFFLFFBQVE7Z0JBQ2xCLFlBQVksRUFBRSxPQUFPO2dCQUNyQixNQUFNLEVBQUUsS0FBSztnQkFDYixHQUFHLEVBQUUsSUFBSTtnQkFDVCxFQUFFLEVBQUUsSUFBSTtnQkFDUixJQUFJLEVBQUUsSUFBSTtnQkFDVixNQUFNLEVBQUUsSUFBSTtnQkFDWixXQUFXLEVBQUUsTUFBTTtnQkFDbkIsTUFBTSxFQUFFLFFBQVE7YUFDbkI7WUFDRCxTQUFTLEVBQUUsT0FBTztZQUNsQixTQUFTLEVBQUUsTUFBTTtZQUNqQixFQUFFLEVBQUUsSUFBSTtZQUNSLE1BQU0sRUFBRSxJQUFJO1lBQ1osUUFBUSxFQUFFLFVBQVU7WUFDcEIsc0JBQXNCLEVBQUUsT0FBTztZQUMvQixvQkFBb0IsRUFBRSxPQUFPO1lBQzdCLGNBQWMsRUFBRSxNQUFNO1NBQ3pCLENBQUE7UUFFTyxjQUFTLEdBQWtCLElBQUksQ0FBQzs7OztRQThJeEMsMEJBQXFCOzs7O1FBQUcsVUFBQyxDQUFVO1lBQy9CLElBQUksQ0FBQyxFQUFFOztvQkFDRyxPQUFPLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJO2dCQUMzQixJQUFJLE9BQU8sRUFBRTtvQkFDVCxPQUFPLE9BQU8sQ0FBQyxJQUFJLENBQUMsSUFBSSxLQUFJLENBQUMsZUFBZSxDQUFDO2lCQUNoRDtnQkFDRCxPQUFPLElBQUksQ0FBQzthQUNmO1lBQ0QsT0FBTyxJQUFJLENBQUM7UUFDaEIsQ0FBQyxFQUFBO1FBRUQsa0JBQWE7Ozs7UUFBRyxVQUFDLENBQVU7WUFDdkIsSUFBSSxDQUFDLEVBQUU7O29CQUNHLE9BQU8sR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUk7Z0JBQzNCLElBQUksT0FBTyxFQUFFO29CQUNULE9BQU8sQ0FBQyxDQUFDLE9BQU8sQ0FBQyxhQUFhLENBQUMsQ0FBQztpQkFDbkM7Z0JBQ0QsT0FBTyxJQUFJLENBQUM7YUFDZjtZQUNELE9BQU8sSUFBSSxDQUFDO1FBQ2hCLENBQUMsRUFBQTtRQXlkRCw0QkFBdUI7Ozs7UUFBRyxVQUFDLENBQUM7WUFDeEIsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLEtBQUksQ0FBQyxlQUFlLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRTtnQkFDeEQsaUJBQWlCO2dCQUNqQixPQUFPLEVBQUUsQ0FBQyxFQUFDLElBQUksRUFBRSxLQUFLLEVBQUMsQ0FBQyxDQUFDO2FBQzVCO1lBQ0QsT0FBTyxFQUFFLENBQUMsRUFBQyxJQUFJLEVBQUUsSUFBSSxFQUFDLENBQUMsQ0FBQztRQUM1QixDQUFDLEVBQUE7UUE3bkJPLElBQUksQ0FBQyxTQUFTLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsYUFBYSxFQUFFLElBQUksQ0FBQyxDQUFDO0lBQzVELENBQUM7Ozs7SUFFTCxzQ0FBUTs7O0lBQVI7UUFBQSxpQkFpQkM7O1lBaEJTLFlBQVksR0FBRyxJQUFJLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxRQUFRLENBQUMsQ0FBQyxjQUFjLENBQUMsaUJBQWlCOztZQUNyRSxhQUFhLEdBQUcsT0FBTyxDQUFhLFlBQVksQ0FBQyxDQUFDLE1BQU07Ozs7UUFBQyxVQUFDLEdBQWUsSUFBSyxPQUFBLENBQUMsR0FBRyxDQUFDLE9BQU8sSUFBSSxHQUFHLENBQUMsT0FBTyxJQUFJLENBQUMsRUFBaEMsQ0FBZ0MsRUFBQztRQUNySCxJQUFJLENBQUMsTUFBTSxHQUFHLGFBQWEsQ0FBQyxNQUFNOzs7O1FBQUMsVUFBQSxDQUFDLElBQUksT0FBQSxDQUFDLENBQUMsS0FBSyxJQUFJLENBQUMsQ0FBQyxLQUFLLEtBQUssS0FBSSxDQUFDLEVBQUUsQ0FBQyxpQkFBaUIsRUFBaEQsQ0FBZ0QsRUFBQyxDQUFDO1FBRTFGLFNBQVM7UUFDVCxJQUFJLENBQUMsUUFBUSxHQUFHO1lBQ1osRUFBRSxLQUFLLEVBQUUsT0FBTyxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsUUFBUSxFQUFFLElBQUksQ0FBQyxRQUFRLEVBQUU7U0FDM0QsQ0FBQztRQUVGLElBQUksQ0FBQyxXQUFXLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxRQUFRLENBQUMsYUFBYSxDQUFDLENBQUM7UUFDMUQsSUFBSSxDQUFDLFdBQVcsQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQyxTQUFTLENBQUM7UUFFcEQsSUFBSSxDQUFDLFlBQVksRUFBRSxDQUFDO1FBRXBCLElBQUksQ0FBQyx3QkFBd0IsRUFBRSxDQUFDO1FBQ2hDLElBQUksQ0FBQyxvQkFBb0IsRUFBRSxDQUFDO0lBQ2hDLENBQUM7Ozs7O0lBRUQseUNBQVc7Ozs7SUFBWCxVQUFZLE9BQXNCO1FBQzlCLElBQUksT0FBTyxDQUFDLE9BQU8sSUFBSSxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsYUFBYSxFQUFFLEVBQUU7WUFDckQsSUFBSSxDQUFDLFlBQVksRUFBRSxDQUFDO1lBQ3BCLElBQUksQ0FBQyxFQUFFLENBQUMsZUFBZSxFQUFFLENBQUM7U0FDN0I7SUFDTCxDQUFDOzs7O0lBRUQsNkNBQWU7OztJQUFmO0lBQ0EsQ0FBQzs7OztJQUVELHlDQUFXOzs7SUFBWDtJQUNBLENBQUM7Ozs7O0lBRU8sa0RBQW9COzs7O0lBQTVCO1FBQUEsaUJBc0JDO1FBckJHLElBQUksQ0FBQyxFQUFFLENBQUMsT0FBTyxDQUFDLFNBQVM7Ozs7UUFBQyxVQUFBLE9BQU87WUFFN0IsSUFBSSxPQUFPLElBQUksT0FBTyxDQUFDLE1BQU0sRUFBRTtnQkFDM0IsT0FBTyxDQUFDLE1BQU0sQ0FBQyxJQUFJLEdBQUcsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsUUFBUSxJQUFJLE9BQU8sQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFDO2dCQUNuRixJQUFJLE9BQU8sQ0FBQyxNQUFNLENBQUMsSUFBSSxFQUFFO29CQUNyQixPQUFPLENBQUMsTUFBTSxDQUFDLElBQUksR0FBRyxLQUFJLENBQUMsaUJBQWlCLENBQUM7aUJBQ2hEO2FBQ0o7WUFFRCxJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsV0FBVyxFQUFFOztvQkFDMUIsR0FBRyxHQUFHLEtBQUksQ0FBQyxjQUFjLEVBQUU7Z0JBRWpDLElBQUksQ0FBQyxPQUFPLENBQUMsTUFBTSxFQUFFO29CQUNqQixLQUFJLENBQUMsUUFBUSxHQUFHLEtBQUksQ0FBQyxRQUFRLENBQUMsTUFBTTs7OztvQkFBQyxVQUFBLENBQUMsSUFBSSxPQUFBLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRSxLQUFLLE9BQU8sQ0FBQyxFQUFFLEVBQXhCLENBQXdCLEVBQUMsQ0FBQztpQkFDdkU7Z0JBRUQsS0FBSSxDQUFDLEVBQUUsQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDO2FBQy9DO1FBR0wsQ0FBQyxFQUFDLENBQUM7SUFDUCxDQUFDOzs7OztJQUVPLHNEQUF3Qjs7OztJQUFoQztRQUFBLGlCQTRFQztRQTNFRyxJQUFJLENBQUMsWUFBWSxHQUFHO1lBQ2hCLEVBQUUsRUFBRSxFQUFFLENBQUMsRUFBRSxLQUFLLEVBQUUsSUFBSSxDQUFDLFdBQVcsQ0FBQyxZQUFZLENBQUMsR0FBRyxFQUFFLElBQUksRUFBRSxtQkFBbUI7Z0JBQ3hFLE1BQU07Ozs7Z0JBQUUsVUFBQyxDQUFDO29CQUNOLGtCQUFrQjtvQkFDbEIsS0FBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUMsSUFBSSxFQUFFLEtBQUssQ0FBQyxDQUFDO2dCQUNwQyxDQUFDLENBQUE7YUFDSjtZQUNELEVBQUUsRUFBRSxFQUFFLENBQUMsRUFBRSxLQUFLLEVBQUUsSUFBSSxDQUFDLFdBQVcsQ0FBQyxZQUFZLENBQUMsUUFBUSxFQUFFLE9BQU87Ozs7Z0JBQUUsVUFBQyxDQUFNO29CQUNoRSxPQUFPLEtBQUksQ0FBQyxhQUFhLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxHQUFHLENBQUMsR0FBRyxLQUFJLENBQUMsRUFBRSxDQUFDLGVBQWUsR0FBRyxDQUFDLENBQUM7Z0JBQ3hGLENBQUMsQ0FBQTtnQkFDRCxNQUFNOzs7O2dCQUFFLFVBQUMsQ0FBQztvQkFDTixLQUFJLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUM7Z0JBQ25DLENBQUMsQ0FBQTthQUNKO1lBQ0QsRUFBRSxFQUFFLEVBQUUsQ0FBQyxFQUFFLEtBQUssRUFBRSxJQUFJLENBQUMsV0FBVyxDQUFDLFlBQVksQ0FBQyxZQUFZLEVBQUUsT0FBTzs7OztnQkFBRSxVQUFDLENBQU0sSUFBTSxPQUFPLEtBQUksQ0FBQyxhQUFhLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFBLENBQUMsQ0FBQyxDQUFBO2dCQUNqSCxNQUFNOzs7O2dCQUFFLFVBQUMsQ0FBQztvQkFDTixLQUFJLENBQUMsd0JBQXdCLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQztnQkFDaEQsQ0FBQyxDQUFBO2FBQ0o7WUFDRCxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsS0FBSyxFQUFFLElBQUksQ0FBQyxXQUFXLENBQUMsWUFBWSxDQUFDLE1BQU0sRUFBRSxJQUFJLEVBQUUsb0JBQW9CO2dCQUM3RSxNQUFNOzs7O2dCQUFFLFVBQUMsQ0FBQztvQkFDTixLQUFJLENBQUMsZUFBZSxDQUFDLElBQUksRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUM7Z0JBQ3ZDLENBQUMsQ0FBQTthQUNKO1lBQ0QsR0FBRztZQUNIO2dCQUNJLEVBQUUsRUFBRSxDQUFDLEVBQUUsS0FBSyxFQUFFLElBQUksQ0FBQyxXQUFXLENBQUMsWUFBWSxDQUFDLEdBQUcsRUFBRSxJQUFJLEVBQUUsdUJBQXVCO2dCQUM5RSxPQUFPOzs7O2dCQUFFLFVBQUMsQ0FBTTtvQkFDWixPQUFPLEtBQUksQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUM7Z0JBQzlDLENBQUMsQ0FBQTtnQkFDRCxNQUFNOzs7O2dCQUFFLFVBQUMsQ0FBQztvQkFDTixLQUFJLENBQUMsT0FBTyxDQUFDLElBQUksRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUM7Z0JBQy9CLENBQUMsQ0FBQTthQUNKO1lBQ0Q7Z0JBQ0ksRUFBRSxFQUFFLENBQUMsRUFBRSxLQUFLLEVBQUUsSUFBSSxDQUFDLFdBQVcsQ0FBQyxZQUFZLENBQUMsRUFBRSxFQUFFLElBQUksRUFBRSxnQ0FBZ0M7Z0JBQ3RGLE9BQU87Ozs7Z0JBQUUsVUFBQyxDQUFNLElBQU0sT0FBTyxLQUFJLENBQUMscUJBQXFCLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFBLENBQUEsQ0FBQyxDQUFBO2dCQUNoRSxNQUFNOzs7O2dCQUFFLFVBQUMsQ0FBQztvQkFDTixLQUFJLENBQUMsTUFBTSxDQUFDLElBQUksRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUM7Z0JBQzlCLENBQUMsQ0FBQTthQUNKO1lBQ0Q7Z0JBQ0ksRUFBRSxFQUFFLENBQUMsRUFBRSxLQUFLLEVBQUUsSUFBSSxDQUFDLFdBQVcsQ0FBQyxZQUFZLENBQUMsSUFBSSxFQUFFLElBQUksRUFBRSxrQ0FBa0M7Z0JBQzFGLE9BQU87Ozs7Z0JBQUUsVUFBQyxDQUFNLElBQU0sT0FBTyxLQUFJLENBQUMscUJBQXFCLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFBLENBQUEsQ0FBQyxDQUFBO2dCQUNoRSxNQUFNOzs7O2dCQUFFLFVBQUMsQ0FBQztvQkFDTixLQUFJLENBQUMsUUFBUSxDQUFDLElBQUksRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUM7Z0JBQ2hDLENBQUMsQ0FBQTthQUNKO1lBQ0Q7Z0JBQ0ksRUFBRSxFQUFFLENBQUMsRUFBRSxLQUFLLEVBQUUsSUFBSSxDQUFDLFdBQVcsQ0FBQyxZQUFZLENBQUMsTUFBTSxFQUFFLElBQUksRUFBRSw2QkFBNkI7Z0JBQ3ZGLE9BQU87Ozs7Z0JBQUUsVUFBQyxDQUFNLElBQU0sT0FBTyxLQUFJLENBQUMscUJBQXFCLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFBLENBQUEsQ0FBQyxDQUFBO2dCQUNoRSxNQUFNOzs7O2dCQUFFLFVBQUMsQ0FBQztvQkFDTixLQUFJLENBQUMsVUFBVSxDQUFDLElBQUksRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUM7Z0JBQ2xDLENBQUMsQ0FBQTthQUNKO1lBQ0QsR0FBRztZQUNIO2dCQUNJLEVBQUUsRUFBRSxDQUFDLEVBQUUsS0FBSyxFQUFFLElBQUksQ0FBQyxXQUFXLENBQUMsWUFBWSxDQUFDLE1BQU0sRUFBRSxJQUFJLEVBQUUscUJBQXFCO2dCQUMvRSxPQUFPOzs7O2dCQUFFLFVBQUMsQ0FBQztvQkFDUCxPQUFPLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLGFBQWEsSUFBSSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUM7Z0JBQzVFLENBQUMsQ0FBQTtnQkFDRCxNQUFNOzs7O2dCQUFFLFVBQUMsQ0FBQztvQkFDTixLQUFJLENBQUMsRUFBRSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDO2dCQUM5QixDQUFDLENBQUE7YUFDSjtZQUNEO2dCQUNJLEVBQUUsRUFBRSxDQUFDLEVBQUUsS0FBSyxFQUFFLElBQUksQ0FBQyxXQUFXLENBQUMsWUFBWSxDQUFDLFdBQVcsRUFBRSxJQUFJLEVBQUUsaUJBQWlCO2dCQUNoRixPQUFPOzs7O2dCQUFFLFVBQUMsQ0FBQztvQkFDUCxPQUFPLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUM7Z0JBQ3hDLENBQUMsQ0FBQTtnQkFDRCxNQUFNOzs7O2dCQUFFLFVBQUMsQ0FBQztvQkFDTixLQUFJLENBQUMsV0FBVyxDQUFDLElBQUksRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUM7Z0JBQ25DLENBQUMsQ0FBQTthQUNKO1NBQ0osQ0FBQztJQUNOLENBQUM7Ozs7SUF5QkQsMENBQVk7OztJQUFaO1FBQUEsaUJBK0NDO1FBN0NHLElBQUksSUFBSSxDQUFDLE9BQU8sRUFBRTtZQUNOLElBQUEsZ0NBQVE7WUFFaEIsSUFBSSxRQUFRLEVBQUU7Z0JBQ1YsSUFBSSxDQUFDLFFBQVEsR0FBRyxRQUFRLENBQUM7Z0JBQ3pCLE9BQU87YUFDVjtTQUNKO1FBRUQsSUFBSSxJQUFJLENBQUMsT0FBTyxDQUFDLE9BQU8sSUFBSSxJQUFJLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFOztnQkFDbkQsU0FBUyxHQUFHLGtCQUFrQixDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxDQUFDOztnQkFDL0QsVUFBVSxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsTUFBTTs7OztZQUFDLFVBQUEsQ0FBQyxJQUFJLE9BQUEsQ0FBQyxPQUFPLENBQUMsS0FBSSxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsQ0FBQyxJQUFJOzs7O1lBQUMsVUFBQSxHQUFHLElBQUksT0FBQSxHQUFHLENBQUMsS0FBSyxLQUFLLENBQUMsQ0FBQyxLQUFLLEVBQXJCLENBQXFCLEVBQUMsRUFBakUsQ0FBaUUsRUFBQyxDQUFDLEdBQUc7Ozs7WUFBQyxVQUFDLENBQUs7Z0JBQ3BILE9BQU87b0JBQ0gsSUFBSSxFQUFFLENBQUM7b0JBQ1AsUUFBUSxFQUFFLEVBQUU7b0JBQ1osT0FBTyxFQUFFLElBQUk7aUJBQ2hCLENBQUE7WUFDTCxDQUFDLEVBQUM7WUFDRixTQUFTLENBQUMsSUFBSSxDQUFDO2dCQUNYLElBQUksRUFBRSxJQUFJLENBQUMsV0FBVztnQkFDdEIsUUFBUSxFQUFFLFVBQVU7Z0JBQ3BCLFFBQVEsRUFBRSxJQUFJO2FBQ2pCLENBQUMsQ0FBQztZQUNILElBQUksQ0FBQyxRQUFRLEdBQUcsU0FBUyxDQUFDO1NBQzdCO2FBQU07WUFDSCxJQUFJLENBQUMsUUFBUSxHQUFHLENBQUM7b0JBQ2IsSUFBSSxFQUFFLEVBQUUsRUFBRSxFQUFFLGVBQWUsRUFBRSxLQUFLLEVBQUUsSUFBSSxDQUFDLFdBQVcsQ0FBQyxzQkFBc0IsRUFBRSxNQUFNLEVBQUUsTUFBTSxFQUFFLFdBQVcsRUFBRSxJQUFJLEVBQUU7b0JBQ2hILFFBQVEsRUFBRSxJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUc7Ozs7O29CQUFDLFVBQUMsQ0FBQyxFQUFFLENBQUM7d0JBQzNCLENBQUMsQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLENBQUM7d0JBQ2YsQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQzt3QkFDckIsT0FBTzs0QkFDSCxJQUFJLEVBQUUsQ0FBQzs0QkFDUCxRQUFRLEVBQUUsRUFBRTs0QkFDWixPQUFPLEVBQUUsSUFBSTt5QkFDaEIsQ0FBQztvQkFDTixDQUFDLEVBQUM7b0JBQ0YsSUFBSSxFQUFFLElBQUksQ0FBQyxpQkFBaUI7b0JBQzVCLFFBQVEsRUFBRSxJQUFJLEVBQUUsT0FBTyxFQUFFLElBQUk7aUJBQ2hDLEVBQUU7b0JBQ0MsSUFBSSxFQUFFLElBQUksQ0FBQyxXQUFXO29CQUN0QixRQUFRLEVBQUUsRUFBRTtvQkFDWixRQUFRLEVBQUUsSUFBSTtvQkFDZCxJQUFJLEVBQUUsSUFBSSxDQUFDLGlCQUFpQjtpQkFDL0IsQ0FBQyxDQUFDO1NBQ047SUFDTCxDQUFDOzs7OztJQUVPLDRDQUFjOzs7O0lBQXRCO1FBQ0ksT0FBTyxJQUFJLENBQUMsRUFBRSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsZUFBZSxDQUFDLENBQUM7SUFDckQsQ0FBQzs7Ozs7SUFFRCw0Q0FBYzs7OztJQUFkLFVBQWUsTUFBTTtRQUNqQixJQUFJLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUNuQyxDQUFDOzs7Ozs7O0lBRU8saURBQW1COzs7Ozs7SUFBM0IsVUFBNEIsVUFBVSxFQUFFLFFBQVE7O1lBQ3RDLFFBQVEsR0FBRyxJQUFJLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxzQkFBc0IsRUFBRTtZQUM1RCxLQUFLLEVBQUUsUUFBUTtZQUNmLEtBQUssRUFBRSxHQUFHO1lBQ1YsTUFBTSxFQUFFLEdBQUc7WUFDWCxhQUFhLEVBQUUsS0FBSztZQUNwQixTQUFTLEVBQUUsS0FBSztZQUNoQixZQUFZLEVBQUU7Z0JBQ1YsS0FBSyxFQUFFLEVBQUU7Z0JBQ1QsV0FBVyxFQUFFLElBQUksQ0FBQyxXQUFXLENBQUMsb0JBQW9CO2dCQUNsRCxLQUFLLEVBQUUsSUFBSSxDQUFDLFdBQVcsQ0FBQyxjQUFjO2FBQ3pDO1lBQ0QsT0FBTyxFQUFFO2dCQUNMO29CQUNJLElBQUksRUFBRSxJQUFJLENBQUMsV0FBVyxDQUFDLE1BQU07b0JBQzdCLEdBQUcsRUFBRSxtQkFBbUI7b0JBQ3hCLE1BQU07OztvQkFBRTt3QkFDSixRQUFRLENBQUMsS0FBSyxFQUFFLENBQUM7b0JBQ3JCLENBQUMsQ0FBQTtpQkFDSjtnQkFDRDtvQkFDSSxJQUFJLEVBQUUsSUFBSSxDQUFDLFdBQVcsQ0FBQyxFQUFFO29CQUN6QixHQUFHLEVBQUUsaUJBQWlCO29CQUN0QixNQUFNLEVBQUUsVUFBVTtpQkFDckI7YUFDSjtTQUNKLENBQUM7UUFFRixPQUFPLFFBQVEsQ0FBQztJQUNwQixDQUFDOzs7OztJQUVPLG1EQUFxQjs7OztJQUE3QjtRQUNJLE9BQU8saUJBQWUsSUFBSSxJQUFJLEVBQUUsQ0FBQyxPQUFPLEVBQUksQ0FBQztJQUNqRCxDQUFDOzs7Ozs7OztJQUVPLGtEQUFvQjs7Ozs7OztJQUE1QixVQUE2QixFQUFXLEVBQUUsS0FBYSxFQUFFLEtBQWE7UUFBYixzQkFBQSxFQUFBLGFBQWE7O1lBQzVELElBQUksR0FBRyxJQUFJLENBQUMscUJBQXFCLEVBQUU7O1lBQ25DLElBQUksR0FBRyxFQUFFLEVBQUUsRUFBRSxJQUFJLEVBQUUsS0FBSyxPQUFBLEVBQUUsV0FBVyxFQUFFLElBQUksRUFBRSxNQUFNLEVBQUUsTUFBTSxFQUFFLEtBQUssRUFBRSxTQUFTLEVBQUU7O1lBQy9FLEVBQUUsR0FBRztZQUNQLElBQUksTUFBQTtZQUNKLFFBQVEsRUFBRSxFQUFFO1lBQ1osUUFBUSxFQUFFLElBQUk7WUFDZCxPQUFPLEVBQUUsSUFBSTtZQUNiLElBQUksRUFBRSxJQUFJLENBQUMsaUJBQWlCO1NBQy9CO1FBQ0QsSUFBSSxDQUFDLEtBQUssRUFBRTtZQUNSLElBQUksQ0FBQyxFQUFFLENBQUMsTUFBTSxFQUFFOztvQkFDTixDQUFDLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxTQUFTOzs7O2dCQUFDLFVBQUEsQ0FBQyxJQUFJLE9BQUEsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLEtBQUssRUFBRSxDQUFDLEVBQUUsRUFBbkIsQ0FBbUIsRUFBQyxHQUFHLENBQUM7Z0JBQy9ELElBQUksQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUM7Z0JBQy9CLElBQUksQ0FBQyxRQUFRLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxLQUFLLEVBQUUsQ0FBQzthQUN6QztpQkFBTTtnQkFDSCxFQUFFLENBQUMsSUFBSSxDQUFDLEtBQUssR0FBRyxFQUFFLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUM7Z0JBQ3JDLElBQUksQ0FBQyxFQUFFLENBQUMsY0FBYyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDLE1BQU0sQ0FBQyxDQUFDO2FBQzNDO1NBQ0o7YUFBTTtZQUNILEVBQUUsQ0FBQyxJQUFJLENBQUMsS0FBSyxHQUFHLEVBQUUsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQztZQUNuQyxJQUFJLENBQUMsRUFBRSxDQUFDLGNBQWMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxJQUFJLENBQUMsQ0FBQztTQUN6QztJQUNMLENBQUM7SUFFRCxPQUFPOzs7Ozs7O0lBQ1AseUNBQVc7Ozs7Ozs7SUFBWCxVQUFZLEtBQWlCLEVBQUUsT0FBTztRQUNsQyxJQUFJLElBQUksQ0FBQyxFQUFFLENBQUMsV0FBVyxJQUFJLE9BQU8sQ0FBQyxFQUFFLEtBQUssSUFBSSxDQUFDLEVBQUUsQ0FBQyxXQUFXLENBQUMsRUFBRSxFQUFFO1lBQzlELElBQUksQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1NBQ2hDOztZQUNLLE1BQU0sR0FBRyxJQUFJLENBQUMsRUFBRSxDQUFDLGVBQWUsQ0FBQyxNQUFNOzs7O1FBQUMsVUFBQSxDQUFDLElBQUksT0FBQSxDQUFDLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxXQUFXLEVBQTlELENBQThELEVBQUMsQ0FBQyxHQUFHOzs7O1FBQUMsVUFBQSxDQUFDLElBQUksT0FBQSxDQUFDLENBQUMsSUFBSSxFQUFOLENBQU0sRUFBQztRQUNuSSxJQUFJLENBQUMsUUFBUSxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsTUFBTTs7OztRQUFDLFVBQUEsQ0FBQyxJQUFJLE9BQUEsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLEtBQUssT0FBTyxDQUFDLEVBQUUsRUFBeEIsQ0FBd0IsRUFBQyxDQUFDO1FBRXBFLElBQUksQ0FBQyxFQUFFLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUMzQixJQUFJLENBQUMsRUFBRSxDQUFDLGNBQWMsQ0FBQyxNQUFNLEVBQUUsSUFBSSxDQUFDLGNBQWMsRUFBRSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQy9ELENBQUM7SUFFRCxPQUFPOzs7Ozs7O0lBQ1AseUNBQVc7Ozs7Ozs7SUFBWCxVQUFZLEVBQVcsRUFBRSxLQUFhO1FBQXRDLGlCQXlCQztRQXpCd0Isc0JBQUEsRUFBQSxhQUFhOztZQUM1QixRQUFRLEdBQUcsSUFBSSxDQUFDLG1CQUFtQjs7O1FBQUM7O2dCQUNoQyxNQUFNLEdBQUcsbUJBQUEsUUFBUSxDQUFDLE9BQU8sRUFBMEI7WUFDekQsSUFBSSxNQUFNLENBQUMsS0FBSyxFQUFFO2dCQUNkLElBQUksQ0FBQyxFQUFFLElBQUksRUFBRSxDQUFDLEVBQUUsS0FBSyxLQUFJLENBQUMsZUFBZSxFQUFFO29CQUN2QyxLQUFJLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFO3dCQUN2QixJQUFJLEVBQUU7NEJBQ0YsRUFBRSxFQUFFLEtBQUksQ0FBQyxxQkFBcUIsRUFBRSxFQUFFLE1BQU0sRUFBRSxNQUFNOzRCQUNoRCxLQUFLLEVBQUUsTUFBTSxDQUFDLEtBQUssRUFBRSxXQUFXLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxTQUFTO3lCQUMzRDt3QkFDRCxJQUFJLEVBQUUsS0FBSSxDQUFDLGlCQUFpQjt3QkFDNUIsUUFBUSxFQUFFLEVBQUU7cUJBQ2YsQ0FBQyxDQUFDO29CQUNILEtBQUksQ0FBQyxFQUFFLENBQUMscUJBQXFCLEVBQUUsQ0FBQztpQkFDbkM7cUJBQU07b0JBQ0gsS0FBSSxDQUFDLG9CQUFvQixDQUFDLEVBQUUsRUFBRSxNQUFNLENBQUMsS0FBSyxFQUFFLEtBQUssQ0FBQyxDQUFDO2lCQUN0RDtnQkFFRCxRQUFRLENBQUMsS0FBSyxFQUFFLENBQUM7YUFDcEI7aUJBQU07Z0JBQ0gsS0FBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsS0FBSSxDQUFDLFdBQVcsQ0FBQyxRQUFRLENBQUMsQ0FBQztnQkFDL0MsTUFBTSxDQUFDLEtBQUssQ0FBQyxhQUFhLENBQUMsS0FBSyxFQUFFLENBQUM7YUFDdEM7UUFDTixDQUFDLEdBQUUsS0FBSyxDQUFBLENBQUMsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLFlBQVksQ0FBQyxRQUFRLENBQUEsQ0FBQyxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsWUFBWSxDQUFDLEdBQUcsQ0FBQztJQUV2RixDQUFDO0lBRUQsU0FBUzs7Ozs7OztJQUNULDRDQUFjOzs7Ozs7O0lBQWQsVUFBZSxNQUFrQixFQUFFLFFBQVE7UUFDdkMsSUFBSSxRQUFRLElBQUksUUFBUSxDQUFDLEVBQUUsRUFBRTtZQUN6QixJQUFJLENBQUMsRUFBRSxDQUFDLFVBQVUsQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDLENBQUM7U0FDbkM7UUFDRCxJQUFJLENBQUMsRUFBRSxDQUFDLE9BQU8sQ0FBQyxhQUFhLENBQUMsTUFBTSxDQUFDLENBQUM7SUFDMUMsQ0FBQzs7Ozs7O0lBRU8saURBQW1COzs7OztJQUEzQixVQUE0QixPQUFnQjtRQUN4QyxPQUFPO1FBQ1AsY0FBYzs7OztZQUVSLEdBQUcsR0FBRyxJQUFJLENBQUMsY0FBYyxFQUFFOztZQUM3QixNQUFNLEdBQUcsT0FBTyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsRUFBRTtRQUNqRCxNQUFNLEdBQUcsTUFBTSxDQUFDLE1BQU07Ozs7UUFBQyxVQUFDLENBQVcsSUFBSyxPQUFBLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxXQUFXLEVBQW5CLENBQW1CLEVBQUMsQ0FBQTtRQUM1RCxPQUFPLEdBQUcsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxHQUFHOzs7O1FBQUMsVUFBQSxDQUFDLElBQUksT0FBQSxDQUFDLENBQUMsSUFBSSxFQUFOLENBQU0sRUFBQyxDQUFDO0lBQzdELENBQUM7Ozs7Ozs7O0lBRU8sa0RBQW9COzs7Ozs7O0lBQTVCLFVBQTZCLFVBQVUsRUFBRSxhQUFhLEVBQUUsT0FBZ0I7O1lBQzlELFFBQVEsR0FBRyxJQUFJLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxtQkFBbUIsRUFBRTtZQUN6RCxLQUFLLEVBQUUsSUFBSSxDQUFDLFdBQVcsQ0FBQyxZQUFZLENBQUMsWUFBWTtZQUNqRCxLQUFLLEVBQUUsR0FBRztZQUNWLE1BQU0sRUFBRSxHQUFHO1lBQ1gsYUFBYSxFQUFFLEtBQUs7WUFDcEIsU0FBUyxFQUFFLEtBQUs7WUFDaEIsWUFBWSxFQUFFO2dCQUNWLElBQUksRUFBRSxJQUFJLENBQUMsbUJBQW1CLENBQUMsT0FBTyxDQUFDO2dCQUN2QyxZQUFZLEVBQUUsYUFBYTtnQkFDM0IsY0FBYyxFQUFFLElBQUk7YUFDdkI7WUFDRCxPQUFPLEVBQUU7Z0JBQ0w7b0JBQ0ksSUFBSSxFQUFFLElBQUksQ0FBQyxXQUFXLENBQUMsTUFBTTtvQkFDN0IsR0FBRyxFQUFFLG1CQUFtQjtvQkFDeEIsTUFBTTs7O29CQUFFO3dCQUNKLFFBQVEsQ0FBQyxLQUFLLEVBQUUsQ0FBQztvQkFDckIsQ0FBQyxDQUFBO2lCQUNKO2dCQUNEO29CQUNJLElBQUksRUFBRSxJQUFJLENBQUMsV0FBVyxDQUFDLEVBQUU7b0JBQ3pCLEdBQUcsRUFBRSxpQkFBaUI7b0JBQ3RCLE1BQU07OztvQkFBRTt3QkFDSixVQUFVLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQyxXQUFXLENBQUMsQ0FBQTtvQkFDNUMsQ0FBQyxDQUFBO2lCQUNKO2FBQ0o7U0FDSixDQUFDO1FBRUYsT0FBTyxRQUFRLENBQUM7SUFDcEIsQ0FBQztJQUVELGlCQUFpQjs7Ozs7OztJQUNqQixzREFBd0I7Ozs7OztJQUF4QixVQUF5QixNQUFNLEVBQUUsT0FBZ0I7UUFBakQsaUJBNERDOztZQTNEUyxNQUFNLEdBQUcsT0FBTyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsR0FBRzs7OztRQUFDLFVBQUEsQ0FBQyxJQUFJLE9BQUEsQ0FBQyxDQUFDLElBQUksRUFBTixDQUFNLEVBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxFQUFFOztZQUMzRixRQUFRLEdBQUcsSUFBSSxDQUFDLG9CQUFvQjs7OztRQUFDLFVBQUMsV0FBcUI7OztnQkFFdkQsSUFBSSxHQUFHLFdBQVcsQ0FBQyxHQUFHOzs7O1lBQUMsVUFBQSxDQUFDO2dCQUMxQixPQUFPLEtBQUksQ0FBQyxNQUFNLENBQUMsSUFBSTs7OztnQkFBQyxVQUFBLENBQUMsSUFBSSxPQUFBLENBQUMsQ0FBQyxLQUFLLElBQUksQ0FBQyxFQUFaLENBQVksRUFBQyxDQUFDO1lBQy9DLENBQUMsRUFBQyxDQUFDLE1BQU07Ozs7WUFBQyxVQUFBLENBQUMsSUFBSSxPQUFBLENBQUMsRUFBRCxDQUFDLEVBQUM7OztnQkFFWCxHQUFHLEdBQUcsS0FBSSxDQUFDLGNBQWMsRUFBRTtZQUNqQyxzQkFBc0I7WUFDdEIsR0FBRyxDQUFDLElBQUksQ0FBQyxRQUFRLEdBQUcsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLFFBQVEsSUFBSSxFQUFFLENBQUMsQ0FBQyxNQUFNOzs7O1lBQUMsVUFBQSxDQUFDLElBQUksT0FBQSxJQUFJLENBQUMsU0FBUzs7OztZQUFDLFVBQUEsQ0FBQyxJQUFJLE9BQUEsQ0FBQyxDQUFDLEtBQUssSUFBSSxDQUFDLENBQUMsRUFBRSxFQUFmLENBQWUsRUFBQyxLQUFLLENBQUMsQ0FBQyxFQUEzQyxDQUEyQyxFQUFDLENBQUM7OztnQkFHakcsZUFBZSxHQUFHLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxRQUFRLElBQUksRUFBRSxDQUFDLENBQUMsTUFBTTs7OztZQUFFLFVBQUMsQ0FBQztnQkFDNUQsT0FBTyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsV0FBVyxJQUFJLElBQUksQ0FBQyxTQUFTOzs7O2dCQUFDLFVBQUMsQ0FBQyxJQUFLLE9BQUEsQ0FBQyxDQUFDLEtBQUssS0FBSyxDQUFDLENBQUMsRUFBRSxFQUFoQixDQUFnQixFQUFDLElBQUksQ0FBQyxDQUFDLENBQUE7WUFDL0UsQ0FBQyxFQUFDLENBQUMsTUFBTTs7OztZQUFDLFVBQUEsQ0FBQyxJQUFJLE9BQUEsQ0FBQyxFQUFELENBQUMsRUFBQztZQUVqQixJQUFJLGVBQWUsSUFBSSxlQUFlLENBQUMsTUFBTSxFQUFFO2dCQUMzQyxlQUFlLENBQUMsT0FBTzs7OztnQkFBQyxVQUFBLENBQUM7b0JBQ3JCLEtBQUksQ0FBQyxFQUFFLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQztnQkFDekIsQ0FBQyxFQUFDLENBQUM7YUFDTjs7O2dCQUdLLGVBQWUsR0FBRyxJQUFJLENBQUMsTUFBTTs7OztZQUFDLFVBQUEsQ0FBQyxJQUFLLE9BQUEsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLFFBQVEsSUFBSSxFQUFFLENBQUMsQ0FBQyxTQUFTOzs7O1lBQUMsVUFBQSxDQUFDLElBQUksT0FBQSxDQUFDLENBQUMsRUFBRSxLQUFLLENBQUMsQ0FBQyxLQUFLLEVBQWhCLENBQWdCLEVBQUMsS0FBSyxDQUFDLENBQUMsRUFBckUsQ0FBcUUsRUFBQyxDQUFDLEdBQUc7Ozs7WUFBQyxVQUFBLENBQUM7Z0JBQ2xILElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxFQUFFO29CQUNQLENBQUMsQ0FBQyxFQUFFLEdBQUcsQ0FBQyxDQUFDLEtBQUssQ0FBQztpQkFDbEI7Z0JBQ0QsT0FBTyxDQUFDLENBQUM7WUFDYixDQUFDLEVBQUM7WUFDRixJQUFJLGVBQWUsSUFBSSxlQUFlLENBQUMsTUFBTSxFQUFFO2dCQUMzQyxlQUFlLENBQUMsT0FBTzs7OztnQkFBQyxVQUFBLENBQUM7O3dCQUNmLEdBQUcsR0FBRyxLQUFJLENBQUMsTUFBTSxDQUFDLElBQUk7Ozs7b0JBQUMsVUFBQSxDQUFDLElBQUksT0FBQSxDQUFDLENBQUMsS0FBSyxJQUFJLENBQUMsQ0FBQyxLQUFLLEVBQWxCLENBQWtCLEVBQUM7b0JBQ3JELElBQUksR0FBRyxFQUFFO3dCQUNMLEdBQUcsQ0FBQyxLQUFLLEdBQUksT0FBTyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDO3FCQUN4QztnQkFDTCxDQUFDLEVBQUMsQ0FBQztnQkFFSCxLQUFJLENBQUMsRUFBRSxDQUFDLGNBQWMsQ0FBQyxlQUFlLENBQUMsR0FBRzs7OztnQkFBQyxVQUFBLENBQUM7b0JBQ3hDLE9BQU87d0JBQ0gsSUFBSSxFQUFFLENBQUM7d0JBQ1AsUUFBUSxFQUFFLEVBQUU7d0JBQ1osUUFBUSxFQUFFLElBQUk7cUJBQ2pCLENBQUM7Z0JBQ04sQ0FBQyxFQUFDLEVBQUUsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDO2dCQUVsQixLQUFJLENBQUMsRUFBRSxDQUFDLFVBQVUsQ0FBQyxPQUFPLENBQUMsRUFBRSxDQUFDLENBQUM7YUFDbEM7OztnQkFHSyxPQUFPLEdBQUcsZUFBZSxDQUFDLEdBQUc7Ozs7WUFBQyxVQUFBLENBQUM7Z0JBQ2pDLE9BQU87b0JBQ0gsSUFBSSxFQUFFLENBQUMsQ0FBQyxJQUFJO29CQUNaLFFBQVEsRUFBRSxFQUFFO2lCQUNmLENBQUM7WUFDTixDQUFDLEVBQUM7WUFDRixLQUFJLENBQUMsRUFBRSxDQUFDLGNBQWMsQ0FBQyxPQUFPLEVBQUUsR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDO1lBRTFDLFFBQVEsQ0FBQyxLQUFLLEVBQUUsQ0FBQztRQUNyQixDQUFDLEdBQUUsTUFBTSxFQUFFLE9BQU8sQ0FBQztJQUN2QixDQUFDO0lBRUQsa0JBQWtCOzs7Ozs7O0lBQ2xCLDZDQUFlOzs7Ozs7O0lBQWYsVUFBZ0IsS0FBaUIsRUFBRSxHQUFHOztZQUM1QixDQUFDLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxNQUFNLEdBQUcsQ0FBQztRQUNsQyxJQUFJLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUcsSUFBSSxFQUFFLEdBQUcsRUFBRSxRQUFRLEVBQUUsRUFBRSxFQUFFLENBQUMsQ0FBQzs7WUFFbkQsR0FBRyxHQUFHLElBQUksQ0FBQyxjQUFjLEVBQUU7UUFDakMsSUFBSSxHQUFHLEVBQUU7WUFDTCxHQUFHLENBQUMsSUFBSSxDQUFDLFFBQVEsR0FBRyxHQUFHLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxNQUFNOzs7O1lBQUMsVUFBQSxDQUFDLElBQUksT0FBQSxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUUsS0FBSyxHQUFHLENBQUMsRUFBRSxFQUFwQixDQUFvQixFQUFDLENBQUM7WUFDeEUsR0FBRyxDQUFDLElBQUksQ0FBQyxJQUFJLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsUUFBUSxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1lBQ2pFLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUU7Z0JBQ2YsR0FBRyxDQUFDLElBQUksQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDLGlCQUFpQixDQUFDO2FBQzFDO1lBQ0QsSUFBSSxDQUFDLEVBQUUsQ0FBQyxlQUFlLEVBQUUsQ0FBQztZQUMxQixJQUFJLENBQUMsRUFBRSxDQUFDLHFCQUFxQixFQUFFLENBQUM7WUFDaEMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxVQUFVLENBQUMsR0FBRyxDQUFDLEVBQUUsRUFBRSxJQUFJLENBQUMsQ0FBQztTQUNwQztJQUVMLENBQUM7Ozs7OztJQUVELG9DQUFNOzs7OztJQUFOLFVBQU8sS0FBaUIsRUFBRSxPQUFPOztZQUN6QixJQUFJLEdBQUcsSUFBSSxDQUFDLFFBQVE7UUFDeEIsSUFBSSxPQUFPLENBQUMsTUFBTSxFQUFFO1lBQ2hCLElBQUksR0FBRyxPQUFPLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQztTQUNsQzs7WUFFSyxLQUFLLEdBQUcsSUFBSSxDQUFDLFNBQVM7Ozs7UUFBQyxVQUFBLENBQUMsSUFBSSxPQUFBLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRSxLQUFLLE9BQU8sQ0FBQyxFQUFFLEVBQXhCLENBQXdCLEVBQUM7UUFDM0QsSUFBSSxLQUFLLEtBQUssQ0FBQyxFQUFFOztnQkFDUCxPQUFPLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLEVBQUUsQ0FBQyxDQUFDO1lBQ3JDLElBQUksQ0FBQyxNQUFNLE9BQVgsSUFBSSxvQkFBUSxLQUFLLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBSyxPQUFPLEdBQUU7WUFFdEMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxxQkFBcUIsRUFBRSxDQUFDO1NBQ25DO0lBQ0wsQ0FBQzs7Ozs7O0lBRUQsc0NBQVE7Ozs7O0lBQVIsVUFBUyxLQUFpQixFQUFFLE9BQU87O1lBQzNCLElBQUksR0FBRyxJQUFJLENBQUMsUUFBUTtRQUN4QixJQUFJLE9BQU8sQ0FBQyxNQUFNLEVBQUU7WUFDaEIsSUFBSSxHQUFHLE9BQU8sQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDO1NBQ2xDOztZQUNLLEtBQUssR0FBRyxJQUFJLENBQUMsU0FBUzs7OztRQUFDLFVBQUEsQ0FBQyxJQUFJLE9BQUEsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLEtBQUssT0FBTyxDQUFDLEVBQUUsRUFBeEIsQ0FBd0IsRUFBQzs7WUFDckQsR0FBRyxHQUFHLElBQUksQ0FBQyxNQUFNO1FBRXZCLElBQUksS0FBSyxLQUFLLEdBQUcsR0FBRyxDQUFDLEVBQUU7O2dCQUNiLE9BQU8sR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssRUFBRSxDQUFDLENBQUM7WUFDckMsSUFBSSxDQUFDLE1BQU0sT0FBWCxJQUFJLG9CQUFRLEtBQUssR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFLLE9BQU8sR0FBRTtZQUN0QyxJQUFJLENBQUMsRUFBRSxDQUFDLHFCQUFxQixFQUFFLENBQUM7U0FDbkM7YUFBTTtZQUNILElBQUksQ0FBQyxVQUFVLENBQUMsS0FBSyxFQUFFLE9BQU8sQ0FBQyxDQUFDO1NBQ25DO0lBQ0wsQ0FBQzs7Ozs7O0lBRUQscUNBQU87Ozs7O0lBQVAsVUFBUSxLQUFpQixFQUFFLE9BQU87O1lBQzFCLElBQUksR0FBRyxJQUFJLENBQUMsUUFBUTtRQUN4QixJQUFJLE9BQU8sQ0FBQyxNQUFNLEVBQUU7WUFDaEIsSUFBSSxHQUFHLE9BQU8sQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDO1NBQ2xDOztZQUNLLEtBQUssR0FBRyxJQUFJLENBQUMsU0FBUzs7OztRQUFDLFVBQUEsQ0FBQyxJQUFJLE9BQUEsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLEtBQUssT0FBTyxDQUFDLEVBQUUsRUFBeEIsQ0FBd0IsRUFBQztRQUMzRCxJQUFJLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUMzQixJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssR0FBRyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFDMUIsSUFBSSxDQUFDLEVBQUUsQ0FBQyxxQkFBcUIsRUFBRSxDQUFDO0lBQ3BDLENBQUM7Ozs7OztJQUVELHdDQUFVOzs7OztJQUFWLFVBQVcsS0FBaUIsRUFBRSxPQUFPOztZQUM3QixJQUFJLEdBQUcsSUFBSSxDQUFDLFFBQVE7UUFDeEIsSUFBSSxPQUFPLENBQUMsTUFBTSxFQUFFO1lBQ2hCLElBQUksR0FBRyxPQUFPLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQztTQUNsQzs7WUFFSyxLQUFLLEdBQUcsSUFBSSxDQUFDLFNBQVM7Ozs7UUFBQyxVQUFBLENBQUMsSUFBSSxPQUFBLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRSxLQUFLLE9BQU8sQ0FBQyxFQUFFLEVBQXhCLENBQXdCLEVBQUM7UUFDM0QsSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDeEIsSUFBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFFdEIsSUFBSSxDQUFDLE9BQU8sQ0FBQyxNQUFNLEVBQUU7WUFDakIsSUFBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLEVBQUUsT0FBTyxDQUFDLENBQUM7U0FDL0I7YUFBTTtZQUNILElBQUksQ0FBQyxFQUFFLENBQUMscUJBQXFCLEVBQUUsQ0FBQztTQUNuQztJQUNMLENBQUM7SUFFRCxjQUFjOzs7OztJQUNkLG9EQUFzQjs7OztJQUF0Qjs7WUFDVSxTQUFTLEdBQUcsSUFBSSxDQUFDLFdBQVcsRUFBRTtRQUNwQyxPQUFPLElBQUksQ0FBQyxhQUFhLENBQUMsU0FBUyxDQUFDLENBQUM7SUFDekMsQ0FBQztJQUVBLFlBQVk7Ozs7O0lBQ1osOENBQWdCOzs7O0lBQWhCOztZQUNTLEdBQUcsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLElBQUk7Ozs7UUFBQyxVQUFBLENBQUMsSUFBSSxPQUFBLENBQUMsQ0FBQyxJQUFJLENBQUMsYUFBYSxFQUFwQixDQUFvQixFQUFDO1FBQ3pELElBQUksR0FBRyxFQUFFO1lBQ0wsT0FBTyxHQUFHLENBQUMsUUFBUSxDQUFDO1NBQ3ZCO2FBQU07WUFDSCxPQUFPLEVBQUUsQ0FBQztTQUNiO0lBQ0wsQ0FBQzs7Ozs7SUFFTyx5Q0FBVzs7OztJQUFuQjs7WUFDVSxHQUFHLEdBQUcsSUFBSSxDQUFDLGdCQUFnQixFQUFFO1FBQ25DLE9BQU8sSUFBSSxDQUFDLEVBQUUsQ0FBQyxlQUFlLENBQUMsTUFBTTs7OztRQUFDLFVBQUEsQ0FBQztZQUNuQyxPQUFPLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsYUFBYSxJQUFJLEdBQUcsQ0FBQyxTQUFTOzs7O1lBQUMsVUFBQSxDQUFDLElBQUksT0FBQSxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUUsS0FBSyxDQUFDLENBQUMsRUFBRSxFQUFsQixDQUFrQixFQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7UUFDdkYsQ0FBQyxFQUFDLENBQUM7SUFDUCxDQUFDO0lBRUQsc0JBQXNCOzs7Ozs7SUFDdEIsMkNBQWE7Ozs7O0lBQWIsVUFBYyxRQUFtQjtRQUFqQyxpQkErRkM7O1lBOUZTLENBQUMsR0FBRyxFQUFFOztZQUNOLEtBQUs7Ozs7O1FBQUcsVUFBQyxHQUFHLEVBQUUsRUFBRSxJQUFLLE9BQUEsSUFBSSxDQUFDLEdBQUcsT0FBUixJQUFJLG1CQUFRLEdBQUcsQ0FBQyxHQUFHLENBQUMsT0FBTyxFQUFFLEtBQUssVUFBVSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQzs7OztRQUFDLFVBQUEsR0FBRyxJQUFJLE9BQUEsR0FBRyxDQUFDLEVBQUUsQ0FBQyxFQUFQLENBQU8sQ0FBQSxDQUFDLElBQW5FLENBQW9FLENBQUE7O1lBQ3pGLFFBQVEsR0FBRyxLQUFLLENBQUMsUUFBUTs7OztRQUFFLFVBQUMsQ0FBQyxJQUFLLE9BQUEsQ0FBQyxDQUFDLEtBQUssRUFBUCxDQUFPLEVBQUM7UUFDaEQsY0FBYztRQUNkLFFBQVEsR0FBRyxRQUFRLENBQUMsTUFBTTs7OztRQUFDLFVBQUEsQ0FBQyxJQUFJLE9BQUEsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLFFBQVEsSUFBRyxDQUFDLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxNQUFNLElBQUksQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxXQUFXLEVBQWpHLENBQWlHLEVBQUMsQ0FBQzs7Ozs7OztZQU83SCxPQUFPLEdBQUcsUUFBUSxDQUFDLE1BQU07Ozs7UUFBQyxVQUFBLENBQUMsSUFBSSxPQUFBLENBQUMsQ0FBQyxDQUFDLE1BQU0sRUFBVCxDQUFTLEVBQUM7UUFDL0MsSUFBSSxDQUFDLE9BQU8sQ0FBQyxNQUFNOzs7O1FBQUMsVUFBQSxDQUFDLElBQUksT0FBQSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssSUFBSSxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLEtBQUssU0FBUyxFQUFyRCxDQUFxRCxFQUFDLENBQUMsTUFBTSxFQUFFOztnQkFDOUUsUUFBUSxHQUFHLE9BQU8sQ0FBQyxNQUFNOzs7O1lBQUMsVUFBQSxDQUFDLElBQUksT0FBQSxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLEtBQUssTUFBTSxFQUE1QixDQUE0QixFQUFDOztnQkFDNUQsU0FBUyxHQUFHLE9BQU8sQ0FBQyxNQUFNOzs7O1lBQUMsVUFBQSxDQUFDLElBQUksT0FBQSxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLEtBQUssT0FBTyxFQUE3QixDQUE2QixFQUFDO1lBQ3BFLElBQUksUUFBUSxDQUFDLE1BQU0sSUFBSSxPQUFPLENBQUMsTUFBTSxJQUFJLFNBQVMsQ0FBQyxNQUFNLElBQUksT0FBTyxDQUFDLE1BQU0sRUFBRTtnQkFDekUsUUFBUSxDQUFDLE9BQU87Ozs7Z0JBQUMsVUFBQSxDQUFDO29CQUNkLElBQUksT0FBTyxDQUFDLElBQUk7Ozs7b0JBQUMsVUFBQSxDQUFDLElBQUksT0FBQSxDQUFDLENBQUMsRUFBRSxLQUFLLENBQUMsQ0FBQyxFQUFFLEVBQWIsQ0FBYSxFQUFDLEVBQUU7d0JBQ2xDLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssR0FBRyxFQUFFLENBQUE7cUJBQ3pCO2dCQUNMLENBQUMsRUFBQyxDQUFDO2FBQ047aUJBQU07Z0JBQ0gsSUFBSSxTQUFTLENBQUMsTUFBTSxLQUFLLENBQUMsRUFBRTtvQkFDeEIsUUFBUSxDQUFDLE9BQU87Ozs7b0JBQUMsVUFBQSxDQUFDO3dCQUNkLFFBQVEsQ0FBQyxPQUFPOzs7O3dCQUFDLFVBQUEsQ0FBQzs0QkFDZCxJQUFJLENBQUMsQ0FBQyxFQUFFLEtBQUssQ0FBQyxDQUFDLEVBQUUsRUFBRTtnQ0FDZixDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLEdBQUcsRUFBRSxDQUFBOzZCQUN6Qjt3QkFDTCxDQUFDLEVBQUMsQ0FBQztvQkFDUCxDQUFDLEVBQUMsQ0FBQztpQkFDTjtxQkFBTTtvQkFDSCxTQUFTLENBQUMsT0FBTzs7OztvQkFBQyxVQUFBLENBQUM7d0JBQ2YsUUFBUSxDQUFDLE9BQU87Ozs7d0JBQUMsVUFBQSxDQUFDOzRCQUNkLElBQUksQ0FBQyxDQUFDLEVBQUUsS0FBSyxDQUFDLENBQUMsRUFBRSxFQUFFO2dDQUNmLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssR0FBRyxFQUFFLENBQUE7NkJBQ3pCO3dCQUNMLENBQUMsRUFBQyxDQUFDO29CQUNQLENBQUMsRUFBQyxDQUFDO2lCQUNOO2FBQ0o7U0FDSjtnQ0FHUSxDQUFDO1lBQ04sQ0FBQyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsTUFBTTs7OztZQUFDLFVBQUEsQ0FBQyxJQUFJLE9BQUEsQ0FBQyxDQUFDLEtBQUssS0FBSyxDQUFDLEVBQWIsQ0FBYSxFQUFDLENBQUMsR0FBRzs7OztZQUFDLFVBQUEsQ0FBQzs7b0JBQ3RDLElBQUksR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUk7O29CQUNsQixNQUFNLEdBQUcsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsS0FBSSxDQUFDLEVBQUUsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBRSxDQUFDLElBQUksQ0FBQyxLQUFLLElBQUksRUFBRSxDQUFDOztvQkFHL0UsUUFBUSxHQUFHLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxNQUFNOzs7O2dCQUFDLFVBQUEsQ0FBQyxJQUFJLE9BQUEsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUFFLENBQUMsT0FBTyxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUFsRSxDQUFrRSxFQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDOztvQkFDdkksUUFBUSxHQUFHLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxRQUFRLElBQUksQ0FBQyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsUUFBUSxHQUFHLENBQUMsQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFDOztvQkFFekYsTUFBTSxHQUFRO29CQUNoQixLQUFLLEVBQUUsSUFBSSxDQUFDLEtBQUs7b0JBQ2pCLEtBQUssRUFBRSxJQUFJLENBQUMsS0FBSztvQkFDakIsUUFBUSxFQUFFLElBQUksQ0FBQyxRQUFRO29CQUN2QixLQUFLLEVBQUUsSUFBSSxDQUFDLEtBQUs7b0JBQ2pCLE1BQU0sRUFBRSxJQUFJLENBQUMsTUFBTSxJQUFJLE1BQU07b0JBQzdCLEtBQUssRUFBRSxJQUFJLENBQUMsS0FBSyxJQUFJLE1BQU07b0JBQzNCLE9BQU8sRUFBRSxJQUFJO29CQUNiLGFBQWEsRUFBRSxJQUFJLENBQUMsYUFBYTtvQkFDakMsV0FBVyxFQUFFLElBQUksQ0FBQyxXQUFXO29CQUM3QixNQUFNLEVBQUUsSUFBSSxDQUFDLE1BQU07b0JBQ25CLEtBQUssRUFBRSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUM7b0JBQzFDLFFBQVEsRUFBRSxJQUFJLENBQUMsUUFBUSxJQUFJLFFBQVE7b0JBQ25DLEtBQUssRUFBRSxNQUFNLEtBQUssU0FBUyxDQUFBLENBQUMsQ0FBQyxFQUFFLENBQUEsQ0FBQyxDQUFDLE1BQU07b0JBQ3ZDLEVBQUUsRUFBRSxDQUFDLENBQUMsRUFBRTtvQkFDUixRQUFRLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsSUFBSTtvQkFDakQsT0FBTyxFQUFFLFFBQVE7b0JBQ2pCLE9BQU8sRUFBRSxRQUFRO2lCQUNwQjs7b0JBRUssT0FBTyxHQUFRO29CQUNqQixLQUFLLEVBQUUsSUFBSSxDQUFDLEtBQUs7b0JBQ2pCLEtBQUssRUFBRSxJQUFJLENBQUMsS0FBSztvQkFDakIsTUFBTSxFQUFFLElBQUksQ0FBQyxNQUFNLElBQUksTUFBTTtvQkFDN0IsS0FBSyxFQUFFLElBQUksQ0FBQyxLQUFLLElBQUksTUFBTTtvQkFDM0IsT0FBTyxFQUFFLElBQUk7b0JBQ2IsV0FBVyxFQUFFLEVBQUU7b0JBQ2YsTUFBTSxFQUFFLEVBQUU7b0JBQ1YsS0FBSyxFQUFFLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQztvQkFDMUMsUUFBUSxFQUFFLElBQUksQ0FBQyxRQUFRLElBQUksUUFBUTtvQkFDbkMsS0FBSyxFQUFFLE1BQU0sS0FBSyxTQUFTLENBQUEsQ0FBQyxDQUFDLEVBQUUsQ0FBQSxDQUFDLENBQUMsTUFBTTtvQkFDdkMsRUFBRSxFQUFFLENBQUMsQ0FBQyxFQUFFO29CQUNSLFFBQVEsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxJQUFJO29CQUNqRCxPQUFPLEVBQUUsUUFBUTtvQkFDakIsT0FBTyxFQUFFLFFBQVE7aUJBQ3BCO2dCQUVELE9BQU8sQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBRSxPQUFPLENBQUEsQ0FBQyxDQUFDLE1BQU0sQ0FBQztZQUN0RCxDQUFDLEVBQUMsQ0FBQyxDQUFDOztRQS9DUixLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLElBQUksUUFBUSxFQUFFLENBQUMsRUFBRTtvQkFBekIsQ0FBQztTQWdEVDtRQUVELE9BQU8sQ0FBQyxDQUFDO0lBQ2IsQ0FBQzs7Ozs7O0lBV08sZ0RBQWtCOzs7OztJQUExQixVQUEyQixLQUFpQjtRQUE1QyxpQkFRQztRQVBHLEtBQUssQ0FBQyxPQUFPOzs7O1FBQUMsVUFBQyxDQUFNO1lBQ2pCLE9BQU8sQ0FBQyxDQUFDLE1BQU0sQ0FBQztZQUNoQixPQUFPLENBQUMsQ0FBQyxVQUFVLENBQUM7WUFDcEIsSUFBSSxDQUFDLENBQUMsUUFBUSxJQUFJLENBQUMsQ0FBQyxRQUFRLENBQUMsTUFBTSxFQUFFO2dCQUNqQyxLQUFJLENBQUMsa0JBQWtCLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxDQUFDO2FBQ3ZDO1FBQ0wsQ0FBQyxFQUFDLENBQUE7SUFDTixDQUFDOzs7O0lBRUQseUNBQVc7OztJQUFYO1FBQ0ksSUFBSSxDQUFDLGtCQUFrQixDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUN2QyxPQUFPO1lBQ0gsUUFBUSxFQUFFLElBQUksQ0FBQyxzQkFBc0IsRUFBRTtZQUN2QyxRQUFRLEVBQUUsSUFBSSxDQUFDLFFBQVE7U0FDMUIsQ0FBQztJQUNOLENBQUM7Ozs7OztJQUVELHVDQUFTOzs7OztJQUFULFVBQVUsTUFBa0IsRUFBRSxFQUFFO1FBQzVCLE1BQU0sQ0FBQyxlQUFlLEVBQUUsQ0FBQztRQUV6QixJQUFJLElBQUksQ0FBQyxFQUFFLENBQUMsV0FBVyxJQUFJLEVBQUUsS0FBSyxJQUFJLENBQUMsRUFBRSxDQUFDLFdBQVcsQ0FBQyxFQUFFLEVBQUU7WUFDdEQsSUFBSSxDQUFDLEVBQUUsQ0FBQyxlQUFlLEVBQUUsQ0FBQztZQUMxQixJQUFJLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztTQUNoQztRQUVELElBQUksQ0FBQyxFQUFFLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxDQUFDO0lBRXZCLENBQUM7Ozs7OztJQUVELDZDQUFlOzs7OztJQUFmLFVBQWdCLE1BQWtCLEVBQUUsT0FBZ0I7UUFBcEQsaUJBY0M7O1lBYlMsUUFBUSxHQUFHLElBQUksQ0FBQyxtQkFBbUI7OztRQUFDOztnQkFDaEMsTUFBTSxHQUFHLG1CQUFBLFFBQVEsQ0FBQyxPQUFPLEVBQTBCO1lBQ3pELElBQUksTUFBTSxDQUFDLEtBQUssRUFBRTtnQkFDZCxPQUFPLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLEdBQUcsTUFBTSxDQUFDLEtBQUssQ0FBQztnQkFDdkMsUUFBUSxDQUFDLEtBQUssRUFBRSxDQUFDO2FBQ3BCO2lCQUFNO2dCQUNILEtBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLEtBQUksQ0FBQyxXQUFXLENBQUMsUUFBUSxDQUFDLENBQUM7Z0JBQy9DLE1BQU0sQ0FBQyxLQUFLLENBQUMsYUFBYSxDQUFDLEtBQUssRUFBRSxDQUFDO2FBQ3RDO1FBQ04sQ0FBQyxHQUFFLElBQUksQ0FBQyxXQUFXLENBQUMsWUFBWSxDQUFDLE1BQU0sQ0FBQzs7WUFFbEMsTUFBTSxHQUFHLG1CQUFBLFFBQVEsQ0FBQyxPQUFPLEVBQTBCO1FBQ3pELE1BQU0sQ0FBQyxLQUFLLEdBQUcsT0FBTyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDO0lBQzFDLENBQUM7O2dCQTN1QkosU0FBUyxTQUFDO29CQUNQLFFBQVEsRUFBRSxhQUFhO29CQUV2QixxcEdBQTJDO29CQUMzQyxRQUFRLEVBQUUsaUJBQWlCO29CQUMzQixhQUFhLEVBQUUsaUJBQWlCLENBQUMsSUFBSTs7aUJBQ3hDOzs7O2dCQXhCOEUsUUFBUTtnQkFBUyxNQUFNO2dCQUE5RSxpQkFBaUI7Z0JBQXFHLFNBQVM7Z0JBSTlJLGNBQWM7Z0JBSjRDLFVBQVU7Z0JBT3BFLGFBQWE7OztxQkFvQmpCLEtBQUs7MEJBQ0wsS0FBSzswQkFFTCxLQUFLOytCQUVMLE1BQU07MkJBRU4sU0FBUyxTQUFDLGNBQWM7cUJBQ3hCLFNBQVMsU0FBQyxJQUFJOztJQTR0Qm5CLDBCQUFDO0NBQUEsQUE3dUJELElBNnVCQztTQXR1QlksbUJBQW1COzs7SUFFNUIsaUNBQStCOztJQUMvQixzQ0FBa0Q7O0lBRWxELHNDQUF5Qjs7SUFFekIsMkNBQWlEOztJQUVqRCx1Q0FBcUQ7O0lBQ3JELGlDQUF3Qzs7SUFFeEMscUNBQVk7O0lBQ1osdUNBQWM7O0lBQ2QsdUNBQWM7O0lBQ2QsMkNBQWtCOzs7OztJQUdsQiw4Q0FBd0M7O0lBR3hDLGdEQUFzRDs7SUFFdEQsMENBQWdGOztJQUdoRiwwQ0F3QkM7Ozs7O0lBRUQsd0NBQXdDOzs7OztJQThJeEMsb0RBU0M7O0lBRUQsNENBU0M7O0lBeWRELHNEQU1DOzs7OztJQWhvQlcsdUNBQTBCOzs7OztJQUFFLHFDQUFzQjs7Ozs7SUFBRSxpQ0FBNkI7Ozs7O0lBQUUscUNBQXlCOzs7OztJQUNwSCwyQ0FBb0M7Ozs7O0lBQUUsaUNBQXNCOzs7OztJQUM1RCx3Q0FBZ0MiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBZnRlclZpZXdJbml0LCBDaGFuZ2VEZXRlY3RvclJlZixFdmVudEVtaXR0ZXIsIENvbXBvbmVudCwgRWxlbWVudFJlZiwgSW5qZWN0b3IsIElucHV0LCBOZ1pvbmUsIE9uQ2hhbmdlcywgT25EZXN0cm95LCBPbkluaXQsIE91dHB1dCwgUmVuZGVyZXIyLCBTaW1wbGVDaGFuZ2VzLCBUZW1wbGF0ZVJlZiwgVmlld0NoaWxkLCBWaWV3RW5jYXBzdWxhdGlvbiB9IGZyb20gXCJAYW5ndWxhci9jb3JlXCI7XHJcblxyXG5pbXBvcnQgeyBvZiB9IGZyb20gXCJyeGpzXCI7XHJcblxyXG5pbXBvcnQgeyBCc01vZGFsU2VydmljZSB9IGZyb20gXCJAZmFycmlzL3VpLW1vZGFsXCI7XHJcbmltcG9ydCB7IFJvd05vZGUsIFRyZWVOb2RlLCBUcmVlVGFibGVDb21wb25lbnQgfSBmcm9tIFwiQGZhcnJpcy91aS10cmVldGFibGVcIjtcclxuaW1wb3J0IHsgT3ZlckxheUhpZGRlblNlcnZpY2UgfSBmcm9tICdAZmFycmlzL3VpLWNvbW1vbic7XHJcbmltcG9ydCB7IE5vdGlmeVNlcnZpY2UgfSBmcm9tICdAZmFycmlzL3VpLW5vdGlmeSc7XHJcbmltcG9ydCB7IERhdGFncmlkQ29tcG9uZW50LCBEYXRhQ29sdW1uIH0gZnJvbSAnQGZhcnJpcy91aS1kYXRhZ3JpZCc7XHJcblxyXG5pbXBvcnQgeyBOZXdIZWFkZXJGb3JtQ29tcG9uZW50IH0gZnJvbSBcIi4vbmV3LWhlYWRlci5jb21wb25lbnRcIjtcclxuaW1wb3J0IHsgU2V0Q29sdW1uc0NvbXBvbmVudCB9IGZyb20gXCIuL3NldGNvbHVtbnMuY29tcG9uZW50XCI7XHJcbmltcG9ydCB7IGNvbHVtbnNUb1RyZWVOb2RlcyB9IGZyb20gXCIuLi9tdXRsaS1oZWFkZXJzLmhlbHBlclwiO1xyXG5pbXBvcnQgeyBjbG9uZURlZXAsIGZsYXR0ZW4gfSBmcm9tIFwibG9kYXNoLWVzXCI7XHJcbmltcG9ydCB7IENvbHVtblRyZWVPcHRpb25zIH0gZnJvbSBcIi4uL3NldHRpbmcubW9kZWxcIjtcclxuaW1wb3J0IHsgTG9jYWxlU2VydmljZSB9IGZyb20gXCJAZmFycmlzL3VpLWxvY2FsZVwiO1xyXG5cclxuXHJcbkBDb21wb25lbnQoe1xyXG4gICAgc2VsZWN0b3I6ICdjb2x1bW4tdHJlZScsXHJcbiAgICBzdHlsZVVybHM6IFsnLi9jb2x1bW4tdHJlZS5zY3NzJ10sXHJcbiAgICB0ZW1wbGF0ZVVybDogJy4vY29sdW1uLXRyZWUuY29tcG9uZW50Lmh0bWwnLFxyXG4gICAgZXhwb3J0QXM6ICdncm91cEhlYWRlclRyZWUnLFxyXG4gICAgZW5jYXBzdWxhdGlvbjogVmlld0VuY2Fwc3VsYXRpb24uTm9uZVxyXG59KVxyXG5leHBvcnQgY2xhc3MgQ29sdW1uVHJlZUNvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgT25EZXN0cm95LCBBZnRlclZpZXdJbml0LCBPbkNoYW5nZXMge1xyXG5cclxuICAgIEBJbnB1dCgpIGRnOiBEYXRhZ3JpZENvbXBvbmVudDtcclxuICAgIEBJbnB1dCgpIG9wdGlvbnM6IFBhcnRpYWw8Q29sdW1uVHJlZU9wdGlvbnM+ID0ge307XHJcblxyXG4gICAgQElucHV0KCkgaW5Nb2RhbCA9IGZhbHNlO1xyXG5cclxuICAgIEBPdXRwdXQoKSBub2RlU2VsZWN0ZWQgPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcclxuICAgIFxyXG4gICAgQFZpZXdDaGlsZCgnbm9kZVRlbXBsYXRlJykgY2VsbFRlbXA6IFRlbXBsYXRlUmVmPGFueT5cclxuICAgIEBWaWV3Q2hpbGQoJ3R0JykgdHQ6IFRyZWVUYWJsZUNvbXBvbmVudDtcclxuICAgIFxyXG4gICAgZmllbGRzID0gW107XHJcbiAgICB0cmVlY29scyA9IFtdO1xyXG4gICAgdHJlZURhdGEgPSBbXTtcclxuICAgIGNvbnRleHRNZW51cyA9IFtdO1xyXG5cclxuICAgIC8qKiDlgLwgX19IT1VfWFVBTl9MSUVfSURfXyAqL1xyXG4gICAgSE9VX1hVQU5fTElFX0lEID0gJ19fSE9VX1hVQU5fTElFX0lEX18nO1xyXG5cclxuXHJcbiAgICBHUk9VUF9IRUFERVJfSUNPTiA9ICdmLWljb24gZi1pY29uLWZpbGUtZm9sZGVyLWNsb3NlJztcclxuXHJcbiAgICBIb3VfWHVhbl9RdSA9IHsgaWQ6IHRoaXMuSE9VX1hVQU5fTElFX0lELCB0aXRsZTogJyjlgJnpgInliJcpJywgaG91eHVhbnF1Tm9kZTogdHJ1ZSB9O1xyXG5cclxuXHJcbiAgICBsYW5ndWFnZVJlcyA9IHtcclxuICAgICAgICB0aXRsZTogJ+WkmuihqOWktCcsXHJcbiAgICAgICAgcHJldmlldzogJ+mihOiniOaViOaenCcsXHJcbiAgICAgICAgdGlwczogJ+WcqO+8iOWAmemAieWIl++8ieS4reeahOWtl+aute+8jOWwhuS4jeWcqOWIl+ihqOS4reaYvuekujsg54K55Ye75a2X5q615ZCN56ew77yM5Zyo5Y+z5L6n5pi+56S655u45YWz5pON5L2c5oyJ6ZKu44CCJyxcclxuICAgICAgICBjb250ZXh0TWVudXM6IHtcclxuICAgICAgICAgICAgbmV3OiAn5paw5bu66KGo5aS0JyxcclxuICAgICAgICAgICAgbmV3Q2hpbGQ6ICfmlrDlu7rlrZDnuqfooajlpLQnLFxyXG4gICAgICAgICAgICBzZXREYXRhRmllbGQ6ICfliIbphY3mlbDmja7liJcnLFxyXG4gICAgICAgICAgICByZW5hbWU6ICfph43lkb3lkI0nLFxyXG4gICAgICAgICAgICB0b3A6ICfnva7pobYnLFxyXG4gICAgICAgICAgICB1cDogJ+S4iuenuycsXHJcbiAgICAgICAgICAgIGRvd246ICfkuIvnp7snLFxyXG4gICAgICAgICAgICBib3R0b206ICfnva7lupUnLFxyXG4gICAgICAgICAgICBjYW5jZWxHcm91cDogJ+WPlua2iOWIhue7hCcsXHJcbiAgICAgICAgICAgIHJlbW92ZTogJ+WcqOWIhue7hOWGheenu+mZpCdcclxuICAgICAgICB9LFxyXG4gICAgICAgIGNhbmRpZGF0ZTogJyjlgJnpgInliJcpJyxcclxuICAgICAgICBzZXRIZWFkZXI6ICforr7kuLrooajlpLQnLFxyXG4gICAgICAgIG9rOiAn56Gu5a6aJyxcclxuICAgICAgICBjYW5jZWw6ICflj5bmtognLFxyXG4gICAgICAgIHJlcXVpcmVkOiAn6K+36L6T5YWl6KGo5aS05ZCN56ew77yBJyxcclxuICAgICAgICBkZWZhdWx0R3JvdXBIZWFkZXJOYW1lOiAn5YiG57uE6KGo5aS0MScsXHJcbiAgICAgICAgbmV3SGVhZGVyUGxhY2Vob2xkZXI6ICfor7fovpPlhaXlkI3np7AnLFxyXG4gICAgICAgIG5ld0hlYWRlckxhYmVsOiAn6KGo5aS05ZCN56ewJ1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgbG9jYWxlU2VyOiBMb2NhbGVTZXJ2aWNlID0gbnVsbDtcclxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgaW5qZWN0b3I6IEluamVjdG9yLCBwcml2YXRlIG5nem9uZTogTmdab25lLCBwcml2YXRlIGNkOiBDaGFuZ2VEZXRlY3RvclJlZiwgcHJpdmF0ZSByZW5kZXI6IFJlbmRlcmVyMixcclxuICAgICAgICBwcml2YXRlIG1vZGFsU2VydmljZTogQnNNb2RhbFNlcnZpY2UsIHByaXZhdGUgZWw6IEVsZW1lbnRSZWYsXHJcbiAgICAgICAgcHJpdmF0ZSBub3RpdHlTZXI6IE5vdGlmeVNlcnZpY2UpIHtcclxuICAgICAgICAgICAgdGhpcy5sb2NhbGVTZXIgPSB0aGlzLmluamVjdG9yLmdldChMb2NhbGVTZXJ2aWNlLCBudWxsKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgbmdPbkluaXQoKTogdm9pZCB7XHJcbiAgICAgICAgY29uc3QgZ3JvdXBIZWFkZXJzID0gdGhpcy5kZy5kZnNbJ19zdGF0ZSddLmluaXRpYWxPcHRpb25zLmdyb3VwSGVhZGVyRmllbGRzO1xyXG4gICAgICAgIGNvbnN0IGFsbERhdGFGaWVsZHMgPSBmbGF0dGVuPERhdGFDb2x1bW4+KGdyb3VwSGVhZGVycykuZmlsdGVyKChjb2w6IERhdGFDb2x1bW4pID0+ICFjb2wuY29sc3BhbiB8fCBjb2wuY29sc3BhbiA9PSAxKTtcclxuICAgICAgICB0aGlzLmZpZWxkcyA9IGFsbERhdGFGaWVsZHMuZmlsdGVyKG4gPT4gbi5maWVsZCAmJiBuLmZpZWxkICE9PSB0aGlzLmRnLkNvbnRyb2xQYW5lbEZlaWxkKTtcclxuXHJcbiAgICAgICAgLy8g5qCR57uE5Lu25YiX5L+h5oGvXHJcbiAgICAgICAgdGhpcy50cmVlY29scyA9IFtcclxuICAgICAgICAgICAgeyBmaWVsZDogJ3RpdGxlJywgdGl0bGU6ICflkI3np7AnLCB0ZW1wbGF0ZTogdGhpcy5jZWxsVGVtcCB9XHJcbiAgICAgICAgXTtcclxuXHJcbiAgICAgICAgdGhpcy5sYW5ndWFnZVJlcyA9IHRoaXMubG9jYWxlU2VyLmdldFZhbHVlKCdoZWFkZXJHcm91cCcpO1xyXG4gICAgICAgIHRoaXMuSG91X1h1YW5fUXUudGl0bGUgPSB0aGlzLmxhbmd1YWdlUmVzLmNhbmRpZGF0ZTtcclxuXHJcbiAgICAgICAgdGhpcy5pbml0VHJlZURhdGEoKTtcclxuXHJcbiAgICAgICAgdGhpcy5pbml0VHJlZW5vZGVDb250ZXh0TWVudXMoKTtcclxuICAgICAgICB0aGlzLmxpc3RlblRyZWVUYWJsZUV2ZW50KCk7XHJcbiAgICB9XHJcblxyXG4gICAgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcyk6IHZvaWQge1xyXG4gICAgICAgIGlmIChjaGFuZ2VzLm9wdGlvbnMgJiYgIWNoYW5nZXMub3B0aW9ucy5pc0ZpcnN0Q2hhbmdlKCkpIHtcclxuICAgICAgICAgICAgdGhpcy5pbml0VHJlZURhdGEoKTtcclxuICAgICAgICAgICAgdGhpcy50dC5jbGVhclNlbGVjdGlvbnMoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgbmdBZnRlclZpZXdJbml0KCk6IHZvaWQge1xyXG4gICAgfVxyXG5cclxuICAgIG5nT25EZXN0cm95KCk6IHZvaWQge1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgbGlzdGVuVHJlZVRhYmxlRXZlbnQoKSB7XHJcbiAgICAgICAgdGhpcy50dC5yZW1vdmVkLnN1YnNjcmliZShyb3dOb2RlID0+IHtcclxuXHJcbiAgICAgICAgICAgIGlmIChyb3dOb2RlICYmIHJvd05vZGUucGFyZW50KSB7XHJcbiAgICAgICAgICAgICAgICByb3dOb2RlLnBhcmVudC5sZWFmID0gIShyb3dOb2RlLnBhcmVudC5jaGlsZHJlbiAmJiByb3dOb2RlLnBhcmVudC5jaGlsZHJlbi5sZW5ndGgpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHJvd05vZGUucGFyZW50LmxlYWYpIHtcclxuICAgICAgICAgICAgICAgICAgICByb3dOb2RlLnBhcmVudC5pY29uID0gdGhpcy5HUk9VUF9IRUFERVJfSUNPTjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKCFyb3dOb2RlLm5vZGUuZGF0YS5ncm91cEhlYWRlcikge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgaHhsID0gdGhpcy5nZXRIb3VYdWFuTm9kZSgpO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmICghcm93Tm9kZS5wYXJlbnQpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnRyZWVEYXRhID0gdGhpcy50cmVlRGF0YS5maWx0ZXIobiA9PiBuLmRhdGEuaWQgIT09IHJvd05vZGUuaWQpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHRoaXMudHQuYXBwZW5kKHJvd05vZGUubm9kZS5kYXRhLCBoeGwubm9kZSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICBcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGluaXRUcmVlbm9kZUNvbnRleHRNZW51cygpIHtcclxuICAgICAgICB0aGlzLmNvbnRleHRNZW51cyA9IFtcclxuICAgICAgICAgICAgeyBpZDogMSwgdGl0bGU6IHRoaXMubGFuZ3VhZ2VSZXMuY29udGV4dE1lbnVzLm5ldywgaWNvbjogJ2YtaWNvbiBmLWljb24tYWRkJywgXHJcbiAgICAgICAgICAgICAgICBoYW5kbGU6ICh0KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2codCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5hZGROZXdHcm91cCh0LmRhdGEsIGZhbHNlKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgeyBpZDogMiwgdGl0bGU6IHRoaXMubGFuZ3VhZ2VSZXMuY29udGV4dE1lbnVzLm5ld0NoaWxkLCB2aXNpYmxlOiAodDogYW55KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuaXNHcm91cEhlYWRlcih0LmRhdGEpICYmIHQuZGF0YS5sZXZlbCArIDEgPCB0aGlzLmRnLm1heE11bHRpSGVhZGVycyAtIDE7XHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgaGFuZGxlOiAodCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYWRkTmV3R3JvdXAodC5kYXRhLCB0cnVlKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgeyBpZDogMywgdGl0bGU6IHRoaXMubGFuZ3VhZ2VSZXMuY29udGV4dE1lbnVzLnNldERhdGFGaWVsZCwgdmlzaWJsZTogKHQ6IGFueSkgPT4ge3JldHVybiB0aGlzLmlzR3JvdXBIZWFkZXIodC5kYXRhKSB9LFxyXG4gICAgICAgICAgICAgICAgaGFuZGxlOiAodCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0Q29sdW1uc0Zvckdyb3VwSGVhZGVyKG51bGwsIHQuZGF0YSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHsgaWQ6IDMxLCB0aXRsZTogdGhpcy5sYW5ndWFnZVJlcy5jb250ZXh0TWVudXMucmVuYW1lLCBpY29uOiAnZi1pY29uIGYtaWNvbi1lZGl0JywgXHJcbiAgICAgICAgICAgICAgICBoYW5kbGU6ICh0KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZXNldEhlYWRlck5hbWUobnVsbCwgdC5kYXRhKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgJy0nLFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpZDogNCwgdGl0bGU6IHRoaXMubGFuZ3VhZ2VSZXMuY29udGV4dE1lbnVzLnRvcCwgaWNvbjogJ2YtaWNvbiBmLWljb24tcm9vZmluZycsIFxyXG4gICAgICAgICAgICAgICAgdmlzaWJsZTogKHQ6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLm1vdmVNZW51SXRlbVZpc2libGlseSh0LmRhdGEpO1xyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIGhhbmRsZTogKHQpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLm1vdmVUb3AobnVsbCwgdC5kYXRhKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaWQ6IDUsIHRpdGxlOiB0aGlzLmxhbmd1YWdlUmVzLmNvbnRleHRNZW51cy51cCwgaWNvbjogJ2YtaWNvbiBmLWljb24tYXJyb3ctY2hldnJvbi11cCcsXHJcbiAgICAgICAgICAgICAgICB2aXNpYmxlOiAodDogYW55KSA9PiB7cmV0dXJuIHRoaXMubW92ZU1lbnVJdGVtVmlzaWJsaWx5KHQuZGF0YSl9LFxyXG4gICAgICAgICAgICAgICAgaGFuZGxlOiAodCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMubW92ZVVwKG51bGwsIHQuZGF0YSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGlkOiA2LCB0aXRsZTogdGhpcy5sYW5ndWFnZVJlcy5jb250ZXh0TWVudXMuZG93biwgaWNvbjogJ2YtaWNvbiBmLWljb24tYXJyb3ctY2hldnJvbi1kb3duJyxcclxuICAgICAgICAgICAgICAgIHZpc2libGU6ICh0OiBhbnkpID0+IHtyZXR1cm4gdGhpcy5tb3ZlTWVudUl0ZW1WaXNpYmxpbHkodC5kYXRhKX0sXHJcbiAgICAgICAgICAgICAgICBoYW5kbGU6ICh0KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5tb3ZlRG93bihudWxsLCB0LmRhdGEpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpZDogNywgdGl0bGU6IHRoaXMubGFuZ3VhZ2VSZXMuY29udGV4dE1lbnVzLmJvdHRvbSwgaWNvbjogJ2YtaWNvbiBmLWljb24tYm90dG9tc2V0dGluZycsXHJcbiAgICAgICAgICAgICAgICB2aXNpYmxlOiAodDogYW55KSA9PiB7cmV0dXJuIHRoaXMubW92ZU1lbnVJdGVtVmlzaWJsaWx5KHQuZGF0YSl9LFxyXG4gICAgICAgICAgICAgICAgaGFuZGxlOiAodCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMubW92ZUJvdHRvbShudWxsLCB0LmRhdGEpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAnLScsXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGlkOiA4LCB0aXRsZTogdGhpcy5sYW5ndWFnZVJlcy5jb250ZXh0TWVudXMucmVtb3ZlLCBpY29uOiAnZi1pY29uIGYtaWNvbi1taW51cycsXHJcbiAgICAgICAgICAgICAgICB2aXNpYmxlOiAodCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAhdC5kYXRhLm5vZGUuZGF0YS5ob3V4dWFucXVOb2RlICYmICF0LmRhdGEubm9kZS5kYXRhLmdyb3VwSGVhZGVyO1xyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIGhhbmRsZTogKHQpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnR0LnJlbW92ZSh0LmRhdGEuaWQpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpZDogOSwgdGl0bGU6IHRoaXMubGFuZ3VhZ2VSZXMuY29udGV4dE1lbnVzLmNhbmNlbEdyb3VwLCBpY29uOiAnZi1pY29uIGYtaWNvbi14JyxcclxuICAgICAgICAgICAgICAgIHZpc2libGU6ICh0KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHQuZGF0YS5ub2RlLmRhdGEuZ3JvdXBIZWFkZXI7XHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgaGFuZGxlOiAodCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMucmVtb3ZlR3JvdXAobnVsbCwgdC5kYXRhKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIF07XHJcbiAgICB9XHJcblxyXG4gICAgLyoqIOenu+WKqOWRveS7pOmhueaYr+WQpuaYvuekuiAqL1xyXG4gICAgbW92ZU1lbnVJdGVtVmlzaWJsaWx5ID0gKHQ6IFJvd05vZGUpID0+IHtcclxuICAgICAgICBpZiAodCkge1xyXG4gICAgICAgICAgICBjb25zdCByb3dEYXRhID0gdC5ub2RlLmRhdGE7XHJcbiAgICAgICAgICAgIGlmIChyb3dEYXRhKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcm93RGF0YVsnaWQnXSAhPSB0aGlzLkhPVV9YVUFOX0xJRV9JRDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9XHJcblxyXG4gICAgaXNHcm91cEhlYWRlciA9ICh0OiBSb3dOb2RlKSA9PiB7XHJcbiAgICAgICAgaWYgKHQpIHtcclxuICAgICAgICAgICAgY29uc3Qgcm93RGF0YSA9IHQubm9kZS5kYXRhO1xyXG4gICAgICAgICAgICBpZiAocm93RGF0YSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuICEhcm93RGF0YVsnZ3JvdXBIZWFkZXInXTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9XHJcblxyXG4gICAgaW5pdFRyZWVEYXRhKCkge1xyXG5cclxuICAgICAgICBpZiAodGhpcy5vcHRpb25zKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHsgdHJlZURhdGEgfSA9IHRoaXMub3B0aW9ucztcclxuXHJcbiAgICAgICAgICAgIGlmICh0cmVlRGF0YSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy50cmVlRGF0YSA9IHRyZWVEYXRhO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodGhpcy5vcHRpb25zLmNvbHVtbnMgJiYgdGhpcy5vcHRpb25zLmNvbHVtbnMubGVuZ3RoID4gMSkge1xyXG4gICAgICAgICAgICBjb25zdCBfdHJlZURhdGEgPSBjb2x1bW5zVG9UcmVlTm9kZXMoY2xvbmVEZWVwKHRoaXMub3B0aW9ucy5jb2x1bW5zKSk7XHJcbiAgICAgICAgICAgIGNvbnN0IGhvdVh1YW5MaWUgPSB0aGlzLmZpZWxkcy5maWx0ZXIoZiA9PiAhZmxhdHRlbih0aGlzLm9wdGlvbnMuY29sdW1ucykuZmluZChjb2wgPT4gY29sLmZpZWxkID09PSBmLmZpZWxkKSkubWFwKChhOmFueSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgICAgICBkYXRhOiBhLFxyXG4gICAgICAgICAgICAgICAgICAgIGNoaWxkcmVuOiBbXSxcclxuICAgICAgICAgICAgICAgICAgICB2aXNpYmxlOiB0cnVlXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBfdHJlZURhdGEucHVzaCh7XHJcbiAgICAgICAgICAgICAgICBkYXRhOiB0aGlzLkhvdV9YdWFuX1F1LFxyXG4gICAgICAgICAgICAgICAgY2hpbGRyZW46IGhvdVh1YW5MaWUsXHJcbiAgICAgICAgICAgICAgICBleHBhbmRlZDogdHJ1ZVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgdGhpcy50cmVlRGF0YSA9IF90cmVlRGF0YTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLnRyZWVEYXRhID0gW3tcclxuICAgICAgICAgICAgICAgIGRhdGE6IHsgaWQ6ICdncm91cEhlYWRlcl8xJywgdGl0bGU6IHRoaXMubGFuZ3VhZ2VSZXMuZGVmYXVsdEdyb3VwSGVhZGVyTmFtZSwgaGFsaWduOiAnbGVmdCcsIGdyb3VwSGVhZGVyOiB0cnVlIH0sXHJcbiAgICAgICAgICAgICAgICBjaGlsZHJlbjogdGhpcy5maWVsZHMubWFwKChuLCBpKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgblsnaW5kZXgnXSA9IGk7XHJcbiAgICAgICAgICAgICAgICAgICAgblsnaWQnXSA9IG5bJ2ZpZWxkJ107XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YTogbixcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2hpbGRyZW46IFtdLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2aXNpYmxlOiB0cnVlXHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgIH0pLFxyXG4gICAgICAgICAgICAgICAgaWNvbjogdGhpcy5HUk9VUF9IRUFERVJfSUNPTixcclxuICAgICAgICAgICAgICAgIGV4cGFuZGVkOiB0cnVlLCB2aXNpYmxlOiB0cnVlXHJcbiAgICAgICAgICAgIH0sIHtcclxuICAgICAgICAgICAgICAgIGRhdGE6IHRoaXMuSG91X1h1YW5fUXUsXHJcbiAgICAgICAgICAgICAgICBjaGlsZHJlbjogW10sXHJcbiAgICAgICAgICAgICAgICBleHBhbmRlZDogdHJ1ZSxcclxuICAgICAgICAgICAgICAgIGljb246IHRoaXMuR1JPVVBfSEVBREVSX0lDT05cclxuICAgICAgICAgICAgfV07XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZ2V0SG91WHVhbk5vZGUoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMudHQuZmluZFJvd05vZGUodGhpcy5IT1VfWFVBTl9MSUVfSUQpO1xyXG4gICAgfVxyXG5cclxuICAgIG9uVHJlZVNlbGVjdGVkKCRldmVudCkge1xyXG4gICAgICAgIHRoaXMubm9kZVNlbGVjdGVkLmVtaXQoJGV2ZW50KTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHNob3dOZXdIZWFkZXJEaWFsb2cob2tDYWxsYmFjaywgZGxnVGl0bGUpIHtcclxuICAgICAgICBjb25zdCBtb2RhbFJlZiA9IHRoaXMubW9kYWxTZXJ2aWNlLnNob3coTmV3SGVhZGVyRm9ybUNvbXBvbmVudCwge1xyXG4gICAgICAgICAgICB0aXRsZTogZGxnVGl0bGUsXHJcbiAgICAgICAgICAgIHdpZHRoOiAzNDAsXHJcbiAgICAgICAgICAgIGhlaWdodDogMTkwLFxyXG4gICAgICAgICAgICBzaG93TWF4QnV0dG9uOiBmYWxzZSxcclxuICAgICAgICAgICAgcmVzaXphYmxlOiBmYWxzZSxcclxuICAgICAgICAgICAgaW5pdGlhbFN0YXRlOiB7XHJcbiAgICAgICAgICAgICAgICB0aXRsZTogJycsXHJcbiAgICAgICAgICAgICAgICBwbGFjZWhvbGRlcjogdGhpcy5sYW5ndWFnZVJlcy5uZXdIZWFkZXJQbGFjZWhvbGRlcixcclxuICAgICAgICAgICAgICAgIGxhYmVsOiB0aGlzLmxhbmd1YWdlUmVzLm5ld0hlYWRlckxhYmVsXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGJ1dHRvbnM6IFtcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICB0ZXh0OiB0aGlzLmxhbmd1YWdlUmVzLmNhbmNlbCxcclxuICAgICAgICAgICAgICAgICAgICBjbHM6ICdidG4gYnRuLXNlY29uZGFyeScsXHJcbiAgICAgICAgICAgICAgICAgICAgaGFuZGxlOiAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1vZGFsUmVmLmNsb3NlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICB0ZXh0OiB0aGlzLmxhbmd1YWdlUmVzLm9rLFxyXG4gICAgICAgICAgICAgICAgICAgIGNsczogJ2J0biBidG4tcHJpbWFyeScsXHJcbiAgICAgICAgICAgICAgICAgICAgaGFuZGxlOiBva0NhbGxiYWNrXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIF1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgcmV0dXJuIG1vZGFsUmVmO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZ2VuZXJhdGVHcm91cEhlYWRlcklkKCkge1xyXG4gICAgICAgIHJldHVybiBgZ3JvdXBIZWFkZXJfJHtuZXcgRGF0ZSgpLmdldFRpbWUoKX1gO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgY3JlYXRlTmV3R3JvdXBIZWFkZXIocm46IFJvd05vZGUsIHRpdGxlOiBzdHJpbmcsIGNoaWxkID0gZmFsc2UpIHtcclxuICAgICAgICBjb25zdCBnaGlkID0gdGhpcy5nZW5lcmF0ZUdyb3VwSGVhZGVySWQoKTtcclxuICAgICAgICBjb25zdCBkYXRhID0geyBpZDogZ2hpZCwgdGl0bGUsIGdyb3VwSGVhZGVyOiB0cnVlLCBoYWxpZ246ICdsZWZ0JywgZml4ZWQ6ICdVTkZJWEVEJyB9O1xyXG4gICAgICAgIGNvbnN0IGdoID0ge1xyXG4gICAgICAgICAgICBkYXRhLFxyXG4gICAgICAgICAgICBjaGlsZHJlbjogW10sXHJcbiAgICAgICAgICAgIGV4cGFuZGVkOiB0cnVlLFxyXG4gICAgICAgICAgICB2aXNpYmxlOiB0cnVlLFxyXG4gICAgICAgICAgICBpY29uOiB0aGlzLkdST1VQX0hFQURFUl9JQ09OLFxyXG4gICAgICAgIH07XHJcbiAgICAgICAgaWYgKCFjaGlsZCkge1xyXG4gICAgICAgICAgICBpZiAoIXJuLnBhcmVudCkge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgaSA9IHRoaXMudHJlZURhdGEuZmluZEluZGV4KG4gPT4gbi5kYXRhLmlkID09PSBybi5pZCkgKyAxO1xyXG4gICAgICAgICAgICAgICAgdGhpcy50cmVlRGF0YS5zcGxpY2UoaSwgMCwgZ2gpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy50cmVlRGF0YSA9IHRoaXMudHJlZURhdGEuc2xpY2UoKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGdoLmRhdGEuZml4ZWQgPSBybi5wYXJlbnQuZGF0YS5maXhlZDtcclxuICAgICAgICAgICAgICAgIHRoaXMudHQuYXBwZW5kQ2hpbGRyZW4oW2doXSwgcm4ucGFyZW50KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGdoLmRhdGEuZml4ZWQgPSBybi5ub2RlLmRhdGEuZml4ZWQ7XHJcbiAgICAgICAgICAgIHRoaXMudHQuYXBwZW5kQ2hpbGRyZW4oW2doXSwgcm4ubm9kZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8vIOWIoOmZpOWIhue7hFxyXG4gICAgcmVtb3ZlR3JvdXAoZXZlbnQ6IE1vdXNlRXZlbnQsIHJvd05vZGUpIHtcclxuICAgICAgICBpZiAodGhpcy50dC5zZWxlY3RlZFJvdyAmJiByb3dOb2RlLmlkID09PSB0aGlzLnR0LnNlbGVjdGVkUm93LmlkKSB7XHJcbiAgICAgICAgICAgIHRoaXMubm9kZVNlbGVjdGVkLmVtaXQobnVsbCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IGNoaWxkcyA9IHRoaXMudHQuc2VyaWFsaXplZFZhbHVlLmZpbHRlcihuID0+IG4ucGFyZW50cy5pbmRleE9mKHJvd05vZGUuaWQpID4gLTEgJiYgIW4ubm9kZS5kYXRhLmdyb3VwSGVhZGVyKS5tYXAobiA9PiBuLm5vZGUpO1xyXG4gICAgICAgIHRoaXMudHJlZURhdGEgPSB0aGlzLnRyZWVEYXRhLmZpbHRlcihuID0+IG4uZGF0YS5pZCAhPT0gcm93Tm9kZS5pZCk7XHJcblxyXG4gICAgICAgIHRoaXMudHQucmVtb3ZlKHJvd05vZGUuaWQpO1xyXG4gICAgICAgIHRoaXMudHQuYXBwZW5kQ2hpbGRyZW4oY2hpbGRzLCB0aGlzLmdldEhvdVh1YW5Ob2RlKCkubm9kZSk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8g5paw5aKe5YiG57uEXHJcbiAgICBhZGROZXdHcm91cChybjogUm93Tm9kZSwgY2hpbGQgPSBmYWxzZSkge1xyXG4gICAgICAgIGNvbnN0IG1vZGFsUmVmID0gdGhpcy5zaG93TmV3SGVhZGVyRGlhbG9nKCgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgZ2hmUmVmID0gbW9kYWxSZWYuY29udGVudCBhcyBOZXdIZWFkZXJGb3JtQ29tcG9uZW50O1xyXG4gICAgICAgICAgICBpZiAoZ2hmUmVmLnRpdGxlKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoIXJuIHx8IHJuLmlkID09PSB0aGlzLkhPVV9YVUFOX0xJRV9JRCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMudHJlZURhdGEuc3BsaWNlKDAsIDAsIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YToge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IHRoaXMuZ2VuZXJhdGVHcm91cEhlYWRlcklkKCksIGhhbGlnbjogJ2xlZnQnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6IGdoZlJlZi50aXRsZSwgZ3JvdXBIZWFkZXI6IHRydWUsIGZpeGVkOiAnVU5GSVhFRCdcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWNvbjogdGhpcy5HUk9VUF9IRUFERVJfSUNPTixcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2hpbGRyZW46IFtdXHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy50dC51cGRhdGVTZXJpYWxpemVkVmFsdWUoKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jcmVhdGVOZXdHcm91cEhlYWRlcihybiwgZ2hmUmVmLnRpdGxlLCBjaGlsZCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgbW9kYWxSZWYuY2xvc2UoKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRoaXMubm90aXR5U2VyLmluZm8odGhpcy5sYW5ndWFnZVJlcy5yZXF1aXJlZCk7XHJcbiAgICAgICAgICAgICAgICBnaGZSZWYuaW5wdXQubmF0aXZlRWxlbWVudC5mb2N1cygpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICB9LCBjaGlsZD8gdGhpcy5sYW5ndWFnZVJlcy5jb250ZXh0TWVudXMubmV3Q2hpbGQ6IHRoaXMubGFuZ3VhZ2VSZXMuY29udGV4dE1lbnVzLm5ldyk7XHJcblxyXG4gICAgfVxyXG5cclxuICAgIC8vIOaYvuekuuabtOaWsOaMiemSrlxyXG4gICAgb25Nb3JlQnRuQ2xpY2soJGV2ZW50OiBNb3VzZUV2ZW50LCBub2RlRGF0YSkge1xyXG4gICAgICAgIGlmIChub2RlRGF0YSAmJiBub2RlRGF0YS5pZCkge1xyXG4gICAgICAgICAgICB0aGlzLnR0LnNlbGVjdE5vZGUobm9kZURhdGEuaWQpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLnR0LmN0eE1lbnUub25Db250ZXh0TWVudSgkZXZlbnQpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZ2V0Q2FuU2VsZWN0Q29sdW1ucyhyb3dOb2RlOiBSb3dOb2RlKSB7XHJcbiAgICAgICAgLy8g5Y+v5YiG6YWN5YiXXHJcbiAgICAgICAgLy8g5YCZ6YCJ5Yy65pWw5o2uICsg5a2Q6IqC54K5XHJcblxyXG4gICAgICAgIGNvbnN0IGh4bCA9IHRoaXMuZ2V0SG91WHVhbk5vZGUoKTtcclxuICAgICAgICBsZXQgZmllbGRzID0gcm93Tm9kZSA/IHJvd05vZGUubm9kZS5jaGlsZHJlbiA6IFtdO1xyXG4gICAgICAgIGZpZWxkcyA9IGZpZWxkcy5maWx0ZXIoKG46IFRyZWVOb2RlKSA9PiAhbi5kYXRhLmdyb3VwSGVhZGVyKVxyXG4gICAgICAgIHJldHVybiBoeGwubm9kZS5jaGlsZHJlbi5jb25jYXQoZmllbGRzKS5tYXAobiA9PiBuLmRhdGEpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgc2hvd1NldENvbHVtbnNEaWFsb2cob2tDYWxsYmFjaywgc2VsZWN0ZWRJdGVtcywgcm93Tm9kZTogUm93Tm9kZSkge1xyXG4gICAgICAgIGNvbnN0IG1vZGFsUmVmID0gdGhpcy5tb2RhbFNlcnZpY2Uuc2hvdyhTZXRDb2x1bW5zQ29tcG9uZW50LCB7XHJcbiAgICAgICAgICAgIHRpdGxlOiB0aGlzLmxhbmd1YWdlUmVzLmNvbnRleHRNZW51cy5zZXREYXRhRmllbGQsXHJcbiAgICAgICAgICAgIHdpZHRoOiA2MDAsXHJcbiAgICAgICAgICAgIGhlaWdodDogNTAwLFxyXG4gICAgICAgICAgICBzaG93TWF4QnV0dG9uOiBmYWxzZSxcclxuICAgICAgICAgICAgcmVzaXphYmxlOiBmYWxzZSxcclxuICAgICAgICAgICAgaW5pdGlhbFN0YXRlOiB7XHJcbiAgICAgICAgICAgICAgICBkYXRhOiB0aGlzLmdldENhblNlbGVjdENvbHVtbnMocm93Tm9kZSksXHJcbiAgICAgICAgICAgICAgICBjaGVja2VkSXRlbXM6IHNlbGVjdGVkSXRlbXMsXHJcbiAgICAgICAgICAgICAgICBncm91cEVkaXRvclJlZjogdGhpc1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBidXR0b25zOiBbXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGV4dDogdGhpcy5sYW5ndWFnZVJlcy5jYW5jZWwsXHJcbiAgICAgICAgICAgICAgICAgICAgY2xzOiAnYnRuIGJ0bi1zZWNvbmRhcnknLFxyXG4gICAgICAgICAgICAgICAgICAgIGhhbmRsZTogKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBtb2RhbFJlZi5jbG9zZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGV4dDogdGhpcy5sYW5ndWFnZVJlcy5vayxcclxuICAgICAgICAgICAgICAgICAgICBjbHM6ICdidG4gYnRuLXByaW1hcnknLFxyXG4gICAgICAgICAgICAgICAgICAgIGhhbmRsZTogKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBva0NhbGxiYWNrKG1vZGFsUmVmLmNvbnRlbnQuc2VsZWN0ZWRJZHMpXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBdXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHJldHVybiBtb2RhbFJlZjtcclxuICAgIH1cclxuXHJcbiAgICAvKiog5Li65YiG57uE6KGo5aS05YiG6YWN5pWw5o2u5YiXICovXHJcbiAgICBzZXRDb2x1bW5zRm9yR3JvdXBIZWFkZXIoJGV2ZW50LCByb3dOb2RlOiBSb3dOb2RlKSB7XHJcbiAgICAgICAgY29uc3QgY2hpbGRzID0gcm93Tm9kZSA/IHJvd05vZGUubm9kZS5jaGlsZHJlbiA/IHJvd05vZGUubm9kZS5jaGlsZHJlbi5tYXAobiA9PiBuLmRhdGEpIDogW10gOiBbXTtcclxuICAgICAgICBjb25zdCBtb2RhbFJlZiA9IHRoaXMuc2hvd1NldENvbHVtbnNEaWFsb2coKHNlbGVjdGVkSWRzOiBzdHJpbmdbXSkgPT4ge1xyXG4gICAgICAgICAgICAvLyDliIbnu4TkuIvnmoTliJdcclxuICAgICAgICAgICAgY29uc3QgY29scyA9IHNlbGVjdGVkSWRzLm1hcChuID0+IHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmZpZWxkcy5maW5kKGYgPT4gZi5maWVsZCA9PSBuKTtcclxuICAgICAgICAgICAgfSkuZmlsdGVyKG4gPT4gbik7XHJcbiAgICAgICAgICAgIC8vIOWAmemAieWMulxyXG4gICAgICAgICAgICBjb25zdCBoeGwgPSB0aGlzLmdldEhvdVh1YW5Ob2RlKCk7XHJcbiAgICAgICAgICAgIC8vIOa4heeQhuWAmemAieaVsOaNru+8jOWwhuW3suWIhumFjeeahOWIl+WcqOWAmemAieWMuuenu+mZpFxyXG4gICAgICAgICAgICBoeGwubm9kZS5jaGlsZHJlbiA9IChoeGwubm9kZS5jaGlsZHJlbiB8fCBbXSkuZmlsdGVyKG4gPT4gY29scy5maW5kSW5kZXgoYyA9PiBjLmZpZWxkID09IG4uaWQpID09PSAtMSk7XHJcblxyXG4gICAgICAgICAgICAvLyDmn6Xmib7pnIDopoHnp7vpmaTnmoRcclxuICAgICAgICAgICAgY29uc3QgbmVlZFJlbW92ZU5vZGVzID0gKHJvd05vZGUubm9kZS5jaGlsZHJlbiB8fCBbXSkuZmlsdGVyKCAobikgPT4ge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuICFuLmRhdGEuZ3JvdXBIZWFkZXIgJiYgY29scy5maW5kSW5kZXgoKGMpID0+IGMuZmllbGQgPT09IG4uaWQpID09IC0xXHJcbiAgICAgICAgICAgIH0pLmZpbHRlcihuID0+IG4pO1xyXG5cclxuICAgICAgICAgICAgaWYgKG5lZWRSZW1vdmVOb2RlcyAmJiBuZWVkUmVtb3ZlTm9kZXMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICBuZWVkUmVtb3ZlTm9kZXMuZm9yRWFjaChuID0+IHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnR0LnJlbW92ZShuLmlkKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyDmn6Xmib7pnIDopoHmlrDlop7nmoRcclxuICAgICAgICAgICAgY29uc3QgbmVlZEFwcGVuZE5vZGVzID0gY29scy5maWx0ZXIobiA9PiAgKHJvd05vZGUubm9kZS5jaGlsZHJlbiB8fCBbXSkuZmluZEluZGV4KGMgPT4gYy5pZCA9PT0gbi5maWVsZCkgPT09IC0xKS5tYXAobiA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAoIW4uaWQpIHtcclxuICAgICAgICAgICAgICAgICAgICBuLmlkID0gbi5maWVsZDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHJldHVybiBuO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgaWYgKG5lZWRBcHBlbmROb2RlcyAmJiBuZWVkQXBwZW5kTm9kZXMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICBuZWVkQXBwZW5kTm9kZXMuZm9yRWFjaChuID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBjb2wgPSB0aGlzLmZpZWxkcy5maW5kKGYgPT4gZi5maWVsZCA9PSBuLmZpZWxkKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoY29sKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbC5maXhlZCA9ICByb3dOb2RlLm5vZGUuZGF0YS5maXhlZDtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICB0aGlzLnR0LmFwcGVuZENoaWxkcmVuKG5lZWRBcHBlbmROb2Rlcy5tYXAobiA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YTogbixcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2hpbGRyZW46IFtdLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBleHBhbmRlZDogdHJ1ZVxyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICB9KSwgcm93Tm9kZS5ub2RlKTtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgdGhpcy50dC5leHBhbmROb2RlKHJvd05vZGUuaWQpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyDmm7TmlrDlvoXpgInljLpcclxuICAgICAgICAgICAgY29uc3QgaHhsQ29scyA9IG5lZWRSZW1vdmVOb2Rlcy5tYXAobiA9PiB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGRhdGE6IG4uZGF0YSxcclxuICAgICAgICAgICAgICAgICAgICBjaGlsZHJlbjogW11cclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB0aGlzLnR0LmFwcGVuZENoaWxkcmVuKGh4bENvbHMsIGh4bC5ub2RlKTtcclxuXHJcbiAgICAgICAgICAgIG1vZGFsUmVmLmNsb3NlKCk7XHJcbiAgICAgICAgfSwgY2hpbGRzLCByb3dOb2RlKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyDlsIblvoXpgInljLrkuK3nmoTmlbDmja7liJfnm7TmjqXorr7kuLrooajlpLRcclxuICAgIHNldENvbHVtbkhlYWRlcihldmVudDogTW91c2VFdmVudCwgY29sKSB7XHJcbiAgICAgICAgY29uc3QgaSA9IHRoaXMudHJlZURhdGEubGVuZ3RoIC0gMTtcclxuICAgICAgICB0aGlzLnRyZWVEYXRhLnNwbGljZShpLCAwLCB7ICBkYXRhOiBjb2wsIGNoaWxkcmVuOiBbXSB9KTtcclxuXHJcbiAgICAgICAgY29uc3QgaHhsID0gdGhpcy5nZXRIb3VYdWFuTm9kZSgpO1xyXG4gICAgICAgIGlmIChoeGwpIHtcclxuICAgICAgICAgICAgaHhsLm5vZGUuY2hpbGRyZW4gPSBoeGwubm9kZS5jaGlsZHJlbi5maWx0ZXIobiA9PiBuLmRhdGEuaWQgIT09IGNvbC5pZCk7XHJcbiAgICAgICAgICAgIGh4bC5ub2RlLmxlYWYgPSAhKGh4bC5ub2RlLmNoaWxkcmVuICYmIGh4bC5ub2RlLmNoaWxkcmVuLmxlbmd0aCk7XHJcbiAgICAgICAgICAgIGlmIChoeGwubm9kZS5sZWFmKSB7XHJcbiAgICAgICAgICAgICAgICBoeGwubm9kZS5pY29uID0gdGhpcy5HUk9VUF9IRUFERVJfSUNPTjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLnR0LmNsZWFyU2VsZWN0aW9ucygpO1xyXG4gICAgICAgICAgICB0aGlzLnR0LnVwZGF0ZVNlcmlhbGl6ZWRWYWx1ZSgpO1xyXG4gICAgICAgICAgICB0aGlzLnR0LnNlbGVjdE5vZGUoY29sLmlkLCB0cnVlKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICB9XHJcbiAgICBcclxuICAgIG1vdmVVcChldmVudDogTW91c2VFdmVudCwgcm93Tm9kZSkge1xyXG4gICAgICAgIGxldCBkYXRhID0gdGhpcy50cmVlRGF0YTtcclxuICAgICAgICBpZiAocm93Tm9kZS5wYXJlbnQpIHtcclxuICAgICAgICAgICAgZGF0YSA9IHJvd05vZGUucGFyZW50LmNoaWxkcmVuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgaW5kZXggPSBkYXRhLmZpbmRJbmRleChuID0+IG4uZGF0YS5pZCA9PT0gcm93Tm9kZS5pZCk7XHJcbiAgICAgICAgaWYgKGluZGV4ICE9PSAwKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHRlbXBBcnIgPSBkYXRhLnNwbGljZShpbmRleCwgMSk7XHJcbiAgICAgICAgICAgIGRhdGEuc3BsaWNlKGluZGV4IC0gMSwgMCwgLi4udGVtcEFycik7XHJcblxyXG4gICAgICAgICAgICB0aGlzLnR0LnVwZGF0ZVNlcmlhbGl6ZWRWYWx1ZSgpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBtb3ZlRG93bihldmVudDogTW91c2VFdmVudCwgcm93Tm9kZSkge1xyXG4gICAgICAgIGxldCBkYXRhID0gdGhpcy50cmVlRGF0YTtcclxuICAgICAgICBpZiAocm93Tm9kZS5wYXJlbnQpIHtcclxuICAgICAgICAgICAgZGF0YSA9IHJvd05vZGUucGFyZW50LmNoaWxkcmVuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCBpbmRleCA9IGRhdGEuZmluZEluZGV4KG4gPT4gbi5kYXRhLmlkID09PSByb3dOb2RlLmlkKTtcclxuICAgICAgICBjb25zdCBsZW4gPSBkYXRhLmxlbmd0aDtcclxuXHJcbiAgICAgICAgaWYgKGluZGV4ICE9PSBsZW4gLSAyKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHRlbXBBcnIgPSBkYXRhLnNwbGljZShpbmRleCwgMSk7XHJcbiAgICAgICAgICAgIGRhdGEuc3BsaWNlKGluZGV4ICsgMSwgMCwgLi4udGVtcEFycik7XHJcbiAgICAgICAgICAgIHRoaXMudHQudXBkYXRlU2VyaWFsaXplZFZhbHVlKCk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5tb3ZlQm90dG9tKGV2ZW50LCByb3dOb2RlKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgbW92ZVRvcChldmVudDogTW91c2VFdmVudCwgcm93Tm9kZSkge1xyXG4gICAgICAgIGxldCBkYXRhID0gdGhpcy50cmVlRGF0YTtcclxuICAgICAgICBpZiAocm93Tm9kZS5wYXJlbnQpIHtcclxuICAgICAgICAgICAgZGF0YSA9IHJvd05vZGUucGFyZW50LmNoaWxkcmVuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCBpbmRleCA9IGRhdGEuZmluZEluZGV4KG4gPT4gbi5kYXRhLmlkID09PSByb3dOb2RlLmlkKTtcclxuICAgICAgICBkYXRhLnVuc2hpZnQocm93Tm9kZS5ub2RlKTtcclxuICAgICAgICBkYXRhLnNwbGljZShpbmRleCArIDEsIDEpO1xyXG4gICAgICAgIHRoaXMudHQudXBkYXRlU2VyaWFsaXplZFZhbHVlKCk7XHJcbiAgICB9XHJcblxyXG4gICAgbW92ZUJvdHRvbShldmVudDogTW91c2VFdmVudCwgcm93Tm9kZSkge1xyXG4gICAgICAgIGxldCBkYXRhID0gdGhpcy50cmVlRGF0YTtcclxuICAgICAgICBpZiAocm93Tm9kZS5wYXJlbnQpIHtcclxuICAgICAgICAgICAgZGF0YSA9IHJvd05vZGUucGFyZW50LmNoaWxkcmVuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgaW5kZXggPSBkYXRhLmZpbmRJbmRleChuID0+IG4uZGF0YS5pZCA9PT0gcm93Tm9kZS5pZCk7XHJcbiAgICAgICAgZGF0YS5wdXNoKHJvd05vZGUubm9kZSk7XHJcbiAgICAgICAgZGF0YS5zcGxpY2UoaW5kZXgsIDEpO1xyXG5cclxuICAgICAgICBpZiAoIXJvd05vZGUucGFyZW50KSB7XHJcbiAgICAgICAgICAgIHRoaXMubW92ZVVwKGV2ZW50LCByb3dOb2RlKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLnR0LnVwZGF0ZVNlcmlhbGl6ZWRWYWx1ZSgpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvKiog6I635Y+W5aSa6KGo5aS05pWw5o2uICovXHJcbiAgICBnZXRQcmV2aWV3R3JvdXBDb2x1bW5zKCkge1xyXG4gICAgICAgIGNvbnN0IHRyZWVOb2RlcyA9IHRoaXMuZ2V0QWxsTm9kZXMoKTtcclxuICAgICAgICByZXR1cm4gdGhpcy5jb252ZXJ0MkFycmF5KHRyZWVOb2Rlcyk7IFxyXG4gICAgfVxyXG5cclxuICAgICAvKiog6I635Y+W5YCZ6YCJ5YiXICovXHJcbiAgICAgZ2V0SG91WHVhbkZpZWxkcygpIHtcclxuICAgICAgICBjb25zdCBoeGwgPSB0aGlzLnRyZWVEYXRhLmZpbmQobiA9PiBuLmRhdGEuaG91eHVhbnF1Tm9kZSk7XHJcbiAgICAgICAgaWYgKGh4bCkge1xyXG4gICAgICAgICAgICByZXR1cm4gaHhsLmNoaWxkcmVuO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiBbXTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBnZXRBbGxOb2RlcygpIHtcclxuICAgICAgICBjb25zdCBoeGwgPSB0aGlzLmdldEhvdVh1YW5GaWVsZHMoKTtcclxuICAgICAgICByZXR1cm4gdGhpcy50dC5zZXJpYWxpemVkVmFsdWUuZmlsdGVyKG4gPT4ge1xyXG4gICAgICAgICAgICByZXR1cm4gIW4ubm9kZS5kYXRhLmhvdXh1YW5xdU5vZGUgJiYgaHhsLmZpbmRJbmRleChrID0+IGsuZGF0YS5pZCA9PT0gbi5pZCkgPT09IC0xO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKiDlsIbmoJHoioLngrnmlbDmja7ovazmjaLkuLog5aSa6KGo5aS057uT5p6EICovXHJcbiAgICBjb252ZXJ0MkFycmF5KHJvd05vZGVzOiBSb3dOb2RlW10pIHtcclxuICAgICAgICBjb25zdCByID0gW107XHJcbiAgICAgICAgY29uc3QgbWF4QnkgPSAoYXJyLCBmbikgPT4gTWF0aC5tYXgoLi4uYXJyLm1hcCh0eXBlb2YgZm4gPT09ICdmdW5jdGlvbicgPyBmbiA6IHZhbCA9PiB2YWxbZm5dKSk7XHJcbiAgICAgICAgY29uc3QgbWF4bGV2ZWwgPSBtYXhCeShyb3dOb2RlcywgKG4pID0+IG4ubGV2ZWwpIDtcclxuICAgICAgICAvLyDmjpLpmaTmsqHmnInmlbDmja7lrZfmrrXnmoTooajlpLRcclxuICAgICAgICByb3dOb2RlcyA9IHJvd05vZGVzLmZpbHRlcihuID0+IChuLm5vZGUuY2hpbGRyZW4mJiBuLm5vZGUuY2hpbGRyZW4ubGVuZ3RoICYmIG4ubm9kZS5kYXRhLmdyb3VwSGVhZGVyKSB8fCAhbi5ub2RlLmRhdGEuZ3JvdXBIZWFkZXIpO1xyXG5cclxuICAgICAgICAvKipcclxuICAgICAgICAgKiAx44CB5Y+q5pyJ5LiA57uE6KGo5aS077yM5LiU5Zu65a6a5Zyo5bem5L6n5oiW5Y+z5L6n5pe277yM5oyJ5peg5Zu65a6a5YiX5pa55byP5aSE55CGXHJcbiAgICAgICAgICogMuOAgeWPquacieW3puS+p+OAgeWPs+S+p+WbuuWumuWIl+iAjOayoeacieWFtuS7luato+W4uOWIl+aXtu+8jOWPlua2iOWPs+S+p+WbuuWumuWIl1xyXG4gICAgICAgICAqIDPjgIHlj6rmnInlt6bkvqfmiJblj7Pkvqflm7rlrprml7bvvIzmjInml6Dlm7rlrprliJflpITnkIZcclxuICAgICAgICAgKi9cclxuICAgICAgICBjb25zdCBwYXJlbnRzID0gcm93Tm9kZXMuZmlsdGVyKGUgPT4gIWUucGFyZW50KTtcclxuICAgICAgICBpZiAoIXBhcmVudHMuZmlsdGVyKG4gPT4gIW4ubm9kZS5kYXRhLmZpeGVkIHx8IG4ubm9kZS5kYXRhLmZpeGVkID09PSAnVU5GSVhFRCcpLmxlbmd0aCkge1xyXG4gICAgICAgICAgICBjb25zdCBsZWZ0Q29scyA9IHBhcmVudHMuZmlsdGVyKG4gPT4gbi5ub2RlLmRhdGEuZml4ZWQgPT09ICdsZWZ0Jyk7XHJcbiAgICAgICAgICAgIGNvbnN0IHJpZ2h0Q29scyA9IHBhcmVudHMuZmlsdGVyKG4gPT4gbi5ub2RlLmRhdGEuZml4ZWQgPT09ICdyaWdodCcpO1xyXG4gICAgICAgICAgICBpZiAobGVmdENvbHMubGVuZ3RoID09IHBhcmVudHMubGVuZ3RoIHx8IHJpZ2h0Q29scy5sZW5ndGggPT0gcGFyZW50cy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgIHJvd05vZGVzLmZvckVhY2gobiA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHBhcmVudHMuZmluZChwID0+IHAuaWQgPT09IG4uaWQpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG4ubm9kZS5kYXRhLmZpeGVkID0gJydcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGlmIChyaWdodENvbHMubGVuZ3RoID09PSAxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbGVmdENvbHMuZm9yRWFjaCh0ID0+e1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByb3dOb2Rlcy5mb3JFYWNoKG4gPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHQuaWQgPT09IG4uaWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuLm5vZGUuZGF0YS5maXhlZCA9ICcnXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICByaWdodENvbHMuZm9yRWFjaCh0ID0+e1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByb3dOb2Rlcy5mb3JFYWNoKG4gPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHQuaWQgPT09IG4uaWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuLm5vZGUuZGF0YS5maXhlZCA9ICcnXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPD0gbWF4bGV2ZWw7IGkrKyApIHtcclxuICAgICAgICAgICAgci5wdXNoKHJvd05vZGVzLmZpbHRlcihuID0+IG4ubGV2ZWwgPT09IGkpLm1hcChuID0+IHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGRhdGEgPSBuLm5vZGUuZGF0YTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IF9maXhlZCA9IG4ucGFyZW50ID8gdGhpcy50dC5nZXRSb290KG4uaWQpLm5vZGUuZGF0YS5maXhlZCA6ICAoZGF0YS5maXhlZCB8fCAnJyk7XHJcblxyXG5cclxuICAgICAgICAgICAgICAgIGNvbnN0IF9jb2xzcGFuID0gKG4ubm9kZS5jaGlsZHJlbiA/IHJvd05vZGVzLmZpbHRlcihrID0+IGsucGFyZW50cy5pbmRleE9mKG4uaWQpID4gLTEgJiYgay5pZC5pbmRleE9mKCdncm91cEhlYWRlcl8nKSA9PSAtMSkubGVuZ3RoIDogMSkgfHwgMTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IF9yb3dzcGFuID0gKG4ubm9kZS5jaGlsZHJlbiAmJiBuLm5vZGUuY2hpbGRyZW4ubGVuZ3RoID4gMCkgPyAxIDogKG1heGxldmVsIC0gbi5sZXZlbCArIDEpO1xyXG5cclxuICAgICAgICAgICAgICAgIGNvbnN0IG5ld0NvbDogYW55ID0ge1xyXG4gICAgICAgICAgICAgICAgICAgIGZpZWxkOiBkYXRhLmZpZWxkLFxyXG4gICAgICAgICAgICAgICAgICAgIHRpdGxlOiBkYXRhLnRpdGxlLFxyXG4gICAgICAgICAgICAgICAgICAgIHNvcnRhYmxlOiBkYXRhLnNvcnRhYmxlLFxyXG4gICAgICAgICAgICAgICAgICAgIG9yZGVyOiBkYXRhLm9yZGVyLFxyXG4gICAgICAgICAgICAgICAgICAgIGhhbGlnbjogZGF0YS5oYWxpZ24gfHwgJ2xlZnQnLFxyXG4gICAgICAgICAgICAgICAgICAgIGFsaWduOiBkYXRhLmFsaWduIHx8ICdsZWZ0JyxcclxuICAgICAgICAgICAgICAgICAgICB2aXNpYmxlOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgIGFsbG93R3JvdXBpbmc6IGRhdGEuYWxsb3dHcm91cGluZyxcclxuICAgICAgICAgICAgICAgICAgICBncm91cEZvb3RlcjogZGF0YS5ncm91cEZvb3RlcixcclxuICAgICAgICAgICAgICAgICAgICBmb290ZXI6IGRhdGEuZm9vdGVyLFxyXG4gICAgICAgICAgICAgICAgICAgIHdpZHRoOiAoZGF0YS5zaXplID8gZGF0YS5zaXplLndpZHRoIDogMTAwKSxcclxuICAgICAgICAgICAgICAgICAgICBkYXRhVHlwZTogZGF0YS5kYXRhVHlwZSB8fCAnc3RyaW5nJyxcclxuICAgICAgICAgICAgICAgICAgICBmaXhlZDogX2ZpeGVkID09PSAnVU5GSVhFRCc/ICcnOiBfZml4ZWQsXHJcbiAgICAgICAgICAgICAgICAgICAgaWQ6IG4uaWQsXHJcbiAgICAgICAgICAgICAgICAgICAgcGFyZW50SWQ6IG4ubm9kZS5wYXJlbnQgPyBuLm5vZGUucGFyZW50LmlkIDogbnVsbCxcclxuICAgICAgICAgICAgICAgICAgICByb3dzcGFuOiBfcm93c3BhbixcclxuICAgICAgICAgICAgICAgICAgICBjb2xzcGFuOiBfY29sc3BhblxyXG4gICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICBjb25zdCBuZXdDb2wyOiBhbnkgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZmllbGQ6IGRhdGEuZmllbGQsXHJcbiAgICAgICAgICAgICAgICAgICAgdGl0bGU6IGRhdGEudGl0bGUsXHJcbiAgICAgICAgICAgICAgICAgICAgaGFsaWduOiBkYXRhLmhhbGlnbiB8fCAnbGVmdCcsXHJcbiAgICAgICAgICAgICAgICAgICAgYWxpZ246IGRhdGEuYWxpZ24gfHwgJ2xlZnQnLFxyXG4gICAgICAgICAgICAgICAgICAgIHZpc2libGU6IHRydWUsXHJcbiAgICAgICAgICAgICAgICAgICAgZ3JvdXBGb290ZXI6IHt9LFxyXG4gICAgICAgICAgICAgICAgICAgIGZvb3Rlcjoge30sXHJcbiAgICAgICAgICAgICAgICAgICAgd2lkdGg6IChkYXRhLnNpemUgPyBkYXRhLnNpemUud2lkdGggOiAxMDApLFxyXG4gICAgICAgICAgICAgICAgICAgIGRhdGFUeXBlOiBkYXRhLmRhdGFUeXBlIHx8ICdzdHJpbmcnLFxyXG4gICAgICAgICAgICAgICAgICAgIGZpeGVkOiBfZml4ZWQgPT09ICdVTkZJWEVEJz8gJyc6IF9maXhlZCxcclxuICAgICAgICAgICAgICAgICAgICBpZDogbi5pZCxcclxuICAgICAgICAgICAgICAgICAgICBwYXJlbnRJZDogbi5ub2RlLnBhcmVudCA/IG4ubm9kZS5wYXJlbnQuaWQgOiBudWxsLFxyXG4gICAgICAgICAgICAgICAgICAgIHJvd3NwYW46IF9yb3dzcGFuLFxyXG4gICAgICAgICAgICAgICAgICAgIGNvbHNwYW46IF9jb2xzcGFuXHJcbiAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgIHJldHVybiBuLm5vZGUuZGF0YS5ncm91cEhlYWRlciA/ICBuZXdDb2wyOiBuZXdDb2w7XHJcbiAgICAgICAgICAgIH0pKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiByO1xyXG4gICAgfVxyXG5cclxuICAgIG9uQmVmb3JlU2hvd0NvbnRleHRNZW51ID0gKHQpID0+IHtcclxuICAgICAgICBpZiAodCAmJiB0LmRhdGEucGFyZW50cy5pbmRleE9mKHRoaXMuSE9VX1hVQU5fTElFX0lEKSA+IC0xKSB7XHJcbiAgICAgICAgICAgIC8vIOW+hemAieWMuuS4reeahOaVsOaNruWIl+emgeeUqOWPs+mUruiPnOWNlVxyXG4gICAgICAgICAgICByZXR1cm4gb2Yoe3Nob3c6IGZhbHNlfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBvZih7c2hvdzogdHJ1ZX0pO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICBwcml2YXRlIGNsZWFyVHJlZU5vZGVzRGF0YShub2RlczogVHJlZU5vZGVbXSkge1xyXG4gICAgICAgIG5vZGVzLmZvckVhY2goKG46IGFueSkgPT57XHJcbiAgICAgICAgICAgIGRlbGV0ZSBuLnBhcmVudDtcclxuICAgICAgICAgICAgZGVsZXRlIG4uZWxlbWVudFJlZjtcclxuICAgICAgICAgICAgaWYgKG4uY2hpbGRyZW4gJiYgbi5jaGlsZHJlbi5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuY2xlYXJUcmVlTm9kZXNEYXRhKG4uY2hpbGRyZW4pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSlcclxuICAgIH1cclxuXHJcbiAgICBnZXRTZXR0aW5ncygpIHtcclxuICAgICAgICB0aGlzLmNsZWFyVHJlZU5vZGVzRGF0YSh0aGlzLnRyZWVEYXRhKTtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICB2aWV3Q29sczogdGhpcy5nZXRQcmV2aWV3R3JvdXBDb2x1bW5zKCksXHJcbiAgICAgICAgICAgIHRyZWVEYXRhOiB0aGlzLnRyZWVEYXRhXHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICBoaWRkZW5Db2woJGV2ZW50OiBNb3VzZUV2ZW50LCBpZCkge1xyXG4gICAgICAgICRldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcclxuICAgICAgICBcclxuICAgICAgICBpZiAodGhpcy50dC5zZWxlY3RlZFJvdyAmJiBpZCA9PT0gdGhpcy50dC5zZWxlY3RlZFJvdy5pZCkge1xyXG4gICAgICAgICAgICB0aGlzLnR0LmNsZWFyU2VsZWN0aW9ucygpO1xyXG4gICAgICAgICAgICB0aGlzLm5vZGVTZWxlY3RlZC5lbWl0KG51bGwpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy50dC5yZW1vdmUoaWQpO1xyXG5cclxuICAgIH1cclxuXHJcbiAgICByZXNldEhlYWRlck5hbWUoJGV2ZW50OiBNb3VzZUV2ZW50LCByb3dOb2RlOiBSb3dOb2RlKSB7XHJcbiAgICAgICAgY29uc3QgbW9kYWxSZWYgPSB0aGlzLnNob3dOZXdIZWFkZXJEaWFsb2coKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBnaGZSZWYgPSBtb2RhbFJlZi5jb250ZW50IGFzIE5ld0hlYWRlckZvcm1Db21wb25lbnQ7XHJcbiAgICAgICAgICAgIGlmIChnaGZSZWYudGl0bGUpIHtcclxuICAgICAgICAgICAgICAgIHJvd05vZGUubm9kZS5kYXRhLnRpdGxlID0gZ2hmUmVmLnRpdGxlO1xyXG4gICAgICAgICAgICAgICAgbW9kYWxSZWYuY2xvc2UoKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRoaXMubm90aXR5U2VyLmluZm8odGhpcy5sYW5ndWFnZVJlcy5yZXF1aXJlZCk7XHJcbiAgICAgICAgICAgICAgICBnaGZSZWYuaW5wdXQubmF0aXZlRWxlbWVudC5mb2N1cygpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICB9LCB0aGlzLmxhbmd1YWdlUmVzLmNvbnRleHRNZW51cy5yZW5hbWUpO1xyXG5cclxuICAgICAgIGNvbnN0IGdoZlJlZiA9IG1vZGFsUmVmLmNvbnRlbnQgYXMgTmV3SGVhZGVyRm9ybUNvbXBvbmVudDtcclxuICAgICAgIGdoZlJlZi50aXRsZSA9IHJvd05vZGUubm9kZS5kYXRhLnRpdGxlO1xyXG4gICAgfVxyXG4gICAgXHJcbn0iXX0=
/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { map, switchMap } from 'rxjs/operators';
import { forkJoin, of, timer } from 'rxjs';
import { Injectable, Injector, InjectionToken, ComponentFactoryResolver, ApplicationRef } from '@angular/core';
import { BsModalService } from '@farris/ui-modal';
import { MessagerService } from '@farris/ui-messager';
import { DatagridSettingsComponent } from './datagrid-settings.component';
import { cloneDeep } from 'lodash-es';
import { LocaleService } from '@farris/ui-locale';
import { CommonUtils, DebugService, IdService } from '@farris/ui-common';
import { SimpleColumnsComponent } from './simple-mode/simple-columns.component';
import { DatagridSchemeService } from './datagrid-scheme.service';
import { NewSchemeComponent } from './scheme/newscheme.component';
import { SchemeListComponent } from './scheme/scheme-list.component';
import { NotifyService } from '@farris/ui-notify';
import { DATAGRID_SETTINGS_LOCALEDATA } from './datagrid-settings-locale';
import { cleanGroupFields, cleanSortFields, getDataFieldsForMultiHeaders, mergetColumnOptions, refreshGridColumns } from './mutli-headers.helper';
/** @type {?} */
export var GRID_SETTINGS_WEBAPI = new InjectionToken(' Farris DataGrid User Setting WebApi URI.');
var DatagridSettingsService = /** @class */ (function () {
    function DatagridSettingsService(injector, modalSer, messager, idService, localeSer) {
        this.injector = injector;
        this.modalSer = modalSer;
        this.messager = messager;
        this.idService = idService;
        this.localeSer = localeSer;
        this.multiSortMsg = '列表中未开启多列排序的功能。 请检查！';
        this.columnsSortableMsg = '未开启列的排序功能。请检查！';
        this.notShowDialog = '多表头暂不支持列显示设置；同时未启用列排序功能。';
        this._httpRestService = null;
        this.languages = [];
        this.gridRefs = null;
        this.activeSchemeItem = null;
        this.saving = false;
        this.cfr = null;
        this.app = null;
        this.schemeListSubscription = null;
        this.currentSchemeitem = null;
        this.prevSchemeItem = null;
        this.debugSer = null;
        this.cfr = this.injector.get(ComponentFactoryResolver);
        this.app = this.injector.get(ApplicationRef);
        this.notifyService = this.injector.get(NotifyService, null);
        this.debugSer = this.injector.get(DebugService, null);
        this.commonUtils = this.injector.get(CommonUtils, new CommonUtils());
        this.schemeService = new DatagridSchemeService(this.injector);
        this.localeSer.setLocaleData(DATAGRID_SETTINGS_LOCALEDATA);
    }
    Object.defineProperty(DatagridSettingsService.prototype, "httpRestService", {
        get: /**
         * @return {?}
         */
        function () {
            return this._httpRestService;
        },
        set: /**
         * @param {?} httpSer
         * @return {?}
         */
        function (httpSer) {
            this._httpRestService = httpSer;
            if (this.schemeService) {
                this.schemeService.setRestService(httpSer);
            }
        },
        enumerable: true,
        configurable: true
    });
    ;
    /**
     * @param {?} perfixStr
     * @return {?}
     */
    DatagridSettingsService.prototype.setUriPerfixStr = /**
     * @param {?} perfixStr
     * @return {?}
     */
    function (perfixStr) {
        if (perfixStr == '') {
            if (window['gspframeworkService'] && window['gspframeworkService'].common) {
                /** @type {?} */
                var basePath = window['gspframeworkService'].common.getBasePath;
                if (basePath && basePath.get) {
                    perfixStr = basePath.get();
                }
            }
        }
        if (perfixStr != '' && perfixStr !== null) {
            this.schemeService.setUriPerfix(perfixStr);
        }
    };
    /**
     * @param {?=} id
     * @return {?}
     */
    DatagridSettingsService.prototype.destroy = /**
     * @param {?=} id
     * @return {?}
     */
    function (id) {
        if (this.gridRefs) {
            if (id && this.gridRefs[id]) {
                this.gridRefs[id] = null;
                delete this.gridRefs[id];
            }
            else {
                if (!Object.keys(this.gridRefs).length) {
                    this.gridRefs = null;
                }
            }
        }
        this.saving = false;
        this.setActiveSchemeItem(id, null);
        this.schemeService.destory(id);
    };
    /**
     * @private
     * @param {?} msg
     * @param {?=} type
     * @return {?}
     */
    DatagridSettingsService.prototype.writeDebugMsg = /**
     * @private
     * @param {?} msg
     * @param {?=} type
     * @return {?}
     */
    function (msg, type) {
        if (type === void 0) { type = 'warn'; }
        if (this.debugSer) {
            if (this.debugSer[type]) {
                this.debugSer[type](msg);
            }
            else {
                console[type](msg);
            }
        }
    };
    /**
     * @param {?} dg
     * @return {?}
     */
    DatagridSettingsService.prototype.registerGridInstance = /**
     * @param {?} dg
     * @return {?}
     */
    function (dg) {
        if (!dg) {
            this.writeDebugMsg('DatagridSettingService: grid instance is null.');
            return;
        }
        /** @type {?} */
        var id = dg.id;
        this.gridRefs = this.gridRefs || {};
        if (!this.gridRefs[id]) {
            this.gridRefs[id] = dg;
        }
    };
    /**
     * @param {?} dgID
     * @return {?}
     */
    DatagridSettingsService.prototype.getGridInstance = /**
     * @param {?} dgID
     * @return {?}
     */
    function (dgID) {
        return this.gridRefs ? this.gridRefs[dgID] : null;
    };
    /** 更新方案中的配置数据 */
    /**
     * 更新方案中的配置数据
     * @private
     * @param {?} schemeItem
     * @param {?} settings
     * @return {?}
     */
    DatagridSettingsService.prototype.updateSchemeSettings = /**
     * 更新方案中的配置数据
     * @private
     * @param {?} schemeItem
     * @param {?} settings
     * @return {?}
     */
    function (schemeItem, settings) {
        if (schemeItem && settings) {
            /** @type {?} */
            var schemeContentObj = schemeItem.queryConditionString ? JSON.parse(schemeItem.queryConditionString) : {};
            if (schemeContentObj) {
                if (schemeContentObj[this.localeSer.localeId]) {
                    /** @type {?} */
                    var schemeSettings = schemeContentObj[this.localeSer.localeId] || {};
                    schemeContentObj[this.localeSer.localeId] = Object.assign(schemeSettings, settings);
                }
                else {
                    schemeContentObj[this.localeSer.localeId] = settings;
                }
                schemeItem.queryConditionString = JSON.stringify(schemeContentObj);
            }
        }
    };
    /** 更新当前方案配置数据 */
    /**
     * 更新当前方案配置数据
     * @param {?} dgId
     * @param {?} settings
     * @return {?}
     */
    DatagridSettingsService.prototype.updateActiveSchemeItemSettings = /**
     * 更新当前方案配置数据
     * @param {?} dgId
     * @param {?} settings
     * @return {?}
     */
    function (dgId, settings) {
        /** @type {?} */
        var schemeItem = this.getActiveSchemeItem(dgId);
        this.updateSchemeSettings(schemeItem, settings);
        if (schemeItem) {
            this.schemeService.updateSchemeData(dgId, schemeItem);
        }
    };
    /** 设置活动的方案 */
    /**
     * 设置活动的方案
     * @param {?} dgId
     * @param {?} activeItem
     * @return {?}
     */
    DatagridSettingsService.prototype.setActiveSchemeItem = /**
     * 设置活动的方案
     * @param {?} dgId
     * @param {?} activeItem
     * @return {?}
     */
    function (dgId, activeItem) {
        /** @type {?} */
        var schemekey = this.schemeService.getSchemeKey(dgId);
        this.activeSchemeItem = this.activeSchemeItem || {};
        if (activeItem) {
            this.activeSchemeItem[schemekey] = cloneDeep(activeItem);
        }
        else {
            delete this.activeSchemeItem[schemekey];
        }
    };
    /** 获取当前活动的方案 */
    /**
     * 获取当前活动的方案
     * @param {?} dgId
     * @return {?}
     */
    DatagridSettingsService.prototype.getActiveSchemeItem = /**
     * 获取当前活动的方案
     * @param {?} dgId
     * @return {?}
     */
    function (dgId) {
        /** @type {?} */
        var schemekey = this.schemeService.getSchemeKey(dgId);
        return this.activeSchemeItem ? this.activeSchemeItem[schemekey] : null;
    };
    /**
     * @return {?}
     */
    DatagridSettingsService.prototype.getSearchTypes = /**
     * @return {?}
     */
    function () {
        return [
            { value: 'all', title: this.localeSer.getValue('datagrid.settings.allColumns') },
            { value: 'visible', title: this.localeSer.getValue('datagrid.settings.visibleColumns') },
            { value: 'hidden', title: this.localeSer.getValue('datagrid.settings.hiddenColumns') }
        ];
    };
    /**
     * @param {?} gridInstance
     * @param {?=} settings
     * @param {?=} selectedSchemeItem
     * @return {?}
     */
    DatagridSettingsService.prototype.showSimple = /**
     * @param {?} gridInstance
     * @param {?=} settings
     * @param {?=} selectedSchemeItem
     * @return {?}
     */
    function (gridInstance, settings, selectedSchemeItem) {
        var _this = this;
        /** @type {?} */
        var _columns = this.getCurrentConfigs().columns || gridInstance.columns;
        /** @type {?} */
        var columns = this.convertColumnsToSimple(_columns);
        columns[0] = tslib_1.__spread(columns[0].filter((/**
         * @param {?} n
         * @return {?}
         */
        function (n) { return n.field && n.field !== gridInstance.ControlPanelFeild; })));
        /** @type {?} */
        var searchTypes = this.getSearchTypes();
        if (this.cfr) {
            /** @type {?} */
            var cmpFactory = this.cfr.resolveComponentFactory(SimpleColumnsComponent);
            /** @type {?} */
            var simpleRef_1 = cmpFactory.create(this.injector);
            this.app.attachView(simpleRef_1.hostView);
            simpleRef_1.instance.columns = columns;
            simpleRef_1.instance.seartTypes = searchTypes;
            simpleRef_1.instance.gridInstance = gridInstance;
            simpleRef_1.instance.schemeSer = this.schemeService;
            if (document.querySelector('#page-wrapper')) {
                simpleRef_1.instance.top = 76;
            }
            simpleRef_1.instance.enableScheme = gridInstance.enableScheme;
            if (!settings) {
                settings = this.getCurrentConfigs();
            }
            if (gridInstance.enableScheme) {
                /** @type {?} */
                var _currentSchemtItem = this.getActiveSchemeItem(gridInstance.id);
                if (settings) {
                    //  从高级模式 转到 简洁模式时，保存原始值
                    if (!simpleRef_1.instance['prevSchemeItem'] && this.prevSchemeItem) {
                        simpleRef_1.instance['prevSchemeItem'] = cloneDeep(this.prevSchemeItem);
                    }
                    if (selectedSchemeItem) {
                        this.updateSchemeSettings(selectedSchemeItem, settings);
                        simpleRef_1.instance.currentSchemeItem = selectedSchemeItem;
                    }
                    else {
                        if (_currentSchemtItem) {
                            this.currentSchemeitem = _currentSchemtItem;
                            this.prevSchemeItem = cloneDeep(_currentSchemtItem);
                            simpleRef_1.instance.currentSchemeItem = _currentSchemtItem;
                        }
                        else {
                            if (!Object.keys(settings).length) {
                                settings = this.getLocalSettings(this.createConfigKey(gridInstance.id));
                            }
                            simpleRef_1.instance.currentSchemeItem = null;
                            simpleRef_1.instance.settings = settings;
                        }
                    }
                }
                else {
                    this.currentSchemeitem = _currentSchemtItem;
                    this.prevSchemeItem = cloneDeep(_currentSchemtItem);
                    simpleRef_1.instance.currentSchemeItem = _currentSchemtItem;
                }
            }
            else {
                if (gridInstance.enableSetMultiHeaders) {
                    simpleRef_1.instance.settings = this.getCurrentConfigs();
                }
                else {
                    simpleRef_1.instance.settings = settings;
                }
            }
            /** @type {?} */
            var zIndex = this.commonUtils.getFloatingLayerIndex();
            simpleRef_1.location.nativeElement.style.zIndex = '' + zIndex;
            document.body.appendChild(simpleRef_1.location.nativeElement);
            simpleRef_1.instance.canceld.subscribe((/**
             * @return {?}
             */
            function () {
                _this.restoreScheme(gridInstance);
            }));
            simpleRef_1.instance.closed.pipe(switchMap((/**
             * @return {?}
             */
            function () {
                if (simpleRef_1) {
                    simpleRef_1.instance.container.nativeElement.style.right = '-500px';
                    return timer(500);
                }
            }))).subscribe((/**
             * @return {?}
             */
            function () {
                simpleRef_1.location.nativeElement.remove();
                simpleRef_1.destroy();
                simpleRef_1 = null;
                if (_this.schemeListSubscription) {
                    _this.schemeListSubscription.unsubscribe();
                }
                /** @type {?} */
                var _activeSchemtItem = _this.getActiveSchemeItem(gridInstance.id);
                if ((!_this.currentSchemeitem || (_activeSchemtItem && _activeSchemtItem.id !== _this.currentSchemeitem.id)) && (_activeSchemtItem && _activeSchemtItem.queryConditionString)) {
                    /** @type {?} */
                    var _currentSettings_1 = JSON.parse(_activeSchemtItem.queryConditionString)[_this.localeSer.localeId];
                    if (_currentSettings_1) {
                        columns[0].forEach((/**
                         * @param {?} f
                         * @return {?}
                         */
                        function (f) {
                            f.visible = _currentSettings_1.viewColumns.indexOf(f.field) > -1;
                        }));
                    }
                }
            }));
            // 打开高级设置窗口
            simpleRef_1.instance.advanced.subscribe((/**
             * @param {?} __0
             * @return {?}
             */
            function (_a) {
                var viewFields = _a.viewFields, settings = _a.settings, columns = _a.columns;
                // if (viewFields && viewFields.length){
                //     this.updateSchemeSettings(simpleRef.instance.currentSchemeItem, {viewColumns: viewFields});
                // }
                _this.setCurrentConfigs(tslib_1.__assign({}, settings, { columns: columns }));
                _this.prevSchemeItem = simpleRef_1.instance['prevSchemeItem'];
                _this['SCHEME_DEFAULT_TITLE'] = simpleRef_1.instance.defaultSchemeName;
                _this.showAdvanced(gridInstance, null, simpleRef_1.instance.currentSchemeItem);
            }));
            simpleRef_1.instance.submit.subscribe((/**
             * @param {?} e
             * @return {?}
             */
            function (e) {
                _this.applySettings(e, gridInstance);
            }));
            // 多表列设置
            simpleRef_1.instance.submitForGroupHeader.subscribe((/**
             * @param {?} e
             * @return {?}
             */
            function (e) {
                _this.applySettings(e, gridInstance);
            }));
            // simpleRef.instance.fieldsChange.subscribe((visibleFields: string[]) => {
            //     this.updateActiveSchemeItemSettings(gridInstance.id, {viewColumns: visibleFields})
            // });
            // 打开新增方案窗口
            simpleRef_1.instance.addNewScheme.subscribe((/**
             * @param {?} e
             * @return {?}
             */
            function (e) {
                _this.showNewSchemeDialog(gridInstance, e, simpleRef_1.instance.collectSettings(), {
                    ok: (/**
                     * @param {?} t
                     * @return {?}
                     */
                    function (t) {
                        // 更换为新的方案
                        simpleRef_1.instance.onSchemeItemClick(null, t);
                        _this.saveUserConfig;
                    })
                });
            }));
            simpleRef_1.instance.schemeList = this.schemeService.getStateValue(gridInstance.id, 'list') || [];
            // 打开方案管理列表窗口
            simpleRef_1.instance.showSchemeList.subscribe((/**
             * @return {?}
             */
            function () {
                _this.getSchemeList(gridInstance.id).pipe(switchMap((/**
                 * @param {?} t
                 * @return {?}
                 */
                function (t) {
                    return _this.schemeService.checkAuthority().pipe(map((/**
                     * @param {?} auth
                     * @return {?}
                     */
                    function (auth) {
                        return tslib_1.__assign({ list: t }, auth);
                    })));
                }))).subscribe((/**
                 * @param {?} t
                 * @return {?}
                 */
                function (t) {
                    _this.schemeService.setSchemeList(gridInstance.id, t.list || []);
                    _this.showSchemeListDialog(gridInstance, cloneDeep(t.list || []), t, simpleRef_1);
                }));
            }));
            this.schemeListSubscription = this.schemeService.schemeList$.subscribe((/**
             * @param {?} list
             * @return {?}
             */
            function (list) {
                simpleRef_1.instance.schemeList = list;
                if (!list || !list.length) {
                    _this.setActiveSchemeItem(gridInstance.id, null);
                    return;
                }
                /** @type {?} */
                var _activeSchemeItem = _this.getActiveSchemeItem(gridInstance.id);
                if (_activeSchemeItem) {
                    /** @type {?} */
                    var hasActiveItem = list.find((/**
                     * @param {?} n
                     * @return {?}
                     */
                    function (n) { return n.id === _activeSchemeItem.id; }));
                    if (!hasActiveItem) {
                        hasActiveItem = _this.getDefaultScheme(list); // 获取设置为当前方案的项
                        _this.setActiveSchemeItem(gridInstance.id, hasActiveItem || null);
                    }
                    simpleRef_1.instance.currentSchemeItem = hasActiveItem;
                }
            }));
            // 切换方案
            simpleRef_1.instance.schemeChanged.subscribe((/**
             * @param {?} t
             * @return {?}
             */
            function (t) {
                _this.currentSchemeitem = t;
                _this.setActiveSchemeItem(gridInstance.id, cloneDeep(t));
            }));
            simpleRef_1.hostView.detectChanges();
            simpleRef_1.instance.cd.detectChanges();
            simpleRef_1.instance.container.nativeElement.style.right = '0px';
            return simpleRef_1;
        }
    };
    /**
     * @param {?} gridInstance
     * @param {?=} opts
     * @return {?}
     */
    DatagridSettingsService.prototype.show = /**
     * @param {?} gridInstance
     * @param {?=} opts
     * @return {?}
     */
    function (gridInstance, opts) {
        this.registerGridInstance(gridInstance);
        if (gridInstance.enableSimpleMode) {
            this.schemeService.createSchemeTaskID();
            return this.showSimple(gridInstance);
        }
        else {
            return this.showAdvanced(gridInstance, opts);
        }
    };
    /**
     * @private
     * @param {?} gridInstance
     * @return {?}
     */
    DatagridSettingsService.prototype.restoreScheme = /**
     * @private
     * @param {?} gridInstance
     * @return {?}
     */
    function (gridInstance) {
        if (gridInstance.enableScheme) {
            this.setActiveSchemeItem(gridInstance.id, this.prevSchemeItem);
            if (!this.prevSchemeItem) {
                this.setCurrentConfigs(null);
            }
        }
        else {
            this.setCurrentConfigs(null);
        }
    };
    /**
     * @private
     * @param {?} gridInstance
     * @param {?=} opts
     * @param {?=} selectedSchemeItem
     * @return {?}
     */
    DatagridSettingsService.prototype.showAdvanced = /**
     * @private
     * @param {?} gridInstance
     * @param {?=} opts
     * @param {?=} selectedSchemeItem
     * @return {?}
     */
    function (gridInstance, opts, selectedSchemeItem) {
        var _this = this;
        /** @type {?} */
        var _editColSortInfo = true;
        /** @type {?} */
        var editColSortInfo = this.canSetColumnSort(gridInstance);
        if (editColSortInfo !== true) {
            _editColSortInfo = false;
        }
        // 判断是否为多表头
        /** @type {?} */
        var showSetColumnsTab = !gridInstance.isMultiHeader() || (gridInstance.isMultiHeader() && gridInstance.enableSetMultiHeaders);
        /** @type {?} */
        var getActiveTabIndex = (/**
         * @return {?}
         */
        function () {
            if (showSetColumnsTab) {
                return 1;
            }
            else {
                if (_editColSortInfo) {
                    return 2;
                }
                else {
                    return -1;
                }
            }
        });
        /** @type {?} */
        var activeTabIndex = getActiveTabIndex();
        if (activeTabIndex === -1) {
            this.messager.warning(this.notShowDialog);
            return;
        }
        /** @type {?} */
        var columns = this.convertColumnsToSimple(this.getCurrentConfigs().columns || gridInstance.columns);
        // 获取当前方案中当前语言的配置数据
        /** @type {?} */
        var currentSettings = this.getCurrentConfigs();
        /** @type {?} */
        var multiHeaderTree = currentSettings && currentSettings.multiHeaders ? currentSettings.multiHeaders.treeData : null;
        if (selectedSchemeItem && selectedSchemeItem.queryConditionString) {
            /** @type {?} */
            var _currentSettings = JSON.parse(selectedSchemeItem.queryConditionString)[this.localeSer.localeId];
            currentSettings = Object.assign(_currentSettings || {}, currentSettings || {});
            if (currentSettings.columnFormat && currentSettings.columnFormat.length) {
                columns[0] = columns[0].map((/**
                 * @param {?} col
                 * @return {?}
                 */
                function (col) {
                    /** @type {?} */
                    var fcol = currentSettings.columnFormat.find((/**
                     * @param {?} n
                     * @return {?}
                     */
                    function (n) { return n.field === col.field; }));
                    if (fcol) {
                        col = Object.assign(col, fcol);
                    }
                    return col;
                }));
            }
        }
        if (!gridInstance.enableSetMultiHeaders && currentSettings.viewColumns && currentSettings.viewColumns.length) {
            columns[0].forEach((/**
             * @param {?} f
             * @return {?}
             */
            function (f) {
                f.visible = currentSettings.viewColumns.indexOf(f.field) > -1;
            }));
        }
        columns[0] = columns[0].filter((/**
         * @param {?} n
         * @return {?}
         */
        function (n) { return n.field && n.field !== gridInstance.ControlPanelFeild; }));
        /** @type {?} */
        var sortFields = getDataFieldsForMultiHeaders(cloneDeep(columns)).filter((/**
         * @param {?} n
         * @return {?}
         */
        function (n) { return n.field.indexOf('farris-datagrid-column_') == -1 && n.sortable; }));
        if (gridInstance.enableSetMultiHeaders && currentSettings && currentSettings.multiHeaders) {
            sortFields = getDataFieldsForMultiHeaders(currentSettings.multiHeaders.viewCols).filter((/**
             * @param {?} n
             * @return {?}
             */
            function (n) { return n.field.indexOf('farris-datagrid-column_') == -1 && n.sortable; }));
        }
        // const treeData = this.convertColumns2TreeData(cloneDeep(columns), true);
        // const viewColumnsTreeData = this.convertColumns2TreeData(cloneDeep(columns), false);
        // this.checkViewTreeNodes(viewColumnsTreeData);
        /** @type {?} */
        var modalRef = null;
        // const okText = this.localeSer.getValue('datagrid.settings.ok') || '确定';
        // const cancelText = this.localeSer.getValue('datagrid.settings.cancel') || '取消';
        // const resetText =  this.localeSer.getValue('datagrid.settings.reset') || '重置';
        /** @type {?} */
        var defaultOpts = {
            width: 760, height: 560, showHeader: false, title: '控制面板',
            initialState: {
                columns: columns,
                sortTreeData: sortFields,
                // viewTreeData: viewColumnsTreeData,
                gridInstance: gridInstance,
                canSetColumnSort: _editColSortInfo,
                canSetColumnVisible: showSetColumnsTab,
                activeTabIndex: activeTabIndex,
                schemeInfo: currentSettings,
                enableMultipleHeaders: gridInstance.enableSetMultiHeaders,
                multiHeaders: {
                    columns: columns,
                    treeData: multiHeaderTree
                },
                schemeName: selectedSchemeItem ? selectedSchemeItem['_title_'] : this['SCHEME_DEFAULT_TITLE']
            },
            showButtons: false,
            closed: (/**
             * @param {?} isCloseBtn
             * @param {?} opts
             * @return {?}
             */
            function (isCloseBtn, opts) {
                var event = opts.event;
                if (event && event.code === 'Escape') {
                    _this.restoreScheme(gridInstance);
                }
            })
        };
        /** @type {?} */
        var modalOpts = Object.assign(defaultOpts, opts || {});
        modalRef = this.modalSer.show(DatagridSettingsComponent, modalOpts);
        /** @type {?} */
        var instance = (/** @type {?} */ (modalRef.content));
        instance.enableReset = true;
        instance.modalRef = modalRef;
        instance.canSetColumnSort = _editColSortInfo;
        instance.canSetColumnVisible = showSetColumnsTab;
        instance.submitHandle.subscribe((/**
         * @param {?} e
         * @return {?}
         */
        function (e) {
            _this.applySettings(e, gridInstance, { modalRef: modalRef, currentScheme: selectedSchemeItem });
        }));
        instance.cancelHandle.subscribe((/**
         * @param {?} e
         * @return {?}
         */
        function (e) {
            modalRef.close();
            _this.restoreScheme(gridInstance);
        }));
        // 切换到侧边栏简洁模式
        instance.concise.subscribe((/**
         * @param {?} e
         * @return {?}
         */
        function (e) {
            modalRef.close();
            /** @type {?} */
            var settings = modalRef.content;
            var sortInfo = settings.sortInfo, viewColumns = settings.viewColumns, columnFormat = settings.columnFormat, groupField = settings.groupField, multiHeaders = settings.multiHeaders;
            _this.setCurrentConfigs({ sortInfo: sortInfo, viewColumns: viewColumns, columnFormat: columnFormat, groupField: groupField, multiHeaders: multiHeaders });
            _this.showSimple(gridInstance, { sortInfo: sortInfo, viewColumns: viewColumns, columnFormat: columnFormat, groupField: groupField, multiHeaders: multiHeaders }, cloneDeep(selectedSchemeItem));
        }));
        /** @type {?} */
        var modalContainer = (/** @type {?} */ (modalRef.dialog.instance));
        modalContainer.draggbar.handle = instance.header.nativeElement;
        return modalRef;
    };
    /**
     * @private
     * @param {?} gridInstance
     * @return {?}
     */
    DatagridSettingsService.prototype.canSetColumnSort = /**
     * @private
     * @param {?} gridInstance
     * @return {?}
     */
    function (gridInstance) {
        if (gridInstance.multiSort && this.hasEnableSortColumns(gridInstance)) {
            return true;
        }
        else {
            if (!this.hasEnableSortColumns(gridInstance)) {
                return this.columnsSortableMsg;
            }
            else if (!gridInstance.multiSort) {
                return this.multiSortMsg;
            }
        }
    };
    /**
     * @private
     * @param {?} gridInstance
     * @return {?}
     */
    DatagridSettingsService.prototype.hasEnableSortColumns = /**
     * @private
     * @param {?} gridInstance
     * @return {?}
     */
    function (gridInstance) {
        /** @type {?} */
        var sortColumnsCount = gridInstance.flatColumns.reduce((/**
         * @param {?} c
         * @param {?} r
         * @return {?}
         */
        function (c, r) {
            if (r.sortable) {
                return c + 1;
            }
            return c;
        }), 0);
        return sortColumnsCount > 0;
    };
    // private getChilds(cols, rowIndex, colStartIndex, colCount, forSort = false) {
    //     const childCols = [];
    //     let _count = colStartIndex;
    //     if (!cols[rowIndex]) {
    //         return  [];
    //     }
    //     cols[rowIndex].slice().forEach(element => {
    //         _count = _count + element.colspan;
    //         if ( _count <= colCount ) {
    //             childCols.push(element);
    //         }
    //     });
    //     cols[rowIndex].splice(0, childCols.length);
    //     return childCols.map((c, i) => {
    //         let n: any = {
    //             data: c,
    //             selectable: forSort ? !!c.sortable : true
    //         };
    //         if (c.colspan && c.colspan > 1) {
    //             n = {
    //                 data: c,
    //                 selectable: false,
    //                 expanded: true,
    //                 children: this.getChilds(cols, rowIndex + 1, 0 , c.colspan)
    //             };
    //         }
    //         return n;
    //     });
    // }
    // convertColumns2TreeData(cols: DataColumn[][], forSort = false) {
    //     const columns = cols.map((c: any) => {
    //         const aa = c.map((_) => {
    //             if (_.field.indexOf('farris-datagrid-column_') == -1) {
    //                 _.colspan = _.colspan || 1;
    //                 return _;
    //             }
    //             return null;
    //         });
    //         return aa.filter(n => n);
    //     });
    //     if (columns.length === 1) {
    //         return columns[0].map(c => {
    //             return {
    //                 data: c,
    //                 selectable: forSort ? !!c.sortable : true
    //             };
    //         });
    //     } else {
    //         return columns[0].map((c, i) => {
    //             if (c.colspan && c.colspan > 1) {
    //                 return {
    //                     data: c,
    //                     selectable: false,
    //                     expanded: true,
    //                     children: this.getChilds(columns, 1, 0, c.colspan, forSort)
    //                 };
    //             } else {
    //                 return {
    //                     data: c,
    //                     selectable: forSort ? !!c.sortable : true
    //                 };
    //             }
    //         });
    //     }
    // }
    // private checkViewTreeNodes(treeNodes: TreeNode[]) {
    //     treeNodes.forEach((tn: TreeNode) => {
    //         if (!tn.children || !tn.children.length) {
    //             tn.selectable = true;
    //         } else {
    //             tn.selectable = false;
    //             this.checkViewTreeNodes(tn.children);
    //         }
    //     });
    // }
    // private getChilds(cols, rowIndex, colStartIndex, colCount, forSort = false) {
    //     const childCols = [];
    //     let _count = colStartIndex;
    //     if (!cols[rowIndex]) {
    //         return  [];
    //     }
    //     cols[rowIndex].slice().forEach(element => {
    //         _count = _count + element.colspan;
    //         if ( _count <= colCount ) {
    //             childCols.push(element);
    //         }
    //     });
    //     cols[rowIndex].splice(0, childCols.length);
    //     return childCols.map((c, i) => {
    //         let n: any = {
    //             data: c,
    //             selectable: forSort ? !!c.sortable : true
    //         };
    //         if (c.colspan && c.colspan > 1) {
    //             n = {
    //                 data: c,
    //                 selectable: false,
    //                 expanded: true,
    //                 children: this.getChilds(cols, rowIndex + 1, 0 , c.colspan)
    //             };
    //         }
    //         return n;
    //     });
    // }
    // convertColumns2TreeData(cols: DataColumn[][], forSort = false) {
    //     const columns = cols.map((c: any) => {
    //         const aa = c.map((_) => {
    //             if (_.field.indexOf('farris-datagrid-column_') == -1) {
    //                 _.colspan = _.colspan || 1;
    //                 return _;
    //             }
    //             return null;
    //         });
    //         return aa.filter(n => n);
    //     });
    //     if (columns.length === 1) {
    //         return columns[0].map(c => {
    //             return {
    //                 data: c,
    //                 selectable: forSort ? !!c.sortable : true
    //             };
    //         });
    //     } else {
    //         return columns[0].map((c, i) => {
    //             if (c.colspan && c.colspan > 1) {
    //                 return {
    //                     data: c,
    //                     selectable: false,
    //                     expanded: true,
    //                     children: this.getChilds(columns, 1, 0, c.colspan, forSort)
    //                 };
    //             } else {
    //                 return {
    //                     data: c,
    //                     selectable: forSort ? !!c.sortable : true
    //                 };
    //             }
    //         });
    //     }
    // }
    // private checkViewTreeNodes(treeNodes: TreeNode[]) {
    //     treeNodes.forEach((tn: TreeNode) => {
    //         if (!tn.children || !tn.children.length) {
    //             tn.selectable = true;
    //         } else {
    //             tn.selectable = false;
    //             this.checkViewTreeNodes(tn.children);
    //         }
    //     });
    // }
    /**
     * @private
     * @param {?} gridInstance
     * @return {?}
     */
    DatagridSettingsService.prototype._convertColumnsToSimple = 
    // private getChilds(cols, rowIndex, colStartIndex, colCount, forSort = false) {
    //     const childCols = [];
    //     let _count = colStartIndex;
    //     if (!cols[rowIndex]) {
    //         return  [];
    //     }
    //     cols[rowIndex].slice().forEach(element => {
    //         _count = _count + element.colspan;
    //         if ( _count <= colCount ) {
    //             childCols.push(element);
    //         }
    //     });
    //     cols[rowIndex].splice(0, childCols.length);
    //     return childCols.map((c, i) => {
    //         let n: any = {
    //             data: c,
    //             selectable: forSort ? !!c.sortable : true
    //         };
    //         if (c.colspan && c.colspan > 1) {
    //             n = {
    //                 data: c,
    //                 selectable: false,
    //                 expanded: true,
    //                 children: this.getChilds(cols, rowIndex + 1, 0 , c.colspan)
    //             };
    //         }
    //         return n;
    //     });
    // }
    // convertColumns2TreeData(cols: DataColumn[][], forSort = false) {
    //     const columns = cols.map((c: any) => {
    //         const aa = c.map((_) => {
    //             if (_.field.indexOf('farris-datagrid-column_') == -1) {
    //                 _.colspan = _.colspan || 1;
    //                 return _;
    //             }
    //             return null;
    //         });
    //         return aa.filter(n => n);
    //     });
    //     if (columns.length === 1) {
    //         return columns[0].map(c => {
    //             return {
    //                 data: c,
    //                 selectable: forSort ? !!c.sortable : true
    //             };
    //         });
    //     } else {
    //         return columns[0].map((c, i) => {
    //             if (c.colspan && c.colspan > 1) {
    //                 return {
    //                     data: c,
    //                     selectable: false,
    //                     expanded: true,
    //                     children: this.getChilds(columns, 1, 0, c.colspan, forSort)
    //                 };
    //             } else {
    //                 return {
    //                     data: c,
    //                     selectable: forSort ? !!c.sortable : true
    //                 };
    //             }
    //         });
    //     }
    // }
    // private checkViewTreeNodes(treeNodes: TreeNode[]) {
    //     treeNodes.forEach((tn: TreeNode) => {
    //         if (!tn.children || !tn.children.length) {
    //             tn.selectable = true;
    //         } else {
    //             tn.selectable = false;
    //             this.checkViewTreeNodes(tn.children);
    //         }
    //     });
    // }
    /**
     * @private
     * @param {?} gridInstance
     * @return {?}
     */
    function (gridInstance) {
        /** @type {?} */
        var cols = gridInstance.columns;
        // 重置列顺序为最初设计时的顺序
        /** @type {?} */
        var gridOpts = gridInstance.dfs._state.initialOptions;
        if (gridOpts.columnFields) {
            /** @type {?} */
            var desginCols = gridOpts.columnFields;
            /** @type {?} */
            var newColumns_1 = [];
            desginCols.forEach((/**
             * @param {?} c
             * @return {?}
             */
            function (c) {
                if (c.field !== '_datagrid-setting-control_') {
                    /** @type {?} */
                    var col = gridInstance.columns[0].find((/**
                     * @param {?} n
                     * @return {?}
                     */
                    function (n) { return n.field === c.field; }));
                    if (col) {
                        newColumns_1.push(col);
                    }
                }
            }));
            cols = [newColumns_1];
        }
        return cols;
    };
    /**
     * @param {?} cols
     * @return {?}
     */
    DatagridSettingsService.prototype.convertColumnsToSimple = /**
     * @param {?} cols
     * @return {?}
     */
    function (cols) {
        if (!Array.isArray(cols[0])) {
            cols = [cols];
        }
        return cols.map((/**
         * @param {?} _cols
         * @return {?}
         */
        function (_cols) {
            return _cols.map((/**
             * @param {?} c
             * @return {?}
             */
            function (c) {
                if (c.field !== '_datagrid-setting-control_') {
                    return {
                        field: c.field,
                        title: c.title,
                        colspan: c.colspan,
                        rowspan: c.rowspan,
                        sortable: c.sortable,
                        order: c.order,
                        halign: c.halign || 'left',
                        align: c.align || 'left',
                        visible: c.visible,
                        allowGrouping: c.allowGrouping,
                        groupFooter: c.groupFooter,
                        footer: c.footer,
                        width: c.width || 100,
                        dataType: c.dataType || 'string',
                        fixed: c.fixed || 'UNFIXED'
                    };
                }
            })).filter((/**
             * @param {?} n
             * @return {?}
             */
            function (n) { return n; }));
        }));
    };
    /**
     * @private
     * @param {?} gridInstance
     * @return {?}
     */
    DatagridSettingsService.prototype.resetGridView = /**
     * @private
     * @param {?} gridInstance
     * @return {?}
     */
    function (gridInstance) {
        if (!gridInstance) {
            return;
        }
        /** @type {?} */
        var dfs = gridInstance.dfs;
        if (dfs) {
            /** @type {?} */
            var options = dfs['_state'].initialOptions;
            if (options.sort) {
                if (options.sort.sortName) {
                    gridInstance.sortName = options.sort.sortName;
                }
                if (options.sort.sortOrder) {
                    gridInstance.sortOrder = options.sort.sortOrder;
                }
            }
            gridInstance.groupField = options.groupField || '';
            // TODO: 还需要修正默认列的显示顺序
            if (options.columnFields && options.columnFields.length) {
                /** @type {?} */
                var newColumns_2 = [];
                options.columnFields.forEach((/**
                 * @param {?} c
                 * @return {?}
                 */
                function (c) {
                    /** @type {?} */
                    var col = gridInstance.columns[0].find((/**
                     * @param {?} n
                     * @return {?}
                     */
                    function (n) { return n.field === c.field; }));
                    if (col) {
                        col.visible = c.visible;
                        col.halign = c.halign;
                        col.align = c.align;
                        col.width = c.width;
                        col.footer = c.footer;
                        col.groupFooter = c.groupFooter;
                        newColumns_2.push(col);
                    }
                }));
                gridInstance.columns[0] = newColumns_2;
            }
            // gridInstance['checkOptions']();
            gridInstance['columnsChanged']();
        }
    };
    /**
     * @private
     * @param {?} modalRef
     * @param {?} gridInstance
     * @param {?=} btn
     * @param {?=} _scheme
     * @return {?}
     */
    DatagridSettingsService.prototype.updateGridView = /**
     * @private
     * @param {?} modalRef
     * @param {?} gridInstance
     * @param {?=} btn
     * @param {?=} _scheme
     * @return {?}
     */
    function (modalRef, gridInstance, btn, _scheme) {
        var _this = this;
        if (btn === void 0) { btn = null; }
        if (_scheme === void 0) { _scheme = null; }
        /** @type {?} */
        var settings = modalRef.content;
        if (settings) {
            var sortInfo_1 = settings.sortInfo, viewColumns_1 = settings.viewColumns, columnFormat_1 = settings.columnFormat, groupField = settings.groupField, expandGroupRows_1 = settings.expandGroupRows, multiHeaders_1 = settings.multiHeaders;
            /** @type {?} */
            var _colformats = columnFormat_1 ? this.convertColumnsToSimple(columnFormat_1)[0] : [];
            this.saving = true;
            /** @type {?} */
            var _groupField_1 = '';
            if (gridInstance.groupRows && groupField && groupField.length) {
                if (typeof groupField === 'string') {
                    _groupField_1 = groupField;
                }
                else if (Array.isArray(groupField)) {
                    _groupField_1 = groupField.join(',');
                }
            }
            /** @type {?} */
            var _sortInfo = sortInfo_1;
            // 当多表头需要清理排序字段与分组字段，保证这些字段必须在表头中
            if (gridInstance.enableSetMultiHeaders && multiHeaders_1) {
                if (_groupField_1) {
                    _groupField_1 = cleanGroupFields(multiHeaders_1.viewCols, _groupField_1.split(','));
                }
                if (sortInfo_1 && sortInfo_1.sortName && sortInfo_1.sortName.length) {
                    _sortInfo = cleanSortFields(multiHeaders_1.viewCols, sortInfo_1);
                }
            }
            /** @type {?} */
            var saveData_1 = { sortInfo: _sortInfo, viewColumns: viewColumns_1, groupField: _groupField_1, columnFormat: _colformats, expandGroupRows: expandGroupRows_1, multiHeaders: multiHeaders_1 };
            /** @type {?} */
            var refreshGrid_1 = (/**
             * @return {?}
             */
            function () {
                if (gridInstance.groupRows) {
                    gridInstance.expandGroupRows = expandGroupRows_1;
                    gridInstance.groupField = _groupField_1;
                }
                if (gridInstance.enableSetMultiHeaders) {
                    // 设置表头
                    refreshGridColumns(gridInstance, multiHeaders_1.viewCols || []);
                }
                else {
                    if (viewColumns_1 && viewColumns_1.length) {
                        gridInstance.columns = gridInstance.columns.map((/**
                         * @param {?} cols
                         * @return {?}
                         */
                        function (cols) {
                            _this.updateColumnFormat(cols, columnFormat_1, gridInstance);
                            return _this.newVisibleOrderColumns(cols, viewColumns_1, columnFormat_1, gridInstance);
                        }));
                    }
                }
                gridInstance.columnsChanged(true);
                if (sortInfo_1 && Object.keys(sortInfo_1).length) {
                    var sortName = sortInfo_1.sortName, sortOrder = sortInfo_1.sortOrder;
                    if (sortName && sortName.length) {
                        gridInstance.sort(sortName.join(','), sortOrder.join(','));
                    }
                    else {
                        gridInstance.clearSort();
                    }
                }
                else {
                    gridInstance.clearSort();
                }
            });
            /** @type {?} */
            var saveCurrent_1 = (/**
             * @return {?}
             */
            function () {
                _this.setUserConfig(gridInstance.id, saveData_1).subscribe((/**
                 * @return {?}
                 */
                function () {
                    if (btn) {
                        btn.disabled = false;
                    }
                    _this.saving = false;
                    refreshGrid_1();
                    _this.setActiveSchemeItem(gridInstance.id, _scheme);
                    _this.prevSchemeItem = _scheme;
                    _this.updateActiveSchemeItemSettings(gridInstance.id, saveData_1);
                    _this.setCurrentConfigs(saveData_1);
                    modalRef.close();
                }));
            });
            if (gridInstance.showConfirmWhenSchemeChanged && gridInstance.enableScheme) {
                /** @type {?} */
                var languageRes = this.localeSer.getValue('datagrid-scheme.schemeChanged');
                /** @type {?} */
                var _changed = this.schemeService.isSchemeChanged(saveData_1, gridInstance.enableSetMultiHeaders);
                if (_changed) {
                    /** @type {?} */
                    var msgDlg_1 = this.messager.question2(languageRes.title, [
                        {
                            text: languageRes.cancel,
                            cls: 'btn btn-light',
                            handle: (/**
                             * @return {?}
                             */
                            function () {
                                _this.saving = false;
                                modalRef.close();
                                msgDlg_1.close();
                                _this.restoreScheme(gridInstance);
                            })
                        },
                        {
                            text: languageRes.no,
                            cls: 'btn btn-secondary',
                            handle: (/**
                             * @return {?}
                             */
                            function () {
                                // 保存到当前方案
                                msgDlg_1.close();
                                saveCurrent_1();
                            })
                        },
                        {
                            text: languageRes.yes,
                            cls: 'btn btn-primary',
                            handle: (/**
                             * @return {?}
                             */
                            function () {
                                // 另存新方案
                                _this.showNewSchemeDialog(gridInstance, { type: 'saveas' }, saveData_1, {
                                    ok: (/**
                                     * @param {?} t
                                     * @return {?}
                                     */
                                    function (t) {
                                        _this.saving = false;
                                        modalRef.close();
                                        _this.currentSchemeitem = t;
                                        _this.setActiveSchemeItem(gridInstance.id, cloneDeep(t));
                                        refreshGrid_1();
                                    }),
                                    cancel: (/**
                                     * @return {?}
                                     */
                                    function () {
                                        _this.saving = false;
                                        if (btn) {
                                            btn.disabled = false;
                                        }
                                    })
                                });
                                msgDlg_1.close();
                            })
                        },
                    ]);
                }
                else {
                    if (this.currentSchemeitem && this.prevSchemeItem && this.currentSchemeitem.id === this.prevSchemeItem.id) {
                        this.saving = false;
                        modalRef.close();
                        refreshGrid_1();
                    }
                    else {
                        saveCurrent_1();
                    }
                }
            }
            else {
                saveCurrent_1();
            }
        }
        else {
            modalRef.close();
        }
    };
    /**
     * @param {?} cols
     * @param {?} viewColumns
     * @param {?} columnFormat
     * @param {?} gridInstance
     * @return {?}
     */
    DatagridSettingsService.prototype.newVisibleOrderColumns = /**
     * @param {?} cols
     * @param {?} viewColumns
     * @param {?} columnFormat
     * @param {?} gridInstance
     * @return {?}
     */
    function (cols, viewColumns, columnFormat, gridInstance) {
        var _this = this;
        /** @type {?} */
        var hideColumns = [];
        cols.forEach((/**
         * @param {?} element
         * @param {?} index
         * @return {?}
         */
        function (element, index) {
            if (_this.isNewAddColumn(element.field, columnFormat) && element.field !== '_datagrid-setting-control_' && !gridInstance.enableScheme) {
                viewColumns.push(element.field);
            }
            else {
                element.visible = viewColumns.includes(element.field);
                if (!element.visible) {
                    hideColumns.push(element);
                }
            }
        }));
        // 清理不存在的列
        /** @type {?} */
        var newCols = viewColumns.map((/**
         * @param {?} field
         * @return {?}
         */
        function (field) {
            return cols.find((/**
             * @param {?} c
             * @return {?}
             */
            function (c) { return c.field === field; }));
        })).filter((/**
         * @param {?} n
         * @return {?}
         */
        function (n) { return n; }));
        if (hideColumns.length) {
            newCols = newCols.concat(hideColumns);
        }
        return newCols.filter((/**
         * @param {?} c
         * @return {?}
         */
        function (c) { return c && c.field && c.field !== '_datagrid-setting-control_'; }));
    };
    /**
     * 是否为新增加的字段
     * 新增的字段，需要在列表中展示出来，并保存到个性化设置中
     */
    /**
     * 是否为新增加的字段
     * 新增的字段，需要在列表中展示出来，并保存到个性化设置中
     * @private
     * @param {?} field
     * @param {?} columns
     * @return {?}
     */
    DatagridSettingsService.prototype.isNewAddColumn = /**
     * 是否为新增加的字段
     * 新增的字段，需要在列表中展示出来，并保存到个性化设置中
     * @private
     * @param {?} field
     * @param {?} columns
     * @return {?}
     */
    function (field, columns) {
        columns = columns || [];
        return !columns.find((/**
         * @param {?} c
         * @return {?}
         */
        function (c) { return c.field === field; }));
    };
    /**
     * @param {?} cols
     * @param {?} columnFormat
     * @param {?} gridInstance
     * @return {?}
     */
    DatagridSettingsService.prototype.updateColumnFormat = /**
     * @param {?} cols
     * @param {?} columnFormat
     * @param {?} gridInstance
     * @return {?}
     */
    function (cols, columnFormat, gridInstance) {
        if (columnFormat && columnFormat.length) {
            cols.forEach((/**
             * @param {?} col
             * @return {?}
             */
            function (col) {
                /** @type {?} */
                var formatCol = columnFormat.find((/**
                 * @param {?} f
                 * @return {?}
                 */
                function (f) { return f.field === col.field; }));
                if (formatCol) {
                    col.width = formatCol.width;
                    col.halign = formatCol.halign || 'left';
                    col.align = formatCol.align || 'left';
                    col.fixed = formatCol.fixed === 'UNFIXED' ? '' : formatCol.fixed;
                    col.title = formatCol.title;
                    if (gridInstance.groupRows && (col.allowGrouping || col.allowGrouping === undefined)) {
                        if (!col.groupFooter) {
                            col.groupFooter = formatCol.groupFooter;
                        }
                        if (col.groupFooter && col.groupFooter.options) {
                            if (!formatCol.groupFooter.options) {
                                formatCol.groupFooter.options = {};
                            }
                            col.groupFooter.options.text = formatCol.groupFooter.options.text || '';
                            col.groupFooter.options.calculationType =
                                formatCol.groupFooter.options.calculationType !== undefined &&
                                    formatCol.groupFooter.options.calculationType !== null ?
                                    parseInt(formatCol.groupFooter.options.calculationType, 10) : -1;
                        }
                    }
                    if (gridInstance.showFooter && !gridInstance.footerTemplate) {
                        if (!col.footer) {
                            col.footer = formatCol.footer;
                        }
                        if (col.footer && col.footer.options) {
                            if (!formatCol.footer.options) {
                                formatCol.footer.options = {};
                            }
                            col.footer.options.text = formatCol.footer.options.text || '';
                            col.footer.options.calculationType =
                                formatCol.footer.options.calculationType !== undefined &&
                                    formatCol.footer.options.calculationType !== null ?
                                    parseInt(formatCol.footer.options.calculationType, 10) : -1;
                        }
                    }
                }
            }));
        }
    };
    // 创建唯一key, 由uri + gridId 组成，并混淆
    // 创建唯一key, 由uri + gridId 组成，并混淆
    /**
     * @private
     * @param {?} gridId
     * @return {?}
     */
    DatagridSettingsService.prototype.createConfigKey = 
    // 创建唯一key, 由uri + gridId 组成，并混淆
    /**
     * @private
     * @param {?} gridId
     * @return {?}
     */
    function (gridId) {
        /** @type {?} */
        var grid = this.getGridInstance(gridId);
        if (grid) {
            return grid.dgs.createConfigKey(gridId);
        }
        else {
            this.writeDebugMsg('DatagridSettingService: Can not find the grid instance.');
        }
    };
    /**
     * @private
     * @param {?} gridId
     * @return {?}
     */
    DatagridSettingsService.prototype.getCurrentUserSettings = /**
     * @private
     * @param {?} gridId
     * @return {?}
     */
    function (gridId) {
        /** @type {?} */
        var gridInstance = this.getGridInstance(gridId);
        /** @type {?} */
        var config = { sortInfo: {}, viewColumns: [], groupField: '', columnFormat: [] };
        if (gridInstance) {
            var sortName = gridInstance.sortName, sortOrder = gridInstance.sortOrder, columns = gridInstance.columns;
            if (sortName) {
                /** @type {?} */
                var sortInfo = {
                    sortName: sortName.split(','),
                    sortOrder: sortOrder.split(',')
                };
                config.sortInfo = sortInfo;
            }
            /** @type {?} */
            var viewColumns = columns[0].filter((/**
             * @param {?} n
             * @return {?}
             */
            function (n) { return n.visible || n.visible === undefined; })).map((/**
             * @param {?} n
             * @return {?}
             */
            function (n) { return n.field; }));
            config.viewColumns = viewColumns;
            config.columnFormat = this.convertColumnsToSimple(this._convertColumnsToSimple(gridInstance))[0];
            if (gridInstance.groupRows) {
                config.groupField = gridInstance.groupField;
            }
        }
        return config;
    };
    /**
     * @param {?} gridId
     * @return {?}
     */
    DatagridSettingsService.prototype.saveUserConfig = /**
     * @param {?} gridId
     * @return {?}
     */
    function (gridId) {
        /** @type {?} */
        var config = this.getCurrentUserSettings(gridId);
        return this.setUserConfig(gridId, config);
    };
    /**
     * @param {?} gridId
     * @param {?} config
     * @return {?}
     */
    DatagridSettingsService.prototype.setUserConfig = /**
     * @param {?} gridId
     * @param {?} config
     * @return {?}
     */
    function (gridId, config) {
        var _this = this;
        /** @type {?} */
        var gridIns = this.getGridInstance(gridId);
        /** @type {?} */
        var key = this.createConfigKey(gridId);
        /** @type {?} */
        var LOCALEID = this.localeSer.localeId;
        /** @type {?} */
        var currentConfig = localStorage.getItem(key);
        /** @type {?} */
        var _config = (currentConfig ? JSON.parse(currentConfig) : {}) || {};
        if (config) {
            if (_config) {
                _config[LOCALEID] = config;
            }
            if (gridIns && gridIns.enableSetMultiHeaders) {
                _config['isMultiHeader'] = true;
            }
            localStorage.setItem(key, JSON.stringify(_config));
        }
        else {
            localStorage.removeItem(key);
        }
        if (this.httpRestService) {
            if (gridIns && gridIns.enableScheme) {
                /** @type {?} */
                var activeScheme_1 = this.getActiveSchemeItem(gridId);
                if (activeScheme_1) {
                    this.updateSchemeSettings(activeScheme_1, config);
                    if (activeScheme_1.type === 'private') {
                        return this.schemeService.saveScheme(activeScheme_1, gridId, true, gridIns.enableSetMultiHeaders);
                    }
                    else {
                        return this.schemeService.checkAuthority().pipe(switchMap((/**
                         * @param {?} t
                         * @return {?}
                         */
                        function (t) {
                            if (t.success) {
                                /** @type {?} */
                                var hasOrgAuthority = t.authOrganizationData && t.authOrganizationData.length;
                                if (activeScheme_1.type === 'public' || (activeScheme_1.type === 'org' && hasOrgAuthority)) {
                                    return _this.schemeService.saveScheme(activeScheme_1, gridId, true, gridIns.enableSetMultiHeaders);
                                }
                            }
                            return of(true);
                        })));
                    }
                }
                else {
                    // 如为系统预制时，按无方案处理
                    return this._saveUserConfig(key, config ? _config : '');
                    // return of(true);
                }
            }
            // 保存至数据库
            return this._saveUserConfig(key, config ? _config : '');
        }
        return of(true);
    };
    /**
     * @param {?} key
     * @param {?=} isMultiHeader
     * @return {?}
     */
    DatagridSettingsService.prototype.getUserConfig = /**
     * @param {?} key
     * @param {?=} isMultiHeader
     * @return {?}
     */
    function (key, isMultiHeader) {
        if (isMultiHeader === void 0) { isMultiHeader = false; }
        if (this.httpRestService) {
            return this._getUserConfig(key, isMultiHeader);
        }
        else {
            return of(this.getLocalSettings(key, isMultiHeader));
        }
    };
    /**
     * @param {?} key
     * @param {?=} isMultiHeader
     * @return {?}
     */
    DatagridSettingsService.prototype.getLocalSettings = /**
     * @param {?} key
     * @param {?=} isMultiHeader
     * @return {?}
     */
    function (key, isMultiHeader) {
        if (isMultiHeader === void 0) { isMultiHeader = false; }
        /** @type {?} */
        var config = localStorage.getItem(key);
        if (config) {
            /** @type {?} */
            var con = JSON.parse(config);
            if (isMultiHeader && !con['isMultiHeader']) {
                return null;
            }
            else {
                if (con['isMultiHeader']) {
                    return null;
                }
            }
            if (con[this.localeSer.localeId]) {
                return con[this.localeSer.localeId];
            }
            else {
                if (Object.keys(con).indexOf('viewColumns') > -1) {
                    return con;
                }
                return null;
            }
        }
        else {
            return null;
        }
    };
    /**
     * @private
     * @param {?} schemeList
     * @return {?}
     */
    DatagridSettingsService.prototype.getDefaultScheme = /**
     * @private
     * @param {?} schemeList
     * @return {?}
     */
    function (schemeList) {
        var _this = this;
        // 0、过滤出当前语言的方案列表
        // 1、有个人默认的返回个人默认方案
        // 2、没有个人默认方案的，返回公共方案第1个
        // 3、没有公共方案，返回组织方案第1个
        // 4、没有组织方案的, 返回个人方案第1个
        // 5、没有个人方案的，返回系统预制，即表单设计时的格式
        schemeList = schemeList.filter((/**
         * @param {?} n
         * @return {?}
         */
        function (n) {
            return JSON.parse(n.name)[_this.localeSer.localeId];
        }));
        /** @type {?} */
        var defaultScheme = null;
        if (!schemeList || !schemeList.length) {
            return defaultScheme;
        }
        else {
            defaultScheme = schemeList.find((/**
             * @param {?} n
             * @return {?}
             */
            function (n) { return n.isDefault; }));
            if (!defaultScheme) {
                /** @type {?} */
                var publicSchemes = schemeList.filter((/**
                 * @param {?} n
                 * @return {?}
                 */
                function (n) { return n.type === 'public'; }));
                if (!publicSchemes.length) {
                    publicSchemes = schemeList.filter((/**
                     * @param {?} n
                     * @return {?}
                     */
                    function (n) { return n.type === 'org'; }));
                }
                if (publicSchemes.length) {
                    defaultScheme = publicSchemes[0];
                }
                else {
                    defaultScheme = schemeList[0];
                }
            }
        }
        return defaultScheme;
    };
    /**
     * @param {?} gridId
     * @return {?}
     */
    DatagridSettingsService.prototype.getSettings = /**
     * @param {?} gridId
     * @return {?}
     */
    function (gridId) {
        var _this = this;
        /** @type {?} */
        var key = this.createConfigKey(gridId);
        /** @type {?} */
        var gridIns = this.getGridInstance(gridId);
        /** @type {?} */
        var schemeList$ = of([]);
        if (gridIns && gridIns.enableScheme) {
            schemeList$ = this.getSchemeList(gridId);
        }
        return forkJoin(schemeList$, this.getUserConfig(key), this.schemeService.getLanguages()).pipe(map((/**
         * @param {?} __0
         * @return {?}
         */
        function (_a) {
            var _b = tslib_1.__read(_a, 3), schemeList = _b[0], userSetting = _b[1], supportedLanguages = _b[2];
            schemeList = schemeList || [];
            _this.languages = supportedLanguages;
            if (!schemeList.length) {
                return userSetting;
            }
            else {
                // 缓存方案列表
                _this.setSchemeList(schemeList, gridId);
                // 查找默认方案
                /** @type {?} */
                var defaultScheme = _this.getDefaultScheme(schemeList);
                if (!defaultScheme) {
                    return userSetting;
                }
                else {
                    _this.setActiveSchemeItem(gridId, defaultScheme);
                    /** @type {?} */
                    var userSettings = null;
                    if (defaultScheme.queryConditionString) {
                        userSettings = JSON.parse(defaultScheme.queryConditionString);
                    }
                    if (userSettings) {
                        /** @type {?} */
                        var localeId = _this.localeSer.localeId;
                        if (userSettings[localeId]) {
                            localStorage.setItem(key, JSON.stringify(userSettings));
                            return userSettings[localeId];
                        }
                        else {
                            userSettings[localeId] = null;
                            localStorage.setItem(key, JSON.stringify(userSettings));
                            return null;
                        }
                    }
                    else {
                        return null;
                    }
                }
            }
        })));
    };
    /**
     * @private
     * @param {?} key
     * @param {?} config
     * @return {?}
     */
    DatagridSettingsService.prototype._saveUserConfig = /**
     * @private
     * @param {?} key
     * @param {?} config
     * @return {?}
     */
    function (key, config) {
        try {
            /** @type {?} */
            var userConfigSetting = {
                configkey1: key,
                configkey2: '',
                configkey3: '',
                textvalue: config ? JSON.stringify(config) : ''
            };
            return this.httpRestService.saveUserSettings(userConfigSetting);
        }
        catch (e) {
            this.writeDebugMsg(e, 'error');
        }
    };
    /**
     * @param {?} gridInstance
     * @param {?} modalRef
     * @return {?}
     */
    DatagridSettingsService.prototype.resetUserConfig = /**
     * @param {?} gridInstance
     * @param {?} modalRef
     * @return {?}
     */
    function (gridInstance, modalRef) {
        var _this = this;
        /** @type {?} */
        var restorDefaultText = this.localeSer.getValue('datagrid.settings.restoreDefaultSettingsText') || '确认要恢复默认设置吗？';
        this.messager.confirm(restorDefaultText).pipe(switchMap((/**
         * @param {?} t
         * @return {?}
         */
        function (t) {
            if (t) {
                return _this.setUserConfig(gridInstance.id, '');
            }
            return of(t);
        }))).subscribe((/**
         * @param {?} t
         * @return {?}
         */
        function (t) {
            if (t) {
                _this.resetGridView(gridInstance);
                modalRef.close();
            }
        }));
    };
    /**
     * @private
     * @param {?} key
     * @param {?=} isMultiHeader
     * @return {?}
     */
    DatagridSettingsService.prototype._getUserConfig = /**
     * @private
     * @param {?} key
     * @param {?=} isMultiHeader
     * @return {?}
     */
    function (key, isMultiHeader) {
        var _this = this;
        if (isMultiHeader === void 0) { isMultiHeader = false; }
        try {
            return this.httpRestService.getUserSettings(key).pipe(map((/**
             * @param {?} ucs
             * @return {?}
             */
            function (ucs) {
                if (ucs && ucs.textValue) {
                    /** @type {?} */
                    var c = JSON.parse(ucs.textValue);
                    if (c) {
                        if (isMultiHeader && !c['isMultiHeader']) {
                            return null;
                        }
                        else {
                            if (c['isMultiHeader']) {
                                return null;
                            }
                        }
                        if (c[_this.localeSer.localeId]) {
                            localStorage.setItem(key, ucs.textValue);
                            return c[_this.localeSer.localeId];
                        }
                        else {
                            c[_this.localeSer.localeId] = null;
                            localStorage.setItem(key, JSON.stringify(c));
                            return null;
                        }
                    }
                    return null;
                }
                return null;
            })));
        }
        catch (e) {
            if (this.debugSer) {
                this.debugSer.error(e);
            }
        }
    };
    /**
     * @private
     * @param {?} gridId
     * @param {?=} settings
     * @return {?}
     */
    DatagridSettingsService.prototype.buildSubmitData = /**
     * @private
     * @param {?} gridId
     * @param {?=} settings
     * @return {?}
     */
    function (gridId, settings) {
        if (settings === void 0) { settings = null; }
        /** @type {?} */
        var LOCALEID = this.localeSer.localeId;
        if (!settings) {
            settings = this.getCurrentUserSettings(gridId);
        }
        /** @type {?} */
        var localeKey = this.createConfigKey(gridId);
        /** @type {?} */
        var currentConfig = localStorage.getItem(localeKey);
        /** @type {?} */
        var _config = (currentConfig ? JSON.parse(currentConfig) : {}) || {};
        if (_config) {
            _config[LOCALEID] = settings;
        }
        return _config;
    };
    // ----------------------------------------------------------------------------------------------- \\
    // ----------------------------------------------------------------------------------------------- \\
    /**
     * @private
     * @param {?} gridInstance
     * @param {?} schemeList
     * @param {?} authInfo
     * @param {?} simpleRef
     * @return {?}
     */
    DatagridSettingsService.prototype.showSchemeListDialog = 
    // ----------------------------------------------------------------------------------------------- \\
    /**
     * @private
     * @param {?} gridInstance
     * @param {?} schemeList
     * @param {?} authInfo
     * @param {?} simpleRef
     * @return {?}
     */
    function (gridInstance, schemeList, authInfo, simpleRef) {
        var _this = this;
        /** @type {?} */
        var modalOpts = {
            width: 760, height: 577, showHeader: false, title: '控制面板',
            initialState: {
                items: (schemeList || []).filter((/**
                 * @param {?} n
                 * @return {?}
                 */
                function (n) {
                    return JSON.parse(n.name)[_this.localeSer.localeId];
                })),
                removeItem: authInfo.success,
                currentUserId: authInfo.currentUserId,
                currentSchemeId: this.currentSchemeitem ? this.currentSchemeitem.id : ''
            },
            showButtons: false
        };
        /** @type {?} */
        var schemeListDlg = this.modalSer.show(SchemeListComponent, modalOpts);
        // schemeListDlg.dialog.location.nativeElement.style.zIndex = 2031;
        /** @type {?} */
        var instance = (/** @type {?} */ (schemeListDlg.content));
        instance.closeModal.subscribe((/**
         * @return {?}
         */
        function () {
            schemeListDlg.close();
        }));
        instance.submitModal.subscribe((/**
         * @param {?} t
         * @return {?}
         */
        function (t) {
            _this.schemeService.updateScheme(t, gridInstance.id, gridInstance.enableSetMultiHeaders).subscribe((/**
             * @param {?} e
             * @return {?}
             */
            function (e) {
                if (e === false) {
                    schemeListDlg.close();
                    return;
                }
                /** @type {?} */
                var msg = '列设置方案保存成功。';
                if (_this.notifyService) {
                    _this.notifyService.success(msg);
                }
                else {
                    _this.messager.success(msg);
                }
                if (t.defaultId) {
                    schemeList.forEach((/**
                     * @param {?} n
                     * @return {?}
                     */
                    function (n) {
                        n.isDefault = false;
                        if (n.id === t.defaultId) {
                            n.isDefault = true;
                            // this.setActiveSchemeItem(gridInstance.id, n);
                        }
                    }));
                }
                /** @type {?} */
                var newSchemeList = schemeList;
                if (t.deletedIds && t.deletedIds.length) {
                    newSchemeList = schemeList.filter((/**
                     * @param {?} n
                     * @return {?}
                     */
                    function (n) {
                        return !t.deletedIds.includes(n.id);
                    }));
                }
                _this.schemeService.setSchemeList(gridInstance.id, newSchemeList);
                schemeListDlg.close();
                /** @type {?} */
                var currentScheme = _this.getActiveSchemeItem(gridInstance.id);
                if (!currentScheme) {
                    _this.setActiveSchemeItem(gridInstance.id, null);
                    simpleRef.instance.currentSchemeItem = null;
                    simpleRef.instance.resetToDefault();
                    _this.prevSchemeItem = null;
                    simpleRef.instance.onSubmitClick();
                }
            }));
        }));
        /** @type {?} */
        var modalContainer = (/** @type {?} */ (schemeListDlg.dialog.instance));
        modalContainer.draggbar.handle = instance.header.nativeElement;
    };
    // 新增或另存方案
    // 新增或另存方案
    /**
     * @private
     * @param {?} gridInstance
     * @param {?} e
     * @param {?} settings
     * @param {?} callback
     * @return {?}
     */
    DatagridSettingsService.prototype.showNewSchemeDialog = 
    // 新增或另存方案
    /**
     * @private
     * @param {?} gridInstance
     * @param {?} e
     * @param {?} settings
     * @param {?} callback
     * @return {?}
     */
    function (gridInstance, e, settings, callback) {
        var _this = this;
        /** @type {?} */
        var modalOpts = {
            width: 480, height: 269, showHeader: false, title: '控制面板',
            initialState: {
                languages: this.languages
            },
            showButtons: false,
            resizable: false
        };
        /** @type {?} */
        var newSchemeDlg = this.modalSer.show(NewSchemeComponent, modalOpts);
        // newSchemeDlg.dialog.location.nativeElement.style.zIndex = 2031;
        /** @type {?} */
        var instance = (/** @type {?} */ (newSchemeDlg.content));
        instance.closeModal.subscribe((/**
         * @return {?}
         */
        function () {
            newSchemeDlg.close();
            if (callback && callback.cancel) {
                callback.cancel();
            }
        }));
        instance.submitModal.pipe(switchMap((/**
         * @param {?} t
         * @return {?}
         */
        function (t) {
            return _this.createNewScheme(gridInstance.id, t, e.type === 'new', settings);
        }))).subscribe((/**
         * @param {?} t
         * @return {?}
         */
        function (t) {
            if (t.flag === false) {
                /** @type {?} */
                var msg = t.msg;
                /** @type {?} */
                var _msg = msg;
                if (msg) {
                    if (msg.indexOf('|') > -1) {
                        _msg = msg.split('|').map((/**
                         * @param {?} langcode
                         * @return {?}
                         */
                        function (langcode) {
                            return _this.localeSer.getValue('datagrid-settings.' + langcode);
                        })).join('');
                    }
                    else {
                        _msg = _this.localeSer.getValue('datagrid-settings.' + msg);
                    }
                    if (_this.notifyService) {
                        _this.notifyService.info(_msg);
                    }
                    else {
                        _this.messager.info(_msg);
                    }
                }
                return;
            }
            // 更新方案列表
            /** @type {?} */
            var schemeList = _this.schemeService.getStateValue(gridInstance.id, 'list') || [];
            if (t.isDefault) {
                schemeList.forEach((/**
                 * @param {?} n
                 * @return {?}
                 */
                function (n) {
                    n.isDefault = false;
                }));
            }
            schemeList.push(t);
            _this.schemeService.setSchemeList(gridInstance.id, schemeList);
            if (callback && callback.ok) {
                callback.ok(t);
            }
            newSchemeDlg.close();
        }));
        instance.checkAuthority.pipe(switchMap((/**
         * @param {?} t
         * @return {?}
         */
        function (t) {
            return _this.schemeService.checkAuthority().pipe(map((/**
             * @param {?} auth
             * @return {?}
             */
            function (auth) {
                return tslib_1.__assign({ type: t }, auth);
            })));
        }))).subscribe((/**
         * @param {?} t
         * @return {?}
         */
        function (t) {
            /** @type {?} */
            var hasAuthority = { public: true, org: true };
            // 您没有将方案的使用范围设置为公共的权限。
            /** @type {?} */
            var _msg = 'noAuth.public';
            if (t.type.value === 'org') {
                // 您没有将方案的使用范围设置为组织的权限。
                _msg = 'noAuth.org';
            }
            /** @type {?} */
            var msg = _this.localeSer.getValue('datagrid-settings.' + _msg);
            if (t.success) {
                /** @type {?} */
                var hasPublicAuthority = t.authOperationData && t.authOperationData.length;
                hasAuthority.public = hasPublicAuthority;
                /** @type {?} */
                var hasOrgAuthority = t.authOrganizationData && t.authOrganizationData.length;
                hasAuthority.org = hasOrgAuthority;
                if (t.type.value === 'public') {
                    instance.schemeInfo.type = t.type.value;
                }
                else if (t.type.value === 'org') {
                    if (!hasOrgAuthority) {
                        _this.notifyService.warning(msg);
                    }
                    else {
                        instance.schemeInfo.type = t.type.value;
                        instance.schemeInfo.orgids = t.authOrganizationData.join(',');
                        instance.dataPermissionIds = t.authOrganizationData;
                    }
                }
            }
            else {
                _this.notifyService.warning(msg);
                hasAuthority = { public: false, org: false };
                ;
            }
            instance.refresh(hasAuthority);
        }));
        /** @type {?} */
        var modalContainer = (/** @type {?} */ (newSchemeDlg.dialog.instance));
        modalContainer.draggbar.handle = instance.header.nativeElement;
    };
    /**
     * @param {?} gridId
     * @return {?}
     */
    DatagridSettingsService.prototype.getSchemeList = /**
     * @param {?} gridId
     * @return {?}
     */
    function (gridId) {
        /** @type {?} */
        var gridIns = this.getGridInstance(gridId);
        return this.schemeService.getSchemeList(gridId, gridIns.enableSetMultiHeaders);
    };
    /** 新增方案
     *  isNewScheme，是否新加方案，否则为另存为
     *  currentSettings： 当前配置信息
     *  data: 新建方案窗口传递数据
     */
    /**
     * 新增方案
     *  isNewScheme，是否新加方案，否则为另存为
     *  currentSettings： 当前配置信息
     *  data: 新建方案窗口传递数据
     * @param {?} gridId
     * @param {?} data
     * @param {?=} isNewScheme
     * @param {?=} currentSettings
     * @return {?}
     */
    DatagridSettingsService.prototype.createNewScheme = /**
     * 新增方案
     *  isNewScheme，是否新加方案，否则为另存为
     *  currentSettings： 当前配置信息
     *  data: 新建方案窗口传递数据
     * @param {?} gridId
     * @param {?} data
     * @param {?=} isNewScheme
     * @param {?=} currentSettings
     * @return {?}
     */
    function (gridId, data, isNewScheme, currentSettings) {
        if (isNewScheme === void 0) { isNewScheme = true; }
        var _a;
        if (!data.name) {
            // msg 请输入方案名称
            return of({ flag: false, msg: 'required.schemeName' });
        }
        else {
            /** @type {?} */
            var hasName = this.schemeService.hasSchemeName(gridId, data.name);
            if (typeof hasName === 'boolean' && hasName) {
                // msg '方案名称已存在，请修改。'
                return of({ flag: false, msg: 'has.exist' });
            }
            else if (Array.isArray(hasName) && hasName.length) {
                /** @type {?} */
                var getMessageCode_1 = (/**
                 * @param {?} langCode
                 * @return {?}
                 */
                function (langCode) {
                    if (langCode === 'zh-CHS') {
                        return 'has.chs'; // 简体中文名称已存在。
                    }
                    else if (langCode === 'zh-CHT') {
                        return 'has.cht'; // 繁體中文名稱已存在。
                    }
                    else {
                        return 'has.en'; // 英文名称已存在
                    }
                });
                if (hasName.includes(this.localeSer.localeId)) {
                    /** @type {?} */
                    var msg = getMessageCode_1(this.localeSer.localeId);
                    return of({ flag: false, msg: msg });
                }
                else {
                    /** @type {?} */
                    var msgs = hasName.map((/**
                     * @param {?} n
                     * @return {?}
                     */
                    function (n) {
                        return getMessageCode_1(n);
                    }));
                    return of({ flag: false, msg: msgs.join('|') });
                }
            }
        }
        /** @type {?} */
        var requiredName = [];
        if (!data.name[this.localeSer.localeId]) {
            requiredName.push(this.localeSer.localeId);
        }
        // this.languages.forEach(n => {
        //     if (data.name[n.code] === '' || data.name[n.code] === undefined) {
        //         requiredName.push(n.code);
        //     }
        // });
        if (requiredName.length) {
            /** @type {?} */
            var msgs = requiredName.map((/**
             * @param {?} n
             * @return {?}
             */
            function (n) {
                if (n === 'zh-CHS') {
                    return 'required.chs'; //'请输入简体中文名称。';
                }
                else if (n === 'zh-CHT') {
                    return 'required.cht'; //'请输入繁体中文名称。';
                }
                else {
                    return 'required.en'; // '请输入英文名称。';
                }
            }));
            return of({ flag: false, msg: msgs.join('|') });
        }
        if (data.type && data.type === 'org' && (!data.orgids || !data.orgids.length)) {
            // msg '请选择组织'
            return of({ flag: false, msg: 'required.org' });
        }
        /** @type {?} */
        var _config = null;
        if (!isNewScheme) {
            /** @type {?} */
            var LOCALEID = this.localeSer.localeId;
            if (currentSettings && currentSettings.columnFormat) {
                currentSettings.columnFormat = this.convertColumnsToSimple(currentSettings.columnFormat);
            }
            _config = (_a = {}, _a[LOCALEID] = currentSettings, _a);
        }
        /** @type {?} */
        var newId = this.idService.guid();
        /** @type {?} */
        var isDefault = data.isDefault;
        if (isDefault) {
            if (data.type !== 'private') {
                isDefault = false;
            }
        }
        if (data.name && typeof data.name === 'object') {
            data.name = JSON.stringify(data.name);
        }
        /** @type {?} */
        var gridInstance = this.getGridInstance(gridId);
        if (gridInstance && gridInstance.enableSetMultiHeaders && _config) {
            _config['isMultiHeader'] = gridInstance.enableSetMultiHeaders;
        }
        /** @type {?} */
        var scheme = {
            id: newId,
            belongId: '',
            code: '',
            name: data.name,
            type: data.type,
            isDefault: isDefault,
            isSystem: false,
            extendId: 'datagrid-settings-scheme',
            extendInfo: this.buildOrgAndSchemeRelations(newId, data.orgids),
            queryConditionString: _config ? JSON.stringify(_config) : '',
        };
        return this.schemeService.saveScheme(scheme, gridId, false, gridInstance.enableSetMultiHeaders).pipe(map((/**
         * @return {?}
         */
        function () {
            return scheme;
        })));
    };
    /**
     * @param {?} schemeList
     * @param {?} gridId
     * @return {?}
     */
    DatagridSettingsService.prototype.setSchemeList = /**
     * @param {?} schemeList
     * @param {?} gridId
     * @return {?}
     */
    function (schemeList, gridId) {
        this.schemeService.update({ list: schemeList }, gridId);
    };
    /**
     * @private
     * @param {?} schemeId
     * @param {?} orgIds
     * @return {?}
     */
    DatagridSettingsService.prototype.buildOrgAndSchemeRelations = /**
     * @private
     * @param {?} schemeId
     * @param {?} orgIds
     * @return {?}
     */
    function (schemeId, orgIds) {
        var _this = this;
        if (!orgIds || !orgIds.length) {
            return [];
        }
        if (typeof orgIds === 'string') {
            orgIds = orgIds.split(',');
        }
        return orgIds.map((/**
         * @param {?} n
         * @return {?}
         */
        function (n) {
            return {
                id: _this.idService.guid(),
                orgId: n,
                relatedId: schemeId
            };
        }));
    };
    /**
     * @private
     * @param {?} gridId
     * @return {?}
     */
    DatagridSettingsService.prototype.getCurrentSchemeSettings = /**
     * @private
     * @param {?} gridId
     * @return {?}
     */
    function (gridId) {
        /** @type {?} */
        var activeScheme = (/** @type {?} */ (this.getActiveSchemeItem(gridId)));
        if (activeScheme && activeScheme.queryConditionString) {
            return JSON.parse(activeScheme.queryConditionString);
        }
        return null;
    };
    /**
     * @param {?} settings
     * @return {?}
     */
    DatagridSettingsService.prototype.setCurrentConfigs = /**
     * @param {?} settings
     * @return {?}
     */
    function (settings) {
        this['CURRENT_CONFIGS'] = settings;
    };
    /**
     * @private
     * @return {?}
     */
    DatagridSettingsService.prototype.getCurrentConfigs = /**
     * @private
     * @return {?}
     */
    function () {
        return this['CURRENT_CONFIGS'] || {};
    };
    /**
     * @private
     * @param {?} e
     * @param {?} gridInstance
     * @param {?=} modal
     * @return {?}
     */
    DatagridSettingsService.prototype.applySettings = /**
     * @private
     * @param {?} e
     * @param {?} gridInstance
     * @param {?=} modal
     * @return {?}
     */
    function (e, gridInstance, modal) {
        e.target.disabled = true;
        if (this.saving) {
            return;
        }
        if (!this.saving) {
            /** @type {?} */
            var _scheme = void 0;
            /** @type {?} */
            var dlg = void 0;
            if (modal) {
                var modalRef = modal.modalRef, currentScheme = modal.currentScheme;
                dlg = modalRef;
                _scheme = currentScheme;
            }
            else {
                dlg = e;
                _scheme = e.currentScheme;
            }
            this.updateGridView(dlg, gridInstance, e.target, _scheme);
        }
    };
    /**
     * @param {?} viewCols
     * @param {?} gridInitOptions
     * @return {?}
     */
    DatagridSettingsService.prototype.getMultiHeaderColumns = /**
     * @param {?} viewCols
     * @param {?} gridInitOptions
     * @return {?}
     */
    function (viewCols, gridInitOptions) {
        return mergetColumnOptions(viewCols, gridInitOptions);
    };
    DatagridSettingsService.decorators = [
        { type: Injectable }
    ];
    /** @nocollapse */
    DatagridSettingsService.ctorParameters = function () { return [
        { type: Injector },
        { type: BsModalService },
        { type: MessagerService },
        { type: IdService },
        { type: LocaleService }
    ]; };
    return DatagridSettingsService;
}());
export { DatagridSettingsService };
if (false) {
    /**
     * @type {?}
     * @private
     */
    DatagridSettingsService.prototype.multiSortMsg;
    /**
     * @type {?}
     * @private
     */
    DatagridSettingsService.prototype.columnsSortableMsg;
    /**
     * @type {?}
     * @private
     */
    DatagridSettingsService.prototype.notShowDialog;
    /**
     * @type {?}
     * @private
     */
    DatagridSettingsService.prototype._httpRestService;
    /**
     * @type {?}
     * @private
     */
    DatagridSettingsService.prototype.languages;
    /**
     * @type {?}
     * @private
     */
    DatagridSettingsService.prototype.gridRefs;
    /**
     * @type {?}
     * @private
     */
    DatagridSettingsService.prototype.activeSchemeItem;
    /**
     * @type {?}
     * @private
     */
    DatagridSettingsService.prototype.saving;
    /**
     * @type {?}
     * @private
     */
    DatagridSettingsService.prototype.cfr;
    /**
     * @type {?}
     * @private
     */
    DatagridSettingsService.prototype.app;
    /**
     * @type {?}
     * @private
     */
    DatagridSettingsService.prototype.schemeListSubscription;
    /**
     * @type {?}
     * @private
     */
    DatagridSettingsService.prototype.schemeService;
    /**
     * @type {?}
     * @private
     */
    DatagridSettingsService.prototype.notifyService;
    /**
     * @type {?}
     * @private
     */
    DatagridSettingsService.prototype.commonUtils;
    /**
     * @type {?}
     * @private
     */
    DatagridSettingsService.prototype.currentSchemeitem;
    /**
     * @type {?}
     * @private
     */
    DatagridSettingsService.prototype.prevSchemeItem;
    /**
     * @type {?}
     * @private
     */
    DatagridSettingsService.prototype.debugSer;
    /**
     * @type {?}
     * @private
     */
    DatagridSettingsService.prototype.injector;
    /**
     * @type {?}
     * @private
     */
    DatagridSettingsService.prototype.modalSer;
    /**
     * @type {?}
     * @private
     */
    DatagridSettingsService.prototype.messager;
    /**
     * @type {?}
     * @private
     */
    DatagridSettingsService.prototype.idService;
    /**
     * @type {?}
     * @private
     */
    DatagridSettingsService.prototype.localeSer;
    /* Skipping unhandled member: ;*/
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0YWdyaWQtc2V0dGluZ3Muc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvdWktZGF0YWdyaWQtc2V0dGluZ3MvIiwic291cmNlcyI6WyJsaWIvZGF0YWdyaWQtc2V0dGluZ3Muc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFBd0IsR0FBRyxFQUFFLFNBQVMsRUFBTyxNQUFNLGdCQUFnQixDQUFDO0FBQzNFLE9BQU8sRUFBRSxRQUFRLEVBQWMsRUFBRSxFQUFnQixLQUFLLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDckUsT0FBTyxFQUFFLFVBQVUsRUFBRSxRQUFRLEVBQUUsY0FBYyxFQUFFLHdCQUF3QixFQUFFLGNBQWMsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUUvRyxPQUFPLEVBQUUsY0FBYyxFQUF5QyxNQUFNLGtCQUFrQixDQUFDO0FBQ3pGLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUN0RCxPQUFPLEVBQUUseUJBQXlCLEVBQUUsTUFBTSwrQkFBK0IsQ0FBQztBQUMxRSxPQUFPLEVBQUUsU0FBUyxFQUFxQixNQUFNLFdBQVcsQ0FBQztBQUN6RCxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFFbEQsT0FBTyxFQUFFLFdBQVcsRUFBRSxZQUFZLEVBQUUsU0FBUyxFQUF1QixNQUFNLG1CQUFtQixDQUFDO0FBQzlGLE9BQU8sRUFBRSxzQkFBc0IsRUFBRSxNQUFNLHdDQUF3QyxDQUFDO0FBQ2hGLE9BQU8sRUFBRSxxQkFBcUIsRUFBRSxNQUFNLDJCQUEyQixDQUFDO0FBQ2xFLE9BQU8sRUFBRSxrQkFBa0IsRUFBRSxNQUFNLDhCQUE4QixDQUFDO0FBQ2xFLE9BQU8sRUFBRSxtQkFBbUIsRUFBRSxNQUFNLGdDQUFnQyxDQUFDO0FBQ3JFLE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUdsRCxPQUFPLEVBQUUsNEJBQTRC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RUQsSUFBSSxDQUFDLGNBQWMsQ0FBQyxHQUFHLEVBQUUsWUFBWSxFQUFFLENBQUMsQ0FBQyxNQUFNLEVBQUUsT0FBTyxDQUFDLENBQUM7U0FDN0Q7SUFDTCxDQUFDOzs7Ozs7SUFFRCx1REFBcUI7Ozs7O0lBQXJCLFVBQXNCLFFBQVEsRUFBRSxlQUFlO1FBQzNDLE9BQU8sbUJBQW1CLENBQUMsUUFBUSxFQUFFLGVBQWUsQ0FBQyxDQUFBO0lBQ3pELENBQUM7O2dCQXhsREosVUFBVTs7OztnQkEzQlUsUUFBUTtnQkFFcEIsY0FBYztnQkFDZCxlQUFlO2dCQUtZLFNBQVM7Z0JBRnBDLGFBQWE7O0lBOG1EdEIsOEJBQUM7Q0FBQSxBQXpsREQsSUF5bERDO1NBeGxEWSx1QkFBdUI7Ozs7OztJQUVoQywrQ0FBNkM7Ozs7O0lBQzdDLHFEQUE4Qzs7Ozs7SUFDOUMsZ0RBQW1EOzs7OztJQUVuRCxtREFBZ0M7Ozs7O0lBRWhDLDRDQUE0Qjs7Ozs7SUFjNUIsMkNBQTREOzs7OztJQUM1RCxtREFBMkQ7Ozs7O0lBRTNELHlDQUF1Qjs7Ozs7SUFDdkIsc0NBQTZDOzs7OztJQUM3QyxzQ0FBbUM7Ozs7O0lBQ25DLHlEQUFvRDs7Ozs7SUFFcEQsZ0RBQTZDOzs7OztJQUM3QyxnREFBcUM7Ozs7O0lBRXJDLDhDQUFpQzs7Ozs7SUFFakMsb0RBQWlDOzs7OztJQUNqQyxpREFBOEI7Ozs7O0lBQzlCLDJDQUFzQzs7Ozs7SUFFMUIsMkNBQTBCOzs7OztJQUFFLDJDQUFnQzs7Ozs7SUFDNUQsMkNBQWlDOzs7OztJQUFFLDRDQUE0Qjs7Ozs7SUFDL0QsNENBQWdDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgZGVib3VuY2VUaW1lLCBmaWx0ZXIsIG1hcCwgc3dpdGNoTWFwLCB0YXAgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XHJcbmltcG9ydCB7IGZvcmtKb2luLCBPYnNlcnZhYmxlLCBvZiwgU3Vic2NyaXB0aW9uLCB0aW1lciB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQgeyBJbmplY3RhYmxlLCBJbmplY3RvciwgSW5qZWN0aW9uVG9rZW4sIENvbXBvbmVudEZhY3RvcnlSZXNvbHZlciwgQXBwbGljYXRpb25SZWYgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgRGF0YWdyaWRDb21wb25lbnQsIERhdGFDb2x1bW4gfSBmcm9tICdAZmFycmlzL3VpLWRhdGFncmlkJztcclxuaW1wb3J0IHsgQnNNb2RhbFNlcnZpY2UsIE1vZGFsT3B0aW9ucywgTW9kYWxDb250YWluZXJDb21wb25lbnQgfSBmcm9tICdAZmFycmlzL3VpLW1vZGFsJztcclxuaW1wb3J0IHsgTWVzc2FnZXJTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy91aS1tZXNzYWdlcic7XHJcbmltcG9ydCB7IERhdGFncmlkU2V0dGluZ3NDb21wb25lbnQgfSBmcm9tICcuL2RhdGFncmlkLXNldHRpbmdzLmNvbXBvbmVudCc7XHJcbmltcG9ydCB7IGNsb25lRGVlcCwgZGVib3VuY2UsIGZsYXR0ZW4gfSBmcm9tICdsb2Rhc2gtZXMnO1xyXG5pbXBvcnQgeyBMb2NhbGVTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy91aS1sb2NhbGUnO1xyXG5pbXBvcnQgeyBUcmVlTm9kZSB9IGZyb20gJ0BmYXJyaXMvdWktdHJlZXRhYmxlJztcclxuaW1wb3J0IHsgQ29tbW9uVXRpbHMsIERlYnVnU2VydmljZSwgSWRTZXJ2aWNlLCBXRUJBUElfUFJFRklYX1RPS0VOIH0gZnJvbSAnQGZhcnJpcy91aS1jb21tb24nO1xyXG5pbXBvcnQgeyBTaW1wbGVDb2x1bW5zQ29tcG9uZW50IH0gZnJvbSAnLi9zaW1wbGUtbW9kZS9zaW1wbGUtY29sdW1ucy5jb21wb25lbnQnO1xyXG5pbXBvcnQgeyBEYXRhZ3JpZFNjaGVtZVNlcnZpY2UgfSBmcm9tICcuL2RhdGFncmlkLXNjaGVtZS5zZXJ2aWNlJztcclxuaW1wb3J0IHsgTmV3U2NoZW1lQ29tcG9uZW50IH0gZnJvbSAnLi9zY2hlbWUvbmV3c2NoZW1lLmNvbXBvbmVudCc7XHJcbmltcG9ydCB7IFNjaGVtZUxpc3RDb21wb25lbnQgfSBmcm9tICcuL3NjaGVtZS9zY2hlbWUtbGlzdC5jb21wb25lbnQnO1xyXG5pbXBvcnQgeyBOb3RpZnlTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy91aS1ub3RpZnknO1xyXG5pbXBvcnQgeyBEYXRhZ3JpZFNjaGVtZU1vZGVsLCBJU19NVUxUSV9IRUFERVJfU1RSSU5HLCBTY2hlbWVBdXRoTW9kZWwsIFNldHRpbmdNb2RlbCB9IGZyb20gJy4vc2V0dGluZy5tb2RlbCc7XHJcblxyXG5pbXBvcnQgeyBEQVRBR1JJRF9TRVRUSU5HU19MT0NBTEVEQVRBIH0gIGZyb20gJy4vZGF0YWdyaWQtc2V0dGluZ3MtbG9jYWxlJztcclxuaW1wb3J0IHsgY2xlYW5Hcm91cEZpZWxkcywgY2xlYW5Tb3J0RmllbGRzLCBjb2x1bW5zVG9UcmVlTm9kZXMsIGdldERhdGFGaWVsZHNGb3JNdWx0aUhlYWRlcnMsIG1lcmdldENvbHVtbk9wdGlvbnMsIHJlZnJlc2hHcmlkQ29sdW1ucyB9IGZyb20gJy4vbXV0bGktaGVhZGVycy5oZWxwZXInO1xyXG5cclxuXHJcbmV4cG9ydCBjb25zdCBHUklEX1NFVFRJTkdTX1dFQkFQSSA9ICBuZXcgSW5qZWN0aW9uVG9rZW4oJyBGYXJyaXMgRGF0YUdyaWQgVXNlciBTZXR0aW5nIFdlYkFwaSBVUkkuJyk7XHJcblxyXG5leHBvcnQgdHlwZSBOZXdTY2hlbWVDYWxsQmFjayA9IHtcclxuICAgIGNhbmNlbD86IChwPzogYW55KSA9PiB2b2lkLFxyXG4gICAgb2s6IChwOiBhbnkpID0+IHZvaWRcclxufTtcclxuXHJcbkBJbmplY3RhYmxlKClcclxuZXhwb3J0IGNsYXNzIERhdGFncmlkU2V0dGluZ3NTZXJ2aWNlIHtcclxuXHJcbiAgICBwcml2YXRlIG11bHRpU29ydE1zZyA9ICfliJfooajkuK3mnKrlvIDlkK/lpJrliJfmjpLluo/nmoTlip/og73jgIIg6K+35qOA5p+l77yBJztcclxuICAgIHByaXZhdGUgY29sdW1uc1NvcnRhYmxlTXNnID0gJ+acquW8gOWQr+WIl+eahOaOkuW6j+WKn+iDveOAguivt+ajgOafpe+8gSc7XHJcbiAgICBwcml2YXRlIG5vdFNob3dEaWFsb2cgPSAn5aSa6KGo5aS05pqC5LiN5pSv5oyB5YiX5pi+56S66K6+572u77yb5ZCM5pe25pyq5ZCv55So5YiX5o6S5bqP5Yqf6IO944CCJztcclxuXHJcbiAgICBwcml2YXRlIF9odHRwUmVzdFNlcnZpY2UgPSBudWxsO1xyXG5cclxuICAgIHByaXZhdGUgbGFuZ3VhZ2VzOiBhbnkgPSBbXTtcclxuXHJcbiAgICBnZXQgaHR0cFJlc3RTZXJ2aWNlKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9odHRwUmVzdFNlcnZpY2U7XHJcbiAgICB9O1xyXG5cclxuICAgIHNldCBodHRwUmVzdFNlcnZpY2UoaHR0cFNlcikge1xyXG4gICAgICAgIHRoaXMuX2h0dHBSZXN0U2VydmljZSA9IGh0dHBTZXI7XHJcblxyXG4gICAgICAgIGlmICh0aGlzLnNjaGVtZVNlcnZpY2UpIHtcclxuICAgICAgICAgICAgdGhpcy5zY2hlbWVTZXJ2aWNlLnNldFJlc3RTZXJ2aWNlKGh0dHBTZXIpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGdyaWRSZWZzOiB7W2tleTogc3RyaW5nXTogRGF0YWdyaWRDb21wb25lbnR9ID0gbnVsbDtcclxuICAgIHByaXZhdGUgYWN0aXZlU2NoZW1lSXRlbToge1tzY2hlbWVpZDogc3RyaW5nXTogYW55fSA9IG51bGw7XHJcblxyXG4gICAgcHJpdmF0ZSBzYXZpbmcgPSBmYWxzZTtcclxuICAgIHByaXZhdGUgY2ZyOiBDb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIgPSBudWxsO1xyXG4gICAgcHJpdmF0ZSBhcHA6IEFwcGxpY2F0aW9uUmVmID0gbnVsbDtcclxuICAgIHByaXZhdGUgc2NoZW1lTGlzdFN1YnNjcmlwdGlvbjogU3Vic2NyaXB0aW9uID0gbnVsbDtcclxuXHJcbiAgICBwcml2YXRlIHNjaGVtZVNlcnZpY2U6IERhdGFncmlkU2NoZW1lU2VydmljZTtcclxuICAgIHByaXZhdGUgbm90aWZ5U2VydmljZTogTm90aWZ5U2VydmljZTtcclxuXHJcbiAgICBwcml2YXRlIGNvbW1vblV0aWxzOiBDb21tb25VdGlscztcclxuXHJcbiAgICBwcml2YXRlIGN1cnJlbnRTY2hlbWVpdGVtID0gbnVsbDtcclxuICAgIHByaXZhdGUgcHJldlNjaGVtZUl0ZW0gPSBudWxsO1xyXG4gICAgcHJpdmF0ZSBkZWJ1Z1NlcjogRGVidWdTZXJ2aWNlID0gbnVsbDtcclxuXHJcbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIGluamVjdG9yOiBJbmplY3RvciwgcHJpdmF0ZSBtb2RhbFNlcjogQnNNb2RhbFNlcnZpY2UsXHJcbiAgICAgICAgICAgICAgICBwcml2YXRlIG1lc3NhZ2VyOiBNZXNzYWdlclNlcnZpY2UsIHByaXZhdGUgaWRTZXJ2aWNlOiBJZFNlcnZpY2UsXHJcbiAgICAgICAgICAgICAgICBwcml2YXRlIGxvY2FsZVNlcjogTG9jYWxlU2VydmljZSkge1xyXG5cclxuICAgICAgICB0aGlzLmNmciA9IHRoaXMuaW5qZWN0b3IuZ2V0KENvbXBvbmVudEZhY3RvcnlSZXNvbHZlcik7XHJcbiAgICAgICAgdGhpcy5hcHAgPSB0aGlzLmluamVjdG9yLmdldChBcHBsaWNhdGlvblJlZik7XHJcbiAgICAgICAgdGhpcy5ub3RpZnlTZXJ2aWNlID0gdGhpcy5pbmplY3Rvci5nZXQoTm90aWZ5U2VydmljZSwgbnVsbCk7XHJcbiAgICAgICAgdGhpcy5kZWJ1Z1NlciA9IHRoaXMuaW5qZWN0b3IuZ2V0KERlYnVnU2VydmljZSwgbnVsbCk7XHJcbiAgICAgICAgdGhpcy5jb21tb25VdGlscyA9IHRoaXMuaW5qZWN0b3IuZ2V0KENvbW1vblV0aWxzLCBuZXcgQ29tbW9uVXRpbHMoKSk7XHJcbiAgICAgICAgdGhpcy5zY2hlbWVTZXJ2aWNlID0gbmV3IERhdGFncmlkU2NoZW1lU2VydmljZSh0aGlzLmluamVjdG9yKTtcclxuXHJcbiBcclxuICAgICAgICB0aGlzLmxvY2FsZVNlci5zZXRMb2NhbGVEYXRhKERBVEFHUklEX1NFVFRJTkdTX0xPQ0FMRURBVEEpO1xyXG4gICAgfVxyXG5cclxuICAgIHNldFVyaVBlcmZpeFN0cihwZXJmaXhTdHI6IHN0cmluZykge1xyXG5cclxuICAgICAgICBpZiAocGVyZml4U3RyID09ICcnKSB7XHJcbiAgICAgICAgICAgIGlmICh3aW5kb3dbJ2dzcGZyYW1ld29ya1NlcnZpY2UnXSAmJiB3aW5kb3dbJ2dzcGZyYW1ld29ya1NlcnZpY2UnXS5jb21tb24pIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGJhc2VQYXRoID0gd2luZG93Wydnc3BmcmFtZXdvcmtTZXJ2aWNlJ10uY29tbW9uLmdldEJhc2VQYXRoO1xyXG4gICAgICAgICAgICAgICAgaWYgKGJhc2VQYXRoICYmIGJhc2VQYXRoLmdldCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHBlcmZpeFN0ciA9IGJhc2VQYXRoLmdldCgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAocGVyZml4U3RyICE9ICcnICYmIHBlcmZpeFN0ciAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICB0aGlzLnNjaGVtZVNlcnZpY2Uuc2V0VXJpUGVyZml4KHBlcmZpeFN0cik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgIH1cclxuXHJcbiAgICBkZXN0cm95KGlkPzogc3RyaW5nKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuZ3JpZFJlZnMpIHtcclxuICAgICAgICAgICAgaWYgKGlkICYmIHRoaXMuZ3JpZFJlZnNbaWRdKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmdyaWRSZWZzW2lkXSA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICBkZWxldGUgdGhpcy5ncmlkUmVmc1tpZF07XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoIU9iamVjdC5rZXlzKHRoaXMuZ3JpZFJlZnMpLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZ3JpZFJlZnMgPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuc2F2aW5nID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy5zZXRBY3RpdmVTY2hlbWVJdGVtKGlkLCBudWxsKTtcclxuICAgICAgICB0aGlzLnNjaGVtZVNlcnZpY2UuZGVzdG9yeShpZCk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSB3cml0ZURlYnVnTXNnKG1zZywgdHlwZSA9ICd3YXJuJykge1xyXG4gICAgICAgIGlmICh0aGlzLmRlYnVnU2VyKSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmRlYnVnU2VyW3R5cGVdKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmRlYnVnU2VyW3R5cGVdKG1zZyk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlW3R5cGVdKG1zZyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcmVnaXN0ZXJHcmlkSW5zdGFuY2UoZGc6IERhdGFncmlkQ29tcG9uZW50KSB7XHJcbiAgICAgICAgaWYgKCFkZykge1xyXG4gICAgICAgICAgICB0aGlzLndyaXRlRGVidWdNc2coJ0RhdGFncmlkU2V0dGluZ1NlcnZpY2U6IGdyaWQgaW5zdGFuY2UgaXMgbnVsbC4nKVxyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IGlkID0gZGcuaWQ7XHJcbiAgICAgICAgdGhpcy5ncmlkUmVmcyA9IHRoaXMuZ3JpZFJlZnMgfHwge307XHJcbiAgICAgICAgaWYgKCF0aGlzLmdyaWRSZWZzW2lkXSkge1xyXG4gICAgICAgICAgICB0aGlzLmdyaWRSZWZzW2lkXSA9IGRnO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBnZXRHcmlkSW5zdGFuY2UoZGdJRDogc3RyaW5nKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZ3JpZFJlZnMgPyB0aGlzLmdyaWRSZWZzW2RnSURdIDogbnVsbDtcclxuICAgIH1cclxuXHJcbiAgICAvKiog5pu05paw5pa55qGI5Lit55qE6YWN572u5pWw5o2uICovXHJcbiAgICBwcml2YXRlIHVwZGF0ZVNjaGVtZVNldHRpbmdzKHNjaGVtZUl0ZW06IERhdGFncmlkU2NoZW1lTW9kZWwsIHNldHRpbmdzOiBQYXJ0aWFsPFNldHRpbmdNb2RlbD4pIHtcclxuICAgICAgICBpZiAoc2NoZW1lSXRlbSAmJiBzZXR0aW5ncykge1xyXG4gICAgICAgICAgICBjb25zdCBzY2hlbWVDb250ZW50T2JqID0gc2NoZW1lSXRlbS5xdWVyeUNvbmRpdGlvblN0cmluZyA/IEpTT04ucGFyc2Uoc2NoZW1lSXRlbS5xdWVyeUNvbmRpdGlvblN0cmluZykgOiB7fTtcclxuICAgICAgICAgICAgaWYgKHNjaGVtZUNvbnRlbnRPYmopIHtcclxuICAgICAgICAgICAgICAgIGlmICggc2NoZW1lQ29udGVudE9ialt0aGlzLmxvY2FsZVNlci5sb2NhbGVJZF0pIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBzY2hlbWVTZXR0aW5ncyA9IHNjaGVtZUNvbnRlbnRPYmpbdGhpcy5sb2NhbGVTZXIubG9jYWxlSWRdIHx8IHt9O1xyXG4gICAgICAgICAgICAgICAgICAgIHNjaGVtZUNvbnRlbnRPYmpbdGhpcy5sb2NhbGVTZXIubG9jYWxlSWRdID0gT2JqZWN0LmFzc2lnbihzY2hlbWVTZXR0aW5ncywgc2V0dGluZ3MpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBzY2hlbWVDb250ZW50T2JqW3RoaXMubG9jYWxlU2VyLmxvY2FsZUlkXSA9ICBzZXR0aW5ncztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHNjaGVtZUl0ZW0ucXVlcnlDb25kaXRpb25TdHJpbmcgPSBKU09OLnN0cmluZ2lmeShzY2hlbWVDb250ZW50T2JqKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvKiog5pu05paw5b2T5YmN5pa55qGI6YWN572u5pWw5o2uICovXHJcbiAgICB1cGRhdGVBY3RpdmVTY2hlbWVJdGVtU2V0dGluZ3MoZGdJZDogc3RyaW5nLCBzZXR0aW5nczogUGFydGlhbDxTZXR0aW5nTW9kZWw+KSB7XHJcbiAgICAgICAgY29uc3Qgc2NoZW1lSXRlbSA9IHRoaXMuZ2V0QWN0aXZlU2NoZW1lSXRlbShkZ0lkKTtcclxuICAgICAgICB0aGlzLnVwZGF0ZVNjaGVtZVNldHRpbmdzKHNjaGVtZUl0ZW0sIHNldHRpbmdzKTtcclxuICAgICAgICBpZiAoc2NoZW1lSXRlbSkge1xyXG4gICAgICAgICAgICB0aGlzLnNjaGVtZVNlcnZpY2UudXBkYXRlU2NoZW1lRGF0YShkZ0lkLCBzY2hlbWVJdGVtKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLyoqIOiuvue9rua0u+WKqOeahOaWueahiCAqL1xyXG4gICAgc2V0QWN0aXZlU2NoZW1lSXRlbShkZ0lkOiBzdHJpbmcsIGFjdGl2ZUl0ZW06IGFueSkge1xyXG4gICAgICAgIGNvbnN0IHNjaGVtZWtleSA9IHRoaXMuc2NoZW1lU2VydmljZS5nZXRTY2hlbWVLZXkoZGdJZCk7XHJcbiAgICAgICAgdGhpcy5hY3RpdmVTY2hlbWVJdGVtID0gdGhpcy5hY3RpdmVTY2hlbWVJdGVtIHx8IHt9O1xyXG4gICAgICAgIGlmIChhY3RpdmVJdGVtKSB7XHJcbiAgICAgICAgICAgIHRoaXMuYWN0aXZlU2NoZW1lSXRlbVtzY2hlbWVrZXldID0gY2xvbmVEZWVwKGFjdGl2ZUl0ZW0pO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGRlbGV0ZSB0aGlzLmFjdGl2ZVNjaGVtZUl0ZW1bc2NoZW1la2V5XTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICAvKiog6I635Y+W5b2T5YmN5rS75Yqo55qE5pa55qGIICovXHJcbiAgICBnZXRBY3RpdmVTY2hlbWVJdGVtKGRnSWQ6IHN0cmluZyk6IERhdGFncmlkU2NoZW1lTW9kZWwge1xyXG4gICAgICAgIGNvbnN0IHNjaGVtZWtleSA9IHRoaXMuc2NoZW1lU2VydmljZS5nZXRTY2hlbWVLZXkoZGdJZCk7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuYWN0aXZlU2NoZW1lSXRlbSA/IHRoaXMuYWN0aXZlU2NoZW1lSXRlbVtzY2hlbWVrZXldIDogbnVsbDtcclxuICAgIH1cclxuXHJcbiAgICBnZXRTZWFyY2hUeXBlcygpIHtcclxuICAgICAgICByZXR1cm4gW1xyXG4gICAgICAgICAgICB7IHZhbHVlOiAnYWxsJywgdGl0bGU6IHRoaXMubG9jYWxlU2VyLmdldFZhbHVlKCdkYXRhZ3JpZC5zZXR0aW5ncy5hbGxDb2x1bW5zJykgfSxcclxuICAgICAgICAgICAgeyB2YWx1ZTogJ3Zpc2libGUnLCB0aXRsZTogdGhpcy5sb2NhbGVTZXIuZ2V0VmFsdWUoJ2RhdGFncmlkLnNldHRpbmdzLnZpc2libGVDb2x1bW5zJykgfSxcclxuICAgICAgICAgICAgeyB2YWx1ZTogJ2hpZGRlbicsIHRpdGxlOiB0aGlzLmxvY2FsZVNlci5nZXRWYWx1ZSgnZGF0YWdyaWQuc2V0dGluZ3MuaGlkZGVuQ29sdW1ucycpIH1cclxuICAgICAgICBdO1xyXG4gICAgfVxyXG5cclxuICAgIHNob3dTaW1wbGUoZ3JpZEluc3RhbmNlOiBEYXRhZ3JpZENvbXBvbmVudCwgc2V0dGluZ3M/OiBQYXJ0aWFsPFNldHRpbmdNb2RlbD4sIHNlbGVjdGVkU2NoZW1lSXRlbT86IERhdGFncmlkU2NoZW1lTW9kZWwpIHtcclxuICAgICAgICBsZXQgX2NvbHVtbnMgPSB0aGlzLmdldEN1cnJlbnRDb25maWdzKCkuY29sdW1ucyB8fCBncmlkSW5zdGFuY2UuY29sdW1ucztcclxuXHJcbiAgICAgICAgY29uc3QgY29sdW1ucyA9IHRoaXMuY29udmVydENvbHVtbnNUb1NpbXBsZShfY29sdW1ucyk7XHJcbiAgICAgICAgY29sdW1uc1swXSA9IFsuLi5jb2x1bW5zWzBdLmZpbHRlcihuID0+IG4uZmllbGQgJiYgbi5maWVsZCAhPT0gZ3JpZEluc3RhbmNlLkNvbnRyb2xQYW5lbEZlaWxkKV07XHJcblxyXG4gICAgICAgIGNvbnN0IHNlYXJjaFR5cGVzID0gdGhpcy5nZXRTZWFyY2hUeXBlcygpO1xyXG5cclxuICAgICAgICBpZiAodGhpcy5jZnIpIHtcclxuICAgICAgICAgICAgY29uc3QgY21wRmFjdG9yeSA9IHRoaXMuY2ZyLnJlc29sdmVDb21wb25lbnRGYWN0b3J5KFNpbXBsZUNvbHVtbnNDb21wb25lbnQpO1xyXG4gICAgICAgICAgICBsZXQgc2ltcGxlUmVmID0gY21wRmFjdG9yeS5jcmVhdGUodGhpcy5pbmplY3Rvcik7XHJcbiAgICAgICAgICAgIHRoaXMuYXBwLmF0dGFjaFZpZXcoc2ltcGxlUmVmLmhvc3RWaWV3KTtcclxuICAgICAgICAgICAgc2ltcGxlUmVmLmluc3RhbmNlLmNvbHVtbnMgPSBjb2x1bW5zO1xyXG4gICAgICAgICAgICBzaW1wbGVSZWYuaW5zdGFuY2Uuc2VhcnRUeXBlcyA9IHNlYXJjaFR5cGVzO1xyXG4gICAgICAgICAgICBzaW1wbGVSZWYuaW5zdGFuY2UuZ3JpZEluc3RhbmNlID0gZ3JpZEluc3RhbmNlO1xyXG5cclxuICAgICAgICAgICAgc2ltcGxlUmVmLmluc3RhbmNlLnNjaGVtZVNlciA9IHRoaXMuc2NoZW1lU2VydmljZTtcclxuXHJcbiAgICAgICAgICAgIGlmIChkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjcGFnZS13cmFwcGVyJykpIHtcclxuICAgICAgICAgICAgICAgIHNpbXBsZVJlZi5pbnN0YW5jZS50b3AgPSA3NjtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgc2ltcGxlUmVmLmluc3RhbmNlLmVuYWJsZVNjaGVtZSA9IGdyaWRJbnN0YW5jZS5lbmFibGVTY2hlbWU7XHJcblxyXG4gICAgICAgICAgICBpZiAoIXNldHRpbmdzKSB7XHJcbiAgICAgICAgICAgICAgICBzZXR0aW5ncyA9IHRoaXMuZ2V0Q3VycmVudENvbmZpZ3MoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgaWYgKGdyaWRJbnN0YW5jZS5lbmFibGVTY2hlbWUpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IF9jdXJyZW50U2NoZW10SXRlbSA9IHRoaXMuZ2V0QWN0aXZlU2NoZW1lSXRlbShncmlkSW5zdGFuY2UuaWQpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHNldHRpbmdzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gIOS7jumrmOe6p+aooeW8jyDovazliLAg566A5rSB5qih5byP5pe277yM5L+d5a2Y5Y6f5aeL5YC8XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFzaW1wbGVSZWYuaW5zdGFuY2VbJ3ByZXZTY2hlbWVJdGVtJ10gJiYgdGhpcy5wcmV2U2NoZW1lSXRlbSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzaW1wbGVSZWYuaW5zdGFuY2VbJ3ByZXZTY2hlbWVJdGVtJ10gPSBjbG9uZURlZXAodGhpcy5wcmV2U2NoZW1lSXRlbSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAoc2VsZWN0ZWRTY2hlbWVJdGVtKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlU2NoZW1lU2V0dGluZ3Moc2VsZWN0ZWRTY2hlbWVJdGVtLCBzZXR0aW5ncyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNpbXBsZVJlZi5pbnN0YW5jZS5jdXJyZW50U2NoZW1lSXRlbSA9IHNlbGVjdGVkU2NoZW1lSXRlbTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoX2N1cnJlbnRTY2hlbXRJdGVtKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmN1cnJlbnRTY2hlbWVpdGVtID0gX2N1cnJlbnRTY2hlbXRJdGVtO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wcmV2U2NoZW1lSXRlbSA9IGNsb25lRGVlcChfY3VycmVudFNjaGVtdEl0ZW0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2ltcGxlUmVmLmluc3RhbmNlLmN1cnJlbnRTY2hlbWVJdGVtID0gX2N1cnJlbnRTY2hlbXRJdGVtO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghT2JqZWN0LmtleXMoc2V0dGluZ3MpLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldHRpbmdzID0gdGhpcy5nZXRMb2NhbFNldHRpbmdzKHRoaXMuY3JlYXRlQ29uZmlnS2V5KGdyaWRJbnN0YW5jZS5pZCkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNpbXBsZVJlZi5pbnN0YW5jZS5jdXJyZW50U2NoZW1lSXRlbSA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaW1wbGVSZWYuaW5zdGFuY2Uuc2V0dGluZ3MgPSBzZXR0aW5ncztcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50U2NoZW1laXRlbSA9IF9jdXJyZW50U2NoZW10SXRlbTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnByZXZTY2hlbWVJdGVtID0gY2xvbmVEZWVwKF9jdXJyZW50U2NoZW10SXRlbSk7XHJcbiAgICAgICAgICAgICAgICAgICAgc2ltcGxlUmVmLmluc3RhbmNlLmN1cnJlbnRTY2hlbWVJdGVtID0gX2N1cnJlbnRTY2hlbXRJdGVtO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgaWYgKGdyaWRJbnN0YW5jZS5lbmFibGVTZXRNdWx0aUhlYWRlcnMpIHtcclxuICAgICAgICAgICAgICAgICAgICBzaW1wbGVSZWYuaW5zdGFuY2Uuc2V0dGluZ3MgPSB0aGlzLmdldEN1cnJlbnRDb25maWdzKCk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHNpbXBsZVJlZi5pbnN0YW5jZS5zZXR0aW5ncyA9IHNldHRpbmdzO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICAgICAgY29uc3QgekluZGV4ID0gdGhpcy5jb21tb25VdGlscy5nZXRGbG9hdGluZ0xheWVySW5kZXgoKTtcclxuICAgICAgICAgICAgc2ltcGxlUmVmLmxvY2F0aW9uLm5hdGl2ZUVsZW1lbnQuc3R5bGUuekluZGV4ID0gJycgKyB6SW5kZXg7XHJcblxyXG4gICAgICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHNpbXBsZVJlZi5sb2NhdGlvbi5uYXRpdmVFbGVtZW50KTtcclxuXHJcbiAgICAgICAgICAgIHNpbXBsZVJlZi5pbnN0YW5jZS5jYW5jZWxkLnN1YnNjcmliZSggKCkgPT57XHJcbiAgICAgICAgICAgICAgICB0aGlzLnJlc3RvcmVTY2hlbWUoZ3JpZEluc3RhbmNlKTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBzaW1wbGVSZWYuaW5zdGFuY2UuY2xvc2VkLnBpcGUoXHJcbiAgICAgICAgICAgICAgICBzd2l0Y2hNYXAoICgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoc2ltcGxlUmVmKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNpbXBsZVJlZi5pbnN0YW5jZS5jb250YWluZXIubmF0aXZlRWxlbWVudC5zdHlsZS5yaWdodCA9ICctNTAwcHgnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGltZXIoNTAwKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICApLnN1YnNjcmliZSgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBzaW1wbGVSZWYubG9jYXRpb24ubmF0aXZlRWxlbWVudC5yZW1vdmUoKTtcclxuICAgICAgICAgICAgICAgIHNpbXBsZVJlZi5kZXN0cm95KCk7XHJcbiAgICAgICAgICAgICAgICBzaW1wbGVSZWYgPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuc2NoZW1lTGlzdFN1YnNjcmlwdGlvbikge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2NoZW1lTGlzdFN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGNvbnN0IF9hY3RpdmVTY2hlbXRJdGVtID0gdGhpcy5nZXRBY3RpdmVTY2hlbWVJdGVtKGdyaWRJbnN0YW5jZS5pZCk7XHJcbiAgICAgICAgICAgICAgICBpZiAoKCF0aGlzLmN1cnJlbnRTY2hlbWVpdGVtIHx8IChfYWN0aXZlU2NoZW10SXRlbSAmJiBfYWN0aXZlU2NoZW10SXRlbS5pZCAhPT0gdGhpcy5jdXJyZW50U2NoZW1laXRlbS5pZCkpICYmIChfYWN0aXZlU2NoZW10SXRlbSAmJl9hY3RpdmVTY2hlbXRJdGVtLnF1ZXJ5Q29uZGl0aW9uU3RyaW5nKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IF9jdXJyZW50U2V0dGluZ3MgPSBKU09OLnBhcnNlKF9hY3RpdmVTY2hlbXRJdGVtLnF1ZXJ5Q29uZGl0aW9uU3RyaW5nKVt0aGlzLmxvY2FsZVNlci5sb2NhbGVJZF07XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKF9jdXJyZW50U2V0dGluZ3MpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29sdW1uc1swXS5mb3JFYWNoKGYgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZi52aXNpYmxlID0gX2N1cnJlbnRTZXR0aW5ncy52aWV3Q29sdW1ucy5pbmRleE9mKGYuZmllbGQpID4gLTE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0gICAgICBcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAvLyDmiZPlvIDpq5jnuqforr7nva7nqpflj6NcclxuICAgICAgICAgICAgc2ltcGxlUmVmLmluc3RhbmNlLmFkdmFuY2VkLnN1YnNjcmliZSgoeyB2aWV3RmllbGRzLCBzZXR0aW5ncywgY29sdW1ucyB9KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAvLyBpZiAodmlld0ZpZWxkcyAmJiB2aWV3RmllbGRzLmxlbmd0aCl7XHJcbiAgICAgICAgICAgICAgICAvLyAgICAgdGhpcy51cGRhdGVTY2hlbWVTZXR0aW5ncyhzaW1wbGVSZWYuaW5zdGFuY2UuY3VycmVudFNjaGVtZUl0ZW0sIHt2aWV3Q29sdW1uczogdmlld0ZpZWxkc30pO1xyXG4gICAgICAgICAgICAgICAgLy8gfVxyXG4gICAgICAgICAgICAgICAgdGhpcy5zZXRDdXJyZW50Q29uZmlncyh7Li4uc2V0dGluZ3MsIGNvbHVtbnN9KTtcclxuICAgICAgICAgICAgICAgIHRoaXMucHJldlNjaGVtZUl0ZW0gPSBzaW1wbGVSZWYuaW5zdGFuY2VbJ3ByZXZTY2hlbWVJdGVtJ107XHJcbiAgICAgICAgICAgICAgICB0aGlzWydTQ0hFTUVfREVGQVVMVF9USVRMRSddID0gc2ltcGxlUmVmLmluc3RhbmNlLmRlZmF1bHRTY2hlbWVOYW1lO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zaG93QWR2YW5jZWQoZ3JpZEluc3RhbmNlLCBudWxsLCBzaW1wbGVSZWYuaW5zdGFuY2UuY3VycmVudFNjaGVtZUl0ZW0pO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHNpbXBsZVJlZi5pbnN0YW5jZS5zdWJtaXQuc3Vic2NyaWJlKCAoZTogYW55KSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmFwcGx5U2V0dGluZ3MoZSwgZ3JpZEluc3RhbmNlKTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAvLyDlpJrooajliJforr7nva5cclxuICAgICAgICAgICAgc2ltcGxlUmVmLmluc3RhbmNlLnN1Ym1pdEZvckdyb3VwSGVhZGVyLnN1YnNjcmliZSgoZTogYW55KSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmFwcGx5U2V0dGluZ3MoZSwgZ3JpZEluc3RhbmNlKTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAvLyBzaW1wbGVSZWYuaW5zdGFuY2UuZmllbGRzQ2hhbmdlLnN1YnNjcmliZSgodmlzaWJsZUZpZWxkczogc3RyaW5nW10pID0+IHtcclxuICAgICAgICAgICAgLy8gICAgIHRoaXMudXBkYXRlQWN0aXZlU2NoZW1lSXRlbVNldHRpbmdzKGdyaWRJbnN0YW5jZS5pZCwge3ZpZXdDb2x1bW5zOiB2aXNpYmxlRmllbGRzfSlcclxuICAgICAgICAgICAgLy8gfSk7XHJcblxyXG4gICAgICAgICAgICAvLyDmiZPlvIDmlrDlop7mlrnmoYjnqpflj6NcclxuICAgICAgICAgICAgc2ltcGxlUmVmLmluc3RhbmNlLmFkZE5ld1NjaGVtZS5zdWJzY3JpYmUoKGU6IHsgdHlwZTogJ25ldycgfCAnc2F2ZWFzJ30pID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2hvd05ld1NjaGVtZURpYWxvZyhncmlkSW5zdGFuY2UsIGUsIHNpbXBsZVJlZi5pbnN0YW5jZS5jb2xsZWN0U2V0dGluZ3MoKSwge1xyXG4gICAgICAgICAgICAgICAgICAgIG9rOiAodDogYW55KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIOabtOaNouS4uuaWsOeahOaWueahiFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzaW1wbGVSZWYuaW5zdGFuY2Uub25TY2hlbWVJdGVtQ2xpY2sobnVsbCwgdCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNhdmVVc2VyQ29uZmlnXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgc2ltcGxlUmVmLmluc3RhbmNlLnNjaGVtZUxpc3QgPSB0aGlzLnNjaGVtZVNlcnZpY2UuZ2V0U3RhdGVWYWx1ZShncmlkSW5zdGFuY2UuaWQsICdsaXN0JykgfHwgW107XHJcblxyXG4gICAgICAgICAgICAvLyDmiZPlvIDmlrnmoYjnrqHnkIbliJfooajnqpflj6NcclxuICAgICAgICAgICAgc2ltcGxlUmVmLmluc3RhbmNlLnNob3dTY2hlbWVMaXN0LnN1YnNjcmliZSgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmdldFNjaGVtZUxpc3QoZ3JpZEluc3RhbmNlLmlkKS5waXBlKFxyXG4gICAgICAgICAgICAgICAgICAgIHN3aXRjaE1hcCgodCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5zY2hlbWVTZXJ2aWNlLmNoZWNrQXV0aG9yaXR5KCkucGlwZShcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hcCgoYXV0aDogU2NoZW1lQXV0aE1vZGVsKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlzdDogdCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLi4uYXV0aFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIClcclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgKS5zdWJzY3JpYmUoKHQ6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2NoZW1lU2VydmljZS5zZXRTY2hlbWVMaXN0KGdyaWRJbnN0YW5jZS5pZCwgdC5saXN0IHx8IFtdKTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dTY2hlbWVMaXN0RGlhbG9nKGdyaWRJbnN0YW5jZSwgY2xvbmVEZWVwKHQubGlzdCB8fCBbXSksIHQsIHNpbXBsZVJlZik7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICB0aGlzLnNjaGVtZUxpc3RTdWJzY3JpcHRpb24gPSB0aGlzLnNjaGVtZVNlcnZpY2Uuc2NoZW1lTGlzdCQuc3Vic2NyaWJlKChsaXN0OiBhbnkpID0+IHtcclxuICAgICAgICAgICAgICAgIHNpbXBsZVJlZi5pbnN0YW5jZS5zY2hlbWVMaXN0ID0gbGlzdDtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoIWxpc3QgfHwgIWxpc3QubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRBY3RpdmVTY2hlbWVJdGVtKGdyaWRJbnN0YW5jZS5pZCwgbnVsbCk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGNvbnN0IF9hY3RpdmVTY2hlbWVJdGVtID0gdGhpcy5nZXRBY3RpdmVTY2hlbWVJdGVtKGdyaWRJbnN0YW5jZS5pZCk7XHJcbiAgICAgICAgICAgICAgICBpZiAoX2FjdGl2ZVNjaGVtZUl0ZW0pIHtcclxuICAgICAgICAgICAgICAgICAgICBsZXQgaGFzQWN0aXZlSXRlbSA9IGxpc3QuZmluZChuID0+IG4uaWQgPT09IF9hY3RpdmVTY2hlbWVJdGVtLmlkKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIWhhc0FjdGl2ZUl0ZW0pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaGFzQWN0aXZlSXRlbSA9IHRoaXMuZ2V0RGVmYXVsdFNjaGVtZShsaXN0KTsgLy8g6I635Y+W6K6+572u5Li65b2T5YmN5pa55qGI55qE6aG5XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0QWN0aXZlU2NoZW1lSXRlbShncmlkSW5zdGFuY2UuaWQsIGhhc0FjdGl2ZUl0ZW0gfHwgbnVsbCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICBzaW1wbGVSZWYuaW5zdGFuY2UuY3VycmVudFNjaGVtZUl0ZW0gPSBoYXNBY3RpdmVJdGVtO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIC8vIOWIh+aNouaWueahiFxyXG4gICAgICAgICAgICBzaW1wbGVSZWYuaW5zdGFuY2Uuc2NoZW1lQ2hhbmdlZC5zdWJzY3JpYmUoKHQ6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50U2NoZW1laXRlbSA9IHQ7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNldEFjdGl2ZVNjaGVtZUl0ZW0oZ3JpZEluc3RhbmNlLmlkLCBjbG9uZURlZXAodCkpO1xyXG4gICAgICAgICAgICB9KVxyXG5cclxuICAgICAgICAgICAgc2ltcGxlUmVmLmhvc3RWaWV3LmRldGVjdENoYW5nZXMoKTtcclxuICAgICAgICAgICAgc2ltcGxlUmVmLmluc3RhbmNlLmNkLmRldGVjdENoYW5nZXMoKTtcclxuICAgICAgICAgICAgc2ltcGxlUmVmLmluc3RhbmNlLmNvbnRhaW5lci5uYXRpdmVFbGVtZW50LnN0eWxlLnJpZ2h0ID0gJzBweCc7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gc2ltcGxlUmVmO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcblxyXG4gICAgc2hvdyhncmlkSW5zdGFuY2U6IERhdGFncmlkQ29tcG9uZW50LCBvcHRzPzogTW9kYWxPcHRpb25zKSB7XHJcbiAgICAgICAgdGhpcy5yZWdpc3RlckdyaWRJbnN0YW5jZShncmlkSW5zdGFuY2UpO1xyXG5cclxuICAgICAgICBpZiAoZ3JpZEluc3RhbmNlLmVuYWJsZVNpbXBsZU1vZGUpIHtcclxuICAgICAgICAgICAgdGhpcy5zY2hlbWVTZXJ2aWNlLmNyZWF0ZVNjaGVtZVRhc2tJRCgpO1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5zaG93U2ltcGxlKGdyaWRJbnN0YW5jZSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuc2hvd0FkdmFuY2VkKGdyaWRJbnN0YW5jZSwgb3B0cyk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgcmVzdG9yZVNjaGVtZShncmlkSW5zdGFuY2UpIHtcclxuICAgICAgICBpZiAoZ3JpZEluc3RhbmNlLmVuYWJsZVNjaGVtZSkge1xyXG4gICAgICAgICAgICB0aGlzLnNldEFjdGl2ZVNjaGVtZUl0ZW0oZ3JpZEluc3RhbmNlLmlkLCB0aGlzLnByZXZTY2hlbWVJdGVtKTtcclxuICAgICAgICAgICAgaWYgKCF0aGlzLnByZXZTY2hlbWVJdGVtKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNldEN1cnJlbnRDb25maWdzKG51bGwpOyAgICBcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMuc2V0Q3VycmVudENvbmZpZ3MobnVsbCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgc2hvd0FkdmFuY2VkKGdyaWRJbnN0YW5jZTogRGF0YWdyaWRDb21wb25lbnQsIG9wdHM/OiBNb2RhbE9wdGlvbnMsIHNlbGVjdGVkU2NoZW1lSXRlbT86IERhdGFncmlkU2NoZW1lTW9kZWwpIHtcclxuICAgICAgICBsZXQgX2VkaXRDb2xTb3J0SW5mbyA9IHRydWU7XHJcbiAgICAgICAgY29uc3QgZWRpdENvbFNvcnRJbmZvID0gdGhpcy5jYW5TZXRDb2x1bW5Tb3J0KGdyaWRJbnN0YW5jZSk7XHJcbiAgICAgICAgaWYgKGVkaXRDb2xTb3J0SW5mbyAhPT0gdHJ1ZSkge1xyXG4gICAgICAgICAgICBfZWRpdENvbFNvcnRJbmZvID0gZmFsc2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyDliKTmlq3mmK/lkKbkuLrlpJrooajlpLRcclxuICAgICAgICBjb25zdCBzaG93U2V0Q29sdW1uc1RhYiA9ICFncmlkSW5zdGFuY2UuaXNNdWx0aUhlYWRlcigpIHx8IChncmlkSW5zdGFuY2UuaXNNdWx0aUhlYWRlcigpICYmIGdyaWRJbnN0YW5jZS5lbmFibGVTZXRNdWx0aUhlYWRlcnMpO1xyXG4gICAgICAgIGNvbnN0IGdldEFjdGl2ZVRhYkluZGV4ID0gKCkgPT4ge1xyXG4gICAgICAgICAgICBpZiAoc2hvd1NldENvbHVtbnNUYWIpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiAxO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgaWYgKF9lZGl0Q29sU29ydEluZm8pIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gMjtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIC0xO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgICAgICBjb25zdCBhY3RpdmVUYWJJbmRleCA9IGdldEFjdGl2ZVRhYkluZGV4KCk7XHJcblxyXG4gICAgICAgIGlmIChhY3RpdmVUYWJJbmRleCA9PT0gLTEpIHtcclxuICAgICAgICAgICAgdGhpcy5tZXNzYWdlci53YXJuaW5nKHRoaXMubm90U2hvd0RpYWxvZyk7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IGNvbHVtbnMgPSB0aGlzLmNvbnZlcnRDb2x1bW5zVG9TaW1wbGUodGhpcy5nZXRDdXJyZW50Q29uZmlncygpLmNvbHVtbnMgfHwgZ3JpZEluc3RhbmNlLmNvbHVtbnMpO1xyXG5cclxuICAgICAgICAvLyDojrflj5blvZPliY3mlrnmoYjkuK3lvZPliY3or63oqIDnmoTphY3nva7mlbDmja5cclxuICAgICAgICBsZXQgY3VycmVudFNldHRpbmdzOiBTZXR0aW5nTW9kZWwgPSB0aGlzLmdldEN1cnJlbnRDb25maWdzKCk7XHJcbiAgICAgICAgY29uc3QgbXVsdGlIZWFkZXJUcmVlID0gY3VycmVudFNldHRpbmdzICYmIGN1cnJlbnRTZXR0aW5ncy5tdWx0aUhlYWRlcnM/IGN1cnJlbnRTZXR0aW5ncy5tdWx0aUhlYWRlcnMudHJlZURhdGEgOiBudWxsO1xyXG4gICAgICAgIGlmIChzZWxlY3RlZFNjaGVtZUl0ZW0gJiYgc2VsZWN0ZWRTY2hlbWVJdGVtLnF1ZXJ5Q29uZGl0aW9uU3RyaW5nKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IF9jdXJyZW50U2V0dGluZ3MgPSBKU09OLnBhcnNlKHNlbGVjdGVkU2NoZW1lSXRlbS5xdWVyeUNvbmRpdGlvblN0cmluZylbdGhpcy5sb2NhbGVTZXIubG9jYWxlSWRdO1xyXG4gICAgICAgICAgICBjdXJyZW50U2V0dGluZ3MgPSBPYmplY3QuYXNzaWduKF9jdXJyZW50U2V0dGluZ3MgfHwge30sIGN1cnJlbnRTZXR0aW5ncyB8fCB7fSk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBpZiAoY3VycmVudFNldHRpbmdzLmNvbHVtbkZvcm1hdCAmJiBjdXJyZW50U2V0dGluZ3MuY29sdW1uRm9ybWF0Lmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgY29sdW1uc1swXSA9IGNvbHVtbnNbMF0ubWFwKChjb2wpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBmY29sID0gY3VycmVudFNldHRpbmdzLmNvbHVtbkZvcm1hdC5maW5kKG4gPT4gbi5maWVsZCA9PT0gY29sLmZpZWxkKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZmNvbCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb2wgPSBPYmplY3QuYXNzaWduKGNvbCwgZmNvbCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBjb2w7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgICAgICBcclxuICAgICAgICBpZiAoIWdyaWRJbnN0YW5jZS5lbmFibGVTZXRNdWx0aUhlYWRlcnMgJiYgY3VycmVudFNldHRpbmdzLnZpZXdDb2x1bW5zICYmIGN1cnJlbnRTZXR0aW5ncy52aWV3Q29sdW1ucy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgY29sdW1uc1swXS5mb3JFYWNoKGYgPT4ge1xyXG4gICAgICAgICAgICAgICAgZi52aXNpYmxlID0gY3VycmVudFNldHRpbmdzLnZpZXdDb2x1bW5zLmluZGV4T2YoZi5maWVsZCkgPiAtMTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIGNvbHVtbnNbMF0gPSBjb2x1bW5zWzBdLmZpbHRlcihuID0+IG4uZmllbGQgJiYgbi5maWVsZCAhPT0gZ3JpZEluc3RhbmNlLkNvbnRyb2xQYW5lbEZlaWxkKTtcclxuICAgICAgICBcclxuICAgICAgICBsZXQgc29ydEZpZWxkcyA9IGdldERhdGFGaWVsZHNGb3JNdWx0aUhlYWRlcnMoY2xvbmVEZWVwKGNvbHVtbnMpKS5maWx0ZXIoIChuOiBhbnkpID0+IG4uZmllbGQuaW5kZXhPZignZmFycmlzLWRhdGFncmlkLWNvbHVtbl8nKSA9PSAtMSAmJiBuLnNvcnRhYmxlKTtcclxuICAgICAgICBcclxuICAgICAgICBpZiAoZ3JpZEluc3RhbmNlLmVuYWJsZVNldE11bHRpSGVhZGVycyAmJiBjdXJyZW50U2V0dGluZ3MgJiYgY3VycmVudFNldHRpbmdzLm11bHRpSGVhZGVycyApIHtcclxuICAgICAgICAgICAgc29ydEZpZWxkcyA9IGdldERhdGFGaWVsZHNGb3JNdWx0aUhlYWRlcnMoY3VycmVudFNldHRpbmdzLm11bHRpSGVhZGVycy52aWV3Q29scykuZmlsdGVyKCAobjogYW55KSA9PiBuLmZpZWxkLmluZGV4T2YoJ2ZhcnJpcy1kYXRhZ3JpZC1jb2x1bW5fJykgPT0gLTEgJiYgbi5zb3J0YWJsZSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBjb25zdCB0cmVlRGF0YSA9IHRoaXMuY29udmVydENvbHVtbnMyVHJlZURhdGEoY2xvbmVEZWVwKGNvbHVtbnMpLCB0cnVlKTtcclxuICAgICAgICAvLyBjb25zdCB2aWV3Q29sdW1uc1RyZWVEYXRhID0gdGhpcy5jb252ZXJ0Q29sdW1uczJUcmVlRGF0YShjbG9uZURlZXAoY29sdW1ucyksIGZhbHNlKTtcclxuICAgICAgICAvLyB0aGlzLmNoZWNrVmlld1RyZWVOb2Rlcyh2aWV3Q29sdW1uc1RyZWVEYXRhKTtcclxuXHJcbiAgICAgICAgbGV0IG1vZGFsUmVmID0gbnVsbDtcclxuXHJcbiAgICAgICAgLy8gY29uc3Qgb2tUZXh0ID0gdGhpcy5sb2NhbGVTZXIuZ2V0VmFsdWUoJ2RhdGFncmlkLnNldHRpbmdzLm9rJykgfHwgJ+ehruWumic7XHJcbiAgICAgICAgLy8gY29uc3QgY2FuY2VsVGV4dCA9IHRoaXMubG9jYWxlU2VyLmdldFZhbHVlKCdkYXRhZ3JpZC5zZXR0aW5ncy5jYW5jZWwnKSB8fCAn5Y+W5raIJztcclxuICAgICAgICAvLyBjb25zdCByZXNldFRleHQgPSAgdGhpcy5sb2NhbGVTZXIuZ2V0VmFsdWUoJ2RhdGFncmlkLnNldHRpbmdzLnJlc2V0JykgfHwgJ+mHjee9ric7XHJcblxyXG4gICAgICAgIGNvbnN0IGRlZmF1bHRPcHRzID0ge1xyXG4gICAgICAgICAgICB3aWR0aDogNzYwLCBoZWlnaHQ6IDU2MCwgc2hvd0hlYWRlcjogZmFsc2UsIHRpdGxlOiAn5o6n5Yi26Z2i5p2/JyxcclxuICAgICAgICAgICAgaW5pdGlhbFN0YXRlOiB7XHJcbiAgICAgICAgICAgICAgICBjb2x1bW5zLFxyXG4gICAgICAgICAgICAgICAgc29ydFRyZWVEYXRhOiBzb3J0RmllbGRzLFxyXG4gICAgICAgICAgICAgICAgLy8gdmlld1RyZWVEYXRhOiB2aWV3Q29sdW1uc1RyZWVEYXRhLFxyXG4gICAgICAgICAgICAgICAgZ3JpZEluc3RhbmNlLFxyXG4gICAgICAgICAgICAgICAgY2FuU2V0Q29sdW1uU29ydDogX2VkaXRDb2xTb3J0SW5mbyxcclxuICAgICAgICAgICAgICAgIGNhblNldENvbHVtblZpc2libGU6IHNob3dTZXRDb2x1bW5zVGFiLFxyXG4gICAgICAgICAgICAgICAgYWN0aXZlVGFiSW5kZXgsXHJcbiAgICAgICAgICAgICAgICBzY2hlbWVJbmZvOiBjdXJyZW50U2V0dGluZ3MsXHJcbiAgICAgICAgICAgICAgICBlbmFibGVNdWx0aXBsZUhlYWRlcnM6IGdyaWRJbnN0YW5jZS5lbmFibGVTZXRNdWx0aUhlYWRlcnMsXHJcbiAgICAgICAgICAgICAgICBtdWx0aUhlYWRlcnM6IHtcclxuICAgICAgICAgICAgICAgICAgICBjb2x1bW5zLFxyXG4gICAgICAgICAgICAgICAgICAgIHRyZWVEYXRhOiBtdWx0aUhlYWRlclRyZWVcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBzY2hlbWVOYW1lOiBzZWxlY3RlZFNjaGVtZUl0ZW0/IHNlbGVjdGVkU2NoZW1lSXRlbVsnX3RpdGxlXyddIDogdGhpc1snU0NIRU1FX0RFRkFVTFRfVElUTEUnXVxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBzaG93QnV0dG9uczogZmFsc2UsXHJcbiAgICAgICAgICAgIGNsb3NlZDogKGlzQ2xvc2VCdG4sIG9wdHMpID0+IHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHtldmVudH0gPSBvcHRzO1xyXG4gICAgICAgICAgICAgICAgaWYgKGV2ZW50ICYmIGV2ZW50LmNvZGUgPT09ICdFc2NhcGUnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZXN0b3JlU2NoZW1lKGdyaWRJbnN0YW5jZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgICAgIGNvbnN0IG1vZGFsT3B0cyA9IE9iamVjdC5hc3NpZ24oZGVmYXVsdE9wdHMsIG9wdHMgfHwge30pO1xyXG5cclxuICAgICAgICBtb2RhbFJlZiA9IHRoaXMubW9kYWxTZXIuc2hvdyhEYXRhZ3JpZFNldHRpbmdzQ29tcG9uZW50LCBtb2RhbE9wdHMpO1xyXG4gICAgICAgIGNvbnN0IGluc3RhbmNlID0gbW9kYWxSZWYuY29udGVudCBhcyBEYXRhZ3JpZFNldHRpbmdzQ29tcG9uZW50O1xyXG4gICAgICAgIGluc3RhbmNlLmVuYWJsZVJlc2V0ID0gdHJ1ZTtcclxuICAgICAgICBpbnN0YW5jZS5tb2RhbFJlZiA9IG1vZGFsUmVmO1xyXG4gICAgICAgIGluc3RhbmNlLmNhblNldENvbHVtblNvcnQgPSBfZWRpdENvbFNvcnRJbmZvO1xyXG4gICAgICAgIGluc3RhbmNlLmNhblNldENvbHVtblZpc2libGUgPSBzaG93U2V0Q29sdW1uc1RhYjtcclxuXHJcbiAgICAgICAgaW5zdGFuY2Uuc3VibWl0SGFuZGxlLnN1YnNjcmliZSgoZSkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLmFwcGx5U2V0dGluZ3MoZSwgZ3JpZEluc3RhbmNlLCB7bW9kYWxSZWYsIGN1cnJlbnRTY2hlbWU6IHNlbGVjdGVkU2NoZW1lSXRlbX0pO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpbnN0YW5jZS5jYW5jZWxIYW5kbGUuc3Vic2NyaWJlKChlKSA9PiB7XHJcbiAgICAgICAgICAgIG1vZGFsUmVmLmNsb3NlKCk7XHJcbiAgICAgICAgICAgIHRoaXMucmVzdG9yZVNjaGVtZShncmlkSW5zdGFuY2UpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICAvLyDliIfmjaLliLDkvqfovrnmoI/nroDmtIHmqKHlvI9cclxuICAgICAgICBpbnN0YW5jZS5jb25jaXNlLnN1YnNjcmliZSgoZSkgPT4ge1xyXG4gICAgICAgICAgICBtb2RhbFJlZi5jbG9zZSgpO1xyXG4gICAgICAgICAgICBjb25zdCBzZXR0aW5ncyA9IG1vZGFsUmVmLmNvbnRlbnQ7XHJcbiAgICAgICAgICAgIGNvbnN0IHsgc29ydEluZm8sIHZpZXdDb2x1bW5zLCBjb2x1bW5Gb3JtYXQsIGdyb3VwRmllbGQsIG11bHRpSGVhZGVycyB9ID0gc2V0dGluZ3M7XHJcbiAgICAgICAgICAgIHRoaXMuc2V0Q3VycmVudENvbmZpZ3MoeyBzb3J0SW5mbywgdmlld0NvbHVtbnMsIGNvbHVtbkZvcm1hdCwgZ3JvdXBGaWVsZCwgbXVsdGlIZWFkZXJzIH0pO1xyXG4gICAgICAgICAgICB0aGlzLnNob3dTaW1wbGUoZ3JpZEluc3RhbmNlLCBcclxuICAgICAgICAgICAgICAgIHsgc29ydEluZm8sIHZpZXdDb2x1bW5zLCBjb2x1bW5Gb3JtYXQsIGdyb3VwRmllbGQsIG11bHRpSGVhZGVycyB9LCBcclxuICAgICAgICAgICAgICAgIGNsb25lRGVlcChzZWxlY3RlZFNjaGVtZUl0ZW0pKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgY29uc3QgbW9kYWxDb250YWluZXIgPSBtb2RhbFJlZi5kaWFsb2cuaW5zdGFuY2UgYXMgTW9kYWxDb250YWluZXJDb21wb25lbnQ7XHJcbiAgICAgICAgbW9kYWxDb250YWluZXIuZHJhZ2diYXIuaGFuZGxlID0gaW5zdGFuY2UuaGVhZGVyLm5hdGl2ZUVsZW1lbnQ7XHJcblxyXG4gICAgICAgIHJldHVybiBtb2RhbFJlZjtcclxuICAgIH1cclxuXHJcblxyXG5cclxuICAgIHByaXZhdGUgY2FuU2V0Q29sdW1uU29ydChncmlkSW5zdGFuY2U6IERhdGFncmlkQ29tcG9uZW50KSB7XHJcbiAgICAgICAgaWYgKGdyaWRJbnN0YW5jZS5tdWx0aVNvcnQgJiYgdGhpcy5oYXNFbmFibGVTb3J0Q29sdW1ucyhncmlkSW5zdGFuY2UpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGlmICghdGhpcy5oYXNFbmFibGVTb3J0Q29sdW1ucyhncmlkSW5zdGFuY2UpKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5jb2x1bW5zU29ydGFibGVNc2c7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoIWdyaWRJbnN0YW5jZS5tdWx0aVNvcnQpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLm11bHRpU29ydE1zZztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGhhc0VuYWJsZVNvcnRDb2x1bW5zKGdyaWRJbnN0YW5jZTogRGF0YWdyaWRDb21wb25lbnQpIHtcclxuICAgICAgICBjb25zdCBzb3J0Q29sdW1uc0NvdW50ID0gZ3JpZEluc3RhbmNlLmZsYXRDb2x1bW5zLnJlZHVjZSgoYywgcikgPT4ge1xyXG4gICAgICAgICAgICBpZiAoci5zb3J0YWJsZSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGMgKyAxO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBjO1xyXG4gICAgICAgIH0sIDApO1xyXG5cclxuICAgICAgICByZXR1cm4gc29ydENvbHVtbnNDb3VudCA+IDA7XHJcbiAgICB9XHJcblxyXG5cclxuICAgIC8vIHByaXZhdGUgZ2V0Q2hpbGRzKGNvbHMsIHJvd0luZGV4LCBjb2xTdGFydEluZGV4LCBjb2xDb3VudCwgZm9yU29ydCA9IGZhbHNlKSB7XHJcbiAgICAvLyAgICAgY29uc3QgY2hpbGRDb2xzID0gW107XHJcbiAgICAvLyAgICAgbGV0IF9jb3VudCA9IGNvbFN0YXJ0SW5kZXg7XHJcbiAgICAvLyAgICAgaWYgKCFjb2xzW3Jvd0luZGV4XSkge1xyXG4gICAgLy8gICAgICAgICByZXR1cm4gIFtdO1xyXG4gICAgLy8gICAgIH1cclxuXHJcbiAgICAvLyAgICAgY29sc1tyb3dJbmRleF0uc2xpY2UoKS5mb3JFYWNoKGVsZW1lbnQgPT4ge1xyXG4gICAgLy8gICAgICAgICBfY291bnQgPSBfY291bnQgKyBlbGVtZW50LmNvbHNwYW47XHJcbiAgICAvLyAgICAgICAgIGlmICggX2NvdW50IDw9IGNvbENvdW50ICkge1xyXG4gICAgLy8gICAgICAgICAgICAgY2hpbGRDb2xzLnB1c2goZWxlbWVudCk7XHJcbiAgICAvLyAgICAgICAgIH1cclxuICAgIC8vICAgICB9KTtcclxuXHJcbiAgICAvLyAgICAgY29sc1tyb3dJbmRleF0uc3BsaWNlKDAsIGNoaWxkQ29scy5sZW5ndGgpO1xyXG5cclxuICAgIC8vICAgICByZXR1cm4gY2hpbGRDb2xzLm1hcCgoYywgaSkgPT4ge1xyXG4gICAgLy8gICAgICAgICBsZXQgbjogYW55ID0ge1xyXG4gICAgLy8gICAgICAgICAgICAgZGF0YTogYyxcclxuICAgIC8vICAgICAgICAgICAgIHNlbGVjdGFibGU6IGZvclNvcnQgPyAhIWMuc29ydGFibGUgOiB0cnVlXHJcbiAgICAvLyAgICAgICAgIH07XHJcblxyXG4gICAgLy8gICAgICAgICBpZiAoYy5jb2xzcGFuICYmIGMuY29sc3BhbiA+IDEpIHtcclxuICAgIC8vICAgICAgICAgICAgIG4gPSB7XHJcbiAgICAvLyAgICAgICAgICAgICAgICAgZGF0YTogYyxcclxuICAgIC8vICAgICAgICAgICAgICAgICBzZWxlY3RhYmxlOiBmYWxzZSxcclxuICAgIC8vICAgICAgICAgICAgICAgICBleHBhbmRlZDogdHJ1ZSxcclxuICAgIC8vICAgICAgICAgICAgICAgICBjaGlsZHJlbjogdGhpcy5nZXRDaGlsZHMoY29scywgcm93SW5kZXggKyAxLCAwICwgYy5jb2xzcGFuKVxyXG4gICAgLy8gICAgICAgICAgICAgfTtcclxuICAgIC8vICAgICAgICAgfVxyXG4gICAgLy8gICAgICAgICByZXR1cm4gbjtcclxuICAgIC8vICAgICB9KTtcclxuICAgIC8vIH1cclxuICAgIC8vIGNvbnZlcnRDb2x1bW5zMlRyZWVEYXRhKGNvbHM6IERhdGFDb2x1bW5bXVtdLCBmb3JTb3J0ID0gZmFsc2UpIHtcclxuXHJcblxyXG5cclxuICAgIC8vICAgICBjb25zdCBjb2x1bW5zID0gY29scy5tYXAoKGM6IGFueSkgPT4ge1xyXG4gICAgLy8gICAgICAgICBjb25zdCBhYSA9IGMubWFwKChfKSA9PiB7XHJcbiAgICAvLyAgICAgICAgICAgICBpZiAoXy5maWVsZC5pbmRleE9mKCdmYXJyaXMtZGF0YWdyaWQtY29sdW1uXycpID09IC0xKSB7XHJcbiAgICAvLyAgICAgICAgICAgICAgICAgXy5jb2xzcGFuID0gXy5jb2xzcGFuIHx8IDE7XHJcbiAgICAvLyAgICAgICAgICAgICAgICAgcmV0dXJuIF87XHJcbiAgICAvLyAgICAgICAgICAgICB9XHJcbiAgICAvLyAgICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgIC8vICAgICAgICAgfSk7XHJcbiAgICAvLyAgICAgICAgIHJldHVybiBhYS5maWx0ZXIobiA9PiBuKTtcclxuICAgIC8vICAgICB9KTtcclxuICAgIC8vICAgICBpZiAoY29sdW1ucy5sZW5ndGggPT09IDEpIHtcclxuICAgIC8vICAgICAgICAgcmV0dXJuIGNvbHVtbnNbMF0ubWFwKGMgPT4ge1xyXG4gICAgLy8gICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgIC8vICAgICAgICAgICAgICAgICBkYXRhOiBjLFxyXG4gICAgLy8gICAgICAgICAgICAgICAgIHNlbGVjdGFibGU6IGZvclNvcnQgPyAhIWMuc29ydGFibGUgOiB0cnVlXHJcbiAgICAvLyAgICAgICAgICAgICB9O1xyXG4gICAgLy8gICAgICAgICB9KTtcclxuICAgIC8vICAgICB9IGVsc2Uge1xyXG4gICAgLy8gICAgICAgICByZXR1cm4gY29sdW1uc1swXS5tYXAoKGMsIGkpID0+IHtcclxuICAgIC8vICAgICAgICAgICAgIGlmIChjLmNvbHNwYW4gJiYgYy5jb2xzcGFuID4gMSkge1xyXG4gICAgLy8gICAgICAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAvLyAgICAgICAgICAgICAgICAgICAgIGRhdGE6IGMsXHJcbiAgICAvLyAgICAgICAgICAgICAgICAgICAgIHNlbGVjdGFibGU6IGZhbHNlLFxyXG4gICAgLy8gICAgICAgICAgICAgICAgICAgICBleHBhbmRlZDogdHJ1ZSxcclxuICAgIC8vICAgICAgICAgICAgICAgICAgICAgY2hpbGRyZW46IHRoaXMuZ2V0Q2hpbGRzKGNvbHVtbnMsIDEsIDAsIGMuY29sc3BhbiwgZm9yU29ydClcclxuICAgIC8vICAgICAgICAgICAgICAgICB9O1xyXG4gICAgLy8gICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgIC8vICAgICAgICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgLy8gICAgICAgICAgICAgICAgICAgICBkYXRhOiBjLFxyXG4gICAgLy8gICAgICAgICAgICAgICAgICAgICBzZWxlY3RhYmxlOiBmb3JTb3J0ID8gISFjLnNvcnRhYmxlIDogdHJ1ZVxyXG4gICAgLy8gICAgICAgICAgICAgICAgIH07XHJcbiAgICAvLyAgICAgICAgICAgICB9XHJcbiAgICAvLyAgICAgICAgIH0pO1xyXG4gICAgLy8gICAgIH1cclxuICAgIC8vIH1cclxuXHJcbiAgICAvLyBwcml2YXRlIGNoZWNrVmlld1RyZWVOb2Rlcyh0cmVlTm9kZXM6IFRyZWVOb2RlW10pIHtcclxuICAgIC8vICAgICB0cmVlTm9kZXMuZm9yRWFjaCgodG46IFRyZWVOb2RlKSA9PiB7XHJcbiAgICAvLyAgICAgICAgIGlmICghdG4uY2hpbGRyZW4gfHwgIXRuLmNoaWxkcmVuLmxlbmd0aCkge1xyXG4gICAgLy8gICAgICAgICAgICAgdG4uc2VsZWN0YWJsZSA9IHRydWU7XHJcbiAgICAvLyAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAvLyAgICAgICAgICAgICB0bi5zZWxlY3RhYmxlID0gZmFsc2U7XHJcbiAgICAvLyAgICAgICAgICAgICB0aGlzLmNoZWNrVmlld1RyZWVOb2Rlcyh0bi5jaGlsZHJlbik7XHJcbiAgICAvLyAgICAgICAgIH1cclxuICAgIC8vICAgICB9KTtcclxuICAgIC8vIH1cclxuXHJcbiAgICBwcml2YXRlIF9jb252ZXJ0Q29sdW1uc1RvU2ltcGxlKGdyaWRJbnN0YW5jZTogYW55KSB7XHJcblxyXG4gICAgICAgIGxldCBjb2xzID0gZ3JpZEluc3RhbmNlLmNvbHVtbnM7XHJcbiAgICAgICAgLy8g6YeN572u5YiX6aG65bqP5Li65pyA5Yid6K6+6K6h5pe255qE6aG65bqPXHJcbiAgICAgICAgY29uc3QgZ3JpZE9wdHMgPSBncmlkSW5zdGFuY2UuZGZzLl9zdGF0ZS5pbml0aWFsT3B0aW9ucztcclxuICAgICAgICBpZiAoZ3JpZE9wdHMuY29sdW1uRmllbGRzKSB7XHJcbiAgICAgICAgICAgIGxldCBkZXNnaW5Db2xzID0gZ3JpZE9wdHMuY29sdW1uRmllbGRzO1xyXG4gICAgICAgICAgICBjb25zdCBuZXdDb2x1bW5zID0gW107XHJcblxyXG4gICAgICAgICAgICBkZXNnaW5Db2xzLmZvckVhY2goYyA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAoYy5maWVsZCAhPT0gJ19kYXRhZ3JpZC1zZXR0aW5nLWNvbnRyb2xfJykge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvbCA9IGdyaWRJbnN0YW5jZS5jb2x1bW5zWzBdLmZpbmQoKG46IGFueSkgPT4gbi5maWVsZCA9PT0gYy5maWVsZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNvbCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBuZXdDb2x1bW5zLnB1c2goY29sKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgY29scyA9IFtuZXdDb2x1bW5zXTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBjb2xzO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnZlcnRDb2x1bW5zVG9TaW1wbGUoY29sczogYW55KSB7XHJcbiAgICAgICAgaWYgKCFBcnJheS5pc0FycmF5KGNvbHNbMF0pKSB7XHJcbiAgICAgICAgICAgIGNvbHMgPSBbY29sc107XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gY29scy5tYXAoIChfY29sczogRGF0YUNvbHVtbltdKSA9PiB7XHJcbiAgICAgICAgICAgIHJldHVybiBfY29scy5tYXAoIChjOiBEYXRhQ29sdW1uKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAoYy5maWVsZCAhPT0gJ19kYXRhZ3JpZC1zZXR0aW5nLWNvbnRyb2xfJykge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpZWxkOiBjLmZpZWxkLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogYy50aXRsZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29sc3BhbjogYy5jb2xzcGFuLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICByb3dzcGFuOiBjLnJvd3NwYW4sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNvcnRhYmxlOiBjLnNvcnRhYmxlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBvcmRlcjogYy5vcmRlcixcclxuICAgICAgICAgICAgICAgICAgICAgICAgaGFsaWduOiBjLmhhbGlnbiB8fCAnbGVmdCcsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFsaWduOiBjLmFsaWduIHx8ICdsZWZ0JyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmlzaWJsZTogYy52aXNpYmxlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBhbGxvd0dyb3VwaW5nOiBjLmFsbG93R3JvdXBpbmcsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGdyb3VwRm9vdGVyOiBjLmdyb3VwRm9vdGVyLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBmb290ZXI6IGMuZm9vdGVyLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB3aWR0aDogYy53aWR0aCB8fCAxMDAsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFUeXBlOiBjLmRhdGFUeXBlIHx8ICdzdHJpbmcnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBmaXhlZDogYy5maXhlZCB8fCAnVU5GSVhFRCdcclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KS5maWx0ZXIobiA9PiBuKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHJlc2V0R3JpZFZpZXcoZ3JpZEluc3RhbmNlOiBhbnkpIHtcclxuICAgICAgICBpZiAoIWdyaWRJbnN0YW5jZSkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IGRmcyA9IGdyaWRJbnN0YW5jZS5kZnM7XHJcbiAgICAgICAgaWYgKGRmcykge1xyXG4gICAgICAgICAgICBjb25zdCBvcHRpb25zID0gZGZzWydfc3RhdGUnXS5pbml0aWFsT3B0aW9ucztcclxuXHJcbiAgICAgICAgICAgIGlmIChvcHRpb25zLnNvcnQpIHtcclxuICAgICAgICAgICAgICAgIGlmIChvcHRpb25zLnNvcnQuc29ydE5hbWUpIHtcclxuICAgICAgICAgICAgICAgICAgICBncmlkSW5zdGFuY2Uuc29ydE5hbWUgPSBvcHRpb25zLnNvcnQuc29ydE5hbWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAob3B0aW9ucy5zb3J0LnNvcnRPcmRlcikge1xyXG4gICAgICAgICAgICAgICAgICAgIGdyaWRJbnN0YW5jZS5zb3J0T3JkZXIgPSBvcHRpb25zLnNvcnQuc29ydE9yZGVyO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBncmlkSW5zdGFuY2UuZ3JvdXBGaWVsZCA9IG9wdGlvbnMuZ3JvdXBGaWVsZCB8fCAnJztcclxuICAgICAgICAgICAgLy8gVE9ETzog6L+Y6ZyA6KaB5L+u5q2j6buY6K6k5YiX55qE5pi+56S66aG65bqPXHJcbiAgICAgICAgICAgIGlmIChvcHRpb25zLmNvbHVtbkZpZWxkcyAmJiBvcHRpb25zLmNvbHVtbkZpZWxkcy5sZW5ndGgpIHtcclxuXHJcbiAgICAgICAgICAgICAgICBjb25zdCBuZXdDb2x1bW5zID0gW107XHJcbiAgICAgICAgICAgICAgICBvcHRpb25zLmNvbHVtbkZpZWxkcy5mb3JFYWNoKGMgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvbCA9IGdyaWRJbnN0YW5jZS5jb2x1bW5zWzBdLmZpbmQoKG46IGFueSkgPT4gbi5maWVsZCA9PT0gYy5maWVsZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNvbCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb2wudmlzaWJsZSA9IGMudmlzaWJsZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29sLmhhbGlnbiA9IGMuaGFsaWduO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb2wuYWxpZ24gPSBjLmFsaWduO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb2wud2lkdGggPSBjLndpZHRoO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb2wuZm9vdGVyID0gYy5mb290ZXI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbC5ncm91cEZvb3RlciA9IGMuZ3JvdXBGb290ZXI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG5ld0NvbHVtbnMucHVzaChjb2wpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIGdyaWRJbnN0YW5jZS5jb2x1bW5zWzBdID0gbmV3Q29sdW1ucztcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gZ3JpZEluc3RhbmNlWydjaGVja09wdGlvbnMnXSgpO1xyXG4gICAgICAgICAgICBncmlkSW5zdGFuY2VbJ2NvbHVtbnNDaGFuZ2VkJ10oKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gXHJcblxyXG4gICAgcHJpdmF0ZSB1cGRhdGVHcmlkVmlldyhtb2RhbFJlZiwgZ3JpZEluc3RhbmNlLCBidG4gPSBudWxsLCBfc2NoZW1lID0gbnVsbCkge1xyXG4gICAgICAgIGNvbnN0IHNldHRpbmdzID0gbW9kYWxSZWYuY29udGVudDtcclxuXHJcbiAgICAgICAgaWYgKHNldHRpbmdzKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHsgc29ydEluZm8sIHZpZXdDb2x1bW5zLCBjb2x1bW5Gb3JtYXQsIGdyb3VwRmllbGQsIGV4cGFuZEdyb3VwUm93cywgbXVsdGlIZWFkZXJzIH0gPSBzZXR0aW5ncztcclxuICAgICAgICAgICAgY29uc3QgX2NvbGZvcm1hdHMgPSBjb2x1bW5Gb3JtYXQgPyB0aGlzLmNvbnZlcnRDb2x1bW5zVG9TaW1wbGUoY29sdW1uRm9ybWF0KVswXSA6IFtdO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgdGhpcy5zYXZpbmcgPSB0cnVlO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgbGV0IF9ncm91cEZpZWxkID0gJyc7XHJcbiAgICAgICAgICAgIGlmIChncmlkSW5zdGFuY2UuZ3JvdXBSb3dzICYmIGdyb3VwRmllbGQgJiYgZ3JvdXBGaWVsZC5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgZ3JvdXBGaWVsZCA9PT0gJ3N0cmluZycpIHtcclxuICAgICAgICAgICAgICAgICAgICBfZ3JvdXBGaWVsZCA9IGdyb3VwRmllbGQ7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYoQXJyYXkuaXNBcnJheShncm91cEZpZWxkKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIF9ncm91cEZpZWxkID0gZ3JvdXBGaWVsZC5qb2luKCcsJyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBsZXQgX3NvcnRJbmZvID0gc29ydEluZm87XHJcbiAgICAgICAgICAgIC8vIOW9k+WkmuihqOWktOmcgOimgea4heeQhuaOkuW6j+Wtl+auteS4juWIhue7hOWtl+aute+8jOS/neivgei/meS6m+Wtl+auteW/hemhu+WcqOihqOWktOS4rVxyXG4gICAgICAgICAgICBpZiAoZ3JpZEluc3RhbmNlLmVuYWJsZVNldE11bHRpSGVhZGVycyAmJiBtdWx0aUhlYWRlcnMpIHtcclxuICAgICAgICAgICAgICAgIGlmIChfZ3JvdXBGaWVsZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIF9ncm91cEZpZWxkID0gY2xlYW5Hcm91cEZpZWxkcyhtdWx0aUhlYWRlcnMudmlld0NvbHMsIF9ncm91cEZpZWxkLnNwbGl0KCcsJykpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGlmIChzb3J0SW5mbyAmJiBzb3J0SW5mby5zb3J0TmFtZSAmJiBzb3J0SW5mby5zb3J0TmFtZS5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICBfc29ydEluZm8gPSBjbGVhblNvcnRGaWVsZHMobXVsdGlIZWFkZXJzLnZpZXdDb2xzLCBzb3J0SW5mbyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBjb25zdCBzYXZlRGF0YSA9IHsgc29ydEluZm86IF9zb3J0SW5mbywgdmlld0NvbHVtbnMsIGdyb3VwRmllbGQ6IF9ncm91cEZpZWxkLCBjb2x1bW5Gb3JtYXQ6IF9jb2xmb3JtYXRzLCBleHBhbmRHcm91cFJvd3M6IGV4cGFuZEdyb3VwUm93cywgbXVsdGlIZWFkZXJzIH07XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgY29uc3QgcmVmcmVzaEdyaWQgPSAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAoZ3JpZEluc3RhbmNlLmdyb3VwUm93cykge1xyXG4gICAgICAgICAgICAgICAgICAgIGdyaWRJbnN0YW5jZS5leHBhbmRHcm91cFJvd3MgPSBleHBhbmRHcm91cFJvd3M7XHJcbiAgICAgICAgICAgICAgICAgICAgZ3JpZEluc3RhbmNlLmdyb3VwRmllbGQgPSBfZ3JvdXBGaWVsZDtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoZ3JpZEluc3RhbmNlLmVuYWJsZVNldE11bHRpSGVhZGVycykge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIOiuvue9ruihqOWktFxyXG4gICAgICAgICAgICAgICAgICAgIHJlZnJlc2hHcmlkQ29sdW1ucyhncmlkSW5zdGFuY2UsIG11bHRpSGVhZGVycy52aWV3Q29scyB8fCBbXSk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh2aWV3Q29sdW1ucyAmJiB2aWV3Q29sdW1ucy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZ3JpZEluc3RhbmNlLmNvbHVtbnMgPSBncmlkSW5zdGFuY2UuY29sdW1ucy5tYXAoY29scyA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZUNvbHVtbkZvcm1hdChjb2xzLCBjb2x1bW5Gb3JtYXQsIGdyaWRJbnN0YW5jZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5uZXdWaXNpYmxlT3JkZXJDb2x1bW5zKGNvbHMsIHZpZXdDb2x1bW5zLCBjb2x1bW5Gb3JtYXQsIGdyaWRJbnN0YW5jZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBncmlkSW5zdGFuY2UuY29sdW1uc0NoYW5nZWQodHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICBpZiAoc29ydEluZm8gJiYgT2JqZWN0LmtleXMoc29ydEluZm8pLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHsgc29ydE5hbWUsIHNvcnRPcmRlciB9ID0gc29ydEluZm87XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHNvcnROYW1lICYmIHNvcnROYW1lLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBncmlkSW5zdGFuY2Uuc29ydChzb3J0TmFtZS5qb2luKCcsJyksIHNvcnRPcmRlci5qb2luKCcsJykpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGdyaWRJbnN0YW5jZS5jbGVhclNvcnQoKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGdyaWRJbnN0YW5jZS5jbGVhclNvcnQoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgY29uc3Qgc2F2ZUN1cnJlbnQgPSAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNldFVzZXJDb25maWcoZ3JpZEluc3RhbmNlLmlkLCBzYXZlRGF0YSkuc3Vic2NyaWJlKCAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGJ0bikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBidG4uZGlzYWJsZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zYXZpbmcgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICByZWZyZXNoR3JpZCgpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNldEFjdGl2ZVNjaGVtZUl0ZW0oZ3JpZEluc3RhbmNlLmlkLCBfc2NoZW1lKTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnByZXZTY2hlbWVJdGVtID0gX3NjaGVtZTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZUFjdGl2ZVNjaGVtZUl0ZW1TZXR0aW5ncyhncmlkSW5zdGFuY2UuaWQsIHNhdmVEYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNldEN1cnJlbnRDb25maWdzKHNhdmVEYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICBtb2RhbFJlZi5jbG9zZSgpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgICAgICBpZiAoZ3JpZEluc3RhbmNlLnNob3dDb25maXJtV2hlblNjaGVtZUNoYW5nZWQgJiYgZ3JpZEluc3RhbmNlLmVuYWJsZVNjaGVtZSkge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgbGFuZ3VhZ2VSZXMgPSB0aGlzLmxvY2FsZVNlci5nZXRWYWx1ZSgnZGF0YWdyaWQtc2NoZW1lLnNjaGVtZUNoYW5nZWQnKVxyXG4gICAgICAgICAgICAgICAgY29uc3QgX2NoYW5nZWQgPSB0aGlzLnNjaGVtZVNlcnZpY2UuaXNTY2hlbWVDaGFuZ2VkKHNhdmVEYXRhLCBncmlkSW5zdGFuY2UuZW5hYmxlU2V0TXVsdGlIZWFkZXJzKTtcclxuICAgICAgICAgICAgICAgIGlmIChfY2hhbmdlZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG1zZ0RsZyA9IHRoaXMubWVzc2FnZXIucXVlc3Rpb24yKGxhbmd1YWdlUmVzLnRpdGxlLCBbXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6IGxhbmd1YWdlUmVzLmNhbmNlbCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsczogJ2J0biBidG4tbGlnaHQnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaGFuZGxlOiAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zYXZpbmcgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb2RhbFJlZi5jbG9zZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1zZ0RsZy5jbG9zZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucmVzdG9yZVNjaGVtZShncmlkSW5zdGFuY2UpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiBsYW5ndWFnZVJlcy5ubyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsczogJ2J0biBidG4tc2Vjb25kYXJ5JyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhhbmRsZTogKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIOS/neWtmOWIsOW9k+WJjeaWueahiFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1zZ0RsZy5jbG9zZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNhdmVDdXJyZW50KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6IGxhbmd1YWdlUmVzLnllcyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsczogJ2J0biBidG4tcHJpbWFyeScsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoYW5kbGU6ICgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyDlj6blrZjmlrDmlrnmoYhcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dOZXdTY2hlbWVEaWFsb2coZ3JpZEluc3RhbmNlLCB7dHlwZTogJ3NhdmVhcyd9LCBzYXZlRGF0YSwge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvazogKHQpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2F2aW5nID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb2RhbFJlZi5jbG9zZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50U2NoZW1laXRlbSA9IHQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNldEFjdGl2ZVNjaGVtZUl0ZW0oZ3JpZEluc3RhbmNlLmlkLCBjbG9uZURlZXAodCkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVmcmVzaEdyaWQoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FuY2VsOiAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNhdmluZyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGJ0bikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJ0bi5kaXNhYmxlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbXNnRGxnLmNsb3NlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgXSk7ICAvLyAsIGxhbmd1YWdlUmVzLnRpcHMg5a2Q5qCH6aKYXHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmN1cnJlbnRTY2hlbWVpdGVtICYmIHRoaXMucHJldlNjaGVtZUl0ZW0gJiYgdGhpcy5jdXJyZW50U2NoZW1laXRlbS5pZCA9PT0gdGhpcy5wcmV2U2NoZW1lSXRlbS5pZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNhdmluZyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBtb2RhbFJlZi5jbG9zZSgpOyAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlZnJlc2hHcmlkKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2F2ZUN1cnJlbnQoKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBzYXZlQ3VycmVudCgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIG1vZGFsUmVmLmNsb3NlKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuXHJcbiAgICBuZXdWaXNpYmxlT3JkZXJDb2x1bW5zKGNvbHM6IGFueSwgdmlld0NvbHVtbnM6IGFueSwgY29sdW1uRm9ybWF0OiBhbnksIGdyaWRJbnN0YW5jZTogYW55KSB7XHJcbiAgICAgICAgY29uc3QgaGlkZUNvbHVtbnMgPSBbXTtcclxuICAgICAgICBjb2xzLmZvckVhY2goKGVsZW1lbnQsIGluZGV4KSA9PiB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmlzTmV3QWRkQ29sdW1uKGVsZW1lbnQuZmllbGQsIGNvbHVtbkZvcm1hdCkgJiYgZWxlbWVudC5maWVsZCAhPT0gJ19kYXRhZ3JpZC1zZXR0aW5nLWNvbnRyb2xfJyAmJiAhZ3JpZEluc3RhbmNlLmVuYWJsZVNjaGVtZSkge1xyXG4gICAgICAgICAgICAgICAgdmlld0NvbHVtbnMucHVzaChlbGVtZW50LmZpZWxkKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGVsZW1lbnQudmlzaWJsZSA9IHZpZXdDb2x1bW5zLmluY2x1ZGVzKGVsZW1lbnQuZmllbGQpO1xyXG4gICAgICAgICAgICAgICAgaWYgKCFlbGVtZW50LnZpc2libGUpIHtcclxuICAgICAgICAgICAgICAgICAgICBoaWRlQ29sdW1ucy5wdXNoKGVsZW1lbnQpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIC8vIOa4heeQhuS4jeWtmOWcqOeahOWIl1xyXG4gICAgICAgIGxldCBuZXdDb2xzID0gdmlld0NvbHVtbnMubWFwKCBmaWVsZCA9PiB7XHJcbiAgICAgICAgICAgIHJldHVybiBjb2xzLmZpbmQoYyA9PiBjLmZpZWxkID09PSBmaWVsZCk7XHJcbiAgICAgICAgfSkuZmlsdGVyKG4gPT4gbik7XHJcblxyXG4gICAgICAgIGlmIChoaWRlQ29sdW1ucy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgbmV3Q29scyA9IG5ld0NvbHMuY29uY2F0KGhpZGVDb2x1bW5zKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBuZXdDb2xzLmZpbHRlcihjID0+IGMgJiYgYy5maWVsZCAmJiBjLmZpZWxkICE9PSAnX2RhdGFncmlkLXNldHRpbmctY29udHJvbF8nICk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDmmK/lkKbkuLrmlrDlop7liqDnmoTlrZfmrrVcclxuICAgICAqIOaWsOWinueahOWtl+aute+8jOmcgOimgeWcqOWIl+ihqOS4reWxleekuuWHuuadpe+8jOW5tuS/neWtmOWIsOS4quaAp+WMluiuvue9ruS4rVxyXG4gICAgICovXHJcbiAgICBwcml2YXRlIGlzTmV3QWRkQ29sdW1uKGZpZWxkOiBhbnksIGNvbHVtbnM6IGFueSkge1xyXG4gICAgICAgIGNvbHVtbnMgPSBjb2x1bW5zIHx8IFtdO1xyXG4gICAgICAgIHJldHVybiAhY29sdW1ucy5maW5kKGMgPT4gYy5maWVsZCA9PT0gZmllbGQpO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICB1cGRhdGVDb2x1bW5Gb3JtYXQoY29sczogYW55W10sIGNvbHVtbkZvcm1hdDogYW55W10sIGdyaWRJbnN0YW5jZSkge1xyXG4gICAgICAgIGlmIChjb2x1bW5Gb3JtYXQgJiYgY29sdW1uRm9ybWF0Lmxlbmd0aCkge1xyXG4gICAgICAgICAgICBjb2xzLmZvckVhY2goY29sID0+IHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGZvcm1hdENvbCA9IGNvbHVtbkZvcm1hdC5maW5kKGY9PiBmLmZpZWxkID09PSBjb2wuZmllbGQpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGZvcm1hdENvbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbC53aWR0aCA9IGZvcm1hdENvbC53aWR0aDtcclxuICAgICAgICAgICAgICAgICAgICBjb2wuaGFsaWduID0gZm9ybWF0Q29sLmhhbGlnbiB8fCAnbGVmdCc7XHJcbiAgICAgICAgICAgICAgICAgICAgY29sLmFsaWduID0gZm9ybWF0Q29sLmFsaWduIHx8ICdsZWZ0JztcclxuICAgICAgICAgICAgICAgICAgICBjb2wuZml4ZWQgPSBmb3JtYXRDb2wuZml4ZWQgPT09ICdVTkZJWEVEJz8gJyc6IGZvcm1hdENvbC5maXhlZDtcclxuICAgICAgICAgICAgICAgICAgICBjb2wudGl0bGUgPSBmb3JtYXRDb2wudGl0bGU7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChncmlkSW5zdGFuY2UuZ3JvdXBSb3dzICYmIChjb2wuYWxsb3dHcm91cGluZyB8fCBjb2wuYWxsb3dHcm91cGluZyA9PT0gdW5kZWZpbmVkKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWNvbC5ncm91cEZvb3Rlcikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sLmdyb3VwRm9vdGVyID0gZm9ybWF0Q29sLmdyb3VwRm9vdGVyO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoY29sLmdyb3VwRm9vdGVyICYmIGNvbC5ncm91cEZvb3Rlci5vcHRpb25zKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWZvcm1hdENvbC5ncm91cEZvb3Rlci5vcHRpb25zKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9ybWF0Q29sLmdyb3VwRm9vdGVyLm9wdGlvbnMgPSB7fTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbC5ncm91cEZvb3Rlci5vcHRpb25zLnRleHQgPSBmb3JtYXRDb2wuZ3JvdXBGb290ZXIub3B0aW9ucy50ZXh0IHx8ICcnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sLmdyb3VwRm9vdGVyLm9wdGlvbnMuY2FsY3VsYXRpb25UeXBlID1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtYXRDb2wuZ3JvdXBGb290ZXIub3B0aW9ucy5jYWxjdWxhdGlvblR5cGUgIT09IHVuZGVmaW5lZCAmJlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1hdENvbC5ncm91cEZvb3Rlci5vcHRpb25zLmNhbGN1bGF0aW9uVHlwZSAhPT0gbnVsbCA/XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VJbnQoZm9ybWF0Q29sLmdyb3VwRm9vdGVyLm9wdGlvbnMuY2FsY3VsYXRpb25UeXBlLCAxMCkgOiAtMTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGdyaWRJbnN0YW5jZS5zaG93Rm9vdGVyICYmICFncmlkSW5zdGFuY2UuZm9vdGVyVGVtcGxhdGUpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghY29sLmZvb3Rlcikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sLmZvb3RlciA9IGZvcm1hdENvbC5mb290ZXI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb2wuZm9vdGVyICYmIGNvbC5mb290ZXIub3B0aW9ucykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFmb3JtYXRDb2wuZm9vdGVyLm9wdGlvbnMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtYXRDb2wuZm9vdGVyLm9wdGlvbnMgPSB7fTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbC5mb290ZXIub3B0aW9ucy50ZXh0ID0gZm9ybWF0Q29sLmZvb3Rlci5vcHRpb25zLnRleHQgfHwgJyc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2wuZm9vdGVyLm9wdGlvbnMuY2FsY3VsYXRpb25UeXBlID1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtYXRDb2wuZm9vdGVyLm9wdGlvbnMuY2FsY3VsYXRpb25UeXBlICE9PSB1bmRlZmluZWQgJiZcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtYXRDb2wuZm9vdGVyLm9wdGlvbnMuY2FsY3VsYXRpb25UeXBlICE9PSBudWxsID9cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJzZUludChmb3JtYXRDb2wuZm9vdGVyLm9wdGlvbnMuY2FsY3VsYXRpb25UeXBlLCAxMCkgOiAtMTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8vIOWIm+W7uuWUr+S4gGtleSwg55SxdXJpICsgZ3JpZElkIOe7hOaIkO+8jOW5tua3t+a3hlxyXG4gICAgcHJpdmF0ZSBjcmVhdGVDb25maWdLZXkoZ3JpZElkOiBzdHJpbmcpIHtcclxuICAgICAgICBjb25zdCBncmlkID0gdGhpcy5nZXRHcmlkSW5zdGFuY2UoZ3JpZElkKTtcclxuICAgICAgICBpZiAoZ3JpZCkge1xyXG4gICAgICAgICAgICByZXR1cm4gZ3JpZC5kZ3MuY3JlYXRlQ29uZmlnS2V5KGdyaWRJZCk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy53cml0ZURlYnVnTXNnKCdEYXRhZ3JpZFNldHRpbmdTZXJ2aWNlOiBDYW4gbm90IGZpbmQgdGhlIGdyaWQgaW5zdGFuY2UuJyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgIH1cclxuXHJcblxyXG4gICAgcHJpdmF0ZSBnZXRDdXJyZW50VXNlclNldHRpbmdzKGdyaWRJZDogc3RyaW5nKSB7XHJcbiAgICAgICAgY29uc3QgZ3JpZEluc3RhbmNlID0gdGhpcy5nZXRHcmlkSW5zdGFuY2UoZ3JpZElkKTtcclxuICAgICAgICBjb25zdCBjb25maWcgPSB7c29ydEluZm86IHt9LCB2aWV3Q29sdW1uczogW10sIGdyb3VwRmllbGQ6ICcnLCBjb2x1bW5Gb3JtYXQ6IFtdfTtcclxuXHJcbiAgICAgICAgaWYgKGdyaWRJbnN0YW5jZSkge1xyXG4gICAgICAgICAgICBjb25zdCB7IHNvcnROYW1lLCBzb3J0T3JkZXIsIGNvbHVtbnN9ID0gZ3JpZEluc3RhbmNlO1xyXG4gICAgICAgICAgICBpZiAoc29ydE5hbWUpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHNvcnRJbmZvID0ge1xyXG4gICAgICAgICAgICAgICAgICAgIHNvcnROYW1lOiBzb3J0TmFtZS5zcGxpdCgnLCcpLFxyXG4gICAgICAgICAgICAgICAgICAgIHNvcnRPcmRlcjogc29ydE9yZGVyLnNwbGl0KCcsJylcclxuICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgY29uZmlnLnNvcnRJbmZvID0gc29ydEluZm87XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGNvbnN0IHZpZXdDb2x1bW5zID0gY29sdW1uc1swXS5maWx0ZXIobiA9PiBuLnZpc2libGUgfHwgbi52aXNpYmxlID09PSB1bmRlZmluZWQpLm1hcChuID0+IG4uZmllbGQpO1xyXG4gICAgICAgICAgICBjb25maWcudmlld0NvbHVtbnMgPSB2aWV3Q29sdW1ucztcclxuICAgICAgICAgICAgY29uZmlnLmNvbHVtbkZvcm1hdCA9IHRoaXMuY29udmVydENvbHVtbnNUb1NpbXBsZSh0aGlzLl9jb252ZXJ0Q29sdW1uc1RvU2ltcGxlKGdyaWRJbnN0YW5jZSkpWzBdO1xyXG5cclxuICAgICAgICAgICAgaWYgKGdyaWRJbnN0YW5jZS5ncm91cFJvd3MpIHtcclxuICAgICAgICAgICAgICAgIGNvbmZpZy5ncm91cEZpZWxkID0gZ3JpZEluc3RhbmNlLmdyb3VwRmllbGQ7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGNvbmZpZztcclxuICAgIH1cclxuXHJcblxyXG4gICAgc2F2ZVVzZXJDb25maWcoZ3JpZElkOiBzdHJpbmcpIHtcclxuICAgICAgICBjb25zdCBjb25maWcgPSB0aGlzLmdldEN1cnJlbnRVc2VyU2V0dGluZ3MoZ3JpZElkKTtcclxuICAgICAgICByZXR1cm4gdGhpcy5zZXRVc2VyQ29uZmlnKGdyaWRJZCwgY29uZmlnKTtcclxuICAgIH1cclxuXHJcbiAgICBzZXRVc2VyQ29uZmlnKGdyaWRJZDogc3RyaW5nLCBjb25maWc6IGFueSApOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgICAgIGNvbnN0IGdyaWRJbnMgPSB0aGlzLmdldEdyaWRJbnN0YW5jZShncmlkSWQpO1xyXG4gICAgICAgIGNvbnN0IGtleSA9IHRoaXMuY3JlYXRlQ29uZmlnS2V5KGdyaWRJZCk7XHJcbiAgICAgICAgY29uc3QgTE9DQUxFSUQgPSB0aGlzLmxvY2FsZVNlci5sb2NhbGVJZDtcclxuICAgICAgICBjb25zdCBjdXJyZW50Q29uZmlnID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oa2V5KTtcclxuICAgICAgICBjb25zdCBfY29uZmlnID0gKGN1cnJlbnRDb25maWcgPyBKU09OLnBhcnNlKGN1cnJlbnRDb25maWcpIDogeyB9KSB8fCB7fTtcclxuICAgICAgICBpZiAoY29uZmlnKSB7XHJcbiAgICAgICAgICAgIGlmIChfY29uZmlnKSB7XHJcbiAgICAgICAgICAgICAgICBfY29uZmlnW0xPQ0FMRUlEXSA9IGNvbmZpZztcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKGdyaWRJbnMgJiYgZ3JpZElucy5lbmFibGVTZXRNdWx0aUhlYWRlcnMpIHtcclxuICAgICAgICAgICAgICAgIF9jb25maWdbJ2lzTXVsdGlIZWFkZXInXSA9IHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKGtleSwgSlNPTi5zdHJpbmdpZnkoX2NvbmZpZykpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKGtleSk7XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgaWYgKHRoaXMuaHR0cFJlc3RTZXJ2aWNlKSB7XHJcbiAgICAgICAgICAgIGlmIChncmlkSW5zICYmIGdyaWRJbnMuZW5hYmxlU2NoZW1lKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBhY3RpdmVTY2hlbWUgPSB0aGlzLmdldEFjdGl2ZVNjaGVtZUl0ZW0oZ3JpZElkKTtcclxuICAgICAgICAgICAgICAgIGlmIChhY3RpdmVTY2hlbWUpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZVNjaGVtZVNldHRpbmdzKGFjdGl2ZVNjaGVtZSwgY29uZmlnKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoYWN0aXZlU2NoZW1lLnR5cGUgPT09ICdwcml2YXRlJykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5zY2hlbWVTZXJ2aWNlLnNhdmVTY2hlbWUoYWN0aXZlU2NoZW1lLCBncmlkSWQsIHRydWUsIGdyaWRJbnMuZW5hYmxlU2V0TXVsdGlIZWFkZXJzKTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5zY2hlbWVTZXJ2aWNlLmNoZWNrQXV0aG9yaXR5KCkucGlwZShcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaE1hcCgodDogU2NoZW1lQXV0aE1vZGVsKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHQuc3VjY2Vzcykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBoYXNPcmdBdXRob3JpdHkgPSB0LmF1dGhPcmdhbml6YXRpb25EYXRhICYmIHQuYXV0aE9yZ2FuaXphdGlvbkRhdGEubGVuZ3RoO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYWN0aXZlU2NoZW1lLnR5cGUgPT09ICdwdWJsaWMnIHx8IChhY3RpdmVTY2hlbWUudHlwZSA9PT0gJ29yZycgJiYgaGFzT3JnQXV0aG9yaXR5KSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuc2NoZW1lU2VydmljZS5zYXZlU2NoZW1lKGFjdGl2ZVNjaGVtZSwgZ3JpZElkLCB0cnVlLCBncmlkSW5zLmVuYWJsZVNldE11bHRpSGVhZGVycyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBvZih0cnVlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICApXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyDlpoLkuLrns7vnu5/pooTliLbml7bvvIzmjInml6DmlrnmoYjlpITnkIZcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fc2F2ZVVzZXJDb25maWcoa2V5LCAgY29uZmlnID8gX2NvbmZpZyA6ICAnJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gcmV0dXJuIG9mKHRydWUpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyDkv53lrZjoh7PmlbDmja7lupNcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3NhdmVVc2VyQ29uZmlnKGtleSwgIGNvbmZpZyA/IF9jb25maWcgOiAgJycpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIG9mKHRydWUpO1xyXG4gICAgfVxyXG5cclxuICAgIGdldFVzZXJDb25maWcoa2V5LCBpc011bHRpSGVhZGVyID0gZmFsc2UpOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgICAgIGlmICh0aGlzLmh0dHBSZXN0U2VydmljZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fZ2V0VXNlckNvbmZpZyhrZXksIGlzTXVsdGlIZWFkZXIpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiBvZih0aGlzLmdldExvY2FsU2V0dGluZ3Moa2V5LCBpc011bHRpSGVhZGVyKSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuXHJcbiAgICBnZXRMb2NhbFNldHRpbmdzKGtleTogc3RyaW5nLCBpc011bHRpSGVhZGVyID0gZmFsc2UpIHtcclxuICAgICAgICBjb25zdCBjb25maWcgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShrZXkpO1xyXG4gICAgICAgIGlmIChjb25maWcpIHtcclxuICAgICAgICAgICAgY29uc3QgY29uID0gSlNPTi5wYXJzZShjb25maWcpO1xyXG5cclxuICAgICAgICAgICAgaWYgKGlzTXVsdGlIZWFkZXIgJiYgIWNvblsnaXNNdWx0aUhlYWRlciddKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGlmIChjb25bJ2lzTXVsdGlIZWFkZXInXSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAoY29uW3RoaXMubG9jYWxlU2VyLmxvY2FsZUlkXSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGNvblt0aGlzLmxvY2FsZVNlci5sb2NhbGVJZF07XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoT2JqZWN0LmtleXMoY29uKS5pbmRleE9mKCd2aWV3Q29sdW1ucycpID4gLTEpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gY29uO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG5cclxuICAgIHByaXZhdGUgZ2V0RGVmYXVsdFNjaGVtZShzY2hlbWVMaXN0OiBBcnJheTxEYXRhZ3JpZFNjaGVtZU1vZGVsPikge1xyXG4gICAgICAgIC8vIDDjgIHov4fmu6Tlh7rlvZPliY3or63oqIDnmoTmlrnmoYjliJfooahcclxuICAgICAgICAvLyAx44CB5pyJ5Liq5Lq66buY6K6k55qE6L+U5Zue5Liq5Lq66buY6K6k5pa55qGIXHJcbiAgICAgICAgLy8gMuOAgeayoeacieS4quS6uum7mOiupOaWueahiOeahO+8jOi/lOWbnuWFrOWFseaWueahiOesrDHkuKpcclxuICAgICAgICAvLyAz44CB5rKh5pyJ5YWs5YWx5pa55qGI77yM6L+U5Zue57uE57uH5pa55qGI56ysMeS4qlxyXG4gICAgICAgIC8vIDTjgIHmsqHmnInnu4Tnu4fmlrnmoYjnmoQsIOi/lOWbnuS4quS6uuaWueahiOesrDHkuKpcclxuICAgICAgICAvLyA144CB5rKh5pyJ5Liq5Lq65pa55qGI55qE77yM6L+U5Zue57O757uf6aKE5Yi277yM5Y2z6KGo5Y2V6K6+6K6h5pe255qE5qC85byPXHJcbiAgICAgICAgc2NoZW1lTGlzdCA9IHNjaGVtZUxpc3QuZmlsdGVyKG4gPT4ge1xyXG4gICAgICAgICAgICByZXR1cm4gSlNPTi5wYXJzZShuLm5hbWUpW3RoaXMubG9jYWxlU2VyLmxvY2FsZUlkXVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIFxyXG4gICAgICAgIGxldCBkZWZhdWx0U2NoZW1lID0gbnVsbDtcclxuICAgICAgICBpZiAoIXNjaGVtZUxpc3QgfHwgIXNjaGVtZUxpc3QubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBkZWZhdWx0U2NoZW1lO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGRlZmF1bHRTY2hlbWUgPSBzY2hlbWVMaXN0LmZpbmQobiA9PiBuLmlzRGVmYXVsdCk7XHJcbiAgICAgICAgICAgIGlmICghZGVmYXVsdFNjaGVtZSkge1xyXG4gICAgICAgICAgICAgICAgbGV0IHB1YmxpY1NjaGVtZXMgPSBzY2hlbWVMaXN0LmZpbHRlcihuID0+IG4udHlwZSA9PT0gJ3B1YmxpYycpO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmICghcHVibGljU2NoZW1lcy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICBwdWJsaWNTY2hlbWVzID0gc2NoZW1lTGlzdC5maWx0ZXIobiA9PiBuLnR5cGUgPT09ICdvcmcnKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBpZiAocHVibGljU2NoZW1lcy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0U2NoZW1lID0gcHVibGljU2NoZW1lc1swXTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdFNjaGVtZSA9IHNjaGVtZUxpc3RbMF07XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBkZWZhdWx0U2NoZW1lO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICBnZXRTZXR0aW5ncyhncmlkSWQ6IHN0cmluZykge1xyXG4gICAgICAgIGNvbnN0IGtleSA9IHRoaXMuY3JlYXRlQ29uZmlnS2V5KGdyaWRJZCk7XHJcbiAgICAgICAgY29uc3QgZ3JpZElucyA9IHRoaXMuZ2V0R3JpZEluc3RhbmNlKGdyaWRJZCk7XHJcblxyXG4gICAgICAgIGxldCBzY2hlbWVMaXN0JCA9IG9mKFtdKTtcclxuICAgICAgICBpZiAoZ3JpZElucyAmJiBncmlkSW5zLmVuYWJsZVNjaGVtZSkge1xyXG4gICAgICAgICAgICBzY2hlbWVMaXN0JCA9IHRoaXMuZ2V0U2NoZW1lTGlzdChncmlkSWQpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIGZvcmtKb2luKHNjaGVtZUxpc3QkLCB0aGlzLmdldFVzZXJDb25maWcoa2V5KSwgdGhpcy5zY2hlbWVTZXJ2aWNlLmdldExhbmd1YWdlcygpKS5waXBlKFxyXG4gICAgICAgICAgICBtYXAoKFtzY2hlbWVMaXN0LCB1c2VyU2V0dGluZywgc3VwcG9ydGVkTGFuZ3VhZ2VzXSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgc2NoZW1lTGlzdCA9IHNjaGVtZUxpc3QgfHwgW107XHJcbiAgICAgICAgICAgICAgICB0aGlzLmxhbmd1YWdlcyA9IHN1cHBvcnRlZExhbmd1YWdlcztcclxuICAgICAgICAgICAgICAgIGlmICghc2NoZW1lTGlzdC5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdXNlclNldHRpbmc7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIOe8k+WtmOaWueahiOWIl+ihqFxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0U2NoZW1lTGlzdChzY2hlbWVMaXN0LCBncmlkSWQpO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIOafpeaJvum7mOiupOaWueahiFxyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGRlZmF1bHRTY2hlbWU6IERhdGFncmlkU2NoZW1lTW9kZWwgPSB0aGlzLmdldERlZmF1bHRTY2hlbWUoc2NoZW1lTGlzdCk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFkZWZhdWx0U2NoZW1lKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1c2VyU2V0dGluZztcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNldEFjdGl2ZVNjaGVtZUl0ZW0oZ3JpZElkLCBkZWZhdWx0U2NoZW1lKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHVzZXJTZXR0aW5ncyA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkZWZhdWx0U2NoZW1lLnF1ZXJ5Q29uZGl0aW9uU3RyaW5nKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2VyU2V0dGluZ3MgPSBKU09OLnBhcnNlKGRlZmF1bHRTY2hlbWUucXVlcnlDb25kaXRpb25TdHJpbmcpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh1c2VyU2V0dGluZ3MpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGxvY2FsZUlkID0gdGhpcy5sb2NhbGVTZXIubG9jYWxlSWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodXNlclNldHRpbmdzW2xvY2FsZUlkXSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKGtleSwgSlNPTi5zdHJpbmdpZnkodXNlclNldHRpbmdzKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVzZXJTZXR0aW5nc1tsb2NhbGVJZF07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJTZXR0aW5nc1tsb2NhbGVJZF0gPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKGtleSwgSlNPTi5zdHJpbmdpZnkodXNlclNldHRpbmdzKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSlcclxuICAgICAgICApO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICBwcml2YXRlIF9zYXZlVXNlckNvbmZpZyhrZXksIGNvbmZpZykge1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHVzZXJDb25maWdTZXR0aW5nID0ge1xyXG4gICAgICAgICAgICAgICAgY29uZmlna2V5MToga2V5LFxyXG4gICAgICAgICAgICAgICAgY29uZmlna2V5MjogJycsXHJcbiAgICAgICAgICAgICAgICBjb25maWdrZXkzOiAnJyxcclxuICAgICAgICAgICAgICAgIHRleHR2YWx1ZTogY29uZmlnID8gSlNPTi5zdHJpbmdpZnkoY29uZmlnKSA6ICAnJ1xyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuaHR0cFJlc3RTZXJ2aWNlLnNhdmVVc2VyU2V0dGluZ3ModXNlckNvbmZpZ1NldHRpbmcpO1xyXG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgdGhpcy53cml0ZURlYnVnTXNnKGUsICdlcnJvcicpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICByZXNldFVzZXJDb25maWcoZ3JpZEluc3RhbmNlLCBtb2RhbFJlZikge1xyXG4gICAgICAgIGNvbnN0IHJlc3RvckRlZmF1bHRUZXh0ID0gdGhpcy5sb2NhbGVTZXIuZ2V0VmFsdWUoJ2RhdGFncmlkLnNldHRpbmdzLnJlc3RvcmVEZWZhdWx0U2V0dGluZ3NUZXh0JykgfHwgJ+ehruiupOimgeaBouWkjem7mOiupOiuvue9ruWQl++8nyc7XHJcbiAgICAgICAgdGhpcy5tZXNzYWdlci5jb25maXJtKHJlc3RvckRlZmF1bHRUZXh0KS5waXBlKFxyXG4gICAgICAgICAgICBzd2l0Y2hNYXAoICh0OiBib29sZWFuKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAodCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnNldFVzZXJDb25maWcoZ3JpZEluc3RhbmNlLmlkLCAnJyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gb2YodCk7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgKS5zdWJzY3JpYmUoKHQ6IGJvb2xlYW4pID0+IHtcclxuICAgICAgICAgICAgaWYgKHQpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMucmVzZXRHcmlkVmlldyhncmlkSW5zdGFuY2UpO1xyXG4gICAgICAgICAgICAgICAgbW9kYWxSZWYuY2xvc2UoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgX2dldFVzZXJDb25maWcoa2V5LCBpc011bHRpSGVhZGVyID0gZmFsc2UpIHtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5odHRwUmVzdFNlcnZpY2UuZ2V0VXNlclNldHRpbmdzKGtleSkucGlwZShcclxuICAgICAgICAgICAgICAgIG1hcCgodWNzOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodWNzICYmIHVjcy50ZXh0VmFsdWUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGMgPSBKU09OLnBhcnNlKHVjcy50ZXh0VmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoYykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzTXVsdGlIZWFkZXIgJiYgIWNbJ2lzTXVsdGlIZWFkZXInXSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY1snaXNNdWx0aUhlYWRlciddKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY1t0aGlzLmxvY2FsZVNlci5sb2NhbGVJZF0pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShrZXksIHVjcy50ZXh0VmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjW3RoaXMubG9jYWxlU2VyLmxvY2FsZUlkXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY1t0aGlzLmxvY2FsZVNlci5sb2NhbGVJZF0gPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKGtleSwgSlNPTi5zdHJpbmdpZnkoYykpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMuZGVidWdTZXIpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZGVidWdTZXIuZXJyb3IoZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBidWlsZFN1Ym1pdERhdGEoZ3JpZElkOiBzdHJpbmcsIHNldHRpbmdzID0gbnVsbCkge1xyXG4gICAgICAgIGNvbnN0IExPQ0FMRUlEID0gdGhpcy5sb2NhbGVTZXIubG9jYWxlSWQ7XHJcbiAgICAgICAgaWYgKCFzZXR0aW5ncykge1xyXG4gICAgICAgICAgICBzZXR0aW5ncyA9IHRoaXMuZ2V0Q3VycmVudFVzZXJTZXR0aW5ncyhncmlkSWQpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCBsb2NhbGVLZXkgPSB0aGlzLmNyZWF0ZUNvbmZpZ0tleShncmlkSWQpO1xyXG4gICAgICAgIGNvbnN0IGN1cnJlbnRDb25maWcgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShsb2NhbGVLZXkpO1xyXG4gICAgICAgIGNvbnN0IF9jb25maWcgPSAoY3VycmVudENvbmZpZyA/IEpTT04ucGFyc2UoY3VycmVudENvbmZpZykgOiB7IH0pIHx8IHt9O1xyXG4gICAgICAgIGlmIChfY29uZmlnKSB7XHJcbiAgICAgICAgICAgIF9jb25maWdbTE9DQUxFSURdID0gc2V0dGluZ3M7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gX2NvbmZpZztcclxuICAgIH1cclxuXHJcbi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tIFxcXFxcclxuXHJcbiAgICBwcml2YXRlIHNob3dTY2hlbWVMaXN0RGlhbG9nKGdyaWRJbnN0YW5jZTogYW55LCBzY2hlbWVMaXN0OiBhbnksIGF1dGhJbmZvOiBTY2hlbWVBdXRoTW9kZWwsIHNpbXBsZVJlZjogYW55KSB7XHJcbiAgICAgICAgY29uc3QgbW9kYWxPcHRzID0ge1xyXG4gICAgICAgICAgICB3aWR0aDogNzYwLCBoZWlnaHQ6IDU3Nywgc2hvd0hlYWRlcjogZmFsc2UsIHRpdGxlOiAn5o6n5Yi26Z2i5p2/JyxcclxuICAgICAgICAgICAgaW5pdGlhbFN0YXRlOiB7XHJcbiAgICAgICAgICAgICAgICBpdGVtczogKHNjaGVtZUxpc3QgfHwgW10pLmZpbHRlcihuID0+IHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gSlNPTi5wYXJzZShuLm5hbWUpW3RoaXMubG9jYWxlU2VyLmxvY2FsZUlkXVxyXG4gICAgICAgICAgICAgICAgfSksXHJcbiAgICAgICAgICAgICAgICByZW1vdmVJdGVtOiBhdXRoSW5mby5zdWNjZXNzLFxyXG4gICAgICAgICAgICAgICAgY3VycmVudFVzZXJJZDogYXV0aEluZm8uY3VycmVudFVzZXJJZCxcclxuICAgICAgICAgICAgICAgIGN1cnJlbnRTY2hlbWVJZDogdGhpcy5jdXJyZW50U2NoZW1laXRlbSA/IHRoaXMuY3VycmVudFNjaGVtZWl0ZW0uaWQ6ICcnXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHNob3dCdXR0b25zOiBmYWxzZVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGNvbnN0IHNjaGVtZUxpc3REbGcgPSB0aGlzLm1vZGFsU2VyLnNob3coU2NoZW1lTGlzdENvbXBvbmVudCwgbW9kYWxPcHRzKTtcclxuICAgICAgICAvLyBzY2hlbWVMaXN0RGxnLmRpYWxvZy5sb2NhdGlvbi5uYXRpdmVFbGVtZW50LnN0eWxlLnpJbmRleCA9IDIwMzE7XHJcblxyXG4gICAgICAgIGNvbnN0IGluc3RhbmNlID0gc2NoZW1lTGlzdERsZy5jb250ZW50IGFzIFNjaGVtZUxpc3RDb21wb25lbnQ7XHJcbiAgICAgICAgaW5zdGFuY2UuY2xvc2VNb2RhbC5zdWJzY3JpYmUoICgpID0+IHtcclxuICAgICAgICAgICAgc2NoZW1lTGlzdERsZy5jbG9zZSgpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpbnN0YW5jZS5zdWJtaXRNb2RhbC5zdWJzY3JpYmUoKHQ6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLnNjaGVtZVNlcnZpY2UudXBkYXRlU2NoZW1lKHQsIGdyaWRJbnN0YW5jZS5pZCwgZ3JpZEluc3RhbmNlLmVuYWJsZVNldE11bHRpSGVhZGVycykuc3Vic2NyaWJlKChlOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgICAgIGlmKGUgPT09IGZhbHNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2NoZW1lTGlzdERsZy5jbG9zZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGNvbnN0IG1zZyA9ICfliJforr7nva7mlrnmoYjkv53lrZjmiJDlip/jgIInO1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMubm90aWZ5U2VydmljZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMubm90aWZ5U2VydmljZS5zdWNjZXNzKG1zZyk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMubWVzc2FnZXIuc3VjY2Vzcyhtc2cpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGlmKHQuZGVmYXVsdElkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2NoZW1lTGlzdC5mb3JFYWNoKG4gPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBuLmlzRGVmYXVsdCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAobi5pZCA9PT0gdC5kZWZhdWx0SWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG4uaXNEZWZhdWx0ID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRoaXMuc2V0QWN0aXZlU2NoZW1lSXRlbShncmlkSW5zdGFuY2UuaWQsIG4pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgbGV0IG5ld1NjaGVtZUxpc3QgPSBzY2hlbWVMaXN0O1xyXG4gICAgICAgICAgICAgICAgaWYgKHQuZGVsZXRlZElkcyAmJiB0LmRlbGV0ZWRJZHMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbmV3U2NoZW1lTGlzdCA9IHNjaGVtZUxpc3QuZmlsdGVyKG4gPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gIXQuZGVsZXRlZElkcy5pbmNsdWRlcyhuLmlkKVxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHRoaXMuc2NoZW1lU2VydmljZS5zZXRTY2hlbWVMaXN0KGdyaWRJbnN0YW5jZS5pZCwgbmV3U2NoZW1lTGlzdCk7XHJcbiAgICAgICAgICAgICAgICBzY2hlbWVMaXN0RGxnLmNsb3NlKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgY29uc3QgY3VycmVudFNjaGVtZSA9IHRoaXMuZ2V0QWN0aXZlU2NoZW1lSXRlbShncmlkSW5zdGFuY2UuaWQpO1xyXG4gICAgICAgICAgICAgICAgaWYgKCFjdXJyZW50U2NoZW1lKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRBY3RpdmVTY2hlbWVJdGVtKGdyaWRJbnN0YW5jZS5pZCwgbnVsbCk7XHJcbiAgICAgICAgICAgICAgICAgICAgc2ltcGxlUmVmLmluc3RhbmNlLmN1cnJlbnRTY2hlbWVJdGVtID0gbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICBzaW1wbGVSZWYuaW5zdGFuY2UucmVzZXRUb0RlZmF1bHQoKTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnByZXZTY2hlbWVJdGVtID0gbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICBzaW1wbGVSZWYuaW5zdGFuY2Uub25TdWJtaXRDbGljaygpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGNvbnN0IG1vZGFsQ29udGFpbmVyID0gc2NoZW1lTGlzdERsZy5kaWFsb2cuaW5zdGFuY2UgYXMgTW9kYWxDb250YWluZXJDb21wb25lbnQ7XHJcbiAgICAgICAgbW9kYWxDb250YWluZXIuZHJhZ2diYXIuaGFuZGxlID0gaW5zdGFuY2UuaGVhZGVyLm5hdGl2ZUVsZW1lbnQ7XHJcbiAgICB9XHJcblxyXG4gICAgLy8g5paw5aKe5oiW5Y+m5a2Y5pa55qGIXHJcbiAgICBwcml2YXRlIHNob3dOZXdTY2hlbWVEaWFsb2coZ3JpZEluc3RhbmNlLCBlOiB7IHR5cGU6ICduZXcnIHwgJ3NhdmVhcyd9LCBzZXR0aW5ncywgY2FsbGJhY2s6IE5ld1NjaGVtZUNhbGxCYWNrKSB7XHJcbiAgICAgICAgY29uc3QgbW9kYWxPcHRzID0ge1xyXG4gICAgICAgICAgICB3aWR0aDogNDgwLCBoZWlnaHQ6IDI2OSwgc2hvd0hlYWRlcjogZmFsc2UsIHRpdGxlOiAn5o6n5Yi26Z2i5p2/JyxcclxuICAgICAgICAgICAgaW5pdGlhbFN0YXRlOiB7XHJcbiAgICAgICAgICAgICAgICBsYW5ndWFnZXM6IHRoaXMubGFuZ3VhZ2VzXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHNob3dCdXR0b25zOiBmYWxzZSxcclxuICAgICAgICAgICAgcmVzaXphYmxlOiBmYWxzZVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGNvbnN0IG5ld1NjaGVtZURsZyA9IHRoaXMubW9kYWxTZXIuc2hvdyhOZXdTY2hlbWVDb21wb25lbnQsIG1vZGFsT3B0cyk7XHJcbiAgICAgICAgLy8gbmV3U2NoZW1lRGxnLmRpYWxvZy5sb2NhdGlvbi5uYXRpdmVFbGVtZW50LnN0eWxlLnpJbmRleCA9IDIwMzE7XHJcbiAgICAgICAgY29uc3QgaW5zdGFuY2UgPSBuZXdTY2hlbWVEbGcuY29udGVudCBhcyBOZXdTY2hlbWVDb21wb25lbnQ7XHJcbiAgICAgICAgaW5zdGFuY2UuY2xvc2VNb2RhbC5zdWJzY3JpYmUoICgpID0+IHtcclxuICAgICAgICAgICAgbmV3U2NoZW1lRGxnLmNsb3NlKCk7XHJcbiAgICAgICAgICAgIGlmIChjYWxsYmFjayAmJiBjYWxsYmFjay5jYW5jZWwpIHtcclxuICAgICAgICAgICAgICAgIGNhbGxiYWNrLmNhbmNlbCgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGluc3RhbmNlLnN1Ym1pdE1vZGFsLnBpcGUoXHJcbiAgICAgICAgICAgIHN3aXRjaE1hcCgodDogYW55KSA9PiB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5jcmVhdGVOZXdTY2hlbWUoZ3JpZEluc3RhbmNlLmlkLCB0LCBlLnR5cGUgPT09ICduZXcnLCBzZXR0aW5ncyk7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgKS5zdWJzY3JpYmUoKHQ6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICBpZiAodC5mbGFnID09PSBmYWxzZSkge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgbXNnID0gdC5tc2c7XHJcbiAgICAgICAgICAgICAgICBsZXQgX21zZyA9IG1zZztcclxuICAgICAgICAgICAgICAgIGlmIChtc2cpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAobXNnLmluZGV4T2YoJ3wnKSA+IC0xKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIF9tc2cgPSBtc2cuc3BsaXQoJ3wnKS5tYXAoKGxhbmdjb2RlKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5sb2NhbGVTZXIuZ2V0VmFsdWUoJ2RhdGFncmlkLXNldHRpbmdzLicrIGxhbmdjb2RlKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KS5qb2luKCcnKTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBfbXNnID0gdGhpcy5sb2NhbGVTZXIuZ2V0VmFsdWUoJ2RhdGFncmlkLXNldHRpbmdzLicrIG1zZyApO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5ub3RpZnlTZXJ2aWNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubm90aWZ5U2VydmljZS5pbmZvKF9tc2cpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubWVzc2FnZXIuaW5mbyhfbXNnKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLy8g5pu05paw5pa55qGI5YiX6KGoXHJcbiAgICAgICAgICAgIGNvbnN0IHNjaGVtZUxpc3QgPSB0aGlzLnNjaGVtZVNlcnZpY2UuZ2V0U3RhdGVWYWx1ZShncmlkSW5zdGFuY2UuaWQsICdsaXN0JykgfHwgW107XHJcbiAgICAgICAgICAgIGlmICh0LmlzRGVmYXVsdCkge1xyXG4gICAgICAgICAgICAgICAgc2NoZW1lTGlzdC5mb3JFYWNoKG4gPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIG4uaXNEZWZhdWx0ID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBzY2hlbWVMaXN0LnB1c2godCk7XHJcbiAgICAgICAgICAgIHRoaXMuc2NoZW1lU2VydmljZS5zZXRTY2hlbWVMaXN0KGdyaWRJbnN0YW5jZS5pZCwgc2NoZW1lTGlzdCk7XHJcbiAgICAgICAgICAgIGlmIChjYWxsYmFjayAmJiBjYWxsYmFjay5vaykge1xyXG4gICAgICAgICAgICAgICAgY2FsbGJhY2sub2sodCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgbmV3U2NoZW1lRGxnLmNsb3NlKCk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGluc3RhbmNlLmNoZWNrQXV0aG9yaXR5LnBpcGUoXHJcbiAgICAgICAgICAgIHN3aXRjaE1hcCgodDogYW55KSA9PiB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5zY2hlbWVTZXJ2aWNlLmNoZWNrQXV0aG9yaXR5KCkucGlwZShcclxuICAgICAgICAgICAgICAgICAgICBtYXAoKGF1dGg6IFNjaGVtZUF1dGhNb2RlbCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogdCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC4uLmF1dGhcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICApXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgKS5zdWJzY3JpYmUoKHQ6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICBsZXQgaGFzQXV0aG9yaXR5ID0geyBwdWJsaWM6IHRydWUsIG9yZzogdHJ1ZSB9O1xyXG4gICAgICAgICAgICAvLyDmgqjmsqHmnInlsIbmlrnmoYjnmoTkvb/nlKjojIPlm7Torr7nva7kuLrlhazlhbHnmoTmnYPpmZDjgIJcclxuICAgICAgICAgICAgbGV0IF9tc2cgPSAnbm9BdXRoLnB1YmxpYyc7XHJcbiAgICAgICAgICAgIGlmICh0LnR5cGUudmFsdWUgPT09ICdvcmcnKSB7XHJcbiAgICAgICAgICAgICAgICAvLyDmgqjmsqHmnInlsIbmlrnmoYjnmoTkvb/nlKjojIPlm7Torr7nva7kuLrnu4Tnu4fnmoTmnYPpmZDjgIJcclxuICAgICAgICAgICAgICAgIF9tc2cgPSAnbm9BdXRoLm9yZyc7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGNvbnN0IG1zZyA9IHRoaXMubG9jYWxlU2VyLmdldFZhbHVlKCdkYXRhZ3JpZC1zZXR0aW5ncy4nKyBfbXNnICk7XHJcbiAgICAgICAgICAgIGlmICh0LnN1Y2Nlc3MpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGhhc1B1YmxpY0F1dGhvcml0eSA9IHQuYXV0aE9wZXJhdGlvbkRhdGEgJiYgdC5hdXRoT3BlcmF0aW9uRGF0YS5sZW5ndGg7XHJcbiAgICAgICAgICAgICAgICBoYXNBdXRob3JpdHkucHVibGljID0gaGFzUHVibGljQXV0aG9yaXR5O1xyXG4gICAgICAgICAgICAgICAgY29uc3QgaGFzT3JnQXV0aG9yaXR5ID0gdC5hdXRoT3JnYW5pemF0aW9uRGF0YSAmJiB0LmF1dGhPcmdhbml6YXRpb25EYXRhLmxlbmd0aDtcclxuICAgICAgICAgICAgICAgIGhhc0F1dGhvcml0eS5vcmcgPSBoYXNPcmdBdXRob3JpdHk7XHJcbiAgICAgICAgICAgICAgICBpZiAodC50eXBlLnZhbHVlID09PSAncHVibGljJykge1xyXG4gICAgICAgICAgICAgICAgICAgIGluc3RhbmNlLnNjaGVtZUluZm8udHlwZSA9IHQudHlwZS52YWx1ZTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodC50eXBlLnZhbHVlID09PSAnb3JnJykge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICghaGFzT3JnQXV0aG9yaXR5KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubm90aWZ5U2VydmljZS53YXJuaW5nKG1zZyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfWVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpbnN0YW5jZS5zY2hlbWVJbmZvLnR5cGUgPSB0LnR5cGUudmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGluc3RhbmNlLnNjaGVtZUluZm8ub3JnaWRzID0gdC5hdXRoT3JnYW5pemF0aW9uRGF0YS5qb2luKCcsJylcclxuICAgICAgICAgICAgICAgICAgICAgICAgaW5zdGFuY2UuZGF0YVBlcm1pc3Npb25JZHMgPSB0LmF1dGhPcmdhbml6YXRpb25EYXRhO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRoaXMubm90aWZ5U2VydmljZS53YXJuaW5nKG1zZyk7XHJcbiAgICAgICAgICAgICAgICBoYXNBdXRob3JpdHkgPSB7IHB1YmxpYzogZmFsc2UsIG9yZzogZmFsc2UgfTs7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaW5zdGFuY2UucmVmcmVzaChoYXNBdXRob3JpdHkpO1xyXG4gICAgICAgIH0pXHJcblxyXG4gICAgICAgIGNvbnN0IG1vZGFsQ29udGFpbmVyID0gbmV3U2NoZW1lRGxnLmRpYWxvZy5pbnN0YW5jZSBhcyBNb2RhbENvbnRhaW5lckNvbXBvbmVudDtcclxuICAgICAgICBtb2RhbENvbnRhaW5lci5kcmFnZ2Jhci5oYW5kbGUgPSBpbnN0YW5jZS5oZWFkZXIubmF0aXZlRWxlbWVudDtcclxuICAgIH1cclxuXHJcbiAgICBnZXRTY2hlbWVMaXN0KGdyaWRJZDogc3RyaW5nKSB7XHJcbiAgICAgICAgY29uc3QgZ3JpZElucyA9IHRoaXMuZ2V0R3JpZEluc3RhbmNlKGdyaWRJZCk7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuc2NoZW1lU2VydmljZS5nZXRTY2hlbWVMaXN0KGdyaWRJZCwgZ3JpZElucy5lbmFibGVTZXRNdWx0aUhlYWRlcnMpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKiDmlrDlop7mlrnmoYhcclxuICAgICAqICBpc05ld1NjaGVtZe+8jOaYr+WQpuaWsOWKoOaWueahiO+8jOWQpuWImeS4uuWPpuWtmOS4ulxyXG4gICAgICogIGN1cnJlbnRTZXR0aW5nc++8miDlvZPliY3phY3nva7kv6Hmga9cclxuICAgICAqICBkYXRhOiDmlrDlu7rmlrnmoYjnqpflj6PkvKDpgJLmlbDmja5cclxuICAgICAqL1xyXG4gICAgY3JlYXRlTmV3U2NoZW1lKGdyaWRJZDogc3RyaW5nLCBkYXRhOiBhbnksIGlzTmV3U2NoZW1lID0gdHJ1ZSwgY3VycmVudFNldHRpbmdzOiBhbnkpIHtcclxuICAgICAgICBpZighZGF0YS5uYW1lKSB7XHJcbiAgICAgICAgICAgIC8vIG1zZyDor7fovpPlhaXmlrnmoYjlkI3np7BcclxuICAgICAgICAgICAgcmV0dXJuIG9mKHtmbGFnOiBmYWxzZSwgbXNnOiAncmVxdWlyZWQuc2NoZW1lTmFtZSd9KTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBjb25zdCBoYXNOYW1lID0gdGhpcy5zY2hlbWVTZXJ2aWNlLmhhc1NjaGVtZU5hbWUoZ3JpZElkLCBkYXRhLm5hbWUpO1xyXG5cclxuICAgICAgICAgICAgaWYgKHR5cGVvZiBoYXNOYW1lID09PSAnYm9vbGVhbicgJiYgaGFzTmFtZSkge1xyXG4gICAgICAgICAgICAgICAgLy8gbXNnICfmlrnmoYjlkI3np7Dlt7LlrZjlnKjvvIzor7fkv67mlLnjgIInXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gb2Yoe2ZsYWc6IGZhbHNlLCBtc2c6ICdoYXMuZXhpc3QnfSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShoYXNOYW1lKSAmJiBoYXNOYW1lLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICBjb25zdCBnZXRNZXNzYWdlQ29kZSA9IChsYW5nQ29kZSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChsYW5nQ29kZSA9PT0gJ3poLUNIUycpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICdoYXMuY2hzJzsgLy8g566A5L2T5Lit5paH5ZCN56ew5bey5a2Y5Zyo44CCXHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmKGxhbmdDb2RlID09PSAnemgtQ0hUJykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJ2hhcy5jaHQnOyAvLyDnuYHpq5TkuK3mloflkI3nqLHlt7LlrZjlnKjjgIJcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJ2hhcy5lbic7IC8vIOiLseaWh+WQjeensOW3suWtmOWcqFxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoaGFzTmFtZS5pbmNsdWRlcyh0aGlzLmxvY2FsZVNlci5sb2NhbGVJZCkpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBtc2cgPSBnZXRNZXNzYWdlQ29kZSh0aGlzLmxvY2FsZVNlci5sb2NhbGVJZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9mKHtmbGFnOiBmYWxzZSwgbXNnfSk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG1zZ3MgPSBoYXNOYW1lLm1hcChuID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGdldE1lc3NhZ2VDb2RlKG4pO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gb2Yoe2ZsYWc6IGZhbHNlLCBtc2c6IG1zZ3Muam9pbignfCcpfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IHJlcXVpcmVkTmFtZSA9IFtdO1xyXG5cclxuICAgICAgICBpZiAoIWRhdGEubmFtZVt0aGlzLmxvY2FsZVNlci5sb2NhbGVJZF0pIHtcclxuICAgICAgICAgICAgcmVxdWlyZWROYW1lLnB1c2godGhpcy5sb2NhbGVTZXIubG9jYWxlSWQpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gdGhpcy5sYW5ndWFnZXMuZm9yRWFjaChuID0+IHtcclxuICAgICAgICAvLyAgICAgaWYgKGRhdGEubmFtZVtuLmNvZGVdID09PSAnJyB8fCBkYXRhLm5hbWVbbi5jb2RlXSA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgLy8gICAgICAgICByZXF1aXJlZE5hbWUucHVzaChuLmNvZGUpO1xyXG4gICAgICAgIC8vICAgICB9XHJcbiAgICAgICAgLy8gfSk7XHJcblxyXG4gICAgICAgIGlmIChyZXF1aXJlZE5hbWUubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IG1zZ3MgPSByZXF1aXJlZE5hbWUubWFwKG4gPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKG4gPT09ICd6aC1DSFMnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICdyZXF1aXJlZC5jaHMnOyAvLyfor7fovpPlhaXnroDkvZPkuK3mloflkI3np7DjgIInO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmKG4gPT09ICd6aC1DSFQnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICdyZXF1aXJlZC5jaHQnOyAvLyfor7fovpPlhaXnuYHkvZPkuK3mloflkI3np7DjgIInO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gJ3JlcXVpcmVkLmVuJzsgLy8gJ+ivt+i+k+WFpeiLseaWh+WQjeensOOAgic7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICByZXR1cm4gb2Yoe2ZsYWc6IGZhbHNlLCBtc2c6IG1zZ3Muam9pbignfCcpfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoZGF0YS50eXBlICYmIGRhdGEudHlwZSA9PT0gJ29yZycgJiYgKCFkYXRhLm9yZ2lkcyB8fCAhZGF0YS5vcmdpZHMubGVuZ3RoKSkge1xyXG4gICAgICAgICAgICAvLyBtc2cgJ+ivt+mAieaLqee7hOe7hydcclxuICAgICAgICAgICAgcmV0dXJuIG9mKHtmbGFnOiBmYWxzZSwgbXNnOiAncmVxdWlyZWQub3JnJ30pO1xyXG4gICAgICAgIH1cclxuICAgICAgICBsZXQgX2NvbmZpZyA9IG51bGw7XHJcblxyXG4gICAgICAgIGlmICghaXNOZXdTY2hlbWUpIHtcclxuICAgICAgICAgICAgY29uc3QgTE9DQUxFSUQgPSB0aGlzLmxvY2FsZVNlci5sb2NhbGVJZDtcclxuXHJcbiAgICAgICAgICAgIGlmIChjdXJyZW50U2V0dGluZ3MgJiYgY3VycmVudFNldHRpbmdzLmNvbHVtbkZvcm1hdCkge1xyXG4gICAgICAgICAgICAgICAgY3VycmVudFNldHRpbmdzLmNvbHVtbkZvcm1hdCA9IHRoaXMuY29udmVydENvbHVtbnNUb1NpbXBsZShjdXJyZW50U2V0dGluZ3MuY29sdW1uRm9ybWF0KTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgX2NvbmZpZyA9eyBbTE9DQUxFSURdOiBjdXJyZW50U2V0dGluZ3MgfTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IG5ld0lkID0gdGhpcy5pZFNlcnZpY2UuZ3VpZCgpO1xyXG4gICAgICAgIGxldCBpc0RlZmF1bHQgPSBkYXRhLmlzRGVmYXVsdDtcclxuICAgICAgICBpZiAoaXNEZWZhdWx0KSB7XHJcbiAgICAgICAgICAgIGlmIChkYXRhLnR5cGUgIT09ICdwcml2YXRlJykge1xyXG4gICAgICAgICAgICAgICAgaXNEZWZhdWx0ID0gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChkYXRhLm5hbWUgJiYgdHlwZW9mIGRhdGEubmFtZSA9PT0gJ29iamVjdCcpIHtcclxuICAgICAgICAgICAgZGF0YS5uYW1lID0gSlNPTi5zdHJpbmdpZnkoZGF0YS5uYW1lKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IGdyaWRJbnN0YW5jZSA9IHRoaXMuZ2V0R3JpZEluc3RhbmNlKGdyaWRJZCk7XHJcbiAgICAgICAgaWYgKGdyaWRJbnN0YW5jZSAmJiBncmlkSW5zdGFuY2UuZW5hYmxlU2V0TXVsdGlIZWFkZXJzICYmIF9jb25maWcpIHtcclxuICAgICAgICAgICAgX2NvbmZpZ1snaXNNdWx0aUhlYWRlciddID0gZ3JpZEluc3RhbmNlLmVuYWJsZVNldE11bHRpSGVhZGVycztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IHNjaGVtZTogRGF0YWdyaWRTY2hlbWVNb2RlbCA9IHtcclxuICAgICAgICAgICAgaWQ6IG5ld0lkLFxyXG4gICAgICAgICAgICBiZWxvbmdJZDogJycsXHJcbiAgICAgICAgICAgIGNvZGU6ICcnLFxyXG4gICAgICAgICAgICBuYW1lOiBkYXRhLm5hbWUsXHJcbiAgICAgICAgICAgIHR5cGU6IGRhdGEudHlwZSxcclxuICAgICAgICAgICAgaXNEZWZhdWx0OiBpc0RlZmF1bHQsXHJcbiAgICAgICAgICAgIGlzU3lzdGVtOiBmYWxzZSxcclxuICAgICAgICAgICAgZXh0ZW5kSWQ6ICdkYXRhZ3JpZC1zZXR0aW5ncy1zY2hlbWUnLFxyXG4gICAgICAgICAgICBleHRlbmRJbmZvOiB0aGlzLmJ1aWxkT3JnQW5kU2NoZW1lUmVsYXRpb25zKG5ld0lkLCBkYXRhLm9yZ2lkcyksXHJcbiAgICAgICAgICAgIHF1ZXJ5Q29uZGl0aW9uU3RyaW5nOiBfY29uZmlnPyBKU09OLnN0cmluZ2lmeShfY29uZmlnKTogJycsXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHRoaXMuc2NoZW1lU2VydmljZS5zYXZlU2NoZW1lKHNjaGVtZSwgZ3JpZElkLCBmYWxzZSwgZ3JpZEluc3RhbmNlLmVuYWJsZVNldE11bHRpSGVhZGVycykucGlwZShcclxuICAgICAgICAgICAgbWFwKCgpID0+IHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBzY2hlbWU7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgKTtcclxuICAgIH1cclxuXHJcbiAgICBzZXRTY2hlbWVMaXN0KHNjaGVtZUxpc3Q6IERhdGFncmlkU2NoZW1lTW9kZWxbXSwgZ3JpZElkOiBzdHJpbmcpIHtcclxuICAgICAgICB0aGlzLnNjaGVtZVNlcnZpY2UudXBkYXRlKHtsaXN0OiBzY2hlbWVMaXN0fSwgZ3JpZElkKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGJ1aWxkT3JnQW5kU2NoZW1lUmVsYXRpb25zKHNjaGVtZUlkOiBzdHJpbmcsIG9yZ0lkczogYW55KSB7XHJcbiAgICAgICAgaWYgKCFvcmdJZHMgfHwgIW9yZ0lkcy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgcmV0dXJuICBbXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICAgICAgaWYgKHR5cGVvZiBvcmdJZHMgPT09ICdzdHJpbmcnKSB7XHJcbiAgICAgICAgICAgIG9yZ0lkcyA9IG9yZ0lkcy5zcGxpdCgnLCcpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIG9yZ0lkcy5tYXAobiA9PiB7XHJcbiAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICBpZDogdGhpcy5pZFNlcnZpY2UuZ3VpZCgpLFxyXG4gICAgICAgICAgICAgICAgb3JnSWQ6IG4sXHJcbiAgICAgICAgICAgICAgICByZWxhdGVkSWQ6IHNjaGVtZUlkXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGdldEN1cnJlbnRTY2hlbWVTZXR0aW5ncyhncmlkSWQ6IHN0cmluZyk6IFNldHRpbmdNb2RlbCB7XHJcbiAgICAgICAgY29uc3QgYWN0aXZlU2NoZW1lID0gdGhpcy5nZXRBY3RpdmVTY2hlbWVJdGVtKGdyaWRJZCkgYXMgRGF0YWdyaWRTY2hlbWVNb2RlbDtcclxuICAgICAgICBpZiAoYWN0aXZlU2NoZW1lICYmIGFjdGl2ZVNjaGVtZS5xdWVyeUNvbmRpdGlvblN0cmluZykge1xyXG4gICAgICAgICAgICByZXR1cm4gSlNPTi5wYXJzZShhY3RpdmVTY2hlbWUucXVlcnlDb25kaXRpb25TdHJpbmcpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxuXHJcbiAgICBzZXRDdXJyZW50Q29uZmlncyhzZXR0aW5nczogU2V0dGluZ01vZGVsKSB7XHJcbiAgICAgICAgdGhpc1snQ1VSUkVOVF9DT05GSUdTJ10gPSBzZXR0aW5ncztcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGdldEN1cnJlbnRDb25maWdzKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzWydDVVJSRU5UX0NPTkZJR1MnXSB8fCB7fTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGFwcGx5U2V0dGluZ3MoZTogYW55LCBncmlkSW5zdGFuY2U6IGFueSwgbW9kYWw/OiBhbnkpIHtcclxuICAgICAgICBlLnRhcmdldC5kaXNhYmxlZCA9IHRydWU7XHJcbiAgICAgICAgaWYgKHRoaXMuc2F2aW5nKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKCF0aGlzLnNhdmluZykge1xyXG4gICAgICAgICAgICBsZXQgX3NjaGVtZSwgZGxnO1xyXG4gICAgICAgICAgICBpZiAobW9kYWwpe1xyXG4gICAgICAgICAgICAgICAgY29uc3Qge21vZGFsUmVmLCBjdXJyZW50U2NoZW1lfSA9IG1vZGFsO1xyXG4gICAgICAgICAgICAgICAgZGxnID0gbW9kYWxSZWY7XHJcbiAgICAgICAgICAgICAgICBfc2NoZW1lID0gY3VycmVudFNjaGVtZTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGRsZyA9IGU7XHJcbiAgICAgICAgICAgICAgICBfc2NoZW1lID0gZS5jdXJyZW50U2NoZW1lO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB0aGlzLnVwZGF0ZUdyaWRWaWV3KGRsZywgZ3JpZEluc3RhbmNlLCBlLnRhcmdldCwgX3NjaGVtZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGdldE11bHRpSGVhZGVyQ29sdW1ucyh2aWV3Q29scywgZ3JpZEluaXRPcHRpb25zKSB7XHJcbiAgICAgICAgcmV0dXJuIG1lcmdldENvbHVtbk9wdGlvbnModmlld0NvbHMsIGdyaWRJbml0T3B0aW9ucylcclxuICAgIH1cclxufVxyXG4iXX0=
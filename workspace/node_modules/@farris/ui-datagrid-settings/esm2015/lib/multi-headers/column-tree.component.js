/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { ChangeDetectorRef, EventEmitter, Component, ElementRef, Injector, Input, NgZone, Output, Renderer2, TemplateRef, ViewChild, ViewEncapsulation } from "@angular/core";
import { of } from "rxjs";
import { BsModalService } from "@farris/ui-modal";
import { TreeTableComponent } from "@farris/ui-treetable";
import { NotifyService } from '@farris/ui-notify';
import { DatagridComponent } from '@farris/ui-datagrid';
import { NewHeaderFormComponent } from "./new-header.component";
import { SetColumnsComponent } from "./setcolumns.component";
import { columnsToTreeNodes } from "../mutli-headers.helper";
import { cloneDeep, flatten } from "lodash-es";
import { LocaleService } from "@farris/ui-locale";
export class ColumnTreeComponent {
    /**
     * @param {?} injector
     * @param {?} ngzone
     * @param {?} cd
     * @param {?} render
     * @param {?} modalService
     * @param {?} el
     * @param {?} notitySer
     */
    constructor(injector, ngzone, cd, render, modalService, el, notitySer) {
        this.injector = injector;
        this.ngzone = ngzone;
        this.cd = cd;
        this.render = render;
        this.modalService = modalService;
        this.el = el;
        this.notitySer = notitySer;
        this.options = {};
        this.inModal = false;
        this.nodeSelected = new EventEmitter();
        this.fields = [];
        this.treecols = [];
        this.treeData = [];
        this.contextMenus = [];
        /**
         * 值 __HOU_XUAN_LIE_ID__
         */
        this.HOU_XUAN_LIE_ID = '__HOU_XUAN_LIE_ID__';
        this.GROUP_HEADER_ICON = 'f-icon f-icon-file-folder-close';
        this.Hou_Xuan_Qu = { id: this.HOU_XUAN_LIE_ID, title: '(候选列)', houxuanquNode: true };
        this.languageRes = {
            title: '多表头',
            preview: '预览效果',
            tips: '在（候选列）中的字段，将不在列表中显示; 点击字段名称，在右侧显示相关操作按钮。',
            contextMenus: {
                new: '新建表头',
                newChild: '新建子级表头',
                setDataField: '分配数据列',
                rename: '重命名',
                top: '置顶',
                up: '上移',
                down: '下移',
                bottom: '置底',
                cancelGroup: '取消分组',
                remove: '在分组内移除'
            },
            candidate: '(候选列)',
            setHeader: '设为表头',
            ok: '确定',
            cancel: '取消',
            required: '请输入表头名称！',
            defaultGroupHeaderName: '分组表头1',
            newHeaderPlaceholder: '请输入名称',
            newHeaderLabel: '表头名称'
        };
        this.localeSer = null;
        /**
         * 移动命令项是否显示
         */
        this.moveMenuItemVisiblily = (/**
         * @param {?} t
         * @return {?}
         */
        (t) => {
            if (t) {
                /** @type {?} */
                const rowData = t.node.data;
                if (rowData) {
                    return rowData['id'] != this.HOU_XUAN_LIE_ID;
                }
                return true;
            }
            return true;
        });
        this.isGroupHeader = (/**
         * @param {?} t
         * @return {?}
         */
        (t) => {
            if (t) {
                /** @type {?} */
                const rowData = t.node.data;
                if (rowData) {
                    return !!rowData['groupHeader'];
                }
                return true;
            }
            return true;
        });
        this.onBeforeShowContextMenu = (/**
         * @param {?} t
         * @return {?}
         */
        (t) => {
            if (t && t.data.parents.indexOf(this.HOU_XUAN_LIE_ID) > -1) {
                // 待选区中的数据列禁用右键菜单
                return of({ show: false });
            }
            return of({ show: true });
        });
        this.localeSer = this.injector.get(LocaleService, null);
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        /** @type {?} */
        const groupHeaders = this.dg.dfs['_state'].initialOptions.groupHeaderFields;
        /** @type {?} */
        const allDataFields = flatten(groupHeaders).filter((/**
         * @param {?} col
         * @return {?}
         */
        (col) => !col.colspan || col.colspan == 1));
        this.fields = allDataFields.filter((/**
         * @param {?} n
         * @return {?}
         */
        n => n.field && n.field !== this.dg.ControlPanelFeild));
        // 树组件列信息
        this.treecols = [
            { field: 'title', title: '名称', template: this.cellTemp }
        ];
        this.languageRes = this.localeSer.getValue('headerGroup');
        this.Hou_Xuan_Qu.title = this.languageRes.candidate;
        this.initTreeData();
        this.initTreenodeContextMenus();
        this.listenTreeTableEvent();
    }
    /**
     * @param {?} changes
     * @return {?}
     */
    ngOnChanges(changes) {
        if (changes.options && !changes.options.isFirstChange()) {
            this.initTreeData();
            this.tt.clearSelections();
        }
    }
    /**
     * @return {?}
     */
    ngAfterViewInit() {
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
    }
    /**
     * @private
     * @return {?}
     */
    listenTreeTableEvent() {
        this.tt.removed.subscribe((/**
         * @param {?} rowNode
         * @return {?}
         */
        rowNode => {
            if (rowNode && rowNode.parent) {
                rowNode.parent.leaf = !(rowNode.parent.children && rowNode.parent.children.length);
                if (rowNode.parent.leaf) {
                    rowNode.parent.icon = this.GROUP_HEADER_ICON;
                }
            }
            if (!rowNode.node.data.groupHeader) {
                /** @type {?} */
                const hxl = this.getHouXuanNode();
                if (!rowNode.parent) {
                    this.treeData = this.treeData.filter((/**
                     * @param {?} n
                     * @return {?}
                     */
                    n => n.data.id !== rowNode.id));
                }
                this.tt.append(rowNode.node.data, hxl.node);
            }
        }));
    }
    /**
     * @private
     * @return {?}
     */
    initTreenodeContextMenus() {
        this.contextMenus = [
            { id: 1, title: this.languageRes.contextMenus.new, icon: 'f-icon f-icon-add',
                handle: (/**
                 * @param {?} t
                 * @return {?}
                 */
                (t) => {
                    // console.log(t);
                    this.addNewGroup(t.data, false);
                })
            },
            { id: 2, title: this.languageRes.contextMenus.newChild, visible: (/**
                 * @param {?} t
                 * @return {?}
                 */
                (t) => {
                    return this.isGroupHeader(t.data) && t.data.level + 1 < this.dg.maxMultiHeaders - 1;
                }),
                handle: (/**
                 * @param {?} t
                 * @return {?}
                 */
                (t) => {
                    this.addNewGroup(t.data, true);
                })
            },
            { id: 3, title: this.languageRes.contextMenus.setDataField, visible: (/**
                 * @param {?} t
                 * @return {?}
                 */
                (t) => { return this.isGroupHeader(t.data); }),
                handle: (/**
                 * @param {?} t
                 * @return {?}
                 */
                (t) => {
                    this.setColumnsForGroupHeader(null, t.data);
                })
            },
            { id: 31, title: this.languageRes.contextMenus.rename, icon: 'f-icon f-icon-edit',
                handle: (/**
                 * @param {?} t
                 * @return {?}
                 */
                (t) => {
                    this.resetHeaderName(null, t.data);
                })
            },
            '-',
            {
                id: 4, title: this.languageRes.contextMenus.top, icon: 'f-icon f-icon-roofing',
                visible: (/**
                 * @param {?} t
                 * @return {?}
                 */
                (t) => {
                    return this.moveMenuItemVisiblily(t.data);
                }),
                handle: (/**
                 * @param {?} t
                 * @return {?}
                 */
                (t) => {
                    this.moveTop(null, t.data);
                })
            },
            {
                id: 5, title: this.languageRes.contextMenus.up, icon: 'f-icon f-icon-arrow-chevron-up',
                visible: (/**
                 * @param {?} t
                 * @return {?}
                 */
                (t) => { return this.moveMenuItemVisiblily(t.data); }),
                handle: (/**
                 * @param {?} t
                 * @return {?}
                 */
                (t) => {
                    this.moveUp(null, t.data);
                })
            },
            {
                id: 6, title: this.languageRes.contextMenus.down, icon: 'f-icon f-icon-arrow-chevron-down',
                visible: (/**
                 * @param {?} t
                 * @return {?}
                 */
                (t) => { return this.moveMenuItemVisiblily(t.data); }),
                handle: (/**
                 * @param {?} t
                 * @return {?}
                 */
                (t) => {
                    this.moveDown(null, t.data);
                })
            },
            {
                id: 7, title: this.languageRes.contextMenus.bottom, icon: 'f-icon f-icon-bottomsetting',
                visible: (/**
                 * @param {?} t
                 * @return {?}
                 */
                (t) => { return this.moveMenuItemVisiblily(t.data); }),
                handle: (/**
                 * @param {?} t
                 * @return {?}
                 */
                (t) => {
                    this.moveBottom(null, t.data);
                })
            },
            '-',
            {
                id: 8, title: this.languageRes.contextMenus.remove, icon: 'f-icon f-icon-minus',
                visible: (/**
                 * @param {?} t
                 * @return {?}
                 */
                (t) => {
                    return !t.data.node.data.houxuanquNode && !t.data.node.data.groupHeader;
                }),
                handle: (/**
                 * @param {?} t
                 * @return {?}
                 */
                (t) => {
                    this.tt.remove(t.data.id);
                })
            },
            {
                id: 9, title: this.languageRes.contextMenus.cancelGroup, icon: 'f-icon f-icon-x',
                visible: (/**
                 * @param {?} t
                 * @return {?}
                 */
                (t) => {
                    return t.data.node.data.groupHeader;
                }),
                handle: (/**
                 * @param {?} t
                 * @return {?}
                 */
                (t) => {
                    this.removeGroup(null, t.data);
                })
            }
        ];
    }
    /**
     * @return {?}
     */
    initTreeData() {
        if (this.options) {
            const { treeData } = this.options;
            if (treeData) {
                this.treeData = treeData;
                return;
            }
        }
        if (this.options.columns && this.options.columns.length > 1) {
            /** @type {?} */
            const _treeData = columnsToTreeNodes(cloneDeep(this.options.columns));
            /** @type {?} */
            const houXuanLie = this.fields.filter((/**
             * @param {?} f
             * @return {?}
             */
            f => !flatten(this.options.columns).find((/**
             * @param {?} col
             * @return {?}
             */
            col => col.field === f.field)))).map((/**
             * @param {?} a
             * @return {?}
             */
            (a) => {
                return {
                    data: a,
                    children: [],
                    visible: true
                };
            }));
            _treeData.push({
                data: this.Hou_Xuan_Qu,
                children: houXuanLie,
                expanded: true
            });
            this.treeData = _treeData;
        }
        else {
            this.treeData = [{
                    data: { id: 'groupHeader_1', title: this.languageRes.defaultGroupHeaderName, halign: 'left', groupHeader: true },
                    children: this.fields.map((/**
                     * @param {?} n
                     * @param {?} i
                     * @return {?}
                     */
                    (n, i) => {
                        n['index'] = i;
                        n['id'] = n['field'];
                        return {
                            data: n,
                            children: [],
                            visible: true
                        };
                    })),
                    icon: this.GROUP_HEADER_ICON,
                    expanded: true, visible: true
                }, {
                    data: this.Hou_Xuan_Qu,
                    children: [],
                    expanded: true,
                    icon: this.GROUP_HEADER_ICON
                }];
        }
    }
    /**
     * @private
     * @return {?}
     */
    getHouXuanNode() {
        return this.tt.findRowNode(this.HOU_XUAN_LIE_ID);
    }
    /**
     * @param {?} $event
     * @return {?}
     */
    onTreeSelected($event) {
        this.nodeSelected.emit($event);
    }
    /**
     * @private
     * @param {?} okCallback
     * @param {?} dlgTitle
     * @return {?}
     */
    showNewHeaderDialog(okCallback, dlgTitle) {
        /** @type {?} */
        const modalRef = this.modalService.show(NewHeaderFormComponent, {
            title: dlgTitle,
            width: 340,
            height: 190,
            showMaxButton: false,
            resizable: false,
            initialState: {
                title: '',
                placeholder: this.languageRes.newHeaderPlaceholder,
                label: this.languageRes.newHeaderLabel
            },
            buttons: [
                {
                    text: this.languageRes.cancel,
                    cls: 'btn btn-secondary',
                    handle: (/**
                     * @return {?}
                     */
                    () => {
                        modalRef.close();
                    })
                },
                {
                    text: this.languageRes.ok,
                    cls: 'btn btn-primary',
                    handle: okCallback
                }
            ]
        });
        return modalRef;
    }
    /**
     * @private
     * @return {?}
     */
    generateGroupHeaderId() {
        return `groupHeader_${new Date().getTime()}`;
    }
    /**
     * @private
     * @param {?} rn
     * @param {?} title
     * @param {?=} child
     * @return {?}
     */
    createNewGroupHeader(rn, title, child = false) {
        /** @type {?} */
        const ghid = this.generateGroupHeaderId();
        /** @type {?} */
        const data = { id: ghid, title, groupHeader: true, halign: 'left', fixed: 'UNFIXED' };
        /** @type {?} */
        const gh = {
            data,
            children: [],
            expanded: true,
            visible: true,
            icon: this.GROUP_HEADER_ICON,
        };
        if (!child) {
            if (!rn.parent) {
                /** @type {?} */
                const i = this.treeData.findIndex((/**
                 * @param {?} n
                 * @return {?}
                 */
                n => n.data.id === rn.id)) + 1;
                this.treeData.splice(i, 0, gh);
                this.treeData = this.treeData.slice();
            }
            else {
                gh.data.fixed = rn.parent.data.fixed;
                this.tt.appendChildren([gh], rn.parent);
            }
        }
        else {
            gh.data.fixed = rn.node.data.fixed;
            this.tt.appendChildren([gh], rn.node);
        }
    }
    // 删除分组
    /**
     * @param {?} event
     * @param {?} rowNode
     * @return {?}
     */
    removeGroup(event, rowNode) {
        if (this.tt.selectedRow && rowNode.id === this.tt.selectedRow.id) {
            this.nodeSelected.emit(null);
        }
        /** @type {?} */
        const childs = this.tt.serializedValue.filter((/**
         * @param {?} n
         * @return {?}
         */
        n => n.parents.indexOf(rowNode.id) > -1 && !n.node.data.groupHeader)).map((/**
         * @param {?} n
         * @return {?}
         */
        n => n.node));
        this.treeData = this.treeData.filter((/**
         * @param {?} n
         * @return {?}
         */
        n => n.data.id !== rowNode.id));
        this.tt.remove(rowNode.id);
        this.tt.appendChildren(childs, this.getHouXuanNode().node);
    }
    // 新增分组
    /**
     * @param {?} rn
     * @param {?=} child
     * @return {?}
     */
    addNewGroup(rn, child = false) {
        /** @type {?} */
        const modalRef = this.showNewHeaderDialog((/**
         * @return {?}
         */
        () => {
            /** @type {?} */
            const ghfRef = (/** @type {?} */ (modalRef.content));
            if (ghfRef.title) {
                if (!rn || rn.id === this.HOU_XUAN_LIE_ID) {
                    this.treeData.splice(0, 0, {
                        data: {
                            id: this.generateGroupHeaderId(), halign: 'left',
                            title: ghfRef.title, groupHeader: true, fixed: 'UNFIXED'
                        },
                        icon: this.GROUP_HEADER_ICON,
                        children: []
                    });
                    this.tt.updateSerializedValue();
                }
                else {
                    this.createNewGroupHeader(rn, ghfRef.title, child);
                }
                modalRef.close();
            }
            else {
                this.notitySer.info(this.languageRes.required);
                ghfRef.input.nativeElement.focus();
            }
        }), child ? this.languageRes.contextMenus.newChild : this.languageRes.contextMenus.new);
    }
    // 显示更新按钮
    /**
     * @param {?} $event
     * @param {?} nodeData
     * @return {?}
     */
    onMoreBtnClick($event, nodeData) {
        if (nodeData && nodeData.id) {
            this.tt.selectNode(nodeData.id);
        }
        this.tt.ctxMenu.onContextMenu($event);
    }
    /**
     * @private
     * @param {?} rowNode
     * @return {?}
     */
    getCanSelectColumns(rowNode) {
        // 可分配列
        // 候选区数据 + 子节点
        // 可分配列
        // 候选区数据 + 子节点
        /** @type {?} */
        const hxl = this.getHouXuanNode();
        /** @type {?} */
        let fields = rowNode ? rowNode.node.children : [];
        fields = fields.filter((/**
         * @param {?} n
         * @return {?}
         */
        (n) => !n.data.groupHeader));
        return hxl.node.children.concat(fields).map((/**
         * @param {?} n
         * @return {?}
         */
        n => n.data));
    }
    /**
     * @private
     * @param {?} okCallback
     * @param {?} selectedItems
     * @param {?} rowNode
     * @return {?}
     */
    showSetColumnsDialog(okCallback, selectedItems, rowNode) {
        /** @type {?} */
        const modalRef = this.modalService.show(SetColumnsComponent, {
            title: this.languageRes.contextMenus.setDataField,
            width: 600,
            height: 500,
            showMaxButton: false,
            resizable: false,
            initialState: {
                data: this.getCanSelectColumns(rowNode),
                checkedItems: selectedItems,
                groupEditorRef: this
            },
            buttons: [
                {
                    text: this.languageRes.cancel,
                    cls: 'btn btn-secondary',
                    handle: (/**
                     * @return {?}
                     */
                    () => {
                        modalRef.close();
                    })
                },
                {
                    text: this.languageRes.ok,
                    cls: 'btn btn-primary',
                    handle: (/**
                     * @return {?}
                     */
                    () => {
                        okCallback(modalRef.content.selectedIds);
                    })
                }
            ]
        });
        return modalRef;
    }
    /**
     * 为分组表头分配数据列
     * @param {?} $event
     * @param {?} rowNode
     * @return {?}
     */
    setColumnsForGroupHeader($event, rowNode) {
        /** @type {?} */
        const childs = rowNode ? rowNode.node.children ? rowNode.node.children.map((/**
         * @param {?} n
         * @return {?}
         */
        n => n.data)) : [] : [];
        /** @type {?} */
        const modalRef = this.showSetColumnsDialog((/**
         * @param {?} selectedIds
         * @return {?}
         */
        (selectedIds) => {
            // 分组下的列
            /** @type {?} */
            const cols = selectedIds.map((/**
             * @param {?} n
             * @return {?}
             */
            n => {
                return this.fields.find((/**
                 * @param {?} f
                 * @return {?}
                 */
                f => f.field == n));
            })).filter((/**
             * @param {?} n
             * @return {?}
             */
            n => n));
            // 候选区
            /** @type {?} */
            const hxl = this.getHouXuanNode();
            // 清理候选数据，将已分配的列在候选区移除
            hxl.node.children = (hxl.node.children || []).filter((/**
             * @param {?} n
             * @return {?}
             */
            n => cols.findIndex((/**
             * @param {?} c
             * @return {?}
             */
            c => c.field == n.id)) === -1));
            // 查找需要移除的
            /** @type {?} */
            const needRemoveNodes = (rowNode.node.children || []).filter((/**
             * @param {?} n
             * @return {?}
             */
            (n) => {
                return !n.data.groupHeader && cols.findIndex((/**
                 * @param {?} c
                 * @return {?}
                 */
                (c) => c.field === n.id)) == -1;
            })).filter((/**
             * @param {?} n
             * @return {?}
             */
            n => n));
            if (needRemoveNodes && needRemoveNodes.length) {
                needRemoveNodes.forEach((/**
                 * @param {?} n
                 * @return {?}
                 */
                n => {
                    this.tt.remove(n.id);
                }));
            }
            // 查找需要新增的
            /** @type {?} */
            const needAppendNodes = cols.filter((/**
             * @param {?} n
             * @return {?}
             */
            n => (rowNode.node.children || []).findIndex((/**
             * @param {?} c
             * @return {?}
             */
            c => c.id === n.field)) === -1)).map((/**
             * @param {?} n
             * @return {?}
             */
            n => {
                if (!n.id) {
                    n.id = n.field;
                }
                return n;
            }));
            if (needAppendNodes && needAppendNodes.length) {
                needAppendNodes.forEach((/**
                 * @param {?} n
                 * @return {?}
                 */
                n => {
                    /** @type {?} */
                    const col = this.fields.find((/**
                     * @param {?} f
                     * @return {?}
                     */
                    f => f.field == n.field));
                    if (col) {
                        col.fixed = rowNode.node.data.fixed;
                    }
                }));
                this.tt.appendChildren(needAppendNodes.map((/**
                 * @param {?} n
                 * @return {?}
                 */
                n => {
                    return {
                        data: n,
                        children: [],
                        expanded: true
                    };
                })), rowNode.node);
                this.tt.expandNode(rowNode.id);
            }
            // 更新待选区
            /** @type {?} */
            const hxlCols = needRemoveNodes.map((/**
             * @param {?} n
             * @return {?}
             */
            n => {
                return {
                    data: n.data,
                    children: []
                };
            }));
            this.tt.appendChildren(hxlCols, hxl.node);
            modalRef.close();
        }), childs, rowNode);
    }
    // 将待选区中的数据列直接设为表头
    /**
     * @param {?} event
     * @param {?} col
     * @return {?}
     */
    setColumnHeader(event, col) {
        /** @type {?} */
        const i = this.treeData.length - 1;
        this.treeData.splice(i, 0, { data: col, children: [] });
        /** @type {?} */
        const hxl = this.getHouXuanNode();
        if (hxl) {
            hxl.node.children = hxl.node.children.filter((/**
             * @param {?} n
             * @return {?}
             */
            n => n.data.id !== col.id));
            hxl.node.leaf = !(hxl.node.children && hxl.node.children.length);
            if (hxl.node.leaf) {
                hxl.node.icon = this.GROUP_HEADER_ICON;
            }
            this.tt.clearSelections();
            this.tt.updateSerializedValue();
            this.tt.selectNode(col.id, true);
        }
    }
    /**
     * @param {?} event
     * @param {?} rowNode
     * @return {?}
     */
    moveUp(event, rowNode) {
        /** @type {?} */
        let data = this.treeData;
        if (rowNode.parent) {
            data = rowNode.parent.children;
        }
        /** @type {?} */
        const index = data.findIndex((/**
         * @param {?} n
         * @return {?}
         */
        n => n.data.id === rowNode.id));
        if (index !== 0) {
            /** @type {?} */
            const tempArr = data.splice(index, 1);
            data.splice(index - 1, 0, ...tempArr);
            this.tt.updateSerializedValue();
        }
    }
    /**
     * @param {?} event
     * @param {?} rowNode
     * @return {?}
     */
    moveDown(event, rowNode) {
        /** @type {?} */
        let data = this.treeData;
        if (rowNode.parent) {
            data = rowNode.parent.children;
        }
        /** @type {?} */
        const index = data.findIndex((/**
         * @param {?} n
         * @return {?}
         */
        n => n.data.id === rowNode.id));
        /** @type {?} */
        const len = data.length;
        if (index !== len - 2) {
            /** @type {?} */
            const tempArr = data.splice(index, 1);
            data.splice(index + 1, 0, ...tempArr);
            this.tt.updateSerializedValue();
        }
        else {
            this.moveBottom(event, rowNode);
        }
    }
    /**
     * @param {?} event
     * @param {?} rowNode
     * @return {?}
     */
    moveTop(event, rowNode) {
        /** @type {?} */
        let data = this.treeData;
        if (rowNode.parent) {
            data = rowNode.parent.children;
        }
        /** @type {?} */
        const index = data.findIndex((/**
         * @param {?} n
         * @return {?}
         */
        n => n.data.id === rowNode.id));
        data.unshift(rowNode.node);
        data.splice(index + 1, 1);
        this.tt.updateSerializedValue();
    }
    /**
     * @param {?} event
     * @param {?} rowNode
     * @return {?}
     */
    moveBottom(event, rowNode) {
        /** @type {?} */
        let data = this.treeData;
        if (rowNode.parent) {
            data = rowNode.parent.children;
        }
        /** @type {?} */
        const index = data.findIndex((/**
         * @param {?} n
         * @return {?}
         */
        n => n.data.id === rowNode.id));
        data.push(rowNode.node);
        data.splice(index, 1);
        if (!rowNode.parent) {
            this.moveUp(event, rowNode);
        }
        else {
            this.tt.updateSerializedValue();
        }
    }
    /**
     * 获取多表头数据
     * @return {?}
     */
    getPreviewGroupColumns() {
        /** @type {?} */
        const treeNodes = this.getAllNodes();
        return this.convert2Array(treeNodes);
    }
    /**
     * 获取候选列
     * @return {?}
     */
    getHouXuanFields() {
        /** @type {?} */
        const hxl = this.treeData.find((/**
         * @param {?} n
         * @return {?}
         */
        n => n.data.houxuanquNode));
        if (hxl) {
            return hxl.children;
        }
        else {
            return [];
        }
    }
    /**
     * @private
     * @return {?}
     */
    getAllNodes() {
        /** @type {?} */
        const hxl = this.getHouXuanFields();
        return this.tt.serializedValue.filter((/**
         * @param {?} n
         * @return {?}
         */
        n => {
            return !n.node.data.houxuanquNode && hxl.findIndex((/**
             * @param {?} k
             * @return {?}
             */
            k => k.data.id === n.id)) === -1;
        }));
    }
    /**
     * 将树节点数据转换为 多表头结构
     * @param {?} rowNodes
     * @return {?}
     */
    convert2Array(rowNodes) {
        /** @type {?} */
        const r = [];
        /** @type {?} */
        const maxBy = (/**
         * @param {?} arr
         * @param {?} fn
         * @return {?}
         */
        (arr, fn) => Math.max(...arr.map(typeof fn === 'function' ? fn : (/**
         * @param {?} val
         * @return {?}
         */
        val => val[fn]))));
        /** @type {?} */
        const maxlevel = maxBy(rowNodes, (/**
         * @param {?} n
         * @return {?}
         */
        (n) => n.level));
        // 排除没有数据字段的表头
        rowNodes = rowNodes.filter((/**
         * @param {?} n
         * @return {?}
         */
        n => (n.node.children && n.node.children.length && n.node.data.groupHeader) || !n.node.data.groupHeader));
        /**
         * 1、只有一组表头，且固定在左侧或右侧时，按无固定列方式处理
         * 2、只有左侧、右侧固定列而没有其他正常列时，取消右侧固定列
         * 3、只有左侧或右侧固定时，按无固定列处理
         * @type {?}
         */
        const parents = rowNodes.filter((/**
         * @param {?} e
         * @return {?}
         */
        e => !e.parent));
        if (!parents.filter((/**
         * @param {?} n
         * @return {?}
         */
        n => !n.node.data.fixed || n.node.data.fixed === 'UNFIXED')).length) {
            /** @type {?} */
            const leftCols = parents.filter((/**
             * @param {?} n
             * @return {?}
             */
            n => n.node.data.fixed === 'left'));
            /** @type {?} */
            const rightCols = parents.filter((/**
             * @param {?} n
             * @return {?}
             */
            n => n.node.data.fixed === 'right'));
            if (leftCols.length == parents.length || rightCols.length == parents.length) {
                rowNodes.forEach((/**
                 * @param {?} n
                 * @return {?}
                 */
                n => {
                    if (parents.find((/**
                     * @param {?} p
                     * @return {?}
                     */
                    p => p.id === n.id))) {
                        n.node.data.fixed = '';
                    }
                }));
            }
            else {
                if (rightCols.length === 1) {
                    leftCols.forEach((/**
                     * @param {?} t
                     * @return {?}
                     */
                    t => {
                        rowNodes.forEach((/**
                         * @param {?} n
                         * @return {?}
                         */
                        n => {
                            if (t.id === n.id) {
                                n.node.data.fixed = '';
                            }
                        }));
                    }));
                }
                else {
                    rightCols.forEach((/**
                     * @param {?} t
                     * @return {?}
                     */
                    t => {
                        rowNodes.forEach((/**
                         * @param {?} n
                         * @return {?}
                         */
                        n => {
                            if (t.id === n.id) {
                                n.node.data.fixed = '';
                            }
                        }));
                    }));
                }
            }
        }
        for (let i = 0; i <= maxlevel; i++) {
            r.push(rowNodes.filter((/**
             * @param {?} n
             * @return {?}
             */
            n => n.level === i)).map((/**
             * @param {?} n
             * @return {?}
             */
            n => {
                /** @type {?} */
                const data = n.node.data;
                /** @type {?} */
                const _fixed = n.parent ? this.tt.getRoot(n.id).node.data.fixed : (data.fixed || '');
                /** @type {?} */
                const _colspan = (n.node.children ? rowNodes.filter((/**
                 * @param {?} k
                 * @return {?}
                 */
                k => k.parents.indexOf(n.id) > -1 && k.id.indexOf('groupHeader_') == -1)).length : 1) || 1;
                /** @type {?} */
                const _rowspan = (n.node.children && n.node.children.length > 0) ? 1 : (maxlevel - n.level + 1);
                /** @type {?} */
                const newCol = {
                    field: data.field,
                    title: data.title,
                    sortable: data.sortable,
                    order: data.order,
                    halign: data.halign || 'left',
                    align: data.align || 'left',
                    visible: true,
                    allowGrouping: data.allowGrouping,
                    groupFooter: data.groupFooter,
                    footer: data.footer,
                    width: (data.size ? data.size.width : 100),
                    dataType: data.dataType || 'string',
                    fixed: _fixed === 'UNFIXED' ? '' : _fixed,
                    id: n.id,
                    parentId: n.node.parent ? n.node.parent.id : null,
                    rowspan: _rowspan,
                    colspan: _colspan
                };
                /** @type {?} */
                const newCol2 = {
                    field: data.field,
                    title: data.title,
                    halign: data.halign || 'left',
                    align: data.align || 'left',
                    visible: true,
                    groupFooter: {},
                    footer: {},
                    width: (data.size ? data.size.width : 100),
                    dataType: data.dataType || 'string',
                    fixed: _fixed === 'UNFIXED' ? '' : _fixed,
                    id: n.id,
                    parentId: n.node.parent ? n.node.parent.id : null,
                    rowspan: _rowspan,
                    colspan: _colspan
                };
                return n.node.data.groupHeader ? newCol2 : newCol;
            })));
        }
        return r;
    }
    /**
     * @private
     * @param {?} nodes
     * @return {?}
     */
    clearTreeNodesData(nodes) {
        nodes.forEach((/**
         * @param {?} n
         * @return {?}
         */
        (n) => {
            delete n.parent;
            delete n.elementRef;
            if (n.children && n.children.length) {
                this.clearTreeNodesData(n.children);
            }
        }));
    }
    /**
     * @return {?}
     */
    getSettings() {
        this.clearTreeNodesData(this.treeData);
        return {
            viewCols: this.getPreviewGroupColumns(),
            treeData: this.treeData
        };
    }
    /**
     * @param {?} $event
     * @param {?} id
     * @return {?}
     */
    hiddenCol($event, id) {
        $event.stopPropagation();
        if (this.tt.selectedRow && id === this.tt.selectedRow.id) {
            this.tt.clearSelections();
            this.nodeSelected.emit(null);
        }
        this.tt.remove(id);
    }
    /**
     * @param {?} $event
     * @param {?} rowNode
     * @return {?}
     */
    resetHeaderName($event, rowNode) {
        /** @type {?} */
        const modalRef = this.showNewHeaderDialog((/**
         * @return {?}
         */
        () => {
            /** @type {?} */
            const ghfRef = (/** @type {?} */ (modalRef.content));
            if (ghfRef.title) {
                rowNode.node.data.title = ghfRef.title;
                modalRef.close();
            }
            else {
                this.notitySer.info(this.languageRes.required);
                ghfRef.input.nativeElement.focus();
            }
        }), this.languageRes.contextMenus.rename);
        /** @type {?} */
        const ghfRef = (/** @type {?} */ (modalRef.content));
        ghfRef.title = rowNode.node.data.title;
    }
}
ColumnTreeComponent.decorators = [
    { type: Component, args: [{
                selector: 'column-tree',
                template: "<farris-treetable #tt [data]=\"treeData\" [columns]=\"treecols\"\r\n        [idField]=\"'id'\" [striped]=\"false\" [showBorder]=\"false\"\r\n        [singleSelect]=\"true\" [showIcon]=\"true\" [showFilterBar]=\"false\" [selectOnCheck]=\"true\" [checkOnSelect]=\"true\"\r\n        [fixedHeader]=\"false\" [fit] =\"false\" [showHeader]=\"false\"\r\n        [collapseIcon]=\"'f-icon f-icon-file-folder-close'\" [expandIcon]=\"'f-icon f-icon-file-folder-open'\"\r\n        [enableContextMenu]=\"true\" [contextMenuItems]=\"contextMenus\" [dblClickExpand]=\"false\" [beforeShowContextMenu]=\"onBeforeShowContextMenu\"\r\n        (nodeSelected)=\"onTreeSelected($event)\"\r\n></farris-treetable>\r\n<ng-template #nodeTemplate let-ctx>\r\n    <div class=\"d-flex flex-row multi-headers-toolbars\" id=\"{{ ctx.rowData['id'] }}\">\r\n        <div class=\"f-utils-fill\">{{ctx.rowData['title']}}</div>\r\n        <div class=\"d-flex align-items-center multi-headers-toolbars-buttons hide\" [class.show]=\"tt.selectValue === ctx.rowData['id']\">\r\n            \r\n            <button class=\"btn btn-link d-flex align-items-center more treenode-more-btn\" \r\n                *ngIf=\"ctx.rowData['id'] !== '__HOU_XUAN_LIE_ID__' && isGroupHeader(ctx.rowNode)\" title=\"{{languageRes.contextMenus.cancelGroup}}\"\r\n                (click)=\"removeGroup($event, ctx.rowNode);\">\r\n                <span class=\"f-icon f-icon-x\"></span>\r\n            </button>\r\n            <button class=\"btn btn-link d-flex align-items-center more treenode-more-btn\" \r\n                *ngIf=\"ctx.rowData['id'] !== '__HOU_XUAN_LIE_ID__' && ctx.rowNode.parents && ctx.rowNode.parents[0] !== '__HOU_XUAN_LIE_ID__' && !isGroupHeader(ctx.rowNode)\"\r\n                 title=\"{{languageRes.contextMenus.remove}}\"\r\n                (click)=\"hiddenCol($event,ctx.rowNode.id)\">\r\n                <span class=\"f-icon f-icon-x\"></span>\r\n            </button>\r\n            \r\n            <button class=\"btn btn-link mr-0 d-flex align-items-center more treenode-more-btn\" \r\n                *ngIf=\"ctx.rowData['id'] !== '__HOU_XUAN_LIE_ID__' && ctx.rowNode.parents && ctx.rowNode.parents[0] !== '__HOU_XUAN_LIE_ID__'\" title=\"\"\r\n                (click)=\"onMoreBtnClick($event, ctx.rowData)\">\r\n                <span class=\"f-icon f-icon-more-horizontal\"></span>\r\n            </button>\r\n            <button class=\"btn btn-link mr-0 d-flex align-items-center more treenode-more-btn\" title=\"{{languageRes.contextMenus.new}}\" \r\n                *ngIf=\"ctx.rowData['id'] === '__HOU_XUAN_LIE_ID__'\"\r\n                (click)=\"addNewGroup(null, !1)\">\r\n                <span class=\"f-icon f-icon-plus-circle font16 t-2\"></span>\r\n            </button>\r\n\r\n            <button class=\"btn btn-link mr-0 d-flex align-items-center more treenode-more-btn\" \r\n                *ngIf=\"ctx.rowNode.parents && ctx.rowNode.parents[0] === '__HOU_XUAN_LIE_ID__'\" title=\"{{languageRes.setHeader}}\"\r\n                (click)=\"setColumnHeader($event, ctx.rowData)\">\r\n                <span class=\"f-icon f-icon-add\"></span>\r\n            </button>\r\n        </div>\r\n    </div>\r\n\r\n</ng-template>",
                exportAs: 'groupHeaderTree',
                encapsulation: ViewEncapsulation.None,
                styles: [".multi-headers-toolbars .multi-headers-toolbars-buttons{margin-right:-11px}.multi-headers-toolbars .multi-headers-toolbars-buttons.hide{display:none!important}.multi-headers-toolbars .multi-headers-toolbars-buttons.show{display:flex!important}.multi-headers-toolbars .multi-headers-toolbars-buttons button.more{height:26px;width:26px;background:0 0;border-radius:0;border:0;padding:2px}.multi-headers-toolbars .multi-headers-toolbars-buttons button.more .f-icon{font-size:14px;position:relative;left:3px}.multi-headers-toolbars .multi-headers-toolbars-buttons .font16{font-size:16px}.multi-headers-toolbars:hover .multi-headers-toolbars-buttons,.table-hover tbody tr:hover .multi-headers-toolbars .multi-headers-toolbars-buttons{display:flex!important}"]
            }] }
];
/** @nocollapse */
ColumnTreeComponent.ctorParameters = () => [
    { type: Injector },
    { type: NgZone },
    { type: ChangeDetectorRef },
    { type: Renderer2 },
    { type: BsModalService },
    { type: ElementRef },
    { type: NotifyService }
];
ColumnTreeComponent.propDecorators = {
    dg: [{ type: Input }],
    options: [{ type: Input }],
    inModal: [{ type: Input }],
    nodeSelected: [{ type: Output }],
    cellTemp: [{ type: ViewChild, args: ['nodeTemplate',] }],
    tt: [{ type: ViewChild, args: ['tt',] }]
};
if (false) {
    /** @type {?} */
    ColumnTreeComponent.prototype.dg;
    /** @type {?} */
    ColumnTreeComponent.prototype.options;
    /** @type {?} */
    ColumnTreeComponent.prototype.inModal;
    /** @type {?} */
    ColumnTreeComponent.prototype.nodeSelected;
    /** @type {?} */
    ColumnTreeComponent.prototype.cellTemp;
    /** @type {?} */
    ColumnTreeComponent.prototype.tt;
    /** @type {?} */
    ColumnTreeComponent.prototype.fields;
    /** @type {?} */
    ColumnTreeComponent.prototype.treecols;
    /** @type {?} */
    ColumnTreeComponent.prototype.treeData;
    /** @type {?} */
    ColumnTreeComponent.prototype.contextMenus;
    /**
     * 值 __HOU_XUAN_LIE_ID__
     * @type {?}
     */
    ColumnTreeComponent.prototype.HOU_XUAN_LIE_ID;
    /** @type {?} */
    ColumnTreeComponent.prototype.GROUP_HEADER_ICON;
    /** @type {?} */
    ColumnTreeComponent.prototype.Hou_Xuan_Qu;
    /** @type {?} */
    ColumnTreeComponent.prototype.languageRes;
    /**
     * @type {?}
     * @private
     */
    ColumnTreeComponent.prototype.localeSer;
    /**
     * 移动命令项是否显示
     * @type {?}
     */
    ColumnTreeComponent.prototype.moveMenuItemVisiblily;
    /** @type {?} */
    ColumnTreeComponent.prototype.isGroupHeader;
    /** @type {?} */
    ColumnTreeComponent.prototype.onBeforeShowContextMenu;
    /**
     * @type {?}
     * @private
     */
    ColumnTreeComponent.prototype.injector;
    /**
     * @type {?}
     * @private
     */
    ColumnTreeComponent.prototype.ngzone;
    /**
     * @type {?}
     * @private
     */
    ColumnTreeComponent.prototype.cd;
    /**
     * @type {?}
     * @private
     */
    ColumnTreeComponent.prototype.render;
    /**
     * @type {?}
     * @private
     */
    ColumnTreeComponent.prototype.modalService;
    /**
     * @type {?}
     * @private
     */
    ColumnTreeComponent.prototype.el;
    /**
     * @type {?}
     * @private
     */
    ColumnTreeComponent.prototype.notitySer;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29sdW1uLXRyZWUuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy91aS1kYXRhZ3JpZC1zZXR0aW5ncy8iLCJzb3VyY2VzIjpbImxpYi9tdWx0aS1oZWFkZXJzL2NvbHVtbi10cmVlLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFpQixpQkFBaUIsRUFBQyxZQUFZLEVBQUUsU0FBUyxFQUFFLFVBQVUsRUFBRSxRQUFRLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBZ0MsTUFBTSxFQUFFLFNBQVMsRUFBaUIsV0FBVyxFQUFFLFNBQVMsRUFBRSxpQkFBaUIsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUV6TyxPQUFPLEVBQUUsRUFBRSxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBRTFCLE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQztBQUNsRCxPQUFPLEVBQXFCLGtCQUFrQixFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFFN0UsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBQ2xELE9BQU8sRUFBRSxpQkFBaUIsRUFBYyxNQUFNLHFCQUFxQixDQUFDO0FBRXBFLE9BQU8sRUFBRSxzQkFBc0IsRUFBRSxNQUFNLHdCQUF3QixDQUFDO0FBQ2hFLE9BQU8sRUFBRSxtQkFBbUIsRUFBRSxNQUFNLHdCQUF3QixDQUFDO0FBQzdELE9BQU8sRUFBRSxrQkFBa0IsRUFBRSxNQUFNLHlCQUF5QixDQUFDO0FBQzdELE9BQU8sRUFBRSxTQUFTLEVBQUUsT0FBTyxFQUFFLE1BQU0sV0FBVyxDQUFDO0FBRS9DLE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQVVsRCxNQUFNLE9BQU8sbUJBQW1COzs7Ozs7Ozs7O0lBcUQ1QixZQUFvQixRQUFrQixFQUFVLE1BQWMsRUFBVSxFQUFxQixFQUFVLE1BQWlCLEVBQzVHLFlBQTRCLEVBQVUsRUFBYyxFQUNwRCxTQUF3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LENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUM7SUFDMUMsQ0FBQzs7O1lBM3VCSixTQUFTLFNBQUM7Z0JBQ1AsUUFBUSxFQUFFLGFBQWE7Z0JBRXZCLHFwR0FBMkM7Z0JBQzNDLFFBQVEsRUFBRSxpQkFBaUI7Z0JBQzNCLGFBQWEsRUFBRSxpQkFBaUIsQ0FBQyxJQUFJOzthQUN4Qzs7OztZQXhCOEUsUUFBUTtZQUFTLE1BQU07WUFBOUUsaUJBQWlCO1lBQXFHLFNBQVM7WUFJOUksY0FBYztZQUo0QyxVQUFVO1lBT3BFLGFBQWE7OztpQkFvQmpCLEtBQUs7c0JBQ0wsS0FBSztzQkFFTCxLQUFLOzJCQUVMLE1BQU07dUJBRU4sU0FBUyxTQUFDLGNBQWM7aUJBQ3hCLFNBQVMsU0FBQyxJQUFJOzs7O0lBUmYsaUNBQStCOztJQUMvQixzQ0FBa0Q7O0lBRWxELHNDQUF5Qjs7SUFFekIsMkNBQWlEOztJQUVqRCx1Q0FBcUQ7O0lBQ3JELGlDQUF3Qzs7SUFFeEMscUNBQVk7O0lBQ1osdUNBQWM7O0lBQ2QsdUNBQWM7O0lBQ2QsMkNBQWtCOzs7OztJQUdsQiw4Q0FBd0M7O0lBR3hDLGdEQUFzRDs7SUFFdEQsMENBQWdGOztJQUdoRiwwQ0F3QkM7Ozs7O0lBRUQsd0NBQXdDOzs7OztJQThJeEMsb0RBU0M7O0lBRUQsNENBU0M7O0lBeWRELHNEQU1DOzs7OztJQWhvQlcsdUNBQTBCOzs7OztJQUFFLHFDQUFzQjs7Ozs7SUFBRSxpQ0FBNkI7Ozs7O0lBQUUscUNBQXlCOzs7OztJQUNwSCwyQ0FBb0M7Ozs7O0lBQUUsaUNBQXNCOzs7OztJQUM1RCx3Q0FBZ0MiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBZnRlclZpZXdJbml0LCBDaGFuZ2VEZXRlY3RvclJlZixFdmVudEVtaXR0ZXIsIENvbXBvbmVudCwgRWxlbWVudFJlZiwgSW5qZWN0b3IsIElucHV0LCBOZ1pvbmUsIE9uQ2hhbmdlcywgT25EZXN0cm95LCBPbkluaXQsIE91dHB1dCwgUmVuZGVyZXIyLCBTaW1wbGVDaGFuZ2VzLCBUZW1wbGF0ZVJlZiwgVmlld0NoaWxkLCBWaWV3RW5jYXBzdWxhdGlvbiB9IGZyb20gXCJAYW5ndWxhci9jb3JlXCI7XHJcblxyXG5pbXBvcnQgeyBvZiB9IGZyb20gXCJyeGpzXCI7XHJcblxyXG5pbXBvcnQgeyBCc01vZGFsU2VydmljZSB9IGZyb20gXCJAZmFycmlzL3VpLW1vZGFsXCI7XHJcbmltcG9ydCB7IFJvd05vZGUsIFRyZWVOb2RlLCBUcmVlVGFibGVDb21wb25lbnQgfSBmcm9tIFwiQGZhcnJpcy91aS10cmVldGFibGVcIjtcclxuaW1wb3J0IHsgT3ZlckxheUhpZGRlblNlcnZpY2UgfSBmcm9tICdAZmFycmlzL3VpLWNvbW1vbic7XHJcbmltcG9ydCB7IE5vdGlmeVNlcnZpY2UgfSBmcm9tICdAZmFycmlzL3VpLW5vdGlmeSc7XHJcbmltcG9ydCB7IERhdGFncmlkQ29tcG9uZW50LCBEYXRhQ29sdW1uIH0gZnJvbSAnQGZhcnJpcy91aS1kYXRhZ3JpZCc7XHJcblxyXG5pbXBvcnQgeyBOZXdIZWFkZXJGb3JtQ29tcG9uZW50IH0gZnJvbSBcIi4vbmV3LWhlYWRlci5jb21wb25lbnRcIjtcclxuaW1wb3J0IHsgU2V0Q29sdW1uc0NvbXBvbmVudCB9IGZyb20gXCIuL3NldGNvbHVtbnMuY29tcG9uZW50XCI7XHJcbmltcG9ydCB7IGNvbHVtbnNUb1RyZWVOb2RlcyB9IGZyb20gXCIuLi9tdXRsaS1oZWFkZXJzLmhlbHBlclwiO1xyXG5pbXBvcnQgeyBjbG9uZURlZXAsIGZsYXR0ZW4gfSBmcm9tIFwibG9kYXNoLWVzXCI7XHJcbmltcG9ydCB7IENvbHVtblRyZWVPcHRpb25zIH0gZnJvbSBcIi4uL3NldHRpbmcubW9kZWxcIjtcclxuaW1wb3J0IHsgTG9jYWxlU2VydmljZSB9IGZyb20gXCJAZmFycmlzL3VpLWxvY2FsZVwiO1xyXG5cclxuXHJcbkBDb21wb25lbnQoe1xyXG4gICAgc2VsZWN0b3I6ICdjb2x1bW4tdHJlZScsXHJcbiAgICBzdHlsZVVybHM6IFsnLi9jb2x1bW4tdHJlZS5zY3NzJ10sXHJcbiAgICB0ZW1wbGF0ZVVybDogJy4vY29sdW1uLXRyZWUuY29tcG9uZW50Lmh0bWwnLFxyXG4gICAgZXhwb3J0QXM6ICdncm91cEhlYWRlclRyZWUnLFxyXG4gICAgZW5jYXBzdWxhdGlvbjogVmlld0VuY2Fwc3VsYXRpb24uTm9uZVxyXG59KVxyXG5leHBvcnQgY2xhc3MgQ29sdW1uVHJlZUNvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgT25EZXN0cm95LCBBZnRlclZpZXdJbml0LCBPbkNoYW5nZXMge1xyXG5cclxuICAgIEBJbnB1dCgpIGRnOiBEYXRhZ3JpZENvbXBvbmVudDtcclxuICAgIEBJbnB1dCgpIG9wdGlvbnM6IFBhcnRpYWw8Q29sdW1uVHJlZU9wdGlvbnM+ID0ge307XHJcblxyXG4gICAgQElucHV0KCkgaW5Nb2RhbCA9IGZhbHNlO1xyXG5cclxuICAgIEBPdXRwdXQoKSBub2RlU2VsZWN0ZWQgPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcclxuICAgIFxyXG4gICAgQFZpZXdDaGlsZCgnbm9kZVRlbXBsYXRlJykgY2VsbFRlbXA6IFRlbXBsYXRlUmVmPGFueT5cclxuICAgIEBWaWV3Q2hpbGQoJ3R0JykgdHQ6IFRyZWVUYWJsZUNvbXBvbmVudDtcclxuICAgIFxyXG4gICAgZmllbGRzID0gW107XHJcbiAgICB0cmVlY29scyA9IFtdO1xyXG4gICAgdHJlZURhdGEgPSBbXTtcclxuICAgIGNvbnRleHRNZW51cyA9IFtdO1xyXG5cclxuICAgIC8qKiDlgLwgX19IT1VfWFVBTl9MSUVfSURfXyAqL1xyXG4gICAgSE9VX1hVQU5fTElFX0lEID0gJ19fSE9VX1hVQU5fTElFX0lEX18nO1xyXG5cclxuXHJcbiAgICBHUk9VUF9IRUFERVJfSUNPTiA9ICdmLWljb24gZi1pY29uLWZpbGUtZm9sZGVyLWNsb3NlJztcclxuXHJcbiAgICBIb3VfWHVhbl9RdSA9IHsgaWQ6IHRoaXMuSE9VX1hVQU5fTElFX0lELCB0aXRsZTogJyjlgJnpgInliJcpJywgaG91eHVhbnF1Tm9kZTogdHJ1ZSB9O1xyXG5cclxuXHJcbiAgICBsYW5ndWFnZVJlcyA9IHtcclxuICAgICAgICB0aXRsZTogJ+WkmuihqOWktCcsXHJcbiAgICAgICAgcHJldmlldzogJ+mihOiniOaViOaenCcsXHJcbiAgICAgICAgdGlwczogJ+WcqO+8iOWAmemAieWIl++8ieS4reeahOWtl+aute+8jOWwhuS4jeWcqOWIl+ihqOS4reaYvuekujsg54K55Ye75a2X5q615ZCN56ew77yM5Zyo5Y+z5L6n5pi+56S655u45YWz5pON5L2c5oyJ6ZKu44CCJyxcclxuICAgICAgICBjb250ZXh0TWVudXM6IHtcclxuICAgICAgICAgICAgbmV3OiAn5paw5bu66KGo5aS0JyxcclxuICAgICAgICAgICAgbmV3Q2hpbGQ6ICfmlrDlu7rlrZDnuqfooajlpLQnLFxyXG4gICAgICAgICAgICBzZXREYXRhRmllbGQ6ICfliIbphY3mlbDmja7liJcnLFxyXG4gICAgICAgICAgICByZW5hbWU6ICfph43lkb3lkI0nLFxyXG4gICAgICAgICAgICB0b3A6ICfnva7pobYnLFxyXG4gICAgICAgICAgICB1cDogJ+S4iuenuycsXHJcbiAgICAgICAgICAgIGRvd246ICfkuIvnp7snLFxyXG4gICAgICAgICAgICBib3R0b206ICfnva7lupUnLFxyXG4gICAgICAgICAgICBjYW5jZWxHcm91cDogJ+WPlua2iOWIhue7hCcsXHJcbiAgICAgICAgICAgIHJlbW92ZTogJ+WcqOWIhue7hOWGheenu+mZpCdcclxuICAgICAgICB9LFxyXG4gICAgICAgIGNhbmRpZGF0ZTogJyjlgJnpgInliJcpJyxcclxuICAgICAgICBzZXRIZWFkZXI6ICforr7kuLrooajlpLQnLFxyXG4gICAgICAgIG9rOiAn56Gu5a6aJyxcclxuICAgICAgICBjYW5jZWw6ICflj5bmtognLFxyXG4gICAgICAgIHJlcXVpcmVkOiAn6K+36L6T5YWl6KGo5aS05ZCN56ew77yBJyxcclxuICAgICAgICBkZWZhdWx0R3JvdXBIZWFkZXJOYW1lOiAn5YiG57uE6KGo5aS0MScsXHJcbiAgICAgICAgbmV3SGVhZGVyUGxhY2Vob2xkZXI6ICfor7fovpPlhaXlkI3np7AnLFxyXG4gICAgICAgIG5ld0hlYWRlckxhYmVsOiAn6KGo5aS05ZCN56ewJ1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgbG9jYWxlU2VyOiBMb2NhbGVTZXJ2aWNlID0gbnVsbDtcclxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgaW5qZWN0b3I6IEluamVjdG9yLCBwcml2YXRlIG5nem9uZTogTmdab25lLCBwcml2YXRlIGNkOiBDaGFuZ2VEZXRlY3RvclJlZiwgcHJpdmF0ZSByZW5kZXI6IFJlbmRlcmVyMixcclxuICAgICAgICBwcml2YXRlIG1vZGFsU2VydmljZTogQnNNb2RhbFNlcnZpY2UsIHByaXZhdGUgZWw6IEVsZW1lbnRSZWYsXHJcbiAgICAgICAgcHJpdmF0ZSBub3RpdHlTZXI6IE5vdGlmeVNlcnZpY2UpIHtcclxuICAgICAgICAgICAgdGhpcy5sb2NhbGVTZXIgPSB0aGlzLmluamVjdG9yLmdldChMb2NhbGVTZXJ2aWNlLCBudWxsKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgbmdPbkluaXQoKTogdm9pZCB7XHJcbiAgICAgICAgY29uc3QgZ3JvdXBIZWFkZXJzID0gdGhpcy5kZy5kZnNbJ19zdGF0ZSddLmluaXRpYWxPcHRpb25zLmdyb3VwSGVhZGVyRmllbGRzO1xyXG4gICAgICAgIGNvbnN0IGFsbERhdGFGaWVsZHMgPSBmbGF0dGVuPERhdGFDb2x1bW4+KGdyb3VwSGVhZGVycykuZmlsdGVyKChjb2w6IERhdGFDb2x1bW4pID0+ICFjb2wuY29sc3BhbiB8fCBjb2wuY29sc3BhbiA9PSAxKTtcclxuICAgICAgICB0aGlzLmZpZWxkcyA9IGFsbERhdGFGaWVsZHMuZmlsdGVyKG4gPT4gbi5maWVsZCAmJiBuLmZpZWxkICE9PSB0aGlzLmRnLkNvbnRyb2xQYW5lbEZlaWxkKTtcclxuXHJcbiAgICAgICAgLy8g5qCR57uE5Lu25YiX5L+h5oGvXHJcbiAgICAgICAgdGhpcy50cmVlY29scyA9IFtcclxuICAgICAgICAgICAgeyBmaWVsZDogJ3RpdGxlJywgdGl0bGU6ICflkI3np7AnLCB0ZW1wbGF0ZTogdGhpcy5jZWxsVGVtcCB9XHJcbiAgICAgICAgXTtcclxuXHJcbiAgICAgICAgdGhpcy5sYW5ndWFnZVJlcyA9IHRoaXMubG9jYWxlU2VyLmdldFZhbHVlKCdoZWFkZXJHcm91cCcpO1xyXG4gICAgICAgIHRoaXMuSG91X1h1YW5fUXUudGl0bGUgPSB0aGlzLmxhbmd1YWdlUmVzLmNhbmRpZGF0ZTtcclxuXHJcbiAgICAgICAgdGhpcy5pbml0VHJlZURhdGEoKTtcclxuXHJcbiAgICAgICAgdGhpcy5pbml0VHJlZW5vZGVDb250ZXh0TWVudXMoKTtcclxuICAgICAgICB0aGlzLmxpc3RlblRyZWVUYWJsZUV2ZW50KCk7XHJcbiAgICB9XHJcblxyXG4gICAgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcyk6IHZvaWQge1xyXG4gICAgICAgIGlmIChjaGFuZ2VzLm9wdGlvbnMgJiYgIWNoYW5nZXMub3B0aW9ucy5pc0ZpcnN0Q2hhbmdlKCkpIHtcclxuICAgICAgICAgICAgdGhpcy5pbml0VHJlZURhdGEoKTtcclxuICAgICAgICAgICAgdGhpcy50dC5jbGVhclNlbGVjdGlvbnMoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgbmdBZnRlclZpZXdJbml0KCk6IHZvaWQge1xyXG4gICAgfVxyXG5cclxuICAgIG5nT25EZXN0cm95KCk6IHZvaWQge1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgbGlzdGVuVHJlZVRhYmxlRXZlbnQoKSB7XHJcbiAgICAgICAgdGhpcy50dC5yZW1vdmVkLnN1YnNjcmliZShyb3dOb2RlID0+IHtcclxuXHJcbiAgICAgICAgICAgIGlmIChyb3dOb2RlICYmIHJvd05vZGUucGFyZW50KSB7XHJcbiAgICAgICAgICAgICAgICByb3dOb2RlLnBhcmVudC5sZWFmID0gIShyb3dOb2RlLnBhcmVudC5jaGlsZHJlbiAmJiByb3dOb2RlLnBhcmVudC5jaGlsZHJlbi5sZW5ndGgpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHJvd05vZGUucGFyZW50LmxlYWYpIHtcclxuICAgICAgICAgICAgICAgICAgICByb3dOb2RlLnBhcmVudC5pY29uID0gdGhpcy5HUk9VUF9IRUFERVJfSUNPTjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKCFyb3dOb2RlLm5vZGUuZGF0YS5ncm91cEhlYWRlcikge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgaHhsID0gdGhpcy5nZXRIb3VYdWFuTm9kZSgpO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmICghcm93Tm9kZS5wYXJlbnQpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnRyZWVEYXRhID0gdGhpcy50cmVlRGF0YS5maWx0ZXIobiA9PiBuLmRhdGEuaWQgIT09IHJvd05vZGUuaWQpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHRoaXMudHQuYXBwZW5kKHJvd05vZGUubm9kZS5kYXRhLCBoeGwubm9kZSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICBcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGluaXRUcmVlbm9kZUNvbnRleHRNZW51cygpIHtcclxuICAgICAgICB0aGlzLmNvbnRleHRNZW51cyA9IFtcclxuICAgICAgICAgICAgeyBpZDogMSwgdGl0bGU6IHRoaXMubGFuZ3VhZ2VSZXMuY29udGV4dE1lbnVzLm5ldywgaWNvbjogJ2YtaWNvbiBmLWljb24tYWRkJywgXHJcbiAgICAgICAgICAgICAgICBoYW5kbGU6ICh0KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2codCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5hZGROZXdHcm91cCh0LmRhdGEsIGZhbHNlKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgeyBpZDogMiwgdGl0bGU6IHRoaXMubGFuZ3VhZ2VSZXMuY29udGV4dE1lbnVzLm5ld0NoaWxkLCB2aXNpYmxlOiAodDogYW55KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuaXNHcm91cEhlYWRlcih0LmRhdGEpICYmIHQuZGF0YS5sZXZlbCArIDEgPCB0aGlzLmRnLm1heE11bHRpSGVhZGVycyAtIDE7XHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgaGFuZGxlOiAodCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYWRkTmV3R3JvdXAodC5kYXRhLCB0cnVlKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgeyBpZDogMywgdGl0bGU6IHRoaXMubGFuZ3VhZ2VSZXMuY29udGV4dE1lbnVzLnNldERhdGFGaWVsZCwgdmlzaWJsZTogKHQ6IGFueSkgPT4ge3JldHVybiB0aGlzLmlzR3JvdXBIZWFkZXIodC5kYXRhKSB9LFxyXG4gICAgICAgICAgICAgICAgaGFuZGxlOiAodCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0Q29sdW1uc0Zvckdyb3VwSGVhZGVyKG51bGwsIHQuZGF0YSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHsgaWQ6IDMxLCB0aXRsZTogdGhpcy5sYW5ndWFnZVJlcy5jb250ZXh0TWVudXMucmVuYW1lLCBpY29uOiAnZi1pY29uIGYtaWNvbi1lZGl0JywgXHJcbiAgICAgICAgICAgICAgICBoYW5kbGU6ICh0KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZXNldEhlYWRlck5hbWUobnVsbCwgdC5kYXRhKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgJy0nLFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpZDogNCwgdGl0bGU6IHRoaXMubGFuZ3VhZ2VSZXMuY29udGV4dE1lbnVzLnRvcCwgaWNvbjogJ2YtaWNvbiBmLWljb24tcm9vZmluZycsIFxyXG4gICAgICAgICAgICAgICAgdmlzaWJsZTogKHQ6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLm1vdmVNZW51SXRlbVZpc2libGlseSh0LmRhdGEpO1xyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIGhhbmRsZTogKHQpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLm1vdmVUb3AobnVsbCwgdC5kYXRhKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaWQ6IDUsIHRpdGxlOiB0aGlzLmxhbmd1YWdlUmVzLmNvbnRleHRNZW51cy51cCwgaWNvbjogJ2YtaWNvbiBmLWljb24tYXJyb3ctY2hldnJvbi11cCcsXHJcbiAgICAgICAgICAgICAgICB2aXNpYmxlOiAodDogYW55KSA9PiB7cmV0dXJuIHRoaXMubW92ZU1lbnVJdGVtVmlzaWJsaWx5KHQuZGF0YSl9LFxyXG4gICAgICAgICAgICAgICAgaGFuZGxlOiAodCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMubW92ZVVwKG51bGwsIHQuZGF0YSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGlkOiA2LCB0aXRsZTogdGhpcy5sYW5ndWFnZVJlcy5jb250ZXh0TWVudXMuZG93biwgaWNvbjogJ2YtaWNvbiBmLWljb24tYXJyb3ctY2hldnJvbi1kb3duJyxcclxuICAgICAgICAgICAgICAgIHZpc2libGU6ICh0OiBhbnkpID0+IHtyZXR1cm4gdGhpcy5tb3ZlTWVudUl0ZW1WaXNpYmxpbHkodC5kYXRhKX0sXHJcbiAgICAgICAgICAgICAgICBoYW5kbGU6ICh0KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5tb3ZlRG93bihudWxsLCB0LmRhdGEpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpZDogNywgdGl0bGU6IHRoaXMubGFuZ3VhZ2VSZXMuY29udGV4dE1lbnVzLmJvdHRvbSwgaWNvbjogJ2YtaWNvbiBmLWljb24tYm90dG9tc2V0dGluZycsXHJcbiAgICAgICAgICAgICAgICB2aXNpYmxlOiAodDogYW55KSA9PiB7cmV0dXJuIHRoaXMubW92ZU1lbnVJdGVtVmlzaWJsaWx5KHQuZGF0YSl9LFxyXG4gICAgICAgICAgICAgICAgaGFuZGxlOiAodCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMubW92ZUJvdHRvbShudWxsLCB0LmRhdGEpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAnLScsXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGlkOiA4LCB0aXRsZTogdGhpcy5sYW5ndWFnZVJlcy5jb250ZXh0TWVudXMucmVtb3ZlLCBpY29uOiAnZi1pY29uIGYtaWNvbi1taW51cycsXHJcbiAgICAgICAgICAgICAgICB2aXNpYmxlOiAodCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAhdC5kYXRhLm5vZGUuZGF0YS5ob3V4dWFucXVOb2RlICYmICF0LmRhdGEubm9kZS5kYXRhLmdyb3VwSGVhZGVyO1xyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIGhhbmRsZTogKHQpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnR0LnJlbW92ZSh0LmRhdGEuaWQpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpZDogOSwgdGl0bGU6IHRoaXMubGFuZ3VhZ2VSZXMuY29udGV4dE1lbnVzLmNhbmNlbEdyb3VwLCBpY29uOiAnZi1pY29uIGYtaWNvbi14JyxcclxuICAgICAgICAgICAgICAgIHZpc2libGU6ICh0KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHQuZGF0YS5ub2RlLmRhdGEuZ3JvdXBIZWFkZXI7XHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgaGFuZGxlOiAodCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMucmVtb3ZlR3JvdXAobnVsbCwgdC5kYXRhKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIF07XHJcbiAgICB9XHJcblxyXG4gICAgLyoqIOenu+WKqOWRveS7pOmhueaYr+WQpuaYvuekuiAqL1xyXG4gICAgbW92ZU1lbnVJdGVtVmlzaWJsaWx5ID0gKHQ6IFJvd05vZGUpID0+IHtcclxuICAgICAgICBpZiAodCkge1xyXG4gICAgICAgICAgICBjb25zdCByb3dEYXRhID0gdC5ub2RlLmRhdGE7XHJcbiAgICAgICAgICAgIGlmIChyb3dEYXRhKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcm93RGF0YVsnaWQnXSAhPSB0aGlzLkhPVV9YVUFOX0xJRV9JRDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9XHJcblxyXG4gICAgaXNHcm91cEhlYWRlciA9ICh0OiBSb3dOb2RlKSA9PiB7XHJcbiAgICAgICAgaWYgKHQpIHtcclxuICAgICAgICAgICAgY29uc3Qgcm93RGF0YSA9IHQubm9kZS5kYXRhO1xyXG4gICAgICAgICAgICBpZiAocm93RGF0YSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuICEhcm93RGF0YVsnZ3JvdXBIZWFkZXInXTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9XHJcblxyXG4gICAgaW5pdFRyZWVEYXRhKCkge1xyXG5cclxuICAgICAgICBpZiAodGhpcy5vcHRpb25zKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHsgdHJlZURhdGEgfSA9IHRoaXMub3B0aW9ucztcclxuXHJcbiAgICAgICAgICAgIGlmICh0cmVlRGF0YSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy50cmVlRGF0YSA9IHRyZWVEYXRhO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodGhpcy5vcHRpb25zLmNvbHVtbnMgJiYgdGhpcy5vcHRpb25zLmNvbHVtbnMubGVuZ3RoID4gMSkge1xyXG4gICAgICAgICAgICBjb25zdCBfdHJlZURhdGEgPSBjb2x1bW5zVG9UcmVlTm9kZXMoY2xvbmVEZWVwKHRoaXMub3B0aW9ucy5jb2x1bW5zKSk7XHJcbiAgICAgICAgICAgIGNvbnN0IGhvdVh1YW5MaWUgPSB0aGlzLmZpZWxkcy5maWx0ZXIoZiA9PiAhZmxhdHRlbih0aGlzLm9wdGlvbnMuY29sdW1ucykuZmluZChjb2wgPT4gY29sLmZpZWxkID09PSBmLmZpZWxkKSkubWFwKChhOmFueSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgICAgICBkYXRhOiBhLFxyXG4gICAgICAgICAgICAgICAgICAgIGNoaWxkcmVuOiBbXSxcclxuICAgICAgICAgICAgICAgICAgICB2aXNpYmxlOiB0cnVlXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBfdHJlZURhdGEucHVzaCh7XHJcbiAgICAgICAgICAgICAgICBkYXRhOiB0aGlzLkhvdV9YdWFuX1F1LFxyXG4gICAgICAgICAgICAgICAgY2hpbGRyZW46IGhvdVh1YW5MaWUsXHJcbiAgICAgICAgICAgICAgICBleHBhbmRlZDogdHJ1ZVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgdGhpcy50cmVlRGF0YSA9IF90cmVlRGF0YTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLnRyZWVEYXRhID0gW3tcclxuICAgICAgICAgICAgICAgIGRhdGE6IHsgaWQ6ICdncm91cEhlYWRlcl8xJywgdGl0bGU6IHRoaXMubGFuZ3VhZ2VSZXMuZGVmYXVsdEdyb3VwSGVhZGVyTmFtZSwgaGFsaWduOiAnbGVmdCcsIGdyb3VwSGVhZGVyOiB0cnVlIH0sXHJcbiAgICAgICAgICAgICAgICBjaGlsZHJlbjogdGhpcy5maWVsZHMubWFwKChuLCBpKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgblsnaW5kZXgnXSA9IGk7XHJcbiAgICAgICAgICAgICAgICAgICAgblsnaWQnXSA9IG5bJ2ZpZWxkJ107XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YTogbixcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2hpbGRyZW46IFtdLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2aXNpYmxlOiB0cnVlXHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgIH0pLFxyXG4gICAgICAgICAgICAgICAgaWNvbjogdGhpcy5HUk9VUF9IRUFERVJfSUNPTixcclxuICAgICAgICAgICAgICAgIGV4cGFuZGVkOiB0cnVlLCB2aXNpYmxlOiB0cnVlXHJcbiAgICAgICAgICAgIH0sIHtcclxuICAgICAgICAgICAgICAgIGRhdGE6IHRoaXMuSG91X1h1YW5fUXUsXHJcbiAgICAgICAgICAgICAgICBjaGlsZHJlbjogW10sXHJcbiAgICAgICAgICAgICAgICBleHBhbmRlZDogdHJ1ZSxcclxuICAgICAgICAgICAgICAgIGljb246IHRoaXMuR1JPVVBfSEVBREVSX0lDT05cclxuICAgICAgICAgICAgfV07XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZ2V0SG91WHVhbk5vZGUoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMudHQuZmluZFJvd05vZGUodGhpcy5IT1VfWFVBTl9MSUVfSUQpO1xyXG4gICAgfVxyXG5cclxuICAgIG9uVHJlZVNlbGVjdGVkKCRldmVudCkge1xyXG4gICAgICAgIHRoaXMubm9kZVNlbGVjdGVkLmVtaXQoJGV2ZW50KTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHNob3dOZXdIZWFkZXJEaWFsb2cob2tDYWxsYmFjaywgZGxnVGl0bGUpIHtcclxuICAgICAgICBjb25zdCBtb2RhbFJlZiA9IHRoaXMubW9kYWxTZXJ2aWNlLnNob3coTmV3SGVhZGVyRm9ybUNvbXBvbmVudCwge1xyXG4gICAgICAgICAgICB0aXRsZTogZGxnVGl0bGUsXHJcbiAgICAgICAgICAgIHdpZHRoOiAzNDAsXHJcbiAgICAgICAgICAgIGhlaWdodDogMTkwLFxyXG4gICAgICAgICAgICBzaG93TWF4QnV0dG9uOiBmYWxzZSxcclxuICAgICAgICAgICAgcmVzaXphYmxlOiBmYWxzZSxcclxuICAgICAgICAgICAgaW5pdGlhbFN0YXRlOiB7XHJcbiAgICAgICAgICAgICAgICB0aXRsZTogJycsXHJcbiAgICAgICAgICAgICAgICBwbGFjZWhvbGRlcjogdGhpcy5sYW5ndWFnZVJlcy5uZXdIZWFkZXJQbGFjZWhvbGRlcixcclxuICAgICAgICAgICAgICAgIGxhYmVsOiB0aGlzLmxhbmd1YWdlUmVzLm5ld0hlYWRlckxhYmVsXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGJ1dHRvbnM6IFtcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICB0ZXh0OiB0aGlzLmxhbmd1YWdlUmVzLmNhbmNlbCxcclxuICAgICAgICAgICAgICAgICAgICBjbHM6ICdidG4gYnRuLXNlY29uZGFyeScsXHJcbiAgICAgICAgICAgICAgICAgICAgaGFuZGxlOiAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1vZGFsUmVmLmNsb3NlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICB0ZXh0OiB0aGlzLmxhbmd1YWdlUmVzLm9rLFxyXG4gICAgICAgICAgICAgICAgICAgIGNsczogJ2J0biBidG4tcHJpbWFyeScsXHJcbiAgICAgICAgICAgICAgICAgICAgaGFuZGxlOiBva0NhbGxiYWNrXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIF1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgcmV0dXJuIG1vZGFsUmVmO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZ2VuZXJhdGVHcm91cEhlYWRlcklkKCkge1xyXG4gICAgICAgIHJldHVybiBgZ3JvdXBIZWFkZXJfJHtuZXcgRGF0ZSgpLmdldFRpbWUoKX1gO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgY3JlYXRlTmV3R3JvdXBIZWFkZXIocm46IFJvd05vZGUsIHRpdGxlOiBzdHJpbmcsIGNoaWxkID0gZmFsc2UpIHtcclxuICAgICAgICBjb25zdCBnaGlkID0gdGhpcy5nZW5lcmF0ZUdyb3VwSGVhZGVySWQoKTtcclxuICAgICAgICBjb25zdCBkYXRhID0geyBpZDogZ2hpZCwgdGl0bGUsIGdyb3VwSGVhZGVyOiB0cnVlLCBoYWxpZ246ICdsZWZ0JywgZml4ZWQ6ICdVTkZJWEVEJyB9O1xyXG4gICAgICAgIGNvbnN0IGdoID0ge1xyXG4gICAgICAgICAgICBkYXRhLFxyXG4gICAgICAgICAgICBjaGlsZHJlbjogW10sXHJcbiAgICAgICAgICAgIGV4cGFuZGVkOiB0cnVlLFxyXG4gICAgICAgICAgICB2aXNpYmxlOiB0cnVlLFxyXG4gICAgICAgICAgICBpY29uOiB0aGlzLkdST1VQX0hFQURFUl9JQ09OLFxyXG4gICAgICAgIH07XHJcbiAgICAgICAgaWYgKCFjaGlsZCkge1xyXG4gICAgICAgICAgICBpZiAoIXJuLnBhcmVudCkge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgaSA9IHRoaXMudHJlZURhdGEuZmluZEluZGV4KG4gPT4gbi5kYXRhLmlkID09PSBybi5pZCkgKyAxO1xyXG4gICAgICAgICAgICAgICAgdGhpcy50cmVlRGF0YS5zcGxpY2UoaSwgMCwgZ2gpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy50cmVlRGF0YSA9IHRoaXMudHJlZURhdGEuc2xpY2UoKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGdoLmRhdGEuZml4ZWQgPSBybi5wYXJlbnQuZGF0YS5maXhlZDtcclxuICAgICAgICAgICAgICAgIHRoaXMudHQuYXBwZW5kQ2hpbGRyZW4oW2doXSwgcm4ucGFyZW50KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGdoLmRhdGEuZml4ZWQgPSBybi5ub2RlLmRhdGEuZml4ZWQ7XHJcbiAgICAgICAgICAgIHRoaXMudHQuYXBwZW5kQ2hpbGRyZW4oW2doXSwgcm4ubm9kZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8vIOWIoOmZpOWIhue7hFxyXG4gICAgcmVtb3ZlR3JvdXAoZXZlbnQ6IE1vdXNlRXZlbnQsIHJvd05vZGUpIHtcclxuICAgICAgICBpZiAodGhpcy50dC5zZWxlY3RlZFJvdyAmJiByb3dOb2RlLmlkID09PSB0aGlzLnR0LnNlbGVjdGVkUm93LmlkKSB7XHJcbiAgICAgICAgICAgIHRoaXMubm9kZVNlbGVjdGVkLmVtaXQobnVsbCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IGNoaWxkcyA9IHRoaXMudHQuc2VyaWFsaXplZFZhbHVlLmZpbHRlcihuID0+IG4ucGFyZW50cy5pbmRleE9mKHJvd05vZGUuaWQpID4gLTEgJiYgIW4ubm9kZS5kYXRhLmdyb3VwSGVhZGVyKS5tYXAobiA9PiBuLm5vZGUpO1xyXG4gICAgICAgIHRoaXMudHJlZURhdGEgPSB0aGlzLnRyZWVEYXRhLmZpbHRlcihuID0+IG4uZGF0YS5pZCAhPT0gcm93Tm9kZS5pZCk7XHJcblxyXG4gICAgICAgIHRoaXMudHQucmVtb3ZlKHJvd05vZGUuaWQpO1xyXG4gICAgICAgIHRoaXMudHQuYXBwZW5kQ2hpbGRyZW4oY2hpbGRzLCB0aGlzLmdldEhvdVh1YW5Ob2RlKCkubm9kZSk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8g5paw5aKe5YiG57uEXHJcbiAgICBhZGROZXdHcm91cChybjogUm93Tm9kZSwgY2hpbGQgPSBmYWxzZSkge1xyXG4gICAgICAgIGNvbnN0IG1vZGFsUmVmID0gdGhpcy5zaG93TmV3SGVhZGVyRGlhbG9nKCgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgZ2hmUmVmID0gbW9kYWxSZWYuY29udGVudCBhcyBOZXdIZWFkZXJGb3JtQ29tcG9uZW50O1xyXG4gICAgICAgICAgICBpZiAoZ2hmUmVmLnRpdGxlKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoIXJuIHx8IHJuLmlkID09PSB0aGlzLkhPVV9YVUFOX0xJRV9JRCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMudHJlZURhdGEuc3BsaWNlKDAsIDAsIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YToge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IHRoaXMuZ2VuZXJhdGVHcm91cEhlYWRlcklkKCksIGhhbGlnbjogJ2xlZnQnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6IGdoZlJlZi50aXRsZSwgZ3JvdXBIZWFkZXI6IHRydWUsIGZpeGVkOiAnVU5GSVhFRCdcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWNvbjogdGhpcy5HUk9VUF9IRUFERVJfSUNPTixcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2hpbGRyZW46IFtdXHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy50dC51cGRhdGVTZXJpYWxpemVkVmFsdWUoKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jcmVhdGVOZXdHcm91cEhlYWRlcihybiwgZ2hmUmVmLnRpdGxlLCBjaGlsZCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgbW9kYWxSZWYuY2xvc2UoKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRoaXMubm90aXR5U2VyLmluZm8odGhpcy5sYW5ndWFnZVJlcy5yZXF1aXJlZCk7XHJcbiAgICAgICAgICAgICAgICBnaGZSZWYuaW5wdXQubmF0aXZlRWxlbWVudC5mb2N1cygpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICB9LCBjaGlsZD8gdGhpcy5sYW5ndWFnZVJlcy5jb250ZXh0TWVudXMubmV3Q2hpbGQ6IHRoaXMubGFuZ3VhZ2VSZXMuY29udGV4dE1lbnVzLm5ldyk7XHJcblxyXG4gICAgfVxyXG5cclxuICAgIC8vIOaYvuekuuabtOaWsOaMiemSrlxyXG4gICAgb25Nb3JlQnRuQ2xpY2soJGV2ZW50OiBNb3VzZUV2ZW50LCBub2RlRGF0YSkge1xyXG4gICAgICAgIGlmIChub2RlRGF0YSAmJiBub2RlRGF0YS5pZCkge1xyXG4gICAgICAgICAgICB0aGlzLnR0LnNlbGVjdE5vZGUobm9kZURhdGEuaWQpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLnR0LmN0eE1lbnUub25Db250ZXh0TWVudSgkZXZlbnQpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZ2V0Q2FuU2VsZWN0Q29sdW1ucyhyb3dOb2RlOiBSb3dOb2RlKSB7XHJcbiAgICAgICAgLy8g5Y+v5YiG6YWN5YiXXHJcbiAgICAgICAgLy8g5YCZ6YCJ5Yy65pWw5o2uICsg5a2Q6IqC54K5XHJcblxyXG4gICAgICAgIGNvbnN0IGh4bCA9IHRoaXMuZ2V0SG91WHVhbk5vZGUoKTtcclxuICAgICAgICBsZXQgZmllbGRzID0gcm93Tm9kZSA/IHJvd05vZGUubm9kZS5jaGlsZHJlbiA6IFtdO1xyXG4gICAgICAgIGZpZWxkcyA9IGZpZWxkcy5maWx0ZXIoKG46IFRyZWVOb2RlKSA9PiAhbi5kYXRhLmdyb3VwSGVhZGVyKVxyXG4gICAgICAgIHJldHVybiBoeGwubm9kZS5jaGlsZHJlbi5jb25jYXQoZmllbGRzKS5tYXAobiA9PiBuLmRhdGEpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgc2hvd1NldENvbHVtbnNEaWFsb2cob2tDYWxsYmFjaywgc2VsZWN0ZWRJdGVtcywgcm93Tm9kZTogUm93Tm9kZSkge1xyXG4gICAgICAgIGNvbnN0IG1vZGFsUmVmID0gdGhpcy5tb2RhbFNlcnZpY2Uuc2hvdyhTZXRDb2x1bW5zQ29tcG9uZW50LCB7XHJcbiAgICAgICAgICAgIHRpdGxlOiB0aGlzLmxhbmd1YWdlUmVzLmNvbnRleHRNZW51cy5zZXREYXRhRmllbGQsXHJcbiAgICAgICAgICAgIHdpZHRoOiA2MDAsXHJcbiAgICAgICAgICAgIGhlaWdodDogNTAwLFxyXG4gICAgICAgICAgICBzaG93TWF4QnV0dG9uOiBmYWxzZSxcclxuICAgICAgICAgICAgcmVzaXphYmxlOiBmYWxzZSxcclxuICAgICAgICAgICAgaW5pdGlhbFN0YXRlOiB7XHJcbiAgICAgICAgICAgICAgICBkYXRhOiB0aGlzLmdldENhblNlbGVjdENvbHVtbnMocm93Tm9kZSksXHJcbiAgICAgICAgICAgICAgICBjaGVja2VkSXRlbXM6IHNlbGVjdGVkSXRlbXMsXHJcbiAgICAgICAgICAgICAgICBncm91cEVkaXRvclJlZjogdGhpc1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBidXR0b25zOiBbXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGV4dDogdGhpcy5sYW5ndWFnZVJlcy5jYW5jZWwsXHJcbiAgICAgICAgICAgICAgICAgICAgY2xzOiAnYnRuIGJ0bi1zZWNvbmRhcnknLFxyXG4gICAgICAgICAgICAgICAgICAgIGhhbmRsZTogKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBtb2RhbFJlZi5jbG9zZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGV4dDogdGhpcy5sYW5ndWFnZVJlcy5vayxcclxuICAgICAgICAgICAgICAgICAgICBjbHM6ICdidG4gYnRuLXByaW1hcnknLFxyXG4gICAgICAgICAgICAgICAgICAgIGhhbmRsZTogKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBva0NhbGxiYWNrKG1vZGFsUmVmLmNvbnRlbnQuc2VsZWN0ZWRJZHMpXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBdXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHJldHVybiBtb2RhbFJlZjtcclxuICAgIH1cclxuXHJcbiAgICAvKiog5Li65YiG57uE6KGo5aS05YiG6YWN5pWw5o2u5YiXICovXHJcbiAgICBzZXRDb2x1bW5zRm9yR3JvdXBIZWFkZXIoJGV2ZW50LCByb3dOb2RlOiBSb3dOb2RlKSB7XHJcbiAgICAgICAgY29uc3QgY2hpbGRzID0gcm93Tm9kZSA/IHJvd05vZGUubm9kZS5jaGlsZHJlbiA/IHJvd05vZGUubm9kZS5jaGlsZHJlbi5tYXAobiA9PiBuLmRhdGEpIDogW10gOiBbXTtcclxuICAgICAgICBjb25zdCBtb2RhbFJlZiA9IHRoaXMuc2hvd1NldENvbHVtbnNEaWFsb2coKHNlbGVjdGVkSWRzOiBzdHJpbmdbXSkgPT4ge1xyXG4gICAgICAgICAgICAvLyDliIbnu4TkuIvnmoTliJdcclxuICAgICAgICAgICAgY29uc3QgY29scyA9IHNlbGVjdGVkSWRzLm1hcChuID0+IHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmZpZWxkcy5maW5kKGYgPT4gZi5maWVsZCA9PSBuKTtcclxuICAgICAgICAgICAgfSkuZmlsdGVyKG4gPT4gbik7XHJcbiAgICAgICAgICAgIC8vIOWAmemAieWMulxyXG4gICAgICAgICAgICBjb25zdCBoeGwgPSB0aGlzLmdldEhvdVh1YW5Ob2RlKCk7XHJcbiAgICAgICAgICAgIC8vIOa4heeQhuWAmemAieaVsOaNru+8jOWwhuW3suWIhumFjeeahOWIl+WcqOWAmemAieWMuuenu+mZpFxyXG4gICAgICAgICAgICBoeGwubm9kZS5jaGlsZHJlbiA9IChoeGwubm9kZS5jaGlsZHJlbiB8fCBbXSkuZmlsdGVyKG4gPT4gY29scy5maW5kSW5kZXgoYyA9PiBjLmZpZWxkID09IG4uaWQpID09PSAtMSk7XHJcblxyXG4gICAgICAgICAgICAvLyDmn6Xmib7pnIDopoHnp7vpmaTnmoRcclxuICAgICAgICAgICAgY29uc3QgbmVlZFJlbW92ZU5vZGVzID0gKHJvd05vZGUubm9kZS5jaGlsZHJlbiB8fCBbXSkuZmlsdGVyKCAobikgPT4ge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuICFuLmRhdGEuZ3JvdXBIZWFkZXIgJiYgY29scy5maW5kSW5kZXgoKGMpID0+IGMuZmllbGQgPT09IG4uaWQpID09IC0xXHJcbiAgICAgICAgICAgIH0pLmZpbHRlcihuID0+IG4pO1xyXG5cclxuICAgICAgICAgICAgaWYgKG5lZWRSZW1vdmVOb2RlcyAmJiBuZWVkUmVtb3ZlTm9kZXMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICBuZWVkUmVtb3ZlTm9kZXMuZm9yRWFjaChuID0+IHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnR0LnJlbW92ZShuLmlkKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyDmn6Xmib7pnIDopoHmlrDlop7nmoRcclxuICAgICAgICAgICAgY29uc3QgbmVlZEFwcGVuZE5vZGVzID0gY29scy5maWx0ZXIobiA9PiAgKHJvd05vZGUubm9kZS5jaGlsZHJlbiB8fCBbXSkuZmluZEluZGV4KGMgPT4gYy5pZCA9PT0gbi5maWVsZCkgPT09IC0xKS5tYXAobiA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAoIW4uaWQpIHtcclxuICAgICAgICAgICAgICAgICAgICBuLmlkID0gbi5maWVsZDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHJldHVybiBuO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgaWYgKG5lZWRBcHBlbmROb2RlcyAmJiBuZWVkQXBwZW5kTm9kZXMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICBuZWVkQXBwZW5kTm9kZXMuZm9yRWFjaChuID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBjb2wgPSB0aGlzLmZpZWxkcy5maW5kKGYgPT4gZi5maWVsZCA9PSBuLmZpZWxkKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoY29sKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbC5maXhlZCA9ICByb3dOb2RlLm5vZGUuZGF0YS5maXhlZDtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICB0aGlzLnR0LmFwcGVuZENoaWxkcmVuKG5lZWRBcHBlbmROb2Rlcy5tYXAobiA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YTogbixcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2hpbGRyZW46IFtdLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBleHBhbmRlZDogdHJ1ZVxyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICB9KSwgcm93Tm9kZS5ub2RlKTtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgdGhpcy50dC5leHBhbmROb2RlKHJvd05vZGUuaWQpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyDmm7TmlrDlvoXpgInljLpcclxuICAgICAgICAgICAgY29uc3QgaHhsQ29scyA9IG5lZWRSZW1vdmVOb2Rlcy5tYXAobiA9PiB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGRhdGE6IG4uZGF0YSxcclxuICAgICAgICAgICAgICAgICAgICBjaGlsZHJlbjogW11cclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB0aGlzLnR0LmFwcGVuZENoaWxkcmVuKGh4bENvbHMsIGh4bC5ub2RlKTtcclxuXHJcbiAgICAgICAgICAgIG1vZGFsUmVmLmNsb3NlKCk7XHJcbiAgICAgICAgfSwgY2hpbGRzLCByb3dOb2RlKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyDlsIblvoXpgInljLrkuK3nmoTmlbDmja7liJfnm7TmjqXorr7kuLrooajlpLRcclxuICAgIHNldENvbHVtbkhlYWRlcihldmVudDogTW91c2VFdmVudCwgY29sKSB7XHJcbiAgICAgICAgY29uc3QgaSA9IHRoaXMudHJlZURhdGEubGVuZ3RoIC0gMTtcclxuICAgICAgICB0aGlzLnRyZWVEYXRhLnNwbGljZShpLCAwLCB7ICBkYXRhOiBjb2wsIGNoaWxkcmVuOiBbXSB9KTtcclxuXHJcbiAgICAgICAgY29uc3QgaHhsID0gdGhpcy5nZXRIb3VYdWFuTm9kZSgpO1xyXG4gICAgICAgIGlmIChoeGwpIHtcclxuICAgICAgICAgICAgaHhsLm5vZGUuY2hpbGRyZW4gPSBoeGwubm9kZS5jaGlsZHJlbi5maWx0ZXIobiA9PiBuLmRhdGEuaWQgIT09IGNvbC5pZCk7XHJcbiAgICAgICAgICAgIGh4bC5ub2RlLmxlYWYgPSAhKGh4bC5ub2RlLmNoaWxkcmVuICYmIGh4bC5ub2RlLmNoaWxkcmVuLmxlbmd0aCk7XHJcbiAgICAgICAgICAgIGlmIChoeGwubm9kZS5sZWFmKSB7XHJcbiAgICAgICAgICAgICAgICBoeGwubm9kZS5pY29uID0gdGhpcy5HUk9VUF9IRUFERVJfSUNPTjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLnR0LmNsZWFyU2VsZWN0aW9ucygpO1xyXG4gICAgICAgICAgICB0aGlzLnR0LnVwZGF0ZVNlcmlhbGl6ZWRWYWx1ZSgpO1xyXG4gICAgICAgICAgICB0aGlzLnR0LnNlbGVjdE5vZGUoY29sLmlkLCB0cnVlKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICB9XHJcbiAgICBcclxuICAgIG1vdmVVcChldmVudDogTW91c2VFdmVudCwgcm93Tm9kZSkge1xyXG4gICAgICAgIGxldCBkYXRhID0gdGhpcy50cmVlRGF0YTtcclxuICAgICAgICBpZiAocm93Tm9kZS5wYXJlbnQpIHtcclxuICAgICAgICAgICAgZGF0YSA9IHJvd05vZGUucGFyZW50LmNoaWxkcmVuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgaW5kZXggPSBkYXRhLmZpbmRJbmRleChuID0+IG4uZGF0YS5pZCA9PT0gcm93Tm9kZS5pZCk7XHJcbiAgICAgICAgaWYgKGluZGV4ICE9PSAwKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHRlbXBBcnIgPSBkYXRhLnNwbGljZShpbmRleCwgMSk7XHJcbiAgICAgICAgICAgIGRhdGEuc3BsaWNlKGluZGV4IC0gMSwgMCwgLi4udGVtcEFycik7XHJcblxyXG4gICAgICAgICAgICB0aGlzLnR0LnVwZGF0ZVNlcmlhbGl6ZWRWYWx1ZSgpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBtb3ZlRG93bihldmVudDogTW91c2VFdmVudCwgcm93Tm9kZSkge1xyXG4gICAgICAgIGxldCBkYXRhID0gdGhpcy50cmVlRGF0YTtcclxuICAgICAgICBpZiAocm93Tm9kZS5wYXJlbnQpIHtcclxuICAgICAgICAgICAgZGF0YSA9IHJvd05vZGUucGFyZW50LmNoaWxkcmVuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCBpbmRleCA9IGRhdGEuZmluZEluZGV4KG4gPT4gbi5kYXRhLmlkID09PSByb3dOb2RlLmlkKTtcclxuICAgICAgICBjb25zdCBsZW4gPSBkYXRhLmxlbmd0aDtcclxuXHJcbiAgICAgICAgaWYgKGluZGV4ICE9PSBsZW4gLSAyKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHRlbXBBcnIgPSBkYXRhLnNwbGljZShpbmRleCwgMSk7XHJcbiAgICAgICAgICAgIGRhdGEuc3BsaWNlKGluZGV4ICsgMSwgMCwgLi4udGVtcEFycik7XHJcbiAgICAgICAgICAgIHRoaXMudHQudXBkYXRlU2VyaWFsaXplZFZhbHVlKCk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5tb3ZlQm90dG9tKGV2ZW50LCByb3dOb2RlKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgbW92ZVRvcChldmVudDogTW91c2VFdmVudCwgcm93Tm9kZSkge1xyXG4gICAgICAgIGxldCBkYXRhID0gdGhpcy50cmVlRGF0YTtcclxuICAgICAgICBpZiAocm93Tm9kZS5wYXJlbnQpIHtcclxuICAgICAgICAgICAgZGF0YSA9IHJvd05vZGUucGFyZW50LmNoaWxkcmVuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCBpbmRleCA9IGRhdGEuZmluZEluZGV4KG4gPT4gbi5kYXRhLmlkID09PSByb3dOb2RlLmlkKTtcclxuICAgICAgICBkYXRhLnVuc2hpZnQocm93Tm9kZS5ub2RlKTtcclxuICAgICAgICBkYXRhLnNwbGljZShpbmRleCArIDEsIDEpO1xyXG4gICAgICAgIHRoaXMudHQudXBkYXRlU2VyaWFsaXplZFZhbHVlKCk7XHJcbiAgICB9XHJcblxyXG4gICAgbW92ZUJvdHRvbShldmVudDogTW91c2VFdmVudCwgcm93Tm9kZSkge1xyXG4gICAgICAgIGxldCBkYXRhID0gdGhpcy50cmVlRGF0YTtcclxuICAgICAgICBpZiAocm93Tm9kZS5wYXJlbnQpIHtcclxuICAgICAgICAgICAgZGF0YSA9IHJvd05vZGUucGFyZW50LmNoaWxkcmVuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgaW5kZXggPSBkYXRhLmZpbmRJbmRleChuID0+IG4uZGF0YS5pZCA9PT0gcm93Tm9kZS5pZCk7XHJcbiAgICAgICAgZGF0YS5wdXNoKHJvd05vZGUubm9kZSk7XHJcbiAgICAgICAgZGF0YS5zcGxpY2UoaW5kZXgsIDEpO1xyXG5cclxuICAgICAgICBpZiAoIXJvd05vZGUucGFyZW50KSB7XHJcbiAgICAgICAgICAgIHRoaXMubW92ZVVwKGV2ZW50LCByb3dOb2RlKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLnR0LnVwZGF0ZVNlcmlhbGl6ZWRWYWx1ZSgpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvKiog6I635Y+W5aSa6KGo5aS05pWw5o2uICovXHJcbiAgICBnZXRQcmV2aWV3R3JvdXBDb2x1bW5zKCkge1xyXG4gICAgICAgIGNvbnN0IHRyZWVOb2RlcyA9IHRoaXMuZ2V0QWxsTm9kZXMoKTtcclxuICAgICAgICByZXR1cm4gdGhpcy5jb252ZXJ0MkFycmF5KHRyZWVOb2Rlcyk7IFxyXG4gICAgfVxyXG5cclxuICAgICAvKiog6I635Y+W5YCZ6YCJ5YiXICovXHJcbiAgICAgZ2V0SG91WHVhbkZpZWxkcygpIHtcclxuICAgICAgICBjb25zdCBoeGwgPSB0aGlzLnRyZWVEYXRhLmZpbmQobiA9PiBuLmRhdGEuaG91eHVhbnF1Tm9kZSk7XHJcbiAgICAgICAgaWYgKGh4bCkge1xyXG4gICAgICAgICAgICByZXR1cm4gaHhsLmNoaWxkcmVuO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiBbXTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBnZXRBbGxOb2RlcygpIHtcclxuICAgICAgICBjb25zdCBoeGwgPSB0aGlzLmdldEhvdVh1YW5GaWVsZHMoKTtcclxuICAgICAgICByZXR1cm4gdGhpcy50dC5zZXJpYWxpemVkVmFsdWUuZmlsdGVyKG4gPT4ge1xyXG4gICAgICAgICAgICByZXR1cm4gIW4ubm9kZS5kYXRhLmhvdXh1YW5xdU5vZGUgJiYgaHhsLmZpbmRJbmRleChrID0+IGsuZGF0YS5pZCA9PT0gbi5pZCkgPT09IC0xO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKiDlsIbmoJHoioLngrnmlbDmja7ovazmjaLkuLog5aSa6KGo5aS057uT5p6EICovXHJcbiAgICBjb252ZXJ0MkFycmF5KHJvd05vZGVzOiBSb3dOb2RlW10pIHtcclxuICAgICAgICBjb25zdCByID0gW107XHJcbiAgICAgICAgY29uc3QgbWF4QnkgPSAoYXJyLCBmbikgPT4gTWF0aC5tYXgoLi4uYXJyLm1hcCh0eXBlb2YgZm4gPT09ICdmdW5jdGlvbicgPyBmbiA6IHZhbCA9PiB2YWxbZm5dKSk7XHJcbiAgICAgICAgY29uc3QgbWF4bGV2ZWwgPSBtYXhCeShyb3dOb2RlcywgKG4pID0+IG4ubGV2ZWwpIDtcclxuICAgICAgICAvLyDmjpLpmaTmsqHmnInmlbDmja7lrZfmrrXnmoTooajlpLRcclxuICAgICAgICByb3dOb2RlcyA9IHJvd05vZGVzLmZpbHRlcihuID0+IChuLm5vZGUuY2hpbGRyZW4mJiBuLm5vZGUuY2hpbGRyZW4ubGVuZ3RoICYmIG4ubm9kZS5kYXRhLmdyb3VwSGVhZGVyKSB8fCAhbi5ub2RlLmRhdGEuZ3JvdXBIZWFkZXIpO1xyXG5cclxuICAgICAgICAvKipcclxuICAgICAgICAgKiAx44CB5Y+q5pyJ5LiA57uE6KGo5aS077yM5LiU5Zu65a6a5Zyo5bem5L6n5oiW5Y+z5L6n5pe277yM5oyJ5peg5Zu65a6a5YiX5pa55byP5aSE55CGXHJcbiAgICAgICAgICogMuOAgeWPquacieW3puS+p+OAgeWPs+S+p+WbuuWumuWIl+iAjOayoeacieWFtuS7luato+W4uOWIl+aXtu+8jOWPlua2iOWPs+S+p+WbuuWumuWIl1xyXG4gICAgICAgICAqIDPjgIHlj6rmnInlt6bkvqfmiJblj7Pkvqflm7rlrprml7bvvIzmjInml6Dlm7rlrprliJflpITnkIZcclxuICAgICAgICAgKi9cclxuICAgICAgICBjb25zdCBwYXJlbnRzID0gcm93Tm9kZXMuZmlsdGVyKGUgPT4gIWUucGFyZW50KTtcclxuICAgICAgICBpZiAoIXBhcmVudHMuZmlsdGVyKG4gPT4gIW4ubm9kZS5kYXRhLmZpeGVkIHx8IG4ubm9kZS5kYXRhLmZpeGVkID09PSAnVU5GSVhFRCcpLmxlbmd0aCkge1xyXG4gICAgICAgICAgICBjb25zdCBsZWZ0Q29scyA9IHBhcmVudHMuZmlsdGVyKG4gPT4gbi5ub2RlLmRhdGEuZml4ZWQgPT09ICdsZWZ0Jyk7XHJcbiAgICAgICAgICAgIGNvbnN0IHJpZ2h0Q29scyA9IHBhcmVudHMuZmlsdGVyKG4gPT4gbi5ub2RlLmRhdGEuZml4ZWQgPT09ICdyaWdodCcpO1xyXG4gICAgICAgICAgICBpZiAobGVmdENvbHMubGVuZ3RoID09IHBhcmVudHMubGVuZ3RoIHx8IHJpZ2h0Q29scy5sZW5ndGggPT0gcGFyZW50cy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgIHJvd05vZGVzLmZvckVhY2gobiA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHBhcmVudHMuZmluZChwID0+IHAuaWQgPT09IG4uaWQpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG4ubm9kZS5kYXRhLmZpeGVkID0gJydcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGlmIChyaWdodENvbHMubGVuZ3RoID09PSAxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbGVmdENvbHMuZm9yRWFjaCh0ID0+e1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByb3dOb2Rlcy5mb3JFYWNoKG4gPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHQuaWQgPT09IG4uaWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuLm5vZGUuZGF0YS5maXhlZCA9ICcnXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICByaWdodENvbHMuZm9yRWFjaCh0ID0+e1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByb3dOb2Rlcy5mb3JFYWNoKG4gPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHQuaWQgPT09IG4uaWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuLm5vZGUuZGF0YS5maXhlZCA9ICcnXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPD0gbWF4bGV2ZWw7IGkrKyApIHtcclxuICAgICAgICAgICAgci5wdXNoKHJvd05vZGVzLmZpbHRlcihuID0+IG4ubGV2ZWwgPT09IGkpLm1hcChuID0+IHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGRhdGEgPSBuLm5vZGUuZGF0YTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IF9maXhlZCA9IG4ucGFyZW50ID8gdGhpcy50dC5nZXRSb290KG4uaWQpLm5vZGUuZGF0YS5maXhlZCA6ICAoZGF0YS5maXhlZCB8fCAnJyk7XHJcblxyXG5cclxuICAgICAgICAgICAgICAgIGNvbnN0IF9jb2xzcGFuID0gKG4ubm9kZS5jaGlsZHJlbiA/IHJvd05vZGVzLmZpbHRlcihrID0+IGsucGFyZW50cy5pbmRleE9mKG4uaWQpID4gLTEgJiYgay5pZC5pbmRleE9mKCdncm91cEhlYWRlcl8nKSA9PSAtMSkubGVuZ3RoIDogMSkgfHwgMTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IF9yb3dzcGFuID0gKG4ubm9kZS5jaGlsZHJlbiAmJiBuLm5vZGUuY2hpbGRyZW4ubGVuZ3RoID4gMCkgPyAxIDogKG1heGxldmVsIC0gbi5sZXZlbCArIDEpO1xyXG5cclxuICAgICAgICAgICAgICAgIGNvbnN0IG5ld0NvbDogYW55ID0ge1xyXG4gICAgICAgICAgICAgICAgICAgIGZpZWxkOiBkYXRhLmZpZWxkLFxyXG4gICAgICAgICAgICAgICAgICAgIHRpdGxlOiBkYXRhLnRpdGxlLFxyXG4gICAgICAgICAgICAgICAgICAgIHNvcnRhYmxlOiBkYXRhLnNvcnRhYmxlLFxyXG4gICAgICAgICAgICAgICAgICAgIG9yZGVyOiBkYXRhLm9yZGVyLFxyXG4gICAgICAgICAgICAgICAgICAgIGhhbGlnbjogZGF0YS5oYWxpZ24gfHwgJ2xlZnQnLFxyXG4gICAgICAgICAgICAgICAgICAgIGFsaWduOiBkYXRhLmFsaWduIHx8ICdsZWZ0JyxcclxuICAgICAgICAgICAgICAgICAgICB2aXNpYmxlOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgIGFsbG93R3JvdXBpbmc6IGRhdGEuYWxsb3dHcm91cGluZyxcclxuICAgICAgICAgICAgICAgICAgICBncm91cEZvb3RlcjogZGF0YS5ncm91cEZvb3RlcixcclxuICAgICAgICAgICAgICAgICAgICBmb290ZXI6IGRhdGEuZm9vdGVyLFxyXG4gICAgICAgICAgICAgICAgICAgIHdpZHRoOiAoZGF0YS5zaXplID8gZGF0YS5zaXplLndpZHRoIDogMTAwKSxcclxuICAgICAgICAgICAgICAgICAgICBkYXRhVHlwZTogZGF0YS5kYXRhVHlwZSB8fCAnc3RyaW5nJyxcclxuICAgICAgICAgICAgICAgICAgICBmaXhlZDogX2ZpeGVkID09PSAnVU5GSVhFRCc/ICcnOiBfZml4ZWQsXHJcbiAgICAgICAgICAgICAgICAgICAgaWQ6IG4uaWQsXHJcbiAgICAgICAgICAgICAgICAgICAgcGFyZW50SWQ6IG4ubm9kZS5wYXJlbnQgPyBuLm5vZGUucGFyZW50LmlkIDogbnVsbCxcclxuICAgICAgICAgICAgICAgICAgICByb3dzcGFuOiBfcm93c3BhbixcclxuICAgICAgICAgICAgICAgICAgICBjb2xzcGFuOiBfY29sc3BhblxyXG4gICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICBjb25zdCBuZXdDb2wyOiBhbnkgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZmllbGQ6IGRhdGEuZmllbGQsXHJcbiAgICAgICAgICAgICAgICAgICAgdGl0bGU6IGRhdGEudGl0bGUsXHJcbiAgICAgICAgICAgICAgICAgICAgaGFsaWduOiBkYXRhLmhhbGlnbiB8fCAnbGVmdCcsXHJcbiAgICAgICAgICAgICAgICAgICAgYWxpZ246IGRhdGEuYWxpZ24gfHwgJ2xlZnQnLFxyXG4gICAgICAgICAgICAgICAgICAgIHZpc2libGU6IHRydWUsXHJcbiAgICAgICAgICAgICAgICAgICAgZ3JvdXBGb290ZXI6IHt9LFxyXG4gICAgICAgICAgICAgICAgICAgIGZvb3Rlcjoge30sXHJcbiAgICAgICAgICAgICAgICAgICAgd2lkdGg6IChkYXRhLnNpemUgPyBkYXRhLnNpemUud2lkdGggOiAxMDApLFxyXG4gICAgICAgICAgICAgICAgICAgIGRhdGFUeXBlOiBkYXRhLmRhdGFUeXBlIHx8ICdzdHJpbmcnLFxyXG4gICAgICAgICAgICAgICAgICAgIGZpeGVkOiBfZml4ZWQgPT09ICdVTkZJWEVEJz8gJyc6IF9maXhlZCxcclxuICAgICAgICAgICAgICAgICAgICBpZDogbi5pZCxcclxuICAgICAgICAgICAgICAgICAgICBwYXJlbnRJZDogbi5ub2RlLnBhcmVudCA/IG4ubm9kZS5wYXJlbnQuaWQgOiBudWxsLFxyXG4gICAgICAgICAgICAgICAgICAgIHJvd3NwYW46IF9yb3dzcGFuLFxyXG4gICAgICAgICAgICAgICAgICAgIGNvbHNwYW46IF9jb2xzcGFuXHJcbiAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgIHJldHVybiBuLm5vZGUuZGF0YS5ncm91cEhlYWRlciA/ICBuZXdDb2wyOiBuZXdDb2w7XHJcbiAgICAgICAgICAgIH0pKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiByO1xyXG4gICAgfVxyXG5cclxuICAgIG9uQmVmb3JlU2hvd0NvbnRleHRNZW51ID0gKHQpID0+IHtcclxuICAgICAgICBpZiAodCAmJiB0LmRhdGEucGFyZW50cy5pbmRleE9mKHRoaXMuSE9VX1hVQU5fTElFX0lEKSA+IC0xKSB7XHJcbiAgICAgICAgICAgIC8vIOW+hemAieWMuuS4reeahOaVsOaNruWIl+emgeeUqOWPs+mUruiPnOWNlVxyXG4gICAgICAgICAgICByZXR1cm4gb2Yoe3Nob3c6IGZhbHNlfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBvZih7c2hvdzogdHJ1ZX0pO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICBwcml2YXRlIGNsZWFyVHJlZU5vZGVzRGF0YShub2RlczogVHJlZU5vZGVbXSkge1xyXG4gICAgICAgIG5vZGVzLmZvckVhY2goKG46IGFueSkgPT57XHJcbiAgICAgICAgICAgIGRlbGV0ZSBuLnBhcmVudDtcclxuICAgICAgICAgICAgZGVsZXRlIG4uZWxlbWVudFJlZjtcclxuICAgICAgICAgICAgaWYgKG4uY2hpbGRyZW4gJiYgbi5jaGlsZHJlbi5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuY2xlYXJUcmVlTm9kZXNEYXRhKG4uY2hpbGRyZW4pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSlcclxuICAgIH1cclxuXHJcbiAgICBnZXRTZXR0aW5ncygpIHtcclxuICAgICAgICB0aGlzLmNsZWFyVHJlZU5vZGVzRGF0YSh0aGlzLnRyZWVEYXRhKTtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICB2aWV3Q29sczogdGhpcy5nZXRQcmV2aWV3R3JvdXBDb2x1bW5zKCksXHJcbiAgICAgICAgICAgIHRyZWVEYXRhOiB0aGlzLnRyZWVEYXRhXHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICBoaWRkZW5Db2woJGV2ZW50OiBNb3VzZUV2ZW50LCBpZCkge1xyXG4gICAgICAgICRldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcclxuICAgICAgICBcclxuICAgICAgICBpZiAodGhpcy50dC5zZWxlY3RlZFJvdyAmJiBpZCA9PT0gdGhpcy50dC5zZWxlY3RlZFJvdy5pZCkge1xyXG4gICAgICAgICAgICB0aGlzLnR0LmNsZWFyU2VsZWN0aW9ucygpO1xyXG4gICAgICAgICAgICB0aGlzLm5vZGVTZWxlY3RlZC5lbWl0KG51bGwpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy50dC5yZW1vdmUoaWQpO1xyXG5cclxuICAgIH1cclxuXHJcbiAgICByZXNldEhlYWRlck5hbWUoJGV2ZW50OiBNb3VzZUV2ZW50LCByb3dOb2RlOiBSb3dOb2RlKSB7XHJcbiAgICAgICAgY29uc3QgbW9kYWxSZWYgPSB0aGlzLnNob3dOZXdIZWFkZXJEaWFsb2coKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBnaGZSZWYgPSBtb2RhbFJlZi5jb250ZW50IGFzIE5ld0hlYWRlckZvcm1Db21wb25lbnQ7XHJcbiAgICAgICAgICAgIGlmIChnaGZSZWYudGl0bGUpIHtcclxuICAgICAgICAgICAgICAgIHJvd05vZGUubm9kZS5kYXRhLnRpdGxlID0gZ2hmUmVmLnRpdGxlO1xyXG4gICAgICAgICAgICAgICAgbW9kYWxSZWYuY2xvc2UoKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRoaXMubm90aXR5U2VyLmluZm8odGhpcy5sYW5ndWFnZVJlcy5yZXF1aXJlZCk7XHJcbiAgICAgICAgICAgICAgICBnaGZSZWYuaW5wdXQubmF0aXZlRWxlbWVudC5mb2N1cygpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICB9LCB0aGlzLmxhbmd1YWdlUmVzLmNvbnRleHRNZW51cy5yZW5hbWUpO1xyXG5cclxuICAgICAgIGNvbnN0IGdoZlJlZiA9IG1vZGFsUmVmLmNvbnRlbnQgYXMgTmV3SGVhZGVyRm9ybUNvbXBvbmVudDtcclxuICAgICAgIGdoZlJlZi50aXRsZSA9IHJvd05vZGUubm9kZS5kYXRhLnRpdGxlO1xyXG4gICAgfVxyXG4gICAgXHJcbn0iXX0=
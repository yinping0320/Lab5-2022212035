/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input, Injector, ChangeDetectorRef, ElementRef, ViewChild, EventEmitter, Output, ViewEncapsulation } from '@angular/core';
import { NgForm } from '@angular/forms';
import { DatagridSettingsComponent } from '../datagrid-settings.component';
export class ColumnGroupSettingComponent {
    /**
     * @param {?} injector
     * @param {?} gridSettingComponentRef
     * @param {?} cd
     */
    constructor(injector, gridSettingComponentRef, cd) {
        this.injector = injector;
        this.gridSettingComponentRef = gridSettingComponentRef;
        this.cd = cd;
        this.fields = [];
        this.formatColumns = [];
        this.groupFields = [];
        this.expandGroupRows = true;
        this.enabelGroupFooter = false;
        this.groupFieldsChange = new EventEmitter();
        this.formatColumnsChange = new EventEmitter();
        this.expandGroupRowsChange = new EventEmitter();
        // 分组列
        this.groupColumns = [];
        // 所有允许分组列
        this.allowGroupColumns = [];
        this.activeCalculationCol = null;
        this.showSelectColumnsPanel = false;
        this.summaryItems = [];
        this.summaryItems2 = [];
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.summaryItems = this.gridSettingComponentRef.summaryItems;
        this.summaryItems2 = this.gridSettingComponentRef.summaryItems2;
        //this.formatColumns = getDataFieldsForMultiHeaders(this.columns);
        this.setGroupColumns();
        this.registerEventHandle();
        this.initCalculationColumns();
        if (this.colForm) {
            this.colForm.valueChanges.subscribe((/**
             * @param {?} v
             * @return {?}
             */
            v => {
                if (!this.colForm.pristine) {
                    this.formatColumnsChange.emit(this.formatColumns);
                }
            }));
        }
        this.formatColumns.forEach((/**
         * @param {?} n
         * @return {?}
         */
        n => {
            this.checkColumnOptions(n);
        }));
    }
    /**
     * @param {?} changes
     * @return {?}
     */
    ngOnChanges(changes) {
        if (changes.formatColumns && !changes.formatColumns.isFirstChange()) {
            this.formatColumns.forEach((/**
             * @param {?} n
             * @return {?}
             */
            n => {
                this.checkColumnOptions(n);
            }));
            this.setGroupColumns();
            this.initCalculationColumns();
        }
    }
    /**
     * @private
     * @return {?}
     */
    initCalculationColumns() {
        if (this.formatColumns) {
            this.activeCalculationCol = this.formatColumns[0];
        }
    }
    /**
     * @private
     * @return {?}
     */
    registerEventHandle() {
        this.groupingSettingEl.nativeElement.addEventListener('click', (/**
         * @param {?} e
         * @return {?}
         */
        (e) => {
            if (e.target !== this.selectcolumnspanel.nativeElement) {
                this.showSelectColumnsPanel = false;
            }
        }), false);
    }
    /**
     * @private
     * @return {?}
     */
    setGroupColumns() {
        if (this.groupFields && this.groupFields.length) {
            /** @type {?} */
            const cols = this.formatColumns;
            this.groupColumns = this.groupFields.map((/**
             * @param {?} f
             * @return {?}
             */
            f => {
                /** @type {?} */
                const col = cols.find((/**
                 * @param {?} col
                 * @return {?}
                 */
                col => col.field === f));
                return col;
            })).filter((/**
             * @param {?} n
             * @return {?}
             */
            n => n));
            this.groupFields = this.groupColumns.map((/**
             * @param {?} n
             * @return {?}
             */
            n => n.field));
            this.groupFieldsChange.emit(this.groupFields);
        }
        else {
            this.groupColumns = [];
        }
        this.onGroupFieldsChange();
    }
    /**
     * @private
     * @return {?}
     */
    getAllowGroupingColumns() {
        /** @type {?} */
        const cols = this.formatColumns;
        return cols.filter((/**
         * @param {?} n
         * @return {?}
         */
        n => {
            if (n.field.indexOf('farris-datagrid-column_') > -1) {
                return false;
            }
            return n.allowGrouping || n.allowGrouping === undefined;
        }));
    }
    /**
     * @private
     * @return {?}
     */
    onGroupFieldsChange() {
        this.groupFieldsChange.emit(this.groupFields);
    }
    /**
     * @private
     * @param {?} col
     * @return {?}
     */
    checkColumnOptions(col) {
        if (col) {
            if (col.groupFooter === undefined) {
                col.groupFooter = { options: { calculationType: -1 } };
            }
            else {
                col.groupFooter.options = col.groupFooter.options || { calculationType: -1 };
                if (col.groupFooter.options.calculationType === undefined) {
                    col.groupFooter.options.calculationType = -1;
                }
            }
            // if (this.activeField.footer === undefined) {
            //     this.activeField.footer =  { options: {calculationType: -1} };
            // } else {
            //     this.activeField.footer.options = this.activeField.footer.options || {calculationType: -1};
            //     if (this.activeField.footer.options.calculationType === undefined) {
            //         this.activeField.footer.options.calculationType = -1;
            //     }
            // }
        }
    }
    /**
     * 显示或隐藏字段选取面板
     * @param {?} $event
     * @return {?}
     */
    toggleGroupingColumnPanel($event) {
        $event.stopPropagation();
        this.showSelectColumnsPanel = !this.showSelectColumnsPanel;
        this.allowGroupColumns = this.getAllowGroupingColumns();
    }
    /**
     * 添加分组字段
     * @param {?} $event
     * @param {?} col
     * @return {?}
     */
    addGroupColumn($event, col) {
        $event.stopPropagation();
        if (this.groupFields.indexOf(col.field) === -1) {
            this.groupColumns = [...this.groupColumns, col];
            this.groupFields = this.groupColumns.map((/**
             * @param {?} n
             * @return {?}
             */
            n => n.field));
            this.onGroupFieldsChange();
            this.showSelectColumnsPanel = false;
        }
    }
    /**
     * 移除分组字段
     * @param {?} $event
     * @param {?} col
     * @return {?}
     */
    onRemoveGroupingField($event, col) {
        $event.stopPropagation();
        this.groupFields = this.groupFields.filter((/**
         * @param {?} n
         * @return {?}
         */
        n => n !== col.field));
        this.setGroupColumns();
    }
    /**
     * 拖动分组字段进行排序
     * @param {?} $event
     * @return {?}
     */
    onGroupingFieldDropped($event) {
        const { removedIndex, addedIndex } = $event;
        /** @type {?} */
        const removedItem = this.groupFields.splice(removedIndex, 1);
        this.groupFields.splice(addedIndex, 0, ...removedItem);
        this.setGroupColumns();
    }
    /**
     * @param {?} $event
     * @param {?} col
     * @return {?}
     */
    onFieldClick($event, col) {
        this.activeCalculationCol = col;
    }
}
ColumnGroupSettingComponent.decorators = [
    { type: Component, args: [{
                selector: 'column-group-setting',
                template: "<div #groupingSetting class=\"d-flex flex-column flex-fill column-group-setting\">\r\n\r\n    <div region=\"north\" class=\"north d-flex flex-column group-fields\" style=\"height: 78px; \">\r\n        <div class=\"title d-flex flex-row\" style=\"justify-content: space-between;\">\r\n            <div>{{'datagrid.settings.grouppingField' | locale }}\r\n                <span class=\"text-warning\"> ({{'datagrid.settings.moreGrouppingFieldWarningMessage' | locale }})</span>\r\n            </div>\r\n            <div *ngIf=\"groupColumns && groupColumns.length\">\r\n                {{'datagrid-settings.groupRowStatus.label' | locale}}\uFF1A  <farris-switch style=\"display: inline-block;\"\r\n                [square]=\"false\"\r\n                [checked]=\"true\"\r\n                [(ngModel)]=\"expandGroupRows\"\r\n                [checkedLabel]=\"'datagrid-settings.groupRowStatus.expand' | locale\" [uncheckedLabel]=\"'datagrid-settings.groupRowStatus.collapse' | locale\" \r\n                (valueChange)=\"expandGroupRowsChange.emit(!!$event)\"\r\n                ></farris-switch>\r\n            </div>\r\n        </div>\r\n        <div #groupfieldcontainer class=\"flex-fill p-2 all-fields\">\r\n            <ul class=\"list-group\" style=\"display: inline-block;\"  column-group-drag (drop)=\"onGroupingFieldDropped($event)\">\r\n                <li class=\"list-group-item list-group-item-action btn btn-light smooth-dnd-draggable-wrapper group-field\"\r\n                *ngFor=\"let item of groupColumns\">\r\n                    {{ item.title }}\r\n                    <span class=\"f-icon f-icon-close\" style=\"cursor: pointer;\" title=\"{{'datagrid.settings.removeGrouppingFieldTip' | locale }}\" (click)=\"onRemoveGroupingField($event, item)\"></span>\r\n                </li>\r\n\r\n                <li class=\"list-group-item list-group-item-action btn btn-light btn-add-groupfield\" title=\"{{'datagrid.settings.addGrouppingFieldTip' | locale }}\"\r\n                    *ngIf=\"!groupFields || groupFields.length < 3\" (click)=\"toggleGroupingColumnPanel($event)\" style=\"border-radius: 20px!important;\">\r\n                   <span class=\"f-icon f-icon-add\" style=\"font-size: 24px;\"></span>\r\n                </li>\r\n            </ul>\r\n            <div #selectcolumnspanel class=\"group-field-panel\" [style.display]=\"showSelectColumnsPanel? '': 'none'\"\r\n            [style.width.px]=\"groupfieldcontainer.offsetWidth - 16\">\r\n                <ul class=\"list-group\">\r\n                    <li class=\"list-group-item list-group-item-action btn btn-light\" *ngFor=\"let item of allowGroupColumns\"\r\n                    (click)=\"addGroupColumn($event, item)\" [style.display]=\"groupFields?.indexOf(item.field) > -1 ? 'none': ''\">\r\n                        {{ item.title }}\r\n                    </li>\r\n                </ul>\r\n\r\n            </div>\r\n        </div>\r\n\r\n    </div>\r\n    <div region=\"center\" class=\"center  d-flex flex-column flex-fill\" style=\"overflow:hidden;\" *ngIf=\"enabelGroupFooter\">\r\n        <div class=\"group-sum-fields\">\r\n            {{'datagrid.settings.grouppingSummary' | locale}}\r\n        </div>\r\n        <div class=\"flex-fill p-2\" style=\" background-color: #fff; overflow: auto;\">\r\n            <div class=\"d-flex flex-row flex-fill dg-column-format-setting\" style=\"height: 100%\">\r\n                <div region=\"west\" class=\"west d-flex flex-column\" style=\"width: 360px; min-width:260px;overflow: hidden;\">\r\n                    <div style=\"overflow: auto;padding-right: 5px;\" class=\"flex-fill\">\r\n                        <ul class=\"list-group  list-group-flush\">\r\n                            <li class=\"list-group-item list-group-item-action format-setting-column\"\r\n                            *ngFor=\"let item of formatColumns\"\r\n                            [class.active]=\"activeCalculationCol && activeCalculationCol.field === item.field\"\r\n                            (click)=\"onFieldClick($event, item)\"\r\n                             >\r\n                                {{ item.title }}\r\n                            </li>\r\n                        </ul>\r\n                    </div>\r\n                 \r\n                </div>\r\n                <div region=\"center\" class=\"center flex-fill\" style=\"overflow:auto;padding: 0 10px; padding-left: 20px; border-right: 0px\">\r\n                    <form #groupSumform=\"ngForm\">\r\n                        <div class=\"farris-group-wrap\">\r\n                            <div class=\"form-group farris-form-group\">\r\n                                <label for=\"hpinput01\" class=\"col-form-label\">\r\n                                    <span class=\"farris-label-text\">{{'datagrid.settings.grouppingSummaryType' | locale}}</span>\r\n                                </label>\r\n                                <div class=\"farris-input-wrap\">\r\n                                   \r\n                                    <farris-combo-list name=\"groupFooter.options.calculationType\" \r\n                                    [data]=\" activeCalculationCol?.dataType === 'number'?  summaryItems : summaryItems2 \" \r\n                                    [editable]=\"false\"\r\n                                    [(ngModel)]=\"activeCalculationCol?.groupFooter.options.calculationType\"\r\n                                    [idField]=\"'value'\"\r\n                                    [textField]=\"'title'\"\r\n                                    [enableClear]=\"false\"></farris-combo-list>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                        <div class=\"farris-group-wrap\" *ngIf=\"activeCalculationCol?.groupFooter.options.calculationType == -1\">\r\n                            <div class=\"form-group farris-form-group\">\r\n                                <label for=\"hpinput01\" class=\"col-form-label\">\r\n                                    <span class=\"farris-label-text\">{{'datagrid.settings.grouppingSummaryText' | locale}}</span>\r\n                                </label>\r\n                                <div class=\"farris-input-wrap\">\r\n                                    <input type=\"input\" name=\"groupFooter.options.text\" class=\"form-control\" [(ngModel)]=\"activeCalculationCol?.groupFooter.options.text\">\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </form>\r\n                </div>\r\n               \r\n            </div>\r\n\r\n\r\n\r\n        </div>\r\n    </div>\r\n\r\n</div>",
                encapsulation: ViewEncapsulation.None
            }] }
];
/** @nocollapse */
ColumnGroupSettingComponent.ctorParameters = () => [
    { type: Injector },
    { type: DatagridSettingsComponent },
    { type: ChangeDetectorRef }
];
ColumnGroupSettingComponent.propDecorators = {
    columns: [{ type: Input }],
    fields: [{ type: Input }],
    formatColumns: [{ type: Input }],
    groupFields: [{ type: Input }],
    expandGroupRows: [{ type: Input }],
    enabelGroupFooter: [{ type: Input }],
    groupFieldsChange: [{ type: Output }],
    formatColumnsChange: [{ type: Output }],
    expandGroupRowsChange: [{ type: Output }],
    groupingSettingEl: [{ type: ViewChild, args: ['groupingSetting',] }],
    selectcolumnspanel: [{ type: ViewChild, args: ['selectcolumnspanel',] }],
    colForm: [{ type: ViewChild, args: ['groupSumform',] }]
};
if (false) {
    /** @type {?} */
    ColumnGroupSettingComponent.prototype.columns;
    /** @type {?} */
    ColumnGroupSettingComponent.prototype.fields;
    /** @type {?} */
    ColumnGroupSettingComponent.prototype.formatColumns;
    /** @type {?} */
    ColumnGroupSettingComponent.prototype.groupFields;
    /** @type {?} */
    ColumnGroupSettingComponent.prototype.expandGroupRows;
    /** @type {?} */
    ColumnGroupSettingComponent.prototype.enabelGroupFooter;
    /** @type {?} */
    ColumnGroupSettingComponent.prototype.groupFieldsChange;
    /** @type {?} */
    ColumnGroupSettingComponent.prototype.formatColumnsChange;
    /** @type {?} */
    ColumnGroupSettingComponent.prototype.expandGroupRowsChange;
    /** @type {?} */
    ColumnGroupSettingComponent.prototype.groupingSettingEl;
    /** @type {?} */
    ColumnGroupSettingComponent.prototype.selectcolumnspanel;
    /** @type {?} */
    ColumnGroupSettingComponent.prototype.colForm;
    /** @type {?} */
    ColumnGroupSettingComponent.prototype.groupColumns;
    /** @type {?} */
    ColumnGroupSettingComponent.prototype.allowGroupColumns;
    /** @type {?} */
    ColumnGroupSettingComponent.prototype.activeCalculationCol;
    /** @type {?} */
    ColumnGroupSettingComponent.prototype.showSelectColumnsPanel;
    /** @type {?} */
    ColumnGroupSettingComponent.prototype.summaryItems;
    /** @type {?} */
    ColumnGroupSettingComponent.prototype.summaryItems2;
    /**
     * @type {?}
     * @private
     */
    ColumnGroupSettingComponent.prototype.injector;
    /** @type {?} */
    ColumnGroupSettingComponent.prototype.gridSettingComponentRef;
    /**
     * @type {?}
     * @private
     */
    ColumnGroupSettingComponent.prototype.cd;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29sdW1uLWdyb3VwLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvdWktZGF0YWdyaWQtc2V0dGluZ3MvIiwic291cmNlcyI6WyJsaWIvY29sdW1uLWdyb3VwL2NvbHVtbi1ncm91cC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQVUsS0FBSyxFQUFFLFFBQVEsRUFBRSxpQkFBaUIsRUFBRSxVQUFVLEVBQUUsU0FBUyxFQUFFLFlBQVksRUFBRSxNQUFNLEVBQTRCLGlCQUFpQixFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ2hMLE9BQU8sRUFBRSxNQUFNLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUN4QyxPQUFPLEVBQUUseUJBQXlCLEVBQUUsTUFBTSxnQ0FBZ0MsQ0FBQztBQVEzRSxNQUFNLE9BQU8sMkJBQTJCOzs7Ozs7SUE2QnBDLFlBQW9CLFFBQWtCLEVBQVMsdUJBQWtELEVBQVUsRUFBcUI7UUFBNUcsYUFBUSxHQUFSLFFBQVEsQ0FBVTtRQUFTLDRCQUF1QixHQUF2Qix1QkFBdUIsQ0FBMkI7UUFBVSxPQUFFLEdBQUYsRUFBRSxDQUFtQjtRQTNCdkgsV0FBTSxHQUFHLEVBQUUsQ0FBQztRQUNaLGtCQUFhLEdBQUcsRUFBRSxDQUFDO1FBRW5CLGdCQUFXLEdBQUcsRUFBRSxDQUFDO1FBQ2pCLG9CQUFlLEdBQUcsSUFBSSxDQUFDO1FBRXZCLHNCQUFpQixHQUFHLEtBQUssQ0FBQztRQUV6QixzQkFBaUIsR0FBRyxJQUFJLFlBQVksRUFBRSxDQUFDO1FBQ3ZDLHdCQUFtQixHQUFHLElBQUksWUFBWSxFQUFFLENBQUM7UUFDekMsMEJBQXFCLEdBQUcsSUFBSSxZQUFZLEVBQUUsQ0FBQzs7UUFPckQsaUJBQVksR0FBRyxFQUFFLENBQUM7O1FBR2xCLHNCQUFpQixHQUFHLEVBQUUsQ0FBQztRQUN2Qix5QkFBb0IsR0FBRyxJQUFJLENBQUM7UUFHNUIsMkJBQXNCLEdBQUcs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OENBQTJDOztJQUczQyxtREFBa0I7O0lBR2xCLHdEQUF1Qjs7SUFDdkIsMkRBQTRCOztJQUc1Qiw2REFBK0I7O0lBQy9CLG1EQUFrQjs7SUFDbEIsb0RBQW1COzs7OztJQUNQLCtDQUEwQjs7SUFBRSw4REFBeUQ7Ozs7O0lBQUUseUNBQTZCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBPbkluaXQsIElucHV0LCBJbmplY3RvciwgQ2hhbmdlRGV0ZWN0b3JSZWYsIEVsZW1lbnRSZWYsIFZpZXdDaGlsZCwgRXZlbnRFbWl0dGVyLCBPdXRwdXQsIE9uQ2hhbmdlcywgU2ltcGxlQ2hhbmdlcywgVmlld0VuY2Fwc3VsYXRpb24gfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgTmdGb3JtIH0gZnJvbSAnQGFuZ3VsYXIvZm9ybXMnO1xyXG5pbXBvcnQgeyBEYXRhZ3JpZFNldHRpbmdzQ29tcG9uZW50IH0gZnJvbSAnLi4vZGF0YWdyaWQtc2V0dGluZ3MuY29tcG9uZW50JztcclxuaW1wb3J0IHsgZ2V0RGF0YUZpZWxkc0Zvck11bHRpSGVhZGVycyB9IGZyb20gJy4uL211dGxpLWhlYWRlcnMuaGVscGVyJztcclxuXHJcbkBDb21wb25lbnQoe1xyXG4gICAgc2VsZWN0b3I6ICdjb2x1bW4tZ3JvdXAtc2V0dGluZycsXHJcbiAgICB0ZW1wbGF0ZVVybDogJy4vY29sdW1uLWdyb3VwLmNvbXBvbmVudC5odG1sJyxcclxuICAgIGVuY2Fwc3VsYXRpb246IFZpZXdFbmNhcHN1bGF0aW9uLk5vbmVcclxufSlcclxuZXhwb3J0IGNsYXNzIENvbHVtbkdyb3VwU2V0dGluZ0NvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgT25DaGFuZ2VzIHtcclxuICAgIEBJbnB1dCgpIGNvbHVtbnM7XHJcbiAgICBASW5wdXQoKSBmaWVsZHMgPSBbXTtcclxuICAgIEBJbnB1dCgpIGZvcm1hdENvbHVtbnMgPSBbXTtcclxuXHJcbiAgICBASW5wdXQoKSBncm91cEZpZWxkcyA9IFtdO1xyXG4gICAgQElucHV0KCkgZXhwYW5kR3JvdXBSb3dzID0gdHJ1ZTtcclxuXHJcbiAgICBASW5wdXQoKSBlbmFiZWxHcm91cEZvb3RlciA9IGZhbHNlO1xyXG5cclxuICAgIEBPdXRwdXQoKSBncm91cEZpZWxkc0NoYW5nZSA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuICAgIEBPdXRwdXQoKSBmb3JtYXRDb2x1bW5zQ2hhbmdlID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG4gICAgQE91dHB1dCgpIGV4cGFuZEdyb3VwUm93c0NoYW5nZSA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuXHJcbiAgICBAVmlld0NoaWxkKCdncm91cGluZ1NldHRpbmcnKSBncm91cGluZ1NldHRpbmdFbDogRWxlbWVudFJlZjtcclxuICAgIEBWaWV3Q2hpbGQoJ3NlbGVjdGNvbHVtbnNwYW5lbCcpIHNlbGVjdGNvbHVtbnNwYW5lbDogRWxlbWVudFJlZjtcclxuICAgIEBWaWV3Q2hpbGQoJ2dyb3VwU3VtZm9ybScpIGNvbEZvcm06IE5nRm9ybTtcclxuXHJcbiAgICAvLyDliIbnu4TliJdcclxuICAgIGdyb3VwQ29sdW1ucyA9IFtdO1xyXG5cclxuICAgIC8vIOaJgOacieWFgeiuuOWIhue7hOWIl1xyXG4gICAgYWxsb3dHcm91cENvbHVtbnMgPSBbXTtcclxuICAgIGFjdGl2ZUNhbGN1bGF0aW9uQ29sID0gbnVsbDtcclxuXHJcblxyXG4gICAgc2hvd1NlbGVjdENvbHVtbnNQYW5lbCA9IGZhbHNlO1xyXG4gICAgc3VtbWFyeUl0ZW1zID0gW107XHJcbiAgICBzdW1tYXJ5SXRlbXMyID0gW107XHJcbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIGluamVjdG9yOiBJbmplY3RvciwgcHVibGljIGdyaWRTZXR0aW5nQ29tcG9uZW50UmVmOiBEYXRhZ3JpZFNldHRpbmdzQ29tcG9uZW50LCBwcml2YXRlIGNkOiBDaGFuZ2VEZXRlY3RvclJlZikgeyB9XHJcblxyXG4gICAgbmdPbkluaXQoKTogdm9pZCB7XHJcblxyXG4gICAgICAgIHRoaXMuc3VtbWFyeUl0ZW1zID0gdGhpcy5ncmlkU2V0dGluZ0NvbXBvbmVudFJlZi5zdW1tYXJ5SXRlbXM7XHJcbiAgICAgICAgdGhpcy5zdW1tYXJ5SXRlbXMyID0gdGhpcy5ncmlkU2V0dGluZ0NvbXBvbmVudFJlZi5zdW1tYXJ5SXRlbXMyO1xyXG5cclxuICAgICAgICAvL3RoaXMuZm9ybWF0Q29sdW1ucyA9IGdldERhdGFGaWVsZHNGb3JNdWx0aUhlYWRlcnModGhpcy5jb2x1bW5zKTtcclxuXHJcblxyXG4gICAgICAgIHRoaXMuc2V0R3JvdXBDb2x1bW5zKCk7XHJcbiAgICAgICAgdGhpcy5yZWdpc3RlckV2ZW50SGFuZGxlKCk7XHJcbiAgICAgICAgdGhpcy5pbml0Q2FsY3VsYXRpb25Db2x1bW5zKCk7XHJcblxyXG4gICAgICAgIGlmICh0aGlzLmNvbEZvcm0pIHtcclxuICAgICAgICAgICAgdGhpcy5jb2xGb3JtLnZhbHVlQ2hhbmdlcy5zdWJzY3JpYmUodiA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuY29sRm9ybS5wcmlzdGluZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZm9ybWF0Q29sdW1uc0NoYW5nZS5lbWl0KHRoaXMuZm9ybWF0Q29sdW1ucyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgICAgICB0aGlzLmZvcm1hdENvbHVtbnMuZm9yRWFjaChuID0+IHtcclxuICAgICAgICAgICAgdGhpcy5jaGVja0NvbHVtbk9wdGlvbnMobik7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcykge1xyXG4gICAgICAgIGlmIChjaGFuZ2VzLmZvcm1hdENvbHVtbnMgJiYgIWNoYW5nZXMuZm9ybWF0Q29sdW1ucy5pc0ZpcnN0Q2hhbmdlKCkpIHtcclxuICAgICAgICAgICAgdGhpcy5mb3JtYXRDb2x1bW5zLmZvckVhY2gobiA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNoZWNrQ29sdW1uT3B0aW9ucyhuKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIHRoaXMuc2V0R3JvdXBDb2x1bW5zKCk7XHJcbiAgICAgICAgICAgIHRoaXMuaW5pdENhbGN1bGF0aW9uQ29sdW1ucygpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGluaXRDYWxjdWxhdGlvbkNvbHVtbnMoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuZm9ybWF0Q29sdW1ucykge1xyXG4gICAgICAgICAgICB0aGlzLmFjdGl2ZUNhbGN1bGF0aW9uQ29sID0gdGhpcy5mb3JtYXRDb2x1bW5zWzBdO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHJlZ2lzdGVyRXZlbnRIYW5kbGUoKSB7XHJcbiAgICAgICAgdGhpcy5ncm91cGluZ1NldHRpbmdFbC5uYXRpdmVFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHtcclxuICAgICAgICAgICAgaWYgKGUudGFyZ2V0ICAhPT0gdGhpcy5zZWxlY3Rjb2x1bW5zcGFuZWwubmF0aXZlRWxlbWVudCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zaG93U2VsZWN0Q29sdW1uc1BhbmVsID0gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9LCBmYWxzZSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBzZXRHcm91cENvbHVtbnMoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuZ3JvdXBGaWVsZHMgJiYgdGhpcy5ncm91cEZpZWxkcy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgY29uc3QgY29sczogYW55ID0gdGhpcy5mb3JtYXRDb2x1bW5zO1xyXG4gICAgICAgICAgICB0aGlzLmdyb3VwQ29sdW1ucyA9IHRoaXMuZ3JvdXBGaWVsZHMubWFwKCBmID0+IHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGNvbCA9IGNvbHMuZmluZChjb2wgPT4gY29sLmZpZWxkID09PSBmKTtcclxuICAgICAgICAgICAgICAgICByZXR1cm4gY29sO1xyXG4gICAgICAgICAgICB9KS5maWx0ZXIobiA9PiBuKTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuZ3JvdXBGaWVsZHMgPSB0aGlzLmdyb3VwQ29sdW1ucy5tYXAobiA9PiBuLmZpZWxkKTtcclxuICAgICAgICAgICAgdGhpcy5ncm91cEZpZWxkc0NoYW5nZS5lbWl0KHRoaXMuZ3JvdXBGaWVsZHMpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMuZ3JvdXBDb2x1bW5zID0gW107XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMub25Hcm91cEZpZWxkc0NoYW5nZSgpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZ2V0QWxsb3dHcm91cGluZ0NvbHVtbnMoKSB7XHJcbiAgICAgICAgY29uc3QgY29sczogYW55ID0gdGhpcy5mb3JtYXRDb2x1bW5zO1xyXG4gICAgICAgIHJldHVybiBjb2xzLmZpbHRlcihuID0+IHtcclxuICAgICAgICAgICAgaWYgKG4uZmllbGQuaW5kZXhPZignZmFycmlzLWRhdGFncmlkLWNvbHVtbl8nKSA+IC0xKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuICBuLmFsbG93R3JvdXBpbmcgfHwgbi5hbGxvd0dyb3VwaW5nID09PSB1bmRlZmluZWQgXHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBvbkdyb3VwRmllbGRzQ2hhbmdlKCkge1xyXG4gICAgICAgIHRoaXMuZ3JvdXBGaWVsZHNDaGFuZ2UuZW1pdCh0aGlzLmdyb3VwRmllbGRzKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGNoZWNrQ29sdW1uT3B0aW9ucyhjb2wpIHtcclxuICAgICAgICBpZiAoY29sKSB7XHJcblxyXG4gICAgICAgICAgICBpZiAoY29sLmdyb3VwRm9vdGVyID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgIGNvbC5ncm91cEZvb3RlciA9IHsgb3B0aW9uczoge2NhbGN1bGF0aW9uVHlwZTogLTF9IH07XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBjb2wuZ3JvdXBGb290ZXIub3B0aW9ucyA9IGNvbC5ncm91cEZvb3Rlci5vcHRpb25zIHx8IHtjYWxjdWxhdGlvblR5cGU6IC0xfTtcclxuICAgICAgICAgICAgICAgIGlmIChjb2wuZ3JvdXBGb290ZXIub3B0aW9ucy5jYWxjdWxhdGlvblR5cGUgPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbC5ncm91cEZvb3Rlci5vcHRpb25zLmNhbGN1bGF0aW9uVHlwZSA9IC0xO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBpZiAodGhpcy5hY3RpdmVGaWVsZC5mb290ZXIgPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAvLyAgICAgdGhpcy5hY3RpdmVGaWVsZC5mb290ZXIgPSAgeyBvcHRpb25zOiB7Y2FsY3VsYXRpb25UeXBlOiAtMX0gfTtcclxuICAgICAgICAgICAgLy8gfSBlbHNlIHtcclxuICAgICAgICAgICAgLy8gICAgIHRoaXMuYWN0aXZlRmllbGQuZm9vdGVyLm9wdGlvbnMgPSB0aGlzLmFjdGl2ZUZpZWxkLmZvb3Rlci5vcHRpb25zIHx8IHtjYWxjdWxhdGlvblR5cGU6IC0xfTtcclxuICAgICAgICAgICAgLy8gICAgIGlmICh0aGlzLmFjdGl2ZUZpZWxkLmZvb3Rlci5vcHRpb25zLmNhbGN1bGF0aW9uVHlwZSA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgIC8vICAgICAgICAgdGhpcy5hY3RpdmVGaWVsZC5mb290ZXIub3B0aW9ucy5jYWxjdWxhdGlvblR5cGUgPSAtMTtcclxuICAgICAgICAgICAgLy8gICAgIH1cclxuICAgICAgICAgICAgLy8gfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOaYvuekuuaIlumakOiXj+Wtl+autemAieWPlumdouadv1xyXG4gICAgICovXHJcbiAgICB0b2dnbGVHcm91cGluZ0NvbHVtblBhbmVsKCRldmVudCkge1xyXG4gICAgICAgICRldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcclxuICAgICAgICB0aGlzLnNob3dTZWxlY3RDb2x1bW5zUGFuZWwgPSAhdGhpcy5zaG93U2VsZWN0Q29sdW1uc1BhbmVsO1xyXG4gICAgICAgIHRoaXMuYWxsb3dHcm91cENvbHVtbnMgPSB0aGlzLmdldEFsbG93R3JvdXBpbmdDb2x1bW5zKCk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqIOa3u+WKoOWIhue7hOWtl+autSAqL1xyXG4gICAgYWRkR3JvdXBDb2x1bW4oJGV2ZW50LCBjb2wpIHtcclxuICAgICAgICAkZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICAgICAgaWYgKHRoaXMuZ3JvdXBGaWVsZHMuaW5kZXhPZihjb2wuZmllbGQpID09PSAtMSkge1xyXG4gICAgICAgICAgICB0aGlzLmdyb3VwQ29sdW1ucyA9IFsuLi50aGlzLmdyb3VwQ29sdW1ucywgY29sXTtcclxuICAgICAgICAgICAgdGhpcy5ncm91cEZpZWxkcyA9IHRoaXMuZ3JvdXBDb2x1bW5zLm1hcChuID0+IG4uZmllbGQpO1xyXG4gICAgICAgICAgICB0aGlzLm9uR3JvdXBGaWVsZHNDaGFuZ2UoKTtcclxuICAgICAgICAgICAgdGhpcy5zaG93U2VsZWN0Q29sdW1uc1BhbmVsID0gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8qKiDnp7vpmaTliIbnu4TlrZfmrrUgKi9cclxuICAgIG9uUmVtb3ZlR3JvdXBpbmdGaWVsZCgkZXZlbnQsIGNvbCkge1xyXG4gICAgICAgICRldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcclxuICAgICAgICB0aGlzLmdyb3VwRmllbGRzID0gdGhpcy5ncm91cEZpZWxkcy5maWx0ZXIobiA9PiBuICE9PSBjb2wuZmllbGQpO1xyXG4gICAgICAgIHRoaXMuc2V0R3JvdXBDb2x1bW5zKCk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqIOaLluWKqOWIhue7hOWtl+autei/m+ihjOaOkuW6jyAqL1xyXG4gICAgb25Hcm91cGluZ0ZpZWxkRHJvcHBlZCgkZXZlbnQpIHtcclxuICAgICAgICBjb25zdCB7IHJlbW92ZWRJbmRleCwgYWRkZWRJbmRleCB9ID0gJGV2ZW50O1xyXG5cclxuICAgICAgICBjb25zdCByZW1vdmVkSXRlbSA9IHRoaXMuZ3JvdXBGaWVsZHMuc3BsaWNlKHJlbW92ZWRJbmRleCwgMSk7XHJcbiAgICAgICAgdGhpcy5ncm91cEZpZWxkcy5zcGxpY2UoYWRkZWRJbmRleCwgMCwgLi4ucmVtb3ZlZEl0ZW0pO1xyXG4gICAgICAgIHRoaXMuc2V0R3JvdXBDb2x1bW5zKCk7XHJcbiAgICB9XHJcblxyXG4gICAgb25GaWVsZENsaWNrKCRldmVudCwgY29sKSB7XHJcbiAgICAgICAgdGhpcy5hY3RpdmVDYWxjdWxhdGlvbkNvbCA9IGNvbDtcclxuICAgIH1cclxufVxyXG4iXX0=
/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { ChangeDetectorRef, Component, ElementRef, EventEmitter, Injector, Input, Output, TemplateRef, ViewChild } from '@angular/core';
import { DatagridComponent } from '@farris/ui-datagrid';
import { LocaleService } from '@farris/ui-locale';
import { getMultilingualValue } from '../getValueWithLocaleId';
export class SchemeListComponent {
    /**
     * @param {?} cd
     * @param {?} localeSer
     * @param {?} injector
     */
    constructor(cd, localeSer, injector) {
        this.cd = cd;
        this.localeSer = localeSer;
        this.injector = injector;
        this.items = [];
        this.closeModal = new EventEmitter();
        this.submitModal = new EventEmitter();
        this.removeItem = true;
        this.currentSchemeId = '';
        this.columns = [];
        this.currentUserId = '';
        this.changes = null;
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        /** @type {?} */
        const colName = this.localeSer.getValue('datagrid-scheme.columns.name') || '名称';
        /** @type {?} */
        const colType = this.localeSer.getValue('datagrid-scheme.columns.type') || '属性';
        /** @type {?} */
        const colDefault = this.localeSer.getValue('datagrid-scheme.columns.isDefault') || '默认';
        /** @type {?} */
        const colCreator = this.localeSer.getValue('datagrid-scheme.columns.username') || '创建人';
        /** @type {?} */
        const colMgr = this.localeSer.getValue('datagrid-scheme.columns.mgr') || '管理';
        /** @type {?} */
        const publicTxt = this.localeSer.getValue('datagrid-scheme.isPublic') || '公共';
        /** @type {?} */
        const privateTxt = this.localeSer.getValue('datagrid-scheme.isPrivate') || '个人';
        /** @type {?} */
        const orgTxt = this.localeSer.getValue('datagrid-scheme.isOrg') || '组织';
        this.columns = [
            // {field: 'name', title: '名称', width: 150, template: this.schemeName},
            { field: 'name', title: colName, width: 150, formatter: (/**
                 * @param {?} v
                 * @return {?}
                 */
                (v) => {
                    return getMultilingualValue(JSON.parse(v), this.localeSer.localeId);
                }) },
            { field: 'type', title: colType, width: 50, halign: 'center', align: 'center', formatter: (/**
                 * @param {?} v
                 * @param {?} d
                 * @return {?}
                 */
                (v, d) => {
                    switch (v) {
                        case 'public':
                            return '<span class="scheme-manager__label px-1 public">' + publicTxt + '</span>';
                        case 'org':
                            return '<span class="scheme-manager__label px-1 org">' + orgTxt + '</span>';
                        case 'private':
                        default:
                            return '<span class="scheme-manager__label px-1 private">' + privateTxt + '</span>';
                    }
                }) },
            { field: 'isDefault', title: colDefault, width: 50, halign: 'center', align: 'center', template: this.schemeIsDefault },
            { field: 'userName', title: colCreator, width: 80 },
            { title: colMgr, width: 50, template: this.btnDel, halign: 'center', align: 'center', }
        ];
    }
    /**
     * @param {?} $event
     * @return {?}
     */
    onClose($event) {
        this.closeModal.emit();
    }
    /**
     * @param {?} $event
     * @return {?}
     */
    onSubmitClick($event) {
        this.submitModal.emit(this.changes);
    }
    /**
     * @param {?} $event
     * @return {?}
     */
    onCancelClick($event) {
        this.closeModal.emit();
    }
    /**
     * @param {?} $event
     * @param {?} ctx
     * @return {?}
     */
    setDefault($event, ctx) {
        /** @type {?} */
        const r = $event == '1';
        // $event.stopPropagation();
        this.items.forEach((/**
         * @param {?} n
         * @return {?}
         */
        n => {
            n.isDefault = false;
            if (n.id === ctx.rowData.id && r) {
                n.isDefault = r;
            }
        }));
        this.items = [...this.items];
        /** @type {?} */
        const defaultItem = this.items.find((/**
         * @param {?} n
         * @return {?}
         */
        n => n.isDefault));
        if (defaultItem) {
            this.changes = this.changes || {};
            this.changes.defaultId = defaultItem.id;
        }
        // this.cd.detectChanges();
    }
    /**
     * @param {?} $event
     * @param {?} ctx
     * @return {?}
     */
    onSchemeDel($event, ctx) {
        if ((this.currentUserId === ctx.rowData["userId"] && ctx.rowData['type'] == 'private') || this.removeItem) {
            $event.stopPropagation();
            /** @type {?} */
            const id = ctx.rowData.id;
            this.items = this.items.filter((/**
             * @param {?} n
             * @return {?}
             */
            n => n.id !== id));
            this.changes = this.changes || {};
            this.changes.deletedIds = [...(this.changes.deletedIds || []), id];
            if (id === this.changes.defaultId) {
                this.changes.defaultId = '';
                delete this.changes.defaultId;
            }
        }
    }
}
SchemeListComponent.decorators = [
    { type: Component, args: [{
                selector: 'scheme-list',
                template: "\r\n<div class=\"f-datagrid-save-scheme d-flex flex-column\" style=\"height: 100%;\">\r\n    <div class=\"d-flex justify-content-between header\" #header >\r\n        <div class=\"title\">{{'datagrid-scheme.schemeList' | locale}}</div>\r\n        <div class=\"close\" style=\"margin-right: 20px;\">\r\n            <span class=\"f-icon modal_close\" (click)=\"onClose($event)\"></span>\r\n        </div>\r\n    </div>\r\n\r\n    <div class=\"f-utils-fill mx-3 mt-1\" >\r\n        <farris-datagrid #dg\r\n            [columns]=\"columns\"\r\n            [data]=\"items\"\r\n            [fit]=\"true\"\r\n            [fitColumns]=\"true\"\r\n            [pagination]=\"false\"\r\n            [editable]=\"false\">\r\n        </farris-datagrid>\r\n    </div>\r\n\r\n    <div class=\"p-3 mb-3\" style=\"height: 50px;text-align: right;\">\r\n        <button class=\"btn btn-secondary cancel btn-lg mr-3\" style=\"width: 70px\"\r\n            (click)=\"onCancelClick($event)\">{{'datagrid.settings.cancel' | locale}}</button>\r\n        <button class=\"btn btn-primary ok btn-lg\" style=\"width: 70px\" [disabled]=\"!(items && items.length) && !changes\"\r\n            (click)=\"onSubmitClick($event)\">{{'datagrid.settings.ok' | locale}}</button>\r\n    </div>\r\n</div>\r\n\r\n<ng-template #schemeName let-ctx>\r\n    <div class=\"input-group\">\r\n        <input type=\"text\" class=\"form-control\" [(ngModel)]=\"ctx.rowData['name']\">\r\n    </div>\r\n</ng-template>\r\n<ng-template #schemeIsDefault let-ctx>\r\n    <div class=\"f-datagrid-cell-formgroup farris-group-auto f-datagrid_scheme-switch\" [style.opacity]=\"ctx.rowData['type'] !== 'private' ? 0.6: 1\" style=\"line-height:100%\" #ctrlbox hidefocus=\"true\">\r\n        <farris-switch [(ngModel)]=\"ctx.rowData['isDefault']\" trueValue=\"1\" falseValue=\"0\"\r\n        (valueChange)=\"setDefault($event, ctx)\"  [disabled]=\"ctx.rowData['type'] !== 'private' || ctx.rowData['isDefault']\"></farris-switch>\r\n    </div>\r\n</ng-template>\r\n\r\n<ng-template let-ctx #btnDel>\r\n    <a href=\"javascript:void(0)\" (click)=\"onSchemeDel($event, ctx)\" title=\"{{'datagrid-scheme.delete' | locale}}\" \r\n    *ngIf=\"(removeItem || (ctx.rowData['userId'] === currentUserId && ctx.rowData['type']=='private')) && currentSchemeId !== ctx.rowData['id']\">\r\n        <span class=\"f-icon f-icon-yxs_delete\"></span>\r\n    </a>\r\n</ng-template>"
            }] }
];
/** @nocollapse */
SchemeListComponent.ctorParameters = () => [
    { type: ChangeDetectorRef },
    { type: LocaleService },
    { type: Injector }
];
SchemeListComponent.propDecorators = {
    items: [{ type: Input }],
    closeModal: [{ type: Output }],
    submitModal: [{ type: Output }],
    removeItem: [{ type: Input }],
    currentSchemeId: [{ type: Input }],
    header: [{ type: ViewChild, args: ['header',] }],
    schemeName: [{ type: ViewChild, args: ['schemeName',] }],
    schemeIsDefault: [{ type: ViewChild, args: ['schemeIsDefault',] }],
    btnDel: [{ type: ViewChild, args: ['btnDel',] }],
    dg: [{ type: ViewChild, args: ['dg',] }]
};
if (false) {
    /** @type {?} */
    SchemeListComponent.prototype.items;
    /** @type {?} */
    SchemeListComponent.prototype.closeModal;
    /** @type {?} */
    SchemeListComponent.prototype.submitModal;
    /** @type {?} */
    SchemeListComponent.prototype.removeItem;
    /** @type {?} */
    SchemeListComponent.prototype.currentSchemeId;
    /** @type {?} */
    SchemeListComponent.prototype.header;
    /** @type {?} */
    SchemeListComponent.prototype.schemeName;
    /** @type {?} */
    SchemeListComponent.prototype.schemeIsDefault;
    /** @type {?} */
    SchemeListComponent.prototype.btnDel;
    /** @type {?} */
    SchemeListComponent.prototype.dg;
    /** @type {?} */
    SchemeListComponent.prototype.columns;
    /** @type {?} */
    SchemeListComponent.prototype.currentUserId;
    /** @type {?} */
    SchemeListComponent.prototype.changes;
    /**
     * @type {?}
     * @private
     */
    SchemeListComponent.prototype.cd;
    /**
     * @type {?}
     * @private
     */
    SchemeListComponent.prototype.localeSer;
    /**
     * @type {?}
     * @private
     */
    SchemeListComponent.prototype.injector;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2NoZW1lLWxpc3QuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy91aS1kYXRhZ3JpZC1zZXR0aW5ncy8iLCJzb3VyY2VzIjpbImxpYi9zY2hlbWUvc2NoZW1lLWxpc3QuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsU0FBUyxFQUFFLFVBQVUsRUFBRSxZQUFZLEVBQUUsUUFBUSxFQUFFLEtBQUssRUFBVSxNQUFNLEVBQUUsV0FBVyxFQUFFLFNBQVMsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUNoSixPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUN4RCxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFDbEQsT0FBTyxFQUFFLG9CQUFvQixFQUFFLE1BQU0seUJBQXlCLENBQUM7QUFPL0QsTUFBTSxPQUFPLG1CQUFtQjs7Ozs7O0lBeUI1QixZQUFvQixFQUFxQixFQUFVLFNBQXdCLEVBQVUsUUFBa0I7UUFBbkYsT0FBRSxHQUFGLEVBQUUsQ0FBbUI7UUFBVSxjQUFTLEdBQVQsU0FBUyxDQUFlO1FBQVUsYUFBUSxHQUFSLFFBQVEsQ0FBVTtRQXZCOUYsVUFBSyxHQUFHLEVBQUUsQ0FBQztRQUVWLGVBQVUsR0FBRyxJQUFJLFlBQVksRUFBRSxDQUFDO1FBQ2hDLGdCQUFXLEdBQUcsSUFBSSxZQUFZLEVBQUUsQ0FBQztRQUVsQyxlQUFVLEdBQUcsSUFBSSxDQUFDO1FBRWxCLG9CQUFlLEdBQUcsRUFBRSxDQUFDO1FBUTlCLFlBQU8sR0FBRyxFQUFFLENBQUM7UUFFYixrQkFBYSxHQUFHLEVBQUUsQ0FBQztRQUVuQixZQUFPLEdBR0gsSUFBSSxDQUFDO0lBQ2tHLENBQUM7Ozs7SUFFNUcsUUFBUTs7Y0FFRSxPQUFPLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxRQUFRLENBQUMsOEJBQThCLENBQUMsSUFBSSxJQUFJOztjQUN6RSxPQUFPLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxRQUFRLENBQUMsOEJBQThCLENBQUMsSUFBSSxJQUFJOztjQUN6RSxVQUFVLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxRQUFRLENBQUMsbUNBQW1DLENBQUMsSUFBSSxJQUFJOztjQUNqRixVQUFVLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxRQUFRLENBQUMsa0NBQWtDLENBQUMsSUFBSSxLQUFLOztjQUNqRixNQUFNLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxRQUFRLENBQUMsNkJBQTZCLENBQUMsSUFBSSxJQUFJOztjQUV2RSxTQUFTLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxRQUFRLENBQUMsMEJBQTBCLENBQUMsSUFBSSxJQUFJOztjQUN2RSxVQUFVLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxRQUFRLENBQUMsMkJBQTJCLENBQUMsSUFBSSxJQUFJOztjQUN6RSxNQUFNLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxRQUFRLENBQUMsdUJBQXVCLENBQUMsSUFBSSxJQUFJO1FBR3ZFLElBQUksQ0FBQyxPQUFPLEdBQUc7WUFDWCx1RUFBdUU7WUFDdkUsRUFBQyxLQUFLLEVBQUUsTUFBTSxFQUFFLEtBQUssRUFBRSxPQUFPLEVBQUUsS0FBSyxFQUFFLEdBQUcsRUFBRSxTQUFTOzs7O2dCQUFFLENBQUMsQ0FBQyxFQUFFLEVBQUU7b0JBQ3pELE9BQU8sb0JBQW9CLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsRUFBRSxJQUFJLENBQUMsU0FBUyxDQUFDLFFBQVEsQ0FBQyxDQUFDO2dCQUN4RSxDQUFDLENBQUEsRUFBQztZQUNGLEVBQUMsS0FBSyxFQUFFLE1BQU0sRUFBRSxLQUFLLEVBQUUsT0FBTyxFQUFFLEtBQUssRUFBRSxFQUFFLEVBQUUsTUFBTSxFQUFFLFFBQVEsRUFBRSxLQUFLLEVBQUUsUUFBUSxFQUFFLFNBQVM7Ozs7O2dCQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFO29CQUM5RixRQUFPLENBQUMsRUFBRTt3QkFDTixLQUFLLFFBQVE7NEJBQ1QsT0FBTyxrREFBa0QsR0FBRSxTQUFTLEdBQUUsU0FBUyxDQUFDO3dCQUNwRixLQUFLLEtBQUs7NEJBQ04sT0FBTywrQ0FBK0MsR0FBRSxNQUFNLEdBQUUsU0FBUyxDQUFDO3dCQUM5RSxLQUFLLFNBQVMsQ0FBQzt3QkFDZjs0QkFDSSxPQUFPLG1EQUFtRCxHQUFFLFVBQVUsR0FBRSxTQUFTLENBQUM7cUJBQ3pGO2dCQUNMLENBQUMsQ0FBQSxFQUFDO1lBQ0YsRUFBQyxLQUFLLEVBQUUsV0FBVyxFQUFFLEtBQUssRUFBRSxVQUFVLEVBQUUsS0FBSyxFQUFFLEVBQUUsRUFBRSxNQUFNLEVBQUUsUUFBUSxFQUFFLEtBQUssRUFBRSxRQUFRLEVBQUUsUUFBUSxFQUFFLElBQUksQ0FBQyxlQUFlLEVBQUU7WUFDdEgsRUFBQyxLQUFLLEVBQUUsVUFBVSxFQUFFLEtBQUssRUFBRSxVQUFVLEVBQUUsS0FBSyxFQUFFLEVBQUUsRUFBQztZQUNqRCxFQUFDLEtBQUssRUFBRSxNQUFNLEVBQUUsS0FBSyxFQUFFLEVBQUUsRUFBRSxRQUFRLEVBQUUsSUFBSSxDQUFDLE1BQU0sRUFBRSxNQUFNLEVBQUUsUUFBUSxFQUFFLEtBQUssRUFBRSxRQUFRLEdBQUU7U0FDeEYsQ0FBQztJQUVOLENBQUM7Ozs7O0lBRUQsT0FBTyxDQUFDLE1BQU07UUFDVixJQUFJLENBQUMsVUFBVSxDQUFDLElBQUksRUFBRSxDQUFDO0lBQzNCLENBQUM7Ozs7O0lBRUQsYUFBYSxDQUFDLE1BQU07UUFDaEIsSUFBSSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUUsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDO0lBQ3pDLENBQUM7Ozs7O0lBRUQsYUFBYSxDQUFDLE1BQU07UUFDaEIsSUFBSSxDQUFDLFVBQVUsQ0FBQyxJQUFJLEVBQUUsQ0FBQztJQUMzQixDQUFDOzs7Ozs7SUFFRCxVQUFVLENBQUMsTUFBVyxFQUFFLEdBQUc7O2NBQ2pCLENBQUMsR0FBRyxNQUFNLElBQUksR0FBRztRQUN2Qiw0QkFBNEI7UUFDNUIsSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPOzs7O1FBQUMsQ0FBQyxDQUFDLEVBQUU7WUFDbkIsQ0FBQyxDQUFDLFNBQVMsR0FBRyxLQUFLLENBQUM7WUFDcEIsSUFBSSxDQUFDLENBQUMsRUFBRSxLQUFLLEdBQUcsQ0FBQyxPQUFPLENBQUMsRUFBRSxJQUFJLENBQUMsRUFBRTtnQkFDOUIsQ0FBQyxDQUFDLFNBQVMsR0FBRyxDQUFDLENBQUM7YUFDbkI7UUFDTCxDQUFDLEVBQUMsQ0FBQztRQUVILElBQUksQ0FBQyxLQUFLLEdBQUcsQ0FBQyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQzs7Y0FFdkIsV0FBVyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSTs7OztRQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLFNBQVMsRUFBQztRQUNyRCxJQUFJLFdBQVcsRUFBRTtZQUNiLElBQUksQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDLE9BQU8sSUFBSSxFQUFFLENBQUM7WUFDbEMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxTQUFTLEdBQUcsV0FBVyxDQUFDLEVBQUUsQ0FBQztTQUMzQztRQUNELDJCQUEyQjtJQUMvQixDQUFDOzs7Ozs7SUFFRCxXQUFXLENBQUMsTUFBTSxFQUFFLEdBQUc7UUFDbkIsSUFBSSxDQUFDLElBQUksQ0FBQyxhQUFhLEtBQUssR0FBRyxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsSUFBSyxHQUFHLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxJQUFFLFNBQVMsQ0FBQyxJQUFJLElBQUksQ0FBQyxVQUFVLEVBQUU7WUFDdEcsTUFBTSxDQUFDLGVBQWUsRUFBRSxDQUFDOztrQkFDbkIsRUFBRSxHQUFHLEdBQUcsQ0FBQyxPQUFPLENBQUMsRUFBRTtZQUN6QixJQUFJLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTTs7OztZQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUUsS0FBSyxFQUFFLEVBQUMsQ0FBQztZQUNqRCxJQUFJLENBQUMsT0FBTyxHQUFHLElBQUksQ0FBQyxPQUFPLElBQUksRUFBRSxDQUFDO1lBQ2xDLElBQUksQ0FBQyxPQUFPLENBQUMsVUFBVSxHQUFHLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsVUFBVSxJQUFJLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDO1lBQ25FLElBQUksRUFBRSxLQUFLLElBQUksQ0FBQyxPQUFPLENBQUMsU0FBUyxFQUFFO2dCQUMvQixJQUFJLENBQUMsT0FBTyxDQUFDLFNBQVMsR0FBRyxFQUFFLENBQUM7Z0JBQzVCLE9BQU8sSUFBSSxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUM7YUFDakM7U0FDSjtJQUNMLENBQUM7OztZQWhISixTQUFTLFNBQUM7Z0JBQ1AsUUFBUSxFQUFFLGFBQWE7Z0JBQ3ZCLDIyRUFBeUM7YUFDNUM7Ozs7WUFSUSxpQkFBaUI7WUFFakIsYUFBYTtZQUYyQyxRQUFROzs7b0JBWXBFLEtBQUs7eUJBRUwsTUFBTTswQkFDTixNQUFNO3lCQUVOLEtBQUs7OEJBRUwsS0FBSztxQkFFTCxTQUFTLFNBQUMsUUFBUTt5QkFDbEIsU0FBUyxTQUFDLFlBQVk7OEJBQ3RCLFNBQVMsU0FBQyxpQkFBaUI7cUJBQzNCLFNBQVMsU0FBQyxRQUFRO2lCQUNsQixTQUFTLFNBQUMsSUFBSTs7OztJQWJmLG9DQUFvQjs7SUFFcEIseUNBQTBDOztJQUMxQywwQ0FBMkM7O0lBRTNDLHlDQUEyQjs7SUFFM0IsOENBQThCOztJQUU5QixxQ0FBNkM7O0lBQzdDLHlDQUFzRDs7SUFDdEQsOENBQWdFOztJQUNoRSxxQ0FBOEM7O0lBQzlDLGlDQUF1Qzs7SUFFdkMsc0NBQWE7O0lBRWIsNENBQW1COztJQUVuQixzQ0FHUzs7Ozs7SUFDRyxpQ0FBNkI7Ozs7O0lBQUUsd0NBQWdDOzs7OztJQUFFLHVDQUEwQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENoYW5nZURldGVjdG9yUmVmLCBDb21wb25lbnQsIEVsZW1lbnRSZWYsIEV2ZW50RW1pdHRlciwgSW5qZWN0b3IsIElucHV0LCBPbkluaXQsIE91dHB1dCwgVGVtcGxhdGVSZWYsIFZpZXdDaGlsZCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBEYXRhZ3JpZENvbXBvbmVudCB9IGZyb20gJ0BmYXJyaXMvdWktZGF0YWdyaWQnO1xyXG5pbXBvcnQgeyBMb2NhbGVTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy91aS1sb2NhbGUnO1xyXG5pbXBvcnQgeyBnZXRNdWx0aWxpbmd1YWxWYWx1ZSB9IGZyb20gJy4uL2dldFZhbHVlV2l0aExvY2FsZUlkJztcclxuXHJcbkBDb21wb25lbnQoe1xyXG4gICAgc2VsZWN0b3I6ICdzY2hlbWUtbGlzdCcsXHJcbiAgICB0ZW1wbGF0ZVVybDogJ3NjaGVtZS1saXN0LmNvbXBvbmVudC5odG1sJ1xyXG59KVxyXG5cclxuZXhwb3J0IGNsYXNzIFNjaGVtZUxpc3RDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xyXG5cclxuICAgIEBJbnB1dCgpIGl0ZW1zID0gW107XHJcbiAgICBcclxuICAgIEBPdXRwdXQoKSBjbG9zZU1vZGFsID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG4gICAgQE91dHB1dCgpIHN1Ym1pdE1vZGFsID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG5cclxuICAgIEBJbnB1dCgpIHJlbW92ZUl0ZW0gPSB0cnVlO1xyXG5cclxuICAgIEBJbnB1dCgpIGN1cnJlbnRTY2hlbWVJZCA9ICcnO1xyXG4gICAgXHJcbiAgICBAVmlld0NoaWxkKCdoZWFkZXInKSBoZWFkZXI6IEVsZW1lbnRSZWY8YW55PjtcclxuICAgIEBWaWV3Q2hpbGQoJ3NjaGVtZU5hbWUnKSBzY2hlbWVOYW1lOiBUZW1wbGF0ZVJlZjxhbnk+O1xyXG4gICAgQFZpZXdDaGlsZCgnc2NoZW1lSXNEZWZhdWx0Jykgc2NoZW1lSXNEZWZhdWx0OiBUZW1wbGF0ZVJlZjxhbnk+O1xyXG4gICAgQFZpZXdDaGlsZCgnYnRuRGVsJykgYnRuRGVsOiBUZW1wbGF0ZVJlZjxhbnk+O1xyXG4gICAgQFZpZXdDaGlsZCgnZGcnKSBkZzogRGF0YWdyaWRDb21wb25lbnQ7XHJcblxyXG4gICAgY29sdW1ucyA9IFtdO1xyXG5cclxuICAgIGN1cnJlbnRVc2VySWQgPSAnJztcclxuICAgXHJcbiAgICBjaGFuZ2VzOiB7XHJcbiAgICAgICAgZGVmYXVsdElkPzogc3RyaW5nLFxyXG4gICAgICAgIGRlbGV0ZWRJZHM/OiBhbnlbXVxyXG4gICAgfSA9IG51bGw7XHJcbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIGNkOiBDaGFuZ2VEZXRlY3RvclJlZiwgcHJpdmF0ZSBsb2NhbGVTZXI6IExvY2FsZVNlcnZpY2UsIHByaXZhdGUgaW5qZWN0b3I6IEluamVjdG9yKSB7IH1cclxuXHJcbiAgICBuZ09uSW5pdCgpOiB2b2lkIHtcclxuXHJcbiAgICAgICAgY29uc3QgY29sTmFtZSA9IHRoaXMubG9jYWxlU2VyLmdldFZhbHVlKCdkYXRhZ3JpZC1zY2hlbWUuY29sdW1ucy5uYW1lJykgfHwgJ+WQjeensCc7XHJcbiAgICAgICAgY29uc3QgY29sVHlwZSA9IHRoaXMubG9jYWxlU2VyLmdldFZhbHVlKCdkYXRhZ3JpZC1zY2hlbWUuY29sdW1ucy50eXBlJykgfHwgJ+WxnuaApyc7XHJcbiAgICAgICAgY29uc3QgY29sRGVmYXVsdCA9IHRoaXMubG9jYWxlU2VyLmdldFZhbHVlKCdkYXRhZ3JpZC1zY2hlbWUuY29sdW1ucy5pc0RlZmF1bHQnKSB8fCAn6buY6K6kJztcclxuICAgICAgICBjb25zdCBjb2xDcmVhdG9yID0gdGhpcy5sb2NhbGVTZXIuZ2V0VmFsdWUoJ2RhdGFncmlkLXNjaGVtZS5jb2x1bW5zLnVzZXJuYW1lJykgfHwgJ+WIm+W7uuS6uic7XHJcbiAgICAgICAgY29uc3QgY29sTWdyID0gdGhpcy5sb2NhbGVTZXIuZ2V0VmFsdWUoJ2RhdGFncmlkLXNjaGVtZS5jb2x1bW5zLm1ncicpIHx8ICfnrqHnkIYnO1xyXG5cclxuICAgICAgICBjb25zdCBwdWJsaWNUeHQgPSB0aGlzLmxvY2FsZVNlci5nZXRWYWx1ZSgnZGF0YWdyaWQtc2NoZW1lLmlzUHVibGljJykgfHwgJ+WFrOWFsSc7XHJcbiAgICAgICAgY29uc3QgcHJpdmF0ZVR4dCA9IHRoaXMubG9jYWxlU2VyLmdldFZhbHVlKCdkYXRhZ3JpZC1zY2hlbWUuaXNQcml2YXRlJykgfHwgJ+S4quS6uic7XHJcbiAgICAgICAgY29uc3Qgb3JnVHh0ID0gdGhpcy5sb2NhbGVTZXIuZ2V0VmFsdWUoJ2RhdGFncmlkLXNjaGVtZS5pc09yZycpIHx8ICfnu4Tnu4cnO1xyXG5cclxuXHJcbiAgICAgICAgdGhpcy5jb2x1bW5zID0gW1xyXG4gICAgICAgICAgICAvLyB7ZmllbGQ6ICduYW1lJywgdGl0bGU6ICflkI3np7AnLCB3aWR0aDogMTUwLCB0ZW1wbGF0ZTogdGhpcy5zY2hlbWVOYW1lfSxcclxuICAgICAgICAgICAge2ZpZWxkOiAnbmFtZScsIHRpdGxlOiBjb2xOYW1lLCB3aWR0aDogMTUwLCBmb3JtYXR0ZXI6ICh2KSA9PiB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZ2V0TXVsdGlsaW5ndWFsVmFsdWUoSlNPTi5wYXJzZSh2KSwgdGhpcy5sb2NhbGVTZXIubG9jYWxlSWQpO1xyXG4gICAgICAgICAgICB9fSxcclxuICAgICAgICAgICAge2ZpZWxkOiAndHlwZScsIHRpdGxlOiBjb2xUeXBlLCB3aWR0aDogNTAsIGhhbGlnbjogJ2NlbnRlcicsIGFsaWduOiAnY2VudGVyJywgZm9ybWF0dGVyOiAodiwgZCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgc3dpdGNoKHYpIHtcclxuICAgICAgICAgICAgICAgICAgICBjYXNlICdwdWJsaWMnOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJzxzcGFuIGNsYXNzPVwic2NoZW1lLW1hbmFnZXJfX2xhYmVsIHB4LTEgcHVibGljXCI+JysgcHVibGljVHh0ICsnPC9zcGFuPic7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnb3JnJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICc8c3BhbiBjbGFzcz1cInNjaGVtZS1tYW5hZ2VyX19sYWJlbCBweC0xIG9yZ1wiPicrIG9yZ1R4dCArJzwvc3Bhbj4nO1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ3ByaXZhdGUnOlxyXG4gICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnPHNwYW4gY2xhc3M9XCJzY2hlbWUtbWFuYWdlcl9fbGFiZWwgcHgtMSBwcml2YXRlXCI+JysgcHJpdmF0ZVR4dCArJzwvc3Bhbj4nO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9fSxcclxuICAgICAgICAgICAge2ZpZWxkOiAnaXNEZWZhdWx0JywgdGl0bGU6IGNvbERlZmF1bHQsIHdpZHRoOiA1MCwgaGFsaWduOiAnY2VudGVyJywgYWxpZ246ICdjZW50ZXInLCB0ZW1wbGF0ZTogdGhpcy5zY2hlbWVJc0RlZmF1bHQgfSxcclxuICAgICAgICAgICAge2ZpZWxkOiAndXNlck5hbWUnLCB0aXRsZTogY29sQ3JlYXRvciwgd2lkdGg6IDgwfSxcclxuICAgICAgICAgICAge3RpdGxlOiBjb2xNZ3IsIHdpZHRoOiA1MCwgdGVtcGxhdGU6IHRoaXMuYnRuRGVsLCBoYWxpZ246ICdjZW50ZXInLCBhbGlnbjogJ2NlbnRlcicsfVxyXG4gICAgICAgIF07XHJcbiAgICBcclxuICAgIH1cclxuXHJcbiAgICBvbkNsb3NlKCRldmVudCkge1xyXG4gICAgICAgIHRoaXMuY2xvc2VNb2RhbC5lbWl0KCk7XHJcbiAgICB9XHJcblxyXG4gICAgb25TdWJtaXRDbGljaygkZXZlbnQpIHtcclxuICAgICAgICB0aGlzLnN1Ym1pdE1vZGFsLmVtaXQoIHRoaXMuY2hhbmdlcyk7XHJcbiAgICB9XHJcblxyXG4gICAgb25DYW5jZWxDbGljaygkZXZlbnQpIHtcclxuICAgICAgICB0aGlzLmNsb3NlTW9kYWwuZW1pdCgpO1xyXG4gICAgfVxyXG5cclxuICAgIHNldERlZmF1bHQoJGV2ZW50OiBhbnksIGN0eCkge1xyXG4gICAgICAgIGNvbnN0IHIgPSAkZXZlbnQgPT0gJzEnO1xyXG4gICAgICAgIC8vICRldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcclxuICAgICAgICB0aGlzLml0ZW1zLmZvckVhY2gobiA9PiB7XHJcbiAgICAgICAgICAgIG4uaXNEZWZhdWx0ID0gZmFsc2U7XHJcbiAgICAgICAgICAgIGlmIChuLmlkID09PSBjdHgucm93RGF0YS5pZCAmJiByKSB7XHJcbiAgICAgICAgICAgICAgICBuLmlzRGVmYXVsdCA9IHI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgdGhpcy5pdGVtcyA9IFsuLi50aGlzLml0ZW1zXTtcclxuXHJcbiAgICAgICAgY29uc3QgZGVmYXVsdEl0ZW0gPSB0aGlzLml0ZW1zLmZpbmQobiA9PiBuLmlzRGVmYXVsdCk7XHJcbiAgICAgICAgaWYgKGRlZmF1bHRJdGVtKSB7XHJcbiAgICAgICAgICAgIHRoaXMuY2hhbmdlcyA9IHRoaXMuY2hhbmdlcyB8fCB7fTtcclxuICAgICAgICAgICAgdGhpcy5jaGFuZ2VzLmRlZmF1bHRJZCA9IGRlZmF1bHRJdGVtLmlkO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyB0aGlzLmNkLmRldGVjdENoYW5nZXMoKTtcclxuICAgIH1cclxuXHJcbiAgICBvblNjaGVtZURlbCgkZXZlbnQsIGN0eCkge1xyXG4gICAgICAgIGlmICgodGhpcy5jdXJyZW50VXNlcklkID09PSBjdHgucm93RGF0YVtcInVzZXJJZFwiXSAmJiAgY3R4LnJvd0RhdGFbJ3R5cGUnXT09J3ByaXZhdGUnKSB8fCB0aGlzLnJlbW92ZUl0ZW0pIHtcclxuICAgICAgICAgICAgJGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gICAgICAgICAgICBjb25zdCBpZCA9IGN0eC5yb3dEYXRhLmlkO1xyXG4gICAgICAgICAgICB0aGlzLml0ZW1zID0gdGhpcy5pdGVtcy5maWx0ZXIobiA9PiBuLmlkICE9PSBpZCk7XHJcbiAgICAgICAgICAgIHRoaXMuY2hhbmdlcyA9IHRoaXMuY2hhbmdlcyB8fCB7fTtcclxuICAgICAgICAgICAgdGhpcy5jaGFuZ2VzLmRlbGV0ZWRJZHMgPSBbLi4uKHRoaXMuY2hhbmdlcy5kZWxldGVkSWRzIHx8IFtdKSwgaWRdO1xyXG4gICAgICAgICAgICBpZiAoaWQgPT09IHRoaXMuY2hhbmdlcy5kZWZhdWx0SWQpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuY2hhbmdlcy5kZWZhdWx0SWQgPSAnJztcclxuICAgICAgICAgICAgICAgIGRlbGV0ZSB0aGlzLmNoYW5nZXMuZGVmYXVsdElkO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59Il19
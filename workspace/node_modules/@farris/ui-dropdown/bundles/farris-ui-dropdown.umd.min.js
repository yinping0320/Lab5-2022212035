!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("rxjs"),require("rxjs/operators"),require("@farris/ui-common"),require("@angular/core"),require("@angular/common")):"function"==typeof define&&define.amd?define("@farris/ui-dropdown",["exports","rxjs","rxjs/operators","@farris/ui-common","@angular/core","@angular/common"],t):t((e.farris=e.farris||{},e.farris["ui-dropdown"]={}),e.rxjs,e.rxjs.operators,e.uiCommon,e.ng.core,e.ng.common)}(this,function(e,i,n,o,s,t){"use strict";var r=(Object.defineProperty(l.prototype,"forceState",{set:function(e){e&&e.length&&this.close()},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"openState",{set:function(e){this._internalOpen=e[0],this.isOpenState.next(e[0])},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"placement",{get:function(){return this._placement},set:function(e){if(e&&e!==this._placement){var t=this._getClsName(e),n=this._getClsName(this._placement);this.render.removeClass(this._seflEl,n),this.render.addClass(this._seflEl,t),this._placement=e}},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"isOpen",{get:function(){return this._internalOpen},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"submenuCls",{get:function(){return this.isSubDP},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"dropdownCls",{get:function(){return!this.isSubDP},enumerable:!0,configurable:!0}),l.prototype.ngOnInit=function(){},l.prototype.getNativeElement=function(){return this._seflEl},l.prototype.bindDocumentEvents=function(){this.documentClickEventListener=this.onDocumentClick.bind(this),document.addEventListener("click",this.documentClickEventListener),this.selfDefineEventListener=this.onSelfDefineHandler.bind(this),this._seflEl.addEventListener("selfClose",this.selfDefineEventListener)},l.prototype.onSelfDefineHandler=function(){this.close()},l.prototype.unbindDocumentEvents=function(){this.documentClickEventListener&&(document.removeEventListener("click",this.documentClickEventListener),this.documentClickEventListener=null),this.selfDefineEventListener&&(this._seflEl.removeEventListener("selfClose",this.selfDefineEventListener),this.selfDefineEventListener=null)},l.prototype.onDocumentClick=function(e){this._internalOpen&&(2===e.button||this.isEventFromToggle(e)||this.close())},l.prototype.needToCalculate=function(){return this.autoRectify&&this._calculateMenu},l.prototype.resetCalculate=function(e){this._calculateMenu=e},l.prototype.open=function(){this._internalOpen||(this.closeSiblingDropdowns(),this._calculateMenu=!0,this.render.addClass(this._seflEl,"show"),this.isOpenState.next(!0),this.dpChangeEvent.emit(!0),this.bindDocumentEvents())},l.prototype.close=function(e){void 0===e&&(e=!0),this._internalOpen&&(this._calculateMenu=!1,this.render.removeClass(this._seflEl,"show"),e&&(this.isOpenState.next(!1),this.dpChangeEvent.emit(!1)),this.unbindDocumentEvents())},l.prototype.toggle=function(){this._internalOpen?this.close():this.open()},l.prototype.getOpenState=function(){return this.isOpenState},l.prototype.ngOnDestroy=function(){this.isOpenState.unsubscribe(),this.unbindDocumentEvents();var e=this.menuEls.get(this._seflEl);e&&e.length&&e.forEach(function(e){e.remove()})},l.prototype.closeSiblingDropdowns=function(){var e=this._seflEl.parentNode;if(e&&-1<e.className.indexOf("dropdown-menu")){var t=e.querySelectorAll("[fDropdown]");if(t&&1<t.length)for(var n=0;n<t.length;n++)t[n].className.indexOf("show")&&this.compatibleDispatchEvent(t[n],"selfClose")}},l.prototype.compatibleDispatchEvent=function(e,t){var n;"function"==typeof Event?n=new Event(t):(n=document.createEvent("Event")).initEvent(t,!1,!1),e.dispatchEvent(n)},l.prototype._getClsName=function(e){var t="";switch(e){case"top-right":case"top":t="dropup";break;case"top-left":t="dropup-left";break;case"left-bottom":case"left":t="dropleft";break;case"left-top":t="dropleft-up";break;case"right-bottom":case"right":t="dropright";break;case"right-top":t="dropright-up";break;case"bottom-left":t="dropdown-left";break;case"bottom-right":t="dropdown";break;default:t="dropdown"}return t},l.prototype.isEventFromToggle=function(e){return this.toggleElement&&this.toggleElement.contains(e.target)},l.prototype.getRectifyReferenceEl=function(){var e=window.innerWidth,t=window.innerHeight;return this.rectifyReference&&(e=this.rectifyReference.getBoundingClientRect().right),this.rectifyReferenceV&&(e=this.rectifyReference.getBoundingClientRect().bottom),{width:e,height:t}},l.prototype.appendMenuEl=function(e){var t=this.menuEls.get(e)||[];t.push(e),this.menuEls.set(this._seflEl,t)},l.decorators=[{type:s.Directive,args:[{selector:"[fDropdown]",exportAs:"fDropdown"}]}],l.ctorParameters=function(){return[{type:s.ElementRef},{type:s.Renderer2}]},l.propDecorators={rectifyReference:[{type:s.Input}],rectifyReferenceV:[{type:s.Input}],autoRectify:[{type:s.Input}],forceState:[{type:s.Input,args:["forceState"]}],openState:[{type:s.Input,args:["open"]}],dpChangeEvent:[{type:s.Output}],isSubDP:[{type:s.Input}],placement:[{type:s.Input,args:["placement"]}],submenuCls:[{type:s.HostBinding,args:["class.dropdown-submenu"]}],dropdownCls:[{type:s.HostBinding,args:["class.dropdown"]}]},l);function l(e,t){var n=this;this.elementRef=e,this.render=t,this._internalOpen=!1,this._calculateMenu=!1,this.autoRectify=!1,this.dpChangeEvent=new s.EventEmitter,this._placement="bottom",this.isSubDP=!1,this.isOpenState=new i.Subject,this.menuEls=new WeakMap,this._seflEl=this.elementRef.nativeElement,this.isOpenState.subscribe(function(e){n._internalOpen!==e&&(n._internalOpen=e,n._internalOpen?n.render.addClass(n._seflEl,"show"):n.render.removeClass(n._seflEl,"show"))})}var a=(p.prototype.ngAfterViewChecked=function(){},p.prototype.getRealPlacement=function(e){var t="bottom-right";switch(e){case"top":t="top-right";break;case"left":t="left-bottom";break;case"right":t="right-bottom";break;case"bottom":t="bottom-right";break;default:t=e}return t},p.prototype.ngOnDestroy=function(){},p.prototype.openStateChange=function(){var e=this;if(this.dpIsOpen)this.elementRef.nativeElement.className.indexOf("show")<0&&(document.body.style.overflow="hidden",this.elementRef.nativeElement.style.visibility="hidden",this.elementRef.nativeElement.className+=" show",this.dropdown.needToCalculate()&&(this._docRect=this.dropdown.getRectifyReferenceEl()),setTimeout(function(){e.changeDirection(),document.body.style.overflow="",e.elementRef.nativeElement.style.visibility="visible"},0));else{-1<this.elementRef.nativeElement.className.indexOf("show")&&(this.elementRef.nativeElement.className=this.elementRef.nativeElement.className.replace(" show"," "),this.elementRef.nativeElement.style.cssText="");var t=this.elementRef.nativeElement.querySelectorAll(".dropdown-menu");t&&t.length&&t.forEach(function(e){e.classList.remove("show"),e.style.cssText=""});var n=this.elementRef.nativeElement.querySelector(".show");n&&n.classList.remove("show");var i=this.elementRef.nativeElement.querySelector(".active");i&&i.classList.remove("active"),this.dropdown._internalOpen=!1}},p.prototype.changeDirection=function(){this.setMenuPanelPosition()},p.prototype.issubMenu=function(){var e=this.dropdown.getNativeElement();return-1<e.className.indexOf("dropdown-submenu")||e.closest(".dropdown-submenu")||e.classList.contains("dropright")},p.prototype.setMenuPanelPosition=function(){var e=this.dropdown.getNativeElement(),t=e.getBoundingClientRect(),n=t.height,i=t.left,o=t.top,s=t.width,r=getComputedStyle(this.elementRef.nativeElement),l=r.marginTop,a=r.marginBottom,p=this.elementRef.nativeElement.getBoundingClientRect(),c=p.width,d=p.height,u=0,h=Math.ceil(parseFloat(l))+Math.ceil(parseFloat(a)),m=o+n,f=i;if(window.innerHeight-o-n-h<d&&(m=o-d)<0&&(u=o-(m=10)-h),window.innerWidth-i-s<c&&(f=i-c+s),this.issubMenu()){var g=window.innerWidth-i-e.offsetWidth,v=this.elementRef.nativeElement;if(v.offsetWidth>g){var y=-c;v.style.left=y+"px"}if(window.innerHeight-v.getBoundingClientRect().top<v.offsetHeight){var w=window.innerHeight-o-v.offsetHeight-10;v.style.top=w+"px"}}else document.body.append(this.elementRef.nativeElement),this.dropdown.appendMenuEl(this.elementRef.nativeElement),this.elementRef.nativeElement.style.cssText="position:fixed;bottom:unset;left:"+f+"px !important;top:"+m+"px !important;right: unset;max-height:"+(u?u+"px;overflow:auto":"none"),this.elementRef.nativeElement.style.zIndex=this.commonUtils.getFloatingLayerIndex()},p.decorators=[{type:s.Directive,args:[{selector:"[fDropdownMenu]"}]}],p.ctorParameters=function(){return[{type:s.ElementRef},{type:r}]},p.propDecorators={showDropdownMenu:[{type:s.HostBinding,args:["class.dropdown-menu"]}],dpIsOpen:[{type:s.Input}]},p);function p(e,t){var i=this;this.elementRef=e,this.dropdown=t,this._docRect={width:0,height:0},this.showDropdownMenu=!0,this.dpIsOpen=!1,this.overLayService=null,this.overLayService=new o.OverLayHiddenService,this.commonUtils=new o.CommonUtils,this.dropdown.getOpenState().pipe(n.debounceTime(50)).subscribe(function(e){var t=i.dropdown.getNativeElement();if(i.dpIsOpen=i.dropdown.isOpen,i.issubMenu()){e&&!i.dpIsOpen&&i.elementRef.nativeElement.className.indexOf("show")<0&&(i.dpIsOpen=!0);var n=i.dropdown.getNativeElement().closest(".dropdown-menu");if(n)n.querySelectorAll(".show").forEach(function(e){e.classList.remove("show"),e.style.cssText=""})}i.dpIsOpen?i.overLayService.registerMouseEvent(t,function(e){var t=e.target,n=Array.from(t.classList||[]);n.includes("dropdown-toggle")||t.closest(".dropdown-item")||n.includes("dropdown-item")||i.dropdown.getNativeElement().contains(t)&&"mousewheel"!==e.type||i.elementRef.nativeElement.contains(t)||(i.dpIsOpen=!1,i.dropdown.close(!1),i.openStateChange())}):(i.dropdown.close(!1),i.overLayService.destory(t)),i.openStateChange()})}var c=(Object.defineProperty(d.prototype,"dpDisabled",{set:function(e){this._disabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"disableCls",{get:function(){return this._disabled},enumerable:!0,configurable:!0}),d.prototype.onclick=function(e){this._disabled||(this.dropdown.isSubDP&&e.stopImmediatePropagation(),this.dropdown.toggle())},d.decorators=[{type:s.Directive,args:[{selector:"[fDropdownToggle]"}]}],d.ctorParameters=function(){return[{type:r},{type:s.ElementRef}]},d.propDecorators={dpDisabled:[{type:s.Input}],disableCls:[{type:s.HostBinding,args:["class.disabled"]}],haspopup:[{type:s.HostBinding,args:["attr.aria-haspopup"]}],onclick:[{type:s.HostListener,args:["click",["$event"]]}]},d);function d(e,t){var n=this;this.dropdown=e,this.elementRef=t,this._disabled=!1,this.haspopup=!0,this.nativeEle=null,e.toggleElement=t.nativeElement,this.nativeEle=t.nativeElement,this.dropdown.getOpenState().subscribe(function(e){n.dropdown.isSubDP&&n.dropdown.isOpen?n.nativeEle.className.indexOf("active")<0&&(n.nativeEle.className+=" active"):-1<n.nativeEle.className.indexOf("active")&&(n.nativeEle.className=n.nativeEle.className.replace(" active"," "))})}var u=[r,a,c],h=(m.decorators=[{type:s.NgModule,args:[{imports:[o.FarrisCommonModule],declarations:u,exports:u}]}],m);function m(){}var f=(Object.defineProperty(g.prototype,"width",{get:function(){return this._width},set:function(e){this._width=this.resolveSize(e)},enumerable:!0,configurable:!0}),g.prototype.ngOnInit=function(){this.menu=this.el.nativeElement.querySelector(".dropdown-menu")},g.prototype.ngAfterViewInit=function(){},g.prototype.ngOnDestroy=function(){this.globalListenFunc&&this.globalListenFunc()},g.prototype.showDropMenu=function(e){var t=this;this.hover||(e&&e.stopPropagation(),this.show=!this.show,this.visibleChange.emit(),this.globalListenFunc=this.renderer.listen("document","click",function(){t.closeDropMenu()}),this.hideOnClick||(this.menuListenFunc=this.renderer.listen(this.menu,"click",function(e){e.stopPropagation()})))},g.prototype.closeDropMenu=function(){this.hover||(this.show=!1,this.visibleChange.emit(),this.globalListenFunc&&this.globalListenFunc(),this.menuListenFunc&&this.menuListenFunc())},g.prototype.hoverDropdown=function(){this.hover&&(this.show=!this.show,this.visibleChange.emit())},g.prototype.selectItem=function(e){this.select.emit(e)},g.prototype.leftButtonClick=function(){this.leftClick.emit()},g.prototype.resolveSize=function(e){var t=/px|em|rem|pt|%/;return t.test(e)?""+parseInt(e,10)+e.match(t)[0]:e+"px"},g.decorators=[{type:s.Component,args:[{selector:"farris-dropdown",template:'\n        <div\n            class="farris-dropdown btn-group"\n            [class.dropup]="position === \'top\'"\n            [class.dropdown]="position === \'bottom\'"\n            [class.dropleft]="position === \'left\'"\n            [class.dropright]="position === \'right\'"\n            [style.width]="width"\n        >\n            <span\n                [class.btn]="!nest"\n                [class.dropdown-item]="nest"\n                [class.btn-lg]="size === \'large\'"\n                [class.btn-sm]="size === \'small\'"\n                [class.btn-primary]="type === \'primary\'"\n                [class.btn-success]="type === \'success\'"\n                [class.btn-warning]="type === \'warning\'"\n                [class.btn-danger]="type === \'danger\'"\n                [class.btn-info]="type === \'info\'"\n                (click)="leftButtonClick()"\n                style="width:100%"\n                *ngIf="splitButton"\n                >{{ title }}</span\n            >\n            <span\n                class="dropdown-toggle"\n                [class.btn]="!nest"\n                [class.dropdown-item]="nest"\n                [class.dropdown-toggle-split]="splitButton"\n                [class.btn-lg]="size === \'large\'"\n                [class.btn-sm]="size === \'small\'"\n                [class.btn-primary]="type === \'primary\'"\n                [class.btn-success]="type === \'success\'"\n                [class.btn-warning]="type === \'warning\'"\n                [class.btn-danger]="type === \'danger\'"\n                [class.btn-info]="type === \'info\'"\n                [class.btn-secondary]="type === \'secondary\'"\n                (click)="showDropMenu($event)"\n                (mouseenter)="hoverDropdown()"\n                (mouseleave)="hoverDropdown()"\n                style="width:100%"\n            >\n                <span class="sr-only" *ngIf="splitButton"></span>\n                {{ splitButton ? \'\' : title }}\n            </span>\n            <div class="dropdown-menu" [class.show]="show">\n                <ng-template [ngTemplateOutlet]="dropdownTempl"></ng-template>\n                <farris-dropdown-item\n                    *ngFor="let item of model"\n                    [model]="item"\n                    (select)="selectItem($event)"\n                >\n                </farris-dropdown-item>\n            </div>\n        </div>\n    '}]}],g.ctorParameters=function(){return[{type:s.ElementRef},{type:s.Renderer2}]},g.propDecorators={nest:[{type:s.Input}],width:[{type:s.Input}],title:[{type:s.Input}],hover:[{type:s.Input}],size:[{type:s.Input}],type:[{type:s.Input}],hideOnClick:[{type:s.Input,args:["hide-on-click"]}],splitButton:[{type:s.Input,args:["split-button"]}],position:[{type:s.Input}],model:[{type:s.Input}],dropdownTempl:[{type:s.ContentChild,args:["dropdownTempl"]}],leftClick:[{type:s.Output,args:["left-click"]}],select:[{type:s.Output}],visibleChange:[{type:s.Output,args:["visible-change"]}]},g);function g(e,t){this.el=e,this.renderer=t,this.type="primary",this.hideOnClick=!0,this.splitButton=!1,this.position="bottom",this.model=[{label:"项目一",value:"asdasd"},{label:"项目二",value:"asdasd"},{label:"项目三",value:"asdasd"}],this.leftClick=new s.EventEmitter,this.select=new s.EventEmitter,this.visibleChange=new s.EventEmitter,this.show=!1}var v=(y.prototype.selectItem=function(){this.model.disabled||this.select.emit(this.model)},y.decorators=[{type:s.Component,args:[{selector:"farris-dropdown-item",template:'\n        <div class="dropdown-divider" *ngIf="model.divide"></div>\n        <a\n            class="dropdown-item"\n            [class.active]="model.active"\n            [class.disabled]="model.disabled"\n            href="javascript:void(0)"\n            (click)="selectItem()"\n            >{{ model.label }}</a\n        >\n    '}]}],y.propDecorators={model:[{type:s.Input}],select:[{type:s.Output}]},y);function y(){this.select=new s.EventEmitter}var w=(b.decorators=[{type:s.NgModule,args:[{imports:[t.CommonModule],declarations:[f,v],exports:[f,v]}]}],b);function b(){}e.FDropdownDirectiveTypeModule=h,e.FDropdownMenuDirective=a,e.FDropdownToggleDirective=c,e.FDropdownDirective=r,e.FarrisDropdownComponent=f,e.FarrisDropdownItemComponent=v,e.FarrisDropdownModule=w,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=farris-ui-dropdown.umd.min.js.map
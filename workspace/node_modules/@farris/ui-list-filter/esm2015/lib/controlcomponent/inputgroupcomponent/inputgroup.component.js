/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input, ViewChild, EventEmitter, Output, HostBinding } from '@angular/core';
import { SolutionService } from '../../service/solution.service';
import { InputGroupComponent } from '@farris/ui-input-group';
export class FilterInputGroupComponent {
    /**
     * @param {?} solutionService
     */
    constructor(solutionService) {
        this.solutionService = solutionService;
        /**
         * 判断是否是在扩展区域展示
         */
        this.extend = false;
        /**
         * 判断是否显示label
         */
        this.showlabel = true;
        this.searchHandle = new EventEmitter();
        this.isTextFromDialog = false;
    }
    /**
     * @param {?} textItem
     * @return {?}
     */
    set item(textItem) {
        this._inputItem = textItem;
    }
    /**
     * @return {?}
     */
    get item() {
        return this.constructTextItem(this._inputItem);
    }
    /**
     * @return {?}
     */
    get isExtend() {
        return !this.extend && this.autoLabel;
    }
    /**
     * @return {?}
     */
    get hidenLabel() {
        return !this.showlabel;
    }
    /**
     * @param {?} textItem
     * @return {?}
     */
    constructTextItem(textItem) {
        /** @type {?} */
        const textValueObj = (/** @type {?} */ (textItem.value));
        textValueObj.textValue = textValueObj.textValue && textValueObj.textValue.trim();
        textItem.value = textValueObj;
        return textItem;
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.testId = this.solutionService.getGuid();
        this.getInputGroupBindingInfo();
        if (this.item && this.item.control && this.item.control.hasOwnProperty('isExtend')) {
            this.extend = this.item.control.isExtend;
            if (!this.extend) {
                this.showlabel = this.item.control.showLabel;
            }
        }
        this.solutionService.addFilterEditorInstance(this.item.fieldCode, this);
    }
    /**
     * @return {?}
     */
    getInputGroupBindingInfo() {
        /** @type {?} */
        const inputGroupControl = ((/** @type {?} */ (this.item.control)));
        this.usageMode = inputGroupControl.usageMode;
        if (this.usageMode == 'open-modal' || this.usageMode == 'open-remote-modal') {
            this.dialogOptions = inputGroupControl.dialogOptions;
            /*
                example of dialogOptions = {
                   modalId: "1e011720-eb0f-4c9c-82b6-6844c89b2303"
                   mapFields: {hDepartment: "Name"}
                   title: "测试标题栏"
                   width: 800
                   height: 600
                }
             */
            if (this.dialogOptions.mapFields) {
                this.textField = JSON.stringify(this.dialogOptions.mapFields).split('"')[1];
            }
        }
    }
    /**
     * @param {?} field
     * @return {?}
     */
    getConditionItemTitle(field) {
        return this.solutionService.getConditionItemTitle(field);
    }
    /*
            dialogOptions = {
                modalId: "ae011720-eb0f-4c9c-82b6-6844c89b2303"
                mapFields: {hDepartment: "Name"}
                title: "测试标题栏"
                width: 800
                height: 600
                showButtons: true
                buttons: [
                    { text: "确定", cls: "btn-primary", handle: _this.viewModel.rootviewmodelconfirm1 },
                    { text: "取消", cls: "btn-secondary", handle: _this.viewModel.rootviewmodelcancel1}
                ]
            }
        */
    /**
     * @param {?} event
     * @return {?}
     */
    onClick(event) {
        if (this.usageMode == 'text') {
            this.item.control.click();
        }
        else {
            /** @type {?} */
            const options = this.dialogOptions;
            options.handle = (/**
             * @param {?} selectedItem
             * @return {?}
             */
            (selectedItem) => {
                // let modalData = item[0];
                // this.item.value.value = modalData[this.targetField];
                /** @type {?} */
                let selectedItems = selectedItem.filter((/**
                 * @param {?} n
                 * @return {?}
                 */
                n => n));
                if (selectedItems && this.textField) {
                    this.item.value.value = selectedItems;
                    this.item.value.textValue = this.item.value.getTextValue(this.textField);
                    this.item.value.textField = this.textField;
                    this.item.value.isInputText = false;
                    if (this.inputgroup) {
                        this.inputgroup.cd.detectChanges();
                        this.inputgroup.value = this.item.value.textValue;
                    }
                    this.isTextFromDialog = true;
                    this.textFormDialog = this.item.value.textValue;
                    this.onBlur();
                }
            });
            this.item.control.click({ event, options });
        }
    }
    /**
     * @return {?}
     */
    onBlur() {
        if (this.disabled) {
            return;
        }
        if (this.usageMode == 'text') {
            this.item.value.isInputText = true;
        }
        if (this.usageMode == 'open-modal' || this.usageMode == 'open-remote-modal') {
            if (!this.isTextFromDialog) {
                this.item.value.isInputText = true;
            }
            if (this.item.value.textValue != this.textFormDialog) {
                this.isTextFromDialog = false;
                this.item.value.value = [];
                this.item.value.textField = undefined;
                this.item.value.isInputText = true;
            }
        }
        this.searchHandle.emit();
    }
    /**
     * @return {?}
     */
    onClear() {
        ((/** @type {?} */ (this.item.value))).clearValue();
        this.searchHandle.emit();
    }
}
FilterInputGroupComponent.decorators = [
    { type: Component, args: [{
                selector: 'app-filter-inputgroup',
                template: "<label class=\"col-form-label\" *ngIf=\"item && showlabel\" title=\"{{getConditionItemTitle(item)}}\">\r\n    <span class=\"farris-label-info text-danger\" *ngIf=\"item.control.required\">*</span>\r\n    <span class=\"farris-label-text\">{{item.fieldName}}</span>\r\n</label>\r\n<div class=\"farris-input-wrap\" *ngIf=\"item\">\r\n    <input-group #inputgroup\r\n        [(ngModel)]=\"item.value.textValue\" \r\n        name=\"{{item.fieldName}}\" \r\n        id=\"{{testId}}\"\r\n        [readonly]=\"disabled\"\r\n        [groupText]=\"item.control.groupText\"\r\n        [editable]=\"item.control.editable\"\r\n        [placeholder]=\"item.placeHolder\"\r\n        (clickHandle)=\"onClick($event)\"\r\n        (blurHandle)=\"onBlur()\"\r\n        (clear)=\"onClear()\"\r\n        >\r\n    </input-group>\r\n</div>\r\n"
            }] }
];
/** @nocollapse */
FilterInputGroupComponent.ctorParameters = () => [
    { type: SolutionService }
];
FilterInputGroupComponent.propDecorators = {
    item: [{ type: Input }],
    autoLabel: [{ type: Input }],
    disabled: [{ type: Input }],
    isExtend: [{ type: HostBinding, args: ['class.filter-item-wrap',] }],
    hidenLabel: [{ type: HostBinding, args: ['class.filter-item-hiddenlabel',] }],
    searchHandle: [{ type: Output, args: ['searchHandle',] }],
    inputgroup: [{ type: ViewChild, args: ['inputgroup',] }]
};
if (false) {
    /**
     * QueryCondition类型
     * @type {?}
     */
    FilterInputGroupComponent.prototype._inputItem;
    /** @type {?} */
    FilterInputGroupComponent.prototype.testId;
    /** @type {?} */
    FilterInputGroupComponent.prototype.usageMode;
    /** @type {?} */
    FilterInputGroupComponent.prototype.dialogOptions;
    /** @type {?} */
    FilterInputGroupComponent.prototype.autoLabel;
    /** @type {?} */
    FilterInputGroupComponent.prototype.disabled;
    /**
     * 判断是否是在扩展区域展示
     * @type {?}
     */
    FilterInputGroupComponent.prototype.extend;
    /**
     * 判断是否显示label
     * @type {?}
     */
    FilterInputGroupComponent.prototype.showlabel;
    /** @type {?} */
    FilterInputGroupComponent.prototype.searchHandle;
    /** @type {?} */
    FilterInputGroupComponent.prototype.inputgroup;
    /** @type {?} */
    FilterInputGroupComponent.prototype.textField;
    /** @type {?} */
    FilterInputGroupComponent.prototype.isTextFromDialog;
    /** @type {?} */
    FilterInputGroupComponent.prototype.textFormDialog;
    /**
     * @type {?}
     * @private
     */
    FilterInputGroupComponent.prototype.solutionService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5wdXRncm91cC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL3VpLWxpc3QtZmlsdGVyLyIsInNvdXJjZXMiOlsibGliL2NvbnRyb2xjb21wb25lbnQvaW5wdXRncm91cGNvbXBvbmVudC9pbnB1dGdyb3VwLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFFLFNBQVMsRUFBRSxLQUFLLEVBQVUsU0FBUyxFQUFFLFlBQVksRUFBRSxNQUFNLEVBQUUsV0FBVyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBRXZHLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxnQ0FBZ0MsQ0FBQztBQUdqRSxPQUFPLEVBQUUsbUJBQW1CLEVBQUUsTUFBTSx3QkFBd0IsQ0FBQztBQVE3RCxNQUFNLE9BQU8seUJBQXlCOzs7O0lBbURsQyxZQUFvQixlQUFnQztRQUFoQyxvQkFBZSxHQUFmLGVBQWUsQ0FBaUI7Ozs7UUE1QnBELFdBQU0sR0FBWSxLQUFLLENBQUM7Ozs7UUFFeEIsY0FBUyxHQUFZLElBQUksQ0FBQztRQVdGLGlCQUFZLEdBQUcsSUFBSSxZQUFZLEVBQUUsQ0FBQztRQUsxRCxxQkFBZ0IsR0FBRyxLQUFLLENBQUM7SUFVK0IsQ0FBQzs7Ozs7SUF2Q3pELElBQ0ksSUFBSSxDQUFDLFFBQWE7UUFDbEIsSUFBSSxDQUFDLFVBQVUsR0FBRyxRQUFRLENBQUM7SUFDL0IsQ0FBQzs7OztJQUNELElBQUksSUFBSTtRQUNKLE9BQU8sSUFBSSxDQUFDLGlCQUFpQixDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQztJQUNuRCxDQUFDOzs7O0lBU0QsSUFDSSxRQUFRO1FBQ1IsT0FBTyxDQUFDLElBQUksQ0FBQyxNQUFNLElBQUksSUFBSSxDQUFDLFNBQVMsQ0FBQztJQUMxQyxDQUFDOzs7O0lBQ0QsSUFDSSxVQUFVO1FBQ1YsT0FBTyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUM7SUFDM0IsQ0FBQzs7Ozs7SUFV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LCBFdmVudEVtaXR0ZXIsIE91dHB1dCwgSG9zdEJpbmRpbmcgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgUXVlcnlDb25kaXRpb24gfSBmcm9tICcuLi8uLi9lbnRpdHkvcXVlcnljb25kaXRpb24nO1xyXG5pbXBvcnQgeyBTb2x1dGlvblNlcnZpY2UgfSBmcm9tICcuLi8uLi9zZXJ2aWNlL3NvbHV0aW9uLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBJbnB1dEdyb3VwQ29udHJvbCB9IGZyb20gJy4uLy4uL2VudGl0eS9jb250cm9sdHlwZS9pbnB1dC1ncm91cC9pbnB1dGdyb3VwY29udHJvbCc7XHJcbmltcG9ydCB7IElucHV0R3JvdXBWYWx1ZSB9IGZyb20gJy4uLy4uL2VudGl0eS9jb25kaXRpb252YWx1ZS9pbnB1dGdyb3VwJztcclxuaW1wb3J0IHsgSW5wdXRHcm91cENvbXBvbmVudCB9IGZyb20gJ0BmYXJyaXMvdWktaW5wdXQtZ3JvdXAnO1xyXG5cclxuXHJcbkBDb21wb25lbnQoe1xyXG4gICAgc2VsZWN0b3I6ICdhcHAtZmlsdGVyLWlucHV0Z3JvdXAnLFxyXG4gICAgdGVtcGxhdGVVcmw6ICcuL2lucHV0Z3JvdXAuY29tcG9uZW50Lmh0bWwnLFxyXG59KVxyXG5cclxuZXhwb3J0IGNsYXNzIEZpbHRlcklucHV0R3JvdXBDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xyXG4gICAgLyoqXHJcbiAgICAgKiBRdWVyeUNvbmRpdGlvbuexu+Wei1xyXG4gICAgICovXHJcbiAgICBfaW5wdXRJdGVtOiBRdWVyeUNvbmRpdGlvbjtcclxuXHJcbiAgICB0ZXN0SWQ6IHN0cmluZztcclxuXHJcbiAgICB1c2FnZU1vZGU6IHN0cmluZztcclxuXHJcbiAgICBkaWFsb2dPcHRpb25zOiBhbnk7XHJcblxyXG4gICAgQElucHV0KClcclxuICAgIHNldCBpdGVtKHRleHRJdGVtOiBhbnkpIHtcclxuICAgICAgICB0aGlzLl9pbnB1dEl0ZW0gPSB0ZXh0SXRlbTtcclxuICAgIH1cclxuICAgIGdldCBpdGVtKCk6IGFueSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY29uc3RydWN0VGV4dEl0ZW0odGhpcy5faW5wdXRJdGVtKTtcclxuICAgIH1cclxuICAgIEBJbnB1dCgpIGF1dG9MYWJlbDogYm9vbGVhbjtcclxuICAgIEBJbnB1dCgpIGRpc2FibGVkOiBib29sZWFuO1xyXG5cclxuICAgIC8qKuWIpOaWreaYr+WQpuaYr+WcqOaJqeWxleWMuuWfn+WxleekuiAqL1xyXG4gICAgZXh0ZW5kOiBib29sZWFuID0gZmFsc2U7XHJcbiAgICAvKirliKTmlq3mmK/lkKbmmL7npLpsYWJlbCAqL1xyXG4gICAgc2hvd2xhYmVsOiBib29sZWFuID0gdHJ1ZTtcclxuXHJcbiAgICBASG9zdEJpbmRpbmcoJ2NsYXNzLmZpbHRlci1pdGVtLXdyYXAnKVxyXG4gICAgZ2V0IGlzRXh0ZW5kKCk6IGJvb2xlYW4ge1xyXG4gICAgICAgIHJldHVybiAhdGhpcy5leHRlbmQgJiYgdGhpcy5hdXRvTGFiZWw7XHJcbiAgICB9XHJcbiAgICBASG9zdEJpbmRpbmcoJ2NsYXNzLmZpbHRlci1pdGVtLWhpZGRlbmxhYmVsJylcclxuICAgIGdldCBoaWRlbkxhYmVsKCk6IGJvb2xlYW4ge1xyXG4gICAgICAgIHJldHVybiAhdGhpcy5zaG93bGFiZWw7XHJcbiAgICB9XHJcblxyXG4gICAgQE91dHB1dCgnc2VhcmNoSGFuZGxlJykgc2VhcmNoSGFuZGxlID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG5cclxuICAgIEBWaWV3Q2hpbGQoJ2lucHV0Z3JvdXAnKSBpbnB1dGdyb3VwOiBJbnB1dEdyb3VwQ29tcG9uZW50O1xyXG5cclxuICAgIHRleHRGaWVsZDogc3RyaW5nO1xyXG4gICAgaXNUZXh0RnJvbURpYWxvZyA9IGZhbHNlO1xyXG4gICAgdGV4dEZvcm1EaWFsb2c6IHN0cmluZztcclxuXHJcbiAgICBjb25zdHJ1Y3RUZXh0SXRlbSh0ZXh0SXRlbTogUXVlcnlDb25kaXRpb24pOiBRdWVyeUNvbmRpdGlvbiB7XHJcbiAgICAgICAgY29uc3QgdGV4dFZhbHVlT2JqID0gdGV4dEl0ZW0udmFsdWUgYXMgSW5wdXRHcm91cFZhbHVlO1xyXG4gICAgICAgIHRleHRWYWx1ZU9iai50ZXh0VmFsdWUgPSB0ZXh0VmFsdWVPYmoudGV4dFZhbHVlICYmIHRleHRWYWx1ZU9iai50ZXh0VmFsdWUudHJpbSgpO1xyXG4gICAgICAgIHRleHRJdGVtLnZhbHVlID0gdGV4dFZhbHVlT2JqO1xyXG4gICAgICAgIHJldHVybiB0ZXh0SXRlbTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIHNvbHV0aW9uU2VydmljZTogU29sdXRpb25TZXJ2aWNlKSB7IH1cclxuXHJcbiAgICBuZ09uSW5pdCgpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLnRlc3RJZCA9IHRoaXMuc29sdXRpb25TZXJ2aWNlLmdldEd1aWQoKTtcclxuICAgICAgICB0aGlzLmdldElucHV0R3JvdXBCaW5kaW5nSW5mbygpO1xyXG5cclxuICAgICAgICBpZiAodGhpcy5pdGVtICYmIHRoaXMuaXRlbS5jb250cm9sICYmIHRoaXMuaXRlbS5jb250cm9sLmhhc093blByb3BlcnR5KCdpc0V4dGVuZCcpKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZXh0ZW5kID0gdGhpcy5pdGVtLmNvbnRyb2wuaXNFeHRlbmQ7XHJcbiAgICAgICAgICAgIGlmICghdGhpcy5leHRlbmQpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2hvd2xhYmVsID0gdGhpcy5pdGVtLmNvbnRyb2wuc2hvd0xhYmVsO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuc29sdXRpb25TZXJ2aWNlLmFkZEZpbHRlckVkaXRvckluc3RhbmNlKHRoaXMuaXRlbS5maWVsZENvZGUsIHRoaXMpO1xyXG4gICAgfVxyXG5cclxuICAgIGdldElucHV0R3JvdXBCaW5kaW5nSW5mbygpIHtcclxuICAgICAgICBjb25zdCBpbnB1dEdyb3VwQ29udHJvbCA9ICh0aGlzLml0ZW0uY29udHJvbCBhcyBJbnB1dEdyb3VwQ29udHJvbCk7XHJcbiAgICAgICAgdGhpcy51c2FnZU1vZGUgPSBpbnB1dEdyb3VwQ29udHJvbC51c2FnZU1vZGU7XHJcbiAgICAgICAgaWYgKHRoaXMudXNhZ2VNb2RlID09ICdvcGVuLW1vZGFsJyB8fCB0aGlzLnVzYWdlTW9kZSA9PSAnb3Blbi1yZW1vdGUtbW9kYWwnKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZGlhbG9nT3B0aW9ucyA9IGlucHV0R3JvdXBDb250cm9sLmRpYWxvZ09wdGlvbnM7XHJcbiAgICAgICAgICAgIC8qXHJcbiAgICAgICAgICAgICAgICBleGFtcGxlIG9mIGRpYWxvZ09wdGlvbnMgPSB7XHJcbiAgICAgICAgICAgICAgICAgICBtb2RhbElkOiBcIjFlMDExNzIwLWViMGYtNGM5Yy04MmI2LTY4NDRjODliMjMwM1wiXHJcbiAgICAgICAgICAgICAgICAgICBtYXBGaWVsZHM6IHtoRGVwYXJ0bWVudDogXCJOYW1lXCJ9XHJcbiAgICAgICAgICAgICAgICAgICB0aXRsZTogXCLmtYvor5XmoIfpopjmoI9cIlxyXG4gICAgICAgICAgICAgICAgICAgd2lkdGg6IDgwMFxyXG4gICAgICAgICAgICAgICAgICAgaGVpZ2h0OiA2MDBcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICovXHJcbiAgICAgICAgICAgIGlmICh0aGlzLmRpYWxvZ09wdGlvbnMubWFwRmllbGRzKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnRleHRGaWVsZCA9IEpTT04uc3RyaW5naWZ5KHRoaXMuZGlhbG9nT3B0aW9ucy5tYXBGaWVsZHMpLnNwbGl0KCdcIicpWzFdO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGdldENvbmRpdGlvbkl0ZW1UaXRsZShmaWVsZDogUXVlcnlDb25kaXRpb24pIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5zb2x1dGlvblNlcnZpY2UuZ2V0Q29uZGl0aW9uSXRlbVRpdGxlKGZpZWxkKTtcclxuICAgIH1cclxuXHJcbiAgICAvKlxyXG4gICAgICAgIGRpYWxvZ09wdGlvbnMgPSB7XHJcbiAgICAgICAgICAgIG1vZGFsSWQ6IFwiYWUwMTE3MjAtZWIwZi00YzljLTgyYjYtNjg0NGM4OWIyMzAzXCJcclxuICAgICAgICAgICAgbWFwRmllbGRzOiB7aERlcGFydG1lbnQ6IFwiTmFtZVwifVxyXG4gICAgICAgICAgICB0aXRsZTogXCLmtYvor5XmoIfpopjmoI9cIlxyXG4gICAgICAgICAgICB3aWR0aDogODAwXHJcbiAgICAgICAgICAgIGhlaWdodDogNjAwXHJcbiAgICAgICAgICAgIHNob3dCdXR0b25zOiB0cnVlXHJcbiAgICAgICAgICAgIGJ1dHRvbnM6IFtcclxuICAgICAgICAgICAgICAgIHsgdGV4dDogXCLnoa7lrppcIiwgY2xzOiBcImJ0bi1wcmltYXJ5XCIsIGhhbmRsZTogX3RoaXMudmlld01vZGVsLnJvb3R2aWV3bW9kZWxjb25maXJtMSB9LFxyXG4gICAgICAgICAgICAgICAgeyB0ZXh0OiBcIuWPlua2iFwiLCBjbHM6IFwiYnRuLXNlY29uZGFyeVwiLCBoYW5kbGU6IF90aGlzLnZpZXdNb2RlbC5yb290dmlld21vZGVsY2FuY2VsMX1cclxuICAgICAgICAgICAgXVxyXG4gICAgICAgIH1cclxuICAgICovXHJcbiAgICBvbkNsaWNrKGV2ZW50OiBhbnkpIHtcclxuICAgICAgICBpZiAodGhpcy51c2FnZU1vZGUgPT0gJ3RleHQnKSB7XHJcbiAgICAgICAgICAgIHRoaXMuaXRlbS5jb250cm9sLmNsaWNrKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBjb25zdCBvcHRpb25zID0gdGhpcy5kaWFsb2dPcHRpb25zO1xyXG4gICAgICAgICAgICBvcHRpb25zLmhhbmRsZSA9IChzZWxlY3RlZEl0ZW0pID0+IHtcclxuICAgICAgICAgICAgICAgIC8vIGxldCBtb2RhbERhdGEgPSBpdGVtWzBdO1xyXG4gICAgICAgICAgICAgICAgLy8gdGhpcy5pdGVtLnZhbHVlLnZhbHVlID0gbW9kYWxEYXRhW3RoaXMudGFyZ2V0RmllbGRdO1xyXG4gICAgICAgICAgICAgICAgbGV0IHNlbGVjdGVkSXRlbXMgPSBzZWxlY3RlZEl0ZW0uZmlsdGVyKG4gPT4gbik7XHJcbiAgICAgICAgICAgICAgICBpZiAoc2VsZWN0ZWRJdGVtcyAmJiB0aGlzLnRleHRGaWVsZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaXRlbS52YWx1ZS52YWx1ZSA9IHNlbGVjdGVkSXRlbXM7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pdGVtLnZhbHVlLnRleHRWYWx1ZSA9IHRoaXMuaXRlbS52YWx1ZS5nZXRUZXh0VmFsdWUodGhpcy50ZXh0RmllbGQpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaXRlbS52YWx1ZS50ZXh0RmllbGQgPSB0aGlzLnRleHRGaWVsZDtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLml0ZW0udmFsdWUuaXNJbnB1dFRleHQgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5pbnB1dGdyb3VwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaW5wdXRncm91cC5jZC5kZXRlY3RDaGFuZ2VzKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaW5wdXRncm91cC52YWx1ZSA9IHRoaXMuaXRlbS52YWx1ZS50ZXh0VmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaXNUZXh0RnJvbURpYWxvZyA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy50ZXh0Rm9ybURpYWxvZyA9IHRoaXMuaXRlbS52YWx1ZS50ZXh0VmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5vbkJsdXIoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLml0ZW0uY29udHJvbC5jbGljayh7IGV2ZW50LCBvcHRpb25zIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBvbkJsdXIoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuZGlzYWJsZWQpIHsgcmV0dXJuOyB9XHJcbiAgICAgICAgaWYgKHRoaXMudXNhZ2VNb2RlID09ICd0ZXh0Jykge1xyXG4gICAgICAgICAgICB0aGlzLml0ZW0udmFsdWUuaXNJbnB1dFRleHQgPSB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGhpcy51c2FnZU1vZGUgPT0gJ29wZW4tbW9kYWwnIHx8IHRoaXMudXNhZ2VNb2RlID09ICdvcGVuLXJlbW90ZS1tb2RhbCcpIHtcclxuICAgICAgICAgICAgaWYgKCF0aGlzLmlzVGV4dEZyb21EaWFsb2cpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuaXRlbS52YWx1ZS5pc0lucHV0VGV4dCA9IHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHRoaXMuaXRlbS52YWx1ZS50ZXh0VmFsdWUgIT0gdGhpcy50ZXh0Rm9ybURpYWxvZykge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5pc1RleHRGcm9tRGlhbG9nID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB0aGlzLml0ZW0udmFsdWUudmFsdWUgPSBbXTtcclxuICAgICAgICAgICAgICAgIHRoaXMuaXRlbS52YWx1ZS50ZXh0RmllbGQgPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgICAgICAgICB0aGlzLml0ZW0udmFsdWUuaXNJbnB1dFRleHQgPSB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuc2VhcmNoSGFuZGxlLmVtaXQoKTtcclxuICAgIH1cclxuXHJcbiAgICBvbkNsZWFyKCkge1xyXG4gICAgICAgICh0aGlzLml0ZW0udmFsdWUgYXMgSW5wdXRHcm91cFZhbHVlKS5jbGVhclZhbHVlKCk7XHJcbiAgICAgICAgdGhpcy5zZWFyY2hIYW5kbGUuZW1pdCgpO1xyXG4gICAgfVxyXG59Il19
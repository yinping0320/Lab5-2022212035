/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input, ViewChild, EventEmitter, Output, HostBinding } from '@angular/core';
import { SolutionService } from '../../service/solution.service';
import { InputGroupComponent } from '@farris/ui-input-group';
var FilterInputGroupComponent = /** @class */ (function () {
    function FilterInputGroupComponent(solutionService) {
        this.solutionService = solutionService;
        /**
         * 判断是否是在扩展区域展示
         */
        this.extend = false;
        /**
         * 判断是否显示label
         */
        this.showlabel = true;
        this.searchHandle = new EventEmitter();
        this.isTextFromDialog = false;
    }
    Object.defineProperty(FilterInputGroupComponent.prototype, "item", {
        get: /**
         * @return {?}
         */
        function () {
            return this.constructTextItem(this._inputItem);
        },
        set: /**
         * @param {?} textItem
         * @return {?}
         */
        function (textItem) {
            this._inputItem = textItem;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(FilterInputGroupComponent.prototype, "isExtend", {
        get: /**
         * @return {?}
         */
        function () {
            return !this.extend && this.autoLabel;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(FilterInputGroupComponent.prototype, "hidenLabel", {
        get: /**
         * @return {?}
         */
        function () {
            return !this.showlabel;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @param {?} textItem
     * @return {?}
     */
    FilterInputGroupComponent.prototype.constructTextItem = /**
     * @param {?} textItem
     * @return {?}
     */
    function (textItem) {
        /** @type {?} */
        var textValueObj = (/** @type {?} */ (textItem.value));
        textValueObj.textValue = textValueObj.textValue && textValueObj.textValue.trim();
        textItem.value = textValueObj;
        return textItem;
    };
    /**
     * @return {?}
     */
    FilterInputGroupComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        this.testId = this.solutionService.getGuid();
        this.getInputGroupBindingInfo();
        if (this.item && this.item.control && this.item.control.hasOwnProperty('isExtend')) {
            this.extend = this.item.control.isExtend;
            if (!this.extend) {
                this.showlabel = this.item.control.showLabel;
            }
        }
        this.solutionService.addFilterEditorInstance(this.item.fieldCode, this);
    };
    /**
     * @return {?}
     */
    FilterInputGroupComponent.prototype.getInputGroupBindingInfo = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var inputGroupControl = ((/** @type {?} */ (this.item.control)));
        this.usageMode = inputGroupControl.usageMode;
        if (this.usageMode == 'open-modal' || this.usageMode == 'open-remote-modal') {
            this.dialogOptions = inputGroupControl.dialogOptions;
            /*
                example of dialogOptions = {
                   modalId: "1e011720-eb0f-4c9c-82b6-6844c89b2303"
                   mapFields: {hDepartment: "Name"}
                   title: "测试标题栏"
                   width: 800
                   height: 600
                }
             */
            if (this.dialogOptions.mapFields) {
                this.textField = JSON.stringify(this.dialogOptions.mapFields).split('"')[1];
            }
        }
    };
    /**
     * @param {?} field
     * @return {?}
     */
    FilterInputGroupComponent.prototype.getConditionItemTitle = /**
     * @param {?} field
     * @return {?}
     */
    function (field) {
        return this.solutionService.getConditionItemTitle(field);
    };
    /*
        dialogOptions = {
            modalId: "ae011720-eb0f-4c9c-82b6-6844c89b2303"
            mapFields: {hDepartment: "Name"}
            title: "测试标题栏"
            width: 800
            height: 600
            showButtons: true
            buttons: [
                { text: "确定", cls: "btn-primary", handle: _this.viewModel.rootviewmodelconfirm1 },
                { text: "取消", cls: "btn-secondary", handle: _this.viewModel.rootviewmodelcancel1}
            ]
        }
    */
    /*
            dialogOptions = {
                modalId: "ae011720-eb0f-4c9c-82b6-6844c89b2303"
                mapFields: {hDepartment: "Name"}
                title: "测试标题栏"
                width: 800
                height: 600
                showButtons: true
                buttons: [
                    { text: "确定", cls: "btn-primary", handle: _this.viewModel.rootviewmodelconfirm1 },
                    { text: "取消", cls: "btn-secondary", handle: _this.viewModel.rootviewmodelcancel1}
                ]
            }
        */
    /**
     * @param {?} event
     * @return {?}
     */
    FilterInputGroupComponent.prototype.onClick = /*
            dialogOptions = {
                modalId: "ae011720-eb0f-4c9c-82b6-6844c89b2303"
                mapFields: {hDepartment: "Name"}
                title: "测试标题栏"
                width: 800
                height: 600
                showButtons: true
                buttons: [
                    { text: "确定", cls: "btn-primary", handle: _this.viewModel.rootviewmodelconfirm1 },
                    { text: "取消", cls: "btn-secondary", handle: _this.viewModel.rootviewmodelcancel1}
                ]
            }
        */
    /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        var _this = this;
        if (this.usageMode == 'text') {
            this.item.control.click();
        }
        else {
            /** @type {?} */
            var options = this.dialogOptions;
            options.handle = (/**
             * @param {?} selectedItem
             * @return {?}
             */
            function (selectedItem) {
                // let modalData = item[0];
                // this.item.value.value = modalData[this.targetField];
                /** @type {?} */
                var selectedItems = selectedItem.filter((/**
                 * @param {?} n
                 * @return {?}
                 */
                function (n) { return n; }));
                if (selectedItems && _this.textField) {
                    _this.item.value.value = selectedItems;
                    _this.item.value.textValue = _this.item.value.getTextValue(_this.textField);
                    _this.item.value.textField = _this.textField;
                    _this.item.value.isInputText = false;
                    if (_this.inputgroup) {
                        _this.inputgroup.cd.detectChanges();
                        _this.inputgroup.value = _this.item.value.textValue;
                    }
                    _this.isTextFromDialog = true;
                    _this.textFormDialog = _this.item.value.textValue;
                    _this.onBlur();
                }
            });
            this.item.control.click({ event: event, options: options });
        }
    };
    /**
     * @return {?}
     */
    FilterInputGroupComponent.prototype.onBlur = /**
     * @return {?}
     */
    function () {
        if (this.disabled) {
            return;
        }
        if (this.usageMode == 'text') {
            this.item.value.isInputText = true;
        }
        if (this.usageMode == 'open-modal' || this.usageMode == 'open-remote-modal') {
            if (!this.isTextFromDialog) {
                this.item.value.isInputText = true;
            }
            if (this.item.value.textValue != this.textFormDialog) {
                this.isTextFromDialog = false;
                this.item.value.value = [];
                this.item.value.textField = undefined;
                this.item.value.isInputText = true;
            }
        }
        this.searchHandle.emit();
    };
    /**
     * @return {?}
     */
    FilterInputGroupComponent.prototype.onClear = /**
     * @return {?}
     */
    function () {
        ((/** @type {?} */ (this.item.value))).clearValue();
        this.searchHandle.emit();
    };
    FilterInputGroupComponent.decorators = [
        { type: Component, args: [{
                    selector: 'app-filter-inputgroup',
                    template: "<label class=\"col-form-label\" *ngIf=\"item && showlabel\" title=\"{{getConditionItemTitle(item)}}\">\r\n    <span class=\"farris-label-info text-danger\" *ngIf=\"item.control.required\">*</span>\r\n    <span class=\"farris-label-text\">{{item.fieldName}}</span>\r\n</label>\r\n<div class=\"farris-input-wrap\" *ngIf=\"item\">\r\n    <input-group #inputgroup\r\n        [(ngModel)]=\"item.value.textValue\" \r\n        name=\"{{item.fieldName}}\" \r\n        id=\"{{testId}}\"\r\n        [readonly]=\"disabled\"\r\n        [groupText]=\"item.control.groupText\"\r\n        [editable]=\"item.control.editable\"\r\n        [placeholder]=\"item.placeHolder\"\r\n        (clickHandle)=\"onClick($event)\"\r\n        (blurHandle)=\"onBlur()\"\r\n        (clear)=\"onClear()\"\r\n        >\r\n    </input-group>\r\n</div>\r\n"
                }] }
    ];
    /** @nocollapse */
    FilterInputGroupComponent.ctorParameters = function () { return [
        { type: SolutionService }
    ]; };
    FilterInputGroupComponent.propDecorators = {
        item: [{ type: Input }],
        autoLabel: [{ type: Input }],
        disabled: [{ type: Input }],
        isExtend: [{ type: HostBinding, args: ['class.filter-item-wrap',] }],
        hidenLabel: [{ type: HostBinding, args: ['class.filter-item-hiddenlabel',] }],
        searchHandle: [{ type: Output, args: ['searchHandle',] }],
        inputgroup: [{ type: ViewChild, args: ['inputgroup',] }]
    };
    return FilterInputGroupComponent;
}());
export { FilterInputGroupComponent };
if (false) {
    /**
     * QueryCondition类型
     * @type {?}
     */
    FilterInputGroupComponent.prototype._inputItem;
    /** @type {?} */
    FilterInputGroupComponent.prototype.testId;
    /** @type {?} */
    FilterInputGroupComponent.prototype.usageMode;
    /** @type {?} */
    FilterInputGroupComponent.prototype.dialogOptions;
    /** @type {?} */
    FilterInputGroupComponent.prototype.autoLabel;
    /** @type {?} */
    FilterInputGroupComponent.prototype.disabled;
    /**
     * 判断是否是在扩展区域展示
     * @type {?}
     */
    FilterInputGroupComponent.prototype.extend;
    /**
     * 判断是否显示label
     * @type {?}
     */
    FilterInputGroupComponent.prototype.showlabel;
    /** @type {?} */
    FilterInputGroupComponent.prototype.searchHandle;
    /** @type {?} */
    FilterInputGroupComponent.prototype.inputgroup;
    /** @type {?} */
    FilterInputGroupComponent.prototype.textField;
    /** @type {?} */
    FilterInputGroupComponent.prototype.isTextFromDialog;
    /** @type {?} */
    FilterInputGroupComponent.prototype.textFormDialog;
    /**
     * @type {?}
     * @private
     */
    FilterInputGroupComponent.prototype.solutionService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5wdXRncm91cC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL3VpLWxpc3QtZmlsdGVyLyIsInNvdXJjZXMiOlsibGliL2NvbnRyb2xjb21wb25lbnQvaW5wdXRncm91cGNvbXBvbmVudC9pbnB1dGdyb3VwLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFFLFNBQVMsRUFBRSxLQUFLLEVBQVUsU0FBUyxFQUFFLFlBQVksRUFBRSxNQUFNLEVBQUUsV0FBVyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBRXZHLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxnQ0FBZ0MsQ0FBQztBQUdqRSxPQUFPLEVBQUUsbUJBQW1CLEVBQUUsTUFBTSx3QkFBd0IsQ0FBQztBQUc3RDtJQXdESSxtQ0FBb0IsZUFBZ0M7UUFBaEMsb0JBQWUsR0FBZixlQUFlLENBQWlCOzs7O1FBNUJwRCxXQUFNLEdBQVksS0FBSyxDQUFDOzs7O1FBRXhCLGNBQVMsR0FBWSxJQUFJLENBQUM7UUFXRixpQkFBWSxHQUFHLElBQUksWUFBWSxFQUFFLENBQUM7UUFLMUQscUJBQWdCLEdBQUcsS0FBSyxDQUFDO0lBVStCLENBQUM7SUF2Q3pELHNCQUNJLDJDQUFJOzs7O1FBR1I7WUFDSSxPQUFPLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUM7UUFDbkQsQ0FBQzs7Ozs7UUFORCxVQUNTLFFBQWE7WUFDbEIsSUFBSSxDQUFDLFVBQVUsR0FBRyxRQUFRLENBQUM7UUFDL0IsQ0FBQzs7O09BQUE7SUFZRCxzQkFDSSwrQ0FBUTs7OztRQURaO1lBRUksT0FBTyxDQUFDLElBQUksQ0FBQyxNQUFNLElBQUksSUFBSSxDQUFDLFNBQVMsQ0FBQztRQUMxQyxDQUFDOzs7T0FBQTtJQUNELHNCQUNJLGlEQUFVOzs7O1FBRGQ7WUFFSSxPQUFPLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQztRQUMzQixDQUFDOzs7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QiwyQ0FBd0I7Ozs7O0lBRXhCLDhDQUEwQjs7SUFXMUIsaURBQTBEOztJQUUxRCwrQ0FBeUQ7O0lBRXpELDhDQUFrQjs7SUFDbEIscURBQXlCOztJQUN6QixtREFBdUI7Ozs7O0lBU1gsb0RBQXdDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBJbnB1dCwgT25Jbml0LCBWaWV3Q2hpbGQsIEV2ZW50RW1pdHRlciwgT3V0cHV0LCBIb3N0QmluZGluZyB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBRdWVyeUNvbmRpdGlvbiB9IGZyb20gJy4uLy4uL2VudGl0eS9xdWVyeWNvbmRpdGlvbic7XHJcbmltcG9ydCB7IFNvbHV0aW9uU2VydmljZSB9IGZyb20gJy4uLy4uL3NlcnZpY2Uvc29sdXRpb24uc2VydmljZSc7XHJcbmltcG9ydCB7IElucHV0R3JvdXBDb250cm9sIH0gZnJvbSAnLi4vLi4vZW50aXR5L2NvbnRyb2x0eXBlL2lucHV0LWdyb3VwL2lucHV0Z3JvdXBjb250cm9sJztcclxuaW1wb3J0IHsgSW5wdXRHcm91cFZhbHVlIH0gZnJvbSAnLi4vLi4vZW50aXR5L2NvbmRpdGlvbnZhbHVlL2lucHV0Z3JvdXAnO1xyXG5pbXBvcnQgeyBJbnB1dEdyb3VwQ29tcG9uZW50IH0gZnJvbSAnQGZhcnJpcy91aS1pbnB1dC1ncm91cCc7XHJcblxyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgICBzZWxlY3RvcjogJ2FwcC1maWx0ZXItaW5wdXRncm91cCcsXHJcbiAgICB0ZW1wbGF0ZVVybDogJy4vaW5wdXRncm91cC5jb21wb25lbnQuaHRtbCcsXHJcbn0pXHJcblxyXG5leHBvcnQgY2xhc3MgRmlsdGVySW5wdXRHcm91cENvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCB7XHJcbiAgICAvKipcclxuICAgICAqIFF1ZXJ5Q29uZGl0aW9u57G75Z6LXHJcbiAgICAgKi9cclxuICAgIF9pbnB1dEl0ZW06IFF1ZXJ5Q29uZGl0aW9uO1xyXG5cclxuICAgIHRlc3RJZDogc3RyaW5nO1xyXG5cclxuICAgIHVzYWdlTW9kZTogc3RyaW5nO1xyXG5cclxuICAgIGRpYWxvZ09wdGlvbnM6IGFueTtcclxuXHJcbiAgICBASW5wdXQoKVxyXG4gICAgc2V0IGl0ZW0odGV4dEl0ZW06IGFueSkge1xyXG4gICAgICAgIHRoaXMuX2lucHV0SXRlbSA9IHRleHRJdGVtO1xyXG4gICAgfVxyXG4gICAgZ2V0IGl0ZW0oKTogYW55IHtcclxuICAgICAgICByZXR1cm4gdGhpcy5jb25zdHJ1Y3RUZXh0SXRlbSh0aGlzLl9pbnB1dEl0ZW0pO1xyXG4gICAgfVxyXG4gICAgQElucHV0KCkgYXV0b0xhYmVsOiBib29sZWFuO1xyXG4gICAgQElucHV0KCkgZGlzYWJsZWQ6IGJvb2xlYW47XHJcblxyXG4gICAgLyoq5Yik5pat5piv5ZCm5piv5Zyo5omp5bGV5Yy65Z+f5bGV56S6ICovXHJcbiAgICBleHRlbmQ6IGJvb2xlYW4gPSBmYWxzZTtcclxuICAgIC8qKuWIpOaWreaYr+WQpuaYvuekumxhYmVsICovXHJcbiAgICBzaG93bGFiZWw6IGJvb2xlYW4gPSB0cnVlO1xyXG5cclxuICAgIEBIb3N0QmluZGluZygnY2xhc3MuZmlsdGVyLWl0ZW0td3JhcCcpXHJcbiAgICBnZXQgaXNFeHRlbmQoKTogYm9vbGVhbiB7XHJcbiAgICAgICAgcmV0dXJuICF0aGlzLmV4dGVuZCAmJiB0aGlzLmF1dG9MYWJlbDtcclxuICAgIH1cclxuICAgIEBIb3N0QmluZGluZygnY2xhc3MuZmlsdGVyLWl0ZW0taGlkZGVubGFiZWwnKVxyXG4gICAgZ2V0IGhpZGVuTGFiZWwoKTogYm9vbGVhbiB7XHJcbiAgICAgICAgcmV0dXJuICF0aGlzLnNob3dsYWJlbDtcclxuICAgIH1cclxuXHJcbiAgICBAT3V0cHV0KCdzZWFyY2hIYW5kbGUnKSBzZWFyY2hIYW5kbGUgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcblxyXG4gICAgQFZpZXdDaGlsZCgnaW5wdXRncm91cCcpIGlucHV0Z3JvdXA6IElucHV0R3JvdXBDb21wb25lbnQ7XHJcblxyXG4gICAgdGV4dEZpZWxkOiBzdHJpbmc7XHJcbiAgICBpc1RleHRGcm9tRGlhbG9nID0gZmFsc2U7XHJcbiAgICB0ZXh0Rm9ybURpYWxvZzogc3RyaW5nO1xyXG5cclxuICAgIGNvbnN0cnVjdFRleHRJdGVtKHRleHRJdGVtOiBRdWVyeUNvbmRpdGlvbik6IFF1ZXJ5Q29uZGl0aW9uIHtcclxuICAgICAgICBjb25zdCB0ZXh0VmFsdWVPYmogPSB0ZXh0SXRlbS52YWx1ZSBhcyBJbnB1dEdyb3VwVmFsdWU7XHJcbiAgICAgICAgdGV4dFZhbHVlT2JqLnRleHRWYWx1ZSA9IHRleHRWYWx1ZU9iai50ZXh0VmFsdWUgJiYgdGV4dFZhbHVlT2JqLnRleHRWYWx1ZS50cmltKCk7XHJcbiAgICAgICAgdGV4dEl0ZW0udmFsdWUgPSB0ZXh0VmFsdWVPYmo7XHJcbiAgICAgICAgcmV0dXJuIHRleHRJdGVtO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgc29sdXRpb25TZXJ2aWNlOiBTb2x1dGlvblNlcnZpY2UpIHsgfVxyXG5cclxuICAgIG5nT25Jbml0KCk6IHZvaWQge1xyXG4gICAgICAgIHRoaXMudGVzdElkID0gdGhpcy5zb2x1dGlvblNlcnZpY2UuZ2V0R3VpZCgpO1xyXG4gICAgICAgIHRoaXMuZ2V0SW5wdXRHcm91cEJpbmRpbmdJbmZvKCk7XHJcblxyXG4gICAgICAgIGlmICh0aGlzLml0ZW0gJiYgdGhpcy5pdGVtLmNvbnRyb2wgJiYgdGhpcy5pdGVtLmNvbnRyb2wuaGFzT3duUHJvcGVydHkoJ2lzRXh0ZW5kJykpIHtcclxuICAgICAgICAgICAgdGhpcy5leHRlbmQgPSB0aGlzLml0ZW0uY29udHJvbC5pc0V4dGVuZDtcclxuICAgICAgICAgICAgaWYgKCF0aGlzLmV4dGVuZCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zaG93bGFiZWwgPSB0aGlzLml0ZW0uY29udHJvbC5zaG93TGFiZWw7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5zb2x1dGlvblNlcnZpY2UuYWRkRmlsdGVyRWRpdG9ySW5zdGFuY2UodGhpcy5pdGVtLmZpZWxkQ29kZSwgdGhpcyk7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0SW5wdXRHcm91cEJpbmRpbmdJbmZvKCkge1xyXG4gICAgICAgIGNvbnN0IGlucHV0R3JvdXBDb250cm9sID0gKHRoaXMuaXRlbS5jb250cm9sIGFzIElucHV0R3JvdXBDb250cm9sKTtcclxuICAgICAgICB0aGlzLnVzYWdlTW9kZSA9IGlucHV0R3JvdXBDb250cm9sLnVzYWdlTW9kZTtcclxuICAgICAgICBpZiAodGhpcy51c2FnZU1vZGUgPT0gJ29wZW4tbW9kYWwnIHx8IHRoaXMudXNhZ2VNb2RlID09ICdvcGVuLXJlbW90ZS1tb2RhbCcpIHtcclxuICAgICAgICAgICAgdGhpcy5kaWFsb2dPcHRpb25zID0gaW5wdXRHcm91cENvbnRyb2wuZGlhbG9nT3B0aW9ucztcclxuICAgICAgICAgICAgLypcclxuICAgICAgICAgICAgICAgIGV4YW1wbGUgb2YgZGlhbG9nT3B0aW9ucyA9IHtcclxuICAgICAgICAgICAgICAgICAgIG1vZGFsSWQ6IFwiMWUwMTE3MjAtZWIwZi00YzljLTgyYjYtNjg0NGM4OWIyMzAzXCJcclxuICAgICAgICAgICAgICAgICAgIG1hcEZpZWxkczoge2hEZXBhcnRtZW50OiBcIk5hbWVcIn1cclxuICAgICAgICAgICAgICAgICAgIHRpdGxlOiBcIua1i+ivleagh+mimOagj1wiXHJcbiAgICAgICAgICAgICAgICAgICB3aWR0aDogODAwXHJcbiAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IDYwMFxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgKi9cclxuICAgICAgICAgICAgaWYgKHRoaXMuZGlhbG9nT3B0aW9ucy5tYXBGaWVsZHMpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMudGV4dEZpZWxkID0gSlNPTi5zdHJpbmdpZnkodGhpcy5kaWFsb2dPcHRpb25zLm1hcEZpZWxkcykuc3BsaXQoJ1wiJylbMV07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0Q29uZGl0aW9uSXRlbVRpdGxlKGZpZWxkOiBRdWVyeUNvbmRpdGlvbikge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnNvbHV0aW9uU2VydmljZS5nZXRDb25kaXRpb25JdGVtVGl0bGUoZmllbGQpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qXHJcbiAgICAgICAgZGlhbG9nT3B0aW9ucyA9IHtcclxuICAgICAgICAgICAgbW9kYWxJZDogXCJhZTAxMTcyMC1lYjBmLTRjOWMtODJiNi02ODQ0Yzg5YjIzMDNcIlxyXG4gICAgICAgICAgICBtYXBGaWVsZHM6IHtoRGVwYXJ0bWVudDogXCJOYW1lXCJ9XHJcbiAgICAgICAgICAgIHRpdGxlOiBcIua1i+ivleagh+mimOagj1wiXHJcbiAgICAgICAgICAgIHdpZHRoOiA4MDBcclxuICAgICAgICAgICAgaGVpZ2h0OiA2MDBcclxuICAgICAgICAgICAgc2hvd0J1dHRvbnM6IHRydWVcclxuICAgICAgICAgICAgYnV0dG9uczogW1xyXG4gICAgICAgICAgICAgICAgeyB0ZXh0OiBcIuehruWumlwiLCBjbHM6IFwiYnRuLXByaW1hcnlcIiwgaGFuZGxlOiBfdGhpcy52aWV3TW9kZWwucm9vdHZpZXdtb2RlbGNvbmZpcm0xIH0sXHJcbiAgICAgICAgICAgICAgICB7IHRleHQ6IFwi5Y+W5raIXCIsIGNsczogXCJidG4tc2Vjb25kYXJ5XCIsIGhhbmRsZTogX3RoaXMudmlld01vZGVsLnJvb3R2aWV3bW9kZWxjYW5jZWwxfVxyXG4gICAgICAgICAgICBdXHJcbiAgICAgICAgfVxyXG4gICAgKi9cclxuICAgIG9uQ2xpY2soZXZlbnQ6IGFueSkge1xyXG4gICAgICAgIGlmICh0aGlzLnVzYWdlTW9kZSA9PSAndGV4dCcpIHtcclxuICAgICAgICAgICAgdGhpcy5pdGVtLmNvbnRyb2wuY2xpY2soKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIGNvbnN0IG9wdGlvbnMgPSB0aGlzLmRpYWxvZ09wdGlvbnM7XHJcbiAgICAgICAgICAgIG9wdGlvbnMuaGFuZGxlID0gKHNlbGVjdGVkSXRlbSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgLy8gbGV0IG1vZGFsRGF0YSA9IGl0ZW1bMF07XHJcbiAgICAgICAgICAgICAgICAvLyB0aGlzLml0ZW0udmFsdWUudmFsdWUgPSBtb2RhbERhdGFbdGhpcy50YXJnZXRGaWVsZF07XHJcbiAgICAgICAgICAgICAgICBsZXQgc2VsZWN0ZWRJdGVtcyA9IHNlbGVjdGVkSXRlbS5maWx0ZXIobiA9PiBuKTtcclxuICAgICAgICAgICAgICAgIGlmIChzZWxlY3RlZEl0ZW1zICYmIHRoaXMudGV4dEZpZWxkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pdGVtLnZhbHVlLnZhbHVlID0gc2VsZWN0ZWRJdGVtcztcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLml0ZW0udmFsdWUudGV4dFZhbHVlID0gdGhpcy5pdGVtLnZhbHVlLmdldFRleHRWYWx1ZSh0aGlzLnRleHRGaWVsZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pdGVtLnZhbHVlLnRleHRGaWVsZCA9IHRoaXMudGV4dEZpZWxkO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaXRlbS52YWx1ZS5pc0lucHV0VGV4dCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmlucHV0Z3JvdXApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnB1dGdyb3VwLmNkLmRldGVjdENoYW5nZXMoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnB1dGdyb3VwLnZhbHVlID0gdGhpcy5pdGVtLnZhbHVlLnRleHRWYWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pc1RleHRGcm9tRGlhbG9nID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnRleHRGb3JtRGlhbG9nID0gdGhpcy5pdGVtLnZhbHVlLnRleHRWYWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLm9uQmx1cigpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMuaXRlbS5jb250cm9sLmNsaWNrKHsgZXZlbnQsIG9wdGlvbnMgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIG9uQmx1cigpIHtcclxuICAgICAgICBpZiAodGhpcy5kaXNhYmxlZCkgeyByZXR1cm47IH1cclxuICAgICAgICBpZiAodGhpcy51c2FnZU1vZGUgPT0gJ3RleHQnKSB7XHJcbiAgICAgICAgICAgIHRoaXMuaXRlbS52YWx1ZS5pc0lucHV0VGV4dCA9IHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0aGlzLnVzYWdlTW9kZSA9PSAnb3Blbi1tb2RhbCcgfHwgdGhpcy51c2FnZU1vZGUgPT0gJ29wZW4tcmVtb3RlLW1vZGFsJykge1xyXG4gICAgICAgICAgICBpZiAoIXRoaXMuaXNUZXh0RnJvbURpYWxvZykge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5pdGVtLnZhbHVlLmlzSW5wdXRUZXh0ID0gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAodGhpcy5pdGVtLnZhbHVlLnRleHRWYWx1ZSAhPSB0aGlzLnRleHRGb3JtRGlhbG9nKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmlzVGV4dEZyb21EaWFsb2cgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIHRoaXMuaXRlbS52YWx1ZS52YWx1ZSA9IFtdO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5pdGVtLnZhbHVlLnRleHRGaWVsZCA9IHVuZGVmaW5lZDtcclxuICAgICAgICAgICAgICAgIHRoaXMuaXRlbS52YWx1ZS5pc0lucHV0VGV4dCA9IHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5zZWFyY2hIYW5kbGUuZW1pdCgpO1xyXG4gICAgfVxyXG5cclxuICAgIG9uQ2xlYXIoKSB7XHJcbiAgICAgICAgKHRoaXMuaXRlbS52YWx1ZSBhcyBJbnB1dEdyb3VwVmFsdWUpLmNsZWFyVmFsdWUoKTtcclxuICAgICAgICB0aGlzLnNlYXJjaEhhbmRsZS5lbWl0KCk7XHJcbiAgICB9XHJcbn0iXX0=
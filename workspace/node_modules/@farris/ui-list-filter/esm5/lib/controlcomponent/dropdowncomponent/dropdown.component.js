/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input, HostBinding, EventEmitter, Output } from '@angular/core';
import { ControlType } from '../../entity/controltype';
import { EnumType } from '../../entity/controltype/dropdownlist/enumtype';
import { EnumIntegerValue } from '../../entity/controltype/dropdownlist/integerenumvalue';
import { EnumStringValue } from '../../entity/controltype/dropdownlist/stringenumvalue';
import { EnumBoolValue } from '../../entity/controltype/dropdownlist/boolenumvalue';
import { SolutionService } from '../../service/solution.service';
var DropDownComponent = /** @class */ (function () {
    function DropDownComponent(solutionService) {
        this.solutionService = solutionService;
        this.enableClear = true;
        this.searchHandle = new EventEmitter();
        this.dropDownListDataSource = new Array();
        /**
         * 判断是否是在扩展区域展示
         */
        this.extend = false;
        /**
         * 判断是否显示label
         */
        this.showlabel = true;
        /**
         * 某个字段发生值变化事件时，需要同步清空的字段，可能不是当前字段
         */
        this.changeFields = [];
    }
    Object.defineProperty(DropDownComponent.prototype, "isExtend", {
        get: /**
         * @return {?}
         */
        function () {
            return !this.extend && this.autoLabel;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(DropDownComponent.prototype, "hidenLabel", {
        get: /**
         * @return {?}
         */
        function () {
            return !this.showlabel;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    DropDownComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        // this.getDataSource();
        // const initialValue = this.item.value as DropDownListValue;
        // initialValue.value && (this.selectedItemId = initialValue.value.getEnumValue());
        if (this.item) {
            /** @type {?} */
            var type = Object.prototype.toString.call(this.item.placeHolder);
            if (type == '[object Undefined]') {
                if (this.item.control && this.item.control.hasOwnProperty('placeholder')) {
                    this.placeholder = this.item.control.placeholder;
                }
            }
            else {
                this.placeholder = this.item.placeHolder;
            }
        }
        this.getDataSource();
        /** @type {?} */
        var initialValue = (/** @type {?} */ (this.item.value));
        initialValue.value && (this.selectedItemId = initialValue.value);
        if (this.item && this.item.control) {
            if (this.item.control.hasOwnProperty('isExtend')) {
                this.extend = this.item.control.isExtend;
                if (!this.extend) {
                    this.showlabel = this.item.control.showLabel;
                }
            }
        }
        this.solutionService.addFilterEditorInstance(this.item.fieldCode, this);
        ((/** @type {?} */ (this.item.value))).clear$.subscribe((/**
         * @return {?}
         */
        function () {
            _this.selectedItemId = '';
        }));
        // this.testId = this.solutionService.getGuid();
    };
    /**
     * @param {?} changes
     * @return {?}
     */
    DropDownComponent.prototype.ngOnChanges = /**
     * @param {?} changes
     * @return {?}
     */
    function (changes) {
        var _this = this;
        this.getDataSource();
        if (changes['changeFields'] && changes['changeFields'].currentValue && !changes['changeFields'].firstChange) {
            /** @type {?} */
            var isChange = changes['changeFields'].currentValue.some((/**
             * @param {?} field
             * @return {?}
             */
            function (field) { return field == _this.item.fieldCode; }));
            if (isChange) {
                this.selectedItemId = ((/** @type {?} */ (this.item.value))).value;
            }
        }
        //console.log(this.dropDownListDataSource);
    };
    /**
     * @return {?}
     */
    DropDownComponent.prototype.getDataSource = /**
     * @return {?}
     */
    function () {
        var _this = this;
        if (this.item && this.item.value
            && this.item.control && this.item.control.getControlType() == ControlType.DropDown) {
            /** @type {?} */
            var dropDownList = ((/** @type {?} */ (this.item.control)));
            if (dropDownList.valueType == EnumType.BoolType) {
                this.dropDownListDataSource = Array();
                if (dropDownList.enumValues && dropDownList.enumValues.length > 0) {
                    dropDownList.enumValues.forEach((/**
                     * @param {?} element
                     * @return {?}
                     */
                    function (element) {
                        _this.dropDownListDataSource.push(Object.assign(new EnumBoolValue(), element));
                    }));
                }
            }
            else if (dropDownList.valueType == EnumType.IntType) {
                this.dropDownListDataSource = Array();
                if (dropDownList.enumValues && dropDownList.enumValues.length > 0) {
                    dropDownList.enumValues.forEach((/**
                     * @param {?} element
                     * @return {?}
                     */
                    function (element) {
                        _this.dropDownListDataSource.push(Object.assign(new EnumIntegerValue(), element));
                    }));
                }
            }
            else if (dropDownList.valueType == EnumType.StringType) {
                this.dropDownListDataSource = Array();
                if (dropDownList.enumValues && dropDownList.enumValues.length > 0) {
                    dropDownList.enumValues.forEach((/**
                     * @param {?} element
                     * @return {?}
                     */
                    function (element) {
                        _this.dropDownListDataSource.push(Object.assign(new EnumStringValue(), element));
                    }));
                }
            }
        }
    };
    // getConditionItemStyle(field: QueryCondition, controlType: any) {
    //     return this.solutionService.getConditionItemStyle(field,controlType);
    // }
    // getConditionItemStyle(field: QueryCondition, controlType: any) {
    //     return this.solutionService.getConditionItemStyle(field,controlType);
    // }
    /**
     * @param {?} field
     * @return {?}
     */
    DropDownComponent.prototype.getConditionItemTitle = 
    // getConditionItemStyle(field: QueryCondition, controlType: any) {
    //     return this.solutionService.getConditionItemStyle(field,controlType);
    // }
    /**
     * @param {?} field
     * @return {?}
     */
    function (field) {
        return this.solutionService.getConditionItemTitle(field);
    };
    /**
     * @param {?} event
     * @return {?}
     */
    DropDownComponent.prototype.onSearch = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        if (event) {
            ((/** @type {?} */ (this.item.value))).value = event.data.value;
        }
        else {
            ((/** @type {?} */ (this.item.value))).value = '';
        }
        if (this.disabled) {
            return;
        }
        this.searchHandle.emit();
    };
    /**
     * @param {?} event
     * @return {?}
     */
    DropDownComponent.prototype.onClear = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        ((/** @type {?} */ (this.item.value))).value = '';
        this.searchHandle.emit();
    };
    DropDownComponent.decorators = [
        { type: Component, args: [{
                    selector: 'app-filter-dropdown',
                    template: "<label class=\"col-form-label\" *ngIf=\"item && showlabel\" title=\"{{getConditionItemTitle(item)}}\">\r\n    <span class=\"farris-label-info text-danger\" *ngIf=\"item.control.required\">*</span>\r\n    <span class=\"farris-label-text\">{{item.fieldName}}</span>\r\n</label>\r\n<div class=\"farris-input-wrap\" *ngIf=\"item\">\r\n    <farris-combo-list\r\n        [idField]=\"'value'\"\r\n        [textField]=\"'name'\"\r\n        [data]=\"dropDownListDataSource\"\r\n        [(ngModel)]=\"selectedItemId\"\r\n        [readonly]=\"disabled\"\r\n        [editable]=\"false\"\r\n        (selectChange)=\"onSearch($event)\"\r\n        (clear)=\"onClear($event)\"\r\n        [placeholder]=\"placeholder\"\r\n        [enableClear]=\"enableClear\"\r\n    ></farris-combo-list>\r\n\r\n</div>\r\n\r\n<!-- (valueChange)=\"onSearch($event)\" -->"
                }] }
    ];
    /** @nocollapse */
    DropDownComponent.ctorParameters = function () { return [
        { type: SolutionService }
    ]; };
    DropDownComponent.propDecorators = {
        item: [{ type: Input }],
        autoLabel: [{ type: Input }],
        disabled: [{ type: Input }],
        enableClear: [{ type: Input }],
        searchHandle: [{ type: Output, args: ['searchHandle',] }],
        isExtend: [{ type: HostBinding, args: ['class.filter-item-wrap',] }],
        hidenLabel: [{ type: HostBinding, args: ['class.filter-item-hiddenlabel',] }],
        changeFields: [{ type: Input }]
    };
    return DropDownComponent;
}());
export { DropDownComponent };
if (false) {
    /**
     * QueryCondition类型
     * @type {?}
     */
    DropDownComponent.prototype.item;
    /** @type {?} */
    DropDownComponent.prototype.autoLabel;
    /** @type {?} */
    DropDownComponent.prototype.disabled;
    /** @type {?} */
    DropDownComponent.prototype.enableClear;
    /** @type {?} */
    DropDownComponent.prototype.searchHandle;
    /** @type {?} */
    DropDownComponent.prototype.dropDownListDataSource;
    /**
     * 判断是否是在扩展区域展示
     * @type {?}
     */
    DropDownComponent.prototype.extend;
    /**
     * 判断是否显示label
     * @type {?}
     */
    DropDownComponent.prototype.showlabel;
    /** @type {?} */
    DropDownComponent.prototype.selectedItemId;
    /** @type {?} */
    DropDownComponent.prototype.placeholder;
    /**
     * 某个字段发生值变化事件时，需要同步清空的字段，可能不是当前字段
     * @type {?}
     */
    DropDownComponent.prototype.changeFields;
    /**
     * @type {?}
     * @private
     */
    DropDownComponent.prototype.solutionService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZHJvcGRvd24uY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy91aS1saXN0LWZpbHRlci8iLCJzb3VyY2VzIjpbImxpYi9jb250cm9sY29tcG9uZW50L2Ryb3Bkb3duY29tcG9uZW50L2Ryb3Bkb3duLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFFLFNBQVMsRUFBRSxLQUFLLEVBQXFCLFdBQVcsRUFBRSxZQUFZLEVBQUUsTUFBTSxFQUFpQixNQUFNLGVBQWUsQ0FBQztBQUV0SCxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sMEJBQTBCLENBQUM7QUFFdkQsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLGdEQUFnRCxDQUFDO0FBQzFFLE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLHdEQUF3RCxDQUFDO0FBQzFGLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSx1REFBdUQsQ0FBQztBQUN4RixPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0scURBQXFELENBQUM7QUFDcEYsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLGdDQUFnQyxDQUFDO0FBR2pFO0lBc0NJLDJCQUFvQixlQUFnQztRQUFoQyxvQkFBZSxHQUFmLGVBQWUsQ0FBaUI7UUF6QjNDLGdCQUFXLEdBQUcsSUFBSSxDQUFDO1FBQ0osaUJBQVksR0FBRyxJQUFJLFlBQVksRUFBRSxDQUFDO1FBRTFELDJCQUFzQixHQUFlLElBQUksS0FBSyxFQUFPLENBQUM7Ozs7UUFFdEQsV0FBTSxHQUFZLEtBQUssQ0FBQzs7OztRQUV4QixjQUFTLEdBQVksSUFBSSxDQUFDOzs7O1FBaUJqQixpQkFBWSxHQUFrQixFQUFFLENBQUM7SUFDYyxDQUFDO0lBWnpELHNCQUNJLHVDQUFROzs7O1FBRFo7WUFFSSxPQUFPLENBQUMsSUFBSSxDQUFDLE1BQU0sSUFBSSxJQUFJLENBQUMsU0FBUyxDQUFDO1FBQzFDLENBQUM7OztPQUFBO0lBQ0Qsc0JBQ0kseUNB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QUMsS0FBSyxFQUFxQixDQUFDLENBQUMsS0FBSyxHQUFHLEVBQUUsQ0FBQztRQUNsRCxJQUFJLENBQUMsWUFBWSxDQUFDLElBQUksRUFBRSxDQUFDO0lBQzdCLENBQUM7O2dCQTVJSixTQUFTLFNBQUM7b0JBQ1AsUUFBUSxFQUFFLHFCQUFxQjtvQkFDL0IsZzFCQUF3QztpQkFDM0M7Ozs7Z0JBTlEsZUFBZTs7O3VCQWFuQixLQUFLOzRCQUNMLEtBQUs7MkJBQ0wsS0FBSzs4QkFDTCxLQUFLOytCQUNMLE1BQU0sU0FBQyxjQUFjOzJCQVlyQixXQUFXLFNBQUMsd0JBQXdCOzZCQUlwQyxXQUFXLFNBQUMsK0JBQStCOytCQU8zQyxLQUFLOztJQXdHVix3QkFBQztDQUFBLEFBN0lELElBNklDO1NBeElZLGlCQUFpQjs7Ozs7O0lBSzFCLGlDQUFtQjs7SUFDbkIsc0NBQTRCOztJQUM1QixxQ0FBMkI7O0lBQzNCLHdDQUE0Qjs7SUFDNUIseUNBQTBEOztJQUUxRCxtREFBc0Q7Ozs7O0lBRXRELG1DQUF3Qjs7Ozs7SUFFeEIsc0NBQTBCOztJQUUxQiwyQ0FBb0I7O0lBQ3BCLHdDQUFvQjs7Ozs7SUFjcEIseUNBQTBDOzs7OztJQUM5Qiw0Q0FBd0MiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIElucHV0LCBPbkluaXQsIE9uQ2hhbmdlcywgSG9zdEJpbmRpbmcsIEV2ZW50RW1pdHRlciwgT3V0cHV0LCBTaW1wbGVDaGFuZ2VzIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IFF1ZXJ5Q29uZGl0aW9uIH0gZnJvbSAnLi4vLi4vZW50aXR5L3F1ZXJ5Y29uZGl0aW9uJztcclxuaW1wb3J0IHsgQ29udHJvbFR5cGUgfSBmcm9tICcuLi8uLi9lbnRpdHkvY29udHJvbHR5cGUnO1xyXG5pbXBvcnQgeyBEcm9wRG93bkNvbnRyb2wgfSBmcm9tICcuLi8uLi9lbnRpdHkvY29udHJvbHR5cGUvZHJvcGRvd25saXN0L2Ryb3Bkb3duY29udHJvbCc7XHJcbmltcG9ydCB7IEVudW1UeXBlIH0gZnJvbSAnLi4vLi4vZW50aXR5L2NvbnRyb2x0eXBlL2Ryb3Bkb3dubGlzdC9lbnVtdHlwZSc7XHJcbmltcG9ydCB7IEVudW1JbnRlZ2VyVmFsdWUgfSBmcm9tICcuLi8uLi9lbnRpdHkvY29udHJvbHR5cGUvZHJvcGRvd25saXN0L2ludGVnZXJlbnVtdmFsdWUnO1xyXG5pbXBvcnQgeyBFbnVtU3RyaW5nVmFsdWUgfSBmcm9tICcuLi8uLi9lbnRpdHkvY29udHJvbHR5cGUvZHJvcGRvd25saXN0L3N0cmluZ2VudW12YWx1ZSc7XHJcbmltcG9ydCB7IEVudW1Cb29sVmFsdWUgfSBmcm9tICcuLi8uLi9lbnRpdHkvY29udHJvbHR5cGUvZHJvcGRvd25saXN0L2Jvb2xlbnVtdmFsdWUnO1xyXG5pbXBvcnQgeyBTb2x1dGlvblNlcnZpY2UgfSBmcm9tICcuLi8uLi9zZXJ2aWNlL3NvbHV0aW9uLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBEcm9wRG93bkxpc3RWYWx1ZSB9IGZyb20gJy4uLy4uL2VudGl0eS9jb25kaXRpb252YWx1ZS9kcm9wZG93bmxpc3R2YWx1ZSc7XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICAgIHNlbGVjdG9yOiAnYXBwLWZpbHRlci1kcm9wZG93bicsXHJcbiAgICB0ZW1wbGF0ZVVybDogJy4vZHJvcGRvd24uY29tcG9uZW50Lmh0bWwnXHJcbn0pXHJcblxyXG5leHBvcnQgY2xhc3MgRHJvcERvd25Db21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIE9uQ2hhbmdlcyB7XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBRdWVyeUNvbmRpdGlvbuexu+Wei1xyXG4gICAgICovXHJcbiAgICBASW5wdXQoKSBpdGVtOiBhbnk7XHJcbiAgICBASW5wdXQoKSBhdXRvTGFiZWw6IGJvb2xlYW47XHJcbiAgICBASW5wdXQoKSBkaXNhYmxlZDogYm9vbGVhbjtcclxuICAgIEBJbnB1dCgpIGVuYWJsZUNsZWFyID0gdHJ1ZTtcclxuICAgIEBPdXRwdXQoJ3NlYXJjaEhhbmRsZScpIHNlYXJjaEhhbmRsZSA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuXHJcbiAgICBkcm9wRG93bkxpc3REYXRhU291cmNlOiBBcnJheTxhbnk+ID0gbmV3IEFycmF5PGFueT4oKTtcclxuICAgIC8qKuWIpOaWreaYr+WQpuaYr+WcqOaJqeWxleWMuuWfn+WxleekuiAqL1xyXG4gICAgZXh0ZW5kOiBib29sZWFuID0gZmFsc2U7XHJcbiAgICAvKirliKTmlq3mmK/lkKbmmL7npLpsYWJlbCAqL1xyXG4gICAgc2hvd2xhYmVsOiBib29sZWFuID0gdHJ1ZTtcclxuXHJcbiAgICBzZWxlY3RlZEl0ZW1JZDogYW55O1xyXG4gICAgcGxhY2Vob2xkZXI6IHN0cmluZztcclxuXHJcblxyXG4gICAgQEhvc3RCaW5kaW5nKCdjbGFzcy5maWx0ZXItaXRlbS13cmFwJylcclxuICAgIGdldCBpc0V4dGVuZCgpOiBib29sZWFuIHtcclxuICAgICAgICByZXR1cm4gIXRoaXMuZXh0ZW5kICYmIHRoaXMuYXV0b0xhYmVsO1xyXG4gICAgfVxyXG4gICAgQEhvc3RCaW5kaW5nKCdjbGFzcy5maWx0ZXItaXRlbS1oaWRkZW5sYWJlbCcpXHJcbiAgICBnZXQgaGlkZW5MYWJlbCgpOiBib29sZWFuIHtcclxuICAgICAgICByZXR1cm4gIXRoaXMuc2hvd2xhYmVsO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAqIOafkOS4quWtl+auteWPkeeUn+WAvOWPmOWMluS6i+S7tuaXtu+8jOmcgOimgeWQjOatpea4heepuueahOWtl+aute+8jOWPr+iDveS4jeaYr+W9k+WJjeWtl+autVxyXG4gICAgKi9cclxuICAgIEBJbnB1dCgpIGNoYW5nZUZpZWxkczogQXJyYXk8c3RyaW5nPiA9IFtdO1xyXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBzb2x1dGlvblNlcnZpY2U6IFNvbHV0aW9uU2VydmljZSkgeyB9XHJcblxyXG4gICAgbmdPbkluaXQoKTogdm9pZCB7XHJcbiAgICAgICAgLy8gdGhpcy5nZXREYXRhU291cmNlKCk7XHJcbiAgICAgICAgLy8gY29uc3QgaW5pdGlhbFZhbHVlID0gdGhpcy5pdGVtLnZhbHVlIGFzIERyb3BEb3duTGlzdFZhbHVlO1xyXG4gICAgICAgIC8vIGluaXRpYWxWYWx1ZS52YWx1ZSAmJiAodGhpcy5zZWxlY3RlZEl0ZW1JZCA9IGluaXRpYWxWYWx1ZS52YWx1ZS5nZXRFbnVtVmFsdWUoKSk7XHJcbiAgICAgICAgaWYgKHRoaXMuaXRlbSkge1xyXG4gICAgICAgICAgICBjb25zdCB0eXBlID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHRoaXMuaXRlbS5wbGFjZUhvbGRlcik7XHJcbiAgICAgICAgICAgIGlmICh0eXBlID09ICdbb2JqZWN0IFVuZGVmaW5lZF0nKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5pdGVtLmNvbnRyb2wgJiYgdGhpcy5pdGVtLmNvbnRyb2wuaGFzT3duUHJvcGVydHkoJ3BsYWNlaG9sZGVyJykpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnBsYWNlaG9sZGVyID0gdGhpcy5pdGVtLmNvbnRyb2wucGxhY2Vob2xkZXI7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnBsYWNlaG9sZGVyID0gdGhpcy5pdGVtLnBsYWNlSG9sZGVyO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuZ2V0RGF0YVNvdXJjZSgpO1xyXG4gICAgICAgIGNvbnN0IGluaXRpYWxWYWx1ZSA9IHRoaXMuaXRlbS52YWx1ZSBhcyBEcm9wRG93bkxpc3RWYWx1ZTtcclxuICAgICAgICBpbml0aWFsVmFsdWUudmFsdWUgJiYgKHRoaXMuc2VsZWN0ZWRJdGVtSWQgPSBpbml0aWFsVmFsdWUudmFsdWUpO1xyXG4gICAgICAgIGlmICh0aGlzLml0ZW0gJiYgdGhpcy5pdGVtLmNvbnRyb2wpIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMuaXRlbS5jb250cm9sLmhhc093blByb3BlcnR5KCdpc0V4dGVuZCcpKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmV4dGVuZCA9IHRoaXMuaXRlbS5jb250cm9sLmlzRXh0ZW5kO1xyXG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLmV4dGVuZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd2xhYmVsID0gdGhpcy5pdGVtLmNvbnRyb2wuc2hvd0xhYmVsO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLnNvbHV0aW9uU2VydmljZS5hZGRGaWx0ZXJFZGl0b3JJbnN0YW5jZSh0aGlzLml0ZW0uZmllbGRDb2RlLCB0aGlzKTtcclxuXHJcblxyXG4gICAgICAgICh0aGlzLml0ZW0udmFsdWUgYXMgRHJvcERvd25MaXN0VmFsdWUpLmNsZWFyJC5zdWJzY3JpYmUoKCkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLnNlbGVjdGVkSXRlbUlkID0gJyc7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgLy8gdGhpcy50ZXN0SWQgPSB0aGlzLnNvbHV0aW9uU2VydmljZS5nZXRHdWlkKCk7XHJcbiAgICB9XHJcblxyXG4gICAgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcyk6IHZvaWQge1xyXG4gICAgICAgIHRoaXMuZ2V0RGF0YVNvdXJjZSgpO1xyXG4gICAgICAgIGlmKGNoYW5nZXNbJ2NoYW5nZUZpZWxkcyddICYmIGNoYW5nZXNbJ2NoYW5nZUZpZWxkcyddLmN1cnJlbnRWYWx1ZSAmJiAhY2hhbmdlc1snY2hhbmdlRmllbGRzJ10uZmlyc3RDaGFuZ2UpIHtcclxuICAgICAgICAgICAgY29uc3QgaXNDaGFuZ2UgPSBjaGFuZ2VzWydjaGFuZ2VGaWVsZHMnXS5jdXJyZW50VmFsdWUuc29tZShmaWVsZCA9PiBmaWVsZCA9PSB0aGlzLml0ZW0uZmllbGRDb2RlKTtcclxuICAgICAgICAgICAgaWYoaXNDaGFuZ2Upe1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZEl0ZW1JZCA9ICh0aGlzLml0ZW0udmFsdWUgYXMgRHJvcERvd25MaXN0VmFsdWUpLnZhbHVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vY29uc29sZS5sb2codGhpcy5kcm9wRG93bkxpc3REYXRhU291cmNlKTtcclxuICAgIH1cclxuXHJcbiAgICBnZXREYXRhU291cmNlKCkge1xyXG4gICAgICAgIGlmICh0aGlzLml0ZW0gJiYgdGhpcy5pdGVtLnZhbHVlXHJcbiAgICAgICAgICAgICYmIHRoaXMuaXRlbS5jb250cm9sICYmIHRoaXMuaXRlbS5jb250cm9sLmdldENvbnRyb2xUeXBlKCkgPT0gQ29udHJvbFR5cGUuRHJvcERvd24pIHtcclxuICAgICAgICAgICAgbGV0IGRyb3BEb3duTGlzdCA9ICh0aGlzLml0ZW0uY29udHJvbCBhcyBEcm9wRG93bkNvbnRyb2wpO1xyXG4gICAgICAgICAgICBpZiAoZHJvcERvd25MaXN0LnZhbHVlVHlwZSA9PSBFbnVtVHlwZS5Cb29sVHlwZSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5kcm9wRG93bkxpc3REYXRhU291cmNlID0gQXJyYXk8RW51bUJvb2xWYWx1ZT4oKTtcclxuICAgICAgICAgICAgICAgIGlmIChkcm9wRG93bkxpc3QuZW51bVZhbHVlcyAmJiBkcm9wRG93bkxpc3QuZW51bVZhbHVlcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZHJvcERvd25MaXN0LmVudW1WYWx1ZXMuZm9yRWFjaChlbGVtZW50ID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kcm9wRG93bkxpc3REYXRhU291cmNlLnB1c2goT2JqZWN0LmFzc2lnbihuZXcgRW51bUJvb2xWYWx1ZSgpLCBlbGVtZW50KSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSBpZiAoZHJvcERvd25MaXN0LnZhbHVlVHlwZSA9PSBFbnVtVHlwZS5JbnRUeXBlKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmRyb3BEb3duTGlzdERhdGFTb3VyY2UgPSBBcnJheTxFbnVtSW50ZWdlclZhbHVlPigpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGRyb3BEb3duTGlzdC5lbnVtVmFsdWVzICYmIGRyb3BEb3duTGlzdC5lbnVtVmFsdWVzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICBkcm9wRG93bkxpc3QuZW51bVZhbHVlcy5mb3JFYWNoKGVsZW1lbnQgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRyb3BEb3duTGlzdERhdGFTb3VyY2UucHVzaChPYmplY3QuYXNzaWduKG5ldyBFbnVtSW50ZWdlclZhbHVlKCksIGVsZW1lbnQpKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIGlmIChkcm9wRG93bkxpc3QudmFsdWVUeXBlID09IEVudW1UeXBlLlN0cmluZ1R5cGUpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZHJvcERvd25MaXN0RGF0YVNvdXJjZSA9IEFycmF5PEVudW1TdHJpbmdWYWx1ZT4oKTtcclxuICAgICAgICAgICAgICAgIGlmIChkcm9wRG93bkxpc3QuZW51bVZhbHVlcyAmJiBkcm9wRG93bkxpc3QuZW51bVZhbHVlcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZHJvcERvd25MaXN0LmVudW1WYWx1ZXMuZm9yRWFjaChlbGVtZW50ID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kcm9wRG93bkxpc3REYXRhU291cmNlLnB1c2goT2JqZWN0LmFzc2lnbihuZXcgRW51bVN0cmluZ1ZhbHVlKCksIGVsZW1lbnQpKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvLyBnZXRDb25kaXRpb25JdGVtU3R5bGUoZmllbGQ6IFF1ZXJ5Q29uZGl0aW9uLCBjb250cm9sVHlwZTogYW55KSB7XHJcbiAgICAvLyAgICAgcmV0dXJuIHRoaXMuc29sdXRpb25TZXJ2aWNlLmdldENvbmRpdGlvbkl0ZW1TdHlsZShmaWVsZCxjb250cm9sVHlwZSk7XHJcbiAgICAvLyB9XHJcblxyXG4gICAgZ2V0Q29uZGl0aW9uSXRlbVRpdGxlKGZpZWxkOiBRdWVyeUNvbmRpdGlvbikge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnNvbHV0aW9uU2VydmljZS5nZXRDb25kaXRpb25JdGVtVGl0bGUoZmllbGQpO1xyXG4gICAgfVxyXG5cclxuICAgIG9uU2VhcmNoKGV2ZW50KSB7XHJcbiAgICAgICAgaWYgKGV2ZW50KSB7XHJcbiAgICAgICAgICAgICh0aGlzLml0ZW0udmFsdWUgYXMgRHJvcERvd25MaXN0VmFsdWUpLnZhbHVlID0gZXZlbnQuZGF0YS52YWx1ZTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAodGhpcy5pdGVtLnZhbHVlIGFzIERyb3BEb3duTGlzdFZhbHVlKS52YWx1ZSA9ICcnO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHRoaXMuZGlzYWJsZWQpIHsgcmV0dXJuOyB9XHJcbiAgICAgICAgdGhpcy5zZWFyY2hIYW5kbGUuZW1pdCgpO1xyXG4gICAgfVxyXG5cclxuICAgIG9uQ2xlYXIoZXZlbnQpIHtcclxuICAgICAgICAodGhpcy5pdGVtLnZhbHVlIGFzIERyb3BEb3duTGlzdFZhbHVlKS52YWx1ZSA9ICcnO1xyXG4gICAgICAgIHRoaXMuc2VhcmNoSGFuZGxlLmVtaXQoKTtcclxuICAgIH1cclxufVxyXG4iXX0=
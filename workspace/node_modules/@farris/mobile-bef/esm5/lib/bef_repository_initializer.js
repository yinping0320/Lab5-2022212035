/**
 * @fileoverview added by tsickle
 * Generated from: lib/bef_repository_initializer.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { MetadataUtil, AppContext, InjectFlags, HttpClient } from '@farris/mobile-devkit';
import { VARIABLE_PROP_META } from './decorators';
import { BefEntityManager } from './bef_entity_manager';
import { BefVariableManager } from './bef_variable_manager';
import { BefSessionHandlingStrategyFactory, BefSessionService } from './session/index';
import { BefDataService } from './bef_data_service';
import { FrameworkSessionService } from './framework_session_service';
import { BE_SESSION_HANDLING_STRATEGY_TOKEN } from './tokens';
import { BefProxyExtend } from './bef_proxy_extend';
/**
 * BefRepository初始化器
 * \@summary
 * 为了抽离这部分路径，强制对外暴露了Repository的相关属性，待优化。
 */
var /**
 * BefRepository初始化器
 * \@summary
 * 为了抽离这部分路径，强制对外暴露了Repository的相关属性，待优化。
 */
BefRepositoryInitializer = /** @class */ (function () {
    /**
     * 构造函数
     */
    function BefRepositoryInitializer(repository) {
        this.repository = repository;
    }
    Object.defineProperty(BefRepositoryInitializer.prototype, "injector", {
        /**
         * 注入器
         */
        get: /**
         * 注入器
         * @private
         * @return {?}
         */
        function () {
            return this.repository.getInjector();
        },
        enumerable: true,
        configurable: true
    });
    /**
     * 初始化
     */
    /**
     * 初始化
     * @return {?}
     */
    BefRepositoryInitializer.prototype.init = /**
     * 初始化
     * @return {?}
     */
    function () {
        this.initAppContext();
        this.initEntityManager();
        this.initVariableManager();
        this.initApiProxy();
        this.initSessionService();
        this.initDataService();
    };
    /**
     * 初始化应用上下文
     */
    /**
     * 初始化应用上下文
     * @private
     * @return {?}
     */
    BefRepositoryInitializer.prototype.initAppContext = /**
     * 初始化应用上下文
     * @private
     * @return {?}
     */
    function () {
        this.repository.appContext = this.injector.get(AppContext);
    };
    /**
     * 初始化EntityManager
     */
    /**
     * 初始化EntityManager
     * @private
     * @return {?}
     */
    BefRepositoryInitializer.prototype.initEntityManager = /**
     * 初始化EntityManager
     * @private
     * @return {?}
     */
    function () {
        this.repository.entityManager = new BefEntityManager(this.repository.entityCollection);
    };
    /**
     * 初始化VariableManager
     */
    /**
     * 初始化VariableManager
     * @private
     * @return {?}
     */
    BefRepositoryInitializer.prototype.initVariableManager = /**
     * 初始化VariableManager
     * @private
     * @return {?}
     */
    function () {
        /** @type {?} */
        var ngVariables = MetadataUtil.getPropsMetadatasByName(this.repository.constructor, VARIABLE_PROP_META);
        this.repository.variableManager = new BefVariableManager(ngVariables);
    };
    /**
     * 初始化Proxy
     */
    /**
     * 初始化Proxy
     * @private
     * @return {?}
     */
    BefRepositoryInitializer.prototype.initApiProxy = /**
     * 初始化Proxy
     * @private
     * @return {?}
     */
    function () {
        this.repository.apiProxy = this.injector.get(this.repository.apiProxyType);
        /** @type {?} */
        var apiProxyExtend = new BefProxyExtend(this.repository);
        this.repository.apiProxy.setProxyExtend(apiProxyExtend);
    };
    /**
     * 初始化SessionService
     */
    /**
     * 初始化SessionService
     * @private
     * @return {?}
     */
    BefRepositoryInitializer.prototype.initSessionService = /**
     * 初始化SessionService
     * @private
     * @return {?}
     */
    function () {
        /** @type {?} */
        var handlingStrategyName = this.injector.get(BE_SESSION_HANDLING_STRATEGY_TOKEN, null, InjectFlags.Optional);
        handlingStrategyName = handlingStrategyName || 'SeparatedSession';
        /** @type {?} */
        var frmSessionService = this.injector.get(FrameworkSessionService);
        /** @type {?} */
        var httpClient = this.injector.get(HttpClient);
        /** @type {?} */
        var baseUrl = "" + this.repository.apiProxy.baseUrl;
        /** @type {?} */
        var sessionHandlingStrategyFactory = new BefSessionHandlingStrategyFactory();
        /** @type {?} */
        var sessionHandlingStrategy = sessionHandlingStrategyFactory.create(handlingStrategyName, frmSessionService, baseUrl, httpClient);
        this.repository.sessionService = new BefSessionService(sessionHandlingStrategy);
    };
    /**
     * 初始化DataService
     */
    /**
     * 初始化DataService
     * @private
     * @return {?}
     */
    BefRepositoryInitializer.prototype.initDataService = /**
     * 初始化DataService
     * @private
     * @return {?}
     */
    function () {
        this.repository.dataService = new BefDataService(this.repository);
    };
    return BefRepositoryInitializer;
}());
if (false) {
    /**
     * BefRepository实例
     * @type {?}
     * @private
     */
    BefRepositoryInitializer.prototype.repository;
}
export { BefRepositoryInitializer };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmVmX3JlcG9zaXRvcnlfaW5pdGlhbGl6ZXIuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL21vYmlsZS1iZWYvIiwic291cmNlcyI6WyJsaWIvYmVmX3JlcG9zaXRvcnlfaW5pdGlhbGl6ZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFDQSxPQUFPLEVBQUUsWUFBWSxFQUFVLFVBQVUsRUFBRSxXQUFXLEVBQUUsVUFBVSxFQUFFLE1BQU0sdUJBQXVCLENBQUM7QUFFbEcsT0FBTyxFQUFFLGtCQUFrQixFQUFFLE1BQU0sY0FBYyxDQUFDO0FBQ2xELE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBQ3hELE9BQU8sRUFBRSxrQkFBa0IsRUFBRSxNQUFNLHdCQUF3QixDQUFDO0FBQzVELE9BQU8sRUFBRSxpQ0FBaUMsRUFBRSxpQkFBaUIsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQ3ZGLE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQztBQUNwRCxPQUFPLEVBQUUsdUJBQXVCLEVBQUUsTUFBTSw2QkFBNkIsQ0FBQztBQUN0RSxPQUFPLEVBQUUsa0NBQWtDLEVBQUUsTUFBTSxVQUFVLENBQUM7QUFFOUQsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLG9CQUFvQixDQUFDOzs7Ozs7QUFPcEQ7Ozs7OztJQWNFOztPQUVHO0lBQ0gsa0NBQVksVUFBaUM7UUFDM0MsSUFBSSxDQUFDLFVBQVUsR0FBRyxVQUFVLENBQUM7SUFDL0IsQ0FBQztJQVRELHNCQUFZLDhDQUFRO1FBSHBCOztXQUVHOzs7Ozs7UUFDSDtZQUNFLE9BQU8sSUFBSSxDQUFDLFVBQVUsQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUN2QyxDQUFDOzs7T0FBQTtJQVNEOztPQUVHOzs7OztJQUNJLHVDQUFJOzs7O0lBQVg7UUFDRSxJQUFJLENBQUMsY0FBYyxFQUFFLENBQUM7UUFDdEIsSUFBSSxDQUFDLGlCQUFpQixFQUFFLENBQUM7UUFDekIsSUFBSSxDQUFDLG1CQUFtQixFQUFFLENBQUM7UUFDM0IsSUFBSSxDQUFDLFlBQVksRUFBRSxDQUFDO1FBQ3BCLElBQUksQ0FBQyxrQkFBa0IsRUFBRSxDQUFDO1FBQzFCLElBQUksQ0FBQyxlQUFlLEVBQUUsQ0FBQztJQUN6QixDQUFDO0lBRUQ7O09BRUc7Ozs7OztJQUNLLGlEQUFjOzs7OztJQUF0QjtRQUNFLElBQUksQ0FBQyxVQUFVLENBQUMsVUFBVSxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFhLFVBQVUsQ0FBQyxDQUFDO0lBQ3pFLENBQUM7SUFFRDs7T0FFRzs7Ozs7O0lBQ0ssb0RBQWlCOzs7OztJQUF6QjtRQUNFLElBQUksQ0FBQyxVQUFVLENBQUMsYUFBYSxHQUFHLElBQUksZ0JBQWdCLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO0lBQ3pGLENBQUM7SUFFRDs7T0FFRzs7Ozs7O0lBQ0ssc0RBQW1COzs7OztJQUEzQjs7WUFDUSxXQUFXLEdBQUcsWUFBWSxDQUFDLHVCQUF1QixDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsV0FBVyxFQUFFLGtCQUFrQixDQUFDO1FBQ3pHLElBQUksQ0FBQyxVQUFVLENBQUMsZUFBZSxHQUFHLElBQUksa0JBQWtCLENBQUMsV0FBVyxDQUFDLENBQUM7SUFDeEUsQ0FBQztJQUVEOztPQUVHOzs7Ozs7SUFDSywrQ0FBWTs7Ozs7SUFBcEI7UUFDRSxJQUFJLENBQUMsVUFBVSxDQUFDLFFBQVEsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLFlBQVksQ0FBQyxDQUFDOztZQUNyRSxjQUFjLEdBQUcsSUFBSSxjQUFjLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQztRQUMxRCxJQUFJLENBQUMsVUFBVSxDQUFDLFFBQVEsQ0FBQyxjQUFjLENBQUMsY0FBYyxDQUFDLENBQUM7SUFDMUQsQ0FBQztJQUVEOztPQUVHOzs7Ozs7SUFDSyxxREFBa0I7Ozs7O0lBQTFCOztZQUNNLG9CQUFvQixHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFTLGtDQUFrQyxFQUFFLElBQUksRUFBRSxXQUFXLENBQUMsUUFBUSxDQUFDO1FBQ3BILG9CQUFvQixHQUFHLG9CQUFvQixJQUFJLGtCQUFrQixDQUFDOztZQUM1RCxpQkFBaUIsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBMEIsdUJBQXVCLENBQUM7O1lBQ3ZGLFVBQVUsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBYSxVQUFVLENBQUM7O1lBQ3RELE9BQU8sR0FBRyxLQUFHLElBQUksQ0FBQyxVQUFVLENBQUMsUUFBUSxDQUFDLE9BQVM7O1lBQy9DLDhCQUE4QixHQUFHLElBQUksaUNBQWlDLEVBQUU7O1lBQ3hFLHVCQUF1QixHQUFHLDhCQUE4QixDQUFDLE1BQU0sQ0FBQyxvQkFBb0IsRUFBRSxpQkFBaUIsRUFBRSxPQUFPLEVBQUUsVUFBVSxDQUFDO1FBQ25JLElBQUksQ0FBQyxVQUFVLENBQUMsY0FBYyxHQUFHLElBQUksaUJBQWlCLENBQUMsdUJBQXVCLENBQUMsQ0FBQztJQUNsRixDQUFDO0lBRUQ7O09BRUc7Ozs7OztJQUNLLGtEQUFlOzs7OztJQUF2QjtRQUNFLElBQUksQ0FBQyxVQUFVLENBQUMsV0FBVyxHQUFHLElBQUksY0FBYyxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQztJQUNwRSxDQUFDO0lBQ0gsK0JBQUM7QUFBRCxDQUFDLEFBcEZELElBb0ZDOzs7Ozs7O0lBL0VDLDhDQUEwQzs7QUFpRjVDLE9BQU8sRUFBRSx3QkFBd0IsRUFBRSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiXHJcbmltcG9ydCB7IE1ldGFkYXRhVXRpbCwgRW50aXR5LCBBcHBDb250ZXh0LCBJbmplY3RGbGFncywgSHR0cENsaWVudCB9IGZyb20gJ0BmYXJyaXMvbW9iaWxlLWRldmtpdCc7XHJcblxyXG5pbXBvcnQgeyBWQVJJQUJMRV9QUk9QX01FVEEgfSBmcm9tICcuL2RlY29yYXRvcnMnO1xyXG5pbXBvcnQgeyBCZWZFbnRpdHlNYW5hZ2VyIH0gZnJvbSAnLi9iZWZfZW50aXR5X21hbmFnZXInO1xyXG5pbXBvcnQgeyBCZWZWYXJpYWJsZU1hbmFnZXIgfSBmcm9tICcuL2JlZl92YXJpYWJsZV9tYW5hZ2VyJztcclxuaW1wb3J0IHsgQmVmU2Vzc2lvbkhhbmRsaW5nU3RyYXRlZ3lGYWN0b3J5LCBCZWZTZXNzaW9uU2VydmljZSB9IGZyb20gJy4vc2Vzc2lvbi9pbmRleCc7XHJcbmltcG9ydCB7IEJlZkRhdGFTZXJ2aWNlIH0gZnJvbSAnLi9iZWZfZGF0YV9zZXJ2aWNlJztcclxuaW1wb3J0IHsgRnJhbWV3b3JrU2Vzc2lvblNlcnZpY2UgfSBmcm9tICcuL2ZyYW1ld29ya19zZXNzaW9uX3NlcnZpY2UnO1xyXG5pbXBvcnQgeyBCRV9TRVNTSU9OX0hBTkRMSU5HX1NUUkFURUdZX1RPS0VOIH0gZnJvbSAnLi90b2tlbnMnO1xyXG5pbXBvcnQgeyBCZWZSZXBvc2l0b3J5IH0gZnJvbSAnLi9iZWZfcmVwb3NpdG9yeSc7XHJcbmltcG9ydCB7IEJlZlByb3h5RXh0ZW5kIH0gZnJvbSAnLi9iZWZfcHJveHlfZXh0ZW5kJztcclxuXHJcbi8qKlxyXG4gKiBCZWZSZXBvc2l0b3J55Yid5aeL5YyW5ZmoXHJcbiAqIEBzdW1tYXJ5XHJcbiAqIOS4uuS6huaKveemu+i/memDqOWIhui3r+W+hO+8jOW8uuWItuWvueWkluaatOmcsuS6hlJlcG9zaXRvcnnnmoTnm7jlhbPlsZ7mgKfvvIzlvoXkvJjljJbjgIJcclxuICovXHJcbmNsYXNzIEJlZlJlcG9zaXRvcnlJbml0aWFsaXplciB7XHJcblxyXG4gIC8qKlxyXG4gICAqIEJlZlJlcG9zaXRvcnnlrp7kvotcclxuICAgKi9cclxuICBwcml2YXRlIHJlcG9zaXRvcnk6IEJlZlJlcG9zaXRvcnk8RW50aXR5PjtcclxuXHJcbiAgLyoqXHJcbiAgICog5rOo5YWl5ZmoXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBnZXQgaW5qZWN0b3IoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5yZXBvc2l0b3J5LmdldEluamVjdG9yKCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDmnoTpgKDlh73mlbBcclxuICAgKi9cclxuICBjb25zdHJ1Y3RvcihyZXBvc2l0b3J5OiBCZWZSZXBvc2l0b3J5PEVudGl0eT4pIHtcclxuICAgIHRoaXMucmVwb3NpdG9yeSA9IHJlcG9zaXRvcnk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDliJ3lp4vljJZcclxuICAgKi9cclxuICBwdWJsaWMgaW5pdCgpIHtcclxuICAgIHRoaXMuaW5pdEFwcENvbnRleHQoKTtcclxuICAgIHRoaXMuaW5pdEVudGl0eU1hbmFnZXIoKTtcclxuICAgIHRoaXMuaW5pdFZhcmlhYmxlTWFuYWdlcigpO1xyXG4gICAgdGhpcy5pbml0QXBpUHJveHkoKTtcclxuICAgIHRoaXMuaW5pdFNlc3Npb25TZXJ2aWNlKCk7XHJcbiAgICB0aGlzLmluaXREYXRhU2VydmljZSgpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5Yid5aeL5YyW5bqU55So5LiK5LiL5paHXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBpbml0QXBwQ29udGV4dCgpIHtcclxuICAgIHRoaXMucmVwb3NpdG9yeS5hcHBDb250ZXh0ID0gdGhpcy5pbmplY3Rvci5nZXQ8QXBwQ29udGV4dD4oQXBwQ29udGV4dCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDliJ3lp4vljJZFbnRpdHlNYW5hZ2VyXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBpbml0RW50aXR5TWFuYWdlcigpIHtcclxuICAgIHRoaXMucmVwb3NpdG9yeS5lbnRpdHlNYW5hZ2VyID0gbmV3IEJlZkVudGl0eU1hbmFnZXIodGhpcy5yZXBvc2l0b3J5LmVudGl0eUNvbGxlY3Rpb24pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5Yid5aeL5YyWVmFyaWFibGVNYW5hZ2VyXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBpbml0VmFyaWFibGVNYW5hZ2VyKCkge1xyXG4gICAgY29uc3QgbmdWYXJpYWJsZXMgPSBNZXRhZGF0YVV0aWwuZ2V0UHJvcHNNZXRhZGF0YXNCeU5hbWUodGhpcy5yZXBvc2l0b3J5LmNvbnN0cnVjdG9yLCBWQVJJQUJMRV9QUk9QX01FVEEpO1xyXG4gICAgdGhpcy5yZXBvc2l0b3J5LnZhcmlhYmxlTWFuYWdlciA9IG5ldyBCZWZWYXJpYWJsZU1hbmFnZXIobmdWYXJpYWJsZXMpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5Yid5aeL5YyWUHJveHlcclxuICAgKi9cclxuICBwcml2YXRlIGluaXRBcGlQcm94eSgpIHtcclxuICAgIHRoaXMucmVwb3NpdG9yeS5hcGlQcm94eSA9IHRoaXMuaW5qZWN0b3IuZ2V0KHRoaXMucmVwb3NpdG9yeS5hcGlQcm94eVR5cGUpO1xyXG4gICAgY29uc3QgYXBpUHJveHlFeHRlbmQgPSBuZXcgQmVmUHJveHlFeHRlbmQodGhpcy5yZXBvc2l0b3J5KTtcclxuICAgIHRoaXMucmVwb3NpdG9yeS5hcGlQcm94eS5zZXRQcm94eUV4dGVuZChhcGlQcm94eUV4dGVuZCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDliJ3lp4vljJZTZXNzaW9uU2VydmljZVxyXG4gICAqL1xyXG4gIHByaXZhdGUgaW5pdFNlc3Npb25TZXJ2aWNlKCkge1xyXG4gICAgbGV0IGhhbmRsaW5nU3RyYXRlZ3lOYW1lID0gdGhpcy5pbmplY3Rvci5nZXQ8c3RyaW5nPihCRV9TRVNTSU9OX0hBTkRMSU5HX1NUUkFURUdZX1RPS0VOLCBudWxsLCBJbmplY3RGbGFncy5PcHRpb25hbCk7XHJcbiAgICBoYW5kbGluZ1N0cmF0ZWd5TmFtZSA9IGhhbmRsaW5nU3RyYXRlZ3lOYW1lIHx8ICdTZXBhcmF0ZWRTZXNzaW9uJztcclxuICAgIGNvbnN0IGZybVNlc3Npb25TZXJ2aWNlID0gdGhpcy5pbmplY3Rvci5nZXQ8RnJhbWV3b3JrU2Vzc2lvblNlcnZpY2U+KEZyYW1ld29ya1Nlc3Npb25TZXJ2aWNlKTtcclxuICAgIGNvbnN0IGh0dHBDbGllbnQgPSB0aGlzLmluamVjdG9yLmdldDxIdHRwQ2xpZW50PihIdHRwQ2xpZW50KTtcclxuICAgIGNvbnN0IGJhc2VVcmwgPSBgJHt0aGlzLnJlcG9zaXRvcnkuYXBpUHJveHkuYmFzZVVybH1gO1xyXG4gICAgY29uc3Qgc2Vzc2lvbkhhbmRsaW5nU3RyYXRlZ3lGYWN0b3J5ID0gbmV3IEJlZlNlc3Npb25IYW5kbGluZ1N0cmF0ZWd5RmFjdG9yeSgpO1xyXG4gICAgY29uc3Qgc2Vzc2lvbkhhbmRsaW5nU3RyYXRlZ3kgPSBzZXNzaW9uSGFuZGxpbmdTdHJhdGVneUZhY3RvcnkuY3JlYXRlKGhhbmRsaW5nU3RyYXRlZ3lOYW1lLCBmcm1TZXNzaW9uU2VydmljZSwgYmFzZVVybCwgaHR0cENsaWVudCk7XHJcbiAgICB0aGlzLnJlcG9zaXRvcnkuc2Vzc2lvblNlcnZpY2UgPSBuZXcgQmVmU2Vzc2lvblNlcnZpY2Uoc2Vzc2lvbkhhbmRsaW5nU3RyYXRlZ3kpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5Yid5aeL5YyWRGF0YVNlcnZpY2VcclxuICAgKi9cclxuICBwcml2YXRlIGluaXREYXRhU2VydmljZSgpIHtcclxuICAgIHRoaXMucmVwb3NpdG9yeS5kYXRhU2VydmljZSA9IG5ldyBCZWZEYXRhU2VydmljZSh0aGlzLnJlcG9zaXRvcnkpO1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IHsgQmVmUmVwb3NpdG9yeUluaXRpYWxpemVyIH07XHJcbiJdfQ==
/**
 * @fileoverview added by tsickle
 * Generated from: lib/bef_variable_manager.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { ChangeDetailType } from './types';
import { BefChangeUtil } from './utils/index';
/**
 * Be变量管理器
 */
var /**
 * Be变量管理器
 */
BefVariableManager = /** @class */ (function () {
    /**
     * 构造函数
     */
    function BefVariableManager(ngVariables) {
        var _this = this;
        this.ngVariables = ngVariables;
        this.ngVariableMap = new Map();
        this.lastSyncValuesMap = new Map();
        this.latestVariableValues = new Map();
        // 重新组织变量元数据
        Object.keys(this.ngVariables).forEach((/**
         * @param {?} propName
         * @return {?}
         */
        function (propName) {
            _this.ngVariableMap.set(propName, ngVariables[propName]);
        }));
    }
    /**
     * 设置变量值
     */
    /**
     * 设置变量值
     * @param {?} name
     * @param {?} value
     * @return {?}
     */
    BefVariableManager.prototype.setValue = /**
     * 设置变量值
     * @param {?} name
     * @param {?} value
     * @return {?}
     */
    function (name, value) {
        if (this.ngVariableMap.has(name) === false) {
            throw new Error("\u4E0D\u5B58\u5728\u540D\u4E3A" + name + "\u7684\u53D8\u91CF");
        }
        this.latestVariableValues.set(name, value);
    };
    /**
     * 获取变量值
     */
    /**
     * 获取变量值
     * @param {?} name
     * @return {?}
     */
    BefVariableManager.prototype.getValue = /**
     * 获取变量值
     * @param {?} name
     * @return {?}
     */
    function (name) {
        if (this.ngVariableMap.has(name) === false) {
            throw new Error("\u4E0D\u5B58\u5728\u540D\u4E3A" + name + "\u7684\u53D8\u91CF");
        }
        this.latestVariableValues.get(name);
    };
    /**
     * 处理服务器端返回的变量变更
     */
    /**
     * 处理服务器端返回的变量变更
     * @param {?} changeDetail
     * @return {?}
     */
    BefVariableManager.prototype.handleChangeDetail = /**
     * 处理服务器端返回的变量变更
     * @param {?} changeDetail
     * @return {?}
     */
    function (changeDetail) {
    };
    /**
     * Build ChangeDetail instance for all variables.
     */
    /**
     * Build ChangeDetail instance for all variables.
     * @return {?}
     */
    BefVariableManager.prototype.buildChangeDetail = /**
     * Build ChangeDetail instance for all variables.
     * @return {?}
     */
    function () {
        var _this = this;
        /** @type {?} */
        var changeDetail = BefChangeUtil.createEmpty(ChangeDetailType.Modify);
        this.ngVariableMap.forEach((/**
         * @param {?} ngVariable
         * @param {?} varName
         * @return {?}
         */
        function (ngVariable, varName) {
            /** @type {?} */
            var newValue = _this.latestVariableValues.get(varName);
            /** @type {?} */
            var oldValue = _this.lastSyncValuesMap.get(varName);
            if (_this.isValueEqual(newValue, oldValue) === false) {
                _this.lastSyncValuesMap.set(varName, newValue);
                _this.appendToChangeInfo(changeDetail, varName, newValue);
            }
        }));
        if (Object.keys(changeDetail.ChangeInfo).length === 0) {
            return null;
        }
        return changeDetail;
    };
    /**
     * Clear variable values cached in the innerValueMap property.
     */
    /**
     * Clear variable values cached in the innerValueMap property.
     * @return {?}
     */
    BefVariableManager.prototype.reset = /**
     * Clear variable values cached in the innerValueMap property.
     * @return {?}
     */
    function () {
        this.lastSyncValuesMap.clear();
        this.latestVariableValues.clear();
    };
    /**
     * Append changed variable to ChangeDetail instance.
     */
    /**
     * Append changed variable to ChangeDetail instance.
     * @private
     * @param {?} changeDetail
     * @param {?} varName
     * @param {?} varValue
     * @return {?}
     */
    BefVariableManager.prototype.appendToChangeInfo = /**
     * Append changed variable to ChangeDetail instance.
     * @private
     * @param {?} changeDetail
     * @param {?} varName
     * @param {?} varValue
     * @return {?}
     */
    function (changeDetail, varName, varValue) {
        if (this.isUdtVariable(varValue) === true) {
            /** @type {?} */
            var udtVarChangeDetail = BefChangeUtil.createEmpty(ChangeDetailType.Modify);
            udtVarChangeDetail.ChangeInfo = varValue;
            changeDetail.ChangeInfo[varName] = udtVarChangeDetail;
        }
        else {
            changeDetail.ChangeInfo[varName] = varValue;
        }
    };
    /**
     * 值比较
     * @todo 临时采用这种方式
     */
    /**
     * 值比较
     * \@todo 临时采用这种方式
     * @private
     * @param {?} srcValue
     * @param {?} dstValue
     * @return {?}
     */
    BefVariableManager.prototype.isValueEqual = /**
     * 值比较
     * \@todo 临时采用这种方式
     * @private
     * @param {?} srcValue
     * @param {?} dstValue
     * @return {?}
     */
    function (srcValue, dstValue) {
        return JSON.stringify(srcValue) === JSON.stringify(dstValue);
    };
    /**
     * Check if the object is a plain object
     */
    /**
     * Check if the object is a plain object
     * @private
     * @param {?} obj
     * @return {?}
     */
    BefVariableManager.prototype.isUdtVariable = /**
     * Check if the object is a plain object
     * @private
     * @param {?} obj
     * @return {?}
     */
    function (obj) {
        return obj && obj.constructor &&
            obj.toString() === '[object Object]' &&
            obj.constructor.prototype.hasOwnProperty('isPrototypeOf');
    };
    return BefVariableManager;
}());
if (false) {
    /**
     * 变量元数据
     * @type {?}
     * @private
     */
    BefVariableManager.prototype.ngVariableMap;
    /**
     * 最近向服务器端同步的变量值
     * @type {?}
     * @private
     */
    BefVariableManager.prototype.lastSyncValuesMap;
    /**
     * 当前最新的变量值
     * @type {?}
     * @private
     */
    BefVariableManager.prototype.latestVariableValues;
    /**
     * @type {?}
     * @private
     */
    BefVariableManager.prototype.ngVariables;
}
export { BefVariableManager };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmVmX3ZhcmlhYmxlX21hbmFnZXIuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL21vYmlsZS1iZWYvIiwic291cmNlcyI6WyJsaWIvYmVmX3ZhcmlhYmxlX21hbmFnZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFFQSxPQUFPLEVBQUUsZ0JBQWdCLEVBQWdCLE1BQU0sU0FBUyxDQUFDO0FBRXpELE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSxlQUFlLENBQUM7Ozs7QUFLOUM7Ozs7SUFpQkU7O09BRUc7SUFDSCw0QkFBb0IsV0FBZ0I7UUFBcEMsaUJBVUM7UUFWbUIsZ0JBQVcsR0FBWCxXQUFXLENBQUs7UUFFbEMsSUFBSSxDQUFDLGFBQWEsR0FBRyxJQUFJLEdBQUcsRUFBZ0MsQ0FBQztRQUM3RCxJQUFJLENBQUMsaUJBQWlCLEdBQUcsSUFBSSxHQUFHLEVBQWUsQ0FBQztRQUNoRCxJQUFJLENBQUMsb0JBQW9CLEdBQUcsSUFBSSxHQUFHLEVBQWUsQ0FBQztRQUVuRCxZQUFZO1FBQ1osTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUMsT0FBTzs7OztRQUFDLFVBQUMsUUFBZ0I7WUFDckQsS0FBSSxDQUFDLGFBQWEsQ0FBQyxHQUFHLENBQUMsUUFBUSxFQUFFLFdBQVcsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDO1FBQzFELENBQUMsRUFBQyxDQUFDO0lBQ0wsQ0FBQztJQUVEOztPQUVHOzs7Ozs7O0lBQ0kscUNBQVE7Ozs7OztJQUFmLFVBQWdCLElBQVksRUFBRSxLQUFVO1FBQ3RDLElBQUksSUFBSSxDQUFDLGFBQWEsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLEtBQUssS0FBSyxFQUFFO1lBQzFDLE1BQU0sSUFBSSxLQUFLLENBQUMsbUNBQVEsSUFBSSx1QkFBSyxDQUFDLENBQUM7U0FDcEM7UUFDRCxJQUFJLENBQUMsb0JBQW9CLENBQUMsR0FBRyxDQUFDLElBQUksRUFBRSxLQUFLLENBQUMsQ0FB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QUFDO0FBQUQsQ0FBQyxBQXJIRCxJQXFIQzs7Ozs7OztJQWhIQywyQ0FBeUQ7Ozs7OztJQUt6RCwrQ0FBNEM7Ozs7OztJQUs1QyxrREFBa0Q7Ozs7O0lBS3RDLHlDQUF3Qjs7QUFtR3RDLE9BQU8sRUFBRSxrQkFBa0IsRUFBRSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgZm9ybWF0IH0gZnJvbSAnZGF0ZS1mbnMnO1xyXG5pbXBvcnQgeyBBcHBDb250ZXh0LCBVSVN0YXRlLCBJbmplY3RvciB9IGZyb20gJ0BmYXJyaXMvbW9iaWxlLWRldmtpdCc7XHJcbmltcG9ydCB7IENoYW5nZURldGFpbFR5cGUsIENoYW5nZURldGFpbCB9IGZyb20gJy4vdHlwZXMnO1xyXG5pbXBvcnQgeyBWYXJpYWJsZVByb3BNZXRhZGF0YSB9IGZyb20gJy4vZGVjb3JhdG9ycyc7XHJcbmltcG9ydCB7IEJlZkNoYW5nZVV0aWwgfSBmcm9tICcuL3V0aWxzL2luZGV4JztcclxuXHJcbi8qKlxyXG4gKiBCZeWPmOmHj+euoeeQhuWZqFxyXG4gKi9cclxuY2xhc3MgQmVmVmFyaWFibGVNYW5hZ2VyIHtcclxuXHJcbiAgLyoqXHJcbiAgICog5Y+Y6YeP5YWD5pWw5o2uXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBuZ1ZhcmlhYmxlTWFwOiBNYXA8c3RyaW5nLCBWYXJpYWJsZVByb3BNZXRhZGF0YT47XHJcblxyXG4gIC8qKlxyXG4gICAqIOacgOi/keWQkeacjeWKoeWZqOerr+WQjOatpeeahOWPmOmHj+WAvFxyXG4gICAqL1xyXG4gIHByaXZhdGUgbGFzdFN5bmNWYWx1ZXNNYXA6IE1hcDxzdHJpbmcsIGFueT47XHJcblxyXG4gIC8qKlxyXG4gICAqIOW9k+WJjeacgOaWsOeahOWPmOmHj+WAvFxyXG4gICAqL1xyXG4gIHByaXZhdGUgbGF0ZXN0VmFyaWFibGVWYWx1ZXM6IE1hcDxzdHJpbmcsIHN0cmluZz47XHJcblxyXG4gIC8qKlxyXG4gICAqIOaehOmAoOWHveaVsFxyXG4gICAqL1xyXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgbmdWYXJpYWJsZXM6IGFueSkge1xyXG5cclxuICAgIHRoaXMubmdWYXJpYWJsZU1hcCA9IG5ldyBNYXA8c3RyaW5nLCBWYXJpYWJsZVByb3BNZXRhZGF0YT4oKTtcclxuICAgIHRoaXMubGFzdFN5bmNWYWx1ZXNNYXAgPSBuZXcgTWFwPHN0cmluZywgYW55PigpO1xyXG4gICAgdGhpcy5sYXRlc3RWYXJpYWJsZVZhbHVlcyA9IG5ldyBNYXA8c3RyaW5nLCBhbnk+KCk7XHJcblxyXG4gICAgLy8g6YeN5paw57uE57uH5Y+Y6YeP5YWD5pWw5o2uXHJcbiAgICBPYmplY3Qua2V5cyh0aGlzLm5nVmFyaWFibGVzKS5mb3JFYWNoKChwcm9wTmFtZTogc3RyaW5nKSA9PiB7XHJcbiAgICAgIHRoaXMubmdWYXJpYWJsZU1hcC5zZXQocHJvcE5hbWUsIG5nVmFyaWFibGVzW3Byb3BOYW1lXSk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOiuvue9ruWPmOmHj+WAvFxyXG4gICAqL1xyXG4gIHB1YmxpYyBzZXRWYWx1ZShuYW1lOiBzdHJpbmcsIHZhbHVlOiBhbnkpIHtcclxuICAgIGlmICh0aGlzLm5nVmFyaWFibGVNYXAuaGFzKG5hbWUpID09PSBmYWxzZSkge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYOS4jeWtmOWcqOWQjeS4uiR7bmFtZX3nmoTlj5jph49gKTtcclxuICAgIH1cclxuICAgIHRoaXMubGF0ZXN0VmFyaWFibGVWYWx1ZXMuc2V0KG5hbWUsIHZhbHVlKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOiOt+WPluWPmOmHj+WAvFxyXG4gICAqL1xyXG4gIHB1YmxpYyBnZXRWYWx1ZShuYW1lOiBzdHJpbmcpOiBhbnkge1xyXG4gICAgaWYgKHRoaXMubmdWYXJpYWJsZU1hcC5oYXMobmFtZSkgPT09IGZhbHNlKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcihg5LiN5a2Y5Zyo5ZCN5Li6JHtuYW1lfeeahOWPmOmHj2ApO1xyXG4gICAgfVxyXG4gICAgdGhpcy5sYXRlc3RWYXJpYWJsZVZhbHVlcy5nZXQobmFtZSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDlpITnkIbmnI3liqHlmajnq6/ov5Tlm57nmoTlj5jph4/lj5jmm7RcclxuICAgKi9cclxuICBwdWJsaWMgaGFuZGxlQ2hhbmdlRGV0YWlsKGNoYW5nZURldGFpbDogQ2hhbmdlRGV0YWlsKTogdm9pZCB7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBCdWlsZCBDaGFuZ2VEZXRhaWwgaW5zdGFuY2UgZm9yIGFsbCB2YXJpYWJsZXMuXHJcbiAgICovXHJcbiAgcHVibGljIGJ1aWxkQ2hhbmdlRGV0YWlsKCk6IENoYW5nZURldGFpbCB7XHJcbiAgICBjb25zdCBjaGFuZ2VEZXRhaWwgPSBCZWZDaGFuZ2VVdGlsLmNyZWF0ZUVtcHR5KENoYW5nZURldGFpbFR5cGUuTW9kaWZ5KTtcclxuICAgIHRoaXMubmdWYXJpYWJsZU1hcC5mb3JFYWNoKChuZ1ZhcmlhYmxlOiBWYXJpYWJsZVByb3BNZXRhZGF0YSwgdmFyTmFtZTogc3RyaW5nKSA9PiB7XHJcbiAgICAgIGNvbnN0IG5ld1ZhbHVlID0gdGhpcy5sYXRlc3RWYXJpYWJsZVZhbHVlcy5nZXQodmFyTmFtZSk7XHJcbiAgICAgIGNvbnN0IG9sZFZhbHVlID0gdGhpcy5sYXN0U3luY1ZhbHVlc01hcC5nZXQodmFyTmFtZSk7XHJcbiAgICAgIGlmICh0aGlzLmlzVmFsdWVFcXVhbChuZXdWYWx1ZSwgb2xkVmFsdWUpID09PSBmYWxzZSkge1xyXG4gICAgICAgIHRoaXMubGFzdFN5bmNWYWx1ZXNNYXAuc2V0KHZhck5hbWUsIG5ld1ZhbHVlKTtcclxuICAgICAgICB0aGlzLmFwcGVuZFRvQ2hhbmdlSW5mbyhjaGFuZ2VEZXRhaWwsIHZhck5hbWUsIG5ld1ZhbHVlKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcblxyXG4gICAgaWYgKE9iamVjdC5rZXlzKGNoYW5nZURldGFpbC5DaGFuZ2VJbmZvKS5sZW5ndGggPT09IDApIHtcclxuICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIGNoYW5nZURldGFpbDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIENsZWFyIHZhcmlhYmxlIHZhbHVlcyBjYWNoZWQgaW4gdGhlIGlubmVyVmFsdWVNYXAgcHJvcGVydHkuXHJcbiAgICovXHJcbiAgcHVibGljIHJlc2V0KCkge1xyXG4gICAgdGhpcy5sYXN0U3luY1ZhbHVlc01hcC5jbGVhcigpO1xyXG4gICAgdGhpcy5sYXRlc3RWYXJpYWJsZVZhbHVlcy5jbGVhcigpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQXBwZW5kIGNoYW5nZWQgdmFyaWFibGUgdG8gQ2hhbmdlRGV0YWlsIGluc3RhbmNlLlxyXG4gICAqL1xyXG4gIHByaXZhdGUgYXBwZW5kVG9DaGFuZ2VJbmZvKGNoYW5nZURldGFpbDogQ2hhbmdlRGV0YWlsLCB2YXJOYW1lOiBzdHJpbmcsIHZhclZhbHVlOiBhbnkpOiB2b2lkIHtcclxuICAgIGlmICh0aGlzLmlzVWR0VmFyaWFibGUodmFyVmFsdWUpID09PSB0cnVlKSB7XHJcbiAgICAgIGNvbnN0IHVkdFZhckNoYW5nZURldGFpbCA9IEJlZkNoYW5nZVV0aWwuY3JlYXRlRW1wdHkoQ2hhbmdlRGV0YWlsVHlwZS5Nb2RpZnkpO1xyXG4gICAgICB1ZHRWYXJDaGFuZ2VEZXRhaWwuQ2hhbmdlSW5mbyA9IHZhclZhbHVlO1xyXG4gICAgICBjaGFuZ2VEZXRhaWwuQ2hhbmdlSW5mb1t2YXJOYW1lXSA9IHVkdFZhckNoYW5nZURldGFpbDtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGNoYW5nZURldGFpbC5DaGFuZ2VJbmZvW3Zhck5hbWVdID0gdmFyVmFsdWU7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDlgLzmr5TovoNcclxuICAgKiBAdG9kbyDkuLTml7bph4fnlKjov5nnp43mlrnlvI9cclxuICAgKi9cclxuICBwcml2YXRlIGlzVmFsdWVFcXVhbChzcmNWYWx1ZTogYW55LCBkc3RWYWx1ZTogYW55KTogYm9vbGVhbiB7XHJcbiAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkoc3JjVmFsdWUpID09PSBKU09OLnN0cmluZ2lmeShkc3RWYWx1ZSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBDaGVjayBpZiB0aGUgb2JqZWN0IGlzIGEgcGxhaW4gb2JqZWN0XHJcbiAgICovXHJcbiAgcHJpdmF0ZSBpc1VkdFZhcmlhYmxlKG9iajogYW55KTogYm9vbGVhbiB7XHJcbiAgICByZXR1cm4gb2JqICYmIG9iai5jb25zdHJ1Y3RvciAmJlxyXG4gICAgICBvYmoudG9TdHJpbmcoKSA9PT0gJ1tvYmplY3QgT2JqZWN0XScgJiZcclxuICAgICAgb2JqLmNvbnN0cnVjdG9yLnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eSgnaXNQcm90b3R5cGVPZicpO1xyXG4gIH1cclxuXHJcbn1cclxuXHJcbmV4cG9ydCB7IEJlZlZhcmlhYmxlTWFuYWdlciB9O1xyXG4iXX0=
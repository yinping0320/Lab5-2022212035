/**
 * @fileoverview added by tsickle
 * Generated from: lib/bef_proxy.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { switchMap, map, catchError } from 'rxjs/operators';
import { HttpMethods } from '@farris/mobile-devkit';
import { BefDataPathUtil } from './utils/index';
/**
 * Bef API代理类
 * @abstract
 */
var /**
 * Bef API代理类
 * @abstract
 */
BefProxy = /** @class */ (function () {
    /**
     * 构造函数
     */
    function BefProxy(httpClient) {
        this.httpClient = httpClient;
        this.associatedUrlMap = new Map();
    }
    // 记录附件取跨Be url
    // 记录附件取跨Be url
    /**
     * @param {?} url
     * @return {?}
     */
    BefProxy.prototype.setAssociatedUrl = 
    // 记录附件取跨Be url
    /**
     * @param {?} url
     * @return {?}
     */
    function (url) {
        this.associatedUrlMap.set(url, url);
    };
    /**
     * 设置扩展策略
     */
    /**
     * 设置扩展策略
     * @param {?} proxyExtend
     * @return {?}
     */
    BefProxy.prototype.setProxyExtend = /**
     * 设置扩展策略
     * @param {?} proxyExtend
     * @return {?}
     */
    function (proxyExtend) {
        this.proxyExtend = proxyExtend;
    };
    /**
     * 查询
     */
    /**
     * 查询
     * @param {?=} entityFilter
     * @return {?}
     */
    BefProxy.prototype.query = /**
     * 查询
     * @param {?=} entityFilter
     * @return {?}
     */
    function (entityFilter) {
        /** @type {?} */
        var url = this.baseUrl;
        /** @type {?} */
        var params = {};
        if (entityFilter) {
            /** @type {?} */
            var entityFilterString = JSON.stringify(entityFilter);
            params.entityFilter = entityFilterString;
        }
        /** @type {?} */
        var requestConfig = {
            params: params
        };
        return this.request(HttpMethods.GET, url, requestConfig);
    };
    /**
     * 列表数据查询（扩展）
     */
    /**
     * 列表数据查询（扩展）
     * @param {?} entityFilter
     * @return {?}
     */
    BefProxy.prototype.extendQuery = /**
     * 列表数据查询（扩展）
     * @param {?} entityFilter
     * @return {?}
     */
    function (entityFilter) {
        /** @type {?} */
        var url = this.baseUrl + "/extension/query";
        /** @type {?} */
        var params = {};
        if (entityFilter) {
            /** @type {?} */
            var entityFilterString = JSON.stringify(entityFilter);
            params.entityFilter = entityFilterString;
        }
        /** @type {?} */
        var requestConfig = {
            params: params
        };
        return this.request(HttpMethods.PUT, url, requestConfig);
    };
    /**
     * 单条数据检索
     */
    /**
     * 单条数据检索
     * @param {?} id
     * @return {?}
     */
    BefProxy.prototype.retrieve = /**
     * 单条数据检索
     * @param {?} id
     * @return {?}
     */
    function (id) {
        /** @type {?} */
        var url = this.baseUrl + "/" + id;
        return this.request(HttpMethods.GET, url);
    };
    /**
     * 单条数据检索（扩展）
     */
    /**
     * 单条数据检索（扩展）
     * @param {?} id
     * @return {?}
     */
    BefProxy.prototype.extendRetrieve = /**
     * 单条数据检索（扩展）
     * @param {?} id
     * @return {?}
     */
    function (id) {
        /** @type {?} */
        var url = this.baseUrl + "/extension/retrieve/" + id;
        return this.request(HttpMethods.PUT, url);
    };
    /**
     * 单条数据检索（加锁）
     */
    /**
     * 单条数据检索（加锁）
     * @param {?} id
     * @return {?}
     */
    BefProxy.prototype.edit = /**
     * 单条数据检索（加锁）
     * @param {?} id
     * @return {?}
     */
    function (id) {
        /** @type {?} */
        var url = this.baseUrl + "/service/edit/" + id;
        return this.request(HttpMethods.PUT, url);
    };
    /**
     * 新增数据
     */
    /**
     * 新增数据
     * @param {?=} defaultValue
     * @param {?=} requestInfo
     * @return {?}
     */
    BefProxy.prototype.create = /**
     * 新增数据
     * @param {?=} defaultValue
     * @param {?=} requestInfo
     * @return {?}
     */
    function (defaultValue, requestInfo) {
        /** @type {?} */
        var body = {
            defaultValue: defaultValue,
            requestInfo: requestInfo,
        };
        /** @type {?} */
        var requestConfig = {
            body: body
        };
        return this.request(HttpMethods.POST, this.baseUrl, requestConfig);
    };
    /**
     * 新增从表数据
     * @path 新增路径（从表形如：/1/edus，从从表形如：/1/edus/11/grades）
     */
    /**
     * 新增从表数据
     * \@path 新增路径（从表形如：/1/edus，从从表形如：/1/edus/11/grades）
     * @param {?} fpath
     * @return {?}
     */
    BefProxy.prototype.createByPath = /**
     * 新增从表数据
     * \@path 新增路径（从表形如：/1/edus，从从表形如：/1/edus/11/grades）
     * @param {?} fpath
     * @return {?}
     */
    function (fpath) {
        /** @type {?} */
        var pathUrl = BefDataPathUtil.convertPathToUrl(fpath);
        /** @type {?} */
        var url = "" + this.baseUrl + pathUrl;
        return this.request(HttpMethods.POST, url);
    };
    /**
     * 提交变更
     */
    /**
     * 提交变更
     * @param {?} changeDetail
     * @return {?}
     */
    BefProxy.prototype.update = /**
     * 提交变更
     * @param {?} changeDetail
     * @return {?}
     */
    function (changeDetail) {
        /** @type {?} */
        var body = {
            changeDetail: changeDetail
        };
        /** @type {?} */
        var requestConfig = {
            body: body
        };
        return this.request(HttpMethods.PATCH, this.baseUrl, requestConfig);
    };
    /**
     * 执行保存
     */
    /**
     * 执行保存
     * @return {?}
     */
    BefProxy.prototype.save = /**
     * 执行保存
     * @return {?}
     */
    function () {
        return this.request(HttpMethods.PUT, this.baseUrl);
    };
    /**
     * 删除
     */
    /**
     * 删除
     * @param {?} id
     * @return {?}
     */
    BefProxy.prototype.delete = /**
     * 删除
     * @param {?} id
     * @return {?}
     */
    function (id) {
        /** @type {?} */
        var url = this.baseUrl + "/" + id;
        return this.request(HttpMethods.DELETE, url);
    };
    /**
     * 删除（扩展）
     */
    /**
     * 删除（扩展）
     * @param {?} id
     * @return {?}
     */
    BefProxy.prototype.extendDelete = /**
     * 删除（扩展）
     * @param {?} id
     * @return {?}
     */
    function (id) {
        /** @type {?} */
        var url = this.baseUrl + "/extension/delete/" + id;
        return this.request(HttpMethods.PUT, url);
    };
    /**
     * 删除并保存
     */
    /**
     * 删除并保存
     * @param {?} id
     * @return {?}
     */
    BefProxy.prototype.deleteAndSave = /**
     * 删除并保存
     * @param {?} id
     * @return {?}
     */
    function (id) {
        /** @type {?} */
        var url = this.baseUrl + "/service/delete/" + id;
        /** @type {?} */
        var requestConfig = {};
        return this.request(HttpMethods.PUT, url, requestConfig);
    };
    /**
     * 删除后代
     */
    /**
     * 删除后代
     * @param {?} fpath
     * @param {?} id
     * @return {?}
     */
    BefProxy.prototype.deletByPath = /**
     * 删除后代
     * @param {?} fpath
     * @param {?} id
     * @return {?}
     */
    function (fpath, id) {
        /** @type {?} */
        var pathUrl = BefDataPathUtil.convertPathToUrl(fpath);
        /** @type {?} */
        var url = "" + this.baseUrl + pathUrl + "/" + id;
        return this.request(HttpMethods.DELETE, url);
    };
    /**
     * 删除后代（扩展）
     */
    /**
     * 删除后代（扩展）
     * @param {?} fpath
     * @param {?} id
     * @return {?}
     */
    BefProxy.prototype.extendDeletByPath = /**
     * 删除后代（扩展）
     * @param {?} fpath
     * @param {?} id
     * @return {?}
     */
    function (fpath, id) {
        /** @type {?} */
        var pathUrl = BefDataPathUtil.convertPathToUrl(fpath);
        /** @type {?} */
        var url = this.baseUrl + "/extension" + pathUrl + "/" + id;
        return this.request(HttpMethods.PUT, url);
    };
    /**
     * 批量删除
     * @param ids 待删除的id数组
     */
    /**
     * 批量删除
     * @param {?} ids 待删除的id数组
     * @return {?}
     */
    BefProxy.prototype.batchDelete = /**
     * 批量删除
     * @param {?} ids 待删除的id数组
     * @return {?}
     */
    function (ids) {
        /** @type {?} */
        var params = {
            ids: ids.join(',')
        };
        /** @type {?} */
        var requestConfig = {
            params: params
        };
        return this.request(HttpMethods.DELETE, this.baseUrl, requestConfig);
    };
    /**
     * 批量删除（扩展）
     */
    /**
     * 批量删除（扩展）
     * @param {?} ids
     * @return {?}
     */
    BefProxy.prototype.extendBatchDelete = /**
     * 批量删除（扩展）
     * @param {?} ids
     * @return {?}
     */
    function (ids) {
        /** @type {?} */
        var url = this.baseUrl + "/extension/batchdelete";
        /** @type {?} */
        var params = {
            ids: ids.join(',')
        };
        /** @type {?} */
        var requestConfig = {
            params: params
        };
        return this.request(HttpMethods.PUT, url, requestConfig);
    };
    /**
     * 取消
     */
    /**
     * 取消
     * @return {?}
     */
    BefProxy.prototype.cancel = /**
     * 取消
     * @return {?}
     */
    function () {
        /** @type {?} */
        var url = this.baseUrl + "/service/cancel";
        return this.request(HttpMethods.POST, url);
    };
    /**
     * 调用httpclient取数
     * @param url url
     * @param method methods
     * @param requestConfigs options
     */
    /**
     * 调用httpclient取数
     * @param {?} method methods
     * @param {?} url url
     * @param {?=} requestConfigs options
     * @param {?=} ignoreHandlingChanges
     * @return {?}
     */
    BefProxy.prototype.request = /**
     * 调用httpclient取数
     * @param {?} method methods
     * @param {?} url url
     * @param {?=} requestConfigs options
     * @param {?=} ignoreHandlingChanges
     * @return {?}
     */
    function (method, url, requestConfigs, ignoreHandlingChanges) {
        var _this = this;
        if (ignoreHandlingChanges === void 0) { ignoreHandlingChanges = false; }
        requestConfigs = requestConfigs || {};
        // 扩展body
        if (ignoreHandlingChanges !== true) {
            if (method === HttpMethods.POST || method === HttpMethods.PUT || method === HttpMethods.PATCH) {
                /** @type {?} */
                var body = requestConfigs.body || {};
                requestConfigs.body = this.proxyExtend.extendBody(body);
            }
        }
        // 扩展headers
        /** @type {?} */
        var headers$ = this.proxyExtend.extendHeaders(requestConfigs.headers);
        // 发送请求
        return headers$.pipe(switchMap((/**
         * @param {?} headers
         * @return {?}
         */
        function (headers) {
            requestConfigs.headers = headers;
            requestConfigs.observe = 'response';
            return _this.httpClient.request(method, url, requestConfigs).pipe(map((/**
             * @param {?} result
             * @return {?}
             */
            function (result) {
                if (ignoreHandlingChanges === true) {
                    return result && result.body && result.body.returnValue ? result.body.returnValue : result;
                }
                else {
                    return _this.proxyExtend.onResponse(result);
                }
            })), catchError((/**
             * @param {?} error
             * @return {?}
             */
            function (error) {
                return _this.proxyExtend.onError(error, false, false);
            })));
        })), catchError((/**
         * @param {?} error
         * @return {?}
         */
        function (error) {
            return _this.proxyExtend.onError(error, false, false);
        })));
    };
    return BefProxy;
}());
/**
 * Bef API代理类
 * @abstract
 */
export { BefProxy };
if (false) {
    /**
     * API基路径
     * \@summary
     * 延迟到实现类确定，考虑使用注解指定。
     * @type {?}
     */
    BefProxy.prototype.baseUrl;
    /** @type {?} */
    BefProxy.prototype.associatedUrlMap;
    /**
     * 代理扩展
     * @type {?}
     * @protected
     */
    BefProxy.prototype.proxyExtend;
    /** @type {?} */
    BefProxy.prototype.httpClient;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmVmX3Byb3h5LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy9tb2JpbGUtYmVmLyIsInNvdXJjZXMiOlsibGliL2JlZl9wcm94eS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUNBLE9BQU8sRUFBRSxTQUFTLEVBQUUsR0FBRyxFQUFFLFVBQVUsRUFBTyxNQUFNLGdCQUFnQixDQUFDO0FBQ2pFLE9BQU8sRUFBdUMsV0FBVyxFQUErQyxNQUFNLHVCQUF1QixDQUFDO0FBSXRJLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxlQUFlLENBQUM7Ozs7O0FBTWhEOzs7OztJQWlCRTs7T0FFRztJQUNILGtCQUFtQixVQUFzQjtRQUF0QixlQUFVLEdBQVYsVUFBVSxDQUFZO1FBQ3ZDLElBQUksQ0FBQyxnQkFBZ0IsR0FBRyxJQUFJLEdBQUcsRUFBRSxDQUFDO0lBQ3BDLENBQUM7SUFFRCxlQUFlOzs7Ozs7SUFDZixtQ0FBZ0I7Ozs7OztJQUFoQixVQUFpQixHQUFHO1FBQ2xCLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxHQUFHLENBQUMsR0FBRyxFQUFDLEdBQUcsQ0FBQyxDQUFBO0lBQ3BDLENBQUM7SUFDRDs7T0FFRzs7Ozs7O0lBQ0ksaUNBQWM7Ozs7O0lBQXJCLFVBQXNCLFdBQXlCO1FBQzdDLElBQUksQ0FBQyxXQUFXLEdBQUcsV0FBVyxDQUFDO0lBQ2pDLENBQUM7SUFFRDs7T0FFRzs7Ozs7O0lBQ0ksd0JBQUs7Ozs7O0lBQVosVUFBYSxZQUFrQjs7WUFDdkIsR0FBRyxHQUFHLElBQUksQ0FBQyxPQUFPOztZQUNsQixNQUFNLEdBQWUsRUFBRTtRQUM3QixJQUFJLFlBQVksRUFBRTs7Z0JBQ1Ysa0JBQWtCLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxZQUFZLENBQUM7WUFDdkQsTUFBTSxDQUFDLFlBQVksR0FBRyxrQkFBa0IsQ0FBQztTQUMxQzs7WUFDSyxhQUFhLEdBQXNCO1lBQ3ZDLE1BQU0sRUFBRSxNQUFNO1NBQ2Y7UUFDRCxPQUFPLElB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T0FBTyxLQUFJLENBQUMsV0FBVyxDQUFDLE9BQU8sQ0FBQyxLQUFLLEVBQUUsS0FBSyxFQUFFLEtBQUssQ0FBQyxDQUFDO1lBQ3ZELENBQUMsRUFBQyxDQUNILENBQUM7UUFDTixDQUFDLEVBQUMsRUFDRixVQUFVOzs7O1FBQUMsVUFBQyxLQUFVO1lBQ3BCLE9BQU8sS0FBSSxDQUFDLFdBQVcsQ0FBQyxPQUFPLENBQUMsS0FBSyxFQUFFLEtBQUssRUFBRSxLQUFLLENBQUMsQ0FBQztRQUN2RCxDQUFDLEVBQUMsQ0FDSCxDQUFDO0lBQ0osQ0FBQztJQUVILGVBQUM7QUFBRCxDQUFDLEFBcFFELElBb1FDOzs7Ozs7Ozs7Ozs7O0lBN1BDLDJCQUFnQzs7SUFHaEMsb0NBQTZDOzs7Ozs7SUFLN0MsK0JBQW9DOztJQUt4Qiw4QkFBNkIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBPYnNlcnZhYmxlIH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7IHN3aXRjaE1hcCwgbWFwLCBjYXRjaEVycm9yLCB0YXAgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XHJcbmltcG9ydCB7IEh0dHBIZWFkZXJzLCBIdHRwUGFyYW1zLCBIdHRwTWV0aG9kLCBIdHRwTWV0aG9kcywgSHR0cFJlcXVlc3RDb25maWcsIEh0dHBSZXNwb25zZSwgSHR0cENsaWVudCB9IGZyb20gJ0BmYXJyaXMvbW9iaWxlLWRldmtpdCc7XHJcblxyXG5pbXBvcnQgeyBSZXF1ZXN0SW5mbywgUmVzcG9uc2VJbmZvLCBDaGFuZ2VEZXRhaWwgfSBmcm9tICcuL3R5cGVzJztcclxuaW1wb3J0IHsgSVByb3h5RXh0ZW5kIH0gZnJvbSAnLi9iZWZfcHJveHlfZXh0ZW5kJztcclxuaW1wb3J0IHsgQmVmRGF0YVBhdGhVdGlsIH0gZnJvbSAnLi91dGlscy9pbmRleCc7XHJcblxyXG5cclxuLyoqXHJcbiAqIEJlZiBBUEnku6PnkIbnsbtcclxuICovXHJcbmV4cG9ydCBhYnN0cmFjdCBjbGFzcyBCZWZQcm94eSB7XHJcblxyXG4gIC8qKlxyXG4gICAqIEFQSeWfuui3r+W+hFxyXG4gICAqIEBzdW1tYXJ5XHJcbiAgICog5bu26L+f5Yiw5a6e546w57G756Gu5a6a77yM6ICD6JmR5L2/55So5rOo6Kej5oyH5a6a44CCXHJcbiAgICovXHJcbiAgcHVibGljIGFic3RyYWN0IGJhc2VVcmw6IHN0cmluZztcclxuXHJcblxyXG4gIHB1YmxpYyBhc3NvY2lhdGVkVXJsTWFwOiBNYXA8c3RyaW5nLCBzdHJpbmc+O1xyXG5cclxuICAvKipcclxuICAgKiDku6PnkIbmianlsZVcclxuICAgKi9cclxuICBwcm90ZWN0ZWQgcHJveHlFeHRlbmQ6IElQcm94eUV4dGVuZDtcclxuXHJcbiAgLyoqXHJcbiAgICog5p6E6YCg5Ye95pWwXHJcbiAgICovXHJcbiAgY29uc3RydWN0b3IocHVibGljIGh0dHBDbGllbnQ6IEh0dHBDbGllbnQpIHtcclxuICAgIHRoaXMuYXNzb2NpYXRlZFVybE1hcCA9IG5ldyBNYXAoKTtcclxuICB9XHJcblxyXG4gIC8vIOiusOW9lemZhOS7tuWPlui3qEJlIHVybFxyXG4gIHNldEFzc29jaWF0ZWRVcmwodXJsKXtcclxuICAgIHRoaXMuYXNzb2NpYXRlZFVybE1hcC5zZXQodXJsLHVybClcclxuICB9XHJcbiAgLyoqXHJcbiAgICog6K6+572u5omp5bGV562W55WlXHJcbiAgICovXHJcbiAgcHVibGljIHNldFByb3h5RXh0ZW5kKHByb3h5RXh0ZW5kOiBJUHJveHlFeHRlbmQpIHtcclxuICAgIHRoaXMucHJveHlFeHRlbmQgPSBwcm94eUV4dGVuZDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOafpeivolxyXG4gICAqL1xyXG4gIHB1YmxpYyBxdWVyeShlbnRpdHlGaWx0ZXI/OiBhbnkpOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgY29uc3QgdXJsID0gdGhpcy5iYXNlVXJsO1xyXG4gICAgY29uc3QgcGFyYW1zOiBIdHRwUGFyYW1zID0ge307XHJcbiAgICBpZiAoZW50aXR5RmlsdGVyKSB7XHJcbiAgICAgIGNvbnN0IGVudGl0eUZpbHRlclN0cmluZyA9IEpTT04uc3RyaW5naWZ5KGVudGl0eUZpbHRlcik7XHJcbiAgICAgIHBhcmFtcy5lbnRpdHlGaWx0ZXIgPSBlbnRpdHlGaWx0ZXJTdHJpbmc7XHJcbiAgICB9XHJcbiAgICBjb25zdCByZXF1ZXN0Q29uZmlnOiBIdHRwUmVxdWVzdENvbmZpZyA9IHtcclxuICAgICAgcGFyYW1zOiBwYXJhbXNcclxuICAgIH07XHJcbiAgICByZXR1cm4gdGhpcy5yZXF1ZXN0KEh0dHBNZXRob2RzLkdFVCwgdXJsLCByZXF1ZXN0Q29uZmlnKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOWIl+ihqOaVsOaNruafpeivou+8iOaJqeWxle+8iVxyXG4gICAqL1xyXG4gIHB1YmxpYyBleHRlbmRRdWVyeShlbnRpdHlGaWx0ZXI6IGFueSk6IE9ic2VydmFibGU8UmVzcG9uc2VJbmZvPiB7XHJcbiAgICBjb25zdCB1cmwgPSBgJHt0aGlzLmJhc2VVcmx9L2V4dGVuc2lvbi9xdWVyeWA7XHJcbiAgICBjb25zdCBwYXJhbXM6IEh0dHBQYXJhbXMgPSB7fTtcclxuICAgIGlmIChlbnRpdHlGaWx0ZXIpIHtcclxuICAgICAgY29uc3QgZW50aXR5RmlsdGVyU3RyaW5nID0gSlNPTi5zdHJpbmdpZnkoZW50aXR5RmlsdGVyKTtcclxuICAgICAgcGFyYW1zLmVudGl0eUZpbHRlciA9IGVudGl0eUZpbHRlclN0cmluZztcclxuICAgIH1cclxuICAgIGNvbnN0IHJlcXVlc3RDb25maWc6IEh0dHBSZXF1ZXN0Q29uZmlnID0ge1xyXG4gICAgICBwYXJhbXM6IHBhcmFtc1xyXG4gICAgfTtcclxuICAgIHJldHVybiB0aGlzLnJlcXVlc3QoSHR0cE1ldGhvZHMuUFVULCB1cmwsIHJlcXVlc3RDb25maWcpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5Y2V5p2h5pWw5o2u5qOA57SiXHJcbiAgICovXHJcbiAgcHVibGljIHJldHJpZXZlKGlkOiBzdHJpbmcpOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgY29uc3QgdXJsID0gYCR7dGhpcy5iYXNlVXJsfS8ke2lkfWA7XHJcbiAgICByZXR1cm4gdGhpcy5yZXF1ZXN0KEh0dHBNZXRob2RzLkdFVCwgdXJsKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOWNleadoeaVsOaNruajgOe0ou+8iOaJqeWxle+8iVxyXG4gICAqL1xyXG4gIHB1YmxpYyBleHRlbmRSZXRyaWV2ZShpZDogc3RyaW5nKTogT2JzZXJ2YWJsZTxSZXNwb25zZUluZm8+IHtcclxuICAgIGNvbnN0IHVybCA9IGAke3RoaXMuYmFzZVVybH0vZXh0ZW5zaW9uL3JldHJpZXZlLyR7aWR9YDtcclxuICAgIHJldHVybiB0aGlzLnJlcXVlc3QoSHR0cE1ldGhvZHMuUFVULCB1cmwpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5Y2V5p2h5pWw5o2u5qOA57Si77yI5Yqg6ZSB77yJXHJcbiAgICovXHJcbiAgcHVibGljIGVkaXQoaWQ6IHN0cmluZyk6IE9ic2VydmFibGU8UmVzcG9uc2VJbmZvPiB7XHJcbiAgICBjb25zdCB1cmwgPSBgJHt0aGlzLmJhc2VVcmx9L3NlcnZpY2UvZWRpdC8ke2lkfWA7XHJcbiAgICByZXR1cm4gdGhpcy5yZXF1ZXN0KEh0dHBNZXRob2RzLlBVVCwgdXJsKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOaWsOWinuaVsOaNrlxyXG4gICAqL1xyXG4gIHB1YmxpYyBjcmVhdGUoZGVmYXVsdFZhbHVlPzogYW55LCByZXF1ZXN0SW5mbz86IFJlcXVlc3RJbmZvKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgIGNvbnN0IGJvZHkgPSB7XHJcbiAgICAgIGRlZmF1bHRWYWx1ZSxcclxuICAgICAgcmVxdWVzdEluZm86IHJlcXVlc3RJbmZvLFxyXG4gICAgfTtcclxuICAgIGNvbnN0IHJlcXVlc3RDb25maWc6IEh0dHBSZXF1ZXN0Q29uZmlnID0ge1xyXG4gICAgICBib2R5OiBib2R5XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIHRoaXMucmVxdWVzdChIdHRwTWV0aG9kcy5QT1NULCB0aGlzLmJhc2VVcmwsIHJlcXVlc3RDb25maWcpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5paw5aKe5LuO6KGo5pWw5o2uXHJcbiAgICogQHBhdGgg5paw5aKe6Lev5b6E77yI5LuO6KGo5b2i5aaC77yaLzEvZWR1c++8jOS7juS7juihqOW9ouWmgu+8mi8xL2VkdXMvMTEvZ3JhZGVz77yJXHJcbiAgICovXHJcbiAgcHVibGljIGNyZWF0ZUJ5UGF0aChmcGF0aDogc3RyaW5nKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgIGNvbnN0IHBhdGhVcmwgPSBCZWZEYXRhUGF0aFV0aWwuY29udmVydFBhdGhUb1VybChmcGF0aCk7XHJcbiAgICBjb25zdCB1cmwgPSBgJHt0aGlzLmJhc2VVcmx9JHtwYXRoVXJsfWA7XHJcbiAgICByZXR1cm4gdGhpcy5yZXF1ZXN0KEh0dHBNZXRob2RzLlBPU1QsIHVybCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDmj5DkuqTlj5jmm7RcclxuICAgKi9cclxuICB1cGRhdGUoY2hhbmdlRGV0YWlsOiBDaGFuZ2VEZXRhaWwpOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgY29uc3QgYm9keSA9IHtcclxuICAgICAgY2hhbmdlRGV0YWlsXHJcbiAgICB9O1xyXG4gICAgY29uc3QgcmVxdWVzdENvbmZpZzogSHR0cFJlcXVlc3RDb25maWcgPSB7XHJcbiAgICAgIGJvZHk6IGJvZHlcclxuICAgIH07XHJcblxyXG4gICAgcmV0dXJuIHRoaXMucmVxdWVzdChIdHRwTWV0aG9kcy5QQVRDSCwgdGhpcy5iYXNlVXJsLCByZXF1ZXN0Q29uZmlnKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOaJp+ihjOS/neWtmFxyXG4gICAqL1xyXG4gIHB1YmxpYyBzYXZlKCk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICByZXR1cm4gdGhpcy5yZXF1ZXN0KCBIdHRwTWV0aG9kcy5QVVQsIHRoaXMuYmFzZVVybCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDliKDpmaRcclxuICAgKi9cclxuICBwdWJsaWMgZGVsZXRlKGlkOiBzdHJpbmcpOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgY29uc3QgdXJsID0gYCR7dGhpcy5iYXNlVXJsfS8ke2lkfWA7XHJcbiAgICByZXR1cm4gdGhpcy5yZXF1ZXN0KEh0dHBNZXRob2RzLkRFTEVURSwgdXJsKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOWIoOmZpO+8iOaJqeWxle+8iVxyXG4gICAqL1xyXG4gIHB1YmxpYyBleHRlbmREZWxldGUoaWQ6IHN0cmluZyk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICBjb25zdCB1cmwgPSBgJHt0aGlzLmJhc2VVcmx9L2V4dGVuc2lvbi9kZWxldGUvJHtpZH1gO1xyXG4gICAgcmV0dXJuIHRoaXMucmVxdWVzdChIdHRwTWV0aG9kcy5QVVQsIHVybCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDliKDpmaTlubbkv53lrZhcclxuICAgKi9cclxuICBwdWJsaWMgZGVsZXRlQW5kU2F2ZShpZDogYW55KTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgIGNvbnN0IHVybCA9IGAke3RoaXMuYmFzZVVybH0vc2VydmljZS9kZWxldGUvJHtpZH1gO1xyXG4gICAgY29uc3QgcmVxdWVzdENvbmZpZzogSHR0cFJlcXVlc3RDb25maWcgPSB7fTtcclxuICAgIHJldHVybiB0aGlzLnJlcXVlc3QoSHR0cE1ldGhvZHMuUFVULCB1cmwsIHJlcXVlc3RDb25maWcpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5Yig6Zmk5ZCO5LujXHJcbiAgICovXHJcbiAgcHVibGljIGRlbGV0QnlQYXRoKGZwYXRoOiBzdHJpbmcsIGlkOiBzdHJpbmcpOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgY29uc3QgcGF0aFVybCA9IEJlZkRhdGFQYXRoVXRpbC5jb252ZXJ0UGF0aFRvVXJsKGZwYXRoKTtcclxuICAgIGNvbnN0IHVybCA9IGAke3RoaXMuYmFzZVVybH0ke3BhdGhVcmx9LyR7aWR9YDtcclxuICAgIHJldHVybiB0aGlzLnJlcXVlc3QoSHR0cE1ldGhvZHMuREVMRVRFLCB1cmwpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5Yig6Zmk5ZCO5Luj77yI5omp5bGV77yJXHJcbiAgICovXHJcbiAgcHVibGljIGV4dGVuZERlbGV0QnlQYXRoKGZwYXRoOiBzdHJpbmcsIGlkOiBzdHJpbmcpOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgY29uc3QgcGF0aFVybCA9IEJlZkRhdGFQYXRoVXRpbC5jb252ZXJ0UGF0aFRvVXJsKGZwYXRoKTtcclxuICAgIGNvbnN0IHVybCA9IGAke3RoaXMuYmFzZVVybH0vZXh0ZW5zaW9uJHtwYXRoVXJsfS8ke2lkfWA7XHJcbiAgICByZXR1cm4gdGhpcy5yZXF1ZXN0KEh0dHBNZXRob2RzLlBVVCwgdXJsKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOaJuemHj+WIoOmZpFxyXG4gICAqIEBwYXJhbSBpZHMg5b6F5Yig6Zmk55qEaWTmlbDnu4RcclxuICAgKi9cclxuICBwdWJsaWMgYmF0Y2hEZWxldGUoaWRzOiBzdHJpbmdbXSk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICBjb25zdCBwYXJhbXMgPSB7XHJcbiAgICAgIGlkczogaWRzLmpvaW4oJywnKVxyXG4gICAgfTtcclxuICAgIGNvbnN0IHJlcXVlc3RDb25maWc6IEh0dHBSZXF1ZXN0Q29uZmlnID0ge1xyXG4gICAgICBwYXJhbXM6IHBhcmFtc1xyXG4gICAgfTtcclxuICAgIHJldHVybiB0aGlzLnJlcXVlc3QoSHR0cE1ldGhvZHMuREVMRVRFLCB0aGlzLmJhc2VVcmwsIHJlcXVlc3RDb25maWcpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5om56YeP5Yig6Zmk77yI5omp5bGV77yJXHJcbiAgICovXHJcbiAgcHVibGljIGV4dGVuZEJhdGNoRGVsZXRlKGlkczogc3RyaW5nW10pOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgY29uc3QgdXJsID0gYCR7dGhpcy5iYXNlVXJsfS9leHRlbnNpb24vYmF0Y2hkZWxldGVgO1xyXG4gICAgY29uc3QgcGFyYW1zID0ge1xyXG4gICAgICBpZHM6IGlkcy5qb2luKCcsJylcclxuICAgIH07XHJcbiAgICBjb25zdCByZXF1ZXN0Q29uZmlnOiBIdHRwUmVxdWVzdENvbmZpZyA9IHtcclxuICAgICAgcGFyYW1zOiBwYXJhbXNcclxuICAgIH07XHJcbiAgICByZXR1cm4gdGhpcy5yZXF1ZXN0KEh0dHBNZXRob2RzLlBVVCwgdXJsLCByZXF1ZXN0Q29uZmlnKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOWPlua2iFxyXG4gICAqL1xyXG4gIHB1YmxpYyBjYW5jZWwoKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgIGNvbnN0IHVybCA9IGAke3RoaXMuYmFzZVVybH0vc2VydmljZS9jYW5jZWxgO1xyXG4gICAgcmV0dXJuIHRoaXMucmVxdWVzdChIdHRwTWV0aG9kcy5QT1NULCB1cmwpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog6LCD55SoaHR0cGNsaWVudOWPluaVsFxyXG4gICAqIEBwYXJhbSB1cmwgdXJsXHJcbiAgICogQHBhcmFtIG1ldGhvZCBtZXRob2RzXHJcbiAgICogQHBhcmFtIHJlcXVlc3RDb25maWdzIG9wdGlvbnNcclxuICAgKi9cclxuICBwdWJsaWMgcmVxdWVzdChtZXRob2Q6IEh0dHBNZXRob2QsIHVybDogc3RyaW5nLCAgcmVxdWVzdENvbmZpZ3M/OiBIdHRwUmVxdWVzdENvbmZpZywgaWdub3JlSGFuZGxpbmdDaGFuZ2VzID0gZmFsc2UpIHtcclxuXHJcbiAgICByZXF1ZXN0Q29uZmlncyA9IHJlcXVlc3RDb25maWdzIHx8IHt9O1xyXG5cclxuICAgIC8vIOaJqeWxlWJvZHlcclxuICAgIGlmIChpZ25vcmVIYW5kbGluZ0NoYW5nZXMgIT09IHRydWUpIHtcclxuICAgICAgaWYgKG1ldGhvZCA9PT0gSHR0cE1ldGhvZHMuUE9TVCB8fCBtZXRob2QgPT09IEh0dHBNZXRob2RzLlBVVCB8fCBtZXRob2QgPT09IEh0dHBNZXRob2RzLlBBVENIKSB7XHJcbiAgICAgICAgY29uc3QgYm9keSA9IHJlcXVlc3RDb25maWdzLmJvZHkgfHwge307XHJcbiAgICAgICAgcmVxdWVzdENvbmZpZ3MuYm9keSA9IHRoaXMucHJveHlFeHRlbmQuZXh0ZW5kQm9keShib2R5KTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8vIOaJqeWxlWhlYWRlcnNcclxuICAgIGNvbnN0IGhlYWRlcnMkID0gdGhpcy5wcm94eUV4dGVuZC5leHRlbmRIZWFkZXJzKHJlcXVlc3RDb25maWdzLmhlYWRlcnMpO1xyXG5cclxuICAgIC8vIOWPkemAgeivt+axglxyXG4gICAgcmV0dXJuIGhlYWRlcnMkLnBpcGUoXHJcbiAgICAgIHN3aXRjaE1hcCgoaGVhZGVyczogSHR0cEhlYWRlcnMpID0+IHtcclxuICAgICAgICByZXF1ZXN0Q29uZmlncy5oZWFkZXJzID0gaGVhZGVycztcclxuICAgICAgICByZXF1ZXN0Q29uZmlncy5vYnNlcnZlID0gJ3Jlc3BvbnNlJztcclxuICAgICAgICByZXR1cm4gdGhpcy5odHRwQ2xpZW50LnJlcXVlc3QobWV0aG9kLCB1cmwsIHJlcXVlc3RDb25maWdzKS5waXBlKFxyXG4gICAgICAgICAgICBtYXAoKHJlc3VsdDogYW55KSA9PiB7XHJcbiAgICAgICAgICAgICAgaWYgKGlnbm9yZUhhbmRsaW5nQ2hhbmdlcyA9PT0gdHJ1ZSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdCAmJiByZXN1bHQuYm9keSAgJiYgcmVzdWx0LmJvZHkucmV0dXJuVmFsdWUgPyByZXN1bHQuYm9keS5yZXR1cm5WYWx1ZSA6IHJlc3VsdDtcclxuICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuICB0aGlzLnByb3h5RXh0ZW5kLm9uUmVzcG9uc2UocmVzdWx0KTtcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pLFxyXG4gICAgICAgICAgICBjYXRjaEVycm9yKChlcnJvcjogYW55KSA9PiB7XHJcbiAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucHJveHlFeHRlbmQub25FcnJvcihlcnJvciwgZmFsc2UsIGZhbHNlKTtcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICk7XHJcbiAgICAgIH0pLFxyXG4gICAgICBjYXRjaEVycm9yKChlcnJvcjogYW55KSA9PiB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMucHJveHlFeHRlbmQub25FcnJvcihlcnJvciwgZmFsc2UsIGZhbHNlKTtcclxuICAgICAgfSlcclxuICAgICk7XHJcbiAgfVxyXG5cclxufVxyXG4iXX0=
/**
 * @fileoverview added by tsickle
 * Generated from: lib/bef_entity_manager.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/*
 * @Author: Witt
 * @Date: 2019-03-07 17:24:38
 * @Last Modified by:   Witt
 * @Last Modified time: 2019-03-07 17:24:38
 */
import { EntityManager } from '@farris/mobile-devkit';
import { BefChangeBuilder } from './bef_change_builder';
import { BefChangeHandler } from './bef_change_handler';
/**
 * 实体管理类：管理Entity和
 * \@todo
 * 1、实体管理应该放在Devkit中；
 * 2、目前只是简单代码拆分，待进一步明确职责。
 * @template T
 */
class BefEntityManager extends EntityManager {
    /**
     * 构造函数
     * @param {?} entityCollection
     */
    constructor(entityCollection) {
        super(entityCollection);
        this.changeBuilder = new BefChangeBuilder(this.entityCollection.entityType, this.entityCollection);
        this.changeHandler = new BefChangeHandler();
    }
    /**
     * 获取数据变更
     * @return {?}
     */
    buildAllEntityChangeDetails() {
        /** @type {?} */
        const changeDetails = [];
        /** @type {?} */
        const entities = this.entityCollection.getAllEntities();
        entities.forEach((/**
         * @param {?} entity
         * @return {?}
         */
        (entity) => {
            if (entity.changes.length === 0) {
                return;
            }
            /** @type {?} */
            const changeDetail = this.changeBuilder.build(entity.changes);
            // 防止空id的变更被提交
            // @todo：此处判断应该放到更底层，临时修复Bug。
            if (changeDetail && changeDetail.ChangeInfo && changeDetail.ChangeInfo.DataId) {
                changeDetails.push(changeDetail);
            }
        }));
        return changeDetails;
    }
    /**
     * 获取单个实体
     * @param {?} id
     * @return {?}
     */
    buildEntityChangeDetailById(id) {
        /** @type {?} */
        const entity = this.entityCollection.getEntityById(id);
        if (entity.changes.length === 0) {
            return null;
        }
        /** @type {?} */
        const changeDetail = this.changeBuilder.build(entity.changes);
        return changeDetail;
    }
    /**
     * 应用数据变更
     * @param {?} changeDetails
     * @return {?}
     */
    handleDataChangeDetails(changeDetails) {
        this.changeHandler.handle(this.entityType, this.entityCollection, changeDetails);
    }
    // #endregion
    /**
     * 清空所有实体
     * @return {?}
     */
    reset() {
        this.entityCollection.clear();
    }
}
if (false) {
    /**
     * ChangeDetail构造器
     * @type {?}
     */
    BefEntityManager.prototype.changeBuilder;
    /**
     * ChangeDetail处理器
     * @type {?}
     */
    BefEntityManager.prototype.changeHandler;
}
export { BefEntityManager };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmVmX2VudGl0eV9tYW5hZ2VyLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy9tb2JpbGUtYmVmLyIsInNvdXJjZXMiOlsibGliL2JlZl9lbnRpdHlfbWFuYWdlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztBQU9BLE9BQU8sRUFBNEIsYUFBYSxFQUFFLE1BQU0sdUJBQXVCLENBQUM7QUFFaEYsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFDeEQsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0sc0JBQXNCLENBQUM7Ozs7Ozs7O0FBU3hELE1BQU0sZ0JBQW1DLFNBQVEsYUFBZ0I7Ozs7O0lBZS9ELFlBQVksZ0JBQXFDO1FBQy9DLEtBQUssQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO1FBQ3hCLElBQUksQ0FBQyxhQUFhLEdBQUcsSUFBSSxnQkFBZ0IsQ0FBQyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsVUFBVSxFQUFFLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO1FBQ25HLElBQUksQ0FBQyxhQUFhLEdBQUcsSUFBSSxnQkFBZ0IsRUFBRSxDQUFDO0lBQzlDLENBQUM7Ozs7O0lBS00sMkJBQTJCOztjQUMxQixhQUFhLEdBQW1CLEVBQUU7O2NBQ2xDLFFBQVEsR0FBRyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsY0FBYyxFQUFFO1FBQ3ZELFFBQVEsQ0FBQyxPQUFPOzs7O1FBQUMsQ0FBQyxNQUFjLEVBQUUsRUFBRTtZQUNsQyxJQUFJLE1BQU0sQ0FBQyxPQUFPLENBQUMsTUFBTSxLQUFLLENBQUMsRUFBRTtnQkFDL0IsT0FBTzthQUNSOztrQkFDSyxZQUFZLEdBQUcsSUFBSSxDQUFDLGFBQWEsQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQztZQUU3RCxjQUFjO1lBQ2QsNkJBQTZCO1lBQzdCLElBQUksWUFBWSxJQUFJLFlBQVksQ0FBQyxVQUFVLElBQUksWUFBWSxDQUFDLFVBQVUsQ0FBQyxNQUFNLEVBQUU7Z0JBQzdFLGFBQWEsQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUM7YUFDbEM7UUFDSCxDQUFDLEVBQUMsQ0FBQztRQUNILE9BQU8sYUFBYSxDQUFDO0lBQ3ZCLENBQUM7Ozs7OztJQUtNLDJCQUEyQixDQUFDLEVBQVU7O2NBQ3JDLE1BQU0sR0FBRyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsYUFBYSxDQUFDLEVBQUUsQ0FBQztRQUN0RCxJQUFJLE1BQU0sQ0FBQyxPQUFPLENBQUMsTUFBTSxLQUFLLENBQUMsRUFBRTtZQUMvQixPQUFPLElBQUksQ0FBQztTQUNiOztjQUNLLFlBQVksR0FBRyxJQUFJLENBQUMsYUFBYSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDO1FBQzdELE9BQU8sWUFBWSxDQUFDO0lBQ3RCLENBQUM7Ozs7OztJQUtNLHVCQUF1QixDQUFDLGFBQTZCO1FBQzFELElBQUksQ0FBQyxhQUFhLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxVQUFVLEVBQUUsSUFBSSxDQUFDLGdCQUFnQixFQUFFLGFBQWEsQ0FBQyxDQUFDO0lBQ25GLENBQUM7Ozs7OztJQU9NLEtBQUs7UUFDVixJQUFJLENBQUMsZ0JBQWdCLENBQUMsS0FBSyxFQUFFLENBQUM7SUFDaEMsQ0FBQztDQUVGOzs7Ozs7SUFqRUMseUNBQXVDOzs7OztJQUt2Qyx5Q0FBdUM7O0FBOER6QyxPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8qXHJcbiAqIEBBdXRob3I6IFdpdHRcclxuICogQERhdGU6IDIwMTktMDMtMDcgMTc6MjQ6MzhcclxuICogQExhc3QgTW9kaWZpZWQgYnk6ICAgV2l0dFxyXG4gKiBATGFzdCBNb2RpZmllZCB0aW1lOiAyMDE5LTAzLTA3IDE3OjI0OjM4XHJcbiAqL1xyXG5cclxuaW1wb3J0IHsgRW50aXR5LCBFbnRpdHlDb2xsZWN0aW9uLCBFbnRpdHlNYW5hZ2VyIH0gZnJvbSAnQGZhcnJpcy9tb2JpbGUtZGV2a2l0JztcclxuaW1wb3J0IHsgQ2hhbmdlRGV0YWlsfSBmcm9tICcuL3R5cGVzJztcclxuaW1wb3J0IHsgQmVmQ2hhbmdlQnVpbGRlciB9IGZyb20gJy4vYmVmX2NoYW5nZV9idWlsZGVyJztcclxuaW1wb3J0IHsgQmVmQ2hhbmdlSGFuZGxlciB9IGZyb20gJy4vYmVmX2NoYW5nZV9oYW5kbGVyJztcclxuXHJcblxyXG4vKipcclxuICog5a6e5L2T566h55CG57G777ya566h55CGRW50aXR55ZKMXHJcbiAqIEB0b2RvXHJcbiAqIDHjgIHlrp7kvZPnrqHnkIblupTor6XmlL7lnKhEZXZraXTkuK3vvJtcclxuICogMuOAgeebruWJjeWPquaYr+eugOWNleS7o+eggeaLhuWIhu+8jOW+hei/m+S4gOatpeaYjuehruiBjOi0o+OAglxyXG4gKi9cclxuY2xhc3MgQmVmRW50aXR5TWFuYWdlcjxUIGV4dGVuZHMgRW50aXR5PiBleHRlbmRzIEVudGl0eU1hbmFnZXI8VD4ge1xyXG5cclxuICAvKipcclxuICAgKiBDaGFuZ2VEZXRhaWzmnoTpgKDlmahcclxuICAgKi9cclxuICBwdWJsaWMgY2hhbmdlQnVpbGRlcjogQmVmQ2hhbmdlQnVpbGRlcjtcclxuXHJcbiAgLyoqXHJcbiAgICogQ2hhbmdlRGV0YWls5aSE55CG5ZmoXHJcbiAgICovXHJcbiAgcHVibGljIGNoYW5nZUhhbmRsZXI6IEJlZkNoYW5nZUhhbmRsZXI7XHJcblxyXG4gIC8qKlxyXG4gICAqIOaehOmAoOWHveaVsFxyXG4gICAqL1xyXG4gIGNvbnN0cnVjdG9yKGVudGl0eUNvbGxlY3Rpb246IEVudGl0eUNvbGxlY3Rpb248VD4pIHtcclxuICAgIHN1cGVyKGVudGl0eUNvbGxlY3Rpb24pO1xyXG4gICAgdGhpcy5jaGFuZ2VCdWlsZGVyID0gbmV3IEJlZkNoYW5nZUJ1aWxkZXIodGhpcy5lbnRpdHlDb2xsZWN0aW9uLmVudGl0eVR5cGUsIHRoaXMuZW50aXR5Q29sbGVjdGlvbik7XHJcbiAgICB0aGlzLmNoYW5nZUhhbmRsZXIgPSBuZXcgQmVmQ2hhbmdlSGFuZGxlcigpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog6I635Y+W5pWw5o2u5Y+Y5pu0XHJcbiAgICovXHJcbiAgcHVibGljIGJ1aWxkQWxsRW50aXR5Q2hhbmdlRGV0YWlscygpOiBDaGFuZ2VEZXRhaWxbXSB7XHJcbiAgICBjb25zdCBjaGFuZ2VEZXRhaWxzOiBDaGFuZ2VEZXRhaWxbXSA9IFtdO1xyXG4gICAgY29uc3QgZW50aXRpZXMgPSB0aGlzLmVudGl0eUNvbGxlY3Rpb24uZ2V0QWxsRW50aXRpZXMoKTtcclxuICAgIGVudGl0aWVzLmZvckVhY2goKGVudGl0eTogRW50aXR5KSA9PiB7XHJcbiAgICAgIGlmIChlbnRpdHkuY2hhbmdlcy5sZW5ndGggPT09IDApIHtcclxuICAgICAgICByZXR1cm47XHJcbiAgICAgIH1cclxuICAgICAgY29uc3QgY2hhbmdlRGV0YWlsID0gdGhpcy5jaGFuZ2VCdWlsZGVyLmJ1aWxkKGVudGl0eS5jaGFuZ2VzKTtcclxuXHJcbiAgICAgIC8vIOmYsuatouepumlk55qE5Y+Y5pu06KKr5o+Q5LqkXHJcbiAgICAgIC8vIEB0b2Rv77ya5q2k5aSE5Yik5pat5bqU6K+l5pS+5Yiw5pu05bqV5bGC77yM5Li05pe25L+u5aSNQnVn44CCXHJcbiAgICAgIGlmIChjaGFuZ2VEZXRhaWwgJiYgY2hhbmdlRGV0YWlsLkNoYW5nZUluZm8gJiYgY2hhbmdlRGV0YWlsLkNoYW5nZUluZm8uRGF0YUlkKSB7XHJcbiAgICAgICAgY2hhbmdlRGV0YWlscy5wdXNoKGNoYW5nZURldGFpbCk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgcmV0dXJuIGNoYW5nZURldGFpbHM7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDojrflj5bljZXkuKrlrp7kvZNcclxuICAgKi9cclxuICBwdWJsaWMgYnVpbGRFbnRpdHlDaGFuZ2VEZXRhaWxCeUlkKGlkOiBzdHJpbmcpOiBDaGFuZ2VEZXRhaWwge1xyXG4gICAgY29uc3QgZW50aXR5ID0gdGhpcy5lbnRpdHlDb2xsZWN0aW9uLmdldEVudGl0eUJ5SWQoaWQpO1xyXG4gICAgaWYgKGVudGl0eS5jaGFuZ2VzLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxuICAgIGNvbnN0IGNoYW5nZURldGFpbCA9IHRoaXMuY2hhbmdlQnVpbGRlci5idWlsZChlbnRpdHkuY2hhbmdlcyk7XHJcbiAgICByZXR1cm4gY2hhbmdlRGV0YWlsO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5bqU55So5pWw5o2u5Y+Y5pu0XHJcbiAgICovXHJcbiAgcHVibGljIGhhbmRsZURhdGFDaGFuZ2VEZXRhaWxzKGNoYW5nZURldGFpbHM6IENoYW5nZURldGFpbFtdKTogdm9pZCB7XHJcbiAgICB0aGlzLmNoYW5nZUhhbmRsZXIuaGFuZGxlKHRoaXMuZW50aXR5VHlwZSwgdGhpcy5lbnRpdHlDb2xsZWN0aW9uLCBjaGFuZ2VEZXRhaWxzKTtcclxuICB9XHJcblxyXG4gIC8vICNlbmRyZWdpb25cclxuXHJcbiAgLyoqXHJcbiAgICog5riF56m65omA5pyJ5a6e5L2TXHJcbiAgICovXHJcbiAgcHVibGljIHJlc2V0KCkge1xyXG4gICAgdGhpcy5lbnRpdHlDb2xsZWN0aW9uLmNsZWFyKCk7XHJcbiAgfVxyXG5cclxufVxyXG5cclxuZXhwb3J0IHsgQmVmRW50aXR5TWFuYWdlciB9O1xyXG4iXX0=
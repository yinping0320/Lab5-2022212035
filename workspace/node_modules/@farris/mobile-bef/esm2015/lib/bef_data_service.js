/**
 * @fileoverview added by tsickle
 * Generated from: lib/bef_data_service.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { of, zip, EMPTY } from 'rxjs';
import { tap, map, switchMap } from 'rxjs/operators';
import { DataChangeType, } from '@farris/mobile-devkit';
/**
 * Bef数据访问服务
 * @template T
 */
class BefDataService {
    /**
     * 构造函数
     * @param {?} repository
     */
    constructor(repository) {
        this.repository = repository;
    }
    /**
     * Api代理类
     * @private
     * @return {?}
     */
    get apiProxy() {
        return this.repository.apiProxy;
    }
    /**
     * 获取实体集合
     * @param {?} filter
     * @param {?} sort
     * @param {?} pageSize
     * @param {?} pageIndex
     * @return {?}
     */
    getList(filter, sort, pageSize, pageIndex) {
        /** @type {?} */
        const entityFilter = this.buildEntityFilter(filter, sort, pageSize, pageIndex);
        /** @type {?} */
        const query$ = this.apiProxy.extendQuery(entityFilter);
        /** @type {?} */
        const result$ = query$.pipe(map((/**
         * @param {?} returnValue
         * @return {?}
         */
        (returnValue) => {
            this.repository.setPaginationInfo(((/** @type {?} */ (returnValue))).pagination);
            /** @type {?} */
            const listData = ((/** @type {?} */ (returnValue))).result;
            /** @type {?} */
            const entities = this.repository.buildEntities(listData);
            if (this.determineIsAppend(pageIndex)) {
                this.repository.entityCollection.addEntities(entities);
            }
            else {
                this.repository.entityCollection.loadEntities(entities);
            }
            return entities;
        })));
        return result$;
    }
    /**
     * 根据当前页判断是否追加
     * @param {?} pageIndex
     * @return {?}
     */
    determineIsAppend(pageIndex) {
        return pageIndex > 1;
    }
    /**
     * 获取单个实体
     * @param {?} id
     * @return {?}
     */
    getById(id) {
        /** @type {?} */
        const retrieve$ = this.apiProxy.extendRetrieve(id);
        /** @type {?} */
        const result$ = retrieve$.pipe(map((/**
         * @param {?} returnValue
         * @return {?}
         */
        (returnValue) => {
            /** @type {?} */
            const entityData = returnValue;
            /** @type {?} */
            const entity = this.repository.buildEntity(entityData);
            this.repository.entityCollection.loadEntities([entity]);
            return entity;
        })));
        return result$;
    }
    /**
     * 更新并对实体加锁
     * @param {?} id
     * @return {?}
     */
    editById(id) {
        /** @type {?} */
        const entity = this.repository.entityCollection.getEntityById(id);
        if (!entity) {
            return of(null);
        }
        /** @type {?} */
        const retrieve$ = this.apiProxy.edit(id);
        /** @type {?} */
        const result$ = retrieve$.pipe(map((/**
         * @param {?} returnValue
         * @return {?}
         */
        (returnValue) => {
            /** @type {?} */
            const entityData = returnValue.data;
            /** @type {?} */
            const entityToUpdate = this.repository.entityCollection.getEntityById(id);
            if (entityToUpdate && entityData) {
                this.reloadEntityData(entityToUpdate, entityData);
            }
            return entityToUpdate;
        })));
        return result$;
    }
    /**
     * 根据id更新实体
     * @param {?} id 实体id
     * @return {?}
     */
    updateById(id) {
        /** @type {?} */
        const entity = this.repository.entityCollection.getEntityById(id);
        if (!entity) {
            return EMPTY;
        }
        /** @type {?} */
        const retrieve$ = this.apiProxy.extendRetrieve(id);
        /** @type {?} */
        const result$ = retrieve$.pipe(map((/**
         * @param {?} returnValue
         * @return {?}
         */
        (returnValue) => {
            /** @type {?} */
            const entityData = returnValue;
            /** @type {?} */
            const entityToUpdate = this.repository.entityCollection.getEntityById(id);
            this.reloadEntityData(entityToUpdate, entityData);
            return entityToUpdate;
        })));
        return result$;
    }
    /**
     * 重新加载实体数据
     * @private
     * @param {?} entity
     * @param {?} entityData
     * @return {?}
     */
    reloadEntityData(entity, entityData) {
        if (!entity) {
            return;
        }
        entity.load(entityData);
        entity.changes.splice(0, entity.changes.length);
    }
    /**
     * 创建新实体，并加载
     * @param {?=} defaultValue
     * @return {?}
     */
    create(defaultValue) {
        /** @type {?} */
        const result$ = this.apiProxy.create(defaultValue);
        return result$.pipe(map((/**
         * @param {?} returnValue
         * @return {?}
         */
        (returnValue) => {
            /** @type {?} */
            const newEntityData = returnValue;
            /** @type {?} */
            const newEntity = this.repository.buildEntity(newEntityData);
            this.repository.entityCollection.loadEntities([newEntity]);
            this.repository.dataChangeHistory.addChange({ dataId: newEntity.primaryValue, changeType: DataChangeType.Add });
            return newEntity;
        })));
    }
    /**
     * 追加实体
     * @param {?=} defaultValue
     * @return {?}
     */
    append(defaultValue) {
        /** @type {?} */
        const append$ = this.apiProxy.create(defaultValue);
        return append$.pipe(map((/**
         * @param {?} returnValue
         * @return {?}
         */
        (returnValue) => {
            /** @type {?} */
            const newEntityData = returnValue;
            /** @type {?} */
            const newEntity = this.repository.buildEntity(newEntityData);
            this.repository.entityCollection.addEntity(newEntity);
            return newEntity;
        })));
    }
    /**
     * 创建子实体，并追加
     * @param {?} fpath 父路径，格式形如：/1/edus（从表）或/1/edus/2/grades（从从表）
     * @return {?}
     */
    appendByPath(fpath) {
        /** @type {?} */
        const append$ = this.apiProxy.createByPath(fpath);
        return append$.pipe(map((/**
         * @param {?} returnValue
         * @return {?}
         */
        (returnValue) => {
            /** @type {?} */
            const newEntityData = returnValue;
            /** @type {?} */
            const newEntity = this.repository.entityManager.appendEntityByPath(fpath, newEntityData, newEntityData);
            return newEntity;
        })));
    }
    /**
     * 根据id删除实体
     * @param {?} id 内码
     * @param {?=} ifSave
     * @return {?}
     */
    removeById(id, ifSave) {
        ifSave = (ifSave === undefined) ? true : ifSave;
        /** @type {?} */
        const delete$ = this.apiProxy.extendDelete(id);
        // 从本地实体集合中移除
        return delete$.pipe(switchMap((/**
         * @return {?}
         */
        () => {
            // 执行保存
            if (ifSave === true) {
                return this.applyChangesById(id).pipe(tap((/**
                 * @param {?} result
                 * @return {?}
                 */
                result => {
                    if (result) {
                        this.repository.entityCollection.removeEntityById(id);
                    }
                })));
            }
            else {
                // 从实体集合中删除
                this.repository.entityCollection.removeEntityById(id);
                this.repository.dataChangeHistory.addChange({ dataId: id, changeType: DataChangeType.Delete });
                return of(true);
            }
        })));
    }
    /**
     * 删除并保存
     * @param {?} id 要删除的实体id
     * @return {?}
     */
    removeAndSaveById(id) {
        /** @type {?} */
        const delete$ = this.apiProxy.deleteAndSave(id);
        /** @type {?} */
        const result$ = delete$.pipe(switchMap((/**
         * @return {?}
         */
        () => {
            this.repository.entityCollection.removeEntityById(id);
            return of(true);
        })));
        return result$;
    }
    /**
     * 批量删除
     * @param {?} ids
     * @return {?}
     */
    removeByIds(ids) {
        // 服务器端删除
        /** @type {?} */
        const delete$ = this.apiProxy.extendBatchDelete(ids);
        // 从本地实体集合中移除
        return delete$.pipe(switchMap((/**
         * @return {?}
         */
        () => {
            // 执行保存
            return this.applyChangesByIdArray(ids).pipe(tap((/**
             * @param {?} result
             * @return {?}
             */
            result => {
                if (result) {
                    // 从实体集合中删除
                    this.repository.entityCollection.removeEntities((/**
                     * @param {?} value
                     * @return {?}
                     */
                    (value) => {
                        return this.checkEntityValueExists(value, ids);
                    }));
                }
            })));
        })));
    }
    /**
     * 检测实体的主键值是否存在于数组中，如果存在返回true
     * @private
     * @param {?} entity
     * @param {?} primaryValueArray
     * @return {?}
     */
    checkEntityValueExists(entity, primaryValueArray) {
        /** @type {?} */
        let isExistInTargetArray = false;
        for (let i = 0; i < primaryValueArray.length; i++) {
            if (entity.primaryValue === primaryValueArray[i]) {
                isExistInTargetArray = true;
                break;
            }
        }
        return isExistInTargetArray;
    }
    /**
     * 删除子级
     * @param {?} fpath
     * @param {?} id   内码
     * @return {?}
     */
    removeByPath(fpath, id) {
        /** @type {?} */
        const delete$ = this.apiProxy.extendDeletByPath(fpath, id);
        // 从本地实体集合中移除
        return delete$.pipe(map((/**
         * @return {?}
         */
        () => {
            this.repository.entityManager.removeEntityByPath(fpath, id);
            this.repository.dataChangeHistory.addChange({ fpath, dataId: id, changeType: DataChangeType.Delete });
            return true;
        })));
    }
    /**
     * 将id对应的实体的变更提交的服务器端
     * @param {?} id
     * @return {?}
     */
    updateChangesById(id) {
        /** @type {?} */
        const entity = this.repository.entityCollection.getEntityById(id);
        // 变更集为空
        if (!entity.changes || entity.changes.length === 0) {
            return of(true);
        }
        /** @type {?} */
        const changeDetail = this.repository.entityManager.buildEntityChangeDetailById(id);
        /** @type {?} */
        const update$ = this.apiProxy.update(changeDetail);
        /** @type {?} */
        const result$ = update$.pipe(tap((/**
         * @return {?}
         */
        () => {
            this.repository.entityManager.clearEntityChangesById(id);
        })), map((/**
         * @return {?}
         */
        () => {
            return true;
        })));
        return result$;
    }
    /**
     * 提交所有变更
     * @return {?}
     */
    updateAllChanges() {
        // 遍历实体，提交变更
        /** @type {?} */
        const updateResults = [];
        /** @type {?} */
        const entities = this.repository.entityCollection.toArray();
        if (entities.length === 0) {
            return of(true);
        }
        entities.forEach((/**
         * @param {?} entity
         * @return {?}
         */
        (entity) => {
            /** @type {?} */
            const updateResult$ = this.updateChangesById(entity.primaryValue);
            updateResults.push(updateResult$);
        }));
        // 串联流
        /** @type {?} */
        const result$ = zip(...updateResults).pipe(map((/**
         * @return {?}
         */
        () => {
            return true;
        })));
        return result$;
    }
    /**
     * 应用变更
     * @return {?}
     */
    applyChanges() {
        /** @type {?} */
        const save$ = this.apiProxy.save();
        /** @type {?} */
        const result$ = save$.pipe(tap((/**
         * @return {?}
         */
        () => {
            this.repository.entityManager.clearAllEntityChanges();
            this.repository.dataChangeHistory.clear();
        })), map((/**
         * @return {?}
         */
        () => {
            return true;
        })));
        return result$;
    }
    /**
     * 应用idArray对应数据的变更
     * @param {?} ids
     * @return {?}
     */
    applyChangesByIdArray(ids) {
        /** @type {?} */
        const save$ = this.apiProxy.save();
        /** @type {?} */
        const result$ = save$.pipe(tap((/**
         * @return {?}
         */
        () => {
            this.repository.entityManager.clearEntityChangesByIds(ids);
            this.repository.dataChangeHistory.clearByIds(ids);
        })), map((/**
         * @return {?}
         */
        () => {
            return true;
        })));
        return result$;
    }
    /**
     * 应用id对应数据的变更
     * @param {?} id
     * @return {?}
     */
    applyChangesById(id) {
        /** @type {?} */
        const save$ = this.apiProxy.save();
        /** @type {?} */
        const result$ = save$.pipe(tap((/**
         * @return {?}
         */
        () => {
            this.repository.entityManager.clearEntityChangesById(id);
            this.repository.dataChangeHistory.clearByIds([id]);
        })), map((/**
         * @return {?}
         */
        () => {
            return true;
        })));
        return result$;
    }
    /**
     * 取消变更
     * @return {?}
     */
    cancelChanges() {
        /** @type {?} */
        const cancel$ = this.apiProxy.cancel();
        /** @type {?} */
        const result$ = cancel$.pipe(tap((/**
         * @return {?}
         */
        () => {
            this.repository.entityManager.clearAllEntityChanges();
            this.repository.dataChangeHistory.clear();
        })), map((/**
         * @return {?}
         */
        () => {
            return true;
        })));
        return result$;
    }
    /**
     * 构造EntityFilter
     * @private
     * @param {?} filter
     * @param {?} sort
     * @param {?} pageSize
     * @param {?} pageIndex
     * @return {?}
     */
    buildEntityFilter(filter, sort, pageSize, pageIndex) {
        /** @type {?} */
        const entityFilter = {
            FilterConditions: filter,
            SortConditions: sort,
            IsUsePagination: pageSize === 0 ? false : true,
            Pagination: {
                PageIndex: pageIndex,
                PageSize: pageSize,
                PageCount: 0,
                TotalCount: 0
            }
        };
        return entityFilter;
    }
}
if (false) {
    /**
     * 实体仓库
     * @type {?}
     * @private
     */
    BefDataService.prototype.repository;
}
export { BefDataService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmVmX2RhdGFfc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvbW9iaWxlLWJlZi8iLCJzb3VyY2VzIjpbImxpYi9iZWZfZGF0YV9zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsT0FBTyxFQUFjLEVBQUUsRUFBRSxHQUFHLEVBQUUsS0FBSyxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQ2xELE9BQU8sRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLFNBQVMsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ3JELE9BQU8sRUFBVSxjQUFjLEdBQUcsTUFBTSx1QkFBdUIsQ0FBQzs7Ozs7QUFTaEUsTUFBTSxjQUFjOzs7OztJQWlCbEIsWUFBWSxVQUE0QjtRQUN0QyxJQUFJLENBQUMsVUFBVSxHQUFHLFVBQVUsQ0FBQztJQUMvQixDQUFDOzs7Ozs7SUFURCxJQUFZLFFBQVE7UUFDbEIsT0FBTyxJQUFJLENBQUMsVUFBVSxDQUFDLFFBQVEsQ0FBQztJQUNsQyxDQUFDOzs7Ozs7Ozs7SUFZTSxPQUFPLENBQUMsTUFBYSxFQUFFLElBQVcsRUFBRSxRQUF1QixFQUFFLFNBQXdCOztjQUNwRixZQUFZLEdBQUcsSUFBSSxDQUFDLGlCQUFpQixDQUFDLE1BQU0sRUFBRSxJQUFJLEVBQUUsUUFBUSxFQUFFLFNBQVMsQ0FBQzs7Y0FDeEUsTUFBTSxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsV0FBVyxDQUFDLFlBQVksQ0FBQzs7Y0FDaEQsT0FBTyxHQUFHLE1BQU0sQ0FBQyxJQUFJLENBQ3pCLEdBQUc7Ozs7UUFBQyxDQUFDLFdBQWdCLEVBQUUsRUFBRTtZQUN2QixJQUFJLENBQUMsVUFBVSxDQUFDLGlCQUFpQixDQUFDLENBQUMsbUJBQUEsV0FBVyxFQUFlLENBQUMsQ0FBQyxVQUFVLENBQUMsQ0FBQTs7a0JBQ3BFLFFBQVEsR0FBRyxDQUFDLG1CQUFBLFdBQVcsRUFBZSxDQUFDLENBQUMsTUFBTTs7a0JBQzlDLFFBQVEsR0FBRyxJ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QUFRLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLElBQUk7WUFDOUMsVUFBVSxFQUFFO2dCQUNWLFNBQVMsRUFBRSxTQUFTO2dCQUNwQixRQUFRLEVBQUUsUUFBUTtnQkFDbEIsU0FBUyxFQUFFLENBQUM7Z0JBQ1osVUFBVSxFQUFFLENBQUM7YUFDZDtTQUNGO1FBRUQsT0FBTyxZQUFZLENBQUM7SUFDdEIsQ0FBQztDQUNGOzs7Ozs7O0lBbmFDLG9DQUFxQzs7QUFxYXZDLE9BQU8sRUFBRSxjQUFjLEVBQUUsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE9ic2VydmFibGUsIG9mLCB6aXAsIEVNUFRZIH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7IHRhcCwgbWFwLCBzd2l0Y2hNYXAgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XHJcbmltcG9ydCB7IEVudGl0eSwgRGF0YUNoYW5nZVR5cGUsIH0gZnJvbSAnQGZhcnJpcy9tb2JpbGUtZGV2a2l0JztcclxuXHJcbmltcG9ydCB7IFF1ZXJ5UmVzdWx0IH0gZnJvbSAnLi90eXBlcyc7XHJcbmltcG9ydCB7IEJlZlJlcG9zaXRvcnkgfSBmcm9tICcuL2JlZl9yZXBvc2l0b3J5JztcclxuaW1wb3J0IHsgQmVmUHJveHkgfSBmcm9tICcuL2JlZl9wcm94eSc7XHJcblxyXG4vKipcclxuICogQmVm5pWw5o2u6K6/6Zeu5pyN5YqhXHJcbiAqL1xyXG5jbGFzcyBCZWZEYXRhU2VydmljZTxUIGV4dGVuZHMgRW50aXR5PiB7XHJcblxyXG4gIC8qKlxyXG4gICAqIOWunuS9k+S7k+W6k1xyXG4gICAqL1xyXG4gIHByaXZhdGUgcmVwb3NpdG9yeTogQmVmUmVwb3NpdG9yeTxUPjtcclxuXHJcbiAgLyoqXHJcbiAgICogQXBp5Luj55CG57G7XHJcbiAgICovXHJcbiAgcHJpdmF0ZSBnZXQgYXBpUHJveHkoKTogQmVmUHJveHkge1xyXG4gICAgcmV0dXJuIHRoaXMucmVwb3NpdG9yeS5hcGlQcm94eTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOaehOmAoOWHveaVsFxyXG4gICAqL1xyXG4gIGNvbnN0cnVjdG9yKHJlcG9zaXRvcnk6IEJlZlJlcG9zaXRvcnk8VD4pIHtcclxuICAgIHRoaXMucmVwb3NpdG9yeSA9IHJlcG9zaXRvcnk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDojrflj5blrp7kvZPpm4blkIhcclxuICAgKi9cclxuICBwdWJsaWMgZ2V0TGlzdChmaWx0ZXI6IGFueVtdLCBzb3J0OiBhbnlbXSwgcGFnZVNpemU6IG51bWJlciB8IG51bGwsIHBhZ2VJbmRleDogbnVtYmVyIHwgbnVsbCk6IE9ic2VydmFibGU8VFtdPiB7XHJcbiAgICBjb25zdCBlbnRpdHlGaWx0ZXIgPSB0aGlzLmJ1aWxkRW50aXR5RmlsdGVyKGZpbHRlciwgc29ydCwgcGFnZVNpemUsIHBhZ2VJbmRleCk7XHJcbiAgICBjb25zdCBxdWVyeSQgPSB0aGlzLmFwaVByb3h5LmV4dGVuZFF1ZXJ5KGVudGl0eUZpbHRlcik7XHJcbiAgICBjb25zdCByZXN1bHQkID0gcXVlcnkkLnBpcGUoXHJcbiAgICAgIG1hcCgocmV0dXJuVmFsdWU6IGFueSkgPT4ge1xyXG4gICAgICAgIHRoaXMucmVwb3NpdG9yeS5zZXRQYWdpbmF0aW9uSW5mbygocmV0dXJuVmFsdWUgYXMgUXVlcnlSZXN1bHQpLnBhZ2luYXRpb24pXHJcbiAgICAgICAgY29uc3QgbGlzdERhdGEgPSAocmV0dXJuVmFsdWUgYXMgUXVlcnlSZXN1bHQpLnJlc3VsdDtcclxuICAgICAgICBjb25zdCBlbnRpdGllcyA9IHRoaXMucmVwb3NpdG9yeS5idWlsZEVudGl0aWVzKGxpc3REYXRhKTtcclxuICAgICAgICBpZiAodGhpcy5kZXRlcm1pbmVJc0FwcGVuZChwYWdlSW5kZXgpKSB7XHJcbiAgICAgICAgICB0aGlzLnJlcG9zaXRvcnkuZW50aXR5Q29sbGVjdGlvbi5hZGRFbnRpdGllcyhlbnRpdGllcyk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHRoaXMucmVwb3NpdG9yeS5lbnRpdHlDb2xsZWN0aW9uLmxvYWRFbnRpdGllcyhlbnRpdGllcyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBlbnRpdGllcztcclxuICAgICAgfSlcclxuICAgICk7XHJcblxyXG4gICAgcmV0dXJuIHJlc3VsdCQ7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDmoLnmja7lvZPliY3pobXliKTmlq3mmK/lkKbov73liqBcclxuICAgKi9cclxuICBkZXRlcm1pbmVJc0FwcGVuZChwYWdlSW5kZXg6IG51bWJlcik6IGJvb2xlYW4ge1xyXG4gICAgcmV0dXJuIHBhZ2VJbmRleCA+IDFcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOiOt+WPluWNleS4quWunuS9k1xyXG4gICAqL1xyXG4gIHB1YmxpYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBPYnNlcnZhYmxlPFQ+IHtcclxuICAgIGNvbnN0IHJldHJpZXZlJCA9IHRoaXMuYXBpUHJveHkuZXh0ZW5kUmV0cmlldmUoaWQpO1xyXG4gICAgY29uc3QgcmVzdWx0JCA9IHJldHJpZXZlJC5waXBlKFxyXG4gICAgICBtYXAoKHJldHVyblZhbHVlOiBhbnkpID0+IHtcclxuICAgICAgICBjb25zdCBlbnRpdHlEYXRhID0gcmV0dXJuVmFsdWU7XHJcbiAgICAgICAgY29uc3QgZW50aXR5ID0gdGhpcy5yZXBvc2l0b3J5LmJ1aWxkRW50aXR5KGVudGl0eURhdGEpO1xyXG4gICAgICAgIHRoaXMucmVwb3NpdG9yeS5lbnRpdHlDb2xsZWN0aW9uLmxvYWRFbnRpdGllcyhbZW50aXR5XSk7XHJcbiAgICAgICAgcmV0dXJuIGVudGl0eTtcclxuICAgICAgfSlcclxuICAgICk7XHJcblxyXG4gICAgcmV0dXJuIHJlc3VsdCQ7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDmm7TmlrDlubblr7nlrp7kvZPliqDplIFcclxuICAgKi9cclxuICBwdWJsaWMgZWRpdEJ5SWQoaWQ6IHN0cmluZyk6IE9ic2VydmFibGU8VD4ge1xyXG4gICAgY29uc3QgZW50aXR5ID0gdGhpcy5yZXBvc2l0b3J5LmVudGl0eUNvbGxlY3Rpb24uZ2V0RW50aXR5QnlJZChpZCk7XHJcbiAgICBpZiAoIWVudGl0eSkge1xyXG4gICAgICByZXR1cm4gb2YobnVsbCk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgcmV0cmlldmUkID0gdGhpcy5hcGlQcm94eS5lZGl0KGlkKTtcclxuICAgIGNvbnN0IHJlc3VsdCQgPSByZXRyaWV2ZSQucGlwZShcclxuICAgICAgbWFwKChyZXR1cm5WYWx1ZTogYW55KSA9PiB7XHJcbiAgICAgICAgY29uc3QgZW50aXR5RGF0YSA9IHJldHVyblZhbHVlLmRhdGE7XHJcbiAgICAgICAgY29uc3QgZW50aXR5VG9VcGRhdGUgPSB0aGlzLnJlcG9zaXRvcnkuZW50aXR5Q29sbGVjdGlvbi5nZXRFbnRpdHlCeUlkKGlkKTtcclxuICAgICAgICBpZiAoZW50aXR5VG9VcGRhdGUgJiYgZW50aXR5RGF0YSkge1xyXG4gICAgICAgICAgdGhpcy5yZWxvYWRFbnRpdHlEYXRhKGVudGl0eVRvVXBkYXRlLCBlbnRpdHlEYXRhKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGVudGl0eVRvVXBkYXRlO1xyXG4gICAgICB9KVxyXG4gICAgKTtcclxuXHJcbiAgICByZXR1cm4gcmVzdWx0JDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOagueaNrmlk5pu05paw5a6e5L2TXHJcbiAgICogQHBhcmFtIGlkIOWunuS9k2lkXHJcbiAgICovXHJcbiAgcHVibGljIHVwZGF0ZUJ5SWQoaWQ6IHN0cmluZyk6IE9ic2VydmFibGU8VD4ge1xyXG4gICAgY29uc3QgZW50aXR5ID0gdGhpcy5yZXBvc2l0b3J5LmVudGl0eUNvbGxlY3Rpb24uZ2V0RW50aXR5QnlJZChpZCk7XHJcbiAgICBpZiAoIWVudGl0eSkge1xyXG4gICAgICByZXR1cm4gRU1QVFk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgcmV0cmlldmUkID0gdGhpcy5hcGlQcm94eS5leHRlbmRSZXRyaWV2ZShpZCk7XHJcbiAgICBjb25zdCByZXN1bHQkID0gcmV0cmlldmUkLnBpcGUoXHJcbiAgICAgIG1hcCgocmV0dXJuVmFsdWU6IGFueSkgPT4ge1xyXG4gICAgICAgIGNvbnN0IGVudGl0eURhdGEgPSByZXR1cm5WYWx1ZTtcclxuICAgICAgICBjb25zdCBlbnRpdHlUb1VwZGF0ZSA9IHRoaXMucmVwb3NpdG9yeS5lbnRpdHlDb2xsZWN0aW9uLmdldEVudGl0eUJ5SWQoaWQpO1xyXG4gICAgICAgIHRoaXMucmVsb2FkRW50aXR5RGF0YShlbnRpdHlUb1VwZGF0ZSwgZW50aXR5RGF0YSk7XHJcbiAgICAgICAgcmV0dXJuIGVudGl0eVRvVXBkYXRlO1xyXG4gICAgICB9KVxyXG4gICAgKTtcclxuXHJcbiAgICByZXR1cm4gcmVzdWx0JDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOmHjeaWsOWKoOi9veWunuS9k+aVsOaNrlxyXG4gICAqL1xyXG4gIHByaXZhdGUgcmVsb2FkRW50aXR5RGF0YShlbnRpdHk6IEVudGl0eSwgZW50aXR5RGF0YTogYW55KTogdm9pZCB7XHJcbiAgICBpZiAoIWVudGl0eSkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBlbnRpdHkubG9hZChlbnRpdHlEYXRhKTtcclxuICAgIGVudGl0eS5jaGFuZ2VzLnNwbGljZSgwLCBlbnRpdHkuY2hhbmdlcy5sZW5ndGgpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5Yib5bu65paw5a6e5L2T77yM5bm25Yqg6L29XHJcbiAgICovXHJcbiAgcHVibGljIGNyZWF0ZShkZWZhdWx0VmFsdWU/OiBhbnkpIHtcclxuICAgIGNvbnN0IHJlc3VsdCQgPSB0aGlzLmFwaVByb3h5LmNyZWF0ZShkZWZhdWx0VmFsdWUpO1xyXG4gICAgcmV0dXJuIHJlc3VsdCQucGlwZShcclxuICAgICAgbWFwKChyZXR1cm5WYWx1ZTogYW55KSA9PiB7XHJcbiAgICAgICAgY29uc3QgbmV3RW50aXR5RGF0YSA9IHJldHVyblZhbHVlO1xyXG4gICAgICAgIGNvbnN0IG5ld0VudGl0eSA9IHRoaXMucmVwb3NpdG9yeS5idWlsZEVudGl0eShuZXdFbnRpdHlEYXRhKTtcclxuICAgICAgICB0aGlzLnJlcG9zaXRvcnkuZW50aXR5Q29sbGVjdGlvbi5sb2FkRW50aXRpZXMoW25ld0VudGl0eV0pO1xyXG4gICAgICAgIHRoaXMucmVwb3NpdG9yeS5kYXRhQ2hhbmdlSGlzdG9yeS5hZGRDaGFuZ2UoeyBkYXRhSWQ6IG5ld0VudGl0eS5wcmltYXJ5VmFsdWUsIGNoYW5nZVR5cGU6IERhdGFDaGFuZ2VUeXBlLkFkZCB9KTtcclxuICAgICAgICByZXR1cm4gbmV3RW50aXR5O1xyXG4gICAgICB9KVxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOi/veWKoOWunuS9k1xyXG4gICAqL1xyXG4gIHB1YmxpYyBhcHBlbmQoZGVmYXVsdFZhbHVlPzogYW55KTogT2JzZXJ2YWJsZTxUPiB7XHJcbiAgICBjb25zdCBhcHBlbmQkID0gdGhpcy5hcGlQcm94eS5jcmVhdGUoZGVmYXVsdFZhbHVlKTtcclxuICAgIHJldHVybiBhcHBlbmQkLnBpcGUoXHJcbiAgICAgIG1hcCgocmV0dXJuVmFsdWU6IGFueSkgPT4ge1xyXG4gICAgICAgIGNvbnN0IG5ld0VudGl0eURhdGEgPSByZXR1cm5WYWx1ZTtcclxuICAgICAgICBjb25zdCBuZXdFbnRpdHkgPSB0aGlzLnJlcG9zaXRvcnkuYnVpbGRFbnRpdHkobmV3RW50aXR5RGF0YSk7XHJcbiAgICAgICAgdGhpcy5yZXBvc2l0b3J5LmVudGl0eUNvbGxlY3Rpb24uYWRkRW50aXR5KG5ld0VudGl0eSk7XHJcbiAgICAgICAgcmV0dXJuIG5ld0VudGl0eTtcclxuICAgICAgfSlcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDliJvlu7rlrZDlrp7kvZPvvIzlubbov73liqBcclxuICAgKiBAcGFyYW0gZnBhdGgg54i26Lev5b6E77yM5qC85byP5b2i5aaC77yaLzEvZWR1c++8iOS7juihqO+8ieaIli8xL2VkdXMvMi9ncmFkZXPvvIjku47ku47ooajvvIlcclxuICAgKi9cclxuICBwdWJsaWMgYXBwZW5kQnlQYXRoKGZwYXRoOiBzdHJpbmcpOiBPYnNlcnZhYmxlPEVudGl0eT4ge1xyXG4gICAgY29uc3QgYXBwZW5kJCA9IHRoaXMuYXBpUHJveHkuY3JlYXRlQnlQYXRoKGZwYXRoKTtcclxuICAgIHJldHVybiBhcHBlbmQkLnBpcGUoXHJcbiAgICAgIG1hcCgocmV0dXJuVmFsdWU6IGFueSkgPT4ge1xyXG4gICAgICAgIGNvbnN0IG5ld0VudGl0eURhdGEgPSByZXR1cm5WYWx1ZTtcclxuICAgICAgICBjb25zdCBuZXdFbnRpdHkgPSB0aGlzLnJlcG9zaXRvcnkuZW50aXR5TWFuYWdlci5hcHBlbmRFbnRpdHlCeVBhdGgoZnBhdGgsIG5ld0VudGl0eURhdGEsIG5ld0VudGl0eURhdGEpO1xyXG4gICAgICAgIHJldHVybiBuZXdFbnRpdHk7XHJcbiAgICAgIH0pXHJcbiAgICApO1xyXG4gIH1cclxuXHJcblxyXG4gIC8qKlxyXG4gICAqIOagueaNrmlk5Yig6Zmk5a6e5L2TXHJcbiAgICogQHBhcmFtIGlkIOWGheeggVxyXG4gICAqL1xyXG4gIHB1YmxpYyByZW1vdmVCeUlkKGlkOiBzdHJpbmcsIGlmU2F2ZT86IGJvb2xlYW4pOiBPYnNlcnZhYmxlPGJvb2xlYW4+IHtcclxuXHJcbiAgICBpZlNhdmUgPSAoaWZTYXZlID09PSB1bmRlZmluZWQpID8gdHJ1ZSA6IGlmU2F2ZTtcclxuICAgIGNvbnN0IGRlbGV0ZSQgPSB0aGlzLmFwaVByb3h5LmV4dGVuZERlbGV0ZShpZCk7XHJcblxyXG4gICAgLy8g5LuO5pys5Zyw5a6e5L2T6ZuG5ZCI5Lit56e76ZmkXHJcbiAgICByZXR1cm4gZGVsZXRlJC5waXBlKFxyXG4gICAgICBzd2l0Y2hNYXAoKCkgPT4ge1xyXG4gICAgICAgIC8vIOaJp+ihjOS/neWtmFxyXG4gICAgICAgIGlmIChpZlNhdmUgPT09IHRydWUpIHtcclxuICAgICAgICAgIHJldHVybiB0aGlzLmFwcGx5Q2hhbmdlc0J5SWQoaWQpLnBpcGUodGFwKHJlc3VsdCA9PiB7XHJcbiAgICAgICAgICAgIGlmIChyZXN1bHQpIHtcclxuICAgICAgICAgICAgICB0aGlzLnJlcG9zaXRvcnkuZW50aXR5Q29sbGVjdGlvbi5yZW1vdmVFbnRpdHlCeUlkKGlkKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfSkpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcblxyXG4gICAgICAgICAgLy8g5LuO5a6e5L2T6ZuG5ZCI5Lit5Yig6ZmkXHJcbiAgICAgICAgICB0aGlzLnJlcG9zaXRvcnkuZW50aXR5Q29sbGVjdGlvbi5yZW1vdmVFbnRpdHlCeUlkKGlkKTtcclxuICAgICAgICAgIHRoaXMucmVwb3NpdG9yeS5kYXRhQ2hhbmdlSGlzdG9yeS5hZGRDaGFuZ2UoeyBkYXRhSWQ6IGlkLCBjaGFuZ2VUeXBlOiBEYXRhQ2hhbmdlVHlwZS5EZWxldGUgfSk7XHJcbiAgICAgICAgICByZXR1cm4gb2YodHJ1ZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KVxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOWIoOmZpOW5tuS/neWtmFxyXG4gICAqIEBwYXJhbSBpZCDopoHliKDpmaTnmoTlrp7kvZNpZFxyXG4gICAqL1xyXG4gIHB1YmxpYyByZW1vdmVBbmRTYXZlQnlJZChpZDogc3RyaW5nKSB7XHJcbiAgICBjb25zdCBkZWxldGUkID0gdGhpcy5hcGlQcm94eS5kZWxldGVBbmRTYXZlKGlkKTtcclxuICAgIGNvbnN0IHJlc3VsdCQgPSBkZWxldGUkLnBpcGUoXHJcbiAgICAgIHN3aXRjaE1hcCgoKSA9PiB7XHJcbiAgICAgICAgdGhpcy5yZXBvc2l0b3J5LmVudGl0eUNvbGxlY3Rpb24ucmVtb3ZlRW50aXR5QnlJZChpZCk7XHJcbiAgICAgICAgcmV0dXJuIG9mKHRydWUpO1xyXG4gICAgICB9KVxyXG4gICAgKTtcclxuXHJcbiAgICByZXR1cm4gcmVzdWx0JDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOaJuemHj+WIoOmZpFxyXG4gICAqIEBwYXJhbSBpZCDlhoXnoIFcclxuICAgKi9cclxuICBwdWJsaWMgcmVtb3ZlQnlJZHMoaWRzOiBzdHJpbmdbXSk6IE9ic2VydmFibGU8Ym9vbGVhbj4ge1xyXG5cclxuICAgIC8vIOacjeWKoeWZqOerr+WIoOmZpFxyXG4gICAgY29uc3QgZGVsZXRlJCA9IHRoaXMuYXBpUHJveHkuZXh0ZW5kQmF0Y2hEZWxldGUoaWRzKTtcclxuXHJcbiAgICAvLyDku47mnKzlnLDlrp7kvZPpm4blkIjkuK3np7vpmaRcclxuICAgIHJldHVybiBkZWxldGUkLnBpcGUoXHJcbiAgICAgIHN3aXRjaE1hcCgoKSA9PiB7XHJcbiAgICAgICAgLy8g5omn6KGM5L+d5a2YXHJcbiAgICAgICAgcmV0dXJuIHRoaXMuYXBwbHlDaGFuZ2VzQnlJZEFycmF5KGlkcykucGlwZShcclxuICAgICAgICAgIHRhcChyZXN1bHQgPT4ge1xyXG4gICAgICAgICAgICBpZiAocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgLy8g5LuO5a6e5L2T6ZuG5ZCI5Lit5Yig6ZmkXHJcbiAgICAgICAgICAgICAgdGhpcy5yZXBvc2l0b3J5LmVudGl0eUNvbGxlY3Rpb24ucmVtb3ZlRW50aXRpZXMoXHJcbiAgICAgICAgICAgICAgICAodmFsdWUpID0+IHtcclxuICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuY2hlY2tFbnRpdHlWYWx1ZUV4aXN0cyh2YWx1ZSwgaWRzKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICApO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9KVxyXG4gICAgICAgICk7XHJcbiAgICAgIH0pXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5qOA5rWL5a6e5L2T55qE5Li76ZSu5YC85piv5ZCm5a2Y5Zyo5LqO5pWw57uE5Lit77yM5aaC5p6c5a2Y5Zyo6L+U5ZuedHJ1ZVxyXG4gICAqIEBwYXJhbSBhcnJheSDlvoXpgY3ljobmlbDnu4RcclxuICAgKi9cclxuICBwcml2YXRlIGNoZWNrRW50aXR5VmFsdWVFeGlzdHMoZW50aXR5OiBFbnRpdHksIHByaW1hcnlWYWx1ZUFycmF5OiBhbnlbXSk6IGJvb2xlYW4ge1xyXG4gICAgbGV0IGlzRXhpc3RJblRhcmdldEFycmF5ID0gZmFsc2U7XHJcblxyXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBwcmltYXJ5VmFsdWVBcnJheS5sZW5ndGg7IGkrKykge1xyXG4gICAgICBpZiAoZW50aXR5LnByaW1hcnlWYWx1ZSA9PT0gcHJpbWFyeVZhbHVlQXJyYXlbaV0pIHtcclxuICAgICAgICBpc0V4aXN0SW5UYXJnZXRBcnJheSA9IHRydWU7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gaXNFeGlzdEluVGFyZ2V0QXJyYXk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDliKDpmaTlrZDnuqdcclxuICAgKiBAcGFyYW0gcGF0aCDot6/lvoRcclxuICAgKiBAcGFyYW0gaWQgICDlhoXnoIFcclxuICAgKi9cclxuICBwdWJsaWMgcmVtb3ZlQnlQYXRoKGZwYXRoOiBzdHJpbmcsIGlkOiBzdHJpbmcpOiBPYnNlcnZhYmxlPGJvb2xlYW4+IHtcclxuXHJcbiAgICBjb25zdCBkZWxldGUkID0gdGhpcy5hcGlQcm94eS5leHRlbmREZWxldEJ5UGF0aChmcGF0aCwgaWQpO1xyXG5cclxuICAgIC8vIOS7juacrOWcsOWunuS9k+mbhuWQiOS4reenu+mZpFxyXG4gICAgcmV0dXJuIGRlbGV0ZSQucGlwZShcclxuICAgICAgbWFwKCgpID0+IHtcclxuICAgICAgICB0aGlzLnJlcG9zaXRvcnkuZW50aXR5TWFuYWdlci5yZW1vdmVFbnRpdHlCeVBhdGgoZnBhdGgsIGlkKTtcclxuICAgICAgICB0aGlzLnJlcG9zaXRvcnkuZGF0YUNoYW5nZUhpc3RvcnkuYWRkQ2hhbmdlKHsgZnBhdGgsIGRhdGFJZDogaWQsIGNoYW5nZVR5cGU6IERhdGFDaGFuZ2VUeXBlLkRlbGV0ZSB9KTtcclxuICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgfSlcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDlsIZpZOWvueW6lOeahOWunuS9k+eahOWPmOabtOaPkOS6pOeahOacjeWKoeWZqOerr1xyXG4gICAqL1xyXG4gIHB1YmxpYyB1cGRhdGVDaGFuZ2VzQnlJZChpZDogc3RyaW5nKTogT2JzZXJ2YWJsZTxib29sZWFuPiB7XHJcbiAgICBjb25zdCBlbnRpdHkgPSB0aGlzLnJlcG9zaXRvcnkuZW50aXR5Q29sbGVjdGlvbi5nZXRFbnRpdHlCeUlkKGlkKTtcclxuXHJcbiAgICAvLyDlj5jmm7Tpm4bkuLrnqbpcclxuICAgIGlmICghZW50aXR5LmNoYW5nZXMgfHwgZW50aXR5LmNoYW5nZXMubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgIHJldHVybiBvZih0cnVlKTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBjaGFuZ2VEZXRhaWwgPSB0aGlzLnJlcG9zaXRvcnkuZW50aXR5TWFuYWdlci5idWlsZEVudGl0eUNoYW5nZURldGFpbEJ5SWQoaWQpO1xyXG4gICAgY29uc3QgdXBkYXRlJCA9IHRoaXMuYXBpUHJveHkudXBkYXRlKGNoYW5nZURldGFpbCk7XHJcbiAgICBjb25zdCByZXN1bHQkID0gdXBkYXRlJC5waXBlKFxyXG4gICAgICB0YXAoKCkgPT4ge1xyXG4gICAgICAgIHRoaXMucmVwb3NpdG9yeS5lbnRpdHlNYW5hZ2VyLmNsZWFyRW50aXR5Q2hhbmdlc0J5SWQoaWQpO1xyXG4gICAgICB9KSxcclxuICAgICAgbWFwKCgpID0+IHtcclxuICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgfSlcclxuICAgICk7XHJcbiAgICByZXR1cm4gcmVzdWx0JDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOaPkOS6pOaJgOacieWPmOabtFxyXG4gICAqL1xyXG4gIHB1YmxpYyB1cGRhdGVBbGxDaGFuZ2VzKCk6IE9ic2VydmFibGU8Ym9vbGVhbj4ge1xyXG5cclxuICAgIC8vIOmBjeWOhuWunuS9k++8jOaPkOS6pOWPmOabtFxyXG4gICAgY29uc3QgdXBkYXRlUmVzdWx0czogT2JzZXJ2YWJsZTxib29sZWFuPltdID0gW107XHJcbiAgICBjb25zdCBlbnRpdGllczogRW50aXR5W10gPSB0aGlzLnJlcG9zaXRvcnkuZW50aXR5Q29sbGVjdGlvbi50b0FycmF5KCk7XHJcbiAgICBpZiAoZW50aXRpZXMubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgIHJldHVybiBvZih0cnVlKTtcclxuICAgIH1cclxuXHJcbiAgICBlbnRpdGllcy5mb3JFYWNoKChlbnRpdHk6IEVudGl0eSkgPT4ge1xyXG4gICAgICBjb25zdCB1cGRhdGVSZXN1bHQkID0gdGhpcy51cGRhdGVDaGFuZ2VzQnlJZChlbnRpdHkucHJpbWFyeVZhbHVlKTtcclxuICAgICAgdXBkYXRlUmVzdWx0cy5wdXNoKHVwZGF0ZVJlc3VsdCQpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgLy8g5Liy6IGU5rWBXHJcbiAgICBjb25zdCByZXN1bHQkID0gemlwKC4uLnVwZGF0ZVJlc3VsdHMpLnBpcGUoXHJcbiAgICAgIG1hcCgoKSA9PiB7XHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgIH0pXHJcbiAgICApO1xyXG5cclxuICAgIHJldHVybiByZXN1bHQkO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5bqU55So5Y+Y5pu0XHJcbiAgICovXHJcbiAgcHVibGljIGFwcGx5Q2hhbmdlcygpOiBPYnNlcnZhYmxlPGJvb2xlYW4+IHtcclxuICAgIGNvbnN0IHNhdmUkID0gdGhpcy5hcGlQcm94eS5zYXZlKCk7XHJcbiAgICBjb25zdCByZXN1bHQkID0gc2F2ZSQucGlwZShcclxuICAgICAgdGFwKCgpID0+IHtcclxuICAgICAgICB0aGlzLnJlcG9zaXRvcnkuZW50aXR5TWFuYWdlci5jbGVhckFsbEVudGl0eUNoYW5nZXMoKTtcclxuICAgICAgICB0aGlzLnJlcG9zaXRvcnkuZGF0YUNoYW5nZUhpc3RvcnkuY2xlYXIoKTtcclxuICAgICAgfSksXHJcbiAgICAgIG1hcCgoKSA9PiB7XHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgIH0pXHJcbiAgICApO1xyXG5cclxuICAgIHJldHVybiByZXN1bHQkO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5bqU55SoaWRBcnJheeWvueW6lOaVsOaNrueahOWPmOabtFxyXG4gICAqL1xyXG4gIHB1YmxpYyBhcHBseUNoYW5nZXNCeUlkQXJyYXkoaWRzOiBzdHJpbmdbXSk6IE9ic2VydmFibGU8Ym9vbGVhbj4ge1xyXG4gICAgY29uc3Qgc2F2ZSQgPSB0aGlzLmFwaVByb3h5LnNhdmUoKTtcclxuICAgIGNvbnN0IHJlc3VsdCQgPSBzYXZlJC5waXBlKFxyXG4gICAgICB0YXAoKCkgPT4ge1xyXG4gICAgICAgIHRoaXMucmVwb3NpdG9yeS5lbnRpdHlNYW5hZ2VyLmNsZWFyRW50aXR5Q2hhbmdlc0J5SWRzKGlkcyk7XHJcbiAgICAgICAgdGhpcy5yZXBvc2l0b3J5LmRhdGFDaGFuZ2VIaXN0b3J5LmNsZWFyQnlJZHMoaWRzKTtcclxuICAgICAgfSksXHJcbiAgICAgIG1hcCgoKSA9PiB7XHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgIH0pXHJcbiAgICApO1xyXG5cclxuICAgIHJldHVybiByZXN1bHQkO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5bqU55SoaWTlr7nlupTmlbDmja7nmoTlj5jmm7RcclxuICAgKi9cclxuICBwdWJsaWMgYXBwbHlDaGFuZ2VzQnlJZChpZDogc3RyaW5nKTogT2JzZXJ2YWJsZTxib29sZWFuPiB7XHJcbiAgICBjb25zdCBzYXZlJCA9IHRoaXMuYXBpUHJveHkuc2F2ZSgpO1xyXG4gICAgY29uc3QgcmVzdWx0JCA9IHNhdmUkLnBpcGUoXHJcbiAgICAgIHRhcCgoKSA9PiB7XHJcbiAgICAgICAgdGhpcy5yZXBvc2l0b3J5LmVudGl0eU1hbmFnZXIuY2xlYXJFbnRpdHlDaGFuZ2VzQnlJZChpZCk7XHJcbiAgICAgICAgdGhpcy5yZXBvc2l0b3J5LmRhdGFDaGFuZ2VIaXN0b3J5LmNsZWFyQnlJZHMoW2lkXSk7XHJcbiAgICAgIH0pLFxyXG4gICAgICBtYXAoKCkgPT4ge1xyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICB9KVxyXG4gICAgKTtcclxuXHJcbiAgICByZXR1cm4gcmVzdWx0JDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOWPlua2iOWPmOabtFxyXG4gICAqL1xyXG4gIHB1YmxpYyBjYW5jZWxDaGFuZ2VzKCk6IE9ic2VydmFibGU8Ym9vbGVhbj4ge1xyXG4gICAgY29uc3QgY2FuY2VsJCA9IHRoaXMuYXBpUHJveHkuY2FuY2VsKCk7XHJcbiAgICBjb25zdCByZXN1bHQkID0gY2FuY2VsJC5waXBlKFxyXG4gICAgICB0YXAoKCkgPT4ge1xyXG4gICAgICAgIHRoaXMucmVwb3NpdG9yeS5lbnRpdHlNYW5hZ2VyLmNsZWFyQWxsRW50aXR5Q2hhbmdlcygpO1xyXG4gICAgICAgIHRoaXMucmVwb3NpdG9yeS5kYXRhQ2hhbmdlSGlzdG9yeS5jbGVhcigpO1xyXG4gICAgICB9KSxcclxuICAgICAgbWFwKCgpID0+IHtcclxuICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgfSlcclxuICAgICk7XHJcbiAgICByZXR1cm4gcmVzdWx0JDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOaehOmAoEVudGl0eUZpbHRlclxyXG4gICAqL1xyXG4gIHByaXZhdGUgYnVpbGRFbnRpdHlGaWx0ZXIoZmlsdGVyOiBhbnlbXSwgc29ydDogYW55W10sIHBhZ2VTaXplOiBudW1iZXIsIHBhZ2VJbmRleDogbnVtYmVyKSB7XHJcbiAgICBjb25zdCBlbnRpdHlGaWx0ZXIgPSB7XHJcbiAgICAgIEZpbHRlckNvbmRpdGlvbnM6IGZpbHRlcixcclxuICAgICAgU29ydENvbmRpdGlvbnM6IHNvcnQsXHJcbiAgICAgIElzVXNlUGFnaW5hdGlvbjogcGFnZVNpemUgPT09IDAgPyBmYWxzZSA6IHRydWUsXHJcbiAgICAgIFBhZ2luYXRpb246IHtcclxuICAgICAgICBQYWdlSW5kZXg6IHBhZ2VJbmRleCxcclxuICAgICAgICBQYWdlU2l6ZTogcGFnZVNpemUsXHJcbiAgICAgICAgUGFnZUNvdW50OiAwLFxyXG4gICAgICAgIFRvdGFsQ291bnQ6IDBcclxuICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICByZXR1cm4gZW50aXR5RmlsdGVyO1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IHsgQmVmRGF0YVNlcnZpY2UgfTtcclxuIl19
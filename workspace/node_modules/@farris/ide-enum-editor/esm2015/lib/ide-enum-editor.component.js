/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Output, EventEmitter, Input, ViewChild, TemplateRef, Injector, Renderer2, ElementRef, ChangeDetectorRef } from '@angular/core';
import { DatagridComponent } from '@farris/ui-datagrid';
import { NotifyService } from '@farris/ui-notify';
/**
 * @record
 */
export function EnumData() { }
if (false) {
    /** @type {?} */
    EnumData.prototype.id;
    /** @type {?} */
    EnumData.prototype.value;
    /** @type {?} */
    EnumData.prototype.name;
}
export class IdeEnumEditorComponent {
    /**
     * @param {?} notifyService
     * @param {?} injector
     * @param {?} render
     * @param {?} el
     * @param {?} cd
     */
    constructor(notifyService, injector, render, el, cd) {
        this.notifyService = notifyService;
        this.injector = injector;
        this.render = render;
        this.el = el;
        this.cd = cd;
        this.closeModal = new EventEmitter();
        // 模态框确定后关闭，并传递参数
        this.submitModal = new EventEmitter();
        // 枚举数组
        this.editorParams = {};
        this.valueChange = new EventEmitter();
        this.modalConfig = {
            title: '枚举编辑器',
            width: 900,
            height: 500,
            showButtons: true
        };
        this.columns = [];
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.columns = [
            { field: 'name', title: '名称', width: 100, template: this.nameTemp },
            { field: 'value', title: '值', width: 100, template: this.valueTemp },
            { title: '操作', width: 100, template: this.activeTemp, halign: 'center', align: 'center' }
        ];
        if (!this.value || this.value.length === 0) {
            this.value = [];
        }
        else {
            this.value = this.value.map((/**
             * @param {?} n
             * @param {?} i
             * @return {?}
             */
            (n, i) => {
                return Object.assign({ id: i + 1 }, n);
            }));
        }
        this.render.addClass(this.el.nativeElement, 'f-utils-absolute-all');
        this.render.addClass(this.el.nativeElement, 'f-utils-flex-column');
    }
    /**
     * @param {?} changes
     * @return {?}
     */
    ngOnChanges(changes) {
    }
    /**
     * @private
     * @return {?}
     */
    map2EnumData() {
        return this.value.map((/**
         * @param {?} v
         * @return {?}
         */
        v => {
            return {
                name: v.name,
                value: v.value
            };
        }));
    }
    /**
     * @private
     * @return {?}
     */
    changeEmit() {
        this.cd.detectChanges();
        this.valueChange.emit(this.value);
    }
    /**
     * @return {?}
     */
    clickCancel() {
        this.closeModal.emit();
    }
    /**
     * @return {?}
     */
    clickConfirm() {
        if (!this.checkBeforeSave()) {
            return;
        }
        /** @type {?} */
        const enumData = this.map2EnumData();
        this.submitModal.emit({ value: enumData });
    }
    /**
     * 保存前检查
     * @return {?}
     */
    checkBeforeSave() {
        /** @type {?} */
        const msg = {
            type: 'warning',
            title: '系统提示',
            msg: '请添加枚举值。',
            timeout: 3000
        };
        // ① 空
        if (!this.value || this.value.length === 0) {
            this.notifyService.warning(msg);
            return false;
        }
        // ② 非空，则校验每个的键值是否为空；
        for (const item of this.value) {
            if (!item.name || !item.value) {
                msg.msg = '枚举值和枚举名称均不允许为空。';
                this.notifyService.warning(msg);
                return false;
            }
        }
        // ③ 键不允许重复；
        /** @type {?} */
        const enumKeys = this.value.map((/**
         * @param {?} e
         * @return {?}
         */
        e => e.value));
        /** @type {?} */
        const keySet = new Set(enumKeys);
        /** @type {?} */
        const exclusiveKeys = Array.from(keySet);
        if (enumKeys.length !== exclusiveKeys.length) {
            msg.msg = '枚举值不允许重复。';
            return false;
        }
        // ③ 值不允许重复；
        /** @type {?} */
        const enumNames = this.value.map((/**
         * @param {?} e
         * @return {?}
         */
        e => e.name));
        /** @type {?} */
        const nameSet = new Set(enumNames);
        /** @type {?} */
        const exclusiveNames = Array.from(nameSet);
        if (enumNames.length !== exclusiveNames.length) {
            msg.msg = '枚举名称不允许重复。';
            this.notifyService.warning(msg);
            return false;
        }
        return true;
    }
    /**
     * @return {?}
     */
    add() {
        this.value = [...this.value, { id: (this.value.length + 1), name: '', value: '' }];
        this.changeEmit();
    }
    /**
     * @return {?}
     */
    remove() {
        /** @type {?} */
        const rows = this.dg.checkeds;
        if (rows && rows.length) {
            this.value = this.value.filter((/**
             * @param {?} v
             * @return {?}
             */
            v => {
                return rows.findIndex((/**
                 * @param {?} r
                 * @return {?}
                 */
                r => r.id === v.id)) === -1;
            }));
            this.changeEmit();
        }
        else {
            this.notifyService.warning('请钩选要删除的数据！');
        }
    }
    /**
     * @param {?} id
     * @return {?}
     */
    deleteItem(id) {
        this.value = this.value.filter((/**
         * @param {?} v
         * @return {?}
         */
        v => {
            return v.id !== id;
        }));
        this.changeEmit();
    }
    /**
     * @param {?} $event
     * @param {?} id
     * @param {?} index
     * @return {?}
     */
    moveTop($event, id, index) {
        $event.stopPropagation();
        /** @type {?} */
        const i = this.value.findIndex((/**
         * @param {?} n
         * @return {?}
         */
        n => n.id === id));
        // const i = index;
        this.value.unshift(this.value[i]);
        this.value.splice(i + 1, 1);
        this.value = [...this.value];
        this.changeEmit();
        return false;
    }
    /**
     * @param {?} $event
     * @param {?} id
     * @param {?} index
     * @return {?}
     */
    moveBottom($event, id, index) {
        $event.stopPropagation();
        /** @type {?} */
        const i = this.value.findIndex((/**
         * @param {?} n
         * @return {?}
         */
        n => n.id === id));
        // const i = index;
        this.value.push(this.value[i]);
        this.value.splice(i, 1);
        this.value = [...this.value];
        this.changeEmit();
        return false;
    }
    /**
     * @param {?} $event
     * @param {?} id
     * @param {?} index
     * @return {?}
     */
    moveUp($event, id, index) {
        $event.stopPropagation();
        /** @type {?} */
        const i = this.value.findIndex((/**
         * @param {?} n
         * @return {?}
         */
        n => n.id === id));
        // const i = index;
        if (i !== 0) {
            /** @type {?} */
            const tempArr = this.value.splice(i, 1);
            this.value.splice(i - 1, 0, ...tempArr);
            this.value = [...this.value];
            this.changeEmit();
        }
        return false;
    }
    /**
     * @param {?} $event
     * @param {?} id
     * @param {?} index
     * @return {?}
     */
    moveDown($event, id, index) {
        $event.stopPropagation();
        /** @type {?} */
        const len = this.value.length;
        /** @type {?} */
        const i = this.value.findIndex((/**
         * @param {?} n
         * @return {?}
         */
        n => n.id === id));
        // const i = index;
        if (i !== len - 1) {
            /** @type {?} */
            const tempArr = this.value.splice(i, 1);
            this.value.splice(i + 1, 0, ...tempArr);
            this.value = [...this.value];
            this.changeEmit();
        }
        return false;
    }
}
IdeEnumEditorComponent.decorators = [
    { type: Component, args: [{
                selector: 'ide-enum-editor',
                template: `
    <div class="border-bottom mb-1 py-1">
        <button class="btn btn-primary mr-1 ml-2" (click)="add()"> 新增</button>
        <button class="btn btn-default mr-1" (click)="remove()">删除</button>
    </div>
    <div class="d-flex flex-column flex-fill">
        <farris-datagrid #dg [idField]="'id'"
            [columns]="columns" [sizeType]="'md'" [showAllCheckbox]="true"
            [striped]="false" [showCheckbox]="true" [multiSelect]="true"
            [data]="value" [fit]="true" [fitColumns]="true"
            [showBorder]="true" [pagination]="false"
            [selectOnCheck]="false" [checkOnSelect]="false"
        ></farris-datagrid>

        <ng-template #nameTemp let-ctx>
            <div class="f-datagrid-cell-formgroup farris-group-auto">
                <input type="text" class="form-control" name="name" [(ngModel)]="ctx.rowData['name']">
            </div>
        </ng-template>
        <ng-template #valueTemp let-ctx>
            <div class="f-datagrid-cell-formgroup farris-group-auto">
                <input type="text" class="form-control" [(ngModel)]="ctx.rowData['value']" name="value">
            </div>
        </ng-template>

        <ng-template #activeTemp let-ctx>
            <button type="button" class="btn btn-warning  mr-1" (click)="deleteItem(ctx.rowData.id)">删除</button>
            <button class="btn btn-info mr-1" style="padding: 2px 5px" (click)="moveTop($event, ctx.rowData.id, ctx.rowIndex)" title="置顶">
                <span class="f-icon f-icon-roofing"></span>
            </button>
            <button class="btn btn-info mr-1" style="padding: 2px 5px" (click)="moveUp($event, ctx.rowData.id, ctx.rowIndex)" title="上移">
                <span class="f-icon f-icon-arrow-chevron-up"></span>
            </button>
            <button class="btn btn-info mr-1"  style="padding: 2px 5px" (click)="moveDown($event, ctx.rowData.id, ctx.rowIndex)" title="下移">
                <span class="f-icon f-icon-arrow-chevron-down"></span>
            </button>
            <button class="btn btn-info mr-1" style="padding: 2px 5px" (click)="moveBottom($event, ctx.rowData.id, ctx.rowIndex)" title="置底">
                <span class="f-icon f-icon-bottomsetting"></span>
            </button>
        </ng-template>

    </div>
    <ng-template #enumFooter>
        <div class="btns">
            <button type="button" class="btn btn-outline-secondary btn-sm px-3" (click)="clickCancel()" > 取消 </button>
            &nbsp;&nbsp;
            <button  type="button"  class="btn btn-outline-primary btn-sm px-3" (click)="clickConfirm()" > 确定 </button>
        </div>
    </ng-template>
    `
            }] }
];
/** @nocollapse */
IdeEnumEditorComponent.ctorParameters = () => [
    { type: NotifyService },
    { type: Injector },
    { type: Renderer2 },
    { type: ElementRef },
    { type: ChangeDetectorRef }
];
IdeEnumEditorComponent.propDecorators = {
    closeModal: [{ type: Output }],
    submitModal: [{ type: Output }],
    value: [{ type: Input }],
    editorParams: [{ type: Input }],
    modalFooter: [{ type: ViewChild, args: ['enumFooter',] }],
    dg: [{ type: ViewChild, args: ['dg',] }],
    nameTemp: [{ type: ViewChild, args: ['nameTemp',] }],
    valueTemp: [{ type: ViewChild, args: ['valueTemp',] }],
    activeTemp: [{ type: ViewChild, args: ['activeTemp',] }],
    valueChange: [{ type: Output }]
};
if (false) {
    /** @type {?} */
    IdeEnumEditorComponent.prototype.closeModal;
    /** @type {?} */
    IdeEnumEditorComponent.prototype.submitModal;
    /** @type {?} */
    IdeEnumEditorComponent.prototype.value;
    /** @type {?} */
    IdeEnumEditorComponent.prototype.editorParams;
    /** @type {?} */
    IdeEnumEditorComponent.prototype.modalFooter;
    /** @type {?} */
    IdeEnumEditorComponent.prototype.dg;
    /** @type {?} */
    IdeEnumEditorComponent.prototype.nameTemp;
    /** @type {?} */
    IdeEnumEditorComponent.prototype.valueTemp;
    /** @type {?} */
    IdeEnumEditorComponent.prototype.activeTemp;
    /** @type {?} */
    IdeEnumEditorComponent.prototype.valueChange;
    /** @type {?} */
    IdeEnumEditorComponent.prototype.modalConfig;
    /** @type {?} */
    IdeEnumEditorComponent.prototype.columns;
    /**
     * @type {?}
     * @private
     */
    IdeEnumEditorComponent.prototype.notifyService;
    /**
     * @type {?}
     * @private
     */
    IdeEnumEditorComponent.prototype.injector;
    /**
     * @type {?}
     * @private
     */
    IdeEnumEditorComponent.prototype.render;
    /**
     * @type {?}
     * @private
     */
    IdeEnumEditorComponent.prototype.el;
    /**
     * @type {?}
     * @private
     */
    IdeEnumEditorComponent.prototype.cd;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaWRlLWVudW0tZWRpdG9yLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvaWRlLWVudW0tZWRpdG9yLyIsInNvdXJjZXMiOlsibGliL2lkZS1lbnVtLWVkaXRvci5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQVUsTUFBTSxFQUFFLFlBQVksRUFBRSxLQUFLLEVBQUUsU0FBUyxFQUFFLFdBQVcsRUFBNEIsUUFBUSxFQUFlLFNBQVMsRUFBRSxVQUFVLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDbE0sT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDeEQsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLG1CQUFtQixDQUFDOzs7O0FBR2xELDhCQUlDOzs7SUFIRyxzQkFBUTs7SUFDUix5QkFBYzs7SUFDZCx3QkFBYTs7QUF5RGpCLE1BQU0sT0FBTyxzQkFBc0I7Ozs7Ozs7O0lBeUIvQixZQUNZLGFBQTRCLEVBQzVCLFFBQWtCLEVBQ2xCLE1BQWlCLEVBQ2pCLEVBQWMsRUFDZCxFQUFxQjtRQUpyQixrQkFBYSxHQUFiLGFBQWEsQ0FBZTtRQUM1QixhQUFRLEdBQVIsUUFBUSxDQUFVO1FBQ2xCLFdBQU0sR0FBTixNQUFNLENBQVc7UUFDakIsT0FBRSxHQUFGLEVBQUUsQ0FBWTtRQUNkLE9BQUUsR0FBRixFQUFFLENBQW1CO1FBN0J2QixlQUFVLEdBQUcsSUFBSSxZQUFZLEVBQU8sQ0FBQzs7UUFFckMsZ0JBQVcsR0FBRyxJQUFJLFlBQVksRUFBTyxDQUFDOztRQUV2QyxpQkFBWSxHQUFRLEVBQUUsQ0FBQztRQVN0QixnQkFBVyxHQUFHLElBQUksWUFBWSxFQUFFLENBQUM7UUFFM0MsZ0JBQVcsR0FBRztZQUNWLEtBQUssRUFBRSxPQUFPO1lBQ2QsS0FBSyxFQUFFLEdBQUc7WUFDVixNQUFNLEVBQUUsR0FBRztZQUNYLFdBQVcsRUFBRSxJQUFJO1NBQ3BCLENBQUM7UUFFRixZQUFPLEdBQUcsRUFBRSxDQUFDO0lBUVQsQ0FBQzs7OztJQUVMLFFBQVE7UUFFSixJQUFJLENBQUMsT0FBTyxHQUFHO1lBQ1gsRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLEdBQUcsRUFBRSxRQUFRLEVBQUUsSUFBSSxDQUFDLFFBQVEsRUFBRTtZQUNuRSxFQUFFLEtBQUssRUFBRSxPQUFPLEVBQUUsS0FBSyxFQUFFLEdBQUcsRUFBRSxLQUFLLEVBQUUsR0FBRyxFQUFFLFFBQVEsRUFBRSxJQUFJLENBQUMsU0FBUyxFQUFFO1lBQ3BFLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsR0FBRyxFQUFFLFFBQVEsRUFBRSxJQUFJLENBQUMsVUFBVSxFQUFFLE1BQU0sRUFBRSxRQUFRLEVBQUUsS0FBSyxFQUFFLFFBQVEsRUFBRTtTQUM1RixDQUFDO1FBRUYsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLElBQUksSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLEtBQUssQ0FBQyxFQUFFO1lBQ3hDLElBQUksQ0FBQyxLQUFLLEdBQUcsRUFBRSxDQUFDO1NBQ25CO2FBQU07WUFDSCxJQUFJLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRzs7Ozs7WUFBQyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsRUFBRTtnQkFDakMsdUJBQ0ksRUFBRSxFQUFFLENBQUMsR0FBRyxDQUFDLElBQ04sQ0FBQyxFQUNOO1lBQ04sQ0FBQyxFQUFDLENBQUM7U0FDTjtRQUdELElBQUksQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsYUFBYSxFQUFFLHNCQUFzQixDQUFDLENBQUM7UUFDcEUsSUFBSSxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxhQUFhLEVBQUUscUJBQXFCLENBQUMsQ0FBQztJQUV2RSxDQUFDOzs7OztJQUVELFdBQVcsQ0FBQyxPQUFzQjtJQUVsQyxDQUFDOzs7OztJQUVPLFlBQVk7UUFDaEIsT0FBTyxJQUFJLENBQUMsS0FBSyxDQUFDLEdBQUc7Ozs7UUFBQyxDQUFDLENBQUMsRUFBRTtZQUN0QixPQUFPO2dCQUNILElBQUksRUFBRSxDQUFDLENBQUMsSUFBSTtnQkFDWixLQUFLLEVBQUUsQ0FBQyxDQUFDLEtBQUs7YUFDakIsQ0FBQztRQUNOLENBQUMsRUFBQyxDQUFDO0lBQ1AsQ0FBQzs7Ozs7SUFFTyxVQUFVO1FBQ2QsSUFBSSxDQUFDLEVBQUUsQ0FBQyxhQUFhLEVBQUUsQ0FBQztRQUN4QixJQUFJLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDdEMsQ0FBQzs7OztJQUVELFdBQVc7UUFDUCxJQUFJLENBQUMsVUFBVSxDQUFDLElBQUksRUFBRSxDQUFDO0lBQzNCLENBQUM7Ozs7SUFFRCxZQUFZO1FBQ1IsSUFBSSxDQUFDLElBQUksQ0FBQyxlQUFlLEVBQUUsRUFBRTtZQUN6QixPQUFPO1NBQ1Y7O2NBQ0ssUUFBUSxHQUFHLElBQUksQ0FBQyxZQUFZLEVBQUU7UUFDcEMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsRUFBRSxLQUFLLEVBQUUsUUFBUSxFQUFFLENBQUMsQ0FBQztJQUMvQyxDQUFDOzs7OztJQUtELGVBQWU7O2NBRUwsR0FBRyxHQUFHO1lBQ1IsSUFBSSxFQUFFLFNBQVM7WUFDZixLQUFLLEVBQUUsTUFBTTtZQUNiLEdBQUcsRUFBRSxTQUFTO1lBQ2QsT0FBTyxFQUFFLElBQUk7U0FDaEI7UUFHRCxNQUFNO1FBQ04sSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLElBQUksSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLEtBQUssQ0FBQyxFQUFFO1lBQ3hDLElBQUksQ0FBQyxhQUFhLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQ2hDLE9BQU8sS0FBSyxDQUFDO1NBQ2hCO1FBQ0QscUJBQXFCO1FBQ3JCLEtBQUssTUFBTSxJQUFJLElBQUksSUFBSSxDQUFDLEtBQUssRUFBRTtZQUMzQixJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLEVBQUU7Z0JBQzNCLEdBQUcsQ0FBQyxHQUFHLEdBQUcsaUJBQWlCLENBQUM7Z0JBQzVCLElBQUksQ0FBQyxhQUFhLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxDQUFDO2dCQUNoQyxPQUFPLEtBQUssQ0FBQzthQUNoQjtTQUNKOzs7Y0FFSyxRQUFRLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxHQUFHOzs7O1FBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsS0FBSyxFQUFDOztjQUN2QyxNQUFNLEdBQUcsSUFBSSxHQUFHLENBQUMsUUFBUSxDQUFDOztjQUMxQixhQUFhLEdBQUcsS0FBSyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUM7UUFDeEMsSUFBSSxRQUFRLENBQUMsTUFBTSxLQUFLLGFBQWEsQ0FBQyxNQUFNLEVBQUU7WUFDMUMsR0FBRyxDQUFDLEdBQUcsR0FBRyxXQUFXLENBQUM7WUFDdEIsT0FBTyxLQUFLLENBQUM7U0FDaEI7OztjQUdLLFNBQVMsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLEdBQUc7Ozs7UUFBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxJQUFJLEVBQUM7O2NBQ3ZDLE9BQU8sR0FBRyxJQUFJLEdBQUcsQ0FBQyxTQUFTLENBQUM7O2NBQzVCLGNBQWMsR0FBRyxLQUFLLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQztRQUMxQyxJQUFJLFNBQVMsQ0FBQyxNQUFNLEtBQUssY0FBYyxDQUFDLE1BQU0sRUFBRTtZQUM1QyxHQUFHLENBQUMsR0FBRyxHQUFJLFlBQVksQ0FBQztZQUN4QixJQUFJLENBQUMsYUFBYSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUNoQyxPQUFPLEtBQUssQ0FBQztTQUNoQjtRQUVELE9BQU8sSUFBSSxDQUFDO0lBQ2hCLENBQUM7Ozs7SUFHRCxHQUFHO1FBQ0MsSUFBSSxDQUFDLEtBQUssR0FBRyxDQUFFLEdBQUcsSUFBSSxDQUFDLEtBQUssRUFBRSxFQUFHLEVBQUUsRUFBRSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxFQUFFLElBQUksRUFBRSxFQUFFLEVBQUUsS0FBSyxFQUFFLEVBQUUsRUFBRyxDQUFFLENBQUM7UUFDdkYsSUFBSSxDQUFDLFVBQVUsRUFBRSxDQUFDO0lBQ3RCLENBQUM7Ozs7SUFFRCxNQUFNOztjQUNJLElBQUksR0FBRyxJQUFJLENBQUMsRUFBRSxDQUFDLFFBQVE7UUFDN0IsSUFBSSxJQUFJLElBQUksSUFBSSxDQUFDLE1BQU0sRUFBRTtZQUNyQixJQUFJLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTTs7OztZQUFFLENBQUMsQ0FBQyxFQUFFO2dCQUNoQyxPQUFPLElBQUksQ0FBQyxTQUFTOzs7O2dCQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUUsS0FBSyxDQUFDLENBQUMsRUFBRSxFQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7WUFDckQsQ0FBQyxFQUFDLENBQUM7WUFDSCxJQUFJLENBQUMsVUFBVSxFQUFFLENBQUM7U0FDckI7YUFBTTtZQUNILElBQUksQ0FBQyxhQUFhLENBQUMsT0FBTyxDQUFDLFlBQVksQ0FBQyxDQUFDO1NBQzVDO0lBQ0wsQ0FBQzs7Ozs7SUFFRCxVQUFVLENBQUMsRUFBRTtRQUNULElBQUksQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNOzs7O1FBQUUsQ0FBQyxDQUFDLEVBQUU7WUFDaEMsT0FBTyxDQUFDLENBQUMsRUFBRSxLQUFLLEVBQUUsQ0FBQztRQUN2QixDQUFDLEVBQUMsQ0FBQztRQUNILElBQUksQ0FBQyxVQUFVLEVBQUUsQ0FBQztJQUN0QixDQUFDOzs7Ozs7O0lBRUQsT0FBTyxDQUFDLE1BQWtCLEVBQUUsRUFBRSxFQUFFLEtBQUs7UUFDakMsTUFBTSxDQUFDLGVBQWUsRUFBRSxDQUFDOztjQUNuQixDQUFDLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxTQUFTOzs7O1FBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsRUFBRSxLQUFLLEVBQUUsRUFBQztRQUNoRCxtQkFBbUI7UUFDbkIsSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ2xDLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFFNUIsSUFBSSxDQUFDLEtBQUssR0FBRyxDQUFDLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQzdCLElBQUksQ0FBQyxVQUFVLEVBQUUsQ0FBQztRQUNsQixPQUFPLEtBQUssQ0FBQztJQUNqQixDQUFDOzs7Ozs7O0lBRUQsVUFBVSxDQUFDLE1BQU0sRUFBRSxFQUFFLEVBQUUsS0FBSztRQUN4QixNQUFNLENBQUMsZUFBZSxFQUFFLENBQUM7O2NBQ25CLENBQUMsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLFNBQVM7Ozs7UUFBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxFQUFFLEtBQUssRUFBRSxFQUFDO1FBQ2hELG1CQUFtQjtRQUNuQixJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDL0IsSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBQ3hCLElBQUksQ0FBQyxLQUFLLEdBQUcsQ0FBQyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUM3QixJQUFJLENBQUMsVUFBVSxFQUFFLENBQUM7UUFDbEIsT0FBTyxLQUFLLENBQUM7SUFDakIsQ0FBQzs7Ozs7OztJQUVELE1BQU0sQ0FBQyxNQUFNLEVBQUUsRUFBRSxFQUFFLEtBQUs7UUFDcEIsTUFBTSxDQUFDLGVBQWUsRUFBRSxDQUFDOztjQUNuQixDQUFDLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxTQUFTOzs7O1FBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsRUFBRSxLQUFLLEVBQUUsRUFBQztRQUNoRCxtQkFBbUI7UUFDbkIsSUFBSSxDQUFDLEtBQUssQ0FBQyxFQUFFOztrQkFDSCxPQUFPLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQztZQUN2QyxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsRUFBRSxHQUFHLE9BQU8sQ0FBQyxDQUFDO1lBQ3hDLElBQUksQ0FBQyxLQUFLLEdBQUcsQ0FBQyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUM3QixJQUFJLENBQUMsVUFBVSxFQUFFLENBQUM7U0FDckI7UUFDRCxPQUFPLEtBQUssQ0FBQztJQUNqQixDQUFDOzs7Ozs7O0lBRUQsUUFBUSxDQUFDLE1BQU0sRUFBRSxFQUFFLEVBQUUsS0FBSztRQUN0QixNQUFNLENBQUMsZUFBZSxFQUFFLENBQUM7O2NBQ25CLEdBQUcsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU07O2NBQ3ZCLENBQUMsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLFNBQVM7Ozs7UUFBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxFQUFFLEtBQUssRUFBRSxFQUFDO1FBQ2hELG1CQUFtQjtRQUNuQixJQUFJLENBQUMsS0FBSyxHQUFHLEdBQUcsQ0FBQyxFQUFFOztrQkFDVCxPQUFPLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQztZQUN2QyxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsRUFBRSxHQUFHLE9BQU8sQ0FBQyxDQUFDO1lBQ3hDLElBQUksQ0FBQyxLQUFLLEdBQUcsQ0FBQyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUM3QixJQUFJLENBQUMsVUFBVSxFQUFFLENBQUM7U0FDckI7UUFDRCxPQUFPLEtBQUssQ0FBQztJQUNqQixDQUFDOzs7WUF2UUosU0FBUyxTQUFDO2dCQUNQLFFBQVEsRUFBRSxpQkFBaUI7Z0JBQzNCLFFBQVEsRUFBRTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztLQWlEVDthQUVKOzs7O1lBOURRLGFBQWE7WUFGcUYsUUFBUTtZQUFlLFNBQVM7WUFBRSxVQUFVO1lBQUUsaUJBQWlCOzs7eUJBa0VySyxNQUFNOzBCQUVOLE1BQU07b0JBQ04sS0FBSzsyQkFDTCxLQUFLOzBCQUVMLFNBQVMsU0FBQyxZQUFZO2lCQUV0QixTQUFTLFNBQUMsSUFBSTt1QkFDZCxTQUFTLFNBQUMsVUFBVTt3QkFDcEIsU0FBUyxTQUFDLFdBQVc7eUJBQ3JCLFNBQVMsU0FBQyxZQUFZOzBCQUV0QixNQUFNOzs7O0lBYlAsNENBQStDOztJQUUvQyw2Q0FBZ0Q7O0lBQ2hELHVDQUEyQjs7SUFDM0IsOENBQWdDOztJQUVoQyw2Q0FBdUQ7O0lBRXZELG9DQUF1Qzs7SUFDdkMsMENBQWtEOztJQUNsRCwyQ0FBb0Q7O0lBQ3BELDRDQUFzRDs7SUFFdEQsNkNBQTJDOztJQUUzQyw2Q0FLRTs7SUFFRix5Q0FBYTs7Ozs7SUFHVCwrQ0FBb0M7Ozs7O0lBQ3BDLDBDQUEwQjs7Ozs7SUFDMUIsd0NBQXlCOzs7OztJQUN6QixvQ0FBc0I7Ozs7O0lBQ3RCLG9DQUE2QiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgT25Jbml0LCBPdXRwdXQsIEV2ZW50RW1pdHRlciwgSW5wdXQsIFZpZXdDaGlsZCwgVGVtcGxhdGVSZWYsIFNpbXBsZUNoYW5nZXMsIE9uQ2hhbmdlcywgSW5qZWN0b3IsIEhvc3RCaW5kaW5nLCBSZW5kZXJlcjIsIEVsZW1lbnRSZWYsIENoYW5nZURldGVjdG9yUmVmIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBEYXRhZ3JpZENvbXBvbmVudCB9IGZyb20gJ0BmYXJyaXMvdWktZGF0YWdyaWQnO1xuaW1wb3J0IHsgTm90aWZ5U2VydmljZSB9IGZyb20gJ0BmYXJyaXMvdWktbm90aWZ5JztcblxuXG5leHBvcnQgaW50ZXJmYWNlIEVudW1EYXRhIHtcbiAgICBpZDogYW55O1xuICAgIHZhbHVlOiBzdHJpbmc7XG4gICAgbmFtZTogc3RyaW5nO1xufVxuXG5AQ29tcG9uZW50KHtcbiAgICBzZWxlY3RvcjogJ2lkZS1lbnVtLWVkaXRvcicsXG4gICAgdGVtcGxhdGU6IGBcbiAgICA8ZGl2IGNsYXNzPVwiYm9yZGVyLWJvdHRvbSBtYi0xIHB5LTFcIj5cbiAgICAgICAgPGJ1dHRvbiBjbGFzcz1cImJ0biBidG4tcHJpbWFyeSBtci0xIG1sLTJcIiAoY2xpY2spPVwiYWRkKClcIj4g5paw5aKePC9idXR0b24+XG4gICAgICAgIDxidXR0b24gY2xhc3M9XCJidG4gYnRuLWRlZmF1bHQgbXItMVwiIChjbGljayk9XCJyZW1vdmUoKVwiPuWIoOmZpDwvYnV0dG9uPlxuICAgIDwvZGl2PlxuICAgIDxkaXYgY2xhc3M9XCJkLWZsZXggZmxleC1jb2x1bW4gZmxleC1maWxsXCI+XG4gICAgICAgIDxmYXJyaXMtZGF0YWdyaWQgI2RnIFtpZEZpZWxkXT1cIidpZCdcIlxuICAgICAgICAgICAgW2NvbHVtbnNdPVwiY29sdW1uc1wiIFtzaXplVHlwZV09XCInbWQnXCIgW3Nob3dBbGxDaGVja2JveF09XCJ0cnVlXCJcbiAgICAgICAgICAgIFtzdHJpcGVkXT1cImZhbHNlXCIgW3Nob3dDaGVja2JveF09XCJ0cnVlXCIgW211bHRpU2VsZWN0XT1cInRydWVcIlxuICAgICAgICAgICAgW2RhdGFdPVwidmFsdWVcIiBbZml0XT1cInRydWVcIiBbZml0Q29sdW1uc109XCJ0cnVlXCJcbiAgICAgICAgICAgIFtzaG93Qm9yZGVyXT1cInRydWVcIiBbcGFnaW5hdGlvbl09XCJmYWxzZVwiXG4gICAgICAgICAgICBbc2VsZWN0T25DaGVja109XCJmYWxzZVwiIFtjaGVja09uU2VsZWN0XT1cImZhbHNlXCJcbiAgICAgICAgPjwvZmFycmlzLWRhdGFncmlkPlxuXG4gICAgICAgIDxuZy10ZW1wbGF0ZSAjbmFtZVRlbXAgbGV0LWN0eD5cbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJmLWRhdGFncmlkLWNlbGwtZm9ybWdyb3VwIGZhcnJpcy1ncm91cC1hdXRvXCI+XG4gICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9XCJ0ZXh0XCIgY2xhc3M9XCJmb3JtLWNvbnRyb2xcIiBuYW1lPVwibmFtZVwiIFsobmdNb2RlbCldPVwiY3R4LnJvd0RhdGFbJ25hbWUnXVwiPlxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgIDwvbmctdGVtcGxhdGU+XG4gICAgICAgIDxuZy10ZW1wbGF0ZSAjdmFsdWVUZW1wIGxldC1jdHg+XG4gICAgICAgICAgICA8ZGl2IGNsYXNzPVwiZi1kYXRhZ3JpZC1jZWxsLWZvcm1ncm91cCBmYXJyaXMtZ3JvdXAtYXV0b1wiPlxuICAgICAgICAgICAgICAgIDxpbnB1dCB0eXBlPVwidGV4dFwiIGNsYXNzPVwiZm9ybS1jb250cm9sXCIgWyhuZ01vZGVsKV09XCJjdHgucm93RGF0YVsndmFsdWUnXVwiIG5hbWU9XCJ2YWx1ZVwiPlxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgIDwvbmctdGVtcGxhdGU+XG5cbiAgICAgICAgPG5nLXRlbXBsYXRlICNhY3RpdmVUZW1wIGxldC1jdHg+XG4gICAgICAgICAgICA8YnV0dG9uIHR5cGU9XCJidXR0b25cIiBjbGFzcz1cImJ0biBidG4td2FybmluZyAgbXItMVwiIChjbGljayk9XCJkZWxldGVJdGVtKGN0eC5yb3dEYXRhLmlkKVwiPuWIoOmZpDwvYnV0dG9uPlxuICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz1cImJ0biBidG4taW5mbyBtci0xXCIgc3R5bGU9XCJwYWRkaW5nOiAycHggNXB4XCIgKGNsaWNrKT1cIm1vdmVUb3AoJGV2ZW50LCBjdHgucm93RGF0YS5pZCwgY3R4LnJvd0luZGV4KVwiIHRpdGxlPVwi572u6aG2XCI+XG4gICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9XCJmLWljb24gZi1pY29uLXJvb2ZpbmdcIj48L3NwYW4+XG4gICAgICAgICAgICA8L2J1dHRvbj5cbiAgICAgICAgICAgIDxidXR0b24gY2xhc3M9XCJidG4gYnRuLWluZm8gbXItMVwiIHN0eWxlPVwicGFkZGluZzogMnB4IDVweFwiIChjbGljayk9XCJtb3ZlVXAoJGV2ZW50LCBjdHgucm93RGF0YS5pZCwgY3R4LnJvd0luZGV4KVwiIHRpdGxlPVwi5LiK56e7XCI+XG4gICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9XCJmLWljb24gZi1pY29uLWFycm93LWNoZXZyb24tdXBcIj48L3NwYW4+XG4gICAgICAgICAgICA8L2J1dHRvbj5cbiAgICAgICAgICAgIDxidXR0b24gY2xhc3M9XCJidG4gYnRuLWluZm8gbXItMVwiICBzdHlsZT1cInBhZGRpbmc6IDJweCA1cHhcIiAoY2xpY2spPVwibW92ZURvd24oJGV2ZW50LCBjdHgucm93RGF0YS5pZCwgY3R4LnJvd0luZGV4KVwiIHRpdGxlPVwi5LiL56e7XCI+XG4gICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9XCJmLWljb24gZi1pY29uLWFycm93LWNoZXZyb24tZG93blwiPjwvc3Bhbj5cbiAgICAgICAgICAgIDwvYnV0dG9uPlxuICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz1cImJ0biBidG4taW5mbyBtci0xXCIgc3R5bGU9XCJwYWRkaW5nOiAycHggNXB4XCIgKGNsaWNrKT1cIm1vdmVCb3R0b20oJGV2ZW50LCBjdHgucm93RGF0YS5pZCwgY3R4LnJvd0luZGV4KVwiIHRpdGxlPVwi572u5bqVXCI+XG4gICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9XCJmLWljb24gZi1pY29uLWJvdHRvbXNldHRpbmdcIj48L3NwYW4+XG4gICAgICAgICAgICA8L2J1dHRvbj5cbiAgICAgICAgPC9uZy10ZW1wbGF0ZT5cblxuICAgIDwvZGl2PlxuICAgIDxuZy10ZW1wbGF0ZSAjZW51bUZvb3Rlcj5cbiAgICAgICAgPGRpdiBjbGFzcz1cImJ0bnNcIj5cbiAgICAgICAgICAgIDxidXR0b24gdHlwZT1cImJ1dHRvblwiIGNsYXNzPVwiYnRuIGJ0bi1vdXRsaW5lLXNlY29uZGFyeSBidG4tc20gcHgtM1wiIChjbGljayk9XCJjbGlja0NhbmNlbCgpXCIgPiDlj5bmtoggPC9idXR0b24+XG4gICAgICAgICAgICAmbmJzcDsmbmJzcDtcbiAgICAgICAgICAgIDxidXR0b24gIHR5cGU9XCJidXR0b25cIiAgY2xhc3M9XCJidG4gYnRuLW91dGxpbmUtcHJpbWFyeSBidG4tc20gcHgtM1wiIChjbGljayk9XCJjbGlja0NvbmZpcm0oKVwiID4g56Gu5a6aIDwvYnV0dG9uPlxuICAgICAgICA8L2Rpdj5cbiAgICA8L25nLXRlbXBsYXRlPlxuICAgIGAsXG4gICAgc3R5bGVzOiBbXVxufSlcbmV4cG9ydCBjbGFzcyBJZGVFbnVtRWRpdG9yQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBPbkNoYW5nZXMge1xuICAgIEBPdXRwdXQoKSBjbG9zZU1vZGFsID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG4gICAgLy8g5qih5oCB5qGG56Gu5a6a5ZCO5YWz6Zet77yM5bm25Lyg6YCS5Y+C5pWwXG4gICAgQE91dHB1dCgpIHN1Ym1pdE1vZGFsID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG4gICAgQElucHV0KCkgdmFsdWU6IEVudW1EYXRhW107IC8vIOaemuS4vuaVsOe7hFxuICAgIEBJbnB1dCgpIGVkaXRvclBhcmFtczogYW55ID0ge307XG5cbiAgICBAVmlld0NoaWxkKCdlbnVtRm9vdGVyJykgbW9kYWxGb290ZXI6IFRlbXBsYXRlUmVmPGFueT47XG5cbiAgICBAVmlld0NoaWxkKCdkZycpIGRnOiBEYXRhZ3JpZENvbXBvbmVudDtcbiAgICBAVmlld0NoaWxkKCduYW1lVGVtcCcpIG5hbWVUZW1wOiBUZW1wbGF0ZVJlZjxhbnk+O1xuICAgIEBWaWV3Q2hpbGQoJ3ZhbHVlVGVtcCcpIHZhbHVlVGVtcDogVGVtcGxhdGVSZWY8YW55PjtcbiAgICBAVmlld0NoaWxkKCdhY3RpdmVUZW1wJykgYWN0aXZlVGVtcDogVGVtcGxhdGVSZWY8YW55PjtcblxuICAgIEBPdXRwdXQoKSB2YWx1ZUNoYW5nZSA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcblxuICAgIG1vZGFsQ29uZmlnID0ge1xuICAgICAgICB0aXRsZTogJ+aemuS4vue8lui+keWZqCcsXG4gICAgICAgIHdpZHRoOiA5MDAsXG4gICAgICAgIGhlaWdodDogNTAwLFxuICAgICAgICBzaG93QnV0dG9uczogdHJ1ZVxuICAgIH07XG5cbiAgICBjb2x1bW5zID0gW107XG5cbiAgICBjb25zdHJ1Y3RvcihcbiAgICAgICAgcHJpdmF0ZSBub3RpZnlTZXJ2aWNlOiBOb3RpZnlTZXJ2aWNlLFxuICAgICAgICBwcml2YXRlIGluamVjdG9yOiBJbmplY3RvcixcbiAgICAgICAgcHJpdmF0ZSByZW5kZXI6IFJlbmRlcmVyMixcbiAgICAgICAgcHJpdmF0ZSBlbDogRWxlbWVudFJlZixcbiAgICAgICAgcHJpdmF0ZSBjZDogQ2hhbmdlRGV0ZWN0b3JSZWZcbiAgICApIHsgfVxuXG4gICAgbmdPbkluaXQoKSB7XG5cbiAgICAgICAgdGhpcy5jb2x1bW5zID0gW1xuICAgICAgICAgICAgeyBmaWVsZDogJ25hbWUnLCB0aXRsZTogJ+WQjeensCcsIHdpZHRoOiAxMDAsIHRlbXBsYXRlOiB0aGlzLm5hbWVUZW1wIH0sXG4gICAgICAgICAgICB7IGZpZWxkOiAndmFsdWUnLCB0aXRsZTogJ+WAvCcsIHdpZHRoOiAxMDAsIHRlbXBsYXRlOiB0aGlzLnZhbHVlVGVtcCB9LFxuICAgICAgICAgICAgeyB0aXRsZTogJ+aTjeS9nCcsIHdpZHRoOiAxMDAsIHRlbXBsYXRlOiB0aGlzLmFjdGl2ZVRlbXAsIGhhbGlnbjogJ2NlbnRlcicsIGFsaWduOiAnY2VudGVyJyB9XG4gICAgICAgIF07XG5cbiAgICAgICAgaWYgKCF0aGlzLnZhbHVlIHx8IHRoaXMudmFsdWUubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICB0aGlzLnZhbHVlID0gW107XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnZhbHVlID0gdGhpcy52YWx1ZS5tYXAoKG4sIGkpID0+IHtcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICBpZDogaSArIDEsXG4gICAgICAgICAgICAgICAgICAgIC4uLm5cbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuXG4gICAgICAgIHRoaXMucmVuZGVyLmFkZENsYXNzKHRoaXMuZWwubmF0aXZlRWxlbWVudCwgJ2YtdXRpbHMtYWJzb2x1dGUtYWxsJyk7XG4gICAgICAgIHRoaXMucmVuZGVyLmFkZENsYXNzKHRoaXMuZWwubmF0aXZlRWxlbWVudCwgJ2YtdXRpbHMtZmxleC1jb2x1bW4nKTtcblxuICAgIH1cblxuICAgIG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpIHtcblxuICAgIH1cblxuICAgIHByaXZhdGUgbWFwMkVudW1EYXRhKCkge1xuICAgICAgICByZXR1cm4gdGhpcy52YWx1ZS5tYXAodiA9PiB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIG5hbWU6IHYubmFtZSxcbiAgICAgICAgICAgICAgICB2YWx1ZTogdi52YWx1ZVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBjaGFuZ2VFbWl0KCkge1xuICAgICAgICB0aGlzLmNkLmRldGVjdENoYW5nZXMoKTtcbiAgICAgICAgdGhpcy52YWx1ZUNoYW5nZS5lbWl0KHRoaXMudmFsdWUpO1xuICAgIH1cblxuICAgIGNsaWNrQ2FuY2VsKCkge1xuICAgICAgICB0aGlzLmNsb3NlTW9kYWwuZW1pdCgpO1xuICAgIH1cblxuICAgIGNsaWNrQ29uZmlybSgpIHtcbiAgICAgICAgaWYgKCF0aGlzLmNoZWNrQmVmb3JlU2F2ZSgpKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgZW51bURhdGEgPSB0aGlzLm1hcDJFbnVtRGF0YSgpO1xuICAgICAgICB0aGlzLnN1Ym1pdE1vZGFsLmVtaXQoeyB2YWx1ZTogZW51bURhdGEgfSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICog5L+d5a2Y5YmN5qOA5p+lXG4gICAgICovXG4gICAgY2hlY2tCZWZvcmVTYXZlKCk6IGJvb2xlYW4ge1xuXG4gICAgICAgIGNvbnN0IG1zZyA9IHtcbiAgICAgICAgICAgIHR5cGU6ICd3YXJuaW5nJyxcbiAgICAgICAgICAgIHRpdGxlOiAn57O757uf5o+Q56S6JyxcbiAgICAgICAgICAgIG1zZzogJ+ivt+a3u+WKoOaemuS4vuWAvOOAgicsXG4gICAgICAgICAgICB0aW1lb3V0OiAzMDAwXG4gICAgICAgIH07XG5cblxuICAgICAgICAvLyDikaAg56m6XG4gICAgICAgIGlmICghdGhpcy52YWx1ZSB8fCB0aGlzLnZhbHVlLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgdGhpcy5ub3RpZnlTZXJ2aWNlLndhcm5pbmcobXNnKTtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICAvLyDikaEg6Z2e56m677yM5YiZ5qCh6aqM5q+P5Liq55qE6ZSu5YC85piv5ZCm5Li656m677ybXG4gICAgICAgIGZvciAoY29uc3QgaXRlbSBvZiB0aGlzLnZhbHVlKSB7XG4gICAgICAgICAgICBpZiAoIWl0ZW0ubmFtZSB8fCAhaXRlbS52YWx1ZSkge1xuICAgICAgICAgICAgICAgIG1zZy5tc2cgPSAn5p6a5Li+5YC85ZKM5p6a5Li+5ZCN56ew5Z2H5LiN5YWB6K645Li656m644CCJztcbiAgICAgICAgICAgICAgICB0aGlzLm5vdGlmeVNlcnZpY2Uud2FybmluZyhtc2cpO1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICAvLyDikaIg6ZSu5LiN5YWB6K646YeN5aSN77ybXG4gICAgICAgIGNvbnN0IGVudW1LZXlzID0gdGhpcy52YWx1ZS5tYXAoZSA9PiBlLnZhbHVlKTtcbiAgICAgICAgY29uc3Qga2V5U2V0ID0gbmV3IFNldChlbnVtS2V5cyk7XG4gICAgICAgIGNvbnN0IGV4Y2x1c2l2ZUtleXMgPSBBcnJheS5mcm9tKGtleVNldCk7XG4gICAgICAgIGlmIChlbnVtS2V5cy5sZW5ndGggIT09IGV4Y2x1c2l2ZUtleXMubGVuZ3RoKSB7XG4gICAgICAgICAgICBtc2cubXNnID0gJ+aemuS4vuWAvOS4jeWFgeiuuOmHjeWkjeOAgic7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cblxuICAgICAgICAvLyDikaIg5YC85LiN5YWB6K646YeN5aSN77ybXG4gICAgICAgIGNvbnN0IGVudW1OYW1lcyA9IHRoaXMudmFsdWUubWFwKGUgPT4gZS5uYW1lKTtcbiAgICAgICAgY29uc3QgbmFtZVNldCA9IG5ldyBTZXQoZW51bU5hbWVzKTtcbiAgICAgICAgY29uc3QgZXhjbHVzaXZlTmFtZXMgPSBBcnJheS5mcm9tKG5hbWVTZXQpO1xuICAgICAgICBpZiAoZW51bU5hbWVzLmxlbmd0aCAhPT0gZXhjbHVzaXZlTmFtZXMubGVuZ3RoKSB7XG4gICAgICAgICAgICBtc2cubXNnID0gICfmnprkuL7lkI3np7DkuI3lhYHorrjph43lpI3jgIInO1xuICAgICAgICAgICAgdGhpcy5ub3RpZnlTZXJ2aWNlLndhcm5pbmcobXNnKTtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cblxuXG4gICAgYWRkKCkge1xuICAgICAgICB0aGlzLnZhbHVlID0gWyAuLi50aGlzLnZhbHVlLCB7ICBpZDogKHRoaXMudmFsdWUubGVuZ3RoICsgMSksIG5hbWU6ICcnLCB2YWx1ZTogJycgIH0gXTtcbiAgICAgICAgdGhpcy5jaGFuZ2VFbWl0KCk7XG4gICAgfVxuXG4gICAgcmVtb3ZlKCkge1xuICAgICAgICBjb25zdCByb3dzID0gdGhpcy5kZy5jaGVja2VkcztcbiAgICAgICAgaWYgKHJvd3MgJiYgcm93cy5sZW5ndGgpIHtcbiAgICAgICAgICAgIHRoaXMudmFsdWUgPSB0aGlzLnZhbHVlLmZpbHRlciggdiA9PiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHJvd3MuZmluZEluZGV4KHIgPT4gci5pZCA9PT0gdi5pZCkgPT09IC0xO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB0aGlzLmNoYW5nZUVtaXQoKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMubm90aWZ5U2VydmljZS53YXJuaW5nKCfor7fpkqnpgInopoHliKDpmaTnmoTmlbDmja7vvIEnKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGRlbGV0ZUl0ZW0oaWQpIHtcbiAgICAgICAgdGhpcy52YWx1ZSA9IHRoaXMudmFsdWUuZmlsdGVyKCB2ID0+IHtcbiAgICAgICAgICAgIHJldHVybiB2LmlkICE9PSBpZDtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuY2hhbmdlRW1pdCgpO1xuICAgIH1cblxuICAgIG1vdmVUb3AoJGV2ZW50OiBNb3VzZUV2ZW50LCBpZCwgaW5kZXgpIHtcbiAgICAgICAgJGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICBjb25zdCBpID0gdGhpcy52YWx1ZS5maW5kSW5kZXgobiA9PiBuLmlkID09PSBpZCk7XG4gICAgICAgIC8vIGNvbnN0IGkgPSBpbmRleDtcbiAgICAgICAgdGhpcy52YWx1ZS51bnNoaWZ0KHRoaXMudmFsdWVbaV0pO1xuICAgICAgICB0aGlzLnZhbHVlLnNwbGljZShpICsgMSwgMSk7XG5cbiAgICAgICAgdGhpcy52YWx1ZSA9IFsuLi50aGlzLnZhbHVlXTtcbiAgICAgICAgdGhpcy5jaGFuZ2VFbWl0KCk7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICBtb3ZlQm90dG9tKCRldmVudCwgaWQsIGluZGV4KSB7XG4gICAgICAgICRldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgY29uc3QgaSA9IHRoaXMudmFsdWUuZmluZEluZGV4KG4gPT4gbi5pZCA9PT0gaWQpO1xuICAgICAgICAvLyBjb25zdCBpID0gaW5kZXg7XG4gICAgICAgIHRoaXMudmFsdWUucHVzaCh0aGlzLnZhbHVlW2ldKTtcbiAgICAgICAgdGhpcy52YWx1ZS5zcGxpY2UoaSwgMSk7XG4gICAgICAgIHRoaXMudmFsdWUgPSBbLi4udGhpcy52YWx1ZV07XG4gICAgICAgIHRoaXMuY2hhbmdlRW1pdCgpO1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgbW92ZVVwKCRldmVudCwgaWQsIGluZGV4KSB7XG4gICAgICAgICRldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgY29uc3QgaSA9IHRoaXMudmFsdWUuZmluZEluZGV4KG4gPT4gbi5pZCA9PT0gaWQpO1xuICAgICAgICAvLyBjb25zdCBpID0gaW5kZXg7XG4gICAgICAgIGlmIChpICE9PSAwKSB7XG4gICAgICAgICAgICBjb25zdCB0ZW1wQXJyID0gdGhpcy52YWx1ZS5zcGxpY2UoaSwgMSk7XG4gICAgICAgICAgICB0aGlzLnZhbHVlLnNwbGljZShpIC0gMSwgMCwgLi4udGVtcEFycik7XG4gICAgICAgICAgICB0aGlzLnZhbHVlID0gWy4uLnRoaXMudmFsdWVdO1xuICAgICAgICAgICAgdGhpcy5jaGFuZ2VFbWl0KCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIG1vdmVEb3duKCRldmVudCwgaWQsIGluZGV4KSB7XG4gICAgICAgICRldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgY29uc3QgbGVuID0gdGhpcy52YWx1ZS5sZW5ndGg7XG4gICAgICAgIGNvbnN0IGkgPSB0aGlzLnZhbHVlLmZpbmRJbmRleChuID0+IG4uaWQgPT09IGlkKTtcbiAgICAgICAgLy8gY29uc3QgaSA9IGluZGV4O1xuICAgICAgICBpZiAoaSAhPT0gbGVuIC0gMSkge1xuICAgICAgICAgICAgY29uc3QgdGVtcEFyciA9IHRoaXMudmFsdWUuc3BsaWNlKGksIDEpO1xuICAgICAgICAgICAgdGhpcy52YWx1ZS5zcGxpY2UoaSArIDEsIDAsIC4uLnRlbXBBcnIpO1xuICAgICAgICAgICAgdGhpcy52YWx1ZSA9IFsuLi50aGlzLnZhbHVlXTtcbiAgICAgICAgICAgIHRoaXMuY2hhbmdlRW1pdCgpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG59XG4iXX0=
/**
 * @fileoverview added by tsickle
 * Generated from: lib/service/f-file-uploader.service.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { EventEmitter, Injector, Optional } from "@angular/core";
import { Observable, Subject } from "rxjs";
import { mergeMap, finalize } from "rxjs/operators";
import { FFileUtils } from "../utils/index";
import { UploadStatus, UploadServerService, } from "../model/index";
import { LocaleService } from "@farris/ui-locale";
export class FFileUploaderService {
    /**
     * @param {?} uploadServerSer
     * @param {?} inject
     */
    constructor(uploadServerSer, inject) {
        this.uploadServerSer = uploadServerSer;
        this.inject = inject;
        this.allowedContentTypes = ["*"];
        //默认不限制,0代表不限制 Number.POSITIVE_INFINITY
        this.maxUploads = 0;
        /**
         * 单位M，默认是12M,0代表不限制
         */
        this.maxFileSize = 12;
        this.concurrency = Number.POSITIVE_INFINITY;
        this.uploadedCount = 0;
        // 不允许名称中包含特殊字符
        this.notAllowedCharsInFileName = [];
        this.extendServerConfig = null;
        this.hasLocalSer = false;
        this.queue = [];
        this.serviceEvents = new EventEmitter();
        // 看是否多语言服务已更新
        this.hasLocalSer = FFileUtils.getLocalState(null);
        // 为多语言服务赋值
        if (this.inject && !this.hasLocalSer) {
            this.hasLocalSer = FFileUtils.getLocalState(this.inject.get(LocaleService));
        }
        this.uploadScheduler = new Subject();
        this.subs = [];
        this.uploadScheduler
            .pipe(mergeMap((/**
         * @param {?} upload
         * @return {?}
         */
        (upload) => {
            return this.serverMethod(upload);
        }), this.concurrency))
            .subscribe((/**
         * @param {?} uploadOutput
         * @return {?}
         */
        (uploadOutput) => {
            // if (uploadOutput.type == 'removed' || uploadOutput.type == 'done') {
            //   // 删除或者done移除
            //   const subIndex = this.subs.findIndex(sub => sub.id === uploadOutput.file.id);
            //   if (subIndex > -1 && this.subs[subIndex].sub) {
            //     this.subs[subIndex].sub.unsubscribe();
            //   }
            //   this.subs.splice(subIndex, 1);
            // }
            if (uploadOutput.type == "removed") {
                // 事件中返回的都是
                this.queue = this.queue.filter((/**
                 * @param {?} item
                 * @return {?}
                 */
                (item) => item.progress.status !== UploadStatus.Remove));
                if (!uploadOutput.hasOwnProperty("message")) {
                    uploadOutput["message"] = FFileUtils.getLocalStr("uploadService.removed");
                }
            }
            if (uploadOutput.type == "error") {
                // 上传失败的附件移除
                this.queue = this.queue.filter((/**
                 * @param {?} queueItem
                 * @return {?}
                 */
                (queueItem) => {
                    return (uploadOutput.files.findIndex((/**
                     * @param {?} item
                     * @return {?}
                     */
                    (item) => queueItem.id == item.id)) <
                        0);
                }));
            }
            this.serviceEvents.emit(uploadOutput);
        }));
    }
    /**
     * @param {?} options
     * @return {?}
     */
    setOptions(options) {
        // 重置文件大小、类型、个数限制
        if (options) {
            for (let prop in options) {
                this[prop] = options[prop];
            }
        }
    }
    /**
     * @param {?} incomingFiles
     * @return {?}
     */
    handleFiles(incomingFiles) {
        /** @type {?} */
        const allowedIncomingFiles = [].reduce.call(incomingFiles, (/**
         * @param {?} acc
         * @param {?} checkFile
         * @param {?} i
         * @return {?}
         */
        (acc, checkFile, i) => {
            /** @type {?} */
            const futureQueueLength = acc.length + this.queue.length + 1;
            /** @type {?} */
            let judgeResult = this.rejectedReason(checkFile.name, checkFile.type, futureQueueLength, checkFile.size);
            if (judgeResult.allowed) {
                acc = acc.concat(checkFile);
            }
            else {
                // 不符合当前文件类型或者内容超出限制，抛出事件
                /** @type {?} */
                const rejectedFile = FFileUtils.makeUploadFile(checkFile, i);
                this.serviceEvents.emit({
                    type: "rejected",
                    file: rejectedFile,
                    message: judgeResult.message,
                });
            }
            return acc;
        }), []);
        // 构造文件结构，并单个抛出事件
        [].map.call(allowedIncomingFiles, (/**
         * @param {?} file
         * @param {?} i
         * @return {?}
         */
        (file, i) => {
            /** @type {?} */
            const uploadFile = FFileUtils.makeUploadFile(file, i);
            this.queue.push(uploadFile);
            this.serviceEvents.emit({ type: "addedToQueue", file: uploadFile });
        }));
        // 所有的文件都已经添加，抛出事件
        this.serviceEvents.emit({ type: "allAddedToQueue" });
    }
    /**
     * @private
     * @param {?} name
     * @param {?} type
     * @param {?} queuelength
     * @param {?} size
     * @return {?}
     */
    rejectedReason(name, type, queuelength, size) {
        /** @type {?} */
        let allowed = false;
        /** @type {?} */
        let message = "";
        // 已存在同名文件
        /** @type {?} */
        let findDuplicateIndex = this.queue.findIndex((/**
         * @param {?} file
         * @return {?}
         */
        (file) => file.name == name));
        if (findDuplicateIndex > -1) {
            message = FFileUtils.getLocalStr("uploadService.failedSameName");
        }
        else if (!this.isContentTypeAllowed(name)) {
            message = FFileUtils.getLocalStr("uploadService.failedType", [this.allowedContentTypes.join(",")]);
        }
        else if (!this.isNameAllowed(name)) {
            /** @type {?} */
            let notAllowedLen = this.notAllowedCharsInFileName.length;
            /** @type {?} */
            let tMssage = '';
            this.notAllowedCharsInFileName.map((/**
             * @param {?} notAllowItem
             * @param {?} curIndex
             * @return {?}
             */
            (notAllowItem, curIndex) => {
                tMssage += `<b style="display:inline-block;margin:0 4px;min-width:8px;text-align: center;">${notAllowItem ? notAllowItem : "&nbsp;"}</b>`;
                if (curIndex != notAllowedLen - 1) {
                    tMssage += ",";
                }
            }));
            message = FFileUtils.getLocalStr("uploadService.failedName", [tMssage]);
        }
        else if (this.maxUploads > 0 &&
            (this.maxUploads <= this.uploadedCount ||
                queuelength + this.uploadedCount > this.maxUploads)) {
            message = FFileUtils.getLocalStr("uploadService.failedCount", [this.maxUploads + '']);
        }
        else if (!this.isFileSizeAllowed(size)) {
            message = FFileUtils.getLocalStr("uploadService.failedSize", [this.maxFileSize + '']);
        }
        else if (size == 0) {
            message = FFileUtils.getLocalStr("uploadService.failedEmpty");
        }
        else {
            allowed = true;
        }
        return {
            allowed,
            message,
        };
    }
    /**
     * 从前端传来事件，进行服务器端方法类型判断
     * @param {?} input
     * @return {?}
     */
    initInputEvents(input) {
        return input.subscribe((/**
         * @param {?} event
         * @return {?}
         */
        (event) => {
            switch (event.type) {
                case 'sliceUpload':
                    /** @type {?} */
                    const _files = this.queue.filter((/**
                     * @param {?} file
                     * @return {?}
                     */
                    (file) => file.progress.status === UploadStatus.Queue && (!event.file || file.fileIndex === event.file.fileIndex)));
                    if (_files.length > 0) {
                        this.uploadScheduler.next({
                            files: _files,
                            event: event,
                            file: null,
                        });
                    }
                    break;
                case "upload":
                case "multipartUpload":
                    /** @type {?} */
                    const uploadFileIndex = this.queue.findIndex((/**
                     * @param {?} file
                     * @return {?}
                     */
                    (file) => file === event.file));
                    if (uploadFileIndex !== -1 && event.file) {
                        this.uploadScheduler.next({
                            files: [this.queue[uploadFileIndex]],
                            event: event,
                            file: null,
                        });
                    }
                    break;
                case "uploadAll":
                    /** @type {?} */
                    const files = this.queue.filter((/**
                     * @param {?} file
                     * @return {?}
                     */
                    (file) => file.progress.status === UploadStatus.Queue));
                    if (files.length > 0) {
                        event.type = "upload";
                        this.uploadScheduler.next({
                            files: files,
                            event: event,
                            file: null,
                        });
                    }
                    break;
                case "cancel":
                    /** @type {?} */
                    const id = event.id || null;
                    if (!id) {
                        return;
                    }
                    /** @type {?} */
                    const fileIndex = this.queue.findIndex((/**
                     * @param {?} file
                     * @return {?}
                     */
                    (file) => file.id === id));
                    if (fileIndex !== -1) {
                        this.serviceEvents.emit({
                            type: "cancelled",
                            files: [this.queue[fileIndex]],
                            message: FFileUtils.getLocalStr("uploadService.cancelUpload")
                        });
                        this.queue.splice(fileIndex, 1);
                    }
                    break;
                    // case 'cancel':
                    // const id = event.id || null;
                    // if (!id) {
                    //   return;
                    // }
                    // const subs = this.subs.filter(sub => sub.id === id);
                    // subs.forEach(sub => {
                    //   if (sub.sub) {
                    //     sub.sub.unsubscribe();
                    //     const fileIndex = this.queue.findIndex(file => file.id === id);
                    //     if (fileIndex !== -1) {
                    //       this.queue[fileIndex].progress.status = UploadStatus.Cancelled;
                    //       this.serviceEvents.emit({ type: 'cancelled', file: this.queue[fileIndex] });
                    //     }
                    //   }
                    // });
                    break;
                // case 'cancelAll':
                //   this.subs.forEach(sub => {
                //     if (sub.sub) {
                //       sub.sub.unsubscribe();
                //     }
                //     const file = this.queue.find(uploadFile => uploadFile.id === sub.id);
                //     if (file) {
                //       file.progress.status = UploadStatus.Cancelled;
                //       this.serviceEvents.emit({ type: 'cancelled', file: file });
                //     }
                //   });
                //   break;
                case "hide":
                    if (!event.id) {
                        return;
                    }
                    /** @type {?} */
                    let ids = event.id.split(",");
                    this.queue = this.queue.filter((/**
                     * @param {?} file
                     * @return {?}
                     */
                    (file) => {
                        /** @type {?} */
                        let tIndex = ids.findIndex((/**
                         * @param {?} tId
                         * @return {?}
                         */
                        (tId) => tId == file.id));
                        return tIndex > -1 ? false : true;
                    }));
                    break;
                case "cancelAll":
                    // 取消，直接从队列中移除，不用修改状态
                    /** @type {?} */
                    const queueFiles = this.queue.filter((/**
                     * @param {?} uploadFile
                     * @return {?}
                     */
                    (uploadFile) => uploadFile.progress.status === UploadStatus.Queue));
                    if (queueFiles.length) {
                        this.serviceEvents.emit({
                            type: "cancelled",
                            files: queueFiles,
                            message: FFileUtils.getLocalStr("uploadService.cancelUpload"),
                        });
                        this.queue = this.queue.filter((/**
                         * @param {?} uploadFile
                         * @return {?}
                         */
                        (uploadFile) => uploadFile.progress.status != UploadStatus.Queue));
                    }
                    break;
                case "remove":
                    if (!event.id) {
                        return;
                    }
                    /** @type {?} */
                    const removeIndex = this.queue.findIndex((/**
                     * @param {?} file
                     * @return {?}
                     */
                    (file) => file.id === event.id));
                    if (removeIndex !== -1) {
                        // 得有个开始删除和已经删除
                        this.queue[removeIndex].progress.status = UploadStatus.Remove;
                        this.uploadScheduler.next({
                            files: [this.queue[removeIndex]],
                            event: event,
                            file: null,
                        });
                    }
                    break;
                case "removeAll":
                    /** @type {?} */
                    const removeQueueFiles = this.queue.filter((/**
                     * @param {?} uploadFile
                     * @return {?}
                     */
                    (uploadFile) => uploadFile.progress.status === UploadStatus.Queue));
                    if (removeQueueFiles.length) {
                        this.serviceEvents.emit({
                            type: "cancelled",
                            files: removeQueueFiles,
                            message: FFileUtils.getLocalStr("uploadService.deleteSuccess"),
                        });
                        this.queue = this.queue.filter((/**
                         * @param {?} uploadFile
                         * @return {?}
                         */
                        (uploadFile) => uploadFile.progress.status != UploadStatus.Queue));
                    }
                    // 正在上传的附件是如何处理
                    // const doneFiles = this.queue.filter(uploadFile => uploadFile.progress.status === UploadStatus.Done);
                    if (this.queue.length) {
                        event.type = "remove";
                        this.queue.map((/**
                         * @param {?} item
                         * @return {?}
                         */
                        (item) => (item.progress.status = UploadStatus.Remove)));
                        this.uploadScheduler.next({
                            files: this.queue,
                            event: event,
                            file: null,
                        });
                    }
                    break;
            }
        }));
    }
    /**
     * @param {?} extendSer
     * @return {?}
     */
    setExtendServerConfig(extendSer) {
        this.extendServerConfig = extendSer;
    }
    /**
     * @param {?} upload
     * @return {?}
     */
    serverMethod(upload) {
        return new Observable((/**
         * @param {?} observer
         * @return {?}
         */
        (observer) => {
            /** @type {?} */
            let sub;
            /** @type {?} */
            let ids = upload.files.map((/**
             * @param {?} fileItem
             * @return {?}
             */
            (fileItem) => fileItem.id));
            switch (upload.event.type) {
                case 'sliceUpload':
                    sub = this.upload(upload.files, upload.event);
                    break;
                case "upload":
                    sub = this.upload(upload.files, upload.event);
                    break;
                case "multipartUpload":
                    sub = this.multipartUpload(upload.files[0], upload.event);
                    break;
                // case 'uploadAll':
                //   ids = upload.files.map(fileItem => fileItem.id);
                //   sub = this.uploadAll(upload.files, upload.event);
                //   break;
                case "remove":
                    sub = this.remove(upload.files, upload.event);
                    break;
                // case 'removeAll':
                //   ids = upload.files.map(fileItem => fileItem.id);
                //   sub = this.removeAll(upload.files, upload.event);
                //   break;
                default:
                    sub = null;
            }
            if (!sub) {
                return;
            }
            sub.pipe(finalize((/**
             * @return {?}
             */
            () => {
                if (!observer.closed) {
                    observer.complete();
                }
            }))).subscribe((/**
             * @param {?} output
             * @return {?}
             */
            (output) => {
                observer.next(output);
            }), (/**
             * @param {?} err
             * @return {?}
             */
            (err) => {
                observer.next(err);
            }), (/**
             * @return {?}
             */
            () => {
                observer.complete();
            }));
            this.subs.push({ ids: ids, sub: sub, id: "" });
            // switch (upload.event.type) {
            //   case 'uploadAll':
            //     this.subs.push({ ids: ids, sub: sub, id: '' });
            //     break;
            //   case 'removeAll':
            //     this.subs.push({ ids: ids, sub: sub, id: '' });
            //     break;
            //   default:
            // }
        }));
    }
    /**
     * 单个文件上传
     * @param {?} file
     * @param {?} event
     * @return {?}
     */
    // uploadFile(file: UploadFile, event: UploadInput): Observable<UploadOutput> {
    //   const uploadFile = <BlobFile>file.nativeFile;
    //   const uploadIndex = this.queue.findIndex(outFile => outFile.nativeFile === uploadFile);
    //   // 已经被取消的不能被上传
    //   if (this.queue[uploadIndex].progress.status === UploadStatus.Cancelled) {
    //     return new Observable(observer => {
    //       observer.complete();
    //     });
    //   }
    //   // 抛出开始上传的事件
    //   this.serviceEvents.emit({ type: 'start', files: [file] });
    //   return this.uploadServerSer.upload(file, event, this.extendServerConfig);
    // }
    multipartUpload(file, event) {
        // 抛出开始上传的事件
        this.serviceEvents.emit({ type: "start", files: [file] });
        return this.uploadServerSer.multipartUpload(file, event, this.extendServerConfig);
    }
    /**
     * @param {?} files
     * @param {?} event
     * @return {?}
     */
    upload(files, event) {
        // 抛出开始上传的事件
        this.serviceEvents.emit({ type: "start", files: files });
        return this.uploadServerSer.upload(files, event, this.extendServerConfig);
    }
    /**
     * @param {?} files
     * @param {?} event
     * @return {?}
     */
    remove(files, event) {
        return this.uploadServerSer.remove(files, event, this.extendServerConfig);
    }
    // removeAll(files: UploadFile[], event: UploadInput): Observable<UploadOutput> {
    //   return this.uploadServerSer.removeAll(files, event, this.extendServerConfig);
    // }
    // 重置
    /**
     * @return {?}
     */
    reset() {
        this.queue = [];
        //this.uploadScheduler = new Subject();
        // this.subs.forEach(sub => {
        //   if (sub.sub) {
        //     sub.sub.unsubscribe();
        //   }
        // });
        this.subs = [];
    }
    // 暂时
    /**
     * @param {?} contentTypes
     * @return {?}
     */
    setContentTypes(contentTypes) {
        if (typeof contentTypes !== "undefined" && contentTypes instanceof Array) {
            if (contentTypes.find((/**
             * @param {?} type
             * @return {?}
             */
            (type) => type === "*")) !== undefined) {
                this.allowedContentTypes = ["*"];
            }
            else {
                this.allowedContentTypes = contentTypes;
            }
            return;
        }
        this.allowedContentTypes = ["*"];
    }
    /**
     * @return {?}
     */
    allContentTypesAllowed() {
        return (this.allowedContentTypes.find((/**
         * @param {?} type
         * @return {?}
         */
        (type) => type === "*")) !==
            undefined);
    }
    /**
     *
     * @param {?} name
     * @return {?}
     */
    isContentTypeAllowed(name) {
        if (this.allContentTypesAllowed()) {
            return true;
        }
        // 附件没有后缀
        if (name.lastIndexOf(".") < 0) {
            return false;
        }
        /** @type {?} */
        let namesuffix = name.substr(name.lastIndexOf("."));
        // 简化计算
        return (this.allowedContentTypes.findIndex((/**
         * @param {?} item
         * @return {?}
         */
        (item) => item.toLowerCase() == namesuffix.toLowerCase())) > -1);
    }
    /**
     * @private
     * @param {?} name
     * @return {?}
     */
    isNameAllowed(name) {
        if (!this.notAllowedCharsInFileName || this.notAllowedCharsInFileName.length == 0) {
            return true;
        }
        /** @type {?} */
        let purName = name.lastIndexOf(".") > -1 ? name.substr(0, name.lastIndexOf(".")) : name;
        // 简化计算
        return !(this.notAllowedCharsInFileName.findIndex((/**
         * @param {?} item
         * @return {?}
         */
        (item) => purName.indexOf(item) > -1)) > -1);
    }
    /**
     * @param {?} fileSize
     * @return {?}
     */
    isFileSizeAllowed(fileSize) {
        if (!this.maxFileSize) {
            return true;
        }
        // fileSize是b单位 maxFileSize是MB单位
        return fileSize <= this.maxFileSize * 1024 * 1024; // * 8
    }
}
/** @nocollapse */
FFileUploaderService.ctorParameters = () => [
    { type: UploadServerService, decorators: [{ type: Optional }] },
    { type: Injector, decorators: [{ type: Optional }] }
];
if (false) {
    /** @type {?} */
    FFileUploaderService.prototype.queue;
    /** @type {?} */
    FFileUploaderService.prototype.serviceEvents;
    /** @type {?} */
    FFileUploaderService.prototype.uploadScheduler;
    /** @type {?} */
    FFileUploaderService.prototype.subs;
    /** @type {?} */
    FFileUploaderService.prototype.allowedContentTypes;
    /** @type {?} */
    FFileUploaderService.prototype.maxUploads;
    /**
     * 单位M，默认是12M,0代表不限制
     * @type {?}
     */
    FFileUploaderService.prototype.maxFileSize;
    /** @type {?} */
    FFileUploaderService.prototype.concurrency;
    /** @type {?} */
    FFileUploaderService.prototype.uploadedCount;
    /** @type {?} */
    FFileUploaderService.prototype.notAllowedCharsInFileName;
    /**
     * @type {?}
     * @private
     */
    FFileUploaderService.prototype.extendServerConfig;
    /**
     * @type {?}
     * @private
     */
    FFileUploaderService.prototype.hasLocalSer;
    /**
     * @type {?}
     * @private
     */
    FFileUploaderService.prototype.uploadServerSer;
    /**
     * @type {?}
     * @private
     */
    FFileUploaderService.prototype.inject;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZi1maWxlLXVwbG9hZGVyLnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL2V4dGVuZC1maWxlLXVwbG9hZC8iLCJzb3VyY2VzIjpbImxpYi9zZXJ2aWNlL2YtZmlsZS11cGxvYWRlci5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsT0FBTyxFQUFFLFlBQVksRUFBRSxRQUFRLEVBQUUsUUFBUSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ2pFLE9BQU8sRUFBRSxVQUFVLEVBQUUsT0FBTyxFQUFvQixNQUFNLE1BQU0sQ0FBQztBQUM3RCxPQUFPLEVBQUUsUUFBUSxFQUFFLFFBQVEsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ3BELE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUM1QyxPQUFPLEVBSUgsWUFBWSxFQUVaLG1CQUFtQixHQUV0QixNQUFNLGdCQUFnQixDQUFDO0FBQ3hCLE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUdsRCxNQUFNLE9BQU8sb0JBQW9COzs7OztJQW9CN0IsWUFBZ0MsZUFBb0MsRUFBcUIsTUFBZTtRQUF4RSxvQkFBZSxHQUFmLGVBQWUsQ0FBcUI7UUFBcUIsV0FBTSxHQUFOLE1BQU0sQ0FBUztRQVh4Ryx3QkFBbUIsR0FBYSxDQUFDLEdBQUcsQ0FBQyxDQUFDOztRQUV0QyxlQUFVLEdBQVcsQ0FBQyxDQUFDOzs7O1FBRXZCLGdCQUFXLEdBQVcsRUFBRSxDQUFDO1FBQ3pCLGdCQUFXLEdBQVcsTUFBTSxDQUFDLGlCQUFpQixDQUFDO1FBQy9DLGtCQUFhLEdBQVcsQ0FBQyxDQUFDOztRQUUxQiw4QkFBeUIsR0FBQyxFQUFFLENBQUM7UUFDckIsdUJBQWtCLEdBQUcsSUFBSSxDQUFDO1FBQzFCLGdCQUFXLEdBQUMsS0FBSyxDQUFDO1FBRXRCLElBQUksQ0FBQyxLQUFLLEdBQUcsRUFBRSxDQUFDO1FBQ2hCLElBQUksQ0FBQyxhQUFhLEdB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SUFDN0Isa0RBQWtDOzs7OztJQUNsQywyQ0FBMEI7Ozs7O0lBQ2QsK0NBQXdEOzs7OztJQUFDLHNDQUFtQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEV2ZW50RW1pdHRlciwgSW5qZWN0b3IsIE9wdGlvbmFsIH0gZnJvbSBcIkBhbmd1bGFyL2NvcmVcIjtcclxuaW1wb3J0IHsgT2JzZXJ2YWJsZSwgU3ViamVjdCwgU3Vic2NyaXB0aW9uLCBvZiB9IGZyb20gXCJyeGpzXCI7XHJcbmltcG9ydCB7IG1lcmdlTWFwLCBmaW5hbGl6ZSB9IGZyb20gXCJyeGpzL29wZXJhdG9yc1wiO1xyXG5pbXBvcnQgeyBGRmlsZVV0aWxzIH0gZnJvbSBcIi4uL3V0aWxzL2luZGV4XCI7XHJcbmltcG9ydCB7XHJcbiAgICBVcGxvYWRGaWxlLFxyXG4gICAgVXBsb2FkT3V0cHV0LFxyXG4gICAgVXBsb2FkSW5wdXQsXHJcbiAgICBVcGxvYWRTdGF0dXMsXHJcbiAgICBCbG9iRmlsZSxcclxuICAgIFVwbG9hZFNlcnZlclNlcnZpY2UsXHJcbiAgICBVcGxvYWRlck9wdGlvbnMsXHJcbn0gZnJvbSBcIi4uL21vZGVsL2luZGV4XCI7XHJcbmltcG9ydCB7IExvY2FsZVNlcnZpY2UgfSBmcm9tIFwiQGZhcnJpcy91aS1sb2NhbGVcIjtcclxuaW1wb3J0IHsgRkFSUklTX1VQTE9BREZJTEVfTE9DQUxFREFUQSB9IGZyb20gXCIuLi9sb2NhbGVcIjtcclxuXHJcbmV4cG9ydCBjbGFzcyBGRmlsZVVwbG9hZGVyU2VydmljZSB7XHJcbiAgICBxdWV1ZTogVXBsb2FkRmlsZVtdO1xyXG4gICAgc2VydmljZUV2ZW50czogRXZlbnRFbWl0dGVyPFVwbG9hZE91dHB1dD47XHJcbiAgICB1cGxvYWRTY2hlZHVsZXI6IFN1YmplY3Q8e1xyXG4gICAgICAgIGZpbGU6IFVwbG9hZEZpbGU7XHJcbiAgICAgICAgZXZlbnQ6IFVwbG9hZElucHV0O1xyXG4gICAgICAgIGZpbGVzPzogVXBsb2FkRmlsZVtdO1xyXG4gICAgfT47XHJcbiAgICBzdWJzOiB7IGlkOiBzdHJpbmc7IHN1YjogU3Vic2NyaXB0aW9uOyBpZHM/OiBzdHJpbmdbXSB9W107XHJcbiAgICBhbGxvd2VkQ29udGVudFR5cGVzOiBzdHJpbmdbXSA9IFtcIipcIl07XHJcbiAgICAvL+m7mOiupOS4jemZkOWItiww5Luj6KGo5LiN6ZmQ5Yi2IE51bWJlci5QT1NJVElWRV9JTkZJTklUWVxyXG4gICAgbWF4VXBsb2FkczogbnVtYmVyID0gMDtcclxuICAgIC8qKiDljZXkvY1N77yM6buY6K6k5pivMTJNLDDku6PooajkuI3pmZDliLYgKi9cclxuICAgIG1heEZpbGVTaXplOiBudW1iZXIgPSAxMjtcclxuICAgIGNvbmN1cnJlbmN5OiBudW1iZXIgPSBOdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFk7XHJcbiAgICB1cGxvYWRlZENvdW50OiBudW1iZXIgPSAwO1xyXG4gICAgLy8g5LiN5YWB6K645ZCN56ew5Lit5YyF5ZCr54m55q6K5a2X56ymXHJcbiAgICBub3RBbGxvd2VkQ2hhcnNJbkZpbGVOYW1lPVtdO1xyXG4gICAgcHJpdmF0ZSBleHRlbmRTZXJ2ZXJDb25maWcgPSBudWxsO1xyXG4gICAgcHJpdmF0ZSBoYXNMb2NhbFNlcj1mYWxzZTtcclxuICAgIGNvbnN0cnVjdG9yKEBPcHRpb25hbCgpIHByaXZhdGUgdXBsb2FkU2VydmVyU2VyOiBVcGxvYWRTZXJ2ZXJTZXJ2aWNlLEBPcHRpb25hbCgpIHByaXZhdGUgaW5qZWN0OkluamVjdG9yICkge1xyXG4gICAgICAgIHRoaXMucXVldWUgPSBbXTtcclxuICAgICAgICB0aGlzLnNlcnZpY2VFdmVudHMgPSBuZXcgRXZlbnRFbWl0dGVyPFVwbG9hZE91dHB1dD4oKTtcclxuICAgICAgICAvLyDnnIvmmK/lkKblpJror63oqIDmnI3liqHlt7Lmm7TmlrBcclxuICAgICAgICB0aGlzLmhhc0xvY2FsU2VyPUZGaWxlVXRpbHMuZ2V0TG9jYWxTdGF0ZShudWxsKTtcclxuICAgICAgICAvLyDkuLrlpJror63oqIDmnI3liqHotYvlgLxcclxuICAgICAgICBpZih0aGlzLmluamVjdCYmIXRoaXMuaGFzTG9jYWxTZXIpe1xyXG4gICAgICAgICAgIHRoaXMuaGFzTG9jYWxTZXI9RkZpbGVVdGlscy5nZXRMb2NhbFN0YXRlKHRoaXMuaW5qZWN0LmdldChMb2NhbGVTZXJ2aWNlKSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMudXBsb2FkU2NoZWR1bGVyID0gbmV3IFN1YmplY3QoKTtcclxuICAgICAgICB0aGlzLnN1YnMgPSBbXTsgICAgICBcclxuICAgICAgICB0aGlzLnVwbG9hZFNjaGVkdWxlclxyXG4gICAgICAgICAgICAucGlwZShcclxuICAgICAgICAgICAgICAgIG1lcmdlTWFwKCh1cGxvYWQpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5zZXJ2ZXJNZXRob2QodXBsb2FkKTtcclxuICAgICAgICAgICAgICAgIH0sIHRoaXMuY29uY3VycmVuY3kpXHJcbiAgICAgICAgICAgIClcclxuICAgICAgICAgICAgLnN1YnNjcmliZSgodXBsb2FkT3V0cHV0KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAvLyBpZiAodXBsb2FkT3V0cHV0LnR5cGUgPT0gJ3JlbW92ZWQnIHx8IHVwbG9hZE91dHB1dC50eXBlID09ICdkb25lJykge1xyXG4gICAgICAgICAgICAgICAgLy8gICAvLyDliKDpmaTmiJbogIVkb25l56e76ZmkXHJcbiAgICAgICAgICAgICAgICAvLyAgIGNvbnN0IHN1YkluZGV4ID0gdGhpcy5zdWJzLmZpbmRJbmRleChzdWIgPT4gc3ViLmlkID09PSB1cGxvYWRPdXRwdXQuZmlsZS5pZCk7XHJcbiAgICAgICAgICAgICAgICAvLyAgIGlmIChzdWJJbmRleCA+IC0xICYmIHRoaXMuc3Vic1tzdWJJbmRleF0uc3ViKSB7XHJcbiAgICAgICAgICAgICAgICAvLyAgICAgdGhpcy5zdWJzW3N1YkluZGV4XS5zdWIudW5zdWJzY3JpYmUoKTtcclxuICAgICAgICAgICAgICAgIC8vICAgfVxyXG4gICAgICAgICAgICAgICAgLy8gICB0aGlzLnN1YnMuc3BsaWNlKHN1YkluZGV4LCAxKTtcclxuICAgICAgICAgICAgICAgIC8vIH1cclxuICAgICAgICAgICAgICAgIGlmICh1cGxvYWRPdXRwdXQudHlwZSA9PSBcInJlbW92ZWRcIikge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIOS6i+S7tuS4rei/lOWbnueahOmDveaYr1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMucXVldWUgPSB0aGlzLnF1ZXVlLmZpbHRlcihcclxuICAgICAgICAgICAgICAgICAgICAgICAgKGl0ZW0pID0+IGl0ZW0ucHJvZ3Jlc3Muc3RhdHVzICE9PSBVcGxvYWRTdGF0dXMuUmVtb3ZlXHJcbiAgICAgICAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIXVwbG9hZE91dHB1dC5oYXNPd25Qcm9wZXJ0eShcIm1lc3NhZ2VcIikpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdXBsb2FkT3V0cHV0W1wibWVzc2FnZVwiXSA9RkZpbGVVdGlscy5nZXRMb2NhbFN0cihcInVwbG9hZFNlcnZpY2UucmVtb3ZlZFwiKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAodXBsb2FkT3V0cHV0LnR5cGUgPT0gXCJlcnJvclwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8g5LiK5Lyg5aSx6LSl55qE6ZmE5Lu256e76ZmkXHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5xdWV1ZSA9IHRoaXMucXVldWUuZmlsdGVyKChxdWV1ZUl0ZW0pID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIChcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVwbG9hZE91dHB1dC5maWxlcy5maW5kSW5kZXgoKGl0ZW0pID0+IHF1ZXVlSXRlbS5pZCA9PSBpdGVtLmlkKSA8XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAwXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNlcnZpY2VFdmVudHMuZW1pdCh1cGxvYWRPdXRwdXQpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgIH1cclxuICAgIHNldE9wdGlvbnMob3B0aW9uczogVXBsb2FkZXJPcHRpb25zKSB7XHJcbiAgICAgICAgLy8g6YeN572u5paH5Lu25aSn5bCP44CB57G75Z6L44CB5Liq5pWw6ZmQ5Yi2XHJcbiAgICAgICAgaWYgKG9wdGlvbnMpIHtcclxuICAgICAgICAgICAgZm9yIChsZXQgcHJvcCBpbiBvcHRpb25zKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzW3Byb3BdID0gb3B0aW9uc1twcm9wXTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGhhbmRsZUZpbGVzKGluY29taW5nRmlsZXM6IEZpbGVMaXN0KTogdm9pZCB7XHJcbiAgICAgICAgY29uc3QgYWxsb3dlZEluY29taW5nRmlsZXM6IEZpbGVbXSA9IFtdLnJlZHVjZS5jYWxsKFxyXG4gICAgICAgICAgICBpbmNvbWluZ0ZpbGVzLFxyXG4gICAgICAgICAgICAoYWNjOiBGaWxlW10sIGNoZWNrRmlsZTogRmlsZSwgaTogbnVtYmVyKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBmdXR1cmVRdWV1ZUxlbmd0aCA9IGFjYy5sZW5ndGggKyB0aGlzLnF1ZXVlLmxlbmd0aCArIDE7XHJcbiAgICAgICAgICAgICAgICBsZXQganVkZ2VSZXN1bHQgPSB0aGlzLnJlamVjdGVkUmVhc29uKFxyXG4gICAgICAgICAgICAgICAgICAgIGNoZWNrRmlsZS5uYW1lLFxyXG4gICAgICAgICAgICAgICAgICAgIGNoZWNrRmlsZS50eXBlLFxyXG4gICAgICAgICAgICAgICAgICAgIGZ1dHVyZVF1ZXVlTGVuZ3RoLFxyXG4gICAgICAgICAgICAgICAgICAgIGNoZWNrRmlsZS5zaXplXHJcbiAgICAgICAgICAgICAgICApO1xyXG4gICAgICAgICAgICAgICAgaWYgKGp1ZGdlUmVzdWx0LmFsbG93ZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICBhY2MgPSBhY2MuY29uY2F0KGNoZWNrRmlsZSk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIOS4jeespuWQiOW9k+WJjeaWh+S7tuexu+Wei+aIluiAheWGheWuuei2heWHuumZkOWItu+8jOaKm+WHuuS6i+S7tlxyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlamVjdGVkRmlsZTogVXBsb2FkRmlsZSA9IEZGaWxlVXRpbHMubWFrZVVwbG9hZEZpbGUoXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNoZWNrRmlsZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgaVxyXG4gICAgICAgICAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXJ2aWNlRXZlbnRzLmVtaXQoe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcInJlamVjdGVkXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpbGU6IHJlamVjdGVkRmlsZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZToganVkZ2VSZXN1bHQubWVzc2FnZSxcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHJldHVybiBhY2M7XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIFtdXHJcbiAgICAgICAgKTtcclxuXHJcbiAgICAgICAgLy8g5p6E6YCg5paH5Lu257uT5p6E77yM5bm25Y2V5Liq5oqb5Ye65LqL5Lu2XHJcbiAgICAgICAgW10ubWFwLmNhbGwoYWxsb3dlZEluY29taW5nRmlsZXMsIChmaWxlOiBGaWxlLCBpOiBudW1iZXIpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgdXBsb2FkRmlsZTogVXBsb2FkRmlsZSA9IEZGaWxlVXRpbHMubWFrZVVwbG9hZEZpbGUoZmlsZSwgaSk7XHJcbiAgICAgICAgICAgIHRoaXMucXVldWUucHVzaCh1cGxvYWRGaWxlKTtcclxuICAgICAgICAgICAgdGhpcy5zZXJ2aWNlRXZlbnRzLmVtaXQoeyB0eXBlOiBcImFkZGVkVG9RdWV1ZVwiLCBmaWxlOiB1cGxvYWRGaWxlIH0pO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICAvLyDmiYDmnInnmoTmlofku7bpg73lt7Lnu4/mt7vliqDvvIzmipvlh7rkuovku7ZcclxuICAgICAgICB0aGlzLnNlcnZpY2VFdmVudHMuZW1pdCh7IHR5cGU6IFwiYWxsQWRkZWRUb1F1ZXVlXCIgfSk7XHJcbiAgICB9XHJcbiAgICBwcml2YXRlIHJlamVjdGVkUmVhc29uKG5hbWUsIHR5cGUsIHF1ZXVlbGVuZ3RoLCBzaXplKSB7XHJcbiAgICAgICAgbGV0IGFsbG93ZWQgPSBmYWxzZTtcclxuICAgICAgICBsZXQgbWVzc2FnZSA9IFwiXCI7XHJcbiAgICAgICAgLy8g5bey5a2Y5Zyo5ZCM5ZCN5paH5Lu2XHJcbiAgICAgICAgbGV0IGZpbmREdXBsaWNhdGVJbmRleCA9IHRoaXMucXVldWUuZmluZEluZGV4KChmaWxlKSA9PiBmaWxlLm5hbWUgPT0gbmFtZSk7XHJcbiAgICAgICAgaWYgKGZpbmREdXBsaWNhdGVJbmRleCA+IC0xKSB7XHJcbiAgICAgICAgICAgIG1lc3NhZ2UgPUZGaWxlVXRpbHMuZ2V0TG9jYWxTdHIoXCJ1cGxvYWRTZXJ2aWNlLmZhaWxlZFNhbWVOYW1lXCIpO1xyXG4gICAgICAgIH0gZWxzZSBpZiAoIXRoaXMuaXNDb250ZW50VHlwZUFsbG93ZWQobmFtZSkpIHtcclxuICAgICAgICAgICAgbWVzc2FnZSA9RkZpbGVVdGlscy5nZXRMb2NhbFN0cihcInVwbG9hZFNlcnZpY2UuZmFpbGVkVHlwZVwiLFt0aGlzLmFsbG93ZWRDb250ZW50VHlwZXMuam9pbihcIixcIildKTtcclxuICAgICAgICB9IGVsc2UgaWYoIXRoaXMuaXNOYW1lQWxsb3dlZChuYW1lKSl7XHJcbiAgICAgICAgICAgIGxldCBub3RBbGxvd2VkTGVuPXRoaXMubm90QWxsb3dlZENoYXJzSW5GaWxlTmFtZS5sZW5ndGg7XHJcbiAgICAgICAgICAgIGxldCB0TXNzYWdlPScnO1xyXG4gICAgICAgICAgICB0aGlzLm5vdEFsbG93ZWRDaGFyc0luRmlsZU5hbWUubWFwKChub3RBbGxvd0l0ZW0sY3VySW5kZXgpPT57XHJcbiAgICAgICAgICAgICAgICB0TXNzYWdlICs9YDxiIHN0eWxlPVwiZGlzcGxheTppbmxpbmUtYmxvY2s7bWFyZ2luOjAgNHB4O21pbi13aWR0aDo4cHg7dGV4dC1hbGlnbjogY2VudGVyO1wiPiR7bm90QWxsb3dJdGVtP25vdEFsbG93SXRlbTpcIiZuYnNwO1wifTwvYj5gO1xyXG4gICAgICAgICAgICAgICAgaWYoY3VySW5kZXghPW5vdEFsbG93ZWRMZW4tMSl7XHJcbiAgICAgICAgICAgICAgICAgICAgdE1zc2FnZSs9XCIsXCJcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIG1lc3NhZ2U9RkZpbGVVdGlscy5nZXRMb2NhbFN0cihcInVwbG9hZFNlcnZpY2UuZmFpbGVkTmFtZVwiLFt0TXNzYWdlXSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKFxyXG4gICAgICAgICAgICB0aGlzLm1heFVwbG9hZHMgPiAwICYmXHJcbiAgICAgICAgICAgICh0aGlzLm1heFVwbG9hZHMgPD0gdGhpcy51cGxvYWRlZENvdW50IHx8XHJcbiAgICAgICAgICAgICAgICBxdWV1ZWxlbmd0aCArIHRoaXMudXBsb2FkZWRDb3VudCA+IHRoaXMubWF4VXBsb2FkcylcclxuICAgICAgICApIHtcclxuICAgICAgICAgICAgbWVzc2FnZSA9RkZpbGVVdGlscy5nZXRMb2NhbFN0cihcInVwbG9hZFNlcnZpY2UuZmFpbGVkQ291bnRcIixbdGhpcy5tYXhVcGxvYWRzKycnXSk7XHJcbiAgICAgICAgfSBlbHNlIGlmICghdGhpcy5pc0ZpbGVTaXplQWxsb3dlZChzaXplKSkge1xyXG4gICAgICAgICAgICBtZXNzYWdlID1GRmlsZVV0aWxzLmdldExvY2FsU3RyKFwidXBsb2FkU2VydmljZS5mYWlsZWRTaXplXCIsW3RoaXMubWF4RmlsZVNpemUrJyddKTtcclxuICAgICAgICB9IGVsc2UgaWYgKHNpemUgPT0gMCkge1xyXG4gICAgICAgICAgICBtZXNzYWdlID1GRmlsZVV0aWxzLmdldExvY2FsU3RyKFwidXBsb2FkU2VydmljZS5mYWlsZWRFbXB0eVwiKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBhbGxvd2VkID0gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgYWxsb3dlZCxcclxuICAgICAgICAgICAgbWVzc2FnZSxcclxuICAgICAgICB9O1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiDku47liY3nq6/kvKDmnaXkuovku7bvvIzov5vooYzmnI3liqHlmajnq6/mlrnms5XnsbvlnovliKTmlq1cclxuICAgICAqIEBwYXJhbSBpbnB1dFxyXG4gICAgICovXHJcbiAgICBpbml0SW5wdXRFdmVudHMoaW5wdXQ6IEV2ZW50RW1pdHRlcjxVcGxvYWRJbnB1dD4pOiBTdWJzY3JpcHRpb24ge1xyXG4gICAgICAgIHJldHVybiBpbnB1dC5zdWJzY3JpYmUoKGV2ZW50OiBVcGxvYWRJbnB1dCkgPT4ge1xyXG4gICAgICAgICAgICBzd2l0Y2ggKGV2ZW50LnR5cGUpIHtcclxuICAgICAgICAgICAgICAgIGNhc2UgJ3NsaWNlVXBsb2FkJzpcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBfZmlsZXMgPSB0aGlzLnF1ZXVlLmZpbHRlcihcclxuICAgICAgICAgICAgICAgICAgICAgICAgKGZpbGUpID0+IGZpbGUucHJvZ3Jlc3Muc3RhdHVzID09PSBVcGxvYWRTdGF0dXMuUXVldWUgJiYgKCFldmVudC5maWxlIHx8IGZpbGUuZmlsZUluZGV4ID09PSBldmVudC5maWxlLmZpbGVJbmRleCApXHJcbiAgICAgICAgICAgICAgICAgICAgKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKF9maWxlcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudXBsb2FkU2NoZWR1bGVyLm5leHQoe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZXM6IF9maWxlcyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50OiBldmVudCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGU6IG51bGwsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgXCJ1cGxvYWRcIjpcclxuICAgICAgICAgICAgICAgIGNhc2UgXCJtdWx0aXBhcnRVcGxvYWRcIjpcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCB1cGxvYWRGaWxlSW5kZXggPSB0aGlzLnF1ZXVlLmZpbmRJbmRleChcclxuICAgICAgICAgICAgICAgICAgICAgICAgKGZpbGUpID0+IGZpbGUgPT09IGV2ZW50LmZpbGVcclxuICAgICAgICAgICAgICAgICAgICApO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh1cGxvYWRGaWxlSW5kZXggIT09IC0xICYmIGV2ZW50LmZpbGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy51cGxvYWRTY2hlZHVsZXIubmV4dCh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlczogW3RoaXMucXVldWVbdXBsb2FkRmlsZUluZGV4XV0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBldmVudDogZXZlbnQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlOiBudWxsLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBjYXNlIFwidXBsb2FkQWxsXCI6XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZmlsZXMgPSB0aGlzLnF1ZXVlLmZpbHRlcihcclxuICAgICAgICAgICAgICAgICAgICAgICAgKGZpbGUpID0+IGZpbGUucHJvZ3Jlc3Muc3RhdHVzID09PSBVcGxvYWRTdGF0dXMuUXVldWVcclxuICAgICAgICAgICAgICAgICAgICApO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChmaWxlcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50LnR5cGUgPSBcInVwbG9hZFwiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnVwbG9hZFNjaGVkdWxlci5uZXh0KHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVzOiBmaWxlcyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50OiBldmVudCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGU6IG51bGwsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgXCJjYW5jZWxcIjpcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBpZCA9IGV2ZW50LmlkIHx8IG51bGw7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFpZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGZpbGVJbmRleCA9IHRoaXMucXVldWUuZmluZEluZGV4KChmaWxlKSA9PiBmaWxlLmlkID09PSBpZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGZpbGVJbmRleCAhPT0gLTEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXJ2aWNlRXZlbnRzLmVtaXQoe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJjYW5jZWxsZWRcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVzOiBbdGhpcy5xdWV1ZVtmaWxlSW5kZXhdXSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IEZGaWxlVXRpbHMuZ2V0TG9jYWxTdHIoXCJ1cGxvYWRTZXJ2aWNlLmNhbmNlbFVwbG9hZFwiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5xdWV1ZS5zcGxpY2UoZmlsZUluZGV4LCAxKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gY2FzZSAnY2FuY2VsJzpcclxuICAgICAgICAgICAgICAgICAgICAvLyBjb25zdCBpZCA9IGV2ZW50LmlkIHx8IG51bGw7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gaWYgKCFpZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIH1cclxuICAgICAgICAgICAgICAgICAgICAvLyBjb25zdCBzdWJzID0gdGhpcy5zdWJzLmZpbHRlcihzdWIgPT4gc3ViLmlkID09PSBpZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gc3Vicy5mb3JFYWNoKHN1YiA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gICBpZiAoc3ViLnN1Yikge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vICAgICBzdWIuc3ViLnVuc3Vic2NyaWJlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gICAgIGNvbnN0IGZpbGVJbmRleCA9IHRoaXMucXVldWUuZmluZEluZGV4KGZpbGUgPT4gZmlsZS5pZCA9PT0gaWQpO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vICAgICBpZiAoZmlsZUluZGV4ICE9PSAtMSkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vICAgICAgIHRoaXMucXVldWVbZmlsZUluZGV4XS5wcm9ncmVzcy5zdGF0dXMgPSBVcGxvYWRTdGF0dXMuQ2FuY2VsbGVkO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vICAgICAgIHRoaXMuc2VydmljZUV2ZW50cy5lbWl0KHsgdHlwZTogJ2NhbmNlbGxlZCcsIGZpbGU6IHRoaXMucXVldWVbZmlsZUluZGV4XSB9KTtcclxuICAgICAgICAgICAgICAgICAgICAvLyAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIC8vICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIC8vIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgLy8gY2FzZSAnY2FuY2VsQWxsJzpcclxuICAgICAgICAgICAgICAgIC8vICAgdGhpcy5zdWJzLmZvckVhY2goc3ViID0+IHtcclxuICAgICAgICAgICAgICAgIC8vICAgICBpZiAoc3ViLnN1Yikge1xyXG4gICAgICAgICAgICAgICAgLy8gICAgICAgc3ViLnN1Yi51bnN1YnNjcmliZSgpO1xyXG4gICAgICAgICAgICAgICAgLy8gICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAvLyAgICAgY29uc3QgZmlsZSA9IHRoaXMucXVldWUuZmluZCh1cGxvYWRGaWxlID0+IHVwbG9hZEZpbGUuaWQgPT09IHN1Yi5pZCk7XHJcbiAgICAgICAgICAgICAgICAvLyAgICAgaWYgKGZpbGUpIHtcclxuICAgICAgICAgICAgICAgIC8vICAgICAgIGZpbGUucHJvZ3Jlc3Muc3RhdHVzID0gVXBsb2FkU3RhdHVzLkNhbmNlbGxlZDtcclxuICAgICAgICAgICAgICAgIC8vICAgICAgIHRoaXMuc2VydmljZUV2ZW50cy5lbWl0KHsgdHlwZTogJ2NhbmNlbGxlZCcsIGZpbGU6IGZpbGUgfSk7XHJcbiAgICAgICAgICAgICAgICAvLyAgICAgfVxyXG4gICAgICAgICAgICAgICAgLy8gICB9KTtcclxuICAgICAgICAgICAgICAgIC8vICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBjYXNlIFwiaGlkZVwiOlxyXG4gICAgICAgICAgICAgICAgICAgIGlmICghZXZlbnQuaWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBsZXQgaWRzID0gZXZlbnQuaWQuc3BsaXQoXCIsXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMucXVldWUgPSB0aGlzLnF1ZXVlLmZpbHRlcigoZmlsZSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgdEluZGV4ID0gaWRzLmZpbmRJbmRleCgodElkKSA9PiB0SWQgPT0gZmlsZS5pZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0SW5kZXggPiAtMSA/IGZhbHNlIDogdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgXCJjYW5jZWxBbGxcIjpcclxuICAgICAgICAgICAgICAgICAgICAvLyDlj5bmtojvvIznm7TmjqXku47pmJ/liJfkuK3np7vpmaTvvIzkuI3nlKjkv67mlLnnirbmgIFcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBxdWV1ZUZpbGVzID0gdGhpcy5xdWV1ZS5maWx0ZXIoXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICh1cGxvYWRGaWxlKSA9PiB1cGxvYWRGaWxlLnByb2dyZXNzLnN0YXR1cyA9PT0gVXBsb2FkU3RhdHVzLlF1ZXVlXHJcbiAgICAgICAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAocXVldWVGaWxlcy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXJ2aWNlRXZlbnRzLmVtaXQoe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJjYW5jZWxsZWRcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVzOiBxdWV1ZUZpbGVzLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTpGRmlsZVV0aWxzLmdldExvY2FsU3RyKFwidXBsb2FkU2VydmljZS5jYW5jZWxVcGxvYWRcIiksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnF1ZXVlID0gdGhpcy5xdWV1ZS5maWx0ZXIoXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAodXBsb2FkRmlsZSkgPT4gdXBsb2FkRmlsZS5wcm9ncmVzcy5zdGF0dXMgIT0gVXBsb2FkU3RhdHVzLlF1ZXVlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgY2FzZSBcInJlbW92ZVwiOlxyXG4gICAgICAgICAgICAgICAgICAgIGlmICghZXZlbnQuaWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBjb25zdCByZW1vdmVJbmRleCA9IHRoaXMucXVldWUuZmluZEluZGV4KFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAoZmlsZSkgPT4gZmlsZS5pZCA9PT0gZXZlbnQuaWRcclxuICAgICAgICAgICAgICAgICAgICApO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChyZW1vdmVJbmRleCAhPT0gLTEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8g5b6X5pyJ5Liq5byA5aeL5Yig6Zmk5ZKM5bey57uP5Yig6ZmkXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucXVldWVbcmVtb3ZlSW5kZXhdLnByb2dyZXNzLnN0YXR1cyA9IFVwbG9hZFN0YXR1cy5SZW1vdmU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudXBsb2FkU2NoZWR1bGVyLm5leHQoe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZXM6IFt0aGlzLnF1ZXVlW3JlbW92ZUluZGV4XV0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBldmVudDogZXZlbnQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlOiBudWxsLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBjYXNlIFwicmVtb3ZlQWxsXCI6XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVtb3ZlUXVldWVGaWxlcyA9IHRoaXMucXVldWUuZmlsdGVyKFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAodXBsb2FkRmlsZSkgPT4gdXBsb2FkRmlsZS5wcm9ncmVzcy5zdGF0dXMgPT09IFVwbG9hZFN0YXR1cy5RdWV1ZVxyXG4gICAgICAgICAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlbW92ZVF1ZXVlRmlsZXMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2VydmljZUV2ZW50cy5lbWl0KHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwiY2FuY2VsbGVkXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlczogcmVtb3ZlUXVldWVGaWxlcyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IEZGaWxlVXRpbHMuZ2V0TG9jYWxTdHIoXCJ1cGxvYWRTZXJ2aWNlLmRlbGV0ZVN1Y2Nlc3NcIiksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnF1ZXVlID0gdGhpcy5xdWV1ZS5maWx0ZXIoXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAodXBsb2FkRmlsZSkgPT4gdXBsb2FkRmlsZS5wcm9ncmVzcy5zdGF0dXMgIT0gVXBsb2FkU3RhdHVzLlF1ZXVlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIC8vIOato+WcqOS4iuS8oOeahOmZhOS7tuaYr+WmguS9leWkhOeQhlxyXG4gICAgICAgICAgICAgICAgICAgIC8vIGNvbnN0IGRvbmVGaWxlcyA9IHRoaXMucXVldWUuZmlsdGVyKHVwbG9hZEZpbGUgPT4gdXBsb2FkRmlsZS5wcm9ncmVzcy5zdGF0dXMgPT09IFVwbG9hZFN0YXR1cy5Eb25lKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5xdWV1ZS5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnQudHlwZSA9IFwicmVtb3ZlXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucXVldWUubWFwKFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKGl0ZW0pID0+IChpdGVtLnByb2dyZXNzLnN0YXR1cyA9IFVwbG9hZFN0YXR1cy5SZW1vdmUpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudXBsb2FkU2NoZWR1bGVyLm5leHQoe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZXM6IHRoaXMucXVldWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBldmVudDogZXZlbnQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlOiBudWxsLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBzZXRFeHRlbmRTZXJ2ZXJDb25maWcoZXh0ZW5kU2VyKSB7XHJcbiAgICAgICAgdGhpcy5leHRlbmRTZXJ2ZXJDb25maWcgPSBleHRlbmRTZXI7XHJcbiAgICB9XHJcblxyXG4gICAgc2VydmVyTWV0aG9kKHVwbG9hZDoge1xyXG4gICAgICAgIGZpbGU6IFVwbG9hZEZpbGU7XHJcbiAgICAgICAgZXZlbnQ6IFVwbG9hZElucHV0O1xyXG4gICAgICAgIGZpbGVzPzogVXBsb2FkRmlsZVtdO1xyXG4gICAgfSk6IE9ic2VydmFibGU8VXBsb2FkT3V0cHV0PiB7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBPYnNlcnZhYmxlKChvYnNlcnZlcikgPT4ge1xyXG4gICAgICAgICAgICBsZXQgc3ViO1xyXG4gICAgICAgICAgICBsZXQgaWRzID0gdXBsb2FkLmZpbGVzLm1hcCgoZmlsZUl0ZW0pID0+IGZpbGVJdGVtLmlkKTtcclxuICAgICAgICAgICAgc3dpdGNoICh1cGxvYWQuZXZlbnQudHlwZSkge1xyXG4gICAgICAgICAgICAgICAgY2FzZSAnc2xpY2VVcGxvYWQnOlxyXG4gICAgICAgICAgICAgICAgICAgIHN1YiA9IHRoaXMudXBsb2FkKHVwbG9hZC5maWxlcywgdXBsb2FkLmV2ZW50KTtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgXCJ1cGxvYWRcIjpcclxuICAgICAgICAgICAgICAgICAgICBzdWIgPSB0aGlzLnVwbG9hZCh1cGxvYWQuZmlsZXMsIHVwbG9hZC5ldmVudCk7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBjYXNlIFwibXVsdGlwYXJ0VXBsb2FkXCI6XHJcbiAgICAgICAgICAgICAgICAgICAgc3ViID0gdGhpcy5tdWx0aXBhcnRVcGxvYWQodXBsb2FkLmZpbGVzWzBdLCB1cGxvYWQuZXZlbnQpO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgLy8gY2FzZSAndXBsb2FkQWxsJzpcclxuICAgICAgICAgICAgICAgIC8vICAgaWRzID0gdXBsb2FkLmZpbGVzLm1hcChmaWxlSXRlbSA9PiBmaWxlSXRlbS5pZCk7XHJcbiAgICAgICAgICAgICAgICAvLyAgIHN1YiA9IHRoaXMudXBsb2FkQWxsKHVwbG9hZC5maWxlcywgdXBsb2FkLmV2ZW50KTtcclxuICAgICAgICAgICAgICAgIC8vICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBjYXNlIFwicmVtb3ZlXCI6XHJcbiAgICAgICAgICAgICAgICAgICAgc3ViID0gdGhpcy5yZW1vdmUodXBsb2FkLmZpbGVzLCB1cGxvYWQuZXZlbnQpO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgLy8gY2FzZSAncmVtb3ZlQWxsJzpcclxuICAgICAgICAgICAgICAgIC8vICAgaWRzID0gdXBsb2FkLmZpbGVzLm1hcChmaWxlSXRlbSA9PiBmaWxlSXRlbS5pZCk7XHJcbiAgICAgICAgICAgICAgICAvLyAgIHN1YiA9IHRoaXMucmVtb3ZlQWxsKHVwbG9hZC5maWxlcywgdXBsb2FkLmV2ZW50KTtcclxuICAgICAgICAgICAgICAgIC8vICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgICAgIHN1YiA9IG51bGw7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKCFzdWIpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBzdWIucGlwZShmaW5hbGl6ZSgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAoIW9ic2VydmVyLmNsb3NlZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIG9ic2VydmVyLmNvbXBsZXRlKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pKS5zdWJzY3JpYmUoXHJcbiAgICAgICAgICAgICAgICAgICAgKG91dHB1dCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvYnNlcnZlci5uZXh0KG91dHB1dCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICAoZXJyKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9ic2VydmVyLm5leHQoZXJyKTtcclxuICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgICgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgb2JzZXJ2ZXIuY29tcGxldGUoKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICApO1xyXG4gICAgICAgICAgICB0aGlzLnN1YnMucHVzaCh7IGlkczogaWRzLCBzdWI6IHN1YiwgaWQ6IFwiXCIgfSk7XHJcbiAgICAgICAgICAgIC8vIHN3aXRjaCAodXBsb2FkLmV2ZW50LnR5cGUpIHtcclxuICAgICAgICAgICAgLy8gICBjYXNlICd1cGxvYWRBbGwnOlxyXG4gICAgICAgICAgICAvLyAgICAgdGhpcy5zdWJzLnB1c2goeyBpZHM6IGlkcywgc3ViOiBzdWIsIGlkOiAnJyB9KTtcclxuICAgICAgICAgICAgLy8gICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAvLyAgIGNhc2UgJ3JlbW92ZUFsbCc6XHJcbiAgICAgICAgICAgIC8vICAgICB0aGlzLnN1YnMucHVzaCh7IGlkczogaWRzLCBzdWI6IHN1YiwgaWQ6ICcnIH0pO1xyXG4gICAgICAgICAgICAvLyAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIC8vICAgZGVmYXVsdDpcclxuXHJcbiAgICAgICAgICAgIC8vIH1cclxuICAgICAgICB9KTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICog5Y2V5Liq5paH5Lu25LiK5LygXHJcbiAgICAgKiBAcGFyYW0gZmlsZVxyXG4gICAgICogQHBhcmFtIGV2ZW50XHJcbiAgICAgKi9cclxuICAgIC8vIHVwbG9hZEZpbGUoZmlsZTogVXBsb2FkRmlsZSwgZXZlbnQ6IFVwbG9hZElucHV0KTogT2JzZXJ2YWJsZTxVcGxvYWRPdXRwdXQ+IHtcclxuICAgIC8vICAgY29uc3QgdXBsb2FkRmlsZSA9IDxCbG9iRmlsZT5maWxlLm5hdGl2ZUZpbGU7XHJcbiAgICAvLyAgIGNvbnN0IHVwbG9hZEluZGV4ID0gdGhpcy5xdWV1ZS5maW5kSW5kZXgob3V0RmlsZSA9PiBvdXRGaWxlLm5hdGl2ZUZpbGUgPT09IHVwbG9hZEZpbGUpO1xyXG5cclxuICAgIC8vICAgLy8g5bey57uP6KKr5Y+W5raI55qE5LiN6IO96KKr5LiK5LygXHJcbiAgICAvLyAgIGlmICh0aGlzLnF1ZXVlW3VwbG9hZEluZGV4XS5wcm9ncmVzcy5zdGF0dXMgPT09IFVwbG9hZFN0YXR1cy5DYW5jZWxsZWQpIHtcclxuICAgIC8vICAgICByZXR1cm4gbmV3IE9ic2VydmFibGUob2JzZXJ2ZXIgPT4ge1xyXG4gICAgLy8gICAgICAgb2JzZXJ2ZXIuY29tcGxldGUoKTtcclxuICAgIC8vICAgICB9KTtcclxuICAgIC8vICAgfVxyXG4gICAgLy8gICAvLyDmipvlh7rlvIDlp4vkuIrkvKDnmoTkuovku7ZcclxuICAgIC8vICAgdGhpcy5zZXJ2aWNlRXZlbnRzLmVtaXQoeyB0eXBlOiAnc3RhcnQnLCBmaWxlczogW2ZpbGVdIH0pO1xyXG4gICAgLy8gICByZXR1cm4gdGhpcy51cGxvYWRTZXJ2ZXJTZXIudXBsb2FkKGZpbGUsIGV2ZW50LCB0aGlzLmV4dGVuZFNlcnZlckNvbmZpZyk7XHJcbiAgICAvLyB9XHJcbiAgICBtdWx0aXBhcnRVcGxvYWQoXHJcbiAgICAgICAgZmlsZTogVXBsb2FkRmlsZSxcclxuICAgICAgICBldmVudDogVXBsb2FkSW5wdXRcclxuICAgICk6IE9ic2VydmFibGU8VXBsb2FkT3V0cHV0PiB7XHJcbiAgICAgICAgLy8g5oqb5Ye65byA5aeL5LiK5Lyg55qE5LqL5Lu2XHJcbiAgICAgICAgdGhpcy5zZXJ2aWNlRXZlbnRzLmVtaXQoeyB0eXBlOiBcInN0YXJ0XCIsIGZpbGVzOiBbZmlsZV0gfSk7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMudXBsb2FkU2VydmVyU2VyLm11bHRpcGFydFVwbG9hZChcclxuICAgICAgICAgICAgZmlsZSxcclxuICAgICAgICAgICAgZXZlbnQsXHJcbiAgICAgICAgICAgIHRoaXMuZXh0ZW5kU2VydmVyQ29uZmlnXHJcbiAgICAgICAgKTtcclxuICAgIH1cclxuICAgIHVwbG9hZChmaWxlczogVXBsb2FkRmlsZVtdLCBldmVudDogVXBsb2FkSW5wdXQpOiBPYnNlcnZhYmxlPFVwbG9hZE91dHB1dD4ge1xyXG4gICAgICAgIC8vIOaKm+WHuuW8gOWni+S4iuS8oOeahOS6i+S7tlxyXG4gICAgICAgIHRoaXMuc2VydmljZUV2ZW50cy5lbWl0KHsgdHlwZTogXCJzdGFydFwiLCBmaWxlczogZmlsZXMgfSk7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMudXBsb2FkU2VydmVyU2VyLnVwbG9hZChmaWxlcywgZXZlbnQsIHRoaXMuZXh0ZW5kU2VydmVyQ29uZmlnKTtcclxuICAgIH1cclxuXHJcbiAgICByZW1vdmUoZmlsZXM6IFVwbG9hZEZpbGVbXSwgZXZlbnQ6IFVwbG9hZElucHV0KTogT2JzZXJ2YWJsZTxVcGxvYWRPdXRwdXQ+IHtcclxuICAgICAgICByZXR1cm4gdGhpcy51cGxvYWRTZXJ2ZXJTZXIucmVtb3ZlKGZpbGVzLCBldmVudCwgdGhpcy5leHRlbmRTZXJ2ZXJDb25maWcpO1xyXG4gICAgfVxyXG4gICAgLy8gcmVtb3ZlQWxsKGZpbGVzOiBVcGxvYWRGaWxlW10sIGV2ZW50OiBVcGxvYWRJbnB1dCk6IE9ic2VydmFibGU8VXBsb2FkT3V0cHV0PiB7XHJcbiAgICAvLyAgIHJldHVybiB0aGlzLnVwbG9hZFNlcnZlclNlci5yZW1vdmVBbGwoZmlsZXMsIGV2ZW50LCB0aGlzLmV4dGVuZFNlcnZlckNvbmZpZyk7XHJcbiAgICAvLyB9XHJcbiAgICAvLyDph43nva5cclxuICAgIHJlc2V0KCkge1xyXG4gICAgICAgIHRoaXMucXVldWUgPSBbXTtcclxuICAgICAgICAvL3RoaXMudXBsb2FkU2NoZWR1bGVyID0gbmV3IFN1YmplY3QoKTtcclxuICAgICAgICAvLyB0aGlzLnN1YnMuZm9yRWFjaChzdWIgPT4ge1xyXG4gICAgICAgIC8vICAgaWYgKHN1Yi5zdWIpIHtcclxuICAgICAgICAvLyAgICAgc3ViLnN1Yi51bnN1YnNjcmliZSgpO1xyXG4gICAgICAgIC8vICAgfVxyXG4gICAgICAgIC8vIH0pO1xyXG4gICAgICAgIHRoaXMuc3VicyA9IFtdO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIOaaguaXtlxyXG4gICAgc2V0Q29udGVudFR5cGVzKGNvbnRlbnRUeXBlczogc3RyaW5nW10pOiB2b2lkIHtcclxuICAgICAgICBpZiAodHlwZW9mIGNvbnRlbnRUeXBlcyAhPT0gXCJ1bmRlZmluZWRcIiAmJiBjb250ZW50VHlwZXMgaW5zdGFuY2VvZiBBcnJheSkge1xyXG4gICAgICAgICAgICBpZiAoY29udGVudFR5cGVzLmZpbmQoKHR5cGU6IHN0cmluZykgPT4gdHlwZSA9PT0gXCIqXCIpICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuYWxsb3dlZENvbnRlbnRUeXBlcyA9IFtcIipcIl07XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmFsbG93ZWRDb250ZW50VHlwZXMgPSBjb250ZW50VHlwZXM7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmFsbG93ZWRDb250ZW50VHlwZXMgPSBbXCIqXCJdO1xyXG4gICAgfVxyXG5cclxuICAgIGFsbENvbnRlbnRUeXBlc0FsbG93ZWQoKTogYm9vbGVhbiB7XHJcbiAgICAgICAgcmV0dXJuIChcclxuICAgICAgICAgICAgdGhpcy5hbGxvd2VkQ29udGVudFR5cGVzLmZpbmQoKHR5cGU6IHN0cmluZykgPT4gdHlwZSA9PT0gXCIqXCIpICE9PVxyXG4gICAgICAgICAgICB1bmRlZmluZWRcclxuICAgICAgICApO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIG5hbWVcclxuICAgICAqL1xyXG4gICAgaXNDb250ZW50VHlwZUFsbG93ZWQobmFtZTogc3RyaW5nKTogYm9vbGVhbiB7XHJcbiAgICAgICAgaWYgKHRoaXMuYWxsQ29udGVudFR5cGVzQWxsb3dlZCgpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyDpmYTku7bmsqHmnInlkI7nvIBcclxuICAgICAgICBpZiAobmFtZS5sYXN0SW5kZXhPZihcIi5cIikgPCAwKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgbGV0IG5hbWVzdWZmaXggPSBuYW1lLnN1YnN0cihuYW1lLmxhc3RJbmRleE9mKFwiLlwiKSk7XHJcbiAgICAgICAgLy8g566A5YyW6K6h566XXHJcbiAgICAgICAgcmV0dXJuIChcclxuICAgICAgICAgICAgdGhpcy5hbGxvd2VkQ29udGVudFR5cGVzLmZpbmRJbmRleChcclxuICAgICAgICAgICAgICAgIChpdGVtKSA9PiBpdGVtLnRvTG93ZXJDYXNlKCkgPT0gbmFtZXN1ZmZpeC50b0xvd2VyQ2FzZSgpXHJcbiAgICAgICAgICAgICkgPiAtMVxyXG4gICAgICAgICk7XHJcbiAgICB9XHJcbiAgICBwcml2YXRlIGlzTmFtZUFsbG93ZWQobmFtZTpzdHJpbmcpOmJvb2xlYW57XHJcbiAgICAgICAgaWYoIXRoaXMubm90QWxsb3dlZENoYXJzSW5GaWxlTmFtZXx8dGhpcy5ub3RBbGxvd2VkQ2hhcnNJbkZpbGVOYW1lLmxlbmd0aD09MCl7XHJcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBsZXQgcHVyTmFtZT1uYW1lLmxhc3RJbmRleE9mKFwiLlwiKT4tMT8gbmFtZS5zdWJzdHIoMCxuYW1lLmxhc3RJbmRleE9mKFwiLlwiKSk6bmFtZTtcclxuICAgICAgICAgLy8g566A5YyW6K6h566XXHJcbiAgICAgICAgIHJldHVybiAhKFxyXG4gICAgICAgICAgICB0aGlzLm5vdEFsbG93ZWRDaGFyc0luRmlsZU5hbWUuZmluZEluZGV4KFxyXG4gICAgICAgICAgICAgICAgKGl0ZW0pID0+IHB1ck5hbWUuaW5kZXhPZihpdGVtKT4tMVxyXG4gICAgICAgICAgICApID4gLTFcclxuICAgICAgICApO1xyXG4gICAgfVxyXG5cclxuICAgIGlzRmlsZVNpemVBbGxvd2VkKGZpbGVTaXplOiBudW1iZXIpOiBib29sZWFuIHtcclxuICAgICAgICBpZiAoIXRoaXMubWF4RmlsZVNpemUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIGZpbGVTaXpl5pivYuWNleS9jSBtYXhGaWxlU2l6ZeaYr01C5Y2V5L2NXHJcbiAgICAgICAgcmV0dXJuIGZpbGVTaXplIDw9IHRoaXMubWF4RmlsZVNpemUgKiAxMDI0ICogMTAyNDsgLy8gKiA4XHJcbiAgICB9XHJcbn1cclxuIl19
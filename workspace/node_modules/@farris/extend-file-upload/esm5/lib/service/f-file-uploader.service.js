/**
 * @fileoverview added by tsickle
 * Generated from: lib/service/f-file-uploader.service.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { EventEmitter, Injector, Optional } from "@angular/core";
import { Observable, Subject } from "rxjs";
import { mergeMap, finalize } from "rxjs/operators";
import { FFileUtils } from "../utils/index";
import { UploadStatus, UploadServerService, } from "../model/index";
import { LocaleService } from "@farris/ui-locale";
var FFileUploaderService = /** @class */ (function () {
    function FFileUploaderService(uploadServerSer, inject) {
        var _this = this;
        this.uploadServerSer = uploadServerSer;
        this.inject = inject;
        this.allowedContentTypes = ["*"];
        //默认不限制,0代表不限制 Number.POSITIVE_INFINITY
        this.maxUploads = 0;
        /**
         * 单位M，默认是12M,0代表不限制
         */
        this.maxFileSize = 12;
        this.concurrency = Number.POSITIVE_INFINITY;
        this.uploadedCount = 0;
        // 不允许名称中包含特殊字符
        this.notAllowedCharsInFileName = [];
        this.extendServerConfig = null;
        this.hasLocalSer = false;
        this.queue = [];
        this.serviceEvents = new EventEmitter();
        // 看是否多语言服务已更新
        this.hasLocalSer = FFileUtils.getLocalState(null);
        // 为多语言服务赋值
        if (this.inject && !this.hasLocalSer) {
            this.hasLocalSer = FFileUtils.getLocalState(this.inject.get(LocaleService));
        }
        this.uploadScheduler = new Subject();
        this.subs = [];
        this.uploadScheduler
            .pipe(mergeMap((/**
         * @param {?} upload
         * @return {?}
         */
        function (upload) {
            return _this.serverMethod(upload);
        }), this.concurrency))
            .subscribe((/**
         * @param {?} uploadOutput
         * @return {?}
         */
        function (uploadOutput) {
            // if (uploadOutput.type == 'removed' || uploadOutput.type == 'done') {
            //   // 删除或者done移除
            //   const subIndex = this.subs.findIndex(sub => sub.id === uploadOutput.file.id);
            //   if (subIndex > -1 && this.subs[subIndex].sub) {
            //     this.subs[subIndex].sub.unsubscribe();
            //   }
            //   this.subs.splice(subIndex, 1);
            // }
            if (uploadOutput.type == "removed") {
                // 事件中返回的都是
                _this.queue = _this.queue.filter((/**
                 * @param {?} item
                 * @return {?}
                 */
                function (item) { return item.progress.status !== UploadStatus.Remove; }));
                if (!uploadOutput.hasOwnProperty("message")) {
                    uploadOutput["message"] = FFileUtils.getLocalStr("uploadService.removed");
                }
            }
            if (uploadOutput.type == "error") {
                // 上传失败的附件移除
                _this.queue = _this.queue.filter((/**
                 * @param {?} queueItem
                 * @return {?}
                 */
                function (queueItem) {
                    return (uploadOutput.files.findIndex((/**
                     * @param {?} item
                     * @return {?}
                     */
                    function (item) { return queueItem.id == item.id; })) <
                        0);
                }));
            }
            _this.serviceEvents.emit(uploadOutput);
        }));
    }
    /**
     * @param {?} options
     * @return {?}
     */
    FFileUploaderService.prototype.setOptions = /**
     * @param {?} options
     * @return {?}
     */
    function (options) {
        // 重置文件大小、类型、个数限制
        if (options) {
            for (var prop in options) {
                this[prop] = options[prop];
            }
        }
    };
    /**
     * @param {?} incomingFiles
     * @return {?}
     */
    FFileUploaderService.prototype.handleFiles = /**
     * @param {?} incomingFiles
     * @return {?}
     */
    function (incomingFiles) {
        var _this = this;
        /** @type {?} */
        var allowedIncomingFiles = [].reduce.call(incomingFiles, (/**
         * @param {?} acc
         * @param {?} checkFile
         * @param {?} i
         * @return {?}
         */
        function (acc, checkFile, i) {
            /** @type {?} */
            var futureQueueLength = acc.length + _this.queue.length + 1;
            /** @type {?} */
            var judgeResult = _this.rejectedReason(checkFile.name, checkFile.type, futureQueueLength, checkFile.size);
            if (judgeResult.allowed) {
                acc = acc.concat(checkFile);
            }
            else {
                // 不符合当前文件类型或者内容超出限制，抛出事件
                /** @type {?} */
                var rejectedFile = FFileUtils.makeUploadFile(checkFile, i);
                _this.serviceEvents.emit({
                    type: "rejected",
                    file: rejectedFile,
                    message: judgeResult.message,
                });
            }
            return acc;
        }), []);
        // 构造文件结构，并单个抛出事件
        [].map.call(allowedIncomingFiles, (/**
         * @param {?} file
         * @param {?} i
         * @return {?}
         */
        function (file, i) {
            /** @type {?} */
            var uploadFile = FFileUtils.makeUploadFile(file, i);
            _this.queue.push(uploadFile);
            _this.serviceEvents.emit({ type: "addedToQueue", file: uploadFile });
        }));
        // 所有的文件都已经添加，抛出事件
        this.serviceEvents.emit({ type: "allAddedToQueue" });
    };
    /**
     * @private
     * @param {?} name
     * @param {?} type
     * @param {?} queuelength
     * @param {?} size
     * @return {?}
     */
    FFileUploaderService.prototype.rejectedReason = /**
     * @private
     * @param {?} name
     * @param {?} type
     * @param {?} queuelength
     * @param {?} size
     * @return {?}
     */
    function (name, type, queuelength, size) {
        /** @type {?} */
        var allowed = false;
        /** @type {?} */
        var message = "";
        // 已存在同名文件
        /** @type {?} */
        var findDuplicateIndex = this.queue.findIndex((/**
         * @param {?} file
         * @return {?}
         */
        function (file) { return file.name == name; }));
        if (findDuplicateIndex > -1) {
            message = FFileUtils.getLocalStr("uploadService.failedSameName");
        }
        else if (!this.isContentTypeAllowed(name)) {
            message = FFileUtils.getLocalStr("uploadService.failedType", [this.allowedContentTypes.join(",")]);
        }
        else if (!this.isNameAllowed(name)) {
            /** @type {?} */
            var notAllowedLen_1 = this.notAllowedCharsInFileName.length;
            /** @type {?} */
            var tMssage_1 = '';
            this.notAllowedCharsInFileName.map((/**
             * @param {?} notAllowItem
             * @param {?} curIndex
             * @return {?}
             */
            function (notAllowItem, curIndex) {
                tMssage_1 += "<b style=\"display:inline-block;margin:0 4px;min-width:8px;text-align: center;\">" + (notAllowItem ? notAllowItem : "&nbsp;") + "</b>";
                if (curIndex != notAllowedLen_1 - 1) {
                    tMssage_1 += ",";
                }
            }));
            message = FFileUtils.getLocalStr("uploadService.failedName", [tMssage_1]);
        }
        else if (this.maxUploads > 0 &&
            (this.maxUploads <= this.uploadedCount ||
                queuelength + this.uploadedCount > this.maxUploads)) {
            message = FFileUtils.getLocalStr("uploadService.failedCount", [this.maxUploads + '']);
        }
        else if (!this.isFileSizeAllowed(size)) {
            message = FFileUtils.getLocalStr("uploadService.failedSize", [this.maxFileSize + '']);
        }
        else if (size == 0) {
            message = FFileUtils.getLocalStr("uploadService.failedEmpty");
        }
        else {
            allowed = true;
        }
        return {
            allowed: allowed,
            message: message,
        };
    };
    /**
     * 从前端传来事件，进行服务器端方法类型判断
     * @param input
     */
    /**
     * 从前端传来事件，进行服务器端方法类型判断
     * @param {?} input
     * @return {?}
     */
    FFileUploaderService.prototype.initInputEvents = /**
     * 从前端传来事件，进行服务器端方法类型判断
     * @param {?} input
     * @return {?}
     */
    function (input) {
        var _this = this;
        return input.subscribe((/**
         * @param {?} event
         * @return {?}
         */
        function (event) {
            switch (event.type) {
                case 'sliceUpload':
                    /** @type {?} */
                    var _files = _this.queue.filter((/**
                     * @param {?} file
                     * @return {?}
                     */
                    function (file) { return file.progress.status === UploadStatus.Queue && (!event.file || file.fileIndex === event.file.fileIndex); }));
                    if (_files.length > 0) {
                        _this.uploadScheduler.next({
                            files: _files,
                            event: event,
                            file: null,
                        });
                    }
                    break;
                case "upload":
                case "multipartUpload":
                    /** @type {?} */
                    var uploadFileIndex = _this.queue.findIndex((/**
                     * @param {?} file
                     * @return {?}
                     */
                    function (file) { return file === event.file; }));
                    if (uploadFileIndex !== -1 && event.file) {
                        _this.uploadScheduler.next({
                            files: [_this.queue[uploadFileIndex]],
                            event: event,
                            file: null,
                        });
                    }
                    break;
                case "uploadAll":
                    /** @type {?} */
                    var files = _this.queue.filter((/**
                     * @param {?} file
                     * @return {?}
                     */
                    function (file) { return file.progress.status === UploadStatus.Queue; }));
                    if (files.length > 0) {
                        event.type = "upload";
                        _this.uploadScheduler.next({
                            files: files,
                            event: event,
                            file: null,
                        });
                    }
                    break;
                case "cancel":
                    /** @type {?} */
                    var id_1 = event.id || null;
                    if (!id_1) {
                        return;
                    }
                    /** @type {?} */
                    var fileIndex = _this.queue.findIndex((/**
                     * @param {?} file
                     * @return {?}
                     */
                    function (file) { return file.id === id_1; }));
                    if (fileIndex !== -1) {
                        _this.serviceEvents.emit({
                            type: "cancelled",
                            files: [_this.queue[fileIndex]],
                            message: FFileUtils.getLocalStr("uploadService.cancelUpload")
                        });
                        _this.queue.splice(fileIndex, 1);
                    }
                    break;
                    // case 'cancel':
                    // const id = event.id || null;
                    // if (!id) {
                    //   return;
                    // }
                    // const subs = this.subs.filter(sub => sub.id === id);
                    // subs.forEach(sub => {
                    //   if (sub.sub) {
                    //     sub.sub.unsubscribe();
                    //     const fileIndex = this.queue.findIndex(file => file.id === id);
                    //     if (fileIndex !== -1) {
                    //       this.queue[fileIndex].progress.status = UploadStatus.Cancelled;
                    //       this.serviceEvents.emit({ type: 'cancelled', file: this.queue[fileIndex] });
                    //     }
                    //   }
                    // });
                    break;
                // case 'cancelAll':
                //   this.subs.forEach(sub => {
                //     if (sub.sub) {
                //       sub.sub.unsubscribe();
                //     }
                //     const file = this.queue.find(uploadFile => uploadFile.id === sub.id);
                //     if (file) {
                //       file.progress.status = UploadStatus.Cancelled;
                //       this.serviceEvents.emit({ type: 'cancelled', file: file });
                //     }
                //   });
                //   break;
                case "hide":
                    if (!event.id) {
                        return;
                    }
                    /** @type {?} */
                    var ids_1 = event.id.split(",");
                    _this.queue = _this.queue.filter((/**
                     * @param {?} file
                     * @return {?}
                     */
                    function (file) {
                        /** @type {?} */
                        var tIndex = ids_1.findIndex((/**
                         * @param {?} tId
                         * @return {?}
                         */
                        function (tId) { return tId == file.id; }));
                        return tIndex > -1 ? false : true;
                    }));
                    break;
                case "cancelAll":
                    // 取消，直接从队列中移除，不用修改状态
                    /** @type {?} */
                    var queueFiles = _this.queue.filter((/**
                     * @param {?} uploadFile
                     * @return {?}
                     */
                    function (uploadFile) { return uploadFile.progress.status === UploadStatus.Queue; }));
                    if (queueFiles.length) {
                        _this.serviceEvents.emit({
                            type: "cancelled",
                            files: queueFiles,
                            message: FFileUtils.getLocalStr("uploadService.cancelUpload"),
                        });
                        _this.queue = _this.queue.filter((/**
                         * @param {?} uploadFile
                         * @return {?}
                         */
                        function (uploadFile) { return uploadFile.progress.status != UploadStatus.Queue; }));
                    }
                    break;
                case "remove":
                    if (!event.id) {
                        return;
                    }
                    /** @type {?} */
                    var removeIndex = _this.queue.findIndex((/**
                     * @param {?} file
                     * @return {?}
                     */
                    function (file) { return file.id === event.id; }));
                    if (removeIndex !== -1) {
                        // 得有个开始删除和已经删除
                        _this.queue[removeIndex].progress.status = UploadStatus.Remove;
                        _this.uploadScheduler.next({
                            files: [_this.queue[removeIndex]],
                            event: event,
                            file: null,
                        });
                    }
                    break;
                case "removeAll":
                    /** @type {?} */
                    var removeQueueFiles = _this.queue.filter((/**
                     * @param {?} uploadFile
                     * @return {?}
                     */
                    function (uploadFile) { return uploadFile.progress.status === UploadStatus.Queue; }));
                    if (removeQueueFiles.length) {
                        _this.serviceEvents.emit({
                            type: "cancelled",
                            files: removeQueueFiles,
                            message: FFileUtils.getLocalStr("uploadService.deleteSuccess"),
                        });
                        _this.queue = _this.queue.filter((/**
                         * @param {?} uploadFile
                         * @return {?}
                         */
                        function (uploadFile) { return uploadFile.progress.status != UploadStatus.Queue; }));
                    }
                    // 正在上传的附件是如何处理
                    // const doneFiles = this.queue.filter(uploadFile => uploadFile.progress.status === UploadStatus.Done);
                    if (_this.queue.length) {
                        event.type = "remove";
                        _this.queue.map((/**
                         * @param {?} item
                         * @return {?}
                         */
                        function (item) { return (item.progress.status = UploadStatus.Remove); }));
                        _this.uploadScheduler.next({
                            files: _this.queue,
                            event: event,
                            file: null,
                        });
                    }
                    break;
            }
        }));
    };
    /**
     * @param {?} extendSer
     * @return {?}
     */
    FFileUploaderService.prototype.setExtendServerConfig = /**
     * @param {?} extendSer
     * @return {?}
     */
    function (extendSer) {
        this.extendServerConfig = extendSer;
    };
    /**
     * @param {?} upload
     * @return {?}
     */
    FFileUploaderService.prototype.serverMethod = /**
     * @param {?} upload
     * @return {?}
     */
    function (upload) {
        var _this = this;
        return new Observable((/**
         * @param {?} observer
         * @return {?}
         */
        function (observer) {
            /** @type {?} */
            var sub;
            /** @type {?} */
            var ids = upload.files.map((/**
             * @param {?} fileItem
             * @return {?}
             */
            function (fileItem) { return fileItem.id; }));
            switch (upload.event.type) {
                case 'sliceUpload':
                    sub = _this.upload(upload.files, upload.event);
                    break;
                case "upload":
                    sub = _this.upload(upload.files, upload.event);
                    break;
                case "multipartUpload":
                    sub = _this.multipartUpload(upload.files[0], upload.event);
                    break;
                // case 'uploadAll':
                //   ids = upload.files.map(fileItem => fileItem.id);
                //   sub = this.uploadAll(upload.files, upload.event);
                //   break;
                case "remove":
                    sub = _this.remove(upload.files, upload.event);
                    break;
                // case 'removeAll':
                //   ids = upload.files.map(fileItem => fileItem.id);
                //   sub = this.removeAll(upload.files, upload.event);
                //   break;
                default:
                    sub = null;
            }
            if (!sub) {
                return;
            }
            sub.pipe(finalize((/**
             * @return {?}
             */
            function () {
                if (!observer.closed) {
                    observer.complete();
                }
            }))).subscribe((/**
             * @param {?} output
             * @return {?}
             */
            function (output) {
                observer.next(output);
            }), (/**
             * @param {?} err
             * @return {?}
             */
            function (err) {
                observer.next(err);
            }), (/**
             * @return {?}
             */
            function () {
                observer.complete();
            }));
            _this.subs.push({ ids: ids, sub: sub, id: "" });
            // switch (upload.event.type) {
            //   case 'uploadAll':
            //     this.subs.push({ ids: ids, sub: sub, id: '' });
            //     break;
            //   case 'removeAll':
            //     this.subs.push({ ids: ids, sub: sub, id: '' });
            //     break;
            //   default:
            // }
        }));
    };
    /**
     * 单个文件上传
     * @param file
     * @param event
     */
    // uploadFile(file: UploadFile, event: UploadInput): Observable<UploadOutput> {
    //   const uploadFile = <BlobFile>file.nativeFile;
    //   const uploadIndex = this.queue.findIndex(outFile => outFile.nativeFile === uploadFile);
    //   // 已经被取消的不能被上传
    //   if (this.queue[uploadIndex].progress.status === UploadStatus.Cancelled) {
    //     return new Observable(observer => {
    //       observer.complete();
    //     });
    //   }
    //   // 抛出开始上传的事件
    //   this.serviceEvents.emit({ type: 'start', files: [file] });
    //   return this.uploadServerSer.upload(file, event, this.extendServerConfig);
    // }
    /**
     * 单个文件上传
     * @param {?} file
     * @param {?} event
     * @return {?}
     */
    // uploadFile(file: UploadFile, event: UploadInput): Observable<UploadOutput> {
    //   const uploadFile = <BlobFile>file.nativeFile;
    //   const uploadIndex = this.queue.findIndex(outFile => outFile.nativeFile === uploadFile);
    //   // 已经被取消的不能被上传
    //   if (this.queue[uploadIndex].progress.status === UploadStatus.Cancelled) {
    //     return new Observable(observer => {
    //       observer.complete();
    //     });
    //   }
    //   // 抛出开始上传的事件
    //   this.serviceEvents.emit({ type: 'start', files: [file] });
    //   return this.uploadServerSer.upload(file, event, this.extendServerConfig);
    // }
    FFileUploaderService.prototype.multipartUpload = /**
     * 单个文件上传
     * @param {?} file
     * @param {?} event
     * @return {?}
     */
    // uploadFile(file: UploadFile, event: UploadInput): Observable<UploadOutput> {
    //   const uploadFile = <BlobFile>file.nativeFile;
    //   const uploadIndex = this.queue.findIndex(outFile => outFile.nativeFile === uploadFile);
    //   // 已经被取消的不能被上传
    //   if (this.queue[uploadIndex].progress.status === UploadStatus.Cancelled) {
    //     return new Observable(observer => {
    //       observer.complete();
    //     });
    //   }
    //   // 抛出开始上传的事件
    //   this.serviceEvents.emit({ type: 'start', files: [file] });
    //   return this.uploadServerSer.upload(file, event, this.extendServerConfig);
    // }
    function (file, event) {
        // 抛出开始上传的事件
        this.serviceEvents.emit({ type: "start", files: [file] });
        return this.uploadServerSer.multipartUpload(file, event, this.extendServerConfig);
    };
    /**
     * @param {?} files
     * @param {?} event
     * @return {?}
     */
    FFileUploaderService.prototype.upload = /**
     * @param {?} files
     * @param {?} event
     * @return {?}
     */
    function (files, event) {
        // 抛出开始上传的事件
        this.serviceEvents.emit({ type: "start", files: files });
        return this.uploadServerSer.upload(files, event, this.extendServerConfig);
    };
    /**
     * @param {?} files
     * @param {?} event
     * @return {?}
     */
    FFileUploaderService.prototype.remove = /**
     * @param {?} files
     * @param {?} event
     * @return {?}
     */
    function (files, event) {
        return this.uploadServerSer.remove(files, event, this.extendServerConfig);
    };
    // removeAll(files: UploadFile[], event: UploadInput): Observable<UploadOutput> {
    //   return this.uploadServerSer.removeAll(files, event, this.extendServerConfig);
    // }
    // 重置
    // removeAll(files: UploadFile[], event: UploadInput): Observable<UploadOutput> {
    //   return this.uploadServerSer.removeAll(files, event, this.extendServerConfig);
    // }
    // 重置
    /**
     * @return {?}
     */
    FFileUploaderService.prototype.reset = 
    // removeAll(files: UploadFile[], event: UploadInput): Observable<UploadOutput> {
    //   return this.uploadServerSer.removeAll(files, event, this.extendServerConfig);
    // }
    // 重置
    /**
     * @return {?}
     */
    function () {
        this.queue = [];
        //this.uploadScheduler = new Subject();
        // this.subs.forEach(sub => {
        //   if (sub.sub) {
        //     sub.sub.unsubscribe();
        //   }
        // });
        this.subs = [];
    };
    // 暂时
    // 暂时
    /**
     * @param {?} contentTypes
     * @return {?}
     */
    FFileUploaderService.prototype.setContentTypes = 
    // 暂时
    /**
     * @param {?} contentTypes
     * @return {?}
     */
    function (contentTypes) {
        if (typeof contentTypes !== "undefined" && contentTypes instanceof Array) {
            if (contentTypes.find((/**
             * @param {?} type
             * @return {?}
             */
            function (type) { return type === "*"; })) !== undefined) {
                this.allowedContentTypes = ["*"];
            }
            else {
                this.allowedContentTypes = contentTypes;
            }
            return;
        }
        this.allowedContentTypes = ["*"];
    };
    /**
     * @return {?}
     */
    FFileUploaderService.prototype.allContentTypesAllowed = /**
     * @return {?}
     */
    function () {
        return (this.allowedContentTypes.find((/**
         * @param {?} type
         * @return {?}
         */
        function (type) { return type === "*"; })) !==
            undefined);
    };
    /**
     *
     * @param name
     */
    /**
     *
     * @param {?} name
     * @return {?}
     */
    FFileUploaderService.prototype.isContentTypeAllowed = /**
     *
     * @param {?} name
     * @return {?}
     */
    function (name) {
        if (this.allContentTypesAllowed()) {
            return true;
        }
        // 附件没有后缀
        if (name.lastIndexOf(".") < 0) {
            return false;
        }
        /** @type {?} */
        var namesuffix = name.substr(name.lastIndexOf("."));
        // 简化计算
        return (this.allowedContentTypes.findIndex((/**
         * @param {?} item
         * @return {?}
         */
        function (item) { return item.toLowerCase() == namesuffix.toLowerCase(); })) > -1);
    };
    /**
     * @private
     * @param {?} name
     * @return {?}
     */
    FFileUploaderService.prototype.isNameAllowed = /**
     * @private
     * @param {?} name
     * @return {?}
     */
    function (name) {
        if (!this.notAllowedCharsInFileName || this.notAllowedCharsInFileName.length == 0) {
            return true;
        }
        /** @type {?} */
        var purName = name.lastIndexOf(".") > -1 ? name.substr(0, name.lastIndexOf(".")) : name;
        // 简化计算
        return !(this.notAllowedCharsInFileName.findIndex((/**
         * @param {?} item
         * @return {?}
         */
        function (item) { return purName.indexOf(item) > -1; })) > -1);
    };
    /**
     * @param {?} fileSize
     * @return {?}
     */
    FFileUploaderService.prototype.isFileSizeAllowed = /**
     * @param {?} fileSize
     * @return {?}
     */
    function (fileSize) {
        if (!this.maxFileSize) {
            return true;
        }
        // fileSize是b单位 maxFileSize是MB单位
        return fileSize <= this.maxFileSize * 1024 * 1024; // * 8
    };
    /** @nocollapse */
    FFileUploaderService.ctorParameters = function () { return [
        { type: UploadServerService, decorators: [{ type: Optional }] },
        { type: Injector, decorators: [{ type: Optional }] }
    ]; };
    return FFileUploaderService;
}());
export { FFileUploaderService };
if (false) {
    /** @type {?} */
    FFileUploaderService.prototype.queue;
    /** @type {?} */
    FFileUploaderService.prototype.serviceEvents;
    /** @type {?} */
    FFileUploaderService.prototype.uploadScheduler;
    /** @type {?} */
    FFileUploaderService.prototype.subs;
    /** @type {?} */
    FFileUploaderService.prototype.allowedContentTypes;
    /** @type {?} */
    FFileUploaderService.prototype.maxUploads;
    /**
     * 单位M，默认是12M,0代表不限制
     * @type {?}
     */
    FFileUploaderService.prototype.maxFileSize;
    /** @type {?} */
    FFileUploaderService.prototype.concurrency;
    /** @type {?} */
    FFileUploaderService.prototype.uploadedCount;
    /** @type {?} */
    FFileUploaderService.prototype.notAllowedCharsInFileName;
    /**
     * @type {?}
     * @private
     */
    FFileUploaderService.prototype.extendServerConfig;
    /**
     * @type {?}
     * @private
     */
    FFileUploaderService.prototype.hasLocalSer;
    /**
     * @type {?}
     * @private
     */
    FFileUploaderService.prototype.uploadServerSer;
    /**
     * @type {?}
     * @private
     */
    FFileUploaderService.prototype.inject;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZi1maWxlLXVwbG9hZGVyLnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL2V4dGVuZC1maWxlLXVwbG9hZC8iLCJzb3VyY2VzIjpbImxpYi9zZXJ2aWNlL2YtZmlsZS11cGxvYWRlci5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsT0FBTyxFQUFFLFlBQVksRUFBRSxRQUFRLEVBQUUsUUFBUSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ2pFLE9BQU8sRUFBRSxVQUFVLEVBQUUsT0FBTyxFQUFvQixNQUFNLE1BQU0sQ0FBQztBQUM3RCxPQUFPLEVBQUUsUUFBUSxFQUFFLFFBQVEsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ3BELE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUM1QyxPQUFPLEVBSUgsWUFBWSxFQUVaLG1CQUFtQixHQUV0QixNQUFNLGdCQUFnQixDQUFDO0FBQ3hCLE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUdsRDtJQW9CSSw4QkFBZ0MsZUFBb0MsRUFBcUIsTUFBZTtRQUF4RyxpQkE4Q0M7UUE5QytCLG9CQUFlLEdBQWYsZUFBZSxDQUFxQjtRQUFxQixXQUFNLEdBQU4sTUFBTSxDQUFTO1FBWHhHLHdCQUFtQixHQUFhLENBQUMsR0FBRyxDQUFDLENBQUM7O1FBRXRDLGVBQVUsR0FBVyxDQUFDLENBQUM7Ozs7UUFFdkIsZ0JBQVcsR0FBVyxFQUFFLENBQUM7UUFDekIsZ0JBQVcsR0FBVyxNQUFNLENBQUMsaUJBQWlCLENBQUM7UUFDL0Msa0JBQWEsR0FBVyxDQUFDLENBQUM7O1FBRTFCLDhCQUF5QixHQUFDLEVBQUUsQ0FBQztRQUNyQix1QkFBa0IsR0FBRyxJQUFJLENBQUM7UUFDMUIsZ0JBQVcsR0FBQyxLQUFLLENBQUM7UUFFdEIsSUFBSSxDQUFDLEtBQUssR0FBRyxFQUFFLENBQUM7UUFDaEIsSUFBSSxDQUFDLGFBQWEsR0FBRyxJQUFJ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LENBQUMsQ0FBQyxFQUF4QixDQUF3QixFQUNyQyxHQUFHLENBQUMsQ0FBQyxDQUNULENBQUM7SUFDTixDQUFDOzs7OztJQUVELGdEQUFpQjs7OztJQUFqQixVQUFrQixRQUFnQjtRQUM5QixJQUFJLENBQUMsSUFBSSxDQUFDLFdBQVcsRUFBRTtZQUNuQixPQUFPLElBQUksQ0FBQztTQUNmO1FBQ0QsZ0NBQWdDO1FBQ2hDLE9BQU8sUUFBUSxJQUFJLElBQUksQ0FBQyxXQUFXLEdBQUcsSUFBSSxHQUFHLElBQUksQ0FBQyxDQUFDLE1BQU07SUFDN0QsQ0FBQzs7O2dCQXpmRCxtQkFBbUIsdUJBMEJOLFFBQVE7Z0JBcENGLFFBQVEsdUJBb0MyQyxRQUFROztJQWdlbEYsMkJBQUM7Q0FBQSxBQXBmRCxJQW9mQztTQXBmWSxvQkFBb0I7OztJQUM3QixxQ0FBb0I7O0lBQ3BCLDZDQUEwQzs7SUFDMUMsK0NBSUc7O0lBQ0gsb0NBQTBEOztJQUMxRCxtREFBc0M7O0lBRXRDLDBDQUF1Qjs7Ozs7SUFFdkIsMkNBQXlCOztJQUN6QiwyQ0FBK0M7O0lBQy9DLDZDQUEwQjs7SUFFMUIseURBQTZCOzs7OztJQUM3QixrREFBa0M7Ozs7O0lBQ2xDLDJDQUEwQjs7Ozs7SUFDZCwrQ0FBd0Q7Ozs7O0lBQUMsc0NBQW1DIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRXZlbnRFbWl0dGVyLCBJbmplY3RvciwgT3B0aW9uYWwgfSBmcm9tIFwiQGFuZ3VsYXIvY29yZVwiO1xyXG5pbXBvcnQgeyBPYnNlcnZhYmxlLCBTdWJqZWN0LCBTdWJzY3JpcHRpb24sIG9mIH0gZnJvbSBcInJ4anNcIjtcclxuaW1wb3J0IHsgbWVyZ2VNYXAsIGZpbmFsaXplIH0gZnJvbSBcInJ4anMvb3BlcmF0b3JzXCI7XHJcbmltcG9ydCB7IEZGaWxlVXRpbHMgfSBmcm9tIFwiLi4vdXRpbHMvaW5kZXhcIjtcclxuaW1wb3J0IHtcclxuICAgIFVwbG9hZEZpbGUsXHJcbiAgICBVcGxvYWRPdXRwdXQsXHJcbiAgICBVcGxvYWRJbnB1dCxcclxuICAgIFVwbG9hZFN0YXR1cyxcclxuICAgIEJsb2JGaWxlLFxyXG4gICAgVXBsb2FkU2VydmVyU2VydmljZSxcclxuICAgIFVwbG9hZGVyT3B0aW9ucyxcclxufSBmcm9tIFwiLi4vbW9kZWwvaW5kZXhcIjtcclxuaW1wb3J0IHsgTG9jYWxlU2VydmljZSB9IGZyb20gXCJAZmFycmlzL3VpLWxvY2FsZVwiO1xyXG5pbXBvcnQgeyBGQVJSSVNfVVBMT0FERklMRV9MT0NBTEVEQVRBIH0gZnJvbSBcIi4uL2xvY2FsZVwiO1xyXG5cclxuZXhwb3J0IGNsYXNzIEZGaWxlVXBsb2FkZXJTZXJ2aWNlIHtcclxuICAgIHF1ZXVlOiBVcGxvYWRGaWxlW107XHJcbiAgICBzZXJ2aWNlRXZlbnRzOiBFdmVudEVtaXR0ZXI8VXBsb2FkT3V0cHV0PjtcclxuICAgIHVwbG9hZFNjaGVkdWxlcjogU3ViamVjdDx7XHJcbiAgICAgICAgZmlsZTogVXBsb2FkRmlsZTtcclxuICAgICAgICBldmVudDogVXBsb2FkSW5wdXQ7XHJcbiAgICAgICAgZmlsZXM/OiBVcGxvYWRGaWxlW107XHJcbiAgICB9PjtcclxuICAgIHN1YnM6IHsgaWQ6IHN0cmluZzsgc3ViOiBTdWJzY3JpcHRpb247IGlkcz86IHN0cmluZ1tdIH1bXTtcclxuICAgIGFsbG93ZWRDb250ZW50VHlwZXM6IHN0cmluZ1tdID0gW1wiKlwiXTtcclxuICAgIC8v6buY6K6k5LiN6ZmQ5Yi2LDDku6PooajkuI3pmZDliLYgTnVtYmVyLlBPU0lUSVZFX0lORklOSVRZXHJcbiAgICBtYXhVcGxvYWRzOiBudW1iZXIgPSAwO1xyXG4gICAgLyoqIOWNleS9jU3vvIzpu5jorqTmmK8xMk0sMOS7o+ihqOS4jemZkOWItiAqL1xyXG4gICAgbWF4RmlsZVNpemU6IG51bWJlciA9IDEyO1xyXG4gICAgY29uY3VycmVuY3k6IG51bWJlciA9IE51bWJlci5QT1NJVElWRV9JTkZJTklUWTtcclxuICAgIHVwbG9hZGVkQ291bnQ6IG51bWJlciA9IDA7XHJcbiAgICAvLyDkuI3lhYHorrjlkI3np7DkuK3ljIXlkKvnibnmrorlrZfnrKZcclxuICAgIG5vdEFsbG93ZWRDaGFyc0luRmlsZU5hbWU9W107XHJcbiAgICBwcml2YXRlIGV4dGVuZFNlcnZlckNvbmZpZyA9IG51bGw7XHJcbiAgICBwcml2YXRlIGhhc0xvY2FsU2VyPWZhbHNlO1xyXG4gICAgY29uc3RydWN0b3IoQE9wdGlvbmFsKCkgcHJpdmF0ZSB1cGxvYWRTZXJ2ZXJTZXI6IFVwbG9hZFNlcnZlclNlcnZpY2UsQE9wdGlvbmFsKCkgcHJpdmF0ZSBpbmplY3Q6SW5qZWN0b3IgKSB7XHJcbiAgICAgICAgdGhpcy5xdWV1ZSA9IFtdO1xyXG4gICAgICAgIHRoaXMuc2VydmljZUV2ZW50cyA9IG5ldyBFdmVudEVtaXR0ZXI8VXBsb2FkT3V0cHV0PigpO1xyXG4gICAgICAgIC8vIOeci+aYr+WQpuWkmuivreiogOacjeWKoeW3suabtOaWsFxyXG4gICAgICAgIHRoaXMuaGFzTG9jYWxTZXI9RkZpbGVVdGlscy5nZXRMb2NhbFN0YXRlKG51bGwpO1xyXG4gICAgICAgIC8vIOS4uuWkmuivreiogOacjeWKoei1i+WAvFxyXG4gICAgICAgIGlmKHRoaXMuaW5qZWN0JiYhdGhpcy5oYXNMb2NhbFNlcil7XHJcbiAgICAgICAgICAgdGhpcy5oYXNMb2NhbFNlcj1GRmlsZVV0aWxzLmdldExvY2FsU3RhdGUodGhpcy5pbmplY3QuZ2V0KExvY2FsZVNlcnZpY2UpKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy51cGxvYWRTY2hlZHVsZXIgPSBuZXcgU3ViamVjdCgpO1xyXG4gICAgICAgIHRoaXMuc3VicyA9IFtdOyAgICAgIFxyXG4gICAgICAgIHRoaXMudXBsb2FkU2NoZWR1bGVyXHJcbiAgICAgICAgICAgIC5waXBlKFxyXG4gICAgICAgICAgICAgICAgbWVyZ2VNYXAoKHVwbG9hZCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnNlcnZlck1ldGhvZCh1cGxvYWQpO1xyXG4gICAgICAgICAgICAgICAgfSwgdGhpcy5jb25jdXJyZW5jeSlcclxuICAgICAgICAgICAgKVxyXG4gICAgICAgICAgICAuc3Vic2NyaWJlKCh1cGxvYWRPdXRwdXQpID0+IHtcclxuICAgICAgICAgICAgICAgIC8vIGlmICh1cGxvYWRPdXRwdXQudHlwZSA9PSAncmVtb3ZlZCcgfHwgdXBsb2FkT3V0cHV0LnR5cGUgPT0gJ2RvbmUnKSB7XHJcbiAgICAgICAgICAgICAgICAvLyAgIC8vIOWIoOmZpOaIluiAhWRvbmXnp7vpmaRcclxuICAgICAgICAgICAgICAgIC8vICAgY29uc3Qgc3ViSW5kZXggPSB0aGlzLnN1YnMuZmluZEluZGV4KHN1YiA9PiBzdWIuaWQgPT09IHVwbG9hZE91dHB1dC5maWxlLmlkKTtcclxuICAgICAgICAgICAgICAgIC8vICAgaWYgKHN1YkluZGV4ID4gLTEgJiYgdGhpcy5zdWJzW3N1YkluZGV4XS5zdWIpIHtcclxuICAgICAgICAgICAgICAgIC8vICAgICB0aGlzLnN1YnNbc3ViSW5kZXhdLnN1Yi51bnN1YnNjcmliZSgpO1xyXG4gICAgICAgICAgICAgICAgLy8gICB9XHJcbiAgICAgICAgICAgICAgICAvLyAgIHRoaXMuc3Vicy5zcGxpY2Uoc3ViSW5kZXgsIDEpO1xyXG4gICAgICAgICAgICAgICAgLy8gfVxyXG4gICAgICAgICAgICAgICAgaWYgKHVwbG9hZE91dHB1dC50eXBlID09IFwicmVtb3ZlZFwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8g5LqL5Lu25Lit6L+U5Zue55qE6YO95pivXHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5xdWV1ZSA9IHRoaXMucXVldWUuZmlsdGVyKFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAoaXRlbSkgPT4gaXRlbS5wcm9ncmVzcy5zdGF0dXMgIT09IFVwbG9hZFN0YXR1cy5SZW1vdmVcclxuICAgICAgICAgICAgICAgICAgICApO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICghdXBsb2FkT3V0cHV0Lmhhc093blByb3BlcnR5KFwibWVzc2FnZVwiKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB1cGxvYWRPdXRwdXRbXCJtZXNzYWdlXCJdID1GRmlsZVV0aWxzLmdldExvY2FsU3RyKFwidXBsb2FkU2VydmljZS5yZW1vdmVkXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmICh1cGxvYWRPdXRwdXQudHlwZSA9PSBcImVycm9yXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyDkuIrkvKDlpLHotKXnmoTpmYTku7bnp7vpmaRcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnF1ZXVlID0gdGhpcy5xdWV1ZS5maWx0ZXIoKHF1ZXVlSXRlbSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gKFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdXBsb2FkT3V0cHV0LmZpbGVzLmZpbmRJbmRleCgoaXRlbSkgPT4gcXVldWVJdGVtLmlkID09IGl0ZW0uaWQpIDxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDBcclxuICAgICAgICAgICAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHRoaXMuc2VydmljZUV2ZW50cy5lbWl0KHVwbG9hZE91dHB1dCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgc2V0T3B0aW9ucyhvcHRpb25zOiBVcGxvYWRlck9wdGlvbnMpIHtcclxuICAgICAgICAvLyDph43nva7mlofku7blpKflsI/jgIHnsbvlnovjgIHkuKrmlbDpmZDliLZcclxuICAgICAgICBpZiAob3B0aW9ucykge1xyXG4gICAgICAgICAgICBmb3IgKGxldCBwcm9wIGluIG9wdGlvbnMpIHtcclxuICAgICAgICAgICAgICAgIHRoaXNbcHJvcF0gPSBvcHRpb25zW3Byb3BdO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgaGFuZGxlRmlsZXMoaW5jb21pbmdGaWxlczogRmlsZUxpc3QpOiB2b2lkIHtcclxuICAgICAgICBjb25zdCBhbGxvd2VkSW5jb21pbmdGaWxlczogRmlsZVtdID0gW10ucmVkdWNlLmNhbGwoXHJcbiAgICAgICAgICAgIGluY29taW5nRmlsZXMsXHJcbiAgICAgICAgICAgIChhY2M6IEZpbGVbXSwgY2hlY2tGaWxlOiBGaWxlLCBpOiBudW1iZXIpID0+IHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGZ1dHVyZVF1ZXVlTGVuZ3RoID0gYWNjLmxlbmd0aCArIHRoaXMucXVldWUubGVuZ3RoICsgMTtcclxuICAgICAgICAgICAgICAgIGxldCBqdWRnZVJlc3VsdCA9IHRoaXMucmVqZWN0ZWRSZWFzb24oXHJcbiAgICAgICAgICAgICAgICAgICAgY2hlY2tGaWxlLm5hbWUsXHJcbiAgICAgICAgICAgICAgICAgICAgY2hlY2tGaWxlLnR5cGUsXHJcbiAgICAgICAgICAgICAgICAgICAgZnV0dXJlUXVldWVMZW5ndGgsXHJcbiAgICAgICAgICAgICAgICAgICAgY2hlY2tGaWxlLnNpemVcclxuICAgICAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgICAgICBpZiAoanVkZ2VSZXN1bHQuYWxsb3dlZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGFjYyA9IGFjYy5jb25jYXQoY2hlY2tGaWxlKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8g5LiN56ym5ZCI5b2T5YmN5paH5Lu257G75Z6L5oiW6ICF5YaF5a656LaF5Ye66ZmQ5Yi277yM5oqb5Ye65LqL5Lu2XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVqZWN0ZWRGaWxlOiBVcGxvYWRGaWxlID0gRkZpbGVVdGlscy5tYWtlVXBsb2FkRmlsZShcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2hlY2tGaWxlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpXHJcbiAgICAgICAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNlcnZpY2VFdmVudHMuZW1pdCh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwicmVqZWN0ZWRcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgZmlsZTogcmVqZWN0ZWRGaWxlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiBqdWRnZVJlc3VsdC5tZXNzYWdlLFxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGFjYztcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgW11cclxuICAgICAgICApO1xyXG5cclxuICAgICAgICAvLyDmnoTpgKDmlofku7bnu5PmnoTvvIzlubbljZXkuKrmipvlh7rkuovku7ZcclxuICAgICAgICBbXS5tYXAuY2FsbChhbGxvd2VkSW5jb21pbmdGaWxlcywgKGZpbGU6IEZpbGUsIGk6IG51bWJlcikgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCB1cGxvYWRGaWxlOiBVcGxvYWRGaWxlID0gRkZpbGVVdGlscy5tYWtlVXBsb2FkRmlsZShmaWxlLCBpKTtcclxuICAgICAgICAgICAgdGhpcy5xdWV1ZS5wdXNoKHVwbG9hZEZpbGUpO1xyXG4gICAgICAgICAgICB0aGlzLnNlcnZpY2VFdmVudHMuZW1pdCh7IHR5cGU6IFwiYWRkZWRUb1F1ZXVlXCIsIGZpbGU6IHVwbG9hZEZpbGUgfSk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIC8vIOaJgOacieeahOaWh+S7tumDveW3sue7j+a3u+WKoO+8jOaKm+WHuuS6i+S7tlxyXG4gICAgICAgIHRoaXMuc2VydmljZUV2ZW50cy5lbWl0KHsgdHlwZTogXCJhbGxBZGRlZFRvUXVldWVcIiB9KTtcclxuICAgIH1cclxuICAgIHByaXZhdGUgcmVqZWN0ZWRSZWFzb24obmFtZSwgdHlwZSwgcXVldWVsZW5ndGgsIHNpemUpIHtcclxuICAgICAgICBsZXQgYWxsb3dlZCA9IGZhbHNlO1xyXG4gICAgICAgIGxldCBtZXNzYWdlID0gXCJcIjtcclxuICAgICAgICAvLyDlt7LlrZjlnKjlkIzlkI3mlofku7ZcclxuICAgICAgICBsZXQgZmluZER1cGxpY2F0ZUluZGV4ID0gdGhpcy5xdWV1ZS5maW5kSW5kZXgoKGZpbGUpID0+IGZpbGUubmFtZSA9PSBuYW1lKTtcclxuICAgICAgICBpZiAoZmluZER1cGxpY2F0ZUluZGV4ID4gLTEpIHtcclxuICAgICAgICAgICAgbWVzc2FnZSA9RkZpbGVVdGlscy5nZXRMb2NhbFN0cihcInVwbG9hZFNlcnZpY2UuZmFpbGVkU2FtZU5hbWVcIik7XHJcbiAgICAgICAgfSBlbHNlIGlmICghdGhpcy5pc0NvbnRlbnRUeXBlQWxsb3dlZChuYW1lKSkge1xyXG4gICAgICAgICAgICBtZXNzYWdlID1GRmlsZVV0aWxzLmdldExvY2FsU3RyKFwidXBsb2FkU2VydmljZS5mYWlsZWRUeXBlXCIsW3RoaXMuYWxsb3dlZENvbnRlbnRUeXBlcy5qb2luKFwiLFwiKV0pO1xyXG4gICAgICAgIH0gZWxzZSBpZighdGhpcy5pc05hbWVBbGxvd2VkKG5hbWUpKXtcclxuICAgICAgICAgICAgbGV0IG5vdEFsbG93ZWRMZW49dGhpcy5ub3RBbGxvd2VkQ2hhcnNJbkZpbGVOYW1lLmxlbmd0aDtcclxuICAgICAgICAgICAgbGV0IHRNc3NhZ2U9Jyc7XHJcbiAgICAgICAgICAgIHRoaXMubm90QWxsb3dlZENoYXJzSW5GaWxlTmFtZS5tYXAoKG5vdEFsbG93SXRlbSxjdXJJbmRleCk9PntcclxuICAgICAgICAgICAgICAgIHRNc3NhZ2UgKz1gPGIgc3R5bGU9XCJkaXNwbGF5OmlubGluZS1ibG9jazttYXJnaW46MCA0cHg7bWluLXdpZHRoOjhweDt0ZXh0LWFsaWduOiBjZW50ZXI7XCI+JHtub3RBbGxvd0l0ZW0/bm90QWxsb3dJdGVtOlwiJm5ic3A7XCJ9PC9iPmA7XHJcbiAgICAgICAgICAgICAgICBpZihjdXJJbmRleCE9bm90QWxsb3dlZExlbi0xKXtcclxuICAgICAgICAgICAgICAgICAgICB0TXNzYWdlKz1cIixcIlxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgbWVzc2FnZT1GRmlsZVV0aWxzLmdldExvY2FsU3RyKFwidXBsb2FkU2VydmljZS5mYWlsZWROYW1lXCIsW3RNc3NhZ2VdKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAoXHJcbiAgICAgICAgICAgIHRoaXMubWF4VXBsb2FkcyA+IDAgJiZcclxuICAgICAgICAgICAgKHRoaXMubWF4VXBsb2FkcyA8PSB0aGlzLnVwbG9hZGVkQ291bnQgfHxcclxuICAgICAgICAgICAgICAgIHF1ZXVlbGVuZ3RoICsgdGhpcy51cGxvYWRlZENvdW50ID4gdGhpcy5tYXhVcGxvYWRzKVxyXG4gICAgICAgICkge1xyXG4gICAgICAgICAgICBtZXNzYWdlID1GRmlsZVV0aWxzLmdldExvY2FsU3RyKFwidXBsb2FkU2VydmljZS5mYWlsZWRDb3VudFwiLFt0aGlzLm1heFVwbG9hZHMrJyddKTtcclxuICAgICAgICB9IGVsc2UgaWYgKCF0aGlzLmlzRmlsZVNpemVBbGxvd2VkKHNpemUpKSB7XHJcbiAgICAgICAgICAgIG1lc3NhZ2UgPUZGaWxlVXRpbHMuZ2V0TG9jYWxTdHIoXCJ1cGxvYWRTZXJ2aWNlLmZhaWxlZFNpemVcIixbdGhpcy5tYXhGaWxlU2l6ZSsnJ10pO1xyXG4gICAgICAgIH0gZWxzZSBpZiAoc2l6ZSA9PSAwKSB7XHJcbiAgICAgICAgICAgIG1lc3NhZ2UgPUZGaWxlVXRpbHMuZ2V0TG9jYWxTdHIoXCJ1cGxvYWRTZXJ2aWNlLmZhaWxlZEVtcHR5XCIpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGFsbG93ZWQgPSB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBhbGxvd2VkLFxyXG4gICAgICAgICAgICBtZXNzYWdlLFxyXG4gICAgICAgIH07XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIOS7juWJjeerr+S8oOadpeS6i+S7tu+8jOi/m+ihjOacjeWKoeWZqOerr+aWueazleexu+Wei+WIpOaWrVxyXG4gICAgICogQHBhcmFtIGlucHV0XHJcbiAgICAgKi9cclxuICAgIGluaXRJbnB1dEV2ZW50cyhpbnB1dDogRXZlbnRFbWl0dGVyPFVwbG9hZElucHV0Pik6IFN1YnNjcmlwdGlvbiB7XHJcbiAgICAgICAgcmV0dXJuIGlucHV0LnN1YnNjcmliZSgoZXZlbnQ6IFVwbG9hZElucHV0KSA9PiB7XHJcbiAgICAgICAgICAgIHN3aXRjaCAoZXZlbnQudHlwZSkge1xyXG4gICAgICAgICAgICAgICAgY2FzZSAnc2xpY2VVcGxvYWQnOlxyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IF9maWxlcyA9IHRoaXMucXVldWUuZmlsdGVyKFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAoZmlsZSkgPT4gZmlsZS5wcm9ncmVzcy5zdGF0dXMgPT09IFVwbG9hZFN0YXR1cy5RdWV1ZSAmJiAoIWV2ZW50LmZpbGUgfHwgZmlsZS5maWxlSW5kZXggPT09IGV2ZW50LmZpbGUuZmlsZUluZGV4IClcclxuICAgICAgICAgICAgICAgICAgICApO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAoX2ZpbGVzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy51cGxvYWRTY2hlZHVsZXIubmV4dCh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlczogX2ZpbGVzLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnQ6IGV2ZW50LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZTogbnVsbCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgY2FzZSBcInVwbG9hZFwiOlxyXG4gICAgICAgICAgICAgICAgY2FzZSBcIm11bHRpcGFydFVwbG9hZFwiOlxyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHVwbG9hZEZpbGVJbmRleCA9IHRoaXMucXVldWUuZmluZEluZGV4KFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAoZmlsZSkgPT4gZmlsZSA9PT0gZXZlbnQuZmlsZVxyXG4gICAgICAgICAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHVwbG9hZEZpbGVJbmRleCAhPT0gLTEgJiYgZXZlbnQuZmlsZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnVwbG9hZFNjaGVkdWxlci5uZXh0KHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVzOiBbdGhpcy5xdWV1ZVt1cGxvYWRGaWxlSW5kZXhdXSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50OiBldmVudCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGU6IG51bGwsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgXCJ1cGxvYWRBbGxcIjpcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBmaWxlcyA9IHRoaXMucXVldWUuZmlsdGVyKFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAoZmlsZSkgPT4gZmlsZS5wcm9ncmVzcy5zdGF0dXMgPT09IFVwbG9hZFN0YXR1cy5RdWV1ZVxyXG4gICAgICAgICAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGZpbGVzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnQudHlwZSA9IFwidXBsb2FkXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudXBsb2FkU2NoZWR1bGVyLm5leHQoe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZXM6IGZpbGVzLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnQ6IGV2ZW50LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZTogbnVsbCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgY2FzZSBcImNhbmNlbFwiOlxyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGlkID0gZXZlbnQuaWQgfHwgbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIWlkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZmlsZUluZGV4ID0gdGhpcy5xdWV1ZS5maW5kSW5kZXgoKGZpbGUpID0+IGZpbGUuaWQgPT09IGlkKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZmlsZUluZGV4ICE9PSAtMSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNlcnZpY2VFdmVudHMuZW1pdCh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcImNhbmNlbGxlZFwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZXM6IFt0aGlzLnF1ZXVlW2ZpbGVJbmRleF1dLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogRkZpbGVVdGlscy5nZXRMb2NhbFN0cihcInVwbG9hZFNlcnZpY2UuY2FuY2VsVXBsb2FkXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnF1ZXVlLnNwbGljZShmaWxlSW5kZXgsIDEpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAvLyBjYXNlICdjYW5jZWwnOlxyXG4gICAgICAgICAgICAgICAgICAgIC8vIGNvbnN0IGlkID0gZXZlbnQuaWQgfHwgbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICAvLyBpZiAoIWlkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gfVxyXG4gICAgICAgICAgICAgICAgICAgIC8vIGNvbnN0IHN1YnMgPSB0aGlzLnN1YnMuZmlsdGVyKHN1YiA9PiBzdWIuaWQgPT09IGlkKTtcclxuICAgICAgICAgICAgICAgICAgICAvLyBzdWJzLmZvckVhY2goc3ViID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAvLyAgIGlmIChzdWIuc3ViKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gICAgIHN1Yi5zdWIudW5zdWJzY3JpYmUoKTtcclxuICAgICAgICAgICAgICAgICAgICAvLyAgICAgY29uc3QgZmlsZUluZGV4ID0gdGhpcy5xdWV1ZS5maW5kSW5kZXgoZmlsZSA9PiBmaWxlLmlkID09PSBpZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gICAgIGlmIChmaWxlSW5kZXggIT09IC0xKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gICAgICAgdGhpcy5xdWV1ZVtmaWxlSW5kZXhdLnByb2dyZXNzLnN0YXR1cyA9IFVwbG9hZFN0YXR1cy5DYW5jZWxsZWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gICAgICAgdGhpcy5zZXJ2aWNlRXZlbnRzLmVtaXQoeyB0eXBlOiAnY2FuY2VsbGVkJywgZmlsZTogdGhpcy5xdWV1ZVtmaWxlSW5kZXhdIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gICB9XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAvLyBjYXNlICdjYW5jZWxBbGwnOlxyXG4gICAgICAgICAgICAgICAgLy8gICB0aGlzLnN1YnMuZm9yRWFjaChzdWIgPT4ge1xyXG4gICAgICAgICAgICAgICAgLy8gICAgIGlmIChzdWIuc3ViKSB7XHJcbiAgICAgICAgICAgICAgICAvLyAgICAgICBzdWIuc3ViLnVuc3Vic2NyaWJlKCk7XHJcbiAgICAgICAgICAgICAgICAvLyAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIC8vICAgICBjb25zdCBmaWxlID0gdGhpcy5xdWV1ZS5maW5kKHVwbG9hZEZpbGUgPT4gdXBsb2FkRmlsZS5pZCA9PT0gc3ViLmlkKTtcclxuICAgICAgICAgICAgICAgIC8vICAgICBpZiAoZmlsZSkge1xyXG4gICAgICAgICAgICAgICAgLy8gICAgICAgZmlsZS5wcm9ncmVzcy5zdGF0dXMgPSBVcGxvYWRTdGF0dXMuQ2FuY2VsbGVkO1xyXG4gICAgICAgICAgICAgICAgLy8gICAgICAgdGhpcy5zZXJ2aWNlRXZlbnRzLmVtaXQoeyB0eXBlOiAnY2FuY2VsbGVkJywgZmlsZTogZmlsZSB9KTtcclxuICAgICAgICAgICAgICAgIC8vICAgICB9XHJcbiAgICAgICAgICAgICAgICAvLyAgIH0pO1xyXG4gICAgICAgICAgICAgICAgLy8gICBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgXCJoaWRlXCI6XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFldmVudC5pZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGxldCBpZHMgPSBldmVudC5pZC5zcGxpdChcIixcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5xdWV1ZSA9IHRoaXMucXVldWUuZmlsdGVyKChmaWxlKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCB0SW5kZXggPSBpZHMuZmluZEluZGV4KCh0SWQpID0+IHRJZCA9PSBmaWxlLmlkKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRJbmRleCA+IC0xID8gZmFsc2UgOiB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgY2FzZSBcImNhbmNlbEFsbFwiOlxyXG4gICAgICAgICAgICAgICAgICAgIC8vIOWPlua2iO+8jOebtOaOpeS7jumYn+WIl+S4reenu+mZpO+8jOS4jeeUqOS/ruaUueeKtuaAgVxyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHF1ZXVlRmlsZXMgPSB0aGlzLnF1ZXVlLmZpbHRlcihcclxuICAgICAgICAgICAgICAgICAgICAgICAgKHVwbG9hZEZpbGUpID0+IHVwbG9hZEZpbGUucHJvZ3Jlc3Muc3RhdHVzID09PSBVcGxvYWRTdGF0dXMuUXVldWVcclxuICAgICAgICAgICAgICAgICAgICApO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChxdWV1ZUZpbGVzLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNlcnZpY2VFdmVudHMuZW1pdCh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcImNhbmNlbGxlZFwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZXM6IHF1ZXVlRmlsZXMsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOkZGaWxlVXRpbHMuZ2V0TG9jYWxTdHIoXCJ1cGxvYWRTZXJ2aWNlLmNhbmNlbFVwbG9hZFwiKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucXVldWUgPSB0aGlzLnF1ZXVlLmZpbHRlcihcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICh1cGxvYWRGaWxlKSA9PiB1cGxvYWRGaWxlLnByb2dyZXNzLnN0YXR1cyAhPSBVcGxvYWRTdGF0dXMuUXVldWVcclxuICAgICAgICAgICAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBjYXNlIFwicmVtb3ZlXCI6XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFldmVudC5pZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlbW92ZUluZGV4ID0gdGhpcy5xdWV1ZS5maW5kSW5kZXgoXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIChmaWxlKSA9PiBmaWxlLmlkID09PSBldmVudC5pZFxyXG4gICAgICAgICAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlbW92ZUluZGV4ICE9PSAtMSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyDlvpfmnInkuKrlvIDlp4vliKDpmaTlkozlt7Lnu4/liKDpmaRcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5xdWV1ZVtyZW1vdmVJbmRleF0ucHJvZ3Jlc3Muc3RhdHVzID0gVXBsb2FkU3RhdHVzLlJlbW92ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy51cGxvYWRTY2hlZHVsZXIubmV4dCh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlczogW3RoaXMucXVldWVbcmVtb3ZlSW5kZXhdXSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50OiBldmVudCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGU6IG51bGwsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgXCJyZW1vdmVBbGxcIjpcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCByZW1vdmVRdWV1ZUZpbGVzID0gdGhpcy5xdWV1ZS5maWx0ZXIoXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICh1cGxvYWRGaWxlKSA9PiB1cGxvYWRGaWxlLnByb2dyZXNzLnN0YXR1cyA9PT0gVXBsb2FkU3RhdHVzLlF1ZXVlXHJcbiAgICAgICAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAocmVtb3ZlUXVldWVGaWxlcy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXJ2aWNlRXZlbnRzLmVtaXQoe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJjYW5jZWxsZWRcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVzOiByZW1vdmVRdWV1ZUZpbGVzLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogRkZpbGVVdGlscy5nZXRMb2NhbFN0cihcInVwbG9hZFNlcnZpY2UuZGVsZXRlU3VjY2Vzc1wiKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucXVldWUgPSB0aGlzLnF1ZXVlLmZpbHRlcihcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICh1cGxvYWRGaWxlKSA9PiB1cGxvYWRGaWxlLnByb2dyZXNzLnN0YXR1cyAhPSBVcGxvYWRTdGF0dXMuUXVldWVcclxuICAgICAgICAgICAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgLy8g5q2j5Zyo5LiK5Lyg55qE6ZmE5Lu25piv5aaC5L2V5aSE55CGXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gY29uc3QgZG9uZUZpbGVzID0gdGhpcy5xdWV1ZS5maWx0ZXIodXBsb2FkRmlsZSA9PiB1cGxvYWRGaWxlLnByb2dyZXNzLnN0YXR1cyA9PT0gVXBsb2FkU3RhdHVzLkRvbmUpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnF1ZXVlLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBldmVudC50eXBlID0gXCJyZW1vdmVcIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5xdWV1ZS5tYXAoXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAoaXRlbSkgPT4gKGl0ZW0ucHJvZ3Jlc3Muc3RhdHVzID0gVXBsb2FkU3RhdHVzLlJlbW92ZSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy51cGxvYWRTY2hlZHVsZXIubmV4dCh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlczogdGhpcy5xdWV1ZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50OiBldmVudCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGU6IG51bGwsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHNldEV4dGVuZFNlcnZlckNvbmZpZyhleHRlbmRTZXIpIHtcclxuICAgICAgICB0aGlzLmV4dGVuZFNlcnZlckNvbmZpZyA9IGV4dGVuZFNlcjtcclxuICAgIH1cclxuXHJcbiAgICBzZXJ2ZXJNZXRob2QodXBsb2FkOiB7XHJcbiAgICAgICAgZmlsZTogVXBsb2FkRmlsZTtcclxuICAgICAgICBldmVudDogVXBsb2FkSW5wdXQ7XHJcbiAgICAgICAgZmlsZXM/OiBVcGxvYWRGaWxlW107XHJcbiAgICB9KTogT2JzZXJ2YWJsZTxVcGxvYWRPdXRwdXQ+IHtcclxuICAgICAgICByZXR1cm4gbmV3IE9ic2VydmFibGUoKG9ic2VydmVyKSA9PiB7XHJcbiAgICAgICAgICAgIGxldCBzdWI7XHJcbiAgICAgICAgICAgIGxldCBpZHMgPSB1cGxvYWQuZmlsZXMubWFwKChmaWxlSXRlbSkgPT4gZmlsZUl0ZW0uaWQpO1xyXG4gICAgICAgICAgICBzd2l0Y2ggKHVwbG9hZC5ldmVudC50eXBlKSB7XHJcbiAgICAgICAgICAgICAgICBjYXNlICdzbGljZVVwbG9hZCc6XHJcbiAgICAgICAgICAgICAgICAgICAgc3ViID0gdGhpcy51cGxvYWQodXBsb2FkLmZpbGVzLCB1cGxvYWQuZXZlbnQpO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgY2FzZSBcInVwbG9hZFwiOlxyXG4gICAgICAgICAgICAgICAgICAgIHN1YiA9IHRoaXMudXBsb2FkKHVwbG9hZC5maWxlcywgdXBsb2FkLmV2ZW50KTtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgXCJtdWx0aXBhcnRVcGxvYWRcIjpcclxuICAgICAgICAgICAgICAgICAgICBzdWIgPSB0aGlzLm11bHRpcGFydFVwbG9hZCh1cGxvYWQuZmlsZXNbMF0sIHVwbG9hZC5ldmVudCk7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAvLyBjYXNlICd1cGxvYWRBbGwnOlxyXG4gICAgICAgICAgICAgICAgLy8gICBpZHMgPSB1cGxvYWQuZmlsZXMubWFwKGZpbGVJdGVtID0+IGZpbGVJdGVtLmlkKTtcclxuICAgICAgICAgICAgICAgIC8vICAgc3ViID0gdGhpcy51cGxvYWRBbGwodXBsb2FkLmZpbGVzLCB1cGxvYWQuZXZlbnQpO1xyXG4gICAgICAgICAgICAgICAgLy8gICBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgXCJyZW1vdmVcIjpcclxuICAgICAgICAgICAgICAgICAgICBzdWIgPSB0aGlzLnJlbW92ZSh1cGxvYWQuZmlsZXMsIHVwbG9hZC5ldmVudCk7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAvLyBjYXNlICdyZW1vdmVBbGwnOlxyXG4gICAgICAgICAgICAgICAgLy8gICBpZHMgPSB1cGxvYWQuZmlsZXMubWFwKGZpbGVJdGVtID0+IGZpbGVJdGVtLmlkKTtcclxuICAgICAgICAgICAgICAgIC8vICAgc3ViID0gdGhpcy5yZW1vdmVBbGwodXBsb2FkLmZpbGVzLCB1cGxvYWQuZXZlbnQpO1xyXG4gICAgICAgICAgICAgICAgLy8gICBicmVhaztcclxuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgc3ViID0gbnVsbDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoIXN1Yikge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHN1Yi5waXBlKGZpbmFsaXplKCgpID0+IHtcclxuICAgICAgICAgICAgICAgIGlmICghb2JzZXJ2ZXIuY2xvc2VkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgb2JzZXJ2ZXIuY29tcGxldGUoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSkpLnN1YnNjcmliZShcclxuICAgICAgICAgICAgICAgICAgICAob3V0cHV0KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9ic2VydmVyLm5leHQob3V0cHV0KTtcclxuICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgIChlcnIpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgb2JzZXJ2ZXIubmV4dChlcnIpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvYnNlcnZlci5jb21wbGV0ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgIHRoaXMuc3Vicy5wdXNoKHsgaWRzOiBpZHMsIHN1Yjogc3ViLCBpZDogXCJcIiB9KTtcclxuICAgICAgICAgICAgLy8gc3dpdGNoICh1cGxvYWQuZXZlbnQudHlwZSkge1xyXG4gICAgICAgICAgICAvLyAgIGNhc2UgJ3VwbG9hZEFsbCc6XHJcbiAgICAgICAgICAgIC8vICAgICB0aGlzLnN1YnMucHVzaCh7IGlkczogaWRzLCBzdWI6IHN1YiwgaWQ6ICcnIH0pO1xyXG4gICAgICAgICAgICAvLyAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIC8vICAgY2FzZSAncmVtb3ZlQWxsJzpcclxuICAgICAgICAgICAgLy8gICAgIHRoaXMuc3Vicy5wdXNoKHsgaWRzOiBpZHMsIHN1Yjogc3ViLCBpZDogJycgfSk7XHJcbiAgICAgICAgICAgIC8vICAgICBicmVhaztcclxuICAgICAgICAgICAgLy8gICBkZWZhdWx0OlxyXG5cclxuICAgICAgICAgICAgLy8gfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiDljZXkuKrmlofku7bkuIrkvKBcclxuICAgICAqIEBwYXJhbSBmaWxlXHJcbiAgICAgKiBAcGFyYW0gZXZlbnRcclxuICAgICAqL1xyXG4gICAgLy8gdXBsb2FkRmlsZShmaWxlOiBVcGxvYWRGaWxlLCBldmVudDogVXBsb2FkSW5wdXQpOiBPYnNlcnZhYmxlPFVwbG9hZE91dHB1dD4ge1xyXG4gICAgLy8gICBjb25zdCB1cGxvYWRGaWxlID0gPEJsb2JGaWxlPmZpbGUubmF0aXZlRmlsZTtcclxuICAgIC8vICAgY29uc3QgdXBsb2FkSW5kZXggPSB0aGlzLnF1ZXVlLmZpbmRJbmRleChvdXRGaWxlID0+IG91dEZpbGUubmF0aXZlRmlsZSA9PT0gdXBsb2FkRmlsZSk7XHJcblxyXG4gICAgLy8gICAvLyDlt7Lnu4/ooqvlj5bmtojnmoTkuI3og73ooqvkuIrkvKBcclxuICAgIC8vICAgaWYgKHRoaXMucXVldWVbdXBsb2FkSW5kZXhdLnByb2dyZXNzLnN0YXR1cyA9PT0gVXBsb2FkU3RhdHVzLkNhbmNlbGxlZCkge1xyXG4gICAgLy8gICAgIHJldHVybiBuZXcgT2JzZXJ2YWJsZShvYnNlcnZlciA9PiB7XHJcbiAgICAvLyAgICAgICBvYnNlcnZlci5jb21wbGV0ZSgpO1xyXG4gICAgLy8gICAgIH0pO1xyXG4gICAgLy8gICB9XHJcbiAgICAvLyAgIC8vIOaKm+WHuuW8gOWni+S4iuS8oOeahOS6i+S7tlxyXG4gICAgLy8gICB0aGlzLnNlcnZpY2VFdmVudHMuZW1pdCh7IHR5cGU6ICdzdGFydCcsIGZpbGVzOiBbZmlsZV0gfSk7XHJcbiAgICAvLyAgIHJldHVybiB0aGlzLnVwbG9hZFNlcnZlclNlci51cGxvYWQoZmlsZSwgZXZlbnQsIHRoaXMuZXh0ZW5kU2VydmVyQ29uZmlnKTtcclxuICAgIC8vIH1cclxuICAgIG11bHRpcGFydFVwbG9hZChcclxuICAgICAgICBmaWxlOiBVcGxvYWRGaWxlLFxyXG4gICAgICAgIGV2ZW50OiBVcGxvYWRJbnB1dFxyXG4gICAgKTogT2JzZXJ2YWJsZTxVcGxvYWRPdXRwdXQ+IHtcclxuICAgICAgICAvLyDmipvlh7rlvIDlp4vkuIrkvKDnmoTkuovku7ZcclxuICAgICAgICB0aGlzLnNlcnZpY2VFdmVudHMuZW1pdCh7IHR5cGU6IFwic3RhcnRcIiwgZmlsZXM6IFtmaWxlXSB9KTtcclxuICAgICAgICByZXR1cm4gdGhpcy51cGxvYWRTZXJ2ZXJTZXIubXVsdGlwYXJ0VXBsb2FkKFxyXG4gICAgICAgICAgICBmaWxlLFxyXG4gICAgICAgICAgICBldmVudCxcclxuICAgICAgICAgICAgdGhpcy5leHRlbmRTZXJ2ZXJDb25maWdcclxuICAgICAgICApO1xyXG4gICAgfVxyXG4gICAgdXBsb2FkKGZpbGVzOiBVcGxvYWRGaWxlW10sIGV2ZW50OiBVcGxvYWRJbnB1dCk6IE9ic2VydmFibGU8VXBsb2FkT3V0cHV0PiB7XHJcbiAgICAgICAgLy8g5oqb5Ye65byA5aeL5LiK5Lyg55qE5LqL5Lu2XHJcbiAgICAgICAgdGhpcy5zZXJ2aWNlRXZlbnRzLmVtaXQoeyB0eXBlOiBcInN0YXJ0XCIsIGZpbGVzOiBmaWxlcyB9KTtcclxuICAgICAgICByZXR1cm4gdGhpcy51cGxvYWRTZXJ2ZXJTZXIudXBsb2FkKGZpbGVzLCBldmVudCwgdGhpcy5leHRlbmRTZXJ2ZXJDb25maWcpO1xyXG4gICAgfVxyXG5cclxuICAgIHJlbW92ZShmaWxlczogVXBsb2FkRmlsZVtdLCBldmVudDogVXBsb2FkSW5wdXQpOiBPYnNlcnZhYmxlPFVwbG9hZE91dHB1dD4ge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnVwbG9hZFNlcnZlclNlci5yZW1vdmUoZmlsZXMsIGV2ZW50LCB0aGlzLmV4dGVuZFNlcnZlckNvbmZpZyk7XHJcbiAgICB9XHJcbiAgICAvLyByZW1vdmVBbGwoZmlsZXM6IFVwbG9hZEZpbGVbXSwgZXZlbnQ6IFVwbG9hZElucHV0KTogT2JzZXJ2YWJsZTxVcGxvYWRPdXRwdXQ+IHtcclxuICAgIC8vICAgcmV0dXJuIHRoaXMudXBsb2FkU2VydmVyU2VyLnJlbW92ZUFsbChmaWxlcywgZXZlbnQsIHRoaXMuZXh0ZW5kU2VydmVyQ29uZmlnKTtcclxuICAgIC8vIH1cclxuICAgIC8vIOmHjee9rlxyXG4gICAgcmVzZXQoKSB7XHJcbiAgICAgICAgdGhpcy5xdWV1ZSA9IFtdO1xyXG4gICAgICAgIC8vdGhpcy51cGxvYWRTY2hlZHVsZXIgPSBuZXcgU3ViamVjdCgpO1xyXG4gICAgICAgIC8vIHRoaXMuc3Vicy5mb3JFYWNoKHN1YiA9PiB7XHJcbiAgICAgICAgLy8gICBpZiAoc3ViLnN1Yikge1xyXG4gICAgICAgIC8vICAgICBzdWIuc3ViLnVuc3Vic2NyaWJlKCk7XHJcbiAgICAgICAgLy8gICB9XHJcbiAgICAgICAgLy8gfSk7XHJcbiAgICAgICAgdGhpcy5zdWJzID0gW107XHJcbiAgICB9XHJcblxyXG4gICAgLy8g5pqC5pe2XHJcbiAgICBzZXRDb250ZW50VHlwZXMoY29udGVudFR5cGVzOiBzdHJpbmdbXSk6IHZvaWQge1xyXG4gICAgICAgIGlmICh0eXBlb2YgY29udGVudFR5cGVzICE9PSBcInVuZGVmaW5lZFwiICYmIGNvbnRlbnRUeXBlcyBpbnN0YW5jZW9mIEFycmF5KSB7XHJcbiAgICAgICAgICAgIGlmIChjb250ZW50VHlwZXMuZmluZCgodHlwZTogc3RyaW5nKSA9PiB0eXBlID09PSBcIipcIikgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5hbGxvd2VkQ29udGVudFR5cGVzID0gW1wiKlwiXTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuYWxsb3dlZENvbnRlbnRUeXBlcyA9IGNvbnRlbnRUeXBlcztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuYWxsb3dlZENvbnRlbnRUeXBlcyA9IFtcIipcIl07XHJcbiAgICB9XHJcblxyXG4gICAgYWxsQ29udGVudFR5cGVzQWxsb3dlZCgpOiBib29sZWFuIHtcclxuICAgICAgICByZXR1cm4gKFxyXG4gICAgICAgICAgICB0aGlzLmFsbG93ZWRDb250ZW50VHlwZXMuZmluZCgodHlwZTogc3RyaW5nKSA9PiB0eXBlID09PSBcIipcIikgIT09XHJcbiAgICAgICAgICAgIHVuZGVmaW5lZFxyXG4gICAgICAgICk7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gbmFtZVxyXG4gICAgICovXHJcbiAgICBpc0NvbnRlbnRUeXBlQWxsb3dlZChuYW1lOiBzdHJpbmcpOiBib29sZWFuIHtcclxuICAgICAgICBpZiAodGhpcy5hbGxDb250ZW50VHlwZXNBbGxvd2VkKCkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIOmZhOS7tuayoeacieWQjue8gFxyXG4gICAgICAgIGlmIChuYW1lLmxhc3RJbmRleE9mKFwiLlwiKSA8IDApIHtcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBsZXQgbmFtZXN1ZmZpeCA9IG5hbWUuc3Vic3RyKG5hbWUubGFzdEluZGV4T2YoXCIuXCIpKTtcclxuICAgICAgICAvLyDnroDljJborqHnrpdcclxuICAgICAgICByZXR1cm4gKFxyXG4gICAgICAgICAgICB0aGlzLmFsbG93ZWRDb250ZW50VHlwZXMuZmluZEluZGV4KFxyXG4gICAgICAgICAgICAgICAgKGl0ZW0pID0+IGl0ZW0udG9Mb3dlckNhc2UoKSA9PSBuYW1lc3VmZml4LnRvTG93ZXJDYXNlKClcclxuICAgICAgICAgICAgKSA+IC0xXHJcbiAgICAgICAgKTtcclxuICAgIH1cclxuICAgIHByaXZhdGUgaXNOYW1lQWxsb3dlZChuYW1lOnN0cmluZyk6Ym9vbGVhbntcclxuICAgICAgICBpZighdGhpcy5ub3RBbGxvd2VkQ2hhcnNJbkZpbGVOYW1lfHx0aGlzLm5vdEFsbG93ZWRDaGFyc0luRmlsZU5hbWUubGVuZ3RoPT0wKXtcclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGxldCBwdXJOYW1lPW5hbWUubGFzdEluZGV4T2YoXCIuXCIpPi0xPyBuYW1lLnN1YnN0cigwLG5hbWUubGFzdEluZGV4T2YoXCIuXCIpKTpuYW1lO1xyXG4gICAgICAgICAvLyDnroDljJborqHnrpdcclxuICAgICAgICAgcmV0dXJuICEoXHJcbiAgICAgICAgICAgIHRoaXMubm90QWxsb3dlZENoYXJzSW5GaWxlTmFtZS5maW5kSW5kZXgoXHJcbiAgICAgICAgICAgICAgICAoaXRlbSkgPT4gcHVyTmFtZS5pbmRleE9mKGl0ZW0pPi0xXHJcbiAgICAgICAgICAgICkgPiAtMVxyXG4gICAgICAgICk7XHJcbiAgICB9XHJcblxyXG4gICAgaXNGaWxlU2l6ZUFsbG93ZWQoZmlsZVNpemU6IG51bWJlcik6IGJvb2xlYW4ge1xyXG4gICAgICAgIGlmICghdGhpcy5tYXhGaWxlU2l6ZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gZmlsZVNpemXmmK9i5Y2V5L2NIG1heEZpbGVTaXpl5pivTULljZXkvY1cclxuICAgICAgICByZXR1cm4gZmlsZVNpemUgPD0gdGhpcy5tYXhGaWxlU2l6ZSAqIDEwMjQgKiAxMDI0OyAvLyAqIDhcclxuICAgIH1cclxufVxyXG4iXX0=
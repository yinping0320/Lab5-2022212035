/*
 * @Author: Witt
 * @Date: 2018-10-17 14:13:40
 * @Last Modified by: Witt
 * @Last Modified time: 2018-10-17 16:08:34
 */
import { TaskNode } from './task_node';
import { TaskLink } from './task_link';
/**
 * 任务执行流程
 */
var TaskFlow = /** @class */ (function () {
    function TaskFlow() {
        /**
         * 节点集合
         */
        this.nodes = [];
        /**
         * 边集合
         */
        this.links = [];
        // #endregion
    }
    // #region 节点操作
    /**
     * 添加节点
     */
    TaskFlow.prototype.addNode = function (name, func) {
        var node = new TaskNode(name, func);
        this.nodes.push(node);
    };
    /**
     * 批量添加链接
     */
    TaskFlow.prototype.addNodes = function (nodes) {
        this.nodes = this.nodes.concat(nodes);
    };
    /**
     * 在目标节点之前插入一个节点
     * @param target 目标节点名称
     * @param name 名称
     * @param func 函数
     */
    TaskFlow.prototype.insertNode = function (target, name, func) {
        var index = this.findNodeIndex(target);
        var node = this.createNode(name, func);
        this.nodes.splice(index, 0, node);
    };
    /**
     * 在目标节点之前插入一个节点
     */
    TaskFlow.prototype.appendNode = function (target, name, func) {
        var index = this.findNodeIndex(target) + 1;
        var node = this.createNode(name, func);
        this.nodes.splice(index, 0, node);
    };
    /**
     * 获取节点索引
     * @param name 名称
     */
    TaskFlow.prototype.findNodeIndex = function (name) {
        return this.nodes.findIndex(function (node) {
            return node.name === name;
        });
    };
    /**
     * 创建任务节点
     * @param name 名称
     * @param func 函数
     */
    TaskFlow.prototype.createNode = function (name, func) {
        var node = new TaskNode(name, func);
        return node;
    };
    // #endregion
    // #region 链接操作
    /**
     * 添加链接
     * @param name 名称
     * @param func 函数
     */
    TaskFlow.prototype.addLink = function (from, to, condition) {
        var link = this.createLink(from, to, condition);
        this.links.push(link);
    };
    /**
     * 批量添加链接
     */
    TaskFlow.prototype.addLinks = function (links) {
        this.links = this.links.concat(links);
    };
    /**
     * 创建链接
     */
    TaskFlow.prototype.createLink = function (from, to, condition) {
        var link = new TaskLink(from, to, condition);
        return link;
    };
    // #endregion
    // #region 流程控制
    /**
     * 获取下一个节点
     * @param from    源节点名称
     * @param context 上下文
     */
    TaskFlow.prototype.getNext = function (from, context) {
        if (!from) {
            return this.nodes.shift();
        }
        // 符合满足条件的边
        var nextLink = this.links.find(function (link) {
            return link.from === from && link.canLink(context);
        });
        if (!nextLink) {
            return;
        }
        return this.nodes.find(function (node) {
            return node.name === nextLink.to;
        });
    };
    // #endregion
    // #region 其他方法
    /**
     * 克隆任务流
     */
    TaskFlow.prototype.clone = function () {
        var taskFlow = new TaskFlow();
        taskFlow.addNodes(this.nodes);
        taskFlow.addLinks(this.links);
        return taskFlow;
    };
    return TaskFlow;
}());
export { TaskFlow };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGFza19mbG93LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy9tb2JpbGUtZGV2a2l0LyIsInNvdXJjZXMiOlsibGliL2NvbW1hbmQvZmxvdy90YXNrX2Zsb3cudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7O0dBS0c7QUFFSCxPQUFPLEVBQVksUUFBUSxFQUFFLE1BQU0sYUFBYSxDQUFDO0FBQ2pELE9BQU8sRUFBWSxRQUFRLEVBQUUsTUFBTSxhQUFhLENBQUM7QUFHakQ7O0dBRUc7QUFDSDtJQUFBO1FBRUU7O1dBRUc7UUFDSyxVQUFLLEdBQWUsRUFBRSxDQUFDO1FBRS9COztXQUVHO1FBQ0ssVUFBSyxHQUFlLEVBQUUsQ0FBQztRQXFJL0IsYUFBYTtJQUNmLENBQUM7SUFuSUMsZUFBZTtJQUVmOztPQUVHO0lBQ0ksMEJBQU8sR0FBZCxVQUFlLElBQVksRUFBRSxJQUFjO1FBQ3pDLElBQU0sSUFBSSxHQUFHLElBQUksUUFBUSxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsQ0FBQztRQUN0QyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUN4QixDQUFDO0lBR0Q7O09BRUc7SUFDSSwyQkFBUSxHQUFmLFVBQWdCLEtBQWlCO1FBQy9CLElBQUksQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDeEMsQ0FBQztJQUVEOzs7OztPQUtHO0lBQ0ksNkJBQVUsR0FBakIsVUFBa0IsTUFBYyxFQUFFLElBQVksRUFBRSxJQUFjO1FBQzVELElBQU0sS0FBSyxHQUFHLElBQUksQ0FBQyxhQUFhLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDekMsSUFBTSxJQUFJLEdBQUcsSUFBSSxDQUFDLFVBQVUsQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUM7UUFDekMsSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsS0FBSyxFQUFFLENBQUMsRUFBRSxJ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O0lBQ2xCLENBQUM7SUFHSCxlQUFDO0FBQUQsQ0FBQyxBQWhKRCxJQWdKQztBQUVELE9BQU8sRUFBRSxRQUFRLEVBQUUsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8qXG4gKiBAQXV0aG9yOiBXaXR0XG4gKiBARGF0ZTogMjAxOC0xMC0xNyAxNDoxMzo0MFxuICogQExhc3QgTW9kaWZpZWQgYnk6IFdpdHRcbiAqIEBMYXN0IE1vZGlmaWVkIHRpbWU6IDIwMTgtMTAtMTcgMTY6MDg6MzRcbiAqL1xuXG5pbXBvcnQgeyBUYXNrRnVuYywgVGFza05vZGUgfSBmcm9tICcuL3Rhc2tfbm9kZSc7XG5pbXBvcnQgeyBMaW5rRnVuYywgVGFza0xpbmsgfSBmcm9tICcuL3Rhc2tfbGluayc7XG5pbXBvcnQgeyBDb21tYW5kQ29udGV4dCB9IGZyb20gJy4uL2NvbW1hbmRfY29udGV4dCc7XG5cbi8qKlxuICog5Lu75Yqh5omn6KGM5rWB56iLXG4gKi9cbmNsYXNzIFRhc2tGbG93IHtcblxuICAvKipcbiAgICog6IqC54K56ZuG5ZCIXG4gICAqL1xuICBwcml2YXRlIG5vZGVzOiBUYXNrTm9kZVtdID0gW107XG5cbiAgLyoqXG4gICAqIOi+uembhuWQiFxuICAgKi9cbiAgcHJpdmF0ZSBsaW5rczogVGFza0xpbmtbXSA9IFtdO1xuXG5cbiAgLy8gI3JlZ2lvbiDoioLngrnmk43kvZxcblxuICAvKipcbiAgICog5re75Yqg6IqC54K5XG4gICAqL1xuICBwdWJsaWMgYWRkTm9kZShuYW1lOiBzdHJpbmcsIGZ1bmM6IFRhc2tGdW5jKTogdm9pZCB7XG4gICAgY29uc3Qgbm9kZSA9IG5ldyBUYXNrTm9kZShuYW1lLCBmdW5jKTtcbiAgICB0aGlzLm5vZGVzLnB1c2gobm9kZSk7XG4gIH1cblxuXG4gIC8qKlxuICAgKiDmibnph4/mt7vliqDpk77mjqVcbiAgICovXG4gIHB1YmxpYyBhZGROb2Rlcyhub2RlczogVGFza05vZGVbXSkge1xuICAgIHRoaXMubm9kZXMgPSB0aGlzLm5vZGVzLmNvbmNhdChub2Rlcyk7XG4gIH1cblxuICAvKipcbiAgICog5Zyo55uu5qCH6IqC54K55LmL5YmN5o+S5YWl5LiA5Liq6IqC54K5XG4gICAqIEBwYXJhbSB0YXJnZXQg55uu5qCH6IqC54K55ZCN56ewXG4gICAqIEBwYXJhbSBuYW1lIOWQjeensFxuICAgKiBAcGFyYW0gZnVuYyDlh73mlbBcbiAgICovXG4gIHB1YmxpYyBpbnNlcnROb2RlKHRhcmdldDogc3RyaW5nLCBuYW1lOiBzdHJpbmcsIGZ1bmM6IFRhc2tGdW5jKTogdm9pZCB7XG4gICAgY29uc3QgaW5kZXggPSB0aGlzLmZpbmROb2RlSW5kZXgodGFyZ2V0KTtcbiAgICBjb25zdCBub2RlID0gdGhpcy5jcmVhdGVOb2RlKG5hbWUsIGZ1bmMpO1xuICAgIHRoaXMubm9kZXMuc3BsaWNlKGluZGV4LCAwLCBub2RlKTtcbiAgfVxuXG4gIC8qKlxuICAgKiDlnKjnm67moIfoioLngrnkuYvliY3mj5LlhaXkuIDkuKroioLngrlcbiAgICovXG4gIHB1YmxpYyBhcHBlbmROb2RlKHRhcmdldDogc3RyaW5nLCBuYW1lOiBzdHJpbmcsIGZ1bmM6IFRhc2tGdW5jKSB7XG4gICAgY29uc3QgaW5kZXggPSB0aGlzLmZpbmROb2RlSW5kZXgodGFyZ2V0KSArIDE7XG4gICAgY29uc3Qgbm9kZSA9IHRoaXMuY3JlYXRlTm9kZShuYW1lLCBmdW5jKTtcbiAgICB0aGlzLm5vZGVzLnNwbGljZShpbmRleCwgMCwgbm9kZSk7XG4gIH1cblxuICAvKipcbiAgICog6I635Y+W6IqC54K557Si5byVXG4gICAqIEBwYXJhbSBuYW1lIOWQjeensFxuICAgKi9cbiAgcHJpdmF0ZSBmaW5kTm9kZUluZGV4KG5hbWU6IHN0cmluZyk6IG51bWJlciB7XG4gICAgcmV0dXJuIHRoaXMubm9kZXMuZmluZEluZGV4KChub2RlOiBUYXNrTm9kZSkgPT4ge1xuICAgICAgcmV0dXJuIG5vZGUubmFtZSA9PT0gbmFtZTtcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiDliJvlu7rku7vliqHoioLngrlcbiAgICogQHBhcmFtIG5hbWUg5ZCN56ewXG4gICAqIEBwYXJhbSBmdW5jIOWHveaVsFxuICAgKi9cbiAgcHJpdmF0ZSBjcmVhdGVOb2RlKG5hbWU6IHN0cmluZywgZnVuYzogVGFza0Z1bmMpOiBUYXNrTm9kZSB7XG4gICAgY29uc3Qgbm9kZSA9IG5ldyBUYXNrTm9kZShuYW1lLCBmdW5jKTtcbiAgICByZXR1cm4gbm9kZTtcbiAgfVxuXG4gIC8vICNlbmRyZWdpb25cblxuXG4gIC8vICNyZWdpb24g6ZO+5o6l5pON5L2cXG5cbiAgLyoqXG4gICAqIOa3u+WKoOmTvuaOpVxuICAgKiBAcGFyYW0gbmFtZSDlkI3np7BcbiAgICogQHBhcmFtIGZ1bmMg5Ye95pWwXG4gICAqL1xuICBwdWJsaWMgYWRkTGluayhmcm9tOiBzdHJpbmcsIHRvOiBzdHJpbmcsIGNvbmRpdGlvbjogc3RyaW5nIHwgYm9vbGVhbikge1xuICAgIGNvbnN0IGxpbmsgPSB0aGlzLmNyZWF0ZUxpbmsoZnJvbSwgdG8sIGNvbmRpdGlvbik7XG4gICAgdGhpcy5saW5rcy5wdXNoKGxpbmspO1xuICB9XG5cbiAgLyoqXG4gICAqIOaJuemHj+a3u+WKoOmTvuaOpVxuICAgKi9cbiAgcHVibGljIGFkZExpbmtzKGxpbmtzOiBUYXNrTGlua1tdKSB7XG4gICAgdGhpcy5saW5rcyA9IHRoaXMubGlua3MuY29uY2F0KGxpbmtzKTtcbiAgfVxuXG4gIC8qKlxuICAgKiDliJvlu7rpk77mjqVcbiAgICovXG4gIHByaXZhdGUgY3JlYXRlTGluayhmcm9tOiBzdHJpbmcsIHRvOiBzdHJpbmcsIGNvbmRpdGlvbjogc3RyaW5nIHwgYm9vbGVhbikge1xuICAgIGNvbnN0IGxpbmsgPSBuZXcgVGFza0xpbmsoZnJvbSwgdG8sIGNvbmRpdGlvbik7XG4gICAgcmV0dXJuIGxpbms7XG4gIH1cblxuICAvLyAjZW5kcmVnaW9uXG5cblxuICAvLyAjcmVnaW9uIOa1geeoi+aOp+WItlxuICAvKipcbiAgICog6I635Y+W5LiL5LiA5Liq6IqC54K5XG4gICAqIEBwYXJhbSBmcm9tICAgIOa6kOiKgueCueWQjeensFxuICAgKiBAcGFyYW0gY29udGV4dCDkuIrkuIvmlodcbiAgICovXG4gIGdldE5leHQoZnJvbT86IHN0cmluZywgY29udGV4dD86IENvbW1hbmRDb250ZXh0KTogVGFza05vZGUge1xuICAgIGlmICghZnJvbSkge1xuICAgICAgcmV0dXJuIHRoaXMubm9kZXMuc2hpZnQoKTtcbiAgICB9XG5cbiAgICAvLyDnrKblkIjmu6HotrPmnaHku7bnmoTovrlcbiAgICBjb25zdCBuZXh0TGluayA9IHRoaXMubGlua3MuZmluZCgobGluazogVGFza0xpbmspID0+IHtcbiAgICAgIHJldHVybiBsaW5rLmZyb20gPT09IGZyb20gJiYgbGluay5jYW5MaW5rKGNvbnRleHQpO1xuICAgIH0pO1xuICAgIGlmICghbmV4dExpbmspIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcy5ub2Rlcy5maW5kKChub2RlOiBUYXNrTm9kZSkgPT4ge1xuICAgICAgcmV0dXJuIG5vZGUubmFtZSA9PT0gbmV4dExpbmsudG87XG4gICAgfSk7XG4gIH1cblxuICAvLyAjZW5kcmVnaW9uXG5cbiAgLy8gI3JlZ2lvbiDlhbbku5bmlrnms5VcblxuICAvKipcbiAgICog5YWL6ZqG5Lu75Yqh5rWBXG4gICAqL1xuICBjbG9uZSgpIHtcbiAgICBjb25zdCB0YXNrRmxvdyA9IG5ldyBUYXNrRmxvdygpO1xuICAgIHRhc2tGbG93LmFkZE5vZGVzKHRoaXMubm9kZXMpO1xuICAgIHRhc2tGbG93LmFkZExpbmtzKHRoaXMubGlua3MpO1xuICAgIHJldHVybiB0YXNrRmxvdztcbiAgfVxuXG4gIC8vICNlbmRyZWdpb25cbn1cblxuZXhwb3J0IHsgVGFza0Zsb3cgfTtcbiJdfQ==
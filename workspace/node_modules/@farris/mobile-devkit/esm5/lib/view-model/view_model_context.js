import { Injector, InjectFlags } from '../core/index';
import { AppContext } from '../app/index';
/**
 * 视图模型上下文
 */
var ViewModelContext = /** @class */ (function () {
    function ViewModelContext() {
    }
    ViewModelContext.prototype.init = function (viewModel) {
        this.innerViewModel = viewModel;
        this.id = this.innerViewModel.id;
        this.appContext = viewModel.injector.get(AppContext);
        this.regToTree();
        this.regToAppContext();
    };
    ViewModelContext.prototype.regToTree = function () {
        var parentInjector = this.innerViewModel.injector.get(Injector, null, InjectFlags.SkipSelf);
        if (parentInjector) {
            this.parent = parentInjector.get(ViewModelContext, null);
            this.root = this.parent ? this.parent.root : this;
        }
        else {
            this.parent = null;
            this.root = this;
        }
    };
    ViewModelContext.prototype.regToAppContext = function () {
        this.appContext.regViewModelContext(this);
    };
    Object.defineProperty(ViewModelContext.prototype, "viewModel", {
        get: function () {
            return this.innerViewModel;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(ViewModelContext.prototype, "injector", {
        get: function () {
            return this.innerViewModel.injector;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(ViewModelContext.prototype, "repository", {
        get: function () {
            return this.innerViewModel.repository;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(ViewModelContext.prototype, "bindingData", {
        get: function () {
            return this.innerViewModel.bindingData;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(ViewModelContext.prototype, "uiState", {
        get: function () {
            return this.innerViewModel.uiState;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(ViewModelContext.prototype, "stateMachine", {
        get: function () {
            return this.innerViewModel.stateMachine;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(ViewModelContext.prototype, "form", {
        get: function () {
            return this.innerViewModel.form;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(ViewModelContext.prototype, "commandBus", {
        get: function () {
            return this.innerViewModel.commandBus;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(ViewModelContext.prototype, "expressionEngineImpl", {
        get: function () {
            return this.innerViewModel.expressionEngineImpl;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(ViewModelContext.prototype, "expressionManager", {
        get: function () {
            return this.innerViewModel.expressionManager;
        },
        enumerable: true,
        configurable: true
    });
    ;
    Object.defineProperty(ViewModelContext.prototype, "expressionResult", {
        get: function () {
            return this.innerViewModel.expressionResult;
        },
        enumerable: true,
        configurable: true
    });
    ;
    Object.defineProperty(ViewModelContext.prototype, "controlsProxy", {
        get: function () {
            return this.innerViewModel.controlsProxy;
        },
        enumerable: true,
        configurable: true
    });
    ;
    ViewModelContext.prototype.getVirtualRootFrameContext = function () {
        var formFrameContext = this;
        // let parent = this.parent;
        // while (parent) {
        //   // 兼容没有重新编译的表单，如果判断parent.namespace存在会导致获取不到root-framecontext
        //   if (parent.namespace === this.namespace) {
        //     formFrameContext = parent;
        //     parent = parent.parent;
        //   } else {
        //     break;
        //   }
        // }
        return formFrameContext;
    };
    /**
     * 注册扩展命令
     */
    ViewModelContext.prototype.registerExtendCommand = function (commandName, commandHandler) {
        this.viewModel.registerExtendCommand(commandName, commandHandler);
    };
    return ViewModelContext;
}());
export { ViewModelContext };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidmlld19tb2RlbF9jb250ZXh0LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy9tb2JpbGUtZGV2a2l0LyIsInNvdXJjZXMiOlsibGliL3ZpZXctbW9kZWwvdmlld19tb2RlbF9jb250ZXh0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxRQUFRLEVBQUUsV0FBVyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBRXRELE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxjQUFjLENBQUM7QUFjMUM7O0dBRUc7QUFDSDtJQVlFO0lBQ0EsQ0FBQztJQUVNLCtCQUFJLEdBQVgsVUFBWSxTQUFTO1FBQ25CLElBQUksQ0FBQyxjQUFjLEdBQUcsU0FBUyxDQUFDO1FBQ2hDLElBQUksQ0FBQyxFQUFFLEdBQUcsSUFBSSxDQUFDLGNBQWMsQ0FBQyxFQUFFLENBQUM7UUFDakMsSUFBSSxDQUFDLFVBQVUsR0FBRyxTQUFTLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxVQUFVLENBQUMsQ0FBQztRQUNyRCxJQUFJLENBQUMsU0FBUyxFQUFFLENBQUM7UUFDakIsSUFBSSxDQUFDLGVBQWUsRUFBRSxDQUFDO0lBQ3pCLENBQUM7SUFFTSxvQ0FBUyxHQUFoQjtRQUNFLElBQU0sY0FBYyxHQUFHLElBQUksQ0FBQyxjQUFjLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBVyxRQUFRLEVBQUUsSUFBSSxFQUFFLFdBQVcsQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUN4RyxJQUFJLGNBQWMsRUFBRztZQUNuQixJQUFJLENBQUMsTUFBTSxHQUFHLGNBQWMsQ0FBQyxHQUFHLENBQUMsZ0JBQWdCLEVBQUUsSUFBSSxDQUFDLENBQUM7WUFDekQsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDO1NBQ25EO2FBQU07WUFDTCxJQUFJLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQztZQUNuQixJQUFJLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQztTQUNsQjtJQUNILENBQUM7SUFFTSwwQ0FBZSxHQUF0QjtRQUNFLElBQUksQ0FBQyxVQUFVLENBQUMsbUJBQW1CLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDNUMsQ0FBQztJQUVELHNCQUFXLHVDQUFTO2FBQXBCO1lBQ0UsT0FBTyxJQUFJLENBQUMsY0FBYyxDQUFDO1FBQzdCLENBQUM7OztPQUFBO0lBRUQsc0JBQVcsc0NBQVE7YUFBbkI7WUFDRSxPQUFPLElBQUksQ0FBQyxjQUFjLENBQUMsUUFBUSxDQUFDO1FBQ3RDLENBQUM7OztPQUFBO0lBRUQsc0JBQVcsd0NBQVU7YUFBckI7WUFDRSxPQUFPLElBQUksQ0FBQyxjQUFjLENBQUMsVUFBVSxDQUFDO1FBQ3hDLENBQUM7OztPQUFBO0lBRUQsc0JBQVcseUNBQVc7YUFBdEI7WUFDRSxPQUFPLElBQUksQ0FBQyxjQUFjLENBQUMsV0FBVyxDQUFDO1FBQ3pDLENBQUM7OztPQUFBO0lBRUQsc0JBQVcscUNBQU87YUFBbEI7WUFDRSxPQUFPLElBQUksQ0FBQyxjQUFjLENBQUMsT0FBTyxDQUFDO1FBQ3JDLENBQUM7OztPQUFBO0lBRUQsc0JBQVcsMENBQVk7YUFBdkI7WUFDRSxPQUFPLElBQUksQ0FBQyxjQUFjLENBQUMsWUFBWSxDQUFDO1FBQzFDLENBQUM7OztPQUFBO0lBRUQsc0JBQVcsa0NBQUk7YUFBZjtZQUNFLE9BQU8sSUFBSSxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUM7UUFDbEMsQ0FBQzs7O09BQUE7SUFFRCxzQkFBVyx3Q0FBVTthQUFyQjtZQUNFLE9BQU8sSUFBSSxDQUFDLGNBQWMsQ0FBQyxVQUFVLENBQUM7UUFDeEMsQ0FBQzs7O09BQUE7SUFFRCxzQkFBVyxrREFBb0I7YUFBL0I7WUFDRSxPQUFPLElBQUksQ0FBQyxjQUFjLENBQUMsb0JBQW9CLENBQUM7UUFDbEQsQ0FBQzs7O09BQUE7SUFFRCxzQkFBVywrQ0FBaUI7YUFBNUI7WUFDRSxPQUFPLElBQUksQ0FBQyxjQUFjLENBQUMsaUJBQWlCLENBQUM7UUFDL0MsQ0FBQzs7O09BQUE7SUFBQSxDQUFDO0lBRUYsc0JBQVcsOENBQWdCO2FBQTNCO1lBQ0UsT0FBTyxJQUFJLENBQUMsY0FBYyxDQUFDLGdCQUFnQixDQUFDO1FBQzlDLENBQUM7OztPQUFBO0lBQUEsQ0FBQztJQUVGLHNCQUFXLDJDQUFhO2FBQXhCO1lBQ0UsT0FBTyxJQUFJLENBQUMsY0FBYyxDQUFDLGFBQWEsQ0FBQztRQUMzQyxDQUFDOzs7T0FBQTtJQUFBLENBQUM7SUFFSyxxREFBMEIsR0FBakM7UUFDRSxJQUFJLGdCQUFnQixHQUFHLElBQUksQ0FBQztRQUM1Qiw0QkFBNEI7UUFDNUIsbUJBQW1CO1FBQ25CLGtFQUFrRTtRQUNsRSwrQ0FBK0M7UUFDL0MsaUNBQWlDO1FBQ2pDLDhCQUE4QjtRQUM5QixhQUFhO1FBQ2IsYUFBYTtRQUNiLE1BQU07UUFDTixJQUFJO1FBQ0osT0FBTyxnQkFBZ0IsQ0FBQztJQUMxQixDQUFDO0lBRUQ7O09BRUc7SUFDSSxnREFBcUIsR0FBNUIsVUFBNkIsV0FBbUIsRUFBRSxjQUFtQjtRQUNuRSxJQUFJLENBQUMsU0FBUyxDQUFDLHFCQUFxQixDQUFDLFdBQVcsRUFBRSxjQUFjLENBQUMsQ0FBQztJQUNwRSxDQUFDO0lBRUgsdUJBQUM7QUFBRCxDQUFDLEFBNUdELElBNEdDO0FBRUQsT0FBTyxFQUFFLGdCQUFnQixFQUFFLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RvciwgSW5qZWN0RmxhZ3MgfSBmcm9tICcuLi9jb3JlL2luZGV4JztcbmltcG9ydCB7IENvbnRleHQgfSBmcm9tICcuLi9jb250ZXh0L2luZGV4JztcbmltcG9ydCB7IEFwcENvbnRleHQgfSBmcm9tICcuLi9hcHAvaW5kZXgnO1xuaW1wb3J0IHsgRW50aXR5IH0gZnJvbSAnLi4vZW50aXR5L2luZGV4JztcbmltcG9ydCB7IFJlcG9zaXRvcnkgfSBmcm9tICcuLi9yZXBvc2l0b3J5L2luZGV4JztcbmltcG9ydCB7IEJpbmRpbmdEYXRhIH0gZnJvbSAnLi4vYmluZGluZy1kYXRhL2luZGV4JztcbmltcG9ydCB7IFVJU3RhdGUgfSBmcm9tICcuLi91aS1zdGF0ZS9pbmRleCc7XG5pbXBvcnQgeyBTdGF0ZU1hY2hpbmUgfSBmcm9tICcuLi9zdGF0ZS1tYWNoaW5lL2luZGV4JztcbmltcG9ydCB7IEZvcm0gfSBmcm9tICcuLi9mb3JtL2luZGV4JztcbmltcG9ydCB7IFZpZXdNb2RlbCB9IGZyb20gJy4uL3ZpZXctbW9kZWwvaW5kZXgnO1xuaW1wb3J0IHsgQ29tbWFuZEJ1cyB9IGZyb20gJy4uL2NvbW1hbmQvaW5kZXgnO1xuaW1wb3J0IHtcbiAgRXhwcmVzc2lvbkVuZ2luZUltcGwsIEV4cHJlc3Npb25NYW5hZ2VyLCBFeHByZXNzaW9uUmVzdWx0LCBFeHByZXNzaW9uUmVzdWx0RmFjdG9yeVxufSBmcm9tICcuLi9leHByZXNzaW9uL2luZGV4JztcbmltcG9ydCB7IENvbnRyb2xzUHJveHkgfSBmcm9tICcuLi9jb250cm9sLXByb3h5JztcblxuLyoqXG4gKiDop4blm77mqKHlnovkuIrkuIvmlodcbiAqL1xuY2xhc3MgVmlld01vZGVsQ29udGV4dCB7XG5cbiAgcHJpdmF0ZSBpbm5lclZpZXdNb2RlbDogVmlld01vZGVsO1xuXG4gIHB1YmxpYyBhcHBDb250ZXh0OiBBcHBDb250ZXh0O1xuXG4gIHB1YmxpYyByb290OiBWaWV3TW9kZWxDb250ZXh0O1xuXG4gIHB1YmxpYyBwYXJlbnQ6IFZpZXdNb2RlbENvbnRleHQ7XG5cbiAgcHVibGljIGlkOiBzdHJpbmc7XG5cbiAgY29uc3RydWN0b3IoKSB7XG4gIH1cblxuICBwdWJsaWMgaW5pdCh2aWV3TW9kZWwpOiB2b2lkIHtcbiAgICB0aGlzLmlubmVyVmlld01vZGVsID0gdmlld01vZGVsO1xuICAgIHRoaXMuaWQgPSB0aGlzLmlubmVyVmlld01vZGVsLmlkO1xuICAgIHRoaXMuYXBwQ29udGV4dCA9IHZpZXdNb2RlbC5pbmplY3Rvci5nZXQoQXBwQ29udGV4dCk7XG4gICAgdGhpcy5yZWdUb1RyZWUoKTtcbiAgICB0aGlzLnJlZ1RvQXBwQ29udGV4dCgpO1xuICB9XG5cbiAgcHVibGljIHJlZ1RvVHJlZSgpIHtcbiAgICBjb25zdCBwYXJlbnRJbmplY3RvciA9IHRoaXMuaW5uZXJWaWV3TW9kZWwuaW5qZWN0b3IuZ2V0PEluamVjdG9yPihJbmplY3RvciwgbnVsbCwgSW5qZWN0RmxhZ3MuU2tpcFNlbGYpO1xuICAgIGlmIChwYXJlbnRJbmplY3RvcikgIHtcbiAgICAgIHRoaXMucGFyZW50ID0gcGFyZW50SW5qZWN0b3IuZ2V0KFZpZXdNb2RlbENvbnRleHQsIG51bGwpO1xuICAgICAgdGhpcy5yb290ID0gdGhpcy5wYXJlbnQgPyB0aGlzLnBhcmVudC5yb290IDogdGhpcztcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5wYXJlbnQgPSBudWxsO1xuICAgICAgdGhpcy5yb290ID0gdGhpcztcbiAgICB9XG4gIH1cblxuICBwdWJsaWMgcmVnVG9BcHBDb250ZXh0KCkge1xuICAgIHRoaXMuYXBwQ29udGV4dC5yZWdWaWV3TW9kZWxDb250ZXh0KHRoaXMpO1xuICB9XG5cbiAgcHVibGljIGdldCB2aWV3TW9kZWwoKTogVmlld01vZGVsIHtcbiAgICByZXR1cm4gdGhpcy5pbm5lclZpZXdNb2RlbDtcbiAgfVxuXG4gIHB1YmxpYyBnZXQgaW5qZWN0b3IoKTogSW5qZWN0b3Ige1xuICAgIHJldHVybiB0aGlzLmlubmVyVmlld01vZGVsLmluamVjdG9yO1xuICB9XG5cbiAgcHVibGljIGdldCByZXBvc2l0b3J5KCk6IFJlcG9zaXRvcnk8RW50aXR5PiB7XG4gICAgcmV0dXJuIHRoaXMuaW5uZXJWaWV3TW9kZWwucmVwb3NpdG9yeTtcbiAgfVxuXG4gIHB1YmxpYyBnZXQgYmluZGluZ0RhdGEoKTogQmluZGluZ0RhdGEge1xuICAgIHJldHVybiB0aGlzLmlubmVyVmlld01vZGVsLmJpbmRpbmdEYXRhO1xuICB9XG5cbiAgcHVibGljIGdldCB1aVN0YXRlKCk6IFVJU3RhdGUge1xuICAgIHJldHVybiB0aGlzLmlubmVyVmlld01vZGVsLnVpU3RhdGU7XG4gIH1cblxuICBwdWJsaWMgZ2V0IHN0YXRlTWFjaGluZSgpOiBTdGF0ZU1hY2hpbmUge1xuICAgIHJldHVybiB0aGlzLmlubmVyVmlld01vZGVsLnN0YXRlTWFjaGluZTtcbiAgfVxuXG4gIHB1YmxpYyBnZXQgZm9ybSgpOiBGb3JtIHtcbiAgICByZXR1cm4gdGhpcy5pbm5lclZpZXdNb2RlbC5mb3JtO1xuICB9XG5cbiAgcHVibGljIGdldCBjb21tYW5kQnVzKCk6IENvbW1hbmRCdXMge1xuICAgIHJldHVybiB0aGlzLmlubmVyVmlld01vZGVsLmNvbW1hbmRCdXM7XG4gIH1cblxuICBwdWJsaWMgZ2V0IGV4cHJlc3Npb25FbmdpbmVJbXBsKCk6IEV4cHJlc3Npb25FbmdpbmVJbXBsIHtcbiAgICByZXR1cm4gdGhpcy5pbm5lclZpZXdNb2RlbC5leHByZXNzaW9uRW5naW5lSW1wbDtcbiAgfVxuXG4gIHB1YmxpYyBnZXQgZXhwcmVzc2lvbk1hbmFnZXIoKTogRXhwcmVzc2lvbk1hbmFnZXIge1xuICAgIHJldHVybiB0aGlzLmlubmVyVmlld01vZGVsLmV4cHJlc3Npb25NYW5hZ2VyO1xuICB9O1xuXG4gIHB1YmxpYyBnZXQgZXhwcmVzc2lvblJlc3VsdCgpOiBFeHByZXNzaW9uUmVzdWx0IHtcbiAgICByZXR1cm4gdGhpcy5pbm5lclZpZXdNb2RlbC5leHByZXNzaW9uUmVzdWx0O1xuICB9O1xuXG4gIHB1YmxpYyBnZXQgY29udHJvbHNQcm94eSgpOiBDb250cm9sc1Byb3h5IHtcbiAgICByZXR1cm4gdGhpcy5pbm5lclZpZXdNb2RlbC5jb250cm9sc1Byb3h5O1xuICB9O1xuXG4gIHB1YmxpYyBnZXRWaXJ0dWFsUm9vdEZyYW1lQ29udGV4dCgpIHtcbiAgICBsZXQgZm9ybUZyYW1lQ29udGV4dCA9IHRoaXM7XG4gICAgLy8gbGV0IHBhcmVudCA9IHRoaXMucGFyZW50O1xuICAgIC8vIHdoaWxlIChwYXJlbnQpIHtcbiAgICAvLyAgIC8vIOWFvOWuueayoeaciemHjeaWsOe8luivkeeahOihqOWNle+8jOWmguaenOWIpOaWrXBhcmVudC5uYW1lc3BhY2XlrZjlnKjkvJrlr7zoh7Tojrflj5bkuI3liLByb290LWZyYW1lY29udGV4dFxuICAgIC8vICAgaWYgKHBhcmVudC5uYW1lc3BhY2UgPT09IHRoaXMubmFtZXNwYWNlKSB7XG4gICAgLy8gICAgIGZvcm1GcmFtZUNvbnRleHQgPSBwYXJlbnQ7XG4gICAgLy8gICAgIHBhcmVudCA9IHBhcmVudC5wYXJlbnQ7XG4gICAgLy8gICB9IGVsc2Uge1xuICAgIC8vICAgICBicmVhaztcbiAgICAvLyAgIH1cbiAgICAvLyB9XG4gICAgcmV0dXJuIGZvcm1GcmFtZUNvbnRleHQ7XG4gIH1cblxuICAvKipcbiAgICog5rOo5YaM5omp5bGV5ZG95LukXG4gICAqL1xuICBwdWJsaWMgcmVnaXN0ZXJFeHRlbmRDb21tYW5kKGNvbW1hbmROYW1lOiBzdHJpbmcsIGNvbW1hbmRIYW5kbGVyOiBhbnkpIHtcbiAgICB0aGlzLnZpZXdNb2RlbC5yZWdpc3RlckV4dGVuZENvbW1hbmQoY29tbWFuZE5hbWUsIGNvbW1hbmRIYW5kbGVyKTtcbiAgfVxuXG59XG5cbmV4cG9ydCB7IFZpZXdNb2RlbENvbnRleHQgfTtcbiJdfQ==
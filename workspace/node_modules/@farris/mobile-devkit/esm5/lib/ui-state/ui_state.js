/*
 * @Author: Witt
 * @Date: 2018-11-17 13:38:23
 * @Last Modified by: Witt
 * @Last Modified time: 2018-11-17 13:38:50
 * @todo：临时删除原有功能，待重构
 */
import { Subject } from 'rxjs';
import { UIStateMetadataUtil } from './uistate_metadata_util';
import { ControlStateListener } from './control-state/control_state_listener';
/**
 * UI状态
 */
var UIState = /** @class */ (function () {
    function UIState() {
        this.changes = new Subject();
        this.innerData = Object.assign({});
        this._init();
    }
    UIState.prototype._init = function () {
        var construct = this.constructor;
        var uiFields = UIStateMetadataUtil.getUIFields(construct);
        var controlFields = UIStateMetadataUtil.getControlFields(construct);
        this.initializeUIField(uiFields);
        this.initializeControlField(controlFields);
    };
    //注册监听
    UIState.prototype.config = function (viewModelContext) {
        var construct = this.constructor;
        var controlFields = UIStateMetadataUtil.getControlFields(construct);
        if (controlFields && Object.keys(controlFields).length > 0) {
            this.controlStateListener = viewModelContext.injector.get(ControlStateListener);
        }
    };
    UIState.prototype.initializeUIField = function (uiFieldMetadata) {
        var _this = this;
        Object.keys(uiFieldMetadata).forEach(function (propertyName) {
            var fieldMetadata = uiFieldMetadata[propertyName];
            var uiField = fieldMetadata.stateName || propertyName;
            if (delete _this[propertyName]) {
                _this.defineProperty(propertyName, uiField);
            }
        });
    };
    UIState.prototype.initializeControlField = function (controlFieldMetadata) {
        var _this = this;
        Object.keys(controlFieldMetadata).forEach(function (propertyName) {
            var fieldMetadata = controlFieldMetadata[propertyName];
            var uiField = fieldMetadata.stateName || propertyName;
            if (delete _this[propertyName]) {
                _this.defineProperty(propertyName, uiField);
            }
        });
    };
    UIState.prototype.isExistProperty = function (propertyName) {
        if (this.innerData.hasOwnProperty(propertyName) || this.hasOwnProperty(propertyName)) {
            return true;
        }
        return false;
    };
    UIState.prototype.defineProperty = function (propertyName, field) {
        if (field === void 0) { field = null; }
        Object.defineProperty(this, propertyName, {
            get: function () {
                return field !== null ? this.innerData[field] : this.innerData[propertyName];
            },
            set: function (value) {
                // 值相同时不触发变更
                var oldValue = field !== null ? this.innerData[field] : this.innerData[propertyName];
                if (oldValue === value) {
                    return;
                }
                if (field !== null) {
                    this.innerData[field] = value;
                }
                else {
                    this.innerData[propertyName] = value;
                }
                this.changes.next({
                    field: propertyName,
                    value: value
                });
            }
        });
    };
    UIState.prototype.setPropertyValue = function (propertyName, value) {
        if (propertyName === '' || propertyName === undefined) {
            return;
        }
        if (!this.isExistProperty(propertyName)) {
            this.defineProperty(propertyName);
        }
        this[propertyName] = value;
    };
    return UIState;
}());
export { UIState };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidWlfc3RhdGUuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL21vYmlsZS1kZXZraXQvIiwic291cmNlcyI6WyJsaWIvdWktc3RhdGUvdWlfc3RhdGUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7OztHQU1HO0FBRUgsT0FBTyxFQUFFLE9BQU8sRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUMvQixPQUFPLEVBQUUsbUJBQW1CLEVBQUUsTUFBTSx5QkFBeUIsQ0FBQztBQUc5RCxPQUFPLEVBQUUsb0JBQW9CLEVBQUUsTUFBTSx3Q0FBd0MsQ0FBQztBQVE5RTs7R0FFRztBQUNIO0lBUUU7UUFDRSxJQUFJLENBQUMsT0FBTyxHQUFHLElBQUksT0FBTyxFQUEwQixDQUFDO1FBRXJELElBQUksQ0FBQyxTQUFTLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUNuQyxJQUFJLENBQUMsS0FBSyxFQUFFLENBQUM7SUFDZixDQUFDO0lBRUQsdUJBQUssR0FBTDtRQUNFLElBQU0sU0FBUyxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUM7UUFDbkMsSUFBTSxRQUFRLEdBQUcsbUJBQW1CLENBQUMsV0FBVyxDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBQzVELElBQU0sYUFBYSxHQUFHLG1CQUFtQixDQUFDLGdCQUFnQixDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBRXRFLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUNqQyxJQUFJLENBQUMsc0JBQXNCLENBQUMsYUFBYSxDQUFDLENBQUM7SUFDN0MsQ0FBQztJQUVELE1BQU07SUFDTix3QkFBTSxHQUFOLFVBQU8sZ0JBQWdCO1FBQ3JCLElBQU0sU0FBUyxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUM7UUFDbkMsSUFBTSxhQUFhLEdBQUcsbUJBQW1CLENBQUMsZ0JBQWdCLENBQUMsU0FBUyxDQUFDLENBQUM7UUFFdEUsSUFBRyxhQUFhLElBQUksTUFBTSxDQUFDLElBQUks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QUksWUFBWSxLQUFLLFNBQVMsRUFBRTtZQUNyRCxPQUFPO1NBQ1I7UUFDRCxJQUFJLENBQUMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxZQUFZLENBQUMsRUFBRTtZQUN2QyxJQUFJLENBQUMsY0FBYyxDQUFDLFlBQVksQ0FBQyxDQUFDO1NBQ25DO1FBQ0QsSUFBSSxDQUFDLFlBQVksQ0FBQyxHQUFHLEtBQUssQ0FBQztJQUM3QixDQUFDO0lBQ0gsY0FBQztBQUFELENBQUMsQUFqR0QsSUFpR0MiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuICogQEF1dGhvcjogV2l0dFxuICogQERhdGU6IDIwMTgtMTEtMTcgMTM6Mzg6MjNcbiAqIEBMYXN0IE1vZGlmaWVkIGJ5OiBXaXR0XG4gKiBATGFzdCBNb2RpZmllZCB0aW1lOiAyMDE4LTExLTE3IDEzOjM4OjUwXG4gKiBAdG9kb++8muS4tOaXtuWIoOmZpOWOn+acieWKn+iDve+8jOW+hemHjeaehFxuICovXG5cbmltcG9ydCB7IFN1YmplY3QgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IFVJU3RhdGVNZXRhZGF0YVV0aWwgfSBmcm9tICcuL3Vpc3RhdGVfbWV0YWRhdGFfdXRpbCc7XG5pbXBvcnQgeyBVSVN0YXRlUHJvcE1ldGFkYXRhIH0gZnJvbSAnLi9kZWNvcmF0b3JzJztcbmltcG9ydCB7IENvbnRyb2xTdGF0ZVByb3BNZXRhZGF0YSB9IGZyb20gJy4vY29udHJvbF9kZWNvcmF0b3JzJztcbmltcG9ydCB7IENvbnRyb2xTdGF0ZUxpc3RlbmVyIH0gZnJvbSAnLi9jb250cm9sLXN0YXRlL2NvbnRyb2xfc3RhdGVfbGlzdGVuZXInO1xuXG5leHBvcnQgaW50ZXJmYWNlIFVJU3RhdGVPYnNlcnZhYmxlUGFyYW0ge1xuICBmaWVsZDogc3RyaW5nO1xuICB2YWx1ZTogYW55O1xufVxuXG5cbi8qKlxuICogVUnnirbmgIFcbiAqL1xuZXhwb3J0IGNsYXNzIFVJU3RhdGUge1xuXG4gIGlubmVyRGF0YToge307XG5cbiAgLy8g55uR5ZCs5Y+Y5YyWXG4gIGNoYW5nZXM6IFN1YmplY3Q8VUlTdGF0ZU9ic2VydmFibGVQYXJhbT47XG4gIHB1YmxpYyBjb250cm9sU3RhdGVMaXN0ZW5lcjpDb250cm9sU3RhdGVMaXN0ZW5lcjtcblxuICBjb25zdHJ1Y3RvcigpIHtcbiAgICB0aGlzLmNoYW5nZXMgPSBuZXcgU3ViamVjdDxVSVN0YXRlT2JzZXJ2YWJsZVBhcmFtPigpO1xuXG4gICAgdGhpcy5pbm5lckRhdGEgPSBPYmplY3QuYXNzaWduKHt9KTtcbiAgICB0aGlzLl9pbml0KCk7XG4gIH1cblxuICBfaW5pdCgpIHtcbiAgICBjb25zdCBjb25zdHJ1Y3QgPSB0aGlzLmNvbnN0cnVjdG9yO1xuICAgIGNvbnN0IHVpRmllbGRzID0gVUlTdGF0ZU1ldGFkYXRhVXRpbC5nZXRVSUZpZWxkcyhjb25zdHJ1Y3QpO1xuICAgIGNvbnN0IGNvbnRyb2xGaWVsZHMgPSBVSVN0YXRlTWV0YWRhdGFVdGlsLmdldENvbnRyb2xGaWVsZHMoY29uc3RydWN0KTtcblxuICAgIHRoaXMuaW5pdGlhbGl6ZVVJRmllbGQodWlGaWVsZHMpO1xuICAgIHRoaXMuaW5pdGlhbGl6ZUNvbnRyb2xGaWVsZChjb250cm9sRmllbGRzKTtcbiAgfVxuXG4gIC8v5rOo5YaM55uR5ZCsXG4gIGNvbmZpZyh2aWV3TW9kZWxDb250ZXh0KXtcbiAgICBjb25zdCBjb25zdHJ1Y3QgPSB0aGlzLmNvbnN0cnVjdG9yO1xuICAgIGNvbnN0IGNvbnRyb2xGaWVsZHMgPSBVSVN0YXRlTWV0YWRhdGFVdGlsLmdldENvbnRyb2xGaWVsZHMoY29uc3RydWN0KTtcblxuICAgIGlmKGNvbnRyb2xGaWVsZHMgJiYgT2JqZWN0LmtleXMoY29udHJvbEZpZWxkcykubGVuZ3RoID4gMCl7XG4gICAgICB0aGlzLmNvbnRyb2xTdGF0ZUxpc3RlbmVyID0gdmlld01vZGVsQ29udGV4dC5pbmplY3Rvci5nZXQoQ29udHJvbFN0YXRlTGlzdGVuZXIpO1xuXG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBpbml0aWFsaXplVUlGaWVsZCh1aUZpZWxkTWV0YWRhdGE6IHsgW2tleTogc3RyaW5nXTogVUlTdGF0ZVByb3BNZXRhZGF0YSB9KTogdm9pZCB7XG4gICAgT2JqZWN0LmtleXModWlGaWVsZE1ldGFkYXRhKS5mb3JFYWNoKHByb3BlcnR5TmFtZSA9PiB7XG4gICAgICBjb25zdCBmaWVsZE1ldGFkYXRhID0gdWlGaWVsZE1ldGFkYXRhW3Byb3BlcnR5TmFtZV0gYXMgVUlTdGF0ZVByb3BNZXRhZGF0YTtcbiAgICAgIGNvbnN0IHVpRmllbGQgPSBmaWVsZE1ldGFkYXRhLnN0YXRlTmFtZSB8fCBwcm9wZXJ0eU5hbWU7XG5cbiAgICAgIGlmIChkZWxldGUgdGhpc1twcm9wZXJ0eU5hbWVdKSB7XG4gICAgICAgIHRoaXMuZGVmaW5lUHJvcGVydHkocHJvcGVydHlOYW1lLCB1aUZpZWxkKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgaW5pdGlhbGl6ZUNvbnRyb2xGaWVsZChjb250cm9sRmllbGRNZXRhZGF0YTogeyBba2V5OiBzdHJpbmddOiBDb250cm9sU3RhdGVQcm9wTWV0YWRhdGEgfSk6IHZvaWQge1xuICAgIE9iamVjdC5rZXlzKGNvbnRyb2xGaWVsZE1ldGFkYXRhKS5mb3JFYWNoKHByb3BlcnR5TmFtZSA9PiB7XG4gICAgICBjb25zdCBmaWVsZE1ldGFkYXRhID0gY29udHJvbEZpZWxkTWV0YWRhdGFbcHJvcGVydHlOYW1lXSBhcyBDb250cm9sU3RhdGVQcm9wTWV0YWRhdGE7XG4gICAgICBjb25zdCB1aUZpZWxkID0gZmllbGRNZXRhZGF0YS5zdGF0ZU5hbWUgfHwgcHJvcGVydHlOYW1lO1xuXG4gICAgICBpZiAoZGVsZXRlIHRoaXNbcHJvcGVydHlOYW1lXSkge1xuICAgICAgICB0aGlzLmRlZmluZVByb3BlcnR5KHByb3BlcnR5TmFtZSwgdWlGaWVsZCk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICBwdWJsaWMgaXNFeGlzdFByb3BlcnR5KHByb3BlcnR5TmFtZTogYW55KSB7XG4gICAgaWYgKHRoaXMuaW5uZXJEYXRhLmhhc093blByb3BlcnR5KHByb3BlcnR5TmFtZSkgfHwgdGhpcy5oYXNPd25Qcm9wZXJ0eShwcm9wZXJ0eU5hbWUpKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgcHJpdmF0ZSBkZWZpbmVQcm9wZXJ0eShwcm9wZXJ0eU5hbWU6IGFueSwgZmllbGQ6IGFueSA9IG51bGwpIHtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgcHJvcGVydHlOYW1lLCB7XG4gICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIGZpZWxkICE9PSBudWxsID8gdGhpcy5pbm5lckRhdGFbZmllbGRdIDogdGhpcy5pbm5lckRhdGFbcHJvcGVydHlOYW1lXTtcbiAgICAgIH0sXG4gICAgICBzZXQ6IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICAvLyDlgLznm7jlkIzml7bkuI3op6blj5Hlj5jmm7RcbiAgICAgICAgY29uc3Qgb2xkVmFsdWUgPSBmaWVsZCAhPT0gbnVsbCA/IHRoaXMuaW5uZXJEYXRhW2ZpZWxkXSA6IHRoaXMuaW5uZXJEYXRhW3Byb3BlcnR5TmFtZV07XG4gICAgICAgIGlmIChvbGRWYWx1ZSA9PT0gdmFsdWUpIHtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGZpZWxkICE9PSBudWxsKSB7XG4gICAgICAgICAgdGhpcy5pbm5lckRhdGFbZmllbGRdID0gdmFsdWU7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhpcy5pbm5lckRhdGFbcHJvcGVydHlOYW1lXSA9IHZhbHVlO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuY2hhbmdlcy5uZXh0KHtcbiAgICAgICAgICBmaWVsZDogcHJvcGVydHlOYW1lLFxuICAgICAgICAgIHZhbHVlOiB2YWx1ZVxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIHB1YmxpYyBzZXRQcm9wZXJ0eVZhbHVlKHByb3BlcnR5TmFtZTogYW55LCB2YWx1ZTogYW55KSB7XG4gICAgaWYgKHByb3BlcnR5TmFtZSA9PT0gJycgfHwgcHJvcGVydHlOYW1lID09PSB1bmRlZmluZWQpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKCF0aGlzLmlzRXhpc3RQcm9wZXJ0eShwcm9wZXJ0eU5hbWUpKSB7XG4gICAgICB0aGlzLmRlZmluZVByb3BlcnR5KHByb3BlcnR5TmFtZSk7XG4gICAgfVxuICAgIHRoaXNbcHJvcGVydHlOYW1lXSA9IHZhbHVlO1xuICB9XG59XG4iXX0=
import { of } from "rxjs";
import { HttpClient } from "../../http";
import { tap } from "rxjs/operators";
/**
 * 根据流程节点配置控制控件状态，
 * 控制逻辑：
 * 1.流程页面状态为ViewOnly时，该拦截不再生效。
 * 2.根据配置改变控件状态。
 */
var ProcessConfigStateInterceptor = /** @class */ (function () {
    function ProcessConfigStateInterceptor() {
        this.canIntercept = true;
        this.httpClient = new HttpClient();
    }
    /**
     * 初始化
     */
    ProcessConfigStateInterceptor.prototype.init = function (initContext) {
        var _this = this;
        var processContext = initContext.processContext;
        if (!processContext.isInWf) {
            this.canIntercept = false;
            return of(true);
        }
        if (!processContext.formConfigId) {
            this.canIntercept = false;
            return of(true);
        }
        // 获取表单的formConfigId参数
        var formConfigId = processContext.formConfigId;
        // const formConfigId = '5449bbbf-70d1-e6e8-9692-af54bf1e93bb';
        return this.httpClient.get('/api/runtime/wf/v1.0/formFormatConfig/' + formConfigId, {}).pipe(tap(function (reslut) {
            _this.fieldConfigs = [];
            if (reslut && reslut.formFieldConfigs) {
                reslut.formFieldConfigs.forEach(function (item) {
                    _this.fieldConfigs.push(item);
                });
            }
            _this.formButtonConfigs = [];
            if (reslut && reslut.formButtonConfigs) {
                reslut.formButtonConfigs.forEach(function (item) {
                    _this.formButtonConfigs.push(item);
                });
            }
        }));
    };
    /**
     * 拦截
     * @param interceptContext
     */
    ProcessConfigStateInterceptor.prototype.intercept = function (interceptContext) {
        if (!this.canIntercept) {
            return;
        }
        //页面状态为只读，不需要在这里控制了
        var processContext = interceptContext.processContext;
        if (processContext.uiStateInProcess === "ViewOnly") {
            return;
        }
        var suffix = '';
        if (interceptContext.controlState.controlInfo && interceptContext.controlState.controlInfo.type === 'LightAttachment') {
            if (interceptContext.type === 'hideDeleteBtn') {
                suffix = '_attachment_delete_btn';
            }
            else if (interceptContext.type === 'hideUploadBtn') {
                suffix = '_attachment_upload_btn';
            }
        }
        var fieldConfig;
        var formButtonConfig;
        if (this.fieldConfigs && this.fieldConfigs.length > 0) {
            fieldConfig = this.fieldConfigs.find(function (item) { return item['fieldId'] === interceptContext.controlState.controlInfo.id; });
        }
        if (this.formButtonConfigs && this.formButtonConfigs.length > 0) {
            formButtonConfig = this.formButtonConfigs.find(function (item) { return item['buttonId'] === interceptContext.controlState.controlInfo.id + suffix; });
        }
        switch (interceptContext.type) {
            case 'visible': {
                this.visibleStateIntercept(interceptContext, fieldConfig, formButtonConfig);
                break;
            }
            case 'disabled': {
                this.disabledStateIntercept(interceptContext, fieldConfig, formButtonConfig);
                break;
            }
            case 'readonly': {
                this.readonlyStateIntercept(interceptContext, fieldConfig, formButtonConfig);
                break;
            }
            case 'required': {
                this.requiredStateIntercept(interceptContext, fieldConfig, formButtonConfig);
                break;
            }
            case 'hideDeleteBtn':
            case 'hideUploadBtn': {
                this.attachmentBtnStateIntercept(interceptContext, formButtonConfig);
                break;
            }
        }
    };
    ProcessConfigStateInterceptor.prototype.visibleStateIntercept = function (interceptContext, fieldConfig, formButtonConfig) {
        if (fieldConfig && fieldConfig['fieldState'] === 'Hidden') {
            interceptContext.value = false;
        }
        if (formButtonConfig) {
            if (formButtonConfig['buttonState'] === 'Enable') {
                interceptContext.value = true;
            }
            else if (formButtonConfig['buttonState'] === 'Hidden') {
                interceptContext.value = false;
            }
        }
    };
    ProcessConfigStateInterceptor.prototype.disabledStateIntercept = function (interceptContext, fieldConfig, formButtonConfig) {
        if (fieldConfig && fieldConfig['fieldState'] === 'Editable') {
            interceptContext.value = false;
        }
        if (formButtonConfig) {
            if (formButtonConfig['buttonState'] === 'Enable') {
                interceptContext.value = false;
            }
            else if (formButtonConfig['buttonState'] === 'Disabled') {
                interceptContext.value = true;
            }
        }
    };
    ProcessConfigStateInterceptor.prototype.readonlyStateIntercept = function (interceptContext, fieldConfig, formButtonConfig) {
        if (fieldConfig && fieldConfig['fieldState'] === 'Readonly') {
            interceptContext.value = true;
        }
        else if (fieldConfig && fieldConfig['fieldState'] === 'Editable') {
            interceptContext.value = false;
        }
    };
    ProcessConfigStateInterceptor.prototype.requiredStateIntercept = function (interceptContext, fieldConfig, formButtonConfig) {
        if (fieldConfig && fieldConfig['fieldState'] === 'Required') {
            interceptContext.value = true;
        }
    };
    ProcessConfigStateInterceptor.prototype.attachmentBtnStateIntercept = function (interceptContext, formButtonConfig) {
        if (formButtonConfig) {
            switch (formButtonConfig['buttonState']) {
                case 'Enable': {
                    interceptContext.value = false;
                    break;
                }
                case 'Hidden': {
                    interceptContext.value = true;
                    break;
                }
                case 'Disabled': {
                    interceptContext.value = true;
                    break;
                }
            }
        }
    };
    return ProcessConfigStateInterceptor;
}());
export { ProcessConfigStateInterceptor };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHJvY2Vzc19jb25maWdfc3RhdGVfaW50ZXJjZXB0b3IuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL21vYmlsZS1kZXZraXQvIiwic291cmNlcyI6WyJsaWIvdWktc3RhdGUvY29udHJvbC1zdGF0ZS9wcm9jZXNzX2NvbmZpZ19zdGF0ZV9pbnRlcmNlcHRvci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQWMsRUFBRSxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQ3RDLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxZQUFZLENBQUM7QUFFeEMsT0FBTyxFQUFFLEdBQUcsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBSXJDOzs7OztHQUtHO0FBQ0g7SUFZSTtRQUZRLGlCQUFZLEdBQVcsSUFBSSxDQUFDO1FBR2hDLElBQUksQ0FBQyxVQUFVLEdBQUcsSUFBSSxVQUFVLEVBQUUsQ0FBQztJQUN2QyxDQUFDO0lBRUQ7O09BRUc7SUFDSSw0Q0FBSSxHQUFYLFVBQVksV0FBdUI7UUFBbkMsaUJBbUNDO1FBbENHLElBQU0sY0FBYyxHQUFtQixXQUFXLENBQUMsY0FBYyxDQUFDO1FBRWxFLElBQUksQ0FBQyxjQUFjLENBQUMsTUFBTSxFQUFFO1lBQ3hCLElBQUksQ0FBQyxZQUFZLEdBQUcsS0FBSyxDQUFDO1lBQzFCLE9BQU8sRUFBRSxDQUFDLElBQUksQ0FBQyxDQUFDO1NBQ25CO1FBRUQsSUFBSSxDQUFDLGNBQWMsQ0FBQyxZQUFZLEVBQUU7WUFDOUIsSUFBSSxDQUFDLFlBQVksR0FBRyxLQUFLLENBQUM7WUFDMUIsT0FBTyxFQUFFLENBQUMsSUFBSSxDQUFDLENBQUM7U0FDbkI7UUFFRCxzQkFBc0I7UUFDdEIsSUFBTSxZQUFZLEdBQUcsY0FBYyxDQUFDLFlBQVksQ0FBQztRQUNqRCwrREFBK0Q7UUFDL0QsT0FBTyxJQUFJLENBQUMsVUFBVSxDQUFDLEdBQUcsQ0FBQyx3Q0FBd0MsR0FBQyxZQUFZLEVBQUMsRUFBRSxDQUFDLENBQUMsSUFB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QUksQ0FBQztvQkFDOUIsTUFBTTtpQkFDVDthQUNKO1NBQ0o7SUFDTCxDQUFDO0lBRUwsb0NBQUM7QUFBRCxDQUFDLEFBbkxELElBbUxDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgT2JzZXJ2YWJsZSwgb2YgfSBmcm9tIFwicnhqc1wiO1xyXG5pbXBvcnQgeyBIdHRwQ2xpZW50IH0gZnJvbSBcIi4uLy4uL2h0dHBcIjtcclxuaW1wb3J0IHsgSW50ZXJjZXB0Q29udGV4dCwgQ29udHJvbFN0YXRlSW50ZXJjZXB0b3IsIEluaXRDb250ZXh0LCBQcm9jZXNzQ29udGV4dCB9IGZyb20gXCIuL2NvbnRyb2xfc3RhdGVfaW50ZXJjZXB0b3JcIjtcclxuaW1wb3J0IHsgdGFwIH0gZnJvbSBcInJ4anMvb3BlcmF0b3JzXCI7XHJcblxyXG5cclxuXHJcbi8qKlxyXG4gKiDmoLnmja7mtYHnqIvoioLngrnphY3nva7mjqfliLbmjqfku7bnirbmgIHvvIxcclxuICog5o6n5Yi26YC76L6R77yaXHJcbiAqIDEu5rWB56iL6aG16Z2i54q25oCB5Li6Vmlld09ubHnml7bvvIzor6Xmi6bmiKrkuI3lho3nlJ/mlYjjgIJcclxuICogMi7moLnmja7phY3nva7mlLnlj5jmjqfku7bnirbmgIHjgIJcclxuICovXHJcbmV4cG9ydCBjbGFzcyBQcm9jZXNzQ29uZmlnU3RhdGVJbnRlcmNlcHRvciBpbXBsZW1lbnRzIENvbnRyb2xTdGF0ZUludGVyY2VwdG9ye1xyXG4gICAgXHJcbiAgICAvL+Wtl+autemFjee9ruS/oeaBr1xyXG4gICAgcHJpdmF0ZSBmaWVsZENvbmZpZ3M6YW55W107XHJcbiAgICBcclxuICAgIC8v5oyJ6ZKu6YWN572u5L+h5oGvXHJcbiAgICBwcml2YXRlIGZvcm1CdXR0b25Db25maWdzOmFueVtdO1xyXG5cclxuICAgIHByaXZhdGUgaHR0cENsaWVudDpIdHRwQ2xpZW50O1xyXG5cclxuICAgIHByaXZhdGUgY2FuSW50ZXJjZXB0OmJvb2xlYW4gPSB0cnVlO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKCl7XHJcbiAgICAgICAgdGhpcy5odHRwQ2xpZW50ID0gbmV3IEh0dHBDbGllbnQoKTsgXHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDliJ3lp4vljJZcclxuICAgICAqL1xyXG4gICAgcHVibGljIGluaXQoaW5pdENvbnRleHQ6SW5pdENvbnRleHQpOk9ic2VydmFibGU8YW55PntcclxuICAgICAgICBjb25zdCBwcm9jZXNzQ29udGV4dDogUHJvY2Vzc0NvbnRleHQgPSBpbml0Q29udGV4dC5wcm9jZXNzQ29udGV4dDtcclxuXHJcbiAgICAgICAgaWYgKCFwcm9jZXNzQ29udGV4dC5pc0luV2YpIHtcclxuICAgICAgICAgICAgdGhpcy5jYW5JbnRlcmNlcHQgPSBmYWxzZTtcclxuICAgICAgICAgICAgcmV0dXJuIG9mKHRydWUpO1xyXG4gICAgICAgIH1cclxuICAgICBcclxuICAgICAgICBpZiAoIXByb2Nlc3NDb250ZXh0LmZvcm1Db25maWdJZCkge1xyXG4gICAgICAgICAgICB0aGlzLmNhbkludGVyY2VwdCA9IGZhbHNlO1xyXG4gICAgICAgICAgICByZXR1cm4gb2YodHJ1ZSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyDojrflj5booajljZXnmoRmb3JtQ29uZmlnSWTlj4LmlbBcclxuICAgICAgICBjb25zdCBmb3JtQ29uZmlnSWQgPSBwcm9jZXNzQ29udGV4dC5mb3JtQ29uZmlnSWQ7XHJcbiAgICAgICAgLy8gY29uc3QgZm9ybUNvbmZpZ0lkID0gJzU0NDliYmJmLTcwZDEtZTZlOC05NjkyLWFmNTRiZjFlOTNiYic7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuaHR0cENsaWVudC5nZXQoJy9hcGkvcnVudGltZS93Zi92MS4wL2Zvcm1Gb3JtYXRDb25maWcvJytmb3JtQ29uZmlnSWQse30pLnBpcGUoXHJcbiAgICAgICAgICAgIHRhcChyZXNsdXQ9PntcclxuICAgICAgICAgICAgICAgIHRoaXMuZmllbGRDb25maWdzID0gW107XHJcbiAgICAgICAgICAgICAgICBpZihyZXNsdXQgJiYgcmVzbHV0LmZvcm1GaWVsZENvbmZpZ3Mpe1xyXG4gICAgICAgICAgICAgICAgICAgIHJlc2x1dC5mb3JtRmllbGRDb25maWdzLmZvckVhY2goaXRlbT0+e1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmZpZWxkQ29uZmlncy5wdXNoKGl0ZW0pO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICB0aGlzLmZvcm1CdXR0b25Db25maWdzID0gW107XHJcbiAgICAgICAgICAgICAgICBpZihyZXNsdXQgJiYgcmVzbHV0LmZvcm1CdXR0b25Db25maWdzKXtcclxuICAgICAgICAgICAgICAgICAgICByZXNsdXQuZm9ybUJ1dHRvbkNvbmZpZ3MuZm9yRWFjaChpdGVtPT57XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZm9ybUJ1dHRvbkNvbmZpZ3MucHVzaChpdGVtKTtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgKVxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5oum5oiqXHJcbiAgICAgKiBAcGFyYW0gaW50ZXJjZXB0Q29udGV4dCBcclxuICAgICAqL1xyXG4gICAgcHVibGljIGludGVyY2VwdChpbnRlcmNlcHRDb250ZXh0OiBJbnRlcmNlcHRDb250ZXh0KTp2b2lkIHtcclxuICAgICAgICBpZighdGhpcy5jYW5JbnRlcmNlcHQpe1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvL+mhtemdoueKtuaAgeS4uuWPquivu++8jOS4jemcgOimgeWcqOi/memHjOaOp+WItuS6hlxyXG4gICAgICAgIGNvbnN0IHByb2Nlc3NDb250ZXh0OiBQcm9jZXNzQ29udGV4dCA9IGludGVyY2VwdENvbnRleHQucHJvY2Vzc0NvbnRleHQ7XHJcbiAgICAgICAgaWYocHJvY2Vzc0NvbnRleHQudWlTdGF0ZUluUHJvY2VzcyA9PT0gXCJWaWV3T25seVwiKXtcclxuICAgICAgICAgICAgcmV0dXJuIDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGxldCBzdWZmaXggPSAnJztcclxuICAgICAgICBpZihpbnRlcmNlcHRDb250ZXh0LmNvbnRyb2xTdGF0ZS5jb250cm9sSW5mbyAmJiBpbnRlcmNlcHRDb250ZXh0LmNvbnRyb2xTdGF0ZS5jb250cm9sSW5mby50eXBlID09PSAnTGlnaHRBdHRhY2htZW50Jyl7XHJcbiAgICAgICAgICAgIGlmKGludGVyY2VwdENvbnRleHQudHlwZSA9PT0gJ2hpZGVEZWxldGVCdG4nKXtcclxuICAgICAgICAgICAgICAgIHN1ZmZpeCA9ICdfYXR0YWNobWVudF9kZWxldGVfYnRuJztcclxuICAgICAgICAgICAgfWVsc2UgaWYoaW50ZXJjZXB0Q29udGV4dC50eXBlID09PSAnaGlkZVVwbG9hZEJ0bicpe1xyXG4gICAgICAgICAgICAgICAgc3VmZml4ID0gJ19hdHRhY2htZW50X3VwbG9hZF9idG4nXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGxldCBmaWVsZENvbmZpZztcclxuICAgICAgICBsZXQgZm9ybUJ1dHRvbkNvbmZpZ1xyXG4gICAgICAgIGlmKHRoaXMuZmllbGRDb25maWdzICYmIHRoaXMuZmllbGRDb25maWdzLmxlbmd0aCA+IDApe1xyXG4gICAgICAgICAgICBmaWVsZENvbmZpZyA9IHRoaXMuZmllbGRDb25maWdzLmZpbmQoaXRlbT0+aXRlbVsnZmllbGRJZCddID09PSBpbnRlcmNlcHRDb250ZXh0LmNvbnRyb2xTdGF0ZS5jb250cm9sSW5mby5pZCk7XHJcbiAgICAgICAgfSAgIFxyXG5cclxuICAgICAgICBpZih0aGlzLmZvcm1CdXR0b25Db25maWdzICYmIHRoaXMuZm9ybUJ1dHRvbkNvbmZpZ3MubGVuZ3RoID4gMCl7XHJcbiAgICAgICAgICAgIGZvcm1CdXR0b25Db25maWcgPSB0aGlzLmZvcm1CdXR0b25Db25maWdzLmZpbmQoaXRlbT0+aXRlbVsnYnV0dG9uSWQnXSA9PT0gaW50ZXJjZXB0Q29udGV4dC5jb250cm9sU3RhdGUuY29udHJvbEluZm8uaWQrc3VmZml4KTtcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICBzd2l0Y2goaW50ZXJjZXB0Q29udGV4dC50eXBlKSB7XHJcbiAgICAgICAgICAgIGNhc2UgJ3Zpc2libGUnOntcclxuICAgICAgICAgICAgICAgIHRoaXMudmlzaWJsZVN0YXRlSW50ZXJjZXB0KGludGVyY2VwdENvbnRleHQsZmllbGRDb25maWcsZm9ybUJ1dHRvbkNvbmZpZyk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjYXNlICdkaXNhYmxlZCc6e1xyXG4gICAgICAgICAgICAgICAgdGhpcy5kaXNhYmxlZFN0YXRlSW50ZXJjZXB0KGludGVyY2VwdENvbnRleHQsZmllbGRDb25maWcsZm9ybUJ1dHRvbkNvbmZpZyk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjYXNlICdyZWFkb25seSc6e1xyXG4gICAgICAgICAgICAgICAgdGhpcy5yZWFkb25seVN0YXRlSW50ZXJjZXB0KGludGVyY2VwdENvbnRleHQsZmllbGRDb25maWcsZm9ybUJ1dHRvbkNvbmZpZyk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjYXNlICdyZXF1aXJlZCc6e1xyXG4gICAgICAgICAgICAgICAgdGhpcy5yZXF1aXJlZFN0YXRlSW50ZXJjZXB0KGludGVyY2VwdENvbnRleHQsZmllbGRDb25maWcsZm9ybUJ1dHRvbkNvbmZpZyk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjYXNlICdoaWRlRGVsZXRlQnRuJzogY2FzZSAnaGlkZVVwbG9hZEJ0bic6e1xyXG4gICAgICAgICAgICAgICAgdGhpcy5hdHRhY2htZW50QnRuU3RhdGVJbnRlcmNlcHQoaW50ZXJjZXB0Q29udGV4dCxmb3JtQnV0dG9uQ29uZmlnKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcblxyXG4gICAgcHJpdmF0ZSB2aXNpYmxlU3RhdGVJbnRlcmNlcHQoaW50ZXJjZXB0Q29udGV4dDogSW50ZXJjZXB0Q29udGV4dCxmaWVsZENvbmZpZzphbnlbXSxmb3JtQnV0dG9uQ29uZmlnOmFueVtdKSB7XHJcbiAgICAgICAgaWYoZmllbGRDb25maWcgJiYgZmllbGRDb25maWdbJ2ZpZWxkU3RhdGUnXSA9PT0gJ0hpZGRlbicpe1xyXG4gICAgICAgICAgICBpbnRlcmNlcHRDb250ZXh0LnZhbHVlID0gZmFsc2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZihmb3JtQnV0dG9uQ29uZmlnKXtcclxuICAgICAgICAgICAgaWYoZm9ybUJ1dHRvbkNvbmZpZ1snYnV0dG9uU3RhdGUnXSA9PT0gJ0VuYWJsZScpe1xyXG4gICAgICAgICAgICAgICAgaW50ZXJjZXB0Q29udGV4dC52YWx1ZSA9IHRydWU7XHJcbiAgICAgICAgICAgIH1lbHNlIGlmKGZvcm1CdXR0b25Db25maWdbJ2J1dHRvblN0YXRlJ10gPT09ICdIaWRkZW4nKXtcclxuICAgICAgICAgICAgICAgIGludGVyY2VwdENvbnRleHQudmFsdWUgPSBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGRpc2FibGVkU3RhdGVJbnRlcmNlcHQoaW50ZXJjZXB0Q29udGV4dDogSW50ZXJjZXB0Q29udGV4dCxmaWVsZENvbmZpZzphbnlbXSxmb3JtQnV0dG9uQ29uZmlnOmFueVtdKSB7XHJcbiAgICAgICAgaWYoZmllbGRDb25maWcgJiYgZmllbGRDb25maWdbJ2ZpZWxkU3RhdGUnXSA9PT0gJ0VkaXRhYmxlJyl7XHJcbiAgICAgICAgICAgIGludGVyY2VwdENvbnRleHQudmFsdWUgPSBmYWxzZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmKGZvcm1CdXR0b25Db25maWcpe1xyXG4gICAgICAgICAgICBpZihmb3JtQnV0dG9uQ29uZmlnWydidXR0b25TdGF0ZSddID09PSAnRW5hYmxlJyl7XHJcbiAgICAgICAgICAgICAgICBpbnRlcmNlcHRDb250ZXh0LnZhbHVlID0gZmFsc2U7XHJcbiAgICAgICAgICAgIH1lbHNlIGlmKGZvcm1CdXR0b25Db25maWdbJ2J1dHRvblN0YXRlJ10gPT09ICdEaXNhYmxlZCcpe1xyXG4gICAgICAgICAgICAgICAgaW50ZXJjZXB0Q29udGV4dC52YWx1ZSA9IHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgIFxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgcmVhZG9ubHlTdGF0ZUludGVyY2VwdChpbnRlcmNlcHRDb250ZXh0OiBJbnRlcmNlcHRDb250ZXh0LGZpZWxkQ29uZmlnOmFueVtdLGZvcm1CdXR0b25Db25maWc6YW55W10pIHtcclxuICAgICAgICBpZihmaWVsZENvbmZpZyAmJiBmaWVsZENvbmZpZ1snZmllbGRTdGF0ZSddID09PSAnUmVhZG9ubHknKXtcclxuICAgICAgICAgICAgaW50ZXJjZXB0Q29udGV4dC52YWx1ZSA9IHRydWU7XHJcbiAgICAgICAgfWVsc2UgaWYoZmllbGRDb25maWcgJiYgZmllbGRDb25maWdbJ2ZpZWxkU3RhdGUnXSA9PT0gJ0VkaXRhYmxlJyl7XHJcbiAgICAgICAgICAgIGludGVyY2VwdENvbnRleHQudmFsdWUgPSBmYWxzZTtcclxuICAgICAgICB9IFxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgcmVxdWlyZWRTdGF0ZUludGVyY2VwdChpbnRlcmNlcHRDb250ZXh0OiBJbnRlcmNlcHRDb250ZXh0LGZpZWxkQ29uZmlnOmFueVtdLGZvcm1CdXR0b25Db25maWc6YW55W10pIHtcclxuICAgICAgICBpZihmaWVsZENvbmZpZyAmJiBmaWVsZENvbmZpZ1snZmllbGRTdGF0ZSddID09PSAnUmVxdWlyZWQnKXtcclxuICAgICAgICAgICAgaW50ZXJjZXB0Q29udGV4dC52YWx1ZSA9IHRydWU7XHJcbiAgICAgICAgfSBcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGF0dGFjaG1lbnRCdG5TdGF0ZUludGVyY2VwdChpbnRlcmNlcHRDb250ZXh0OiBJbnRlcmNlcHRDb250ZXh0LGZvcm1CdXR0b25Db25maWc6YW55W10pe1xyXG4gICAgICAgIGlmKGZvcm1CdXR0b25Db25maWcpe1xyXG4gICAgICAgICAgICBzd2l0Y2goZm9ybUJ1dHRvbkNvbmZpZ1snYnV0dG9uU3RhdGUnXSl7XHJcbiAgICAgICAgICAgICAgICBjYXNlICdFbmFibGUnOntcclxuICAgICAgICAgICAgICAgICAgICBpbnRlcmNlcHRDb250ZXh0LnZhbHVlID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBjYXNlICdIaWRkZW4nOntcclxuICAgICAgICAgICAgICAgICAgICBpbnRlcmNlcHRDb250ZXh0LnZhbHVlID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGNhc2UgJ0Rpc2FibGVkJzp7XHJcbiAgICAgICAgICAgICAgICAgICAgaW50ZXJjZXB0Q29udGV4dC52YWx1ZSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBcclxufSJdfQ==
/*
 * @Author: Witt
 * @Date: 2018-10-12 15:37:11
 * @Last Modified by: aalizzwell
 * @Last Modified time: 2019-09-03 19:10:44
 * @todo 待优化问题
 * 1、apiUrl是否应该在基类中，子类中的api如何传递给基类；
 */
import * as tslib_1 from "tslib";
import { DataTypeInfo } from '../entity/index';
import { createEntity, createEntities } from '../entity/index';
import { EntityCollection } from './entity_collection';
import { PaginationManager } from './pagination_manager';
import { DataChangeHistory } from './data_change_history';
var Repository = /** @class */ (function () {
    /**
     * 构造函数
     */
    function Repository() {
        /**
         * 用户分页配置信息
         */
        this.paginationInfo = null;
    }
    Repository.prototype.init = function () {
        this.entityTypeInfo = new DataTypeInfo(this.entityType);
        this.entityCollection = new EntityCollection(this.entityType);
        this.entityCollection.entityTypeInfo = this.entityTypeInfo;
        this.dataChangeHistory = new DataChangeHistory();
    };
    Object.defineProperty(Repository.prototype, "changes", {
        get: function () {
            return this.entityCollection.changes;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Repository.prototype, "primaryKey", {
        /**
         * 实体主键
         */
        get: function () {
            return this.entityCollection.primaryKey;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Repository.prototype, "entityCollectionChange", {
        /**
         * 实体变更集合
         */
        get: function () {
            return this.entityCollection.collectionChanged;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * 重置状态
     */
    Repository.prototype.reset = function () {
        this.entityCollection.clear();
    };
    /**
     * 创建实体
     */
    Repository.prototype.buildEntity = function (data) {
        var entity = createEntity(this.entityType, data);
        return entity;
    };
    /**
     * 批量创建实体
     */
    Repository.prototype.buildEntities = function (listData) {
        var entities = createEntities(this.entityType, listData);
        return entities;
    };
    /**
     * 初始化分页配置
     * @param config 用户分页配置
     */
    Repository.prototype.setPaginationConfig = function (config) {
        this.paginationManager = new PaginationManager(this.entityType, config);
        var _a = (this.paginationManager.getPaginationConfigByPath('/') || {}).pageSize, pageSize = _a === void 0 ? 0 : _a;
        // tslint:disable-next-line: max-line-length
        this.entityCollection.paginationInfo = Object.assign({ pageSize: pageSize }, this.entityCollection.paginationInfo, this.paginationManager.pagination);
        // 无需再单独设置一次pageSize，减少一次变更
        // this.entityCollection.pageSize = pageSize;
    };
    /**
     * 设置分页
     */
    Repository.prototype.setPaginationInfo = function (paginationInfo) {
        this.paginationInfo = tslib_1.__assign({}, this.paginationInfo, paginationInfo);
    };
    return Repository;
}());
export { Repository };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmVwb3NpdG9yeS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvbW9iaWxlLWRldmtpdC8iLCJzb3VyY2VzIjpbImxpYi9yZXBvc2l0b3J5L3JlcG9zaXRvcnkudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7Ozs7R0FPRzs7QUFLSCxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFJL0MsT0FBTyxFQUFVLFlBQVksRUFBRSxjQUFjLEVBQXFCLE1BQU0saUJBQWlCLENBQUM7QUFFMUYsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDdkQsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFDekQsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sdUJBQXVCLENBQUM7QUFFMUQ7SUF3Q0U7O09BRUc7SUFDSDtRQXJCQTs7V0FFRztRQUNJLG1CQUFjLEdBQVEsSUFBSSxDQUFDO0lBbUJsQyxDQUFDO0lBRVMseUJBQUksR0FBZDtRQUNFLElBQUksQ0FBQyxjQUFjLEdBQUcsSUFBSSxZQUFZLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDO1FBQ3hELElBQUksQ0FBQyxnQkFBZ0IsR0FBRyxJQUFJLGdCQUFnQixDQUFJLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQztRQUNqRSxJQUFJLENBQUMsZ0JBQWdCLENBQUMsY0FBYyxHQUFHLElBQUksQ0FBQyxjQUFjLENBQUM7UUFDM0QsSUFBSSxDQUFDLGlCQUFpQixHQUFHLElBQUksaUJBQWlCLEVBQUUsQ0FBQztJQUNuRCxDQUFDO0lBRUQsc0JBQVcsK0JBQU87YUFBbEI7WUFDRSxPQUFPLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxPQUFPLENBQUM7UUFDdkMsQ0FBQzs7O09BQUE7SUFLRCxzQkFBVyxrQ0FBVTtRQUhyQjs7V0FFRzthQUNIO1lBQ0UsT0FBTyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsVUFBVSxDQUFDO1FBQzFDLENBQUM7OztPQUFBO0lBS0Qsc0JBQVcsOENBQXNCO1FBSGpDOztXQUVHO2FBQ0g7WUFDRSxPQUFPLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxpQkFBaUIsQ0FBQztRQUNqRCxDQUFDOzs7T0FBQTtJQUVEOztPQUVHO0lBQ0ksMEJBQUssR0FBWjtRQUNFLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxLQUFLLEVBQUUsQ0FBQztJQUNoQyxDQUFDO0lBRUQ7O09BRUc7SUFDSSxnQ0FBVyxHQUFsQixVQUFtQixJQUFTO1FBQzFCLElBQU0sTUFBTSxHQUFHLFlBQVksQ0FBSSxJQUFJLENBQUMsVUFBVSxFQUFFLElBQUksQ0FBQyxDQUFDO1FBQ3RELE9BQU8sTUFBTSxDQUFDO0lBQ2hCLENBQUM7SUFFRDs7T0FFRztJQUNJLGtDQUFhLEdBQXBCLFVBQXFCLFFBQWU7UUFDbEMsSUFBTSxRQUFRLEdBQVEsY0FBYyxDQUFJLElBQUksQ0FBQyxVQUFVLEVBQUUsUUFBUSxDQUFDLENBQUM7UUFDbkUsT0FBTyxRQUFRLENBQUM7SUFDbEIsQ0FBQztJQUVEOzs7T0FHRztJQUNILHdDQUFtQixHQUFuQixVQUFvQixNQUFXO1FBQzdCLElBQUksQ0FBQyxpQkFBaUIsR0FBRyxJQUFJLGlCQUFpQixDQUFDLElBQUksQ0FBQyxVQUFVLEVBQUUsTUFBTSxDQUFDLENBQUM7UUFDaEUsSUFBQSwyRUFBWSxFQUFaLGlDQUFZLENBQWlFO1FBQ3JGLDRDQUE0QztRQUM1QyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsY0FBYyxHQUFHLE1BQU0sQ0FBQyxNQUFNLENBQUMsRUFBRSxRQUFRLFVBQUEsRUFBRSxFQUFFLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxjQUFjLEVBQUUsSUFBSSxDQUFDLGlCQUFpQixDQUFDLFVBQVUsQ0FBQyxDQUFDO1FBRTVJLDJCQUEyQjtRQUMzQiw2Q0FBNkM7SUFDL0MsQ0FBQztJQUVEOztPQUVHO0lBQ0ksc0NBQWlCLEdBQXhCLFVBQXlCLGNBQW1CO1FBQzFDLElBQUksQ0FBQyxjQUFjLHdCQUFRLElBQUksQ0FBQyxjQUFjLEVBQUssY0FBYyxDQUFFLENBQUM7SUFDdEUsQ0FBQztJQUVILGlCQUFDO0FBQUQsQ0FBQyxBQW5IRCxJQW1IQyIsInNvdXJjZXNDb250ZW50IjpbIi8qXG4gKiBAQXV0aG9yOiBXaXR0XG4gKiBARGF0ZTogMjAxOC0xMC0xMiAxNTozNzoxMVxuICogQExhc3QgTW9kaWZpZWQgYnk6IGFhbGl6endlbGxcbiAqIEBMYXN0IE1vZGlmaWVkIHRpbWU6IDIwMTktMDktMDMgMTk6MTA6NDRcbiAqIEB0b2RvIOW+heS8mOWMlumXrumimFxuICogMeOAgWFwaVVybOaYr+WQpuW6lOivpeWcqOWfuuexu+S4re+8jOWtkOexu+S4reeahGFwaeWmguS9leS8oOmAkue7meWfuuexu++8m1xuICovXG5cbmltcG9ydCB7IFR5cGUgfSBmcm9tICcuLi9jb3JlL2luZGV4JztcbmltcG9ydCB7IE9ic2VydmFibGUsIFN1YmplY3QgfSBmcm9tICdyeGpzJztcblxuaW1wb3J0IHsgRGF0YVR5cGVJbmZvIH0gZnJvbSAnLi4vZW50aXR5L2luZGV4JztcbmltcG9ydCB7IEd1aWQgfSBmcm9tICcuLi91dGlscy9pbmRleCc7XG5pbXBvcnQgeyBNb2RpZmljYXRpb24gfSBmcm9tICcuLi9jaGFuZ2VzZXQvaW5kZXgnO1xuaW1wb3J0IHsgTWV0YWRhdGFVdGlsIH0gZnJvbSAnLi4vY29yZS9pbmRleCc7XG5pbXBvcnQgeyBFbnRpdHksIGNyZWF0ZUVudGl0eSwgY3JlYXRlRW50aXRpZXMsIEZpZWxkTWV0YWRhdGFVdGlsIH0gZnJvbSAnLi4vZW50aXR5L2luZGV4JztcbmltcG9ydCB7IFJlcG9zaXRvcnlNZXRhIH0gZnJvbSAnLi9kZWNvcmF0b3JzJztcbmltcG9ydCB7IEVudGl0eUNvbGxlY3Rpb24gfSBmcm9tICcuL2VudGl0eV9jb2xsZWN0aW9uJztcbmltcG9ydCB7IFBhZ2luYXRpb25NYW5hZ2VyIH0gZnJvbSAnLi9wYWdpbmF0aW9uX21hbmFnZXInO1xuaW1wb3J0IHsgRGF0YUNoYW5nZUhpc3RvcnkgfSBmcm9tICcuL2RhdGFfY2hhbmdlX2hpc3RvcnknO1xuXG5leHBvcnQgYWJzdHJhY3QgY2xhc3MgUmVwb3NpdG9yeTxUIGV4dGVuZHMgRW50aXR5PiB7XG5cbiAgLyoqXG4gICAqIOWQjeensFxuICAgKi9cbiAgYWJzdHJhY3QgbmFtZTogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiDlrp7kvZPnsbvlnotcbiAgICovXG4gIHB1YmxpYyBlbnRpdHlUeXBlOiBUeXBlPFQ+O1xuXG4gIC8qKlxuICAgKiDlrp7kvZPnsbvlnovkv6Hmga9cbiAgICovXG4gIHB1YmxpYyBlbnRpdHlUeXBlSW5mbzogRGF0YVR5cGVJbmZvO1xuXG4gIC8qKlxuICAgKiDlrp7kvZPpm4blkIhcbiAgICovXG4gIHB1YmxpYyBlbnRpdHlDb2xsZWN0aW9uOiBFbnRpdHlDb2xsZWN0aW9uPFQ+O1xuXG4gIC8qKlxuICAgKiDnlKjmiLfliIbpobXphY3nva7kv6Hmga9cbiAgICovXG4gIHB1YmxpYyBwYWdpbmF0aW9uSW5mbzogYW55ID0gbnVsbDtcblxuICAvKipcbiAgICog5pWw5o2u5Y+Y5pu05Y6G5Y+yXG4gICAqIEBzdW1tYXJ5XG4gICAqIOS7hemSiOWvueS4u+ihqOWinuWKoOOAgeS7juihqOWIoOmZpFxuICAgKi9cbiAgcHVibGljIGRhdGFDaGFuZ2VIaXN0b3J5OiBEYXRhQ2hhbmdlSGlzdG9yeTtcblxuXG4gIC8qKlxuICAgKiDliIbpobXnrqHnkIblmahcbiAgICovXG4gIHB1YmxpYyBwYWdpbmF0aW9uTWFuYWdlcjogUGFnaW5hdGlvbk1hbmFnZXI8VD47XG5cbiAgLyoqXG4gICAqIOaehOmAoOWHveaVsFxuICAgKi9cbiAgY29uc3RydWN0b3IoKSB7XG4gIH1cblxuICBwcm90ZWN0ZWQgaW5pdCgpIHtcbiAgICB0aGlzLmVudGl0eVR5cGVJbmZvID0gbmV3IERhdGFUeXBlSW5mbyh0aGlzLmVudGl0eVR5cGUpO1xuICAgIHRoaXMuZW50aXR5Q29sbGVjdGlvbiA9IG5ldyBFbnRpdHlDb2xsZWN0aW9uPFQ+KHRoaXMuZW50aXR5VHlwZSk7XG4gICAgdGhpcy5lbnRpdHlDb2xsZWN0aW9uLmVudGl0eVR5cGVJbmZvID0gdGhpcy5lbnRpdHlUeXBlSW5mbztcbiAgICB0aGlzLmRhdGFDaGFuZ2VIaXN0b3J5ID0gbmV3IERhdGFDaGFuZ2VIaXN0b3J5KCk7XG4gIH1cblxuICBwdWJsaWMgZ2V0IGNoYW5nZXMoKTogU3ViamVjdDxNb2RpZmljYXRpb24+IHtcbiAgICByZXR1cm4gdGhpcy5lbnRpdHlDb2xsZWN0aW9uLmNoYW5nZXM7XG4gIH1cblxuICAvKipcbiAgICog5a6e5L2T5Li76ZSuXG4gICAqL1xuICBwdWJsaWMgZ2V0IHByaW1hcnlLZXkoKTogc3RyaW5nIHtcbiAgICByZXR1cm4gdGhpcy5lbnRpdHlDb2xsZWN0aW9uLnByaW1hcnlLZXk7XG4gIH1cblxuICAvKipcbiAgICog5a6e5L2T5Y+Y5pu06ZuG5ZCIXG4gICAqL1xuICBwdWJsaWMgZ2V0IGVudGl0eUNvbGxlY3Rpb25DaGFuZ2UoKTogU3ViamVjdDxNb2RpZmljYXRpb24+IHtcbiAgICByZXR1cm4gdGhpcy5lbnRpdHlDb2xsZWN0aW9uLmNvbGxlY3Rpb25DaGFuZ2VkO1xuICB9XG5cbiAgLyoqXG4gICAqIOmHjee9rueKtuaAgVxuICAgKi9cbiAgcHVibGljIHJlc2V0KCk6IHZvaWQge1xuICAgIHRoaXMuZW50aXR5Q29sbGVjdGlvbi5jbGVhcigpO1xuICB9XG5cbiAgLyoqXG4gICAqIOWIm+W7uuWunuS9k1xuICAgKi9cbiAgcHVibGljIGJ1aWxkRW50aXR5KGRhdGE6IGFueSk6IFQge1xuICAgIGNvbnN0IGVudGl0eSA9IGNyZWF0ZUVudGl0eTxUPih0aGlzLmVudGl0eVR5cGUsIGRhdGEpO1xuICAgIHJldHVybiBlbnRpdHk7XG4gIH1cblxuICAvKipcbiAgICog5om56YeP5Yib5bu65a6e5L2TXG4gICAqL1xuICBwdWJsaWMgYnVpbGRFbnRpdGllcyhsaXN0RGF0YTogYW55W10pOiBUW10ge1xuICAgIGNvbnN0IGVudGl0aWVzOiBUW10gPSBjcmVhdGVFbnRpdGllczxUPih0aGlzLmVudGl0eVR5cGUsIGxpc3REYXRhKTtcbiAgICByZXR1cm4gZW50aXRpZXM7XG4gIH1cblxuICAvKipcbiAgICog5Yid5aeL5YyW5YiG6aG16YWN572uXG4gICAqIEBwYXJhbSBjb25maWcg55So5oi35YiG6aG16YWN572uXG4gICAqL1xuICBzZXRQYWdpbmF0aW9uQ29uZmlnKGNvbmZpZzogYW55KSB7XG4gICAgdGhpcy5wYWdpbmF0aW9uTWFuYWdlciA9IG5ldyBQYWdpbmF0aW9uTWFuYWdlcih0aGlzLmVudGl0eVR5cGUsIGNvbmZpZyk7XG4gICAgY29uc3QgeyBwYWdlU2l6ZSA9IDAgfSA9IHRoaXMucGFnaW5hdGlvbk1hbmFnZXIuZ2V0UGFnaW5hdGlvbkNvbmZpZ0J5UGF0aCgnLycpIHx8IHt9O1xuICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTogbWF4LWxpbmUtbGVuZ3RoXG4gICAgdGhpcy5lbnRpdHlDb2xsZWN0aW9uLnBhZ2luYXRpb25JbmZvID0gT2JqZWN0LmFzc2lnbih7IHBhZ2VTaXplIH0sIHRoaXMuZW50aXR5Q29sbGVjdGlvbi5wYWdpbmF0aW9uSW5mbywgdGhpcy5wYWdpbmF0aW9uTWFuYWdlci5wYWdpbmF0aW9uKTtcblxuICAgIC8vIOaXoOmcgOWGjeWNleeLrOiuvue9ruS4gOasoXBhZ2VTaXpl77yM5YeP5bCR5LiA5qyh5Y+Y5pu0XG4gICAgLy8gdGhpcy5lbnRpdHlDb2xsZWN0aW9uLnBhZ2VTaXplID0gcGFnZVNpemU7XG4gIH1cblxuICAvKipcbiAgICog6K6+572u5YiG6aG1XG4gICAqL1xuICBwdWJsaWMgc2V0UGFnaW5hdGlvbkluZm8ocGFnaW5hdGlvbkluZm86IGFueSkge1xuICAgIHRoaXMucGFnaW5hdGlvbkluZm8gPSB7IC4uLnRoaXMucGFnaW5hdGlvbkluZm8sIC4uLnBhZ2luYXRpb25JbmZvIH07XG4gIH1cbiAgXG59XG4iXX0=
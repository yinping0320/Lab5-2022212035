import * as tslib_1 from "tslib";
import { DataChangeType } from '../core';
var DataChangeHistory = /** @class */ (function () {
    function DataChangeHistory() {
        this.history = [];
        this.cacheData = [];
    }
    DataChangeHistory.prototype.addChange = function (dataChange) {
        var changeType = DataChangeType[dataChange.changeType];
        this["on" + changeType + "Data"](dataChange);
    };
    DataChangeHistory.prototype.addChanges = function (dataChange) {
        var _this = this;
        dataChange.forEach(function (change) { return _this.addChange(change); });
    };
    DataChangeHistory.prototype.clear = function () {
        this.history.splice(0, this.history.length);
    };
    DataChangeHistory.prototype.clearByIds = function (ids) {
        this.history = this.history.filter(function (item) {
            var e_1, _a;
            if (item.fpath && item.fpath !== '/' && item.fpath.includes('/')) {
                try {
                    for (var ids_1 = tslib_1.__values(ids), ids_1_1 = ids_1.next(); !ids_1_1.done; ids_1_1 = ids_1.next()) {
                        var id = ids_1_1.value;
                        var include = item.fpath.split('/').includes(id);
                        return !include;
                    }
                }
                catch (e_1_1) { e_1 = { error: e_1_1 }; }
                finally {
                    try {
                        if (ids_1_1 && !ids_1_1.done && (_a = ids_1.return)) _a.call(ids_1);
                    }
                    finally { if (e_1) throw e_1.error; }
                }
            }
            else {
                return !ids.includes(item.dataId);
            }
        });
    };
    DataChangeHistory.prototype.isChanged = function () {
        return this.history.length > 0;
    };
    DataChangeHistory.prototype.clearCache = function () {
        this.cacheData.splice(0, this.cacheData.length);
    };
    DataChangeHistory.prototype.getCacheData = function () {
        return this.cacheData;
    };
    DataChangeHistory.prototype.onAddData = function (dataChange) {
        this.history.push(dataChange);
    };
    DataChangeHistory.prototype.onEditData = function (dataChange) {
        this.cacheData.push(dataChange);
    };
    DataChangeHistory.prototype.onAppendData = function (dataChange) {
        this.history.push(dataChange);
        this.cacheData.push(dataChange);
    };
    DataChangeHistory.prototype.onDeleteData = function (dataChange) {
        var index = this.history.findIndex(function (item) { return item.dataId === dataChange.dataId && item.changeType === DataChangeType.Add; });
        if (index >= 0) {
            this.history.splice(index, 1);
        }
        else {
            this.history.push(dataChange);
        }
    };
    return DataChangeHistory;
}());
export { DataChangeHistory };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0YV9jaGFuZ2VfaGlzdG9yeS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvbW9iaWxlLWRldmtpdC8iLCJzb3VyY2VzIjpbImxpYi9yZXBvc2l0b3J5L2RhdGFfY2hhbmdlX2hpc3RvcnkudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBYyxjQUFjLEVBQUUsTUFBTSxTQUFTLENBQUM7QUFFckQ7SUFJSTtRQUNJLElBQUksQ0FBQyxPQUFPLEdBQUcsRUFBRSxDQUFDO1FBQ2xCLElBQUksQ0FBQyxTQUFTLEdBQUcsRUFBRSxDQUFDO0lBQ3hCLENBQUM7SUFDTSxxQ0FBUyxHQUFoQixVQUFpQixVQUFzQjtRQUNuQyxJQUFNLFVBQVUsR0FBRyxjQUFjLENBQUMsVUFBVSxDQUFDLFVBQVUsQ0FBQyxDQUFDO1FBQ3pELElBQUksQ0FBQyxPQUFLLFVBQVUsU0FBTSxDQUFDLENBQUMsVUFBVSxDQUFDLENBQUM7SUFDNUMsQ0FBQztJQUNNLHNDQUFVLEdBQWpCLFVBQWtCLFVBQXdCO1FBQTFDLGlCQUVDO1FBREcsVUFBVSxDQUFDLE9BQU8sQ0FBQyxVQUFBLE1BQU0sSUFBSSxPQUFBLEtBQUksQ0FBQyxTQUFTLENBQUMsTUFBTSxDQUFDLEVBQXRCLENBQXNCLENBQUMsQ0FBQztJQUN6RCxDQUFDO0lBQ00saUNBQUssR0FBWjtRQUNJLElBQUksQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUMsRUFBRSxJQUFJLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBQ2hELENBQUM7SUFDTSxzQ0FBVSxHQUFqQixVQUFrQixHQUFhO1FBQzNCLElBQUksQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsVUFBQSxJQUFJOztZQUNuQyxJQUFJLElBQUksQ0FBQyxLQUFLLElBQUksSUFBSSxDQUFDLEtBQUssS0FBSyxHQUFHLElBQUksSUFBSSxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLEVBQUU7O29CQUM5RCxLQUFpQixJQUFBLFFBQUEsaUJBQUEsR0FBRyxDQUFBLHdCQUFBLHlDQUFFO3dCQUFqQixJQUFNLEVBQUUsZ0JBQUE7d0JBQ1QsSUFBTSxPQUFPLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQyxDQUFDO3dCQUNuRCxPQUFPLENBQUMsT0FBTyxDQUFDO3FCQUNuQjs7Ozs7Ozs7O2FBQ0o7aUJBQU07Z0JBQ0gsT0FBTyxDQUFDLEdBQUcsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO2FBQ3JDO1FBQ0wsQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDO0lBQ00scUNBQVMsR0FBaEI7UUFDSSxPQUFPLElBQUksQ0FBQyxPQUFPLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQztJQUNuQyxDQUFDO0lBQ00sc0NBQVUsR0FBakI7UUFDSSxJQUFJLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxDQUFDLEVBQUUsSUFBSSxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUNwRCxDQUFDO0lBQ00sd0NBQVksR0FBbkI7UUFDSSxPQUFPLElBQUksQ0FBQyxTQUFTLENBQUM7SUFDMUIsQ0FBQztJQUNPLHFDQUFTLEdBQWpCLFVBQWtCLFVBQXNCO1FBQ3BDLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDO0lBQ2xDLENBQUM7SUFDTyxzQ0FBVSxHQUFsQixVQUFtQixVQUFzQjtRQUNyQyxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQztJQUNwQyxDQUFDO0lBQ08sd0NBQVksR0FBcEIsVUFBcUIsVUFBc0I7UUFDdkMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUM7UUFDOUIsSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUM7SUFDcEMsQ0FBQztJQUNPLHdDQUFZLEdBQXBCLFVBQXFCLFVBQXNCO1FBQ3ZDLElBQU0sS0FBSyxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDLFVBQUEsSUFBSSxJQUFJLE9BQUEsSUFBSSxDQUFDLE1BQU0sS0FBSyxVQUFVLENBQUMsTUFBTSxJQUFJLElBQUksQ0FBQyxVQUFVLEtBQUssY0FBYyxDQUFDLEdBQUcsRUFBM0UsQ0FBMkUsQ0FBQyxDQUFDO1FBQzFILElBQUksS0FBSyxJQUFJLENBQUMsRUFBRTtZQUNaLElBQUksQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLEtBQUssRUFBRSxDQUFDLENBQUMsQ0FBQztTQUNqQzthQUFNO1lBQ0gsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUM7U0FDakM7SUFDTCxDQUFDO0lBQ0wsd0JBQUM7QUFBRCxDQUFDLEFBekRELElBeURDO0FBQ0QsT0FBTyxFQUFFLGlCQUFpQixFQUFFLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBEYXRhQ2hhbmdlLCBEYXRhQ2hhbmdlVHlwZSB9IGZyb20gJy4uL2NvcmUnO1xuXG5jbGFzcyBEYXRhQ2hhbmdlSGlzdG9yeSB7XG4gICAgcHJpdmF0ZSBoaXN0b3J5OiBBcnJheTxEYXRhQ2hhbmdlPjtcbiAgICBwcml2YXRlIGNhY2hlRGF0YTogQXJyYXk8RGF0YUNoYW5nZT47XG5cbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgdGhpcy5oaXN0b3J5ID0gW107XG4gICAgICAgIHRoaXMuY2FjaGVEYXRhID0gW107XG4gICAgfVxuICAgIHB1YmxpYyBhZGRDaGFuZ2UoZGF0YUNoYW5nZTogRGF0YUNoYW5nZSkge1xuICAgICAgICBjb25zdCBjaGFuZ2VUeXBlID0gRGF0YUNoYW5nZVR5cGVbZGF0YUNoYW5nZS5jaGFuZ2VUeXBlXTtcbiAgICAgICAgdGhpc1tgb24ke2NoYW5nZVR5cGV9RGF0YWBdKGRhdGFDaGFuZ2UpO1xuICAgIH1cbiAgICBwdWJsaWMgYWRkQ2hhbmdlcyhkYXRhQ2hhbmdlOiBEYXRhQ2hhbmdlW10pIHtcbiAgICAgICAgZGF0YUNoYW5nZS5mb3JFYWNoKGNoYW5nZSA9PiB0aGlzLmFkZENoYW5nZShjaGFuZ2UpKTtcbiAgICB9XG4gICAgcHVibGljIGNsZWFyKCkge1xuICAgICAgICB0aGlzLmhpc3Rvcnkuc3BsaWNlKDAsIHRoaXMuaGlzdG9yeS5sZW5ndGgpO1xuICAgIH1cbiAgICBwdWJsaWMgY2xlYXJCeUlkcyhpZHM6IHN0cmluZ1tdKSB7XG4gICAgICAgIHRoaXMuaGlzdG9yeSA9IHRoaXMuaGlzdG9yeS5maWx0ZXIoaXRlbSA9PiB7XG4gICAgICAgICAgICBpZiAoaXRlbS5mcGF0aCAmJiBpdGVtLmZwYXRoICE9PSAnLycgJiYgaXRlbS5mcGF0aC5pbmNsdWRlcygnLycpKSB7XG4gICAgICAgICAgICAgICAgZm9yIChjb25zdCBpZCBvZiBpZHMpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgaW5jbHVkZSA9IGl0ZW0uZnBhdGguc3BsaXQoJy8nKS5pbmNsdWRlcyhpZCk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAhaW5jbHVkZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiAhaWRzLmluY2x1ZGVzKGl0ZW0uZGF0YUlkKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuICAgIHB1YmxpYyBpc0NoYW5nZWQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmhpc3RvcnkubGVuZ3RoID4gMDtcbiAgICB9XG4gICAgcHVibGljIGNsZWFyQ2FjaGUoKSB7XG4gICAgICAgIHRoaXMuY2FjaGVEYXRhLnNwbGljZSgwLCB0aGlzLmNhY2hlRGF0YS5sZW5ndGgpO1xuICAgIH1cbiAgICBwdWJsaWMgZ2V0Q2FjaGVEYXRhKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5jYWNoZURhdGE7XG4gICAgfVxuICAgIHByaXZhdGUgb25BZGREYXRhKGRhdGFDaGFuZ2U6IERhdGFDaGFuZ2UpIHtcbiAgICAgICAgdGhpcy5oaXN0b3J5LnB1c2goZGF0YUNoYW5nZSk7XG4gICAgfVxuICAgIHByaXZhdGUgb25FZGl0RGF0YShkYXRhQ2hhbmdlOiBEYXRhQ2hhbmdlKSB7XG4gICAgICAgIHRoaXMuY2FjaGVEYXRhLnB1c2goZGF0YUNoYW5nZSk7XG4gICAgfVxuICAgIHByaXZhdGUgb25BcHBlbmREYXRhKGRhdGFDaGFuZ2U6IERhdGFDaGFuZ2UpIHtcbiAgICAgICAgdGhpcy5oaXN0b3J5LnB1c2goZGF0YUNoYW5nZSk7XG4gICAgICAgIHRoaXMuY2FjaGVEYXRhLnB1c2goZGF0YUNoYW5nZSk7XG4gICAgfVxuICAgIHByaXZhdGUgb25EZWxldGVEYXRhKGRhdGFDaGFuZ2U6IERhdGFDaGFuZ2UpIHtcbiAgICAgICAgY29uc3QgaW5kZXggPSB0aGlzLmhpc3RvcnkuZmluZEluZGV4KGl0ZW0gPT4gaXRlbS5kYXRhSWQgPT09IGRhdGFDaGFuZ2UuZGF0YUlkICYmIGl0ZW0uY2hhbmdlVHlwZSA9PT0gRGF0YUNoYW5nZVR5cGUuQWRkKTtcbiAgICAgICAgaWYgKGluZGV4ID49IDApIHtcbiAgICAgICAgICAgIHRoaXMuaGlzdG9yeS5zcGxpY2UoaW5kZXgsIDEpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5oaXN0b3J5LnB1c2goZGF0YUNoYW5nZSk7XG4gICAgICAgIH1cbiAgICB9XG59XG5leHBvcnQgeyBEYXRhQ2hhbmdlSGlzdG9yeSB9O1xuIl19
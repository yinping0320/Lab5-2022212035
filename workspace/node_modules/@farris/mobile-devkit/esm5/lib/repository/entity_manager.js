/*
 * @Author: Witt
 * @Date: 2019-03-07 17:24:38
 * @Last Modified by:   Witt
 * @Last Modified time: 2019-03-11 19:50:38
 */
import { createEntity, createEntities } from '../entity/index';
import { EntityCollection } from './entity_collection';
import { DataPathCreator, DataPathNodeType } from '../entity/index';
import { EntityUtil } from '../binding-data/entity_util';
/**
 * 实体管理类
 */
var EntityManager = /** @class */ (function () {
    /**
     * 构造函数
     */
    function EntityManager(entityCollection) {
        this.entityCollection = entityCollection;
        this.entityType = entityCollection.entityType;
    }
    // #region 创建实体相关方法
    /**
     * 创建实体
     */
    EntityManager.prototype.createEntity = function (entityData) {
        var entity = createEntity(this.entityType, entityData);
        return entity;
    };
    /**
     * 批量创建实体
     */
    EntityManager.prototype.createEntities = function (entityListData, entityType) {
        var entities = createEntities(this.entityType, entityListData);
        return entities;
    };
    /**
     * 批量创建下级实体
     * @param fPath fpath
     * @param entityListData 实体数据
     */
    EntityManager.prototype.createEntitiesByPath = function (fPath, entityListData) {
        var subPaths = fPath.split('/');
        if (subPaths.length < 3) {
            throw Error("\u6839\u636Epath\u5220\u9664\u5B9E\u4F53\u6570\u636E\u51FA\u9519\u4E86\u3002\u4F20\u5165\u7684path[" + fPath + "]\u683C\u5F0F\u4E0D\u5BF9");
        }
        if (entityListData.length < 1) {
            return [];
        }
        var childEntityList;
        var propInfo;
        var propName;
        for (var i = 2; i < subPaths.length; i = i + 2) {
            var fid = subPaths[i - 1];
            propName = subPaths[i];
            var parentEntity = childEntityList ? childEntityList.get(fid) : this.entityCollection.getEntityById(fid);
            childEntityList = parentEntity[propName];
            var entityType = propInfo ? propInfo.propEntityType : this.entityType;
            propInfo = EntityUtil.getPropInfo(entityType, propName);
            if (!childEntityList) {
                throw Error("fpath\u53C2\u6570\u9519\u8BEF\uFF0C\u65E0\u6CD5\u627E\u5230" + propName + "\u5BF9\u5E94\u7684\u5B50\u8868\u3002fpath\u4E3A\uFF1A" + fPath);
            }
        }
        var entities = entityListData.map(function (entityData) {
            return createEntity(propInfo.propEntityType, entityData);
        });
        return entities;
    };
    // #endregion
    // #region 获取实体、实体数组相关方法
    /**
     * 获取path对应的实体
     */
    EntityManager.prototype.getEntityByPath = function (path) {
        var entity = this.getEntityNodeByPath(path);
        return entity;
    };
    /**
     * 获取path对应的实体
     */
    EntityManager.prototype.getEntitiesByPath = function (path) {
        var entityCollectionOrList = this.getEntityNodeByPath(path);
        var entities;
        if (entityCollectionOrList instanceof EntityCollection === true) {
            entities = entityCollectionOrList.toArray();
        }
        else {
            entities = entityCollectionOrList.toArray();
        }
        return entities;
    };
    /**
     * 获取实体节点
     * @param path 节点路径
     */
    EntityManager.prototype.getEntityNodeByPath = function (path) {
        var dataPath = DataPathCreator.createByLongPathFromRoot(path, this);
        var entityNode = this.entityCollection;
        var pathNode = dataPath.head.next;
        while (pathNode) {
            if (pathNode.type === DataPathNodeType.DataId) {
                if (entityNode instanceof EntityCollection === true) {
                    entityNode = entityNode.getEntityById(pathNode.value);
                }
                else {
                    entityNode = entityNode.get(pathNode.value);
                }
            }
            else {
                entityNode = entityNode[pathNode.value];
            }
            if (!entityNode) {
                throw new Error("\u627E\u4E0D\u5230" + pathNode.value + "\u5BF9\u5E94\u7684\u6570\u636E\u8282\u70B9");
            }
            pathNode = pathNode.next;
        }
        return entityNode;
    };
    // #endregion
    // #region 获取、设置属性值
    /**
     * 获取path对应的实体属性值
     */
    EntityManager.prototype.getPropValueByPath = function (path) {
        var propName = path.pop();
        var entity = this.getEntityByPath(path);
        return entity[propName];
    };
    /**
     * 设置path对应实体的属性值
     */
    EntityManager.prototype.setPropValueByPath = function (path, propValue) {
        var propName = path.pop();
        var entity = this.getEntityByPath(path);
        entity[propName] = propValue;
    };
    // #endregion
    // #region 插入实体
    /**
     * 在path对应实体前插入实体
     */
    EntityManager.prototype.insertEntityBeforeByPath = function (fpath) {
        throw new Error('Not Implemented');
    };
    /**
     * 在path对应实体前批量插入实体
     */
    EntityManager.prototype.insertEntitiesBeforeByPath = function () {
        throw new Error('Not Implemented');
    };
    /**
     * 在path对应实体前插入实体
     */
    EntityManager.prototype.insertEntityAfterByPath = function () {
        throw new Error('Not Implemented');
    };
    /**
     * 在path对应实体前批量插入实体
     */
    EntityManager.prototype.insertEntitiesAfterByPath = function () {
        throw new Error('Not Implemented');
    };
    // #endregion
    // #region 追加实体
    /**
     * 在path对应的实体集合中追加1个实体
     */
    // public appendEntityByPath(fpath: string[], entity: Entity): void {
    //   const entityCollectionOrList = this.getEntityNodeByPath(fpath);
    //   if (entityCollectionOrList instanceof EntityCollection === true) {
    //     const entityCollection = entityCollectionOrList as EntityCollection<Entity>;
    //     entityCollection.addEntity(entity);
    //   } else {
    //     const entityList = (entityCollectionOrList as EntityList<Entity>);
    //     entityList.appendEntity(entity);
    //   }
    // }
    /**
     * 根据path获取实体集合
     * @param fpath 路径
     * @param entityData 实体数据
     * @param initialData[可选] 默认值
     */
    EntityManager.prototype.appendEntityByPath = function (fpath, entityData, initialData, isCloned) {
        if (isCloned === void 0) { isCloned = false; }
        var subPaths = fpath.split('/');
        if (subPaths.length < 3) {
            throw Error("\u6839\u636Epath\u5220\u9664\u5B9E\u4F53\u6570\u636E\u51FA\u9519\u4E86\u3002\u4F20\u5165\u7684path[" + fpath + "]\u683C\u5F0F\u4E0D\u5BF9");
        }
        var childEntityList;
        var propInfo;
        var propName;
        for (var i = 2; i < subPaths.length; i = i + 2) {
            var fid = subPaths[i - 1];
            propName = subPaths[i];
            // todo: EntityCollection重构之后这里无需差异处理
            var parentEntity = childEntityList ? childEntityList.get(fid) : this.entityCollection.getEntityById(fid);
            childEntityList = parentEntity[propName];
            var entityType = propInfo ? propInfo.propEntityType : this.entityType;
            propInfo = EntityUtil.getPropInfo(entityType, propName);
            if (!childEntityList) {
                throw Error("fpath\u53C2\u6570\u9519\u8BEF\uFF0C\u65E0\u6CD5\u627E\u5230" + propName + "\u5BF9\u5E94\u7684\u5B50\u8868\u3002fpath\u4E3A\uFF1A" + fpath);
            }
        }
        // const propInfo = EntityUtil.getPropInfo(this.entityType, propName);
        var childEntity = createEntity(propInfo.propEntityType, entityData);
        // 在实体的实例上增加默认值属性，以便在createBindingObject时存放默认值
        if (initialData) {
            EntityUtil.appendInitialData(childEntity, initialData);
        }
        childEntityList.appendNew(childEntity, isCloned);
        return childEntity;
    };
    /**
     * 在指定位置插入实体
     * @param fpath 父路径
     * @param entityData 实体数据
     * @param initialData 初始数据
     * @param position 插入位置
     */
    EntityManager.prototype.insertEntityByPath = function (fpath, entityData, initialData, position) {
        var subPaths = fpath.split('/');
        if (subPaths.length < 3) {
            throw Error("\u6839\u636Epath\u5220\u9664\u5B9E\u4F53\u6570\u636E\u51FA\u9519\u4E86\u3002\u4F20\u5165\u7684path[" + fpath + "]\u683C\u5F0F\u4E0D\u5BF9");
        }
        var childEntityList;
        var propInfo;
        var propName;
        for (var i = 2; i < subPaths.length; i = i + 2) {
            var fid = subPaths[i - 1];
            propName = subPaths[i];
            // todo: EntityCollection重构之后这里无需差异处理
            var parentEntity = childEntityList ? childEntityList.get(fid) : this.entityCollection.getEntityById(fid);
            childEntityList = parentEntity[propName];
            var entityType = propInfo ? propInfo.propEntityType : this.entityType;
            propInfo = EntityUtil.getPropInfo(entityType, propName);
            if (!childEntityList) {
                throw Error("fpath\u53C2\u6570\u9519\u8BEF\uFF0C\u65E0\u6CD5\u627E\u5230" + propName + "\u5BF9\u5E94\u7684\u5B50\u8868\u3002fpath\u4E3A\uFF1A" + fpath);
            }
        }
        // const propInfo = EntityUtil.getPropInfo(this.entityType, propName);
        var childEntity = createEntity(propInfo.propEntityType, entityData);
        // 在实体的实例上增加默认值属性，以便在createBindingObject时存放默认值
        if (initialData) {
            EntityUtil.appendInitialData(childEntity, initialData);
        }
        childEntityList.insert(childEntity, position);
        return childEntity;
    };
    /**
     * 在path对应的实体集合中追加多个实体
     */
    EntityManager.prototype.appendEntitiesByPath = function (fpath, entities) {
        var entityCollectionOrList = this.getEntityNodeByPath(fpath);
        if (entityCollectionOrList instanceof EntityCollection === true) {
            var entityCollection = entityCollectionOrList;
            entityCollection.addEntities(entities);
        }
        else {
            var entityList = entityCollectionOrList;
            entityList.appendEntities(entities);
        }
    };
    // #endregion
    // #region 删除实体
    /**
     * 从fapth对应的实体集合中删除id对应的实体
     */
    // public removeEntityByPath(fpath: string[], id: string): void {
    //   const entityCollectionOrList = this.getEntityNodeByPath(fpath);
    //   if (entityCollectionOrList instanceof EntityCollection === true) {
    //     const entityCollection = entityCollectionOrList as EntityCollection<Entity>;
    //     entityCollection.removeEntityById(id);
    //   } else {
    //     const entityList = (entityCollectionOrList as EntityList<Entity>);
    //     entityList.remove(id);
    //   }
    // }
    /**
     * 根据path获取实体集合
     * @param fpath path
     */
    EntityManager.prototype.removeEntityByPath = function (fpath, id) {
        var subPaths = fpath.split('/');
        if (subPaths.length < 3) {
            throw Error("\u6839\u636Epath\u5220\u9664\u5B9E\u4F53\u6570\u636E\u51FA\u9519\u4E86\u3002\u4F20\u5165\u7684path[" + fpath + "]\u683C\u5F0F\u4E0D\u5BF9");
        }
        var childEntityList;
        for (var i = 2; i < subPaths.length; i = i + 2) {
            var fid = subPaths[i - 1];
            var propName = subPaths[i];
            var parentEntity = childEntityList ? childEntityList.get(fid) : this.entityCollection.getEntityById(fid);
            childEntityList = parentEntity[propName];
            if (!childEntityList) {
                throw Error("fpath\u53C2\u6570\u9519\u8BEF\uFF0C\u65E0\u6CD5\u627E\u5230" + propName + "\u5BF9\u5E94\u7684\u5B50\u8868\u3002fpath\u4E3A\uFF1A" + fpath);
            }
        }
        childEntityList.remove(id);
    };
    /**
     * 从fapth对应的实体集合中删除ids对应的实体
     */
    EntityManager.prototype.removeEntitiesByPath = function (fpath, ids) {
        // const entityCollectionOrList = this.getEntityNodeByPath(fpath);
        // if (entityCollectionOrList instanceof EntityCollection === true) {
        //   const entityCollection = entityCollectionOrList as EntityCollection<Entity>;
        //   entityCollection.removeEntitiesByIds(ids);
        // } else {
        //   const entityList = (entityCollectionOrList as EntityList<Entity>);
        //   entityList.remove(ids);
        // }
        throw new Error('Not Implemented');
    };
    // #endregion
    // #region 清空变更集相关方法
    /**
     * 清空所有实体的变更集
     */
    EntityManager.prototype.clearAllEntityChanges = function () {
        var entities = this.entityCollection.toArray();
        entities.forEach(function (entity) {
            entity.changes.splice(0, entity.changes.length);
        });
    };
    EntityManager.prototype.resetAllEntityChangeMark = function () {
        var entities = this.entityCollection.toArray();
        entities.forEach(function (entity) {
            entity.hasChange = false;
        });
    };
    /**
     * 清空id指定的实体变更集
     */
    EntityManager.prototype.clearEntityChangesById = function (id) {
        var entity = this.entityCollection.getEntityById(id);
        if (!entity) {
            return;
        }
        entity.changes.splice(0, entity.changes.length);
    };
    /**
     * 清空ids数组中指定的实体的变更集
     */
    EntityManager.prototype.clearEntityChangesByIds = function (ids) {
        var _this = this;
        if (!ids || ids.length < 0) {
            return;
        }
        ids.forEach(function (id) {
            _this.clearEntityChangesById(id);
        });
    };
    // #endregion
    // #region 变更集检查相关方法
    /**
     * 检查所有的实体，是否有未提交的变更
     */
    EntityManager.prototype.checkAllEntityChanges = function () {
        var entities = this.entityCollection.toArray();
        var hasChanges = entities.some(function (entity) {
            if (entity.changes.length > 0) {
                return true;
            }
            else {
                return false;
            }
        });
        return hasChanges;
    };
    /**
     * 检查id对应的实体，是否有未提交的变更
     */
    EntityManager.prototype.checkEntityChangesById = function (id) {
        var entity = this.entityCollection.getEntityById(id);
        if (!entity) {
            return false;
        }
        return entity.changes.length > 0;
    };
    // #endregion
    // #region 不规范方法，待废弃
    /**
     * 待废弃
     * @deprecated
     */
    EntityManager.prototype.clearEntityChangesByArray = function (idArray) {
        this.clearEntityChangesByIds(idArray);
    };
    return EntityManager;
}());
export { EntityManager };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZW50aXR5X21hbmFnZXIuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL21vYmlsZS1kZXZraXQvIiwic291cmNlcyI6WyJsaWIvcmVwb3NpdG9yeS9lbnRpdHlfbWFuYWdlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7R0FLRztBQUdILE9BQU8sRUFBc0IsWUFBWSxFQUFFLGNBQWMsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQ25GLE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQ3ZELE9BQU8sRUFBWSxlQUFlLEVBQUUsZ0JBQWdCLEVBQWdCLE1BQU0saUJBQWlCLENBQUM7QUFDNUYsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLDZCQUE2QixDQUFDO0FBR3pEOztHQUVHO0FBQ0g7SUFZRTs7T0FFRztJQUNILHVCQUFZLGdCQUFxQztRQUMvQyxJQUFJLENBQUMsZ0JBQWdCLEdBQUcsZ0JBQWdCLENBQUM7UUFDekMsSUFBSSxDQUFDLFVBQVUsR0FBRyxnQkFBZ0IsQ0FBQyxVQUFVLENBQUM7SUFDaEQsQ0FBQztJQUdELG1CQUFtQjtJQUVuQjs7T0FFRztJQUNJLG9DQUFZLEdBQW5CLFVBQW9CLFVBQWU7UUFDakMsSUFBTSxNQUFNLEdBQUcsWUFBWSxDQUFJLElBQUksQ0FBQyxVQUFVLEVBQUUsVUFBVSxDQUFDLENBQUM7UUFDNUQsT0FBTyxNQUFNLENBQUM7SUFDaEIsQ0FBQztJQUVEOztPQUVHO0lBQ0ksc0NBQWMsR0FBckIsVUFBc0IsY0FBcUIsRUFBRSxVQUFlO1FBQzFELElBQU0sUUFBUSxHQUFRLGNBQWMsQ0FBSSxJQUFJLENBQUMsVUFBVSxFQUFFLGNBQWMsQ0FBQyxDQUFDO1FBQ3pFLE9BQU8sUUFBUSxDQUFDO0lBQ2xCLENBQUM7SUFDRDs7OztPQUlHO0lBQ0ksNENBQW9CLEdBQTNCLFVBQTRCLEtBQWEsRUFBRSxjQUFxQjtRQUM5RCxJQUFNLFFBQVEsR0FBRyxLQUFLLENBQUMsS0FBSyxDQUFD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O0lBQ3BCLENBQUM7SUFFRDs7T0FFRztJQUNJLDhDQUFzQixHQUE3QixVQUE4QixFQUFVO1FBQ3RDLElBQU0sTUFBTSxHQUFHLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxhQUFhLENBQUMsRUFBRSxDQUFDLENBQUM7UUFDdkQsSUFBSSxDQUFDLE1BQU0sRUFBRTtZQUNYLE9BQU8sS0FBSyxDQUFDO1NBQ2Q7UUFDRCxPQUFPLE1BQU0sQ0FBQyxPQUFPLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQztJQUNuQyxDQUFDO0lBRUQsYUFBYTtJQUdiLG9CQUFvQjtJQUVwQjs7O09BR0c7SUFDSSxpREFBeUIsR0FBaEMsVUFBaUMsT0FBaUI7UUFDaEQsSUFBSSxDQUFDLHVCQUF1QixDQUFDLE9BQU8sQ0FBQyxDQUFDO0lBQ3hDLENBQUM7SUFJSCxvQkFBQztBQUFELENBQUMsQUFyYkQsSUFxYkM7QUFFRCxPQUFPLEVBQUUsYUFBYSxFQUFFLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuICogQEF1dGhvcjogV2l0dFxuICogQERhdGU6IDIwMTktMDMtMDcgMTc6MjQ6MzhcbiAqIEBMYXN0IE1vZGlmaWVkIGJ5OiAgIFdpdHRcbiAqIEBMYXN0IE1vZGlmaWVkIHRpbWU6IDIwMTktMDMtMTEgMTk6NTA6MzhcbiAqL1xuXG5pbXBvcnQgeyBUeXBlIH0gZnJvbSAnLi4vY29yZS9pbmRleCc7XG5pbXBvcnQgeyBFbnRpdHksIEVudGl0eUxpc3QsIGNyZWF0ZUVudGl0eSwgY3JlYXRlRW50aXRpZXMgfSBmcm9tICcuLi9lbnRpdHkvaW5kZXgnO1xuaW1wb3J0IHsgRW50aXR5Q29sbGVjdGlvbiB9IGZyb20gJy4vZW50aXR5X2NvbGxlY3Rpb24nO1xuaW1wb3J0IHsgRGF0YVBhdGgsIERhdGFQYXRoQ3JlYXRvciwgRGF0YVBhdGhOb2RlVHlwZSwgRGF0YVR5cGVJbmZvIH0gZnJvbSAnLi4vZW50aXR5L2luZGV4JztcbmltcG9ydCB7IEVudGl0eVV0aWwgfSBmcm9tICcuLi9iaW5kaW5nLWRhdGEvZW50aXR5X3V0aWwnO1xuXG5cbi8qKlxuICog5a6e5L2T566h55CG57G7XG4gKi9cbmNsYXNzIEVudGl0eU1hbmFnZXI8VCBleHRlbmRzIEVudGl0eT4ge1xuXG4gIC8qKlxuICAgKiDlrp7kvZPnsbvlnotcbiAgICovXG4gIHB1YmxpYyBlbnRpdHlUeXBlOiBUeXBlPEVudGl0eT47XG5cbiAgLyoqXG4gICAqIOWunuS9k+mbhuWQiFxuICAgKi9cbiAgcHVibGljIGVudGl0eUNvbGxlY3Rpb246IEVudGl0eUNvbGxlY3Rpb248RW50aXR5PjtcblxuICAvKipcbiAgICog5p6E6YCg5Ye95pWwXG4gICAqL1xuICBjb25zdHJ1Y3RvcihlbnRpdHlDb2xsZWN0aW9uOiBFbnRpdHlDb2xsZWN0aW9uPFQ+KSB7XG4gICAgdGhpcy5lbnRpdHlDb2xsZWN0aW9uID0gZW50aXR5Q29sbGVjdGlvbjtcbiAgICB0aGlzLmVudGl0eVR5cGUgPSBlbnRpdHlDb2xsZWN0aW9uLmVudGl0eVR5cGU7XG4gIH1cblxuXG4gIC8vICNyZWdpb24g5Yib5bu65a6e5L2T55u45YWz5pa55rOVXG5cbiAgLyoqXG4gICAqIOWIm+W7uuWunuS9k1xuICAgKi9cbiAgcHVibGljIGNyZWF0ZUVudGl0eShlbnRpdHlEYXRhOiBhbnkpOiBUIHtcbiAgICBjb25zdCBlbnRpdHkgPSBjcmVhdGVFbnRpdHk8VD4odGhpcy5lbnRpdHlUeXBlLCBlbnRpdHlEYXRhKTtcbiAgICByZXR1cm4gZW50aXR5O1xuICB9XG5cbiAgLyoqXG4gICAqIOaJuemHj+WIm+W7uuWunuS9k1xuICAgKi9cbiAgcHVibGljIGNyZWF0ZUVudGl0aWVzKGVudGl0eUxpc3REYXRhOiBhbnlbXSwgZW50aXR5VHlwZTogYW55KTogVFtdIHtcbiAgICBjb25zdCBlbnRpdGllczogVFtdID0gY3JlYXRlRW50aXRpZXM8VD4odGhpcy5lbnRpdHlUeXBlLCBlbnRpdHlMaXN0RGF0YSk7XG4gICAgcmV0dXJuIGVudGl0aWVzO1xuICB9XG4gIC8qKlxuICAgKiDmibnph4/liJvlu7rkuIvnuqflrp7kvZNcbiAgICogQHBhcmFtIGZQYXRoIGZwYXRoXG4gICAqIEBwYXJhbSBlbnRpdHlMaXN0RGF0YSDlrp7kvZPmlbDmja5cbiAgICovXG4gIHB1YmxpYyBjcmVhdGVFbnRpdGllc0J5UGF0aChmUGF0aDogc3RyaW5nLCBlbnRpdHlMaXN0RGF0YTogYW55W10pIHtcbiAgICBjb25zdCBzdWJQYXRocyA9IGZQYXRoLnNwbGl0KCcvJyk7XG4gICAgaWYgKHN1YlBhdGhzLmxlbmd0aCA8IDMpIHtcbiAgICAgIHRocm93IEVycm9yKGDmoLnmja5wYXRo5Yig6Zmk5a6e5L2T5pWw5o2u5Ye66ZSZ5LqG44CC5Lyg5YWl55qEcGF0aFske2ZQYXRofV3moLzlvI/kuI3lr7lgKTtcbiAgICB9XG4gICAgaWYgKGVudGl0eUxpc3REYXRhLmxlbmd0aCA8IDEpIHtcbiAgICAgIHJldHVybiBbXTtcbiAgICB9XG4gICAgbGV0IGNoaWxkRW50aXR5TGlzdDogRW50aXR5TGlzdDxhbnk+O1xuICAgIGxldCBwcm9wSW5mbzogeyBwcm9wVHlwZTogc3RyaW5nLCBwcm9wRW50aXR5VHlwZTogYW55IH07XG4gICAgbGV0IHByb3BOYW1lOiBzdHJpbmc7XG4gICAgZm9yIChsZXQgaSA9IDI7IGkgPCBzdWJQYXRocy5sZW5ndGg7IGkgPSBpICsgMikge1xuICAgICAgY29uc3QgZmlkID0gc3ViUGF0aHNbaSAtIDFdO1xuICAgICAgcHJvcE5hbWUgPSBzdWJQYXRoc1tpXTtcbiAgICAgIGNvbnN0IHBhcmVudEVudGl0eSA9IGNoaWxkRW50aXR5TGlzdCA/IGNoaWxkRW50aXR5TGlzdC5nZXQoZmlkKSA6IHRoaXMuZW50aXR5Q29sbGVjdGlvbi5nZXRFbnRpdHlCeUlkKGZpZCk7XG4gICAgICBjaGlsZEVudGl0eUxpc3QgPSBwYXJlbnRFbnRpdHlbcHJvcE5hbWVdO1xuICAgICAgY29uc3QgZW50aXR5VHlwZSA9IHByb3BJbmZvID8gcHJvcEluZm8ucHJvcEVudGl0eVR5cGUgOiB0aGlzLmVudGl0eVR5cGU7XG4gICAgICBwcm9wSW5mbyA9IEVudGl0eVV0aWwuZ2V0UHJvcEluZm8oZW50aXR5VHlwZSwgcHJvcE5hbWUpO1xuICAgICAgaWYgKCFjaGlsZEVudGl0eUxpc3QpIHtcbiAgICAgICAgdGhyb3cgRXJyb3IoYGZwYXRo5Y+C5pWw6ZSZ6K+v77yM5peg5rOV5om+5YiwJHtwcm9wTmFtZX3lr7nlupTnmoTlrZDooajjgIJmcGF0aOS4uu+8miR7ZlBhdGh9YCk7XG4gICAgICB9XG4gICAgfVxuICAgIGNvbnN0IGVudGl0aWVzID0gZW50aXR5TGlzdERhdGEubWFwKGVudGl0eURhdGEgPT4ge1xuICAgICAgcmV0dXJuIGNyZWF0ZUVudGl0eTxFbnRpdHk+KHByb3BJbmZvLnByb3BFbnRpdHlUeXBlLCBlbnRpdHlEYXRhKTtcbiAgICB9KTtcbiAgICByZXR1cm4gZW50aXRpZXM7XG4gIH1cbiAgLy8gI2VuZHJlZ2lvblxuXG5cbiAgLy8gI3JlZ2lvbiDojrflj5blrp7kvZPjgIHlrp7kvZPmlbDnu4Tnm7jlhbPmlrnms5VcblxuICAvKipcbiAgICog6I635Y+WcGF0aOWvueW6lOeahOWunuS9k1xuICAgKi9cbiAgcHVibGljIGdldEVudGl0eUJ5UGF0aChwYXRoOiBzdHJpbmdbXSk6IEVudGl0eSB7XG4gICAgY29uc3QgZW50aXR5ID0gdGhpcy5nZXRFbnRpdHlOb2RlQnlQYXRoKHBhdGgpIGFzIEVudGl0eTtcbiAgICByZXR1cm4gZW50aXR5O1xuICB9XG5cbiAgLyoqXG4gICAqIOiOt+WPlnBhdGjlr7nlupTnmoTlrp7kvZNcbiAgICovXG4gIHB1YmxpYyBnZXRFbnRpdGllc0J5UGF0aChwYXRoOiBzdHJpbmdbXSk6IEVudGl0eVtdIHtcbiAgICBjb25zdCBlbnRpdHlDb2xsZWN0aW9uT3JMaXN0ID0gdGhpcy5nZXRFbnRpdHlOb2RlQnlQYXRoKHBhdGgpIGFzIEVudGl0eUNvbGxlY3Rpb248RW50aXR5PiB8IEVudGl0eUxpc3Q8RW50aXR5PjtcbiAgICBsZXQgZW50aXRpZXM6IEVudGl0eVtdO1xuICAgIGlmIChlbnRpdHlDb2xsZWN0aW9uT3JMaXN0IGluc3RhbmNlb2YgRW50aXR5Q29sbGVjdGlvbiA9PT0gdHJ1ZSkge1xuICAgICAgZW50aXRpZXMgPSAoZW50aXR5Q29sbGVjdGlvbk9yTGlzdCBhcyBFbnRpdHlDb2xsZWN0aW9uPEVudGl0eT4pLnRvQXJyYXkoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgZW50aXRpZXMgPSAoZW50aXR5Q29sbGVjdGlvbk9yTGlzdCBhcyBFbnRpdHlMaXN0PEVudGl0eT4pLnRvQXJyYXkoKTtcbiAgICB9XG4gICAgcmV0dXJuIGVudGl0aWVzO1xuICB9XG5cbiAgLyoqXG4gICAqIOiOt+WPluWunuS9k+iKgueCuVxuICAgKiBAcGFyYW0gcGF0aCDoioLngrnot6/lvoRcbiAgICovXG4gIHB1YmxpYyBnZXRFbnRpdHlOb2RlQnlQYXRoKHBhdGg6IHN0cmluZ1tdKTogRW50aXR5Q29sbGVjdGlvbjxFbnRpdHk+IHwgRW50aXR5TGlzdDxFbnRpdHk+IHwgRW50aXR5IHtcbiAgICBjb25zdCBkYXRhUGF0aCA9IERhdGFQYXRoQ3JlYXRvci5jcmVhdGVCeUxvbmdQYXRoRnJvbVJvb3QocGF0aCwgdGhpcyk7XG4gICAgbGV0IGVudGl0eU5vZGU6IGFueSA9IHRoaXMuZW50aXR5Q29sbGVjdGlvbjtcbiAgICBsZXQgcGF0aE5vZGUgPSBkYXRhUGF0aC5oZWFkLm5leHQ7XG4gICAgd2hpbGUgKHBhdGhOb2RlKSB7XG4gICAgICBpZiAocGF0aE5vZGUudHlwZSA9PT0gRGF0YVBhdGhOb2RlVHlwZS5EYXRhSWQpIHtcbiAgICAgICAgaWYgKGVudGl0eU5vZGUgaW5zdGFuY2VvZiBFbnRpdHlDb2xsZWN0aW9uID09PSB0cnVlKSB7XG4gICAgICAgICAgZW50aXR5Tm9kZSA9IChlbnRpdHlOb2RlIGFzIEVudGl0eUNvbGxlY3Rpb248RW50aXR5PikuZ2V0RW50aXR5QnlJZChwYXRoTm9kZS52YWx1ZSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgZW50aXR5Tm9kZSA9IChlbnRpdHlOb2RlIGFzIEVudGl0eUxpc3Q8RW50aXR5PikuZ2V0KHBhdGhOb2RlLnZhbHVlKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZW50aXR5Tm9kZSA9IGVudGl0eU5vZGVbcGF0aE5vZGUudmFsdWVdO1xuICAgICAgfVxuICAgICAgaWYgKCFlbnRpdHlOb2RlKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihg5om+5LiN5YiwJHtwYXRoTm9kZS52YWx1ZX3lr7nlupTnmoTmlbDmja7oioLngrlgKTtcbiAgICAgIH1cbiAgICAgIHBhdGhOb2RlID0gcGF0aE5vZGUubmV4dDtcbiAgICB9XG4gICAgcmV0dXJuIGVudGl0eU5vZGU7XG4gIH1cbiAgLy8gI2VuZHJlZ2lvblxuXG5cbiAgLy8gI3JlZ2lvbiDojrflj5bjgIHorr7nva7lsZ7mgKflgLxcblxuICAvKipcbiAgICog6I635Y+WcGF0aOWvueW6lOeahOWunuS9k+WxnuaAp+WAvFxuICAgKi9cbiAgcHVibGljIGdldFByb3BWYWx1ZUJ5UGF0aChwYXRoOiBzdHJpbmdbXSk6IGFueSB7XG4gICAgY29uc3QgcHJvcE5hbWUgPSBwYXRoLnBvcCgpO1xuICAgIGNvbnN0IGVudGl0eSA9IHRoaXMuZ2V0RW50aXR5QnlQYXRoKHBhdGgpO1xuICAgIHJldHVybiBlbnRpdHlbcHJvcE5hbWVdO1xuICB9XG5cbiAgLyoqXG4gICAqIOiuvue9rnBhdGjlr7nlupTlrp7kvZPnmoTlsZ7mgKflgLxcbiAgICovXG4gIHB1YmxpYyBzZXRQcm9wVmFsdWVCeVBhdGgocGF0aDogc3RyaW5nW10sIHByb3BWYWx1ZTogYW55KTogdm9pZCB7XG4gICAgY29uc3QgcHJvcE5hbWUgPSBwYXRoLnBvcCgpO1xuICAgIGNvbnN0IGVudGl0eSA9IHRoaXMuZ2V0RW50aXR5QnlQYXRoKHBhdGgpO1xuICAgIGVudGl0eVtwcm9wTmFtZV0gPSBwcm9wVmFsdWU7XG4gIH1cblxuICAvLyAjZW5kcmVnaW9uXG5cblxuICAvLyAjcmVnaW9uIOaPkuWFpeWunuS9k1xuXG4gIC8qKlxuICAgKiDlnKhwYXRo5a+55bqU5a6e5L2T5YmN5o+S5YWl5a6e5L2TXG4gICAqL1xuICBwdWJsaWMgaW5zZXJ0RW50aXR5QmVmb3JlQnlQYXRoKGZwYXRoOiBzdHJpbmdbXSkge1xuICAgIHRocm93IG5ldyBFcnJvcignTm90IEltcGxlbWVudGVkJyk7XG4gIH1cblxuICAvKipcbiAgICog5ZyocGF0aOWvueW6lOWunuS9k+WJjeaJuemHj+aPkuWFpeWunuS9k1xuICAgKi9cbiAgcHVibGljIGluc2VydEVudGl0aWVzQmVmb3JlQnlQYXRoKCkge1xuICAgIHRocm93IG5ldyBFcnJvcignTm90IEltcGxlbWVudGVkJyk7XG4gIH1cblxuICAvKipcbiAgICog5ZyocGF0aOWvueW6lOWunuS9k+WJjeaPkuWFpeWunuS9k1xuICAgKi9cbiAgcHVibGljIGluc2VydEVudGl0eUFmdGVyQnlQYXRoKCkge1xuICAgIHRocm93IG5ldyBFcnJvcignTm90IEltcGxlbWVudGVkJyk7XG4gIH1cblxuICAvKipcbiAgICog5ZyocGF0aOWvueW6lOWunuS9k+WJjeaJuemHj+aPkuWFpeWunuS9k1xuICAgKi9cbiAgcHVibGljIGluc2VydEVudGl0aWVzQWZ0ZXJCeVBhdGgoKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdOb3QgSW1wbGVtZW50ZWQnKTtcbiAgfVxuXG4gIC8vICNlbmRyZWdpb25cblxuXG4gIC8vICNyZWdpb24g6L+95Yqg5a6e5L2TXG5cbiAgLyoqXG4gICAqIOWcqHBhdGjlr7nlupTnmoTlrp7kvZPpm4blkIjkuK3ov73liqAx5Liq5a6e5L2TXG4gICAqL1xuICAvLyBwdWJsaWMgYXBwZW5kRW50aXR5QnlQYXRoKGZwYXRoOiBzdHJpbmdbXSwgZW50aXR5OiBFbnRpdHkpOiB2b2lkIHtcbiAgLy8gICBjb25zdCBlbnRpdHlDb2xsZWN0aW9uT3JMaXN0ID0gdGhpcy5nZXRFbnRpdHlOb2RlQnlQYXRoKGZwYXRoKTtcbiAgLy8gICBpZiAoZW50aXR5Q29sbGVjdGlvbk9yTGlzdCBpbnN0YW5jZW9mIEVudGl0eUNvbGxlY3Rpb24gPT09IHRydWUpIHtcbiAgLy8gICAgIGNvbnN0IGVudGl0eUNvbGxlY3Rpb24gPSBlbnRpdHlDb2xsZWN0aW9uT3JMaXN0IGFzIEVudGl0eUNvbGxlY3Rpb248RW50aXR5PjtcbiAgLy8gICAgIGVudGl0eUNvbGxlY3Rpb24uYWRkRW50aXR5KGVudGl0eSk7XG4gIC8vICAgfSBlbHNlIHtcbiAgLy8gICAgIGNvbnN0IGVudGl0eUxpc3QgPSAoZW50aXR5Q29sbGVjdGlvbk9yTGlzdCBhcyBFbnRpdHlMaXN0PEVudGl0eT4pO1xuICAvLyAgICAgZW50aXR5TGlzdC5hcHBlbmRFbnRpdHkoZW50aXR5KTtcbiAgLy8gICB9XG4gIC8vIH1cblxuICAvKipcbiAgICog5qC55o2ucGF0aOiOt+WPluWunuS9k+mbhuWQiFxuICAgKiBAcGFyYW0gZnBhdGgg6Lev5b6EXG4gICAqIEBwYXJhbSBlbnRpdHlEYXRhIOWunuS9k+aVsOaNrlxuICAgKiBAcGFyYW0gaW5pdGlhbERhdGFb5Y+v6YCJXSDpu5jorqTlgLxcbiAgICovXG4gIHB1YmxpYyBhcHBlbmRFbnRpdHlCeVBhdGgoZnBhdGg6IHN0cmluZywgZW50aXR5RGF0YTogYW55LCBpbml0aWFsRGF0YT86IGFueSwgaXNDbG9uZWQ6IGJvb2xlYW4gPSBmYWxzZSk6IEVudGl0eSB7XG4gICAgY29uc3Qgc3ViUGF0aHMgPSBmcGF0aC5zcGxpdCgnLycpO1xuICAgIGlmIChzdWJQYXRocy5sZW5ndGggPCAzKSB7XG4gICAgICB0aHJvdyBFcnJvcihg5qC55o2ucGF0aOWIoOmZpOWunuS9k+aVsOaNruWHuumUmeS6huOAguS8oOWFpeeahHBhdGhbJHtmcGF0aH1d5qC85byP5LiN5a+5YCk7XG4gICAgfVxuXG4gICAgbGV0IGNoaWxkRW50aXR5TGlzdDogRW50aXR5TGlzdDxhbnk+O1xuICAgIGxldCBwcm9wSW5mbzogeyBwcm9wVHlwZTogc3RyaW5nLCBwcm9wRW50aXR5VHlwZTogYW55IH07XG4gICAgbGV0IHByb3BOYW1lOiBzdHJpbmc7XG4gICAgZm9yIChsZXQgaSA9IDI7IGkgPCBzdWJQYXRocy5sZW5ndGg7IGkgPSBpICsgMikge1xuICAgICAgY29uc3QgZmlkID0gc3ViUGF0aHNbaSAtIDFdO1xuICAgICAgcHJvcE5hbWUgPSBzdWJQYXRoc1tpXTtcblxuICAgICAgLy8gdG9kbzogRW50aXR5Q29sbGVjdGlvbumHjeaehOS5i+WQjui/memHjOaXoOmcgOW3ruW8guWkhOeQhlxuICAgICAgY29uc3QgcGFyZW50RW50aXR5ID0gY2hpbGRFbnRpdHlMaXN0ID8gY2hpbGRFbnRpdHlMaXN0LmdldChmaWQpIDogdGhpcy5lbnRpdHlDb2xsZWN0aW9uLmdldEVudGl0eUJ5SWQoZmlkKTtcbiAgICAgIGNoaWxkRW50aXR5TGlzdCA9IHBhcmVudEVudGl0eVtwcm9wTmFtZV07XG4gICAgICBjb25zdCBlbnRpdHlUeXBlID0gcHJvcEluZm8gPyBwcm9wSW5mby5wcm9wRW50aXR5VHlwZSA6IHRoaXMuZW50aXR5VHlwZTtcbiAgICAgIHByb3BJbmZvID0gRW50aXR5VXRpbC5nZXRQcm9wSW5mbyhlbnRpdHlUeXBlLCBwcm9wTmFtZSk7XG4gICAgICBpZiAoIWNoaWxkRW50aXR5TGlzdCkge1xuICAgICAgICB0aHJvdyBFcnJvcihgZnBhdGjlj4LmlbDplJnor6/vvIzml6Dms5Xmib7liLAke3Byb3BOYW1lfeWvueW6lOeahOWtkOihqOOAgmZwYXRo5Li677yaJHtmcGF0aH1gKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBjb25zdCBwcm9wSW5mbyA9IEVudGl0eVV0aWwuZ2V0UHJvcEluZm8odGhpcy5lbnRpdHlUeXBlLCBwcm9wTmFtZSk7XG4gICAgY29uc3QgY2hpbGRFbnRpdHkgPSBjcmVhdGVFbnRpdHk8RW50aXR5Pihwcm9wSW5mby5wcm9wRW50aXR5VHlwZSwgZW50aXR5RGF0YSk7XG4gICAgLy8g5Zyo5a6e5L2T55qE5a6e5L6L5LiK5aKe5Yqg6buY6K6k5YC85bGe5oCn77yM5Lul5L6/5ZyoY3JlYXRlQmluZGluZ09iamVjdOaXtuWtmOaUvum7mOiupOWAvFxuICAgIGlmIChpbml0aWFsRGF0YSkge1xuICAgICAgRW50aXR5VXRpbC5hcHBlbmRJbml0aWFsRGF0YShjaGlsZEVudGl0eSwgaW5pdGlhbERhdGEpO1xuICAgIH1cbiAgICBjaGlsZEVudGl0eUxpc3QuYXBwZW5kTmV3KGNoaWxkRW50aXR5LCBpc0Nsb25lZCk7XG4gICAgcmV0dXJuIGNoaWxkRW50aXR5O1xuICB9XG4gIC8qKlxuICAgKiDlnKjmjIflrprkvY3nva7mj5LlhaXlrp7kvZNcbiAgICogQHBhcmFtIGZwYXRoIOeItui3r+W+hFxuICAgKiBAcGFyYW0gZW50aXR5RGF0YSDlrp7kvZPmlbDmja5cbiAgICogQHBhcmFtIGluaXRpYWxEYXRhIOWIneWni+aVsOaNrlxuICAgKiBAcGFyYW0gcG9zaXRpb24g5o+S5YWl5L2N572uXG4gICAqL1xuICBwdWJsaWMgaW5zZXJ0RW50aXR5QnlQYXRoKGZwYXRoOiBzdHJpbmcsIGVudGl0eURhdGE6IGFueSwgaW5pdGlhbERhdGE/OiBhbnksIHBvc2l0aW9uPzogMSB8IC0xKSB7XG4gICAgY29uc3Qgc3ViUGF0aHMgPSBmcGF0aC5zcGxpdCgnLycpO1xuICAgIGlmIChzdWJQYXRocy5sZW5ndGggPCAzKSB7XG4gICAgICB0aHJvdyBFcnJvcihg5qC55o2ucGF0aOWIoOmZpOWunuS9k+aVsOaNruWHuumUmeS6huOAguS8oOWFpeeahHBhdGhbJHtmcGF0aH1d5qC85byP5LiN5a+5YCk7XG4gICAgfVxuXG4gICAgbGV0IGNoaWxkRW50aXR5TGlzdDogRW50aXR5TGlzdDxhbnk+O1xuICAgIGxldCBwcm9wSW5mbzogeyBwcm9wVHlwZTogc3RyaW5nLCBwcm9wRW50aXR5VHlwZTogYW55IH07XG4gICAgbGV0IHByb3BOYW1lOiBzdHJpbmc7XG4gICAgZm9yIChsZXQgaSA9IDI7IGkgPCBzdWJQYXRocy5sZW5ndGg7IGkgPSBpICsgMikge1xuICAgICAgY29uc3QgZmlkID0gc3ViUGF0aHNbaSAtIDFdO1xuICAgICAgcHJvcE5hbWUgPSBzdWJQYXRoc1tpXTtcblxuICAgICAgLy8gdG9kbzogRW50aXR5Q29sbGVjdGlvbumHjeaehOS5i+WQjui/memHjOaXoOmcgOW3ruW8guWkhOeQhlxuICAgICAgY29uc3QgcGFyZW50RW50aXR5ID0gY2hpbGRFbnRpdHlMaXN0ID8gY2hpbGRFbnRpdHlMaXN0LmdldChmaWQpIDogdGhpcy5lbnRpdHlDb2xsZWN0aW9uLmdldEVudGl0eUJ5SWQoZmlkKTtcbiAgICAgIGNoaWxkRW50aXR5TGlzdCA9IHBhcmVudEVudGl0eVtwcm9wTmFtZV07XG4gICAgICBjb25zdCBlbnRpdHlUeXBlID0gcHJvcEluZm8gPyBwcm9wSW5mby5wcm9wRW50aXR5VHlwZSA6IHRoaXMuZW50aXR5VHlwZTtcbiAgICAgIHByb3BJbmZvID0gRW50aXR5VXRpbC5nZXRQcm9wSW5mbyhlbnRpdHlUeXBlLCBwcm9wTmFtZSk7XG4gICAgICBpZiAoIWNoaWxkRW50aXR5TGlzdCkge1xuICAgICAgICB0aHJvdyBFcnJvcihgZnBhdGjlj4LmlbDplJnor6/vvIzml6Dms5Xmib7liLAke3Byb3BOYW1lfeWvueW6lOeahOWtkOihqOOAgmZwYXRo5Li677yaJHtmcGF0aH1gKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBjb25zdCBwcm9wSW5mbyA9IEVudGl0eVV0aWwuZ2V0UHJvcEluZm8odGhpcy5lbnRpdHlUeXBlLCBwcm9wTmFtZSk7XG4gICAgY29uc3QgY2hpbGRFbnRpdHkgPSBjcmVhdGVFbnRpdHk8RW50aXR5Pihwcm9wSW5mby5wcm9wRW50aXR5VHlwZSwgZW50aXR5RGF0YSk7XG4gICAgLy8g5Zyo5a6e5L2T55qE5a6e5L6L5LiK5aKe5Yqg6buY6K6k5YC85bGe5oCn77yM5Lul5L6/5ZyoY3JlYXRlQmluZGluZ09iamVjdOaXtuWtmOaUvum7mOiupOWAvFxuICAgIGlmIChpbml0aWFsRGF0YSkge1xuICAgICAgRW50aXR5VXRpbC5hcHBlbmRJbml0aWFsRGF0YShjaGlsZEVudGl0eSwgaW5pdGlhbERhdGEpO1xuICAgIH1cbiAgICBjaGlsZEVudGl0eUxpc3QuaW5zZXJ0KGNoaWxkRW50aXR5LCBwb3NpdGlvbik7XG4gICAgcmV0dXJuIGNoaWxkRW50aXR5O1xuICB9XG4gIC8qKlxuICAgKiDlnKhwYXRo5a+55bqU55qE5a6e5L2T6ZuG5ZCI5Lit6L+95Yqg5aSa5Liq5a6e5L2TXG4gICAqL1xuICBwdWJsaWMgYXBwZW5kRW50aXRpZXNCeVBhdGgoZnBhdGg6IHN0cmluZ1tdLCBlbnRpdGllczogRW50aXR5W10pIHtcbiAgICBjb25zdCBlbnRpdHlDb2xsZWN0aW9uT3JMaXN0ID0gdGhpcy5nZXRFbnRpdHlOb2RlQnlQYXRoKGZwYXRoKTtcbiAgICBpZiAoZW50aXR5Q29sbGVjdGlvbk9yTGlzdCBpbnN0YW5jZW9mIEVudGl0eUNvbGxlY3Rpb24gPT09IHRydWUpIHtcbiAgICAgIGNvbnN0IGVudGl0eUNvbGxlY3Rpb24gPSBlbnRpdHlDb2xsZWN0aW9uT3JMaXN0IGFzIEVudGl0eUNvbGxlY3Rpb248RW50aXR5PjtcbiAgICAgIGVudGl0eUNvbGxlY3Rpb24uYWRkRW50aXRpZXMoZW50aXRpZXMpO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zdCBlbnRpdHlMaXN0ID0gKGVudGl0eUNvbGxlY3Rpb25Pckxpc3QgYXMgRW50aXR5TGlzdDxFbnRpdHk+KTtcbiAgICAgIGVudGl0eUxpc3QuYXBwZW5kRW50aXRpZXMoZW50aXRpZXMpO1xuICAgIH1cbiAgfVxuXG4gIC8vICNlbmRyZWdpb25cblxuXG4gIC8vICNyZWdpb24g5Yig6Zmk5a6e5L2TXG5cbiAgLyoqXG4gICAqIOS7jmZhcHRo5a+55bqU55qE5a6e5L2T6ZuG5ZCI5Lit5Yig6ZmkaWTlr7nlupTnmoTlrp7kvZNcbiAgICovXG4gIC8vIHB1YmxpYyByZW1vdmVFbnRpdHlCeVBhdGgoZnBhdGg6IHN0cmluZ1tdLCBpZDogc3RyaW5nKTogdm9pZCB7XG4gIC8vICAgY29uc3QgZW50aXR5Q29sbGVjdGlvbk9yTGlzdCA9IHRoaXMuZ2V0RW50aXR5Tm9kZUJ5UGF0aChmcGF0aCk7XG4gIC8vICAgaWYgKGVudGl0eUNvbGxlY3Rpb25Pckxpc3QgaW5zdGFuY2VvZiBFbnRpdHlDb2xsZWN0aW9uID09PSB0cnVlKSB7XG4gIC8vICAgICBjb25zdCBlbnRpdHlDb2xsZWN0aW9uID0gZW50aXR5Q29sbGVjdGlvbk9yTGlzdCBhcyBFbnRpdHlDb2xsZWN0aW9uPEVudGl0eT47XG4gIC8vICAgICBlbnRpdHlDb2xsZWN0aW9uLnJlbW92ZUVudGl0eUJ5SWQoaWQpO1xuICAvLyAgIH0gZWxzZSB7XG4gIC8vICAgICBjb25zdCBlbnRpdHlMaXN0ID0gKGVudGl0eUNvbGxlY3Rpb25Pckxpc3QgYXMgRW50aXR5TGlzdDxFbnRpdHk+KTtcbiAgLy8gICAgIGVudGl0eUxpc3QucmVtb3ZlKGlkKTtcbiAgLy8gICB9XG4gIC8vIH1cblxuICAvKipcbiAgICog5qC55o2ucGF0aOiOt+WPluWunuS9k+mbhuWQiFxuICAgKiBAcGFyYW0gZnBhdGggcGF0aFxuICAgKi9cbiAgcHVibGljIHJlbW92ZUVudGl0eUJ5UGF0aChmcGF0aDogc3RyaW5nLCBpZDogc3RyaW5nKSB7XG4gICAgY29uc3Qgc3ViUGF0aHMgPSBmcGF0aC5zcGxpdCgnLycpO1xuICAgIGlmIChzdWJQYXRocy5sZW5ndGggPCAzKSB7XG4gICAgICB0aHJvdyBFcnJvcihg5qC55o2ucGF0aOWIoOmZpOWunuS9k+aVsOaNruWHuumUmeS6huOAguS8oOWFpeeahHBhdGhbJHtmcGF0aH1d5qC85byP5LiN5a+5YCk7XG4gICAgfVxuICAgIGxldCBjaGlsZEVudGl0eUxpc3Q6IEVudGl0eUxpc3Q8YW55PjtcbiAgICBmb3IgKGxldCBpID0gMjsgaSA8IHN1YlBhdGhzLmxlbmd0aDsgaSA9IGkgKyAyKSB7XG4gICAgICBjb25zdCBmaWQgPSBzdWJQYXRoc1tpIC0gMV07XG4gICAgICBjb25zdCBwcm9wTmFtZSA9IHN1YlBhdGhzW2ldO1xuICAgICAgY29uc3QgcGFyZW50RW50aXR5ID0gY2hpbGRFbnRpdHlMaXN0ID8gY2hpbGRFbnRpdHlMaXN0LmdldChmaWQpIDogdGhpcy5lbnRpdHlDb2xsZWN0aW9uLmdldEVudGl0eUJ5SWQoZmlkKTtcbiAgICAgIGNoaWxkRW50aXR5TGlzdCA9IHBhcmVudEVudGl0eVtwcm9wTmFtZV07XG4gICAgICBpZiAoIWNoaWxkRW50aXR5TGlzdCkge1xuICAgICAgICB0aHJvdyBFcnJvcihgZnBhdGjlj4LmlbDplJnor6/vvIzml6Dms5Xmib7liLAke3Byb3BOYW1lfeWvueW6lOeahOWtkOihqOOAgmZwYXRo5Li677yaJHtmcGF0aH1gKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBjaGlsZEVudGl0eUxpc3QucmVtb3ZlKGlkKTtcbiAgfVxuXG4gIC8qKlxuICAgKiDku45mYXB0aOWvueW6lOeahOWunuS9k+mbhuWQiOS4reWIoOmZpGlkc+WvueW6lOeahOWunuS9k1xuICAgKi9cbiAgcHVibGljIHJlbW92ZUVudGl0aWVzQnlQYXRoKGZwYXRoOiBzdHJpbmdbXSwgaWRzOiBzdHJpbmdbXSk6IHZvaWQge1xuICAgIC8vIGNvbnN0IGVudGl0eUNvbGxlY3Rpb25Pckxpc3QgPSB0aGlzLmdldEVudGl0eU5vZGVCeVBhdGgoZnBhdGgpO1xuICAgIC8vIGlmIChlbnRpdHlDb2xsZWN0aW9uT3JMaXN0IGluc3RhbmNlb2YgRW50aXR5Q29sbGVjdGlvbiA9PT0gdHJ1ZSkge1xuICAgIC8vICAgY29uc3QgZW50aXR5Q29sbGVjdGlvbiA9IGVudGl0eUNvbGxlY3Rpb25Pckxpc3QgYXMgRW50aXR5Q29sbGVjdGlvbjxFbnRpdHk+O1xuICAgIC8vICAgZW50aXR5Q29sbGVjdGlvbi5yZW1vdmVFbnRpdGllc0J5SWRzKGlkcyk7XG4gICAgLy8gfSBlbHNlIHtcbiAgICAvLyAgIGNvbnN0IGVudGl0eUxpc3QgPSAoZW50aXR5Q29sbGVjdGlvbk9yTGlzdCBhcyBFbnRpdHlMaXN0PEVudGl0eT4pO1xuICAgIC8vICAgZW50aXR5TGlzdC5yZW1vdmUoaWRzKTtcbiAgICAvLyB9XG4gICAgdGhyb3cgbmV3IEVycm9yKCdOb3QgSW1wbGVtZW50ZWQnKTtcbiAgfVxuICAvLyAjZW5kcmVnaW9uXG5cblxuICAvLyAjcmVnaW9uIOa4heepuuWPmOabtOmbhuebuOWFs+aWueazlVxuXG4gIC8qKlxuICAgKiDmuIXnqbrmiYDmnInlrp7kvZPnmoTlj5jmm7Tpm4ZcbiAgICovXG4gIHB1YmxpYyBjbGVhckFsbEVudGl0eUNoYW5nZXMoKSB7XG4gICAgY29uc3QgZW50aXRpZXMgPSB0aGlzLmVudGl0eUNvbGxlY3Rpb24udG9BcnJheSgpO1xuICAgIGVudGl0aWVzLmZvckVhY2goKGVudGl0eTogRW50aXR5KSA9PiB7XG4gICAgICBlbnRpdHkuY2hhbmdlcy5zcGxpY2UoMCwgZW50aXR5LmNoYW5nZXMubGVuZ3RoKTtcbiAgICB9KTtcbiAgfVxuXG4gIHB1YmxpYyByZXNldEFsbEVudGl0eUNoYW5nZU1hcmsoKSB7XG4gICAgY29uc3QgZW50aXRpZXMgPSB0aGlzLmVudGl0eUNvbGxlY3Rpb24udG9BcnJheSgpO1xuICAgIGVudGl0aWVzLmZvckVhY2goKGVudGl0eTogRW50aXR5KSA9PiB7XG4gICAgICBlbnRpdHkuaGFzQ2hhbmdlID0gZmFsc2U7XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICog5riF56m6aWTmjIflrprnmoTlrp7kvZPlj5jmm7Tpm4ZcbiAgICovXG4gIHB1YmxpYyBjbGVhckVudGl0eUNoYW5nZXNCeUlkKGlkOiBzdHJpbmcpOiB2b2lkIHtcbiAgICBjb25zdCBlbnRpdHkgPSB0aGlzLmVudGl0eUNvbGxlY3Rpb24uZ2V0RW50aXR5QnlJZChpZCk7XG4gICAgaWYgKCFlbnRpdHkpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgZW50aXR5LmNoYW5nZXMuc3BsaWNlKDAsIGVudGl0eS5jaGFuZ2VzLmxlbmd0aCk7XG4gIH1cblxuICAvKipcbiAgICog5riF56m6aWRz5pWw57uE5Lit5oyH5a6a55qE5a6e5L2T55qE5Y+Y5pu06ZuGXG4gICAqL1xuICBwdWJsaWMgY2xlYXJFbnRpdHlDaGFuZ2VzQnlJZHMoaWRzOiBzdHJpbmdbXSk6IHZvaWQge1xuICAgIGlmICghaWRzIHx8IGlkcy5sZW5ndGggPCAwKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgaWRzLmZvckVhY2goKGlkOiBzdHJpbmcpID0+IHtcbiAgICAgIHRoaXMuY2xlYXJFbnRpdHlDaGFuZ2VzQnlJZChpZCk7XG4gICAgfSk7XG4gIH1cblxuICAvLyAjZW5kcmVnaW9uXG5cblxuICAvLyAjcmVnaW9uIOWPmOabtOmbhuajgOafpeebuOWFs+aWueazlVxuXG4gIC8qKlxuICAgKiDmo4Dmn6XmiYDmnInnmoTlrp7kvZPvvIzmmK/lkKbmnInmnKrmj5DkuqTnmoTlj5jmm7RcbiAgICovXG4gIHB1YmxpYyBjaGVja0FsbEVudGl0eUNoYW5nZXMoKTogYm9vbGVhbiB7XG5cbiAgICBjb25zdCBlbnRpdGllcyA9IHRoaXMuZW50aXR5Q29sbGVjdGlvbi50b0FycmF5KCk7XG4gICAgY29uc3QgaGFzQ2hhbmdlcyA9IGVudGl0aWVzLnNvbWUoKGVudGl0eTogRW50aXR5KSA9PiB7XG4gICAgICBpZiAoZW50aXR5LmNoYW5nZXMubGVuZ3RoID4gMCkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICByZXR1cm4gaGFzQ2hhbmdlcztcbiAgfVxuXG4gIC8qKlxuICAgKiDmo4Dmn6VpZOWvueW6lOeahOWunuS9k++8jOaYr+WQpuacieacquaPkOS6pOeahOWPmOabtFxuICAgKi9cbiAgcHVibGljIGNoZWNrRW50aXR5Q2hhbmdlc0J5SWQoaWQ6IHN0cmluZyk6IGJvb2xlYW4ge1xuICAgIGNvbnN0IGVudGl0eSA9IHRoaXMuZW50aXR5Q29sbGVjdGlvbi5nZXRFbnRpdHlCeUlkKGlkKTtcbiAgICBpZiAoIWVudGl0eSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICByZXR1cm4gZW50aXR5LmNoYW5nZXMubGVuZ3RoID4gMDtcbiAgfVxuXG4gIC8vICNlbmRyZWdpb25cblxuXG4gIC8vICNyZWdpb24g5LiN6KeE6IyD5pa55rOV77yM5b6F5bqf5byDXG5cbiAgLyoqXG4gICAqIOW+heW6n+W8g1xuICAgKiBAZGVwcmVjYXRlZFxuICAgKi9cbiAgcHVibGljIGNsZWFyRW50aXR5Q2hhbmdlc0J5QXJyYXkoaWRBcnJheTogc3RyaW5nW10pOiB2b2lkIHtcbiAgICB0aGlzLmNsZWFyRW50aXR5Q2hhbmdlc0J5SWRzKGlkQXJyYXkpO1xuICB9XG5cbiAgLy8gI2VuZHJlZ2lvblxuXG59XG5cbmV4cG9ydCB7IEVudGl0eU1hbmFnZXIgfTtcbiJdfQ==
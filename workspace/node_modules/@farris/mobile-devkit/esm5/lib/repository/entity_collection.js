import * as tslib_1 from "tslib";
import { Modification, ModifyType } from '../changeset/index';
import { Subject } from 'rxjs';
import { Entity, FieldMetadataUtil, EntityList } from '../entity/index';
// tslint:disable: no-bitwise
/**
 * 实体集合
 * @todo：应该用EntityList代替。
 */
var EntityCollection = /** @class */ (function () {
    /**
     * 构造函数
     */
    function EntityCollection(entityType) {
        this.innerEntitySet = new Set();
        this.innerEntityMap = new Map();
        this.collectionChanged = new Subject();
        this.changes = new Subject();
        this.entityType = entityType;
        this.primaryKey = FieldMetadataUtil.getPrimaryKey(this.entityType);
    }
    /**
     * 实体数量
     */
    EntityCollection.prototype.count = function () {
        return this.innerEntitySet.size;
    };
    Object.defineProperty(EntityCollection.prototype, "entityTypeName", {
        get: function () {
            return this.entityType.name;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * 是否包含指定主键值的实体
     * @param id 主键值
     */
    EntityCollection.prototype.has = function (id) {
        return this.innerEntityMap.has(id);
    };
    /**
     * 清空全部实体
     */
    EntityCollection.prototype.clear = function () {
        this.innerEntityMap.clear();
        this.innerEntitySet.clear();
        this.notifyCollectionChanged(new Modification([], ModifyType.Load));
    };
    /**
     * 清空全部实体
     * @param isReset 是否为重置实体操作
     */
    EntityCollection.prototype.reset = function () {
        this.innerEntityMap.clear();
        this.innerEntitySet.clear();
        var modification = new Modification([], ModifyType.Load);
        modification.isReset = true;
        this.notifyCollectionChanged(modification);
    };
    /**
     * 转换为实体数组
     */
    EntityCollection.prototype.toArray = function () {
        return Array.from(this.innerEntitySet);
    };
    /**
     * 转换为JSON数组
     */
    EntityCollection.prototype.toJSON = function () {
        var result = [];
        var entities = this.toArray();
        entities.forEach(function (entity) {
            result.push(entity.toJSON());
        });
        return result;
    };
    /**
     * 批量加载实体
     */
    EntityCollection.prototype.loadEntities = function (entities, entityCreate) {
        var _this = this;
        if (entityCreate === void 0) { entityCreate = false; }
        this.innerEntityMap.clear();
        this.innerEntitySet.clear();
        entities.forEach(function (entity) {
            _this.innerEntitySet.add(entity);
            _this.innerEntityMap.set(entity[_this.primaryKey], entity);
            _this.listenEntityChangeEvent(entity);
        });
        var modification = new Modification(entities, ModifyType.Load);
        modification.entityCreate = entityCreate;
        this.notifyCollectionChanged(modification);
    };
    /**
     * 追加实体
     * @param entity 要追加的实体
     * @param isCloned 实体是否是克隆的
     */
    EntityCollection.prototype.addEntity = function (entity, isCloned) {
        if (isCloned === void 0) { isCloned = false; }
        this.verifyEntityToAdd(entity);
        this.innerEntitySet.add(entity);
        this.innerEntityMap.set(entity[this.primaryKey], entity);
        this.listenEntityChangeEvent(entity);
        var modifyType = isCloned ? ModifyType.Clone : ModifyType.Add;
        this.notifyCollectionChanged(new Modification([entity], modifyType));
    };
    /**
     * 在当前行前或后插入数据
     * @param entity 实体
     * @param position 位置
     */
    EntityCollection.prototype.insertEntity = function (entity, position) {
        this.verifyEntityToAdd(entity);
        this.innerEntitySet.add(entity);
        this.innerEntityMap.set(entity[this.primaryKey], entity);
        this.listenEntityChangeEvent(entity);
        this.notifyCollectionChanged(new Modification(entity, ModifyType.Insert, null, null, position));
    };
    /**
     * 更新实体
     * @param entity entity
     * @param entityData 实体数据
     */
    EntityCollection.prototype.updateEntity = function (entity, entityData) {
        entity.load(entityData);
        this.notifyCollectionChanged(new Modification(entity, ModifyType.Update, null, null));
    };
    /**
     * 批量追加实体
     * @param entities 要加载的实体数组
     */
    EntityCollection.prototype.addEntities = function (entities) {
        var _this = this;
        if (!entities) {
            return;
        }
        var entitiesToAdd = [];
        entities.forEach(function (entity) {
            _this.verifyEntityToAdd(entity);
            entitiesToAdd.push(entity);
        });
        entitiesToAdd.forEach(function (entity) {
            _this.innerEntitySet.add(entity);
            _this.innerEntityMap.set(entity[_this.primaryKey], entity);
            _this.listenEntityChangeEvent(entity);
        });
        this.notifyCollectionChanged(new Modification(entitiesToAdd, ModifyType.Add));
    };
    /**
     * 添加实体（不切换当前行）
     * @param entities 实体
     */
    EntityCollection.prototype.addData = function (entities) {
        var _this = this;
        if (!entities) {
            return;
        }
        var entitiesToAdd = [];
        entities.forEach(function (entity) {
            _this.verifyEntityToAdd(entity);
            entitiesToAdd.push(entity);
        });
        entitiesToAdd.forEach(function (entity) {
            _this.innerEntitySet.add(entity);
            _this.innerEntityMap.set(entity[_this.primaryKey], entity);
            _this.listenEntityChangeEvent(entity);
        });
        this.notifyCollectionChanged(new Modification(entitiesToAdd, ModifyType.AddData));
    };
    /**
     * 根据主键值获取实体
     */
    EntityCollection.prototype.getEntityById = function (identity) {
        if (this.innerEntityMap.has(identity) === false) {
            return null;
        }
        var entity = this.innerEntityMap.get(identity);
        return entity;
    };
    /**
     * 根据路径获取实体
     */
    EntityCollection.prototype.getEntityByPath = function (pathArray) {
        var rootEntityId = pathArray[0].split(':')[1];
        var parentNode = this.getEntityById(rootEntityId);
        for (var i = 1; i < pathArray.length && parentNode; i = i + 1) {
            var currentPath = pathArray[i];
            if (parentNode instanceof Entity) {
                // @todo：强识了别冒号
                if (currentPath.indexOf(':') === -1) {
                    parentNode = parentNode[pathArray[i]];
                }
            }
            else {
                parentNode = parentNode.get(pathArray[i].split(':')[1]);
            }
        }
        return parentNode;
    };
    /**
     * id:1/a/id:2/c
     * @param pathArray 路径数组
     */
    EntityCollection.prototype.getEntitiesByPath = function (pathArray) {
        var rootEntityId = pathArray[0].split(':')[1];
        var entity = this.getEntityById(rootEntityId);
        for (var i = 1; i < pathArray.length && entity; i += 2) {
            var path = pathArray[i];
            entity = entity[path];
            if (!(entity instanceof EntityList)) {
                throw new Error('路径格式错误');
            }
            if ((i + 1) < pathArray.length) {
                var id = pathArray[i + 1].split(':')[1];
                entity = entity.get(id);
            }
        }
        return entity;
    };
    /**
     * 返回符合指定条件的实体集合
     * @param predicate 条件谓词
     */
    EntityCollection.prototype.getEntities = function (predicate) {
        var entities = Array.from(this.innerEntitySet);
        var matchedEntities = entities.filter(predicate);
        return matchedEntities;
    };
    /**
     * 获取全部实体
     */
    EntityCollection.prototype.getAllEntities = function () {
        return Array.from(this.innerEntitySet);
    };
    /**
     * 根据主键值删除对应实体
     * @param identity 主键值
     */
    EntityCollection.prototype.removeEntityById = function (identity) {
        this.verifyEntityToRemove(identity);
        var entityToRemove = this.innerEntityMap.get(identity);
        this.innerEntityMap.delete(identity);
        this.innerEntitySet.delete(entityToRemove);
        this.notifyCollectionChanged(new Modification([entityToRemove], ModifyType.Remove));
        return entityToRemove;
    };
    EntityCollection.prototype.removeEntitiesByIds = function (id) {
    };
    /**
     * 删除符合条件的实体集合
     */
    EntityCollection.prototype.removeEntities = function (predicate) {
        var _this = this;
        var entitiesToRemove = Array.from(this.innerEntitySet).filter(predicate);
        entitiesToRemove.forEach(function (entityToRemove) {
            _this.innerEntityMap.delete(entityToRemove[_this.primaryKey]);
            _this.innerEntitySet.delete(entityToRemove);
        });
        this.notifyCollectionChanged(new Modification(entitiesToRemove, ModifyType.Remove));
        return entitiesToRemove;
    };
    /**
     * 移除数据（不切换当前行）
     * @param predicate 过滤函数
     */
    EntityCollection.prototype.removeData = function (predicate) {
        var _this = this;
        var entitiesToRemove = Array.from(this.innerEntitySet).filter(predicate);
        entitiesToRemove.forEach(function (entityToRemove) {
            _this.innerEntityMap.delete(entityToRemove[_this.primaryKey]);
            _this.innerEntitySet.delete(entityToRemove);
        });
        this.notifyCollectionChanged(new Modification(entitiesToRemove, ModifyType.RemoveData));
        return entitiesToRemove;
    };
    /**
     * 重置子表数据
     * @param paths 路径
     * 路径格式 ['id:provinceId','id:cityMDMs','zoneMDMs']
     * @description path参数格式
     * ```json
     * [
     * "id:b5ed23ca-88d9-4377-98ec-92f35c1325f1",
     * "cityMDMs",
     * "id:373706af-622f-4aea-a006-dddbffd7bda3",
     * "zoneMDMs"
     * ]
     * ```
     * @param entities 实体数组
     */
    EntityCollection.prototype.resetEntities = function (paths, entities) {
        var e_1, _a;
        if (paths[0].indexOf(':') === -1) {
            throw new Error('路径格式错误');
        }
        // paths里面第一个一定是id
        var entityInfo = paths[0].split(':');
        var _b = tslib_1.__read(entityInfo, 2), entityPrimaryKey = _b[0], entityId = _b[1];
        var entity = null;
        try {
            for (var _c = tslib_1.__values(this.innerEntitySet), _d = _c.next(); !_d.done; _d = _c.next()) {
                var element = _d.value;
                if (element[entityPrimaryKey] === entityId) {
                    entity = element;
                    break;
                }
            }
        }
        catch (e_1_1) { e_1 = { error: e_1_1 }; }
        finally {
            try {
                if (_d && !_d.done && (_a = _c.return)) _a.call(_c);
            }
            finally { if (e_1) throw e_1.error; }
        }
        // for (let index = 0; index < this.innerEntitySet; index++) {
        //   const element: T = this.innerEntitySet[index];
        //   if (element[entityPrimaryKey] === entityId) {
        //     entity = element;
        //     break;
        //   }
        // }
        if (!entity) {
            throw new Error("\u627E\u4E0D\u5230" + entityPrimaryKey + "\u4E3A" + entityId + "\u7684\u5B9E\u4F53");
        }
        var data = entity;
        paths.slice(1).forEach(function (path) {
            data = data[path];
        });
        var entityList = data;
        entityList.clear();
        entityList.loadEntities(entities);
    };
    /**
     * 验证实体是否能够添加
     */
    EntityCollection.prototype.verifyEntityToAdd = function (entity) {
        if (this.has(entity[this.primaryKey])) {
            this.innerEntitySet.delete(this.innerEntityMap.get(entity[this.primaryKey]));
            this.innerEntityMap.delete(entity[this.primaryKey]);
            // throw new Error(`The repository already had an item with the save identity of '${entity[this.primaryKey]}'`);
        }
        return true;
    };
    /**
     * 验证实体是否能移除
     */
    EntityCollection.prototype.verifyEntityToRemove = function (identity) {
        if (!this.has(identity)) {
            throw new Error("The entity with identity of '" + identity + " dose not exsit.'");
        }
        return true;
    };
    /**
     * 实体集合变更流
     */
    EntityCollection.prototype.notifyCollectionChanged = function (modification) {
        this.collectionChanged.next(modification);
    };
    Object.defineProperty(EntityCollection.prototype, "pageSize", {
        /**
         * 获取分页大小
         * @description 如果用户未指定分页大小则默认为0，即获取所有数据
         */
        get: function () {
            if (!!this.paginationInfo) {
                return this.paginationInfo.pageSize || 0;
            }
            return 0;
        },
        //#region 分页
        /**
         * 设置分页大小
         */
        set: function (pageSize) {
            if (typeof (pageSize) !== 'number' || pageSize < 0) {
                throw new Error('Invalid parameter:pageSize');
            }
            var original = this.paginationInfo;
            // const entityPaginationInfo = Object.assign({}, original[this.entityTypeName], { pageSize });
            // this.paginationInfo = Object.assign({}, original, { [this.entityTypeName]: entityPaginationInfo });
            // this.notifyCollectionChanged(new Modification(this.paginationInfo[this.entityTypeName], ModifyType.PaginationInfoChange));
            this.paginationInfo = Object.assign({}, original, { pageSize: pageSize });
            this.notifyCollectionChanged(new Modification(this.paginationInfo, ModifyType.PaginationInfoChange));
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(EntityCollection.prototype, "totalCount", {
        /**
         * 获取数据总条数
         */
        get: function () {
            if (!!this.paginationInfo) {
                return this.paginationInfo.total || 0;
            }
            return 0;
        },
        /**
         * 设置数据总条数
         */
        set: function (total) {
            if (typeof (total) !== 'number' || total < 0) {
                throw new Error('Invalid parameter:total');
            }
            var original = this.paginationInfo;
            // const entityPaginationInfo = Object.assign({}, original[this.entityTypeName], { total });
            // this.paginationInfo = Object.assign({}, original, { [this.entityTypeName]: entityPaginationInfo });
            this.paginationInfo = Object.assign({}, original, { total: total });
            this.notifyCollectionChanged(new Modification(this.paginationInfo, ModifyType.PaginationInfoChange));
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(EntityCollection.prototype, "pageIndex", {
        /**
         * 获取当前页码
         */
        get: function () {
            if (!!this.paginationInfo) {
                return this.paginationInfo.pageIndex || 1;
            }
            return 1;
        },
        /**
         * 设置当前页码
         */
        set: function (pageIndex) {
            if (typeof (pageIndex) !== 'number' || pageIndex < 0) {
                throw new Error('Invalid parameter:pageIndex');
            }
            var original = this.paginationInfo;
            // const entityPaginationInfo = Object.assign({}, original[this.entityTypeName], { pageIndex });
            // this.paginationInfo = Object.assign({}, original, { [this.entityTypeName]: entityPaginationInfo });
            this.paginationInfo = Object.assign({}, original, { pageIndex: pageIndex });
            this.notifyCollectionChanged(new Modification(this.paginationInfo, ModifyType.PaginationInfoChange));
        },
        enumerable: true,
        configurable: true
    });
    /**
     * 更新分页信息
     * @param path 绑定路径
     * @param pageInfo 分页信息
     */
    EntityCollection.prototype.updatePaginationInfoByPath = function (path, pageInfo) {
        var original = this.paginationInfo;
        var pageIndex = pageInfo.pageIndex, pageSize = pageInfo.pageSize, total = pageInfo.totalCount;
        var paginationInfo = Object.assign({}, original, { pageIndex: pageIndex, pageSize: pageSize, total: total });
        this.setPaginationConfigByPath(path, paginationInfo);
    };
    /**
     * 根据路径获取分页大小
     * @param path 路径
     */
    EntityCollection.prototype.getPaginationConfigByPath = function (path, defaultValue) {
        if (!path || path === '/') {
            return this.paginationInfo;
        }
        if (typeof path !== 'string') {
            throw new Error('路径必须为字符串！');
        }
        path = path.substring(1);
        var paths = path.split('/').filter(function (item) { return !!item && item.trim().length > 0; }).map(function (item) { return item.trim(); });
        var config = this.paginationInfo;
        paths.forEach(function (item) {
            if (config && config.hasOwnProperty(item)) {
                config = config[item];
            }
            else {
                config = null;
            }
        });
        return !!config ? config : typeof defaultValue !== 'undefined' ? defaultValue : undefined;
    };
    /**
     * 设置分页信息
     * @param path 路径
     * @param value 值
     */
    EntityCollection.prototype.setPaginationConfigByPath = function (path, value) {
        var original = JSON.stringify(this.paginationInfo);
        if (!path || path === '/') {
            this.paginationInfo = value;
        }
        else {
            if (!Array.isArray(path)) {
                path = path.toString().match(/[^/[\]]+/g) || [];
            }
            path.slice(0, -1).reduce(function (prev, current, index) {
                return Object(prev[current]) === prev[current]
                    ? prev[current]
                    : prev[current] = Math.abs(path[index + 1]) >> 0 === +path[index + 1]
                        ? []
                        : {};
            }, this.paginationInfo)[path[path.length - 1]] = value;
        }
        if (JSON.stringify(this.paginationInfo) !== original) {
            this.notifyCollectionChanged(new Modification(this.paginationInfo, ModifyType.PaginationInfoChange));
        }
        return this.paginationInfo;
    };
    //#endregion
    /**
     * 监听实体变更
     */
    EntityCollection.prototype.listenEntityChangeEvent = function (entity) {
        var _this = this;
        if (entity) {
            entity.onValueChanged.subscribe(function (change) { return _this.changes.next(change); });
        }
    };
    return EntityCollection;
}());
export { EntityCollection };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZW50aXR5X2NvbGxlY3Rpb24uanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL21vYmlsZS1kZXZraXQvIiwic291cmNlcyI6WyJsaWIvcmVwb3NpdG9yeS9lbnRpdHlfY29sbGVjdGlvbi50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBT0EsT0FBTyxFQUFFLFlBQVksRUFBRSxVQUFVLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQztBQUM5RCxPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQy9CLE9BQU8sRUFBRSxNQUFNLEVBQUUsaUJBQWlCLEVBQUUsVUFBVSxFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFHeEUsNkJBQTZCO0FBQzdCOzs7R0FHRztBQUNIO0lBNENFOztPQUVHO0lBQ0gsMEJBQVksVUFBbUI7UUFDN0IsSUFBSSxDQUFDLGNBQWMsR0FBRyxJQUFJLEdBQUcsRUFBSyxDQUFDO1FBQ25DLElBQUksQ0FBQyxjQUFjLEdBQUcsSUFBSSxHQUFHLEVBQWEsQ0FBQztRQUMzQyxJQUFJLENBQUMsaUJBQWlCLEdBQUcsSUFBSSxPQUFPLEVBQWdCLENBQUM7UUFDckQsSUFBSSxDQUFDLE9BQU8sR0FBRyxJQUFJLE9BQU8sRUFBZ0IsQ0FBQztRQUUzQyxJQUFJLENBQUMsVUFBVSxHQUFHLFVBQVUsQ0FBQztRQUM3QixJQUFJLENBQUMsVUFBVSxHQUFHLGlCQUFpQixDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUM7SUFDckUsQ0FBQztJQUVEOztPQUVHO0lBQ0ksZ0NBQUssR0FBWjtRQUNFLE9BQU8sSUFBSSxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUM7SUFDbEMsQ0FBQztJQUVELHNCQUFXLDRDQUFjO2FBQXpCO1lBQ0UsT0FBTyxJQUFJLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQztRQUM5QixDQUFDOzs7T0FBQTtJQUNEOzs7T0FHRztJQUNJLDhCQUFHLEdBQVYsVUFBVyxFQUFVO1FBQ25CLE9BQU8sSUFBSSxD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QUksTUFBTSxFQUFFO1lBQ1YsTUFBTSxDQUFDLGNBQWMsQ0FBQyxTQUFTLENBQUMsVUFBQyxNQUFvQixJQUFLLE9BQUEsS0FBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLEVBQXpCLENBQXlCLENBQUMsQ0FBQztTQUN0RjtJQUNILENBQUM7SUFFSCx1QkFBQztBQUFELENBQUMsQUE3aEJELElBNmhCQztBQUVELE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLypcbiAqIEBBdXRob3I6IFdpdHRcbiAqIEBEYXRlOiAyMDE4LTEwLTAxIDE5OjM2OjUxXG4gKiBATGFzdCBNb2RpZmllZCBieTogYWFsaXp6d2VsbFxuICogQExhc3QgTW9kaWZpZWQgdGltZTogMjAxOS0wOS0wMyAxOTo0Njo0MlxuICovXG5pbXBvcnQgeyBUeXBlIH0gZnJvbSAnLi4vY29yZS9pbmRleCc7XG5pbXBvcnQgeyBNb2RpZmljYXRpb24sIE1vZGlmeVR5cGUgfSBmcm9tICcuLi9jaGFuZ2VzZXQvaW5kZXgnO1xuaW1wb3J0IHsgU3ViamVjdCB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgRW50aXR5LCBGaWVsZE1ldGFkYXRhVXRpbCwgRW50aXR5TGlzdCB9IGZyb20gJy4uL2VudGl0eS9pbmRleCc7XG5pbXBvcnQgeyBEYXRhVHlwZUluZm8gfSBmcm9tICcuLi9lbnRpdHkvaW5kZXgnO1xuXG4vLyB0c2xpbnQ6ZGlzYWJsZTogbm8tYml0d2lzZVxuLyoqXG4gKiDlrp7kvZPpm4blkIhcbiAqIEB0b2Rv77ya5bqU6K+l55SoRW50aXR5TGlzdOS7o+abv+OAglxuICovXG5jbGFzcyBFbnRpdHlDb2xsZWN0aW9uPFQgZXh0ZW5kcyBFbnRpdHk+IHtcblxuICAvKipcbiAgICog5YaF6YOo5a6e5L2TU2V0XG4gICAqL1xuICBwcml2YXRlIGlubmVyRW50aXR5U2V0OiBTZXQ8VD47XG5cbiAgLyoqXG4gICAqIOWGhemDqOWunuS9k01hcFxuICAgKi9cbiAgcHJpdmF0ZSBpbm5lckVudGl0eU1hcDogTWFwPHN0cmluZywgVD47XG5cblxuICAvKipcbiAgICogRW50aXR56ZuG5ZCI5Y+Y5pu05rWBXG4gICAqL1xuICBwdWJsaWMgY29sbGVjdGlvbkNoYW5nZWQ6IFN1YmplY3Q8TW9kaWZpY2F0aW9uPjtcblxuICAvKipcbiAgICog5YaF6YOo5a6e5L2T5Y+Y5pu0XG4gICAqL1xuICBwdWJsaWMgY2hhbmdlczogU3ViamVjdDxNb2RpZmljYXRpb24+O1xuXG4gIC8qKlxuICAgKiDlrp7kvZPnsbvlnotcbiAgICovXG4gIHB1YmxpYyByZWFkb25seSBlbnRpdHlUeXBlOiBUeXBlPFQ+O1xuXG4gIC8qKlxuICAgKiDlrp7kvZPkuLvplK5cbiAgICovXG4gIHB1YmxpYyByZWFkb25seSBwcmltYXJ5S2V5OiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIOWunuS9k+W9k+WJjeWIhumhteS/oeaBr1xuICAgKi9cbiAgcHVibGljIHBhZ2luYXRpb25JbmZvOiBhbnk7XG5cbiAgLyoqXG4gICAqIOWunuS9k+exu+Wei+aPj+i/sFxuICAgKi9cbiAgcHVibGljIGVudGl0eVR5cGVJbmZvOiBEYXRhVHlwZUluZm87XG5cblxuICAvKipcbiAgICog5p6E6YCg5Ye95pWwXG4gICAqL1xuICBjb25zdHJ1Y3RvcihlbnRpdHlUeXBlOiBUeXBlPFQ+KSB7XG4gICAgdGhpcy5pbm5lckVudGl0eVNldCA9IG5ldyBTZXQ8VD4oKTtcbiAgICB0aGlzLmlubmVyRW50aXR5TWFwID0gbmV3IE1hcDxzdHJpbmcsIFQ+KCk7XG4gICAgdGhpcy5jb2xsZWN0aW9uQ2hhbmdlZCA9IG5ldyBTdWJqZWN0PE1vZGlmaWNhdGlvbj4oKTtcbiAgICB0aGlzLmNoYW5nZXMgPSBuZXcgU3ViamVjdDxNb2RpZmljYXRpb24+KCk7XG5cbiAgICB0aGlzLmVudGl0eVR5cGUgPSBlbnRpdHlUeXBlO1xuICAgIHRoaXMucHJpbWFyeUtleSA9IEZpZWxkTWV0YWRhdGFVdGlsLmdldFByaW1hcnlLZXkodGhpcy5lbnRpdHlUeXBlKTtcbiAgfVxuXG4gIC8qKlxuICAgKiDlrp7kvZPmlbDph49cbiAgICovXG4gIHB1YmxpYyBjb3VudCgpOiBudW1iZXIge1xuICAgIHJldHVybiB0aGlzLmlubmVyRW50aXR5U2V0LnNpemU7XG4gIH1cblxuICBwdWJsaWMgZ2V0IGVudGl0eVR5cGVOYW1lKCkge1xuICAgIHJldHVybiB0aGlzLmVudGl0eVR5cGUubmFtZTtcbiAgfVxuICAvKipcbiAgICog5piv5ZCm5YyF5ZCr5oyH5a6a5Li76ZSu5YC855qE5a6e5L2TXG4gICAqIEBwYXJhbSBpZCDkuLvplK7lgLxcbiAgICovXG4gIHB1YmxpYyBoYXMoaWQ6IHN0cmluZyk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLmlubmVyRW50aXR5TWFwLmhhcyhpZCk7XG4gIH1cblxuICAvKipcbiAgICog5riF56m65YWo6YOo5a6e5L2TXG4gICAqL1xuICBwdWJsaWMgY2xlYXIoKSB7XG4gICAgdGhpcy5pbm5lckVudGl0eU1hcC5jbGVhcigpO1xuICAgIHRoaXMuaW5uZXJFbnRpdHlTZXQuY2xlYXIoKTtcbiAgICB0aGlzLm5vdGlmeUNvbGxlY3Rpb25DaGFuZ2VkKG5ldyBNb2RpZmljYXRpb24oW10sIE1vZGlmeVR5cGUuTG9hZCkpO1xuICB9XG4gIC8qKlxuICAgKiDmuIXnqbrlhajpg6jlrp7kvZNcbiAgICogQHBhcmFtIGlzUmVzZXQg5piv5ZCm5Li66YeN572u5a6e5L2T5pON5L2cXG4gICAqL1xuICBwdWJsaWMgcmVzZXQoKSB7XG4gICAgdGhpcy5pbm5lckVudGl0eU1hcC5jbGVhcigpO1xuICAgIHRoaXMuaW5uZXJFbnRpdHlTZXQuY2xlYXIoKTtcbiAgICBjb25zdCBtb2RpZmljYXRpb24gPSBuZXcgTW9kaWZpY2F0aW9uKFtdLCBNb2RpZnlUeXBlLkxvYWQpO1xuICAgIG1vZGlmaWNhdGlvbi5pc1Jlc2V0ID0gdHJ1ZTtcbiAgICB0aGlzLm5vdGlmeUNvbGxlY3Rpb25DaGFuZ2VkKG1vZGlmaWNhdGlvbik7XG4gIH1cbiAgLyoqXG4gICAqIOi9rOaNouS4uuWunuS9k+aVsOe7hFxuICAgKi9cbiAgcHVibGljIHRvQXJyYXkoKTogRW50aXR5W10ge1xuICAgIHJldHVybiBBcnJheS5mcm9tKHRoaXMuaW5uZXJFbnRpdHlTZXQpO1xuICB9XG5cbiAgLyoqXG4gICAqIOi9rOaNouS4ukpTT07mlbDnu4RcbiAgICovXG4gIHB1YmxpYyB0b0pTT04oKTogYW55W10ge1xuICAgIGNvbnN0IHJlc3VsdCA9IFtdO1xuICAgIGNvbnN0IGVudGl0aWVzID0gdGhpcy50b0FycmF5KCk7XG4gICAgZW50aXRpZXMuZm9yRWFjaCgoZW50aXR5OiBFbnRpdHkpID0+IHtcbiAgICAgIHJlc3VsdC5wdXNoKGVudGl0eS50b0pTT04oKSk7XG4gICAgfSk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxuXG4gIC8qKlxuICAgKiDmibnph4/liqDovb3lrp7kvZNcbiAgICovXG4gIHB1YmxpYyBsb2FkRW50aXRpZXMoZW50aXRpZXM6IGFueVtdLCBlbnRpdHlDcmVhdGU6IGJvb2xlYW4gPSBmYWxzZSkge1xuXG4gICAgdGhpcy5pbm5lckVudGl0eU1hcC5jbGVhcigpO1xuICAgIHRoaXMuaW5uZXJFbnRpdHlTZXQuY2xlYXIoKTtcblxuICAgIGVudGl0aWVzLmZvckVhY2goZW50aXR5ID0+IHtcbiAgICAgIHRoaXMuaW5uZXJFbnRpdHlTZXQuYWRkKGVudGl0eSk7XG4gICAgICB0aGlzLmlubmVyRW50aXR5TWFwLnNldChlbnRpdHlbdGhpcy5wcmltYXJ5S2V5XSwgZW50aXR5KTtcbiAgICAgIHRoaXMubGlzdGVuRW50aXR5Q2hhbmdlRXZlbnQoZW50aXR5KTtcbiAgICB9KTtcbiAgICBjb25zdCBtb2RpZmljYXRpb24gPSBuZXcgTW9kaWZpY2F0aW9uKGVudGl0aWVzLCBNb2RpZnlUeXBlLkxvYWQpO1xuICAgIG1vZGlmaWNhdGlvbi5lbnRpdHlDcmVhdGUgPSBlbnRpdHlDcmVhdGU7XG4gICAgdGhpcy5ub3RpZnlDb2xsZWN0aW9uQ2hhbmdlZChtb2RpZmljYXRpb24pO1xuXG4gIH1cblxuICAvKipcbiAgICog6L+95Yqg5a6e5L2TXG4gICAqIEBwYXJhbSBlbnRpdHkg6KaB6L+95Yqg55qE5a6e5L2TXG4gICAqIEBwYXJhbSBpc0Nsb25lZCDlrp7kvZPmmK/lkKbmmK/lhYvpmobnmoRcbiAgICovXG4gIHB1YmxpYyBhZGRFbnRpdHkoZW50aXR5OiBULCAgaXNDbG9uZWQ6IGJvb2xlYW4gPSBmYWxzZSkge1xuICAgIHRoaXMudmVyaWZ5RW50aXR5VG9BZGQoZW50aXR5KTtcbiAgICB0aGlzLmlubmVyRW50aXR5U2V0LmFkZChlbnRpdHkpO1xuICAgIHRoaXMuaW5uZXJFbnRpdHlNYXAuc2V0KGVudGl0eVt0aGlzLnByaW1hcnlLZXldLCBlbnRpdHkpO1xuICAgIHRoaXMubGlzdGVuRW50aXR5Q2hhbmdlRXZlbnQoZW50aXR5KTtcbiAgICBjb25zdCBtb2RpZnlUeXBlID0gaXNDbG9uZWQgPyBNb2RpZnlUeXBlLkNsb25lIDogTW9kaWZ5VHlwZS5BZGQ7XG4gICAgdGhpcy5ub3RpZnlDb2xsZWN0aW9uQ2hhbmdlZChuZXcgTW9kaWZpY2F0aW9uKFtlbnRpdHldLCBtb2RpZnlUeXBlKSk7XG4gIH1cbiAgLyoqXG4gICAqIOWcqOW9k+WJjeihjOWJjeaIluWQjuaPkuWFpeaVsOaNrlxuICAgKiBAcGFyYW0gZW50aXR5IOWunuS9k1xuICAgKiBAcGFyYW0gcG9zaXRpb24g5L2N572uXG4gICAqL1xuICBwdWJsaWMgaW5zZXJ0RW50aXR5KGVudGl0eTogYW55LCBwb3NpdGlvbjogMSB8IC0xKSB7XG4gICAgdGhpcy52ZXJpZnlFbnRpdHlUb0FkZChlbnRpdHkpO1xuICAgIHRoaXMuaW5uZXJFbnRpdHlTZXQuYWRkKGVudGl0eSk7XG4gICAgdGhpcy5pbm5lckVudGl0eU1hcC5zZXQoZW50aXR5W3RoaXMucHJpbWFyeUtleV0sIGVudGl0eSk7XG4gICAgdGhpcy5saXN0ZW5FbnRpdHlDaGFuZ2VFdmVudChlbnRpdHkpO1xuICAgIHRoaXMubm90aWZ5Q29sbGVjdGlvbkNoYW5nZWQobmV3IE1vZGlmaWNhdGlvbihlbnRpdHksIE1vZGlmeVR5cGUuSW5zZXJ0LCBudWxsLCBudWxsLCBwb3NpdGlvbikpO1xuICB9XG4gIC8qKlxuICAgKiDmm7TmlrDlrp7kvZNcbiAgICogQHBhcmFtIGVudGl0eSBlbnRpdHlcbiAgICogQHBhcmFtIGVudGl0eURhdGEg5a6e5L2T5pWw5o2uXG4gICAqL1xuICBwdWJsaWMgdXBkYXRlRW50aXR5KGVudGl0eTogYW55LCBlbnRpdHlEYXRhOiBhbnkpIHtcbiAgICBlbnRpdHkubG9hZChlbnRpdHlEYXRhKTtcbiAgICB0aGlzLm5vdGlmeUNvbGxlY3Rpb25DaGFuZ2VkKG5ldyBNb2RpZmljYXRpb24oZW50aXR5LCBNb2RpZnlUeXBlLlVwZGF0ZSwgbnVsbCwgbnVsbCkpO1xuICB9XG4gIC8qKlxuICAgKiDmibnph4/ov73liqDlrp7kvZNcbiAgICogQHBhcmFtIGVudGl0aWVzIOimgeWKoOi9veeahOWunuS9k+aVsOe7hFxuICAgKi9cbiAgcHVibGljIGFkZEVudGl0aWVzKGVudGl0aWVzOiBUW10pIHtcbiAgICBpZiAoIWVudGl0aWVzKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IGVudGl0aWVzVG9BZGQ6IFRbXSA9IFtdO1xuICAgIGVudGl0aWVzLmZvckVhY2goZW50aXR5ID0+IHtcbiAgICAgIHRoaXMudmVyaWZ5RW50aXR5VG9BZGQoZW50aXR5KTtcbiAgICAgIGVudGl0aWVzVG9BZGQucHVzaChlbnRpdHkpO1xuICAgIH0pO1xuICAgIGVudGl0aWVzVG9BZGQuZm9yRWFjaChlbnRpdHkgPT4ge1xuICAgICAgdGhpcy5pbm5lckVudGl0eVNldC5hZGQoZW50aXR5KTtcbiAgICAgIHRoaXMuaW5uZXJFbnRpdHlNYXAuc2V0KGVudGl0eVt0aGlzLnByaW1hcnlLZXldLCBlbnRpdHkpO1xuICAgICAgdGhpcy5saXN0ZW5FbnRpdHlDaGFuZ2VFdmVudChlbnRpdHkpO1xuICAgIH0pO1xuICAgIHRoaXMubm90aWZ5Q29sbGVjdGlvbkNoYW5nZWQobmV3IE1vZGlmaWNhdGlvbihlbnRpdGllc1RvQWRkLCBNb2RpZnlUeXBlLkFkZCkpO1xuICB9XG4gIC8qKlxuICAgKiDmt7vliqDlrp7kvZPvvIjkuI3liIfmjaLlvZPliY3ooYzvvIlcbiAgICogQHBhcmFtIGVudGl0aWVzIOWunuS9k1xuICAgKi9cbiAgcHVibGljIGFkZERhdGEoZW50aXRpZXM6IGFueVtdKSB7XG4gICAgaWYgKCFlbnRpdGllcykge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zdCBlbnRpdGllc1RvQWRkOiBhbnlbXSA9IFtdO1xuICAgIGVudGl0aWVzLmZvckVhY2goZW50aXR5ID0+IHtcbiAgICAgIHRoaXMudmVyaWZ5RW50aXR5VG9BZGQoZW50aXR5KTtcbiAgICAgIGVudGl0aWVzVG9BZGQucHVzaChlbnRpdHkpO1xuICAgIH0pO1xuICAgIGVudGl0aWVzVG9BZGQuZm9yRWFjaChlbnRpdHkgPT4ge1xuICAgICAgdGhpcy5pbm5lckVudGl0eVNldC5hZGQoZW50aXR5KTtcbiAgICAgIHRoaXMuaW5uZXJFbnRpdHlNYXAuc2V0KGVudGl0eVt0aGlzLnByaW1hcnlLZXldLCBlbnRpdHkpO1xuICAgICAgdGhpcy5saXN0ZW5FbnRpdHlDaGFuZ2VFdmVudChlbnRpdHkpO1xuICAgIH0pO1xuICAgIHRoaXMubm90aWZ5Q29sbGVjdGlvbkNoYW5nZWQobmV3IE1vZGlmaWNhdGlvbihlbnRpdGllc1RvQWRkLCBNb2RpZnlUeXBlLkFkZERhdGEpKTtcbiAgfVxuXG5cbiAgLyoqXG4gICAqIOagueaNruS4u+mUruWAvOiOt+WPluWunuS9k1xuICAgKi9cbiAgZ2V0RW50aXR5QnlJZChpZGVudGl0eTogc3RyaW5nKTogVCB7XG4gICAgaWYgKHRoaXMuaW5uZXJFbnRpdHlNYXAuaGFzKGlkZW50aXR5KSA9PT0gZmFsc2UpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICBjb25zdCBlbnRpdHkgPSB0aGlzLmlubmVyRW50aXR5TWFwLmdldChpZGVudGl0eSk7XG4gICAgcmV0dXJuIGVudGl0eTtcbiAgfVxuXG4gIC8qKlxuICAgKiDmoLnmja7ot6/lvoTojrflj5blrp7kvZNcbiAgICovXG4gIGdldEVudGl0eUJ5UGF0aChwYXRoQXJyYXk6IHN0cmluZ1tdKTogYW55IHtcbiAgICBjb25zdCByb290RW50aXR5SWQgPSBwYXRoQXJyYXlbMF0uc3BsaXQoJzonKVsxXTtcblxuICAgIGxldCBwYXJlbnROb2RlOiBhbnkgPSB0aGlzLmdldEVudGl0eUJ5SWQocm9vdEVudGl0eUlkKTtcbiAgICBmb3IgKGxldCBpID0gMTsgaSA8IHBhdGhBcnJheS5sZW5ndGggJiYgcGFyZW50Tm9kZTsgaSA9IGkgKyAxKSB7XG4gICAgICBjb25zdCBjdXJyZW50UGF0aCA9IHBhdGhBcnJheVtpXTtcbiAgICAgIGlmIChwYXJlbnROb2RlIGluc3RhbmNlb2YgRW50aXR5KSB7XG5cbiAgICAgICAgLy8gQHRvZG/vvJrlvLror4bkuobliKvlhpLlj7dcbiAgICAgICAgaWYgKGN1cnJlbnRQYXRoLmluZGV4T2YoJzonKSA9PT0gLTEpIHtcbiAgICAgICAgICBwYXJlbnROb2RlID0gcGFyZW50Tm9kZVtwYXRoQXJyYXlbaV1dO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBwYXJlbnROb2RlID0gcGFyZW50Tm9kZS5nZXQocGF0aEFycmF5W2ldLnNwbGl0KCc6JylbMV0pO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBwYXJlbnROb2RlO1xuICB9XG4gIC8qKlxuICAgKiBpZDoxL2EvaWQ6Mi9jXG4gICAqIEBwYXJhbSBwYXRoQXJyYXkg6Lev5b6E5pWw57uEXG4gICAqL1xuICBwdWJsaWMgZ2V0RW50aXRpZXNCeVBhdGgocGF0aEFycmF5OiBzdHJpbmdbXSkge1xuICAgIGNvbnN0IHJvb3RFbnRpdHlJZCA9IHBhdGhBcnJheVswXS5zcGxpdCgnOicpWzFdO1xuICAgIGxldCBlbnRpdHk6IGFueSA9IHRoaXMuZ2V0RW50aXR5QnlJZChyb290RW50aXR5SWQpO1xuICAgIGZvciAobGV0IGkgPSAxOyBpIDwgcGF0aEFycmF5Lmxlbmd0aCAmJiBlbnRpdHk7IGkgKz0gMikge1xuICAgICAgY29uc3QgcGF0aCA9IHBhdGhBcnJheVtpXTtcbiAgICAgIGVudGl0eSA9IGVudGl0eVtwYXRoXTtcbiAgICAgIGlmICghKGVudGl0eSBpbnN0YW5jZW9mIEVudGl0eUxpc3QpKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcign6Lev5b6E5qC85byP6ZSZ6K+vJyk7XG4gICAgICB9XG4gICAgICBpZiAoKGkgKyAxKSA8IHBhdGhBcnJheS5sZW5ndGgpIHtcbiAgICAgICAgY29uc3QgaWQgPSBwYXRoQXJyYXlbaSArIDFdLnNwbGl0KCc6JylbMV07XG4gICAgICAgIGVudGl0eSA9IGVudGl0eS5nZXQoaWQpO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gZW50aXR5O1xuICB9XG4gIC8qKlxuICAgKiDov5Tlm57nrKblkIjmjIflrprmnaHku7bnmoTlrp7kvZPpm4blkIhcbiAgICogQHBhcmFtIHByZWRpY2F0ZSDmnaHku7bosJPor41cbiAgICovXG4gIGdldEVudGl0aWVzKHByZWRpY2F0ZTogKHZhbHVlOiBULCBpbmRleDogbnVtYmVyLCBhcnJheTogVFtdKSA9PiBUKTogVFtdIHtcbiAgICBjb25zdCBlbnRpdGllczogVFtdID0gQXJyYXkuZnJvbSh0aGlzLmlubmVyRW50aXR5U2V0KTtcbiAgICBjb25zdCBtYXRjaGVkRW50aXRpZXMgPSBlbnRpdGllcy5maWx0ZXIocHJlZGljYXRlKTtcbiAgICByZXR1cm4gbWF0Y2hlZEVudGl0aWVzO1xuICB9XG5cbiAgLyoqXG4gICAqIOiOt+WPluWFqOmDqOWunuS9k1xuICAgKi9cbiAgZ2V0QWxsRW50aXRpZXMoKTogVFtdIHtcbiAgICByZXR1cm4gQXJyYXkuZnJvbSh0aGlzLmlubmVyRW50aXR5U2V0KTtcbiAgfVxuXG4gIC8qKlxuICAgKiDmoLnmja7kuLvplK7lgLzliKDpmaTlr7nlupTlrp7kvZNcbiAgICogQHBhcmFtIGlkZW50aXR5IOS4u+mUruWAvFxuICAgKi9cbiAgcmVtb3ZlRW50aXR5QnlJZChpZGVudGl0eTogc3RyaW5nKTogVCB7XG4gICAgdGhpcy52ZXJpZnlFbnRpdHlUb1JlbW92ZShpZGVudGl0eSk7XG4gICAgY29uc3QgZW50aXR5VG9SZW1vdmUgPSB0aGlzLmlubmVyRW50aXR5TWFwLmdldChpZGVudGl0eSk7XG4gICAgdGhpcy5pbm5lckVudGl0eU1hcC5kZWxldGUoaWRlbnRpdHkpO1xuICAgIHRoaXMuaW5uZXJFbnRpdHlTZXQuZGVsZXRlKGVudGl0eVRvUmVtb3ZlKTtcbiAgICB0aGlzLm5vdGlmeUNvbGxlY3Rpb25DaGFuZ2VkKG5ldyBNb2RpZmljYXRpb24oW2VudGl0eVRvUmVtb3ZlXSwgTW9kaWZ5VHlwZS5SZW1vdmUpKTtcbiAgICByZXR1cm4gZW50aXR5VG9SZW1vdmU7XG4gIH1cblxuICByZW1vdmVFbnRpdGllc0J5SWRzKGlkOiBzdHJpbmcpIHtcbiAgfVxuXG4gIC8qKlxuICAgKiDliKDpmaTnrKblkIjmnaHku7bnmoTlrp7kvZPpm4blkIhcbiAgICovXG4gIHB1YmxpYyByZW1vdmVFbnRpdGllcyhwcmVkaWNhdGU6ICh2YWx1ZTogVCwgaW5kZXg6IG51bWJlciwgYXJyYXk6IFRbXSkgPT4gYW55KTogVFtdIHtcbiAgICBjb25zdCBlbnRpdGllc1RvUmVtb3ZlID0gQXJyYXkuZnJvbSh0aGlzLmlubmVyRW50aXR5U2V0KS5maWx0ZXIocHJlZGljYXRlKTtcbiAgICBlbnRpdGllc1RvUmVtb3ZlLmZvckVhY2goZW50aXR5VG9SZW1vdmUgPT4ge1xuICAgICAgdGhpcy5pbm5lckVudGl0eU1hcC5kZWxldGUoZW50aXR5VG9SZW1vdmVbdGhpcy5wcmltYXJ5S2V5XSk7XG4gICAgICB0aGlzLmlubmVyRW50aXR5U2V0LmRlbGV0ZShlbnRpdHlUb1JlbW92ZSk7XG4gICAgfSk7XG4gICAgdGhpcy5ub3RpZnlDb2xsZWN0aW9uQ2hhbmdlZChuZXcgTW9kaWZpY2F0aW9uKGVudGl0aWVzVG9SZW1vdmUsIE1vZGlmeVR5cGUuUmVtb3ZlKSk7XG4gICAgcmV0dXJuIGVudGl0aWVzVG9SZW1vdmU7XG4gIH1cbiAgLyoqXG4gICAqIOenu+mZpOaVsOaNru+8iOS4jeWIh+aNouW9k+WJjeihjO+8iVxuICAgKiBAcGFyYW0gcHJlZGljYXRlIOi/h+a7pOWHveaVsFxuICAgKi9cbiAgcHVibGljIHJlbW92ZURhdGEocHJlZGljYXRlOiAodmFsdWU6IGFueSwgaW5kZXg6IG51bWJlciwgYXJyYXk6IGFueVtdKSA9PiBhbnkpOiBhbnlbXSB7XG4gICAgY29uc3QgZW50aXRpZXNUb1JlbW92ZSA9IEFycmF5LmZyb20odGhpcy5pbm5lckVudGl0eVNldCkuZmlsdGVyKHByZWRpY2F0ZSk7XG4gICAgZW50aXRpZXNUb1JlbW92ZS5mb3JFYWNoKGVudGl0eVRvUmVtb3ZlID0+IHtcbiAgICAgIHRoaXMuaW5uZXJFbnRpdHlNYXAuZGVsZXRlKGVudGl0eVRvUmVtb3ZlW3RoaXMucHJpbWFyeUtleV0pO1xuICAgICAgdGhpcy5pbm5lckVudGl0eVNldC5kZWxldGUoZW50aXR5VG9SZW1vdmUpO1xuICAgIH0pO1xuICAgIHRoaXMubm90aWZ5Q29sbGVjdGlvbkNoYW5nZWQobmV3IE1vZGlmaWNhdGlvbihlbnRpdGllc1RvUmVtb3ZlLCBNb2RpZnlUeXBlLlJlbW92ZURhdGEpKTtcbiAgICByZXR1cm4gZW50aXRpZXNUb1JlbW92ZTtcbiAgfVxuICAvKipcbiAgICog6YeN572u5a2Q6KGo5pWw5o2uXG4gICAqIEBwYXJhbSBwYXRocyDot6/lvoRcbiAgICog6Lev5b6E5qC85byPIFsnaWQ6cHJvdmluY2VJZCcsJ2lkOmNpdHlNRE1zJywnem9uZU1ETXMnXVxuICAgKiBAZGVzY3JpcHRpb24gcGF0aOWPguaVsOagvOW8j1xuICAgKiBgYGBqc29uXG4gICAqIFtcbiAgICogXCJpZDpiNWVkMjNjYS04OGQ5LTQzNzctOThlYy05MmYzNWMxMzI1ZjFcIixcbiAgICogXCJjaXR5TURNc1wiLFxuICAgKiBcImlkOjM3MzcwNmFmLTYyMmYtNGFlYS1hMDA2LWRkZGJmZmQ3YmRhM1wiLFxuICAgKiBcInpvbmVNRE1zXCJcbiAgICogXVxuICAgKiBgYGBcbiAgICogQHBhcmFtIGVudGl0aWVzIOWunuS9k+aVsOe7hFxuICAgKi9cbiAgcHVibGljIHJlc2V0RW50aXRpZXMocGF0aHM6IHN0cmluZ1tdLCBlbnRpdGllczogVFtdKSB7XG4gICAgaWYgKHBhdGhzWzBdLmluZGV4T2YoJzonKSA9PT0gLTEpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcign6Lev5b6E5qC85byP6ZSZ6K+vJyk7XG4gICAgfVxuICAgIC8vIHBhdGhz6YeM6Z2i56ys5LiA5Liq5LiA5a6a5pivaWRcbiAgICBjb25zdCBlbnRpdHlJbmZvOiBzdHJpbmdbXSA9IHBhdGhzWzBdLnNwbGl0KCc6Jyk7XG4gICAgY29uc3QgW2VudGl0eVByaW1hcnlLZXksIGVudGl0eUlkXSA9IGVudGl0eUluZm87XG4gICAgbGV0IGVudGl0eTogVCA9IG51bGw7XG4gICAgZm9yIChjb25zdCBlbGVtZW50IG9mIHRoaXMuaW5uZXJFbnRpdHlTZXQpIHtcbiAgICAgIGlmIChlbGVtZW50W2VudGl0eVByaW1hcnlLZXldID09PSBlbnRpdHlJZCkge1xuICAgICAgICBlbnRpdHkgPSBlbGVtZW50O1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICB9XG4gICAgLy8gZm9yIChsZXQgaW5kZXggPSAwOyBpbmRleCA8IHRoaXMuaW5uZXJFbnRpdHlTZXQ7IGluZGV4KyspIHtcbiAgICAvLyAgIGNvbnN0IGVsZW1lbnQ6IFQgPSB0aGlzLmlubmVyRW50aXR5U2V0W2luZGV4XTtcbiAgICAvLyAgIGlmIChlbGVtZW50W2VudGl0eVByaW1hcnlLZXldID09PSBlbnRpdHlJZCkge1xuICAgIC8vICAgICBlbnRpdHkgPSBlbGVtZW50O1xuICAgIC8vICAgICBicmVhaztcbiAgICAvLyAgIH1cbiAgICAvLyB9XG4gICAgaWYgKCFlbnRpdHkpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihg5om+5LiN5YiwJHtlbnRpdHlQcmltYXJ5S2V5feS4uiR7ZW50aXR5SWR955qE5a6e5L2TYCk7XG4gICAgfVxuICAgIGxldCBkYXRhOiBhbnkgPSBlbnRpdHk7XG4gICAgcGF0aHMuc2xpY2UoMSkuZm9yRWFjaChwYXRoID0+IHtcbiAgICAgIGRhdGEgPSBkYXRhW3BhdGhdO1xuICAgIH0pO1xuICAgIGNvbnN0IGVudGl0eUxpc3QgPSBkYXRhIGFzIEVudGl0eUxpc3Q8VD47XG4gICAgZW50aXR5TGlzdC5jbGVhcigpO1xuICAgIGVudGl0eUxpc3QubG9hZEVudGl0aWVzKGVudGl0aWVzKTtcbiAgfVxuXG4gIC8qKlxuICAgKiDpqozor4Hlrp7kvZPmmK/lkKbog73lpJ/mt7vliqBcbiAgICovXG4gIHByaXZhdGUgdmVyaWZ5RW50aXR5VG9BZGQoZW50aXR5OiBUKTogYm9vbGVhbiB7XG4gICAgaWYgKHRoaXMuaGFzKGVudGl0eVt0aGlzLnByaW1hcnlLZXldKSkge1xuICAgICAgdGhpcy5pbm5lckVudGl0eVNldC5kZWxldGUodGhpcy5pbm5lckVudGl0eU1hcC5nZXQoZW50aXR5W3RoaXMucHJpbWFyeUtleV0pKTtcbiAgICAgIHRoaXMuaW5uZXJFbnRpdHlNYXAuZGVsZXRlKGVudGl0eVt0aGlzLnByaW1hcnlLZXldKTtcbiAgICAgIC8vIHRocm93IG5ldyBFcnJvcihgVGhlIHJlcG9zaXRvcnkgYWxyZWFkeSBoYWQgYW4gaXRlbSB3aXRoIHRoZSBzYXZlIGlkZW50aXR5IG9mICcke2VudGl0eVt0aGlzLnByaW1hcnlLZXldfSdgKTtcbiAgICB9XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICAvKipcbiAgICog6aqM6K+B5a6e5L2T5piv5ZCm6IO956e76ZmkXG4gICAqL1xuICBwcml2YXRlIHZlcmlmeUVudGl0eVRvUmVtb3ZlKGlkZW50aXR5OiBzdHJpbmcpOiBib29sZWFuIHtcbiAgICBpZiAoIXRoaXMuaGFzKGlkZW50aXR5KSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBUaGUgZW50aXR5IHdpdGggaWRlbnRpdHkgb2YgJyR7aWRlbnRpdHl9IGRvc2Ugbm90IGV4c2l0LidgKTtcbiAgICB9XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICAvKipcbiAgICog5a6e5L2T6ZuG5ZCI5Y+Y5pu05rWBXG4gICAqL1xuICBwcml2YXRlIG5vdGlmeUNvbGxlY3Rpb25DaGFuZ2VkKG1vZGlmaWNhdGlvbjogTW9kaWZpY2F0aW9uKSB7XG4gICAgdGhpcy5jb2xsZWN0aW9uQ2hhbmdlZC5uZXh0KG1vZGlmaWNhdGlvbik7XG4gIH1cblxuICAvLyNyZWdpb24g5YiG6aG1XG5cbiAgLyoqXG4gICAqIOiuvue9ruWIhumhteWkp+Wwj1xuICAgKi9cbiAgc2V0IHBhZ2VTaXplKHBhZ2VTaXplOiBudW1iZXIpIHtcbiAgICBpZiAodHlwZW9mIChwYWdlU2l6ZSkgIT09ICdudW1iZXInIHx8IHBhZ2VTaXplIDwgMCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdJbnZhbGlkIHBhcmFtZXRlcjpwYWdlU2l6ZScpO1xuICAgIH1cblxuICAgIGNvbnN0IG9yaWdpbmFsID0gdGhpcy5wYWdpbmF0aW9uSW5mbztcbiAgICAvLyBjb25zdCBlbnRpdHlQYWdpbmF0aW9uSW5mbyA9IE9iamVjdC5hc3NpZ24oe30sIG9yaWdpbmFsW3RoaXMuZW50aXR5VHlwZU5hbWVdLCB7IHBhZ2VTaXplIH0pO1xuICAgIC8vIHRoaXMucGFnaW5hdGlvbkluZm8gPSBPYmplY3QuYXNzaWduKHt9LCBvcmlnaW5hbCwgeyBbdGhpcy5lbnRpdHlUeXBlTmFtZV06IGVudGl0eVBhZ2luYXRpb25JbmZvIH0pO1xuICAgIC8vIHRoaXMubm90aWZ5Q29sbGVjdGlvbkNoYW5nZWQobmV3IE1vZGlmaWNhdGlvbih0aGlzLnBhZ2luYXRpb25JbmZvW3RoaXMuZW50aXR5VHlwZU5hbWVdLCBNb2RpZnlUeXBlLlBhZ2luYXRpb25JbmZvQ2hhbmdlKSk7XG4gICAgdGhpcy5wYWdpbmF0aW9uSW5mbyA9IE9iamVjdC5hc3NpZ24oe30sIG9yaWdpbmFsLCB7IHBhZ2VTaXplIH0pO1xuICAgIHRoaXMubm90aWZ5Q29sbGVjdGlvbkNoYW5nZWQobmV3IE1vZGlmaWNhdGlvbih0aGlzLnBhZ2luYXRpb25JbmZvLCBNb2RpZnlUeXBlLlBhZ2luYXRpb25JbmZvQ2hhbmdlKSk7XG4gIH1cbiAgLyoqXG4gICAqIOiOt+WPluWIhumhteWkp+Wwj1xuICAgKiBAZGVzY3JpcHRpb24g5aaC5p6c55So5oi35pyq5oyH5a6a5YiG6aG15aSn5bCP5YiZ6buY6K6k5Li6MO+8jOWNs+iOt+WPluaJgOacieaVsOaNrlxuICAgKi9cbiAgZ2V0IHBhZ2VTaXplKCk6IG51bWJlciB7XG4gICAgaWYgKCEhdGhpcy5wYWdpbmF0aW9uSW5mbykge1xuICAgICAgcmV0dXJuIHRoaXMucGFnaW5hdGlvbkluZm8ucGFnZVNpemUgfHwgMDtcbiAgICB9XG4gICAgcmV0dXJuIDA7XG4gIH1cbiAgLyoqXG4gICAqIOiuvue9ruaVsOaNruaAu+adoeaVsFxuICAgKi9cbiAgc2V0IHRvdGFsQ291bnQodG90YWw6IG51bWJlcikge1xuICAgIGlmICh0eXBlb2YgKHRvdGFsKSAhPT0gJ251bWJlcicgfHwgdG90YWwgPCAwKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ludmFsaWQgcGFyYW1ldGVyOnRvdGFsJyk7XG4gICAgfVxuXG4gICAgY29uc3Qgb3JpZ2luYWwgPSB0aGlzLnBhZ2luYXRpb25JbmZvO1xuICAgIC8vIGNvbnN0IGVudGl0eVBhZ2luYXRpb25JbmZvID0gT2JqZWN0LmFzc2lnbih7fSwgb3JpZ2luYWxbdGhpcy5lbnRpdHlUeXBlTmFtZV0sIHsgdG90YWwgfSk7XG4gICAgLy8gdGhpcy5wYWdpbmF0aW9uSW5mbyA9IE9iamVjdC5hc3NpZ24oe30sIG9yaWdpbmFsLCB7IFt0aGlzLmVudGl0eVR5cGVOYW1lXTogZW50aXR5UGFnaW5hdGlvbkluZm8gfSk7XG4gICAgdGhpcy5wYWdpbmF0aW9uSW5mbyA9IE9iamVjdC5hc3NpZ24oe30sIG9yaWdpbmFsLCB7IHRvdGFsIH0pO1xuICAgIHRoaXMubm90aWZ5Q29sbGVjdGlvbkNoYW5nZWQobmV3IE1vZGlmaWNhdGlvbih0aGlzLnBhZ2luYXRpb25JbmZvLCBNb2RpZnlUeXBlLlBhZ2luYXRpb25JbmZvQ2hhbmdlKSk7XG4gIH1cbiAgLyoqXG4gICAqIOiOt+WPluaVsOaNruaAu+adoeaVsFxuICAgKi9cbiAgZ2V0IHRvdGFsQ291bnQoKTogbnVtYmVyIHtcbiAgICBpZiAoISF0aGlzLnBhZ2luYXRpb25JbmZvKSB7XG4gICAgICByZXR1cm4gdGhpcy5wYWdpbmF0aW9uSW5mby50b3RhbCB8fCAwO1xuICAgIH1cbiAgICByZXR1cm4gMDtcbiAgfVxuICAvKipcbiAgICog6K6+572u5b2T5YmN6aG156CBXG4gICAqL1xuICBzZXQgcGFnZUluZGV4KHBhZ2VJbmRleDogbnVtYmVyKSB7XG4gICAgaWYgKHR5cGVvZiAocGFnZUluZGV4KSAhPT0gJ251bWJlcicgfHwgcGFnZUluZGV4IDwgMCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdJbnZhbGlkIHBhcmFtZXRlcjpwYWdlSW5kZXgnKTtcbiAgICB9XG5cbiAgICBjb25zdCBvcmlnaW5hbCA9IHRoaXMucGFnaW5hdGlvbkluZm87XG4gICAgLy8gY29uc3QgZW50aXR5UGFnaW5hdGlvbkluZm8gPSBPYmplY3QuYXNzaWduKHt9LCBvcmlnaW5hbFt0aGlzLmVudGl0eVR5cGVOYW1lXSwgeyBwYWdlSW5kZXggfSk7XG4gICAgLy8gdGhpcy5wYWdpbmF0aW9uSW5mbyA9IE9iamVjdC5hc3NpZ24oe30sIG9yaWdpbmFsLCB7IFt0aGlzLmVudGl0eVR5cGVOYW1lXTogZW50aXR5UGFnaW5hdGlvbkluZm8gfSk7XG4gICAgdGhpcy5wYWdpbmF0aW9uSW5mbyA9IE9iamVjdC5hc3NpZ24oe30sIG9yaWdpbmFsLCB7IHBhZ2VJbmRleCB9KTtcbiAgICB0aGlzLm5vdGlmeUNvbGxlY3Rpb25DaGFuZ2VkKG5ldyBNb2RpZmljYXRpb24odGhpcy5wYWdpbmF0aW9uSW5mbywgTW9kaWZ5VHlwZS5QYWdpbmF0aW9uSW5mb0NoYW5nZSkpO1xuICB9XG4gIC8qKlxuICAgKiDojrflj5blvZPliY3pobXnoIFcbiAgICovXG4gIGdldCBwYWdlSW5kZXgoKTogbnVtYmVyIHtcbiAgICBpZiAoISF0aGlzLnBhZ2luYXRpb25JbmZvKSB7XG4gICAgICByZXR1cm4gdGhpcy5wYWdpbmF0aW9uSW5mby5wYWdlSW5kZXggfHwgMTtcbiAgICB9XG4gICAgcmV0dXJuIDE7XG4gIH1cbiAgLyoqXG4gICAqIOabtOaWsOWIhumhteS/oeaBr1xuICAgKiBAcGFyYW0gcGF0aCDnu5Hlrprot6/lvoRcbiAgICogQHBhcmFtIHBhZ2VJbmZvIOWIhumhteS/oeaBr1xuICAgKi9cbiAgcHVibGljIHVwZGF0ZVBhZ2luYXRpb25JbmZvQnlQYXRoKHBhdGg6IHN0cmluZywgcGFnZUluZm86IHsgcGFnZUluZGV4OiBhbnksIHBhZ2VTaXplOiBhbnksIHRvdGFsQ291bnQ6IGFueSwgW3Byb3A6IHN0cmluZ106IGFueSB9KSB7XG4gICAgY29uc3Qgb3JpZ2luYWwgPSB0aGlzLnBhZ2luYXRpb25JbmZvO1xuICAgIGNvbnN0IHsgcGFnZUluZGV4LCBwYWdlU2l6ZSwgdG90YWxDb3VudDogdG90YWwgfSA9IHBhZ2VJbmZvO1xuICAgIGNvbnN0IHBhZ2luYXRpb25JbmZvID0gT2JqZWN0LmFzc2lnbih7fSwgb3JpZ2luYWwsIHsgcGFnZUluZGV4LCBwYWdlU2l6ZSwgdG90YWwgfSk7XG4gICAgdGhpcy5zZXRQYWdpbmF0aW9uQ29uZmlnQnlQYXRoKHBhdGgsIHBhZ2luYXRpb25JbmZvKTtcbiAgfVxuICAvKipcbiAgICog5qC55o2u6Lev5b6E6I635Y+W5YiG6aG15aSn5bCPXG4gICAqIEBwYXJhbSBwYXRoIOi3r+W+hFxuICAgKi9cbiAgcHVibGljIGdldFBhZ2luYXRpb25Db25maWdCeVBhdGgocGF0aDogc3RyaW5nLCBkZWZhdWx0VmFsdWU/OiBhbnkpIHtcbiAgICBpZiAoIXBhdGggfHwgcGF0aCA9PT0gJy8nKSB7XG4gICAgICByZXR1cm4gdGhpcy5wYWdpbmF0aW9uSW5mbztcbiAgICB9XG4gICAgaWYgKHR5cGVvZiBwYXRoICE9PSAnc3RyaW5nJykge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCfot6/lvoTlv4XpobvkuLrlrZfnrKbkuLLvvIEnKTtcbiAgICB9XG4gICAgcGF0aCA9IHBhdGguc3Vic3RyaW5nKDEpO1xuICAgIGNvbnN0IHBhdGhzID0gcGF0aC5zcGxpdCgnLycpLmZpbHRlcihpdGVtID0+ICEhaXRlbSAmJiBpdGVtLnRyaW0oKS5sZW5ndGggPiAwKS5tYXAoaXRlbSA9PiBpdGVtLnRyaW0oKSk7XG4gICAgbGV0IGNvbmZpZyA9IHRoaXMucGFnaW5hdGlvbkluZm87XG4gICAgcGF0aHMuZm9yRWFjaChpdGVtID0+IHtcbiAgICAgIGlmIChjb25maWcgJiYgY29uZmlnLmhhc093blByb3BlcnR5KGl0ZW0pKSB7XG4gICAgICAgIGNvbmZpZyA9IGNvbmZpZ1tpdGVtXTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbmZpZyA9IG51bGw7XG4gICAgICB9XG4gICAgfSk7XG4gICAgcmV0dXJuICEhY29uZmlnID8gY29uZmlnIDogdHlwZW9mIGRlZmF1bHRWYWx1ZSAhPT0gJ3VuZGVmaW5lZCcgPyBkZWZhdWx0VmFsdWUgOiB1bmRlZmluZWQ7XG4gIH1cbiAgLyoqXG4gICAqIOiuvue9ruWIhumhteS/oeaBr1xuICAgKiBAcGFyYW0gcGF0aCDot6/lvoRcbiAgICogQHBhcmFtIHZhbHVlIOWAvFxuICAgKi9cbiAgcHVibGljIHNldFBhZ2luYXRpb25Db25maWdCeVBhdGgocGF0aDogc3RyaW5nIHwgQXJyYXk8YW55PiwgdmFsdWU6IGFueSkge1xuICAgIGNvbnN0IG9yaWdpbmFsID0gSlNPTi5zdHJpbmdpZnkodGhpcy5wYWdpbmF0aW9uSW5mbyk7XG4gICAgaWYgKCFwYXRoIHx8IHBhdGggPT09ICcvJykge1xuICAgICAgdGhpcy5wYWdpbmF0aW9uSW5mbyA9IHZhbHVlO1xuICAgIH0gZWxzZSB7XG4gICAgICBpZiAoIUFycmF5LmlzQXJyYXkocGF0aCkpIHtcbiAgICAgICAgcGF0aCA9IHBhdGgudG9TdHJpbmcoKS5tYXRjaCgvW14vW1xcXV0rL2cpIHx8IFtdO1xuICAgICAgfVxuICAgICAgcGF0aC5zbGljZSgwLCAtMSkucmVkdWNlKChwcmV2LCBjdXJyZW50LCBpbmRleCkgPT5cbiAgICAgICAgT2JqZWN0KHByZXZbY3VycmVudF0pID09PSBwcmV2W2N1cnJlbnRdXG4gICAgICAgICAgPyBwcmV2W2N1cnJlbnRdXG4gICAgICAgICAgOiBwcmV2W2N1cnJlbnRdID0gTWF0aC5hYnMocGF0aFtpbmRleCArIDFdKSA+PiAwID09PSArcGF0aFtpbmRleCArIDFdXG4gICAgICAgICAgICA/IFtdXG4gICAgICAgICAgICA6IHt9LFxuICAgICAgICB0aGlzLnBhZ2luYXRpb25JbmZvKVtwYXRoW3BhdGgubGVuZ3RoIC0gMV1dID0gdmFsdWU7XG4gICAgfVxuXG4gICAgaWYgKEpTT04uc3RyaW5naWZ5KHRoaXMucGFnaW5hdGlvbkluZm8pICE9PSBvcmlnaW5hbCkge1xuICAgICAgdGhpcy5ub3RpZnlDb2xsZWN0aW9uQ2hhbmdlZChuZXcgTW9kaWZpY2F0aW9uKHRoaXMucGFnaW5hdGlvbkluZm8sIE1vZGlmeVR5cGUuUGFnaW5hdGlvbkluZm9DaGFuZ2UpKTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMucGFnaW5hdGlvbkluZm87XG4gIH1cbiAgLy8jZW5kcmVnaW9uXG5cbiAgLyoqXG4gICAqIOebkeWQrOWunuS9k+WPmOabtFxuICAgKi9cbiAgcHJpdmF0ZSBsaXN0ZW5FbnRpdHlDaGFuZ2VFdmVudChlbnRpdHk6IEVudGl0eSkge1xuICAgIGlmIChlbnRpdHkpIHtcbiAgICAgIGVudGl0eS5vblZhbHVlQ2hhbmdlZC5zdWJzY3JpYmUoKGNoYW5nZTogTW9kaWZpY2F0aW9uKSA9PiB0aGlzLmNoYW5nZXMubmV4dChjaGFuZ2UpKTtcbiAgICB9XG4gIH1cblxufVxuXG5leHBvcnQgeyBFbnRpdHlDb2xsZWN0aW9uIH07XG4iXX0=
import { Expression } from '../expression/index';
import { NAMESPACE } from '../core/index';
import { EffectUtil } from './util';
var ValidateEffector = /** @class */ (function () {
    function ValidateEffector(viewModelContext) {
        this.viewModelContext = viewModelContext;
        this.ns = this.viewModelContext.injector.get(NAMESPACE, '');
    }
    ValidateEffector.prototype.effect = function (path, value, options) {
        //根据路径寻找字段
        var viewModelContext;
        if (options.viewModelId) {
            viewModelContext = this.viewModelContext.appContext.viewModelContextManager.getContextById(options.viewModelId);
        }
        else {
            return;
        }
        if (!viewModelContext)
            return;
        if (!viewModelContext.form)
            return;
        var formControl = EffectUtil.getFormValueByPath(path, viewModelContext);
        var form_name = formControl.form_name;
        if (!form_name) {
            return;
        }
        // 只认false  为flase认为验证不过
        if (value === false && options.eventType !== Expression.EventType.Append && options.eventType !== Expression.EventType.Load) {
            form_name.validationResult = { passing: !value, message: options.message };
        }
        else if (value === true) {
            form_name.validationResult = { passing: true, message: '' };
        }
        var validators = [{ "type": "expression", "constraints": [options.expressionId], message: options.message }];
        viewModelContext.form.addValidate(formControl.bindingPath, formControl.name);
        form_name.pushValidatorFnforValidate(validators, true);
    };
    return ValidateEffector;
}());
export { ValidateEffector };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZWZmZWN0b3JfdmFsaWRhdGUuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL21vYmlsZS1kZXZraXQvIiwic291cmNlcyI6WyJsaWIvZXhwcmVzc2lvbi9lZmZlY3Rvci9lZmZlY3Rvcl92YWxpZGF0ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFFakQsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUUxQyxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sUUFBUSxDQUFDO0FBRXBDO0lBR0ksMEJBQW9CLGdCQUFrQztRQUFsQyxxQkFBZ0IsR0FBaEIsZ0JBQWdCLENBQWtCO1FBQ2xELElBQUksQ0FBQyxFQUFFLEdBQUcsSUFBSSxDQUFDLGdCQUFnQixDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsU0FBUyxFQUFFLEVBQUUsQ0FBQyxDQUFDO0lBQ2hFLENBQUM7SUFDTSxpQ0FBTSxHQUFiLFVBQWMsSUFBWSxFQUFFLEtBQVUsRUFBRSxPQUFpQztRQUNyRSxVQUFVO1FBQ1YsSUFBSSxnQkFBa0MsQ0FBQztRQUN2QyxJQUFJLE9BQU8sQ0FBQyxXQUFXLEVBQUU7WUFDckIsZ0JBQWdCLEdBQUcsSUFBSSxDQUFDLGdCQUFnQixDQUFDLFVBQVUsQ0FBQyx1QkFBdUIsQ0FBQyxjQUFjLENBQUMsT0FBTyxDQUFDLFdBQVcsQ0FBQyxDQUFBO1NBQ2xIO2FBQU07WUFDSCxPQUFNO1NBQ1Q7UUFDRCxJQUFJLENBQUMsZ0JBQWdCO1lBQUUsT0FBTztRQUM5QixJQUFJLENBQUMsZ0JBQWdCLENBQUMsSUFBSTtZQUFFLE9BQU87UUFDbkMsSUFBTSxXQUFXLEdBQUcsVUFBVSxDQUFDLGtCQUFrQixDQUFDLElBQUksRUFBRSxnQkFBZ0IsQ0FBQyxDQUFDO1FBQzFFLElBQU0sU0FBUyxHQUFHLFdBQVcsQ0FBQyxTQUF3QixDQUFDO1FBQ3ZELElBQUksQ0FBQyxTQUFTLEVBQUU7WUFDWixPQUFNO1NBQ1Q7UUFDRCx3QkFBd0I7UUFDeEIsSUFBSSxLQUFLLEtBQUssS0FBSyxJQUFJLE9BQU8sQ0FBQyxTQUFTLEtBQUssVUFBVSxDQUFDLFNBQVMsQ0FBQyxNQUFNLElBQUksT0FBTyxDQUFDLFNBQVMsS0FBSyxVQUFVLENBQUMsU0FBUyxDQUFDLElBQUksRUFBRTtZQUN6SCxTQUFTLENBQUMsZ0JBQWdCLEdBQUcsRUFBRSxPQUFPLEVBQUUsQ0FBQyxLQUFLLEVBQUUsT0FBTyxFQUFFLE9BQU8sQ0FBQyxPQUFPLEVBQUUsQ0FBQztTQUM5RTthQUFNLElBQUksS0FBSyxLQUFLLElBQUksRUFBRTtZQUN2QixTQUFTLENBQUMsZ0JBQWdCLEdBQUcsRUFBRSxPQUFPLEVBQUUsSUFBSSxFQUFFLE9BQU8sRUFBRSxFQUFFLEVBQUUsQ0FBQTtTQUM5RDtRQUNELElBQU0sVUFBVSxHQUFHLENBQUMsRUFBRSxNQUFNLEVBQUUsWUFBWSxFQUFFLGFBQWEsRUFBRSxDQUFDLE9BQU8sQ0FBQyxZQUFZLENBQUMsRUFBRSxPQUFPLEVBQUUsT0FBTyxDQUFDLE9BQU8sRUFBRSxDQUFDLENBQUM7UUFDL0csZ0JBQWdCLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxXQUFXLENBQUMsV0FBVyxFQUFFLFdBQVcsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUM3RSxTQUFTLENBQUMsMEJBQTBCLENBQUMsVUFBVSxFQUFFLElBQUksQ0FBQyxDQUFDO0lBQzNELENBQUM7SUFDTCx1QkFBQztBQUFELENBQUMsQUEvQkQsSUErQkMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBFeHByZXNzaW9uIH0gZnJvbSAnLi4vZXhwcmVzc2lvbi9pbmRleCc7XG5pbXBvcnQgeyBWaWV3TW9kZWxDb250ZXh0IH0gZnJvbSAnLi4vLi4vdmlldy1tb2RlbC9pbmRleCdcbmltcG9ydCB7IE5BTUVTUEFDRSB9IGZyb20gJy4uL2NvcmUvaW5kZXgnO1xuaW1wb3J0IHsgRm9ybUNvbnRyb2wgfSBmcm9tICcuLi8uLi9mb3JtJ1xuaW1wb3J0IHsgRWZmZWN0VXRpbCB9IGZyb20gJy4vdXRpbCc7XG5cbmV4cG9ydCBjbGFzcyBWYWxpZGF0ZUVmZmVjdG9yIGltcGxlbWVudHMgRXhwcmVzc2lvbi5FZmZlY3RvciB7XG4gICAgcHVibGljIG5zOiBzdHJpbmc7XG5cbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIHZpZXdNb2RlbENvbnRleHQ6IFZpZXdNb2RlbENvbnRleHQpIHtcbiAgICAgICAgdGhpcy5ucyA9IHRoaXMudmlld01vZGVsQ29udGV4dC5pbmplY3Rvci5nZXQoTkFNRVNQQUNFLCAnJyk7XG4gICAgfVxuICAgIHB1YmxpYyBlZmZlY3QocGF0aDogc3RyaW5nLCB2YWx1ZTogYW55LCBvcHRpb25zOiBFeHByZXNzaW9uLkVmZmVjdE9wdGlvbnMpIHtcbiAgICAgICAgLy/moLnmja7ot6/lvoTlr7vmib7lrZfmrrVcbiAgICAgICAgbGV0IHZpZXdNb2RlbENvbnRleHQ6IFZpZXdNb2RlbENvbnRleHQ7XG4gICAgICAgIGlmIChvcHRpb25zLnZpZXdNb2RlbElkKSB7XG4gICAgICAgICAgICB2aWV3TW9kZWxDb250ZXh0ID0gdGhpcy52aWV3TW9kZWxDb250ZXh0LmFwcENvbnRleHQudmlld01vZGVsQ29udGV4dE1hbmFnZXIuZ2V0Q29udGV4dEJ5SWQob3B0aW9ucy52aWV3TW9kZWxJZClcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVyblxuICAgICAgICB9XG4gICAgICAgIGlmICghdmlld01vZGVsQ29udGV4dCkgcmV0dXJuO1xuICAgICAgICBpZiAoIXZpZXdNb2RlbENvbnRleHQuZm9ybSkgcmV0dXJuO1xuICAgICAgICBjb25zdCBmb3JtQ29udHJvbCA9IEVmZmVjdFV0aWwuZ2V0Rm9ybVZhbHVlQnlQYXRoKHBhdGgsIHZpZXdNb2RlbENvbnRleHQpO1xuICAgICAgICBjb25zdCBmb3JtX25hbWUgPSBmb3JtQ29udHJvbC5mb3JtX25hbWUgYXMgRm9ybUNvbnRyb2w7XG4gICAgICAgIGlmICghZm9ybV9uYW1lKSB7XG4gICAgICAgICAgICByZXR1cm5cbiAgICAgICAgfVxuICAgICAgICAvLyDlj6rorqRmYWxzZSAg5Li6Zmxhc2XorqTkuLrpqozor4HkuI3ov4dcbiAgICAgICAgaWYgKHZhbHVlID09PSBmYWxzZSAmJiBvcHRpb25zLmV2ZW50VHlwZSAhPT0gRXhwcmVzc2lvbi5FdmVudFR5cGUuQXBwZW5kICYmIG9wdGlvbnMuZXZlbnRUeXBlICE9PSBFeHByZXNzaW9uLkV2ZW50VHlwZS5Mb2FkKSB7XG4gICAgICAgICAgICBmb3JtX25hbWUudmFsaWRhdGlvblJlc3VsdCA9IHsgcGFzc2luZzogIXZhbHVlLCBtZXNzYWdlOiBvcHRpb25zLm1lc3NhZ2UgfTtcbiAgICAgICAgfSBlbHNlIGlmICh2YWx1ZSA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgZm9ybV9uYW1lLnZhbGlkYXRpb25SZXN1bHQgPSB7IHBhc3Npbmc6IHRydWUsIG1lc3NhZ2U6ICcnIH1cbiAgICAgICAgfVxuICAgICAgICBjb25zdCB2YWxpZGF0b3JzID0gW3sgXCJ0eXBlXCI6IFwiZXhwcmVzc2lvblwiLCBcImNvbnN0cmFpbnRzXCI6IFtvcHRpb25zLmV4cHJlc3Npb25JZF0sIG1lc3NhZ2U6IG9wdGlvbnMubWVzc2FnZSB9XTtcbiAgICAgICAgdmlld01vZGVsQ29udGV4dC5mb3JtLmFkZFZhbGlkYXRlKGZvcm1Db250cm9sLmJpbmRpbmdQYXRoLCBmb3JtQ29udHJvbC5uYW1lKTtcbiAgICAgICAgZm9ybV9uYW1lLnB1c2hWYWxpZGF0b3JGbmZvclZhbGlkYXRlKHZhbGlkYXRvcnMsIHRydWUpO1xuICAgIH1cbn1cbiJdfQ==
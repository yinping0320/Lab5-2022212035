import * as tslib_1 from "tslib";
import { BehaviorSubject } from "rxjs";
import { Listeners } from "../listener/index";
/**
 * 事件监听器主要有以下几种类型的事件：
 * 1、值变化
 * 2、行切换
 *    行切换使用场景为需要为数据计算依赖当前行时
 * 3、数据加载
 */
var ExpressionEventEmitter = /** @class */ (function () {
    function ExpressionEventEmitter(viewModelContext) {
        var _this = this;
        this.viewModelContext = viewModelContext;
        this.listeners = this.viewModelContext.injector.get(Listeners);
        this.events = new Array();
        this.listeners.onEvent.subscribe(function (eventArgs) {
            if (_this.onEvent && _this.onEvent.observers.length > 0) {
                var events = [];
                if (_this.events.length > 0) {
                    events = tslib_1.__spread(_this.events);
                }
                events.push(eventArgs);
                _this.onEvent.next(events);
                _this.events = [];
            }
            else {
                _this.events.push(eventArgs);
            }
        });
    }
    ExpressionEventEmitter.prototype.attach = function () {
        if (!this.onEvent) {
            this.onEvent = new BehaviorSubject(this.events);
        }
        return this.onEvent.asObservable();
    };
    return ExpressionEventEmitter;
}());
export { ExpressionEventEmitter };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZXhwcmVzc2lvbl9ldmVudF9lbWl0dGVyLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy9tb2JpbGUtZGV2a2l0LyIsInNvdXJjZXMiOlsibGliL2V4cHJlc3Npb24vZXhwcmVzc2lvbi9leHByZXNzaW9uX2V2ZW50X2VtaXR0ZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBRSxlQUFlLEVBQWMsTUFBTSxNQUFNLENBQUM7QUFHbkQsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBRzlDOzs7Ozs7R0FNRztBQUNIO0lBUUUsZ0NBQW9CLGdCQUFrQztRQUF0RCxpQkFrQkM7UUFsQm1CLHFCQUFnQixHQUFoQixnQkFBZ0IsQ0FBa0I7UUFFcEQsSUFBSSxDQUFDLFNBQVMsR0FBRyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUUvRCxJQUFJLENBQUMsTUFBTSxHQUFHLElBQUksS0FBSyxFQUF3QixDQUFDO1FBQ2hELElBQUksQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxVQUFDLFNBQStCO1lBQy9ELElBQUksS0FBSSxDQUFDLE9BQU8sSUFBSSxLQUFJLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFO2dCQUNyRCxJQUFJLE1BQU0sR0FBRyxFQUFFLENBQUM7Z0JBQ2hCLElBQUksS0FBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFO29CQUMxQixNQUFNLG9CQUFPLEtBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztpQkFDM0I7Z0JBQ0QsTUFBTSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQztnQkFDdkIsS0FBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7Z0JBQzFCLEtBQUksQ0FBQyxNQUFNLEdBQUcsRUFBRSxDQUFDO2FBQ2xCO2lCQUFNO2dCQUNMLEtBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDO2FBQzdCO1FBQ0gsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDO0lBQ00sdUNBQU0sR0FBYjtRQUNFLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFO1lBQ2pCLElBQUksQ0FBQyxPQUFPLEdBQUcsSUFBSSxlQUFlLENBQThCLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztTQUM5RTtRQUNELE9BQU8sSUFBSSxDQUFDLE9BQU8sQ0FBQyxZQUFZLEVBQUUsQ0FBQztJQUNyQyxDQUFDO0lBQ0gsNkJBQUM7QUFBRCxDQUFDLEFBakNELElBaUNDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQmVoYXZpb3JTdWJqZWN0LCBPYnNlcnZhYmxlIH0gZnJvbSBcInJ4anNcIjtcbmltcG9ydCB7IFZpZXdNb2RlbENvbnRleHQgfSBmcm9tICcuLi8uLi92aWV3LW1vZGVsL2luZGV4JztcblxuaW1wb3J0IHsgTGlzdGVuZXJzIH0gZnJvbSBcIi4uL2xpc3RlbmVyL2luZGV4XCI7XG5pbXBvcnQgeyBFeHByZXNzaW9uIH0gZnJvbSBcIi4vdHlwZXNcIjtcblxuLyoqXG4gKiDkuovku7bnm5HlkKzlmajkuLvopoHmnInku6XkuIvlh6Dnp43nsbvlnovnmoTkuovku7bvvJpcbiAqIDHjgIHlgLzlj5jljJZcbiAqIDLjgIHooYzliIfmjaJcbiAqICAgIOihjOWIh+aNouS9v+eUqOWcuuaZr+S4uumcgOimgeS4uuaVsOaNruiuoeeul+S+nei1luW9k+WJjeihjOaXtlxuICogM+OAgeaVsOaNruWKoOi9vVxuICovXG5leHBvcnQgY2xhc3MgRXhwcmVzc2lvbkV2ZW50RW1pdHRlciB7XG5cbiAgcHJpdmF0ZSBvbkV2ZW50OiBCZWhhdmlvclN1YmplY3Q8QXJyYXk8RXhwcmVzc2lvbi5FdmVudEFyZ3M+PjtcblxuICBwcml2YXRlIGV2ZW50czogQXJyYXk8RXhwcmVzc2lvbi5FdmVudEFyZ3M+O1xuXG4gIHByaXZhdGUgbGlzdGVuZXJzOiBMaXN0ZW5lcnM7XG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSB2aWV3TW9kZWxDb250ZXh0OiBWaWV3TW9kZWxDb250ZXh0KSB7XG5cbiAgICB0aGlzLmxpc3RlbmVycyA9IHRoaXMudmlld01vZGVsQ29udGV4dC5pbmplY3Rvci5nZXQoTGlzdGVuZXJzKTtcblxuICAgIHRoaXMuZXZlbnRzID0gbmV3IEFycmF5PEV4cHJlc3Npb24uRXZlbnRBcmdzPigpO1xuICAgIHRoaXMubGlzdGVuZXJzLm9uRXZlbnQuc3Vic2NyaWJlKChldmVudEFyZ3M6IEV4cHJlc3Npb24uRXZlbnRBcmdzKSA9PiB7XG4gICAgICBpZiAodGhpcy5vbkV2ZW50ICYmIHRoaXMub25FdmVudC5vYnNlcnZlcnMubGVuZ3RoID4gMCkge1xuICAgICAgICBsZXQgZXZlbnRzID0gW107XG4gICAgICAgIGlmICh0aGlzLmV2ZW50cy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgZXZlbnRzID0gWy4uLnRoaXMuZXZlbnRzXTtcbiAgICAgICAgfVxuICAgICAgICBldmVudHMucHVzaChldmVudEFyZ3MpO1xuICAgICAgICB0aGlzLm9uRXZlbnQubmV4dChldmVudHMpO1xuICAgICAgICB0aGlzLmV2ZW50cyA9IFtdO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5ldmVudHMucHVzaChldmVudEFyZ3MpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG4gIHB1YmxpYyBhdHRhY2goKTogT2JzZXJ2YWJsZTxBcnJheTxFeHByZXNzaW9uLkV2ZW50QXJncz4+IHtcbiAgICBpZiAoIXRoaXMub25FdmVudCkge1xuICAgICAgdGhpcy5vbkV2ZW50ID0gbmV3IEJlaGF2aW9yU3ViamVjdDxBcnJheTxFeHByZXNzaW9uLkV2ZW50QXJncz4+KHRoaXMuZXZlbnRzKTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMub25FdmVudC5hc09ic2VydmFibGUoKTtcbiAgfVxufSJdfQ==
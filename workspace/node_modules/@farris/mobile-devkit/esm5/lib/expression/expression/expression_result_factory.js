import { ExpressionManager } from "./expression_manager";
;
import { ExpressionRegistry } from "./expression_registry";
import { ExpressionResult } from "./expression_result";
var ExpressionResultFactory = /** @class */ (function () {
    function ExpressionResultFactory(viewModelContext) {
        this.viewModelContext = viewModelContext;
        this.injector = this.viewModelContext.injector;
        this.expressionRegistry = this.injector.get(ExpressionRegistry);
        this.expressionManager = this.injector.get(ExpressionManager);
        this.expressionResult = this.injector.get(ExpressionResult);
        this.registeEvent();
    }
    ExpressionResultFactory.prototype.registeEvent = function () {
        var _this = this;
        this.expressionRegistry.expressions.subscribe(function (expressionObjects) {
            // 加载完表达式之后做一次计算
            expressionObjects.forEach(function (expressionObject) {
                if (expressionObject.deps && expressionObject.deps.length > 0) {
                    return;
                }
                var result = _this.expressionManager.eval(expressionObject.id);
                _this.expressionResult[expressionObject.id] = result;
            });
        });
    };
    return ExpressionResultFactory;
}());
export { ExpressionResultFactory };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZXhwcmVzc2lvbl9yZXN1bHRfZmFjdG9yeS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvbW9iaWxlLWRldmtpdC8iLCJzb3VyY2VzIjpbImxpYi9leHByZXNzaW9uL2V4cHJlc3Npb24vZXhwcmVzc2lvbl9yZXN1bHRfZmFjdG9yeS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFDQSxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUFBLENBQUM7QUFDMUQsT0FBTyxFQUFFLGtCQUFrQixFQUFFLE1BQU0sdUJBQXVCLENBQUM7QUFDM0QsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0scUJBQXFCLENBQUE7QUFJdEQ7SUFVRSxpQ0FBb0IsZ0JBQWtDO1FBQWxDLHFCQUFnQixHQUFoQixnQkFBZ0IsQ0FBa0I7UUFFcEQsSUFBSSxDQUFDLFFBQVEsR0FBRyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsUUFBUSxDQUFDO1FBQy9DLElBQUksQ0FBQyxrQkFBa0IsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDO1FBQ2hFLElBQUksQ0FBQyxpQkFBaUIsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDO1FBQzlELElBQUksQ0FBQyxnQkFBZ0IsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO1FBRzVELElBQUksQ0FBQyxZQUFZLEVBQUUsQ0FBQztJQUN0QixDQUFDO0lBQ08sOENBQVksR0FBcEI7UUFBQSxpQkFXQztRQVZDLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxXQUFXLENBQUMsU0FBUyxDQUFDLFVBQUMsaUJBQWdEO1lBQzdGLGdCQUFnQjtZQUNoQixpQkFBaUIsQ0FBQyxPQUFPLENBQUMsVUFBQyxnQkFBNkM7Z0JBQ3RFLElBQUksZ0JBQWdCLENBQUMsSUFBSSxJQUFJLGdCQUFnQixDQUFDLElBQUksQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFO29CQUM3RCxPQUFPO2lCQUNSO2dCQUNELElBQU0sTUFBTSxHQUFHLEtBQUksQ0FBQyxpQkFBaUIsQ0FBQyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsRUFBRSxDQUFDLENBQUM7Z0JBQ2hFLEtBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxnQkFBZ0IsQ0FBQyxFQUFFLENBQUMsR0FBRyxNQUFNLENBQUM7WUFDdEQsQ0FBQyxDQUFDLENBQUM7UUFDTCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUM7SUFDSCw4QkFBQztBQUFELENBQUMsQUFoQ0QsSUFnQ0MiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RvciB9IGZyb20gXCIuLi8uLi9jb3JlL2luZGV4XCI7XG5pbXBvcnQgeyBFeHByZXNzaW9uTWFuYWdlciB9IGZyb20gXCIuL2V4cHJlc3Npb25fbWFuYWdlclwiOztcbmltcG9ydCB7IEV4cHJlc3Npb25SZWdpc3RyeSB9IGZyb20gXCIuL2V4cHJlc3Npb25fcmVnaXN0cnlcIjtcbmltcG9ydCB7IEV4cHJlc3Npb25SZXN1bHQgfSBmcm9tIFwiLi9leHByZXNzaW9uX3Jlc3VsdFwiXG5pbXBvcnQgeyBFeHByZXNzaW9uIH0gZnJvbSBcIi4vdHlwZXNcIjtcbmltcG9ydCB7IFZpZXdNb2RlbENvbnRleHQsIFZpZXdNb2RlbCB9IGZyb20gXCIuLi8uLi92aWV3LW1vZGVsL2luZGV4XCI7XG5cbmV4cG9ydCBjbGFzcyBFeHByZXNzaW9uUmVzdWx0RmFjdG9yeSB7XG5cbiAgcHJpdmF0ZSBpbmplY3RvcjogSW5qZWN0b3I7XG5cbiAgcHJpdmF0ZSBleHByZXNzaW9uUmVnaXN0cnk6IEV4cHJlc3Npb25SZWdpc3RyeTtcblxuICBwcml2YXRlIGV4cHJlc3Npb25NYW5hZ2VyOiBFeHByZXNzaW9uTWFuYWdlcjtcblxuICBwcml2YXRlIGV4cHJlc3Npb25SZXN1bHQ6IEV4cHJlc3Npb25SZXN1bHRcblxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIHZpZXdNb2RlbENvbnRleHQ6IFZpZXdNb2RlbENvbnRleHQpIHtcblxuICAgIHRoaXMuaW5qZWN0b3IgPSB0aGlzLnZpZXdNb2RlbENvbnRleHQuaW5qZWN0b3I7XG4gICAgdGhpcy5leHByZXNzaW9uUmVnaXN0cnkgPSB0aGlzLmluamVjdG9yLmdldChFeHByZXNzaW9uUmVnaXN0cnkpO1xuICAgIHRoaXMuZXhwcmVzc2lvbk1hbmFnZXIgPSB0aGlzLmluamVjdG9yLmdldChFeHByZXNzaW9uTWFuYWdlcik7XG4gICAgdGhpcy5leHByZXNzaW9uUmVzdWx0ID0gdGhpcy5pbmplY3Rvci5nZXQoRXhwcmVzc2lvblJlc3VsdCk7XG5cblxuICAgIHRoaXMucmVnaXN0ZUV2ZW50KCk7XG4gIH1cbiAgcHJpdmF0ZSByZWdpc3RlRXZlbnQoKSB7XG4gICAgdGhpcy5leHByZXNzaW9uUmVnaXN0cnkuZXhwcmVzc2lvbnMuc3Vic2NyaWJlKChleHByZXNzaW9uT2JqZWN0czogRXhwcmVzc2lvbi5FeHByZXNzaW9uT2JqZWN0W10pID0+IHtcbiAgICAgIC8vIOWKoOi9veWujOihqOi+vuW8j+S5i+WQjuWBmuS4gOasoeiuoeeul1xuICAgICAgZXhwcmVzc2lvbk9iamVjdHMuZm9yRWFjaCgoZXhwcmVzc2lvbk9iamVjdDogRXhwcmVzc2lvbi5FeHByZXNzaW9uT2JqZWN0KSA9PiB7XG4gICAgICAgIGlmIChleHByZXNzaW9uT2JqZWN0LmRlcHMgJiYgZXhwcmVzc2lvbk9iamVjdC5kZXBzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgcmVzdWx0ID0gdGhpcy5leHByZXNzaW9uTWFuYWdlci5ldmFsKGV4cHJlc3Npb25PYmplY3QuaWQpO1xuICAgICAgICB0aGlzLmV4cHJlc3Npb25SZXN1bHRbZXhwcmVzc2lvbk9iamVjdC5pZF0gPSByZXN1bHQ7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfVxufSJdfQ==
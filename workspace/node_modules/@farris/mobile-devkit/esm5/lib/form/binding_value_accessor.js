import { BindingPathConverter, DateUtil } from '../utils/index';
import { BindingType } from './types';
/**
 * Entity值访问器
 */
var EntityBindingValueAccessor = /** @class */ (function () {
    function EntityBindingValueAccessor(bindingData, bindingPath, valueConverter) {
        this.bindingData = bindingData;
        this.bindingPathSegments = this.getBindingPathSegments(bindingPath);
        this.valueConverter = valueConverter;
    }
    EntityBindingValueAccessor.prototype.getValue = function () {
        var stateValue = this.bindingData.getValue(this.bindingPathSegments);
        var controlValue = this.valueConverter ? this.valueConverter.convertTo(stateValue) : stateValue;
        return controlValue;
    };
    EntityBindingValueAccessor.prototype.setValue = function (controlValue) {
        var oldStateValue = this.bindingData.getValue(this.bindingPathSegments);
        var stateValue = this.valueConverter ? this.valueConverter.convertFrom(controlValue) : controlValue;
        if (this.isDateConverter(this.valueConverter) === true) {
            if (DateUtil.isEqual(oldStateValue, stateValue) === true) {
                return;
            }
        }
        this.bindingData.setValue(this.bindingPathSegments, stateValue, true, true);
    };
    EntityBindingValueAccessor.prototype.getBindingPathSegments = function (bindingPath) {
        var parentPathSegments = BindingPathConverter.toBindingPathArray(this.bindingData.bindingPath);
        bindingPath = bindingPath.replace(/\./g, '\/');
        var bindingPathSegments = BindingPathConverter.toBindingPathArray(bindingPath);
        return parentPathSegments.concat(bindingPathSegments);
    };
    /**
     * 是否是DateConverter
     */
    EntityBindingValueAccessor.prototype.isDateConverter = function (converter) {
        var isDateConverter = false;
        if (converter && converter.hasOwnProperty('format') === true) {
            isDateConverter = true;
        }
        return isDateConverter;
    };
    return EntityBindingValueAccessor;
}());
/**
 * UIState值访问器
 */
var UIStateBindingValueAccessor = /** @class */ (function () {
    function UIStateBindingValueAccessor(uiState, bindingPath, valueConverter) {
        this.uiState = uiState;
        this.bindingPathSegments = this.getUiStateBindingPath(bindingPath);
    }
    UIStateBindingValueAccessor.prototype.getValue = function () {
        var stateValue;
        var obj = this.uiState;
        this.bindingPathSegments.forEach(function (item) {
            stateValue = obj[item];
            obj = stateValue;
        });
        return stateValue;
    };
    UIStateBindingValueAccessor.prototype.setValue = function (controlValue) {
        var _a;
        var length = this.bindingPathSegments.length;
        if (length === 1) {
            this.uiState.setPropertyValue(this.bindingPathSegments, controlValue);
        }
        else {
            var obj = void 0;
            for (var i = length - 1; i > 0; i--) {
                obj = (_a = {}, _a[this.bindingPathSegments[i]] = controlValue, _a);
                controlValue = obj;
            }
            this.uiState.setPropertyValue(this.bindingPathSegments[0], obj);
        }
    };
    // UISTATE获取路径
    UIStateBindingValueAccessor.prototype.getUiStateBindingPath = function (bindingPath) {
        var index = bindingPath.search('/');
        if (index !== -1) {
            return bindingPath.split('/');
        }
        else {
            return [bindingPath];
        }
    };
    return UIStateBindingValueAccessor;
}());
/**
 * 绑定值访问器工厂
 */
var BindingValueAccessorFactory = /** @class */ (function () {
    function BindingValueAccessorFactory() {
    }
    BindingValueAccessorFactory.create = function (bindingType, bindingBindingPath, bindingValueConverter, viewModelContext) {
        switch (bindingType) {
            case BindingType.EntityState:
                var bindingData = viewModelContext.bindingData;
                return new EntityBindingValueAccessor(bindingData, bindingBindingPath, bindingValueConverter);
            case BindingType.UIState:
                var uiState = viewModelContext.uiState;
                return new UIStateBindingValueAccessor(uiState, bindingBindingPath, bindingValueConverter);
            default:
                throw new Error('Not Supported');
        }
    };
    return BindingValueAccessorFactory;
}());
export { EntityBindingValueAccessor, UIStateBindingValueAccessor, BindingValueAccessorFactory };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmluZGluZ192YWx1ZV9hY2Nlc3Nvci5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvbW9iaWxlLWRldmtpdC8iLCJzb3VyY2VzIjpbImxpYi9mb3JtL2JpbmRpbmdfdmFsdWVfYWNjZXNzb3IudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBR0EsT0FBTyxFQUFFLG9CQUFvQixFQUFFLFFBQVEsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBRWhFLE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSxTQUFTLENBQUM7QUFhdEM7O0dBRUc7QUFDSDtJQVFFLG9DQUFZLFdBQXdCLEVBQUUsV0FBbUIsRUFBRSxjQUFxQztRQUM5RixJQUFJLENBQUMsV0FBVyxHQUFHLFdBQVcsQ0FBQztRQUMvQixJQUFJLENBQUMsbUJBQW1CLEdBQUcsSUFBSSxDQUFDLHNCQUFzQixDQUFDLFdBQVcsQ0FBQyxDQUFDO1FBQ3BFLElBQUksQ0FBQyxjQUFjLEdBQUcsY0FBYyxDQUFDO0lBQ3ZDLENBQUM7SUFFTSw2Q0FBUSxHQUFmO1FBQ0UsSUFBTSxVQUFVLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLG1CQUFtQixDQUFDLENBQUM7UUFDdkUsSUFBTSxZQUFZLEdBQUcsSUFBSSxDQUFDLGNBQWMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxTQUFTLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDLFVBQVUsQ0FBQztRQUNsRyxPQUFPLFlBQVksQ0FBQztJQUN0QixDQUFDO0lBRU0sNkNBQVEsR0FBZixVQUFnQixZQUFpQjtRQUMvQixJQUFNLGFBQWEsR0FBRyxJQUFJLENBQUMsV0FBVyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsbUJBQW1CLENBQUMsQ0FBQztRQUMxRSxJQUFNLFVBQVUsR0FBRyxJQUFJLENBQUMsY0FBYyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsY0FBYyxDQUFDLFdBQVcsQ0FBQyxZQUFZLENBQUMs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QVcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDdEMsSUFBSSxLQUFLLEtBQUssQ0FBQyxDQUFDLEVBQUU7WUFDaEIsT0FBTyxXQUFXLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFBO1NBQzlCO2FBQU07WUFDTCxPQUFPLENBQUMsV0FBVyxDQUFDLENBQUE7U0FDckI7SUFDSCxDQUFDO0lBQ0gsa0NBQUM7QUFBRCxDQUFDLEFBN0NELElBNkNDO0FBRUQ7O0dBRUc7QUFDSDtJQUFBO0lBY0EsQ0FBQztJQVpRLGtDQUFNLEdBQWIsVUFBYyxXQUF3QixFQUFFLGtCQUEwQixFQUFFLHFCQUFxQixFQUFFLGdCQUFrQztRQUMzSCxRQUFRLFdBQVcsRUFBRTtZQUNuQixLQUFLLFdBQVcsQ0FBQyxXQUFXO2dCQUMxQixJQUFNLFdBQVcsR0FBRyxnQkFBZ0IsQ0FBQyxXQUFXLENBQUM7Z0JBQ2pELE9BQU8sSUFBSSwwQkFBMEIsQ0FBQyxXQUFXLEVBQUUsa0JBQWtCLEVBQUUscUJBQXFCLENBQUMsQ0FBQztZQUNoRyxLQUFLLFdBQVcsQ0FBQyxPQUFPO2dCQUN0QixJQUFNLE9BQU8sR0FBRyxnQkFBZ0IsQ0FBQyxPQUFPLENBQUM7Z0JBQ3pDLE9BQU8sSUFBSSwyQkFBMkIsQ0FBQyxPQUFPLEVBQUUsa0JBQWtCLEVBQUUscUJBQXFCLENBQUMsQ0FBQztZQUM3RjtnQkFDRSxNQUFNLElBQUksS0FBSyxDQUFDLGVBQWUsQ0FBQyxDQUFDO1NBQ3BDO0lBQ0gsQ0FBQztJQUNILGtDQUFDO0FBQUQsQ0FBQyxBQWRELElBY0M7QUFFRCxPQUFPLEVBQXdCLDBCQUEwQixFQUFFLDJCQUEyQixFQUFFLDJCQUEyQixFQUFFLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBCaW5kaW5nRGF0YSB9IGZyb20gJy4uL2JpbmRpbmctZGF0YS9pbmRleCc7XG5pbXBvcnQgeyBVSVN0YXRlIH0gZnJvbSAnLi4vdWktc3RhdGUvaW5kZXgnO1xuaW1wb3J0IHsgVmlld01vZGVsQ29udGV4dCB9IGZyb20gJy4uL3ZpZXctbW9kZWwvaW5kZXgnO1xuaW1wb3J0IHsgQmluZGluZ1BhdGhDb252ZXJ0ZXIsIERhdGVVdGlsIH0gZnJvbSAnLi4vdXRpbHMvaW5kZXgnO1xuXG5pbXBvcnQgeyBCaW5kaW5nVHlwZSB9IGZyb20gJy4vdHlwZXMnO1xuaW1wb3J0IHsgQmluZGluZ1ZhbHVlQ29udmVydGVyIH0gZnJvbSAnLi9iaW5kaW5nX3ZhbHVlX2NvbnZlcnRlcic7XG5cbi8qKlxuICog57uR5a6a5YC86K6/6Zeu5Zmo5o6l5Y+jXG4gKi9cbmludGVyZmFjZSBCaW5kaW5nVmFsdWVBY2Nlc3NvciB7XG5cbiAgZ2V0VmFsdWUoKTogYW55O1xuXG4gIHNldFZhbHVlKGNvbnRyb2xWYWx1ZTogYW55KTogdm9pZDtcbn1cblxuLyoqXG4gKiBFbnRpdHnlgLzorr/pl67lmahcbiAqL1xuY2xhc3MgRW50aXR5QmluZGluZ1ZhbHVlQWNjZXNzb3IgaW1wbGVtZW50cyBCaW5kaW5nVmFsdWVBY2Nlc3NvciB7XG5cbiAgcHJpdmF0ZSBiaW5kaW5nRGF0YTogQmluZGluZ0RhdGE7XG5cbiAgcHJpdmF0ZSBiaW5kaW5nUGF0aFNlZ21lbnRzOiBzdHJpbmdbXTtcblxuICBwcml2YXRlIHZhbHVlQ29udmVydGVyOiBCaW5kaW5nVmFsdWVDb252ZXJ0ZXI7XG5cbiAgY29uc3RydWN0b3IoYmluZGluZ0RhdGE6IEJpbmRpbmdEYXRhLCBiaW5kaW5nUGF0aDogc3RyaW5nLCB2YWx1ZUNvbnZlcnRlcjogQmluZGluZ1ZhbHVlQ29udmVydGVyKSB7XG4gICAgdGhpcy5iaW5kaW5nRGF0YSA9IGJpbmRpbmdEYXRhO1xuICAgIHRoaXMuYmluZGluZ1BhdGhTZWdtZW50cyA9IHRoaXMuZ2V0QmluZGluZ1BhdGhTZWdtZW50cyhiaW5kaW5nUGF0aCk7XG4gICAgdGhpcy52YWx1ZUNvbnZlcnRlciA9IHZhbHVlQ29udmVydGVyO1xuICB9XG5cbiAgcHVibGljIGdldFZhbHVlKCk6IGFueSB7XG4gICAgY29uc3Qgc3RhdGVWYWx1ZSA9IHRoaXMuYmluZGluZ0RhdGEuZ2V0VmFsdWUodGhpcy5iaW5kaW5nUGF0aFNlZ21lbnRzKTtcbiAgICBjb25zdCBjb250cm9sVmFsdWUgPSB0aGlzLnZhbHVlQ29udmVydGVyID8gdGhpcy52YWx1ZUNvbnZlcnRlci5jb252ZXJ0VG8oc3RhdGVWYWx1ZSkgOiBzdGF0ZVZhbHVlO1xuICAgIHJldHVybiBjb250cm9sVmFsdWU7XG4gIH1cblxuICBwdWJsaWMgc2V0VmFsdWUoY29udHJvbFZhbHVlOiBhbnkpOiB2b2lkIHtcbiAgICBjb25zdCBvbGRTdGF0ZVZhbHVlID0gdGhpcy5iaW5kaW5nRGF0YS5nZXRWYWx1ZSh0aGlzLmJpbmRpbmdQYXRoU2VnbWVudHMpO1xuICAgIGNvbnN0IHN0YXRlVmFsdWUgPSB0aGlzLnZhbHVlQ29udmVydGVyID8gdGhpcy52YWx1ZUNvbnZlcnRlci5jb252ZXJ0RnJvbShjb250cm9sVmFsdWUpIDogY29udHJvbFZhbHVlO1xuXG4gICAgaWYgKHRoaXMuaXNEYXRlQ29udmVydGVyKHRoaXMudmFsdWVDb252ZXJ0ZXIpID09PSB0cnVlKSB7XG4gICAgICBpZiAoRGF0ZVV0aWwuaXNFcXVhbChvbGRTdGF0ZVZhbHVlLCBzdGF0ZVZhbHVlKSA9PT0gdHJ1ZSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgfVxuXG4gICAgdGhpcy5iaW5kaW5nRGF0YS5zZXRWYWx1ZSh0aGlzLmJpbmRpbmdQYXRoU2VnbWVudHMsIHN0YXRlVmFsdWUsIHRydWUsIHRydWUpO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRCaW5kaW5nUGF0aFNlZ21lbnRzKGJpbmRpbmdQYXRoOiBzdHJpbmcpIHtcbiAgICBjb25zdCBwYXJlbnRQYXRoU2VnbWVudHMgPSBCaW5kaW5nUGF0aENvbnZlcnRlci50b0JpbmRpbmdQYXRoQXJyYXkodGhpcy5iaW5kaW5nRGF0YS5iaW5kaW5nUGF0aCk7XG4gICAgYmluZGluZ1BhdGggPSBiaW5kaW5nUGF0aC5yZXBsYWNlKC9cXC4vZywgJ1xcLycpO1xuICAgIGNvbnN0IGJpbmRpbmdQYXRoU2VnbWVudHMgPSBCaW5kaW5nUGF0aENvbnZlcnRlci50b0JpbmRpbmdQYXRoQXJyYXkoYmluZGluZ1BhdGgpO1xuICAgIHJldHVybiBwYXJlbnRQYXRoU2VnbWVudHMuY29uY2F0KGJpbmRpbmdQYXRoU2VnbWVudHMpO1xuICB9XG5cbiAgLyoqXG4gICAqIOaYr+WQpuaYr0RhdGVDb252ZXJ0ZXJcbiAgICovXG4gIHByaXZhdGUgaXNEYXRlQ29udmVydGVyKGNvbnZlcnRlcjogQmluZGluZ1ZhbHVlQ29udmVydGVyKTogYm9vbGVhbiB7XG4gICAgbGV0IGlzRGF0ZUNvbnZlcnRlciA9IGZhbHNlO1xuICAgIGlmIChjb252ZXJ0ZXIgJiYgY29udmVydGVyLmhhc093blByb3BlcnR5KCdmb3JtYXQnKSA9PT0gdHJ1ZSkge1xuICAgICAgaXNEYXRlQ29udmVydGVyID0gdHJ1ZTtcbiAgICB9XG4gICAgcmV0dXJuIGlzRGF0ZUNvbnZlcnRlcjtcbiAgfVxufVxuXG4vKipcbiAqIFVJU3RhdGXlgLzorr/pl67lmahcbiAqL1xuY2xhc3MgVUlTdGF0ZUJpbmRpbmdWYWx1ZUFjY2Vzc29yIGltcGxlbWVudHMgQmluZGluZ1ZhbHVlQWNjZXNzb3Ige1xuXG4gIHByaXZhdGUgdWlTdGF0ZTogVUlTdGF0ZTtcblxuICBwcml2YXRlIGJpbmRpbmdQYXRoU2VnbWVudHM6IHN0cmluZ1tdO1xuXG5cbiAgY29uc3RydWN0b3IodWlTdGF0ZTogVUlTdGF0ZSwgYmluZGluZ1BhdGg6IHN0cmluZywgdmFsdWVDb252ZXJ0ZXI6IEJpbmRpbmdWYWx1ZUNvbnZlcnRlcikge1xuICAgIHRoaXMudWlTdGF0ZSA9IHVpU3RhdGU7XG4gICAgdGhpcy5iaW5kaW5nUGF0aFNlZ21lbnRzID0gdGhpcy5nZXRVaVN0YXRlQmluZGluZ1BhdGgoYmluZGluZ1BhdGgpO1xuICB9XG5cbiAgcHVibGljIGdldFZhbHVlKCk6IGFueSB7XG4gICAgbGV0IHN0YXRlVmFsdWU7XG4gICAgbGV0IG9iaiA9IHRoaXMudWlTdGF0ZTtcbiAgICB0aGlzLmJpbmRpbmdQYXRoU2VnbWVudHMuZm9yRWFjaChpdGVtID0+IHtcbiAgICAgIHN0YXRlVmFsdWUgPSBvYmpbaXRlbV07XG4gICAgICBvYmogPSBzdGF0ZVZhbHVlXG4gICAgfSlcbiAgICByZXR1cm4gc3RhdGVWYWx1ZTtcbiAgfVxuXG4gIHB1YmxpYyBzZXRWYWx1ZShjb250cm9sVmFsdWU6IGFueSk6IHZvaWQge1xuICAgIGNvbnN0IGxlbmd0aCA9IHRoaXMuYmluZGluZ1BhdGhTZWdtZW50cy5sZW5ndGg7XG4gICAgaWYgKGxlbmd0aCA9PT0gMSkge1xuICAgICAgdGhpcy51aVN0YXRlLnNldFByb3BlcnR5VmFsdWUodGhpcy5iaW5kaW5nUGF0aFNlZ21lbnRzLCBjb250cm9sVmFsdWUpO1xuICAgIH0gZWxzZSB7XG4gICAgICBsZXQgb2JqO1xuICAgICAgZm9yKGxldCBpID0gbGVuZ3RoLTEgOyBpID4gMCA7IGktLSl7XG4gICAgICAgIG9iaiA9IHtbdGhpcy5iaW5kaW5nUGF0aFNlZ21lbnRzW2ldXTogY29udHJvbFZhbHVlfTtcbiAgICAgICAgY29udHJvbFZhbHVlID0gb2JqO1xuICAgICAgfVxuICAgICAgdGhpcy51aVN0YXRlLnNldFByb3BlcnR5VmFsdWUodGhpcy5iaW5kaW5nUGF0aFNlZ21lbnRzWzBdLCBvYmopO1xuICAgIH1cbiAgfVxuXG4gIC8vIFVJU1RBVEXojrflj5bot6/lvoRcbiAgcHJpdmF0ZSBnZXRVaVN0YXRlQmluZGluZ1BhdGgoYmluZGluZ1BhdGg6IHN0cmluZykge1xuICAgIGNvbnN0IGluZGV4ID0gYmluZGluZ1BhdGguc2VhcmNoKCcvJyk7XG4gICAgaWYgKGluZGV4ICE9PSAtMSkge1xuICAgICAgcmV0dXJuIGJpbmRpbmdQYXRoLnNwbGl0KCcvJylcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIFtiaW5kaW5nUGF0aF1cbiAgICB9XG4gIH1cbn1cblxuLyoqXG4gKiDnu5HlrprlgLzorr/pl67lmajlt6XljoJcbiAqL1xuY2xhc3MgQmluZGluZ1ZhbHVlQWNjZXNzb3JGYWN0b3J5IHtcblxuICBzdGF0aWMgY3JlYXRlKGJpbmRpbmdUeXBlOiBCaW5kaW5nVHlwZSwgYmluZGluZ0JpbmRpbmdQYXRoOiBzdHJpbmcsIGJpbmRpbmdWYWx1ZUNvbnZlcnRlciwgdmlld01vZGVsQ29udGV4dDogVmlld01vZGVsQ29udGV4dCkge1xuICAgIHN3aXRjaCAoYmluZGluZ1R5cGUpIHtcbiAgICAgIGNhc2UgQmluZGluZ1R5cGUuRW50aXR5U3RhdGU6XG4gICAgICAgIGNvbnN0IGJpbmRpbmdEYXRhID0gdmlld01vZGVsQ29udGV4dC5iaW5kaW5nRGF0YTtcbiAgICAgICAgcmV0dXJuIG5ldyBFbnRpdHlCaW5kaW5nVmFsdWVBY2Nlc3NvcihiaW5kaW5nRGF0YSwgYmluZGluZ0JpbmRpbmdQYXRoLCBiaW5kaW5nVmFsdWVDb252ZXJ0ZXIpO1xuICAgICAgY2FzZSBCaW5kaW5nVHlwZS5VSVN0YXRlOlxuICAgICAgICBjb25zdCB1aVN0YXRlID0gdmlld01vZGVsQ29udGV4dC51aVN0YXRlO1xuICAgICAgICByZXR1cm4gbmV3IFVJU3RhdGVCaW5kaW5nVmFsdWVBY2Nlc3Nvcih1aVN0YXRlLCBiaW5kaW5nQmluZGluZ1BhdGgsIGJpbmRpbmdWYWx1ZUNvbnZlcnRlcik7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ05vdCBTdXBwb3J0ZWQnKTtcbiAgICB9XG4gIH1cbn1cblxuZXhwb3J0IHsgQmluZGluZ1ZhbHVlQWNjZXNzb3IsIEVudGl0eUJpbmRpbmdWYWx1ZUFjY2Vzc29yLCBVSVN0YXRlQmluZGluZ1ZhbHVlQWNjZXNzb3IsIEJpbmRpbmdWYWx1ZUFjY2Vzc29yRmFjdG9yeSB9O1xuIl19
import { BindingPropertyType, PropertyUtil } from '../../binding-data/index';
import { BindingPathConverter } from './binding_path_converter';
/**
 * EntityPath转换器
 */
var EntityPathConverter = /** @class */ (function () {
    function EntityPathConverter() {
    }
    /**
     * 转换为Entity可识别的路径
     * 根：[]
     * 主表：['id:xxx', 'name'],
     * 关联：['id:xxx', 'deptInfo', 'id:xxx', 'name']
     * UDT: ['id:xxx', 'updateInfo', ':', 'createdOn']
     * 从表：['id:xxx', 'edus', 'id:xxx', 'name'],
     * 从从表：['id:xxx', 'edus', 'id:xxx', 'grades', 'id:xxx', 'name']
     */
    EntityPathConverter.toEntityPathArray = function (bindingPathString, bindingData) {
        var _this = this;
        var bindingPathArray = BindingPathConverter.toBindingPathArray(bindingPathString);
        var entityPathArray = [];
        if (bindingPathArray.length === 0) {
            return entityPathArray;
        }
        // 根节点
        var currentBindingObject = bindingData.list.currentItem;
        entityPathArray.push(this.createPrimaryKeyPath(currentBindingObject.primaryKey, currentBindingObject.primaryKeyValue));
        bindingPathArray.forEach(function (propName) {
            var propInfo = PropertyUtil.getPropertyByName(currentBindingObject.properties, propName);
            switch (propInfo.type) {
                case BindingPropertyType.Plain:
                    entityPathArray.push(propName);
                    break;
                case BindingPropertyType.Object:
                    currentBindingObject = currentBindingObject[propName];
                    entityPathArray.push(propName);
                    entityPathArray.push(_this.createPrimaryKeyPath(currentBindingObject.primaryKey, currentBindingObject.primaryKeyValue));
                    break;
                case BindingPropertyType.List:
                    var currentBindingList = currentBindingObject[propName];
                    currentBindingObject = currentBindingList.currentItem;
                    entityPathArray.push(propName);
                    entityPathArray.push(_this.createPrimaryKeyPath(currentBindingObject.primaryKey, currentBindingObject.primaryKeyValue));
                    break;
                default:
                    break;
            }
        });
        return entityPathArray;
    };
    /**
     * 创建路径中的主键部分
     */
    EntityPathConverter.createPrimaryKeyPath = function (primaryKey, primaryKeyValue) {
        return primaryKey + ":" + primaryKeyValue;
    };
    return EntityPathConverter;
}());
export { EntityPathConverter };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZW50aXR5X3BhdGhfY29udmVydGVyLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy9tb2JpbGUtZGV2a2l0LyIsInNvdXJjZXMiOlsibGliL3V0aWxzL2RhdGEtcGF0aC9lbnRpdHlfcGF0aF9jb252ZXJ0ZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUNRLG1CQUFtQixFQUFFLFlBQVksRUFDL0MsTUFBTSwwQkFBMEIsQ0FBQztBQUNsQyxPQUFPLEVBQUUsb0JBQW9CLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQztBQUVoRTs7R0FFRztBQUNIO0lBQUE7SUE2REEsQ0FBQztJQTNEQzs7Ozs7Ozs7T0FRRztJQUNXLHFDQUFpQixHQUEvQixVQUFnQyxpQkFBeUIsRUFBRSxXQUF3QjtRQUFuRixpQkF5Q0M7UUF4Q0MsSUFBTSxnQkFBZ0IsR0FBYSxvQkFBb0IsQ0FBQyxrQkFBa0IsQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDO1FBQzlGLElBQU0sZUFBZSxHQUFhLEVBQUUsQ0FBQztRQUVyQyxJQUFJLGdCQUFnQixDQUFDLE1BQU0sS0FBSyxDQUFDLEVBQUU7WUFDakMsT0FBTyxlQUFlLENBQUM7U0FDeEI7UUFFRCxNQUFNO1FBQ04sSUFBSSxvQkFBb0IsR0FBRyxXQUFXLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQztRQUN4RCxlQUFlLENBQUMsSUFBSSxDQUNsQixJQUFJLENBQUMsb0JBQW9CLENBQUMsb0JBQW9CLENBQUMsVUFBVSxFQUFFLG9CQUFvQixDQUFDLGVBQWUsQ0FBQyxDQUNqRyxDQUFDO1FBRUYsZ0JBQWdCLENBQUMsT0FBTyxDQUFDLFVBQUMsUUFBZ0I7WUFDeEMsSUFBTSxRQUFRLEdBQUcsWUFBWSxDQUFDLGlCQUFpQixDQUFDLG9CQUFvQixDQUFDLFVBQVUsRUFBRSxRQUFRLENBQUMsQ0FBQztZQUMzRixRQUFRLFFBQVEsQ0FBQyxJQUFJLEVBQUU7Z0JBQ3JCLEtBQUssbUJBQW1CLENBQUMsS0FBSztvQkFDNUIsZUFBZSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQztvQkFDL0IsTUFBTTtnQkFDUixLQUFLLG1CQUFtQixDQUFDLE1BQU07b0JBQzdCLG9CQUFvQixHQUFHLG9CQUFvQixDQUFDLFFBQVEsQ0FBQyxDQUFDO29CQUN0RCxlQUFlLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO29CQUMvQixlQUFlLENBQUMsSUFBSSxDQUNsQixLQUFJLENBQUMsb0JBQW9CLENBQUMsb0JBQW9CLENBQUMsVUFBVSxFQUFFLG9CQUFvQixDQUFDLGVBQWUsQ0FBQyxDQUNqRyxDQUFDO29CQUNGLE1BQU07Z0JBQ1IsS0FBSyxtQkFBbUIsQ0FBQyxJQUFJO29CQUMzQixJQUFNLGtCQUFrQixHQUFHLG9CQUFvQixDQUFDLFFBQVEsQ0FBQyxDQUFDO29CQUMxRCxvQkFBb0IsR0FBRyxrQkFBa0IsQ0FBQyxXQUFXLENBQUM7b0JBQ3RELGVBQWUsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7b0JBQy9CLGVBQWUsQ0FBQyxJQUFJLENBQ2xCLEtBQUksQ0FBQyxvQkFBb0IsQ0FBQyxvQkFBb0IsQ0FBQyxVQUFVLEVBQUUsb0JBQW9CLENBQUMsZUFBZSxDQUFDLENBQ2pHLENBQUM7b0JBQ0YsTUFBTTtnQkFDUjtvQkFDSSxNQUFNO2FBQ1g7UUFDSCxDQUFDLENBQUMsQ0FBQztRQUVILE9BQU8sZUFBZSxDQUFDO0lBQ3pCLENBQUM7SUFFRDs7T0FFRztJQUNXLHdDQUFvQixHQUFsQyxVQUFtQyxVQUFrQixFQUFFLGVBQXVCO1FBQzVFLE9BQVUsVUFBVSxTQUFJLGVBQWlCLENBQUM7SUFDNUMsQ0FBQztJQUVILDBCQUFDO0FBQUQsQ0FBQyxBQTdERCxJQTZEQztBQUVELE9BQU8sRUFBRSxtQkFBbUIsRUFBRSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgQmluZGluZ0RhdGEsIEJpbmRpbmdQcm9wZXJ0eVR5cGUsIFByb3BlcnR5VXRpbFxufSBmcm9tICcuLi8uLi9iaW5kaW5nLWRhdGEvaW5kZXgnO1xuaW1wb3J0IHsgQmluZGluZ1BhdGhDb252ZXJ0ZXIgfSBmcm9tICcuL2JpbmRpbmdfcGF0aF9jb252ZXJ0ZXInO1xuXG4vKipcbiAqIEVudGl0eVBhdGjovazmjaLlmahcbiAqL1xuY2xhc3MgRW50aXR5UGF0aENvbnZlcnRlciB7XG5cbiAgLyoqXG4gICAqIOi9rOaNouS4ukVudGl0eeWPr+ivhuWIq+eahOi3r+W+hFxuICAgKiDmoLnvvJpbXVxuICAgKiDkuLvooajvvJpbJ2lkOnh4eCcsICduYW1lJ10sXG4gICAqIOWFs+iBlO+8mlsnaWQ6eHh4JywgJ2RlcHRJbmZvJywgJ2lkOnh4eCcsICduYW1lJ11cbiAgICogVURUOiBbJ2lkOnh4eCcsICd1cGRhdGVJbmZvJywgJzonLCAnY3JlYXRlZE9uJ11cbiAgICog5LuO6KGo77yaWydpZDp4eHgnLCAnZWR1cycsICdpZDp4eHgnLCAnbmFtZSddLFxuICAgKiDku47ku47ooajvvJpbJ2lkOnh4eCcsICdlZHVzJywgJ2lkOnh4eCcsICdncmFkZXMnLCAnaWQ6eHh4JywgJ25hbWUnXVxuICAgKi9cbiAgcHVibGljIHN0YXRpYyB0b0VudGl0eVBhdGhBcnJheShiaW5kaW5nUGF0aFN0cmluZzogc3RyaW5nLCBiaW5kaW5nRGF0YTogQmluZGluZ0RhdGEpOiBzdHJpbmdbXSB7XG4gICAgY29uc3QgYmluZGluZ1BhdGhBcnJheTogc3RyaW5nW10gPSBCaW5kaW5nUGF0aENvbnZlcnRlci50b0JpbmRpbmdQYXRoQXJyYXkoYmluZGluZ1BhdGhTdHJpbmcpO1xuICAgIGNvbnN0IGVudGl0eVBhdGhBcnJheTogc3RyaW5nW10gPSBbXTtcblxuICAgIGlmIChiaW5kaW5nUGF0aEFycmF5Lmxlbmd0aCA9PT0gMCkge1xuICAgICAgcmV0dXJuIGVudGl0eVBhdGhBcnJheTtcbiAgICB9XG5cbiAgICAvLyDmoLnoioLngrlcbiAgICBsZXQgY3VycmVudEJpbmRpbmdPYmplY3QgPSBiaW5kaW5nRGF0YS5saXN0LmN1cnJlbnRJdGVtO1xuICAgIGVudGl0eVBhdGhBcnJheS5wdXNoKFxuICAgICAgdGhpcy5jcmVhdGVQcmltYXJ5S2V5UGF0aChjdXJyZW50QmluZGluZ09iamVjdC5wcmltYXJ5S2V5LCBjdXJyZW50QmluZGluZ09iamVjdC5wcmltYXJ5S2V5VmFsdWUpXG4gICAgKTtcblxuICAgIGJpbmRpbmdQYXRoQXJyYXkuZm9yRWFjaCgocHJvcE5hbWU6IHN0cmluZykgPT4ge1xuICAgICAgY29uc3QgcHJvcEluZm8gPSBQcm9wZXJ0eVV0aWwuZ2V0UHJvcGVydHlCeU5hbWUoY3VycmVudEJpbmRpbmdPYmplY3QucHJvcGVydGllcywgcHJvcE5hbWUpO1xuICAgICAgc3dpdGNoIChwcm9wSW5mby50eXBlKSB7XG4gICAgICAgIGNhc2UgQmluZGluZ1Byb3BlcnR5VHlwZS5QbGFpbjpcbiAgICAgICAgICBlbnRpdHlQYXRoQXJyYXkucHVzaChwcm9wTmFtZSk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgQmluZGluZ1Byb3BlcnR5VHlwZS5PYmplY3Q6XG4gICAgICAgICAgY3VycmVudEJpbmRpbmdPYmplY3QgPSBjdXJyZW50QmluZGluZ09iamVjdFtwcm9wTmFtZV07XG4gICAgICAgICAgZW50aXR5UGF0aEFycmF5LnB1c2gocHJvcE5hbWUpO1xuICAgICAgICAgIGVudGl0eVBhdGhBcnJheS5wdXNoKFxuICAgICAgICAgICAgdGhpcy5jcmVhdGVQcmltYXJ5S2V5UGF0aChjdXJyZW50QmluZGluZ09iamVjdC5wcmltYXJ5S2V5LCBjdXJyZW50QmluZGluZ09iamVjdC5wcmltYXJ5S2V5VmFsdWUpXG4gICAgICAgICAgKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBCaW5kaW5nUHJvcGVydHlUeXBlLkxpc3Q6XG4gICAgICAgICAgY29uc3QgY3VycmVudEJpbmRpbmdMaXN0ID0gY3VycmVudEJpbmRpbmdPYmplY3RbcHJvcE5hbWVdO1xuICAgICAgICAgIGN1cnJlbnRCaW5kaW5nT2JqZWN0ID0gY3VycmVudEJpbmRpbmdMaXN0LmN1cnJlbnRJdGVtO1xuICAgICAgICAgIGVudGl0eVBhdGhBcnJheS5wdXNoKHByb3BOYW1lKTtcbiAgICAgICAgICBlbnRpdHlQYXRoQXJyYXkucHVzaChcbiAgICAgICAgICAgIHRoaXMuY3JlYXRlUHJpbWFyeUtleVBhdGgoY3VycmVudEJpbmRpbmdPYmplY3QucHJpbWFyeUtleSwgY3VycmVudEJpbmRpbmdPYmplY3QucHJpbWFyeUtleVZhbHVlKVxuICAgICAgICAgICk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIHJldHVybiBlbnRpdHlQYXRoQXJyYXk7XG4gIH1cblxuICAvKipcbiAgICog5Yib5bu66Lev5b6E5Lit55qE5Li76ZSu6YOo5YiGXG4gICAqL1xuICBwdWJsaWMgc3RhdGljIGNyZWF0ZVByaW1hcnlLZXlQYXRoKHByaW1hcnlLZXk6IHN0cmluZywgcHJpbWFyeUtleVZhbHVlOiBzdHJpbmcpIHtcbiAgICByZXR1cm4gYCR7cHJpbWFyeUtleX06JHtwcmltYXJ5S2V5VmFsdWV9YDtcbiAgfVxuXG59XG5cbmV4cG9ydCB7IEVudGl0eVBhdGhDb252ZXJ0ZXIgfTtcbiJdfQ==
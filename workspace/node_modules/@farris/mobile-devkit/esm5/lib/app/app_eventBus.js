import * as tslib_1 from "tslib";
import { Subject } from 'rxjs';
var AppEventBus = /** @class */ (function () {
    /**
     * 构造函数
     */
    function AppEventBus() {
        this.eventBus = new Subject();
        this.subscriptionsMap = new Map();
    }
    AppEventBus.prototype.triggerEvent = function (event) {
        this.eventBus.next(event);
    };
    AppEventBus.prototype.subscribe = function (componentId, func, funcError) {
        if (this.subscriptionsMap.has(componentId) === false) {
            var subscription = this.eventBus.subscribe(function (value) { return func(value); }, function (value) { return funcError(value); });
            this.subscriptionsMap.set(componentId, subscription);
        }
    };
    AppEventBus.prototype.unsubscribe = function (componentId) {
        if (this.subscriptionsMap.has(componentId) === true) {
            this.subscriptionsMap.get(componentId).unsubscribe();
            this.subscriptionsMap.delete(componentId);
        }
    };
    /**
     * 清除注册得指定key名监听器
     * @param keyStr 监听器key 默认值为listview上注册得
     * @returns
     */
    AppEventBus.prototype.unsubscribeAllListview = function (keyStr) {
        var e_1, _a;
        if (keyStr === void 0) { keyStr = '-listview-extend'; }
        if (this.subscriptionsMap.size == 0) {
            return;
        }
        try {
            // @ts-ignore: Unreachable code error
            for (var _b = tslib_1.__values(this.subscriptionsMap.keys()), _c = _b.next(); !_c.done; _c = _b.next()) {
                var key = _c.value;
                if (key.indexOf(keyStr) > 0) {
                    this.subscriptionsMap.get(key).unsubscribe();
                    this.subscriptionsMap.delete(key);
                }
            }
        }
        catch (e_1_1) { e_1 = { error: e_1_1 }; }
        finally {
            try {
                if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
            }
            finally { if (e_1) throw e_1.error; }
        }
    };
    return AppEventBus;
}());
export { AppEventBus };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXBwX2V2ZW50QnVzLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy9tb2JpbGUtZGV2a2l0LyIsInNvdXJjZXMiOlsibGliL2FwcC9hcHBfZXZlbnRCdXMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBRSxPQUFPLEVBQWdCLE1BQU0sTUFBTSxDQUFDO0FBRTdDO0lBUUU7O09BRUc7SUFDSDtRQUNFLElBQUksQ0FBQyxRQUFRLEdBQUcsSUFBSSxPQUFPLEVBQUUsQ0FBQztRQUM5QixJQUFJLENBQUMsZ0JBQWdCLEdBQUcsSUFBSSxHQUFHLEVBQXdCLENBQUM7SUFDMUQsQ0FBQztJQUVELGtDQUFZLEdBQVosVUFBYSxLQUFVO1FBQ3JCLElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQzVCLENBQUM7SUFFRCwrQkFBUyxHQUFULFVBQVUsV0FBbUIsRUFBRSxJQUFjLEVBQUUsU0FBb0I7UUFDakUsSUFBSSxJQUFJLENBQUMsZ0JBQWdCLENBQUMsR0FBRyxDQUFDLFdBQVcsQ0FBQyxLQUFLLEtBQUssRUFBRTtZQUNwRCxJQUFNLFlBQVksR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLFNBQVMsQ0FDMUMsVUFBQyxLQUFLLElBQUssT0FBQSxJQUFJLENBQUMsS0FBSyxDQUFDLEVBQVgsQ0FBVyxFQUN0QixVQUFDLEtBQUssSUFBSyxPQUFBLFNBQVMsQ0FBQyxLQUFLLENBQUMsRUFBaEIsQ0FBZ0IsQ0FDNUIsQ0FBQTtZQUNELElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxHQUFHLENBQUMsV0FBVyxFQUFFLFlBQVksQ0FBQyxDQUFDO1NBQ3REO0lBQ0gsQ0FBQztJQUVELGlDQUFXLEdBQVgsVUFBWSxXQUFtQjtRQUM3QixJQUFJLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxHQUFHLENBQUMsV0FBVyxDQUFDLEtBQUssSUFBSSxFQUFFO1lBQ25ELElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxHQUFHLENBQUMsV0FBVyxDQUFDLENBQUMsV0FBVyxFQUFFLENBQUM7WUFDckQsSUFBSSxDQUFDLGdCQUFnQixDQUFDLE1BQU0sQ0FBQyxXQUFXLENBQUMsQ0FBQztTQUMzQztJQUNILENBQUM7SUFFRDs7OztPQUlHO0lBQ0gsNENBQXNCLEdBQXRCLFVBQXVCLE1BQWtDOztRQUFsQyx1QkFBQSxFQUFBLDJCQUFrQztRQUN2RCxJQUFHLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxJQUFJLElBQUksQ0FBQyxFQUFDO1lBQUUsT0FBTTtTQUFFOztZQUM3QyxxQ0FBcUM7WUFDckMsS0FBZ0IsSUFBQSxLQUFBLGlCQUFBLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxJQUFJLEVBQUUsQ0FBQSxnQkFBQSw0QkFBRTtnQkFBekMsSUFBSSxHQUFHLFdBQUE7Z0JBQ1YsSUFBRyxHQUFHLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxHQUFDLENBQUMsRUFBQztvQkFDdkIsSUFBSSxDQUFDLGdCQUFnQixDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxXQUFXLEVBQUUsQ0FBQztvQkFDN0MsSUFBSSxDQUFDLGdCQUFnQixDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQztpQkFDbkM7YUFDRjs7Ozs7Ozs7O0lBQ0gsQ0FBQztJQUNILGtCQUFDO0FBQUQsQ0FBQyxBQXBERCxJQW9EQztBQUVELE9BQU8sRUFBRSxXQUFXLEVBQUUsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFN1YmplY3QsIFN1YnNjcmlwdGlvbiB9IGZyb20gJ3J4anMnO1xuXG5jbGFzcyBBcHBFdmVudEJ1cyB7XG4gIC8qKlxuKiBldmVudEJ1c1xuKi9cbiAgcHJpdmF0ZSBldmVudEJ1czogU3ViamVjdDxhbnk+O1xuXG4gIHByaXZhdGUgc3Vic2NyaXB0aW9uc01hcDogTWFwPHN0cmluZywgU3Vic2NyaXB0aW9uPjtcblxuICAvKipcbiAgICog5p6E6YCg5Ye95pWwXG4gICAqL1xuICBjb25zdHJ1Y3RvcigpIHtcbiAgICB0aGlzLmV2ZW50QnVzID0gbmV3IFN1YmplY3QoKTtcbiAgICB0aGlzLnN1YnNjcmlwdGlvbnNNYXAgPSBuZXcgTWFwPHN0cmluZywgU3Vic2NyaXB0aW9uPigpO1xuICB9XG5cbiAgdHJpZ2dlckV2ZW50KGV2ZW50OiBhbnkpIHtcbiAgICB0aGlzLmV2ZW50QnVzLm5leHQoZXZlbnQpO1xuICB9XG5cbiAgc3Vic2NyaWJlKGNvbXBvbmVudElkOiBzdHJpbmcsIGZ1bmM6IEZ1bmN0aW9uLCBmdW5jRXJyb3I/OiBGdW5jdGlvbikge1xuICAgIGlmICh0aGlzLnN1YnNjcmlwdGlvbnNNYXAuaGFzKGNvbXBvbmVudElkKSA9PT0gZmFsc2UpIHtcbiAgICAgIGNvbnN0IHN1YnNjcmlwdGlvbiA9IHRoaXMuZXZlbnRCdXMuc3Vic2NyaWJlKFxuICAgICAgICAodmFsdWUpID0+IGZ1bmModmFsdWUpLFxuICAgICAgICAodmFsdWUpID0+IGZ1bmNFcnJvcih2YWx1ZSlcbiAgICAgIClcbiAgICAgIHRoaXMuc3Vic2NyaXB0aW9uc01hcC5zZXQoY29tcG9uZW50SWQsIHN1YnNjcmlwdGlvbik7XG4gICAgfVxuICB9XG4gIFxuICB1bnN1YnNjcmliZShjb21wb25lbnRJZDogc3RyaW5nKSB7XG4gICAgaWYgKHRoaXMuc3Vic2NyaXB0aW9uc01hcC5oYXMoY29tcG9uZW50SWQpID09PSB0cnVlKSB7XG4gICAgICB0aGlzLnN1YnNjcmlwdGlvbnNNYXAuZ2V0KGNvbXBvbmVudElkKS51bnN1YnNjcmliZSgpO1xuICAgICAgdGhpcy5zdWJzY3JpcHRpb25zTWFwLmRlbGV0ZShjb21wb25lbnRJZCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIOa4hemZpOazqOWGjOW+l+aMh+WummtleeWQjeebkeWQrOWZqFxuICAgKiBAcGFyYW0ga2V5U3RyIOebkeWQrOWZqGtleSDpu5jorqTlgLzkuLpsaXN0dmlld+S4iuazqOWGjOW+l1xuICAgKiBAcmV0dXJucyBcbiAgICovXG4gIHVuc3Vic2NyaWJlQWxsTGlzdHZpZXcoa2V5U3RyOnN0cmluZyA9ICctbGlzdHZpZXctZXh0ZW5kJyl7XG4gICAgaWYodGhpcy5zdWJzY3JpcHRpb25zTWFwLnNpemUgPT0gMCl7IHJldHVybiB9XG4gICAgLy8gQHRzLWlnbm9yZTogVW5yZWFjaGFibGUgY29kZSBlcnJvclxuICAgIGZvciAobGV0IGtleSBvZiB0aGlzLnN1YnNjcmlwdGlvbnNNYXAua2V5cygpKSB7XG4gICAgICBpZihrZXkuaW5kZXhPZihrZXlTdHIpPjApe1xuICAgICAgICB0aGlzLnN1YnNjcmlwdGlvbnNNYXAuZ2V0KGtleSkudW5zdWJzY3JpYmUoKTtcbiAgICAgICAgdGhpcy5zdWJzY3JpcHRpb25zTWFwLmRlbGV0ZShrZXkpO1xuICAgICAgfVxuICAgIH1cbiAgfVxufVxuXG5leHBvcnQgeyBBcHBFdmVudEJ1cyB9OyJdfQ==
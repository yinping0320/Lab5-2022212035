import { DataTypeInfo, DataPropGroup } from '../entity-type-info/index';
import { DataPathNodeType } from './data_path_node';
import { DataPath } from './data_path';
/**
 * 数据Path工厂类
 */
var DataPathCreator = /** @class */ (function () {
    function DataPathCreator() {
    }
    /**
     * 将长路径数组或字符串转换为
     * @param fullPathArrayOrString 路径数组或字符串
     * @param repository 实体仓库
     * @summary
     * 1、长路径格式说明参考：data-path.md
     */
    DataPathCreator.createByLongPathFromRoot = function (fullPathArrayOrString, entityManager) {
        var dataPath = new DataPath();
        var fullPathArray = fullPathArrayOrString;
        if (!fullPathArray || fullPathArray.length === 0) {
            return dataPath;
        }
        var currentNodeInfo = {
            nodeValue: fullPathArray.shift(),
            nodeType: DataPathNodeType.DataId,
            entityTypeInfo: new DataTypeInfo(entityManager.entityType)
        };
        while (currentNodeInfo) {
            dataPath.push(currentNodeInfo.nodeType, currentNodeInfo.nodeValue);
            // 处理下一个节点
            var nextNodeValue = fullPathArray.shift();
            if (!nextNodeValue || !currentNodeInfo.entityTypeInfo) {
                break;
            }
            currentNodeInfo = this.getNextPathNodeInfo(currentNodeInfo, nextNodeValue);
        }
        return dataPath;
    };
    /**
     * 获取下一个路径节点的信息
     * @param parentNodeInfo 当前路径节点信息
     * @param nextNodeValue 下一个路径节点的值
     * @summary
     * 1、这个递归写的很绕，说明数据结构设计不合理；
     * 2、多个因素混用了一个结构；
     */
    DataPathCreator.getNextPathNodeInfo = function (parentNodeInfo, nextNodeValue) {
        var parentNodeValue = parentNodeInfo.nodeValue;
        var parentNodeType = parentNodeInfo.nodeType;
        var parentEntityTypeInfo = parentNodeInfo.entityTypeInfo;
        if (!nextNodeValue || !parentEntityTypeInfo) {
            return null;
        }
        var nextPathNodeInfo = {
            nodeValue: nextNodeValue,
            nodeType: null,
            entityTypeInfo: null
        };
        // DataNodeType=List：下一节点肯定是Object，并且EntityTypeInfo不变
        if (parentNodeType === DataPathNodeType.DataId) {
            nextPathNodeInfo.nodeType = DataPathNodeType.PropName;
            nextPathNodeInfo.entityTypeInfo = parentEntityTypeInfo;
        }
        else {
            // DataNodeType=Object：必然对应一个属性信息
            var nextPropInfo = parentEntityTypeInfo.getPropInfoByName(parentNodeValue);
            if (nextPropInfo.group === DataPropGroup.List) {
                // EntityPropGroup=EntityList：下一个节点是List类型。
                nextPathNodeInfo.nodeType = DataPathNodeType.DataId;
                nextPathNodeInfo.entityTypeInfo = nextPropInfo.typeInfo;
            }
            else {
                // EntityPropGroup=Entity：       下级entityTypeInfo为
                // EntityPropGroup=Dynamic|Plain：null
                nextPathNodeInfo.nodeType = DataPathNodeType.PropName;
                nextPathNodeInfo.entityTypeInfo = nextPropInfo.group === DataPropGroup.Object ? nextPropInfo.typeInfo : null;
            }
        }
        return nextPathNodeInfo;
    };
    /**
     * @param fullPathArrayOrString 路径数组或字符串
     * @param repository 实体仓库
     * @summary
     * 1、长路径格式说明参考：data-path.md
     * 2、shortPathArrayOrString暂时只支持字符串数组
     */
    DataPathCreator.createByShortPathFromRoot = function (shortPathArrayOrString, entityManager, bindingData) {
        var dataPath = new DataPath();
        var shortPathArray = shortPathArrayOrString;
        // 根节点
        var currentBindingObject = bindingData.list.currentItem;
        var currentEntityTypeInfo = new DataTypeInfo(entityManager.entityType);
        dataPath.push(DataPathNodeType.DataId, currentBindingObject.primaryKeyValue);
        // 遍历下级节点
        shortPathArray.forEach(function (propName) {
            var propInfo = currentEntityTypeInfo.getPropInfoByName(propName);
            switch (propInfo.group) {
                case DataPropGroup.Primitive:
                    dataPath.push(DataPathNodeType.PropName, propName);
                    break;
                case DataPropGroup.Object:
                    currentBindingObject = currentBindingObject[propName];
                    currentEntityTypeInfo = propInfo.typeInfo;
                    dataPath.push(DataPathNodeType.PropName, propName);
                    break;
                case DataPropGroup.List:
                    var currentBindingList = currentBindingObject[propName];
                    currentBindingObject = currentBindingList.currentItem;
                    currentEntityTypeInfo = propInfo.typeInfo;
                    dataPath.push(DataPathNodeType.PropName, propName);
                    dataPath.push(DataPathNodeType.DataId, currentBindingObject.primaryKeyValue);
                    break;
                default:
                    break;
            }
        });
        return dataPath;
    };
    return DataPathCreator;
}());
export { DataPathCreator };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0YV9wYXRoX2NyZWF0b3IuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL21vYmlsZS1kZXZraXQvIiwic291cmNlcyI6WyJsaWIvZW50aXR5L2VudGl0eS1wYXRoL2RhdGFfcGF0aF9jcmVhdG9yLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUNBLE9BQU8sRUFBRSxZQUFZLEVBQUUsYUFBYSxFQUFHLE1BQU0sMkJBQTJCLENBQUM7QUFJekUsT0FBTyxFQUFnQixnQkFBZ0IsRUFBRSxNQUFNLGtCQUFrQixDQUFDO0FBQ2xFLE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSxhQUFhLENBQUM7QUFFdkM7O0dBRUc7QUFDSDtJQUFBO0lBcUlBLENBQUM7SUFuSUM7Ozs7OztPQU1HO0lBQ1csd0NBQXdCLEdBQXRDLFVBQXVDLHFCQUF3QyxFQUFFLGFBQW9DO1FBQ25ILElBQU0sUUFBUSxHQUFHLElBQUksUUFBUSxFQUFFLENBQUM7UUFDaEMsSUFBTSxhQUFhLEdBQUcscUJBQWlDLENBQUM7UUFDeEQsSUFBSSxDQUFDLGFBQWEsSUFBSSxhQUFhLENBQUMsTUFBTSxLQUFLLENBQUMsRUFBRTtZQUNoRCxPQUFPLFFBQVEsQ0FBQztTQUNqQjtRQUVELElBQUksZUFBZSxHQUFHO1lBQ3BCLFNBQVMsRUFBRSxhQUFhLENBQUMsS0FBSyxFQUFFO1lBQ2hDLFFBQVEsRUFBRSxnQkFBZ0IsQ0FBQyxNQUFNO1lBQ2pDLGNBQWMsRUFBRSxJQUFJLFlBQVksQ0FBQyxhQUFhLENBQUMsVUFBVSxDQUFDO1NBQzNELENBQUM7UUFDRixPQUFPLGVBQWUsRUFBRTtZQUN0QixRQUFRLENBQUMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxRQUFRLEVBQUUsZUFBZSxDQUFDLFNBQVMsQ0FBQyxDQUFDO1lBRW5FLFVBQVU7WUFDVixJQUFNLGFBQWEsR0FBRyxhQUFhLENBQUMsS0FBSyxFQUFFLENBQUM7WUFDNUMsSUFBSSxDQUFDLGFBQWEsSUFBSSxDQUFDLGVBQWUsQ0FBQyxjQUFjLEVB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Q0FBQztvQkFDMUMsUUFBUSxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxRQUFRLEVBQUUsUUFBUSxDQUFDLENBQUM7b0JBRW5ELE1BQU07Z0JBQ1IsS0FBSyxhQUFhLENBQUMsSUFBSTtvQkFDckIsSUFBTSxrQkFBa0IsR0FBRyxvQkFBb0IsQ0FBQyxRQUFRLENBQUMsQ0FBQztvQkFDMUQsb0JBQW9CLEdBQUcsa0JBQWtCLENBQUMsV0FBVyxDQUFDO29CQUN0RCxxQkFBcUIsR0FBRyxRQUFRLENBQUMsUUFBUSxDQUFDO29CQUUxQyxRQUFRLENBQUMsSUFBSSxDQUFDLGdCQUFnQixDQUFDLFFBQVEsRUFBRSxRQUFRLENBQUMsQ0FBQztvQkFDbkQsUUFBUSxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxNQUFNLEVBQUUsb0JBQW9CLENBQUMsZUFBZSxDQUFDLENBQUM7b0JBQzdFLE1BQU07Z0JBQ1I7b0JBQ0ksTUFBTTthQUNYO1FBQ0gsQ0FBQyxDQUFDLENBQUM7UUFFSCxPQUFPLFFBQVEsQ0FBQztJQUNsQixDQUFDO0lBRUgsc0JBQUM7QUFBRCxDQUFDLEFBcklELElBcUlDO0FBRUQsT0FBTyxFQUFFLGVBQWUsRUFBRSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiXG5pbXBvcnQgeyBEYXRhVHlwZUluZm8sIERhdGFQcm9wR3JvdXAgIH0gZnJvbSAnLi4vZW50aXR5LXR5cGUtaW5mby9pbmRleCc7XG5pbXBvcnQgeyBFbnRpdHkgIH0gZnJvbSAnLi4vaW5kZXgnO1xuaW1wb3J0IHsgUmVwb3NpdG9yeSwgRW50aXR5TWFuYWdlciB9IGZyb20gJy4uLy4uL3JlcG9zaXRvcnkvaW5kZXgnO1xuaW1wb3J0IHsgQmluZGluZ0RhdGEgfSBmcm9tICcuLi8uLi9iaW5kaW5nLWRhdGEvaW5kZXgnO1xuaW1wb3J0IHsgRGF0YVBhdGhOb2RlLCBEYXRhUGF0aE5vZGVUeXBlIH0gZnJvbSAnLi9kYXRhX3BhdGhfbm9kZSc7XG5pbXBvcnQgeyBEYXRhUGF0aCB9IGZyb20gJy4vZGF0YV9wYXRoJztcblxuLyoqXG4gKiDmlbDmja5QYXRo5bel5Y6C57G7XG4gKi9cbmNsYXNzIERhdGFQYXRoQ3JlYXRvciB7XG5cbiAgLyoqXG4gICAqIOWwhumVv+i3r+W+hOaVsOe7hOaIluWtl+espuS4sui9rOaNouS4ulxuICAgKiBAcGFyYW0gZnVsbFBhdGhBcnJheU9yU3RyaW5nIOi3r+W+hOaVsOe7hOaIluWtl+espuS4slxuICAgKiBAcGFyYW0gcmVwb3NpdG9yeSDlrp7kvZPku5PlupNcbiAgICogQHN1bW1hcnlcbiAgICogMeOAgemVv+i3r+W+hOagvOW8j+ivtOaYjuWPguiAg++8mmRhdGEtcGF0aC5tZFxuICAgKi9cbiAgcHVibGljIHN0YXRpYyBjcmVhdGVCeUxvbmdQYXRoRnJvbVJvb3QoZnVsbFBhdGhBcnJheU9yU3RyaW5nOiBzdHJpbmdbXSB8IHN0cmluZywgZW50aXR5TWFuYWdlcjogRW50aXR5TWFuYWdlcjxFbnRpdHk+KTogRGF0YVBhdGgge1xuICAgIGNvbnN0IGRhdGFQYXRoID0gbmV3IERhdGFQYXRoKCk7XG4gICAgY29uc3QgZnVsbFBhdGhBcnJheSA9IGZ1bGxQYXRoQXJyYXlPclN0cmluZyBhcyBzdHJpbmdbXTtcbiAgICBpZiAoIWZ1bGxQYXRoQXJyYXkgfHwgZnVsbFBhdGhBcnJheS5sZW5ndGggPT09IDApIHtcbiAgICAgIHJldHVybiBkYXRhUGF0aDtcbiAgICB9XG5cbiAgICBsZXQgY3VycmVudE5vZGVJbmZvID0ge1xuICAgICAgbm9kZVZhbHVlOiBmdWxsUGF0aEFycmF5LnNoaWZ0KCksXG4gICAgICBub2RlVHlwZTogRGF0YVBhdGhOb2RlVHlwZS5EYXRhSWQsXG4gICAgICBlbnRpdHlUeXBlSW5mbzogbmV3IERhdGFUeXBlSW5mbyhlbnRpdHlNYW5hZ2VyLmVudGl0eVR5cGUpXG4gICAgfTtcbiAgICB3aGlsZSAoY3VycmVudE5vZGVJbmZvKSB7XG4gICAgICBkYXRhUGF0aC5wdXNoKGN1cnJlbnROb2RlSW5mby5ub2RlVHlwZSwgY3VycmVudE5vZGVJbmZvLm5vZGVWYWx1ZSk7XG5cbiAgICAgIC8vIOWkhOeQhuS4i+S4gOS4quiKgueCuVxuICAgICAgY29uc3QgbmV4dE5vZGVWYWx1ZSA9IGZ1bGxQYXRoQXJyYXkuc2hpZnQoKTtcbiAgICAgIGlmICghbmV4dE5vZGVWYWx1ZSB8fCAhY3VycmVudE5vZGVJbmZvLmVudGl0eVR5cGVJbmZvKSB7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgICAgY3VycmVudE5vZGVJbmZvID0gdGhpcy5nZXROZXh0UGF0aE5vZGVJbmZvKGN1cnJlbnROb2RlSW5mbywgbmV4dE5vZGVWYWx1ZSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIGRhdGFQYXRoO1xuICB9XG5cbiAgLyoqXG4gICAqIOiOt+WPluS4i+S4gOS4qui3r+W+hOiKgueCueeahOS/oeaBr1xuICAgKiBAcGFyYW0gcGFyZW50Tm9kZUluZm8g5b2T5YmN6Lev5b6E6IqC54K55L+h5oGvXG4gICAqIEBwYXJhbSBuZXh0Tm9kZVZhbHVlIOS4i+S4gOS4qui3r+W+hOiKgueCueeahOWAvFxuICAgKiBAc3VtbWFyeVxuICAgKiAx44CB6L+Z5Liq6YCS5b2S5YaZ55qE5b6I57uV77yM6K+05piO5pWw5o2u57uT5p6E6K6+6K6h5LiN5ZCI55CG77ybXG4gICAqIDLjgIHlpJrkuKrlm6DntKDmt7fnlKjkuobkuIDkuKrnu5PmnoTvvJtcbiAgICovXG4gIHByaXZhdGUgc3RhdGljIGdldE5leHRQYXRoTm9kZUluZm8ocGFyZW50Tm9kZUluZm86IGFueSwgbmV4dE5vZGVWYWx1ZTogc3RyaW5nKTogYW55IHtcblxuICAgIGNvbnN0IHBhcmVudE5vZGVWYWx1ZSA9IHBhcmVudE5vZGVJbmZvLm5vZGVWYWx1ZTtcbiAgICBjb25zdCBwYXJlbnROb2RlVHlwZSA9IHBhcmVudE5vZGVJbmZvLm5vZGVUeXBlO1xuICAgIGNvbnN0IHBhcmVudEVudGl0eVR5cGVJbmZvID0gcGFyZW50Tm9kZUluZm8uZW50aXR5VHlwZUluZm87XG5cbiAgICBpZiAoIW5leHROb2RlVmFsdWUgfHwgIXBhcmVudEVudGl0eVR5cGVJbmZvKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICBjb25zdCBuZXh0UGF0aE5vZGVJbmZvID0ge1xuICAgICAgbm9kZVZhbHVlOiBuZXh0Tm9kZVZhbHVlLFxuICAgICAgbm9kZVR5cGU6IG51bGwsXG4gICAgICBlbnRpdHlUeXBlSW5mbzogbnVsbFxuICAgIH07XG5cblxuICAgIC8vIERhdGFOb2RlVHlwZT1MaXN077ya5LiL5LiA6IqC54K56IKv5a6a5pivT2JqZWN077yM5bm25LiURW50aXR5VHlwZUluZm/kuI3lj5hcbiAgICBpZiAocGFyZW50Tm9kZVR5cGUgPT09IERhdGFQYXRoTm9kZVR5cGUuRGF0YUlkKSB7XG4gICAgICBuZXh0UGF0aE5vZGVJbmZvLm5vZGVUeXBlID0gRGF0YVBhdGhOb2RlVHlwZS5Qcm9wTmFtZTtcbiAgICAgIG5leHRQYXRoTm9kZUluZm8uZW50aXR5VHlwZUluZm8gPSBwYXJlbnRFbnRpdHlUeXBlSW5mbztcbiAgICB9IGVsc2Uge1xuXG4gICAgICAvLyBEYXRhTm9kZVR5cGU9T2JqZWN077ya5b+F54S25a+55bqU5LiA5Liq5bGe5oCn5L+h5oGvXG4gICAgICBjb25zdCBuZXh0UHJvcEluZm8gPSBwYXJlbnRFbnRpdHlUeXBlSW5mby5nZXRQcm9wSW5mb0J5TmFtZShwYXJlbnROb2RlVmFsdWUpO1xuICAgICAgaWYgKG5leHRQcm9wSW5mby5ncm91cCA9PT0gRGF0YVByb3BHcm91cC5MaXN0KSB7XG5cbiAgICAgICAgLy8gRW50aXR5UHJvcEdyb3VwPUVudGl0eUxpc3TvvJrkuIvkuIDkuKroioLngrnmmK9MaXN057G75Z6L44CCXG4gICAgICAgIG5leHRQYXRoTm9kZUluZm8ubm9kZVR5cGUgPSBEYXRhUGF0aE5vZGVUeXBlLkRhdGFJZDtcbiAgICAgICAgbmV4dFBhdGhOb2RlSW5mby5lbnRpdHlUeXBlSW5mbyA9IG5leHRQcm9wSW5mby50eXBlSW5mbztcbiAgICAgIH0gZWxzZSB7XG5cbiAgICAgICAgLy8gRW50aXR5UHJvcEdyb3VwPUVudGl0ee+8miAgICAgICDkuIvnuqdlbnRpdHlUeXBlSW5mb+S4ulxuICAgICAgICAvLyBFbnRpdHlQcm9wR3JvdXA9RHluYW1pY3xQbGFpbu+8mm51bGxcbiAgICAgICAgbmV4dFBhdGhOb2RlSW5mby5ub2RlVHlwZSA9IERhdGFQYXRoTm9kZVR5cGUuUHJvcE5hbWU7XG4gICAgICAgIG5leHRQYXRoTm9kZUluZm8uZW50aXR5VHlwZUluZm8gPSBuZXh0UHJvcEluZm8uZ3JvdXAgPT09IERhdGFQcm9wR3JvdXAuT2JqZWN0ID8gbmV4dFByb3BJbmZvLnR5cGVJbmZvIDogbnVsbDtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gbmV4dFBhdGhOb2RlSW5mbztcbiAgfVxuXG4gIC8qKlxuICAgKiBAcGFyYW0gZnVsbFBhdGhBcnJheU9yU3RyaW5nIOi3r+W+hOaVsOe7hOaIluWtl+espuS4slxuICAgKiBAcGFyYW0gcmVwb3NpdG9yeSDlrp7kvZPku5PlupNcbiAgICogQHN1bW1hcnlcbiAgICogMeOAgemVv+i3r+W+hOagvOW8j+ivtOaYjuWPguiAg++8mmRhdGEtcGF0aC5tZFxuICAgKiAy44CBc2hvcnRQYXRoQXJyYXlPclN0cmluZ+aaguaXtuWPquaUr+aMgeWtl+espuS4suaVsOe7hFxuICAgKi9cbiAgcHVibGljIHN0YXRpYyBjcmVhdGVCeVNob3J0UGF0aEZyb21Sb290KFxuICAgIHNob3J0UGF0aEFycmF5T3JTdHJpbmc6IHN0cmluZ1tdIHwgc3RyaW5nLCBlbnRpdHlNYW5hZ2VyOiBFbnRpdHlNYW5hZ2VyPEVudGl0eT4sIGJpbmRpbmdEYXRhOiBCaW5kaW5nRGF0YVxuICApOiBEYXRhUGF0aCB7XG5cbiAgICBjb25zdCBkYXRhUGF0aCA9IG5ldyBEYXRhUGF0aCgpO1xuICAgIGNvbnN0IHNob3J0UGF0aEFycmF5OiBzdHJpbmdbXSA9IHNob3J0UGF0aEFycmF5T3JTdHJpbmcgYXMgc3RyaW5nW107XG5cbiAgICAvLyDmoLnoioLngrlcbiAgICBsZXQgY3VycmVudEJpbmRpbmdPYmplY3QgPSBiaW5kaW5nRGF0YS5saXN0LmN1cnJlbnRJdGVtO1xuICAgIGxldCBjdXJyZW50RW50aXR5VHlwZUluZm8gPSBuZXcgRGF0YVR5cGVJbmZvKGVudGl0eU1hbmFnZXIuZW50aXR5VHlwZSk7XG4gICAgZGF0YVBhdGgucHVzaChEYXRhUGF0aE5vZGVUeXBlLkRhdGFJZCwgY3VycmVudEJpbmRpbmdPYmplY3QucHJpbWFyeUtleVZhbHVlKTtcblxuICAgIC8vIOmBjeWOhuS4i+e6p+iKgueCuVxuICAgIHNob3J0UGF0aEFycmF5LmZvckVhY2goKHByb3BOYW1lOiBzdHJpbmcpID0+IHtcbiAgICAgIGNvbnN0IHByb3BJbmZvID0gY3VycmVudEVudGl0eVR5cGVJbmZvLmdldFByb3BJbmZvQnlOYW1lKHByb3BOYW1lKTtcbiAgICAgIHN3aXRjaCAocHJvcEluZm8uZ3JvdXApIHtcbiAgICAgICAgY2FzZSBEYXRhUHJvcEdyb3VwLlByaW1pdGl2ZTpcbiAgICAgICAgICBkYXRhUGF0aC5wdXNoKERhdGFQYXRoTm9kZVR5cGUuUHJvcE5hbWUsIHByb3BOYW1lKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBEYXRhUHJvcEdyb3VwLk9iamVjdDpcbiAgICAgICAgICBjdXJyZW50QmluZGluZ09iamVjdCA9IGN1cnJlbnRCaW5kaW5nT2JqZWN0W3Byb3BOYW1lXTtcbiAgICAgICAgICBjdXJyZW50RW50aXR5VHlwZUluZm8gPSBwcm9wSW5mby50eXBlSW5mbztcbiAgICAgICAgICBkYXRhUGF0aC5wdXNoKERhdGFQYXRoTm9kZVR5cGUuUHJvcE5hbWUsIHByb3BOYW1lKTtcblxuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIERhdGFQcm9wR3JvdXAuTGlzdDpcbiAgICAgICAgICBjb25zdCBjdXJyZW50QmluZGluZ0xpc3QgPSBjdXJyZW50QmluZGluZ09iamVjdFtwcm9wTmFtZV07XG4gICAgICAgICAgY3VycmVudEJpbmRpbmdPYmplY3QgPSBjdXJyZW50QmluZGluZ0xpc3QuY3VycmVudEl0ZW07XG4gICAgICAgICAgY3VycmVudEVudGl0eVR5cGVJbmZvID0gcHJvcEluZm8udHlwZUluZm87XG5cbiAgICAgICAgICBkYXRhUGF0aC5wdXNoKERhdGFQYXRoTm9kZVR5cGUuUHJvcE5hbWUsIHByb3BOYW1lKTtcbiAgICAgICAgICBkYXRhUGF0aC5wdXNoKERhdGFQYXRoTm9kZVR5cGUuRGF0YUlkLCBjdXJyZW50QmluZGluZ09iamVjdC5wcmltYXJ5S2V5VmFsdWUpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICByZXR1cm4gZGF0YVBhdGg7XG4gIH1cblxufVxuXG5leHBvcnQgeyBEYXRhUGF0aENyZWF0b3IgfTtcbiJdfQ==
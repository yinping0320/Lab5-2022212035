/*
 * @Author: Witt
 * @Date: 2018-12-07 09:05:09
 * @Last Modified by: Witt
 * @Last Modified time: 2018-12-27 20:35:02
 */
import { EntityMetadataUtil } from '../metadata/index';
import { DataPropGroup } from './data_prop_info';
/**
 * 实体类型信息
 * @todo：
 * 1、构造时不应该识别Entity模块的东西，应该是更抽象的；
 * 2、构造函数应该接收一个Builder接口，由Entity或者其他实现层来实现这个接口。
 */
var DataTypeInfo = /** @class */ (function () {
    /**
     * 构造函数
     * @todo：不应该识别
     */
    function DataTypeInfo(type) {
        this.type = type;
        this.primaryKey = '';
        this.foreignKey = '';
        this.propInfoMap = new Map();
        this.collectEntityInfos();
        this.collectPropInfos();
    }
    Object.defineProperty(DataTypeInfo.prototype, "isValueObject", {
        /**
         * 是否为值对象
         */
        get: function () {
            return !this.primaryKey;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * 获取全部属性信息
     */
    DataTypeInfo.prototype.getPropInfos = function () {
        return Array.from(this.propInfoMap.values());
    };
    /**
     * 获取全部属性的名称
     */
    DataTypeInfo.prototype.getPropNames = function () {
        var propNames = [];
        var propInfos = this.getPropInfos();
        propInfos.forEach(function (propInfo) {
            propNames.push(propInfo.name);
        });
        return propNames;
    };
    /**
     * 根据group获取属性信息数组
     */
    DataTypeInfo.prototype.getPropInfosByGroup = function (group) {
        var allPropInfos = Array.from(this.propInfoMap.values());
        var propInfos = allPropInfos.filter(function (propInfo) {
            return propInfo.group === group;
        });
        return propInfos;
    };
    /**
     * 根据group获取属性名称数组
     * @param group 属性分组
     */
    DataTypeInfo.prototype.getPropNamesByGroup = function (group) {
        var propNames = [];
        var propInfos = this.getPropInfosByGroup(group);
        propInfos.forEach(function (propInfo) {
            propNames.push(propInfo.name);
        });
        return propNames;
    };
    /**
     * 根据propName获取属性信息
     */
    DataTypeInfo.prototype.getPropInfoByName = function (propName) {
        if (this.propInfoMap.has(propName)) {
            return this.propInfoMap.get(propName);
        }
        return null;
    };
    /**
     * 根据path获取属性信息
     */
    DataTypeInfo.prototype.getPropInfoByPath = function (path) {
        // 先复制，防止shift方法产生污染
        var arrPath = path.concat([]);
        if (arrPath.length === 0) {
            throw Error("\u5C5E\u6027\u8DEF\u5F84\u4E0D\u80FD\u4E3A\u7A7A");
        }
        // 循环查找
        var typeInfo = this;
        var propInfo = null;
        while (typeInfo && arrPath.length > 0) {
            var propName = arrPath.shift();
            propInfo = typeInfo.getPropInfoByName(propName);
            if (!propInfo) {
                throw Error("\u8DEF\u5F84" + path + "\u4E2D\u5B58\u5728\u4E0D\u6B63\u786E\u7684\u8282\u70B9" + propName + "\uFF0C\u8BF7\u68C0\u67E5");
            }
            typeInfo = propInfo.typeInfo;
            // 如果是动态列，并且路径数组里还有属性，统一设置为null(动态列不再描述属性信息)
            if (propInfo.group === DataPropGroup.Dynamic && arrPath.length > 0) {
                propInfo = null;
                typeInfo = null;
            }
        }
        return propInfo;
    };
    /**
     * 根据path获取对应属性的TypeInfo
     */
    DataTypeInfo.prototype.getTypeInfoByPath = function (path) {
        // 空数组时返回
        if (path.length === 0) {
            return this;
        }
        // 获取对应属性信息
        var propInfo = this.getPropInfoByPath(path);
        if (!propInfo.typeInfo) {
            throw Error("\u8DEF\u5F84" + path + "\u65E0\u6CD5\u5B9A\u4F4D\u5230\u4E00\u4E2AEntityTypeInfo\uFF0C\u8BF7\u68C0\u67E5");
        }
        return propInfo.typeInfo;
    };
    /**
     * 获取主键的属性信息
     */
    DataTypeInfo.prototype.getPrimaryKeyPropInfo = function () {
        return this.getPropInfoByName(this.primaryKey);
    };
    /**
     * 根据name获取影射名
     */
    DataTypeInfo.prototype.getPropMappingByName = function (name) {
        var propInfo = this.getPropInfoByName(name);
        if (!propInfo) {
            return '';
        }
        return propInfo.mapping;
    };
    /**
     * 根据path获取映射名
     */
    DataTypeInfo.prototype.getPropMappingByPath = function (path) {
        var propInfo = this.getPropInfoByPath(path);
        if (!propInfo) {
            return '';
        }
        return propInfo.mapping;
    };
    /**
     * 检查属性是否属于特定的分组
     */
    DataTypeInfo.prototype.checkPropGroup = function (propName, propGroup) {
        var propInfo = this.getPropInfoByName(propName);
        if (propInfo && propInfo.group === propGroup) {
            return true;
        }
        return false;
    };
    /**
     * --------------------------------------------------------------------------------
     * 属性元数据 => 属性描述信息
     * --------------------------------------------------------------------------------
     */
    DataTypeInfo.prototype.collectEntityInfos = function () {
        var entityMetadata = EntityMetadataUtil.getNgEntityMatadata(this.type);
        this.entityInfo = entityMetadata;
    };
    /**
     * 搜集所有属性信息
     * @todo：消除重复代码，ts不支持interface类型检测，暂时通过遍历实现。
     */
    DataTypeInfo.prototype.collectPropInfos = function () {
        var _this = this;
        // 简单属性
        var ngPlainProperties = EntityMetadataUtil.getNgFieldProperties(this.type);
        Object.keys(ngPlainProperties).forEach(function (propName) {
            var ngProperty = ngPlainProperties[propName];
            if (ngProperty.primary === true) {
                _this.primaryKey = propName;
            }
            if (ngProperty.foreign === true) {
                _this.foreignKey = propName;
            }
            _this.addPropInfo(DataPropGroup.Primitive, propName, ngProperty.dataField, null, ngProperty);
        });
        // 实体属性
        var ngEntityProperties = EntityMetadataUtil.getNgObjectProperties(this.type);
        Object.keys(ngEntityProperties).forEach(function (propName) {
            var ngProperty = ngEntityProperties[propName];
            _this.addPropInfo(DataPropGroup.Object, propName, ngProperty.dataField, ngProperty.type, ngProperty);
        });
        // 动态实体属性
        var ngDynamicProperties = EntityMetadataUtil.getNgDynamicProperties(this.type);
        Object.keys(ngDynamicProperties).forEach(function (propName) {
            var ngProperty = ngDynamicProperties[propName];
            _this.addPropInfo(DataPropGroup.Dynamic, propName, ngProperty.dataField, null, ngProperty);
        });
        // 实体列表属性
        var ngEntityListProperties = EntityMetadataUtil.getNgListProperties(this.type);
        Object.keys(ngEntityListProperties).forEach(function (propName) {
            var ngProperty = ngEntityListProperties[propName];
            _this.addPropInfo(DataPropGroup.List, propName, ngProperty.dataField, ngProperty.type, ngProperty);
        });
    };
    /**
     * 添加属性信息
     */
    DataTypeInfo.prototype.addPropInfo = function (group, name, mapping, type, metadataInfo) {
        // 没有设置影射时，用属性名充当影射
        mapping = mapping ? mapping : name;
        var typeInfo = null;
        if (type) {
            typeInfo = new DataTypeInfo(type);
        }
        var propInfo = { group: group, name: name, mapping: mapping, typeInfo: typeInfo, metadataInfo: metadataInfo };
        this.propInfoMap.set(name, propInfo);
    };
    return DataTypeInfo;
}());
export { DataTypeInfo };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0YV90eXBlX2luZm8uanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL21vYmlsZS1kZXZraXQvIiwic291cmNlcyI6WyJsaWIvZW50aXR5L2VudGl0eS10eXBlLWluZm8vZGF0YV90eXBlX2luZm8udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7O0dBS0c7QUFHSCxPQUFPLEVBRUwsa0JBQWtCLEVBQ25CLE1BQU0sbUJBQW1CLENBQUM7QUFDM0IsT0FBTyxFQUFFLGFBQWEsRUFBZ0IsTUFBTSxrQkFBa0IsQ0FBQztBQUUvRDs7Ozs7R0FLRztBQUNIO0lBa0NFOzs7T0FHRztJQUNILHNCQUFZLElBQVM7UUFDbkIsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUM7UUFDakIsSUFBSSxDQUFDLFVBQVUsR0FBRyxFQUFFLENBQUM7UUFDckIsSUFBSSxDQUFDLFVBQVUsR0FBRyxFQUFFLENBQUM7UUFDckIsSUFBSSxDQUFDLFdBQVcsR0FBRyxJQUFJLEdBQUcsRUFBd0IsQ0FBQztRQUNuRCxJQUFJLENBQUMsa0JBQWtCLEVBQUUsQ0FBQztRQUMxQixJQUFJLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQztJQUMxQixDQUFDO0lBZkQsc0JBQVcsdUNBQWE7UUFIeEI7O1dBRUc7YUFDSDtZQUNFLE9BQU8sQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDO1FBQzFCLENBQUM7OztPQUFBO0lBZUQ7O09BRUc7SUFDSSxtQ0FBWSxHQUFuQjtRQUNFLE9BQU8sS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLE1BQU0sRUFBRSxDQUFDLENBQUM7SUFDL0MsQ0FBQztJQUVEOztPQUVHO0lBQ0ksbUNBQVksR0FBbkI7UUFDRSxJQUFNLFNBQVMsR0FBRyxFQUFFLENBQUM7UUFDckIsSUFBTSxTQUFTLEdBQUcsSUFBSSxDQUFDLFlBQVksRUFBRSxDQUFDO1FBQ3RDLFNBQVMsQ0FBQyxPQUFPLENBQUMsVUFBQyxRQUFRO1lBQ3pCLFNBQVMsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ2hDLENBQUMsQ0FBQyxDQUFDO1FBQ0gsT0FBTyxTQUFTLENBQUM7SUFDbkIsQ0FBQztJQUVEOztPQUVHO0lBQ0ksMENBQW1CLEdBQTFCLFVBQTJCLEtBQW9CO1FBQzdDLElBQU0sWUFBWSxHQUFHLEtBQUssQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxDQUFDO1FBQzNELElBQU0sU0FBUyxHQUFHLFlBQVksQ0FBQyxNQUFNLENBQUMsVUFBQyxRQUFzQjtZQUMzRCxPQUFPLFFBQVEsQ0FBQyxLQUFLLEtBQUssS0FBSyxDQUFDO1FBQ2xDLENBQUMsQ0FBQyxDQUFDO1FBQ0gsT0FBTyxTQUFTLENBQUM7SUFDbkIsQ0FBQztJQUVEOzs7T0FHRztJQUNJLDBDQUFtQixHQUExQixVQUEyQixLQUFvQjtRQUM3QyxJQUFNLFNBQVMsR0FBRyxFQUFFLENBQUM7UUFDckIsSUFBTSxTQUFTLEdBQUcsSUFBSSxDQUFDLG1CQUFtQixDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ2xELFNBQVMsQ0FBQyxPQUFPLENBQUMsVUFBQyxRQUFRO1lBQ3pCLFNBQVMsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ2hDLENBQUMsQ0FBQyxDQUFDO1FBQ0gsT0FBTyxTQUFTLENBQUM7SUFDbkIsQ0FBQztJQUVEOztPQUVHO0lBQ0ksd0NBQWlCLEdBQXhCLFVBQXlCLFFBQWdCO1FBQ3ZDLElBQUksSUFBSSxDQUFDLFdBQVcsQ0FBQyxHQUFHLENBQUMsUUFBUSxDQUFDLEVBQUU7WUFDbEMsT0FBTyxJQUFJLENBQUMsV0FBVyxDQUFDLEdBQUcsQ0FBQyxRQUFRLENBQUMsQ0FBQztTQUN2QztRQUNELE9BQU8sSUFBSSxDQUFDO0lBQ2QsQ0FBQztJQUVEOztPQUVHO0lBQ0ksd0NBQWlCLEdBQXhCLFVBQXlCLElBQWM7UUFFckMsb0JBQW9CO1FBQ3BCLElBQU0sT0FBTyxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDLENBQUM7UUFDaEMsSUFBSSxPQUFPLENBQUMsTUFBTSxLQUFLLENBQUMsRUFBRTtZQUN4QixNQUFNLEtBQUssQ0FBQyxrREFBVSxDQUFDLENBQUM7U0FDekI7UUFFRCxPQUFPO1FBQ1AsSUFBSSxRQUFRLEdBQUcsSUFBSSxDQUFDO1FBQ3BCLElBQUksUUFBUSxHQUFHLElBQUksQ0FBQztRQUNwQixPQUFPLFFBQVEsSUFBSSxPQUFPLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRTtZQUVyQyxJQUFNLFFBQVEsR0FBRyxPQUFPLENBQUMsS0FBSyxFQUFFLENBQUM7WUFDakMsUUFBUSxHQUFHLFFBQVEsQ0FBQyxpQkFBaUIsQ0FBQyxRQUFRLENBQUMsQ0FBQztZQUNoRCxJQUFJLENBQUMsUUFBUSxFQUFFO2dCQUNiLE1BQU0sS0FBSyxDQUFDLGlCQUFLLElBQUksOERBQVksUUFBUSw2QkFBTSxDQUFDLENBQUM7YUFDbEQ7WUFDRCxRQUFRLEdBQUcsUUFBUSxDQUFDLFFBQVEsQ0FBQztZQUU3Qiw0Q0FBNEM7WUFDNUMsSUFBSSxRQUFRLENBQUMsS0FBSyxLQUFLLGFBQWEsQ0FBQyxPQUFPLElBQUksT0FBTyxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUU7Z0JBQ2xFLFFBQVEsR0FBRyxJQUFJLENBQUM7Z0JBQ2hCLFFBQVEsR0FBRyxJQUFJLENBQUM7YUFDakI7U0FDRjtRQUVELE9BQU8sUUFBUSxDQUFDO0lBQ2xCLENBQUM7SUFFRDs7T0FFRztJQUNJLHdDQUFpQixHQUF4QixVQUF5QixJQUFjO1FBRXJDLFNBQVM7UUFDVCxJQUFJLElBQUksQ0FBQyxNQUFNLEtBQUssQ0FBQyxFQUFFO1lBQ3JCLE9BQU8sSUFBSSxDQUFDO1NBQ2I7UUFFRCxXQUFXO1FBQ1gsSUFBTSxRQUFRLEdBQUcsSUFBSSxDQUFDLGlCQUFpQixDQUFDLElBQUksQ0FBQyxDQUFDO1FBQzlDLElBQUksQ0FBQyxRQUFRLENBQUMsUUFBUSxFQUFFO1lBQ3RCLE1BQU0sS0FBSyxDQUFDLGlCQUFLLElBQUkscUZBQTJCLENBQUMsQ0FBQztTQUNuRDtRQUVELE9BQU8sUUFBUSxDQUFDLFFBQVEsQ0FBQztJQUMzQixDQUFDO0lBRUQ7O09BRUc7SUFDSSw0Q0FBcUIsR0FBNUI7UUFDRSxPQUFPLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUM7SUFDakQsQ0FBQztJQUVEOztPQUVHO0lBQ0ksMkNBQW9CLEdBQTNCLFVBQTRCLElBQVk7UUFDdEMsSUFBTSxRQUFRLEdBQUcsSUFBSSxDQUFDLGlCQUFpQixDQUFDLElBQUksQ0FBQyxDQUFDO1FBQzlDLElBQUksQ0FBQyxRQUFRLEVBQUU7WUFDYixPQUFPLEVBQUUsQ0FBQztTQUNYO1FBQ0QsT0FBTyxRQUFRLENBQUMsT0FBTyxDQUFDO0lBQzFCLENBQUM7SUFFRDs7T0FFRztJQUNJLDJDQUFvQixHQUEzQixVQUE0QixJQUFjO1FBQ3hDLElBQU0sUUFBUSxHQUFHLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUM5QyxJQUFJLENBQUMsUUFBUSxFQUFFO1lBQ2IsT0FBTyxFQUFFLENBQUM7U0FDWDtRQUNELE9BQU8sUUFBUSxDQUFDLE9BQU8sQ0FBQztJQUMxQixDQUFDO0lBRUQ7O09BRUc7SUFDSSxxQ0FBYyxHQUFyQixVQUFzQixRQUFnQixFQUFFLFNBQXdCO1FBQzlELElBQU0sUUFBUSxHQUFHLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUNsRCxJQUFJLFFBQVEsSUFBSSxRQUFRLENBQUMsS0FBSyxLQUFLLFNBQVMsRUFBRTtZQUM1QyxPQUFPLElBQUksQ0FBQztTQUNiO1FBQ0QsT0FBTyxLQUFLLENBQUM7SUFDZixDQUFDO0lBR0Q7Ozs7T0FJRztJQUVLLHlDQUFrQixHQUExQjtRQUNFLElBQU0sY0FBYyxHQUFHLGtCQUFrQixDQUFDLG1CQUFtQixDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUN6RSxJQUFJLENBQUMsVUFBVSxHQUFHLGNBQWMsQ0FBQztJQUNuQyxDQUFDO0lBRUQ7OztPQUdHO0lBQ0ssdUNBQWdCLEdBQXhCO1FBQUEsaUJBbUNDO1FBakNDLE9BQU87UUFDUCxJQUFNLGlCQUFpQixHQUFHLGtCQUFrQixDQUFDLG9CQUFvQixDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUM3RSxNQUFNLENBQUMsSUFBSSxDQUFDLGlCQUFpQixDQUFDLENBQUMsT0FBTyxDQUFDLFVBQUMsUUFBZ0I7WUFDdEQsSUFBTSxVQUFVLEdBQUcsaUJBQWlCLENBQUMsUUFBUSxDQUEwQixDQUFDO1lBQ3hFLElBQUksVUFBVSxDQUFDLE9BQU8sS0FBSyxJQUFJLEVBQUU7Z0JBQy9CLEtBQUksQ0FBQyxVQUFVLEdBQUcsUUFBUSxDQUFDO2FBQzVCO1lBQ0QsSUFBSSxVQUFVLENBQUMsT0FBTyxLQUFLLElBQUksRUFBRTtnQkFDL0IsS0FBSSxDQUFDLFVBQVUsR0FBRyxRQUFRLENBQUM7YUFDNUI7WUFDRCxLQUFJLENBQUMsV0FBVyxDQUFDLGFBQWEsQ0FBQyxTQUFTLEVBQUUsUUFBUSxFQUFFLFVBQVUsQ0FBQyxTQUFTLEVBQUUsSUFBSSxFQUFFLFVBQVUsQ0FBQyxDQUFDO1FBQzlGLENBQUMsQ0FBQyxDQUFDO1FBRUgsT0FBTztRQUNQLElBQU0sa0JBQWtCLEdBQUcsa0JBQWtCLENBQUMscUJBQXFCLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQy9FLE1BQU0sQ0FBQyxJQUFJLENBQUMsa0JBQWtCLENBQUMsQ0FBQyxPQUFPLENBQUMsVUFBQyxRQUFnQjtZQUN2RCxJQUFNLFVBQVUsR0FBRyxrQkFBa0IsQ0FBQyxRQUFRLENBQXVCLENBQUM7WUFDdEUsS0FBSSxDQUFDLFdBQVcsQ0FBQyxhQUFhLENBQUMsTUFBTSxFQUFFLFFBQVEsRUFBRSxVQUFVLENBQUMsU0FBUyxFQUFFLFVBQVUsQ0FBQyxJQUFJLEVBQUUsVUFBVSxDQUFDLENBQUM7UUFDdEcsQ0FBQyxDQUFDLENBQUM7UUFFSCxTQUFTO1FBQ1QsSUFBTSxtQkFBbUIsR0FBRyxrQkFBa0IsQ0FBQyxzQkFBc0IsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDakYsTUFBTSxDQUFDLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxVQUFDLFFBQWdCO1lBQ3hELElBQU0sVUFBVSxHQUFHLG1CQUFtQixDQUFDLFFBQVEsQ0FBd0IsQ0FBQztZQUN4RSxLQUFJLENBQUMsV0FBVyxDQUFDLGFBQWEsQ0FBQyxPQUFPLEVBQUUsUUFBUSxFQUFFLFVBQVUsQ0FBQyxTQUFTLEVBQUUsSUFBSSxFQUFFLFVBQVUsQ0FBQyxDQUFDO1FBQzVGLENBQUMsQ0FBQyxDQUFDO1FBRUgsU0FBUztRQUNULElBQU0sc0JBQXNCLEdBQUcsa0JBQWtCLENBQUMsbUJBQW1CLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ2pGLE1BQU0sQ0FBQyxJQUFJLENBQUMsc0JBQXNCLENBQUMsQ0FBQyxPQUFPLENBQUMsVUFBQyxRQUFnQjtZQUMzRCxJQUFNLFVBQVUsR0FBRyxzQkFBc0IsQ0FBQyxRQUFRLENBQXFCLENBQUM7WUFDeEUsS0FBSSxDQUFDLFdBQVcsQ0FBQyxhQUFhLENBQUMsSUFBSSxFQUFFLFFBQVEsRUFBRSxVQUFVLENBQUMsU0FBUyxFQUFFLFVBQVUsQ0FBQyxJQUFJLEVBQUUsVUFBVSxDQUFDLENBQUM7UUFDcEcsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDO0lBRUQ7O09BRUc7SUFDSyxrQ0FBVyxHQUFuQixVQUFvQixLQUFvQixFQUFFLElBQVksRUFBRSxPQUFlLEVBQUUsSUFBZSxFQUFFLFlBQTBCO1FBRWxILG1CQUFtQjtRQUNuQixPQUFPLEdBQUcsT0FBTyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQztRQUNuQyxJQUFJLFFBQVEsR0FBRyxJQUFJLENBQUM7UUFDcEIsSUFBSSxJQUFJLEVBQUU7WUFDUixRQUFRLEdBQUcsSUFBSSxZQUFZLENBQUMsSUFBSSxDQUFDLENBQUM7U0FDbkM7UUFDRCxJQUFNLFFBQVEsR0FBRyxFQUFFLEtBQUssT0FBQSxFQUFFLElBQUksTUFBQSxFQUFFLE9BQU8sU0FBQSxFQUFFLFFBQVEsVUFBQSxFQUFFLFlBQVksY0FBQSxFQUFFLENBQUM7UUFDbEUsSUFBSSxDQUFDLFdBQVcsQ0FBQyxHQUFHLENBQUMsSUFBSSxFQUFFLFFBQVEsQ0FBQyxDQUFDO0lBQ3ZDLENBQUM7SUFFSCxtQkFBQztBQUFELENBQUMsQUFwUUQsSUFvUUM7QUFFRCxPQUFPLEVBQUUsWUFBWSxFQUFFLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuICogQEF1dGhvcjogV2l0dFxuICogQERhdGU6IDIwMTgtMTItMDcgMDk6MDU6MDlcbiAqIEBMYXN0IE1vZGlmaWVkIGJ5OiBXaXR0XG4gKiBATGFzdCBNb2RpZmllZCB0aW1lOiAyMDE4LTEyLTI3IDIwOjM1OjAyXG4gKi9cblxuaW1wb3J0IHsgVHlwZSB9IGZyb20gJy4uLy4uL2NvcmUvdHlwZXMnO1xuaW1wb3J0IHtcbiAgRW50aXR5TWV0YWRhdGEsIFByb3BNZXRhZGF0YSwgUHJpbWl0aXZlUHJvcE1ldGFkYXRhLCBPYmplY3RQcm9wTWV0YWRhdGEsIER5bmFtaWNQcm9wTWV0YWRhdGEsIExpc3RQcm9wTWV0YWRhdGEsXG4gIEVudGl0eU1ldGFkYXRhVXRpbFxufSBmcm9tICcuLi9tZXRhZGF0YS9pbmRleCc7XG5pbXBvcnQgeyBEYXRhUHJvcEdyb3VwLCBEYXRhUHJvcEluZm8gfSBmcm9tICcuL2RhdGFfcHJvcF9pbmZvJztcblxuLyoqXG4gKiDlrp7kvZPnsbvlnovkv6Hmga9cbiAqIEB0b2Rv77yaXG4gKiAx44CB5p6E6YCg5pe25LiN5bqU6K+l6K+G5YirRW50aXR55qih5Z2X55qE5Lic6KW/77yM5bqU6K+l5piv5pu05oq96LGh55qE77ybXG4gKiAy44CB5p6E6YCg5Ye95pWw5bqU6K+l5o6l5pS25LiA5LiqQnVpbGRlcuaOpeWPo++8jOeUsUVudGl0eeaIluiAheWFtuS7luWunueOsOWxguadpeWunueOsOi/meS4quaOpeWPo+OAglxuICovXG5jbGFzcyBEYXRhVHlwZUluZm8ge1xuXG4gIC8qKlxuICAgKiDlrp7kvZPmj4/ov7DlhYPmlbDmja5cbiAgICovXG4gIHB1YmxpYyBlbnRpdHlJbmZvOiBFbnRpdHlNZXRhZGF0YTtcblxuICAvKipcbiAgICog5pWw5o2u57G75Z6LXG4gICAqL1xuICBwdWJsaWMgdHlwZTogVHlwZTxhbnk+O1xuXG4gIC8qKlxuICAgKiDlsZ7mgKfpm4blkIhcbiAgICovXG4gIHB1YmxpYyBwcm9wSW5mb01hcDogTWFwPHN0cmluZywgRGF0YVByb3BJbmZvPjtcblxuICAvKipcbiAgICog5Li76ZSuXG4gICAqL1xuICBwdWJsaWMgcHJpbWFyeUtleTogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiDlpJbplK5cbiAgICovXG4gIHB1YmxpYyBmb3JlaWduS2V5OiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIOaYr+WQpuS4uuWAvOWvueixoVxuICAgKi9cbiAgcHVibGljIGdldCBpc1ZhbHVlT2JqZWN0KCkge1xuICAgIHJldHVybiAhdGhpcy5wcmltYXJ5S2V5O1xuICB9XG5cbiAgLyoqXG4gICAqIOaehOmAoOWHveaVsFxuICAgKiBAdG9kb++8muS4jeW6lOivpeivhuWIq1xuICAgKi9cbiAgY29uc3RydWN0b3IodHlwZTogYW55KSB7XG4gICAgdGhpcy50eXBlID0gdHlwZTtcbiAgICB0aGlzLnByaW1hcnlLZXkgPSAnJztcbiAgICB0aGlzLmZvcmVpZ25LZXkgPSAnJztcbiAgICB0aGlzLnByb3BJbmZvTWFwID0gbmV3IE1hcDxzdHJpbmcsIERhdGFQcm9wSW5mbz4oKTtcbiAgICB0aGlzLmNvbGxlY3RFbnRpdHlJbmZvcygpO1xuICAgIHRoaXMuY29sbGVjdFByb3BJbmZvcygpO1xuICB9XG5cbiAgLyoqXG4gICAqIOiOt+WPluWFqOmDqOWxnuaAp+S/oeaBr1xuICAgKi9cbiAgcHVibGljIGdldFByb3BJbmZvcygpOiBEYXRhUHJvcEluZm9bXSB7XG4gICAgcmV0dXJuIEFycmF5LmZyb20odGhpcy5wcm9wSW5mb01hcC52YWx1ZXMoKSk7XG4gIH1cblxuICAvKipcbiAgICog6I635Y+W5YWo6YOo5bGe5oCn55qE5ZCN56ewXG4gICAqL1xuICBwdWJsaWMgZ2V0UHJvcE5hbWVzKCk6IHN0cmluZ1tdIHtcbiAgICBjb25zdCBwcm9wTmFtZXMgPSBbXTtcbiAgICBjb25zdCBwcm9wSW5mb3MgPSB0aGlzLmdldFByb3BJbmZvcygpO1xuICAgIHByb3BJbmZvcy5mb3JFYWNoKChwcm9wSW5mbykgPT4ge1xuICAgICAgcHJvcE5hbWVzLnB1c2gocHJvcEluZm8ubmFtZSk7XG4gICAgfSk7XG4gICAgcmV0dXJuIHByb3BOYW1lcztcbiAgfVxuXG4gIC8qKlxuICAgKiDmoLnmja5ncm91cOiOt+WPluWxnuaAp+S/oeaBr+aVsOe7hFxuICAgKi9cbiAgcHVibGljIGdldFByb3BJbmZvc0J5R3JvdXAoZ3JvdXA6IERhdGFQcm9wR3JvdXApOiBEYXRhUHJvcEluZm9bXSB7XG4gICAgY29uc3QgYWxsUHJvcEluZm9zID0gQXJyYXkuZnJvbSh0aGlzLnByb3BJbmZvTWFwLnZhbHVlcygpKTtcbiAgICBjb25zdCBwcm9wSW5mb3MgPSBhbGxQcm9wSW5mb3MuZmlsdGVyKChwcm9wSW5mbzogRGF0YVByb3BJbmZvKSA9PiB7XG4gICAgICByZXR1cm4gcHJvcEluZm8uZ3JvdXAgPT09IGdyb3VwO1xuICAgIH0pO1xuICAgIHJldHVybiBwcm9wSW5mb3M7XG4gIH1cblxuICAvKipcbiAgICog5qC55o2uZ3JvdXDojrflj5blsZ7mgKflkI3np7DmlbDnu4RcbiAgICogQHBhcmFtIGdyb3VwIOWxnuaAp+WIhue7hFxuICAgKi9cbiAgcHVibGljIGdldFByb3BOYW1lc0J5R3JvdXAoZ3JvdXA6IERhdGFQcm9wR3JvdXApOiBzdHJpbmdbXSB7XG4gICAgY29uc3QgcHJvcE5hbWVzID0gW107XG4gICAgY29uc3QgcHJvcEluZm9zID0gdGhpcy5nZXRQcm9wSW5mb3NCeUdyb3VwKGdyb3VwKTtcbiAgICBwcm9wSW5mb3MuZm9yRWFjaCgocHJvcEluZm8pID0+IHtcbiAgICAgIHByb3BOYW1lcy5wdXNoKHByb3BJbmZvLm5hbWUpO1xuICAgIH0pO1xuICAgIHJldHVybiBwcm9wTmFtZXM7XG4gIH1cblxuICAvKipcbiAgICog5qC55o2ucHJvcE5hbWXojrflj5blsZ7mgKfkv6Hmga9cbiAgICovXG4gIHB1YmxpYyBnZXRQcm9wSW5mb0J5TmFtZShwcm9wTmFtZTogc3RyaW5nKTogRGF0YVByb3BJbmZvIHtcbiAgICBpZiAodGhpcy5wcm9wSW5mb01hcC5oYXMocHJvcE5hbWUpKSB7XG4gICAgICByZXR1cm4gdGhpcy5wcm9wSW5mb01hcC5nZXQocHJvcE5hbWUpO1xuICAgIH1cbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIC8qKlxuICAgKiDmoLnmja5wYXRo6I635Y+W5bGe5oCn5L+h5oGvXG4gICAqL1xuICBwdWJsaWMgZ2V0UHJvcEluZm9CeVBhdGgocGF0aDogc3RyaW5nW10pOiBEYXRhUHJvcEluZm8ge1xuXG4gICAgLy8g5YWI5aSN5Yi277yM6Ziy5q2ic2hpZnTmlrnms5XkuqfnlJ/msaHmn5NcbiAgICBjb25zdCBhcnJQYXRoID0gcGF0aC5jb25jYXQoW10pO1xuICAgIGlmIChhcnJQYXRoLmxlbmd0aCA9PT0gMCkge1xuICAgICAgdGhyb3cgRXJyb3IoYOWxnuaAp+i3r+W+hOS4jeiDveS4uuepumApO1xuICAgIH1cblxuICAgIC8vIOW+queOr+afpeaJvlxuICAgIGxldCB0eXBlSW5mbyA9IHRoaXM7XG4gICAgbGV0IHByb3BJbmZvID0gbnVsbDtcbiAgICB3aGlsZSAodHlwZUluZm8gJiYgYXJyUGF0aC5sZW5ndGggPiAwKSB7XG5cbiAgICAgIGNvbnN0IHByb3BOYW1lID0gYXJyUGF0aC5zaGlmdCgpO1xuICAgICAgcHJvcEluZm8gPSB0eXBlSW5mby5nZXRQcm9wSW5mb0J5TmFtZShwcm9wTmFtZSk7XG4gICAgICBpZiAoIXByb3BJbmZvKSB7XG4gICAgICAgIHRocm93IEVycm9yKGDot6/lvoQke3BhdGh95Lit5a2Y5Zyo5LiN5q2j56Gu55qE6IqC54K5JHtwcm9wTmFtZX3vvIzor7fmo4Dmn6VgKTtcbiAgICAgIH1cbiAgICAgIHR5cGVJbmZvID0gcHJvcEluZm8udHlwZUluZm87XG5cbiAgICAgIC8vIOWmguaenOaYr+WKqOaAgeWIl++8jOW5tuS4lOi3r+W+hOaVsOe7hOmHjOi/mOacieWxnuaAp++8jOe7n+S4gOiuvue9ruS4um51bGwo5Yqo5oCB5YiX5LiN5YaN5o+P6L+w5bGe5oCn5L+h5oGvKVxuICAgICAgaWYgKHByb3BJbmZvLmdyb3VwID09PSBEYXRhUHJvcEdyb3VwLkR5bmFtaWMgJiYgYXJyUGF0aC5sZW5ndGggPiAwKSB7XG4gICAgICAgIHByb3BJbmZvID0gbnVsbDtcbiAgICAgICAgdHlwZUluZm8gPSBudWxsO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBwcm9wSW5mbztcbiAgfVxuXG4gIC8qKlxuICAgKiDmoLnmja5wYXRo6I635Y+W5a+55bqU5bGe5oCn55qEVHlwZUluZm9cbiAgICovXG4gIHB1YmxpYyBnZXRUeXBlSW5mb0J5UGF0aChwYXRoOiBzdHJpbmdbXSk6IERhdGFUeXBlSW5mbyB7XG5cbiAgICAvLyDnqbrmlbDnu4Tml7bov5Tlm55cbiAgICBpZiAocGF0aC5sZW5ndGggPT09IDApIHtcbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cblxuICAgIC8vIOiOt+WPluWvueW6lOWxnuaAp+S/oeaBr1xuICAgIGNvbnN0IHByb3BJbmZvID0gdGhpcy5nZXRQcm9wSW5mb0J5UGF0aChwYXRoKTtcbiAgICBpZiAoIXByb3BJbmZvLnR5cGVJbmZvKSB7XG4gICAgICB0aHJvdyBFcnJvcihg6Lev5b6EJHtwYXRofeaXoOazleWumuS9jeWIsOS4gOS4qkVudGl0eVR5cGVJbmZv77yM6K+35qOA5p+lYCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHByb3BJbmZvLnR5cGVJbmZvO1xuICB9XG5cbiAgLyoqXG4gICAqIOiOt+WPluS4u+mUrueahOWxnuaAp+S/oeaBr1xuICAgKi9cbiAgcHVibGljIGdldFByaW1hcnlLZXlQcm9wSW5mbygpOiBEYXRhUHJvcEluZm8ge1xuICAgIHJldHVybiB0aGlzLmdldFByb3BJbmZvQnlOYW1lKHRoaXMucHJpbWFyeUtleSk7XG4gIH1cblxuICAvKipcbiAgICog5qC55o2ubmFtZeiOt+WPluW9seWwhOWQjVxuICAgKi9cbiAgcHVibGljIGdldFByb3BNYXBwaW5nQnlOYW1lKG5hbWU6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgY29uc3QgcHJvcEluZm8gPSB0aGlzLmdldFByb3BJbmZvQnlOYW1lKG5hbWUpO1xuICAgIGlmICghcHJvcEluZm8pIHtcbiAgICAgIHJldHVybiAnJztcbiAgICB9XG4gICAgcmV0dXJuIHByb3BJbmZvLm1hcHBpbmc7XG4gIH1cblxuICAvKipcbiAgICog5qC55o2ucGF0aOiOt+WPluaYoOWwhOWQjVxuICAgKi9cbiAgcHVibGljIGdldFByb3BNYXBwaW5nQnlQYXRoKHBhdGg6IHN0cmluZ1tdKTogc3RyaW5nIHtcbiAgICBjb25zdCBwcm9wSW5mbyA9IHRoaXMuZ2V0UHJvcEluZm9CeVBhdGgocGF0aCk7XG4gICAgaWYgKCFwcm9wSW5mbykge1xuICAgICAgcmV0dXJuICcnO1xuICAgIH1cbiAgICByZXR1cm4gcHJvcEluZm8ubWFwcGluZztcbiAgfVxuXG4gIC8qKlxuICAgKiDmo4Dmn6XlsZ7mgKfmmK/lkKblsZ7kuo7nibnlrprnmoTliIbnu4RcbiAgICovXG4gIHB1YmxpYyBjaGVja1Byb3BHcm91cChwcm9wTmFtZTogc3RyaW5nLCBwcm9wR3JvdXA6IERhdGFQcm9wR3JvdXApOiBib29sZWFuIHtcbiAgICBjb25zdCBwcm9wSW5mbyA9IHRoaXMuZ2V0UHJvcEluZm9CeU5hbWUocHJvcE5hbWUpO1xuICAgIGlmIChwcm9wSW5mbyAmJiBwcm9wSW5mby5ncm91cCA9PT0gcHJvcEdyb3VwKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cblxuICAvKipcbiAgICogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICog5bGe5oCn5YWD5pWw5o2uID0+IOWxnuaAp+aPj+i/sOS/oeaBr1xuICAgKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgKi9cblxuICBwcml2YXRlIGNvbGxlY3RFbnRpdHlJbmZvcygpIHtcbiAgICBjb25zdCBlbnRpdHlNZXRhZGF0YSA9IEVudGl0eU1ldGFkYXRhVXRpbC5nZXROZ0VudGl0eU1hdGFkYXRhKHRoaXMudHlwZSk7XG4gICAgdGhpcy5lbnRpdHlJbmZvID0gZW50aXR5TWV0YWRhdGE7XG4gIH1cblxuICAvKipcbiAgICog5pCc6ZuG5omA5pyJ5bGe5oCn5L+h5oGvXG4gICAqIEB0b2Rv77ya5raI6Zmk6YeN5aSN5Luj56CB77yMdHPkuI3mlK/mjIFpbnRlcmZhY2Xnsbvlnovmo4DmtYvvvIzmmoLml7bpgJrov4fpgY3ljoblrp7njrDjgIJcbiAgICovXG4gIHByaXZhdGUgY29sbGVjdFByb3BJbmZvcygpIHtcblxuICAgIC8vIOeugOWNleWxnuaAp1xuICAgIGNvbnN0IG5nUGxhaW5Qcm9wZXJ0aWVzID0gRW50aXR5TWV0YWRhdGFVdGlsLmdldE5nRmllbGRQcm9wZXJ0aWVzKHRoaXMudHlwZSk7XG4gICAgT2JqZWN0LmtleXMobmdQbGFpblByb3BlcnRpZXMpLmZvckVhY2goKHByb3BOYW1lOiBzdHJpbmcpID0+IHtcbiAgICAgIGNvbnN0IG5nUHJvcGVydHkgPSBuZ1BsYWluUHJvcGVydGllc1twcm9wTmFtZV0gYXMgUHJpbWl0aXZlUHJvcE1ldGFkYXRhO1xuICAgICAgaWYgKG5nUHJvcGVydHkucHJpbWFyeSA9PT0gdHJ1ZSkge1xuICAgICAgICB0aGlzLnByaW1hcnlLZXkgPSBwcm9wTmFtZTtcbiAgICAgIH1cbiAgICAgIGlmIChuZ1Byb3BlcnR5LmZvcmVpZ24gPT09IHRydWUpIHtcbiAgICAgICAgdGhpcy5mb3JlaWduS2V5ID0gcHJvcE5hbWU7XG4gICAgICB9XG4gICAgICB0aGlzLmFkZFByb3BJbmZvKERhdGFQcm9wR3JvdXAuUHJpbWl0aXZlLCBwcm9wTmFtZSwgbmdQcm9wZXJ0eS5kYXRhRmllbGQsIG51bGwsIG5nUHJvcGVydHkpO1xuICAgIH0pO1xuXG4gICAgLy8g5a6e5L2T5bGe5oCnXG4gICAgY29uc3QgbmdFbnRpdHlQcm9wZXJ0aWVzID0gRW50aXR5TWV0YWRhdGFVdGlsLmdldE5nT2JqZWN0UHJvcGVydGllcyh0aGlzLnR5cGUpO1xuICAgIE9iamVjdC5rZXlzKG5nRW50aXR5UHJvcGVydGllcykuZm9yRWFjaCgocHJvcE5hbWU6IHN0cmluZykgPT4ge1xuICAgICAgY29uc3QgbmdQcm9wZXJ0eSA9IG5nRW50aXR5UHJvcGVydGllc1twcm9wTmFtZV0gYXMgT2JqZWN0UHJvcE1ldGFkYXRhO1xuICAgICAgdGhpcy5hZGRQcm9wSW5mbyhEYXRhUHJvcEdyb3VwLk9iamVjdCwgcHJvcE5hbWUsIG5nUHJvcGVydHkuZGF0YUZpZWxkLCBuZ1Byb3BlcnR5LnR5cGUsIG5nUHJvcGVydHkpO1xuICAgIH0pO1xuXG4gICAgLy8g5Yqo5oCB5a6e5L2T5bGe5oCnXG4gICAgY29uc3QgbmdEeW5hbWljUHJvcGVydGllcyA9IEVudGl0eU1ldGFkYXRhVXRpbC5nZXROZ0R5bmFtaWNQcm9wZXJ0aWVzKHRoaXMudHlwZSk7XG4gICAgT2JqZWN0LmtleXMobmdEeW5hbWljUHJvcGVydGllcykuZm9yRWFjaCgocHJvcE5hbWU6IHN0cmluZykgPT4ge1xuICAgICAgY29uc3QgbmdQcm9wZXJ0eSA9IG5nRHluYW1pY1Byb3BlcnRpZXNbcHJvcE5hbWVdIGFzIER5bmFtaWNQcm9wTWV0YWRhdGE7XG4gICAgICB0aGlzLmFkZFByb3BJbmZvKERhdGFQcm9wR3JvdXAuRHluYW1pYywgcHJvcE5hbWUsIG5nUHJvcGVydHkuZGF0YUZpZWxkLCBudWxsLCBuZ1Byb3BlcnR5KTtcbiAgICB9KTtcblxuICAgIC8vIOWunuS9k+WIl+ihqOWxnuaAp1xuICAgIGNvbnN0IG5nRW50aXR5TGlzdFByb3BlcnRpZXMgPSBFbnRpdHlNZXRhZGF0YVV0aWwuZ2V0TmdMaXN0UHJvcGVydGllcyh0aGlzLnR5cGUpO1xuICAgIE9iamVjdC5rZXlzKG5nRW50aXR5TGlzdFByb3BlcnRpZXMpLmZvckVhY2goKHByb3BOYW1lOiBzdHJpbmcpID0+IHtcbiAgICAgIGNvbnN0IG5nUHJvcGVydHkgPSBuZ0VudGl0eUxpc3RQcm9wZXJ0aWVzW3Byb3BOYW1lXSBhcyBMaXN0UHJvcE1ldGFkYXRhO1xuICAgICAgdGhpcy5hZGRQcm9wSW5mbyhEYXRhUHJvcEdyb3VwLkxpc3QsIHByb3BOYW1lLCBuZ1Byb3BlcnR5LmRhdGFGaWVsZCwgbmdQcm9wZXJ0eS50eXBlLCBuZ1Byb3BlcnR5KTtcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiDmt7vliqDlsZ7mgKfkv6Hmga9cbiAgICovXG4gIHByaXZhdGUgYWRkUHJvcEluZm8oZ3JvdXA6IERhdGFQcm9wR3JvdXAsIG5hbWU6IHN0cmluZywgbWFwcGluZzogc3RyaW5nLCB0eXBlOiBUeXBlPGFueT4sIG1ldGFkYXRhSW5mbzogUHJvcE1ldGFkYXRhKSB7XG5cbiAgICAvLyDmsqHmnInorr7nva7lvbHlsITml7bvvIznlKjlsZ7mgKflkI3lhYXlvZPlvbHlsIRcbiAgICBtYXBwaW5nID0gbWFwcGluZyA/IG1hcHBpbmcgOiBuYW1lO1xuICAgIGxldCB0eXBlSW5mbyA9IG51bGw7XG4gICAgaWYgKHR5cGUpIHtcbiAgICAgIHR5cGVJbmZvID0gbmV3IERhdGFUeXBlSW5mbyh0eXBlKTtcbiAgICB9XG4gICAgY29uc3QgcHJvcEluZm8gPSB7IGdyb3VwLCBuYW1lLCBtYXBwaW5nLCB0eXBlSW5mbywgbWV0YWRhdGFJbmZvIH07XG4gICAgdGhpcy5wcm9wSW5mb01hcC5zZXQobmFtZSwgcHJvcEluZm8pO1xuICB9XG5cbn1cblxuZXhwb3J0IHsgRGF0YVR5cGVJbmZvIH07XG4iXX0=
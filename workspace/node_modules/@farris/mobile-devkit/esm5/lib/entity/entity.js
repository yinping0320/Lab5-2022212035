import { Subject } from 'rxjs';
import { FieldMetadataUtil } from './metadata/index';
;
import { ModifyType, ChangeSet } from '../changeset/index';
import { PARENT_PATH, PARENT_CLASS } from './types';
import { EntityList } from './entity_list';
import { EntityFactory } from './entity_factory';
/**
 * @author Lucas Huang
 * 实体抽象基类，所有实体必须扩展自Entity
 *
 * ### 使用示例
 * ```
 * export class UserEntity extends Entity {
 *    userId: string;
 *    userName: string;
 *
 *    constructor(data: any){
 *        super(data);
 *    }
 * }
 * ```
 */
var Entity = /** @class */ (function () {
    // #endregion
    /**
     * @param data JSON数据
     */
    function Entity(data) {
        // #region 私有、保护属性
        /**
         * 验证错误集合
         */
        this.validErrors = {};
        /**
         * 增量变更集合
         */
        this.changeSet = new ChangeSet();
        /**
         * 是否正在验证
         */
        this.isValidating = false;
        /**
         * 新数据
         */
        this.newData = undefined;
        // #endregion
        // #region 公有属性
        /**
         * 变更流
         */
        this.valueChanged = new Subject();
        /**
         * 属性值改变时触发
         *
         * ### 使用示例
         * ```
         *  const entity = new UserEntity(data);
         *  entity.onValueChanged.subscribe((data: Modification) => {
         *      console.log(data);
         *  })
         *
         * ```
         *
         * @event
         */
        this.onValueChanged = this.valueChanged.asObservable();
        /**
         * 是否变更
         */
        this.hasChange = false;
        this.newData = Object.assign({}, data);
        this.onValueChanged = this.valueChanged;
        this.initialize();
    }
    Object.defineProperty(Entity.prototype, "data", {
        /**
         * 返回JSON格式的数据
         */
        get: function () {
            return this.newData;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Entity.prototype, "errors", {
        /**
         * 验证错误集合
         */
        get: function () {
            return this.validErrors;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Entity.prototype, "changes", {
        /**
         * 实体变更集
         */
        get: function () {
            return this.changeSet.changes;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Entity.prototype, "primaryProperty", {
        /**
         * 实体主键元数据
         */
        get: function () {
            return FieldMetadataUtil.getPrimaryFieldMetadata(this.constructor);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Entity.prototype, "primaryKey", {
        /**
         * 主键
         * @todo
         * 1、没有主键时返回''不合理，应该返回undefined
         */
        get: function () {
            if (this.primaryProperty) {
                return this.primaryProperty.property;
            }
            else {
                return '';
            }
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Entity.prototype, "primaryValue", {
        /**
         * 实体主键值
         * 1、没有主键时返回''不合理，应该返回undefined
         */
        get: function () {
            if (this.primaryKey) {
                // return this[this.primaryProperty.property].toString();
                var primaryValue = this[this.primaryProperty.property];
                return primaryValue ? primaryValue : '';
            }
            else {
                return '';
            }
        },
        enumerable: true,
        configurable: true
    });
    // #region 公有方法
    /**
     * 将变更记录保存至变更集中
     * @param value 变更记录
     */
    Entity.prototype.setChanges = function (value) {
        var propertyName = value.path[value.path.length - 1];
        // 增加实体变化后增加标志，加载数据或者重新加载不做标记
        if (value.type !== ModifyType.Load) {
            this.hasChange = true;
        }
        // @todo：事件会从下级向上冒泡，change可能是下级的，不能和当前Entity的newData合并。
        // this.newData = Object.assign(this.newData, { [propertyName]: value.value });
        this.valueChanged.next(value);
        this.changeSet.append(value);
    };
    Entity.prototype.getPaths = function () {
        var pathObj = {
            path: [],
            isUdt: false,
            isGrid: false
        };
        var handleParent = function (item) {
            var parentPaths = item[PARENT_PATH];
            if (parentPaths) {
                var prop = parentPaths[parentPaths.length - 1];
                // 父级所在实体包含的ngObject，存在当前实体字段，则判断为UDt字段
                if (Object.keys(FieldMetadataUtil.getNgObjects(item[PARENT_CLASS].constructor)).indexOf(prop) > -1) {
                    pathObj.isUdt = true;
                }
                // 存在类型为ngList，则判断为grid
                if (item[PARENT_CLASS] && item instanceof EntityList === true) {
                    pathObj.isGrid = true;
                }
                pathObj.path.push(prop);
            }
            if (item[PARENT_CLASS] && item instanceof EntityList === true) {
                handleParent(item[PARENT_CLASS]);
            }
        };
        handleParent(this);
        pathObj.path = pathObj.path.reverse();
        return pathObj;
    };
    /**
     * 加载数据
     * @param data 新数据
     */
    Entity.prototype.load = function (data) {
        if (!data) {
            data = {};
        }
        this.loadFields(data);
        this.loadLists(data);
        this.loadObjects(data);
        this.loadDynamicObjects(data);
        this.newData = Object.assign({}, data);
    };
    /**
     * 转换为JSON
     */
    Entity.prototype.toJSON = function () {
        var _this = this;
        var result = {};
        // 简单属性
        var ngFields = FieldMetadataUtil.getNgFields(this.constructor);
        Object.keys(ngFields).forEach(function (propName) {
            var ngField = ngFields[propName];
            var dataField = ngField.dataField || propName;
            result[dataField] = _this[propName];
        });
        // 对象属性
        var ngObjects = FieldMetadataUtil.getNgObjects(this.constructor);
        Object.keys(ngObjects).forEach(function (propName) {
            var ngObject = ngObjects[propName];
            var dataField = ngObject.dataField || propName;
            result[dataField] = _this[propName] ? _this[propName].toJSON() : {};
        });
        // 动态属性
        var ngDynamics = FieldMetadataUtil.getNgDynamic(this.constructor);
        Object.keys(ngDynamics).forEach(function (propName) {
            var ngDynamic = ngDynamics[propName];
            var dataField = ngDynamic.dataField || propName;
            result[dataField] = _this[propName] ? _this[propName].toJSON() : {};
        });
        // 列表属性
        var ngLists = FieldMetadataUtil.getNgList(this.constructor);
        Object.keys(ngLists).forEach(function (propName) {
            var ngList = ngLists[propName];
            var dataField = ngList.dataField || propName;
            result[dataField] = _this[propName] ? _this[propName].toJSON() : {};
        });
        return result;
    };
    // #endregion
    //#region 实体初始化相关private方法
    /**
     * 初始化实体
     */
    Entity.prototype.initialize = function () {
        var constructor = this.constructor;
        var ngFields = FieldMetadataUtil.getNgFields(constructor);
        var ngObjects = FieldMetadataUtil.getNgObjects(constructor);
        var ngLists = FieldMetadataUtil.getNgList(constructor);
        var ngDynamic = FieldMetadataUtil.getNgDynamic(constructor);
        this.initializeNormalField(ngFields);
        this.initializeList(ngLists);
        this.initializeObject(ngObjects);
        this.initializeDynamic(ngDynamic);
    };
    /**
     * 创建path
     * @param propertyName 属性名称
     */
    Entity.prototype.createPath = function (propertyName) {
        var primaryFieldMetadata = this.primaryProperty;
        if (primaryFieldMetadata) {
            var primaryDataField = primaryFieldMetadata.dataField;
            return [primaryDataField + ':' + this.primaryValue, propertyName];
        }
        else {
            return [':', propertyName];
        }
    };
    /**
     * 属性字段初始化
     * @param ngFields 属性字段元数据
     */
    Entity.prototype.initializeNormalField = function (ngFields) {
        var _this = this;
        Object.keys(ngFields).forEach(function (propName) {
            var ngField = ngFields[propName];
            var dataField = ngField.dataField || propName;
            if (delete _this[propName]) {
                Object.defineProperty(_this, propName, {
                    get: function () {
                        return this.getPropValue(propName, ngField);
                    },
                    set: function (newPropValue) {
                        // 影响清空关联字段的主键值，移除此逻辑
                        // // 有主键的实体，不允许给实体赋空值
                        // if (this.primaryKey && this.primaryKey === propName && !newPropValue) {
                        //   return;
                        // }
                        // 有主键的实体，必须先给主键赋值，否则其他字段不允许赋值
                        if (this.primaryKey && this.primaryKey !== propName && !this.primaryValue) {
                            return;
                        }
                        // 值相同时不触发变更。
                        var oldPropValue = this.getPropValue(propName, ngField);
                        if (this.isPropValueChanged(propName, ngField, newPropValue, oldPropValue) === false) {
                            return;
                        }
                        this.setPropValue(propName, ngField, newPropValue);
                        this.emitValueChange(propName, ngField, newPropValue, oldPropValue);
                    },
                    configurable: true
                });
            }
        });
    };
    /**
     * 初始化列表类型的元数据
     * @param ngListMetadata 列表类型元数据
     */
    Entity.prototype.initializeList = function (ngListMetadata) {
        var _this = this;
        Object.keys(ngListMetadata).forEach(function (propertyName) {
            var fieldMetadata = ngListMetadata[propertyName];
            var path = _this.createPath(propertyName);
            var dataField = fieldMetadata.dataField || propertyName;
            var val = _this.data[dataField];
            var entityList = new EntityList();
            entityList[PARENT_CLASS] = _this;
            entityList[PARENT_PATH] = path;
            if (val) {
                var entities = val.map(function (v) { return EntityFactory(fieldMetadata.type, v); });
                entityList.loadEntities(entities);
            }
            entityList.onListChanged.subscribe(function (value) {
                if (value) {
                    if (entityList[PARENT_PATH][0] !== value.path[0]) {
                        value.path = entityList[PARENT_PATH].concat(value.path);
                    }
                    _this.setChanges(value);
                }
            });
            _this[propertyName] = entityList;
        });
    };
    /**
     * 初始化子对象
     * @param ngObjectMetadata 子对象元数据
     */
    Entity.prototype.initializeObject = function (ngObjectMetadata) {
        var _this = this;
        Object.keys(ngObjectMetadata).forEach(function (propertyName) {
            var fieldMetadata = ngObjectMetadata[propertyName];
            var path = _this.createPath(propertyName);
            var dataField = fieldMetadata.dataField || propertyName;
            // val不存在时，用空对象代替
            var val = _this.data[dataField] || {};
            var createEntityFromJsonData = function (value) {
                var instance;
                if (value instanceof fieldMetadata.type) {
                    instance = value;
                }
                else {
                    instance = EntityFactory(fieldMetadata.type, value);
                }
                instance[PARENT_CLASS] = _this;
                instance[PARENT_PATH] = path;
                instance.onValueChanged.subscribe(function (changes) {
                    if (changes) {
                        changes.path = (_this[PARENT_PATH] || []).concat(changes.path);
                        _this.setChanges(changes);
                    }
                });
                return instance;
            };
            // 如果没有值用一个空对象代替
            var childEntity = createEntityFromJsonData(val);
            if (delete _this[propertyName]) {
                Object.defineProperty(_this, propertyName, {
                    get: function () {
                        return childEntity;
                    },
                    set: function (value) {
                        var modifyInfo = {
                            path: childEntity[PARENT_PATH],
                            value: value.data,
                            preValue: this[propertyName].data,
                            type: ModifyType.ValueChange
                        };
                        childEntity = createEntityFromJsonData(value);
                        this.setChanges(modifyInfo);
                    },
                    configurable: true
                });
            }
        });
    };
    Entity.prototype.initializeDynamic = function (ngDynamicMetadata) {
        var _this = this;
        Object.keys(ngDynamicMetadata).forEach(function (propertyName) {
            var fieldMetadata = ngDynamicMetadata[propertyName];
            var path = _this.createPath(propertyName);
            var dataField = fieldMetadata.dataField || propertyName;
            var originalData = _this.data[dataField] || {};
            var createEntityFromJsonData = function (value) {
                var instance;
                if (value instanceof fieldMetadata.type) {
                    instance = value;
                }
                else {
                    instance = EntityFactory(fieldMetadata.type, value);
                }
                instance[PARENT_CLASS] = _this;
                instance[PARENT_PATH] = path;
                instance.onValueChanged.subscribe(function (changes) {
                    if (changes) {
                        changes.path = (_this[PARENT_PATH] || []).concat(changes.path);
                        _this.setChanges(changes);
                    }
                });
                return instance;
            };
            var dynamicEntity = createEntityFromJsonData(originalData);
            if (delete _this[propertyName]) {
                Object.defineProperty(_this, propertyName, {
                    get: function () {
                        return dynamicEntity;
                    },
                    set: function (value) {
                        var modifyInfo = {
                            path: dynamicEntity[PARENT_PATH],
                            value: value.data,
                            preValue: this[propertyName].data,
                            type: ModifyType.ValueChange
                        };
                        dynamicEntity = createEntityFromJsonData(value);
                        this.setChanges(modifyInfo);
                    },
                    configurable: true
                });
            }
        });
    };
    //#endregion
    // #region 加载实体数据相关private、projected方法
    /**
     * 加载简单字段值
     * @todo 临时用修改的方式模拟
     */
    Entity.prototype.loadFields = function (data) {
        var _this = this;
        var ngFields = FieldMetadataUtil.getNgFields(this.constructor);
        Object.keys(ngFields).forEach(function (propName) {
            var ngField = ngFields[propName];
            var dataField = ngField.dataField || propName;
            // if (ngField.primary === false) {
            //   this[propName] = data[dataField];
            // }
            _this[propName] = data[dataField];
        });
    };
    /**
     * 加载子列表数据
     * @param data 数据
     */
    Entity.prototype.loadLists = function (data) {
        var _this = this;
        var ngLists = FieldMetadataUtil.getNgList(this.constructor);
        Object.keys(ngLists).forEach(function (propName) {
            var ngList = ngLists[propName];
            var dataField = ngList.dataField || propName;
            var entityType = ngList.type;
            // 创建实体
            var listData = data[dataField];
            if (listData) {
                var entities = listData.map(function (entityData) {
                    return EntityFactory(entityType, entityData);
                });
                _this[propName].loadEntities(entities);
            }
            else {
                _this[propName].loadEntities([]);
            }
        });
    };
    Entity.prototype.loadObjects = function (data) {
        var _this = this;
        var ngObjects = FieldMetadataUtil.getNgObjects(this.constructor);
        Object.keys(ngObjects).forEach(function (propName) {
            var ngObject = ngObjects[propName];
            var dataField = ngObject.dataField || propName;
            var objectData = data[dataField];
            var entity = _this[propName];
            if (!entity || !objectData) {
                return;
            }
            entity.load(objectData);
        });
    };
    Entity.prototype.loadDynamicObjects = function (data) {
        var _this = this;
        var ngDynamicObjects = FieldMetadataUtil.getNgDynamic(this.constructor);
        Object.keys(ngDynamicObjects).forEach(function (propName) {
            var ngDynamicObject = ngDynamicObjects[propName];
            var dataField = ngDynamicObject.dataField || propName;
            var dynamicData = data[dataField] || {};
            var dynamicEntity = _this[propName];
            if (!dynamicEntity) {
                return;
            }
            dynamicEntity.loadDynamicData(dynamicData);
        });
    };
    // #endregion
    // #region 私有工具方法
    /**
     * 发送值变更
     */
    Entity.prototype.emitValueChange = function (propName, propMetadata, newPropValue, oldPropValue) {
        var change = {
            path: this.createPath(propName),
            value: newPropValue,
            preValue: oldPropValue,
            type: ModifyType.ValueChange
        };
        if (this[PARENT_PATH]) {
            change.path = this[PARENT_PATH].concat(change.path);
        }
        this.setChanges(change);
    };
    /**
     * 获取属性值
     */
    Entity.prototype.getPropValue = function (propName, propMetadata) {
        var _a;
        var dataField = propMetadata.dataField || propName;
        var value = this.data[dataField];
        // 对多语录入字段，query不返回问题进行兼容
        if (propMetadata.enableMultiLangInput === true && !value) {
            var langCode = window.localStorage.getItem('languageCode') || 'zh-CHS';
            var originDataField = dataField.replace('_MULTILANGUAGE', '');
            return _a = {},
                _a[langCode] = this.data[originDataField],
                _a;
        }
        return value;
    };
    /**
     * 设置属性值
     */
    Entity.prototype.setPropValue = function (propName, propMetadata, propValue) {
        var dataField = propMetadata.dataField || propName;
        this.data[dataField] = propValue;
    };
    /**
     * 检查属性值是否发生变化
     */
    Entity.prototype.isPropValueChanged = function (propName, propMetadata, newPropValue, oldPropValue) {
        if (propMetadata.enableMultiLangInput === true) {
            if (this.isEmptyMultiLangPropValue(newPropValue) === true && this.isEmptyMultiLangPropValue(oldPropValue) === true) {
                return false;
            }
            return JSON.stringify(newPropValue) !== JSON.stringify(oldPropValue);
        }
        else {
            return newPropValue !== oldPropValue;
        }
    };
    /**
     * 多语录入字段的值是否为空
     */
    Entity.prototype.isEmptyMultiLangPropValue = function (value) {
        return !value || Object.keys(value).length === 0;
    };
    return Entity;
}());
export { Entity };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZW50aXR5LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy9tb2JpbGUtZGV2a2l0LyIsInNvdXJjZXMiOlsibGliL2VudGl0eS9lbnRpdHkudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFjLE9BQU8sRUFBWSxNQUFNLE1BQU0sQ0FBQztBQUVyRCxPQUFPLEVBQW9GLGlCQUFpQixFQUFFLE1BQU0sa0JBQWtCLENBQUM7QUFBQSxDQUFDO0FBQ3hJLE9BQU8sRUFBZ0IsVUFBVSxFQUFFLFNBQVMsRUFBRSxNQUFNLG9CQUFvQixDQUFDO0FBQ3pFLE9BQU8sRUFBRSxXQUFXLEVBQUUsWUFBWSxFQUFXLE1BQU0sU0FBUyxDQUFDO0FBQzdELE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDM0MsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLGtCQUFrQixDQUFDO0FBRWpEOzs7Ozs7Ozs7Ozs7Ozs7R0FlRztBQUNIO0lBK0dFLGFBQWE7SUFHYjs7T0FFRztJQUNILGdCQUFZLElBQVM7UUFsSHJCLGtCQUFrQjtRQUVsQjs7V0FFRztRQUNLLGdCQUFXLEdBQUcsRUFBRSxDQUFDO1FBRXpCOztXQUVHO1FBQ08sY0FBUyxHQUFHLElBQUksU0FBUyxFQUFFLENBQUM7UUFFdEM7O1dBRUc7UUFDTyxpQkFBWSxHQUFHLEtBQUssQ0FBQztRQUUvQjs7V0FFRztRQUNPLFlBQU8sR0FBRyxTQUFTLENBQUM7UUFFOUIsYUFBYTtRQUdiLGVBQWU7UUFFZjs7V0FFRztRQUNJLGlCQUFZLEdBQUcsSUFBSSxPQUFPLEVBQWdCLENBQUM7UUFFbEQ7Ozs7Ozs7Ozs7Ozs7V0FhRztRQUNJLG1CQUFjLEdBQUcsSUFBSSxDQUFDLFlBQVksQ0FBQyxZQUFZLEVBQUUsQ0FBQztRQXVCekQ7O1dBRUc7UUFDSSxjQUFTLEdBQUcsS0FBSyxDQUFDO1FBMkN2QixJQUFJLENBQUMsT0FBTyxHQUFHLE1BQU0sQ0FBQyxNQUFNLENBQUMsRUFBRSxFQUFFLElB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LE1BQU0sS0FBSyxDQUFDLENBQUM7SUFDbkQsQ0FBQztJQUdILGFBQUM7QUFBRCxDQUFDLEFBMWtCRCxJQTBrQkMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBPYnNlcnZhYmxlLCBTdWJqZWN0LCBmcm9tLCBvZiB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgc2NhbiwgbWFwLCB0YXAgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQgeyBQcmltaXRpdmVQcm9wTWV0YWRhdGEsIExpc3RQcm9wTWV0YWRhdGEsIE9iamVjdFByb3BNZXRhZGF0YSwgRHluYW1pY1Byb3BNZXRhZGF0YSwgRmllbGRNZXRhZGF0YVV0aWwgfSBmcm9tICcuL21ldGFkYXRhL2luZGV4Jzs7XG5pbXBvcnQgeyBNb2RpZmljYXRpb24sIE1vZGlmeVR5cGUsIENoYW5nZVNldCB9IGZyb20gJy4uL2NoYW5nZXNldC9pbmRleCc7XG5pbXBvcnQgeyBQQVJFTlRfUEFUSCwgUEFSRU5UX0NMQVNTLCBEeW5hbWljIH0gZnJvbSAnLi90eXBlcyc7XG5pbXBvcnQgeyBFbnRpdHlMaXN0IH0gZnJvbSAnLi9lbnRpdHlfbGlzdCc7XG5pbXBvcnQgeyBFbnRpdHlGYWN0b3J5IH0gZnJvbSAnLi9lbnRpdHlfZmFjdG9yeSc7XG5cbi8qKlxuICogQGF1dGhvciBMdWNhcyBIdWFuZ1xuICog5a6e5L2T5oq96LGh5Z+657G777yM5omA5pyJ5a6e5L2T5b+F6aG75omp5bGV6IeqRW50aXR5XG4gKlxuICogIyMjIOS9v+eUqOekuuS+i1xuICogYGBgXG4gKiBleHBvcnQgY2xhc3MgVXNlckVudGl0eSBleHRlbmRzIEVudGl0eSB7XG4gKiAgICB1c2VySWQ6IHN0cmluZztcbiAqICAgIHVzZXJOYW1lOiBzdHJpbmc7XG4gKlxuICogICAgY29uc3RydWN0b3IoZGF0YTogYW55KXtcbiAqICAgICAgICBzdXBlcihkYXRhKTtcbiAqICAgIH1cbiAqIH1cbiAqIGBgYFxuICovXG5leHBvcnQgYWJzdHJhY3QgY2xhc3MgRW50aXR5IHtcblxuXG4gIC8vICNyZWdpb24g56eB5pyJ44CB5L+d5oqk5bGe5oCnXG5cbiAgLyoqXG4gICAqIOmqjOivgemUmeivr+mbhuWQiFxuICAgKi9cbiAgcHJpdmF0ZSB2YWxpZEVycm9ycyA9IHt9O1xuXG4gIC8qKlxuICAgKiDlop7ph4/lj5jmm7Tpm4blkIhcbiAgICovXG4gIHByb3RlY3RlZCBjaGFuZ2VTZXQgPSBuZXcgQ2hhbmdlU2V0KCk7XG5cbiAgLyoqXG4gICAqIOaYr+WQpuato+WcqOmqjOivgVxuICAgKi9cbiAgcHJvdGVjdGVkIGlzVmFsaWRhdGluZyA9IGZhbHNlO1xuXG4gIC8qKlxuICAgKiDmlrDmlbDmja5cbiAgICovXG4gIHByb3RlY3RlZCBuZXdEYXRhID0gdW5kZWZpbmVkO1xuXG4gIC8vICNlbmRyZWdpb25cblxuXG4gIC8vICNyZWdpb24g5YWs5pyJ5bGe5oCnXG5cbiAgLyoqXG4gICAqIOWPmOabtOa1gVxuICAgKi9cbiAgcHVibGljIHZhbHVlQ2hhbmdlZCA9IG5ldyBTdWJqZWN0PE1vZGlmaWNhdGlvbj4oKTtcblxuICAvKipcbiAgICog5bGe5oCn5YC85pS55Y+Y5pe26Kem5Y+RXG4gICAqXG4gICAqICMjIyDkvb/nlKjnpLrkvotcbiAgICogYGBgXG4gICAqICBjb25zdCBlbnRpdHkgPSBuZXcgVXNlckVudGl0eShkYXRhKTtcbiAgICogIGVudGl0eS5vblZhbHVlQ2hhbmdlZC5zdWJzY3JpYmUoKGRhdGE6IE1vZGlmaWNhdGlvbikgPT4ge1xuICAgKiAgICAgIGNvbnNvbGUubG9nKGRhdGEpO1xuICAgKiAgfSlcbiAgICpcbiAgICogYGBgXG4gICAqXG4gICAqIEBldmVudFxuICAgKi9cbiAgcHVibGljIG9uVmFsdWVDaGFuZ2VkID0gdGhpcy52YWx1ZUNoYW5nZWQuYXNPYnNlcnZhYmxlKCk7XG5cbiAgLyoqXG4gICAqIOi/lOWbnkpTT07moLzlvI/nmoTmlbDmja5cbiAgICovXG4gIHB1YmxpYyBnZXQgZGF0YSgpOiBhbnkge1xuICAgIHJldHVybiB0aGlzLm5ld0RhdGE7XG4gIH1cblxuICAvKipcbiAgICog6aqM6K+B6ZSZ6K+v6ZuG5ZCIXG4gICAqL1xuICBwdWJsaWMgZ2V0IGVycm9ycygpIHtcbiAgICByZXR1cm4gdGhpcy52YWxpZEVycm9ycztcbiAgfVxuXG4gIC8qKlxuICAgKiDlrp7kvZPlj5jmm7Tpm4ZcbiAgICovXG4gIHB1YmxpYyBnZXQgY2hhbmdlcygpOiBNb2RpZmljYXRpb25bXSB7XG4gICAgcmV0dXJuIHRoaXMuY2hhbmdlU2V0LmNoYW5nZXM7XG4gIH1cblxuICAvKipcbiAgICog5piv5ZCm5Y+Y5pu0XG4gICAqL1xuICBwdWJsaWMgaGFzQ2hhbmdlID0gZmFsc2U7XG5cbiAgLyoqXG4gICAqIOWunuS9k+S4u+mUruWFg+aVsOaNrlxuICAgKi9cbiAgcHVibGljIGdldCBwcmltYXJ5UHJvcGVydHkoKTogUHJpbWl0aXZlUHJvcE1ldGFkYXRhIHtcbiAgICByZXR1cm4gRmllbGRNZXRhZGF0YVV0aWwuZ2V0UHJpbWFyeUZpZWxkTWV0YWRhdGEodGhpcy5jb25zdHJ1Y3Rvcik7XG4gIH1cblxuICAvKipcbiAgICog5Li76ZSuXG4gICAqIEB0b2RvXG4gICAqIDHjgIHmsqHmnInkuLvplK7ml7bov5Tlm54nJ+S4jeWQiOeQhu+8jOW6lOivpei/lOWbnnVuZGVmaW5lZFxuICAgKi9cbiAgcHVibGljIGdldCBwcmltYXJ5S2V5KCk6IHN0cmluZyB7XG4gICAgaWYgKHRoaXMucHJpbWFyeVByb3BlcnR5KSB7XG4gICAgICByZXR1cm4gdGhpcy5wcmltYXJ5UHJvcGVydHkucHJvcGVydHk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiAnJztcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICog5a6e5L2T5Li76ZSu5YC8XG4gICAqIDHjgIHmsqHmnInkuLvplK7ml7bov5Tlm54nJ+S4jeWQiOeQhu+8jOW6lOivpei/lOWbnnVuZGVmaW5lZFxuICAgKi9cbiAgcHVibGljIGdldCBwcmltYXJ5VmFsdWUoKTogc3RyaW5nIHtcbiAgICBpZiAodGhpcy5wcmltYXJ5S2V5KSB7XG4gICAgICAvLyByZXR1cm4gdGhpc1t0aGlzLnByaW1hcnlQcm9wZXJ0eS5wcm9wZXJ0eV0udG9TdHJpbmcoKTtcbiAgICAgIGNvbnN0IHByaW1hcnlWYWx1ZSA9IHRoaXNbdGhpcy5wcmltYXJ5UHJvcGVydHkucHJvcGVydHldO1xuICAgICAgcmV0dXJuIHByaW1hcnlWYWx1ZSA/IHByaW1hcnlWYWx1ZSA6ICcnO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gJyc7XG4gICAgfVxuICB9XG5cbiAgLy8gI2VuZHJlZ2lvblxuXG5cbiAgLyoqXG4gICAqIEBwYXJhbSBkYXRhIEpTT07mlbDmja5cbiAgICovXG4gIGNvbnN0cnVjdG9yKGRhdGE6IGFueSkge1xuICAgIHRoaXMubmV3RGF0YSA9IE9iamVjdC5hc3NpZ24oe30sIGRhdGEpO1xuICAgIHRoaXMub25WYWx1ZUNoYW5nZWQgPSB0aGlzLnZhbHVlQ2hhbmdlZDtcbiAgICB0aGlzLmluaXRpYWxpemUoKTtcbiAgfVxuXG5cbiAgLy8gI3JlZ2lvbiDlhazmnInmlrnms5VcblxuICAvKipcbiAgICog5bCG5Y+Y5pu06K6w5b2V5L+d5a2Y6Iez5Y+Y5pu06ZuG5LitXG4gICAqIEBwYXJhbSB2YWx1ZSDlj5jmm7TorrDlvZVcbiAgICovXG4gIHB1YmxpYyBzZXRDaGFuZ2VzKHZhbHVlOiBNb2RpZmljYXRpb24pOiB2b2lkIHtcbiAgICBjb25zdCBwcm9wZXJ0eU5hbWUgPSB2YWx1ZS5wYXRoW3ZhbHVlLnBhdGgubGVuZ3RoIC0gMV07XG4gICAgLy8g5aKe5Yqg5a6e5L2T5Y+Y5YyW5ZCO5aKe5Yqg5qCH5b+X77yM5Yqg6L295pWw5o2u5oiW6ICF6YeN5paw5Yqg6L295LiN5YGa5qCH6K6wXG4gICAgaWYgKHZhbHVlLnR5cGUgIT09IE1vZGlmeVR5cGUuTG9hZCkgeyB0aGlzLmhhc0NoYW5nZSA9IHRydWU7IH1cblxuICAgIC8vIEB0b2Rv77ya5LqL5Lu25Lya5LuO5LiL57qn5ZCR5LiK5YaS5rOh77yMY2hhbmdl5Y+v6IO95piv5LiL57qn55qE77yM5LiN6IO95ZKM5b2T5YmNRW50aXR555qEbmV3RGF0YeWQiOW5tuOAglxuICAgIC8vIHRoaXMubmV3RGF0YSA9IE9iamVjdC5hc3NpZ24odGhpcy5uZXdEYXRhLCB7IFtwcm9wZXJ0eU5hbWVdOiB2YWx1ZS52YWx1ZSB9KTtcbiAgICB0aGlzLnZhbHVlQ2hhbmdlZC5uZXh0KHZhbHVlKTtcbiAgICB0aGlzLmNoYW5nZVNldC5hcHBlbmQodmFsdWUpO1xuICB9XG5cbiAgcHVibGljIGdldFBhdGhzKCkge1xuICAgIGNvbnN0IHBhdGhPYmogPSB7XG4gICAgICBwYXRoOiBbXSxcbiAgICAgIGlzVWR0OiBmYWxzZSxcbiAgICAgIGlzR3JpZDogZmFsc2VcbiAgICB9O1xuICAgIGNvbnN0IGhhbmRsZVBhcmVudCA9IGl0ZW0gPT4ge1xuICAgICAgY29uc3QgcGFyZW50UGF0aHMgPSBpdGVtW1BBUkVOVF9QQVRIXTtcbiAgICAgIGlmIChwYXJlbnRQYXRocykge1xuICAgICAgICBjb25zdCBwcm9wID0gcGFyZW50UGF0aHNbcGFyZW50UGF0aHMubGVuZ3RoIC0gMV07XG4gICAgICAgIC8vIOeItue6p+aJgOWcqOWunuS9k+WMheWQq+eahG5nT2JqZWN077yM5a2Y5Zyo5b2T5YmN5a6e5L2T5a2X5q6177yM5YiZ5Yik5pat5Li6VUR05a2X5q61XG4gICAgICAgIGlmIChPYmplY3Qua2V5cyhGaWVsZE1ldGFkYXRhVXRpbC5nZXROZ09iamVjdHMoaXRlbVtQQVJFTlRfQ0xBU1NdLmNvbnN0cnVjdG9yKSkuaW5kZXhPZihwcm9wKSA+IC0xKSB7XG4gICAgICAgICAgcGF0aE9iai5pc1VkdCA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgLy8g5a2Y5Zyo57G75Z6L5Li6bmdMaXN077yM5YiZ5Yik5pat5Li6Z3JpZFxuICAgICAgICBpZiAoaXRlbVtQQVJFTlRfQ0xBU1NdICYmIGl0ZW0gaW5zdGFuY2VvZiBFbnRpdHlMaXN0ID09PSB0cnVlKSB7XG4gICAgICAgICAgcGF0aE9iai5pc0dyaWQgPSB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIHBhdGhPYmoucGF0aC5wdXNoKHByb3ApO1xuICAgICAgfVxuICAgICAgaWYgKGl0ZW1bUEFSRU5UX0NMQVNTXSAmJiBpdGVtIGluc3RhbmNlb2YgRW50aXR5TGlzdCA9PT0gdHJ1ZSkge1xuICAgICAgICBoYW5kbGVQYXJlbnQoaXRlbVtQQVJFTlRfQ0xBU1NdKTtcbiAgICAgIH1cbiAgICB9O1xuICAgIGhhbmRsZVBhcmVudCh0aGlzKTtcbiAgICBwYXRoT2JqLnBhdGggPSBwYXRoT2JqLnBhdGgucmV2ZXJzZSgpO1xuICAgIHJldHVybiBwYXRoT2JqO1xuICB9XG5cbiAgLyoqXG4gICAqIOWKoOi9veaVsOaNrlxuICAgKiBAcGFyYW0gZGF0YSDmlrDmlbDmja5cbiAgICovXG4gIHB1YmxpYyBsb2FkKGRhdGE6IGFueSkge1xuICAgIGlmICghZGF0YSkge1xuICAgICAgZGF0YSA9IHt9O1xuICAgIH1cblxuICAgIHRoaXMubG9hZEZpZWxkcyhkYXRhKTtcbiAgICB0aGlzLmxvYWRMaXN0cyhkYXRhKTtcbiAgICB0aGlzLmxvYWRPYmplY3RzKGRhdGEpO1xuXG4gICAgdGhpcy5sb2FkRHluYW1pY09iamVjdHMoZGF0YSk7XG4gICAgdGhpcy5uZXdEYXRhID0gT2JqZWN0LmFzc2lnbih7fSwgZGF0YSk7XG4gIH1cblxuICAvKipcbiAgICog6L2s5o2i5Li6SlNPTlxuICAgKi9cbiAgcHVibGljIHRvSlNPTigpIHtcbiAgICBjb25zdCByZXN1bHQgPSB7fTtcblxuICAgIC8vIOeugOWNleWxnuaAp1xuICAgIGNvbnN0IG5nRmllbGRzID0gRmllbGRNZXRhZGF0YVV0aWwuZ2V0TmdGaWVsZHModGhpcy5jb25zdHJ1Y3Rvcik7XG4gICAgT2JqZWN0LmtleXMobmdGaWVsZHMpLmZvckVhY2goKHByb3BOYW1lOiBzdHJpbmcpID0+IHtcbiAgICAgIGNvbnN0IG5nRmllbGQgPSBuZ0ZpZWxkc1twcm9wTmFtZV07XG4gICAgICBjb25zdCBkYXRhRmllbGQgPSBuZ0ZpZWxkLmRhdGFGaWVsZCB8fCBwcm9wTmFtZTtcbiAgICAgIHJlc3VsdFtkYXRhRmllbGRdID0gdGhpc1twcm9wTmFtZV07XG4gICAgfSk7XG5cbiAgICAvLyDlr7nosaHlsZ7mgKdcbiAgICBjb25zdCBuZ09iamVjdHMgPSBGaWVsZE1ldGFkYXRhVXRpbC5nZXROZ09iamVjdHModGhpcy5jb25zdHJ1Y3Rvcik7XG4gICAgT2JqZWN0LmtleXMobmdPYmplY3RzKS5mb3JFYWNoKChwcm9wTmFtZTogc3RyaW5nKSA9PiB7XG4gICAgICBjb25zdCBuZ09iamVjdCA9IG5nT2JqZWN0c1twcm9wTmFtZV07XG4gICAgICBjb25zdCBkYXRhRmllbGQgPSBuZ09iamVjdC5kYXRhRmllbGQgfHwgcHJvcE5hbWU7XG4gICAgICByZXN1bHRbZGF0YUZpZWxkXSA9IHRoaXNbcHJvcE5hbWVdID8gdGhpc1twcm9wTmFtZV0udG9KU09OKCkgOiB7fTtcbiAgICB9KTtcblxuICAgIC8vIOWKqOaAgeWxnuaAp1xuICAgIGNvbnN0IG5nRHluYW1pY3MgPSBGaWVsZE1ldGFkYXRhVXRpbC5nZXROZ0R5bmFtaWModGhpcy5jb25zdHJ1Y3Rvcik7XG4gICAgT2JqZWN0LmtleXMobmdEeW5hbWljcykuZm9yRWFjaCgocHJvcE5hbWU6IHN0cmluZykgPT4ge1xuICAgICAgY29uc3QgbmdEeW5hbWljID0gbmdEeW5hbWljc1twcm9wTmFtZV07XG4gICAgICBjb25zdCBkYXRhRmllbGQgPSBuZ0R5bmFtaWMuZGF0YUZpZWxkIHx8IHByb3BOYW1lO1xuICAgICAgcmVzdWx0W2RhdGFGaWVsZF0gPSB0aGlzW3Byb3BOYW1lXSA/IHRoaXNbcHJvcE5hbWVdLnRvSlNPTigpIDoge307XG4gICAgfSk7XG5cbiAgICAvLyDliJfooajlsZ7mgKdcbiAgICBjb25zdCBuZ0xpc3RzID0gRmllbGRNZXRhZGF0YVV0aWwuZ2V0TmdMaXN0KHRoaXMuY29uc3RydWN0b3IpO1xuICAgIE9iamVjdC5rZXlzKG5nTGlzdHMpLmZvckVhY2goKHByb3BOYW1lOiBzdHJpbmcpID0+IHtcbiAgICAgIGNvbnN0IG5nTGlzdCA9IG5nTGlzdHNbcHJvcE5hbWVdO1xuICAgICAgY29uc3QgZGF0YUZpZWxkID0gbmdMaXN0LmRhdGFGaWVsZCB8fCBwcm9wTmFtZTtcbiAgICAgIHJlc3VsdFtkYXRhRmllbGRdID0gdGhpc1twcm9wTmFtZV0gPyB0aGlzW3Byb3BOYW1lXS50b0pTT04oKSA6IHt9O1xuICAgIH0pO1xuXG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxuXG4gIC8vICNlbmRyZWdpb25cblxuXG4gIC8vI3JlZ2lvbiDlrp7kvZPliJ3lp4vljJbnm7jlhbNwcml2YXRl5pa55rOVXG5cbiAgLyoqXG4gICAqIOWIneWni+WMluWunuS9k1xuICAgKi9cbiAgcHJpdmF0ZSBpbml0aWFsaXplKCkge1xuICAgIGNvbnN0IGNvbnN0cnVjdG9yID0gdGhpcy5jb25zdHJ1Y3RvcjtcblxuICAgIGNvbnN0IG5nRmllbGRzID0gRmllbGRNZXRhZGF0YVV0aWwuZ2V0TmdGaWVsZHMoY29uc3RydWN0b3IpO1xuICAgIGNvbnN0IG5nT2JqZWN0cyA9IEZpZWxkTWV0YWRhdGFVdGlsLmdldE5nT2JqZWN0cyhjb25zdHJ1Y3Rvcik7XG4gICAgY29uc3QgbmdMaXN0cyA9IEZpZWxkTWV0YWRhdGFVdGlsLmdldE5nTGlzdChjb25zdHJ1Y3Rvcik7XG4gICAgY29uc3QgbmdEeW5hbWljID0gRmllbGRNZXRhZGF0YVV0aWwuZ2V0TmdEeW5hbWljKGNvbnN0cnVjdG9yKTtcblxuICAgIHRoaXMuaW5pdGlhbGl6ZU5vcm1hbEZpZWxkKG5nRmllbGRzKTtcbiAgICB0aGlzLmluaXRpYWxpemVMaXN0KG5nTGlzdHMpO1xuICAgIHRoaXMuaW5pdGlhbGl6ZU9iamVjdChuZ09iamVjdHMpO1xuICAgIHRoaXMuaW5pdGlhbGl6ZUR5bmFtaWMobmdEeW5hbWljKTtcbiAgfVxuXG4gIC8qKlxuICAgKiDliJvlu7pwYXRoXG4gICAqIEBwYXJhbSBwcm9wZXJ0eU5hbWUg5bGe5oCn5ZCN56ewXG4gICAqL1xuICBwcm90ZWN0ZWQgY3JlYXRlUGF0aChwcm9wZXJ0eU5hbWU6IHN0cmluZyk6IHN0cmluZ1tdIHtcbiAgICBjb25zdCBwcmltYXJ5RmllbGRNZXRhZGF0YSA9IHRoaXMucHJpbWFyeVByb3BlcnR5O1xuICAgIGlmIChwcmltYXJ5RmllbGRNZXRhZGF0YSkge1xuICAgICAgY29uc3QgcHJpbWFyeURhdGFGaWVsZCA9IHByaW1hcnlGaWVsZE1ldGFkYXRhLmRhdGFGaWVsZDtcbiAgICAgIHJldHVybiBbcHJpbWFyeURhdGFGaWVsZCArICc6JyArIHRoaXMucHJpbWFyeVZhbHVlLCBwcm9wZXJ0eU5hbWVdO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gWyc6JywgcHJvcGVydHlOYW1lXTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICog5bGe5oCn5a2X5q615Yid5aeL5YyWXG4gICAqIEBwYXJhbSBuZ0ZpZWxkcyDlsZ7mgKflrZfmrrXlhYPmlbDmja5cbiAgICovXG4gIHByaXZhdGUgaW5pdGlhbGl6ZU5vcm1hbEZpZWxkKG5nRmllbGRzOiB7IFtrZXk6IHN0cmluZ106IFByaW1pdGl2ZVByb3BNZXRhZGF0YSB9KTogdm9pZCB7XG4gICAgT2JqZWN0LmtleXMobmdGaWVsZHMpLmZvckVhY2gocHJvcE5hbWUgPT4ge1xuICAgICAgY29uc3QgbmdGaWVsZCA9IG5nRmllbGRzW3Byb3BOYW1lXSBhcyBQcmltaXRpdmVQcm9wTWV0YWRhdGE7XG4gICAgICBjb25zdCBkYXRhRmllbGQgPSBuZ0ZpZWxkLmRhdGFGaWVsZCB8fCBwcm9wTmFtZTtcblxuICAgICAgaWYgKGRlbGV0ZSB0aGlzW3Byb3BOYW1lXSkge1xuICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgcHJvcE5hbWUsIHtcbiAgICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmdldFByb3BWYWx1ZShwcm9wTmFtZSwgbmdGaWVsZCk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBzZXQ6IGZ1bmN0aW9uIChuZXdQcm9wVmFsdWUpIHtcblxuICAgICAgICAgICAgLy8g5b2x5ZON5riF56m65YWz6IGU5a2X5q6155qE5Li76ZSu5YC877yM56e76Zmk5q2k6YC76L6RXG4gICAgICAgICAgICAvLyAvLyDmnInkuLvplK7nmoTlrp7kvZPvvIzkuI3lhYHorrjnu5nlrp7kvZPotYvnqbrlgLxcbiAgICAgICAgICAgIC8vIGlmICh0aGlzLnByaW1hcnlLZXkgJiYgdGhpcy5wcmltYXJ5S2V5ID09PSBwcm9wTmFtZSAmJiAhbmV3UHJvcFZhbHVlKSB7XG4gICAgICAgICAgICAvLyAgIHJldHVybjtcbiAgICAgICAgICAgIC8vIH1cblxuICAgICAgICAgICAgLy8g5pyJ5Li76ZSu55qE5a6e5L2T77yM5b+F6aG75YWI57uZ5Li76ZSu6LWL5YC877yM5ZCm5YiZ5YW25LuW5a2X5q615LiN5YWB6K646LWL5YC8XG4gICAgICAgICAgICBpZiAodGhpcy5wcmltYXJ5S2V5ICYmIHRoaXMucHJpbWFyeUtleSAhPT0gcHJvcE5hbWUgJiYgIXRoaXMucHJpbWFyeVZhbHVlKSB7XG4gICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8g5YC855u45ZCM5pe25LiN6Kem5Y+R5Y+Y5pu044CCXG4gICAgICAgICAgICBjb25zdCBvbGRQcm9wVmFsdWUgPSB0aGlzLmdldFByb3BWYWx1ZShwcm9wTmFtZSwgbmdGaWVsZCk7XG4gICAgICAgICAgICBpZiAodGhpcy5pc1Byb3BWYWx1ZUNoYW5nZWQocHJvcE5hbWUsIG5nRmllbGQsIG5ld1Byb3BWYWx1ZSwgb2xkUHJvcFZhbHVlKSA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5zZXRQcm9wVmFsdWUocHJvcE5hbWUsIG5nRmllbGQsIG5ld1Byb3BWYWx1ZSk7XG4gICAgICAgICAgICB0aGlzLmVtaXRWYWx1ZUNoYW5nZShwcm9wTmFtZSwgbmdGaWVsZCwgbmV3UHJvcFZhbHVlLCBvbGRQcm9wVmFsdWUpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIOWIneWni+WMluWIl+ihqOexu+Wei+eahOWFg+aVsOaNrlxuICAgKiBAcGFyYW0gbmdMaXN0TWV0YWRhdGEg5YiX6KGo57G75Z6L5YWD5pWw5o2uXG4gICAqL1xuICBwcml2YXRlIGluaXRpYWxpemVMaXN0KG5nTGlzdE1ldGFkYXRhOiB7IFtrZXk6IHN0cmluZ106IExpc3RQcm9wTWV0YWRhdGEgfSk6IHZvaWQge1xuICAgIE9iamVjdC5rZXlzKG5nTGlzdE1ldGFkYXRhKS5mb3JFYWNoKHByb3BlcnR5TmFtZSA9PiB7XG4gICAgICBjb25zdCBmaWVsZE1ldGFkYXRhID0gbmdMaXN0TWV0YWRhdGFbcHJvcGVydHlOYW1lXSBhcyBMaXN0UHJvcE1ldGFkYXRhO1xuICAgICAgY29uc3QgcGF0aCA9IHRoaXMuY3JlYXRlUGF0aChwcm9wZXJ0eU5hbWUpO1xuICAgICAgY29uc3QgZGF0YUZpZWxkID0gZmllbGRNZXRhZGF0YS5kYXRhRmllbGQgfHwgcHJvcGVydHlOYW1lO1xuICAgICAgY29uc3QgdmFsID0gdGhpcy5kYXRhW2RhdGFGaWVsZF07XG5cbiAgICAgIGNvbnN0IGVudGl0eUxpc3QgPSBuZXcgRW50aXR5TGlzdDx0eXBlb2YgZmllbGRNZXRhZGF0YS50eXBlPigpO1xuICAgICAgZW50aXR5TGlzdFtQQVJFTlRfQ0xBU1NdID0gdGhpcztcbiAgICAgIGVudGl0eUxpc3RbUEFSRU5UX1BBVEhdID0gcGF0aDtcblxuICAgICAgaWYgKHZhbCkge1xuICAgICAgICBjb25zdCBlbnRpdGllcyA9IHZhbC5tYXAodiA9PiBFbnRpdHlGYWN0b3J5PHR5cGVvZiBmaWVsZE1ldGFkYXRhLnR5cGU+KGZpZWxkTWV0YWRhdGEudHlwZSwgdikpO1xuICAgICAgICBlbnRpdHlMaXN0LmxvYWRFbnRpdGllcyhlbnRpdGllcyk7XG4gICAgICB9XG5cbiAgICAgIGVudGl0eUxpc3Qub25MaXN0Q2hhbmdlZC5zdWJzY3JpYmUodmFsdWUgPT4ge1xuICAgICAgICBpZiAodmFsdWUpIHtcbiAgICAgICAgICBpZiAoZW50aXR5TGlzdFtQQVJFTlRfUEFUSF1bMF0gIT09IHZhbHVlLnBhdGhbMF0pIHtcbiAgICAgICAgICAgIHZhbHVlLnBhdGggPSBlbnRpdHlMaXN0W1BBUkVOVF9QQVRIXS5jb25jYXQodmFsdWUucGF0aCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHRoaXMuc2V0Q2hhbmdlcyh2YWx1ZSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgdGhpc1twcm9wZXJ0eU5hbWVdID0gZW50aXR5TGlzdDtcbiAgICB9KTtcbiAgfVxuICAvKipcbiAgICog5Yid5aeL5YyW5a2Q5a+56LGhXG4gICAqIEBwYXJhbSBuZ09iamVjdE1ldGFkYXRhIOWtkOWvueixoeWFg+aVsOaNrlxuICAgKi9cbiAgcHJpdmF0ZSBpbml0aWFsaXplT2JqZWN0KG5nT2JqZWN0TWV0YWRhdGE6IHsgW2tleTogc3RyaW5nXTogT2JqZWN0UHJvcE1ldGFkYXRhIH0pIHtcbiAgICBPYmplY3Qua2V5cyhuZ09iamVjdE1ldGFkYXRhKS5mb3JFYWNoKHByb3BlcnR5TmFtZSA9PiB7XG4gICAgICBjb25zdCBmaWVsZE1ldGFkYXRhID0gbmdPYmplY3RNZXRhZGF0YVtwcm9wZXJ0eU5hbWVdIGFzIE9iamVjdFByb3BNZXRhZGF0YTtcbiAgICAgIGNvbnN0IHBhdGggPSB0aGlzLmNyZWF0ZVBhdGgocHJvcGVydHlOYW1lKTtcbiAgICAgIGNvbnN0IGRhdGFGaWVsZCA9IGZpZWxkTWV0YWRhdGEuZGF0YUZpZWxkIHx8IHByb3BlcnR5TmFtZTtcblxuICAgICAgLy8gdmFs5LiN5a2Y5Zyo5pe277yM55So56m65a+56LGh5Luj5pu/XG4gICAgICBjb25zdCB2YWwgPSB0aGlzLmRhdGFbZGF0YUZpZWxkXSB8fCB7fTtcblxuICAgICAgY29uc3QgY3JlYXRlRW50aXR5RnJvbUpzb25EYXRhID0gKHZhbHVlOiBhbnkpID0+IHtcbiAgICAgICAgbGV0IGluc3RhbmNlO1xuICAgICAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBmaWVsZE1ldGFkYXRhLnR5cGUpIHtcbiAgICAgICAgICBpbnN0YW5jZSA9IHZhbHVlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGluc3RhbmNlID0gRW50aXR5RmFjdG9yeShmaWVsZE1ldGFkYXRhLnR5cGUsIHZhbHVlKTtcbiAgICAgICAgfVxuICAgICAgICBpbnN0YW5jZVtQQVJFTlRfQ0xBU1NdID0gdGhpcztcbiAgICAgICAgaW5zdGFuY2VbUEFSRU5UX1BBVEhdID0gcGF0aDtcblxuICAgICAgICBpbnN0YW5jZS5vblZhbHVlQ2hhbmdlZC5zdWJzY3JpYmUoY2hhbmdlcyA9PiB7XG4gICAgICAgICAgaWYgKGNoYW5nZXMpIHtcbiAgICAgICAgICAgIGNoYW5nZXMucGF0aCA9ICh0aGlzW1BBUkVOVF9QQVRIXSB8fCBbXSkuY29uY2F0KGNoYW5nZXMucGF0aCk7XG4gICAgICAgICAgICB0aGlzLnNldENoYW5nZXMoY2hhbmdlcyk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4gaW5zdGFuY2U7XG4gICAgICB9O1xuXG4gICAgICAvLyDlpoLmnpzmsqHmnInlgLznlKjkuIDkuKrnqbrlr7nosaHku6Pmm79cbiAgICAgIGxldCBjaGlsZEVudGl0eSA9IGNyZWF0ZUVudGl0eUZyb21Kc29uRGF0YSh2YWwpO1xuICAgICAgaWYgKGRlbGV0ZSB0aGlzW3Byb3BlcnR5TmFtZV0pIHtcbiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsIHByb3BlcnR5TmFtZSwge1xuICAgICAgICAgIGdldDogKCkgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIGNoaWxkRW50aXR5O1xuICAgICAgICAgIH0sXG4gICAgICAgICAgc2V0OiBmdW5jdGlvbiAodmFsdWU6IGFueSkge1xuICAgICAgICAgICAgY29uc3QgbW9kaWZ5SW5mbyA9IHtcbiAgICAgICAgICAgICAgcGF0aDogY2hpbGRFbnRpdHlbUEFSRU5UX1BBVEhdLFxuICAgICAgICAgICAgICB2YWx1ZTogdmFsdWUuZGF0YSxcbiAgICAgICAgICAgICAgcHJlVmFsdWU6IHRoaXNbcHJvcGVydHlOYW1lXS5kYXRhLFxuICAgICAgICAgICAgICB0eXBlOiBNb2RpZnlUeXBlLlZhbHVlQ2hhbmdlXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgY2hpbGRFbnRpdHkgPSBjcmVhdGVFbnRpdHlGcm9tSnNvbkRhdGEodmFsdWUpO1xuICAgICAgICAgICAgdGhpcy5zZXRDaGFuZ2VzKG1vZGlmeUluZm8pO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBpbml0aWFsaXplRHluYW1pYyhuZ0R5bmFtaWNNZXRhZGF0YTogeyBba2V5OiBzdHJpbmddOiBEeW5hbWljUHJvcE1ldGFkYXRhIH0pIHtcbiAgICBPYmplY3Qua2V5cyhuZ0R5bmFtaWNNZXRhZGF0YSkuZm9yRWFjaChwcm9wZXJ0eU5hbWUgPT4ge1xuICAgICAgY29uc3QgZmllbGRNZXRhZGF0YSA9IG5nRHluYW1pY01ldGFkYXRhW3Byb3BlcnR5TmFtZV0gYXMgRHluYW1pY1Byb3BNZXRhZGF0YTtcbiAgICAgIGNvbnN0IHBhdGggPSB0aGlzLmNyZWF0ZVBhdGgocHJvcGVydHlOYW1lKTtcbiAgICAgIGNvbnN0IGRhdGFGaWVsZCA9IGZpZWxkTWV0YWRhdGEuZGF0YUZpZWxkIHx8IHByb3BlcnR5TmFtZTtcblxuICAgICAgY29uc3Qgb3JpZ2luYWxEYXRhID0gdGhpcy5kYXRhW2RhdGFGaWVsZF0gfHwge307XG5cbiAgICAgIGNvbnN0IGNyZWF0ZUVudGl0eUZyb21Kc29uRGF0YSA9ICh2YWx1ZTogYW55KSA9PiB7XG4gICAgICAgIGxldCBpbnN0YW5jZTtcbiAgICAgICAgaWYgKHZhbHVlIGluc3RhbmNlb2YgZmllbGRNZXRhZGF0YS50eXBlKSB7XG4gICAgICAgICAgaW5zdGFuY2UgPSB2YWx1ZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBpbnN0YW5jZSA9IEVudGl0eUZhY3RvcnkoZmllbGRNZXRhZGF0YS50eXBlLCB2YWx1ZSk7XG4gICAgICAgIH1cbiAgICAgICAgaW5zdGFuY2VbUEFSRU5UX0NMQVNTXSA9IHRoaXM7XG4gICAgICAgIGluc3RhbmNlW1BBUkVOVF9QQVRIXSA9IHBhdGg7XG5cbiAgICAgICAgaW5zdGFuY2Uub25WYWx1ZUNoYW5nZWQuc3Vic2NyaWJlKGNoYW5nZXMgPT4ge1xuICAgICAgICAgIGlmIChjaGFuZ2VzKSB7XG4gICAgICAgICAgICBjaGFuZ2VzLnBhdGggPSAodGhpc1tQQVJFTlRfUEFUSF0gfHwgW10pLmNvbmNhdChjaGFuZ2VzLnBhdGgpO1xuICAgICAgICAgICAgdGhpcy5zZXRDaGFuZ2VzKGNoYW5nZXMpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIGluc3RhbmNlO1xuICAgICAgfTtcblxuICAgICAgbGV0IGR5bmFtaWNFbnRpdHkgPSBjcmVhdGVFbnRpdHlGcm9tSnNvbkRhdGEob3JpZ2luYWxEYXRhKTtcbiAgICAgIGlmIChkZWxldGUgdGhpc1twcm9wZXJ0eU5hbWVdKSB7XG4gICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBwcm9wZXJ0eU5hbWUsIHtcbiAgICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiBkeW5hbWljRW50aXR5O1xuICAgICAgICAgIH0sXG4gICAgICAgICAgc2V0OiBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgICAgIGNvbnN0IG1vZGlmeUluZm8gPSB7XG4gICAgICAgICAgICAgIHBhdGg6IGR5bmFtaWNFbnRpdHlbUEFSRU5UX1BBVEhdLFxuICAgICAgICAgICAgICB2YWx1ZTogdmFsdWUuZGF0YSxcbiAgICAgICAgICAgICAgcHJlVmFsdWU6IHRoaXNbcHJvcGVydHlOYW1lXS5kYXRhLFxuICAgICAgICAgICAgICB0eXBlOiBNb2RpZnlUeXBlLlZhbHVlQ2hhbmdlXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgZHluYW1pY0VudGl0eSA9IGNyZWF0ZUVudGl0eUZyb21Kc29uRGF0YSh2YWx1ZSk7XG4gICAgICAgICAgICB0aGlzLnNldENoYW5nZXMobW9kaWZ5SW5mbyk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBjb25maWd1cmFibGU6IHRydWVcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICAvLyNlbmRyZWdpb25cblxuXG4gIC8vICNyZWdpb24g5Yqg6L295a6e5L2T5pWw5o2u55u45YWzcHJpdmF0ZeOAgXByb2plY3RlZOaWueazlVxuXG4gIC8qKlxuICAgKiDliqDovb3nroDljZXlrZfmrrXlgLxcbiAgICogQHRvZG8g5Li05pe255So5L+u5pS555qE5pa55byP5qih5oufXG4gICAqL1xuICBwcm90ZWN0ZWQgbG9hZEZpZWxkcyhkYXRhOiBhbnkpIHtcbiAgICBjb25zdCBuZ0ZpZWxkcyA9IEZpZWxkTWV0YWRhdGFVdGlsLmdldE5nRmllbGRzKHRoaXMuY29uc3RydWN0b3IpO1xuICAgIE9iamVjdC5rZXlzKG5nRmllbGRzKS5mb3JFYWNoKChwcm9wTmFtZTogc3RyaW5nKSA9PiB7XG4gICAgICBjb25zdCBuZ0ZpZWxkID0gbmdGaWVsZHNbcHJvcE5hbWVdO1xuICAgICAgY29uc3QgZGF0YUZpZWxkID0gbmdGaWVsZC5kYXRhRmllbGQgfHwgcHJvcE5hbWU7XG4gICAgICAvLyBpZiAobmdGaWVsZC5wcmltYXJ5ID09PSBmYWxzZSkge1xuICAgICAgLy8gICB0aGlzW3Byb3BOYW1lXSA9IGRhdGFbZGF0YUZpZWxkXTtcbiAgICAgIC8vIH1cbiAgICAgIHRoaXNbcHJvcE5hbWVdID0gZGF0YVtkYXRhRmllbGRdO1xuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIOWKoOi9veWtkOWIl+ihqOaVsOaNrlxuICAgKiBAcGFyYW0gZGF0YSDmlbDmja5cbiAgICovXG4gIHByb3RlY3RlZCBsb2FkTGlzdHMoZGF0YTogYW55KSB7XG4gICAgY29uc3QgbmdMaXN0cyA9IEZpZWxkTWV0YWRhdGFVdGlsLmdldE5nTGlzdCh0aGlzLmNvbnN0cnVjdG9yKTtcbiAgICBPYmplY3Qua2V5cyhuZ0xpc3RzKS5mb3JFYWNoKChwcm9wTmFtZTogc3RyaW5nKSA9PiB7XG4gICAgICBjb25zdCBuZ0xpc3QgPSBuZ0xpc3RzW3Byb3BOYW1lXTtcbiAgICAgIGNvbnN0IGRhdGFGaWVsZCA9IG5nTGlzdC5kYXRhRmllbGQgfHwgcHJvcE5hbWU7XG4gICAgICBjb25zdCBlbnRpdHlUeXBlID0gbmdMaXN0LnR5cGU7XG5cbiAgICAgIC8vIOWIm+W7uuWunuS9k1xuICAgICAgY29uc3QgbGlzdERhdGEgPSBkYXRhW2RhdGFGaWVsZF07XG4gICAgICBpZiAobGlzdERhdGEpIHtcbiAgICAgICAgY29uc3QgZW50aXRpZXMgPSBsaXN0RGF0YS5tYXAoKGVudGl0eURhdGE6IGFueSkgPT4ge1xuICAgICAgICAgIHJldHVybiBFbnRpdHlGYWN0b3J5PHR5cGVvZiBlbnRpdHlUeXBlPihlbnRpdHlUeXBlLCBlbnRpdHlEYXRhKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXNbcHJvcE5hbWVdLmxvYWRFbnRpdGllcyhlbnRpdGllcyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzW3Byb3BOYW1lXS5sb2FkRW50aXRpZXMoW10pO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBsb2FkT2JqZWN0cyhkYXRhOiBhbnkpIHtcbiAgICBjb25zdCBuZ09iamVjdHMgPSBGaWVsZE1ldGFkYXRhVXRpbC5nZXROZ09iamVjdHModGhpcy5jb25zdHJ1Y3Rvcik7XG4gICAgT2JqZWN0LmtleXMobmdPYmplY3RzKS5mb3JFYWNoKChwcm9wTmFtZTogc3RyaW5nKSA9PiB7XG4gICAgICBjb25zdCBuZ09iamVjdCA9IG5nT2JqZWN0c1twcm9wTmFtZV07XG4gICAgICBjb25zdCBkYXRhRmllbGQgPSBuZ09iamVjdC5kYXRhRmllbGQgfHwgcHJvcE5hbWU7XG4gICAgICBjb25zdCBvYmplY3REYXRhID0gZGF0YVtkYXRhRmllbGRdO1xuICAgICAgY29uc3QgZW50aXR5ID0gdGhpc1twcm9wTmFtZV0gYXMgRW50aXR5O1xuICAgICAgaWYgKCFlbnRpdHkgfHwgIW9iamVjdERhdGEpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgZW50aXR5LmxvYWQob2JqZWN0RGF0YSk7XG4gICAgfSk7XG4gIH1cblxuICBwcm90ZWN0ZWQgbG9hZER5bmFtaWNPYmplY3RzKGRhdGE6IGFueSkge1xuICAgIGNvbnN0IG5nRHluYW1pY09iamVjdHMgPSBGaWVsZE1ldGFkYXRhVXRpbC5nZXROZ0R5bmFtaWModGhpcy5jb25zdHJ1Y3Rvcik7XG4gICAgT2JqZWN0LmtleXMobmdEeW5hbWljT2JqZWN0cykuZm9yRWFjaCgocHJvcE5hbWU6IHN0cmluZykgPT4ge1xuICAgICAgY29uc3QgbmdEeW5hbWljT2JqZWN0ID0gbmdEeW5hbWljT2JqZWN0c1twcm9wTmFtZV07XG4gICAgICBjb25zdCBkYXRhRmllbGQgPSBuZ0R5bmFtaWNPYmplY3QuZGF0YUZpZWxkIHx8IHByb3BOYW1lO1xuXG4gICAgICBjb25zdCBkeW5hbWljRGF0YSA9IGRhdGFbZGF0YUZpZWxkXSB8fCB7fTtcbiAgICAgIGNvbnN0IGR5bmFtaWNFbnRpdHkgPSB0aGlzW3Byb3BOYW1lXSBhcyBEeW5hbWljO1xuICAgICAgaWYgKCFkeW5hbWljRW50aXR5KSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGR5bmFtaWNFbnRpdHkubG9hZER5bmFtaWNEYXRhKGR5bmFtaWNEYXRhKTtcbiAgICB9KTtcbiAgfVxuXG4gIC8vICNlbmRyZWdpb25cblxuICAvLyAjcmVnaW9uIOengeacieW3peWFt+aWueazlVxuXG5cbiAgLyoqXG4gICAqIOWPkemAgeWAvOWPmOabtFxuICAgKi9cbiAgcHJpdmF0ZSBlbWl0VmFsdWVDaGFuZ2UocHJvcE5hbWU6IHN0cmluZywgcHJvcE1ldGFkYXRhOiBQcmltaXRpdmVQcm9wTWV0YWRhdGEsIG5ld1Byb3BWYWx1ZTogYW55LCBvbGRQcm9wVmFsdWU6IGFueSk6IHZvaWQge1xuICAgIGNvbnN0IGNoYW5nZSA9IHtcbiAgICAgIHBhdGg6IHRoaXMuY3JlYXRlUGF0aChwcm9wTmFtZSksXG4gICAgICB2YWx1ZTogbmV3UHJvcFZhbHVlLFxuICAgICAgcHJlVmFsdWU6IG9sZFByb3BWYWx1ZSxcbiAgICAgIHR5cGU6IE1vZGlmeVR5cGUuVmFsdWVDaGFuZ2VcbiAgICB9O1xuXG4gICAgaWYgKHRoaXNbUEFSRU5UX1BBVEhdKSB7XG4gICAgICBjaGFuZ2UucGF0aCA9IHRoaXNbUEFSRU5UX1BBVEhdLmNvbmNhdChjaGFuZ2UucGF0aCk7XG4gICAgfVxuICAgIHRoaXMuc2V0Q2hhbmdlcyhjaGFuZ2UpO1xuICB9XG5cbiAgLyoqXG4gICAqIOiOt+WPluWxnuaAp+WAvFxuICAgKi9cbiAgcHJpdmF0ZSBnZXRQcm9wVmFsdWUocHJvcE5hbWU6IHN0cmluZywgcHJvcE1ldGFkYXRhOiBQcmltaXRpdmVQcm9wTWV0YWRhdGEpIHtcbiAgICBjb25zdCBkYXRhRmllbGQgPSBwcm9wTWV0YWRhdGEuZGF0YUZpZWxkIHx8IHByb3BOYW1lO1xuICAgIGNvbnN0IHZhbHVlID0gdGhpcy5kYXRhW2RhdGFGaWVsZF07XG5cbiAgICAvLyDlr7nlpJror63lvZXlhaXlrZfmrrXvvIxxdWVyeeS4jei/lOWbnumXrumimOi/m+ihjOWFvOWuuVxuICAgIGlmIChwcm9wTWV0YWRhdGEuZW5hYmxlTXVsdGlMYW5nSW5wdXQgPT09IHRydWUgJiYgIXZhbHVlKSB7XG4gICAgICBjb25zdCBsYW5nQ29kZSA9IHdpbmRvdy5sb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnbGFuZ3VhZ2VDb2RlJykgfHwgJ3poLUNIUyc7XG4gICAgICBjb25zdCBvcmlnaW5EYXRhRmllbGQgPSBkYXRhRmllbGQucmVwbGFjZSgnX01VTFRJTEFOR1VBR0UnLCAnJyk7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBbbGFuZ0NvZGVdOiB0aGlzLmRhdGFbb3JpZ2luRGF0YUZpZWxkXVxuICAgICAgfTtcbiAgICB9XG4gICAgcmV0dXJuIHZhbHVlO1xuICB9XG5cbiAgLyoqXG4gICAqIOiuvue9ruWxnuaAp+WAvFxuICAgKi9cbiAgcHJpdmF0ZSBzZXRQcm9wVmFsdWUocHJvcE5hbWU6IHN0cmluZywgcHJvcE1ldGFkYXRhOiBQcmltaXRpdmVQcm9wTWV0YWRhdGEsIHByb3BWYWx1ZTogYW55KSB7XG4gICAgY29uc3QgZGF0YUZpZWxkID0gcHJvcE1ldGFkYXRhLmRhdGFGaWVsZCB8fCBwcm9wTmFtZTtcbiAgICB0aGlzLmRhdGFbZGF0YUZpZWxkXSA9IHByb3BWYWx1ZTtcbiAgfVxuXG4gIC8qKlxuICAgKiDmo4Dmn6XlsZ7mgKflgLzmmK/lkKblj5HnlJ/lj5jljJZcbiAgICovXG4gIHByaXZhdGUgaXNQcm9wVmFsdWVDaGFuZ2VkKHByb3BOYW1lOiBzdHJpbmcsIHByb3BNZXRhZGF0YTogUHJpbWl0aXZlUHJvcE1ldGFkYXRhLCBuZXdQcm9wVmFsdWU6IGFueSwgb2xkUHJvcFZhbHVlOiBhbnkpIHtcbiAgICBpZiAocHJvcE1ldGFkYXRhLmVuYWJsZU11bHRpTGFuZ0lucHV0ID09PSB0cnVlKSB7XG4gICAgICBpZiAodGhpcy5pc0VtcHR5TXVsdGlMYW5nUHJvcFZhbHVlKG5ld1Byb3BWYWx1ZSkgPT09IHRydWUgJiYgdGhpcy5pc0VtcHR5TXVsdGlMYW5nUHJvcFZhbHVlKG9sZFByb3BWYWx1ZSkgPT09IHRydWUpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KG5ld1Byb3BWYWx1ZSkgIT09IEpTT04uc3RyaW5naWZ5KG9sZFByb3BWYWx1ZSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiBuZXdQcm9wVmFsdWUgIT09IG9sZFByb3BWYWx1ZTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICog5aSa6K+t5b2V5YWl5a2X5q6155qE5YC85piv5ZCm5Li656m6XG4gICAqL1xuICBwcml2YXRlIGlzRW1wdHlNdWx0aUxhbmdQcm9wVmFsdWUodmFsdWU6IGFueSkge1xuICAgIHJldHVybiAhdmFsdWUgfHwgT2JqZWN0LmtleXModmFsdWUpLmxlbmd0aCA9PT0gMDtcbiAgfVxuXG4gIC8vICNlbmRyZWdpb25cbn1cbiJdfQ==
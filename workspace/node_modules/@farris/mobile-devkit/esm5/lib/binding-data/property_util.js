import { FieldMetadataUtil } from '../entity/index';
import { BindingPropertyType } from './binding_property';
/**
 * 属性工具类
 */
var PropertyUtil = /** @class */ (function () {
    function PropertyUtil() {
    }
    /**
     * 获取实体上的属性集合，并将他们转换成BindingProperty集合
     * @param  entityType 实体类型
     * @returns 绑定属性集合
     */
    PropertyUtil.getProperties = function (entityType) {
        var properties = [];
        // Plain
        var ngFieldProperties = FieldMetadataUtil.getNgFields(entityType);
        Object.keys(ngFieldProperties).forEach(function (propertyName) {
            var ngFieldProperty = ngFieldProperties[propertyName];
            properties.push({
                name: propertyName,
                type: BindingPropertyType.Plain,
                isPrimaryKey: ngFieldProperty.primary,
                isForeignKey: ngFieldProperty.foreign,
                enableMultiLangInput: ngFieldProperty.enableMultiLangInput
            });
        });
        // Object
        var ngObjectProperties = FieldMetadataUtil.getNgObjects(entityType);
        Object.keys(ngObjectProperties).forEach(function (propertyName) {
            var ngObjectProperty = ngObjectProperties[propertyName];
            properties.push({
                name: propertyName,
                type: BindingPropertyType.Object,
                entityType: ngObjectProperty.type
            });
        });
        // List
        var ngListProperties = FieldMetadataUtil.getNgList(entityType);
        Object.keys(ngListProperties).forEach(function (propertyName) {
            var ngListProperty = ngListProperties[propertyName];
            properties.push({
                name: propertyName,
                type: BindingPropertyType.List,
                entityType: ngListProperty.type
            });
        });
        // Dynamics
        var ngDynamicProperties = FieldMetadataUtil.getNgDynamic(entityType);
        Object.keys(ngDynamicProperties).forEach(function (propertyName) {
            var ngDynamicProperty = ngDynamicProperties[propertyName];
            properties.push({
                name: propertyName,
                type: BindingPropertyType.Dynamic,
                entityType: ngDynamicProperty.type
            });
        });
        return properties;
    };
    PropertyUtil.getDynamicProperties = function (dynamicData) {
        var properties = [];
        Object.keys(dynamicData).forEach(function (propertyName) {
            if (dynamicData.hasOwnProperty(propertyName)) {
                if (dynamicData[propertyName] instanceof Object) {
                    properties.push({
                        name: propertyName,
                        type: BindingPropertyType.Dynamic,
                        entityType: null
                    });
                }
                else {
                    properties.push({
                        name: propertyName,
                        type: BindingPropertyType.Plain,
                        isPrimaryKey: false,
                        isForeignKey: false
                    });
                }
            }
        });
        return properties;
    };
    /**
     * 根据属性名获取属性
     */
    PropertyUtil.getPropertyByName = function (properties, propertyName) {
        var targetProperty = properties.find(function (property) {
            return property.name === propertyName;
        });
        return targetProperty;
    };
    /**
     * 获取实体主键名
     * @param properties 属性集合
     * @returns 主键名
     */
    PropertyUtil.getPrimaryKey = function (properties) {
        // 实体必须有主键，如果没有主键在构造实体的时候就已经报错，这里不需要再进行检查
        var primaryProperty = properties.find(function (property) {
            return property.isPrimaryKey === true;
        });
        return primaryProperty ? primaryProperty.name : '';
    };
    return PropertyUtil;
}());
export { PropertyUtil };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHJvcGVydHlfdXRpbC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvbW9iaWxlLWRldmtpdC8iLCJzb3VyY2VzIjpbImxpYi9iaW5kaW5nLWRhdGEvcHJvcGVydHlfdXRpbC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFDQSxPQUFPLEVBQVUsaUJBQWlCLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUM1RCxPQUFPLEVBQW1CLG1CQUFtQixFQUFFLE1BQU0sb0JBQW9CLENBQUM7QUFFMUU7O0dBRUc7QUFDSDtJQUFBO0lBeUdBLENBQUM7SUF2R0M7Ozs7T0FJRztJQUNJLDBCQUFhLEdBQXBCLFVBQXFCLFVBQXdCO1FBQzNDLElBQU0sVUFBVSxHQUFHLEVBQUUsQ0FBQztRQUV0QixRQUFRO1FBQ1IsSUFBTSxpQkFBaUIsR0FBRyxpQkFBaUIsQ0FBQyxXQUFXLENBQUMsVUFBVSxDQUFDLENBQUM7UUFDcEUsTUFBTSxDQUFDLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxVQUFDLFlBQW9CO1lBQzFELElBQU0sZUFBZSxHQUFHLGlCQUFpQixDQUFDLFlBQVksQ0FBQyxDQUFDO1lBQ3hELFVBQVUsQ0FBQyxJQUFJLENBQUM7Z0JBQ2QsSUFBSSxFQUFFLFlBQVk7Z0JBQ2xCLElBQUksRUFBRSxtQkFBbUIsQ0FBQyxLQUFLO2dCQUMvQixZQUFZLEVBQUUsZUFBZSxDQUFDLE9BQU87Z0JBQ3JDLFlBQVksRUFBRSxlQUFlLENBQUMsT0FBTztnQkFDckMsb0JBQW9CLEVBQUUsZUFBZSxDQUFDLG9CQUFvQjthQUMzRCxDQUFDLENBQUM7UUFDTCxDQUFDLENBQUMsQ0FBQztRQUVILFNBQVM7UUFDVCxJQUFNLGtCQUFrQixHQUFHLGlCQUFpQixDQUFDLFlBQVksQ0FBQyxVQUFVLENBQUMsQ0FBQztRQUN0RSxNQUFNLENBQUMsSUFBSSxDQUFDLGtCQUFrQixDQUFDLENBQUMsT0FBTyxDQUFDLFVBQUMsWUFBb0I7WUFDM0QsSUFBTSxnQkFBZ0Is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SCxPQUFPLGVBQWUsQ0FBQyxDQUFDLENBQUMsZUFBZSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDO0lBQ3JELENBQUM7SUFFSCxtQkFBQztBQUFELENBQUMsQUF6R0QsSUF5R0M7QUFFRCxPQUFPLEVBQUUsWUFBWSxFQUFFLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1R5cGV9IGZyb20gJy4uL2NvcmUvaW5kZXgnO1xuaW1wb3J0IHsgRW50aXR5LCBGaWVsZE1ldGFkYXRhVXRpbCB9IGZyb20gJy4uL2VudGl0eS9pbmRleCc7XG5pbXBvcnQgeyBCaW5kaW5nUHJvcGVydHksIEJpbmRpbmdQcm9wZXJ0eVR5cGUgfSBmcm9tICcuL2JpbmRpbmdfcHJvcGVydHknO1xuXG4vKipcbiAqIOWxnuaAp+W3peWFt+exu1xuICovXG5jbGFzcyBQcm9wZXJ0eVV0aWwge1xuXG4gIC8qKlxuICAgKiDojrflj5blrp7kvZPkuIrnmoTlsZ7mgKfpm4blkIjvvIzlubblsIbku5bku6zovazmjaLmiJBCaW5kaW5nUHJvcGVydHnpm4blkIhcbiAgICogQHBhcmFtICBlbnRpdHlUeXBlIOWunuS9k+exu+Wei1xuICAgKiBAcmV0dXJucyDnu5HlrprlsZ7mgKfpm4blkIhcbiAgICovXG4gIHN0YXRpYyBnZXRQcm9wZXJ0aWVzKGVudGl0eVR5cGU6IFR5cGU8RW50aXR5Pik6IEJpbmRpbmdQcm9wZXJ0eVtdIHtcbiAgICBjb25zdCBwcm9wZXJ0aWVzID0gW107XG5cbiAgICAvLyBQbGFpblxuICAgIGNvbnN0IG5nRmllbGRQcm9wZXJ0aWVzID0gRmllbGRNZXRhZGF0YVV0aWwuZ2V0TmdGaWVsZHMoZW50aXR5VHlwZSk7XG4gICAgT2JqZWN0LmtleXMobmdGaWVsZFByb3BlcnRpZXMpLmZvckVhY2goKHByb3BlcnR5TmFtZTogc3RyaW5nKSA9PiB7XG4gICAgICBjb25zdCBuZ0ZpZWxkUHJvcGVydHkgPSBuZ0ZpZWxkUHJvcGVydGllc1twcm9wZXJ0eU5hbWVdO1xuICAgICAgcHJvcGVydGllcy5wdXNoKHtcbiAgICAgICAgbmFtZTogcHJvcGVydHlOYW1lLFxuICAgICAgICB0eXBlOiBCaW5kaW5nUHJvcGVydHlUeXBlLlBsYWluLFxuICAgICAgICBpc1ByaW1hcnlLZXk6IG5nRmllbGRQcm9wZXJ0eS5wcmltYXJ5LFxuICAgICAgICBpc0ZvcmVpZ25LZXk6IG5nRmllbGRQcm9wZXJ0eS5mb3JlaWduLFxuICAgICAgICBlbmFibGVNdWx0aUxhbmdJbnB1dDogbmdGaWVsZFByb3BlcnR5LmVuYWJsZU11bHRpTGFuZ0lucHV0XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIC8vIE9iamVjdFxuICAgIGNvbnN0IG5nT2JqZWN0UHJvcGVydGllcyA9IEZpZWxkTWV0YWRhdGFVdGlsLmdldE5nT2JqZWN0cyhlbnRpdHlUeXBlKTtcbiAgICBPYmplY3Qua2V5cyhuZ09iamVjdFByb3BlcnRpZXMpLmZvckVhY2goKHByb3BlcnR5TmFtZTogc3RyaW5nKSA9PiB7XG4gICAgICBjb25zdCBuZ09iamVjdFByb3BlcnR5ID0gbmdPYmplY3RQcm9wZXJ0aWVzW3Byb3BlcnR5TmFtZV07XG4gICAgICBwcm9wZXJ0aWVzLnB1c2goe1xuICAgICAgICBuYW1lOiBwcm9wZXJ0eU5hbWUsXG4gICAgICAgIHR5cGU6IEJpbmRpbmdQcm9wZXJ0eVR5cGUuT2JqZWN0LFxuICAgICAgICBlbnRpdHlUeXBlOiBuZ09iamVjdFByb3BlcnR5LnR5cGVcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgLy8gTGlzdFxuICAgIGNvbnN0IG5nTGlzdFByb3BlcnRpZXMgPSBGaWVsZE1ldGFkYXRhVXRpbC5nZXROZ0xpc3QoZW50aXR5VHlwZSk7XG4gICAgT2JqZWN0LmtleXMobmdMaXN0UHJvcGVydGllcykuZm9yRWFjaCgocHJvcGVydHlOYW1lOiBzdHJpbmcpID0+IHtcbiAgICAgIGNvbnN0IG5nTGlzdFByb3BlcnR5ID0gbmdMaXN0UHJvcGVydGllc1twcm9wZXJ0eU5hbWVdO1xuICAgICAgcHJvcGVydGllcy5wdXNoKHtcbiAgICAgICAgbmFtZTogcHJvcGVydHlOYW1lLFxuICAgICAgICB0eXBlOiBCaW5kaW5nUHJvcGVydHlUeXBlLkxpc3QsXG4gICAgICAgIGVudGl0eVR5cGU6IG5nTGlzdFByb3BlcnR5LnR5cGVcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgLy8gRHluYW1pY3NcbiAgICBjb25zdCBuZ0R5bmFtaWNQcm9wZXJ0aWVzID0gRmllbGRNZXRhZGF0YVV0aWwuZ2V0TmdEeW5hbWljKGVudGl0eVR5cGUpO1xuICAgIE9iamVjdC5rZXlzKG5nRHluYW1pY1Byb3BlcnRpZXMpLmZvckVhY2goKHByb3BlcnR5TmFtZTogc3RyaW5nKSA9PiB7XG4gICAgICBjb25zdCBuZ0R5bmFtaWNQcm9wZXJ0eSA9IG5nRHluYW1pY1Byb3BlcnRpZXNbcHJvcGVydHlOYW1lXTtcbiAgICAgIHByb3BlcnRpZXMucHVzaCh7XG4gICAgICAgIG5hbWU6IHByb3BlcnR5TmFtZSxcbiAgICAgICAgdHlwZTogQmluZGluZ1Byb3BlcnR5VHlwZS5EeW5hbWljLFxuICAgICAgICBlbnRpdHlUeXBlOiBuZ0R5bmFtaWNQcm9wZXJ0eS50eXBlXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIHJldHVybiBwcm9wZXJ0aWVzO1xuICB9XG5cbiAgc3RhdGljIGdldER5bmFtaWNQcm9wZXJ0aWVzKGR5bmFtaWNEYXRhOiBhbnkpOiBCaW5kaW5nUHJvcGVydHlbXSB7XG4gICAgY29uc3QgcHJvcGVydGllcyA9IFtdO1xuICAgIE9iamVjdC5rZXlzKGR5bmFtaWNEYXRhKS5mb3JFYWNoKChwcm9wZXJ0eU5hbWU6IHN0cmluZykgPT4ge1xuICAgICAgaWYgKGR5bmFtaWNEYXRhLmhhc093blByb3BlcnR5KHByb3BlcnR5TmFtZSkpIHtcbiAgICAgICAgaWYgKGR5bmFtaWNEYXRhW3Byb3BlcnR5TmFtZV0gaW5zdGFuY2VvZiBPYmplY3QpIHtcbiAgICAgICAgICBwcm9wZXJ0aWVzLnB1c2goe1xuICAgICAgICAgICAgbmFtZTogcHJvcGVydHlOYW1lLFxuICAgICAgICAgICAgdHlwZTogQmluZGluZ1Byb3BlcnR5VHlwZS5EeW5hbWljLFxuICAgICAgICAgICAgZW50aXR5VHlwZTogbnVsbFxuICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHByb3BlcnRpZXMucHVzaCh7XG4gICAgICAgICAgICBuYW1lOiBwcm9wZXJ0eU5hbWUsXG4gICAgICAgICAgICB0eXBlOiBCaW5kaW5nUHJvcGVydHlUeXBlLlBsYWluLFxuICAgICAgICAgICAgaXNQcmltYXJ5S2V5OiBmYWxzZSxcbiAgICAgICAgICAgIGlzRm9yZWlnbktleTogZmFsc2VcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuICAgIHJldHVybiBwcm9wZXJ0aWVzO1xuICB9XG4gIC8qKlxuICAgKiDmoLnmja7lsZ7mgKflkI3ojrflj5blsZ7mgKdcbiAgICovXG4gIHN0YXRpYyBnZXRQcm9wZXJ0eUJ5TmFtZShwcm9wZXJ0aWVzOiBCaW5kaW5nUHJvcGVydHlbXSwgcHJvcGVydHlOYW1lOiBzdHJpbmcpOiBCaW5kaW5nUHJvcGVydHkge1xuICAgIGNvbnN0IHRhcmdldFByb3BlcnR5ID0gIHByb3BlcnRpZXMuZmluZCgocHJvcGVydHk6IEJpbmRpbmdQcm9wZXJ0eSkgPT4ge1xuICAgICAgcmV0dXJuIHByb3BlcnR5Lm5hbWUgPT09IHByb3BlcnR5TmFtZTtcbiAgICB9KTtcbiAgICByZXR1cm4gdGFyZ2V0UHJvcGVydHk7XG4gIH1cblxuICAvKipcbiAgICog6I635Y+W5a6e5L2T5Li76ZSu5ZCNXG4gICAqIEBwYXJhbSBwcm9wZXJ0aWVzIOWxnuaAp+mbhuWQiFxuICAgKiBAcmV0dXJucyDkuLvplK7lkI1cbiAgICovXG4gIHN0YXRpYyBnZXRQcmltYXJ5S2V5KHByb3BlcnRpZXM6IEJpbmRpbmdQcm9wZXJ0eVtdKTogc3RyaW5nIHtcblxuICAgIC8vIOWunuS9k+W/hemhu+acieS4u+mUru+8jOWmguaenOayoeacieS4u+mUruWcqOaehOmAoOWunuS9k+eahOaXtuWAmeWwseW3sue7j+aKpemUme+8jOi/memHjOS4jemcgOimgeWGjei/m+ihjOajgOafpVxuICAgIGNvbnN0IHByaW1hcnlQcm9wZXJ0eSA9IHByb3BlcnRpZXMuZmluZCgocHJvcGVydHk6IEJpbmRpbmdQcm9wZXJ0eSkgPT4ge1xuICAgICAgcmV0dXJuIHByb3BlcnR5LmlzUHJpbWFyeUtleSA9PT0gdHJ1ZTtcbiAgICB9KTtcbiAgICByZXR1cm4gcHJpbWFyeVByb3BlcnR5ID8gcHJpbWFyeVByb3BlcnR5Lm5hbWUgOiAnJztcbiAgfVxuXG59XG5cbmV4cG9ydCB7IFByb3BlcnR5VXRpbCB9O1xuIl19
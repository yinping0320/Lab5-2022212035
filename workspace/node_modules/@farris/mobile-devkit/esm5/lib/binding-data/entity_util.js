import { PARENT_CLASS, FieldMetadataUtil } from '../entity/index';
import { ModifyType } from '../changeset/index';
import { ChangeType } from './changes';
import { BindingPropertyType } from './binding_property';
import { BindingObjectFactory } from './binding_object_factory';
/**
 * 实体操作工具类
 */
var EntityUtil = /** @class */ (function () {
    function EntityUtil() {
    }
    /**
     * 将entity的数据加载到bindingObject中，并保持两者同步。
     * @param entity        实体对象
     * @param bindingObject 绑定对象
     */
    EntityUtil.loadEntity = function (entity, bindingObject) {
        var _this = this;
        // 遍历bindingObject的properties进行赋值
        bindingObject.properties.forEach(function (property) {
            var propertyName = property.name;
            if (property.type === BindingPropertyType.List) {
                _this.loadEntityList(entity[propertyName] || entity[PARENT_CLASS], bindingObject[propertyName]);
            }
            else if (property.type === BindingPropertyType.Object) {
                if (entity && entity[propertyName]) {
                    _this.loadEntity(entity[propertyName], bindingObject[propertyName]);
                }
            }
            else if (property.type === BindingPropertyType.Dynamic) {
                if (entity && entity[propertyName]) {
                    var dynamicObject = BindingObjectFactory.createDynamicBindingObject(entity[propertyName].data);
                    BindingObjectFactory.attachDynamicObjectProperty(bindingObject, propertyName, dynamicObject);
                    _this.loadEntity(entity[propertyName], bindingObject[propertyName]);
                }
            }
            else {
                bindingObject.setValue(propertyName, entity[propertyName], false, false);
            }
        });
        this.setUpEntityPipeline(entity, bindingObject);
    };
    /**
     * 建立entity和bindingObject之间的关联
     * @param entity        实体对象
     * @param bindingObject 绑定对象
     */
    EntityUtil.setUpEntityPipeline = function (entity, bindingObject) {
        // 监听entity变更
        entity.onValueChanged.subscribe(function (modification) {
            if (modification.type !== ModifyType.ValueChange || modification.path.length === 0) {
                return;
            }
            var propertyName = modification.path[modification.path.length - 1];
            var primaryKeyPath = modification.path[modification.path.length - 2];
            // 验证主键是否匹配
            // 存在主键并且主键不是id时才检查（值对象、关联对象不检查）
            if (bindingObject.primaryKey && bindingObject.primaryKey === 'id') {
                var primaryKey = bindingObject.primaryKey;
                var primaryKeyValue = bindingObject.getValue(primaryKey);
                if (primaryKeyPath !== primaryKey + ":" + primaryKeyValue) {
                    return;
                }
            }
            // 值没有发生变化，不再设置
            // TODO: 通过bindingObject修改entity属性值时，entity总会触发一个变更回来，如果不截获这个重复的变更，会导致重复或死循环
            if (bindingObject.getValue(propertyName) === modification.value) {
                return;
            }
            bindingObject.setValue(propertyName, modification.value, true, false, modification.errors);
        });
        // 监听bindingObject变更
        bindingObject.viewChanges.subscribe(function (viewChange) {
            var value = viewChange.value;
            var propertyName = viewChange.path[0];
            var pathPrefix = '';
            var pathData = entity.getPaths();
            var paths = pathData.path;
            var id = bindingObject['id'];
            if (pathData.isUdt) {
                // grid中udt没有id，从父级中取出id，以便存放验证信息
                var getParentId = function (target) {
                    var parentId = '';
                    var findId = function (item) {
                        if (item && item && item['id']) {
                            parentId = item['id'];
                            return;
                        }
                        else if (item['parent']) {
                            findId(item['parent']);
                        }
                    };
                    findId(target);
                    return parentId;
                };
                id = getParentId(bindingObject);
                if (pathData.isGrid) {
                    // grid 将从表主字段去除
                    paths.shift();
                }
                if (paths.length) {
                    pathPrefix = paths.join('.') + '.';
                }
            }
            // 不是主键值字段时，要先检查主键是否存在，并且主键是否相等（防止后代变更冒泡上来）
            // 非主键属性变更时，要先检查主键是否匹配（如果主键也修改了，要求先修改主键再修改其他值）
            if (bindingObject.primaryKey) {
                var primaryKey = bindingObject.primaryKey;
                if (propertyName !== primaryKey) {
                    if (!entity[primaryKey] || entity[primaryKey] !== bindingObject[primaryKey]) {
                        return;
                    }
                }
            }
            // 如果BindingObject上的属性值和Entity上对应属性值一样，则不再设置
            if (entity[propertyName] === value) {
                return;
            }
            // 调用表单验证,通过后调用实体验证
            // bingdingObject变化后，先调用实体上的验证，通过后再设置实体的变动
            entity[propertyName] = value;
        });
    };
    /**
     * 将entityList中的Entity对象转换为BindingObject对象，加载到bindingList中，并保持entityList和bindingList同步。
     * @param entityList  实体列表
     * @param bindingList 绑定列表
     */
    EntityUtil.loadEntityList = function (entityList, bindingList) {
        this.loadEntities(entityList.items, bindingList);
        this.setUpEntityListPipeline(entityList, bindingList);
    };
    /**
     * 建立entityList和bindingList之间的关联
     * @param entityList  实体列表
     * @param bindingList 绑定列表
     */
    EntityUtil.setUpEntityListPipeline = function (entityList, bindingList) {
        var _this = this;
        entityList.onListChanged.subscribe(function (modification) {
            switch (modification.type) {
                // 添加实体
                case ModifyType.Add:
                case ModifyType.Clone:
                    {
                        var entitiesToAdd = modification.value;
                        if (entitiesToAdd.length === 0) {
                            return;
                        }
                        // 检查父id是否一致，冒泡导致的变更不处理
                        var paths = modification.path;
                        var parentPath = paths[paths.length - 2];
                        var parentId = bindingList.parent.primaryKeyValue;
                        if (parentPath.indexOf(parentId) === -1) {
                            return;
                        }
                        _this.appendEntities(modification.value, bindingList, modification.type === ModifyType.Clone);
                    }
                    break;
                case ModifyType.Insert:
                    {
                        // 检查父id是否一致，冒泡导致的变更不处理
                        var paths = modification.path;
                        var parentPath = paths[paths.length - 2];
                        var parentId = bindingList.parent.primaryKeyValue;
                        var position = modification.position;
                        if (parentPath.indexOf(parentId) === -1) {
                            return;
                        }
                        _this.insertEntity(modification.value[0], bindingList, position);
                    }
                    break;
                // 删除实体
                case ModifyType.Remove:
                    {
                        // 删除实体（value格式待商榷，目前value的格式为 { primaryKey: primaryValue}）
                        var id = modification.value[bindingList.primaryKey];
                        bindingList.removeByIds([id]);
                        // this.removeEntities(<Entity[]>modification.value, bindingList);
                    }
                    break;
                // 加载实体
                case ModifyType.Load:
                    var entities = modification.value;
                    _this.loadEntities(entities, bindingList);
                    break;
                default:
                    break;
            }
        });
    };
    /**
     * 监听repository变化，保持repository和bindingList同步。
     * @param repository  实体仓库
     * @param bindingList 绑定列表
     */
    EntityUtil.loadRepository = function (repository, bindingList) {
        var _this = this;
        // 初次加载
        var entities = Array.from(repository.entityCollection.toArray());
        this.loadEntities(entities, bindingList);
        // 监听变化
        repository.entityCollectionChange.subscribe(function (modification) {
            switch (modification.type) {
                case ModifyType.Load:
                    _this.loadEntities(modification.value, bindingList, modification.entityCreate);
                    break;
                case ModifyType.Add:
                case ModifyType.Clone:
                    _this.appendEntities(modification.value, bindingList, modification.type === ModifyType.Clone);
                    break;
                case ModifyType.AddData:
                    _this.addData(modification.value, bindingList);
                    break;
                case ModifyType.Insert:
                    _this.insertEntity(modification.value, bindingList, modification.position);
                    break;
                case ModifyType.Remove:
                    _this.removeEntities(modification.value, bindingList);
                    break;
                case ModifyType.RemoveData:
                    _this.removeData(modification.value, bindingList);
                    break;
                case ModifyType.PaginationInfoChange:
                    bindingList.paginationInfo = modification.value;
                    break;
                default:
                    break;
            }
        });
        // 监听BindingList数据变化
        bindingList.changes.subscribe(function (change) {
            if (change.type === ChangeType.PaginationInfoChange) {
                var entityCollection = repository.entityCollection;
                // const entityTypeName = entityCollection.entityTypeName;
                // const original = entityCollection.paginationInfo[entityTypeName];
                // const entityPaginationInfo = Object.assign({}, original, change.value);
                entityCollection.paginationInfo = Object.assign({}, entityCollection.paginationInfo, change.value);
            }
        });
    };
    /**
     * 将entities中的Entity对象转换为BindingObject对象，并加载到bindingList中
     * @param entities    实体数组
     * @param bindingList 绑定列表
     */
    EntityUtil.loadEntities = function (entities, bindingList, entityCreate) {
        if (entityCreate === void 0) { entityCreate = false; }
        var bindingObjects = this.createBindingObjects(entities, bindingList);
        bindingList.load(bindingObjects, entityCreate);
    };
    /**
     * 将entities中的Entity对象转换为BIndingObject对象，并追加到bindingList中
     * @param entities    实体数组
     * @param bindingList 绑定列表
     */
    EntityUtil.appendEntities = function (entities, bindingList, isCloned) {
        if (isCloned === void 0) { isCloned = false; }
        var bindingObjects = this.createBindingObjects(entities, bindingList);
        bindingList.append(bindingObjects, isCloned);
    };
    /**
     * 增加实体数据（不切换当前行）
     * @param entities
     * @param bindingList
     */
    EntityUtil.addData = function (entities, bindingList) {
        var bindingObjects = this.createBindingObjects(entities, bindingList);
        bindingList.addData(bindingObjects);
    };
    EntityUtil.insertEntity = function (entity, bindingList, position) {
        var bindingObject = this.createBindingObject(entity, bindingList);
        bindingList.insert(bindingObject, position);
    };
    /**
     * 从bindingList移除entities对应的BindingObject对象
     * @param entities    实体数组
     * @param bindingList 绑定列表
     */
    EntityUtil.removeEntities = function (entities, bindingList) {
        if (entities === null || entities.length === 0) {
            return;
        }
        // 归集要删除的id数组
        var primaryKey = bindingList.primaryKey;
        var ids = [];
        entities.forEach(function (entity) {
            ids.push(entity[primaryKey]);
        });
        bindingList.removeByIds(ids);
    };
    EntityUtil.removeData = function (entities, bindingList) {
        if (entities === null || entities.length === 0) {
            return;
        }
        // 归集要删除的id数组
        var primaryKey = bindingList.primaryKey;
        var ids = [];
        entities.forEach(function (entity) {
            ids.push(entity[primaryKey]);
        });
        bindingList.removeDataByIds(ids);
    };
    /**
     * 将entities中的Entity对象转换为BindingObject对象
     * @param entities    实体数组
     * @param bindingList 绑定列表
     */
    EntityUtil.createBindingObjects = function (entities, bindingList) {
        var _this = this;
        if (entities === null || entities.length === 0) {
            return [];
        }
        var bindingObjects = [];
        entities.forEach(function (entity) {
            var bindingObject = BindingObjectFactory.create(bindingList.properties);
            bindingObject['_ENTITY_'] = entity;
            _this.loadEntity(entity, bindingObject);
            // // 为bindingObject设置默认值initialData属性
            // if (entity['initialData']) {
            //   bindingObject['initialData'] = entity['initialData'];
            // }
            bindingObjects.push(bindingObject);
        });
        return bindingObjects;
    };
    EntityUtil.createBindingObject = function (entity, bindingList) {
        var bindingObject = BindingObjectFactory.create(bindingList.properties);
        this.loadEntity(entity, bindingObject);
        return bindingObject;
    };
    EntityUtil.watchReposiroty = function (repository, bindingData) {
        // reposiroty => bindingData
        repository.entityCollectionChange.subscribe(function (modification) {
            switch (modification.type) {
                case ModifyType.PaginationInfoChange:
                    bindingData.pagingInfo = modification.value;
                    break;
                default:
                    break;
            }
        });
    };
    /**
     * 查找属性的类型
     * @param entityType 实体类型
     * @param targetPropName 属性名称
     * @return 属性信息，包含属性类型（NgField、NgObject、NgList）和属性对应的实体类型（当NgField类型时为null）
     */
    EntityUtil.getPropInfo = function (entityType, targetPropName) {
        var propType;
        var propEntityType;
        // NgField
        var ngFieldProperties = FieldMetadataUtil.getNgFields(entityType);
        Object.keys(ngFieldProperties).forEach(function (propName) {
            if (propName === targetPropName) {
                propType = 'NgField';
                propEntityType = null;
            }
        });
        // NgObject
        var ngObjectProperties = FieldMetadataUtil.getNgObjects(entityType);
        Object.keys(ngObjectProperties).forEach(function (propName) {
            if (propName === targetPropName) {
                propType = 'NgObject';
                propEntityType = ngObjectProperties[propName].type;
            }
        });
        // NgList
        var ngListProperties = FieldMetadataUtil.getNgList(entityType);
        Object.keys(ngListProperties).forEach(function (propName) {
            if (propName === targetPropName) {
                propType = 'NgList';
                propEntityType = ngListProperties[propName].type;
            }
        });
        var ngDynamicProperties = FieldMetadataUtil.getNgDynamic(entityType);
        Object.keys(ngDynamicProperties).forEach(function (propName) {
            if (propName === targetPropName) {
                propType = 'NgDynamic';
                propEntityType = ngDynamicProperties[propName].type;
            }
        });
        return { propType: propType, propEntityType: propEntityType };
    };
    /**
     * 获取实体的主键名
     * @param entityType 实体类型
     */
    EntityUtil.getPrimaryKey = function (entityType) {
        var primaryNgFiledProp = FieldMetadataUtil.getPrimaryFieldMetadata(entityType);
        if (primaryNgFiledProp) {
            return primaryNgFiledProp.dataField;
        }
        else {
            return '';
        }
    };
    /**
     * 是否为对象属性
     */
    EntityUtil.isObjectProp = function (entityType, targetPropName) {
        var isObjectProp = false;
        var ngObjectProperties = FieldMetadataUtil.getNgObjects(entityType);
        Object.keys(ngObjectProperties).forEach(function (propName) {
            if (propName === targetPropName) {
                isObjectProp = true;
            }
        });
        return isObjectProp;
    };
    /**
     * 检查是否是动态列属性
     */
    EntityUtil.isDynamicProp = function (entityType, targetPropName) {
        var isDynamicProp = false;
        var ngDynamicProperties = FieldMetadataUtil.getNgDynamic(entityType);
        Object.keys(ngDynamicProperties).forEach(function (propName) {
            if (propName === targetPropName) {
                isDynamicProp = true;
            }
        });
        return isDynamicProp;
    };
    /**
     * 为实体增加initialData属性
     * @param entity 实体实例
     * @param initialData 默认值对象
     */
    EntityUtil.appendInitialData = function (entity, initialData) {
        var data = Object.assign({}, initialData);
        delete data.id;
        delete data.parentID;
        entity['initialData'] = data;
    };
    return EntityUtil;
}());
export { EntityUtil };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZW50aXR5X3V0aWwuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL21vYmlsZS1kZXZraXQvIiwic291cmNlcyI6WyJsaWIvYmluZGluZy1kYXRhL2VudGl0eV91dGlsLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUNBLE9BQU8sRUFBc0IsWUFBWSxFQUFFLGlCQUFpQixFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFDdEYsT0FBTyxFQUFnQixVQUFVLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQztBQUM5RCxPQUFPLEVBQXNCLFVBQVUsRUFBRSxNQUFNLFdBQVcsQ0FBQztBQUczRCxPQUFPLEVBQW1CLG1CQUFtQixFQUFFLE1BQU0sb0JBQW9CLENBQUM7QUFDMUUsT0FBTyxFQUFFLG9CQUFvQixFQUFFLE1BQU0sMEJBQTBCLENBQUM7QUFJaEU7O0dBRUc7QUFDSDtJQUFBO0lBcWNBLENBQUM7SUFuY0M7Ozs7T0FJRztJQUNJLHFCQUFVLEdBQWpCLFVBQWtCLE1BQWMsRUFBRSxhQUE0QjtRQUE5RCxpQkF1QkM7UUFyQkMsaUNBQWlDO1FBQ2pDLGFBQWEsQ0FBQyxVQUFVLENBQUMsT0FBTyxDQUFDLFVBQUMsUUFBeUI7WUFDekQsSUFBTSxZQUFZLEdBQUcsUUFBUSxDQUFDLElBQUksQ0FBQztZQUNuQyxJQUFJLFFBQVEsQ0FBQyxJQUFJLEtBQUssbUJBQW1CLENBQUMsSUFBSSxFQUFFO2dCQUM5QyxLQUFJLENBQUMsY0FBYyxDQUFDLE1BQU0sQ0FBQyxZQUFZLENBQUMsSUFBSSxNQUFNLENBQUMsWUFBWSxDQUFDLEVBQUUsYUFBYSxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUM7YUFDaEc7aUJBQU0sSUFBSSxRQUFRLENBQUMsSUFBSSxLQUFLLG1CQUFtQixDQUFDLE1BQU0sRUFBRTtnQkFDdkQsSUFBSSxNQUFNLElBQUksTUFBTSxDQUFDLFlBQVksQ0FBQyxFQUFFO29CQUNsQyxLQUFJLENBQUMsVUFBVSxDQUFDLE1BQU0sQ0FBQyxZQUFZLENBQUMsRUFBRSxh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SUFBSSxDQUFDO0lBQy9CLENBQUM7SUFDSCxpQkFBQztBQUFELENBQUMsQUFyY0QsSUFxY0M7QUFFRCxPQUFPLEVBQUUsVUFBVSxFQUFFLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBSZXBvc2l0b3J5IH0gZnJvbSAnLi4vcmVwb3NpdG9yeS9pbmRleCc7XG5pbXBvcnQgeyBFbnRpdHksIEVudGl0eUxpc3QsIFBBUkVOVF9DTEFTUywgRmllbGRNZXRhZGF0YVV0aWwgfSBmcm9tICcuLi9lbnRpdHkvaW5kZXgnO1xuaW1wb3J0IHsgTW9kaWZpY2F0aW9uLCBNb2RpZnlUeXBlIH0gZnJvbSAnLi4vY2hhbmdlc2V0L2luZGV4JztcbmltcG9ydCB7IFZpZXdDaGFuZ2UsIENoYW5nZSwgQ2hhbmdlVHlwZSB9IGZyb20gJy4vY2hhbmdlcyc7XG5pbXBvcnQgeyBCaW5kaW5nTGlzdCB9IGZyb20gJy4vYmluZGluZ19saXN0JztcbmltcG9ydCB7IEJpbmRpbmdPYmplY3QgfSBmcm9tICcuL2JpbmRpbmdfb2JqZWN0JztcbmltcG9ydCB7IEJpbmRpbmdQcm9wZXJ0eSwgQmluZGluZ1Byb3BlcnR5VHlwZSB9IGZyb20gJy4vYmluZGluZ19wcm9wZXJ0eSc7XG5pbXBvcnQgeyBCaW5kaW5nT2JqZWN0RmFjdG9yeSB9IGZyb20gJy4vYmluZGluZ19vYmplY3RfZmFjdG9yeSc7XG5pbXBvcnQgeyBQYWdpbmF0aW9uIH0gZnJvbSAnLi4vY29yZS9pbmRleCc7XG5pbXBvcnQgeyBCaW5kaW5nRGF0YSB9IGZyb20gJy4vYmluZGluZ19kYXRhJztcblxuLyoqXG4gKiDlrp7kvZPmk43kvZzlt6XlhbfnsbtcbiAqL1xuY2xhc3MgRW50aXR5VXRpbCB7XG5cbiAgLyoqXG4gICAqIOWwhmVudGl0eeeahOaVsOaNruWKoOi9veWIsGJpbmRpbmdPYmplY3TkuK3vvIzlubbkv53mjIHkuKTogIXlkIzmraXjgIJcbiAgICogQHBhcmFtIGVudGl0eSAgICAgICAg5a6e5L2T5a+56LGhXG4gICAqIEBwYXJhbSBiaW5kaW5nT2JqZWN0IOe7keWumuWvueixoVxuICAgKi9cbiAgc3RhdGljIGxvYWRFbnRpdHkoZW50aXR5OiBFbnRpdHksIGJpbmRpbmdPYmplY3Q6IEJpbmRpbmdPYmplY3QpIHtcblxuICAgIC8vIOmBjeWOhmJpbmRpbmdPYmplY3TnmoRwcm9wZXJ0aWVz6L+b6KGM6LWL5YC8XG4gICAgYmluZGluZ09iamVjdC5wcm9wZXJ0aWVzLmZvckVhY2goKHByb3BlcnR5OiBCaW5kaW5nUHJvcGVydHkpID0+IHtcbiAgICAgIGNvbnN0IHByb3BlcnR5TmFtZSA9IHByb3BlcnR5Lm5hbWU7XG4gICAgICBpZiAocHJvcGVydHkudHlwZSA9PT0gQmluZGluZ1Byb3BlcnR5VHlwZS5MaXN0KSB7XG4gICAgICAgIHRoaXMubG9hZEVudGl0eUxpc3QoZW50aXR5W3Byb3BlcnR5TmFtZV0gfHwgZW50aXR5W1BBUkVOVF9DTEFTU10sIGJpbmRpbmdPYmplY3RbcHJvcGVydHlOYW1lXSk7XG4gICAgICB9IGVsc2UgaWYgKHByb3BlcnR5LnR5cGUgPT09IEJpbmRpbmdQcm9wZXJ0eVR5cGUuT2JqZWN0KSB7XG4gICAgICAgIGlmIChlbnRpdHkgJiYgZW50aXR5W3Byb3BlcnR5TmFtZV0pIHtcbiAgICAgICAgICB0aGlzLmxvYWRFbnRpdHkoZW50aXR5W3Byb3BlcnR5TmFtZV0sIGJpbmRpbmdPYmplY3RbcHJvcGVydHlOYW1lXSk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSBpZiAocHJvcGVydHkudHlwZSA9PT0gQmluZGluZ1Byb3BlcnR5VHlwZS5EeW5hbWljKSB7XG4gICAgICAgIGlmIChlbnRpdHkgJiYgZW50aXR5W3Byb3BlcnR5TmFtZV0pIHtcbiAgICAgICAgICBjb25zdCBkeW5hbWljT2JqZWN0ID0gQmluZGluZ09iamVjdEZhY3RvcnkuY3JlYXRlRHluYW1pY0JpbmRpbmdPYmplY3QoZW50aXR5W3Byb3BlcnR5TmFtZV0uZGF0YSk7XG4gICAgICAgICAgQmluZGluZ09iamVjdEZhY3RvcnkuYXR0YWNoRHluYW1pY09iamVjdFByb3BlcnR5KGJpbmRpbmdPYmplY3QsIHByb3BlcnR5TmFtZSwgZHluYW1pY09iamVjdCk7XG4gICAgICAgICAgdGhpcy5sb2FkRW50aXR5KGVudGl0eVtwcm9wZXJ0eU5hbWVdLCBiaW5kaW5nT2JqZWN0W3Byb3BlcnR5TmFtZV0pO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBiaW5kaW5nT2JqZWN0LnNldFZhbHVlKHByb3BlcnR5TmFtZSwgZW50aXR5W3Byb3BlcnR5TmFtZV0sIGZhbHNlLCBmYWxzZSk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICB0aGlzLnNldFVwRW50aXR5UGlwZWxpbmUoZW50aXR5LCBiaW5kaW5nT2JqZWN0KTtcbiAgfVxuXG4gIC8qKlxuICAgKiDlu7rnq4tlbnRpdHnlkoxiaW5kaW5nT2JqZWN05LmL6Ze055qE5YWz6IGUXG4gICAqIEBwYXJhbSBlbnRpdHkgICAgICAgIOWunuS9k+WvueixoVxuICAgKiBAcGFyYW0gYmluZGluZ09iamVjdCDnu5Hlrprlr7nosaFcbiAgICovXG4gIHN0YXRpYyBzZXRVcEVudGl0eVBpcGVsaW5lKGVudGl0eTogRW50aXR5LCBiaW5kaW5nT2JqZWN0OiBCaW5kaW5nT2JqZWN0KSB7XG5cbiAgICAvLyDnm5HlkKxlbnRpdHnlj5jmm7RcbiAgICBlbnRpdHkub25WYWx1ZUNoYW5nZWQuc3Vic2NyaWJlKChtb2RpZmljYXRpb246IE1vZGlmaWNhdGlvbikgPT4ge1xuICAgICAgaWYgKG1vZGlmaWNhdGlvbi50eXBlICE9PSBNb2RpZnlUeXBlLlZhbHVlQ2hhbmdlIHx8IG1vZGlmaWNhdGlvbi5wYXRoLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBjb25zdCBwcm9wZXJ0eU5hbWUgPSBtb2RpZmljYXRpb24ucGF0aFttb2RpZmljYXRpb24ucGF0aC5sZW5ndGggLSAxXTtcbiAgICAgIGNvbnN0IHByaW1hcnlLZXlQYXRoID0gbW9kaWZpY2F0aW9uLnBhdGhbbW9kaWZpY2F0aW9uLnBhdGgubGVuZ3RoIC0gMl07XG5cbiAgICAgIC8vIOmqjOivgeS4u+mUruaYr+WQpuWMuemFjVxuICAgICAgLy8g5a2Y5Zyo5Li76ZSu5bm25LiU5Li76ZSu5LiN5pivaWTml7bmiY3mo4Dmn6XvvIjlgLzlr7nosaHjgIHlhbPogZTlr7nosaHkuI3mo4Dmn6XvvIlcbiAgICAgIGlmIChiaW5kaW5nT2JqZWN0LnByaW1hcnlLZXkgJiYgYmluZGluZ09iamVjdC5wcmltYXJ5S2V5ID09PSAnaWQnKSB7XG4gICAgICAgIGNvbnN0IHByaW1hcnlLZXkgPSBiaW5kaW5nT2JqZWN0LnByaW1hcnlLZXk7XG4gICAgICAgIGNvbnN0IHByaW1hcnlLZXlWYWx1ZSA9IGJpbmRpbmdPYmplY3QuZ2V0VmFsdWUocHJpbWFyeUtleSk7XG4gICAgICAgIGlmIChwcmltYXJ5S2V5UGF0aCAhPT0gYCR7cHJpbWFyeUtleX06JHtwcmltYXJ5S2V5VmFsdWV9YCkge1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICAvLyDlgLzmsqHmnInlj5HnlJ/lj5jljJbvvIzkuI3lho3orr7nva5cbiAgICAgIC8vIFRPRE86IOmAmui/h2JpbmRpbmdPYmplY3Tkv67mlLllbnRpdHnlsZ7mgKflgLzml7bvvIxlbnRpdHnmgLvkvJrop6blj5HkuIDkuKrlj5jmm7Tlm57mnaXvvIzlpoLmnpzkuI3miKrojrfov5nkuKrph43lpI3nmoTlj5jmm7TvvIzkvJrlr7zoh7Tph43lpI3miJbmrbvlvqrnjq9cbiAgICAgIGlmIChiaW5kaW5nT2JqZWN0LmdldFZhbHVlKHByb3BlcnR5TmFtZSkgPT09IG1vZGlmaWNhdGlvbi52YWx1ZSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBiaW5kaW5nT2JqZWN0LnNldFZhbHVlKHByb3BlcnR5TmFtZSwgbW9kaWZpY2F0aW9uLnZhbHVlLCB0cnVlLCBmYWxzZSwgbW9kaWZpY2F0aW9uLmVycm9ycyk7XG4gICAgfSk7XG5cbiAgICAvLyDnm5HlkKxiaW5kaW5nT2JqZWN05Y+Y5pu0XG4gICAgYmluZGluZ09iamVjdC52aWV3Q2hhbmdlcy5zdWJzY3JpYmUoKHZpZXdDaGFuZ2U6IFZpZXdDaGFuZ2UpID0+IHtcbiAgICAgIGNvbnN0IHZhbHVlID0gdmlld0NoYW5nZS52YWx1ZTtcbiAgICAgIGNvbnN0IHByb3BlcnR5TmFtZSA9IHZpZXdDaGFuZ2UucGF0aFswXTtcblxuICAgICAgbGV0IHBhdGhQcmVmaXggPSAnJztcbiAgICAgIGNvbnN0IHBhdGhEYXRhID0gZW50aXR5LmdldFBhdGhzKCk7XG4gICAgICBjb25zdCBwYXRocyA9IHBhdGhEYXRhLnBhdGg7XG4gICAgICBsZXQgaWQgPSBiaW5kaW5nT2JqZWN0WydpZCddO1xuICAgICAgaWYgKHBhdGhEYXRhLmlzVWR0KSB7XG4gICAgICAgIC8vIGdyaWTkuK11ZHTmsqHmnIlpZO+8jOS7jueItue6p+S4reWPluWHumlk77yM5Lul5L6/5a2Y5pS+6aqM6K+B5L+h5oGvXG4gICAgICAgIGNvbnN0IGdldFBhcmVudElkID0gKHRhcmdldDogYW55KSA9PiB7XG4gICAgICAgICAgbGV0IHBhcmVudElkID0gJyc7XG4gICAgICAgICAgY29uc3QgZmluZElkID0gKGl0ZW06IGFueSkgPT4ge1xuICAgICAgICAgICAgaWYgKGl0ZW0gJiYgaXRlbSAmJiBpdGVtWydpZCddKSB7XG4gICAgICAgICAgICAgIHBhcmVudElkID0gaXRlbVsnaWQnXTtcbiAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChpdGVtWydwYXJlbnQnXSkge1xuICAgICAgICAgICAgICBmaW5kSWQoaXRlbVsncGFyZW50J10pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH07XG4gICAgICAgICAgZmluZElkKHRhcmdldCk7XG4gICAgICAgICAgcmV0dXJuIHBhcmVudElkO1xuICAgICAgICB9O1xuICAgICAgICBpZCA9IGdldFBhcmVudElkKGJpbmRpbmdPYmplY3QpO1xuICAgICAgICBpZiAocGF0aERhdGEuaXNHcmlkKSB7XG4gICAgICAgICAgLy8gZ3JpZCDlsIbku47ooajkuLvlrZfmrrXljrvpmaRcbiAgICAgICAgICBwYXRocy5zaGlmdCgpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChwYXRocy5sZW5ndGgpIHtcbiAgICAgICAgICBwYXRoUHJlZml4ID0gcGF0aHMuam9pbignLicpICsgJy4nO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIOS4jeaYr+S4u+mUruWAvOWtl+auteaXtu+8jOimgeWFiOajgOafpeS4u+mUruaYr+WQpuWtmOWcqO+8jOW5tuS4lOS4u+mUruaYr+WQpuebuOetie+8iOmYsuatouWQjuS7o+WPmOabtOWGkuazoeS4iuadpe+8iVxuICAgICAgLy8g6Z2e5Li76ZSu5bGe5oCn5Y+Y5pu05pe277yM6KaB5YWI5qOA5p+l5Li76ZSu5piv5ZCm5Yy56YWN77yI5aaC5p6c5Li76ZSu5Lmf5L+u5pS55LqG77yM6KaB5rGC5YWI5L+u5pS55Li76ZSu5YaN5L+u5pS55YW25LuW5YC877yJXG4gICAgICBpZiAoYmluZGluZ09iamVjdC5wcmltYXJ5S2V5KSB7XG4gICAgICAgIGNvbnN0IHByaW1hcnlLZXkgPSBiaW5kaW5nT2JqZWN0LnByaW1hcnlLZXk7XG4gICAgICAgIGlmIChwcm9wZXJ0eU5hbWUgIT09IHByaW1hcnlLZXkpIHtcbiAgICAgICAgICBpZiAoIWVudGl0eVtwcmltYXJ5S2V5XSB8fCBlbnRpdHlbcHJpbWFyeUtleV0gIT09IGJpbmRpbmdPYmplY3RbcHJpbWFyeUtleV0pIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgLy8g5aaC5p6cQmluZGluZ09iamVjdOS4iueahOWxnuaAp+WAvOWSjEVudGl0eeS4iuWvueW6lOWxnuaAp+WAvOS4gOagt++8jOWImeS4jeWGjeiuvue9rlxuICAgICAgaWYgKGVudGl0eVtwcm9wZXJ0eU5hbWVdID09PSB2YWx1ZSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIC8vIOiwg+eUqOihqOWNlemqjOivgSzpgJrov4flkI7osIPnlKjlrp7kvZPpqozor4FcbiAgICAgIC8vIGJpbmdkaW5nT2JqZWN05Y+Y5YyW5ZCO77yM5YWI6LCD55So5a6e5L2T5LiK55qE6aqM6K+B77yM6YCa6L+H5ZCO5YaN6K6+572u5a6e5L2T55qE5Y+Y5YqoXG4gICAgICBlbnRpdHlbcHJvcGVydHlOYW1lXSA9IHZhbHVlO1xuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIOWwhmVudGl0eUxpc3TkuK3nmoRFbnRpdHnlr7nosaHovazmjaLkuLpCaW5kaW5nT2JqZWN05a+56LGh77yM5Yqg6L295YiwYmluZGluZ0xpc3TkuK3vvIzlubbkv53mjIFlbnRpdHlMaXN05ZKMYmluZGluZ0xpc3TlkIzmraXjgIJcbiAgICogQHBhcmFtIGVudGl0eUxpc3QgIOWunuS9k+WIl+ihqFxuICAgKiBAcGFyYW0gYmluZGluZ0xpc3Qg57uR5a6a5YiX6KGoXG4gICAqL1xuICBzdGF0aWMgbG9hZEVudGl0eUxpc3QoZW50aXR5TGlzdDogRW50aXR5TGlzdDxhbnk+LCBiaW5kaW5nTGlzdDogQmluZGluZ0xpc3QpIHtcbiAgICB0aGlzLmxvYWRFbnRpdGllcyhlbnRpdHlMaXN0Lml0ZW1zLCBiaW5kaW5nTGlzdCk7XG5cbiAgICB0aGlzLnNldFVwRW50aXR5TGlzdFBpcGVsaW5lKGVudGl0eUxpc3QsIGJpbmRpbmdMaXN0KTtcbiAgfVxuXG4gIC8qKlxuICAgKiDlu7rnq4tlbnRpdHlMaXN05ZKMYmluZGluZ0xpc3TkuYvpl7TnmoTlhbPogZRcbiAgICogQHBhcmFtIGVudGl0eUxpc3QgIOWunuS9k+WIl+ihqFxuICAgKiBAcGFyYW0gYmluZGluZ0xpc3Qg57uR5a6a5YiX6KGoXG4gICAqL1xuICBzdGF0aWMgc2V0VXBFbnRpdHlMaXN0UGlwZWxpbmUoZW50aXR5TGlzdDogRW50aXR5TGlzdDxhbnk+LCBiaW5kaW5nTGlzdDogQmluZGluZ0xpc3QpIHtcblxuICAgIGVudGl0eUxpc3Qub25MaXN0Q2hhbmdlZC5zdWJzY3JpYmUoKG1vZGlmaWNhdGlvbjogTW9kaWZpY2F0aW9uKSA9PiB7XG4gICAgICBzd2l0Y2ggKG1vZGlmaWNhdGlvbi50eXBlKSB7XG4gICAgICAgIC8vIOa3u+WKoOWunuS9k1xuICAgICAgICBjYXNlIE1vZGlmeVR5cGUuQWRkOlxuICAgICAgICBjYXNlIE1vZGlmeVR5cGUuQ2xvbmU6XG4gICAgICAgICAge1xuICAgICAgICAgICAgY29uc3QgZW50aXRpZXNUb0FkZCA9IDxFbnRpdHlbXT5tb2RpZmljYXRpb24udmFsdWU7XG4gICAgICAgICAgICBpZiAoZW50aXRpZXNUb0FkZC5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8g5qOA5p+l54i2aWTmmK/lkKbkuIDoh7TvvIzlhpLms6Hlr7zoh7TnmoTlj5jmm7TkuI3lpITnkIZcbiAgICAgICAgICAgIGNvbnN0IHBhdGhzID0gbW9kaWZpY2F0aW9uLnBhdGg7XG4gICAgICAgICAgICBjb25zdCBwYXJlbnRQYXRoID0gcGF0aHNbcGF0aHMubGVuZ3RoIC0gMl07XG4gICAgICAgICAgICBjb25zdCBwYXJlbnRJZCA9IGJpbmRpbmdMaXN0LnBhcmVudC5wcmltYXJ5S2V5VmFsdWU7XG4gICAgICAgICAgICBpZiAocGFyZW50UGF0aC5pbmRleE9mKHBhcmVudElkKSA9PT0gLTEpIHtcbiAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLmFwcGVuZEVudGl0aWVzKDxFbnRpdHlbXT5tb2RpZmljYXRpb24udmFsdWUsIGJpbmRpbmdMaXN0LCBtb2RpZmljYXRpb24udHlwZSA9PT0gTW9kaWZ5VHlwZS5DbG9uZSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIE1vZGlmeVR5cGUuSW5zZXJ0OlxuICAgICAgICAgIHtcbiAgICAgICAgICAgIC8vIOajgOafpeeItmlk5piv5ZCm5LiA6Ie077yM5YaS5rOh5a+86Ie055qE5Y+Y5pu05LiN5aSE55CGXG4gICAgICAgICAgICBjb25zdCBwYXRocyA9IG1vZGlmaWNhdGlvbi5wYXRoO1xuICAgICAgICAgICAgY29uc3QgcGFyZW50UGF0aCA9IHBhdGhzW3BhdGhzLmxlbmd0aCAtIDJdO1xuICAgICAgICAgICAgY29uc3QgcGFyZW50SWQgPSBiaW5kaW5nTGlzdC5wYXJlbnQucHJpbWFyeUtleVZhbHVlO1xuICAgICAgICAgICAgY29uc3QgcG9zaXRpb24gPSBtb2RpZmljYXRpb24ucG9zaXRpb247XG4gICAgICAgICAgICBpZiAocGFyZW50UGF0aC5pbmRleE9mKHBhcmVudElkKSA9PT0gLTEpIHtcbiAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5pbnNlcnRFbnRpdHkobW9kaWZpY2F0aW9uLnZhbHVlWzBdLCBiaW5kaW5nTGlzdCwgcG9zaXRpb24pO1xuICAgICAgICAgIH1cbiAgICAgICAgICBicmVhaztcbiAgICAgICAgLy8g5Yig6Zmk5a6e5L2TXG4gICAgICAgIGNhc2UgTW9kaWZ5VHlwZS5SZW1vdmU6XG4gICAgICAgICAge1xuICAgICAgICAgICAgLy8g5Yig6Zmk5a6e5L2T77yIdmFsdWXmoLzlvI/lvoXllYbmprfvvIznm67liY12YWx1ZeeahOagvOW8j+S4uiB7IHByaW1hcnlLZXk6IHByaW1hcnlWYWx1ZX3vvIlcbiAgICAgICAgICAgIGNvbnN0IGlkID0gbW9kaWZpY2F0aW9uLnZhbHVlW2JpbmRpbmdMaXN0LnByaW1hcnlLZXldO1xuICAgICAgICAgICAgYmluZGluZ0xpc3QucmVtb3ZlQnlJZHMoW2lkXSk7XG4gICAgICAgICAgICAvLyB0aGlzLnJlbW92ZUVudGl0aWVzKDxFbnRpdHlbXT5tb2RpZmljYXRpb24udmFsdWUsIGJpbmRpbmdMaXN0KTtcbiAgICAgICAgICB9XG4gICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgLy8g5Yqg6L295a6e5L2TXG4gICAgICAgIGNhc2UgTW9kaWZ5VHlwZS5Mb2FkOlxuICAgICAgICAgIGNvbnN0IGVudGl0aWVzID0gbW9kaWZpY2F0aW9uLnZhbHVlO1xuICAgICAgICAgIHRoaXMubG9hZEVudGl0aWVzKGVudGl0aWVzLCBiaW5kaW5nTGlzdCk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICog55uR5ZCscmVwb3NpdG9yeeWPmOWMlu+8jOS/neaMgXJlcG9zaXRvcnnlkoxiaW5kaW5nTGlzdOWQjOatpeOAglxuICAgKiBAcGFyYW0gcmVwb3NpdG9yeSAg5a6e5L2T5LuT5bqTXG4gICAqIEBwYXJhbSBiaW5kaW5nTGlzdCDnu5HlrprliJfooahcbiAgICovXG4gIHN0YXRpYyBsb2FkUmVwb3NpdG9yeShyZXBvc2l0b3J5OiBSZXBvc2l0b3J5PGFueT4sIGJpbmRpbmdMaXN0OiBCaW5kaW5nTGlzdCkge1xuXG4gICAgLy8g5Yid5qyh5Yqg6L29XG4gICAgY29uc3QgZW50aXRpZXMgPSBBcnJheS5mcm9tKHJlcG9zaXRvcnkuZW50aXR5Q29sbGVjdGlvbi50b0FycmF5KCkpO1xuICAgIHRoaXMubG9hZEVudGl0aWVzKGVudGl0aWVzLCBiaW5kaW5nTGlzdCk7XG5cbiAgICAvLyDnm5HlkKzlj5jljJZcbiAgICByZXBvc2l0b3J5LmVudGl0eUNvbGxlY3Rpb25DaGFuZ2Uuc3Vic2NyaWJlKChtb2RpZmljYXRpb246IE1vZGlmaWNhdGlvbikgPT4ge1xuICAgICAgc3dpdGNoIChtb2RpZmljYXRpb24udHlwZSkge1xuICAgICAgICBjYXNlIE1vZGlmeVR5cGUuTG9hZDpcbiAgICAgICAgICB0aGlzLmxvYWRFbnRpdGllcyg8RW50aXR5W10+bW9kaWZpY2F0aW9uLnZhbHVlLCBiaW5kaW5nTGlzdCwgbW9kaWZpY2F0aW9uLmVudGl0eUNyZWF0ZSk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgTW9kaWZ5VHlwZS5BZGQ6XG4gICAgICAgIGNhc2UgTW9kaWZ5VHlwZS5DbG9uZTpcbiAgICAgICAgICB0aGlzLmFwcGVuZEVudGl0aWVzKDxFbnRpdHlbXT5tb2RpZmljYXRpb24udmFsdWUsIGJpbmRpbmdMaXN0LCBtb2RpZmljYXRpb24udHlwZSA9PT0gTW9kaWZ5VHlwZS5DbG9uZSk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgTW9kaWZ5VHlwZS5BZGREYXRhOlxuICAgICAgICAgIHRoaXMuYWRkRGF0YSg8RW50aXR5W10+bW9kaWZpY2F0aW9uLnZhbHVlLCBiaW5kaW5nTGlzdCk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgTW9kaWZ5VHlwZS5JbnNlcnQ6XG4gICAgICAgICAgdGhpcy5pbnNlcnRFbnRpdHkobW9kaWZpY2F0aW9uLnZhbHVlLCBiaW5kaW5nTGlzdCwgbW9kaWZpY2F0aW9uLnBvc2l0aW9uKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBNb2RpZnlUeXBlLlJlbW92ZTpcbiAgICAgICAgICB0aGlzLnJlbW92ZUVudGl0aWVzKDxFbnRpdHlbXT5tb2RpZmljYXRpb24udmFsdWUsIGJpbmRpbmdMaXN0KTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBNb2RpZnlUeXBlLlJlbW92ZURhdGE6XG4gICAgICAgICAgdGhpcy5yZW1vdmVEYXRhKDxFbnRpdHlbXT5tb2RpZmljYXRpb24udmFsdWUsIGJpbmRpbmdMaXN0KTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBNb2RpZnlUeXBlLlBhZ2luYXRpb25JbmZvQ2hhbmdlOlxuICAgICAgICAgIGJpbmRpbmdMaXN0LnBhZ2luYXRpb25JbmZvID0gPFBhZ2luYXRpb24+bW9kaWZpY2F0aW9uLnZhbHVlO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgLy8g55uR5ZCsQmluZGluZ0xpc3TmlbDmja7lj5jljJZcbiAgICBiaW5kaW5nTGlzdC5jaGFuZ2VzLnN1YnNjcmliZSgoY2hhbmdlOiBDaGFuZ2UpID0+IHtcbiAgICAgIGlmIChjaGFuZ2UudHlwZSA9PT0gQ2hhbmdlVHlwZS5QYWdpbmF0aW9uSW5mb0NoYW5nZSkge1xuICAgICAgICBjb25zdCBlbnRpdHlDb2xsZWN0aW9uID0gcmVwb3NpdG9yeS5lbnRpdHlDb2xsZWN0aW9uO1xuICAgICAgICAvLyBjb25zdCBlbnRpdHlUeXBlTmFtZSA9IGVudGl0eUNvbGxlY3Rpb24uZW50aXR5VHlwZU5hbWU7XG4gICAgICAgIC8vIGNvbnN0IG9yaWdpbmFsID0gZW50aXR5Q29sbGVjdGlvbi5wYWdpbmF0aW9uSW5mb1tlbnRpdHlUeXBlTmFtZV07XG4gICAgICAgIC8vIGNvbnN0IGVudGl0eVBhZ2luYXRpb25JbmZvID0gT2JqZWN0LmFzc2lnbih7fSwgb3JpZ2luYWwsIGNoYW5nZS52YWx1ZSk7XG4gICAgICAgIGVudGl0eUNvbGxlY3Rpb24ucGFnaW5hdGlvbkluZm8gPSBPYmplY3QuYXNzaWduKHt9LCBlbnRpdHlDb2xsZWN0aW9uLnBhZ2luYXRpb25JbmZvLCBjaGFuZ2UudmFsdWUpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIOWwhmVudGl0aWVz5Lit55qERW50aXR55a+56LGh6L2s5o2i5Li6QmluZGluZ09iamVjdOWvueixoe+8jOW5tuWKoOi9veWIsGJpbmRpbmdMaXN05LitXG4gICAqIEBwYXJhbSBlbnRpdGllcyAgICDlrp7kvZPmlbDnu4RcbiAgICogQHBhcmFtIGJpbmRpbmdMaXN0IOe7keWumuWIl+ihqFxuICAgKi9cbiAgc3RhdGljIGxvYWRFbnRpdGllcyhlbnRpdGllczogRW50aXR5W10sIGJpbmRpbmdMaXN0OiBCaW5kaW5nTGlzdCwgZW50aXR5Q3JlYXRlOiBib29sZWFuID0gZmFsc2UpIHtcbiAgICBjb25zdCBiaW5kaW5nT2JqZWN0cyA9IHRoaXMuY3JlYXRlQmluZGluZ09iamVjdHMoZW50aXRpZXMsIGJpbmRpbmdMaXN0KTtcbiAgICBiaW5kaW5nTGlzdC5sb2FkKGJpbmRpbmdPYmplY3RzLCBlbnRpdHlDcmVhdGUpO1xuICB9XG5cbiAgLyoqXG4gICAqIOWwhmVudGl0aWVz5Lit55qERW50aXR55a+56LGh6L2s5o2i5Li6QkluZGluZ09iamVjdOWvueixoe+8jOW5tui/veWKoOWIsGJpbmRpbmdMaXN05LitXG4gICAqIEBwYXJhbSBlbnRpdGllcyAgICDlrp7kvZPmlbDnu4RcbiAgICogQHBhcmFtIGJpbmRpbmdMaXN0IOe7keWumuWIl+ihqFxuICAgKi9cbiAgc3RhdGljIGFwcGVuZEVudGl0aWVzKGVudGl0aWVzOiBFbnRpdHlbXSwgYmluZGluZ0xpc3Q6IEJpbmRpbmdMaXN0LCBpc0Nsb25lZDogYm9vbGVhbiA9IGZhbHNlKSB7XG4gICAgY29uc3QgYmluZGluZ09iamVjdHMgPSB0aGlzLmNyZWF0ZUJpbmRpbmdPYmplY3RzKGVudGl0aWVzLCBiaW5kaW5nTGlzdCk7XG4gICAgYmluZGluZ0xpc3QuYXBwZW5kKGJpbmRpbmdPYmplY3RzLCBpc0Nsb25lZCk7XG4gIH1cbiAgLyoqXG4gICAqIOWinuWKoOWunuS9k+aVsOaNru+8iOS4jeWIh+aNouW9k+WJjeihjO+8iVxuICAgKiBAcGFyYW0gZW50aXRpZXMgXG4gICAqIEBwYXJhbSBiaW5kaW5nTGlzdCBcbiAgICovXG4gIHN0YXRpYyBhZGREYXRhKGVudGl0aWVzOiBFbnRpdHlbXSwgYmluZGluZ0xpc3Q6IEJpbmRpbmdMaXN0KSB7XG4gICAgY29uc3QgYmluZGluZ09iamVjdHMgPSB0aGlzLmNyZWF0ZUJpbmRpbmdPYmplY3RzKGVudGl0aWVzLCBiaW5kaW5nTGlzdCk7XG4gICAgYmluZGluZ0xpc3QuYWRkRGF0YShiaW5kaW5nT2JqZWN0cyk7XG4gIH1cbiAgc3RhdGljIGluc2VydEVudGl0eShlbnRpdHk6IEVudGl0eSwgYmluZGluZ0xpc3Q6IEJpbmRpbmdMaXN0LCBwb3NpdGlvbjogLTEgfCAxKSB7XG4gICAgY29uc3QgYmluZGluZ09iamVjdCA9IHRoaXMuY3JlYXRlQmluZGluZ09iamVjdChlbnRpdHksIGJpbmRpbmdMaXN0KTtcbiAgICBiaW5kaW5nTGlzdC5pbnNlcnQoYmluZGluZ09iamVjdCwgcG9zaXRpb24pO1xuICB9XG4gIC8qKlxuICAgKiDku45iaW5kaW5nTGlzdOenu+mZpGVudGl0aWVz5a+55bqU55qEQmluZGluZ09iamVjdOWvueixoVxuICAgKiBAcGFyYW0gZW50aXRpZXMgICAg5a6e5L2T5pWw57uEXG4gICAqIEBwYXJhbSBiaW5kaW5nTGlzdCDnu5HlrprliJfooahcbiAgICovXG4gIHN0YXRpYyByZW1vdmVFbnRpdGllcyhlbnRpdGllczogRW50aXR5W10sIGJpbmRpbmdMaXN0OiBCaW5kaW5nTGlzdCkge1xuICAgIGlmIChlbnRpdGllcyA9PT0gbnVsbCB8fCBlbnRpdGllcy5sZW5ndGggPT09IDApIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyDlvZLpm4bopoHliKDpmaTnmoRpZOaVsOe7hFxuICAgIGNvbnN0IHByaW1hcnlLZXkgPSBiaW5kaW5nTGlzdC5wcmltYXJ5S2V5O1xuICAgIGNvbnN0IGlkcyA9IFtdO1xuICAgIGVudGl0aWVzLmZvckVhY2goKGVudGl0eTogRW50aXR5KSA9PiB7XG4gICAgICBpZHMucHVzaChlbnRpdHlbcHJpbWFyeUtleV0pO1xuICAgIH0pO1xuICAgIGJpbmRpbmdMaXN0LnJlbW92ZUJ5SWRzKGlkcyk7XG4gIH1cbiAgc3RhdGljIHJlbW92ZURhdGEoZW50aXRpZXM6IEVudGl0eVtdLCBiaW5kaW5nTGlzdDogQmluZGluZ0xpc3QpIHtcbiAgICBpZiAoZW50aXRpZXMgPT09IG51bGwgfHwgZW50aXRpZXMubGVuZ3RoID09PSAwKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIC8vIOW9kumbhuimgeWIoOmZpOeahGlk5pWw57uEXG4gICAgY29uc3QgcHJpbWFyeUtleSA9IGJpbmRpbmdMaXN0LnByaW1hcnlLZXk7XG4gICAgY29uc3QgaWRzID0gW107XG4gICAgZW50aXRpZXMuZm9yRWFjaCgoZW50aXR5OiBFbnRpdHkpID0+IHtcbiAgICAgIGlkcy5wdXNoKGVudGl0eVtwcmltYXJ5S2V5XSk7XG4gICAgfSk7XG4gICAgYmluZGluZ0xpc3QucmVtb3ZlRGF0YUJ5SWRzKGlkcyk7XG4gIH1cbiAgLyoqXG4gICAqIOWwhmVudGl0aWVz5Lit55qERW50aXR55a+56LGh6L2s5o2i5Li6QmluZGluZ09iamVjdOWvueixoVxuICAgKiBAcGFyYW0gZW50aXRpZXMgICAg5a6e5L2T5pWw57uEXG4gICAqIEBwYXJhbSBiaW5kaW5nTGlzdCDnu5HlrprliJfooahcbiAgICovXG4gIHN0YXRpYyBjcmVhdGVCaW5kaW5nT2JqZWN0cyhlbnRpdGllczogRW50aXR5W10sIGJpbmRpbmdMaXN0OiBCaW5kaW5nTGlzdCkge1xuXG4gICAgaWYgKGVudGl0aWVzID09PSBudWxsIHx8IGVudGl0aWVzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgcmV0dXJuIFtdO1xuICAgIH1cblxuICAgIGNvbnN0IGJpbmRpbmdPYmplY3RzID0gW107XG4gICAgZW50aXRpZXMuZm9yRWFjaCgoZW50aXR5OiBFbnRpdHkpID0+IHtcbiAgICAgIGNvbnN0IGJpbmRpbmdPYmplY3QgPSBCaW5kaW5nT2JqZWN0RmFjdG9yeS5jcmVhdGUoYmluZGluZ0xpc3QucHJvcGVydGllcyk7XG4gICAgICBiaW5kaW5nT2JqZWN0WydfRU5USVRZXyddID0gZW50aXR5O1xuICAgICAgdGhpcy5sb2FkRW50aXR5KGVudGl0eSwgYmluZGluZ09iamVjdCk7XG5cbiAgICAgIC8vIC8vIOS4umJpbmRpbmdPYmplY3Torr7nva7pu5jorqTlgLxpbml0aWFsRGF0YeWxnuaAp1xuICAgICAgLy8gaWYgKGVudGl0eVsnaW5pdGlhbERhdGEnXSkge1xuICAgICAgLy8gICBiaW5kaW5nT2JqZWN0Wydpbml0aWFsRGF0YSddID0gZW50aXR5Wydpbml0aWFsRGF0YSddO1xuICAgICAgLy8gfVxuXG4gICAgICBiaW5kaW5nT2JqZWN0cy5wdXNoKGJpbmRpbmdPYmplY3QpO1xuICAgIH0pO1xuICAgIHJldHVybiBiaW5kaW5nT2JqZWN0cztcbiAgfVxuICBzdGF0aWMgY3JlYXRlQmluZGluZ09iamVjdChlbnRpdHk6IEVudGl0eSwgYmluZGluZ0xpc3Q6IEJpbmRpbmdMaXN0KSB7XG4gICAgY29uc3QgYmluZGluZ09iamVjdCA9IEJpbmRpbmdPYmplY3RGYWN0b3J5LmNyZWF0ZShiaW5kaW5nTGlzdC5wcm9wZXJ0aWVzKTtcbiAgICB0aGlzLmxvYWRFbnRpdHkoZW50aXR5LCBiaW5kaW5nT2JqZWN0KTtcbiAgICByZXR1cm4gYmluZGluZ09iamVjdDtcbiAgfVxuICBwdWJsaWMgc3RhdGljIHdhdGNoUmVwb3Npcm90eShyZXBvc2l0b3J5OiBSZXBvc2l0b3J5PGFueT4sIGJpbmRpbmdEYXRhOiBCaW5kaW5nRGF0YSkge1xuICAgIC8vIHJlcG9zaXJvdHkgPT4gYmluZGluZ0RhdGFcbiAgICByZXBvc2l0b3J5LmVudGl0eUNvbGxlY3Rpb25DaGFuZ2Uuc3Vic2NyaWJlKChtb2RpZmljYXRpb246IE1vZGlmaWNhdGlvbikgPT4ge1xuICAgICAgc3dpdGNoIChtb2RpZmljYXRpb24udHlwZSkge1xuICAgICAgICBjYXNlIE1vZGlmeVR5cGUuUGFnaW5hdGlvbkluZm9DaGFuZ2U6XG4gICAgICAgICAgYmluZGluZ0RhdGEucGFnaW5nSW5mbyA9IG1vZGlmaWNhdGlvbi52YWx1ZTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuICAvKipcbiAgICog5p+l5om+5bGe5oCn55qE57G75Z6LXG4gICAqIEBwYXJhbSBlbnRpdHlUeXBlIOWunuS9k+exu+Wei1xuICAgKiBAcGFyYW0gdGFyZ2V0UHJvcE5hbWUg5bGe5oCn5ZCN56ewXG4gICAqIEByZXR1cm4g5bGe5oCn5L+h5oGv77yM5YyF5ZCr5bGe5oCn57G75Z6L77yITmdGaWVsZOOAgU5nT2JqZWN044CBTmdMaXN077yJ5ZKM5bGe5oCn5a+55bqU55qE5a6e5L2T57G75Z6L77yI5b2TTmdGaWVsZOexu+Wei+aXtuS4um51bGzvvIlcbiAgICovXG4gIHN0YXRpYyBnZXRQcm9wSW5mbyhlbnRpdHlUeXBlOiBhbnksIHRhcmdldFByb3BOYW1lOiBzdHJpbmcpOiB7IHByb3BUeXBlOiBzdHJpbmcsIHByb3BFbnRpdHlUeXBlOiBhbnkgfSB7XG5cbiAgICBsZXQgcHJvcFR5cGU6IHN0cmluZztcbiAgICBsZXQgcHJvcEVudGl0eVR5cGU6IGFueTtcblxuICAgIC8vIE5nRmllbGRcbiAgICBjb25zdCBuZ0ZpZWxkUHJvcGVydGllcyA9IEZpZWxkTWV0YWRhdGFVdGlsLmdldE5nRmllbGRzKGVudGl0eVR5cGUpO1xuICAgIE9iamVjdC5rZXlzKG5nRmllbGRQcm9wZXJ0aWVzKS5mb3JFYWNoKChwcm9wTmFtZTogc3RyaW5nKSA9PiB7XG4gICAgICBpZiAocHJvcE5hbWUgPT09IHRhcmdldFByb3BOYW1lKSB7XG4gICAgICAgIHByb3BUeXBlID0gJ05nRmllbGQnO1xuICAgICAgICBwcm9wRW50aXR5VHlwZSA9IG51bGw7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICAvLyBOZ09iamVjdFxuICAgIGNvbnN0IG5nT2JqZWN0UHJvcGVydGllcyA9IEZpZWxkTWV0YWRhdGFVdGlsLmdldE5nT2JqZWN0cyhlbnRpdHlUeXBlKTtcbiAgICBPYmplY3Qua2V5cyhuZ09iamVjdFByb3BlcnRpZXMpLmZvckVhY2goKHByb3BOYW1lOiBzdHJpbmcpID0+IHtcbiAgICAgIGlmIChwcm9wTmFtZSA9PT0gdGFyZ2V0UHJvcE5hbWUpIHtcbiAgICAgICAgcHJvcFR5cGUgPSAnTmdPYmplY3QnO1xuICAgICAgICBwcm9wRW50aXR5VHlwZSA9IG5nT2JqZWN0UHJvcGVydGllc1twcm9wTmFtZV0udHlwZTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIC8vIE5nTGlzdFxuICAgIGNvbnN0IG5nTGlzdFByb3BlcnRpZXMgPSBGaWVsZE1ldGFkYXRhVXRpbC5nZXROZ0xpc3QoZW50aXR5VHlwZSk7XG4gICAgT2JqZWN0LmtleXMobmdMaXN0UHJvcGVydGllcykuZm9yRWFjaCgocHJvcE5hbWU6IHN0cmluZykgPT4ge1xuICAgICAgaWYgKHByb3BOYW1lID09PSB0YXJnZXRQcm9wTmFtZSkge1xuICAgICAgICBwcm9wVHlwZSA9ICdOZ0xpc3QnO1xuICAgICAgICBwcm9wRW50aXR5VHlwZSA9IG5nTGlzdFByb3BlcnRpZXNbcHJvcE5hbWVdLnR5cGU7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBjb25zdCBuZ0R5bmFtaWNQcm9wZXJ0aWVzID0gRmllbGRNZXRhZGF0YVV0aWwuZ2V0TmdEeW5hbWljKGVudGl0eVR5cGUpO1xuICAgIE9iamVjdC5rZXlzKG5nRHluYW1pY1Byb3BlcnRpZXMpLmZvckVhY2goKHByb3BOYW1lOiBzdHJpbmcpID0+IHtcbiAgICAgIGlmIChwcm9wTmFtZSA9PT0gdGFyZ2V0UHJvcE5hbWUpIHtcbiAgICAgICAgcHJvcFR5cGUgPSAnTmdEeW5hbWljJztcbiAgICAgICAgcHJvcEVudGl0eVR5cGUgPSBuZ0R5bmFtaWNQcm9wZXJ0aWVzW3Byb3BOYW1lXS50eXBlO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgcmV0dXJuIHsgcHJvcFR5cGUsIHByb3BFbnRpdHlUeXBlIH07XG4gIH1cblxuICAvKipcbiAgICog6I635Y+W5a6e5L2T55qE5Li76ZSu5ZCNXG4gICAqIEBwYXJhbSBlbnRpdHlUeXBlIOWunuS9k+exu+Wei1xuICAgKi9cbiAgc3RhdGljIGdldFByaW1hcnlLZXkoZW50aXR5VHlwZTogYW55KSB7XG4gICAgY29uc3QgcHJpbWFyeU5nRmlsZWRQcm9wID0gRmllbGRNZXRhZGF0YVV0aWwuZ2V0UHJpbWFyeUZpZWxkTWV0YWRhdGEoZW50aXR5VHlwZSk7XG4gICAgaWYgKHByaW1hcnlOZ0ZpbGVkUHJvcCkge1xuICAgICAgcmV0dXJuIHByaW1hcnlOZ0ZpbGVkUHJvcC5kYXRhRmllbGQ7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiAnJztcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICog5piv5ZCm5Li65a+56LGh5bGe5oCnXG4gICAqL1xuICBzdGF0aWMgaXNPYmplY3RQcm9wKGVudGl0eVR5cGU6IGFueSwgdGFyZ2V0UHJvcE5hbWU6IHN0cmluZywpIHtcbiAgICBsZXQgaXNPYmplY3RQcm9wID0gZmFsc2U7XG4gICAgY29uc3QgbmdPYmplY3RQcm9wZXJ0aWVzID0gRmllbGRNZXRhZGF0YVV0aWwuZ2V0TmdPYmplY3RzKGVudGl0eVR5cGUpO1xuICAgIE9iamVjdC5rZXlzKG5nT2JqZWN0UHJvcGVydGllcykuZm9yRWFjaCgocHJvcE5hbWU6IHN0cmluZykgPT4ge1xuICAgICAgaWYgKHByb3BOYW1lID09PSB0YXJnZXRQcm9wTmFtZSkge1xuICAgICAgICBpc09iamVjdFByb3AgPSB0cnVlO1xuICAgICAgfVxuICAgIH0pO1xuICAgIHJldHVybiBpc09iamVjdFByb3A7XG4gIH1cblxuICAvKipcbiAgICog5qOA5p+l5piv5ZCm5piv5Yqo5oCB5YiX5bGe5oCnXG4gICAqL1xuICBzdGF0aWMgaXNEeW5hbWljUHJvcChlbnRpdHlUeXBlOiBhbnksIHRhcmdldFByb3BOYW1lOiBzdHJpbmcpIHtcbiAgICBsZXQgaXNEeW5hbWljUHJvcCA9IGZhbHNlO1xuICAgIGNvbnN0IG5nRHluYW1pY1Byb3BlcnRpZXMgPSBGaWVsZE1ldGFkYXRhVXRpbC5nZXROZ0R5bmFtaWMoZW50aXR5VHlwZSk7XG4gICAgT2JqZWN0LmtleXMobmdEeW5hbWljUHJvcGVydGllcykuZm9yRWFjaCgocHJvcE5hbWU6IHN0cmluZykgPT4ge1xuICAgICAgaWYgKHByb3BOYW1lID09PSB0YXJnZXRQcm9wTmFtZSkge1xuICAgICAgICBpc0R5bmFtaWNQcm9wID0gdHJ1ZTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICByZXR1cm4gaXNEeW5hbWljUHJvcDtcbiAgfVxuXG4gIC8qKlxuICAgKiDkuLrlrp7kvZPlop7liqBpbml0aWFsRGF0YeWxnuaAp1xuICAgKiBAcGFyYW0gZW50aXR5IOWunuS9k+WunuS+i1xuICAgKiBAcGFyYW0gaW5pdGlhbERhdGEg6buY6K6k5YC85a+56LGhXG4gICAqL1xuICBzdGF0aWMgYXBwZW5kSW5pdGlhbERhdGEoZW50aXR5LCBpbml0aWFsRGF0YSkge1xuICAgIGNvbnN0IGRhdGEgPSBPYmplY3QuYXNzaWduKHt9LCBpbml0aWFsRGF0YSk7XG4gICAgZGVsZXRlIGRhdGEuaWQ7XG4gICAgZGVsZXRlIGRhdGEucGFyZW50SUQ7XG4gICAgZW50aXR5Wydpbml0aWFsRGF0YSddID0gZGF0YTtcbiAgfVxufVxuXG5leHBvcnQgeyBFbnRpdHlVdGlsIH07XG4iXX0=
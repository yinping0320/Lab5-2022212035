import * as tslib_1 from "tslib";
import { Subject } from 'rxjs';
import { ArrayUtil } from '../utils/index';
import { ChangeType } from './changes';
import { BindingData } from './binding_data';
import { BindingObjectFactory } from './binding_object_factory';
import { PropertyUtil } from './property_util';
/**
 * BindingList是一个BindingObject集合
 */
var BindingList = /** @class */ (function () {
    /**
     * 构造函数
     */
    function BindingList(properties) {
        //#region 分页相关
        /**
         * 分页信息
         */
        this._paginationInfo = null;
        this.properties = properties;
        this.primaryKey = PropertyUtil.getPrimaryKey(properties);
        this.changes = new Subject();
        this.innerList = [];
        this.currentId = null;
    }
    Object.defineProperty(BindingList.prototype, "paginationInfo", {
        get: function () {
            return this._paginationInfo;
        },
        set: function (sPaginationInfo) {
            this._paginationInfo = sPaginationInfo;
            if (this._paginationInfo === sPaginationInfo) {
                return;
            }
            this.changes.next({
                type: ChangeType.PaginationInfoChange,
                path: [],
                value: this._paginationInfo
            });
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(BindingList.prototype, "pageIndex", {
        /**
         * 获取页码
         */
        get: function () {
            if (!!this.paginationInfo && this.paginationInfo.hasOwnProperty("pageIndex")) {
                return this.paginationInfo.pageIndex;
            }
            return 1;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(BindingList.prototype, "pageSize", {
        /**
         * 获取分页大小
         */
        get: function () {
            if (!!this.paginationInfo && this.paginationInfo.hasOwnProperty("pageSize")) {
                return this.paginationInfo.pageSize;
            }
            return 0;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(BindingList.prototype, "total", {
        /**
         * 获取数据总项数
         */
        get: function () {
            if (!!this.paginationInfo) {
                return this.paginationInfo.total || this.paginationInfo.totalCount;
            }
            return 0;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(BindingList.prototype, "skip", {
        /**
         * 获取跳过的数据条数
         */
        get: function () {
            var pageIndex = this.pageIndex;
            var pageSize = this.pageSize;
            return (pageIndex - 1) * pageSize;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * 前台设置分页信息
     * @param skip skip
     * @param take take
     */
    BindingList.prototype.setPaginationInfo = function (skip, take) {
        this.paginationInfo = Object.assign({}, this.paginationInfo, {
            pageSize: take,
            pageIndex: skip / take + 1
        });
        /*this.changes.next({
          type: ChangeType.PaginationInfoChange,
          path: [],
          value: this.paginationInfo
        });*/
    };
    Object.defineProperty(BindingList.prototype, "currentItem", {
        //#endregion
        /**
         * 当前行对应的绑定对象
         * 如果currentId为null，则创建一个空结构，防止绑定报错；
         */
        get: function () {
            var currentItem = this.findById(this.currentId);
            if (!currentItem) {
                if (!this.emptyCurrentItem) {
                    this.emptyCurrentItem = BindingObjectFactory.create(this.properties);
                }
                return this.emptyCurrentItem;
            }
            return currentItem;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(BindingList.prototype, "length", {
        /**
         * 绑定对象的数量
         */
        get: function () {
            return this.innerList.length;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * 添加[Symbol.iterator]，使之能通过for of遍历
     */
    BindingList.prototype[Symbol.iterator] = function () {
        var self = this;
        var index = -1;
        var size = this.innerList.length;
        return {
            next: function () {
                index++;
                if (index < size) {
                    return {
                        done: false,
                        value: self.innerList[index]
                    };
                }
                return { done: true, value: undefined };
            }
        };
    };
    /**
     * 批量加载绑定对象，加载之前先清空绑定列表，并重置当前行，加载之后将第一行设置为默认当前行。
     * @param objects 要加载绑定对象数组
     */
    BindingList.prototype.load = function (objects, entityCreate) {
        var _this = this;
        if (entityCreate === void 0) { entityCreate = false; }
        // 重置列表
        this.innerList = [];
        if (objects.length !== 0) {
            // 加载数据
            objects.forEach(function (object) {
                _this.add(object);
            });
            // 设置默认当前行
            var currentItem = this.findById(this.currentId);
            if (!currentItem) {
                var firstId = objects[0][this.primaryKey];
                this.setCurrentId(firstId, false, false);
            }
        }
        else {
            this.currentId = null;
        }
        var change = {
            type: ChangeType.Load,
            path: [],
            value: objects
        };
        change.create = entityCreate;
        // 触发事件
        this.changes.next(change);
    };
    /**
     * 批量追加绑定对象，追加之后将最后一个追加的绑定对象设置为当前行。
     * @param objects 要加载绑定对象数组
     */
    BindingList.prototype.append = function (objects, isCloned) {
        var _this = this;
        if (isCloned === void 0) { isCloned = false; }
        if (objects.length === 0) {
            return;
        }
        // 加载BindingObject
        objects.forEach(function (object) {
            _this.add(object);
        });
        // 当前行为新追加的最后1行
        var lastId = objects[objects.length - 1][this.primaryKey];
        this.setCurrentId(lastId, true, true);
        // 触发事件
        var change = {
            type: ChangeType.Append,
            path: [],
            value: objects
        };
        if (isCloned) {
            change.isCloned = true;
        }
        this.changes.next(change);
    };
    /**
     * 增加数据
     * @param objects 实体
     * @description 增加实体数据，但不切换当前行
     */
    BindingList.prototype.addData = function (objects) {
        var _this = this;
        if (objects.length === 0) {
            return;
        }
        // 加载BindingObject
        objects.forEach(function (object) {
            _this.add(object);
        });
        // 触发事件
        this.changes.next({
            type: ChangeType.Append,
            path: [],
            value: objects
        });
    };
    BindingList.prototype.insert = function (object, position) {
        // const currentIndex = this.innerList.findIndex((obj: BindingObject) => obj.primaryKeyValue === this.currentId);
        // // 加载BindingObject
        // if (position === 1) {
        //   this.innerList = this.innerList.insert(currentIndex + 1, object);
        // } else if (position === -1) {
        //   this.innerList = this.innerList.insert(currentIndex, object);
        // } else {
        //   this.innerList = this.innerList.push(object);
        // }
        // object.parent = this;
        // // 监听object变更，并继续向上抛，由于list有当前行的概念，不需要在path中追加路径
        // object.changes.subscribe((change: Change) => {
        //   this.changes.next(change);
        // });
        // this.setCurrentId(object.primaryKeyValue, true, true);
        // // 触发事件
        // this.changes.next({
        //   type: ChangeType.Append,
        //   path: [],
        //   value: object
        // });
    };
    /**
     * 添加绑定对象，并建立绑定对象和绑定列表之间的关联。
     * @param object 绑定对象
     */
    BindingList.prototype.add = function (object) {
        var _this = this;
        this.innerList.push(object);
        object.parent = this;
        // 监听object变更，并继续向上抛，由于list有当前行的概念，不需要在path中追加路径
        object.changes.subscribe(function (change) {
            _this.changes.next(change);
        });
    };
    /**
     * 删除主键值数组对应的绑定对象。
     * @param ids 主键值数组
     */
    BindingList.prototype.removeByIds = function (ids) {
        var _this = this;
        if (!ids || ids.length === 0) {
            return;
        }
        var nextCurrentId = this.currentId;
        ids.forEach(function (id) {
            // 如果当前行被删除，计算下一当前行
            if (id === nextCurrentId) {
                nextCurrentId = _this.getCurrentIdBeforeDeleting();
            }
            // 删除对象，找不到时跳过
            var index = _this.getIndexById(id);
            if (index === -1) {
                return;
            }
            ArrayUtil.removeByIndex(_this.innerList, index);
        });
        // 重新设置当前行
        if (this.innerList.length === 0) {
            this.currentId = null;
        }
        else {
            this.setCurrentId(nextCurrentId, false, false);
        }
        // 出发行删除事件
        this.changes.next({
            type: ChangeType.Remove,
            path: [],
            value: ids
        });
    };
    /**
     * 删除数据（不切换当前行）
     * @param ids ids
     */
    BindingList.prototype.removeDataByIds = function (ids) {
        // if (!ids || ids.length === 0) {
        //   return;
        // }
        // ids.forEach((id: string) => {
        //   // 删除对象，找不到时跳过
        //   const index = this.getIndexById(id);
        //   if (index === -1) {
        //     return;
        //   }
        //   this.innerList = this.innerList.delete(index);
        // });
        // // 出发行删除事件
        // this.changes.next({
        //   type: ChangeType.Remove,
        //   path: [],
        //   value: ids
        // });
    };
    /**
     * 清空
     */
    BindingList.prototype.clear = function () {
        this.innerList = [];
        this.currentId = null;
        this.changes.next({
            type: ChangeType.Remove,
            path: [],
            value: []
        });
    };
    /**
     * 如果当前行被删除，删除之前重新计算当前行的位置，并返回下一当前行的主键值。
     * - 如果被删除的行是最后1行，则上移1行；
     * - 其他情况，下移1行。
     */
    BindingList.prototype.getCurrentIdBeforeDeleting = function () {
        var nextIndex = -1;
        var currentIndex = this.getIndexById(this.currentId);
        if (currentIndex === this.length - 1) {
            nextIndex = currentIndex - 1;
        }
        else {
            nextIndex = currentIndex + 1;
        }
        return this.getIdByIndex(nextIndex);
    };
    /**
     * 根据主键值获取对应绑定对象
     * @param   id 要查找的主键值
     * @returns 找到时返回对应BindingObject， 找不到时返回null
     */
    BindingList.prototype.findById = function (id) {
        var _this = this;
        var target;
        target = this.innerList.find(function (item) {
            return item.getValue(_this.primaryKey) === id;
        });
        return target === undefined ? null : target;
    };
    /**
     * 将主键值为id的绑定对象设置为当前行
     * @param  id        要设置的主键值
     * @param  emitEvent 是否发送当前行变更事件
     */
    BindingList.prototype.setCurrentId = function (id, emitEvent, emitGlobalEvent) {
        if (emitEvent === void 0) { emitEvent = true; }
        if (emitGlobalEvent === void 0) { emitGlobalEvent = true; }
        if (this.currentId === id) {
            return;
        }
        // 不存在时设置为null
        // const currentObj = this.findById(id);
        // if (!currentObj) {
        //   this.currentId = null;
        // } else {
        //   this.currentId = id;
        // }
        // @todo：找不到时按理应该设置为null，目前是直接返回，框架部分功能依赖该特性。
        var currentObj = this.findById(id);
        if (!currentObj) {
            return;
        }
        this.currentId = id;
        // 发出行切换事件
        if (emitEvent === true) {
            this.changes.next({
                type: ChangeType.SelectionChanged,
                path: [],
                value: this.currentItem
            });
        }
        // 是否发送全局的行切换事件
        if (emitGlobalEvent === true) {
            this.changes.next({
                type: ChangeType.GlobalSelectionChanged,
                path: [],
                value: this.currentItem
            });
        }
    };
    /**
     * 根据主键值为id的绑定对象的索引
     * @param id 主键值
     * @returns 找到时返回对应的index，找不到时返回-1
     */
    BindingList.prototype.getIndexById = function (id) {
        var _this = this;
        return this.innerList.findIndex(function (obj) {
            return obj[_this.primaryKey] === id;
        });
    };
    /**
     * 根据索引位置获取对应绑定对象的主键值
     * @reutrn 找到时返回对应主键值，找不到返回null
     */
    BindingList.prototype.getIdByIndex = function (index) {
        if (index < 0 || index > this.length) {
            return null;
        }
        var obj = this.innerList[index];
        if (!obj) {
            return null;
        }
        return obj[this.primaryKey];
    };
    /**
     * 转换为BindingObject数组
     */
    BindingList.prototype.toArray = function () {
        return this.innerList.concat([]);
    };
    /**
     * 交互数据位置
     * @param id1 id1
     * @param id2 id2
     */
    BindingList.prototype.swapById = function (id1, id2) {
        // const item1 = this.innerList.find(element => element.primaryKeyValue === id1);
        // const item2 = this.innerList.find(element => element.primaryKeyValue === id2);
        // this.innerList = this.innerList.map((bindingObject: BindingObject, index: number) => {
        //   if (bindingObject.primaryKeyValue === id1) {
        //     return item2;
        //   } else if (bindingObject.primaryKeyValue === id2) {
        //     return item1;
        //   } else return bindingObject;
        // }).toList();
        // this.changes.next({
        //   type: ChangeType.Swap,
        //   path: []
        // });
    };
    /**
     * 转换为JSON对象
     * @returns 普通对象数组
     */
    BindingList.prototype.toJSON = function (options) {
        var result = [];
        this.innerList.forEach(function (obj) {
            result.push(obj.toJSON(options));
        });
        return result;
    };
    /**
     * 获取分页信息
     * @param path 路径
     * @param defaultValue 默认值
     */
    BindingList.prototype.getPaginationConfigByPath = function (path, defaultValue) {
        if (!path || path === '/') {
            return this.paginationInfo;
        }
        if (typeof path !== 'string') {
            throw new Error('路径必须为字符串！');
        }
        path = path.substring(1);
        var paths = path.split('/').filter(function (item) { return !!item && item.trim().length > 0; }).map(function (item) { return item.trim(); });
        var config = this.paginationInfo;
        paths.forEach(function (item) {
            if (config && config.hasOwnProperty(item)) {
                config = config[item];
            }
            else {
                config = null;
            }
        });
        return !!config ? config : typeof defaultValue !== 'undefined' ? defaultValue : undefined;
    };
    /**
     * 对bindingList就行排序
     * @param string 排序字段
     * @param directions 排序规则字段
     * @param options 参数
     */
    BindingList.prototype.sortBy = function (fields, directions, options) {
        if (!fields || fields.length < 1 || !directions || directions.length < 1) {
            throw new Error('sortBy:argument error');
        }
        // 默认升序
        var arrFields = typeof fields === 'string' ? fields.split(',') : fields || [];
        var arrDirections = typeof directions === 'string' ? directions.split(',') : directions || [];
        // 排序字段和排序方式应一致
        if (arrFields.length !== arrDirections.length || arrFields.length < 1) {
            throw new Error('sortBy:fields and directions not match');
        }
        // nage,age,total
        var comparator = function (props, orders) { return function (item1, item2) {
            var e_1, _a;
            try {
                for (var props_1 = tslib_1.__values(props), props_1_1 = props_1.next(); !props_1_1.done; props_1_1 = props_1.next()) {
                    var prop = props_1_1.value;
                    var order = ['asc'].includes(orders[props.indexOf(prop)]) ? 1 : -1;
                    if (item1.getValue(prop) > item2.getValue(prop)) {
                        return order * 1;
                    }
                    if (item1.getValue(prop) < item2.getValue(prop)) {
                        return order * -1;
                    }
                }
            }
            catch (e_1_1) { e_1 = { error: e_1_1 }; }
            finally {
                try {
                    if (props_1_1 && !props_1_1.done && (_a = props_1.return)) _a.call(props_1);
                }
                finally { if (e_1) throw e_1.error; }
            }
            return 0;
        }; };
        this.innerList = this.innerList.sort(comparator(arrFields, arrDirections));
    };
    BindingList.prototype.getValue = function (target, propName, isMultiLangProp, currentLanguage) {
        var e_2, _a;
        if (isMultiLangProp === void 0) { isMultiLangProp = false; }
        if (currentLanguage === void 0) { currentLanguage = 'zh-CHS'; }
        if (target instanceof BindingList) {
            target = target.currentItem;
        }
        else if (target instanceof BindingData) {
            target = target.list.currentItem;
        }
        var result = null;
        if (propName.indexOf('.') === -1) {
            result = target[propName];
        }
        else {
            var props = propName.split('.');
            try {
                for (var props_2 = tslib_1.__values(props), props_2_1 = props_2.next(); !props_2_1.done; props_2_1 = props_2.next()) {
                    var prop = props_2_1.value;
                    target = result = this.getValue(target, prop, isMultiLangProp, currentLanguage);
                }
            }
            catch (e_2_1) { e_2 = { error: e_2_1 }; }
            finally {
                try {
                    if (props_2_1 && !props_2_1.done && (_a = props_2.return)) _a.call(props_2);
                }
                finally { if (e_2) throw e_2.error; }
            }
        }
        if (isMultiLangProp && result && result.hasOwnProperty(currentLanguage)) {
            return result[currentLanguage];
        }
        else {
            return result;
        }
    };
    return BindingList;
}());
export { BindingList };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmluZGluZ19saXN0LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy9tb2JpbGUtZGV2a2l0LyIsInNvdXJjZXMiOlsibGliL2JpbmRpbmctZGF0YS9iaW5kaW5nX2xpc3QudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFFL0IsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQzNDLE9BQU8sRUFBVSxVQUFVLEVBQUUsTUFBTSxXQUFXLENBQUM7QUFDL0MsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBRzdDLE9BQU8sRUFBRSxvQkFBb0IsRUFBRSxNQUFNLDBCQUEwQixDQUFDO0FBQ2hFLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUUvQzs7R0FFRztBQUNIO0lBdUlFOztPQUVHO0lBQ0gscUJBQVksVUFBNkI7UUF4R3pDLGNBQWM7UUFFZDs7V0FFRztRQUNJLG9CQUFlLEdBQVEsSUFBSSxDQUFDO1FBb0dqQyxJQUFJLENBQUMsVUFBVSxHQUFHLFVBQVUsQ0FBQztRQUM3QixJQUFJLENBQUMsVUFBVSxHQUFHLFlBQVksQ0FBQyxhQUFhLENBQUMsVUFBVSxDQUFDLENBQUM7UUFFekQsSUFBSSxDQUFDLE9BQU8sR0FBRyxJQUFJLE9BQU8sRUFBVSxDQUFDO1FBQ3JDLElBQUksQ0FBQyxTQUFTLEdBQUcsRUFBRSxDQUFDO1FBQ3BCLElBQUksQ0FBQyxTQUFTLEdBQUcsSUFBSSxDQUFDO0lBQ3hCLENBQUM7SUF4R0Qsc0JBQUksdUNBQWM7YUFZbEI7WUFDRSxPQUFPLElBQUksQ0FBQyxlQUFlLENBQUM7UUFDOUIsQ0FBQzthQWRELFVBQW1CLGVBQW9CO1lBQ3JDLElBQUksQ0FBQyxlQUFlLEdBQUcsZUFBZSxDQUFDO1lBQ3ZDLElBQUksSUFBSSxDQUFDLGVBQWUsS0FBSyxlQUFlLEVBQUU7Z0JBQzVDLE9BQU87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QixJQUFBLFVBQUEsaUJBQUEsS0FBSyxDQUFBLDRCQUFBLCtDQUFFO29CQUFyQixJQUFNLElBQUksa0JBQUE7b0JBQ2IsTUFBTSxHQUFHLE1BQU0sR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLE1BQU0sRUFBRSxJQUFJLEVBQUUsZUFBZSxFQUFFLGVBQWUsQ0FBQyxDQUFDO2lCQUNqRjs7Ozs7Ozs7O1NBQ0Y7UUFDRCxJQUFJLGVBQWUsSUFBSSxNQUFNLElBQUksTUFBTSxDQUFDLGNBQWMsQ0FBQyxlQUFlLENBQUMsRUFBRTtZQUN2RSxPQUFPLE1BQU0sQ0FBQyxlQUFlLENBQUMsQ0FBQztTQUNoQzthQUFNO1lBQ0wsT0FBTyxNQUFNLENBQUM7U0FDZjtJQUNILENBQUM7SUFDSCxrQkFBQztBQUFELENBQUMsQUExa0JELElBMGtCQztBQUVELE9BQU8sRUFBRSxXQUFXLEVBQUUsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFN1YmplY3QgfSBmcm9tICdyeGpzJztcblxuaW1wb3J0IHsgQXJyYXlVdGlsIH0gZnJvbSAnLi4vdXRpbHMvaW5kZXgnO1xuaW1wb3J0IHsgQ2hhbmdlLCBDaGFuZ2VUeXBlIH0gZnJvbSAnLi9jaGFuZ2VzJztcbmltcG9ydCB7IEJpbmRpbmdEYXRhIH0gZnJvbSAnLi9iaW5kaW5nX2RhdGEnO1xuaW1wb3J0IHsgQmluZGluZ09iamVjdCB9IGZyb20gJy4vYmluZGluZ19vYmplY3QnO1xuaW1wb3J0IHsgQmluZGluZ1Byb3BlcnR5IH0gZnJvbSAnLi9iaW5kaW5nX3Byb3BlcnR5JztcbmltcG9ydCB7IEJpbmRpbmdPYmplY3RGYWN0b3J5IH0gZnJvbSAnLi9iaW5kaW5nX29iamVjdF9mYWN0b3J5JztcbmltcG9ydCB7IFByb3BlcnR5VXRpbCB9IGZyb20gJy4vcHJvcGVydHlfdXRpbCc7XG5cbi8qKlxuICogQmluZGluZ0xpc3TmmK/kuIDkuKpCaW5kaW5nT2JqZWN06ZuG5ZCIXG4gKi9cbmNsYXNzIEJpbmRpbmdMaXN0IHtcblxuICAvKipcbiAgICogaW1tdXRhYmxl55qEQmluZGluZ09iamVjdOWIl+ihqFxuICAgKi9cbiAgcHJpdmF0ZSBpbm5lckxpc3Q6IEJpbmRpbmdPYmplY3RbXTtcblxuICBwcml2YXRlIGVtcHR5Q3VycmVudEl0ZW06IEJpbmRpbmdPYmplY3Q7XG5cbiAgLyoqXG4gICAqIOWFs+iBlOWunuS9k+eahOWxnuaAp+mbhuWQiFxuICAgKi9cbiAgcHVibGljIHByb3BlcnRpZXM6IEJpbmRpbmdQcm9wZXJ0eVtdO1xuXG4gIC8qKlxuICAgKiDkuLvplK7lkI1cbiAgICovXG4gIHB1YmxpYyBwcmltYXJ5S2V5OiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIOeItuWvueixoVxuICAgKi9cbiAgcHVibGljIHBhcmVudDogQmluZGluZ09iamVjdDtcblxuICAvKipcbiAgICog5Y+Y5pu05rWBXG4gICAqL1xuICBwdWJsaWMgY2hhbmdlczogU3ViamVjdDxDaGFuZ2U+O1xuXG4gIC8qKlxuICAgKiDlvZPliY3ooYzlr7nlupTnmoTnu5Hlrprlr7nosaHnmoTlhoXnoIFcbiAgICovXG4gIHB1YmxpYyBjdXJyZW50SWQ6IHN0cmluZztcblxuICAvLyNyZWdpb24g5YiG6aG155u45YWzXG5cbiAgLyoqXG4gICAqIOWIhumhteS/oeaBr1xuICAgKi9cbiAgcHVibGljIF9wYWdpbmF0aW9uSW5mbzogYW55ID0gbnVsbDtcblxuICBzZXQgcGFnaW5hdGlvbkluZm8oc1BhZ2luYXRpb25JbmZvOiBhbnkpIHtcbiAgICB0aGlzLl9wYWdpbmF0aW9uSW5mbyA9IHNQYWdpbmF0aW9uSW5mbztcbiAgICBpZiAodGhpcy5fcGFnaW5hdGlvbkluZm8gPT09IHNQYWdpbmF0aW9uSW5mbykge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB0aGlzLmNoYW5nZXMubmV4dCh7XG4gICAgICB0eXBlOiBDaGFuZ2VUeXBlLlBhZ2luYXRpb25JbmZvQ2hhbmdlLFxuICAgICAgcGF0aDogW10sXG4gICAgICB2YWx1ZTogdGhpcy5fcGFnaW5hdGlvbkluZm9cbiAgICB9KTtcbiAgfVxuXG4gIGdldCBwYWdpbmF0aW9uSW5mbygpOiBhbnkge1xuICAgIHJldHVybiB0aGlzLl9wYWdpbmF0aW9uSW5mbztcbiAgfVxuICAvKipcbiAgICog6I635Y+W6aG156CBXG4gICAqL1xuICBnZXQgcGFnZUluZGV4KCkge1xuICAgIGlmICghIXRoaXMucGFnaW5hdGlvbkluZm8gJiYgdGhpcy5wYWdpbmF0aW9uSW5mby5oYXNPd25Qcm9wZXJ0eShcInBhZ2VJbmRleFwiKSkge1xuICAgICAgcmV0dXJuIHRoaXMucGFnaW5hdGlvbkluZm8ucGFnZUluZGV4O1xuICAgIH1cbiAgICByZXR1cm4gMTtcbiAgfVxuICAvKipcbiAgICog6I635Y+W5YiG6aG15aSn5bCPXG4gICAqL1xuICBnZXQgcGFnZVNpemUoKSB7XG4gICAgaWYgKCEhdGhpcy5wYWdpbmF0aW9uSW5mbyAmJiB0aGlzLnBhZ2luYXRpb25JbmZvLmhhc093blByb3BlcnR5KFwicGFnZVNpemVcIikpIHtcbiAgICAgIHJldHVybiB0aGlzLnBhZ2luYXRpb25JbmZvLnBhZ2VTaXplO1xuICAgIH1cbiAgICByZXR1cm4gMDtcbiAgfVxuXG4gIC8qKlxuICAgKiDojrflj5bmlbDmja7mgLvpobnmlbBcbiAgICovXG4gIGdldCB0b3RhbCgpIHtcbiAgICBpZiAoISF0aGlzLnBhZ2luYXRpb25JbmZvKSB7XG4gICAgICByZXR1cm4gdGhpcy5wYWdpbmF0aW9uSW5mby50b3RhbCB8fCB0aGlzLnBhZ2luYXRpb25JbmZvLnRvdGFsQ291bnQ7XG4gICAgfVxuICAgIHJldHVybiAwO1xuICB9XG4gIC8qKlxuICAgKiDojrflj5bot7Pov4fnmoTmlbDmja7mnaHmlbBcbiAgICovXG4gIGdldCBza2lwKCkge1xuICAgIGNvbnN0IHBhZ2VJbmRleCA9IHRoaXMucGFnZUluZGV4O1xuICAgIGNvbnN0IHBhZ2VTaXplID0gdGhpcy5wYWdlU2l6ZTtcbiAgICByZXR1cm4gKHBhZ2VJbmRleCAtIDEpICogcGFnZVNpemU7XG4gIH1cblxuICAvKipcbiAgICog5YmN5Y+w6K6+572u5YiG6aG15L+h5oGvXG4gICAqIEBwYXJhbSBza2lwIHNraXBcbiAgICogQHBhcmFtIHRha2UgdGFrZVxuICAgKi9cbiAgcHVibGljIHNldFBhZ2luYXRpb25JbmZvKHNraXA6IG51bWJlciwgdGFrZTogbnVtYmVyKSB7XG4gICAgdGhpcy5wYWdpbmF0aW9uSW5mbyA9IE9iamVjdC5hc3NpZ24oe30sIHRoaXMucGFnaW5hdGlvbkluZm8sIHtcbiAgICAgIHBhZ2VTaXplOiB0YWtlLFxuICAgICAgcGFnZUluZGV4OiBza2lwIC8gdGFrZSArIDFcbiAgICB9KTtcbiAgICAvKnRoaXMuY2hhbmdlcy5uZXh0KHtcbiAgICAgIHR5cGU6IENoYW5nZVR5cGUuUGFnaW5hdGlvbkluZm9DaGFuZ2UsXG4gICAgICBwYXRoOiBbXSxcbiAgICAgIHZhbHVlOiB0aGlzLnBhZ2luYXRpb25JbmZvXG4gICAgfSk7Ki9cbiAgfVxuICAvLyNlbmRyZWdpb25cblxuXG5cbiAgLyoqXG4gICAqIOW9k+WJjeihjOWvueW6lOeahOe7keWumuWvueixoVxuICAgKiDlpoLmnpxjdXJyZW50SWTkuLpudWxs77yM5YiZ5Yib5bu65LiA5Liq56m657uT5p6E77yM6Ziy5q2i57uR5a6a5oql6ZSZ77ybXG4gICAqL1xuICBwdWJsaWMgZ2V0IGN1cnJlbnRJdGVtKCk6IEJpbmRpbmdPYmplY3Qge1xuICAgIGNvbnN0IGN1cnJlbnRJdGVtID0gdGhpcy5maW5kQnlJZCh0aGlzLmN1cnJlbnRJZCk7XG4gICAgaWYgKCFjdXJyZW50SXRlbSkge1xuICAgICAgaWYgKCF0aGlzLmVtcHR5Q3VycmVudEl0ZW0pIHtcbiAgICAgICAgdGhpcy5lbXB0eUN1cnJlbnRJdGVtID0gQmluZGluZ09iamVjdEZhY3RvcnkuY3JlYXRlKHRoaXMucHJvcGVydGllcyk7XG4gICAgICB9XG4gICAgICByZXR1cm4gdGhpcy5lbXB0eUN1cnJlbnRJdGVtO1xuICAgIH1cbiAgICByZXR1cm4gY3VycmVudEl0ZW07XG4gIH1cblxuICAvKipcbiAgICog57uR5a6a5a+56LGh55qE5pWw6YePXG4gICAqL1xuICBwdWJsaWMgZ2V0IGxlbmd0aCgpOiBudW1iZXIge1xuICAgIHJldHVybiB0aGlzLmlubmVyTGlzdC5sZW5ndGg7XG4gIH1cblxuICAvKipcbiAgICog5p6E6YCg5Ye95pWwXG4gICAqL1xuICBjb25zdHJ1Y3Rvcihwcm9wZXJ0aWVzOiBCaW5kaW5nUHJvcGVydHlbXSkge1xuICAgIHRoaXMucHJvcGVydGllcyA9IHByb3BlcnRpZXM7XG4gICAgdGhpcy5wcmltYXJ5S2V5ID0gUHJvcGVydHlVdGlsLmdldFByaW1hcnlLZXkocHJvcGVydGllcyk7XG5cbiAgICB0aGlzLmNoYW5nZXMgPSBuZXcgU3ViamVjdDxDaGFuZ2U+KCk7XG4gICAgdGhpcy5pbm5lckxpc3QgPSBbXTtcbiAgICB0aGlzLmN1cnJlbnRJZCA9IG51bGw7XG4gIH1cblxuICAvKipcbiAgICog5re75YqgW1N5bWJvbC5pdGVyYXRvcl3vvIzkvb/kuYvog73pgJrov4dmb3Igb2bpgY3ljoZcbiAgICovXG4gIFtTeW1ib2wuaXRlcmF0b3JdKCkge1xuICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xuICAgIGxldCBpbmRleCA9IC0xO1xuICAgIGNvbnN0IHNpemUgPSB0aGlzLmlubmVyTGlzdC5sZW5ndGg7XG5cbiAgICByZXR1cm4ge1xuICAgICAgbmV4dDogZnVuY3Rpb24gKCkge1xuICAgICAgICBpbmRleCsrO1xuICAgICAgICBpZiAoaW5kZXggPCBzaXplKSB7XG4gICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGRvbmU6IGZhbHNlLFxuICAgICAgICAgICAgdmFsdWU6IHNlbGYuaW5uZXJMaXN0W2luZGV4XVxuICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHsgZG9uZTogdHJ1ZSwgdmFsdWU6IHVuZGVmaW5lZCB9O1xuICAgICAgfVxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICog5om56YeP5Yqg6L2957uR5a6a5a+56LGh77yM5Yqg6L295LmL5YmN5YWI5riF56m657uR5a6a5YiX6KGo77yM5bm26YeN572u5b2T5YmN6KGM77yM5Yqg6L295LmL5ZCO5bCG56ys5LiA6KGM6K6+572u5Li66buY6K6k5b2T5YmN6KGM44CCXG4gICAqIEBwYXJhbSBvYmplY3RzIOimgeWKoOi9vee7keWumuWvueixoeaVsOe7hFxuICAgKi9cbiAgcHVibGljIGxvYWQob2JqZWN0czogQmluZGluZ09iamVjdFtdLCBlbnRpdHlDcmVhdGU6IGJvb2xlYW4gPSBmYWxzZSk6IHZvaWQge1xuXG4gICAgLy8g6YeN572u5YiX6KGoXG4gICAgdGhpcy5pbm5lckxpc3QgPSBbXTtcblxuICAgIGlmIChvYmplY3RzLmxlbmd0aCAhPT0gMCkge1xuICAgICAgLy8g5Yqg6L295pWw5o2uXG4gICAgICBvYmplY3RzLmZvckVhY2goKG9iamVjdDogQmluZGluZ09iamVjdCkgPT4ge1xuICAgICAgICB0aGlzLmFkZChvYmplY3QpO1xuICAgICAgfSk7XG5cbiAgICAgIC8vIOiuvue9rum7mOiupOW9k+WJjeihjFxuICAgICAgY29uc3QgY3VycmVudEl0ZW0gPSB0aGlzLmZpbmRCeUlkKHRoaXMuY3VycmVudElkKTtcbiAgICAgIGlmICghY3VycmVudEl0ZW0pIHtcbiAgICAgICAgY29uc3QgZmlyc3RJZCA9IG9iamVjdHNbMF1bdGhpcy5wcmltYXJ5S2V5XTtcbiAgICAgICAgdGhpcy5zZXRDdXJyZW50SWQoZmlyc3RJZCwgZmFsc2UsIGZhbHNlKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5jdXJyZW50SWQgPSBudWxsO1xuICAgIH1cblxuICAgIGNvbnN0IGNoYW5nZTogQ2hhbmdlID0ge1xuICAgICAgdHlwZTogQ2hhbmdlVHlwZS5Mb2FkLFxuICAgICAgcGF0aDogW10sXG4gICAgICB2YWx1ZTogb2JqZWN0c1xuICAgIH07XG4gICAgY2hhbmdlLmNyZWF0ZSA9IGVudGl0eUNyZWF0ZTtcblxuICAgIC8vIOinpuWPkeS6i+S7tlxuICAgIHRoaXMuY2hhbmdlcy5uZXh0KGNoYW5nZSk7XG4gIH1cblxuICAvKipcbiAgICog5om56YeP6L+95Yqg57uR5a6a5a+56LGh77yM6L+95Yqg5LmL5ZCO5bCG5pyA5ZCO5LiA5Liq6L+95Yqg55qE57uR5a6a5a+56LGh6K6+572u5Li65b2T5YmN6KGM44CCXG4gICAqIEBwYXJhbSBvYmplY3RzIOimgeWKoOi9vee7keWumuWvueixoeaVsOe7hFxuICAgKi9cbiAgcHVibGljIGFwcGVuZChvYmplY3RzOiBCaW5kaW5nT2JqZWN0W10sIGlzQ2xvbmVkOiBib29sZWFuID0gZmFsc2UpOiB2b2lkIHtcblxuICAgIGlmIChvYmplY3RzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIOWKoOi9vUJpbmRpbmdPYmplY3RcbiAgICBvYmplY3RzLmZvckVhY2goKG9iamVjdDogQmluZGluZ09iamVjdCkgPT4ge1xuICAgICAgdGhpcy5hZGQob2JqZWN0KTtcbiAgICB9KTtcblxuICAgIC8vIOW9k+WJjeihjOS4uuaWsOi/veWKoOeahOacgOWQjjHooYxcbiAgICBjb25zdCBsYXN0SWQgPSBvYmplY3RzW29iamVjdHMubGVuZ3RoIC0gMV1bdGhpcy5wcmltYXJ5S2V5XTtcbiAgICB0aGlzLnNldEN1cnJlbnRJZChsYXN0SWQsIHRydWUsIHRydWUpO1xuXG4gICAgLy8g6Kem5Y+R5LqL5Lu2XG4gICAgY29uc3QgY2hhbmdlOiBDaGFuZ2UgPSB7XG4gICAgICB0eXBlOiBDaGFuZ2VUeXBlLkFwcGVuZCxcbiAgICAgIHBhdGg6IFtdLFxuICAgICAgdmFsdWU6IG9iamVjdHNcbiAgICB9O1xuICAgIGlmIChpc0Nsb25lZCkge1xuICAgICAgY2hhbmdlLmlzQ2xvbmVkID0gdHJ1ZTtcbiAgICB9XG4gICAgdGhpcy5jaGFuZ2VzLm5leHQoY2hhbmdlKTtcbiAgfVxuICAvKipcbiAgICog5aKe5Yqg5pWw5o2uXG4gICAqIEBwYXJhbSBvYmplY3RzIOWunuS9k1xuICAgKiBAZGVzY3JpcHRpb24g5aKe5Yqg5a6e5L2T5pWw5o2u77yM5L2G5LiN5YiH5o2i5b2T5YmN6KGMXG4gICAqL1xuICBwdWJsaWMgYWRkRGF0YShvYmplY3RzOiBCaW5kaW5nT2JqZWN0W10pOiB2b2lkIHtcbiAgICBpZiAob2JqZWN0cy5sZW5ndGggPT09IDApIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgLy8g5Yqg6L29QmluZGluZ09iamVjdFxuICAgIG9iamVjdHMuZm9yRWFjaCgob2JqZWN0OiBCaW5kaW5nT2JqZWN0KSA9PiB7XG4gICAgICB0aGlzLmFkZChvYmplY3QpO1xuICAgIH0pO1xuICAgIC8vIOinpuWPkeS6i+S7tlxuICAgIHRoaXMuY2hhbmdlcy5uZXh0KHtcbiAgICAgIHR5cGU6IENoYW5nZVR5cGUuQXBwZW5kLFxuICAgICAgcGF0aDogW10sXG4gICAgICB2YWx1ZTogb2JqZWN0c1xuICAgIH0pO1xuICB9XG4gIHB1YmxpYyBpbnNlcnQob2JqZWN0OiBCaW5kaW5nT2JqZWN0LCBwb3NpdGlvbj86IDEgfCAtMSkge1xuICAgIC8vIGNvbnN0IGN1cnJlbnRJbmRleCA9IHRoaXMuaW5uZXJMaXN0LmZpbmRJbmRleCgob2JqOiBCaW5kaW5nT2JqZWN0KSA9PiBvYmoucHJpbWFyeUtleVZhbHVlID09PSB0aGlzLmN1cnJlbnRJZCk7XG4gICAgLy8gLy8g5Yqg6L29QmluZGluZ09iamVjdFxuICAgIC8vIGlmIChwb3NpdGlvbiA9PT0gMSkge1xuICAgIC8vICAgdGhpcy5pbm5lckxpc3QgPSB0aGlzLmlubmVyTGlzdC5pbnNlcnQoY3VycmVudEluZGV4ICsgMSwgb2JqZWN0KTtcbiAgICAvLyB9IGVsc2UgaWYgKHBvc2l0aW9uID09PSAtMSkge1xuICAgIC8vICAgdGhpcy5pbm5lckxpc3QgPSB0aGlzLmlubmVyTGlzdC5pbnNlcnQoY3VycmVudEluZGV4LCBvYmplY3QpO1xuICAgIC8vIH0gZWxzZSB7XG4gICAgLy8gICB0aGlzLmlubmVyTGlzdCA9IHRoaXMuaW5uZXJMaXN0LnB1c2gob2JqZWN0KTtcbiAgICAvLyB9XG4gICAgLy8gb2JqZWN0LnBhcmVudCA9IHRoaXM7XG4gICAgLy8gLy8g55uR5ZCsb2JqZWN05Y+Y5pu077yM5bm257un57ut5ZCR5LiK5oqb77yM55Sx5LqObGlzdOacieW9k+WJjeihjOeahOamguW/te+8jOS4jemcgOimgeWcqHBhdGjkuK3ov73liqDot6/lvoRcbiAgICAvLyBvYmplY3QuY2hhbmdlcy5zdWJzY3JpYmUoKGNoYW5nZTogQ2hhbmdlKSA9PiB7XG4gICAgLy8gICB0aGlzLmNoYW5nZXMubmV4dChjaGFuZ2UpO1xuICAgIC8vIH0pO1xuXG4gICAgLy8gdGhpcy5zZXRDdXJyZW50SWQob2JqZWN0LnByaW1hcnlLZXlWYWx1ZSwgdHJ1ZSwgdHJ1ZSk7XG5cbiAgICAvLyAvLyDop6blj5Hkuovku7ZcbiAgICAvLyB0aGlzLmNoYW5nZXMubmV4dCh7XG4gICAgLy8gICB0eXBlOiBDaGFuZ2VUeXBlLkFwcGVuZCxcbiAgICAvLyAgIHBhdGg6IFtdLFxuICAgIC8vICAgdmFsdWU6IG9iamVjdFxuICAgIC8vIH0pO1xuICB9XG4gIC8qKlxuICAgKiDmt7vliqDnu5Hlrprlr7nosaHvvIzlubblu7rnq4vnu5Hlrprlr7nosaHlkoznu5HlrprliJfooajkuYvpl7TnmoTlhbPogZTjgIJcbiAgICogQHBhcmFtIG9iamVjdCDnu5Hlrprlr7nosaFcbiAgICovXG4gIHB1YmxpYyBhZGQob2JqZWN0OiBCaW5kaW5nT2JqZWN0KSB7XG4gICAgdGhpcy5pbm5lckxpc3QucHVzaChvYmplY3QpO1xuICAgIG9iamVjdC5wYXJlbnQgPSB0aGlzO1xuXG4gICAgLy8g55uR5ZCsb2JqZWN05Y+Y5pu077yM5bm257un57ut5ZCR5LiK5oqb77yM55Sx5LqObGlzdOacieW9k+WJjeihjOeahOamguW/te+8jOS4jemcgOimgeWcqHBhdGjkuK3ov73liqDot6/lvoRcbiAgICBvYmplY3QuY2hhbmdlcy5zdWJzY3JpYmUoKGNoYW5nZTogQ2hhbmdlKSA9PiB7XG4gICAgICB0aGlzLmNoYW5nZXMubmV4dChjaGFuZ2UpO1xuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIOWIoOmZpOS4u+mUruWAvOaVsOe7hOWvueW6lOeahOe7keWumuWvueixoeOAglxuICAgKiBAcGFyYW0gaWRzIOS4u+mUruWAvOaVsOe7hFxuICAgKi9cbiAgcHVibGljIHJlbW92ZUJ5SWRzKGlkczogQXJyYXk8c3RyaW5nPik6IHZvaWQge1xuICAgIGlmICghaWRzIHx8IGlkcy5sZW5ndGggPT09IDApIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBsZXQgbmV4dEN1cnJlbnRJZCA9IHRoaXMuY3VycmVudElkO1xuICAgIGlkcy5mb3JFYWNoKChpZDogc3RyaW5nKSA9PiB7XG5cbiAgICAgIC8vIOWmguaenOW9k+WJjeihjOiiq+WIoOmZpO+8jOiuoeeul+S4i+S4gOW9k+WJjeihjFxuICAgICAgaWYgKGlkID09PSBuZXh0Q3VycmVudElkKSB7XG4gICAgICAgIG5leHRDdXJyZW50SWQgPSB0aGlzLmdldEN1cnJlbnRJZEJlZm9yZURlbGV0aW5nKCk7XG4gICAgICB9XG5cbiAgICAgIC8vIOWIoOmZpOWvueixoe+8jOaJvuS4jeWIsOaXtui3s+i/h1xuICAgICAgY29uc3QgaW5kZXggPSB0aGlzLmdldEluZGV4QnlJZChpZCk7XG4gICAgICBpZiAoaW5kZXggPT09IC0xKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIEFycmF5VXRpbC5yZW1vdmVCeUluZGV4KHRoaXMuaW5uZXJMaXN0LCBpbmRleCk7XG4gICAgfSk7XG5cbiAgICAvLyDph43mlrDorr7nva7lvZPliY3ooYxcbiAgICBpZiAodGhpcy5pbm5lckxpc3QubGVuZ3RoID09PSAwKSB7XG4gICAgICB0aGlzLmN1cnJlbnRJZCA9IG51bGw7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuc2V0Q3VycmVudElkKG5leHRDdXJyZW50SWQsIGZhbHNlLCBmYWxzZSk7XG4gICAgfVxuXG4gICAgLy8g5Ye65Y+R6KGM5Yig6Zmk5LqL5Lu2XG4gICAgdGhpcy5jaGFuZ2VzLm5leHQoe1xuICAgICAgdHlwZTogQ2hhbmdlVHlwZS5SZW1vdmUsXG4gICAgICBwYXRoOiBbXSxcbiAgICAgIHZhbHVlOiBpZHNcbiAgICB9KTtcbiAgfVxuICAvKipcbiAgICog5Yig6Zmk5pWw5o2u77yI5LiN5YiH5o2i5b2T5YmN6KGM77yJXG4gICAqIEBwYXJhbSBpZHMgaWRzXG4gICAqL1xuICBwdWJsaWMgcmVtb3ZlRGF0YUJ5SWRzKGlkczogQXJyYXk8c3RyaW5nPik6IHZvaWQge1xuICAgIC8vIGlmICghaWRzIHx8IGlkcy5sZW5ndGggPT09IDApIHtcbiAgICAvLyAgIHJldHVybjtcbiAgICAvLyB9XG5cbiAgICAvLyBpZHMuZm9yRWFjaCgoaWQ6IHN0cmluZykgPT4ge1xuICAgIC8vICAgLy8g5Yig6Zmk5a+56LGh77yM5om+5LiN5Yiw5pe26Lez6L+HXG4gICAgLy8gICBjb25zdCBpbmRleCA9IHRoaXMuZ2V0SW5kZXhCeUlkKGlkKTtcbiAgICAvLyAgIGlmIChpbmRleCA9PT0gLTEpIHtcbiAgICAvLyAgICAgcmV0dXJuO1xuICAgIC8vICAgfVxuICAgIC8vICAgdGhpcy5pbm5lckxpc3QgPSB0aGlzLmlubmVyTGlzdC5kZWxldGUoaW5kZXgpO1xuICAgIC8vIH0pO1xuXG4gICAgLy8gLy8g5Ye65Y+R6KGM5Yig6Zmk5LqL5Lu2XG4gICAgLy8gdGhpcy5jaGFuZ2VzLm5leHQoe1xuICAgIC8vICAgdHlwZTogQ2hhbmdlVHlwZS5SZW1vdmUsXG4gICAgLy8gICBwYXRoOiBbXSxcbiAgICAvLyAgIHZhbHVlOiBpZHNcbiAgICAvLyB9KTtcbiAgfVxuICAvKipcbiAgICog5riF56m6XG4gICAqL1xuICBwdWJsaWMgY2xlYXIoKSB7XG4gICAgdGhpcy5pbm5lckxpc3QgPSBbXTtcbiAgICB0aGlzLmN1cnJlbnRJZCA9IG51bGw7XG4gICAgdGhpcy5jaGFuZ2VzLm5leHQoe1xuICAgICAgdHlwZTogQ2hhbmdlVHlwZS5SZW1vdmUsXG4gICAgICBwYXRoOiBbXSxcbiAgICAgIHZhbHVlOiBbXVxuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIOWmguaenOW9k+WJjeihjOiiq+WIoOmZpO+8jOWIoOmZpOS5i+WJjemHjeaWsOiuoeeul+W9k+WJjeihjOeahOS9jee9ru+8jOW5tui/lOWbnuS4i+S4gOW9k+WJjeihjOeahOS4u+mUruWAvOOAglxuICAgKiAtIOWmguaenOiiq+WIoOmZpOeahOihjOaYr+acgOWQjjHooYzvvIzliJnkuIrnp7sx6KGM77ybXG4gICAqIC0g5YW25LuW5oOF5Ya177yM5LiL56e7MeihjOOAglxuICAgKi9cbiAgcHVibGljIGdldEN1cnJlbnRJZEJlZm9yZURlbGV0aW5nKCk6IHN0cmluZyB7XG4gICAgbGV0IG5leHRJbmRleCA9IC0xO1xuICAgIGNvbnN0IGN1cnJlbnRJbmRleCA9IHRoaXMuZ2V0SW5kZXhCeUlkKHRoaXMuY3VycmVudElkKTtcbiAgICBpZiAoY3VycmVudEluZGV4ID09PSB0aGlzLmxlbmd0aCAtIDEpIHtcbiAgICAgIG5leHRJbmRleCA9IGN1cnJlbnRJbmRleCAtIDE7XG4gICAgfSBlbHNlIHtcbiAgICAgIG5leHRJbmRleCA9IGN1cnJlbnRJbmRleCArIDE7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLmdldElkQnlJbmRleChuZXh0SW5kZXgpO1xuICB9XG5cbiAgLyoqXG4gICAqIOagueaNruS4u+mUruWAvOiOt+WPluWvueW6lOe7keWumuWvueixoVxuICAgKiBAcGFyYW0gICBpZCDopoHmn6Xmib7nmoTkuLvplK7lgLxcbiAgICogQHJldHVybnMg5om+5Yiw5pe26L+U5Zue5a+55bqUQmluZGluZ09iamVjdO+8jCDmib7kuI3liLDml7bov5Tlm55udWxsXG4gICAqL1xuICBwdWJsaWMgZmluZEJ5SWQoaWQ6IHN0cmluZyk6IEJpbmRpbmdPYmplY3QgfCBudWxsIHtcbiAgICBsZXQgdGFyZ2V0OiBCaW5kaW5nT2JqZWN0O1xuICAgIHRhcmdldCA9IHRoaXMuaW5uZXJMaXN0LmZpbmQoKGl0ZW0pID0+IHtcbiAgICAgIHJldHVybiBpdGVtLmdldFZhbHVlKHRoaXMucHJpbWFyeUtleSkgPT09IGlkO1xuICAgIH0pO1xuICAgIHJldHVybiB0YXJnZXQgPT09IHVuZGVmaW5lZCA/IG51bGwgOiB0YXJnZXQ7XG4gIH1cblxuICAvKipcbiAgICog5bCG5Li76ZSu5YC85Li6aWTnmoTnu5Hlrprlr7nosaHorr7nva7kuLrlvZPliY3ooYxcbiAgICogQHBhcmFtICBpZCAgICAgICAg6KaB6K6+572u55qE5Li76ZSu5YC8XG4gICAqIEBwYXJhbSAgZW1pdEV2ZW50IOaYr+WQpuWPkemAgeW9k+WJjeihjOWPmOabtOS6i+S7tlxuICAgKi9cbiAgcHVibGljIHNldEN1cnJlbnRJZChpZDogc3RyaW5nLCBlbWl0RXZlbnQ6IGJvb2xlYW4gPSB0cnVlLCBlbWl0R2xvYmFsRXZlbnQ6IGJvb2xlYW4gPSB0cnVlKTogdm9pZCB7XG4gICAgaWYgKHRoaXMuY3VycmVudElkID09PSBpZCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIOS4jeWtmOWcqOaXtuiuvue9ruS4um51bGxcbiAgICAvLyBjb25zdCBjdXJyZW50T2JqID0gdGhpcy5maW5kQnlJZChpZCk7XG4gICAgLy8gaWYgKCFjdXJyZW50T2JqKSB7XG4gICAgLy8gICB0aGlzLmN1cnJlbnRJZCA9IG51bGw7XG4gICAgLy8gfSBlbHNlIHtcbiAgICAvLyAgIHRoaXMuY3VycmVudElkID0gaWQ7XG4gICAgLy8gfVxuXG4gICAgLy8gQHRvZG/vvJrmib7kuI3liLDml7bmjInnkIblupTor6Xorr7nva7kuLpudWxs77yM55uu5YmN5piv55u05o6l6L+U5Zue77yM5qGG5p626YOo5YiG5Yqf6IO95L6d6LWW6K+l54m55oCn44CCXG4gICAgY29uc3QgY3VycmVudE9iaiA9IHRoaXMuZmluZEJ5SWQoaWQpO1xuICAgIGlmICghY3VycmVudE9iaikge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB0aGlzLmN1cnJlbnRJZCA9IGlkO1xuXG4gICAgLy8g5Y+R5Ye66KGM5YiH5o2i5LqL5Lu2XG4gICAgaWYgKGVtaXRFdmVudCA9PT0gdHJ1ZSkge1xuICAgICAgdGhpcy5jaGFuZ2VzLm5leHQoe1xuICAgICAgICB0eXBlOiBDaGFuZ2VUeXBlLlNlbGVjdGlvbkNoYW5nZWQsXG4gICAgICAgIHBhdGg6IFtdLFxuICAgICAgICB2YWx1ZTogdGhpcy5jdXJyZW50SXRlbVxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8g5piv5ZCm5Y+R6YCB5YWo5bGA55qE6KGM5YiH5o2i5LqL5Lu2XG4gICAgaWYgKGVtaXRHbG9iYWxFdmVudCA9PT0gdHJ1ZSkge1xuICAgICAgdGhpcy5jaGFuZ2VzLm5leHQoe1xuICAgICAgICB0eXBlOiBDaGFuZ2VUeXBlLkdsb2JhbFNlbGVjdGlvbkNoYW5nZWQsXG4gICAgICAgIHBhdGg6IFtdLFxuICAgICAgICB2YWx1ZTogdGhpcy5jdXJyZW50SXRlbVxuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIOagueaNruS4u+mUruWAvOS4umlk55qE57uR5a6a5a+56LGh55qE57Si5byVXG4gICAqIEBwYXJhbSBpZCDkuLvplK7lgLxcbiAgICogQHJldHVybnMg5om+5Yiw5pe26L+U5Zue5a+55bqU55qEaW5kZXjvvIzmib7kuI3liLDml7bov5Tlm54tMVxuICAgKi9cbiAgcHVibGljIGdldEluZGV4QnlJZChpZDogc3RyaW5nKTogbnVtYmVyIHtcbiAgICByZXR1cm4gdGhpcy5pbm5lckxpc3QuZmluZEluZGV4KChvYmo6IEJpbmRpbmdPYmplY3QpID0+IHtcbiAgICAgIHJldHVybiBvYmpbdGhpcy5wcmltYXJ5S2V5XSA9PT0gaWQ7XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICog5qC55o2u57Si5byV5L2N572u6I635Y+W5a+55bqU57uR5a6a5a+56LGh55qE5Li76ZSu5YC8XG4gICAqIEByZXV0cm4g5om+5Yiw5pe26L+U5Zue5a+55bqU5Li76ZSu5YC877yM5om+5LiN5Yiw6L+U5ZuebnVsbFxuICAgKi9cbiAgcHVibGljIGdldElkQnlJbmRleChpbmRleDogbnVtYmVyKTogc3RyaW5nIHtcblxuICAgIGlmIChpbmRleCA8IDAgfHwgaW5kZXggPiB0aGlzLmxlbmd0aCkge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgY29uc3Qgb2JqID0gdGhpcy5pbm5lckxpc3RbaW5kZXhdO1xuICAgIGlmICghb2JqKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICByZXR1cm4gb2JqW3RoaXMucHJpbWFyeUtleV07XG4gIH1cblxuICAvKipcbiAgICog6L2s5o2i5Li6QmluZGluZ09iamVjdOaVsOe7hFxuICAgKi9cbiAgcHVibGljIHRvQXJyYXkoKTogQmluZGluZ09iamVjdFtdIHtcbiAgICByZXR1cm4gdGhpcy5pbm5lckxpc3QuY29uY2F0KFtdKTtcbiAgfVxuICAvKipcbiAgICog5Lqk5LqS5pWw5o2u5L2N572uXG4gICAqIEBwYXJhbSBpZDEgaWQxXG4gICAqIEBwYXJhbSBpZDIgaWQyXG4gICAqL1xuICBwdWJsaWMgc3dhcEJ5SWQoaWQxOiBhbnksIGlkMjogYW55KSB7XG4gICAgLy8gY29uc3QgaXRlbTEgPSB0aGlzLmlubmVyTGlzdC5maW5kKGVsZW1lbnQgPT4gZWxlbWVudC5wcmltYXJ5S2V5VmFsdWUgPT09IGlkMSk7XG4gICAgLy8gY29uc3QgaXRlbTIgPSB0aGlzLmlubmVyTGlzdC5maW5kKGVsZW1lbnQgPT4gZWxlbWVudC5wcmltYXJ5S2V5VmFsdWUgPT09IGlkMik7XG4gICAgLy8gdGhpcy5pbm5lckxpc3QgPSB0aGlzLmlubmVyTGlzdC5tYXAoKGJpbmRpbmdPYmplY3Q6IEJpbmRpbmdPYmplY3QsIGluZGV4OiBudW1iZXIpID0+IHtcbiAgICAvLyAgIGlmIChiaW5kaW5nT2JqZWN0LnByaW1hcnlLZXlWYWx1ZSA9PT0gaWQxKSB7XG4gICAgLy8gICAgIHJldHVybiBpdGVtMjtcbiAgICAvLyAgIH0gZWxzZSBpZiAoYmluZGluZ09iamVjdC5wcmltYXJ5S2V5VmFsdWUgPT09IGlkMikge1xuICAgIC8vICAgICByZXR1cm4gaXRlbTE7XG4gICAgLy8gICB9IGVsc2UgcmV0dXJuIGJpbmRpbmdPYmplY3Q7XG4gICAgLy8gfSkudG9MaXN0KCk7XG4gICAgLy8gdGhpcy5jaGFuZ2VzLm5leHQoe1xuICAgIC8vICAgdHlwZTogQ2hhbmdlVHlwZS5Td2FwLFxuICAgIC8vICAgcGF0aDogW11cbiAgICAvLyB9KTtcbiAgfVxuICAvKipcbiAgICog6L2s5o2i5Li6SlNPTuWvueixoVxuICAgKiBAcmV0dXJucyDmma7pgJrlr7nosaHmlbDnu4RcbiAgICovXG4gIHB1YmxpYyB0b0pTT04ob3B0aW9ucz86IGFueSk6IGFueVtdIHtcbiAgICBjb25zdCByZXN1bHQgPSBbXTtcbiAgICB0aGlzLmlubmVyTGlzdC5mb3JFYWNoKChvYmo6IEJpbmRpbmdPYmplY3QpID0+IHtcbiAgICAgIHJlc3VsdC5wdXNoKG9iai50b0pTT04ob3B0aW9ucykpO1xuICAgIH0pO1xuICAgIHJldHVybiByZXN1bHQ7XG4gIH1cblxuICAvKipcbiAgICog6I635Y+W5YiG6aG15L+h5oGvXG4gICAqIEBwYXJhbSBwYXRoIOi3r+W+hFxuICAgKiBAcGFyYW0gZGVmYXVsdFZhbHVlIOm7mOiupOWAvFxuICAgKi9cbiAgcHVibGljIGdldFBhZ2luYXRpb25Db25maWdCeVBhdGgocGF0aDogc3RyaW5nLCBkZWZhdWx0VmFsdWU/OiBhbnkpIHtcbiAgICBpZiAoIXBhdGggfHwgcGF0aCA9PT0gJy8nKSB7XG4gICAgICByZXR1cm4gdGhpcy5wYWdpbmF0aW9uSW5mbztcbiAgICB9XG4gICAgaWYgKHR5cGVvZiBwYXRoICE9PSAnc3RyaW5nJykge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCfot6/lvoTlv4XpobvkuLrlrZfnrKbkuLLvvIEnKTtcbiAgICB9XG4gICAgcGF0aCA9IHBhdGguc3Vic3RyaW5nKDEpO1xuICAgIGNvbnN0IHBhdGhzID0gcGF0aC5zcGxpdCgnLycpLmZpbHRlcihpdGVtID0+ICEhaXRlbSAmJiBpdGVtLnRyaW0oKS5sZW5ndGggPiAwKS5tYXAoaXRlbSA9PiBpdGVtLnRyaW0oKSk7XG4gICAgbGV0IGNvbmZpZyA9IHRoaXMucGFnaW5hdGlvbkluZm87XG4gICAgcGF0aHMuZm9yRWFjaChpdGVtID0+IHtcbiAgICAgIGlmIChjb25maWcgJiYgY29uZmlnLmhhc093blByb3BlcnR5KGl0ZW0pKSB7XG4gICAgICAgIGNvbmZpZyA9IGNvbmZpZ1tpdGVtXTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbmZpZyA9IG51bGw7XG4gICAgICB9XG4gICAgfSk7XG4gICAgcmV0dXJuICEhY29uZmlnID8gY29uZmlnIDogdHlwZW9mIGRlZmF1bHRWYWx1ZSAhPT0gJ3VuZGVmaW5lZCcgPyBkZWZhdWx0VmFsdWUgOiB1bmRlZmluZWQ7XG4gIH1cblxuICAvKipcbiAgICog5a+5YmluZGluZ0xpc3TlsLHooYzmjpLluo9cbiAgICogQHBhcmFtIHN0cmluZyDmjpLluo/lrZfmrrVcbiAgICogQHBhcmFtIGRpcmVjdGlvbnMg5o6S5bqP6KeE5YiZ5a2X5q61XG4gICAqIEBwYXJhbSBvcHRpb25zIOWPguaVsFxuICAgKi9cbiAgcHVibGljIHNvcnRCeShmaWVsZHM6IHN0cmluZyB8IEFycmF5PHN0cmluZz4sIGRpcmVjdGlvbnM6IHN0cmluZyB8IEFycmF5PHN0cmluZz4sIG9wdGlvbnM/OiB7IFtwcm9wOiBzdHJpbmddOiBhbnkgfSkge1xuICAgIGlmICghZmllbGRzIHx8IGZpZWxkcy5sZW5ndGggPCAxIHx8ICFkaXJlY3Rpb25zIHx8IGRpcmVjdGlvbnMubGVuZ3RoIDwgMSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdzb3J0Qnk6YXJndW1lbnQgZXJyb3InKTtcbiAgICB9XG4gICAgLy8g6buY6K6k5Y2H5bqPXG4gICAgY29uc3QgYXJyRmllbGRzOiBBcnJheTxzdHJpbmc+ID0gdHlwZW9mIGZpZWxkcyA9PT0gJ3N0cmluZycgPyBmaWVsZHMuc3BsaXQoJywnKSA6IGZpZWxkcyB8fCBbXTtcbiAgICBjb25zdCBhcnJEaXJlY3Rpb25zOiBBcnJheTxzdHJpbmc+ID0gdHlwZW9mIGRpcmVjdGlvbnMgPT09ICdzdHJpbmcnID8gZGlyZWN0aW9ucy5zcGxpdCgnLCcpIDogZGlyZWN0aW9ucyB8fCBbXTtcbiAgICAvLyDmjpLluo/lrZfmrrXlkozmjpLluo/mlrnlvI/lupTkuIDoh7RcbiAgICBpZiAoYXJyRmllbGRzLmxlbmd0aCAhPT0gYXJyRGlyZWN0aW9ucy5sZW5ndGggfHwgYXJyRmllbGRzLmxlbmd0aCA8IDEpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignc29ydEJ5OmZpZWxkcyBhbmQgZGlyZWN0aW9ucyBub3QgbWF0Y2gnKTtcbiAgICB9XG4gICAgLy8gbmFnZSxhZ2UsdG90YWxcbiAgICBjb25zdCBjb21wYXJhdG9yID0gKHByb3BzOiBBcnJheTxzdHJpbmc+LCBvcmRlcnM6IEFycmF5PHN0cmluZz4pID0+IChpdGVtMTogQmluZGluZ09iamVjdCwgaXRlbTI6IEJpbmRpbmdPYmplY3QpID0+IHtcbiAgICAgIGZvciAoY29uc3QgcHJvcCBvZiBwcm9wcykge1xuICAgICAgICBjb25zdCBvcmRlciA9IFsnYXNjJ10uaW5jbHVkZXMob3JkZXJzW3Byb3BzLmluZGV4T2YocHJvcCldKSA/IDEgOiAtMTtcbiAgICAgICAgaWYgKGl0ZW0xLmdldFZhbHVlKHByb3ApID4gaXRlbTIuZ2V0VmFsdWUocHJvcCkpIHsgcmV0dXJuIG9yZGVyICogMTsgfVxuICAgICAgICBpZiAoaXRlbTEuZ2V0VmFsdWUocHJvcCkgPCBpdGVtMi5nZXRWYWx1ZShwcm9wKSkgeyByZXR1cm4gb3JkZXIgKiAtMTsgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIDA7XG4gICAgfTtcbiAgICB0aGlzLmlubmVyTGlzdCA9IHRoaXMuaW5uZXJMaXN0LnNvcnQoY29tcGFyYXRvcihhcnJGaWVsZHMsIGFyckRpcmVjdGlvbnMpKTtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0VmFsdWUodGFyZ2V0OiBhbnksIHByb3BOYW1lOiBzdHJpbmcsIGlzTXVsdGlMYW5nUHJvcDogYm9vbGVhbiA9IGZhbHNlLCBjdXJyZW50TGFuZ3VhZ2U6IHN0cmluZyA9ICd6aC1DSFMnKSB7XG4gICAgaWYgKHRhcmdldCBpbnN0YW5jZW9mIEJpbmRpbmdMaXN0KSB7XG4gICAgICB0YXJnZXQgPSB0YXJnZXQuY3VycmVudEl0ZW07XG4gICAgfSBlbHNlIGlmICh0YXJnZXQgaW5zdGFuY2VvZiBCaW5kaW5nRGF0YSkge1xuICAgICAgdGFyZ2V0ID0gdGFyZ2V0Lmxpc3QuY3VycmVudEl0ZW07XG4gICAgfVxuICAgIGxldCByZXN1bHQgPSBudWxsO1xuICAgIGlmIChwcm9wTmFtZS5pbmRleE9mKCcuJykgPT09IC0xKSB7XG4gICAgICByZXN1bHQgPSB0YXJnZXRbcHJvcE5hbWVdO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zdCBwcm9wcyA9IHByb3BOYW1lLnNwbGl0KCcuJyk7XG4gICAgICBmb3IgKGNvbnN0IHByb3Agb2YgcHJvcHMpIHtcbiAgICAgICAgdGFyZ2V0ID0gcmVzdWx0ID0gdGhpcy5nZXRWYWx1ZSh0YXJnZXQsIHByb3AsIGlzTXVsdGlMYW5nUHJvcCwgY3VycmVudExhbmd1YWdlKTtcbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKGlzTXVsdGlMYW5nUHJvcCAmJiByZXN1bHQgJiYgcmVzdWx0Lmhhc093blByb3BlcnR5KGN1cnJlbnRMYW5ndWFnZSkpIHtcbiAgICAgIHJldHVybiByZXN1bHRbY3VycmVudExhbmd1YWdlXTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9XG4gIH1cbn1cblxuZXhwb3J0IHsgQmluZGluZ0xpc3QgfTtcbiJdfQ==
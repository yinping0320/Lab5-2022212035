import { ANNOTATIONS, PROP_METADATA } from './decorator';
/**
 * 元数据解析
 * 约束：
 * 1、类型装饰器：在某个类型上，某种类型的装饰器，只使用一次，不重复添加；
 * 2、属性装饰器：在某个属性上，某种类型的装饰器，只使用一次，不重复添加
 */
var MetadataUtil = /** @class */ (function () {
    function MetadataUtil() {
    }
    // ----------------------------------------
    // 类型元数据
    // ----------------------------------------
    /**
     * 获取类元数据
     * 返回结果形如：
     * [
     *   Injectable
     *   NgViewModel
     *   NgViewModel
     * ]
     */
    MetadataUtil.getClassMetadatas = function (constructor) {
        var metadatas = constructor[ANNOTATIONS];
        return metadatas;
    };
    /**
     * 获取某个class上的某种装饰器
     * 返回结果：NgViewModel
     */
    MetadataUtil.getClassMetadataByName = function (constructor, metadataName) {
        var metadata = this.getClassMetadataByNameWithTranslate(constructor, metadataName, null, null);
        return metadata;
    };
    MetadataUtil.getClassMetadataByNameWithTranslate = function (constructor, metadataName, translateService, keysToTranslate) {
        var allClassMetadatas = this.getClassMetadatas(constructor);
        if (!allClassMetadatas) {
            return null;
        }
        var metadata = allClassMetadatas.find(function (classMetadata) {
            return classMetadata.ngMetadataName === metadataName;
        });
        if (metadata && translateService && keysToTranslate) {
            keysToTranslate.forEach(function (metadataPropKey) {
                var propertyVariable = metadata[metadataPropKey];
                if (propertyVariable && propertyVariable.startsWith('{{') && propertyVariable.endsWith('}}')) {
                    var translateKey = propertyVariable.replace('{{', '').replace('}}', '').trim();
                    metadata[metadataPropKey] = translateService.transform(translateKey, null);
                }
            });
        }
        return metadata;
    };
    // ----------------------------------------
    // 属性元数据
    // ----------------------------------------
    /**
     * 获取所有属性的所有元数据
     * 返回格式：
     * {
     *   propName1: [ NgDefaultValue, NgMaxLength, NgMinLength],
     *   propName2: [ NgDefaultValue, NgMaxLength, NgMinLength]
     * }
     */
    MetadataUtil.getPropsMetadatas = function (constructor) {
        var allPropMetadatas = constructor[PROP_METADATA];
        return allPropMetadatas;
    };
    /**
     * 获取所有属性的某一类型的元数据
     * 如果同一属性
     * 返回结果：
     * {
     *    propName1: NgDefaultValue,
     *    propName2: NgDefaultValue
     * }
     */
    MetadataUtil.getPropsMetadatasByName = function (constructor, metadataName) {
        var metadatas = this.getPropsMetadatasByNameWithTranslate(constructor, metadataName);
        return metadatas;
    };
    MetadataUtil.getPropsMetadatasByNameWithTranslate = function (constructor, metadataName, translateService, keysToTranslate) {
        var metadatas = {};
        // 读取构造函数中存储的类属性注解。
        var allPropMetadatas = this.getPropsMetadatas(constructor);
        if (!allPropMetadatas) {
            return metadatas;
        }
        // 遍历所有属性提取注解信息。
        Object.keys(allPropMetadatas).forEach(function (propName) {
            // 提取当前属性注解对象
            var propMetadatas = allPropMetadatas[propName];
            // 提取指定类型的注解项
            var metadata = propMetadatas.find(function (propMetadata) {
                return propMetadata.ngMetadataName === metadataName;
            });
            if (translateService && keysToTranslate) {
                keysToTranslate.forEach(function (metadataPropKey) {
                    var propertyVariable = metadata[metadataPropKey];
                    if (propertyVariable && propertyVariable.startsWith('{{') && propertyVariable.endsWith('}}')) {
                        var translateKey = propertyVariable.replace('{{', '').replace('}}', '').trim();
                        metadata[metadataPropKey] = translateService.transform(translateKey, null);
                    }
                });
            }
            if (metadata) {
                metadatas[propName] = metadata;
            }
        });
        return metadatas;
    };
    /**
     * 获取某个属性的所有元数据
     * 返回格式：[ NgDefaultValue, NgMaxLength, NgMinLength]
     */
    MetadataUtil.getPropMetadatasByName = function (constructor, propName) {
        // 暂不实现
        return null;
    };
    /**
     * 获取某个属性的某种元数据
     * 返回格式：NgDefaultValue
     */
    MetadataUtil.getPropMetadataByName = function (constructor, propName, metadataName) {
        // 暂不实现
        return null;
    };
    return MetadataUtil;
}());
export { MetadataUtil };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWV0YWRhdGFfdXRpbC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvbW9iaWxlLWRldmtpdC8iLCJzb3VyY2VzIjpbImxpYi9jb3JlL21ldGFkYXRhL21ldGFkYXRhX3V0aWwudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFdBQVcsRUFBRSxhQUFhLEVBQUUsTUFBTSxhQUFhLENBQUM7QUFHekQ7Ozs7O0dBS0c7QUFDSDtJQUFBO0lBMklBLENBQUM7SUF6SUMsMkNBQTJDO0lBQzNDLFFBQVE7SUFDUiwyQ0FBMkM7SUFFM0M7Ozs7Ozs7O09BUUc7SUFDSSw4QkFBaUIsR0FBeEIsVUFBeUIsV0FBZ0I7UUFDdkMsSUFBTSxTQUFTLEdBQUcsV0FBVyxDQUFDLFdBQVcsQ0FBQyxDQUFDO1FBQzNDLE9BQU8sU0FBUyxDQUFDO0lBQ25CLENBQUM7SUFFRDs7O09BR0c7SUFDSSxtQ0FBc0IsR0FBN0IsVUFBOEIsV0FBZ0IsRUFBRSxZQUFvQjtRQUNsRSxJQUFNLFFBQVEsR0FBRyxJQUFJLENBQUMsbUNBQW1DLENBQUMsV0FBVyxFQUFFLFlBQVksRUFBRSxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUM7UUFDakcsT0FBTyxRQUFRLENBQUM7SUFDbEIsQ0FBQztJQUVNLGdEQUFtQyxHQUExQyxVQUNFLFdBQWdCLEVBQUUsWUFBb0IsRUFDdEMsZ0JBQTRCLEVBQUUsZUFBMEI7UUFDeEQsSUFBTSxpQkFBaUIsR0FBRyxJQUFJLENBQUMsaUJBQWlCLENBQUMsV0FBVyxDQUFDLENBQUM7UUFDOUQsSUFBSSxDQUFDLGlCQUFpQixFQUFFO1lBQ3RCLE9BQU8sSUFBSSxDQUFDO1NBQ2I7UUFDRCxJQUFNLFFBQVEsR0FBRyxpQkFBaUIsQ0FBQyxJQUFJLENBQUMsVUFBQyxhQUFrQjtZQUN6RCxPQUFPLGFBQWEsQ0FBQyxjQUFjLEtBQUssWUFBWSxDQUFDO1FBQ3ZELENBQUMsQ0FBQyxDQUFDO1FBQ0gsSUFBSSxRQUFRLElBQUksZ0JBQWdCLElBQUks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TyxTQUFTLENBQUM7SUFDbkIsQ0FBQztJQUVEOzs7T0FHRztJQUNJLG1DQUFzQixHQUE3QixVQUE4QixXQUFnQixFQUFFLFFBQWdCO1FBQzlELE9BQU87UUFDUCxPQUFPLElBQUksQ0FBQztJQUNkLENBQUM7SUFFRDs7O09BR0c7SUFDSSxrQ0FBcUIsR0FBNUIsVUFBNkIsV0FBZ0IsRUFBRSxRQUFnQixFQUFFLFlBQW9CO1FBQ25GLE9BQU87UUFDUCxPQUFPLElBQUksQ0FBQztJQUNkLENBQUM7SUFPSCxtQkFBQztBQUFELENBQUMsQUEzSUQsSUEySUM7QUFFRCxPQUFPLEVBQUUsWUFBWSxFQUFFLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBTk5PVEFUSU9OUywgUFJPUF9NRVRBREFUQSB9IGZyb20gJy4vZGVjb3JhdG9yJztcbmltcG9ydCB7IFRyYW5zbGF0ZSB9IGZyb20gJy4uLy4uL2kxOG4vaW5kZXgnO1xuXG4vKipcbiAqIOWFg+aVsOaNruino+aekFxuICog57qm5p2f77yaXG4gKiAx44CB57G75Z6L6KOF6aWw5Zmo77ya5Zyo5p+Q5Liq57G75Z6L5LiK77yM5p+Q56eN57G75Z6L55qE6KOF6aWw5Zmo77yM5Y+q5L2/55So5LiA5qyh77yM5LiN6YeN5aSN5re75Yqg77ybXG4gKiAy44CB5bGe5oCn6KOF6aWw5Zmo77ya5Zyo5p+Q5Liq5bGe5oCn5LiK77yM5p+Q56eN57G75Z6L55qE6KOF6aWw5Zmo77yM5Y+q5L2/55So5LiA5qyh77yM5LiN6YeN5aSN5re75YqgXG4gKi9cbmNsYXNzIE1ldGFkYXRhVXRpbCB7XG5cbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvLyDnsbvlnovlhYPmlbDmja5cbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXG4gIC8qKlxuICAgKiDojrflj5bnsbvlhYPmlbDmja5cbiAgICog6L+U5Zue57uT5p6c5b2i5aaC77yaXG4gICAqIFtcbiAgICogICBJbmplY3RhYmxlXG4gICAqICAgTmdWaWV3TW9kZWxcbiAgICogICBOZ1ZpZXdNb2RlbFxuICAgKiBdXG4gICAqL1xuICBzdGF0aWMgZ2V0Q2xhc3NNZXRhZGF0YXMoY29uc3RydWN0b3I6IGFueSk6IGFueVtdIHtcbiAgICBjb25zdCBtZXRhZGF0YXMgPSBjb25zdHJ1Y3RvcltBTk5PVEFUSU9OU107XG4gICAgcmV0dXJuIG1ldGFkYXRhcztcbiAgfVxuXG4gIC8qKlxuICAgKiDojrflj5bmn5DkuKpjbGFzc+S4iueahOafkOenjeijhemlsOWZqFxuICAgKiDov5Tlm57nu5PmnpzvvJpOZ1ZpZXdNb2RlbFxuICAgKi9cbiAgc3RhdGljIGdldENsYXNzTWV0YWRhdGFCeU5hbWUoY29uc3RydWN0b3I6IGFueSwgbWV0YWRhdGFOYW1lOiBzdHJpbmcpOiBhbnkge1xuICAgIGNvbnN0IG1ldGFkYXRhID0gdGhpcy5nZXRDbGFzc01ldGFkYXRhQnlOYW1lV2l0aFRyYW5zbGF0ZShjb25zdHJ1Y3RvciwgbWV0YWRhdGFOYW1lLCBudWxsLCBudWxsKTtcbiAgICByZXR1cm4gbWV0YWRhdGE7XG4gIH1cblxuICBzdGF0aWMgZ2V0Q2xhc3NNZXRhZGF0YUJ5TmFtZVdpdGhUcmFuc2xhdGUoXG4gICAgY29uc3RydWN0b3I6IGFueSwgbWV0YWRhdGFOYW1lOiBzdHJpbmcsXG4gICAgdHJhbnNsYXRlU2VydmljZT86IFRyYW5zbGF0ZSwga2V5c1RvVHJhbnNsYXRlPzogc3RyaW5nW10pOiBhbnkge1xuICAgIGNvbnN0IGFsbENsYXNzTWV0YWRhdGFzID0gdGhpcy5nZXRDbGFzc01ldGFkYXRhcyhjb25zdHJ1Y3Rvcik7XG4gICAgaWYgKCFhbGxDbGFzc01ldGFkYXRhcykge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIGNvbnN0IG1ldGFkYXRhID0gYWxsQ2xhc3NNZXRhZGF0YXMuZmluZCgoY2xhc3NNZXRhZGF0YTogYW55KSA9PiB7XG4gICAgICByZXR1cm4gY2xhc3NNZXRhZGF0YS5uZ01ldGFkYXRhTmFtZSA9PT0gbWV0YWRhdGFOYW1lO1xuICAgIH0pO1xuICAgIGlmIChtZXRhZGF0YSAmJiB0cmFuc2xhdGVTZXJ2aWNlICYmIGtleXNUb1RyYW5zbGF0ZSkge1xuICAgICAga2V5c1RvVHJhbnNsYXRlLmZvckVhY2goKG1ldGFkYXRhUHJvcEtleSkgPT4ge1xuICAgICAgICBjb25zdCBwcm9wZXJ0eVZhcmlhYmxlOiBzdHJpbmcgPSBtZXRhZGF0YVttZXRhZGF0YVByb3BLZXldO1xuICAgICAgICBpZiAocHJvcGVydHlWYXJpYWJsZSAmJiBwcm9wZXJ0eVZhcmlhYmxlLnN0YXJ0c1dpdGgoJ3t7JykgJiYgcHJvcGVydHlWYXJpYWJsZS5lbmRzV2l0aCgnfX0nKSkge1xuICAgICAgICAgIGNvbnN0IHRyYW5zbGF0ZUtleSA9IHByb3BlcnR5VmFyaWFibGUucmVwbGFjZSgne3snLCAnJykucmVwbGFjZSgnfX0nLCAnJykudHJpbSgpO1xuICAgICAgICAgIG1ldGFkYXRhW21ldGFkYXRhUHJvcEtleV0gPSB0cmFuc2xhdGVTZXJ2aWNlLnRyYW5zZm9ybSh0cmFuc2xhdGVLZXksIG51bGwpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG4gICAgcmV0dXJuIG1ldGFkYXRhO1xuICB9XG5cbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvLyDlsZ7mgKflhYPmlbDmja5cbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXG4gIC8qKlxuICAgKiDojrflj5bmiYDmnInlsZ7mgKfnmoTmiYDmnInlhYPmlbDmja5cbiAgICog6L+U5Zue5qC85byP77yaXG4gICAqIHtcbiAgICogICBwcm9wTmFtZTE6IFsgTmdEZWZhdWx0VmFsdWUsIE5nTWF4TGVuZ3RoLCBOZ01pbkxlbmd0aF0sXG4gICAqICAgcHJvcE5hbWUyOiBbIE5nRGVmYXVsdFZhbHVlLCBOZ01heExlbmd0aCwgTmdNaW5MZW5ndGhdXG4gICAqIH1cbiAgICovXG4gIHN0YXRpYyBnZXRQcm9wc01ldGFkYXRhcyhjb25zdHJ1Y3RvcjogYW55KTogYW55IHtcbiAgICBjb25zdCBhbGxQcm9wTWV0YWRhdGFzID0gY29uc3RydWN0b3JbUFJPUF9NRVRBREFUQV07XG4gICAgcmV0dXJuIGFsbFByb3BNZXRhZGF0YXM7XG4gIH1cblxuICAvKipcbiAgICog6I635Y+W5omA5pyJ5bGe5oCn55qE5p+Q5LiA57G75Z6L55qE5YWD5pWw5o2uXG4gICAqIOWmguaenOWQjOS4gOWxnuaAp1xuICAgKiDov5Tlm57nu5PmnpzvvJpcbiAgICoge1xuICAgKiAgICBwcm9wTmFtZTE6IE5nRGVmYXVsdFZhbHVlLFxuICAgKiAgICBwcm9wTmFtZTI6IE5nRGVmYXVsdFZhbHVlXG4gICAqIH1cbiAgICovXG4gIHN0YXRpYyBnZXRQcm9wc01ldGFkYXRhc0J5TmFtZShjb25zdHJ1Y3RvcjogYW55LCBtZXRhZGF0YU5hbWU6IHN0cmluZyk6IHsgW3Byb3BOYW1lOiBzdHJpbmddOiBhbnkgfSB7XG4gICAgY29uc3QgbWV0YWRhdGFzID0gdGhpcy5nZXRQcm9wc01ldGFkYXRhc0J5TmFtZVdpdGhUcmFuc2xhdGUoY29uc3RydWN0b3IsIG1ldGFkYXRhTmFtZSk7XG4gICAgcmV0dXJuIG1ldGFkYXRhcztcbiAgfVxuXG4gIHN0YXRpYyBnZXRQcm9wc01ldGFkYXRhc0J5TmFtZVdpdGhUcmFuc2xhdGUoXG4gICAgY29uc3RydWN0b3I6IGFueSwgbWV0YWRhdGFOYW1lOiBzdHJpbmcsXG4gICAgdHJhbnNsYXRlU2VydmljZT86IFRyYW5zbGF0ZSwga2V5c1RvVHJhbnNsYXRlPzogc3RyaW5nW10pOiB7IFtwcm9wTmFtZTogc3RyaW5nXTogYW55IH0ge1xuICAgIGNvbnN0IG1ldGFkYXRhcyA9IHt9O1xuICAgIC8vIOivu+WPluaehOmAoOWHveaVsOS4reWtmOWCqOeahOexu+WxnuaAp+azqOino+OAglxuICAgIGNvbnN0IGFsbFByb3BNZXRhZGF0YXMgPSB0aGlzLmdldFByb3BzTWV0YWRhdGFzKGNvbnN0cnVjdG9yKTtcbiAgICBpZiAoIWFsbFByb3BNZXRhZGF0YXMpIHtcbiAgICAgIHJldHVybiBtZXRhZGF0YXM7XG4gICAgfVxuICAgIC8vIOmBjeWOhuaJgOacieWxnuaAp+aPkOWPluazqOino+S/oeaBr+OAglxuICAgIE9iamVjdC5rZXlzKGFsbFByb3BNZXRhZGF0YXMpLmZvckVhY2goKHByb3BOYW1lOiBzdHJpbmcpID0+IHtcbiAgICAgIC8vIOaPkOWPluW9k+WJjeWxnuaAp+azqOino+WvueixoVxuICAgICAgY29uc3QgcHJvcE1ldGFkYXRhczogYW55W10gPSBhbGxQcm9wTWV0YWRhdGFzW3Byb3BOYW1lXTtcbiAgICAgIC8vIOaPkOWPluaMh+Wumuexu+Wei+eahOazqOino+mhuVxuICAgICAgY29uc3QgbWV0YWRhdGEgPSBwcm9wTWV0YWRhdGFzLmZpbmQoKHByb3BNZXRhZGF0YTogYW55KSA9PiB7XG4gICAgICAgIHJldHVybiBwcm9wTWV0YWRhdGEubmdNZXRhZGF0YU5hbWUgPT09IG1ldGFkYXRhTmFtZTtcbiAgICAgIH0pO1xuICAgICAgaWYgKHRyYW5zbGF0ZVNlcnZpY2UgJiYga2V5c1RvVHJhbnNsYXRlKSB7XG4gICAgICAgIGtleXNUb1RyYW5zbGF0ZS5mb3JFYWNoKChtZXRhZGF0YVByb3BLZXkpID0+IHtcbiAgICAgICAgICBjb25zdCBwcm9wZXJ0eVZhcmlhYmxlOiBzdHJpbmcgPSBtZXRhZGF0YVttZXRhZGF0YVByb3BLZXldO1xuICAgICAgICAgIGlmIChwcm9wZXJ0eVZhcmlhYmxlICYmIHByb3BlcnR5VmFyaWFibGUuc3RhcnRzV2l0aCgne3snKSAmJiBwcm9wZXJ0eVZhcmlhYmxlLmVuZHNXaXRoKCd9fScpKSB7XG4gICAgICAgICAgICBjb25zdCB0cmFuc2xhdGVLZXkgPSBwcm9wZXJ0eVZhcmlhYmxlLnJlcGxhY2UoJ3t7JywgJycpLnJlcGxhY2UoJ319JywgJycpLnRyaW0oKTtcbiAgICAgICAgICAgIG1ldGFkYXRhW21ldGFkYXRhUHJvcEtleV0gPSB0cmFuc2xhdGVTZXJ2aWNlLnRyYW5zZm9ybSh0cmFuc2xhdGVLZXksIG51bGwpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICBpZiAobWV0YWRhdGEpIHtcbiAgICAgICAgbWV0YWRhdGFzW3Byb3BOYW1lXSA9IG1ldGFkYXRhO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgcmV0dXJuIG1ldGFkYXRhcztcbiAgfVxuXG4gIC8qKlxuICAgKiDojrflj5bmn5DkuKrlsZ7mgKfnmoTmiYDmnInlhYPmlbDmja5cbiAgICog6L+U5Zue5qC85byP77yaWyBOZ0RlZmF1bHRWYWx1ZSwgTmdNYXhMZW5ndGgsIE5nTWluTGVuZ3RoXVxuICAgKi9cbiAgc3RhdGljIGdldFByb3BNZXRhZGF0YXNCeU5hbWUoY29uc3RydWN0b3I6IGFueSwgcHJvcE5hbWU6IHN0cmluZyk6IGFueVtdIHtcbiAgICAvLyDmmoLkuI3lrp7njrBcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIC8qKlxuICAgKiDojrflj5bmn5DkuKrlsZ7mgKfnmoTmn5Dnp43lhYPmlbDmja5cbiAgICog6L+U5Zue5qC85byP77yaTmdEZWZhdWx0VmFsdWVcbiAgICovXG4gIHN0YXRpYyBnZXRQcm9wTWV0YWRhdGFCeU5hbWUoY29uc3RydWN0b3I6IGFueSwgcHJvcE5hbWU6IHN0cmluZywgbWV0YWRhdGFOYW1lOiBzdHJpbmcpOiBhbnkge1xuICAgIC8vIOaaguS4jeWunueOsFxuICAgIHJldHVybiBudWxsO1xuICB9XG5cblxuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIC8vIOWPguaVsOWFg+aVsOaNrlxuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cbn1cblxuZXhwb3J0IHsgTWV0YWRhdGFVdGlsIH07XG4iXX0=
import { Subject } from 'rxjs';
import { ArrayUtil } from '../utils/index';
import { ChangeType } from './changes';
import { BindingData } from './binding_data';
import { BindingObjectFactory } from './binding_object_factory';
import { PropertyUtil } from './property_util';
/**
 * BindingList是一个BindingObject集合
 */
class BindingList {
    /**
     * 构造函数
     */
    constructor(properties) {
        //#region 分页相关
        /**
         * 分页信息
         */
        this._paginationInfo = null;
        this.properties = properties;
        this.primaryKey = PropertyUtil.getPrimaryKey(properties);
        this.changes = new Subject();
        this.innerList = [];
        this.currentId = null;
    }
    set paginationInfo(sPaginationInfo) {
        this._paginationInfo = sPaginationInfo;
        if (this._paginationInfo === sPaginationInfo) {
            return;
        }
        this.changes.next({
            type: ChangeType.PaginationInfoChange,
            path: [],
            value: this._paginationInfo
        });
    }
    get paginationInfo() {
        return this._paginationInfo;
    }
    /**
     * 获取页码
     */
    get pageIndex() {
        if (!!this.paginationInfo && this.paginationInfo.hasOwnProperty("pageIndex")) {
            return this.paginationInfo.pageIndex;
        }
        return 1;
    }
    /**
     * 获取分页大小
     */
    get pageSize() {
        if (!!this.paginationInfo && this.paginationInfo.hasOwnProperty("pageSize")) {
            return this.paginationInfo.pageSize;
        }
        return 0;
    }
    /**
     * 获取数据总项数
     */
    get total() {
        if (!!this.paginationInfo) {
            return this.paginationInfo.total || this.paginationInfo.totalCount;
        }
        return 0;
    }
    /**
     * 获取跳过的数据条数
     */
    get skip() {
        const pageIndex = this.pageIndex;
        const pageSize = this.pageSize;
        return (pageIndex - 1) * pageSize;
    }
    /**
     * 前台设置分页信息
     * @param skip skip
     * @param take take
     */
    setPaginationInfo(skip, take) {
        this.paginationInfo = Object.assign({}, this.paginationInfo, {
            pageSize: take,
            pageIndex: skip / take + 1
        });
        /*this.changes.next({
          type: ChangeType.PaginationInfoChange,
          path: [],
          value: this.paginationInfo
        });*/
    }
    //#endregion
    /**
     * 当前行对应的绑定对象
     * 如果currentId为null，则创建一个空结构，防止绑定报错；
     */
    get currentItem() {
        const currentItem = this.findById(this.currentId);
        if (!currentItem) {
            if (!this.emptyCurrentItem) {
                this.emptyCurrentItem = BindingObjectFactory.create(this.properties);
            }
            return this.emptyCurrentItem;
        }
        return currentItem;
    }
    /**
     * 绑定对象的数量
     */
    get length() {
        return this.innerList.length;
    }
    /**
     * 添加[Symbol.iterator]，使之能通过for of遍历
     */
    [Symbol.iterator]() {
        const self = this;
        let index = -1;
        const size = this.innerList.length;
        return {
            next: function () {
                index++;
                if (index < size) {
                    return {
                        done: false,
                        value: self.innerList[index]
                    };
                }
                return { done: true, value: undefined };
            }
        };
    }
    /**
     * 批量加载绑定对象，加载之前先清空绑定列表，并重置当前行，加载之后将第一行设置为默认当前行。
     * @param objects 要加载绑定对象数组
     */
    load(objects, entityCreate = false) {
        // 重置列表
        this.innerList = [];
        if (objects.length !== 0) {
            // 加载数据
            objects.forEach((object) => {
                this.add(object);
            });
            // 设置默认当前行
            const currentItem = this.findById(this.currentId);
            if (!currentItem) {
                const firstId = objects[0][this.primaryKey];
                this.setCurrentId(firstId, false, false);
            }
        }
        else {
            this.currentId = null;
        }
        const change = {
            type: ChangeType.Load,
            path: [],
            value: objects
        };
        change.create = entityCreate;
        // 触发事件
        this.changes.next(change);
    }
    /**
     * 批量追加绑定对象，追加之后将最后一个追加的绑定对象设置为当前行。
     * @param objects 要加载绑定对象数组
     */
    append(objects, isCloned = false) {
        if (objects.length === 0) {
            return;
        }
        // 加载BindingObject
        objects.forEach((object) => {
            this.add(object);
        });
        // 当前行为新追加的最后1行
        const lastId = objects[objects.length - 1][this.primaryKey];
        this.setCurrentId(lastId, true, true);
        // 触发事件
        const change = {
            type: ChangeType.Append,
            path: [],
            value: objects
        };
        if (isCloned) {
            change.isCloned = true;
        }
        this.changes.next(change);
    }
    /**
     * 增加数据
     * @param objects 实体
     * @description 增加实体数据，但不切换当前行
     */
    addData(objects) {
        if (objects.length === 0) {
            return;
        }
        // 加载BindingObject
        objects.forEach((object) => {
            this.add(object);
        });
        // 触发事件
        this.changes.next({
            type: ChangeType.Append,
            path: [],
            value: objects
        });
    }
    insert(object, position) {
        // const currentIndex = this.innerList.findIndex((obj: BindingObject) => obj.primaryKeyValue === this.currentId);
        // // 加载BindingObject
        // if (position === 1) {
        //   this.innerList = this.innerList.insert(currentIndex + 1, object);
        // } else if (position === -1) {
        //   this.innerList = this.innerList.insert(currentIndex, object);
        // } else {
        //   this.innerList = this.innerList.push(object);
        // }
        // object.parent = this;
        // // 监听object变更，并继续向上抛，由于list有当前行的概念，不需要在path中追加路径
        // object.changes.subscribe((change: Change) => {
        //   this.changes.next(change);
        // });
        // this.setCurrentId(object.primaryKeyValue, true, true);
        // // 触发事件
        // this.changes.next({
        //   type: ChangeType.Append,
        //   path: [],
        //   value: object
        // });
    }
    /**
     * 添加绑定对象，并建立绑定对象和绑定列表之间的关联。
     * @param object 绑定对象
     */
    add(object) {
        this.innerList.push(object);
        object.parent = this;
        // 监听object变更，并继续向上抛，由于list有当前行的概念，不需要在path中追加路径
        object.changes.subscribe((change) => {
            this.changes.next(change);
        });
    }
    /**
     * 删除主键值数组对应的绑定对象。
     * @param ids 主键值数组
     */
    removeByIds(ids) {
        if (!ids || ids.length === 0) {
            return;
        }
        let nextCurrentId = this.currentId;
        ids.forEach((id) => {
            // 如果当前行被删除，计算下一当前行
            if (id === nextCurrentId) {
                nextCurrentId = this.getCurrentIdBeforeDeleting();
            }
            // 删除对象，找不到时跳过
            const index = this.getIndexById(id);
            if (index === -1) {
                return;
            }
            ArrayUtil.removeByIndex(this.innerList, index);
        });
        // 重新设置当前行
        if (this.innerList.length === 0) {
            this.currentId = null;
        }
        else {
            this.setCurrentId(nextCurrentId, false, false);
        }
        // 出发行删除事件
        this.changes.next({
            type: ChangeType.Remove,
            path: [],
            value: ids
        });
    }
    /**
     * 删除数据（不切换当前行）
     * @param ids ids
     */
    removeDataByIds(ids) {
        // if (!ids || ids.length === 0) {
        //   return;
        // }
        // ids.forEach((id: string) => {
        //   // 删除对象，找不到时跳过
        //   const index = this.getIndexById(id);
        //   if (index === -1) {
        //     return;
        //   }
        //   this.innerList = this.innerList.delete(index);
        // });
        // // 出发行删除事件
        // this.changes.next({
        //   type: ChangeType.Remove,
        //   path: [],
        //   value: ids
        // });
    }
    /**
     * 清空
     */
    clear() {
        this.innerList = [];
        this.currentId = null;
        this.changes.next({
            type: ChangeType.Remove,
            path: [],
            value: []
        });
    }
    /**
     * 如果当前行被删除，删除之前重新计算当前行的位置，并返回下一当前行的主键值。
     * - 如果被删除的行是最后1行，则上移1行；
     * - 其他情况，下移1行。
     */
    getCurrentIdBeforeDeleting() {
        let nextIndex = -1;
        const currentIndex = this.getIndexById(this.currentId);
        if (currentIndex === this.length - 1) {
            nextIndex = currentIndex - 1;
        }
        else {
            nextIndex = currentIndex + 1;
        }
        return this.getIdByIndex(nextIndex);
    }
    /**
     * 根据主键值获取对应绑定对象
     * @param   id 要查找的主键值
     * @returns 找到时返回对应BindingObject， 找不到时返回null
     */
    findById(id) {
        let target;
        target = this.innerList.find((item) => {
            return item.getValue(this.primaryKey) === id;
        });
        return target === undefined ? null : target;
    }
    /**
     * 将主键值为id的绑定对象设置为当前行
     * @param  id        要设置的主键值
     * @param  emitEvent 是否发送当前行变更事件
     */
    setCurrentId(id, emitEvent = true, emitGlobalEvent = true) {
        if (this.currentId === id) {
            return;
        }
        // 不存在时设置为null
        // const currentObj = this.findById(id);
        // if (!currentObj) {
        //   this.currentId = null;
        // } else {
        //   this.currentId = id;
        // }
        // @todo：找不到时按理应该设置为null，目前是直接返回，框架部分功能依赖该特性。
        const currentObj = this.findById(id);
        if (!currentObj) {
            return;
        }
        this.currentId = id;
        // 发出行切换事件
        if (emitEvent === true) {
            this.changes.next({
                type: ChangeType.SelectionChanged,
                path: [],
                value: this.currentItem
            });
        }
        // 是否发送全局的行切换事件
        if (emitGlobalEvent === true) {
            this.changes.next({
                type: ChangeType.GlobalSelectionChanged,
                path: [],
                value: this.currentItem
            });
        }
    }
    /**
     * 根据主键值为id的绑定对象的索引
     * @param id 主键值
     * @returns 找到时返回对应的index，找不到时返回-1
     */
    getIndexById(id) {
        return this.innerList.findIndex((obj) => {
            return obj[this.primaryKey] === id;
        });
    }
    /**
     * 根据索引位置获取对应绑定对象的主键值
     * @reutrn 找到时返回对应主键值，找不到返回null
     */
    getIdByIndex(index) {
        if (index < 0 || index > this.length) {
            return null;
        }
        const obj = this.innerList[index];
        if (!obj) {
            return null;
        }
        return obj[this.primaryKey];
    }
    /**
     * 转换为BindingObject数组
     */
    toArray() {
        return this.innerList.concat([]);
    }
    /**
     * 交互数据位置
     * @param id1 id1
     * @param id2 id2
     */
    swapById(id1, id2) {
        // const item1 = this.innerList.find(element => element.primaryKeyValue === id1);
        // const item2 = this.innerList.find(element => element.primaryKeyValue === id2);
        // this.innerList = this.innerList.map((bindingObject: BindingObject, index: number) => {
        //   if (bindingObject.primaryKeyValue === id1) {
        //     return item2;
        //   } else if (bindingObject.primaryKeyValue === id2) {
        //     return item1;
        //   } else return bindingObject;
        // }).toList();
        // this.changes.next({
        //   type: ChangeType.Swap,
        //   path: []
        // });
    }
    /**
     * 转换为JSON对象
     * @returns 普通对象数组
     */
    toJSON(options) {
        const result = [];
        this.innerList.forEach((obj) => {
            result.push(obj.toJSON(options));
        });
        return result;
    }
    /**
     * 获取分页信息
     * @param path 路径
     * @param defaultValue 默认值
     */
    getPaginationConfigByPath(path, defaultValue) {
        if (!path || path === '/') {
            return this.paginationInfo;
        }
        if (typeof path !== 'string') {
            throw new Error('路径必须为字符串！');
        }
        path = path.substring(1);
        const paths = path.split('/').filter(item => !!item && item.trim().length > 0).map(item => item.trim());
        let config = this.paginationInfo;
        paths.forEach(item => {
            if (config && config.hasOwnProperty(item)) {
                config = config[item];
            }
            else {
                config = null;
            }
        });
        return !!config ? config : typeof defaultValue !== 'undefined' ? defaultValue : undefined;
    }
    /**
     * 对bindingList就行排序
     * @param string 排序字段
     * @param directions 排序规则字段
     * @param options 参数
     */
    sortBy(fields, directions, options) {
        if (!fields || fields.length < 1 || !directions || directions.length < 1) {
            throw new Error('sortBy:argument error');
        }
        // 默认升序
        const arrFields = typeof fields === 'string' ? fields.split(',') : fields || [];
        const arrDirections = typeof directions === 'string' ? directions.split(',') : directions || [];
        // 排序字段和排序方式应一致
        if (arrFields.length !== arrDirections.length || arrFields.length < 1) {
            throw new Error('sortBy:fields and directions not match');
        }
        // nage,age,total
        const comparator = (props, orders) => (item1, item2) => {
            for (const prop of props) {
                const order = ['asc'].includes(orders[props.indexOf(prop)]) ? 1 : -1;
                if (item1.getValue(prop) > item2.getValue(prop)) {
                    return order * 1;
                }
                if (item1.getValue(prop) < item2.getValue(prop)) {
                    return order * -1;
                }
            }
            return 0;
        };
        this.innerList = this.innerList.sort(comparator(arrFields, arrDirections));
    }
    getValue(target, propName, isMultiLangProp = false, currentLanguage = 'zh-CHS') {
        if (target instanceof BindingList) {
            target = target.currentItem;
        }
        else if (target instanceof BindingData) {
            target = target.list.currentItem;
        }
        let result = null;
        if (propName.indexOf('.') === -1) {
            result = target[propName];
        }
        else {
            const props = propName.split('.');
            for (const prop of props) {
                target = result = this.getValue(target, prop, isMultiLangProp, currentLanguage);
            }
        }
        if (isMultiLangProp && result && result.hasOwnProperty(currentLanguage)) {
            return result[currentLanguage];
        }
        else {
            return result;
        }
    }
}
export { BindingList };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmluZGluZ19saXN0LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy9tb2JpbGUtZGV2a2l0LyIsInNvdXJjZXMiOlsibGliL2JpbmRpbmctZGF0YS9iaW5kaW5nX2xpc3QudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLE9BQU8sRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUUvQixPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDM0MsT0FBTyxFQUFVLFVBQVUsRUFBRSxNQUFNLFdBQVcsQ0FBQztBQUMvQyxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFHN0MsT0FBTyxFQUFFLG9CQUFvQixFQUFFLE1BQU0sMEJBQTBCLENBQUM7QUFDaEUsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBRS9DOztHQUVHO0FBQ0gsTUFBTSxXQUFXO0lBdUlmOztPQUVHO0lBQ0gsWUFBWSxVQUE2QjtRQXhHekMsY0FBYztRQUVkOztXQUVHO1FBQ0ksb0JBQWUsR0FBUSxJQUFJLENBQUM7UUFvR2pDLElBQUksQ0FBQyxVQUFVLEdBQUcsVUFBVSxDQUFDO1FBQzdCLElBQUksQ0FBQyxVQUFVLEdBQUcsWUFBWSxDQUFDLGFBQWEsQ0FBQyxVQUFVLENBQUMsQ0FBQztRQUV6RCxJQUFJLENBQUMsT0FBTyxHQUFHLElBQUksT0FBTyxFQUFVLENBQUM7UUFDckMsSUFBSSxDQUFDLFNBQVMsR0FBRyxFQUFFLENBQUM7UUFDcEIsSUFBSSxDQUFDLFNBQVMsR0FBRyxJQUFJLENBQUM7SUFDeEIsQ0FBQztJQXhHRCxJQUFJLGNBQWMsQ0FBQyxlQUFvQjtRQUNyQyxJQUFJLENBQUMsZUFBZSxHQUFHLGVBQWUsQ0FBQztRQUN2QyxJQUFJLElBQUksQ0FBQyxlQUFlLEtBQUssZUFBZSxFQUFFO1lBQzVDLE9BQU87U0FDUjtRQUNELElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDO1lBQ2hCLElB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QUksQ0FBQyxVQUFVLENBQUMsU0FBUyxFQUFFLGFBQWEsQ0FBQyxDQUFDLENBQUM7SUFDN0UsQ0FBQztJQUVPLFFBQVEsQ0FBQyxNQUFXLEVBQUUsUUFBZ0IsRUFBRSxrQkFBMkIsS0FBSyxFQUFFLGtCQUEwQixRQUFRO1FBQ2xILElBQUksTUFBTSxZQUFZLFdBQVcsRUFBRTtZQUNqQyxNQUFNLEdBQUcsTUFBTSxDQUFDLFdBQVcsQ0FBQztTQUM3QjthQUFNLElBQUksTUFBTSxZQUFZLFdBQVcsRUFBRTtZQUN4QyxNQUFNLEdBQUcsTUFBTSxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUM7U0FDbEM7UUFDRCxJQUFJLE1BQU0sR0FBRyxJQUFJLENBQUM7UUFDbEIsSUFBSSxRQUFRLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFO1lBQ2hDLE1BQU0sR0FBRyxNQUFNLENBQUMsUUFBUSxDQUFDLENBQUM7U0FDM0I7YUFBTTtZQUNMLE1BQU0sS0FBSyxHQUFHLFFBQVEsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUM7WUFDbEMsS0FBSyxNQUFNLElBQUksSUFBSSxLQUFLLEVBQUU7Z0JBQ3hCLE1BQU0sR0FBRyxNQUFNLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxNQUFNLEVBQUUsSUFBSSxFQUFFLGVBQWUsRUFBRSxlQUFlLENBQUMsQ0FBQzthQUNqRjtTQUNGO1FBQ0QsSUFBSSxlQUFlLElBQUksTUFBTSxJQUFJLE1BQU0sQ0FBQyxjQUFjLENBQUMsZUFBZSxDQUFDLEVBQUU7WUFDdkUsT0FBTyxNQUFNLENBQUMsZUFBZSxDQUFDLENBQUM7U0FDaEM7YUFBTTtZQUNMLE9BQU8sTUFBTSxDQUFDO1NBQ2Y7SUFDSCxDQUFDO0NBQ0Y7QUFFRCxPQUFPLEVBQUUsV0FBVyxFQUFFLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBTdWJqZWN0IH0gZnJvbSAncnhqcyc7XG5cbmltcG9ydCB7IEFycmF5VXRpbCB9IGZyb20gJy4uL3V0aWxzL2luZGV4JztcbmltcG9ydCB7IENoYW5nZSwgQ2hhbmdlVHlwZSB9IGZyb20gJy4vY2hhbmdlcyc7XG5pbXBvcnQgeyBCaW5kaW5nRGF0YSB9IGZyb20gJy4vYmluZGluZ19kYXRhJztcbmltcG9ydCB7IEJpbmRpbmdPYmplY3QgfSBmcm9tICcuL2JpbmRpbmdfb2JqZWN0JztcbmltcG9ydCB7IEJpbmRpbmdQcm9wZXJ0eSB9IGZyb20gJy4vYmluZGluZ19wcm9wZXJ0eSc7XG5pbXBvcnQgeyBCaW5kaW5nT2JqZWN0RmFjdG9yeSB9IGZyb20gJy4vYmluZGluZ19vYmplY3RfZmFjdG9yeSc7XG5pbXBvcnQgeyBQcm9wZXJ0eVV0aWwgfSBmcm9tICcuL3Byb3BlcnR5X3V0aWwnO1xuXG4vKipcbiAqIEJpbmRpbmdMaXN05piv5LiA5LiqQmluZGluZ09iamVjdOmbhuWQiFxuICovXG5jbGFzcyBCaW5kaW5nTGlzdCB7XG5cbiAgLyoqXG4gICAqIGltbXV0YWJsZeeahEJpbmRpbmdPYmplY3TliJfooahcbiAgICovXG4gIHByaXZhdGUgaW5uZXJMaXN0OiBCaW5kaW5nT2JqZWN0W107XG5cbiAgcHJpdmF0ZSBlbXB0eUN1cnJlbnRJdGVtOiBCaW5kaW5nT2JqZWN0O1xuXG4gIC8qKlxuICAgKiDlhbPogZTlrp7kvZPnmoTlsZ7mgKfpm4blkIhcbiAgICovXG4gIHB1YmxpYyBwcm9wZXJ0aWVzOiBCaW5kaW5nUHJvcGVydHlbXTtcblxuICAvKipcbiAgICog5Li76ZSu5ZCNXG4gICAqL1xuICBwdWJsaWMgcHJpbWFyeUtleTogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiDniLblr7nosaFcbiAgICovXG4gIHB1YmxpYyBwYXJlbnQ6IEJpbmRpbmdPYmplY3Q7XG5cbiAgLyoqXG4gICAqIOWPmOabtOa1gVxuICAgKi9cbiAgcHVibGljIGNoYW5nZXM6IFN1YmplY3Q8Q2hhbmdlPjtcblxuICAvKipcbiAgICog5b2T5YmN6KGM5a+55bqU55qE57uR5a6a5a+56LGh55qE5YaF56CBXG4gICAqL1xuICBwdWJsaWMgY3VycmVudElkOiBzdHJpbmc7XG5cbiAgLy8jcmVnaW9uIOWIhumhteebuOWFs1xuXG4gIC8qKlxuICAgKiDliIbpobXkv6Hmga9cbiAgICovXG4gIHB1YmxpYyBfcGFnaW5hdGlvbkluZm86IGFueSA9IG51bGw7XG5cbiAgc2V0IHBhZ2luYXRpb25JbmZvKHNQYWdpbmF0aW9uSW5mbzogYW55KSB7XG4gICAgdGhpcy5fcGFnaW5hdGlvbkluZm8gPSBzUGFnaW5hdGlvbkluZm87XG4gICAgaWYgKHRoaXMuX3BhZ2luYXRpb25JbmZvID09PSBzUGFnaW5hdGlvbkluZm8pIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdGhpcy5jaGFuZ2VzLm5leHQoe1xuICAgICAgdHlwZTogQ2hhbmdlVHlwZS5QYWdpbmF0aW9uSW5mb0NoYW5nZSxcbiAgICAgIHBhdGg6IFtdLFxuICAgICAgdmFsdWU6IHRoaXMuX3BhZ2luYXRpb25JbmZvXG4gICAgfSk7XG4gIH1cblxuICBnZXQgcGFnaW5hdGlvbkluZm8oKTogYW55IHtcbiAgICByZXR1cm4gdGhpcy5fcGFnaW5hdGlvbkluZm87XG4gIH1cbiAgLyoqXG4gICAqIOiOt+WPlumhteeggVxuICAgKi9cbiAgZ2V0IHBhZ2VJbmRleCgpIHtcbiAgICBpZiAoISF0aGlzLnBhZ2luYXRpb25JbmZvICYmIHRoaXMucGFnaW5hdGlvbkluZm8uaGFzT3duUHJvcGVydHkoXCJwYWdlSW5kZXhcIikpIHtcbiAgICAgIHJldHVybiB0aGlzLnBhZ2luYXRpb25JbmZvLnBhZ2VJbmRleDtcbiAgICB9XG4gICAgcmV0dXJuIDE7XG4gIH1cbiAgLyoqXG4gICAqIOiOt+WPluWIhumhteWkp+Wwj1xuICAgKi9cbiAgZ2V0IHBhZ2VTaXplKCkge1xuICAgIGlmICghIXRoaXMucGFnaW5hdGlvbkluZm8gJiYgdGhpcy5wYWdpbmF0aW9uSW5mby5oYXNPd25Qcm9wZXJ0eShcInBhZ2VTaXplXCIpKSB7XG4gICAgICByZXR1cm4gdGhpcy5wYWdpbmF0aW9uSW5mby5wYWdlU2l6ZTtcbiAgICB9XG4gICAgcmV0dXJuIDA7XG4gIH1cblxuICAvKipcbiAgICog6I635Y+W5pWw5o2u5oC76aG55pWwXG4gICAqL1xuICBnZXQgdG90YWwoKSB7XG4gICAgaWYgKCEhdGhpcy5wYWdpbmF0aW9uSW5mbykge1xuICAgICAgcmV0dXJuIHRoaXMucGFnaW5hdGlvbkluZm8udG90YWwgfHwgdGhpcy5wYWdpbmF0aW9uSW5mby50b3RhbENvdW50O1xuICAgIH1cbiAgICByZXR1cm4gMDtcbiAgfVxuICAvKipcbiAgICog6I635Y+W6Lez6L+H55qE5pWw5o2u5p2h5pWwXG4gICAqL1xuICBnZXQgc2tpcCgpIHtcbiAgICBjb25zdCBwYWdlSW5kZXggPSB0aGlzLnBhZ2VJbmRleDtcbiAgICBjb25zdCBwYWdlU2l6ZSA9IHRoaXMucGFnZVNpemU7XG4gICAgcmV0dXJuIChwYWdlSW5kZXggLSAxKSAqIHBhZ2VTaXplO1xuICB9XG5cbiAgLyoqXG4gICAqIOWJjeWPsOiuvue9ruWIhumhteS/oeaBr1xuICAgKiBAcGFyYW0gc2tpcCBza2lwXG4gICAqIEBwYXJhbSB0YWtlIHRha2VcbiAgICovXG4gIHB1YmxpYyBzZXRQYWdpbmF0aW9uSW5mbyhza2lwOiBudW1iZXIsIHRha2U6IG51bWJlcikge1xuICAgIHRoaXMucGFnaW5hdGlvbkluZm8gPSBPYmplY3QuYXNzaWduKHt9LCB0aGlzLnBhZ2luYXRpb25JbmZvLCB7XG4gICAgICBwYWdlU2l6ZTogdGFrZSxcbiAgICAgIHBhZ2VJbmRleDogc2tpcCAvIHRha2UgKyAxXG4gICAgfSk7XG4gICAgLyp0aGlzLmNoYW5nZXMubmV4dCh7XG4gICAgICB0eXBlOiBDaGFuZ2VUeXBlLlBhZ2luYXRpb25JbmZvQ2hhbmdlLFxuICAgICAgcGF0aDogW10sXG4gICAgICB2YWx1ZTogdGhpcy5wYWdpbmF0aW9uSW5mb1xuICAgIH0pOyovXG4gIH1cbiAgLy8jZW5kcmVnaW9uXG5cblxuXG4gIC8qKlxuICAgKiDlvZPliY3ooYzlr7nlupTnmoTnu5Hlrprlr7nosaFcbiAgICog5aaC5p6cY3VycmVudElk5Li6bnVsbO+8jOWImeWIm+W7uuS4gOS4quepuue7k+aehO+8jOmYsuatoue7keWumuaKpemUme+8m1xuICAgKi9cbiAgcHVibGljIGdldCBjdXJyZW50SXRlbSgpOiBCaW5kaW5nT2JqZWN0IHtcbiAgICBjb25zdCBjdXJyZW50SXRlbSA9IHRoaXMuZmluZEJ5SWQodGhpcy5jdXJyZW50SWQpO1xuICAgIGlmICghY3VycmVudEl0ZW0pIHtcbiAgICAgIGlmICghdGhpcy5lbXB0eUN1cnJlbnRJdGVtKSB7XG4gICAgICAgIHRoaXMuZW1wdHlDdXJyZW50SXRlbSA9IEJpbmRpbmdPYmplY3RGYWN0b3J5LmNyZWF0ZSh0aGlzLnByb3BlcnRpZXMpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHRoaXMuZW1wdHlDdXJyZW50SXRlbTtcbiAgICB9XG4gICAgcmV0dXJuIGN1cnJlbnRJdGVtO1xuICB9XG5cbiAgLyoqXG4gICAqIOe7keWumuWvueixoeeahOaVsOmHj1xuICAgKi9cbiAgcHVibGljIGdldCBsZW5ndGgoKTogbnVtYmVyIHtcbiAgICByZXR1cm4gdGhpcy5pbm5lckxpc3QubGVuZ3RoO1xuICB9XG5cbiAgLyoqXG4gICAqIOaehOmAoOWHveaVsFxuICAgKi9cbiAgY29uc3RydWN0b3IocHJvcGVydGllczogQmluZGluZ1Byb3BlcnR5W10pIHtcbiAgICB0aGlzLnByb3BlcnRpZXMgPSBwcm9wZXJ0aWVzO1xuICAgIHRoaXMucHJpbWFyeUtleSA9IFByb3BlcnR5VXRpbC5nZXRQcmltYXJ5S2V5KHByb3BlcnRpZXMpO1xuXG4gICAgdGhpcy5jaGFuZ2VzID0gbmV3IFN1YmplY3Q8Q2hhbmdlPigpO1xuICAgIHRoaXMuaW5uZXJMaXN0ID0gW107XG4gICAgdGhpcy5jdXJyZW50SWQgPSBudWxsO1xuICB9XG5cbiAgLyoqXG4gICAqIOa3u+WKoFtTeW1ib2wuaXRlcmF0b3Jd77yM5L2/5LmL6IO96YCa6L+HZm9yIG9m6YGN5Y6GXG4gICAqL1xuICBbU3ltYm9sLml0ZXJhdG9yXSgpIHtcbiAgICBjb25zdCBzZWxmID0gdGhpcztcbiAgICBsZXQgaW5kZXggPSAtMTtcbiAgICBjb25zdCBzaXplID0gdGhpcy5pbm5lckxpc3QubGVuZ3RoO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIG5leHQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaW5kZXgrKztcbiAgICAgICAgaWYgKGluZGV4IDwgc2l6ZSkge1xuICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBkb25lOiBmYWxzZSxcbiAgICAgICAgICAgIHZhbHVlOiBzZWxmLmlubmVyTGlzdFtpbmRleF1cbiAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB7IGRvbmU6IHRydWUsIHZhbHVlOiB1bmRlZmluZWQgfTtcbiAgICAgIH1cbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIOaJuemHj+WKoOi9vee7keWumuWvueixoe+8jOWKoOi9veS5i+WJjeWFiOa4heepuue7keWumuWIl+ihqO+8jOW5tumHjee9ruW9k+WJjeihjO+8jOWKoOi9veS5i+WQjuWwhuesrOS4gOihjOiuvue9ruS4uum7mOiupOW9k+WJjeihjOOAglxuICAgKiBAcGFyYW0gb2JqZWN0cyDopoHliqDovb3nu5Hlrprlr7nosaHmlbDnu4RcbiAgICovXG4gIHB1YmxpYyBsb2FkKG9iamVjdHM6IEJpbmRpbmdPYmplY3RbXSwgZW50aXR5Q3JlYXRlOiBib29sZWFuID0gZmFsc2UpOiB2b2lkIHtcblxuICAgIC8vIOmHjee9ruWIl+ihqFxuICAgIHRoaXMuaW5uZXJMaXN0ID0gW107XG5cbiAgICBpZiAob2JqZWN0cy5sZW5ndGggIT09IDApIHtcbiAgICAgIC8vIOWKoOi9veaVsOaNrlxuICAgICAgb2JqZWN0cy5mb3JFYWNoKChvYmplY3Q6IEJpbmRpbmdPYmplY3QpID0+IHtcbiAgICAgICAgdGhpcy5hZGQob2JqZWN0KTtcbiAgICAgIH0pO1xuXG4gICAgICAvLyDorr7nva7pu5jorqTlvZPliY3ooYxcbiAgICAgIGNvbnN0IGN1cnJlbnRJdGVtID0gdGhpcy5maW5kQnlJZCh0aGlzLmN1cnJlbnRJZCk7XG4gICAgICBpZiAoIWN1cnJlbnRJdGVtKSB7XG4gICAgICAgIGNvbnN0IGZpcnN0SWQgPSBvYmplY3RzWzBdW3RoaXMucHJpbWFyeUtleV07XG4gICAgICAgIHRoaXMuc2V0Q3VycmVudElkKGZpcnN0SWQsIGZhbHNlLCBmYWxzZSk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuY3VycmVudElkID0gbnVsbDtcbiAgICB9XG5cbiAgICBjb25zdCBjaGFuZ2U6IENoYW5nZSA9IHtcbiAgICAgIHR5cGU6IENoYW5nZVR5cGUuTG9hZCxcbiAgICAgIHBhdGg6IFtdLFxuICAgICAgdmFsdWU6IG9iamVjdHNcbiAgICB9O1xuICAgIGNoYW5nZS5jcmVhdGUgPSBlbnRpdHlDcmVhdGU7XG5cbiAgICAvLyDop6blj5Hkuovku7ZcbiAgICB0aGlzLmNoYW5nZXMubmV4dChjaGFuZ2UpO1xuICB9XG5cbiAgLyoqXG4gICAqIOaJuemHj+i/veWKoOe7keWumuWvueixoe+8jOi/veWKoOS5i+WQjuWwhuacgOWQjuS4gOS4qui/veWKoOeahOe7keWumuWvueixoeiuvue9ruS4uuW9k+WJjeihjOOAglxuICAgKiBAcGFyYW0gb2JqZWN0cyDopoHliqDovb3nu5Hlrprlr7nosaHmlbDnu4RcbiAgICovXG4gIHB1YmxpYyBhcHBlbmQob2JqZWN0czogQmluZGluZ09iamVjdFtdLCBpc0Nsb25lZDogYm9vbGVhbiA9IGZhbHNlKTogdm9pZCB7XG5cbiAgICBpZiAob2JqZWN0cy5sZW5ndGggPT09IDApIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyDliqDovb1CaW5kaW5nT2JqZWN0XG4gICAgb2JqZWN0cy5mb3JFYWNoKChvYmplY3Q6IEJpbmRpbmdPYmplY3QpID0+IHtcbiAgICAgIHRoaXMuYWRkKG9iamVjdCk7XG4gICAgfSk7XG5cbiAgICAvLyDlvZPliY3ooYzkuLrmlrDov73liqDnmoTmnIDlkI4x6KGMXG4gICAgY29uc3QgbGFzdElkID0gb2JqZWN0c1tvYmplY3RzLmxlbmd0aCAtIDFdW3RoaXMucHJpbWFyeUtleV07XG4gICAgdGhpcy5zZXRDdXJyZW50SWQobGFzdElkLCB0cnVlLCB0cnVlKTtcblxuICAgIC8vIOinpuWPkeS6i+S7tlxuICAgIGNvbnN0IGNoYW5nZTogQ2hhbmdlID0ge1xuICAgICAgdHlwZTogQ2hhbmdlVHlwZS5BcHBlbmQsXG4gICAgICBwYXRoOiBbXSxcbiAgICAgIHZhbHVlOiBvYmplY3RzXG4gICAgfTtcbiAgICBpZiAoaXNDbG9uZWQpIHtcbiAgICAgIGNoYW5nZS5pc0Nsb25lZCA9IHRydWU7XG4gICAgfVxuICAgIHRoaXMuY2hhbmdlcy5uZXh0KGNoYW5nZSk7XG4gIH1cbiAgLyoqXG4gICAqIOWinuWKoOaVsOaNrlxuICAgKiBAcGFyYW0gb2JqZWN0cyDlrp7kvZNcbiAgICogQGRlc2NyaXB0aW9uIOWinuWKoOWunuS9k+aVsOaNru+8jOS9huS4jeWIh+aNouW9k+WJjeihjFxuICAgKi9cbiAgcHVibGljIGFkZERhdGEob2JqZWN0czogQmluZGluZ09iamVjdFtdKTogdm9pZCB7XG4gICAgaWYgKG9iamVjdHMubGVuZ3RoID09PSAwKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIC8vIOWKoOi9vUJpbmRpbmdPYmplY3RcbiAgICBvYmplY3RzLmZvckVhY2goKG9iamVjdDogQmluZGluZ09iamVjdCkgPT4ge1xuICAgICAgdGhpcy5hZGQob2JqZWN0KTtcbiAgICB9KTtcbiAgICAvLyDop6blj5Hkuovku7ZcbiAgICB0aGlzLmNoYW5nZXMubmV4dCh7XG4gICAgICB0eXBlOiBDaGFuZ2VUeXBlLkFwcGVuZCxcbiAgICAgIHBhdGg6IFtdLFxuICAgICAgdmFsdWU6IG9iamVjdHNcbiAgICB9KTtcbiAgfVxuICBwdWJsaWMgaW5zZXJ0KG9iamVjdDogQmluZGluZ09iamVjdCwgcG9zaXRpb24/OiAxIHwgLTEpIHtcbiAgICAvLyBjb25zdCBjdXJyZW50SW5kZXggPSB0aGlzLmlubmVyTGlzdC5maW5kSW5kZXgoKG9iajogQmluZGluZ09iamVjdCkgPT4gb2JqLnByaW1hcnlLZXlWYWx1ZSA9PT0gdGhpcy5jdXJyZW50SWQpO1xuICAgIC8vIC8vIOWKoOi9vUJpbmRpbmdPYmplY3RcbiAgICAvLyBpZiAocG9zaXRpb24gPT09IDEpIHtcbiAgICAvLyAgIHRoaXMuaW5uZXJMaXN0ID0gdGhpcy5pbm5lckxpc3QuaW5zZXJ0KGN1cnJlbnRJbmRleCArIDEsIG9iamVjdCk7XG4gICAgLy8gfSBlbHNlIGlmIChwb3NpdGlvbiA9PT0gLTEpIHtcbiAgICAvLyAgIHRoaXMuaW5uZXJMaXN0ID0gdGhpcy5pbm5lckxpc3QuaW5zZXJ0KGN1cnJlbnRJbmRleCwgb2JqZWN0KTtcbiAgICAvLyB9IGVsc2Uge1xuICAgIC8vICAgdGhpcy5pbm5lckxpc3QgPSB0aGlzLmlubmVyTGlzdC5wdXNoKG9iamVjdCk7XG4gICAgLy8gfVxuICAgIC8vIG9iamVjdC5wYXJlbnQgPSB0aGlzO1xuICAgIC8vIC8vIOebkeWQrG9iamVjdOWPmOabtO+8jOW5tue7p+e7reWQkeS4iuaKm++8jOeUseS6jmxpc3TmnInlvZPliY3ooYznmoTmpoLlv7XvvIzkuI3pnIDopoHlnKhwYXRo5Lit6L+95Yqg6Lev5b6EXG4gICAgLy8gb2JqZWN0LmNoYW5nZXMuc3Vic2NyaWJlKChjaGFuZ2U6IENoYW5nZSkgPT4ge1xuICAgIC8vICAgdGhpcy5jaGFuZ2VzLm5leHQoY2hhbmdlKTtcbiAgICAvLyB9KTtcblxuICAgIC8vIHRoaXMuc2V0Q3VycmVudElkKG9iamVjdC5wcmltYXJ5S2V5VmFsdWUsIHRydWUsIHRydWUpO1xuXG4gICAgLy8gLy8g6Kem5Y+R5LqL5Lu2XG4gICAgLy8gdGhpcy5jaGFuZ2VzLm5leHQoe1xuICAgIC8vICAgdHlwZTogQ2hhbmdlVHlwZS5BcHBlbmQsXG4gICAgLy8gICBwYXRoOiBbXSxcbiAgICAvLyAgIHZhbHVlOiBvYmplY3RcbiAgICAvLyB9KTtcbiAgfVxuICAvKipcbiAgICog5re75Yqg57uR5a6a5a+56LGh77yM5bm25bu656uL57uR5a6a5a+56LGh5ZKM57uR5a6a5YiX6KGo5LmL6Ze055qE5YWz6IGU44CCXG4gICAqIEBwYXJhbSBvYmplY3Qg57uR5a6a5a+56LGhXG4gICAqL1xuICBwdWJsaWMgYWRkKG9iamVjdDogQmluZGluZ09iamVjdCkge1xuICAgIHRoaXMuaW5uZXJMaXN0LnB1c2gob2JqZWN0KTtcbiAgICBvYmplY3QucGFyZW50ID0gdGhpcztcblxuICAgIC8vIOebkeWQrG9iamVjdOWPmOabtO+8jOW5tue7p+e7reWQkeS4iuaKm++8jOeUseS6jmxpc3TmnInlvZPliY3ooYznmoTmpoLlv7XvvIzkuI3pnIDopoHlnKhwYXRo5Lit6L+95Yqg6Lev5b6EXG4gICAgb2JqZWN0LmNoYW5nZXMuc3Vic2NyaWJlKChjaGFuZ2U6IENoYW5nZSkgPT4ge1xuICAgICAgdGhpcy5jaGFuZ2VzLm5leHQoY2hhbmdlKTtcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiDliKDpmaTkuLvplK7lgLzmlbDnu4Tlr7nlupTnmoTnu5Hlrprlr7nosaHjgIJcbiAgICogQHBhcmFtIGlkcyDkuLvplK7lgLzmlbDnu4RcbiAgICovXG4gIHB1YmxpYyByZW1vdmVCeUlkcyhpZHM6IEFycmF5PHN0cmluZz4pOiB2b2lkIHtcbiAgICBpZiAoIWlkcyB8fCBpZHMubGVuZ3RoID09PSAwKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgbGV0IG5leHRDdXJyZW50SWQgPSB0aGlzLmN1cnJlbnRJZDtcbiAgICBpZHMuZm9yRWFjaCgoaWQ6IHN0cmluZykgPT4ge1xuXG4gICAgICAvLyDlpoLmnpzlvZPliY3ooYzooqvliKDpmaTvvIzorqHnrpfkuIvkuIDlvZPliY3ooYxcbiAgICAgIGlmIChpZCA9PT0gbmV4dEN1cnJlbnRJZCkge1xuICAgICAgICBuZXh0Q3VycmVudElkID0gdGhpcy5nZXRDdXJyZW50SWRCZWZvcmVEZWxldGluZygpO1xuICAgICAgfVxuXG4gICAgICAvLyDliKDpmaTlr7nosaHvvIzmib7kuI3liLDml7bot7Pov4dcbiAgICAgIGNvbnN0IGluZGV4ID0gdGhpcy5nZXRJbmRleEJ5SWQoaWQpO1xuICAgICAgaWYgKGluZGV4ID09PSAtMSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBBcnJheVV0aWwucmVtb3ZlQnlJbmRleCh0aGlzLmlubmVyTGlzdCwgaW5kZXgpO1xuICAgIH0pO1xuXG4gICAgLy8g6YeN5paw6K6+572u5b2T5YmN6KGMXG4gICAgaWYgKHRoaXMuaW5uZXJMaXN0Lmxlbmd0aCA9PT0gMCkge1xuICAgICAgdGhpcy5jdXJyZW50SWQgPSBudWxsO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnNldEN1cnJlbnRJZChuZXh0Q3VycmVudElkLCBmYWxzZSwgZmFsc2UpO1xuICAgIH1cblxuICAgIC8vIOWHuuWPkeihjOWIoOmZpOS6i+S7tlxuICAgIHRoaXMuY2hhbmdlcy5uZXh0KHtcbiAgICAgIHR5cGU6IENoYW5nZVR5cGUuUmVtb3ZlLFxuICAgICAgcGF0aDogW10sXG4gICAgICB2YWx1ZTogaWRzXG4gICAgfSk7XG4gIH1cbiAgLyoqXG4gICAqIOWIoOmZpOaVsOaNru+8iOS4jeWIh+aNouW9k+WJjeihjO+8iVxuICAgKiBAcGFyYW0gaWRzIGlkc1xuICAgKi9cbiAgcHVibGljIHJlbW92ZURhdGFCeUlkcyhpZHM6IEFycmF5PHN0cmluZz4pOiB2b2lkIHtcbiAgICAvLyBpZiAoIWlkcyB8fCBpZHMubGVuZ3RoID09PSAwKSB7XG4gICAgLy8gICByZXR1cm47XG4gICAgLy8gfVxuXG4gICAgLy8gaWRzLmZvckVhY2goKGlkOiBzdHJpbmcpID0+IHtcbiAgICAvLyAgIC8vIOWIoOmZpOWvueixoe+8jOaJvuS4jeWIsOaXtui3s+i/h1xuICAgIC8vICAgY29uc3QgaW5kZXggPSB0aGlzLmdldEluZGV4QnlJZChpZCk7XG4gICAgLy8gICBpZiAoaW5kZXggPT09IC0xKSB7XG4gICAgLy8gICAgIHJldHVybjtcbiAgICAvLyAgIH1cbiAgICAvLyAgIHRoaXMuaW5uZXJMaXN0ID0gdGhpcy5pbm5lckxpc3QuZGVsZXRlKGluZGV4KTtcbiAgICAvLyB9KTtcblxuICAgIC8vIC8vIOWHuuWPkeihjOWIoOmZpOS6i+S7tlxuICAgIC8vIHRoaXMuY2hhbmdlcy5uZXh0KHtcbiAgICAvLyAgIHR5cGU6IENoYW5nZVR5cGUuUmVtb3ZlLFxuICAgIC8vICAgcGF0aDogW10sXG4gICAgLy8gICB2YWx1ZTogaWRzXG4gICAgLy8gfSk7XG4gIH1cbiAgLyoqXG4gICAqIOa4heepulxuICAgKi9cbiAgcHVibGljIGNsZWFyKCkge1xuICAgIHRoaXMuaW5uZXJMaXN0ID0gW107XG4gICAgdGhpcy5jdXJyZW50SWQgPSBudWxsO1xuICAgIHRoaXMuY2hhbmdlcy5uZXh0KHtcbiAgICAgIHR5cGU6IENoYW5nZVR5cGUuUmVtb3ZlLFxuICAgICAgcGF0aDogW10sXG4gICAgICB2YWx1ZTogW11cbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiDlpoLmnpzlvZPliY3ooYzooqvliKDpmaTvvIzliKDpmaTkuYvliY3ph43mlrDorqHnrpflvZPliY3ooYznmoTkvY3nva7vvIzlubbov5Tlm57kuIvkuIDlvZPliY3ooYznmoTkuLvplK7lgLzjgIJcbiAgICogLSDlpoLmnpzooqvliKDpmaTnmoTooYzmmK/mnIDlkI4x6KGM77yM5YiZ5LiK56e7MeihjO+8m1xuICAgKiAtIOWFtuS7luaDheWGte+8jOS4i+enuzHooYzjgIJcbiAgICovXG4gIHB1YmxpYyBnZXRDdXJyZW50SWRCZWZvcmVEZWxldGluZygpOiBzdHJpbmcge1xuICAgIGxldCBuZXh0SW5kZXggPSAtMTtcbiAgICBjb25zdCBjdXJyZW50SW5kZXggPSB0aGlzLmdldEluZGV4QnlJZCh0aGlzLmN1cnJlbnRJZCk7XG4gICAgaWYgKGN1cnJlbnRJbmRleCA9PT0gdGhpcy5sZW5ndGggLSAxKSB7XG4gICAgICBuZXh0SW5kZXggPSBjdXJyZW50SW5kZXggLSAxO1xuICAgIH0gZWxzZSB7XG4gICAgICBuZXh0SW5kZXggPSBjdXJyZW50SW5kZXggKyAxO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy5nZXRJZEJ5SW5kZXgobmV4dEluZGV4KTtcbiAgfVxuXG4gIC8qKlxuICAgKiDmoLnmja7kuLvplK7lgLzojrflj5blr7nlupTnu5Hlrprlr7nosaFcbiAgICogQHBhcmFtICAgaWQg6KaB5p+l5om+55qE5Li76ZSu5YC8XG4gICAqIEByZXR1cm5zIOaJvuWIsOaXtui/lOWbnuWvueW6lEJpbmRpbmdPYmplY3TvvIwg5om+5LiN5Yiw5pe26L+U5ZuebnVsbFxuICAgKi9cbiAgcHVibGljIGZpbmRCeUlkKGlkOiBzdHJpbmcpOiBCaW5kaW5nT2JqZWN0IHwgbnVsbCB7XG4gICAgbGV0IHRhcmdldDogQmluZGluZ09iamVjdDtcbiAgICB0YXJnZXQgPSB0aGlzLmlubmVyTGlzdC5maW5kKChpdGVtKSA9PiB7XG4gICAgICByZXR1cm4gaXRlbS5nZXRWYWx1ZSh0aGlzLnByaW1hcnlLZXkpID09PSBpZDtcbiAgICB9KTtcbiAgICByZXR1cm4gdGFyZ2V0ID09PSB1bmRlZmluZWQgPyBudWxsIDogdGFyZ2V0O1xuICB9XG5cbiAgLyoqXG4gICAqIOWwhuS4u+mUruWAvOS4umlk55qE57uR5a6a5a+56LGh6K6+572u5Li65b2T5YmN6KGMXG4gICAqIEBwYXJhbSAgaWQgICAgICAgIOimgeiuvue9rueahOS4u+mUruWAvFxuICAgKiBAcGFyYW0gIGVtaXRFdmVudCDmmK/lkKblj5HpgIHlvZPliY3ooYzlj5jmm7Tkuovku7ZcbiAgICovXG4gIHB1YmxpYyBzZXRDdXJyZW50SWQoaWQ6IHN0cmluZywgZW1pdEV2ZW50OiBib29sZWFuID0gdHJ1ZSwgZW1pdEdsb2JhbEV2ZW50OiBib29sZWFuID0gdHJ1ZSk6IHZvaWQge1xuICAgIGlmICh0aGlzLmN1cnJlbnRJZCA9PT0gaWQpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyDkuI3lrZjlnKjml7borr7nva7kuLpudWxsXG4gICAgLy8gY29uc3QgY3VycmVudE9iaiA9IHRoaXMuZmluZEJ5SWQoaWQpO1xuICAgIC8vIGlmICghY3VycmVudE9iaikge1xuICAgIC8vICAgdGhpcy5jdXJyZW50SWQgPSBudWxsO1xuICAgIC8vIH0gZWxzZSB7XG4gICAgLy8gICB0aGlzLmN1cnJlbnRJZCA9IGlkO1xuICAgIC8vIH1cblxuICAgIC8vIEB0b2Rv77ya5om+5LiN5Yiw5pe25oyJ55CG5bqU6K+l6K6+572u5Li6bnVsbO+8jOebruWJjeaYr+ebtOaOpei/lOWbnu+8jOahhuaetumDqOWIhuWKn+iDveS+nei1luivpeeJueaAp+OAglxuICAgIGNvbnN0IGN1cnJlbnRPYmogPSB0aGlzLmZpbmRCeUlkKGlkKTtcbiAgICBpZiAoIWN1cnJlbnRPYmopIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdGhpcy5jdXJyZW50SWQgPSBpZDtcblxuICAgIC8vIOWPkeWHuuihjOWIh+aNouS6i+S7tlxuICAgIGlmIChlbWl0RXZlbnQgPT09IHRydWUpIHtcbiAgICAgIHRoaXMuY2hhbmdlcy5uZXh0KHtcbiAgICAgICAgdHlwZTogQ2hhbmdlVHlwZS5TZWxlY3Rpb25DaGFuZ2VkLFxuICAgICAgICBwYXRoOiBbXSxcbiAgICAgICAgdmFsdWU6IHRoaXMuY3VycmVudEl0ZW1cbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIOaYr+WQpuWPkemAgeWFqOWxgOeahOihjOWIh+aNouS6i+S7tlxuICAgIGlmIChlbWl0R2xvYmFsRXZlbnQgPT09IHRydWUpIHtcbiAgICAgIHRoaXMuY2hhbmdlcy5uZXh0KHtcbiAgICAgICAgdHlwZTogQ2hhbmdlVHlwZS5HbG9iYWxTZWxlY3Rpb25DaGFuZ2VkLFxuICAgICAgICBwYXRoOiBbXSxcbiAgICAgICAgdmFsdWU6IHRoaXMuY3VycmVudEl0ZW1cbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiDmoLnmja7kuLvplK7lgLzkuLppZOeahOe7keWumuWvueixoeeahOe0ouW8lVxuICAgKiBAcGFyYW0gaWQg5Li76ZSu5YC8XG4gICAqIEByZXR1cm5zIOaJvuWIsOaXtui/lOWbnuWvueW6lOeahGluZGV477yM5om+5LiN5Yiw5pe26L+U5ZueLTFcbiAgICovXG4gIHB1YmxpYyBnZXRJbmRleEJ5SWQoaWQ6IHN0cmluZyk6IG51bWJlciB7XG4gICAgcmV0dXJuIHRoaXMuaW5uZXJMaXN0LmZpbmRJbmRleCgob2JqOiBCaW5kaW5nT2JqZWN0KSA9PiB7XG4gICAgICByZXR1cm4gb2JqW3RoaXMucHJpbWFyeUtleV0gPT09IGlkO1xuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIOagueaNrue0ouW8leS9jee9ruiOt+WPluWvueW6lOe7keWumuWvueixoeeahOS4u+mUruWAvFxuICAgKiBAcmV1dHJuIOaJvuWIsOaXtui/lOWbnuWvueW6lOS4u+mUruWAvO+8jOaJvuS4jeWIsOi/lOWbnm51bGxcbiAgICovXG4gIHB1YmxpYyBnZXRJZEJ5SW5kZXgoaW5kZXg6IG51bWJlcik6IHN0cmluZyB7XG5cbiAgICBpZiAoaW5kZXggPCAwIHx8IGluZGV4ID4gdGhpcy5sZW5ndGgpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIGNvbnN0IG9iaiA9IHRoaXMuaW5uZXJMaXN0W2luZGV4XTtcbiAgICBpZiAoIW9iaikge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgcmV0dXJuIG9ialt0aGlzLnByaW1hcnlLZXldO1xuICB9XG5cbiAgLyoqXG4gICAqIOi9rOaNouS4ukJpbmRpbmdPYmplY3TmlbDnu4RcbiAgICovXG4gIHB1YmxpYyB0b0FycmF5KCk6IEJpbmRpbmdPYmplY3RbXSB7XG4gICAgcmV0dXJuIHRoaXMuaW5uZXJMaXN0LmNvbmNhdChbXSk7XG4gIH1cbiAgLyoqXG4gICAqIOS6pOS6kuaVsOaNruS9jee9rlxuICAgKiBAcGFyYW0gaWQxIGlkMVxuICAgKiBAcGFyYW0gaWQyIGlkMlxuICAgKi9cbiAgcHVibGljIHN3YXBCeUlkKGlkMTogYW55LCBpZDI6IGFueSkge1xuICAgIC8vIGNvbnN0IGl0ZW0xID0gdGhpcy5pbm5lckxpc3QuZmluZChlbGVtZW50ID0+IGVsZW1lbnQucHJpbWFyeUtleVZhbHVlID09PSBpZDEpO1xuICAgIC8vIGNvbnN0IGl0ZW0yID0gdGhpcy5pbm5lckxpc3QuZmluZChlbGVtZW50ID0+IGVsZW1lbnQucHJpbWFyeUtleVZhbHVlID09PSBpZDIpO1xuICAgIC8vIHRoaXMuaW5uZXJMaXN0ID0gdGhpcy5pbm5lckxpc3QubWFwKChiaW5kaW5nT2JqZWN0OiBCaW5kaW5nT2JqZWN0LCBpbmRleDogbnVtYmVyKSA9PiB7XG4gICAgLy8gICBpZiAoYmluZGluZ09iamVjdC5wcmltYXJ5S2V5VmFsdWUgPT09IGlkMSkge1xuICAgIC8vICAgICByZXR1cm4gaXRlbTI7XG4gICAgLy8gICB9IGVsc2UgaWYgKGJpbmRpbmdPYmplY3QucHJpbWFyeUtleVZhbHVlID09PSBpZDIpIHtcbiAgICAvLyAgICAgcmV0dXJuIGl0ZW0xO1xuICAgIC8vICAgfSBlbHNlIHJldHVybiBiaW5kaW5nT2JqZWN0O1xuICAgIC8vIH0pLnRvTGlzdCgpO1xuICAgIC8vIHRoaXMuY2hhbmdlcy5uZXh0KHtcbiAgICAvLyAgIHR5cGU6IENoYW5nZVR5cGUuU3dhcCxcbiAgICAvLyAgIHBhdGg6IFtdXG4gICAgLy8gfSk7XG4gIH1cbiAgLyoqXG4gICAqIOi9rOaNouS4ukpTT07lr7nosaFcbiAgICogQHJldHVybnMg5pmu6YCa5a+56LGh5pWw57uEXG4gICAqL1xuICBwdWJsaWMgdG9KU09OKG9wdGlvbnM/OiBhbnkpOiBhbnlbXSB7XG4gICAgY29uc3QgcmVzdWx0ID0gW107XG4gICAgdGhpcy5pbm5lckxpc3QuZm9yRWFjaCgob2JqOiBCaW5kaW5nT2JqZWN0KSA9PiB7XG4gICAgICByZXN1bHQucHVzaChvYmoudG9KU09OKG9wdGlvbnMpKTtcbiAgICB9KTtcbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG5cbiAgLyoqXG4gICAqIOiOt+WPluWIhumhteS/oeaBr1xuICAgKiBAcGFyYW0gcGF0aCDot6/lvoRcbiAgICogQHBhcmFtIGRlZmF1bHRWYWx1ZSDpu5jorqTlgLxcbiAgICovXG4gIHB1YmxpYyBnZXRQYWdpbmF0aW9uQ29uZmlnQnlQYXRoKHBhdGg6IHN0cmluZywgZGVmYXVsdFZhbHVlPzogYW55KSB7XG4gICAgaWYgKCFwYXRoIHx8IHBhdGggPT09ICcvJykge1xuICAgICAgcmV0dXJuIHRoaXMucGFnaW5hdGlvbkluZm87XG4gICAgfVxuICAgIGlmICh0eXBlb2YgcGF0aCAhPT0gJ3N0cmluZycpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcign6Lev5b6E5b+F6aG75Li65a2X56ym5Liy77yBJyk7XG4gICAgfVxuICAgIHBhdGggPSBwYXRoLnN1YnN0cmluZygxKTtcbiAgICBjb25zdCBwYXRocyA9IHBhdGguc3BsaXQoJy8nKS5maWx0ZXIoaXRlbSA9PiAhIWl0ZW0gJiYgaXRlbS50cmltKCkubGVuZ3RoID4gMCkubWFwKGl0ZW0gPT4gaXRlbS50cmltKCkpO1xuICAgIGxldCBjb25maWcgPSB0aGlzLnBhZ2luYXRpb25JbmZvO1xuICAgIHBhdGhzLmZvckVhY2goaXRlbSA9PiB7XG4gICAgICBpZiAoY29uZmlnICYmIGNvbmZpZy5oYXNPd25Qcm9wZXJ0eShpdGVtKSkge1xuICAgICAgICBjb25maWcgPSBjb25maWdbaXRlbV07XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25maWcgPSBudWxsO1xuICAgICAgfVxuICAgIH0pO1xuICAgIHJldHVybiAhIWNvbmZpZyA/IGNvbmZpZyA6IHR5cGVvZiBkZWZhdWx0VmFsdWUgIT09ICd1bmRlZmluZWQnID8gZGVmYXVsdFZhbHVlIDogdW5kZWZpbmVkO1xuICB9XG5cbiAgLyoqXG4gICAqIOWvuWJpbmRpbmdMaXN05bCx6KGM5o6S5bqPXG4gICAqIEBwYXJhbSBzdHJpbmcg5o6S5bqP5a2X5q61XG4gICAqIEBwYXJhbSBkaXJlY3Rpb25zIOaOkuW6j+inhOWImeWtl+autVxuICAgKiBAcGFyYW0gb3B0aW9ucyDlj4LmlbBcbiAgICovXG4gIHB1YmxpYyBzb3J0QnkoZmllbGRzOiBzdHJpbmcgfCBBcnJheTxzdHJpbmc+LCBkaXJlY3Rpb25zOiBzdHJpbmcgfCBBcnJheTxzdHJpbmc+LCBvcHRpb25zPzogeyBbcHJvcDogc3RyaW5nXTogYW55IH0pIHtcbiAgICBpZiAoIWZpZWxkcyB8fCBmaWVsZHMubGVuZ3RoIDwgMSB8fCAhZGlyZWN0aW9ucyB8fCBkaXJlY3Rpb25zLmxlbmd0aCA8IDEpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignc29ydEJ5OmFyZ3VtZW50IGVycm9yJyk7XG4gICAgfVxuICAgIC8vIOm7mOiupOWNh+W6j1xuICAgIGNvbnN0IGFyckZpZWxkczogQXJyYXk8c3RyaW5nPiA9IHR5cGVvZiBmaWVsZHMgPT09ICdzdHJpbmcnID8gZmllbGRzLnNwbGl0KCcsJykgOiBmaWVsZHMgfHwgW107XG4gICAgY29uc3QgYXJyRGlyZWN0aW9uczogQXJyYXk8c3RyaW5nPiA9IHR5cGVvZiBkaXJlY3Rpb25zID09PSAnc3RyaW5nJyA/IGRpcmVjdGlvbnMuc3BsaXQoJywnKSA6IGRpcmVjdGlvbnMgfHwgW107XG4gICAgLy8g5o6S5bqP5a2X5q615ZKM5o6S5bqP5pa55byP5bqU5LiA6Ie0XG4gICAgaWYgKGFyckZpZWxkcy5sZW5ndGggIT09IGFyckRpcmVjdGlvbnMubGVuZ3RoIHx8IGFyckZpZWxkcy5sZW5ndGggPCAxKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ3NvcnRCeTpmaWVsZHMgYW5kIGRpcmVjdGlvbnMgbm90IG1hdGNoJyk7XG4gICAgfVxuICAgIC8vIG5hZ2UsYWdlLHRvdGFsXG4gICAgY29uc3QgY29tcGFyYXRvciA9IChwcm9wczogQXJyYXk8c3RyaW5nPiwgb3JkZXJzOiBBcnJheTxzdHJpbmc+KSA9PiAoaXRlbTE6IEJpbmRpbmdPYmplY3QsIGl0ZW0yOiBCaW5kaW5nT2JqZWN0KSA9PiB7XG4gICAgICBmb3IgKGNvbnN0IHByb3Agb2YgcHJvcHMpIHtcbiAgICAgICAgY29uc3Qgb3JkZXIgPSBbJ2FzYyddLmluY2x1ZGVzKG9yZGVyc1twcm9wcy5pbmRleE9mKHByb3ApXSkgPyAxIDogLTE7XG4gICAgICAgIGlmIChpdGVtMS5nZXRWYWx1ZShwcm9wKSA+IGl0ZW0yLmdldFZhbHVlKHByb3ApKSB7IHJldHVybiBvcmRlciAqIDE7IH1cbiAgICAgICAgaWYgKGl0ZW0xLmdldFZhbHVlKHByb3ApIDwgaXRlbTIuZ2V0VmFsdWUocHJvcCkpIHsgcmV0dXJuIG9yZGVyICogLTE7IH1cbiAgICAgIH1cbiAgICAgIHJldHVybiAwO1xuICAgIH07XG4gICAgdGhpcy5pbm5lckxpc3QgPSB0aGlzLmlubmVyTGlzdC5zb3J0KGNvbXBhcmF0b3IoYXJyRmllbGRzLCBhcnJEaXJlY3Rpb25zKSk7XG4gIH1cblxuICBwcml2YXRlIGdldFZhbHVlKHRhcmdldDogYW55LCBwcm9wTmFtZTogc3RyaW5nLCBpc011bHRpTGFuZ1Byb3A6IGJvb2xlYW4gPSBmYWxzZSwgY3VycmVudExhbmd1YWdlOiBzdHJpbmcgPSAnemgtQ0hTJykge1xuICAgIGlmICh0YXJnZXQgaW5zdGFuY2VvZiBCaW5kaW5nTGlzdCkge1xuICAgICAgdGFyZ2V0ID0gdGFyZ2V0LmN1cnJlbnRJdGVtO1xuICAgIH0gZWxzZSBpZiAodGFyZ2V0IGluc3RhbmNlb2YgQmluZGluZ0RhdGEpIHtcbiAgICAgIHRhcmdldCA9IHRhcmdldC5saXN0LmN1cnJlbnRJdGVtO1xuICAgIH1cbiAgICBsZXQgcmVzdWx0ID0gbnVsbDtcbiAgICBpZiAocHJvcE5hbWUuaW5kZXhPZignLicpID09PSAtMSkge1xuICAgICAgcmVzdWx0ID0gdGFyZ2V0W3Byb3BOYW1lXTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc3QgcHJvcHMgPSBwcm9wTmFtZS5zcGxpdCgnLicpO1xuICAgICAgZm9yIChjb25zdCBwcm9wIG9mIHByb3BzKSB7XG4gICAgICAgIHRhcmdldCA9IHJlc3VsdCA9IHRoaXMuZ2V0VmFsdWUodGFyZ2V0LCBwcm9wLCBpc011bHRpTGFuZ1Byb3AsIGN1cnJlbnRMYW5ndWFnZSk7XG4gICAgICB9XG4gICAgfVxuICAgIGlmIChpc011bHRpTGFuZ1Byb3AgJiYgcmVzdWx0ICYmIHJlc3VsdC5oYXNPd25Qcm9wZXJ0eShjdXJyZW50TGFuZ3VhZ2UpKSB7XG4gICAgICByZXR1cm4gcmVzdWx0W2N1cnJlbnRMYW5ndWFnZV07XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfVxuICB9XG59XG5cbmV4cG9ydCB7IEJpbmRpbmdMaXN0IH07XG4iXX0=
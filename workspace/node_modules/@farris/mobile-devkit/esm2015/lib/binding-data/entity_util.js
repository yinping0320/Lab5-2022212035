import { PARENT_CLASS, FieldMetadataUtil } from '../entity/index';
import { ModifyType } from '../changeset/index';
import { ChangeType } from './changes';
import { BindingPropertyType } from './binding_property';
import { BindingObjectFactory } from './binding_object_factory';
/**
 * 实体操作工具类
 */
class EntityUtil {
    /**
     * 将entity的数据加载到bindingObject中，并保持两者同步。
     * @param entity        实体对象
     * @param bindingObject 绑定对象
     */
    static loadEntity(entity, bindingObject) {
        // 遍历bindingObject的properties进行赋值
        bindingObject.properties.forEach((property) => {
            const propertyName = property.name;
            if (property.type === BindingPropertyType.List) {
                this.loadEntityList(entity[propertyName] || entity[PARENT_CLASS], bindingObject[propertyName]);
            }
            else if (property.type === BindingPropertyType.Object) {
                if (entity && entity[propertyName]) {
                    this.loadEntity(entity[propertyName], bindingObject[propertyName]);
                }
            }
            else if (property.type === BindingPropertyType.Dynamic) {
                if (entity && entity[propertyName]) {
                    const dynamicObject = BindingObjectFactory.createDynamicBindingObject(entity[propertyName].data);
                    BindingObjectFactory.attachDynamicObjectProperty(bindingObject, propertyName, dynamicObject);
                    this.loadEntity(entity[propertyName], bindingObject[propertyName]);
                }
            }
            else {
                bindingObject.setValue(propertyName, entity[propertyName], false, false);
            }
        });
        this.setUpEntityPipeline(entity, bindingObject);
    }
    /**
     * 建立entity和bindingObject之间的关联
     * @param entity        实体对象
     * @param bindingObject 绑定对象
     */
    static setUpEntityPipeline(entity, bindingObject) {
        // 监听entity变更
        entity.onValueChanged.subscribe((modification) => {
            if (modification.type !== ModifyType.ValueChange || modification.path.length === 0) {
                return;
            }
            const propertyName = modification.path[modification.path.length - 1];
            const primaryKeyPath = modification.path[modification.path.length - 2];
            // 验证主键是否匹配
            // 存在主键并且主键不是id时才检查（值对象、关联对象不检查）
            if (bindingObject.primaryKey && bindingObject.primaryKey === 'id') {
                const primaryKey = bindingObject.primaryKey;
                const primaryKeyValue = bindingObject.getValue(primaryKey);
                if (primaryKeyPath !== `${primaryKey}:${primaryKeyValue}`) {
                    return;
                }
            }
            // 值没有发生变化，不再设置
            // TODO: 通过bindingObject修改entity属性值时，entity总会触发一个变更回来，如果不截获这个重复的变更，会导致重复或死循环
            if (bindingObject.getValue(propertyName) === modification.value) {
                return;
            }
            bindingObject.setValue(propertyName, modification.value, true, false, modification.errors);
        });
        // 监听bindingObject变更
        bindingObject.viewChanges.subscribe((viewChange) => {
            const value = viewChange.value;
            const propertyName = viewChange.path[0];
            let pathPrefix = '';
            const pathData = entity.getPaths();
            const paths = pathData.path;
            let id = bindingObject['id'];
            if (pathData.isUdt) {
                // grid中udt没有id，从父级中取出id，以便存放验证信息
                const getParentId = (target) => {
                    let parentId = '';
                    const findId = (item) => {
                        if (item && item && item['id']) {
                            parentId = item['id'];
                            return;
                        }
                        else if (item['parent']) {
                            findId(item['parent']);
                        }
                    };
                    findId(target);
                    return parentId;
                };
                id = getParentId(bindingObject);
                if (pathData.isGrid) {
                    // grid 将从表主字段去除
                    paths.shift();
                }
                if (paths.length) {
                    pathPrefix = paths.join('.') + '.';
                }
            }
            // 不是主键值字段时，要先检查主键是否存在，并且主键是否相等（防止后代变更冒泡上来）
            // 非主键属性变更时，要先检查主键是否匹配（如果主键也修改了，要求先修改主键再修改其他值）
            if (bindingObject.primaryKey) {
                const primaryKey = bindingObject.primaryKey;
                if (propertyName !== primaryKey) {
                    if (!entity[primaryKey] || entity[primaryKey] !== bindingObject[primaryKey]) {
                        return;
                    }
                }
            }
            // 如果BindingObject上的属性值和Entity上对应属性值一样，则不再设置
            if (entity[propertyName] === value) {
                return;
            }
            // 调用表单验证,通过后调用实体验证
            // bingdingObject变化后，先调用实体上的验证，通过后再设置实体的变动
            entity[propertyName] = value;
        });
    }
    /**
     * 将entityList中的Entity对象转换为BindingObject对象，加载到bindingList中，并保持entityList和bindingList同步。
     * @param entityList  实体列表
     * @param bindingList 绑定列表
     */
    static loadEntityList(entityList, bindingList) {
        this.loadEntities(entityList.items, bindingList);
        this.setUpEntityListPipeline(entityList, bindingList);
    }
    /**
     * 建立entityList和bindingList之间的关联
     * @param entityList  实体列表
     * @param bindingList 绑定列表
     */
    static setUpEntityListPipeline(entityList, bindingList) {
        entityList.onListChanged.subscribe((modification) => {
            switch (modification.type) {
                // 添加实体
                case ModifyType.Add:
                case ModifyType.Clone:
                    {
                        const entitiesToAdd = modification.value;
                        if (entitiesToAdd.length === 0) {
                            return;
                        }
                        // 检查父id是否一致，冒泡导致的变更不处理
                        const paths = modification.path;
                        const parentPath = paths[paths.length - 2];
                        const parentId = bindingList.parent.primaryKeyValue;
                        if (parentPath.indexOf(parentId) === -1) {
                            return;
                        }
                        this.appendEntities(modification.value, bindingList, modification.type === ModifyType.Clone);
                    }
                    break;
                case ModifyType.Insert:
                    {
                        // 检查父id是否一致，冒泡导致的变更不处理
                        const paths = modification.path;
                        const parentPath = paths[paths.length - 2];
                        const parentId = bindingList.parent.primaryKeyValue;
                        const position = modification.position;
                        if (parentPath.indexOf(parentId) === -1) {
                            return;
                        }
                        this.insertEntity(modification.value[0], bindingList, position);
                    }
                    break;
                // 删除实体
                case ModifyType.Remove:
                    {
                        // 删除实体（value格式待商榷，目前value的格式为 { primaryKey: primaryValue}）
                        const id = modification.value[bindingList.primaryKey];
                        bindingList.removeByIds([id]);
                        // this.removeEntities(<Entity[]>modification.value, bindingList);
                    }
                    break;
                // 加载实体
                case ModifyType.Load:
                    const entities = modification.value;
                    this.loadEntities(entities, bindingList);
                    break;
                default:
                    break;
            }
        });
    }
    /**
     * 监听repository变化，保持repository和bindingList同步。
     * @param repository  实体仓库
     * @param bindingList 绑定列表
     */
    static loadRepository(repository, bindingList) {
        // 初次加载
        const entities = Array.from(repository.entityCollection.toArray());
        this.loadEntities(entities, bindingList);
        // 监听变化
        repository.entityCollectionChange.subscribe((modification) => {
            switch (modification.type) {
                case ModifyType.Load:
                    this.loadEntities(modification.value, bindingList, modification.entityCreate);
                    break;
                case ModifyType.Add:
                case ModifyType.Clone:
                    this.appendEntities(modification.value, bindingList, modification.type === ModifyType.Clone);
                    break;
                case ModifyType.AddData:
                    this.addData(modification.value, bindingList);
                    break;
                case ModifyType.Insert:
                    this.insertEntity(modification.value, bindingList, modification.position);
                    break;
                case ModifyType.Remove:
                    this.removeEntities(modification.value, bindingList);
                    break;
                case ModifyType.RemoveData:
                    this.removeData(modification.value, bindingList);
                    break;
                case ModifyType.PaginationInfoChange:
                    bindingList.paginationInfo = modification.value;
                    break;
                default:
                    break;
            }
        });
        // 监听BindingList数据变化
        bindingList.changes.subscribe((change) => {
            if (change.type === ChangeType.PaginationInfoChange) {
                const entityCollection = repository.entityCollection;
                // const entityTypeName = entityCollection.entityTypeName;
                // const original = entityCollection.paginationInfo[entityTypeName];
                // const entityPaginationInfo = Object.assign({}, original, change.value);
                entityCollection.paginationInfo = Object.assign({}, entityCollection.paginationInfo, change.value);
            }
        });
    }
    /**
     * 将entities中的Entity对象转换为BindingObject对象，并加载到bindingList中
     * @param entities    实体数组
     * @param bindingList 绑定列表
     */
    static loadEntities(entities, bindingList, entityCreate = false) {
        const bindingObjects = this.createBindingObjects(entities, bindingList);
        bindingList.load(bindingObjects, entityCreate);
    }
    /**
     * 将entities中的Entity对象转换为BIndingObject对象，并追加到bindingList中
     * @param entities    实体数组
     * @param bindingList 绑定列表
     */
    static appendEntities(entities, bindingList, isCloned = false) {
        const bindingObjects = this.createBindingObjects(entities, bindingList);
        bindingList.append(bindingObjects, isCloned);
    }
    /**
     * 增加实体数据（不切换当前行）
     * @param entities
     * @param bindingList
     */
    static addData(entities, bindingList) {
        const bindingObjects = this.createBindingObjects(entities, bindingList);
        bindingList.addData(bindingObjects);
    }
    static insertEntity(entity, bindingList, position) {
        const bindingObject = this.createBindingObject(entity, bindingList);
        bindingList.insert(bindingObject, position);
    }
    /**
     * 从bindingList移除entities对应的BindingObject对象
     * @param entities    实体数组
     * @param bindingList 绑定列表
     */
    static removeEntities(entities, bindingList) {
        if (entities === null || entities.length === 0) {
            return;
        }
        // 归集要删除的id数组
        const primaryKey = bindingList.primaryKey;
        const ids = [];
        entities.forEach((entity) => {
            ids.push(entity[primaryKey]);
        });
        bindingList.removeByIds(ids);
    }
    static removeData(entities, bindingList) {
        if (entities === null || entities.length === 0) {
            return;
        }
        // 归集要删除的id数组
        const primaryKey = bindingList.primaryKey;
        const ids = [];
        entities.forEach((entity) => {
            ids.push(entity[primaryKey]);
        });
        bindingList.removeDataByIds(ids);
    }
    /**
     * 将entities中的Entity对象转换为BindingObject对象
     * @param entities    实体数组
     * @param bindingList 绑定列表
     */
    static createBindingObjects(entities, bindingList) {
        if (entities === null || entities.length === 0) {
            return [];
        }
        const bindingObjects = [];
        entities.forEach((entity) => {
            const bindingObject = BindingObjectFactory.create(bindingList.properties);
            bindingObject['_ENTITY_'] = entity;
            this.loadEntity(entity, bindingObject);
            // // 为bindingObject设置默认值initialData属性
            // if (entity['initialData']) {
            //   bindingObject['initialData'] = entity['initialData'];
            // }
            bindingObjects.push(bindingObject);
        });
        return bindingObjects;
    }
    static createBindingObject(entity, bindingList) {
        const bindingObject = BindingObjectFactory.create(bindingList.properties);
        this.loadEntity(entity, bindingObject);
        return bindingObject;
    }
    static watchReposiroty(repository, bindingData) {
        // reposiroty => bindingData
        repository.entityCollectionChange.subscribe((modification) => {
            switch (modification.type) {
                case ModifyType.PaginationInfoChange:
                    bindingData.pagingInfo = modification.value;
                    break;
                default:
                    break;
            }
        });
    }
    /**
     * 查找属性的类型
     * @param entityType 实体类型
     * @param targetPropName 属性名称
     * @return 属性信息，包含属性类型（NgField、NgObject、NgList）和属性对应的实体类型（当NgField类型时为null）
     */
    static getPropInfo(entityType, targetPropName) {
        let propType;
        let propEntityType;
        // NgField
        const ngFieldProperties = FieldMetadataUtil.getNgFields(entityType);
        Object.keys(ngFieldProperties).forEach((propName) => {
            if (propName === targetPropName) {
                propType = 'NgField';
                propEntityType = null;
            }
        });
        // NgObject
        const ngObjectProperties = FieldMetadataUtil.getNgObjects(entityType);
        Object.keys(ngObjectProperties).forEach((propName) => {
            if (propName === targetPropName) {
                propType = 'NgObject';
                propEntityType = ngObjectProperties[propName].type;
            }
        });
        // NgList
        const ngListProperties = FieldMetadataUtil.getNgList(entityType);
        Object.keys(ngListProperties).forEach((propName) => {
            if (propName === targetPropName) {
                propType = 'NgList';
                propEntityType = ngListProperties[propName].type;
            }
        });
        const ngDynamicProperties = FieldMetadataUtil.getNgDynamic(entityType);
        Object.keys(ngDynamicProperties).forEach((propName) => {
            if (propName === targetPropName) {
                propType = 'NgDynamic';
                propEntityType = ngDynamicProperties[propName].type;
            }
        });
        return { propType, propEntityType };
    }
    /**
     * 获取实体的主键名
     * @param entityType 实体类型
     */
    static getPrimaryKey(entityType) {
        const primaryNgFiledProp = FieldMetadataUtil.getPrimaryFieldMetadata(entityType);
        if (primaryNgFiledProp) {
            return primaryNgFiledProp.dataField;
        }
        else {
            return '';
        }
    }
    /**
     * 是否为对象属性
     */
    static isObjectProp(entityType, targetPropName) {
        let isObjectProp = false;
        const ngObjectProperties = FieldMetadataUtil.getNgObjects(entityType);
        Object.keys(ngObjectProperties).forEach((propName) => {
            if (propName === targetPropName) {
                isObjectProp = true;
            }
        });
        return isObjectProp;
    }
    /**
     * 检查是否是动态列属性
     */
    static isDynamicProp(entityType, targetPropName) {
        let isDynamicProp = false;
        const ngDynamicProperties = FieldMetadataUtil.getNgDynamic(entityType);
        Object.keys(ngDynamicProperties).forEach((propName) => {
            if (propName === targetPropName) {
                isDynamicProp = true;
            }
        });
        return isDynamicProp;
    }
    /**
     * 为实体增加initialData属性
     * @param entity 实体实例
     * @param initialData 默认值对象
     */
    static appendInitialData(entity, initialData) {
        const data = Object.assign({}, initialData);
        delete data.id;
        delete data.parentID;
        entity['initialData'] = data;
    }
}
export { EntityUtil };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZW50aXR5X3V0aWwuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL21vYmlsZS1kZXZraXQvIiwic291cmNlcyI6WyJsaWIvYmluZGluZy1kYXRhL2VudGl0eV91dGlsLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUNBLE9BQU8sRUFBc0IsWUFBWSxFQUFFLGlCQUFpQixFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFDdEYsT0FBTyxFQUFnQixVQUFVLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQztBQUM5RCxPQUFPLEVBQXNCLFVBQVUsRUFBRSxNQUFNLFdBQVcsQ0FBQztBQUczRCxPQUFPLEVBQW1CLG1CQUFtQixFQUFFLE1BQU0sb0JBQW9CLENBQUM7QUFDMUUsT0FBTyxFQUFFLG9CQUFvQixFQUFFLE1BQU0sMEJBQTBCLENBQUM7QUFJaEU7O0dBRUc7QUFDSCxNQUFNLFVBQVU7SUFFZDs7OztPQUlHO0lBQ0gsTUFBTSxDQUFDLFVBQVUsQ0FBQyxNQUFjLEVBQUUsYUFBNEI7UUFFNUQsaUNBQWlDO1FBQ2pDLGFBQWEsQ0FBQyxVQUFVLENBQUMsT0FBTyxDQUFDLENBQUMsUUFBeUIsRUFBRSxFQUFFO1lBQzdELE1BQU0sWUFBWSxHQUFHLFFBQVEsQ0FBQyxJQUFJLENBQUM7WUFDbkMsSUFBSSxRQUFRLENBQUMsSUFBSSxLQUFLLG1CQUFtQixDQUFDLElBQUksRUFBRTtnQkFDOUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxNQUFNLENBQUMsWUFBWSxDQUFDLElBQUksTUFBTSxDQUFDLFlBQVksQ0FBQyxFQUFFLGFBQWEsQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDO2FBQ2hHO2lCQUFNLElBQUksUUFBUSxDQUFDLElBQUksS0FBSyxtQkFBbUIsQ0FBQyxNQUFNLEVBQUU7Z0JBQ3ZELElBQUksTUFBTSxJQUFJLE1BQU0sQ0FBQyxZQUFZLENBQUMsRUFBRTtvQkFDbEMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxNQUFNLENBQUMsWUFBWSxDQUFDLEVBQUUsYUFBYSxDQUFD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QUFNLENBQUMsRUFBRSxFQUFFLFdBQVcsQ0FBQyxDQUFDO1FBQzVDLE9BQU8sSUFBSSxDQUFDLEVBQUUsQ0FBQztRQUNmLE9BQU8sSUFBSSxDQUFDLFFBQVEsQ0FBQztRQUNyQixNQUFNLENBQUMsYUFBYSxDQUFDLEdBQUcsSUFBSSxDQUFDO0lBQy9CLENBQUM7Q0FDRjtBQUVELE9BQU8sRUFBRSxVQUFVLEVBQUUsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFJlcG9zaXRvcnkgfSBmcm9tICcuLi9yZXBvc2l0b3J5L2luZGV4JztcbmltcG9ydCB7IEVudGl0eSwgRW50aXR5TGlzdCwgUEFSRU5UX0NMQVNTLCBGaWVsZE1ldGFkYXRhVXRpbCB9IGZyb20gJy4uL2VudGl0eS9pbmRleCc7XG5pbXBvcnQgeyBNb2RpZmljYXRpb24sIE1vZGlmeVR5cGUgfSBmcm9tICcuLi9jaGFuZ2VzZXQvaW5kZXgnO1xuaW1wb3J0IHsgVmlld0NoYW5nZSwgQ2hhbmdlLCBDaGFuZ2VUeXBlIH0gZnJvbSAnLi9jaGFuZ2VzJztcbmltcG9ydCB7IEJpbmRpbmdMaXN0IH0gZnJvbSAnLi9iaW5kaW5nX2xpc3QnO1xuaW1wb3J0IHsgQmluZGluZ09iamVjdCB9IGZyb20gJy4vYmluZGluZ19vYmplY3QnO1xuaW1wb3J0IHsgQmluZGluZ1Byb3BlcnR5LCBCaW5kaW5nUHJvcGVydHlUeXBlIH0gZnJvbSAnLi9iaW5kaW5nX3Byb3BlcnR5JztcbmltcG9ydCB7IEJpbmRpbmdPYmplY3RGYWN0b3J5IH0gZnJvbSAnLi9iaW5kaW5nX29iamVjdF9mYWN0b3J5JztcbmltcG9ydCB7IFBhZ2luYXRpb24gfSBmcm9tICcuLi9jb3JlL2luZGV4JztcbmltcG9ydCB7IEJpbmRpbmdEYXRhIH0gZnJvbSAnLi9iaW5kaW5nX2RhdGEnO1xuXG4vKipcbiAqIOWunuS9k+aTjeS9nOW3peWFt+exu1xuICovXG5jbGFzcyBFbnRpdHlVdGlsIHtcblxuICAvKipcbiAgICog5bCGZW50aXR555qE5pWw5o2u5Yqg6L295YiwYmluZGluZ09iamVjdOS4re+8jOW5tuS/neaMgeS4pOiAheWQjOatpeOAglxuICAgKiBAcGFyYW0gZW50aXR5ICAgICAgICDlrp7kvZPlr7nosaFcbiAgICogQHBhcmFtIGJpbmRpbmdPYmplY3Qg57uR5a6a5a+56LGhXG4gICAqL1xuICBzdGF0aWMgbG9hZEVudGl0eShlbnRpdHk6IEVudGl0eSwgYmluZGluZ09iamVjdDogQmluZGluZ09iamVjdCkge1xuXG4gICAgLy8g6YGN5Y6GYmluZGluZ09iamVjdOeahHByb3BlcnRpZXPov5vooYzotYvlgLxcbiAgICBiaW5kaW5nT2JqZWN0LnByb3BlcnRpZXMuZm9yRWFjaCgocHJvcGVydHk6IEJpbmRpbmdQcm9wZXJ0eSkgPT4ge1xuICAgICAgY29uc3QgcHJvcGVydHlOYW1lID0gcHJvcGVydHkubmFtZTtcbiAgICAgIGlmIChwcm9wZXJ0eS50eXBlID09PSBCaW5kaW5nUHJvcGVydHlUeXBlLkxpc3QpIHtcbiAgICAgICAgdGhpcy5sb2FkRW50aXR5TGlzdChlbnRpdHlbcHJvcGVydHlOYW1lXSB8fCBlbnRpdHlbUEFSRU5UX0NMQVNTXSwgYmluZGluZ09iamVjdFtwcm9wZXJ0eU5hbWVdKTtcbiAgICAgIH0gZWxzZSBpZiAocHJvcGVydHkudHlwZSA9PT0gQmluZGluZ1Byb3BlcnR5VHlwZS5PYmplY3QpIHtcbiAgICAgICAgaWYgKGVudGl0eSAmJiBlbnRpdHlbcHJvcGVydHlOYW1lXSkge1xuICAgICAgICAgIHRoaXMubG9hZEVudGl0eShlbnRpdHlbcHJvcGVydHlOYW1lXSwgYmluZGluZ09iamVjdFtwcm9wZXJ0eU5hbWVdKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIGlmIChwcm9wZXJ0eS50eXBlID09PSBCaW5kaW5nUHJvcGVydHlUeXBlLkR5bmFtaWMpIHtcbiAgICAgICAgaWYgKGVudGl0eSAmJiBlbnRpdHlbcHJvcGVydHlOYW1lXSkge1xuICAgICAgICAgIGNvbnN0IGR5bmFtaWNPYmplY3QgPSBCaW5kaW5nT2JqZWN0RmFjdG9yeS5jcmVhdGVEeW5hbWljQmluZGluZ09iamVjdChlbnRpdHlbcHJvcGVydHlOYW1lXS5kYXRhKTtcbiAgICAgICAgICBCaW5kaW5nT2JqZWN0RmFjdG9yeS5hdHRhY2hEeW5hbWljT2JqZWN0UHJvcGVydHkoYmluZGluZ09iamVjdCwgcHJvcGVydHlOYW1lLCBkeW5hbWljT2JqZWN0KTtcbiAgICAgICAgICB0aGlzLmxvYWRFbnRpdHkoZW50aXR5W3Byb3BlcnR5TmFtZV0sIGJpbmRpbmdPYmplY3RbcHJvcGVydHlOYW1lXSk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGJpbmRpbmdPYmplY3Quc2V0VmFsdWUocHJvcGVydHlOYW1lLCBlbnRpdHlbcHJvcGVydHlOYW1lXSwgZmFsc2UsIGZhbHNlKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIHRoaXMuc2V0VXBFbnRpdHlQaXBlbGluZShlbnRpdHksIGJpbmRpbmdPYmplY3QpO1xuICB9XG5cbiAgLyoqXG4gICAqIOW7uueri2VudGl0eeWSjGJpbmRpbmdPYmplY3TkuYvpl7TnmoTlhbPogZRcbiAgICogQHBhcmFtIGVudGl0eSAgICAgICAg5a6e5L2T5a+56LGhXG4gICAqIEBwYXJhbSBiaW5kaW5nT2JqZWN0IOe7keWumuWvueixoVxuICAgKi9cbiAgc3RhdGljIHNldFVwRW50aXR5UGlwZWxpbmUoZW50aXR5OiBFbnRpdHksIGJpbmRpbmdPYmplY3Q6IEJpbmRpbmdPYmplY3QpIHtcblxuICAgIC8vIOebkeWQrGVudGl0eeWPmOabtFxuICAgIGVudGl0eS5vblZhbHVlQ2hhbmdlZC5zdWJzY3JpYmUoKG1vZGlmaWNhdGlvbjogTW9kaWZpY2F0aW9uKSA9PiB7XG4gICAgICBpZiAobW9kaWZpY2F0aW9uLnR5cGUgIT09IE1vZGlmeVR5cGUuVmFsdWVDaGFuZ2UgfHwgbW9kaWZpY2F0aW9uLnBhdGgubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGNvbnN0IHByb3BlcnR5TmFtZSA9IG1vZGlmaWNhdGlvbi5wYXRoW21vZGlmaWNhdGlvbi5wYXRoLmxlbmd0aCAtIDFdO1xuICAgICAgY29uc3QgcHJpbWFyeUtleVBhdGggPSBtb2RpZmljYXRpb24ucGF0aFttb2RpZmljYXRpb24ucGF0aC5sZW5ndGggLSAyXTtcblxuICAgICAgLy8g6aqM6K+B5Li76ZSu5piv5ZCm5Yy56YWNXG4gICAgICAvLyDlrZjlnKjkuLvplK7lubbkuJTkuLvplK7kuI3mmK9pZOaXtuaJjeajgOafpe+8iOWAvOWvueixoeOAgeWFs+iBlOWvueixoeS4jeajgOafpe+8iVxuICAgICAgaWYgKGJpbmRpbmdPYmplY3QucHJpbWFyeUtleSAmJiBiaW5kaW5nT2JqZWN0LnByaW1hcnlLZXkgPT09ICdpZCcpIHtcbiAgICAgICAgY29uc3QgcHJpbWFyeUtleSA9IGJpbmRpbmdPYmplY3QucHJpbWFyeUtleTtcbiAgICAgICAgY29uc3QgcHJpbWFyeUtleVZhbHVlID0gYmluZGluZ09iamVjdC5nZXRWYWx1ZShwcmltYXJ5S2V5KTtcbiAgICAgICAgaWYgKHByaW1hcnlLZXlQYXRoICE9PSBgJHtwcmltYXJ5S2V5fToke3ByaW1hcnlLZXlWYWx1ZX1gKSB7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIOWAvOayoeacieWPkeeUn+WPmOWMlu+8jOS4jeWGjeiuvue9rlxuICAgICAgLy8gVE9ETzog6YCa6L+HYmluZGluZ09iamVjdOS/ruaUuWVudGl0eeWxnuaAp+WAvOaXtu+8jGVudGl0eeaAu+S8muinpuWPkeS4gOS4quWPmOabtOWbnuadpe+8jOWmguaenOS4jeaIquiOt+i/meS4qumHjeWkjeeahOWPmOabtO+8jOS8muWvvOiHtOmHjeWkjeaIluatu+W+queOr1xuICAgICAgaWYgKGJpbmRpbmdPYmplY3QuZ2V0VmFsdWUocHJvcGVydHlOYW1lKSA9PT0gbW9kaWZpY2F0aW9uLnZhbHVlKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGJpbmRpbmdPYmplY3Quc2V0VmFsdWUocHJvcGVydHlOYW1lLCBtb2RpZmljYXRpb24udmFsdWUsIHRydWUsIGZhbHNlLCBtb2RpZmljYXRpb24uZXJyb3JzKTtcbiAgICB9KTtcblxuICAgIC8vIOebkeWQrGJpbmRpbmdPYmplY3Tlj5jmm7RcbiAgICBiaW5kaW5nT2JqZWN0LnZpZXdDaGFuZ2VzLnN1YnNjcmliZSgodmlld0NoYW5nZTogVmlld0NoYW5nZSkgPT4ge1xuICAgICAgY29uc3QgdmFsdWUgPSB2aWV3Q2hhbmdlLnZhbHVlO1xuICAgICAgY29uc3QgcHJvcGVydHlOYW1lID0gdmlld0NoYW5nZS5wYXRoWzBdO1xuXG4gICAgICBsZXQgcGF0aFByZWZpeCA9ICcnO1xuICAgICAgY29uc3QgcGF0aERhdGEgPSBlbnRpdHkuZ2V0UGF0aHMoKTtcbiAgICAgIGNvbnN0IHBhdGhzID0gcGF0aERhdGEucGF0aDtcbiAgICAgIGxldCBpZCA9IGJpbmRpbmdPYmplY3RbJ2lkJ107XG4gICAgICBpZiAocGF0aERhdGEuaXNVZHQpIHtcbiAgICAgICAgLy8gZ3JpZOS4rXVkdOayoeaciWlk77yM5LuO54i257qn5Lit5Y+W5Ye6aWTvvIzku6Xkvr/lrZjmlL7pqozor4Hkv6Hmga9cbiAgICAgICAgY29uc3QgZ2V0UGFyZW50SWQgPSAodGFyZ2V0OiBhbnkpID0+IHtcbiAgICAgICAgICBsZXQgcGFyZW50SWQgPSAnJztcbiAgICAgICAgICBjb25zdCBmaW5kSWQgPSAoaXRlbTogYW55KSA9PiB7XG4gICAgICAgICAgICBpZiAoaXRlbSAmJiBpdGVtICYmIGl0ZW1bJ2lkJ10pIHtcbiAgICAgICAgICAgICAgcGFyZW50SWQgPSBpdGVtWydpZCddO1xuICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGl0ZW1bJ3BhcmVudCddKSB7XG4gICAgICAgICAgICAgIGZpbmRJZChpdGVtWydwYXJlbnQnXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfTtcbiAgICAgICAgICBmaW5kSWQodGFyZ2V0KTtcbiAgICAgICAgICByZXR1cm4gcGFyZW50SWQ7XG4gICAgICAgIH07XG4gICAgICAgIGlkID0gZ2V0UGFyZW50SWQoYmluZGluZ09iamVjdCk7XG4gICAgICAgIGlmIChwYXRoRGF0YS5pc0dyaWQpIHtcbiAgICAgICAgICAvLyBncmlkIOWwhuS7juihqOS4u+Wtl+auteWOu+mZpFxuICAgICAgICAgIHBhdGhzLnNoaWZ0KCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHBhdGhzLmxlbmd0aCkge1xuICAgICAgICAgIHBhdGhQcmVmaXggPSBwYXRocy5qb2luKCcuJykgKyAnLic7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgLy8g5LiN5piv5Li76ZSu5YC85a2X5q615pe277yM6KaB5YWI5qOA5p+l5Li76ZSu5piv5ZCm5a2Y5Zyo77yM5bm25LiU5Li76ZSu5piv5ZCm55u4562J77yI6Ziy5q2i5ZCO5Luj5Y+Y5pu05YaS5rOh5LiK5p2l77yJXG4gICAgICAvLyDpnZ7kuLvplK7lsZ7mgKflj5jmm7Tml7bvvIzopoHlhYjmo4Dmn6XkuLvplK7mmK/lkKbljLnphY3vvIjlpoLmnpzkuLvplK7kuZ/kv67mlLnkuobvvIzopoHmsYLlhYjkv67mlLnkuLvplK7lho3kv67mlLnlhbbku5blgLzvvIlcbiAgICAgIGlmIChiaW5kaW5nT2JqZWN0LnByaW1hcnlLZXkpIHtcbiAgICAgICAgY29uc3QgcHJpbWFyeUtleSA9IGJpbmRpbmdPYmplY3QucHJpbWFyeUtleTtcbiAgICAgICAgaWYgKHByb3BlcnR5TmFtZSAhPT0gcHJpbWFyeUtleSkge1xuICAgICAgICAgIGlmICghZW50aXR5W3ByaW1hcnlLZXldIHx8IGVudGl0eVtwcmltYXJ5S2V5XSAhPT0gYmluZGluZ09iamVjdFtwcmltYXJ5S2V5XSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICAvLyDlpoLmnpxCaW5kaW5nT2JqZWN05LiK55qE5bGe5oCn5YC85ZKMRW50aXR55LiK5a+55bqU5bGe5oCn5YC85LiA5qC377yM5YiZ5LiN5YaN6K6+572uXG4gICAgICBpZiAoZW50aXR5W3Byb3BlcnR5TmFtZV0gPT09IHZhbHVlKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgLy8g6LCD55So6KGo5Y2V6aqM6K+BLOmAmui/h+WQjuiwg+eUqOWunuS9k+mqjOivgVxuICAgICAgLy8gYmluZ2RpbmdPYmplY3Tlj5jljJblkI7vvIzlhYjosIPnlKjlrp7kvZPkuIrnmoTpqozor4HvvIzpgJrov4flkI7lho3orr7nva7lrp7kvZPnmoTlj5jliqhcbiAgICAgIGVudGl0eVtwcm9wZXJ0eU5hbWVdID0gdmFsdWU7XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICog5bCGZW50aXR5TGlzdOS4reeahEVudGl0eeWvueixoei9rOaNouS4ukJpbmRpbmdPYmplY3Tlr7nosaHvvIzliqDovb3liLBiaW5kaW5nTGlzdOS4re+8jOW5tuS/neaMgWVudGl0eUxpc3TlkoxiaW5kaW5nTGlzdOWQjOatpeOAglxuICAgKiBAcGFyYW0gZW50aXR5TGlzdCAg5a6e5L2T5YiX6KGoXG4gICAqIEBwYXJhbSBiaW5kaW5nTGlzdCDnu5HlrprliJfooahcbiAgICovXG4gIHN0YXRpYyBsb2FkRW50aXR5TGlzdChlbnRpdHlMaXN0OiBFbnRpdHlMaXN0PGFueT4sIGJpbmRpbmdMaXN0OiBCaW5kaW5nTGlzdCkge1xuICAgIHRoaXMubG9hZEVudGl0aWVzKGVudGl0eUxpc3QuaXRlbXMsIGJpbmRpbmdMaXN0KTtcblxuICAgIHRoaXMuc2V0VXBFbnRpdHlMaXN0UGlwZWxpbmUoZW50aXR5TGlzdCwgYmluZGluZ0xpc3QpO1xuICB9XG5cbiAgLyoqXG4gICAqIOW7uueri2VudGl0eUxpc3TlkoxiaW5kaW5nTGlzdOS5i+mXtOeahOWFs+iBlFxuICAgKiBAcGFyYW0gZW50aXR5TGlzdCAg5a6e5L2T5YiX6KGoXG4gICAqIEBwYXJhbSBiaW5kaW5nTGlzdCDnu5HlrprliJfooahcbiAgICovXG4gIHN0YXRpYyBzZXRVcEVudGl0eUxpc3RQaXBlbGluZShlbnRpdHlMaXN0OiBFbnRpdHlMaXN0PGFueT4sIGJpbmRpbmdMaXN0OiBCaW5kaW5nTGlzdCkge1xuXG4gICAgZW50aXR5TGlzdC5vbkxpc3RDaGFuZ2VkLnN1YnNjcmliZSgobW9kaWZpY2F0aW9uOiBNb2RpZmljYXRpb24pID0+IHtcbiAgICAgIHN3aXRjaCAobW9kaWZpY2F0aW9uLnR5cGUpIHtcbiAgICAgICAgLy8g5re75Yqg5a6e5L2TXG4gICAgICAgIGNhc2UgTW9kaWZ5VHlwZS5BZGQ6XG4gICAgICAgIGNhc2UgTW9kaWZ5VHlwZS5DbG9uZTpcbiAgICAgICAgICB7XG4gICAgICAgICAgICBjb25zdCBlbnRpdGllc1RvQWRkID0gPEVudGl0eVtdPm1vZGlmaWNhdGlvbi52YWx1ZTtcbiAgICAgICAgICAgIGlmIChlbnRpdGllc1RvQWRkLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyDmo4Dmn6XniLZpZOaYr+WQpuS4gOiHtO+8jOWGkuazoeWvvOiHtOeahOWPmOabtOS4jeWkhOeQhlxuICAgICAgICAgICAgY29uc3QgcGF0aHMgPSBtb2RpZmljYXRpb24ucGF0aDtcbiAgICAgICAgICAgIGNvbnN0IHBhcmVudFBhdGggPSBwYXRoc1twYXRocy5sZW5ndGggLSAyXTtcbiAgICAgICAgICAgIGNvbnN0IHBhcmVudElkID0gYmluZGluZ0xpc3QucGFyZW50LnByaW1hcnlLZXlWYWx1ZTtcbiAgICAgICAgICAgIGlmIChwYXJlbnRQYXRoLmluZGV4T2YocGFyZW50SWQpID09PSAtMSkge1xuICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMuYXBwZW5kRW50aXRpZXMoPEVudGl0eVtdPm1vZGlmaWNhdGlvbi52YWx1ZSwgYmluZGluZ0xpc3QsIG1vZGlmaWNhdGlvbi50eXBlID09PSBNb2RpZnlUeXBlLkNsb25lKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgTW9kaWZ5VHlwZS5JbnNlcnQ6XG4gICAgICAgICAge1xuICAgICAgICAgICAgLy8g5qOA5p+l54i2aWTmmK/lkKbkuIDoh7TvvIzlhpLms6Hlr7zoh7TnmoTlj5jmm7TkuI3lpITnkIZcbiAgICAgICAgICAgIGNvbnN0IHBhdGhzID0gbW9kaWZpY2F0aW9uLnBhdGg7XG4gICAgICAgICAgICBjb25zdCBwYXJlbnRQYXRoID0gcGF0aHNbcGF0aHMubGVuZ3RoIC0gMl07XG4gICAgICAgICAgICBjb25zdCBwYXJlbnRJZCA9IGJpbmRpbmdMaXN0LnBhcmVudC5wcmltYXJ5S2V5VmFsdWU7XG4gICAgICAgICAgICBjb25zdCBwb3NpdGlvbiA9IG1vZGlmaWNhdGlvbi5wb3NpdGlvbjtcbiAgICAgICAgICAgIGlmIChwYXJlbnRQYXRoLmluZGV4T2YocGFyZW50SWQpID09PSAtMSkge1xuICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLmluc2VydEVudGl0eShtb2RpZmljYXRpb24udmFsdWVbMF0sIGJpbmRpbmdMaXN0LCBwb3NpdGlvbik7XG4gICAgICAgICAgfVxuICAgICAgICAgIGJyZWFrO1xuICAgICAgICAvLyDliKDpmaTlrp7kvZNcbiAgICAgICAgY2FzZSBNb2RpZnlUeXBlLlJlbW92ZTpcbiAgICAgICAgICB7XG4gICAgICAgICAgICAvLyDliKDpmaTlrp7kvZPvvIh2YWx1ZeagvOW8j+W+heWVhuamt++8jOebruWJjXZhbHVl55qE5qC85byP5Li6IHsgcHJpbWFyeUtleTogcHJpbWFyeVZhbHVlfe+8iVxuICAgICAgICAgICAgY29uc3QgaWQgPSBtb2RpZmljYXRpb24udmFsdWVbYmluZGluZ0xpc3QucHJpbWFyeUtleV07XG4gICAgICAgICAgICBiaW5kaW5nTGlzdC5yZW1vdmVCeUlkcyhbaWRdKTtcbiAgICAgICAgICAgIC8vIHRoaXMucmVtb3ZlRW50aXRpZXMoPEVudGl0eVtdPm1vZGlmaWNhdGlvbi52YWx1ZSwgYmluZGluZ0xpc3QpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBicmVhaztcblxuICAgICAgICAvLyDliqDovb3lrp7kvZNcbiAgICAgICAgY2FzZSBNb2RpZnlUeXBlLkxvYWQ6XG4gICAgICAgICAgY29uc3QgZW50aXRpZXMgPSBtb2RpZmljYXRpb24udmFsdWU7XG4gICAgICAgICAgdGhpcy5sb2FkRW50aXRpZXMoZW50aXRpZXMsIGJpbmRpbmdMaXN0KTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiDnm5HlkKxyZXBvc2l0b3J55Y+Y5YyW77yM5L+d5oyBcmVwb3NpdG9yeeWSjGJpbmRpbmdMaXN05ZCM5q2l44CCXG4gICAqIEBwYXJhbSByZXBvc2l0b3J5ICDlrp7kvZPku5PlupNcbiAgICogQHBhcmFtIGJpbmRpbmdMaXN0IOe7keWumuWIl+ihqFxuICAgKi9cbiAgc3RhdGljIGxvYWRSZXBvc2l0b3J5KHJlcG9zaXRvcnk6IFJlcG9zaXRvcnk8YW55PiwgYmluZGluZ0xpc3Q6IEJpbmRpbmdMaXN0KSB7XG5cbiAgICAvLyDliJ3mrKHliqDovb1cbiAgICBjb25zdCBlbnRpdGllcyA9IEFycmF5LmZyb20ocmVwb3NpdG9yeS5lbnRpdHlDb2xsZWN0aW9uLnRvQXJyYXkoKSk7XG4gICAgdGhpcy5sb2FkRW50aXRpZXMoZW50aXRpZXMsIGJpbmRpbmdMaXN0KTtcblxuICAgIC8vIOebkeWQrOWPmOWMllxuICAgIHJlcG9zaXRvcnkuZW50aXR5Q29sbGVjdGlvbkNoYW5nZS5zdWJzY3JpYmUoKG1vZGlmaWNhdGlvbjogTW9kaWZpY2F0aW9uKSA9PiB7XG4gICAgICBzd2l0Y2ggKG1vZGlmaWNhdGlvbi50eXBlKSB7XG4gICAgICAgIGNhc2UgTW9kaWZ5VHlwZS5Mb2FkOlxuICAgICAgICAgIHRoaXMubG9hZEVudGl0aWVzKDxFbnRpdHlbXT5tb2RpZmljYXRpb24udmFsdWUsIGJpbmRpbmdMaXN0LCBtb2RpZmljYXRpb24uZW50aXR5Q3JlYXRlKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBNb2RpZnlUeXBlLkFkZDpcbiAgICAgICAgY2FzZSBNb2RpZnlUeXBlLkNsb25lOlxuICAgICAgICAgIHRoaXMuYXBwZW5kRW50aXRpZXMoPEVudGl0eVtdPm1vZGlmaWNhdGlvbi52YWx1ZSwgYmluZGluZ0xpc3QsIG1vZGlmaWNhdGlvbi50eXBlID09PSBNb2RpZnlUeXBlLkNsb25lKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBNb2RpZnlUeXBlLkFkZERhdGE6XG4gICAgICAgICAgdGhpcy5hZGREYXRhKDxFbnRpdHlbXT5tb2RpZmljYXRpb24udmFsdWUsIGJpbmRpbmdMaXN0KTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBNb2RpZnlUeXBlLkluc2VydDpcbiAgICAgICAgICB0aGlzLmluc2VydEVudGl0eShtb2RpZmljYXRpb24udmFsdWUsIGJpbmRpbmdMaXN0LCBtb2RpZmljYXRpb24ucG9zaXRpb24pO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIE1vZGlmeVR5cGUuUmVtb3ZlOlxuICAgICAgICAgIHRoaXMucmVtb3ZlRW50aXRpZXMoPEVudGl0eVtdPm1vZGlmaWNhdGlvbi52YWx1ZSwgYmluZGluZ0xpc3QpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIE1vZGlmeVR5cGUuUmVtb3ZlRGF0YTpcbiAgICAgICAgICB0aGlzLnJlbW92ZURhdGEoPEVudGl0eVtdPm1vZGlmaWNhdGlvbi52YWx1ZSwgYmluZGluZ0xpc3QpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIE1vZGlmeVR5cGUuUGFnaW5hdGlvbkluZm9DaGFuZ2U6XG4gICAgICAgICAgYmluZGluZ0xpc3QucGFnaW5hdGlvbkluZm8gPSA8UGFnaW5hdGlvbj5tb2RpZmljYXRpb24udmFsdWU7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICAvLyDnm5HlkKxCaW5kaW5nTGlzdOaVsOaNruWPmOWMllxuICAgIGJpbmRpbmdMaXN0LmNoYW5nZXMuc3Vic2NyaWJlKChjaGFuZ2U6IENoYW5nZSkgPT4ge1xuICAgICAgaWYgKGNoYW5nZS50eXBlID09PSBDaGFuZ2VUeXBlLlBhZ2luYXRpb25JbmZvQ2hhbmdlKSB7XG4gICAgICAgIGNvbnN0IGVudGl0eUNvbGxlY3Rpb24gPSByZXBvc2l0b3J5LmVudGl0eUNvbGxlY3Rpb247XG4gICAgICAgIC8vIGNvbnN0IGVudGl0eVR5cGVOYW1lID0gZW50aXR5Q29sbGVjdGlvbi5lbnRpdHlUeXBlTmFtZTtcbiAgICAgICAgLy8gY29uc3Qgb3JpZ2luYWwgPSBlbnRpdHlDb2xsZWN0aW9uLnBhZ2luYXRpb25JbmZvW2VudGl0eVR5cGVOYW1lXTtcbiAgICAgICAgLy8gY29uc3QgZW50aXR5UGFnaW5hdGlvbkluZm8gPSBPYmplY3QuYXNzaWduKHt9LCBvcmlnaW5hbCwgY2hhbmdlLnZhbHVlKTtcbiAgICAgICAgZW50aXR5Q29sbGVjdGlvbi5wYWdpbmF0aW9uSW5mbyA9IE9iamVjdC5hc3NpZ24oe30sIGVudGl0eUNvbGxlY3Rpb24ucGFnaW5hdGlvbkluZm8sIGNoYW5nZS52YWx1ZSk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICog5bCGZW50aXRpZXPkuK3nmoRFbnRpdHnlr7nosaHovazmjaLkuLpCaW5kaW5nT2JqZWN05a+56LGh77yM5bm25Yqg6L295YiwYmluZGluZ0xpc3TkuK1cbiAgICogQHBhcmFtIGVudGl0aWVzICAgIOWunuS9k+aVsOe7hFxuICAgKiBAcGFyYW0gYmluZGluZ0xpc3Qg57uR5a6a5YiX6KGoXG4gICAqL1xuICBzdGF0aWMgbG9hZEVudGl0aWVzKGVudGl0aWVzOiBFbnRpdHlbXSwgYmluZGluZ0xpc3Q6IEJpbmRpbmdMaXN0LCBlbnRpdHlDcmVhdGU6IGJvb2xlYW4gPSBmYWxzZSkge1xuICAgIGNvbnN0IGJpbmRpbmdPYmplY3RzID0gdGhpcy5jcmVhdGVCaW5kaW5nT2JqZWN0cyhlbnRpdGllcywgYmluZGluZ0xpc3QpO1xuICAgIGJpbmRpbmdMaXN0LmxvYWQoYmluZGluZ09iamVjdHMsIGVudGl0eUNyZWF0ZSk7XG4gIH1cblxuICAvKipcbiAgICog5bCGZW50aXRpZXPkuK3nmoRFbnRpdHnlr7nosaHovazmjaLkuLpCSW5kaW5nT2JqZWN05a+56LGh77yM5bm26L+95Yqg5YiwYmluZGluZ0xpc3TkuK1cbiAgICogQHBhcmFtIGVudGl0aWVzICAgIOWunuS9k+aVsOe7hFxuICAgKiBAcGFyYW0gYmluZGluZ0xpc3Qg57uR5a6a5YiX6KGoXG4gICAqL1xuICBzdGF0aWMgYXBwZW5kRW50aXRpZXMoZW50aXRpZXM6IEVudGl0eVtdLCBiaW5kaW5nTGlzdDogQmluZGluZ0xpc3QsIGlzQ2xvbmVkOiBib29sZWFuID0gZmFsc2UpIHtcbiAgICBjb25zdCBiaW5kaW5nT2JqZWN0cyA9IHRoaXMuY3JlYXRlQmluZGluZ09iamVjdHMoZW50aXRpZXMsIGJpbmRpbmdMaXN0KTtcbiAgICBiaW5kaW5nTGlzdC5hcHBlbmQoYmluZGluZ09iamVjdHMsIGlzQ2xvbmVkKTtcbiAgfVxuICAvKipcbiAgICog5aKe5Yqg5a6e5L2T5pWw5o2u77yI5LiN5YiH5o2i5b2T5YmN6KGM77yJXG4gICAqIEBwYXJhbSBlbnRpdGllcyBcbiAgICogQHBhcmFtIGJpbmRpbmdMaXN0IFxuICAgKi9cbiAgc3RhdGljIGFkZERhdGEoZW50aXRpZXM6IEVudGl0eVtdLCBiaW5kaW5nTGlzdDogQmluZGluZ0xpc3QpIHtcbiAgICBjb25zdCBiaW5kaW5nT2JqZWN0cyA9IHRoaXMuY3JlYXRlQmluZGluZ09iamVjdHMoZW50aXRpZXMsIGJpbmRpbmdMaXN0KTtcbiAgICBiaW5kaW5nTGlzdC5hZGREYXRhKGJpbmRpbmdPYmplY3RzKTtcbiAgfVxuICBzdGF0aWMgaW5zZXJ0RW50aXR5KGVudGl0eTogRW50aXR5LCBiaW5kaW5nTGlzdDogQmluZGluZ0xpc3QsIHBvc2l0aW9uOiAtMSB8IDEpIHtcbiAgICBjb25zdCBiaW5kaW5nT2JqZWN0ID0gdGhpcy5jcmVhdGVCaW5kaW5nT2JqZWN0KGVudGl0eSwgYmluZGluZ0xpc3QpO1xuICAgIGJpbmRpbmdMaXN0Lmluc2VydChiaW5kaW5nT2JqZWN0LCBwb3NpdGlvbik7XG4gIH1cbiAgLyoqXG4gICAqIOS7jmJpbmRpbmdMaXN056e76ZmkZW50aXRpZXPlr7nlupTnmoRCaW5kaW5nT2JqZWN05a+56LGhXG4gICAqIEBwYXJhbSBlbnRpdGllcyAgICDlrp7kvZPmlbDnu4RcbiAgICogQHBhcmFtIGJpbmRpbmdMaXN0IOe7keWumuWIl+ihqFxuICAgKi9cbiAgc3RhdGljIHJlbW92ZUVudGl0aWVzKGVudGl0aWVzOiBFbnRpdHlbXSwgYmluZGluZ0xpc3Q6IEJpbmRpbmdMaXN0KSB7XG4gICAgaWYgKGVudGl0aWVzID09PSBudWxsIHx8IGVudGl0aWVzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIOW9kumbhuimgeWIoOmZpOeahGlk5pWw57uEXG4gICAgY29uc3QgcHJpbWFyeUtleSA9IGJpbmRpbmdMaXN0LnByaW1hcnlLZXk7XG4gICAgY29uc3QgaWRzID0gW107XG4gICAgZW50aXRpZXMuZm9yRWFjaCgoZW50aXR5OiBFbnRpdHkpID0+IHtcbiAgICAgIGlkcy5wdXNoKGVudGl0eVtwcmltYXJ5S2V5XSk7XG4gICAgfSk7XG4gICAgYmluZGluZ0xpc3QucmVtb3ZlQnlJZHMoaWRzKTtcbiAgfVxuICBzdGF0aWMgcmVtb3ZlRGF0YShlbnRpdGllczogRW50aXR5W10sIGJpbmRpbmdMaXN0OiBCaW5kaW5nTGlzdCkge1xuICAgIGlmIChlbnRpdGllcyA9PT0gbnVsbCB8fCBlbnRpdGllcy5sZW5ndGggPT09IDApIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgLy8g5b2S6ZuG6KaB5Yig6Zmk55qEaWTmlbDnu4RcbiAgICBjb25zdCBwcmltYXJ5S2V5ID0gYmluZGluZ0xpc3QucHJpbWFyeUtleTtcbiAgICBjb25zdCBpZHMgPSBbXTtcbiAgICBlbnRpdGllcy5mb3JFYWNoKChlbnRpdHk6IEVudGl0eSkgPT4ge1xuICAgICAgaWRzLnB1c2goZW50aXR5W3ByaW1hcnlLZXldKTtcbiAgICB9KTtcbiAgICBiaW5kaW5nTGlzdC5yZW1vdmVEYXRhQnlJZHMoaWRzKTtcbiAgfVxuICAvKipcbiAgICog5bCGZW50aXRpZXPkuK3nmoRFbnRpdHnlr7nosaHovazmjaLkuLpCaW5kaW5nT2JqZWN05a+56LGhXG4gICAqIEBwYXJhbSBlbnRpdGllcyAgICDlrp7kvZPmlbDnu4RcbiAgICogQHBhcmFtIGJpbmRpbmdMaXN0IOe7keWumuWIl+ihqFxuICAgKi9cbiAgc3RhdGljIGNyZWF0ZUJpbmRpbmdPYmplY3RzKGVudGl0aWVzOiBFbnRpdHlbXSwgYmluZGluZ0xpc3Q6IEJpbmRpbmdMaXN0KSB7XG5cbiAgICBpZiAoZW50aXRpZXMgPT09IG51bGwgfHwgZW50aXRpZXMubGVuZ3RoID09PSAwKSB7XG4gICAgICByZXR1cm4gW107XG4gICAgfVxuXG4gICAgY29uc3QgYmluZGluZ09iamVjdHMgPSBbXTtcbiAgICBlbnRpdGllcy5mb3JFYWNoKChlbnRpdHk6IEVudGl0eSkgPT4ge1xuICAgICAgY29uc3QgYmluZGluZ09iamVjdCA9IEJpbmRpbmdPYmplY3RGYWN0b3J5LmNyZWF0ZShiaW5kaW5nTGlzdC5wcm9wZXJ0aWVzKTtcbiAgICAgIGJpbmRpbmdPYmplY3RbJ19FTlRJVFlfJ10gPSBlbnRpdHk7XG4gICAgICB0aGlzLmxvYWRFbnRpdHkoZW50aXR5LCBiaW5kaW5nT2JqZWN0KTtcblxuICAgICAgLy8gLy8g5Li6YmluZGluZ09iamVjdOiuvue9rum7mOiupOWAvGluaXRpYWxEYXRh5bGe5oCnXG4gICAgICAvLyBpZiAoZW50aXR5Wydpbml0aWFsRGF0YSddKSB7XG4gICAgICAvLyAgIGJpbmRpbmdPYmplY3RbJ2luaXRpYWxEYXRhJ10gPSBlbnRpdHlbJ2luaXRpYWxEYXRhJ107XG4gICAgICAvLyB9XG5cbiAgICAgIGJpbmRpbmdPYmplY3RzLnB1c2goYmluZGluZ09iamVjdCk7XG4gICAgfSk7XG4gICAgcmV0dXJuIGJpbmRpbmdPYmplY3RzO1xuICB9XG4gIHN0YXRpYyBjcmVhdGVCaW5kaW5nT2JqZWN0KGVudGl0eTogRW50aXR5LCBiaW5kaW5nTGlzdDogQmluZGluZ0xpc3QpIHtcbiAgICBjb25zdCBiaW5kaW5nT2JqZWN0ID0gQmluZGluZ09iamVjdEZhY3RvcnkuY3JlYXRlKGJpbmRpbmdMaXN0LnByb3BlcnRpZXMpO1xuICAgIHRoaXMubG9hZEVudGl0eShlbnRpdHksIGJpbmRpbmdPYmplY3QpO1xuICAgIHJldHVybiBiaW5kaW5nT2JqZWN0O1xuICB9XG4gIHB1YmxpYyBzdGF0aWMgd2F0Y2hSZXBvc2lyb3R5KHJlcG9zaXRvcnk6IFJlcG9zaXRvcnk8YW55PiwgYmluZGluZ0RhdGE6IEJpbmRpbmdEYXRhKSB7XG4gICAgLy8gcmVwb3Npcm90eSA9PiBiaW5kaW5nRGF0YVxuICAgIHJlcG9zaXRvcnkuZW50aXR5Q29sbGVjdGlvbkNoYW5nZS5zdWJzY3JpYmUoKG1vZGlmaWNhdGlvbjogTW9kaWZpY2F0aW9uKSA9PiB7XG4gICAgICBzd2l0Y2ggKG1vZGlmaWNhdGlvbi50eXBlKSB7XG4gICAgICAgIGNhc2UgTW9kaWZ5VHlwZS5QYWdpbmF0aW9uSW5mb0NoYW5nZTpcbiAgICAgICAgICBiaW5kaW5nRGF0YS5wYWdpbmdJbmZvID0gbW9kaWZpY2F0aW9uLnZhbHVlO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG4gIC8qKlxuICAgKiDmn6Xmib7lsZ7mgKfnmoTnsbvlnotcbiAgICogQHBhcmFtIGVudGl0eVR5cGUg5a6e5L2T57G75Z6LXG4gICAqIEBwYXJhbSB0YXJnZXRQcm9wTmFtZSDlsZ7mgKflkI3np7BcbiAgICogQHJldHVybiDlsZ7mgKfkv6Hmga/vvIzljIXlkKvlsZ7mgKfnsbvlnovvvIhOZ0ZpZWxk44CBTmdPYmplY3TjgIFOZ0xpc3TvvInlkozlsZ7mgKflr7nlupTnmoTlrp7kvZPnsbvlnovvvIjlvZNOZ0ZpZWxk57G75Z6L5pe25Li6bnVsbO+8iVxuICAgKi9cbiAgc3RhdGljIGdldFByb3BJbmZvKGVudGl0eVR5cGU6IGFueSwgdGFyZ2V0UHJvcE5hbWU6IHN0cmluZyk6IHsgcHJvcFR5cGU6IHN0cmluZywgcHJvcEVudGl0eVR5cGU6IGFueSB9IHtcblxuICAgIGxldCBwcm9wVHlwZTogc3RyaW5nO1xuICAgIGxldCBwcm9wRW50aXR5VHlwZTogYW55O1xuXG4gICAgLy8gTmdGaWVsZFxuICAgIGNvbnN0IG5nRmllbGRQcm9wZXJ0aWVzID0gRmllbGRNZXRhZGF0YVV0aWwuZ2V0TmdGaWVsZHMoZW50aXR5VHlwZSk7XG4gICAgT2JqZWN0LmtleXMobmdGaWVsZFByb3BlcnRpZXMpLmZvckVhY2goKHByb3BOYW1lOiBzdHJpbmcpID0+IHtcbiAgICAgIGlmIChwcm9wTmFtZSA9PT0gdGFyZ2V0UHJvcE5hbWUpIHtcbiAgICAgICAgcHJvcFR5cGUgPSAnTmdGaWVsZCc7XG4gICAgICAgIHByb3BFbnRpdHlUeXBlID0gbnVsbDtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIC8vIE5nT2JqZWN0XG4gICAgY29uc3QgbmdPYmplY3RQcm9wZXJ0aWVzID0gRmllbGRNZXRhZGF0YVV0aWwuZ2V0TmdPYmplY3RzKGVudGl0eVR5cGUpO1xuICAgIE9iamVjdC5rZXlzKG5nT2JqZWN0UHJvcGVydGllcykuZm9yRWFjaCgocHJvcE5hbWU6IHN0cmluZykgPT4ge1xuICAgICAgaWYgKHByb3BOYW1lID09PSB0YXJnZXRQcm9wTmFtZSkge1xuICAgICAgICBwcm9wVHlwZSA9ICdOZ09iamVjdCc7XG4gICAgICAgIHByb3BFbnRpdHlUeXBlID0gbmdPYmplY3RQcm9wZXJ0aWVzW3Byb3BOYW1lXS50eXBlO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgLy8gTmdMaXN0XG4gICAgY29uc3QgbmdMaXN0UHJvcGVydGllcyA9IEZpZWxkTWV0YWRhdGFVdGlsLmdldE5nTGlzdChlbnRpdHlUeXBlKTtcbiAgICBPYmplY3Qua2V5cyhuZ0xpc3RQcm9wZXJ0aWVzKS5mb3JFYWNoKChwcm9wTmFtZTogc3RyaW5nKSA9PiB7XG4gICAgICBpZiAocHJvcE5hbWUgPT09IHRhcmdldFByb3BOYW1lKSB7XG4gICAgICAgIHByb3BUeXBlID0gJ05nTGlzdCc7XG4gICAgICAgIHByb3BFbnRpdHlUeXBlID0gbmdMaXN0UHJvcGVydGllc1twcm9wTmFtZV0udHlwZTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIGNvbnN0IG5nRHluYW1pY1Byb3BlcnRpZXMgPSBGaWVsZE1ldGFkYXRhVXRpbC5nZXROZ0R5bmFtaWMoZW50aXR5VHlwZSk7XG4gICAgT2JqZWN0LmtleXMobmdEeW5hbWljUHJvcGVydGllcykuZm9yRWFjaCgocHJvcE5hbWU6IHN0cmluZykgPT4ge1xuICAgICAgaWYgKHByb3BOYW1lID09PSB0YXJnZXRQcm9wTmFtZSkge1xuICAgICAgICBwcm9wVHlwZSA9ICdOZ0R5bmFtaWMnO1xuICAgICAgICBwcm9wRW50aXR5VHlwZSA9IG5nRHluYW1pY1Byb3BlcnRpZXNbcHJvcE5hbWVdLnR5cGU7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICByZXR1cm4geyBwcm9wVHlwZSwgcHJvcEVudGl0eVR5cGUgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiDojrflj5blrp7kvZPnmoTkuLvplK7lkI1cbiAgICogQHBhcmFtIGVudGl0eVR5cGUg5a6e5L2T57G75Z6LXG4gICAqL1xuICBzdGF0aWMgZ2V0UHJpbWFyeUtleShlbnRpdHlUeXBlOiBhbnkpIHtcbiAgICBjb25zdCBwcmltYXJ5TmdGaWxlZFByb3AgPSBGaWVsZE1ldGFkYXRhVXRpbC5nZXRQcmltYXJ5RmllbGRNZXRhZGF0YShlbnRpdHlUeXBlKTtcbiAgICBpZiAocHJpbWFyeU5nRmlsZWRQcm9wKSB7XG4gICAgICByZXR1cm4gcHJpbWFyeU5nRmlsZWRQcm9wLmRhdGFGaWVsZDtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuICcnO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiDmmK/lkKbkuLrlr7nosaHlsZ7mgKdcbiAgICovXG4gIHN0YXRpYyBpc09iamVjdFByb3AoZW50aXR5VHlwZTogYW55LCB0YXJnZXRQcm9wTmFtZTogc3RyaW5nLCkge1xuICAgIGxldCBpc09iamVjdFByb3AgPSBmYWxzZTtcbiAgICBjb25zdCBuZ09iamVjdFByb3BlcnRpZXMgPSBGaWVsZE1ldGFkYXRhVXRpbC5nZXROZ09iamVjdHMoZW50aXR5VHlwZSk7XG4gICAgT2JqZWN0LmtleXMobmdPYmplY3RQcm9wZXJ0aWVzKS5mb3JFYWNoKChwcm9wTmFtZTogc3RyaW5nKSA9PiB7XG4gICAgICBpZiAocHJvcE5hbWUgPT09IHRhcmdldFByb3BOYW1lKSB7XG4gICAgICAgIGlzT2JqZWN0UHJvcCA9IHRydWU7XG4gICAgICB9XG4gICAgfSk7XG4gICAgcmV0dXJuIGlzT2JqZWN0UHJvcDtcbiAgfVxuXG4gIC8qKlxuICAgKiDmo4Dmn6XmmK/lkKbmmK/liqjmgIHliJflsZ7mgKdcbiAgICovXG4gIHN0YXRpYyBpc0R5bmFtaWNQcm9wKGVudGl0eVR5cGU6IGFueSwgdGFyZ2V0UHJvcE5hbWU6IHN0cmluZykge1xuICAgIGxldCBpc0R5bmFtaWNQcm9wID0gZmFsc2U7XG4gICAgY29uc3QgbmdEeW5hbWljUHJvcGVydGllcyA9IEZpZWxkTWV0YWRhdGFVdGlsLmdldE5nRHluYW1pYyhlbnRpdHlUeXBlKTtcbiAgICBPYmplY3Qua2V5cyhuZ0R5bmFtaWNQcm9wZXJ0aWVzKS5mb3JFYWNoKChwcm9wTmFtZTogc3RyaW5nKSA9PiB7XG4gICAgICBpZiAocHJvcE5hbWUgPT09IHRhcmdldFByb3BOYW1lKSB7XG4gICAgICAgIGlzRHluYW1pY1Byb3AgPSB0cnVlO1xuICAgICAgfVxuICAgIH0pO1xuICAgIHJldHVybiBpc0R5bmFtaWNQcm9wO1xuICB9XG5cbiAgLyoqXG4gICAqIOS4uuWunuS9k+WinuWKoGluaXRpYWxEYXRh5bGe5oCnXG4gICAqIEBwYXJhbSBlbnRpdHkg5a6e5L2T5a6e5L6LXG4gICAqIEBwYXJhbSBpbml0aWFsRGF0YSDpu5jorqTlgLzlr7nosaFcbiAgICovXG4gIHN0YXRpYyBhcHBlbmRJbml0aWFsRGF0YShlbnRpdHksIGluaXRpYWxEYXRhKSB7XG4gICAgY29uc3QgZGF0YSA9IE9iamVjdC5hc3NpZ24oe30sIGluaXRpYWxEYXRhKTtcbiAgICBkZWxldGUgZGF0YS5pZDtcbiAgICBkZWxldGUgZGF0YS5wYXJlbnRJRDtcbiAgICBlbnRpdHlbJ2luaXRpYWxEYXRhJ10gPSBkYXRhO1xuICB9XG59XG5cbmV4cG9ydCB7IEVudGl0eVV0aWwgfTtcbiJdfQ==
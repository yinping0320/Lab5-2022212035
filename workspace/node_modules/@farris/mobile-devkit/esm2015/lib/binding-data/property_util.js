import { FieldMetadataUtil } from '../entity/index';
import { BindingPropertyType } from './binding_property';
/**
 * 属性工具类
 */
class PropertyUtil {
    /**
     * 获取实体上的属性集合，并将他们转换成BindingProperty集合
     * @param  entityType 实体类型
     * @returns 绑定属性集合
     */
    static getProperties(entityType) {
        const properties = [];
        // Plain
        const ngFieldProperties = FieldMetadataUtil.getNgFields(entityType);
        Object.keys(ngFieldProperties).forEach((propertyName) => {
            const ngFieldProperty = ngFieldProperties[propertyName];
            properties.push({
                name: propertyName,
                type: BindingPropertyType.Plain,
                isPrimaryKey: ngFieldProperty.primary,
                isForeignKey: ngFieldProperty.foreign,
                enableMultiLangInput: ngFieldProperty.enableMultiLangInput
            });
        });
        // Object
        const ngObjectProperties = FieldMetadataUtil.getNgObjects(entityType);
        Object.keys(ngObjectProperties).forEach((propertyName) => {
            const ngObjectProperty = ngObjectProperties[propertyName];
            properties.push({
                name: propertyName,
                type: BindingPropertyType.Object,
                entityType: ngObjectProperty.type
            });
        });
        // List
        const ngListProperties = FieldMetadataUtil.getNgList(entityType);
        Object.keys(ngListProperties).forEach((propertyName) => {
            const ngListProperty = ngListProperties[propertyName];
            properties.push({
                name: propertyName,
                type: BindingPropertyType.List,
                entityType: ngListProperty.type
            });
        });
        // Dynamics
        const ngDynamicProperties = FieldMetadataUtil.getNgDynamic(entityType);
        Object.keys(ngDynamicProperties).forEach((propertyName) => {
            const ngDynamicProperty = ngDynamicProperties[propertyName];
            properties.push({
                name: propertyName,
                type: BindingPropertyType.Dynamic,
                entityType: ngDynamicProperty.type
            });
        });
        return properties;
    }
    static getDynamicProperties(dynamicData) {
        const properties = [];
        Object.keys(dynamicData).forEach((propertyName) => {
            if (dynamicData.hasOwnProperty(propertyName)) {
                if (dynamicData[propertyName] instanceof Object) {
                    properties.push({
                        name: propertyName,
                        type: BindingPropertyType.Dynamic,
                        entityType: null
                    });
                }
                else {
                    properties.push({
                        name: propertyName,
                        type: BindingPropertyType.Plain,
                        isPrimaryKey: false,
                        isForeignKey: false
                    });
                }
            }
        });
        return properties;
    }
    /**
     * 根据属性名获取属性
     */
    static getPropertyByName(properties, propertyName) {
        const targetProperty = properties.find((property) => {
            return property.name === propertyName;
        });
        return targetProperty;
    }
    /**
     * 获取实体主键名
     * @param properties 属性集合
     * @returns 主键名
     */
    static getPrimaryKey(properties) {
        // 实体必须有主键，如果没有主键在构造实体的时候就已经报错，这里不需要再进行检查
        const primaryProperty = properties.find((property) => {
            return property.isPrimaryKey === true;
        });
        return primaryProperty ? primaryProperty.name : '';
    }
}
export { PropertyUtil };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHJvcGVydHlfdXRpbC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvbW9iaWxlLWRldmtpdC8iLCJzb3VyY2VzIjpbImxpYi9iaW5kaW5nLWRhdGEvcHJvcGVydHlfdXRpbC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFDQSxPQUFPLEVBQVUsaUJBQWlCLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUM1RCxPQUFPLEVBQW1CLG1CQUFtQixFQUFFLE1BQU0sb0JBQW9CLENBQUM7QUFFMUU7O0dBRUc7QUFDSCxNQUFNLFlBQVk7SUFFaEI7Ozs7T0FJRztJQUNILE1BQU0sQ0FBQyxhQUFhLENBQUMsVUFBd0I7UUFDM0MsTUFBTSxVQUFVLEdBQUcsRUFBRSxDQUFDO1FBRXRCLFFBQVE7UUFDUixNQUFNLGlCQUFpQixHQUFHLGlCQUFpQixDQUFDLFdBQVcsQ0FBQyxVQUFVLENBQUMsQ0FBQztRQUNwRSxNQUFNLENBQUMsSUFBSSxDQUFDLGlCQUFpQixDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsWUFBb0IsRUFBRSxFQUFFO1lBQzlELE1BQU0sZUFBZSxHQUFHLGlCQUFpQixDQUFDLFlBQVksQ0FBQyxDQUFDO1lBQ3hELFVBQVUsQ0FBQyxJQUFJLENBQUM7Z0JBQ2QsSUFBSSxFQUFFLFlBQVk7Z0JBQ2xCLElBQUksRUFBRSxtQkFBbUIsQ0FBQyxLQUFLO2dCQUMvQixZQUFZLEVBQUUsZUFBZSxDQUFDLE9BQU87Z0JBQ3JDLFlBQVksRUFBRSxlQUFlLENBQUMsT0FBTztnQkFDckMsb0JBQW9CLEVBQUUsZUFBZSxDQUFDLG9CQUFvQjthQUMzRCxDQUFDLENBQUM7UUFDTCxDQUFDLENBQUMsQ0FBQztRQUVILFNBQVM7UUFDVCxNQUFNLGtCQUFrQixHQUFHLGlCQUFpQixDQUFDLFlBQVksQ0FBQyxVQUFVLENBQUMsQ0FBQztRQUN0RSxNQUFNLENBQUMsSUFBSSxDQUFDLGtCQUFrQixDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsWUFBb0IsRUFBRSxFQUFFO1lB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QUFFLEVBQUU7WUFDcEUsT0FBTyxRQUFRLENBQUMsWUFBWSxLQUFLLElBQUksQ0FBQztRQUN4QyxDQUFDLENBQUMsQ0FBQztRQUNILE9BQU8sZUFBZSxDQUFDLENBQUMsQ0FBQyxlQUFlLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUM7SUFDckQsQ0FBQztDQUVGO0FBRUQsT0FBTyxFQUFFLFlBQVksRUFBRSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtUeXBlfSBmcm9tICcuLi9jb3JlL2luZGV4JztcbmltcG9ydCB7IEVudGl0eSwgRmllbGRNZXRhZGF0YVV0aWwgfSBmcm9tICcuLi9lbnRpdHkvaW5kZXgnO1xuaW1wb3J0IHsgQmluZGluZ1Byb3BlcnR5LCBCaW5kaW5nUHJvcGVydHlUeXBlIH0gZnJvbSAnLi9iaW5kaW5nX3Byb3BlcnR5JztcblxuLyoqXG4gKiDlsZ7mgKflt6XlhbfnsbtcbiAqL1xuY2xhc3MgUHJvcGVydHlVdGlsIHtcblxuICAvKipcbiAgICog6I635Y+W5a6e5L2T5LiK55qE5bGe5oCn6ZuG5ZCI77yM5bm25bCG5LuW5Lus6L2s5o2i5oiQQmluZGluZ1Byb3BlcnR56ZuG5ZCIXG4gICAqIEBwYXJhbSAgZW50aXR5VHlwZSDlrp7kvZPnsbvlnotcbiAgICogQHJldHVybnMg57uR5a6a5bGe5oCn6ZuG5ZCIXG4gICAqL1xuICBzdGF0aWMgZ2V0UHJvcGVydGllcyhlbnRpdHlUeXBlOiBUeXBlPEVudGl0eT4pOiBCaW5kaW5nUHJvcGVydHlbXSB7XG4gICAgY29uc3QgcHJvcGVydGllcyA9IFtdO1xuXG4gICAgLy8gUGxhaW5cbiAgICBjb25zdCBuZ0ZpZWxkUHJvcGVydGllcyA9IEZpZWxkTWV0YWRhdGFVdGlsLmdldE5nRmllbGRzKGVudGl0eVR5cGUpO1xuICAgIE9iamVjdC5rZXlzKG5nRmllbGRQcm9wZXJ0aWVzKS5mb3JFYWNoKChwcm9wZXJ0eU5hbWU6IHN0cmluZykgPT4ge1xuICAgICAgY29uc3QgbmdGaWVsZFByb3BlcnR5ID0gbmdGaWVsZFByb3BlcnRpZXNbcHJvcGVydHlOYW1lXTtcbiAgICAgIHByb3BlcnRpZXMucHVzaCh7XG4gICAgICAgIG5hbWU6IHByb3BlcnR5TmFtZSxcbiAgICAgICAgdHlwZTogQmluZGluZ1Byb3BlcnR5VHlwZS5QbGFpbixcbiAgICAgICAgaXNQcmltYXJ5S2V5OiBuZ0ZpZWxkUHJvcGVydHkucHJpbWFyeSxcbiAgICAgICAgaXNGb3JlaWduS2V5OiBuZ0ZpZWxkUHJvcGVydHkuZm9yZWlnbixcbiAgICAgICAgZW5hYmxlTXVsdGlMYW5nSW5wdXQ6IG5nRmllbGRQcm9wZXJ0eS5lbmFibGVNdWx0aUxhbmdJbnB1dFxuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICAvLyBPYmplY3RcbiAgICBjb25zdCBuZ09iamVjdFByb3BlcnRpZXMgPSBGaWVsZE1ldGFkYXRhVXRpbC5nZXROZ09iamVjdHMoZW50aXR5VHlwZSk7XG4gICAgT2JqZWN0LmtleXMobmdPYmplY3RQcm9wZXJ0aWVzKS5mb3JFYWNoKChwcm9wZXJ0eU5hbWU6IHN0cmluZykgPT4ge1xuICAgICAgY29uc3QgbmdPYmplY3RQcm9wZXJ0eSA9IG5nT2JqZWN0UHJvcGVydGllc1twcm9wZXJ0eU5hbWVdO1xuICAgICAgcHJvcGVydGllcy5wdXNoKHtcbiAgICAgICAgbmFtZTogcHJvcGVydHlOYW1lLFxuICAgICAgICB0eXBlOiBCaW5kaW5nUHJvcGVydHlUeXBlLk9iamVjdCxcbiAgICAgICAgZW50aXR5VHlwZTogbmdPYmplY3RQcm9wZXJ0eS50eXBlXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIC8vIExpc3RcbiAgICBjb25zdCBuZ0xpc3RQcm9wZXJ0aWVzID0gRmllbGRNZXRhZGF0YVV0aWwuZ2V0TmdMaXN0KGVudGl0eVR5cGUpO1xuICAgIE9iamVjdC5rZXlzKG5nTGlzdFByb3BlcnRpZXMpLmZvckVhY2goKHByb3BlcnR5TmFtZTogc3RyaW5nKSA9PiB7XG4gICAgICBjb25zdCBuZ0xpc3RQcm9wZXJ0eSA9IG5nTGlzdFByb3BlcnRpZXNbcHJvcGVydHlOYW1lXTtcbiAgICAgIHByb3BlcnRpZXMucHVzaCh7XG4gICAgICAgIG5hbWU6IHByb3BlcnR5TmFtZSxcbiAgICAgICAgdHlwZTogQmluZGluZ1Byb3BlcnR5VHlwZS5MaXN0LFxuICAgICAgICBlbnRpdHlUeXBlOiBuZ0xpc3RQcm9wZXJ0eS50eXBlXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIC8vIER5bmFtaWNzXG4gICAgY29uc3QgbmdEeW5hbWljUHJvcGVydGllcyA9IEZpZWxkTWV0YWRhdGFVdGlsLmdldE5nRHluYW1pYyhlbnRpdHlUeXBlKTtcbiAgICBPYmplY3Qua2V5cyhuZ0R5bmFtaWNQcm9wZXJ0aWVzKS5mb3JFYWNoKChwcm9wZXJ0eU5hbWU6IHN0cmluZykgPT4ge1xuICAgICAgY29uc3QgbmdEeW5hbWljUHJvcGVydHkgPSBuZ0R5bmFtaWNQcm9wZXJ0aWVzW3Byb3BlcnR5TmFtZV07XG4gICAgICBwcm9wZXJ0aWVzLnB1c2goe1xuICAgICAgICBuYW1lOiBwcm9wZXJ0eU5hbWUsXG4gICAgICAgIHR5cGU6IEJpbmRpbmdQcm9wZXJ0eVR5cGUuRHluYW1pYyxcbiAgICAgICAgZW50aXR5VHlwZTogbmdEeW5hbWljUHJvcGVydHkudHlwZVxuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICByZXR1cm4gcHJvcGVydGllcztcbiAgfVxuXG4gIHN0YXRpYyBnZXREeW5hbWljUHJvcGVydGllcyhkeW5hbWljRGF0YTogYW55KTogQmluZGluZ1Byb3BlcnR5W10ge1xuICAgIGNvbnN0IHByb3BlcnRpZXMgPSBbXTtcbiAgICBPYmplY3Qua2V5cyhkeW5hbWljRGF0YSkuZm9yRWFjaCgocHJvcGVydHlOYW1lOiBzdHJpbmcpID0+IHtcbiAgICAgIGlmIChkeW5hbWljRGF0YS5oYXNPd25Qcm9wZXJ0eShwcm9wZXJ0eU5hbWUpKSB7XG4gICAgICAgIGlmIChkeW5hbWljRGF0YVtwcm9wZXJ0eU5hbWVdIGluc3RhbmNlb2YgT2JqZWN0KSB7XG4gICAgICAgICAgcHJvcGVydGllcy5wdXNoKHtcbiAgICAgICAgICAgIG5hbWU6IHByb3BlcnR5TmFtZSxcbiAgICAgICAgICAgIHR5cGU6IEJpbmRpbmdQcm9wZXJ0eVR5cGUuRHluYW1pYyxcbiAgICAgICAgICAgIGVudGl0eVR5cGU6IG51bGxcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBwcm9wZXJ0aWVzLnB1c2goe1xuICAgICAgICAgICAgbmFtZTogcHJvcGVydHlOYW1lLFxuICAgICAgICAgICAgdHlwZTogQmluZGluZ1Byb3BlcnR5VHlwZS5QbGFpbixcbiAgICAgICAgICAgIGlzUHJpbWFyeUtleTogZmFsc2UsXG4gICAgICAgICAgICBpc0ZvcmVpZ25LZXk6IGZhbHNlXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcbiAgICByZXR1cm4gcHJvcGVydGllcztcbiAgfVxuICAvKipcbiAgICog5qC55o2u5bGe5oCn5ZCN6I635Y+W5bGe5oCnXG4gICAqL1xuICBzdGF0aWMgZ2V0UHJvcGVydHlCeU5hbWUocHJvcGVydGllczogQmluZGluZ1Byb3BlcnR5W10sIHByb3BlcnR5TmFtZTogc3RyaW5nKTogQmluZGluZ1Byb3BlcnR5IHtcbiAgICBjb25zdCB0YXJnZXRQcm9wZXJ0eSA9ICBwcm9wZXJ0aWVzLmZpbmQoKHByb3BlcnR5OiBCaW5kaW5nUHJvcGVydHkpID0+IHtcbiAgICAgIHJldHVybiBwcm9wZXJ0eS5uYW1lID09PSBwcm9wZXJ0eU5hbWU7XG4gICAgfSk7XG4gICAgcmV0dXJuIHRhcmdldFByb3BlcnR5O1xuICB9XG5cbiAgLyoqXG4gICAqIOiOt+WPluWunuS9k+S4u+mUruWQjVxuICAgKiBAcGFyYW0gcHJvcGVydGllcyDlsZ7mgKfpm4blkIhcbiAgICogQHJldHVybnMg5Li76ZSu5ZCNXG4gICAqL1xuICBzdGF0aWMgZ2V0UHJpbWFyeUtleShwcm9wZXJ0aWVzOiBCaW5kaW5nUHJvcGVydHlbXSk6IHN0cmluZyB7XG5cbiAgICAvLyDlrp7kvZPlv4XpobvmnInkuLvplK7vvIzlpoLmnpzmsqHmnInkuLvplK7lnKjmnoTpgKDlrp7kvZPnmoTml7blgJnlsLHlt7Lnu4/miqXplJnvvIzov5nph4zkuI3pnIDopoHlho3ov5vooYzmo4Dmn6VcbiAgICBjb25zdCBwcmltYXJ5UHJvcGVydHkgPSBwcm9wZXJ0aWVzLmZpbmQoKHByb3BlcnR5OiBCaW5kaW5nUHJvcGVydHkpID0+IHtcbiAgICAgIHJldHVybiBwcm9wZXJ0eS5pc1ByaW1hcnlLZXkgPT09IHRydWU7XG4gICAgfSk7XG4gICAgcmV0dXJuIHByaW1hcnlQcm9wZXJ0eSA/IHByaW1hcnlQcm9wZXJ0eS5uYW1lIDogJyc7XG4gIH1cblxufVxuXG5leHBvcnQgeyBQcm9wZXJ0eVV0aWwgfTtcbiJdfQ==
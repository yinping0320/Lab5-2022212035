/**
 * 绑定对象工厂相关定义
 * @author Witt<jiwt@inspur.com>
 */
import { PropertyUtil } from './property_util';
import { BindingPropertyType } from './binding_property';
import { BindingObject } from './binding_object';
import { BindingListFactory } from './binding_list_factory';
/**
 * BindingObject工厂用于创建一个空的BindingObject对象，并对其属性进行扩展。
 *
 * **扩展属性处理**
 *
 * 对于要扩展的属性（BindingProperty）有三种处理：
 * - 普通属性：初始化为一个undefined，并包装get、set方法，通过set方法监听变更；
 * - 对象属性：初始化为一个空的BindingObject对象，并监听子对象的变更；
 * - 列表属性：初始化为一个空的BindingList对象，并监听子列表的变更；
 *
 * **示例代码**
 *
 * ```ts
 *  const empProperties = PropertyUtil.getProperties(EmpEntity);
 * const empBindingObject = BindingObjectFactory.create(properties);
 * ```
 */
class BindingObjectFactory {
    /**
     * 创建BindingObject实例
     * @param properties 要扩展的属性集合
     * @returns 带扩展属性的空BindingObject对象
     * @
     */
    static create(properties) {
        const object = new BindingObject(properties);
        this.extendProperties(object, properties);
        return object;
    }
    static createDynamicBindingObject(data) {
        const properties = PropertyUtil.getDynamicProperties(data);
        const object = new BindingObject(properties);
        this.extendProperties(object, properties);
        return object;
    }
    /**
     * 扩展属性绑定对象的属性
     * @param object     要扩展的绑定对象
     * @param properties 绑定属性集合
     */
    static extendProperties(object, properties) {
        // 扩展BindingObject属性
        properties.forEach((property) => {
            if (property.type === BindingPropertyType.List) {
                this.extendListProperty(object, property);
            }
            else if (property.type === BindingPropertyType.Object) {
                this.extendObjectProperty(object, property);
            }
            else if (property.type === BindingPropertyType.Dynamic) {
                this.extendDynamicObjectProperty(object, property);
            }
            else {
                this.extendPlainProperty(object, property);
            }
        });
    }
    /**
     * 扩展列表类型的绑定属性
     * @param object     要扩展的绑定对象
     * @param properties 列表类型的绑定属性集合
     */
    static extendListProperty(object, property) {
        const propertyName = property.name;
        const childListProperties = PropertyUtil.getProperties(property.entityType);
        const childList = BindingListFactory.create(childListProperties);
        // 指定子List的parent、监听子List的changes事件
        childList.parent = object;
        childList.changes.subscribe((change) => {
            change.path.unshift(propertyName);
            object.changes.next(change);
        });
        // 将子的BindingList实例赋值给当前属性
        Object.defineProperty(object, propertyName, {
            value: childList
        });
    }
    /**
     * 扩展对象类型的绑定属性
     * @param object     要扩展的绑定对象
     * @param properties 对象类型的绑定属性集合
     */
    static extendObjectProperty(object, property) {
        const propertyName = property.name;
        const childObjectProperties = PropertyUtil.getProperties(property.entityType);
        const childObject = this.create(childObjectProperties);
        // 指定子Object的parent、监听子Object的changes事件
        childObject.parent = object;
        childObject.changes.subscribe((change) => {
            change.path.unshift(propertyName);
            object.changes.next(change);
        });
        Object.defineProperty(object, propertyName, {
            value: childObject
        });
    }
    static extendDynamicObjectProperty(object, property) {
        const propertyName = property.name;
        object[propertyName] = null;
    }
    static attachDynamicObjectProperty(object, propertyName, dynamicObject) {
        dynamicObject.parent = object;
        dynamicObject.changes.subscribe((change) => {
            change.path.unshift(propertyName);
            object.changes.next(change);
        });
        Object.defineProperty(object, propertyName, {
            value: dynamicObject
        });
    }
    /**
     * 扩展简单类型的绑定属性
     * @param object     要扩展的绑定对象
     * @param properties 简单类型的绑定属性集合
     */
    static extendPlainProperty(object, property) {
        const propertyName = property.name;
        Object.defineProperty(object, propertyName, {
            get: () => {
                return object.getValue(propertyName);
            },
            set: (value) => {
                const oldValue = object.getValue(propertyName);
                if (value === oldValue) {
                    return;
                }
                object.setValue(propertyName, value, true, true);
            }
        });
    }
}
export { BindingObjectFactory };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmluZGluZ19vYmplY3RfZmFjdG9yeS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvbW9iaWxlLWRldmtpdC8iLCJzb3VyY2VzIjpbImxpYi9iaW5kaW5nLWRhdGEvYmluZGluZ19vYmplY3RfZmFjdG9yeS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7O0dBR0c7QUFHSCxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFDL0MsT0FBTyxFQUFtQixtQkFBbUIsRUFBRSxNQUFNLG9CQUFvQixDQUFDO0FBQzFFLE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQztBQUNqRCxPQUFPLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSx3QkFBd0IsQ0FBQztBQUU1RDs7Ozs7Ozs7Ozs7Ozs7OztHQWdCRztBQUNILE1BQU0sb0JBQW9CO0lBRXhCOzs7OztPQUtHO0lBQ0gsTUFBTSxDQUFDLE1BQU0sQ0FBQyxVQUE2QjtRQUN6QyxNQUFNLE1BQU0sR0FBRyxJQUFJLGFBQWEsQ0FBQyxVQUFVLENBQUMsQ0FBQztRQUM3QyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsTUFBTSxFQUFFLFVBQVUsQ0FBQyxDQUFDO1FBQzFDLE9BQU8sTUFBTSxDQUFDO0lBQ2hCLENBQUM7SUFFRCxNQUFNLENBQUMsMEJBQTBCLENBQUMsSUFBUztRQUN6QyxNQUFNLFVBQVUsR0FBRyxZQUFZLENBQUMsb0JBQW9CLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDM0QsTUFBTSxNQUFNLEdBQUcsSUFBSSxhQUFhLENBQUMsVUFBVSxDQUFDLENBQUM7UUFDN0MsSUFBSSxDQUFDLGdCQUFnQixDQUFDLE1BQU0sRUFBRSxVQUFVLENBQUMsQ0FBQztRQUMxQyxPQUFPLE1BQU0sQ0FBQztJQUNoQixDQUFDO0lBRUQ7Ozs7T0FJRztJQUNILE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxNQUFxQixFQUFFLFVBQTZCO1FBRTFFLG9CQUFvQjtRQUNwQixVQUFVLENBQUMsT0FB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QUFhLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxDQUFDLE1BQWMsRUFBRSxFQUFFO1lBQ2pELE1BQU0sQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLFlBQVksQ0FBQyxDQUFDO1lBQ2xDLE1BQU0sQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQzlCLENBQUMsQ0FBQyxDQUFDO1FBQ0gsTUFBTSxDQUFDLGNBQWMsQ0FBQyxNQUFNLEVBQUUsWUFBWSxFQUFFO1lBQzFDLEtBQUssRUFBRSxhQUFhO1NBQ3JCLENBQUMsQ0FBQztJQUNMLENBQUM7SUFFRDs7OztPQUlHO0lBQ0gsTUFBTSxDQUFDLG1CQUFtQixDQUFDLE1BQXFCLEVBQUUsUUFBeUI7UUFDekUsTUFBTSxZQUFZLEdBQUcsUUFBUSxDQUFDLElBQUksQ0FBQztRQUNuQyxNQUFNLENBQUMsY0FBYyxDQUFDLE1BQU0sRUFBRSxZQUFZLEVBQUU7WUFDMUMsR0FBRyxFQUFFLEdBQUcsRUFBRTtnQkFDUixPQUFPLE1BQU0sQ0FBQyxRQUFRLENBQUMsWUFBWSxDQUFDLENBQUM7WUFDdkMsQ0FBQztZQUNELEdBQUcsRUFBRSxDQUFDLEtBQVUsRUFBRSxFQUFFO2dCQUNsQixNQUFNLFFBQVEsR0FBRyxNQUFNLENBQUMsUUFBUSxDQUFDLFlBQVksQ0FBQyxDQUFDO2dCQUMvQyxJQUFJLEtBQUssS0FBSyxRQUFRLEVBQUU7b0JBQ3RCLE9BQU87aUJBQ1I7Z0JBQ0QsTUFBTSxDQUFDLFFBQVEsQ0FBQyxZQUFZLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxJQUFJLENBQUMsQ0FBQztZQUNuRCxDQUFDO1NBQ0YsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztDQUVGO0FBRUQsT0FBTyxFQUFFLG9CQUFvQixFQUFFLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIOe7keWumuWvueixoeW3peWOguebuOWFs+WumuS5iVxuICogQGF1dGhvciBXaXR0PGppd3RAaW5zcHVyLmNvbT5cbiAqL1xuXG5pbXBvcnQgeyBDaGFuZ2UgfSBmcm9tICcuL2NoYW5nZXMnO1xuaW1wb3J0IHsgUHJvcGVydHlVdGlsIH0gZnJvbSAnLi9wcm9wZXJ0eV91dGlsJztcbmltcG9ydCB7IEJpbmRpbmdQcm9wZXJ0eSwgQmluZGluZ1Byb3BlcnR5VHlwZSB9IGZyb20gJy4vYmluZGluZ19wcm9wZXJ0eSc7XG5pbXBvcnQgeyBCaW5kaW5nT2JqZWN0IH0gZnJvbSAnLi9iaW5kaW5nX29iamVjdCc7XG5pbXBvcnQgeyBCaW5kaW5nTGlzdEZhY3RvcnkgfSBmcm9tICcuL2JpbmRpbmdfbGlzdF9mYWN0b3J5JztcblxuLyoqXG4gKiBCaW5kaW5nT2JqZWN05bel5Y6C55So5LqO5Yib5bu65LiA5Liq56m655qEQmluZGluZ09iamVjdOWvueixoe+8jOW5tuWvueWFtuWxnuaAp+i/m+ihjOaJqeWxleOAglxuICpcbiAqICoq5omp5bGV5bGe5oCn5aSE55CGKipcbiAqXG4gKiDlr7nkuo7opoHmianlsZXnmoTlsZ7mgKfvvIhCaW5kaW5nUHJvcGVydHnvvInmnInkuInnp43lpITnkIbvvJpcbiAqIC0g5pmu6YCa5bGe5oCn77ya5Yid5aeL5YyW5Li65LiA5LiqdW5kZWZpbmVk77yM5bm25YyF6KOFZ2V044CBc2V05pa55rOV77yM6YCa6L+Hc2V05pa55rOV55uR5ZCs5Y+Y5pu077ybXG4gKiAtIOWvueixoeWxnuaAp++8muWIneWni+WMluS4uuS4gOS4quepuueahEJpbmRpbmdPYmplY3Tlr7nosaHvvIzlubbnm5HlkKzlrZDlr7nosaHnmoTlj5jmm7TvvJtcbiAqIC0g5YiX6KGo5bGe5oCn77ya5Yid5aeL5YyW5Li65LiA5Liq56m655qEQmluZGluZ0xpc3Tlr7nosaHvvIzlubbnm5HlkKzlrZDliJfooajnmoTlj5jmm7TvvJtcbiAqXG4gKiAqKuekuuS+i+S7o+eggSoqXG4gKlxuICogYGBgdHNcbiAqICBjb25zdCBlbXBQcm9wZXJ0aWVzID0gUHJvcGVydHlVdGlsLmdldFByb3BlcnRpZXMoRW1wRW50aXR5KTtcbiAqIGNvbnN0IGVtcEJpbmRpbmdPYmplY3QgPSBCaW5kaW5nT2JqZWN0RmFjdG9yeS5jcmVhdGUocHJvcGVydGllcyk7XG4gKiBgYGBcbiAqL1xuY2xhc3MgQmluZGluZ09iamVjdEZhY3Rvcnkge1xuXG4gIC8qKlxuICAgKiDliJvlu7pCaW5kaW5nT2JqZWN05a6e5L6LXG4gICAqIEBwYXJhbSBwcm9wZXJ0aWVzIOimgeaJqeWxleeahOWxnuaAp+mbhuWQiFxuICAgKiBAcmV0dXJucyDluKbmianlsZXlsZ7mgKfnmoTnqbpCaW5kaW5nT2JqZWN05a+56LGhXG4gICAqIEBcbiAgICovXG4gIHN0YXRpYyBjcmVhdGUocHJvcGVydGllczogQmluZGluZ1Byb3BlcnR5W10pOiBCaW5kaW5nT2JqZWN0IHtcbiAgICBjb25zdCBvYmplY3QgPSBuZXcgQmluZGluZ09iamVjdChwcm9wZXJ0aWVzKTtcbiAgICB0aGlzLmV4dGVuZFByb3BlcnRpZXMob2JqZWN0LCBwcm9wZXJ0aWVzKTtcbiAgICByZXR1cm4gb2JqZWN0O1xuICB9XG5cbiAgc3RhdGljIGNyZWF0ZUR5bmFtaWNCaW5kaW5nT2JqZWN0KGRhdGE6IGFueSk6IEJpbmRpbmdPYmplY3Qge1xuICAgIGNvbnN0IHByb3BlcnRpZXMgPSBQcm9wZXJ0eVV0aWwuZ2V0RHluYW1pY1Byb3BlcnRpZXMoZGF0YSk7XG4gICAgY29uc3Qgb2JqZWN0ID0gbmV3IEJpbmRpbmdPYmplY3QocHJvcGVydGllcyk7XG4gICAgdGhpcy5leHRlbmRQcm9wZXJ0aWVzKG9iamVjdCwgcHJvcGVydGllcyk7XG4gICAgcmV0dXJuIG9iamVjdDtcbiAgfVxuXG4gIC8qKlxuICAgKiDmianlsZXlsZ7mgKfnu5Hlrprlr7nosaHnmoTlsZ7mgKdcbiAgICogQHBhcmFtIG9iamVjdCAgICAg6KaB5omp5bGV55qE57uR5a6a5a+56LGhXG4gICAqIEBwYXJhbSBwcm9wZXJ0aWVzIOe7keWumuWxnuaAp+mbhuWQiFxuICAgKi9cbiAgc3RhdGljIGV4dGVuZFByb3BlcnRpZXMob2JqZWN0OiBCaW5kaW5nT2JqZWN0LCBwcm9wZXJ0aWVzOiBCaW5kaW5nUHJvcGVydHlbXSk6IHZvaWQge1xuXG4gICAgLy8g5omp5bGVQmluZGluZ09iamVjdOWxnuaAp1xuICAgIHByb3BlcnRpZXMuZm9yRWFjaCgocHJvcGVydHk6IEJpbmRpbmdQcm9wZXJ0eSkgPT4ge1xuICAgICAgaWYgKHByb3BlcnR5LnR5cGUgPT09IEJpbmRpbmdQcm9wZXJ0eVR5cGUuTGlzdCkge1xuICAgICAgICB0aGlzLmV4dGVuZExpc3RQcm9wZXJ0eShvYmplY3QsIHByb3BlcnR5KTtcbiAgICAgIH0gZWxzZSBpZiAocHJvcGVydHkudHlwZSA9PT0gQmluZGluZ1Byb3BlcnR5VHlwZS5PYmplY3QpIHtcbiAgICAgICAgdGhpcy5leHRlbmRPYmplY3RQcm9wZXJ0eShvYmplY3QsIHByb3BlcnR5KTtcbiAgICAgIH0gZWxzZSBpZiAocHJvcGVydHkudHlwZSA9PT0gQmluZGluZ1Byb3BlcnR5VHlwZS5EeW5hbWljKSB7XG4gICAgICAgIHRoaXMuZXh0ZW5kRHluYW1pY09iamVjdFByb3BlcnR5KG9iamVjdCwgcHJvcGVydHkpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5leHRlbmRQbGFpblByb3BlcnR5KG9iamVjdCwgcHJvcGVydHkpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIOaJqeWxleWIl+ihqOexu+Wei+eahOe7keWumuWxnuaAp1xuICAgKiBAcGFyYW0gb2JqZWN0ICAgICDopoHmianlsZXnmoTnu5Hlrprlr7nosaFcbiAgICogQHBhcmFtIHByb3BlcnRpZXMg5YiX6KGo57G75Z6L55qE57uR5a6a5bGe5oCn6ZuG5ZCIXG4gICAqL1xuICBzdGF0aWMgZXh0ZW5kTGlzdFByb3BlcnR5KG9iamVjdDogQmluZGluZ09iamVjdCwgcHJvcGVydHk6IEJpbmRpbmdQcm9wZXJ0eSk6IHZvaWQge1xuICAgIGNvbnN0IHByb3BlcnR5TmFtZSA9IHByb3BlcnR5Lm5hbWU7XG4gICAgY29uc3QgY2hpbGRMaXN0UHJvcGVydGllcyA9IFByb3BlcnR5VXRpbC5nZXRQcm9wZXJ0aWVzKHByb3BlcnR5LmVudGl0eVR5cGUpO1xuICAgIGNvbnN0IGNoaWxkTGlzdCA9IEJpbmRpbmdMaXN0RmFjdG9yeS5jcmVhdGUoY2hpbGRMaXN0UHJvcGVydGllcyk7XG5cbiAgICAvLyDmjIflrprlrZBMaXN055qEcGFyZW5044CB55uR5ZCs5a2QTGlzdOeahGNoYW5nZXPkuovku7ZcbiAgICBjaGlsZExpc3QucGFyZW50ID0gb2JqZWN0O1xuICAgIGNoaWxkTGlzdC5jaGFuZ2VzLnN1YnNjcmliZSgoY2hhbmdlOiBDaGFuZ2UpID0+IHtcbiAgICAgIGNoYW5nZS5wYXRoLnVuc2hpZnQocHJvcGVydHlOYW1lKTtcbiAgICAgIG9iamVjdC5jaGFuZ2VzLm5leHQoY2hhbmdlKTtcbiAgICB9KTtcblxuICAgIC8vIOWwhuWtkOeahEJpbmRpbmdMaXN05a6e5L6L6LWL5YC857uZ5b2T5YmN5bGe5oCnXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG9iamVjdCwgcHJvcGVydHlOYW1lLCB7XG4gICAgICB2YWx1ZTogY2hpbGRMaXN0XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICog5omp5bGV5a+56LGh57G75Z6L55qE57uR5a6a5bGe5oCnXG4gICAqIEBwYXJhbSBvYmplY3QgICAgIOimgeaJqeWxleeahOe7keWumuWvueixoVxuICAgKiBAcGFyYW0gcHJvcGVydGllcyDlr7nosaHnsbvlnovnmoTnu5HlrprlsZ7mgKfpm4blkIhcbiAgICovXG4gIHN0YXRpYyBleHRlbmRPYmplY3RQcm9wZXJ0eShvYmplY3Q6IEJpbmRpbmdPYmplY3QsIHByb3BlcnR5OiBCaW5kaW5nUHJvcGVydHkpOiB2b2lkIHtcbiAgICBjb25zdCBwcm9wZXJ0eU5hbWUgPSBwcm9wZXJ0eS5uYW1lO1xuICAgIGNvbnN0IGNoaWxkT2JqZWN0UHJvcGVydGllcyA9IFByb3BlcnR5VXRpbC5nZXRQcm9wZXJ0aWVzKHByb3BlcnR5LmVudGl0eVR5cGUpO1xuICAgIGNvbnN0IGNoaWxkT2JqZWN0ID0gdGhpcy5jcmVhdGUoY2hpbGRPYmplY3RQcm9wZXJ0aWVzKTtcblxuICAgIC8vIOaMh+WumuWtkE9iamVjdOeahHBhcmVudOOAgeebkeWQrOWtkE9iamVjdOeahGNoYW5nZXPkuovku7ZcbiAgICBjaGlsZE9iamVjdC5wYXJlbnQgPSBvYmplY3Q7XG4gICAgY2hpbGRPYmplY3QuY2hhbmdlcy5zdWJzY3JpYmUoKGNoYW5nZTogQ2hhbmdlKSA9PiB7XG4gICAgICBjaGFuZ2UucGF0aC51bnNoaWZ0KHByb3BlcnR5TmFtZSk7XG4gICAgICBvYmplY3QuY2hhbmdlcy5uZXh0KGNoYW5nZSk7XG4gICAgfSk7XG5cbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkob2JqZWN0LCBwcm9wZXJ0eU5hbWUsIHtcbiAgICAgIHZhbHVlOiBjaGlsZE9iamVjdFxuICAgIH0pO1xuICB9XG5cbiAgc3RhdGljIGV4dGVuZER5bmFtaWNPYmplY3RQcm9wZXJ0eShvYmplY3Q6IEJpbmRpbmdPYmplY3QsIHByb3BlcnR5OiBCaW5kaW5nUHJvcGVydHkpOiB2b2lkIHtcbiAgICBjb25zdCBwcm9wZXJ0eU5hbWUgPSBwcm9wZXJ0eS5uYW1lO1xuICAgIG9iamVjdFtwcm9wZXJ0eU5hbWVdID0gbnVsbDtcbiAgfVxuXG4gIHN0YXRpYyBhdHRhY2hEeW5hbWljT2JqZWN0UHJvcGVydHkob2JqZWN0OiBCaW5kaW5nT2JqZWN0LCBwcm9wZXJ0eU5hbWU6IHN0cmluZywgZHluYW1pY09iamVjdDogQmluZGluZ09iamVjdCkge1xuICAgIGR5bmFtaWNPYmplY3QucGFyZW50ID0gb2JqZWN0O1xuICAgIGR5bmFtaWNPYmplY3QuY2hhbmdlcy5zdWJzY3JpYmUoKGNoYW5nZTogQ2hhbmdlKSA9PiB7XG4gICAgICBjaGFuZ2UucGF0aC51bnNoaWZ0KHByb3BlcnR5TmFtZSk7XG4gICAgICBvYmplY3QuY2hhbmdlcy5uZXh0KGNoYW5nZSk7XG4gICAgfSk7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG9iamVjdCwgcHJvcGVydHlOYW1lLCB7XG4gICAgICB2YWx1ZTogZHluYW1pY09iamVjdFxuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIOaJqeWxleeugOWNleexu+Wei+eahOe7keWumuWxnuaAp1xuICAgKiBAcGFyYW0gb2JqZWN0ICAgICDopoHmianlsZXnmoTnu5Hlrprlr7nosaFcbiAgICogQHBhcmFtIHByb3BlcnRpZXMg566A5Y2V57G75Z6L55qE57uR5a6a5bGe5oCn6ZuG5ZCIXG4gICAqL1xuICBzdGF0aWMgZXh0ZW5kUGxhaW5Qcm9wZXJ0eShvYmplY3Q6IEJpbmRpbmdPYmplY3QsIHByb3BlcnR5OiBCaW5kaW5nUHJvcGVydHkpOiB2b2lkIHtcbiAgICBjb25zdCBwcm9wZXJ0eU5hbWUgPSBwcm9wZXJ0eS5uYW1lO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmplY3QsIHByb3BlcnR5TmFtZSwge1xuICAgICAgZ2V0OiAoKSA9PiB7XG4gICAgICAgIHJldHVybiBvYmplY3QuZ2V0VmFsdWUocHJvcGVydHlOYW1lKTtcbiAgICAgIH0sXG4gICAgICBzZXQ6ICh2YWx1ZTogYW55KSA9PiB7XG4gICAgICAgIGNvbnN0IG9sZFZhbHVlID0gb2JqZWN0LmdldFZhbHVlKHByb3BlcnR5TmFtZSk7XG4gICAgICAgIGlmICh2YWx1ZSA9PT0gb2xkVmFsdWUpIHtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgb2JqZWN0LnNldFZhbHVlKHByb3BlcnR5TmFtZSwgdmFsdWUsIHRydWUsIHRydWUpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbn1cblxuZXhwb3J0IHsgQmluZGluZ09iamVjdEZhY3RvcnkgfTtcbiJdfQ==
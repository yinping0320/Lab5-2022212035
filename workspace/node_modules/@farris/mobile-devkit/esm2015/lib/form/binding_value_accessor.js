import { BindingPathConverter, DateUtil } from '../utils/index';
import { BindingType } from './types';
/**
 * Entity值访问器
 */
class EntityBindingValueAccessor {
    constructor(bindingData, bindingPath, valueConverter) {
        this.bindingData = bindingData;
        this.bindingPathSegments = this.getBindingPathSegments(bindingPath);
        this.valueConverter = valueConverter;
    }
    getValue() {
        const stateValue = this.bindingData.getValue(this.bindingPathSegments);
        const controlValue = this.valueConverter ? this.valueConverter.convertTo(stateValue) : stateValue;
        return controlValue;
    }
    setValue(controlValue) {
        const oldStateValue = this.bindingData.getValue(this.bindingPathSegments);
        const stateValue = this.valueConverter ? this.valueConverter.convertFrom(controlValue) : controlValue;
        if (this.isDateConverter(this.valueConverter) === true) {
            if (DateUtil.isEqual(oldStateValue, stateValue) === true) {
                return;
            }
        }
        this.bindingData.setValue(this.bindingPathSegments, stateValue, true, true);
    }
    getBindingPathSegments(bindingPath) {
        const parentPathSegments = BindingPathConverter.toBindingPathArray(this.bindingData.bindingPath);
        bindingPath = bindingPath.replace(/\./g, '\/');
        const bindingPathSegments = BindingPathConverter.toBindingPathArray(bindingPath);
        return parentPathSegments.concat(bindingPathSegments);
    }
    /**
     * 是否是DateConverter
     */
    isDateConverter(converter) {
        let isDateConverter = false;
        if (converter && converter.hasOwnProperty('format') === true) {
            isDateConverter = true;
        }
        return isDateConverter;
    }
}
/**
 * UIState值访问器
 */
class UIStateBindingValueAccessor {
    constructor(uiState, bindingPath, valueConverter) {
        this.uiState = uiState;
        this.bindingPathSegments = this.getUiStateBindingPath(bindingPath);
    }
    getValue() {
        let stateValue;
        let obj = this.uiState;
        this.bindingPathSegments.forEach(item => {
            stateValue = obj[item];
            obj = stateValue;
        });
        return stateValue;
    }
    setValue(controlValue) {
        const length = this.bindingPathSegments.length;
        if (length === 1) {
            this.uiState.setPropertyValue(this.bindingPathSegments, controlValue);
        }
        else {
            let obj;
            for (let i = length - 1; i > 0; i--) {
                obj = { [this.bindingPathSegments[i]]: controlValue };
                controlValue = obj;
            }
            this.uiState.setPropertyValue(this.bindingPathSegments[0], obj);
        }
    }
    // UISTATE获取路径
    getUiStateBindingPath(bindingPath) {
        const index = bindingPath.search('/');
        if (index !== -1) {
            return bindingPath.split('/');
        }
        else {
            return [bindingPath];
        }
    }
}
/**
 * 绑定值访问器工厂
 */
class BindingValueAccessorFactory {
    static create(bindingType, bindingBindingPath, bindingValueConverter, viewModelContext) {
        switch (bindingType) {
            case BindingType.EntityState:
                const bindingData = viewModelContext.bindingData;
                return new EntityBindingValueAccessor(bindingData, bindingBindingPath, bindingValueConverter);
            case BindingType.UIState:
                const uiState = viewModelContext.uiState;
                return new UIStateBindingValueAccessor(uiState, bindingBindingPath, bindingValueConverter);
            default:
                throw new Error('Not Supported');
        }
    }
}
export { EntityBindingValueAccessor, UIStateBindingValueAccessor, BindingValueAccessorFactory };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmluZGluZ192YWx1ZV9hY2Nlc3Nvci5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvbW9iaWxlLWRldmtpdC8iLCJzb3VyY2VzIjpbImxpYi9mb3JtL2JpbmRpbmdfdmFsdWVfYWNjZXNzb3IudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBR0EsT0FBTyxFQUFFLG9CQUFvQixFQUFFLFFBQVEsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBRWhFLE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSxTQUFTLENBQUM7QUFhdEM7O0dBRUc7QUFDSCxNQUFNLDBCQUEwQjtJQVE5QixZQUFZLFdBQXdCLEVBQUUsV0FBbUIsRUFBRSxjQUFxQztRQUM5RixJQUFJLENBQUMsV0FBVyxHQUFHLFdBQVcsQ0FBQztRQUMvQixJQUFJLENBQUMsbUJBQW1CLEdBQUcsSUFBSSxDQUFDLHNCQUFzQixDQUFDLFdBQVcsQ0FBQyxDQUFDO1FBQ3BFLElBQUksQ0FBQyxjQUFjLEdBQUcsY0FBYyxDQUFDO0lBQ3ZDLENBQUM7SUFFTSxRQUFRO1FBQ2IsTUFBTSxVQUFVLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLG1CQUFtQixDQUFDLENBQUM7UUFDdkUsTUFBTSxZQUFZLEdBQUcsSUFBSSxDQUFDLGNBQWMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxTQUFTLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDLFVBQVUsQ0FBQztRQUNsRyxPQUFPLFlBQVksQ0FBQztJQUN0QixDQUFDO0lBRU0sUUFBUSxDQUFDLFlBQWlCO1FBQy9CLE1BQU0sYUFBYSxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxDQUFDO1FBQzFFLE1BQU0sVUFBVSxHQUFHLElBQUksQ0FBQyxjQUFjLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxjQUFjLENBQUMsV0FBVyxDQUFDLFlBQVksQ0FBQyxD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LEtBQUssS0FBSyxDQUFDLENBQUMsRUFBRTtZQUNoQixPQUFPLFdBQVcsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUE7U0FDOUI7YUFBTTtZQUNMLE9BQU8sQ0FBQyxXQUFXLENBQUMsQ0FBQTtTQUNyQjtJQUNILENBQUM7Q0FDRjtBQUVEOztHQUVHO0FBQ0gsTUFBTSwyQkFBMkI7SUFFL0IsTUFBTSxDQUFDLE1BQU0sQ0FBQyxXQUF3QixFQUFFLGtCQUEwQixFQUFFLHFCQUFxQixFQUFFLGdCQUFrQztRQUMzSCxRQUFRLFdBQVcsRUFBRTtZQUNuQixLQUFLLFdBQVcsQ0FBQyxXQUFXO2dCQUMxQixNQUFNLFdBQVcsR0FBRyxnQkFBZ0IsQ0FBQyxXQUFXLENBQUM7Z0JBQ2pELE9BQU8sSUFBSSwwQkFBMEIsQ0FBQyxXQUFXLEVBQUUsa0JBQWtCLEVBQUUscUJBQXFCLENBQUMsQ0FBQztZQUNoRyxLQUFLLFdBQVcsQ0FBQyxPQUFPO2dCQUN0QixNQUFNLE9BQU8sR0FBRyxnQkFBZ0IsQ0FBQyxPQUFPLENBQUM7Z0JBQ3pDLE9BQU8sSUFBSSwyQkFBMkIsQ0FBQyxPQUFPLEVBQUUsa0JBQWtCLEVBQUUscUJBQXFCLENBQUMsQ0FBQztZQUM3RjtnQkFDRSxNQUFNLElBQUksS0FBSyxDQUFDLGVBQWUsQ0FBQyxDQUFDO1NBQ3BDO0lBQ0gsQ0FBQztDQUNGO0FBRUQsT0FBTyxFQUF3QiwwQkFBMEIsRUFBRSwyQkFBMkIsRUFBRSwyQkFBMkIsRUFBRSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQmluZGluZ0RhdGEgfSBmcm9tICcuLi9iaW5kaW5nLWRhdGEvaW5kZXgnO1xuaW1wb3J0IHsgVUlTdGF0ZSB9IGZyb20gJy4uL3VpLXN0YXRlL2luZGV4JztcbmltcG9ydCB7IFZpZXdNb2RlbENvbnRleHQgfSBmcm9tICcuLi92aWV3LW1vZGVsL2luZGV4JztcbmltcG9ydCB7IEJpbmRpbmdQYXRoQ29udmVydGVyLCBEYXRlVXRpbCB9IGZyb20gJy4uL3V0aWxzL2luZGV4JztcblxuaW1wb3J0IHsgQmluZGluZ1R5cGUgfSBmcm9tICcuL3R5cGVzJztcbmltcG9ydCB7IEJpbmRpbmdWYWx1ZUNvbnZlcnRlciB9IGZyb20gJy4vYmluZGluZ192YWx1ZV9jb252ZXJ0ZXInO1xuXG4vKipcbiAqIOe7keWumuWAvOiuv+mXruWZqOaOpeWPo1xuICovXG5pbnRlcmZhY2UgQmluZGluZ1ZhbHVlQWNjZXNzb3Ige1xuXG4gIGdldFZhbHVlKCk6IGFueTtcblxuICBzZXRWYWx1ZShjb250cm9sVmFsdWU6IGFueSk6IHZvaWQ7XG59XG5cbi8qKlxuICogRW50aXR55YC86K6/6Zeu5ZmoXG4gKi9cbmNsYXNzIEVudGl0eUJpbmRpbmdWYWx1ZUFjY2Vzc29yIGltcGxlbWVudHMgQmluZGluZ1ZhbHVlQWNjZXNzb3Ige1xuXG4gIHByaXZhdGUgYmluZGluZ0RhdGE6IEJpbmRpbmdEYXRhO1xuXG4gIHByaXZhdGUgYmluZGluZ1BhdGhTZWdtZW50czogc3RyaW5nW107XG5cbiAgcHJpdmF0ZSB2YWx1ZUNvbnZlcnRlcjogQmluZGluZ1ZhbHVlQ29udmVydGVyO1xuXG4gIGNvbnN0cnVjdG9yKGJpbmRpbmdEYXRhOiBCaW5kaW5nRGF0YSwgYmluZGluZ1BhdGg6IHN0cmluZywgdmFsdWVDb252ZXJ0ZXI6IEJpbmRpbmdWYWx1ZUNvbnZlcnRlcikge1xuICAgIHRoaXMuYmluZGluZ0RhdGEgPSBiaW5kaW5nRGF0YTtcbiAgICB0aGlzLmJpbmRpbmdQYXRoU2VnbWVudHMgPSB0aGlzLmdldEJpbmRpbmdQYXRoU2VnbWVudHMoYmluZGluZ1BhdGgpO1xuICAgIHRoaXMudmFsdWVDb252ZXJ0ZXIgPSB2YWx1ZUNvbnZlcnRlcjtcbiAgfVxuXG4gIHB1YmxpYyBnZXRWYWx1ZSgpOiBhbnkge1xuICAgIGNvbnN0IHN0YXRlVmFsdWUgPSB0aGlzLmJpbmRpbmdEYXRhLmdldFZhbHVlKHRoaXMuYmluZGluZ1BhdGhTZWdtZW50cyk7XG4gICAgY29uc3QgY29udHJvbFZhbHVlID0gdGhpcy52YWx1ZUNvbnZlcnRlciA/IHRoaXMudmFsdWVDb252ZXJ0ZXIuY29udmVydFRvKHN0YXRlVmFsdWUpIDogc3RhdGVWYWx1ZTtcbiAgICByZXR1cm4gY29udHJvbFZhbHVlO1xuICB9XG5cbiAgcHVibGljIHNldFZhbHVlKGNvbnRyb2xWYWx1ZTogYW55KTogdm9pZCB7XG4gICAgY29uc3Qgb2xkU3RhdGVWYWx1ZSA9IHRoaXMuYmluZGluZ0RhdGEuZ2V0VmFsdWUodGhpcy5iaW5kaW5nUGF0aFNlZ21lbnRzKTtcbiAgICBjb25zdCBzdGF0ZVZhbHVlID0gdGhpcy52YWx1ZUNvbnZlcnRlciA/IHRoaXMudmFsdWVDb252ZXJ0ZXIuY29udmVydEZyb20oY29udHJvbFZhbHVlKSA6IGNvbnRyb2xWYWx1ZTtcblxuICAgIGlmICh0aGlzLmlzRGF0ZUNvbnZlcnRlcih0aGlzLnZhbHVlQ29udmVydGVyKSA9PT0gdHJ1ZSkge1xuICAgICAgaWYgKERhdGVVdGlsLmlzRXF1YWwob2xkU3RhdGVWYWx1ZSwgc3RhdGVWYWx1ZSkgPT09IHRydWUpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgIH1cblxuICAgIHRoaXMuYmluZGluZ0RhdGEuc2V0VmFsdWUodGhpcy5iaW5kaW5nUGF0aFNlZ21lbnRzLCBzdGF0ZVZhbHVlLCB0cnVlLCB0cnVlKTtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0QmluZGluZ1BhdGhTZWdtZW50cyhiaW5kaW5nUGF0aDogc3RyaW5nKSB7XG4gICAgY29uc3QgcGFyZW50UGF0aFNlZ21lbnRzID0gQmluZGluZ1BhdGhDb252ZXJ0ZXIudG9CaW5kaW5nUGF0aEFycmF5KHRoaXMuYmluZGluZ0RhdGEuYmluZGluZ1BhdGgpO1xuICAgIGJpbmRpbmdQYXRoID0gYmluZGluZ1BhdGgucmVwbGFjZSgvXFwuL2csICdcXC8nKTtcbiAgICBjb25zdCBiaW5kaW5nUGF0aFNlZ21lbnRzID0gQmluZGluZ1BhdGhDb252ZXJ0ZXIudG9CaW5kaW5nUGF0aEFycmF5KGJpbmRpbmdQYXRoKTtcbiAgICByZXR1cm4gcGFyZW50UGF0aFNlZ21lbnRzLmNvbmNhdChiaW5kaW5nUGF0aFNlZ21lbnRzKTtcbiAgfVxuXG4gIC8qKlxuICAgKiDmmK/lkKbmmK9EYXRlQ29udmVydGVyXG4gICAqL1xuICBwcml2YXRlIGlzRGF0ZUNvbnZlcnRlcihjb252ZXJ0ZXI6IEJpbmRpbmdWYWx1ZUNvbnZlcnRlcik6IGJvb2xlYW4ge1xuICAgIGxldCBpc0RhdGVDb252ZXJ0ZXIgPSBmYWxzZTtcbiAgICBpZiAoY29udmVydGVyICYmIGNvbnZlcnRlci5oYXNPd25Qcm9wZXJ0eSgnZm9ybWF0JykgPT09IHRydWUpIHtcbiAgICAgIGlzRGF0ZUNvbnZlcnRlciA9IHRydWU7XG4gICAgfVxuICAgIHJldHVybiBpc0RhdGVDb252ZXJ0ZXI7XG4gIH1cbn1cblxuLyoqXG4gKiBVSVN0YXRl5YC86K6/6Zeu5ZmoXG4gKi9cbmNsYXNzIFVJU3RhdGVCaW5kaW5nVmFsdWVBY2Nlc3NvciBpbXBsZW1lbnRzIEJpbmRpbmdWYWx1ZUFjY2Vzc29yIHtcblxuICBwcml2YXRlIHVpU3RhdGU6IFVJU3RhdGU7XG5cbiAgcHJpdmF0ZSBiaW5kaW5nUGF0aFNlZ21lbnRzOiBzdHJpbmdbXTtcblxuXG4gIGNvbnN0cnVjdG9yKHVpU3RhdGU6IFVJU3RhdGUsIGJpbmRpbmdQYXRoOiBzdHJpbmcsIHZhbHVlQ29udmVydGVyOiBCaW5kaW5nVmFsdWVDb252ZXJ0ZXIpIHtcbiAgICB0aGlzLnVpU3RhdGUgPSB1aVN0YXRlO1xuICAgIHRoaXMuYmluZGluZ1BhdGhTZWdtZW50cyA9IHRoaXMuZ2V0VWlTdGF0ZUJpbmRpbmdQYXRoKGJpbmRpbmdQYXRoKTtcbiAgfVxuXG4gIHB1YmxpYyBnZXRWYWx1ZSgpOiBhbnkge1xuICAgIGxldCBzdGF0ZVZhbHVlO1xuICAgIGxldCBvYmogPSB0aGlzLnVpU3RhdGU7XG4gICAgdGhpcy5iaW5kaW5nUGF0aFNlZ21lbnRzLmZvckVhY2goaXRlbSA9PiB7XG4gICAgICBzdGF0ZVZhbHVlID0gb2JqW2l0ZW1dO1xuICAgICAgb2JqID0gc3RhdGVWYWx1ZVxuICAgIH0pXG4gICAgcmV0dXJuIHN0YXRlVmFsdWU7XG4gIH1cblxuICBwdWJsaWMgc2V0VmFsdWUoY29udHJvbFZhbHVlOiBhbnkpOiB2b2lkIHtcbiAgICBjb25zdCBsZW5ndGggPSB0aGlzLmJpbmRpbmdQYXRoU2VnbWVudHMubGVuZ3RoO1xuICAgIGlmIChsZW5ndGggPT09IDEpIHtcbiAgICAgIHRoaXMudWlTdGF0ZS5zZXRQcm9wZXJ0eVZhbHVlKHRoaXMuYmluZGluZ1BhdGhTZWdtZW50cywgY29udHJvbFZhbHVlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgbGV0IG9iajtcbiAgICAgIGZvcihsZXQgaSA9IGxlbmd0aC0xIDsgaSA+IDAgOyBpLS0pe1xuICAgICAgICBvYmogPSB7W3RoaXMuYmluZGluZ1BhdGhTZWdtZW50c1tpXV06IGNvbnRyb2xWYWx1ZX07XG4gICAgICAgIGNvbnRyb2xWYWx1ZSA9IG9iajtcbiAgICAgIH1cbiAgICAgIHRoaXMudWlTdGF0ZS5zZXRQcm9wZXJ0eVZhbHVlKHRoaXMuYmluZGluZ1BhdGhTZWdtZW50c1swXSwgb2JqKTtcbiAgICB9XG4gIH1cblxuICAvLyBVSVNUQVRF6I635Y+W6Lev5b6EXG4gIHByaXZhdGUgZ2V0VWlTdGF0ZUJpbmRpbmdQYXRoKGJpbmRpbmdQYXRoOiBzdHJpbmcpIHtcbiAgICBjb25zdCBpbmRleCA9IGJpbmRpbmdQYXRoLnNlYXJjaCgnLycpO1xuICAgIGlmIChpbmRleCAhPT0gLTEpIHtcbiAgICAgIHJldHVybiBiaW5kaW5nUGF0aC5zcGxpdCgnLycpXG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiBbYmluZGluZ1BhdGhdXG4gICAgfVxuICB9XG59XG5cbi8qKlxuICog57uR5a6a5YC86K6/6Zeu5Zmo5bel5Y6CXG4gKi9cbmNsYXNzIEJpbmRpbmdWYWx1ZUFjY2Vzc29yRmFjdG9yeSB7XG5cbiAgc3RhdGljIGNyZWF0ZShiaW5kaW5nVHlwZTogQmluZGluZ1R5cGUsIGJpbmRpbmdCaW5kaW5nUGF0aDogc3RyaW5nLCBiaW5kaW5nVmFsdWVDb252ZXJ0ZXIsIHZpZXdNb2RlbENvbnRleHQ6IFZpZXdNb2RlbENvbnRleHQpIHtcbiAgICBzd2l0Y2ggKGJpbmRpbmdUeXBlKSB7XG4gICAgICBjYXNlIEJpbmRpbmdUeXBlLkVudGl0eVN0YXRlOlxuICAgICAgICBjb25zdCBiaW5kaW5nRGF0YSA9IHZpZXdNb2RlbENvbnRleHQuYmluZGluZ0RhdGE7XG4gICAgICAgIHJldHVybiBuZXcgRW50aXR5QmluZGluZ1ZhbHVlQWNjZXNzb3IoYmluZGluZ0RhdGEsIGJpbmRpbmdCaW5kaW5nUGF0aCwgYmluZGluZ1ZhbHVlQ29udmVydGVyKTtcbiAgICAgIGNhc2UgQmluZGluZ1R5cGUuVUlTdGF0ZTpcbiAgICAgICAgY29uc3QgdWlTdGF0ZSA9IHZpZXdNb2RlbENvbnRleHQudWlTdGF0ZTtcbiAgICAgICAgcmV0dXJuIG5ldyBVSVN0YXRlQmluZGluZ1ZhbHVlQWNjZXNzb3IodWlTdGF0ZSwgYmluZGluZ0JpbmRpbmdQYXRoLCBiaW5kaW5nVmFsdWVDb252ZXJ0ZXIpO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdOb3QgU3VwcG9ydGVkJyk7XG4gICAgfVxuICB9XG59XG5cbmV4cG9ydCB7IEJpbmRpbmdWYWx1ZUFjY2Vzc29yLCBFbnRpdHlCaW5kaW5nVmFsdWVBY2Nlc3NvciwgVUlTdGF0ZUJpbmRpbmdWYWx1ZUFjY2Vzc29yLCBCaW5kaW5nVmFsdWVBY2Nlc3NvckZhY3RvcnkgfTtcbiJdfQ==
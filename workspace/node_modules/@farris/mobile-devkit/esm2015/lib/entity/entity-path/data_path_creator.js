import { DataTypeInfo, DataPropGroup } from '../entity-type-info/index';
import { DataPathNodeType } from './data_path_node';
import { DataPath } from './data_path';
/**
 * 数据Path工厂类
 */
class DataPathCreator {
    /**
     * 将长路径数组或字符串转换为
     * @param fullPathArrayOrString 路径数组或字符串
     * @param repository 实体仓库
     * @summary
     * 1、长路径格式说明参考：data-path.md
     */
    static createByLongPathFromRoot(fullPathArrayOrString, entityManager) {
        const dataPath = new DataPath();
        const fullPathArray = fullPathArrayOrString;
        if (!fullPathArray || fullPathArray.length === 0) {
            return dataPath;
        }
        let currentNodeInfo = {
            nodeValue: fullPathArray.shift(),
            nodeType: DataPathNodeType.DataId,
            entityTypeInfo: new DataTypeInfo(entityManager.entityType)
        };
        while (currentNodeInfo) {
            dataPath.push(currentNodeInfo.nodeType, currentNodeInfo.nodeValue);
            // 处理下一个节点
            const nextNodeValue = fullPathArray.shift();
            if (!nextNodeValue || !currentNodeInfo.entityTypeInfo) {
                break;
            }
            currentNodeInfo = this.getNextPathNodeInfo(currentNodeInfo, nextNodeValue);
        }
        return dataPath;
    }
    /**
     * 获取下一个路径节点的信息
     * @param parentNodeInfo 当前路径节点信息
     * @param nextNodeValue 下一个路径节点的值
     * @summary
     * 1、这个递归写的很绕，说明数据结构设计不合理；
     * 2、多个因素混用了一个结构；
     */
    static getNextPathNodeInfo(parentNodeInfo, nextNodeValue) {
        const parentNodeValue = parentNodeInfo.nodeValue;
        const parentNodeType = parentNodeInfo.nodeType;
        const parentEntityTypeInfo = parentNodeInfo.entityTypeInfo;
        if (!nextNodeValue || !parentEntityTypeInfo) {
            return null;
        }
        const nextPathNodeInfo = {
            nodeValue: nextNodeValue,
            nodeType: null,
            entityTypeInfo: null
        };
        // DataNodeType=List：下一节点肯定是Object，并且EntityTypeInfo不变
        if (parentNodeType === DataPathNodeType.DataId) {
            nextPathNodeInfo.nodeType = DataPathNodeType.PropName;
            nextPathNodeInfo.entityTypeInfo = parentEntityTypeInfo;
        }
        else {
            // DataNodeType=Object：必然对应一个属性信息
            const nextPropInfo = parentEntityTypeInfo.getPropInfoByName(parentNodeValue);
            if (nextPropInfo.group === DataPropGroup.List) {
                // EntityPropGroup=EntityList：下一个节点是List类型。
                nextPathNodeInfo.nodeType = DataPathNodeType.DataId;
                nextPathNodeInfo.entityTypeInfo = nextPropInfo.typeInfo;
            }
            else {
                // EntityPropGroup=Entity：       下级entityTypeInfo为
                // EntityPropGroup=Dynamic|Plain：null
                nextPathNodeInfo.nodeType = DataPathNodeType.PropName;
                nextPathNodeInfo.entityTypeInfo = nextPropInfo.group === DataPropGroup.Object ? nextPropInfo.typeInfo : null;
            }
        }
        return nextPathNodeInfo;
    }
    /**
     * @param fullPathArrayOrString 路径数组或字符串
     * @param repository 实体仓库
     * @summary
     * 1、长路径格式说明参考：data-path.md
     * 2、shortPathArrayOrString暂时只支持字符串数组
     */
    static createByShortPathFromRoot(shortPathArrayOrString, entityManager, bindingData) {
        const dataPath = new DataPath();
        const shortPathArray = shortPathArrayOrString;
        // 根节点
        let currentBindingObject = bindingData.list.currentItem;
        let currentEntityTypeInfo = new DataTypeInfo(entityManager.entityType);
        dataPath.push(DataPathNodeType.DataId, currentBindingObject.primaryKeyValue);
        // 遍历下级节点
        shortPathArray.forEach((propName) => {
            const propInfo = currentEntityTypeInfo.getPropInfoByName(propName);
            switch (propInfo.group) {
                case DataPropGroup.Primitive:
                    dataPath.push(DataPathNodeType.PropName, propName);
                    break;
                case DataPropGroup.Object:
                    currentBindingObject = currentBindingObject[propName];
                    currentEntityTypeInfo = propInfo.typeInfo;
                    dataPath.push(DataPathNodeType.PropName, propName);
                    break;
                case DataPropGroup.List:
                    const currentBindingList = currentBindingObject[propName];
                    currentBindingObject = currentBindingList.currentItem;
                    currentEntityTypeInfo = propInfo.typeInfo;
                    dataPath.push(DataPathNodeType.PropName, propName);
                    dataPath.push(DataPathNodeType.DataId, currentBindingObject.primaryKeyValue);
                    break;
                default:
                    break;
            }
        });
        return dataPath;
    }
}
export { DataPathCreator };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0YV9wYXRoX2NyZWF0b3IuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL21vYmlsZS1kZXZraXQvIiwic291cmNlcyI6WyJsaWIvZW50aXR5L2VudGl0eS1wYXRoL2RhdGFfcGF0aF9jcmVhdG9yLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUNBLE9BQU8sRUFBRSxZQUFZLEVBQUUsYUFBYSxFQUFHLE1BQU0sMkJBQTJCLENBQUM7QUFJekUsT0FBTyxFQUFnQixnQkFBZ0IsRUFBRSxNQUFNLGtCQUFrQixDQUFDO0FBQ2xFLE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSxhQUFhLENBQUM7QUFFdkM7O0dBRUc7QUFDSCxNQUFNLGVBQWU7SUFFbkI7Ozs7OztPQU1HO0lBQ0ksTUFBTSxDQUFDLHdCQUF3QixDQUFDLHFCQUF3QyxFQUFFLGFBQW9DO1FBQ25ILE1BQU0sUUFBUSxHQUFHLElBQUksUUFBUSxFQUFFLENBQUM7UUFDaEMsTUFBTSxhQUFhLEdBQUcscUJBQWlDLENBQUM7UUFDeEQsSUFBSSxDQUFDLGFBQWEsSUFBSSxhQUFhLENBQUMsTUFBTSxLQUFLLENBQUMsRUFBRTtZQUNoRCxPQUFPLFFBQVEsQ0FBQztTQUNqQjtRQUVELElBQUksZUFBZSxHQUFHO1lBQ3BCLFNBQVMsRUFBRSxhQUFhLENBQUMsS0FBSyxFQUFFO1lBQ2hDLFFBQVEsRUFBRSxnQkFBZ0IsQ0FBQyxNQUFNO1lBQ2pDLGNBQWMsRUFBRSxJQUFJLFlBQVksQ0FBQyxhQUFhLENBQUMsVUFBVSxDQUFDO1NBQzNELENBQUM7UUFDRixPQUFPLGVBQWUsRUFBRTtZQUN0QixRQUFRLENBQUMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxRQUFRLEVBQUUsZUFBZSxDQUFDLFNBQVMsQ0FBQyxDQUFDO1lBRW5FLFVBQVU7WUFDVixNQUFNLGFBQWEsR0FBRyxhQUFhLENBQUMsS0FBSyxFQUFFLENBQUM7WUFDNUMsSUFBSSxDQUFDLGFBQWEsSUFBSSxDQUFDLGVBQWUsQ0FBQyxjQUFjLEVBQUU7Z0JBQ3JELE1BQU07YUFDUDtZQUNELGVBQWUsR0FBRyxJQUFJLENBQUMsbUJBQW1CLENBQUMsZUFBZSxFQUFFLGFBQWEsQ0FBQyxDQUFDO1NBQzVFO1FBRUQsT0FBTyxRQUFRLENBQUM7SUFDbEIsQ0FBQztJQUVEOzs7Ozs7O09BT0c7SUFDSyxNQUFNLENBQUMsbUJBQW1CLENBQUMsY0FBbUIsRUFBRSxhQUFxQjtRQUUzRSxNQUFNLGVBQWUsR0FBRyxjQUFjLENBQUMsU0FBUyxDQUFDO1FBQ2pELE1BQU0sY0FBYyxHQUFHLGNBQWMsQ0FBQyxRQUFRLENBQUM7UUFDL0MsTUFBTSxvQkFBb0IsR0FBRyxjQUFjLENBQUMsY0FBYyxDQUFDO1FBRTNELElBQUksQ0FBQyxhQUFhLElBQUksQ0FBQyxvQkFBb0IsRUFBRTtZQUMzQyxPQUFPLElBQUksQ0FBQztTQUNiO1FBRUQsTUFBTSxnQkFBZ0IsR0FBRztZQUN2QixTQUFTLEVBQUUsYUFBYTtZQUN4QixRQUFRLEVBQUUsSUFBSTtZQUNkLGNBQWMsRUFBRSxJQUFJO1NBQ3JCLENBQUM7UUFHRixxREFBcUQ7UUFDckQsSUFBSSxjQUFjLEtBQUssZ0JBQWdCLENBQUMsTUFBTSxFQUFFO1lBQzlDLGdCQUFnQixDQUFDLFFBQVEsR0FBRyxnQkFBZ0IsQ0FBQyxRQUFRLENBQUM7WUFDdEQsZ0JBQWdCLENBQUMsY0FBYyxHQUFHLG9CQUFvQixDQUFDO1NBQ3hEO2FBQU07WUFFTCxpQ0FBaUM7WUFDakMsTUFBTSxZQUFZLEdBQUcsb0JBQW9CLENBQUMsaUJBQWlCLENBQUMsZUFBZSxDQUFDLENBQUM7WUFDN0UsSUFBSSxZQUFZLENBQUMsS0FBSyxLQUFLLGFBQWEsQ0FBQyxJQUFJLEVBQUU7Z0JBRTdDLDJDQUEyQztnQkFDM0MsZ0JBQWdCLENBQUMsUUFBUSxHQUFHLGdCQUFnQixDQUFDLE1BQU0sQ0FBQztnQkFDcEQsZ0JBQWdCLENBQUMsY0FBYyxHQUFHLFlBQVksQ0FBQyxRQUFRLENBQUM7YUFDekQ7aUJBQU07Z0JBRUwsa0RBQWtEO2dCQUNsRCxxQ0FBcUM7Z0JBQ3JDLGdCQUFnQixDQUFDLFFBQVEsR0FBRyxnQkFBZ0IsQ0FBQyxRQUFRLENBQUM7Z0JBQ3RELGdCQUFnQixDQUFDLGNBQWMsR0FBRyxZQUFZLENBQUMsS0FBSyxLQUFLLGFBQWEsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLFlBQVksQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQzthQUM5RztTQUNGO1FBRUQsT0FBTyxnQkFBZ0IsQ0FBQztJQUMxQixDQUFDO0lBRUQ7Ozs7OztPQU1HO0lBQ0ksTUFBTSxDQUFDLHlCQUF5QixDQUNyQyxzQkFBeUMsRUFBRSxhQUFvQyxFQUFFLFdBQXdCO1FBR3pHLE1BQU0sUUFBUSxHQUFHLElBQUksUUFBUSxFQUFFLENBQUM7UUFDaEMsTUFBTSxjQUFjLEdBQWEsc0JBQWtDLENBQUM7UUFFcEUsTUFBTTtRQUNOLElBQUksb0JBQW9CLEdBQUcsV0FBVyxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUM7UUFDeEQsSUFBSSxxQkFBcUIsR0FBRyxJQUFJLFlBQVksQ0FBQyxhQUFhLENBQUMsVUFBVSxDQUFDLENBQUM7UUFDdkUsUUFBUSxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxNQUFNLEVBQUUsb0JBQW9CLENBQUMsZUFBZSxDQUFDLENBQUM7UUFFN0UsU0FBUztRQUNULGNBQWMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxRQUFnQixFQUFFLEVBQUU7WUFDMUMsTUFBTSxRQUFRLEdBQUcscUJBQXFCLENBQUMsaUJBQWlCLENBQUMsUUFBUSxDQUFDLENBQUM7WUFDbkUsUUFBUSxRQUFRLENBQUMsS0FBSyxFQUFFO2dCQUN0QixLQUFLLGFBQWEsQ0FBQyxTQUFTO29CQUMxQixRQUFRLENBQUMsSUFBSSxDQUFDLGdCQUFnQixDQUFDLFFBQVEsRUFBRSxRQUFRLENBQUMsQ0FBQztvQkFDbkQsTUFBTTtnQkFDUixLQUFLLGFBQWEsQ0FBQyxNQUFNO29CQUN2QixvQkFBb0IsR0FBRyxvQkFBb0IsQ0FBQyxRQUFRLENBQUMsQ0FBQztvQkFDdEQscUJBQXFCLEdBQUcsUUFBUSxDQUFDLFFBQVEsQ0FBQztvQkFDMUMsUUFBUSxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxRQUFRLEVBQUUsUUFBUSxDQUFDLENBQUM7b0JBRW5ELE1BQU07Z0JBQ1IsS0FBSyxhQUFhLENBQUMsSUFBSTtvQkFDckIsTUFBTSxrQkFBa0IsR0FBRyxvQkFBb0IsQ0FBQyxRQUFRLENBQUMsQ0FBQztvQkFDMUQsb0JBQW9CLEdBQUcsa0JBQWtCLENBQUMsV0FBVyxDQUFDO29CQUN0RCxxQkFBcUIsR0FBRyxRQUFRLENBQUMsUUFBUSxDQUFDO29CQUUxQyxRQUFRLENBQUMsSUFBSSxDQUFDLGdCQUFnQixDQUFDLFFBQVEsRUFBRSxRQUFRLENBQUMsQ0FBQztvQkFDbkQsUUFBUSxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxNQUFNLEVBQUUsb0JBQW9CLENBQUMsZUFBZSxDQUFDLENBQUM7b0JBQzdFLE1BQU07Z0JBQ1I7b0JBQ0ksTUFBTTthQUNYO1FBQ0gsQ0FBQyxDQUFDLENBQUM7UUFFSCxPQUFPLFFBQVEsQ0FBQztJQUNsQixDQUFDO0NBRUY7QUFFRCxPQUFPLEVBQUUsZUFBZSxFQUFFLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJcbmltcG9ydCB7IERhdGFUeXBlSW5mbywgRGF0YVByb3BHcm91cCAgfSBmcm9tICcuLi9lbnRpdHktdHlwZS1pbmZvL2luZGV4JztcbmltcG9ydCB7IEVudGl0eSAgfSBmcm9tICcuLi9pbmRleCc7XG5pbXBvcnQgeyBSZXBvc2l0b3J5LCBFbnRpdHlNYW5hZ2VyIH0gZnJvbSAnLi4vLi4vcmVwb3NpdG9yeS9pbmRleCc7XG5pbXBvcnQgeyBCaW5kaW5nRGF0YSB9IGZyb20gJy4uLy4uL2JpbmRpbmctZGF0YS9pbmRleCc7XG5pbXBvcnQgeyBEYXRhUGF0aE5vZGUsIERhdGFQYXRoTm9kZVR5cGUgfSBmcm9tICcuL2RhdGFfcGF0aF9ub2RlJztcbmltcG9ydCB7IERhdGFQYXRoIH0gZnJvbSAnLi9kYXRhX3BhdGgnO1xuXG4vKipcbiAqIOaVsOaNrlBhdGjlt6XljoLnsbtcbiAqL1xuY2xhc3MgRGF0YVBhdGhDcmVhdG9yIHtcblxuICAvKipcbiAgICog5bCG6ZW/6Lev5b6E5pWw57uE5oiW5a2X56ym5Liy6L2s5o2i5Li6XG4gICAqIEBwYXJhbSBmdWxsUGF0aEFycmF5T3JTdHJpbmcg6Lev5b6E5pWw57uE5oiW5a2X56ym5LiyXG4gICAqIEBwYXJhbSByZXBvc2l0b3J5IOWunuS9k+S7k+W6k1xuICAgKiBAc3VtbWFyeVxuICAgKiAx44CB6ZW/6Lev5b6E5qC85byP6K+05piO5Y+C6ICD77yaZGF0YS1wYXRoLm1kXG4gICAqL1xuICBwdWJsaWMgc3RhdGljIGNyZWF0ZUJ5TG9uZ1BhdGhGcm9tUm9vdChmdWxsUGF0aEFycmF5T3JTdHJpbmc6IHN0cmluZ1tdIHwgc3RyaW5nLCBlbnRpdHlNYW5hZ2VyOiBFbnRpdHlNYW5hZ2VyPEVudGl0eT4pOiBEYXRhUGF0aCB7XG4gICAgY29uc3QgZGF0YVBhdGggPSBuZXcgRGF0YVBhdGgoKTtcbiAgICBjb25zdCBmdWxsUGF0aEFycmF5ID0gZnVsbFBhdGhBcnJheU9yU3RyaW5nIGFzIHN0cmluZ1tdO1xuICAgIGlmICghZnVsbFBhdGhBcnJheSB8fCBmdWxsUGF0aEFycmF5Lmxlbmd0aCA9PT0gMCkge1xuICAgICAgcmV0dXJuIGRhdGFQYXRoO1xuICAgIH1cblxuICAgIGxldCBjdXJyZW50Tm9kZUluZm8gPSB7XG4gICAgICBub2RlVmFsdWU6IGZ1bGxQYXRoQXJyYXkuc2hpZnQoKSxcbiAgICAgIG5vZGVUeXBlOiBEYXRhUGF0aE5vZGVUeXBlLkRhdGFJZCxcbiAgICAgIGVudGl0eVR5cGVJbmZvOiBuZXcgRGF0YVR5cGVJbmZvKGVudGl0eU1hbmFnZXIuZW50aXR5VHlwZSlcbiAgICB9O1xuICAgIHdoaWxlIChjdXJyZW50Tm9kZUluZm8pIHtcbiAgICAgIGRhdGFQYXRoLnB1c2goY3VycmVudE5vZGVJbmZvLm5vZGVUeXBlLCBjdXJyZW50Tm9kZUluZm8ubm9kZVZhbHVlKTtcblxuICAgICAgLy8g5aSE55CG5LiL5LiA5Liq6IqC54K5XG4gICAgICBjb25zdCBuZXh0Tm9kZVZhbHVlID0gZnVsbFBhdGhBcnJheS5zaGlmdCgpO1xuICAgICAgaWYgKCFuZXh0Tm9kZVZhbHVlIHx8ICFjdXJyZW50Tm9kZUluZm8uZW50aXR5VHlwZUluZm8pIHtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICBjdXJyZW50Tm9kZUluZm8gPSB0aGlzLmdldE5leHRQYXRoTm9kZUluZm8oY3VycmVudE5vZGVJbmZvLCBuZXh0Tm9kZVZhbHVlKTtcbiAgICB9XG5cbiAgICByZXR1cm4gZGF0YVBhdGg7XG4gIH1cblxuICAvKipcbiAgICog6I635Y+W5LiL5LiA5Liq6Lev5b6E6IqC54K555qE5L+h5oGvXG4gICAqIEBwYXJhbSBwYXJlbnROb2RlSW5mbyDlvZPliY3ot6/lvoToioLngrnkv6Hmga9cbiAgICogQHBhcmFtIG5leHROb2RlVmFsdWUg5LiL5LiA5Liq6Lev5b6E6IqC54K555qE5YC8XG4gICAqIEBzdW1tYXJ5XG4gICAqIDHjgIHov5nkuKrpgJLlvZLlhpnnmoTlvojnu5XvvIzor7TmmI7mlbDmja7nu5PmnoTorr7orqHkuI3lkIjnkIbvvJtcbiAgICogMuOAgeWkmuS4quWboOe0oOa3t+eUqOS6huS4gOS4que7k+aehO+8m1xuICAgKi9cbiAgcHJpdmF0ZSBzdGF0aWMgZ2V0TmV4dFBhdGhOb2RlSW5mbyhwYXJlbnROb2RlSW5mbzogYW55LCBuZXh0Tm9kZVZhbHVlOiBzdHJpbmcpOiBhbnkge1xuXG4gICAgY29uc3QgcGFyZW50Tm9kZVZhbHVlID0gcGFyZW50Tm9kZUluZm8ubm9kZVZhbHVlO1xuICAgIGNvbnN0IHBhcmVudE5vZGVUeXBlID0gcGFyZW50Tm9kZUluZm8ubm9kZVR5cGU7XG4gICAgY29uc3QgcGFyZW50RW50aXR5VHlwZUluZm8gPSBwYXJlbnROb2RlSW5mby5lbnRpdHlUeXBlSW5mbztcblxuICAgIGlmICghbmV4dE5vZGVWYWx1ZSB8fCAhcGFyZW50RW50aXR5VHlwZUluZm8pIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIGNvbnN0IG5leHRQYXRoTm9kZUluZm8gPSB7XG4gICAgICBub2RlVmFsdWU6IG5leHROb2RlVmFsdWUsXG4gICAgICBub2RlVHlwZTogbnVsbCxcbiAgICAgIGVudGl0eVR5cGVJbmZvOiBudWxsXG4gICAgfTtcblxuXG4gICAgLy8gRGF0YU5vZGVUeXBlPUxpc3TvvJrkuIvkuIDoioLngrnogq/lrprmmK9PYmplY3TvvIzlubbkuJRFbnRpdHlUeXBlSW5mb+S4jeWPmFxuICAgIGlmIChwYXJlbnROb2RlVHlwZSA9PT0gRGF0YVBhdGhOb2RlVHlwZS5EYXRhSWQpIHtcbiAgICAgIG5leHRQYXRoTm9kZUluZm8ubm9kZVR5cGUgPSBEYXRhUGF0aE5vZGVUeXBlLlByb3BOYW1lO1xuICAgICAgbmV4dFBhdGhOb2RlSW5mby5lbnRpdHlUeXBlSW5mbyA9IHBhcmVudEVudGl0eVR5cGVJbmZvO1xuICAgIH0gZWxzZSB7XG5cbiAgICAgIC8vIERhdGFOb2RlVHlwZT1PYmplY3TvvJrlv4XnhLblr7nlupTkuIDkuKrlsZ7mgKfkv6Hmga9cbiAgICAgIGNvbnN0IG5leHRQcm9wSW5mbyA9IHBhcmVudEVudGl0eVR5cGVJbmZvLmdldFByb3BJbmZvQnlOYW1lKHBhcmVudE5vZGVWYWx1ZSk7XG4gICAgICBpZiAobmV4dFByb3BJbmZvLmdyb3VwID09PSBEYXRhUHJvcEdyb3VwLkxpc3QpIHtcblxuICAgICAgICAvLyBFbnRpdHlQcm9wR3JvdXA9RW50aXR5TGlzdO+8muS4i+S4gOS4quiKgueCueaYr0xpc3TnsbvlnovjgIJcbiAgICAgICAgbmV4dFBhdGhOb2RlSW5mby5ub2RlVHlwZSA9IERhdGFQYXRoTm9kZVR5cGUuRGF0YUlkO1xuICAgICAgICBuZXh0UGF0aE5vZGVJbmZvLmVudGl0eVR5cGVJbmZvID0gbmV4dFByb3BJbmZvLnR5cGVJbmZvO1xuICAgICAgfSBlbHNlIHtcblxuICAgICAgICAvLyBFbnRpdHlQcm9wR3JvdXA9RW50aXR577yaICAgICAgIOS4i+e6p2VudGl0eVR5cGVJbmZv5Li6XG4gICAgICAgIC8vIEVudGl0eVByb3BHcm91cD1EeW5hbWljfFBsYWlu77yabnVsbFxuICAgICAgICBuZXh0UGF0aE5vZGVJbmZvLm5vZGVUeXBlID0gRGF0YVBhdGhOb2RlVHlwZS5Qcm9wTmFtZTtcbiAgICAgICAgbmV4dFBhdGhOb2RlSW5mby5lbnRpdHlUeXBlSW5mbyA9IG5leHRQcm9wSW5mby5ncm91cCA9PT0gRGF0YVByb3BHcm91cC5PYmplY3QgPyBuZXh0UHJvcEluZm8udHlwZUluZm8gOiBudWxsO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBuZXh0UGF0aE5vZGVJbmZvO1xuICB9XG5cbiAgLyoqXG4gICAqIEBwYXJhbSBmdWxsUGF0aEFycmF5T3JTdHJpbmcg6Lev5b6E5pWw57uE5oiW5a2X56ym5LiyXG4gICAqIEBwYXJhbSByZXBvc2l0b3J5IOWunuS9k+S7k+W6k1xuICAgKiBAc3VtbWFyeVxuICAgKiAx44CB6ZW/6Lev5b6E5qC85byP6K+05piO5Y+C6ICD77yaZGF0YS1wYXRoLm1kXG4gICAqIDLjgIFzaG9ydFBhdGhBcnJheU9yU3RyaW5n5pqC5pe25Y+q5pSv5oyB5a2X56ym5Liy5pWw57uEXG4gICAqL1xuICBwdWJsaWMgc3RhdGljIGNyZWF0ZUJ5U2hvcnRQYXRoRnJvbVJvb3QoXG4gICAgc2hvcnRQYXRoQXJyYXlPclN0cmluZzogc3RyaW5nW10gfCBzdHJpbmcsIGVudGl0eU1hbmFnZXI6IEVudGl0eU1hbmFnZXI8RW50aXR5PiwgYmluZGluZ0RhdGE6IEJpbmRpbmdEYXRhXG4gICk6IERhdGFQYXRoIHtcblxuICAgIGNvbnN0IGRhdGFQYXRoID0gbmV3IERhdGFQYXRoKCk7XG4gICAgY29uc3Qgc2hvcnRQYXRoQXJyYXk6IHN0cmluZ1tdID0gc2hvcnRQYXRoQXJyYXlPclN0cmluZyBhcyBzdHJpbmdbXTtcblxuICAgIC8vIOagueiKgueCuVxuICAgIGxldCBjdXJyZW50QmluZGluZ09iamVjdCA9IGJpbmRpbmdEYXRhLmxpc3QuY3VycmVudEl0ZW07XG4gICAgbGV0IGN1cnJlbnRFbnRpdHlUeXBlSW5mbyA9IG5ldyBEYXRhVHlwZUluZm8oZW50aXR5TWFuYWdlci5lbnRpdHlUeXBlKTtcbiAgICBkYXRhUGF0aC5wdXNoKERhdGFQYXRoTm9kZVR5cGUuRGF0YUlkLCBjdXJyZW50QmluZGluZ09iamVjdC5wcmltYXJ5S2V5VmFsdWUpO1xuXG4gICAgLy8g6YGN5Y6G5LiL57qn6IqC54K5XG4gICAgc2hvcnRQYXRoQXJyYXkuZm9yRWFjaCgocHJvcE5hbWU6IHN0cmluZykgPT4ge1xuICAgICAgY29uc3QgcHJvcEluZm8gPSBjdXJyZW50RW50aXR5VHlwZUluZm8uZ2V0UHJvcEluZm9CeU5hbWUocHJvcE5hbWUpO1xuICAgICAgc3dpdGNoIChwcm9wSW5mby5ncm91cCkge1xuICAgICAgICBjYXNlIERhdGFQcm9wR3JvdXAuUHJpbWl0aXZlOlxuICAgICAgICAgIGRhdGFQYXRoLnB1c2goRGF0YVBhdGhOb2RlVHlwZS5Qcm9wTmFtZSwgcHJvcE5hbWUpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIERhdGFQcm9wR3JvdXAuT2JqZWN0OlxuICAgICAgICAgIGN1cnJlbnRCaW5kaW5nT2JqZWN0ID0gY3VycmVudEJpbmRpbmdPYmplY3RbcHJvcE5hbWVdO1xuICAgICAgICAgIGN1cnJlbnRFbnRpdHlUeXBlSW5mbyA9IHByb3BJbmZvLnR5cGVJbmZvO1xuICAgICAgICAgIGRhdGFQYXRoLnB1c2goRGF0YVBhdGhOb2RlVHlwZS5Qcm9wTmFtZSwgcHJvcE5hbWUpO1xuXG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgRGF0YVByb3BHcm91cC5MaXN0OlxuICAgICAgICAgIGNvbnN0IGN1cnJlbnRCaW5kaW5nTGlzdCA9IGN1cnJlbnRCaW5kaW5nT2JqZWN0W3Byb3BOYW1lXTtcbiAgICAgICAgICBjdXJyZW50QmluZGluZ09iamVjdCA9IGN1cnJlbnRCaW5kaW5nTGlzdC5jdXJyZW50SXRlbTtcbiAgICAgICAgICBjdXJyZW50RW50aXR5VHlwZUluZm8gPSBwcm9wSW5mby50eXBlSW5mbztcblxuICAgICAgICAgIGRhdGFQYXRoLnB1c2goRGF0YVBhdGhOb2RlVHlwZS5Qcm9wTmFtZSwgcHJvcE5hbWUpO1xuICAgICAgICAgIGRhdGFQYXRoLnB1c2goRGF0YVBhdGhOb2RlVHlwZS5EYXRhSWQsIGN1cnJlbnRCaW5kaW5nT2JqZWN0LnByaW1hcnlLZXlWYWx1ZSk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIHJldHVybiBkYXRhUGF0aDtcbiAgfVxuXG59XG5cbmV4cG9ydCB7IERhdGFQYXRoQ3JlYXRvciB9O1xuIl19
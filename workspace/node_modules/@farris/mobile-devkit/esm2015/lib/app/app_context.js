import { Context } from '../context/index';
import { BindingDataFactory } from '../binding-data';
import { VALIDATION_RULE_TOKEN } from './tokens';
class AppContext extends Context {
    /**
     * 构造函数
     */
    constructor(injector, eventBus, repositoryManager, bindingDataManager, viewModelContextManager, validationManager = {}, validationRule) {
        super();
        this.injector = injector;
        this.eventBus = eventBus;
        this.repositoryManager = repositoryManager;
        this.bindingDataManager = bindingDataManager;
        this.viewModelContextManager = viewModelContextManager;
        this.validationManager = validationManager;
        this.validationRule = validationRule;
        this.validationRule = injector.get(VALIDATION_RULE_TOKEN, []);
    }
    /**
     * 注册FrameContext
     */
    regViewModelContext(viewModelContext) {
        const repository = viewModelContext.repository;
        const repositoryName = repository.name;
        // Repository
        if (this.repositoryManager.ifRepositoryExits(repositoryName) === false) {
            this.repositoryManager.regRepository(repositoryName, repository);
        }
        // BindingData
        if (this.bindingDataManager.ifBindingDataExits(repositoryName) === false) {
            const bindingData = BindingDataFactory.createFromRepository(repository, '/');
            this.bindingDataManager.regBindingData(repositoryName, bindingData);
        }
        // 考虑路由再次进入的时候，AppContext没有被注销，但Component被再次构造的场景
        this.viewModelContextManager.regContext(viewModelContext);
    }
}
export { AppContext };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXBwX2NvbnRleHQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL21vYmlsZS1kZXZraXQvIiwic291cmNlcyI6WyJsaWIvYXBwL2FwcF9jb250ZXh0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQVFBLE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQztBQUMzQyxPQUFPLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUtyRCxPQUFPLEVBQUUscUJBQXFCLEVBQUUsTUFBTSxVQUFVLENBQUE7QUFDaEQsTUFBTSxVQUFXLFNBQVEsT0FBTztJQUU5Qjs7T0FFRztJQUNILFlBQ1MsUUFBa0IsRUFDbEIsUUFBcUIsRUFDckIsaUJBQW9DLEVBQ3BDLGtCQUFzQyxFQUN0Qyx1QkFBZ0QsRUFDaEQsb0JBQW9CLEVBQUUsRUFDdEIsY0FBYztRQUVyQixLQUFLLEVBQUUsQ0FBQztRQVJELGFBQVEsR0FBUixRQUFRLENBQVU7UUFDbEIsYUFBUSxHQUFSLFFBQVEsQ0FBYTtRQUNyQixzQkFBaUIsR0FBakIsaUJBQWlCLENBQW1CO1FBQ3BDLHVCQUFrQixHQUFsQixrQkFBa0IsQ0FBb0I7UUFDdEMsNEJBQXVCLEdBQXZCLHVCQUF1QixDQUF5QjtRQUNoRCxzQkFBaUIsR0FBakIsaUJBQWlCLENBQUs7UUFDdEIsbUJBQWMsR0FBZCxjQUFjLENBQUE7UUFHckIsSUFBSSxDQUFDLGNBQWMsR0FBRyxRQUFRLENBQUMsR0FBRyxDQUFDLHFCQUFxQixFQUFFLEVBQUUsQ0FBQyxDQUFDO0lBQ2hFLENBQUM7SUFFRDs7T0FFRztJQUNJLG1CQUFtQixDQUFDLGdCQUFrQztRQUUzRCxNQUFNLFVBQVUsR0FBRyxnQkFBZ0IsQ0FBQyxVQUFVLENBQUM7UUFDL0MsTUFBTSxjQUFjLEdBQUcsVUFBVSxDQUFDLElBQUksQ0FBQztRQUV2QyxhQUFhO1FBQ2IsSUFBSSxJQUFJLENBQUMsaUJBQWlCLENBQUMsaUJBQWlCLENBQUMsY0FBYyxDQUFDLEtBQUssS0FBSyxFQUFFO1lBQ3RFLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxhQUFhLENBQUMsY0FBYyxFQUFFLFVBQVUsQ0FBQyxDQUFDO1NBQ2xFO1FBRUQsY0FBYztRQUNkLElBQUksSUFBSSxDQUFDLGtCQUFrQixDQUFDLGtCQUFrQixDQUFDLGNBQWMsQ0FBQyxLQUFLLEtBQUssRUFBRTtZQUN4RSxNQUFNLFdBQVcsR0FBRyxrQkFBa0IsQ0FBQyxvQkFBb0IsQ0FBQyxVQUFVLEVBQUUsR0FBRyxDQUFDLENBQUM7WUFDN0UsSUFBSSxDQUFDLGtCQUFrQixDQUFDLGNBQWMsQ0FBQyxjQUFjLEVBQUUsV0FBVyxDQUFDLENBQUM7U0FDckU7UUFFRCxpREFBaUQ7UUFDakQsSUFBSSxDQUFDLHVCQUF1QixDQUFDLFVBQVUsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO0lBQzVELENBQUM7Q0FFRjtBQUVELE9BQU8sRUFBRSxVQUFVLEVBQUUsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICog5bqU55So5LiK5LiL5paHXG4gKiBAYXV0aG9yIFdpdHQ8aml3dEBpbnNwdXIuY29tPlxuICogQHRvZG9cbiAqIDHjgIFwYXJuZXTlkoxBcHBDb250ZXh0TWFuYWdlcuaYr+WQpuW/heimge+8n+aMieeQhuivtOWwseaYr+W6lOivpemalOemu+S4iuS4i+aWh++8jOihqOWNleS5i+mXtOmAmui/h+S6i+S7tumAmuiur+i/m+ihjOS6pOS6ku+8m1xuICovXG5pbXBvcnQgeyBJbmplY3RvciB9IGZyb20gJy4uL2NvcmUvaW5kZXgnO1xuaW1wb3J0IHsgVmlld01vZGVsQ29udGV4dCB9IGZyb20gJy4uL3ZpZXctbW9kZWwvaW5kZXgnO1xuaW1wb3J0IHsgQ29udGV4dCB9IGZyb20gJy4uL2NvbnRleHQvaW5kZXgnO1xuaW1wb3J0IHsgQmluZGluZ0RhdGFGYWN0b3J5IH0gZnJvbSAnLi4vYmluZGluZy1kYXRhJztcbmltcG9ydCB7IFZpZXdNb2RlbENvbnRleHRNYW5hZ2VyIH0gZnJvbSAnLi92aWV3X21vZGVsX2NvbnRleF9tYW5hZ2VyJztcbmltcG9ydCB7IFJlcG9zaXRvcnlNYW5hZ2VyIH0gZnJvbSAnLi9yZXBvc2l0b3J5X21hbmFuZ2VyJztcbmltcG9ydCB7IEJpbmRpbmdEYXRhTWFuYWdlciB9IGZyb20gJy4vYmluZGluZ19kYXRhX21hbmFnZXInO1xuaW1wb3J0IHsgQXBwRXZlbnRCdXMgfSBmcm9tICcuL2FwcF9ldmVudEJ1cyc7XG5pbXBvcnQgeyBWQUxJREFUSU9OX1JVTEVfVE9LRU4gfSBmcm9tICcuL3Rva2VucydcbmNsYXNzIEFwcENvbnRleHQgZXh0ZW5kcyBDb250ZXh0IHtcblxuICAvKipcbiAgICog5p6E6YCg5Ye95pWwXG4gICAqL1xuICBjb25zdHJ1Y3RvcihcbiAgICBwdWJsaWMgaW5qZWN0b3I6IEluamVjdG9yLFxuICAgIHB1YmxpYyBldmVudEJ1czogQXBwRXZlbnRCdXMsXG4gICAgcHVibGljIHJlcG9zaXRvcnlNYW5hZ2VyOiBSZXBvc2l0b3J5TWFuYWdlcixcbiAgICBwdWJsaWMgYmluZGluZ0RhdGFNYW5hZ2VyOiBCaW5kaW5nRGF0YU1hbmFnZXIsXG4gICAgcHVibGljIHZpZXdNb2RlbENvbnRleHRNYW5hZ2VyOiBWaWV3TW9kZWxDb250ZXh0TWFuYWdlcixcbiAgICBwdWJsaWMgdmFsaWRhdGlvbk1hbmFnZXIgPSB7fSxcbiAgICBwdWJsaWMgdmFsaWRhdGlvblJ1bGVcbiAgKSB7XG4gICAgc3VwZXIoKTtcbiAgICB0aGlzLnZhbGlkYXRpb25SdWxlID0gaW5qZWN0b3IuZ2V0KFZBTElEQVRJT05fUlVMRV9UT0tFTiwgW10pO1xuICB9XG5cbiAgLyoqXG4gICAqIOazqOWGjEZyYW1lQ29udGV4dFxuICAgKi9cbiAgcHVibGljIHJlZ1ZpZXdNb2RlbENvbnRleHQodmlld01vZGVsQ29udGV4dDogVmlld01vZGVsQ29udGV4dCk6IHZvaWQge1xuXG4gICAgY29uc3QgcmVwb3NpdG9yeSA9IHZpZXdNb2RlbENvbnRleHQucmVwb3NpdG9yeTtcbiAgICBjb25zdCByZXBvc2l0b3J5TmFtZSA9IHJlcG9zaXRvcnkubmFtZTtcblxuICAgIC8vIFJlcG9zaXRvcnlcbiAgICBpZiAodGhpcy5yZXBvc2l0b3J5TWFuYWdlci5pZlJlcG9zaXRvcnlFeGl0cyhyZXBvc2l0b3J5TmFtZSkgPT09IGZhbHNlKSB7XG4gICAgICB0aGlzLnJlcG9zaXRvcnlNYW5hZ2VyLnJlZ1JlcG9zaXRvcnkocmVwb3NpdG9yeU5hbWUsIHJlcG9zaXRvcnkpO1xuICAgIH1cblxuICAgIC8vIEJpbmRpbmdEYXRhXG4gICAgaWYgKHRoaXMuYmluZGluZ0RhdGFNYW5hZ2VyLmlmQmluZGluZ0RhdGFFeGl0cyhyZXBvc2l0b3J5TmFtZSkgPT09IGZhbHNlKSB7XG4gICAgICBjb25zdCBiaW5kaW5nRGF0YSA9IEJpbmRpbmdEYXRhRmFjdG9yeS5jcmVhdGVGcm9tUmVwb3NpdG9yeShyZXBvc2l0b3J5LCAnLycpO1xuICAgICAgdGhpcy5iaW5kaW5nRGF0YU1hbmFnZXIucmVnQmluZGluZ0RhdGEocmVwb3NpdG9yeU5hbWUsIGJpbmRpbmdEYXRhKTtcbiAgICB9XG5cbiAgICAvLyDogIPomZHot6/nlLHlho3mrKHov5vlhaXnmoTml7blgJnvvIxBcHBDb250ZXh05rKh5pyJ6KKr5rOo6ZSA77yM5L2GQ29tcG9uZW506KKr5YaN5qyh5p6E6YCg55qE5Zy65pmvXG4gICAgdGhpcy52aWV3TW9kZWxDb250ZXh0TWFuYWdlci5yZWdDb250ZXh0KHZpZXdNb2RlbENvbnRleHQpO1xuICB9XG5cbn1cblxuZXhwb3J0IHsgQXBwQ29udGV4dCB9O1xuIl19
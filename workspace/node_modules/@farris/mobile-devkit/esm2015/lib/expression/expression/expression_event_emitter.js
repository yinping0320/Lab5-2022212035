import { BehaviorSubject } from "rxjs";
import { Listeners } from "../listener/index";
/**
 * 事件监听器主要有以下几种类型的事件：
 * 1、值变化
 * 2、行切换
 *    行切换使用场景为需要为数据计算依赖当前行时
 * 3、数据加载
 */
export class ExpressionEventEmitter {
    constructor(viewModelContext) {
        this.viewModelContext = viewModelContext;
        this.listeners = this.viewModelContext.injector.get(Listeners);
        this.events = new Array();
        this.listeners.onEvent.subscribe((eventArgs) => {
            if (this.onEvent && this.onEvent.observers.length > 0) {
                let events = [];
                if (this.events.length > 0) {
                    events = [...this.events];
                }
                events.push(eventArgs);
                this.onEvent.next(events);
                this.events = [];
            }
            else {
                this.events.push(eventArgs);
            }
        });
    }
    attach() {
        if (!this.onEvent) {
            this.onEvent = new BehaviorSubject(this.events);
        }
        return this.onEvent.asObservable();
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZXhwcmVzc2lvbl9ldmVudF9lbWl0dGVyLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy9tb2JpbGUtZGV2a2l0LyIsInNvdXJjZXMiOlsibGliL2V4cHJlc3Npb24vZXhwcmVzc2lvbi9leHByZXNzaW9uX2V2ZW50X2VtaXR0ZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLGVBQWUsRUFBYyxNQUFNLE1BQU0sQ0FBQztBQUduRCxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFHOUM7Ozs7OztHQU1HO0FBQ0gsTUFBTSxPQUFPLHNCQUFzQjtJQVFqQyxZQUFvQixnQkFBa0M7UUFBbEMscUJBQWdCLEdBQWhCLGdCQUFnQixDQUFrQjtRQUVwRCxJQUFJLENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBRS9ELElBQUksQ0FBQyxNQUFNLEdBQUcsSUFBSSxLQUFLLEVBQXdCLENBQUM7UUFDaEQsSUFBSSxDQUFDLFNBQVMsQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDLENBQUMsU0FBK0IsRUFBRSxFQUFFO1lBQ25FLElBQUksSUFBSSxDQUFDLE9BQU8sSUFBSSxJQUFJLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFO2dCQUNyRCxJQUFJLE1BQU0sR0FBRyxFQUFFLENBQUM7Z0JBQ2hCLElBQUksSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFO29CQUMxQixNQUFNLEdBQUcsQ0FBQyxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztpQkFDM0I7Z0JBQ0QsTUFBTSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQztnQkFDdkIsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7Z0JBQzFCLElBQUksQ0FBQyxNQUFNLEdBQUcsRUFBRSxDQUFDO2FBQ2xCO2lCQUFNO2dCQUNMLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDO2FBQzdCO1FBQ0gsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDO0lBQ00sTUFBTTtRQUNYLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFO1lBQ2pCLElBQUksQ0FBQyxPQUFPLEdBQUcsSUFBSSxlQUFlLENBQThCLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztTQUM5RTtRQUNELE9BQU8sSUFBSSxDQUFDLE9BQU8sQ0FBQyxZQUFZLEVBQUUsQ0FBQztJQUNyQyxDQUFDO0NBQ0YiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBCZWhhdmlvclN1YmplY3QsIE9ic2VydmFibGUgfSBmcm9tIFwicnhqc1wiO1xuaW1wb3J0IHsgVmlld01vZGVsQ29udGV4dCB9IGZyb20gJy4uLy4uL3ZpZXctbW9kZWwvaW5kZXgnO1xuXG5pbXBvcnQgeyBMaXN0ZW5lcnMgfSBmcm9tIFwiLi4vbGlzdGVuZXIvaW5kZXhcIjtcbmltcG9ydCB7IEV4cHJlc3Npb24gfSBmcm9tIFwiLi90eXBlc1wiO1xuXG4vKipcbiAqIOS6i+S7tuebkeWQrOWZqOS4u+imgeacieS7peS4i+WHoOenjeexu+Wei+eahOS6i+S7tu+8mlxuICogMeOAgeWAvOWPmOWMllxuICogMuOAgeihjOWIh+aNolxuICogICAg6KGM5YiH5o2i5L2/55So5Zy65pmv5Li66ZyA6KaB5Li65pWw5o2u6K6h566X5L6d6LWW5b2T5YmN6KGM5pe2XG4gKiAz44CB5pWw5o2u5Yqg6L29XG4gKi9cbmV4cG9ydCBjbGFzcyBFeHByZXNzaW9uRXZlbnRFbWl0dGVyIHtcblxuICBwcml2YXRlIG9uRXZlbnQ6IEJlaGF2aW9yU3ViamVjdDxBcnJheTxFeHByZXNzaW9uLkV2ZW50QXJncz4+O1xuXG4gIHByaXZhdGUgZXZlbnRzOiBBcnJheTxFeHByZXNzaW9uLkV2ZW50QXJncz47XG5cbiAgcHJpdmF0ZSBsaXN0ZW5lcnM6IExpc3RlbmVycztcblxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIHZpZXdNb2RlbENvbnRleHQ6IFZpZXdNb2RlbENvbnRleHQpIHtcblxuICAgIHRoaXMubGlzdGVuZXJzID0gdGhpcy52aWV3TW9kZWxDb250ZXh0LmluamVjdG9yLmdldChMaXN0ZW5lcnMpO1xuXG4gICAgdGhpcy5ldmVudHMgPSBuZXcgQXJyYXk8RXhwcmVzc2lvbi5FdmVudEFyZ3M+KCk7XG4gICAgdGhpcy5saXN0ZW5lcnMub25FdmVudC5zdWJzY3JpYmUoKGV2ZW50QXJnczogRXhwcmVzc2lvbi5FdmVudEFyZ3MpID0+IHtcbiAgICAgIGlmICh0aGlzLm9uRXZlbnQgJiYgdGhpcy5vbkV2ZW50Lm9ic2VydmVycy5sZW5ndGggPiAwKSB7XG4gICAgICAgIGxldCBldmVudHMgPSBbXTtcbiAgICAgICAgaWYgKHRoaXMuZXZlbnRzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICBldmVudHMgPSBbLi4udGhpcy5ldmVudHNdO1xuICAgICAgICB9XG4gICAgICAgIGV2ZW50cy5wdXNoKGV2ZW50QXJncyk7XG4gICAgICAgIHRoaXMub25FdmVudC5uZXh0KGV2ZW50cyk7XG4gICAgICAgIHRoaXMuZXZlbnRzID0gW107XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLmV2ZW50cy5wdXNoKGV2ZW50QXJncyk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cbiAgcHVibGljIGF0dGFjaCgpOiBPYnNlcnZhYmxlPEFycmF5PEV4cHJlc3Npb24uRXZlbnRBcmdzPj4ge1xuICAgIGlmICghdGhpcy5vbkV2ZW50KSB7XG4gICAgICB0aGlzLm9uRXZlbnQgPSBuZXcgQmVoYXZpb3JTdWJqZWN0PEFycmF5PEV4cHJlc3Npb24uRXZlbnRBcmdzPj4odGhpcy5ldmVudHMpO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy5vbkV2ZW50LmFzT2JzZXJ2YWJsZSgpO1xuICB9XG59Il19
import { ExpressionManager } from "./expression_manager";
;
import { ExpressionRegistry } from "./expression_registry";
import { ExpressionResult } from "./expression_result";
export class ExpressionResultFactory {
    constructor(viewModelContext) {
        this.viewModelContext = viewModelContext;
        this.injector = this.viewModelContext.injector;
        this.expressionRegistry = this.injector.get(ExpressionRegistry);
        this.expressionManager = this.injector.get(ExpressionManager);
        this.expressionResult = this.injector.get(ExpressionResult);
        this.registeEvent();
    }
    registeEvent() {
        this.expressionRegistry.expressions.subscribe((expressionObjects) => {
            // 加载完表达式之后做一次计算
            expressionObjects.forEach((expressionObject) => {
                if (expressionObject.deps && expressionObject.deps.length > 0) {
                    return;
                }
                const result = this.expressionManager.eval(expressionObject.id);
                this.expressionResult[expressionObject.id] = result;
            });
        });
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZXhwcmVzc2lvbl9yZXN1bHRfZmFjdG9yeS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvbW9iaWxlLWRldmtpdC8iLCJzb3VyY2VzIjpbImxpYi9leHByZXNzaW9uL2V4cHJlc3Npb24vZXhwcmVzc2lvbl9yZXN1bHRfZmFjdG9yeS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFDQSxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUFBLENBQUM7QUFDMUQsT0FBTyxFQUFFLGtCQUFrQixFQUFFLE1BQU0sdUJBQXVCLENBQUM7QUFDM0QsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0scUJBQXFCLENBQUE7QUFJdEQsTUFBTSxPQUFPLHVCQUF1QjtJQVVsQyxZQUFvQixnQkFBa0M7UUFBbEMscUJBQWdCLEdBQWhCLGdCQUFnQixDQUFrQjtRQUVwRCxJQUFJLENBQUMsUUFBUSxHQUFHLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxRQUFRLENBQUM7UUFDL0MsSUFBSSxDQUFDLGtCQUFrQixHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLGtCQUFrQixDQUFDLENBQUM7UUFDaEUsSUFBSSxDQUFDLGlCQUFpQixHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLGlCQUFpQixDQUFDLENBQUM7UUFDOUQsSUFBSSxDQUFDLGdCQUFnQixHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLGdCQUFnQixDQUFDLENBQUM7UUFHNUQsSUFBSSxDQUFDLFlBQVksRUFBRSxDQUFDO0lBQ3RCLENBQUM7SUFDTyxZQUFZO1FBQ2xCLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxXQUFXLENBQUMsU0FBUyxDQUFDLENBQUMsaUJBQWdELEVBQUUsRUFBRTtZQUNqRyxnQkFBZ0I7WUFDaEIsaUJBQWlCLENBQUMsT0FBTyxDQUFDLENBQUMsZ0JBQTZDLEVBQUUsRUFBRTtnQkFDMUUsSUFBSSxnQkFBZ0IsQ0FBQyxJQUFJLElBQUksZ0JBQWdCLENBQUMsSUFBSSxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUU7b0JBQzdELE9BQU87aUJBQ1I7Z0JBQ0QsTUFBTSxNQUFNLEdBQUcsSUFBSSxDQUFDLGlCQUFpQixDQUFDLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxFQUFFLENBQUMsQ0FBQztnQkFDaEUsSUFBSSxDQUFDLGdCQUFnQixDQUFDLGdCQUFnQixDQUFDLEVBQUUsQ0FBQyxHQUFHLE1BQU0sQ0FBQztZQUN0RCxDQUFDLENBQUMsQ0FBQztRQUNMLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztDQUNGIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0b3IgfSBmcm9tIFwiLi4vLi4vY29yZS9pbmRleFwiO1xuaW1wb3J0IHsgRXhwcmVzc2lvbk1hbmFnZXIgfSBmcm9tIFwiLi9leHByZXNzaW9uX21hbmFnZXJcIjs7XG5pbXBvcnQgeyBFeHByZXNzaW9uUmVnaXN0cnkgfSBmcm9tIFwiLi9leHByZXNzaW9uX3JlZ2lzdHJ5XCI7XG5pbXBvcnQgeyBFeHByZXNzaW9uUmVzdWx0IH0gZnJvbSBcIi4vZXhwcmVzc2lvbl9yZXN1bHRcIlxuaW1wb3J0IHsgRXhwcmVzc2lvbiB9IGZyb20gXCIuL3R5cGVzXCI7XG5pbXBvcnQgeyBWaWV3TW9kZWxDb250ZXh0LCBWaWV3TW9kZWwgfSBmcm9tIFwiLi4vLi4vdmlldy1tb2RlbC9pbmRleFwiO1xuXG5leHBvcnQgY2xhc3MgRXhwcmVzc2lvblJlc3VsdEZhY3Rvcnkge1xuXG4gIHByaXZhdGUgaW5qZWN0b3I6IEluamVjdG9yO1xuXG4gIHByaXZhdGUgZXhwcmVzc2lvblJlZ2lzdHJ5OiBFeHByZXNzaW9uUmVnaXN0cnk7XG5cbiAgcHJpdmF0ZSBleHByZXNzaW9uTWFuYWdlcjogRXhwcmVzc2lvbk1hbmFnZXI7XG5cbiAgcHJpdmF0ZSBleHByZXNzaW9uUmVzdWx0OiBFeHByZXNzaW9uUmVzdWx0XG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSB2aWV3TW9kZWxDb250ZXh0OiBWaWV3TW9kZWxDb250ZXh0KSB7XG5cbiAgICB0aGlzLmluamVjdG9yID0gdGhpcy52aWV3TW9kZWxDb250ZXh0LmluamVjdG9yO1xuICAgIHRoaXMuZXhwcmVzc2lvblJlZ2lzdHJ5ID0gdGhpcy5pbmplY3Rvci5nZXQoRXhwcmVzc2lvblJlZ2lzdHJ5KTtcbiAgICB0aGlzLmV4cHJlc3Npb25NYW5hZ2VyID0gdGhpcy5pbmplY3Rvci5nZXQoRXhwcmVzc2lvbk1hbmFnZXIpO1xuICAgIHRoaXMuZXhwcmVzc2lvblJlc3VsdCA9IHRoaXMuaW5qZWN0b3IuZ2V0KEV4cHJlc3Npb25SZXN1bHQpO1xuXG5cbiAgICB0aGlzLnJlZ2lzdGVFdmVudCgpO1xuICB9XG4gIHByaXZhdGUgcmVnaXN0ZUV2ZW50KCkge1xuICAgIHRoaXMuZXhwcmVzc2lvblJlZ2lzdHJ5LmV4cHJlc3Npb25zLnN1YnNjcmliZSgoZXhwcmVzc2lvbk9iamVjdHM6IEV4cHJlc3Npb24uRXhwcmVzc2lvbk9iamVjdFtdKSA9PiB7XG4gICAgICAvLyDliqDovb3lrozooajovr7lvI/kuYvlkI7lgZrkuIDmrKHorqHnrpdcbiAgICAgIGV4cHJlc3Npb25PYmplY3RzLmZvckVhY2goKGV4cHJlc3Npb25PYmplY3Q6IEV4cHJlc3Npb24uRXhwcmVzc2lvbk9iamVjdCkgPT4ge1xuICAgICAgICBpZiAoZXhwcmVzc2lvbk9iamVjdC5kZXBzICYmIGV4cHJlc3Npb25PYmplY3QuZGVwcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IHRoaXMuZXhwcmVzc2lvbk1hbmFnZXIuZXZhbChleHByZXNzaW9uT2JqZWN0LmlkKTtcbiAgICAgICAgdGhpcy5leHByZXNzaW9uUmVzdWx0W2V4cHJlc3Npb25PYmplY3QuaWRdID0gcmVzdWx0O1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH1cbn0iXX0=
/*
 * @Author: Witt
 * @Date: 2018-10-12 15:37:11
 * @Last Modified by: aalizzwell
 * @Last Modified time: 2019-09-03 19:10:44
 * @todo 待优化问题
 * 1、apiUrl是否应该在基类中，子类中的api如何传递给基类；
 */
import { DataTypeInfo } from '../entity/index';
import { createEntity, createEntities } from '../entity/index';
import { EntityCollection } from './entity_collection';
import { PaginationManager } from './pagination_manager';
import { DataChangeHistory } from './data_change_history';
export class Repository {
    /**
     * 构造函数
     */
    constructor() {
        /**
         * 用户分页配置信息
         */
        this.paginationInfo = null;
    }
    init() {
        this.entityTypeInfo = new DataTypeInfo(this.entityType);
        this.entityCollection = new EntityCollection(this.entityType);
        this.entityCollection.entityTypeInfo = this.entityTypeInfo;
        this.dataChangeHistory = new DataChangeHistory();
    }
    get changes() {
        return this.entityCollection.changes;
    }
    /**
     * 实体主键
     */
    get primaryKey() {
        return this.entityCollection.primaryKey;
    }
    /**
     * 实体变更集合
     */
    get entityCollectionChange() {
        return this.entityCollection.collectionChanged;
    }
    /**
     * 重置状态
     */
    reset() {
        this.entityCollection.clear();
    }
    /**
     * 创建实体
     */
    buildEntity(data) {
        const entity = createEntity(this.entityType, data);
        return entity;
    }
    /**
     * 批量创建实体
     */
    buildEntities(listData) {
        const entities = createEntities(this.entityType, listData);
        return entities;
    }
    /**
     * 初始化分页配置
     * @param config 用户分页配置
     */
    setPaginationConfig(config) {
        this.paginationManager = new PaginationManager(this.entityType, config);
        const { pageSize = 0 } = this.paginationManager.getPaginationConfigByPath('/') || {};
        // tslint:disable-next-line: max-line-length
        this.entityCollection.paginationInfo = Object.assign({ pageSize }, this.entityCollection.paginationInfo, this.paginationManager.pagination);
        // 无需再单独设置一次pageSize，减少一次变更
        // this.entityCollection.pageSize = pageSize;
    }
    /**
     * 设置分页
     */
    setPaginationInfo(paginationInfo) {
        this.paginationInfo = Object.assign({}, this.paginationInfo, paginationInfo);
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmVwb3NpdG9yeS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvbW9iaWxlLWRldmtpdC8iLCJzb3VyY2VzIjpbImxpYi9yZXBvc2l0b3J5L3JlcG9zaXRvcnkudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7Ozs7R0FPRztBQUtILE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUkvQyxPQUFPLEVBQVUsWUFBWSxFQUFFLGNBQWMsRUFBcUIsTUFBTSxpQkFBaUIsQ0FBQztBQUUxRixPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUN2RCxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUN6RCxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQUUxRCxNQUFNLE9BQWdCLFVBQVU7SUF3QzlCOztPQUVHO0lBQ0g7UUFyQkE7O1dBRUc7UUFDSSxtQkFBYyxHQUFRLElBQUksQ0FBQztJQW1CbEMsQ0FBQztJQUVTLElBQUk7UUFDWixJQUFJLENBQUMsY0FBYyxHQUFHLElBQUksWUFBWSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQztRQUN4RCxJQUFJLENBQUMsZ0JBQWdCLEdBQUcsSUFBSSxnQkFBZ0IsQ0FBSSxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUM7UUFDakUsSUFBSSxDQUFDLGdCQUFnQixDQUFDLGNBQWMsR0FBRyxJQUFJLENBQUMsY0FBYyxDQUFDO1FBQzNELElBQUksQ0FBQyxpQkFBaUIsR0FBRyxJQUFJLGlCQUFpQixFQUFFLENBQUM7SUFDbkQsQ0FBQztJQUVELElBQVcsT0FBTztRQUNoQixPQUFPLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxPQUFPLENBQUM7SUFDdkMsQ0FBQztJQUVEOztPQUVHO0lBQ0gsSUFBVyxVQUFVO1FBQ25CLE9BQU8sSUFBSSxDQUFDLGdCQUFnQixDQUFDLFVBQVUsQ0FBQztJQUMxQyxDQUFDO0lBRUQ7O09BRUc7SUFDSCxJQUFXLHNCQUFzQjtRQUMvQixPQUFPLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxpQkFBaUIsQ0FBQztJQUNqRCxDQUFDO0lBRUQ7O09BRUc7SUFDSSxLQUFLO1FBQ1YsSUFBSSxDQUFDLGdCQUFnQixDQUFDLEtBQUssRUFBRSxDQUFDO0lBQ2hDLENBQUM7SUFFRDs7T0FFRztJQUNJLFdBQVcsQ0FBQyxJQUFTO1FBQzFCLE1BQU0sTUFBTSxHQUFHLFlBQVksQ0FBSSxJQUFJLENBQUMsVUFBVSxFQUFFLElBQUksQ0FBQyxDQUFDO1FBQ3RELE9BQU8sTUFBTSxDQUFDO0lBQ2hCLENBQUM7SUFFRDs7T0FFRztJQUNJLGFBQWEsQ0FBQyxRQUFlO1FBQ2xDLE1BQU0sUUFBUSxHQUFRLGNBQWMsQ0FBSSxJQUFJLENBQUMsVUFBVSxFQUFFLFFBQVEsQ0FBQyxDQUFDO1FBQ25FLE9BQU8sUUFBUSxDQUFDO0lBQ2xCLENBQUM7SUFFRDs7O09BR0c7SUFDSCxtQkFBbUIsQ0FBQyxNQUFXO1FBQzdCLElBQUksQ0FBQyxpQkFBaUIsR0FBRyxJQUFJLGlCQUFpQixDQUFDLElBQUksQ0FBQyxVQUFVLEVBQUUsTUFBTSxDQUFDLENBQUM7UUFDeEUsTUFBTSxFQUFFLFFBQVEsR0FBRyxDQUFDLEVBQUUsR0FBRyxJQUFJLENBQUMsaUJBQWlCLENBQUMseUJBQXlCLENBQUMsR0FBRyxDQUFDLElBQUksRUFBRSxDQUFDO1FBQ3JGLDRDQUE0QztRQUM1QyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsY0FBYyxHQUFHLE1BQU0sQ0FBQyxNQUFNLENBQUMsRUFBRSxRQUFRLEVBQUUsRUFBRSxJQUFJLENBQUMsZ0JBQWdCLENBQUMsY0FBYyxFQUFFLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxVQUFVLENBQUMsQ0FBQztRQUU1SSwyQkFBMkI7UUFDM0IsNkNBQTZDO0lBQy9DLENBQUM7SUFFRDs7T0FFRztJQUNJLGlCQUFpQixDQUFDLGNBQW1CO1FBQzFDLElBQUksQ0FBQyxjQUFjLHFCQUFRLElBQUksQ0FBQyxjQUFjLEVBQUssY0FBYyxDQUFFLENBQUM7SUFDdEUsQ0FBQztDQUVGIiwic291cmNlc0NvbnRlbnQiOlsiLypcbiAqIEBBdXRob3I6IFdpdHRcbiAqIEBEYXRlOiAyMDE4LTEwLTEyIDE1OjM3OjExXG4gKiBATGFzdCBNb2RpZmllZCBieTogYWFsaXp6d2VsbFxuICogQExhc3QgTW9kaWZpZWQgdGltZTogMjAxOS0wOS0wMyAxOToxMDo0NFxuICogQHRvZG8g5b6F5LyY5YyW6Zeu6aKYXG4gKiAx44CBYXBpVXJs5piv5ZCm5bqU6K+l5Zyo5Z+657G75Lit77yM5a2Q57G75Lit55qEYXBp5aaC5L2V5Lyg6YCS57uZ5Z+657G777ybXG4gKi9cblxuaW1wb3J0IHsgVHlwZSB9IGZyb20gJy4uL2NvcmUvaW5kZXgnO1xuaW1wb3J0IHsgT2JzZXJ2YWJsZSwgU3ViamVjdCB9IGZyb20gJ3J4anMnO1xuXG5pbXBvcnQgeyBEYXRhVHlwZUluZm8gfSBmcm9tICcuLi9lbnRpdHkvaW5kZXgnO1xuaW1wb3J0IHsgR3VpZCB9IGZyb20gJy4uL3V0aWxzL2luZGV4JztcbmltcG9ydCB7IE1vZGlmaWNhdGlvbiB9IGZyb20gJy4uL2NoYW5nZXNldC9pbmRleCc7XG5pbXBvcnQgeyBNZXRhZGF0YVV0aWwgfSBmcm9tICcuLi9jb3JlL2luZGV4JztcbmltcG9ydCB7IEVudGl0eSwgY3JlYXRlRW50aXR5LCBjcmVhdGVFbnRpdGllcywgRmllbGRNZXRhZGF0YVV0aWwgfSBmcm9tICcuLi9lbnRpdHkvaW5kZXgnO1xuaW1wb3J0IHsgUmVwb3NpdG9yeU1ldGEgfSBmcm9tICcuL2RlY29yYXRvcnMnO1xuaW1wb3J0IHsgRW50aXR5Q29sbGVjdGlvbiB9IGZyb20gJy4vZW50aXR5X2NvbGxlY3Rpb24nO1xuaW1wb3J0IHsgUGFnaW5hdGlvbk1hbmFnZXIgfSBmcm9tICcuL3BhZ2luYXRpb25fbWFuYWdlcic7XG5pbXBvcnQgeyBEYXRhQ2hhbmdlSGlzdG9yeSB9IGZyb20gJy4vZGF0YV9jaGFuZ2VfaGlzdG9yeSc7XG5cbmV4cG9ydCBhYnN0cmFjdCBjbGFzcyBSZXBvc2l0b3J5PFQgZXh0ZW5kcyBFbnRpdHk+IHtcblxuICAvKipcbiAgICog5ZCN56ewXG4gICAqL1xuICBhYnN0cmFjdCBuYW1lOiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIOWunuS9k+exu+Wei1xuICAgKi9cbiAgcHVibGljIGVudGl0eVR5cGU6IFR5cGU8VD47XG5cbiAgLyoqXG4gICAqIOWunuS9k+exu+Wei+S/oeaBr1xuICAgKi9cbiAgcHVibGljIGVudGl0eVR5cGVJbmZvOiBEYXRhVHlwZUluZm87XG5cbiAgLyoqXG4gICAqIOWunuS9k+mbhuWQiFxuICAgKi9cbiAgcHVibGljIGVudGl0eUNvbGxlY3Rpb246IEVudGl0eUNvbGxlY3Rpb248VD47XG5cbiAgLyoqXG4gICAqIOeUqOaIt+WIhumhtemFjee9ruS/oeaBr1xuICAgKi9cbiAgcHVibGljIHBhZ2luYXRpb25JbmZvOiBhbnkgPSBudWxsO1xuXG4gIC8qKlxuICAgKiDmlbDmja7lj5jmm7Tljoblj7JcbiAgICogQHN1bW1hcnlcbiAgICog5LuF6ZKI5a+55Li76KGo5aKe5Yqg44CB5LuO6KGo5Yig6ZmkXG4gICAqL1xuICBwdWJsaWMgZGF0YUNoYW5nZUhpc3Rvcnk6IERhdGFDaGFuZ2VIaXN0b3J5O1xuXG5cbiAgLyoqXG4gICAqIOWIhumhteeuoeeQhuWZqFxuICAgKi9cbiAgcHVibGljIHBhZ2luYXRpb25NYW5hZ2VyOiBQYWdpbmF0aW9uTWFuYWdlcjxUPjtcblxuICAvKipcbiAgICog5p6E6YCg5Ye95pWwXG4gICAqL1xuICBjb25zdHJ1Y3RvcigpIHtcbiAgfVxuXG4gIHByb3RlY3RlZCBpbml0KCkge1xuICAgIHRoaXMuZW50aXR5VHlwZUluZm8gPSBuZXcgRGF0YVR5cGVJbmZvKHRoaXMuZW50aXR5VHlwZSk7XG4gICAgdGhpcy5lbnRpdHlDb2xsZWN0aW9uID0gbmV3IEVudGl0eUNvbGxlY3Rpb248VD4odGhpcy5lbnRpdHlUeXBlKTtcbiAgICB0aGlzLmVudGl0eUNvbGxlY3Rpb24uZW50aXR5VHlwZUluZm8gPSB0aGlzLmVudGl0eVR5cGVJbmZvO1xuICAgIHRoaXMuZGF0YUNoYW5nZUhpc3RvcnkgPSBuZXcgRGF0YUNoYW5nZUhpc3RvcnkoKTtcbiAgfVxuXG4gIHB1YmxpYyBnZXQgY2hhbmdlcygpOiBTdWJqZWN0PE1vZGlmaWNhdGlvbj4ge1xuICAgIHJldHVybiB0aGlzLmVudGl0eUNvbGxlY3Rpb24uY2hhbmdlcztcbiAgfVxuXG4gIC8qKlxuICAgKiDlrp7kvZPkuLvplK5cbiAgICovXG4gIHB1YmxpYyBnZXQgcHJpbWFyeUtleSgpOiBzdHJpbmcge1xuICAgIHJldHVybiB0aGlzLmVudGl0eUNvbGxlY3Rpb24ucHJpbWFyeUtleTtcbiAgfVxuXG4gIC8qKlxuICAgKiDlrp7kvZPlj5jmm7Tpm4blkIhcbiAgICovXG4gIHB1YmxpYyBnZXQgZW50aXR5Q29sbGVjdGlvbkNoYW5nZSgpOiBTdWJqZWN0PE1vZGlmaWNhdGlvbj4ge1xuICAgIHJldHVybiB0aGlzLmVudGl0eUNvbGxlY3Rpb24uY29sbGVjdGlvbkNoYW5nZWQ7XG4gIH1cblxuICAvKipcbiAgICog6YeN572u54q25oCBXG4gICAqL1xuICBwdWJsaWMgcmVzZXQoKTogdm9pZCB7XG4gICAgdGhpcy5lbnRpdHlDb2xsZWN0aW9uLmNsZWFyKCk7XG4gIH1cblxuICAvKipcbiAgICog5Yib5bu65a6e5L2TXG4gICAqL1xuICBwdWJsaWMgYnVpbGRFbnRpdHkoZGF0YTogYW55KTogVCB7XG4gICAgY29uc3QgZW50aXR5ID0gY3JlYXRlRW50aXR5PFQ+KHRoaXMuZW50aXR5VHlwZSwgZGF0YSk7XG4gICAgcmV0dXJuIGVudGl0eTtcbiAgfVxuXG4gIC8qKlxuICAgKiDmibnph4/liJvlu7rlrp7kvZNcbiAgICovXG4gIHB1YmxpYyBidWlsZEVudGl0aWVzKGxpc3REYXRhOiBhbnlbXSk6IFRbXSB7XG4gICAgY29uc3QgZW50aXRpZXM6IFRbXSA9IGNyZWF0ZUVudGl0aWVzPFQ+KHRoaXMuZW50aXR5VHlwZSwgbGlzdERhdGEpO1xuICAgIHJldHVybiBlbnRpdGllcztcbiAgfVxuXG4gIC8qKlxuICAgKiDliJ3lp4vljJbliIbpobXphY3nva5cbiAgICogQHBhcmFtIGNvbmZpZyDnlKjmiLfliIbpobXphY3nva5cbiAgICovXG4gIHNldFBhZ2luYXRpb25Db25maWcoY29uZmlnOiBhbnkpIHtcbiAgICB0aGlzLnBhZ2luYXRpb25NYW5hZ2VyID0gbmV3IFBhZ2luYXRpb25NYW5hZ2VyKHRoaXMuZW50aXR5VHlwZSwgY29uZmlnKTtcbiAgICBjb25zdCB7IHBhZ2VTaXplID0gMCB9ID0gdGhpcy5wYWdpbmF0aW9uTWFuYWdlci5nZXRQYWdpbmF0aW9uQ29uZmlnQnlQYXRoKCcvJykgfHwge307XG4gICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOiBtYXgtbGluZS1sZW5ndGhcbiAgICB0aGlzLmVudGl0eUNvbGxlY3Rpb24ucGFnaW5hdGlvbkluZm8gPSBPYmplY3QuYXNzaWduKHsgcGFnZVNpemUgfSwgdGhpcy5lbnRpdHlDb2xsZWN0aW9uLnBhZ2luYXRpb25JbmZvLCB0aGlzLnBhZ2luYXRpb25NYW5hZ2VyLnBhZ2luYXRpb24pO1xuXG4gICAgLy8g5peg6ZyA5YaN5Y2V54us6K6+572u5LiA5qyhcGFnZVNpemXvvIzlh4/lsJHkuIDmrKHlj5jmm7RcbiAgICAvLyB0aGlzLmVudGl0eUNvbGxlY3Rpb24ucGFnZVNpemUgPSBwYWdlU2l6ZTtcbiAgfVxuXG4gIC8qKlxuICAgKiDorr7nva7liIbpobVcbiAgICovXG4gIHB1YmxpYyBzZXRQYWdpbmF0aW9uSW5mbyhwYWdpbmF0aW9uSW5mbzogYW55KSB7XG4gICAgdGhpcy5wYWdpbmF0aW9uSW5mbyA9IHsgLi4udGhpcy5wYWdpbmF0aW9uSW5mbywgLi4ucGFnaW5hdGlvbkluZm8gfTtcbiAgfVxuICBcbn1cbiJdfQ==
import { Modification, ModifyType } from '../changeset/index';
import { Subject } from 'rxjs';
import { Entity, FieldMetadataUtil, EntityList } from '../entity/index';
// tslint:disable: no-bitwise
/**
 * 实体集合
 * @todo：应该用EntityList代替。
 */
class EntityCollection {
    /**
     * 构造函数
     */
    constructor(entityType) {
        this.innerEntitySet = new Set();
        this.innerEntityMap = new Map();
        this.collectionChanged = new Subject();
        this.changes = new Subject();
        this.entityType = entityType;
        this.primaryKey = FieldMetadataUtil.getPrimaryKey(this.entityType);
    }
    /**
     * 实体数量
     */
    count() {
        return this.innerEntitySet.size;
    }
    get entityTypeName() {
        return this.entityType.name;
    }
    /**
     * 是否包含指定主键值的实体
     * @param id 主键值
     */
    has(id) {
        return this.innerEntityMap.has(id);
    }
    /**
     * 清空全部实体
     */
    clear() {
        this.innerEntityMap.clear();
        this.innerEntitySet.clear();
        this.notifyCollectionChanged(new Modification([], ModifyType.Load));
    }
    /**
     * 清空全部实体
     * @param isReset 是否为重置实体操作
     */
    reset() {
        this.innerEntityMap.clear();
        this.innerEntitySet.clear();
        const modification = new Modification([], ModifyType.Load);
        modification.isReset = true;
        this.notifyCollectionChanged(modification);
    }
    /**
     * 转换为实体数组
     */
    toArray() {
        return Array.from(this.innerEntitySet);
    }
    /**
     * 转换为JSON数组
     */
    toJSON() {
        const result = [];
        const entities = this.toArray();
        entities.forEach((entity) => {
            result.push(entity.toJSON());
        });
        return result;
    }
    /**
     * 批量加载实体
     */
    loadEntities(entities, entityCreate = false) {
        this.innerEntityMap.clear();
        this.innerEntitySet.clear();
        entities.forEach(entity => {
            this.innerEntitySet.add(entity);
            this.innerEntityMap.set(entity[this.primaryKey], entity);
            this.listenEntityChangeEvent(entity);
        });
        const modification = new Modification(entities, ModifyType.Load);
        modification.entityCreate = entityCreate;
        this.notifyCollectionChanged(modification);
    }
    /**
     * 追加实体
     * @param entity 要追加的实体
     * @param isCloned 实体是否是克隆的
     */
    addEntity(entity, isCloned = false) {
        this.verifyEntityToAdd(entity);
        this.innerEntitySet.add(entity);
        this.innerEntityMap.set(entity[this.primaryKey], entity);
        this.listenEntityChangeEvent(entity);
        const modifyType = isCloned ? ModifyType.Clone : ModifyType.Add;
        this.notifyCollectionChanged(new Modification([entity], modifyType));
    }
    /**
     * 在当前行前或后插入数据
     * @param entity 实体
     * @param position 位置
     */
    insertEntity(entity, position) {
        this.verifyEntityToAdd(entity);
        this.innerEntitySet.add(entity);
        this.innerEntityMap.set(entity[this.primaryKey], entity);
        this.listenEntityChangeEvent(entity);
        this.notifyCollectionChanged(new Modification(entity, ModifyType.Insert, null, null, position));
    }
    /**
     * 更新实体
     * @param entity entity
     * @param entityData 实体数据
     */
    updateEntity(entity, entityData) {
        entity.load(entityData);
        this.notifyCollectionChanged(new Modification(entity, ModifyType.Update, null, null));
    }
    /**
     * 批量追加实体
     * @param entities 要加载的实体数组
     */
    addEntities(entities) {
        if (!entities) {
            return;
        }
        const entitiesToAdd = [];
        entities.forEach(entity => {
            this.verifyEntityToAdd(entity);
            entitiesToAdd.push(entity);
        });
        entitiesToAdd.forEach(entity => {
            this.innerEntitySet.add(entity);
            this.innerEntityMap.set(entity[this.primaryKey], entity);
            this.listenEntityChangeEvent(entity);
        });
        this.notifyCollectionChanged(new Modification(entitiesToAdd, ModifyType.Add));
    }
    /**
     * 添加实体（不切换当前行）
     * @param entities 实体
     */
    addData(entities) {
        if (!entities) {
            return;
        }
        const entitiesToAdd = [];
        entities.forEach(entity => {
            this.verifyEntityToAdd(entity);
            entitiesToAdd.push(entity);
        });
        entitiesToAdd.forEach(entity => {
            this.innerEntitySet.add(entity);
            this.innerEntityMap.set(entity[this.primaryKey], entity);
            this.listenEntityChangeEvent(entity);
        });
        this.notifyCollectionChanged(new Modification(entitiesToAdd, ModifyType.AddData));
    }
    /**
     * 根据主键值获取实体
     */
    getEntityById(identity) {
        if (this.innerEntityMap.has(identity) === false) {
            return null;
        }
        const entity = this.innerEntityMap.get(identity);
        return entity;
    }
    /**
     * 根据路径获取实体
     */
    getEntityByPath(pathArray) {
        const rootEntityId = pathArray[0].split(':')[1];
        let parentNode = this.getEntityById(rootEntityId);
        for (let i = 1; i < pathArray.length && parentNode; i = i + 1) {
            const currentPath = pathArray[i];
            if (parentNode instanceof Entity) {
                // @todo：强识了别冒号
                if (currentPath.indexOf(':') === -1) {
                    parentNode = parentNode[pathArray[i]];
                }
            }
            else {
                parentNode = parentNode.get(pathArray[i].split(':')[1]);
            }
        }
        return parentNode;
    }
    /**
     * id:1/a/id:2/c
     * @param pathArray 路径数组
     */
    getEntitiesByPath(pathArray) {
        const rootEntityId = pathArray[0].split(':')[1];
        let entity = this.getEntityById(rootEntityId);
        for (let i = 1; i < pathArray.length && entity; i += 2) {
            const path = pathArray[i];
            entity = entity[path];
            if (!(entity instanceof EntityList)) {
                throw new Error('路径格式错误');
            }
            if ((i + 1) < pathArray.length) {
                const id = pathArray[i + 1].split(':')[1];
                entity = entity.get(id);
            }
        }
        return entity;
    }
    /**
     * 返回符合指定条件的实体集合
     * @param predicate 条件谓词
     */
    getEntities(predicate) {
        const entities = Array.from(this.innerEntitySet);
        const matchedEntities = entities.filter(predicate);
        return matchedEntities;
    }
    /**
     * 获取全部实体
     */
    getAllEntities() {
        return Array.from(this.innerEntitySet);
    }
    /**
     * 根据主键值删除对应实体
     * @param identity 主键值
     */
    removeEntityById(identity) {
        this.verifyEntityToRemove(identity);
        const entityToRemove = this.innerEntityMap.get(identity);
        this.innerEntityMap.delete(identity);
        this.innerEntitySet.delete(entityToRemove);
        this.notifyCollectionChanged(new Modification([entityToRemove], ModifyType.Remove));
        return entityToRemove;
    }
    removeEntitiesByIds(id) {
    }
    /**
     * 删除符合条件的实体集合
     */
    removeEntities(predicate) {
        const entitiesToRemove = Array.from(this.innerEntitySet).filter(predicate);
        entitiesToRemove.forEach(entityToRemove => {
            this.innerEntityMap.delete(entityToRemove[this.primaryKey]);
            this.innerEntitySet.delete(entityToRemove);
        });
        this.notifyCollectionChanged(new Modification(entitiesToRemove, ModifyType.Remove));
        return entitiesToRemove;
    }
    /**
     * 移除数据（不切换当前行）
     * @param predicate 过滤函数
     */
    removeData(predicate) {
        const entitiesToRemove = Array.from(this.innerEntitySet).filter(predicate);
        entitiesToRemove.forEach(entityToRemove => {
            this.innerEntityMap.delete(entityToRemove[this.primaryKey]);
            this.innerEntitySet.delete(entityToRemove);
        });
        this.notifyCollectionChanged(new Modification(entitiesToRemove, ModifyType.RemoveData));
        return entitiesToRemove;
    }
    /**
     * 重置子表数据
     * @param paths 路径
     * 路径格式 ['id:provinceId','id:cityMDMs','zoneMDMs']
     * @description path参数格式
     * ```json
     * [
     * "id:b5ed23ca-88d9-4377-98ec-92f35c1325f1",
     * "cityMDMs",
     * "id:373706af-622f-4aea-a006-dddbffd7bda3",
     * "zoneMDMs"
     * ]
     * ```
     * @param entities 实体数组
     */
    resetEntities(paths, entities) {
        if (paths[0].indexOf(':') === -1) {
            throw new Error('路径格式错误');
        }
        // paths里面第一个一定是id
        const entityInfo = paths[0].split(':');
        const [entityPrimaryKey, entityId] = entityInfo;
        let entity = null;
        for (const element of this.innerEntitySet) {
            if (element[entityPrimaryKey] === entityId) {
                entity = element;
                break;
            }
        }
        // for (let index = 0; index < this.innerEntitySet; index++) {
        //   const element: T = this.innerEntitySet[index];
        //   if (element[entityPrimaryKey] === entityId) {
        //     entity = element;
        //     break;
        //   }
        // }
        if (!entity) {
            throw new Error(`找不到${entityPrimaryKey}为${entityId}的实体`);
        }
        let data = entity;
        paths.slice(1).forEach(path => {
            data = data[path];
        });
        const entityList = data;
        entityList.clear();
        entityList.loadEntities(entities);
    }
    /**
     * 验证实体是否能够添加
     */
    verifyEntityToAdd(entity) {
        if (this.has(entity[this.primaryKey])) {
            this.innerEntitySet.delete(this.innerEntityMap.get(entity[this.primaryKey]));
            this.innerEntityMap.delete(entity[this.primaryKey]);
            // throw new Error(`The repository already had an item with the save identity of '${entity[this.primaryKey]}'`);
        }
        return true;
    }
    /**
     * 验证实体是否能移除
     */
    verifyEntityToRemove(identity) {
        if (!this.has(identity)) {
            throw new Error(`The entity with identity of '${identity} dose not exsit.'`);
        }
        return true;
    }
    /**
     * 实体集合变更流
     */
    notifyCollectionChanged(modification) {
        this.collectionChanged.next(modification);
    }
    //#region 分页
    /**
     * 设置分页大小
     */
    set pageSize(pageSize) {
        if (typeof (pageSize) !== 'number' || pageSize < 0) {
            throw new Error('Invalid parameter:pageSize');
        }
        const original = this.paginationInfo;
        // const entityPaginationInfo = Object.assign({}, original[this.entityTypeName], { pageSize });
        // this.paginationInfo = Object.assign({}, original, { [this.entityTypeName]: entityPaginationInfo });
        // this.notifyCollectionChanged(new Modification(this.paginationInfo[this.entityTypeName], ModifyType.PaginationInfoChange));
        this.paginationInfo = Object.assign({}, original, { pageSize });
        this.notifyCollectionChanged(new Modification(this.paginationInfo, ModifyType.PaginationInfoChange));
    }
    /**
     * 获取分页大小
     * @description 如果用户未指定分页大小则默认为0，即获取所有数据
     */
    get pageSize() {
        if (!!this.paginationInfo) {
            return this.paginationInfo.pageSize || 0;
        }
        return 0;
    }
    /**
     * 设置数据总条数
     */
    set totalCount(total) {
        if (typeof (total) !== 'number' || total < 0) {
            throw new Error('Invalid parameter:total');
        }
        const original = this.paginationInfo;
        // const entityPaginationInfo = Object.assign({}, original[this.entityTypeName], { total });
        // this.paginationInfo = Object.assign({}, original, { [this.entityTypeName]: entityPaginationInfo });
        this.paginationInfo = Object.assign({}, original, { total });
        this.notifyCollectionChanged(new Modification(this.paginationInfo, ModifyType.PaginationInfoChange));
    }
    /**
     * 获取数据总条数
     */
    get totalCount() {
        if (!!this.paginationInfo) {
            return this.paginationInfo.total || 0;
        }
        return 0;
    }
    /**
     * 设置当前页码
     */
    set pageIndex(pageIndex) {
        if (typeof (pageIndex) !== 'number' || pageIndex < 0) {
            throw new Error('Invalid parameter:pageIndex');
        }
        const original = this.paginationInfo;
        // const entityPaginationInfo = Object.assign({}, original[this.entityTypeName], { pageIndex });
        // this.paginationInfo = Object.assign({}, original, { [this.entityTypeName]: entityPaginationInfo });
        this.paginationInfo = Object.assign({}, original, { pageIndex });
        this.notifyCollectionChanged(new Modification(this.paginationInfo, ModifyType.PaginationInfoChange));
    }
    /**
     * 获取当前页码
     */
    get pageIndex() {
        if (!!this.paginationInfo) {
            return this.paginationInfo.pageIndex || 1;
        }
        return 1;
    }
    /**
     * 更新分页信息
     * @param path 绑定路径
     * @param pageInfo 分页信息
     */
    updatePaginationInfoByPath(path, pageInfo) {
        const original = this.paginationInfo;
        const { pageIndex, pageSize, totalCount: total } = pageInfo;
        const paginationInfo = Object.assign({}, original, { pageIndex, pageSize, total });
        this.setPaginationConfigByPath(path, paginationInfo);
    }
    /**
     * 根据路径获取分页大小
     * @param path 路径
     */
    getPaginationConfigByPath(path, defaultValue) {
        if (!path || path === '/') {
            return this.paginationInfo;
        }
        if (typeof path !== 'string') {
            throw new Error('路径必须为字符串！');
        }
        path = path.substring(1);
        const paths = path.split('/').filter(item => !!item && item.trim().length > 0).map(item => item.trim());
        let config = this.paginationInfo;
        paths.forEach(item => {
            if (config && config.hasOwnProperty(item)) {
                config = config[item];
            }
            else {
                config = null;
            }
        });
        return !!config ? config : typeof defaultValue !== 'undefined' ? defaultValue : undefined;
    }
    /**
     * 设置分页信息
     * @param path 路径
     * @param value 值
     */
    setPaginationConfigByPath(path, value) {
        const original = JSON.stringify(this.paginationInfo);
        if (!path || path === '/') {
            this.paginationInfo = value;
        }
        else {
            if (!Array.isArray(path)) {
                path = path.toString().match(/[^/[\]]+/g) || [];
            }
            path.slice(0, -1).reduce((prev, current, index) => Object(prev[current]) === prev[current]
                ? prev[current]
                : prev[current] = Math.abs(path[index + 1]) >> 0 === +path[index + 1]
                    ? []
                    : {}, this.paginationInfo)[path[path.length - 1]] = value;
        }
        if (JSON.stringify(this.paginationInfo) !== original) {
            this.notifyCollectionChanged(new Modification(this.paginationInfo, ModifyType.PaginationInfoChange));
        }
        return this.paginationInfo;
    }
    //#endregion
    /**
     * 监听实体变更
     */
    listenEntityChangeEvent(entity) {
        if (entity) {
            entity.onValueChanged.subscribe((change) => this.changes.next(change));
        }
    }
}
export { EntityCollection };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZW50aXR5X2NvbGxlY3Rpb24uanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL21vYmlsZS1kZXZraXQvIiwic291cmNlcyI6WyJsaWIvcmVwb3NpdG9yeS9lbnRpdHlfY29sbGVjdGlvbi50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFPQSxPQUFPLEVBQUUsWUFBWSxFQUFFLFVBQVUsRUFBRSxNQUFNLG9CQUFvQixDQUFDO0FBQzlELE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDL0IsT0FBTyxFQUFFLE1BQU0sRUFBRSxpQkFBaUIsRUFBRSxVQUFVLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUd4RSw2QkFBNkI7QUFDN0I7OztHQUdHO0FBQ0gsTUFBTSxnQkFBZ0I7SUE0Q3BCOztPQUVHO0lBQ0gsWUFBWSxVQUFtQjtRQUM3QixJQUFJLENBQUMsY0FBYyxHQUFHLElBQUksR0FBRyxFQUFLLENBQUM7UUFDbkMsSUFBSSxDQUFDLGNBQWMsR0FBRyxJQUFJLEdBQUcsRUFBYSxDQUFDO1FBQzNDLElBQUksQ0FBQyxpQkFBaUIsR0FBRyxJQUFJLE9BQU8sRUFBZ0IsQ0FBQztRQUNyRCxJQUFJLENBQUMsT0FBTyxHQUFHLElBQUksT0FBTyxFQUFnQixDQUFDO1FBRTNDLElBQUksQ0FBQyxVQUFVLEdBQUcsVUFBVSxDQUFDO1FBQzdCLElBQUksQ0FBQyxVQUFVLEdBQUcsaUJBQWlCLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQztJQUNyRSxDQUFDO0lBRUQ7O09BRUc7SUFDSSxLQUFLO1FBQ1YsT0FBTyxJQUFJLENBQUMsY0FBYyxDQUFDLElBQUksQ0FBQztJQUNsQyxDQUFDO0lBRUQsSUFBVyxjQUFjO1FBQ3ZCLE9BQU8sSUFBSSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUM7SUFDOUIsQ0FBQztJQUNEOzs7T0FHRztJQUNJLEdBQUcsQ0FBQyxFQUFVO1FBQ25CLE9BQU8sSUFBSSxDQUFDLGNBQWMsQ0FBQyxH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Q0FBQztnQkFDZixDQUFDLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLEtBQUssR0FBRyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFDO29CQUNuRSxDQUFDLENBQUMsRUFBRTtvQkFDSixDQUFDLENBQUMsRUFBRSxFQUNSLElBQUksQ0FBQyxjQUFjLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsQ0FBQyxHQUFHLEtBQUssQ0FBQztTQUN2RDtRQUVELElBQUksSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsY0FBYyxDQUFDLEtBQUssUUFBUSxFQUFFO1lBQ3BELElBQUksQ0FBQyx1QkFBdUIsQ0FBQyxJQUFJLFlBQVksQ0FBQyxJQUFJLENBQUMsY0FBYyxFQUFFLFVBQVUsQ0FBQyxvQkFBb0IsQ0FBQyxDQUFDLENBQUM7U0FDdEc7UUFDRCxPQUFPLElBQUksQ0FBQyxjQUFjLENBQUM7SUFDN0IsQ0FBQztJQUNELFlBQVk7SUFFWjs7T0FFRztJQUNLLHVCQUF1QixDQUFDLE1BQWM7UUFDNUMsSUFBSSxNQUFNLEVBQUU7WUFDVixNQUFNLENBQUMsY0FBYyxDQUFDLFNBQVMsQ0FBQyxDQUFDLE1BQW9CLEVBQUUsRUFBRSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7U0FDdEY7SUFDSCxDQUFDO0NBRUY7QUFFRCxPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8qXG4gKiBAQXV0aG9yOiBXaXR0XG4gKiBARGF0ZTogMjAxOC0xMC0wMSAxOTozNjo1MVxuICogQExhc3QgTW9kaWZpZWQgYnk6IGFhbGl6endlbGxcbiAqIEBMYXN0IE1vZGlmaWVkIHRpbWU6IDIwMTktMDktMDMgMTk6NDY6NDJcbiAqL1xuaW1wb3J0IHsgVHlwZSB9IGZyb20gJy4uL2NvcmUvaW5kZXgnO1xuaW1wb3J0IHsgTW9kaWZpY2F0aW9uLCBNb2RpZnlUeXBlIH0gZnJvbSAnLi4vY2hhbmdlc2V0L2luZGV4JztcbmltcG9ydCB7IFN1YmplY3QgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IEVudGl0eSwgRmllbGRNZXRhZGF0YVV0aWwsIEVudGl0eUxpc3QgfSBmcm9tICcuLi9lbnRpdHkvaW5kZXgnO1xuaW1wb3J0IHsgRGF0YVR5cGVJbmZvIH0gZnJvbSAnLi4vZW50aXR5L2luZGV4JztcblxuLy8gdHNsaW50OmRpc2FibGU6IG5vLWJpdHdpc2Vcbi8qKlxuICog5a6e5L2T6ZuG5ZCIXG4gKiBAdG9kb++8muW6lOivpeeUqEVudGl0eUxpc3Tku6Pmm7/jgIJcbiAqL1xuY2xhc3MgRW50aXR5Q29sbGVjdGlvbjxUIGV4dGVuZHMgRW50aXR5PiB7XG5cbiAgLyoqXG4gICAqIOWGhemDqOWunuS9k1NldFxuICAgKi9cbiAgcHJpdmF0ZSBpbm5lckVudGl0eVNldDogU2V0PFQ+O1xuXG4gIC8qKlxuICAgKiDlhoXpg6jlrp7kvZNNYXBcbiAgICovXG4gIHByaXZhdGUgaW5uZXJFbnRpdHlNYXA6IE1hcDxzdHJpbmcsIFQ+O1xuXG5cbiAgLyoqXG4gICAqIEVudGl0eembhuWQiOWPmOabtOa1gVxuICAgKi9cbiAgcHVibGljIGNvbGxlY3Rpb25DaGFuZ2VkOiBTdWJqZWN0PE1vZGlmaWNhdGlvbj47XG5cbiAgLyoqXG4gICAqIOWGhemDqOWunuS9k+WPmOabtFxuICAgKi9cbiAgcHVibGljIGNoYW5nZXM6IFN1YmplY3Q8TW9kaWZpY2F0aW9uPjtcblxuICAvKipcbiAgICog5a6e5L2T57G75Z6LXG4gICAqL1xuICBwdWJsaWMgcmVhZG9ubHkgZW50aXR5VHlwZTogVHlwZTxUPjtcblxuICAvKipcbiAgICog5a6e5L2T5Li76ZSuXG4gICAqL1xuICBwdWJsaWMgcmVhZG9ubHkgcHJpbWFyeUtleTogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiDlrp7kvZPlvZPliY3liIbpobXkv6Hmga9cbiAgICovXG4gIHB1YmxpYyBwYWdpbmF0aW9uSW5mbzogYW55O1xuXG4gIC8qKlxuICAgKiDlrp7kvZPnsbvlnovmj4/ov7BcbiAgICovXG4gIHB1YmxpYyBlbnRpdHlUeXBlSW5mbzogRGF0YVR5cGVJbmZvO1xuXG5cbiAgLyoqXG4gICAqIOaehOmAoOWHveaVsFxuICAgKi9cbiAgY29uc3RydWN0b3IoZW50aXR5VHlwZTogVHlwZTxUPikge1xuICAgIHRoaXMuaW5uZXJFbnRpdHlTZXQgPSBuZXcgU2V0PFQ+KCk7XG4gICAgdGhpcy5pbm5lckVudGl0eU1hcCA9IG5ldyBNYXA8c3RyaW5nLCBUPigpO1xuICAgIHRoaXMuY29sbGVjdGlvbkNoYW5nZWQgPSBuZXcgU3ViamVjdDxNb2RpZmljYXRpb24+KCk7XG4gICAgdGhpcy5jaGFuZ2VzID0gbmV3IFN1YmplY3Q8TW9kaWZpY2F0aW9uPigpO1xuXG4gICAgdGhpcy5lbnRpdHlUeXBlID0gZW50aXR5VHlwZTtcbiAgICB0aGlzLnByaW1hcnlLZXkgPSBGaWVsZE1ldGFkYXRhVXRpbC5nZXRQcmltYXJ5S2V5KHRoaXMuZW50aXR5VHlwZSk7XG4gIH1cblxuICAvKipcbiAgICog5a6e5L2T5pWw6YePXG4gICAqL1xuICBwdWJsaWMgY291bnQoKTogbnVtYmVyIHtcbiAgICByZXR1cm4gdGhpcy5pbm5lckVudGl0eVNldC5zaXplO1xuICB9XG5cbiAgcHVibGljIGdldCBlbnRpdHlUeXBlTmFtZSgpIHtcbiAgICByZXR1cm4gdGhpcy5lbnRpdHlUeXBlLm5hbWU7XG4gIH1cbiAgLyoqXG4gICAqIOaYr+WQpuWMheWQq+aMh+WumuS4u+mUruWAvOeahOWunuS9k1xuICAgKiBAcGFyYW0gaWQg5Li76ZSu5YC8XG4gICAqL1xuICBwdWJsaWMgaGFzKGlkOiBzdHJpbmcpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5pbm5lckVudGl0eU1hcC5oYXMoaWQpO1xuICB9XG5cbiAgLyoqXG4gICAqIOa4heepuuWFqOmDqOWunuS9k1xuICAgKi9cbiAgcHVibGljIGNsZWFyKCkge1xuICAgIHRoaXMuaW5uZXJFbnRpdHlNYXAuY2xlYXIoKTtcbiAgICB0aGlzLmlubmVyRW50aXR5U2V0LmNsZWFyKCk7XG4gICAgdGhpcy5ub3RpZnlDb2xsZWN0aW9uQ2hhbmdlZChuZXcgTW9kaWZpY2F0aW9uKFtdLCBNb2RpZnlUeXBlLkxvYWQpKTtcbiAgfVxuICAvKipcbiAgICog5riF56m65YWo6YOo5a6e5L2TXG4gICAqIEBwYXJhbSBpc1Jlc2V0IOaYr+WQpuS4uumHjee9ruWunuS9k+aTjeS9nFxuICAgKi9cbiAgcHVibGljIHJlc2V0KCkge1xuICAgIHRoaXMuaW5uZXJFbnRpdHlNYXAuY2xlYXIoKTtcbiAgICB0aGlzLmlubmVyRW50aXR5U2V0LmNsZWFyKCk7XG4gICAgY29uc3QgbW9kaWZpY2F0aW9uID0gbmV3IE1vZGlmaWNhdGlvbihbXSwgTW9kaWZ5VHlwZS5Mb2FkKTtcbiAgICBtb2RpZmljYXRpb24uaXNSZXNldCA9IHRydWU7XG4gICAgdGhpcy5ub3RpZnlDb2xsZWN0aW9uQ2hhbmdlZChtb2RpZmljYXRpb24pO1xuICB9XG4gIC8qKlxuICAgKiDovazmjaLkuLrlrp7kvZPmlbDnu4RcbiAgICovXG4gIHB1YmxpYyB0b0FycmF5KCk6IEVudGl0eVtdIHtcbiAgICByZXR1cm4gQXJyYXkuZnJvbSh0aGlzLmlubmVyRW50aXR5U2V0KTtcbiAgfVxuXG4gIC8qKlxuICAgKiDovazmjaLkuLpKU09O5pWw57uEXG4gICAqL1xuICBwdWJsaWMgdG9KU09OKCk6IGFueVtdIHtcbiAgICBjb25zdCByZXN1bHQgPSBbXTtcbiAgICBjb25zdCBlbnRpdGllcyA9IHRoaXMudG9BcnJheSgpO1xuICAgIGVudGl0aWVzLmZvckVhY2goKGVudGl0eTogRW50aXR5KSA9PiB7XG4gICAgICByZXN1bHQucHVzaChlbnRpdHkudG9KU09OKCkpO1xuICAgIH0pO1xuICAgIHJldHVybiByZXN1bHQ7XG4gIH1cblxuICAvKipcbiAgICog5om56YeP5Yqg6L295a6e5L2TXG4gICAqL1xuICBwdWJsaWMgbG9hZEVudGl0aWVzKGVudGl0aWVzOiBhbnlbXSwgZW50aXR5Q3JlYXRlOiBib29sZWFuID0gZmFsc2UpIHtcblxuICAgIHRoaXMuaW5uZXJFbnRpdHlNYXAuY2xlYXIoKTtcbiAgICB0aGlzLmlubmVyRW50aXR5U2V0LmNsZWFyKCk7XG5cbiAgICBlbnRpdGllcy5mb3JFYWNoKGVudGl0eSA9PiB7XG4gICAgICB0aGlzLmlubmVyRW50aXR5U2V0LmFkZChlbnRpdHkpO1xuICAgICAgdGhpcy5pbm5lckVudGl0eU1hcC5zZXQoZW50aXR5W3RoaXMucHJpbWFyeUtleV0sIGVudGl0eSk7XG4gICAgICB0aGlzLmxpc3RlbkVudGl0eUNoYW5nZUV2ZW50KGVudGl0eSk7XG4gICAgfSk7XG4gICAgY29uc3QgbW9kaWZpY2F0aW9uID0gbmV3IE1vZGlmaWNhdGlvbihlbnRpdGllcywgTW9kaWZ5VHlwZS5Mb2FkKTtcbiAgICBtb2RpZmljYXRpb24uZW50aXR5Q3JlYXRlID0gZW50aXR5Q3JlYXRlO1xuICAgIHRoaXMubm90aWZ5Q29sbGVjdGlvbkNoYW5nZWQobW9kaWZpY2F0aW9uKTtcblxuICB9XG5cbiAgLyoqXG4gICAqIOi/veWKoOWunuS9k1xuICAgKiBAcGFyYW0gZW50aXR5IOimgei/veWKoOeahOWunuS9k1xuICAgKiBAcGFyYW0gaXNDbG9uZWQg5a6e5L2T5piv5ZCm5piv5YWL6ZqG55qEXG4gICAqL1xuICBwdWJsaWMgYWRkRW50aXR5KGVudGl0eTogVCwgIGlzQ2xvbmVkOiBib29sZWFuID0gZmFsc2UpIHtcbiAgICB0aGlzLnZlcmlmeUVudGl0eVRvQWRkKGVudGl0eSk7XG4gICAgdGhpcy5pbm5lckVudGl0eVNldC5hZGQoZW50aXR5KTtcbiAgICB0aGlzLmlubmVyRW50aXR5TWFwLnNldChlbnRpdHlbdGhpcy5wcmltYXJ5S2V5XSwgZW50aXR5KTtcbiAgICB0aGlzLmxpc3RlbkVudGl0eUNoYW5nZUV2ZW50KGVudGl0eSk7XG4gICAgY29uc3QgbW9kaWZ5VHlwZSA9IGlzQ2xvbmVkID8gTW9kaWZ5VHlwZS5DbG9uZSA6IE1vZGlmeVR5cGUuQWRkO1xuICAgIHRoaXMubm90aWZ5Q29sbGVjdGlvbkNoYW5nZWQobmV3IE1vZGlmaWNhdGlvbihbZW50aXR5XSwgbW9kaWZ5VHlwZSkpO1xuICB9XG4gIC8qKlxuICAgKiDlnKjlvZPliY3ooYzliY3miJblkI7mj5LlhaXmlbDmja5cbiAgICogQHBhcmFtIGVudGl0eSDlrp7kvZNcbiAgICogQHBhcmFtIHBvc2l0aW9uIOS9jee9rlxuICAgKi9cbiAgcHVibGljIGluc2VydEVudGl0eShlbnRpdHk6IGFueSwgcG9zaXRpb246IDEgfCAtMSkge1xuICAgIHRoaXMudmVyaWZ5RW50aXR5VG9BZGQoZW50aXR5KTtcbiAgICB0aGlzLmlubmVyRW50aXR5U2V0LmFkZChlbnRpdHkpO1xuICAgIHRoaXMuaW5uZXJFbnRpdHlNYXAuc2V0KGVudGl0eVt0aGlzLnByaW1hcnlLZXldLCBlbnRpdHkpO1xuICAgIHRoaXMubGlzdGVuRW50aXR5Q2hhbmdlRXZlbnQoZW50aXR5KTtcbiAgICB0aGlzLm5vdGlmeUNvbGxlY3Rpb25DaGFuZ2VkKG5ldyBNb2RpZmljYXRpb24oZW50aXR5LCBNb2RpZnlUeXBlLkluc2VydCwgbnVsbCwgbnVsbCwgcG9zaXRpb24pKTtcbiAgfVxuICAvKipcbiAgICog5pu05paw5a6e5L2TXG4gICAqIEBwYXJhbSBlbnRpdHkgZW50aXR5XG4gICAqIEBwYXJhbSBlbnRpdHlEYXRhIOWunuS9k+aVsOaNrlxuICAgKi9cbiAgcHVibGljIHVwZGF0ZUVudGl0eShlbnRpdHk6IGFueSwgZW50aXR5RGF0YTogYW55KSB7XG4gICAgZW50aXR5LmxvYWQoZW50aXR5RGF0YSk7XG4gICAgdGhpcy5ub3RpZnlDb2xsZWN0aW9uQ2hhbmdlZChuZXcgTW9kaWZpY2F0aW9uKGVudGl0eSwgTW9kaWZ5VHlwZS5VcGRhdGUsIG51bGwsIG51bGwpKTtcbiAgfVxuICAvKipcbiAgICog5om56YeP6L+95Yqg5a6e5L2TXG4gICAqIEBwYXJhbSBlbnRpdGllcyDopoHliqDovb3nmoTlrp7kvZPmlbDnu4RcbiAgICovXG4gIHB1YmxpYyBhZGRFbnRpdGllcyhlbnRpdGllczogVFtdKSB7XG4gICAgaWYgKCFlbnRpdGllcykge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zdCBlbnRpdGllc1RvQWRkOiBUW10gPSBbXTtcbiAgICBlbnRpdGllcy5mb3JFYWNoKGVudGl0eSA9PiB7XG4gICAgICB0aGlzLnZlcmlmeUVudGl0eVRvQWRkKGVudGl0eSk7XG4gICAgICBlbnRpdGllc1RvQWRkLnB1c2goZW50aXR5KTtcbiAgICB9KTtcbiAgICBlbnRpdGllc1RvQWRkLmZvckVhY2goZW50aXR5ID0+IHtcbiAgICAgIHRoaXMuaW5uZXJFbnRpdHlTZXQuYWRkKGVudGl0eSk7XG4gICAgICB0aGlzLmlubmVyRW50aXR5TWFwLnNldChlbnRpdHlbdGhpcy5wcmltYXJ5S2V5XSwgZW50aXR5KTtcbiAgICAgIHRoaXMubGlzdGVuRW50aXR5Q2hhbmdlRXZlbnQoZW50aXR5KTtcbiAgICB9KTtcbiAgICB0aGlzLm5vdGlmeUNvbGxlY3Rpb25DaGFuZ2VkKG5ldyBNb2RpZmljYXRpb24oZW50aXRpZXNUb0FkZCwgTW9kaWZ5VHlwZS5BZGQpKTtcbiAgfVxuICAvKipcbiAgICog5re75Yqg5a6e5L2T77yI5LiN5YiH5o2i5b2T5YmN6KGM77yJXG4gICAqIEBwYXJhbSBlbnRpdGllcyDlrp7kvZNcbiAgICovXG4gIHB1YmxpYyBhZGREYXRhKGVudGl0aWVzOiBhbnlbXSkge1xuICAgIGlmICghZW50aXRpZXMpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc3QgZW50aXRpZXNUb0FkZDogYW55W10gPSBbXTtcbiAgICBlbnRpdGllcy5mb3JFYWNoKGVudGl0eSA9PiB7XG4gICAgICB0aGlzLnZlcmlmeUVudGl0eVRvQWRkKGVudGl0eSk7XG4gICAgICBlbnRpdGllc1RvQWRkLnB1c2goZW50aXR5KTtcbiAgICB9KTtcbiAgICBlbnRpdGllc1RvQWRkLmZvckVhY2goZW50aXR5ID0+IHtcbiAgICAgIHRoaXMuaW5uZXJFbnRpdHlTZXQuYWRkKGVudGl0eSk7XG4gICAgICB0aGlzLmlubmVyRW50aXR5TWFwLnNldChlbnRpdHlbdGhpcy5wcmltYXJ5S2V5XSwgZW50aXR5KTtcbiAgICAgIHRoaXMubGlzdGVuRW50aXR5Q2hhbmdlRXZlbnQoZW50aXR5KTtcbiAgICB9KTtcbiAgICB0aGlzLm5vdGlmeUNvbGxlY3Rpb25DaGFuZ2VkKG5ldyBNb2RpZmljYXRpb24oZW50aXRpZXNUb0FkZCwgTW9kaWZ5VHlwZS5BZGREYXRhKSk7XG4gIH1cblxuXG4gIC8qKlxuICAgKiDmoLnmja7kuLvplK7lgLzojrflj5blrp7kvZNcbiAgICovXG4gIGdldEVudGl0eUJ5SWQoaWRlbnRpdHk6IHN0cmluZyk6IFQge1xuICAgIGlmICh0aGlzLmlubmVyRW50aXR5TWFwLmhhcyhpZGVudGl0eSkgPT09IGZhbHNlKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgY29uc3QgZW50aXR5ID0gdGhpcy5pbm5lckVudGl0eU1hcC5nZXQoaWRlbnRpdHkpO1xuICAgIHJldHVybiBlbnRpdHk7XG4gIH1cblxuICAvKipcbiAgICog5qC55o2u6Lev5b6E6I635Y+W5a6e5L2TXG4gICAqL1xuICBnZXRFbnRpdHlCeVBhdGgocGF0aEFycmF5OiBzdHJpbmdbXSk6IGFueSB7XG4gICAgY29uc3Qgcm9vdEVudGl0eUlkID0gcGF0aEFycmF5WzBdLnNwbGl0KCc6JylbMV07XG5cbiAgICBsZXQgcGFyZW50Tm9kZTogYW55ID0gdGhpcy5nZXRFbnRpdHlCeUlkKHJvb3RFbnRpdHlJZCk7XG4gICAgZm9yIChsZXQgaSA9IDE7IGkgPCBwYXRoQXJyYXkubGVuZ3RoICYmIHBhcmVudE5vZGU7IGkgPSBpICsgMSkge1xuICAgICAgY29uc3QgY3VycmVudFBhdGggPSBwYXRoQXJyYXlbaV07XG4gICAgICBpZiAocGFyZW50Tm9kZSBpbnN0YW5jZW9mIEVudGl0eSkge1xuXG4gICAgICAgIC8vIEB0b2Rv77ya5by66K+G5LqG5Yir5YaS5Y+3XG4gICAgICAgIGlmIChjdXJyZW50UGF0aC5pbmRleE9mKCc6JykgPT09IC0xKSB7XG4gICAgICAgICAgcGFyZW50Tm9kZSA9IHBhcmVudE5vZGVbcGF0aEFycmF5W2ldXTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcGFyZW50Tm9kZSA9IHBhcmVudE5vZGUuZ2V0KHBhdGhBcnJheVtpXS5zcGxpdCgnOicpWzFdKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gcGFyZW50Tm9kZTtcbiAgfVxuICAvKipcbiAgICogaWQ6MS9hL2lkOjIvY1xuICAgKiBAcGFyYW0gcGF0aEFycmF5IOi3r+W+hOaVsOe7hFxuICAgKi9cbiAgcHVibGljIGdldEVudGl0aWVzQnlQYXRoKHBhdGhBcnJheTogc3RyaW5nW10pIHtcbiAgICBjb25zdCByb290RW50aXR5SWQgPSBwYXRoQXJyYXlbMF0uc3BsaXQoJzonKVsxXTtcbiAgICBsZXQgZW50aXR5OiBhbnkgPSB0aGlzLmdldEVudGl0eUJ5SWQocm9vdEVudGl0eUlkKTtcbiAgICBmb3IgKGxldCBpID0gMTsgaSA8IHBhdGhBcnJheS5sZW5ndGggJiYgZW50aXR5OyBpICs9IDIpIHtcbiAgICAgIGNvbnN0IHBhdGggPSBwYXRoQXJyYXlbaV07XG4gICAgICBlbnRpdHkgPSBlbnRpdHlbcGF0aF07XG4gICAgICBpZiAoIShlbnRpdHkgaW5zdGFuY2VvZiBFbnRpdHlMaXN0KSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ+i3r+W+hOagvOW8j+mUmeivrycpO1xuICAgICAgfVxuICAgICAgaWYgKChpICsgMSkgPCBwYXRoQXJyYXkubGVuZ3RoKSB7XG4gICAgICAgIGNvbnN0IGlkID0gcGF0aEFycmF5W2kgKyAxXS5zcGxpdCgnOicpWzFdO1xuICAgICAgICBlbnRpdHkgPSBlbnRpdHkuZ2V0KGlkKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGVudGl0eTtcbiAgfVxuICAvKipcbiAgICog6L+U5Zue56ym5ZCI5oyH5a6a5p2h5Lu255qE5a6e5L2T6ZuG5ZCIXG4gICAqIEBwYXJhbSBwcmVkaWNhdGUg5p2h5Lu26LCT6K+NXG4gICAqL1xuICBnZXRFbnRpdGllcyhwcmVkaWNhdGU6ICh2YWx1ZTogVCwgaW5kZXg6IG51bWJlciwgYXJyYXk6IFRbXSkgPT4gVCk6IFRbXSB7XG4gICAgY29uc3QgZW50aXRpZXM6IFRbXSA9IEFycmF5LmZyb20odGhpcy5pbm5lckVudGl0eVNldCk7XG4gICAgY29uc3QgbWF0Y2hlZEVudGl0aWVzID0gZW50aXRpZXMuZmlsdGVyKHByZWRpY2F0ZSk7XG4gICAgcmV0dXJuIG1hdGNoZWRFbnRpdGllcztcbiAgfVxuXG4gIC8qKlxuICAgKiDojrflj5blhajpg6jlrp7kvZNcbiAgICovXG4gIGdldEFsbEVudGl0aWVzKCk6IFRbXSB7XG4gICAgcmV0dXJuIEFycmF5LmZyb20odGhpcy5pbm5lckVudGl0eVNldCk7XG4gIH1cblxuICAvKipcbiAgICog5qC55o2u5Li76ZSu5YC85Yig6Zmk5a+55bqU5a6e5L2TXG4gICAqIEBwYXJhbSBpZGVudGl0eSDkuLvplK7lgLxcbiAgICovXG4gIHJlbW92ZUVudGl0eUJ5SWQoaWRlbnRpdHk6IHN0cmluZyk6IFQge1xuICAgIHRoaXMudmVyaWZ5RW50aXR5VG9SZW1vdmUoaWRlbnRpdHkpO1xuICAgIGNvbnN0IGVudGl0eVRvUmVtb3ZlID0gdGhpcy5pbm5lckVudGl0eU1hcC5nZXQoaWRlbnRpdHkpO1xuICAgIHRoaXMuaW5uZXJFbnRpdHlNYXAuZGVsZXRlKGlkZW50aXR5KTtcbiAgICB0aGlzLmlubmVyRW50aXR5U2V0LmRlbGV0ZShlbnRpdHlUb1JlbW92ZSk7XG4gICAgdGhpcy5ub3RpZnlDb2xsZWN0aW9uQ2hhbmdlZChuZXcgTW9kaWZpY2F0aW9uKFtlbnRpdHlUb1JlbW92ZV0sIE1vZGlmeVR5cGUuUmVtb3ZlKSk7XG4gICAgcmV0dXJuIGVudGl0eVRvUmVtb3ZlO1xuICB9XG5cbiAgcmVtb3ZlRW50aXRpZXNCeUlkcyhpZDogc3RyaW5nKSB7XG4gIH1cblxuICAvKipcbiAgICog5Yig6Zmk56ym5ZCI5p2h5Lu255qE5a6e5L2T6ZuG5ZCIXG4gICAqL1xuICBwdWJsaWMgcmVtb3ZlRW50aXRpZXMocHJlZGljYXRlOiAodmFsdWU6IFQsIGluZGV4OiBudW1iZXIsIGFycmF5OiBUW10pID0+IGFueSk6IFRbXSB7XG4gICAgY29uc3QgZW50aXRpZXNUb1JlbW92ZSA9IEFycmF5LmZyb20odGhpcy5pbm5lckVudGl0eVNldCkuZmlsdGVyKHByZWRpY2F0ZSk7XG4gICAgZW50aXRpZXNUb1JlbW92ZS5mb3JFYWNoKGVudGl0eVRvUmVtb3ZlID0+IHtcbiAgICAgIHRoaXMuaW5uZXJFbnRpdHlNYXAuZGVsZXRlKGVudGl0eVRvUmVtb3ZlW3RoaXMucHJpbWFyeUtleV0pO1xuICAgICAgdGhpcy5pbm5lckVudGl0eVNldC5kZWxldGUoZW50aXR5VG9SZW1vdmUpO1xuICAgIH0pO1xuICAgIHRoaXMubm90aWZ5Q29sbGVjdGlvbkNoYW5nZWQobmV3IE1vZGlmaWNhdGlvbihlbnRpdGllc1RvUmVtb3ZlLCBNb2RpZnlUeXBlLlJlbW92ZSkpO1xuICAgIHJldHVybiBlbnRpdGllc1RvUmVtb3ZlO1xuICB9XG4gIC8qKlxuICAgKiDnp7vpmaTmlbDmja7vvIjkuI3liIfmjaLlvZPliY3ooYzvvIlcbiAgICogQHBhcmFtIHByZWRpY2F0ZSDov4fmu6Tlh73mlbBcbiAgICovXG4gIHB1YmxpYyByZW1vdmVEYXRhKHByZWRpY2F0ZTogKHZhbHVlOiBhbnksIGluZGV4OiBudW1iZXIsIGFycmF5OiBhbnlbXSkgPT4gYW55KTogYW55W10ge1xuICAgIGNvbnN0IGVudGl0aWVzVG9SZW1vdmUgPSBBcnJheS5mcm9tKHRoaXMuaW5uZXJFbnRpdHlTZXQpLmZpbHRlcihwcmVkaWNhdGUpO1xuICAgIGVudGl0aWVzVG9SZW1vdmUuZm9yRWFjaChlbnRpdHlUb1JlbW92ZSA9PiB7XG4gICAgICB0aGlzLmlubmVyRW50aXR5TWFwLmRlbGV0ZShlbnRpdHlUb1JlbW92ZVt0aGlzLnByaW1hcnlLZXldKTtcbiAgICAgIHRoaXMuaW5uZXJFbnRpdHlTZXQuZGVsZXRlKGVudGl0eVRvUmVtb3ZlKTtcbiAgICB9KTtcbiAgICB0aGlzLm5vdGlmeUNvbGxlY3Rpb25DaGFuZ2VkKG5ldyBNb2RpZmljYXRpb24oZW50aXRpZXNUb1JlbW92ZSwgTW9kaWZ5VHlwZS5SZW1vdmVEYXRhKSk7XG4gICAgcmV0dXJuIGVudGl0aWVzVG9SZW1vdmU7XG4gIH1cbiAgLyoqXG4gICAqIOmHjee9ruWtkOihqOaVsOaNrlxuICAgKiBAcGFyYW0gcGF0aHMg6Lev5b6EXG4gICAqIOi3r+W+hOagvOW8jyBbJ2lkOnByb3ZpbmNlSWQnLCdpZDpjaXR5TURNcycsJ3pvbmVNRE1zJ11cbiAgICogQGRlc2NyaXB0aW9uIHBhdGjlj4LmlbDmoLzlvI9cbiAgICogYGBganNvblxuICAgKiBbXG4gICAqIFwiaWQ6YjVlZDIzY2EtODhkOS00Mzc3LTk4ZWMtOTJmMzVjMTMyNWYxXCIsXG4gICAqIFwiY2l0eU1ETXNcIixcbiAgICogXCJpZDozNzM3MDZhZi02MjJmLTRhZWEtYTAwNi1kZGRiZmZkN2JkYTNcIixcbiAgICogXCJ6b25lTURNc1wiXG4gICAqIF1cbiAgICogYGBgXG4gICAqIEBwYXJhbSBlbnRpdGllcyDlrp7kvZPmlbDnu4RcbiAgICovXG4gIHB1YmxpYyByZXNldEVudGl0aWVzKHBhdGhzOiBzdHJpbmdbXSwgZW50aXRpZXM6IFRbXSkge1xuICAgIGlmIChwYXRoc1swXS5pbmRleE9mKCc6JykgPT09IC0xKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ+i3r+W+hOagvOW8j+mUmeivrycpO1xuICAgIH1cbiAgICAvLyBwYXRoc+mHjOmdouesrOS4gOS4quS4gOWumuaYr2lkXG4gICAgY29uc3QgZW50aXR5SW5mbzogc3RyaW5nW10gPSBwYXRoc1swXS5zcGxpdCgnOicpO1xuICAgIGNvbnN0IFtlbnRpdHlQcmltYXJ5S2V5LCBlbnRpdHlJZF0gPSBlbnRpdHlJbmZvO1xuICAgIGxldCBlbnRpdHk6IFQgPSBudWxsO1xuICAgIGZvciAoY29uc3QgZWxlbWVudCBvZiB0aGlzLmlubmVyRW50aXR5U2V0KSB7XG4gICAgICBpZiAoZWxlbWVudFtlbnRpdHlQcmltYXJ5S2V5XSA9PT0gZW50aXR5SWQpIHtcbiAgICAgICAgZW50aXR5ID0gZWxlbWVudDtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgfVxuICAgIC8vIGZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCB0aGlzLmlubmVyRW50aXR5U2V0OyBpbmRleCsrKSB7XG4gICAgLy8gICBjb25zdCBlbGVtZW50OiBUID0gdGhpcy5pbm5lckVudGl0eVNldFtpbmRleF07XG4gICAgLy8gICBpZiAoZWxlbWVudFtlbnRpdHlQcmltYXJ5S2V5XSA9PT0gZW50aXR5SWQpIHtcbiAgICAvLyAgICAgZW50aXR5ID0gZWxlbWVudDtcbiAgICAvLyAgICAgYnJlYWs7XG4gICAgLy8gICB9XG4gICAgLy8gfVxuICAgIGlmICghZW50aXR5KSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYOaJvuS4jeWIsCR7ZW50aXR5UHJpbWFyeUtleX3kuLoke2VudGl0eUlkfeeahOWunuS9k2ApO1xuICAgIH1cbiAgICBsZXQgZGF0YTogYW55ID0gZW50aXR5O1xuICAgIHBhdGhzLnNsaWNlKDEpLmZvckVhY2gocGF0aCA9PiB7XG4gICAgICBkYXRhID0gZGF0YVtwYXRoXTtcbiAgICB9KTtcbiAgICBjb25zdCBlbnRpdHlMaXN0ID0gZGF0YSBhcyBFbnRpdHlMaXN0PFQ+O1xuICAgIGVudGl0eUxpc3QuY2xlYXIoKTtcbiAgICBlbnRpdHlMaXN0LmxvYWRFbnRpdGllcyhlbnRpdGllcyk7XG4gIH1cblxuICAvKipcbiAgICog6aqM6K+B5a6e5L2T5piv5ZCm6IO95aSf5re75YqgXG4gICAqL1xuICBwcml2YXRlIHZlcmlmeUVudGl0eVRvQWRkKGVudGl0eTogVCk6IGJvb2xlYW4ge1xuICAgIGlmICh0aGlzLmhhcyhlbnRpdHlbdGhpcy5wcmltYXJ5S2V5XSkpIHtcbiAgICAgIHRoaXMuaW5uZXJFbnRpdHlTZXQuZGVsZXRlKHRoaXMuaW5uZXJFbnRpdHlNYXAuZ2V0KGVudGl0eVt0aGlzLnByaW1hcnlLZXldKSk7XG4gICAgICB0aGlzLmlubmVyRW50aXR5TWFwLmRlbGV0ZShlbnRpdHlbdGhpcy5wcmltYXJ5S2V5XSk7XG4gICAgICAvLyB0aHJvdyBuZXcgRXJyb3IoYFRoZSByZXBvc2l0b3J5IGFscmVhZHkgaGFkIGFuIGl0ZW0gd2l0aCB0aGUgc2F2ZSBpZGVudGl0eSBvZiAnJHtlbnRpdHlbdGhpcy5wcmltYXJ5S2V5XX0nYCk7XG4gICAgfVxuICAgIHJldHVybiB0cnVlO1xuICB9XG5cbiAgLyoqXG4gICAqIOmqjOivgeWunuS9k+aYr+WQpuiDveenu+mZpFxuICAgKi9cbiAgcHJpdmF0ZSB2ZXJpZnlFbnRpdHlUb1JlbW92ZShpZGVudGl0eTogc3RyaW5nKTogYm9vbGVhbiB7XG4gICAgaWYgKCF0aGlzLmhhcyhpZGVudGl0eSkpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgVGhlIGVudGl0eSB3aXRoIGlkZW50aXR5IG9mICcke2lkZW50aXR5fSBkb3NlIG5vdCBleHNpdC4nYCk7XG4gICAgfVxuICAgIHJldHVybiB0cnVlO1xuICB9XG5cbiAgLyoqXG4gICAqIOWunuS9k+mbhuWQiOWPmOabtOa1gVxuICAgKi9cbiAgcHJpdmF0ZSBub3RpZnlDb2xsZWN0aW9uQ2hhbmdlZChtb2RpZmljYXRpb246IE1vZGlmaWNhdGlvbikge1xuICAgIHRoaXMuY29sbGVjdGlvbkNoYW5nZWQubmV4dChtb2RpZmljYXRpb24pO1xuICB9XG5cbiAgLy8jcmVnaW9uIOWIhumhtVxuXG4gIC8qKlxuICAgKiDorr7nva7liIbpobXlpKflsI9cbiAgICovXG4gIHNldCBwYWdlU2l6ZShwYWdlU2l6ZTogbnVtYmVyKSB7XG4gICAgaWYgKHR5cGVvZiAocGFnZVNpemUpICE9PSAnbnVtYmVyJyB8fCBwYWdlU2l6ZSA8IDApIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignSW52YWxpZCBwYXJhbWV0ZXI6cGFnZVNpemUnKTtcbiAgICB9XG5cbiAgICBjb25zdCBvcmlnaW5hbCA9IHRoaXMucGFnaW5hdGlvbkluZm87XG4gICAgLy8gY29uc3QgZW50aXR5UGFnaW5hdGlvbkluZm8gPSBPYmplY3QuYXNzaWduKHt9LCBvcmlnaW5hbFt0aGlzLmVudGl0eVR5cGVOYW1lXSwgeyBwYWdlU2l6ZSB9KTtcbiAgICAvLyB0aGlzLnBhZ2luYXRpb25JbmZvID0gT2JqZWN0LmFzc2lnbih7fSwgb3JpZ2luYWwsIHsgW3RoaXMuZW50aXR5VHlwZU5hbWVdOiBlbnRpdHlQYWdpbmF0aW9uSW5mbyB9KTtcbiAgICAvLyB0aGlzLm5vdGlmeUNvbGxlY3Rpb25DaGFuZ2VkKG5ldyBNb2RpZmljYXRpb24odGhpcy5wYWdpbmF0aW9uSW5mb1t0aGlzLmVudGl0eVR5cGVOYW1lXSwgTW9kaWZ5VHlwZS5QYWdpbmF0aW9uSW5mb0NoYW5nZSkpO1xuICAgIHRoaXMucGFnaW5hdGlvbkluZm8gPSBPYmplY3QuYXNzaWduKHt9LCBvcmlnaW5hbCwgeyBwYWdlU2l6ZSB9KTtcbiAgICB0aGlzLm5vdGlmeUNvbGxlY3Rpb25DaGFuZ2VkKG5ldyBNb2RpZmljYXRpb24odGhpcy5wYWdpbmF0aW9uSW5mbywgTW9kaWZ5VHlwZS5QYWdpbmF0aW9uSW5mb0NoYW5nZSkpO1xuICB9XG4gIC8qKlxuICAgKiDojrflj5bliIbpobXlpKflsI9cbiAgICogQGRlc2NyaXB0aW9uIOWmguaenOeUqOaIt+acquaMh+WumuWIhumhteWkp+Wwj+WImem7mOiupOS4ujDvvIzljbPojrflj5bmiYDmnInmlbDmja5cbiAgICovXG4gIGdldCBwYWdlU2l6ZSgpOiBudW1iZXIge1xuICAgIGlmICghIXRoaXMucGFnaW5hdGlvbkluZm8pIHtcbiAgICAgIHJldHVybiB0aGlzLnBhZ2luYXRpb25JbmZvLnBhZ2VTaXplIHx8IDA7XG4gICAgfVxuICAgIHJldHVybiAwO1xuICB9XG4gIC8qKlxuICAgKiDorr7nva7mlbDmja7mgLvmnaHmlbBcbiAgICovXG4gIHNldCB0b3RhbENvdW50KHRvdGFsOiBudW1iZXIpIHtcbiAgICBpZiAodHlwZW9mICh0b3RhbCkgIT09ICdudW1iZXInIHx8IHRvdGFsIDwgMCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdJbnZhbGlkIHBhcmFtZXRlcjp0b3RhbCcpO1xuICAgIH1cblxuICAgIGNvbnN0IG9yaWdpbmFsID0gdGhpcy5wYWdpbmF0aW9uSW5mbztcbiAgICAvLyBjb25zdCBlbnRpdHlQYWdpbmF0aW9uSW5mbyA9IE9iamVjdC5hc3NpZ24oe30sIG9yaWdpbmFsW3RoaXMuZW50aXR5VHlwZU5hbWVdLCB7IHRvdGFsIH0pO1xuICAgIC8vIHRoaXMucGFnaW5hdGlvbkluZm8gPSBPYmplY3QuYXNzaWduKHt9LCBvcmlnaW5hbCwgeyBbdGhpcy5lbnRpdHlUeXBlTmFtZV06IGVudGl0eVBhZ2luYXRpb25JbmZvIH0pO1xuICAgIHRoaXMucGFnaW5hdGlvbkluZm8gPSBPYmplY3QuYXNzaWduKHt9LCBvcmlnaW5hbCwgeyB0b3RhbCB9KTtcbiAgICB0aGlzLm5vdGlmeUNvbGxlY3Rpb25DaGFuZ2VkKG5ldyBNb2RpZmljYXRpb24odGhpcy5wYWdpbmF0aW9uSW5mbywgTW9kaWZ5VHlwZS5QYWdpbmF0aW9uSW5mb0NoYW5nZSkpO1xuICB9XG4gIC8qKlxuICAgKiDojrflj5bmlbDmja7mgLvmnaHmlbBcbiAgICovXG4gIGdldCB0b3RhbENvdW50KCk6IG51bWJlciB7XG4gICAgaWYgKCEhdGhpcy5wYWdpbmF0aW9uSW5mbykge1xuICAgICAgcmV0dXJuIHRoaXMucGFnaW5hdGlvbkluZm8udG90YWwgfHwgMDtcbiAgICB9XG4gICAgcmV0dXJuIDA7XG4gIH1cbiAgLyoqXG4gICAqIOiuvue9ruW9k+WJjemhteeggVxuICAgKi9cbiAgc2V0IHBhZ2VJbmRleChwYWdlSW5kZXg6IG51bWJlcikge1xuICAgIGlmICh0eXBlb2YgKHBhZ2VJbmRleCkgIT09ICdudW1iZXInIHx8IHBhZ2VJbmRleCA8IDApIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignSW52YWxpZCBwYXJhbWV0ZXI6cGFnZUluZGV4Jyk7XG4gICAgfVxuXG4gICAgY29uc3Qgb3JpZ2luYWwgPSB0aGlzLnBhZ2luYXRpb25JbmZvO1xuICAgIC8vIGNvbnN0IGVudGl0eVBhZ2luYXRpb25JbmZvID0gT2JqZWN0LmFzc2lnbih7fSwgb3JpZ2luYWxbdGhpcy5lbnRpdHlUeXBlTmFtZV0sIHsgcGFnZUluZGV4IH0pO1xuICAgIC8vIHRoaXMucGFnaW5hdGlvbkluZm8gPSBPYmplY3QuYXNzaWduKHt9LCBvcmlnaW5hbCwgeyBbdGhpcy5lbnRpdHlUeXBlTmFtZV06IGVudGl0eVBhZ2luYXRpb25JbmZvIH0pO1xuICAgIHRoaXMucGFnaW5hdGlvbkluZm8gPSBPYmplY3QuYXNzaWduKHt9LCBvcmlnaW5hbCwgeyBwYWdlSW5kZXggfSk7XG4gICAgdGhpcy5ub3RpZnlDb2xsZWN0aW9uQ2hhbmdlZChuZXcgTW9kaWZpY2F0aW9uKHRoaXMucGFnaW5hdGlvbkluZm8sIE1vZGlmeVR5cGUuUGFnaW5hdGlvbkluZm9DaGFuZ2UpKTtcbiAgfVxuICAvKipcbiAgICog6I635Y+W5b2T5YmN6aG156CBXG4gICAqL1xuICBnZXQgcGFnZUluZGV4KCk6IG51bWJlciB7XG4gICAgaWYgKCEhdGhpcy5wYWdpbmF0aW9uSW5mbykge1xuICAgICAgcmV0dXJuIHRoaXMucGFnaW5hdGlvbkluZm8ucGFnZUluZGV4IHx8IDE7XG4gICAgfVxuICAgIHJldHVybiAxO1xuICB9XG4gIC8qKlxuICAgKiDmm7TmlrDliIbpobXkv6Hmga9cbiAgICogQHBhcmFtIHBhdGgg57uR5a6a6Lev5b6EXG4gICAqIEBwYXJhbSBwYWdlSW5mbyDliIbpobXkv6Hmga9cbiAgICovXG4gIHB1YmxpYyB1cGRhdGVQYWdpbmF0aW9uSW5mb0J5UGF0aChwYXRoOiBzdHJpbmcsIHBhZ2VJbmZvOiB7IHBhZ2VJbmRleDogYW55LCBwYWdlU2l6ZTogYW55LCB0b3RhbENvdW50OiBhbnksIFtwcm9wOiBzdHJpbmddOiBhbnkgfSkge1xuICAgIGNvbnN0IG9yaWdpbmFsID0gdGhpcy5wYWdpbmF0aW9uSW5mbztcbiAgICBjb25zdCB7IHBhZ2VJbmRleCwgcGFnZVNpemUsIHRvdGFsQ291bnQ6IHRvdGFsIH0gPSBwYWdlSW5mbztcbiAgICBjb25zdCBwYWdpbmF0aW9uSW5mbyA9IE9iamVjdC5hc3NpZ24oe30sIG9yaWdpbmFsLCB7IHBhZ2VJbmRleCwgcGFnZVNpemUsIHRvdGFsIH0pO1xuICAgIHRoaXMuc2V0UGFnaW5hdGlvbkNvbmZpZ0J5UGF0aChwYXRoLCBwYWdpbmF0aW9uSW5mbyk7XG4gIH1cbiAgLyoqXG4gICAqIOagueaNrui3r+W+hOiOt+WPluWIhumhteWkp+Wwj1xuICAgKiBAcGFyYW0gcGF0aCDot6/lvoRcbiAgICovXG4gIHB1YmxpYyBnZXRQYWdpbmF0aW9uQ29uZmlnQnlQYXRoKHBhdGg6IHN0cmluZywgZGVmYXVsdFZhbHVlPzogYW55KSB7XG4gICAgaWYgKCFwYXRoIHx8IHBhdGggPT09ICcvJykge1xuICAgICAgcmV0dXJuIHRoaXMucGFnaW5hdGlvbkluZm87XG4gICAgfVxuICAgIGlmICh0eXBlb2YgcGF0aCAhPT0gJ3N0cmluZycpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcign6Lev5b6E5b+F6aG75Li65a2X56ym5Liy77yBJyk7XG4gICAgfVxuICAgIHBhdGggPSBwYXRoLnN1YnN0cmluZygxKTtcbiAgICBjb25zdCBwYXRocyA9IHBhdGguc3BsaXQoJy8nKS5maWx0ZXIoaXRlbSA9PiAhIWl0ZW0gJiYgaXRlbS50cmltKCkubGVuZ3RoID4gMCkubWFwKGl0ZW0gPT4gaXRlbS50cmltKCkpO1xuICAgIGxldCBjb25maWcgPSB0aGlzLnBhZ2luYXRpb25JbmZvO1xuICAgIHBhdGhzLmZvckVhY2goaXRlbSA9PiB7XG4gICAgICBpZiAoY29uZmlnICYmIGNvbmZpZy5oYXNPd25Qcm9wZXJ0eShpdGVtKSkge1xuICAgICAgICBjb25maWcgPSBjb25maWdbaXRlbV07XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25maWcgPSBudWxsO1xuICAgICAgfVxuICAgIH0pO1xuICAgIHJldHVybiAhIWNvbmZpZyA/IGNvbmZpZyA6IHR5cGVvZiBkZWZhdWx0VmFsdWUgIT09ICd1bmRlZmluZWQnID8gZGVmYXVsdFZhbHVlIDogdW5kZWZpbmVkO1xuICB9XG4gIC8qKlxuICAgKiDorr7nva7liIbpobXkv6Hmga9cbiAgICogQHBhcmFtIHBhdGgg6Lev5b6EXG4gICAqIEBwYXJhbSB2YWx1ZSDlgLxcbiAgICovXG4gIHB1YmxpYyBzZXRQYWdpbmF0aW9uQ29uZmlnQnlQYXRoKHBhdGg6IHN0cmluZyB8IEFycmF5PGFueT4sIHZhbHVlOiBhbnkpIHtcbiAgICBjb25zdCBvcmlnaW5hbCA9IEpTT04uc3RyaW5naWZ5KHRoaXMucGFnaW5hdGlvbkluZm8pO1xuICAgIGlmICghcGF0aCB8fCBwYXRoID09PSAnLycpIHtcbiAgICAgIHRoaXMucGFnaW5hdGlvbkluZm8gPSB2YWx1ZTtcbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKCFBcnJheS5pc0FycmF5KHBhdGgpKSB7XG4gICAgICAgIHBhdGggPSBwYXRoLnRvU3RyaW5nKCkubWF0Y2goL1teL1tcXF1dKy9nKSB8fCBbXTtcbiAgICAgIH1cbiAgICAgIHBhdGguc2xpY2UoMCwgLTEpLnJlZHVjZSgocHJldiwgY3VycmVudCwgaW5kZXgpID0+XG4gICAgICAgIE9iamVjdChwcmV2W2N1cnJlbnRdKSA9PT0gcHJldltjdXJyZW50XVxuICAgICAgICAgID8gcHJldltjdXJyZW50XVxuICAgICAgICAgIDogcHJldltjdXJyZW50XSA9IE1hdGguYWJzKHBhdGhbaW5kZXggKyAxXSkgPj4gMCA9PT0gK3BhdGhbaW5kZXggKyAxXVxuICAgICAgICAgICAgPyBbXVxuICAgICAgICAgICAgOiB7fSxcbiAgICAgICAgdGhpcy5wYWdpbmF0aW9uSW5mbylbcGF0aFtwYXRoLmxlbmd0aCAtIDFdXSA9IHZhbHVlO1xuICAgIH1cblxuICAgIGlmIChKU09OLnN0cmluZ2lmeSh0aGlzLnBhZ2luYXRpb25JbmZvKSAhPT0gb3JpZ2luYWwpIHtcbiAgICAgIHRoaXMubm90aWZ5Q29sbGVjdGlvbkNoYW5nZWQobmV3IE1vZGlmaWNhdGlvbih0aGlzLnBhZ2luYXRpb25JbmZvLCBNb2RpZnlUeXBlLlBhZ2luYXRpb25JbmZvQ2hhbmdlKSk7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLnBhZ2luYXRpb25JbmZvO1xuICB9XG4gIC8vI2VuZHJlZ2lvblxuXG4gIC8qKlxuICAgKiDnm5HlkKzlrp7kvZPlj5jmm7RcbiAgICovXG4gIHByaXZhdGUgbGlzdGVuRW50aXR5Q2hhbmdlRXZlbnQoZW50aXR5OiBFbnRpdHkpIHtcbiAgICBpZiAoZW50aXR5KSB7XG4gICAgICBlbnRpdHkub25WYWx1ZUNoYW5nZWQuc3Vic2NyaWJlKChjaGFuZ2U6IE1vZGlmaWNhdGlvbikgPT4gdGhpcy5jaGFuZ2VzLm5leHQoY2hhbmdlKSk7XG4gICAgfVxuICB9XG5cbn1cblxuZXhwb3J0IHsgRW50aXR5Q29sbGVjdGlvbiB9O1xuIl19
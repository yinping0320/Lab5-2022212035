import { format, isDate, parseISO, isEqual, compareAsc } from 'date-fns';
import dayjs from 'dayjs';
import IsBetween from 'dayjs/plugin/IsBetween';
import relativeTime from 'dayjs/plugin/relativeTime';
import Calendar from 'dayjs/plugin/calendar';
import 'dayjs/locale/zh-cn';
dayjs.locale('zh-cn');
/**
 * 日期处理类
 */
class DateUtil {
    /**
     * 将日期（或日期字符串）转换为完整的的ISO格式的字符串
     */
    static formatISO(dateOrDateString) {
        if (this.isEmptyDateOrDateString(dateOrDateString) === true) {
            return this.emptyISODateTimeString;
        }
        const dateObj = this.parse(dateOrDateString);
        return format(dateObj, this.defaultISOFormat);
    }
    /**
     * 将日期（或日期字符串）转换为指定格式的字符串
     * @param dateOrDateString 日期对象或符合ISO8601规范的日期字符串
     * @param dateFormat 日期格式字符串
     */
    static format(dateOrDateString, dateFormat) {
        if (this.isEmptyDateOrDateString(dateOrDateString) === true) {
            return this.emptyISODateTimeString;
        }
        const dateObj = this.parse(dateOrDateString);
        dateFormat = dateFormat ? dateFormat : this.defaultDisplayFormat;
        return format(dateObj, dateFormat);
    }
    static dateShow(dateOrDateString, type) {
        if (this.isEmptyDateOrDateString(dateOrDateString) === true) {
            return this.emptyISODateTimeString;
        }
        if (!type || "" === type) {
            return;
        }
        return this[type] && this[type](dateOrDateString);
    }
    static dateOperation(dateOrDateString, options) {
        if (this.isEmptyDateOrDateString(dateOrDateString) === true) {
            return this.emptyISODateTimeString;
        }
        const { type = "", option } = options;
        if (!type || "" === type) {
            return;
        }
        if ('isSame' === type) {
            return this[type] && this[type](dateOrDateString, options['targetDate'], options['granularity']);
        }
        if ('isBefore' === type) {
            return this[type] && this[type](dateOrDateString, options['targetDate'], options['granularity']);
        }
        if ('isAfter' === type) {
            return this[type] && this[type](dateOrDateString, options['targetDate'], options['granularity']);
        }
        if ('isBetween' === type) {
            return this[type] && this[type](dateOrDateString, options['targetDate'], options['targetDate2'], options['granularity'], options['contains']);
        }
        if (!option) {
            return this[type] && this[type](dateOrDateString);
        }
        return this[type] && this[type](dateOrDateString, option);
    }
    static relativeTime(dateOrDateString, option) {
        dayjs.extend(relativeTime);
        const dateObj = dayjs(dateOrDateString);
        if (!option) {
            return dayjs(dateObj).fromNow();
        }
        return dayjs(dateObj).fromNow(option);
    }
    static isToday(dateOrDateString) {
        const todayDate = new Date();
        const dateObj = dayjs(dateOrDateString);
        return this.isSame(dateObj, todayDate, 'date');
    }
    static calendar(dateOrDateString, option) {
        const dateObj = dayjs(dateOrDateString);
        dayjs.extend(Calendar);
        if (option) {
            return dayjs().calendar(dateObj, Object.assign({}, option));
        }
        return dayjs().calendar(dateObj, {
            sameDay: '[今天] HH:mm',
            nextDay: '[明天] HH:mm',
            lastDay: '[昨天] HH:mm',
            sameElse: 'YYYY-MM-DD'
        });
    }
    /**
     * 创建日期
     * @param dateOrDateString 日期对象或符合ISO8601规范的日期字符串
     */
    static parse(dateOrDateString) {
        if (this.isEmptyDateOrDateString(dateOrDateString) === true) {
            return null;
        }
        if (this.isDate(dateOrDateString) === true) {
            return dateOrDateString;
        }
        return parseISO(dateOrDateString);
    }
    /**
     * 是否是日期对象
     */
    static isDate(date) {
        return isDate(date);
    }
    /**
     * 是否是空日期或者空日期字符串
     * @param dateOrDateString 日期或日期字符串
     */
    static isEmptyDateOrDateString(dateOrDateString) {
        if (this.isDate(dateOrDateString) === true) {
            return this.isEmptyDate(dateOrDateString);
        }
        return this.isEmptyDateString(dateOrDateString);
    }
    /**
     * 是否为空日期字符串
     * @param date 日期对象
     */
    static isEmptyDate(date) {
        if (!date) {
            return true;
        }
        return false;
    }
    /**
     * 是否是空日期字符串
     * @param dateString 日期字符串
     */
    static isEmptyDateString(dateString) {
        if (!dateString || dateString.startsWith('0001-01-01') === true) {
            return true;
        }
        return false;
    }
    /**
     * 两个日期是否相等
     * @param dateOrDateString1 日期对象或字符串
     * @param dateOrDateString1 日期对象或字符串
     * @return 相等返回true，否则返回false
     */
    static isEqual(dateOrDateString1, dateOrDateString2) {
        const dateObj1 = this.parse(dateOrDateString1);
        const dateObj2 = this.parse(dateOrDateString2);
        if (dateObj1 === dateObj2) {
            return true;
        }
        return isEqual(dateObj1, dateObj2);
    }
    /**
     * 两个日期是否相等
     * @param dateOrDateString1 日期对象或字符串
     * @param dateOrDateString1 日期对象或字符串
     * @return 返回-1、0、1
     */
    static compare(dateOrDateString1, dateOrDateString2) {
        const dateObj1 = this.parse(dateOrDateString1);
        const dateObj2 = this.parse(dateOrDateString2);
        if (this.isEqual(dateObj1, dateObj2) === true) {
            return 0;
        }
        // 处理解析后为null的场景，null比所有有效日期小
        if (!dateObj1 && this.isDate(dateObj2) === true) {
            return -1;
        }
        if (!dateObj2 && this.isDate(dateObj1) === true) {
            return 1;
        }
        return compareAsc(dateObj1, dateObj2);
    }
    /**
     *
     * @param currentDate 当前日期
     * @param targetDate 目标日期
     * @param type 比较类型 date	D	天00:00 day	d	星期00:00 month	M	月第一天00:00 year	y	1月1日00点 week	w	周第一天00:00hour	h	00:00:00minute	m	00:00second	s	00millisecond	ms	0
     * @returns
     */
    static isSame(currentDate, targetDate, type) {
        if (type) {
            return dayjs(currentDate).isSame(dayjs(targetDate), type);
        }
        return dayjs(currentDate).isSame(dayjs(targetDate));
    }
    /**
     *
     * @param currentDate 当前日期
     * @param targetDate 目标日期
     * @returns boolean
     */
    static isBefore(currentDate, targetDate, type) {
        if (type) {
            return dayjs(currentDate).isBefore(dayjs(targetDate), type);
        }
        return dayjs(currentDate).isBefore(dayjs(targetDate));
    }
    /**
   *
   * @param currentDate 当前日期
   * @param targetDate 目标日期
   * @returns boolean
   */
    static isAfter(currentDate, targetDate, type) {
        if (type) {
            return dayjs(currentDate).isAfter(dayjs(targetDate), type);
        }
        return dayjs(currentDate).isAfter(dayjs(targetDate));
    }
    /**
     *
     * @param currentDate
     * @param targetDate1
     * @param targetDate2
     * @returns
     */
    static isBetween(currentDate, targetDate1, targetDate2, type, contains) {
        dayjs.extend(IsBetween);
        if (type) {
            return dayjs(currentDate).isBetween(dayjs(targetDate1), dayjs(targetDate2), type, contains);
        }
        return dayjs(currentDate).isBetween(dayjs(targetDate1), dayjs(targetDate2), null, contains);
    }
}
/**
 * 空日期字符串（N版）
 * @todo：兼容服务器端，不应该在devkit体现这种兼容，待移除
 */
// static emptyDateTimeString = '0001-01-01T00:00:00';
DateUtil.emptyDateTimeString = null;
/**
 * 默认空日期字符串（ISO标准格式）
 */
// static emptyISODateTimeString = '0001-01-01T00:00:00+00:00';
DateUtil.emptyISODateTimeString = null;
/**
 * 默认日期听格式
 */
DateUtil.defaultISOFormat = `yyyy-MM-dd'T'HH:mm:ssxxx`;
DateUtil.defaultDisplayFormat = 'yyyy-MM-dd HH:mm:ss';
DateUtil.defaultDateFormat = 'yyyy-MM-dd';
DateUtil.defaultTimeFormat = 'HH:mm:ss';
export { DateUtil };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0ZV91dGlsLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy9tb2JpbGUtZGV2a2l0LyIsInNvdXJjZXMiOlsibGliL3V0aWxzL2RhdGVfdXRpbC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU0sRUFBRSxRQUFRLEVBQUUsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLFVBQVUsQ0FBQztBQUN6RSxPQUFPLEtBQUssTUFBTSxPQUFPLENBQUM7QUFDMUIsT0FBTyxTQUFTLE1BQU0sd0JBQXdCLENBQUM7QUFDL0MsT0FBTyxZQUFZLE1BQU0sMkJBQTJCLENBQUM7QUFDckQsT0FBTyxRQUFRLE1BQU0sdUJBQXVCLENBQUM7QUFDN0MsT0FBTyxvQkFBb0IsQ0FBQztBQUM1QixLQUFLLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDO0FBQ3RCOztHQUVHO0FBQ0gsTUFBTSxRQUFRO0lBMEJaOztPQUVHO0lBQ0gsTUFBTSxDQUFDLFNBQVMsQ0FBQyxnQkFBK0I7UUFDOUMsSUFBSSxJQUFJLENBQUMsdUJBQXVCLENBQUMsZ0JBQWdCLENBQUMsS0FBSyxJQUFJLEVBQUU7WUFDM0QsT0FBTyxJQUFJLENBQUMsc0JBQXNCLENBQUM7U0FDcEM7UUFDRCxNQUFNLE9BQU8sR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLGdCQUFnQixDQUFDLENBQUM7UUFDN0MsT0FBTyxNQUFNLENBQUMsT0FBTyxFQUFFLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO0lBQ2hELENBQUM7SUFFRDs7OztPQUlHO0lBQ0gsTUFBTSxDQUFDLE1BQU0sQ0FBQyxnQkFBK0IsRUFBRSxVQUFtQjtRQUNoRSxJQUFJLElBQUksQ0FBQyx1QkFBdUIsQ0FBQyxnQkFBZ0IsQ0FBQyxLQUFLLElBQUksRUFBRTtZQUMzRCxPQUFPLElBQUksQ0FBQyxzQkFBc0IsQ0FBQztTQUNwQztRQUNELE1BQU0sT0FBTyxHQUFHLElBQUksQ0FBQyxLQUFLLENB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Q0FBQztBQUVsQzs7R0FFRztBQUNILCtEQUErRDtBQUN4RCwrQkFBc0IsR0FBRyxJQUFJLENBQUM7QUFFckM7O0dBRUc7QUFDSSx5QkFBZ0IsR0FBRywwQkFBMEIsQ0FBQztBQUU5Qyw2QkFBb0IsR0FBRyxxQkFBcUIsQ0FBQztBQUU3QywwQkFBaUIsR0FBRyxZQUFZLENBQUM7QUFFakMsMEJBQWlCLEdBQUcsVUFBVSxDQUFDO0FBd1B4QyxPQUFPLEVBQUUsUUFBUSxFQUFFLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBmb3JtYXQsIGlzRGF0ZSwgcGFyc2VJU08sIGlzRXF1YWwsIGNvbXBhcmVBc2MgfSBmcm9tICdkYXRlLWZucyc7XG5pbXBvcnQgZGF5anMgZnJvbSAnZGF5anMnO1xuaW1wb3J0IElzQmV0d2VlbiBmcm9tICdkYXlqcy9wbHVnaW4vSXNCZXR3ZWVuJztcbmltcG9ydCByZWxhdGl2ZVRpbWUgZnJvbSAnZGF5anMvcGx1Z2luL3JlbGF0aXZlVGltZSc7XG5pbXBvcnQgQ2FsZW5kYXIgZnJvbSAnZGF5anMvcGx1Z2luL2NhbGVuZGFyJztcbmltcG9ydCAnZGF5anMvbG9jYWxlL3poLWNuJztcbmRheWpzLmxvY2FsZSgnemgtY24nKTtcbi8qKlxuICog5pel5pyf5aSE55CG57G7XG4gKi9cbmNsYXNzIERhdGVVdGlsIHtcblxuICAvKipcbiAgICog56m65pel5pyf5a2X56ym5Liy77yITueJiO+8iVxuICAgKiBAdG9kb++8muWFvOWuueacjeWKoeWZqOerr++8jOS4jeW6lOivpeWcqGRldmtpdOS9k+eOsOi/meenjeWFvOWuue+8jOW+heenu+mZpFxuICAgKi9cbiAgLy8gc3RhdGljIGVtcHR5RGF0ZVRpbWVTdHJpbmcgPSAnMDAwMS0wMS0wMVQwMDowMDowMCc7XG4gIHN0YXRpYyBlbXB0eURhdGVUaW1lU3RyaW5nID0gbnVsbDtcblxuICAvKipcbiAgICog6buY6K6k56m65pel5pyf5a2X56ym5Liy77yISVNP5qCH5YeG5qC85byP77yJXG4gICAqL1xuICAvLyBzdGF0aWMgZW1wdHlJU09EYXRlVGltZVN0cmluZyA9ICcwMDAxLTAxLTAxVDAwOjAwOjAwKzAwOjAwJztcbiAgc3RhdGljIGVtcHR5SVNPRGF0ZVRpbWVTdHJpbmcgPSBudWxsO1xuXG4gIC8qKlxuICAgKiDpu5jorqTml6XmnJ/lkKzmoLzlvI9cbiAgICovXG4gIHN0YXRpYyBkZWZhdWx0SVNPRm9ybWF0ID0gYHl5eXktTU0tZGQnVCdISDptbTpzc3h4eGA7XG5cbiAgc3RhdGljIGRlZmF1bHREaXNwbGF5Rm9ybWF0ID0gJ3l5eXktTU0tZGQgSEg6bW06c3MnO1xuXG4gIHN0YXRpYyBkZWZhdWx0RGF0ZUZvcm1hdCA9ICd5eXl5LU1NLWRkJztcblxuICBzdGF0aWMgZGVmYXVsdFRpbWVGb3JtYXQgPSAnSEg6bW06c3MnO1xuXG4gIC8qKlxuICAgKiDlsIbml6XmnJ/vvIjmiJbml6XmnJ/lrZfnrKbkuLLvvInovazmjaLkuLrlrozmlbTnmoTnmoRJU0/moLzlvI/nmoTlrZfnrKbkuLJcbiAgICovXG4gIHN0YXRpYyBmb3JtYXRJU08oZGF0ZU9yRGF0ZVN0cmluZzogc3RyaW5nIHwgRGF0ZSk6IHN0cmluZyB7XG4gICAgaWYgKHRoaXMuaXNFbXB0eURhdGVPckRhdGVTdHJpbmcoZGF0ZU9yRGF0ZVN0cmluZykgPT09IHRydWUpIHtcbiAgICAgIHJldHVybiB0aGlzLmVtcHR5SVNPRGF0ZVRpbWVTdHJpbmc7XG4gICAgfVxuICAgIGNvbnN0IGRhdGVPYmogPSB0aGlzLnBhcnNlKGRhdGVPckRhdGVTdHJpbmcpO1xuICAgIHJldHVybiBmb3JtYXQoZGF0ZU9iaiwgdGhpcy5kZWZhdWx0SVNPRm9ybWF0KTtcbiAgfVxuXG4gIC8qKlxuICAgKiDlsIbml6XmnJ/vvIjmiJbml6XmnJ/lrZfnrKbkuLLvvInovazmjaLkuLrmjIflrprmoLzlvI/nmoTlrZfnrKbkuLJcbiAgICogQHBhcmFtIGRhdGVPckRhdGVTdHJpbmcg5pel5pyf5a+56LGh5oiW56ym5ZCISVNPODYwMeinhOiMg+eahOaXpeacn+Wtl+espuS4slxuICAgKiBAcGFyYW0gZGF0ZUZvcm1hdCDml6XmnJ/moLzlvI/lrZfnrKbkuLJcbiAgICovXG4gIHN0YXRpYyBmb3JtYXQoZGF0ZU9yRGF0ZVN0cmluZzogc3RyaW5nIHwgRGF0ZSwgZGF0ZUZvcm1hdD86IHN0cmluZyk6IHN0cmluZyB7XG4gICAgaWYgKHRoaXMuaXNFbXB0eURhdGVPckRhdGVTdHJpbmcoZGF0ZU9yRGF0ZVN0cmluZykgPT09IHRydWUpIHtcbiAgICAgIHJldHVybiB0aGlzLmVtcHR5SVNPRGF0ZVRpbWVTdHJpbmc7XG4gICAgfVxuICAgIGNvbnN0IGRhdGVPYmogPSB0aGlzLnBhcnNlKGRhdGVPckRhdGVTdHJpbmcpO1xuICAgIGRhdGVGb3JtYXQgPSBkYXRlRm9ybWF0ID8gZGF0ZUZvcm1hdCA6IHRoaXMuZGVmYXVsdERpc3BsYXlGb3JtYXQ7XG4gICAgcmV0dXJuIGZvcm1hdChkYXRlT2JqLCBkYXRlRm9ybWF0KTtcbiAgfVxuXG4gIHN0YXRpYyBkYXRlU2hvdyhkYXRlT3JEYXRlU3RyaW5nOiBzdHJpbmcgfCBEYXRlLCB0eXBlOiBzdHJpbmcpIHtcbiAgICBpZiAodGhpcy5pc0VtcHR5RGF0ZU9yRGF0ZVN0cmluZyhkYXRlT3JEYXRlU3RyaW5nKSA9PT0gdHJ1ZSkge1xuICAgICAgcmV0dXJuIHRoaXMuZW1wdHlJU09EYXRlVGltZVN0cmluZztcbiAgICB9XG4gICAgaWYgKCF0eXBlIHx8IFwiXCIgPT09IHR5cGUpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXNbdHlwZV0gJiYgdGhpc1t0eXBlXShkYXRlT3JEYXRlU3RyaW5nKVxuICB9XG5cbiAgc3RhdGljIGRhdGVPcGVyYXRpb24oZGF0ZU9yRGF0ZVN0cmluZzogc3RyaW5nIHwgRGF0ZSwgb3B0aW9ucykge1xuICAgIGlmICh0aGlzLmlzRW1wdHlEYXRlT3JEYXRlU3RyaW5nKGRhdGVPckRhdGVTdHJpbmcpID09PSB0cnVlKSB7XG4gICAgICByZXR1cm4gdGhpcy5lbXB0eUlTT0RhdGVUaW1lU3RyaW5nO1xuICAgIH1cbiAgICBjb25zdCB7IHR5cGUgPSBcIlwiLCBvcHRpb24gfSA9IG9wdGlvbnM7XG4gICAgaWYgKCF0eXBlIHx8IFwiXCIgPT09IHR5cGUpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKCdpc1NhbWUnID09PSB0eXBlKSB7XG4gICAgICByZXR1cm4gdGhpc1t0eXBlXSAmJiB0aGlzW3R5cGVdKGRhdGVPckRhdGVTdHJpbmcsIG9wdGlvbnNbJ3RhcmdldERhdGUnXSwgb3B0aW9uc1snZ3JhbnVsYXJpdHknXSlcbiAgICB9XG4gICAgaWYgKCdpc0JlZm9yZScgPT09IHR5cGUpIHtcbiAgICAgIHJldHVybiB0aGlzW3R5cGVdICYmIHRoaXNbdHlwZV0oZGF0ZU9yRGF0ZVN0cmluZywgb3B0aW9uc1sndGFyZ2V0RGF0ZSddLCBvcHRpb25zWydncmFudWxhcml0eSddKVxuICAgIH1cbiAgICBpZiAoJ2lzQWZ0ZXInID09PSB0eXBlKSB7XG4gICAgICByZXR1cm4gdGhpc1t0eXBlXSAmJiB0aGlzW3R5cGVdKGRhdGVPckRhdGVTdHJpbmcsIG9wdGlvbnNbJ3RhcmdldERhdGUnXSwgb3B0aW9uc1snZ3JhbnVsYXJpdHknXSlcbiAgICB9XG4gICAgaWYgKCdpc0JldHdlZW4nID09PSB0eXBlICkge1xuICAgICAgcmV0dXJuIHRoaXNbdHlwZV0gJiYgdGhpc1t0eXBlXShkYXRlT3JEYXRlU3RyaW5nLCBvcHRpb25zWyd0YXJnZXREYXRlJ10sIG9wdGlvbnNbJ3RhcmdldERhdGUyJ10sIG9wdGlvbnNbJ2dyYW51bGFyaXR5J10sIG9wdGlvbnNbJ2NvbnRhaW5zJ10pXG4gICAgfVxuICAgIGlmICghb3B0aW9uKSB7XG4gICAgICByZXR1cm4gdGhpc1t0eXBlXSAmJiB0aGlzW3R5cGVdKGRhdGVPckRhdGVTdHJpbmcpXG4gICAgfVxuICAgIHJldHVybiB0aGlzW3R5cGVdICYmIHRoaXNbdHlwZV0oZGF0ZU9yRGF0ZVN0cmluZywgb3B0aW9uKVxuICB9XG5cblxuXG4gIHN0YXRpYyByZWxhdGl2ZVRpbWUoZGF0ZU9yRGF0ZVN0cmluZzogc3RyaW5nIHwgRGF0ZSwgb3B0aW9uKSB7XG4gICAgZGF5anMuZXh0ZW5kKHJlbGF0aXZlVGltZSlcbiAgICBjb25zdCBkYXRlT2JqID0gZGF5anMoZGF0ZU9yRGF0ZVN0cmluZyk7XG4gICAgaWYgKCFvcHRpb24pIHtcbiAgICAgIHJldHVybiBkYXlqcyhkYXRlT2JqKS5mcm9tTm93KClcbiAgICB9XG4gICAgcmV0dXJuIGRheWpzKGRhdGVPYmopLmZyb21Ob3cob3B0aW9uKVxuICB9XG5cbiAgc3RhdGljIGlzVG9kYXkoZGF0ZU9yRGF0ZVN0cmluZzogc3RyaW5nIHwgRGF0ZSkge1xuICAgIGNvbnN0IHRvZGF5RGF0ZSA9IG5ldyBEYXRlKCk7XG4gICAgY29uc3QgZGF0ZU9iaiA9IGRheWpzKGRhdGVPckRhdGVTdHJpbmcpO1xuICAgIHJldHVybiB0aGlzLmlzU2FtZShkYXRlT2JqLCB0b2RheURhdGUsICdkYXRlJyk7XG4gIH1cblxuICBzdGF0aWMgY2FsZW5kYXIoZGF0ZU9yRGF0ZVN0cmluZzogc3RyaW5nIHwgRGF0ZSwgb3B0aW9uKSB7XG4gICAgY29uc3QgZGF0ZU9iaiA9IGRheWpzKGRhdGVPckRhdGVTdHJpbmcpO1xuICAgIGRheWpzLmV4dGVuZChDYWxlbmRhcilcbiAgICBpZiAob3B0aW9uKSB7XG4gICAgICByZXR1cm4gZGF5anMoKS5jYWxlbmRhcihkYXRlT2JqLCB7IC4uLm9wdGlvbiB9KVxuICAgIH1cbiAgICByZXR1cm4gZGF5anMoKS5jYWxlbmRhcihkYXRlT2JqLCB7XG4gICAgICBzYW1lRGF5OiAnW+S7iuWkqV0gSEg6bW0nLFxuICAgICAgbmV4dERheTogJ1vmmI7lpKldIEhIOm1tJyxcbiAgICAgIGxhc3REYXk6ICdb5pio5aSpXSBISDptbScsXG4gICAgICBzYW1lRWxzZTogJ1lZWVktTU0tREQnXG4gICAgfSlcbiAgfVxuXG5cbiAgLyoqXG4gICAqIOWIm+W7uuaXpeacn1xuICAgKiBAcGFyYW0gZGF0ZU9yRGF0ZVN0cmluZyDml6XmnJ/lr7nosaHmiJbnrKblkIhJU084NjAx6KeE6IyD55qE5pel5pyf5a2X56ym5LiyXG4gICAqL1xuICBzdGF0aWMgcGFyc2UoZGF0ZU9yRGF0ZVN0cmluZzogc3RyaW5nIHwgRGF0ZSk6IERhdGUge1xuICAgIGlmICh0aGlzLmlzRW1wdHlEYXRlT3JEYXRlU3RyaW5nKGRhdGVPckRhdGVTdHJpbmcpID09PSB0cnVlKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5pc0RhdGUoZGF0ZU9yRGF0ZVN0cmluZykgPT09IHRydWUpIHtcbiAgICAgIHJldHVybiBkYXRlT3JEYXRlU3RyaW5nIGFzIERhdGU7XG4gICAgfVxuXG4gICAgcmV0dXJuIHBhcnNlSVNPKGRhdGVPckRhdGVTdHJpbmcgYXMgc3RyaW5nKTtcbiAgfVxuXG4gIC8qKlxuICAgKiDmmK/lkKbmmK/ml6XmnJ/lr7nosaFcbiAgICovXG4gIHN0YXRpYyBpc0RhdGUoZGF0ZTogYW55KTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIGlzRGF0ZShkYXRlKTtcbiAgfVxuXG4gIC8qKlxuICAgKiDmmK/lkKbmmK/nqbrml6XmnJ/miJbogIXnqbrml6XmnJ/lrZfnrKbkuLJcbiAgICogQHBhcmFtIGRhdGVPckRhdGVTdHJpbmcg5pel5pyf5oiW5pel5pyf5a2X56ym5LiyXG4gICAqL1xuICBzdGF0aWMgaXNFbXB0eURhdGVPckRhdGVTdHJpbmcoZGF0ZU9yRGF0ZVN0cmluZzogc3RyaW5nIHwgRGF0ZSkge1xuICAgIGlmICh0aGlzLmlzRGF0ZShkYXRlT3JEYXRlU3RyaW5nKSA9PT0gdHJ1ZSkge1xuICAgICAgcmV0dXJuIHRoaXMuaXNFbXB0eURhdGUoZGF0ZU9yRGF0ZVN0cmluZyBhcyBEYXRlKTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuaXNFbXB0eURhdGVTdHJpbmcoZGF0ZU9yRGF0ZVN0cmluZyBhcyBzdHJpbmcpO1xuICB9XG5cbiAgLyoqXG4gICAqIOaYr+WQpuS4uuepuuaXpeacn+Wtl+espuS4slxuICAgKiBAcGFyYW0gZGF0ZSDml6XmnJ/lr7nosaFcbiAgICovXG4gIHN0YXRpYyBpc0VtcHR5RGF0ZShkYXRlOiBEYXRlKSB7XG4gICAgaWYgKCFkYXRlKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgLyoqXG4gICAqIOaYr+WQpuaYr+epuuaXpeacn+Wtl+espuS4slxuICAgKiBAcGFyYW0gZGF0ZVN0cmluZyDml6XmnJ/lrZfnrKbkuLJcbiAgICovXG4gIHN0YXRpYyBpc0VtcHR5RGF0ZVN0cmluZyhkYXRlU3RyaW5nOiBzdHJpbmcpIHtcbiAgICBpZiAoIWRhdGVTdHJpbmcgfHwgZGF0ZVN0cmluZy5zdGFydHNXaXRoKCcwMDAxLTAxLTAxJykgPT09IHRydWUpIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICAvKipcbiAgICog5Lik5Liq5pel5pyf5piv5ZCm55u4562JXG4gICAqIEBwYXJhbSBkYXRlT3JEYXRlU3RyaW5nMSDml6XmnJ/lr7nosaHmiJblrZfnrKbkuLJcbiAgICogQHBhcmFtIGRhdGVPckRhdGVTdHJpbmcxIOaXpeacn+WvueixoeaIluWtl+espuS4slxuICAgKiBAcmV0dXJuIOebuOetiei/lOWbnnRydWXvvIzlkKbliJnov5Tlm55mYWxzZVxuICAgKi9cbiAgc3RhdGljIGlzRXF1YWwoZGF0ZU9yRGF0ZVN0cmluZzE6IHN0cmluZyB8IERhdGUsIGRhdGVPckRhdGVTdHJpbmcyOiBzdHJpbmcgfCBEYXRlKTogYm9vbGVhbiB7XG4gICAgY29uc3QgZGF0ZU9iajEgPSB0aGlzLnBhcnNlKGRhdGVPckRhdGVTdHJpbmcxKTtcbiAgICBjb25zdCBkYXRlT2JqMiA9IHRoaXMucGFyc2UoZGF0ZU9yRGF0ZVN0cmluZzIpO1xuICAgIGlmIChkYXRlT2JqMSA9PT0gZGF0ZU9iajIpIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICByZXR1cm4gaXNFcXVhbChkYXRlT2JqMSwgZGF0ZU9iajIpO1xuICB9XG5cbiAgLyoqXG4gICAqIOS4pOS4quaXpeacn+aYr+WQpuebuOetiVxuICAgKiBAcGFyYW0gZGF0ZU9yRGF0ZVN0cmluZzEg5pel5pyf5a+56LGh5oiW5a2X56ym5LiyXG4gICAqIEBwYXJhbSBkYXRlT3JEYXRlU3RyaW5nMSDml6XmnJ/lr7nosaHmiJblrZfnrKbkuLJcbiAgICogQHJldHVybiDov5Tlm54tMeOAgTDjgIExXG4gICAqL1xuICBzdGF0aWMgY29tcGFyZShkYXRlT3JEYXRlU3RyaW5nMTogc3RyaW5nIHwgRGF0ZSwgZGF0ZU9yRGF0ZVN0cmluZzI6IHN0cmluZyB8IERhdGUpIHtcbiAgICBjb25zdCBkYXRlT2JqMSA9IHRoaXMucGFyc2UoZGF0ZU9yRGF0ZVN0cmluZzEpO1xuICAgIGNvbnN0IGRhdGVPYmoyID0gdGhpcy5wYXJzZShkYXRlT3JEYXRlU3RyaW5nMik7XG4gICAgaWYgKHRoaXMuaXNFcXVhbChkYXRlT2JqMSwgZGF0ZU9iajIpID09PSB0cnVlKSB7XG4gICAgICByZXR1cm4gMDtcbiAgICB9XG5cbiAgICAvLyDlpITnkIbop6PmnpDlkI7kuLpudWxs55qE5Zy65pmv77yMbnVsbOavlOaJgOacieacieaViOaXpeacn+Wwj1xuICAgIGlmICghZGF0ZU9iajEgJiYgdGhpcy5pc0RhdGUoZGF0ZU9iajIpID09PSB0cnVlKSB7XG4gICAgICByZXR1cm4gLTE7XG4gICAgfVxuICAgIGlmICghZGF0ZU9iajIgJiYgdGhpcy5pc0RhdGUoZGF0ZU9iajEpID09PSB0cnVlKSB7XG4gICAgICByZXR1cm4gMTtcbiAgICB9XG5cbiAgICByZXR1cm4gY29tcGFyZUFzYyhkYXRlT2JqMSwgZGF0ZU9iajIpO1xuICB9XG5cblxuICAvKipcbiAgICogXG4gICAqIEBwYXJhbSBjdXJyZW50RGF0ZSDlvZPliY3ml6XmnJ9cbiAgICogQHBhcmFtIHRhcmdldERhdGUg55uu5qCH5pel5pyfXG4gICAqIEBwYXJhbSB0eXBlIOavlOi+g+exu+WeiyBkYXRlXHREXHTlpKkwMDowMCBkYXlcdGRcdOaYn+acnzAwOjAwIG1vbnRoXHRNXHTmnIjnrKzkuIDlpKkwMDowMCB5ZWFyXHR5XHQx5pyIMeaXpTAw54K5IHdlZWtcdHdcdOWRqOesrOS4gOWkqTAwOjAwaG91clx0aFx0MDA6MDA6MDBtaW51dGVcdG1cdDAwOjAwc2Vjb25kXHRzXHQwMG1pbGxpc2Vjb25kXHRtc1x0MFxuICAgKiBAcmV0dXJucyBcbiAgICovXG4gIHN0YXRpYyBpc1NhbWUoY3VycmVudERhdGUsIHRhcmdldERhdGUsIHR5cGU/KSB7XG4gICAgaWYgKHR5cGUpIHtcbiAgICAgIHJldHVybiBkYXlqcyhjdXJyZW50RGF0ZSkuaXNTYW1lKGRheWpzKHRhcmdldERhdGUpLCB0eXBlKVxuICAgIH1cbiAgICByZXR1cm4gZGF5anMoY3VycmVudERhdGUpLmlzU2FtZShkYXlqcyh0YXJnZXREYXRlKSk7XG4gIH1cblxuICAvKipcbiAgICogXG4gICAqIEBwYXJhbSBjdXJyZW50RGF0ZSDlvZPliY3ml6XmnJ9cbiAgICogQHBhcmFtIHRhcmdldERhdGUg55uu5qCH5pel5pyfXG4gICAqIEByZXR1cm5zIGJvb2xlYW5cbiAgICovXG4gIHN0YXRpYyBpc0JlZm9yZShjdXJyZW50RGF0ZSwgdGFyZ2V0RGF0ZSwgdHlwZT8pIHtcbiAgICBpZiAodHlwZSkge1xuICAgICAgcmV0dXJuIGRheWpzKGN1cnJlbnREYXRlKS5pc0JlZm9yZShkYXlqcyh0YXJnZXREYXRlKSwgdHlwZSlcbiAgICB9XG4gICAgcmV0dXJuIGRheWpzKGN1cnJlbnREYXRlKS5pc0JlZm9yZShkYXlqcyh0YXJnZXREYXRlKSk7XG4gIH1cblxuICAvKipcbiAqIFxuICogQHBhcmFtIGN1cnJlbnREYXRlIOW9k+WJjeaXpeacn1xuICogQHBhcmFtIHRhcmdldERhdGUg55uu5qCH5pel5pyfXG4gKiBAcmV0dXJucyBib29sZWFuXG4gKi9cbiAgc3RhdGljIGlzQWZ0ZXIoY3VycmVudERhdGUsIHRhcmdldERhdGUsIHR5cGU/KSB7XG4gICAgaWYgKHR5cGUpIHtcbiAgICAgIHJldHVybiBkYXlqcyhjdXJyZW50RGF0ZSkuaXNBZnRlcihkYXlqcyh0YXJnZXREYXRlKSwgdHlwZSlcbiAgICB9XG4gICAgcmV0dXJuIGRheWpzKGN1cnJlbnREYXRlKS5pc0FmdGVyKGRheWpzKHRhcmdldERhdGUpKTtcbiAgfVxuXG5cbiAgLyoqXG4gICAqIFxuICAgKiBAcGFyYW0gY3VycmVudERhdGUgXG4gICAqIEBwYXJhbSB0YXJnZXREYXRlMSBcbiAgICogQHBhcmFtIHRhcmdldERhdGUyIFxuICAgKiBAcmV0dXJucyBcbiAgICovXG4gIHN0YXRpYyBpc0JldHdlZW4oY3VycmVudERhdGUsIHRhcmdldERhdGUxLCB0YXJnZXREYXRlMiwgdHlwZSwgY29udGFpbnMpIHtcbiAgICBkYXlqcy5leHRlbmQoSXNCZXR3ZWVuKVxuICAgIGlmICh0eXBlKSB7XG4gICAgICByZXR1cm4gZGF5anMoY3VycmVudERhdGUpLmlzQmV0d2VlbihkYXlqcyh0YXJnZXREYXRlMSksIGRheWpzKHRhcmdldERhdGUyKSwgdHlwZSwgY29udGFpbnMpO1xuICAgIH1cbiAgICByZXR1cm4gZGF5anMoY3VycmVudERhdGUpLmlzQmV0d2VlbihkYXlqcyh0YXJnZXREYXRlMSksIGRheWpzKHRhcmdldERhdGUyKSwgbnVsbCwgY29udGFpbnMpO1xuICB9XG59XG5cbmV4cG9ydCB7IERhdGVVdGlsIH07XG5cbiJdfQ==
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("rxjs"),require("rxjs/operators"),require("axios"),require("reflect-metadata"),require("date-fns"),require("dayjs"),require("dayjs/plugin/IsBetween"),require("dayjs/plugin/relativeTime"),require("dayjs/plugin/calendar"),require("dayjs/locale/zh-cn"),require("@farris/expression-engine")):"function"==typeof define&&define.amd?define("@farris/mobile-devkit",["exports","rxjs","rxjs/operators","axios","reflect-metadata","date-fns","dayjs","dayjs/plugin/IsBetween","dayjs/plugin/relativeTime","dayjs/plugin/calendar","dayjs/locale/zh-cn","@farris/expression-engine"],e):e(((t=t||self).farris=t.farris||{},t.farris["mobile-devkit"]={}),t.rxjs,t.rxjs.operators,t.axios,null,t.dateFns,t.dayjs,t.IsBetween,t.relativeTime,t.Calendar,null,t.expressionEngine)}(this,(function(t,e,n,i,r,o,a,s,p,u,c,l){"use strict";i=i&&i.hasOwnProperty("default")?i.default:i,a=a&&a.hasOwnProperty("default")?a.default:a,s=s&&s.hasOwnProperty("default")?s.default:s,p=p&&p.hasOwnProperty("default")?p.default:p,u=u&&u.hasOwnProperty("default")?u.default:u;
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */
var h=function(t,e){return(h=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function f(t,e){function n(){this.constructor=t}h(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var d=function(){return(d=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)};function y(t,e){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(r=(r=a.trys).length>0&&r[r.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}function g(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],i=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function v(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var i,r,o=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(i=o.next()).done;)a.push(i.value)}catch(t){r={error:t}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return a}function m(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(v(arguments[e]));return t}var E,C,b=Function;(E=t.DataChangeType||(t.DataChangeType={}))[E.Add=0]="Add",E[E.Delete=1]="Delete",E[E.Edit=2]="Edit",E[E.Append=3]="Append",(C=t.InjectFlags||(t.InjectFlags={}))[C.Default=0]="Default",C[C.Self=1]="Self",C[C.SkipSelf=2]="SkipSelf",C[C.Optional=4]="Optional";var x=[],P=function(t){return t},M=P,I=function(){return Array.prototype.slice.call(arguments)},w=/\n/gm,T={};function S(t){if("string"==typeof t)return t;if(Array.isArray(t))return"["+t.map(S).join(", ")+"]";if(null==t)return""+t;if(t.overriddenName)return""+t.overriddenName;if(t.name)return""+t.name;var e=t.toString();if(null==e)return""+e;var n=e.indexOf("\n");return-1===n?e:e.substring(0,n)}function O(t){for(var e in t)if(t[e]===O)return e;throw Error("Could not find renamed property on target object.")}function j(t,e){return new Error(function(t,e,n,i){void 0===i&&(i=null),t=t&&"\n"===t.charAt(0)&&"ɵ"==t.charAt(1)?t.substr(2):t;var r=S(e);if(Array.isArray(e))r=e.map(S).join(" -> ");else if("object"==typeof e){var o=[];for(var a in e)if(e.hasOwnProperty(a)){var s=e[a];o.push(a+":"+("string"==typeof s?JSON.stringify(s):S(s)))}r="{"+o.join(", ")+"}"}return n+(i?"("+i+")":"")+"["+r+"]: "+t.replace(w,"\n  ")}(t,e,"StaticInjectorError"))}var D=O({"ɵprov":O}),N=(O({"ɵinj":O}),O({ngInjectableDef:O}));function R(t,e){return e&&e.token===t?e:null}var B=function(){function t(t,e){var n;this._desc=t,this.ngMetadataName="InjectionToken",this.ɵprov=void 0,"number"==typeof e?this.__NG_ELEMENT_ID__=e:void 0!==e&&(this.ɵprov={token:(n={token:this,providedIn:e.providedIn||"root",factory:e.factory}).token,providedIn:n.providedIn||null,factory:n.factory,value:void 0})}return t.prototype.toString=function(){return"InjectionToken "+this._desc},t}();function V(t){return new B(t)}var A=function(){},_=new(function(){function t(){}return t.prototype.get=function(t,e){if(void 0===e&&(e=T),e===T){var n=new Error("NullInjectorError: No provider for "+S(t)+"!");throw n.name="NullInjectorError",n}return e},t}()),F=O({__forward_ref__:O});function L(t){return"function"==typeof(e=t)&&e.hasOwnProperty(F)&&e.__forward_ref__===k?t():t;var e}function k(t){return t.__forward_ref__=k,t.toString=function(){return S(this())},t}var H=new B("INJECTOR",-1),K=O,U=O({provide:String,useValue:K}),q=void 0;function G(t){var e=q;return q=t,e}var z=function(){function e(t,e,n){void 0===e&&(e=_),void 0===n&&(n=null),e=e||_,this.parent=e,this.source=n;var i=this._records=new Map;i.set(A,{token:A,fn:P,deps:x,value:this,useNew:!1}),i.set(H,{token:H,fn:P,deps:x,value:this,useNew:!1}),this.scope=function t(e,n){var i=null;if(n)if(n=L(n),Array.isArray(n))for(var r=0;r<n.length;r++)i=t(e,n[r])||i;else{if("function"==typeof n)throw j("Function/Class not supported",n);if(!n||"object"!=typeof n||!n.provide)throw j("Unexpected provider",n);var o=L(n.provide),a=Y(n);if(!0===n.multi){var s=e.get(o);if(s){if(s.fn!==I)throw J(o)}else e.set(o,s={token:n.provide,deps:[],useNew:!1,fn:I,value:x});o=n,s.deps.push({token:o,options:6})}var p=e.get(o);if(p&&p.fn===I)throw J(o);o===W&&(i=a.value),e.set(o,a)}return i}(i,t)}return e.prototype.get=function(e,n,i){void 0===i&&(i=t.InjectFlags.Default);var r,o=this._records,a=o.get(e);if(void 0===a){var s=R(r=e,r[D])||R(r,r[N]);if(s){var p=s&&s.providedIn;("any"===p||null!=p&&p===this.scope)&&o.set(e,a=Y({provide:e,useFactory:s.factory,deps:x}))}void 0===a&&o.set(e,null)}var u=G(this);try{return $(e,a,o,this.parent,n,i)}catch(t){throw t}finally{G(u)}},e.prototype.toString=function(){var t=[];return this._records.forEach((function(e,n){return t.push(S(n))})),"StaticInjector["+t.join(", ")+"]"},e}();function J(t){return j("Cannot mix multi providers and regular providers",t)}var W=new B("Set Injector scope.");function Y(t){var e=function(t){var e=x,n=t.deps;if(n&&n.length){e=[];for(var i=0;i<n.length;i++){var r=L(n[i]);e.push({token:r,options:6})}}else if(t.useExisting){r=L(t.useExisting);e=[{token:r,options:6}]}else if(!(n||U in t))throw j("'deps' required",t);return e}(t),n=P,i=x,r=!1,o=L(t.provide);if(U in t)i=t.useValue;else if(t.useFactory)n=t.useFactory;else if(t.useExisting);else if(t.useClass)r=!0,n=L(t.useClass);else{if("function"!=typeof o)throw j("StaticProvider does not have [useValue|useFactory|useExisting|useClass] or [provide] is not newable",t);r=!0,n=o}return{deps:e,fn:n,useNew:r,value:i}}function $(e,n,i,r,o,a){try{return function(e,n,i,r,o,a){var s,p;if(!n||a&t.InjectFlags.SkipSelf)p=a&t.InjectFlags.Self?a&t.InjectFlags.Optional?_.get(e,void 0!==o?o:null):_.get(e,o):r.get(e,o,t.InjectFlags.Default);else{if((p=n.value)===M)throw Error("ɵCircular dependency");if(p===x){n.value=M;var u=n.useNew,c=n.fn,l=n.deps,h=x;if(l.length){h=[];for(var f=0;f<l.length;f++){var d=l[f],y=d.options,g=2&y?i.get(d.token):void 0;h.push($(d.token,g,i,g||4&y?r:_,1&y?null:T,t.InjectFlags.Default))}}n.value=p=u?new((s=c).bind.apply(s,m([void 0],h))):c.apply(void 0,h)}}return p}(e,n,i,r,o,a)}catch(t){throw t instanceof Error||(t=new Error(t)),(t.ngTempTokenPath=t.ngTempTokenPath||[]).unshift(e),n&&n.value===M&&(n.value=x),t}}function X(t,e,n){return new z(t,e,n)}var Z=X;function Q(t,e){return Array.isArray(t)?Z(t,e,""):Z(t.providers,t.parent,t.name||"")}var tt="__annotations__",et="__parameters__",nt="__prop__metadata__";function it(t,e,n,i,r){var o=rt(e);function a(){for(var t,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];if(this instanceof a)return o.call.apply(o,m([this],e)),this;var s=new((t=a).bind.apply(t,m([void 0],e))),p=function(t){return r&&r.apply(void 0,m([t],e)),(t.hasOwnProperty(tt)?t[tt]:Object.defineProperty(t,tt,{value:[]})[tt]).push(s),t};return i&&i(p),p}return n&&(a.prototype=Object.create(n.prototype)),a.prototype.ngMetadataName=t,a.annotationCls=a,a}function rt(t){return function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];if(t){var i=t.apply(void 0,m(e));for(var r in i)this[r]=i[r]}}}function ot(t,e,n){var i=rt(e);function r(){for(var t,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];if(this instanceof r)return i.apply(this,e),this;var o=new((t=r).bind.apply(t,m([void 0],e)));return function(t,e){var n=t.constructor,i=n.hasOwnProperty(nt)?n[nt]:Object.defineProperty(n,nt,{value:{}})[nt];i[e]=i.hasOwnProperty(e)&&i[e]||[],i[e].unshift(o)}}return n&&(r.prototype=Object.create(n.prototype)),r.prototype.ngMetadataName=t,r.annotationCls=r,r}var at,st=function(){function t(){}return t.getClassMetadatas=function(t){return t[tt]},t.getClassMetadataByName=function(t,e){return this.getClassMetadataByNameWithTranslate(t,e,null,null)},t.getClassMetadataByNameWithTranslate=function(t,e,n,i){var r=this.getClassMetadatas(t);if(!r)return null;var o=r.find((function(t){return t.ngMetadataName===e}));return o&&n&&i&&i.forEach((function(t){var e=o[t];if(e&&e.startsWith("{{")&&e.endsWith("}}")){var i=e.replace("{{","").replace("}}","").trim();o[t]=n.transform(i,null)}})),o},t.getPropsMetadatas=function(t){return t[nt]},t.getPropsMetadatasByName=function(t,e){return this.getPropsMetadatasByNameWithTranslate(t,e)},t.getPropsMetadatasByNameWithTranslate=function(t,e,n,i){var r={},o=this.getPropsMetadatas(t);return o?(Object.keys(o).forEach((function(t){var a=o[t].find((function(t){return t.ngMetadataName===e}));n&&i&&i.forEach((function(t){var e=a[t];if(e&&e.startsWith("{{")&&e.endsWith("}}")){var i=e.replace("{{","").replace("}}","").trim();a[t]=n.transform(i,null)}})),a&&(r[t]=a)})),r):r},t.getPropMetadatasByName=function(t,e){return null},t.getPropMetadataByName=function(t,e,n){return null},t}(),pt=function(){function t(){}return t.GET="GET",t.DELETE="DELETE",t.HEAD="HEAD",t.OPTIONS="OPTIONS",t.POST="POST",t.PUT="PUT",t.PATCH="PATCH",t.LINK="LINK",t.UNLINK="UNLINK",t}(),ut=function(){function t(){}return t.appendHeader=function(t,e,n){var i;return t=Object.assign({},t,((i={})[e]=n,i))},t.appendBodyToRequestConfig=function(t,e){return e||(e={}),e=Object.assign({},e,{body:t})},t.buildAxiosRequestConfig=function(t,e,n){return{url:e,method:t,params:(n=n||{}).params||null,headers:n.headers||null,responseType:n.responseType||"json",data:n.body||null}},t.buildHttpResponse=function(t){return{body:t.data,headers:t.headers,status:t.status,statusText:t.statusText}},t}(),ct=function(){function t(){this.axiosInstance=i.create()}return t.prototype.get=function(t,e){return this.request("GET",t,e)},t.prototype.post=function(t,e,n){return n=ut.appendBodyToRequestConfig(e,n),this.request("POST",t,n)},t.prototype.put=function(t,e,n){return n=ut.appendBodyToRequestConfig(e,n),this.request("PUT",t,n)},t.prototype.patch=function(t,e,n){return n=ut.appendBodyToRequestConfig(e,n),this.request("PATCH",t,n)},t.prototype.delete=function(t,e){return this.request("DELETE",t,e)},t.prototype.request=function(t,i,r){var o=this;return e.of(!0).pipe(n.switchMap((function(){var n=ut.buildAxiosRequestConfig(t,i,r);return e.from(o.axiosInstance.request(n))}))).pipe(n.map((function(t){var e=ut.buildHttpResponse(t);return"response"===r.observe?e:t.data})))},t}(),lt=[{provide:ct,useClass:ct,deps:[]}],ht=function(t,e,n,i,r){this.type=e,this.value=t,this.preValue=i,this.path=n,this.position=r};function ft(t,e){return JSON.stringify(t)===JSON.stringify(e)}(at=t.ModifyType||(t.ModifyType={})).Add="ADD",at.AddData="AddData",at.Clone="CLONE",at.Remove="REMOVE",at.RemoveData="RemoveData",at.ValueChange="VALUE_CHANGE",at.Load="LOAD",at.UnChanged="UNCHANGED",at.PaginationInfoChange="PAGINATION_INFO_CHANGE",at.Insert="Insert",at.Update="UPDATE";var dt,yt=function(){function e(){this.modifications=[]}return Object.defineProperty(e.prototype,"changes",{get:function(){return this.modifications},enumerable:!0,configurable:!0}),e.prototype.append=function(e){switch(e.type){case t.ModifyType.ValueChange:this.appendValueChangeModification(e);break;case t.ModifyType.Add:case t.ModifyType.Insert:case t.ModifyType.Clone:this.appendAddModification(e);break;case t.ModifyType.Remove:this.appendRemoveModification(e);break;case t.ModifyType.Load:break;default:throw new Error("不支持此类型的变更")}},e.prototype.appendValueChangeModification=function(t){var e=t.value,n=this.findModifyItemsPath(t.path);if(n)n.value=e;else{var i=this.findNewAddItemsPath(t.path);i?i.value=Object.assign({},i.value,e):this.modifications.push(t)}},e.prototype.appendAddModification=function(t){var e=t.value,n=this.findNewAddItemsPath(t.path);n?n.value=n.value.concat(e):this.modifications.push(t)},e.prototype.appendRemoveModification=function(e){var n=e.path,i=Object.keys(e.value)[0],r=e.value[i];this.modifications.forEach((function(e){e.type!==t.ModifyType.Add&&e.type!==t.ModifyType.Insert&&e.type!==t.ModifyType.Clone||!1!==ft(e.path,n)&&(e.value=e.value.filter((function(t){return t[i]!==r})))}));var o=n.concat(i+":"+r);this.modifications=this.modifications.filter((function(e){if(e.type!==t.ModifyType.ValueChange)return!0;var n=Array.from(e.path);return n.pop(),!ft(n,o)})),this.removeDescendantRemoveModifications(e),this.modifications.push(e)},e.prototype.clear=function(){this.modifications=[]},e.prototype.findNewAddItemsPath=function(e){return this.modifications.find((function(n,i){return ft(e,n.path)&&(n.type===t.ModifyType.Add||n.type===t.ModifyType.Insert||n.type===t.ModifyType.Clone)}))},e.prototype.findModifyItemsPath=function(e){return this.modifications.find((function(n,i){return ft(e,n.path)&&n.type===t.ModifyType.ValueChange}))},e.prototype.removeDescendantRemoveModifications=function(e){var n=this,i=this.createRemovePathWithId(e);this.modifications=this.modifications.filter((function(e){if(e.type!==t.ModifyType.Remove)return!0;var r=n.createRemovePathWithId(e);return!n.isDescendantPath(i,r)}))},e.prototype.createRemovePathWithId=function(t){var e=t.path,n=Object.keys(t.value)[0],i=t.value[n];return e.concat([n+":"+i])},e.prototype.isDescendantPath=function(t,e){if(t.length>e.length)return!1;var n=!0;return t.forEach((function(t,i){t===e[i]||(n=!1)})),n},e}();(dt=t.DataPathNodeType||(t.DataPathNodeType={})).DataId="DataId",dt.PropName="PropName";var gt,vt=function(t,e){this.type=t,this.value=e,this.prev=null,this.next=null},mt=function(){function t(){this.head=new vt(null,null),this.length=0}return t.prototype.unshift=function(t,e){var n=new vt(t,e);n.next=this.head.next,n.prev=this.head,this.head.next=n,n.next&&(n.next.prev=n),this.length++},t.prototype.push=function(t,e){var n=this.getTail(),i=new vt(t,e);n.next=i,this.length++},t.prototype.getTail=function(){for(var t=this.head;t.next;)t=t.next;return t},t.prototype.toArray=function(){for(var t=[],e=this.head.next;e;)t.push(e.type+":"+e.value),e=e.next;return t},t.prototype.toString=function(){return"["+this.toArray().join(", ")+"]"},t.prototype.clone=function(){for(var e=new t,n=this.head.next;n;)e.push(n.type,n.value),n=n.next;return e},t}();(gt=t.DataPropGroup||(t.DataPropGroup={})).Primitive="Primitive",gt.Object="Object",gt.Dynamic="Dynamic",gt.List="List";var Et=function(){};var Ct=ot("PrimitivePropMeta",(function(t){var e={primary:!1,foreign:!1};if(t)switch(typeof t){case"boolean":e.primary=Boolean(t);break;case"string":e.dataField=String(t);break;case"object":e=Object.assign(e,t)}return e})),bt=function(){function t(){}return t.format=function(t,e){var n=e.maxLenght,i=e.prefix,r=void 0===i?"":i,o=e.suffix,a=void 0===o?"":o,s=e.ellipsis,p=void 0===s?"...":s;return n&&t?n&&t.length>n?r+(t=t.slice(0,n))+a+p:r+t+a:t},t.filterSearchValue=function(t,e){if(null==t||null==t||""==t)return t;if(t=t.trim(),null==e||null==e||""==e)return t=t.replace(/[<>&"]/g,(function(t){return{"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;"}[t]}));if(e&&""==e.text)return"<p>"+(t=t.replace(/[<>&"]/g,(function(t){return{"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;"}[t]})))+"</p>";if("string"==typeof e){var n=new RegExp(""+e,"g");return"<p>"+t.replace(n,"##s1p1##"+e+"##s2p2##").replace(/[<>&"]/g,(function(t){return{"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;"}[t]})).replace(/##s1p1##/g,'<span style="color:red">').replace(/##s2p2##/g,"</span>")+"</p>"}if("object"==typeof e){var i=e.text,r=e.style;n=new RegExp(""+i,"g");return"<p>"+t.replace(n,"##s1p1##"+r+"##s2p2##"+i+"##s3p3##").replace(/[<>&"]/g,(function(t){return{"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;"}[t]})).replace(/##s1p1##/g,'<span style="').replace(/##s2p2##/g,'">').replace(/##s3p3##/g,"</span>")+"</p>"}},t}(),xt=function(){function t(){}return t.format=function(t,e){var n,i=e.precision||0===e.precision?e.precision:2,r=e.decimal||".",o=e.thousand||"",a=e.prefix||"",s=e.suffix||"";"dynamic"==e.prefixType&&e.prefix&&(a=new Function("return "+e.prefix)()(e.sourceData));t=(t+"").replace(/[^0-9+-Ee.]/g,"");var p,u,c;if(n=(i||0===i?(p=t,u=i,c=Math.pow(10,u),""+parseFloat(Math.round(parseFloat((p*c).toFixed(2*u))).toFixed(2*u))/c):""+Math.round(t)).split("."),o){for(var l=/(-?\d+)(\d{3})/;l.test(n[0]);)n[0]=n[0].replace(l,"$1"+o+"$2");(n[1]||"").length<i&&(n[1]=n[1]||"",n[1]+=new Array(i-n[1].length+1).join("0"))}var h=n.join(r);return h=""+a+h+s},t}(),Pt=function(){function t(){}return t.format=function(t,e){return!0===t?"是":"否"},t}(),Mt=function(){function t(){}return t.format=function(t,e){var n=e.separator,i=e.enumData,r=[];if(t&&n&&(r=t.split(n)),r.length>1)return r.map((function(t){var e=i.find((function(e){return e.value===t}));return e?e.name:(console.error("找不到"+t+"对应的枚举选项"),t)})).join(n);var o=i.find((function(e){return e.value===t}));return o?o.name:(console.error("找不到"+t+"对应的枚举选项"),t)},t}();a.locale("zh-cn");var It,wt,Tt,St=function(){function t(){}return t.formatISO=function(t){if(!0===this.isEmptyDateOrDateString(t))return this.emptyISODateTimeString;var e=this.parse(t);return o.format(e,this.defaultISOFormat)},t.format=function(t,e){if(!0===this.isEmptyDateOrDateString(t))return this.emptyISODateTimeString;var n=this.parse(t);return e=e||this.defaultDisplayFormat,o.format(n,e)},t.dateShow=function(t,e){return!0===this.isEmptyDateOrDateString(t)?this.emptyISODateTimeString:e&&""!==e?this[e]&&this[e](t):void 0},t.dateOperation=function(t,e){if(!0===this.isEmptyDateOrDateString(t))return this.emptyISODateTimeString;var n=e.type,i=void 0===n?"":n,r=e.option;return i&&""!==i?"isSame"===i?this[i]&&this[i](t,e.targetDate,e.granularity):"isBefore"===i?this[i]&&this[i](t,e.targetDate,e.granularity):"isAfter"===i?this[i]&&this[i](t,e.targetDate,e.granularity):"isBetween"===i?this[i]&&this[i](t,e.targetDate,e.targetDate2,e.granularity,e.contains):r?this[i]&&this[i](t,r):this[i]&&this[i](t):void 0},t.relativeTime=function(t,e){a.extend(p);var n=a(t);return e?a(n).fromNow(e):a(n).fromNow()},t.isToday=function(t){var e=new Date,n=a(t);return this.isSame(n,e,"date")},t.calendar=function(t,e){var n=a(t);return a.extend(u),e?a().calendar(n,d({},e)):a().calendar(n,{sameDay:"[今天] HH:mm",nextDay:"[明天] HH:mm",lastDay:"[昨天] HH:mm",sameElse:"YYYY-MM-DD"})},t.parse=function(t){return!0===this.isEmptyDateOrDateString(t)?null:!0===this.isDate(t)?t:o.parseISO(t)},t.isDate=function(t){return o.isDate(t)},t.isEmptyDateOrDateString=function(t){return!0===this.isDate(t)?this.isEmptyDate(t):this.isEmptyDateString(t)},t.isEmptyDate=function(t){return!t},t.isEmptyDateString=function(t){return!t||!0===t.startsWith("0001-01-01")},t.isEqual=function(t,e){var n=this.parse(t),i=this.parse(e);return n===i||o.isEqual(n,i)},t.compare=function(t,e){var n=this.parse(t),i=this.parse(e);return!0===this.isEqual(n,i)?0:n||!0!==this.isDate(i)?i||!0!==this.isDate(n)?o.compareAsc(n,i):1:-1},t.isSame=function(t,e,n){return n?a(t).isSame(a(e),n):a(t).isSame(a(e))},t.isBefore=function(t,e,n){return n?a(t).isBefore(a(e),n):a(t).isBefore(a(e))},t.isAfter=function(t,e,n){return n?a(t).isAfter(a(e),n):a(t).isAfter(a(e))},t.isBetween=function(t,e,n,i,r){return a.extend(s),i?a(t).isBetween(a(e),a(n),i,r):a(t).isBetween(a(e),a(n),null,r)},t.emptyDateTimeString=null,t.emptyISODateTimeString=null,t.defaultISOFormat="yyyy-MM-dd'T'HH:mm:ssxxx",t.defaultDisplayFormat="yyyy-MM-dd HH:mm:ss",t.defaultDateFormat="yyyy-MM-dd",t.defaultTimeFormat="HH:mm:ss",t}(),Ot=function(){function t(){}return t.remove=function(t,e){var n=t.findIndex((function(t){return t===e}));this.removeByIndex(t,n)},t.removeByIndex=function(t,e){!t||t[e],t.splice(e,1)},t}(),jt=function(){function t(){}return t.isPlainObject=function(t){if("object"!=typeof t||null===t||"[object Object]"!==Object.prototype.toString.call({}))return!1;if(null===Object.getPrototypeOf(t))return!0;for(var e=t;null!==Object.getPrototypeOf(e);)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e},t}(),Dt=function(){function t(){}return t.toBindingPathArray=function(t){return"string"==typeof t?t.split("/").filter((function(t){return""!==t})):t.concat([])},t.toBindingPathString=function(t){return"/"+t.join("/")},t}(),Nt=function(){function t(){}return t.isEqual=function(t,e){var n=Dt.toBindingPathArray(t),i=Dt.toBindingPathArray(e);return n.every((function(t,e){return t===i[e]}))},t.isParent=function(t,e){var n=Dt.toBindingPathArray(t),i=Dt.toBindingPathArray(e);if(n.length===i.length+1)return this.isAncestor(t,e)},t.isAncestor=function(t,e){var n=Dt.toBindingPathArray(t),i=Dt.toBindingPathArray(e);return!(t.length<=i.length)&&i.every((function(t,e){return t===n[e]}))},t}(),Rt=function(){function t(){}return t.getLeafPathString=function(t){return Dt.toBindingPathArray(t).pop()},t.getParentPathString=function(t){var e=Dt.toBindingPathArray(t);return e.pop(),"/"+e.join("/")},t}();(It=t.ChangeType||(t.ChangeType={})).Load="Load",It.Append="Append",It.Remove="Remove",It.Swap="Swap",It.SelectionChanged="SelectionChanged",It.ValueChanged="ValueChanged",It.UpdateErrors="UpdateErrors",It.GlobalSelectionChanged="GlobalSelectionChanged",It.PaginationInfoChange="PaginationInfoChange",(wt=t.ViewChangeType||(t.ViewChangeType={}))[wt.ValueChanged=0]="ValueChanged",(Tt=t.BindingPropertyType||(t.BindingPropertyType={})).Plain="Plain",Tt.Object="Object",Tt.List="List",Tt.Dynamic="Dynamic";var Bt=function(){function e(){}return e.getProperties=function(e){var n=[],i=Qt.getNgFields(e);Object.keys(i).forEach((function(e){var r=i[e];n.push({name:e,type:t.BindingPropertyType.Plain,isPrimaryKey:r.primary,isForeignKey:r.foreign,enableMultiLangInput:r.enableMultiLangInput})}));var r=Qt.getNgObjects(e);Object.keys(r).forEach((function(e){var i=r[e];n.push({name:e,type:t.BindingPropertyType.Object,entityType:i.type})}));var o=Qt.getNgList(e);Object.keys(o).forEach((function(e){var i=o[e];n.push({name:e,type:t.BindingPropertyType.List,entityType:i.type})}));var a=Qt.getNgDynamic(e);return Object.keys(a).forEach((function(e){var i=a[e];n.push({name:e,type:t.BindingPropertyType.Dynamic,entityType:i.type})})),n},e.getDynamicProperties=function(e){var n=[];return Object.keys(e).forEach((function(i){e.hasOwnProperty(i)&&(e[i]instanceof Object?n.push({name:i,type:t.BindingPropertyType.Dynamic,entityType:null}):n.push({name:i,type:t.BindingPropertyType.Plain,isPrimaryKey:!1,isForeignKey:!1}))})),n},e.getPropertyByName=function(t,e){return t.find((function(t){return t.name===e}))},e.getPrimaryKey=function(t){var e=t.find((function(t){return!0===t.isPrimaryKey}));return e?e.name:""},e}(),Vt=function(){function n(t){this.isShowValidationMsg=!1,this.controlMap={},this.properties=t,this.primaryKey=Bt.getPrimaryKey(t),this.innerValues=new Map,this.changes=new e.Subject,this.viewChanges=new e.Subject}return Object.defineProperty(n.prototype,"primaryKeyValue",{get:function(){return this.primaryKey?this.getValue(this.primaryKey):""},enumerable:!0,configurable:!0}),n.prototype.setShowValidationMsg=function(t){this.isShowValidationMsg=t},n.prototype.getValue=function(t){return this.innerValues.get(t)},n.prototype.setValue=function(n,i,r,o,a,s){var p=this;void 0===r&&(r=!1),void 0===o&&(o=!1);var u=this.getValue(n);u!==i&&(s&&u!==i||(s=function(t,n,i){return e.of(!0)}),!0===o?s(u,i,!1).subscribe((function(e){if(e){p.innerValues=p.innerValues.set(n,i);var o={type:t.ViewChangeType.ValueChanged,path:[n],value:i,errors:a};p.viewChanges.next(o),!0===r&&p.changes.next({type:t.ChangeType.ValueChanged,path:[n],value:i,id:p.primaryKeyValue,errors:a}),s(u,i,!0).subscribe()}else p.changes.next({type:t.ChangeType.ValueChanged,path:[n],value:u,id:p.primaryKeyValue,errors:a})})):(this.innerValues=this.innerValues.set(n,i),!0===r&&this.changes.next({type:t.ChangeType.ValueChanged,path:[n],value:i,id:this.primaryKeyValue,errors:a}),s(u,i,!0).subscribe()))},n.prototype.toJSON=function(e){var n=this,i=window.localStorage.getItem("languageCode")||"zh-CHS",r={};return this.properties.forEach((function(o){var a=o.name;if(o.type===t.BindingPropertyType.List){var s=n[a];r[a]=s.toJSON(e)}else if(o.type===t.BindingPropertyType.Object){var p=n[a];r[a]=p.toJSON(e)}else if(o.type===t.BindingPropertyType.Dynamic){p=n[a];r[a]=p.toJSON(e)}else if(e&&!0===e.ignoreMultiLangInput&&!0===o.enableMultiLangInput){var u=n.getValue(a);r[a]=u?u[i]:u}else r[a]=n.getValue(a)})),r},n}(),At=function(){function t(){}return t.create=function(t){var e=new kt(t);return this.extendProperties(e,t),e},t.extendProperties=function(t,e){e.forEach((function(e){var n=e.name;Object.defineProperty(t,n,{get:function(){return t.currentItem[n]}})}))},t}(),_t=function(){function e(){}return e.create=function(t){var e=new Vt(t);return this.extendProperties(e,t),e},e.createDynamicBindingObject=function(t){var e=Bt.getDynamicProperties(t),n=new Vt(e);return this.extendProperties(n,e),n},e.extendProperties=function(e,n){var i=this;n.forEach((function(n){n.type===t.BindingPropertyType.List?i.extendListProperty(e,n):n.type===t.BindingPropertyType.Object?i.extendObjectProperty(e,n):n.type===t.BindingPropertyType.Dynamic?i.extendDynamicObjectProperty(e,n):i.extendPlainProperty(e,n)}))},e.extendListProperty=function(t,e){var n=e.name,i=Bt.getProperties(e.entityType),r=At.create(i);r.parent=t,r.changes.subscribe((function(e){e.path.unshift(n),t.changes.next(e)})),Object.defineProperty(t,n,{value:r})},e.extendObjectProperty=function(t,e){var n=e.name,i=Bt.getProperties(e.entityType),r=this.create(i);r.parent=t,r.changes.subscribe((function(e){e.path.unshift(n),t.changes.next(e)})),Object.defineProperty(t,n,{value:r})},e.extendDynamicObjectProperty=function(t,e){t[e.name]=null},e.attachDynamicObjectProperty=function(t,e,n){n.parent=t,n.changes.subscribe((function(n){n.path.unshift(e),t.changes.next(n)})),Object.defineProperty(t,e,{value:n})},e.extendPlainProperty=function(t,e){var n=e.name;Object.defineProperty(t,n,{get:function(){return t.getValue(n)},set:function(e){e!==t.getValue(n)&&t.setValue(n,e,!0,!0)}})},e}(),Ft=function(){function e(){}return e.loadEntity=function(e,n){var i=this;n.properties.forEach((function(r){var o=r.name;if(r.type===t.BindingPropertyType.List)i.loadEntityList(e[o]||e[re],n[o]);else if(r.type===t.BindingPropertyType.Object)e&&e[o]&&i.loadEntity(e[o],n[o]);else if(r.type===t.BindingPropertyType.Dynamic){if(e&&e[o]){var a=_t.createDynamicBindingObject(e[o].data);_t.attachDynamicObjectProperty(n,o,a),i.loadEntity(e[o],n[o])}}else n.setValue(o,e[o],!1,!1)})),this.setUpEntityPipeline(e,n)},e.setUpEntityPipeline=function(e,n){e.onValueChanged.subscribe((function(e){if(e.type===t.ModifyType.ValueChange&&0!==e.path.length){var i=e.path[e.path.length-1],r=e.path[e.path.length-2];if(n.primaryKey&&"id"===n.primaryKey){var o=n.primaryKey;if(r!==o+":"+n.getValue(o))return}n.getValue(i)!==e.value&&n.setValue(i,e.value,!0,!1,e.errors)}})),n.viewChanges.subscribe((function(t){var i,r,o=t.value,a=t.path[0],s=e.getPaths(),p=s.path;n.id;if(s.isUdt){i="",(r=function(t){t&&t&&t.id?i=t.id:t.parent&&r(t.parent)})(n),i,s.isGrid&&p.shift(),p.length&&p.join(".")+"."}if(n.primaryKey){var u=n.primaryKey;if(a!==u&&(!e[u]||e[u]!==n[u]))return}e[a]!==o&&(e[a]=o)}))},e.loadEntityList=function(t,e){this.loadEntities(t.items,e),this.setUpEntityListPipeline(t,e)},e.setUpEntityListPipeline=function(e,n){var i=this;e.onListChanged.subscribe((function(e){switch(e.type){case t.ModifyType.Add:case t.ModifyType.Clone:if(0===e.value.length)return;var r=(a=e.path)[a.length-2],o=n.parent.primaryKeyValue;if(-1===r.indexOf(o))return;i.appendEntities(e.value,n,e.type===t.ModifyType.Clone);break;case t.ModifyType.Insert:r=(a=e.path)[a.length-2],o=n.parent.primaryKeyValue;var a,s=e.position;if(-1===r.indexOf(o))return;i.insertEntity(e.value[0],n,s);break;case t.ModifyType.Remove:var p=e.value[n.primaryKey];n.removeByIds([p]);break;case t.ModifyType.Load:var u=e.value;i.loadEntities(u,n)}}))},e.loadRepository=function(e,n){var i=this,r=Array.from(e.entityCollection.toArray());this.loadEntities(r,n),e.entityCollectionChange.subscribe((function(e){switch(e.type){case t.ModifyType.Load:i.loadEntities(e.value,n,e.entityCreate);break;case t.ModifyType.Add:case t.ModifyType.Clone:i.appendEntities(e.value,n,e.type===t.ModifyType.Clone);break;case t.ModifyType.AddData:i.addData(e.value,n);break;case t.ModifyType.Insert:i.insertEntity(e.value,n,e.position);break;case t.ModifyType.Remove:i.removeEntities(e.value,n);break;case t.ModifyType.RemoveData:i.removeData(e.value,n);break;case t.ModifyType.PaginationInfoChange:n.paginationInfo=e.value}})),n.changes.subscribe((function(n){if(n.type===t.ChangeType.PaginationInfoChange){var i=e.entityCollection;i.paginationInfo=Object.assign({},i.paginationInfo,n.value)}}))},e.loadEntities=function(t,e,n){void 0===n&&(n=!1);var i=this.createBindingObjects(t,e);e.load(i,n)},e.appendEntities=function(t,e,n){void 0===n&&(n=!1);var i=this.createBindingObjects(t,e);e.append(i,n)},e.addData=function(t,e){var n=this.createBindingObjects(t,e);e.addData(n)},e.insertEntity=function(t,e,n){var i=this.createBindingObject(t,e);e.insert(i,n)},e.removeEntities=function(t,e){if(null!==t&&0!==t.length){var n=e.primaryKey,i=[];t.forEach((function(t){i.push(t[n])})),e.removeByIds(i)}},e.removeData=function(t,e){if(null!==t&&0!==t.length){var n=e.primaryKey,i=[];t.forEach((function(t){i.push(t[n])})),e.removeDataByIds(i)}},e.createBindingObjects=function(t,e){var n=this;if(null===t||0===t.length)return[];var i=[];return t.forEach((function(t){var r=_t.create(e.properties);r._ENTITY_=t,n.loadEntity(t,r),i.push(r)})),i},e.createBindingObject=function(t,e){var n=_t.create(e.properties);return this.loadEntity(t,n),n},e.watchReposiroty=function(e,n){e.entityCollectionChange.subscribe((function(e){switch(e.type){case t.ModifyType.PaginationInfoChange:n.pagingInfo=e.value}}))},e.getPropInfo=function(t,e){var n,i,r=Qt.getNgFields(t);Object.keys(r).forEach((function(t){t===e&&(n="NgField",i=null)}));var o=Qt.getNgObjects(t);Object.keys(o).forEach((function(t){t===e&&(n="NgObject",i=o[t].type)}));var a=Qt.getNgList(t);Object.keys(a).forEach((function(t){t===e&&(n="NgList",i=a[t].type)}));var s=Qt.getNgDynamic(t);return Object.keys(s).forEach((function(t){t===e&&(n="NgDynamic",i=s[t].type)})),{propType:n,propEntityType:i}},e.getPrimaryKey=function(t){var e=Qt.getPrimaryFieldMetadata(t);return e?e.dataField:""},e.isObjectProp=function(t,e){var n=!1,i=Qt.getNgObjects(t);return Object.keys(i).forEach((function(t){t===e&&(n=!0)})),n},e.isDynamicProp=function(t,e){var n=!1,i=Qt.getNgDynamic(t);return Object.keys(i).forEach((function(t){t===e&&(n=!0)})),n},e.appendInitialData=function(t,e){var n=Object.assign({},e);delete n.id,delete n.parentID,t.initialData=n},e}(),Lt=function(){function e(){this.paginationInfo=null}return Object.defineProperty(e.prototype,"bindingPath",{get:function(){return this.viewModelContext&&this.viewModelContext.viewModel.bindingPath?this.viewModelContext.viewModel.bindingPath:"/"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pagingInfo",{get:function(){return this.paginationInfo},set:function(t){this.paginationInfo=t,this.firePagingChangeEvent()},enumerable:!0,configurable:!0}),e.prototype.setPagingInfo=function(t,e,n){if(n.length<1||"/"===n)this.paginationInfo=Object.assign(this.paginationInfo,{pageSize:e,pageIndex:t/e+1});else{var i=this.paginationInfo||{};n.substr(1).split("/").filter((function(t){return!!t&&t.length>0})).map((function(t){return t.substring(0,t.length-1)})).forEach((function(t){i.hasOwnProperty(t)||(i[t]={}),i=i[t]})),i.pageIndex=(t/e||0)+1,i.pageSize=e||0}this.firePagingChangeEvent()},e.prototype.firePagingChangeEvent=function(){this.list.changes.next({type:t.ChangeType.PaginationInfoChange,path:[],value:this.paginationInfo})},Object.defineProperty(e.prototype,"changes",{get:function(){return this.list.changes},enumerable:!0,configurable:!0}),e.prototype.setValueChangeInvokerFactory=function(t){this.valueChangeInvokerFactory=t},e.prototype.init=function(t,e){this.initByRepository(t,null)},e.prototype.initByRepository=function(t,e){this.viewModelContext=e,this.properties=Bt.getProperties(t.entityType),this.list=At.create(this.properties),this.pagingInfo=t.entityCollection.paginationInfo,Ft.loadRepository(t,this.list),this.dataTypeInfo=t.entityTypeInfo,this.extendProperties(this.properties)},e.prototype.initByBindingList=function(t,e,n){this.list=t,this.viewModelContext=e,this.dataTypeInfo=n,this.extendProperties(this.list.properties)},e.prototype.getValue=function(t){var e=this.list;return t.forEach((function(t){e&&(e=e[t])})),e},e.prototype.setValue=function(t,n,i,r){if(void 0===i&&(i=!1),void 0===r&&(r=!0),!t||0===t.length)throw Error("路径不能为空");var o=t.slice(0,t.length-1),a=t[t.length-1],s=this.getValue(o);if(!s)throw Error("找不到要设置的对象");s instanceof e?s=s.list.currentItem:s instanceof kt&&(s=s.currentItem),this.valueChangeInvokerFactory?s.setValue(a,n,i,r,null,this.valueChangeInvokerFactory(t)):s.setValue(a,n,i,r)},e.prototype.clearValue=function(t,e,n){var i;void 0===e&&(e=!1),void 0===n&&(n=!0);var r=this.dataTypeInfo.getPropInfoByPath(t);r&&r.metadataInfo&&void 0!==r.metadataInfo.initValue?i=r.metadataInfo.initValue:i="number"==typeof this.getValue(t)?0:"";this.setValue(t,i,e,n)},e.prototype.getList=function(){if(!this.bindingPath||"/"===this.bindingPath)return this.list;var t=this.bindingPath.substr(1).split("/").filter((function(t){return""!==t}));return this.getValue(t)},e.prototype.getObject=function(){return this.getList().currentItem},e.prototype.getPath=function(t){var e=this,n=t.filter((function(t){return t})),i=[this.list.primaryKey+":"+this.list.currentId];return n.forEach((function(t){i.push(t);var n=e[t];n&&i.push(n.primaryKey+":"+n.currentId)})),i},e.prototype.getInitValueByPaths=function(t){var e,n=this.dataTypeInfo&&this.dataTypeInfo.getPropInfoByPath(t)||null;return n&&n.metadataInfo&&void 0!==n.metadataInfo.initValue&&(e=n.metadataInfo.initValue),e},e.prototype.extendProperties=function(t){var e=this;t.forEach((function(t){var n=t.name;Object.defineProperty(e,n,{get:function(){return e.list.currentItem[n]},set:function(t){e.list.currentItem[n]=t}})}))},e}(),kt=function(){function n(t){this._paginationInfo=null,this.properties=t,this.primaryKey=Bt.getPrimaryKey(t),this.changes=new e.Subject,this.innerList=[],this.currentId=null}return Object.defineProperty(n.prototype,"paginationInfo",{get:function(){return this._paginationInfo},set:function(e){this._paginationInfo=e,this._paginationInfo!==e&&this.changes.next({type:t.ChangeType.PaginationInfoChange,path:[],value:this._paginationInfo})},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"pageIndex",{get:function(){return this.paginationInfo&&this.paginationInfo.hasOwnProperty("pageIndex")?this.paginationInfo.pageIndex:1},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"pageSize",{get:function(){return this.paginationInfo&&this.paginationInfo.hasOwnProperty("pageSize")?this.paginationInfo.pageSize:0},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"total",{get:function(){return this.paginationInfo?this.paginationInfo.total||this.paginationInfo.totalCount:0},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"skip",{get:function(){return(this.pageIndex-1)*this.pageSize},enumerable:!0,configurable:!0}),n.prototype.setPaginationInfo=function(t,e){this.paginationInfo=Object.assign({},this.paginationInfo,{pageSize:e,pageIndex:t/e+1})},Object.defineProperty(n.prototype,"currentItem",{get:function(){var t=this.findById(this.currentId);return t||(this.emptyCurrentItem||(this.emptyCurrentItem=_t.create(this.properties)),this.emptyCurrentItem)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"length",{get:function(){return this.innerList.length},enumerable:!0,configurable:!0}),n.prototype[Symbol.iterator]=function(){var t=this,e=-1,n=this.innerList.length;return{next:function(){return++e<n?{done:!1,value:t.innerList[e]}:{done:!0,value:void 0}}}},n.prototype.load=function(e,n){var i=this;if(void 0===n&&(n=!1),this.innerList=[],0!==e.length){if(e.forEach((function(t){i.add(t)})),!this.findById(this.currentId)){var r=e[0][this.primaryKey];this.setCurrentId(r,!1,!1)}}else this.currentId=null;var o={type:t.ChangeType.Load,path:[],value:e};o.create=n,this.changes.next(o)},n.prototype.append=function(e,n){var i=this;if(void 0===n&&(n=!1),0!==e.length){e.forEach((function(t){i.add(t)}));var r=e[e.length-1][this.primaryKey];this.setCurrentId(r,!0,!0);var o={type:t.ChangeType.Append,path:[],value:e};n&&(o.isCloned=!0),this.changes.next(o)}},n.prototype.addData=function(e){var n=this;0!==e.length&&(e.forEach((function(t){n.add(t)})),this.changes.next({type:t.ChangeType.Append,path:[],value:e}))},n.prototype.insert=function(t,e){},n.prototype.add=function(t){var e=this;this.innerList.push(t),t.parent=this,t.changes.subscribe((function(t){e.changes.next(t)}))},n.prototype.removeByIds=function(e){var n=this;if(e&&0!==e.length){var i=this.currentId;e.forEach((function(t){t===i&&(i=n.getCurrentIdBeforeDeleting());var e=n.getIndexById(t);-1!==e&&Ot.removeByIndex(n.innerList,e)})),0===this.innerList.length?this.currentId=null:this.setCurrentId(i,!1,!1),this.changes.next({type:t.ChangeType.Remove,path:[],value:e})}},n.prototype.removeDataByIds=function(t){},n.prototype.clear=function(){this.innerList=[],this.currentId=null,this.changes.next({type:t.ChangeType.Remove,path:[],value:[]})},n.prototype.getCurrentIdBeforeDeleting=function(){var t=-1,e=this.getIndexById(this.currentId);return t=e===this.length-1?e-1:e+1,this.getIdByIndex(t)},n.prototype.findById=function(t){var e,n=this;return void 0===(e=this.innerList.find((function(e){return e.getValue(n.primaryKey)===t})))?null:e},n.prototype.setCurrentId=function(e,n,i){(void 0===n&&(n=!0),void 0===i&&(i=!0),this.currentId!==e)&&(this.findById(e)&&(this.currentId=e,!0===n&&this.changes.next({type:t.ChangeType.SelectionChanged,path:[],value:this.currentItem}),!0===i&&this.changes.next({type:t.ChangeType.GlobalSelectionChanged,path:[],value:this.currentItem})))},n.prototype.getIndexById=function(t){var e=this;return this.innerList.findIndex((function(n){return n[e.primaryKey]===t}))},n.prototype.getIdByIndex=function(t){if(t<0||t>this.length)return null;var e=this.innerList[t];return e?e[this.primaryKey]:null},n.prototype.toArray=function(){return this.innerList.concat([])},n.prototype.swapById=function(t,e){},n.prototype.toJSON=function(t){var e=[];return this.innerList.forEach((function(n){e.push(n.toJSON(t))})),e},n.prototype.getPaginationConfigByPath=function(t,e){if(!t||"/"===t)return this.paginationInfo;if("string"!=typeof t)throw new Error("路径必须为字符串！");var n=(t=t.substring(1)).split("/").filter((function(t){return!!t&&t.trim().length>0})).map((function(t){return t.trim()})),i=this.paginationInfo;return n.forEach((function(t){i=i&&i.hasOwnProperty(t)?i[t]:null})),i||(void 0!==e?e:void 0)},n.prototype.sortBy=function(t,e,n){if(!t||t.length<1||!e||e.length<1)throw new Error("sortBy:argument error");var i="string"==typeof t?t.split(","):t||[],r="string"==typeof e?e.split(","):e||[];if(i.length!==r.length||i.length<1)throw new Error("sortBy:fields and directions not match");var o,a;this.innerList=this.innerList.sort((o=i,a=r,function(t,e){var n,i;try{for(var r=g(o),s=r.next();!s.done;s=r.next()){var p=s.value,u=["asc"].includes(a[o.indexOf(p)])?1:-1;if(t.getValue(p)>e.getValue(p))return 1*u;if(t.getValue(p)<e.getValue(p))return-1*u}}catch(t){n={error:t}}finally{try{s&&!s.done&&(i=r.return)&&i.call(r)}finally{if(n)throw n.error}}return 0}))},n.prototype.getValue=function(t,e,i,r){var o,a;void 0===i&&(i=!1),void 0===r&&(r="zh-CHS"),t instanceof n?t=t.currentItem:t instanceof Lt&&(t=t.list.currentItem);var s=null;if(-1===e.indexOf("."))s=t[e];else{var p=e.split(".");try{for(var u=g(p),c=u.next();!c.done;c=u.next()){var l=c.value;t=s=this.getValue(t,l,i,r)}}catch(t){o={error:t}}finally{try{c&&!c.done&&(a=u.return)&&a.call(u)}finally{if(o)throw o.error}}}return i&&s&&s.hasOwnProperty(r)?s[r]:s},n}(),Ht=function(){function t(){}return t.createFromRepository=function(t,e){var n=new Lt,i=Bt.getProperties(t.entityType),r=At.create(i);return n.initByBindingList(r,null,t.entityTypeInfo),Ft.loadRepository(t,r),n.pagingInfo=t.entityCollection.paginationInfo,n},t.createFromEntityManager=function(t,e){var n=new Lt,i=Bt.getProperties(t.entityType),r=At.create(i);n.initByBindingList(r,null,t.entityCollection.entityTypeInfo);var o=t.getEntitiesByPath([]);return Ft.loadEntities(o,r),n},t.createFromExistingBindingData=function(t,e){var n=new Lt;return n.initByBindingList(t.list,null,n.dataTypeInfo),n},t}(),Kt=function(){function e(){}return e.toEntityPathArray=function(e,n){var i=this,r=Dt.toBindingPathArray(e),o=[];if(0===r.length)return o;var a=n.list.currentItem;return o.push(this.createPrimaryKeyPath(a.primaryKey,a.primaryKeyValue)),r.forEach((function(e){switch(Bt.getPropertyByName(a.properties,e).type){case t.BindingPropertyType.Plain:o.push(e);break;case t.BindingPropertyType.Object:a=a[e],o.push(e),o.push(i.createPrimaryKeyPath(a.primaryKey,a.primaryKeyValue));break;case t.BindingPropertyType.List:var n=a[e];a=n.currentItem,o.push(e),o.push(i.createPrimaryKeyPath(a.primaryKey,a.primaryKeyValue))}})),o},e.createPrimaryKeyPath=function(t,e){return t+":"+e},e}(),Ut=function(){},qt=function(){function t(){}return t.toBindingPathArray=function(t){return t.split(".").filter((function(t){return""!==t}))},t}(),Gt=function(){function e(){}return e.convertToBindingPathArray=function(t){return t.split("/").filter((function(t){return""!==t}))},e.convertToEntityPathArray=function(e,n){var i=this,r=this.convertToBindingPathArray(e),o=[];if(0===r.length)return o;var a=n.list.currentItem;return o.push(this.createPrimaryKeyPath(a.primaryKey,a.primaryKeyValue)),r.forEach((function(e){switch(Bt.getPropertyByName(a.properties,e).type){case t.BindingPropertyType.Plain:o.push(e);break;case t.BindingPropertyType.Object:a=a[e],o.push(e),o.push(i.createPrimaryKeyPath(a.primaryKey,a.primaryKeyValue));break;case t.BindingPropertyType.List:var n=a[e];a=n.currentItem,o.push(e),o.push(i.createPrimaryKeyPath(a.primaryKey,a.primaryKeyValue))}})),o},e.convertToRestUrl=function(e,n){var i=this.convertToBindingPathArray(e),r=[],o=n.list.currentItem;return r.push(o.primaryKeyValue),i.forEach((function(e){var n=Bt.getPropertyByName(o.properties,e);if(n.type!==t.BindingPropertyType.List)throw new Error(n.name+"不是子表对应的属性");var i=o[e];o=i.currentItem,r.push(e),r.push(o.primaryKeyValue)})),r.pop(),"/"+r.join("/")},e.getLeafPath=function(t){return e.convertToBindingPathArray(t).pop()},e.getParentPath=function(t){var n=e.convertToBindingPathArray(t);return n.pop(),"/"+n.join("/")},e.createPrimaryKeyPath=function(t,e){return t+":"+e},e}(),zt=function(){function t(e){if(!e)throw new TypeError("Invalid argument; `value` has no value.");this.value=t.EMPTY,e&&t.isGuid(e)&&(this.value=e)}return t.isGuid=function(e){var n=e.toString();return e&&(e instanceof t||t.validator.test(n))},t.create=function(){return new t([t.gen(2),t.gen(1),t.gen(1),t.gen(1),t.gen(3)].join("-"))},t.createEmpty=function(){return new t("emptyguid")},t.parse=function(e){return new t(e)},t.raw=function(){return[t.gen(2),t.gen(1),t.gen(1),t.gen(1),t.gen(3)].join("-")},t.gen=function(t){for(var e="",n=0;n<t;n++)e+=(65536*(1+Math.random())|0).toString(16).substring(1);return e},t.prototype.equals=function(e){return t.isGuid(e)&&this.value===e.toString()},t.prototype.isEmpty=function(){return this.value===t.EMPTY},t.prototype.toString=function(){return this.value},t.prototype.toJSON=function(){return{value:this.value}},t.validator=new RegExp("^[a-z0-9]{8}-[a-z0-9]{4}-[a-z0-9]{4}-[a-z0-9]{4}-[a-z0-9]{12}$","i"),t.EMPTY="00000000-0000-0000-0000-000000000000",t}(),Jt=function(t){return!!t&&(!(!t[Symbol.observable]||t!==t[Symbol.observable]())||(!(!t["@@observable"]||t!==t["@@observable"]())||t instanceof e.Observable))},Wt=function(){function t(){}return t.isInWf=function(){var t=window.top.location.pathname;return-1!==t.indexOf("wf/webapp/apptaskcenter")||-1!==t.indexOf("wf/webapp/mobiletaskcenter")||-1!==t.indexOf("wf/webapp/proc-center-mobile")},t}(),Yt=function(){function t(){}return t.getParams=function(t){var e=t.split("?");if(e.length<2)return null;var n={};return e[1].split("&").forEach((function(t){if(t){var e=t.split("=");e.length<2||(n[e[0]]=e[1])}})),n},t}();var $t=ot("ObjectPropMeta",(function(t){if(jt.isPlainObject(t))return t;var e=typeof t;return"string"===e?{dataField:t}:"function"===e?{type:t}:void 0}));var Xt=ot("DynamicPropMeta",(function(t){if(jt.isPlainObject(t))return t;var e=typeof t;return"string"===e?{dataField:t}:"function"===e?{type:t}:void 0}));var Zt=ot("ListPropMeta",(function(t){if(jt.isPlainObject(t))return t;var e=typeof t;return"string"===e?{dataField:t}:"function"===e?{type:t}:void 0}));var Qt=function(){function t(){}return t.getNgFields=function(t){return st.getPropsMetadatasByName(t,"PrimitivePropMeta")},t.getNgField=function(t,e){return this.getNgFields(t)[e]},t.getDataField=function(t,e){return this.getNgField(t,e).dataField||e},t.getNgObjects=function(t){return st.getPropsMetadatasByName(t,"ObjectPropMeta")},t.getNgDynamic=function(t){return st.getPropsMetadatasByName(t,"DynamicPropMeta")},t.getNgList=function(t){return st.getPropsMetadatasByName(t,"ListPropMeta")},t.getPrimaryFieldMetadata=function(e){var n=t.getNgFields(e),i=Object.keys(n).find((function(t){return n[t].primary}));if(i){var r=n[i];return r.property=i,r.dataField||(r.dataField=i),r}},t.getPrimaryKey=function(t){var e=this.getPrimaryFieldMetadata(t);return e?e.property:""},t}(),te=function(){function t(){}return t.getAllNgProperties=function(t){var e=this.getNgFieldProperties(t),n=this.getNgObjectProperties(t),i=this.getNgDynamicProperties(t),r=this.getNgObjectProperties(t);return Object.assign({},e,n,i,r)},t.getNgEntityMatadata=function(t){return st.getClassMetadataByNameWithTranslate(t,"EntityMeta")},t.getNgFieldProperties=function(t){return st.getPropsMetadatasByName(t,"PrimitivePropMeta")},t.getNgObjectProperties=function(t){return st.getPropsMetadatasByName(t,"ObjectPropMeta")},t.getNgDynamicProperties=function(t){return st.getPropsMetadatasByName(t,"DynamicPropMeta")},t.getNgListProperties=function(t){return st.getPropsMetadatasByName(t,"ListPropMeta")},t.getPrimaryKeyProperty=function(e){var n,i=t.getNgFieldProperties(e);return Object.keys(i).forEach((function(t){var e=i[t];!0===e.primary&&(n=e)})),n},t}(),ee=function(){function e(t){this.type=t,this.primaryKey="",this.foreignKey="",this.propInfoMap=new Map,this.collectEntityInfos(),this.collectPropInfos()}return Object.defineProperty(e.prototype,"isValueObject",{get:function(){return!this.primaryKey},enumerable:!0,configurable:!0}),e.prototype.getPropInfos=function(){return Array.from(this.propInfoMap.values())},e.prototype.getPropNames=function(){var t=[];return this.getPropInfos().forEach((function(e){t.push(e.name)})),t},e.prototype.getPropInfosByGroup=function(t){return Array.from(this.propInfoMap.values()).filter((function(e){return e.group===t}))},e.prototype.getPropNamesByGroup=function(t){var e=[];return this.getPropInfosByGroup(t).forEach((function(t){e.push(t.name)})),e},e.prototype.getPropInfoByName=function(t){return this.propInfoMap.has(t)?this.propInfoMap.get(t):null},e.prototype.getPropInfoByPath=function(e){var n=e.concat([]);if(0===n.length)throw Error("属性路径不能为空");for(var i=this,r=null;i&&n.length>0;){var o=n.shift();if(!(r=i.getPropInfoByName(o)))throw Error("路径"+e+"中存在不正确的节点"+o+"，请检查");i=r.typeInfo,r.group===t.DataPropGroup.Dynamic&&n.length>0&&(r=null,i=null)}return r},e.prototype.getTypeInfoByPath=function(t){if(0===t.length)return this;var e=this.getPropInfoByPath(t);if(!e.typeInfo)throw Error("路径"+t+"无法定位到一个EntityTypeInfo，请检查");return e.typeInfo},e.prototype.getPrimaryKeyPropInfo=function(){return this.getPropInfoByName(this.primaryKey)},e.prototype.getPropMappingByName=function(t){var e=this.getPropInfoByName(t);return e?e.mapping:""},e.prototype.getPropMappingByPath=function(t){var e=this.getPropInfoByPath(t);return e?e.mapping:""},e.prototype.checkPropGroup=function(t,e){var n=this.getPropInfoByName(t);return!(!n||n.group!==e)},e.prototype.collectEntityInfos=function(){var t=te.getNgEntityMatadata(this.type);this.entityInfo=t},e.prototype.collectPropInfos=function(){var e=this,n=te.getNgFieldProperties(this.type);Object.keys(n).forEach((function(i){var r=n[i];!0===r.primary&&(e.primaryKey=i),!0===r.foreign&&(e.foreignKey=i),e.addPropInfo(t.DataPropGroup.Primitive,i,r.dataField,null,r)}));var i=te.getNgObjectProperties(this.type);Object.keys(i).forEach((function(n){var r=i[n];e.addPropInfo(t.DataPropGroup.Object,n,r.dataField,r.type,r)}));var r=te.getNgDynamicProperties(this.type);Object.keys(r).forEach((function(n){var i=r[n];e.addPropInfo(t.DataPropGroup.Dynamic,n,i.dataField,null,i)}));var o=te.getNgListProperties(this.type);Object.keys(o).forEach((function(n){var i=o[n];e.addPropInfo(t.DataPropGroup.List,n,i.dataField,i.type,i)}))},e.prototype.addPropInfo=function(t,n,i,r,o){i=i||n;var a=null;r&&(a=new e(r));var s={group:t,name:n,mapping:i,typeInfo:a,metadataInfo:o};this.propInfoMap.set(n,s)},e}(),ne=function(){function e(){}return e.createByLongPathFromRoot=function(e,n){var i=new mt,r=e;if(!r||0===r.length)return i;for(var o={nodeValue:r.shift(),nodeType:t.DataPathNodeType.DataId,entityTypeInfo:new ee(n.entityType)};o;){i.push(o.nodeType,o.nodeValue);var a=r.shift();if(!a||!o.entityTypeInfo)break;o=this.getNextPathNodeInfo(o,a)}return i},e.getNextPathNodeInfo=function(e,n){var i=e.nodeValue,r=e.nodeType,o=e.entityTypeInfo;if(!n||!o)return null;var a={nodeValue:n,nodeType:null,entityTypeInfo:null};if(r===t.DataPathNodeType.DataId)a.nodeType=t.DataPathNodeType.PropName,a.entityTypeInfo=o;else{var s=o.getPropInfoByName(i);s.group===t.DataPropGroup.List?(a.nodeType=t.DataPathNodeType.DataId,a.entityTypeInfo=s.typeInfo):(a.nodeType=t.DataPathNodeType.PropName,a.entityTypeInfo=s.group===t.DataPropGroup.Object?s.typeInfo:null)}return a},e.createByShortPathFromRoot=function(e,n,i){var r=new mt,o=e,a=i.list.currentItem,s=new ee(n.entityType);return r.push(t.DataPathNodeType.DataId,a.primaryKeyValue),o.forEach((function(e){var n=s.getPropInfoByName(e);switch(n.group){case t.DataPropGroup.Primitive:r.push(t.DataPathNodeType.PropName,e);break;case t.DataPropGroup.Object:a=a[e],s=n.typeInfo,r.push(t.DataPathNodeType.PropName,e);break;case t.DataPropGroup.List:var i=a[e];a=i.currentItem,s=n.typeInfo,r.push(t.DataPathNodeType.PropName,e),r.push(t.DataPathNodeType.DataId,a.primaryKeyValue)}})),r},e}(),ie="__PARENT_PATH__",re="__PARENT__";function oe(t,e){return new t(e)}function ae(t,e){var n=[];return e.forEach((function(e){var i=oe(t,e);n.push(i)})),n}function se(t,e){return new t(e)}var pe=function(){function n(t,n){var i=this;this.__type__="EntityList",this.originalData=[],this.listChanged=new e.Subject,this.changeSet=new yt,this.onListChanged=this.listChanged.asObservable(),this.clear(),t&&t.forEach((function(t){i.initEntity(se(n,t))}))}return Object.defineProperty(n.prototype,"items",{get:function(){return this.rawData},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"changes",{get:function(){return this.changeSet.changes},enumerable:!0,configurable:!0}),n.prototype[Symbol.iterator]=function(){return y(this,(function(t){switch(t.label){case 0:return[5,g(this.items)];case 1:return t.sent(),[2]}}))},n.prototype.loadEntities=function(e){var n=this;this.clear(),e.forEach((function(t){n.initEntity(t)}));var i={path:[],value:e,preValue:void 0,type:t.ModifyType.Load,target:this};this.setChanges(i)},n.prototype.clear=function(){this.rawData=[],this.originalData=[]},n.prototype.appendNew=function(e,n){void 0===n&&(n=!1);var i=this.initEntity(e,!0),r={path:[],value:[i],preValue:void 0,type:t.ModifyType.Add};return!0===n&&(r.type=t.ModifyType.Clone),this.setChanges(r),i},n.prototype.insert=function(e,n){var i=this.initEntity(e,!0),r={path:[],value:[i],preValue:void 0,type:t.ModifyType.Insert,position:n};return this.setChanges(r),i},n.prototype.appendEntity=function(e){var n={path:[],value:[this.initEntity(e)],preValue:void 0,type:t.ModifyType.Add};this.setChanges(n)},n.prototype.appendEntities=function(e){var n=this,i={path:[],value:e.map((function(t){return n.initEntity(t)})),preValue:void 0,type:t.ModifyType.Add};this.setChanges(i)},n.prototype.remove=function(e){var n,i=this.count(),r=this.rawData.findIndex((function(t){return t.primaryValue===e}));if(-1===r)return!1;var o=this.rawData[r];this.rawData.splice(r,1);var a={path:[],value:(n={},n[o.primaryProperty.dataField]=e,n),preValue:void 0,type:t.ModifyType.Remove};return this.updateIndex(i),this.setChanges(a),!0},n.prototype.get=function(t){return this.items.find((function(e){return e.primaryValue===t}))},n.prototype.setChanges=function(e){this.listChanged.next(e);var n=Object.assign({},e);(e.type===t.ModifyType.Add||e.type===t.ModifyType.Insert||e.type===t.ModifyType.Clone)&&e.value[0]instanceof ce&&(n.value=[e.value[0].data]),this.changeSet.append(n)},n.prototype.count=function(){return this.items.length},n.prototype.indexOf=function(t){return this.items.indexOf(t)},n.prototype.sum=function(t){return 0===this.count()?0:this.items.reduce((function(e,n){return e+n[t]}),0)},n.prototype.toJson=function(){return this.rawData},n.prototype.toJSON=function(){var t=[];return this.items.forEach((function(e){t.push(e.toJSON())})),t},n.prototype.toArray=function(){return this.items},n.prototype.initEntity=function(t,e){var n=this;return void 0===e&&(e=!1),t[re]=this,t[ie]=this[ie],t.onValueChanged.subscribe((function(t){var e={path:t.path,value:t.value,preValue:t.preValue,type:t.type};void 0!==t.changeSetValue&&(e.changeSetValue=t.changeSetValue),n.setChanges(e)})),this[this.rawData.push(t)-1]=t,e||this.originalData.push(t.toJSON()),t},n.prototype.updateIndex=function(t){for(var e=this,n=0;n<t;n++)delete this[n];this.rawData.forEach((function(t,n){e[n]=t}))},n.prototype.getPropertyName=function(){var t=this[ie];if(t&&t.length)return t[t.length-1]},n}();function ue(t,e){return new t(e)}var ce=function(){function n(t){this.validErrors={},this.changeSet=new yt,this.isValidating=!1,this.newData=void 0,this.valueChanged=new e.Subject,this.onValueChanged=this.valueChanged.asObservable(),this.hasChange=!1,this.newData=Object.assign({},t),this.onValueChanged=this.valueChanged,this.initialize()}return Object.defineProperty(n.prototype,"data",{get:function(){return this.newData},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"errors",{get:function(){return this.validErrors},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"changes",{get:function(){return this.changeSet.changes},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"primaryProperty",{get:function(){return Qt.getPrimaryFieldMetadata(this.constructor)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"primaryKey",{get:function(){return this.primaryProperty?this.primaryProperty.property:""},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"primaryValue",{get:function(){if(this.primaryKey){var t=this[this.primaryProperty.property];return t||""}return""},enumerable:!0,configurable:!0}),n.prototype.setChanges=function(e){e.path[e.path.length-1];e.type!==t.ModifyType.Load&&(this.hasChange=!0),this.valueChanged.next(e),this.changeSet.append(e)},n.prototype.getPaths=function(){var t={path:[],isUdt:!1,isGrid:!1},e=function(n){var i=n[ie];if(i){var r=i[i.length-1];Object.keys(Qt.getNgObjects(n[re].constructor)).indexOf(r)>-1&&(t.isUdt=!0),n[re]&&n instanceof pe==!0&&(t.isGrid=!0),t.path.push(r)}n[re]&&n instanceof pe==!0&&e(n[re])};return e(this),t.path=t.path.reverse(),t},n.prototype.load=function(t){t||(t={}),this.loadFields(t),this.loadLists(t),this.loadObjects(t),this.loadDynamicObjects(t),this.newData=Object.assign({},t)},n.prototype.toJSON=function(){var t=this,e={},n=Qt.getNgFields(this.constructor);Object.keys(n).forEach((function(i){var r=n[i].dataField||i;e[r]=t[i]}));var i=Qt.getNgObjects(this.constructor);Object.keys(i).forEach((function(n){var r=i[n].dataField||n;e[r]=t[n]?t[n].toJSON():{}}));var r=Qt.getNgDynamic(this.constructor);Object.keys(r).forEach((function(n){var i=r[n].dataField||n;e[i]=t[n]?t[n].toJSON():{}}));var o=Qt.getNgList(this.constructor);return Object.keys(o).forEach((function(n){var i=o[n].dataField||n;e[i]=t[n]?t[n].toJSON():{}})),e},n.prototype.initialize=function(){var t=this.constructor,e=Qt.getNgFields(t),n=Qt.getNgObjects(t),i=Qt.getNgList(t),r=Qt.getNgDynamic(t);this.initializeNormalField(e),this.initializeList(i),this.initializeObject(n),this.initializeDynamic(r)},n.prototype.createPath=function(t){var e=this.primaryProperty;return e?[e.dataField+":"+this.primaryValue,t]:[":",t]},n.prototype.initializeNormalField=function(t){var e=this;Object.keys(t).forEach((function(n){var i=t[n];i.dataField;delete e[n]&&Object.defineProperty(e,n,{get:function(){return this.getPropValue(n,i)},set:function(t){if(!this.primaryKey||this.primaryKey===n||this.primaryValue){var e=this.getPropValue(n,i);!1!==this.isPropValueChanged(n,i,t,e)&&(this.setPropValue(n,i,t),this.emitValueChange(n,i,t,e))}},configurable:!0})}))},n.prototype.initializeList=function(t){var e=this;Object.keys(t).forEach((function(n){var i=t[n],r=e.createPath(n),o=i.dataField||n,a=e.data[o],s=new pe;if(s[re]=e,s[ie]=r,a){var p=a.map((function(t){return ue(i.type,t)}));s.loadEntities(p)}s.onListChanged.subscribe((function(t){t&&(s[ie][0]!==t.path[0]&&(t.path=s[ie].concat(t.path)),e.setChanges(t))})),e[n]=s}))},n.prototype.initializeObject=function(e){var n=this;Object.keys(e).forEach((function(i){var r=e[i],o=n.createPath(i),a=r.dataField||i,s=n.data[a]||{},p=function(t){var e;return(e=t instanceof r.type?t:ue(r.type,t))[re]=n,e[ie]=o,e.onValueChanged.subscribe((function(t){t&&(t.path=(n[ie]||[]).concat(t.path),n.setChanges(t))})),e},u=p(s);delete n[i]&&Object.defineProperty(n,i,{get:function(){return u},set:function(e){var n={path:u[ie],value:e.data,preValue:this[i].data,type:t.ModifyType.ValueChange};u=p(e),this.setChanges(n)},configurable:!0})}))},n.prototype.initializeDynamic=function(e){var n=this;Object.keys(e).forEach((function(i){var r=e[i],o=n.createPath(i),a=r.dataField||i,s=n.data[a]||{},p=function(t){var e;return(e=t instanceof r.type?t:ue(r.type,t))[re]=n,e[ie]=o,e.onValueChanged.subscribe((function(t){t&&(t.path=(n[ie]||[]).concat(t.path),n.setChanges(t))})),e},u=p(s);delete n[i]&&Object.defineProperty(n,i,{get:function(){return u},set:function(e){var n={path:u[ie],value:e.data,preValue:this[i].data,type:t.ModifyType.ValueChange};u=p(e),this.setChanges(n)},configurable:!0})}))},n.prototype.loadFields=function(t){var e=this,n=Qt.getNgFields(this.constructor);Object.keys(n).forEach((function(i){var r=n[i].dataField||i;e[i]=t[r]}))},n.prototype.loadLists=function(t){var e=this,n=Qt.getNgList(this.constructor);Object.keys(n).forEach((function(i){var r=n[i],o=r.dataField||i,a=r.type,s=t[o];if(s){var p=s.map((function(t){return ue(a,t)}));e[i].loadEntities(p)}else e[i].loadEntities([])}))},n.prototype.loadObjects=function(t){var e=this,n=Qt.getNgObjects(this.constructor);Object.keys(n).forEach((function(i){var r=n[i].dataField||i,o=t[r],a=e[i];a&&o&&a.load(o)}))},n.prototype.loadDynamicObjects=function(t){var e=this,n=Qt.getNgDynamic(this.constructor);Object.keys(n).forEach((function(i){var r=n[i].dataField||i,o=t[r]||{},a=e[i];a&&a.loadDynamicData(o)}))},n.prototype.emitValueChange=function(e,n,i,r){var o={path:this.createPath(e),value:i,preValue:r,type:t.ModifyType.ValueChange};this[ie]&&(o.path=this[ie].concat(o.path)),this.setChanges(o)},n.prototype.getPropValue=function(t,e){var n,i=e.dataField||t,r=this.data[i];if(!0===e.enableMultiLangInput&&!r){var o=window.localStorage.getItem("languageCode")||"zh-CHS",a=i.replace("_MULTILANGUAGE","");return(n={})[o]=this.data[a],n}return r},n.prototype.setPropValue=function(t,e,n){var i=e.dataField||t;this.data[i]=n},n.prototype.isPropValueChanged=function(t,e,n,i){return!0===e.enableMultiLangInput?(!0!==this.isEmptyMultiLangPropValue(n)||!0!==this.isEmptyMultiLangPropValue(i))&&JSON.stringify(n)!==JSON.stringify(i):n!==i},n.prototype.isEmptyMultiLangPropValue=function(t){return!t||0===Object.keys(t).length},n}(),le=function(e){function n(t){var n=e.call(this,t)||this;return n.loadDynamicData(t),n}return f(n,e),Object.defineProperty(n.prototype,"IsNested",{get:function(){return this[re]instanceof n},enumerable:!0,configurable:!0}),n.prototype.loadDynamicData=function(t){this.initializeDynamicField(t)},n.prototype.initializeDynamicField=function(e){var n=this;Object.keys(e).forEach((function(i){n[i]&&delete n[i];var r=i;if(e[i]instanceof Object){var o=n.createPath(i),a=n.createDynamicEntityFromJsonData(e[i],o);Object.defineProperty(n,i,{get:function(){return a},set:function(e){var n={path:a[ie],value:e.data,preValue:this[i].data,type:t.ModifyType.ValueChange};a=this.createDynamicEntityFromJsonData(e,o),this.setChanges(n)},configurable:!0})}else Object.defineProperty(n,i,{get:function(){return this.data[r]},set:function(e){var n=this.data[r];if(n!==e){this.data[r]=e;var o={type:t.ModifyType.ValueChange,path:this.createPath(i),value:e,preValue:n};this[ie]&&(o.path=this[ie].concat(o.path)),this.setChanges(o)}},configurable:!0})}))},n.prototype.createDynamicEntityFromJsonData=function(t,e){var i,r=this;return(i=t instanceof n?t:new n(t))[re]=this,i[ie]=e,i.onValueChanged.subscribe((function(t){t&&(t.path=(r[ie]||[]).concat(t.path),r.setChanges(t))})),i},n.prototype.setChanges=function(t){var e,n=t.path[t.path.length-1],i=Object.assign({},this.data);this.newData=Object.assign(this.newData,((e={})[n]=t.value,e));var r=t.path;t.path.length>2&&(r=t.path.slice(0,t.path.length-2));var o={path:r,value:this.data,preValue:i,type:t.type};this.valueChanged.next(o),this.changeSet.append(t)},n.prototype.toJSON=function(){return this.data},n}(ce);var he=function(){function n(t){this.innerEntitySet=new Set,this.innerEntityMap=new Map,this.collectionChanged=new e.Subject,this.changes=new e.Subject,this.entityType=t,this.primaryKey=Qt.getPrimaryKey(this.entityType)}return n.prototype.count=function(){return this.innerEntitySet.size},Object.defineProperty(n.prototype,"entityTypeName",{get:function(){return this.entityType.name},enumerable:!0,configurable:!0}),n.prototype.has=function(t){return this.innerEntityMap.has(t)},n.prototype.clear=function(){this.innerEntityMap.clear(),this.innerEntitySet.clear(),this.notifyCollectionChanged(new ht([],t.ModifyType.Load))},n.prototype.reset=function(){this.innerEntityMap.clear(),this.innerEntitySet.clear();var e=new ht([],t.ModifyType.Load);e.isReset=!0,this.notifyCollectionChanged(e)},n.prototype.toArray=function(){return Array.from(this.innerEntitySet)},n.prototype.toJSON=function(){var t=[];return this.toArray().forEach((function(e){t.push(e.toJSON())})),t},n.prototype.loadEntities=function(e,n){var i=this;void 0===n&&(n=!1),this.innerEntityMap.clear(),this.innerEntitySet.clear(),e.forEach((function(t){i.innerEntitySet.add(t),i.innerEntityMap.set(t[i.primaryKey],t),i.listenEntityChangeEvent(t)}));var r=new ht(e,t.ModifyType.Load);r.entityCreate=n,this.notifyCollectionChanged(r)},n.prototype.addEntity=function(e,n){void 0===n&&(n=!1),this.verifyEntityToAdd(e),this.innerEntitySet.add(e),this.innerEntityMap.set(e[this.primaryKey],e),this.listenEntityChangeEvent(e);var i=n?t.ModifyType.Clone:t.ModifyType.Add;this.notifyCollectionChanged(new ht([e],i))},n.prototype.insertEntity=function(e,n){this.verifyEntityToAdd(e),this.innerEntitySet.add(e),this.innerEntityMap.set(e[this.primaryKey],e),this.listenEntityChangeEvent(e),this.notifyCollectionChanged(new ht(e,t.ModifyType.Insert,null,null,n))},n.prototype.updateEntity=function(e,n){e.load(n),this.notifyCollectionChanged(new ht(e,t.ModifyType.Update,null,null))},n.prototype.addEntities=function(e){var n=this;if(e){var i=[];e.forEach((function(t){n.verifyEntityToAdd(t),i.push(t)})),i.forEach((function(t){n.innerEntitySet.add(t),n.innerEntityMap.set(t[n.primaryKey],t),n.listenEntityChangeEvent(t)})),this.notifyCollectionChanged(new ht(i,t.ModifyType.Add))}},n.prototype.addData=function(e){var n=this;if(e){var i=[];e.forEach((function(t){n.verifyEntityToAdd(t),i.push(t)})),i.forEach((function(t){n.innerEntitySet.add(t),n.innerEntityMap.set(t[n.primaryKey],t),n.listenEntityChangeEvent(t)})),this.notifyCollectionChanged(new ht(i,t.ModifyType.AddData))}},n.prototype.getEntityById=function(t){return!1===this.innerEntityMap.has(t)?null:this.innerEntityMap.get(t)},n.prototype.getEntityByPath=function(t){for(var e=t[0].split(":")[1],n=this.getEntityById(e),i=1;i<t.length&&n;i+=1){var r=t[i];n instanceof ce?-1===r.indexOf(":")&&(n=n[t[i]]):n=n.get(t[i].split(":")[1])}return n},n.prototype.getEntitiesByPath=function(t){for(var e=t[0].split(":")[1],n=this.getEntityById(e),i=1;i<t.length&&n;i+=2){if(!((n=n[t[i]])instanceof pe))throw new Error("路径格式错误");if(i+1<t.length){var r=t[i+1].split(":")[1];n=n.get(r)}}return n},n.prototype.getEntities=function(t){return Array.from(this.innerEntitySet).filter(t)},n.prototype.getAllEntities=function(){return Array.from(this.innerEntitySet)},n.prototype.removeEntityById=function(e){this.verifyEntityToRemove(e);var n=this.innerEntityMap.get(e);return this.innerEntityMap.delete(e),this.innerEntitySet.delete(n),this.notifyCollectionChanged(new ht([n],t.ModifyType.Remove)),n},n.prototype.removeEntitiesByIds=function(t){},n.prototype.removeEntities=function(e){var n=this,i=Array.from(this.innerEntitySet).filter(e);return i.forEach((function(t){n.innerEntityMap.delete(t[n.primaryKey]),n.innerEntitySet.delete(t)})),this.notifyCollectionChanged(new ht(i,t.ModifyType.Remove)),i},n.prototype.removeData=function(e){var n=this,i=Array.from(this.innerEntitySet).filter(e);return i.forEach((function(t){n.innerEntityMap.delete(t[n.primaryKey]),n.innerEntitySet.delete(t)})),this.notifyCollectionChanged(new ht(i,t.ModifyType.RemoveData)),i},n.prototype.resetEntities=function(t,e){var n,i;if(-1===t[0].indexOf(":"))throw new Error("路径格式错误");var r=v(t[0].split(":"),2),o=r[0],a=r[1],s=null;try{for(var p=g(this.innerEntitySet),u=p.next();!u.done;u=p.next()){var c=u.value;if(c[o]===a){s=c;break}}}catch(t){n={error:t}}finally{try{u&&!u.done&&(i=p.return)&&i.call(p)}finally{if(n)throw n.error}}if(!s)throw new Error("找不到"+o+"为"+a+"的实体");var l=s;t.slice(1).forEach((function(t){l=l[t]}));var h=l;h.clear(),h.loadEntities(e)},n.prototype.verifyEntityToAdd=function(t){return this.has(t[this.primaryKey])&&(this.innerEntitySet.delete(this.innerEntityMap.get(t[this.primaryKey])),this.innerEntityMap.delete(t[this.primaryKey])),!0},n.prototype.verifyEntityToRemove=function(t){if(!this.has(t))throw new Error("The entity with identity of '"+t+" dose not exsit.'");return!0},n.prototype.notifyCollectionChanged=function(t){this.collectionChanged.next(t)},Object.defineProperty(n.prototype,"pageSize",{get:function(){return this.paginationInfo&&this.paginationInfo.pageSize||0},set:function(e){if("number"!=typeof e||e<0)throw new Error("Invalid parameter:pageSize");var n=this.paginationInfo;this.paginationInfo=Object.assign({},n,{pageSize:e}),this.notifyCollectionChanged(new ht(this.paginationInfo,t.ModifyType.PaginationInfoChange))},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"totalCount",{get:function(){return this.paginationInfo&&this.paginationInfo.total||0},set:function(e){if("number"!=typeof e||e<0)throw new Error("Invalid parameter:total");var n=this.paginationInfo;this.paginationInfo=Object.assign({},n,{total:e}),this.notifyCollectionChanged(new ht(this.paginationInfo,t.ModifyType.PaginationInfoChange))},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"pageIndex",{get:function(){return this.paginationInfo&&this.paginationInfo.pageIndex||1},set:function(e){if("number"!=typeof e||e<0)throw new Error("Invalid parameter:pageIndex");var n=this.paginationInfo;this.paginationInfo=Object.assign({},n,{pageIndex:e}),this.notifyCollectionChanged(new ht(this.paginationInfo,t.ModifyType.PaginationInfoChange))},enumerable:!0,configurable:!0}),n.prototype.updatePaginationInfoByPath=function(t,e){var n=this.paginationInfo,i=e.pageIndex,r=e.pageSize,o=e.totalCount,a=Object.assign({},n,{pageIndex:i,pageSize:r,total:o});this.setPaginationConfigByPath(t,a)},n.prototype.getPaginationConfigByPath=function(t,e){if(!t||"/"===t)return this.paginationInfo;if("string"!=typeof t)throw new Error("路径必须为字符串！");var n=(t=t.substring(1)).split("/").filter((function(t){return!!t&&t.trim().length>0})).map((function(t){return t.trim()})),i=this.paginationInfo;return n.forEach((function(t){i=i&&i.hasOwnProperty(t)?i[t]:null})),i||(void 0!==e?e:void 0)},n.prototype.setPaginationConfigByPath=function(e,n){var i=JSON.stringify(this.paginationInfo);return e&&"/"!==e?(Array.isArray(e)||(e=e.toString().match(/[^/[\]]+/g)||[]),e.slice(0,-1).reduce((function(t,n,i){return Object(t[n])===t[n]?t[n]:t[n]=Math.abs(e[i+1])>>0==+e[i+1]?[]:{}}),this.paginationInfo)[e[e.length-1]]=n):this.paginationInfo=n,JSON.stringify(this.paginationInfo)!==i&&this.notifyCollectionChanged(new ht(this.paginationInfo,t.ModifyType.PaginationInfoChange)),this.paginationInfo},n.prototype.listenEntityChangeEvent=function(t){var e=this;t&&t.onValueChanged.subscribe((function(t){return e.changes.next(t)}))},n}(),fe=function(){function e(t){this.entityCollection=t,this.entityType=t.entityType}return e.prototype.createEntity=function(t){return oe(this.entityType,t)},e.prototype.createEntities=function(t,e){return ae(this.entityType,t)},e.prototype.createEntitiesByPath=function(t,e){var n,i,r,o=t.split("/");if(o.length<3)throw Error("根据path删除实体数据出错了。传入的path["+t+"]格式不对");if(e.length<1)return[];for(var a=2;a<o.length;a+=2){var s=o[a-1];r=o[a];var p=n?n.get(s):this.entityCollection.getEntityById(s);n=p[r];var u=i?i.propEntityType:this.entityType;if(i=Ft.getPropInfo(u,r),!n)throw Error("fpath参数错误，无法找到"+r+"对应的子表。fpath为："+t)}return e.map((function(t){return oe(i.propEntityType,t)}))},e.prototype.getEntityByPath=function(t){return this.getEntityNodeByPath(t)},e.prototype.getEntitiesByPath=function(t){var e=this.getEntityNodeByPath(t);return e.toArray()},e.prototype.getEntityNodeByPath=function(e){for(var n=ne.createByLongPathFromRoot(e,this),i=this.entityCollection,r=n.head.next;r;){if(!(i=r.type===t.DataPathNodeType.DataId?i instanceof he==!0?i.getEntityById(r.value):i.get(r.value):i[r.value]))throw new Error("找不到"+r.value+"对应的数据节点");r=r.next}return i},e.prototype.getPropValueByPath=function(t){var e=t.pop();return this.getEntityByPath(t)[e]},e.prototype.setPropValueByPath=function(t,e){var n=t.pop();this.getEntityByPath(t)[n]=e},e.prototype.insertEntityBeforeByPath=function(t){throw new Error("Not Implemented")},e.prototype.insertEntitiesBeforeByPath=function(){throw new Error("Not Implemented")},e.prototype.insertEntityAfterByPath=function(){throw new Error("Not Implemented")},e.prototype.insertEntitiesAfterByPath=function(){throw new Error("Not Implemented")},e.prototype.appendEntityByPath=function(t,e,n,i){void 0===i&&(i=!1);var r,o,a,s=t.split("/");if(s.length<3)throw Error("根据path删除实体数据出错了。传入的path["+t+"]格式不对");for(var p=2;p<s.length;p+=2){var u=s[p-1];a=s[p];var c=r?r.get(u):this.entityCollection.getEntityById(u);r=c[a];var l=o?o.propEntityType:this.entityType;if(o=Ft.getPropInfo(l,a),!r)throw Error("fpath参数错误，无法找到"+a+"对应的子表。fpath为："+t)}var h=oe(o.propEntityType,e);return n&&Ft.appendInitialData(h,n),r.appendNew(h,i),h},e.prototype.insertEntityByPath=function(t,e,n,i){var r,o,a,s=t.split("/");if(s.length<3)throw Error("根据path删除实体数据出错了。传入的path["+t+"]格式不对");for(var p=2;p<s.length;p+=2){var u=s[p-1];a=s[p];var c=r?r.get(u):this.entityCollection.getEntityById(u);r=c[a];var l=o?o.propEntityType:this.entityType;if(o=Ft.getPropInfo(l,a),!r)throw Error("fpath参数错误，无法找到"+a+"对应的子表。fpath为："+t)}var h=oe(o.propEntityType,e);return n&&Ft.appendInitialData(h,n),r.insert(h,i),h},e.prototype.appendEntitiesByPath=function(t,e){var n=this.getEntityNodeByPath(t);n instanceof he==!0?n.addEntities(e):n.appendEntities(e)},e.prototype.removeEntityByPath=function(t,e){var n,i=t.split("/");if(i.length<3)throw Error("根据path删除实体数据出错了。传入的path["+t+"]格式不对");for(var r=2;r<i.length;r+=2){var o=i[r-1],a=i[r],s=n?n.get(o):this.entityCollection.getEntityById(o);if(!(n=s[a]))throw Error("fpath参数错误，无法找到"+a+"对应的子表。fpath为："+t)}n.remove(e)},e.prototype.removeEntitiesByPath=function(t,e){throw new Error("Not Implemented")},e.prototype.clearAllEntityChanges=function(){this.entityCollection.toArray().forEach((function(t){t.changes.splice(0,t.changes.length)}))},e.prototype.resetAllEntityChangeMark=function(){this.entityCollection.toArray().forEach((function(t){t.hasChange=!1}))},e.prototype.clearEntityChangesById=function(t){var e=this.entityCollection.getEntityById(t);e&&e.changes.splice(0,e.changes.length)},e.prototype.clearEntityChangesByIds=function(t){var e=this;!t||t.length<0||t.forEach((function(t){e.clearEntityChangesById(t)}))},e.prototype.checkAllEntityChanges=function(){return this.entityCollection.toArray().some((function(t){return t.changes.length>0}))},e.prototype.checkEntityChangesById=function(t){var e=this.entityCollection.getEntityById(t);return!!e&&e.changes.length>0},e.prototype.clearEntityChangesByArray=function(t){this.clearEntityChangesByIds(t)},e}(),de=function(){function t(t,e){this.entityType=t,this.paginationConfig=e,null!==this.paginationConfig&&void 0!==this.paginationConfig||(this.paginationConfig=this.getNgListProperties()),this.expandMainEntityConfig(),this.deleteMainEntityConfig()}return t.prototype.expandMainEntityConfig=function(){var t=this.entityType.name;if(this.paginationConfig.hasOwnProperty(t)){var e=this.paginationConfig[t];this.paginationConfig=Object.assign(this.paginationConfig,e)}},t.prototype.deleteMainEntityConfig=function(){delete this.paginationConfig[this.entityType.name]},Object.defineProperty(t.prototype,"pagination",{get:function(){return this.paginationConfig},enumerable:!0,configurable:!0}),t.prototype.getPaginationConfigByPath=function(t,e){if(!t||"/"===t)return this.paginationConfig;if("string"!=typeof t)throw new Error("路径必须为字符串！");var n=(t=t.substring(1)).split("/").filter((function(t){return!!t&&t.trim().length>0})),i=this.paginationConfig;return n.forEach((function(t){i=i&&i.hasOwnProperty(t)?i[t]:null})),i||(void 0!==e?e:void 0)},t.prototype.setPaginationConfigByPath=function(t,e){return Array.isArray(t)||(t=t.toString().match(/[^/[\]]+/g)||[]),t.slice(0,-1).reduce((function(e,n,i){return Object(e[n])===e[n]?e[n]:e[n]=Math.abs(t[i+1])>>0==+t[i+1]?[]:{}}),this.paginationConfig)[t[t.length-1]]=e,this.paginationConfig},t.prototype.getNgListProperties=function(t){void 0===t&&(t=0);var e=function(n){var i=Qt.getNgList(n),r={};return Object.keys(i).length<1?r:(Object.keys(i).forEach((function(n){var o=i[n].dataField;o.endsWith("s")&&(o=o.substring(0,o.length-1)),r[o]={pageSize:t};var a=e(i[n].type);null!==a&&Object.keys(a).length>0&&(r=Object.assign({},r,a))})),r)},n=e(this.entityType);return Object.assign({},{pageSize:t},n)},t}(),ye=function(){function e(){this.history=[],this.cacheData=[]}return e.prototype.addChange=function(e){this["on"+t.DataChangeType[e.changeType]+"Data"](e)},e.prototype.addChanges=function(t){var e=this;t.forEach((function(t){return e.addChange(t)}))},e.prototype.clear=function(){this.history.splice(0,this.history.length)},e.prototype.clearByIds=function(t){this.history=this.history.filter((function(e){var n,i;if(!e.fpath||"/"===e.fpath||!e.fpath.includes("/"))return!t.includes(e.dataId);try{for(var r=g(t),o=r.next();!o.done;o=r.next()){var a=o.value;return!e.fpath.split("/").includes(a)}}catch(t){n={error:t}}finally{try{o&&!o.done&&(i=r.return)&&i.call(r)}finally{if(n)throw n.error}}}))},e.prototype.isChanged=function(){return this.history.length>0},e.prototype.clearCache=function(){this.cacheData.splice(0,this.cacheData.length)},e.prototype.getCacheData=function(){return this.cacheData},e.prototype.onAddData=function(t){this.history.push(t)},e.prototype.onEditData=function(t){this.cacheData.push(t)},e.prototype.onAppendData=function(t){this.history.push(t),this.cacheData.push(t)},e.prototype.onDeleteData=function(e){var n=this.history.findIndex((function(n){return n.dataId===e.dataId&&n.changeType===t.DataChangeType.Add}));n>=0?this.history.splice(n,1):this.history.push(e)},e}(),ge=function(){function t(){this.paginationInfo=null}return t.prototype.init=function(){this.entityTypeInfo=new ee(this.entityType),this.entityCollection=new he(this.entityType),this.entityCollection.entityTypeInfo=this.entityTypeInfo,this.dataChangeHistory=new ye},Object.defineProperty(t.prototype,"changes",{get:function(){return this.entityCollection.changes},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"primaryKey",{get:function(){return this.entityCollection.primaryKey},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"entityCollectionChange",{get:function(){return this.entityCollection.collectionChanged},enumerable:!0,configurable:!0}),t.prototype.reset=function(){this.entityCollection.clear()},t.prototype.buildEntity=function(t){return oe(this.entityType,t)},t.prototype.buildEntities=function(t){return ae(this.entityType,t)},t.prototype.setPaginationConfig=function(t){this.paginationManager=new de(this.entityType,t);var e=(this.paginationManager.getPaginationConfigByPath("/")||{}).pageSize,n=void 0===e?0:e;this.entityCollection.paginationInfo=Object.assign({pageSize:n},this.entityCollection.paginationInfo,this.paginationManager.pagination)},t.prototype.setPaginationInfo=function(t){this.paginationInfo=d({},this.paginationInfo,t)},t}(),ve=function(t){function e(){return t.call(this)||this}return f(e,t),e.prototype.init=function(){t.prototype.init.call(this),this.entityManager=new fe(this.entityCollection)},e}(ge);var me,Ee=function(){function t(t,e){this.name=t,this.func=e}return t.prototype.execute=function(t){var n=this.func(t);return Jt(n)?n:e.of(n)},t}(),Ce=V("@farris/devkit VARIABLE_PARSERS"),be=function(){},xe=function(){function t(){this.bindingDataMap=new Map}return t.prototype.getBindingDataMap=function(){return this.bindingDataMap},t.prototype.getBindingDataByName=function(t){return this.bindingDataMap.get(t)},t.prototype.regBindingData=function(t,e){this.bindingDataMap.set(t,e)},t.prototype.ifBindingDataExits=function(t){return!!this.getBindingDataByName(t)},t}(),Pe=function(){function t(){this.repositoryMap=new Map}return t.prototype.regRepository=function(t,e){this.repositoryMap.set(t,e)},t.prototype.getRepositoryMap=function(){return this.repositoryMap},t.prototype.getRepositories=function(){return Array.from(this.repositoryMap.values())},t.prototype.getRepositoryByName=function(t){return this.repositoryMap.get(t)},t.prototype.ifRepositoryExits=function(t){return!!this.getRepositoryByName(t)},t}(),Me=function(){function t(){this.contextMap=new Map,this.contextSet=new Set}return t.prototype.regContext=function(t){var e=t.id;!0===this.contextMap.has(e)&&this.unregContext(t),this.contextMap.set(e,t),this.contextSet.add(t)},t.prototype.unregContext=function(t){var e=t.id;this.contextMap.delete(e),this.contextSet.delete(t)},t.prototype.getContextMap=function(){return this.contextMap},t.prototype.getContexts=function(){return Array.from(this.contextSet)},t.prototype.getContextsByNamespace=function(t){return this.getContexts()},t.prototype.getContextById=function(t){return this.contextMap.get(t)},t.prototype.getRootContext=function(){return this.getContexts().find((function(t){return null===t.parent}))},t.prototype.getRootContextAndPosterityById=function(t){var e=this.getContextById(t),n=this.getContexts(),i=[],r=this.getContextsGroupRoot(e);return n.map((function(t){t.parent&&t.parent.id===r&&i.push(t)})),i.push(this.getContextById(r)),i},t.prototype.getContextsGroupRoot=function(t){return t.parent?this.getContextsGroupRoot(t.parent):t.id},t}(),Ie=function(){function t(){this.params=new Map}return t.prototype.getParam=function(t){return this.params.get(t)},t.prototype.setParam=function(t,e){this.params.set(t,e)},t}(),we=new B("@Farris validation rule"),Te=function(t){function e(e,n,i,r,o,a,s){void 0===a&&(a={});var p=t.call(this)||this;return p.injector=e,p.eventBus=n,p.repositoryManager=i,p.bindingDataManager=r,p.viewModelContextManager=o,p.validationManager=a,p.validationRule=s,p.validationRule=e.get(we,[]),p}return f(e,t),e.prototype.regViewModelContext=function(t){var e=t.repository,n=e.name;if(!1===this.repositoryManager.ifRepositoryExits(n)&&this.repositoryManager.regRepository(n,e),!1===this.bindingDataManager.ifBindingDataExits(n)){var i=Ht.createFromRepository(e,"/");this.bindingDataManager.regBindingData(n,i)}this.viewModelContextManager.regContext(t)},e}(Ie),Se=function(){function e(){}return e.prototype.init=function(t){this.innerViewModel=t,this.id=this.innerViewModel.id,this.appContext=t.injector.get(Te),this.regToTree(),this.regToAppContext()},e.prototype.regToTree=function(){var n=this.innerViewModel.injector.get(A,null,t.InjectFlags.SkipSelf);n?(this.parent=n.get(e,null),this.root=this.parent?this.parent.root:this):(this.parent=null,this.root=this)},e.prototype.regToAppContext=function(){this.appContext.regViewModelContext(this)},Object.defineProperty(e.prototype,"viewModel",{get:function(){return this.innerViewModel},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"injector",{get:function(){return this.innerViewModel.injector},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"repository",{get:function(){return this.innerViewModel.repository},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bindingData",{get:function(){return this.innerViewModel.bindingData},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"uiState",{get:function(){return this.innerViewModel.uiState},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stateMachine",{get:function(){return this.innerViewModel.stateMachine},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"form",{get:function(){return this.innerViewModel.form},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"commandBus",{get:function(){return this.innerViewModel.commandBus},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"expressionEngineImpl",{get:function(){return this.innerViewModel.expressionEngineImpl},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"expressionManager",{get:function(){return this.innerViewModel.expressionManager},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"expressionResult",{get:function(){return this.innerViewModel.expressionResult},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"controlsProxy",{get:function(){return this.innerViewModel.controlsProxy},enumerable:!0,configurable:!0}),e.prototype.getVirtualRootFrameContext=function(){return this},e.prototype.registerExtendCommand=function(t,e){this.viewModel.registerExtendCommand(t,e)},e}(),Oe=ot("ControlStatePropMeta",(function(t){return t})),je=ot("UIStatePropMeta",(function(t){return t})),De=function(){function t(){}return t.getUIFields=function(t){return st.getPropsMetadatasByName(t,"UIStatePropMeta")},t.getControlFields=function(t){return st.getPropsMetadatasByName(t,"ControlStatePropMeta")},t}(),Ne=V("@farris/devkit CONTROL_STATE_INTERCEPTOR_TOKEN"),Re=function(){},Be=function(){},Ve=function(){},Ae=function(){function i(e){this.injector=e,this.controlInterceptors=[],this.controlInterceptors=this.injector.get(Ne,null,t.InjectFlags.Optional)}return i.prototype.init=function(){var t,i;if(this.result)return this.result;var r=[],o=new Re,a=this.getProcessContext();o.processContext=this.processContext=a;try{for(var s=g(this.controlInterceptors),p=s.next();!p.done;p=s.next()){var u=p.value;if(u.init&&"function"==typeof u.init){var c=u.init(o),l=e.isObservable(c)?c:e.of(c);r.push(l)}}}catch(e){t={error:e}}finally{try{p&&!p.done&&(i=s.return)&&i.call(s)}finally{if(t)throw t.error}}return this.result=e.forkJoin(r).pipe(n.shareReplay(1))},i.prototype.intercept=function(t){var e,n;t.processContext=this.processContext;try{for(var i=g(this.controlInterceptors),r=i.next();!r.done;r=i.next()){r.value.intercept(t)}}catch(t){e={error:t}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}},i.prototype.getProcessContext=function(){var t=new Ve,e=Wt.isInWf();if(t.isInWf=e,!1===e)return t;var n=window.parent.document.querySelector("iframe");if(!n||!n.src)return t;var i=Yt.getParams(n.src);return i?(t.uiStateInProcess=i.UIStateInProcess,t.formConfigId=i.formConfigId,t):t},i}(),_e=function(){function t(t){this.viewModelContext=t,this.controlStateInterceptorService=t.injector.get(Ae)}return t.prototype.init=function(){return this.controlStateInterceptorService.init()},t.prototype.updateControlState=function(t){var e=this;if(!this.controlFields){var n=this.viewModelContext.uiState;this.controlFields=De.getControlFields(n.constructor),this.variableNames=Object.keys(this.controlFields)}this.beforeUpdate(t)&&this.variableNames.forEach((function(n){var i=e.controlFields[n];Object.keys(i.originalValue).forEach((function(r){e.update(t,i,n,r)}))}))},t.prototype.beforeUpdate=function(t){if(!this.variableNames)return!1;var e=t.lintenerType,n=t.change;return"uiState"!==e||!this.variableNames.includes(n.field)},t.prototype.update=function(t,e,n,i){var r,o=e.originalValue[i];if(this.needUpdate(o,t)){var a=this.computeOriginalValue(o),s=new Be;s.controlState=e,s.value=a,s.type=i,s.viewModelContext=this.viewModelContext,this.controlStateInterceptorService&&this.controlStateInterceptorService.intercept(s);var p=this.viewModelContext.uiState;p[n]||(p[n]={}),p[n]=d({},p[n],((r={})[i]=s.value,r)),this.afterUpdate(i,s)}},t.prototype.needUpdate=function(t,e){var n=t.type,i=t.value,r=e.lintenerType,o=e.change;if("firstUpdate"===r)return!0;if("constant"===n)return!1;if(!i)return!1;if("expression"===n&&"expression"===r)return!0;switch(r){case"bindingData":if(o&&o.path&&o.path.length>0)return!!i.includes(o.path[0]);break;case"uiState":if(o&&o.field)return!!i.includes(o.field);break;case"stateMachine":return!!i.includes("stateMachine");case"form":return!!i.includes("form")}return!0},t.prototype.computeOriginalValue=function(t){var e=t.value,n=t.type;if(e&&"string"==typeof e&&"constant"!==n){var i={bindingData:this.viewModelContext.bindingData.list.currentItem.toJSON(),entityListData:this.viewModelContext.bindingData.getList().toJSON(),currentEntityData:this.viewModelContext.bindingData.getObject().toJSON(),uiState:this.viewModelContext.uiState,form:this.viewModelContext.viewModel.form,stateMachine:this.viewModelContext.stateMachine.renderStates};return this.eval(e,i)}return e},t.prototype.eval=function(t,e){t="return "+t;var n=Object.getOwnPropertyNames(e),i="__scope__"+(new Date).valueOf();return new Function(i,"\n          "+n.map((function(t){return"var "+t+" = "+i+"['"+t+"'];"})).join("\r\n")+"\n          return function () {\n            try{  \n"+t+"\n }catch(e){console.error(e);}\n          };")(e)()},t.prototype.afterUpdate=function(t,e){"required"===t&&this.updateRequired(e)},t.prototype.updateRequired=function(t){var e=t.controlState.controlInfo.bindingPath;if(e){var n=this.viewModelContext.form,i=n.getFormValueByBindPath(e),r=i.form_name;if(r&&0!==Object.keys(r).length){!0===t.value?(n.addValidate(i.bindingPath,i.name),r.pushValidatorFnforRequired([{type:"required",constraints:[!0],message:"必填"}],!0),r.required=!0):!1===t.value&&r.getValidatorFn()&&r.getValidatorFn().length>=1&&(r.required=!1,r.resetValidatorFnforRequired(),r.validationResult&&"required"===r.validationResult.type&&(r.validationResult={passing:!0,message:""}))}}},t}(),Fe=function(){function e(t){var e=this;this.subscriptionsMap=new Map,this.viewModelContext=t,this.controlStateUpdater=t.injector.get(_e),this.controlStateUpdater.init().subscribe((function(t){e.register();e.controlStateUpdater.updateControlState({lintenerType:"firstUpdate",change:null})}))}return e.prototype.register=function(){this.registerBindingDataLintener(),this.registerUIStateLintener(),this.registerStateMachineLintener(),this.registerFormLintener()},e.prototype.registerBindingDataLintener=function(){var e=this;if(!1===this.subscriptionsMap.has("bindingData")){var n=this.viewModelContext.bindingData.changes.subscribe((function(n){n.type!==t.ChangeType.Load&&e.controlStateUpdater.updateControlState({lintenerType:"bindingData",change:n})}));this.subscriptionsMap.set("bindingData",n)}},e.prototype.registerUIStateLintener=function(){var t=this;if(!1===this.subscriptionsMap.has("uiState")){var e=this.viewModelContext.uiState.changes.subscribe((function(e){t.controlStateUpdater.updateControlState({lintenerType:"uiState",change:e})}));this.subscriptionsMap.set("uiState",e)}},e.prototype.registerStateMachineLintener=function(){var t=this;if(!1===this.subscriptionsMap.has("stateMachine")&&this.viewModelContext.stateMachine){var e=this.viewModelContext.stateMachine.stateChange.subscribe((function(e){t.controlStateUpdater.updateControlState({lintenerType:"stateMachine",change:e})}));this.subscriptionsMap.set("stateMachine",e)}},e.prototype.registerFormLintener=function(){var t=this;if(!1===this.subscriptionsMap.has("form")){var e=this.viewModelContext.form.changes.subscribe((function(e){e&&"validateFieldsFinished"===e.type?t.controlStateUpdater.updateControlState({lintenerType:"expression",change:e}):t.controlStateUpdater.updateControlState({lintenerType:"form",change:e})}));this.subscriptionsMap.set("form",e)}},e}(),Le=function(){function t(){this.changes=new e.Subject,this.innerData=Object.assign({}),this._init()}return t.prototype._init=function(){var t=this.constructor,e=De.getUIFields(t),n=De.getControlFields(t);this.initializeUIField(e),this.initializeControlField(n)},t.prototype.config=function(t){var e=this.constructor,n=De.getControlFields(e);n&&Object.keys(n).length>0&&(this.controlStateListener=t.injector.get(Fe))},t.prototype.initializeUIField=function(t){var e=this;Object.keys(t).forEach((function(n){var i=t[n].stateName||n;delete e[n]&&e.defineProperty(n,i)}))},t.prototype.initializeControlField=function(t){var e=this;Object.keys(t).forEach((function(n){var i=t[n].stateName||n;delete e[n]&&e.defineProperty(n,i)}))},t.prototype.isExistProperty=function(t){return!(!this.innerData.hasOwnProperty(t)&&!this.hasOwnProperty(t))},t.prototype.defineProperty=function(t,e){void 0===e&&(e=null),Object.defineProperty(this,t,{get:function(){return null!==e?this.innerData[e]:this.innerData[t]},set:function(n){(null!==e?this.innerData[e]:this.innerData[t])!==n&&(null!==e?this.innerData[e]=n:this.innerData[t]=n,this.changes.next({field:t,value:n}))}})},t.prototype.setPropertyValue=function(t,e){""!==t&&void 0!==t&&(this.isExistProperty(t)||this.defineProperty(t),this[t]=e)},t}(),ke=function(t){this.name=t},He=ot("StatePropMeta",(function(t){return t})),Ke=ot("RenderStatePropMeta",(function(t){return t})),Ue=ot("ActionMethodMeta",(function(t){return t})),qe=function(){function t(t,e){this.stateMachine=t,this.state=e.name}return t.prototype.init=function(t){this.viewModelContext=t,this.parser=this.viewModelContext.injector.get(ji),this.stateMachineWatcher=this.stateMachine.stateMachineWatcher},t.prototype.transitTo=function(t){var e=this.stateMachine.states[t];e&&(this.state=e.name,this.stateMachine.render())},t.prototype.getUIState=function(t){if(t){var e=this.stateMachineWatcher.getViewModelContext(t);if(e){if(this.stateMachineWatcher.subscribeUIStateChange(e,t),this.parser){var n=this.parser.parse(t,e);return null===n?null:"object"==typeof n&&0===Object.keys(n).length?null:n}throw new Error("未初始化变量解析器。")}}},t.prototype.getData=function(t){if(t){var e=this.stateMachineWatcher.getViewModelContext(t);if(e){if(this.stateMachineWatcher.subscribeEntityChange(e,t),this.parser){var n=this.parser.parse(t,e);return null===n?null:"object"==typeof n&&0===Object.keys(n).length?null:n}throw new Error("未初始化变量解析器。")}}},t}(),Ge=function(){function t(t){this.stateMachine=t,this.uiStatePathList=[],this.dataStatePathList=[],this.viewModelContextAndUIStatePathsMap=new Map,this.viewModelContextAndDataStatePathsMap=new Map}return t.prototype.init=function(t){this.viewModelContext=t},t.prototype.getViewModelContext=function(t){var e=this.extractPaths(t).split("/")[1];return this.viewModelContext.appContext.viewModelContextManager.getContextById(e)},t.prototype.subscribeUIStateChange=function(t,e){var n=this,i=this.getStatePath(e);!1===this.viewModelContextAndUIStatePathsMap.has(t)&&(this.viewModelContextAndUIStatePathsMap.set(t,this.uiStatePathList),t.uiState.changes.subscribe((function(e){var i=n.viewModelContextAndUIStatePathsMap.get(t);e.field&&i.indexOf(e.field)>-1&&n.stateMachine.render()}))),-1===this.viewModelContextAndUIStatePathsMap.get(t).indexOf(i)&&this.uiStatePathList.push(i)},t.prototype.subscribeEntityChange=function(t,e){var n=this;!1===this.viewModelContextAndDataStatePathsMap.has(t)&&(this.viewModelContextAndDataStatePathsMap.set(t,this.dataStatePathList),t.bindingData.changes.subscribe((function(e){"Load"!==e.type&&"SelectionChanged"!==e.type||n.stateMachine.render();var i=n.viewModelContextAndDataStatePathsMap.get(t);e.path.join()&&n.isAccordingPath(i,e.path.join("/"))&&n.stateMachine.render()}))),-1===this.viewModelContextAndDataStatePathsMap.get(t).indexOf(e)&&this.dataStatePathList.push(e)},t.prototype.getStatePath=function(t){return this.extractPaths(t).split("/")[2]},t.prototype.isAccordingPath=function(t,e){return void 0!==t.find((function(t){return t.indexOf(e)>-1}))},t.prototype.extractPaths=function(t){var e,n=t.match(/\{UISTATE~(\S+?)\}/g),i=t.match(/\{DATA~(\S+?)\}/g);if(null!==n){var r=/\{UISTATE~(\S+?)\}/;n.forEach((function(t){var n=t.match(r);null!=n&&2===n.length&&(e=n[1])}))}if(null!==i){var o=/\{DATA~(\S+?)\}/;i.forEach((function(t){var n=t.match(o);null!=n&&2===n.length&&(e=n[1])}))}return e},t}(),ze=function(){function t(){this.renderStates={},this.handlePropMetadatas(),this.stateChange=new e.BehaviorSubject(!1),this.context=new qe(this,this.initialState),this.stateMachineWatcher=new Ge(this)}return t.prototype.init=function(t){this.viewModelContext=t,this.context.init(this.viewModelContext),this.stateMachineWatcher.init(this.viewModelContext),this.render()},t.prototype.handlePropMetadatas=function(){var t=this,e=st.getPropsMetadatas(this.constructor);if(e&&Object.keys(e).forEach((function(n){e[n].forEach((function(e){t.handlePropMetadata(n,e)}))})),!this.initialState)throw new Error("请在StatePropMeta注解中指定状态机的初始状态。")},t.prototype.handlePropMetadata=function(t,e){switch(e.ngMetadataName){case"StatePropMeta":this.buildState(t,e);break;case"RenderStatePropMeta":this.buildRenderState(t,e);break;case"ActionMethodMeta":this.buildAction(t,e)}},t.prototype.buildState=function(t,e){this.states=this.states||{},this[t]=new ke(t),this.states[t]=this[t],e.initialState&&(this.initialState=this[t])},t.prototype.buildRenderState=function(t,e){this.renderStates=this.renderStates||{},this[t]=!1,this.renderStates[t]=this[t],this.renders=this.renders||{},this.renders[t]=e.render},t.prototype.buildAction=function(t,e){var n=this;this[t]=function(){var t=e.transitTo,i=n.states[t];n.context.transitTo(i.name),n.render()}},t.prototype.render=function(){for(var t in this.renderStates)if(!1!==this.renderStates.hasOwnProperty(t)){var e=this.renders[t];e&&(this.renderStates[t]=e(this.context),this[t]=this.renderStates[t])}this.stateChange.next(this.context.state)},t}();(me=t.BindingType||(t.BindingType={})).EntityState="EntityState",me.UIState="UIState";var Je=function(){function t(){}return t.prototype.convertFrom=function(t){return St.formatISO(t)},t.prototype.convertTo=function(t){return St.parse(t)},t}(),We=function(){function t(){}return t.prototype.convertFrom=function(t){return t.join(",")},t.prototype.convertTo=function(t){return t.split(",")},t}(),Ye=function(){function t(t,e,n){this.bindingData=t,this.bindingPathSegments=this.getBindingPathSegments(e),this.valueConverter=n}return t.prototype.getValue=function(){var t=this.bindingData.getValue(this.bindingPathSegments);return this.valueConverter?this.valueConverter.convertTo(t):t},t.prototype.setValue=function(t){var e=this.bindingData.getValue(this.bindingPathSegments),n=this.valueConverter?this.valueConverter.convertFrom(t):t;!0===this.isDateConverter(this.valueConverter)&&!0===St.isEqual(e,n)||this.bindingData.setValue(this.bindingPathSegments,n,!0,!0)},t.prototype.getBindingPathSegments=function(t){var e=Dt.toBindingPathArray(this.bindingData.bindingPath);t=t.replace(/\./g,"/");var n=Dt.toBindingPathArray(t);return e.concat(n)},t.prototype.isDateConverter=function(t){var e=!1;return t&&!0===t.hasOwnProperty("format")&&(e=!0),e},t}(),$e=function(){function t(t,e,n){this.uiState=t,this.bindingPathSegments=this.getUiStateBindingPath(e)}return t.prototype.getValue=function(){var t,e=this.uiState;return this.bindingPathSegments.forEach((function(n){t=e[n],e=t})),t},t.prototype.setValue=function(t){var e,n=this.bindingPathSegments.length;if(1===n)this.uiState.setPropertyValue(this.bindingPathSegments,t);else{for(var i=void 0,r=n-1;r>0;r--)(e={})[this.bindingPathSegments[r]]=t,t=i=e;this.uiState.setPropertyValue(this.bindingPathSegments[0],i)}},t.prototype.getUiStateBindingPath=function(t){return-1!==t.search("/")?t.split("/"):[t]},t}(),Xe=function(){function e(){}return e.create=function(e,n,i,r){switch(e){case t.BindingType.EntityState:var o=r.bindingData;return new Ye(o,n,i);case t.BindingType.UIState:var a=r.uiState;return new $e(a,n,i);default:throw new Error("Not Supported")}},e}(),Ze=ot("FormControlPropMeta",(function(t){return t})),Qe=function(){function t(){}return t.create=function(t){var e=this,n=[];return Array.isArray(t)&&t.length>1?t.forEach((function(t){n.push(e.initValidRuleFn(t))})):Array.isArray(t)&&1===t.length?n.push(this.initValidRuleFn(t[0])):n.push(this.initValidRuleFn(t)),n},t.initValidRuleFn=function(t){var i=t.type,r=t.constraints,o=t.message;switch(i){case"required":return function(t,e){if(!0!==r[0]&&!0===e.injector.get(ji).parse(r[0],e))return null==t||""===t?{type:i,passing:!1,message:o||"必填"}:{type:i,passing:!0,message:""};return!0===r[0]&&(null==t||""===t)?{type:i,passing:!1,message:o||"必填"}:{type:i,passing:!0,message:""}};case"NumberMaxValue":case"numberMaxValue":return function(t){return"number"!=typeof t?{passing:!0,message:""}:r[0]||0==r[0]?t<=parseFloat(r[0])?{passing:!0,message:""}:{passing:!1,message:o||"输入值不能大于"+r[0]}:{passing:!0,message:""}};case"NumberMinValue":case"numberMinValue":return function(t){return"number"!=typeof t?{passing:!0,message:""}:r[0]||0==r[0]?t>=parseFloat(r[0])?{passing:!0,message:""}:{passing:!1,message:o||"输入值不能小于"+r[0]}:{passing:!0,message:""}};case"DateMaxValue":case"dateMaxValue":return function(t){if(null==t||""===t)return{passing:!0,message:""};if(r[0]){var e=r[0];return 21==e.length&&(e=e.slice(1,20)),St.isBefore(t,e)||St.isSame(t,e)?{passing:!0,message:""}:{passing:!1,message:o||"输入日期不能大于"+e}}return{passing:!0,message:""}};case"DateMinValue":case"dateMinValue":return function(t){if(null==t||""===t)return{passing:!0,message:""};if(r[0]){var e=r[0];return 21==e.length&&(e=e.slice(1,20)),St.isAfter(t,e)||St.isSame(t,e)?{passing:!0,message:""}:{passing:!1,message:o||"输入日期不能小于"+e}}return{passing:!0,message:""}};case"StringMaxLength":case"stringMaxLength":return function(t){return null==t||""===t?{passing:!0,message:""}:r[0]?t.length<=r[0]?{passing:!0,message:""}:{passing:!1,message:o||"输入值长度不能大于"+r[0]}:{passing:!0,message:""}};case"StringMinLength":case"stringMinLength":return function(t){return null==t||""===t?{passing:!0,message:""}:r[0]?t.length>=r[0]?{passing:!0,message:""}:{passing:!1,message:o||"输入值长度不能小于"+r[0]}:{passing:!0,message:""}};case"regex":return function(t){if(null==t||""===t)return{passing:!0,message:""};var e=[];"string"==typeof r[0]&&(e=r[0].split(","));for(var n=0;n<e.length;n++){if(""===e[n])return;if(new RegExp(e[n]).test(t))return{passing:!1,message:o||"存在不可输入项"+e[n]}}return{passing:!0,message:""}};case"regexp":return function(t){return null==t||""===t?{passing:!0,message:""}:new RegExp(r[0]).test(t)?{passing:!0,message:""}:{passing:!1,message:o||"请输入正确格式"}};case"mobile":return function(t){if(null==t||""===t)return{passing:!1,message:o||"请输入正确的手机号格式"};var e=!0===r[0]?/^1[0-9]{10}$/:r[0];return new RegExp(e).test(t)?{passing:!0,message:""}:{passing:!1,message:o||"请输入正确的手机号格式"}};case"email":return function(t){if(null==t||""===t)return{passing:!1,message:o||"请输入正确的邮箱格式"};var e=!0===r[0]?/^[A-Za-z0-9\u4e00-\u9fa5]+@[a-zA-Z0-9_-]+(\.[a-zA-Z0-9_-]+)+$/:r[0];return new RegExp(e).test(t)?{passing:!0,message:""}:{passing:!1,message:o||"请输入正确的邮箱格式"}};case"idCard":return function(t){if(null==t||""===t)return{passing:!1,message:o||"请输入正确的身份证格式"};var e=!0===r[0]?/^[1-9]\d{5}(18|19|([23]\d))\d{2}((0[1-9])|(10|11|12))(([0-2][1-9])|10|20|30|31)\d{3}[0-9Xx]$/:r[0];return new RegExp(e).test(t)?{passing:!0,message:""}:{passing:!1,message:o||"请输入正确的身份证格式"}};case"customFunction":return function(t,e){if("function"==typeof r[0]){var n=r[0](t,e);return n?{passing:!1,message:n}:{passing:!0,message:""}}return{passing:!0,message:""}};case"expression":return function(t,e,n){return void 0===n&&(n={}),!1===e.expressionManager.validate(r[0],n)?{passing:!1,message:o}:{passing:!0,message:""}};case"requiredExpression":return function(t,e,n){return void 0===n&&(n={}),!0===e.expressionManager.validate(r[0],n)?null==t||""===t?{type:i,passing:!1,message:o||"必填"}:{type:i,passing:!0,message:""}:{passing:!0,message:""}};case"asyncCustomFunction":return function(t,i){return"function"==typeof r[0]?e.from(r[0](t,i)).pipe(n.switchMap((function(t){return t?e.of({passing:!1,message:t}):e.of({passing:!0,message:""})}))):{passing:!0,message:""}};default:return function(){return{passing:!0,message:""}}}},t.executeValidator=function(t,n,i,r){for(var o=e.of({passing:!0,message:""}),a=0;a<t.length;a++){var s=t[a](n,i,r);if(Jt(s)){o=s;break}if(!1===s.passing)return e.of(s)}return o},t.noSupportAsynExecuteValidator=function(t,e,n,i){for(var r=0;r<t.length;r++){var o=t[r](e,n,i);if(Jt(o))break;if(!1===o.passing)return o}return{passing:!0,message:""}},t}(),tn=function(){function t(t,e){this.validatorFn=[],this.required=!1,this.requiredExpressionFlag=!1,this.validateExpressionFlag=!1,this.readonly=!1,this.visible=!0,this.validRules=[],this.validRules_validates=[],this.valueAccessor=Xe.create(t.bindingType,t.bindingPath,t.valueConverter,e),this.validRules=[],t.validRules&&(this.validRules=t.validRules,this.setValidatorFn(t.validRules))}return Object.defineProperty(t.prototype,"value",{get:function(){return this.valueAccessor.getValue()},set:function(t){this.valueAccessor.setValue(t)},enumerable:!0,configurable:!0}),t.prototype.getValidRules=function(){return this.validRules},t.prototype.setValidatorFn=function(t){this.validatorFn=Qe.create(t)},t.prototype.pushValidatorFnforValidate=function(t,e){e&&this.validateExpressionFlag||(this.validateExpressionFlag=e,this.validRules_validates=t,this.validatorFn=this.validatorFn.concat(Qe.create(t)))},t.prototype.pushValidatorFnforRequired=function(t,e){e&&this.requiredExpressionFlag||(this.requiredExpressionFlag=e,this.validatorFn=this.validatorFn.concat(Qe.create(t)))},t.prototype.resetValidatorFnforRequired=function(){this.requiredExpressionFlag=!1,this.validatorFn=Qe.create(this.validRules.concat(this.validRules_validates))},t.prototype.getValidatorFn=function(){return this.validatorFn},t}(),en=function(){function t(t){this.viewModelContext=t,this.formControlConfigs=[],this.validateformControls=[],this.validateformControlPathMap=new Map,this.changes=new e.Subject}return t.prototype.init=function(){this.collectMetadatas(),this.createFormControls()},t.prototype.getFormValueByBindPath=function(t){var e=this,n={form_name:{},name:"",bindingPath:""};return t=t.replace(/\//g,"."),0===this.formControlConfigs.length?n:(this.formControlConfigs.forEach((function(i){i.bindingPath===t&&(n.form_name=e[i.name],n.name=i.name,n.bindingPath=i.bindingPath)})),n)},t.prototype.getValidateformControls=function(){return this.validateformControls},t.prototype.setValidateformControls=function(t){(this.validateformControls&&0===this.validateformControls.length&&this.validateformControls.push(t),this.validateformControls&&this.validateformControls.length>=1)&&(-1===this.validateformControls.findIndex((function(e){return e==t}))&&this.validateformControls.push(t));Array.isArray(this.validateformControls)||(this.validateformControls=[t])},t.prototype.getValidateformControlPathMap=function(){return this.validateformControlPathMap},t.prototype.setValidateformControlPathMap=function(t,e){this.validateformControlPathMap.has(t)||this.validateformControlPathMap.set(t,e)},t.prototype.addValidate=function(t,e){var n=this.viewModelContext.bindingData.bindingPath.slice(1).replace(/\//g,".");n&&(n+="."),this.setValidateformControlPathMap(n+t,e),this.setValidateformControls(e)},t.prototype.validateFields=function(){var t=this,e=[];return 0===this.validateformControls.length?e:(this.validateformControls.forEach((function(i){var r=Qe.executeValidator(t[i].validatorFn,t[i].value,t.viewModelContext).pipe(n.tap((function(e){t[i].validationResult=e,!e.passing&&t.changes.next({type:"validateFieldsFinished"})})));e.push(r)})),e)},t.prototype.noSupportAsynValidateFields=function(){var t=this,e=[];return 0===this.validateformControls.length?e:(this.validateformControls.forEach((function(n){t[n].validationResult||(t[n].validationResult=Qe.noSupportAsynExecuteValidator(t[n].validatorFn,t[n].value,t.viewModelContext)),!t[n].validationResult.passing&&e.push(t[n])})),this.changes.next({type:"validateFieldsFinished"}),e)},t.prototype.getFieldError=function(t){var e=this;return 0===this.validateformControls.length?{}:-1===this.validateformControls.findIndex((function(e){return e===t}))?{}:Qe.executeValidator(this[t].validatorFn,this[t].value,this.viewModelContext).pipe(n.tap((function(n){e[t].validationResult=n,!n.passing&&e.changes.next({type:"validateFieldsFinished"})})))},t.prototype.getFieldErrorByPath=function(t){var e=this;if(0===this.validateformControls.length)return{};var n=t[0];return t&&t.length>=2&&(n=t.join(".")),this.validateformControlPathMap.has(n)?(Qe.executeValidator(this[this.validateformControlPathMap.get(n)].validatorFn,this[this.validateformControlPathMap.get(n)].value,this.viewModelContext).subscribe((function(t){e[e.validateformControlPathMap.get(n)].validationResult=t,e.changes.next({type:"validateFieldsFinished",value:e.validateformControlPathMap.get(n)})})),this[this.validateformControlPathMap.get(n)].validationResult):{}},t.prototype.resetFieldsValidate=function(t){var e=this;if(0===this.validateformControls.length)return!0;if(t&&t.length>0){var n=new Set(t);this.validateformControls.filter((function(t){return n.has(t)})).forEach((function(t){e[t].validationResult=void 0}))}else this.validateformControls.forEach((function(t){e[t].validationResult=void 0}));this.changes.next({type:"validateFieldsFinished"})},t.prototype.createFormControls=function(){var t=this;this.formControlConfigs.forEach((function(e){var n=e.name,i=new tn(e,t.viewModelContext);t[n]=i}))},t.prototype.collectMetadatas=function(){var t=this,e=st.getPropsMetadatasByName(this.constructor,"FormControlPropMeta"),n=this.viewModelContext.bindingData.bindingPath.slice(1).replace(/\//g,"."),i=this.viewModelContext.appContext.validationManager;n&&(n+="."),Object.keys(e).forEach((function(r){var o=e[r],a=null;o.validRules&&(t.validateformControls.push(r),t.validateformControlPathMap.set(n+o.bindingPath,r),a=o.validRules);var s=("/"+n+o.bindingPath).replace(/\./g,"/");i[s]&&(a?a=a.concat(Object.values(i[s])):(t.validateformControls.push(r),t.validateformControlPathMap.set(n+o.bindingPath,r),a=Object.values(i[s])));var p={name:r,bindingType:o.bindingType,bindingPath:o.bindingPath,valueConverter:o.valueConverter,valueChanging:o.valueChanging,valueChanged:o.valueChanged,validRules:a};t.formControlConfigs.push(p)}))},t.prototype.getEntityValueChangingListeners=function(){var t={};return this.formControlConfigs.forEach((function(e){e.valueChanging&&(t[e.bindingPath]=e.valueChanging)})),t},t.prototype.getEntityValueChangedListeners=function(){var t={};return this.formControlConfigs.forEach((function(e){e.valueChanged&&(t[e.bindingPath]=e.valueChanged)})),t},t}(),nn=ot("CommandMethodMeta",(function(t){return t})),rn=new B("@farris_resolver_token"),on=["SumByProp","CountByProp","AvgByProp","MaxByProp","MinByProp","IsExistRecord","ListContains","ListGreaterThan","ListLessThan","ListStartWith","ListEndWith"],an=function(t){this.viewModelContext=t,this.resolvers=this.viewModelContext.injector.get(rn,[])},sn=function(){function t(t){this.viewModelContext=t,this.repository=this.viewModelContext.repository,this.entityTypeInfo=this.repository.entityTypeInfo}return t.prototype.resolve=function(t){var e=hn.getGroupFunctionDependency(t,this.repository.entityTypeInfo),n=this.getEntityDependency(t);e&&e.length>0&&n&&n.length>0&&e.forEach((function(t){var e=n.findIndex((function(e){return t.startsWith(e)}));-1!==e&&n.splice(e,1)}));var i=m(e,n);return m(new Set(i))},t.prototype.getValidEntityPropertyExpression=function(t){var e=t.split("."),n=null;try{n=this.entityTypeInfo.getPropInfoByPath(e)}catch(t){}return n?t.split("."):e.length>1?(e.pop(),this.getValidEntityPropertyExpression(e.join("."))):null},t.prototype.getEntityDependency=function(t){var e=this,n=[];if(this.entityTypeInfo){var i=new RegExp("[\\'\\\"]?\\s*("+this.entityTypeInfo.entityInfo.nodeCode+"|"+this.entityTypeInfo.entityInfo.originalCode+")[\\.\\[\\]a-zA-Z0-9_]+\\s*[\\'\\\"]?","g"),r=t.match(i);Array.isArray(r)&&r.length>0&&r.forEach((function(t){if(-1!==t.indexOf(".")){t=t.trim().replace(/\"/g,""),t=(t=hn.convertToNodeCode(t,e.repository.entityTypeInfo).join(".")).substr(t.indexOf(".")+1);var i=e.getValidEntityPropertyExpression(t);i&&Array.isArray(i)&&i.length>0&&(i.splice(0,0,"ENTITY~"),n.push(i.join("/")))}else console.warn("无效的实体表达式:"+t)}))}else console.warn("获取实体类型信息失败，请重新编译改表单。");return n},t}(),pn=["GetContextParameter","GetSessionValue"],un=function(){function t(t){this.viewModelContext=t}return t.prototype.resolve=function(t){var e=[],n=new RegExp("DefaultFunction\\.("+pn.join("|")+")\\s*\\([^\\r\\n\\)]*\\)","g"),i=t.match(n);if(i&&i.length>0){var r=/\(([^\r\n\)]*)\)/;i.forEach((function(t){var n=t.match(r);if(2===n.length){var i=n[1].trim().replace(/\"/g,""),o=["STATE~"];o.push(i),e.push(o.join("/"))}}))}return e},t}(),cn=function(){function t(){}return t.prototype.resolve=function(t){var e=[];if(!t||t.length<1)return e;var n=t.match(/\/\*\*\s*__define__\((.*)\)\s*\*\//);if(n&&2===n.length){var i=n[1].trim(),r=null;try{r=JSON.parse(i)}catch(t){console.warn("自定义依赖解析失败："+i)}r&&r.hasOwnProperty("deps")&&Array.isArray(r.deps)&&e.push.apply(e,m(r.deps))}return e},t}(),ln=function(){function t(t){this.viewModelContext=t,this.resolverRegistry=this.viewModelContext.injector.get(an)}return t.prototype.resolve=function(t){var e=[];if(this.resolverRegistry&&this.resolverRegistry.resolvers&&!(this.resolverRegistry.resolvers.length<1)){var n=this.resolverRegistry.resolvers.find((function(t){return t instanceof cn}));if(n){var i=n.resolve(t);i&&Array.isArray(i)&&i.length>0&&e.push.apply(e,m(i))}if(!(e&&e.length>0))return this.resolverRegistry.resolvers.forEach((function(n){if(!(n instanceof cn)){var i=n.resolve(t);i&&i.length>0&&e.push.apply(e,m(i))}})),m(new Set(e))}},t}(),hn=function(){function e(){}return e.getGroupFunctionDependency=function(t,e){var n=this,i=[],r=new RegExp("DefaultFunction\\.("+on.join("|")+")\\s*\\([^\\r\\n\\)]*\\)","g"),o=t.match(r);if(o&&o.length>0){var a=/\(([^\r\n\)]*)\)/;o.forEach((function(t){var r=t.match(a);if(2===r.length){var o=r[1],s=o.split(",").map((function(t){return t.replace(/\"/g,"")}));if(!s||2!==s.length)throw new Error("无法解析参数： "+JSON.stringify(o));var p=s.join("."),u=(p=(p=n.convertToNodeCode(p,e).join(".")).substr(p.indexOf(".")+1)).split(".");u.splice(0,0,"ENTITY~"),i.push(u.join("/"))}}))}return i},e.convertToNodeCode=function(t,e){var n=[];if(e&&t.includes("."))for(var i=t.split(".")||[],r=e,o=0;o<i.length;o++){var a=i[o];if(r&&r.entityInfo&&r.entityInfo.nodeCode===a||r.entityInfo.originalCode===a){0===o?n.push(r.entityInfo.originalCode):n.push(r.entityInfo.nodeCode);var s=i[o+1];if(!s)break;var p=r.getPropInfoByName(s);if(!p)break;p.typeInfo&&(r=p.typeInfo)}else{if(!r||!r.getPropInfoByName(a))break;var u=r.getPropInfoByName(a);n.push(u.name)}}return n},e.getChildrenEntityPaths=function(e,n,i){var r=this;void 0===i&&(i=[]);var o=e.getPropInfosByGroup(t.DataPropGroup.List);o&&o.length>0?o.forEach((function(e){0===i.length&&n.push([e.name]);var o=e.typeInfo.getPropInfosByGroup(t.DataPropGroup.List);o&&o.length>0?(i.push(e.name),o.forEach((function(t){r.getChildrenEntityPaths(t.typeInfo,n,i)}))):(0!==i.length&&(i.push(e.name),n.push(m(i))),i.length=0)})):(i.length>0&&(i.push(e.entityInfo.nodeCode),n.push(m(i))),i.length=0)},e.getCurrentRowByPaths=function(t,e){var n=null,i=e.getValue(t);if(i&&i.length>0){var r=i.currentItem.primaryKeyValue||null;if(r){var o=i.findById(r);o&&(n=o.toJSON())}}return n},e.getAvailableChildrenPathsFromEntityPaths=function(t,e){var n=[];for(t=m(t);t.length>0;){if("List"===e.getPropInfoByPath(t).group){n=t;break}t.pop()}return n},e.getBindingPath=function(t,e){return t=this.getEntityPath(t),this.getAvailableChildrenPathsFromEntityPaths(t,e)},e.getEntityPath=function(t){return t.filter((function(t,e){return e%2!=0||!t.includes(":")}))},e}(),fn=function(){function t(){}return t.warn=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];this.logable()&&console&&console.warn.apply(console,m([t],e))},t.error=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];this.logable()&&console&&console.error.apply(console,m([t],e))},t.log=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];this.logable()&&console&&console.log.apply(console,m([t],e))},t.logable=function(){return window&&window.localStorage&&"true"===window.localStorage.getItem("__DEVKIT_LOGABLE__")||!1},t}(),dn=new B("@farris/devkit form path token"),yn=new B("@farris/devkit_back_end_message_handler"),gn=new B("@farris/message_service_token"),vn=new B("@farris/notify_service_token"),mn=new B("@farris/devkit NAMESPACE");!function(t){!function(t){t.Error="Error",t.Info="Info",t.Warning="Warning"}(t.Level||(t.Level={}));var e=function(t,e){this.bizMessages=t,this.context=e};t.Message=e}(t.BackEndMessage||(t.BackEndMessage={}));var En,Cn,bn,xn,Pn,Mn,In=new B("@farris/effector_token"),wn=function(){function t(t){this.viewModelContext=t,this.ns=this.viewModelContext.injector.get(mn,""),this.repository=this.viewModelContext.repository,this.bindingData=this.viewModelContext.bindingData}return t.prototype.effect=function(t,e,n){if(!n||!n.path)throw new Error("repository effector 需要指定行信息。");var i=n.path,r=i[0]||this.bindingData.list.currentItem.primaryKeyValue,o=this.repository.entityCollection.getEntityById(r);if(!r||o){for(var a=i.pop(),s=o,p=1;p<i.length;p++){var u=i[p];s=s instanceof pe?s.get(u):s[u]}s?s[a]!==e&&(s[a]=e):console.error("找不到实体对应的路径："+i.push(a))}else console.error("找不到id："+r+"对应的实体！")},t}(),Tn=function(){function t(t){this.viewModelContext=t,this.ns=this.viewModelContext.injector.get(mn,""),this.uiState=this.viewModelContext.uiState}return t.prototype.effect=function(t,e,n){this.uiState.setPropertyValue(t,e)},t}(),Sn=function(t){this.viewModelContext=t,this.effectors=this.viewModelContext.injector.get(In)};Mn=t.Expression||(t.Expression={}),(Pn=Mn.ExpressionBindingType||(Mn.ExpressionBindingType={})).State="State",Pn.Field="Field",(xn=Mn.ExpressionType||(Mn.ExpressionType={})).Required="require",xn.Readonly="readonly",xn.Compute="compute",xn.Dependency="dependency",xn.Visible="visible",xn.Relative="relative",xn.Validate="validate",xn.DataPicking="dataPicking",function(t){t.ValueChanged="VALUE_CHANGED",t.SelectionChanged="SELECTION_CHANGED",t.Load="Load",t.Append="Append",t.Remove="Remove",t.Update="Update"}(Mn.EventType||(Mn.EventType={})),(bn=Mn.EventSource||(Mn.EventSource={})).Field="Field",bn.State="State",bn.BindingData="BindingData",bn.Repository="Repository",(Cn=Mn.MessageType||(Mn.MessageType={})).error="error",Cn.info="info",Cn.warning="warning",(En=Mn.EffectPath||(Mn.EffectPath={}))[En.currentRow=0]="currentRow",Mn.MESSAGE={"zh-CHS":{require:"请输入'$property'",validate:"'$property'校验不通过"},en:{require:"Please input '$property'",validate:"'$property' calibration failed"},"zh-CHT":{require:"請輸入'$property'",validate:"'$property'校驗不通過"}},Mn.DEPENDENCY_SPLITER="/";var On=new B("@Farris listener"),jn=function(){function n(){this.subject=new e.Subject}return Object.defineProperty(n.prototype,"onEvent",{get:function(){return this.subject},enumerable:!0,configurable:!0}),n.prototype.findEntityPaths=function(e,n,i){var r=this;void 0===i&&(i=[]);var o=e.getPropInfosByGroup(t.DataPropGroup.List);o&&o.length>0?o.forEach((function(e){i.push(e.name);var o=e.typeInfo.getPropInfosByGroup(t.DataPropGroup.List);o&&o.length>0?o.forEach((function(t){r.findEntityPaths(t.typeInfo,n,i)})):n.push(i)})):i&&i.length>0&&n.push(i)},n}(),Dn=function(e){function n(t){var n=e.call(this)||this;return n.viewModelContext=t,n.frameId=n.viewModelContext.id,n.uiState=n.viewModelContext.uiState,n.namespace=n.viewModelContext.injector.get(mn,null),n.registerEvent(),n}return f(n,e),n.prototype.buildEventPath=function(t){return null},n.prototype.registerEvent=function(){var e=this;this.uiState&&this.uiState.changes&&this.uiState.changes.subscribe((function(n){var i={ns:e.namespace,path:[n.field],type:t.Expression.EventType.ValueChanged,value:n.value,source:t.Expression.EventSource.State,frameId:e.frameId};e.subject.next(i)}))},n}(jn),Nn=(t.Expression.EventType,function(e){function n(t){var n=e.call(this)||this;return n.viewModelContext=t,n.namespace=n.viewModelContext.injector.get(mn,null),n.repository=n.viewModelContext.repository,n.bindingData=n.viewModelContext.bindingData,n.registerEvent(),n}return f(n,e),n.prototype.registerEvent=function(){var e=this;this.repository&&this.repository.changes&&this.repository.changes.subscribe((function(n){var i=e.convertEventType(n);if(i){var r=e.buildEventPath(n),o={ns:e.namespace,type:i,path:r,value:n.value,source:t.Expression.EventSource.Field};e.subject.next(o)}})),this.repository&&this.repository.entityCollectionChange&&this.repository.entityCollectionChange.subscribe((function(n){var i=e.convertEventType(n);if(i){var r=e.buildEventPath(n),o={ns:e.namespace,type:i,path:r,value:n.value,source:t.Expression.EventSource.Repository};e.subject.next(o)}}))},n.prototype.buildEventPath=function(t){var e=this,n=t.path,i=[];return!n||n.length<1?i:i=n.filter((function(t,n){if(n%2==0&&t.includes(":")){if(":"===t)return!1;if(t.split(":")[0]!==e.repository.primaryKey)return!1}return!0}))},n.prototype.convertEventType=function(e){var n=null;return e.type===t.ModifyType.Add||e.type===t.ModifyType.AddData||e.type===t.ModifyType.Insert||e.type===t.ModifyType.Remove||e.type===t.ModifyType.RemoveData||e.type===t.ModifyType.Load||e.type===t.ModifyType.ValueChange||e.type===t.ModifyType.Update&&(n=t.Expression.EventType.Update),n},n}(jn)),Rn=function(t){this.viewModelContext=t,this.listeners=this.viewModelContext.injector.get(On)},Bn=t.Expression.EventType,Vn=function(e){function n(t){var n=e.call(this)||this;return n.viewModelContext=t,n.repository=null,n.namespace=n.viewModelContext.injector.get(mn,""),n.repository=n.viewModelContext.repository,n.bindingData=n.viewModelContext.bindingData,n.registerEvent(),n}return f(n,e),n.prototype.registerEvent=function(){var e=this;this.bindingData&&this.bindingData.changes&&"function"==typeof this.bindingData.changes.subscribe&&this.bindingData.changes.subscribe((function(n){if(n.type===t.ChangeType.Append||n.type===t.ChangeType.ValueChanged||n.type===t.ChangeType.Remove||n.type===t.ChangeType.Load||n.type===t.ChangeType.SelectionChanged){var i=null;n.type===t.ChangeType.Append?i=Bn.Append:n.type===t.ChangeType.ValueChanged?i=Bn.ValueChanged:n.type===t.ChangeType.Remove?i=Bn.Remove:n.type===t.ChangeType.Load?i=!0===n.create?Bn.Append:Bn.Load:n.type===t.ChangeType.SelectionChanged&&(i=Bn.SelectionChanged);var r=e.buildEventPath(n),o={ns:e.namespace,path:r,type:i,source:t.Expression.EventSource.BindingData,value:n.value,id:n.id};e.subject.next(o)}}))},n.prototype.buildEventPath=function(e){var n=e.path,i=[],r=this.bindingData.list.currentItem.primaryKeyValue;r&&(e.type===t.ChangeType.Load&&0===e.path.length||i.push(this.bindingData.list.primaryKey+":"+r));for(var o=[],a=0;a<n.length;a++){var s=n[a];o.push(s);var p=this.bindingData.getValue(o);if(i.push(s),p instanceof kt&&o.length<n.length){var u=p.currentItem.primaryKeyValue;a===n.length-2&&e.id&&(u=e.id),i.push(this.bindingData.list.primaryKey+":"+u)}}return i},n}(jn),An=function(){function t(t){this.viewModelContext=t,this.subject=new e.Subject,this.registry=this.viewModelContext.injector.get(Rn,null),this.regist()}return Object.defineProperty(t.prototype,"onEvent",{get:function(){return this.subject},enumerable:!0,configurable:!0}),t.prototype.regist=function(){var t=this,e=this.registry&&this.registry.listeners||[];e&&e.length>0&&e.forEach((function(e){e.onEvent.subscribe((function(e){t.subject.next(e)}))}))},t}(),_n=function(){function t(t){var e=this;this.viewModelContext=t,this.listeners=this.viewModelContext.injector.get(An),this.events=new Array,this.listeners.onEvent.subscribe((function(t){if(e.onEvent&&e.onEvent.observers.length>0){var n=[];e.events.length>0&&(n=m(e.events)),n.push(t),e.onEvent.next(n),e.events=[]}else e.events.push(t)}))}return t.prototype.attach=function(){return this.onEvent||(this.onEvent=new e.BehaviorSubject(this.events)),this.onEvent.asObservable()},t}(),Fn=V("@farris/devkit TranslateToken"),Ln=new B("@farris/form_manifest_service"),kn=new B("@farris/form_expression_manifest_service"),Hn=function(){function i(t){this.viewModelContext=t,this._expressions=null,this.injector=this.viewModelContext.injector,this.formExpressionManifestService=this.injector.get(kn,null),this.translate=this.injector.get(Fn,null)}return i.prototype.load=function(){var t=this;return this.formExpressionManifestService.load().pipe(n.switchMap((function(n){var i=t.setExpressions(n);return t.cleanSpecialCharacters(),e.of(i)})),n.catchError((function(t){return e.of([])})))},i.prototype.setExpressions=function(e){var n=this,i=[],r=Array.from(e),o=this.viewModelContext.injector.get(Te);return r.forEach((function(e){e.expressions.forEach((function(r){var a,s,p={id:r.id,ns:e.ns,viewModelId:e.viewModelId,path:e.path,bindingType:e.type,type:r.type,expression:r.value||r.expr||"",message:r.message||null,messageType:r.messageType||null,deps:[]};if(r.type===t.Expression.ExpressionType.Required){var u={type:"requiredExpression",constraints:[r.id],message:r.message};o.validationManager[e.path]=d({},o.validationManager[e.path]||{},((a={})[r.id]=u,a))}if(r.type===t.Expression.ExpressionType.Validate){u={type:"expression",constraints:[r.id],message:r.message};o.validationManager[e.path]=d({},o.validationManager[e.path]||{},((s={})[r.id]=u,s))}r.type!==t.Expression.ExpressionType.Required&&r.type!==t.Expression.ExpressionType.Validate||(r.message||(p.message=n.getExpressionMessage(r.type)),r.messageType||(p.messageType="error")),p.message&&n.transform(p),i.push(p)}))})),this._expressions=i,i},Object.defineProperty(i.prototype,"expressions",{get:function(){return this._expressions?e.of(this._expressions):window.__expressions__?(this.setExpressions(window.__expressions__),e.of(this._expressions)):this.load()},enumerable:!0,configurable:!0}),i.prototype.getExpressionById=function(t){return!this._expressions||this._expressions.length<1?null:this._expressions.find((function(e){return e.id===t}))},i.prototype.getExpressionMessage=function(e,n){if(e!==t.Expression.ExpressionType.Validate&&e!==t.Expression.ExpressionType.Required)return null;if(!this.translate)return n;var i=this.translate.getCurrentLanguage()||"zh-CHS";return t.Expression.MESSAGE[i][e]},i.prototype.transform=function(t){this.translate&&t.message&&t.message.startsWith("{{")&&t.message.endsWith("}}")&&(t.message=this.translate.transform(t.message.substr(2,t.message.length-4),null)||this.getExpressionMessage(t.type))},i.prototype.cleanSpecialCharacters=function(){var t=this;if(this._expressions&&!(this._expressions.length<1)&&Array.isArray(this._expressions)){var e=this.viewModelContext.repository;if(e){var n=e.entityTypeInfo,i=new RegExp("[\\'\\\"]?\\s*("+n.entityInfo.nodeCode+"|"+n.entityInfo.originalCode+")[\\.\\[\\]a-zA-Z0-9_]+\\s*[\\'\\\"]?","g");this._expressions.forEach((function(e){var n=e.expression.match(i);Array.isArray(n)&&n.length>0&&n.forEach((function(n){if(-1!==n.indexOf(".")){if(/\[\d\]/g.test(n)){var i=n.replace(/\[\d\]/g,"");e.expression=t.replaceAll(e.expression,n,i)}if(/\*/g.test(n)){i=n.replace(/\*/g,"");e.expression=t.replaceAll(e.expression,n,i)}}else console.warn("无效的实体表达式:"+n)}))}))}}},i.prototype.replaceAll=function(t,e,n){return t.split(e).join(n)},i}(),Kn=function(){function t(){}return t.prototype.compile=function(t,e){if("[object Object]"!==Object.prototype.toString.call(e))throw new Error("上下文必须为对象！");var n=this.buildContext(e);if(!t.factory){var i=new l.Expression(t.expression,n);t.factory=i.compile()}return t.factory.eval(n)},t.prototype.eval=function(t,e){if("[object Object]"!==Object.prototype.toString.call(e))throw new Error("上下文必须为对象！");var n=this.buildContext(e);return new l.ExpressionEngine(n).eval(t)},t.prototype.buildContext=function(t){var e=new l.ExpressionContext;return t&&Object.keys(t).length>0&&Object.keys(t).forEach((function(n){e.set(n,t[n])})),e},t}(),Un=function(){function e(t){this.frameContext=t,this.injector=t.injector,this.repository=t.repository,this.bindingData=t.bindingData,this.expressionRegistry=this.injector.get(Hn,null),this.effectorFactory=this.injector.get(yi,null),this.expressionExecutor=this.injector.get(Kn),this.expressionResult=this.injector.get(ai,null)}return e.prototype.handleEvent=function(t,e){t=Object.assign({},t),this.expressionObjects=e,this.dispatch(t)},Object.defineProperty(e.prototype,"primaryValue",{get:function(){return this.bindingData.list.currentItem.primaryKeyValue},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"entityOriginalNodeCode",{get:function(){return this.repository&&this.repository.entityTypeInfo&&this.repository.entityTypeInfo.entityInfo&&this.repository.entityTypeInfo.entityInfo.originalCode||null},enumerable:!0,configurable:!0}),e.prototype.perform=function(t,e){return this.expressionExecutor.compile(t,e)},e.prototype.effect=function(e,n){var i=n.bindingType,r=this.effectorFactory.getEffector(n);if(r){if(i!==t.Expression.ExpressionBindingType.Field)throw new Error("not supported！");var o=n.effectPaths||[];if(o.length>0)o.forEach((function(t){var i={path:t.split("/"),message:n.message,expressionId:n.id,eventType:e.type,viewModelId:n.viewModelId};r.effect(n.path,n.result,i)}));else if(n.type===t.Expression.ExpressionType.Required||n.type===t.Expression.ExpressionType.Validate||n.type===t.Expression.ExpressionType.Readonly||n.type===t.Expression.ExpressionType.Visible){var a={message:n.message,expressionId:n.id,eventType:e.type,viewModelId:n.viewModelId};r.effect(n.path,n.result,a)}}},e.prototype.isValidateOrRequiredExpression=function(e){return e&&(e.type===t.Expression.ExpressionType.Validate||e.type===t.Expression.ExpressionType.Required)},e.prototype.getEntityPathFromEvent=function(t){if(!(t=JSON.parse(JSON.stringify(t)))||!t.path||t.path.length<1)return[];var e=t.path;return this.getEntityPath(e)},e.prototype.getEntityPath=function(t){return t.filter((function(t,e){return e%2!=0||!t.includes(":")}))},e.prototype.buildEntityPath=function(t){return t.filter((function(t,e){return e%2!=0||!t.includes(":")}))},e.prototype.cleanEventPath=function(t){return(t=t.filter((function(t){return!(!t||":"===t)}))).map((function(t){return t.includes(":")?t.split(":")[1]:t}))},e.prototype.getCurrentRowByPaths=function(t){var e=null,n=this.bindingData.getValue(t);if(n&&n.length>0){var i=n.currentItem.primaryKeyValue||null;if(i){var r=n.findById(i);r&&(e=r.toJSON())}}return e},e.prototype.getEventId=function(t,e){if(!t||t.length<1)throw new Error("invalid path!");var n=t.findIndex((function(t){return t===e}));if(-1===n)return null;var i=n+1;if(i>t.length-1)throw new Error("invalid propertyName or path");var r=t[i];if(-1===r.indexOf(":"))throw new Error("compute error.");return r.split(":")[1]},e.prototype.buildStateContext=function(t){var e=t.ns,n=this.injector.get(Te,null).viewModelContextManager.getContextsByNamespace(e),i={};if(n&&n.length>0){var r=n[0].getVirtualRootFrameContext();if(r){var o=r.viewModel.uiState;(Object.getOwnPropertyNames(o)||[]).forEach((function(t){null!==t.match(/^[a-zA-Z0-9_\$]+$/g)&&(i[t]=o[t])}))}}return i},e.prototype.buildEntityContext=function(e,n,i){var r=this,o=n.bindingType;if(o===t.Expression.ExpressionBindingType.Field){var a=this.repository.entityTypeInfo,s=[];hn.getChildrenEntityPaths(a,s);var p=i&&i.find((function(t){return""===t.bindingPath||"/"===t.bindingPath}))||null,u=p&&p.primaryValue||this.bindingData.list.currentId,c=this.bindingData.list.findById(u);if(!c)return null;var l=c.toJSON();return l.__type__="Entity",!s||s.length<1?l:(s.sort((function(t,e){return t.length-e.length})),s.forEach((function(t){var e=r.bindingData.getValue(t),n=e.currentId,o=t[t.length-1],a=t.slice(0,t.length-1).reduce((function(t,e){return t&&t[e]||null}),l);if(a){var s=a,p=null;if(n){if(i&&i.length>0){var u=i.find((function(e){return e.bindingPath.split("/").filter((function(t){return t})).join("/")===t.join("/")}));u&&(n=u.primaryValue)}var c=e.findById(n),h=a[o];(p=d({__items__:[]},c&&c.toJSON()||{},{__type__:"List"})).length=function(){return p.__items__.length},h&&Array.isArray(h)&&(p.__items__=[].concat(h))}else(p={__items__:[],__type__:"List"}).length=function(){return p.__items__.length};s[o]=p}})),l)}if(o!==t.Expression.ExpressionBindingType.State)return null},e.prototype.buildContext=function(t,e,n,i){var r,o=[];if(n)o.push(n);else{var a=this.buildEntityContext(e,t,i);o.push(a)}var s=this.buildStateContext(e),p=this.entityOriginalNodeCode,u=null;return 1===o.length?u=o.pop():((u=o[0]).__type__||(u.__type__="Entity"),u.__items__=o),d(((r={})[p]=u,r),s,{frameContext:this.frameContext,bindingData:this.bindingData,repository:this.repository})},e.prototype.buildEffectPath=function(t,e){var n=e.path.split("/").filter((function(t){return t})),i=t.path[0]&&t.path[0].split(":")[1];if(!i)throw new Error("Invalid event path!");if(1===n.length)return[i,n.pop()];for(var r=[i],o=0;o<n.length;o++){var a=n[o];r.push(a);var s=n.slice(0,o+1),p=this.repository.entityTypeInfo.getPropInfoByPath(s);if("List"===p.group){var u=this.getEventId(t.path,p.name)||null;if(!u){var c=this.bindingData.getValue(s);c&&(u=c.currentId)}r.push(u)}}return r},e.prototype.getPathInfo=function(t){var e=t.split("/").filter((function(t){return t})),n=hn.getAvailableChildrenPathsFromEntityPaths(e,this.repository.entityTypeInfo),i=e.slice(n.length).join("/");return{path:n.join("/"),propertyName:i,paths:n,propertyNames:i.split("/").filter((function(t){return t}))}},e.prototype.getTablePathsFromEventPaths=function(t){return t=this.getEntityPath(t),hn.getAvailableChildrenPathsFromEntityPaths(t,this.repository.entityTypeInfo)},e.prototype.getPropertyPathsFromEventPaths=function(t){t=this.getEntityPath(t);var e=hn.getAvailableChildrenPathsFromEntityPaths(t,this.repository.entityTypeInfo);return t.slice(e.length)},e.prototype.analysis=function(t,e){var n=this.getPathInfo(e.path),i=this.getEntityPath(t.path.slice(0)),r=this.getPathInfo(i.join("/"));if(!n||!r)return console.warn("表达式路径或事件路径错误，获取路径信息失败。"),null;var o=n.path.split("/").filter((function(t){return t})),a=n.propertyName.split("/").filter((function(t){return t})),s=r.path.split("/").filter((function(t){return t})),p={distance:void 0,eventFromChildren:void 0,eventFromParent:void 0,expressionTablePaths:o,expressionPropertyNames:a,eventTablePaths:s,eventPropertyNames:r.propertyName.split("/").filter((function(t){return t})),isSameTable:!1};return p.distance=Math.abs(o.length-s.length),1===p.distance&&(p.eventFromChildren=s.length>o.length&&s.join("/").startsWith(o.join("/")),p.eventFromParent=s.length<o.length&&o.join("/").startsWith(s.join("/"))),p.isSameTable=o.join("/")===s.join("/"),p},e.prototype.buildCurrentRows=function(t,e){var n=new Array;if(!t||t.length<1)n.push({bindingPath:"/",primaryValue:e[0]});else{var i=[];t.forEach((function(t,r){0===r&&n.push({bindingPath:"/",primaryValue:e[0]}),i.push(t);var o=e[2*r+2];n.push({bindingPath:i.join("/"),primaryValue:o})}))}return n},e}(),qn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return f(e,t),e.prototype.filter=function(t){return null},e.prototype.dispatch=function(t){},e.prototype.getCurrentRowByEvent=function(t,e){return this.getCurrentRowByPaths(t)},e}(Un),Gn=function(){function t(){}return t.effect=function(t,e,n){!n||n.length<1||n.forEach((function(n){var i={path:n,message:e.message,expressionId:e.id,viewModelId:e.viewModelId,eventType:e.eventType};t.effect(e.path,e.result,i)}))},t}(),zn=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return f(n,e),n.prototype.filter=function(t){var e=this;return this.expressionObjects&&this.expressionObjects.length>0?this.expressionObjects.filter((function(n){var i=n.deps;if(!i||i.length<1||t.ns!==n.ns)return!1;var r=e.cleanEventPath(t.path);r.splice(0,0,"STATE~");var o=r.join("/");return!!i.includes(o)})):null},n.prototype.dispatch=function(t){var e=this,n=this.filter(t);n&&n.length>0&&n.forEach((function(n){var i=e.buildContext(n,t),r=e.perform(n,i);(void 0!==r||e.isValidateOrRequiredExpression(n))&&(n.result=r,n.id&&e.expressionResult.set(n.id,n.result),e.effect(t,n))}))},n.prototype.effect=function(e,n){var i=this,r=this.effectorFactory.getEffector(n),o=n.bindingType;if(o===t.Expression.ExpressionBindingType.State)r.effect(n.path,n.result,{message:n.message,eventType:e.type,viewModelId:n.viewModelId});else if(o===t.Expression.ExpressionBindingType.Field){var a=this.getPathInfo(n.path),s=a.paths,p=this.repository.entityCollection.getAllEntities();this.effectRows(p,s,a.propertyNames,(function(t,o){i.output(e,n,t,r,[o])}))}},n.prototype.output=function(t,e,n,i,r){var o=this.buildContext(e,t,null,n),a=this.perform(e,o);void 0!==a&&(e.result=a,e.id&&this.expressionResult.set(e.id,e.result),Gn.effect(i,e,r))},n.prototype.effectRows=function(t,e,n,i,r,o,a){var s=this;if(void 0===r&&(r=[]),void 0===o&&(o=[]),void 0===a&&(a=[]),!e||e.length<1)t.forEach((function(t){if(t&&t.primaryValue){var e=a.concat([t.primaryValue]).concat(n),s=r.concat([{bindingPath:o.join("/")||"/",primaryValue:t.primaryValue}]);i(s,e)}})),r.length=0,a.length=0;else{var p=!1,u=o;t.forEach((function(t){var c=e[0],l=t[c];if(l&&!(l.count()<1)){r.push({bindingPath:o.join("/")||"/",primaryValue:t.primaryValue}),a.push(t.primaryValue),a.push(c),!1===p&&(p=!0,u.push(c));var h=e.slice(1);s.effectRows(l.items,h,n,i,r,u,a)}}))}},n.prototype.getCurrentRowByEvent=function(t,e){return this.getCurrentRowByPaths(t)},n}(Un),Jn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return f(e,t),e.prototype.filter=function(t){return null},e.prototype.dispatch=function(t){var e=this,n=this.filter(t);n&&n.length>0&&n.forEach((function(n){var i=e.buildEntityContext(t,n),r=e.buildContext(n,t,i),o=e.perform(n,r);(void 0!==o||e.isValidateOrRequiredExpression(n))&&(n.result=o,n.id&&e.expressionResult.set(n.id,n.result),e.effect(t,n))}))},e.prototype.getCurrentRowByEvent=function(t,e){return this.getCurrentRowByPaths(t)},e}(Un),Wn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return f(e,t),e.prototype.filter=function(t){return null},e.prototype.dispatch=function(t){},e}(Un),Yn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return f(e,t),e.prototype.filter=function(t){return null},e.prototype.dispatch=function(t){var e=this,n=this.filter(t);n&&n.length>0&&n.forEach((function(n){var i=e.buildEntityContext(t,n),r=e.buildContext(n,t,i),o=e.perform(n,r);(void 0!==o||e.isValidateOrRequiredExpression(n))&&(n.result=o,n.id?e.expressionResult.set(n.id,n.result):console.warn("EventHandler 表达式未设置唯一标识，无法更新表达式值。"),e.effect(t,n))}))},e.prototype.getCurrentRowByEvent=function(t,e){return this.getCurrentRowByPaths(t)},e}(Un),$n=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return f(n,e),n.prototype.filter=function(e){var n=this;return this.expressionObjects.filter((function(i){if(i.ns!==e.ns||!i.deps||0===i.deps.length||i.type===t.Expression.ExpressionType.Compute||i.type===t.Expression.ExpressionType.Dependency||i.type===t.Expression.ExpressionType.DataPicking)return!1;var r=n.analysis(e,i);return!!r&&(0===r.expressionTablePaths.length&&-1!==i.deps.findIndex((function(e){if(!e.startsWith("ENTITY~"))return!1;var i=e.split(t.Expression.DEPENDENCY_SPLITER).filter((function(t){return t})).slice(1),r=n.getPathInfo(i.join("/"));return!!r&&0===r.paths.length})))}))},n.prototype.dispatch=function(t){var e=this,n=this.filter(t);n&&n.length>0&&n.forEach((function(n){var i=e.buildEntityContext(t,n),r=e.buildContext(n,t,i),o=e.perform(n,r);(void 0!==o||e.isValidateOrRequiredExpression(n))&&(n.result=o,n.id?e.expressionResult.set(n.id,n.result):console.warn("EventHandler 表达式未设置唯一标识，无法更新表达式值。"),e.effect(t,n))}))},n.prototype.getCurrentRowByEvent=function(t,e){var n=null,i=this.bindingData.getValue(t),r=this.getEntityPath(e.path);if(i&&i.length>0){var o=i.currentItem.primaryKeyValue||null,a=hn.getAvailableChildrenPathsFromEntityPaths(r,this.repository.entityTypeInfo);if(a&&a.toString()===t.toString()&&((o=e.id||null)||(o=this.getEventId(e.path,t[t.length-1]))),o){var s=i.findById(o);s&&(n=s.toJSON())}}return n},n}(Un),Xn=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return f(n,e),n.prototype.filter=function(e){var n=this;if(this.expressionObjects&&this.expressionObjects.length>0){var i=this.expressionObjects.filter((function(i){if(i.ns!==e.ns||!i.deps||i.deps.length<1)return!1;var r=n.buildEntityPath(e.path),o=n.analysis(e,i);return!!o&&((0!==r.length||i.bindingType!==t.Expression.ExpressionBindingType.Field)&&(r.splice(0,0,"ENTITY~"),o.eventTablePaths.length-1===o.expressionTablePaths.length&&(!!o.eventTablePaths.join(t.Expression.DEPENDENCY_SPLITER).startsWith(o.expressionTablePaths.join(t.Expression.DEPENDENCY_SPLITER))&&-1!==i.deps.findIndex((function(e){if(!e.startsWith(r.join(t.Expression.DEPENDENCY_SPLITER)))return!1;var i=e.split(t.Expression.DEPENDENCY_SPLITER).filter((function(t){return t})).slice(1),a=n.getPathInfo(i.join(t.Expression.DEPENDENCY_SPLITER));return!(!a||a.paths.join(t.Expression.DEPENDENCY_SPLITER)!==o.eventTablePaths.join(t.Expression.DEPENDENCY_SPLITER))})))))})),r=this.buildEntityPath(e.path),o=this.expressionObjects.filter((function(i){if(i.ns!==e.ns)return!1;if(n.getPathInfo(i.path).paths.join(t.Expression.DEPENDENCY_SPLITER)!==r.join(t.Expression.DEPENDENCY_SPLITER))return!1;if(!i.deps||i.deps.length<1)return!0;if(i.deps.every((function(t){return t.startsWith("STATE~")})))return!0;var o=n.analysis(e,i);return!(!o||0!==o.distance||!o.isSameTable)}));return i.concat(o)}return null},n.prototype.dispatch=function(t){var e=this,n=this.filter(t);n&&n.length>0&&n.forEach((function(n){var i=e.buildEntityContext(t,n),r=e.buildContext(n,t,i),o=e.perform(n,r);(void 0!==o||e.isValidateOrRequiredExpression(n))&&(n.result=o,n.id?e.expressionResult.set(n.id,n.result):console.warn("EventHandler 表达式未设置唯一标识，无法更新表达式值。"),e.effect(t,n))}))},n.prototype.getCurrentRowByEvent=function(t,e){return this.getCurrentRowByPaths(t)},n.prototype.effect=function(e,n){var i=this,r=n.bindingType,o=this.cleanEventPath(e.path),a=this.effectorFactory.getEffector(n);if(a){var s=this.analysis(e,n);if(s){var p=n.path.split("/").filter((function(t){return t}));if(r===t.Expression.ExpressionBindingType.Field){var u=[],c=p.slice(s.expressionTablePaths.length);if(0===s.distance){if(!s.isSameTable)return;var l=o.slice(0);if(1===o.length)if(e.value&&Array.isArray(e.value))e.value.forEach((function(t){u.push([t.primaryKeyValue].concat(c))}));else{var h=l.concat(c);u.push(h)}else if(e.value&&Array.isArray(e.value))e.value.forEach((function(t){u.push(l.concat([t.primaryKeyValue]).concat(c))}));else{var f=this.bindingData.getValue(s.eventTablePaths);f&&f.currentId&&u.push(l.concat(f.currentId).concat(c))}}else{if(!0===s.eventFromParent)return void console.warn("[BindingDataAppendObjectEventHandler][effect_error]");if(!0!==s.eventFromChildren)return void console.warn("[BindingDataAppendObjectEventHandler][effect_error]");h=o.slice(0,o.length-1).concat(c);u.push(h)}u.forEach((function(t){var r=i.buildCurrentRows(s.expressionTablePaths,t);i.output(e,n,r,a,[t])}))}else r===t.Expression.ExpressionBindingType.State&&console.error("not supported！")}else console.warn("[BindingDataAppendObjectEventHandler][analysis]获取路径信息失败。")}},n.prototype.output=function(t,e,n,i,r){var o=this.buildContext(e,t,null,n),a=this.perform(e,o);void 0!==a&&(e.result=a,e.id&&this.expressionResult.set(e.id,e.result),Gn.effect(i,d({eventType:t.type},e),r))},n}(Un),Zn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return f(e,t),e.prototype.filter=function(t){var e=this;return this.expressionObjects&&this.expressionObjects.length>0?this.expressionObjects.filter((function(n){var i=n.deps;if(!i||i.length<1||t.ns!==n.ns)return!1;var r=e.getEntityPath(t.path);return r.splice(0,0,"ENTITY~"),i.includes(r.join("/"))})):null},e.prototype.dispatch=function(t){var e=this,n=this.filter(t);n&&n.length>0&&n.forEach((function(n){e.effect(t,n)}))},e.prototype.effect=function(t,e){var n,i,r=this.effectorFactory.getEffector(e);if(r){var o=this.analysis(t,e);if(o){var a=this.cleanEventPath(t.path),s=[];if(0===o.distance){if(!1===o.isSameTable)return void console.warn("[BindingDataValueChangeEventHandler]不支持多对多关系。");var p=(c=a.slice(0,a.length-o.eventPropertyNames.length)).concat(o.expressionPropertyNames),u=this.buildCurrentRows(o.eventTablePaths,p);s.push(p),this.output(t,e,u,r,s)}else if(!0===o.eventFromChildren){if(o.distance>1)return;p=(c=a.slice(0,a.length-o.eventPropertyNames.length-2)).concat(o.expressionPropertyNames);s.push(p);u=this.buildCurrentRows(o.eventTablePaths,a);this.output(t,e,u,r,s)}else if(!0===o.eventFromParent){if(o.distance>1)return void console.warn("[BindingDataValueChangeEventHandler]不支持多对多关系。");var c;(c=a.slice(0,a.length-o.eventPropertyNames.length)).push(o.expressionTablePaths.slice(0).pop());o.expressionTablePaths;var l=a[0];if(!l)return;for(var h=this.frameContext.repository.entityCollection.getEntityById(l),f=1;f<c.length;f++){var d=c[f];h=h instanceof pe?h.get(d):h[d]}var y=h;if(y&&y instanceof pe&&y.count()>0)try{for(var v=g(y),m=v.next();!m.done;m=v.next()){var E=m.value;if(E&&E.primaryValue){p=c.concat([E.primaryValue]).concat(o.expressionPropertyNames),u=this.buildCurrentRows(o.expressionTablePaths,p);this.output(t,e,u,r,[p])}}}catch(t){n={error:t}}finally{try{m&&!m.done&&(i=v.return)&&i.call(v)}finally{if(n)throw n.error}}}}}},e.prototype.output=function(t,e,n,i,r){var o=this.buildContext(e,t,null,n),a=this.perform(e,o);void 0!==a&&(e.result=a,e.id&&this.expressionResult.set(e.id,e.result),Gn.effect(i,e,r))},e.prototype.getCurrentRowByEvent=function(t,e){e=JSON.parse(JSON.stringify(e));var n=null,i=this.bindingData.getValue(t),r=this.getEntityPath(e.path);if(i&&i.length>0){var o=i.currentItem.primaryKeyValue||null,a=hn.getAvailableChildrenPathsFromEntityPaths(r,this.repository.entityTypeInfo);if(a&&a.toString()===t.toString()&&((o=e.id||null)||(o=this.getEventId(e.path,t[t.length-1]))),o){var s=i.findById(o);s&&(n=s.toJSON())}}return n},e}(Un),Qn=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return f(n,e),n.prototype.filter=function(e){var n=this;if(this.expressionObjects&&this.expressionObjects.length>0)return this.expressionObjects.filter((function(i){if(i.ns!==e.ns||!i.deps||i.deps.length<1)return!1;var r=n.analysis(e,i);if(!r)return!1;var o=n.buildEntityPath(e.path);return(0!==o.length||i.bindingType!==t.Expression.ExpressionBindingType.Field)&&(o.splice(0,0,"ENTITY~"),r.eventTablePaths.length-1===r.expressionTablePaths.length&&(!!r.eventTablePaths.join(t.Expression.DEPENDENCY_SPLITER).startsWith(r.expressionTablePaths.join(t.Expression.DEPENDENCY_SPLITER))&&-1!==i.deps.findIndex((function(e){if(!e.startsWith(o.join(t.Expression.DEPENDENCY_SPLITER)))return!1;var i=e.split(t.Expression.DEPENDENCY_SPLITER).filter((function(t){return t})).slice(1),a=n.getPathInfo(i.join(t.Expression.DEPENDENCY_SPLITER));return!(!a||a.paths.join(t.Expression.DEPENDENCY_SPLITER)!==r.eventTablePaths.join(t.Expression.DEPENDENCY_SPLITER))}))))}))},n.prototype.dispatch=function(t){var e=this,n=this.filter(t);n&&n.length>0&&n.forEach((function(n){var i=e.buildEntityContext(t,n),r=e.buildContext(n,t,i),o=e.perform(n,r);(void 0!==o||e.isValidateOrRequiredExpression(n))&&(n.result=o,n.id&&e.expressionResult.set(n.id,n.result),e.effect(t,n))}))},n.prototype.effect=function(e,n){var i=n.bindingType,r=this.cleanEventPath(e.path),o=this.effectorFactory.getEffector(n);if(o){var a=this.analysis(e,n);if(a){var s=n.path.split("/").filter((function(t){return t}));if(i===t.Expression.ExpressionBindingType.Field){var p=[],u=s.slice(a.expressionTablePaths.length);if(0!==a.distance){if(!0===a.eventFromParent)return void console.warn("[BindingDataRemoveObjectEventHandler][effect_error]");if(!0!==a.eventFromChildren)return void console.warn("[BindingDataRemoveObjectEventHandler][effect_error]");var c=r.slice(0,r.length-1).concat(u);p.push(c)}Gn.effect(o,n,p)}else i===t.Expression.ExpressionBindingType.State&&console.error("not supported！")}else console.warn("[BindingDataRemoveObjectEventHandler][analysis]获取路径信息失败。")}},n.prototype.getCurrentRowByEvent=function(t,e){return this.getCurrentRowByPaths(t)},n}(Un),ti=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return f(n,e),n.prototype.filter=function(e){var n=this;return(e.path&&0!==e.path.length||!e.value||!Array.isArray(e.value)||0!==e.value.length)&&this.expressionObjects&&this.expressionObjects.length>0?this.expressionObjects.filter((function(i){if(i.ns!==e.ns||i.type!==t.Expression.ExpressionType.Readonly&&i.type!==t.Expression.ExpressionType.Visible&&i.type!==t.Expression.ExpressionType.Required&&i.type!==t.Expression.ExpressionType.Validate)return!1;var r=n.analysis(e,i);return!!r&&(0===r.distance&&r.isSameTable)})):null},n.prototype.dispatch=function(t){var e=this,n=this.filter(t);n&&n.length>0&&n.forEach((function(n){var i=e.buildEntityContext(t,n),r=e.buildContext(n,t,i),o=e.perform(n,r);(void 0!==o||e.isValidateOrRequiredExpression(n))&&(n.result=o,n.id&&e.expressionResult.set(n.id,n.result),e.effect(t,n))}))},n.prototype.getCurrentRowByEvent=function(t,e){return this.getCurrentRowByPaths(t)},n}(Un),ei=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return f(e,t),e.prototype.filter=function(t){var e=this;return this.expressionObjects&&this.expressionObjects.length>0?this.expressionObjects.filter((function(n){var i=n.deps;if(!i||i.length<1)return!1;var r=i.findIndex((function(t){return t.startsWith("ENTITY~")}));if(-1===r)return!1;var o=e.analysis(t,n);return!!o&&(1===o.eventTablePaths.length&&(2===o.expressionTablePaths.length&&(!!o.expressionTablePaths.join("/").startsWith(o.eventTablePaths.join("/"))&&-1!==(r=i.findIndex((function(t){return t.startsWith("ENTITY~/"+o.eventTablePaths[0])}))))))})):null},e.prototype.dispatch=function(t){var e=this,n=this.filter(t);n&&n.length>0&&n.forEach((function(n){var i=e.buildEntityContext(t,n),r=e.buildContext(n,t,i),o=e.perform(n,r);(void 0!==o||e.isValidateOrRequiredExpression(n))&&(n.result=o,n.id&&e.expressionResult.set(n.id,n.result),e.effect(t,n))}))},e}(Un),ni=new B("@Farris expression assigner"),ii=new B("@Farris_event_handler"),ri=function(){function t(t){this.viewModelContext=t,this.handlers=this.viewModelContext.injector.get(ii)}return Object.defineProperty(t.prototype,"entityValueChangedEventHandler",{get:function(){return this.handlers&&this.handlers.find((function(t){return t instanceof qn}))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"stateValueChangedEventHandler",{get:function(){return this.handlers&&this.handlers.find((function(t){return t instanceof zn}))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"repositoryAddEntityEventHandler",{get:function(){return this.handlers&&this.handlers.find((function(t){return t instanceof Jn}))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"repositoryRemoveEntityEventHandler",{get:function(){return this.handlers&&this.handlers.find((function(t){return t instanceof Wn}))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"entityUpdateEventHandler",{get:function(){return this.handlers&&this.handlers.find((function(t){return t instanceof $n}))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"repositoryLoadEventHandler",{get:function(){return this.handlers&&this.handlers.find((function(t){return t instanceof Yn}))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bindingDataAppendEntityEventHandler",{get:function(){return this.handlers&&this.handlers.find((function(t){return t instanceof Xn}))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bindingDataValueChangeEventHandler",{get:function(){return this.handlers&&this.handlers.find((function(t){return t instanceof Zn}))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bindingDataRemoveObjectEventHandler",{get:function(){return this.handlers&&this.handlers.find((function(t){return t instanceof Qn}))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bindingDataLoadEventHandler",{get:function(){return this.handlers&&this.handlers.find((function(t){return t instanceof ti}))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bindingDataSelectionChangedHandler",{get:function(){return this.handlers&&this.handlers.find((function(t){return t instanceof ei}))},enumerable:!0,configurable:!0}),t}(),oi=function(){function e(t){var e=this;this.viewModelContext=t,this.expressionObjects=new Array,this.injector=this.viewModelContext.injector,this.expressionRegistry=this.injector.get(Hn),this.expressionEventEmitter=this.injector.get(_n),this.resolverRegistry=this.injector.get(an),this.eventHandlerRegistry=this.injector.get(ri),this.resolveService=this.injector.get(ln),this.expressionRegistry.expressions.subscribe((function(t){t&&t.length>0&&(e.expressionObjects=t,e.resolveDependency()),e.attachEvent()}))}return e.prototype.attachEvent=function(){var t=this;this.expressionEventEmitter.attach().subscribe((function(e){!e||e.length<1||!t.expressionObjects||t.expressionObjects.length<1||e.forEach((function(e){var n=t.getEventHandler(e);n?n.handleEvent(e,t.expressionObjects):fn.warn("没有对应的事件处理器,event="+e.type)}))}))},e.prototype.resolveDependency=function(){var t=this;!this.resolverRegistry||!this.resolverRegistry.resolvers||this.resolverRegistry.resolvers.length<1||!this.expressionObjects||this.expressionObjects.length<1||!Array.isArray(this.expressionObjects)||this.expressionObjects.forEach((function(e){var n=e.expression,i=t.resolveService.resolve(n);e.deps=i}))},e.prototype.getEventHandler=function(e){if(e.type===t.Expression.EventType.ValueChanged){if(e.source===t.Expression.EventSource.BindingData)return this.eventHandlerRegistry.bindingDataValueChangeEventHandler;if(e.source===t.Expression.EventSource.Field)return this.eventHandlerRegistry.entityValueChangedEventHandler;if(e.source===t.Expression.EventSource.State)return this.eventHandlerRegistry.stateValueChangedEventHandler}else if(e.type===t.Expression.EventType.Append){if(e.source===t.Expression.EventSource.Repository||e.source===t.Expression.EventSource.Field)return this.eventHandlerRegistry.repositoryAddEntityEventHandler;if(e.source===t.Expression.EventSource.BindingData)return this.eventHandlerRegistry.bindingDataAppendEntityEventHandler}else if(e.type===t.Expression.EventType.Remove){if(e.source===t.Expression.EventSource.Repository||e.source===t.Expression.EventSource.Field)return this.eventHandlerRegistry.repositoryRemoveEntityEventHandler;if(e.source===t.Expression.EventSource.BindingData)return this.eventHandlerRegistry.bindingDataRemoveObjectEventHandler}else if(e.type===t.Expression.EventType.Update){if(e.source===t.Expression.EventSource.Repository)return this.eventHandlerRegistry.entityUpdateEventHandler}else if(e.type===t.Expression.EventType.Load){if(e.source===t.Expression.EventSource.Repository||e.source===t.Expression.EventSource.Field)return this.eventHandlerRegistry.repositoryLoadEventHandler;if(e.source===t.Expression.EventSource.BindingData)return this.eventHandlerRegistry.bindingDataLoadEventHandler}else if(e.type===t.Expression.EventType.SelectionChanged&&e.source===t.Expression.EventSource.BindingData)return this.eventHandlerRegistry.bindingDataSelectionChangedHandler;return null},e}(),ai=function(){function t(t){this.viewModelContext=t}return t.prototype.set=function(t,e){this[t]=e},t}(),si=function(){function n(t){this.frameContext=t,this.injector=this.frameContext.injector,this.resolveService=this.injector.get(ln),this.expressionExecutor=this.injector.get(Kn),this.expressionRegistry=this.injector.get(Hn),this.expressionResult=this.injector.get(ai),this.messageService=this.injector.get(gn,null),this.notifyService=this.injector.get(vn,null)}return n.prototype.eval=function(t,e,n){var i=this.expressionRegistry.getExpressionById(t);if(i){var r={},o=e&&e.bindingPath||null;if(o&&n){var a=o.split("/").filter((function(t){return t})),s=this.frameContext.bindingData.getValue(a),p="id";s&&(p=s.primaryKey);var u=n[p];u&&(r.currentRows=[{bindingPath:a.join("/"),primaryValue:u}])}var c=this.execute(i.expression,r);return this.expressionResult.set(t,c),c}},n.prototype.validate=function(t,e){var n=this.expressionRegistry.getExpressionById(t);if(n){var i=e&&e.patch||null,r={};i&&(r.patch=i);var o=e.currentRow||null;o&&(r.currentRows=r.currentRows||[],r.currentRows.push(o));var a=this.execute(n.expression,r);return this.expressionResult.set(t,a),a}console.warn("ExpressionManager 执行失败，未获取到表达式!")},n.prototype.onDataPicking=function(n){var i=n&&n.expressionId||null;if(!i)return console.warn("ExpressionManager 相关表达式设置错误，没有表达式编号。"),e.of(!0);var r=this.eval(i);if(!r){var o=this.expressionRegistry.getExpressionById(i);if(!o)return console.warn("ExpressionManager 无法找到对应的表达式"+i),e.of(!0);var a=o.messageType||t.Expression.MessageType.warning,s=o.message;return s&&this.notifyService[a](s,{hideTitle:!0}),e.EMPTY}return e.of(r)},n.prototype.execute=function(t,e){var n,i=this.resolveService.resolve(t),r=hn.getGroupFunctionDependency(t,this.frameContext.repository.entityTypeInfo),o=this.buildEntityContext(i,r,e),a=this.buildStateContext(),s=e&&e.contexts||null,p=d(((n={})[this.entityOriginalNodeCode]=o,n),a,{frameContext:this.frameContext,bindingData:this.frameContext.bindingData,repository:this.frameContext.repository},s);if(o)return this.expressionExecutor.eval(t,p)},n.prototype.executeAsync=function(t,n){var i=this.execute(t,n);return e.of(i)},n.prototype.buildEntityContext=function(t,e,n){var i=this,r=n&&n.currentRows||null,o=-1!==t.findIndex((function(t){return!!i.isEntityDependency(t)&&(!!(-1!==e.findIndex((function(e){return e===t})))&&1===t.split("/").filter((function(t){return t})).length-1)})),a={};r&&r.length>0&&r.forEach((function(t){a[t.bindingPath||"/"]=t.primaryValue}));var s=this.getEntity(a),p=n&&n.patch||null;if(!s)return null;if(p&&Object.keys(p).length>0&&Object.keys(p).forEach((function(t){var e=t.split("/").filter((function(t){return t})),n=p[t];i.setValue(s,e,n)})),o){var u=this.frameContext.repository.entityCollection.toJSON();s.__type__="List",s.__items__=u}return s},n.prototype.setValue=function(t,e,n){if(1===e.length)t[e[0]]=n;else{var i=e.pop();e.reduce((function(t,e){return t&&t[e]}),t)[i]=n}},n.prototype.isEntityDependency=function(t){return t.startsWith("ENTITY~")},n.prototype.getEntity=function(t){var e=this,n=this.frameContext.repository.entityTypeInfo,i=this.frameContext.bindingData,r=[],o=null;return t["/"]?(o=this.frameContext.bindingData.list.findById(t["/"]))&&(o=o.toJSON()):o=this.frameContext.bindingData.list.currentItem.toJSON(),o?(hn.getChildrenEntityPaths(n,r),o.__type__="Entity",!r||r.length<1?o:(r.forEach((function(n){var r=null;if(t&&t[n.join("/")]){var a=i.getValue(n),s=t[n.join("/")],p=null;(p=s!==a.currentId?a.findById(s):a.currentItem)&&p.primaryKeyValue&&(r=p.toJSON())}else{if(t&&!!Object.keys(t).find((function(t){var e=t.split("/").join("/");return n.join("/").startsWith(e)}))||!1){var u=t&&t["/"]||i.list.currentId,c=e.frameContext.repository.entityCollection.getEntityById(u),l=[],h=n.reduce((function(e,n){l.push(n);var i=e&&e[n];if(i){var r=t&&t[l.join("/")]||i.items[0]&&i.items[0].primaryValue||null;if(r)return i.get(r)||null}return null}),c);r=h?h.toJSON():{}}else r=hn.getCurrentRowByPaths(n,i)}var f=n.pop(),y=n.reduce((function(t,e){return t&&t[e]||null}),o),g=y[f],v=d({__items__:[]},r&&r||{},{__type__:"List"});v.length=function(){return v.__items__.length},g&&Array.isArray(g)&&(v.__items__=[].concat(g)),y[f]=v})),o)):null},Object.defineProperty(n.prototype,"entityOriginalNodeCode",{get:function(){var t=this.injector.get(ge);return t&&t.entityTypeInfo&&t.entityTypeInfo.entityInfo&&t.entityTypeInfo.entityInfo.originalCode||null},enumerable:!0,configurable:!0}),n.prototype.buildStateContext=function(){var t={};if(this.frameContext){var e=this.frameContext.getVirtualRootFrameContext();if(e){var n=e.viewModel.uiState;(Object.getOwnPropertyNames(n)||[]).forEach((function(e){null!==e.match(/^[a-zA-Z0-9_\$]+$/g)&&(t[e]=n[e])}))}}return t},n}(),pi=function(){function t(t){this.viewModelContext=t,this.injector=this.viewModelContext.injector,this.expressionRegistry=this.injector.get(Hn),this.expressionManager=this.injector.get(si),this.expressionResult=this.injector.get(ai),this.registeEvent()}return t.prototype.registeEvent=function(){var t=this;this.expressionRegistry.expressions.subscribe((function(e){e.forEach((function(e){if(!(e.deps&&e.deps.length>0)){var n=t.expressionManager.eval(e.id);t.expressionResult[e.id]=n}}))}))},t}(),ui=function(){function t(){}return t.getFormValueByPath=function(t,e){if(!e)return null;if(!t)return null;if(!e.bindingData)return null;if("/"===e.bindingData.bindingPath)return e.form.getFormValueByBindPath(t);if(e.bindingData.bindingPath&&e.bindingData.bindingPath.length>1&&0==t.indexOf(e.bindingData.bindingPath))return t=t.replace(e.bindingData.bindingPath+"/",""),e.form.getFormValueByBindPath(t);return null},t}(),ci=function(){function t(t){this.viewModelContext=t,this.ns=this.viewModelContext.injector.get(mn,"")}return t.prototype.effect=function(t,e,n){var i;if(n.viewModelId&&(i=this.viewModelContext.appContext.viewModelContextManager.getContextById(n.viewModelId))&&i.form){var r=ui.getFormValueByPath(t,i).form_name;r&&(r.readonly=!0===e,i.form.changes.next({type:"validateFieldsFinished"}))}},t}(),li=function(){function e(t){this.viewModelContext=t,this.ns=this.viewModelContext.injector.get(mn,"")}return e.prototype.effect=function(e,n,i){var r;if(i.viewModelId&&(r=this.viewModelContext.appContext.viewModelContextManager.getContextById(i.viewModelId))&&r.form){var o=ui.getFormValueByPath(e,r),a=o.form_name;if(a){!1===n&&i.eventType!==t.Expression.EventType.Append&&i.eventType!==t.Expression.EventType.Load?a.validationResult={passing:!n,message:i.message}:!0===n&&(a.validationResult={passing:!0,message:""});var s=[{type:"expression",constraints:[i.expressionId],message:i.message}];r.form.addValidate(o.bindingPath,o.name),a.pushValidatorFnforValidate(s,!0)}}},e}(),hi=function(){function t(t){this.viewModelContext=t,this.ns=this.viewModelContext.injector.get(mn,"")}return t.prototype.effect=function(t,e,n){var i;if(n.viewModelId&&(i=this.viewModelContext.appContext.viewModelContextManager.getContextById(n.viewModelId))&&i.form){var r=ui.getFormValueByPath(t,i),o=r.form_name;if(o){var a=[{type:"required",constraints:[!0],message:n.message||"必填"}];!0===e?(i.form.addValidate(r.bindingPath,r.name),o.pushValidatorFnforRequired(a,!0),o.required=!0):!1===e&&(o.required=!1,o.getValidatorFn()&&o.getValidatorFn().length>=1&&(o.resetValidatorFnforRequired(),o.validationResult&&"required"===o.validationResult.type&&(o.validationResult={passing:!0,message:""}))),i.form.changes.next({type:"validateFieldsFinished"})}}},t}(),fi=function(){function t(t){this.viewModelContext=t,this.ns=this.viewModelContext.injector.get(mn,"")}return t.prototype.effect=function(t,e,n){var i;if(n.viewModelId&&(i=this.viewModelContext.appContext.viewModelContextManager.getContextById(n.viewModelId))&&i.form){var r=ui.getFormValueByPath(t,i).form_name;r&&(r.visible=!0===e,i.form.changes.next({type:"validateFieldsFinished"}))}},t}(),di=function(){function t(t){this.viewModelContext=t,this.ns=this.viewModelContext.injector.get(mn,"")}return t.prototype.effect=function(t,e,n){var i;if(n.viewModelId&&(i=this.viewModelContext.appContext.viewModelContextManager.getContextById(n.viewModelId)).form){var r=ui.getFormValueByPath(t,i).form_name;r&&!0===e&&(r.value=null,r.validationResult={passing:e,message:""})}},t}(),yi=function(){function e(t){this.viewModelContext=t,this.injector=this.viewModelContext.injector,this.effectorRegistry=this.injector.get(Sn)}return e.prototype.getEffector=function(e){e.path;var n=e.ns,i=e.bindingType,r=e.type,o=this.effectorRegistry.effectors.filter((function(t){return t.ns==n}));if(r===t.Expression.ExpressionType.Compute){if(i===t.Expression.ExpressionBindingType.Field)return o.find((function(t){return t instanceof wn}));if(i===t.Expression.ExpressionBindingType.State)return o.find((function(t){return t instanceof Tn}));throw new Error("不支持的绑定字段类型："+i)}return r===t.Expression.ExpressionType.Readonly?o.find((function(t){return t instanceof ci})):r===t.Expression.ExpressionType.Dependency?o.find((function(t){return t instanceof di})):r!==t.Expression.ExpressionType.Relative?r===t.Expression.ExpressionType.Validate?o.find((function(t){return t instanceof li})):r===t.Expression.ExpressionType.Required?o.find((function(t){return t instanceof hi})):r===t.Expression.ExpressionType.Visible?o.find((function(t){return t instanceof fi})):null:void 0},e}(),gi=m([{provide:an,useClass:an,deps:[Se]},{provide:ln,useClass:ln,deps:[Se]},{provide:Rn,useClass:Rn,deps:[Se]},{provide:An,useClass:An,deps:[Se]},{provide:ri,useClass:ri,deps:[Se]},{provide:Sn,useClass:Sn,deps:[Se]},{provide:yi,useClass:yi,deps:[Se]},{provide:Hn,useClass:Hn,deps:[Se]},{provide:_n,useClass:_n,deps:[Se]},{provide:Kn,useClass:Kn,deps:[Se]},{provide:si,useClass:si,deps:[Se]},{provide:ai,useClass:ai,deps:[Se]},{provide:pi,useClass:pi,deps:[Se]},{provide:oi,useClass:oi,deps:[Se]}],[{provide:rn,useClass:sn,multi:!0,deps:[Se]},{provide:rn,useClass:un,multi:!0,deps:[Se]},{provide:rn,useClass:cn,multi:!0,deps:[Se]}],[{provide:On,useClass:Dn,multi:!0,deps:[Se]},{provide:On,useClass:Nn,multi:!0,deps:[Se]},{provide:On,useClass:Vn,multi:!0,deps:[Se]}],[{provide:ii,useClass:Jn,multi:!0,deps:[Se]},{provide:ii,useClass:Wn,multi:!0,deps:[Se]},{provide:ii,useClass:qn,multi:!0,deps:[Se]},{provide:ii,useClass:zn,multi:!0,deps:[Se]},{provide:ii,useClass:Yn,multi:!0,deps:[Se]},{provide:ii,useClass:$n,multi:!0,deps:[Se]},{provide:ii,useClass:Xn,multi:!0,deps:[Se]},{provide:ii,useClass:Zn,multi:!0,deps:[Se]},{provide:ii,useClass:Qn,multi:!0,deps:[Se]},{provide:ii,useClass:ti,multi:!0,deps:[Se]},{provide:ii,useClass:ei,multi:!0,deps:[Se]}],[{provide:In,useClass:wn,multi:!0,deps:[Se]},{provide:In,useClass:Tn,multi:!0,deps:[Se]},{provide:In,useClass:ci,multi:!0,deps:[Se]},{provide:In,useClass:li,multi:!0,deps:[Se]},{provide:In,useClass:hi,multi:!0,deps:[Se]},{provide:In,useClass:fi,multi:!0,deps:[Se]},{provide:In,useClass:di,multi:!0,deps:[Se]}]),vi=function(){function t(){this.controlsProxyMap=new Map}return t.prototype.setControlProxy=function(t,e){this.controlsProxyMap.set(t,e)},t.prototype.getControlProxy=function(t){return this.controlsProxyMap.get(t)},t}(),mi=function(){function t(t,e){this.extendCommands=new Map,this.injector=t,this.id=e}return t.prototype.init=function(){this.initRepository(),this.initContext(),this.initBindingData(),this.initUIState(),this.intiStateMachine(),this.initForm(),this.initCommandBus(),this.registerWithParent(),this.initListeners(),this.closeOldBeSession(),this.initExpression(),this.initControlsProxy(),this.config()},t.prototype.config=function(){this.uiState.config(this.context)},t.prototype.initControlsProxy=function(){this.controlsProxy=this.injector.get(vi)},t.prototype.initRepository=function(){this.repository=this.injector.get(ge)},t.prototype.initContext=function(){this.context=this.injector.get(Se),this.context.init(this)},t.prototype.initExpression=function(){var t=this.context.appContext.viewModelContextManager.getContexts().find((function(t){return!!t.expressionEngineImpl}));if(t)return this.expressionEngineImpl=t.expressionEngineImpl,this.expressionManager=t.expressionManager,void(this.expressionResult=t.expressionResult);this.expressionEngineImpl=this.injector.get(oi,null),this.expressionManager=this.injector.get(si,null);this.injector.get(pi,null);this.expressionResult=this.injector.get(ai,null)},t.prototype.initBindingData=function(){var t=this;this.bindingData=this.context.injector.get(Lt),this.entityValueChangingListeners=new Map,this.entityValueChangedListeners=new Map,this.bindingData&&this.bindingData.setValueChangeInvokerFactory((function(i){return function(r,o,a,s){var p,u="/"+i.join("/");if(p=!1===a?t.entityValueChangingListeners[u]:t.entityValueChangedListeners[u]){var c={paths:i,preValue:r,value:o,changed:a},l=p.split(";").filter((function(t){return t})),h=!0;return e.from(l).pipe(n.concatMap((function(i){return h?t[i](c).pipe(n.tap((function(t){h=t}))):e.EMPTY})),n.every((function(t){return t})))}return e.of(!0)}}));var i=this.repository.name,r=this.context.appContext.bindingDataManager.getBindingDataByName(i);this.bindingData.initByBindingList(r.list,this.context,r.dataTypeInfo)},t.prototype.initUIState=function(){this.uiState=this.injector.get(Le)},t.prototype.intiStateMachine=function(){this.stateMachine=this.injector.get(ze,null),this.stateMachine&&this.stateMachine.init(this.context)},t.prototype.initForm=function(){this.form=this.injector.get(en,null),this.form.init()},t.prototype.initCommandBus=function(){this.commandBus=this.injector.get(Ki),this.extendCommandMethods()},t.prototype.extendCommandMethods=function(){var t=this;this.ngCommands=st.getPropsMetadatasByName(this.constructor,"CommandMethodMeta"),this.keybindingMap=new Map,Object.keys(this.ngCommands).forEach((function(e){var n=t.ngCommands[e];Object.defineProperty(t,e,{value:function(e){var i={name:n.name,params:n.params,paramDescriptions:n.paramDescriptions,eventParam:e||null};return t.commandBus.dispatch(i)}}),n.keyBinding&&t.keybindingMap.set(e,n.keyBinding)}))},t.prototype.registerExtendCommand=function(t,e){var n=this;Object.defineProperty(this,t,{value:function(t){return e(t,n.context)}}),this.extendCommands.set(t,e)},t.prototype.registerWithParent=function(){var t=this.context.parent;if(t&&t.viewModel&&t.viewModel.childViewModels){var e=t.viewModel,n=this.constructor.name;e[e.childViewModels[n]]=this}},t.prototype.closeOldBeSession=function(){var t=this.context.appContext.viewModelContextManager.getContexts();1===t.length&&t[0]===this.context&&this.context.repository.reset()},t.prototype.initListeners=function(){var t=this,e=function(t,e){return"/"+t.split("/").concat(e.split(".")).filter((function(t){return t.length>0})).join("/")};if(this.form){var n=this.form.getEntityValueChangingListeners();Object.keys(n).forEach((function(i){var r=e(t.bindingPath,i);t.entityValueChangingListeners[r]=n[i]}));var i=this.form.getEntityValueChangedListeners();Object.keys(i).forEach((function(n){var r=e(t.bindingPath,n);t.entityValueChangedListeners[r]=i[n]}))}},t}(),Ei=function(){},Ci=function(){function t(){this.eventBus=new e.Subject,this.subscriptionsMap=new Map}return t.prototype.triggerEvent=function(t){this.eventBus.next(t)},t.prototype.subscribe=function(t,e,n){if(!1===this.subscriptionsMap.has(t)){var i=this.eventBus.subscribe((function(t){return e(t)}),(function(t){return n(t)}));this.subscriptionsMap.set(t,i)}},t.prototype.unsubscribe=function(t){!0===this.subscriptionsMap.has(t)&&(this.subscriptionsMap.get(t).unsubscribe(),this.subscriptionsMap.delete(t))},t.prototype.unsubscribeAllListview=function(t){var e,n;if(void 0===t&&(t="-listview-extend"),0!=this.subscriptionsMap.size)try{for(var i=g(this.subscriptionsMap.keys()),r=i.next();!r.done;r=i.next()){var o=r.value;o.indexOf(t)>0&&(this.subscriptionsMap.get(o).unsubscribe(),this.subscriptionsMap.delete(o))}}catch(t){e={error:t}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}},t}(),bi=[{provide:Ci,useClass:Ci,deps:[]},{provide:xe,useClass:xe,deps:[]},{provide:Pe,useClass:Pe,deps:[]},{provide:Me,useClass:Me,deps:[]},{provide:Te,useClass:Te,deps:[A,Ci,Pe,xe,Me]}],xi=[{provide:Ae,useClass:Ae,deps:[A]}],Pi=[{provide:Fe,useClass:Fe,deps:[Se]},{provide:_e,useClass:_e,deps:[Se]}],Mi=function(){function t(t){t.providers=t.providers||[];var e=Q(m(bi,Di,lt,xi,t.providers));this.context=e.get(Te)}return t.prototype.createViewModel=function(t){var e=t.providers||[],n=t.parent||null,i=Q(m([{provide:Se,useClass:Se,deps:[]},{provide:vi,useClass:vi,deps:[]}],Ui,gi,Pi,e),n?n.injector:this.context.injector).get(mi);return i.init(),i},t}(),Ii=function(){function t(){}return t.getAppContext=function(t){if(t instanceof Bi)return t.viewModelContext.appContext;if(t instanceof Se)return t.appContext;if(t instanceof Te)return t;throw new Error("上下文中找不到AppContext，请检查！")},t.getFrameContext=function(t){if(t instanceof Bi)return t.viewModelContext;if(t instanceof Se)return t;throw new Error("上下文中找不到FrameContext，请检查！")},t.getRootFrameContext=function(t){return this.getFrameContext(t).root},t.getFrameContextById=function(t,e){return this.getAppContext(t).viewModelContextManager.getContextById(e)},t}(),wi=function(){function t(){}return t.prototype.parse=function(t,e){var n=this,i=Ii.getAppContext(e),r=this.extractPaths(t);return 1===r.length&&t==="{DATA~"+r[0]+"}"?this.getValue(r[0],i):(r.forEach((function(e){var r="{DATA~"+e+"}",o=n.getValue(e,i);t=t.replace(r,o)})),t)},t.prototype.extractPaths=function(t){var e=[],n=t.match(/\{DATA~(\S+?)\}/g);if(null===n)return[];var i=/\{DATA~(\S+?)\}/;return n.forEach((function(t){var n=t.match(i);null!=n&&2===n.length&&e.push(n[1])})),e},t.prototype.getValue=function(t,e){var n=t.split("/").filter((function(t){return""!==t})),i=e.viewModelContextManager.getContextById(n[0]);if(!i)throw new Error(t+"不正确，请检查！");var r=i.bindingData;if(!r)throw new Error(t+"不正确，请检查！");return r.getValue(n.slice(1))},t}(),Ti=function(){function t(){}return t.prototype.parse=function(t,e){var n=this,i=Ii.getAppContext(e),r=this.extractPaths(t);return 1===r.length&&t==="{UISTATE~"+r[0]+"}"?this.getUIState(r[0],i):(r.forEach((function(e){var r="{UISTATE~"+e+"}",o=n.getUIState(e,i);t=t.replace(r,o)})),t)},t.prototype.extractPaths=function(t){var e=[],n=t.match(/\{UISTATE~(\S+?)\}/g);if(null===n)return[];var i=/\{UISTATE~(\S+?)\}/;return n.forEach((function(t){var n=t.match(i);null!=n&&2===n.length&&e.push(n[1])})),e},t.prototype.getUIState=function(t,e){var n=t.split("/").filter((function(t){return""!==t})),i=v(n,2),r=i[0],o=i[1],a=e.viewModelContextManager.getContextById(r).uiState[o];if(a&&a.constructor.toString().startsWith("function Date()"))return this.formatDate(a);for(var s=2;s<n.length;s++)if(!(a=a[n[s]]))return a;return a},t.prototype.formatDate=function(t){if(!t)return"";var e=t.getFullYear(),n=(t.getMonth()+1).toString();n=1===n.length?"0"+n:n;var i=t.getDate().toString();return e+"-"+n+"-"+(i=1===i.length?"0"+i:i)},t}(),Si=function(){function t(){}return t.prototype.parse=function(t,e){var n=this,i=this.extractPaths(t);return 1===i.length&&t==="{STATEMACHINE~"+i[0]+"}"?this.getValue(i[0],e):(i.forEach((function(i){var r="{STATEMACHINE~"+i+"}",o=n.getValue(i,e);t=t.replace(r,o)})),t)},t.prototype.extractPaths=function(t){var e=[],n=t.match(/\{STATEMACHINE~(\S+?)\}/g);if(null===n)return[];var i=/\{STATEMACHINE~(\S+?)\}/;return n.forEach((function(t){var n=t.match(i);null!=n&&2===n.length&&e.push(n[1])})),e},t.prototype.getValue=function(t,e){var n=this.getPathObj(t),i=this.getTargetStateMachine(n.frameId,e);if("currentState"===n.type)return i.context.state;if("renderStates"===n.type)return i[n.name];throw new Error("不支类型为"+n.type+"的状态机变量")},t.prototype.getTargetStateMachine=function(t,e){var n;if(!(n=t?Ii.getFrameContextById(e,t):Ii.getRootFrameContext(e))||!n.stateMachine)throw new Error("找不到对应的状态机实例，请检查！");return n.stateMachine},t.prototype.getPathObj=function(t){var e=this.splitPath(t);return"currentState"===e[0]||"renderStates"===e[0]?{frameId:"",type:e[0],name:e[1]}:{frameId:e[0],type:e[1],name:e[2]}},t.prototype.splitPath=function(t){return t.split("/").filter((function(t){return""!==t}))},t}(),Oi=function(){function t(){}return t.prototype.parse=function(t,e){var n=this,i=this.extractPaths(t);return 1===i.length&&t==="{COMMAND~"+i[0]+"}"?this.getValue(i[0],e):(i.forEach((function(i){var r="{COMMAND~"+i+"}",o=n.getValue(i,e);t=t.replace(r,o)})),t)},t.prototype.extractPaths=function(t){var e=[],n=t.match(/\{COMMAND~(\S+?)\}/g);if(null===n)return[];var i=/\{COMMAND~(\S+?)\}/;return n.forEach((function(t){var n=t.match(i);null!=n&&2===n.length&&e.push(n[1])})),e},t.prototype.getValue=function(t,e){if(e instanceof Bi==!1)throw new Error("当前上下文不支持COMMAND变量，请检查！");var n=v(t.split("/").filter((function(t){return""!==t})),2),i=n[0],r=n[1];return"params"===i?e.command.params[r]:"results"===i?e.results[r]:void 0},t}(),ji=function(){function t(t){this.parsers=t}return t.prototype.parse=function(t,e){var n=this;if("string"==typeof t&&t.length>0)return this.parseExpression(t,e);if(Array.isArray(t))t.forEach((function(i,r){t[r]="string"==typeof i?n.parseExpression(i,e):n.parse(i,e)}));else if("object"==typeof t&&null!==t){Object.keys(t).forEach((function(i){"string"==typeof t[i]?t[i]=n.parseExpression(t[i],e):t[i]=n.parse(t[i],e)}))}return t},t.prototype.evaluate=function(t,e){var n=this.parse(t,e);return new Function("return "+n)()},t.prototype.parseExpression=function(t,e){return""===t?"":(this.parsers.forEach((function(n){"string"==typeof t&&(t=n.parse(t,e))})),t)},t}(),Di=[{provide:Ce,useClass:wi,multi:!0,deps:[]},{provide:Ce,useClass:Ti,multi:!0,deps:[]},{provide:Ce,useClass:Si,multi:!0,deps:[]},{provide:Ce,useClass:Oi,multi:!0,deps:[]},{provide:ji,useClass:ji,deps:[Ce]}],Ni=function(){function t(t,e,n){this.from=t,this.to=e,this.condition=n}return t.prototype.canLink=function(t){var e;switch(typeof this.condition){case"boolean":e=this.condition;break;case"function":e=this.condition(t);break;case"string":e=t.viewModelContext.injector.get(ji).evaluate(this.condition,t);break;default:e=!1}return e},t}(),Ri=function(){function t(){this.nodes=[],this.links=[]}return t.prototype.addNode=function(t,e){var n=new Ee(t,e);this.nodes.push(n)},t.prototype.addNodes=function(t){this.nodes=this.nodes.concat(t)},t.prototype.insertNode=function(t,e,n){var i=this.findNodeIndex(t),r=this.createNode(e,n);this.nodes.splice(i,0,r)},t.prototype.appendNode=function(t,e,n){var i=this.findNodeIndex(t)+1,r=this.createNode(e,n);this.nodes.splice(i,0,r)},t.prototype.findNodeIndex=function(t){return this.nodes.findIndex((function(e){return e.name===t}))},t.prototype.createNode=function(t,e){return new Ee(t,e)},t.prototype.addLink=function(t,e,n){var i=this.createLink(t,e,n);this.links.push(i)},t.prototype.addLinks=function(t){this.links=this.links.concat(t)},t.prototype.createLink=function(t,e,n){return new Ni(t,e,n)},t.prototype.getNext=function(t,e){if(!t)return this.nodes.shift();var n=this.links.find((function(n){return n.from===t&&n.canLink(e)}));return n?this.nodes.find((function(t){return t.name===n.to})):void 0},t.prototype.clone=function(){var e=new t;return e.addNodes(this.nodes),e.addLinks(this.links),e},t}(),Bi=function(t,e){this.results={},this.command=t,this.viewModelContext=e},Vi=function(){function t(){}return t.prototype.init=function(t){this.viewModelContext=t,this.parseService=t.injector.get(ji),this.taskFlow=new Ri,this.schedule()},t.prototype.execute=function(t){var i=this,r=new e.Subject,o=this.taskFlow.clone();return setTimeout((function(){var a=d({},t).eventParam,s=void 0===a?null:a;delete t.eventParam;var p=JSON.parse(JSON.stringify(t));p.params=i.parseService.parse(p.params,i.viewModelContext),t.eventParam=s,p.eventParam=s;var u=new Bi(p,i.viewModelContext);u.eventParams=t.eventParam||null;var c=new e.BehaviorSubject(u),l=o.getNext("",u);c.pipe(n.concatMap((function(t){return l.execute(t).pipe(n.take(1),n.map((function(e){return t.results[l.name]=e,t.latestResult=e,(l=o.getNext(l.name,t))?c.next(t):c.complete(),t})),n.throwIfEmpty((function(){c.complete()})))}))).pipe(n.takeLast(1)).subscribe({next:function(t){r.next(t.latestResult)},error:function(t){i.displayError(t),r.error(t)},complete:function(){r.complete()}})}),0),r},t.prototype.displayError=function(t){console&&console.error&&(t||(t="unknown error"),console.error(t))},t.prototype.addTask=function(t,e){this.taskFlow.addNode(t,e)},t.prototype.addLink=function(t,e,n){this.taskFlow.addLink(t,e,n)},t.prototype.insertTask=function(t,e,n){throw new Error("Not Implemented")},t.prototype.afterTask=function(t,e,n){throw new Error("Not Implemented")},t.prototype.replaceTask=function(t,e){throw new Error("Not Implement")},t.prototype.invoke=function(t,e,n,i){this.setContextToServiceInstance(t,i);var r=this.parseService.parse(n,i);return t[e].apply(t,m(r))},t.prototype.setContextToServiceInstance=function(t,e){var n=t.context;n&&n instanceof Bi==!1||(t.context=e)},t}(),Ai=V("@Farris/devkit COMMAND_HANDLERS_TOKEN"),_i=function(){function e(e){var n=this;this.injector=e;var i=this.injector.get(Ai,null,t.InjectFlags.Optional);this.handlerMap=new Map,i&&i.forEach((function(t){n.regist(t)}))}return e.prototype.set=function(t,e){if(this.handlerMap.has(t))throw new Error(t+"对应的CommandHandler已经存在");this.handlerMap.set(t,e)},e.prototype.get=function(t){if(!1===this.handlerMap.has(t))throw new Error("找不到"+t+"对应的CommandHandler");return this.handlerMap.get(t)},e.prototype.regist=function(t){var e=st.getClassMetadataByName(t.constructor,"CommandHandlerMeta");if(!e)throw new Error("CommandHandler必须指定要处理的命令名称");var n=e.commandName;this.set(n,t)},e}(),Fi=function(){},Li=V("@farris/devkit COMMAND_HANDLER_EXTENDERS_TOKEN"),ki=function(){function e(e){var n=this;this.injector=e;var i=this.injector.get(Li,null,t.InjectFlags.Optional);this.extendersMap=new Map,i&&i.forEach((function(t){n.regist(t)}))}return e.prototype.get=function(t){return!1===this.extendersMap.has(t)?[]:this.extendersMap.get(t)},e.prototype.set=function(t,e){this.extendersMap.has(t)?this.extendersMap.get(t).push(e):this.extendersMap.set(t,[e])},e.prototype.regist=function(t){var e=st.getClassMetadataByName(t.constructor,"CommandHandlerExtenderMeta");if(!e)throw new Error("CommandHandlerExtender必须指定要扩展的命令名称");var n=e.commandName;this.set(n,t)},e}(),Hi=function(){function t(t,e,n){this.handlerRegistry=t,this.extenderRegistry=e,this.viewModelContext=n}return t.prototype.create=function(t){var e=this.handlerRegistry.get(t);return e.init(this.viewModelContext),this.extenderRegistry.get(t).reduce((function(t,e){return e.extend(t)}),e)},t}(),Ki=function(){function t(t){this.handlerFactory=t,this.executingCommands=[],this.executingCommandCount$=new e.BehaviorSubject(this.executingCommands.length)}return t.prototype.dispatch=function(t){var n=this,i=new e.Subject;return this.executeCommand(t).subscribe({next:function(t){i.next(t),i.complete()},complete:function(){i.complete(),n.removeCommandFromExecutingQueue(t)},error:function(e){i.error(e),n.removeCommandFromExecutingQueue(t)}}),i},t.prototype.executeCommand=function(t){this.addCommandToExecutingQueue(t);var e=t.name;return this.handlerFactory.create(e).execute(t)},t.prototype.addCommandToExecutingQueue=function(t){this.executingCommands.push(t),this.executingCommandCount$.next(this.executingCommands.length)},t.prototype.removeCommandFromExecutingQueue=function(t){this.executingCommands=this.executingCommands.filter((function(e){return e!==t})),this.executingCommandCount$.next(this.executingCommands.length)},t}(),Ui=[{provide:_i,useClass:_i,deps:[A]},{provide:ki,useClass:ki,deps:[A]},{provide:Hi,useClass:Hi,deps:[_i,ki,Se]},{provide:Ki,useClass:Ki,deps:[Hi]}];t.ACTION_METHOD_META="ActionMethodMeta",t.ANNOTATIONS=tt,t.APP_VARIABLE_PROVIDERS=Di,t.ASSIGNER_TOKEN=ni,t.ActionMethodMeta=Ue,t.App=Mi,t.AppContext=Te,t.AppOptions=be,t.ArrayStringValueConverter=We,t.ArrayUtil=Ot,t.BACK_END_MESSAGE_HANDLER_TOKEN=yn,t.BigNumberType="BigNumber",t.BindingData=Lt,t.BindingDataAppendObjectEventHandler=Xn,t.BindingDataChangeListener=Vn,t.BindingDataFactory=Ht,t.BindingDataLoadEventHandler=ti,t.BindingDataManager=xe,t.BindingDataRemoveObjectEventHandler=Qn,t.BindingDataSelectionChangedEventHandler=ei,t.BindingDataValueChangeEventHandler=Zn,t.BindingList=kt,t.BindingListFactory=At,t.BindingObject=Vt,t.BindingObjectFactory=_t,t.BindingPathComparer=Nt,t.BindingPathConverter=Dt,t.BindingPathTraverser=Rt,t.BindingValueAccessorFactory=Xe,t.BoolUtil=Pt,t.COMMAND_HANDLERS_TOKEN=Ai,t.COMMAND_HANDLER_EXTENDERS_TOKEN=Li,t.COMMAND_HANDLER_EXTENDER_META="CommandHandlerExtenderMeta",t.COMMAND_HANDLER_META="CommandHandlerMeta",t.COMMAND_METHOD_META="CommandMethodMeta",t.CONTROLSTATE_PROP_META="ControlStatePropMeta",t.CONTROL_STATE_INTERCEPTOR_TOKEN=Ne,t.ChangeSet=yt,t.CommandBus=Ki,t.CommandContext=Bi,t.CommandHandler=Vi,t.CommandHandlerExtender=Fi,t.CommandHandlerExtenderMeta=function(t){return it("CommandHandlerExtenderMeta",(function(t){return t}))(t)},t.CommandHandlerExtenderRegistry=ki,t.CommandHandlerFactory=Hi,t.CommandHandlerMeta=function(t){return it("CommandHandlerMeta",(function(t){return t}))(t)},t.CommandHandlerRegistry=_i,t.CommandMethodMeta=nn,t.CommandVariableParser=Oi,t.CommentDependencyResolver=cn,t.Context=Ie,t.ControlStateInterceptorService=Ae,t.ControlStatePropMeta=Oe,t.ControlsProxy=vi,t.Core=fn,t.DYNAMIC_PROP_META="DynamicPropMeta",t.DataPath=mt,t.DataPathCreator=ne,t.DataPathNode=vt,t.DataPathUtil=Gt,t.DataPropInfo=Et,t.DataTypeInfo=ee,t.DataVariableParser=wi,t.DateStringValueConverter=Je,t.DateUtil=St,t.DefaultRepository=ve,t.DependencyEffector=di,t.DynamicEntity=le,t.DynamicPropMeta=Xt,t.EFFECTOR_TOKEN=In,t.ENTITY_META="EntityMeta",t.ENTITY_TEMPLATE="ENTITY~",t.EVENT_HANDLER_TOKEN=ii,t.EXCEPTION_HANDLER="@farris/devkit ExceptionHandler",t.EffectorFactory=yi,t.EffectorRegistry=Sn,t.Entity=ce,t.EntityBindingValueAccessor=Ye,t.EntityCollection=he,t.EntityDependencyResolver=sn,t.EntityFactory=se,t.EntityList=pe,t.EntityManager=fe,t.EntityMeta=function(t){return it("EntityMeta",(function(t){return t}))(t)},t.EntityMetadataUtil=te,t.EntityPathComparer=Ut,t.EntityPathConverter=Kt,t.EntityUpdateEventHandler=$n,t.EntityUtil=Ft,t.EntityValueChangedEventHandler=qn,t.EnumUtil=Mt,t.EnvUtil=Wt,t.EventHandler=Un,t.EventHandlerRegistry=ri,t.ExpressionEngineImpl=oi,t.ExpressionEventEmitter=_n,t.ExpressionExecutor=Kn,t.ExpressionManager=si,t.ExpressionRegistry=Hn,t.ExpressionResult=ai,t.ExpressionResultFactory=pi,t.ExpressionUtil=hn,t.FORM_CONTROL_PROP_META="FormControlPropMeta",t.FORM_EXPRESSION_MANIFEST_SERVICE_TOKEN=kn,t.FORM_MANIFEST_SERVICE_TOKEN=Ln,t.FORM_PATH_TOKEN=dn,t.FieldMetadataUtil=Qt,t.Form=en,t.FormControl=tn,t.FormControlPropMeta=Ze,t.FormPathConverter=qt,t.GROUP_FUNCTIONS=on,t.Guid=zt,t.HTTP_PROVIDERS=lt,t.HttpClient=ct,t.HttpMethods=pt,t.HttpUtil=ut,t.INJECTOR=H,t.INJECTOR_IMPL=Z,t.INJECTOR_IMPL__PRE_R3__=X,t.INJECTOR_SCOPE=W,t.InitContext=Re,t.InjectionToken=B,t.Injector=A,t.InterceptContext=Be,t.LISTENER_TOKEN=On,t.LIST_PROP_META="ListPropMeta",t.ListPropMeta=Zt,t.ListenerRegistry=Rn,t.Listeners=An,t.MESSAGE_SERVICE_TOKEN=gn,t.MetadataUtil=st,t.Modification=ht,t.NAMESPACE=mn,t.NOTIFY_SERVICE_TOKEN=vn,t.NumberUtil=xt,t.OBJECT_PROP_META="ObjectPropMeta",t.ObjectPropMeta=$t,t.ObjectUtil=jt,t.PARAMETERS=et,t.PARENT_CLASS=re,t.PARENT_PATH=ie,t.PRIMITIVE_PROP_META="PrimitivePropMeta",t.PROP_METADATA=nt,t.PrimitivePropMeta=Ct,t.ProcessContext=Ve,t.PropertyUtil=Bt,t.RENDER_STATE_PROP_META="RenderStatePropMeta",t.REPOSITORY_META="RepositoryMeta",t.RESOLVER_TOKEN=rn,t.ReadonlyEffector=ci,t.RenderStatePropMeta=Ke,t.Repository=ge,t.RepositoryAddEntityEventHandler=Jn,t.RepositoryChangeListener=Nn,t.RepositoryEffector=wn,t.RepositoryLoadEventHandler=Yn,t.RepositoryManager=Pe,t.RepositoryMeta=function(t){return it("RepositoryMeta",(function(t){return t}))(t)},t.RepositoryRemoveEntityEventHandler=Wn,t.RequiredEffector=hi,t.ResolveService=ln,t.ResolverRegistry=an,t.STATE_PROP_META="StatePropMeta",t.STATE_TEMPLATE="STATE~",t.State=ke,t.StateDependencyResolver=un,t.StateMachine=ze,t.StateMachineContext=qe,t.StateMachineVariableParser=Si,t.StatePropMeta=He,t.StateValueChangedEventHandler=zn,t.StaticInjector=z,t.StringUtil=bt,t.TaskFlow=Ri,t.TaskLink=Ni,t.TaskNode=Ee,t.Type=b,t.UISTATE_PROP_META="UIStatePropMeta",t.UIState=Le,t.UIStateBindingValueAccessor=$e,t.UIStateChangeListener=Dn,t.UIStateEffector=Tn,t.UIStateMetadataUtil=De,t.UIStatePropMeta=je,t.UIStateVariableParser=Ti,t.USE_VALUE=U,t.UrlUtil=Yt,t.VALIDATION_RULE_TOKEN=we,t.VARIABLE_PARSERS=Ce,t.VIEW_MODEL_COMMAND_PROVIDERS=Ui,t.VIEW_MODEL_EXPRESSION_PROVIDERS=gi,t.ValidateEffector=li,t.ValidatorFactory=Qe,t.VariableParseService=ji,t.ViewModel=mi,t.ViewModelContext=Se,t.ViewModelContextManager=Me,t.ViewModelOptions=Ei,t.VisibleEffector=fi,t.createEntities=ae,t.createEntity=oe,t.createInjectionToken=V,t.createInjector=Q,t.initialUIState=!1,t.isObservable=Jt,t.isType=function(t){return"function"==typeof t},t.makeDecorator=it,t.makeParamDecorator=function(t,e,n){var i=rt(e);function r(){for(var t,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];if(this instanceof r)return i.apply(this,e),this;var o=new((t=r).bind.apply(t,m([void 0],e)));return a.annotation=o,a;function a(t,e,n){for(var i=t.hasOwnProperty(et)?t[et]:Object.defineProperty(t,et,{value:[]})[et];i.length<=n;)i.push(null);return(i[n]=i[n]||[]).push(o),t}}return n&&(r.prototype=Object.create(n.prototype)),r.prototype.ngMetadataName=t,r.annotationCls=r,r},t.makePropDecorator=ot,t.setCurrentInjector=G,t.ɵ0=K,t.ɵa=O,t.ɵb=A,t.ɵc=V,t.ɵd=Ci,t.ɵe=jn,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=farris-mobile-devkit.umd.min.js.map
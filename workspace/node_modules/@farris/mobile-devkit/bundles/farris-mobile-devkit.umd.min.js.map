{"version":3,"sources":["../../../node_modules/tslib/tslib.es6.js","ng://@farris/mobile-devkit/lib/core/types.ts","ng://@farris/mobile-devkit/lib/core/di/types.ts","ng://@farris/mobile-devkit/lib/core/di/consts.ts","ng://@farris/mobile-devkit/lib/core/di/utils.ts","ng://@farris/mobile-devkit/lib/core/di/injectable_def.ts","ng://@farris/mobile-devkit/lib/core/di/injection_token.ts","ng://@farris/mobile-devkit/lib/core/di/injector.ts","ng://@farris/mobile-devkit/lib/core/di/null_injector.ts","ng://@farris/mobile-devkit/lib/core/di/forward_ref.ts","ng://@farris/mobile-devkit/lib/core/di/static_injector.ts","ng://@farris/mobile-devkit/lib/core/di/injector_creator.ts","ng://@farris/mobile-devkit/lib/core/metadata/decorator.ts","ng://@farris/mobile-devkit/lib/core/metadata/metadata_util.ts","ng://@farris/mobile-devkit/lib/changeset/types.ts","ng://@farris/mobile-devkit/lib/http/types.ts","ng://@farris/mobile-devkit/lib/http/http-util.ts","ng://@farris/mobile-devkit/lib/http/http-client.ts","ng://@farris/mobile-devkit/lib/http/index.ts","ng://@farris/mobile-devkit/lib/changeset/change_set.ts","ng://@farris/mobile-devkit/lib/entity/entity-path/data_path_node.ts","ng://@farris/mobile-devkit/lib/entity/entity-type-info/data_prop_info.ts","ng://@farris/mobile-devkit/lib/entity/entity-path/data_path.ts","ng://@farris/mobile-devkit/lib/entity/metadata/prop_metadata_primitive.ts","ng://@farris/mobile-devkit/lib/utils/string_uitl.ts","ng://@farris/mobile-devkit/lib/utils/number_uitl.ts","ng://@farris/mobile-devkit/lib/utils/bool_util.ts","ng://@farris/mobile-devkit/lib/utils/enum_util.ts","ng://@farris/mobile-devkit/lib/utils/date_util.ts","ng://@farris/mobile-devkit/lib/binding-data/changes.ts","ng://@farris/mobile-devkit/lib/binding-data/binding_property.ts","ng://@farris/mobile-devkit/lib/utils/array_util.ts","ng://@farris/mobile-devkit/lib/utils/object_util.ts","ng://@farris/mobile-devkit/lib/utils/data-path/binding_path_converter.ts","ng://@farris/mobile-devkit/lib/utils/data-path/binding_path_comparer.ts","ng://@farris/mobile-devkit/lib/utils/data-path/binding_path_traverser.ts","ng://@farris/mobile-devkit/lib/binding-data/property_util.ts","ng://@farris/mobile-devkit/lib/binding-data/binding_object.ts","ng://@farris/mobile-devkit/lib/binding-data/binding_list_factory.ts","ng://@farris/mobile-devkit/lib/binding-data/binding_object_factory.ts","ng://@farris/mobile-devkit/lib/binding-data/entity_util.ts","ng://@farris/mobile-devkit/lib/binding-data/binding_data.ts","ng://@farris/mobile-devkit/lib/binding-data/binding_list.ts","ng://@farris/mobile-devkit/lib/binding-data/binding_data_factory.ts","ng://@farris/mobile-devkit/lib/utils/data-path/entity_path_converter.ts","ng://@farris/mobile-devkit/lib/utils/data-path/entity_path_comparer.ts","ng://@farris/mobile-devkit/lib/utils/data-path/form_path_converter.ts","ng://@farris/mobile-devkit/lib/utils/data-path-util.ts","ng://@farris/mobile-devkit/lib/utils/guid.ts","ng://@farris/mobile-devkit/lib/utils/is-observable.ts","ng://@farris/mobile-devkit/lib/utils/env.util.ts","ng://@farris/mobile-devkit/lib/utils/url_util.ts","ng://@farris/mobile-devkit/lib/entity/metadata/prop_meatadata_object.ts","ng://@farris/mobile-devkit/lib/entity/metadata/prop_metadata_dynamic.ts","ng://@farris/mobile-devkit/lib/entity/metadata/prop_metadata_list.ts","ng://@farris/mobile-devkit/lib/entity/metadata/field_metadata_util.ts","ng://@farris/mobile-devkit/lib/entity/metadata/entity_metadata_util.ts","ng://@farris/mobile-devkit/lib/entity/metadata/entity_decorator.ts","ng://@farris/mobile-devkit/lib/entity/entity-type-info/data_type_info.ts","ng://@farris/mobile-devkit/lib/entity/entity-path/data_path_creator.ts","ng://@farris/mobile-devkit/lib/entity/types.ts","ng://@farris/mobile-devkit/lib/entity/entity_creator.ts","ng://@farris/mobile-devkit/lib/entity/entity_list.ts","ng://@farris/mobile-devkit/lib/entity/entity_factory.ts","ng://@farris/mobile-devkit/lib/entity/entity.ts","ng://@farris/mobile-devkit/lib/entity/dynamic_entity.ts","ng://@farris/mobile-devkit/lib/repository/entity_collection.ts","ng://@farris/mobile-devkit/lib/repository/entity_manager.ts","ng://@farris/mobile-devkit/lib/repository/pagination_manager.ts","ng://@farris/mobile-devkit/lib/repository/data_change_history.ts","ng://@farris/mobile-devkit/lib/repository/repository.ts","ng://@farris/mobile-devkit/lib/repository/default_repository.ts","ng://@farris/mobile-devkit/lib/command/flow/task_node.ts","ng://@farris/mobile-devkit/lib/form/types.ts","ng://@farris/mobile-devkit/lib/variable/variable_parser.ts","ng://@farris/mobile-devkit/lib/app/types.ts","ng://@farris/mobile-devkit/lib/app/binding_data_manager.ts","ng://@farris/mobile-devkit/lib/app/repository_mananger.ts","ng://@farris/mobile-devkit/lib/app/view_model_contex_manager.ts","ng://@farris/mobile-devkit/lib/context/context.ts","ng://@farris/mobile-devkit/lib/app/tokens.ts","ng://@farris/mobile-devkit/lib/app/app_context.ts","ng://@farris/mobile-devkit/lib/view-model/view_model_context.ts","ng://@farris/mobile-devkit/lib/ui-state/control_decorators.ts","ng://@farris/mobile-devkit/lib/ui-state/decorators.ts","ng://@farris/mobile-devkit/lib/ui-state/uistate_metadata_util.ts","ng://@farris/mobile-devkit/lib/ui-state/control-state/control_state_interceptor.ts","ng://@farris/mobile-devkit/lib/ui-state/control-state/control_state_interceptor.service.ts","ng://@farris/mobile-devkit/lib/ui-state/control-state/control_state_updater.ts","ng://@farris/mobile-devkit/lib/ui-state/control-state/control_state_listener.ts","ng://@farris/mobile-devkit/lib/ui-state/ui_state.ts","ng://@farris/mobile-devkit/lib/state-machine/types.ts","ng://@farris/mobile-devkit/lib/state-machine/metadata/state_metadata.ts","ng://@farris/mobile-devkit/lib/state-machine/metadata/render_state_metadata.ts","ng://@farris/mobile-devkit/lib/state-machine/metadata/action_metadata.ts","ng://@farris/mobile-devkit/lib/state-machine/state_machine_context.ts","ng://@farris/mobile-devkit/lib/state-machine/state_machine_watcher.ts","ng://@farris/mobile-devkit/lib/state-machine/state_machine.ts","ng://@farris/mobile-devkit/lib/form/binding_value_converter.ts","ng://@farris/mobile-devkit/lib/form/binding_value_accessor.ts","ng://@farris/mobile-devkit/lib/form/decorators.ts","ng://@farris/mobile-devkit/lib/validator/validator.ts","ng://@farris/mobile-devkit/lib/form/form_control.ts","ng://@farris/mobile-devkit/lib/form/form.ts","ng://@farris/mobile-devkit/lib/view-model/decorators.ts","ng://@farris/mobile-devkit/lib/expression/resolver/types.ts","ng://@farris/mobile-devkit/lib/expression/resolver/resolver_registry.ts","ng://@farris/mobile-devkit/lib/expression/resolver/entity_dependency_resolver.ts","ng://@farris/mobile-devkit/lib/expression/resolver/state_dependency_resolver.ts","ng://@farris/mobile-devkit/lib/expression/resolver/comment_dependency_resolver.ts","ng://@farris/mobile-devkit/lib/expression/resolver/resolve_service.ts","ng://@farris/mobile-devkit/lib/expression/utils/expression_util.ts","ng://@farris/mobile-devkit/lib/expression/core/core.ts","ng://@farris/mobile-devkit/lib/expression/core/tokens.ts","ng://@farris/mobile-devkit/lib/expression/core/types.ts","ng://@farris/mobile-devkit/lib/expression/expression/types.ts","ng://@farris/mobile-devkit/lib/expression/effector/tokens.ts","ng://@farris/mobile-devkit/lib/expression/effector/repository_effector.ts","ng://@farris/mobile-devkit/lib/expression/effector/uistate_effector.ts","ng://@farris/mobile-devkit/lib/expression/effector/effector_registry.ts","ng://@farris/mobile-devkit/lib/expression/listener/tokens.ts","ng://@farris/mobile-devkit/lib/expression/listener/change_listener.ts","ng://@farris/mobile-devkit/lib/expression/listener/ui_state_change_listener.ts","ng://@farris/mobile-devkit/lib/expression/listener/repository_change_listener.ts","ng://@farris/mobile-devkit/lib/expression/listener/listener_registry.ts","ng://@farris/mobile-devkit/lib/expression/listener/binding_data_change_listener.ts","ng://@farris/mobile-devkit/lib/expression/listener/listeners.ts","ng://@farris/mobile-devkit/lib/expression/expression/expression_event_emitter.ts","ng://@farris/mobile-devkit/lib/i18n/translate_token.ts","ng://@farris/mobile-devkit/lib/expression/manifest/tokens.ts","ng://@farris/mobile-devkit/lib/expression/expression/expression_registry.ts","ng://@farris/mobile-devkit/lib/expression/expression/expression_executor.ts","ng://@farris/mobile-devkit/lib/expression/event-handler/event_handler.ts","ng://@farris/mobile-devkit/lib/expression/event-handler/entity_value_changed_event_handler.ts","ng://@farris/mobile-devkit/lib/expression/effector/effector_manager.ts","ng://@farris/mobile-devkit/lib/expression/event-handler/state_value_changed_event_handler.ts","ng://@farris/mobile-devkit/lib/expression/event-handler/repository_add_entity_event_handler.ts","ng://@farris/mobile-devkit/lib/expression/event-handler/repository_remove_entity_event_handler.ts","ng://@farris/mobile-devkit/lib/expression/event-handler/repository_load_event_handler.ts","ng://@farris/mobile-devkit/lib/expression/event-handler/entity_update_event_handler.ts","ng://@farris/mobile-devkit/lib/expression/event-handler/binding_data_append_object_event_handler.ts","ng://@farris/mobile-devkit/lib/expression/event-handler/binding_data_value_change_event_handler.ts","ng://@farris/mobile-devkit/lib/expression/event-handler/binding_data_remove_object_event_handler.ts","ng://@farris/mobile-devkit/lib/expression/event-handler/binding_data_load_event_handler.ts","ng://@farris/mobile-devkit/lib/expression/event-handler/binding_data_selection_changed_event_handler.ts","ng://@farris/mobile-devkit/lib/expression/expression/tokens.ts","ng://@farris/mobile-devkit/lib/expression/event-handler/event_handler_registry.ts","ng://@farris/mobile-devkit/lib/expression/expression/expression_engine_impl.ts","ng://@farris/mobile-devkit/lib/expression/expression/expression_result.ts","ng://@farris/mobile-devkit/lib/expression/expression/expression_manager.ts","ng://@farris/mobile-devkit/lib/expression/expression/expression_result_factory.ts","ng://@farris/mobile-devkit/lib/expression/effector/util.ts","ng://@farris/mobile-devkit/lib/expression/effector/effector_readonly.ts","ng://@farris/mobile-devkit/lib/expression/effector/effector_validate.ts","ng://@farris/mobile-devkit/lib/expression/effector/effector_required.ts","ng://@farris/mobile-devkit/lib/expression/effector/effector_visible.ts","ng://@farris/mobile-devkit/lib/expression/effector/effector_dependency.ts","ng://@farris/mobile-devkit/lib/expression/effector/effector_factory.ts","ng://@farris/mobile-devkit/lib/expression/providers.ts","ng://@farris/mobile-devkit/lib/control-proxy/control-proxy.ts","ng://@farris/mobile-devkit/lib/view-model/view_model.ts","ng://@farris/mobile-devkit/lib/view-model/types.ts","ng://@farris/mobile-devkit/lib/app/app_eventBus.ts","ng://@farris/mobile-devkit/lib/app/providers.ts","ng://@farris/mobile-devkit/lib/ui-state/control-state/providers.ts","ng://@farris/mobile-devkit/lib/app/app.ts","ng://@farris/mobile-devkit/lib/variable/parse_util.ts","ng://@farris/mobile-devkit/lib/variable/data_variable_parser.ts","ng://@farris/mobile-devkit/lib/variable/ui_state_variable_parser.ts","ng://@farris/mobile-devkit/lib/variable/state_machine_variable_parser.ts","ng://@farris/mobile-devkit/lib/variable/command_variable_parser.ts","ng://@farris/mobile-devkit/lib/variable/variable_parse_service.ts","ng://@farris/mobile-devkit/lib/variable/providers.ts","ng://@farris/mobile-devkit/lib/command/flow/task_link.ts","ng://@farris/mobile-devkit/lib/command/flow/task_flow.ts","ng://@farris/mobile-devkit/lib/command/command_context.ts","ng://@farris/mobile-devkit/lib/command/command_handler.ts","ng://@farris/mobile-devkit/lib/command/command_handler_registry.ts","ng://@farris/mobile-devkit/lib/command/decorators.ts","ng://@farris/mobile-devkit/lib/command/command_handler_extender.ts","ng://@farris/mobile-devkit/lib/command/command_handler_extender_registry.ts","ng://@farris/mobile-devkit/lib/command/command_handler_factory.ts","ng://@farris/mobile-devkit/lib/command/command_bus.ts","ng://@farris/mobile-devkit/lib/command/providers.ts","ng://@farris/mobile-devkit/lib/exception/tokens.ts","ng://@farris/mobile-devkit/lib/repository/decorators.ts"],"names":["extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__extends","__","this","constructor","prototype","create","__assign","assign","t","s","i","n","arguments","length","call","apply","__generator","thisArg","body","f","y","g","_","label","sent","trys","ops","next","verb","throw","return","Symbol","iterator","v","op","TypeError","done","value","pop","push","e","step","__values","o","m","__read","r","ar","error","__spread","concat","DataChangeType","InjectFlags","Type","Function","EMPTY","IDENT","CIRCULAR","MULTI_PROVIDER_FN","slice","NEW_LINE","THROW_IF_NOT_FOUND","stringify","token","isArray","map","join","overriddenName","name","res","toString","newLineIndex","indexOf","substring","getClosureSafeProperty","objWithPropertyToExtract","key","Error","staticError","text","obj","injectorErrorName","source","charAt","substr","context","parts","JSON","replace","formatError","NG_PROV_DEF","ɵprov","NG_INJECTABLE_DEF","ɵinj","ngInjectableDef","getOwnDefinition","type","def","InjectionToken","_desc","options","opts","ngMetadataName","undefined","__NG_ELEMENT_ID__","providedIn","factory","createInjectionToken","Injector","NULL_INJECTOR","NullInjector","get","notFoundValue","__forward_ref__","resolveForwardRef","fn","forwardRef","forwardRefFn","INJECTOR","USE_VALUE","provide","String","useValue","ɵ0","_currentInjector","setCurrentInjector","injector","former","StaticInjector","providers","parent","records","_records","Map","set","deps","useNew","scope","recursivelyProcessProviders","provider","resolvedProvider","resolveProvider","multi","multiProvider","multiProviderMixError","record","INJECTOR_SCOPE","flags","Default","injectableDef","useFactory","lastInjector","tryResolveToken","tokens","forEach","providerDeps","useExisting","computeDeps","useClass","SkipSelf","Self","Optional","NO_NEW_LINE","depRecords","depRecord","childRecord","_a","bind","resolveToken","unshift","INJECTOR_IMPL__PRE_R3__","INJECTOR_IMPL","createInjector","ANNOTATIONS","PARAMETERS","PROP_METADATA","makeDecorator","props","parentClass","chainFn","typeFn","metaCtor","makeMetadataCtor","DecoratorFactory","args","_i","annotationInstance","typeDecorator","cls","defineProperty","annotationCls","values","propName","makePropDecorator","PropDecoratorFactory","decoratorInstance","target","meta","ModifyType","MetadataUtil","getClassMetadatas","getClassMetadataByName","metadataName","getClassMetadataByNameWithTranslate","translateService","keysToTranslate","allClassMetadatas","metadata","find","classMetadata","metadataPropKey","propertyVariable","startsWith","endsWith","translateKey","trim","transform","getPropsMetadatas","getPropsMetadatasByName","getPropsMetadatasByNameWithTranslate","metadatas","allPropMetadatas","keys","propMetadata","getPropMetadatasByName","getPropMetadataByName","HttpMethods","GET","DELETE","HEAD","OPTIONS","POST","PUT","PATCH","LINK","UNLINK","HttpUtil","appendHeader","headers","appendBodyToRequestConfig","requestConfig","buildAxiosRequestConfig","method","url","params","responseType","data","buildHttpResponse","axiosResponse","status","statusText","HttpClient","axiosInstance","axios","request","post","put","patch","delete","_this","of","pipe","switchMap","axiosRequestConfig","from","httpResponse","observe","HTTP_PROVIDERS","Modification","modifyType","path","preValue","position","isEqual","other","DataPathNodeType","ChangeSet","modifications","append","modification","ValueChange","appendValueChangeModification","Add","Insert","Clone","appendAddModification","Remove","appendRemoveModification","Load","existedModification","findModifyItemsPath","existedAddModification","findNewAddItemsPath","primaryKey","primaryKeyValue","addModification","filter","addDataItem","fullRemovePath","valueModification","valueChangePath","removeDescendantRemoveModifications","clear","index","parentRemoveModification","parentPathWithId","createRemovePathWithId","descendantPathWithId","isDescendantPath","parentPath","descendantPath","parentPathItem","parentPathItemIndex","DataPropGroup","DataPathNode","prev","DataPath","head","newNode","tailNode","getTail","lastNode","toArray","pathArray","currentNode","clone","newDataPath","curDataNode","DataPropInfo","PrimitivePropMeta","primary","foreign","Boolean","dataField","StringUtil","format","maxLenght","prefix","_b","suffix","_c","ellipsis","filterSearchValue","c","<",">","&","\"","re","RegExp","style","NumberUtil","decimals","precision","decimalPoint","decimal","thousandsSep","thousand","prefixType","prefixFunc","sourceData","prec","k","Math","pow","parseFloat","round","toFixed","split","pattern","test","formatedValue","BoolUtil","EnumUtil","separator","enumOptions","enumData","valueArry","item","targetEnumOption","enumOption","console","dayjs","locale","ChangeType","ViewChangeType","BindingPropertyType","DateUtil","formatISO","dateOrDateString","isEmptyDateOrDateString","emptyISODateTimeString","dateObj","parse","defaultISOFormat","dateFormat","defaultDisplayFormat","dateShow","dateOperation","option","relativeTime","extend","fromNow","isToday","todayDate","Date","isSame","calendar","Calendar","sameDay","nextDay","lastDay","sameElse","isDate","parseISO","date","isEmptyDate","isEmptyDateString","dateString","dateOrDateString1","dateOrDateString2","dateObj1","dateObj2","compare","compareAsc","currentDate","targetDate","isBefore","isAfter","isBetween","targetDate1","targetDate2","contains","IsBetween","emptyDateTimeString","defaultDateFormat","defaultTimeFormat","ArrayUtil","remove","arr","itemToRemove","indexToRemove","findIndex","removeByIndex","splice","ObjectUtil","isPlainObject","getPrototypeOf","proto","BindingPathConverter","toBindingPathArray","bindingPath","part","toBindingPathString","bindingPathArray","BindingPathComparer","srcPath","dstPath","srcPathArray","dstPathArray","every","srcPathItem","srcPathIndex","isParent","childPath","childPathArray","parentPathArray","isAncestor","ancestorPath","descendantPathArray","ancestorPathArray","ancestorPathItem","ancestorPathIndex","BindingPathTraverser","getLeafPathString","getParentPathString","PropertyUtil","getProperties","entityType","properties","ngFieldProperties","FieldMetadataUtil","getNgFields","propertyName","ngFieldProperty","Plain","isPrimaryKey","isForeignKey","enableMultiLangInput","ngObjectProperties","getNgObjects","ngObjectProperty","ngListProperties","getNgList","ngListProperty","List","ngDynamicProperties","getNgDynamic","ngDynamicProperty","Dynamic","getDynamicProperties","dynamicData","getPropertyByName","property","getPrimaryKey","primaryProperty","BindingObject","isShowValidationMsg","controlMap","innerValues","changes","Subject","viewChanges","getValue","setShowValidationMsg","flag","setValue","propertyValue","emitEventToView","emitEventToEntity","errors","invokeOnValueChange","oldPropertyValue","entityChanged","subscribe","result","viewChange","ValueChanged","id","toJSON","langCode","window","localStorage","getItem","list","object","ignoreMultiLangInput","multiLangValueObj","BindingListFactory","bindingProperties","bindingList","BindingList","extendProperties","bindingProperty","currentItem","BindingObjectFactory","createDynamicBindingObject","extendListProperty","extendObjectProperty","extendDynamicObjectProperty","extendPlainProperty","childListProperties","childList","change","childObjectProperties","childObject","attachDynamicObjectProperty","dynamicObject","EntityUtil","loadEntity","entity","bindingObject","loadEntityList","PARENT_CLASS","setUpEntityPipeline","onValueChanged","primaryKeyPath","parentId","findId","pathData","getPaths","paths","isUdt","isGrid","shift","entityList","loadEntities","items","setUpEntityListPipeline","onListChanged","appendEntities","insertEntity","removeByIds","entities","loadRepository","repository","entityCollection","entityCollectionChange","entityCreate","AddData","addData","removeEntities","RemoveData","removeData","PaginationInfoChange","paginationInfo","bindingObjects","createBindingObjects","load","isCloned","createBindingObject","insert","ids","removeDataByIds","watchReposiroty","bindingData","pagingInfo","getPropInfo","targetPropName","propType","propEntityType","primaryNgFiledProp","getPrimaryFieldMetadata","isObjectProp","isDynamicProp","appendInitialData","initialData","parentID","BindingData","viewModelContext","viewModel","firePagingChangeEvent","setPagingInfo","skip","take","pageSize","pageIndex","pagingInfo_1","setValueChangeInvokerFactory","valueChangeInvokerFactory","init","initByRepository","dataTypeInfo","entityTypeInfo","initByBindingList","parentPaths","clearValue","initValue","propInfo","getPropInfoByPath","metadataInfo","getList","getObject","getPath","bindingPaths","currentId","getInitValueByPaths","_paginationInfo","innerList","sPaginationInfo","total","totalCount","setPaginationInfo","findById","emptyCurrentItem","self","size","objects","add","firstId","setCurrentId","lastId","Append","nextCurrentId","getCurrentIdBeforeDeleting","getIndexById","nextIndex","currentIndex","getIdByIndex","emitEvent","emitGlobalEvent","SelectionChanged","GlobalSelectionChanged","swapById","id1","id2","getPaginationConfigByPath","defaultValue","config","sortBy","fields","directions","arrFields","arrDirections","orders","sort","item1","item2","props_1","tslib_1.__values","props_1_1","prop","order","includes","isMultiLangProp","currentLanguage","props_2","props_2_1","BindingDataFactory","createFromRepository","BindingPropertyUtil","EntityLoadUtil","createFromEntityManager","entityManager","getEntitiesByPath","createFromExistingBindingData","existingBindingData","EntityPathConverter","toEntityPathArray","bindingPathString","entityPathArray","currentBindingObject","createPrimaryKeyPath","currentBindingList","EntityPathComparer","FormPathConverter","formPahtString","DataPathUtil","convertToBindingPathArray","convertToEntityPathArray","convertToRestUrl","restPathArray","getLeafPath","getParentPath","Guid","guid","isGuid","validator","gen","createEmpty","raw","count","out","random","equals","isEmpty","isObservable","observable","Observable","EnvUtil","isInWf","top","location","pathname","UrlUtil","getParams","urlParts","keyValueString","keyValue","ObjectPropMeta","DynamicPropMeta","ListPropMeta","getNgField","getDataField","ngFieldObj","propMeta","primaryNgField","EntityMetadataUtil","getAllNgProperties","ngPlainProperties","getNgFieldProperties","ngEntityProperties","getNgObjectProperties","getNgDynamicProperties","ngEntityListProperties","getNgEntityMatadata","getNgListProperties","getPrimaryKeyProperty","primaryKeyProperty","ngProperty","DataTypeInfo","foreignKey","propInfoMap","collectEntityInfos","collectPropInfos","getPropInfos","getPropNames","propNames","getPropInfosByGroup","group","getPropNamesByGroup","getPropInfoByName","has","arrPath","typeInfo","getTypeInfoByPath","getPrimaryKeyPropInfo","getPropMappingByName","mapping","getPropMappingByPath","checkPropGroup","propGroup","entityMetadata","entityInfo","addPropInfo","Primitive","DataPathCreator","createByLongPathFromRoot","fullPathArrayOrString","dataPath","fullPathArray","currentNodeInfo","nodeValue","nodeType","DataId","nextNodeValue","getNextPathNodeInfo","parentNodeInfo","parentNodeValue","parentNodeType","parentEntityTypeInfo","nextPathNodeInfo","PropName","nextPropInfo","createByShortPathFromRoot","shortPathArrayOrString","shortPathArray","currentEntityTypeInfo","PARENT_PATH","createEntity","entityData","createEntities","entityListData","EntityFactory","T","EntityList","__type__","originalData","listChanged","changeSet","asObservable","initEntity","rawData","changeItem","setChanges","appendNew","newEntity","appendEntity","primaryId","primaryValue","entityToRemove","updateIndex","modinfo","Entity","sum","reduce","val","curr","toJson","isNewEntity","subChanges","changeSetValue","getPropertyName","validErrors","isValidating","newData","valueChanged","hasChange","initialize","pathObj","handleParent","reverse","loadFields","loadLists","loadObjects","loadDynamicObjects","ngFields","ngObjects","ngDynamics","ngLists","ngDynamic","initializeNormalField","initializeList","initializeObject","initializeDynamic","createPath","primaryFieldMetadata","ngField","getPropValue","newPropValue","oldPropValue","isPropValueChanged","setPropValue","emitValueChange","configurable","ngListMetadata","fieldMetadata","ngObjectMetadata","createEntityFromJsonData","instance","childEntity","modifyInfo","ngDynamicMetadata","dynamicEntity","ngList","listData","objectData","ngDynamicObjects","loadDynamicData","originDataField","propValue","isEmptyMultiLangPropValue","DynamicEntity","_super","tslib_1.__extends","initializeDynamicField","path_1","dynamicEntity_1","createDynamicEntityFromJsonData","oldValue","parentModification","EntityCollection","innerEntitySet","Set","innerEntityMap","collectionChanged","notifyCollectionChanged","reset","isReset","listenEntityChangeEvent","addEntity","verifyEntityToAdd","updateEntity","Update","addEntities","entitiesToAdd","getEntityById","identity","getEntityByPath","rootEntityId","parentNode","currentPath","getEntities","predicate","getAllEntities","removeEntityById","verifyEntityToRemove","removeEntitiesByIds","entitiesToRemove","resetEntities","entityPrimaryKey","entityId","_d","element","original","updatePaginationInfoByPath","pageInfo","setPaginationConfigByPath","match","current","abs","EntityManager","createEntitiesByPath","fPath","childEntityList","subPaths","fid","parentEntity","getEntityNodeByPath","entityCollectionOrList","entityNode","pathNode","getPropValueByPath","setPropValueByPath","insertEntityBeforeByPath","fpath","insertEntitiesBeforeByPath","insertEntityAfterByPath","insertEntitiesAfterByPath","appendEntityByPath","insertEntityByPath","appendEntitiesByPath","removeEntityByPath","removeEntitiesByPath","clearAllEntityChanges","resetAllEntityChangeMark","clearEntityChangesById","clearEntityChangesByIds","checkAllEntityChanges","some","checkEntityChangesById","clearEntityChangesByArray","idArray","PaginationManager","paginationConfig","expandMainEntityConfig","deleteMainEntityConfig","entityName","entityConfig","defaultPageSize","getChilds","objectType","listProperties","itemTypeName","child","childs","DataChangeHistory","history","cacheData","addChange","dataChange","changeType","addChanges","clearByIds","dataId","ids_1","ids_1_1","isChanged","clearCache","getCacheData","onAddData","onEditData","onAppendData","onDeleteData","Repository","dataChangeHistory","buildEntity","buildEntities","setPaginationConfig","paginationManager","pagination","DefaultRepository","BindingType","TaskNode","func","execute","VARIABLE_PARSERS","BindingDataManager","bindingDataMap","getBindingDataMap","getBindingDataByName","regBindingData","ifBindingDataExits","RepositoryManager","repositoryMap","regRepository","getRepositoryMap","getRepositories","getRepositoryByName","ifRepositoryExits","ViewModelContextManager","contextMap","contextSet","regContext","unregContext","getContextMap","getContexts","getContextsByNamespace","namespace","getContextById","getRootContext","getRootContextAndPosterityById","viewModelId","targetContext","contexts","contextsGroup","RootId","getContextsGroupRoot","Context","getParam","setParam","VALIDATION_RULE_TOKEN","AppContext","eventBus","repositoryManager","bindingDataManager","viewModelContextManager","validationManager","validationRule","regViewModelContext","repositoryName","ViewModelContext","innerViewModel","appContext","regToTree","regToAppContext","parentInjector","root","uiState","stateMachine","form","commandBus","expressionEngineImpl","expressionManager","expressionResult","controlsProxy","getVirtualRootFrameContext","registerExtendCommand","commandName","commandHandler","ControlStatePropMeta","UIStatePropMeta","UIStateMetadataUtil","getUIFields","getControlFields","CONTROL_STATE_INTERCEPTOR_TOKEN","InitContext","InterceptContext","ProcessContext","ControlStateInterceptorService","controlInterceptors","inits","initContext","processContext","getProcessContext","controlInterceptor","initFunc","$result","forkJoin","shareReplay","intercept","interceptContext","iframe","document","querySelector","src","queryParams","uiStateInProcess","UIStateInProcess","formConfigId","ControlStateUpdater","controlStateInterceptorService","updateControlState","controlFields","variableNames","beforeUpdate","variableName","originalValue","update","lintenerType","field","needUpdate","computeOriginalValue","controlState","afterUpdate","currentEntityData","renderStates","eval","expr","scopeNames","getOwnPropertyNames","scopeVariable","valueOf","updateRequired","controlInfo","formControl","getFormValueByBindPath","form_name","addValidate","pushValidatorFnforRequired","constraints","message","required","getValidatorFn","resetValidatorFnforRequired","validationResult","passing","ControlStateListener","subscriptionsMap","controlStateUpdater","register","registerBindingDataLintener","registerUIStateLintener","registerStateMachineLintener","registerFormLintener","subscription","stateChange","UIState","innerData","_init","construct","uiFields","initializeUIField","initializeControlField","controlStateListener","uiFieldMetadata","uiField","stateName","controlFieldMetadata","isExistProperty","setPropertyValue","State","StatePropMeta","RenderStatePropMeta","ActionMethodMeta","action","StateMachineContext","initialState","state","frameContext","parser","VariableParseService","stateMachineWatcher","transitTo","nextState","states","render","getUIState","expression","getViewModelContext","subscribeUIStateChange","getData","subscribeEntityChange","StateMachineWatcher","uiStatePathList","dataStatePathList","viewModelContextAndUIStatePathsMap","viewModelContextAndDataStatePathsMap","extractPaths","uiStatePath","getStatePath","uiStateChange","dataPathList","isAccordingPath","dataStatePaths","dataStatePath","uiStateVariables","dataVariables","UI_STATE_PATTERN_1","uiStateVariable","pathMatches","DATA_PATTERN_1","dataVariable","StateMachine","handlePropMetadatas","BehaviorSubject","propsMetadatas","handlePropMetadata","buildState","buildRenderState","buildAction","ngState","renderStateName","ngRenderState","renders","actionName","ngAction","nextStateName","stateRender","DateStringValueConverter","convertFrom","convertTo","ArrayStringValueConverter","arrString","EntityBindingValueAccessor","valueConverter","bindingPathSegments","getBindingPathSegments","stateValue","controlValue","oldStateValue","isDateConverter","parentPathSegments","converter","UIStateBindingValueAccessor","getUiStateBindingPath","search","BindingValueAccessorFactory","bindingType","bindingBindingPath","bindingValueConverter","EntityState","FormControlPropMeta","ValidatorFactory","validRules","validatorFn","validRule","initValidRuleFn","condition","constraintsTemp","regexStr","message_1","validate","executeValidator","noSupportAsynExecuteValidator","FormControl","requiredExpressionFlag","validateExpressionFlag","readonly","visible","validRules_validates","valueAccessor","setValidatorFn","getValidRules","pushValidatorFnforValidate","Form","formControlConfigs","validateformControls","validateformControlPathMap","collectMetadatas","createFormControls","formControlConfig","getValidateformControls","setValidateformControls","getValidateformControlPathMap","setValidateformControlPathMap","validateFields","result$","tap","noSupportAsynValidateFields","getFieldError","getFieldErrorByPath","pathName","resetFieldsValidate","sb_1","x","formControlMetadatas","formControlMetadata","valueChanging","getEntityValueChangingListeners","listeners","getEntityValueChangedListeners","CommandMethodMeta","RESOLVER_TOKEN","GROUP_FUNCTIONS","resolvers","EntityDependencyResolver","resolve","groupFunctionDependencies","ExpressionUtil","getGroupFunctionDependency","entityDependencies","getEntityDependency","dep","merged","getValidEntityPropertyExpression","entityPropertyExpression","propPaths","regex","nodeCode","originalCode","entityPropertyExpressions","convertToNodeCode","warn","CONTEXT_FUNCTIONS","StateDependencyResolver","contextFunctions","argumentsRegex_1","groupFunction","argumentMatchResult","argument","CommentDependencyResolver","dependencies","defineMatchArray","defineString","defineObject","ResolveService","resolverRegistry","ResolverRegistry","commentDependencyResolver","resolver","commentDependencies","dependency","groupFunctionRegex","groupFunctions","entityExpression","nodeCodes","entityExpressions","nextNodeCode","nextNodeCodePropInfo","dataPropInfo","getChildrenEntityPaths","results","childrens","getCurrentRowByPaths","getAvailableChildrenPathsFromEntityPaths","getBindingPath","getEntityPath","Core","optionalParams","logable","log","FORM_PATH_TOKEN","BACK_END_MESSAGE_HANDLER_TOKEN","MESSAGE_SERVICE_TOKEN","NOTIFY_SERVICE_TOKEN","NAMESPACE","BackEndMessage","Level","Message","bizMessages","EffectPath","MessageType","EventSource","ExpressionType","ExpressionBindingType","Expression","EFFECTOR_TOKEN","RepositoryEffector","ns","effect","propertyPath","rowId","UIStateEffector","effectors","EventType","MESSAGE","zh-CHS","require","en","zh-CHT","DEPENDENCY_SPLITER","LISTENER_TOKEN","ChangeListener","subject","findEntityPaths","UIStateChangeListener","frameId","registerEvent","buildEventPath","RepositoryChangeListener","eventType","convertEventType","Field","event","BindingDataChangeListener","Listeners","registry","ListenerRegistry","regist","listener","onEvent","ExpressionEventEmitter","events","eventArgs","observers","attach","TranslateToken","FORM_MANIFEST_SERVICE_TOKEN","FORM_EXPRESSION_MANIFEST_SERVICE_TOKEN","ExpressionRegistry","_expressions","formExpressionManifestService","translate","describe","expressions","setExpressions","cleanSpecialCharacters","catchError","exprs","expressionObject","messageType","Required","Validate","getExpressionMessage","getExpressionById","expressionType","getCurrentLanguage","replacer","replaceAll","ExpressionExecutor","compile","expressionContext","buildContext","expression_1","ExpressionEngineExpression","ExpressionEngine","ExpressionContext","EventHandler","expressionRegistry","effectorFactory","EffectorFactory","expressionExecutor","ExpressionResult","handleEvent","expressionObjects","dispatch","perform","effectTo","effector","getEffector","effectPaths","effectOptions","expressionId","Readonly","Visible","isValidateOrRequiredExpression","getEntityPathFromEvent","buildEntityPath","cleanEventPath","getEventId","tableCode","propertyIndex","idIndex","buildStateContext","frameContexts","rootFrameContext","uiState_1","buildEntityContext","currentRows","expressionBindingType","childrenEntityPaths","row","object_1","v1","v2","currentRowId","node","userAssignCurrentRow","row_1","__items__","entityContext","entity_1","stateContext","entityCode","entityOriginalNodeCode","buildEffectPath","expressionPaths","currentPaths","propertyInfo","getPathInfo","entityPath","propertyNames","getTablePathsFromEventPaths","getPropertyPathsFromEventPaths","tablePaths","analysis","expressionPathInfo","eventPaths","eventPathInfo","expressionTablePaths","expressionPropertyNames","eventTablePaths","distance","eventFromChildren","eventFromParent","eventPropertyNames","isSameTable","buildCurrentRows","fullPaths","paths_1","EntityValueChangedEventHandler","getCurrentRowByEvent","EffectorManager","StateValueChangedEventHandler","changePaths","eventPath","effectRows","output","callback","prevPaths","currentCurrentRows","flag_1","nextPrevPaths_1","nextBindingPaths","RepositoryAddEntityEventHandler","RepositoryRemoveEntityEventHandler","RepositoryLoadEventHandler","EntityUpdateEventHandler","Compute","Dependency","DataPicking","depPathInfo","eventEntityPath","childrenPaths","BindingDataAppendObjectEventHandler","groupExpressions","info","dependPathInfo","eventTablePaths_1","relativeExpressions","propertyPaths_1","prevPaths_1","BindingDataValueChangeEventHandler","eventEntityPaths","list_1","list_1_1","BindingDataRemoveObjectEventHandler","propertyPaths","BindingDataLoadEventHandler","BindingDataSelectionChangedEventHandler","ENTITY_TEMPLATE","ASSIGNER_TOKEN","EVENT_HANDLER_TOKEN","EventHandlerRegistry","handlers","handler","ExpressionEngineImpl","expressionEventEmitter","eventHandlerRegistry","resolveService","resolveDependency","attachEvent","getEventHandler","bindingDataValueChangeEventHandler","entityValueChangedEventHandler","stateValueChangedEventHandler","repositoryAddEntityEventHandler","bindingDataAppendEntityEventHandler","repositoryRemoveEntityEventHandler","bindingDataRemoveObjectEventHandler","entityUpdateEventHandler","repositoryLoadEventHandler","bindingDataLoadEventHandler","bindingDataSelectionChangedHandler","ExpressionManager","messageService","notifyService","rowData","customContext","currentRow","onDataPicking","configs","warning","hideTitle","groupDependencies","executeAsync","isGroupdMainEntity","isEntityDependency","getEntity","collection","fullPath","fullPaths_1","ExpressionResultFactory","registeEvent","EffectUtil","getFormValueByPath","ReadonlyEffector","form_anme","ValidateEffector","validators","RequiredEffector","VisibleEffector","DependencyEffector","effectorRegistry","EffectorRegistry","nsEffectors","Relative","VIEW_MODEL_EXPRESSION_PROVIDERS","ControlsProxy","controlsProxyMap","setControlProxy","getControlProxy","ViewModel","extendCommands","initRepository","initBindingData","initUIState","intiStateMachine","initForm","initCommandBus","registerWithParent","initListeners","closeOldBeSession","initExpression","initControlsProxy","existedViewModelContext","entityValueChangingListeners","entityValueChangedListeners","command","plainPath","change_1","changed","commands","valueChangeSuccess_1","concatMap","repositoryBindingData","CommandBus","extendCommandMethods","ngCommands","keybindingMap","ngCommand","eventParams","paramDescriptions","eventParam","keyBinding","parentContext","parentViewModel","className","allViewModelContexts","extractPath","bindingBasePath","valueChangingListeners_1","valueChangedListeners_1","AppEventBus","triggerEvent","componentId","funcError","unsubscribe","unsubscribeAllListview","keyStr","APP_BASE_PROVIDERS","APP_CONTROL_STATE_PROVIDERS","VIEW_MODEL_CONTROL_STATE_PROVIDERS","App","appInjector","APP_VARIABLE_PROVIDERS","createViewModel","VIEW_MODEL_COMMAND_PROVIDERS","ParseUtil","getAppContext","CommandContext","getFrameContext","getRootFrameContext","getFrameContextById","DataVariableParser","searchValue","replaceValue","DATA_PATTERN","UIStateVariableParser","UI_STATE_PATTERN","formatDate","year","getFullYear","month","getMonth","day","getDate","StateMachineVariableParser","stateMachineVariables","STATE_MACHINE_PATTERN","sessionVariable","getPathObj","getTargetStateMachine","targetFrameContext","splitPath","CommandVariableParser","parsers","parseExpression","itemIndex","evaluate","parsedExpression","TaskLink","to","canLink","TaskFlow","nodes","links","addNode","addNodes","insertNode","findNodeIndex","createNode","appendNode","addLink","link","createLink","addLinks","getNext","nextLink","taskFlow","CommandHandler","parseService","schedule","lastTaskResult$","setTimeout","commandToExecute","context$","currentTask","latestResult","complete","throwIfEmpty","takeLast","displayError","addTask","insertTask","afterTask","replaceTask","invoke","serviceInstance","setContextToServiceInstance","parsedArgs","serviceContext","COMMAND_HANDLERS_TOKEN","CommandHandlerRegistry","handlerMap","handlerMetadata","CommandHandlerExtender","COMMAND_HANDLER_EXTENDERS_TOKEN","CommandHandlerExtenderRegistry","extenders","extendersMap","extender","extenderMetadata","CommandHandlerFactory","handlerRegistry","extenderRegistry","rawHandler","handlerFactory","executingCommands","executingCommandCount$","commandResult$","executeCommand","lastTaskResult","removeCommandFromExecutingQueue","addCommandToExecutingQueue","executingCommand","decoratorFactory","ParamDecoratorFactory","ParamDecorator","annotation","unusedKey","parameters"],"mappings":"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","sourcesContent":["/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport function __createBinding(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n}\r\n\r\nexport function __exportStar(m, exports) {\r\n    for (var p in m) if (p !== \"default\" && !exports.hasOwnProperty(p)) exports[p] = m[p];\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\r\n    result.default = mod;\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, privateMap) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to get private field on non-instance\");\r\n    }\r\n    return privateMap.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, privateMap, value) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to set private field on non-instance\");\r\n    }\r\n    privateMap.set(receiver, value);\r\n    return value;\r\n}\r\n","\nexport interface Type<T> extends Function {\n    new(...args: any[]): T;\n}\n\nexport const Type = Function;\n\n\n\n// export type ClassType = new (...args: any[]) => any;\n\nexport interface Pagination {\n    pageSize: number;\n    pageIndex: number;\n    total: number;\n}\n\nexport interface Pagination {\n    pageSize: number;\n    pageIndex: number;\n    total: number;\n}\n\n\nexport interface ResultData {\n    data?: any[];\n    pagination?: Pagination;\n}\n\nexport enum DataChangeType { Add, Delete, Edit, Append }\n\nexport interface DataChange {\n    /**\n     * 变更路径，主要针对带从表的情况\n     */\n    fpath?: string;\n    dataId: string;\n    changeType: DataChangeType;\n    [prop: string]: any;\n}\n","import { Type } from '../types';\n\nexport function isType(v: any): v is Type<any> {\n  return typeof v === 'function';\n}\n\n\n\nexport interface AbstractType<T> extends Function {\n  prototype: T;\n}\n\n\nexport enum InjectFlags {\n\n  Default = 0b0000,\n\n  Self = 0b0001,\n\n  SkipSelf = 0b0010,\n\n  Optional = 0b0100,\n}\n\n\nexport const enum OptionFlags {\n  Optional = 1 << 0,\n  CheckSelf = 1 << 1,\n  CheckParent = 1 << 2,\n  Default = CheckSelf | CheckParent\n}\n\n\nexport interface Record {\n\n  fn: Function;\n\n  useNew: boolean;\n\n  deps: DependencyRecord[];\n\n  value: any;\n\n}\n\n\nexport interface DependencyRecord {\n\n  token: any;\n\n  options: number;\n}\n\n\n","export const EMPTY = [] as any[];\n\nexport const IDENT = function<T>(value: T): T {\n  return value;\n};\n\nexport const CIRCULAR = IDENT;\n\nexport const MULTI_PROVIDER_FN = function(): any[] {\n  return Array.prototype.slice.call(arguments);\n};\n\nexport const NEW_LINE = /\\n/gm;\n\nexport const NO_NEW_LINE = 'ɵ';\n\nconst _THROW_IF_NOT_FOUND = {};\n\nexport const THROW_IF_NOT_FOUND = _THROW_IF_NOT_FOUND;\n\nexport const NG_TEMP_TOKEN_PATH = 'ngTempTokenPath';\n","import { NO_NEW_LINE, NEW_LINE } from './consts';\n\nexport function stringify(token: any): string {\n  if (typeof token === 'string') {\n    return token;\n  }\n\n  if (Array.isArray(token)) {\n    return '[' + token.map(stringify).join(', ') + ']';\n  }\n\n  if (token == null) {\n    return '' + token;\n  }\n\n  if (token.overriddenName) {\n    return `${token.overriddenName}`;\n  }\n\n  if (token.name) {\n    return `${token.name}`;\n  }\n\n  const res = token.toString();\n\n  if (res == null) {\n    return '' + res;\n  }\n\n  const newLineIndex = res.indexOf('\\n');\n  return newLineIndex === -1 ? res : res.substring(0, newLineIndex);\n}\n\n\nexport function getClosureSafeProperty<T>(objWithPropertyToExtract: T): string {\n  for (const key in objWithPropertyToExtract) {\n    if (objWithPropertyToExtract[key] === getClosureSafeProperty as any) {\n      return key;\n    }\n  }\n  throw Error('Could not find renamed property on target object.');\n}\n\n\nexport function formatError(\n  text: string,\n  obj: any,\n  injectorErrorName: string,\n  source: string|null = null\n): string {\n  text = text && text.charAt(0) === '\\n' && text.charAt(1) == NO_NEW_LINE ? text.substr(2) : text;\n  let context = stringify(obj);\n  if (Array.isArray(obj)) {\n    context = obj.map(stringify).join(' -> ');\n  } else if (typeof obj === 'object') {\n    const parts = [] as string[];\n    for (const key in obj) {\n      if (obj.hasOwnProperty(key)) {\n        const value = obj[key];\n        parts.push(\n            key + ':' + (typeof value === 'string' ? JSON.stringify(value) : stringify(value)));\n      }\n    }\n    context = `{${parts.join(', ')}}`;\n  }\n  return `${injectorErrorName}${source ? '(' + source + ')' : ''}[${context}]: ${\n      text.replace(NEW_LINE, '\\n  ')}`;\n}\n\n\nexport function staticError(text: string, obj: any): Error {\n  return new Error(formatError(text, obj, 'StaticInjectorError'));\n}\n","import { Type } from '../types';\nimport { getClosureSafeProperty } from './utils';\n\n\nexport interface InjectorType<T> extends Type<T> {\n  ɵinj: never;\n}\n\nexport interface ɵɵInjectableDef<T> {\n  providedIn: InjectorType<any>|'root'|'platform'|'any'|null;\n  token: unknown;\n  factory: (t?: Type<any>) => T;\n  value: T|undefined;\n}\n\n\nexport function ɵɵdefineInjectable<T>(opts: {\n  token: unknown,\n  providedIn?: Type<any>|'root'|'platform'|'any'|null, factory: () => T,\n}): never {\n  return ({\n    token: opts.token,\n    providedIn: opts.providedIn as any || null,\n    factory: opts.factory,\n    value: undefined,\n  } as ɵɵInjectableDef<T>) as never;\n}\n\n\nexport const NG_PROV_DEF       = getClosureSafeProperty({ɵprov: getClosureSafeProperty});\nexport const NG_INJ_DEF        = getClosureSafeProperty({ɵinj: getClosureSafeProperty});\nexport const NG_INJECTABLE_DEF = getClosureSafeProperty({ngInjectableDef: getClosureSafeProperty});\n\nexport function getOwnDefinition<T>(type: any, def: ɵɵInjectableDef<T>): ɵɵInjectableDef<T>|null {\n  return def && def.token === type ? def : null;\n}\n\nexport function getInjectableDef<T>(type: any): ɵɵInjectableDef<T>|null {\n  return getOwnDefinition(type, type[NG_PROV_DEF]) ||\n      getOwnDefinition(type, type[NG_INJECTABLE_DEF]);\n}\n","import { Type } from '../types';\nimport { ɵɵdefineInjectable } from './injectable_def';\n\n\nexport class InjectionToken<T> {\n\n  readonly ngMetadataName = 'InjectionToken';\n\n  readonly ɵprov: never|undefined;\n\n  constructor(\n    protected _desc: string,\n    options?: { providedIn?: Type<any>|'root'|'platform'|'any'|null, factory: () => T }\n  ) {\n\n    this.ɵprov = undefined;\n    if (typeof options === 'number') {\n      (this as any).__NG_ELEMENT_ID__ = options;\n    } else if (options !== undefined) {\n      this.ɵprov = ɵɵdefineInjectable({\n        token: this,\n        providedIn: options.providedIn || 'root',\n        factory: options.factory,\n      });\n    }\n  }\n\n  toString(): string {\n    return `InjectionToken ${this._desc}`;\n  }\n}\n\nexport function createInjectionToken(token: any): InjectionToken<any> {\n  return new InjectionToken<any>(token);\n}\n","import { Type } from '../types';\nimport { AbstractType, InjectFlags } from './types';\nimport { InjectionToken } from './injection_token';\n\n/**\n * 注入器抽象类\n */\nexport abstract class Injector {\n\n  abstract get<T>(\n      token: Type<T>|InjectionToken<T>|AbstractType<T>,\n      notFoundValue?: T,\n      flags?: InjectFlags\n  ): T;\n\n  abstract get(token: any, notFoundValue?: any): any;\n\n}\n","import { stringify } from './utils';\nimport { THROW_IF_NOT_FOUND } from './consts';\nimport { Injector } from './injector';\n\n\nexport class NullInjector implements Injector {\n\n  get(token: any, notFoundValue: any = THROW_IF_NOT_FOUND): any {\n    if (notFoundValue === THROW_IF_NOT_FOUND) {\n      const error = new Error(`NullInjectorError: No provider for ${stringify(token)}!`);\n      error.name = 'NullInjectorError';\n      throw error;\n    }\n    return notFoundValue;\n  }\n\n}\n\n\nexport const NULL_INJECTOR: Injector = new NullInjector();\n","import { Type } from '../types';\nimport { stringify, getClosureSafeProperty } from './utils';\n\nconst __forward_ref__ = getClosureSafeProperty({__forward_ref__: getClosureSafeProperty});\n\nexport function resolveForwardRef<T>(type: T): T {\n  return isForwardRef(type) ? type() : type;\n}\n\nexport interface ForwardRefFn {\n  (): any;\n}\n\nexport function forwardRef(forwardRefFn: ForwardRefFn): Type<any> {\n  (forwardRefFn as any).__forward_ref__ = forwardRef;\n  (forwardRefFn as any).toString = function() {\n    return stringify(this());\n  };\n  return (forwardRefFn as any as Type<any>);\n}\n\nexport function isForwardRef(fn: any): fn is() => any {\n  return typeof fn === 'function' && fn.hasOwnProperty(__forward_ref__) &&\n      fn.__forward_ref__ === forwardRef;\n}\n","import { Type } from '../types';\nimport { InjectFlags, OptionFlags, Record, DependencyRecord } from './types';\nimport { IDENT, EMPTY, CIRCULAR, MULTI_PROVIDER_FN, NO_NEW_LINE, NEW_LINE, NG_TEMP_TOKEN_PATH } from './consts';\nimport { stringify, getClosureSafeProperty, formatError, staticError } from './utils';\nimport { Injector } from './injector';\nimport { NULL_INJECTOR, NullInjector} from './null_injector';\nimport {\n  ValueProvider, StaticClassProvider, ConstructorProvider,  ExistingProvider, FactoryProvider,\n  StaticProvider, SupportedProvider,\n} from './providers';\nimport { InjectionToken } from './injection_token';\nimport { getInjectableDef } from './injectable_def';\nimport { resolveForwardRef } from './forward_ref';\nimport { THROW_IF_NOT_FOUND, } from './consts';\n\n\nexport const INJECTOR = new InjectionToken<Injector>('INJECTOR', -1 as any);\n\nexport const USE_VALUE =  getClosureSafeProperty<ValueProvider>({provide: String, useValue: getClosureSafeProperty});\n\nlet _currentInjector: Injector|undefined|null = undefined;\n\nexport function setCurrentInjector(injector: Injector|null|undefined): Injector|undefined|null {\n  const former = _currentInjector;\n  _currentInjector = injector;\n  return former;\n}\n\n\nexport class StaticInjector implements Injector {\n\n  readonly parent: Injector;\n\n  readonly source: string|null;\n\n  readonly scope: string|null;\n\n  private _records: Map<any, Record|null>;\n\n  constructor(\n    providers: StaticProvider[],\n    parent: Injector = NULL_INJECTOR,\n    source: string|null = null\n  ) {\n    parent = parent ? parent : NULL_INJECTOR;\n    this.parent = parent;\n    this.source = source;\n    const records = this._records = new Map<any, Record>();\n\n    records.set(Injector, {token: Injector, fn: IDENT, deps: EMPTY, value: this, useNew: false} as Record);\n    records.set(INJECTOR, {token: INJECTOR, fn: IDENT, deps: EMPTY, value: this, useNew: false} as Record);\n    this.scope = recursivelyProcessProviders(records, providers);\n  }\n\n  get<T>(token: Type<T>|InjectionToken<T>, notFoundValue?: T, flags?: InjectFlags): T;\n  get(token: any, notFoundValue?: any): any;\n  get(token: any, notFoundValue?: any, flags: InjectFlags = InjectFlags.Default): any {\n    const records = this._records;\n    let record = records.get(token);\n    if (record === undefined) {\n      const injectableDef = getInjectableDef(token);\n      if (injectableDef) {\n        const providedIn = injectableDef && injectableDef.providedIn;\n        if (providedIn === 'any' || providedIn != null && providedIn === this.scope) {\n          records.set(\n            token,\n            record = resolveProvider({provide: token, useFactory: injectableDef.factory, deps: EMPTY})\n          );\n        }\n      }\n      if (record === undefined) {\n        records.set(token, null);\n      }\n    }\n    const lastInjector = setCurrentInjector(this);\n    try {\n      return tryResolveToken(token, record, records, this.parent, notFoundValue, flags);\n    } catch (e) {\n      throw e;\n    } finally {\n      setCurrentInjector(lastInjector);\n    }\n  }\n\n  toString() {\n    const tokens = [] as string[];\n    const  records = this._records;\n    records.forEach((v, token) => tokens.push(stringify(token)));\n    return `StaticInjector[${tokens.join(', ')}]`;\n  }\n}\n\n\nfunction multiProviderMixError(token: any) {\n  return staticError('Cannot mix multi providers and regular providers', token);\n}\n\nexport const INJECTOR_SCOPE = new InjectionToken<'root'|'platform'|null>('Set Injector scope.');\n\n\n/**\n * 递归处理Provider\n */\nfunction recursivelyProcessProviders(records: Map<any, Record>, provider: StaticProvider): string | null {\n  let scope: string|null = null;\n  if (provider) {\n    provider = resolveForwardRef(provider);\n    if (Array.isArray(provider)) {\n\n      for (let i = 0; i < provider.length; i++) {\n        scope = recursivelyProcessProviders(records, provider[i]) || scope;\n      }\n    } else if (typeof provider === 'function') {\n\n      throw staticError('Function/Class not supported', provider);\n    } else if (provider && typeof provider === 'object' && provider.provide) {\n\n      let token = resolveForwardRef(provider.provide);\n      const resolvedProvider = resolveProvider(provider);\n\n      // multi\n      if (provider.multi === true) {\n        let multiProvider: Record|undefined = records.get(token);\n        if (multiProvider) {\n          if (multiProvider.fn !== MULTI_PROVIDER_FN) {\n            throw multiProviderMixError(token);\n          }\n        } else {\n          records.set(token, multiProvider = {\n            token: provider.provide,\n            deps: [],\n            useNew: false,\n            fn: MULTI_PROVIDER_FN,\n            value: EMPTY\n          } as Record);\n        }\n        token = provider;\n        multiProvider.deps.push({token, options: OptionFlags.Default});\n      }\n\n      const record = records.get(token);\n      if (record && record.fn === MULTI_PROVIDER_FN) {\n        throw multiProviderMixError(token);\n      }\n      if (token === INJECTOR_SCOPE) {\n        scope = resolvedProvider.value;\n      }\n      records.set(token, resolvedProvider);\n    } else {\n      throw staticError('Unexpected provider', provider);\n    }\n  }\n  return scope;\n}\n\nfunction resolveProvider(provider: SupportedProvider): Record {\n  const deps = computeDeps(provider);\n  let fn: Function = IDENT;\n  let value: any = EMPTY;\n  let useNew: boolean = false;\n  const provide = resolveForwardRef(provider.provide);\n\n  if (USE_VALUE in provider) {\n\n    value = (provider as ValueProvider).useValue;\n  } else if ((provider as FactoryProvider).useFactory) {\n\n    fn = (provider as FactoryProvider).useFactory;\n  } else if ((provider as ExistingProvider).useExisting) {\n\n    // Just use IDENT\n  } else if ((provider as StaticClassProvider).useClass) {\n\n    // 静态类型\n    useNew = true;\n    fn = resolveForwardRef((provider as StaticClassProvider).useClass);\n  } else if (typeof provide === 'function') {\n\n    // 构造函数\n    useNew = true;\n    fn = provide;\n  } else {\n    throw staticError(\n        'StaticProvider does not have [useValue|useFactory|useExisting|useClass] or [provide] is not newable',\n        provider);\n  }\n  return {deps, fn, useNew, value};\n}\n\n/**\n * 计算依赖\n */\nfunction computeDeps(provider: StaticProvider): DependencyRecord[] {\n  let deps: DependencyRecord[] = EMPTY;\n  const providerDeps: any[] = (provider as ExistingProvider & StaticClassProvider & ConstructorProvider).deps;\n\n  if (providerDeps && providerDeps.length) {\n    deps = [];\n    for (let i = 0; i < providerDeps.length; i++) {\n      const options = OptionFlags.Default;\n      const token = resolveForwardRef(providerDeps[i]);\n      deps.push({token, options});\n    }\n  } else if ((provider as ExistingProvider).useExisting) {\n    const token = resolveForwardRef((provider as ExistingProvider).useExisting);\n    deps = [{token, options: OptionFlags.Default}];\n  } else if (!providerDeps && !(USE_VALUE in provider)) {\n    // useValue & useExisting are the only ones which are exempt from deps all others need it.\n    throw staticError('\\'deps\\' required', provider);\n  }\n  return deps;\n}\n\n\nfunction tryResolveToken(\n  token: any,\n  record: Record|undefined|null,\n  records: Map<any, Record|null>,\n  parent: Injector,\n  notFoundValue: any,\n  flags: InjectFlags\n): any {\n  try {\n    return resolveToken(token, record, records, parent, notFoundValue, flags);\n  } catch (e) {\n    if (!(e instanceof Error)) {\n      e = new Error(e);\n    }\n    const path: any[] = e[NG_TEMP_TOKEN_PATH] = e[NG_TEMP_TOKEN_PATH] || [];\n    path.unshift(token);\n\n    // 清空循环引用的值\n    if (record && record.value === CIRCULAR) {\n      record.value = EMPTY;\n    }\n    throw e;\n  }\n}\n\n\nfunction resolveToken(\n  token: any,\n  record: Record|undefined|null,\n  records: Map<any, Record|null>,\n  parent: Injector,\n  notFoundValue: any,\n  flags: InjectFlags\n): any {\n\n  let value;\n  if (record && !(flags & InjectFlags.SkipSelf)) {\n    value = record.value;\n    if (value === CIRCULAR) {\n      throw Error(NO_NEW_LINE + 'Circular dependency');\n    } else if (value === EMPTY) {\n      record.value = CIRCULAR;\n      const useNew = record.useNew;\n      const fn = record.fn;\n      const depRecords = record.deps;\n      let deps = EMPTY;\n      if (depRecords.length) {\n        deps = [];\n        for (let i = 0; i < depRecords.length; i++) {\n          const depRecord: DependencyRecord = depRecords[i];\n          const options = depRecord.options;\n          const childRecord = options & OptionFlags.CheckSelf ? records.get(depRecord.token) : undefined;\n          deps.push(\n            tryResolveToken(\n              depRecord.token,\n              childRecord,\n              records,\n              !childRecord && !(options & OptionFlags.CheckParent) ? NULL_INJECTOR : parent,\n              options & OptionFlags.Optional ? null : THROW_IF_NOT_FOUND,\n              InjectFlags.Default\n            )\n          );\n        }\n      }\n      record.value = value = useNew ? new (fn as any)(...deps) : fn.apply(undefined, deps);\n    }\n  } else if (!(flags & InjectFlags.Self)) {\n\n    value = parent.get(token, notFoundValue, InjectFlags.Default);\n  } else if (!(flags & InjectFlags.Optional)) {\n\n    value = NULL_INJECTOR.get(token, notFoundValue);\n  } else {\n\n    value = NULL_INJECTOR.get(token, typeof notFoundValue !== 'undefined' ? notFoundValue : null);\n  }\n  return value;\n}\n","import { Injector } from './injector';\nimport { StaticInjector } from './static_injector';\nimport { StaticProvider } from './providers';\n\nexport function INJECTOR_IMPL__PRE_R3__(providers: StaticProvider[], parent: Injector|undefined, name: string) {\n  return new StaticInjector(providers, parent, name);\n}\n\nexport const INJECTOR_IMPL = INJECTOR_IMPL__PRE_R3__;\n\nexport function createInjector(\n  options: StaticProvider[] | {providers: StaticProvider[], parent?: Injector, name?: string},\n  parent?: Injector\n): Injector {\n  if (Array.isArray(options)) {\n    return INJECTOR_IMPL(options, parent, '');\n  } else {\n    return INJECTOR_IMPL(options.providers, options.parent, options.name || '');\n  }\n}\n","/**\n * @license\n * Copyright Google Inc. All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.io/license\n */\n// import { Type } from '@angular/core';\nimport { Type } from '../types';\n\n/**\n * An interface implemented by all Angular formType decorators, which allows them to be used as ES7\n * decorators as well as\n * Angular DSL syntax.\n *\n * ES7 syntax:\n *\n * ```\n * @ng.Component({...})\n * class MyClass {...}\n * ```\n *\n */\nexport interface TypeDecorator {\n    /**\n     * Invoke as ES7 decorator.\n     */\n    <T extends Type<any>>(type: T): T;\n\n    // Make TypeDecorator assignable to built-in ParameterDecorator formType.\n    // ParameterDecorator is declared in lib.d.ts as a `declare formType`\n    // so we cannot declare this interface as a subtype.\n    // see https://github.com/angular/angular/issues/3379#issuecomment-126169417\n    (target: Object, propertyKey?: string | symbol, parameterIndex?: number): void;\n}\n\nexport const ANNOTATIONS = '__annotations__';\nexport const PARAMETERS = '__parameters__';\nexport const PROP_METADATA = '__prop__metadata__';\n\n\n\n\n/**\n * @suppress {globalThis}\n */\nexport function makeDecorator(\n    name: string, props?: (...args: any[]) => any, parentClass?: any,\n    chainFn?: (fn: Function) => void,\n    typeFn?: (type: Type<any>, ...args: any[]) => void): {\n        new(...args: any[]): any;\n        (...args: any[]): any;\n        (...args: any[]): (cls: any) => any;\n    } {\n    const metaCtor = makeMetadataCtor(props);\n\n    function DecoratorFactory(...args: any[]): (cls: any) => any {\n        if (this instanceof DecoratorFactory) {\n            metaCtor.call(this, ...args);\n            return this;\n        }\n\n        const annotationInstance = new (<any>DecoratorFactory)(...args);\n        const typeDecorator: TypeDecorator = <TypeDecorator>function createTypeDecorator(cls: Type<any>) {\n            typeFn && typeFn(cls, ...args);\n            // Use of Object.defineProperty is important since it creates non-enumerable property which\n            // prevents the property is copied during subclassing.\n            const annotations = cls.hasOwnProperty(ANNOTATIONS) ?\n                (cls as any)[ANNOTATIONS] :\n                Object.defineProperty(cls, ANNOTATIONS, { value: [] })[ANNOTATIONS];\n            annotations.push(annotationInstance);\n            return cls;\n        };\n        if (chainFn) { chainFn(typeDecorator); }\n        return typeDecorator;\n    }\n\n    if (parentClass) {\n        DecoratorFactory.prototype = Object.create(parentClass.prototype);\n    }\n\n    DecoratorFactory.prototype.ngMetadataName = name;\n    (<any>DecoratorFactory).annotationCls = DecoratorFactory;\n    return DecoratorFactory as any;\n}\n\nfunction makeMetadataCtor(props?: (...args: any[]) => any): any {\n    return function ctor(...args: any[]) {\n        if (props) {\n            const values = props(...args);\n            // tslint:disable-next-line:forin\n            for (const propName in values) {\n                this[propName] = values[propName];\n            }\n        }\n    };\n}\n\n\n\n\n\nexport function makeParamDecorator(\n    name: string, props?: (...args: any[]) => any, parentClass?: any): any {\n    const metaCtor = makeMetadataCtor(props);\n    function ParamDecoratorFactory(...args: any[]): any {\n        if (this instanceof ParamDecoratorFactory) {\n            metaCtor.apply(this, args);\n            return this;\n        }\n        const annotationInstance = new (<any>ParamDecoratorFactory)(...args);\n\n        (<any>ParamDecorator).annotation = annotationInstance;\n        return ParamDecorator;\n\n        function ParamDecorator(cls: any, unusedKey: any, index: number): any {\n            // Use of Object.defineProperty is important since it creates non-enumerable property which\n            // prevents the property is copied during subclassing.\n            const parameters = cls.hasOwnProperty(PARAMETERS) ?\n                (cls as any)[PARAMETERS] :\n                Object.defineProperty(cls, PARAMETERS, { value: [] })[PARAMETERS];\n\n            // there might be gaps if some in between parameters do not have annotations.\n            // we pad with nulls.\n            while (parameters.length <= index) {\n                parameters.push(null);\n            }\n\n            (parameters[index] = parameters[index] || []).push(annotationInstance);\n            return cls;\n        }\n    }\n    if (parentClass) {\n        ParamDecoratorFactory.prototype = Object.create(parentClass.prototype);\n    }\n    ParamDecoratorFactory.prototype.ngMetadataName = name;\n    (<any>ParamDecoratorFactory).annotationCls = ParamDecoratorFactory;\n    return ParamDecoratorFactory;\n}\n\n\n\n\nexport function makePropDecorator(\n    name: string, props?: (...args: any[]) => any, parentClass?: any): any {\n    const metaCtor = makeMetadataCtor(props);\n\n    function PropDecoratorFactory(...args: any[]): any {\n        if (this instanceof PropDecoratorFactory) {\n            metaCtor.apply(this, args);\n            return this;\n        }\n\n        const decoratorInstance = new (<any>PropDecoratorFactory)(...args);\n\n        // tslint:disable-next-line:no-shadowed-variable\n        return function PropDecorator(target: any, name: string) {\n            const constructor = target.constructor;\n            // Use of Object.defineProperty is important since it creates non-enumerable property which\n            // prevents the property is copied during subclassing.\n            const meta = constructor.hasOwnProperty(PROP_METADATA) ?\n                (constructor as any)[PROP_METADATA] :\n                Object.defineProperty(constructor, PROP_METADATA, { value: {} })[PROP_METADATA];\n            meta[name] = meta.hasOwnProperty(name) && meta[name] || [];\n            meta[name].unshift(decoratorInstance);\n        };\n    }\n\n    if (parentClass) {\n        PropDecoratorFactory.prototype = Object.create(parentClass.prototype);\n    }\n\n    PropDecoratorFactory.prototype.ngMetadataName = name;\n    (<any>PropDecoratorFactory).annotationCls = PropDecoratorFactory;\n    return PropDecoratorFactory;\n}\n","import { ANNOTATIONS, PROP_METADATA } from './decorator';\nimport { Translate } from '../../i18n/index';\n\n/**\n * 元数据解析\n * 约束：\n * 1、类型装饰器：在某个类型上，某种类型的装饰器，只使用一次，不重复添加；\n * 2、属性装饰器：在某个属性上，某种类型的装饰器，只使用一次，不重复添加\n */\nclass MetadataUtil {\n\n  // ----------------------------------------\n  // 类型元数据\n  // ----------------------------------------\n\n  /**\n   * 获取类元数据\n   * 返回结果形如：\n   * [\n   *   Injectable\n   *   NgViewModel\n   *   NgViewModel\n   * ]\n   */\n  static getClassMetadatas(constructor: any): any[] {\n    const metadatas = constructor[ANNOTATIONS];\n    return metadatas;\n  }\n\n  /**\n   * 获取某个class上的某种装饰器\n   * 返回结果：NgViewModel\n   */\n  static getClassMetadataByName(constructor: any, metadataName: string): any {\n    const metadata = this.getClassMetadataByNameWithTranslate(constructor, metadataName, null, null);\n    return metadata;\n  }\n\n  static getClassMetadataByNameWithTranslate(\n    constructor: any, metadataName: string,\n    translateService?: Translate, keysToTranslate?: string[]): any {\n    const allClassMetadatas = this.getClassMetadatas(constructor);\n    if (!allClassMetadatas) {\n      return null;\n    }\n    const metadata = allClassMetadatas.find((classMetadata: any) => {\n      return classMetadata.ngMetadataName === metadataName;\n    });\n    if (metadata && translateService && keysToTranslate) {\n      keysToTranslate.forEach((metadataPropKey) => {\n        const propertyVariable: string = metadata[metadataPropKey];\n        if (propertyVariable && propertyVariable.startsWith('{{') && propertyVariable.endsWith('}}')) {\n          const translateKey = propertyVariable.replace('{{', '').replace('}}', '').trim();\n          metadata[metadataPropKey] = translateService.transform(translateKey, null);\n        }\n      });\n    }\n    return metadata;\n  }\n\n  // ----------------------------------------\n  // 属性元数据\n  // ----------------------------------------\n\n  /**\n   * 获取所有属性的所有元数据\n   * 返回格式：\n   * {\n   *   propName1: [ NgDefaultValue, NgMaxLength, NgMinLength],\n   *   propName2: [ NgDefaultValue, NgMaxLength, NgMinLength]\n   * }\n   */\n  static getPropsMetadatas(constructor: any): any {\n    const allPropMetadatas = constructor[PROP_METADATA];\n    return allPropMetadatas;\n  }\n\n  /**\n   * 获取所有属性的某一类型的元数据\n   * 如果同一属性\n   * 返回结果：\n   * {\n   *    propName1: NgDefaultValue,\n   *    propName2: NgDefaultValue\n   * }\n   */\n  static getPropsMetadatasByName(constructor: any, metadataName: string): { [propName: string]: any } {\n    const metadatas = this.getPropsMetadatasByNameWithTranslate(constructor, metadataName);\n    return metadatas;\n  }\n\n  static getPropsMetadatasByNameWithTranslate(\n    constructor: any, metadataName: string,\n    translateService?: Translate, keysToTranslate?: string[]): { [propName: string]: any } {\n    const metadatas = {};\n    // 读取构造函数中存储的类属性注解。\n    const allPropMetadatas = this.getPropsMetadatas(constructor);\n    if (!allPropMetadatas) {\n      return metadatas;\n    }\n    // 遍历所有属性提取注解信息。\n    Object.keys(allPropMetadatas).forEach((propName: string) => {\n      // 提取当前属性注解对象\n      const propMetadatas: any[] = allPropMetadatas[propName];\n      // 提取指定类型的注解项\n      const metadata = propMetadatas.find((propMetadata: any) => {\n        return propMetadata.ngMetadataName === metadataName;\n      });\n      if (translateService && keysToTranslate) {\n        keysToTranslate.forEach((metadataPropKey) => {\n          const propertyVariable: string = metadata[metadataPropKey];\n          if (propertyVariable && propertyVariable.startsWith('{{') && propertyVariable.endsWith('}}')) {\n            const translateKey = propertyVariable.replace('{{', '').replace('}}', '').trim();\n            metadata[metadataPropKey] = translateService.transform(translateKey, null);\n          }\n        });\n      }\n      if (metadata) {\n        metadatas[propName] = metadata;\n      }\n    });\n\n    return metadatas;\n  }\n\n  /**\n   * 获取某个属性的所有元数据\n   * 返回格式：[ NgDefaultValue, NgMaxLength, NgMinLength]\n   */\n  static getPropMetadatasByName(constructor: any, propName: string): any[] {\n    // 暂不实现\n    return null;\n  }\n\n  /**\n   * 获取某个属性的某种元数据\n   * 返回格式：NgDefaultValue\n   */\n  static getPropMetadataByName(constructor: any, propName: string, metadataName: string): any {\n    // 暂不实现\n    return null;\n  }\n\n\n  // ----------------------------------------\n  // 参数元数据\n  // ----------------------------------------\n\n}\n\nexport { MetadataUtil };\n","/**\n * 变更记录\n */\nexport class Modification {\n\n  /**\n   * 实体变更路径。如：[1, 'name']\n   * 说明： 1 为实体主键ID， name 为属性名称\n   */\n  path?: string[];\n\n  /**\n   * 原值\n   */\n  preValue?: any;\n\n  /**\n   * 变更后的新值\n   *\n   * value 值类型会根据 type(变更类型)的不同而不同，当type 为以下类型时：\n   * - Add: value的值为json 对象\n   * - ValueChange: value的值为string\\number\\boolean等简单数据\n   * - Remove: value的值为键值对{[key:string]: value} key为主键字段\n   *\n   */\n  value: any;\n\n  /**\n   * 变更类型\n   */\n  type: ModifyType;\n\n  /**\n   * 数据是否通过验证\n   */\n  isValid?: boolean;\n\n  /**\n   * 数据验证结果\n   */\n  errors?: { [type: string]: string };\n\n  /**\n   * 插入位置\n   */\n  position?: 1 | -1;\n\n  /**\n   * 变更集的值\n   */\n  changeSetValue?: any;\n  /**\n   * 重置数据\n   */\n  isReset?: boolean;\n  entityCreate?: boolean;\n\n  /**\n   * 构造函数\n   * @param value 新值\n   * @param modifyType 变更类型\n   * @param path 变更路径\n   * @param preValue 旧值\n   */\n  constructor(value: any, modifyType: ModifyType, path?: string[], preValue?: any, position?: 1 | -1) {\n    this.type = modifyType;\n    this.value = value;\n    this.preValue = preValue;\n    this.path = path;\n    this.position = position;\n  }\n}\n\n/**\n * 变更类型\n */\nexport enum ModifyType {\n\n  /**\n   * 添加\n   */\n  Add = 'ADD',\n  /**\n   * 添加数据\n   */\n  AddData = 'AddData',\n  /**\n   * 克隆数据\n   */\n  Clone = 'CLONE',\n  /**\n   * 删除\n   */\n  Remove = 'REMOVE',\n  RemoveData = 'RemoveData',\n\n  /**\n   * 修改\n   */\n  ValueChange = 'VALUE_CHANGE',\n\n  /**\n   * 加载\n   */\n  Load = 'LOAD',\n\n  /**\n   * 未改变\n   */\n  UnChanged = 'UNCHANGED',\n\n  /**\n   * 分页信息变更\n   */\n  PaginationInfoChange = \"PAGINATION_INFO_CHANGE\",\n\n  /**\n   * 插入\n   */\n  Insert = 'Insert',\n\n  /**\n   * 更新实体\n   */\n  Update = 'UPDATE'\n}\n","/**\n * 请求头信息\n */\ninterface HttpHeaders {\n  [key: string]: string;\n}\n\n/**\n * Http参数\n */\ninterface HttpParams {\n  [key: string]: string;\n}\n\n/**\n * 请求方法\n */\ntype HttpMethod = | 'GET' | 'DELETE' | 'HEAD' | 'OPTIONS' | 'POST' | 'PUT' | 'PATCH' | 'LINK' | 'UNLINK';\n\n/**\n * HttpMethods\n */\nclass HttpMethods {\n  public static GET: HttpMethod     = 'GET';\n  public static DELETE: HttpMethod  = 'DELETE';\n  public static HEAD: HttpMethod    = 'HEAD';\n  public static OPTIONS: HttpMethod = 'OPTIONS';\n  public static POST: HttpMethod    = 'POST';\n  public static PUT: HttpMethod     = 'PUT';\n  public static PATCH: HttpMethod   = 'PATCH';\n  public static LINK: HttpMethod    = 'LINK';\n  public static UNLINK: HttpMethod  = 'UNLINK';\n}\n\n\n/**\n * 返回值类型\n */\ntype HttpResponseType = | 'arraybuffer' | 'blob' | 'document' | 'json' | 'text' | 'stream';\n\n/**\n * 返回值处理类型\n */\ntype ObserveType = 'body' | 'response';\n\n/**\n * Http响应信息\n */\ninterface HttpResponse {\n  headers: {[key: string]: string};\n  body: any;\n  status: number;\n  statusText: string;\n}\n\n/**\n * Http请求配置\n */\ninterface HttpRequestConfig {\n  params?: HttpParams;\n  body?: any;\n  headers?: HttpHeaders;\n  responseType?: HttpResponseType;\n  observe?: 'body' | 'response';\n}\n\n\nexport { HttpHeaders, HttpParams, HttpMethod, HttpMethods, ObserveType, HttpResponseType, HttpRequestConfig, HttpResponse };\n","import { AxiosInstance, AxiosRequestConfig, AxiosResponse} from 'axios';\nimport { HttpMethod, HttpHeaders, HttpResponse, HttpRequestConfig } from './types';\n\nclass HttpUtil {\n\n  /**\n   * 追加Header\n   */\n  public static appendHeader(headers: HttpHeaders, key: string, value: string): HttpHeaders {\n    headers = Object.assign({}, headers, {[key]: value});\n    return headers;\n  }\n\n  /**\n   * 向RequestConfig中追加body\n   */\n  public static appendBodyToRequestConfig(body: any, requestConfig: HttpRequestConfig) {\n    if (!requestConfig) {\n      requestConfig = {};\n    }\n    requestConfig = Object.assign({}, requestConfig, { body: body});\n\n    return requestConfig;\n  }\n\n  /**\n   * 构造AxiosReqeustConfig\n   */\n  public static buildAxiosRequestConfig(method: HttpMethod, url: string, requestConfig: HttpRequestConfig): AxiosRequestConfig {\n    requestConfig = requestConfig || {};\n\n    const axiosRequestConfig: AxiosRequestConfig = {\n      url: url,\n      method: method,\n      params:  requestConfig.params || null,\n      headers: requestConfig.headers || null,\n      responseType: requestConfig.responseType || 'json',\n      data: requestConfig.body || null\n    };\n    return axiosRequestConfig;\n  }\n\n  /**\n   * 构造Http响应信息\n   */\n  public static buildHttpResponse(axiosResponse: AxiosResponse ) {\n    const httpResponse: HttpResponse = {\n      body: axiosResponse.data,\n      headers: axiosResponse.headers,\n      status: axiosResponse.status,\n      statusText: axiosResponse.statusText\n    };\n    return httpResponse;\n  }\n\n}\n\nexport { HttpUtil };\n","import { Observable, from, of } from 'rxjs';\nimport { map, switchMap } from 'rxjs/operators';\nimport axios from 'axios';\nimport { AxiosInstance, AxiosResponse} from 'axios';\nimport { HttpMethod, HttpRequestConfig } from './types';\nimport { HttpUtil } from './http-util';\n\n/**\n * HttpClient\n */\nclass HttpClient {\n\n  /**\n   * axios实例\n   */\n  private axiosInstance: AxiosInstance;\n\n  /**\n   * 构造函数\n   */\n  constructor() {\n    this.axiosInstance = axios.create();\n  }\n\n  /**\n   * 发送GET请求\n   */\n  public get(url: string, requestConfig: HttpRequestConfig): Observable<any> {\n    return this.request('GET', url, requestConfig);\n  }\n\n  /**\n   * 发送POST请求\n   */\n  public post(url: string, body: any, requestConfig: HttpRequestConfig) {\n    requestConfig = HttpUtil.appendBodyToRequestConfig(body, requestConfig);\n    return this.request('POST', url, requestConfig);\n  }\n\n  /**\n   * 发送PUT请求\n   */\n  public put(url: string, body: any, requestConfig: HttpRequestConfig) {\n    requestConfig = HttpUtil.appendBodyToRequestConfig(body, requestConfig);\n    return this.request('PUT', url, requestConfig);\n  }\n\n  /**\n   * 发送PATCH请求\n   */\n  public patch(url: string, body: any, requestConfig: HttpRequestConfig) {\n    requestConfig = HttpUtil.appendBodyToRequestConfig(body, requestConfig);\n    return this.request('PATCH', url, requestConfig);\n  }\n\n  /**\n   * 发送DELETE请求\n   */\n  public delete(url: string, requestConfig: HttpRequestConfig) {\n    return this.request('DELETE', url, requestConfig);\n  }\n\n  /**\n   * 发送请求\n   */\n  request( method: HttpMethod, url: string, requestConfig: HttpRequestConfig): Observable<any> {\n    const request$ = of(true).pipe(\n      switchMap(() => {\n        const axiosRequestConfig = HttpUtil.buildAxiosRequestConfig(method, url, requestConfig);\n        return from(this.axiosInstance.request(axiosRequestConfig));\n      })\n    );\n    return request$.pipe(\n      map((axiosResponse: AxiosResponse) => {\n        const httpResponse = HttpUtil.buildHttpResponse(axiosResponse);\n        return requestConfig.observe === 'response' ? httpResponse : axiosResponse.data;\n      })\n    );\n  }\n\n}\n\nexport { HttpClient };\n","export * from './types';\nexport * from './http-util';\nexport * from './http-client';\n\nimport { StaticProvider } from '../core/index';\nimport { HttpClient } from './http-client';\n\nconst HTTP_PROVIDERS: StaticProvider[] = [\n  { provide: HttpClient, useClass: HttpClient, deps: [] }\n];\n\nexport { HTTP_PROVIDERS };\n\n\n","/*\n * @Author: Lucus, Witt\n * @Date: 2018-10-30 15:53:59\n * @Last Modified by: Witt\n * @Last Modified time: 2018-11-08 17:25:08\n */\n\nimport { Modification, ModifyType } from './types';\n\nfunction isEqual(value: any, other: any) {\n  return JSON.stringify(value) ===  JSON.stringify(other);\n}\n\n/**\n * 实体数据变更集\n */\nclass ChangeSet {\n\n  /**\n   * 变更集合\n   */\n  protected modifications: Modification[] = [];\n\n  /**\n   *  获取所有的变更记录\n   */\n  public get changes(): Modification[] {\n    return this.modifications;\n  }\n\n  /**\n   * 将变更集添加到集合中\n   * ### 使用示例\n   * ```\n   * const changeSet = new ChangeSet();\n   * const modify = new Modification('newValue', ModifyType.ValueChange, [1, 'title'], 'oldValue');\n   * changeSet.append(modify)\n   * ```\n   * @param changeItem 变更数据\n   */\n  public append(modification: Modification) {\n    switch (modification.type) {\n      case ModifyType.ValueChange:\n        this.appendValueChangeModification(modification);\n        break;\n      case ModifyType.Add:\n      case ModifyType.Insert:\n      case ModifyType.Clone:\n        this.appendAddModification(modification);\n        break;\n      case ModifyType.Remove:\n        this.appendRemoveModification(modification);\n        break;\n      case ModifyType.Load:\n        break;\n      default:\n        throw new Error('不支持此类型的变更');\n    }\n  }\n\n  /**\n   * 添加值变化变更\n   */\n  private appendValueChangeModification(modification: Modification) {\n    const value = modification.value;\n\n    const existedModification = this.findModifyItemsPath(modification.path);\n    if (existedModification) {\n\n      // 如果存在相同路径的ValueChange类型的变更集，则更新值；\n      existedModification.value = value;\n    } else {\n      const existedAddModification = this.findNewAddItemsPath(modification.path);\n      if (existedAddModification) {\n\n        // @todo：\n        // 1、此处逻辑有问题，value是个字符串，不能直接assign；\n        // 2、之所以没有出现问题，是因为都是服务器端新增，新增后，客户端清空了所有变更。\n        // 如果存在涵盖该ValueChange变更的Add变更，则更新Add变更对应的数据；\n        existedAddModification.value = Object.assign({}, existedAddModification.value, value);\n      } else {\n\n        // 其他情况，新增一条ValueChange变更。\n        this.modifications.push(modification);\n      }\n    }\n  }\n\n  /**\n   * 添加新增变更\n   */\n  private appendAddModification(modification: Modification) {\n    const value = modification.value;\n\n    const existedModification = this.findNewAddItemsPath(modification.path);\n    if (existedModification) {\n\n      // 1、如果已经存在相同路径的Add变更，则合并Value。\n      existedModification.value = existedModification.value.concat(value);\n    } else {\n\n      // 2、如果没有，则新增一条Add变更。\n      this.modifications.push(modification);\n    }\n  }\n\n  /**\n   * 添加删除变更\n   */\n  private appendRemoveModification(modification: Modification) {\n\n    const path = modification.path;\n    const primaryKey = Object.keys(modification.value)[0];\n    const primaryKeyValue = modification.value[primaryKey];\n\n    // 1、存在相同path的新增变更，移除新增变更，不需要添加删除变更；\n    // @todo：待重构（1、只考虑了主从情况，2、临时用多重循环实现）\n    this.modifications.forEach((addModification: Modification) => {\n\n      // 只处理新增变更\n      if (addModification.type !== ModifyType.Add && addModification.type !== ModifyType.Insert && addModification.type !== ModifyType.Clone) {\n        return;\n      }\n\n      // @todo 只考虑主从结构，再深的层次暂不考虑\n      if (isEqual(addModification.path, path) === false) {\n        return;\n      }\n\n      // 遍历新增新增变更的value（value是个数组），移除相匹配的新增删除\n      addModification.value = addModification.value.filter((addDataItem: any) => {\n        return addDataItem[primaryKey] !== primaryKeyValue;\n      });\n    });\n\n    // 2、移除对应的修改变更\n    const fullRemovePath = path.concat(`${primaryKey}:${primaryKeyValue}`);\n    this.modifications = this.modifications.filter((valueModification: Modification) => {\n      if (valueModification.type !== ModifyType.ValueChange) {\n        return true;\n      }\n      const valueChangePath = Array.from(valueModification.path);\n      valueChangePath.pop();\n\n      // 路径相同进行移除\n      const isToRemove = isEqual(valueChangePath, fullRemovePath);\n      return !isToRemove;\n    });\n\n    // 先删除下级删除变更，再插入\n    // 主要针对从从表删除之后，又删除子表时，根实体上还存在从从表删除变更的场景\n    this.removeDescendantRemoveModifications(modification);\n    this.modifications.push(modification);\n  }\n\n  /**\n   * 清空变更集合\n   */\n  public clear() {\n    this.modifications = [];\n  }\n\n\n  /**\n   * 根据path获取Add类型的变更记录\n   * @param path 变更路径\n   */\n  private findNewAddItemsPath(path: any[]) {\n    return this.modifications.find((value, index) => {\n      return isEqual(path, value.path) && (value.type === ModifyType.Add || value.type === ModifyType.Insert || value.type === ModifyType.Clone);\n    });\n  }\n\n  /**\n   * 根据path获取ValueChange类型的变更记录\n   * @param path 变更路径\n   */\n  private findModifyItemsPath(path: any[]) {\n    return this.modifications.find((value, index) => {\n      return isEqual(path, value.path) && value.type === ModifyType.ValueChange;\n    });\n  }\n\n  /**\n   * 删除后代（包括自己）所有的删除变更\n   * @todo：临时做一个最小化修改\n   */\n  private removeDescendantRemoveModifications(parentRemoveModification: Modification): void {\n\n    const parentPathWithId = this.createRemovePathWithId(parentRemoveModification);\n\n    // 删除后代修改变更\n    this.modifications = this.modifications.filter((modification: Modification) => {\n      if (modification.type !== ModifyType.Remove) {\n        return true;\n      }\n      const descendantPathWithId = this.createRemovePathWithId(modification);\n      const isDescendant =  this.isDescendantPath(parentPathWithId, descendantPathWithId);\n      return !isDescendant;\n    });\n  }\n\n  /**\n   * 获取删除路径的完整格式\n   * @summary\n   * 1、目前删除变更的路径标记到父集合；\n   * 2、为了方便比较，将被删除的数据id加入到路径中\n   */\n  private createRemovePathWithId(modification: Modification) {\n    const path = modification.path;\n    const primaryKey = Object.keys(modification.value)[0];\n    const primaryKeyValue = modification.value[primaryKey];\n    const pathWithId = path.concat([`${primaryKey}:${primaryKeyValue}`]);\n    return pathWithId;\n  }\n\n  /**\n   * 判断是否是后代节点路径\n   * @param parentPath 父节点路径\n   * @param descendantPath 后代节点\n   */\n  private isDescendantPath(parentPath: string[], descendantPath: string[]) {\n    if (parentPath.length > descendantPath.length) {\n      return false;\n    }\n\n    let isDescendantPath = true;\n    parentPath.forEach((parentPathItem: string, parentPathItemIndex: number) => {\n      if (parentPathItem !== descendantPath[parentPathItemIndex]) {\n        isDescendantPath = false;\n        return;\n      }\n    });\n\n    return isDescendantPath;\n  }\n\n}\n\nexport { ChangeSet };\n\n","/*\n * @Author: Witt\n * @Date: 2018-12-27 09:25:38\n * @Last Modified by: Witt\n * @Last Modified time: 2018-12-27 09:39:10\n */\n\n\n/**\n * 路径类型\n */\nenum DataPathNodeType {\n\n  /**\n   * 标记该节点是一个实体主键值，用来在列表上定位一个实体\n   */\n  DataId   = 'DataId',\n\n  /**\n   * 标记该节点是一个属性名，用来在对象上定位一个属性\n   */\n  PropName = 'PropName',\n}\n\n\n/**\n * 路径节点\n */\nclass DataPathNode {\n\n  /**\n   * 上一节点\n   */\n  prev: DataPathNode;\n\n  /**\n   * 下一节点\n   */\n  next: DataPathNode;\n\n  /**\n   * 节点类型\n   */\n  type: DataPathNodeType;\n\n  /**\n   * 路径数据\n   * 对于List类型：  value是主键值，用于指明具体是哪一行；\n   * 对于Object类型：value是属性名，用于指明具体哪一属性。\n   */\n  value: any;\n\n  /**\n   * 构造函数\n   */\n  constructor(type: DataPathNodeType, data: any) {\n    this.type = type;\n    this.value = data;\n\n    this.prev = null;\n    this.next = null;\n  }\n}\n\n\nexport { DataPathNodeType, DataPathNode };\n","/*\n * @Author: Witt\n * @Date: 2019-08-14 14:11:51\n * @Last Modified by: Witt\n * @Last Modified time: 2019-08-14 16:11:51\n */\n\nimport { DataTypeInfo } from './data_type_info';\n\n\n/**\n * 实体属性分组\n */\nenum DataPropGroup {\n\n  /**\n   * 简单类型\n   */\n  Primitive = 'Primitive',\n\n  /**\n   * 实体类型\n   */\n  Object = 'Object',\n\n  /**\n   * 动态实体类型\n   */\n  Dynamic = 'Dynamic',\n\n  /**\n   * 列表类型\n   */\n  List = 'List'\n\n}\n\n\n/**\n * 实体属性信息\n */\nclass DataPropInfo {\n\n  /**\n   * 属性类型\n   */\n  public group: DataPropGroup;\n\n  /**\n   * 属性名称\n   */\n  public name: string;\n\n  /**\n   * 影射名称\n   */\n  public mapping: string;\n\n  /**\n   * 属性类型描述\n   */\n  public typeInfo: DataTypeInfo;\n\n  /**\n   * 元数据信息\n   * @todo\n   * 1、EntityPropInfo不应该认识元数据描述，不能强识别元数据上的属性；\n   * 2、将来元数据可能有多套，每一套有自己的解析 元数据解析框架还没有做，所以临时处理，不对暴露\n   */\n  public metadataInfo?: any;\n}\n\nexport {DataPropGroup, DataPropInfo };\n","/*\n * @Author: Witt\n * @Date: 2018-12-27 09:26:41\n * @Last Modified by: Witt\n * @Last Modified time: 2019-01-15 22:00:45\n */\n\nimport { DataPathNode, DataPathNodeType } from './data_path_node';\n/**\n * 变更路径（简单双向列表）\n */\nclass DataPath {\n\n  /**\n   * 头节点\n   */\n  public head: DataPathNode;\n\n  /**\n   * 长度\n   */\n  public length: number;\n\n  /**\n   * 构造函数\n   */\n  constructor() {\n    this.head = new DataPathNode(null, null);\n    this.length = 0;\n  }\n\n  /**\n   * 添加一个节点到头部\n   */\n  public unshift(type: DataPathNodeType, data: any) {\n    const newNode = new DataPathNode(type, data);\n    newNode.next = this.head.next;\n    newNode.prev = this.head;\n\n    this.head.next = newNode;\n    if (newNode.next) {\n      newNode.next.prev = newNode;\n    }\n\n    this.length++;\n  }\n\n  /**\n   * 在链表最后追加一个节点\n   */\n  public push(type: DataPathNodeType, data: any) {\n    const tailNode = this.getTail();\n    const newNode = new DataPathNode(type, data);\n    tailNode.next = newNode;\n    this.length++;\n  }\n\n  /**\n   * 获取链表尾部节点\n   */\n  public getTail(): DataPathNode {\n    let lastNode = this.head;\n    while (lastNode.next) {\n      lastNode = lastNode.next;\n    }\n    return lastNode;\n  }\n\n  /**\n   * 转换为数组格式\n   */\n  public toArray() {\n    const pathArray = [];\n    let currentNode = this.head.next;\n    while (currentNode) {\n      pathArray.push(`${currentNode.type}:${currentNode.value}`) ;\n      currentNode = currentNode.next;\n    }\n    return pathArray;\n  }\n\n  /**\n   * 转换为字符串格式\n   */\n  public toString() {\n    const pathArray = this.toArray();\n    const pathString = pathArray.join(', ');\n    return `[${pathString}]`;\n  }\n\n  /**\n   * 拷贝\n   */\n  public clone(): DataPath {\n    const newDataPath = new DataPath();\n    let curDataNode = this.head.next;\n    while (curDataNode) {\n      newDataPath.push(curDataNode.type, curDataNode.value);\n      curDataNode = curDataNode.next;\n    }\n    return newDataPath;\n  }\n}\n\nexport { DataPath };\n","import 'reflect-metadata';\nimport { makePropDecorator } from '../../core/index';\nimport { ClassType } from '../types';\nimport { PropMetadata } from './prop_meatadata';\n\n/**\n * 简单属性元数据\n */\nexport interface PrimitivePropMetadata extends PropMetadata {\n\n  /**\n   * 属性名称\n   */\n  property?: string;\n\n  /**\n   * 字段名称\n   */\n  dataField?: string;\n\n  /**\n   * 原始字段名称\n   */\n  originalDataField?: string;\n\n  /**\n   * 原始字段类型\n   */\n  originalDataFieldType?: string;\n\n  /**\n   * 是否为主键\n   */\n  primary?: boolean;\n\n  /**\n   * 是否为外键\n   */\n  foreign?: boolean;\n\n  /**\n   * 默认值\n   */\n  defaultValue?: any;\n\n  /**\n   * 验证规则\n   */\n  validRules?: any[];\n\n  /**\n   * 初始值，用于字段清空后\n   */\n  initValue?: any;\n\n  /**\n   * 启用多语录入\n   */\n  enableMultiLangInput?: boolean;\n}\n\n\n/**\n * 元数据名称\n */\nexport const PRIMITIVE_PROP_META = 'PrimitivePropMeta';\n\n\n/**\n * 【简单属性装饰器工厂】接口\n * @summary\n * 类型可以为：NgFieldProperty、string、ClassType\n * 当为string 时，则设其映射字段；\n * 当为ClassType时，则设置集合中的记录类型\n */\nexport interface PrimitivePropMetaDecorator {\n\n  (obj: PrimitivePropMetadata | string | ClassType): any;\n\n  (obj?: PrimitivePropMetadata | string | boolean): any;\n\n  new(obj?: PrimitivePropMetadata | string | boolean): any;\n}\n\n\n/**\n * 【简单属性装饰器工厂】的工厂\n */\nfunction makePrimitivePropMetaDecorator(options?: PrimitivePropMetadata | string | boolean): any {\n\n  let metadata: PrimitivePropMetadata = {\n    primary: false,\n    foreign: false\n  };\n\n  if (options) {\n    const paramType = typeof options;\n    switch (paramType) {\n      case 'boolean':\n        metadata.primary = Boolean(options);\n        break;\n      case 'string':\n        metadata.dataField = String(options);\n        break;\n      case 'object':\n        metadata = Object.assign(metadata, options);\n        break;\n    }\n  }\n  return metadata;\n}\n\n\n/**\n * 简单属性装饰器工厂\n */\nexport const PrimitivePropMeta: PrimitivePropMetaDecorator = makePropDecorator(PRIMITIVE_PROP_META, makePrimitivePropMetaDecorator);\n","class StringUtil {\n\n  /**\n     * 字符串格式化\n     */\n  public static format(value: string, options) {\n    const { maxLenght, prefix = '', suffix = '', ellipsis = '...' } = options;\n    if (!maxLenght) return value;\n    if (!value) return value;\n    if (maxLenght && value.length > maxLenght) {\n      value = value.slice(0, maxLenght)\n      return prefix + value + suffix + ellipsis;\n    }\n    return prefix + value + suffix;\n  }\n\n  public static filterSearchValue(value: any, options) {\n    if (value == undefined || value == null || value == '') {\n      return value;\n    }\n    value = value.trim();\n    if (options == undefined || options == null || options == '') {\n      value = value.replace(/[<>&\"]/g, function (c) { return { '<': '&lt;', '>': '&gt;', '&': '&amp;', '\"': '&quot;' }[c]; });\n      return value;\n    }\n    if (options && options.text == \"\") {\n      value = value.replace(/[<>&\"]/g, function (c) { return { '<': '&lt;', '>': '&gt;', '&': '&amp;', '\"': '&quot;' }[c]; });\n      return \"<p>\" + value + \"</p>\";\n    }\n    if (typeof options === 'string') {\n      const re = new RegExp(`${options}`, 'g');\n      let newStr = value.replace(re, `##s1p1##${options}##s2p2##`);\n      newStr = newStr.replace(/[<>&\"]/g, function (c) { return { '<': '&lt;', '>': '&gt;', '&': '&amp;', '\"': '&quot;' }[c]; });\n      newStr = newStr.replace(/##s1p1##/g, '<span style=\"color:red\">');\n      newStr = newStr.replace(/##s2p2##/g, \"</span>\");\n      return `<p>${newStr}</p>`;\n    }\n    if (typeof options === 'object') {\n      const { text, style } = options;\n      const re = new RegExp(`${text}`, 'g');\n      let newStr = value.replace(re, \"##s1p1##\" + style + \"##s2p2##\" + text + \"##s3p3##\");\n      newStr = newStr.replace(/[<>&\"]/g, function (c) { return { '<': '&lt;', '>': '&gt;', '&': '&amp;', '\"': '&quot;' }[c]; });\n      newStr = newStr.replace(/##s1p1##/g, \"<span style=\\\"\");\n      newStr = newStr.replace(/##s2p2##/g, \"\\\">\");\n      newStr = newStr.replace(/##s3p3##/g, \"</span>\");\n      return `<p>${newStr}</p>`;\n    }\n  }\n}\n\nexport { StringUtil };\n","class NumberUtil {\n\n  /**\n     * 数字格式化\n     * {\n     *   precision: 2,\n     *   decimal: true,\n     *   thousand: ','\n     *   prefix: '',\n     *   suffix: ''\n     * }\n     */\n  public static format(value, options) {\n\n    // 参数处理\n    let decimals = (options.precision || options.precision === 0) ? options.precision : 2;\n    let decimalPoint = options.decimal || '.';\n    let thousandsSep = options.thousand || '';\n    let prefix = options.prefix || '';\n    let suffix = options.suffix || '';\n\n    let prefixType = options.prefixType;\n    if (prefixType == \"dynamic\" && options.prefix) {\n      // 表示前缀为一个函数  那么执行函数定义\n      let prefixFunc = new Function(\"return \" + options.prefix);\n      prefix = prefixFunc()(options.sourceData);\n    }\n\n    value = (value + '').replace(/[^0-9+-Ee.]/g, '');\n    let s;\n\n    // 处理精度\n    let toFixedFix = function (n, prec) {\n      var k = Math.pow(10, prec);\n      return '' + parseFloat(Math.round(parseFloat((n * k).toFixed(prec * 2))).toFixed(prec * 2)) / k;\n    };\n    s = ((decimals || decimals === 0) ? toFixedFix(value, decimals) : '' + Math.round(value)).split('.');\n\n    // 处理千分位\n    if (thousandsSep) {\n      let pattern = /(-?\\d+)(\\d{3})/;\n      while (pattern.test(s[0])) {\n        s[0] = s[0].replace(pattern, \"$1\" + thousandsSep + \"$2\");\n      }\n      if ((s[1] || '').length < decimals) {\n        s[1] = s[1] || '';\n        s[1] += new Array(decimals - s[1].length + 1).join('0');\n      }\n    }\n\n    let formatedValue = s.join(decimalPoint);\n    formatedValue = `${prefix}${formatedValue}${suffix}`;\n    return formatedValue;\n  }\n\n}\n\nexport { NumberUtil };","/**\n * 布尔工具类\n */\nclass BoolUtil {\n  \n  /**\n   * 布尔值格式化\n  */\n  public static  format(value, options) {\n    if (value === true) {\n      return '是';\n    } else {\n      return '否';\n    }\n  }\n}\n\nexport { BoolUtil };\n\n\n","class EnumUtil {\n\n  /**\n   * 枚举格式化\n   * {\n   *  enumData: [\n   *    {value: 'value1', name: 'name1'},\n   *    {value: 'value2', name: 'name2'}\n   *  ]\n   * }\n   */\n  static format(value, options) {\n    const separator = options.separator;\n    const enumOptions = options.enumData;\n    let valueArry = []\n    if (value && separator) {\n      valueArry = value.split(separator);\n    }\n    if (valueArry.length > 1) {\n      const nameArry = valueArry.map(item => {\n        const targetEnumOption = enumOptions.find((enumOption) => {\n          return enumOption.value === item;\n        })\n        if (!targetEnumOption) {\n          console.error(`找不到${item}对应的枚举选项`);\n          return item;\n        }\n        return targetEnumOption.name;\n      })\n      return nameArry.join(separator);\n    }\n    const targetEnumOption = enumOptions.find((enumOption) => {\n      return enumOption.value === value;\n    });\n\n    if (!targetEnumOption) {\n      console.error(`找不到${value}对应的枚举选项`);\n      return value;\n    }\n\n    return targetEnumOption.name;\n  }\n}\n\nexport { EnumUtil };\n\n","import { format, isDate, parseISO, isEqual, compareAsc } from 'date-fns';\nimport dayjs from 'dayjs';\nimport IsBetween from 'dayjs/plugin/IsBetween';\nimport relativeTime from 'dayjs/plugin/relativeTime';\nimport Calendar from 'dayjs/plugin/calendar';\nimport 'dayjs/locale/zh-cn';\ndayjs.locale('zh-cn');\n/**\n * 日期处理类\n */\nclass DateUtil {\n\n  /**\n   * 空日期字符串（N版）\n   * @todo：兼容服务器端，不应该在devkit体现这种兼容，待移除\n   */\n  // static emptyDateTimeString = '0001-01-01T00:00:00';\n  static emptyDateTimeString = null;\n\n  /**\n   * 默认空日期字符串（ISO标准格式）\n   */\n  // static emptyISODateTimeString = '0001-01-01T00:00:00+00:00';\n  static emptyISODateTimeString = null;\n\n  /**\n   * 默认日期听格式\n   */\n  static defaultISOFormat = `yyyy-MM-dd'T'HH:mm:ssxxx`;\n\n  static defaultDisplayFormat = 'yyyy-MM-dd HH:mm:ss';\n\n  static defaultDateFormat = 'yyyy-MM-dd';\n\n  static defaultTimeFormat = 'HH:mm:ss';\n\n  /**\n   * 将日期（或日期字符串）转换为完整的的ISO格式的字符串\n   */\n  static formatISO(dateOrDateString: string | Date): string {\n    if (this.isEmptyDateOrDateString(dateOrDateString) === true) {\n      return this.emptyISODateTimeString;\n    }\n    const dateObj = this.parse(dateOrDateString);\n    return format(dateObj, this.defaultISOFormat);\n  }\n\n  /**\n   * 将日期（或日期字符串）转换为指定格式的字符串\n   * @param dateOrDateString 日期对象或符合ISO8601规范的日期字符串\n   * @param dateFormat 日期格式字符串\n   */\n  static format(dateOrDateString: string | Date, dateFormat?: string): string {\n    if (this.isEmptyDateOrDateString(dateOrDateString) === true) {\n      return this.emptyISODateTimeString;\n    }\n    const dateObj = this.parse(dateOrDateString);\n    dateFormat = dateFormat ? dateFormat : this.defaultDisplayFormat;\n    return format(dateObj, dateFormat);\n  }\n\n  static dateShow(dateOrDateString: string | Date, type: string) {\n    if (this.isEmptyDateOrDateString(dateOrDateString) === true) {\n      return this.emptyISODateTimeString;\n    }\n    if (!type || \"\" === type) {\n      return;\n    }\n    return this[type] && this[type](dateOrDateString)\n  }\n\n  static dateOperation(dateOrDateString: string | Date, options) {\n    if (this.isEmptyDateOrDateString(dateOrDateString) === true) {\n      return this.emptyISODateTimeString;\n    }\n    const { type = \"\", option } = options;\n    if (!type || \"\" === type) {\n      return;\n    }\n    if ('isSame' === type) {\n      return this[type] && this[type](dateOrDateString, options['targetDate'], options['granularity'])\n    }\n    if ('isBefore' === type) {\n      return this[type] && this[type](dateOrDateString, options['targetDate'], options['granularity'])\n    }\n    if ('isAfter' === type) {\n      return this[type] && this[type](dateOrDateString, options['targetDate'], options['granularity'])\n    }\n    if ('isBetween' === type ) {\n      return this[type] && this[type](dateOrDateString, options['targetDate'], options['targetDate2'], options['granularity'], options['contains'])\n    }\n    if (!option) {\n      return this[type] && this[type](dateOrDateString)\n    }\n    return this[type] && this[type](dateOrDateString, option)\n  }\n\n\n\n  static relativeTime(dateOrDateString: string | Date, option) {\n    dayjs.extend(relativeTime)\n    const dateObj = dayjs(dateOrDateString);\n    if (!option) {\n      return dayjs(dateObj).fromNow()\n    }\n    return dayjs(dateObj).fromNow(option)\n  }\n\n  static isToday(dateOrDateString: string | Date) {\n    const todayDate = new Date();\n    const dateObj = dayjs(dateOrDateString);\n    return this.isSame(dateObj, todayDate, 'date');\n  }\n\n  static calendar(dateOrDateString: string | Date, option) {\n    const dateObj = dayjs(dateOrDateString);\n    dayjs.extend(Calendar)\n    if (option) {\n      return dayjs().calendar(dateObj, { ...option })\n    }\n    return dayjs().calendar(dateObj, {\n      sameDay: '[今天] HH:mm',\n      nextDay: '[明天] HH:mm',\n      lastDay: '[昨天] HH:mm',\n      sameElse: 'YYYY-MM-DD'\n    })\n  }\n\n\n  /**\n   * 创建日期\n   * @param dateOrDateString 日期对象或符合ISO8601规范的日期字符串\n   */\n  static parse(dateOrDateString: string | Date): Date {\n    if (this.isEmptyDateOrDateString(dateOrDateString) === true) {\n      return null;\n    }\n\n    if (this.isDate(dateOrDateString) === true) {\n      return dateOrDateString as Date;\n    }\n\n    return parseISO(dateOrDateString as string);\n  }\n\n  /**\n   * 是否是日期对象\n   */\n  static isDate(date: any): boolean {\n    return isDate(date);\n  }\n\n  /**\n   * 是否是空日期或者空日期字符串\n   * @param dateOrDateString 日期或日期字符串\n   */\n  static isEmptyDateOrDateString(dateOrDateString: string | Date) {\n    if (this.isDate(dateOrDateString) === true) {\n      return this.isEmptyDate(dateOrDateString as Date);\n    }\n    return this.isEmptyDateString(dateOrDateString as string);\n  }\n\n  /**\n   * 是否为空日期字符串\n   * @param date 日期对象\n   */\n  static isEmptyDate(date: Date) {\n    if (!date) {\n      return true;\n    }\n    return false;\n  }\n\n  /**\n   * 是否是空日期字符串\n   * @param dateString 日期字符串\n   */\n  static isEmptyDateString(dateString: string) {\n    if (!dateString || dateString.startsWith('0001-01-01') === true) {\n      return true;\n    }\n    return false;\n  }\n\n  /**\n   * 两个日期是否相等\n   * @param dateOrDateString1 日期对象或字符串\n   * @param dateOrDateString1 日期对象或字符串\n   * @return 相等返回true，否则返回false\n   */\n  static isEqual(dateOrDateString1: string | Date, dateOrDateString2: string | Date): boolean {\n    const dateObj1 = this.parse(dateOrDateString1);\n    const dateObj2 = this.parse(dateOrDateString2);\n    if (dateObj1 === dateObj2) {\n      return true;\n    }\n    return isEqual(dateObj1, dateObj2);\n  }\n\n  /**\n   * 两个日期是否相等\n   * @param dateOrDateString1 日期对象或字符串\n   * @param dateOrDateString1 日期对象或字符串\n   * @return 返回-1、0、1\n   */\n  static compare(dateOrDateString1: string | Date, dateOrDateString2: string | Date) {\n    const dateObj1 = this.parse(dateOrDateString1);\n    const dateObj2 = this.parse(dateOrDateString2);\n    if (this.isEqual(dateObj1, dateObj2) === true) {\n      return 0;\n    }\n\n    // 处理解析后为null的场景，null比所有有效日期小\n    if (!dateObj1 && this.isDate(dateObj2) === true) {\n      return -1;\n    }\n    if (!dateObj2 && this.isDate(dateObj1) === true) {\n      return 1;\n    }\n\n    return compareAsc(dateObj1, dateObj2);\n  }\n\n\n  /**\n   * \n   * @param currentDate 当前日期\n   * @param targetDate 目标日期\n   * @param type 比较类型 date\tD\t天00:00 day\td\t星期00:00 month\tM\t月第一天00:00 year\ty\t1月1日00点 week\tw\t周第一天00:00hour\th\t00:00:00minute\tm\t00:00second\ts\t00millisecond\tms\t0\n   * @returns \n   */\n  static isSame(currentDate, targetDate, type?) {\n    if (type) {\n      return dayjs(currentDate).isSame(dayjs(targetDate), type)\n    }\n    return dayjs(currentDate).isSame(dayjs(targetDate));\n  }\n\n  /**\n   * \n   * @param currentDate 当前日期\n   * @param targetDate 目标日期\n   * @returns boolean\n   */\n  static isBefore(currentDate, targetDate, type?) {\n    if (type) {\n      return dayjs(currentDate).isBefore(dayjs(targetDate), type)\n    }\n    return dayjs(currentDate).isBefore(dayjs(targetDate));\n  }\n\n  /**\n * \n * @param currentDate 当前日期\n * @param targetDate 目标日期\n * @returns boolean\n */\n  static isAfter(currentDate, targetDate, type?) {\n    if (type) {\n      return dayjs(currentDate).isAfter(dayjs(targetDate), type)\n    }\n    return dayjs(currentDate).isAfter(dayjs(targetDate));\n  }\n\n\n  /**\n   * \n   * @param currentDate \n   * @param targetDate1 \n   * @param targetDate2 \n   * @returns \n   */\n  static isBetween(currentDate, targetDate1, targetDate2, type, contains) {\n    dayjs.extend(IsBetween)\n    if (type) {\n      return dayjs(currentDate).isBetween(dayjs(targetDate1), dayjs(targetDate2), type, contains);\n    }\n    return dayjs(currentDate).isBetween(dayjs(targetDate1), dayjs(targetDate2), null, contains);\n  }\n}\n\nexport { DateUtil };\n\n","/**\n * 变更相关定义\n * @author Witt<jiwt@inspur.com>\n */\n\n/**\n * 绑定数据变更\n */\nexport interface Change {\n\n  /**\n   * 变更类型\n   */\n  type: ChangeType;\n\n  /**\n   * 变更路径\n   */\n  path: string[];\n\n  /**\n   * 变更后的值\n   */\n  value?: any;\n\n  /**\n   * 变更前的值\n   */\n  preValue?: any;\n\n  /**\n   * 错误信息\n   */\n  errors?: any;\n\n  /**\n   * 验证后回调，会将验证结果传入\n   */\n  cb?: Function;\n\n  /**\n   * 是否提交过，为true时开启输入时验证\n   */\n  isSubmitted?: boolean;\n\n  /**\n   * 在grid中使用，如果存在id，则将errors在form中以\n   * {\n   *  [id]: errors\n   * }\n   * 的形式保存一份\n   */\n  id?: string;\n\n  isUdt?: boolean;\n\n  isGrid?: boolean;\n  create?: boolean;\n  [prop: string]: any;\n}\n\n/**\n * 绑定数据变更类型\n */\nexport enum ChangeType {\n  Load = 'Load',\n  Append = 'Append',\n  Remove = 'Remove',\n  Swap = 'Swap',\n  SelectionChanged = 'SelectionChanged',\n  ValueChanged = 'ValueChanged',\n  UpdateErrors = 'UpdateErrors',\n  GlobalSelectionChanged = 'GlobalSelectionChanged',\n  /**\n   * 分页信息变化\n   */\n  PaginationInfoChange = 'PaginationInfoChange',\n}\n\n/**\n * 视图变更\n */\nexport interface ViewChange {\n  type: ViewChangeType;\n  path: string[];\n  value: any;\n  preValue?: any;\n  [prop: string]: any;\n}\n\n/**\n * 视图变更类型\n */\nexport enum ViewChangeType {\n  ValueChanged\n}\n\n/**\n * Form值变化事件\n */\nexport interface FormValueChange {\n  path: string[]; // 字段路径\n  value: any; // 新值\n  preValue?: any; // 旧值\n  command: string; // 监听命令\n  entityChanged: boolean; // 实体是否已改变\n}\n\n/**\n * 实体值变化事件\n */\nexport interface EntityValueChange {\n  paths: string[]; // 字段路径\n  value: any; // 新值\n  preValue?: any; // 旧值\n  changed: boolean; // 实体是否已改变\n  [prop: string]: any;\n}","/**\n * 绑定属性相关定义\n * @author Witt<jiwt@inspur.com>\n */\n\n/**\n * 属性类型\n */\nexport enum BindingPropertyType {\n\n  /**\n   * 简单类型\n   */\n  Plain  = 'Plain',\n\n  /**\n   * 对象类型\n   */\n  Object = 'Object',\n\n  /**\n   * 列表类型\n   */\n  List   = 'List',\n\n  /**\n   * 动态类型\n   */\n  Dynamic = 'Dynamic'\n}\n\n\n/**\n * 绑定属性\n */\nexport interface BindingProperty {\n\n  /**\n   * 属性名称\n   */\n  name: string;\n\n  /**\n   * 属性类型\n   */\n  type: BindingPropertyType;\n\n  /**\n   * 对应实体类型，当属性类型为Object、List类型时，设置该属性。\n   */\n  entityType?: any;\n\n  /**\n   * 是否为主键\n   */\n  isPrimaryKey?: boolean;\n\n  /**\n   * 启用多语录入\n   */\n  enableMultiLangInput?: boolean;\n\n}\n","class ArrayUtil {\n\n  /**\n   * 从数组中删除一项\n   */\n  public static remove(arr: any[], itemToRemove: any): void {\n    const indexToRemove = arr.findIndex((item: any) => {\n      return item === itemToRemove;\n    });\n    this.removeByIndex(arr, indexToRemove);\n  }\n  \n  /**\n   * 从数组中删除indexToRemove对应的项\n   * @param index \n   */\n  public static removeByIndex(arr: any[], indexToRemove: number) {\n    if (!arr || arr[indexToRemove] !== undefined) {\n      \n    }\n    arr.splice(indexToRemove, 1);\n  }\n\n\n}\n\nexport { ArrayUtil };","class ObjectUtil {\n\n  /**\n   * 检查是否是简单对象\n   */\n  public static isPlainObject(value): boolean {\n    if (!(typeof value === 'object' && value !== null) || Object.prototype.toString.call({}) !== '[object Object]') {\n      return false;\n    }\n    if (Object.getPrototypeOf(value) === null) {\n      return true;\n    }\n    let proto = value;\n    while (Object.getPrototypeOf(proto) !== null) {\n      proto = Object.getPrototypeOf(proto);\n    }\n    return Object.getPrototypeOf(value) === proto;\n  }\n}\n\nexport { ObjectUtil };\n","/**\n * 数据路径处理\n */\nclass BindingPathConverter {\n\n  /**\n   * (BindingPathString | BindingPathArray) => BindingPathArray\n   * @param bindingPath BindingPath的字符串或者数组格式\n   * @return BindingPath数组\n   */\n  public static toBindingPathArray(bindingPath: string | string[]): string[] {\n    let bindingPathArray: string[];\n    if (typeof bindingPath === 'string') {\n      bindingPathArray = bindingPath.split('/').filter((part: string) => {\n        return part !== '';\n      });\n      return bindingPathArray;\n    } else {\n      bindingPathArray = bindingPath.concat([]);\n    }\n\n    return bindingPathArray;\n  }\n\n  /**\n   * BindingPathArray => BindingPathString\n   */\n  public static toBindingPathString(bindingPathArray: string[]): string {\n    return '/' + bindingPathArray.join('/');\n  }\n}\n\nexport { BindingPathConverter };\n","import { BindingPathConverter } from './binding_path_converter';\n\n/**\n * BindingPath比较器\n */\nclass BindingPathComparer {\n\n  /**\n   * 是否相等\n   */\n  public static isEqual(srcPath: string | string[], dstPath: string | string[]) {\n    const srcPathArray = BindingPathConverter.toBindingPathArray(srcPath);\n    const dstPathArray = BindingPathConverter.toBindingPathArray(dstPath);\n\n    const isEqual = srcPathArray.every((srcPathItem: string, srcPathIndex: number) => {\n      return srcPathItem === dstPathArray[srcPathIndex];\n    });\n\n    return isEqual;\n  }\n\n  /**\n   * 是否是父路径\n   */\n  public static isParent(childPath: string | string[], parentPath: string | string[]): boolean {\n\n    const childPathArray  = BindingPathConverter.toBindingPathArray(childPath);\n    const parentPathArray = BindingPathConverter.toBindingPathArray(parentPath);\n\n    // 长度差1个\n    if (childPathArray.length !== parentPathArray.length + 1) {\n      return;\n    }\n\n    return this.isAncestor(childPath, parentPath);\n  }\n\n  /**\n   * 是否是祖先路径\n   */\n  public static isAncestor(descendantPath: string | string[], ancestorPath: string | string[]): boolean {\n    const descendantPathArray = BindingPathConverter.toBindingPathArray(descendantPath);\n    const ancestorPathArray   = BindingPathConverter.toBindingPathArray(ancestorPath);\n\n    if (descendantPath.length <= ancestorPathArray.length) {\n      return false;\n    }\n\n    const isAncestor = ancestorPathArray.every((ancestorPathItem: string, ancestorPathIndex: number) => {\n      return ancestorPathItem === descendantPathArray[ancestorPathIndex];\n    });\n\n    return isAncestor;\n  }\n\n}\n\nexport { BindingPathComparer };\n","import { BindingPathConverter } from './binding_path_converter';\n\n/**\n * BindingPath遍历器\n */\nclass BindingPathTraverser {\n\n  /**\n   * 获取叶子节点的Path\n   */\n  public static getLeafPathString(bindingPath: string | string[]): string {\n    const bindingPathArray = BindingPathConverter.toBindingPathArray(bindingPath);\n    return bindingPathArray.pop();\n  }\n\n  /**\n   * 获取父路径\n   */\n  public static getParentPathString(bindingPath: string | string[]): string {\n    const bindingPathArray = BindingPathConverter.toBindingPathArray(bindingPath);\n    bindingPathArray.pop();\n    return '/' + bindingPathArray.join('/');\n  }\n}\n\nexport { BindingPathTraverser };\n","import {Type} from '../core/index';\nimport { Entity, FieldMetadataUtil } from '../entity/index';\nimport { BindingProperty, BindingPropertyType } from './binding_property';\n\n/**\n * 属性工具类\n */\nclass PropertyUtil {\n\n  /**\n   * 获取实体上的属性集合，并将他们转换成BindingProperty集合\n   * @param  entityType 实体类型\n   * @returns 绑定属性集合\n   */\n  static getProperties(entityType: Type<Entity>): BindingProperty[] {\n    const properties = [];\n\n    // Plain\n    const ngFieldProperties = FieldMetadataUtil.getNgFields(entityType);\n    Object.keys(ngFieldProperties).forEach((propertyName: string) => {\n      const ngFieldProperty = ngFieldProperties[propertyName];\n      properties.push({\n        name: propertyName,\n        type: BindingPropertyType.Plain,\n        isPrimaryKey: ngFieldProperty.primary,\n        isForeignKey: ngFieldProperty.foreign,\n        enableMultiLangInput: ngFieldProperty.enableMultiLangInput\n      });\n    });\n\n    // Object\n    const ngObjectProperties = FieldMetadataUtil.getNgObjects(entityType);\n    Object.keys(ngObjectProperties).forEach((propertyName: string) => {\n      const ngObjectProperty = ngObjectProperties[propertyName];\n      properties.push({\n        name: propertyName,\n        type: BindingPropertyType.Object,\n        entityType: ngObjectProperty.type\n      });\n    });\n\n    // List\n    const ngListProperties = FieldMetadataUtil.getNgList(entityType);\n    Object.keys(ngListProperties).forEach((propertyName: string) => {\n      const ngListProperty = ngListProperties[propertyName];\n      properties.push({\n        name: propertyName,\n        type: BindingPropertyType.List,\n        entityType: ngListProperty.type\n      });\n    });\n\n    // Dynamics\n    const ngDynamicProperties = FieldMetadataUtil.getNgDynamic(entityType);\n    Object.keys(ngDynamicProperties).forEach((propertyName: string) => {\n      const ngDynamicProperty = ngDynamicProperties[propertyName];\n      properties.push({\n        name: propertyName,\n        type: BindingPropertyType.Dynamic,\n        entityType: ngDynamicProperty.type\n      });\n    });\n\n    return properties;\n  }\n\n  static getDynamicProperties(dynamicData: any): BindingProperty[] {\n    const properties = [];\n    Object.keys(dynamicData).forEach((propertyName: string) => {\n      if (dynamicData.hasOwnProperty(propertyName)) {\n        if (dynamicData[propertyName] instanceof Object) {\n          properties.push({\n            name: propertyName,\n            type: BindingPropertyType.Dynamic,\n            entityType: null\n          });\n        } else {\n          properties.push({\n            name: propertyName,\n            type: BindingPropertyType.Plain,\n            isPrimaryKey: false,\n            isForeignKey: false\n          });\n        }\n      }\n    });\n    return properties;\n  }\n  /**\n   * 根据属性名获取属性\n   */\n  static getPropertyByName(properties: BindingProperty[], propertyName: string): BindingProperty {\n    const targetProperty =  properties.find((property: BindingProperty) => {\n      return property.name === propertyName;\n    });\n    return targetProperty;\n  }\n\n  /**\n   * 获取实体主键名\n   * @param properties 属性集合\n   * @returns 主键名\n   */\n  static getPrimaryKey(properties: BindingProperty[]): string {\n\n    // 实体必须有主键，如果没有主键在构造实体的时候就已经报错，这里不需要再进行检查\n    const primaryProperty = properties.find((property: BindingProperty) => {\n      return property.isPrimaryKey === true;\n    });\n    return primaryProperty ? primaryProperty.name : '';\n  }\n\n}\n\nexport { PropertyUtil };\n","/**\n * BindingObject相关定义\n * @author Witt<jiwt@inspur.com>\n */\n\nimport { Subject, Observable, of } from 'rxjs';\n\nimport { Change, ChangeType, ViewChange, ViewChangeType } from './changes';\nimport { BindingProperty, BindingPropertyType } from './binding_property';\nimport { BindingList } from './binding_list';\nimport { PropertyUtil } from './property_util';\n\ninterface InvokeOnValueChange {\n  (preValue, value, entityChanged: boolean): Observable<boolean>;\n}\n\n/**\n * BindingObject是Entity在绑定层的一个影射，它将Entity内的数据转换为不可变对象，并用于界面绑定。\n */\nclass BindingObject {\n\n  /**\n   * immutable值对象\n   */\n  private innerValues: Map<string, any>;\n\n  /**\n   * 父对象或父列表\n   */\n  public parent: BindingList | BindingObject;\n\n  /**\n   * 实体引起的变更\n   */\n  public changes: Subject<Change>;\n\n  /**\n   * 界面层引起的变更流\n   */\n  public viewChanges: Subject<ViewChange>;\n\n  /**\n   *  属性集合\n   */\n  public properties: BindingProperty[];\n\n  /**\n   * 主键名\n   */\n  public primaryKey: string;\n\n  /**\n   * 主键值\n   */\n  public get primaryKeyValue() {\n    return this.primaryKey ? this.getValue(this.primaryKey) : '';\n  }\n\n  /**\n   * 标识是否提交过\n   */\n  public isShowValidationMsg = false;\n\n  /**\n   * 以{ [propertyName]: FormControl }的形式存放每条数据的control\n   */\n  public controlMap: any = {};\n\n  /**\n   * 设置是否提交过\n   */\n  public setShowValidationMsg(flag: boolean) {\n    this.isShowValidationMsg = flag;\n  }\n\n\n  /**\n   * 构造函数\n   * @param properties 属性集合\n   */\n  constructor(properties: BindingProperty[]) {\n    this.properties = properties;\n    this.primaryKey = PropertyUtil.getPrimaryKey(properties);\n\n    this.innerValues = new Map<string, any>();\n    this.changes = new Subject<Change>();\n    this.viewChanges = new Subject<ViewChange>();\n  }\n\n  /**\n   * 根据属性名获取属性值\n   * @param   propertyName 属性名\n   * @returns 属性值\n   */\n  public getValue(propertyName: string): any {\n    return this.innerValues.get(propertyName);\n  }\n\n  /**\n   * 设置属性值\n   * @param propertyName        属性名\n   * @param propertyValue       属性值\n   * @param emitEventToView     是否通知View层去更新界面，默认为false\n   * @param emitEventToEntity   是否通知Entity层去更新值，默认为false\n   * @param errors              错误消息\n   * @param invokeOnValueChange 值变化事件执行句柄\n   */\n  public setValue(\n    propertyName: string, propertyValue: any,\n    emitEventToView: boolean = false, emitEventToEntity: boolean = false,\n    errors?: any, invokeOnValueChange?: InvokeOnValueChange\n  ): void {\n\n    const oldPropertyValue = this.getValue(propertyName);\n\n    // 由于特定原因（@邵珠强），无法屏蔽oldPropertyValue === propertyValue\n    if (oldPropertyValue === propertyValue) {\n      return;\n    }\n\n    if (!invokeOnValueChange || oldPropertyValue === propertyValue) {\n      // 设定缺省\n      invokeOnValueChange = function (preValue, value, entityChanged: boolean) {\n        return of(true);\n      };\n    }\n\n    if (emitEventToEntity === true) {\n      // BUG 322301，删除@2019.08.10; 如果无对应实体，则中止值传递; 这种情况发生在带从表的单据新增，从表响应Load变化的情况；\n      // if(!this.innerValues.has(propertyName)) {\n      //   return;\n      // }\n      // 执行实体值变化前事件\n      invokeOnValueChange(oldPropertyValue, propertyValue, false).subscribe((result) => {\n        if (result) {\n          // 如果成功，执行变化，并通知实体变化\n          this.innerValues = this.innerValues.set(propertyName, propertyValue);\n          const viewChange = {\n            type: ViewChangeType.ValueChanged,\n            path: [propertyName],\n            value: propertyValue,\n            errors: errors\n          };\n          this.viewChanges.next(viewChange);\n          // 如果需要通知视图，通知视图相应修改\n          if (emitEventToView === true) {\n            this.changes.next({\n              type: ChangeType.ValueChanged,\n              path: [propertyName],\n              value: propertyValue,\n              id: this.primaryKeyValue,\n              errors: errors\n            });\n          }\n          // 执行实体值变化后事件\n          invokeOnValueChange(oldPropertyValue, propertyValue, true).subscribe();\n        } else {\n          // 如果失败，不再通知实体变化\n          // 并执行界面回滚操作\n          this.changes.next({\n            type: ChangeType.ValueChanged,\n            path: [propertyName],\n            value: oldPropertyValue,\n            id: this.primaryKeyValue,\n            errors: errors\n          });\n        }\n      });\n    } else {\n      // `emitEventToEntity === false`, 则认定实体值已经发生变化，通知视图变化，并触发实体值变化后事件\n      this.innerValues = this.innerValues.set(propertyName, propertyValue);\n      if (emitEventToView === true) {\n        this.changes.next({\n          type: ChangeType.ValueChanged,\n          path: [propertyName],\n          value: propertyValue,\n          id: this.primaryKeyValue,\n          errors: errors\n        });\n      }\n      // 执行实体值变化后事件\n      invokeOnValueChange(oldPropertyValue, propertyValue, true).subscribe();\n    }\n  }\n\n  /**\n   * 将BindingObject实例转换成JSON对象\n   */\n  public toJSON(options?: any): any {\n    const langCode = window.localStorage.getItem('languageCode') || 'zh-CHS';\n    const result = {};\n    this.properties.forEach((property: BindingProperty) => {\n      const propName = property.name;\n      if (property.type === BindingPropertyType.List) {\n        const list: BindingList = this[propName];\n        result[propName] = list.toJSON(options);\n      } else if (property.type === BindingPropertyType.Object) {\n        const object: BindingObject = this[propName];\n        result[propName] = object.toJSON(options);\n      } else if (property.type === BindingPropertyType.Dynamic) {\n        const object: BindingObject = this[propName];\n        result[propName] = object.toJSON(options);\n      } else {\n\n        // 1、对于多语录入字段；\n        // 2、传入ignoreMultiLangInput标志，则取当前语言的值给控件。\n        if (options && options.ignoreMultiLangInput === true && property.enableMultiLangInput === true) {\n          const multiLangValueObj = this.getValue(propName);\n          if (multiLangValueObj) {\n            result[propName] = multiLangValueObj[langCode];\n          } else {\n            result[propName] = multiLangValueObj;\n          }\n        } else {\n          result[propName] = this.getValue(propName);\n        }\n      }\n    });\n\n    return result;\n  }\n}\n\nexport { BindingObject, InvokeOnValueChange };\n","/**\n * 绑定列表工厂相关定义\n * @author Witt<jiwt@inspur.com>\n */\n\nimport { BindingList } from './binding_list';\nimport { BindingProperty } from './binding_property';\n\n/**\n * BindingList工厂用于创建一个空的BindingList对象，并将当前行的属性影射到BindingList对象上。\n *\n * **示例代码**\n * ```ts\n * const deptProperties: BindingProperty[] = PropertyUtil.getProperties(DeptEntity);\n * const deptList = BindingListFactory.create(deptProperties);\n * ```\n */\nclass BindingListFactory {\n\n  /**\n   * 创建BindingList实例，并扩展其属性\n   * @param bindingProperties 绑定属性集合\n   */\n  static create(bindingProperties: BindingProperty[]): BindingList {\n    const bindingList = new BindingList(bindingProperties);\n    this.extendProperties(bindingList, bindingProperties);\n    return bindingList;\n  }\n\n  /**\n   * 扩展BindingList属性，将当前行上的属性映射到列表上\n   * @param bindingList       要扩展的绑定列表\n   * @param bindingProperties 绑定属性集合\n   */\n  static extendProperties(bindingList: BindingList, bindingProperties: BindingProperty[]) {\n\n    bindingProperties.forEach((bindingProperty: BindingProperty) => {\n      const propertyName = bindingProperty.name;\n      Object.defineProperty(bindingList, propertyName, {\n        get: () => {\n          return bindingList.currentItem[propertyName];\n        }\n      });\n    });\n  }\n}\n\nexport { BindingListFactory };\n\n","/**\n * 绑定对象工厂相关定义\n * @author Witt<jiwt@inspur.com>\n */\n\nimport { Change } from './changes';\nimport { PropertyUtil } from './property_util';\nimport { BindingProperty, BindingPropertyType } from './binding_property';\nimport { BindingObject } from './binding_object';\nimport { BindingListFactory } from './binding_list_factory';\n\n/**\n * BindingObject工厂用于创建一个空的BindingObject对象，并对其属性进行扩展。\n *\n * **扩展属性处理**\n *\n * 对于要扩展的属性（BindingProperty）有三种处理：\n * - 普通属性：初始化为一个undefined，并包装get、set方法，通过set方法监听变更；\n * - 对象属性：初始化为一个空的BindingObject对象，并监听子对象的变更；\n * - 列表属性：初始化为一个空的BindingList对象，并监听子列表的变更；\n *\n * **示例代码**\n *\n * ```ts\n *  const empProperties = PropertyUtil.getProperties(EmpEntity);\n * const empBindingObject = BindingObjectFactory.create(properties);\n * ```\n */\nclass BindingObjectFactory {\n\n  /**\n   * 创建BindingObject实例\n   * @param properties 要扩展的属性集合\n   * @returns 带扩展属性的空BindingObject对象\n   * @\n   */\n  static create(properties: BindingProperty[]): BindingObject {\n    const object = new BindingObject(properties);\n    this.extendProperties(object, properties);\n    return object;\n  }\n\n  static createDynamicBindingObject(data: any): BindingObject {\n    const properties = PropertyUtil.getDynamicProperties(data);\n    const object = new BindingObject(properties);\n    this.extendProperties(object, properties);\n    return object;\n  }\n\n  /**\n   * 扩展属性绑定对象的属性\n   * @param object     要扩展的绑定对象\n   * @param properties 绑定属性集合\n   */\n  static extendProperties(object: BindingObject, properties: BindingProperty[]): void {\n\n    // 扩展BindingObject属性\n    properties.forEach((property: BindingProperty) => {\n      if (property.type === BindingPropertyType.List) {\n        this.extendListProperty(object, property);\n      } else if (property.type === BindingPropertyType.Object) {\n        this.extendObjectProperty(object, property);\n      } else if (property.type === BindingPropertyType.Dynamic) {\n        this.extendDynamicObjectProperty(object, property);\n      } else {\n        this.extendPlainProperty(object, property);\n      }\n    });\n  }\n\n  /**\n   * 扩展列表类型的绑定属性\n   * @param object     要扩展的绑定对象\n   * @param properties 列表类型的绑定属性集合\n   */\n  static extendListProperty(object: BindingObject, property: BindingProperty): void {\n    const propertyName = property.name;\n    const childListProperties = PropertyUtil.getProperties(property.entityType);\n    const childList = BindingListFactory.create(childListProperties);\n\n    // 指定子List的parent、监听子List的changes事件\n    childList.parent = object;\n    childList.changes.subscribe((change: Change) => {\n      change.path.unshift(propertyName);\n      object.changes.next(change);\n    });\n\n    // 将子的BindingList实例赋值给当前属性\n    Object.defineProperty(object, propertyName, {\n      value: childList\n    });\n  }\n\n  /**\n   * 扩展对象类型的绑定属性\n   * @param object     要扩展的绑定对象\n   * @param properties 对象类型的绑定属性集合\n   */\n  static extendObjectProperty(object: BindingObject, property: BindingProperty): void {\n    const propertyName = property.name;\n    const childObjectProperties = PropertyUtil.getProperties(property.entityType);\n    const childObject = this.create(childObjectProperties);\n\n    // 指定子Object的parent、监听子Object的changes事件\n    childObject.parent = object;\n    childObject.changes.subscribe((change: Change) => {\n      change.path.unshift(propertyName);\n      object.changes.next(change);\n    });\n\n    Object.defineProperty(object, propertyName, {\n      value: childObject\n    });\n  }\n\n  static extendDynamicObjectProperty(object: BindingObject, property: BindingProperty): void {\n    const propertyName = property.name;\n    object[propertyName] = null;\n  }\n\n  static attachDynamicObjectProperty(object: BindingObject, propertyName: string, dynamicObject: BindingObject) {\n    dynamicObject.parent = object;\n    dynamicObject.changes.subscribe((change: Change) => {\n      change.path.unshift(propertyName);\n      object.changes.next(change);\n    });\n    Object.defineProperty(object, propertyName, {\n      value: dynamicObject\n    });\n  }\n\n  /**\n   * 扩展简单类型的绑定属性\n   * @param object     要扩展的绑定对象\n   * @param properties 简单类型的绑定属性集合\n   */\n  static extendPlainProperty(object: BindingObject, property: BindingProperty): void {\n    const propertyName = property.name;\n    Object.defineProperty(object, propertyName, {\n      get: () => {\n        return object.getValue(propertyName);\n      },\n      set: (value: any) => {\n        const oldValue = object.getValue(propertyName);\n        if (value === oldValue) {\n          return;\n        }\n        object.setValue(propertyName, value, true, true);\n      }\n    });\n  }\n\n}\n\nexport { BindingObjectFactory };\n","import { Repository } from '../repository/index';\nimport { Entity, EntityList, PARENT_CLASS, FieldMetadataUtil } from '../entity/index';\nimport { Modification, ModifyType } from '../changeset/index';\nimport { ViewChange, Change, ChangeType } from './changes';\nimport { BindingList } from './binding_list';\nimport { BindingObject } from './binding_object';\nimport { BindingProperty, BindingPropertyType } from './binding_property';\nimport { BindingObjectFactory } from './binding_object_factory';\nimport { Pagination } from '../core/index';\nimport { BindingData } from './binding_data';\n\n/**\n * 实体操作工具类\n */\nclass EntityUtil {\n\n  /**\n   * 将entity的数据加载到bindingObject中，并保持两者同步。\n   * @param entity        实体对象\n   * @param bindingObject 绑定对象\n   */\n  static loadEntity(entity: Entity, bindingObject: BindingObject) {\n\n    // 遍历bindingObject的properties进行赋值\n    bindingObject.properties.forEach((property: BindingProperty) => {\n      const propertyName = property.name;\n      if (property.type === BindingPropertyType.List) {\n        this.loadEntityList(entity[propertyName] || entity[PARENT_CLASS], bindingObject[propertyName]);\n      } else if (property.type === BindingPropertyType.Object) {\n        if (entity && entity[propertyName]) {\n          this.loadEntity(entity[propertyName], bindingObject[propertyName]);\n        }\n      } else if (property.type === BindingPropertyType.Dynamic) {\n        if (entity && entity[propertyName]) {\n          const dynamicObject = BindingObjectFactory.createDynamicBindingObject(entity[propertyName].data);\n          BindingObjectFactory.attachDynamicObjectProperty(bindingObject, propertyName, dynamicObject);\n          this.loadEntity(entity[propertyName], bindingObject[propertyName]);\n        }\n      } else {\n        bindingObject.setValue(propertyName, entity[propertyName], false, false);\n      }\n    });\n\n    this.setUpEntityPipeline(entity, bindingObject);\n  }\n\n  /**\n   * 建立entity和bindingObject之间的关联\n   * @param entity        实体对象\n   * @param bindingObject 绑定对象\n   */\n  static setUpEntityPipeline(entity: Entity, bindingObject: BindingObject) {\n\n    // 监听entity变更\n    entity.onValueChanged.subscribe((modification: Modification) => {\n      if (modification.type !== ModifyType.ValueChange || modification.path.length === 0) {\n        return;\n      }\n      const propertyName = modification.path[modification.path.length - 1];\n      const primaryKeyPath = modification.path[modification.path.length - 2];\n\n      // 验证主键是否匹配\n      // 存在主键并且主键不是id时才检查（值对象、关联对象不检查）\n      if (bindingObject.primaryKey && bindingObject.primaryKey === 'id') {\n        const primaryKey = bindingObject.primaryKey;\n        const primaryKeyValue = bindingObject.getValue(primaryKey);\n        if (primaryKeyPath !== `${primaryKey}:${primaryKeyValue}`) {\n          return;\n        }\n      }\n\n      // 值没有发生变化，不再设置\n      // TODO: 通过bindingObject修改entity属性值时，entity总会触发一个变更回来，如果不截获这个重复的变更，会导致重复或死循环\n      if (bindingObject.getValue(propertyName) === modification.value) {\n        return;\n      }\n      bindingObject.setValue(propertyName, modification.value, true, false, modification.errors);\n    });\n\n    // 监听bindingObject变更\n    bindingObject.viewChanges.subscribe((viewChange: ViewChange) => {\n      const value = viewChange.value;\n      const propertyName = viewChange.path[0];\n\n      let pathPrefix = '';\n      const pathData = entity.getPaths();\n      const paths = pathData.path;\n      let id = bindingObject['id'];\n      if (pathData.isUdt) {\n        // grid中udt没有id，从父级中取出id，以便存放验证信息\n        const getParentId = (target: any) => {\n          let parentId = '';\n          const findId = (item: any) => {\n            if (item && item && item['id']) {\n              parentId = item['id'];\n              return;\n            } else if (item['parent']) {\n              findId(item['parent']);\n            }\n          };\n          findId(target);\n          return parentId;\n        };\n        id = getParentId(bindingObject);\n        if (pathData.isGrid) {\n          // grid 将从表主字段去除\n          paths.shift();\n        }\n        if (paths.length) {\n          pathPrefix = paths.join('.') + '.';\n        }\n      }\n\n      // 不是主键值字段时，要先检查主键是否存在，并且主键是否相等（防止后代变更冒泡上来）\n      // 非主键属性变更时，要先检查主键是否匹配（如果主键也修改了，要求先修改主键再修改其他值）\n      if (bindingObject.primaryKey) {\n        const primaryKey = bindingObject.primaryKey;\n        if (propertyName !== primaryKey) {\n          if (!entity[primaryKey] || entity[primaryKey] !== bindingObject[primaryKey]) {\n            return;\n          }\n        }\n      }\n\n      // 如果BindingObject上的属性值和Entity上对应属性值一样，则不再设置\n      if (entity[propertyName] === value) {\n        return;\n      }\n\n      // 调用表单验证,通过后调用实体验证\n      // bingdingObject变化后，先调用实体上的验证，通过后再设置实体的变动\n      entity[propertyName] = value;\n    });\n  }\n\n  /**\n   * 将entityList中的Entity对象转换为BindingObject对象，加载到bindingList中，并保持entityList和bindingList同步。\n   * @param entityList  实体列表\n   * @param bindingList 绑定列表\n   */\n  static loadEntityList(entityList: EntityList<any>, bindingList: BindingList) {\n    this.loadEntities(entityList.items, bindingList);\n\n    this.setUpEntityListPipeline(entityList, bindingList);\n  }\n\n  /**\n   * 建立entityList和bindingList之间的关联\n   * @param entityList  实体列表\n   * @param bindingList 绑定列表\n   */\n  static setUpEntityListPipeline(entityList: EntityList<any>, bindingList: BindingList) {\n\n    entityList.onListChanged.subscribe((modification: Modification) => {\n      switch (modification.type) {\n        // 添加实体\n        case ModifyType.Add:\n        case ModifyType.Clone:\n          {\n            const entitiesToAdd = <Entity[]>modification.value;\n            if (entitiesToAdd.length === 0) {\n              return;\n            }\n            // 检查父id是否一致，冒泡导致的变更不处理\n            const paths = modification.path;\n            const parentPath = paths[paths.length - 2];\n            const parentId = bindingList.parent.primaryKeyValue;\n            if (parentPath.indexOf(parentId) === -1) {\n              return;\n            }\n\n            this.appendEntities(<Entity[]>modification.value, bindingList, modification.type === ModifyType.Clone);\n          }\n          break;\n        case ModifyType.Insert:\n          {\n            // 检查父id是否一致，冒泡导致的变更不处理\n            const paths = modification.path;\n            const parentPath = paths[paths.length - 2];\n            const parentId = bindingList.parent.primaryKeyValue;\n            const position = modification.position;\n            if (parentPath.indexOf(parentId) === -1) {\n              return;\n            }\n            this.insertEntity(modification.value[0], bindingList, position);\n          }\n          break;\n        // 删除实体\n        case ModifyType.Remove:\n          {\n            // 删除实体（value格式待商榷，目前value的格式为 { primaryKey: primaryValue}）\n            const id = modification.value[bindingList.primaryKey];\n            bindingList.removeByIds([id]);\n            // this.removeEntities(<Entity[]>modification.value, bindingList);\n          }\n          break;\n\n        // 加载实体\n        case ModifyType.Load:\n          const entities = modification.value;\n          this.loadEntities(entities, bindingList);\n          break;\n        default:\n          break;\n      }\n    });\n  }\n\n  /**\n   * 监听repository变化，保持repository和bindingList同步。\n   * @param repository  实体仓库\n   * @param bindingList 绑定列表\n   */\n  static loadRepository(repository: Repository<any>, bindingList: BindingList) {\n\n    // 初次加载\n    const entities = Array.from(repository.entityCollection.toArray());\n    this.loadEntities(entities, bindingList);\n\n    // 监听变化\n    repository.entityCollectionChange.subscribe((modification: Modification) => {\n      switch (modification.type) {\n        case ModifyType.Load:\n          this.loadEntities(<Entity[]>modification.value, bindingList, modification.entityCreate);\n          break;\n        case ModifyType.Add:\n        case ModifyType.Clone:\n          this.appendEntities(<Entity[]>modification.value, bindingList, modification.type === ModifyType.Clone);\n          break;\n        case ModifyType.AddData:\n          this.addData(<Entity[]>modification.value, bindingList);\n          break;\n        case ModifyType.Insert:\n          this.insertEntity(modification.value, bindingList, modification.position);\n          break;\n        case ModifyType.Remove:\n          this.removeEntities(<Entity[]>modification.value, bindingList);\n          break;\n        case ModifyType.RemoveData:\n          this.removeData(<Entity[]>modification.value, bindingList);\n          break;\n        case ModifyType.PaginationInfoChange:\n          bindingList.paginationInfo = <Pagination>modification.value;\n          break;\n        default:\n          break;\n      }\n    });\n\n    // 监听BindingList数据变化\n    bindingList.changes.subscribe((change: Change) => {\n      if (change.type === ChangeType.PaginationInfoChange) {\n        const entityCollection = repository.entityCollection;\n        // const entityTypeName = entityCollection.entityTypeName;\n        // const original = entityCollection.paginationInfo[entityTypeName];\n        // const entityPaginationInfo = Object.assign({}, original, change.value);\n        entityCollection.paginationInfo = Object.assign({}, entityCollection.paginationInfo, change.value);\n      }\n    });\n  }\n\n  /**\n   * 将entities中的Entity对象转换为BindingObject对象，并加载到bindingList中\n   * @param entities    实体数组\n   * @param bindingList 绑定列表\n   */\n  static loadEntities(entities: Entity[], bindingList: BindingList, entityCreate: boolean = false) {\n    const bindingObjects = this.createBindingObjects(entities, bindingList);\n    bindingList.load(bindingObjects, entityCreate);\n  }\n\n  /**\n   * 将entities中的Entity对象转换为BIndingObject对象，并追加到bindingList中\n   * @param entities    实体数组\n   * @param bindingList 绑定列表\n   */\n  static appendEntities(entities: Entity[], bindingList: BindingList, isCloned: boolean = false) {\n    const bindingObjects = this.createBindingObjects(entities, bindingList);\n    bindingList.append(bindingObjects, isCloned);\n  }\n  /**\n   * 增加实体数据（不切换当前行）\n   * @param entities \n   * @param bindingList \n   */\n  static addData(entities: Entity[], bindingList: BindingList) {\n    const bindingObjects = this.createBindingObjects(entities, bindingList);\n    bindingList.addData(bindingObjects);\n  }\n  static insertEntity(entity: Entity, bindingList: BindingList, position: -1 | 1) {\n    const bindingObject = this.createBindingObject(entity, bindingList);\n    bindingList.insert(bindingObject, position);\n  }\n  /**\n   * 从bindingList移除entities对应的BindingObject对象\n   * @param entities    实体数组\n   * @param bindingList 绑定列表\n   */\n  static removeEntities(entities: Entity[], bindingList: BindingList) {\n    if (entities === null || entities.length === 0) {\n      return;\n    }\n\n    // 归集要删除的id数组\n    const primaryKey = bindingList.primaryKey;\n    const ids = [];\n    entities.forEach((entity: Entity) => {\n      ids.push(entity[primaryKey]);\n    });\n    bindingList.removeByIds(ids);\n  }\n  static removeData(entities: Entity[], bindingList: BindingList) {\n    if (entities === null || entities.length === 0) {\n      return;\n    }\n    // 归集要删除的id数组\n    const primaryKey = bindingList.primaryKey;\n    const ids = [];\n    entities.forEach((entity: Entity) => {\n      ids.push(entity[primaryKey]);\n    });\n    bindingList.removeDataByIds(ids);\n  }\n  /**\n   * 将entities中的Entity对象转换为BindingObject对象\n   * @param entities    实体数组\n   * @param bindingList 绑定列表\n   */\n  static createBindingObjects(entities: Entity[], bindingList: BindingList) {\n\n    if (entities === null || entities.length === 0) {\n      return [];\n    }\n\n    const bindingObjects = [];\n    entities.forEach((entity: Entity) => {\n      const bindingObject = BindingObjectFactory.create(bindingList.properties);\n      bindingObject['_ENTITY_'] = entity;\n      this.loadEntity(entity, bindingObject);\n\n      // // 为bindingObject设置默认值initialData属性\n      // if (entity['initialData']) {\n      //   bindingObject['initialData'] = entity['initialData'];\n      // }\n\n      bindingObjects.push(bindingObject);\n    });\n    return bindingObjects;\n  }\n  static createBindingObject(entity: Entity, bindingList: BindingList) {\n    const bindingObject = BindingObjectFactory.create(bindingList.properties);\n    this.loadEntity(entity, bindingObject);\n    return bindingObject;\n  }\n  public static watchReposiroty(repository: Repository<any>, bindingData: BindingData) {\n    // reposiroty => bindingData\n    repository.entityCollectionChange.subscribe((modification: Modification) => {\n      switch (modification.type) {\n        case ModifyType.PaginationInfoChange:\n          bindingData.pagingInfo = modification.value;\n          break;\n        default:\n          break;\n      }\n    });\n  }\n  /**\n   * 查找属性的类型\n   * @param entityType 实体类型\n   * @param targetPropName 属性名称\n   * @return 属性信息，包含属性类型（NgField、NgObject、NgList）和属性对应的实体类型（当NgField类型时为null）\n   */\n  static getPropInfo(entityType: any, targetPropName: string): { propType: string, propEntityType: any } {\n\n    let propType: string;\n    let propEntityType: any;\n\n    // NgField\n    const ngFieldProperties = FieldMetadataUtil.getNgFields(entityType);\n    Object.keys(ngFieldProperties).forEach((propName: string) => {\n      if (propName === targetPropName) {\n        propType = 'NgField';\n        propEntityType = null;\n      }\n    });\n\n    // NgObject\n    const ngObjectProperties = FieldMetadataUtil.getNgObjects(entityType);\n    Object.keys(ngObjectProperties).forEach((propName: string) => {\n      if (propName === targetPropName) {\n        propType = 'NgObject';\n        propEntityType = ngObjectProperties[propName].type;\n      }\n    });\n\n    // NgList\n    const ngListProperties = FieldMetadataUtil.getNgList(entityType);\n    Object.keys(ngListProperties).forEach((propName: string) => {\n      if (propName === targetPropName) {\n        propType = 'NgList';\n        propEntityType = ngListProperties[propName].type;\n      }\n    });\n\n    const ngDynamicProperties = FieldMetadataUtil.getNgDynamic(entityType);\n    Object.keys(ngDynamicProperties).forEach((propName: string) => {\n      if (propName === targetPropName) {\n        propType = 'NgDynamic';\n        propEntityType = ngDynamicProperties[propName].type;\n      }\n    });\n\n    return { propType, propEntityType };\n  }\n\n  /**\n   * 获取实体的主键名\n   * @param entityType 实体类型\n   */\n  static getPrimaryKey(entityType: any) {\n    const primaryNgFiledProp = FieldMetadataUtil.getPrimaryFieldMetadata(entityType);\n    if (primaryNgFiledProp) {\n      return primaryNgFiledProp.dataField;\n    } else {\n      return '';\n    }\n  }\n\n  /**\n   * 是否为对象属性\n   */\n  static isObjectProp(entityType: any, targetPropName: string,) {\n    let isObjectProp = false;\n    const ngObjectProperties = FieldMetadataUtil.getNgObjects(entityType);\n    Object.keys(ngObjectProperties).forEach((propName: string) => {\n      if (propName === targetPropName) {\n        isObjectProp = true;\n      }\n    });\n    return isObjectProp;\n  }\n\n  /**\n   * 检查是否是动态列属性\n   */\n  static isDynamicProp(entityType: any, targetPropName: string) {\n    let isDynamicProp = false;\n    const ngDynamicProperties = FieldMetadataUtil.getNgDynamic(entityType);\n    Object.keys(ngDynamicProperties).forEach((propName: string) => {\n      if (propName === targetPropName) {\n        isDynamicProp = true;\n      }\n    });\n    return isDynamicProp;\n  }\n\n  /**\n   * 为实体增加initialData属性\n   * @param entity 实体实例\n   * @param initialData 默认值对象\n   */\n  static appendInitialData(entity, initialData) {\n    const data = Object.assign({}, initialData);\n    delete data.id;\n    delete data.parentID;\n    entity['initialData'] = data;\n  }\n}\n\nexport { EntityUtil };\n","// tslint:disable: max-line-length member-ordering\n/**\n * 绑定数据相关定义\n * @author Witt<jiwt@inspur.com>\n * @todo\n * 1、全局的BindingData和局部的BindingData应该拆成两个类，两个类之间是装饰关系；；\n * 2、为了保持兼容，减少改动量，暂时放在一起，待进一步重构。\n */\n\nimport { Subject } from 'rxjs';\n\nimport { DataTypeInfo } from '../entity/entity-type-info/index';\nimport { Repository } from '../repository/index';\nimport { ViewModelContext } from '../view-model/index';\nimport { Change, ChangeType } from './changes';\nimport { BindingProperty } from './binding_property';\nimport { BindingList } from './binding_list';\nimport { BindingListFactory } from './binding_list_factory';\nimport { PropertyUtil } from './property_util';\nimport { EntityUtil } from './entity_util';\nimport { InvokeOnValueChange } from './binding_object';\n\n/**\n * BindingData\n */\n\nclass BindingData {\n\n  private viewModelContext: ViewModelContext;\n\n  /**\n   * 数据类型描述\n   */\n  public dataTypeInfo: DataTypeInfo;\n\n  /**\n   * 绑定该路径\n   */\n  public get bindingPath(): string {\n    if (this.viewModelContext && this.viewModelContext.viewModel.bindingPath) {\n      return this.viewModelContext.viewModel.bindingPath;\n    }\n    return '/';\n  }\n\n  /**\n   * 可绑定的属性描述\n   */\n  public properties: BindingProperty[];\n\n  /**\n   * 数据列表\n   */\n  public list: BindingList;\n  private paginationInfo = null;\n\n  public set pagingInfo(pagingInfo: any) {\n    this.paginationInfo = pagingInfo;\n    this.firePagingChangeEvent();\n  }\n\n  public get pagingInfo() {\n    return this.paginationInfo;\n  }\n  /**\n   * 设置分页信息\n   * @param skip 跳过\n   * @param take 获取\n   * @param bindingPath 路径\n   */\n  public setPagingInfo(skip: number, take: number, bindingPath: string) {\n    if (bindingPath.length < 1 || bindingPath === '/') {\n      this.paginationInfo = Object.assign(this.paginationInfo, { pageSize: take, pageIndex: skip / take + 1 });\n    } else {\n      let pagingInfo = this.paginationInfo || {};\n      const bindingPaths = bindingPath.substr(1).split('/').filter(item => !!item && item.length > 0).map(item => item.substring(0, item.length - 1));\n      bindingPaths.forEach(path => {\n        if (!pagingInfo.hasOwnProperty(path)) {\n          pagingInfo[path] = {};\n        }\n        pagingInfo = pagingInfo[path];\n      });\n      pagingInfo.pageIndex = ((skip / take) || 0) + 1;\n      pagingInfo.pageSize = take || 0;\n    }\n    this.firePagingChangeEvent();\n  }\n  private firePagingChangeEvent() {\n    this.list.changes.next({\n      type: ChangeType.PaginationInfoChange,\n      path: [],\n      value: this.paginationInfo\n    });\n  }\n  /**\n   * 变更集\n   */\n  public get changes(): Subject<Change> {\n    return this.list.changes;\n  }\n\n  /**\n   * 值变化执行器工厂，根据路径产生执行器\n   */\n  private valueChangeInvokerFactory: (paths: string[]) => InvokeOnValueChange;\n\n  /**\n   * 设置值变化执行器工厂\n   * @param value 值变化执行器工厂\n   */\n  public setValueChangeInvokerFactory(value: (paths: string[]) => InvokeOnValueChange) {\n    this.valueChangeInvokerFactory = value;\n  }\n\n  /**\n   * 初始化（已废弃）\n   */\n  public init(repository: Repository<any>, bindingPath: string) {\n    this.initByRepository(repository, null);\n  }\n\n  /**\n   * 根据Repository对BindingData进行初始化\n   */\n  public initByRepository(repository: Repository<any>, viewModelContext: ViewModelContext) {\n    this.viewModelContext = viewModelContext;\n\n    this.properties = PropertyUtil.getProperties(repository.entityType);\n    this.list = BindingListFactory.create(this.properties);\n    // 从repository初始化bindingData\n    this.pagingInfo = repository.entityCollection.paginationInfo;\n\n    // @todo\n    // BindingData不应该知道Repository，加载数据、建立关联关系的过程应该转移到外边\n    EntityUtil.loadRepository(repository, this.list);\n    this.dataTypeInfo = repository.entityTypeInfo;\n\n    this.extendProperties(this.properties);\n  }\n\n  /**\n   * 初始化\n   */\n  public initByBindingList(bindingList: BindingList,  viewModelContext: ViewModelContext, dataTypeInfo: DataTypeInfo) {\n    this.list = bindingList;\n    this.viewModelContext = viewModelContext;\n    this.dataTypeInfo = dataTypeInfo;\n    this.extendProperties(this.list.properties);\n  }\n\n  /**\n   * 获取paths对应的属性值\n   * @param  paths 属性路径数组\n   * @returns 属性值\n   */\n  public getValue(paths: string[]) {\n    let target: any = this.list;\n    paths.forEach((path: string) => {\n      if (target) {\n        target = target[path];\n      }\n    });\n    return target;\n  }\n\n  /**\n   * 根据paths设置属性值\n   * @param paths 属性路径数组\n   * @param value 属性值\n   * @param emitEventToView 如果设置为true，则发送事件通知订阅它的组件、指令去更新界面，默认为false。\n   * @param emitEventToEntity 如果设置为true，则同步去更新Entity上对应的字段，默认为true。\n   */\n  public setValue(paths: string[], value: any, emitEventToView: boolean = false, emitEventToEntity: boolean = true) {\n\n    if (!paths || paths.length === 0) {\n      throw Error('路径不能为空');\n    }\n    const parentPaths = paths.slice(0, paths.length - 1);\n    const propName = paths[paths.length - 1];\n\n    let parent = this.getValue(parentPaths);\n    if (!parent) {\n      throw Error('找不到要设置的对象');\n    }\n    if (parent instanceof BindingData) {\n      parent = parent.list.currentItem;\n    } else if (parent instanceof BindingList) {\n      parent = parent.currentItem;\n    }\n    if (!!this.valueChangeInvokerFactory) {\n      parent.setValue(propName, value, emitEventToView, emitEventToEntity, null, this.valueChangeInvokerFactory(paths));\n    } else {\n      parent.setValue(propName, value, emitEventToView, emitEventToEntity);\n    }\n  }\n\n  /**\n   * 根据paths清空属性值\n   */\n  public clearValue(paths: string[], emitEventToView: boolean = false, emitEventToEntity: boolean = true) {\n    let initValue: any;\n    const propInfo = this.dataTypeInfo.getPropInfoByPath(paths);\n    if (propInfo && propInfo.metadataInfo && propInfo.metadataInfo.initValue !== undefined) {\n      initValue = propInfo.metadataInfo.initValue;\n    } else {\n\n      // 原来的帮助映射中，强行纠正了数值的情况，保持一致\n      const oldValue = this.getValue(paths);\n      if (typeof oldValue === 'number') {\n        initValue = 0;\n      } else {\n        initValue = '';\n      }\n    }\n    this.setValue(paths, initValue, emitEventToView, emitEventToEntity);\n  }\n\n  /**\n   * 获取当前列表\n   */\n  public getList() {\n\n    if (!this.bindingPath || this.bindingPath === '/') {\n      return this.list;\n    }\n\n    const bindingPath = this.bindingPath.substr(1);\n    const bindingPathArray = bindingPath.split('/').filter((part: string) => {\n      return part !== '';\n    });\n    return this.getValue(bindingPathArray);\n  }\n\n  /**\n   * 获取当前对象\n   */\n  public getObject() {\n    const bindingList = this.getList();\n    return bindingList.currentItem;\n  }\n  /**\n   * 绑定路径（仅路径部分，不包括属性）\n   * @param bindingPath 绑定路径\n   */\n  public getPath(bindingPath?: string[]) {\n    const bindingPaths = bindingPath.filter(p => p);\n    const path = [`${this.list.primaryKey}:${this.list.currentId}`];\n\n    bindingPaths.forEach((item: string) => {\n      path.push(item);\n      const list = this[item] as BindingList;\n      if (list) {\n        path.push(`${list.primaryKey}:${list.currentId}`);\n      }\n    });\n    return path;\n  }\n  /**\n   * 通过绑定路径获取属性初始值\n   * @param paths 绑定路径\n   */\n  private getInitValueByPaths(paths: Array<string>) {\n    let initValue: any;\n    const propInfo = this.dataTypeInfo && this.dataTypeInfo.getPropInfoByPath(paths) || null;\n    if (propInfo && propInfo.metadataInfo && propInfo.metadataInfo.initValue !== undefined) {\n      initValue = propInfo.metadataInfo.initValue;\n    }\n    return initValue;\n  }\n  /**\n   * 扩展BindingData属性，映射BindingData所持有的绑定列表当前行的属性，减少绑定层级。\n   * @param properties 关联实体的属性集合\n   */\n  private extendProperties(properties: BindingProperty[]) {\n    properties.forEach((property: BindingProperty) => {\n      const propName = property.name;\n      Object.defineProperty(this, propName, {\n        get: () => {\n          return this.list.currentItem[propName];\n        },\n        set: (value: any) => {\n          this.list.currentItem[propName] = value;\n        }\n      });\n    });\n  }\n}\n\nexport { BindingData };\n","import { Subject } from 'rxjs';\n\nimport { ArrayUtil } from '../utils/index';\nimport { Change, ChangeType } from './changes';\nimport { BindingData } from './binding_data';\nimport { BindingObject } from './binding_object';\nimport { BindingProperty } from './binding_property';\nimport { BindingObjectFactory } from './binding_object_factory';\nimport { PropertyUtil } from './property_util';\n\n/**\n * BindingList是一个BindingObject集合\n */\nclass BindingList {\n\n  /**\n   * immutable的BindingObject列表\n   */\n  private innerList: BindingObject[];\n\n  private emptyCurrentItem: BindingObject;\n\n  /**\n   * 关联实体的属性集合\n   */\n  public properties: BindingProperty[];\n\n  /**\n   * 主键名\n   */\n  public primaryKey: string;\n\n  /**\n   * 父对象\n   */\n  public parent: BindingObject;\n\n  /**\n   * 变更流\n   */\n  public changes: Subject<Change>;\n\n  /**\n   * 当前行对应的绑定对象的内码\n   */\n  public currentId: string;\n\n  //#region 分页相关\n\n  /**\n   * 分页信息\n   */\n  public _paginationInfo: any = null;\n\n  set paginationInfo(sPaginationInfo: any) {\n    this._paginationInfo = sPaginationInfo;\n    if (this._paginationInfo === sPaginationInfo) {\n      return;\n    }\n    this.changes.next({\n      type: ChangeType.PaginationInfoChange,\n      path: [],\n      value: this._paginationInfo\n    });\n  }\n\n  get paginationInfo(): any {\n    return this._paginationInfo;\n  }\n  /**\n   * 获取页码\n   */\n  get pageIndex() {\n    if (!!this.paginationInfo && this.paginationInfo.hasOwnProperty(\"pageIndex\")) {\n      return this.paginationInfo.pageIndex;\n    }\n    return 1;\n  }\n  /**\n   * 获取分页大小\n   */\n  get pageSize() {\n    if (!!this.paginationInfo && this.paginationInfo.hasOwnProperty(\"pageSize\")) {\n      return this.paginationInfo.pageSize;\n    }\n    return 0;\n  }\n\n  /**\n   * 获取数据总项数\n   */\n  get total() {\n    if (!!this.paginationInfo) {\n      return this.paginationInfo.total || this.paginationInfo.totalCount;\n    }\n    return 0;\n  }\n  /**\n   * 获取跳过的数据条数\n   */\n  get skip() {\n    const pageIndex = this.pageIndex;\n    const pageSize = this.pageSize;\n    return (pageIndex - 1) * pageSize;\n  }\n\n  /**\n   * 前台设置分页信息\n   * @param skip skip\n   * @param take take\n   */\n  public setPaginationInfo(skip: number, take: number) {\n    this.paginationInfo = Object.assign({}, this.paginationInfo, {\n      pageSize: take,\n      pageIndex: skip / take + 1\n    });\n    /*this.changes.next({\n      type: ChangeType.PaginationInfoChange,\n      path: [],\n      value: this.paginationInfo\n    });*/\n  }\n  //#endregion\n\n\n\n  /**\n   * 当前行对应的绑定对象\n   * 如果currentId为null，则创建一个空结构，防止绑定报错；\n   */\n  public get currentItem(): BindingObject {\n    const currentItem = this.findById(this.currentId);\n    if (!currentItem) {\n      if (!this.emptyCurrentItem) {\n        this.emptyCurrentItem = BindingObjectFactory.create(this.properties);\n      }\n      return this.emptyCurrentItem;\n    }\n    return currentItem;\n  }\n\n  /**\n   * 绑定对象的数量\n   */\n  public get length(): number {\n    return this.innerList.length;\n  }\n\n  /**\n   * 构造函数\n   */\n  constructor(properties: BindingProperty[]) {\n    this.properties = properties;\n    this.primaryKey = PropertyUtil.getPrimaryKey(properties);\n\n    this.changes = new Subject<Change>();\n    this.innerList = [];\n    this.currentId = null;\n  }\n\n  /**\n   * 添加[Symbol.iterator]，使之能通过for of遍历\n   */\n  [Symbol.iterator]() {\n    const self = this;\n    let index = -1;\n    const size = this.innerList.length;\n\n    return {\n      next: function () {\n        index++;\n        if (index < size) {\n          return {\n            done: false,\n            value: self.innerList[index]\n          };\n        }\n        return { done: true, value: undefined };\n      }\n    };\n  }\n\n  /**\n   * 批量加载绑定对象，加载之前先清空绑定列表，并重置当前行，加载之后将第一行设置为默认当前行。\n   * @param objects 要加载绑定对象数组\n   */\n  public load(objects: BindingObject[], entityCreate: boolean = false): void {\n\n    // 重置列表\n    this.innerList = [];\n\n    if (objects.length !== 0) {\n      // 加载数据\n      objects.forEach((object: BindingObject) => {\n        this.add(object);\n      });\n\n      // 设置默认当前行\n      const currentItem = this.findById(this.currentId);\n      if (!currentItem) {\n        const firstId = objects[0][this.primaryKey];\n        this.setCurrentId(firstId, false, false);\n      }\n    } else {\n      this.currentId = null;\n    }\n\n    const change: Change = {\n      type: ChangeType.Load,\n      path: [],\n      value: objects\n    };\n    change.create = entityCreate;\n\n    // 触发事件\n    this.changes.next(change);\n  }\n\n  /**\n   * 批量追加绑定对象，追加之后将最后一个追加的绑定对象设置为当前行。\n   * @param objects 要加载绑定对象数组\n   */\n  public append(objects: BindingObject[], isCloned: boolean = false): void {\n\n    if (objects.length === 0) {\n      return;\n    }\n\n    // 加载BindingObject\n    objects.forEach((object: BindingObject) => {\n      this.add(object);\n    });\n\n    // 当前行为新追加的最后1行\n    const lastId = objects[objects.length - 1][this.primaryKey];\n    this.setCurrentId(lastId, true, true);\n\n    // 触发事件\n    const change: Change = {\n      type: ChangeType.Append,\n      path: [],\n      value: objects\n    };\n    if (isCloned) {\n      change.isCloned = true;\n    }\n    this.changes.next(change);\n  }\n  /**\n   * 增加数据\n   * @param objects 实体\n   * @description 增加实体数据，但不切换当前行\n   */\n  public addData(objects: BindingObject[]): void {\n    if (objects.length === 0) {\n      return;\n    }\n    // 加载BindingObject\n    objects.forEach((object: BindingObject) => {\n      this.add(object);\n    });\n    // 触发事件\n    this.changes.next({\n      type: ChangeType.Append,\n      path: [],\n      value: objects\n    });\n  }\n  public insert(object: BindingObject, position?: 1 | -1) {\n    // const currentIndex = this.innerList.findIndex((obj: BindingObject) => obj.primaryKeyValue === this.currentId);\n    // // 加载BindingObject\n    // if (position === 1) {\n    //   this.innerList = this.innerList.insert(currentIndex + 1, object);\n    // } else if (position === -1) {\n    //   this.innerList = this.innerList.insert(currentIndex, object);\n    // } else {\n    //   this.innerList = this.innerList.push(object);\n    // }\n    // object.parent = this;\n    // // 监听object变更，并继续向上抛，由于list有当前行的概念，不需要在path中追加路径\n    // object.changes.subscribe((change: Change) => {\n    //   this.changes.next(change);\n    // });\n\n    // this.setCurrentId(object.primaryKeyValue, true, true);\n\n    // // 触发事件\n    // this.changes.next({\n    //   type: ChangeType.Append,\n    //   path: [],\n    //   value: object\n    // });\n  }\n  /**\n   * 添加绑定对象，并建立绑定对象和绑定列表之间的关联。\n   * @param object 绑定对象\n   */\n  public add(object: BindingObject) {\n    this.innerList.push(object);\n    object.parent = this;\n\n    // 监听object变更，并继续向上抛，由于list有当前行的概念，不需要在path中追加路径\n    object.changes.subscribe((change: Change) => {\n      this.changes.next(change);\n    });\n  }\n\n  /**\n   * 删除主键值数组对应的绑定对象。\n   * @param ids 主键值数组\n   */\n  public removeByIds(ids: Array<string>): void {\n    if (!ids || ids.length === 0) {\n      return;\n    }\n\n    let nextCurrentId = this.currentId;\n    ids.forEach((id: string) => {\n\n      // 如果当前行被删除，计算下一当前行\n      if (id === nextCurrentId) {\n        nextCurrentId = this.getCurrentIdBeforeDeleting();\n      }\n\n      // 删除对象，找不到时跳过\n      const index = this.getIndexById(id);\n      if (index === -1) {\n        return;\n      }\n      ArrayUtil.removeByIndex(this.innerList, index);\n    });\n\n    // 重新设置当前行\n    if (this.innerList.length === 0) {\n      this.currentId = null;\n    } else {\n      this.setCurrentId(nextCurrentId, false, false);\n    }\n\n    // 出发行删除事件\n    this.changes.next({\n      type: ChangeType.Remove,\n      path: [],\n      value: ids\n    });\n  }\n  /**\n   * 删除数据（不切换当前行）\n   * @param ids ids\n   */\n  public removeDataByIds(ids: Array<string>): void {\n    // if (!ids || ids.length === 0) {\n    //   return;\n    // }\n\n    // ids.forEach((id: string) => {\n    //   // 删除对象，找不到时跳过\n    //   const index = this.getIndexById(id);\n    //   if (index === -1) {\n    //     return;\n    //   }\n    //   this.innerList = this.innerList.delete(index);\n    // });\n\n    // // 出发行删除事件\n    // this.changes.next({\n    //   type: ChangeType.Remove,\n    //   path: [],\n    //   value: ids\n    // });\n  }\n  /**\n   * 清空\n   */\n  public clear() {\n    this.innerList = [];\n    this.currentId = null;\n    this.changes.next({\n      type: ChangeType.Remove,\n      path: [],\n      value: []\n    });\n  }\n\n  /**\n   * 如果当前行被删除，删除之前重新计算当前行的位置，并返回下一当前行的主键值。\n   * - 如果被删除的行是最后1行，则上移1行；\n   * - 其他情况，下移1行。\n   */\n  public getCurrentIdBeforeDeleting(): string {\n    let nextIndex = -1;\n    const currentIndex = this.getIndexById(this.currentId);\n    if (currentIndex === this.length - 1) {\n      nextIndex = currentIndex - 1;\n    } else {\n      nextIndex = currentIndex + 1;\n    }\n    return this.getIdByIndex(nextIndex);\n  }\n\n  /**\n   * 根据主键值获取对应绑定对象\n   * @param   id 要查找的主键值\n   * @returns 找到时返回对应BindingObject， 找不到时返回null\n   */\n  public findById(id: string): BindingObject | null {\n    let target: BindingObject;\n    target = this.innerList.find((item) => {\n      return item.getValue(this.primaryKey) === id;\n    });\n    return target === undefined ? null : target;\n  }\n\n  /**\n   * 将主键值为id的绑定对象设置为当前行\n   * @param  id        要设置的主键值\n   * @param  emitEvent 是否发送当前行变更事件\n   */\n  public setCurrentId(id: string, emitEvent: boolean = true, emitGlobalEvent: boolean = true): void {\n    if (this.currentId === id) {\n      return;\n    }\n\n    // 不存在时设置为null\n    // const currentObj = this.findById(id);\n    // if (!currentObj) {\n    //   this.currentId = null;\n    // } else {\n    //   this.currentId = id;\n    // }\n\n    // @todo：找不到时按理应该设置为null，目前是直接返回，框架部分功能依赖该特性。\n    const currentObj = this.findById(id);\n    if (!currentObj) {\n      return;\n    }\n    this.currentId = id;\n\n    // 发出行切换事件\n    if (emitEvent === true) {\n      this.changes.next({\n        type: ChangeType.SelectionChanged,\n        path: [],\n        value: this.currentItem\n      });\n    }\n\n    // 是否发送全局的行切换事件\n    if (emitGlobalEvent === true) {\n      this.changes.next({\n        type: ChangeType.GlobalSelectionChanged,\n        path: [],\n        value: this.currentItem\n      });\n    }\n  }\n\n  /**\n   * 根据主键值为id的绑定对象的索引\n   * @param id 主键值\n   * @returns 找到时返回对应的index，找不到时返回-1\n   */\n  public getIndexById(id: string): number {\n    return this.innerList.findIndex((obj: BindingObject) => {\n      return obj[this.primaryKey] === id;\n    });\n  }\n\n  /**\n   * 根据索引位置获取对应绑定对象的主键值\n   * @reutrn 找到时返回对应主键值，找不到返回null\n   */\n  public getIdByIndex(index: number): string {\n\n    if (index < 0 || index > this.length) {\n      return null;\n    }\n\n    const obj = this.innerList[index];\n    if (!obj) {\n      return null;\n    }\n\n    return obj[this.primaryKey];\n  }\n\n  /**\n   * 转换为BindingObject数组\n   */\n  public toArray(): BindingObject[] {\n    return this.innerList.concat([]);\n  }\n  /**\n   * 交互数据位置\n   * @param id1 id1\n   * @param id2 id2\n   */\n  public swapById(id1: any, id2: any) {\n    // const item1 = this.innerList.find(element => element.primaryKeyValue === id1);\n    // const item2 = this.innerList.find(element => element.primaryKeyValue === id2);\n    // this.innerList = this.innerList.map((bindingObject: BindingObject, index: number) => {\n    //   if (bindingObject.primaryKeyValue === id1) {\n    //     return item2;\n    //   } else if (bindingObject.primaryKeyValue === id2) {\n    //     return item1;\n    //   } else return bindingObject;\n    // }).toList();\n    // this.changes.next({\n    //   type: ChangeType.Swap,\n    //   path: []\n    // });\n  }\n  /**\n   * 转换为JSON对象\n   * @returns 普通对象数组\n   */\n  public toJSON(options?: any): any[] {\n    const result = [];\n    this.innerList.forEach((obj: BindingObject) => {\n      result.push(obj.toJSON(options));\n    });\n    return result;\n  }\n\n  /**\n   * 获取分页信息\n   * @param path 路径\n   * @param defaultValue 默认值\n   */\n  public getPaginationConfigByPath(path: string, defaultValue?: any) {\n    if (!path || path === '/') {\n      return this.paginationInfo;\n    }\n    if (typeof path !== 'string') {\n      throw new Error('路径必须为字符串！');\n    }\n    path = path.substring(1);\n    const paths = path.split('/').filter(item => !!item && item.trim().length > 0).map(item => item.trim());\n    let config = this.paginationInfo;\n    paths.forEach(item => {\n      if (config && config.hasOwnProperty(item)) {\n        config = config[item];\n      } else {\n        config = null;\n      }\n    });\n    return !!config ? config : typeof defaultValue !== 'undefined' ? defaultValue : undefined;\n  }\n\n  /**\n   * 对bindingList就行排序\n   * @param string 排序字段\n   * @param directions 排序规则字段\n   * @param options 参数\n   */\n  public sortBy(fields: string | Array<string>, directions: string | Array<string>, options?: { [prop: string]: any }) {\n    if (!fields || fields.length < 1 || !directions || directions.length < 1) {\n      throw new Error('sortBy:argument error');\n    }\n    // 默认升序\n    const arrFields: Array<string> = typeof fields === 'string' ? fields.split(',') : fields || [];\n    const arrDirections: Array<string> = typeof directions === 'string' ? directions.split(',') : directions || [];\n    // 排序字段和排序方式应一致\n    if (arrFields.length !== arrDirections.length || arrFields.length < 1) {\n      throw new Error('sortBy:fields and directions not match');\n    }\n    // nage,age,total\n    const comparator = (props: Array<string>, orders: Array<string>) => (item1: BindingObject, item2: BindingObject) => {\n      for (const prop of props) {\n        const order = ['asc'].includes(orders[props.indexOf(prop)]) ? 1 : -1;\n        if (item1.getValue(prop) > item2.getValue(prop)) { return order * 1; }\n        if (item1.getValue(prop) < item2.getValue(prop)) { return order * -1; }\n      }\n      return 0;\n    };\n    this.innerList = this.innerList.sort(comparator(arrFields, arrDirections));\n  }\n\n  private getValue(target: any, propName: string, isMultiLangProp: boolean = false, currentLanguage: string = 'zh-CHS') {\n    if (target instanceof BindingList) {\n      target = target.currentItem;\n    } else if (target instanceof BindingData) {\n      target = target.list.currentItem;\n    }\n    let result = null;\n    if (propName.indexOf('.') === -1) {\n      result = target[propName];\n    } else {\n      const props = propName.split('.');\n      for (const prop of props) {\n        target = result = this.getValue(target, prop, isMultiLangProp, currentLanguage);\n      }\n    }\n    if (isMultiLangProp && result && result.hasOwnProperty(currentLanguage)) {\n      return result[currentLanguage];\n    } else {\n      return result;\n    }\n  }\n}\n\nexport { BindingList };\n","import { Entity } from '../entity/index';\nimport { Repository, EntityManager } from '../repository/index';\nimport { PropertyUtil as BindingPropertyUtil } from './property_util';\nimport { EntityUtil as EntityLoadUtil } from './entity_util';\nimport { BindingListFactory } from './binding_list_factory';\nimport { BindingData } from './binding_data';\n\n\nclass BindingDataFactory {\n\n  /**\n   * 根据Repository创建一个BindingData\n   */\n  public static createFromRepository(repository: Repository<Entity>, bindingPath: string): BindingData {\n    const bindingData = new BindingData();\n    const bindingProperties = BindingPropertyUtil.getProperties(repository.entityType);\n    const bindingList = BindingListFactory.create(bindingProperties);\n    bindingData.initByBindingList(bindingList, null, repository.entityTypeInfo);\n    EntityLoadUtil.loadRepository(repository, bindingList);\n\n    // 从repository初始化bindingData\n    bindingData.pagingInfo = repository.entityCollection.paginationInfo;\n    return bindingData;\n  }\n\n  /**\n   * 根据EntityManager创建BindingData，并建立双向关联（请勿使用）\n   * @internal\n   * @summary\n   * 1、该方法暂时仅供内部单元测试使用；\n   * 2、该方法暂时只创建BindingData，不建立双向关联\n   */\n  public static createFromEntityManager(entityManager: EntityManager<Entity>, bindingPath: string): BindingData {\n    const bindingData = new BindingData();\n    const bindingProperties = BindingPropertyUtil.getProperties(entityManager.entityType);\n    const bindingList = BindingListFactory.create(bindingProperties);\n    bindingData.initByBindingList(bindingList, null, entityManager.entityCollection.entityTypeInfo);\n\n    // 初始化数据\n    const entities: Entity[] = entityManager.getEntitiesByPath([]);\n    EntityLoadUtil.loadEntities(entities, bindingList);\n\n    return bindingData;\n  }\n\n  /**\n   * 根据已经存在的BindingData创建一个新的BindingData\n   */\n  public static createFromExistingBindingData(existingBindingData: BindingData, bindingPath: string) {\n    const bindingData = new BindingData();\n    bindingData.initByBindingList(existingBindingData.list, null, bindingData.dataTypeInfo);\n    return bindingData;\n  }\n}\n\nexport { BindingDataFactory };\n","import {\n  BindingData, BindingPropertyType, PropertyUtil\n} from '../../binding-data/index';\nimport { BindingPathConverter } from './binding_path_converter';\n\n/**\n * EntityPath转换器\n */\nclass EntityPathConverter {\n\n  /**\n   * 转换为Entity可识别的路径\n   * 根：[]\n   * 主表：['id:xxx', 'name'],\n   * 关联：['id:xxx', 'deptInfo', 'id:xxx', 'name']\n   * UDT: ['id:xxx', 'updateInfo', ':', 'createdOn']\n   * 从表：['id:xxx', 'edus', 'id:xxx', 'name'],\n   * 从从表：['id:xxx', 'edus', 'id:xxx', 'grades', 'id:xxx', 'name']\n   */\n  public static toEntityPathArray(bindingPathString: string, bindingData: BindingData): string[] {\n    const bindingPathArray: string[] = BindingPathConverter.toBindingPathArray(bindingPathString);\n    const entityPathArray: string[] = [];\n\n    if (bindingPathArray.length === 0) {\n      return entityPathArray;\n    }\n\n    // 根节点\n    let currentBindingObject = bindingData.list.currentItem;\n    entityPathArray.push(\n      this.createPrimaryKeyPath(currentBindingObject.primaryKey, currentBindingObject.primaryKeyValue)\n    );\n\n    bindingPathArray.forEach((propName: string) => {\n      const propInfo = PropertyUtil.getPropertyByName(currentBindingObject.properties, propName);\n      switch (propInfo.type) {\n        case BindingPropertyType.Plain:\n          entityPathArray.push(propName);\n          break;\n        case BindingPropertyType.Object:\n          currentBindingObject = currentBindingObject[propName];\n          entityPathArray.push(propName);\n          entityPathArray.push(\n            this.createPrimaryKeyPath(currentBindingObject.primaryKey, currentBindingObject.primaryKeyValue)\n          );\n          break;\n        case BindingPropertyType.List:\n          const currentBindingList = currentBindingObject[propName];\n          currentBindingObject = currentBindingList.currentItem;\n          entityPathArray.push(propName);\n          entityPathArray.push(\n            this.createPrimaryKeyPath(currentBindingObject.primaryKey, currentBindingObject.primaryKeyValue)\n          );\n          break;\n        default:\n            break;\n      }\n    });\n\n    return entityPathArray;\n  }\n\n  /**\n   * 创建路径中的主键部分\n   */\n  public static createPrimaryKeyPath(primaryKey: string, primaryKeyValue: string) {\n    return `${primaryKey}:${primaryKeyValue}`;\n  }\n\n}\n\nexport { EntityPathConverter };\n","\n/**\n * 实体路径比较器\n */\nclass EntityPathComparer {\n}\n\nexport { EntityPathComparer };\n","\n/**\n * 表单路径转换类\n */\nclass FormPathConverter {\n\n  /**\n   * ControlPathString => BingingPathArray\n   * @params controlPath FormControl对应的数据绑定路径（BindingData的bindingPaht + FormControl的binding）\n   * @return BindingPath数组\n   */\n  public static toBindingPathArray(formPahtString: string): string[] {\n    const bindingPathArray = formPahtString.split('.').filter((part: string) => {\n      return part !== '';\n    });\n    return bindingPathArray;\n  }\n}\n\nexport { FormPathConverter };\n","import { BindingData, BindingPropertyType, PropertyUtil } from '../binding-data/index';\n/**\n * 路径处理工具类（处理/PathNode1/PathNode2/...格式的路径）\n */\nclass DataPathUtil {\n\n  /**\n   * 转换成BindingData可识别的路径\n   */\n  public static convertToBindingPathArray(path: string): string[] {\n    const bindingPathArray = path.split('/').filter((part: string) => {\n      return part !== '';\n    });\n    return bindingPathArray;\n  }\n\n  /**\n   * 转换为Entity可识别的路径\n   * 根：[]\n   * 主表：['id:xxx', 'name'],\n   * 关联：['id:xxx', 'deptInfo', 'id:xxx', 'name']\n   * UDT: ['id:xxx', 'updateInfo', ':', 'createdOn']\n   * 从表：['id:xxx', 'edus', 'id:xxx', 'name'],\n   * 从从表：['id:xxx', 'edus', 'id:xxx', 'grades', 'id:xxx', 'name']\n   */\n  public static convertToEntityPathArray(path: string, bindingData: BindingData): string[] {\n    const bindingPathArray: string[] = this.convertToBindingPathArray(path);\n    const entityPathArray: string[] = [];\n\n    if (bindingPathArray.length === 0) {\n      return entityPathArray;\n    }\n\n    // 根节点\n    let currentBindingObject = bindingData.list.currentItem;\n    entityPathArray.push(\n      this.createPrimaryKeyPath(currentBindingObject.primaryKey, currentBindingObject.primaryKeyValue)\n    );\n\n    bindingPathArray.forEach((propName: string) => {\n      const propInfo = PropertyUtil.getPropertyByName(currentBindingObject.properties, propName);\n      switch (propInfo.type) {\n        case BindingPropertyType.Plain:\n          entityPathArray.push(propName);\n          break;\n        case BindingPropertyType.Object:\n          currentBindingObject = currentBindingObject[propName];\n          entityPathArray.push(propName);\n          entityPathArray.push(\n            this.createPrimaryKeyPath(currentBindingObject.primaryKey, currentBindingObject.primaryKeyValue)\n          );\n          break;\n        case BindingPropertyType.List:\n          const currentBindingList = currentBindingObject[propName];\n          currentBindingObject = currentBindingList.currentItem;\n          entityPathArray.push(propName);\n          entityPathArray.push(\n            this.createPrimaryKeyPath(currentBindingObject.primaryKey, currentBindingObject.primaryKeyValue)\n          );\n          break;\n        default:\n            break;\n      }\n    });\n\n    return entityPathArray;\n  }\n\n  /**\n   * 转换为RestUrl里的路径\n   *\n   * 返回结果：\n   * 主表（/）：/\n   * 从表（/jiwtEdus）：/xxx/jiwtEdus\n   * 从从表（/jiwtEdus/jiwtGrades）： /xxx/jiwtEdus/xxx/jiwtGrades\n   */\n  public static convertToRestUrl(path: string, bindingData: BindingData): string {\n    const bindingPathArray: string[] = this.convertToBindingPathArray(path);\n    const restPathArray: string[] = [];\n\n    let currentBindingObject = bindingData.list.currentItem;\n    restPathArray.push(currentBindingObject.primaryKeyValue);\n\n    bindingPathArray.forEach((propName: string) => {\n      const propInfo = PropertyUtil.getPropertyByName(currentBindingObject.properties, propName);\n      if (propInfo.type !== BindingPropertyType.List) {\n        throw new Error(`${propInfo.name}不是子表对应的属性`);\n      }\n      const currentBindingList = currentBindingObject[propName];\n      currentBindingObject = currentBindingList.currentItem;\n      restPathArray.push(propName);\n      restPathArray.push(currentBindingObject.primaryKeyValue);\n    });\n\n    // 移除最后一个主键\n    restPathArray.pop();\n    return '/' + restPathArray.join('/');\n  }\n\n  /**\n   * 获取叶子节点的Path\n   */\n  public static getLeafPath(path: string): string {\n    const pathArray = DataPathUtil.convertToBindingPathArray(path);\n    return pathArray.pop();\n  }\n\n  /**\n   * 获取父路径\n   */\n  public static getParentPath(path: string): string {\n    const pathArray = DataPathUtil.convertToBindingPathArray(path);\n    pathArray.pop();\n    return '/' + pathArray.join('/');\n  }\n\n  /**\n   * 创建路径中的主键部分\n   */\n  private static createPrimaryKeyPath(primaryKey: string, primaryKeyValue: string) {\n    return `${primaryKey}:${primaryKeyValue}`;\n  }\n}\n\nexport { DataPathUtil };\n","// tslint:disable: max-line-length\n/**\n * GUID创建服务\n * @scope 静态类没有提供Provider\n */\nexport class Guid {\n\n    private constructor(guid: string) {\n        if (!guid) { throw new TypeError('Invalid argument; `value` has no value.'); }\n\n        this.value = Guid.EMPTY;\n\n        if (guid && Guid.isGuid(guid)) {\n            this.value = guid;\n        }\n    }\n\n\n    public static validator = new RegExp('^[a-z0-9]{8}-[a-z0-9]{4}-[a-z0-9]{4}-[a-z0-9]{4}-[a-z0-9]{12}$', 'i');\n\n    public static EMPTY = '00000000-0000-0000-0000-000000000000';\n\n    private value: string;\n\n    public static isGuid(guid: any) {\n        const value: string = guid.toString();\n        return guid && (guid instanceof Guid || Guid.validator.test(value));\n    }\n\n    public static create(): Guid {\n        return new Guid([Guid.gen(2), Guid.gen(1), Guid.gen(1), Guid.gen(1), Guid.gen(3)].join('-'));\n    }\n\n    public static createEmpty(): Guid {\n        return new Guid('emptyguid');\n    }\n\n    public static parse(guid: string): Guid {\n        return new Guid(guid);\n    }\n\n    public static raw(): string {\n        return [Guid.gen(2), Guid.gen(1), Guid.gen(1), Guid.gen(1), Guid.gen(3)].join('-');\n    }\n\n    private static gen(count: number) {\n        let out = '';\n        for (let i = 0; i < count; i++) {\n            // tslint:disable-next-line:no-bitwise\n            out += (((1 + Math.random()) * 0x10000) | 0).toString(16).substring(1);\n        }\n        return out;\n    }\n\n    public equals(other: Guid): boolean {\n        // Comparing string `value` against provided `guid` will auto-call\n        // toString on `guid` for comparison\n        return Guid.isGuid(other) && this.value === other.toString();\n    }\n\n    public isEmpty(): boolean {\n        return this.value === Guid.EMPTY;\n    }\n\n    public toString(): string {\n        return this.value;\n    }\n\n    public toJSON(): any {\n        return {\n            value: this.value,\n        };\n    }\n}\n","/*\n * @Author: aalizzwell \n * @Date: 2019-10-25 13:30:52 \n * @Last Modified by:   aalizzwell \n * @Last Modified time: 2019-10-25 13:30:52 \n */\nimport { Observable } from 'rxjs';\n\nconst isObservable = (value) => {\n    if (!value) {\n        return false;\n    }\n    if (value[Symbol.observable] && value === value[Symbol.observable]()) {\n        return true;\n    }\n    if (value['@@observable'] && value === value['@@observable']()) {\n        return true;\n    }\n    if (value instanceof Observable) {\n        return true;\n    }\n    return false;\n}\nexport { isObservable }\n","/**\n * 环境工具类\n */\nclass EnvUtil {\n\n  /**\n   * 是否在任务中心中运行\n   */\n  public static isInWf(): boolean {\n    const url = window.top.location.pathname;\n    if (url.indexOf('wf/webapp/apptaskcenter') !== -1 || url.indexOf('wf/webapp/mobiletaskcenter') !== -1 || url.indexOf('wf/webapp/proc-center-mobile') !== -1) {\n      return true;\n    }\n\n    return false;\n  }\n}\n\nexport { EnvUtil }","\n/**\n * Url工具类\n */\nclass UrlUtil {\n\n  /**\n   * 获取参数对象\n   */\n  public static getParams(url: string): any {\n    const urlParts = url.split('?');\n    if (urlParts.length < 2) {\n      return null;\n    }\n\n    const params = {};\n    const paramsString = urlParts[1];\n    const keyValueStrings = paramsString.split('&');\n    keyValueStrings.forEach((keyValueString: string) => {\n      if (!keyValueString) {\n        return;\n      }\n      const keyValue = keyValueString.split('=');\n      if (keyValue.length < 2) {\n        return;\n      }\n      params[keyValue[0]] = keyValue[1];\n    });\n\n    return params;\n  }\n}\n\nexport { UrlUtil };","import { makePropDecorator } from '../../core/index';\nimport { ObjectUtil } from '../../utils/index';\nimport { ClassType } from '../types';\nimport { PropMetadata } from './prop_meatadata';\n\n/**\n * 【对象属性元数据】接口\n */\nexport interface ObjectPropMetadata extends PropMetadata {\n\n  /**\n   * 映射字段\n   */\n  dataField?: string;\n\n  /**\n   * 原始字段名称\n   */\n  originalDataField?: string;\n\n  /**\n   * 表名\n   */\n  tableName?: string;\n\n  /**\n   * 引用实体类型\n   */\n  type?: ClassType;\n\n  /**\n   * 树分级类型(分级码=path 父路径=parent) \n   */\n  hierarchyType?: string;\n}\n\n\n/**\n * 【对象属性元数据】名称\n */\nexport const OBJECT_PROP_META = 'ObjectPropMeta';\n\n\n/**\n * 【对象属性元数据装饰器工厂】接口\n * @summaryh\n * obj 参数obj的值类型可以为 NgObjectProperty、string、ClassType\n * 当为string 时，则设其映射字段；\n * 当为ClassType时，则设置集合中的记录类型\n */\nexport interface ObjectPropMetaDecorator {\n\n  (obj: ObjectPropMetadata | string | ClassType): any;\n\n  new(obj: ObjectPropMetadata | string | ClassType): any;\n}\n\n\n/**\n * 【对象属性元数据装饰器工厂】的工厂\n */\nfunction makeObjectPropMetaDecorator(options: ObjectPropMetadata | string | ClassType): any {\n  if (ObjectUtil.isPlainObject(options)) {\n    return options;\n  }\n\n  const type = typeof options;\n  if (type === 'string') {\n    return {\n      dataField: options\n    };\n  }\n\n  if (type === 'function') {\n    return {\n      type: options\n    };\n  }\n}\n\n\n/**\n * 对象属性元数据装饰器工厂\n */\nexport const ObjectPropMeta: ObjectPropMetaDecorator = makePropDecorator(OBJECT_PROP_META, makeObjectPropMetaDecorator);\n","import { makePropDecorator } from '../../core/index';\nimport { ObjectUtil } from '../../utils/index';\nimport { ClassType } from '../types';\nimport { PropMetadata } from './prop_meatadata';\n\n\n/**\n * 【动态对象元数据】接口\n */\nexport interface DynamicPropMetadata extends PropMetadata {\n\n  /**\n   * 映射字段\n   */\n  dataField?: string;\n\n  /**\n   * 原始字段名称\n   */\n  originalDataField?: string;\n\n  /**\n   * 表名\n   */\n  tableName?: string;\n\n  /**\n   * 引用实体类型\n   */\n  type?: ClassType;\n}\n\n\n/**\n * 【动态对象元数据装饰器】名称\n */\nexport const DYNAMIC_PROP_META = 'DynamicPropMeta';\n\n\n/**\n * 【动态对象元数据装饰器工厂】接口\n */\nexport interface DynamicPropMetaDecorator {\n\n  (obj: DynamicPropMetadata | string | ClassType): any;\n\n  new(obj: DynamicPropMetadata | string | ClassType): any;\n}\n\n\n/**\n * 【动态对象元数据装饰器工厂】的工厂\n */\nfunction makeDynamicPropMetaDecorator(options: DynamicPropMetadata | string | ClassType): any {\n  if (ObjectUtil.isPlainObject(options)) {\n    return options;\n  }\n\n  const type = typeof options;\n  if (type === 'string') {\n    return {\n      dataField: options\n    };\n  }\n\n  if (type === 'function') {\n    return {\n      type: options\n    };\n  }\n}\n\n\n/**\n * 实体属性注解\n */\nexport const DynamicPropMeta: DynamicPropMetaDecorator = makePropDecorator(DYNAMIC_PROP_META, makeDynamicPropMetaDecorator);","import { makePropDecorator } from '../../core/index';\nimport { ObjectUtil } from '../../utils/index';\nimport { ClassType } from '../types';\nimport { PropMetadata } from './prop_meatadata';\n\n\n/**\n * 列表属性元数据\n */\nexport interface ListPropMetadata extends PropMetadata {\n\n  /**\n   * 表名\n   */\n  tableName?: string;\n\n  /**\n   * 字段名称\n   */\n  dataField?: string;\n\n  /**\n   * 原始字段名称\n   */\n  originalDataField?: string;\n\n  /**\n   * 实体类型\n   */\n  type?: any;\n}\n\n\n/**\n * 【列表属性元数据】名称\n */\nexport const LIST_PROP_META = 'ListPropMeta';\n\n\n/**\n * 【列表属性元数据装饰器工厂】接口\n */\nexport interface ListPropMetaDecorator {\n\n  (obj: ListPropMetadata | string | ClassType): any;\n\n  new(obj: ListPropMetadata | string | ClassType): any;\n\n}\n\n/**\n * 【列表属性元数据装饰器工厂】的工厂\n */\nfunction makeListPropMetaDecorator(options: ListPropMetadata | string | ClassType): any {\n  if (ObjectUtil.isPlainObject(options)) {\n    return options;\n  }\n\n  const type = typeof options;\n  if (type === 'string') {\n    return {\n      dataField: options\n    };\n  }\n\n  if (type === 'function') {\n    return {\n      type: options\n    };\n  }\n}\n\n\n/**\n * 列表属性装饰器工厂\n */\nexport const ListPropMeta: ListPropMetaDecorator = makePropDecorator(LIST_PROP_META, makeListPropMetaDecorator);\n","import { MetadataUtil } from '../../core/index';\nimport {\n  PRIMITIVE_PROP_META, OBJECT_PROP_META, DYNAMIC_PROP_META, LIST_PROP_META,\n  PrimitivePropMetadata, ObjectPropMetadata, DynamicPropMetadata, ListPropMetadata\n} from './field_decorator';\n\n/**\n * 属性注解器通用方法\n */\nexport class FieldMetadataUtil {\n  /**\n   * 获取实体所有的简单属性元数据\n   * @param target 实体类型\n   * @returns 形如：{[propName: string]: NgObjectProperty}\n   */\n  static getNgFields(target: any): { [propName: string]: PrimitivePropMetadata } {\n    return MetadataUtil.getPropsMetadatasByName(target, PRIMITIVE_PROP_META);\n  }\n\n  /**\n   * 获取某个简单属性的元数据\n   */\n  static getNgField(target: any, propName: string): PrimitivePropMetadata {\n    const ngFields = this.getNgFields(target);\n    const ngField = ngFields[propName] as PrimitivePropMetadata;\n    return ngField;\n  }\n\n  /**\n   * 获取实体属性在原始数据中的属性名\n   */\n  static getDataField(target: any, propName: string) {\n    const ngField = this.getNgField(target, propName);\n    return ngField.dataField || propName;\n  }\n\n  /**\n   * 获取标注为NgObject的属性的元数据\n   * @param target 实体类型\n   * @returns 形如：{[propName: string]: NgObjectProperty}\n   */\n  static getNgObjects(target: any): { [propName: string]: ObjectPropMetadata } {\n    return MetadataUtil.getPropsMetadatasByName(target, OBJECT_PROP_META);\n  }\n\n  static getNgDynamic(target: any): { [propName: string]: ObjectPropMetadata } {\n    return MetadataUtil.getPropsMetadatasByName(target, DYNAMIC_PROP_META);\n  }\n\n  /**\n   * 获取标注为NgList的属性的元数据\n   * @param target 实体类型\n   * @returns 形如：{[propName: string]: NgListProperty}\n   */\n  static getNgList(target: any): { [propName: string]: ListPropMetadata } {\n    return MetadataUtil.getPropsMetadatasByName(target, LIST_PROP_META);\n  }\n\n  /**\n   * 获取实体标注为主键的属性元数据\n   * @param target 实体类型\n   */\n  static getPrimaryFieldMetadata(target: any): PrimitivePropMetadata | undefined {\n    const ngFieldObj = FieldMetadataUtil.getNgFields(target);\n    const primaryKey = Object.keys(ngFieldObj).find((prop: string) => {\n      return ngFieldObj[prop].primary;\n    });\n\n    if (primaryKey) {\n      const propMeta = ngFieldObj[primaryKey];\n      propMeta.property = primaryKey;\n      if (!propMeta.dataField) {\n        propMeta.dataField = primaryKey;\n      }\n\n      return propMeta;\n    }\n    return undefined;\n  }\n\n  /**\n   * 获取主键名称，没有主键时返回空字符串\n   */\n  static getPrimaryKey(entityType: any) {\n    const primaryNgField = this.getPrimaryFieldMetadata(entityType);\n    if (!primaryNgField) {\n      return '';\n    }\n    return primaryNgField.property;\n  }\n\n}\n","import { Type } from '../../core/index';\nimport { MetadataUtil } from '../../core/index';\nimport { Entity } from '../entity';\n\nimport { EntityMetadata, ENTITY_META } from './entity_decorator';\nimport {\n  PropMetadata, PRIMITIVE_PROP_META, PrimitivePropMetadata, OBJECT_PROP_META, ObjectPropMetadata,\n  DYNAMIC_PROP_META, DynamicPropMetadata, LIST_PROP_META,    ListPropMetadata\n} from './field_decorator';\n\n/**\n * 实体元数据工具类\n */\nexport class EntityMetadataUtil {\n\n  /**\n   * 获取所有属性\n   * @todo：封装根据基类获取所有元数据的方法，解决重复代码\n   */\n  static getAllNgProperties(entityType: Type<Entity>): { [propName: string]: PropMetadata } {\n    const ngPlainProperties = this.getNgFieldProperties(entityType);\n    const ngEntityProperties = this.getNgObjectProperties(entityType);\n    const ngDynamicProperties = this.getNgDynamicProperties(entityType);\n    const ngEntityListProperties = this.getNgObjectProperties(entityType);\n\n    return Object.assign({},\n      ngPlainProperties,   ngEntityProperties,\n      ngDynamicProperties, ngEntityListProperties\n    );\n  }\n  \n  /**\n   * 获取EnttiyClassMetadata\n   */\n  static getNgEntityMatadata(entityType: any): EntityMetadata{\n    return MetadataUtil.getClassMetadataByNameWithTranslate(entityType, ENTITY_META);\n  }\n\n\n  /**\n   * 获取PrimitivePropMetadata的属性元数据\n   */\n  static getNgFieldProperties(entityType: any): { [propName: string]: PrimitivePropMetadata } {\n    return MetadataUtil.getPropsMetadatasByName(entityType, PRIMITIVE_PROP_META);\n  }\n\n  /**\n   * 获取ObjectPropMetadata属性元数据\n   */\n  static getNgObjectProperties(entityType: any): { [propName: string]: ObjectPropMetadata } {\n    return MetadataUtil.getPropsMetadatasByName(entityType, OBJECT_PROP_META);\n  }\n\n  /**\n   * 获取DynamicPropMetadata属性元数据\n   */\n  static getNgDynamicProperties(entityType: any): { [propName: string]: DynamicPropMetadata } {\n    return MetadataUtil.getPropsMetadatasByName(entityType, DYNAMIC_PROP_META);\n  }\n\n  /**\n   * 获取ListPropMetadata属性元数据\n   */\n  static getNgListProperties(entityType: any): { [propName: string]: ListPropMetadata } {\n    return MetadataUtil.getPropsMetadatasByName(entityType, LIST_PROP_META);\n  }\n\n  /**\n   * 获取主键属性元数据\n   */\n  static getPrimaryKeyProperty(entityType: Type<Entity>): PrimitivePropMetadata {\n    let primaryKeyProperty;\n    const ngPlainProperties = EntityMetadataUtil.getNgFieldProperties(entityType);\n    Object.keys(ngPlainProperties).forEach((propName: string) => {\n      const ngProperty = ngPlainProperties[propName] as PrimitivePropMetadata;\n      if (ngProperty.primary === true) {\n        primaryKeyProperty = ngProperty;\n      }\n    });\n\n    return primaryKeyProperty;\n  }\n}\n","import { makeDecorator } from '../../core/index';\n\nexport const ENTITY_META = 'EntityMeta';\n\n/**\n * 实体描述\n */\nexport interface EntityMetadata{\n\n  /**\n   * 原始编号,对应schema中的code\n   */\n  originalCode: string;\n\n  /**\n   * 后端转换完之后的编号,对应schema中的label\n   */\n  nodeCode: string;\n}\n\n/**\n * 实体装饰器\n */\nexport interface EntityMetaDecorator {\n  (obj?: EntityMetadata): any;\n  new(obj?: EntityMetadata): any;\n}\n\n/**\n * 实体装饰器\n */\nexport function EntityMeta(options: EntityMetadata){\n  const decoratorFactory = makeDecorator(ENTITY_META, (obj: EntityMetadata) => obj);\n  return decoratorFactory(options);\n}","/*\n * @Author: Witt\n * @Date: 2018-12-07 09:05:09\n * @Last Modified by: Witt\n * @Last Modified time: 2018-12-27 20:35:02\n */\n\nimport { Type } from '../../core/types';\nimport {\n  EntityMetadata, PropMetadata, PrimitivePropMetadata, ObjectPropMetadata, DynamicPropMetadata, ListPropMetadata,\n  EntityMetadataUtil\n} from '../metadata/index';\nimport { DataPropGroup, DataPropInfo } from './data_prop_info';\n\n/**\n * 实体类型信息\n * @todo：\n * 1、构造时不应该识别Entity模块的东西，应该是更抽象的；\n * 2、构造函数应该接收一个Builder接口，由Entity或者其他实现层来实现这个接口。\n */\nclass DataTypeInfo {\n\n  /**\n   * 实体描述元数据\n   */\n  public entityInfo: EntityMetadata;\n\n  /**\n   * 数据类型\n   */\n  public type: Type<any>;\n\n  /**\n   * 属性集合\n   */\n  public propInfoMap: Map<string, DataPropInfo>;\n\n  /**\n   * 主键\n   */\n  public primaryKey: string;\n\n  /**\n   * 外键\n   */\n  public foreignKey: string;\n\n  /**\n   * 是否为值对象\n   */\n  public get isValueObject() {\n    return !this.primaryKey;\n  }\n\n  /**\n   * 构造函数\n   * @todo：不应该识别\n   */\n  constructor(type: any) {\n    this.type = type;\n    this.primaryKey = '';\n    this.foreignKey = '';\n    this.propInfoMap = new Map<string, DataPropInfo>();\n    this.collectEntityInfos();\n    this.collectPropInfos();\n  }\n\n  /**\n   * 获取全部属性信息\n   */\n  public getPropInfos(): DataPropInfo[] {\n    return Array.from(this.propInfoMap.values());\n  }\n\n  /**\n   * 获取全部属性的名称\n   */\n  public getPropNames(): string[] {\n    const propNames = [];\n    const propInfos = this.getPropInfos();\n    propInfos.forEach((propInfo) => {\n      propNames.push(propInfo.name);\n    });\n    return propNames;\n  }\n\n  /**\n   * 根据group获取属性信息数组\n   */\n  public getPropInfosByGroup(group: DataPropGroup): DataPropInfo[] {\n    const allPropInfos = Array.from(this.propInfoMap.values());\n    const propInfos = allPropInfos.filter((propInfo: DataPropInfo) => {\n      return propInfo.group === group;\n    });\n    return propInfos;\n  }\n\n  /**\n   * 根据group获取属性名称数组\n   * @param group 属性分组\n   */\n  public getPropNamesByGroup(group: DataPropGroup): string[] {\n    const propNames = [];\n    const propInfos = this.getPropInfosByGroup(group);\n    propInfos.forEach((propInfo) => {\n      propNames.push(propInfo.name);\n    });\n    return propNames;\n  }\n\n  /**\n   * 根据propName获取属性信息\n   */\n  public getPropInfoByName(propName: string): DataPropInfo {\n    if (this.propInfoMap.has(propName)) {\n      return this.propInfoMap.get(propName);\n    }\n    return null;\n  }\n\n  /**\n   * 根据path获取属性信息\n   */\n  public getPropInfoByPath(path: string[]): DataPropInfo {\n\n    // 先复制，防止shift方法产生污染\n    const arrPath = path.concat([]);\n    if (arrPath.length === 0) {\n      throw Error(`属性路径不能为空`);\n    }\n\n    // 循环查找\n    let typeInfo = this;\n    let propInfo = null;\n    while (typeInfo && arrPath.length > 0) {\n\n      const propName = arrPath.shift();\n      propInfo = typeInfo.getPropInfoByName(propName);\n      if (!propInfo) {\n        throw Error(`路径${path}中存在不正确的节点${propName}，请检查`);\n      }\n      typeInfo = propInfo.typeInfo;\n\n      // 如果是动态列，并且路径数组里还有属性，统一设置为null(动态列不再描述属性信息)\n      if (propInfo.group === DataPropGroup.Dynamic && arrPath.length > 0) {\n        propInfo = null;\n        typeInfo = null;\n      }\n    }\n\n    return propInfo;\n  }\n\n  /**\n   * 根据path获取对应属性的TypeInfo\n   */\n  public getTypeInfoByPath(path: string[]): DataTypeInfo {\n\n    // 空数组时返回\n    if (path.length === 0) {\n      return this;\n    }\n\n    // 获取对应属性信息\n    const propInfo = this.getPropInfoByPath(path);\n    if (!propInfo.typeInfo) {\n      throw Error(`路径${path}无法定位到一个EntityTypeInfo，请检查`);\n    }\n\n    return propInfo.typeInfo;\n  }\n\n  /**\n   * 获取主键的属性信息\n   */\n  public getPrimaryKeyPropInfo(): DataPropInfo {\n    return this.getPropInfoByName(this.primaryKey);\n  }\n\n  /**\n   * 根据name获取影射名\n   */\n  public getPropMappingByName(name: string): string {\n    const propInfo = this.getPropInfoByName(name);\n    if (!propInfo) {\n      return '';\n    }\n    return propInfo.mapping;\n  }\n\n  /**\n   * 根据path获取映射名\n   */\n  public getPropMappingByPath(path: string[]): string {\n    const propInfo = this.getPropInfoByPath(path);\n    if (!propInfo) {\n      return '';\n    }\n    return propInfo.mapping;\n  }\n\n  /**\n   * 检查属性是否属于特定的分组\n   */\n  public checkPropGroup(propName: string, propGroup: DataPropGroup): boolean {\n    const propInfo = this.getPropInfoByName(propName);\n    if (propInfo && propInfo.group === propGroup) {\n      return true;\n    }\n    return false;\n  }\n\n\n  /**\n   * --------------------------------------------------------------------------------\n   * 属性元数据 => 属性描述信息\n   * --------------------------------------------------------------------------------\n   */\n\n  private collectEntityInfos() {\n    const entityMetadata = EntityMetadataUtil.getNgEntityMatadata(this.type);\n    this.entityInfo = entityMetadata;\n  }\n\n  /**\n   * 搜集所有属性信息\n   * @todo：消除重复代码，ts不支持interface类型检测，暂时通过遍历实现。\n   */\n  private collectPropInfos() {\n\n    // 简单属性\n    const ngPlainProperties = EntityMetadataUtil.getNgFieldProperties(this.type);\n    Object.keys(ngPlainProperties).forEach((propName: string) => {\n      const ngProperty = ngPlainProperties[propName] as PrimitivePropMetadata;\n      if (ngProperty.primary === true) {\n        this.primaryKey = propName;\n      }\n      if (ngProperty.foreign === true) {\n        this.foreignKey = propName;\n      }\n      this.addPropInfo(DataPropGroup.Primitive, propName, ngProperty.dataField, null, ngProperty);\n    });\n\n    // 实体属性\n    const ngEntityProperties = EntityMetadataUtil.getNgObjectProperties(this.type);\n    Object.keys(ngEntityProperties).forEach((propName: string) => {\n      const ngProperty = ngEntityProperties[propName] as ObjectPropMetadata;\n      this.addPropInfo(DataPropGroup.Object, propName, ngProperty.dataField, ngProperty.type, ngProperty);\n    });\n\n    // 动态实体属性\n    const ngDynamicProperties = EntityMetadataUtil.getNgDynamicProperties(this.type);\n    Object.keys(ngDynamicProperties).forEach((propName: string) => {\n      const ngProperty = ngDynamicProperties[propName] as DynamicPropMetadata;\n      this.addPropInfo(DataPropGroup.Dynamic, propName, ngProperty.dataField, null, ngProperty);\n    });\n\n    // 实体列表属性\n    const ngEntityListProperties = EntityMetadataUtil.getNgListProperties(this.type);\n    Object.keys(ngEntityListProperties).forEach((propName: string) => {\n      const ngProperty = ngEntityListProperties[propName] as ListPropMetadata;\n      this.addPropInfo(DataPropGroup.List, propName, ngProperty.dataField, ngProperty.type, ngProperty);\n    });\n  }\n\n  /**\n   * 添加属性信息\n   */\n  private addPropInfo(group: DataPropGroup, name: string, mapping: string, type: Type<any>, metadataInfo: PropMetadata) {\n\n    // 没有设置影射时，用属性名充当影射\n    mapping = mapping ? mapping : name;\n    let typeInfo = null;\n    if (type) {\n      typeInfo = new DataTypeInfo(type);\n    }\n    const propInfo = { group, name, mapping, typeInfo, metadataInfo };\n    this.propInfoMap.set(name, propInfo);\n  }\n\n}\n\nexport { DataTypeInfo };\n","\nimport { DataTypeInfo, DataPropGroup  } from '../entity-type-info/index';\nimport { Entity  } from '../index';\nimport { Repository, EntityManager } from '../../repository/index';\nimport { BindingData } from '../../binding-data/index';\nimport { DataPathNode, DataPathNodeType } from './data_path_node';\nimport { DataPath } from './data_path';\n\n/**\n * 数据Path工厂类\n */\nclass DataPathCreator {\n\n  /**\n   * 将长路径数组或字符串转换为\n   * @param fullPathArrayOrString 路径数组或字符串\n   * @param repository 实体仓库\n   * @summary\n   * 1、长路径格式说明参考：data-path.md\n   */\n  public static createByLongPathFromRoot(fullPathArrayOrString: string[] | string, entityManager: EntityManager<Entity>): DataPath {\n    const dataPath = new DataPath();\n    const fullPathArray = fullPathArrayOrString as string[];\n    if (!fullPathArray || fullPathArray.length === 0) {\n      return dataPath;\n    }\n\n    let currentNodeInfo = {\n      nodeValue: fullPathArray.shift(),\n      nodeType: DataPathNodeType.DataId,\n      entityTypeInfo: new DataTypeInfo(entityManager.entityType)\n    };\n    while (currentNodeInfo) {\n      dataPath.push(currentNodeInfo.nodeType, currentNodeInfo.nodeValue);\n\n      // 处理下一个节点\n      const nextNodeValue = fullPathArray.shift();\n      if (!nextNodeValue || !currentNodeInfo.entityTypeInfo) {\n        break;\n      }\n      currentNodeInfo = this.getNextPathNodeInfo(currentNodeInfo, nextNodeValue);\n    }\n\n    return dataPath;\n  }\n\n  /**\n   * 获取下一个路径节点的信息\n   * @param parentNodeInfo 当前路径节点信息\n   * @param nextNodeValue 下一个路径节点的值\n   * @summary\n   * 1、这个递归写的很绕，说明数据结构设计不合理；\n   * 2、多个因素混用了一个结构；\n   */\n  private static getNextPathNodeInfo(parentNodeInfo: any, nextNodeValue: string): any {\n\n    const parentNodeValue = parentNodeInfo.nodeValue;\n    const parentNodeType = parentNodeInfo.nodeType;\n    const parentEntityTypeInfo = parentNodeInfo.entityTypeInfo;\n\n    if (!nextNodeValue || !parentEntityTypeInfo) {\n      return null;\n    }\n\n    const nextPathNodeInfo = {\n      nodeValue: nextNodeValue,\n      nodeType: null,\n      entityTypeInfo: null\n    };\n\n\n    // DataNodeType=List：下一节点肯定是Object，并且EntityTypeInfo不变\n    if (parentNodeType === DataPathNodeType.DataId) {\n      nextPathNodeInfo.nodeType = DataPathNodeType.PropName;\n      nextPathNodeInfo.entityTypeInfo = parentEntityTypeInfo;\n    } else {\n\n      // DataNodeType=Object：必然对应一个属性信息\n      const nextPropInfo = parentEntityTypeInfo.getPropInfoByName(parentNodeValue);\n      if (nextPropInfo.group === DataPropGroup.List) {\n\n        // EntityPropGroup=EntityList：下一个节点是List类型。\n        nextPathNodeInfo.nodeType = DataPathNodeType.DataId;\n        nextPathNodeInfo.entityTypeInfo = nextPropInfo.typeInfo;\n      } else {\n\n        // EntityPropGroup=Entity：       下级entityTypeInfo为\n        // EntityPropGroup=Dynamic|Plain：null\n        nextPathNodeInfo.nodeType = DataPathNodeType.PropName;\n        nextPathNodeInfo.entityTypeInfo = nextPropInfo.group === DataPropGroup.Object ? nextPropInfo.typeInfo : null;\n      }\n    }\n\n    return nextPathNodeInfo;\n  }\n\n  /**\n   * @param fullPathArrayOrString 路径数组或字符串\n   * @param repository 实体仓库\n   * @summary\n   * 1、长路径格式说明参考：data-path.md\n   * 2、shortPathArrayOrString暂时只支持字符串数组\n   */\n  public static createByShortPathFromRoot(\n    shortPathArrayOrString: string[] | string, entityManager: EntityManager<Entity>, bindingData: BindingData\n  ): DataPath {\n\n    const dataPath = new DataPath();\n    const shortPathArray: string[] = shortPathArrayOrString as string[];\n\n    // 根节点\n    let currentBindingObject = bindingData.list.currentItem;\n    let currentEntityTypeInfo = new DataTypeInfo(entityManager.entityType);\n    dataPath.push(DataPathNodeType.DataId, currentBindingObject.primaryKeyValue);\n\n    // 遍历下级节点\n    shortPathArray.forEach((propName: string) => {\n      const propInfo = currentEntityTypeInfo.getPropInfoByName(propName);\n      switch (propInfo.group) {\n        case DataPropGroup.Primitive:\n          dataPath.push(DataPathNodeType.PropName, propName);\n          break;\n        case DataPropGroup.Object:\n          currentBindingObject = currentBindingObject[propName];\n          currentEntityTypeInfo = propInfo.typeInfo;\n          dataPath.push(DataPathNodeType.PropName, propName);\n\n          break;\n        case DataPropGroup.List:\n          const currentBindingList = currentBindingObject[propName];\n          currentBindingObject = currentBindingList.currentItem;\n          currentEntityTypeInfo = propInfo.typeInfo;\n\n          dataPath.push(DataPathNodeType.PropName, propName);\n          dataPath.push(DataPathNodeType.DataId, currentBindingObject.primaryKeyValue);\n          break;\n        default:\n            break;\n      }\n    });\n\n    return dataPath;\n  }\n\n}\n\nexport { DataPathCreator };\n","export const PARENT_PATH = '__PARENT_PATH__';\nexport const PARENT_CLASS = '__PARENT__';\n\nexport type ClassType = new (...args: any[]) => any;\n\nexport interface Dynamic {\n  loadDynamicData(dynamicData: any): void;\n}\n","import { Type } from '../core/index';\nimport { Entity } from './entity';\n\n/**\n * 创建实体\n * @param entityType 实体类型\n * @param entityData 实体数据\n */\nexport function createEntity<T extends Entity>(entityType: Type<any>, entityData: any): T {\n  const entity = new entityType(entityData);\n  return entity;\n}\n\n/**\n * 批量创建实体\n * @param entityType     实体类型\n * @param entityListData 实体数据数组\n */\nexport function createEntities<T extends Entity>(entityType: Type<any>, entityListData: any): T[] {\n  const entities: T[] = [];\n  entityListData.forEach((entityData: any) => {\n    const entity = createEntity<T>(entityType, entityData);\n    entities.push(entity);\n  });\n  return entities;\n}\n\n/**\n * 已弃用：请使用createEntity方法代替。\n */\nexport function EntityFactory<T extends Entity>(T: new (...args: any[]) => any, data: any): T {\n  const entity = new T(data);\n  return entity;\n}\n\n\n\n","import { Subject } from 'rxjs';\nimport { ChangeSet } from '../changeset/change_set';\nimport { Modification, ModifyType } from '../changeset/types';\nimport { Entity } from './entity';\nimport { EntityFactory } from './entity_creator';\nimport { PARENT_CLASS, PARENT_PATH, ClassType } from './types';\n\nexport interface IList<T> {\n  [index: number]: T;\n}\n/**\n * 实体集合列表\n */\nexport class EntityList<T extends Entity> implements IList<T>, Iterable<T> {\n  public __type__ = 'EntityList';\n\n  // #region 私有属性\n  private originalData: any[] = [];\n  /**\n   * 已废弃：请勿使用\n   */\n  private rawData: T[];\n\n  /**\n   * 已废弃：请勿使用\n   */\n  private listChanged = new Subject<Modification>();\n\n  /**\n   * 已废弃：请勿使用\n   */\n  private changeSet = new ChangeSet();\n  // #endregion\n\n\n  // #region 公有属性\n\n  /**\n   * 集合改变时触发(新增、行记录修改、删除)\n   * @event\n   */\n  public onListChanged = this.listChanged.asObservable();\n\n  /**\n   * 获取项集合\n   */\n  public get items(): T[] {\n    return this.rawData;\n  }\n\n  /**\n   * 列表变更集\n   */\n  public get changes() {\n    return this.changeSet.changes;\n  }\n\n  /**\n   * 获取指定索引处的值\n   */\n  [index: number]: T;\n\n  /**\n   * 迭代器\n   */\n  *[Symbol.iterator](): Iterator<T> {\n    yield* this.items;\n  }\n\n  // #endregion\n\n\n  /**\n   * @param data JSON数据集合\n   * @param type 集合中的实体类型\n   */\n  constructor(data?: any[], type?: ClassType) {\n    this.clear();\n    if (data) {\n      // this.loadEntities(data);\n      data.forEach(item => {\n        this.initEntity(EntityFactory(type, item));\n      });\n    }\n  }\n\n\n  // #region 公有方法\n\n  /** 加载实体列表 */\n  public loadEntities(entities: T[]) {\n    this.clear();\n\n    entities.forEach(entity => {\n      this.initEntity(entity);\n    });\n\n    // 发送Load变更\n    const changeItem = {\n      path: [],\n      value: entities,\n      preValue: undefined,\n      type: ModifyType.Load,\n      target: this\n    };\n    this.setChanges(changeItem);\n  }\n  /**\n   * 清空\n   */\n  public clear() {\n    this.rawData = [];\n    this.originalData = [];\n  }\n\n  /**\n   * 添加实体对象到集合中，并返回新加的对象\n   * @param entity 实体对象\n   * @param isCloned 克隆\n   */\n  public appendNew(entity: T, isCloned: boolean = false): T {\n    const newEntity = this.initEntity(entity, true);\n    // 新增变更\n    const changeItem = {\n      path: [],\n      value: [newEntity],\n      preValue: undefined,\n      type: ModifyType.Add\n    };\n\n    if (isCloned === true) {\n      changeItem.type = ModifyType.Clone;\n    }\n\n    this.setChanges(changeItem);\n    return newEntity;\n  }\n  /**\n   * 在指定位置插入实体\n   * @param entity 实体\n   * @param position 插入位置\n   */\n  public insert(entity: T, position?: 1 | -1): T {\n    const newEntity = this.initEntity(entity, true);\n\n    // 新增变更\n    const changeItem = {\n      path: [],\n      value: [newEntity],\n      preValue: undefined,\n      type: ModifyType.Insert,\n      position: position,\n    };\n\n    this.setChanges(changeItem);\n    return newEntity;\n  }\n  /**\n   * 追加实体\n   */\n  public appendEntity(entity: T): void {\n    const newEntity = this.initEntity(entity);\n\n    // 新增变更\n    const changeItem = {\n      path: [],\n      value: [newEntity],\n      preValue: undefined,\n      type: ModifyType.Add\n    };\n\n    this.setChanges(changeItem);\n  }\n\n  /**\n   * 批量追加实体\n   */\n  public appendEntities(entities: T[]): void {\n    const newEntites = entities.map((entity: T) => {\n      return this.initEntity(entity);\n    });\n    const changeItem = {\n      path: [],\n      value: newEntites,\n      preValue: undefined,\n      type: ModifyType.Add\n    };\n\n    this.setChanges(changeItem);\n  }\n\n  /**\n   * 删除指定主键ID 的实体对象，返回布尔，true 删除成功，false 删除失败\n   * @param primaryId 主键ID\n   */\n  public remove(primaryId: string): boolean {\n    const total = this.count();\n    const indexToRemove = this.rawData.findIndex((entity: Entity) => {\n      return entity.primaryValue === primaryId;\n    });\n    if (indexToRemove === -1) {\n      return false;\n    }\n    const entityToRemove = this.rawData[indexToRemove];\n    this.rawData.splice(indexToRemove, 1);\n\n    // 删除变更\n    const changeItem = {\n      path: [],\n      value: { [entityToRemove.primaryProperty.dataField]: primaryId },\n      preValue: undefined,\n      type: ModifyType.Remove\n    };\n\n    this.updateIndex(total);\n    this.setChanges(changeItem);\n\n    return true;\n  }\n\n  /**\n   * 从集合中获取指定ID值的实体对象\n   * @param id 主键值\n   */\n  public get(id: string) {\n    return this.items.find(item => {\n      return item.primaryValue === id;\n    });\n  }\n\n  /**\n   * 将变更记录添加到集合变更集中\n   * @param value 变更记录\n   */\n  public setChanges(modinfo: Modification) {\n    // 向app层发送的变更\n    this.listChanged.next(modinfo);\n\n    // 构造向changeSet中添加的chagne\n    const change = Object.assign({}, modinfo);\n    if ((modinfo.type === ModifyType.Add || modinfo.type === ModifyType.Insert || modinfo.type === ModifyType.Clone) && modinfo.value[0] instanceof Entity) {\n      change.value = [modinfo.value[0].data];\n    }\n    this.changeSet.append(change);\n  }\n\n  /** 集合总记录数 */\n  public count() {\n    return this.items.length;\n  }\n\n  /**\n   * 获取实体对象的索引值\n   */\n  public indexOf(entity: T): number {\n    return this.items.indexOf(entity);\n  }\n\n  /**\n   * 计算集合中某个属性的总和\n   * @param propertyName 属性名称\n   */\n  public sum(propertyName: string): number {\n    if (this.count() === 0) {\n      return 0;\n    }\n    return this.items.reduce((val, curr: T) => {\n      return val + curr[propertyName];\n    }, 0);\n  }\n\n  /**\n   * 已废弃：请使用toJSON方法代替\n   * @deprecated\n   */\n  public toJson() {\n    return this.rawData;\n  }\n\n  /**\n   * 转换为JSON格式\n   */\n  public toJSON(): any[] {\n    const result = [];\n    this.items.forEach((entity: Entity) => {\n      result.push(entity.toJSON());\n    });\n    return result;\n  }\n\n  public toArray(): T[] {\n    return this.items;\n  }\n\n  // #endregion\n\n\n  // #region 私有方法\n\n  /**\n   * 实体初始化\n   * @param entity 实体\n   */\n  private initEntity(entity: T, isNewEntity: boolean = false): T {\n    entity[PARENT_CLASS] = this;\n    entity[PARENT_PATH] = this[PARENT_PATH];\n    entity.onValueChanged.subscribe((v: Modification) => {\n      const path = v.path;\n      const value = v.value;\n      const preValue = v.preValue;\n      const operator = v.type;\n      const subChanges = { path, value, preValue, type: operator };\n      if (v.changeSetValue !== undefined) {\n        subChanges['changeSetValue'] = v.changeSetValue;\n      }\n      this.setChanges(subChanges);\n    });\n    // TODO: 添加数据验证逻辑代码\n    const newLength = this.rawData.push(entity);\n    this[newLength - 1] = entity;\n    if (!isNewEntity) {\n      this.originalData.push(entity.toJSON());\n    }\n    return entity;\n  }\n\n  /**\n   * 更新索引\n   * @param total 总记录数\n   */\n  private updateIndex(total: number) {\n    for (let i = 0; i < total; i++) {\n      delete this[i];\n    }\n    this.rawData.forEach((entity, index) => {\n      this[index] = entity;\n    });\n  }\n\n  /**\n   * 获取属性名称\n   */\n  private getPropertyName() {\n    const path = this[PARENT_PATH];\n    if (path && path.length) {\n      const name = path[path.length - 1];\n      return name;\n    }\n    return undefined;\n  }\n\n  // #endregion\n\n}\n","import { Entity } from './entity';\n\nexport function EntityFactory<T extends Entity>(T: new (...args: any[]) => any, data: any): T {\n    const entity = new T(data);\n    return entity;\n}\n","import { Observable, Subject, from, of } from 'rxjs';\nimport { scan, map, tap } from 'rxjs/operators';\nimport { PrimitivePropMetadata, ListPropMetadata, ObjectPropMetadata, DynamicPropMetadata, FieldMetadataUtil } from './metadata/index';;\nimport { Modification, ModifyType, ChangeSet } from '../changeset/index';\nimport { PARENT_PATH, PARENT_CLASS, Dynamic } from './types';\nimport { EntityList } from './entity_list';\nimport { EntityFactory } from './entity_factory';\n\n/**\n * @author Lucas Huang\n * 实体抽象基类，所有实体必须扩展自Entity\n *\n * ### 使用示例\n * ```\n * export class UserEntity extends Entity {\n *    userId: string;\n *    userName: string;\n *\n *    constructor(data: any){\n *        super(data);\n *    }\n * }\n * ```\n */\nexport abstract class Entity {\n\n\n  // #region 私有、保护属性\n\n  /**\n   * 验证错误集合\n   */\n  private validErrors = {};\n\n  /**\n   * 增量变更集合\n   */\n  protected changeSet = new ChangeSet();\n\n  /**\n   * 是否正在验证\n   */\n  protected isValidating = false;\n\n  /**\n   * 新数据\n   */\n  protected newData = undefined;\n\n  // #endregion\n\n\n  // #region 公有属性\n\n  /**\n   * 变更流\n   */\n  public valueChanged = new Subject<Modification>();\n\n  /**\n   * 属性值改变时触发\n   *\n   * ### 使用示例\n   * ```\n   *  const entity = new UserEntity(data);\n   *  entity.onValueChanged.subscribe((data: Modification) => {\n   *      console.log(data);\n   *  })\n   *\n   * ```\n   *\n   * @event\n   */\n  public onValueChanged = this.valueChanged.asObservable();\n\n  /**\n   * 返回JSON格式的数据\n   */\n  public get data(): any {\n    return this.newData;\n  }\n\n  /**\n   * 验证错误集合\n   */\n  public get errors() {\n    return this.validErrors;\n  }\n\n  /**\n   * 实体变更集\n   */\n  public get changes(): Modification[] {\n    return this.changeSet.changes;\n  }\n\n  /**\n   * 是否变更\n   */\n  public hasChange = false;\n\n  /**\n   * 实体主键元数据\n   */\n  public get primaryProperty(): PrimitivePropMetadata {\n    return FieldMetadataUtil.getPrimaryFieldMetadata(this.constructor);\n  }\n\n  /**\n   * 主键\n   * @todo\n   * 1、没有主键时返回''不合理，应该返回undefined\n   */\n  public get primaryKey(): string {\n    if (this.primaryProperty) {\n      return this.primaryProperty.property;\n    } else {\n      return '';\n    }\n  }\n\n  /**\n   * 实体主键值\n   * 1、没有主键时返回''不合理，应该返回undefined\n   */\n  public get primaryValue(): string {\n    if (this.primaryKey) {\n      // return this[this.primaryProperty.property].toString();\n      const primaryValue = this[this.primaryProperty.property];\n      return primaryValue ? primaryValue : '';\n    } else {\n      return '';\n    }\n  }\n\n  // #endregion\n\n\n  /**\n   * @param data JSON数据\n   */\n  constructor(data: any) {\n    this.newData = Object.assign({}, data);\n    this.onValueChanged = this.valueChanged;\n    this.initialize();\n  }\n\n\n  // #region 公有方法\n\n  /**\n   * 将变更记录保存至变更集中\n   * @param value 变更记录\n   */\n  public setChanges(value: Modification): void {\n    const propertyName = value.path[value.path.length - 1];\n    // 增加实体变化后增加标志，加载数据或者重新加载不做标记\n    if (value.type !== ModifyType.Load) { this.hasChange = true; }\n\n    // @todo：事件会从下级向上冒泡，change可能是下级的，不能和当前Entity的newData合并。\n    // this.newData = Object.assign(this.newData, { [propertyName]: value.value });\n    this.valueChanged.next(value);\n    this.changeSet.append(value);\n  }\n\n  public getPaths() {\n    const pathObj = {\n      path: [],\n      isUdt: false,\n      isGrid: false\n    };\n    const handleParent = item => {\n      const parentPaths = item[PARENT_PATH];\n      if (parentPaths) {\n        const prop = parentPaths[parentPaths.length - 1];\n        // 父级所在实体包含的ngObject，存在当前实体字段，则判断为UDt字段\n        if (Object.keys(FieldMetadataUtil.getNgObjects(item[PARENT_CLASS].constructor)).indexOf(prop) > -1) {\n          pathObj.isUdt = true;\n        }\n        // 存在类型为ngList，则判断为grid\n        if (item[PARENT_CLASS] && item instanceof EntityList === true) {\n          pathObj.isGrid = true;\n        }\n        pathObj.path.push(prop);\n      }\n      if (item[PARENT_CLASS] && item instanceof EntityList === true) {\n        handleParent(item[PARENT_CLASS]);\n      }\n    };\n    handleParent(this);\n    pathObj.path = pathObj.path.reverse();\n    return pathObj;\n  }\n\n  /**\n   * 加载数据\n   * @param data 新数据\n   */\n  public load(data: any) {\n    if (!data) {\n      data = {};\n    }\n\n    this.loadFields(data);\n    this.loadLists(data);\n    this.loadObjects(data);\n\n    this.loadDynamicObjects(data);\n    this.newData = Object.assign({}, data);\n  }\n\n  /**\n   * 转换为JSON\n   */\n  public toJSON() {\n    const result = {};\n\n    // 简单属性\n    const ngFields = FieldMetadataUtil.getNgFields(this.constructor);\n    Object.keys(ngFields).forEach((propName: string) => {\n      const ngField = ngFields[propName];\n      const dataField = ngField.dataField || propName;\n      result[dataField] = this[propName];\n    });\n\n    // 对象属性\n    const ngObjects = FieldMetadataUtil.getNgObjects(this.constructor);\n    Object.keys(ngObjects).forEach((propName: string) => {\n      const ngObject = ngObjects[propName];\n      const dataField = ngObject.dataField || propName;\n      result[dataField] = this[propName] ? this[propName].toJSON() : {};\n    });\n\n    // 动态属性\n    const ngDynamics = FieldMetadataUtil.getNgDynamic(this.constructor);\n    Object.keys(ngDynamics).forEach((propName: string) => {\n      const ngDynamic = ngDynamics[propName];\n      const dataField = ngDynamic.dataField || propName;\n      result[dataField] = this[propName] ? this[propName].toJSON() : {};\n    });\n\n    // 列表属性\n    const ngLists = FieldMetadataUtil.getNgList(this.constructor);\n    Object.keys(ngLists).forEach((propName: string) => {\n      const ngList = ngLists[propName];\n      const dataField = ngList.dataField || propName;\n      result[dataField] = this[propName] ? this[propName].toJSON() : {};\n    });\n\n    return result;\n  }\n\n  // #endregion\n\n\n  //#region 实体初始化相关private方法\n\n  /**\n   * 初始化实体\n   */\n  private initialize() {\n    const constructor = this.constructor;\n\n    const ngFields = FieldMetadataUtil.getNgFields(constructor);\n    const ngObjects = FieldMetadataUtil.getNgObjects(constructor);\n    const ngLists = FieldMetadataUtil.getNgList(constructor);\n    const ngDynamic = FieldMetadataUtil.getNgDynamic(constructor);\n\n    this.initializeNormalField(ngFields);\n    this.initializeList(ngLists);\n    this.initializeObject(ngObjects);\n    this.initializeDynamic(ngDynamic);\n  }\n\n  /**\n   * 创建path\n   * @param propertyName 属性名称\n   */\n  protected createPath(propertyName: string): string[] {\n    const primaryFieldMetadata = this.primaryProperty;\n    if (primaryFieldMetadata) {\n      const primaryDataField = primaryFieldMetadata.dataField;\n      return [primaryDataField + ':' + this.primaryValue, propertyName];\n    } else {\n      return [':', propertyName];\n    }\n  }\n\n  /**\n   * 属性字段初始化\n   * @param ngFields 属性字段元数据\n   */\n  private initializeNormalField(ngFields: { [key: string]: PrimitivePropMetadata }): void {\n    Object.keys(ngFields).forEach(propName => {\n      const ngField = ngFields[propName] as PrimitivePropMetadata;\n      const dataField = ngField.dataField || propName;\n\n      if (delete this[propName]) {\n        Object.defineProperty(this, propName, {\n          get: function () {\n            return this.getPropValue(propName, ngField);\n          },\n          set: function (newPropValue) {\n\n            // 影响清空关联字段的主键值，移除此逻辑\n            // // 有主键的实体，不允许给实体赋空值\n            // if (this.primaryKey && this.primaryKey === propName && !newPropValue) {\n            //   return;\n            // }\n\n            // 有主键的实体，必须先给主键赋值，否则其他字段不允许赋值\n            if (this.primaryKey && this.primaryKey !== propName && !this.primaryValue) {\n              return;\n            }\n\n            // 值相同时不触发变更。\n            const oldPropValue = this.getPropValue(propName, ngField);\n            if (this.isPropValueChanged(propName, ngField, newPropValue, oldPropValue) === false) {\n              return;\n            }\n            this.setPropValue(propName, ngField, newPropValue);\n            this.emitValueChange(propName, ngField, newPropValue, oldPropValue);\n          },\n          configurable: true\n        });\n      }\n    });\n  }\n\n  /**\n   * 初始化列表类型的元数据\n   * @param ngListMetadata 列表类型元数据\n   */\n  private initializeList(ngListMetadata: { [key: string]: ListPropMetadata }): void {\n    Object.keys(ngListMetadata).forEach(propertyName => {\n      const fieldMetadata = ngListMetadata[propertyName] as ListPropMetadata;\n      const path = this.createPath(propertyName);\n      const dataField = fieldMetadata.dataField || propertyName;\n      const val = this.data[dataField];\n\n      const entityList = new EntityList<typeof fieldMetadata.type>();\n      entityList[PARENT_CLASS] = this;\n      entityList[PARENT_PATH] = path;\n\n      if (val) {\n        const entities = val.map(v => EntityFactory<typeof fieldMetadata.type>(fieldMetadata.type, v));\n        entityList.loadEntities(entities);\n      }\n\n      entityList.onListChanged.subscribe(value => {\n        if (value) {\n          if (entityList[PARENT_PATH][0] !== value.path[0]) {\n            value.path = entityList[PARENT_PATH].concat(value.path);\n          }\n          this.setChanges(value);\n        }\n      });\n      this[propertyName] = entityList;\n    });\n  }\n  /**\n   * 初始化子对象\n   * @param ngObjectMetadata 子对象元数据\n   */\n  private initializeObject(ngObjectMetadata: { [key: string]: ObjectPropMetadata }) {\n    Object.keys(ngObjectMetadata).forEach(propertyName => {\n      const fieldMetadata = ngObjectMetadata[propertyName] as ObjectPropMetadata;\n      const path = this.createPath(propertyName);\n      const dataField = fieldMetadata.dataField || propertyName;\n\n      // val不存在时，用空对象代替\n      const val = this.data[dataField] || {};\n\n      const createEntityFromJsonData = (value: any) => {\n        let instance;\n        if (value instanceof fieldMetadata.type) {\n          instance = value;\n        } else {\n          instance = EntityFactory(fieldMetadata.type, value);\n        }\n        instance[PARENT_CLASS] = this;\n        instance[PARENT_PATH] = path;\n\n        instance.onValueChanged.subscribe(changes => {\n          if (changes) {\n            changes.path = (this[PARENT_PATH] || []).concat(changes.path);\n            this.setChanges(changes);\n          }\n        });\n\n        return instance;\n      };\n\n      // 如果没有值用一个空对象代替\n      let childEntity = createEntityFromJsonData(val);\n      if (delete this[propertyName]) {\n        Object.defineProperty(this, propertyName, {\n          get: () => {\n            return childEntity;\n          },\n          set: function (value: any) {\n            const modifyInfo = {\n              path: childEntity[PARENT_PATH],\n              value: value.data,\n              preValue: this[propertyName].data,\n              type: ModifyType.ValueChange\n            };\n            childEntity = createEntityFromJsonData(value);\n            this.setChanges(modifyInfo);\n          },\n          configurable: true\n        });\n      }\n    });\n  }\n\n  private initializeDynamic(ngDynamicMetadata: { [key: string]: DynamicPropMetadata }) {\n    Object.keys(ngDynamicMetadata).forEach(propertyName => {\n      const fieldMetadata = ngDynamicMetadata[propertyName] as DynamicPropMetadata;\n      const path = this.createPath(propertyName);\n      const dataField = fieldMetadata.dataField || propertyName;\n\n      const originalData = this.data[dataField] || {};\n\n      const createEntityFromJsonData = (value: any) => {\n        let instance;\n        if (value instanceof fieldMetadata.type) {\n          instance = value;\n        } else {\n          instance = EntityFactory(fieldMetadata.type, value);\n        }\n        instance[PARENT_CLASS] = this;\n        instance[PARENT_PATH] = path;\n\n        instance.onValueChanged.subscribe(changes => {\n          if (changes) {\n            changes.path = (this[PARENT_PATH] || []).concat(changes.path);\n            this.setChanges(changes);\n          }\n        });\n\n        return instance;\n      };\n\n      let dynamicEntity = createEntityFromJsonData(originalData);\n      if (delete this[propertyName]) {\n        Object.defineProperty(this, propertyName, {\n          get: function () {\n            return dynamicEntity;\n          },\n          set: function (value) {\n            const modifyInfo = {\n              path: dynamicEntity[PARENT_PATH],\n              value: value.data,\n              preValue: this[propertyName].data,\n              type: ModifyType.ValueChange\n            };\n            dynamicEntity = createEntityFromJsonData(value);\n            this.setChanges(modifyInfo);\n          },\n          configurable: true\n        });\n      }\n    });\n  }\n\n  //#endregion\n\n\n  // #region 加载实体数据相关private、projected方法\n\n  /**\n   * 加载简单字段值\n   * @todo 临时用修改的方式模拟\n   */\n  protected loadFields(data: any) {\n    const ngFields = FieldMetadataUtil.getNgFields(this.constructor);\n    Object.keys(ngFields).forEach((propName: string) => {\n      const ngField = ngFields[propName];\n      const dataField = ngField.dataField || propName;\n      // if (ngField.primary === false) {\n      //   this[propName] = data[dataField];\n      // }\n      this[propName] = data[dataField];\n    });\n  }\n\n  /**\n   * 加载子列表数据\n   * @param data 数据\n   */\n  protected loadLists(data: any) {\n    const ngLists = FieldMetadataUtil.getNgList(this.constructor);\n    Object.keys(ngLists).forEach((propName: string) => {\n      const ngList = ngLists[propName];\n      const dataField = ngList.dataField || propName;\n      const entityType = ngList.type;\n\n      // 创建实体\n      const listData = data[dataField];\n      if (listData) {\n        const entities = listData.map((entityData: any) => {\n          return EntityFactory<typeof entityType>(entityType, entityData);\n        });\n        this[propName].loadEntities(entities);\n      } else {\n        this[propName].loadEntities([]);\n      }\n    });\n  }\n\n  private loadObjects(data: any) {\n    const ngObjects = FieldMetadataUtil.getNgObjects(this.constructor);\n    Object.keys(ngObjects).forEach((propName: string) => {\n      const ngObject = ngObjects[propName];\n      const dataField = ngObject.dataField || propName;\n      const objectData = data[dataField];\n      const entity = this[propName] as Entity;\n      if (!entity || !objectData) {\n        return;\n      }\n      entity.load(objectData);\n    });\n  }\n\n  protected loadDynamicObjects(data: any) {\n    const ngDynamicObjects = FieldMetadataUtil.getNgDynamic(this.constructor);\n    Object.keys(ngDynamicObjects).forEach((propName: string) => {\n      const ngDynamicObject = ngDynamicObjects[propName];\n      const dataField = ngDynamicObject.dataField || propName;\n\n      const dynamicData = data[dataField] || {};\n      const dynamicEntity = this[propName] as Dynamic;\n      if (!dynamicEntity) {\n        return;\n      }\n      dynamicEntity.loadDynamicData(dynamicData);\n    });\n  }\n\n  // #endregion\n\n  // #region 私有工具方法\n\n\n  /**\n   * 发送值变更\n   */\n  private emitValueChange(propName: string, propMetadata: PrimitivePropMetadata, newPropValue: any, oldPropValue: any): void {\n    const change = {\n      path: this.createPath(propName),\n      value: newPropValue,\n      preValue: oldPropValue,\n      type: ModifyType.ValueChange\n    };\n\n    if (this[PARENT_PATH]) {\n      change.path = this[PARENT_PATH].concat(change.path);\n    }\n    this.setChanges(change);\n  }\n\n  /**\n   * 获取属性值\n   */\n  private getPropValue(propName: string, propMetadata: PrimitivePropMetadata) {\n    const dataField = propMetadata.dataField || propName;\n    const value = this.data[dataField];\n\n    // 对多语录入字段，query不返回问题进行兼容\n    if (propMetadata.enableMultiLangInput === true && !value) {\n      const langCode = window.localStorage.getItem('languageCode') || 'zh-CHS';\n      const originDataField = dataField.replace('_MULTILANGUAGE', '');\n      return {\n        [langCode]: this.data[originDataField]\n      };\n    }\n    return value;\n  }\n\n  /**\n   * 设置属性值\n   */\n  private setPropValue(propName: string, propMetadata: PrimitivePropMetadata, propValue: any) {\n    const dataField = propMetadata.dataField || propName;\n    this.data[dataField] = propValue;\n  }\n\n  /**\n   * 检查属性值是否发生变化\n   */\n  private isPropValueChanged(propName: string, propMetadata: PrimitivePropMetadata, newPropValue: any, oldPropValue: any) {\n    if (propMetadata.enableMultiLangInput === true) {\n      if (this.isEmptyMultiLangPropValue(newPropValue) === true && this.isEmptyMultiLangPropValue(oldPropValue) === true) {\n        return false;\n      }\n      return JSON.stringify(newPropValue) !== JSON.stringify(oldPropValue);\n    } else {\n      return newPropValue !== oldPropValue;\n    }\n  }\n\n  /**\n   * 多语录入字段的值是否为空\n   */\n  private isEmptyMultiLangPropValue(value: any) {\n    return !value || Object.keys(value).length === 0;\n  }\n\n  // #endregion\n}\n","import { ModifyType, Modification } from '../changeset/types';\nimport { PARENT_PATH, Dynamic, PARENT_CLASS } from './types';\nimport { Entity } from './entity';\n\n/**\n * 支持动态字段集合的动态实体\n */\nexport class DynamicEntity extends Entity implements Dynamic {\n\n  /**\n   * 是否是嵌套的动态实体\n   */\n  public get IsNested(): boolean {\n    return this[PARENT_CLASS] instanceof DynamicEntity;\n  }\n\n  /**\n   * @param data JSON数据\n   */\n  constructor(data: any) {\n    super(data);\n    this.loadDynamicData(data);\n  }\n\n  public loadDynamicData(dynamicData: any) {\n    this.initializeDynamicField(dynamicData);\n    // super.loadFields(dynamicData);\n  }\n\n  /**\n   * 初始化动态数据\n   * @param dynamicData 动态数据\n   */\n  private initializeDynamicField(dynamicData: any): void {\n    // 遍历动态数据的key，创建动态实体属性。\n    Object.keys(dynamicData).forEach(propertyName => {\n\n      // 如果属性已经存在，先删除\n      if (this[propertyName]) {\n        delete this[propertyName];\n      }\n\n      const dataField = propertyName;\n      if (dynamicData[propertyName] instanceof Object) {\n        const path = this.createPath(propertyName);\n        let dynamicEntity = this.createDynamicEntityFromJsonData(dynamicData[propertyName], path);\n        Object.defineProperty(this, propertyName, {\n          get: function() {\n            return dynamicEntity;\n          },\n          set: function(value) {\n            const modifyInfo = {\n              path: dynamicEntity[PARENT_PATH],\n              value: value.data,\n              preValue: this[propertyName].data,\n              type: ModifyType.ValueChange\n            };\n            dynamicEntity = this.createDynamicEntityFromJsonData(value, path);\n            this.setChanges(modifyInfo);\n          },\n          configurable: true\n        });\n      } else {\n        Object.defineProperty(this, propertyName, {\n          // 定义返回数据方法。\n          get: function() {\n            // 从初始数据返回字段值。\n            return this.data[dataField];\n          },\n          set: function(value) {\n            // 值相同时不触发变更。\n            const oldValue = this.data[dataField];\n            if (oldValue === value) {\n              return;\n            }\n            // 更新元数据数据。\n            this.data[dataField] = value;\n            // 变更集\n            const changes = {\n              type: ModifyType.ValueChange,\n              path: this.createPath(propertyName),\n              value: value,\n              preValue: oldValue\n            };\n\n            if (this[PARENT_PATH]) {\n              changes.path = this[PARENT_PATH].concat(changes.path);\n            }\n            this.setChanges(changes);\n          },\n          configurable: true\n        });\n      }\n    });\n  }\n\n  private createDynamicEntityFromJsonData(value: any, parentPath: string[]) {\n    let instance: DynamicEntity;\n    if (value instanceof DynamicEntity) {\n      instance = value;\n    } else {\n      instance = new DynamicEntity(value);\n    }\n    instance[PARENT_CLASS] = this;\n    instance[PARENT_PATH] = parentPath;\n    instance.onValueChanged.subscribe(changes => {\n      if (changes) {\n        changes.path = (this[PARENT_PATH] || []).concat(changes.path);\n        this.setChanges(changes);\n      }\n    });\n\n    return instance;\n  }\n\n  /**\n   * 将变更记录保存至变更集中\n   * @param value 变更记录\n   * @todo\n   * 1、preValue的处理有问题，下级传递上来的变更这样可以，根DyanmicaEntity上的，data已经发生变化，prevalue和value是一样了；\n   * 2、当value是下级冒泡上来的，需要根据value去更新当前层级的data，该逻辑不应该放在setChagnes，待修改。\n   */\n  setChanges(value: Modification): void {\n    const propertyName = value.path[value.path.length - 1];\n    const preValue = Object.assign({}, this.data);\n    this.newData = Object.assign(this.newData, { [propertyName]: value.value });\n    let parentPath = value.path;\n    if (value.path.length > 2) {\n      parentPath = value.path.slice(0, value.path.length - 2);\n    }\n\n    // 统一不使用构造函数（保持和其他位置对Modification的构造一致）\n    // const parentModification = new Modification(this.data, value.type, parentPath, preValue);\n    const parentModification: Modification = {\n      path: parentPath,\n      value: this.data,\n      preValue: preValue,\n      type: value.type\n    };\n\n    this.valueChanged.next(parentModification);\n    this.changeSet.append(value);\n  }\n\n  /**\n   * toJSON\n   */\n  public toJSON() {\n    return this.data;\n  }\n}\n","/*\n * @Author: Witt\n * @Date: 2018-10-01 19:36:51\n * @Last Modified by: aalizzwell\n * @Last Modified time: 2019-09-03 19:46:42\n */\nimport { Type } from '../core/index';\nimport { Modification, ModifyType } from '../changeset/index';\nimport { Subject } from 'rxjs';\nimport { Entity, FieldMetadataUtil, EntityList } from '../entity/index';\nimport { DataTypeInfo } from '../entity/index';\n\n// tslint:disable: no-bitwise\n/**\n * 实体集合\n * @todo：应该用EntityList代替。\n */\nclass EntityCollection<T extends Entity> {\n\n  /**\n   * 内部实体Set\n   */\n  private innerEntitySet: Set<T>;\n\n  /**\n   * 内部实体Map\n   */\n  private innerEntityMap: Map<string, T>;\n\n\n  /**\n   * Entity集合变更流\n   */\n  public collectionChanged: Subject<Modification>;\n\n  /**\n   * 内部实体变更\n   */\n  public changes: Subject<Modification>;\n\n  /**\n   * 实体类型\n   */\n  public readonly entityType: Type<T>;\n\n  /**\n   * 实体主键\n   */\n  public readonly primaryKey: string;\n\n  /**\n   * 实体当前分页信息\n   */\n  public paginationInfo: any;\n\n  /**\n   * 实体类型描述\n   */\n  public entityTypeInfo: DataTypeInfo;\n\n\n  /**\n   * 构造函数\n   */\n  constructor(entityType: Type<T>) {\n    this.innerEntitySet = new Set<T>();\n    this.innerEntityMap = new Map<string, T>();\n    this.collectionChanged = new Subject<Modification>();\n    this.changes = new Subject<Modification>();\n\n    this.entityType = entityType;\n    this.primaryKey = FieldMetadataUtil.getPrimaryKey(this.entityType);\n  }\n\n  /**\n   * 实体数量\n   */\n  public count(): number {\n    return this.innerEntitySet.size;\n  }\n\n  public get entityTypeName() {\n    return this.entityType.name;\n  }\n  /**\n   * 是否包含指定主键值的实体\n   * @param id 主键值\n   */\n  public has(id: string): boolean {\n    return this.innerEntityMap.has(id);\n  }\n\n  /**\n   * 清空全部实体\n   */\n  public clear() {\n    this.innerEntityMap.clear();\n    this.innerEntitySet.clear();\n    this.notifyCollectionChanged(new Modification([], ModifyType.Load));\n  }\n  /**\n   * 清空全部实体\n   * @param isReset 是否为重置实体操作\n   */\n  public reset() {\n    this.innerEntityMap.clear();\n    this.innerEntitySet.clear();\n    const modification = new Modification([], ModifyType.Load);\n    modification.isReset = true;\n    this.notifyCollectionChanged(modification);\n  }\n  /**\n   * 转换为实体数组\n   */\n  public toArray(): Entity[] {\n    return Array.from(this.innerEntitySet);\n  }\n\n  /**\n   * 转换为JSON数组\n   */\n  public toJSON(): any[] {\n    const result = [];\n    const entities = this.toArray();\n    entities.forEach((entity: Entity) => {\n      result.push(entity.toJSON());\n    });\n    return result;\n  }\n\n  /**\n   * 批量加载实体\n   */\n  public loadEntities(entities: any[], entityCreate: boolean = false) {\n\n    this.innerEntityMap.clear();\n    this.innerEntitySet.clear();\n\n    entities.forEach(entity => {\n      this.innerEntitySet.add(entity);\n      this.innerEntityMap.set(entity[this.primaryKey], entity);\n      this.listenEntityChangeEvent(entity);\n    });\n    const modification = new Modification(entities, ModifyType.Load);\n    modification.entityCreate = entityCreate;\n    this.notifyCollectionChanged(modification);\n\n  }\n\n  /**\n   * 追加实体\n   * @param entity 要追加的实体\n   * @param isCloned 实体是否是克隆的\n   */\n  public addEntity(entity: T,  isCloned: boolean = false) {\n    this.verifyEntityToAdd(entity);\n    this.innerEntitySet.add(entity);\n    this.innerEntityMap.set(entity[this.primaryKey], entity);\n    this.listenEntityChangeEvent(entity);\n    const modifyType = isCloned ? ModifyType.Clone : ModifyType.Add;\n    this.notifyCollectionChanged(new Modification([entity], modifyType));\n  }\n  /**\n   * 在当前行前或后插入数据\n   * @param entity 实体\n   * @param position 位置\n   */\n  public insertEntity(entity: any, position: 1 | -1) {\n    this.verifyEntityToAdd(entity);\n    this.innerEntitySet.add(entity);\n    this.innerEntityMap.set(entity[this.primaryKey], entity);\n    this.listenEntityChangeEvent(entity);\n    this.notifyCollectionChanged(new Modification(entity, ModifyType.Insert, null, null, position));\n  }\n  /**\n   * 更新实体\n   * @param entity entity\n   * @param entityData 实体数据\n   */\n  public updateEntity(entity: any, entityData: any) {\n    entity.load(entityData);\n    this.notifyCollectionChanged(new Modification(entity, ModifyType.Update, null, null));\n  }\n  /**\n   * 批量追加实体\n   * @param entities 要加载的实体数组\n   */\n  public addEntities(entities: T[]) {\n    if (!entities) {\n      return;\n    }\n    const entitiesToAdd: T[] = [];\n    entities.forEach(entity => {\n      this.verifyEntityToAdd(entity);\n      entitiesToAdd.push(entity);\n    });\n    entitiesToAdd.forEach(entity => {\n      this.innerEntitySet.add(entity);\n      this.innerEntityMap.set(entity[this.primaryKey], entity);\n      this.listenEntityChangeEvent(entity);\n    });\n    this.notifyCollectionChanged(new Modification(entitiesToAdd, ModifyType.Add));\n  }\n  /**\n   * 添加实体（不切换当前行）\n   * @param entities 实体\n   */\n  public addData(entities: any[]) {\n    if (!entities) {\n      return;\n    }\n    const entitiesToAdd: any[] = [];\n    entities.forEach(entity => {\n      this.verifyEntityToAdd(entity);\n      entitiesToAdd.push(entity);\n    });\n    entitiesToAdd.forEach(entity => {\n      this.innerEntitySet.add(entity);\n      this.innerEntityMap.set(entity[this.primaryKey], entity);\n      this.listenEntityChangeEvent(entity);\n    });\n    this.notifyCollectionChanged(new Modification(entitiesToAdd, ModifyType.AddData));\n  }\n\n\n  /**\n   * 根据主键值获取实体\n   */\n  getEntityById(identity: string): T {\n    if (this.innerEntityMap.has(identity) === false) {\n      return null;\n    }\n    const entity = this.innerEntityMap.get(identity);\n    return entity;\n  }\n\n  /**\n   * 根据路径获取实体\n   */\n  getEntityByPath(pathArray: string[]): any {\n    const rootEntityId = pathArray[0].split(':')[1];\n\n    let parentNode: any = this.getEntityById(rootEntityId);\n    for (let i = 1; i < pathArray.length && parentNode; i = i + 1) {\n      const currentPath = pathArray[i];\n      if (parentNode instanceof Entity) {\n\n        // @todo：强识了别冒号\n        if (currentPath.indexOf(':') === -1) {\n          parentNode = parentNode[pathArray[i]];\n        }\n      } else {\n        parentNode = parentNode.get(pathArray[i].split(':')[1]);\n      }\n    }\n\n    return parentNode;\n  }\n  /**\n   * id:1/a/id:2/c\n   * @param pathArray 路径数组\n   */\n  public getEntitiesByPath(pathArray: string[]) {\n    const rootEntityId = pathArray[0].split(':')[1];\n    let entity: any = this.getEntityById(rootEntityId);\n    for (let i = 1; i < pathArray.length && entity; i += 2) {\n      const path = pathArray[i];\n      entity = entity[path];\n      if (!(entity instanceof EntityList)) {\n        throw new Error('路径格式错误');\n      }\n      if ((i + 1) < pathArray.length) {\n        const id = pathArray[i + 1].split(':')[1];\n        entity = entity.get(id);\n      }\n    }\n    return entity;\n  }\n  /**\n   * 返回符合指定条件的实体集合\n   * @param predicate 条件谓词\n   */\n  getEntities(predicate: (value: T, index: number, array: T[]) => T): T[] {\n    const entities: T[] = Array.from(this.innerEntitySet);\n    const matchedEntities = entities.filter(predicate);\n    return matchedEntities;\n  }\n\n  /**\n   * 获取全部实体\n   */\n  getAllEntities(): T[] {\n    return Array.from(this.innerEntitySet);\n  }\n\n  /**\n   * 根据主键值删除对应实体\n   * @param identity 主键值\n   */\n  removeEntityById(identity: string): T {\n    this.verifyEntityToRemove(identity);\n    const entityToRemove = this.innerEntityMap.get(identity);\n    this.innerEntityMap.delete(identity);\n    this.innerEntitySet.delete(entityToRemove);\n    this.notifyCollectionChanged(new Modification([entityToRemove], ModifyType.Remove));\n    return entityToRemove;\n  }\n\n  removeEntitiesByIds(id: string) {\n  }\n\n  /**\n   * 删除符合条件的实体集合\n   */\n  public removeEntities(predicate: (value: T, index: number, array: T[]) => any): T[] {\n    const entitiesToRemove = Array.from(this.innerEntitySet).filter(predicate);\n    entitiesToRemove.forEach(entityToRemove => {\n      this.innerEntityMap.delete(entityToRemove[this.primaryKey]);\n      this.innerEntitySet.delete(entityToRemove);\n    });\n    this.notifyCollectionChanged(new Modification(entitiesToRemove, ModifyType.Remove));\n    return entitiesToRemove;\n  }\n  /**\n   * 移除数据（不切换当前行）\n   * @param predicate 过滤函数\n   */\n  public removeData(predicate: (value: any, index: number, array: any[]) => any): any[] {\n    const entitiesToRemove = Array.from(this.innerEntitySet).filter(predicate);\n    entitiesToRemove.forEach(entityToRemove => {\n      this.innerEntityMap.delete(entityToRemove[this.primaryKey]);\n      this.innerEntitySet.delete(entityToRemove);\n    });\n    this.notifyCollectionChanged(new Modification(entitiesToRemove, ModifyType.RemoveData));\n    return entitiesToRemove;\n  }\n  /**\n   * 重置子表数据\n   * @param paths 路径\n   * 路径格式 ['id:provinceId','id:cityMDMs','zoneMDMs']\n   * @description path参数格式\n   * ```json\n   * [\n   * \"id:b5ed23ca-88d9-4377-98ec-92f35c1325f1\",\n   * \"cityMDMs\",\n   * \"id:373706af-622f-4aea-a006-dddbffd7bda3\",\n   * \"zoneMDMs\"\n   * ]\n   * ```\n   * @param entities 实体数组\n   */\n  public resetEntities(paths: string[], entities: T[]) {\n    if (paths[0].indexOf(':') === -1) {\n      throw new Error('路径格式错误');\n    }\n    // paths里面第一个一定是id\n    const entityInfo: string[] = paths[0].split(':');\n    const [entityPrimaryKey, entityId] = entityInfo;\n    let entity: T = null;\n    for (const element of this.innerEntitySet) {\n      if (element[entityPrimaryKey] === entityId) {\n        entity = element;\n        break;\n      }\n    }\n    // for (let index = 0; index < this.innerEntitySet; index++) {\n    //   const element: T = this.innerEntitySet[index];\n    //   if (element[entityPrimaryKey] === entityId) {\n    //     entity = element;\n    //     break;\n    //   }\n    // }\n    if (!entity) {\n      throw new Error(`找不到${entityPrimaryKey}为${entityId}的实体`);\n    }\n    let data: any = entity;\n    paths.slice(1).forEach(path => {\n      data = data[path];\n    });\n    const entityList = data as EntityList<T>;\n    entityList.clear();\n    entityList.loadEntities(entities);\n  }\n\n  /**\n   * 验证实体是否能够添加\n   */\n  private verifyEntityToAdd(entity: T): boolean {\n    if (this.has(entity[this.primaryKey])) {\n      this.innerEntitySet.delete(this.innerEntityMap.get(entity[this.primaryKey]));\n      this.innerEntityMap.delete(entity[this.primaryKey]);\n      // throw new Error(`The repository already had an item with the save identity of '${entity[this.primaryKey]}'`);\n    }\n    return true;\n  }\n\n  /**\n   * 验证实体是否能移除\n   */\n  private verifyEntityToRemove(identity: string): boolean {\n    if (!this.has(identity)) {\n      throw new Error(`The entity with identity of '${identity} dose not exsit.'`);\n    }\n    return true;\n  }\n\n  /**\n   * 实体集合变更流\n   */\n  private notifyCollectionChanged(modification: Modification) {\n    this.collectionChanged.next(modification);\n  }\n\n  //#region 分页\n\n  /**\n   * 设置分页大小\n   */\n  set pageSize(pageSize: number) {\n    if (typeof (pageSize) !== 'number' || pageSize < 0) {\n      throw new Error('Invalid parameter:pageSize');\n    }\n\n    const original = this.paginationInfo;\n    // const entityPaginationInfo = Object.assign({}, original[this.entityTypeName], { pageSize });\n    // this.paginationInfo = Object.assign({}, original, { [this.entityTypeName]: entityPaginationInfo });\n    // this.notifyCollectionChanged(new Modification(this.paginationInfo[this.entityTypeName], ModifyType.PaginationInfoChange));\n    this.paginationInfo = Object.assign({}, original, { pageSize });\n    this.notifyCollectionChanged(new Modification(this.paginationInfo, ModifyType.PaginationInfoChange));\n  }\n  /**\n   * 获取分页大小\n   * @description 如果用户未指定分页大小则默认为0，即获取所有数据\n   */\n  get pageSize(): number {\n    if (!!this.paginationInfo) {\n      return this.paginationInfo.pageSize || 0;\n    }\n    return 0;\n  }\n  /**\n   * 设置数据总条数\n   */\n  set totalCount(total: number) {\n    if (typeof (total) !== 'number' || total < 0) {\n      throw new Error('Invalid parameter:total');\n    }\n\n    const original = this.paginationInfo;\n    // const entityPaginationInfo = Object.assign({}, original[this.entityTypeName], { total });\n    // this.paginationInfo = Object.assign({}, original, { [this.entityTypeName]: entityPaginationInfo });\n    this.paginationInfo = Object.assign({}, original, { total });\n    this.notifyCollectionChanged(new Modification(this.paginationInfo, ModifyType.PaginationInfoChange));\n  }\n  /**\n   * 获取数据总条数\n   */\n  get totalCount(): number {\n    if (!!this.paginationInfo) {\n      return this.paginationInfo.total || 0;\n    }\n    return 0;\n  }\n  /**\n   * 设置当前页码\n   */\n  set pageIndex(pageIndex: number) {\n    if (typeof (pageIndex) !== 'number' || pageIndex < 0) {\n      throw new Error('Invalid parameter:pageIndex');\n    }\n\n    const original = this.paginationInfo;\n    // const entityPaginationInfo = Object.assign({}, original[this.entityTypeName], { pageIndex });\n    // this.paginationInfo = Object.assign({}, original, { [this.entityTypeName]: entityPaginationInfo });\n    this.paginationInfo = Object.assign({}, original, { pageIndex });\n    this.notifyCollectionChanged(new Modification(this.paginationInfo, ModifyType.PaginationInfoChange));\n  }\n  /**\n   * 获取当前页码\n   */\n  get pageIndex(): number {\n    if (!!this.paginationInfo) {\n      return this.paginationInfo.pageIndex || 1;\n    }\n    return 1;\n  }\n  /**\n   * 更新分页信息\n   * @param path 绑定路径\n   * @param pageInfo 分页信息\n   */\n  public updatePaginationInfoByPath(path: string, pageInfo: { pageIndex: any, pageSize: any, totalCount: any, [prop: string]: any }) {\n    const original = this.paginationInfo;\n    const { pageIndex, pageSize, totalCount: total } = pageInfo;\n    const paginationInfo = Object.assign({}, original, { pageIndex, pageSize, total });\n    this.setPaginationConfigByPath(path, paginationInfo);\n  }\n  /**\n   * 根据路径获取分页大小\n   * @param path 路径\n   */\n  public getPaginationConfigByPath(path: string, defaultValue?: any) {\n    if (!path || path === '/') {\n      return this.paginationInfo;\n    }\n    if (typeof path !== 'string') {\n      throw new Error('路径必须为字符串！');\n    }\n    path = path.substring(1);\n    const paths = path.split('/').filter(item => !!item && item.trim().length > 0).map(item => item.trim());\n    let config = this.paginationInfo;\n    paths.forEach(item => {\n      if (config && config.hasOwnProperty(item)) {\n        config = config[item];\n      } else {\n        config = null;\n      }\n    });\n    return !!config ? config : typeof defaultValue !== 'undefined' ? defaultValue : undefined;\n  }\n  /**\n   * 设置分页信息\n   * @param path 路径\n   * @param value 值\n   */\n  public setPaginationConfigByPath(path: string | Array<any>, value: any) {\n    const original = JSON.stringify(this.paginationInfo);\n    if (!path || path === '/') {\n      this.paginationInfo = value;\n    } else {\n      if (!Array.isArray(path)) {\n        path = path.toString().match(/[^/[\\]]+/g) || [];\n      }\n      path.slice(0, -1).reduce((prev, current, index) =>\n        Object(prev[current]) === prev[current]\n          ? prev[current]\n          : prev[current] = Math.abs(path[index + 1]) >> 0 === +path[index + 1]\n            ? []\n            : {},\n        this.paginationInfo)[path[path.length - 1]] = value;\n    }\n\n    if (JSON.stringify(this.paginationInfo) !== original) {\n      this.notifyCollectionChanged(new Modification(this.paginationInfo, ModifyType.PaginationInfoChange));\n    }\n    return this.paginationInfo;\n  }\n  //#endregion\n\n  /**\n   * 监听实体变更\n   */\n  private listenEntityChangeEvent(entity: Entity) {\n    if (entity) {\n      entity.onValueChanged.subscribe((change: Modification) => this.changes.next(change));\n    }\n  }\n\n}\n\nexport { EntityCollection };\n","/*\n * @Author: Witt\n * @Date: 2019-03-07 17:24:38\n * @Last Modified by:   Witt\n * @Last Modified time: 2019-03-11 19:50:38\n */\n\nimport { Type } from '../core/index';\nimport { Entity, EntityList, createEntity, createEntities } from '../entity/index';\nimport { EntityCollection } from './entity_collection';\nimport { DataPath, DataPathCreator, DataPathNodeType, DataTypeInfo } from '../entity/index';\nimport { EntityUtil } from '../binding-data/entity_util';\n\n\n/**\n * 实体管理类\n */\nclass EntityManager<T extends Entity> {\n\n  /**\n   * 实体类型\n   */\n  public entityType: Type<Entity>;\n\n  /**\n   * 实体集合\n   */\n  public entityCollection: EntityCollection<Entity>;\n\n  /**\n   * 构造函数\n   */\n  constructor(entityCollection: EntityCollection<T>) {\n    this.entityCollection = entityCollection;\n    this.entityType = entityCollection.entityType;\n  }\n\n\n  // #region 创建实体相关方法\n\n  /**\n   * 创建实体\n   */\n  public createEntity(entityData: any): T {\n    const entity = createEntity<T>(this.entityType, entityData);\n    return entity;\n  }\n\n  /**\n   * 批量创建实体\n   */\n  public createEntities(entityListData: any[], entityType: any): T[] {\n    const entities: T[] = createEntities<T>(this.entityType, entityListData);\n    return entities;\n  }\n  /**\n   * 批量创建下级实体\n   * @param fPath fpath\n   * @param entityListData 实体数据\n   */\n  public createEntitiesByPath(fPath: string, entityListData: any[]) {\n    const subPaths = fPath.split('/');\n    if (subPaths.length < 3) {\n      throw Error(`根据path删除实体数据出错了。传入的path[${fPath}]格式不对`);\n    }\n    if (entityListData.length < 1) {\n      return [];\n    }\n    let childEntityList: EntityList<any>;\n    let propInfo: { propType: string, propEntityType: any };\n    let propName: string;\n    for (let i = 2; i < subPaths.length; i = i + 2) {\n      const fid = subPaths[i - 1];\n      propName = subPaths[i];\n      const parentEntity = childEntityList ? childEntityList.get(fid) : this.entityCollection.getEntityById(fid);\n      childEntityList = parentEntity[propName];\n      const entityType = propInfo ? propInfo.propEntityType : this.entityType;\n      propInfo = EntityUtil.getPropInfo(entityType, propName);\n      if (!childEntityList) {\n        throw Error(`fpath参数错误，无法找到${propName}对应的子表。fpath为：${fPath}`);\n      }\n    }\n    const entities = entityListData.map(entityData => {\n      return createEntity<Entity>(propInfo.propEntityType, entityData);\n    });\n    return entities;\n  }\n  // #endregion\n\n\n  // #region 获取实体、实体数组相关方法\n\n  /**\n   * 获取path对应的实体\n   */\n  public getEntityByPath(path: string[]): Entity {\n    const entity = this.getEntityNodeByPath(path) as Entity;\n    return entity;\n  }\n\n  /**\n   * 获取path对应的实体\n   */\n  public getEntitiesByPath(path: string[]): Entity[] {\n    const entityCollectionOrList = this.getEntityNodeByPath(path) as EntityCollection<Entity> | EntityList<Entity>;\n    let entities: Entity[];\n    if (entityCollectionOrList instanceof EntityCollection === true) {\n      entities = (entityCollectionOrList as EntityCollection<Entity>).toArray();\n    } else {\n      entities = (entityCollectionOrList as EntityList<Entity>).toArray();\n    }\n    return entities;\n  }\n\n  /**\n   * 获取实体节点\n   * @param path 节点路径\n   */\n  public getEntityNodeByPath(path: string[]): EntityCollection<Entity> | EntityList<Entity> | Entity {\n    const dataPath = DataPathCreator.createByLongPathFromRoot(path, this);\n    let entityNode: any = this.entityCollection;\n    let pathNode = dataPath.head.next;\n    while (pathNode) {\n      if (pathNode.type === DataPathNodeType.DataId) {\n        if (entityNode instanceof EntityCollection === true) {\n          entityNode = (entityNode as EntityCollection<Entity>).getEntityById(pathNode.value);\n        } else {\n          entityNode = (entityNode as EntityList<Entity>).get(pathNode.value);\n        }\n      } else {\n        entityNode = entityNode[pathNode.value];\n      }\n      if (!entityNode) {\n        throw new Error(`找不到${pathNode.value}对应的数据节点`);\n      }\n      pathNode = pathNode.next;\n    }\n    return entityNode;\n  }\n  // #endregion\n\n\n  // #region 获取、设置属性值\n\n  /**\n   * 获取path对应的实体属性值\n   */\n  public getPropValueByPath(path: string[]): any {\n    const propName = path.pop();\n    const entity = this.getEntityByPath(path);\n    return entity[propName];\n  }\n\n  /**\n   * 设置path对应实体的属性值\n   */\n  public setPropValueByPath(path: string[], propValue: any): void {\n    const propName = path.pop();\n    const entity = this.getEntityByPath(path);\n    entity[propName] = propValue;\n  }\n\n  // #endregion\n\n\n  // #region 插入实体\n\n  /**\n   * 在path对应实体前插入实体\n   */\n  public insertEntityBeforeByPath(fpath: string[]) {\n    throw new Error('Not Implemented');\n  }\n\n  /**\n   * 在path对应实体前批量插入实体\n   */\n  public insertEntitiesBeforeByPath() {\n    throw new Error('Not Implemented');\n  }\n\n  /**\n   * 在path对应实体前插入实体\n   */\n  public insertEntityAfterByPath() {\n    throw new Error('Not Implemented');\n  }\n\n  /**\n   * 在path对应实体前批量插入实体\n   */\n  public insertEntitiesAfterByPath() {\n    throw new Error('Not Implemented');\n  }\n\n  // #endregion\n\n\n  // #region 追加实体\n\n  /**\n   * 在path对应的实体集合中追加1个实体\n   */\n  // public appendEntityByPath(fpath: string[], entity: Entity): void {\n  //   const entityCollectionOrList = this.getEntityNodeByPath(fpath);\n  //   if (entityCollectionOrList instanceof EntityCollection === true) {\n  //     const entityCollection = entityCollectionOrList as EntityCollection<Entity>;\n  //     entityCollection.addEntity(entity);\n  //   } else {\n  //     const entityList = (entityCollectionOrList as EntityList<Entity>);\n  //     entityList.appendEntity(entity);\n  //   }\n  // }\n\n  /**\n   * 根据path获取实体集合\n   * @param fpath 路径\n   * @param entityData 实体数据\n   * @param initialData[可选] 默认值\n   */\n  public appendEntityByPath(fpath: string, entityData: any, initialData?: any, isCloned: boolean = false): Entity {\n    const subPaths = fpath.split('/');\n    if (subPaths.length < 3) {\n      throw Error(`根据path删除实体数据出错了。传入的path[${fpath}]格式不对`);\n    }\n\n    let childEntityList: EntityList<any>;\n    let propInfo: { propType: string, propEntityType: any };\n    let propName: string;\n    for (let i = 2; i < subPaths.length; i = i + 2) {\n      const fid = subPaths[i - 1];\n      propName = subPaths[i];\n\n      // todo: EntityCollection重构之后这里无需差异处理\n      const parentEntity = childEntityList ? childEntityList.get(fid) : this.entityCollection.getEntityById(fid);\n      childEntityList = parentEntity[propName];\n      const entityType = propInfo ? propInfo.propEntityType : this.entityType;\n      propInfo = EntityUtil.getPropInfo(entityType, propName);\n      if (!childEntityList) {\n        throw Error(`fpath参数错误，无法找到${propName}对应的子表。fpath为：${fpath}`);\n      }\n    }\n\n    // const propInfo = EntityUtil.getPropInfo(this.entityType, propName);\n    const childEntity = createEntity<Entity>(propInfo.propEntityType, entityData);\n    // 在实体的实例上增加默认值属性，以便在createBindingObject时存放默认值\n    if (initialData) {\n      EntityUtil.appendInitialData(childEntity, initialData);\n    }\n    childEntityList.appendNew(childEntity, isCloned);\n    return childEntity;\n  }\n  /**\n   * 在指定位置插入实体\n   * @param fpath 父路径\n   * @param entityData 实体数据\n   * @param initialData 初始数据\n   * @param position 插入位置\n   */\n  public insertEntityByPath(fpath: string, entityData: any, initialData?: any, position?: 1 | -1) {\n    const subPaths = fpath.split('/');\n    if (subPaths.length < 3) {\n      throw Error(`根据path删除实体数据出错了。传入的path[${fpath}]格式不对`);\n    }\n\n    let childEntityList: EntityList<any>;\n    let propInfo: { propType: string, propEntityType: any };\n    let propName: string;\n    for (let i = 2; i < subPaths.length; i = i + 2) {\n      const fid = subPaths[i - 1];\n      propName = subPaths[i];\n\n      // todo: EntityCollection重构之后这里无需差异处理\n      const parentEntity = childEntityList ? childEntityList.get(fid) : this.entityCollection.getEntityById(fid);\n      childEntityList = parentEntity[propName];\n      const entityType = propInfo ? propInfo.propEntityType : this.entityType;\n      propInfo = EntityUtil.getPropInfo(entityType, propName);\n      if (!childEntityList) {\n        throw Error(`fpath参数错误，无法找到${propName}对应的子表。fpath为：${fpath}`);\n      }\n    }\n\n    // const propInfo = EntityUtil.getPropInfo(this.entityType, propName);\n    const childEntity = createEntity<Entity>(propInfo.propEntityType, entityData);\n    // 在实体的实例上增加默认值属性，以便在createBindingObject时存放默认值\n    if (initialData) {\n      EntityUtil.appendInitialData(childEntity, initialData);\n    }\n    childEntityList.insert(childEntity, position);\n    return childEntity;\n  }\n  /**\n   * 在path对应的实体集合中追加多个实体\n   */\n  public appendEntitiesByPath(fpath: string[], entities: Entity[]) {\n    const entityCollectionOrList = this.getEntityNodeByPath(fpath);\n    if (entityCollectionOrList instanceof EntityCollection === true) {\n      const entityCollection = entityCollectionOrList as EntityCollection<Entity>;\n      entityCollection.addEntities(entities);\n    } else {\n      const entityList = (entityCollectionOrList as EntityList<Entity>);\n      entityList.appendEntities(entities);\n    }\n  }\n\n  // #endregion\n\n\n  // #region 删除实体\n\n  /**\n   * 从fapth对应的实体集合中删除id对应的实体\n   */\n  // public removeEntityByPath(fpath: string[], id: string): void {\n  //   const entityCollectionOrList = this.getEntityNodeByPath(fpath);\n  //   if (entityCollectionOrList instanceof EntityCollection === true) {\n  //     const entityCollection = entityCollectionOrList as EntityCollection<Entity>;\n  //     entityCollection.removeEntityById(id);\n  //   } else {\n  //     const entityList = (entityCollectionOrList as EntityList<Entity>);\n  //     entityList.remove(id);\n  //   }\n  // }\n\n  /**\n   * 根据path获取实体集合\n   * @param fpath path\n   */\n  public removeEntityByPath(fpath: string, id: string) {\n    const subPaths = fpath.split('/');\n    if (subPaths.length < 3) {\n      throw Error(`根据path删除实体数据出错了。传入的path[${fpath}]格式不对`);\n    }\n    let childEntityList: EntityList<any>;\n    for (let i = 2; i < subPaths.length; i = i + 2) {\n      const fid = subPaths[i - 1];\n      const propName = subPaths[i];\n      const parentEntity = childEntityList ? childEntityList.get(fid) : this.entityCollection.getEntityById(fid);\n      childEntityList = parentEntity[propName];\n      if (!childEntityList) {\n        throw Error(`fpath参数错误，无法找到${propName}对应的子表。fpath为：${fpath}`);\n      }\n    }\n\n    childEntityList.remove(id);\n  }\n\n  /**\n   * 从fapth对应的实体集合中删除ids对应的实体\n   */\n  public removeEntitiesByPath(fpath: string[], ids: string[]): void {\n    // const entityCollectionOrList = this.getEntityNodeByPath(fpath);\n    // if (entityCollectionOrList instanceof EntityCollection === true) {\n    //   const entityCollection = entityCollectionOrList as EntityCollection<Entity>;\n    //   entityCollection.removeEntitiesByIds(ids);\n    // } else {\n    //   const entityList = (entityCollectionOrList as EntityList<Entity>);\n    //   entityList.remove(ids);\n    // }\n    throw new Error('Not Implemented');\n  }\n  // #endregion\n\n\n  // #region 清空变更集相关方法\n\n  /**\n   * 清空所有实体的变更集\n   */\n  public clearAllEntityChanges() {\n    const entities = this.entityCollection.toArray();\n    entities.forEach((entity: Entity) => {\n      entity.changes.splice(0, entity.changes.length);\n    });\n  }\n\n  public resetAllEntityChangeMark() {\n    const entities = this.entityCollection.toArray();\n    entities.forEach((entity: Entity) => {\n      entity.hasChange = false;\n    });\n  }\n\n  /**\n   * 清空id指定的实体变更集\n   */\n  public clearEntityChangesById(id: string): void {\n    const entity = this.entityCollection.getEntityById(id);\n    if (!entity) {\n      return;\n    }\n    entity.changes.splice(0, entity.changes.length);\n  }\n\n  /**\n   * 清空ids数组中指定的实体的变更集\n   */\n  public clearEntityChangesByIds(ids: string[]): void {\n    if (!ids || ids.length < 0) {\n      return;\n    }\n\n    ids.forEach((id: string) => {\n      this.clearEntityChangesById(id);\n    });\n  }\n\n  // #endregion\n\n\n  // #region 变更集检查相关方法\n\n  /**\n   * 检查所有的实体，是否有未提交的变更\n   */\n  public checkAllEntityChanges(): boolean {\n\n    const entities = this.entityCollection.toArray();\n    const hasChanges = entities.some((entity: Entity) => {\n      if (entity.changes.length > 0) {\n        return true;\n      } else {\n        return false;\n      }\n    });\n    return hasChanges;\n  }\n\n  /**\n   * 检查id对应的实体，是否有未提交的变更\n   */\n  public checkEntityChangesById(id: string): boolean {\n    const entity = this.entityCollection.getEntityById(id);\n    if (!entity) {\n      return false;\n    }\n    return entity.changes.length > 0;\n  }\n\n  // #endregion\n\n\n  // #region 不规范方法，待废弃\n\n  /**\n   * 待废弃\n   * @deprecated\n   */\n  public clearEntityChangesByArray(idArray: string[]): void {\n    this.clearEntityChangesByIds(idArray);\n  }\n\n  // #endregion\n\n}\n\nexport { EntityManager };\n","import { Type  } from '../core/index';\nimport { Entity, FieldMetadataUtil } from '../entity/index';\n// tslint:disable: no-bitwise\n\nexport class PaginationManager<T extends Entity> {\n\n    constructor(private entityType: Type<T>, private paginationConfig: any) {\n        if (this.paginationConfig === null || this.paginationConfig === undefined) {\n            this.paginationConfig = this.getNgListProperties();\n        }\n        // 兼容老表单，将之前的主表分页信息展开到分页配置根中\n        this.expandMainEntityConfig();\n        this.deleteMainEntityConfig();\n    }\n    /**\n     * 主表分页信息展开到分页配置根中\n     */\n    private expandMainEntityConfig() {\n        const entityName = this.entityType.name;\n        if (this.paginationConfig.hasOwnProperty(entityName)) {\n            const entityConfig = this.paginationConfig[entityName];\n            this.paginationConfig = Object.assign(this.paginationConfig, entityConfig);\n        }\n    }\n    /**\n     * 删除主表实体配置信息\n     */\n    private deleteMainEntityConfig() {\n        delete this.paginationConfig[this.entityType.name];\n    }\n    /**\n     * 获取分页信息\n     */\n    public get pagination() {\n        return this.paginationConfig;\n    }\n    /**\n     * 获取分页信息\n     * @param path 路径\n     * @param defaultValue 默认值\n     */\n    public getPaginationConfigByPath(path: string, defaultValue?: any) {\n        if (!path || path === '/') {\n            return this.paginationConfig;\n        }\n        if (typeof path !== 'string') {\n            throw new Error('路径必须为字符串！');\n        }\n        path = path.substring(1);\n        const paths = path.split('/').filter(item => !!item && item.trim().length > 0);\n        let config = this.paginationConfig;\n        paths.forEach(item => {\n            if (config && config.hasOwnProperty(item)) {\n                config = config[item];\n            } else {\n                config = null;\n            }\n        });\n        return !!config ? config : typeof defaultValue !== 'undefined' ? defaultValue : undefined;\n    }\n    /**\n     * 设置分页信息\n     * @param path 路径\n     * @param value 值\n     */\n    public setPaginationConfigByPath(path: string | Array<any>, value: any) {\n        if (!Array.isArray(path)) {\n            path = path.toString().match(/[^/[\\]]+/g) || [];\n        }\n        path.slice(0, -1).reduce((prev, current, index) =>\n            Object(prev[current]) === prev[current]\n                ? prev[current]\n                : prev[current] = Math.abs(path[index + 1]) >> 0 === +path[index + 1]\n                    ? []\n                    : {},\n            this.paginationConfig)[path[path.length - 1]] = value;\n        return this.paginationConfig;\n    }\n\n    /**\n     * 递归获取当前实体的所有NgList属性\n     * @param defaultPageSize defaultPageSize\n     */\n    private getNgListProperties(defaultPageSize: number = 0) {\n\n        const getChilds = (objectType: Type<Entity>) => {\n            const listProperties = FieldMetadataUtil.getNgList(objectType);\n            let result = {};\n            if (Object.keys(listProperties).length < 1) {\n                return result;\n            }\n\n            Object.keys(listProperties).forEach(prop => {\n                let itemTypeName = listProperties[prop].dataField;\n                // 去掉尾部的s\n                if (itemTypeName.endsWith('s')) {\n                    itemTypeName = itemTypeName.substring(0, itemTypeName.length - 1);\n                }\n                result[itemTypeName] = {\n                    pageSize: defaultPageSize\n                };\n                const child = getChilds(listProperties[prop].type);\n                if (child !== null && Object.keys(child).length > 0) {\n                    result = Object.assign({}, result, child);\n                }\n            });\n            return result;\n        };\n        const childs = getChilds(this.entityType);\n        const root = Object.assign({}, { pageSize: defaultPageSize }, childs);\n        return root;\n    }\n\n}\n","import { DataChange, DataChangeType } from '../core';\n\nclass DataChangeHistory {\n    private history: Array<DataChange>;\n    private cacheData: Array<DataChange>;\n\n    constructor() {\n        this.history = [];\n        this.cacheData = [];\n    }\n    public addChange(dataChange: DataChange) {\n        const changeType = DataChangeType[dataChange.changeType];\n        this[`on${changeType}Data`](dataChange);\n    }\n    public addChanges(dataChange: DataChange[]) {\n        dataChange.forEach(change => this.addChange(change));\n    }\n    public clear() {\n        this.history.splice(0, this.history.length);\n    }\n    public clearByIds(ids: string[]) {\n        this.history = this.history.filter(item => {\n            if (item.fpath && item.fpath !== '/' && item.fpath.includes('/')) {\n                for (const id of ids) {\n                    const include = item.fpath.split('/').includes(id);\n                    return !include;\n                }\n            } else {\n                return !ids.includes(item.dataId);\n            }\n        });\n    }\n    public isChanged() {\n        return this.history.length > 0;\n    }\n    public clearCache() {\n        this.cacheData.splice(0, this.cacheData.length);\n    }\n    public getCacheData() {\n        return this.cacheData;\n    }\n    private onAddData(dataChange: DataChange) {\n        this.history.push(dataChange);\n    }\n    private onEditData(dataChange: DataChange) {\n        this.cacheData.push(dataChange);\n    }\n    private onAppendData(dataChange: DataChange) {\n        this.history.push(dataChange);\n        this.cacheData.push(dataChange);\n    }\n    private onDeleteData(dataChange: DataChange) {\n        const index = this.history.findIndex(item => item.dataId === dataChange.dataId && item.changeType === DataChangeType.Add);\n        if (index >= 0) {\n            this.history.splice(index, 1);\n        } else {\n            this.history.push(dataChange);\n        }\n    }\n}\nexport { DataChangeHistory };\n","/*\n * @Author: Witt\n * @Date: 2018-10-12 15:37:11\n * @Last Modified by: aalizzwell\n * @Last Modified time: 2019-09-03 19:10:44\n * @todo 待优化问题\n * 1、apiUrl是否应该在基类中，子类中的api如何传递给基类；\n */\n\nimport { Type } from '../core/index';\nimport { Observable, Subject } from 'rxjs';\n\nimport { DataTypeInfo } from '../entity/index';\nimport { Guid } from '../utils/index';\nimport { Modification } from '../changeset/index';\nimport { MetadataUtil } from '../core/index';\nimport { Entity, createEntity, createEntities, FieldMetadataUtil } from '../entity/index';\nimport { RepositoryMeta } from './decorators';\nimport { EntityCollection } from './entity_collection';\nimport { PaginationManager } from './pagination_manager';\nimport { DataChangeHistory } from './data_change_history';\n\nexport abstract class Repository<T extends Entity> {\n\n  /**\n   * 名称\n   */\n  abstract name: string;\n\n  /**\n   * 实体类型\n   */\n  public entityType: Type<T>;\n\n  /**\n   * 实体类型信息\n   */\n  public entityTypeInfo: DataTypeInfo;\n\n  /**\n   * 实体集合\n   */\n  public entityCollection: EntityCollection<T>;\n\n  /**\n   * 用户分页配置信息\n   */\n  public paginationInfo: any = null;\n\n  /**\n   * 数据变更历史\n   * @summary\n   * 仅针对主表增加、从表删除\n   */\n  public dataChangeHistory: DataChangeHistory;\n\n\n  /**\n   * 分页管理器\n   */\n  public paginationManager: PaginationManager<T>;\n\n  /**\n   * 构造函数\n   */\n  constructor() {\n  }\n\n  protected init() {\n    this.entityTypeInfo = new DataTypeInfo(this.entityType);\n    this.entityCollection = new EntityCollection<T>(this.entityType);\n    this.entityCollection.entityTypeInfo = this.entityTypeInfo;\n    this.dataChangeHistory = new DataChangeHistory();\n  }\n\n  public get changes(): Subject<Modification> {\n    return this.entityCollection.changes;\n  }\n\n  /**\n   * 实体主键\n   */\n  public get primaryKey(): string {\n    return this.entityCollection.primaryKey;\n  }\n\n  /**\n   * 实体变更集合\n   */\n  public get entityCollectionChange(): Subject<Modification> {\n    return this.entityCollection.collectionChanged;\n  }\n\n  /**\n   * 重置状态\n   */\n  public reset(): void {\n    this.entityCollection.clear();\n  }\n\n  /**\n   * 创建实体\n   */\n  public buildEntity(data: any): T {\n    const entity = createEntity<T>(this.entityType, data);\n    return entity;\n  }\n\n  /**\n   * 批量创建实体\n   */\n  public buildEntities(listData: any[]): T[] {\n    const entities: T[] = createEntities<T>(this.entityType, listData);\n    return entities;\n  }\n\n  /**\n   * 初始化分页配置\n   * @param config 用户分页配置\n   */\n  setPaginationConfig(config: any) {\n    this.paginationManager = new PaginationManager(this.entityType, config);\n    const { pageSize = 0 } = this.paginationManager.getPaginationConfigByPath('/') || {};\n    // tslint:disable-next-line: max-line-length\n    this.entityCollection.paginationInfo = Object.assign({ pageSize }, this.entityCollection.paginationInfo, this.paginationManager.pagination);\n\n    // 无需再单独设置一次pageSize，减少一次变更\n    // this.entityCollection.pageSize = pageSize;\n  }\n\n  /**\n   * 设置分页\n   */\n  public setPaginationInfo(paginationInfo: any) {\n    this.paginationInfo = { ...this.paginationInfo, ...paginationInfo };\n  }\n  \n}\n","import { Entity } from '../entity/index';\nimport { Repository } from './repository';\nimport { EntityManager } from './entity_manager';\n\n/**\n * 空Repository实现\n */\nabstract class DefaultRepository<T extends Entity> extends Repository<T> {\n\n  /**\n   * 名称\n   */\n  abstract name: string;\n\n  /**\n   * 实体管理器\n   */\n  public entityManager: EntityManager<T>;\n\n  constructor() {\n    super();\n  }\n\n  init() {\n    super.init();\n    this.entityManager = new EntityManager(this.entityCollection);\n  }\n}\n\nexport { DefaultRepository };\n","import { Observable, of } from 'rxjs';\nimport { CommandContext } from '../command_context';\nimport { isObservable } from '../../utils/index';\n\n/**\n * 任务函数\n */\ntype TaskFunc = (context: CommandContext) => any;\n\n\n/**\n * 任务节点\n */\nclass TaskNode {\n\n  /**\n   * 任务名称\n   */\n  name: string;\n\n  /**\n   * 任务函数\n   */\n  func: TaskFunc;\n\n  /**\n   * 构造函数\n   */\n  constructor(name: string, func: TaskFunc) {\n    this.name = name;\n    this.func = func;\n  }\n\n  /**\n   * 执行任务函数\n   */\n  execute(context: CommandContext): Observable<any> {\n    const result = this.func(context);\n    const result$ = isObservable(result) ? result : of(result);\n    return result$;\n  }\n}\n\nexport { TaskFunc, TaskNode };\n","enum BindingType {\n\n  /**\n   * 实体状态\n   */\n  EntityState = 'EntityState',\n\n  /**\n   * UI状态\n   */\n  UIState     = 'UIState'\n}\n\nexport { BindingType };\n","/**\n * session变量解析\n * @author Witt <jiwt@inspur.com>\n */\nimport { createInjectionToken } from '../core/index';\n\n/**\n * 变量解析接口\n */\ninterface VariableParser {\n  parse(expression: string, context: any): any;\n}\n\nconst VARIABLE_PARSERS = createInjectionToken('@farris/devkit VARIABLE_PARSERS');\n\nexport { VariableParser, VARIABLE_PARSERS };\n","import { StaticProvider } from '../core/index';\n\nclass AppOptions {\n\n  /**\n   * 应用id\n   */\n  id: string;\n\n  /**\n   * 应用providers\n   */\n  providers: StaticProvider[];\n\n}\n\nexport { AppOptions };\n","/*\n * @Author: Witt\n * @Date: 2018-12-29 10:46:01\n * @Last Modified by: Witt\n * @Last Modified time: 2018-12-30 17:56:02\n */\n\nimport { BindingData } from '../binding-data';\n\n/**\n * BindingData管理类\n */\nclass BindingDataManager {\n\n  /**\n   * BindingDataMap\n   */\n  private bindingDataMap: Map<string, BindingData>;\n\n  /**\n   * 构造函数\n   */\n  constructor() {\n    this.bindingDataMap = new Map<string, BindingData>();\n  }\n\n  /**\n   * 获取BindingDataMap\n   */\n  public getBindingDataMap(): Map<string, BindingData> {\n    return this.bindingDataMap;\n  }\n\n  /**\n   * 根据name获取BindingData\n   * @return 找不到时返回undefined\n   */\n  public getBindingDataByName(name: string): BindingData {\n    return this.bindingDataMap.get(name);\n  }\n\n  /**\n   * 初始化全局的BindingData\n   */\n  public regBindingData(name: string, bindingData: BindingData): void {\n    this.bindingDataMap.set(name, bindingData);\n  }\n\n  /**\n   * 是否Repository已经存在\n   */\n  public ifBindingDataExits(name: string) {\n    const bindingData = this.getBindingDataByName(name);\n    return bindingData ? true : false;\n  }\n\n}\n\nexport { BindingDataManager };\n","/*\n * @Author: Witt\n * @Date: 2018-12-29 10:46:01\n * @Last Modified by: Witt\n * @Last Modified time: 2018-12-30 18:06:11\n */\n\nimport { Repository } from '../repository/index';\nimport { Entity } from '../entity/index';\n\n/**\n * Repository管理类\n */\nclass RepositoryManager {\n\n  /**\n   * repositoryMap\n   */\n  private repositoryMap: Map<string, Repository<Entity>>;\n\n\n  /**\n   * 构造函数\n   */\n  constructor() {\n    this.repositoryMap = new Map<string, Repository<Entity>>();\n  }\n\n  /**\n   * 注册Repository\n   */\n  public regRepository(name: string, repository: Repository<Entity>): void {\n    this.repositoryMap.set(name, repository);\n  }\n\n  /**\n   * 获取RepositoryMap\n   * @internal\n   */\n  public getRepositoryMap(): Map<string, Repository<Entity>> {\n    return this.repositoryMap;\n  }\n\n  /**\n   * 获取Repository数组\n   */\n  public getRepositories(): Repository<Entity>[] {\n    return Array.from(this.repositoryMap.values());\n  }\n\n  /**\n   * 根据name获取Repository\n   */\n  public getRepositoryByName(name: string): Repository<Entity> {\n    return this.repositoryMap.get(name);\n  }\n\n  /**\n   * 是否Repository已经存在\n   */\n  public ifRepositoryExits(name: string) {\n    const repository = this.getRepositoryByName(name);\n    return repository ? true : false;\n  }\n\n}\n\nexport { RepositoryManager };\n","import { ViewModelContext } from '../view-model/index';\n\n/**\n * ViewModelContext管理类\n */\nclass ViewModelContextManager {\n\n  /**\n   * Context字典\n   */\n  private contextMap: Map<string, ViewModelContext>;\n\n  /**\n   * Context集合\n   */\n  private contextSet: Set<ViewModelContext>;\n\n\n  /**\n   * 构造函数\n   */\n  constructor() {\n    this.contextMap = new Map<string, ViewModelContext>();\n    this.contextSet = new Set<ViewModelContext>();\n  }\n\n  /**\n   * 注册Context\n   */\n  public regContext(viewModelContext: ViewModelContext): void {\n    const id = viewModelContext.id;\n    if (this.contextMap.has(id) === true) {\n      // throw Error(`id为${id}的ViewModelContext已经存在`);\n      // 临时处理，方式报错。\n      this.unregContext(viewModelContext);\n    }\n\n    this.contextMap.set(id, viewModelContext);\n    this.contextSet.add(viewModelContext);\n  }\n\n  /**\n   * 取消注册\n   */\n  public unregContext(context: ViewModelContext): void {\n    const id = context.id;\n    this.contextMap.delete(id);\n    this.contextSet.delete(context);\n  }\n\n  /**\n   * 获取ContextMap\n   */\n  public getContextMap() {\n    return this.contextMap;\n  }\n\n  /**\n   * 获取全部Context\n   */\n  public getContexts(): ViewModelContext[] {\n    return Array.from(this.contextSet);\n  }\n\n  /**\n   * 根据命名控件获取上下文集合\n   */\n  public getContextsByNamespace(namespace: string) {\n    return this.getContexts();\n  }\n\n  /**\n   * 根据id获取Context\n   */\n  public getContextById(id: string): ViewModelContext {\n    const targetContext = this.contextMap.get(id);\n    return targetContext;\n  }\n\n  /**\n   * 获取根Context\n   */\n  public getRootContext(): ViewModelContext {\n    const contexts = this.getContexts();\n    const rootContext = contexts.find((context: ViewModelContext) => {\n      return context.parent === null;\n    });\n    return rootContext;\n  }\n\n  /**\n   * 获取传入视图模型id的root及root的下一代集合数组\n   */\n  public getRootContextAndPosterityById(viewModelId): ViewModelContext[] {\n    const targetContext = this.getContextById(viewModelId);\n    const contexts = this.getContexts();\n    let contextsGroup = [];\n    // 1.找到ROOT\n    const RootId = this.getContextsGroupRoot(targetContext);\n    // 2.可直接遍历拿到所有直系后代 (目前只有两层结构直接获取下一代)\n    contexts.map((context: ViewModelContext) => {\n      if (context.parent && context.parent.id === RootId) {\n        contextsGroup.push(context);\n      }\n    });\n    contextsGroup.push(this.getContextById(RootId));\n    return contextsGroup;\n  }\n\n  private getContextsGroupRoot(context: ViewModelContext) {\n    if (context.parent) {\n      return this.getContextsGroupRoot(context.parent);\n    } else {\n      return context.id\n    }\n  }\n}\n\nexport { ViewModelContextManager };\n","class Context {\n\n  /**\n   * 上下文变量\n   */\n  params: Map<string, any> = new Map<string, any>();\n\n  /**\n   * 获取变量\n   */\n  getParam(key: string): any {\n    return this.params.get(key);\n  }\n\n  /**\n   * 设置变量\n   */\n  setParam(key: string, value: any) {\n    this.params.set(key, value);\n  }\n}\n\nexport { Context };\n","import { InjectionToken } from '../core/index';\n\n/**\n * 表单模块路径\n */\nexport const VALIDATION_RULE_TOKEN = new InjectionToken('@Farris validation rule');\n","/**\n * 应用上下文\n * @author Witt<jiwt@inspur.com>\n * @todo\n * 1、parnet和AppContextManager是否必要？按理说就是应该隔离上下文，表单之间通过事件通讯进行交互；\n */\nimport { Injector } from '../core/index';\nimport { ViewModelContext } from '../view-model/index';\nimport { Context } from '../context/index';\nimport { BindingDataFactory } from '../binding-data';\nimport { ViewModelContextManager } from './view_model_contex_manager';\nimport { RepositoryManager } from './repository_mananger';\nimport { BindingDataManager } from './binding_data_manager';\nimport { AppEventBus } from './app_eventBus';\nimport { VALIDATION_RULE_TOKEN } from './tokens'\nclass AppContext extends Context {\n\n  /**\n   * 构造函数\n   */\n  constructor(\n    public injector: Injector,\n    public eventBus: AppEventBus,\n    public repositoryManager: RepositoryManager,\n    public bindingDataManager: BindingDataManager,\n    public viewModelContextManager: ViewModelContextManager,\n    public validationManager = {},\n    public validationRule\n  ) {\n    super();\n    this.validationRule = injector.get(VALIDATION_RULE_TOKEN, []);\n  }\n\n  /**\n   * 注册FrameContext\n   */\n  public regViewModelContext(viewModelContext: ViewModelContext): void {\n\n    const repository = viewModelContext.repository;\n    const repositoryName = repository.name;\n\n    // Repository\n    if (this.repositoryManager.ifRepositoryExits(repositoryName) === false) {\n      this.repositoryManager.regRepository(repositoryName, repository);\n    }\n\n    // BindingData\n    if (this.bindingDataManager.ifBindingDataExits(repositoryName) === false) {\n      const bindingData = BindingDataFactory.createFromRepository(repository, '/');\n      this.bindingDataManager.regBindingData(repositoryName, bindingData);\n    }\n\n    // 考虑路由再次进入的时候，AppContext没有被注销，但Component被再次构造的场景\n    this.viewModelContextManager.regContext(viewModelContext);\n  }\n\n}\n\nexport { AppContext };\n","import { Injector, InjectFlags } from '../core/index';\nimport { Context } from '../context/index';\nimport { AppContext } from '../app/index';\nimport { Entity } from '../entity/index';\nimport { Repository } from '../repository/index';\nimport { BindingData } from '../binding-data/index';\nimport { UIState } from '../ui-state/index';\nimport { StateMachine } from '../state-machine/index';\nimport { Form } from '../form/index';\nimport { ViewModel } from '../view-model/index';\nimport { CommandBus } from '../command/index';\nimport {\n  ExpressionEngineImpl, ExpressionManager, ExpressionResult, ExpressionResultFactory\n} from '../expression/index';\nimport { ControlsProxy } from '../control-proxy';\n\n/**\n * 视图模型上下文\n */\nclass ViewModelContext {\n\n  private innerViewModel: ViewModel;\n\n  public appContext: AppContext;\n\n  public root: ViewModelContext;\n\n  public parent: ViewModelContext;\n\n  public id: string;\n\n  constructor() {\n  }\n\n  public init(viewModel): void {\n    this.innerViewModel = viewModel;\n    this.id = this.innerViewModel.id;\n    this.appContext = viewModel.injector.get(AppContext);\n    this.regToTree();\n    this.regToAppContext();\n  }\n\n  public regToTree() {\n    const parentInjector = this.innerViewModel.injector.get<Injector>(Injector, null, InjectFlags.SkipSelf);\n    if (parentInjector)  {\n      this.parent = parentInjector.get(ViewModelContext, null);\n      this.root = this.parent ? this.parent.root : this;\n    } else {\n      this.parent = null;\n      this.root = this;\n    }\n  }\n\n  public regToAppContext() {\n    this.appContext.regViewModelContext(this);\n  }\n\n  public get viewModel(): ViewModel {\n    return this.innerViewModel;\n  }\n\n  public get injector(): Injector {\n    return this.innerViewModel.injector;\n  }\n\n  public get repository(): Repository<Entity> {\n    return this.innerViewModel.repository;\n  }\n\n  public get bindingData(): BindingData {\n    return this.innerViewModel.bindingData;\n  }\n\n  public get uiState(): UIState {\n    return this.innerViewModel.uiState;\n  }\n\n  public get stateMachine(): StateMachine {\n    return this.innerViewModel.stateMachine;\n  }\n\n  public get form(): Form {\n    return this.innerViewModel.form;\n  }\n\n  public get commandBus(): CommandBus {\n    return this.innerViewModel.commandBus;\n  }\n\n  public get expressionEngineImpl(): ExpressionEngineImpl {\n    return this.innerViewModel.expressionEngineImpl;\n  }\n\n  public get expressionManager(): ExpressionManager {\n    return this.innerViewModel.expressionManager;\n  };\n\n  public get expressionResult(): ExpressionResult {\n    return this.innerViewModel.expressionResult;\n  };\n\n  public get controlsProxy(): ControlsProxy {\n    return this.innerViewModel.controlsProxy;\n  };\n\n  public getVirtualRootFrameContext() {\n    let formFrameContext = this;\n    // let parent = this.parent;\n    // while (parent) {\n    //   // 兼容没有重新编译的表单，如果判断parent.namespace存在会导致获取不到root-framecontext\n    //   if (parent.namespace === this.namespace) {\n    //     formFrameContext = parent;\n    //     parent = parent.parent;\n    //   } else {\n    //     break;\n    //   }\n    // }\n    return formFrameContext;\n  }\n\n  /**\n   * 注册扩展命令\n   */\n  public registerExtendCommand(commandName: string, commandHandler: any) {\n    this.viewModel.registerExtendCommand(commandName, commandHandler);\n  }\n\n}\n\nexport { ViewModelContext };\n","import { makePropDecorator } from '../core/index';\n\n/**\n * UIState属性元数据接口\n */\nexport interface ControlStatePropMetadata{\n\n  /**\n   * 组件的信息\n   */\n  controlInfo?: ControlInfo;\n\n  /**\n   * 状态名称\n   */\n  stateName?: string;\n\n  /**\n   * 原始值\n   */\n  originalValue?: any;\n\n}\n\nclass ControlInfo  {\n  //内码\n  id: string;\n\n  //类型\n  type?: string;\n\n  //是否在尾部\n  isInFooter?:boolean;\n\n  //绑定字段路径\n  bindingPath?: string;\n\n  //特性,position\n  features?:any;\n\n}\n\n/**\n * UIState属性元数据名称\n */\nexport const CONTROLSTATE_PROP_META = 'ControlStatePropMeta';\n\n/**\n * UIState属性元数据装饰器工厂接口\n */\nexport interface ControlStatePropMetaDecorator {\n  (obj?: ControlStatePropMetadata): any;\n  new(obj?: ControlStatePropMetadata): any;\n}\n\n/**\n * UIState属性元数据装饰器工厂\n */\nexport const ControlStatePropMeta: ControlStatePropMetaDecorator =\n  makePropDecorator(CONTROLSTATE_PROP_META, (obj?: ControlStatePropMetadata) => obj);\n\n\n","import { makePropDecorator } from '../core/index';\n\n/**\n * UIState属性元数据接口\n */\nexport interface UIStatePropMetadata {\n\n  /**\n   * 组件的ID\n   */\n  componentId?: string;\n\n  /**\n   * 状态名称\n   */\n  stateName?: string;\n  \n}\n\n/**\n * UIState属性元数据名称\n */\nexport const UISTATE_PROP_META = 'UIStatePropMeta';\n\n/**\n * UIState属性元数据装饰器工厂接口\n */\nexport interface UIStatePropMetaDecorator {\n  (obj?: UIStatePropMetadata): any;\n  new(obj?: UIStatePropMetadata): any;\n}\n\n/**\n * UIState属性元数据装饰器工厂\n */\nexport const UIStatePropMeta: UIStatePropMetaDecorator =\n  makePropDecorator(UISTATE_PROP_META, (obj?: UIStatePropMetadata) => obj);\n\n\n","import { MetadataUtil } from '../core/index';\nimport { CONTROLSTATE_PROP_META, ControlStatePropMetadata } from './control_decorators';\nimport { UISTATE_PROP_META, UIStatePropMetadata } from './decorators';\n\nexport class UIStateMetadataUtil {\n\n  /**\n   * 获取NgUIState的属性元数据\n   * @param \n   * @returns 属性元数据对象\n   * @example\n   * 返回格式：\n   * {\n   *    '属性名称': <NgUIStateProperty>{ ...}\n   * }\n   */\n  static getUIFields(target: Function): {[propName: string]: UIStatePropMetadata} {\n      return MetadataUtil.getPropsMetadatasByName(target, UISTATE_PROP_META);\n  }\n\n  static getControlFields(target: Function): {[propName: string]: ControlStatePropMetadata} {\n    return MetadataUtil.getPropsMetadatasByName(target, CONTROLSTATE_PROP_META);\n}\n}","import { Observable } from \"rxjs\";\r\nimport { createInjectionToken } from \"../../core\";\r\nimport { ViewModelContext } from \"../../view-model\";\r\nimport { ControlStatePropMetadata } from \"../control_decorators\";\r\n\r\ninterface ControlStateInterceptor{\r\n    /**\r\n     * 初始化\r\n     */\r\n    init(initContext:InitContext):Observable<any>;\r\n    \r\n    /**\r\n     * 控件状态拦截\r\n     * @param interceptContext\r\n     */\r\n    intercept(interceptContext:InterceptContext):void;\r\n}\r\n\r\n/**\r\n * 命令处理器扩展注入Token\r\n */\r\nconst CONTROL_STATE_INTERCEPTOR_TOKEN = createInjectionToken('@farris/devkit CONTROL_STATE_INTERCEPTOR_TOKEN');\r\n\r\nclass InitContext  {\r\n    //流程上下文\r\n    processContext:ProcessContext\r\n}\r\n\r\n\r\nclass InterceptContext {\r\n    //类型\r\n    type: string;\r\n\r\n    //属性值\r\n    value:any;\r\n\r\n    //控件变量的信息\r\n    controlState:ControlStatePropMetadata\r\n\r\n    //视图模型\r\n    viewModelContext:ViewModelContext;\r\n\r\n    //流程上下文\r\n    processContext:ProcessContext;\r\n}\r\n\r\nclass ProcessContext  {\r\n    //是否在流程中\r\n    isInWf:boolean;\r\n\r\n    //流程页面状态\r\n    uiStateInProcess:string\r\n\r\n    //表单配置\r\n    formConfigId:string\r\n}\r\n\r\nexport {ControlStateInterceptor,InitContext,InterceptContext,ProcessContext,CONTROL_STATE_INTERCEPTOR_TOKEN}","import { shareReplay } from \"rxjs/operators\";\r\nimport { InjectFlags, Injector } from \"../../core\";\r\nimport { CONTROL_STATE_INTERCEPTOR_TOKEN, InterceptContext, ControlStateInterceptor, InitContext, ProcessContext } from \"./control_state_interceptor\";\r\nimport { Observable, forkJoin, isObservable, of } from \"rxjs\";\r\nimport { EnvUtil, UrlUtil} from \"../../utils\";\r\n\r\n/**\r\n * 状态拦截器服务\r\n */\r\nexport class ControlStateInterceptorService{\r\n\r\n    //控件状态拦截器\r\n    private controlInterceptors: ControlStateInterceptor[] = [];\r\n    private result:Observable<any>;\r\n\r\n    private processContext: ProcessContext;\r\n\r\n    constructor(private injector: Injector){\r\n        this.controlInterceptors = this.injector.get(CONTROL_STATE_INTERCEPTOR_TOKEN, null, InjectFlags.Optional);\r\n    }\r\n\r\n    public init():Observable<any>{\r\n        if(this.result){\r\n            return this.result;\r\n        }\r\n\r\n        const inits = [];\r\n        const initContext = new InitContext();\r\n        const processContext = this.getProcessContext();\r\n        initContext.processContext = this.processContext = processContext;\r\n\r\n        for(const controlInterceptor of this.controlInterceptors){\r\n            if(controlInterceptor.init && typeof controlInterceptor.init === 'function'){\r\n                const initFunc = controlInterceptor.init(initContext);\r\n                const $result = isObservable(initFunc) ? initFunc : of(initFunc);\r\n                inits.push($result);\r\n            }\r\n        }\r\n\r\n        return this.result = forkJoin(inits).pipe(shareReplay(1));\r\n    }\r\n\r\n    public intercept(interceptContext:InterceptContext) {\r\n        interceptContext.processContext  = this.processContext;\r\n        for(const controlInterceptor of this.controlInterceptors){\r\n            controlInterceptor.intercept(interceptContext);\r\n        }\r\n    }\r\n\r\n    private getProcessContext():ProcessContext{\r\n        const processContext = new  ProcessContext();\r\n        const isInWf = EnvUtil.isInWf();\r\n        processContext.isInWf = isInWf;\r\n        if (isInWf === false) {\r\n            return processContext\r\n        }\r\n\r\n        const iframe = window.parent.document.querySelector('iframe');\r\n        if (!iframe || !iframe.src) {\r\n            return processContext\r\n        }\r\n\r\n        const queryParams = UrlUtil.getParams(iframe.src);\r\n        if (!queryParams) {\r\n            return processContext\r\n        }\r\n\r\n        processContext.uiStateInProcess = queryParams.UIStateInProcess;\r\n        processContext.formConfigId = queryParams.formConfigId;\r\n\r\n        return processContext\r\n    }\r\n    \r\n\r\n}\r\n\r\n","\r\nimport { ViewModelContext } from \"../../view-model\";\r\nimport { ControlStatePropMetadata } from \"../control_decorators\";\r\nimport { UIStateMetadataUtil } from \"../uistate_metadata_util\";\r\nimport { ControlStateInterceptorService } from \"./control_state_interceptor.service\";\r\nimport { FormControl } from \"../../form\";\r\nimport { Observable } from \"rxjs\";\r\nimport { InterceptContext } from \"./control_state_interceptor\";\r\n\r\nexport class ControlStateUpdater {\r\n\r\n    //视图模型上下文\r\n    private viewModelContext: ViewModelContext;\r\n\r\n    //拦截器服务\r\n    private controlStateInterceptorService: ControlStateInterceptorService;\r\n\r\n    //描述控件状态的变量\r\n    private controlFields: {[propName: string]: ControlStatePropMetadata};\r\n\r\n    //【描述控件状态】的变量信息\r\n    private variableNames:any[];\r\n\r\n\r\n    constructor(viewModelContext: ViewModelContext) {\r\n        this.viewModelContext = viewModelContext;\r\n        this.controlStateInterceptorService = viewModelContext.injector.get(ControlStateInterceptorService);\r\n    }\r\n\r\n    /**\r\n     * 初始化\r\n     * @returns \r\n     */\r\n    public init():Observable<any>{\r\n        return this.controlStateInterceptorService.init();\r\n    }\r\n\r\n    /**\r\n     * 更新【描述控件状态】的变量\r\n     * @param changes 监听到的变化\r\n     */\r\n    public updateControlState(changes:{ lintenerType, change }) {\r\n        //1.获取【描述控件状态】的变量，并缓存\r\n        if(!this.controlFields){\r\n            const uiState = this.viewModelContext.uiState;\r\n            this.controlFields = UIStateMetadataUtil.getControlFields(uiState.constructor);\r\n            this.variableNames = Object.keys(this.controlFields)\r\n        }\r\n\r\n        //2.更新前事件\r\n        if(!this.beforeUpdate(changes)){\r\n            return;\r\n        }\r\n\r\n        //3.遍历变量，进行更新\r\n        this.variableNames.forEach(variableName => {\r\n            const fieldMetadata = this.controlFields[variableName] as ControlStatePropMetadata;\r\n            //遍历默认值\r\n            Object.keys(fieldMetadata.originalValue).forEach(propertyName => {\r\n                //更新\r\n                this.update(changes,fieldMetadata,variableName,propertyName)\r\n                \r\n            })\r\n        });\r\n    }\r\n\r\n    /**\r\n     * 更新前事件\r\n     * @param changes \r\n     * @returns \r\n     */\r\n    private beforeUpdate(changes:{ lintenerType, change }):boolean{\r\n        //1.没有【控件状态变量】，无需更新\r\n        if(!this.variableNames){\r\n            return false;\r\n        }\r\n\r\n        const { lintenerType, change } = changes;\r\n        //2.【控件状态变量】变化时，不做处理。否则会造成循环调用\r\n        if(lintenerType === 'uiState' && this.variableNames.includes(change.field)){\r\n            return false;\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * 更新\r\n     * @param changes 监听到的变化\r\n     * @param fieldMetadata 变量的元数据\r\n     * @param variableName 变量名\r\n     * @param propertyName 控件的属性名\r\n     * @returns \r\n     */\r\n    private update(changes:{ lintenerType, change },fieldMetadata:ControlStatePropMetadata,variableName:string,propertyName:string){\r\n        let propertyValue:{type,value} = fieldMetadata.originalValue[propertyName];\r\n\r\n        //1.是否需要更新\r\n        if(!this.needUpdate(propertyValue,changes)){\r\n            return;\r\n        }\r\n\r\n        //2.计算原始值\r\n        let value = this.computeOriginalValue(propertyValue);\r\n\r\n        //3.拦截器处理\r\n        const interceptContext = new InterceptContext();\r\n        interceptContext.controlState = fieldMetadata\r\n        interceptContext.value = value;\r\n        interceptContext.type = propertyName;\r\n        interceptContext.viewModelContext = this.viewModelContext;\r\n\r\n        if (this.controlStateInterceptorService) {\r\n            this.controlStateInterceptorService.intercept(interceptContext);\r\n        }\r\n\r\n        //4.更新状态\r\n        const uiState = this.viewModelContext.uiState;\r\n        if (!uiState[variableName]) {\r\n            uiState[variableName] = {};\r\n        }\r\n        uiState[variableName] = { ...uiState[variableName], [propertyName]: interceptContext.value };\r\n\r\n        //5.更新后事件\r\n        this.afterUpdate(propertyName,interceptContext);\r\n    }\r\n\r\n    /**\r\n     * 是否需要新\r\n     * @param originalValue \r\n     * @returns \r\n     */\r\n    private needUpdate(originalValue: { type, value:any },changes:{ lintenerType, change }):boolean{\r\n        const { type, value } = originalValue;\r\n        const { lintenerType, change } = changes;\r\n\r\n        //1.第一次更新全部\r\n        if(lintenerType === 'firstUpdate'){\r\n            return true;\r\n        }\r\n        \r\n        //2.固定值类型：只在第一次更新，后续不需要更新\r\n        if(type === 'constant'){\r\n            return false;\r\n        }\r\n\r\n        //3.value为空，也是固定值,也不需要更新\r\n        if(!value){\r\n            return false;\r\n        }\r\n\r\n        //4.表达式类型：监听到表达式变化，直接更新表达式变量\r\n        if(type === 'expression' && lintenerType === 'expression'){\r\n            return true;\r\n        }\r\n\r\n        //5.根据监听到变化的类型判断\r\n        switch(lintenerType){\r\n            case 'bindingData':{\r\n                if(change && change.path && change.path.length > 0){\r\n                    if(value.includes(change.path[0])){\r\n                        return true;\r\n                    }else{\r\n                        return false;\r\n                    }\r\n                }\r\n                break;\r\n            }\r\n            case 'uiState':{\r\n                if(change && change.field){\r\n                    if(value.includes(change.field)){\r\n                        return true;\r\n                    }else{\r\n                        return false;\r\n                    }\r\n\r\n                }\r\n                break;  \r\n            }\r\n            case 'stateMachine':{\r\n                if(value.includes('stateMachine')){\r\n                    return true;\r\n                }else{\r\n                    return false;\r\n                }\r\n                break;    \r\n            }\r\n            case 'form':{\r\n                if(value.includes('form')){\r\n                    return true;\r\n                }else{\r\n                    return false;\r\n                }\r\n                break;    \r\n            }\r\n\r\n        }\r\n        return true;\r\n    }\r\n\r\n\r\n    /**\r\n     * 计算变量的值\r\n     * @param originalValue \r\n     * @returns \r\n     */\r\n    private computeOriginalValue(originalValue: { type, value }): any {\r\n        let value = originalValue.value;\r\n        const type = originalValue.type;\r\n\r\n        if(value && typeof value === 'string' && type !=='constant'){\r\n            const context = {\r\n                bindingData:this.viewModelContext.bindingData.list.currentItem.toJSON(),\r\n                entityListData:this.viewModelContext.bindingData.getList().toJSON(),\r\n                currentEntityData:this.viewModelContext.bindingData.getObject().toJSON(),\r\n                uiState:this.viewModelContext.uiState,\r\n                form:this.viewModelContext.viewModel.form,\r\n                stateMachine:this.viewModelContext.stateMachine.renderStates,\r\n            }\r\n            return this.eval(value, context);\r\n        }\r\n        return value;\r\n    }\r\n\r\n    /**\r\n     * 计算\r\n     * @param expr 变量\r\n     * @param contexts 上下文\r\n     * @returns \r\n     */\r\n    private eval(expr: string, contexts) {\r\n        expr = `return ${expr}`;\r\n        const scopeNames = Object.getOwnPropertyNames(contexts);\r\n        const scopeVariable = `__scope__${new Date().valueOf()}`;\r\n        return new Function(scopeVariable, `\r\n          ${scopeNames.map((key: string) => `var ${key} = ${scopeVariable}['${key}'];`).join('\\r\\n')}\r\n          return function () {\r\n            try{  \\n${expr}\\n }catch(e){console.error(e);}\r\n          };`)(contexts)();\r\n      }\r\n\r\n\r\n    /**\r\n     * 更新变量后，需要进行的操作\r\n     * @param propertyName \r\n     * @param interceptContext \r\n     */\r\n    private afterUpdate(propertyName,interceptContext:InterceptContext){\r\n        //1.必填处理\r\n        if(propertyName === 'required'){\r\n            this.updateRequired(interceptContext);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 更新必填状态\r\n     * @param fieldMetadata \r\n     * @param interceptContext \r\n     * @returns \r\n     */\r\n    private updateRequired(interceptContext:InterceptContext){\r\n        const bindingPath = interceptContext.controlState.controlInfo.bindingPath;\r\n        if(!bindingPath){\r\n            return;\r\n        }\r\n        const form = this.viewModelContext.form;\r\n        const formControl = form.getFormValueByBindPath(bindingPath);\r\n        let form_name = formControl.form_name as FormControl;\r\n        if (!form_name || Object.keys(form_name).length === 0) {\r\n          return;\r\n        }\r\n        \r\n        const validators = [{ \"type\": \"required\", \"constraints\": [true], message:  '必填' }];\r\n        if (interceptContext.value === true) {\r\n          form.addValidate(formControl.bindingPath, formControl.name);\r\n          form_name.pushValidatorFnforRequired(validators, true)\r\n          form_name.required = true;\r\n        } else if (interceptContext.value === false) {\r\n          if (form_name.getValidatorFn() && form_name.getValidatorFn().length >= 1) {\r\n            form_name.required = false\r\n            //去除必填\r\n            form_name.resetValidatorFnforRequired();\r\n            if (form_name.validationResult && form_name.validationResult.type === 'required') {\r\n              form_name.validationResult = { passing: true, message: '' };\r\n            }\r\n          }\r\n        }\r\n    }\r\n\r\n}","import { Subscription } from \"rxjs\";\r\nimport { Change, ChangeType } from \"../../binding-data\";\r\nimport { ViewModelContext } from \"../../view-model\";\r\nimport { ControlStateUpdater } from \"./control_state_updater\";\r\nimport { UIStateObservableParam } from \"../ui_state\";\r\n\r\nexport class ControlStateListener {\r\n\r\n  //监听订阅集合\r\n  private subscriptionsMap: Map<string, Subscription> = new Map<string, Subscription>();\r\n\r\n  //视图模型上下文\r\n  private viewModelContext: ViewModelContext;\r\n\r\n  //更新器\r\n  private controlStateUpdater:ControlStateUpdater;\r\n\r\n  constructor(viewModelContext: ViewModelContext) {\r\n    this.viewModelContext = viewModelContext;\r\n    this.controlStateUpdater = viewModelContext.injector.get(ControlStateUpdater);\r\n    \r\n\r\n    //更新器初始化完成后，注册监听,主动触发一次更新\r\n    this.controlStateUpdater.init().subscribe(res=>{\r\n      this.register();\r\n\r\n      const changes = {\r\n        lintenerType:'firstUpdate',\r\n        change:null\r\n      }\r\n      this.controlStateUpdater.updateControlState(changes);\r\n    })\r\n\r\n  }\r\n\r\n  /**\r\n   *注册监听\r\n   */\r\n  private register(){\r\n    this.registerBindingDataLintener();\r\n    this.registerUIStateLintener();\r\n    this.registerStateMachineLintener();\r\n    this.registerFormLintener();\r\n  }\r\n\r\n  /**\r\n   * 监听BindingData变化\r\n   */\r\n  private registerBindingDataLintener() {\r\n    const stateName = 'bindingData';\r\n    if (this.subscriptionsMap.has(stateName) === false) {\r\n      const subscription = this.viewModelContext.bindingData.changes.subscribe((change: Change) => {\r\n        if (change.type === ChangeType.Load) {\r\n          return;\r\n        }\r\n        this.controlStateUpdater.updateControlState({\r\n          lintenerType:'bindingData',\r\n          change\r\n        });\r\n      });\r\n      this.subscriptionsMap.set(stateName, subscription);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 监听UIState变化\r\n   */\r\n  private registerUIStateLintener() {\r\n    const stateName = 'uiState';\r\n    if (this.subscriptionsMap.has(stateName) === false) {\r\n      const subscription = this.viewModelContext.uiState.changes.subscribe((change: UIStateObservableParam) => {\r\n        this.controlStateUpdater.updateControlState({\r\n          lintenerType:'uiState',\r\n          change\r\n        });\r\n      });\r\n      this.subscriptionsMap.set(stateName, subscription);\r\n    }\r\n  }\r\n\r\n  \r\n  /**\r\n   * 监听StateMachine变化\r\n   */\r\n  private registerStateMachineLintener() {\r\n    const stateName = 'stateMachine';\r\n    if (this.subscriptionsMap.has(stateName) === false && this.viewModelContext.stateMachine) {\r\n      const subscription = this.viewModelContext.stateMachine.stateChange.subscribe((change: string) => {\r\n        this.controlStateUpdater.updateControlState({\r\n          lintenerType:'stateMachine',\r\n          change\r\n        });\r\n      });\r\n      this.subscriptionsMap.set(stateName, subscription);\r\n    }\r\n  }\r\n\r\n  \r\n  /**\r\n   * 监听Form变化\r\n   */\r\n  private registerFormLintener() {\r\n    const stateName = 'form';\r\n    if (this.subscriptionsMap.has(stateName) === false) {\r\n      const subscription = this.viewModelContext.form.changes.subscribe((change: any) => {\r\n        if (change && change.type === 'validateFieldsFinished') {\r\n          this.controlStateUpdater.updateControlState({\r\n            lintenerType:'expression',\r\n            change\r\n          });\r\n        } else{\r\n          this.controlStateUpdater.updateControlState({\r\n            lintenerType:'form',\r\n            change\r\n          });\r\n        }\r\n\r\n      });\r\n      this.subscriptionsMap.set(stateName, subscription);\r\n    }\r\n  }\r\n  \r\n}","/*\n * @Author: Witt\n * @Date: 2018-11-17 13:38:23\n * @Last Modified by: Witt\n * @Last Modified time: 2018-11-17 13:38:50\n * @todo：临时删除原有功能，待重构\n */\n\nimport { Subject } from 'rxjs';\nimport { UIStateMetadataUtil } from './uistate_metadata_util';\nimport { UIStatePropMetadata } from './decorators';\nimport { ControlStatePropMetadata } from './control_decorators';\nimport { ControlStateListener } from './control-state/control_state_listener';\n\nexport interface UIStateObservableParam {\n  field: string;\n  value: any;\n}\n\n\n/**\n * UI状态\n */\nexport class UIState {\n\n  innerData: {};\n\n  // 监听变化\n  changes: Subject<UIStateObservableParam>;\n  public controlStateListener:ControlStateListener;\n\n  constructor() {\n    this.changes = new Subject<UIStateObservableParam>();\n\n    this.innerData = Object.assign({});\n    this._init();\n  }\n\n  _init() {\n    const construct = this.constructor;\n    const uiFields = UIStateMetadataUtil.getUIFields(construct);\n    const controlFields = UIStateMetadataUtil.getControlFields(construct);\n\n    this.initializeUIField(uiFields);\n    this.initializeControlField(controlFields);\n  }\n\n  //注册监听\n  config(viewModelContext){\n    const construct = this.constructor;\n    const controlFields = UIStateMetadataUtil.getControlFields(construct);\n\n    if(controlFields && Object.keys(controlFields).length > 0){\n      this.controlStateListener = viewModelContext.injector.get(ControlStateListener);\n\n    }\n  }\n\n  private initializeUIField(uiFieldMetadata: { [key: string]: UIStatePropMetadata }): void {\n    Object.keys(uiFieldMetadata).forEach(propertyName => {\n      const fieldMetadata = uiFieldMetadata[propertyName] as UIStatePropMetadata;\n      const uiField = fieldMetadata.stateName || propertyName;\n\n      if (delete this[propertyName]) {\n        this.defineProperty(propertyName, uiField);\n      }\n    });\n  }\n\n  private initializeControlField(controlFieldMetadata: { [key: string]: ControlStatePropMetadata }): void {\n    Object.keys(controlFieldMetadata).forEach(propertyName => {\n      const fieldMetadata = controlFieldMetadata[propertyName] as ControlStatePropMetadata;\n      const uiField = fieldMetadata.stateName || propertyName;\n\n      if (delete this[propertyName]) {\n        this.defineProperty(propertyName, uiField);\n      }\n    });\n  }\n\n  public isExistProperty(propertyName: any) {\n    if (this.innerData.hasOwnProperty(propertyName) || this.hasOwnProperty(propertyName)) {\n      return true;\n    }\n    return false;\n  }\n\n  private defineProperty(propertyName: any, field: any = null) {\n    Object.defineProperty(this, propertyName, {\n      get: function () {\n        return field !== null ? this.innerData[field] : this.innerData[propertyName];\n      },\n      set: function (value) {\n        // 值相同时不触发变更\n        const oldValue = field !== null ? this.innerData[field] : this.innerData[propertyName];\n        if (oldValue === value) {\n          return;\n        }\n        if (field !== null) {\n          this.innerData[field] = value;\n        } else {\n          this.innerData[propertyName] = value;\n        }\n        this.changes.next({\n          field: propertyName,\n          value: value\n        });\n      }\n    });\n  }\n\n  public setPropertyValue(propertyName: any, value: any) {\n    if (propertyName === '' || propertyName === undefined) {\n      return;\n    }\n    if (!this.isExistProperty(propertyName)) {\n      this.defineProperty(propertyName);\n    }\n    this[propertyName] = value;\n  }\n}\n","import { StateMachineContext } from './state_machine_context';\n\n/**\n * --------------------------------------------------------------------------------\n * State相关\n * --------------------------------------------------------------------------------\n */\n\n/**\n * 基本状态：表单的基本状态，通过State的运算确定RenderState的值，进而控制页面控件的状态。\n */\nexport class State {\n\n  /**\n   * 构造函数\n   * @param name 状态名称\n   */\n  constructor(public name: string) {\n  }\n}\n\n/**\n * 基本状态字典, 形如\n * {\n *  stateName1: stateInstance1,\n *  stateName2: stateInstance2,\n *  ...\n * }\n */\nexport interface StateDictionary {\n    [index: string]: State;\n}\n\n\n/**\n * --------------------------------------------------------------------------------\n * RenderState相关\n * --------------------------------------------------------------------------------\n */\n\n/**\n * 渲染状态，该状态用于和界面UI绑定\n */\nexport type RenderState = boolean;\n\n/**\n * 初始渲染状态\n */\nexport const initialUIState: RenderState = false;\n\n/**\n * 渲染状态字典，形如：\n * {\n *  renderStateName1: true,\n *  renderStateName1: false,\n *  ...\n * }\n */\nexport interface RenderStateDictionary {\n  [index: string]: RenderState;\n}\n\n\n/**\n * 渲染方法\n * 该方法接收一个StateMachineContext类型的上下文，\n * 通过对上下文中指定的当前状态的计算，确定对应渲染状态的值，该方法返回一个RenderState类型的值（即布尔类型）\n */\nexport type Render = (context: StateMachineContext) => RenderState;\n\n/**\n * 渲染方法字典\n * {\n *  renderStateName1: render1,\n *  renderStateName1: render2,\n *  ...\n * }\n */\nexport interface RenderDictionary {\n  [index: string]: Render;\n}\n\n\n/**\n * --------------------------------------------------------------------------------\n * Action相关\n * --------------------------------------------------------------------------------\n */\n\n/**\n * 状态机动作\n */\nexport type Action = () => any;\n\n/**\n * 状态机行为约束条件\n */\n// export interface Precondition {\n// }\n\n\n/**\n * --------------------------------------------------------------------------------\n * Effect相关\n * --------------------------------------------------------------------------------\n */\n\n/**\n * 行为效果，表示状态机发起某行为后引起的界面变化效果\n */\nexport interface EffectHandlerOption {\n\n  /**\n   * 效果类型\n   */\n  type: string;\n\n  /**\n   * 效果实现\n   */\n  effect: any;\n}\n\n/**\n * 状态机界面效果\n */\nexport interface Effect {\n\n  /**\n   * 行为约束条件集合\n   */\n  preconditions?: any[];\n\n  /**\n   * 发生某行为后引起的界面变化效果\n   */\n  handlers?: EffectHandlerOption[];\n}\n\n/**\n * 状态机效果字典\n */\nexport interface EffectDictianry {\n    [index: string]: Effect;\n}\n\n\n","import { makePropDecorator } from '../../core/index';\n\n/**\n * 页面状态元数据\n */\nexport interface StatePropMetadata {\n\n  /**\n   * 初始状态\n   */\n  initialState?: boolean;\n}\n\n\n/**\n * 状态元数据名称\n */\nexport const STATE_PROP_META = 'StatePropMeta';\n\n\n/**\n * 页面状态元数据装饰器工厂接口\n */\nexport interface StatePropMetaDecorator {\n  (obj?: StatePropMetadata): any;\n  new(obj?: StatePropMetadata): any;\n}\n\n/**\n * 页面状态元数据装饰器工厂\n */\nexport const StatePropMeta: StatePropMetaDecorator =\n  makePropDecorator(STATE_PROP_META, (obj?: StatePropMetadata) => obj);\n","import { makePropDecorator } from '../../core/index';\nimport { Render } from '../types';\n\n/**\n * 组件状态元数据\n */\nexport interface RenderStatePropMetadata {\n  render: Render;\n}\n\n\n/**\n * 组件状态元数据名称\n */\nexport const RENDER_STATE_PROP_META = 'RenderStatePropMeta';\n\n\n/**\n * 组件状态元数据工厂接口\n */\nexport interface RenderStatePropMetaDecorator {\n  (obj?: RenderStatePropMetadata): any;\n  new(obj?: RenderStatePropMetadata): any;\n}\n\n/**\n * 组件状态元数据工厂\n */\nexport const RenderStatePropMeta: RenderStatePropMetaDecorator =\n  makePropDecorator(RENDER_STATE_PROP_META, (obj: RenderStatePropMetadata) => obj);","import { makePropDecorator } from '../../core/index';\n\n/**\n * 迁移动作\n */\nexport interface ActionMethodMetadata {\n  precondition?: any[];\n  transitTo: string;\n}\n\n\n/**\n * 动作方法元数据名称\n */\nexport const ACTION_METHOD_META = 'ActionMethodMeta';\n\n\n/**\n * 迁移动作元数据装饰工厂接口\n */\nexport interface ActionMethodMetaDecorator {\n  (obj?: ActionMethodMetadata): any;\n  new(obj?: ActionMethodMetadata): any;\n}\n\n/**\n * 迁移动作元数据装饰工厂\n */\nexport const ActionMethodMeta: ActionMethodMetaDecorator =\n  makePropDecorator(ACTION_METHOD_META, (action: ActionMethodMetadata) => action);","import { StateMachine } from './state_machine';\nimport { State } from './types';\nimport { Context } from '../context/context';\nimport { VariableParseService } from '../variable/index';\nimport { ViewModelContext } from '../view-model/index';\nimport { StateMachineWatcher } from './state_machine_watcher';\n\n/**\n * 状态机上下文\n */\nexport class StateMachineContext {\n\n  /**\n   * 当前状态名称\n   */\n  public state: string;\n\n  /**\n   * 父Context\n   */\n  public parent: Context;\n\n  /**\n   * 变量解析器\n   */\n  public parser: any;\n\n  /**\n   * ViewModel上下文\n   */\n  public viewModelContext: ViewModelContext;\n\n  /**\n   * 状态机事件监听\n   */\n  public stateMachineWatcher: StateMachineWatcher;\n\n  /**\n   * 构造函数\n   * @param stateMachine 状态机实例\n   * @param initialState 初始状态\n   */\n  constructor(public stateMachine: StateMachine, initialState: State) {\n    this.state = initialState.name;\n  }\n\n  /**\n   * 初始化\n   */\n  public init(frameContext: ViewModelContext) {\n    this.viewModelContext = frameContext;\n    this.parser = this.viewModelContext.injector.get(VariableParseService);\n    this.stateMachineWatcher = this.stateMachine.stateMachineWatcher;\n  }\n\n  /**\n   * 状态迁移\n   * @param stateName 下一状态的名称\n   */\n  public transitTo(stateName: string) {\n    const nextState = this.stateMachine.states[stateName];\n    if (nextState) {\n      this.state = nextState.name;\n      this.stateMachine.render();\n    }\n  }\n\n  /**\n   * 获取expression对应的UIState值\n   * @param expression UIState表达式\n   */\n  public getUIState(expression: string): any {\n    if (!expression) {\n      return;\n    }\n    const viewModelContext = this.stateMachineWatcher.getViewModelContext(expression);\n    if (!viewModelContext) {\n      return;\n    }\n\n    this.stateMachineWatcher.subscribeUIStateChange(viewModelContext, expression);\n\n    if (this.parser) {\n      const value = this.parser.parse(expression, viewModelContext);\n      if (value === null) {\n        return null;\n      }\n      if (typeof value === 'object' && Object.keys(value).length === 0) {\n        return null;\n      }\n      return value;\n    } else {\n      throw new Error('未初始化变量解析器。');\n    }\n  }\n\n  /**\n   * 获取数据的值\n   */\n  public getData(expression: string): any {\n    if (!expression) {\n      return;\n    }\n    const viewModelContext = this.stateMachineWatcher.getViewModelContext(expression);\n    if (!viewModelContext) {\n      return;\n    }\n\n    this.stateMachineWatcher.subscribeEntityChange(viewModelContext, expression);\n\n    if (this.parser) {\n      const value = this.parser.parse(expression, viewModelContext);\n      if (value === null) {\n        return null;\n      }\n      if (typeof value === 'object' && Object.keys(value).length === 0) {\n        return null;\n      }\n      return value;\n    } else {\n      throw new Error('未初始化变量解析器。');\n    }\n  }\n}\n","import { StateMachine } from './state_machine';\nimport { ViewModelContext } from '../view-model/index';\nimport { Change } from '../binding-data/changes';\n\n\n/**\n * 状态机事件，监听uistate的变化和entity的变化\n */\nexport class StateMachineWatcher {\n\n  /**\n   * 当前ViewModel上下文\n   */\n  private viewModelContext: ViewModelContext;\n\n  /**\n   * viewModel=>UIStatePahts字典\n   */\n  private viewModelContextAndUIStatePathsMap: Map<ViewModelContext, Array<string>>;\n\n  /**\n   * viewModel=>DataStatePahts字典\n   */\n  private viewModelContextAndDataStatePathsMap: Map<ViewModelContext, Array<string>>;\n\n  /**\n   * 所有UIStatePath数组\n   */\n  private uiStatePathList: Array<string> = [];\n\n  /**\n   * 所有DataStatePath数组\n   */\n  private dataStatePathList: Array<string> = [];\n\n  constructor(public stateMachine: StateMachine) {\n    this.viewModelContextAndUIStatePathsMap = new Map<ViewModelContext, any>();\n    this.viewModelContextAndDataStatePathsMap = new Map<ViewModelContext, any>();\n  }\n\n  /**\n   * 初始化\n   * @param viewModelContext 当前视图上下文\n   */\n  public init(viewModelContext: ViewModelContext) {\n    this.viewModelContext = viewModelContext;\n  }\n\n  /**\n   * 返回表达式中ViewModelId对应的ViewModelContext\n   */\n  public getViewModelContext(expression: any): ViewModelContext {\n    const viewModelId = this.extractPaths(expression).split('/')[1];\n    return this.viewModelContext.appContext.viewModelContextManager.getContextById(viewModelId);\n  }\n\n  /**\n   * 监听UIState变更\n   * @param viewModelContext ViewModel上下文\n   * @param expression UIState表达式\n   */\n  public subscribeUIStateChange(viewModelContext: ViewModelContext, expression: any) {\n    const uiStatePath = this.getStatePath(expression);\n\n    if (this.viewModelContextAndUIStatePathsMap.has(viewModelContext) === false) {\n      this.viewModelContextAndUIStatePathsMap.set(viewModelContext, this.uiStatePathList);\n      viewModelContext.uiState.changes.subscribe((uiStateChange) => {\n        const uiStatePathList = this.viewModelContextAndUIStatePathsMap.get(viewModelContext);\n        if (uiStateChange.field && uiStatePathList.indexOf(uiStateChange.field) > -1) {\n          this.stateMachine.render();\n        }\n      });\n    }\n\n    if (this.viewModelContextAndUIStatePathsMap.get(viewModelContext).indexOf(uiStatePath) === -1) {\n      this.uiStatePathList.push(uiStatePath);\n    }\n  }\n\n  /**\n   * 监听实体变更\n   */\n  public subscribeEntityChange(viewModelContext: ViewModelContext, expression: any) {\n\n    if (this.viewModelContextAndDataStatePathsMap.has(viewModelContext) === false) {\n      this.viewModelContextAndDataStatePathsMap.set(viewModelContext, this.dataStatePathList);\n      viewModelContext.bindingData.changes.subscribe((change: Change) => {\n\n        if (change.type === 'Load' || change.type === 'SelectionChanged') {\n          this.stateMachine.render();\n        }\n\n        const dataPathList = this.viewModelContextAndDataStatePathsMap.get(viewModelContext);\n        if (change.path.join() && this.isAccordingPath(dataPathList, change.path.join('/'))) {\n          this.stateMachine.render();\n        }\n      });\n    }\n\n    if (this.viewModelContextAndDataStatePathsMap.get(viewModelContext).indexOf(expression) === -1) {\n      this.dataStatePathList.push(expression);\n    }\n  }\n\n  /**\n   * 根据表达式获取对应的StatePath（移除了ViewModelId之外的部分）\n   * @param expression 变量表达式\n   */\n  private getStatePath(expression: any) {\n    return this.extractPaths(expression).split('/')[2];\n  }\n\n  /**\n   * 判断是否监听范围内的变更路径\n   */\n  public isAccordingPath(dataStatePaths: any, dataStatePath: string) {\n    const targetPath = dataStatePaths.find((item) => {\n      return item.indexOf(dataStatePath) > -1;\n    });\n\n    return targetPath === undefined ? false : true;\n  }\n\n  /**\n   * 暂时把这个方法放了这个地方，等季老师共用方法调整后，直接引用他的方法，该方法可删除\n   * @param expression 变量表达式\n   */\n  private extractPaths(expression: string): string {\n    let path: string;\n    const UI_STATE_PATTERN_G = /\\{UISTATE~(\\S+?)\\}/g;\n    const DATA_PATTERN_G = /\\{DATA~(\\S+?)\\}/g;\n    const uiStateVariables = expression.match(UI_STATE_PATTERN_G);\n    const dataVariables = expression.match(DATA_PATTERN_G);\n    if (uiStateVariables !== null) {\n      const UI_STATE_PATTERN = /\\{UISTATE~(\\S+?)\\}/;\n      uiStateVariables.forEach((uiStateVariable: string) => {\n        const pathMatches = uiStateVariable.match(UI_STATE_PATTERN);\n        if (pathMatches != null && pathMatches.length === 2) {\n          path = pathMatches[1];\n        }\n      });\n    }\n    if (dataVariables !== null) {\n      const DATA_PATTERN = /\\{DATA~(\\S+?)\\}/;\n      dataVariables.forEach((dataVariable: string) => {\n        const pathMatches = dataVariable.match(DATA_PATTERN);\n        if (pathMatches != null && pathMatches.length === 2) {\n          path = pathMatches[1];\n        }\n      });\n    }\n    return path;\n  }\n}","import { BehaviorSubject } from 'rxjs';\nimport { MetadataUtil } from '../core/index';\nimport { ViewModelContext } from '../view-model/index';\n\nimport { State, initialUIState, StateDictionary, RenderStateDictionary, RenderDictionary } from './types';\nimport {\n  StatePropMetadata, ActionMethodMetadata, RenderStatePropMetadata,\n  STATE_PROP_META, RENDER_STATE_PROP_META, ACTION_METHOD_META\n} from './decorators';\nimport { StateMachineContext } from './state_machine_context';\nimport { StateMachineWatcher } from './state_machine_watcher';\n\n/**\n * 状态机\n */\nexport class StateMachine {\n\n  /**\n   * 初始状态\n   */\n  private initialState: State;\n\n  /**\n   * 状态字典\n   */\n  public states: StateDictionary;\n\n  /**\n   * 渲染状态字典\n   */\n  public renderStates: RenderStateDictionary;\n\n  /**\n   * 渲染器字典\n   */\n  public renders: RenderDictionary;\n\n  /**\n   * 状态机上下文\n   */\n  public context: StateMachineContext;\n\n  /**\n   * 状态变更\n   */\n  public stateChange: BehaviorSubject<string>;\n\n  /**\n   * ViewModel上下文\n   */\n  public viewModelContext: ViewModelContext;\n\n  /**\n   * 状态机事件监听\n   */\n  public stateMachineWatcher: StateMachineWatcher;\n\n  /**\n   * 构造函数\n   */\n  constructor() {\n    this.renderStates = {};\n    this.handlePropMetadatas();\n    this.stateChange = new BehaviorSubject<any>(false);\n    this.context = new StateMachineContext(this, this.initialState);\n    this.stateMachineWatcher = new StateMachineWatcher(this);\n  }\n\n  /**\n   * 初始化状态机\n   * @param viewModelContext ViewModel上下文\n   * @summary\n   * 状态机变更，为了在绑定数据之后执行状态机的操作，把render方法延后执行。\n   */\n  public init(viewModelContext: ViewModelContext) {\n    this.viewModelContext = viewModelContext;\n    this.context.init(this.viewModelContext);\n    this.stateMachineWatcher.init(this.viewModelContext);\n    this.render();\n  }\n\n  /**\n   * 批量处理属性元数据\n   */\n  private handlePropMetadatas() {\n    const propsMetadatas = MetadataUtil.getPropsMetadatas(this.constructor);\n\n    // 遍历所有属性装饰器，并调用相应的build方法\n    if (propsMetadatas) {\n      Object.keys(propsMetadatas).forEach((propName: string) => {\n        const propMetadatas = propsMetadatas[propName];\n        propMetadatas.forEach(propMetadata => {\n          this.handlePropMetadata(propName, propMetadata);\n        });\n      });\n    }\n\n    if (!this.initialState) {\n      throw new Error('请在StatePropMeta注解中指定状态机的初始状态。');\n    }\n  }\n  \n  /**\n   * 处理属性元数据\n   */\n  private handlePropMetadata(propName: string, propMetadata: any) {\n    const ngMetadataName =  propMetadata.ngMetadataName;\n    switch(ngMetadataName) {\n      case STATE_PROP_META:\n        this.buildState(propName, propMetadata);\n        break;\n      case RENDER_STATE_PROP_META:\n        this.buildRenderState(propName, propMetadata);\n        break;\n      case ACTION_METHOD_META:\n        this.buildAction(propName, propMetadata);\n        break;\n      default:\n        break;\n    }\n  }\n\n  /**\n   * 包装State\n   * @param stateName 状态名称\n   * @param ngState   状态对象\n   */\n  private buildState(stateName: string, ngState: StatePropMetadata) {\n    this.states = this.states || {};\n    this[stateName] = new State(stateName);\n    this.states[stateName] = this[stateName];\n    if (ngState.initialState) {\n      this.initialState = this[stateName];\n    }\n  }\n\n  /**\n   * 包装RenderState\n   * @param renderStateName 渲染状态名称\n   * @param ngRenderState   渲染状态元数据\n   */\n  private buildRenderState(renderStateName: string, ngRenderState: RenderStatePropMetadata) {\n    this.renderStates = this.renderStates || {};\n    this[renderStateName] = initialUIState;\n    this.renderStates[renderStateName] = this[renderStateName];\n\n    // 将renderState上指定的render加入到renders中\n    this.renders = this.renders || {};\n    this.renders[renderStateName] = ngRenderState.render;\n  }\n\n  /**\n   * 包装Action\n   * @param actionName 动作名称\n   * @param ngAction 动作元数据\n   */\n  private buildAction(actionName: string, ngAction: ActionMethodMetadata) {\n    this[actionName] = () => {\n      const nextStateName = ngAction.transitTo;\n      const nextState: State = this.states[nextStateName];\n      this.context.transitTo(nextState.name);\n      this.render();\n    };\n  }\n\n  /**\n   * 重新计算所有渲染状态的值\n   * @sumamry\n   * 当 state切换的时候，调用遍历所有的render方法，更改renderState\n   */\n  render() {\n    for (const renderStateName in this.renderStates) {\n\n      if (this.renderStates.hasOwnProperty(renderStateName) === false) {\n        continue;\n      }\n\n      // 执行RenderState的render方法，更新renderState\n      const stateRender = this.renders[renderStateName];\n      if (!stateRender) {\n        continue;\n      }\n\n      this.renderStates[renderStateName] = stateRender(this.context);\n      this[renderStateName] = this.renderStates[renderStateName];\n    }\n    this.stateChange.next(this.context.state);\n  }\n}\n","import { DateUtil } from '../utils/index';\n\n/**\n * 绑定值转换器\n */\ninterface BindingValueConverter {\n\n  /**\n   * 将ControlValue转换为StateValue值\n   */\n  convertFrom(controlValue: any): any;\n\n  /**\n   * 将StateValue转换为ControlValue\n   */\n  convertTo(stateValue: any): any;\n}\n\n\n/**\n * 日期字符串转换器\n */\nclass DateStringValueConverter implements BindingValueConverter {\n\n  public convertFrom(dateObj: Date): string {\n    return  DateUtil.formatISO(dateObj);\n  }\n\n  public convertTo(dateString): Date {\n    return DateUtil.parse(dateString);\n  }\n}\n\n\n/**\n * 数组字符串转换器\n */\nclass ArrayStringValueConverter implements BindingValueConverter  {\n\n  public convertFrom(arr: any[]): string {\n    return  arr.join(',');\n  }\n\n  public convertTo(arrString): any[] {\n    return arrString.split(',');\n  }\n\n}\n\nexport { BindingValueConverter, DateStringValueConverter, ArrayStringValueConverter };\n\n\n\n","import { BindingData } from '../binding-data/index';\nimport { UIState } from '../ui-state/index';\nimport { ViewModelContext } from '../view-model/index';\nimport { BindingPathConverter, DateUtil } from '../utils/index';\n\nimport { BindingType } from './types';\nimport { BindingValueConverter } from './binding_value_converter';\n\n/**\n * 绑定值访问器接口\n */\ninterface BindingValueAccessor {\n\n  getValue(): any;\n\n  setValue(controlValue: any): void;\n}\n\n/**\n * Entity值访问器\n */\nclass EntityBindingValueAccessor implements BindingValueAccessor {\n\n  private bindingData: BindingData;\n\n  private bindingPathSegments: string[];\n\n  private valueConverter: BindingValueConverter;\n\n  constructor(bindingData: BindingData, bindingPath: string, valueConverter: BindingValueConverter) {\n    this.bindingData = bindingData;\n    this.bindingPathSegments = this.getBindingPathSegments(bindingPath);\n    this.valueConverter = valueConverter;\n  }\n\n  public getValue(): any {\n    const stateValue = this.bindingData.getValue(this.bindingPathSegments);\n    const controlValue = this.valueConverter ? this.valueConverter.convertTo(stateValue) : stateValue;\n    return controlValue;\n  }\n\n  public setValue(controlValue: any): void {\n    const oldStateValue = this.bindingData.getValue(this.bindingPathSegments);\n    const stateValue = this.valueConverter ? this.valueConverter.convertFrom(controlValue) : controlValue;\n\n    if (this.isDateConverter(this.valueConverter) === true) {\n      if (DateUtil.isEqual(oldStateValue, stateValue) === true) {\n        return;\n      }\n    }\n\n    this.bindingData.setValue(this.bindingPathSegments, stateValue, true, true);\n  }\n\n  private getBindingPathSegments(bindingPath: string) {\n    const parentPathSegments = BindingPathConverter.toBindingPathArray(this.bindingData.bindingPath);\n    bindingPath = bindingPath.replace(/\\./g, '\\/');\n    const bindingPathSegments = BindingPathConverter.toBindingPathArray(bindingPath);\n    return parentPathSegments.concat(bindingPathSegments);\n  }\n\n  /**\n   * 是否是DateConverter\n   */\n  private isDateConverter(converter: BindingValueConverter): boolean {\n    let isDateConverter = false;\n    if (converter && converter.hasOwnProperty('format') === true) {\n      isDateConverter = true;\n    }\n    return isDateConverter;\n  }\n}\n\n/**\n * UIState值访问器\n */\nclass UIStateBindingValueAccessor implements BindingValueAccessor {\n\n  private uiState: UIState;\n\n  private bindingPathSegments: string[];\n\n\n  constructor(uiState: UIState, bindingPath: string, valueConverter: BindingValueConverter) {\n    this.uiState = uiState;\n    this.bindingPathSegments = this.getUiStateBindingPath(bindingPath);\n  }\n\n  public getValue(): any {\n    let stateValue;\n    let obj = this.uiState;\n    this.bindingPathSegments.forEach(item => {\n      stateValue = obj[item];\n      obj = stateValue\n    })\n    return stateValue;\n  }\n\n  public setValue(controlValue: any): void {\n    const length = this.bindingPathSegments.length;\n    if (length === 1) {\n      this.uiState.setPropertyValue(this.bindingPathSegments, controlValue);\n    } else {\n      let obj;\n      for(let i = length-1 ; i > 0 ; i--){\n        obj = {[this.bindingPathSegments[i]]: controlValue};\n        controlValue = obj;\n      }\n      this.uiState.setPropertyValue(this.bindingPathSegments[0], obj);\n    }\n  }\n\n  // UISTATE获取路径\n  private getUiStateBindingPath(bindingPath: string) {\n    const index = bindingPath.search('/');\n    if (index !== -1) {\n      return bindingPath.split('/')\n    } else {\n      return [bindingPath]\n    }\n  }\n}\n\n/**\n * 绑定值访问器工厂\n */\nclass BindingValueAccessorFactory {\n\n  static create(bindingType: BindingType, bindingBindingPath: string, bindingValueConverter, viewModelContext: ViewModelContext) {\n    switch (bindingType) {\n      case BindingType.EntityState:\n        const bindingData = viewModelContext.bindingData;\n        return new EntityBindingValueAccessor(bindingData, bindingBindingPath, bindingValueConverter);\n      case BindingType.UIState:\n        const uiState = viewModelContext.uiState;\n        return new UIStateBindingValueAccessor(uiState, bindingBindingPath, bindingValueConverter);\n      default:\n        throw new Error('Not Supported');\n    }\n  }\n}\n\nexport { BindingValueAccessor, EntityBindingValueAccessor, UIStateBindingValueAccessor, BindingValueAccessorFactory };\n","\nimport { makePropDecorator } from '../core/index';\nimport { BindingType } from './types';\nimport { BindingValueConverter } from './binding_value_converter';\nimport { ValidationRule } from '../validator';\n\n/**\n * FormControl元数据名称\n */\nexport const FORM_CONTROL_PROP_META = 'FormControlPropMeta';\n\n\n/**\n * FormControl元数据\n */\nexport interface FormControlMetadata {\n\n  /**\n   * 控件名称\n   */\n  name?: string;\n\n  /**\n   * 绑定字段路径\n   */\n  bindingType?: BindingType;\n\n  /**\n   * 绑定路径\n   */\n  bindingPath?: string;\n\n  /**\n   * 值转换器\n   */\n  valueConverter?: BindingValueConverter;\n\n    /**\n   * 值改变前监听器\n   */\n  valueChanging?: string;\n  /**\n   * 值改变后监听器\n   */\n  valueChanged?: string;\n  /**\n    * 验证规则\n    */\n  validRules?:  ValidationRule[] ;\n}\n\n/**\n * 表单控件装饰器\n */\nexport interface FormControlPropMetaDecorator {\n  (obj?: FormControlMetadata): any;\n  new(obj?: FormControlMetadata): any;\n}\n\n/**\n * FormControl装饰器工厂\n */\nexport const FormControlPropMeta: FormControlPropMetaDecorator =\n  makePropDecorator(FORM_CONTROL_PROP_META, (obj: FormControlMetadata) => obj);\n","import { from, Observable, of } from 'rxjs';\nimport { switchMap } from 'rxjs/operators';\nimport { ValidationRule } from './types';\nimport { DateUtil } from '../utils/date_util';\nimport { isObservable } from '../utils/is-observable';\nimport { VariableParseService } from '../variable/index';\n\n/**\n * 验证器工厂\n */\nclass ValidatorFactory {\n    /**\n     * 创建适配器\n     */\n    static create(validRules: ValidationRule | ValidationRule[]): any {\n        let validatorFn = [];\n        if (Array.isArray(validRules) && validRules.length > 1) {\n            validRules.forEach((validRule: ValidationRule) => {\n                validatorFn.push(this.initValidRuleFn(validRule))\n            })\n        } else if (Array.isArray(validRules) && validRules.length === 1) {\n            validatorFn.push(this.initValidRuleFn(validRules[0]))\n        } else {\n            validatorFn.push(this.initValidRuleFn(validRules as ValidationRule))\n        }\n        return validatorFn;\n    }\n\n    private static initValidRuleFn(validRule: ValidationRule): any {\n        const { type, constraints, message } = validRule;\n        switch (type) {\n            case 'required':\n                return (v, context) => {\n                    if (constraints[0] !== true) {\n                        const parseService = context.injector.get(VariableParseService);\n                        const parsedArgs = parseService.parse(constraints[0], context);\n                        if (parsedArgs === true) {\n                            if (null === v || undefined === v || '' === v) {\n                                return { type, passing: false, message: message || '必填' }\n                            } else {\n                                return { type, passing: true, message: '' }\n                            }\n                        }\n                    }\n\n                    if (constraints[0] === true) {\n                        if (null === v || undefined === v || '' === v) {\n                            return { type, passing: false, message: message || '必填' }\n                        } else {\n                            return { type, passing: true, message: '' }\n                        }\n                    }\n\n                    return { type, passing: true, message: '' }\n                }\n            case 'NumberMaxValue':\n            case 'numberMaxValue':\n                return (v) => {\n                    if (typeof v !== 'number') {\n                        return { passing: true, message: '' }\n                    }\n                    if (constraints[0] || 0 == constraints[0]) {\n                        if (v <= parseFloat(constraints[0])) {\n                            return { passing: true, message: '' }\n                        } else {\n                            return { passing: false, message: message || `输入值不能大于${constraints[0]}` }\n                        }\n                    }\n                    return { passing: true, message: '' }\n                }\n            case 'NumberMinValue':\n            case 'numberMinValue':\n                return (v) => {\n                    if (typeof v !== 'number') {\n                        return { passing: true, message: '' }\n                    }\n                    if (constraints[0] || 0 == constraints[0]) {\n                        if (v >= parseFloat(constraints[0])) {\n                            return { passing: true, message: '' }\n                        } else {\n                            return { passing: false, message: message || `输入值不能小于${constraints[0]}` }\n                        }\n                    }\n                    return { passing: true, message: '' }\n                }\n            case 'DateMaxValue':\n            case 'dateMaxValue':\n                return (v) => {\n                    if (v === null || v === undefined || v === '') {\n                        return { passing: true, message: '' }\n                    }\n                    if (constraints[0]) {\n                        let condition = constraints[0];\n                        if (condition.length == 21) {\n                            condition = condition.slice(1, 20)\n                        }\n                        if (DateUtil.isBefore(v, condition) || DateUtil.isSame(v, condition)) {\n                            return { passing: true, message: '' }\n                        } else {\n                            return { passing: false, message: message || `输入日期不能大于${condition}` }\n                        }\n                    }\n                    return { passing: true, message: '' }\n                }\n            case 'DateMinValue':\n            case 'dateMinValue':\n                return (v) => {\n                    if (v === null || v === undefined || v === '') {\n                        return { passing: true, message: '' }\n                    }\n                    if (constraints[0]) {\n                        let condition = constraints[0];\n                        if (condition.length == 21) {\n                            condition = condition.slice(1, 20)\n                        }\n                        if (DateUtil.isAfter(v, condition) || DateUtil.isSame(v, condition)) {\n                            return { passing: true, message: '' }\n                        } else {\n                            return { passing: false, message: message || `输入日期不能小于${condition}` }\n                        }\n                    }\n                    return { passing: true, message: '' }\n                }\n            case 'StringMaxLength':\n            case 'stringMaxLength':\n                return (v) => {\n                    if (v === null || v === undefined || v === '') {\n                        return { passing: true, message: '' }\n                    }\n                    if (constraints[0]) {\n                        if (v.length <= constraints[0]) {\n                            return { passing: true, message: '' }\n                        } else {\n                            return { passing: false, message: message || `输入值长度不能大于${constraints[0]}` }\n                        }\n                    }\n                    return { passing: true, message: '' }\n                }\n            case 'StringMinLength':\n            case 'stringMinLength':\n                return (v) => {\n                    if (v === null || v === undefined || v === '') {\n                        return { passing: true, message: '' }\n                    }\n                    if (constraints[0]) {\n                        if (v.length >= constraints[0]) {\n                            return { passing: true, message: '' }\n                        } else {\n                            return { passing: false, message: message || `输入值长度不能小于${constraints[0]}` }\n                        }\n                    }\n                    return { passing: true, message: '' }\n                }\n            case 'regex':\n                return (v) => {\n                    if (v === null || v === undefined || v === '') {\n                        return { passing: true, message: '' }\n                    }\n                    let constraintsTemp = [];\n                    if (typeof constraints[0] === 'string') {\n                        constraintsTemp = constraints[0].split(',');\n                    }\n                    for (let i = 0; i < constraintsTemp.length; i++) {\n                        if (constraintsTemp[i] === '') {\n                            return\n                        }\n                        const re = new RegExp(constraintsTemp[i]);\n                        if (re.test(v)) {\n                            return { passing: false, message: message || `存在不可输入项${constraintsTemp[i]}` }\n                        }\n                    }\n                    return { passing: true, message: '' }\n                }\n            case 'regexp':\n                return (v) => {\n                    if (v === null || v === undefined || v === '') {\n                        return { passing: true, message: '' }\n                    }\n                    const re = new RegExp(constraints[0]);\n                    if (!re.test(v)) {\n                        return { passing: false, message: message || `请输入正确格式` }\n                    }\n                    return { passing: true, message: '' }\n                }\n            case 'mobile':\n                return (v) => {\n                    if (v === null || v === undefined || v === '') {\n                        return { passing: false, message: message || `请输入正确的手机号格式` }\n                    }\n                    const regexStr = constraints[0] === true ? /^1[0-9]{10}$/ : constraints[0];\n                    const re = new RegExp(regexStr);\n                    if (!re.test(v)) {\n                        return { passing: false, message: message || `请输入正确的手机号格式` }\n                    } else {\n                        return { passing: true, message: '' }\n                    }\n                }\n            case 'email':\n                return (v) => {\n                    if (v === null || v === undefined || v === '') {\n                        return { passing: false, message: message || `请输入正确的邮箱格式` }\n                    }\n                    const regexStr = constraints[0] === true ? /^[A-Za-z0-9\\u4e00-\\u9fa5]+@[a-zA-Z0-9_-]+(\\.[a-zA-Z0-9_-]+)+$/ : constraints[0];\n                    const re = new RegExp(regexStr);\n                    if (!re.test(v)) {\n                        return { passing: false, message: message || `请输入正确的邮箱格式` }\n                    } else {\n                        return { passing: true, message: '' }\n                    }\n                }\n            case 'idCard':\n                return (v) => {\n                    if (v === null || v === undefined || v === '') {\n                        return { passing: false, message: message || `请输入正确的身份证格式` }\n                    }\n                    const regexStr = constraints[0] === true ? /^[1-9]\\d{5}(18|19|([23]\\d))\\d{2}((0[1-9])|(10|11|12))(([0-2][1-9])|10|20|30|31)\\d{3}[0-9Xx]$/ : constraints[0];\n                    const re = new RegExp(regexStr);\n                    if (!re.test(v)) {\n                        return { passing: false, message: message || `请输入正确的身份证格式` }\n                    } else {\n                        return { passing: true, message: '' }\n                    }\n                }\n            case 'customFunction':\n                return (v, context) => {\n                    if (typeof constraints[0] === 'function') {\n                        const message = constraints[0](v, context);\n                        if (!message) {\n                            return { passing: true, message: '' }\n                        } else {\n                            return { passing: false, message }\n                        }\n                    }\n                    return { passing: true, message: '' }\n                }\n            case 'expression':\n                return (value, viewModelContext, options = {}) => {\n                    const result = viewModelContext.expressionManager.validate(constraints[0], options);\n                    if (result === false) {\n                        return { passing: false, message }\n                    } else {\n                        return { passing: true, message: '' }\n                    }\n                }\n            case 'requiredExpression':\n                return (v, viewModelContext, options = {}) => {\n                    const result = viewModelContext.expressionManager.validate(constraints[0], options);\n                    if (result === true) {\n                        if (null === v || undefined === v || '' === v) {\n                            return { type, passing: false, message: message || '必填' }\n                        } else {\n                            return { type, passing: true, message: '' }\n                        }\n                    } else {\n                        return { passing: true, message: '' }\n                    }\n                }\n            case 'asyncCustomFunction':\n                return (v, context) => {\n                    if (typeof constraints[0] === 'function') {\n                        const $message = from(constraints[0](v, context));\n                        return $message.pipe(\n                            switchMap(\n                                (message) => {\n                                    if (!message) {\n                                        return of({ passing: true, message: '' })\n                                    } else {\n                                        return of({ passing: false, message })\n                                    }\n                                }\n                            )\n                        )\n\n                    }\n                    return { passing: true, message: '' }\n                }\n            default:\n                return () => {\n                    return { passing: true, message: '' }\n                }\n        }\n\n    }\n\n    /**\n     * 支持异步自定义函数\n     * 遍历生成的校验方法对当前值进行校验，当发现错误就返回校验结果\n     * 遍历完成没有错误则返回校验通过结果\n     * @param validatorFn 校验方法\n     * @param value 当前值\n     */\n    static executeValidator(validatorFn, value, context?, options?): Observable<any> {\n        let validationResult = of({ passing: true, message: '' });\n        for (let i = 0; i < validatorFn.length; i++) {\n            let result = validatorFn[i](value, context, options);\n            if (isObservable(result)) {\n                validationResult = result;\n                break;\n            }\n            if (result['passing'] === false) {\n                return of(result);\n            }\n        }\n        return validationResult;\n    }\n\n    /**\n     * 不支持异步自定义函数\n     * 遍历生成的校验方法对当前值进行校验，当发现错误就返回校验结果\n     * 遍历完成没有错误则返回校验通过结果\n     * @param validatorFn 校验方法\n     * @param value 当前值\n     */\n    static noSupportAsynExecuteValidator(validatorFn, value, context?, options?) {\n        for (let i = 0; i < validatorFn.length; i++) {\n            let validationResult = validatorFn[i](value, context, options);\n            if (isObservable(validationResult)) {\n                break;\n            }\n            if (validationResult['passing'] === false) {\n                return validationResult;\n            }\n        }\n        return { passing: true, message: '' };\n    }\n\n}\n\nexport { ValidatorFactory };","import { ViewModelContext } from '../view-model/index';\nimport { BindingType } from './types';\nimport { BindingValueConverter } from './binding_value_converter';\nimport { BindingValueAccessor, BindingValueAccessorFactory } from './binding_value_accessor';\nimport { ValidationRule, ValidatorFactory } from '../validator/index'\n\n/**\n * 表单控件配置\n */\ninterface FormControlConfig {\n  name: string;\n  bindingType: BindingType;\n  bindingPath: string;\n  valueConverter?: BindingValueConverter;\n  valueChanging?: string;\n  valueChanged?: string;\n  validRules?: ValidationRule[];\n}\n\n/**\n * FormControl定义\n */\nclass FormControl {\n\n\n  private valueAccessor: BindingValueAccessor;\n\n  private validatorFn = [];\n\n  validationResult: any;\n\n  required = false;\n\n  private requiredExpressionFlag = false;\n  private validateExpressionFlag = false;\n\n  readonly = false;\n\n  visible = true;\n\n  // 初始验证规则\n  private validRules = [];\n\n  // 记忆验证表达式的规则\n  private validRules_validates = [];\n\n  constructor(config: FormControlConfig, viewModelContext: ViewModelContext) {\n    this.valueAccessor = BindingValueAccessorFactory.create(\n      config.bindingType,\n      config.bindingPath,\n      config.valueConverter,\n      viewModelContext\n    );\n    this.validRules = [];\n    if (config.validRules) {\n      this.validRules = config.validRules;\n      this.setValidatorFn(config.validRules)\n    }\n  }\n\n  public get value() {\n    return this.valueAccessor.getValue();\n  }\n\n  public set value(val) {\n    this.valueAccessor.setValue(val);\n  }\n\n  public getValidRules() {\n    return this.validRules;\n  }\n\n  public setValidatorFn(validRules) {\n    this.validatorFn = ValidatorFactory.create(validRules)\n  }\n\n  public pushValidatorFnforValidate(validRules, flag) {\n    if (flag && this.validateExpressionFlag) {\n      return\n    }\n    this.validateExpressionFlag = flag;\n    this.validRules_validates = validRules;\n    this.validatorFn = this.validatorFn.concat(ValidatorFactory.create(validRules));\n  }\n\n  public pushValidatorFnforRequired(validRules, flag) {\n    if (flag && this.requiredExpressionFlag) {\n      return\n    }\n    this.requiredExpressionFlag = flag;\n    this.validatorFn = this.validatorFn.concat(ValidatorFactory.create(validRules));\n  }\n\n  public resetValidatorFnforRequired() {\n    this.requiredExpressionFlag = false;\n    this.validatorFn = ValidatorFactory.create(this.validRules.concat(this.validRules_validates))\n  }\n\n  public getValidatorFn() {\n    return this.validatorFn;\n  }\n\n}\n\nexport { FormControlConfig, FormControl };\n","import { MetadataUtil } from '../core/index';\nimport { ViewModelContext } from '../view-model/index';\nimport { FormControlConfig, FormControl } from './form_control';\nimport { FormControlMetadata, FORM_CONTROL_PROP_META } from './decorators';\nimport { of, Subject } from 'rxjs';\nimport { ValidatorFactory } from '../validator'\nimport { map, tap } from 'rxjs/operators';\n\n/**\n * Form抽象类\n */\nabstract class Form {\n\n  /**\n   * 表单控件配置\n   */\n  private formControlConfigs: FormControlConfig[];\n\n  /**\n   * ViewModel上下文\n   */\n  private viewModelContext: ViewModelContext;\n\n  private validateformControls: string[];\n\n  private validateformControlPathMap: Map<string, string>;\n\n  public changes: Subject<any>;\n\n  /**\n   * 构造函数\n   */\n  constructor(viewModelContext: ViewModelContext) {\n    this.viewModelContext = viewModelContext;\n    this.formControlConfigs = [];\n    this.validateformControls = [];\n    this.validateformControlPathMap = new Map;\n    this.changes = new Subject();\n  }\n\n  /**\n   * 初始化\n   */\n  public init() {\n    this.collectMetadatas();\n    this.createFormControls();\n  }\n\n  /**\n   * 使用不包含绝对路径的/或者/子表/的路径信息获取对应的formControlConfig的name属性与bindingPath并且返回该路径的formControl\n   * @param path 路径信息 \n   * @returns  \n   */\n  getFormValueByBindPath(path) {\n    let formControl = {\n      form_name: {},\n      name: '',\n      bindingPath: ''\n    };\n    path = path.replace(/\\//g, '.')\n    if (this.formControlConfigs.length === 0) return formControl;\n    this.formControlConfigs.forEach((formControlConfig: FormControlConfig) => {\n      if (formControlConfig.bindingPath === path) {\n        formControl.form_name = this[formControlConfig.name];\n        formControl.name = formControlConfig.name;\n        formControl.bindingPath = formControlConfig.bindingPath;\n      }\n    })\n    return formControl;\n  }\n  /**\n   * \n   * @returns 获取当前表单上的存在校验字段的集合\n   */\n  getValidateformControls() {\n    return this.validateformControls;\n  }\n\n  setValidateformControls(name) {\n\n    if (this.validateformControls && this.validateformControls.length === 0) {\n      this.validateformControls.push(name)\n    }\n\n    if (this.validateformControls && this.validateformControls.length >= 1) {\n      const index = this.validateformControls.findIndex(item => item == name);\n      if (index === -1) {\n        this.validateformControls.push(name)\n      }\n    }\n\n    if (!Array.isArray(this.validateformControls)) {\n      this.validateformControls = [name]\n    }\n  }\n\n  getValidateformControlPathMap() {\n    return this.validateformControlPathMap;\n  }\n\n  setValidateformControlPathMap(name, value) {\n    if (!this.validateformControlPathMap.has(name)) {\n      this.validateformControlPathMap.set(name, value)\n    }\n  }\n\n  /**\n   * 使用formControlConfig的bindingPath路径信息与对应formControlConfig的name信息储存起来作为验证信息在form上的记录\n   * @param path formControlConfig的bindingPath路径信息\n   * @param name 对应formContro的name信息\n   */\n  addValidate(path, name) {\n    let bindingPath = this.viewModelContext.bindingData.bindingPath.slice(1).replace(/\\//g, '.');\n    if (bindingPath) { bindingPath = bindingPath + '.' };\n    this.setValidateformControlPathMap(bindingPath + path, name);\n    this.setValidateformControls(name)\n  }\n\n\n  /**\n   * 全部校验 \n   *  formControlConfigs 上所有的formControl的存在方法调用一遍 将错误信息集中返回\n   */\n  validateFields() {\n    let validationResult = [];\n    if (this.validateformControls.length === 0) { return validationResult; }\n    this.validateformControls.forEach((formControl) => {\n      const result$ = ValidatorFactory.executeValidator(this[formControl]['validatorFn'], this[formControl]['value'], this.viewModelContext).pipe(\n        tap(\n          (message) => {\n            this[formControl]['validationResult'] = message;\n            !message['passing'] && this.changes.next({ type: 'validateFieldsFinished' })\n          }\n        )\n      )\n      validationResult.push(result$)\n    });\n    return validationResult;\n  }\n\n  /**\n   * 不支持自定义异步全部校验 \n   *  formControlConfigs 上所有的formControl的存在方法调用一遍 将错误信息集中返回\n   */\n  noSupportAsynValidateFields() {\n    let validationResult = [];\n    if (this.validateformControls.length === 0) { return validationResult; }\n    this.validateformControls.forEach((formControl) => {\n      if (!this[formControl]['validationResult']) {\n        this[formControl]['validationResult'] = ValidatorFactory.noSupportAsynExecuteValidator(this[formControl]['validatorFn'], this[formControl]['value'], this.viewModelContext);\n      }\n      !this[formControl]['validationResult'].passing && validationResult.push(this[formControl])\n    });\n    this.changes.next({ type: 'validateFieldsFinished' })\n    return validationResult;\n  }\n\n  /**\n   * 获取某一个得校验错误信息\n   * @param name 属性名称\n   */\n  getFieldError(name: string) {\n    if (this.validateformControls.length === 0) {\n      return {}\n    }\n    const index = this.validateformControls.findIndex((item) => {\n      return item === name\n    });\n    if (index === -1) {\n      return {}\n    } else {\n      const result$ = ValidatorFactory.executeValidator(this[name]['validatorFn'], this[name]['value'], this.viewModelContext).pipe(\n        tap(\n          (message) => {\n            this[name]['validationResult'] = message;\n            !message['passing'] && this.changes.next({ type: 'validateFieldsFinished' })\n          }\n        )\n      )\n      return result$;\n    }\n  }\n\n  /**\n * 根据form元数据中的path获取某一个得校验错误信息\n * @param path 属性名称数组\n */\n  getFieldErrorByPath(path: string[]) {\n    if (this.validateformControls.length === 0) {\n      return {}\n    }\n    let pathName = path[0]\n    if (path && path.length >= 2) {\n      pathName = path.join('.');\n    }\n    const index = this.validateformControlPathMap.has(pathName);\n    if (!index) {\n      return {}\n    } else {\n      ValidatorFactory.executeValidator(this[this.validateformControlPathMap.get(pathName)]['validatorFn'], this[this.validateformControlPathMap.get(pathName)]['value'], this.viewModelContext).subscribe(\n        (message) => {\n          this[this.validateformControlPathMap.get(pathName)]['validationResult'] = message;\n          this.changes.next({ type: 'validateFieldsFinished', value: this.validateformControlPathMap.get(pathName) });\n        }\n      )\n      return this[this.validateformControlPathMap.get(pathName)]['validationResult'];\n    }\n  }\n\n  /**\n   * 清除一组字段验证状态\n   * @param fields 字段的数组\n   */\n  resetFieldsValidate(fields?: string[]) {\n    if (this.validateformControls.length === 0) {\n      return true;\n    } else {\n      if (fields && fields.length > 0) {\n        const sb = new Set(fields);\n        // 交集\n        const intersect = this.validateformControls.filter(x => sb.has(x));\n        // 遍历清空所有校验结果数据\n        intersect.forEach(item => {\n          this[item]['validationResult'] = undefined;\n        })\n      } else {\n        // 没传数据全部清除\n        this.validateformControls.forEach(item => {\n          this[item]['validationResult'] = undefined;\n        })\n      }\n      this.changes.next({ type: 'validateFieldsFinished' })\n    }\n  }\n\n  /**\n   * 创建FormControls\n   */\n  private createFormControls() {\n    this.formControlConfigs.forEach((formControlConfig: FormControlConfig) => {\n      const name = formControlConfig.name;\n      const formControl = new FormControl(formControlConfig, this.viewModelContext);\n      this[name] = formControl;\n    });\n  }\n\n  /**\n   * 收集元数据\n   */\n  private collectMetadatas() {\n    const formControlMetadatas = MetadataUtil.getPropsMetadatasByName(this.constructor, FORM_CONTROL_PROP_META);\n    let bindingPath = this.viewModelContext.bindingData.bindingPath.slice(1).replace(/\\//g, '.');\n    const validationManager = this.viewModelContext.appContext['validationManager'];\n    if (bindingPath) { bindingPath = bindingPath + '.' };\n    Object.keys(formControlMetadatas).forEach((name: string) => {\n      const formControlMetadata = formControlMetadatas[name] as FormControlMetadata;\n      let validRules = null;\n      if (formControlMetadata.validRules) {\n        this.validateformControls.push(name);\n        this.validateformControlPathMap.set(bindingPath + formControlMetadata.bindingPath, name);\n        validRules = formControlMetadata.validRules;\n      }\n      const key = ('/'+bindingPath+formControlMetadata.bindingPath).replace(/\\./g, '/')\n      if(validationManager[key]){\n        if(!validRules){\n          this.validateformControls.push(name);\n          this.validateformControlPathMap.set(bindingPath + formControlMetadata.bindingPath, name);\n          validRules = Object.values(validationManager[key]);\n        }else{\n          validRules = validRules.concat(Object.values(validationManager[key]))\n        }\n      }\n      const formControlConfig: FormControlConfig = {\n        name: name,\n        bindingType: formControlMetadata.bindingType,\n        bindingPath: formControlMetadata.bindingPath,\n        valueConverter: formControlMetadata.valueConverter,\n        valueChanging: formControlMetadata.valueChanging,\n        valueChanged: formControlMetadata.valueChanged,\n        validRules: validRules\n      };\n      this.formControlConfigs.push(formControlConfig);\n    });\n  }\n\n  public getEntityValueChangingListeners(): { [property: string]: string } {\n    const listeners = {};\n    this.formControlConfigs.forEach((formControl: FormControlConfig) => {\n      if (formControl.valueChanging) {\n        listeners[formControl.bindingPath] = formControl.valueChanging;\n      }\n    });\n    return listeners;\n  }\n\n  public getEntityValueChangedListeners(): { [property: string]: string } {\n    const listeners = {};\n    this.formControlConfigs.forEach((formControl: FormControlConfig) => {\n      if (formControl.valueChanged) {\n        listeners[formControl.bindingPath] = formControl.valueChanged;\n      }\n    });\n    return listeners;\n  }\n}\n\nexport { Form };\n","import { makePropDecorator } from '../core/index';\nimport { CommandParams, ParamDescriptions,  } from '../command/index';\n\n/**\n * 快捷键\n */\nexport interface Keybinding {\n  readonly ctrlKey: boolean;\n  readonly shiftKey: boolean;\n  readonly altKey: boolean;\n  readonly metaKey?: boolean;\n  readonly key: string;\n}\n\n/**\n * 命令描述\n */\nexport interface CommandMethodMetadata {\n\n  /**\n   * 命令名称\n   */\n  name: string;\n\n  /**\n   * 命令参数\n   */\n  params?: CommandParams;\n\n  /**\n   * 框架id\n   * 通过frameId确定命令执行的上下文，不指定则默认为当前Frame。\n   */\n  frameId?: string;\n\n  /**\n   * 参数描述，目前描述类型，后续可兼容精度等其他信息。\n   */\n  paramDescriptions?: ParamDescriptions;\n\n  /**\n   * 快捷键绑定\n   */\n  keyBinding?: Keybinding;\n}\n\n\n/**\n * 命令装饰器名称\n */\nexport const COMMAND_METHOD_META = 'CommandMethodMeta';\n\n/**\n * 命令装饰接口\n */\nexport interface CommandMethodMetaDecorator {\n  (ngCommand?: CommandMethodMetadata): any;\n  new(ngCommand?: CommandMethodMetadata): any;\n}\n\n/**\n * 命令装饰器工厂\n */\nexport const CommandMethodMeta: CommandMethodMetaDecorator =\n  makePropDecorator(COMMAND_METHOD_META, (obj: CommandMethodMetadata) => obj);\n","import { InjectionToken } from '../../core/index';\n\nexport interface IResolver {\n  resolve(expr: string): string[];\n}\nexport const RESOLVER_TOKEN = new InjectionToken('@farris_resolver_token');\nexport const ENTITY_TEMPLATE = 'ENTITY~';\nexport const STATE_TEMPLATE = 'STATE~';\nexport const GROUP_FUNCTIONS = ['SumByProp', 'CountByProp', 'AvgByProp', 'MaxByProp', 'MinByProp', 'IsExistRecord', 'ListContains', 'ListGreaterThan', 'ListLessThan', 'ListStartWith', 'ListEndWith'];","import { IResolver, RESOLVER_TOKEN } from './types';\nimport { ViewModelContext } from '../../view-model/index';\n\nexport class ResolverRegistry{\n\n  public resolvers: Array<IResolver>\n\n  constructor(private viewModelContext: ViewModelContext){\n    this.resolvers = this.viewModelContext.injector.get(RESOLVER_TOKEN, []) as Array<IResolver>;\n  }\n}","import { DataTypeInfo } from '../../entity/index';\nimport { Repository } from '../../repository/index';\nimport { ExpressionUtil } from '../utils/expression_util';\nimport { ENTITY_TEMPLATE, GROUP_FUNCTIONS, IResolver } from './types';\nimport { ViewModelContext } from '../../view-model/index';\n\n\nexport class EntityDependencyResolver implements IResolver {\n\n  private repository: Repository<any>;\n\n  private entityTypeInfo: DataTypeInfo;\n\n  constructor(private viewModelContext: ViewModelContext) {\n    this.repository = this.viewModelContext.repository;\n    this.entityTypeInfo = this.repository.entityTypeInfo;\n  }\n\n  /**\n   * 解析用户表达式中的实体依赖\n   * @param expr 用户配置的完整表达式\n   * @returns \n   */\n  public resolve(expr: string): string[] {\n    const groupFunctionDependencies = ExpressionUtil.getGroupFunctionDependency(expr, this.repository.entityTypeInfo);\n    const entityDependencies = this.getEntityDependency(expr);\n    // 去除错误的到子表的依赖\n    if (groupFunctionDependencies && groupFunctionDependencies.length > 0 && entityDependencies && entityDependencies.length > 0) {\n      groupFunctionDependencies.forEach((dep: string) => {\n        const index = entityDependencies.findIndex(item => dep.startsWith(item));\n        if (index !== -1) {\n          entityDependencies.splice(index, 1);\n        }\n      });\n    }\n    // 去重\n    const merged = [...groupFunctionDependencies, ...entityDependencies];\n    const deps = [...new Set(merged)];\n    return deps;\n  }\n  /**\n   * 获取合法的实体属性表达式\n   * @param entityPropertyExpression 实体属性表达式\n   * @returns \n   */\n  private getValidEntityPropertyExpression(entityPropertyExpression: string): string[] {\n    const propPaths = entityPropertyExpression.split('.');\n    let propInfo = null;\n    try {\n      propInfo = this.entityTypeInfo.getPropInfoByPath(propPaths);\n    } catch (e) { }\n    if (!propInfo) {\n      if (propPaths.length > 1) {\n        propPaths.pop();\n        return this.getValidEntityPropertyExpression(propPaths.join('.'));\n      } else {\n        return null;\n      }\n    } else {\n      return entityPropertyExpression.split('.');\n    }\n  }\n  /**\n   * 获取所有实体依赖\n   * @param expr 表达式字符串\n   * @returns \n   */\n  private getEntityDependency(expr: string): string[] {\n    const deps = [];\n    if (this.entityTypeInfo) {\n      // 使用正则匹配出所有实体\n      const regex = new RegExp(`[\\\\'\\\\\"]?\\\\s*(${this.entityTypeInfo.entityInfo.nodeCode}|${this.entityTypeInfo.entityInfo.originalCode})[\\\\.\\\\[\\\\]a-zA-Z0-9_]+\\\\s*[\\\\'\\\\\"]?`, 'g');\n      const entityPropertyExpressions: RegExpMatchArray = expr.match(regex);\n      if (Array.isArray(entityPropertyExpressions) && entityPropertyExpressions.length > 0) {\n        // 解析出所有实体相关的字符串，以主实体名字开头，包含主实体属性或子表\n        entityPropertyExpressions.forEach((item: string) => {\n          if (item.indexOf('.') === -1) {\n            console.warn(`无效的实体表达式:${item}`);\n            return;\n          }\n          // 去空格\n          item = item.trim().replace(/\\\"/g, '');\n          const paths = ExpressionUtil.convertToNodeCode(item, this.repository.entityTypeInfo);\n          item = paths.join('.');\n          // 截去主实体及点\n          item = item.substr(item.indexOf('.') + 1);\n          const dep = this.getValidEntityPropertyExpression(item);\n          if (dep && Array.isArray(dep) && dep.length > 0) {\n            // 此处必须加上主实体的名字来区分依赖的是实体还是其他类型的数据\n            dep.splice(0, 0, ENTITY_TEMPLATE);\n            deps.push(dep.join('/'));\n          }\n        });\n      }\n    } else {\n      console.warn(`获取实体类型信息失败，请重新编译改表单。`);\n    }\n    return deps;\n  }\n\n}","import { ViewModelContext } from '../../view-model/index';\nimport { IResolver } from \"./types\";\n\nconst CONTEXT_FUNCTIONS = ['GetContextParameter', 'GetSessionValue'];\n\nexport class StateDependencyResolver implements IResolver {\n\n  constructor(private viewModelContext: ViewModelContext) {\n  }\n\n  public resolve(expr: string): string[] {\n    const deps = [];\n    const regex = new RegExp(`DefaultFunction\\\\.(${CONTEXT_FUNCTIONS.join('|')})\\\\s*\\\\([^\\\\r\\\\n\\\\)]*\\\\)`, 'g');\n    const contextFunctions: RegExpMatchArray = expr.match(regex);\n    if (contextFunctions && contextFunctions.length > 0) {\n      // todo: 使用正则匹配时可能会因为参数中有逗号导致问题，后续使用ast解析\n      const argumentsRegex = /\\(([^\\r\\n\\)]*)\\)/;\n      contextFunctions.forEach((groupFunction: string) => {\n        const argumentMatchResult = groupFunction.match(argumentsRegex);\n        if (argumentMatchResult.length === 2) {\n          const argument = argumentMatchResult[1].trim().replace(/\\\"/g,'');\n          const dep = ['STATE~'];\n          dep.push(argument);\n          deps.push(dep.join('/'));\n        }\n      });\n    }\n    return deps;\n  }\n\n}","import { IResolver } from \"./types\";\n\n/**\n * 用户自定义参数解析器\n */\nexport class CommentDependencyResolver implements IResolver {\n\n  public resolve(expr: string): string[] {\n    const dependencies = [];\n    if (!expr || expr.length < 1) {\n      return dependencies;\n    }\n    const defineRegex = /\\/\\*\\*\\s*__define__\\((.*)\\)\\s*\\*\\//;\n    const defineMatchArray: RegExpMatchArray = expr.match(defineRegex);\n    if (defineMatchArray && defineMatchArray.length === 2) {\n      const defineString: string = defineMatchArray[1].trim();\n      let defineObject = null;\n      try {\n        defineObject = JSON.parse(defineString);\n      } catch (e) { console.warn(`自定义依赖解析失败：${defineString}`); }\n      if (defineObject && defineObject.hasOwnProperty('deps') && Array.isArray(defineObject['deps'])) {\n        dependencies.push(...defineObject['deps']);\n      }\n    }\n    return dependencies;\n  }\n\n}","import { CommentDependencyResolver } from \"./comment_dependency_resolver\";\nimport { ResolverRegistry } from \"./resolver_registry\";\nimport { IResolver } from \"./types\";\nimport { ViewModelContext } from '../../view-model/index';\n\nexport class ResolveService {\n\n  private resolverRegistry: ResolverRegistry;\n\n  constructor(private viewModelContext: ViewModelContext) {\n    this.resolverRegistry = this.viewModelContext.injector.get<ResolverRegistry>(ResolverRegistry);\n  }\n\n  public resolve(expression: string) {\n    const deps: string[] = [];\n    if (!this.resolverRegistry || !this.resolverRegistry.resolvers || this.resolverRegistry.resolvers.length < 1) {\n      return;\n    }\n    // 优先使用用户自定义的依赖\n    const commentDependencyResolver = this.resolverRegistry.resolvers.find((resolver: IResolver) => resolver instanceof CommentDependencyResolver);\n    if (commentDependencyResolver) {\n      const commentDependencies = commentDependencyResolver.resolve(expression);\n      if (commentDependencies && Array.isArray(commentDependencies) && commentDependencies.length > 0) {\n        deps.push(...commentDependencies);\n      }\n    }\n    // 如果用户已经自定义了依赖，则不再计算\n    if (deps && deps.length > 0) {\n      return;\n    }\n    this.resolverRegistry.resolvers.forEach((resolver: IResolver) => {\n      // 再解析一次也可以，返回的依然是空数组\n      if (resolver instanceof CommentDependencyResolver) {\n        return;\n      }\n      const dependency = resolver.resolve(expression);\n      if (dependency && dependency.length > 0) {\n        deps.push(...dependency);\n      }\n    });\n    // 去重\n    return [...new Set(deps)];\n  }\n\n}","import { BindingData, BindingList } from \"../../binding-data/index\";\nimport { DataPropGroup, DataPropInfo, DataTypeInfo } from \"../../entity/index\";\nimport { ENTITY_TEMPLATE, GROUP_FUNCTIONS } from \"../resolver/index\";\n\nexport class ExpressionUtil {\n  public static getGroupFunctionDependency(expr: string, entityTypeInfo: DataTypeInfo): string[] {\n    const deps = [];\n    // 获取聚合函数依赖项\n    const groupFunctionRegex = new RegExp(`DefaultFunction\\\\.(${GROUP_FUNCTIONS.join('|')})\\\\s*\\\\([^\\\\r\\\\n\\\\)]*\\\\)`, \"g\");\n    const groupFunctions: RegExpMatchArray = expr.match(groupFunctionRegex);\n    if (groupFunctions && groupFunctions.length > 0) {\n      // todo: 使用正则匹配时可能会因为参数中有逗号导致问题，后续使用ast解析\n      const argumentsRegex = /\\(([^\\r\\n\\)]*)\\)/;\n      groupFunctions.forEach((groupFunction: string) => {\n        const argumentMatchResult = groupFunction.match(argumentsRegex);\n        if (argumentMatchResult.length === 2) {\n          const argument = argumentMatchResult[1];\n          const args = argument.split(',').map(p => p.replace(/\\\"/g, ''));\n          if (args && args.length === 2) {\n            let item: any = args.join('.');\n            item = this.convertToNodeCode(item, entityTypeInfo).join('.');\n            item = item.substr(item.indexOf('.') + 1);\n            const dep = item.split('.');\n            dep.splice(0, 0, ENTITY_TEMPLATE);\n            deps.push(dep.join('/'));\n          } else {\n            throw new Error(`无法解析参数： ${JSON.stringify(argument)}`);\n          }\n        }\n      });\n    }\n    return deps;\n  }\n  /**\n   * 将voCode转换为前端nodeCode\n   * @param entityExpression like Entity.Child.p1\n   * @returns \n   */\n  public static convertToNodeCode(entityExpression: string, entityTypeInfo: DataTypeInfo): string[] {\n    // UserEntity.storys.p1\n    const nodeCodes = [];\n    if (entityTypeInfo && entityExpression.includes('.')) {\n      const entityExpressions = entityExpression.split('.') || [];\n      let dataTypeInfo = entityTypeInfo;\n      for (let index = 0; index < entityExpressions.length; index++) {\n        const prop = entityExpressions[index];\n        if (dataTypeInfo && dataTypeInfo.entityInfo && dataTypeInfo.entityInfo.nodeCode === prop || dataTypeInfo.entityInfo.originalCode === prop) {\n          // 第一个是主表code，不能转nodeCode\n          if (index === 0) {\n            nodeCodes.push(dataTypeInfo.entityInfo.originalCode);\n          } else {\n            nodeCodes.push(dataTypeInfo.entityInfo.nodeCode);\n          }\n\n          // 下一级可能为子表、对象或属性\n          const nextNodeCode = entityExpressions[index + 1];\n          if (!nextNodeCode) {\n            break;\n          }\n          const nextNodeCodePropInfo = dataTypeInfo.getPropInfoByName(nextNodeCode);\n          if (!nextNodeCodePropInfo) {\n            break;\n          }\n          // 下一级为子表或对象\n          if (nextNodeCodePropInfo.typeInfo) {\n            dataTypeInfo = nextNodeCodePropInfo.typeInfo;\n          }\n        } else if (dataTypeInfo && dataTypeInfo.getPropInfoByName(prop)) {\n          const dataPropInfo = dataTypeInfo.getPropInfoByName(prop);\n          nodeCodes.push(dataPropInfo.name);\n        } else {\n          //throw new Error(`错误的属性参数 ${entityExpression}`);\n          break;\n        }\n      }\n    }\n    return nodeCodes;\n  }\n  /**\n   * 找到元数据中所有实体路径\n   * @param dataTypeInfo \n   * @param results \n   * @param paths \n   */\n  public static getChildrenEntityPaths(dataTypeInfo: DataTypeInfo, results: any[], paths: string[] = []) {\n    const list: DataPropInfo[] = dataTypeInfo.getPropInfosByGroup(DataPropGroup.List);\n    if (list && list.length > 0) {\n      list.forEach((dataPropInfo: DataPropInfo) => {\n        if (paths.length === 0) {\n          results.push([dataPropInfo.name]);\n        }\n        const childrens: DataPropInfo[] = dataPropInfo.typeInfo.getPropInfosByGroup(DataPropGroup.List);\n        if (childrens && childrens.length > 0) {\n          paths.push(dataPropInfo.name);\n          childrens.forEach((dataPropInfo: DataPropInfo) => {\n            this.getChildrenEntityPaths(dataPropInfo.typeInfo, results, paths);\n          });\n        } else {\n          if (paths.length !== 0) {\n            paths.push(dataPropInfo.name);\n            results.push([...paths]);\n          }\n          paths.length = 0;\n        }\n      });\n    } else {\n      if (paths.length > 0) {\n        paths.push(dataTypeInfo.entityInfo.nodeCode);\n        results.push([...paths]);\n      }\n      paths.length = 0;\n    }\n  }\n  /**\n   * 获取指定绑定路径的当前行数据\n   * @param paths 绑定路径\n   * @param bindingData \n   * @returns \n   */\n  public static getCurrentRowByPaths(paths: string[], bindingData: BindingData): null | { [prop: string]: any } {\n    let result = null;\n    const bindingList: BindingList = bindingData.getValue(paths) as BindingList;\n    if (bindingList && bindingList.length > 0) {\n      let primaryValue = bindingList.currentItem.primaryKeyValue || null;\n      // 使用事件中的主键\n      // 主表或下级表新增，此时事件行就是当前行，无需处理\n      if (primaryValue) {\n        const bindingObject = bindingList.findById(primaryValue);\n        if (bindingObject) {\n          result = bindingObject.toJSON();\n        }\n      }\n    }\n    return result;\n  }\n  /**\n   * 从实体路径中获取级数最大的从表或从从表\n   * @param paths \n   * @returns \n   */\n  public static getAvailableChildrenPathsFromEntityPaths(paths: string[], entityTypeInfo: DataTypeInfo): string[] {\n    let nodeCodes = [];\n    paths = [...paths];\n    while (paths.length > 0) {\n      const dataPropInfo = entityTypeInfo.getPropInfoByPath(paths);\n      if (dataPropInfo.group === 'List') {\n        nodeCodes = paths;\n        break;\n      }\n      paths.pop();\n    }\n    return nodeCodes;\n  }\n  /**\n   * 从路径中获取绑定路径\n   * @param paths 路径\n   * @param entityTypeInfo entityTypeInfo\n   * @returns \n   */\n  public static getBindingPath(paths: string[], entityTypeInfo: DataTypeInfo) {\n    paths = this.getEntityPath(paths);\n    const entityPaths = this.getAvailableChildrenPathsFromEntityPaths(paths, entityTypeInfo);\n    return entityPaths;\n  }\n  public static getEntityPath(path: string[]): string[] {\n    const paths = path.filter((value: string, index: number) => {\n      if (index % 2 === 0 && value.includes(':')) {\n        return false;\n      } else {\n        return true;\n      }\n    });\n    return paths;\n  }\n}","export class Core {\n  public static warn(message?: any, ...optionalParams: any[]) {\n    this.logable() && console && console.warn(message, ...optionalParams);\n  }\n  public static error(message?: any, ...optionalParams: any[]) {\n    this.logable() && console && console.error(message, ...optionalParams);\n  }\n  public static log(message?: any, ...optionalParams: any[]) {\n    this.logable() && console && console.log(message, ...optionalParams);\n  }\n  private static logable(): boolean {\n    return window && window.localStorage && window.localStorage.getItem('__DEVKIT_LOGABLE__') === 'true' || false;\n  }\n}","import { InjectionToken } from '../../core/index';\nimport { IMessageService, INotifyService } from './types';\n\nexport const FORM_PATH_TOKEN = new InjectionToken<string>('@farris/devkit form path token');\n\nexport const BACK_END_MESSAGE_HANDLER_TOKEN = new InjectionToken<string>('@farris/devkit_back_end_message_handler');\nexport const MESSAGE_SERVICE_TOKEN = new InjectionToken<IMessageService>('@farris/message_service_token');\nexport const NOTIFY_SERVICE_TOKEN = new InjectionToken<INotifyService>('@farris/notify_service_token');\n\n\nexport const NAMESPACE = new InjectionToken<string>('@farris/devkit NAMESPACE');","import { AppContext } from '../../app/index';\n\n// export type ClassType = new (...args: any[]) => any;\nexport const BigNumberType = 'BigNumber';\n\n/**\n * 后端消息\n */\n// tslint:disable-next-line: no-namespace\nexport namespace BackEndMessage {\n  /**\n   * 消息级别\n   */\n  export enum Level {\n    Error = 'Error',\n    Info = 'Info',\n    Warning = 'Warning'\n  }\n  /**\n   * 后端消息对象\n   */\n  export interface IMessage {\n    context: IMessageContext;\n    bizMessages: IBizMessage[];\n  }\n  /**\n   * 消息位置\n   */\n  export interface ILocation {\n    /**\n     * 表名\n     */\n    nodeCode: string;\n    /**\n     * 对应的行\n     */\n    rows?: string[];\n    /**\n     * 对应的列\n     */\n    columns?: string[];\n  }\n  /**\n   * 消息结构\n   */\n  export interface IBizMessage {\n    /**\n     * 消息位置\n     */\n    location?: ILocation;\n    /**\n     * 消息内容\n     */\n    message: string;\n    /**\n     * 消息级别\n     */\n    level: Level;\n  }\n  /**\n   * 消息上下文\n   */\n  export interface IMessageContext {\n    ns: string;\n    appContext: AppContext;\n  }\n  /**\n   * 消息\n   * @description 接口执行成功，但有info/warning级别的消息\n   */\n  export class Message implements IMessage {\n    public context: IMessageContext;\n    public bizMessages: IBizMessage[];\n    constructor(bizMessages: IBizMessage[], context: IMessageContext) {\n      this.bizMessages = bizMessages;\n      this.context = context;\n    }\n  }\n  /**\n   * 消息处理程序\n   */\n  export interface IBackEndMessageHandler {\n    handle(message: IMessage, context?: any);\n  }\n}\n\nexport interface IMessageService {\n  /**\n   * 提示\n   * @param message \n   */\n  info(message: string);\n  /**\n   * 错误\n   * @param message \n   */\n  error(message: string);\n  /**\n   * 警告\n   * @param message \n   */\n  warning(message: string);\n}\n\nexport interface INotifyService {\n  /**\n   * 提示\n   * @param message \n   * @param options \n   */\n  info(message: string, options?: { [prop: string]: any });\n  /**\n   * \n   * @param content 成功提示\n   * @param options \n   */\n  success(content: string, options?: { [prop: string]: any });\n  /**\n   * 警告提示\n   * @param content \n   */\n  warning(content: string);\n  /**\n   * 错误提示\n   * @param content \n   * @param options \n   */\n  error(content: string, options?: { [prop: string]: any });\n}","import { Observable } from 'rxjs';\n\n// tslint:disable-next-line: no-namespace\nexport namespace Expression {\n  /**\n   * 表达式对象\n   */\n  export interface ExpressionObject {\n    /**\n     * 表达式唯一标识\n     */\n    id?: string;\n    /**\n     * 表达式绑定的路径\n     */\n    path: string;\n    /**\n     * 表达式绑定类型State|Entity\n     */\n    bindingType: ExpressionBindingType;\n    /**\n     * 表达式类型\n     */\n    type: ExpressionType;\n    /**\n     * 表达式\n     */\n    expression: string;\n    /**\n     * 表达式依赖\n     */\n    deps: Array<string>;\n    /**\n     * 表达式namespace\n     */\n    ns: string;\n    /**\n     * 表达式计算结果\n     */\n    result?: any;\n    /**\n     * 结果作用路径\n     */\n    effectPaths?: string[],\n    /**\n     * 提示信息\n     */\n    message?: string;\n    /**\n     * 提示消息类型\n     */\n    messageType?: 'error' | 'info' | 'warning';\n    /**\n     * \n     */\n    factory?: any;\n\n    /**\n     * 视图模型id\n     */\n    viewModelId?: string;\n\n    /**\n     * 事件类型\n     */\n    eventType?: EventType\n  }\n\n  /**\n   * 自定义上下文 \n   */\n  export interface ICustomContext {\n    currentRows?: Array<ICurrentRow>,\n    contexts?: { [prop: string]: any },\n    patch?: { [prop: string]: any }\n  }\n\n  /**\n   * 当前行描述\n   */\n  export interface ICurrentRow {\n    bindingPath: string;\n    primaryValue: string;\n  }\n\n  /**\n   * 表达式赋值器\n   * @deprecated deprecated，never use\n   */\n  export interface Assigner {\n    assign(expressionObject: ExpressionObject);\n  }\n  /**\n   * 表达式执行器\n   */\n  export interface IExecutor {\n    compile(expressionObject: Expression.ExpressionObject, context?: { [prop: string]: any }): any;\n  }\n  /**\n   * 表达式绑定字段类型（表达式绑定到实体、UIState?）\n   */\n  export enum ExpressionBindingType {\n    State = 'State',\n    Field = 'Field'\n  }\n  /**\n   * 表达式类型\n   */\n  export enum ExpressionType {\n    /**\n     * 必填表达式\n     */\n    Required = 'require',\n    /**\n     * 只读表达式\n     */\n    Readonly = 'readonly',\n    /**\n     * 计算表达式\n     */\n    Compute = 'compute',\n    /**\n     * 依赖表达式\n     */\n    Dependency = 'dependency',\n    /**\n     * 是否可见\n     */\n    Visible = 'visible',\n    /**\n     * 关联表达式\n     */\n    Relative = 'relative',\n    /**\n     * 校验表达式\n     */\n    Validate = 'validate',\n    /**\n     * 帮助前\n     */\n    DataPicking = 'dataPicking'\n  }\n  /**\n   * 事件类型\n   */\n  export enum EventType {\n    ValueChanged = 'VALUE_CHANGED',\n    SelectionChanged = 'SELECTION_CHANGED',\n    Load = 'Load',\n    Append = 'Append',\n    Remove = 'Remove',\n    Update = 'Update',\n  }\n  export enum EventSource {\n    Field = 'Field',\n    State = 'State',\n    BindingData = 'BindingData',\n    Repository = 'Repository'\n  }\n  /**\n   * 事件参数\n   */\n  export interface EventArgs {\n    /**\n     * namespace\n     */\n    ns: string;\n    /**\n     * 变更路径\n     */\n    path: Array<string>;\n    /**\n     * 变更类型\n     */\n    type?: EventType;\n    /**\n     * 变更来源\n     */\n    source: EventSource;\n    /**\n     * 变更后的值\n     */\n    value?: any;\n    /**\n     * 上下文\n     */\n    context?: any;\n    /**\n     * frameId\n     */\n    frameId?: string;\n    /**\n     * 事件数据上下文\n     */\n    entity?: any;\n    id?: any;\n  }\n  /**\n   * 监听器\n   */\n  export interface Listener {\n    onEvent: Observable<EventArgs>;\n  }\n  /**\n   * 作用器\n   */\n  export interface Effector {\n    /**\n     * namespace\n     */\n    ns: string;\n    /**\n     * 作用\n     * @param expressionObject \n     */\n    effect(path: string, value: any, options: EffectOptions);\n  }\n  export interface EffectOptions {\n    /**\n     * 指定行\n     */\n    path?: string[];\n    /**\n     * frameId\n     */\n    frameId?: string;\n    /**\n     * 消息\n     */\n    message?: string;\n    /**\n     * 消息提示类型\n     */\n    messageType?: MessageType | 'error' | 'info' | 'warning';\n    /**\n     * 表达式id\n     */\n    expressionId?: string;\n\n    viewModelId?: string;\n\n    eventType?: EventType;\n  }\n  export enum MessageType {\n    error = 'error',\n    info = 'info',\n    warning = 'warning'\n  }\n  /**\n   * 事件处理器\n   */\n  export interface IEventHandler {\n    handleEvent(event: EventArgs, expressionObjects: Expression.ExpressionObject[]);\n    filter(event: Expression.EventArgs);\n    perform(expressionObject: Expression.ExpressionObject, context: any);\n    effect(event: Expression.EventArgs, expressionObject: Expression.ExpressionObject): void;\n  }\n  export enum EffectPath {\n    currentRow = 0\n  }\n  /**\n   * 表达式校验结果\n   */\n  export interface IValidateResult {\n    expressionId: string;\n    path: string[];\n    result: any;\n  }\n  /**\n   * 表达式计算上下文构造器选项\n   */\n  export interface IBuilderOptions {\n\n  }\n  export const MESSAGE = {\n    'zh-CHS': {\n      require: `请输入'$property'`,\n      validate: `'$property'校验不通过`\n    },\n    en: {\n      require: `Please input '$property'`,\n      validate: `'$property' calibration failed`\n    },\n    'zh-CHT': {\n      require: `請輸入'$property'`,\n      validate: `'$property'校驗不通過`\n    }\n  };\n  export const DEPENDENCY_SPLITER = '/';\n}","import { InjectionToken } from '../../core/index';\nimport { Expression } from '../expression/index';\n\nexport const EFFECTOR_TOKEN = new InjectionToken('@farris/effector_token');\n\n","import { BindingData } from '../../binding-data/index';\nimport { Entity, EntityList } from '../../entity/index';\nimport { Repository } from '../../repository/index';\nimport { ViewModelContext } from '../../view-model/index';\nimport { Expression } from '../expression/index';\nimport { NAMESPACE } from '../core/index';\n\n/**\n * 实体副作用器\n * @description 将表达式计算结果赋值给实体属性\n */\nexport class RepositoryEffector implements Expression.Effector {\n\n  public ns: string;\n\n  private repository: Repository<Entity>\n\n  private bindingData: BindingData;\n\n  constructor(private viewModelContext: ViewModelContext) {\n    this.ns = this.viewModelContext.injector.get(NAMESPACE, '');\n    this.repository = this.viewModelContext.repository;\n    this.bindingData = this.viewModelContext.bindingData;\n  }\n\n  public effect(path: string, value: any, options: Expression.EffectOptions) {\n    if (!options || !options.path) {\n      throw new Error('repository effector 需要指定行信息。');\n    }\n    const propertyPath = options.path;\n    const rowId = propertyPath[0] || this.bindingData.list.currentItem.primaryKeyValue;\n    let entity = this.repository.entityCollection.getEntityById(rowId);\n    if (rowId && !entity) {\n      console.error(`找不到id：${rowId}对应的实体！`);\n      return;\n    }\n    // propertyPath like : [1, child1s, 1.1, child2s, 1.1.1,propName] or [1,udt,propName] or [1,prop]\n    const propName = propertyPath.pop();\n    let object: any = entity;\n    for (let index = 1; index < propertyPath.length; index++) {\n      const propertyName = propertyPath[index];\n      if (object instanceof EntityList) {\n        object = object.get(propertyName);\n      } else {\n        object = object[propertyName];\n      }\n    }\n    if (object) {\n      if (object[propName] !== value) {\n        object[propName] = value;\n      }\n    } else {\n      console.error(`找不到实体对应的路径：${propertyPath.push(propName)}`);\n    }\n  }\n}","import { UIState } from '../../ui-state/index';\nimport { ViewModelContext } from '../../view-model/index';\nimport { Expression } from '../expression/index';\nimport { NAMESPACE } from '../core/index';\n\n\nexport class UIStateEffector implements Expression.Effector {\n\n  public ns: string;\n\n  private uiState: UIState;\n\n  constructor(private viewModelContext: ViewModelContext) {\n    this.ns = this.viewModelContext.injector.get(NAMESPACE, '');\n    this.uiState = this.viewModelContext.uiState;\n  }\n  public effect(path: string, value: any, options: Expression.EffectOptions) {\n    this.uiState.setPropertyValue(path, value);\n  }\n}","import { ViewModelContext } from '../../view-model/index';\nimport { Expression } from '../expression/index';\nimport { EFFECTOR_TOKEN } from './tokens';\n\nexport class EffectorRegistry {\n\n  public effectors: Array<Expression.Effector>\n\n  constructor(private viewModelContext: ViewModelContext) {\n    this.effectors = this.viewModelContext.injector.get(EFFECTOR_TOKEN) as Array<Expression.Effector>;\n  }\n\n}\n","import { InjectionToken } from '../../core/index';\nimport { Expression } from '../expression/index';\n\ntype Listener = Expression.Listener;\n\nexport const LISTENER_TOKEN = new InjectionToken('@Farris listener');","import { Observable, Subject } from \"rxjs\";\nimport { Change } from \"../../binding-data/index\";\nimport { Modification } from \"../../changeset/index\";\nimport { DataPropGroup, DataPropInfo, DataTypeInfo } from \"../../entity/index\";\nimport { Expression } from '../expression/index';\nimport { UIStateObservableParam } from \"../../ui-state/index\";\n\ntype EventArgs = Expression.EventArgs;\ntype Listener = Expression.Listener;\n\n/**\n * 变更监听器\n */\nexport abstract class ChangeListener implements Listener {\n  protected subject: Subject<EventArgs> = new Subject<EventArgs>();\n  public get onEvent(): Observable<EventArgs> {\n    return this.subject;\n  }\n  abstract buildEventPath(change: Change | Modification |UIStateObservableParam): string[];\n  /**\n   * 找到元数据中所有实体路径\n   * @param dataTypeInfo \n   * @param results \n   * @param paths \n   */\n  public findEntityPaths(dataTypeInfo: DataTypeInfo, results: any[], paths: string[] = []) {\n    const list: DataPropInfo[] = dataTypeInfo.getPropInfosByGroup(DataPropGroup.List);\n    if (list && list.length > 0) {\n      list.forEach((dataPropInfo: DataPropInfo) => {\n        paths.push(dataPropInfo.name);\n        const childrens: DataPropInfo[] = dataPropInfo.typeInfo.getPropInfosByGroup(DataPropGroup.List);\n        if (childrens && childrens.length > 0) {\n          childrens.forEach((dataPropInfo: DataPropInfo) => {\n            this.findEntityPaths(dataPropInfo.typeInfo, results, paths);\n          });\n        } else {\n          results.push(paths);\n        }\n      });\n    } else if (paths && paths.length > 0) {\n      results.push(paths);\n    }\n  }\n}","import { Injector } from '../../core/index';\nimport { UIState, UIStateObservableParam } from '../../ui-state/index';\nimport { ChangeListener } from './change_listener';\nimport { Expression } from '../expression/index';\nimport { ViewModelContext } from '../../view-model/view_model_context';\nimport { NAMESPACE } from '../core/index';\ntype EventArgs = Expression.EventArgs;\n\n\n/**\n * 监听UIState变更\n */\nclass UIStateChangeListener extends ChangeListener {\n\n  /**\n   * 上下文\n   */\n  private viewModelContext: ViewModelContext;\n\n  /**\n   * 视图模型id\n   */\n  private frameId: string;\n\n  /**\n   * 命名空间\n   */\n  private namespace;\n\n  /**\n   * UIState\n   */\n  private uiState: UIState;\n\n  /**\n   * 构造函数\n   */\n  constructor(viewModelContext: ViewModelContext) {\n    super();\n\n    this.viewModelContext = viewModelContext;\n    this.frameId = this.viewModelContext.id;\n    this.uiState = this.viewModelContext.uiState;\n    this.namespace = this.viewModelContext.injector.get(NAMESPACE, null);\n\n    this.registerEvent();\n  }\n\n  public buildEventPath(change: UIStateObservableParam): string[] {\n    return null;\n  }\n\n  private registerEvent() {\n    if (this.uiState && this.uiState.changes) {\n      this.uiState.changes.subscribe((change: UIStateObservableParam) => {\n        const modification: EventArgs = {\n          ns: this.namespace,\n          path: [change.field],\n          type: Expression.EventType.ValueChanged,\n          value: change.value,\n          source: Expression.EventSource.State,\n          frameId: this.frameId\n        };\n        // console.log(\"UIStateChangeListener\", modification);\n        this.subject.next(modification);\n      });\n    }\n  }\n\n}\nexport { UIStateChangeListener };\n","import { Modification, ModifyType } from '../../changeset/index';\nimport { Entity } from '../../entity/index';\nimport { Repository } from '../../repository/index';\nimport { ChangeListener } from './change_listener';\nimport { Expression } from '../expression/index';\nimport { BindingData } from '../../binding-data/index';\nimport { NAMESPACE } from '../core/index';\nimport { ViewModelContext } from '../../view-model/index';\n\ntype EventArgs = Expression.EventArgs;\nconst EventType = Expression.EventType;\n\nclass RepositoryChangeListener extends ChangeListener {\n\n  private namespace: string;\n\n  private repository: Repository<Entity>;\n\n  private bindingData: BindingData;\n\n  constructor(private viewModelContext: ViewModelContext) {\n    super();\n    \n    this.namespace = this.viewModelContext.injector.get(NAMESPACE, null);\n    this.repository = this.viewModelContext.repository;\n    this.bindingData = this.viewModelContext.bindingData;\n    this.registerEvent();\n  }\n\n  private registerEvent() {\n    if (this.repository && this.repository.changes) {\n      this.repository.changes.subscribe((change: Modification) => {\n        let eventType = this.convertEventType(change);\n        if (!eventType) {\n          return;\n        }\n        const path = this.buildEventPath(change);\n        const modification: EventArgs = {\n          ns: this.namespace,\n          type: eventType,\n          path: path,\n          value: change.value,\n          source: Expression.EventSource.Field,\n        };\n        // console.log(\"RepositoryChangeListener\", modification);\n        this.subject.next(modification);\n      });\n    }\n    // repository只监听值变化事件\n    if (this.repository && this.repository.entityCollectionChange) {\n      this.repository.entityCollectionChange.subscribe((change: Modification) => {\n        let eventType = this.convertEventType(change);\n        if (!eventType) {\n          return;\n        }\n        const path = this.buildEventPath(change);\n        const modification: EventArgs = {\n          ns: this.namespace,\n          type: eventType,\n          path: path,\n          value: change.value,\n          source: Expression.EventSource.Repository,\n        };\n        this.subject.next(modification);\n      });\n    }\n  }\n\n  /**\n   * 构建事件路径参数\n   * @param event event\n   * @description 构建完之后的路径类似[id,prop] or [id,从表名s,从表当前行id,从表属性] or [id,udt,udt_prop]\n   * @returns \n   */\n  public buildEventPath(event: Modification): string[] {\n    const paths = event.path;\n    let result = [];\n    if (!paths || paths.length < 1) {\n      // 主表新增时path为空\n      return result;\n    }\n    // 过滤掉udt的冒号，关联字段的id\n    result = paths.filter((path: string, index: number) => {\n      if (index % 2 === 0 && path.includes(':')) {\n        if (path === ':') {\n          return false;\n        }\n        const primaryKey = path.split(':')[0];\n        if (primaryKey !== this.repository.primaryKey) {\n          return false;\n        }\n      }\n      return true;\n    });\n    // 移除路径中的id字符串\n    // result = paths.map((path: string, index: number) => {\n    //   if (path.includes(':') && index % 2 === 0) {\n    //     return path.split(':')[1];\n    //   }\n    //   return path;\n    // });\n    // 此时result中不应该有冒号\n    return result;\n  }\n\n  private convertEventType(change: Modification): Expression.EventType {\n    let eventType = null;\n    if (change.type === ModifyType.Add || change.type === ModifyType.AddData || change.type === ModifyType.Insert) {\n      // eventType = Expression.EventType.Append;\n      // 不处理新增\n    } else if (change.type === ModifyType.Remove || change.type === ModifyType.RemoveData) {\n      // eventType = Expression.EventType.Remove;\n    } else if (change.type === ModifyType.Load) {\n      // eventType = Expression.EventType.Load;\n    } else if (change.type === ModifyType.ValueChange) {\n      //eventType = Expression.EventType.ValueChanged;\n      // 不处理值变化\n    } else if (change.type === ModifyType.Update) {\n      eventType = Expression.EventType.Update\n    }\n    return eventType;\n  }\n}\n\nexport { RepositoryChangeListener }","\nimport { ViewModelContext } from '../../view-model/index';\nimport { LISTENER_TOKEN } from './tokens';\nimport { Expression } from '../expression/index';\ntype Listener = Expression.Listener;\n\nclass ListenerRegistry {\n\n  /**\n   * 监听器集合\n   */\n  public listeners: Array<Listener>\n\n  /**\n   * 构造函数\n   */\n  constructor(private viewModelContext: ViewModelContext) {\n    this.listeners = this.viewModelContext.injector.get(LISTENER_TOKEN) as Array<Listener>;\n  }\n}\nexport { ListenerRegistry };\n","import { BindingData, BindingList, Change, ChangeType } from '../../binding-data/index';\nimport { ChangeListener } from './change_listener';\nimport { Expression } from '../expression/index';\nimport { NAMESPACE } from '../core/index';\nimport { Repository } from '../../repository/index';\nimport { ViewModelContext } from '../../view-model/index';\n\n\ntype EventArgs = Expression.EventArgs;\nconst EventType = Expression.EventType;\n/**\n * 监听bindingList变更\n * @description 主要用于监听行切换等事件\n */\nclass BindingDataChangeListener extends ChangeListener {\n\n  /**\n   * 命名空间\n   */\n  private namespace;\n\n  /**\n   * 实体仓库\n   */\n  private repository: Repository<any> = null;\n\n  /**\n   * 绑定数据\n   */\n  private bindingData: BindingData\n  \n  /**\n   * 构造函数\n   */\n  constructor(private viewModelContext: ViewModelContext) {\n    super();\n    this.namespace = this.viewModelContext.injector.get(NAMESPACE, '');\n    this.repository = this.viewModelContext.repository;\n    this.bindingData = this.viewModelContext.bindingData;\n\n    this.registerEvent();\n  }\n\n  /**\n   * 注册值变化事件\n   */\n  private registerEvent() {\n    if (this.bindingData && this.bindingData.changes && typeof this.bindingData.changes.subscribe === 'function') {\n      this.bindingData.changes.subscribe((change: Change) => {\n        if (change.type === ChangeType.Append || change.type === ChangeType.ValueChanged || change.type === ChangeType.Remove || change.type === ChangeType.Load || change.type === ChangeType.SelectionChanged) {\n          let eventType = null;\n          if (change.type === ChangeType.Append) {\n            eventType = EventType.Append;\n          } else if (change.type === ChangeType.ValueChanged) {\n            eventType = EventType.ValueChanged;\n          } else if (change.type === ChangeType.Remove) {\n            eventType = EventType.Remove;\n          } else if (change.type === ChangeType.Load) {\n            // 主表新增\n            if (change.create === true) {\n              eventType = EventType.Append;\n            } else {\n              eventType = EventType.Load;\n            }\n          } else if (change.type === ChangeType.SelectionChanged) {\n            eventType = EventType.SelectionChanged\n          }\n          const path = this.buildEventPath(change);\n          const modification: EventArgs = {\n            ns: this.namespace,\n            path: path,\n            type: eventType,\n            source: Expression.EventSource.BindingData,\n            value: change.value,\n            id: change.id\n          };\n          // console.log(\"BindingDataChangeListener\", modification);\n          this.subject.next(modification);\n        }\n      });\n    }\n  }\n\n  public buildEventPath(change: Change): string[] {\n    const path = change.path;\n    const paths = [];\n    // if (!path || path.length < 1) {\n    //   return paths;\n    // }\n    const primaryValue = this.bindingData.list.currentItem.primaryKeyValue;\n    if (primaryValue) {\n      if (!(change.type === ChangeType.Load && change.path.length === 0)) {\n        paths.push(`${this.bindingData.list.primaryKey}:${primaryValue}`);\n      }\n    }\n    const currentPath = [];\n    for (let index = 0; index < path.length; index++) {\n      const propertyName = path[index];\n      currentPath.push(propertyName);\n      const item = this.bindingData.getValue(currentPath);\n      paths.push(propertyName);\n      if (item instanceof BindingList) {\n        if (currentPath.length < path.length) {\n          const bindingList = item as BindingList;\n          let currentId = bindingList.currentItem.primaryKeyValue;\n          if (index === path.length - 2 && change.id) {\n            currentId = change.id;\n          }\n          paths.push(`${this.bindingData.list.primaryKey}:${currentId}`);\n        }\n      }\n    }\n    return paths;\n  }\n}\nexport { BindingDataChangeListener };\n","import { Observable, Subject } from 'rxjs';\nimport { ListenerRegistry } from './listener_registry';\nimport { Expression } from '../expression/index';\nimport { ViewModelContext } from '../../view-model/index';\n\ntype EventArgs = Expression.EventArgs;\ntype Listener = Expression.Listener;\n\n/**\n * 监听器\n * @description 监听bindingList、UIState变更\n */\nclass Listeners {\n\n  private registry: ListenerRegistry\n\n  private subject: Subject<EventArgs> = new Subject<EventArgs>();\n\n  public get onEvent(): Observable<EventArgs> {\n    return this.subject;\n  }\n\n  /**\n   * 构造函数\n   */\n  constructor(private viewModelContext: ViewModelContext) {\n    this.registry = this.viewModelContext.injector.get(ListenerRegistry, null);\n    this.regist();\n  }\n\n  /**\n   * 注册Listender\n   */\n  private regist() {\n    const listeners = this.registry && this.registry.listeners || [];\n    if (listeners && listeners.length > 0) {\n      listeners.forEach((listener: Listener) => {\n        listener.onEvent.subscribe((modification: EventArgs) => {\n          this.subject.next(modification);\n        });\n      });\n    }\n  }\n}\nexport { Listeners };\n","import { BehaviorSubject, Observable } from \"rxjs\";\nimport { ViewModelContext } from '../../view-model/index';\n\nimport { Listeners } from \"../listener/index\";\nimport { Expression } from \"./types\";\n\n/**\n * 事件监听器主要有以下几种类型的事件：\n * 1、值变化\n * 2、行切换\n *    行切换使用场景为需要为数据计算依赖当前行时\n * 3、数据加载\n */\nexport class ExpressionEventEmitter {\n\n  private onEvent: BehaviorSubject<Array<Expression.EventArgs>>;\n\n  private events: Array<Expression.EventArgs>;\n\n  private listeners: Listeners;\n\n  constructor(private viewModelContext: ViewModelContext) {\n\n    this.listeners = this.viewModelContext.injector.get(Listeners);\n\n    this.events = new Array<Expression.EventArgs>();\n    this.listeners.onEvent.subscribe((eventArgs: Expression.EventArgs) => {\n      if (this.onEvent && this.onEvent.observers.length > 0) {\n        let events = [];\n        if (this.events.length > 0) {\n          events = [...this.events];\n        }\n        events.push(eventArgs);\n        this.onEvent.next(events);\n        this.events = [];\n      } else {\n        this.events.push(eventArgs);\n      }\n    });\n  }\n  public attach(): Observable<Array<Expression.EventArgs>> {\n    if (!this.onEvent) {\n      this.onEvent = new BehaviorSubject<Array<Expression.EventArgs>>(this.events);\n    }\n    return this.onEvent.asObservable();\n  }\n}","import { createInjectionToken} from '../core/index';\nimport { Translate } from './translate';\n\nexport const TranslateToken = createInjectionToken('@farris/devkit TranslateToken');\n","import { InjectionToken } from '../../core/index';\nimport { IFormExpressionManifestService, IFormManifestService } from \"./types\";\n\nexport const FORM_MANIFEST_SERVICE_TOKEN = new InjectionToken<IFormManifestService>('@farris/form_manifest_service');\nexport const FORM_EXPRESSION_MANIFEST_SERVICE_TOKEN = new InjectionToken<IFormExpressionManifestService>('@farris/form_expression_manifest_service');\n","import { Injector } from \"../../core/index\";\nimport { Observable, of } from \"rxjs\";\nimport { catchError, switchMap } from \"rxjs/operators\";\nimport { Translate, TranslateToken } from \"../../i18n/index\";\nimport { Repository } from '../../repository/index';\nimport { ViewModelContext, ViewModel } from \"../../view-model/index\";\nimport { FORM_EXPRESSION_MANIFEST_SERVICE_TOKEN, IFormExpressionManifestService } from \"../manifest/index\";\nimport { Expression } from './types';\nimport { AppContext } from '../../app'\nimport { ValidatorFactory } from '../../validator'\nexport class ExpressionRegistry {\n\n  private injector: Injector;\n\n  private _expressions: Expression.ExpressionObject[] = null;\n\n  private formExpressionManifestService: IFormExpressionManifestService;\n\n  private translate: Translate;\n\n  constructor(private viewModelContext: ViewModelContext) {\n\n    this.injector = this.viewModelContext.injector;\n    this.formExpressionManifestService = this.injector.get(FORM_EXPRESSION_MANIFEST_SERVICE_TOKEN, null);\n    this.translate = this.injector.get(TranslateToken, null);\n  }\n\n  /**\n   * 加载表达式文件\n   */\n  public load(): Observable<Expression.ExpressionObject[]> {\n    return this.formExpressionManifestService.load().pipe(\n      switchMap((describe: Array<any>) => {\n        const expressions = this.setExpressions(describe);\n\tthis.cleanSpecialCharacters();\n        return of(expressions);\n      }),\n      catchError((e) => {\n        return of([]);\n      })\n    );\n  }\n\n  public setExpressions(describe) {\n    const expressions: Array<Expression.ExpressionObject> = [];\n    const exprs = Array.from(describe);\n    const appContext = this.viewModelContext.injector.get<AppContext>(AppContext);\n    exprs.forEach((expr: any) => {\n      expr.expressions.forEach((expression: any) => {\n        const expressionObject: Expression.ExpressionObject = {\n          id: expression.id,\n          ns: expr.ns,\n          viewModelId: expr.viewModelId,\n          path: expr.path,\n          bindingType: expr.type,\n          type: expression.type,\n          expression: expression.value || expression.expr || '',\n          message: expression.message || null,\n          messageType: expression.messageType || null,\n          deps: []\n        };\n        if (expression.type === Expression.ExpressionType.Required) {\n          const b = { type: \"requiredExpression\", constraints: [expression.id], message: expression.message }\n          appContext.validationManager[expr.path] = { ...(appContext.validationManager[expr.path] || {}), [expression.id]: b }\n        }\n        if (expression.type === Expression.ExpressionType.Validate) {\n          const b = { type: \"expression\", constraints: [expression.id], message: expression.message }\n          appContext.validationManager[expr.path] = { ...(appContext.validationManager[expr.path] || {}), [expression.id]: b }\n        }\n        if ((expression.type === Expression.ExpressionType.Required || expression.type === Expression.ExpressionType.Validate)) {\n          if (!expression.message) {\n            expressionObject.message = this.getExpressionMessage(expression.type);\n          }\n          if (!expression.messageType) {\n            expressionObject.messageType = 'error';\n          }\n        }\n        if (expressionObject.message) {\n          this.transform(expressionObject);\n        }\n        expressions.push(expressionObject);\n      });\n    });\n\n    this._expressions = expressions;\n    return expressions;\n  }\n\n  /**\n   * 获取所有表达式\n   */\n  public get expressions(): Observable<Expression.ExpressionObject[]> {\n    if (this._expressions) {\n      return of(this._expressions);\n    }\n\n    // 短路，实现功能\n    if (window['__expressions__']) {\n      this.setExpressions(window['__expressions__']);\n      return of(this._expressions);\n    }\n\n    return this.load();\n  }\n  /**\n   * 根据表达式id获取对应的表达式对象\n   * @param id 表达式id\n   * @returns \n   */\n  public getExpressionById(id: string): Expression.ExpressionObject {\n    if (!this._expressions || this._expressions.length < 1) {\n      return null;\n    }\n    return this._expressions.find((expressionObject: Expression.ExpressionObject) => expressionObject.id === id);\n  }\n  private getExpressionMessage(expressionType: Expression.ExpressionType, defaultValue?: string) {\n    if (!(expressionType === Expression.ExpressionType.Validate || expressionType === Expression.ExpressionType.Required)) {\n      return null;\n    }\n    if (!this.translate) {\n      return defaultValue;\n    }\n    const currentLanguage = this.translate.getCurrentLanguage() || 'zh-CHS';\n    return Expression.MESSAGE[currentLanguage][expressionType];\n  }\n  private transform(expressionObject: Expression.ExpressionObject) {\n    if (!this.translate) {\n      return;\n    }\n    if (expressionObject.message && expressionObject.message.startsWith('{{') && expressionObject.message.endsWith('}}')) {\n      expressionObject.message = this.translate.transform(expressionObject.message.substr(2, expressionObject.message.length - 4), null) || this.getExpressionMessage(expressionObject.type);\n    }\n  }\n  private cleanSpecialCharacters() {\n    if (!this._expressions || this._expressions.length < 1 || !Array.isArray(this._expressions)) {\n      return;\n    }\n    const repository: Repository<any> = this.viewModelContext.repository;\n    if (!repository) {\n      return;\n    }\n    const entityTypeInfo = repository.entityTypeInfo;\n    const regex = new RegExp(`[\\\\'\\\\\"]?\\\\s*(${entityTypeInfo.entityInfo.nodeCode}|${entityTypeInfo.entityInfo.originalCode})[\\\\.\\\\[\\\\]a-zA-Z0-9_]+\\\\s*[\\\\'\\\\\"]?`, 'g');\n    this._expressions.forEach((expressionObject: Expression.ExpressionObject) => {\n      const expr = expressionObject.expression;\n      const entityPropertyExpressions: RegExpMatchArray = expr.match(regex);\n      if (Array.isArray(entityPropertyExpressions) && entityPropertyExpressions.length > 0) {\n        // 解析出所有实体相关的字符串，以主实体名字开头，包含主实体属性或子表\n        entityPropertyExpressions.forEach((item: string) => {\n          if (item.indexOf('.') === -1) {\n            console.warn(`无效的实体表达式:${item}`);\n            return;\n          }\n          // 去数组\n          if (/\\[\\d\\]/g.test(item)) {\n            const replacer = item.replace(/\\[\\d\\]/g, '');\n            expressionObject.expression = this.replaceAll(expressionObject.expression, item, replacer);\n          }\n          // 去星号\n          if(/\\*/g.test(item)){\n            const replacer = item.replace(/\\*/g, '');\n            expressionObject.expression = this.replaceAll(expressionObject.expression, item, replacer);\n          }\n        });\n      }\n    });\n  }\n  private replaceAll(originalValue: string, search: string, replacer: string) {\n    return originalValue.split(search).join(replacer);\n  }\n}","import { Expression as ExpressionEngineExpression, ExpressionContext, ExpressionEngine } from \"@farris/expression-engine\";\nimport { ViewModelContext, ViewModel } from \"../../view-model/index\";\nimport { Expression } from \"./types\";\n\nexport class ExpressionExecutor implements Expression.IExecutor {\n  /**\n   * 编译执行\n   * @param expression \n   * @param context \n   * @returns \n   */\n  public compile(expressionObject: Expression.ExpressionObject, context?: { [prop: string]: any }): any {\n    if (Object.prototype.toString.call(context) !== '[object Object]') {\n      throw new Error('上下文必须为对象！');\n    }\n    const expressionContext = this.buildContext(context);\n    if (!expressionObject.factory) {\n      const expression = new ExpressionEngineExpression(expressionObject.expression, expressionContext);\n      expressionObject.factory = expression.compile();\n    }\n    const expression: ExpressionEngineExpression = expressionObject.factory;\n    return expression.eval(expressionContext);\n  }\n  /**\n   * 解析\n   * @param expression \n   * @param context \n   * @returns \n   */\n  public eval(expression: string, context?: { [prop: string]: any }) {\n    if (Object.prototype.toString.call(context) !== '[object Object]') {\n      throw new Error('上下文必须为对象！');\n    }\n    const expressionContext = this.buildContext(context);\n    const expressionEngine = new ExpressionEngine(expressionContext);\n    return expressionEngine.eval(expression);\n  }\n  /**\n   * 构造表达式上下文\n   * @param context \n   * @returns \n   */\n  private buildContext(context: { [prop: string]: any }): ExpressionContext {\n    const expressionContext = new ExpressionContext();\n    if (context && Object.keys(context).length > 0) {\n      Object.keys(context).forEach((key: string) => {\n        expressionContext.set(key, context[key]);\n      });\n    }\n    return expressionContext;\n  }\n}","import { Injector } from '../../core/index';\nimport { AppContext } from '../../app/index';\nimport { BindingData, BindingList, BindingObject } from '../../binding-data/index';\nimport { DataPropInfo, Entity, EntityList } from '../../entity/index';\nimport { EffectorFactory } from '../effector/index';\nimport { Expression, ExpressionExecutor, ExpressionRegistry, ExpressionResult } from '../expression/index';\nimport { Repository } from '../../repository/index';\nimport { ViewModelContext } from '../../view-model/index';\nimport { ExpressionUtil } from '../utils/expression_util';\n\nexport abstract class EventHandler implements Expression.IEventHandler {\n\n  protected injector: Injector;\n\n  protected repository: Repository<any>;\n\n  protected bindingData: BindingData;\n\n  protected expressionRegistry: ExpressionRegistry;\n\n  protected effectorFactory: EffectorFactory;\n\n  protected expressionExecutor: ExpressionExecutor;\n\n  protected expressionResult: ExpressionResult;\n\n  constructor(protected frameContext: ViewModelContext) {\n    this.injector = frameContext.injector;\n    this.repository = frameContext.repository;\n    this.bindingData = frameContext.bindingData;\n    this.expressionRegistry = this.injector.get(ExpressionRegistry, null);\n    this.effectorFactory = this.injector.get(EffectorFactory, null);\n    this.expressionExecutor = this.injector.get(ExpressionExecutor);\n    this.expressionResult = this.injector.get(ExpressionResult, null);\n\n  }\n\n  public expressionObjects: Expression.ExpressionObject[];\n\n  public handleEvent(event: Expression.EventArgs, expressionObjects: Expression.ExpressionObject[]) {\n    event = Object.assign({}, event);\n    this.expressionObjects = expressionObjects;\n    this.dispatch(event);\n  }\n\n  //#region 抽象函数\n  /**\n   * 获取相关表达式\n   * @param event event\n   */\n  public abstract filter(event: Expression.EventArgs);\n  /**\n   * 发布事件\n   * @param expressionObject 表达式对象\n   * @param event 事件\n   */\n  public abstract dispatch(event: Expression.EventArgs): void;\n  //#endregion\n\n  //#region 属性\n\n  /**\n   * 主表主键值\n   */\n  protected get primaryValue() {\n    return this.bindingData.list.currentItem.primaryKeyValue;\n  }\n  /**\n   * 获取主实体原始字段名\n   */\n  protected get entityOriginalNodeCode(): string {\n    return this.repository && this.repository.entityTypeInfo && this.repository.entityTypeInfo.entityInfo && this.repository.entityTypeInfo.entityInfo.originalCode || null;\n  }\n\n  //#endregion\n\n  //#region 表达式核心\n  /**\n   * 执行表达式计算\n   * @param expression 表达式\n   * @param context 上下文\n   * @returns any\n   */\n  public perform(expressionObject: Expression.ExpressionObject, context: any) {\n    return this.expressionExecutor.compile(expressionObject, context);\n  }\n  /**\n   * 副作用\n   * @param event event\n   * @param expressionObject expressionObject\n   */\n  public effect(event: Expression.EventArgs, expressionObject: Expression.ExpressionObject): void {\n    const effectTo = expressionObject.bindingType;\n    const effector = this.effectorFactory.getEffector(expressionObject);\n    if (!effector) {\n      // console.warn(`EventHandler 没有对应的副作用器。${expressionObject.type}`);\n      return;\n    }\n    if (effectTo === Expression.ExpressionBindingType.Field) {\n      const effectPaths = expressionObject.effectPaths || [];\n      if (effectPaths.length > 0) {\n        effectPaths.forEach((path: string) => {\n          const effectPath = path.split('/');\n          const effectOptions = { path: effectPath, message: expressionObject.message, expressionId: expressionObject.id, eventType: event.type, viewModelId: expressionObject.viewModelId };\n          effector.effect(expressionObject.path, expressionObject.result, effectOptions);\n        });\n      } else if (expressionObject.type === Expression.ExpressionType.Required || expressionObject.type === Expression.ExpressionType.Validate || expressionObject.type === Expression.ExpressionType.Readonly || expressionObject.type === Expression.ExpressionType.Visible) {\n        const effectOptions = { message: expressionObject.message, expressionId: expressionObject.id, eventType: event.type, viewModelId: expressionObject.viewModelId };\n        effector.effect(expressionObject.path, expressionObject.result, effectOptions);\n      }\n    } else {\n      throw new Error('not supported！');\n    }\n  }\n\n  //#endregion\n\n  //#region util\n\n  protected isValidateOrRequiredExpression(expressionObject: Expression.ExpressionObject) {\n    return expressionObject && (expressionObject.type === Expression.ExpressionType.Validate || expressionObject.type === Expression.ExpressionType.Required);\n  }\n  /**\n   * 以事件参数为依据构建实体路径\n   * @param event event\n   * @returns \n   */\n  protected getEntityPathFromEvent(event: Expression.EventArgs): string[] {\n    event = JSON.parse(JSON.stringify(event));\n    if (!event || !event.path || event.path.length < 1) {\n      return [];\n    }\n    const paths = event.path;\n    return this.getEntityPath(paths);\n  }\n  /**\n   * 获取事件路径中的实体路径\n   * @param path path\n   * @returns \n   */\n  protected getEntityPath(path: string[]): string[] {\n    const paths = path.filter((value: string, index: number) => {\n      if (index % 2 === 0 && value.includes(':')) {\n        return false;\n      } else {\n        return true;\n      }\n    });\n    return paths;\n  }\n  /**\n   * 构造实体路径\n   * @param path path\n   * @description 删除路径中的id字段\n   * @returns \n   */\n  protected buildEntityPath(path: string[]): string[] {\n    const paths = path.filter((value: string, index: number) => {\n      if (index % 2 === 0 && value.includes(':')) {\n        return false;\n      } else {\n        return true;\n      }\n    });\n    return paths;\n  }\n  /**\n   * 清理事件路径中的id主键标识\n   * @param path path\n   * @returns \n   */\n  protected cleanEventPath(path: string[]) {\n    path = path.filter(p => {\n      if (p && p !== ':') {\n        return true;\n      } else {\n        return false;\n      }\n    });\n    return path.map((item: string) => {\n      if (item.includes(':')) {\n        return item.split(':')[1];\n      } else {\n        return item;\n      }\n    });\n  }\n  /**\n   * 获取子表事件行\n   * @param paths \n   * @param event \n   * @returns \n   */\n  protected getCurrentRowByPaths(paths: string[]): null | { [prop: string]: any } {\n    let result = null;\n    const bindingList: BindingList = this.bindingData.getValue(paths) as BindingList;\n    if (bindingList && bindingList.length > 0) {\n      let primaryValue = bindingList.currentItem.primaryKeyValue || null;\n      if (primaryValue) {\n        const bindingObject = bindingList.findById(primaryValue);\n        if (bindingObject) {\n          result = bindingObject.toJSON();\n        }\n      }\n    }\n    return result;\n  }\n  /**\n   * 获取事件路径中指定子表的事件行\n   * @param path \n   * @param tableCode \n   * @returns \n   */\n  protected getEventId(path: string[], tableCode: string) {\n    if (!path || path.length < 1) {\n      throw new Error('invalid path!');\n    }\n    const propertyIndex = path.findIndex(p => p === tableCode);\n    if (propertyIndex === -1) {\n      return null;\n    }\n    const idIndex = propertyIndex + 1;\n    if (idIndex > path.length - 1) {\n      throw new Error('invalid propertyName or path');\n    }\n    const id = path[idIndex];\n    if (id.indexOf(':') === -1) {\n      throw new Error('compute error.');\n    }\n    return id.split(':')[1];\n  }\n  //#endregion\n\n\n  //#region  构造上下文\n\n  /**\n   * 构造变量上下文\n   * @param event \n   * @returns \n   */\n  public buildStateContext(event: Expression.EventArgs) {\n    const ns = event.ns;\n    const appContext = this.injector.get<AppContext>(AppContext, null);\n    const frameContexts = appContext.viewModelContextManager.getContextsByNamespace(ns);\n    const result = {};\n    if (frameContexts && frameContexts.length > 0) {\n      const anonymousFrameContext = frameContexts[0];\n      const rootFrameContext = anonymousFrameContext.getVirtualRootFrameContext();\n      if (rootFrameContext) {\n        const uiState = rootFrameContext.viewModel.uiState;\n        const propertyNames = Object.getOwnPropertyNames(uiState) || [];\n        propertyNames.forEach((prop: string) => {\n          if (prop.match(/^[a-zA-Z0-9_\\$]+$/g) !== null) {\n            result[prop] = uiState[prop];\n          }\n        });\n      }\n    }\n    return result;\n  }\n  /**\n   * 获取事件实体\n   * @param event \n   * @returns \n   */\n  public buildEntityContext(event: Expression.EventArgs, expressionObject: Expression.ExpressionObject, currentRows?: Array<Expression.ICurrentRow>) {\n    const expressionBindingType = expressionObject.bindingType;\n    if (expressionBindingType === Expression.ExpressionBindingType.Field) {\n      const entityTypeInfo = this.repository.entityTypeInfo;\n      const childrenEntityPaths = [];\n      ExpressionUtil.getChildrenEntityPaths(entityTypeInfo, childrenEntityPaths);\n      // 获取当前行\n      const row = currentRows && currentRows.find(row => row.bindingPath === '' || row.bindingPath === '/') || null;\n      const primaryValue = row && row.primaryValue || this.bindingData.list.currentId;\n      let entity = this.bindingData.list.findById(primaryValue);\n      if (!entity) {\n        return null;\n      }\n      const object = entity.toJSON();\n      object['__type__'] = 'Entity';\n      if (!childrenEntityPaths || childrenEntityPaths.length < 1) {\n        return object;\n      }\n      childrenEntityPaths.sort((v1, v2) => v1.length - v2.length);\n      // 找到所有子表\n      childrenEntityPaths.forEach((paths: string[]) => {\n        const bindingList = this.bindingData.getValue(paths) as BindingList;\n        let currentRowId = bindingList.currentId;\n        const propertyName = paths[paths.length - 1];\n        // parent 为entity或entitylist或null\n        const parent = paths.slice(0, paths.length - 1).reduce((object: any, path: string) => {\n          return object && object[path] || null;\n        }, object);\n        if (!parent) {\n          return;\n        }\n        const data = parent;\n        let node: any = null;\n        if (!currentRowId) {\n          // 当前表没有数据\n          node = { __items__: [], __type__: 'List' };\n          node.length = () => node.__items__.length;\n        } else {\n          // 纠正当前行\n          if (currentRows && currentRows.length > 0) {\n            // 是否指定了当前行\n            const userAssignCurrentRow = currentRows.find(row => {\n              const bindingPaths = row.bindingPath.split('/').filter(p => p);\n              return bindingPaths.join('/') === paths.join('/');\n            });\n            if (userAssignCurrentRow) {\n              currentRowId = userAssignCurrentRow.primaryValue;\n            }\n          }\n          // 子表当前行\n          const row = bindingList.findById(currentRowId);\n          // 找到子表当前行的上级\n          const list = parent[propertyName];\n          node = { __items__: [], ...row && row.toJSON() || {}, __type__: 'List' };\n          node.length = () => node.__items__.length;\n\n          if (list && Array.isArray(list)) {\n            node.__items__ = [].concat(list);\n          }\n        }\n        data[propertyName] = node;\n      });\n      return object;\n    } else if (expressionBindingType === Expression.ExpressionBindingType.State) {\n      // todo: 支持状态表达式\n    } else {\n      return null;\n    }\n  }\n  /**\n   * 构造表达式计算上下文\n   * @param expressionObject 表达式\n   * @param event 事件\n   * @param entityContext 实体上下文\n   * @param currentRows 当前行\n   * @returns \n   */\n  public buildContext(expressionObject: Expression.ExpressionObject, event: Expression.EventArgs, entityContext?: any, currentRows?: Array<Expression.ICurrentRow>): any {\n    let context = [];\n    if (entityContext) {\n      context.push(entityContext);\n    } else {\n      const entity = this.buildEntityContext(event, expressionObject, currentRows);\n      context.push(entity);\n    }\n    const stateContext = this.buildStateContext(event);\n    const entityCode = this.entityOriginalNodeCode;\n    let entity = null;\n    if (context.length === 1) {\n      entity = context.pop();\n    } else {\n      entity = context[0];\n      if (!entity['__type__']) {\n        entity['__type__'] = 'Entity';\n      }\n      entity['__items__'] = context;\n    }\n    return {\n      [entityCode]: entity,\n      ...stateContext,\n      frameContext: this.frameContext,\n      bindingData: this.bindingData,\n      repository: this.repository\n    };\n  }\n  //#endregion\n  /**\n   * 构造副作用路径\n   * @param event \n   * @param expressionObject \n   * @returns \n   */\n  protected buildEffectPath(event: Expression.EventArgs, expressionObject: Expression.ExpressionObject): string[] {\n    const expressionPaths = expressionObject.path.split('/').filter(p => p);\n    const primaryValue = event.path[0] && event.path[0].split(':')[1];\n    if (!primaryValue) {\n      throw new Error('Invalid event path!');\n    }\n    if (expressionPaths.length === 1) {\n      // 主表简单字段\n      return [primaryValue, expressionPaths.pop()];\n    } else {\n      const result = [primaryValue];\n      for (let index = 0; index < expressionPaths.length; index++) {\n        const propertyName = expressionPaths[index];\n        result.push(propertyName);\n        const currentPaths = expressionPaths.slice(0, index + 1);\n        const propertyInfo: DataPropInfo = this.repository.entityTypeInfo.getPropInfoByPath(currentPaths);\n        if (propertyInfo.group === 'List') {\n          let id = this.getEventId(event.path, propertyInfo.name) || null;\n          // 事件和表达式不是同一个表\n          if (!id) {\n            const bindingList = this.bindingData.getValue(currentPaths) as BindingList;\n            if (bindingList) {\n              id = bindingList.currentId;\n            }\n          }\n          result.push(id);\n        }\n      }\n      return result;\n    }\n  }\n\n  //#region 辅助方法\n  protected getPathInfo(path: string): { path: string, propertyName: string, paths: string[], propertyNames: string[] } {\n    const paths = path.split('/').filter(p => p);\n    // 获取最大实体层级，其余为属性（简单属性、udt、关联、关联嵌套关联）\n    const entityPath = ExpressionUtil.getAvailableChildrenPathsFromEntityPaths(paths, this.repository.entityTypeInfo);\n    const propertyName = paths.slice(entityPath.length).join('/');\n    return { path: entityPath.join('/'), propertyName, paths: entityPath, propertyNames: propertyName.split('/').filter(p => p) };\n  }\n  /**\n   * get table paths from event paths\n   * @param paths event paths\n   * @returns \n   */\n  protected getTablePathsFromEventPaths(paths: string[]) {\n    paths = this.getEntityPath(paths);\n    const entityPaths = ExpressionUtil.getAvailableChildrenPathsFromEntityPaths(paths, this.repository.entityTypeInfo);\n    return entityPaths;\n  }\n  /**\n   * get property paths from event paths\n   * @param paths event paths\n   * @returns \n   */\n  protected getPropertyPathsFromEventPaths(paths: string[]) {\n    paths = this.getEntityPath(paths);\n    const tablePaths = ExpressionUtil.getAvailableChildrenPathsFromEntityPaths(paths, this.repository.entityTypeInfo);\n    return paths.slice(tablePaths.length);\n  }\n  /**\n   * 分析事件和表达式的关系\n   */\n  protected analysis(event: Expression.EventArgs, expressionObject: Expression.ExpressionObject) {\n    const expressionPathInfo = this.getPathInfo(expressionObject.path);\n    const eventPaths = this.getEntityPath(event.path.slice(0));\n    const eventPathInfo = this.getPathInfo(eventPaths.join('/'));\n    if (!expressionPathInfo || !eventPathInfo) {\n      console.warn(`表达式路径或事件路径错误，获取路径信息失败。`);\n      return null;\n    }\n    const expressionTablePaths = expressionPathInfo.path.split('/').filter(p => p);\n    const expressionPropertyNames = expressionPathInfo.propertyName.split('/').filter(p => p);\n    const eventTablePaths = eventPathInfo.path.split('/').filter(p => p);\n    const eventPropertyNames = eventPathInfo.propertyName.split('/').filter(p => p);\n    const result = {\n      distance: undefined,\n      eventFromChildren: undefined,\n      eventFromParent: undefined,\n      expressionTablePaths,\n      expressionPropertyNames,\n      eventTablePaths,\n      eventPropertyNames,\n      isSameTable: false\n    };\n    result.distance = Math.abs(expressionTablePaths.length - eventTablePaths.length);\n    if (result.distance === 1) {\n      result.eventFromChildren = eventTablePaths.length > expressionTablePaths.length && eventTablePaths.join('/').startsWith(expressionTablePaths.join('/'));\n      result.eventFromParent = eventTablePaths.length < expressionTablePaths.length && expressionTablePaths.join('/').startsWith(eventTablePaths.join('/'));\n    }\n    result.isSameTable = expressionTablePaths.join('/') === eventTablePaths.join('/');\n    return result;\n  }\n\n  protected buildCurrentRows(tablePaths: string[], fullPaths: string[]) {\n    const currentRows = new Array<Expression.ICurrentRow>();\n    if (!tablePaths || tablePaths.length < 1) {\n      currentRows.push({\n        bindingPath: '/',\n        primaryValue: fullPaths[0]\n      });\n    } else {\n      const paths = [];\n      tablePaths.forEach((path: string, index: number) => {\n        if (index === 0) {\n          currentRows.push({\n            bindingPath: '/',\n            primaryValue: fullPaths[0]\n          });\n        }\n        paths.push(path);\n        const primaryValue = fullPaths[index * 2 + 2];\n        currentRows.push({\n          bindingPath: paths.join('/'),\n          primaryValue: primaryValue\n        });\n      });\n    }\n    return currentRows;\n  }\n  //#endregion\n}","import { DataPropInfo,Entity, EntityList } from '../../entity/index';\nimport { Expression } from '../expression/index';\nimport { ENTITY_TEMPLATE } from '../resolver/index';\nimport { EventHandler } from './event_handler';\n/**\n * 实体值变化处理器\n */\nexport class EntityValueChangedEventHandler extends EventHandler {\n\n  /**\n   * 获取相关表达式\n   * @param event event\n   */\n  public filter(event: Expression.EventArgs): Expression.ExpressionObject[] {\n    return null;\n  }\n\n  /**\n   * 发布事件\n   * @param event event\n   */\n  public dispatch(event: Expression.EventArgs) {\n  }\n\n  /**\n   * 获取子表事件行\n   * @param paths \n   * @param event \n   * @returns \n   */\n  public getCurrentRowByEvent(paths: string[], event: Expression.EventArgs): null | { [prop: string]: any } {\n    return this.getCurrentRowByPaths(paths);\n  }\n}","import { Expression } from \"../expression/index\";\n\nexport class EffectorManager {\n  /**\n   * 批量副作用\n   * @param effector effector\n   * @param expressionObject 表达式\n   * @param paths 作用路径\n   * @returns \n   */\n  public static effect(effector: Expression.Effector, expressionObject: Expression.ExpressionObject, paths: any[][]) {\n    if (!paths || paths.length < 1) {\n      return;\n    }\n    paths.forEach((path: any[]) => {\n      const effectOptions: Expression.EffectOptions = { path, message: expressionObject.message, expressionId: expressionObject.id, viewModelId: expressionObject.viewModelId, eventType: expressionObject.eventType };\n      effector.effect(expressionObject.path, expressionObject.result, effectOptions);\n    });\n  }\n}","import { InjectionToken } from '../../core/index';\nimport { EffectorManager } from \"../effector/effector_manager\";\nimport { Entity, EntityList } from \"../../entity/index\";\nimport { Expression } from \"../expression/index\";\nimport { STATE_TEMPLATE } from \"../resolver/index\";\nimport { EventHandler } from \"./event_handler\";\n\nexport class StateValueChangedEventHandler extends EventHandler {\n\n  /**\n   * 获取相关表达式\n   * @param event event\n   */\n  public filter(event: Expression.EventArgs) {\n    if (this.expressionObjects && this.expressionObjects.length > 0) {\n      return this.expressionObjects.filter((expressionObject: Expression.ExpressionObject) => {\n        const deps = expressionObject.deps;\n        if (!deps || deps.length < 1 || event.ns !== expressionObject.ns) {\n          return false;\n        }\n        const changePaths = this.cleanEventPath(event.path);\n        changePaths.splice(0, 0, STATE_TEMPLATE);\n        const eventPath = changePaths.join('/');\n        if (deps.includes(eventPath)) {\n          return true;\n        } else {\n          return false;\n        }\n      });\n    }\n    return null;\n  }\n  /**\n   * 发布事件\n   * @param event event\n   */\n  public dispatch(event: Expression.EventArgs) {\n    const expressions = this.filter(event);\n    if (expressions && expressions.length > 0) {\n      expressions.forEach((expressionObject: Expression.ExpressionObject) => {\n        // const entityContext = this.buildEntityContext(event, expressionObject);\n        const context = this.buildContext(expressionObject, event);\n        const result = this.perform(expressionObject, context);\n        if (result === undefined && !this.isValidateOrRequiredExpression(expressionObject)) {\n          return;\n        }\n        expressionObject.result = result;\n        if (expressionObject.id) {\n          this.expressionResult.set(expressionObject.id, expressionObject.result);\n        }\n        this.effect(event, expressionObject);\n      });\n    }\n  }\n  /**\n   * 副作用\n   * @param event event\n   * @param expressionObject expressionObject\n   */\n  public effect(event: Expression.EventArgs, expressionObject: Expression.ExpressionObject): void {\n    const effector = this.effectorFactory.getEffector(expressionObject);\n    const bindingType = expressionObject.bindingType;\n\n    if (bindingType === Expression.ExpressionBindingType.State) {\n      // 如果表达式作用于uistate\n      effector.effect(expressionObject.path, expressionObject.result, { message: expressionObject.message, eventType: event.type, viewModelId: expressionObject.viewModelId });\n    } else if (bindingType === Expression.ExpressionBindingType.Field) {\n      // 表达式作用于实体属性\n      const expressionPathInfo = this.getPathInfo(expressionObject.path);\n      const bindingPaths = expressionPathInfo.paths;\n      const entities = this.repository.entityCollection.getAllEntities();\n\n      this.effectRows(entities, bindingPaths, expressionPathInfo.propertyNames, (currentRows: Expression.ICurrentRow[], paths: string[]) => {\n        this.output(event, expressionObject, currentRows, effector, [paths])\n      });\n    }\n  }\n  public output(event: Expression.EventArgs, expressionObject: Expression.ExpressionObject, currentRows: Expression.ICurrentRow[], effector: Expression.Effector, paths: any[][]) {\n    const context = this.buildContext(expressionObject, event, null, currentRows);\n    const value = this.perform(expressionObject, context);\n    if (value === undefined) {\n      return;\n    }\n    expressionObject.result = value;\n    if (expressionObject.id) {\n      this.expressionResult.set(expressionObject.id, expressionObject.result);\n    }\n    EffectorManager.effect(effector, expressionObject, paths);\n  }\n  private effectRows(entities: Entity[], bindingPaths: string[], propertyNames: string[], callback: (currentRows: Expression.ICurrentRow[], paths: string[]) => void, currentRows: Expression.ICurrentRow[] = [], prevPaths: string[] = [], paths: string[] = []) {\n    if (!bindingPaths || bindingPaths.length < 1) {\n      entities.forEach((entity: Entity) => {\n        if (!entity || !entity.primaryValue) {\n          return;\n        }\n        const currentPaths = paths.concat([entity.primaryValue]).concat(propertyNames);\n        const currentCurrentRows = currentRows.concat([{ bindingPath: prevPaths.join('/') || '/', primaryValue: entity.primaryValue }]);\n        callback(currentCurrentRows, currentPaths);\n      });\n      currentRows.length = 0;\n      paths.length = 0;\n    } else {\n      let flag = false;\n      let nextPrevPaths = prevPaths;\n      entities.forEach((entity: Entity) => {\n        const prop = bindingPaths[0];\n        const entityList = entity[prop] as EntityList<Entity>;\n        if (!entityList || entityList.count() < 1) {\n          return;\n        }\n        currentRows.push({ bindingPath: prevPaths.join('/') || '/', primaryValue: entity.primaryValue });\n        paths.push(entity.primaryValue);\n        paths.push(prop);\n        if (flag === false) {\n          flag = true;\n          nextPrevPaths.push(prop);\n        }\n        const nextBindingPaths = bindingPaths.slice(1);\n        this.effectRows(entityList.items, nextBindingPaths, propertyNames, callback, currentRows, nextPrevPaths, paths);\n      });\n    }\n  }\n  /**\n   * 获取子表事件行\n   * @param paths \n   * @param event \n   * @returns \n   */\n  public getCurrentRowByEvent(paths: string[], event: Expression.EventArgs): { [prop: string]: any; } {\n    return this.getCurrentRowByPaths(paths);\n  }\n}","import { Entity } from \"../../entity/index\";\nimport { Expression } from \"../expression\";\nimport { ENTITY_TEMPLATE } from \"../resolver/index\";\nimport { EventHandler } from \"./event_handler\";\n\nexport class RepositoryAddEntityEventHandler extends EventHandler {\n  /**\n   * 获取相关表达式\n   * @param event event\n   * @description 不支持主表直接依赖子表属性的情况，只能聚合子表的字段\n   */\n  public filter(event: Expression.EventArgs) {\n    return null;\n  }\n  /**\n   * 发布事件\n   * @param event event\n   */\n  public dispatch(event: Expression.EventArgs) {\n    const expressions = this.filter(event);\n    if (expressions && expressions.length > 0) {\n      expressions.forEach((expressionObject: Expression.ExpressionObject) => {\n        const entityContext = this.buildEntityContext(event,expressionObject);\n        const context = this.buildContext(expressionObject, event, entityContext);\n        const result = this.perform(expressionObject, context);\n        if (result === undefined&& !this.isValidateOrRequiredExpression(expressionObject)) {\n          return;\n        }\n        expressionObject.result = result;\n        if (expressionObject.id) {\n          this.expressionResult.set(expressionObject.id, expressionObject.result);\n        }\n        this.effect(event, expressionObject);\n      });\n    }\n  }\n  /**\n   * 获取子表事件行\n   * @param paths \n   * @param event \n   * @returns \n   */\n  public getCurrentRowByEvent(paths: string[], event: Expression.EventArgs): null | { [prop: string]: any } {\n    return this.getCurrentRowByPaths(paths);\n  }\n}","import { InjectionToken } from '../../core/index';\nimport { BindingList } from \"../../binding-data/index\";\nimport { Expression } from \"../expression\";\nimport { ENTITY_TEMPLATE } from \"../resolver/index\";\nimport { ExpressionUtil } from \"../utils/expression_util\";\nimport { EventHandler } from \"./event_handler\";\n\nexport class RepositoryRemoveEntityEventHandler extends EventHandler {\n  /**\n   * 获取相关表达式\n   * @param event event\n   */\n  public filter(event: Expression.EventArgs) {\n    return null;\n  }\n  /**\n   * 发布事件\n   * @param event event\n   */\n  public dispatch(event: Expression.EventArgs) {\n  }\n}","import { EventHandler } from \"./event_handler\";\nimport { Expression } from \"../expression/index\";\n\nexport class RepositoryLoadEventHandler extends EventHandler {\n  public filter(event: Expression.EventArgs) {\n    return null;\n  }\n  /**\n   * 发布事件\n   * @param event event\n   */\n  public dispatch(event: Expression.EventArgs) {\n    const expressions = this.filter(event);\n    if (expressions && expressions.length > 0) {\n      expressions.forEach((expressionObject: Expression.ExpressionObject) => {\n        const entityContext = this.buildEntityContext(event,expressionObject);\n        const context = this.buildContext(expressionObject, event, entityContext);\n        const result = this.perform(expressionObject, context);\n        if (result === undefined&& !this.isValidateOrRequiredExpression(expressionObject)) {\n          return;\n        }\n        expressionObject.result = result;\n        if (expressionObject.id) {\n          this.expressionResult.set(expressionObject.id, expressionObject.result);\n        } else {\n          console.warn(`EventHandler 表达式未设置唯一标识，无法更新表达式值。`);\n        }\n        this.effect(event, expressionObject);\n      });\n    }\n  }\n  /**\n   * 获取子表事件行\n   * @param paths \n   * @param event \n   * @returns \n   */\n  public getCurrentRowByEvent(paths: string[], event: Expression.EventArgs): null | { [prop: string]: any } {\n    return this.getCurrentRowByPaths(paths);\n  }\n}","import { BindingList } from \"../../binding-data/index\";\nimport { Expression } from \"../expression/index\";\nimport { ENTITY_TEMPLATE } from \"../resolver/index\";\nimport { ExpressionUtil } from \"../utils/expression_util\";\nimport { EventHandler } from \"./event_handler\";\n\nexport class EntityUpdateEventHandler extends EventHandler {\n\n  public filter(event: Expression.EventArgs) {\n    return this.expressionObjects.filter((expressionObject: Expression.ExpressionObject) => {\n      // 重新加载实体时不计算计算表达式，只处理只读、必填等\n      if (expressionObject.ns !== event.ns || !expressionObject.deps || expressionObject.deps.length === 0 || expressionObject.type === Expression.ExpressionType.Compute || expressionObject.type === Expression.ExpressionType.Dependency || expressionObject.type === Expression.ExpressionType.DataPicking) {\n        return false;\n      }\n      const result = this.analysis(event, expressionObject);\n      if (!result) {\n        return false;\n      }\n      // 必须是主表表达式\n      if (result.expressionTablePaths.length !== 0) {\n        return false;\n      }\n      const index = expressionObject.deps.findIndex((dep: string) => {\n        if (!dep.startsWith(ENTITY_TEMPLATE)) {\n          return false;\n        }\n        const deps = dep.split(Expression.DEPENDENCY_SPLITER).filter(p => p).slice(1);\n        const depPathInfo = this.getPathInfo(deps.join('/'));\n        if (!depPathInfo) {\n          return false;\n        }\n        if (depPathInfo.paths.length !== 0) {\n          return false;\n        }\n        return true;\n      });\n      return index === -1 ? false : true;\n    });\n  }\n  /**\n   * 发布事件\n   * @param event event\n   */\n  public dispatch(event: Expression.EventArgs) {\n    const expressions = this.filter(event);\n    if (expressions && expressions.length > 0) {\n      expressions.forEach((expressionObject: Expression.ExpressionObject) => {\n        const entityContext = this.buildEntityContext(event, expressionObject);\n        const context = this.buildContext(expressionObject, event, entityContext);\n        const result = this.perform(expressionObject, context);\n        if (result === undefined && !this.isValidateOrRequiredExpression(expressionObject)) {\n          return;\n        }\n        expressionObject.result = result;\n        if (expressionObject.id) {\n          this.expressionResult.set(expressionObject.id, expressionObject.result);\n        } else {\n          console.warn(`EventHandler 表达式未设置唯一标识，无法更新表达式值。`);\n        }\n        this.effect(event, expressionObject);\n      });\n    }\n  }\n  public getCurrentRowByEvent(paths: string[], event: Expression.EventArgs) {\n    let result = null;\n    const bindingList: BindingList = this.bindingData.getValue(paths) as BindingList;\n    const eventEntityPath = this.getEntityPath(event.path);\n    if (bindingList && bindingList.length > 0) {\n      let primaryValue = bindingList.currentItem.primaryKeyValue || null;\n      // 使用事件中的主键\n      const childrenPaths = ExpressionUtil.getAvailableChildrenPathsFromEntityPaths(eventEntityPath, this.repository.entityTypeInfo);\n      if (childrenPaths && childrenPaths.toString() === paths.toString()) {\n        // 发生值变化的数据位于要获取当前行的子表中，此时事件行应该是发生值变化的数据id，而不是当前行id\n        primaryValue = event.id || null;\n        if (!primaryValue) {\n          primaryValue = this.getEventId(event.path, paths[paths.length - 1]);\n        }\n      }\n      if (primaryValue) {\n        const bindingObject = bindingList.findById(primaryValue);\n        if (bindingObject) {\n          result = bindingObject.toJSON();\n        }\n      }\n    }\n    return result;\n  }\n}","import { BindingList, BindingObject } from \"../../binding-data/index\";\nimport { EffectorManager } from \"../effector/effector_manager\";\nimport { Expression } from \"../expression/index\";\nimport { ENTITY_TEMPLATE, STATE_TEMPLATE } from \"../resolver/index\";\nimport { ExpressionUtil } from \"../utils\";\nimport { EventHandler } from \"./event_handler\";\n\nexport class BindingDataAppendObjectEventHandler extends EventHandler {\n  /**\n   * 过滤出需要计算的表达式\n   * @param event event\n   * @returns \n   */\n  public filter(event: Expression.EventArgs): Expression.ExpressionObject[] {\n    // event.path like [\"id:7dd77e50-ebed-4639-b483-d12004603640\", \"formEEUR1E1s\"] or undefined or []\n    if (this.expressionObjects && this.expressionObjects.length > 0) {\n      // const fullEventPath = event.path || [];\n      // 找到聚合相关表达式(依赖新增表的表达式),聚合的前提是表达式path位于事件路径的上方\n      // 给实体属性或vo变量设置了聚合相关的表达式，此时表达式依赖中路径到子表属性\n      const groupExpressions = this.expressionObjects.filter((expressionObject: Expression.ExpressionObject) => {\n        if (expressionObject.ns !== event.ns || !expressionObject.deps || expressionObject.deps.length < 1) {\n          return false;\n        }\n        const eventTablePaths = this.buildEntityPath(event.path);\n        const info = this.analysis(event, expressionObject);\n        if (!info) {\n          return false;\n        }\n        // const eventEntityPath = this.buildEntityPath(event.path);\n        // 主表新增\n        if (eventTablePaths.length === 0) {\n          if (expressionObject.bindingType === Expression.ExpressionBindingType.Field) {\n            // 认为主表新增时不需要处理聚合函数\n            return false;\n          }\n        }\n        // 从表或从从表新增\n        eventTablePaths.splice(0, 0, ENTITY_TEMPLATE);\n        // eventEntityPath like ['ENTITY~','formEEUR1E1s'] // 从表新增\n        // deps like ['ENTITY~/formEEUR1E1s/udt/udt_field','ENTITY~/formEEUR1E1s/ref/ref_udt/ref_udt_field']\n        // 仅处理上级表达式\n        if (info.eventTablePaths.length - 1 !== info.expressionTablePaths.length) {\n          return false;\n        }\n        // 不支持跨表\n        if (!info.eventTablePaths.join(Expression.DEPENDENCY_SPLITER).startsWith(info.expressionTablePaths.join(Expression.DEPENDENCY_SPLITER))) {\n          return false;\n        }\n        const index = expressionObject.deps.findIndex((dep: string) => {\n          // 依赖\n          if (!dep.startsWith(eventTablePaths.join(Expression.DEPENDENCY_SPLITER))) {\n            return false;\n          }\n          const deps = dep.split(Expression.DEPENDENCY_SPLITER).filter(p => p).slice(1);\n          const dependPathInfo = this.getPathInfo(deps.join(Expression.DEPENDENCY_SPLITER));\n          if (dependPathInfo && dependPathInfo.paths.join(Expression.DEPENDENCY_SPLITER) === info.eventTablePaths.join(Expression.DEPENDENCY_SPLITER)) {\n            return true;\n          }\n          return false;\n        });\n        return index === -1 ? false : true;\n      });\n      const eventTablePaths = this.buildEntityPath(event.path);\n      // 事件表中表达式（事件表本身的表达式）\n      const relativeExpressions = this.expressionObjects.filter((expressionObject: Expression.ExpressionObject) => {\n        // expressionObject.bindingType !== Expression.ExpressionBindingType.Field 暂不支持State表达式\n        if (expressionObject.ns !== event.ns) {\n          return false;\n        }\n        const expressionPathInfo = this.getPathInfo(expressionObject.path);\n        // 过滤掉非当前表的表达式\n        if (expressionPathInfo.paths.join(Expression.DEPENDENCY_SPLITER) !== eventTablePaths.join(Expression.DEPENDENCY_SPLITER)) {\n          return false;\n        }\n        // 没有依赖的表达式\n        if (!expressionObject.deps || expressionObject.deps.length < 1) {\n          return true;\n        }\n        // 仅依赖State\n        const onlyDependOnState = expressionObject.deps.every((dep: string) => dep.startsWith(STATE_TEMPLATE));\n        // 仅依赖当前表或上级表\n        // const onlyDependOnCurrentTable = expressionObject.deps.every((dep: string) => {\n        //   if (!dep.startsWith(ENTITY_TEMPLATE)) {\n        //     return false;\n        //   }\n        //   const deps = dep.split(Expression.DEPENDENCY_SPLITER).slice(1);\n        //   const dependPathInfo = this.getPathInfo(deps.join(Expression.DEPENDENCY_SPLITER));\n        //   return dependPathInfo.paths.join(Expression.DEPENDENCY_SPLITER) === eventTablePaths.join(Expression.DEPENDENCY_SPLITER) || eventTablePaths.join(Expression.DEPENDENCY_SPLITER).startsWith(dependPathInfo.paths.join(Expression.DEPENDENCY_SPLITER)) && dependPathInfo.paths.length + 1 == eventTablePaths.length;\n        // });\n        // if (onlyDependOnState || onlyDependOnCurrentTable) {\n        //   return true;\n        // }\n        if (onlyDependOnState) {\n          return true;\n        }\n        const result = this.analysis(event, expressionObject);\n        if (result && result.distance === 0 && result.isSameTable) {\n          return true;\n        }\n        // 事件表表达式，但依赖下级表的未计算\n        return false;\n      });\n      return groupExpressions.concat(relativeExpressions);\n    }\n    return null;\n  }\n  /**\n   * 发布事件\n   * @param event event\n   */\n  public dispatch(event: Expression.EventArgs) {\n    const expressions = this.filter(event);\n    if (expressions && expressions.length > 0) {\n      expressions.forEach((expressionObject: Expression.ExpressionObject) => {\n        const entityContext = this.buildEntityContext(event, expressionObject);\n        const context = this.buildContext(expressionObject, event, entityContext);\n        const result = this.perform(expressionObject, context);\n        if (result === undefined && !this.isValidateOrRequiredExpression(expressionObject)) {\n          return;\n        }\n        expressionObject.result = result;\n        if (expressionObject.id) {\n          this.expressionResult.set(expressionObject.id, expressionObject.result);\n        } else {\n          console.warn(`EventHandler 表达式未设置唯一标识，无法更新表达式值。`);\n        }\n        this.effect(event, expressionObject);\n      });\n    }\n  }\n  /**\n   * 获取子表事件行\n   * @param paths \n   * @param event \n   * @returns \n   */\n  public getCurrentRowByEvent(paths: string[], event: Expression.EventArgs): null | { [prop: string]: any } {\n    return this.getCurrentRowByPaths(paths);\n  }\n  /**\n   * 新增副作用器\n   * @param event event\n   * @param expressionObject 表达式\n   * @returns \n   */\n  public effect(event: Expression.EventArgs, expressionObject: Expression.ExpressionObject): void {\n    const effectTo = expressionObject.bindingType;\n    const eventPath = this.cleanEventPath(event.path);\n    const effector = this.effectorFactory.getEffector(expressionObject);\n    if (!effector) {\n      return;\n    }\n    const info = this.analysis(event, expressionObject);\n    if (!info) {\n      console.warn(`[BindingDataAppendObjectEventHandler][analysis]获取路径信息失败。`);\n      return;\n    }\n    const expressionPaths = expressionObject.path.split('/').filter(p => p);\n    if (effectTo === Expression.ExpressionBindingType.Field) {\n      const paths: any[][] = [];\n      const propertyPaths = expressionPaths.slice(info.expressionTablePaths.length);\n      // 新增场景仅需要计算事件表及事件表上面的表\n      if (info.distance === 0) {\n        if (!info.isSameTable) {\n          return;\n        }\n        // 表达式和事件在同一个表\n        const prevPaths = eventPath.slice(0);\n        if (eventPath.length === 1) {\n          // 主表新增，此时事件路径中有主键，直接拼接属性就是完整路径\n          if (event.value && Array.isArray(event.value)) {\n            event.value.forEach((bindingObject: BindingObject) => {\n              paths.push([bindingObject.primaryKeyValue].concat(propertyPaths));\n            });\n          } else {\n            const path = prevPaths.concat(propertyPaths);\n            paths.push(path);\n          }\n        } else {\n          // 从表或从从表新增，此时事件路径中缺少最后一个层级的主键\n          if (event.value && Array.isArray(event.value)) {\n            event.value.forEach((bindingObject: BindingObject) => {\n              paths.push(prevPaths.concat([bindingObject.primaryKeyValue]).concat(propertyPaths));\n            });\n          } else {\n            const bindingList = this.bindingData.getValue(info.eventTablePaths) as BindingList;\n            if (bindingList && bindingList.currentId) {\n              paths.push(prevPaths.concat(bindingList.currentId).concat(propertyPaths));\n            }\n          }\n        }\n      } else {\n        // 表达式和事件不在同一个表，即下级表新增或批量新增了一批数据\n        if (info.eventFromParent === true) {\n          // 在过滤时这种情况的应该就排除掉了\n          console.warn(`[BindingDataAppendObjectEventHandler][effect_error]`);\n          return;\n        } else if (info.eventFromChildren === true) {\n          const prevPaths = eventPath.slice(0, eventPath.length - 1);\n          const path = prevPaths.concat(propertyPaths);\n          paths.push(path);\n        } else {\n          console.warn(`[BindingDataAppendObjectEventHandler][effect_error]`);\n          return;\n        }\n      }\n      paths.forEach((path: any[]) => {\n        const currentRows = this.buildCurrentRows(info.expressionTablePaths, path);\n        this.output(event, expressionObject, currentRows, effector, [path]);\n      });\n    } else if (effectTo === Expression.ExpressionBindingType.State) {\n      console.error('not supported！');\n    }\n  }\n  public output(event: Expression.EventArgs, expressionObject: Expression.ExpressionObject, currentRows: Expression.ICurrentRow[], effector: Expression.Effector, paths: any[][]) {\n    const context = this.buildContext(expressionObject, event, null, currentRows);\n    const value = this.perform(expressionObject, context);\n    if (value === undefined) {\n      return;\n    }\n    expressionObject.result = value;\n    if (expressionObject.id) {\n      this.expressionResult.set(expressionObject.id, expressionObject.result);\n    }\n    EffectorManager.effect(effector, { eventType: event.type, ...expressionObject }, paths);\n  }\n}","import { EffectorManager } from '../effector/effector_manager';\nimport { BindingList } from '../../binding-data/index';\nimport { DataPropInfo } from '../../entity/index';\nimport { Entity, EntityList } from '../../entity/index';\nimport { Expression } from '../expression/index';\nimport { ENTITY_TEMPLATE } from '../resolver/index';\nimport { ExpressionUtil } from '../utils/expression_util';\nimport { EventHandler } from './event_handler';\n\nexport class BindingDataValueChangeEventHandler extends EventHandler {\n\n  public filter(event: Expression.EventArgs) {\n    if (this.expressionObjects && this.expressionObjects.length > 0) {\n      return this.expressionObjects.filter((expressionObject: Expression.ExpressionObject) => {\n        const deps = expressionObject.deps;\n        if (!deps || deps.length < 1 || event.ns !== expressionObject.ns) {\n          return false;\n        }\n        const eventEntityPaths = this.getEntityPath(event.path);\n        eventEntityPaths.splice(0, 0, ENTITY_TEMPLATE);\n        return deps.includes(eventEntityPaths.join('/'));\n      });\n    }\n    return null;\n  }\n\n  /**\n   * 发布事件\n   * @param event event\n   */\n  public dispatch(event: Expression.EventArgs) {\n    const expressions = this.filter(event);\n    if (expressions && expressions.length > 0) {\n      expressions.forEach((expressionObject: Expression.ExpressionObject) => {\n        this.effect(event, expressionObject);\n      });\n    }\n  }\n\n  /**\n   * 输出副作用\n   * @param event event\n   * @param expressionObject 表达式\n   * @returns \n   */\n  public effect(event: Expression.EventArgs, expressionObject: Expression.ExpressionObject): void {\n    // 首先计算当前表达式和事件会影响那些路径\n    const effector = this.effectorFactory.getEffector(expressionObject);\n    if (!effector) {\n      return;\n    }\n    const result = this.analysis(event, expressionObject);\n    if (!result) {\n      return;\n    }\n    const eventPaths = this.cleanEventPath(event.path);\n    const paths: any[][] = [];\n    if (result.distance === 0) {\n      // 值变化之后影响到了一个表内字段或影响到了同级表字段\n      if (result.isSameTable === false) {\n        // 同级表跳过\n        console.warn(`[BindingDataValueChangeEventHandler]不支持多对多关系。`);\n        return;\n      }\n      const prevPaths = eventPaths.slice(0, eventPaths.length - result.eventPropertyNames.length);\n      const path = prevPaths.concat(result.expressionPropertyNames);\n      const currentRows = this.buildCurrentRows(result.eventTablePaths, path);\n      paths.push(path);\n      this.output(event, expressionObject, currentRows, effector, paths);\n    } else {\n      if (result.eventFromChildren === true) {\n        if (result.distance > 1) {\n          return;\n        }\n        // 下级表值变化影响到了上级表的表达式\n        const prevPaths = eventPaths.slice(0, eventPaths.length - result.eventPropertyNames.length - 2);\n        const path = prevPaths.concat(result.expressionPropertyNames);\n        paths.push(path);\n        const currentRows = this.buildCurrentRows(result.eventTablePaths, eventPaths);\n        this.output(event, expressionObject, currentRows, effector, paths);\n      } else if (result.eventFromParent === true) {\n        if (result.distance > 1) {\n          console.warn(`[BindingDataValueChangeEventHandler]不支持多对多关系。`);\n          return;\n        }\n        // 上级表值变化影响到了下级表的表达式\n        const prevPaths = eventPaths.slice(0, eventPaths.length - result.eventPropertyNames.length);\n        // 添加下级表nodecode到路径中\n        prevPaths.push(result.expressionTablePaths.slice(0).pop());\n        // 遍历子表\n        const bindingPaths = result.expressionTablePaths;\n        const primaryKeyValue = eventPaths[0];\n        if (!primaryKeyValue) {\n          return;\n        }\n        let object = this.frameContext.repository.entityCollection.getEntityById(primaryKeyValue);\n        // prevPaths like [1,c,1.1,cc]\n        for (let index = 1; index < prevPaths.length; index++) {\n          const propertyName = prevPaths[index];\n          if (object instanceof EntityList) {\n            object = object.get(propertyName);\n          } else {\n            object = object[propertyName];\n          }\n        }\n        const list = object;\n        if (list && list instanceof EntityList && list.count() > 0) {\n          for (let entity of list) {\n            if (entity && entity.primaryValue) {\n              const path = prevPaths.concat([entity.primaryValue]).concat(result.expressionPropertyNames);\n              const currentRows = this.buildCurrentRows(result.expressionTablePaths, path);\n              this.output(event, expressionObject, currentRows, effector, [path]);\n            }\n          }\n        }\n      } else {\n        // 跨表\n      }\n    }\n  }\n  public output(event: Expression.EventArgs, expressionObject: Expression.ExpressionObject, currentRows: Expression.ICurrentRow[], effector: Expression.Effector, paths: any[][]) {\n    const context = this.buildContext(expressionObject, event, null, currentRows);\n    const value = this.perform(expressionObject, context);\n    if (value === undefined) {\n      return;\n    }\n    expressionObject.result = value;\n    if (expressionObject.id) {\n      this.expressionResult.set(expressionObject.id, expressionObject.result);\n    }\n    EffectorManager.effect(effector, expressionObject, paths);\n  }\n  /**\n   * 获取子表事件行\n   * @param paths \n   * @param event \n   * @returns \n   */\n  public getCurrentRowByEvent(paths: string[], event: Expression.EventArgs): null | { [prop: string]: any } {\n    event = JSON.parse(JSON.stringify(event));\n    let result = null;\n    const bindingList: BindingList = this.bindingData.getValue(paths) as BindingList;\n    const eventEntityPath = this.getEntityPath(event.path);\n    if (bindingList && bindingList.length > 0) {\n      let primaryValue = bindingList.currentItem.primaryKeyValue || null;\n      // 使用事件中的主键\n      const childrenPaths = ExpressionUtil.getAvailableChildrenPathsFromEntityPaths(eventEntityPath, this.repository.entityTypeInfo);\n      if (childrenPaths && childrenPaths.toString() === paths.toString()) {\n        // 发生值变化的数据位于要获取当前行的子表中，此时事件行应该是发生值变化的数据id，而不是当前行id\n        primaryValue = event.id || null;\n        if (!primaryValue) {\n          primaryValue = this.getEventId(event.path, paths[paths.length - 1]);\n        }\n      }\n      if (primaryValue) {\n        const bindingObject = bindingList.findById(primaryValue);\n        if (bindingObject) {\n          result = bindingObject.toJSON();\n        }\n      }\n    }\n    return result;\n  }\n}","import { EffectorManager } from \"../effector/effector_manager\";\nimport { Expression } from \"../expression\";\nimport { ENTITY_TEMPLATE } from \"../resolver/index\";\nimport { ExpressionUtil } from \"../utils/expression_util\";\nimport { EventHandler } from \"./event_handler\";\n\n/**\n * 删除数据时需要计算的表达式\n * 1、依赖被删除数据表的上级表达式（不考虑同表内的聚合依赖）\n */\nexport class BindingDataRemoveObjectEventHandler extends EventHandler {\n\n  /**\n   * 过滤出需要计算的表达式\n   * @param event event\n   * @returns \n   */\n  public filter(event: Expression.EventArgs) {\n    if (this.expressionObjects && this.expressionObjects.length > 0) {\n      // 找到聚合相关表达式\n      const expressions = this.expressionObjects.filter((expressionObject: Expression.ExpressionObject) => {\n        if (expressionObject.ns !== event.ns || !expressionObject.deps || expressionObject.deps.length < 1) {\n          return false;\n        }\n        const info = this.analysis(event, expressionObject);\n        if (!info) {\n          return false;\n        }\n        // event.path like [id:xxxx] or [id:xxxx,子表s]\n        const eventTablePaths = this.buildEntityPath(event.path);\n        // 主表删除\n        if (eventTablePaths.length === 0) {\n          if (expressionObject.bindingType === Expression.ExpressionBindingType.Field) {\n            return false;\n          }\n        }\n        // 从表或从从表删除\n        eventTablePaths.splice(0, 0, ENTITY_TEMPLATE);\n        // eventEntityPath like ['ENTITY~','formEEUR1E1s'] // 从表新增\n        // deps like ['ENTITY~/formEEUR1E1s/udt/udt_field','ENTITY~/formEEUR1E1s/ref/ref_udt/ref_udt_field']\n        // 仅处理上级表达式\n        if (info.eventTablePaths.length - 1 !== info.expressionTablePaths.length) {\n          return false;\n        }\n        // 不支持跨表\n        if (!info.eventTablePaths.join(Expression.DEPENDENCY_SPLITER).startsWith(info.expressionTablePaths.join(Expression.DEPENDENCY_SPLITER))) {\n          return false;\n        }\n        const index = expressionObject.deps.findIndex((dep: string) => {\n          // 依赖\n          if (!dep.startsWith(eventTablePaths.join(Expression.DEPENDENCY_SPLITER))) {\n            return false;\n          }\n          const deps = dep.split(Expression.DEPENDENCY_SPLITER).filter(p => p).slice(1);\n          const dependPathInfo = this.getPathInfo(deps.join(Expression.DEPENDENCY_SPLITER));\n          if (dependPathInfo && dependPathInfo.paths.join(Expression.DEPENDENCY_SPLITER) === info.eventTablePaths.join(Expression.DEPENDENCY_SPLITER)) {\n            return true;\n          }\n          return false;\n        });\n        return index === -1 ? false : true;\n      });\n      return expressions;\n    }\n  }\n  /**\n   * 发布事件\n   * @param event event\n   */\n  public dispatch(event: Expression.EventArgs) {\n    const expressions = this.filter(event);\n    if (expressions && expressions.length > 0) {\n      expressions.forEach((expressionObject: Expression.ExpressionObject) => {\n        const entityContext = this.buildEntityContext(event, expressionObject);\n        const context = this.buildContext(expressionObject, event, entityContext);\n        const result = this.perform(expressionObject, context);\n        if (result === undefined && !this.isValidateOrRequiredExpression(expressionObject)) {\n          return;\n        }\n        expressionObject.result = result;\n        if (expressionObject.id) {\n          this.expressionResult.set(expressionObject.id, expressionObject.result);\n        }\n        this.effect(event, expressionObject);\n      });\n    }\n  }\n  /**\n   * 删除副作用器\n   * @param event event\n   * @param expressionObject 表达式\n   * @returns \n   */\n  public effect(event: Expression.EventArgs, expressionObject: Expression.ExpressionObject): void {\n    const effectTo = expressionObject.bindingType;\n    const eventPath = this.cleanEventPath(event.path);\n    const effector = this.effectorFactory.getEffector(expressionObject);\n    if (!effector) {\n      return;\n    }\n    const info = this.analysis(event, expressionObject);\n    if (!info) {\n      console.warn(`[BindingDataRemoveObjectEventHandler][analysis]获取路径信息失败。`);\n      return;\n    }\n    const expressionPaths = expressionObject.path.split('/').filter(p => p);\n    if (effectTo === Expression.ExpressionBindingType.Field) {\n      const paths: any[][] = [];\n      const propertyPaths = expressionPaths.slice(info.expressionTablePaths.length);\n      // 删除场景仅需要计算事件表上面的表\n      if (info.distance !== 0) {\n        // 表达式和事件不在同一个表，即下级表删除了一批数据\n        if (info.eventFromParent === true) {\n          // 在过滤时这种情况的应该就排除掉了\n          console.warn(`[BindingDataRemoveObjectEventHandler][effect_error]`);\n          return;\n        } else if (info.eventFromChildren === true) {\n          const prevPaths = eventPath.slice(0, eventPath.length - 1);\n          const path = prevPaths.concat(propertyPaths);\n          paths.push(path);\n        } else {\n          console.warn(`[BindingDataRemoveObjectEventHandler][effect_error]`);\n          return;\n        }\n      }\n      EffectorManager.effect(effector, expressionObject, paths);\n    } else if (effectTo === Expression.ExpressionBindingType.State) {\n      console.error('not supported！');\n    }\n  }\n  /**\n   * 获取子表事件行\n   * @param paths \n   * @param event \n   * @returns \n   */\n  public getCurrentRowByEvent(paths: string[], event: Expression.EventArgs): null | { [prop: string]: any } {\n    return this.getCurrentRowByPaths(paths);\n  }\n}","import { Expression } from \"../expression/index\";\nimport { EventHandler } from \"./event_handler\";\n\nexport class BindingDataLoadEventHandler extends EventHandler {\n  public filter(event: Expression.EventArgs) {\n    // 过滤第一次空load\n    if ((!event.path || event.path.length === 0) && event.value && Array.isArray(event.value) && event.value.length === 0) {\n      return null;\n    }\n    // 数据加载完成后需要计算当前绑定路径下的只读、必填、校验表达式\n    if (this.expressionObjects && this.expressionObjects.length > 0) {\n      const expressions = this.expressionObjects.filter((expressionObject: Expression.ExpressionObject) => {\n        if (expressionObject.ns !== event.ns || (expressionObject.type !== Expression.ExpressionType.Readonly && expressionObject.type !== Expression.ExpressionType.Visible && expressionObject.type !== Expression.ExpressionType.Required && expressionObject.type !== Expression.ExpressionType.Validate )) {\n          return false;\n        }\n        const result = this.analysis(event, expressionObject);\n        if (!result) {\n          return false;\n        }\n        return result.distance === 0 && result.isSameTable;\n      });\n      return expressions;\n    } else {\n      return null;\n    }\n  }\n  /**\n   * 发布事件\n   * @param event event\n   */\n  public dispatch(event: Expression.EventArgs) {\n    const expressions = this.filter(event);\n    if (expressions && expressions.length > 0) {\n      expressions.forEach((expressionObject: Expression.ExpressionObject) => {\n        const entityContext = this.buildEntityContext(event, expressionObject);\n        const context = this.buildContext(expressionObject, event, entityContext);\n        const result = this.perform(expressionObject, context);\n        if (result === undefined && !this.isValidateOrRequiredExpression(expressionObject)) {\n          return;\n        }\n        expressionObject.result = result;\n        if (expressionObject.id) {\n          this.expressionResult.set(expressionObject.id, expressionObject.result);\n        }\n        this.effect(event, expressionObject);\n      });\n    }\n  }\n  /**\n   * 获取子表事件行\n   * @param paths \n   * @param event \n   * @returns \n   */\n  public getCurrentRowByEvent(paths: string[], event: Expression.EventArgs): null | { [prop: string]: any } {\n    return this.getCurrentRowByPaths(paths);\n  }\n}","import { Expression } from \"../expression/index\";\nimport { ENTITY_TEMPLATE } from \"../resolver/index\";\nimport { EventHandler } from \"./event_handler\";\n\nexport class BindingDataSelectionChangedEventHandler extends EventHandler {\n\n  /**\n   * 过滤出需要计算的表达式\n   * @param event event\n   * @returns \n   */\n  public filter(event: Expression.EventArgs) {\n    if (this.expressionObjects && this.expressionObjects.length > 0) {\n      return this.expressionObjects.filter((expressionObject: Expression.ExpressionObject) => {\n        const deps = expressionObject.deps;\n        // 没有依赖的表达式不需要关注\n        if (!deps || deps.length < 1) {\n          return false;\n        }\n        // 不依赖实体的表达式不需要关注\n        let index = deps.findIndex(dep => dep.startsWith(ENTITY_TEMPLATE));\n        if (index === -1) {\n          return false;\n        }\n        const result = this.analysis(event, expressionObject);\n        if (!result) {\n          return false;\n        }\n        // 只关注从表行切换\n        if (result.eventTablePaths.length !== 1) {\n          return false;\n        }\n        // 只关注从从表表达式\n        if (result.expressionTablePaths.length !== 2) {\n          return false;\n        }\n        // 只关注事件直接下级的表达式，跨表的不需要关注\n        if (!result.expressionTablePaths.join('/').startsWith(result.eventTablePaths.join('/'))) {\n          return false;\n        }\n        // 从从表表达式需要依赖上级表\n        index = deps.findIndex(dep => dep.startsWith(`${ENTITY_TEMPLATE}/${result.eventTablePaths[0]}`));\n        if (index === -1) {\n          return false;\n        }\n        return true;\n      });\n    }\n    return null;\n  }\n  public dispatch(event: Expression.EventArgs): void {\n    const expressions = this.filter(event);\n    if (expressions && expressions.length > 0) {\n      expressions.forEach((expressionObject: Expression.ExpressionObject) => {\n        const entityContext = this.buildEntityContext(event, expressionObject);\n        const context = this.buildContext(expressionObject, event, entityContext);\n        const result = this.perform(expressionObject, context);\n        if (result === undefined && !this.isValidateOrRequiredExpression(expressionObject)) {\n          return;\n        }\n        expressionObject.result = result;\n        if (expressionObject.id) {\n          this.expressionResult.set(expressionObject.id, expressionObject.result);\n        }\n        this.effect(event, expressionObject);\n      });\n    }\n  }\n}","import { InjectionToken } from '../../core/index';\nimport { Expression } from './types';\n\n/**\n * 表单模块路径\n */\nexport const ASSIGNER_TOKEN = new InjectionToken('@Farris expression assigner');\nexport const EVENT_HANDLER_TOKEN = new InjectionToken('@Farris_event_handler');","import { Expression } from \"../expression/index\";\nimport { EVENT_HANDLER_TOKEN } from \"../expression/tokens\";\nimport { RepositoryAddEntityEventHandler } from \"./repository_add_entity_event_handler\";\nimport { RepositoryRemoveEntityEventHandler } from \"./repository_remove_entity_event_handler\";\nimport { EntityValueChangedEventHandler } from \"./entity_value_changed_event_handler\";\nimport { StateValueChangedEventHandler } from \"./state_value_changed_event_handler\";\nimport { EntityUpdateEventHandler } from \"./entity_update_event_handler\";\nimport { RepositoryLoadEventHandler } from \"./repository_load_event_handler\";\nimport { BindingDataAppendObjectEventHandler } from \"./binding_data_append_object_event_handler\";\nimport { BindingDataValueChangeEventHandler } from \"./binding_data_value_change_event_handler\";\nimport { BindingDataRemoveObjectEventHandler } from \"./binding_data_remove_object_event_handler\";\nimport { BindingDataLoadEventHandler } from \"./binding_data_load_event_handler\";\nimport { BindingDataSelectionChangedEventHandler } from \"./binding_data_selection_changed_event_handler\";\nimport { ViewModelContext } from '../../view-model/index';\n\nexport class EventHandlerRegistry {\n\n  public handlers: Expression.IEventHandler[];\n\n  constructor(protected viewModelContext: ViewModelContext) {\n    this.handlers = this.viewModelContext.injector.get(EVENT_HANDLER_TOKEN) as Expression.IEventHandler[];\n  }\n\n  /**\n   * 实体值变化处理器\n   */\n  public get entityValueChangedEventHandler() {\n    return this.handlers && this.handlers.find((handler: Expression.IEventHandler) => handler instanceof EntityValueChangedEventHandler);\n  }\n  /**\n   * 状态值变化处理器\n   */\n  public get stateValueChangedEventHandler() {\n    return this.handlers && this.handlers.find((handler: Expression.IEventHandler) => handler instanceof StateValueChangedEventHandler);\n  }\n  public get repositoryAddEntityEventHandler() {\n    return this.handlers && this.handlers.find((handler: Expression.IEventHandler) => handler instanceof RepositoryAddEntityEventHandler);\n  }\n  public get repositoryRemoveEntityEventHandler() {\n    return this.handlers && this.handlers.find((handler: Expression.IEventHandler) => handler instanceof RepositoryRemoveEntityEventHandler);\n  }\n  public get entityUpdateEventHandler() {\n    return this.handlers && this.handlers.find((handler: Expression.IEventHandler) => handler instanceof EntityUpdateEventHandler);\n  }\n  public get repositoryLoadEventHandler() {\n    return this.handlers && this.handlers.find((handler: Expression.IEventHandler) => handler instanceof RepositoryLoadEventHandler);\n  }\n  public get bindingDataAppendEntityEventHandler() {\n    return this.handlers && this.handlers.find((handler: Expression.IEventHandler) => handler instanceof BindingDataAppendObjectEventHandler);\n  }\n  public get bindingDataValueChangeEventHandler() {\n    return this.handlers && this.handlers.find((handler: Expression.IEventHandler) => handler instanceof BindingDataValueChangeEventHandler);\n  }\n  public get bindingDataRemoveObjectEventHandler() {\n    return this.handlers && this.handlers.find((handler: Expression.IEventHandler) => handler instanceof BindingDataRemoveObjectEventHandler);\n  }\n  public get bindingDataLoadEventHandler() {\n    return this.handlers && this.handlers.find((handler: Expression.IEventHandler) => handler instanceof BindingDataLoadEventHandler);\n  }\n  public get bindingDataSelectionChangedHandler() {\n    return this.handlers && this.handlers.find((handler: Expression.IEventHandler) => handler instanceof BindingDataSelectionChangedEventHandler);\n  }\n}","import { Injector } from \"../../core/index\";\nimport { ViewModelContext } from '../../view-model/index';\n\nimport { Core } from '../core/index';\nimport { ResolverRegistry, ResolveService } from \"../resolver/index\";\nimport { EventHandlerRegistry } from \"../event-handler/index\";\n\nimport { ExpressionRegistry } from \"./expression_registry\";\nimport { ExpressionEventEmitter } from \"./expression_event_emitter\";\nimport { Expression } from './types';\n\nexport class ExpressionEngineImpl {\n\n  private expressionObjects: Array<Expression.ExpressionObject> = new Array<Expression.ExpressionObject>();\n\n  private injector: Injector;\n\n  private expressionRegistry: ExpressionRegistry;\n\n  private expressionEventEmitter: ExpressionEventEmitter;\n\n  private resolverRegistry: ResolverRegistry;\n\n  private eventHandlerRegistry: EventHandlerRegistry;\n\n  private resolveService: ResolveService;\n\n  constructor(private viewModelContext: ViewModelContext) {\n    this.injector = this.viewModelContext.injector;\n    this.expressionRegistry = this.injector.get(ExpressionRegistry);\n    this.expressionEventEmitter = this.injector.get(ExpressionEventEmitter);\n    this.resolverRegistry = this.injector.get(ResolverRegistry);\n    this.eventHandlerRegistry = this.injector.get(EventHandlerRegistry);\n    this.resolveService = this.injector.get(ResolveService);\n\n    this.expressionRegistry.expressions.subscribe((exprs: Expression.ExpressionObject[]) => {\n      if (exprs && exprs.length > 0) {\n        this.expressionObjects = exprs;\n        // 解析表达式依赖\n        this.resolveDependency();\n      }\n      this.attachEvent();\n    });\n  }\n\n  private attachEvent() {\n    this.expressionEventEmitter.attach().subscribe((events: Expression.EventArgs[]) => {\n      if (!events || events.length < 1 || !this.expressionObjects || this.expressionObjects.length < 1) {\n        return;\n      }\n      events.forEach((event: Expression.EventArgs) => {\n        const handler = this.getEventHandler(event);\n        if (handler) {\n          handler.handleEvent(event, this.expressionObjects);\n        } else {\n          Core.warn(`没有对应的事件处理器,event=${event.type}`);\n        }\n      });\n    });\n  }\n  /**\n   * 解析表达式依赖\n   * @returns \n   */\n  private resolveDependency() {\n    if (!this.resolverRegistry || !this.resolverRegistry.resolvers || this.resolverRegistry.resolvers.length < 1 || !this.expressionObjects || this.expressionObjects.length < 1 || !Array.isArray(this.expressionObjects)) {\n      return;\n    }\n    this.expressionObjects.forEach((expressionObject: Expression.ExpressionObject) => {\n      const expression = expressionObject.expression;\n      const dependencies = this.resolveService.resolve(expression);\n      expressionObject.deps = dependencies;\n    });\n  }\n  /**\n   * 获取表达式事件处理器\n   * @param event event\n   * @returns \n   */\n  private getEventHandler(event: Expression.EventArgs): Expression.IEventHandler {\n    if (event.type === Expression.EventType.ValueChanged) {\n      // 实体值变化\n      if (event.source === Expression.EventSource.BindingData) {\n        return this.eventHandlerRegistry.bindingDataValueChangeEventHandler;\n      } else if (event.source === Expression.EventSource.Field) {\n        return this.eventHandlerRegistry.entityValueChangedEventHandler;\n      } else if (event.source === Expression.EventSource.State) {\n        return this.eventHandlerRegistry.stateValueChangedEventHandler;\n      }\n    } else if (event.type === Expression.EventType.Append) {\n      if (event.source === Expression.EventSource.Repository || event.source === Expression.EventSource.Field) {\n        return this.eventHandlerRegistry.repositoryAddEntityEventHandler;\n      } else if (event.source === Expression.EventSource.BindingData) {\n        return this.eventHandlerRegistry.bindingDataAppendEntityEventHandler;\n      }\n    } else if (event.type === Expression.EventType.Remove) {\n      if (event.source === Expression.EventSource.Repository || event.source === Expression.EventSource.Field) {\n        return this.eventHandlerRegistry.repositoryRemoveEntityEventHandler;\n      } else if (event.source === Expression.EventSource.BindingData) {\n        return this.eventHandlerRegistry.bindingDataRemoveObjectEventHandler;\n      }\n    } else if (event.type === Expression.EventType.Update) {\n      if (event.source === Expression.EventSource.Repository) {\n        return this.eventHandlerRegistry.entityUpdateEventHandler;\n      }\n    } else if (event.type === Expression.EventType.Load) {\n      if (event.source === Expression.EventSource.Repository || event.source === Expression.EventSource.Field) {\n        return this.eventHandlerRegistry.repositoryLoadEventHandler;\n      } else if (event.source === Expression.EventSource.BindingData) {\n        return this.eventHandlerRegistry.bindingDataLoadEventHandler;\n      }\n    } else if (event.type === Expression.EventType.SelectionChanged) {\n      if (event.source === Expression.EventSource.BindingData) {\n        return this.eventHandlerRegistry.bindingDataSelectionChangedHandler;\n      }\n    }\n    return null;\n  }\n}\n","import { Injector } from \"../../core/index\";\nimport { ViewModelContext } from \"../../view-model/index\";\n\n/**\n * 表达式计算结果\n */\nexport class ExpressionResult {\n\n  constructor(private viewModelContext: ViewModelContext) {\n  }\n\n  /**\n   * 更新表达式的值\n   * @param expressionId 表达式id\n   * @param result \n   */\n  public set(expressionId: string, result: any) {\n    this[expressionId] = result;\n  }\n}","import { EMPTY, Observable, of } from \"rxjs\";\nimport { Injector } from '../../core/index';\n\nimport { AppContext } from \"../../app/index\";\nimport { Entity, EntityList } from \"../../entity/index\";\nimport { Repository } from \"../../repository/index\";\nimport { BindingData, BindingList, BindingObject } from \"../../binding-data/index\";\nimport { ViewModelContext, ViewModel } from \"../../view-model/index\";\n\nimport { IMessageService, INotifyService, MESSAGE_SERVICE_TOKEN, NOTIFY_SERVICE_TOKEN } from \"../core/index\";\nimport { ENTITY_TEMPLATE, ResolveService } from \"../resolver/index\";\nimport { ExpressionUtil } from \"../utils/expression_util\";\n\nimport { ExpressionExecutor } from \"./expression_executor\";\nimport { ExpressionRegistry } from \"./expression_registry\";\nimport { Expression } from './types';\nimport { ExpressionResult } from \"./expression_result\";\n\n\nexport class ExpressionManager {\n\n  private injector: Injector;\n\n  private resolveService: ResolveService;\n\n  private expressionExecutor: ExpressionExecutor;\n\n  private expressionRegistry: ExpressionRegistry;\n\n  private expressionResult: ExpressionResult;\n\n  private messageService: IMessageService;\n\n  private notifyService: INotifyService;\n\n  constructor(private frameContext: ViewModelContext) {\n    this.injector = this.frameContext.injector;\n    this.resolveService = this.injector.get(ResolveService);\n    this.expressionExecutor = this.injector.get(ExpressionExecutor);\n    this.expressionRegistry = this.injector.get(ExpressionRegistry);\n    this.expressionResult = this.injector.get(ExpressionResult);\n    this.messageService = this.injector.get(MESSAGE_SERVICE_TOKEN, null);\n    this.notifyService = this.injector.get(NOTIFY_SERVICE_TOKEN, null);\n  }\n\n  /**\n   * 根据表达式id进行计算\n   * @param expressionId 表达式id\n   * @param viewModel viewModel\n   * @param rowData rowData\n   * @returns \n   */\n  public eval(expressionId: string, viewModel?: ViewModel, rowData?: any) {\n    const expressionObject = this.expressionRegistry.getExpressionById(expressionId);\n    if (expressionObject) {\n      const customContext: Expression.ICustomContext = {};\n      const bindingPath = viewModel && viewModel.bindingPath || null;\n      if (bindingPath && rowData) {\n        const bindingPaths = bindingPath.split('/').filter(p => p);\n        const bindingList = this.frameContext.bindingData.getValue(bindingPaths) as BindingList;\n        let primaryKey = 'id';\n        if (bindingList) {\n          primaryKey = bindingList.primaryKey;\n        }\n        const primaryValue = rowData[primaryKey];\n        if (primaryValue) {\n          customContext.currentRows = [{ bindingPath: bindingPaths.join('/'), primaryValue }];\n        }\n      }\n      const result = this.execute(expressionObject.expression, customContext);\n      this.expressionResult.set(expressionId, result);\n      return result;\n    } else {\n      // console.warn('ExpressionManager 执行失败，未获取到表达式!');\n    }\n    return undefined;\n  }\n  public validate(expressionId: string, options: any) {\n    const expressionObject = this.expressionRegistry.getExpressionById(expressionId);\n    if (expressionObject) {\n      const patch = options && options.patch || null;\n      const customContext: Expression.ICustomContext = {};\n      if (patch) {\n        customContext.patch = patch;\n      }\n      const currentRow = options.currentRow || null;\n      if (currentRow) {\n        customContext.currentRows = customContext.currentRows || [];\n        customContext.currentRows.push(currentRow);\n      }\n      const result = this.execute(expressionObject.expression, customContext);\n      this.expressionResult.set(expressionId, result);\n      return result;\n    } else {\n      console.warn('ExpressionManager 执行失败，未获取到表达式!');\n    }\n    return undefined;\n  }\n  /**\n   * 帮助前封装\n   * @param event \n   */\n  public onDataPicking(configs: { expressionId: string }) {\n    const expressionId = configs && configs.expressionId || null;\n    if (!expressionId) {\n      console.warn(`ExpressionManager 相关表达式设置错误，没有表达式编号。`);\n      return of(true);\n    }\n    const result = this.eval(expressionId);\n    if (!result) {\n      const expressionObject = this.expressionRegistry.getExpressionById(expressionId);\n      if (!expressionObject) {\n        console.warn(`ExpressionManager 无法找到对应的表达式${expressionId}`);\n        return of(true);\n      }\n      const messageType = expressionObject.messageType || Expression.MessageType.warning;\n      const message = expressionObject.message;\n      if (message) {\n        this.notifyService[messageType](message, { hideTitle: true });\n      }\n      return EMPTY;\n    }\n    return of(result);\n  }\n  /**\n   * 执行表达式计算\n   * @param expression 表达式\n   * @param customContext 自定义上下文\n   * @returns \n   */\n  private execute(expression: string, customContext?: Expression.ICustomContext): any {\n    const deps = this.resolveService.resolve(expression);\n    const groupDependencies = ExpressionUtil.getGroupFunctionDependency(expression, this.frameContext.repository.entityTypeInfo);\n    const entityContext = this.buildEntityContext(deps, groupDependencies, customContext);\n    const stateContext = this.buildStateContext();\n    const data = customContext && customContext.contexts || null;\n    const context = {\n      [this.entityOriginalNodeCode]: entityContext,\n      ...stateContext,\n      frameContext: this.frameContext,\n      bindingData: this.frameContext.bindingData,\n      repository: this.frameContext.repository,\n      ...data\n    }\n    if (!entityContext) {\n      return undefined;\n    }\n    return this.expressionExecutor.eval(expression, context);\n  }\n  /**\n   * 执行表达式（返回可观察对象）\n   * @param expression 表达式\n   * @param customContext 自定义上下文\n   * @returns \n   */\n  private executeAsync(expression: string, customContext?: Expression.ICustomContext): Observable<any> {\n    const result = this.execute(expression, customContext);\n    return of(result);\n  }\n  /**\n   * 构造实体上下文\n   * @param deps \n   * @param groupDependencies \n   * @param context \n   * @returns \n   */\n  private buildEntityContext(deps: string[], groupDependencies: string[], context?: Expression.ICustomContext) {\n\n    const currentRows = context && context.currentRows || null;\n    const index = deps.findIndex((dep: string) => {\n      const isEntityDependency = this.isEntityDependency(dep);\n      // 如果依赖的是state，无需处理，现在需要确定的是返回多少实体的问题，和state没有关系\n      // 表达式依赖了实体\n      if (isEntityDependency) {\n        const isGroupDependency = groupDependencies.findIndex(item => item === dep) !== -1;\n        // 是聚合依赖\n        if (isGroupDependency) {\n          const dependencyLength = dep.split('/').filter(p => p).length - 1;\n          if (dependencyLength === 1) {\n            // 聚合了主表字段，所有主表数据都需要参与运算，此时已经确定计算的实体上下文了。\n            return true;\n          } else {\n            // 聚合了子表字段，只需要传递当前实体\n            return false;\n          }\n        } else {\n          // 当前依赖不是聚合，只需要传递当前实体\n          return false;\n        }\n      }\n      return false;\n    })\n    const isGroupdMainEntity = index !== -1;\n\n    const options = {};\n    if (currentRows && currentRows.length > 0) {\n      currentRows.forEach((currentRow: Expression.ICurrentRow) => {\n        options[currentRow.bindingPath || '/'] = currentRow.primaryValue;\n      });\n    }\n    const entity = this.getEntity(options);\n    const patch = context && context.patch || null;\n    if (!entity) {\n      return null;\n    }\n    if (patch && Object.keys(patch).length > 0) {\n      Object.keys(patch).forEach((key: string) => {\n        const paths = key.split('/').filter(p => p);\n        const value = patch[key];\n        this.setValue(entity, paths, value);\n      });\n    }\n    if (isGroupdMainEntity) {\n      const collection = this.frameContext.repository.entityCollection.toJSON();\n      entity['__type__'] = 'List';\n      entity['__items__'] = collection;\n    }\n    return entity;\n  }\n  private setValue(target: any, paths: string[], value: any) {\n    if (paths.length === 1) {\n      target[paths[0]] = value;\n    } else {\n      const propertyName = paths.pop();\n      const result = paths.reduce((object: any, path: string) => {\n        return object && object[path];\n      }, target);\n      result[propertyName] = value;\n    }\n  }\n  /**\n   * 是否为实体依赖\n   * @param dep \n   * @returns \n   */\n  private isEntityDependency(dep: string) {\n    return dep.startsWith(ENTITY_TEMPLATE);\n  }\n  /**\n   * 获取实体\n   * @param options \n   * @returns \n   */\n  public getEntity(options: { [bindingPath: string]: string }) {\n    const entityTypeInfo = this.frameContext.repository.entityTypeInfo;\n    const bindingData = this.frameContext.bindingData;\n    const childrenEntityPaths = [];\n\n    let entity = null;\n    if (options['/']) {\n      // 修正主表\n      entity = this.frameContext.bindingData.list.findById(options['/']);\n      if (entity) {\n        entity = entity.toJSON();\n      }\n    } else {\n      entity = this.frameContext.bindingData.list.currentItem.toJSON();\n    }\n    if (!entity) {\n      return null;\n    }\n    ExpressionUtil.getChildrenEntityPaths(entityTypeInfo, childrenEntityPaths);\n    entity['__type__'] = 'Entity';\n    if (!childrenEntityPaths || childrenEntityPaths.length < 1) {\n      return entity;\n    }\n    // 找到所有子表\n    childrenEntityPaths.forEach((paths: string[]) => {\n      let row = null;\n      if (options && options[paths.join('/')]) {\n        // 不应该使用bindingData，这样就默认使用了当前行\n        const bindingList: BindingList = bindingData.getValue(paths) as BindingList;\n        const currentRowId = options[paths.join('/')];\n        let currentRow: BindingObject = null;\n        if (currentRowId !== bindingList.currentId) {\n          currentRow = bindingList.findById(currentRowId);\n        } else {\n          currentRow = bindingList.currentItem;\n        }\n\n        if (currentRow && currentRow.primaryKeyValue) {\n          row = currentRow.toJSON();\n        }\n      } else {\n        // 如果上级表已经切换了当前行，那么下级表也应该切换\n        const parentTableCurrentRowChanged = options && !!Object.keys(options).find(path => {\n          const fullPath = path.split('/').join('/');\n          return paths.join('/').startsWith(fullPath);\n        }) || false;\n        if (parentTableCurrentRowChanged) {\n          const primaryValue = options && options['/'] || bindingData.list.currentId;\n          const entity = this.frameContext.repository.entityCollection.getEntityById(primaryValue);\n          const fullPaths = [];\n          const data = paths.reduce((object, path) => {\n            fullPaths.push(path);\n            const item = object && object[path] as EntityList<Entity>;\n            if (item) {\n              const currentRowId = options && options[fullPaths.join('/')] || item.items[0] && item.items[0].primaryValue || null;\n              if (currentRowId) {\n                const currentRow = item.get(currentRowId);\n                return currentRow || null;\n              }\n            }\n            return null;\n          }, entity) as Entity;\n          if (data) {\n            row = data.toJSON();\n          } else {\n            row = {};\n          }\n        } else {\n          row = ExpressionUtil.getCurrentRowByPaths(paths, bindingData);\n        }\n      }\n      const propertyName = paths.pop();\n      let parent = paths.reduce((object: any, path: string) => {\n        return object && object[path] || null;\n      }, entity);\n      const list = parent[propertyName];\n      const node: any = { __items__: [], ...row && row || {}, __type__: 'List' };\n      node.length = () => node.__items__.length;\n      if (list && Array.isArray(list)) {\n        node.__items__ = [].concat(list);\n      }\n      parent[propertyName] = node;\n    });\n    return entity;\n  }\n  /**\n   * 获取主实体原始字段名\n   */\n  protected get entityOriginalNodeCode(): string {\n    const repository = this.injector.get(Repository);\n    return repository && repository.entityTypeInfo && repository.entityTypeInfo.entityInfo && repository.entityTypeInfo.entityInfo.originalCode || null;\n  }\n  /**\n   * 构造变量上下文\n   * @param event \n   * @returns \n   */\n  public buildStateContext() {\n    const result = {};\n    if (this.frameContext) {\n      const rootFrameContext = this.frameContext.getVirtualRootFrameContext();\n      if (rootFrameContext) {\n        const uiState = rootFrameContext.viewModel.uiState;\n        const propertyNames = Object.getOwnPropertyNames(uiState) || [];\n        propertyNames.forEach((prop: string) => {\n          if (prop.match(/^[a-zA-Z0-9_\\$]+$/g) !== null) {\n            result[prop] = uiState[prop];\n          }\n        });\n      }\n    }\n    return result;\n  }\n}","import { Injector } from \"../../core/index\";\nimport { ExpressionManager } from \"./expression_manager\";;\nimport { ExpressionRegistry } from \"./expression_registry\";\nimport { ExpressionResult } from \"./expression_result\"\nimport { Expression } from \"./types\";\nimport { ViewModelContext, ViewModel } from \"../../view-model/index\";\n\nexport class ExpressionResultFactory {\n\n  private injector: Injector;\n\n  private expressionRegistry: ExpressionRegistry;\n\n  private expressionManager: ExpressionManager;\n\n  private expressionResult: ExpressionResult\n\n  constructor(private viewModelContext: ViewModelContext) {\n\n    this.injector = this.viewModelContext.injector;\n    this.expressionRegistry = this.injector.get(ExpressionRegistry);\n    this.expressionManager = this.injector.get(ExpressionManager);\n    this.expressionResult = this.injector.get(ExpressionResult);\n\n\n    this.registeEvent();\n  }\n  private registeEvent() {\n    this.expressionRegistry.expressions.subscribe((expressionObjects: Expression.ExpressionObject[]) => {\n      // 加载完表达式之后做一次计算\n      expressionObjects.forEach((expressionObject: Expression.ExpressionObject) => {\n        if (expressionObject.deps && expressionObject.deps.length > 0) {\n          return;\n        }\n        const result = this.expressionManager.eval(expressionObject.id);\n        this.expressionResult[expressionObject.id] = result;\n      });\n    });\n  }\n}","import { ViewModelContext } from '../../view-model/index'\n\nexport class EffectUtil {\n    static getFormValueByPath(path, viewModel: ViewModelContext) {\n        if (!viewModel) return null;\n        if (!path) return null;\n        if (!viewModel.bindingData) return null;\n        // 主表\n        if (viewModel.bindingData.bindingPath === '/') {\n            return viewModel.form.getFormValueByBindPath(path)\n        }\n        // 子表\n        if (viewModel.bindingData.bindingPath && viewModel.bindingData.bindingPath.length > 1) {\n            const idnex = path.indexOf(viewModel.bindingData.bindingPath);\n            if (idnex == 0) {\n                path = path.replace(viewModel.bindingData.bindingPath + '/', '');\n                return viewModel.form.getFormValueByBindPath(path)\n            }\n        }\n        return null\n    }\n}","import { Expression } from '../expression/index';\nimport { ViewModelContext } from '../../view-model/index'\nimport { NAMESPACE } from '../core/index';\nimport { EffectUtil } from './util';\n\nexport class ReadonlyEffector implements Expression.Effector {\n    public ns: string;\n\n    constructor(private viewModelContext: ViewModelContext) {\n        this.ns = this.viewModelContext.injector.get(NAMESPACE, '');\n    }\n    public effect(path: string, value: any, options: Expression.EffectOptions) {\n        let viewModelContext: ViewModelContext;\n        if (options.viewModelId) {\n            viewModelContext = this.viewModelContext.appContext.viewModelContextManager.getContextById(options.viewModelId)\n        } else {\n            return\n        }\n        if (!viewModelContext) return;\n        if (!viewModelContext.form) return;\n        const form_anme = EffectUtil.getFormValueByPath(path, viewModelContext).form_name;\n        if (!form_anme) { return; }\n        if (value === true) {\n            form_anme['readonly'] = true;\n        } else {\n            form_anme['readonly'] = false;\n        }\n        viewModelContext.form.changes.next({ type: 'validateFieldsFinished' })\n    }\n}\n","import { Expression } from '../expression/index';\nimport { ViewModelContext } from '../../view-model/index'\nimport { NAMESPACE } from '../core/index';\nimport { FormControl } from '../../form'\nimport { EffectUtil } from './util';\n\nexport class ValidateEffector implements Expression.Effector {\n    public ns: string;\n\n    constructor(private viewModelContext: ViewModelContext) {\n        this.ns = this.viewModelContext.injector.get(NAMESPACE, '');\n    }\n    public effect(path: string, value: any, options: Expression.EffectOptions) {\n        //根据路径寻找字段\n        let viewModelContext: ViewModelContext;\n        if (options.viewModelId) {\n            viewModelContext = this.viewModelContext.appContext.viewModelContextManager.getContextById(options.viewModelId)\n        } else {\n            return\n        }\n        if (!viewModelContext) return;\n        if (!viewModelContext.form) return;\n        const formControl = EffectUtil.getFormValueByPath(path, viewModelContext);\n        const form_name = formControl.form_name as FormControl;\n        if (!form_name) {\n            return\n        }\n        // 只认false  为flase认为验证不过\n        if (value === false && options.eventType !== Expression.EventType.Append && options.eventType !== Expression.EventType.Load) {\n            form_name.validationResult = { passing: !value, message: options.message };\n        } else if (value === true) {\n            form_name.validationResult = { passing: true, message: '' }\n        }\n        const validators = [{ \"type\": \"expression\", \"constraints\": [options.expressionId], message: options.message }];\n        viewModelContext.form.addValidate(formControl.bindingPath, formControl.name);\n        form_name.pushValidatorFnforValidate(validators, true);\n    }\n}\n","import { Expression } from '../expression/index';\nimport { ViewModelContext } from '../../view-model/index'\nimport { FormControl } from '../../form'\nimport { NAMESPACE } from '../core/index';\nimport { EffectUtil } from './util';\n\nexport class RequiredEffector implements Expression.Effector {\n  public ns: string;\n\n  constructor(private viewModelContext: ViewModelContext) {\n    this.ns = this.viewModelContext.injector.get(NAMESPACE, '');\n  }\n  public effect(path: string, value: any, options: Expression.EffectOptions) {\n    let viewModelContext: ViewModelContext;\n    if (options.viewModelId) {\n      viewModelContext = this.viewModelContext.appContext.viewModelContextManager.getContextById(options.viewModelId)\n    } else {\n      return\n    }\n    if (!viewModelContext) return;\n    if (!viewModelContext.form) return;\n    const formControl = EffectUtil.getFormValueByPath(path, viewModelContext);\n    let form_name = formControl.form_name as FormControl;\n    if (!form_name) {\n      return\n    }\n    const validators = [{ \"type\": \"required\", \"constraints\": [true], message: options.message || '必填' }];\n    if (value === true) {\n      viewModelContext.form.addValidate(formControl.bindingPath, formControl.name);\n      form_name.pushValidatorFnforRequired(validators, true);\n      form_name.required = true;\n\n    } else if (value === false) {\n      form_name.required = false\n      if (form_name.getValidatorFn() && form_name.getValidatorFn().length >= 1) {\n        //去除必填\n        form_name.resetValidatorFnforRequired();\n        if (form_name.validationResult && form_name.validationResult.type === 'required') {\n          form_name.validationResult = { passing: true, message: '' };\n        }\n      }\n    }\n    viewModelContext.form.changes.next({ type: 'validateFieldsFinished'})\n  }\n}\n","import { Expression } from '../expression/index';\nimport { ViewModelContext } from '../../view-model/index'\nimport { NAMESPACE } from '../core/index';\nimport { EffectUtil } from './util';\n\nexport class VisibleEffector implements Expression.Effector {\n    public ns: string;\n\n    constructor(private viewModelContext: ViewModelContext) {\n        this.ns = this.viewModelContext.injector.get(NAMESPACE, '');\n    }\n    public effect(path: string, value: any, options: Expression.EffectOptions) {\n        let viewModelContext: ViewModelContext;\n        if (options.viewModelId) {\n            viewModelContext = this.viewModelContext.appContext.viewModelContextManager.getContextById(options.viewModelId)\n        } else {\n            return\n        }\n        if (!viewModelContext) return;\n        if (!viewModelContext.form) return;\n        const form_anme = EffectUtil.getFormValueByPath(path, viewModelContext).form_name;\n        if (!form_anme) { return; }\n        if (value === true) {\n            form_anme['visible'] = true;\n        } else {\n            form_anme['visible'] = false;\n        }\n        viewModelContext.form.changes.next({ type: 'validateFieldsFinished' })\n    }\n}\n","import { Expression } from '../expression/index';\nimport { ViewModelContext } from '../../view-model/index'\nimport { FormControl } from '../../form'\nimport { NAMESPACE } from '../core/index';\nimport { EffectUtil } from './util';\n\nexport class DependencyEffector implements Expression.Effector {\n    public ns: string;\n\n    constructor(private viewModelContext: ViewModelContext) {\n        this.ns = this.viewModelContext.injector.get(NAMESPACE, '');\n    }\n    public effect(path: string, value: any, options: Expression.EffectOptions) {\n        let viewModelContext: ViewModelContext;\n        if (options.viewModelId) {\n            viewModelContext = this.viewModelContext.appContext.viewModelContextManager.getContextById(options.viewModelId)\n        } else {\n            return\n        }\n        if (!viewModelContext.form) return;\n        const formControl = EffectUtil.getFormValueByPath(path, viewModelContext);\n        let form_name = formControl.form_name as FormControl;\n        if (!form_name) {\n            return\n        }\n        if (value === true) {\n            form_name.value = null;\n            form_name.validationResult = { passing: value, message: '' };\n        }\n    }\n}\n","import { Injector } from '../../core/index';\nimport { ViewModelContext } from '../../view-model/index';\nimport { Expression } from '../expression/index';\nimport { EffectorRegistry } from './effector_registry';\nimport { RepositoryEffector } from './repository_effector';\nimport { UIStateEffector } from './uistate_effector';\nimport { ReadonlyEffector } from './effector_readonly';\nimport { ValidateEffector } from './effector_validate';\nimport { RequiredEffector } from './effector_required';\nimport { VisibleEffector } from './effector_visible';\nimport { DependencyEffector } from './effector_dependency';\n\nexport class EffectorFactory {\n\n  private injector: Injector;\n\n  private effectorRegistry: EffectorRegistry\n\n  constructor(protected viewModelContext: ViewModelContext) {\n    this.injector = this.viewModelContext.injector;\n    this.effectorRegistry = this.injector.get(EffectorRegistry);\n  }\n\n  public getEffector(expressionObject: Expression.ExpressionObject) {\n    const path = expressionObject.path;\n    const ns = expressionObject.ns;\n    const bindingType = expressionObject.bindingType;\n    const type = expressionObject.type;\n    const nsEffectors = this.effectorRegistry.effectors.filter((effector: Expression.Effector) => effector.ns == ns);\n\n    // 计算表达式\n    if (type === Expression.ExpressionType.Compute) {\n      if (bindingType === Expression.ExpressionBindingType.Field) {\n        return nsEffectors.find((effector: Expression.Effector) => effector instanceof RepositoryEffector);\n      } else if (bindingType === Expression.ExpressionBindingType.State) {\n        return nsEffectors.find((effector: Expression.Effector) => effector instanceof UIStateEffector);\n      } else {\n        throw new Error(`不支持的绑定字段类型：${bindingType}`);\n      }\n    } else if (type === Expression.ExpressionType.Readonly) {\n      // 只读表达式\n      return nsEffectors.find((effector: Expression.Effector) => effector instanceof ReadonlyEffector);\n    } else if (type === Expression.ExpressionType.Dependency) {\n      // 依赖表达式\n      return nsEffectors.find((effector: Expression.Effector) => effector instanceof DependencyEffector);\n    } else if (type === Expression.ExpressionType.Relative) {\n      // 关联表达式\n      // return nsEffectors.find((effector: Expression.Effector) => effector instanceof RelativeEffector);\n    } else if (type === Expression.ExpressionType.Validate) {\n      // 校验表达式\n      return nsEffectors.find((effector: Expression.Effector) => effector instanceof ValidateEffector);\n    } else if (type === Expression.ExpressionType.Required) {\n      // 必填表达式\n      return nsEffectors.find((effector: Expression.Effector) => effector instanceof RequiredEffector);\n    } else if (type === Expression.ExpressionType.Visible) {\n      // 显隐表达式\n      return nsEffectors.find((effector: Expression.Effector) => effector instanceof VisibleEffector);\n    } else {\n      // Core.warn(`EffectorFactory 没有找到对应的副作用器 ${type}`);\n      return null;\n    }\n  }\n\n}\n","import { StaticProvider } from '../core/index';\nimport { ViewModelContext } from '../view-model/index';\n\nimport {\n  EntityDependencyResolver, StateDependencyResolver, ResolverRegistry,\n  CommentDependencyResolver, RESOLVER_TOKEN, ResolveService\n} from './resolver/index';\nimport {\n  RepositoryChangeListener, UIStateChangeListener, ListenerRegistry, Listeners, LISTENER_TOKEN, BindingDataChangeListener\n} from './listener/index';\nimport {\n  RepositoryAddEntityEventHandler, RepositoryRemoveEntityEventHandler, EntityValueChangedEventHandler,\n  StateValueChangedEventHandler, RepositoryLoadEventHandler, EntityUpdateEventHandler,\n  BindingDataAppendObjectEventHandler, BindingDataValueChangeEventHandler, BindingDataSelectionChangedEventHandler,\n  BindingDataRemoveObjectEventHandler, BindingDataLoadEventHandler, EventHandlerRegistry\n} from './event-handler/index';\nimport { RepositoryEffector, UIStateEffector,VisibleEffector,DependencyEffector,ValidateEffector,RequiredEffector,ReadonlyEffector, EffectorFactory, EffectorRegistry, EFFECTOR_TOKEN } from './effector/index';\n\nimport {\n  ExpressionEngineImpl, ExpressionEventEmitter, ExpressionRegistry, ExpressionExecutor,\n  ExpressionManager, ExpressionResult, EVENT_HANDLER_TOKEN, ExpressionResultFactory\n} from './expression/index';\n\n/**\n * Resolver\n */\nconst VIEW_MODEL_EXPRESSION_RESOLVER_PROVIDERS: StaticProvider[] = [\n  { provide: RESOLVER_TOKEN, useClass: EntityDependencyResolver, multi: true, deps: [ViewModelContext] },\n  { provide: RESOLVER_TOKEN, useClass: StateDependencyResolver, multi: true, deps: [ViewModelContext] },\n  { provide: RESOLVER_TOKEN, useClass: CommentDependencyResolver, multi: true, deps: [ViewModelContext] },\n];\n\n/**\n * ChangeListener\n */\nconst VIEW_MODEL_EXPRESSION_LISTENER_PROVIDERS: StaticProvider[] = [\n  { provide: LISTENER_TOKEN, useClass: UIStateChangeListener, multi: true, deps: [ViewModelContext] },\n  { provide: LISTENER_TOKEN, useClass: RepositoryChangeListener, multi: true, deps: [ViewModelContext] },\n  { provide: LISTENER_TOKEN, useClass: BindingDataChangeListener, multi: true, deps: [ViewModelContext] }\n];\n\n/**\n * EventHandler\n */\nconst VIEW_MODEL_EXPRESSION_EVENT_HANDLER_PROVIDERS: StaticProvider[] = [\n  { provide: EVENT_HANDLER_TOKEN, useClass: RepositoryAddEntityEventHandler, multi: true, deps: [ViewModelContext] },\n  { provide: EVENT_HANDLER_TOKEN, useClass: RepositoryRemoveEntityEventHandler, multi: true, deps: [ViewModelContext] },\n  { provide: EVENT_HANDLER_TOKEN, useClass: EntityValueChangedEventHandler, multi: true, deps: [ViewModelContext] },\n  { provide: EVENT_HANDLER_TOKEN, useClass: StateValueChangedEventHandler, multi: true, deps: [ViewModelContext] },\n  { provide: EVENT_HANDLER_TOKEN, useClass: RepositoryLoadEventHandler, multi: true, deps: [ViewModelContext] },\n  { provide: EVENT_HANDLER_TOKEN, useClass: EntityUpdateEventHandler, multi: true, deps: [ViewModelContext] },\n  { provide: EVENT_HANDLER_TOKEN, useClass: BindingDataAppendObjectEventHandler, multi: true, deps: [ViewModelContext] },\n  { provide: EVENT_HANDLER_TOKEN, useClass: BindingDataValueChangeEventHandler, multi: true, deps: [ViewModelContext] },\n  { provide: EVENT_HANDLER_TOKEN, useClass: BindingDataRemoveObjectEventHandler, multi: true, deps: [ViewModelContext] },\n  { provide: EVENT_HANDLER_TOKEN, useClass: BindingDataLoadEventHandler, multi: true, deps: [ViewModelContext] },\n  { provide: EVENT_HANDLER_TOKEN, useClass: BindingDataSelectionChangedEventHandler, multi: true, deps: [ViewModelContext] },\n];\n\n/**\n * Effector\n */\nconst VIEW_MODEL_EXPRESSION_EFFECTOR_PROVIDERS: StaticProvider[] = [\n  { provide: EFFECTOR_TOKEN, useClass: RepositoryEffector, multi: true, deps: [ViewModelContext] },\n  { provide: EFFECTOR_TOKEN, useClass: UIStateEffector, multi: true, deps: [ViewModelContext] },\n  { provide: EFFECTOR_TOKEN, useClass: ReadonlyEffector, multi: true, deps: [ViewModelContext] },\n  { provide: EFFECTOR_TOKEN, useClass: ValidateEffector, multi: true, deps: [ViewModelContext] },\n  { provide: EFFECTOR_TOKEN, useClass: RequiredEffector, multi: true, deps: [ViewModelContext] },\n  { provide: EFFECTOR_TOKEN, useClass: VisibleEffector, multi: true, deps: [ViewModelContext] },\n  { provide: EFFECTOR_TOKEN, useClass: DependencyEffector, multi: true, deps: [ViewModelContext] }\n];\n\nconst VIEW_MODEL_EXPRESSION_PROVIDERS: StaticProvider[] = [\n  { provide: ResolverRegistry, useClass: ResolverRegistry, deps: [ViewModelContext] },\n  { provide: ResolveService, useClass: ResolveService, deps: [ViewModelContext] },\n  { provide: ListenerRegistry, useClass: ListenerRegistry, deps: [ViewModelContext] },\n  { provide: Listeners, useClass: Listeners, deps: [ViewModelContext] },\n  { provide: EventHandlerRegistry, useClass: EventHandlerRegistry, deps: [ViewModelContext] },\n  { provide: EffectorRegistry, useClass: EffectorRegistry, deps: [ViewModelContext] },\n  { provide: EffectorFactory, useClass: EffectorFactory, deps: [ViewModelContext] },\n  { provide: ExpressionRegistry, useClass: ExpressionRegistry, deps: [ViewModelContext] },\n  { provide: ExpressionEventEmitter, useClass: ExpressionEventEmitter, deps: [ViewModelContext] },\n  { provide: ExpressionExecutor, useClass: ExpressionExecutor, deps: [ViewModelContext] },\n  { provide: ExpressionManager, useClass: ExpressionManager, deps: [ViewModelContext] },\n  { provide: ExpressionResult, useClass: ExpressionResult, deps: [ViewModelContext] },\n  { provide: ExpressionResultFactory, useClass: ExpressionResultFactory, deps: [ViewModelContext] },\n  { provide: ExpressionEngineImpl, useClass: ExpressionEngineImpl, deps: [ViewModelContext] },\n  ...VIEW_MODEL_EXPRESSION_RESOLVER_PROVIDERS,\n  ...VIEW_MODEL_EXPRESSION_LISTENER_PROVIDERS,\n  ...VIEW_MODEL_EXPRESSION_EVENT_HANDLER_PROVIDERS,\n  ...VIEW_MODEL_EXPRESSION_EFFECTOR_PROVIDERS\n];\n\nexport { VIEW_MODEL_EXPRESSION_PROVIDERS };\n","class ControlsProxy {\n    private controlsProxyMap: Map<string, any>;\n\n    constructor() {\n        this.controlsProxyMap = new Map()\n    }\n\n    public setControlProxy(key: string, value: any) {\n        this.controlsProxyMap.set(key, value);\n    }\n\n    public getControlProxy(key: string) {\n        return this.controlsProxyMap.get(key);\n    }\n\n}\n\nexport { ControlsProxy }","import { MetadataUtil } from '../core/index';\nimport { Injector } from '../core/index';\nimport { Entity } from '../entity/index';\nimport { Repository } from '../repository/index';\nimport { Command, CommandBus } from '../command/index';\nimport { BindingData, EntityValueChange, InvokeOnValueChange } from '../binding-data/index';\nimport { UIState } from '../ui-state/index';\nimport { StateMachine } from '../state-machine/index';\nimport { Form } from '../form/index';\nimport { ViewModelContext } from './view_model_context';\n\nimport { COMMAND_METHOD_META, CommandMethodMetadata, Keybinding } from './decorators';\nimport { EMPTY, from, Observable, of } from 'rxjs';\nimport { concatMap, every, tap } from 'rxjs/operators';\n\nimport {\n  ExpressionEngineImpl, ExpressionManager, ExpressionResult, ExpressionResultFactory\n} from '../expression/index';\nimport { ControlsProxy } from '../control-proxy';\n\nabstract class ViewModel {\n\n  /**\n   * 命令元数据集合\n   */\n  public ngCommands: { [propName: string]: CommandMethodMetadata };\n\n  /**\n   * 扩展命令\n   */\n  public extendCommands: Map<string, any> = new Map<string, any>();\n\n  /**\n   * 名称\n   */\n  public id: string;\n\n  /**\n   * 注入器\n   */\n  public injector: Injector;\n\n  /**\n   * 视图模型上下文\n   */\n  public context: ViewModelContext;\n\n  /**\n   * 数据仓库\n   */\n  public repository: Repository<Entity>;\n\n  /**\n   * 绑定路径\n   */\n  public bindingPath: string;\n\n  /**\n   * 数据状态\n   */\n  public bindingData: BindingData;\n\n  /**\n   * UI状态\n   */\n  public uiState: UIState;\n\n  /**\n   * 状态机\n   */\n  public stateMachine: StateMachine;\n\n  /**\n   * 表单\n   */\n  public form: Form;\n\n  /**\n   * 命令总线\n   */\n  public commandBus: CommandBus;\n\n  /**\n   * 快捷键映射\n   */\n  public keybindingMap: Map<string, Keybinding>;\n\n  /** \n   * 控件实例代理\n   */\n  public controlsProxy : ControlsProxy;\n\n\n  /**\n   * 值变化前监听器\n   */\n  private entityValueChangingListeners: Map<string, string>;\n\n  /**\n   * 值变化后监听器\n   */\n  private entityValueChangedListeners: Map<string, string>;\n\n\n\n  public expressionEngineImpl: ExpressionEngineImpl;\n  public expressionManager: ExpressionManager;\n  public expressionResult: ExpressionResult;\n\n\n  /**\n   * 构造函数\n   */\n  public constructor(injector: Injector, id: string) {\n    this.injector = injector;\n    this.id = id;\n  }\n\n  /**\n   * 初始化\n   */\n  public init() {\n    this.initRepository();\n    this.initContext();\n    this.initBindingData();\n    this.initUIState();\n    this.intiStateMachine();\n    this.initForm();\n    this.initCommandBus();\n    this.registerWithParent();\n    this.initListeners();\n    this.closeOldBeSession();\n    this.initExpression();\n    this.initControlsProxy();\n    this.config();\n  }\n  \n  config(){\n    this.uiState.config(this.context);\n  }\n\n  initControlsProxy(){\n    this.controlsProxy = this.injector.get(ControlsProxy);\n  }\n\n  private initRepository() {\n    this.repository = this.injector.get(Repository);\n  }\n\n  private initContext() {\n    this.context = this.injector.get<ViewModelContext>(ViewModelContext);\n    this.context.init(this);\n  }\n\n  public initExpression() {\n\n    const appContext = this.context.appContext;\n    const allViewModelContexts = appContext.viewModelContextManager.getContexts();\n    const existedViewModelContext = allViewModelContexts.find((viewModelContext: any) => {\n      if (viewModelContext.expressionEngineImpl) {\n        return true;\n      } else {\n        return false;\n      }\n    });\n\n    if (existedViewModelContext) {\n      this.expressionEngineImpl = existedViewModelContext.expressionEngineImpl;\n      this.expressionManager = existedViewModelContext.expressionManager;\n      this.expressionResult = existedViewModelContext.expressionResult;\n      return;\n    }  \n\n    this.expressionEngineImpl = this.injector.get<ExpressionEngineImpl>(ExpressionEngineImpl, null);\n    this.expressionManager = this.injector.get<ExpressionManager>(ExpressionManager, null);\n    const expressionResultFactory = this.injector.get<ExpressionResultFactory>(ExpressionResultFactory, null);\n    this.expressionResult = this.injector.get<ExpressionResult>(ExpressionResult, null);\n  }\n\n  private initBindingData() {\n    this.bindingData = this.context.injector.get(BindingData);\n    this.entityValueChangingListeners = new Map<string, string>();\n    this.entityValueChangedListeners = new Map<string, string>();\n    if (this.bindingData) {\n      this.bindingData.setValueChangeInvokerFactory((paths: string[]): InvokeOnValueChange => {\n        return (preValue, value, entityChanged: boolean, primaryValue?: any): Observable<boolean> => {\n          const plainPath = '/' + paths.join('/');\n          let command: string;\n          if (entityChanged === false) {\n            command = this.entityValueChangingListeners[plainPath];\n          } else {\n            command = this.entityValueChangedListeners[plainPath];\n          }\n\n          if (!!command) {\n            const change: EntityValueChange = {\n              paths: paths,\n              preValue: preValue,\n              value: value,\n              changed: entityChanged\n            };\n            const commands = command.split(';').filter(p => p);\n            let valueChangeSuccess = true;\n            return from(commands).pipe(\n              concatMap(item => {\n                if (!valueChangeSuccess) {\n                  return EMPTY;\n                }\n                return this[item](change).pipe(\n                  tap((result: any) => {\n                    valueChangeSuccess = result;\n                  })\n                );\n              }),\n              every((result: any) => result)\n            );\n          } else {\n            return of(true);\n          }\n        };\n\n      });\n    }\n\n    const repositoryName = this.repository.name;\n    const bindingDataManager = this.context.appContext.bindingDataManager;\n    const repositoryBindingData = bindingDataManager.getBindingDataByName(repositoryName);\n    this.bindingData.initByBindingList(repositoryBindingData.list, this.context, repositoryBindingData.dataTypeInfo);\n  }\n\n  private initUIState() {\n    this.uiState = this.injector.get(UIState);\n  }\n\n  private intiStateMachine() {\n    this.stateMachine = this.injector.get(StateMachine, null);\n    if (!this.stateMachine) {\n      return;\n    }\n    this.stateMachine.init(this.context);\n  }\n\n  private initForm() {\n    this.form = this.injector.get(Form, null);\n    this.form.init();\n  }\n\n  private initCommandBus() {\n    this.commandBus = this.injector.get(CommandBus);\n    this.extendCommandMethods();\n  }\n\n  private extendCommandMethods() {\n    this.ngCommands = MetadataUtil.getPropsMetadatasByName(this.constructor, COMMAND_METHOD_META);\n    this.keybindingMap = new Map<string, Keybinding>();\n\n    Object.keys(this.ngCommands).forEach((propName: string) => {\n      const ngCommand: CommandMethodMetadata = this.ngCommands[propName];\n\n      Object.defineProperty(this, propName, {\n        value: (eventParams: any) => {\n          const command: Command = {\n            name: ngCommand.name,\n            params: ngCommand.params,\n            paramDescriptions: ngCommand.paramDescriptions,\n            eventParam: eventParams || null\n          };\n          return this.commandBus.dispatch(command);\n        }\n      });\n\n      if (ngCommand.keyBinding) {\n        this.keybindingMap.set(propName, ngCommand.keyBinding);\n      }\n    });\n  }\n\n  /**\n   * 注册扩展命令方法\n   */\n  public registerExtendCommand(commandName: string, commandHandler: any) {\n    Object.defineProperty(this, commandName, {\n      value: (eventParams: any) => {\n        return commandHandler(eventParams, this.context);\n      }\n    });\n    this.extendCommands.set(commandName, commandHandler);\n  }\n\n  private registerWithParent() {\n    const parentContext = this.context.parent;\n    if (!parentContext || !parentContext.viewModel || !parentContext.viewModel['childViewModels']) {\n      return;\n    }\n\n    const parentViewModel = parentContext.viewModel;\n    const className = this.constructor.name;\n    const propName = parentViewModel['childViewModels'][className];\n    parentViewModel[propName] = this;\n  }\n\n  /**\n   * 关闭老的BeSession\n   */\n  private closeOldBeSession() {\n    const allViewModelContexts = this.context.appContext.viewModelContextManager.getContexts();\n    if (allViewModelContexts.length === 1 && allViewModelContexts[0] === this.context) {\n      this.context.repository.reset();\n    }\n  }\n\n  /**\n * 从Form获取监听器\n */\n  private initListeners() {\n    const extractPath = (bindingBasePath: string, bindingPath: string): string => {\n      return '/' + bindingBasePath.split('/').concat(bindingPath.split('.')).filter((item) => item.length > 0).join('/');\n    };\n\n    if (this.form) {\n      const valueChangingListeners = this.form.getEntityValueChangingListeners();\n      Object.keys(valueChangingListeners).forEach((bindingPath) => {\n        const plainPath = extractPath(this.bindingPath, bindingPath);\n        this.entityValueChangingListeners[plainPath] = valueChangingListeners[bindingPath];\n      });\n\n      const valueChangedListeners = this.form.getEntityValueChangedListeners();\n      Object.keys(valueChangedListeners).forEach((bindingPath) => {\n        const plainPath = extractPath(this.bindingPath, bindingPath);\n        this.entityValueChangedListeners[plainPath] = valueChangedListeners[bindingPath];\n      });\n    }\n  }\n\n}\n\nexport { ViewModel };\n","import { StaticProvider } from '../core/index';\nimport { ViewModel } from './view_model';\n\nclass ViewModelOptions {\n\n  id: string;\n\n  /**\n   * 应用providers\n   */\n  providers: StaticProvider[];\n\n  /**\n   * 父ViewModel\n   */\n  parent?: ViewModel;\n\n}\n\nexport { ViewModelOptions };\n","import { Subject, Subscription } from 'rxjs';\n\nclass AppEventBus {\n  /**\n* eventBus\n*/\n  private eventBus: Subject<any>;\n\n  private subscriptionsMap: Map<string, Subscription>;\n\n  /**\n   * 构造函数\n   */\n  constructor() {\n    this.eventBus = new Subject();\n    this.subscriptionsMap = new Map<string, Subscription>();\n  }\n\n  triggerEvent(event: any) {\n    this.eventBus.next(event);\n  }\n\n  subscribe(componentId: string, func: Function, funcError?: Function) {\n    if (this.subscriptionsMap.has(componentId) === false) {\n      const subscription = this.eventBus.subscribe(\n        (value) => func(value),\n        (value) => funcError(value)\n      )\n      this.subscriptionsMap.set(componentId, subscription);\n    }\n  }\n  \n  unsubscribe(componentId: string) {\n    if (this.subscriptionsMap.has(componentId) === true) {\n      this.subscriptionsMap.get(componentId).unsubscribe();\n      this.subscriptionsMap.delete(componentId);\n    }\n  }\n\n  /**\n   * 清除注册得指定key名监听器\n   * @param keyStr 监听器key 默认值为listview上注册得\n   * @returns \n   */\n  unsubscribeAllListview(keyStr:string = '-listview-extend'){\n    if(this.subscriptionsMap.size == 0){ return }\n    // @ts-ignore: Unreachable code error\n    for (let key of this.subscriptionsMap.keys()) {\n      if(key.indexOf(keyStr)>0){\n        this.subscriptionsMap.get(key).unsubscribe();\n        this.subscriptionsMap.delete(key);\n      }\n    }\n  }\n}\n\nexport { AppEventBus };","import { StaticProvider, Injector } from '../core/index';\nimport { BindingDataManager } from './binding_data_manager';\nimport { RepositoryManager } from './repository_mananger';\nimport { ViewModelContextManager } from './view_model_contex_manager';\nimport { AppContext } from './app_context';\nimport { AppEventBus } from './app_eventBus';\n\nconst APP_BASE_PROVIDERS: StaticProvider[] = [\n  { provide: AppEventBus, useClass: AppEventBus, deps: [] },\n  { provide: BindingDataManager, useClass: BindingDataManager, deps: [] },\n  { provide: RepositoryManager, useClass: RepositoryManager, deps: [] },\n  { provide: ViewModelContextManager, useClass: ViewModelContextManager, deps: [] },\n  {\n    provide: AppContext, useClass: AppContext,\n    deps: [Injector, AppEventBus, RepositoryManager, BindingDataManager, ViewModelContextManager]\n  }\n];\n\nexport { APP_BASE_PROVIDERS };\n","import { Injector, StaticProvider } from \"../../core\";\nimport { ViewModelContext } from \"../../view-model\";\nimport { ControlStateInterceptorService } from \"./control_state_interceptor.service\";\nimport { ControlStateListener } from \"./control_state_listener\";\nimport { ControlStateUpdater } from \"./control_state_updater\";\n\n\nconst APP_CONTROL_STATE_PROVIDERS: StaticProvider[] = [\n  { provide: ControlStateInterceptorService, useClass: ControlStateInterceptorService, deps: [Injector] }\n\n];\n\nconst VIEW_MODEL_CONTROL_STATE_PROVIDERS: StaticProvider[] = [\n  { provide: ControlStateListener, useClass: ControlStateListener, deps: [ViewModelContext] },\n  { provide: ControlStateUpdater, useClass: ControlStateUpdater, deps: [ViewModelContext] }\n\n];\n\nexport { APP_CONTROL_STATE_PROVIDERS,VIEW_MODEL_CONTROL_STATE_PROVIDERS };\n","import { StaticProvider, Injector, createInjector} from '../core/index';\nimport { AppContext } from './app_context';\nimport { ViewModelContext, ViewModel, ViewModelOptions } from '../view-model/index';\n\nimport { APP_BASE_PROVIDERS } from './providers';\nimport { APP_VARIABLE_PROVIDERS } from '../variable/index';\nimport { VIEW_MODEL_COMMAND_PROVIDERS } from '../command/index';\nimport { HTTP_PROVIDERS } from '../http/index';\n\nimport { VIEW_MODEL_EXPRESSION_PROVIDERS } from '../expression/index';\nimport { ControlsProxy } from '../control-proxy';\nimport { APP_CONTROL_STATE_PROVIDERS, VIEW_MODEL_CONTROL_STATE_PROVIDERS } from '../ui-state/control-state/providers';\n\n\nclass App {\n\n  public context: AppContext;\n\n  /**\n   * 构造函数\n   */\n  constructor(options: any) {\n\n    options.providers = options.providers || [];\n    const appProviders = [\n      ...APP_BASE_PROVIDERS,\n      ...APP_VARIABLE_PROVIDERS,\n      ...HTTP_PROVIDERS,\n      ...APP_CONTROL_STATE_PROVIDERS,\n      ...options.providers\n    ];\n    const appInjector = createInjector(appProviders);\n    this.context = appInjector.get(AppContext);\n  }\n\n  /**\n   * 启用ViewModel\n   */\n  createViewModel(options: ViewModelOptions): ViewModel {\n\n    const providers = options.providers || [];\n    const parent = options.parent || null;\n\n    const mergedProviders: StaticProvider[] = [\n      { provide: ViewModelContext, useClass: ViewModelContext, deps: [] },\n      { provide: ControlsProxy, useClass: ControlsProxy, deps: [] },\n      ...VIEW_MODEL_COMMAND_PROVIDERS,\n      ...VIEW_MODEL_EXPRESSION_PROVIDERS,\n      ...VIEW_MODEL_CONTROL_STATE_PROVIDERS,\n      ...providers\n    ];\n\n    const parentInjector = parent ? parent.injector : this.context.injector;\n    const injector = createInjector(mergedProviders, parentInjector);\n    const viewModel = injector.get<ViewModel>(ViewModel);\n    viewModel.init();\n    return viewModel;\n  }\n\n}\n\nexport { App };\n","/*\n * StateMachine变量解析\n * @Author: Witt\n * @Date: 2018-12-04 17:09:42\n * @Last Modified by: Witt\n * @Last Modified time: 2019-10-30 11:07:10\n */\n\nimport { AppContext } from '../app/index';\nimport { ViewModelContext } from '../view-model/index';\nimport { CommandContext } from '../command/index';\n\n/**\n * 解析辅助工具类\n */\nclass ParseUtil {\n\n  /**\n   * 获取应用上下文\n   */\n  static getAppContext(context: any): AppContext {\n    if (context instanceof CommandContext) {\n      return context.viewModelContext.appContext;\n    } else if (context instanceof ViewModelContext) {\n      return context.appContext;\n    } else  if (context instanceof AppContext) {\n      return context;\n    } else {\n      throw new Error('上下文中找不到AppContext，请检查！');\n    }\n  }\n\n  /**\n   * 获取当前Frame的Context\n   */\n  static getFrameContext(context: any): ViewModelContext {\n    if (context instanceof CommandContext) {\n      return context.viewModelContext;\n    } else if (context instanceof ViewModelContext) {\n      return context;\n    } else {\n      throw new Error('上下文中找不到FrameContext，请检查！');\n    }\n\n  }\n\n  /**\n   * 获取根Frame的Context\n   */\n  static getRootFrameContext(context: any): ViewModelContext {\n    const frameContext = this.getFrameContext(context);\n    return frameContext.root;\n  }\n\n  /**\n   * 根据frameId获取FrameContext\n   */\n  static getFrameContextById(context: any, frameId: string): ViewModelContext {\n    const appContext = this.getAppContext(context);\n    return appContext.viewModelContextManager.getContextById(frameId);\n  }\n}\n\nexport { ParseUtil };\n","/**\n * 数据源变量解析\n * @author Witt <jiwt@inspur.com>\n */\nimport { AppContext } from '../app/index';\nimport { VariableParser } from './variable_parser';\nimport { ParseUtil } from './parse_util';\n\n/**\n * 数据变量解析\n */\nclass DataVariableParser implements VariableParser {\n\n  /**\n   * 解析变量\n   * @param expression 表达式\n   * @param context 上下文\n   */\n  parse(expression: string, context: any): any {\n    const appContext = ParseUtil.getAppContext(context);\n    const paths: string[] = this.extractPaths(expression);\n\n    // 1、单个的表达式：直接求值\n    if (paths.length === 1 && expression === `{DATA~${paths[0]}}`) {\n      return this.getValue(paths[0], appContext);\n    }\n\n    // 2、其他情况：字符串替换\n    paths.forEach( (path: string) => {\n      const searchValue = `{DATA~${path}}`;\n      const replaceValue = this.getValue(path, appContext);\n      expression = expression.replace(searchValue, replaceValue);\n    });\n\n    return  expression;\n  }\n\n  /**\n   * 提取路径\n   */\n  private extractPaths(expression: string) {\n    const paths: string[]  = [];\n\n    // 查找所有的uiState变量字符串\n    const DATA_PATTERN_G = /\\{DATA~(\\S+?)\\}/g;\n    const dataVariables = expression.match(DATA_PATTERN_G);\n    if (dataVariables === null) {\n      return [];\n    }\n\n    // 提取后边的路径\n    const DATA_PATTERN = /\\{DATA~(\\S+?)\\}/;\n    dataVariables.forEach( dataVariable =>  {\n      const pathMatches = dataVariable.match(DATA_PATTERN);\n      if (pathMatches != null && pathMatches.length === 2) {\n        paths.push(pathMatches[1]);\n      }\n    });\n    return paths;\n  }\n\n  /**\n   * 获取值\n   * @param path 路径：/\n   */\n  private getValue(path: string, appContext: AppContext): any {\n    const parts = path.split('/').filter((part: string) => {\n      return part !== '';\n    });\n\n    const frameContext = appContext.viewModelContextManager.getContextById(parts[0]);\n    if (!frameContext) {\n      throw new Error(`${path}不正确，请检查！`);\n    }\n\n    const bindingData  = frameContext.bindingData;\n    if (!bindingData) {\n      throw new Error(`${path}不正确，请检查！`);\n    }\n    return bindingData.getValue(parts.slice(1));\n  }\n\n\n}\n\nexport { DataVariableParser };\n","/**\n * session变量解析\n * @author Witt <jiwt@inspur.com>\n */\n\nimport { VariableParser } from './variable_parser';\nimport { AppContext } from '../app/index';\nimport { ParseUtil } from './parse_util';\n\n/**\n * 数据变量解析\n */\nclass UIStateVariableParser implements VariableParser {\n\n  /**\n   * 解析变量\n   * @param expression 形如：/frameId/stateName\n   * @param context 上下文\n   */\n  public parse(expression: string, context: any): any {\n\n    const appContext = ParseUtil.getAppContext(context);\n    const paths = this.extractPaths(expression);\n\n    // 1、单个的表达式：直接求值\n    if (paths.length === 1 && expression === `{UISTATE~${paths[0]}}`) {\n      return this.getUIState(paths[0], appContext);\n    }\n\n    // 2、其他情况：字符串替换\n    paths.forEach(path => {\n      const searchValue = `{UISTATE~${path}}`;\n      const replaceValue = this.getUIState(path, appContext);\n      expression = expression.replace(searchValue, replaceValue);\n    });\n\n    return expression;\n  }\n\n  /**\n   * 提取路径\n   * 变量格式：{}\n   */\n  private extractPaths(expression: string): string[] {\n    const paths: string[] = [];\n\n    // 查找所有的uiState变量字符串\n    const UI_STATE_PATTERN_G = /\\{UISTATE~(\\S+?)\\}/g;\n    const uiStateVariables = expression.match(UI_STATE_PATTERN_G);\n    if (uiStateVariables === null) {\n      return [];\n    }\n\n    // 提取后边的路径\n    const UI_STATE_PATTERN = /\\{UISTATE~(\\S+?)\\}/;\n    uiStateVariables.forEach((uiStateVariable: string) => {\n      const pathMatches = uiStateVariable.match(UI_STATE_PATTERN);\n      if (pathMatches != null && pathMatches.length === 2) {\n        paths.push(pathMatches[1]);\n      }\n    });\n\n    return paths;\n  }\n\n  /**\n   * 获取UIState\n   */\n  private getUIState(path: string, appContext: AppContext) {\n    const parts = path.split('/').filter((part: string) => {\n      return part !== '';\n    });\n    const [frameId, stateName] = parts;\n    const frameContext = appContext.viewModelContextManager.getContextById(frameId);\n    let state = frameContext.uiState[stateName];\n    if (state && state.constructor.toString().startsWith('function Date()')) {\n      return this.formatDate(state);\n    }\n    for (let i = 2; i < parts.length; i++) {\n      state = state[parts[i]];\n\n      // 复杂对象一层层查找下去，如果某一层不存在，结果可以是undefined，但是要直接返回undefined避免报错。\n      if (!state) {\n        return state;\n      }\n    }\n    return state;\n  }\n\n  /**\n   * @todo：待删除\n   */\n  private formatDate(value: Date): string {\n    if (!value) {\n      return '';\n    }\n\n    // 年\n    const year = value.getFullYear();\n\n    // 月\n    let month = (value.getMonth() + 1).toString();\n    month = month.length === 1 ? ('0' + month) : month;\n\n    // 日\n    let day = value.getDate().toString();\n    day = day.length === 1 ? ('0' + day) : day;\n    return `${year}-${month}-${day}`;\n  }\n}\n\nexport { UIStateVariableParser };\n","/*\n * StateMachine变量解析\n * @Author: Witt\n * @Date: 2018-12-04 17:09:42\n * @Last Modified by: Witt\n * @Last Modified time: 2019-10-30 11:07:10\n */\nimport { ViewModelContext } from '../view-model/index';\nimport { StateMachine } from '../state-machine/index';\nimport { VariableParser } from './variable_parser';\nimport { ParseUtil } from './parse_util';\n\n/**\n * 状态机变量解析\n * @summary\n *\n * 解析策略：\n * 1、不带frameId，从顶层StateMachine中解析\n * {STATEMACHINE~/states/key}\n * {STATEMACHINE~/renderStates/key}\n *\n * 2、带frameId，从frameId对应的FrameContext的StateMachine中解析\n * {STATEMACHINE~/frameId/states/key}\n * {STATEMACHINE~/frameId/renderStates/key}\n *\n * 存在的问题：\n * 1、不带frameId从顶层StateMachine解析仅为了兼容，将来改为从当前FrameContext的StateMachine中解析；\n * 2、组合表单中顶层StateMachine是主表单的rootFrameContext的StateMachine，显然不合理（既成事实）；\n * 3、farmeId如果是states或renderStates，导致解析失败，几率很小，但又风险。\n */\nclass StateMachineVariableParser implements VariableParser {\n\n  /**\n   * 构造函数\n   */\n  public constructor() {\n  }\n\n  /**\n   * 解析变量\n   * @param expression 变量：格式形如：/frameId/componentId/stateName\n   * @param context 上下文\n   */\n  public parse(expression: string, context: any): any {\n    const paths = this.extractPaths(expression);\n\n    // 1、单个的表达式：直接求值\n    if (paths.length === 1 && expression === `{STATEMACHINE~${paths[0]}}`) {\n      return this.getValue(paths[0], context);\n    }\n\n    // 2、其他情况：字符串替换\n    paths.forEach( path => {\n      const searchValue = `{STATEMACHINE~${path}}`;\n      const replaceValue = this.getValue(path, context);\n      expression = expression.replace(searchValue, replaceValue);\n    });\n\n    return  expression;\n  }\n\n  /**\n   * 提取Session变量名\n   * 变量格式：{}\n   */\n  private extractPaths(expression: string): string[] {\n    const paths: string[]  = [];\n\n    // 查找所有的StateMachine变量字符串\n    const STATE_MACHINE_PATTERN_G = /\\{STATEMACHINE~(\\S+?)\\}/g;\n    const stateMachineVariables = expression.match(STATE_MACHINE_PATTERN_G);\n    if (stateMachineVariables === null) {\n      return [];\n    }\n\n    // 提取后边的路径\n    const STATE_MACHINE_PATTERN = /\\{STATEMACHINE~(\\S+?)\\}/;\n    stateMachineVariables.forEach( sessionVariable =>  {\n      const pathMatches = sessionVariable.match(STATE_MACHINE_PATTERN);\n      if (pathMatches != null && pathMatches.length === 2) {\n        paths.push(pathMatches[1]);\n      }\n    });\n\n    return paths;\n  }\n\n  /**\n   * 获取对应的值\n   */\n  private getValue(path: string, context: any): any {\n\n    const pathObj = this.getPathObj(path);\n    const stateMachine = this.getTargetStateMachine(pathObj.frameId, context);\n\n    if (pathObj.type === 'currentState') {\n      return stateMachine.context.state;\n    } else if (pathObj.type === 'renderStates') {\n      return stateMachine[pathObj.name] as boolean;\n    } else {\n      throw new Error(`不支类型为${pathObj.type}的状态机变量`);\n    }\n  }\n\n  /**\n   * 解析path，并获取对应的StateMachine实例\n   */\n  private getTargetStateMachine(frameId: string, context): StateMachine {\n    let targetFrameContext: ViewModelContext;\n    if (frameId) {\n      targetFrameContext = ParseUtil.getFrameContextById(context, frameId);\n    } else {\n      targetFrameContext = ParseUtil.getRootFrameContext(context);\n    }\n\n    if (!targetFrameContext || !targetFrameContext.stateMachine) {\n      throw new Error('找不到对应的状态机实例，请检查！');\n    }\n    return targetFrameContext.stateMachine;\n  }\n\n  /**\n   * 将Path解析为格式化的Path对象\n   */\n  private getPathObj(path: string): any {\n    let parsedPathObj: any;\n    const parts = this.splitPath(path);\n\n    if (parts[0] === 'currentState' || parts[0] === 'renderStates') {\n      parsedPathObj = {\n        frameId: '',\n        type: parts[0],\n        name: parts[1]\n      };\n    } else {\n      parsedPathObj = {\n        frameId: parts[0],\n        type: parts[1],\n        name: parts[2]\n      };\n    }\n\n    return parsedPathObj;\n  }\n\n  /**\n   * 分隔Path\n   */\n  private splitPath(path: string): string[] {\n    const parts = path.split('/').filter((part: string) => {\n      return part !== '';\n    });\n    return parts;\n  }\n\n}\n\nexport { StateMachineVariableParser };\n","/**\n * session变量解析\n * @author Witt <jiwt@inspur.com>\n */\n\nimport { CommandContext } from '../command/index';\nimport { VariableParser } from './variable_parser';\n\n/**\n * 命令变量解析\n * {COMMAND~/params/key}\n * {COMMAND~/results/taskName}\n */\nclass CommandVariableParser implements VariableParser {\n\n  /**\n   * 构造函数\n   */\n  public constructor() {\n  }\n\n  /**\n   * 解析变量\n   * @param expression 变量：格式形如：/frameId/componentId/stateName\n   * @param context 上下文\n   */\n  public parse(expression: string, context: any): any {\n    const paths = this.extractPaths(expression);\n\n    // 1、单个的表达式：直接求值\n    if (paths.length === 1 && expression === `{COMMAND~${paths[0]}}`) {\n      return this.getValue(paths[0], context);\n    }\n\n    // 2、其他情况：字符串替换\n    paths.forEach( path => {\n      const searchValue = `{COMMAND~${path}}`;\n      const replaceValue = this.getValue(path, context);\n      expression = expression.replace(searchValue, replaceValue);\n    });\n\n    return  expression;\n  }\n\n  /**\n   * 提取Session变量名\n   * 变量格式：{}\n   */\n  private extractPaths(expression: string): string[] {\n    const paths: string[]  = [];\n\n    // 查找所有的uiState变量字符串\n    const UI_STATE_PATTERN_G = /\\{COMMAND~(\\S+?)\\}/g;\n    const uiStateVariables = expression.match(UI_STATE_PATTERN_G);\n    if (uiStateVariables === null) {\n      return [];\n    }\n\n    // 提取后边的路径\n    const UI_STATE_PATTERN = /\\{COMMAND~(\\S+?)\\}/;\n    uiStateVariables.forEach( sessionVariable =>  {\n      const pathMatches = sessionVariable.match(UI_STATE_PATTERN);\n      if (pathMatches != null && pathMatches.length === 2) {\n        paths.push(pathMatches[1]);\n      }\n    });\n\n    return paths;\n  }\n\n  /**\n   * 获取UIState\n   */\n  private getValue(path: string, context: any) {\n    if (context instanceof CommandContext === false) {\n      throw new Error('当前上下文不支持COMMAND变量，请检查！');\n    }\n    const parts = path.split('/').filter((part: string) => {\n      return part !== '';\n    });\n\n    const [type, name] = parts;\n    if (type === 'params') {\n      return context.command.params[name];\n    } else if (type === 'results') {\n      return context.results[name];\n    }\n  }\n}\n\nexport { CommandVariableParser };\n","/**\n * 变量解析服务\n * @author Witt<jiwt@inspur.com>\n */\nimport { VariableParser, VARIABLE_PARSERS } from './variable_parser';\nimport { Injector  } from '../core/index';\n\n\n/**\n * 变量解析服务\n * 职责：\n * 1、解析字符串中的变量，并替换成相应的值；\n * 2、对表达式进行求值。\n *\n * @todo 对表达式求值的部分和表达式功能重叠，是否转移到表达式中？\n */\nclass VariableParseService {\n\n  /**\n   * 解析器集合\n   */\n  private parsers: VariableParser[];\n\n  /**\n   * 构造变量解析服务\n   * @param parsers 解析器集合\n   */\n  constructor(parsers: VariableParser[]) {\n    this.parsers = parsers;\n  }\n\n  /**\n   * 解析表达式\n   * @param expression 表达式\n   * @param context 上下文\n   */\n  public parse(target: any, context?: any): any {\n    if (typeof target === 'string' && target.length > 0) {\n\n      // 字符串，直接解析\n      return this.parseExpression(target, context);\n\n    } else if (Array.isArray(target)) {\n\n      // 遍历数组\n      target.forEach((item, itemIndex) =>  {\n        if (typeof item === 'string') {\n          target[itemIndex] = this.parseExpression(item, context);\n        } else {\n          target[itemIndex] = this.parse(item, context);\n        }\n      });\n\n    } else if (typeof target === 'object' && target !== null) {\n\n      // 遍历对象可枚举属性\n      const keys = Object.keys(target);\n      keys.forEach(key => {\n        if (typeof target[key] === 'string') {\n          target[key] = this.parseExpression(target[key], context);\n        } else {\n          target[key] = this.parse(target[key], context);\n        }\n      });\n    }\n\n    return target;\n  }\n\n  /**\n   * 表达式求值\n   */\n  public evaluate(expression: string, context?: any): any {\n    const parsedExpression = this.parse(expression, context);\n    return (new Function('return ' + parsedExpression))();\n  }\n\n  /**\n   * 解析表达式\n   * @param expression 表达式\n   * @param context 上下文\n   */\n  private parseExpression(expression: string, context: any): string {\n\n    // 空串直接返回\n    if (expression === '') {\n      return '';\n    }\n\n    this.parsers.forEach(parser => {\n      if (typeof expression === 'string') {\n        expression = parser.parse(expression, context);\n      }\n    });\n    return expression;\n  }\n}\n\nexport { VariableParseService };\n","import { StaticProvider } from '../core/index';\nimport { VARIABLE_PARSERS } from './variable_parser';\nimport { DataVariableParser } from './data_variable_parser';\nimport { UIStateVariableParser } from './ui_state_variable_parser';\nimport { StateMachineVariableParser } from './state_machine_variable_parser';\nimport { CommandVariableParser } from './command_variable_parser';\nimport { VariableParseService } from './variable_parse_service';\n\nconst APP_VARIABLE_PROVIDERS: StaticProvider[] = [\n  { provide: VARIABLE_PARSERS,     useClass: DataVariableParser,         multi: true, deps: [] },\n  { provide: VARIABLE_PARSERS,     useClass: UIStateVariableParser,      multi: true,  deps: [] },\n  { provide: VARIABLE_PARSERS,     useClass: StateMachineVariableParser, multi: true,  deps: [] },\n  { provide: VARIABLE_PARSERS,     useClass: CommandVariableParser,      multi: true,  deps: [] },\n  { provide: VariableParseService, useClass: VariableParseService,       deps: [VARIABLE_PARSERS] },\n];\n\nexport { APP_VARIABLE_PROVIDERS };\n","/* eslint-disable no-case-declarations */\nimport { VariableParseService } from '../../variable/index';\nimport { CommandContext } from '../command_context';\nimport { Injector } from '../../core/index';\n\n/**\n * 任务函数\n * @params result 上一步执行结果\n * @params context 执行上下文\n */\ntype LinkFunc = (context: CommandContext) => boolean;\n\n/**\n * 任务链接\n */\nclass TaskLink {\n\n  /**\n   * 源任务\n   */\n  from: string;\n\n  /**\n   * 目标任务\n   */\n  to: string;\n\n  /**\n   * 执行条件\n   * 1、表达式；\n   * 2、布尔值；\n   * 3、函数\n   */\n  condition: string | boolean| LinkFunc;\n\n  /**\n   * 构造函数\n   */\n  constructor(from: string, to: string, condition: string | boolean| LinkFunc) {\n    this.from = from;\n    this.to   = to;\n    this.condition = condition;\n  }\n\n  /**\n   * 是否能够\n   */\n  public canLink(context: CommandContext): boolean {\n    const type = typeof this.condition;\n    let canLink;\n    switch (type) {\n      case 'boolean':\n        canLink = this.condition as boolean;\n        break;\n      case 'function':\n        canLink = (this.condition as LinkFunc)(context);\n        break;\n      case 'string':\n        const parseService = context.viewModelContext.injector.get(VariableParseService);\n        canLink = parseService.evaluate(this.condition as string, context);\n        break;\n      default:\n        canLink = false;\n        break;\n    }\n    return canLink;\n  }\n}\n\nexport { LinkFunc, TaskLink };\n","/*\n * @Author: Witt\n * @Date: 2018-10-17 14:13:40\n * @Last Modified by: Witt\n * @Last Modified time: 2018-10-17 16:08:34\n */\n\nimport { TaskFunc, TaskNode } from './task_node';\nimport { LinkFunc, TaskLink } from './task_link';\nimport { CommandContext } from '../command_context';\n\n/**\n * 任务执行流程\n */\nclass TaskFlow {\n\n  /**\n   * 节点集合\n   */\n  private nodes: TaskNode[] = [];\n\n  /**\n   * 边集合\n   */\n  private links: TaskLink[] = [];\n\n\n  // #region 节点操作\n\n  /**\n   * 添加节点\n   */\n  public addNode(name: string, func: TaskFunc): void {\n    const node = new TaskNode(name, func);\n    this.nodes.push(node);\n  }\n\n\n  /**\n   * 批量添加链接\n   */\n  public addNodes(nodes: TaskNode[]) {\n    this.nodes = this.nodes.concat(nodes);\n  }\n\n  /**\n   * 在目标节点之前插入一个节点\n   * @param target 目标节点名称\n   * @param name 名称\n   * @param func 函数\n   */\n  public insertNode(target: string, name: string, func: TaskFunc): void {\n    const index = this.findNodeIndex(target);\n    const node = this.createNode(name, func);\n    this.nodes.splice(index, 0, node);\n  }\n\n  /**\n   * 在目标节点之前插入一个节点\n   */\n  public appendNode(target: string, name: string, func: TaskFunc) {\n    const index = this.findNodeIndex(target) + 1;\n    const node = this.createNode(name, func);\n    this.nodes.splice(index, 0, node);\n  }\n\n  /**\n   * 获取节点索引\n   * @param name 名称\n   */\n  private findNodeIndex(name: string): number {\n    return this.nodes.findIndex((node: TaskNode) => {\n      return node.name === name;\n    });\n  }\n\n  /**\n   * 创建任务节点\n   * @param name 名称\n   * @param func 函数\n   */\n  private createNode(name: string, func: TaskFunc): TaskNode {\n    const node = new TaskNode(name, func);\n    return node;\n  }\n\n  // #endregion\n\n\n  // #region 链接操作\n\n  /**\n   * 添加链接\n   * @param name 名称\n   * @param func 函数\n   */\n  public addLink(from: string, to: string, condition: string | boolean) {\n    const link = this.createLink(from, to, condition);\n    this.links.push(link);\n  }\n\n  /**\n   * 批量添加链接\n   */\n  public addLinks(links: TaskLink[]) {\n    this.links = this.links.concat(links);\n  }\n\n  /**\n   * 创建链接\n   */\n  private createLink(from: string, to: string, condition: string | boolean) {\n    const link = new TaskLink(from, to, condition);\n    return link;\n  }\n\n  // #endregion\n\n\n  // #region 流程控制\n  /**\n   * 获取下一个节点\n   * @param from    源节点名称\n   * @param context 上下文\n   */\n  getNext(from?: string, context?: CommandContext): TaskNode {\n    if (!from) {\n      return this.nodes.shift();\n    }\n\n    // 符合满足条件的边\n    const nextLink = this.links.find((link: TaskLink) => {\n      return link.from === from && link.canLink(context);\n    });\n    if (!nextLink) {\n      return;\n    }\n\n    return this.nodes.find((node: TaskNode) => {\n      return node.name === nextLink.to;\n    });\n  }\n\n  // #endregion\n\n  // #region 其他方法\n\n  /**\n   * 克隆任务流\n   */\n  clone() {\n    const taskFlow = new TaskFlow();\n    taskFlow.addNodes(this.nodes);\n    taskFlow.addLinks(this.links);\n    return taskFlow;\n  }\n\n  // #endregion\n}\n\nexport { TaskFlow };\n","import { ViewModelContext } from '../view-model/index';\nimport { Command } from './command';\n\n/**\n * Command上下文\n */\nclass CommandContext {\n\n  /**\n   * 命令实例\n   */\n  command: Command;\n\n  /**\n   * 组件上下文\n   */\n  viewModelContext: ViewModelContext;\n\n  /**\n   * 执行结果\n   */\n  results: {[taskName: string]: any} = {};\n\n  /**\n   * 最新的执行结果\n   */\n  latestResult: any;\n\n  /**\n   * 事件参数\n   */\n  eventParams: any;\n\n  /**\n   * 构造函数\n   * @param command 命令\n   * @param viewModelContext 视图模型上下文\n   */\n  constructor(command: Command, viewModelContext: ViewModelContext) {\n    this.command = command;\n    this.viewModelContext = viewModelContext;\n  }\n\n}\n\nexport { CommandContext };\n","import { Observable, Subject, BehaviorSubject } from 'rxjs';\nimport { concatMap, map, takeLast, take, timeout, throwIfEmpty } from 'rxjs/operators';\n\nimport { createInjectionToken, Injector } from '../core/index';\nimport { ViewModelContext } from '../view-model/index';\nimport { VariableParseService } from '../variable/index';\n\nimport { Command, CommandParams, ParamDescriptions } from './command';\nimport { CommandContext } from './command_context';\nimport { TaskFunc, TaskFlow } from './flow/index';\n\n\n/**\n * 命令处理抽象类，所有具体的命令处理类必须继承它，并实现schedule方法。\n */\nabstract class CommandHandler {\n\n  /**\n   * 任务流程图\n   */\n  private taskFlow: TaskFlow;\n\n  /**\n   * 上下文\n   */\n  protected viewModelContext: ViewModelContext;\n\n  /**\n   * 变量解析服务\n   */\n  protected parseService: VariableParseService;\n\n  /**\n   * 构造函数\n   */\n  constructor() {\n  }\n\n  /**\n   * 构造执行流程\n   */\n  abstract schedule();\n\n  /**\n   * 初始化\n   */\n  public init(viewModelContext: ViewModelContext) {\n    this.viewModelContext = viewModelContext;\n    this.parseService = viewModelContext.injector.get(VariableParseService);\n    this.taskFlow = new TaskFlow();\n\n    this.schedule();\n  }\n\n  /**\n   * 执行任务\n   * @param command 要执行的命令\n   * @return 最后一个任务的执行结果\n   * @todo：按功能拆分小函数\n   */\n  public execute(command: Command): Observable<any> {\n    const lastTaskResult$ = new Subject();\n    const taskFlow = this.taskFlow.clone();\n\n    // setTimeout暂时不能去掉的原因：\n    // 1、树表单加载数据，依赖TreeTableBinding里设置的全局变量，需要延后执行加载时机；\n    // 2、关闭前命令需要延迟执行。\n    setTimeout(() => {\n\n      // 1、解析参数\n      // 避免解析变量时修改了原始的command\n      const { eventParam = null } = {\n        ...command\n      };\n      delete command.eventParam;\n      const commandToExecute = JSON.parse(JSON.stringify(command));\n      commandToExecute.params = this.parseService.parse(commandToExecute.params, this.viewModelContext);\n      command.eventParam = eventParam;\n      commandToExecute.eventParam = eventParam;\n\n      // 2、串联任务流\n      const initContext = new CommandContext(commandToExecute, this.viewModelContext);\n      initContext.eventParams = command.eventParam || null;\n      const context$ = new BehaviorSubject<CommandContext>(initContext);\n      let currentTask = taskFlow.getNext('', initContext);\n      const highOrder$ = context$.pipe(\n        concatMap((context: CommandContext) => {\n          const result$ = currentTask.execute(context);\n          return result$.pipe(\n            take(1),\n            map((result: any) => {\n\n              // 写入执行结果\n              context.results[currentTask.name] = result;\n              context.latestResult = result;\n              currentTask = taskFlow.getNext(currentTask.name, context);\n\n              // 操作控制流\n              if (currentTask) {\n                context$.next(context);\n              } else {\n                context$.complete();\n              }\n\n              // 将结果流转换为context流\n              return context;\n            }),\n            throwIfEmpty(() => {\n              context$.complete();\n            })\n          );\n        })\n      );\n\n      // 3、执行合并后的任务流\n      highOrder$.pipe(\n        takeLast(1)\n      ).subscribe({\n        next: (context: CommandContext) => {\n          lastTaskResult$.next(context.latestResult);\n        },\n        error: (error: any) => {\n          this.displayError(error);\n          lastTaskResult$.error(error);\n        },\n        complete: () => {\n          lastTaskResult$.complete();\n        },\n      });\n\n    }, 0);\n\n    return lastTaskResult$;\n  }\n\n  /**\n   * 显示错误信息\n   */\n  private displayError(error: any) {\n    if (!console || !console.error) {\n      return;\n    }\n    if (!error) {\n      error = 'unknown error';\n    }\n    console.error(error);\n  }\n\n  /**\n   * 添加任务，只有子类可以添加任务，外部不能访问\n   * @param name  任务名称\n   * @param func 任务函数\n   */\n  protected addTask(name: string, func: TaskFunc) {\n    this.taskFlow.addNode(name, func);\n  }\n\n  /**\n   * 添加任务，只有子类可以添加任务，外部不能访问\n   * @param name  任务名称\n   * @param func 任务函数\n   */\n  protected addLink(from: string, to: string, condition: string | boolean) {\n    this.taskFlow.addLink(from, to, condition);\n  }\n\n  /**\n   * 插入任务\n   * @param  name 要扩展的任务名称\n   * @param  func 扩展函数\n   */\n  public insertTask(target: string, name: string, func: TaskFunc) {\n    throw new Error('Not Implemented');\n  }\n\n  /**\n   * 插入任务\n   * @param  name 要扩展的任务名称\n   * @param  func 扩展函数\n   */\n  public afterTask(target: string, name: string, func: TaskFunc) {\n    throw new Error('Not Implemented');\n  }\n\n  /**\n   * 替换任务\n   * @param  name 要替换的任务名称\n   * @param  func 替换函数\n   */\n  public replaceTask(name: string, func: TaskFunc) {\n    throw new Error('Not Implement');\n  }\n\n  /**\n   * 调用方法\n   */\n  public invoke(serviceInstance: any, method: string, args: any[], context: CommandContext) {\n    this.setContextToServiceInstance(serviceInstance, context);\n    const parsedArgs = this.parseService.parse(args, context);\n    return serviceInstance[method](...parsedArgs);\n  }\n\n  /**\n   * 为服务设置命令上下文\n   * @todo\n   * 通过这种方式存在很大问题：\n   * 1、会覆盖掉已有的context，给开发人员造成困扰和调试成本；\n   * 2、服务中依赖了一个没有声明的对象，不符合面向对象的原则。\n   * 建议解决方案：\n   * 1、将context修改为某个特殊属性名；\n   * 2、先检测服务上有没有一个CommandContext类型的context属性，有的话再赋值，\n   *    这就要求需要使用context的服务需要是实现一个IContext接口。\n   */\n  private setContextToServiceInstance(serviceInstance: any, context: CommandContext) {\n\n    // 如果服务上已经存在context属性，并且该属性不是CommandContext类型，则不能覆盖\n    const serviceContext = serviceInstance.context;\n    if (serviceContext && (serviceContext instanceof CommandContext === false)) {\n      return;\n    }\n\n    serviceInstance.context = context;\n  }\n}\n\n/**\n * 命令处理器注入Token\n */\nconst COMMAND_HANDLERS_TOKEN = createInjectionToken('@Farris/devkit COMMAND_HANDLERS_TOKEN');\n\nexport { CommandHandler, COMMAND_HANDLERS_TOKEN };\n","/**\n * 命令处理注册器相关定义\n * @author Witt<jiwt@inspur.com>\n */\nimport { MetadataUtil, Injector, InjectFlags } from '../core/index';\nimport { COMMAND_HANDLER_META, CommandHandlerMetadata } from './decorators';\nimport { COMMAND_HANDLERS_TOKEN, CommandHandler } from './command_handler';\n\n/**\n * 命令处理注册器\n */\nclass CommandHandlerRegistry {\n\n  /**\n   * CommandHandler Map\n   */\n  private handlerMap: Map<string, CommandHandler>;\n\n  /**\n   * 构造函数\n   * @param handlers 命令处理实例数组\n   */\n  constructor(private injector: Injector) {\n    const handlers = this.injector.get(COMMAND_HANDLERS_TOKEN, null, InjectFlags.Optional);\n    this.handlerMap = new Map<string, CommandHandler>();\n    if (handlers) {\n      handlers.forEach((handler: CommandHandler) => {\n        this.regist(handler);\n      });\n    }\n  }\n\n  /**\n   * 添加命令处理\n   * @param  commandName    命令名称\n   * @param  commandHandler 命令处理实例\n   */\n  public set(commandName: string, commandHandler: CommandHandler) {\n    if (this.handlerMap.has(commandName)) {\n      throw new Error(commandName + '对应的CommandHandler已经存在');\n    }\n    this.handlerMap.set(commandName, commandHandler);\n  }\n\n  /**\n   * 获取命令处理\n   * @param   commandName 命令名称\n   * @returns 命令处理实例\n   */\n  public get(commandName: string): CommandHandler {\n    if (this.handlerMap.has(commandName) === false) {\n      throw new Error('找不到' + commandName + '对应的CommandHandler');\n    }\n    return this.handlerMap.get(commandName);\n  }\n\n  /**\n   * 注册命令处理\n   * @param handlers 命令处理实例\n   */\n  public regist(commandHandler: CommandHandler) {\n\n    // 根据metadata获取对应的Command名称\n    const handlerMetadata: CommandHandlerMetadata =\n      MetadataUtil.getClassMetadataByName(commandHandler.constructor, COMMAND_HANDLER_META);\n    if (!handlerMetadata) {\n      throw new Error('CommandHandler必须指定要处理的命令名称');\n    }\n    const commandName = handlerMetadata.commandName;\n    this.set(commandName, commandHandler);\n  }\n\n}\n\nexport { CommandHandlerRegistry };\n","import { TypeDecorator, makeDecorator, makePropDecorator } from '../core/index';\n\n/**\n * ----------------------------------------\n * CommandHandlerMeta\n * ----------------------------------------\n */\n\n/**\n * 命令处理描述\n */\nexport interface CommandHandlerMetadata {\n\n  /**\n   * 要处理的名称\n   */\n  commandName: string;\n}\n\n\n/**\n * 命令处理装饰器名称\n */\nexport const COMMAND_HANDLER_META = 'CommandHandlerMeta';\n\n\n/**\n * 命令处理装饰器接口\n */\nexport interface CommandHandlerMetaDecorator {\n  (handler?: CommandHandlerMetadata): TypeDecorator;\n  new(handler?: CommandHandlerMetadata): CommandHandlerMetadata;\n}\n\n\n/**\n * 命令处理装饰器工厂\n */\n\nexport function CommandHandlerMeta(options: CommandHandlerMetadata) {\n  const decoratorFactory = makeDecorator(COMMAND_HANDLER_META, (handler: CommandHandlerMetadata) => handler);\n  return decoratorFactory(options);\n}\n\n\n/**\n * ----------------------------------------\n * CommandExtenderMeta\n * ----------------------------------------\n */\n\n/**\n * 命令处理扩展描述\n */\nexport interface CommandHandlerExtenderMetadata {\n  commandName: string;\n}\n\n\n/**\n * 命令处理扩展装饰器名称\n */\nexport const COMMAND_HANDLER_EXTENDER_META = 'CommandHandlerExtenderMeta';\n\n\n/**\n * 命令处理扩展装饰器接口\n */\nexport interface CommandHandlerExtenderMetaDecorator {\n  (extender?: CommandHandlerExtenderMetadata): TypeDecorator;\n  new(extender?: CommandHandlerExtenderMetadata): CommandHandlerExtenderMetadata;\n}\n\n/**\n * 命令处理扩展装饰器工厂\n */\nexport function CommandHandlerExtenderMeta(options: CommandHandlerExtenderMetadata) {\n  const decoratorFactory = makeDecorator(COMMAND_HANDLER_EXTENDER_META, (extender: CommandHandlerExtenderMetadata) => extender);\n  return decoratorFactory(options);\n}\n","/**\n * 命令处理扩展相关\n * @author Witt<jiwt@inspur.com>\n */\nimport { createInjectionToken, Injector } from '../core/index';\nimport { CommandHandler } from './command_handler';\n\n\nabstract class CommandHandlerExtender {\n\n  /**\n   * 扩展方法\n   * @param handler 要扩展的命令处理器\n   */\n  abstract extend(handler: CommandHandler): CommandHandler;\n\n}\n\n\n/**\n * 命令处理器扩展注入Token\n */\nconst COMMAND_HANDLER_EXTENDERS_TOKEN = createInjectionToken('@farris/devkit COMMAND_HANDLER_EXTENDERS_TOKEN');\n\nexport { CommandHandlerExtender, COMMAND_HANDLER_EXTENDERS_TOKEN };\n","/**\n * 命令处理扩展注册器相关定义\n * @author Witt<jiwt@inspur.com>\n */\n\nimport { MetadataUtil, Injector, InjectFlags } from '../core/index';\nimport { COMMAND_HANDLER_EXTENDER_META, CommandHandlerExtenderMetadata } from './decorators';\nimport { COMMAND_HANDLER_EXTENDERS_TOKEN, CommandHandlerExtender } from './command_handler_extender';\n\n/**\n * 命令处理扩展注册器\n */\nclass CommandHandlerExtenderRegistry {\n\n  /**\n   * CommandHandlerExtender实例Map\n   * - key：命令名称\n   * - value：命令扩展实例\n   */\n  private extendersMap: Map<string, CommandHandlerExtender[]>;\n\n  /**\n   * 构造函数\n   * @param extenders 命令扩展实例数组\n   */\n  constructor(private injector: Injector) {\n    const extenders = this.injector.get(COMMAND_HANDLER_EXTENDERS_TOKEN, null, InjectFlags.Optional);\n    this.extendersMap = new Map<string, CommandHandlerExtender[]>();\n    if (extenders) {\n      extenders.forEach((extender: CommandHandlerExtender) => {\n        this.regist(extender);\n      });\n    }\n  }\n\n  /**\n   * 获取命令扩展实例数组\n   * @param   commandName 命令名称\n   * @returns 命令处理扩展实例数组\n   */\n  get(commandName: string): CommandHandlerExtender[] {\n    if (this.extendersMap.has(commandName) === false) {\n      return [];\n    }\n    return this.extendersMap.get(commandName);\n  }\n\n  /**\n   * 添加命令扩展\n   * @param commandName Command名称\n   * @param extender    CommandHandlerExtender实例\n   * @return void\n   */\n  set(commandName: string, extender: CommandHandlerExtender) {\n    if (this.extendersMap.has(commandName)) {\n\n      // 如果commandName对应的扩展已经存在，则在扩展数组中追加\n      this.extendersMap.get(commandName).push(extender);\n    } else {\n\n      // 如果不存在，则创建新的扩展数组，并追加\n      this.extendersMap.set(commandName, [extender]);\n    }\n  }\n\n  /**\n   * 注册命令扩展\n   * @param extender CommandHandlerExtender实例\n   */\n  regist(extender: CommandHandlerExtender) {\n\n    // 通过元数据获取要扩展的Comamnd名称\n    const extenderMetadata: CommandHandlerExtenderMetadata =\n      MetadataUtil.getClassMetadataByName(extender.constructor, COMMAND_HANDLER_EXTENDER_META);\n    if (!extenderMetadata) {\n      throw new Error('CommandHandlerExtender必须指定要扩展的命令名称');\n    }\n    const commandName = extenderMetadata.commandName;\n\n    // 添加到Map中\n    this.set(commandName, extender);\n  }\n\n}\n\nexport { CommandHandlerExtenderRegistry };\n","/**\n * 命令处理器工厂相关定义\n * @author Witt<jiwt@inspur.com>\n */\n\nimport { ViewModelContext } from '../view-model/index';\nimport { CommandHandler } from './command_handler';\nimport { CommandHandlerRegistry } from './command_handler_registry';\nimport { CommandHandlerExtender } from './command_handler_extender';\nimport { CommandHandlerExtenderRegistry } from './command_handler_extender_registry';\n\n/**\n * 命令处理器工厂\n */\nclass CommandHandlerFactory {\n  /**\n   * 构造函数\n   * @param handlerRegistry  命令处理注册器\n   * @param extenderRegistry 命令处理扩展注册器\n   */\n  constructor(\n    private handlerRegistry: CommandHandlerRegistry,\n    private extenderRegistry: CommandHandlerExtenderRegistry,\n    private viewModelContext: ViewModelContext\n  ) {\n  }\n\n  /**\n   * 创建命令处理器\n   * @param   commandName 命令名称\n   * @returns 对应的命令处理器实例\n   */\n  public create(commandName: string): CommandHandler {\n    const rawHandler = this.handlerRegistry.get(commandName);\n    rawHandler.init(this.viewModelContext);\n    const extenders  = this.extenderRegistry.get(commandName);\n\n    // 遍历extenders，依次对handler进行扩展\n    return extenders.reduce((handler: CommandHandler, extender: CommandHandlerExtender) => {\n      return extender.extend(handler);\n    }, rawHandler);\n  }\n\n}\n\nexport { CommandHandlerFactory };\n","/**\n * CommandBus相关定义\n * @author Witt<jiwt@inspur.com>\n */\n\nimport { Observable, BehaviorSubject, Subject } from 'rxjs';\nimport { tap } from 'rxjs/operators';\nimport { Injector } from '../core/index';\nimport { Command } from './command';\nimport { CommandHandlerFactory } from './command_handler_factory';\nimport { CommandHandlerRegistry } from './command_handler_registry';\nimport { CommandHandlerExtenderRegistry } from './command_handler_extender_registry';\n\n\n/**\n * CommandBus用于派发Command，它接受一个Command实例，查找对应的CommandHandler，并执行。\n */\nclass CommandBus {\n\n  /**\n   * handler工厂\n   */\n  private handlerFactory: CommandHandlerFactory;\n\n  /**\n   * 正在执行的命令数量流（请勿使用，后果自负）\n   */\n  public executingCommandCount$: BehaviorSubject<number>;\n\n  /**\n   * 正在执行的命令数量\n   */\n  private executingCommands: Command[];\n\n  /**\n   * 构造函数\n   */\n  public constructor(handlerFactory: CommandHandlerFactory) {\n    this.handlerFactory = handlerFactory;\n    this.executingCommands = [];\n    this.executingCommandCount$ = new BehaviorSubject<number>(this.executingCommands.length);\n  }\n\n  /**\n   * 派发命令\n   * @param command 要派发的命令\n   */\n  public dispatch(command: Command): Observable<any> {\n    const commandResult$ = new Subject();\n    this.executeCommand(command).subscribe({\n        next: (lastTaskResult: any) => {\n          commandResult$.next(lastTaskResult);\n          commandResult$.complete();\n        },\n        complete: () => {\n          commandResult$.complete();\n          this.removeCommandFromExecutingQueue(command);\n        },\n        error: (error: any)  => {\n          commandResult$.error(error);\n          this.removeCommandFromExecutingQueue(command);\n        }\n      });\n    return commandResult$;\n  }\n\n  /**\n   * 执行命令并返回最后一个任务的执行结果流\n   */\n  private executeCommand(command: Command): Observable<any> {\n    this.addCommandToExecutingQueue(command);\n    const commandName = command.name;\n    const handler = this.handlerFactory.create(commandName);\n    const lastTaskResult$ = handler.execute(command);\n    return lastTaskResult$;\n  }\n\n\n  /**\n   * 添加到执行队列\n   */\n  private addCommandToExecutingQueue(command: Command) {\n    this.executingCommands.push(command);\n    this.executingCommandCount$.next(this.executingCommands.length);\n  }\n\n  /**\n   * 从执行队列中移除\n   */\n  private removeCommandFromExecutingQueue(command: Command) {\n    this.executingCommands = this.executingCommands.filter((executingCommand: Command) => {\n      return executingCommand !== command;\n    });\n    this.executingCommandCount$.next(this.executingCommands.length);\n  }\n\n}\n\nexport { CommandBus };\n","import { StaticProvider, Injector } from '../core/index';\nimport { ViewModelContext } from '../view-model/index';\nimport { CommandHandlerRegistry } from './command_handler_registry';\nimport { CommandHandlerExtenderRegistry } from './command_handler_extender_registry';\nimport { CommandHandlerFactory } from './command_handler_factory';\nimport { CommandBus } from './command_bus';\n\nconst VIEW_MODEL_COMMAND_PROVIDERS: StaticProvider[] = [\n  {\n    provide: CommandHandlerRegistry,\n    useClass: CommandHandlerRegistry,\n    deps: [ Injector ]\n  },\n  {\n    provide: CommandHandlerExtenderRegistry,\n    useClass: CommandHandlerExtenderRegistry,\n    deps: [ Injector ]\n  },\n  {\n    provide: CommandHandlerFactory,\n    useClass: CommandHandlerFactory,\n    deps: [ CommandHandlerRegistry, CommandHandlerExtenderRegistry, ViewModelContext ]\n  },\n  {\n    provide: CommandBus,\n    useClass: CommandBus,\n    deps: [ CommandHandlerFactory ]\n  }\n];\n\nexport { VIEW_MODEL_COMMAND_PROVIDERS };\n","/*\n * @Author: aalizzwell \n * @Date: 2019-05-30 11:08:18 \n * @Last Modified by: aalizzwell\n * @Last Modified time: 2019-06-01 17:10:04\n */\n\nimport { IExceptionHandler } from './types';\nexport const EXCEPTION_HANDLER = '@farris/devkit ExceptionHandler';","import { Type, makeDecorator } from '../core/index';\n\n/**\n * REPOSITORY_META\n */\nexport const REPOSITORY_META = 'RepositoryMeta';\n\n\n/**\n * RepositoryMeta\n */\nexport interface RepositoryMeta {\n\n  /**\n   * 实体类型\n   */\n  entityType: Type<any>;\n}\n\n\n/**\n * RepositoryMetaDecorator\n */\nexport interface RepositoryMetaDecorator {\n  (obj?: RepositoryMeta): any;\n  new (obj?: RepositoryMeta): any;\n}\n\n\n/**\n * RepositoryMeta\n */\nexport function RepositoryMeta(options: RepositoryMeta) {\n  const decoratorFactory = makeDecorator(\n    REPOSITORY_META,\n    (obj: RepositoryMeta) => obj\n  );\n  return decoratorFactory(options);\n}\n"]}
!function(e,A){"object"==typeof exports&&"undefined"!=typeof module?A(exports,require("rxjs"),require("@angular/core"),require("@angular/common"),require("@farris/ui-notify"),require("@angular/forms"),require("@farris/ui-locale"),require("@farris/ui-common")):"function"==typeof define&&define.amd?define("@farris/ui-avatar",["exports","rxjs","@angular/core","@angular/common","@farris/ui-notify","@angular/forms","@farris/ui-locale","@farris/ui-common"],A):A((e.farris=e.farris||{},e.farris["ui-avatar"]={}),e.rxjs,e.ng.core,e.ng.common,e.uiNotify,e.ng.forms,e.uiLocale,e.uiCommon)}(this,function(e,A,i,t,r,a,o,n){"use strict";var s=(g.decorators=[{type:i.Injectable,args:[{providedIn:"root"}]}],g.ctorParameters=function(){return[]},g.ngInjectableDef=i.defineInjectable({factory:function(){return new g},token:g,providedIn:"root"}),g);function g(){}var l=(Object.defineProperty(c.prototype,"readonly",{get:function(){return this.tReadOnly},set:function(e){if(e!==this.tReadOnly){var A=this.localeService.getValue("avatar.imgtitle");this.imgtitle=e?"":this.imgTitle?this.imgTitle:A,this.tReadOnly=e}},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"type",{get:function(){return this._type},set:function(e){var t=this;if(e&&e.length){var A=e;"string"==typeof e&&(A=e.split(",")),A&&A.length&&(this.currentImgType=[],A.forEach(function(e){if("string"==typeof e&&e.constructor==String){var A="image/"+e;"jpg"===e&&t.currentImgType.push("image/jpeg"),t.currentImgType.push(A)}}),0<this.currentImgType.length&&(this.imgType=this.currentImgType.join(",")))}},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"cover",{get:function(){return this._cover},set:function(e){e?(this._cover=e,this.imgsrcInit(this.cover)):this.imgSrc=this.defaultImgSrc},enumerable:!0,configurable:!0}),c.prototype.ngOnInit=function(){this.readonly?this.imgtitle="":this.imgTitle?this.imgtitle=this.imgTitle:this.imgtitle=this.localeService.getValue("avatar.imgtitle")},c.prototype.imgsrcInit=function(e){if(this.isSrc(e))this.imgSrc=this.perfixStr+e;else{var A=this.isBaseSrc(e);this.imgSrc=A?e:this.addBase64(e)}},c.prototype.onClick=function(){this.readonly||this.file.nativeElement.click()},c.prototype.getfiledata=function(e){if(!this.readonly){var A=e.target,t=A.files;if(t[0]){var i=t[0].type,r=t[0].size/1024/1024<this.size;if(this.currentImgType.indexOf(i)<0){var a=this.localeService.getValue("avatar.typeError");return this.notifyService.error({type:"error",title:"",msg:a}),void(A.value="")}if(!r){var o=this.localeService.getValue("avatar.sizeError")+this.size+"M!";return this.notifyService.error({type:"error",title:"",msg:o}),void(A.value="")}this.transformFile(t[0]),A.value=""}}},c.prototype.getImgFileObj=function(){return this.imgFileObj},c.prototype.transformFile=function(e){var t=this;this.imgFileObj={size:e.size,name:e.name,type:e.type,lastModified:e.lastModified,lastModifiedDate:e.lastModifiedDate},this["do"](e).subscribe(function(e){if(t.loadingImg=!1,"done"===e.state)t.imgSrc=e.result,t.onChangeCallback(t.removeBase64(t.imgSrc)),t.onTouchedCallback();else if("error"===e.state){var A=t.localeService.getValue("avatar.uploadError");t.notifyService.error({type:"error",title:"",msg:A})}t.imgFileObj.state=e.state,t.imgFileObj.base64=e.result,t.imgChange.emit(t.imgFileObj)})},c.prototype.read=function(t){return A.Observable.create(function(e){var A=new FileReader;A.readAsDataURL(t),A.onload=function(){e.next({state:"done",result:A.result}),e.complete()},A.onerror=function(){e.next({state:"error",result:A.result}),e.complete()}})},c.prototype["do"]=function(e){return this.read(e)},c.prototype.writeValue=function(e){e&&e.length?this.imgsrcInit(e):this.cover?this.imgsrcInit(this.cover):this.imgSrc=this.defaultImgSrc},c.prototype.registerOnChange=function(e){this.onChangeCallback=e},c.prototype.registerOnTouched=function(e){this.onTouchedCallback=e},c.prototype.addBase64=function(e){if(e)return"data:image/jpeg;base64,"+e},c.prototype.removeBase64=function(e){if(e){var A=e.split(",");return A.length?A[1]:void 0}},c.prototype.isSrc=function(e){return null!=e.match(/\.(jpeg|jpg|gif|png|svg|bmp|webp)$/)},c.prototype.isBaseSrc=function(e){return-1<e.indexOf("data:image/")},c.prototype.errorSrc=function(){this.imgSrc=this.errorImgSrc,this.imgtitle=this.localeService.getValue("avatar.loadError")},c.decorators=[{type:i.Component,args:[{selector:"farris-avatar",template:'\x3c!-- bugNum5:471047 --\x3e\r\n<div class="f-avatar" [title]="imgtitle"\r\n    [ngClass]="{\'f-avatar-readonly\': tReadOnly,\'f-avatar-circle\':imgShape === \'circle\',\'f-avatar-square\':imgShape === \'square\'}"\r\n    [ngStyle]="{\'width\': avatarWidth+\'px\',\'height\':avatarHeight+\'px\'}">\r\n    <ng-container *ngIf="loadingImg">\r\n        <div class="f-avatar-upload-loading">\r\n            <div class="loading-inner">\r\n                加载中\r\n            </div>\r\n        </div>\r\n    </ng-container>\r\n    <img class="f-avatar-image" [attr.src]="imgSrc" (error)="errorSrc()">\r\n    <div class="f-avatar-icon" *ngIf="!tReadOnly">\r\n        <span class="f-icon f-icon-camera"></span>\r\n    </div>\r\n    <input type="file" class="f-avatar-upload" [accept]=\'imgType\' (change)="getfiledata($event)" #file\r\n        style="display: none;">\r\n</div>',providers:[{provide:a.NG_VALUE_ACCESSOR,useExisting:i.forwardRef(function(){return c}),multi:!0}],styles:[".f-avatar{position:relative;cursor:pointer;overflow:hidden}.f-avatar.f-avatar-readonly{cursor:default}.f-avatar.f-avatar-circle{border-radius:100%;overflow:hidden}.f-avatar.f-avatar-square{border-radius:0}.f-avatar .f-avatar-defult,.f-avatar .f-avatar-image{display:inline-block;width:100%;height:100%}.f-avatar .f-avatar-icon{display:none;position:absolute;left:0;right:0;top:0;bottom:0;-webkit-box-align:center;align-items:center;-webkit-box-pack:center;justify-content:center;background:rgba(0,0,0,.3)}.f-avatar .f-avatar-icon .f-icon{font-size:24px;color:#fff}.f-avatar.f-avatar-circle .f-avatar-icon{border-radius:100%}.f-avatar.f-avatar-square .f-avatar-icon{border-radius:0}.f-avatar .f-avatar-upload-loading{position:absolute;left:0;top:0;display:inline-block;width:100%;height:100%;background-color:rgba(0,0,0,.15)}.f-avatar .f-avatar-upload-loading .loading-inner{position:absolute;width:100%;left:0;top:50%;margin-top:-25px;height:50px;line-height:50px;text-align:center;font-size:16px;color:#fff}.f-avatar:hover .f-avatar-icon{display:-webkit-box;display:flex}"]}]}],c.ctorParameters=function(){return[{type:r.NotifyService},{type:o.LocaleService},{type:i.Injector,decorators:[{type:i.Optional}]}]},c.propDecorators={file:[{type:i.ViewChild,args:["file"]}],readonly:[{type:i.Input}],size:[{type:i.Input}],imgTitle:[{type:i.Input}],avatarWidth:[{type:i.Input}],avatarHeight:[{type:i.Input}],imgShape:[{type:i.Input}],imgChange:[{type:i.Output,args:["imgChange"]}],type:[{type:i.Input}],cover:[{type:i.Input}],onClick:[{type:i.HostListener,args:["click"]}]},c);function c(e,A,t){this.notifyService=e,this.localeService=A,this.inject=t,this.defaultImgSrc="data:image/jpeg;base64,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",this.errorImgSrc="data:image/jpeg;base64,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",this.tReadOnly=!1,this.size=1,this.avatarWidth=100,this.avatarHeight=100,this.imgShape="circle",this.imgtitle="点击修改",this.imgChange=new i.EventEmitter,this.onChangeCallback=function(){},this.onTouchedCallback=function(){},this.perfixStr="",this.imgType="image/*",this.currentImgType=["image/image","image/webp","image/png","image/svg","image/gif","image/jpg","image/jpeg","image/bmp"],this.notifyService.config.position="top-center",this.inject&&n.WEBAPI_PREFIX_TOKEN&&(this.perfixStr=this.inject.get(n.WEBAPI_PREFIX_TOKEN,""))}var f=(u.decorators=[{type:i.NgModule,args:[{declarations:[l],imports:[t.CommonModule,a.FormsModule,r.NotifyModule,n.FarrisCommonModule,o.LocaleModule.forRoot()],exports:[l]}]}],u);function u(){}e.AvatarService=s,e.AvatarComponent=l,e.AvatarModule=f,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=farris-ui-avatar.umd.min.js.map
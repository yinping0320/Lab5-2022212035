{"version":3,"sources":["ng://@farris/ui-avatar/lib/avatar.service.ts","ng://@farris/ui-avatar/lib/avatar.component.ts","ng://@farris/ui-avatar/lib/avatar.module.ts"],"names":["AvatarService","Injectable","args","providedIn","AvatarComponent","Object","defineProperty","prototype","this","tReadOnly","value","localeTitle","localeService","getValue","imgtitle","imgTitle","_type","val","_this","length","types","split","currentImgType","forEach","t","constructor","String","tImgtype","push","imgType","join","_cover","imgsrcInit","cover","imgSrc","defaultImgSrc","ngOnInit","readonly","isSrc","perfixStr","isFullBase64","isBaseSrc","addBase64","onClick","file","click","getfiledata","event","filetarget","getfile","files","fileType","type","isLtSize","size","indexOf","typeerrorText","notifyService","error","title","msg","errormes","transformFile","getImgFileObj","imgFileObj","name","lastModified","lastModifiedDate","do","subscribe","res","loadingImg","onChangeCallback","removeBase64","onTouchedCallback","uploaderrorText","state","base64","imgChange","emit","read","Observable","create","observer","reader","FileReader","readAsDataURL","onload","next","result","complete","onerror","writeValue","registerOnChange","fn","registerOnTouched","img_arr","url","match","errorSrc","errorImgSrc","Component","selector","template","providers","provide","NG_VALUE_ACCESSOR","useExisting","forwardRef","multi","NotifyService","LocaleService","Injector","decorators","Optional","ViewChild","Input","Output","HostListener","inject","avatarWidth","avatarHeight","imgShape","EventEmitter","config","position","WEBAPI_PREFIX_TOKEN","get","AvatarModule","NgModule","declarations","imports","CommonModule","FormsModule","NotifyModule","FarrisCommonModule","LocaleModule","forRoot","exports"],"mappings":"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","sourcesContent":["import { Injectable } from '@angular/core';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class AvatarService {\r\n\r\n  constructor() { }\r\n}\r\n","import { Component, OnInit, ViewChildren, ElementRef, Input, Output, EventEmitter, HostListener, ViewChild, forwardRef, Injector, Optional } from '@angular/core';\r\nimport { Observable, Subject } from 'rxjs';\r\nimport { NotifyService } from '@farris/ui-notify';\r\nimport { ControlValueAccessor, NG_VALUE_ACCESSOR } from '@angular/forms';\r\nimport { LocaleService } from '@farris/ui-locale';\r\nimport { WEBAPI_PREFIX_TOKEN } from '@farris/ui-common';\r\n\r\nexport interface upImageFile {\r\n  size: number;\r\n  name: string;\r\n  type: string;\r\n  lastModified?: string;\r\n  lastModifiedDate?: Date;\r\n  state?: string;\r\n  base64?: string;\r\n}\r\n\r\n@Component({\r\n  selector: 'farris-avatar',\r\n  templateUrl: './avatar.component.html',\r\n  styleUrls: ['./avatar.component.scss'],\r\n  providers: [\r\n    {\r\n      provide: NG_VALUE_ACCESSOR,\r\n      useExisting: forwardRef(() => AvatarComponent),\r\n      multi: true\r\n    }\r\n  ]\r\n})\r\nexport class AvatarComponent implements ControlValueAccessor, OnInit {\r\n  private defaultImgSrc = 'data:image/jpeg;base64,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'\r\n  private errorImgSrc = 'data:image/jpeg;base64,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';\r\n  public imgSrc;\r\n  // public fileBinary: string;\r\n  @ViewChild('file') file: ElementRef;\r\n  // @Input() cover = '';\r\n  tReadOnly: boolean = false;\r\n  @Input()\r\n  set readonly(value: boolean) {\r\n    if (value !== this.tReadOnly) {\r\n      let localeTitle = this.localeService.getValue('avatar.imgtitle');\r\n      this.imgtitle = value ? '' : (this.imgTitle ? this.imgTitle : localeTitle);\r\n      this.tReadOnly = value;\r\n    }\r\n\r\n  };\r\n  get readonly(): boolean {\r\n    return this.tReadOnly;\r\n  }\r\n  // @Input() type;\r\n  @Input() size: number = 1;\r\n  @Input() imgTitle: string;\r\n  @Input() avatarWidth: number = 100;\r\n  @Input() avatarHeight: number = 100;\r\n  @Input() imgShape: string = 'circle';\r\n  imgtitle: string = 'ç¹å»ä¿®æ¹';\r\n  // @Input() isBase64:boolean = true;\r\n  @Output('imgChange') imgChange = new EventEmitter();\r\n\r\n  _type;\r\n  @Input()\r\n  set type(val) {\r\n    if (val && val.length) {\r\n      let types = val;\r\n      if (typeof val === 'string') {\r\n        types = val.split(',');\r\n      }\r\n      if (types && types.length) {\r\n        this.currentImgType = [];\r\n        types.forEach(t => {\r\n          if ((typeof t == 'string') && t.constructor == String) {\r\n            let tImgtype = 'image/' + t;\r\n            if (t === 'jpg') {\r\n              let jpgType = 'image/jpeg';\r\n              this.currentImgType.push(jpgType);\r\n            }\r\n            this.currentImgType.push(tImgtype);\r\n          }\r\n        });\r\n        if (this.currentImgType.length > 0) {\r\n          this.imgType = this.currentImgType.join(',')\r\n        }\r\n      }\r\n    }\r\n  }\r\n  get type() {\r\n    return this._type;\r\n  }\r\n  _cover;\r\n  @Input()\r\n  set cover(val) {\r\n    if (val) {\r\n      this._cover = val;\r\n      this.imgsrcInit(this.cover);\r\n    }\r\n    else {\r\n      this.imgSrc = this.defaultImgSrc;\r\n    }\r\n  }\r\n  get cover() {\r\n    return this._cover;\r\n  }\r\n\r\n  private onChangeCallback: Function = () => { }\r\n  private onTouchedCallback: Function = () => { }\r\n  private perfixStr='';\r\n  //æ¯å¦å è½½ä¸­\r\n  loadingImg: boolean;\r\n  imgType = 'image/*';\r\n  imgFileObj: upImageFile;\r\n  currentImgType = ['image/image', 'image/webp', 'image/png', 'image/svg', 'image/gif', 'image/jpg', 'image/jpeg', 'image/bmp'];\r\n  constructor(private notifyService: NotifyService, public localeService: LocaleService,@Optional() private inject:Injector) {\r\n    this.notifyService.config.position = 'top-center';\r\n\r\n    if(this.inject){\r\n      if(WEBAPI_PREFIX_TOKEN){\r\n          this.perfixStr = this.inject.get(WEBAPI_PREFIX_TOKEN, '');\r\n      }\r\n   }\r\n  }\r\n\r\n  ngOnInit() {\r\n    // if(this.cover){\r\n    //   this.imgsrcInit(this.cover);\r\n    // }\r\n    // else{\r\n    //   this.imgSrc = this.defaultImgSrc;\r\n    // }\r\n    if (this.readonly) {\r\n      this.imgtitle = '';\r\n    }\r\n    else if (this.imgTitle) {\r\n      this.imgtitle = this.imgTitle;\r\n    }\r\n    else {\r\n      this.imgtitle = this.localeService.getValue('avatar.imgtitle');\r\n    }\r\n  }\r\n  /*å¤æ­coveræ°æ®æ ¼å¼ï¼ååºä¿®æ¹èµå¼ç»imgSrc\r\n  */\r\n  imgsrcInit(val) {\r\n    let isImg = this.isSrc(val);\r\n    if (isImg) {\r\n      this.imgSrc = this.perfixStr+val;\r\n    }\r\n    else {\r\n      let isFullBase64 = this.isBaseSrc(val);\r\n      if (isFullBase64) {\r\n        this.imgSrc = val\r\n      }\r\n      else {\r\n        this.imgSrc = this.addBase64(val);\r\n      }\r\n    }\r\n  }\r\n\r\n  @HostListener('click')\r\n  onClick(): void {\r\n    if (this.readonly) {\r\n      return;\r\n    }\r\n    (this.file.nativeElement as HTMLInputElement).click();\r\n  }\r\n\r\n  getfiledata(event) {\r\n    if (this.readonly) {\r\n      return;\r\n    }\r\n    const filetarget = event.target as HTMLInputElement;\r\n    let getfile = filetarget.files;\r\n    if (!getfile[0]) {\r\n      return;\r\n    }\r\n    let fileType = getfile[0].type;\r\n    const isLtSize = getfile[0].size / 1024 / 1024 < this.size;\r\n    if (this.currentImgType.indexOf(fileType) < 0) {\r\n      let typeerrorText = this.localeService.getValue('avatar.typeError');\r\n      this.notifyService.error({\r\n        type: 'error',\r\n        title: '',\r\n        msg: typeerrorText\r\n      });\r\n      filetarget.value = '';\r\n      // this.notifyService.error('ä¸ä¼ å¾çç±»åä¸æ­£ç¡®');\r\n      return;\r\n    }\r\n\r\n    if (!isLtSize) {\r\n      let sizeerrorText = this.localeService.getValue('avatar.sizeError');\r\n      let errormes: string = sizeerrorText + this.size + \"M!\";\r\n      this.notifyService.error({\r\n        type: 'error',\r\n        title: '',\r\n        msg: errormes\r\n      });\r\n      filetarget.value = '';\r\n      // this.notifyService.error(`ä¸ä¼ å¾çä¸è½å¤§äº${this.size}M!`);\r\n      return;\r\n    }\r\n    this.transformFile(getfile[0]);\r\n    filetarget.value = '';\r\n  }\r\n\r\n  public getImgFileObj() {\r\n    return this.imgFileObj;\r\n  }\r\n\r\n  transformFile(getfile: any) {\r\n    // const subject = new Subject();\r\n    this.imgFileObj = {\r\n      size: getfile.size,\r\n      name: getfile.name,\r\n      type: getfile.type,\r\n      lastModified: getfile.lastModified,\r\n      lastModifiedDate: getfile.lastModifiedDate\r\n    }\r\n    this.do(getfile).subscribe(res => {\r\n      this.loadingImg = false;\r\n      if (res['state'] === 'done') {\r\n        this.imgSrc = res['result'];\r\n\r\n        //this.onChangeCallback(this.imgSrc);\r\n        this.onChangeCallback(this.removeBase64(this.imgSrc));\r\n        this.onTouchedCallback();\r\n      }\r\n      else if (res['state'] === 'error') {\r\n        let uploaderrorText = this.localeService.getValue('avatar.uploadError');\r\n        this.notifyService.error({\r\n          type: 'error',\r\n          title: '',\r\n          msg: uploaderrorText\r\n        })\r\n        // this.notifyService.error('å¾çä¸ä¼ å¤±è´¥ï¼è¯·éè¯!');\r\n      }\r\n      this.imgFileObj.state = res['state'];\r\n      this.imgFileObj.base64 = res['result'];\r\n      this.imgChange.emit(this.imgFileObj);\r\n    });\r\n  }\r\n\r\n  read(file: File): Observable<string> {\r\n    return Observable.create(observer => {\r\n      const reader = new FileReader();\r\n      reader.readAsDataURL(file);\r\n      //this.loadingImg = true;\r\n      // reader.onloadstart=function(){}\r\n      reader.onload = () => {\r\n        //console.log(reader.result);\r\n        observer.next({ state: 'done', 'result': reader.result });\r\n        observer.complete();\r\n      };\r\n      reader.onerror = function () {\r\n        observer.next({ state: 'error', 'result': reader.result });\r\n        observer.complete();\r\n      }\r\n    });\r\n  }\r\n  do(file: any): Observable<string> {\r\n    return this.read(file as File);\r\n  }\r\n\r\n  writeValue(val: any): void {\r\n    if (val && val.length) {\r\n      // if(this.isBase64){\r\n      //   this.imgSrc = this.addBase64(val);\r\n      // }\r\n      // else{\r\n      //   this.imgSrc = val;\r\n      // }\r\n      this.imgsrcInit(val);\r\n    }\r\n    else if (this.cover) {\r\n      this.imgsrcInit(this.cover);\r\n    }\r\n    else {\r\n      this.imgSrc = this.defaultImgSrc;\r\n    }\r\n  }\r\n  registerOnChange(fn: any): void {\r\n    this.onChangeCallback = fn;\r\n  }\r\n  registerOnTouched(fn: any): void {\r\n    this.onTouchedCallback = fn;\r\n  }\r\n  // setDisabledState?(isDisabled: boolean): void {\r\n  //     this.disabled = isDisabled;\r\n  // }\r\n\r\n  addBase64(val) {\r\n    if (!val) return;\r\n    return 'data:image/jpeg;base64,' + val;\r\n  }\r\n\r\n  removeBase64(val) {\r\n    if (!val) return;\r\n    let img_arr = val.split(',');\r\n    if (img_arr.length) {\r\n      return img_arr[1];\r\n    }\r\n\r\n  }\r\n  //å¤æ­æ¯å¦æ¯å¾çè·¯å¾\r\n  isSrc(url) {\r\n    return (url.match(/\\.(jpeg|jpg|gif|png|svg|bmp|webp)$/) != null)\r\n  }\r\n  //å¤æ­æ¯å¦æ¯å®æbase64\r\n  isBaseSrc(url) {\r\n    return (url.indexOf('data:image/') > -1 ? true : false)\r\n  }\r\n\r\n  errorSrc() {\r\n    this.imgSrc = this.errorImgSrc;\r\n    this.imgtitle = this.localeService.getValue('avatar.loadError');\r\n  }\r\n\r\n}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { NotifyModule } from '@farris/ui-notify';\r\nimport { AvatarComponent } from './avatar.component';\r\nimport { FormsModule } from '@angular/forms';\r\nimport { LocaleModule } from '@farris/ui-locale';\r\nimport { FarrisCommonModule } from '@farris/ui-common';\r\n\r\n@NgModule({\r\n  declarations: [AvatarComponent],\r\n  imports: [\r\n    CommonModule,\r\n    FormsModule,\r\n    NotifyModule,\r\n    FarrisCommonModule,\r\n    LocaleModule.forRoot()\r\n  ],\r\n  exports: [AvatarComponent]\r\n})\r\nexport class AvatarModule { }\r\n"]}
/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { ComponentFactoryResolver, Directive, HostListener, Injector, Input, NgZone, Renderer2 } from '@angular/core';
import { reqAnimFrame } from '@farris/ui-common';
import { InputGroupComponent } from '@farris/ui-input-group';
import { debounceTime, filter, map } from 'rxjs/operators';
import { LookupGridDisplayType } from '../lookup-displaytype';
import { LookupGridComponent } from '../lookup-grid.component';
import { LookupQuickSelectPanelComponent } from './quick-select-panel.component';
export class LookupQuickSelectDirective {
    /**
     * @param {?} injector
     * @param {?} ngzone
     * @param {?} render
     * @param {?} inputRef
     * @param {?} lookupRef
     * @param {?} cfr
     */
    constructor(injector, ngzone, render, inputRef, lookupRef, cfr) {
        this.injector = injector;
        this.ngzone = ngzone;
        this.render = render;
        this.inputRef = inputRef;
        this.lookupRef = lookupRef;
        this.cfr = cfr;
        this.data = [];
    }
    /**
     * @return {?}
     */
    ngOnInit() {
    }
    /**
     * @return {?}
     */
    ngAfterViewInit() {
        if (this.options && this.options.enable) {
            this.inputRef.inputClick.subscribe((/**
             * @param {?} e
             * @return {?}
             */
            (e) => {
                e.stopPropagation();
                if (!this.panelElement) {
                    // 执行帮助前
                    this.lookupRef.dictPicking({
                        instance: this,
                    }).subscribe((/**
                     * @param {?} pr
                     * @return {?}
                     */
                    (pr) => {
                        if (this.lookupRef.displayType === LookupGridDisplayType.TreeList || (!this.lookupRef.singleSelect && this.lookupRef.viewType === 'text')) {
                            return;
                        }
                        const { show, customData, message } = this.lookupRef.dialogMgr.checkDictPickingResult(pr);
                        this.lookupRef.customData = customData;
                        if (show) {
                            this.createDataPanel();
                        }
                        else {
                            if (message) {
                                this.lookupRef.notifyService.warning(message);
                            }
                        }
                    }));
                }
            }));
            this.inputRef.valueChange.pipe(debounceTime(200)).subscribe((/**
             * @param {?} val
             * @return {?}
             */
            (val) => {
                this.lookupRef.dictPicking({ instance: this }).subscribe((/**
                 * @param {?} pr
                 * @return {?}
                 */
                (pr) => {
                    if (this.lookupRef.displayType === LookupGridDisplayType.TreeList || (!this.lookupRef.singleSelect && this.lookupRef.viewType === 'text')) {
                        return;
                    }
                    const { show, customData, message } = this.lookupRef.dialogMgr.checkDictPickingResult(pr);
                    this.lookupRef.customData = customData;
                    if (!this.panelElement) {
                        this.createDataPanel();
                    }
                    else {
                        this.panelElement.style.overflow = 'hidden';
                        this.setPanelPosition(false);
                        this.loadData();
                    }
                }));
            }));
            this.inputRef.keydownHandle.pipe(filter((/**
             * @param {?} event
             * @return {?}
             */
            (event) => {
                return event.key === 'Escape' || event.key === 'Tab' || event.key === 'F2';
            }))).subscribe((/**
             * @param {?} e
             * @return {?}
             */
            (e) => {
                this.hide(e);
            }));
        }
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        this.lookupRef.overLayService.destory(this.lookupRef.el.nativeElement);
    }
    /**
     * @private
     * @return {?}
     */
    removePanelElement() {
        document.body.removeChild(this.panelElement);
        this.panelElement = null;
    }
    /**
     * @private
     * @return {?}
     */
    clearSearchValue() {
        this.lookupRef._searchState = {
            field: '*',
            //"*",
            value: ''
        };
    }
    /**
     * @param {?=} e
     * @param {?=} isMoreClick
     * @return {?}
     */
    hide(e, isMoreClick = false) {
        reqAnimFrame((/**
         * @return {?}
         */
        () => {
            if (this.panelElement) {
                if (e && (e.type === 'mousewheel' || e.type === 'wheel')) {
                    this.removePanelElement();
                }
                else {
                    this.panelElement.classList.remove('f-area-show');
                    setTimeout((/**
                     * @return {?}
                     */
                    () => {
                        this.removePanelElement();
                    }), 120);
                }
                if (!this.lookupRef) {
                    return;
                }
                // tfs 579056
                if (this.lookupRef.overLayService) {
                    this.lookupRef.overLayService.destory(this.lookupRef.el.nativeElement);
                }
                if (isMoreClick) {
                    return;
                }
                if (this.lookupRef.tagInput) {
                    // this.lookupRef.tagInput.value = '';
                    this.inputRef.value = '';
                    this.clearSearchValue();
                }
                if (e && (e.key === 'F2' || this.lookupRef.el.nativeElement.contains(e.target))) {
                    if (this.data && this.data.length) {
                        return;
                    }
                    else {
                        this.clearSearchValue();
                    }
                }
                if (!this.lookupRef.nosearch && this.lookupRef.displayText !== this.lookupRef.originalText) {
                    this.lookupRef.onChanges(this.lookupRef.originalText);
                }
            }
        }));
    }
    /**
     * @private
     * @param {?=} updateTopPosition
     * @return {?}
     */
    setPanelPosition(updateTopPosition = true) {
        if (this.panelElement) {
            const { width, left, top, height } = this.getPanelSize();
            this.panelElement.style.width = `${width}px`;
            this.panelElement.style.maxHeight = `${height}px`;
            if (updateTopPosition) {
                this.panelElement.style.top = `${top}px`;
            }
            this.panelElement.style.left = `${left}px`;
            this.panelElement.style.zIndex = '10001';
        }
    }
    /**
     * @private
     * @return {?}
     */
    createDataPanel() {
        if (this.lookupRef.changeDetector['destroyed']) {
            this.panelElement && this.removePanelElement();
            return;
        }
        this.panelElement = document.createElement('div');
        this.panelElement.classList.add('overlay-pane', 'f-lookup_quick-panel', 'f-area-hide');
        document.body.appendChild(this.panelElement);
        this.setPanelPosition();
        this.panelElement.style.overflow = 'hidden';
        // this.panelElement.style.height = 'auto';
        // 创建数据展示组件
        /** @type {?} */
        const cmpFact = this.cfr.resolveComponentFactory(LookupQuickSelectPanelComponent);
        this.cmpRef = cmpFact.create(this.injector);
        this.cmpRef.instance.showMore = this.options.showMore;
        this.cmpRef.instance.textField = this.lookupRef.textField;
        this.cmpRef.instance.formatter = this.options.formatter;
        this.cmpRef.instance.maxItems = this.options.showItemsCount;
        // cmpRef.location.nativeElement.classList.add('farris-main-area');
        this.panelElement.appendChild(this.cmpRef.location.nativeElement);
        this.lookupRef.selectionMgr.initDisplayValue();
        this.cmpRef.changeDetectorRef.detectChanges();
        // more clicked 打开帮助窗口
        this.cmpRef.instance.moreClcik.subscribe((/**
         * @param {?} e
         * @return {?}
         */
        (e) => {
            this.hide(e, true);
            this.lookupRef.showDialog();
        }));
        this.cmpRef.instance.itemClick.subscribe((/**
         * @param {?} e
         * @return {?}
         */
        (e) => {
            const { data } = e;
            this.selectItem(data);
        }));
        // 注册鼠标滚轮，点击事件，用于隐藏Panel
        this.lookupRef.overLayService.registerMouseEvent(this.lookupRef.el.nativeElement, (/**
         * @param {?} e
         * @return {?}
         */
        (e) => {
            if (!this.panelElement || e.target['closest']('.f-lookup_quick-panel')) {
                return;
            }
            if (this.lookupRef.inputGroup && this.lookupRef.inputGroup.textbox.nativeElement === e.target) {
                return false;
            }
            if (this.lookupRef.tagInput && this.lookupRef.tagInput.textbox.nativeElement === e.target) {
                return false;
            }
            if (this.cmpRef) {
                this.cmpRef.destroy();
                this.cmpRef = null;
            }
            this.clearSearchValue();
            this.hide(e);
        }));
        this.panelElement.classList.add('f-area-show');
        this.loadData();
    }
    /**
     * @private
     * @param {?} data
     * @return {?}
     */
    selectItem(data) {
        if (!data) {
            return;
        }
        if (this.lookupRef.viewType === 'tag') {
            /** @type {?} */
            const isSelect = this.lookupRef.selections.find((/**
             * @param {?} n
             * @return {?}
             */
            n => n[this.lookupRef.idField] === data[this.lookupRef.idField]));
            if (!isSelect) {
                /** @type {?} */
                const selectItems = [...this.lookupRef.selections, data];
                this.lookupRef.selectItem(selectItems);
                this.lookupRef.lookupSelectionSer.loadSelections(selectItems);
            }
        }
        else {
            this.lookupRef.selectItem(data);
        }
        this.hide();
    }
    /**
     * @private
     * @return {?}
     */
    calculationPanelHeight() {
        return this.options.showItemsCount * 30 + (this.options.showMore ? 50 : 0) + (this.options.footerHeight || 0) + 5;
    }
    /**
     * @private
     * @return {?}
     */
    getInputSizeInfo() {
        /** @type {?} */
        const el = this.lookupRef.viewType === 'text' ? this.inputRef.inputGroup : this.lookupRef.tagbox;
        return el.nativeElement.getBoundingClientRect();
    }
    /**
     * @private
     * @return {?}
     */
    getPanelSize() {
        let { width, height, top, left } = this.getInputSizeInfo();
        /** @type {?} */
        const bottom = window.innerHeight - height - top;
        /** @type {?} */
        let panelHeight = this.calculationPanelHeight();
        /** @type {?} */
        const h = top > bottom ? top : bottom;
        if (bottom > panelHeight) {
            top = top + height;
            // 面板由上向下展开
            this.panelElement.style.transformOrigin = '100% top';
        }
        else {
            if (top > bottom) {
                if (h < panelHeight) {
                    panelHeight = h - 10;
                    top = 10;
                }
                else {
                    top = top - parseInt('' + panelHeight, 10) - 5;
                }
                // 面板由下向上展开
                this.panelElement.style.transformOrigin = '100% bottom';
            }
            else {
                if (h < panelHeight) {
                    panelHeight = h - 10;
                }
                top = top + height;
            }
        }
        /** @type {?} */
        const minWidth = this.options.minWidth || 200;
        /** @type {?} */
        let _width = width < minWidth ? minWidth : width;
        if (window.innerWidth - left < _width) {
            left = left + width - _width;
        }
        return { width: _width, top, height: panelHeight, left };
    }
    /**
     * @private
     * @return {?}
     */
    getData() {
        /** @type {?} */
        let p = {
            pageInfo: {
                pageSize: this.options.showItemsCount,
                pageIndex: 1,
            },
        };
        /** @type {?} */
        let t = "all";
        if (this.lookupRef.isTextChange) {
            this.lookupRef._searchState = {
                field: this.lookupRef.textField,
                //"*",
                value: this.lookupRef.displayText
            };
            p['search'] = this.lookupRef._searchState;
            t = 'search';
        }
        else {
            this.lookupRef._searchState = null;
        }
        if (this.lookupRef.viewType === 'tag') {
            if (this.lookupRef.tagInput.value !== '') {
                this.lookupRef._searchState = {
                    field: this.lookupRef.textField,
                    //"*",
                    value: this.lookupRef.tagInput.value
                };
                p['search'] = this.lookupRef._searchState;
                t = 'search';
            }
            else {
                this.lookupRef._searchState = null;
            }
            /** @type {?} */
            const vals = this.lookupRef.selectionMgr.getSelectedIds();
            if (vals && vals.length) {
                p["selectedInfo"] = {
                    selected: true,
                    selectedIds: vals,
                };
            }
        }
        return this.lookupRef.httpMgr.lookupRequest(p, t, true).pipe(map((/**
         * @param {?} restData
         * @return {?}
         */
        (restData) => {
            /** @type {?} */
            let _items = this.lookupRef.items || [];
            if (restData) {
                if (this.lookupRef.viewType === 'tag') {
                    this.lookupRef.lookupSelectionSer.loadSelections(restData["selectedData"] || []);
                }
                _items = restData.items || [];
                if (restData.displayType.toLowerCase().indexOf('treelist') > -1 && _items.length && _items[0].data) {
                    _items = _items.map((/**
                     * @param {?} n
                     * @return {?}
                     */
                    n => n.data));
                }
                // return _items.slice(0, this.options.showItemsCount);
            }
            else {
                if (this.lookupRef.displayText && this.lookupRef.isTextChange) {
                    if (restData.displayType.toLowerCase().indexOf('treelist') > -1 && _items.length && _items[0].data) {
                        _items = _items.map((/**
                         * @param {?} n
                         * @return {?}
                         */
                        n => n.data));
                    }
                    /** @type {?} */
                    const items = _items.filter((/**
                     * @param {?} n
                     * @return {?}
                     */
                    n => {
                        return n[this.lookupRef.textField].indexOf(this.lookupRef.displayText) > -1;
                    })).slice(0, this.options.showItemsCount);
                    _items = items;
                    // return _items.slice(0, this.options.showItemsCount);
                }
            }
            return _items.slice(0, this.options.showItemsCount);
        })));
    }
    /**
     * @private
     * @return {?}
     */
    loadData() {
        /** @type {?} */
        const loadingRef = this.lookupRef.loadingService.show({ container: this.panelElement });
        this.getData().subscribe((/**
         * @param {?} data
         * @return {?}
         */
        (data) => {
            loadingRef.close();
            if (this.cmpRef && this.cmpRef.instance) {
                this.cmpRef.instance.loadData(data);
                if (data.length < this.options.showItemsCount) {
                    // let newHeight = data.length * 30 + (this.options.showMore ? 50: 0) + (this.options.footerHeight||0) + 5;
                    this.data = data;
                    /** @type {?} */
                    let newHeight = this.cmpRef.instance.itemsContainer.nativeElement.querySelector('ul').offsetHeight + 10;
                    if (!data || !data.length) {
                        newHeight = 55;
                    }
                    this.cmpRef.instance.itemsContainer.nativeElement.style.height = `${newHeight}px`;
                    if (this.panelElement) {
                        if (this.panelElement.style.transformOrigin.indexOf('bottom') > -1) {
                            this.panelElement.style.top = `${this.getInputSizeInfo().top - newHeight - 5}px`;
                        }
                        this.panelElement.style.height = 'auto';
                    }
                }
                else {
                    this.setPanelPosition();
                    this.cmpRef.instance.itemsContainer.nativeElement.style.height = '100%';
                    if (this.panelElement) {
                        this.render.removeStyle(this.panelElement, 'height');
                    }
                }
                if ((this.lookupRef.isTextChange || (this.lookupRef.tagInput && this.lookupRef.tagInput.value !== '') ||
                    (this.lookupRef.inputGroup && this.lookupRef.inputGroup.value !== '' && this.lookupRef.isTextChange)) && data && data.length) {
                    this.cmpRef.instance.setActiveItem(0);
                }
                this.panelElement.style.overflow = 'auto';
            }
        }));
    }
    /**
     * @param {?} $event
     * @return {?}
     */
    registerKeyboardEvent($event) {
        if (!this.lookupRef.singleSelect && this.lookupRef.viewType !== 'tag') {
            return;
        }
        /** @type {?} */
        let rows = [];
        if (this.cmpRef) {
            rows = this.cmpRef.instance.data;
        }
        if (!rows || !rows.length) {
            return;
        }
        if ($event.code === 'ArrowUp' || $event.code === 'ArrowDown') {
            $event.preventDefault();
            $event.stopPropagation();
        }
        if ($event.code === 'Backspace' && this.lookupRef.viewType === 'tag' &&
            this.lookupRef.selections && this.lookupRef.selections.length &&
            this.lookupRef.tagInput && !this.lookupRef.tagInput.value && this.lookupRef.quickSelect.enableBackspace) {
            $event.preventDefault();
            $event.stopPropagation();
            /** @type {?} */
            const newdata = this.lookupRef.selections.slice(0, this.lookupRef.selections.length - 1);
            if (!newdata || !newdata.length) {
                this.lookupRef.clearValue(true);
            }
            else {
                this.lookupRef.selectItem(newdata);
            }
            this.lookupRef.lookupSelectionSer.loadSelections(newdata);
            this.setPanelPosition();
            return;
        }
        /** @type {?} */
        const idx = this.cmpRef.instance.activeIndex;
        /** @type {?} */
        let activeIndex = idx;
        /** @type {?} */
        const setActiveItem = (/**
         * @param {?} index
         * @return {?}
         */
        (index) => {
            activeIndex = index;
            this.cmpRef.instance.setActiveItem(index);
        });
        if ($event.code === 'ArrowUp') { // up
            if (idx > -1) {
                /** @type {?} */
                let prevIdx = idx - 1;
                if (prevIdx < 0) {
                    prevIdx = rows.length - 1;
                }
                setActiveItem(prevIdx);
            }
            else {
                setActiveItem(rows.length - 1);
            }
        }
        if ($event.code === 'ArrowDown') { // down
            // down
            /** @type {?} */
            let nextIdx = idx + 1;
            if (nextIdx >= rows.length) {
                nextIdx = 0;
            }
            setActiveItem(nextIdx);
        }
        if ($event.key === 'Enter') {
            if (rows && rows.length && this.panelElement) {
                /** @type {?} */
                const data = rows[idx];
                this.selectItem(data);
            }
            else {
                this.inputRef.inputClick.emit($event);
            }
        }
    }
}
LookupQuickSelectDirective.decorators = [
    { type: Directive, args: [{ selector: '[quick-select]' },] }
];
/** @nocollapse */
LookupQuickSelectDirective.ctorParameters = () => [
    { type: Injector },
    { type: NgZone },
    { type: Renderer2 },
    { type: InputGroupComponent },
    { type: LookupGridComponent },
    { type: ComponentFactoryResolver }
];
LookupQuickSelectDirective.propDecorators = {
    options: [{ type: Input, args: ['quick-select',] }],
    registerKeyboardEvent: [{ type: HostListener, args: ['keydown', ['$event'],] }]
};
if (false) {
    /** @type {?} */
    LookupQuickSelectDirective.prototype.options;
    /**
     * @type {?}
     * @private
     */
    LookupQuickSelectDirective.prototype.panelElement;
    /**
     * @type {?}
     * @private
     */
    LookupQuickSelectDirective.prototype.cmpRef;
    /**
     * @type {?}
     * @private
     */
    LookupQuickSelectDirective.prototype.data;
    /**
     * @type {?}
     * @private
     */
    LookupQuickSelectDirective.prototype.injector;
    /**
     * @type {?}
     * @private
     */
    LookupQuickSelectDirective.prototype.ngzone;
    /**
     * @type {?}
     * @private
     */
    LookupQuickSelectDirective.prototype.render;
    /**
     * @type {?}
     * @private
     */
    LookupQuickSelectDirective.prototype.inputRef;
    /**
     * @type {?}
     * @private
     */
    LookupQuickSelectDirective.prototype.lookupRef;
    /**
     * @type {?}
     * @private
     */
    LookupQuickSelectDirective.prototype.cfr;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibG9va3VwLXF1aWNrLXNlbGVjdC5kaXJlY3RpdmUuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL3VpLWxvb2t1cC8iLCJzb3VyY2VzIjpbImxpYi9xdWljay1zZWxlY3QvbG9va3VwLXF1aWNrLXNlbGVjdC5kaXJlY3RpdmUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBaUIsd0JBQXdCLEVBQWdCLFNBQVMsRUFBYyxZQUFZLEVBQUUsUUFBUSxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQStCLFNBQVMsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUM1TCxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFDakQsT0FBTyxFQUFFLG1CQUFtQixFQUFFLE1BQU0sd0JBQXdCLENBQUM7QUFFN0QsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLEVBQUUsR0FBRyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFFM0QsT0FBTyxFQUFFLHFCQUFxQixFQUFxQixNQUFNLHVCQUF1QixDQUFDO0FBRWpGLE9BQU8sRUFBRSxtQkFBbUIsRUFBRSxNQUFNLDBCQUEwQixDQUFDO0FBQy9ELE9BQU8sRUFBRSwrQkFBK0IsRUFBRSxNQUFNLGdDQUFnQyxDQUFDO0FBR2pGLE1BQU0sT0FBTywwQkFBMEI7Ozs7Ozs7OztJQU9uQyxZQUFvQixRQUFrQixFQUFVLE1BQWMsRUFBVSxNQUFpQixFQUFVLFFBQTZCLEVBQVUsU0FBOEIsRUFDNUosR0FBNkI7UUFEckIsYUFBUSxHQUFSLFFBQVEsQ0FBVTtRQUFVLFdBQU0sR0FBTixNQUFNLENBQVE7UUFBVSxXQUFNLEdBQU4sTUFBTSxDQUFXO1FBQVUsYUFBUSxHQUFSLFFBQVEsQ0FBcUI7UUFBVSxjQUFTLEdBQVQsU0FBUyxDQUFxQjtRQUM1SixRQUFHLEdBQUgsR0FBRyxDQUEwQjtRQUhqQyxTQUFJLEdBQUcsRUFBRSxDQUFDO0lBSWxCLENBQUM7Ozs7SUFFRCxRQUFRO0lBRVIsQ0FBQzs7OztJ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bEM7U0FDSjtRQUNELElBQUksTUFBTSxDQUFDLElBQUksS0FBSyxXQUFXLEVBQUUsRUFBRSxPQUFPOzs7Z0JBQ2xDLE9BQU8sR0FBRyxHQUFHLEdBQUcsQ0FBQztZQUNyQixJQUFJLE9BQU8sSUFBSSxJQUFJLENBQUMsTUFBTSxFQUFFO2dCQUN4QixPQUFPLEdBQUcsQ0FBQyxDQUFDO2FBQ2Y7WUFFRCxhQUFhLENBQUMsT0FBTyxDQUFDLENBQUM7U0FDMUI7UUFFRCxJQUFHLE1BQU0sQ0FBQyxHQUFHLEtBQUssT0FBTyxFQUFFO1lBQ3ZCLElBQUksSUFBSSxJQUFJLElBQUksQ0FBQyxNQUFNLElBQUksSUFBSSxDQUFDLFlBQVksRUFBRTs7c0JBQ3BDLElBQUksR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDO2dCQUN0QixJQUFJLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxDQUFDO2FBQ3pCO2lCQUFNO2dCQUNILElBQUksQ0FBQyxRQUFRLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQzthQUN6QztTQUNKO0lBQ0wsQ0FBQzs7O1lBamVKLFNBQVMsU0FBQyxFQUFFLFFBQVEsRUFBRSxnQkFBZ0IsRUFBQzs7OztZQVg2RCxRQUFRO1lBQVMsTUFBTTtZQUErQixTQUFTO1lBRTNKLG1CQUFtQjtZQU1uQixtQkFBbUI7WUFSSix3QkFBd0I7OztzQkFhM0MsS0FBSyxTQUFDLGNBQWM7b0NBb1pwQixZQUFZLFNBQUMsU0FBUyxFQUFFLENBQUMsUUFBUSxDQUFDOzs7O0lBcFpuQyw2Q0FBa0Q7Ozs7O0lBQ2xELGtEQUFrQzs7Ozs7SUFDbEMsNENBQThEOzs7OztJQUU5RCwwQ0FBa0I7Ozs7O0lBRU4sOENBQTBCOzs7OztJQUFFLDRDQUFzQjs7Ozs7SUFBRSw0Q0FBeUI7Ozs7O0lBQUUsOENBQXFDOzs7OztJQUFFLCtDQUFzQzs7Ozs7SUFDcEsseUNBQXFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQWZ0ZXJWaWV3SW5pdCwgQ29tcG9uZW50RmFjdG9yeVJlc29sdmVyLCBDb21wb25lbnRSZWYsIERpcmVjdGl2ZSwgRWxlbWVudFJlZiwgSG9zdExpc3RlbmVyLCBJbmplY3RvciwgSW5wdXQsIE5nWm9uZSwgT25EZXN0cm95LCBPbkluaXQsIE9wdGlvbmFsLCBSZW5kZXJlcjIgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgcmVxQW5pbUZyYW1lIH0gZnJvbSAnQGZhcnJpcy91aS1jb21tb24nO1xyXG5pbXBvcnQgeyBJbnB1dEdyb3VwQ29tcG9uZW50IH0gZnJvbSAnQGZhcnJpcy91aS1pbnB1dC1ncm91cCc7XHJcbmltcG9ydCB7IGZyb20sIGZyb21FdmVudCwgT2JzZXJ2YWJsZSB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQgeyBkZWJvdW5jZVRpbWUsIGZpbHRlciwgbWFwIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xyXG5cclxuaW1wb3J0IHsgTG9va3VwR3JpZERpc3BsYXlUeXBlLCBRdWlja1NlbGVjdE9wdGlvbiB9IGZyb20gJy4uL2xvb2t1cC1kaXNwbGF5dHlwZSc7XHJcbmltcG9ydCB7IERpc3BsYXlJbmZvLCBMT0FEX0RBVEFfVFlQRSwgTG9va3VwR3JpZFJlc3VsdCwgUGlja2luZ1Jlc3VsdCB9IGZyb20gJy4uL2xvb2t1cC1ncmlkLW9wdGlvbnMnO1xyXG5pbXBvcnQgeyBMb29rdXBHcmlkQ29tcG9uZW50IH0gZnJvbSAnLi4vbG9va3VwLWdyaWQuY29tcG9uZW50JztcclxuaW1wb3J0IHsgTG9va3VwUXVpY2tTZWxlY3RQYW5lbENvbXBvbmVudCB9IGZyb20gJy4vcXVpY2stc2VsZWN0LXBhbmVsLmNvbXBvbmVudCc7XHJcblxyXG5ARGlyZWN0aXZlKHsgc2VsZWN0b3I6ICdbcXVpY2stc2VsZWN0XSd9KVxyXG5leHBvcnQgY2xhc3MgTG9va3VwUXVpY2tTZWxlY3REaXJlY3RpdmUgaW1wbGVtZW50cyBPbkluaXQsIEFmdGVyVmlld0luaXQsIE9uRGVzdHJveSB7XHJcbiAgICBASW5wdXQoJ3F1aWNrLXNlbGVjdCcpIG9wdGlvbnM6IFF1aWNrU2VsZWN0T3B0aW9uO1xyXG4gICAgcHJpdmF0ZSBwYW5lbEVsZW1lbnQ6IEhUTUxFbGVtZW50O1xyXG4gICAgcHJpdmF0ZSBjbXBSZWY6IENvbXBvbmVudFJlZjxMb29rdXBRdWlja1NlbGVjdFBhbmVsQ29tcG9uZW50PjtcclxuXHJcbiAgICBwcml2YXRlIGRhdGEgPSBbXTtcclxuXHJcbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIGluamVjdG9yOiBJbmplY3RvciwgcHJpdmF0ZSBuZ3pvbmU6IE5nWm9uZSwgcHJpdmF0ZSByZW5kZXI6IFJlbmRlcmVyMiwgcHJpdmF0ZSBpbnB1dFJlZjogSW5wdXRHcm91cENvbXBvbmVudCwgcHJpdmF0ZSBsb29rdXBSZWY6IExvb2t1cEdyaWRDb21wb25lbnQsXHJcbiAgICAgICAgcHJpdmF0ZSBjZnI6IENvbXBvbmVudEZhY3RvcnlSZXNvbHZlcikge1xyXG4gICAgfVxyXG5cclxuICAgIG5nT25Jbml0KCk6IHZvaWQge1xyXG4gICAgICAgIFxyXG4gICAgfVxyXG5cclxuICAgIG5nQWZ0ZXJWaWV3SW5pdCgpOiB2b2lkIHtcclxuICAgICAgICBpZiAodGhpcy5vcHRpb25zICYmIHRoaXMub3B0aW9ucy5lbmFibGUpIHtcclxuICAgICAgICAgICAgdGhpcy5pbnB1dFJlZi5pbnB1dENsaWNrLnN1YnNjcmliZSgoZTogTW91c2VFdmVudCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcclxuICAgICAgICAgICAgICAgIGlmICghdGhpcy5wYW5lbEVsZW1lbnQpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyDmiafooYzluK7liqnliY1cclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmxvb2t1cFJlZi5kaWN0UGlja2luZyh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGluc3RhbmNlOiB0aGlzLFxyXG4gICAgICAgICAgICAgICAgICAgIH0pLnN1YnNjcmliZSgocHI6IFBpY2tpbmdSZXN1bHQpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMubG9va3VwUmVmLmRpc3BsYXlUeXBlID09PSBMb29rdXBHcmlkRGlzcGxheVR5cGUuVHJlZUxpc3QgfHwgKCF0aGlzLmxvb2t1cFJlZi5zaW5nbGVTZWxlY3QgJiYgdGhpcy5sb29rdXBSZWYudmlld1R5cGUgPT09ICd0ZXh0JykpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB7IHNob3csIGN1c3RvbURhdGEsIG1lc3NhZ2UgfSA9IHRoaXMubG9va3VwUmVmLmRpYWxvZ01nci5jaGVja0RpY3RQaWNraW5nUmVzdWx0KHByKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sb29rdXBSZWYuY3VzdG9tRGF0YSA9IGN1c3RvbURhdGE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzaG93KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNyZWF0ZURhdGFQYW5lbCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxvb2t1cFJlZi5ub3RpZnlTZXJ2aWNlLndhcm5pbmcobWVzc2FnZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuaW5wdXRSZWYudmFsdWVDaGFuZ2UucGlwZShcclxuICAgICAgICAgICAgICAgIGRlYm91bmNlVGltZSgyMDApXHJcbiAgICAgICAgICAgICkuc3Vic2NyaWJlKCh2YWw6IHN0cmluZykgPT4ge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5sb29rdXBSZWYuZGljdFBpY2tpbmcoe2luc3RhbmNlOiB0aGlzfSkuc3Vic2NyaWJlKChwcjogUGlja2luZ1Jlc3VsdCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmxvb2t1cFJlZi5kaXNwbGF5VHlwZSA9PT0gTG9va3VwR3JpZERpc3BsYXlUeXBlLlRyZWVMaXN0IHx8ICghdGhpcy5sb29rdXBSZWYuc2luZ2xlU2VsZWN0ICYmIHRoaXMubG9va3VwUmVmLnZpZXdUeXBlID09PSAndGV4dCcpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgeyBzaG93LCBjdXN0b21EYXRhLCBtZXNzYWdlIH0gPSB0aGlzLmxvb2t1cFJlZi5kaWFsb2dNZ3IuY2hlY2tEaWN0UGlja2luZ1Jlc3VsdChwcik7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5sb29rdXBSZWYuY3VzdG9tRGF0YSA9IGN1c3RvbURhdGE7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLnBhbmVsRWxlbWVudCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNyZWF0ZURhdGFQYW5lbCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucGFuZWxFbGVtZW50LnN0eWxlLm92ZXJmbG93ID0gJ2hpZGRlbic7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0UGFuZWxQb3NpdGlvbihmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubG9hZERhdGEoKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuaW5wdXRSZWYua2V5ZG93bkhhbmRsZS5waXBlKFxyXG4gICAgICAgICAgICAgICAgZmlsdGVyKChldmVudDogS2V5Ym9hcmRFdmVudCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBldmVudC5rZXkgPT09ICdFc2NhcGUnIHx8IGV2ZW50LmtleSA9PT0gJ1RhYicgfHwgIGV2ZW50LmtleSA9PT0gJ0YyJztcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICkuc3Vic2NyaWJlKChlKSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmhpZGUoZSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBuZ09uRGVzdHJveSgpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLmxvb2t1cFJlZi5vdmVyTGF5U2VydmljZS5kZXN0b3J5KHRoaXMubG9va3VwUmVmLmVsLm5hdGl2ZUVsZW1lbnQpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgcmVtb3ZlUGFuZWxFbGVtZW50KCkge1xyXG4gICAgICAgIGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQodGhpcy5wYW5lbEVsZW1lbnQpO1xyXG4gICAgICAgIHRoaXMucGFuZWxFbGVtZW50ID0gbnVsbDtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGNsZWFyU2VhcmNoVmFsdWUoKSB7XHJcbiAgICAgICAgdGhpcy5sb29rdXBSZWYuX3NlYXJjaFN0YXRlID0geyBcclxuICAgICAgICAgICAgZmllbGQ6ICcqJywgLy9cIipcIixcclxuICAgICAgICAgICAgdmFsdWU6ICcnXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGhpZGUoZT86IGFueSwgaXNNb3JlQ2xpY2sgPSBmYWxzZSkge1xyXG4gICAgICAgIHJlcUFuaW1GcmFtZSgoKSA9PiB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLnBhbmVsRWxlbWVudCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKGUgJiYgKCBlLnR5cGUgPT09ICdtb3VzZXdoZWVsJyB8fCBlLnR5cGUgPT09ICd3aGVlbCcpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW1vdmVQYW5lbEVsZW1lbnQoKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wYW5lbEVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSgnZi1hcmVhLXNob3cnKTtcclxuICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW1vdmVQYW5lbEVsZW1lbnQoKTtcclxuICAgICAgICAgICAgICAgICAgICB9LDEyMCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLmxvb2t1cFJlZikge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIC8vIHRmcyA1NzkwNTZcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmxvb2t1cFJlZi5vdmVyTGF5U2VydmljZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMubG9va3VwUmVmLm92ZXJMYXlTZXJ2aWNlLmRlc3RvcnkodGhpcy5sb29rdXBSZWYuZWwubmF0aXZlRWxlbWVudCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKGlzTW9yZUNsaWNrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOyAgICAgICBcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5sb29rdXBSZWYudGFnSW5wdXQpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyB0aGlzLmxvb2t1cFJlZi50YWdJbnB1dC52YWx1ZSA9ICcnO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaW5wdXRSZWYudmFsdWUgPSAnJztcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmNsZWFyU2VhcmNoVmFsdWUoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoZSAmJiAoZS5rZXkgPT09ICdGMicgfHwgdGhpcy5sb29rdXBSZWYuZWwubmF0aXZlRWxlbWVudC5jb250YWlucyhlLnRhcmdldCkpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuZGF0YSAmJiB0aGlzLmRhdGEubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNsZWFyU2VhcmNoVmFsdWUoKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLmxvb2t1cFJlZi5ub3NlYXJjaCAmJiB0aGlzLmxvb2t1cFJlZi5kaXNwbGF5VGV4dCAhPT0gdGhpcy5sb29rdXBSZWYub3JpZ2luYWxUZXh0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5sb29rdXBSZWYub25DaGFuZ2VzKHRoaXMubG9va3VwUmVmLm9yaWdpbmFsVGV4dClcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgc2V0UGFuZWxQb3NpdGlvbih1cGRhdGVUb3BQb3NpdGlvbiA9IHRydWUpIHtcclxuICAgICAgICBpZiAodGhpcy5wYW5lbEVsZW1lbnQpIHtcclxuICAgICAgICAgICAgY29uc3QgeyB3aWR0aCwgbGVmdCwgdG9wLCBoZWlnaHQgfSA9IHRoaXMuZ2V0UGFuZWxTaXplKCk7XHJcbiAgICAgICAgICAgIHRoaXMucGFuZWxFbGVtZW50LnN0eWxlLndpZHRoID0gYCR7d2lkdGh9cHhgO1xyXG4gICAgICAgICAgICB0aGlzLnBhbmVsRWxlbWVudC5zdHlsZS5tYXhIZWlnaHQgPSBgJHtoZWlnaHR9cHhgO1xyXG4gICAgICAgICAgICBpZiAodXBkYXRlVG9wUG9zaXRpb24pIHtcclxuICAgICAgICAgICAgICAgIHRoaXMucGFuZWxFbGVtZW50LnN0eWxlLnRvcCA9IGAke3RvcH1weGA7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5wYW5lbEVsZW1lbnQuc3R5bGUubGVmdCA9IGAke2xlZnR9cHhgO1xyXG4gICAgICAgICAgICB0aGlzLnBhbmVsRWxlbWVudC5zdHlsZS56SW5kZXggPSAnMTAwMDEnO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGNyZWF0ZURhdGFQYW5lbCgpIHtcclxuICAgICAgICBcclxuICAgICAgICBpZiAodGhpcy5sb29rdXBSZWYuY2hhbmdlRGV0ZWN0b3JbJ2Rlc3Ryb3llZCddKSB7XHJcbiAgICAgICAgICAgIHRoaXMucGFuZWxFbGVtZW50ICYmIHRoaXMucmVtb3ZlUGFuZWxFbGVtZW50KCk7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMucGFuZWxFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgICAgICAgdGhpcy5wYW5lbEVsZW1lbnQuY2xhc3NMaXN0LmFkZCgnb3ZlcmxheS1wYW5lJywgJ2YtbG9va3VwX3F1aWNrLXBhbmVsJywgJ2YtYXJlYS1oaWRlJyk7XHJcblxyXG4gICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQodGhpcy5wYW5lbEVsZW1lbnQpO1xyXG4gICAgICAgIHRoaXMuc2V0UGFuZWxQb3NpdGlvbigpO1xyXG5cclxuICAgICAgICB0aGlzLnBhbmVsRWxlbWVudC5zdHlsZS5vdmVyZmxvdyA9ICdoaWRkZW4nO1xyXG4gICAgICAgIC8vIHRoaXMucGFuZWxFbGVtZW50LnN0eWxlLmhlaWdodCA9ICdhdXRvJztcclxuICAgICAgICBcclxuICAgICAgICAvLyDliJvlu7rmlbDmja7lsZXnpLrnu4Tku7ZcclxuICAgICAgICBjb25zdCBjbXBGYWN0ID0gdGhpcy5jZnIucmVzb2x2ZUNvbXBvbmVudEZhY3RvcnkoTG9va3VwUXVpY2tTZWxlY3RQYW5lbENvbXBvbmVudCk7XHJcbiAgICAgICAgdGhpcy5jbXBSZWYgPSBjbXBGYWN0LmNyZWF0ZSh0aGlzLmluamVjdG9yKTtcclxuICAgICAgICBcclxuICAgICAgICB0aGlzLmNtcFJlZi5pbnN0YW5jZS5zaG93TW9yZSA9IHRoaXMub3B0aW9ucy5zaG93TW9yZTtcclxuICAgICAgICB0aGlzLmNtcFJlZi5pbnN0YW5jZS50ZXh0RmllbGQgPSB0aGlzLmxvb2t1cFJlZi50ZXh0RmllbGQ7XHJcbiAgICAgICAgdGhpcy5jbXBSZWYuaW5zdGFuY2UuZm9ybWF0dGVyID0gdGhpcy5vcHRpb25zLmZvcm1hdHRlcjtcclxuICAgICAgICB0aGlzLmNtcFJlZi5pbnN0YW5jZS5tYXhJdGVtcyA9IHRoaXMub3B0aW9ucy5zaG93SXRlbXNDb3VudDtcclxuXHJcbiAgICAgICAgLy8gY21wUmVmLmxvY2F0aW9uLm5hdGl2ZUVsZW1lbnQuY2xhc3NMaXN0LmFkZCgnZmFycmlzLW1haW4tYXJlYScpO1xyXG4gICAgICAgIHRoaXMucGFuZWxFbGVtZW50LmFwcGVuZENoaWxkKHRoaXMuY21wUmVmLmxvY2F0aW9uLm5hdGl2ZUVsZW1lbnQpO1xyXG5cclxuICAgICAgICB0aGlzLmxvb2t1cFJlZi5zZWxlY3Rpb25NZ3IuaW5pdERpc3BsYXlWYWx1ZSgpO1xyXG4gICAgICAgIFxyXG4gICAgICAgIHRoaXMuY21wUmVmLmNoYW5nZURldGVjdG9yUmVmLmRldGVjdENoYW5nZXMoKTtcclxuXHJcbiAgICAgICAgLy8gbW9yZSBjbGlja2VkIOaJk+W8gOW4ruWKqeeql+WPo1xyXG4gICAgICAgIHRoaXMuY21wUmVmLmluc3RhbmNlLm1vcmVDbGNpay5zdWJzY3JpYmUoKGUpID0+IHtcclxuICAgICAgICAgICAgdGhpcy5oaWRlKGUsIHRydWUpO1xyXG4gICAgICAgICAgICB0aGlzLmxvb2t1cFJlZi5zaG93RGlhbG9nKCk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHRoaXMuY21wUmVmLmluc3RhbmNlLml0ZW1DbGljay5zdWJzY3JpYmUoKGU6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCB7IGRhdGEgfSA9IGU7XHJcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0SXRlbShkYXRhKTtcclxuICAgICAgICB9KTtcclxuXHJcblxyXG4gICAgICAgIC8vIOazqOWGjOm8oOagh+a7mui9ru+8jOeCueWHu+S6i+S7tu+8jOeUqOS6jumakOiXj1BhbmVsXHJcbiAgICAgICAgdGhpcy5sb29rdXBSZWYub3ZlckxheVNlcnZpY2UucmVnaXN0ZXJNb3VzZUV2ZW50KHRoaXMubG9va3VwUmVmLmVsLm5hdGl2ZUVsZW1lbnQsIChlOiBNb3VzZUV2ZW50KSA9PiB7XHJcbiAgICAgICAgICAgIGlmICghdGhpcy5wYW5lbEVsZW1lbnQgfHwgZS50YXJnZXRbJ2Nsb3Nlc3QnXSgnLmYtbG9va3VwX3F1aWNrLXBhbmVsJykpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgaWYodGhpcy5sb29rdXBSZWYuaW5wdXRHcm91cCAmJiB0aGlzLmxvb2t1cFJlZi5pbnB1dEdyb3VwLnRleHRib3gubmF0aXZlRWxlbWVudCA9PT0gZS50YXJnZXQpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYodGhpcy5sb29rdXBSZWYudGFnSW5wdXQgJiYgdGhpcy5sb29rdXBSZWYudGFnSW5wdXQudGV4dGJveC5uYXRpdmVFbGVtZW50ID09PSBlLnRhcmdldCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAodGhpcy5jbXBSZWYpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuY21wUmVmLmRlc3Ryb3koKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuY21wUmVmID0gbnVsbDtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdGhpcy5jbGVhclNlYXJjaFZhbHVlKCk7XHJcblxyXG4gICAgICAgICAgICB0aGlzLmhpZGUoZSk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHRoaXMucGFuZWxFbGVtZW50LmNsYXNzTGlzdC5hZGQoJ2YtYXJlYS1zaG93Jyk7XHJcblxyXG4gICAgICAgIHRoaXMubG9hZERhdGEoKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHNlbGVjdEl0ZW0oZGF0YTogYW55KSB7XHJcbiAgICAgICAgaWYgKCFkYXRhKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh0aGlzLmxvb2t1cFJlZi52aWV3VHlwZSA9PT0gJ3RhZycpIHtcclxuICAgICAgICAgICAgY29uc3QgaXNTZWxlY3QgPSB0aGlzLmxvb2t1cFJlZi5zZWxlY3Rpb25zLmZpbmQobiA9PiBuW3RoaXMubG9va3VwUmVmLmlkRmllbGRdID09PSBkYXRhW3RoaXMubG9va3VwUmVmLmlkRmllbGRdKTtcclxuICAgICAgICAgICAgaWYgKCFpc1NlbGVjdCkge1xyXG4gICAgICAgICAgICAgICAgY29uc3Qgc2VsZWN0SXRlbXM6IGFueSA9IFsuLi50aGlzLmxvb2t1cFJlZi5zZWxlY3Rpb25zLCBkYXRhXTtcclxuICAgICAgICAgICAgICAgIHRoaXMubG9va3VwUmVmLnNlbGVjdEl0ZW0oc2VsZWN0SXRlbXMpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5sb29rdXBSZWYubG9va3VwU2VsZWN0aW9uU2VyLmxvYWRTZWxlY3Rpb25zKHNlbGVjdEl0ZW1zKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMubG9va3VwUmVmLnNlbGVjdEl0ZW0oZGF0YSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuaGlkZSgpO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICBwcml2YXRlIGNhbGN1bGF0aW9uUGFuZWxIZWlnaHQoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMub3B0aW9ucy5zaG93SXRlbXNDb3VudCAqIDMwICsgKHRoaXMub3B0aW9ucy5zaG93TW9yZSA/IDUwOiAwKSArICh0aGlzLm9wdGlvbnMuZm9vdGVySGVpZ2h0fHwwKSArIDU7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBnZXRJbnB1dFNpemVJbmZvKCkge1xyXG4gICAgICAgIGNvbnN0IGVsOiBhbnkgPSB0aGlzLmxvb2t1cFJlZi52aWV3VHlwZSA9PT0gJ3RleHQnID8gdGhpcy5pbnB1dFJlZi5pbnB1dEdyb3VwIDogdGhpcy5sb29rdXBSZWYudGFnYm94O1xyXG4gICAgICAgIHJldHVybiBlbC5uYXRpdmVFbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZ2V0UGFuZWxTaXplKCkge1xyXG4gICAgICAgIGxldCB7IHdpZHRoLCBoZWlnaHQsIHRvcCwgbGVmdCB9ID0gdGhpcy5nZXRJbnB1dFNpemVJbmZvKCk7XHJcbiAgICAgICAgY29uc3QgYm90dG9tID0gd2luZG93LmlubmVySGVpZ2h0IC0gaGVpZ2h0IC0gdG9wO1xyXG4gICAgICAgIGxldCBwYW5lbEhlaWdodCA9IHRoaXMuY2FsY3VsYXRpb25QYW5lbEhlaWdodCgpO1xyXG5cclxuICAgICAgICBjb25zdCBoID0gdG9wID4gYm90dG9tID8gdG9wIDogYm90dG9tO1xyXG4gICAgICAgIGlmIChib3R0b20gPiBwYW5lbEhlaWdodCkge1xyXG4gICAgICAgICAgICB0b3AgPSB0b3AgKyBoZWlnaHQ7XHJcbiAgICAgICAgICAgIC8vIOmdouadv+eUseS4iuWQkeS4i+WxleW8gFxyXG4gICAgICAgICAgICB0aGlzLnBhbmVsRWxlbWVudC5zdHlsZS50cmFuc2Zvcm1PcmlnaW4gPSAnMTAwJSB0b3AnO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGlmICh0b3AgPiBib3R0b20pIHtcclxuICAgICAgICAgICAgICAgIGlmIChoIDwgcGFuZWxIZWlnaHQpIHtcclxuICAgICAgICAgICAgICAgICAgICBwYW5lbEhlaWdodCA9IGggLSAxMDtcclxuICAgICAgICAgICAgICAgICAgICB0b3AgPSAxMDtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdG9wID0gdG9wIC0gcGFyc2VJbnQoJycgKyBwYW5lbEhlaWdodCwgMTApIC0gNTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAvLyDpnaLmnb/nlLHkuIvlkJHkuIrlsZXlvIBcclxuICAgICAgICAgICAgICAgIHRoaXMucGFuZWxFbGVtZW50LnN0eWxlLnRyYW5zZm9ybU9yaWdpbiA9ICcxMDAlIGJvdHRvbSc7XHJcblxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgaWYgKGggPCBwYW5lbEhlaWdodCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHBhbmVsSGVpZ2h0ID0gaCAtIDEwO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgdG9wID0gdG9wICsgaGVpZ2h0O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCBtaW5XaWR0aCA9IHRoaXMub3B0aW9ucy5taW5XaWR0aCB8fCAyMDA7XHJcbiAgICAgICAgbGV0IF93aWR0aCA9ICB3aWR0aCA8IG1pbldpZHRoPyBtaW5XaWR0aDogd2lkdGg7XHJcbiAgICAgICAgaWYgKHdpbmRvdy5pbm5lcldpZHRoIC0gbGVmdCA8IF93aWR0aCkge1xyXG4gICAgICAgICAgICBsZWZ0ID0gbGVmdCArIHdpZHRoIC0gX3dpZHRoO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHsgd2lkdGg6IF93aWR0aCwgdG9wLCBoZWlnaHQ6IHBhbmVsSGVpZ2h0LCBsZWZ0IH07XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBnZXREYXRhKCk6IE9ic2VydmFibGU8QXJyYXk8YW55Pj4ge1xyXG4gICAgICAgIGxldCBwOiBhbnkgPSB7XHJcbiAgICAgICAgICAgIHBhZ2VJbmZvOiB7XHJcbiAgICAgICAgICAgICAgICBwYWdlU2l6ZTogdGhpcy5vcHRpb25zLnNob3dJdGVtc0NvdW50LFxyXG4gICAgICAgICAgICAgICAgcGFnZUluZGV4OiAxLFxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgIH07XHJcbiAgICAgICAgbGV0IHQ6IExPQURfREFUQV9UWVBFID0gXCJhbGxcIjtcclxuICAgICAgICBpZiAodGhpcy5sb29rdXBSZWYuaXNUZXh0Q2hhbmdlKSB7XHJcbiAgICAgICAgICAgIHRoaXMubG9va3VwUmVmLl9zZWFyY2hTdGF0ZSA9IHsgXHJcbiAgICAgICAgICAgICAgICBmaWVsZDogdGhpcy5sb29rdXBSZWYudGV4dEZpZWxkLCAvL1wiKlwiLFxyXG4gICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMubG9va3VwUmVmLmRpc3BsYXlUZXh0XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcFsnc2VhcmNoJ10gPSB0aGlzLmxvb2t1cFJlZi5fc2VhcmNoU3RhdGU7XHJcbiAgICAgICAgICAgIHQgPSAnc2VhcmNoJztcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLmxvb2t1cFJlZi5fc2VhcmNoU3RhdGUgPSBudWxsO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHRoaXMubG9va3VwUmVmLnZpZXdUeXBlID09PSAndGFnJykge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5sb29rdXBSZWYudGFnSW5wdXQudmFsdWUgIT09ICcnKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmxvb2t1cFJlZi5fc2VhcmNoU3RhdGUgPSB7IFxyXG4gICAgICAgICAgICAgICAgICAgIGZpZWxkOiB0aGlzLmxvb2t1cFJlZi50ZXh0RmllbGQsIC8vXCIqXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMubG9va3VwUmVmLnRhZ0lucHV0LnZhbHVlXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBwWydzZWFyY2gnXSA9IHRoaXMubG9va3VwUmVmLl9zZWFyY2hTdGF0ZTtcclxuICAgICAgICAgICAgICAgIHQgPSAnc2VhcmNoJztcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRoaXMubG9va3VwUmVmLl9zZWFyY2hTdGF0ZSA9IG51bGw7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGNvbnN0IHZhbHMgPSB0aGlzLmxvb2t1cFJlZi5zZWxlY3Rpb25NZ3IuZ2V0U2VsZWN0ZWRJZHMoKTtcclxuICAgICAgICAgICAgaWYgKHZhbHMgJiYgdmFscy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgIHBbXCJzZWxlY3RlZEluZm9cIl0gPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2VsZWN0ZWQ6IHRydWUsXHJcbiAgICAgICAgICAgICAgICAgICAgc2VsZWN0ZWRJZHM6IHZhbHMsXHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgcmV0dXJuIHRoaXMubG9va3VwUmVmLmh0dHBNZ3IubG9va3VwUmVxdWVzdChwLCB0LCB0cnVlKS5waXBlKFxyXG4gICAgICAgICAgICBtYXAoKHJlc3REYXRhOiBMb29rdXBHcmlkUmVzdWx0KSA9PiB7XHJcbiAgICAgICAgICAgICAgICBsZXQgX2l0ZW1zID0gdGhpcy5sb29rdXBSZWYuaXRlbXMgfHwgW107XHJcbiAgICAgICAgICAgICAgICBpZiAocmVzdERhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5sb29rdXBSZWYudmlld1R5cGUgPT09ICd0YWcnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubG9va3VwUmVmLmxvb2t1cFNlbGVjdGlvblNlci5sb2FkU2VsZWN0aW9ucyhcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3REYXRhW1wic2VsZWN0ZWREYXRhXCJdIHx8IFtdXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIF9pdGVtcyA9IHJlc3REYXRhLml0ZW1zIHx8IFtdO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAocmVzdERhdGEuZGlzcGxheVR5cGUudG9Mb3dlckNhc2UoKS5pbmRleE9mKCd0cmVlbGlzdCcpID4gLTEgJiYgX2l0ZW1zLmxlbmd0aCAmJiBfaXRlbXNbMF0uZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBfaXRlbXMgPSBfaXRlbXMubWFwKG4gPT4gbi5kYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICBcclxuICAgICAgICAgICAgICAgICAgICAvLyByZXR1cm4gX2l0ZW1zLnNsaWNlKDAsIHRoaXMub3B0aW9ucy5zaG93SXRlbXNDb3VudCk7XHJcblxyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5sb29rdXBSZWYuZGlzcGxheVRleHQgJiYgdGhpcy5sb29rdXBSZWYuaXNUZXh0Q2hhbmdlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXN0RGF0YS5kaXNwbGF5VHlwZS50b0xvd2VyQ2FzZSgpLmluZGV4T2YoJ3RyZWVsaXN0JykgPiAtMSAmJiBfaXRlbXMubGVuZ3RoICYmIF9pdGVtc1swXS5kYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfaXRlbXMgPSBfaXRlbXMubWFwKG4gPT4gbi5kYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgaXRlbXMgPSBfaXRlbXMuZmlsdGVyKG4gPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5bdGhpcy5sb29rdXBSZWYudGV4dEZpZWxkXS5pbmRleE9mKHRoaXMubG9va3VwUmVmLmRpc3BsYXlUZXh0KSA+IC0xO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KS5zbGljZSgwLCB0aGlzLm9wdGlvbnMuc2hvd0l0ZW1zQ291bnQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBfaXRlbXMgPSBpdGVtcztcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHJldHVybiBfaXRlbXMuc2xpY2UoMCwgdGhpcy5vcHRpb25zLnNob3dJdGVtc0NvdW50KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIF9pdGVtcy5zbGljZSgwLCB0aGlzLm9wdGlvbnMuc2hvd0l0ZW1zQ291bnQpO1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBsb2FkRGF0YSgpIHtcclxuICAgICAgICBjb25zdCBsb2FkaW5nUmVmID0gdGhpcy5sb29rdXBSZWYubG9hZGluZ1NlcnZpY2Uuc2hvdyh7Y29udGFpbmVyOiB0aGlzLnBhbmVsRWxlbWVudH0pO1xyXG4gICAgICAgIHRoaXMuZ2V0RGF0YSgpLnN1YnNjcmliZSgoZGF0YTogYW55KSA9PiB7XHJcbiAgICAgICAgICAgIGxvYWRpbmdSZWYuY2xvc2UoKTtcclxuICAgICAgICAgICAgaWYgKHRoaXMuY21wUmVmICYmIHRoaXMuY21wUmVmLmluc3RhbmNlKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNtcFJlZi5pbnN0YW5jZS5sb2FkRGF0YShkYXRhKTtcclxuICAgICAgICAgICAgICAgIGlmIChkYXRhLmxlbmd0aCA8IHRoaXMub3B0aW9ucy5zaG93SXRlbXNDb3VudCkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIGxldCBuZXdIZWlnaHQgPSBkYXRhLmxlbmd0aCAqIDMwICsgKHRoaXMub3B0aW9ucy5zaG93TW9yZSA/IDUwOiAwKSArICh0aGlzLm9wdGlvbnMuZm9vdGVySGVpZ2h0fHwwKSArIDU7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kYXRhID0gZGF0YTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IG5ld0hlaWdodCA9IHRoaXMuY21wUmVmLmluc3RhbmNlLml0ZW1zQ29udGFpbmVyLm5hdGl2ZUVsZW1lbnQucXVlcnlTZWxlY3RvcigndWwnKS5vZmZzZXRIZWlnaHQgKyAxMDtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFkYXRhIHx8ICFkYXRhLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBuZXdIZWlnaHQgPSA1NTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY21wUmVmLmluc3RhbmNlLml0ZW1zQ29udGFpbmVyLm5hdGl2ZUVsZW1lbnQuc3R5bGUuaGVpZ2h0ID0gYCR7bmV3SGVpZ2h0fXB4YDtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5wYW5lbEVsZW1lbnQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMucGFuZWxFbGVtZW50LnN0eWxlLnRyYW5zZm9ybU9yaWdpbi5pbmRleE9mKCdib3R0b20nKSA+IC0xKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBhbmVsRWxlbWVudC5zdHlsZS50b3AgPSBgJHt0aGlzLmdldElucHV0U2l6ZUluZm8oKS50b3AgLSBuZXdIZWlnaHQgLSA1fXB4YCA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wYW5lbEVsZW1lbnQuc3R5bGUuaGVpZ2h0ID0gJ2F1dG8nO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRQYW5lbFBvc2l0aW9uKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jbXBSZWYuaW5zdGFuY2UuaXRlbXNDb250YWluZXIubmF0aXZlRWxlbWVudC5zdHlsZS5oZWlnaHQgPSAnMTAwJSc7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMucGFuZWxFbGVtZW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyLnJlbW92ZVN0eWxlKHRoaXMucGFuZWxFbGVtZW50LCAnaGVpZ2h0Jyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGlmICgodGhpcy5sb29rdXBSZWYuaXNUZXh0Q2hhbmdlIHx8ICh0aGlzLmxvb2t1cFJlZi50YWdJbnB1dCAmJiB0aGlzLmxvb2t1cFJlZi50YWdJbnB1dC52YWx1ZSAhPT0gJycpIHx8ICBcclxuICAgICAgICAgICAgICAgICAgICAodGhpcy5sb29rdXBSZWYuaW5wdXRHcm91cCAmJiB0aGlzLmxvb2t1cFJlZi5pbnB1dEdyb3VwLnZhbHVlICE9PSAnJyAmJiB0aGlzLmxvb2t1cFJlZi5pc1RleHRDaGFuZ2UpKSAmJiBkYXRhICYmIGRhdGEubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jbXBSZWYuaW5zdGFuY2Uuc2V0QWN0aXZlSXRlbSgwKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICB0aGlzLnBhbmVsRWxlbWVudC5zdHlsZS5vdmVyZmxvdyA9ICdhdXRvJztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICBASG9zdExpc3RlbmVyKCdrZXlkb3duJywgWyckZXZlbnQnXSlcclxuICAgIHJlZ2lzdGVyS2V5Ym9hcmRFdmVudCgkZXZlbnQ6IEtleWJvYXJkRXZlbnQpIHtcclxuXHJcbiAgICAgICAgaWYgKCF0aGlzLmxvb2t1cFJlZi5zaW5nbGVTZWxlY3QgJiYgdGhpcy5sb29rdXBSZWYudmlld1R5cGUgIT09ICd0YWcnKSAge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBsZXQgcm93cz0gW107XHJcbiAgICAgICAgaWYgKHRoaXMuY21wUmVmKSB7XHJcbiAgICAgICAgICAgIHJvd3MgPSB0aGlzLmNtcFJlZi5pbnN0YW5jZS5kYXRhO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKCFyb3dzIHx8ICFyb3dzLmxlbmd0aCkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoJGV2ZW50LmNvZGUgPT09ICdBcnJvd1VwJyB8fCAkZXZlbnQuY29kZSA9PT0gJ0Fycm93RG93bicpIHtcclxuICAgICAgICAgICAgJGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgICAgICRldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICBpZiAoJGV2ZW50LmNvZGUgPT09ICdCYWNrc3BhY2UnICYmIHRoaXMubG9va3VwUmVmLnZpZXdUeXBlID09PSAndGFnJyAmJlxyXG4gICAgICAgICAgICB0aGlzLmxvb2t1cFJlZi5zZWxlY3Rpb25zICYmIHRoaXMubG9va3VwUmVmLnNlbGVjdGlvbnMubGVuZ3RoICYmXHJcbiAgICAgICAgICAgIHRoaXMubG9va3VwUmVmLnRhZ0lucHV0ICYmICF0aGlzLmxvb2t1cFJlZi50YWdJbnB1dC52YWx1ZSAmJiB0aGlzLmxvb2t1cFJlZi5xdWlja1NlbGVjdC5lbmFibGVCYWNrc3BhY2UpIHtcclxuICAgICAgICAgICAgJGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgICAgICRldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcclxuICAgICAgICAgICAgY29uc3QgbmV3ZGF0YSA9IHRoaXMubG9va3VwUmVmLnNlbGVjdGlvbnMuc2xpY2UoMCwgdGhpcy5sb29rdXBSZWYuc2VsZWN0aW9ucy5sZW5ndGggLSAxKTtcclxuICAgICAgICAgICAgaWYgKCFuZXdkYXRhIHx8ICFuZXdkYXRhLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5sb29rdXBSZWYuY2xlYXJWYWx1ZSh0cnVlKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRoaXMubG9va3VwUmVmLnNlbGVjdEl0ZW0obmV3ZGF0YSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5sb29rdXBSZWYubG9va3VwU2VsZWN0aW9uU2VyLmxvYWRTZWxlY3Rpb25zKG5ld2RhdGEpO1xyXG4gICAgICAgICAgICB0aGlzLnNldFBhbmVsUG9zaXRpb24oKTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIGNvbnN0IGlkeCA9IHRoaXMuY21wUmVmLmluc3RhbmNlLmFjdGl2ZUluZGV4O1xyXG4gICAgICAgIGxldCBhY3RpdmVJbmRleCA9IGlkeDtcclxuXHJcbiAgICAgICAgY29uc3Qgc2V0QWN0aXZlSXRlbSA9IChpbmRleCkgPT4ge1xyXG4gICAgICAgICAgICBhY3RpdmVJbmRleCA9IGluZGV4O1xyXG4gICAgICAgICAgICB0aGlzLmNtcFJlZi5pbnN0YW5jZS5zZXRBY3RpdmVJdGVtKGluZGV4KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBpZiAoJGV2ZW50LmNvZGUgPT09ICdBcnJvd1VwJykgeyAgLy8gdXBcclxuICAgICAgICAgICAgaWYgKGlkeCA+IC0xKSB7XHJcbiAgICAgICAgICAgICAgICBsZXQgcHJldklkeCA9IGlkeCAtIDE7XHJcbiAgICAgICAgICAgICAgICBpZiAocHJldklkeCA8IDApIHtcclxuICAgICAgICAgICAgICAgICAgICBwcmV2SWR4ID0gcm93cy5sZW5ndGggLSAxO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgc2V0QWN0aXZlSXRlbShwcmV2SWR4KTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHNldEFjdGl2ZUl0ZW0ocm93cy5sZW5ndGggLSAxKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoJGV2ZW50LmNvZGUgPT09ICdBcnJvd0Rvd24nKSB7IC8vIGRvd25cclxuICAgICAgICAgICAgbGV0IG5leHRJZHggPSBpZHggKyAxO1xyXG4gICAgICAgICAgICBpZiAobmV4dElkeCA+PSByb3dzLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgbmV4dElkeCA9IDA7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHNldEFjdGl2ZUl0ZW0obmV4dElkeCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZigkZXZlbnQua2V5ID09PSAnRW50ZXInKSB7XHJcbiAgICAgICAgICAgIGlmIChyb3dzICYmIHJvd3MubGVuZ3RoICYmIHRoaXMucGFuZWxFbGVtZW50KSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBkYXRhID0gcm93c1tpZHhdO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RJdGVtKGRhdGEpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5pbnB1dFJlZi5pbnB1dENsaWNrLmVtaXQoJGV2ZW50KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxufSJdfQ==
/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Directive, ElementRef, Injector, Input, NgZone, Renderer2 } from '@angular/core';
import { CommonUtils, OverLayHiddenService } from '@farris/ui-common';
import { DataTableComponent } from '@farris/ui-datatable';
import { NotifyService } from '@farris/ui-notify';
export class LookupSelectedDirective {
    /**
     * @param {?} injector
     * @param {?} elRef
     * @param {?} render
     * @param {?} ngZone
     */
    constructor(injector, elRef, render, ngZone) {
        this.injector = injector;
        this.elRef = elRef;
        this.render = render;
        this.ngZone = ngZone;
        this.count = 0;
        this.panelMouseEvent = null;
        this.notifySer = null;
        this.commonUtils = null;
        this.panelEscHandler = null;
        this.overlaySer = new OverLayHiddenService();
        this.notifySer = this.injector.get(NotifyService, null);
        this.commonUtils = this.injector.get(CommonUtils, new CommonUtils());
    }
    /**
     * @return {?}
     */
    ngOnInit() {
    }
    /**
     * @return {?}
     */
    ngAfterViewInit() {
        setTimeout((/**
         * @return {?}
         */
        () => {
            this.bindingEvents();
        }));
        this.panelMouseEvent = this.overlaySer.registerMouseEvent(this.elRef.nativeElement, (/**
         * @param {?} e
         * @return {?}
         */
        (e) => {
            if (this.selectedPanel.nativeElement.contains(e.target) || this.elRef.nativeElement.contains(e.target) ||
                e.target.classList.contains('lookup-clear-selected-items') || e.target.closest('.farris-messager')) {
                return;
            }
            this.showPanel(false);
        }));
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        if (this.panelMouseEvent) {
            this.panelMouseEvent();
            this.panelMouseEvent = null;
        }
    }
    /**
     * @private
     * @param {?=} show
     * @return {?}
     */
    showPanel(show = true) {
        /** @type {?} */
        const panel = this.selectedPanel.nativeElement;
        if (!show) {
            this.render.removeClass(panel, 'show');
            this.render.addClass(panel, 'd-none');
            if (this.panelEscHandler) {
                this.panelEscHandler();
                this.panelEscHandler = null;
            }
        }
        else {
            this.render.addClass(panel, 'show');
            this.render.removeClass(panel, 'd-none');
            // 注册ESC
            if (this.commonUtils) {
                this.panelEscHandler = this.commonUtils.regBodyKeydownEvent(null, (/**
                 * @return {?}
                 */
                () => this.showPanel(false)));
            }
        }
    }
    /**
     * @private
     * @return {?}
     */
    bindingEvents() {
        if (!this.selectedPanel) {
            return;
        }
        this.ngZone.runOutsideAngular((/**
         * @return {?}
         */
        () => {
            /** @type {?} */
            const panel = this.selectedPanel.nativeElement;
            this.render.listen(this.elRef.nativeElement, 'click', (/**
             * @return {?}
             */
            () => {
                if (this.selectedPanel && this.count) {
                    if (panel.classList.contains('show')) {
                        this.showPanel(false);
                    }
                    else {
                        this.showPanel();
                        /** @type {?} */
                        const selectedTableContainer = panel.querySelector('.farris-datatable-container');
                        /** @type {?} */
                        const selectedTableBody = panel.querySelector('.farris-table-scorllable-body');
                        this.render.removeStyle(selectedTableContainer, 'height');
                        this.render.removeStyle(selectedTableBody, 'height');
                        this.dataTableRef.resize({ height: panel.offsetHeight - 28, width: panel.offsetWidth - 28 });
                        this.render.setStyle(selectedTableBody, 'height', this.dataTableRef.tableHeight + 'px');
                        this.render.setStyle(selectedTableBody, 'height', this.dataTableRef.scorllableBodyHeight + 'px');
                        this.dataTableRef.dtBody.checkBodyHeightWhenEmptyData();
                    }
                }
                else {
                    if (this.notifySer) {
                        this.notifySer.warning('当前还没有选择数据。');
                    }
                }
            }));
        }));
    }
}
LookupSelectedDirective.decorators = [
    { type: Directive, args: [{ selector: '[lookup-selected]' },] }
];
/** @nocollapse */
LookupSelectedDirective.ctorParameters = () => [
    { type: Injector },
    { type: ElementRef },
    { type: Renderer2 },
    { type: NgZone }
];
LookupSelectedDirective.propDecorators = {
    selectedPanel: [{ type: Input }],
    dataTableRef: [{ type: Input }],
    count: [{ type: Input }]
};
if (false) {
    /** @type {?} */
    LookupSelectedDirective.prototype.selectedPanel;
    /** @type {?} */
    LookupSelectedDirective.prototype.dataTableRef;
    /** @type {?} */
    LookupSelectedDirective.prototype.count;
    /**
     * @type {?}
     * @private
     */
    LookupSelectedDirective.prototype.overlaySer;
    /**
     * @type {?}
     * @private
     */
    LookupSelectedDirective.prototype.panelMouseEvent;
    /**
     * @type {?}
     * @private
     */
    LookupSelectedDirective.prototype.notifySer;
    /**
     * @type {?}
     * @private
     */
    LookupSelectedDirective.prototype.commonUtils;
    /**
     * @type {?}
     * @private
     */
    LookupSelectedDirective.prototype.panelEscHandler;
    /**
     * @type {?}
     * @private
     */
    LookupSelectedDirective.prototype.injector;
    /**
     * @type {?}
     * @private
     */
    LookupSelectedDirective.prototype.elRef;
    /**
     * @type {?}
     * @private
     */
    LookupSelectedDirective.prototype.render;
    /**
     * @type {?}
     * @private
     */
    LookupSelectedDirective.prototype.ngZone;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibG9va3VwLXNlbGVjdGVkLmRpcmVjdGl2ZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvdWktbG9va3VwLyIsInNvdXJjZXMiOlsibGliL3NlbGVjdGVkLWxpc3QvbG9va3VwLXNlbGVjdGVkLmRpcmVjdGl2ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFpQixTQUFTLEVBQUUsVUFBVSxFQUFFLFFBQVEsRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFxQixTQUFTLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDNUgsT0FBTyxFQUFFLFdBQVcsRUFBRSxvQkFBb0IsRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBQ3RFLE9BQU8sRUFBRSxrQkFBa0IsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBQzFELE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUdsRCxNQUFNLE9BQU8sdUJBQXVCOzs7Ozs7O0lBWWhDLFlBQW9CLFFBQWtCLEVBQVUsS0FBaUIsRUFBVSxNQUFpQixFQUFVLE1BQWM7UUFBaEcsYUFBUSxHQUFSLFFBQVEsQ0FBVTtRQUFVLFVBQUssR0FBTCxLQUFLLENBQVk7UUFBVSxXQUFNLEdBQU4sTUFBTSxDQUFXO1FBQVUsV0FBTSxHQUFOLE1BQU0sQ0FBUTtRQVIzRyxVQUFLLEdBQUcsQ0FBQyxDQUFDO1FBR1gsb0JBQWUsR0FBRyxJQUFJLENBQUM7UUFDdkIsY0FBUyxHQUFrQixJQUFJLENBQUM7UUFDaEMsZ0JBQVcsR0FBRyxJQUFJLENBQUM7UUFDbkIsb0JBQWUsR0FBRyxJQUFJLENBQUM7UUFHM0IsSUFBSSxDQUFDLFVBQVUsR0FBRyxJQUFJLG9CQUFvQixFQUFFLENBQUM7UUFDN0MsSUFBSSxDQUFDLFNBQVMsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxhQUFhLEVBQUUsSUFBSSxDQUFDLENBQUM7UUFDeEQsSUFBSSxDQUFDLFdBQVcsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFD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U0FBUztZQUFwQyxNQUFNOzs7NEJBUWpFLEtBQUs7MkJBQ0wsS0FBSztvQkFDTCxLQUFLOzs7O0lBRk4sZ0RBQW1DOztJQUNuQywrQ0FBMEM7O0lBQzFDLHdDQUFtQjs7Ozs7SUFFbkIsNkNBQXlDOzs7OztJQUN6QyxrREFBK0I7Ozs7O0lBQy9CLDRDQUF3Qzs7Ozs7SUFDeEMsOENBQTJCOzs7OztJQUMzQixrREFBK0I7Ozs7O0lBRW5CLDJDQUEwQjs7Ozs7SUFBRSx3Q0FBeUI7Ozs7O0lBQUUseUNBQXlCOzs7OztJQUFFLHlDQUFzQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFmdGVyVmlld0luaXQsIERpcmVjdGl2ZSwgRWxlbWVudFJlZiwgSW5qZWN0b3IsIElucHV0LCBOZ1pvbmUsIE9uRGVzdHJveSwgT25Jbml0LCBSZW5kZXJlcjIgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgQ29tbW9uVXRpbHMsIE92ZXJMYXlIaWRkZW5TZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy91aS1jb21tb24nO1xyXG5pbXBvcnQgeyBEYXRhVGFibGVDb21wb25lbnQgfSBmcm9tICdAZmFycmlzL3VpLWRhdGF0YWJsZSc7XHJcbmltcG9ydCB7IE5vdGlmeVNlcnZpY2UgfSBmcm9tICdAZmFycmlzL3VpLW5vdGlmeSc7XHJcblxyXG5ARGlyZWN0aXZlKHsgc2VsZWN0b3I6ICdbbG9va3VwLXNlbGVjdGVkXScgfSlcclxuZXhwb3J0IGNsYXNzIExvb2t1cFNlbGVjdGVkRGlyZWN0aXZlIGltcGxlbWVudHMgT25Jbml0LCBBZnRlclZpZXdJbml0LCBPbkRlc3Ryb3l7XHJcblxyXG4gICAgQElucHV0KCkgc2VsZWN0ZWRQYW5lbDogRWxlbWVudFJlZjtcclxuICAgIEBJbnB1dCgpIGRhdGFUYWJsZVJlZjogRGF0YVRhYmxlQ29tcG9uZW50O1xyXG4gICAgQElucHV0KCkgY291bnQgPSAwO1xyXG5cclxuICAgIHByaXZhdGUgb3ZlcmxheVNlcjogT3ZlckxheUhpZGRlblNlcnZpY2U7XHJcbiAgICBwcml2YXRlIHBhbmVsTW91c2VFdmVudCA9IG51bGw7XHJcbiAgICBwcml2YXRlIG5vdGlmeVNlcjogTm90aWZ5U2VydmljZSA9IG51bGw7XHJcbiAgICBwcml2YXRlIGNvbW1vblV0aWxzID0gbnVsbDtcclxuICAgIHByaXZhdGUgcGFuZWxFc2NIYW5kbGVyID0gbnVsbDtcclxuXHJcbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIGluamVjdG9yOiBJbmplY3RvciwgcHJpdmF0ZSBlbFJlZjogRWxlbWVudFJlZiwgcHJpdmF0ZSByZW5kZXI6IFJlbmRlcmVyMiwgcHJpdmF0ZSBuZ1pvbmU6IE5nWm9uZSkge1xyXG4gICAgICAgIHRoaXMub3ZlcmxheVNlciA9IG5ldyBPdmVyTGF5SGlkZGVuU2VydmljZSgpO1xyXG4gICAgICAgIHRoaXMubm90aWZ5U2VyID0gdGhpcy5pbmplY3Rvci5nZXQoTm90aWZ5U2VydmljZSwgbnVsbCk7XHJcbiAgICAgICAgdGhpcy5jb21tb25VdGlscyA9IHRoaXMuaW5qZWN0b3IuZ2V0KENvbW1vblV0aWxzLCBuZXcgQ29tbW9uVXRpbHMoKSlcclxuICAgIH1cclxuXHJcbiAgICBuZ09uSW5pdCgpOiB2b2lkIHtcclxuICAgICAgICBcclxuICAgIH1cclxuXHJcbiAgICBuZ0FmdGVyVmlld0luaXQoKTogdm9pZCB7XHJcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuYmluZGluZ0V2ZW50cygpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICB0aGlzLnBhbmVsTW91c2VFdmVudCA9ICB0aGlzLm92ZXJsYXlTZXIucmVnaXN0ZXJNb3VzZUV2ZW50KHRoaXMuZWxSZWYubmF0aXZlRWxlbWVudCwgKGU6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5zZWxlY3RlZFBhbmVsLm5hdGl2ZUVsZW1lbnQuY29udGFpbnMoZS50YXJnZXQpICB8fCB0aGlzLmVsUmVmLm5hdGl2ZUVsZW1lbnQuY29udGFpbnMoZS50YXJnZXQpIHx8IFxyXG4gICAgICAgICAgICBlLnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ2xvb2t1cC1jbGVhci1zZWxlY3RlZC1pdGVtcycpIHx8IGUudGFyZ2V0LmNsb3Nlc3QoJy5mYXJyaXMtbWVzc2FnZXInKSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB0aGlzLnNob3dQYW5lbChmYWxzZSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgbmdPbkRlc3Ryb3koKTogdm9pZCB7XHJcbiAgICAgICAgaWYgKHRoaXMucGFuZWxNb3VzZUV2ZW50KSB7XHJcbiAgICAgICAgICAgIHRoaXMucGFuZWxNb3VzZUV2ZW50KCk7XHJcbiAgICAgICAgICAgIHRoaXMucGFuZWxNb3VzZUV2ZW50ID0gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBzaG93UGFuZWwoc2hvdyA9IHRydWUpIHtcclxuICAgICAgICBjb25zdCBwYW5lbCA9IHRoaXMuc2VsZWN0ZWRQYW5lbC5uYXRpdmVFbGVtZW50O1xyXG4gICAgICAgIGlmICghc2hvdykge1xyXG4gICAgICAgICAgICB0aGlzLnJlbmRlci5yZW1vdmVDbGFzcyhwYW5lbCwgJ3Nob3cnKTtcclxuICAgICAgICAgICAgdGhpcy5yZW5kZXIuYWRkQ2xhc3MocGFuZWwsICdkLW5vbmUnKTtcclxuICAgICAgICAgICAgaWYgKHRoaXMucGFuZWxFc2NIYW5kbGVyKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnBhbmVsRXNjSGFuZGxlcigpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5wYW5lbEVzY0hhbmRsZXIgPSBudWxsO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMucmVuZGVyLmFkZENsYXNzKHBhbmVsLCAnc2hvdycpO1xyXG4gICAgICAgICAgICB0aGlzLnJlbmRlci5yZW1vdmVDbGFzcyhwYW5lbCwgJ2Qtbm9uZScpO1xyXG4gICAgICAgICAgICAvLyDms6jlhoxFU0NcclxuICAgICAgICAgICAgaWYgKHRoaXMuY29tbW9uVXRpbHMpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMucGFuZWxFc2NIYW5kbGVyID0gdGhpcy5jb21tb25VdGlscy5yZWdCb2R5S2V5ZG93bkV2ZW50KG51bGwsICgpID0+IHRoaXMuc2hvd1BhbmVsKGZhbHNlKSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBiaW5kaW5nRXZlbnRzKCkge1xyXG4gICAgICAgIGlmICghdGhpcy5zZWxlY3RlZFBhbmVsKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5uZ1pvbmUucnVuT3V0c2lkZUFuZ3VsYXIoKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBwYW5lbCA9IHRoaXMuc2VsZWN0ZWRQYW5lbC5uYXRpdmVFbGVtZW50O1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgdGhpcy5yZW5kZXIubGlzdGVuKHRoaXMuZWxSZWYubmF0aXZlRWxlbWVudCwgJ2NsaWNrJywgKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuc2VsZWN0ZWRQYW5lbCAmJiB0aGlzLmNvdW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHBhbmVsLmNsYXNzTGlzdC5jb250YWlucygnc2hvdycpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd1BhbmVsKGZhbHNlKTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dQYW5lbCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzZWxlY3RlZFRhYmxlQ29udGFpbmVyID0gcGFuZWwucXVlcnlTZWxlY3RvcignLmZhcnJpcy1kYXRhdGFibGUtY29udGFpbmVyJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHNlbGVjdGVkVGFibGVCb2R5ID0gcGFuZWwucXVlcnlTZWxlY3RvcignLmZhcnJpcy10YWJsZS1zY29ybGxhYmxlLWJvZHknKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW5kZXIucmVtb3ZlU3R5bGUoc2VsZWN0ZWRUYWJsZUNvbnRhaW5lciwgJ2hlaWdodCcpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJlbmRlci5yZW1vdmVTdHlsZShzZWxlY3RlZFRhYmxlQm9keSwgJ2hlaWdodCcpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZGF0YVRhYmxlUmVmLnJlc2l6ZSh7aGVpZ2h0OiBwYW5lbC5vZmZzZXRIZWlnaHQgLSAyOCwgd2lkdGg6IHBhbmVsLm9mZnNldFdpZHRoIC0gMjh9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyLnNldFN0eWxlKHNlbGVjdGVkVGFibGVCb2R5LCAnaGVpZ2h0JywgdGhpcy5kYXRhVGFibGVSZWYudGFibGVIZWlnaHQgKyAncHgnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW5kZXIuc2V0U3R5bGUoc2VsZWN0ZWRUYWJsZUJvZHksICdoZWlnaHQnLCB0aGlzLmRhdGFUYWJsZVJlZi5zY29ybGxhYmxlQm9keUhlaWdodCArICdweCcpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kYXRhVGFibGVSZWYuZHRCb2R5LmNoZWNrQm9keUhlaWdodFdoZW5FbXB0eURhdGEoKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLm5vdGlmeVNlcikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm5vdGlmeVNlci53YXJuaW5nKCflvZPliY3ov5jmsqHmnInpgInmi6nmlbDmja7jgIInKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuXHJcbn0iXX0=
/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/*
* @Author: 疯狂秀才(Lucas Huang)
* @Date: 2018-12-14 14:40:48
 * @LastEditors: 疯狂秀才(Lucas Huang)
 * @LastEditTime: 2019-09-25 18:10:29
* @Company: Inspur
* @Version: v0.0.1
*/
import { Component, ViewChild, ViewContainerRef, EventEmitter, Output, ComponentFactoryResolver, ChangeDetectorRef } from '@angular/core';
import { of } from 'rxjs';
import { DataTableComponent } from '@farris/ui-datatable';
import { TreeTableComponent } from '@farris/ui-treetable';
import { filter, switchMap } from 'rxjs/operators';
export class LookupLeftComponent {
    /**
     * @param {?} cfr
     * @param {?} cd
     */
    constructor(cfr, cd) {
        this.cfr = cfr;
        this.cd = cd;
        this.navConditions = [];
        this.selected = new EventEmitter();
        this.unselected = new EventEmitter();
        this.search = new EventEmitter();
        this.pageChanged = new EventEmitter();
        this._searchState = null;
        this._sortState = null;
        this.allData = null;
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        if (this.lookupCmp && this.isTreeList()) {
            this.lookupCmp.includeSubordinates$$ = this.lookupCmp.includeSubordinates$.subscribe((/**
             * @param {?} val
             * @return {?}
             */
            (val) => {
                if (this.cmpRef) {
                    /** @type {?} */
                    const tt = (/** @type {?} */ (this.cmpRef.instance));
                    if (tt.selectedRow) {
                        this.selected.emit({ data: tt.selectedRow.data, node: tt.selectedRow });
                    }
                }
            }));
        }
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        this._searchState = null;
        this._sortState = null;
    }
    /**
     * @return {?}
     */
    updateScrollPosition() {
        if (this.isTreeList()) {
            /** @type {?} */
            const tt = (/** @type {?} */ (this.cmpRef.instance));
            if (tt && tt.state.scrollY != tt.psRef.directiveRef.elementRef.nativeElement.scrolltop) {
                tt.psRef.directiveRef.scrollToY(tt.state.scrollY);
            }
        }
    }
    /**
     * @return {?}
     */
    createComponent() {
        /** @type {?} */
        let dtFac = null;
        if (!this.isTreeList()) {
            dtFac = this.cfr.resolveComponentFactory(DataTableComponent);
        }
        else {
            this.navOptions['fitColumns'] = false;
            this.navOptions['autoFitColumns'] = true;
            dtFac = this.cfr.resolveComponentFactory(TreeTableComponent);
        }
        this.navOptions['keepSelect'] = false;
        // 左侧查询过滤条，隐藏掉；
        this.navOptions['showFilterBar'] = this.lookupCmp.enableMultiFieldSearch ? false : this.lookupCmp.showFilterBar;
        this.navOptions.width = this.lookupCmp.leftPanelWidth;
        this.cmpRef = this.cmpContainer.createComponent(dtFac);
        if (!this.isTreeList()) {
            this.navOptions.width -= 2;
            this.navOptions['fill'] = true;
            this.cmpRef.instance.maxSize = 5;
            this.cmpRef.instance.fill = true;
            this.cmpRef.instance.autoFitColumns = true;
        }
        else {
            this.navOptions['fit'] = true;
        }
        // this.cmpRef.instance.fit = true;
        if (this.navOptions.pageInfo) {
            if (this.navOptions.pageInfo.pageList) {
                this.navOptions.pageList = this.navOptions.pageInfo.pageList;
            }
            this.navOptions.pagination = this.navOptions.pageInfo.enablePager;
            this.navOptions.pageIndex = this.navOptions.pageInfo.pageIndex;
            this.navOptions.pageSize = this.navOptions.pageInfo.pageSize;
        }
        else {
            this.navOptions.pagination = false;
        }
        Object.assign(this.cmpRef.instance, this.navOptions);
        this.loadData();
        return of(this.cmpRef);
    }
    /**
     * @return {?}
     */
    update() {
        this.cd.detectChanges();
    }
    /**
     * @param {?=} size
     * @return {?}
     */
    resize(size) {
        if (size) {
            const { width, height } = size;
            /** @type {?} */
            const _width = width - 2;
            this.navOptions.width = _width;
            this.navOptions.height = height;
            /** @type {?} */
            const _height = height - this.lookupCmp.getFilterBarHeight();
            this.cmpRef.instance.resize({ width: _width, height: _height });
        }
    }
    /**
     * @return {?}
     */
    isTreeList() {
        return this.navOptions.displayType.toLowerCase() === 'treelist' && !this.lookupCmp.navTreeToList;
    }
    /**
     * @private
     * @param {?} items
     * @param {?} dt
     * @return {?}
     */
    selectLeftDataTableRow(items, dt) {
        if (items && items.length) {
            /** @type {?} */
            let item = null;
            if (this.lookupCmp.navSelectedIds) {
                item = items.find((/**
                 * @param {?} n
                 * @return {?}
                 */
                n => n[dt.idField] == this.lookupCmp.navSelectedIds));
            }
            else {
                if (this.lookupCmp.selectFirstInNav) {
                    item = items[0];
                }
            }
            if (item) {
                dt.dtBody.selectedRowIndex = -1;
                dt.dtBody.selectedRow('', 0, item);
            }
        }
    }
    /**
     * @private
     * @return {?}
     */
    closeLoading() {
        this.lookupCmp.closeLoading();
    }
    /**
     * @private
     * @param {?} dt
     * @return {?}
     */
    initDataTable(dt) {
        dt.loadData({
            pageSize: this.navOptions.pageSize,
            pageIndex: this.navOptions.pageIndex,
            total: this.navOptions.total,
            data: this.navOptions.items,
        });
        const { width, height } = this.navOptions;
        // dt.resize({ width: 320, height: this.navOptions.height});
        dt.resize({ width, height: height - this.lookupCmp.getFilterBarHeight() });
        // 行选中
        dt.selectedRow.subscribe((/**
         * @param {?} d
         * @return {?}
         */
        d => {
            this.selected.emit({ data: d.data });
        }));
        dt.unSelectRow.subscribe((/**
         * @param {?} d
         * @return {?}
         */
        d => {
            this.selected.emit(null);
        }));
        /** @type {?} */
        const loadTableData = {
            next: (/**
             * @param {?} data
             * @return {?}
             */
            (data) => {
                this.closeLoading();
                dataTableReLoad(data);
                const { width, height } = this.navOptions;
                this.cmpRef.instance.resize({ width, height: height - this.lookupCmp.getFilterBarHeight() });
            }),
            error: (/**
             * @param {?} err
             * @return {?}
             */
            (err) => {
                this.closeLoading();
            })
        };
        // 查询
        dt.search.subscribe((/**
         * @param {?} searchData
         * @return {?}
         */
        searchData => {
            /** @type {?} */
            const p = { pageInfo: { pageIndex: 1, pageSize: this.navOptions.pageSize }, search: '', navConditions: this.navConditions };
            this._searchState = searchData;
            this.search.emit(searchData);
            p.search = searchData;
            p.pageInfo.pageSize = dt.pageSize;
            this.lookupCmp.navigationFilter = null;
            if (this._sortState && this._sortState.sortName) {
                p['sortName'] = this._sortState.sortName;
                p['sortOrder'] = this._sortState.sortOrder;
            }
            else {
                delete p['sortName'];
                delete p['sortOrder'];
            }
            this.lookupCmp.httpMgr.getData(p, 'navsearch').pipe(filter((/**
             * @param {?} n
             * @return {?}
             */
            n => n))).subscribe(loadTableData);
        }));
        /** @type {?} */
        const dataTableReLoad = (/**
         * @param {?} data
         * @return {?}
         */
        (data) => {
            dt.loadData({
                pageSize: data.pageInfo.pageSize,
                pageIndex: data.pageInfo.pageIndex,
                total: data.total,
                data: data.items,
            });
            this.selectLeftDataTableRow(data.items, dt);
            dt.cd.markForCheck();
        });
        // 分页
        dt.pageChanged.subscribe((/**
         * @param {?} d
         * @return {?}
         */
        d => {
            this.pageChanged.emit(d);
            this.lookupCmp.navigationFilter = null;
            d.navConditions = this.navConditions || [];
            this.lookupCmp.httpMgr.getData(d, 'navsearch').subscribe(loadTableData);
        }));
        dt.pageSizeChanged.subscribe((/**
         * @param {?} e
         * @return {?}
         */
        (e) => {
            this.lookupCmp.navigationFilter = null;
            e.navConditions = this.navConditions || [];
            this.lookupCmp.httpMgr.getData(e, 'navsearch').subscribe(loadTableData);
        }));
        dt.columnSorted.subscribe((/**
         * @param {?} sort
         * @return {?}
         */
        (sort) => {
            const { sortName, sortOrder } = Object.assign({}, sort);
            this._sortState = sort;
            this.lookupCmp.navigationFilter = null;
            /** @type {?} */
            const param = {
                sortName,
                sortOrder,
                search: this._searchState,
                pageInfo: {
                    pageSize: dt.pageSize,
                    pageIndex: 1
                },
                navConditions: this.navConditions || []
            };
            this.lookupCmp.httpMgr.getData(param, 'navsearch').subscribe(loadTableData);
        }));
        dt.clearSearchValue.subscribe((/**
         * @return {?}
         */
        () => {
            this._searchState = null;
            dt.search.emit(null);
        }));
        this.selectLeftDataTableRow(this.navOptions.items, dt);
    }
    /**
     * @private
     * @param {?} params
     * @return {?}
     */
    buildParams(params) {
        /** @type {?} */
        const p = Object.assign({}, params, { treeToList: this.lookupCmp.treeToList, navTreeToList: this.lookupCmp.navTreeToList, navConditions: this.navConditions || [] });
        return p;
    }
    /**
     * @private
     * @param {?} tt
     * @return {?}
     */
    initTreeTable(tt) {
        tt.virtualized = true;
        tt.fast = true;
        tt.nodeSelected.subscribe((/**
         * @param {?} d
         * @return {?}
         */
        d => {
            this.selected.emit({ data: d.node.data, node: d.node });
        }));
        tt.nodeUnSelect.subscribe((/**
         * @param {?} d
         * @return {?}
         */
        d => {
            this.selected.emit(null);
        }));
        tt.fixedHeader = true;
        if (this.navOptions.treeInfo.loadDataType === 'all') { // 分层加载不支持取数时配置展开层级
            this.lookupCmp.treeNodeHelper.updateTreeNodeExpanded(this.navOptions.items, this.navOptions.treeInfo);
        }
        tt.loadDataType = this.navOptions.treeInfo.loadDataType;
        // 检查完整树过滤条件 By Lucas 20200302
        this.navOptions.items = this.lookupCmp.checkNodeCanBeSelect(this.navOptions.items, this.navOptions.treeInfo.loadDataType === 'all');
        tt.loadData(this.navOptions.items);
        if (this.lookupCmp.navSelectedIds) {
            tt.selectNode(this.lookupCmp.navSelectedIds);
        }
        else if (this.lookupCmp.selectFirstInNav) {
            tt.selectFirstNode();
        }
        this.allData = this.navOptions.items;
        /** @type {?} */
        const loadTreeData = {
            next: (/**
             * @param {?} resData
             * @return {?}
             */
            (resData) => {
                this.closeLoading();
                tt.psRef.directiveRef.scrollToTop(0);
                tt.clearAll();
                /** @type {?} */
                const items = this.lookupCmp.checkNodeCanBeSelect(resData.items, this.navOptions.treeInfo.loadDataType === 'all' && (!this._searchState || !this._searchState.value));
                if (items && items.length && items[0].children && items[0].children.length) {
                    items[0].expanded = true;
                    items[0].children = this.lookupCmp.expandFirstNode(items[0].children);
                }
                tt.loadData(items);
                tt.resize();
                this.selected.emit(null);
            }),
            error: (/**
             * @param {?} err
             * @return {?}
             */
            (err) => {
                this.closeLoading();
            })
        };
        tt.search.subscribe((/**
         * @param {?} search
         * @return {?}
         */
        search => {
            this._searchState = search;
            this.lookupCmp.navigationFilter = null;
            /** @type {?} */
            const p = this.buildParams({ search });
            if (this._sortState && this._sortState.sortName) {
                p['sortName'] = this._sortState.sortName;
                p['sortOrder'] = this._sortState.sortOrder;
            }
            this.lookupCmp.httpMgr.getData(p, 'navsearch').subscribe(loadTreeData);
        }));
        tt.columnSorted.subscribe((/**
         * @param {?} sort
         * @return {?}
         */
        (sort) => {
            this.lookupCmp.navigationFilter = null;
            if (tt.loadDataType === 'all') {
                tt.clientSort();
            }
            else {
                let { sortName, sortOrder } = Object.assign({}, sort);
                /** @type {?} */
                const sortCol = this.navOptions.columns.find((/**
                 * @param {?} n
                 * @return {?}
                 */
                n => n.field === sortName));
                if (sortCol) {
                    sortName = sortCol['fieldPath'];
                }
                this._sortState = { sortName, sortOrder };
                // const param = Object.assign({ sortName, sortOrder }, this._searchState);
                /** @type {?} */
                const param = this.buildParams({ sortName, sortOrder, search: this._searchState });
                /** @type {?} */
                let requestType = 'nav';
                if ((this._searchState && this._searchState.value) || (param && param.navConditions && param.navConditions.length)) {
                    requestType = 'navsearch';
                }
                this.lookupCmp.httpMgr.getData(param, requestType).subscribe(loadTreeData);
            }
        }));
        tt.clearSearchValue.subscribe((/**
         * @return {?}
         */
        () => {
            this._searchState = null;
            if (!this._sortState || !this._sortState.sortName) {
                tt.loadData(this.allData);
                if (!tt.selectedRow) {
                    this.selected.emit(null);
                }
            }
            else {
                /** @type {?} */
                const p = this.buildParams({});
                this.lookupCmp.navigationFilter = null;
                if (this._sortState && this._sortState.sortName) {
                    p['sortName'] = this._sortState.sortName;
                    p['sortOrder'] = this._sortState.sortOrder;
                }
                this.lookupCmp.httpMgr.getData(p, 'nav').subscribe(loadTreeData);
            }
        }));
        tt.expand.subscribe((/**
         * @param {?} tn
         * @return {?}
         */
        (tn) => {
            this.onNodeExpanded(tn, tt);
        }));
    }
    /**
     * @private
     * @param {?} tn
     * @param {?} tt
     * @return {?}
     */
    onNodeExpanded(tn, tt) {
        if (tn.leaf) {
            return;
        }
        if (!tn.children || !tn.children.length) {
            /** @type {?} */
            const treeInfo = this.navOptions.treeInfo;
            if (this.navOptions.treeInfo.loadDataType === 'async') {
                /** @type {?} */
                let parentPath = '';
                /** @type {?} */
                let parentLayer = -1;
                const { field = '*', value = '' } = Object.assign({}, tt.searchData);
                tn['showLoading'] = true;
                tt.detectChanges();
                if (treeInfo.layerType === 'parentId') {
                    // 父ID加载方式
                    parentPath = tn['id'];
                }
                else {
                    /** @type {?} */
                    const treeInfoField = treeInfo.dataField;
                    if (treeInfoField) {
                        // parentPath = tn.data[treeInfoField][treeInfo.pathField];
                        // parentLayer = tn.data[treeInfoField][treeInfo.layerField];
                        parentPath = this.lookupCmp.getPathCode(tn.data, treeInfo);
                        parentLayer = this.lookupCmp.getLayerData(tn.data, treeInfo);
                    }
                    else {
                        console.log('未找到分级信息。');
                    }
                }
                if (!this.lookupCmp.uri) {
                    this.lookupCmp.expandTreeNode.emit({
                        instance: tt, node: tn,
                        parentIdOrPath: parentPath, parentLayer, search: { value, field }
                    });
                    return;
                }
                this.getChildren(parentPath, parentLayer, { searchField: field === '*' ? '*' : field, searchValue: value }, tt).pipe(switchMap((/**
                 * @param {?} data
                 * @return {?}
                 */
                (data) => {
                    if (data && data.items && data.items.length) {
                        return of(data);
                    }
                    else {
                        return this.getChildren(parentPath, parentLayer, { searchField: '*', searchValue: '' }, tt, true);
                    }
                }))).subscribe((/**
                 * @param {?} data
                 * @return {?}
                 */
                data => {
                    if (tt) {
                        if (tn && data.items && data.items.length) {
                            tt.appendChildren(data.items, tn);
                        }
                        tn['showLoading'] = false;
                        tt.detectChanges();
                    }
                }));
            }
        }
    }
    /**
     * @private
     * @param {?} parentPath
     * @param {?} parentLayer
     * @param {?} searchData
     * @param {?} tt
     * @param {?=} all
     * @return {?}
     */
    getChildren(parentPath, parentLayer, searchData, tt, all = false) {
        /** @type {?} */
        const uri = this.lookupCmp.gridOptions.uri;
        /** @type {?} */
        const search = Object.assign({ parentLayer, category: 'navchildren' }, searchData);
        if (this.navOptions.treeInfo.layerType === 'parentId') {
            search['parentId'] = parentPath;
        }
        else {
            search['parentPath'] = parentPath;
        }
        /** @type {?} */
        const param = this.buildParams({
            searchValue: JSON.stringify(search),
            customData: this.lookupCmp.customData,
            enableFullTree: false,
            loadTreeDataType: 'layerload',
        });
        if (this.lookupCmp.helpId) {
            param['helpId'] = this.lookupCmp.helpId;
        }
        if (tt && tt.sortName) {
            /** @type {?} */
            let sortName = tt.sortName;
            /** @type {?} */
            const sortCol = this.navOptions.columns.find((/**
             * @param {?} n
             * @return {?}
             */
            n => n.field === tt.sortName));
            if (sortCol) {
                sortName = sortCol['fieldPath'];
            }
            search['sortName'] = sortName;
            search['sortOrder'] = tt.sortOrder;
            param.searchValue = JSON.stringify(search);
        }
        if (this.navConditions && this.navConditions.length && !all) {
            param.navSearchConditions = this.navConditions;
        }
        delete param.navConditions;
        return this.lookupCmp.http.getData(uri, param);
    }
    /**
     * @return {?}
     */
    loadData() {
        this.cmpRef.instance.allColumnsTitle = this.lookupCmp.allColumnsTitle;
        if (!this.isTreeList()) {
            /** @type {?} */
            const dt = (/** @type {?} */ (this.cmpRef.instance));
            this.initDataTable(dt);
        }
        else {
            /** @type {?} */
            const tt = (/** @type {?} */ (this.cmpRef.instance));
            this.initTreeTable(tt);
        }
    }
    /**
     * @param {?} $event
     * @return {?}
     */
    onConditionsChange($event) {
        this.navConditions = $event;
        if (this.isTreeList()) {
            /** @type {?} */
            const tt = (/** @type {?} */ (this.cmpRef.instance));
            tt.search.emit();
        }
        else {
            /** @type {?} */
            const dt = (/** @type {?} */ (this.cmpRef.instance));
            dt.search.emit();
        }
    }
}
LookupLeftComponent.decorators = [
    { type: Component, args: [{
                selector: 'lookup-left',
                template: "<div style=\"height: 100%;position: relative;width: calc(100% - 2px)\" class=\"d-flex flex-column\">\r\n    <div class=\"lookup-filter-bar\" [viewType]=\"'onlyinput'\"\r\n    lookup-filter-bar *ngIf=\"lookupCmp?.enableMultiFieldSearch && lookupCmp?.showFilterBar\"\r\n    [columns]=\"navOptions?.columns\" [searchFields]=\"navOptions?.searchFields\" [isNav]=\"true\"\r\n    (conditionsChange)=\"onConditionsChange($event)\"></div>\r\n    <div class=\"h-100 w-100 f-utils-fill\" style=\"position: relative;\">\r\n        <ng-container #container></ng-container>\r\n    </div>\r\n</div>"
            }] }
];
/** @nocollapse */
LookupLeftComponent.ctorParameters = () => [
    { type: ComponentFactoryResolver },
    { type: ChangeDetectorRef }
];
LookupLeftComponent.propDecorators = {
    cmpContainer: [{ type: ViewChild, args: ['container', { read: ViewContainerRef },] }],
    selected: [{ type: Output }],
    unselected: [{ type: Output }],
    search: [{ type: Output }],
    pageChanged: [{ type: Output }]
};
if (false) {
    /** @type {?} */
    LookupLeftComponent.prototype.cmpRef;
    /** @type {?} */
    LookupLeftComponent.prototype.navOptions;
    /** @type {?} */
    LookupLeftComponent.prototype.lookupCmp;
    /** @type {?} */
    LookupLeftComponent.prototype.navConditions;
    /** @type {?} */
    LookupLeftComponent.prototype.cmpContainer;
    /** @type {?} */
    LookupLeftComponent.prototype.selected;
    /** @type {?} */
    LookupLeftComponent.prototype.unselected;
    /** @type {?} */
    LookupLeftComponent.prototype.search;
    /** @type {?} */
    LookupLeftComponent.prototype.pageChanged;
    /**
     * @type {?}
     * @private
     */
    LookupLeftComponent.prototype._searchState;
    /**
     * @type {?}
     * @private
     */
    LookupLeftComponent.prototype._sortState;
    /**
     * @type {?}
     * @private
     */
    LookupLeftComponent.prototype.allData;
    /**
     * @type {?}
     * @private
     */
    LookupLeftComponent.prototype.cfr;
    /**
     * @type {?}
     * @private
     */
    LookupLeftComponent.prototype.cd;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibG9va3VwLWxlZnQuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy91aS1sb29rdXAvIiwic291cmNlcyI6WyJsaWIvbG9va3VwLWxlZnQuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7OztBQVNBLE9BQU8sRUFBRSxTQUFTLEVBQVUsU0FBUyxFQUFFLGdCQUFnQixFQUFFLFlBQVksRUFBRSxNQUFNLEVBQ3pFLHdCQUF3QixFQUFnQixpQkFBaUIsRUFDNUQsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFjLEVBQUUsRUFBZ0IsTUFBTSxNQUFNLENBQUM7QUFFcEQsT0FBTyxFQUFFLGtCQUFrQixFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFDMUQsT0FBTyxFQUFZLGtCQUFrQixFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFJcEUsT0FBTyxFQUFFLE1BQU0sRUFBRSxTQUFTLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQVFuRCxNQUFNLE9BQU8sbUJBQW1COzs7OztJQWtCNUIsWUFBb0IsR0FBNkIsRUFBVSxFQUFxQjtRQUE1RCxRQUFHLEdBQUgsR0FBRyxDQUEwQjtRQUFVLE9BQUUsR0FBRixFQUFFLENBQW1CO1FBWmhGLGtCQUFhLEdBQTJCLEVBQUUsQ0FBQztRQUlqQyxhQUFRLEdBQUcsSUFBSSxZQUFZLEVBQTRCLENBQUM7UUFDeEQsZUFBVSxHQUFHLElBQUksWUFBWSxFQUFFLENBQUM7UUFDaEMsV0FBTSxHQUFHLElBQUksWUFBWSxFQUFvQyxDQUFDO1FBQzlELGdCQUFXLEdBQUcsSUFBSSxZQUFZLEVBQStGLENBQUM7UUFFaEksaUJBQVksR0FBRyxJQUFJLENBQUM7UUFDcEIsZUFBVSxHQUFHLElBQUksQ0FBQztRQUNsQixZQUFPLEdBQUcsSUFBSSxDQUFDO0lBQzZELENBQUM7Ozs7SUFFckYsUUFBUTtRQUNKLElBQUksSUFBSSxDQUFDLFNBQVMsSUFBSSxJQUFJLENBQUMsVUFBVSxFQUFFLEVB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dXJjZXNDb250ZW50IjpbIi8qXHJcbiogQEF1dGhvcjog55av54uC56eA5omNKEx1Y2FzIEh1YW5nKVxyXG4qIEBEYXRlOiAyMDE4LTEyLTE0IDE0OjQwOjQ4XHJcbiAqIEBMYXN0RWRpdG9yczog55av54uC56eA5omNKEx1Y2FzIEh1YW5nKVxyXG4gKiBATGFzdEVkaXRUaW1lOiAyMDE5LTA5LTI1IDE4OjEwOjI5XHJcbiogQENvbXBhbnk6IEluc3B1clxyXG4qIEBWZXJzaW9uOiB2MC4wLjFcclxuKi9cclxuXHJcbmltcG9ydCB7IENvbXBvbmVudCwgT25Jbml0LCBWaWV3Q2hpbGQsIFZpZXdDb250YWluZXJSZWYsIEV2ZW50RW1pdHRlciwgT3V0cHV0LFxyXG4gICAgQ29tcG9uZW50RmFjdG9yeVJlc29sdmVyLCBDb21wb25lbnRSZWYsIENoYW5nZURldGVjdG9yUmVmLCBJbmplY3RvciwgUmVmbGVjdGl2ZUluamVjdG9yLCBPbkRlc3Ryb3lcclxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgT2JzZXJ2YWJsZSwgb2YsIFN1YnNjcmlwdGlvbiB9IGZyb20gJ3J4anMnO1xyXG5cclxuaW1wb3J0IHsgRGF0YVRhYmxlQ29tcG9uZW50IH0gZnJvbSAnQGZhcnJpcy91aS1kYXRhdGFibGUnO1xyXG5pbXBvcnQgeyBUcmVlTm9kZSwgVHJlZVRhYmxlQ29tcG9uZW50IH0gZnJvbSAnQGZhcnJpcy91aS10cmVldGFibGUnO1xyXG5cclxuaW1wb3J0IHsgTE9BRF9EQVRBX1RZUEUsIExvb2t1cEdyaWRPcHRpb25zLCBMb29rdXBHcmlkUmVzdWx0IH0gZnJvbSAnLi9sb29rdXAtZ3JpZC1vcHRpb25zJztcclxuaW1wb3J0IHsgTG9va3VwR3JpZENvbXBvbmVudCB9IGZyb20gJy4vbG9va3VwLWdyaWQuY29tcG9uZW50JztcclxuaW1wb3J0IHsgZmlsdGVyLCBzd2l0Y2hNYXAgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XHJcbmltcG9ydCB7IEZpbHRlckNvbmRpdGlvbiB9IGZyb20gJ0BmYXJyaXMvdWktY29tbW9uL3R5cGVzJztcclxuXHJcbkBDb21wb25lbnQoe1xyXG4gICAgc2VsZWN0b3I6ICdsb29rdXAtbGVmdCcsXHJcbiAgICB0ZW1wbGF0ZVVybDogJy4vbG9va3VwLWxlZnQuY29tcG9uZW50Lmh0bWwnXHJcbn0pXHJcblxyXG5leHBvcnQgY2xhc3MgTG9va3VwTGVmdENvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgT25EZXN0cm95IHtcclxuXHJcbiAgICBjbXBSZWY6IENvbXBvbmVudFJlZjxhbnk+O1xyXG4gICAgbmF2T3B0aW9uczogTG9va3VwR3JpZE9wdGlvbnM7XHJcbiAgICBsb29rdXBDbXA6IExvb2t1cEdyaWRDb21wb25lbnQ7XHJcblxyXG4gICAgbmF2Q29uZGl0aW9uczogQXJyYXk8RmlsdGVyQ29uZGl0aW9uPiA9IFtdO1xyXG5cclxuXHJcbiAgICBAVmlld0NoaWxkKCdjb250YWluZXInLCB7cmVhZDogVmlld0NvbnRhaW5lclJlZn0pIGNtcENvbnRhaW5lcjogVmlld0NvbnRhaW5lclJlZjtcclxuICAgIEBPdXRwdXQoKSBzZWxlY3RlZCA9IG5ldyBFdmVudEVtaXR0ZXI8eyBkYXRhOiBhbnksIG5vZGU/OiBhbnl9PigpO1xyXG4gICAgQE91dHB1dCgpIHVuc2VsZWN0ZWQgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcbiAgICBAT3V0cHV0KCkgc2VhcmNoID0gbmV3IEV2ZW50RW1pdHRlcjx7IGZpZWxkOiBzdHJpbmcsIHZhbHVlOiBzdHJpbmcgfT4oKTtcclxuICAgIEBPdXRwdXQoKSBwYWdlQ2hhbmdlZCA9IG5ldyBFdmVudEVtaXR0ZXI8eyBwYWdlSW5mbzoge3BhZ2VJbmRleDogbnVtYmVyLCBwYWdlU2l6ZTogbnVtYmVyfSwgc2VhcmNoOiB7ZmllbGQ6IHN0cmluZywgdmFsdWU6IHN0cmluZ30gfT4oKTtcclxuXHJcbiAgICBwcml2YXRlIF9zZWFyY2hTdGF0ZSA9IG51bGw7XHJcbiAgICBwcml2YXRlIF9zb3J0U3RhdGUgPSBudWxsO1xyXG4gICAgcHJpdmF0ZSBhbGxEYXRhID0gbnVsbDtcclxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgY2ZyOiBDb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIsIHByaXZhdGUgY2Q6IENoYW5nZURldGVjdG9yUmVmKSB7IH1cclxuXHJcbiAgICBuZ09uSW5pdCgpIHtcclxuICAgICAgICBpZiAodGhpcy5sb29rdXBDbXAgJiYgdGhpcy5pc1RyZWVMaXN0KCkpIHtcclxuICAgICAgICAgICAgdGhpcy5sb29rdXBDbXAuaW5jbHVkZVN1Ym9yZGluYXRlcyQkID0gdGhpcy5sb29rdXBDbXAuaW5jbHVkZVN1Ym9yZGluYXRlcyQuc3Vic2NyaWJlKCh2YWw6IGJvb2xlYW4pID0+IHtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmNtcFJlZikge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHR0ID0gdGhpcy5jbXBSZWYuaW5zdGFuY2UgYXMgVHJlZVRhYmxlQ29tcG9uZW50O1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0dC5zZWxlY3RlZFJvdykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGVkLmVtaXQoeyBkYXRhOiB0dC5zZWxlY3RlZFJvdy5kYXRhLCBub2RlOiB0dC5zZWxlY3RlZFJvdyB9KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBuZ09uRGVzdHJveSgpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLl9zZWFyY2hTdGF0ZSA9IG51bGw7XHJcbiAgICAgICAgdGhpcy5fc29ydFN0YXRlID0gbnVsbDtcclxuICAgIH1cclxuXHJcbiAgICB1cGRhdGVTY3JvbGxQb3NpdGlvbigpIHtcclxuICAgICAgICBpZiAodGhpcy5pc1RyZWVMaXN0KCkpIHtcclxuICAgICAgICAgICAgY29uc3QgdHQgPSB0aGlzLmNtcFJlZi5pbnN0YW5jZSBhcyBUcmVlVGFibGVDb21wb25lbnQ7XHJcbiAgICAgICAgICAgIGlmICh0dCAmJiB0dC5zdGF0ZS5zY3JvbGxZICE9IHR0LnBzUmVmLmRpcmVjdGl2ZVJlZi5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQuc2Nyb2xsdG9wKSB7XHJcbiAgICAgICAgICAgICAgICB0dC5wc1JlZi5kaXJlY3RpdmVSZWYuc2Nyb2xsVG9ZKHR0LnN0YXRlLnNjcm9sbFkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGNyZWF0ZUNvbXBvbmVudCgpOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgICAgIGxldCBkdEZhYyA9IG51bGw7XHJcbiAgICAgICAgaWYgKCF0aGlzLmlzVHJlZUxpc3QoKSkge1xyXG4gICAgICAgICAgICBkdEZhYyA9IHRoaXMuY2ZyLnJlc29sdmVDb21wb25lbnRGYWN0b3J5KERhdGFUYWJsZUNvbXBvbmVudCk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5uYXZPcHRpb25zWydmaXRDb2x1bW5zJ10gPSBmYWxzZTtcclxuICAgICAgICAgICAgdGhpcy5uYXZPcHRpb25zWydhdXRvRml0Q29sdW1ucyddID0gdHJ1ZTtcclxuICAgICAgICAgICAgZHRGYWMgPSB0aGlzLmNmci5yZXNvbHZlQ29tcG9uZW50RmFjdG9yeShUcmVlVGFibGVDb21wb25lbnQpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLm5hdk9wdGlvbnNbJ2tlZXBTZWxlY3QnXSA9IGZhbHNlO1xyXG4gICAgICAgIC8vIOW3puS+p+afpeivoui/h+a7pOadoe+8jOmakOiXj+aOie+8m1xyXG4gICAgICAgIHRoaXMubmF2T3B0aW9uc1snc2hvd0ZpbHRlckJhciddID0gdGhpcy5sb29rdXBDbXAuZW5hYmxlTXVsdGlGaWVsZFNlYXJjaD8gZmFsc2U6IHRoaXMubG9va3VwQ21wLnNob3dGaWx0ZXJCYXI7XHJcblxyXG4gICAgICAgIHRoaXMubmF2T3B0aW9ucy53aWR0aCA9IHRoaXMubG9va3VwQ21wLmxlZnRQYW5lbFdpZHRoO1xyXG5cclxuICAgICAgICB0aGlzLmNtcFJlZiA9IHRoaXMuY21wQ29udGFpbmVyLmNyZWF0ZUNvbXBvbmVudChkdEZhYyk7XHJcblxyXG4gICAgICAgIGlmICghdGhpcy5pc1RyZWVMaXN0KCkpIHtcclxuICAgICAgICAgICAgdGhpcy5uYXZPcHRpb25zLndpZHRoIC09IDI7XHJcbiAgICAgICAgICAgIHRoaXMubmF2T3B0aW9uc1snZmlsbCddID0gdHJ1ZTtcclxuICAgICAgICAgICAgdGhpcy5jbXBSZWYuaW5zdGFuY2UubWF4U2l6ZSA9IDU7XHJcbiAgICAgICAgICAgIHRoaXMuY21wUmVmLmluc3RhbmNlLmZpbGwgPSB0cnVlO1xyXG4gICAgICAgICAgICB0aGlzLmNtcFJlZi5pbnN0YW5jZS5hdXRvRml0Q29sdW1ucyA9IHRydWU7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5uYXZPcHRpb25zWydmaXQnXSA9IHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIHRoaXMuY21wUmVmLmluc3RhbmNlLmZpdCA9IHRydWU7XHJcblxyXG4gICAgICAgIGlmICh0aGlzLm5hdk9wdGlvbnMucGFnZUluZm8pIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMubmF2T3B0aW9ucy5wYWdlSW5mby5wYWdlTGlzdCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5uYXZPcHRpb25zLnBhZ2VMaXN0ID0gdGhpcy5uYXZPcHRpb25zLnBhZ2VJbmZvLnBhZ2VMaXN0O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMubmF2T3B0aW9ucy5wYWdpbmF0aW9uID0gdGhpcy5uYXZPcHRpb25zLnBhZ2VJbmZvLmVuYWJsZVBhZ2VyO1xyXG4gICAgICAgICAgICB0aGlzLm5hdk9wdGlvbnMucGFnZUluZGV4ID0gdGhpcy5uYXZPcHRpb25zLnBhZ2VJbmZvLnBhZ2VJbmRleDtcclxuICAgICAgICAgICAgdGhpcy5uYXZPcHRpb25zLnBhZ2VTaXplID0gdGhpcy5uYXZPcHRpb25zLnBhZ2VJbmZvLnBhZ2VTaXplO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMubmF2T3B0aW9ucy5wYWdpbmF0aW9uID0gZmFsc2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBPYmplY3QuYXNzaWduKHRoaXMuY21wUmVmLmluc3RhbmNlLCB0aGlzLm5hdk9wdGlvbnMpO1xyXG5cclxuICAgICAgICB0aGlzLmxvYWREYXRhKCk7XHJcbiAgICAgICAgcmV0dXJuIG9mKHRoaXMuY21wUmVmKTtcclxuICAgIH1cclxuXHJcbiAgICB1cGRhdGUoKSB7XHJcbiAgICAgICAgdGhpcy5jZC5kZXRlY3RDaGFuZ2VzKCk7XHJcbiAgICB9XHJcblxyXG4gICAgcmVzaXplKHNpemU/OiB7d2lkdGg6IG51bWJlciwgaGVpZ2h0OiBudW1iZXJ9KSB7XHJcbiAgICAgICAgaWYgKHNpemUpIHtcclxuICAgICAgICAgICAgY29uc3QgeyB3aWR0aCwgaGVpZ2h0IH0gPSBzaXplO1xyXG4gICAgICAgICAgICBjb25zdCBfd2lkdGggPSB3aWR0aCAtIDI7XHJcbiAgICAgICAgICAgIHRoaXMubmF2T3B0aW9ucy53aWR0aCA9IF93aWR0aDtcclxuICAgICAgICAgICAgdGhpcy5uYXZPcHRpb25zLmhlaWdodCA9IGhlaWdodDtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IF9oZWlnaHQgPSBoZWlnaHQgLSAgdGhpcy5sb29rdXBDbXAuZ2V0RmlsdGVyQmFySGVpZ2h0KCk7XHJcbiAgICAgICAgICAgIHRoaXMuY21wUmVmLmluc3RhbmNlLnJlc2l6ZSh7IHdpZHRoOiBfd2lkdGgsIGhlaWdodDogX2hlaWdodCB9KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgaXNUcmVlTGlzdCgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5uYXZPcHRpb25zLmRpc3BsYXlUeXBlLnRvTG93ZXJDYXNlKCkgPT09ICd0cmVlbGlzdCcgJiYgIXRoaXMubG9va3VwQ21wLm5hdlRyZWVUb0xpc3Q7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBzZWxlY3RMZWZ0RGF0YVRhYmxlUm93KGl0ZW1zOiBhbnksIGR0OiBEYXRhVGFibGVDb21wb25lbnQpIHtcclxuICAgICAgICBpZiAoaXRlbXMgJiYgaXRlbXMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIGxldCBpdGVtID0gbnVsbDtcclxuICAgICAgICAgICAgaWYgKHRoaXMubG9va3VwQ21wLm5hdlNlbGVjdGVkSWRzKSB7XHJcbiAgICAgICAgICAgICAgICBpdGVtID0gaXRlbXMuZmluZChuID0+IG5bZHQuaWRGaWVsZF0gPT0gdGhpcy5sb29rdXBDbXAubmF2U2VsZWN0ZWRJZHMpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMubG9va3VwQ21wLnNlbGVjdEZpcnN0SW5OYXYpIHtcclxuICAgICAgICAgICAgICAgICAgICBpdGVtID0gaXRlbXNbMF07XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmIChpdGVtKSB7XHJcbiAgICAgICAgICAgICAgICBkdC5kdEJvZHkuc2VsZWN0ZWRSb3dJbmRleCA9IC0xO1xyXG4gICAgICAgICAgICAgICAgZHQuZHRCb2R5LnNlbGVjdGVkUm93KCcnLCAwLCBpdGVtKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGNsb3NlTG9hZGluZygpIHtcclxuICAgICAgICB0aGlzLmxvb2t1cENtcC5jbG9zZUxvYWRpbmcoKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGluaXREYXRhVGFibGUoZHQ6IERhdGFUYWJsZUNvbXBvbmVudCkge1xyXG4gICAgICAgIGR0LmxvYWREYXRhKHtcclxuICAgICAgICAgICAgcGFnZVNpemU6IHRoaXMubmF2T3B0aW9ucy5wYWdlU2l6ZSxcclxuICAgICAgICAgICAgcGFnZUluZGV4OiB0aGlzLm5hdk9wdGlvbnMucGFnZUluZGV4LFxyXG4gICAgICAgICAgICB0b3RhbDogdGhpcy5uYXZPcHRpb25zLnRvdGFsLFxyXG4gICAgICAgICAgICBkYXRhOiB0aGlzLm5hdk9wdGlvbnMuaXRlbXMsXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGNvbnN0IHt3aWR0aCwgaGVpZ2h0fSA9IHRoaXMubmF2T3B0aW9ucztcclxuICAgICAgICAvLyBkdC5yZXNpemUoeyB3aWR0aDogMzIwLCBoZWlnaHQ6IHRoaXMubmF2T3B0aW9ucy5oZWlnaHR9KTtcclxuICAgICAgICBkdC5yZXNpemUoeyB3aWR0aCwgaGVpZ2h0OiBoZWlnaHQgLSAgdGhpcy5sb29rdXBDbXAuZ2V0RmlsdGVyQmFySGVpZ2h0KCkgfSk7XHJcbiAgICAgICAgLy8g6KGM6YCJ5LitXHJcbiAgICAgICAgZHQuc2VsZWN0ZWRSb3cuc3Vic2NyaWJlKGQgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLnNlbGVjdGVkLmVtaXQoeyBkYXRhOiBkLmRhdGEgfSk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGR0LnVuU2VsZWN0Um93LnN1YnNjcmliZShkID0+IHtcclxuICAgICAgICAgICAgdGhpcy5zZWxlY3RlZC5lbWl0KG51bGwpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBjb25zdCBsb2FkVGFibGVEYXRhID0ge1xyXG4gICAgICAgICAgICBuZXh0OiAoZGF0YTogTG9va3VwR3JpZFJlc3VsdCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jbG9zZUxvYWRpbmcoKTtcclxuICAgICAgICAgICAgICAgIGRhdGFUYWJsZVJlTG9hZChkYXRhKTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHt3aWR0aCwgaGVpZ2h0fSA9IHRoaXMubmF2T3B0aW9ucztcclxuICAgICAgICAgICAgICAgIHRoaXMuY21wUmVmLmluc3RhbmNlLnJlc2l6ZSh7IHdpZHRoLCBoZWlnaHQ6IGhlaWdodCAtICB0aGlzLmxvb2t1cENtcC5nZXRGaWx0ZXJCYXJIZWlnaHQoKSB9KTtcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgZXJyb3I6IChlcnIpID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMuY2xvc2VMb2FkaW5nKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAvLyDmn6Xor6JcclxuICAgICAgICBkdC5zZWFyY2guc3Vic2NyaWJlKCBzZWFyY2hEYXRhID0+IHtcclxuICAgICAgICAgICAgY29uc3QgcDogYW55ID0geyBwYWdlSW5mbzogeyBwYWdlSW5kZXg6IDEsIHBhZ2VTaXplOiB0aGlzLm5hdk9wdGlvbnMucGFnZVNpemUgfSwgc2VhcmNoOiAnJyxuYXZDb25kaXRpb25zOiB0aGlzLm5hdkNvbmRpdGlvbnMgfTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuX3NlYXJjaFN0YXRlID0gc2VhcmNoRGF0YTtcclxuICAgICAgICAgICAgdGhpcy5zZWFyY2guZW1pdChzZWFyY2hEYXRhKTtcclxuICAgICAgICAgICAgcC5zZWFyY2ggPSBzZWFyY2hEYXRhO1xyXG4gICAgICAgICAgICBwLnBhZ2VJbmZvLnBhZ2VTaXplID0gZHQucGFnZVNpemU7XHJcbiAgICAgICAgICAgIHRoaXMubG9va3VwQ21wLm5hdmlnYXRpb25GaWx0ZXIgPSBudWxsO1xyXG5cclxuICAgICAgICAgICAgaWYgKHRoaXMuX3NvcnRTdGF0ZSAmJiB0aGlzLl9zb3J0U3RhdGUuc29ydE5hbWUpIHtcclxuICAgICAgICAgICAgICAgIHBbJ3NvcnROYW1lJ10gPSB0aGlzLl9zb3J0U3RhdGUuc29ydE5hbWU7XHJcbiAgICAgICAgICAgICAgICBwWydzb3J0T3JkZXInXSA9IHRoaXMuX3NvcnRTdGF0ZS5zb3J0T3JkZXI7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBkZWxldGUgcFsnc29ydE5hbWUnXTtcclxuICAgICAgICAgICAgICAgIGRlbGV0ZSBwWydzb3J0T3JkZXInXTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdGhpcy5sb29rdXBDbXAuaHR0cE1nci5nZXREYXRhKHAsICduYXZzZWFyY2gnKS5waXBlKFxyXG4gICAgICAgICAgICAgICAgZmlsdGVyKG4gPT4gbilcclxuICAgICAgICAgICAgKS5zdWJzY3JpYmUobG9hZFRhYmxlRGF0YSk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGNvbnN0IGRhdGFUYWJsZVJlTG9hZCA9IChkYXRhKSA9PiB7XHJcbiAgICAgICAgICAgIGR0LmxvYWREYXRhKHtcclxuICAgICAgICAgICAgICAgIHBhZ2VTaXplOiBkYXRhLnBhZ2VJbmZvLnBhZ2VTaXplLFxyXG4gICAgICAgICAgICAgICAgcGFnZUluZGV4OiBkYXRhLnBhZ2VJbmZvLnBhZ2VJbmRleCxcclxuICAgICAgICAgICAgICAgIHRvdGFsOiBkYXRhLnRvdGFsLFxyXG4gICAgICAgICAgICAgICAgZGF0YTogZGF0YS5pdGVtcyxcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICB0aGlzLnNlbGVjdExlZnREYXRhVGFibGVSb3coZGF0YS5pdGVtcywgZHQpO1xyXG4gICAgICAgICAgICBkdC5jZC5tYXJrRm9yQ2hlY2soKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAvLyDliIbpobVcclxuICAgICAgICBkdC5wYWdlQ2hhbmdlZC5zdWJzY3JpYmUoZCA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMucGFnZUNoYW5nZWQuZW1pdChkKTtcclxuICAgICAgICAgICAgdGhpcy5sb29rdXBDbXAubmF2aWdhdGlvbkZpbHRlciA9IG51bGw7XHJcbiAgICAgICAgICAgIGQubmF2Q29uZGl0aW9ucyA9IHRoaXMubmF2Q29uZGl0aW9ucyB8fCBbXTtcclxuICAgICAgICAgICAgdGhpcy5sb29rdXBDbXAuaHR0cE1nci5nZXREYXRhKGQsICduYXZzZWFyY2gnKS5zdWJzY3JpYmUobG9hZFRhYmxlRGF0YSk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGR0LnBhZ2VTaXplQ2hhbmdlZC5zdWJzY3JpYmUoKGUpID0+IHtcclxuICAgICAgICAgICAgdGhpcy5sb29rdXBDbXAubmF2aWdhdGlvbkZpbHRlciA9IG51bGw7XHJcbiAgICAgICAgICAgIGUubmF2Q29uZGl0aW9ucyA9IHRoaXMubmF2Q29uZGl0aW9ucyB8fCBbXTtcclxuICAgICAgICAgICAgdGhpcy5sb29rdXBDbXAuaHR0cE1nci5nZXREYXRhKGUsICduYXZzZWFyY2gnKS5zdWJzY3JpYmUobG9hZFRhYmxlRGF0YSk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGR0LmNvbHVtblNvcnRlZC5zdWJzY3JpYmUoIChzb3J0OiB7c29ydE5hbWU6IHN0cmluZywgc29ydE9yZGVyOiBhbnl9KSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IHsgc29ydE5hbWUsIHNvcnRPcmRlciB9ID0gey4uLnNvcnR9O1xyXG4gICAgICAgICAgICB0aGlzLl9zb3J0U3RhdGUgPSBzb3J0O1xyXG4gICAgICAgICAgICB0aGlzLmxvb2t1cENtcC5uYXZpZ2F0aW9uRmlsdGVyID0gbnVsbDtcclxuICAgICAgICAgICAgY29uc3QgcGFyYW0gPSB7IFxyXG4gICAgICAgICAgICAgICAgc29ydE5hbWUsXHJcbiAgICAgICAgICAgICAgICBzb3J0T3JkZXIsXHJcbiAgICAgICAgICAgICAgICBzZWFyY2g6IHRoaXMuX3NlYXJjaFN0YXRlLCAgXHJcbiAgICAgICAgICAgICAgICBwYWdlSW5mbzoge1xyXG4gICAgICAgICAgICAgICAgICAgIHBhZ2VTaXplOiBkdC5wYWdlU2l6ZSxcclxuICAgICAgICAgICAgICAgICAgICBwYWdlSW5kZXg6IDFcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBuYXZDb25kaXRpb25zOiB0aGlzLm5hdkNvbmRpdGlvbnMgfHwgW11cclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgdGhpcy5sb29rdXBDbXAuaHR0cE1nci5nZXREYXRhKHBhcmFtLCAnbmF2c2VhcmNoJykuc3Vic2NyaWJlKGxvYWRUYWJsZURhdGEpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBkdC5jbGVhclNlYXJjaFZhbHVlLnN1YnNjcmliZSggKCkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLl9zZWFyY2hTdGF0ZSA9IG51bGw7XHJcbiAgICAgICAgICAgIGR0LnNlYXJjaC5lbWl0KG51bGwpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICB0aGlzLnNlbGVjdExlZnREYXRhVGFibGVSb3codGhpcy5uYXZPcHRpb25zLml0ZW1zLCBkdCk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBidWlsZFBhcmFtcyhwYXJhbXM6IHt9KToge1trZXk6IHN0cmluZ106YW55fSB7XHJcbiAgICAgICAgY29uc3QgcDogYW55ID0geyBcclxuICAgICAgICAgICAgLi4ucGFyYW1zLCBcclxuICAgICAgICAgICAgdHJlZVRvTGlzdDogdGhpcy5sb29rdXBDbXAudHJlZVRvTGlzdCwgXHJcbiAgICAgICAgICAgIG5hdlRyZWVUb0xpc3Q6IHRoaXMubG9va3VwQ21wLm5hdlRyZWVUb0xpc3QsXHJcbiAgICAgICAgICAgIG5hdkNvbmRpdGlvbnM6IHRoaXMubmF2Q29uZGl0aW9ucyB8fCBbXVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHJldHVybiBwO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgaW5pdFRyZWVUYWJsZSh0dDogVHJlZVRhYmxlQ29tcG9uZW50KSB7XHJcbiAgICAgICAgdHQudmlydHVhbGl6ZWQgPSB0cnVlO1xyXG4gICAgICAgIHR0LmZhc3QgPSB0cnVlO1xyXG4gICAgICAgIHR0Lm5vZGVTZWxlY3RlZC5zdWJzY3JpYmUoZCA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWQuZW1pdCh7ZGF0YTogZC5ub2RlLmRhdGEsIG5vZGU6IGQubm9kZX0pO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICB0dC5ub2RlVW5TZWxlY3Quc3Vic2NyaWJlKGQgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLnNlbGVjdGVkLmVtaXQobnVsbCk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHR0LmZpeGVkSGVhZGVyID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgaWYgKHRoaXMubmF2T3B0aW9ucy50cmVlSW5mby5sb2FkRGF0YVR5cGUgPT09ICdhbGwnKSB7IC8vIOWIhuWxguWKoOi9veS4jeaUr+aMgeWPluaVsOaXtumFjee9ruWxleW8gOWxgue6p1xyXG4gICAgICAgICAgICB0aGlzLmxvb2t1cENtcC50cmVlTm9kZUhlbHBlci51cGRhdGVUcmVlTm9kZUV4cGFuZGVkKHRoaXMubmF2T3B0aW9ucy5pdGVtcywgdGhpcy5uYXZPcHRpb25zLnRyZWVJbmZvKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHR0LmxvYWREYXRhVHlwZSA9IHRoaXMubmF2T3B0aW9ucy50cmVlSW5mby5sb2FkRGF0YVR5cGU7XHJcbiAgICAgICAgLy8g5qOA5p+l5a6M5pW05qCR6L+H5ruk5p2h5Lu2IEJ5IEx1Y2FzIDIwMjAwMzAyXHJcbiAgICAgICAgdGhpcy5uYXZPcHRpb25zLml0ZW1zID0gdGhpcy5sb29rdXBDbXAuY2hlY2tOb2RlQ2FuQmVTZWxlY3QodGhpcy5uYXZPcHRpb25zLml0ZW1zLCB0aGlzLm5hdk9wdGlvbnMudHJlZUluZm8ubG9hZERhdGFUeXBlID09PSAnYWxsJyk7XHJcbiAgICAgICAgdHQubG9hZERhdGEodGhpcy5uYXZPcHRpb25zLml0ZW1zKTtcclxuXHJcbiAgICAgICAgaWYgKHRoaXMubG9va3VwQ21wLm5hdlNlbGVjdGVkSWRzKSB7XHJcbiAgICAgICAgICAgIHR0LnNlbGVjdE5vZGUodGhpcy5sb29rdXBDbXAubmF2U2VsZWN0ZWRJZHMpO1xyXG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy5sb29rdXBDbXAuc2VsZWN0Rmlyc3RJbk5hdikge1xyXG4gICAgICAgICAgICB0dC5zZWxlY3RGaXJzdE5vZGUoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuYWxsRGF0YSA9IHRoaXMubmF2T3B0aW9ucy5pdGVtcztcclxuXHJcbiAgICAgICAgY29uc3QgbG9hZFRyZWVEYXRhID0ge1xyXG4gICAgICAgICAgICBuZXh0OiAocmVzRGF0YTogYW55KSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNsb3NlTG9hZGluZygpO1xyXG4gICAgICAgICAgICAgICAgdHQucHNSZWYuZGlyZWN0aXZlUmVmLnNjcm9sbFRvVG9wKDApO1xyXG4gICAgICAgICAgICAgICAgdHQuY2xlYXJBbGwoKTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGl0ZW1zID0gdGhpcy5sb29rdXBDbXAuY2hlY2tOb2RlQ2FuQmVTZWxlY3QocmVzRGF0YS5pdGVtcywgdGhpcy5uYXZPcHRpb25zLnRyZWVJbmZvLmxvYWREYXRhVHlwZSA9PT0gJ2FsbCcgJiYgKCF0aGlzLl9zZWFyY2hTdGF0ZSB8fCAhdGhpcy5fc2VhcmNoU3RhdGUudmFsdWUpKTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoaXRlbXMgJiYgaXRlbXMubGVuZ3RoICYmIGl0ZW1zWzBdLmNoaWxkcmVuICYmIGl0ZW1zWzBdLmNoaWxkcmVuLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGl0ZW1zWzBdLmV4cGFuZGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICBpdGVtc1swXS5jaGlsZHJlbiA9IHRoaXMubG9va3VwQ21wLmV4cGFuZEZpcnN0Tm9kZShpdGVtc1swXS5jaGlsZHJlbik7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgdHQubG9hZERhdGEoaXRlbXMpO1xyXG4gICAgICAgICAgICAgICAgdHQucmVzaXplKCk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGVkLmVtaXQobnVsbCk7XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGVycm9yOiAoZXJyKSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNsb3NlTG9hZGluZygpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcblxyXG4gICAgICAgIHR0LnNlYXJjaC5zdWJzY3JpYmUoc2VhcmNoID0+IHtcclxuICAgICAgICAgICAgdGhpcy5fc2VhcmNoU3RhdGUgPSBzZWFyY2g7XHJcbiAgICAgICAgICAgIHRoaXMubG9va3VwQ21wLm5hdmlnYXRpb25GaWx0ZXIgPSBudWxsO1xyXG4gICAgICAgICAgICBjb25zdCBwID0gdGhpcy5idWlsZFBhcmFtcyh7IHNlYXJjaCB9KTtcclxuICAgICAgICAgIFxyXG4gICAgICAgICAgICBpZiAodGhpcy5fc29ydFN0YXRlICYmIHRoaXMuX3NvcnRTdGF0ZS5zb3J0TmFtZSkge1xyXG4gICAgICAgICAgICAgICAgcFsnc29ydE5hbWUnXSA9IHRoaXMuX3NvcnRTdGF0ZS5zb3J0TmFtZTtcclxuICAgICAgICAgICAgICAgIHBbJ3NvcnRPcmRlciddID0gdGhpcy5fc29ydFN0YXRlLnNvcnRPcmRlcjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLmxvb2t1cENtcC5odHRwTWdyLmdldERhdGEocCwgJ25hdnNlYXJjaCcpLnN1YnNjcmliZShsb2FkVHJlZURhdGEpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICB0dC5jb2x1bW5Tb3J0ZWQuc3Vic2NyaWJlKCAoc29ydDoge3NvcnROYW1lOiBzdHJpbmcsIHNvcnRPcmRlcjogYW55fSkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLmxvb2t1cENtcC5uYXZpZ2F0aW9uRmlsdGVyID0gbnVsbDtcclxuICAgICAgICAgICAgaWYgKHR0LmxvYWREYXRhVHlwZSA9PT0gJ2FsbCcpIHtcclxuICAgICAgICAgICAgICAgIHR0LmNsaWVudFNvcnQoKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGxldCB7IHNvcnROYW1lLCBzb3J0T3JkZXIgfSA9IHsuLi5zb3J0fTtcclxuXHJcbiAgICAgICAgICAgICAgICBjb25zdCBzb3J0Q29sOiBhbnkgPSB0aGlzLm5hdk9wdGlvbnMuY29sdW1ucy5maW5kKG4gPT4gbi5maWVsZCA9PT0gc29ydE5hbWUpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHNvcnRDb2wpIHtcclxuICAgICAgICAgICAgICAgICAgICBzb3J0TmFtZSA9IHNvcnRDb2xbJ2ZpZWxkUGF0aCddO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHRoaXMuX3NvcnRTdGF0ZSA9IHsgc29ydE5hbWUsIHNvcnRPcmRlciB9O1xyXG4gICAgICAgICAgICAgICAgLy8gY29uc3QgcGFyYW0gPSBPYmplY3QuYXNzaWduKHsgc29ydE5hbWUsIHNvcnRPcmRlciB9LCB0aGlzLl9zZWFyY2hTdGF0ZSk7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBwYXJhbSA9IHRoaXMuYnVpbGRQYXJhbXMoeyBzb3J0TmFtZSwgc29ydE9yZGVyLCBzZWFyY2g6IHRoaXMuX3NlYXJjaFN0YXRlIH0pO1xyXG4gICAgICAgICAgICAgICAgbGV0IHJlcXVlc3RUeXBlOiBMT0FEX0RBVEFfVFlQRSA9ICduYXYnO1xyXG4gICAgICAgICAgICAgICAgaWYgKCh0aGlzLl9zZWFyY2hTdGF0ZSAmJiB0aGlzLl9zZWFyY2hTdGF0ZS52YWx1ZSkgfHwgKHBhcmFtICYmIHBhcmFtLm5hdkNvbmRpdGlvbnMgJiYgcGFyYW0ubmF2Q29uZGl0aW9ucy5sZW5ndGgpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVxdWVzdFR5cGUgPSAnbmF2c2VhcmNoJztcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgICAgICAgICAgdGhpcy5sb29rdXBDbXAuaHR0cE1nci5nZXREYXRhKHBhcmFtLCByZXF1ZXN0VHlwZSkuc3Vic2NyaWJlKGxvYWRUcmVlRGF0YSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgdHQuY2xlYXJTZWFyY2hWYWx1ZS5zdWJzY3JpYmUoICgpID0+IHtcclxuICAgICAgICAgICAgdGhpcy5fc2VhcmNoU3RhdGUgPSBudWxsO1xyXG4gICAgICAgICAgICBpZiAoIXRoaXMuX3NvcnRTdGF0ZSB8fCAhdGhpcy5fc29ydFN0YXRlLnNvcnROYW1lKSB7XHJcbiAgICAgICAgICAgICAgICB0dC5sb2FkRGF0YSh0aGlzLmFsbERhdGEpO1xyXG4gICAgICAgICAgICAgICAgaWYgKCF0dC5zZWxlY3RlZFJvdykge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWQuZW1pdChudWxsKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHAgPSB0aGlzLmJ1aWxkUGFyYW1zKHt9KTtcclxuICAgICAgICAgICAgICAgIHRoaXMubG9va3VwQ21wLm5hdmlnYXRpb25GaWx0ZXIgPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuX3NvcnRTdGF0ZSAmJiB0aGlzLl9zb3J0U3RhdGUuc29ydE5hbWUpIHtcclxuICAgICAgICAgICAgICAgICAgICBwWydzb3J0TmFtZSddID0gdGhpcy5fc29ydFN0YXRlLnNvcnROYW1lO1xyXG4gICAgICAgICAgICAgICAgICAgIHBbJ3NvcnRPcmRlciddID0gdGhpcy5fc29ydFN0YXRlLnNvcnRPcmRlcjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHRoaXMubG9va3VwQ21wLmh0dHBNZ3IuZ2V0RGF0YShwLCAnbmF2Jykuc3Vic2NyaWJlKGxvYWRUcmVlRGF0YSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcblxyXG4gICAgICAgIHR0LmV4cGFuZC5zdWJzY3JpYmUoKHRuOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgdGhpcy5vbk5vZGVFeHBhbmRlZCh0biwgdHQpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICBwcml2YXRlIG9uTm9kZUV4cGFuZGVkKHRuOiBhbnksIHR0KSB7XHJcbiAgICAgICAgaWYgKHRuLmxlYWYpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoIXRuLmNoaWxkcmVuIHx8ICF0bi5jaGlsZHJlbi5sZW5ndGgpIHtcclxuICAgICAgICAgICAgY29uc3QgdHJlZUluZm8gPSB0aGlzLm5hdk9wdGlvbnMudHJlZUluZm87XHJcbiAgICAgICAgICAgIGlmICh0aGlzLm5hdk9wdGlvbnMudHJlZUluZm8ubG9hZERhdGFUeXBlID09PSAnYXN5bmMnKSB7XHJcbiAgICAgICAgICAgICAgICBsZXQgcGFyZW50UGF0aCA9ICcnO1xyXG4gICAgICAgICAgICAgICAgbGV0IHBhcmVudExheWVyID0gLTE7XHJcbiAgICAgICAgICAgICAgICBjb25zdCB7IGZpZWxkID0gJyonLCB2YWx1ZSA9ICcnIH0gPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLi4udHQuc2VhcmNoRGF0YVxyXG4gICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICB0blsnc2hvd0xvYWRpbmcnXSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICB0dC5kZXRlY3RDaGFuZ2VzKCk7XHJcbiAgICAgICAgICAgICAgICBpZiAodHJlZUluZm8ubGF5ZXJUeXBlID09PSAncGFyZW50SWQnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8g54i2SUTliqDovb3mlrnlvI9cclxuICAgICAgICAgICAgICAgICAgICBwYXJlbnRQYXRoID0gdG5bJ2lkJ107XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHRyZWVJbmZvRmllbGQgPSB0cmVlSW5mby5kYXRhRmllbGQ7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRyZWVJbmZvRmllbGQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gcGFyZW50UGF0aCA9IHRuLmRhdGFbdHJlZUluZm9GaWVsZF1bdHJlZUluZm8ucGF0aEZpZWxkXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gcGFyZW50TGF5ZXIgPSB0bi5kYXRhW3RyZWVJbmZvRmllbGRdW3RyZWVJbmZvLmxheWVyRmllbGRdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnRQYXRoID0gdGhpcy5sb29rdXBDbXAuZ2V0UGF0aENvZGUodG4uZGF0YSwgdHJlZUluZm8pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnRMYXllcj0gdGhpcy5sb29rdXBDbXAuZ2V0TGF5ZXJEYXRhKHRuLmRhdGEsIHRyZWVJbmZvKTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygn5pyq5om+5Yiw5YiG57qn5L+h5oGv44CCJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGlmICghdGhpcy5sb29rdXBDbXAudXJpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5sb29rdXBDbXAuZXhwYW5kVHJlZU5vZGUuZW1pdCh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGluc3RhbmNlOiB0dCwgbm9kZTogdG4sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhcmVudElkT3JQYXRoOiBwYXJlbnRQYXRoLCBwYXJlbnRMYXllciwgc2VhcmNoOiB7IHZhbHVlLCBmaWVsZCB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHRoaXMuZ2V0Q2hpbGRyZW4oXHJcbiAgICAgICAgICAgICAgICAgICAgcGFyZW50UGF0aCwgcGFyZW50TGF5ZXIsIHtzZWFyY2hGaWVsZDogZmllbGQgPT09ICcqJyA/ICcqJyA6IGZpZWxkLCBzZWFyY2hWYWx1ZTogdmFsdWV9LCB0dFxyXG4gICAgICAgICAgICAgICAgKS5waXBlKFxyXG4gICAgICAgICAgICAgICAgICAgIHN3aXRjaE1hcCgoZGF0YTogYW55KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkYXRhICYmIGRhdGEuaXRlbXMgJiYgZGF0YS5pdGVtcy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBvZihkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmdldENoaWxkcmVuKHBhcmVudFBhdGgsIHBhcmVudExheWVyLCB7IHNlYXJjaEZpZWxkOiAnKicsIHNlYXJjaFZhbHVlOiAnJyAgfSwgdHQsIHRydWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICkuc3Vic2NyaWJlKGRhdGEgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0dCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodG4gJiYgZGF0YS5pdGVtcyAmJiBkYXRhLml0ZW1zLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHQuYXBwZW5kQ2hpbGRyZW4oZGF0YS5pdGVtcywgdG4pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRuWydzaG93TG9hZGluZyddID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHR0LmRldGVjdENoYW5nZXMoKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGdldENoaWxkcmVuKCBwYXJlbnRQYXRoLCBwYXJlbnRMYXllciwgc2VhcmNoRGF0YTogeyBzZWFyY2hGaWVsZDogc3RyaW5nOyBzZWFyY2hWYWx1ZTogc3RyaW5nIH0sIHR0LCBhbGwgPSBmYWxzZSApOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgICAgIGNvbnN0IHVyaSA9IHRoaXMubG9va3VwQ21wLmdyaWRPcHRpb25zLnVyaTtcclxuICAgICAgICBjb25zdCBzZWFyY2ggPSB7IHBhcmVudExheWVyLCBjYXRlZ29yeTogJ25hdmNoaWxkcmVuJywgLi4uc2VhcmNoRGF0YSB9O1xyXG4gICAgICAgIGlmICh0aGlzLm5hdk9wdGlvbnMudHJlZUluZm8ubGF5ZXJUeXBlID09PSAncGFyZW50SWQnKSB7XHJcbiAgICAgICAgICAgIHNlYXJjaFsncGFyZW50SWQnXSA9IHBhcmVudFBhdGg7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgc2VhcmNoWydwYXJlbnRQYXRoJ10gPSBwYXJlbnRQYXRoO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgcGFyYW06IGFueSA9IHRoaXMuYnVpbGRQYXJhbXMoe1xyXG4gICAgICAgICAgICBzZWFyY2hWYWx1ZTogSlNPTi5zdHJpbmdpZnkoc2VhcmNoKSxcclxuICAgICAgICAgICAgY3VzdG9tRGF0YTogdGhpcy5sb29rdXBDbXAuY3VzdG9tRGF0YSxcclxuICAgICAgICAgICAgZW5hYmxlRnVsbFRyZWU6IGZhbHNlLFxyXG4gICAgICAgICAgICBsb2FkVHJlZURhdGFUeXBlOiAnbGF5ZXJsb2FkJyxcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaWYgKHRoaXMubG9va3VwQ21wLmhlbHBJZCkge1xyXG4gICAgICAgICAgICBwYXJhbVsnaGVscElkJ10gPSB0aGlzLmxvb2t1cENtcC5oZWxwSWQ7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodHQgJiYgdHQuc29ydE5hbWUpIHtcclxuICAgICAgICAgICAgbGV0IHNvcnROYW1lID0gdHQuc29ydE5hbWU7XHJcbiAgICAgICAgICAgIGNvbnN0IHNvcnRDb2w6IGFueSA9IHRoaXMubmF2T3B0aW9ucy5jb2x1bW5zLmZpbmQobiA9PiBuLmZpZWxkID09PSB0dC5zb3J0TmFtZSk7XHJcbiAgICAgICAgICAgIGlmIChzb3J0Q29sKSB7XHJcbiAgICAgICAgICAgICAgICBzb3J0TmFtZSA9IHNvcnRDb2xbJ2ZpZWxkUGF0aCddO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBzZWFyY2hbJ3NvcnROYW1lJ10gPSBzb3J0TmFtZTtcclxuICAgICAgICAgICAgc2VhcmNoWydzb3J0T3JkZXInXSA9IHR0LnNvcnRPcmRlcjtcclxuICAgICAgICAgICAgcGFyYW0uc2VhcmNoVmFsdWUgPSBKU09OLnN0cmluZ2lmeShzZWFyY2gpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHRoaXMubmF2Q29uZGl0aW9ucyAmJiB0aGlzLm5hdkNvbmRpdGlvbnMubGVuZ3RoICYmICFhbGwpIHtcclxuICAgICAgICAgICAgcGFyYW0ubmF2U2VhcmNoQ29uZGl0aW9ucyA9IHRoaXMubmF2Q29uZGl0aW9ucztcclxuICAgICAgICB9XHJcbiAgICAgICAgZGVsZXRlIHBhcmFtLm5hdkNvbmRpdGlvbnM7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMubG9va3VwQ21wLmh0dHAuZ2V0RGF0YSh1cmkgLCBwYXJhbSk7XHJcbiAgICB9XHJcblxyXG5cclxuICAgIGxvYWREYXRhKCkge1xyXG4gICAgICAgIHRoaXMuY21wUmVmLmluc3RhbmNlLmFsbENvbHVtbnNUaXRsZSA9IHRoaXMubG9va3VwQ21wLmFsbENvbHVtbnNUaXRsZTtcclxuICAgICAgICBpZiAoIXRoaXMuaXNUcmVlTGlzdCgpKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGR0ID0gdGhpcy5jbXBSZWYuaW5zdGFuY2UgYXMgRGF0YVRhYmxlQ29tcG9uZW50O1xyXG4gICAgICAgICAgICB0aGlzLmluaXREYXRhVGFibGUoZHQpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHR0ID0gdGhpcy5jbXBSZWYuaW5zdGFuY2UgYXMgVHJlZVRhYmxlQ29tcG9uZW50O1xyXG4gICAgICAgICAgICB0aGlzLmluaXRUcmVlVGFibGUodHQpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBvbkNvbmRpdGlvbnNDaGFuZ2UoJGV2ZW50KSB7XHJcbiAgICAgICAgdGhpcy5uYXZDb25kaXRpb25zID0gJGV2ZW50O1xyXG4gICAgICAgIGlmICh0aGlzLmlzVHJlZUxpc3QoKSkge1xyXG4gICAgICAgICAgICBjb25zdCB0dCA9IHRoaXMuY21wUmVmLmluc3RhbmNlIGFzIFRyZWVUYWJsZUNvbXBvbmVudDtcclxuICAgICAgICAgICAgdHQuc2VhcmNoLmVtaXQoKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBjb25zdCBkdCA9IHRoaXMuY21wUmVmLmluc3RhbmNlIGFzIERhdGFUYWJsZUNvbXBvbmVudDtcclxuICAgICAgICAgICAgZHQuc2VhcmNoLmVtaXQoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuIl19
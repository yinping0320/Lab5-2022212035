/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { fromEvent, of, race } from 'rxjs';
import { buffer, bufferCount, debounceTime, filter, first, map, repeat } from 'rxjs/operators';
export class LookupDialogManager {
    /**
     * @param {?} ins
     */
    constructor(ins) {
        this.ins = ins;
        this.lookupInit = null;
        this._loadDataWhenOpen = true;
        this._navSelectedId = '';
        this._selectFirstInNav = false;
        this.dialogClosedSubscription = null;
        this.dialogOpenedSubscription = null;
        this.keyDownHandler = null;
        this._okbtnclick$ = null;
    }
    /**
     * @private
     * @return {?}
     */
    unsubscribes() {
        if (this.lookupInit) {
            this.lookupInit.unsubscribe();
            this.lookupInit = null;
        }
        if (this.dialogClosedSubscription) {
            this.dialogClosedSubscription.unsubscribe();
            this.dialogClosedSubscription = null;
        }
        if (this.dialogOpenedSubscription) {
            this.dialogOpenedSubscription.unsubscribe();
            this.dialogOpenedSubscription = null;
        }
    }
    // 帮助窗口关闭后做一些清理工作
    /**
     * @return {?}
     */
    dialogClosed() {
        if (this.ins.displayText !== this.ins.originalText && !this.ins.nosearch) {
            this.ins.displayText = this.ins.originalText;
            this.ins.setModelValue(this.ins.displayText);
        }
        if (this.ins.componentRef) {
            this.ins.componentRef.destroy();
            this.ins.componentRef = null;
        }
        if (this.ins.favoritesComponentRef) {
            this.ins.favoritesComponentRef.destroy();
            this.ins.favoritesComponentRef = null;
        }
        if (this.ins.contentContainer) {
            this.ins.contentContainer.clear();
        }
        if (this.ins.centerContainer) {
            this.ins.centerContainer.clear();
        }
        if (this.ins.leftComponentRef) {
            this.ins.leftComponentRef.destroy();
            this.ins.leftComponentRef = null;
        }
        if (this.ins.leftContainer) {
            this.ins.leftContainer.clear();
        }
        this.ins.isShow = false;
        this.ins.isTextChange = false;
        if (this.ins.dialog) {
            this.ins.content = null;
        }
        this.ins.navigationFilter = null;
        this.ins.lookupUtils.pendingEnd();
        if (this.ins.helpId) {
            this.ins.displayType = '';
        }
        this.unsubscribes();
        // this.ins.items = [];
        this.ins.favoriteItems = [];
        this.ins.lookupSelectionSer.initFavoriteItems([]);
        this.ins.isTabChanged = false;
        if (this.ins.uri) {
            this.ins.items = [];
        }
        this.ins._searchState = null;
        this.ins.pageIndex = 1;
        this.ins.loadDataWhenOpen = this._loadDataWhenOpen;
        this.ins.navSelectedIds = this._navSelectedId;
        this.ins.selectFirstInNav = this._selectFirstInNav;
        this.ins.isGetAllChidlNodes = false;
        this.ins.enableGetAllChildNodes = true;
        // 保存个性化数据
        if (this.ins.usePersionalConf && this.ins.favoriteDataFrom !== 'locale') {
            this.ins.httpMgr.submitFavoriteData('dialog closed event.');
        }
        if (this.keyDownHandler) {
            this.keyDownHandler();
            this.keyDownHandler = null;
        }
        if (this.ins.inputGroup) {
            this.ins.inputGroup.focus();
        }
        this.ins.userInitialConfig.reset();
        this.ins.treeInfo = this.ins._treeInfo_;
        this.ins.lookupUtils.destroy();
        this.ins.dialogClosed.emit();
        if (this.ins.includeSubordinates$$) {
            this.ins.includeSubordinates$$.unsubscribe();
            this.ins.includeSubordinates$$ = null;
        }
        this.ins.conditions = [];
        this.ins.searching = false;
        if (this.ins.dtEventMgr) {
            this.ins.dtEventMgr['_sortState'] = null;
        }
        if (this.ins.ttEventMgr) {
            this.ins.ttEventMgr['_sortState'] = null;
        }
        if (this._okbtnclick$) {
            this._okbtnclick$.unsubscribe();
            this._okbtnclick$ = null;
        }
    }
    /**
     * @return {?}
     */
    onDialogCreated() {
        this._loadDataWhenOpen = this.ins.loadDataWhenOpen;
        this._navSelectedId = this.ins.navSelectedIds;
        this._selectFirstInNav = this.ins.selectFirstInNav;
        this.ins.dialogCreatedSubscription = this.ins.dialogCreated.subscribe((/**
         * @param {?} dlg
         * @return {?}
         */
        dlg => {
            if (dlg) {
                this.ins.setContainerMargin();
                if (this.ins.dialogOpenedSubscription) {
                    this.ins.dialogOpenedSubscription.unsubscribe();
                }
                if (this.ins.dialogClosedSubscription) {
                    this.ins.dialogClosedSubscription.unsubscribe();
                }
                this.registerDialogEvent();
                if (this.ins.isRecordSize) {
                    /** @type {?} */
                    const dlgSize = this.ins.personalConfigService.getDialogSize();
                    if (dlgSize) {
                        const { width, height } = dlgSize;
                        this.ins.dialogWidth = width ? width : this.ins.dialogWidth;
                        this.ins.dialogHeight = height ? height : this.ins.dialogHeight;
                        // 20200908 更新现窗口的尺寸 by Lucas
                        dlg.width = this.ins.dialogWidth;
                        dlg.height = this.ins.dialogHeight;
                    }
                }
                dlg.show();
            }
        }));
        this.ins.subscriptions.push(this.ins.dialogCreatedSubscription);
    }
    /**
     * @param {?} pr
     * @return {?}
     */
    checkDictPickingResult(pr) {
        /** @type {?} */
        let o = true;
        if (pr === undefined || pr === null || pr === '') {
            o = true;
        }
        if (typeof pr === 'boolean') {
            o = pr;
        }
        /** @type {?} */
        let customData;
        /** @type {?} */
        let selectedIds;
        /** @type {?} */
        let message;
        customData = this.ins.customData;
        selectedIds = this.ins.selectedIds;
        if (typeof pr === 'object') {
            if (pr.showDialog === undefined) {
                o = true;
            }
            else {
                o = pr.showDialog;
            }
            if (pr.hasOwnProperty('data')) {
                /** 保存帮助前传递的数据 */
                customData = pr.data;
            }
            selectedIds = pr.selectedIds || null;
            if (pr.message) {
                message = pr.message;
            }
        }
        return { show: o, customData, selectedIds, message };
    }
    /**
     * @param {?} pr
     * @return {?}
     */
    canOpenDialog(pr) {
        const { show, customData, selectedIds, message } = this.checkDictPickingResult(pr);
        this.ins.customData = customData;
        this.ins.selectedIds = selectedIds || null;
        if (message) {
            this.ins.notifyService.warning(message);
        }
        this.ins.isReady = false;
        this.ins.isShow = show;
    }
    /**
     * @return {?}
     */
    getHeight() {
        return this.ins.dialog.size.contentHeight -
            this.ins.containerMargin.bottom -
            this.ins.containerMargin.top -
            (!this.ins.useNewLayout ? (this.ins.useFavorite ? 40 : 0) : 56);
    }
    /**
     * @private
     * @return {?}
     */
    getMainGridSize() {
        if (this.ins.isDoublleList()) {
            return {
                width: this.ins.dialog.size.width - this.ins.leftPanel.width - 27,
                height: this.getHeight()
            };
        }
        return {
            width: this.ins.dialog.size.width - this.ins.containerMargin.left - this.ins.containerMargin.right,
            height: this.getHeight()
        };
    }
    /**
     * @return {?}
     */
    resetDialogContentHeight() {
        const { header: hHeight, footer: fHeight } = this.ins.dialog.size;
        return this.ins.dialogHeight - hHeight - fHeight - this.ins.containerMargin.bottom - this.ins.containerMargin.top;
    }
    /**
     * @private
     * @return {?}
     */
    registerOkBtnEvent() {
        if (this.ins.okButton) {
            /** @type {?} */
            const doubleClickDuration = 250;
            /** @type {?} */
            const leftClick$ = fromEvent(this.ins.okButton.nativeElement, 'click').pipe(filter((/**
             * @param {?} event
             * @return {?}
             */
            (event) => event.button === 0)));
            /** @type {?} */
            const debounce$ = leftClick$.pipe(debounceTime(doubleClickDuration));
            /** @type {?} */
            const clickLimit$ = leftClick$.pipe(bufferCount(2));
            /** @type {?} */
            const bufferGate$ = race(debounce$, clickLimit$)
                .pipe(
            // We are only interested in the first event. After that
            // we want to restart.
            first(), repeat());
            this._okbtnclick$ = leftClick$.pipe(buffer(bufferGate$), 
            // Here we map the buffered events into the length of the buffer
            // If the user clicked once, the buffer is 1. If he clicked twice it is 2
            map((/**
             * @param {?} clicks
             * @return {?}
             */
            clicks => clicks.length))).subscribe((/**
             * @param {?} clicks
             * @return {?}
             */
            clicks => {
                this.ins.selectItem();
            }));
        }
    }
    /**
     * 注册弹出窗口的事件
     * @private
     * @return {?}
     */
    registerDialogEvent() {
        this.dialogOpenedSubscription = this.ins.dialog.opened.subscribe((/**
         * @return {?}
         */
        () => {
            this.ins.dialogContentHeight = this.resetDialogContentHeight();
            this.ins.gridOptions = Object.assign(this.ins.gridOptions, this.getMainGridSize());
            this.ins.dialog.el.nativeElement.querySelector('.ps-content').style.height = '100%';
            if (this.ins.displayType && this.ins.customDisplayType) {
                this.ins.componentRef = this.ins.lookupCmpMgr.createContent(this.ins.gridOptions);
                this.ins.lookupCmpMgr.createFavoriteComponent();
            }
            this.ins.initData();
            // 修改帮助窗口的状态
            this.ins.lookupUtils.pendingEnd();
            this.ins.dialogOpened.emit();
            // 注册确定按钮点击事件
            this.registerOkBtnEvent();
        }));
        this.lookupInit = this.ins.lookupinitializationSubject.subscribe((/**
         * @return {?}
         */
        () => {
            this.ins.loadDataWhenOpen = true;
            // 注册快捷键
            this.registerShortcutKey();
            // 监听左侧尺寸变化事件
            if (this.ins.leftPanel) {
                if (!this.ins.leftPanel.resizing.observers.length) {
                    /** @type {?} */
                    const leftPanelResize$ = this.ins.leftPanel.resizing.pipe(debounceTime(50)).subscribe((/**
                     * @param {?} s
                     * @return {?}
                     */
                    (s) => {
                        /** @type {?} */
                        const size = {
                            width: this.ins.dialog.size.width - s.size.width - this.ins.getSpaceWidth(true),
                            height: this.getHeight() - this.ins.getFilterBarHeight()
                        };
                        this.ins.componentRef.instance.resize(size);
                        this.ins.leftComponentRef.instance.resize(s.size);
                    }));
                    this.ins.subscriptions.push(leftPanelResize$);
                }
                if (this.ins.isDoublleList() && this.ins.leftComponentRef) {
                    this.ins.leftComponentRef.instance.updateScrollPosition();
                }
            }
            if (this.ins.cascadeSelect) {
                const { selectEl, panelRef } = this.ins.cascadeSelect;
                this.ins.cascadeSelect.beforeShow = (/**
                 * @return {?}
                 */
                () => {
                    if (selectEl && panelRef) {
                        panelRef.style.left = `${selectEl.offsetLeft}px`;
                        if (this.ins.localService.localeId.toLocaleLowerCase() == 'en') {
                            panelRef.style.width = 'auto';
                            panelRef.style.maxWidth = '200px';
                        }
                        return of(true);
                    }
                });
            }
        }));
        this.dialogClosedSubscription = this.ins.dialog.closed.subscribe((/**
         * @return {?}
         */
        () => {
            // 输入框变化后，弹出窗口未选择数据关闭窗口时，还原原始值
            this.ins.dialogMgr.dialogClosed();
        }));
        // this.ins.subscriptions.push(this.ins.dialogClosedSubscription);
    }
    /**
     * @private
     * @return {?}
     */
    registerShortcutKey() {
        // 回车，与确定按钮处理逻辑一至。
        /** @type {?} */
        const dlgContainerDom = this.ins.dialog.el.nativeElement.querySelector('.farris-modal');
        if (dlgContainerDom && this.ins.shortcutKey && !this.keyDownHandler) {
            this.keyDownHandler = this.ins.eventManager.addEventListener(dlgContainerDom, 'keydown', (/**
             * @param {?} e
             * @return {?}
             */
            (e) => {
                e.stopPropagation();
                const { moveUp, moveDown, searchFocus, confirm, nextPager, prevPager, expand, collapse } = this.ins.shortcutKey;
                /** @type {?} */
                const arrowKey = [moveUp, moveDown, expand, collapse];
                if (arrowKey.includes(e.code)) {
                    this.ins.componentRef.instance.onKeydownEvent(e);
                }
                else if (e.key === confirm) {
                    if (e.target['nodeName'] === 'INPUT' && !e.ctrlKey) {
                        return;
                    }
                    this.ins.okButton.nativeElement.click();
                }
                else if (e.code === searchFocus) { // 帮助窗口查询输入框焦点
                    e.preventDefault();
                    this.ins.componentRef.instance.inputGroup.focus();
                }
                else if (!this.ins.isTree() && (e.code === nextPager || e.code === prevPager)) { // 分页
                    // 分页
                    /** @type {?} */
                    const isNextPager = e.code === nextPager;
                    this.paginationKeyDownHandler(isNextPager);
                }
            }));
        }
    }
    /**
     * @private
     * @param {?=} next
     * @return {?}
     */
    paginationKeyDownHandler(next = true) {
        /** @type {?} */
        const datatableRef = this.ins.componentRef.instance;
        const { pageIndex, pageSize, total } = datatableRef;
        /** @type {?} */
        const pagerCount = Math.ceil(total / pageSize);
        /** @type {?} */
        let newPageNum = pageIndex;
        if (next) {
            newPageNum = newPageNum + 1;
        }
        else {
            newPageNum = newPageNum - 1;
        }
        if (newPageNum > pagerCount || newPageNum < 1) {
            newPageNum = pageIndex;
        }
        this.ins.componentRef.instance.onPageChange({ pageSize, pageIndex: newPageNum });
    }
}
if (false) {
    /**
     * @type {?}
     * @private
     */
    LookupDialogManager.prototype.lookupInit;
    /**
     * @type {?}
     * @private
     */
    LookupDialogManager.prototype._loadDataWhenOpen;
    /**
     * @type {?}
     * @private
     */
    LookupDialogManager.prototype._navSelectedId;
    /**
     * @type {?}
     * @private
     */
    LookupDialogManager.prototype._selectFirstInNav;
    /**
     * @type {?}
     * @private
     */
    LookupDialogManager.prototype.dialogClosedSubscription;
    /**
     * @type {?}
     * @private
     */
    LookupDialogManager.prototype.dialogOpenedSubscription;
    /**
     * @type {?}
     * @private
     */
    LookupDialogManager.prototype.keyDownHandler;
    /**
     * @type {?}
     * @private
     */
    LookupDialogManager.prototype._okbtnclick$;
    /**
     * @type {?}
     * @private
     */
    LookupDialogManager.prototype.ins;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGlhbG9nLW1hbmdhZ2VyLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy91aS1sb29rdXAvIiwic291cmNlcyI6WyJsaWIvc2VydmljZXMvZGlhbG9nLW1hbmdhZ2VyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFDQSxPQUFPLEVBQUUsU0FBUyxFQUFFLEVBQUUsRUFBRSxJQUFJLEVBQWdCLE1BQU0sTUFBTSxDQUFDO0FBQ3pELE9BQU8sRUFBRSxNQUFNLEVBQUUsV0FBVyxFQUFFLFlBQVksRUFBRSxNQUFNLEVBQUUsS0FBSyxFQUFFLEdBQUcsRUFBRSxNQUFNLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUkvRixNQUFNLE9BQU8sbUJBQW1COzs7O0lBWTVCLFlBQW9CLEdBQXdCO1FBQXhCLFFBQUcsR0FBSCxHQUFHLENBQXFCO1FBVnBDLGVBQVUsR0FBaUIsSUFBSSxDQUFDO1FBQ2hDLHNCQUFpQixHQUFHLElBQUksQ0FBQztRQUN6QixtQkFBYyxHQUFHLEVBQUUsQ0FBQztRQUNwQixzQkFBaUIsR0FBRyxLQUFLLENBQUM7UUFDMUIsNkJBQXdCLEdBQWlCLElBQUksQ0FBQztRQUM5Qyw2QkFBd0IsR0FBaUIsSUFBSSxDQUFDO1FBRTlDLG1CQUFjLEdBQUcsSUFBSSxDQUFDO1FBQ3RCLGlCQUFZLEdBQWlCLElBQUksQ0FBQztJQUVNLENBQUM7Ozs7O0lBRXpDLFlBQVk7UUFDaEIsSUFBSSxJQUFJLENBQUMsVUFBVSxFQUFFO1lBQ2pCLElBQUksQ0FBQyxVQUFVLENBQUMsV0FBVyxFQUFFLENBQUM7WUFDOUIsSUFBSSxDQUFDLFVBQVUsR0FBRyxJQUFJLENBQUM7U0FDMUI7UUFFRCxJQUFJLElBQUksQ0FBQyx3QkFBd0IsRUFBRTtZQUMvQixJQUFJLENBQUMsd0JBQXdCLENBQUMsV0FBVyxFQUFFLENBQUM7WUFDNUMsSUFBSSxDQUFDLHdCQUF3QixHQUFHLElBQUksQ0FBQztTQUN4QztRQUVELElBQUksSUFBSSxDQUFDLHdCQUF3QixFQUFF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SSxJQUFJLEVBQUU7WUFDTixVQUFVLEdBQUcsVUFBVSxHQUFHLENBQUMsQ0FBQztTQUMvQjthQUFNO1lBQ0gsVUFBVSxHQUFHLFVBQVUsR0FBRyxDQUFDLENBQUM7U0FDL0I7UUFFRCxJQUFJLFVBQVUsR0FBRyxVQUFVLElBQUksVUFBVSxHQUFHLENBQUMsRUFBRTtZQUMzQyxVQUFVLEdBQUcsU0FBUyxDQUFDO1NBQzFCO1FBRUQsSUFBSSxDQUFDLEdBQUcsQ0FBQyxZQUFZLENBQUMsUUFBUSxDQUFDLFlBQVksQ0FBQyxFQUFFLFFBQVEsRUFBRSxTQUFTLEVBQUUsVUFBVSxFQUFFLENBQUMsQ0FBQztJQUNyRixDQUFDO0NBRUo7Ozs7OztJQWhaRyx5Q0FBd0M7Ozs7O0lBQ3hDLGdEQUFpQzs7Ozs7SUFDakMsNkNBQTRCOzs7OztJQUM1QixnREFBa0M7Ozs7O0lBQ2xDLHVEQUFzRDs7Ozs7SUFDdEQsdURBQXNEOzs7OztJQUV0RCw2Q0FBOEI7Ozs7O0lBQzlCLDJDQUEwQzs7Ozs7SUFFOUIsa0NBQWdDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUmVuZGVyZXJTdHlsZUZsYWdzMiB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBmcm9tRXZlbnQsIG9mLCByYWNlLCBTdWJzY3JpcHRpb24gfSBmcm9tICdyeGpzJztcclxuaW1wb3J0IHsgYnVmZmVyLCBidWZmZXJDb3VudCwgZGVib3VuY2VUaW1lLCBmaWx0ZXIsIGZpcnN0LCBtYXAsIHJlcGVhdCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcclxuaW1wb3J0IHsgUGlja2luZ1Jlc3VsdCB9IGZyb20gJy4uL2xvb2t1cC1ncmlkLW9wdGlvbnMnO1xyXG5pbXBvcnQgeyBMb29rdXBHcmlkQ29tcG9uZW50IH0gZnJvbSAnLi4vbG9va3VwLWdyaWQuY29tcG9uZW50JztcclxuXHJcbmV4cG9ydCBjbGFzcyBMb29rdXBEaWFsb2dNYW5hZ2VyIHtcclxuXHJcbiAgICBwcml2YXRlIGxvb2t1cEluaXQ6IFN1YnNjcmlwdGlvbiA9IG51bGw7XHJcbiAgICBwcml2YXRlIF9sb2FkRGF0YVdoZW5PcGVuID0gdHJ1ZTtcclxuICAgIHByaXZhdGUgX25hdlNlbGVjdGVkSWQgPSAnJztcclxuICAgIHByaXZhdGUgX3NlbGVjdEZpcnN0SW5OYXYgPSBmYWxzZTtcclxuICAgIHByaXZhdGUgZGlhbG9nQ2xvc2VkU3Vic2NyaXB0aW9uOiBTdWJzY3JpcHRpb24gPSBudWxsO1xyXG4gICAgcHJpdmF0ZSBkaWFsb2dPcGVuZWRTdWJzY3JpcHRpb246IFN1YnNjcmlwdGlvbiA9IG51bGw7XHJcbiAgICBcclxuICAgIHByaXZhdGUga2V5RG93bkhhbmRsZXIgPSBudWxsO1xyXG4gICAgcHJpdmF0ZSBfb2tidG5jbGljayQ6IFN1YnNjcmlwdGlvbiA9IG51bGw7XHJcblxyXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBpbnM6IExvb2t1cEdyaWRDb21wb25lbnQpIHsgfVxyXG5cclxuICAgIHByaXZhdGUgdW5zdWJzY3JpYmVzKCl7XHJcbiAgICAgICAgaWYgKHRoaXMubG9va3VwSW5pdCkge1xyXG4gICAgICAgICAgICB0aGlzLmxvb2t1cEluaXQudW5zdWJzY3JpYmUoKTtcclxuICAgICAgICAgICAgdGhpcy5sb29rdXBJbml0ID0gbnVsbDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh0aGlzLmRpYWxvZ0Nsb3NlZFN1YnNjcmlwdGlvbikge1xyXG4gICAgICAgICAgICB0aGlzLmRpYWxvZ0Nsb3NlZFN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xyXG4gICAgICAgICAgICB0aGlzLmRpYWxvZ0Nsb3NlZFN1YnNjcmlwdGlvbiA9IG51bGw7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodGhpcy5kaWFsb2dPcGVuZWRTdWJzY3JpcHRpb24pIHtcclxuICAgICAgICAgICAgdGhpcy5kaWFsb2dPcGVuZWRTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcclxuICAgICAgICAgICAgdGhpcy5kaWFsb2dPcGVuZWRTdWJzY3JpcHRpb24gPSBudWxsO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICB9XHJcbiAgICAvLyDluK7liqnnqpflj6PlhbPpl63lkI7lgZrkuIDkupvmuIXnkIblt6XkvZxcclxuICAgIGRpYWxvZ0Nsb3NlZCgpIHtcclxuICAgICAgICBpZiAodGhpcy5pbnMuZGlzcGxheVRleHQgIT09IHRoaXMuaW5zLm9yaWdpbmFsVGV4dCAmJiAhdGhpcy5pbnMubm9zZWFyY2gpIHtcclxuICAgICAgICAgICAgdGhpcy5pbnMuZGlzcGxheVRleHQgPSB0aGlzLmlucy5vcmlnaW5hbFRleHQ7XHJcbiAgICAgICAgICAgIHRoaXMuaW5zLnNldE1vZGVsVmFsdWUodGhpcy5pbnMuZGlzcGxheVRleHQpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGhpcy5pbnMuY29tcG9uZW50UmVmKSB7XHJcbiAgICAgICAgICAgIHRoaXMuaW5zLmNvbXBvbmVudFJlZi5kZXN0cm95KCk7XHJcbiAgICAgICAgICAgIHRoaXMuaW5zLmNvbXBvbmVudFJlZiA9IG51bGw7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodGhpcy5pbnMuZmF2b3JpdGVzQ29tcG9uZW50UmVmKSB7XHJcbiAgICAgICAgICAgIHRoaXMuaW5zLmZhdm9yaXRlc0NvbXBvbmVudFJlZi5kZXN0cm95KCk7XHJcbiAgICAgICAgICAgIHRoaXMuaW5zLmZhdm9yaXRlc0NvbXBvbmVudFJlZiA9IG51bGw7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodGhpcy5pbnMuY29udGVudENvbnRhaW5lcikge1xyXG4gICAgICAgICAgICB0aGlzLmlucy5jb250ZW50Q29udGFpbmVyLmNsZWFyKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodGhpcy5pbnMuY2VudGVyQ29udGFpbmVyKSB7XHJcbiAgICAgICAgICAgIHRoaXMuaW5zLmNlbnRlckNvbnRhaW5lci5jbGVhcigpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHRoaXMuaW5zLmxlZnRDb21wb25lbnRSZWYpIHtcclxuICAgICAgICAgICAgdGhpcy5pbnMubGVmdENvbXBvbmVudFJlZi5kZXN0cm95KCk7XHJcbiAgICAgICAgICAgIHRoaXMuaW5zLmxlZnRDb21wb25lbnRSZWYgPSBudWxsO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHRoaXMuaW5zLmxlZnRDb250YWluZXIpIHtcclxuICAgICAgICAgICAgdGhpcy5pbnMubGVmdENvbnRhaW5lci5jbGVhcigpO1xyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIHRoaXMuaW5zLmlzU2hvdyA9IGZhbHNlO1xyXG4gICAgICAgIHRoaXMuaW5zLmlzVGV4dENoYW5nZSA9IGZhbHNlO1xyXG4gICAgICAgIGlmICh0aGlzLmlucy5kaWFsb2cpIHtcclxuICAgICAgICAgICAgdGhpcy5pbnMuY29udGVudCA9IG51bGw7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLmlucy5uYXZpZ2F0aW9uRmlsdGVyID0gbnVsbDtcclxuXHJcbiAgICAgICAgdGhpcy5pbnMubG9va3VwVXRpbHMucGVuZGluZ0VuZCgpO1xyXG5cclxuICAgICAgICBpZiAodGhpcy5pbnMuaGVscElkKSB7XHJcbiAgICAgICAgICAgIHRoaXMuaW5zLmRpc3BsYXlUeXBlID0gJyc7XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgdGhpcy51bnN1YnNjcmliZXMoKTtcclxuXHJcbiAgICAgICAgLy8gdGhpcy5pbnMuaXRlbXMgPSBbXTtcclxuICAgICAgICB0aGlzLmlucy5mYXZvcml0ZUl0ZW1zID0gW107XHJcbiAgICAgICAgdGhpcy5pbnMubG9va3VwU2VsZWN0aW9uU2VyLmluaXRGYXZvcml0ZUl0ZW1zKFtdKTtcclxuXHJcbiAgICAgICAgdGhpcy5pbnMuaXNUYWJDaGFuZ2VkID0gZmFsc2U7XHJcblxyXG4gICAgICAgIGlmICh0aGlzLmlucy51cmkpIHtcclxuICAgICAgICAgICAgdGhpcy5pbnMuaXRlbXMgPSBbXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5pbnMuX3NlYXJjaFN0YXRlID0gbnVsbDtcclxuXHJcblxyXG4gICAgICAgIHRoaXMuaW5zLnBhZ2VJbmRleCA9IDE7XHJcblxyXG4gICAgICAgIHRoaXMuaW5zLmxvYWREYXRhV2hlbk9wZW4gPSB0aGlzLl9sb2FkRGF0YVdoZW5PcGVuO1xyXG4gICAgICAgIHRoaXMuaW5zLm5hdlNlbGVjdGVkSWRzID0gdGhpcy5fbmF2U2VsZWN0ZWRJZDtcclxuICAgICAgICB0aGlzLmlucy5zZWxlY3RGaXJzdEluTmF2ID0gdGhpcy5fc2VsZWN0Rmlyc3RJbk5hdjtcclxuXHJcbiAgICAgICAgdGhpcy5pbnMuaXNHZXRBbGxDaGlkbE5vZGVzID0gZmFsc2U7XHJcblxyXG4gICAgICAgIHRoaXMuaW5zLmVuYWJsZUdldEFsbENoaWxkTm9kZXMgPSB0cnVlO1xyXG5cclxuICAgICAgICAvLyDkv53lrZjkuKrmgKfljJbmlbDmja5cclxuICAgICAgICBpZiAodGhpcy5pbnMudXNlUGVyc2lvbmFsQ29uZiAmJiB0aGlzLmlucy5mYXZvcml0ZURhdGFGcm9tICE9PSAnbG9jYWxlJykge1xyXG4gICAgICAgICAgICB0aGlzLmlucy5odHRwTWdyLnN1Ym1pdEZhdm9yaXRlRGF0YSgnZGlhbG9nIGNsb3NlZCBldmVudC4nKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh0aGlzLmtleURvd25IYW5kbGVyKSB7XHJcbiAgICAgICAgICAgIHRoaXMua2V5RG93bkhhbmRsZXIoKTtcclxuICAgICAgICAgICAgdGhpcy5rZXlEb3duSGFuZGxlciA9IG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0aGlzLmlucy5pbnB1dEdyb3VwKSB7XHJcbiAgICAgICAgICAgIHRoaXMuaW5zLmlucHV0R3JvdXAuZm9jdXMoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuaW5zLnVzZXJJbml0aWFsQ29uZmlnLnJlc2V0KCk7XHJcblxyXG4gICAgICAgIHRoaXMuaW5zLnRyZWVJbmZvID0gdGhpcy5pbnMuX3RyZWVJbmZvXztcclxuXHJcbiAgICAgICAgdGhpcy5pbnMubG9va3VwVXRpbHMuZGVzdHJveSgpO1xyXG4gICAgICAgIHRoaXMuaW5zLmRpYWxvZ0Nsb3NlZC5lbWl0KCk7XHJcblxyXG4gICAgICAgIGlmICh0aGlzLmlucy5pbmNsdWRlU3Vib3JkaW5hdGVzJCQpIHtcclxuICAgICAgICAgICAgdGhpcy5pbnMuaW5jbHVkZVN1Ym9yZGluYXRlcyQkLnVuc3Vic2NyaWJlKCk7XHJcbiAgICAgICAgICAgIHRoaXMuaW5zLmluY2x1ZGVTdWJvcmRpbmF0ZXMkJCA9IG51bGw7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLmlucy5jb25kaXRpb25zID0gW107XHJcbiAgICAgICAgXHJcblxyXG4gICAgICAgIHRoaXMuaW5zLnNlYXJjaGluZyA9IGZhbHNlO1xyXG5cclxuICAgICAgICBpZiAodGhpcy5pbnMuZHRFdmVudE1ncikge1xyXG4gICAgICAgICAgICB0aGlzLmlucy5kdEV2ZW50TWdyWydfc29ydFN0YXRlJ10gPSBudWxsO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHRoaXMuaW5zLnR0RXZlbnRNZ3IpIHtcclxuICAgICAgICAgICAgdGhpcy5pbnMudHRFdmVudE1nclsnX3NvcnRTdGF0ZSddID0gbnVsbDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh0aGlzLl9va2J0bmNsaWNrJCkge1xyXG4gICAgICAgICAgICB0aGlzLl9va2J0bmNsaWNrJC51bnN1YnNjcmliZSgpO1xyXG4gICAgICAgICAgICB0aGlzLl9va2J0bmNsaWNrJCA9IG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIG9uRGlhbG9nQ3JlYXRlZCgpIHtcclxuICAgICAgICB0aGlzLl9sb2FkRGF0YVdoZW5PcGVuID0gdGhpcy5pbnMubG9hZERhdGFXaGVuT3BlbjtcclxuICAgICAgICB0aGlzLl9uYXZTZWxlY3RlZElkID0gdGhpcy5pbnMubmF2U2VsZWN0ZWRJZHM7XHJcbiAgICAgICAgdGhpcy5fc2VsZWN0Rmlyc3RJbk5hdiA9IHRoaXMuaW5zLnNlbGVjdEZpcnN0SW5OYXY7XHJcblxyXG4gICAgICAgIHRoaXMuaW5zLmRpYWxvZ0NyZWF0ZWRTdWJzY3JpcHRpb24gPSB0aGlzLmlucy5kaWFsb2dDcmVhdGVkLnN1YnNjcmliZShkbGcgPT4ge1xyXG4gICAgICAgICAgICBpZiAoZGxnKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmlucy5zZXRDb250YWluZXJNYXJnaW4oKTtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmlucy5kaWFsb2dPcGVuZWRTdWJzY3JpcHRpb24pIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmlucy5kaWFsb2dPcGVuZWRTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmlucy5kaWFsb2dDbG9zZWRTdWJzY3JpcHRpb24pIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmlucy5kaWFsb2dDbG9zZWRTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHRoaXMucmVnaXN0ZXJEaWFsb2dFdmVudCgpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuaW5zLmlzUmVjb3JkU2l6ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGRsZ1NpemUgPSB0aGlzLmlucy5wZXJzb25hbENvbmZpZ1NlcnZpY2UuZ2V0RGlhbG9nU2l6ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChkbGdTaXplKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHsgd2lkdGgsIGhlaWdodCB9ID0gZGxnU2l6ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnMuZGlhbG9nV2lkdGggPSB3aWR0aCA/IHdpZHRoIDogdGhpcy5pbnMuZGlhbG9nV2lkdGg7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaW5zLmRpYWxvZ0hlaWdodCA9IGhlaWdodCA/IGhlaWdodCA6IHRoaXMuaW5zLmRpYWxvZ0hlaWdodDtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIDIwMjAwOTA4IOabtOaWsOeOsOeql+WPo+eahOWwuuWvuCBieSBMdWNhc1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkbGcud2lkdGggPSB0aGlzLmlucy5kaWFsb2dXaWR0aDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGxnLmhlaWdodCA9IHRoaXMuaW5zLmRpYWxvZ0hlaWdodDtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBkbGcuc2hvdygpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHRoaXMuaW5zLnN1YnNjcmlwdGlvbnMucHVzaCh0aGlzLmlucy5kaWFsb2dDcmVhdGVkU3Vic2NyaXB0aW9uKTtcclxuICAgIH1cclxuXHJcbiAgICBjaGVja0RpY3RQaWNraW5nUmVzdWx0KHByOiBQaWNraW5nUmVzdWx0IHwgYW55KSB7XHJcbiAgICAgICAgbGV0IG8gPSB0cnVlO1xyXG4gICAgICAgIGlmIChwciA9PT0gdW5kZWZpbmVkIHx8IHByID09PSBudWxsIHx8IHByID09PSAnJykge1xyXG4gICAgICAgICAgICBvID0gdHJ1ZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh0eXBlb2YgcHIgPT09ICdib29sZWFuJykge1xyXG4gICAgICAgICAgICBvID0gcHI7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBsZXQgY3VzdG9tRGF0YSwgc2VsZWN0ZWRJZHMsIG1lc3NhZ2U7XHJcbiAgICAgICAgY3VzdG9tRGF0YSA9IHRoaXMuaW5zLmN1c3RvbURhdGE7XHJcbiAgICAgICAgc2VsZWN0ZWRJZHMgPSB0aGlzLmlucy5zZWxlY3RlZElkcztcclxuXHJcbiAgICAgICAgaWYgKHR5cGVvZiBwciA9PT0gJ29iamVjdCcpIHtcclxuICAgICAgICAgICAgaWYgKHByLnNob3dEaWFsb2cgPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgbyA9IHRydWU7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBvID0gcHIuc2hvd0RpYWxvZztcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKHByLmhhc093blByb3BlcnR5KCdkYXRhJykpIHtcclxuICAgICAgICAgICAgICAgIC8qKiDkv53lrZjluK7liqnliY3kvKDpgJLnmoTmlbDmja4gKi9cclxuICAgICAgICAgICAgICAgIGN1c3RvbURhdGEgPSBwci5kYXRhO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHNlbGVjdGVkSWRzID0gcHIuc2VsZWN0ZWRJZHMgfHwgbnVsbDtcclxuXHJcbiAgICAgICAgICAgIGlmIChwci5tZXNzYWdlKSB7XHJcbiAgICAgICAgICAgICAgICBtZXNzYWdlID0gcHIubWVzc2FnZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHsgc2hvdzogbywgY3VzdG9tRGF0YSwgc2VsZWN0ZWRJZHMsIG1lc3NhZ2UgfTtcclxuICAgIH1cclxuXHJcbiAgICBjYW5PcGVuRGlhbG9nKHByOiBQaWNraW5nUmVzdWx0IHwgYW55KSB7XHJcbiAgICAgICAgY29uc3Qge3Nob3csIGN1c3RvbURhdGEsIHNlbGVjdGVkSWRzLCBtZXNzYWdlfSA9IHRoaXMuY2hlY2tEaWN0UGlja2luZ1Jlc3VsdChwcik7XHJcbiAgICAgICAgdGhpcy5pbnMuY3VzdG9tRGF0YSA9IGN1c3RvbURhdGE7XHJcbiAgICAgICAgdGhpcy5pbnMuc2VsZWN0ZWRJZHMgPSBzZWxlY3RlZElkcyB8fCBudWxsO1xyXG4gICAgICAgIGlmIChtZXNzYWdlKSB7XHJcbiAgICAgICAgICAgIHRoaXMuaW5zLm5vdGlmeVNlcnZpY2Uud2FybmluZyhtZXNzYWdlKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuaW5zLmlzUmVhZHkgPSBmYWxzZTtcclxuICAgICAgICB0aGlzLmlucy5pc1Nob3cgPSBzaG93O1xyXG4gICAgfVxyXG5cclxuICAgIGdldEhlaWdodCgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5pbnMuZGlhbG9nLnNpemUuY29udGVudEhlaWdodCAtXHJcbiAgICAgICAgICAgICAgICB0aGlzLmlucy5jb250YWluZXJNYXJnaW4uYm90dG9tIC1cclxuICAgICAgICAgICAgICAgIHRoaXMuaW5zLmNvbnRhaW5lck1hcmdpbi50b3AgLVxyXG4gICAgICAgICAgICAgICAgKCF0aGlzLmlucy51c2VOZXdMYXlvdXQgPyAodGhpcy5pbnMudXNlRmF2b3JpdGUgPyA0MCA6ICAwKSA6IDU2KTtcclxuICAgICAgICAgICAgXHJcbiAgICB9XHJcblxyXG5cclxuICAgIHByaXZhdGUgZ2V0TWFpbkdyaWRTaXplKCkge1xyXG4gICAgICAgIGlmICh0aGlzLmlucy5pc0RvdWJsbGVMaXN0KCkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgIHdpZHRoOiB0aGlzLmlucy5kaWFsb2cuc2l6ZS53aWR0aCAtIHRoaXMuaW5zLmxlZnRQYW5lbC53aWR0aCAtIDI3LFxyXG4gICAgICAgICAgICAgICAgaGVpZ2h0OiB0aGlzLmdldEhlaWdodCgpXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICB3aWR0aDogdGhpcy5pbnMuZGlhbG9nLnNpemUud2lkdGggLSB0aGlzLmlucy5jb250YWluZXJNYXJnaW4ubGVmdCAtIHRoaXMuaW5zLmNvbnRhaW5lck1hcmdpbi5yaWdodCxcclxuICAgICAgICAgICAgaGVpZ2h0OiB0aGlzLmdldEhlaWdodCgpXHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICByZXNldERpYWxvZ0NvbnRlbnRIZWlnaHQoKSB7XHJcbiAgICAgICAgY29uc3QgeyBoZWFkZXI6IGhIZWlnaHQsIGZvb3RlcjogZkhlaWdodCB9ID0gdGhpcy5pbnMuZGlhbG9nLnNpemU7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuaW5zLmRpYWxvZ0hlaWdodCAtIGhIZWlnaHQgLSBmSGVpZ2h0IC0gIHRoaXMuaW5zLmNvbnRhaW5lck1hcmdpbi5ib3R0b20gLSB0aGlzLmlucy5jb250YWluZXJNYXJnaW4udG9wO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICBwcml2YXRlIHJlZ2lzdGVyT2tCdG5FdmVudCgpIHtcclxuICAgICAgICBpZiAodGhpcy5pbnMub2tCdXR0b24pIHtcclxuICAgICAgICAgICAgY29uc3QgZG91YmxlQ2xpY2tEdXJhdGlvbiA9IDI1MDtcclxuICAgICAgICAgICAgY29uc3QgbGVmdENsaWNrJCA9IGZyb21FdmVudCh0aGlzLmlucy5va0J1dHRvbi5uYXRpdmVFbGVtZW50LCAnY2xpY2snKS5waXBlKGZpbHRlcigoZXZlbnQ6IGFueSkgPT4gZXZlbnQuYnV0dG9uID09PSAwKSk7XHJcbiAgICAgICAgICAgIGNvbnN0IGRlYm91bmNlJCA9IGxlZnRDbGljayQucGlwZShkZWJvdW5jZVRpbWUoZG91YmxlQ2xpY2tEdXJhdGlvbikpO1xyXG4gICAgICAgICAgICBjb25zdCBjbGlja0xpbWl0JCA9IGxlZnRDbGljayQucGlwZShidWZmZXJDb3VudCgyKSk7XHJcbiAgICAgICAgICAgIGNvbnN0IGJ1ZmZlckdhdGUkID0gcmFjZShkZWJvdW5jZSQsIGNsaWNrTGltaXQkKVxyXG4gICAgICAgICAgICAucGlwZShcclxuICAgICAgICAgICAgICAvLyBXZSBhcmUgb25seSBpbnRlcmVzdGVkIGluIHRoZSBmaXJzdCBldmVudC4gQWZ0ZXIgdGhhdFxyXG4gICAgICAgICAgICAgIC8vIHdlIHdhbnQgdG8gcmVzdGFydC5cclxuICAgICAgICAgICAgICBmaXJzdCgpLFxyXG4gICAgICAgICAgICAgIHJlcGVhdCgpLFxyXG4gICAgICAgICAgICApO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5fb2tidG5jbGljayQgPSBsZWZ0Q2xpY2skLnBpcGUoXHJcbiAgICAgICAgICAgICAgICBidWZmZXIoYnVmZmVyR2F0ZSQpLFxyXG4gICAgICAgICAgICAgICAgLy8gSGVyZSB3ZSBtYXAgdGhlIGJ1ZmZlcmVkIGV2ZW50cyBpbnRvIHRoZSBsZW5ndGggb2YgdGhlIGJ1ZmZlclxyXG4gICAgICAgICAgICAgICAgLy8gSWYgdGhlIHVzZXIgY2xpY2tlZCBvbmNlLCB0aGUgYnVmZmVyIGlzIDEuIElmIGhlIGNsaWNrZWQgdHdpY2UgaXQgaXMgMlxyXG4gICAgICAgICAgICAgICAgbWFwKGNsaWNrcyA9PiBjbGlja3MubGVuZ3RoKVxyXG4gICAgICAgICAgICApLnN1YnNjcmliZShjbGlja3MgPT4ge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5pbnMuc2VsZWN0SXRlbSgpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLyoqIOazqOWGjOW8ueWHuueql+WPo+eahOS6i+S7tiAqL1xyXG4gICAgcHJpdmF0ZSByZWdpc3RlckRpYWxvZ0V2ZW50KCkge1xyXG4gICAgICAgIHRoaXMuZGlhbG9nT3BlbmVkU3Vic2NyaXB0aW9uID0gdGhpcy5pbnMuZGlhbG9nLm9wZW5lZC5zdWJzY3JpYmUoKCkgPT4ge1xyXG5cclxuICAgICAgICAgICAgdGhpcy5pbnMuZGlhbG9nQ29udGVudEhlaWdodCA9IHRoaXMucmVzZXREaWFsb2dDb250ZW50SGVpZ2h0KCk7XHJcblxyXG4gICAgICAgICAgICB0aGlzLmlucy5ncmlkT3B0aW9ucyA9IE9iamVjdC5hc3NpZ24odGhpcy5pbnMuZ3JpZE9wdGlvbnMsIHRoaXMuZ2V0TWFpbkdyaWRTaXplKCkpO1xyXG4gICAgICAgICAgICB0aGlzLmlucy5kaWFsb2cuZWwubmF0aXZlRWxlbWVudC5xdWVyeVNlbGVjdG9yKCcucHMtY29udGVudCcpLnN0eWxlLmhlaWdodCA9ICcxMDAlJztcclxuXHJcbiAgICAgICAgICAgIGlmICh0aGlzLmlucy5kaXNwbGF5VHlwZSAmJiB0aGlzLmlucy5jdXN0b21EaXNwbGF5VHlwZSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5pbnMuY29tcG9uZW50UmVmID0gdGhpcy5pbnMubG9va3VwQ21wTWdyLmNyZWF0ZUNvbnRlbnQodGhpcy5pbnMuZ3JpZE9wdGlvbnMpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5pbnMubG9va3VwQ21wTWdyLmNyZWF0ZUZhdm9yaXRlQ29tcG9uZW50KCk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHRoaXMuaW5zLmluaXREYXRhKCk7XHJcblxyXG4gICAgICAgICAgICAvLyDkv67mlLnluK7liqnnqpflj6PnmoTnirbmgIFcclxuICAgICAgICAgICAgdGhpcy5pbnMubG9va3VwVXRpbHMucGVuZGluZ0VuZCgpO1xyXG4gICAgICAgICAgICB0aGlzLmlucy5kaWFsb2dPcGVuZWQuZW1pdCgpO1xyXG5cclxuICAgICAgICAgICAgLy8g5rOo5YaM56Gu5a6a5oyJ6ZKu54K55Ye75LqL5Lu2XHJcbiAgICAgICAgICAgIHRoaXMucmVnaXN0ZXJPa0J0bkV2ZW50KCk7XHJcblxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICB0aGlzLmxvb2t1cEluaXQgPSB0aGlzLmlucy5sb29rdXBpbml0aWFsaXphdGlvblN1YmplY3Quc3Vic2NyaWJlKCgpID0+IHtcclxuICAgICAgICAgICAgdGhpcy5pbnMubG9hZERhdGFXaGVuT3BlbiA9IHRydWU7XHJcbiAgICAgICAgICAgIC8vIOazqOWGjOW/q+aNt+mUrlxyXG4gICAgICAgICAgICB0aGlzLnJlZ2lzdGVyU2hvcnRjdXRLZXkoKTtcclxuICAgICAgICAgICAgLy8g55uR5ZCs5bem5L6n5bC65a+45Y+Y5YyW5LqL5Lu2XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmlucy5sZWZ0UGFuZWwpIHtcclxuICAgICAgICAgICAgICAgIGlmICghdGhpcy5pbnMubGVmdFBhbmVsLnJlc2l6aW5nLm9ic2VydmVycy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBsZWZ0UGFuZWxSZXNpemUkID0gdGhpcy5pbnMubGVmdFBhbmVsLnJlc2l6aW5nLnBpcGUoXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlYm91bmNlVGltZSg1MClcclxuICAgICAgICAgICAgICAgICAgICApLnN1YnNjcmliZSgoczogYW55KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHNpemUgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aWR0aDogdGhpcy5pbnMuZGlhbG9nLnNpemUud2lkdGggLSBzLnNpemUud2lkdGggLSB0aGlzLmlucy5nZXRTcGFjZVdpZHRoKHRydWUpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiB0aGlzLmdldEhlaWdodCgpIC0gdGhpcy5pbnMuZ2V0RmlsdGVyQmFySGVpZ2h0KClcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmlucy5jb21wb25lbnRSZWYuaW5zdGFuY2UucmVzaXplKHNpemUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmlucy5sZWZ0Q29tcG9uZW50UmVmLmluc3RhbmNlLnJlc2l6ZShzLnNpemUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmlucy5zdWJzY3JpcHRpb25zLnB1c2gobGVmdFBhbmVsUmVzaXplJCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5pbnMuaXNEb3VibGxlTGlzdCgpICYmIHRoaXMuaW5zLmxlZnRDb21wb25lbnRSZWYpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmlucy5sZWZ0Q29tcG9uZW50UmVmLmluc3RhbmNlLnVwZGF0ZVNjcm9sbFBvc2l0aW9uKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmICh0aGlzLmlucy5jYXNjYWRlU2VsZWN0KSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCB7c2VsZWN0RWwsIHBhbmVsUmVmIH0gPSB0aGlzLmlucy5jYXNjYWRlU2VsZWN0O1xyXG4gICAgICAgICAgICAgICAgdGhpcy5pbnMuY2FzY2FkZVNlbGVjdC5iZWZvcmVTaG93ID0gKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChzZWxlY3RFbCAmJiBwYW5lbFJlZikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBwYW5lbFJlZi5zdHlsZS5sZWZ0ID0gYCR7c2VsZWN0RWwub2Zmc2V0TGVmdH1weGA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmlucy5sb2NhbFNlcnZpY2UubG9jYWxlSWQudG9Mb2NhbGVMb3dlckNhc2UoKSA9PSAnZW4nKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYW5lbFJlZi5zdHlsZS53aWR0aCA9ICdhdXRvJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhbmVsUmVmLnN0eWxlLm1heFdpZHRoID0gJzIwMHB4J1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBvZih0cnVlKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgdGhpcy5kaWFsb2dDbG9zZWRTdWJzY3JpcHRpb24gPSB0aGlzLmlucy5kaWFsb2cuY2xvc2VkLnN1YnNjcmliZSgoKSA9PiB7XHJcbiAgICAgICAgICAgIC8vIOi+k+WFpeahhuWPmOWMluWQju+8jOW8ueWHuueql+WPo+acqumAieaLqeaVsOaNruWFs+mXreeql+WPo+aXtu+8jOi/mOWOn+WOn+Wni+WAvFxyXG4gICAgICAgICAgICB0aGlzLmlucy5kaWFsb2dNZ3IuZGlhbG9nQ2xvc2VkKCk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIC8vIHRoaXMuaW5zLnN1YnNjcmlwdGlvbnMucHVzaCh0aGlzLmlucy5kaWFsb2dDbG9zZWRTdWJzY3JpcHRpb24pO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgcmVnaXN0ZXJTaG9ydGN1dEtleSgpIHtcclxuICAgICAgICAvLyDlm57ovabvvIzkuI7noa7lrprmjInpkq7lpITnkIbpgLvovpHkuIDoh7PjgIJcclxuICAgICAgICBjb25zdCBkbGdDb250YWluZXJEb20gPSB0aGlzLmlucy5kaWFsb2cuZWwubmF0aXZlRWxlbWVudC5xdWVyeVNlbGVjdG9yKCcuZmFycmlzLW1vZGFsJyk7XHJcblxyXG4gICAgICAgIGlmIChkbGdDb250YWluZXJEb20gJiYgdGhpcy5pbnMuc2hvcnRjdXRLZXkgJiYgIXRoaXMua2V5RG93bkhhbmRsZXIpIHtcclxuICAgICAgICAgICAgdGhpcy5rZXlEb3duSGFuZGxlciA9IHRoaXMuaW5zLmV2ZW50TWFuYWdlci5hZGRFdmVudExpc3RlbmVyKGRsZ0NvbnRhaW5lckRvbSwgJ2tleWRvd24nLCAoZTogS2V5Ym9hcmRFdmVudCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHsgbW92ZVVwLCBtb3ZlRG93biwgc2VhcmNoRm9jdXMsIGNvbmZpcm0sIG5leHRQYWdlciwgcHJldlBhZ2VyLCBleHBhbmQsIGNvbGxhcHNlIH0gPSB0aGlzLmlucy5zaG9ydGN1dEtleTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGFycm93S2V5ID0gW21vdmVVcCwgbW92ZURvd24sIGV4cGFuZCwgY29sbGFwc2VdO1xyXG4gICAgICAgICAgICAgICAgaWYgKGFycm93S2V5LmluY2x1ZGVzKGUuY29kZSkpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmlucy5jb21wb25lbnRSZWYuaW5zdGFuY2Uub25LZXlkb3duRXZlbnQoZSk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGUua2V5ID09PSBjb25maXJtKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGUudGFyZ2V0Wydub2RlTmFtZSddID09PSAnSU5QVVQnICYmICFlLmN0cmxLZXkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmlucy5va0J1dHRvbi5uYXRpdmVFbGVtZW50LmNsaWNrKCk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGUuY29kZSA9PT0gc2VhcmNoRm9jdXMpIHsgLy8g5biu5Yqp56qX5Y+j5p+l6K+i6L6T5YWl5qGG54Sm54K5XHJcbiAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaW5zLmNvbXBvbmVudFJlZi5pbnN0YW5jZS5pbnB1dEdyb3VwLmZvY3VzKCk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCF0aGlzLmlucy5pc1RyZWUoKSAmJiAoZS5jb2RlID09PSBuZXh0UGFnZXIgfHwgZS5jb2RlID09PSBwcmV2UGFnZXIgKSkgeyAgLy8g5YiG6aG1XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgaXNOZXh0UGFnZXIgPSBlLmNvZGUgPT09IG5leHRQYWdlcjtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnBhZ2luYXRpb25LZXlEb3duSGFuZGxlcihpc05leHRQYWdlcik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHBhZ2luYXRpb25LZXlEb3duSGFuZGxlcihuZXh0ID0gdHJ1ZSkge1xyXG4gICAgICAgIGNvbnN0IGRhdGF0YWJsZVJlZiA9IHRoaXMuaW5zLmNvbXBvbmVudFJlZi5pbnN0YW5jZTtcclxuICAgICAgICBjb25zdCB7cGFnZUluZGV4LCBwYWdlU2l6ZSwgdG90YWx9ID0gZGF0YXRhYmxlUmVmO1xyXG4gICAgICAgIGNvbnN0IHBhZ2VyQ291bnQgPSBNYXRoLmNlaWwodG90YWwgLyBwYWdlU2l6ZSk7XHJcblxyXG4gICAgICAgIGxldCBuZXdQYWdlTnVtID0gcGFnZUluZGV4O1xyXG4gICAgICAgIGlmIChuZXh0KSB7XHJcbiAgICAgICAgICAgIG5ld1BhZ2VOdW0gPSBuZXdQYWdlTnVtICsgMTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBuZXdQYWdlTnVtID0gbmV3UGFnZU51bSAtIDE7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAobmV3UGFnZU51bSA+IHBhZ2VyQ291bnQgfHwgbmV3UGFnZU51bSA8IDEpIHtcclxuICAgICAgICAgICAgbmV3UGFnZU51bSA9IHBhZ2VJbmRleDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuaW5zLmNvbXBvbmVudFJlZi5pbnN0YW5jZS5vblBhZ2VDaGFuZ2UoeyBwYWdlU2l6ZSwgcGFnZUluZGV4OiBuZXdQYWdlTnVtIH0pO1xyXG4gICAgfVxyXG5cclxufVxyXG5cclxuIl19
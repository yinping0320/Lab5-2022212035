/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { of } from 'rxjs';
import { debounceTime, switchMap } from 'rxjs/operators';
import { LookupGridDisplayType } from '../lookup-displaytype';
import { LookupLeftComponent } from '../lookup-left.component';
export class LookupComponentManager {
    /**
     * @param {?} ins
     */
    constructor(ins) {
        this.ins = ins;
    }
    /**
     * @param {?=} type
     * @return {?}
     */
    getComponentInstance(type = 'datatable') {
        if (!this.ins.componentRef || !this.ins.componentRef.instance) {
            return null;
        }
        if (type === 'selected') {
            return this.ins.selectedDtRef;
        }
        /** @type {?} */
        let ins = this.ins.componentRef.instance;
        if (type === 'leftDataTable' || type === 'leftTree') {
            /** @type {?} */
            const leftRef = this.ins.leftComponentRef;
            if (!leftRef || !leftRef.instance || !leftRef.instance.cmpRef || !leftRef.instance.cmpRef.instance) {
                return null;
            }
            ins = this.ins.leftComponentRef.instance.cmpRef.instance;
        }
        if (type === 'fav') {
            ins = this.ins.favoritesComponentRef.instance;
        }
        switch (type) {
            case 'leftDataTable':
            case 'fav':
            case 'datatable':
                return (/** @type {?} */ (ins));
            case 'leftTree':
            case 'treetable':
                return (/** @type {?} */ (ins));
            default:
                if (this.ins.isTree()) {
                    return (/** @type {?} */ (ins));
                }
                return (/** @type {?} */ (ins));
        }
    }
    /**
     * @param {?} data
     * @return {?}
     */
    createComponentWithServerData(data) {
        if (this.ins.componentRef) {
            return;
        }
        this.ins.idField = data.idField || this.ins.idField;
        this.ins.textField = data.textField || this.ins.textField;
        this.ins.valueField = data.valueField || this.ins.valueField;
        this.ins.displayType = (data && data.displayType) || this.ins.displayType || 'LIST';
        /** @type {?} */
        const dtyp = this.ins.displayType.toUpperCase();
        if (this.ins.isDoublleList()) {
            if (this.ins.navTreeToList && dtyp === LookupGridDisplayType.NavTreeList) {
                this.ins.displayType = LookupGridDisplayType.NavList;
            }
            if (this.ins.treeToList) {
                if (dtyp === LookupGridDisplayType.NavListTree) {
                    this.ins.displayType = LookupGridDisplayType.NavList;
                }
            }
        }
        else {
            if (this.ins.treeToList) {
                if (dtyp === LookupGridDisplayType.TreeList) {
                    this.ins.displayType = 'LIST';
                }
                else {
                    if (dtyp === LookupGridDisplayType.NavListTree) {
                        this.ins.displayType = LookupGridDisplayType.NavList;
                    }
                }
            }
        }
        if (this.ins.isDoublleList() && this.ins.navTreeToList) {
            if (dtyp === LookupGridDisplayType.NavTreeList) {
                this.ins.displayType = LookupGridDisplayType.NavList;
            }
        }
        this.ins.changeDetector.detectChanges();
        this.ins.componentRef = this.createContent(this.ins.gridOptions);
        this.createFavoriteComponent();
        this.resizeComponent();
    }
    /**
     * @return {?}
     */
    createFavoriteComponent() {
        if (this.ins.useFavorite && !this.ins.favoritesComponentRef) {
            this.ins.favoriteColumns = this.ins.favHelper.getFavoriteColumns();
            /** @type {?} */
            const favoritesOptions = Object.assign({}, this.ins.gridOptions, {
                showFilterBar: false,
                pagination: false,
                columns: this.ins.favoriteColumns || []
            });
            this.ins.favoritesComponentRef = this.createFavoritesContent(favoritesOptions);
            this.resizeComponent('fav');
        }
    }
    /**
     * @private
     * @param {?} expandLevel
     * @return {?}
     */
    reloadTreeDataForExpand(expandLevel) {
        /** @type {?} */
        const uri = this.ins.gridOptions.uri;
        /** @type {?} */
        const tt = (/** @type {?} */ (this.ins.componentRef.instance));
        const { field = '*', value = '' } = Object.assign({}, tt.searchData);
        /** @type {?} */
        const search = { category: 'all', searchValue: value, searchField: field, layerNum: expandLevel };
        /** @type {?} */
        const param = {
            searchValue: JSON.stringify(search),
            customData: this.ins.customData,
            enableFullTree: this.ins.enableFullTree,
            loadTreeDataType: this.ins.loadTreeDataType
        };
        if (this.ins.helpId) {
            param['helpId'] = this.ins.helpId;
        }
        if (tt && tt.sortName) {
            Object.assign(param, {
                sortName: tt.sortName,
                sortOrder: tt.sortOrder
            });
        }
        this.ins.showLoading();
        return this.ins.http.getData(uri, param).subscribe((/**
         * @param {?} data
         * @return {?}
         */
        (data) => {
            this.ins.closeLoading();
            /** @type {?} */
            const nodes = this.ins.checkNodeCanBeSelect(data.items, expandLevel === -1);
            this.ins.items = nodes;
            tt.loadData(nodes);
            tt.psRef.directiveRef.scrollToTop(0);
        }));
    }
    /**
     * @private
     * @param {?} nodes
     * @param {?} level
     * @return {?}
     */
    setTreeNodeExpandBy(nodes, level) {
        if (!nodes || !nodes.length) {
            return;
        }
        nodes.forEach((/**
         * @param {?} n
         * @return {?}
         */
        (n) => {
            /** @type {?} */
            const layer = n.data[this.ins.treeInfo.dataField].layer;
            /** @type {?} */
            const expandLayer = layer + level - 1;
            n.expanded = layer <= expandLayer ? true : n.expanded;
            if (n.children && n.children.length && layer + 1 <= expandLayer) {
                this.setTreeNodeExpandBy(n.children, level);
            }
        }));
    }
    // 启用树帮助右键菜单功能
    /**
     * @private
     * @param {?} cmpRef
     * @return {?}
     */
    useContextMenuForTree(cmpRef) {
        const { maxLevel, enableContextMenu, language } = this.ins.treeTableOptions;
        if (enableContextMenu && maxLevel) {
            /** @type {?} */
            const levelMenus = [];
            for (let i = 1; i <= maxLevel; i++) {
                /** @type {?} */
                const title = language['expand' + i];
                levelMenus.push({ id: 30 + 1, code: i, title, handle: (/**
                     * @param {?} t
                     * @return {?}
                     */
                    (t) => {
                        // 发送请求获取数据
                        /** @type {?} */
                        const level = t.menu.code;
                        if (isLoadAllTreeData()) {
                            this.setTreeNodeExpandBy(this.ins.items, level);
                            cmpRef.instance.updateSerializedValue();
                        }
                        else {
                            const { dataField, layerField } = this.ins.treeInfo;
                            /** @type {?} */
                            const firstNodeData = (this.ins.items || [])[0];
                            if (firstNodeData && firstNodeData.data) {
                                /** @type {?} */
                                const minLayer = this.ins.utils.getValue(`${dataField}.${layerField}`, firstNodeData.data);
                                /** @type {?} */
                                let _level = minLayer + level - 1;
                                this.reloadTreeDataForExpand(_level);
                            }
                        }
                    }) });
            }
            /** @type {?} */
            const isLoadAllTreeData = (/**
             * @return {?}
             */
            () => {
                if (this.ins.loadTreeDataType === 'default') {
                    return cmpRef.instance.loadDataType === 'all';
                }
                else {
                    return this.ins.loadTreeDataType === 'loadall';
                }
            });
            /** @type {?} */
            const contextMenus = [
                {
                    id: 6, code: 'checkchildnodes', title: '勾选下级数据',
                    visible: (/**
                     * @param {?} e
                     * @return {?}
                     */
                    (e) => {
                        // console.log(e);
                        return !e.data.node.selectable && !this.ins.singleSelect && e.data.node.children && e.data.node.children.length;
                    }),
                    handle: (/**
                     * @param {?} t
                     * @return {?}
                     */
                    (t) => {
                        if (cmpRef) {
                            /** @type {?} */
                            const nodeIds = cmpRef.instance.getChildNodes(t.data.id).filter((/**
                             * @param {?} n
                             * @return {?}
                             */
                            n => n.selectable)).map((/**
                             * @param {?} n
                             * @return {?}
                             */
                            n => n[this.ins.idField]));
                            // const nodeIds = t.data.node.children.map(n => n[this.ins.idField]);
                            cmpRef.instance.checkedNodes(nodeIds);
                            cmpRef.instance.selectNodes(nodeIds);
                        }
                    })
                },
                {
                    id: 5, code: 'uncheckchildnodes', title: '取消勾选下级数据',
                    visible: (/**
                     * @param {?} e
                     * @return {?}
                     */
                    (e) => {
                        // console.log(e);
                        return !e.data.node.selectable && !this.ins.singleSelect && e.data.node.children && e.data.node.children.length;
                    }),
                    handle: (/**
                     * @param {?} t
                     * @return {?}
                     */
                    (t) => {
                        if (cmpRef) {
                            // const nodeIds = t.data.node.children.map(n => n[this.ins.idField]);
                            /** @type {?} */
                            const nodeIds = cmpRef.instance.getChildNodes(t.data.id).filter((/**
                             * @param {?} n
                             * @return {?}
                             */
                            n => n.selectable)).map((/**
                             * @param {?} n
                             * @return {?}
                             */
                            n => n[this.ins.idField]));
                            cmpRef.instance.unCheckedNodes(nodeIds);
                            cmpRef.instance.unSelectNodes(nodeIds);
                        }
                    })
                },
                '-',
                {
                    id: 1, code: 'expandall', title: language.expandall, handle: (/**
                     * @param {?} t
                     * @return {?}
                     */
                    (t) => {
                        if (cmpRef && isLoadAllTreeData()) {
                            cmpRef.instance.expandAll();
                        }
                        else {
                            // 发送请求获取数据
                            this.reloadTreeDataForExpand(-1);
                        }
                    })
                },
                { id: 2, code: 'collapseall', title: language.collapseall, handle: (/**
                     * @param {?} t
                     * @return {?}
                     */
                    (t) => {
                        if (cmpRef) {
                            cmpRef.instance.collapseAll();
                        }
                    }) },
                '-',
                {
                    id: 3, title: language.expandByLayer,
                    children: levelMenus
                }
            ];
            this.ins.treeTableOptions.contextMenuItems = contextMenus;
            cmpRef.instance.beforeShowContextMenu = (/**
             * @return {?}
             */
            () => {
                return of({ show: !cmpRef.instance.state.searched });
            });
        }
    }
    /**
     * @param {?=} isFav
     * @return {?}
     */
    getCmpHeight(isFav = false) {
        return this.ins.dialogMgr.getHeight() - (isFav ? 10 : this.ins.getFilterBarHeight());
    }
    /**
     * @param {?} opts
     * @return {?}
     */
    createContent(opts) {
        if (this.ins.componentRef) {
            return;
        }
        /** @type {?} */
        const type = this.ins.getComponentType();
        /** @type {?} */
        const cmpFac = this.ins.cfr.resolveComponentFactory(type);
        /** @type {?} */
        let cmpRef = null;
        if (this.ins.isDoublleList()) {
            cmpRef = this.ins.centerContainer.createComponent(cmpFac);
        }
        else {
            cmpRef = this.ins.contentContainer.createComponent(cmpFac);
        }
        if (this.ins.isTree()) {
            opts.fit = true;
            opts.pagination = false;
            opts.fast = true;
            opts.fitColumns = false;
            this.useContextMenuForTree(cmpRef);
        }
        else {
            opts.fill = true;
        }
        opts.autoFitColumns = true;
        /** @type {?} */
        const ttOpts = this.ins.treeTableOptions || {};
        Object.assign(cmpRef.instance, opts, Object.assign({ allColumnsTitle: this.ins.allColumnsTitle }, ttOpts));
        this.ins.componentRef = cmpRef;
        this.resizeComponent();
        return cmpRef;
    }
    // 创建收藏CMP
    /**
     * @param {?} opts
     * @return {?}
     */
    createFavoritesContent(opts) {
        /** @type {?} */
        const type = this.ins.getComponentType();
        /** @type {?} */
        const cmpFac = this.ins.cfr.resolveComponentFactory(type);
        /** @type {?} */
        let cmpRef = null;
        cmpRef = this.ins.favoritesContainer.createComponent(cmpFac);
        if (this.ins.isTree()) {
            opts.fit = true;
            opts.pagination = false;
        }
        else {
            opts.fill = true;
        }
        opts.autoFitColumns = true;
        Object.assign(cmpRef.instance, opts, {
            width: this.ins.dialog.size.width - this.ins.getSpaceWidth(),
            height: this.ins.dialogMgr.getHeight()
        });
        // 订阅收藏夹列表中组件的相关事件
        this.ins.favHelper.initFavoriteComponentEvent(cmpRef);
        return cmpRef;
    }
    /**
     * @param {?=} type
     * @return {?}
     */
    resizeComponent(type = 'datatable') {
        /** @type {?} */
        const size = {
            width: this.ins.dialog.size.width - this.ins.getSpaceWidth(),
            height: this.getCmpHeight(type == 'fav')
        };
        if (this.ins.isDoublleList() && (type === 'datatable' || type === 'treetable')) {
            size.width = this.ins.dialog.size.width - this.ins.leftPanelWidth - this.ins.getSpaceWidth(true);
        }
        this.getComponentInstance(type).resize(size);
    }
    /**
     * @private
     * @param {?} node
     * @return {?}
     */
    getChildNodes(node) {
        /** @type {?} */
        const nodes = [];
        if (node.selectable || node.selectable === undefined) {
            nodes.push(node);
        }
        if (node.children && node.children.length) {
            node.children.forEach((/**
             * @param {?} n
             * @return {?}
             */
            n => {
                nodes.push(...this.getChildNodes(n));
            }));
        }
        return nodes;
    }
    /**
     * 创建左侧组件
     * @param {?} ops
     * @return {?}
     */
    createLeftComponent(ops) {
        /** @type {?} */
        let dtFac = null;
        if (this.ins.isDoublleList()) {
            dtFac = this.ins.cfr.resolveComponentFactory(LookupLeftComponent);
        }
        this.ins.leftComponentRef = this.ins.leftContainer.createComponent(dtFac);
        ops.height = this.ins.dialogMgr.getHeight();
        if (this.ins.dialogWidth < this.ins.navLookupDialogMinWidth) {
            this.ins.dialogWidth = this.ins.navLookupDialogMinWidth;
            this.ins.dialog.reSize({ width: this.ins.dialogWidth });
            this.ins.resizeCmp({ width: this.ins.dialog.size.width });
        }
        if (ops.width !== this.ins.leftPanel.width) {
            // 默认 1 : 2
            this.ins.leftPanel.resize({
                width: this.ins.leftPanel.width,
                height: ops.height
            });
            this.ins.resizeCmp({ width: this.ins.dialog.size.width });
        }
        // this.resizeComponent();
        this.ins.leftComponentRef.instance.lookupCmp = this.ins;
        this.ins.leftComponentRef.instance.navOptions = ops;
        this.ins.leftComponentRef.instance.selected
            .pipe(debounceTime(100), switchMap((/**
         * @param {?} d
         * @return {?}
         */
        (d) => {
            if (d && d.data) {
                this.ins.navigationFilter = {
                    selected: d.data,
                    idValue: this.getNavigationFilter(d.data),
                    searchField: '',
                    searchValue: ''
                };
            }
            else {
                this.ins.navigationFilter = undefined;
            }
            // 加载右侧数据
            /** @type {?} */
            const p = {
                pageInfo: {
                    pageIndex: 1,
                    // tfs 638840
                    pageSize: this.ins.gridOptions.pageSize
                }
            };
            if (this.ins.includeSubordinates && d && d.node && ops.treeInfo) {
                const { layerType, pathField, loadDataType, dataField } = ops.treeInfo;
                if (loadDataType === 'all') {
                    /** @type {?} */
                    const rowDatas = this.getChildNodes(d.node).map((/**
                     * @param {?} n
                     * @return {?}
                     */
                    n => n.data));
                    this.ins.navigationFilter.idValue = this.getNavigationFilter(rowDatas);
                }
                else {
                    if (layerType == 'pathcode') {
                        // p['navNodePathCode'] = d.data[dataField][pathField];
                        p['navNodePathCode'] = this.ins.getPathCode(d.data, ops.treeInfo);
                        this.ins['navNodePathCode'] = p['navNodePathCode'];
                    }
                }
            }
            else {
                this.ins['navNodePathCode'] = '';
            }
            /** @type {?} */
            const dataCmpRef = this.getComponentInstance();
            const { sortName, sortOrder } = dataCmpRef;
            Object.assign(p, { search: this.ins._searchState, sortName, sortOrder });
            return this.ins.httpMgr.getData(p, 'list');
        })))
            .subscribe((/**
         * @param {?} res
         * @return {?}
         */
        res => {
            this.ins.closeLoading();
            this.ins.loadDataWhenOpen = true;
            // if (this.ins.useFavorite && !this.ins.isTree()) {
            //     this.ins.favHelper.updateFavoritesStatus(res.items);
            // }
            // this.ins.loadDataTableData(res);
            this.ins.loadData(res, false);
            setTimeout((/**
             * @return {?}
             */
            () => {
                // 选中数据
                this.ins.selectionMgr.selectCurrentValue();
                this.ins.changeDetector.detectChanges();
            }));
        }));
        return this.ins.leftComponentRef.instance.createComponent();
    }
    // 获取关联数据, 右侧数据中 关联各字段的值
    /**
     * @private
     * @param {?} navRow
     * @return {?}
     */
    getNavigationFilter(navRow) {
        if (this.ins.navigationOptions.relations && this.ins.navigationOptions.relations.length) {
            /** @type {?} */
            const result = [];
            this.ins.navigationOptions.relations.forEach((/**
             * @param {?} r
             * @return {?}
             */
            r => {
                /** @type {?} */
                const k = r.groupField;
                /** @type {?} */
                const dField = r.helpField;
                /** @type {?} */
                const rf = { fieldName: dField, fieldValue: '' };
                if (Array.isArray(navRow)) {
                    /** @type {?} */
                    const vals = navRow.map((/**
                     * @param {?} n
                     * @return {?}
                     */
                    n => {
                        return k.split('.').reduce((/**
                         * @param {?} o
                         * @param {?} c
                         * @return {?}
                         */
                        (o, c) => {
                            return o[c];
                        }), n);
                    }));
                    rf.fieldValue = vals.join(',');
                }
                else {
                    rf.fieldValue = k.split('.').reduce((/**
                     * @param {?} o
                     * @param {?} c
                     * @return {?}
                     */
                    (o, c) => {
                        return o[c];
                    }), navRow);
                }
                result.push(rf);
            }));
            return result;
        }
        return '';
    }
}
if (false) {
    /**
     * @type {?}
     * @private
     */
    LookupComponentManager.prototype.ins;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibG9va3VwLWNvbXBvbmVudC5tYW5hZ2VyLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy91aS1sb29rdXAvIiwic291cmNlcyI6WyJsaWIvc2VydmljZXMvbG9va3VwLWNvbXBvbmVudC5tYW5hZ2VyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFHQSxPQUFPLEVBQUUsRUFBRSxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQzFCLE9BQU8sRUFBRSxZQUFZLEVBQUUsU0FBUyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDekQsT0FBTyxFQUF5QixxQkFBcUIsRUFBRSxNQUFNLHVCQUF1QixDQUFDO0FBRXJGLE9BQU8sRUFBRSxtQkFBbUIsRUFBRSxNQUFNLDBCQUEwQixDQUFDO0FBRy9ELE1BQU0sT0FBTyxzQkFBc0I7Ozs7SUFDL0IsWUFBb0IsR0FBd0I7UUFBeEIsUUFBRyxHQUFILEdBQUcsQ0FBcUI7SUFBRyxDQUFDOzs7OztJQUVoRCxvQkFBb0IsQ0FBQyxPQUE4QixXQUFXO1FBQzFELElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLFlBQVksSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsWUFBWSxDQUFDLFFBQVEsRUFBRTtZQUMzRCxPQUFPLElBQUksQ0FBQztTQUNmO1FBRUQsSUFBSSxJQUFJLEtBQUssVUFBVSxFQUFFO1lBQ3JCLE9BQU8sSUFBSSxDQUFDLEdBQUcsQ0FBQyxhQUFhLENBQUM7U0FDakM7O1lBRUcsR0FBRyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsWUFBWSxDQUFDLFFBQVE7UUFFeEMsSUFBSSxJQUFJLEtBQUssZUFBZSxJQUFJLElBQUksS0FBSyxVQUFVLEVBQUU7O2tCQUMzQyxPQUFPLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxnQkFBZ0I7WUFDekMsSUFBSSxDQUFDLE9BQU8sSUFBSSxDQUFDLE9BQU8sQ0FBQyxRQUFRLElBQUksQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLE1BQU0sSUFBSSxDQUFD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Ozs7O1lBQUMsQ0FBQyxDQUFDLEVBQUU7O3NCQUN2QyxDQUFDLEdBQUcsQ0FBQyxDQUFDLFVBQVU7O3NCQUNoQixNQUFNLEdBQUcsQ0FBQyxDQUFDLFNBQVM7O3NCQUNwQixFQUFFLEdBQVEsRUFBRSxTQUFTLEVBQUUsTUFBTSxFQUFFLFVBQVUsRUFBRSxFQUFFLEVBQUU7Z0JBRXJELElBQUksS0FBSyxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsRUFBRTs7MEJBQ2pCLElBQUksR0FBRyxNQUFNLENBQUMsR0FBRzs7OztvQkFBQyxDQUFDLENBQUMsRUFBRTt3QkFDeEIsT0FBTyxDQUFDLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDLE1BQU07Ozs7O3dCQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFOzRCQUNoQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQzt3QkFDaEIsQ0FBQyxHQUFFLENBQUMsQ0FBQyxDQUFDO29CQUNWLENBQUMsRUFBQztvQkFDRixFQUFFLENBQUMsVUFBVSxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7aUJBQ2xDO3FCQUFNO29CQUNILEVBQUUsQ0FBQyxVQUFVLEdBQUcsQ0FBQyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxNQUFNOzs7OztvQkFBQyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsRUFBRTt3QkFDekMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7b0JBQ2hCLENBQUMsR0FBRSxNQUFNLENBQUMsQ0FBQztpQkFDZDtnQkFFRCxNQUFNLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1lBQ3BCLENBQUMsRUFBQyxDQUFDO1lBQ0gsT0FBTyxNQUFNLENBQUM7U0FDakI7UUFFRCxPQUFPLEVBQUUsQ0FBQztJQUNkLENBQUM7Q0FDSjs7Ozs7O0lBN2RlLHFDQUFnQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudFJlZiB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBEYXRhVGFibGVDb21wb25lbnQgfSBmcm9tICdAZmFycmlzL3VpLWRhdGF0YWJsZSc7XHJcbmltcG9ydCB7IFRyZWVOb2RlLCBUcmVlVGFibGVDb21wb25lbnQgfSBmcm9tICdAZmFycmlzL3VpLXRyZWV0YWJsZSc7XHJcbmltcG9ydCB7IG9mIH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7IGRlYm91bmNlVGltZSwgc3dpdGNoTWFwIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xyXG5pbXBvcnQgeyBDb21wb25lbnRJbnN0YW5jZVR5cGUsIExvb2t1cEdyaWREaXNwbGF5VHlwZSB9IGZyb20gJy4uL2xvb2t1cC1kaXNwbGF5dHlwZSc7XHJcbmltcG9ydCB7IExvb2t1cEdyaWRDb21wb25lbnQgfSBmcm9tICcuLi9sb29rdXAtZ3JpZC5jb21wb25lbnQnO1xyXG5pbXBvcnQgeyBMb29rdXBMZWZ0Q29tcG9uZW50IH0gZnJvbSAnLi4vbG9va3VwLWxlZnQuY29tcG9uZW50JztcclxuXHJcblxyXG5leHBvcnQgY2xhc3MgTG9va3VwQ29tcG9uZW50TWFuYWdlciB7XHJcbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIGluczogTG9va3VwR3JpZENvbXBvbmVudCkge31cclxuXHJcbiAgICBnZXRDb21wb25lbnRJbnN0YW5jZSh0eXBlOiBDb21wb25lbnRJbnN0YW5jZVR5cGUgPSAnZGF0YXRhYmxlJykge1xyXG4gICAgICAgIGlmICghdGhpcy5pbnMuY29tcG9uZW50UmVmIHx8ICF0aGlzLmlucy5jb21wb25lbnRSZWYuaW5zdGFuY2UpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodHlwZSA9PT0gJ3NlbGVjdGVkJykge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5pbnMuc2VsZWN0ZWREdFJlZjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGxldCBpbnMgPSB0aGlzLmlucy5jb21wb25lbnRSZWYuaW5zdGFuY2U7XHJcblxyXG4gICAgICAgIGlmICh0eXBlID09PSAnbGVmdERhdGFUYWJsZScgfHwgdHlwZSA9PT0gJ2xlZnRUcmVlJykge1xyXG4gICAgICAgICAgICBjb25zdCBsZWZ0UmVmID0gdGhpcy5pbnMubGVmdENvbXBvbmVudFJlZjtcclxuICAgICAgICAgICAgaWYgKCFsZWZ0UmVmIHx8ICFsZWZ0UmVmLmluc3RhbmNlIHx8ICFsZWZ0UmVmLmluc3RhbmNlLmNtcFJlZiB8fCAhbGVmdFJlZi5pbnN0YW5jZS5jbXBSZWYuaW5zdGFuY2UpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlucyA9IHRoaXMuaW5zLmxlZnRDb21wb25lbnRSZWYuaW5zdGFuY2UuY21wUmVmLmluc3RhbmNlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHR5cGUgPT09ICdmYXYnKSB7XHJcbiAgICAgICAgICAgIGlucyA9IHRoaXMuaW5zLmZhdm9yaXRlc0NvbXBvbmVudFJlZi5pbnN0YW5jZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHN3aXRjaCAodHlwZSkge1xyXG4gICAgICAgICAgICBjYXNlICdsZWZ0RGF0YVRhYmxlJzpcclxuICAgICAgICAgICAgY2FzZSAnZmF2JzpcclxuICAgICAgICAgICAgY2FzZSAnZGF0YXRhYmxlJzpcclxuICAgICAgICAgICAgICAgIHJldHVybiBpbnMgYXMgRGF0YVRhYmxlQ29tcG9uZW50O1xyXG4gICAgICAgICAgICBjYXNlICdsZWZ0VHJlZSc6XHJcbiAgICAgICAgICAgIGNhc2UgJ3RyZWV0YWJsZSc6XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gaW5zIGFzIFRyZWVUYWJsZUNvbXBvbmVudDtcclxuICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmlucy5pc1RyZWUoKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBpbnMgYXMgVHJlZVRhYmxlQ29tcG9uZW50O1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGlucyBhcyBEYXRhVGFibGVDb21wb25lbnQ7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGNyZWF0ZUNvbXBvbmVudFdpdGhTZXJ2ZXJEYXRhKGRhdGE6IGFueSkge1xyXG4gICAgICAgIGlmICh0aGlzLmlucy5jb21wb25lbnRSZWYpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmlucy5pZEZpZWxkID0gZGF0YS5pZEZpZWxkIHx8IHRoaXMuaW5zLmlkRmllbGQ7XHJcbiAgICAgICAgdGhpcy5pbnMudGV4dEZpZWxkID0gZGF0YS50ZXh0RmllbGQgfHwgdGhpcy5pbnMudGV4dEZpZWxkO1xyXG4gICAgICAgIHRoaXMuaW5zLnZhbHVlRmllbGQgPSBkYXRhLnZhbHVlRmllbGQgfHwgdGhpcy5pbnMudmFsdWVGaWVsZDtcclxuXHJcbiAgICAgICAgdGhpcy5pbnMuZGlzcGxheVR5cGUgPSAoZGF0YSAmJiBkYXRhLmRpc3BsYXlUeXBlKSB8fCB0aGlzLmlucy5kaXNwbGF5VHlwZSB8fCAnTElTVCc7XHJcblxyXG4gICAgICAgIGNvbnN0IGR0eXAgPSB0aGlzLmlucy5kaXNwbGF5VHlwZS50b1VwcGVyQ2FzZSgpO1xyXG5cclxuICAgICAgICBpZiAodGhpcy5pbnMuaXNEb3VibGxlTGlzdCgpKSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmlucy5uYXZUcmVlVG9MaXN0ICYmIGR0eXAgPT09IExvb2t1cEdyaWREaXNwbGF5VHlwZS5OYXZUcmVlTGlzdCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5pbnMuZGlzcGxheVR5cGUgPSBMb29rdXBHcmlkRGlzcGxheVR5cGUuTmF2TGlzdDtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKHRoaXMuaW5zLnRyZWVUb0xpc3QpIHtcclxuICAgICAgICAgICAgICAgIGlmIChkdHlwID09PSAgTG9va3VwR3JpZERpc3BsYXlUeXBlLk5hdkxpc3RUcmVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnMuZGlzcGxheVR5cGUgPSBMb29rdXBHcmlkRGlzcGxheVR5cGUuTmF2TGlzdDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5pbnMudHJlZVRvTGlzdCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKGR0eXAgPT09IExvb2t1cEdyaWREaXNwbGF5VHlwZS5UcmVlTGlzdCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaW5zLmRpc3BsYXlUeXBlID0gJ0xJU1QnO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZHR5cCA9PT0gIExvb2t1cEdyaWREaXNwbGF5VHlwZS5OYXZMaXN0VHJlZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmlucy5kaXNwbGF5VHlwZSA9IExvb2t1cEdyaWREaXNwbGF5VHlwZS5OYXZMaXN0O1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuIFxyXG5cclxuICAgICAgICBcclxuXHJcbiAgICAgICAgaWYgKHRoaXMuaW5zLmlzRG91YmxsZUxpc3QoKSAmJiB0aGlzLmlucy5uYXZUcmVlVG9MaXN0KSB7XHJcbiAgICAgICAgICAgIGlmIChkdHlwID09PSBMb29rdXBHcmlkRGlzcGxheVR5cGUuTmF2VHJlZUxpc3QpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuaW5zLmRpc3BsYXlUeXBlID0gTG9va3VwR3JpZERpc3BsYXlUeXBlLk5hdkxpc3Q7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuaW5zLmNoYW5nZURldGVjdG9yLmRldGVjdENoYW5nZXMoKTtcclxuXHJcbiAgICAgICAgdGhpcy5pbnMuY29tcG9uZW50UmVmID0gdGhpcy5jcmVhdGVDb250ZW50KHRoaXMuaW5zLmdyaWRPcHRpb25zKTtcclxuICAgICAgICB0aGlzLmNyZWF0ZUZhdm9yaXRlQ29tcG9uZW50KCk7XHJcblxyXG4gICAgICAgIHRoaXMucmVzaXplQ29tcG9uZW50KCk7XHJcbiAgICB9XHJcblxyXG5cclxuICAgIGNyZWF0ZUZhdm9yaXRlQ29tcG9uZW50KCkge1xyXG4gICAgICAgIGlmICh0aGlzLmlucy51c2VGYXZvcml0ZSAmJiAhdGhpcy5pbnMuZmF2b3JpdGVzQ29tcG9uZW50UmVmKSB7XHJcbiAgICAgICAgICAgIHRoaXMuaW5zLmZhdm9yaXRlQ29sdW1ucyA9IHRoaXMuaW5zLmZhdkhlbHBlci5nZXRGYXZvcml0ZUNvbHVtbnMoKTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IGZhdm9yaXRlc09wdGlvbnMgPSBPYmplY3QuYXNzaWduKHt9LCB0aGlzLmlucy5ncmlkT3B0aW9ucywge1xyXG4gICAgICAgICAgICAgICAgc2hvd0ZpbHRlckJhcjogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICBwYWdpbmF0aW9uOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgIGNvbHVtbnM6IHRoaXMuaW5zLmZhdm9yaXRlQ29sdW1ucyB8fCBbXVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgdGhpcy5pbnMuZmF2b3JpdGVzQ29tcG9uZW50UmVmID0gdGhpcy5jcmVhdGVGYXZvcml0ZXNDb250ZW50KGZhdm9yaXRlc09wdGlvbnMpO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5yZXNpemVDb21wb25lbnQoJ2ZhdicpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcblxyXG4gICAgcHJpdmF0ZSByZWxvYWRUcmVlRGF0YUZvckV4cGFuZChleHBhbmRMZXZlbCkge1xyXG4gICAgICAgIGNvbnN0IHVyaSA9IHRoaXMuaW5zLmdyaWRPcHRpb25zLnVyaTtcclxuICAgICAgICBjb25zdCB0dCA9IHRoaXMuaW5zLmNvbXBvbmVudFJlZi5pbnN0YW5jZSBhcyBUcmVlVGFibGVDb21wb25lbnQ7XHJcbiAgICAgICAgY29uc3QgeyBmaWVsZCA9ICcqJywgdmFsdWUgPSAnJyB9ID0ge1xyXG4gICAgICAgICAgICAuLi50dC5zZWFyY2hEYXRhXHJcbiAgICAgICAgfTtcclxuICAgICAgICBjb25zdCBzZWFyY2ggPSB7IGNhdGVnb3J5OiAnYWxsJywgc2VhcmNoVmFsdWU6IHZhbHVlLCBzZWFyY2hGaWVsZDogZmllbGQsIGxheWVyTnVtOiBleHBhbmRMZXZlbCB9O1xyXG5cclxuXHJcbiAgICAgICAgY29uc3QgcGFyYW0gPSB7XHJcbiAgICAgICAgICAgIHNlYXJjaFZhbHVlOiBKU09OLnN0cmluZ2lmeShzZWFyY2gpLFxyXG4gICAgICAgICAgICBjdXN0b21EYXRhOiB0aGlzLmlucy5jdXN0b21EYXRhLFxyXG4gICAgICAgICAgICBlbmFibGVGdWxsVHJlZTogdGhpcy5pbnMuZW5hYmxlRnVsbFRyZWUsXHJcbiAgICAgICAgICAgIGxvYWRUcmVlRGF0YVR5cGU6IHRoaXMuaW5zLmxvYWRUcmVlRGF0YVR5cGVcclxuICAgICAgICB9O1xyXG5cclxuXHJcbiAgICAgICAgaWYgKHRoaXMuaW5zLmhlbHBJZCkge1xyXG4gICAgICAgICAgICBwYXJhbVsnaGVscElkJ10gPSB0aGlzLmlucy5oZWxwSWQ7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodHQgJiYgdHQuc29ydE5hbWUpIHtcclxuICAgICAgICAgICAgT2JqZWN0LmFzc2lnbihwYXJhbSwge1xyXG4gICAgICAgICAgICAgICAgc29ydE5hbWU6IHR0LnNvcnROYW1lLFxyXG4gICAgICAgICAgICAgICAgc29ydE9yZGVyOiB0dC5zb3J0T3JkZXJcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuaW5zLnNob3dMb2FkaW5nKCk7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuaW5zLmh0dHAuZ2V0RGF0YSh1cmksIHBhcmFtKS5zdWJzY3JpYmUoKGRhdGE6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLmlucy5jbG9zZUxvYWRpbmcoKTtcclxuICAgICAgICAgICAgY29uc3Qgbm9kZXMgPSB0aGlzLmlucy5jaGVja05vZGVDYW5CZVNlbGVjdChkYXRhLml0ZW1zLCBleHBhbmRMZXZlbCA9PT0gLTEpO1xyXG4gICAgICAgICAgICB0aGlzLmlucy5pdGVtcyA9IG5vZGVzO1xyXG4gICAgICAgICAgICB0dC5sb2FkRGF0YShub2Rlcyk7XHJcbiAgICAgICAgICAgIHR0LnBzUmVmLmRpcmVjdGl2ZVJlZi5zY3JvbGxUb1RvcCgwKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHNldFRyZWVOb2RlRXhwYW5kQnkobm9kZXM6IFRyZWVOb2RlW10sIGxldmVsKSB7XHJcbiAgICAgICAgaWYgKCFub2RlcyB8fCAhbm9kZXMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgbm9kZXMuZm9yRWFjaCgobjogVHJlZU5vZGUpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgbGF5ZXIgPSBuLmRhdGFbdGhpcy5pbnMudHJlZUluZm8uZGF0YUZpZWxkXS5sYXllcjtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IGV4cGFuZExheWVyID0gbGF5ZXIgKyBsZXZlbCAtIDE7XHJcblxyXG4gICAgICAgICAgICBuLmV4cGFuZGVkID0gbGF5ZXIgPD0gZXhwYW5kTGF5ZXIgPyB0cnVlIDogbi5leHBhbmRlZDtcclxuICAgICAgICAgICAgaWYgKG4uY2hpbGRyZW4gJiYgbi5jaGlsZHJlbi5sZW5ndGggJiYgbGF5ZXIgKyAxIDw9IGV4cGFuZExheWVyKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNldFRyZWVOb2RlRXhwYW5kQnkobi5jaGlsZHJlbiwgbGV2ZWwpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8g5ZCv55So5qCR5biu5Yqp5Y+z6ZSu6I+c5Y2V5Yqf6IO9XHJcbiAgICBwcml2YXRlIHVzZUNvbnRleHRNZW51Rm9yVHJlZShjbXBSZWY6IENvbXBvbmVudFJlZjxhbnk+KSB7XHJcbiAgICAgICAgY29uc3QgeyBtYXhMZXZlbCwgZW5hYmxlQ29udGV4dE1lbnUsIGxhbmd1YWdlIH0gPSB0aGlzLmlucy50cmVlVGFibGVPcHRpb25zO1xyXG4gICAgICAgIGlmIChlbmFibGVDb250ZXh0TWVudSAmJiBtYXhMZXZlbCkge1xyXG4gICAgICAgICAgICBjb25zdCBsZXZlbE1lbnVzID0gW107XHJcbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAxOyBpIDw9IG1heExldmVsOyBpKyspIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHRpdGxlID0gbGFuZ3VhZ2VbJ2V4cGFuZCcgKyBpXTtcclxuICAgICAgICAgICAgICAgIGxldmVsTWVudXMucHVzaCh7IGlkOiAzMCArIDEsIGNvZGU6IGksIHRpdGxlLCBoYW5kbGU6ICh0KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8g5Y+R6YCB6K+35rGC6I635Y+W5pWw5o2uXHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgbGV2ZWwgPSB0Lm1lbnUuY29kZTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoaXNMb2FkQWxsVHJlZURhdGEoKSApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRUcmVlTm9kZUV4cGFuZEJ5KHRoaXMuaW5zLml0ZW1zLCBsZXZlbCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNtcFJlZi5pbnN0YW5jZS51cGRhdGVTZXJpYWxpemVkVmFsdWUoKTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB7IGRhdGFGaWVsZCwgbGF5ZXJGaWVsZCB9ID0gdGhpcy5pbnMudHJlZUluZm87XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGZpcnN0Tm9kZURhdGEgPSAodGhpcy5pbnMuaXRlbXMgfHwgW10pWzBdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZmlyc3ROb2RlRGF0YSAmJiBmaXJzdE5vZGVEYXRhLmRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG1pbkxheWVyID0gdGhpcy5pbnMudXRpbHMuZ2V0VmFsdWUoYCR7ZGF0YUZpZWxkfS4ke2xheWVyRmllbGR9YCwgZmlyc3ROb2RlRGF0YS5kYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBfbGV2ZWwgPSBtaW5MYXllciArIGxldmVsIC0gMTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucmVsb2FkVHJlZURhdGFGb3JFeHBhbmQoX2xldmVsKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0gfSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGNvbnN0IGlzTG9hZEFsbFRyZWVEYXRhID0gKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuaW5zLmxvYWRUcmVlRGF0YVR5cGUgPT09ICdkZWZhdWx0Jykge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBjbXBSZWYuaW5zdGFuY2UubG9hZERhdGFUeXBlID09PSAnYWxsJztcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuaW5zLmxvYWRUcmVlRGF0YVR5cGUgPT09ICdsb2FkYWxsJztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IGNvbnRleHRNZW51cyA9IFtcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBpZDo2LCBjb2RlOiAnY2hlY2tjaGlsZG5vZGVzJywgdGl0bGU6ICfli77pgInkuIvnuqfmlbDmja4nLFxyXG4gICAgICAgICAgICAgICAgICAgIHZpc2libGU6IChlKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKGUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gIWUuZGF0YS5ub2RlLnNlbGVjdGFibGUgJiYgIXRoaXMuaW5zLnNpbmdsZVNlbGVjdCAmJiBlLmRhdGEubm9kZS5jaGlsZHJlbiAmJiBlLmRhdGEubm9kZS5jaGlsZHJlbi5sZW5ndGhcclxuICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgIGhhbmRsZTogKHQpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNtcFJlZikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgbm9kZUlkcyA9IGNtcFJlZi5pbnN0YW5jZS5nZXRDaGlsZE5vZGVzKHQuZGF0YS5pZCkuZmlsdGVyKG4gPT4gbi5zZWxlY3RhYmxlKS5tYXAobiA9PiBuW3RoaXMuaW5zLmlkRmllbGRdKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGNvbnN0IG5vZGVJZHMgPSB0LmRhdGEubm9kZS5jaGlsZHJlbi5tYXAobiA9PiBuW3RoaXMuaW5zLmlkRmllbGRdKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNtcFJlZi5pbnN0YW5jZS5jaGVja2VkTm9kZXMobm9kZUlkcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbXBSZWYuaW5zdGFuY2Uuc2VsZWN0Tm9kZXMobm9kZUlkcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIGlkOjUsIGNvZGU6ICd1bmNoZWNrY2hpbGRub2RlcycsIHRpdGxlOiAn5Y+W5raI5Yu+6YCJ5LiL57qn5pWw5o2uJyxcclxuICAgICAgICAgICAgICAgICAgICB2aXNpYmxlOiAoZSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICFlLmRhdGEubm9kZS5zZWxlY3RhYmxlICYmICF0aGlzLmlucy5zaW5nbGVTZWxlY3QgJiYgZS5kYXRhLm5vZGUuY2hpbGRyZW4gJiYgZS5kYXRhLm5vZGUuY2hpbGRyZW4ubGVuZ3RoXHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICBoYW5kbGU6ICh0KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjbXBSZWYpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGNvbnN0IG5vZGVJZHMgPSB0LmRhdGEubm9kZS5jaGlsZHJlbi5tYXAobiA9PiBuW3RoaXMuaW5zLmlkRmllbGRdKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG5vZGVJZHMgPSBjbXBSZWYuaW5zdGFuY2UuZ2V0Q2hpbGROb2Rlcyh0LmRhdGEuaWQpLmZpbHRlcihuID0+IG4uc2VsZWN0YWJsZSkubWFwKG4gPT4gblt0aGlzLmlucy5pZEZpZWxkXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbXBSZWYuaW5zdGFuY2UudW5DaGVja2VkTm9kZXMobm9kZUlkcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbXBSZWYuaW5zdGFuY2UudW5TZWxlY3ROb2Rlcyhub2RlSWRzKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAnLScsXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWQ6IDEsIGNvZGU6ICdleHBhbmRhbGwnLCB0aXRsZTogbGFuZ3VhZ2UuZXhwYW5kYWxsLCBoYW5kbGU6ICh0KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjbXBSZWYgJiYgaXNMb2FkQWxsVHJlZURhdGEoKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY21wUmVmLmluc3RhbmNlLmV4cGFuZEFsbCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8g5Y+R6YCB6K+35rGC6I635Y+W5pWw5o2uXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJlbG9hZFRyZWVEYXRhRm9yRXhwYW5kKC0xKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICB7IGlkOiAyLCBjb2RlOiAnY29sbGFwc2VhbGwnLCB0aXRsZTogbGFuZ3VhZ2UuY29sbGFwc2VhbGwsIGhhbmRsZTogKHQpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoY21wUmVmKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNtcFJlZi5pbnN0YW5jZS5jb2xsYXBzZUFsbCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0gfSxcclxuICAgICAgICAgICAgICAgICctJyxcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBpZDogMywgdGl0bGU6IGxhbmd1YWdlLmV4cGFuZEJ5TGF5ZXIsXHJcbiAgICAgICAgICAgICAgICAgICAgY2hpbGRyZW46IGxldmVsTWVudXNcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgXTtcclxuICAgICAgICAgICAgdGhpcy5pbnMudHJlZVRhYmxlT3B0aW9ucy5jb250ZXh0TWVudUl0ZW1zID0gY29udGV4dE1lbnVzO1xyXG5cclxuICAgICAgICAgICAgY21wUmVmLmluc3RhbmNlLmJlZm9yZVNob3dDb250ZXh0TWVudSA9ICgpID0+IHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBvZih7c2hvdzogIWNtcFJlZi5pbnN0YW5jZS5zdGF0ZS5zZWFyY2hlZH0pO1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBnZXRDbXBIZWlnaHQoaXNGYXYgPSBmYWxzZSkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmlucy5kaWFsb2dNZ3IuZ2V0SGVpZ2h0KCkgLSAoaXNGYXYgPyAxMCA6dGhpcy5pbnMuZ2V0RmlsdGVyQmFySGVpZ2h0KCkpO1xyXG4gICAgfVxyXG5cclxuICAgIGNyZWF0ZUNvbnRlbnQob3B0czogYW55KTogQ29tcG9uZW50UmVmPGFueT4ge1xyXG5cclxuICAgICAgICBpZiAodGhpcy5pbnMuY29tcG9uZW50UmVmKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IHR5cGUgPSB0aGlzLmlucy5nZXRDb21wb25lbnRUeXBlKCk7XHJcblxyXG4gICAgICAgIGNvbnN0IGNtcEZhYyA9IHRoaXMuaW5zLmNmci5yZXNvbHZlQ29tcG9uZW50RmFjdG9yeSh0eXBlKTtcclxuICAgICAgICBsZXQgY21wUmVmOiBDb21wb25lbnRSZWY8YW55PiA9IG51bGw7XHJcbiAgICAgICAgaWYgKHRoaXMuaW5zLmlzRG91YmxsZUxpc3QoKSkge1xyXG4gICAgICAgICAgICBjbXBSZWYgPSB0aGlzLmlucy5jZW50ZXJDb250YWluZXIuY3JlYXRlQ29tcG9uZW50KGNtcEZhYyk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgY21wUmVmID0gdGhpcy5pbnMuY29udGVudENvbnRhaW5lci5jcmVhdGVDb21wb25lbnQoY21wRmFjKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh0aGlzLmlucy5pc1RyZWUoKSkge1xyXG4gICAgICAgICAgICBvcHRzLmZpdCA9IHRydWU7XHJcbiAgICAgICAgICAgIG9wdHMucGFnaW5hdGlvbiA9IGZhbHNlO1xyXG5cclxuICAgICAgICAgICAgb3B0cy5mYXN0ID0gdHJ1ZTtcclxuICAgICAgICAgICAgb3B0cy5maXRDb2x1bW5zID0gZmFsc2U7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICB0aGlzLnVzZUNvbnRleHRNZW51Rm9yVHJlZShjbXBSZWYpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIG9wdHMuZmlsbCA9IHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIG9wdHMuYXV0b0ZpdENvbHVtbnMgPSB0cnVlO1xyXG5cclxuICAgICAgICBjb25zdCB0dE9wdHMgPSB0aGlzLmlucy50cmVlVGFibGVPcHRpb25zIHx8IHt9O1xyXG4gICAgICAgIE9iamVjdC5hc3NpZ24oY21wUmVmLmluc3RhbmNlLCBvcHRzLCB7IGFsbENvbHVtbnNUaXRsZTogdGhpcy5pbnMuYWxsQ29sdW1uc1RpdGxlLCAuLi50dE9wdHMgfSk7XHJcblxyXG4gICAgICAgIHRoaXMuaW5zLmNvbXBvbmVudFJlZiA9IGNtcFJlZjtcclxuICAgICAgICB0aGlzLnJlc2l6ZUNvbXBvbmVudCgpO1xyXG4gICAgICAgIHJldHVybiBjbXBSZWY7XHJcbiAgICB9XHJcblxyXG4gICAgLy8g5Yib5bu65pS26JePQ01QXHJcbiAgICBjcmVhdGVGYXZvcml0ZXNDb250ZW50KG9wdHM6IGFueSk6IENvbXBvbmVudFJlZjxhbnk+IHtcclxuICAgICAgICBjb25zdCB0eXBlID0gdGhpcy5pbnMuZ2V0Q29tcG9uZW50VHlwZSgpO1xyXG4gICAgICAgIFxyXG4gICAgICAgIGNvbnN0IGNtcEZhYyA9IHRoaXMuaW5zLmNmci5yZXNvbHZlQ29tcG9uZW50RmFjdG9yeSh0eXBlKTtcclxuICAgICAgICBsZXQgY21wUmVmID0gbnVsbDtcclxuICAgICAgICBjbXBSZWYgPSB0aGlzLmlucy5mYXZvcml0ZXNDb250YWluZXIuY3JlYXRlQ29tcG9uZW50KGNtcEZhYyk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgaWYgKHRoaXMuaW5zLmlzVHJlZSgpKSB7XHJcbiAgICAgICAgICAgIG9wdHMuZml0ID0gdHJ1ZTtcclxuICAgICAgICAgICAgb3B0cy5wYWdpbmF0aW9uID0gZmFsc2U7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgb3B0cy5maWxsID0gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgb3B0cy5hdXRvRml0Q29sdW1ucyA9IHRydWU7XHJcblxyXG4gICAgICAgIE9iamVjdC5hc3NpZ24oY21wUmVmLmluc3RhbmNlLCBvcHRzLCB7XHJcbiAgICAgICAgICAgIHdpZHRoOiB0aGlzLmlucy5kaWFsb2cuc2l6ZS53aWR0aCAtIHRoaXMuaW5zLmdldFNwYWNlV2lkdGgoKSxcclxuICAgICAgICAgICAgaGVpZ2h0OiB0aGlzLmlucy5kaWFsb2dNZ3IuZ2V0SGVpZ2h0KClcclxuICAgICAgICB9KTtcclxuXHJcblxyXG4gICAgICAgIC8vIOiuoumYheaUtuiXj+WkueWIl+ihqOS4ree7hOS7tueahOebuOWFs+S6i+S7tlxyXG4gICAgICAgIHRoaXMuaW5zLmZhdkhlbHBlci5pbml0RmF2b3JpdGVDb21wb25lbnRFdmVudChjbXBSZWYpO1xyXG5cclxuICAgICAgICByZXR1cm4gY21wUmVmO1xyXG4gICAgfVxyXG5cclxuICAgIHJlc2l6ZUNvbXBvbmVudCh0eXBlOiBDb21wb25lbnRJbnN0YW5jZVR5cGUgPSAnZGF0YXRhYmxlJykge1xyXG4gICAgICAgIGNvbnN0IHNpemUgPSB7XHJcbiAgICAgICAgICAgIHdpZHRoOiB0aGlzLmlucy5kaWFsb2cuc2l6ZS53aWR0aCAtIHRoaXMuaW5zLmdldFNwYWNlV2lkdGgoKSxcclxuICAgICAgICAgICAgaGVpZ2h0OiB0aGlzLmdldENtcEhlaWdodCh0eXBlID09ICdmYXYnKSBcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBpZiAodGhpcy5pbnMuaXNEb3VibGxlTGlzdCgpICYmICh0eXBlID09PSAnZGF0YXRhYmxlJyB8fCB0eXBlID09PSAndHJlZXRhYmxlJykpIHtcclxuICAgICAgICAgICAgc2l6ZS53aWR0aCA9IHRoaXMuaW5zLmRpYWxvZy5zaXplLndpZHRoIC0gdGhpcy5pbnMubGVmdFBhbmVsV2lkdGggLSB0aGlzLmlucy5nZXRTcGFjZVdpZHRoKHRydWUpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5nZXRDb21wb25lbnRJbnN0YW5jZSh0eXBlKS5yZXNpemUoc2l6ZSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBnZXRDaGlsZE5vZGVzKG5vZGU6IFRyZWVOb2RlKSB7XHJcbiAgICAgICAgY29uc3Qgbm9kZXM6IGFueSA9IFtdO1xyXG4gICAgICAgIGlmIChub2RlLnNlbGVjdGFibGUgfHwgbm9kZS5zZWxlY3RhYmxlID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgbm9kZXMucHVzaChub2RlKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKG5vZGUuY2hpbGRyZW4gJiYgbm9kZS5jaGlsZHJlbi5sZW5ndGgpIHtcclxuICAgICAgICAgICAgbm9kZS5jaGlsZHJlbi5mb3JFYWNoKG4gPT4ge1xyXG4gICAgICAgICAgICAgICAgbm9kZXMucHVzaCguLi50aGlzLmdldENoaWxkTm9kZXMobikpO1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIG5vZGVzO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKiDliJvlu7rlt6bkvqfnu4Tku7YgKi9cclxuICAgIGNyZWF0ZUxlZnRDb21wb25lbnQob3BzOiBhbnkpIHtcclxuICAgICAgICBsZXQgZHRGYWMgPSBudWxsO1xyXG4gICAgICAgIGlmICh0aGlzLmlucy5pc0RvdWJsbGVMaXN0KCkpIHtcclxuICAgICAgICAgICAgZHRGYWMgPSB0aGlzLmlucy5jZnIucmVzb2x2ZUNvbXBvbmVudEZhY3RvcnkoTG9va3VwTGVmdENvbXBvbmVudCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuaW5zLmxlZnRDb21wb25lbnRSZWYgPSB0aGlzLmlucy5sZWZ0Q29udGFpbmVyLmNyZWF0ZUNvbXBvbmVudChkdEZhYyk7XHJcbiAgICAgICAgb3BzLmhlaWdodCA9IHRoaXMuaW5zLmRpYWxvZ01nci5nZXRIZWlnaHQoKTtcclxuXHJcbiAgICAgICAgaWYgKHRoaXMuaW5zLmRpYWxvZ1dpZHRoIDwgdGhpcy5pbnMubmF2TG9va3VwRGlhbG9nTWluV2lkdGgpIHtcclxuICAgICAgICAgICAgdGhpcy5pbnMuZGlhbG9nV2lkdGggPSB0aGlzLmlucy5uYXZMb29rdXBEaWFsb2dNaW5XaWR0aDtcclxuICAgICAgICAgICAgdGhpcy5pbnMuZGlhbG9nLnJlU2l6ZSh7IHdpZHRoOiB0aGlzLmlucy5kaWFsb2dXaWR0aCB9KTtcclxuICAgICAgICAgICAgdGhpcy5pbnMucmVzaXplQ21wKHsgd2lkdGg6IHRoaXMuaW5zLmRpYWxvZy5zaXplLndpZHRoIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKG9wcy53aWR0aCAhPT0gdGhpcy5pbnMubGVmdFBhbmVsLndpZHRoKSB7XHJcbiAgICAgICAgICAgIC8vIOm7mOiupCAxIDogMlxyXG4gICAgICAgICAgICB0aGlzLmlucy5sZWZ0UGFuZWwucmVzaXplKHtcclxuICAgICAgICAgICAgICAgIHdpZHRoOiB0aGlzLmlucy5sZWZ0UGFuZWwud2lkdGgsXHJcbiAgICAgICAgICAgICAgICBoZWlnaHQ6IG9wcy5oZWlnaHRcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIHRoaXMuaW5zLnJlc2l6ZUNtcCh7IHdpZHRoOiB0aGlzLmlucy5kaWFsb2cuc2l6ZS53aWR0aCB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIHRoaXMucmVzaXplQ29tcG9uZW50KCk7XHJcblxyXG4gICAgICAgIHRoaXMuaW5zLmxlZnRDb21wb25lbnRSZWYuaW5zdGFuY2UubG9va3VwQ21wID0gdGhpcy5pbnM7XHJcbiAgICAgICAgdGhpcy5pbnMubGVmdENvbXBvbmVudFJlZi5pbnN0YW5jZS5uYXZPcHRpb25zID0gb3BzO1xyXG5cclxuXHJcbiAgICAgICAgdGhpcy5pbnMubGVmdENvbXBvbmVudFJlZi5pbnN0YW5jZS5zZWxlY3RlZFxyXG4gICAgICAgICAgICAucGlwZShcclxuICAgICAgICAgICAgICAgIGRlYm91bmNlVGltZSgxMDApLFxyXG4gICAgICAgICAgICAgICAgc3dpdGNoTWFwKChkOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZCAmJiBkLmRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnMubmF2aWdhdGlvbkZpbHRlciA9IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdGVkOiBkLmRhdGEsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZFZhbHVlOiB0aGlzLmdldE5hdmlnYXRpb25GaWx0ZXIoZC5kYXRhKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlYXJjaEZpZWxkOiAnJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlYXJjaFZhbHVlOiAnJ1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaW5zLm5hdmlnYXRpb25GaWx0ZXIgPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIC8vIOWKoOi9veWPs+S+p+aVsOaNrlxyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHAgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhZ2VJbmZvOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYWdlSW5kZXg6IDEsIC8vIHRmcyA2Mzg4NDBcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhZ2VTaXplOiB0aGlzLmlucy5ncmlkT3B0aW9ucy5wYWdlU2l6ZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuaW5zLmluY2x1ZGVTdWJvcmRpbmF0ZXMgJiYgZCAmJiBkLm5vZGUgJiYgb3BzLnRyZWVJbmZvKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHtsYXllclR5cGUsIHBhdGhGaWVsZCwgbG9hZERhdGFUeXBlLCBkYXRhRmllbGR9ID0gb3BzLnRyZWVJbmZvXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChsb2FkRGF0YVR5cGUgPT09ICdhbGwnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCByb3dEYXRhcyA9IHRoaXMuZ2V0Q2hpbGROb2RlcyhkLm5vZGUpLm1hcChuID0+IG4uZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmlucy5uYXZpZ2F0aW9uRmlsdGVyLmlkVmFsdWUgPSB0aGlzLmdldE5hdmlnYXRpb25GaWx0ZXIocm93RGF0YXMpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGxheWVyVHlwZSA9PSAncGF0aGNvZGUnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gcFsnbmF2Tm9kZVBhdGhDb2RlJ10gPSBkLmRhdGFbZGF0YUZpZWxkXVtwYXRoRmllbGRdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBbJ25hdk5vZGVQYXRoQ29kZSddID0gdGhpcy5pbnMuZ2V0UGF0aENvZGUoZC5kYXRhLCBvcHMudHJlZUluZm8pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaW5zWyduYXZOb2RlUGF0aENvZGUnXSA9IHBbJ25hdk5vZGVQYXRoQ29kZSddO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaW5zWyduYXZOb2RlUGF0aENvZGUnXSA9ICcnO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZGF0YUNtcFJlZiA9IHRoaXMuZ2V0Q29tcG9uZW50SW5zdGFuY2UoKTtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCB7IHNvcnROYW1lLCBzb3J0T3JkZXIgfSA9IGRhdGFDbXBSZWY7XHJcbiAgICAgICAgICAgICAgICAgICAgT2JqZWN0LmFzc2lnbihwLCB7IHNlYXJjaDogdGhpcy5pbnMuX3NlYXJjaFN0YXRlLCBzb3J0TmFtZSwgc29ydE9yZGVyIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmlucy5odHRwTWdyLmdldERhdGEocCwgJ2xpc3QnKTtcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIClcclxuICAgICAgICAgICAgLnN1YnNjcmliZShyZXMgPT4ge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5pbnMuY2xvc2VMb2FkaW5nKCk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmlucy5sb2FkRGF0YVdoZW5PcGVuID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBpZiAodGhpcy5pbnMudXNlRmF2b3JpdGUgJiYgIXRoaXMuaW5zLmlzVHJlZSgpKSB7XHJcbiAgICAgICAgICAgICAgICAvLyAgICAgdGhpcy5pbnMuZmF2SGVscGVyLnVwZGF0ZUZhdm9yaXRlc1N0YXR1cyhyZXMuaXRlbXMpO1xyXG4gICAgICAgICAgICAgICAgLy8gfVxyXG4gICAgICAgICAgICAgICAgLy8gdGhpcy5pbnMubG9hZERhdGFUYWJsZURhdGEocmVzKTtcclxuICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgdGhpcy5pbnMubG9hZERhdGEocmVzLCBmYWxzZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8g6YCJ5Lit5pWw5o2uXHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnMuc2VsZWN0aW9uTWdyLnNlbGVjdEN1cnJlbnRWYWx1ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaW5zLmNoYW5nZURldGVjdG9yLmRldGVjdENoYW5nZXMoKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHRoaXMuaW5zLmxlZnRDb21wb25lbnRSZWYuaW5zdGFuY2UuY3JlYXRlQ29tcG9uZW50KCk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8g6I635Y+W5YWz6IGU5pWw5o2uLCDlj7PkvqfmlbDmja7kuK0g5YWz6IGU5ZCE5a2X5q6155qE5YC8XHJcbiAgICBwcml2YXRlIGdldE5hdmlnYXRpb25GaWx0ZXIobmF2Um93OiBhbnkpIHtcclxuICAgICAgICBpZiAodGhpcy5pbnMubmF2aWdhdGlvbk9wdGlvbnMucmVsYXRpb25zICYmIHRoaXMuaW5zLm5hdmlnYXRpb25PcHRpb25zLnJlbGF0aW9ucy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gW107XHJcbiAgICAgICAgICAgIHRoaXMuaW5zLm5hdmlnYXRpb25PcHRpb25zLnJlbGF0aW9ucy5mb3JFYWNoKHIgPT4ge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgayA9IHIuZ3JvdXBGaWVsZDtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGRGaWVsZCA9IHIuaGVscEZpZWxkO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgcmY6IGFueSA9IHsgZmllbGROYW1lOiBkRmllbGQsIGZpZWxkVmFsdWU6ICcnIH07XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkobmF2Um93KSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHZhbHMgPSBuYXZSb3cubWFwKG4gPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gay5zcGxpdCgnLicpLnJlZHVjZSgobywgYykgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9bY107XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sIG4pO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIHJmLmZpZWxkVmFsdWUgPSB2YWxzLmpvaW4oJywnKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmYuZmllbGRWYWx1ZSA9IGsuc3BsaXQoJy4nKS5yZWR1Y2UoKG8sIGMpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9bY107XHJcbiAgICAgICAgICAgICAgICAgICAgfSwgbmF2Um93KTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICByZXN1bHQucHVzaChyZik7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuICcnO1xyXG4gICAgfVxyXG59XHJcbiJdfQ==
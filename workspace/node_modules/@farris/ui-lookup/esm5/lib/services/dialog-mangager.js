/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { fromEvent, of, race } from 'rxjs';
import { buffer, bufferCount, debounceTime, filter, first, map, repeat } from 'rxjs/operators';
var LookupDialogManager = /** @class */ (function () {
    function LookupDialogManager(ins) {
        this.ins = ins;
        this.lookupInit = null;
        this._loadDataWhenOpen = true;
        this._navSelectedId = '';
        this._selectFirstInNav = false;
        this.dialogClosedSubscription = null;
        this.dialogOpenedSubscription = null;
        this.keyDownHandler = null;
        this._okbtnclick$ = null;
    }
    /**
     * @private
     * @return {?}
     */
    LookupDialogManager.prototype.unsubscribes = /**
     * @private
     * @return {?}
     */
    function () {
        if (this.lookupInit) {
            this.lookupInit.unsubscribe();
            this.lookupInit = null;
        }
        if (this.dialogClosedSubscription) {
            this.dialogClosedSubscription.unsubscribe();
            this.dialogClosedSubscription = null;
        }
        if (this.dialogOpenedSubscription) {
            this.dialogOpenedSubscription.unsubscribe();
            this.dialogOpenedSubscription = null;
        }
    };
    // 帮助窗口关闭后做一些清理工作
    // 帮助窗口关闭后做一些清理工作
    /**
     * @return {?}
     */
    LookupDialogManager.prototype.dialogClosed = 
    // 帮助窗口关闭后做一些清理工作
    /**
     * @return {?}
     */
    function () {
        if (this.ins.displayText !== this.ins.originalText && !this.ins.nosearch) {
            this.ins.displayText = this.ins.originalText;
            this.ins.setModelValue(this.ins.displayText);
        }
        if (this.ins.componentRef) {
            this.ins.componentRef.destroy();
            this.ins.componentRef = null;
        }
        if (this.ins.favoritesComponentRef) {
            this.ins.favoritesComponentRef.destroy();
            this.ins.favoritesComponentRef = null;
        }
        if (this.ins.contentContainer) {
            this.ins.contentContainer.clear();
        }
        if (this.ins.centerContainer) {
            this.ins.centerContainer.clear();
        }
        if (this.ins.leftComponentRef) {
            this.ins.leftComponentRef.destroy();
            this.ins.leftComponentRef = null;
        }
        if (this.ins.leftContainer) {
            this.ins.leftContainer.clear();
        }
        this.ins.isShow = false;
        this.ins.isTextChange = false;
        if (this.ins.dialog) {
            this.ins.content = null;
        }
        this.ins.navigationFilter = null;
        this.ins.lookupUtils.pendingEnd();
        if (this.ins.helpId) {
            this.ins.displayType = '';
        }
        this.unsubscribes();
        // this.ins.items = [];
        this.ins.favoriteItems = [];
        this.ins.lookupSelectionSer.initFavoriteItems([]);
        this.ins.isTabChanged = false;
        if (this.ins.uri) {
            this.ins.items = [];
        }
        this.ins._searchState = null;
        this.ins.pageIndex = 1;
        this.ins.loadDataWhenOpen = this._loadDataWhenOpen;
        this.ins.navSelectedIds = this._navSelectedId;
        this.ins.selectFirstInNav = this._selectFirstInNav;
        this.ins.isGetAllChidlNodes = false;
        this.ins.enableGetAllChildNodes = true;
        // 保存个性化数据
        if (this.ins.usePersionalConf && this.ins.favoriteDataFrom !== 'locale') {
            this.ins.httpMgr.submitFavoriteData('dialog closed event.');
        }
        if (this.keyDownHandler) {
            this.keyDownHandler();
            this.keyDownHandler = null;
        }
        if (this.ins.inputGroup) {
            this.ins.inputGroup.focus();
        }
        this.ins.userInitialConfig.reset();
        this.ins.treeInfo = this.ins._treeInfo_;
        this.ins.lookupUtils.destroy();
        this.ins.dialogClosed.emit();
        if (this.ins.includeSubordinates$$) {
            this.ins.includeSubordinates$$.unsubscribe();
            this.ins.includeSubordinates$$ = null;
        }
        this.ins.conditions = [];
        this.ins.searching = false;
        if (this.ins.dtEventMgr) {
            this.ins.dtEventMgr['_sortState'] = null;
        }
        if (this.ins.ttEventMgr) {
            this.ins.ttEventMgr['_sortState'] = null;
        }
        if (this._okbtnclick$) {
            this._okbtnclick$.unsubscribe();
            this._okbtnclick$ = null;
        }
    };
    /**
     * @return {?}
     */
    LookupDialogManager.prototype.onDialogCreated = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this._loadDataWhenOpen = this.ins.loadDataWhenOpen;
        this._navSelectedId = this.ins.navSelectedIds;
        this._selectFirstInNav = this.ins.selectFirstInNav;
        this.ins.dialogCreatedSubscription = this.ins.dialogCreated.subscribe((/**
         * @param {?} dlg
         * @return {?}
         */
        function (dlg) {
            if (dlg) {
                _this.ins.setContainerMargin();
                if (_this.ins.dialogOpenedSubscription) {
                    _this.ins.dialogOpenedSubscription.unsubscribe();
                }
                if (_this.ins.dialogClosedSubscription) {
                    _this.ins.dialogClosedSubscription.unsubscribe();
                }
                _this.registerDialogEvent();
                if (_this.ins.isRecordSize) {
                    /** @type {?} */
                    var dlgSize = _this.ins.personalConfigService.getDialogSize();
                    if (dlgSize) {
                        var width = dlgSize.width, height = dlgSize.height;
                        _this.ins.dialogWidth = width ? width : _this.ins.dialogWidth;
                        _this.ins.dialogHeight = height ? height : _this.ins.dialogHeight;
                        // 20200908 更新现窗口的尺寸 by Lucas
                        dlg.width = _this.ins.dialogWidth;
                        dlg.height = _this.ins.dialogHeight;
                    }
                }
                dlg.show();
            }
        }));
        this.ins.subscriptions.push(this.ins.dialogCreatedSubscription);
    };
    /**
     * @param {?} pr
     * @return {?}
     */
    LookupDialogManager.prototype.checkDictPickingResult = /**
     * @param {?} pr
     * @return {?}
     */
    function (pr) {
        /** @type {?} */
        var o = true;
        if (pr === undefined || pr === null || pr === '') {
            o = true;
        }
        if (typeof pr === 'boolean') {
            o = pr;
        }
        /** @type {?} */
        var customData;
        /** @type {?} */
        var selectedIds;
        /** @type {?} */
        var message;
        customData = this.ins.customData;
        selectedIds = this.ins.selectedIds;
        if (typeof pr === 'object') {
            if (pr.showDialog === undefined) {
                o = true;
            }
            else {
                o = pr.showDialog;
            }
            if (pr.hasOwnProperty('data')) {
                /** 保存帮助前传递的数据 */
                customData = pr.data;
            }
            selectedIds = pr.selectedIds || null;
            if (pr.message) {
                message = pr.message;
            }
        }
        return { show: o, customData: customData, selectedIds: selectedIds, message: message };
    };
    /**
     * @param {?} pr
     * @return {?}
     */
    LookupDialogManager.prototype.canOpenDialog = /**
     * @param {?} pr
     * @return {?}
     */
    function (pr) {
        var _a = this.checkDictPickingResult(pr), show = _a.show, customData = _a.customData, selectedIds = _a.selectedIds, message = _a.message;
        this.ins.customData = customData;
        this.ins.selectedIds = selectedIds || null;
        if (message) {
            this.ins.notifyService.warning(message);
        }
        this.ins.isReady = false;
        this.ins.isShow = show;
    };
    /**
     * @return {?}
     */
    LookupDialogManager.prototype.getHeight = /**
     * @return {?}
     */
    function () {
        return this.ins.dialog.size.contentHeight -
            this.ins.containerMargin.bottom -
            this.ins.containerMargin.top -
            (!this.ins.useNewLayout ? (this.ins.useFavorite ? 40 : 0) : 56);
    };
    /**
     * @private
     * @return {?}
     */
    LookupDialogManager.prototype.getMainGridSize = /**
     * @private
     * @return {?}
     */
    function () {
        if (this.ins.isDoublleList()) {
            return {
                width: this.ins.dialog.size.width - this.ins.leftPanel.width - 27,
                height: this.getHeight()
            };
        }
        return {
            width: this.ins.dialog.size.width - this.ins.containerMargin.left - this.ins.containerMargin.right,
            height: this.getHeight()
        };
    };
    /**
     * @return {?}
     */
    LookupDialogManager.prototype.resetDialogContentHeight = /**
     * @return {?}
     */
    function () {
        var _a = this.ins.dialog.size, hHeight = _a.header, fHeight = _a.footer;
        return this.ins.dialogHeight - hHeight - fHeight - this.ins.containerMargin.bottom - this.ins.containerMargin.top;
    };
    /**
     * @private
     * @return {?}
     */
    LookupDialogManager.prototype.registerOkBtnEvent = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        if (this.ins.okButton) {
            /** @type {?} */
            var doubleClickDuration = 250;
            /** @type {?} */
            var leftClick$ = fromEvent(this.ins.okButton.nativeElement, 'click').pipe(filter((/**
             * @param {?} event
             * @return {?}
             */
            function (event) { return event.button === 0; })));
            /** @type {?} */
            var debounce$ = leftClick$.pipe(debounceTime(doubleClickDuration));
            /** @type {?} */
            var clickLimit$ = leftClick$.pipe(bufferCount(2));
            /** @type {?} */
            var bufferGate$ = race(debounce$, clickLimit$)
                .pipe(
            // We are only interested in the first event. After that
            // we want to restart.
            first(), repeat());
            this._okbtnclick$ = leftClick$.pipe(buffer(bufferGate$), 
            // Here we map the buffered events into the length of the buffer
            // If the user clicked once, the buffer is 1. If he clicked twice it is 2
            map((/**
             * @param {?} clicks
             * @return {?}
             */
            function (clicks) { return clicks.length; }))).subscribe((/**
             * @param {?} clicks
             * @return {?}
             */
            function (clicks) {
                _this.ins.selectItem();
            }));
        }
    };
    /** 注册弹出窗口的事件 */
    /**
     * 注册弹出窗口的事件
     * @private
     * @return {?}
     */
    LookupDialogManager.prototype.registerDialogEvent = /**
     * 注册弹出窗口的事件
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        this.dialogOpenedSubscription = this.ins.dialog.opened.subscribe((/**
         * @return {?}
         */
        function () {
            _this.ins.dialogContentHeight = _this.resetDialogContentHeight();
            _this.ins.gridOptions = Object.assign(_this.ins.gridOptions, _this.getMainGridSize());
            _this.ins.dialog.el.nativeElement.querySelector('.ps-content').style.height = '100%';
            if (_this.ins.displayType && _this.ins.customDisplayType) {
                _this.ins.componentRef = _this.ins.lookupCmpMgr.createContent(_this.ins.gridOptions);
                _this.ins.lookupCmpMgr.createFavoriteComponent();
            }
            _this.ins.initData();
            // 修改帮助窗口的状态
            _this.ins.lookupUtils.pendingEnd();
            _this.ins.dialogOpened.emit();
            // 注册确定按钮点击事件
            _this.registerOkBtnEvent();
        }));
        this.lookupInit = this.ins.lookupinitializationSubject.subscribe((/**
         * @return {?}
         */
        function () {
            _this.ins.loadDataWhenOpen = true;
            // 注册快捷键
            _this.registerShortcutKey();
            // 监听左侧尺寸变化事件
            if (_this.ins.leftPanel) {
                if (!_this.ins.leftPanel.resizing.observers.length) {
                    /** @type {?} */
                    var leftPanelResize$ = _this.ins.leftPanel.resizing.pipe(debounceTime(50)).subscribe((/**
                     * @param {?} s
                     * @return {?}
                     */
                    function (s) {
                        /** @type {?} */
                        var size = {
                            width: _this.ins.dialog.size.width - s.size.width - _this.ins.getSpaceWidth(true),
                            height: _this.getHeight() - _this.ins.getFilterBarHeight()
                        };
                        _this.ins.componentRef.instance.resize(size);
                        _this.ins.leftComponentRef.instance.resize(s.size);
                    }));
                    _this.ins.subscriptions.push(leftPanelResize$);
                }
                if (_this.ins.isDoublleList() && _this.ins.leftComponentRef) {
                    _this.ins.leftComponentRef.instance.updateScrollPosition();
                }
            }
            if (_this.ins.cascadeSelect) {
                var _a = _this.ins.cascadeSelect, selectEl_1 = _a.selectEl, panelRef_1 = _a.panelRef;
                _this.ins.cascadeSelect.beforeShow = (/**
                 * @return {?}
                 */
                function () {
                    if (selectEl_1 && panelRef_1) {
                        panelRef_1.style.left = selectEl_1.offsetLeft + "px";
                        if (_this.ins.localService.localeId.toLocaleLowerCase() == 'en') {
                            panelRef_1.style.width = 'auto';
                            panelRef_1.style.maxWidth = '200px';
                        }
                        return of(true);
                    }
                });
            }
        }));
        this.dialogClosedSubscription = this.ins.dialog.closed.subscribe((/**
         * @return {?}
         */
        function () {
            // 输入框变化后，弹出窗口未选择数据关闭窗口时，还原原始值
            _this.ins.dialogMgr.dialogClosed();
        }));
        // this.ins.subscriptions.push(this.ins.dialogClosedSubscription);
    };
    /**
     * @private
     * @return {?}
     */
    LookupDialogManager.prototype.registerShortcutKey = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        // 回车，与确定按钮处理逻辑一至。
        /** @type {?} */
        var dlgContainerDom = this.ins.dialog.el.nativeElement.querySelector('.farris-modal');
        if (dlgContainerDom && this.ins.shortcutKey && !this.keyDownHandler) {
            this.keyDownHandler = this.ins.eventManager.addEventListener(dlgContainerDom, 'keydown', (/**
             * @param {?} e
             * @return {?}
             */
            function (e) {
                e.stopPropagation();
                var _a = _this.ins.shortcutKey, moveUp = _a.moveUp, moveDown = _a.moveDown, searchFocus = _a.searchFocus, confirm = _a.confirm, nextPager = _a.nextPager, prevPager = _a.prevPager, expand = _a.expand, collapse = _a.collapse;
                /** @type {?} */
                var arrowKey = [moveUp, moveDown, expand, collapse];
                if (arrowKey.includes(e.code)) {
                    _this.ins.componentRef.instance.onKeydownEvent(e);
                }
                else if (e.key === confirm) {
                    if (e.target['nodeName'] === 'INPUT' && !e.ctrlKey) {
                        return;
                    }
                    _this.ins.okButton.nativeElement.click();
                }
                else if (e.code === searchFocus) { // 帮助窗口查询输入框焦点
                    e.preventDefault();
                    _this.ins.componentRef.instance.inputGroup.focus();
                }
                else if (!_this.ins.isTree() && (e.code === nextPager || e.code === prevPager)) { // 分页
                    // 分页
                    /** @type {?} */
                    var isNextPager = e.code === nextPager;
                    _this.paginationKeyDownHandler(isNextPager);
                }
            }));
        }
    };
    /**
     * @private
     * @param {?=} next
     * @return {?}
     */
    LookupDialogManager.prototype.paginationKeyDownHandler = /**
     * @private
     * @param {?=} next
     * @return {?}
     */
    function (next) {
        if (next === void 0) { next = true; }
        /** @type {?} */
        var datatableRef = this.ins.componentRef.instance;
        var pageIndex = datatableRef.pageIndex, pageSize = datatableRef.pageSize, total = datatableRef.total;
        /** @type {?} */
        var pagerCount = Math.ceil(total / pageSize);
        /** @type {?} */
        var newPageNum = pageIndex;
        if (next) {
            newPageNum = newPageNum + 1;
        }
        else {
            newPageNum = newPageNum - 1;
        }
        if (newPageNum > pagerCount || newPageNum < 1) {
            newPageNum = pageIndex;
        }
        this.ins.componentRef.instance.onPageChange({ pageSize: pageSize, pageIndex: newPageNum });
    };
    return LookupDialogManager;
}());
export { LookupDialogManager };
if (false) {
    /**
     * @type {?}
     * @private
     */
    LookupDialogManager.prototype.lookupInit;
    /**
     * @type {?}
     * @private
     */
    LookupDialogManager.prototype._loadDataWhenOpen;
    /**
     * @type {?}
     * @private
     */
    LookupDialogManager.prototype._navSelectedId;
    /**
     * @type {?}
     * @private
     */
    LookupDialogManager.prototype._selectFirstInNav;
    /**
     * @type {?}
     * @private
     */
    LookupDialogManager.prototype.dialogClosedSubscription;
    /**
     * @type {?}
     * @private
     */
    LookupDialogManager.prototype.dialogOpenedSubscription;
    /**
     * @type {?}
     * @private
     */
    LookupDialogManager.prototype.keyDownHandler;
    /**
     * @type {?}
     * @private
     */
    LookupDialogManager.prototype._okbtnclick$;
    /**
     * @type {?}
     * @private
     */
    LookupDialogManager.prototype.ins;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGlhbG9nLW1hbmdhZ2VyLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy91aS1sb29rdXAvIiwic291cmNlcyI6WyJsaWIvc2VydmljZXMvZGlhbG9nLW1hbmdhZ2VyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFDQSxPQUFPLEVBQUUsU0FBUyxFQUFFLEVBQUUsRUFBRSxJQUFJLEVBQWdCLE1BQU0sTUFBTSxDQUFDO0FBQ3pELE9BQU8sRUFBRSxNQUFNLEVBQUUsV0FBVyxFQUFFLFlBQVksRUFBRSxNQUFNLEVBQUUsS0FBSyxFQUFFLEdBQUcsRUFBRSxNQUFNLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUkvRjtJQVlJLDZCQUFvQixHQUF3QjtRQUF4QixRQUFHLEdBQUgsR0FBRyxDQUFxQjtRQVZwQyxlQUFVLEdBQWlCLElBQUksQ0FBQztRQUNoQyxzQkFBaUIsR0FBRyxJQUFJLENBQUM7UUFDekIsbUJBQWMsR0FBRyxFQUFFLENBQUM7UUFDcEIsc0JBQWlCLEdBQUcsS0FBSyxDQUFDO1FBQzFCLDZCQUF3QixHQUFpQixJQUFJLENBQUM7UUFDOUMsNkJBQXdCLEdBQWlCLElBQUksQ0FBQztRQUU5QyxtQkFBYyxHQUFHLElBQUksQ0FBQztRQUN0QixpQkFBWSxHQUFpQixJQUFJLENBQUM7SUFFTSxDQUFDOzs7OztJQUV6QywwQ0FBWTs7OztJQUFwQjtRQUNJLElBQUksSUFBSSxDQUFDLFVBQVUsRUFBRTtZQUNqQixJQUFJLENBQUMsVUFBVSxDQUFDLFdBQVcsRUFBRSxDQUFDO1lBQzlCLElBQUksQ0FBQyxVQUFVLEdBQUcsSUFBSSxDQUFDO1NBQzFCO1FBRUQsSUFBSSxJQUFJLENBQUMsd0JBQXdCLEVBQUU7WUFDL0IsSUFBSSxDQUFDLHdCQUF3QixDQUFDLFdBQVcsRUFBRSxDQUFDO1lBQzVDLElBQUksQ0FBQyx3QkFBd0IsR0FBRyxJQUFJLENBQUM7U0FDeEM7UUFFRCxJQUFJLElBQUksQ0FBQyx3QkFBd0IsRUFBRTtZQUMvQixJQUFJ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SSxJQUFJLEVBQUU7WUFDTixVQUFVLEdBQUcsVUFBVSxHQUFHLENBQUMsQ0FBQztTQUMvQjthQUFNO1lBQ0gsVUFBVSxHQUFHLFVBQVUsR0FBRyxDQUFDLENBQUM7U0FDL0I7UUFFRCxJQUFJLFVBQVUsR0FBRyxVQUFVLElBQUksVUFBVSxHQUFHLENBQUMsRUFBRTtZQUMzQyxVQUFVLEdBQUcsU0FBUyxDQUFDO1NBQzFCO1FBRUQsSUFBSSxDQUFDLEdBQUcsQ0FBQyxZQUFZLENBQUMsUUFBUSxDQUFDLFlBQVksQ0FBQyxFQUFFLFFBQVEsVUFBQSxFQUFFLFNBQVMsRUFBRSxVQUFVLEVBQUUsQ0FBQyxDQUFDO0lBQ3JGLENBQUM7SUFFTCwwQkFBQztBQUFELENBQUMsQUFsWkQsSUFrWkM7Ozs7Ozs7SUFoWkcseUNBQXdDOzs7OztJQUN4QyxnREFBaUM7Ozs7O0lBQ2pDLDZDQUE0Qjs7Ozs7SUFDNUIsZ0RBQWtDOzs7OztJQUNsQyx1REFBc0Q7Ozs7O0lBQ3RELHVEQUFzRDs7Ozs7SUFFdEQsNkNBQThCOzs7OztJQUM5QiwyQ0FBMEM7Ozs7O0lBRTlCLGtDQUFnQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFJlbmRlcmVyU3R5bGVGbGFnczIgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgZnJvbUV2ZW50LCBvZiwgcmFjZSwgU3Vic2NyaXB0aW9uIH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7IGJ1ZmZlciwgYnVmZmVyQ291bnQsIGRlYm91bmNlVGltZSwgZmlsdGVyLCBmaXJzdCwgbWFwLCByZXBlYXQgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XHJcbmltcG9ydCB7IFBpY2tpbmdSZXN1bHQgfSBmcm9tICcuLi9sb29rdXAtZ3JpZC1vcHRpb25zJztcclxuaW1wb3J0IHsgTG9va3VwR3JpZENvbXBvbmVudCB9IGZyb20gJy4uL2xvb2t1cC1ncmlkLmNvbXBvbmVudCc7XHJcblxyXG5leHBvcnQgY2xhc3MgTG9va3VwRGlhbG9nTWFuYWdlciB7XHJcblxyXG4gICAgcHJpdmF0ZSBsb29rdXBJbml0OiBTdWJzY3JpcHRpb24gPSBudWxsO1xyXG4gICAgcHJpdmF0ZSBfbG9hZERhdGFXaGVuT3BlbiA9IHRydWU7XHJcbiAgICBwcml2YXRlIF9uYXZTZWxlY3RlZElkID0gJyc7XHJcbiAgICBwcml2YXRlIF9zZWxlY3RGaXJzdEluTmF2ID0gZmFsc2U7XHJcbiAgICBwcml2YXRlIGRpYWxvZ0Nsb3NlZFN1YnNjcmlwdGlvbjogU3Vic2NyaXB0aW9uID0gbnVsbDtcclxuICAgIHByaXZhdGUgZGlhbG9nT3BlbmVkU3Vic2NyaXB0aW9uOiBTdWJzY3JpcHRpb24gPSBudWxsO1xyXG4gICAgXHJcbiAgICBwcml2YXRlIGtleURvd25IYW5kbGVyID0gbnVsbDtcclxuICAgIHByaXZhdGUgX29rYnRuY2xpY2skOiBTdWJzY3JpcHRpb24gPSBudWxsO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgaW5zOiBMb29rdXBHcmlkQ29tcG9uZW50KSB7IH1cclxuXHJcbiAgICBwcml2YXRlIHVuc3Vic2NyaWJlcygpe1xyXG4gICAgICAgIGlmICh0aGlzLmxvb2t1cEluaXQpIHtcclxuICAgICAgICAgICAgdGhpcy5sb29rdXBJbml0LnVuc3Vic2NyaWJlKCk7XHJcbiAgICAgICAgICAgIHRoaXMubG9va3VwSW5pdCA9IG51bGw7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodGhpcy5kaWFsb2dDbG9zZWRTdWJzY3JpcHRpb24pIHtcclxuICAgICAgICAgICAgdGhpcy5kaWFsb2dDbG9zZWRTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcclxuICAgICAgICAgICAgdGhpcy5kaWFsb2dDbG9zZWRTdWJzY3JpcHRpb24gPSBudWxsO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHRoaXMuZGlhbG9nT3BlbmVkU3Vic2NyaXB0aW9uKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZGlhbG9nT3BlbmVkU3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XHJcbiAgICAgICAgICAgIHRoaXMuZGlhbG9nT3BlbmVkU3Vic2NyaXB0aW9uID0gbnVsbDtcclxuICAgICAgICB9XHJcblxyXG4gICAgfVxyXG4gICAgLy8g5biu5Yqp56qX5Y+j5YWz6Zet5ZCO5YGa5LiA5Lqb5riF55CG5bel5L2cXHJcbiAgICBkaWFsb2dDbG9zZWQoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuaW5zLmRpc3BsYXlUZXh0ICE9PSB0aGlzLmlucy5vcmlnaW5hbFRleHQgJiYgIXRoaXMuaW5zLm5vc2VhcmNoKSB7XHJcbiAgICAgICAgICAgIHRoaXMuaW5zLmRpc3BsYXlUZXh0ID0gdGhpcy5pbnMub3JpZ2luYWxUZXh0O1xyXG4gICAgICAgICAgICB0aGlzLmlucy5zZXRNb2RlbFZhbHVlKHRoaXMuaW5zLmRpc3BsYXlUZXh0KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHRoaXMuaW5zLmNvbXBvbmVudFJlZikge1xyXG4gICAgICAgICAgICB0aGlzLmlucy5jb21wb25lbnRSZWYuZGVzdHJveSgpO1xyXG4gICAgICAgICAgICB0aGlzLmlucy5jb21wb25lbnRSZWYgPSBudWxsO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHRoaXMuaW5zLmZhdm9yaXRlc0NvbXBvbmVudFJlZikge1xyXG4gICAgICAgICAgICB0aGlzLmlucy5mYXZvcml0ZXNDb21wb25lbnRSZWYuZGVzdHJveSgpO1xyXG4gICAgICAgICAgICB0aGlzLmlucy5mYXZvcml0ZXNDb21wb25lbnRSZWYgPSBudWxsO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHRoaXMuaW5zLmNvbnRlbnRDb250YWluZXIpIHtcclxuICAgICAgICAgICAgdGhpcy5pbnMuY29udGVudENvbnRhaW5lci5jbGVhcigpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHRoaXMuaW5zLmNlbnRlckNvbnRhaW5lcikge1xyXG4gICAgICAgICAgICB0aGlzLmlucy5jZW50ZXJDb250YWluZXIuY2xlYXIoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh0aGlzLmlucy5sZWZ0Q29tcG9uZW50UmVmKSB7XHJcbiAgICAgICAgICAgIHRoaXMuaW5zLmxlZnRDb21wb25lbnRSZWYuZGVzdHJveSgpO1xyXG4gICAgICAgICAgICB0aGlzLmlucy5sZWZ0Q29tcG9uZW50UmVmID0gbnVsbDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh0aGlzLmlucy5sZWZ0Q29udGFpbmVyKSB7XHJcbiAgICAgICAgICAgIHRoaXMuaW5zLmxlZnRDb250YWluZXIuY2xlYXIoKTtcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICB0aGlzLmlucy5pc1Nob3cgPSBmYWxzZTtcclxuICAgICAgICB0aGlzLmlucy5pc1RleHRDaGFuZ2UgPSBmYWxzZTtcclxuICAgICAgICBpZiAodGhpcy5pbnMuZGlhbG9nKSB7XHJcbiAgICAgICAgICAgIHRoaXMuaW5zLmNvbnRlbnQgPSBudWxsO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5pbnMubmF2aWdhdGlvbkZpbHRlciA9IG51bGw7XHJcblxyXG4gICAgICAgIHRoaXMuaW5zLmxvb2t1cFV0aWxzLnBlbmRpbmdFbmQoKTtcclxuXHJcbiAgICAgICAgaWYgKHRoaXMuaW5zLmhlbHBJZCkge1xyXG4gICAgICAgICAgICB0aGlzLmlucy5kaXNwbGF5VHlwZSA9ICcnO1xyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIHRoaXMudW5zdWJzY3JpYmVzKCk7XHJcblxyXG4gICAgICAgIC8vIHRoaXMuaW5zLml0ZW1zID0gW107XHJcbiAgICAgICAgdGhpcy5pbnMuZmF2b3JpdGVJdGVtcyA9IFtdO1xyXG4gICAgICAgIHRoaXMuaW5zLmxvb2t1cFNlbGVjdGlvblNlci5pbml0RmF2b3JpdGVJdGVtcyhbXSk7XHJcblxyXG4gICAgICAgIHRoaXMuaW5zLmlzVGFiQ2hhbmdlZCA9IGZhbHNlO1xyXG5cclxuICAgICAgICBpZiAodGhpcy5pbnMudXJpKSB7XHJcbiAgICAgICAgICAgIHRoaXMuaW5zLml0ZW1zID0gW107XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuaW5zLl9zZWFyY2hTdGF0ZSA9IG51bGw7XHJcblxyXG5cclxuICAgICAgICB0aGlzLmlucy5wYWdlSW5kZXggPSAxO1xyXG5cclxuICAgICAgICB0aGlzLmlucy5sb2FkRGF0YVdoZW5PcGVuID0gdGhpcy5fbG9hZERhdGFXaGVuT3BlbjtcclxuICAgICAgICB0aGlzLmlucy5uYXZTZWxlY3RlZElkcyA9IHRoaXMuX25hdlNlbGVjdGVkSWQ7XHJcbiAgICAgICAgdGhpcy5pbnMuc2VsZWN0Rmlyc3RJbk5hdiA9IHRoaXMuX3NlbGVjdEZpcnN0SW5OYXY7XHJcblxyXG4gICAgICAgIHRoaXMuaW5zLmlzR2V0QWxsQ2hpZGxOb2RlcyA9IGZhbHNlO1xyXG5cclxuICAgICAgICB0aGlzLmlucy5lbmFibGVHZXRBbGxDaGlsZE5vZGVzID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgLy8g5L+d5a2Y5Liq5oCn5YyW5pWw5o2uXHJcbiAgICAgICAgaWYgKHRoaXMuaW5zLnVzZVBlcnNpb25hbENvbmYgJiYgdGhpcy5pbnMuZmF2b3JpdGVEYXRhRnJvbSAhPT0gJ2xvY2FsZScpIHtcclxuICAgICAgICAgICAgdGhpcy5pbnMuaHR0cE1nci5zdWJtaXRGYXZvcml0ZURhdGEoJ2RpYWxvZyBjbG9zZWQgZXZlbnQuJyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodGhpcy5rZXlEb3duSGFuZGxlcikge1xyXG4gICAgICAgICAgICB0aGlzLmtleURvd25IYW5kbGVyKCk7XHJcbiAgICAgICAgICAgIHRoaXMua2V5RG93bkhhbmRsZXIgPSBudWxsO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGhpcy5pbnMuaW5wdXRHcm91cCkge1xyXG4gICAgICAgICAgICB0aGlzLmlucy5pbnB1dEdyb3VwLmZvY3VzKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLmlucy51c2VySW5pdGlhbENvbmZpZy5yZXNldCgpO1xyXG5cclxuICAgICAgICB0aGlzLmlucy50cmVlSW5mbyA9IHRoaXMuaW5zLl90cmVlSW5mb187XHJcblxyXG4gICAgICAgIHRoaXMuaW5zLmxvb2t1cFV0aWxzLmRlc3Ryb3koKTtcclxuICAgICAgICB0aGlzLmlucy5kaWFsb2dDbG9zZWQuZW1pdCgpO1xyXG5cclxuICAgICAgICBpZiAodGhpcy5pbnMuaW5jbHVkZVN1Ym9yZGluYXRlcyQkKSB7XHJcbiAgICAgICAgICAgIHRoaXMuaW5zLmluY2x1ZGVTdWJvcmRpbmF0ZXMkJC51bnN1YnNjcmliZSgpO1xyXG4gICAgICAgICAgICB0aGlzLmlucy5pbmNsdWRlU3Vib3JkaW5hdGVzJCQgPSBudWxsO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5pbnMuY29uZGl0aW9ucyA9IFtdO1xyXG4gICAgICAgIFxyXG5cclxuICAgICAgICB0aGlzLmlucy5zZWFyY2hpbmcgPSBmYWxzZTtcclxuXHJcbiAgICAgICAgaWYgKHRoaXMuaW5zLmR0RXZlbnRNZ3IpIHtcclxuICAgICAgICAgICAgdGhpcy5pbnMuZHRFdmVudE1nclsnX3NvcnRTdGF0ZSddID0gbnVsbDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh0aGlzLmlucy50dEV2ZW50TWdyKSB7XHJcbiAgICAgICAgICAgIHRoaXMuaW5zLnR0RXZlbnRNZ3JbJ19zb3J0U3RhdGUnXSA9IG51bGw7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodGhpcy5fb2tidG5jbGljayQpIHtcclxuICAgICAgICAgICAgdGhpcy5fb2tidG5jbGljayQudW5zdWJzY3JpYmUoKTtcclxuICAgICAgICAgICAgdGhpcy5fb2tidG5jbGljayQgPSBudWxsO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBvbkRpYWxvZ0NyZWF0ZWQoKSB7XHJcbiAgICAgICAgdGhpcy5fbG9hZERhdGFXaGVuT3BlbiA9IHRoaXMuaW5zLmxvYWREYXRhV2hlbk9wZW47XHJcbiAgICAgICAgdGhpcy5fbmF2U2VsZWN0ZWRJZCA9IHRoaXMuaW5zLm5hdlNlbGVjdGVkSWRzO1xyXG4gICAgICAgIHRoaXMuX3NlbGVjdEZpcnN0SW5OYXYgPSB0aGlzLmlucy5zZWxlY3RGaXJzdEluTmF2O1xyXG5cclxuICAgICAgICB0aGlzLmlucy5kaWFsb2dDcmVhdGVkU3Vic2NyaXB0aW9uID0gdGhpcy5pbnMuZGlhbG9nQ3JlYXRlZC5zdWJzY3JpYmUoZGxnID0+IHtcclxuICAgICAgICAgICAgaWYgKGRsZykge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5pbnMuc2V0Q29udGFpbmVyTWFyZ2luKCk7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5pbnMuZGlhbG9nT3BlbmVkU3Vic2NyaXB0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnMuZGlhbG9nT3BlbmVkU3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5pbnMuZGlhbG9nQ2xvc2VkU3Vic2NyaXB0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnMuZGlhbG9nQ2xvc2VkU3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB0aGlzLnJlZ2lzdGVyRGlhbG9nRXZlbnQoKTtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmlucy5pc1JlY29yZFNpemUpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBkbGdTaXplID0gdGhpcy5pbnMucGVyc29uYWxDb25maWdTZXJ2aWNlLmdldERpYWxvZ1NpemUoKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZGxnU2l6ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB7IHdpZHRoLCBoZWlnaHQgfSA9IGRsZ1NpemU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaW5zLmRpYWxvZ1dpZHRoID0gd2lkdGggPyB3aWR0aCA6IHRoaXMuaW5zLmRpYWxvZ1dpZHRoO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmlucy5kaWFsb2dIZWlnaHQgPSBoZWlnaHQgPyBoZWlnaHQgOiB0aGlzLmlucy5kaWFsb2dIZWlnaHQ7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyAyMDIwMDkwOCDmm7TmlrDnjrDnqpflj6PnmoTlsLrlr7ggYnkgTHVjYXNcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGxnLndpZHRoID0gdGhpcy5pbnMuZGlhbG9nV2lkdGg7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRsZy5oZWlnaHQgPSB0aGlzLmlucy5kaWFsb2dIZWlnaHQ7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZGxnLnNob3coKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICB0aGlzLmlucy5zdWJzY3JpcHRpb25zLnB1c2godGhpcy5pbnMuZGlhbG9nQ3JlYXRlZFN1YnNjcmlwdGlvbik7XHJcbiAgICB9XHJcblxyXG4gICAgY2hlY2tEaWN0UGlja2luZ1Jlc3VsdChwcjogUGlja2luZ1Jlc3VsdCB8IGFueSkge1xyXG4gICAgICAgIGxldCBvID0gdHJ1ZTtcclxuICAgICAgICBpZiAocHIgPT09IHVuZGVmaW5lZCB8fCBwciA9PT0gbnVsbCB8fCBwciA9PT0gJycpIHtcclxuICAgICAgICAgICAgbyA9IHRydWU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodHlwZW9mIHByID09PSAnYm9vbGVhbicpIHtcclxuICAgICAgICAgICAgbyA9IHByO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgbGV0IGN1c3RvbURhdGEsIHNlbGVjdGVkSWRzLCBtZXNzYWdlO1xyXG4gICAgICAgIGN1c3RvbURhdGEgPSB0aGlzLmlucy5jdXN0b21EYXRhO1xyXG4gICAgICAgIHNlbGVjdGVkSWRzID0gdGhpcy5pbnMuc2VsZWN0ZWRJZHM7XHJcblxyXG4gICAgICAgIGlmICh0eXBlb2YgcHIgPT09ICdvYmplY3QnKSB7XHJcbiAgICAgICAgICAgIGlmIChwci5zaG93RGlhbG9nID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgIG8gPSB0cnVlO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgbyA9IHByLnNob3dEaWFsb2c7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmIChwci5oYXNPd25Qcm9wZXJ0eSgnZGF0YScpKSB7XHJcbiAgICAgICAgICAgICAgICAvKiog5L+d5a2Y5biu5Yqp5YmN5Lyg6YCS55qE5pWw5o2uICovXHJcbiAgICAgICAgICAgICAgICBjdXN0b21EYXRhID0gcHIuZGF0YTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBzZWxlY3RlZElkcyA9IHByLnNlbGVjdGVkSWRzIHx8IG51bGw7XHJcblxyXG4gICAgICAgICAgICBpZiAocHIubWVzc2FnZSkge1xyXG4gICAgICAgICAgICAgICAgbWVzc2FnZSA9IHByLm1lc3NhZ2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiB7IHNob3c6IG8sIGN1c3RvbURhdGEsIHNlbGVjdGVkSWRzLCBtZXNzYWdlIH07XHJcbiAgICB9XHJcblxyXG4gICAgY2FuT3BlbkRpYWxvZyhwcjogUGlja2luZ1Jlc3VsdCB8IGFueSkge1xyXG4gICAgICAgIGNvbnN0IHtzaG93LCBjdXN0b21EYXRhLCBzZWxlY3RlZElkcywgbWVzc2FnZX0gPSB0aGlzLmNoZWNrRGljdFBpY2tpbmdSZXN1bHQocHIpO1xyXG4gICAgICAgIHRoaXMuaW5zLmN1c3RvbURhdGEgPSBjdXN0b21EYXRhO1xyXG4gICAgICAgIHRoaXMuaW5zLnNlbGVjdGVkSWRzID0gc2VsZWN0ZWRJZHMgfHwgbnVsbDtcclxuICAgICAgICBpZiAobWVzc2FnZSkge1xyXG4gICAgICAgICAgICB0aGlzLmlucy5ub3RpZnlTZXJ2aWNlLndhcm5pbmcobWVzc2FnZSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLmlucy5pc1JlYWR5ID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy5pbnMuaXNTaG93ID0gc2hvdztcclxuICAgIH1cclxuXHJcbiAgICBnZXRIZWlnaHQoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuaW5zLmRpYWxvZy5zaXplLmNvbnRlbnRIZWlnaHQgLVxyXG4gICAgICAgICAgICAgICAgdGhpcy5pbnMuY29udGFpbmVyTWFyZ2luLmJvdHRvbSAtXHJcbiAgICAgICAgICAgICAgICB0aGlzLmlucy5jb250YWluZXJNYXJnaW4udG9wIC1cclxuICAgICAgICAgICAgICAgICghdGhpcy5pbnMudXNlTmV3TGF5b3V0ID8gKHRoaXMuaW5zLnVzZUZhdm9yaXRlID8gNDAgOiAgMCkgOiA1Nik7XHJcbiAgICAgICAgICAgIFxyXG4gICAgfVxyXG5cclxuXHJcbiAgICBwcml2YXRlIGdldE1haW5HcmlkU2l6ZSgpIHtcclxuICAgICAgICBpZiAodGhpcy5pbnMuaXNEb3VibGxlTGlzdCgpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICB3aWR0aDogdGhpcy5pbnMuZGlhbG9nLnNpemUud2lkdGggLSB0aGlzLmlucy5sZWZ0UGFuZWwud2lkdGggLSAyNyxcclxuICAgICAgICAgICAgICAgIGhlaWdodDogdGhpcy5nZXRIZWlnaHQoKVxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgd2lkdGg6IHRoaXMuaW5zLmRpYWxvZy5zaXplLndpZHRoIC0gdGhpcy5pbnMuY29udGFpbmVyTWFyZ2luLmxlZnQgLSB0aGlzLmlucy5jb250YWluZXJNYXJnaW4ucmlnaHQsXHJcbiAgICAgICAgICAgIGhlaWdodDogdGhpcy5nZXRIZWlnaHQoKVxyXG4gICAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgcmVzZXREaWFsb2dDb250ZW50SGVpZ2h0KCkge1xyXG4gICAgICAgIGNvbnN0IHsgaGVhZGVyOiBoSGVpZ2h0LCBmb290ZXI6IGZIZWlnaHQgfSA9IHRoaXMuaW5zLmRpYWxvZy5zaXplO1xyXG4gICAgICAgIHJldHVybiB0aGlzLmlucy5kaWFsb2dIZWlnaHQgLSBoSGVpZ2h0IC0gZkhlaWdodCAtICB0aGlzLmlucy5jb250YWluZXJNYXJnaW4uYm90dG9tIC0gdGhpcy5pbnMuY29udGFpbmVyTWFyZ2luLnRvcDtcclxuICAgIH1cclxuXHJcblxyXG4gICAgcHJpdmF0ZSByZWdpc3Rlck9rQnRuRXZlbnQoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuaW5zLm9rQnV0dG9uKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGRvdWJsZUNsaWNrRHVyYXRpb24gPSAyNTA7XHJcbiAgICAgICAgICAgIGNvbnN0IGxlZnRDbGljayQgPSBmcm9tRXZlbnQodGhpcy5pbnMub2tCdXR0b24ubmF0aXZlRWxlbWVudCwgJ2NsaWNrJykucGlwZShmaWx0ZXIoKGV2ZW50OiBhbnkpID0+IGV2ZW50LmJ1dHRvbiA9PT0gMCkpO1xyXG4gICAgICAgICAgICBjb25zdCBkZWJvdW5jZSQgPSBsZWZ0Q2xpY2skLnBpcGUoZGVib3VuY2VUaW1lKGRvdWJsZUNsaWNrRHVyYXRpb24pKTtcclxuICAgICAgICAgICAgY29uc3QgY2xpY2tMaW1pdCQgPSBsZWZ0Q2xpY2skLnBpcGUoYnVmZmVyQ291bnQoMikpO1xyXG4gICAgICAgICAgICBjb25zdCBidWZmZXJHYXRlJCA9IHJhY2UoZGVib3VuY2UkLCBjbGlja0xpbWl0JClcclxuICAgICAgICAgICAgLnBpcGUoXHJcbiAgICAgICAgICAgICAgLy8gV2UgYXJlIG9ubHkgaW50ZXJlc3RlZCBpbiB0aGUgZmlyc3QgZXZlbnQuIEFmdGVyIHRoYXRcclxuICAgICAgICAgICAgICAvLyB3ZSB3YW50IHRvIHJlc3RhcnQuXHJcbiAgICAgICAgICAgICAgZmlyc3QoKSxcclxuICAgICAgICAgICAgICByZXBlYXQoKSxcclxuICAgICAgICAgICAgKTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuX29rYnRuY2xpY2skID0gbGVmdENsaWNrJC5waXBlKFxyXG4gICAgICAgICAgICAgICAgYnVmZmVyKGJ1ZmZlckdhdGUkKSxcclxuICAgICAgICAgICAgICAgIC8vIEhlcmUgd2UgbWFwIHRoZSBidWZmZXJlZCBldmVudHMgaW50byB0aGUgbGVuZ3RoIG9mIHRoZSBidWZmZXJcclxuICAgICAgICAgICAgICAgIC8vIElmIHRoZSB1c2VyIGNsaWNrZWQgb25jZSwgdGhlIGJ1ZmZlciBpcyAxLiBJZiBoZSBjbGlja2VkIHR3aWNlIGl0IGlzIDJcclxuICAgICAgICAgICAgICAgIG1hcChjbGlja3MgPT4gY2xpY2tzLmxlbmd0aClcclxuICAgICAgICAgICAgKS5zdWJzY3JpYmUoY2xpY2tzID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMuaW5zLnNlbGVjdEl0ZW0oKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8qKiDms6jlhozlvLnlh7rnqpflj6PnmoTkuovku7YgKi9cclxuICAgIHByaXZhdGUgcmVnaXN0ZXJEaWFsb2dFdmVudCgpIHtcclxuICAgICAgICB0aGlzLmRpYWxvZ09wZW5lZFN1YnNjcmlwdGlvbiA9IHRoaXMuaW5zLmRpYWxvZy5vcGVuZWQuc3Vic2NyaWJlKCgpID0+IHtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuaW5zLmRpYWxvZ0NvbnRlbnRIZWlnaHQgPSB0aGlzLnJlc2V0RGlhbG9nQ29udGVudEhlaWdodCgpO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5pbnMuZ3JpZE9wdGlvbnMgPSBPYmplY3QuYXNzaWduKHRoaXMuaW5zLmdyaWRPcHRpb25zLCB0aGlzLmdldE1haW5HcmlkU2l6ZSgpKTtcclxuICAgICAgICAgICAgdGhpcy5pbnMuZGlhbG9nLmVsLm5hdGl2ZUVsZW1lbnQucXVlcnlTZWxlY3RvcignLnBzLWNvbnRlbnQnKS5zdHlsZS5oZWlnaHQgPSAnMTAwJSc7XHJcblxyXG4gICAgICAgICAgICBpZiAodGhpcy5pbnMuZGlzcGxheVR5cGUgJiYgdGhpcy5pbnMuY3VzdG9tRGlzcGxheVR5cGUpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuaW5zLmNvbXBvbmVudFJlZiA9IHRoaXMuaW5zLmxvb2t1cENtcE1nci5jcmVhdGVDb250ZW50KHRoaXMuaW5zLmdyaWRPcHRpb25zKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuaW5zLmxvb2t1cENtcE1nci5jcmVhdGVGYXZvcml0ZUNvbXBvbmVudCgpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB0aGlzLmlucy5pbml0RGF0YSgpO1xyXG5cclxuICAgICAgICAgICAgLy8g5L+u5pS55biu5Yqp56qX5Y+j55qE54q25oCBXHJcbiAgICAgICAgICAgIHRoaXMuaW5zLmxvb2t1cFV0aWxzLnBlbmRpbmdFbmQoKTtcclxuICAgICAgICAgICAgdGhpcy5pbnMuZGlhbG9nT3BlbmVkLmVtaXQoKTtcclxuXHJcbiAgICAgICAgICAgIC8vIOazqOWGjOehruWumuaMiemSrueCueWHu+S6i+S7tlxyXG4gICAgICAgICAgICB0aGlzLnJlZ2lzdGVyT2tCdG5FdmVudCgpO1xyXG5cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgdGhpcy5sb29rdXBJbml0ID0gdGhpcy5pbnMubG9va3VwaW5pdGlhbGl6YXRpb25TdWJqZWN0LnN1YnNjcmliZSgoKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuaW5zLmxvYWREYXRhV2hlbk9wZW4gPSB0cnVlO1xyXG4gICAgICAgICAgICAvLyDms6jlhozlv6vmjbfplK5cclxuICAgICAgICAgICAgdGhpcy5yZWdpc3RlclNob3J0Y3V0S2V5KCk7XHJcbiAgICAgICAgICAgIC8vIOebkeWQrOW3puS+p+WwuuWvuOWPmOWMluS6i+S7tlxyXG4gICAgICAgICAgICBpZiAodGhpcy5pbnMubGVmdFBhbmVsKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuaW5zLmxlZnRQYW5lbC5yZXNpemluZy5vYnNlcnZlcnMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgbGVmdFBhbmVsUmVzaXplJCA9IHRoaXMuaW5zLmxlZnRQYW5lbC5yZXNpemluZy5waXBlKFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBkZWJvdW5jZVRpbWUoNTApXHJcbiAgICAgICAgICAgICAgICAgICAgKS5zdWJzY3JpYmUoKHM6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzaXplID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IHRoaXMuaW5zLmRpYWxvZy5zaXplLndpZHRoIC0gcy5zaXplLndpZHRoIC0gdGhpcy5pbnMuZ2V0U3BhY2VXaWR0aCh0cnVlKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodDogdGhpcy5nZXRIZWlnaHQoKSAtIHRoaXMuaW5zLmdldEZpbHRlckJhckhlaWdodCgpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnMuY29tcG9uZW50UmVmLmluc3RhbmNlLnJlc2l6ZShzaXplKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnMubGVmdENvbXBvbmVudFJlZi5pbnN0YW5jZS5yZXNpemUocy5zaXplKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnMuc3Vic2NyaXB0aW9ucy5wdXNoKGxlZnRQYW5lbFJlc2l6ZSQpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuaW5zLmlzRG91YmxsZUxpc3QoKSAmJiB0aGlzLmlucy5sZWZ0Q29tcG9uZW50UmVmKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnMubGVmdENvbXBvbmVudFJlZi5pbnN0YW5jZS51cGRhdGVTY3JvbGxQb3NpdGlvbigpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAodGhpcy5pbnMuY2FzY2FkZVNlbGVjdCkge1xyXG4gICAgICAgICAgICAgICAgY29uc3Qge3NlbGVjdEVsLCBwYW5lbFJlZiB9ID0gdGhpcy5pbnMuY2FzY2FkZVNlbGVjdDtcclxuICAgICAgICAgICAgICAgIHRoaXMuaW5zLmNhc2NhZGVTZWxlY3QuYmVmb3JlU2hvdyA9ICgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoc2VsZWN0RWwgJiYgcGFuZWxSZWYpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcGFuZWxSZWYuc3R5bGUubGVmdCA9IGAke3NlbGVjdEVsLm9mZnNldExlZnR9cHhgO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5pbnMubG9jYWxTZXJ2aWNlLmxvY2FsZUlkLnRvTG9jYWxlTG93ZXJDYXNlKCkgPT0gJ2VuJykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFuZWxSZWYuc3R5bGUud2lkdGggPSAnYXV0byc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYW5lbFJlZi5zdHlsZS5tYXhXaWR0aCA9ICcyMDBweCdcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gb2YodHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHRoaXMuZGlhbG9nQ2xvc2VkU3Vic2NyaXB0aW9uID0gdGhpcy5pbnMuZGlhbG9nLmNsb3NlZC5zdWJzY3JpYmUoKCkgPT4ge1xyXG4gICAgICAgICAgICAvLyDovpPlhaXmoYblj5jljJblkI7vvIzlvLnlh7rnqpflj6PmnKrpgInmi6nmlbDmja7lhbPpl63nqpflj6Pml7bvvIzov5jljp/ljp/lp4vlgLxcclxuICAgICAgICAgICAgdGhpcy5pbnMuZGlhbG9nTWdyLmRpYWxvZ0Nsb3NlZCgpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICAvLyB0aGlzLmlucy5zdWJzY3JpcHRpb25zLnB1c2godGhpcy5pbnMuZGlhbG9nQ2xvc2VkU3Vic2NyaXB0aW9uKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHJlZ2lzdGVyU2hvcnRjdXRLZXkoKSB7XHJcbiAgICAgICAgLy8g5Zue6L2m77yM5LiO56Gu5a6a5oyJ6ZKu5aSE55CG6YC76L6R5LiA6Iez44CCXHJcbiAgICAgICAgY29uc3QgZGxnQ29udGFpbmVyRG9tID0gdGhpcy5pbnMuZGlhbG9nLmVsLm5hdGl2ZUVsZW1lbnQucXVlcnlTZWxlY3RvcignLmZhcnJpcy1tb2RhbCcpO1xyXG5cclxuICAgICAgICBpZiAoZGxnQ29udGFpbmVyRG9tICYmIHRoaXMuaW5zLnNob3J0Y3V0S2V5ICYmICF0aGlzLmtleURvd25IYW5kbGVyKSB7XHJcbiAgICAgICAgICAgIHRoaXMua2V5RG93bkhhbmRsZXIgPSB0aGlzLmlucy5ldmVudE1hbmFnZXIuYWRkRXZlbnRMaXN0ZW5lcihkbGdDb250YWluZXJEb20sICdrZXlkb3duJywgKGU6IEtleWJvYXJkRXZlbnQpID0+IHtcclxuICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICAgICAgICAgICAgICBjb25zdCB7IG1vdmVVcCwgbW92ZURvd24sIHNlYXJjaEZvY3VzLCBjb25maXJtLCBuZXh0UGFnZXIsIHByZXZQYWdlciwgZXhwYW5kLCBjb2xsYXBzZSB9ID0gdGhpcy5pbnMuc2hvcnRjdXRLZXk7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBhcnJvd0tleSA9IFttb3ZlVXAsIG1vdmVEb3duLCBleHBhbmQsIGNvbGxhcHNlXTtcclxuICAgICAgICAgICAgICAgIGlmIChhcnJvd0tleS5pbmNsdWRlcyhlLmNvZGUpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnMuY29tcG9uZW50UmVmLmluc3RhbmNlLm9uS2V5ZG93bkV2ZW50KGUpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChlLmtleSA9PT0gY29uZmlybSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChlLnRhcmdldFsnbm9kZU5hbWUnXSA9PT0gJ0lOUFVUJyAmJiAhZS5jdHJsS2V5KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnMub2tCdXR0b24ubmF0aXZlRWxlbWVudC5jbGljaygpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChlLmNvZGUgPT09IHNlYXJjaEZvY3VzKSB7IC8vIOW4ruWKqeeql+WPo+afpeivoui+k+WFpeahhueEpueCuVxyXG4gICAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmlucy5jb21wb25lbnRSZWYuaW5zdGFuY2UuaW5wdXRHcm91cC5mb2N1cygpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmICghdGhpcy5pbnMuaXNUcmVlKCkgJiYgKGUuY29kZSA9PT0gbmV4dFBhZ2VyIHx8IGUuY29kZSA9PT0gcHJldlBhZ2VyICkpIHsgIC8vIOWIhumhtVxyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGlzTmV4dFBhZ2VyID0gZS5jb2RlID09PSBuZXh0UGFnZXI7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wYWdpbmF0aW9uS2V5RG93bkhhbmRsZXIoaXNOZXh0UGFnZXIpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBwYWdpbmF0aW9uS2V5RG93bkhhbmRsZXIobmV4dCA9IHRydWUpIHtcclxuICAgICAgICBjb25zdCBkYXRhdGFibGVSZWYgPSB0aGlzLmlucy5jb21wb25lbnRSZWYuaW5zdGFuY2U7XHJcbiAgICAgICAgY29uc3Qge3BhZ2VJbmRleCwgcGFnZVNpemUsIHRvdGFsfSA9IGRhdGF0YWJsZVJlZjtcclxuICAgICAgICBjb25zdCBwYWdlckNvdW50ID0gTWF0aC5jZWlsKHRvdGFsIC8gcGFnZVNpemUpO1xyXG5cclxuICAgICAgICBsZXQgbmV3UGFnZU51bSA9IHBhZ2VJbmRleDtcclxuICAgICAgICBpZiAobmV4dCkge1xyXG4gICAgICAgICAgICBuZXdQYWdlTnVtID0gbmV3UGFnZU51bSArIDE7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgbmV3UGFnZU51bSA9IG5ld1BhZ2VOdW0gLSAxO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKG5ld1BhZ2VOdW0gPiBwYWdlckNvdW50IHx8IG5ld1BhZ2VOdW0gPCAxKSB7XHJcbiAgICAgICAgICAgIG5ld1BhZ2VOdW0gPSBwYWdlSW5kZXg7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLmlucy5jb21wb25lbnRSZWYuaW5zdGFuY2Uub25QYWdlQ2hhbmdlKHsgcGFnZVNpemUsIHBhZ2VJbmRleDogbmV3UGFnZU51bSB9KTtcclxuICAgIH1cclxuXHJcbn1cclxuXHJcbiJdfQ==
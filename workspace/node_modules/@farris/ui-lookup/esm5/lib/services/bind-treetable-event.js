/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { FavoriteAction, FAVORITE_FIELD_NAME } from '../lookup-displaytype';
import { cloneDeep } from 'lodash-es';
import { of } from 'rxjs';
import { tap, catchError } from 'rxjs/operators';
var TreeTableEventManager = /** @class */ (function () {
    function TreeTableEventManager(ins) {
        var _this_1 = this;
        this.ins = ins;
        this._sortState = null;
        /**
         * 标识当前数据是否查询结果
         */
        this.IS_SEARCH_RESULT = false;
        this._isLoadAllTreeData = (/**
         * @param {?} tt
         * @return {?}
         */
        function (tt) {
            if (_this_1.ins.loadTreeDataType === 'default') {
                return tt.loadDataType === 'all';
            }
            else {
                return _this_1.ins.loadTreeDataType === 'loadall';
            }
        });
        this._isAsyncLoadTreeData = (/**
         * @param {?} tt
         * @return {?}
         */
        function (tt) {
            if (_this_1.ins.loadTreeDataType === 'default') {
                return tt.loadDataType === 'async';
            }
            else {
                return _this_1.ins.loadTreeDataType === 'layerload';
            }
        });
        this.lookupSelectionSer = this.ins.lookupSelectionSer;
    }
    /**
     * @param {?} conditions
     * @return {?}
     */
    TreeTableEventManager.prototype.conditionsChange = /**
     * @param {?} conditions
     * @return {?}
     */
    function (conditions) {
        this.ins.conditions = conditions;
        if (this.ins.uri) {
            if (conditions && conditions.length === 1 && conditions[0].code == '*') {
                this.ins.conditions = [];
                return this.searchTreeData({ field: '*', value: conditions[0].value });
            }
            return this.searchTreeData({ field: '*', value: '' });
        }
        else {
            this.ins.query.emit({ conditions: conditions, instance: this.ins });
        }
    };
    /**
     * @param {?} search
     * @return {?}
     */
    TreeTableEventManager.prototype.searchTreeData = /**
     * @param {?} search
     * @return {?}
     */
    function (search) {
        var _this_1 = this;
        /** @type {?} */
        var tt = (/** @type {?} */ (this.ins.componentRef.instance));
        // 判断uri 发出search.emit();
        if (this.ins.searching) {
            return;
        }
        else {
            this.ins.searching = true;
        }
        this.ins.showLoading();
        if (tt && tt.psRef && tt.psRef.directiveRef) {
            tt.psRef.directiveRef.scrollToTop(0);
        }
        return this.ins.httpMgr.getData({ search: search, sortName: tt.sortName, sortOrder: tt.sortOrder }, 'search').pipe(tap((/**
         * @return {?}
         */
        function () {
            _this_1.ins.searching = false;
        })), catchError((/**
         * @param {?} err
         * @return {?}
         */
        function (err) {
            _this_1.ins.searching = false;
            return of(err);
        }))).subscribe((/**
         * @param {?} resData
         * @return {?}
         */
        function (resData) {
            _this_1.ins.closeLoading();
            if (resData) {
                // this.ins.items = resData.items;
                tt.clearAll();
                /** @type {?} */
                var treeInfo = _this_1.ins.gridOptions.treeInfo;
                if (!treeInfo['treeDataIsInit']) {
                    if (treeInfo.layerType.toLowerCase() === 'pathcode') {
                        _this_1.ins.items = _this_1.ins.lookupUtils.makeTree(_this_1.ins.items, treeInfo);
                    }
                    else {
                        _this_1.ins.items = _this_1.ins.lookupUtils.makeTreeWithParentID(_this_1.ins.items, '', treeInfo.dataField ? treeInfo.dataField + "." + treeInfo.parentField : treeInfo.parentField, _this_1.ins.idField);
                    }
                }
                /** @type {?} */
                var checkNodes_1 = (/**
                 * @param {?} nodes
                 * @return {?}
                 */
                function (nodes) {
                    if (nodes && nodes.length) {
                        return nodes.map((/**
                         * @param {?} node
                         * @return {?}
                         */
                        function (node) {
                            if (node.hasOwnProperty('addtional')) {
                                node.selectable = !node['addtional'];
                            }
                            if (node.children && node.children.length) {
                                checkNodes_1(node.children);
                            }
                            else {
                                if (_this_1._isLoadAllTreeData(tt) && (!search || search.value === '' || search.value === undefined)) {
                                    node.leaf = true;
                                }
                            }
                            return node;
                        }));
                    }
                    return nodes;
                });
                /** @type {?} */
                var _nodes = checkNodes_1(resData.items);
                if (_nodes && _nodes.length && _nodes[0].children && _nodes[0].children.length) {
                    _nodes[0].expanded = true;
                    _nodes[0].children = _this_1.ins.expandFirstNode(_nodes[0].children);
                }
                _this_1.ins.items = _nodes;
                // 加载收藏数据
                if (_this_1.ins.useFavorite) {
                    // 更新数据的收藏状态
                    _this_1.ins.favHelper.updateFavoritesStatus(_this_1.ins.items);
                }
                tt.loadData(_this_1.ins.items);
                // // 展开查询结果。
                // if (search.value && this.ins.items.length) {
                //     tt.toggleExpand(this.ins.items[0], true);
                // }
                tt.resize();
                _this_1.IS_SEARCH_RESULT = true;
                _this_1.ins.selectionMgr.selectCurrentValue();
            }
            _this_1.ins.search.emit(search);
        }));
    };
    /**
     * @private
     * @param {?} parentPath
     * @param {?} parentLayer
     * @param {?} searchData
     * @return {?}
     */
    TreeTableEventManager.prototype.getChildren = /**
     * @private
     * @param {?} parentPath
     * @param {?} parentLayer
     * @param {?} searchData
     * @return {?}
     */
    function (parentPath, parentLayer, searchData) {
        /** @type {?} */
        var uri = this.ins.gridOptions.uri;
        /** @type {?} */
        var search = tslib_1.__assign({ parentLayer: parentLayer, category: 'children' }, searchData);
        if (this.ins.treeInfo.layerType === 'parentId') {
            search['parentId'] = parentPath;
        }
        else {
            search['parentPath'] = parentPath;
        }
        /** @type {?} */
        var param = {
            searchValue: '',
            customData: this.ins.customData,
            enableFullTree: this.ins.enableFullTree,
            loadTreeDataType: this.ins.loadTreeDataType
        };
        /** @type {?} */
        var tt = (/** @type {?} */ (this.ins.componentRef.instance));
        if (tt && tt.sortName) {
            Object.assign(search, {
                sortName: tt.sortName,
                sortOrder: tt.sortOrder
            });
        }
        if (this.IS_SEARCH_RESULT) {
            param.enableFullTree = false;
            param.loadTreeDataType = 'layerload';
            if (this.ins.treeInfo.layerType === 'parentId') {
                // 树形帮助查询后，展开节点时将相关查询参数传递到后端 2022-09-13
                search.searchValue = '';
                search.searchField = '*';
            }
            // param.searchValue = JSON.stringify(search);
        }
        param.searchValue = JSON.stringify(search);
        if (this.ins.helpId) {
            param['helpId'] = this.ins.helpId;
        }
        if (this.ins.conditions && this.ins.conditions.length) {
            param.searchConditions = cloneDeep(this.ins.conditions);
        }
        return this.ins.http.getData(uri, param);
    };
    /**
     * @return {?}
     */
    TreeTableEventManager.prototype.bindTreetableEvent = /**
     * @return {?}
     */
    function () {
        var _this_1 = this;
        /** @type {?} */
        var tt = (/** @type {?} */ (this.ins.componentRef.instance));
        /** @type {?} */
        var _searchTreeData = (/**
         * @param {?} searchparam
         * @return {?}
         */
        function (searchparam) {
            if (_this_1.ins.remoteSearch) {
                _this_1.ins._searchState = searchparam;
                _this_1.searchTreeData(searchparam);
            }
            else {
                if (_this_1.ins.useInsideSearchHandler) {
                    tt.searchHandle.search(searchparam.field, searchparam.value, 'client');
                }
                else {
                    _this_1.ins.search.emit(searchparam);
                }
            }
        });
        /** @type {?} */
        var isLoadAllTreeData = (/**
         * @return {?}
         */
        function () {
            return _this_1._isLoadAllTreeData(tt);
        });
        /** @type {?} */
        var isAsyncLoadTreeData = (/**
         * @return {?}
         */
        function () {
            return _this_1._isAsyncLoadTreeData(tt);
        });
        tt.dblClickExpand = !this.ins.singleSelect; // 禁用双击展开节点
        tt.allColumnsTitle = this.ins.allColumnsTitle; // this.displayInfo.allColumns;
        tt.idField = this.ins.idField;
        tt.columns = this.ins.columns;
        tt.searchFields = this.ins.gridOptions.searchFields;
        if (this.ins.treeInfo) {
            tt.loadDataType = this.ins.treeInfo.loadDataType;
            tt.virtualized = true;
            if (!this.ins.isTextChange) {
                this.ins.allData = cloneDeep(this.ins.items);
            }
            else {
                this.ins.allData = [];
            }
        }
        if (this.ins.gridOptions.treeInfo) {
            tt.onlySelectLeaf = this.ins.gridOptions.treeInfo.onlySelectLeaf;
            tt.loadDataType = this.ins.gridOptions.treeInfo.loadDataType;
        }
        if (!tt.singleSelect) {
            tt.checkOnSelect = true;
            tt.selectOnCheck = true;
            tt.showCheckbox = true;
            tt.showCheckAll = this.ins.showCheckAll;
            // 启用多选后，同时启用级联选择
            if (this.ins.enableCascade) {
                this.cascadeValueChanged(this.ins.cascadeStatus);
            }
            else {
                tt.cascadeCheck = false;
                tt.cascadeDown = false;
                tt.cascadeUp = false;
            }
        }
        tt.enableFindText = this.ins.enableFindText;
        // tt.findField = this.textField;
        tt.nodeSelected.subscribe((/**
         * @param {?} e
         * @return {?}
         */
        function (e) {
            // if (this.ins.favoritesComponentRef && this.ins.singleSelect) {
            //     const ftt = this.ins.favoritesComponentRef.instance as TreeTableComponent;
            //     ftt.clearSelections();
            // }
            if (_this_1.ins.singleSelect) {
                _this_1.lookupSelectionSer.clearSelections();
            }
            _this_1.lookupSelectionSer.updateSelections([e.node.data]);
            _this_1.ins.checkedChange.emit({ data: [e.node.data], isCheck: true });
        }));
        tt.nodeChecked.subscribe((/**
         * @param {?} e
         * @return {?}
         */
        function (e) {
            if (!_this_1.ins.singleSelect) {
                /** @type {?} */
                var data = null;
                if (e.nodes && e.nodes.length) {
                    data = e.nodes.map((/**
                     * @param {?} n
                     * @return {?}
                     */
                    function (n) { return n.data; }));
                }
                else {
                    if (Array.isArray(e.node)) {
                        data = e.node.map((/**
                         * @param {?} n
                         * @return {?}
                         */
                        function (n) { return n.data; }));
                    }
                    else {
                        data = [e.node.data];
                    }
                }
                _this_1.ins.multiSelMgr.updateSelections(data);
                _this_1.ins.checkedChange.emit({ data: data, isCheck: true });
            }
        }));
        tt.nodeUnChecked.subscribe((/**
         * @param {?} e
         * @return {?}
         */
        function (e) {
            if (e && e.node) {
                /** @type {?} */
                var nodeData = null;
                if (e.node.data) {
                    nodeData = e.node.data;
                }
                else {
                    if (e.node.node && e.node.node.data) {
                        nodeData = e.node.node.data;
                    }
                }
                if (!nodeData) {
                    return;
                }
                if (!_this_1.ins.singleSelect) {
                    _this_1.ins.multiSelMgr.remove(e.node.id);
                    // 分层加载，多选，包含下级时，取消勾选 需要将当前节点的所有子级数据也要取消选择，即从已选记录中移除
                    if (tt.loadDataType !== 'all' && _this_1.ins.treeInfo.layerType === 'pathcode' && _this_1.ins.enableCascade &&
                        (_this_1.ins.cascadeStatus === 'enable' || _this_1.ins.cascadeStatus === 'down')) {
                        if (e.node.children && e.node.children.length) {
                            /** @type {?} */
                            var nodes = e.node.children.map((/**
                             * @param {?} n
                             * @return {?}
                             */
                            function (n) { return n.data; }));
                            _this_1.ins.lookupSelectionSer.updateSelections(nodes, false);
                        }
                        else {
                            /** @type {?} */
                            var pathcode = _this_1.ins.getPathCode(nodeData, _this_1.ins.treeInfo);
                            _this_1.ins.lookupSelectionSer.unselectByPathcode(pathcode);
                        }
                    }
                    if (e.nodes && e.nodes.length) {
                        _this_1.ins.multiSelMgr.remove(e.nodes.map((/**
                         * @param {?} n
                         * @return {?}
                         */
                        function (n) { return n.id; })));
                        _this_1.ins.checkedChange.emit({ data: e.nodes.map((/**
                             * @param {?} n
                             * @return {?}
                             */
                            function (n) { return n.data; })), isCheck: false });
                    }
                    else {
                        _this_1.ins.checkedChange.emit({ data: [nodeData], isCheck: false });
                    }
                }
                else {
                    /** @type {?} */
                    var ftt = _this_1.ins.favoritesComponentRef && ((/** @type {?} */ (_this_1.ins.favoritesComponentRef.instance)));
                    if (ftt && ftt.findRowNode(e.node.id)) {
                        ftt.unSelectNode(e.node.id);
                    }
                    _this_1.ins.checkedChange.emit({ data: [nodeData], isCheck: false });
                }
            }
        }));
        tt.checkAll.subscribe((/**
         * @param {?} e
         * @return {?}
         */
        function (e) {
            /** @type {?} */
            var data = e.instance.checkeds.map((/**
             * @param {?} n
             * @return {?}
             */
            function (n) { return n.data; }));
            _this_1.ins.multiSelMgr.updateSelections(data);
            _this_1.ins.checkedChange.emit({ data: data, isCheck: true });
        }));
        tt.unCheckAll.subscribe((/**
         * @return {?}
         */
        function () {
            _this_1.ins.multiSelMgr.clear();
            _this_1.ins.checkedChange.emit({ data: [], isCheck: false });
        }));
        tt.search.subscribe((/**
         * @param {?} searchparam
         * @return {?}
         */
        function (searchparam) {
            if (searchparam.field !== '*' && !searchparam.value) {
                _this_1.ins.messagerService.warning(_this_1.ins.mustWriteSomething);
            }
            else {
                searchparam.value = searchparam.value.trim();
                _searchTreeData(searchparam);
            }
        }));
        if (!tt.cellClick.observers.length) {
            tt.cellClick.subscribe((/**
             * @param {?} e
             * @return {?}
             */
            function (e) {
                if (e.col.field === FAVORITE_FIELD_NAME) {
                    e.event.stopPropagation();
                    // tslint:disable-next-line: no-string-literal
                    /** @type {?} */
                    var classList = e.event.target['classList'];
                    if (classList.contains('f-lookup-favorite')) {
                        // classList.toggle('f-icon-star');
                        // classList.toggle('f-icon-star-outline');
                        /** @type {?} */
                        var _this_2 = _this_1.ins;
                        ((/**
                         * @param {?} arr
                         * @return {?}
                         */
                        function each(arr) {
                            if (arr) {
                                arr.forEach((/**
                                 * @param {?} item
                                 * @return {?}
                                 */
                                function (item) {
                                    /** @type {?} */
                                    var id = _this_2.utils.getValue(_this_2.idField, item.data);
                                    if (id === e.node.id) {
                                        item.data[FAVORITE_FIELD_NAME] = !item.data[FAVORITE_FIELD_NAME];
                                        return true;
                                    }
                                    else if (item.children && item.children.length > 0) {
                                        return each(item.children);
                                    }
                                    else {
                                        return false;
                                    }
                                }));
                            }
                        }))(_this_1.ins.items);
                        tt.loadData(_this_1.ins.items);
                        // 更新收藏数据
                        _this_1.lookupSelectionSer.updateFavoriteData(e.node.data, e.node.data[FAVORITE_FIELD_NAME] ? FavoriteAction.add : FavoriteAction.delete);
                    }
                }
            }));
        }
        tt.dblClick.subscribe((/**
         * @param {?} treeNode
         * @return {?}
         */
        function (treeNode) {
            if (_this_1.ins.gridOptions.singleSelect && treeNode.selectable) {
                if (_this_1.ins.okButton) {
                    // this.lookupSelectionSer.select(treeNode.data);
                    // this.ins.okButton.nativeElement.click();
                    _this_1.ins.selectItem(treeNode.data);
                }
            }
        }));
        /** @type {?} */
        var loadAllData = isLoadAllTreeData();
        tt.columnSorted.subscribe((/**
         * @param {?} sort
         * @return {?}
         */
        function (sort) {
            _this_1._sortState = sort;
            if (isLoadAllTreeData()) {
                tt.clientSort();
            }
            else {
                var _a = tslib_1.__assign({}, sort), sortName_1 = _a.sortName, sortOrder = _a.sortOrder;
                /** @type {?} */
                var col = _this_1.ins.columns.find((/**
                 * @param {?} n
                 * @return {?}
                 */
                function (n) { return n.field === sortName_1; }));
                /** @type {?} */
                var _sortName = col ? col.fieldPath ? col.fieldPath : col.field : sortName_1;
                /** @type {?} */
                var param = Object.assign({ sortName: _sortName, sortOrder: sortOrder }, { search: _this_1.ins._searchState });
                /** @type {?} */
                var reqTyp = 'all';
                if (_this_1.ins._searchState && _this_1.ins._searchState.value) {
                    reqTyp = 'search';
                }
                _this_1.ins.httpMgr.getData(param, reqTyp).subscribe((/**
                 * @param {?} d
                 * @return {?}
                 */
                function (d) {
                    _this_1.ins.closeLoading();
                    tt.clearAll();
                    /** @type {?} */
                    var items = _this_1.ins.checkNodeCanBeSelect(d.items, false);
                    if (_this_1.ins.useFavorite) {
                        _this_1.ins.favHelper.updateFavoritesStatus(items);
                    }
                    _this_1.ins.items = items;
                    tt.loadData(items);
                    tt.resize();
                    _this_1.ins.selectionMgr.selectCurrentValue();
                }));
            }
        }));
        tt.clearSearchValue.subscribe((/**
         * @return {?}
         */
        function () {
            if (tt && tt.psRef && tt.psRef.directiveRef) {
                tt.psRef.directiveRef.scrollToTop(0);
            }
            _this_1.ins._searchState = null;
            _this_1.IS_SEARCH_RESULT = false;
            /** @type {?} */
            var _items = [];
            if (_this_1.ins.allData && _this_1.ins.allData.length) {
                _items = _this_1.ins.checkNodeCanBeSelect(_this_1.ins.allData, loadAllData);
            }
            if (!_items || !_items.length) {
                _searchTreeData({ field: '*', value: '' });
            }
            else {
                _this_1.ins.items = _items;
                _this_1.ins.favHelper.updateFavoritesStatus(_this_1.ins.items);
                tt.loadData(_items);
                _this_1.ins.selectionMgr.selectCurrentValue();
            }
        }));
        tt.expand.subscribe((/**
         * @param {?} tn
         * @return {?}
         */
        function (tn) {
            if (tn.leaf || tn['showLoading']) {
                return;
            }
            if (!tn.children || !tn.children.length) {
                /** @type {?} */
                var treeInfo = _this_1.ins.gridOptions.treeInfo;
                if (isAsyncLoadTreeData() || _this_1.IS_SEARCH_RESULT) {
                    /** @type {?} */
                    var parentPath = '';
                    /** @type {?} */
                    var parentLayer = -1;
                    var _a = tslib_1.__assign({}, tt.searchData), _b = _a.field, field = _b === void 0 ? '*' : _b, _c = _a.value, value = _c === void 0 ? '' : _c;
                    tn['showLoading'] = true;
                    tt.detectChanges();
                    if (treeInfo.layerType === 'parentId') {
                        // 父ID加载方式
                        parentPath = tn['id'];
                    }
                    else {
                        /** @type {?} */
                        var treeInfoField = treeInfo.dataField;
                        if (treeInfoField) {
                            // parentPath = tn.data[treeInfoField][treeInfo.pathField];
                            parentPath = _this_1.ins.getPathCode(tn.data, treeInfo);
                            // parentLayer = tn.data[treeInfoField][treeInfo.layerField];
                            parentLayer = _this_1.ins.getLayerData(tn.data, treeInfo);
                        }
                        else {
                            _this_1.ins.writeConsole('未找到分级信息。');
                        }
                    }
                    if (!_this_1.ins.uri) {
                        tn['showLoading'] = false;
                        _this_1.ins.expandTreeNode.emit({
                            instance: tt, node: tn,
                            parentIdOrPath: parentPath, parentLayer: parentLayer, search: { value: value, field: field }
                        });
                        return;
                    }
                    _this_1.ins.showLoading();
                    _this_1.getChildren(parentPath, parentLayer, {
                        searchField: field === '*' ? '*' : field,
                        searchValue: value
                    }).subscribe((/**
                     * @param {?} data
                     * @return {?}
                     */
                    function (data) {
                        _this_1.ins.closeLoading();
                        if (tt) {
                            if (tn && data.items && data.items.length) {
                                if (_this_1.ins.useFavorite) {
                                    // 更新子节点收藏状态
                                    _this_1.ins.favHelper.updateFavoritesStatus(data.items);
                                }
                                /** @type {?} */
                                var nodes = _this_1.ins.checkNodeCanBeSelect(data.items, false);
                                tt.appendChildren(nodes, tn);
                                if (tt.loadDataType !== 'all' && !_this_1.ins.singleSelect && _this_1.ins.isGetAllChidlNodes &&
                                    (_this_1.ins.cascadeStatus === 'enable' || _this_1.ins.cascadeStatus === 'down')) {
                                    /** @type {?} */
                                    var rn = tt.findRowNode(tn.id);
                                    tt.propagateSelectionDown(rn, rn.isChecked);
                                    // 更新选中记录缓存
                                    /** @type {?} */
                                    var _items = data.items.filter((/**
                                     * @param {?} n
                                     * @return {?}
                                     */
                                    function (n) { return !n.addtional; }));
                                    if (_items && _items.length) {
                                        _this_1.ins.lookupSelectionSer.updateSelections(_items.map((/**
                                         * @param {?} n
                                         * @return {?}
                                         */
                                        function (n) { return n.data; })), rn.isChecked);
                                    }
                                }
                            }
                            tn['showLoading'] = false;
                            tt.detectChanges();
                            tt.psRef.directiveRef.update();
                            _this_1.ins.selectionMgr.selectCurrentValue();
                        }
                    }));
                }
            }
            else {
                if (!_this_1.ins.singleSelect && _this_1.ins.enableCascade &&
                    (_this_1.ins.cascadeStatus === 'enable' || _this_1.ins.cascadeStatus === 'down') && _this_1.ins.isGetAllChidlNodes) {
                    /** @type {?} */
                    var rn = tt.findRowNode(tn.id);
                    tt.propagateSelectionDown(rn, rn.isChecked);
                    /** @type {?} */
                    var selectItems = tn.children.filter((/**
                     * @param {?} n
                     * @return {?}
                     */
                    function (n) { return n.selectable; })).map((/**
                     * @param {?} n
                     * @return {?}
                     */
                    function (n) { return n.data; }));
                    _this_1.ins.lookupSelectionSer.updateSelections(selectItems, rn.isChecked);
                }
                // this.ins.selectionMgr.selectCurrentValue();
            }
        }));
        if (loadAllData && this.ins.items) {
            this.ins.treeNodeHelper.updateTreeNodeExpanded(this.ins.items);
        }
        return loadAllData;
    };
    /**
     * @param {?} $event
     * @return {?}
     */
    TreeTableEventManager.prototype.cascadeValueChanged = /**
     * @param {?} $event
     * @return {?}
     */
    function ($event) {
        /** @type {?} */
        var val = $event;
        // const tt = this.ins.componentRef.instance as TreeTableComponent;
        /** @type {?} */
        var instanceTyp = this.ins.activeTab === 'datalist' ? 'treetable' : 'fav';
        /** @type {?} */
        var tt = (/** @type {?} */ (this.ins.lookupCmpMgr.getComponentInstance(instanceTyp)));
        if (!tt) {
            return;
        }
        switch (val) {
            case 'enable':
                tt.cascadeCheck = true;
                tt.cascadeDown = true;
                tt.cascadeUp = true;
                break;
            case 'disable':
                tt.cascadeCheck = false;
                tt.cascadeDown = false;
                tt.cascadeUp = false;
                break;
            case 'up':
                tt.cascadeCheck = true;
                tt.cascadeUp = true;
                tt.cascadeDown = false;
                break;
            case 'down':
                tt.cascadeCheck = true;
                tt.cascadeDown = true;
                tt.cascadeUp = false;
                break;
            default:
                tt.cascadeCheck = true;
                tt.cascadeDown = true;
                tt.cascadeUp = true;
                break;
        }
        this.ins.cascadeStatus = val || 'enable';
        this.ins.personalConf.cascadeStatus = val || 'enable';
    };
    return TreeTableEventManager;
}());
export { TreeTableEventManager };
if (false) {
    /**
     * @type {?}
     * @private
     */
    TreeTableEventManager.prototype.lookupSelectionSer;
    /**
     * @type {?}
     * @private
     */
    TreeTableEventManager.prototype._sortState;
    /**
     * 标识当前数据是否查询结果
     * @type {?}
     * @private
     */
    TreeTableEventManager.prototype.IS_SEARCH_RESULT;
    /**
     * @type {?}
     * @private
     */
    TreeTableEventManager.prototype._isLoadAllTreeData;
    /**
     * @type {?}
     * @private
     */
    TreeTableEventManager.prototype._isAsyncLoadTreeData;
    /**
     * @type {?}
     * @private
     */
    TreeTableEventManager.prototype.ins;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmluZC10cmVldGFibGUtZXZlbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL3VpLWxvb2t1cC8iLCJzb3VyY2VzIjpbImxpYi9zZXJ2aWNlcy9iaW5kLXRyZWV0YWJsZS1ldmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUNBLE9BQU8sRUFBRSxjQUFjLEVBQUUsbUJBQW1CLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQUU1RSxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sV0FBVyxDQUFDO0FBQ3RDLE9BQU8sRUFBYyxFQUFFLEVBQVcsTUFBTSxNQUFNLENBQUM7QUFFL0MsT0FBTyxFQUFRLEdBQUcsRUFBRSxVQUFVLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUt2RDtJQVNJLCtCQUFvQixHQUF3QjtRQUE1QyxtQkFFQztRQUZtQixRQUFHLEdBQUgsR0FBRyxDQUFxQjtRQVBwQyxlQUFVLEdBQUcsSUFBSSxDQUFDOzs7O1FBSWxCLHFCQUFnQixHQUFHLEtBQUssQ0FBQztRQXdLekIsdUJBQWtCOzs7O1FBQUcsVUFBQyxFQUFFO1lBQzVCLElBQUksT0FBSSxDQUFDLEdBQUcsQ0FBQyxnQkFBZ0IsS0FBSyxTQUFTLEVBQUU7Z0JBQ3pDLE9BQU8sRUFBRSxDQUFDLFlBQVksS0FBSyxLQUFLLENBQUM7YUFDcEM7aUJBQU07Z0JBQ0gsT0FBTyxPQUFJLENBQUMsR0FBRyxDQUFDLGdCQUFnQixLQUFLLFNBQVMsQ0FBQzthQUNsRDtRQUNMLENBQUMsRUFBQztRQUVNLHlCQUFvQjs7OztRQUFHLFVBQUMsRUFBRTtZQUM5QixJQUFJLE9BQUksQ0FBQyxHQUFHLENBQUMsZ0JBQWdCLEtBQUssU0FBUyxFQUFFO2dCQUN6QyxPQUFPLEVBQUUsQ0FBQyxZQUFZLEtBQUssT0FBTyxDQUFDO2FBQ3RDO2lCQUFNO2dCQUNILE9BQU8sT0FBSSxDQUFDLEdBQUcsQ0FBQyxnQkFBZ0IsS0FBSyxXQUFXLENBQUM7YUFDcEQ7UUFDTCxDQUFDLEVBQUM7UUFs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QUssU0FBUztnQkFDVixFQUFFLENBQUMsWUFBWSxHQUFHLEtBQUssQ0FBQztnQkFDeEIsRUFBRSxDQUFDLFdBQVcsR0FBRyxLQUFLLENBQUM7Z0JBQ3ZCLEVBQUUsQ0FBQyxTQUFTLEdBQUcsS0FBSyxDQUFDO2dCQUNyQixNQUFNO1lBQ1YsS0FBSyxJQUFJO2dCQUNMLEVBQUUsQ0FBQyxZQUFZLEdBQUcsSUFBSSxDQUFDO2dCQUN2QixFQUFFLENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQztnQkFDcEIsRUFBRSxDQUFDLFdBQVcsR0FBRyxLQUFLLENBQUM7Z0JBQ3ZCLE1BQU07WUFDVixLQUFLLE1BQU07Z0JBQ1AsRUFBRSxDQUFDLFlBQVksR0FBRyxJQUFJLENBQUM7Z0JBQ3ZCLEVBQUUsQ0FBQyxXQUFXLEdBQUcsSUFBSSxDQUFDO2dCQUN0QixFQUFFLENBQUMsU0FBUyxHQUFHLEtBQUssQ0FBQztnQkFDckIsTUFBTTtZQUNWO2dCQUNJLEVBQUUsQ0FBQyxZQUFZLEdBQUcsSUFBSSxDQUFDO2dCQUN2QixFQUFFLENBQUMsV0FBVyxHQUFHLElBQUksQ0FBQztnQkFDdEIsRUFBRSxDQUFDLFNBQVMsR0FBRyxJQUFJLENBQUM7Z0JBQ3BCLE1BQU07U0FDYjtRQUVELElBQUksQ0FBQyxHQUFHLENBQUMsYUFBYSxHQUFHLEdBQUcsSUFBSSxRQUFRLENBQUM7UUFDekMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxZQUFZLENBQUMsYUFBYSxHQUFHLEdBQUcsSUFBSSxRQUFRLENBQUM7SUFDMUQsQ0FBQztJQUVMLDRCQUFDO0FBQUQsQ0FBQyxBQXBrQkQsSUFva0JDOzs7Ozs7O0lBbmtCRyxtREFBbUQ7Ozs7O0lBQ25ELDJDQUEwQjs7Ozs7O0lBSTFCLGlEQUFpQzs7Ozs7SUF3S2pDLG1EQU1FOzs7OztJQUVGLHFEQU1FOzs7OztJQW5MVSxvQ0FBZ0MiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBUcmVlVGFibGVDb21wb25lbnQsIFRyZWVOb2RlIH0gZnJvbSAnQGZhcnJpcy91aS10cmVldGFibGUnO1xyXG5pbXBvcnQgeyBGYXZvcml0ZUFjdGlvbiwgRkFWT1JJVEVfRklFTERfTkFNRSB9IGZyb20gJy4uL2xvb2t1cC1kaXNwbGF5dHlwZSc7XHJcbmltcG9ydCB7IExPQURfREFUQV9UWVBFLCBMb29rdXBHcmlkUmVzdWx0IH0gZnJvbSAnLi4vbG9va3VwLWdyaWQtb3B0aW9ucyc7XHJcbmltcG9ydCB7IGNsb25lRGVlcCB9IGZyb20gJ2xvZGFzaC1lcyc7XHJcbmltcG9ydCB7IE9ic2VydmFibGUsIG9mLCBTdWJqZWN0IH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7IExvb2t1cEdyaWRDb21wb25lbnQgfSBmcm9tICcuLi9sb29rdXAtZ3JpZC5jb21wb25lbnQnO1xyXG5pbXBvcnQgeyB0YWtlLCB0YXAsIGNhdGNoRXJyb3IgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XHJcbmltcG9ydCB7IExvb2t1cFNlbGVjdGlvblNlcnZpY2UgfSBmcm9tICcuL2xvb2t1cC1zZWxlY3Rpb24uc2VydmljZSc7XHJcbmltcG9ydCB7IEZpbHRlckNvbmRpdGlvbiB9IGZyb20gJ0BmYXJyaXMvdWktY29tbW9uL3R5cGVzJztcclxuXHJcblxyXG5leHBvcnQgY2xhc3MgVHJlZVRhYmxlRXZlbnRNYW5hZ2VyIHtcclxuICAgIHByaXZhdGUgbG9va3VwU2VsZWN0aW9uU2VyOiBMb29rdXBTZWxlY3Rpb25TZXJ2aWNlO1xyXG4gICAgcHJpdmF0ZSBfc29ydFN0YXRlID0gbnVsbDtcclxuICAgICAgICAvKipcclxuICAgICAqIOagh+ivhuW9k+WJjeaVsOaNruaYr+WQpuafpeivoue7k+aenFxyXG4gICAgICovXHJcbiAgICBwcml2YXRlIElTX1NFQVJDSF9SRVNVTFQgPSBmYWxzZTtcclxuXHJcblxyXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBpbnM6IExvb2t1cEdyaWRDb21wb25lbnQpIHtcclxuICAgICAgICB0aGlzLmxvb2t1cFNlbGVjdGlvblNlciA9IHRoaXMuaW5zLmxvb2t1cFNlbGVjdGlvblNlcjtcclxuICAgIH1cclxuXHJcbiAgICBjb25kaXRpb25zQ2hhbmdlKGNvbmRpdGlvbnMpIHtcclxuICAgICAgICB0aGlzLmlucy5jb25kaXRpb25zID0gY29uZGl0aW9ucztcclxuICAgICAgICBpZiAodGhpcy5pbnMudXJpKSB7XHJcbiAgICAgICAgICAgIGlmIChjb25kaXRpb25zICYmIGNvbmRpdGlvbnMubGVuZ3RoID09PSAxICYmIGNvbmRpdGlvbnNbMF0uY29kZSA9PSAnKicpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuaW5zLmNvbmRpdGlvbnMgPSBbXTtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnNlYXJjaFRyZWVEYXRhKHsgZmllbGQ6ICcqJywgdmFsdWU6IGNvbmRpdGlvbnNbMF0udmFsdWUgfSk7ICAgIFxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnNlYXJjaFRyZWVEYXRhKHsgZmllbGQ6ICcqJywgdmFsdWU6ICcnIH0pO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMuaW5zLnF1ZXJ5LmVtaXQoeyBjb25kaXRpb25zLCBpbnN0YW5jZTogdGhpcy5pbnMgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHNlYXJjaFRyZWVEYXRhKHNlYXJjaDogeyBmaWVsZDogc3RyaW5nOyB2YWx1ZTogc3RyaW5nIH0pIHtcclxuICAgICAgICBjb25zdCB0dCA9IHRoaXMuaW5zLmNvbXBvbmVudFJlZi5pbnN0YW5jZSBhcyBUcmVlVGFibGVDb21wb25lbnQ7XHJcbiAgICAgICAgLy8g5Yik5patdXJpIOWPkeWHunNlYXJjaC5lbWl0KCk7XHJcbiAgICAgICAgaWYgKHRoaXMuaW5zLnNlYXJjaGluZykge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5pbnMuc2VhcmNoaW5nID0gdHJ1ZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuaW5zLnNob3dMb2FkaW5nKCk7XHJcbiAgICAgICAgaWYgKHR0JiYgdHQucHNSZWYgJiYgdHQucHNSZWYuZGlyZWN0aXZlUmVmKSB7XHJcbiAgICAgICAgICAgIHR0LnBzUmVmLmRpcmVjdGl2ZVJlZi5zY3JvbGxUb1RvcCgwKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuaW5zLmh0dHBNZ3IuZ2V0RGF0YSh7IHNlYXJjaCwgc29ydE5hbWU6IHR0LnNvcnROYW1lLCBzb3J0T3JkZXI6IHR0LnNvcnRPcmRlciB9LCAnc2VhcmNoJykucGlwZShcclxuICAgICAgICAgICAgdGFwKCgpID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMuaW5zLnNlYXJjaGluZyA9IGZhbHNlO1xyXG4gICAgICAgICAgICB9KSxcclxuICAgICAgICAgICAgY2F0Y2hFcnJvcigoZXJyKSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmlucy5zZWFyY2hpbmcgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBvZihlcnIpO1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICkuc3Vic2NyaWJlKHJlc0RhdGEgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLmlucy5jbG9zZUxvYWRpbmcoKTtcclxuICAgICAgICAgICAgaWYgKHJlc0RhdGEpIHtcclxuICAgICAgICAgICAgICAgIC8vIHRoaXMuaW5zLml0ZW1zID0gcmVzRGF0YS5pdGVtcztcclxuICAgICAgICAgICAgICAgIHR0LmNsZWFyQWxsKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgY29uc3QgdHJlZUluZm8gPSB0aGlzLmlucy5ncmlkT3B0aW9ucy50cmVlSW5mbztcclxuICAgICAgICAgICAgICAgIGlmICghdHJlZUluZm9bJ3RyZWVEYXRhSXNJbml0J10pIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodHJlZUluZm8ubGF5ZXJUeXBlLnRvTG93ZXJDYXNlKCkgPT09ICdwYXRoY29kZScpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnMuaXRlbXMgPSB0aGlzLmlucy5sb29rdXBVdGlscy5tYWtlVHJlZSh0aGlzLmlucy5pdGVtcywgdHJlZUluZm8pO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaW5zLml0ZW1zID0gdGhpcy5pbnMubG9va3VwVXRpbHMubWFrZVRyZWVXaXRoUGFyZW50SUQoXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmlucy5pdGVtcyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICcnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJlZUluZm8uZGF0YUZpZWxkID8gYCR7dHJlZUluZm8uZGF0YUZpZWxkfS4ke3RyZWVJbmZvLnBhcmVudEZpZWxkfWAgOiB0cmVlSW5mby5wYXJlbnRGaWVsZCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaW5zLmlkRmllbGRcclxuICAgICAgICAgICAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICAgICAgICAgIGNvbnN0IGNoZWNrTm9kZXMgPSAobm9kZXMpOiBUcmVlTm9kZVtdID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAobm9kZXMgJiYgbm9kZXMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBub2Rlcy5tYXAoKG5vZGU6IFRyZWVOb2RlKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobm9kZS5oYXNPd25Qcm9wZXJ0eSgnYWRkdGlvbmFsJykpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBub2RlLnNlbGVjdGFibGUgPSAhbm9kZVsnYWRkdGlvbmFsJ107XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG5vZGUuY2hpbGRyZW4gJiYgbm9kZS5jaGlsZHJlbi5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaGVja05vZGVzKG5vZGUuY2hpbGRyZW4pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5faXNMb2FkQWxsVHJlZURhdGEodHQpICYmICghc2VhcmNoIHx8IHNlYXJjaC52YWx1ZSA9PT0gJycgfHwgc2VhcmNoLnZhbHVlID09PSB1bmRlZmluZWQpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5vZGUubGVhZiA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5vZGU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbm9kZXM7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgIGNvbnN0IF9ub2RlcyA9IGNoZWNrTm9kZXMocmVzRGF0YS5pdGVtcyk7XHJcbiAgICAgICAgICAgICAgICBpZiAoX25vZGVzICYmIF9ub2Rlcy5sZW5ndGggJiYgX25vZGVzWzBdLmNoaWxkcmVuICYmIF9ub2Rlc1swXS5jaGlsZHJlbi5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICBfbm9kZXNbMF0uZXhwYW5kZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIF9ub2Rlc1swXS5jaGlsZHJlbiA9IHRoaXMuaW5zLmV4cGFuZEZpcnN0Tm9kZShfbm9kZXNbMF0uY2hpbGRyZW4pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgdGhpcy5pbnMuaXRlbXMgPSBfbm9kZXM7XHJcblxyXG5cclxuICAgICAgICAgICAgICAgIC8vIOWKoOi9veaUtuiXj+aVsOaNrlxyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuaW5zLnVzZUZhdm9yaXRlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8g5pu05paw5pWw5o2u55qE5pS26JeP54q25oCBXHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnMuZmF2SGVscGVyLnVwZGF0ZUZhdm9yaXRlc1N0YXR1cyh0aGlzLmlucy5pdGVtcyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgdHQubG9hZERhdGEodGhpcy5pbnMuaXRlbXMpO1xyXG4gICAgICAgICAgICAgICAgLy8gLy8g5bGV5byA5p+l6K+i57uT5p6c44CCXHJcbiAgICAgICAgICAgICAgICAvLyBpZiAoc2VhcmNoLnZhbHVlICYmIHRoaXMuaW5zLml0ZW1zLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgLy8gICAgIHR0LnRvZ2dsZUV4cGFuZCh0aGlzLmlucy5pdGVtc1swXSwgdHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICAvLyB9XHJcbiAgICAgICAgICAgICAgICB0dC5yZXNpemUoKTtcclxuXHJcbiAgICAgICAgICAgICAgICB0aGlzLklTX1NFQVJDSF9SRVNVTFQgPSB0cnVlO1xyXG5cclxuICAgICAgICAgICAgICAgIHRoaXMuaW5zLnNlbGVjdGlvbk1nci5zZWxlY3RDdXJyZW50VmFsdWUoKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdGhpcy5pbnMuc2VhcmNoLmVtaXQoc2VhcmNoKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGdldENoaWxkcmVuKFxyXG4gICAgICAgIHBhcmVudFBhdGgsXHJcbiAgICAgICAgcGFyZW50TGF5ZXIsXHJcbiAgICAgICAgc2VhcmNoRGF0YTogeyBzZWFyY2hGaWVsZDogc3RyaW5nOyBzZWFyY2hWYWx1ZTogc3RyaW5nIH1cclxuICAgICk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICAgICAgY29uc3QgdXJpID0gdGhpcy5pbnMuZ3JpZE9wdGlvbnMudXJpO1xyXG4gICAgICAgIGNvbnN0IHNlYXJjaCA9IHsgcGFyZW50TGF5ZXIsIGNhdGVnb3J5OiAnY2hpbGRyZW4nLCAuLi5zZWFyY2hEYXRhIH07XHJcbiAgICAgICAgaWYgKHRoaXMuaW5zLnRyZWVJbmZvLmxheWVyVHlwZSA9PT0gJ3BhcmVudElkJykge1xyXG4gICAgICAgICAgICBzZWFyY2hbJ3BhcmVudElkJ10gPSBwYXJlbnRQYXRoO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHNlYXJjaFsncGFyZW50UGF0aCddID0gcGFyZW50UGF0aDtcclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICAgICAgY29uc3QgcGFyYW06IGFueSA9IHtcclxuICAgICAgICAgICAgc2VhcmNoVmFsdWU6ICcnLFxyXG4gICAgICAgICAgICBjdXN0b21EYXRhOiB0aGlzLmlucy5jdXN0b21EYXRhLFxyXG4gICAgICAgICAgICBlbmFibGVGdWxsVHJlZTogdGhpcy5pbnMuZW5hYmxlRnVsbFRyZWUsXHJcbiAgICAgICAgICAgIGxvYWRUcmVlRGF0YVR5cGU6IHRoaXMuaW5zLmxvYWRUcmVlRGF0YVR5cGVcclxuICAgICAgICB9O1xyXG4gICAgICAgIFxyXG4gICAgICAgIGNvbnN0IHR0ID0gdGhpcy5pbnMuY29tcG9uZW50UmVmLmluc3RhbmNlIGFzIFRyZWVUYWJsZUNvbXBvbmVudDtcclxuICAgICAgICBpZiAodHQgJiYgdHQuc29ydE5hbWUpIHtcclxuICAgICAgICAgICAgT2JqZWN0LmFzc2lnbihzZWFyY2gsIHtcclxuICAgICAgICAgICAgICAgIHNvcnROYW1lOiB0dC5zb3J0TmFtZSxcclxuICAgICAgICAgICAgICAgIHNvcnRPcmRlcjogdHQuc29ydE9yZGVyXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgIFxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHRoaXMuSVNfU0VBUkNIX1JFU1VMVCkge1xyXG4gICAgICAgICAgICBwYXJhbS5lbmFibGVGdWxsVHJlZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICBwYXJhbS5sb2FkVHJlZURhdGFUeXBlID0gJ2xheWVybG9hZCc7XHJcblxyXG4gICAgICAgICAgICBpZiAodGhpcy5pbnMudHJlZUluZm8ubGF5ZXJUeXBlID09PSAncGFyZW50SWQnKSB7XHJcbiAgICAgICAgICAgICAgICAvLyDmoJHlvaLluK7liqnmn6Xor6LlkI7vvIzlsZXlvIDoioLngrnml7blsIbnm7jlhbPmn6Xor6Llj4LmlbDkvKDpgJLliLDlkI7nq68gMjAyMi0wOS0xM1xyXG4gICAgICAgICAgICAgICAgc2VhcmNoLnNlYXJjaFZhbHVlID0gJyc7XHJcbiAgICAgICAgICAgICAgICBzZWFyY2guc2VhcmNoRmllbGQgPSAnKic7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLy8gcGFyYW0uc2VhcmNoVmFsdWUgPSBKU09OLnN0cmluZ2lmeShzZWFyY2gpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcGFyYW0uc2VhcmNoVmFsdWUgPSBKU09OLnN0cmluZ2lmeShzZWFyY2gpO1xyXG5cclxuICAgICAgICBpZiAodGhpcy5pbnMuaGVscElkKSB7XHJcbiAgICAgICAgICAgIHBhcmFtWydoZWxwSWQnXSA9IHRoaXMuaW5zLmhlbHBJZDtcclxuICAgICAgICB9XHJcbiAgICAgICBcclxuXHJcbiAgICAgICAgaWYgKHRoaXMuaW5zLmNvbmRpdGlvbnMgJiYgdGhpcy5pbnMuY29uZGl0aW9ucy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgcGFyYW0uc2VhcmNoQ29uZGl0aW9ucyA9IGNsb25lRGVlcCh0aGlzLmlucy5jb25kaXRpb25zKTtcclxuICAgICAgICB9XHJcbiAgICAgICBcclxuICAgICAgICByZXR1cm4gdGhpcy5pbnMuaHR0cC5nZXREYXRhKHVyaSwgcGFyYW0pO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICBwcml2YXRlIF9pc0xvYWRBbGxUcmVlRGF0YSA9ICh0dCkgPT4ge1xyXG4gICAgICAgIGlmICh0aGlzLmlucy5sb2FkVHJlZURhdGFUeXBlID09PSAnZGVmYXVsdCcpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHR0LmxvYWREYXRhVHlwZSA9PT0gJ2FsbCc7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuaW5zLmxvYWRUcmVlRGF0YVR5cGUgPT09ICdsb2FkYWxsJztcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG5cclxuICAgIHByaXZhdGUgX2lzQXN5bmNMb2FkVHJlZURhdGEgPSAodHQpID0+IHtcclxuICAgICAgICBpZiAodGhpcy5pbnMubG9hZFRyZWVEYXRhVHlwZSA9PT0gJ2RlZmF1bHQnKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0dC5sb2FkRGF0YVR5cGUgPT09ICdhc3luYyc7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuaW5zLmxvYWRUcmVlRGF0YVR5cGUgPT09ICdsYXllcmxvYWQnO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcblxyXG5cclxuICAgIGJpbmRUcmVldGFibGVFdmVudCgpIHtcclxuICAgICAgICBjb25zdCB0dCA9IHRoaXMuaW5zLmNvbXBvbmVudFJlZi5pbnN0YW5jZSBhcyBUcmVlVGFibGVDb21wb25lbnQ7XHJcbiAgICAgICAgY29uc3QgX3NlYXJjaFRyZWVEYXRhID0gKHNlYXJjaHBhcmFtOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgaWYgKHRoaXMuaW5zLnJlbW90ZVNlYXJjaCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5pbnMuX3NlYXJjaFN0YXRlID0gc2VhcmNocGFyYW07XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNlYXJjaFRyZWVEYXRhKHNlYXJjaHBhcmFtKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmlucy51c2VJbnNpZGVTZWFyY2hIYW5kbGVyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdHQuc2VhcmNoSGFuZGxlLnNlYXJjaChzZWFyY2hwYXJhbS5maWVsZCwgc2VhcmNocGFyYW0udmFsdWUsICdjbGllbnQnKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnMuc2VhcmNoLmVtaXQoc2VhcmNocGFyYW0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgY29uc3QgaXNMb2FkQWxsVHJlZURhdGEgPSAoKSA9PiB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9pc0xvYWRBbGxUcmVlRGF0YSh0dCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgY29uc3QgaXNBc3luY0xvYWRUcmVlRGF0YSA9ICgpID0+IHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2lzQXN5bmNMb2FkVHJlZURhdGEodHQpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHR0LmRibENsaWNrRXhwYW5kID0gIXRoaXMuaW5zLnNpbmdsZVNlbGVjdDsgLy8g56aB55So5Y+M5Ye75bGV5byA6IqC54K5XHJcbiAgICAgICAgdHQuYWxsQ29sdW1uc1RpdGxlID0gdGhpcy5pbnMuYWxsQ29sdW1uc1RpdGxlOyAvLyB0aGlzLmRpc3BsYXlJbmZvLmFsbENvbHVtbnM7XHJcbiAgICAgICAgdHQuaWRGaWVsZCA9IHRoaXMuaW5zLmlkRmllbGQ7XHJcbiAgICAgICAgdHQuY29sdW1ucyA9IHRoaXMuaW5zLmNvbHVtbnM7XHJcbiAgICAgICAgdHQuc2VhcmNoRmllbGRzID0gdGhpcy5pbnMuZ3JpZE9wdGlvbnMuc2VhcmNoRmllbGRzO1xyXG4gICAgICAgIGlmICh0aGlzLmlucy50cmVlSW5mbykge1xyXG4gICAgICAgICAgICB0dC5sb2FkRGF0YVR5cGUgPSB0aGlzLmlucy50cmVlSW5mby5sb2FkRGF0YVR5cGU7XHJcbiAgICAgICAgICAgIHR0LnZpcnR1YWxpemVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgaWYgKCF0aGlzLmlucy5pc1RleHRDaGFuZ2UpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuaW5zLmFsbERhdGEgPSBjbG9uZURlZXAodGhpcy5pbnMuaXRlbXMpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5pbnMuYWxsRGF0YSA9IFtdO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodGhpcy5pbnMuZ3JpZE9wdGlvbnMudHJlZUluZm8pIHtcclxuICAgICAgICAgICAgdHQub25seVNlbGVjdExlYWYgPSB0aGlzLmlucy5ncmlkT3B0aW9ucy50cmVlSW5mby5vbmx5U2VsZWN0TGVhZjtcclxuICAgICAgICAgICAgdHQubG9hZERhdGFUeXBlID0gdGhpcy5pbnMuZ3JpZE9wdGlvbnMudHJlZUluZm8ubG9hZERhdGFUeXBlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKCF0dC5zaW5nbGVTZWxlY3QpIHtcclxuICAgICAgICAgICAgdHQuY2hlY2tPblNlbGVjdCA9IHRydWU7XHJcbiAgICAgICAgICAgIHR0LnNlbGVjdE9uQ2hlY2sgPSB0cnVlO1xyXG4gICAgICAgICAgICB0dC5zaG93Q2hlY2tib3ggPSB0cnVlO1xyXG4gICAgICAgICAgICB0dC5zaG93Q2hlY2tBbGwgPSAgdGhpcy5pbnMuc2hvd0NoZWNrQWxsO1xyXG4gICAgICAgICAgICAvLyDlkK/nlKjlpJrpgInlkI7vvIzlkIzml7blkK/nlKjnuqfogZTpgInmi6lcclxuICAgICAgICAgICAgaWYgKHRoaXMuaW5zLmVuYWJsZUNhc2NhZGUpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuY2FzY2FkZVZhbHVlQ2hhbmdlZCh0aGlzLmlucy5jYXNjYWRlU3RhdHVzKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHR0LmNhc2NhZGVDaGVjayA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgdHQuY2FzY2FkZURvd24gPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIHR0LmNhc2NhZGVVcCA9IGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0dC5lbmFibGVGaW5kVGV4dCA9IHRoaXMuaW5zLmVuYWJsZUZpbmRUZXh0O1xyXG4gICAgICAgIC8vIHR0LmZpbmRGaWVsZCA9IHRoaXMudGV4dEZpZWxkO1xyXG4gICAgICAgIHR0Lm5vZGVTZWxlY3RlZC5zdWJzY3JpYmUoKGU6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICAvLyBpZiAodGhpcy5pbnMuZmF2b3JpdGVzQ29tcG9uZW50UmVmICYmIHRoaXMuaW5zLnNpbmdsZVNlbGVjdCkge1xyXG4gICAgICAgICAgICAvLyAgICAgY29uc3QgZnR0ID0gdGhpcy5pbnMuZmF2b3JpdGVzQ29tcG9uZW50UmVmLmluc3RhbmNlIGFzIFRyZWVUYWJsZUNvbXBvbmVudDtcclxuICAgICAgICAgICAgLy8gICAgIGZ0dC5jbGVhclNlbGVjdGlvbnMoKTtcclxuICAgICAgICAgICAgLy8gfVxyXG4gICAgICAgICAgICBpZiAodGhpcy5pbnMuc2luZ2xlU2VsZWN0KSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmxvb2t1cFNlbGVjdGlvblNlci5jbGVhclNlbGVjdGlvbnMoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLmxvb2t1cFNlbGVjdGlvblNlci51cGRhdGVTZWxlY3Rpb25zKFtlLm5vZGUuZGF0YV0pO1xyXG4gICAgICAgICAgICB0aGlzLmlucy5jaGVja2VkQ2hhbmdlLmVtaXQoeyBkYXRhOiBbZS5ub2RlLmRhdGFdICwgaXNDaGVjazogdHJ1ZSAgfSk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHR0Lm5vZGVDaGVja2VkLnN1YnNjcmliZSggZSA9PiB7XHJcbiAgICAgICAgICAgIGlmICghdGhpcy5pbnMuc2luZ2xlU2VsZWN0KSB7XHJcbiAgICAgICAgICAgICAgICBsZXQgZGF0YSA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICBpZiAoZS5ub2RlcyAmJiBlLm5vZGVzLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGRhdGEgPSBlLm5vZGVzLm1hcChuID0+IG4uZGF0YSk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KGUubm9kZSkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YSA9IGUubm9kZS5tYXAobiA9PiBuLmRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEgPSBbZS5ub2RlLmRhdGFdO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHRoaXMuaW5zLm11bHRpU2VsTWdyLnVwZGF0ZVNlbGVjdGlvbnMoZGF0YSk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmlucy5jaGVja2VkQ2hhbmdlLmVtaXQoeyBkYXRhLCBpc0NoZWNrOiB0cnVlICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICB0dC5ub2RlVW5DaGVja2VkLnN1YnNjcmliZSgoZTogYW55KSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChlICYmIGUubm9kZSkge1xyXG4gICAgICAgICAgICAgICAgbGV0IG5vZGVEYXRhID0gbnVsbDtcclxuICAgICAgICAgICAgICAgIGlmIChlLm5vZGUuZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgIG5vZGVEYXRhID0gZS5ub2RlLmRhdGE7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChlLm5vZGUubm9kZSAmJiBlLm5vZGUubm9kZS5kYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG5vZGVEYXRhID0gZS5ub2RlLm5vZGUuZGF0YTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKCFub2RlRGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuaW5zLnNpbmdsZVNlbGVjdCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaW5zLm11bHRpU2VsTWdyLnJlbW92ZShlLm5vZGUuaWQpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAvLyDliIblsYLliqDovb3vvIzlpJrpgInvvIzljIXlkKvkuIvnuqfml7bvvIzlj5bmtojli77pgIkg6ZyA6KaB5bCG5b2T5YmN6IqC54K555qE5omA5pyJ5a2Q57qn5pWw5o2u5Lmf6KaB5Y+W5raI6YCJ5oup77yM5Y2z5LuO5bey6YCJ6K6w5b2V5Lit56e76ZmkXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHR0LmxvYWREYXRhVHlwZSAhPT0gJ2FsbCcgJiYgdGhpcy5pbnMudHJlZUluZm8ubGF5ZXJUeXBlID09PSAncGF0aGNvZGUnICYmIHRoaXMuaW5zLmVuYWJsZUNhc2NhZGUgJiZcclxuICAgICAgICAgICAgICAgICAgICAgICAgKHRoaXMuaW5zLmNhc2NhZGVTdGF0dXMgPT09ICdlbmFibGUnIHx8IHRoaXMuaW5zLmNhc2NhZGVTdGF0dXMgPT09ICdkb3duJykpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGUubm9kZS5jaGlsZHJlbiAmJiBlLm5vZGUuY2hpbGRyZW4ubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBub2RlcyA9IGUubm9kZS5jaGlsZHJlbi5tYXAobiA9PiBuLmRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnMubG9va3VwU2VsZWN0aW9uU2VyLnVwZGF0ZVNlbGVjdGlvbnMobm9kZXMsIGZhbHNlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHBhdGhjb2RlID0gdGhpcy5pbnMuZ2V0UGF0aENvZGUobm9kZURhdGEsIHRoaXMuaW5zLnRyZWVJbmZvKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnMubG9va3VwU2VsZWN0aW9uU2VyLnVuc2VsZWN0QnlQYXRoY29kZShwYXRoY29kZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChlLm5vZGVzICYmIGUubm9kZXMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaW5zLm11bHRpU2VsTWdyLnJlbW92ZShlLm5vZGVzLm1hcChuID0+IG4uaWQpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnMuY2hlY2tlZENoYW5nZS5lbWl0KHsgZGF0YTogZS5ub2Rlcy5tYXAobiA9PiBuLmRhdGEpLCBpc0NoZWNrOiBmYWxzZSB9KTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmlucy5jaGVja2VkQ2hhbmdlLmVtaXQoeyBkYXRhOiBbbm9kZURhdGFdLCBpc0NoZWNrOiBmYWxzZSB9KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGZ0dCA9IHRoaXMuaW5zLmZhdm9yaXRlc0NvbXBvbmVudFJlZiAmJiAodGhpcy5pbnMuZmF2b3JpdGVzQ29tcG9uZW50UmVmLmluc3RhbmNlIGFzIFRyZWVUYWJsZUNvbXBvbmVudCk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGZ0dCAmJiBmdHQuZmluZFJvd05vZGUoZS5ub2RlLmlkKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBmdHQudW5TZWxlY3ROb2RlKGUubm9kZS5pZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmlucy5jaGVja2VkQ2hhbmdlLmVtaXQoeyBkYXRhOiBbbm9kZURhdGFdLCBpc0NoZWNrOiBmYWxzZSB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICB0dC5jaGVja0FsbC5zdWJzY3JpYmUoIGUgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBkYXRhID0gZS5pbnN0YW5jZS5jaGVja2Vkcy5tYXAobiA9PiBuLmRhdGEpO1xyXG4gICAgICAgICAgICB0aGlzLmlucy5tdWx0aVNlbE1nci51cGRhdGVTZWxlY3Rpb25zKGRhdGEpO1xyXG4gICAgICAgICAgICB0aGlzLmlucy5jaGVja2VkQ2hhbmdlLmVtaXQoeyBkYXRhLCBpc0NoZWNrOiB0cnVlICB9KTtcclxuICAgICAgICB9KTtcclxuICAgICAgICB0dC51bkNoZWNrQWxsLnN1YnNjcmliZSgoKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuaW5zLm11bHRpU2VsTWdyLmNsZWFyKCk7XHJcbiAgICAgICAgICAgIHRoaXMuaW5zLmNoZWNrZWRDaGFuZ2UuZW1pdCh7IGRhdGE6IFtdLCBpc0NoZWNrOiBmYWxzZSAgfSk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHR0LnNlYXJjaC5zdWJzY3JpYmUoc2VhcmNocGFyYW0gPT4ge1xyXG4gICAgICAgICAgICBpZiAoc2VhcmNocGFyYW0uZmllbGQgIT09ICcqJyAmJiAhc2VhcmNocGFyYW0udmFsdWUpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuaW5zLm1lc3NhZ2VyU2VydmljZS53YXJuaW5nKHRoaXMuaW5zLm11c3RXcml0ZVNvbWV0aGluZyk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBzZWFyY2hwYXJhbS52YWx1ZSA9IHNlYXJjaHBhcmFtLnZhbHVlLnRyaW0oKTtcclxuICAgICAgICAgICAgICAgIF9zZWFyY2hUcmVlRGF0YShzZWFyY2hwYXJhbSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICBpZiAoIXR0LmNlbGxDbGljay5vYnNlcnZlcnMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIHR0LmNlbGxDbGljay5zdWJzY3JpYmUoKGU6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKGUuY29sLmZpZWxkID09PSBGQVZPUklURV9GSUVMRF9OQU1FKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZS5ldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcclxuICAgICAgICAgICAgICAgICAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6IG5vLXN0cmluZy1saXRlcmFsXHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY2xhc3NMaXN0ID0gZS5ldmVudC50YXJnZXRbJ2NsYXNzTGlzdCddO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChjbGFzc0xpc3QuY29udGFpbnMoJ2YtbG9va3VwLWZhdm9yaXRlJykpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gY2xhc3NMaXN0LnRvZ2dsZSgnZi1pY29uLXN0YXInKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gY2xhc3NMaXN0LnRvZ2dsZSgnZi1pY29uLXN0YXItb3V0bGluZScpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBfdGhpcyA9IHRoaXMuaW5zO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgKGZ1bmN0aW9uIGVhY2goYXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJyLmZvckVhY2goaXRlbSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGlkID0gX3RoaXMudXRpbHMuZ2V0VmFsdWUoX3RoaXMuaWRGaWVsZCwgaXRlbS5kYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlkID09PSBlLm5vZGUuaWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0uZGF0YVtGQVZPUklURV9GSUVMRF9OQU1FXSA9ICFpdGVtLmRhdGFbRkFWT1JJVEVfRklFTERfTkFNRV07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChpdGVtLmNoaWxkcmVuICYmIGl0ZW0uY2hpbGRyZW4ubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGVhY2goaXRlbS5jaGlsZHJlbik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfSkodGhpcy5pbnMuaXRlbXMpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0dC5sb2FkRGF0YSh0aGlzLmlucy5pdGVtcyk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyDmm7TmlrDmlLbol4/mlbDmja5cclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sb29rdXBTZWxlY3Rpb25TZXIudXBkYXRlRmF2b3JpdGVEYXRhKCBlLm5vZGUuZGF0YSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUubm9kZS5kYXRhW0ZBVk9SSVRFX0ZJRUxEX05BTUVdID8gRmF2b3JpdGVBY3Rpb24uYWRkIDogRmF2b3JpdGVBY3Rpb24uZGVsZXRlKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0dC5kYmxDbGljay5zdWJzY3JpYmUoKHRyZWVOb2RlOiBUcmVlTm9kZSkgPT4ge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5pbnMuZ3JpZE9wdGlvbnMuc2luZ2xlU2VsZWN0ICYmIHRyZWVOb2RlLnNlbGVjdGFibGUpIHtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmlucy5va0J1dHRvbikge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIHRoaXMubG9va3VwU2VsZWN0aW9uU2VyLnNlbGVjdCh0cmVlTm9kZS5kYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAvLyB0aGlzLmlucy5va0J1dHRvbi5uYXRpdmVFbGVtZW50LmNsaWNrKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnMuc2VsZWN0SXRlbSh0cmVlTm9kZS5kYXRhKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIGNvbnN0IGxvYWRBbGxEYXRhID0gaXNMb2FkQWxsVHJlZURhdGEoKTtcclxuICAgICAgICB0dC5jb2x1bW5Tb3J0ZWQuc3Vic2NyaWJlKChzb3J0OiB7IHNvcnROYW1lOiBzdHJpbmc7IHNvcnRPcmRlcjogYW55OyB9KSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuX3NvcnRTdGF0ZSA9IHNvcnQ7XHJcbiAgICAgICAgICAgIGlmIChpc0xvYWRBbGxUcmVlRGF0YSgpKSB7XHJcbiAgICAgICAgICAgICAgICB0dC5jbGllbnRTb3J0KCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCB7IHNvcnROYW1lLCBzb3J0T3JkZXIgfSA9IHsgLi4uc29ydCB9O1xyXG5cclxuICAgICAgICAgICAgICAgIGNvbnN0IGNvbCA9IHRoaXMuaW5zLmNvbHVtbnMuZmluZChuID0+IG4uZmllbGQgPT09IHNvcnROYW1lKTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IF9zb3J0TmFtZSA9IGNvbCA/IGNvbC5maWVsZFBhdGggPyBjb2wuZmllbGRQYXRoIDogY29sLmZpZWxkIDogc29ydE5hbWU7XHJcblxyXG4gICAgICAgICAgICAgICAgY29uc3QgcGFyYW0gPSBPYmplY3QuYXNzaWduKHsgc29ydE5hbWU6IF9zb3J0TmFtZSwgc29ydE9yZGVyIH0sIHsgc2VhcmNoOiB0aGlzLmlucy5fc2VhcmNoU3RhdGUgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgbGV0IHJlcVR5cDogTE9BRF9EQVRBX1RZUEUgPSAnYWxsJztcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmlucy5fc2VhcmNoU3RhdGUgJiYgdGhpcy5pbnMuX3NlYXJjaFN0YXRlLnZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVxVHlwID0gJ3NlYXJjaCc7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgdGhpcy5pbnMuaHR0cE1nci5nZXREYXRhKHBhcmFtLCByZXFUeXApLnN1YnNjcmliZShkID0+IHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmlucy5jbG9zZUxvYWRpbmcoKTtcclxuICAgICAgICAgICAgICAgICAgICB0dC5jbGVhckFsbCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGl0ZW1zID0gdGhpcy5pbnMuY2hlY2tOb2RlQ2FuQmVTZWxlY3QoZC5pdGVtcywgZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmlucy51c2VGYXZvcml0ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmlucy5mYXZIZWxwZXIudXBkYXRlRmF2b3JpdGVzU3RhdHVzKGl0ZW1zKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnMuaXRlbXMgPSBpdGVtcztcclxuICAgICAgICAgICAgICAgICAgICB0dC5sb2FkRGF0YShpdGVtcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgdHQucmVzaXplKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnMuc2VsZWN0aW9uTWdyLnNlbGVjdEN1cnJlbnRWYWx1ZSgpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgdHQuY2xlYXJTZWFyY2hWYWx1ZS5zdWJzY3JpYmUoKCkgPT4ge1xyXG4gICAgICAgICAgICBpZiAodHQmJiB0dC5wc1JlZiAmJiB0dC5wc1JlZi5kaXJlY3RpdmVSZWYpIHtcclxuICAgICAgICAgICAgICAgIHR0LnBzUmVmLmRpcmVjdGl2ZVJlZi5zY3JvbGxUb1RvcCgwKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdGhpcy5pbnMuX3NlYXJjaFN0YXRlID0gbnVsbDtcclxuICAgICAgICAgICAgdGhpcy5JU19TRUFSQ0hfUkVTVUxUID0gZmFsc2U7XHJcbiAgICAgICAgICAgIGxldCBfaXRlbXMgPSBbXTtcclxuICAgICAgICAgICAgaWYgKHRoaXMuaW5zLmFsbERhdGEgJiYgdGhpcy5pbnMuYWxsRGF0YS5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgIF9pdGVtcyA9IHRoaXMuaW5zLmNoZWNrTm9kZUNhbkJlU2VsZWN0KHRoaXMuaW5zLmFsbERhdGEsIGxvYWRBbGxEYXRhKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoIV9pdGVtcyB8fCAhX2l0ZW1zLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgX3NlYXJjaFRyZWVEYXRhKHsgZmllbGQ6ICcqJywgdmFsdWU6ICcnIH0pO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5pbnMuaXRlbXMgPSBfaXRlbXM7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmlucy5mYXZIZWxwZXIudXBkYXRlRmF2b3JpdGVzU3RhdHVzKHRoaXMuaW5zLml0ZW1zKTtcclxuICAgICAgICAgICAgICAgIHR0LmxvYWREYXRhKF9pdGVtcyk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmlucy5zZWxlY3Rpb25NZ3Iuc2VsZWN0Q3VycmVudFZhbHVlKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgdHQuZXhwYW5kLnN1YnNjcmliZSgodG46IFRyZWVOb2RlKSA9PiB7XHJcbiAgICAgICAgICAgIGlmICh0bi5sZWFmIHx8ICB0blsnc2hvd0xvYWRpbmcnXSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICghdG4uY2hpbGRyZW4gfHwgIXRuLmNoaWxkcmVuLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgdHJlZUluZm8gPSB0aGlzLmlucy5ncmlkT3B0aW9ucy50cmVlSW5mbztcclxuICAgICAgICAgICAgICAgIGlmIChpc0FzeW5jTG9hZFRyZWVEYXRhKCkgfHwgdGhpcy5JU19TRUFSQ0hfUkVTVUxUICkge1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCBwYXJlbnRQYXRoID0gJyc7XHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IHBhcmVudExheWVyID0gLTE7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgeyBmaWVsZCA9ICcqJywgdmFsdWUgPSAnJyB9ID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAuLi50dC5zZWFyY2hEYXRhXHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdG5bJ3Nob3dMb2FkaW5nJ10gPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIHR0LmRldGVjdENoYW5nZXMoKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodHJlZUluZm8ubGF5ZXJUeXBlID09PSAncGFyZW50SWQnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIOeItklE5Yqg6L295pa55byPXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhcmVudFBhdGggPSB0blsnaWQnXTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB0cmVlSW5mb0ZpZWxkID0gdHJlZUluZm8uZGF0YUZpZWxkO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodHJlZUluZm9GaWVsZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gcGFyZW50UGF0aCA9IHRuLmRhdGFbdHJlZUluZm9GaWVsZF1bdHJlZUluZm8ucGF0aEZpZWxkXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcmVudFBhdGggPSB0aGlzLmlucy5nZXRQYXRoQ29kZSh0bi5kYXRhLCB0cmVlSW5mbyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBwYXJlbnRMYXllciA9IHRuLmRhdGFbdHJlZUluZm9GaWVsZF1bdHJlZUluZm8ubGF5ZXJGaWVsZF07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnRMYXllciA9IHRoaXMuaW5zLmdldExheWVyRGF0YSh0bi5kYXRhLCB0cmVlSW5mbyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmlucy53cml0ZUNvbnNvbGUoJ+acquaJvuWIsOWIhue6p+S/oeaBr+OAgicpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMuaW5zLnVyaSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0blsnc2hvd0xvYWRpbmcnXSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmlucy5leHBhbmRUcmVlTm9kZS5lbWl0KHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluc3RhbmNlOiB0dCwgbm9kZTogdG4sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnRJZE9yUGF0aDogcGFyZW50UGF0aCwgcGFyZW50TGF5ZXIsIHNlYXJjaDogeyB2YWx1ZSwgZmllbGQgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaW5zLnNob3dMb2FkaW5nKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZ2V0Q2hpbGRyZW4ocGFyZW50UGF0aCwgcGFyZW50TGF5ZXIsIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2VhcmNoRmllbGQ6IGZpZWxkID09PSAnKicgPyAnKicgOiBmaWVsZCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2VhcmNoVmFsdWU6IHZhbHVlXHJcbiAgICAgICAgICAgICAgICAgICAgfSkuc3Vic2NyaWJlKGRhdGEgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmlucy5jbG9zZUxvYWRpbmcoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHR0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodG4gJiYgZGF0YS5pdGVtcyAmJiBkYXRhLml0ZW1zLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmlucy51c2VGYXZvcml0ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyDmm7TmlrDlrZDoioLngrnmlLbol4/nirbmgIFcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnMuZmF2SGVscGVyLnVwZGF0ZUZhdm9yaXRlc1N0YXR1cyhkYXRhLml0ZW1zKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG5vZGVzID0gdGhpcy5pbnMuY2hlY2tOb2RlQ2FuQmVTZWxlY3QoZGF0YS5pdGVtcywgZmFsc2UpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0dC5hcHBlbmRDaGlsZHJlbihub2RlcywgdG4pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodHQubG9hZERhdGFUeXBlICE9PSAnYWxsJyAmJiAhdGhpcy5pbnMuc2luZ2xlU2VsZWN0ICYmIHRoaXMuaW5zLmlzR2V0QWxsQ2hpZGxOb2RlcyAmJlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAodGhpcy5pbnMuY2FzY2FkZVN0YXR1cyA9PT0gJ2VuYWJsZScgfHwgdGhpcy5pbnMuY2FzY2FkZVN0YXR1cyA9PT0gJ2Rvd24nKSApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgcm4gPSB0dC5maW5kUm93Tm9kZSh0bi5pZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR0LnByb3BhZ2F0ZVNlbGVjdGlvbkRvd24ocm4sIHJuLmlzQ2hlY2tlZCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyDmm7TmlrDpgInkuK3orrDlvZXnvJPlrZhcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgX2l0ZW1zID0gZGF0YS5pdGVtcy5maWx0ZXIobiA9PiAhbi5hZGR0aW9uYWwpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoX2l0ZW1zICYmIF9pdGVtcy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaW5zLmxvb2t1cFNlbGVjdGlvblNlci51cGRhdGVTZWxlY3Rpb25zKF9pdGVtcy5tYXAobiA9PiBuLmRhdGEpLCBybi5pc0NoZWNrZWQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdG5bJ3Nob3dMb2FkaW5nJ10gPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR0LmRldGVjdENoYW5nZXMoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR0LnBzUmVmLmRpcmVjdGl2ZVJlZi51cGRhdGUoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaW5zLnNlbGVjdGlvbk1nci5zZWxlY3RDdXJyZW50VmFsdWUoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLmlucy5zaW5nbGVTZWxlY3QgJiYgdGhpcy5pbnMuZW5hYmxlQ2FzY2FkZSAmJlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAodGhpcy5pbnMuY2FzY2FkZVN0YXR1cyA9PT0gJ2VuYWJsZScgfHwgdGhpcy5pbnMuY2FzY2FkZVN0YXR1cyA9PT0gJ2Rvd24nKSAmJiB0aGlzLmlucy5pc0dldEFsbENoaWRsTm9kZXMgKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgcm4gPSB0dC5maW5kUm93Tm9kZSh0bi5pZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdHQucHJvcGFnYXRlU2VsZWN0aW9uRG93bihybiwgcm4uaXNDaGVja2VkKTtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBzZWxlY3RJdGVtcyA9IHRuLmNoaWxkcmVuLmZpbHRlcihuID0+IG4uc2VsZWN0YWJsZSkubWFwKG4gPT4gbi5kYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmlucy5sb29rdXBTZWxlY3Rpb25TZXIudXBkYXRlU2VsZWN0aW9ucyhzZWxlY3RJdGVtcywgcm4uaXNDaGVja2VkKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIC8vIHRoaXMuaW5zLnNlbGVjdGlvbk1nci5zZWxlY3RDdXJyZW50VmFsdWUoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpZiAobG9hZEFsbERhdGEgJiYgdGhpcy5pbnMuaXRlbXMpIHtcclxuICAgICAgICAgICAgdGhpcy5pbnMudHJlZU5vZGVIZWxwZXIudXBkYXRlVHJlZU5vZGVFeHBhbmRlZCh0aGlzLmlucy5pdGVtcyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBsb2FkQWxsRGF0YTtcclxuICAgIH1cclxuXHJcbiAgICBjYXNjYWRlVmFsdWVDaGFuZ2VkKCRldmVudCkge1xyXG4gICAgICAgIGNvbnN0IHZhbCA9ICRldmVudDtcclxuICAgICAgICAvLyBjb25zdCB0dCA9IHRoaXMuaW5zLmNvbXBvbmVudFJlZi5pbnN0YW5jZSBhcyBUcmVlVGFibGVDb21wb25lbnQ7XHJcbiAgICAgICAgY29uc3QgaW5zdGFuY2VUeXAgPSB0aGlzLmlucy5hY3RpdmVUYWIgPT09ICdkYXRhbGlzdCcgPyAndHJlZXRhYmxlJyA6ICdmYXYnO1xyXG4gICAgICAgIGNvbnN0IHR0ID0gdGhpcy5pbnMubG9va3VwQ21wTWdyLmdldENvbXBvbmVudEluc3RhbmNlKGluc3RhbmNlVHlwKSBhcyBUcmVlVGFibGVDb21wb25lbnQ7XHJcblxyXG4gICAgICAgIGlmICghdHQpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgc3dpdGNoICh2YWwpIHtcclxuICAgICAgICAgICAgY2FzZSAnZW5hYmxlJzpcclxuICAgICAgICAgICAgICAgIHR0LmNhc2NhZGVDaGVjayA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICB0dC5jYXNjYWRlRG93biA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICB0dC5jYXNjYWRlVXAgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgJ2Rpc2FibGUnOlxyXG4gICAgICAgICAgICAgICAgdHQuY2FzY2FkZUNoZWNrID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB0dC5jYXNjYWRlRG93biA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgdHQuY2FzY2FkZVVwID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSAndXAnOlxyXG4gICAgICAgICAgICAgICAgdHQuY2FzY2FkZUNoZWNrID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIHR0LmNhc2NhZGVVcCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICB0dC5jYXNjYWRlRG93biA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgJ2Rvd24nOlxyXG4gICAgICAgICAgICAgICAgdHQuY2FzY2FkZUNoZWNrID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIHR0LmNhc2NhZGVEb3duID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIHR0LmNhc2NhZGVVcCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICB0dC5jYXNjYWRlQ2hlY2sgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgdHQuY2FzY2FkZURvd24gPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgdHQuY2FzY2FkZVVwID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5pbnMuY2FzY2FkZVN0YXR1cyA9IHZhbCB8fCAnZW5hYmxlJztcclxuICAgICAgICB0aGlzLmlucy5wZXJzb25hbENvbmYuY2FzY2FkZVN0YXR1cyA9IHZhbCB8fCAnZW5hYmxlJztcclxuICAgIH1cclxuXHJcbn1cclxuIl19
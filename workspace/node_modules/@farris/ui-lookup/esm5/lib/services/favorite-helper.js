/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { TreeTableComponent } from '@farris/ui-treetable';
import { FavoriteAction, FavoriteIcon, FAVORITE_FIELD_NAME, LookupGridDisplayType } from '../lookup-displaytype';
var FavoriteHelper = /** @class */ (function () {
    function FavoriteHelper(instance) {
        var _this_1 = this;
        this.instance = instance;
        this.favoriteColumnFormatter = (/**
         * @param {?} v
         * @param {?} data
         * @return {?}
         */
        function (v, data) {
            /** @type {?} */
            var f = v ? FavoriteIcon.yes : FavoriteIcon.no;
            if (_this_1.instance.isTree()) {
                /** @type {?} */
                var id = data[_this_1.instance.idField];
                if (id) {
                    /** @type {?} */
                    var tt = (/** @type {?} */ (_this_1.instance.componentRef.instance));
                    /** @type {?} */
                    var rn = tt.findRowNode(id);
                    if (rn) {
                        if (rn.node.selectable) {
                            return f;
                        }
                        else {
                            return '';
                        }
                    }
                }
            }
            return f;
        });
        this.lookupSelectionSer = this.instance.lookupSelectionSer;
    }
    /**
     * @return {?}
     */
    FavoriteHelper.prototype.getFavoriteColumns = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var columns = this.instance.gridOptions.columns.map((/**
         * @param {?} item
         * @return {?}
         */
        function (item) {
            /** @type {?} */
            var rtn = Object.assign({}, item);
            if (item.field === FAVORITE_FIELD_NAME) {
                rtn.formatter = (/**
                 * @return {?}
                 */
                function () { return FavoriteIcon.delete; });
            }
            return rtn;
        }));
        this.instance.initColumnWidth(columns, 'fav');
        return columns;
    };
    /**
     * @return {?}
     */
    FavoriteHelper.prototype.initPersonalInfo = /**
     * @return {?}
     */
    function () {
        if (this.instance.personalConfigService) {
            /** @type {?} */
            var controlID = this.instance.el.nativeElement.id || this.instance.controlId;
            if (!controlID) {
                this.instance.writeConsole('LookupGrid - 未设置组件id, 收藏功能将不能正常，请设置组件id.');
            }
            /** @type {?} */
            var pcstr = this.instance.getLookupBindingFields();
            this.instance.personalConfigService.controlID = controlID;
            this.instance.personalConfigService.personalConfigKey = pcstr;
            /** @type {?} */
            var conf = {
                displayType: this.instance.displayType,
                singleSelect: this.instance.singleSelect,
                idField: this.instance.idField,
                textField: this.instance.textField,
                mapFields: Object.assign({}, this.instance.mapFields || {})
            };
            this.instance.personalConfigService.initPersonalConf(conf);
            // 个性化配置的订阅事件处理
            this.listenPersonalConfigHandler();
        }
    };
    /**
     * 监听收藏TAB页中相关事件；
     * 数据选中，取消选中，移除收藏，双击事件
     */
    /**
     * 监听收藏TAB页中相关事件；
     * 数据选中，取消选中，移除收藏，双击事件
     * @param {?} cmpRef
     * @return {?}
     */
    FavoriteHelper.prototype.initFavoriteComponentEvent = /**
     * 监听收藏TAB页中相关事件；
     * 数据选中，取消选中，移除收藏，双击事件
     * @param {?} cmpRef
     * @return {?}
     */
    function (cmpRef) {
        var _this_1 = this;
        switch (this.instance.displayType) {
            case LookupGridDisplayType.NavList:
            case LookupGridDisplayType.NavTreeList:
            case LookupGridDisplayType.List: {
                /** @type {?} */
                var fdt_1 = (/** @type {?} */ (cmpRef.instance));
                fdt_1.remoteSort = false;
                fdt_1.selectedRow.subscribe((/**
                 * @param {?} e
                 * @return {?}
                 */
                function (e) {
                    if (_this_1.instance.singleSelect) {
                        _this_1.lookupSelectionSer.clearSelections();
                    }
                    _this_1.lookupSelectionSer.updateSelections(e.data);
                }));
                fdt_1.unSelectRow.subscribe((/**
                 * @param {?} e
                 * @return {?}
                 */
                function (e) {
                    _this_1.lookupSelectionSer.unSelect(e.data[_this_1.instance.idField]);
                }));
                if (!fdt_1.singleSelect) {
                    fdt_1.checkAll.subscribe((/**
                     * @param {?} e
                     * @return {?}
                     */
                    function (e) {
                        _this_1.lookupSelectionSer.updateSelections(fdt_1.data, e);
                    }));
                }
                fdt_1.cellClick.subscribe((/**
                 * @param {?} e
                 * @return {?}
                 */
                function (e) {
                    if (e.col.field === FAVORITE_FIELD_NAME) {
                        e.event.stopPropagation();
                        // tslint:disable-next-line: no-string-literal
                        /** @type {?} */
                        var classList = e.event.target['classList'];
                        if (classList.contains('f-lookup-unfavorite')) {
                            if (_this_1.instance.items) {
                                _this_1.instance.items.forEach((/**
                                 * @param {?} item
                                 * @return {?}
                                 */
                                function (item) {
                                    if (item[_this_1.instance.idField] === e.row[_this_1.instance.idField]) {
                                        item[FAVORITE_FIELD_NAME] = false;
                                    }
                                }));
                                /** @type {?} */
                                var dt = (/** @type {?} */ (_this_1.instance.componentRef.instance));
                                if (dt) {
                                    dt.loadData({
                                        pageSize: _this_1.instance.gridOptions.pageSize,
                                        pageIndex: _this_1.instance.gridOptions.pageIndex,
                                        total: _this_1.instance.gridOptions.total,
                                        data: _this_1.instance.gridOptions.items
                                    });
                                }
                            }
                            _this_1.instance.favoriteItems =
                                _this_1.instance.favoriteItems.filter((/**
                                 * @param {?} n
                                 * @return {?}
                                 */
                                function (n) { return n[_this_1.instance.idField] !== e.row[_this_1.instance.idField]; }));
                            _this_1.lookupSelectionSer.updateFavoriteData(e.row, FavoriteAction.delete);
                        }
                    }
                }));
                // 双击事件
                fdt_1.rowDblClick.subscribe((/**
                 * @param {?} rowData
                 * @return {?}
                 */
                function (rowData) {
                    if (_this_1.instance.gridOptions.singleSelect) {
                        _this_1.instance.selectItem(rowData);
                    }
                }));
                break;
            }
            case LookupGridDisplayType.TreeList: {
                if (cmpRef) {
                    /** @type {?} */
                    var ftt_1 = (/** @type {?} */ (cmpRef.instance));
                    ftt_1.remoteSort = false;
                    ftt_1.nodeSelected.subscribe((/**
                     * @param {?} e
                     * @return {?}
                     */
                    function (e) {
                        if (_this_1.instance.singleSelect) {
                            _this_1.lookupSelectionSer.clearSelections();
                        }
                        _this_1.lookupSelectionSer.updateSelections(e.node.data);
                    }));
                    ftt_1.nodeUnChecked.subscribe((/**
                     * @param {?} e
                     * @return {?}
                     */
                    function (e) {
                        if (e.nodes && e.nodes.length) {
                            _this_1.instance.multiSelMgr.remove(e.nodes.map((/**
                             * @param {?} n
                             * @return {?}
                             */
                            function (n) { return n.id; })));
                        }
                        else if (e && e.node && e.node.data && e.node.data.id) {
                            // const tt = this.instance.componentRef.instance as TreeTableComponent;
                            // tt.unSelectNode(e.node.data.id);
                            _this_1.lookupSelectionSer.unSelect(e.node.data.id);
                        }
                    }));
                    ftt_1.nodeChecked.subscribe((/**
                     * @param {?} e
                     * @return {?}
                     */
                    function (e) {
                        if (!_this_1.instance.singleSelect) {
                            if (e.nodes && e.nodes.length) {
                                _this_1.instance.multiSelMgr.updateSelections(e.nodes.map((/**
                                 * @param {?} n
                                 * @return {?}
                                 */
                                function (n) { return n.data; })));
                            }
                            else {
                                if (Array.isArray(e.node)) {
                                    _this_1.instance.multiSelMgr.updateSelections(e.node.map((/**
                                     * @param {?} n
                                     * @return {?}
                                     */
                                    function (n) { return n.data; })));
                                }
                                else {
                                    _this_1.instance.multiSelMgr.updateSelections([e.node.data]);
                                }
                            }
                        }
                    }));
                    ftt_1.cellClick.subscribe((/**
                     * @param {?} row
                     * @return {?}
                     */
                    function (row) {
                        if (row.col.field === FAVORITE_FIELD_NAME) {
                            row.event.stopPropagation();
                            /** @type {?} */
                            var classList = row.event.target['classList'];
                            if (classList.contains('f-lookup-unfavorite')) {
                                /** @type {?} */
                                var _this_2 = _this_1.instance;
                                ((/**
                                 * @param {?} items
                                 * @return {?}
                                 */
                                function every(items) {
                                    if (!items) {
                                        return;
                                    }
                                    /** @type {?} */
                                    var hasFinish = false;
                                    items.forEach((/**
                                     * @param {?} item
                                     * @return {?}
                                     */
                                    function (item) {
                                        if (hasFinish) {
                                            return;
                                        }
                                        if (item.data[_this_2.idField] === row.node[_this_2.idField]) {
                                            item.data[FAVORITE_FIELD_NAME] = false;
                                            hasFinish = true;
                                        }
                                        else if (item.children && item.children.length > 0) {
                                            every(item.children);
                                        }
                                    }));
                                }))(_this_1.instance.items);
                                /** @type {?} */
                                var tt = (/** @type {?} */ (_this_1.instance.componentRef.instance));
                                tt.loadData(_this_1.instance.items);
                                _this_1.lookupSelectionSer.updateFavoriteData(row.node.data, FavoriteAction.delete);
                            }
                        }
                    }));
                    ftt_1.dblClick.subscribe((/**
                     * @param {?} treeNode
                     * @return {?}
                     */
                    function (treeNode) {
                        if (_this_1.instance.gridOptions.singleSelect && treeNode.selectable) {
                            if (_this_1.instance.okButton) {
                                _this_1.instance.okButton.nativeElement.click();
                            }
                        }
                    }));
                    ftt_1.checkAll.subscribe((/**
                     * @param {?} e
                     * @return {?}
                     */
                    function (e) {
                        /** @type {?} */
                        var data = e.instance.checkeds.map((/**
                         * @param {?} n
                         * @return {?}
                         */
                        function (n) { return n.data; }));
                        _this_1.instance.multiSelMgr.updateSelections(data);
                        _this_1.instance.checkedChange.emit({ data: data, isCheck: true });
                    }));
                    ftt_1.unCheckAll.subscribe((/**
                     * @return {?}
                     */
                    function () {
                        // this.instance.multiSelMgr.clear();
                        /** @type {?} */
                        var nodeItems = ftt_1.state.rowNodes.map((/**
                         * @param {?} n
                         * @return {?}
                         */
                        function (n) { return n.node.data; }));
                        _this_1.lookupSelectionSer.updateSelections(nodeItems, false);
                        _this_1.instance.checkedChange.emit({ data: [], isCheck: false });
                    }));
                }
            }
        }
    };
    /**
     * @private
     * @return {?}
     */
    FavoriteHelper.prototype.getFavoritData = /**
     * @private
     * @return {?}
     */
    function () {
        if (this.instance.personalConf) {
            /** @type {?} */
            var favData = this.instance.personalConf.favorite;
            /** @type {?} */
            var _data = (favData && favData[this.instance.localService.localeId]) ? favData[this.instance.localService.localeId] : [];
            return _data;
        }
        return [];
    };
    /**
     * @return {?}
     */
    FavoriteHelper.prototype.getFavoritIds = /**
     * @return {?}
     */
    function () {
        return this.getFavoritData();
    };
    /**
     * @param {?=} data
     * @return {?}
     */
    FavoriteHelper.prototype._loadFavoriteData = /**
     * @param {?=} data
     * @return {?}
     */
    function (data) {
        if (data === void 0) { data = null; }
        /** @type {?} */
        var fdt = (/** @type {?} */ (this.instance.favoritesComponentRef.instance));
        this.loadFavoriteDatatable(fdt, data);
        fdt.cd.markForCheck();
        this.instance.closeLoading();
    };
    // 加载收藏grid数据
    // 加载收藏grid数据
    /**
     * @param {?=} res
     * @return {?}
     */
    FavoriteHelper.prototype.loadFavoritesData = 
    // 加载收藏grid数据
    /**
     * @param {?=} res
     * @return {?}
     */
    function (res) {
        if (res === void 0) { res = null; }
        /** @type {?} */
        var favIds = this.getFavoritIds();
        switch (this.instance.displayType) {
            case LookupGridDisplayType.NavList:
            case LookupGridDisplayType.NavTreeList:
            case LookupGridDisplayType.List: {
                /** @type {?} */
                var fdt = (/** @type {?} */ (this.instance.favoritesComponentRef.instance));
                if (this.instance.favoriteDataFrom === 'locale') {
                    if (res) {
                        this._loadFavoriteData(res.items);
                    }
                    else {
                        // this.instance.httpMgr.getFavoriteData(favIds).subscribe(resData => {
                        //     if (resData) {
                        //         this._loadFavoriteData(resData.items);
                        //     }
                        //     this.instance.closeLoading();
                        // });
                    }
                }
                else {
                    /** @type {?} */
                    var favData = this.getFavoritData();
                    this.loadFavoriteDatatable(fdt, res ? res.items : favData);
                }
                break;
            }
            case LookupGridDisplayType.TreeList: {
                if (this.instance.favoritesComponentRef && this.instance.favoritesComponentRef.instance instanceof TreeTableComponent) {
                    /** @type {?} */
                    var ftt = (/** @type {?} */ (this.instance.favoritesComponentRef.instance));
                    this.bindFavTreetable(ftt);
                    if (this.instance.favoriteDataFrom === 'locale') {
                        if (res) {
                            this.loadFavoriteForTreeTable(res.items || [], ftt);
                        }
                        else {
                            // this.instance.httpMgr.getFavoriteData(favIds).subscribe(resData => {
                            //     if (resData) {
                            //         const items = resData.items;
                            //         this.loadFavoriteForTreeTable(items, ftt);
                            //     }
                            //     this.instance.closeLoading();
                            // });
                        }
                    }
                    else {
                        if (res) {
                            this.loadFavoriteForTreeTable(res.items, ftt);
                        }
                    }
                }
            }
        }
    };
    /**
     * @private
     * @param {?} fdt
     * @param {?=} data
     * @return {?}
     */
    FavoriteHelper.prototype.loadFavoriteDatatable = /**
     * @private
     * @param {?} fdt
     * @param {?=} data
     * @return {?}
     */
    function (fdt, data) {
        if (data !== undefined) {
            this.instance.favoriteItems = data;
        }
        if (fdt.columns && !fdt.columns.length) {
            fdt.columns = this.instance.favoriteColumns;
        }
        fdt.loadData({
            total: 0,
            pageSize: 20,
            pageIndex: 1,
            data: this.instance.favoriteItems
        });
        this.instance.selectionMgr.selectCurrentValue();
        fdt.cd.detectChanges();
    };
    /**
     * @private
     * @param {?} ftt
     * @return {?}
     */
    FavoriteHelper.prototype.bindFavTreetable = /**
     * @private
     * @param {?} ftt
     * @return {?}
     */
    function (ftt) {
        var _this_1 = this;
        ftt.allColumnsTitle = this.instance.allColumnsTitle;
        ftt.idField = this.instance.idField;
        /** @type {?} */
        var columns = this.instance.gridOptions.columns.map((/**
         * @param {?} item
         * @return {?}
         */
        function (item) {
            /** @type {?} */
            var rtn = tslib_1.__assign({}, item);
            if (item.field === FAVORITE_FIELD_NAME) {
                rtn.formatter = (/**
                 * @param {?} v
                 * @param {?} data
                 * @return {?}
                 */
                function (v, data) {
                    /** @type {?} */
                    var favids = _this_1.getFavoritIds();
                    if (favids && favids.length) {
                        /** @type {?} */
                        var index = favids.findIndex((/**
                         * @param {?} el
                         * @return {?}
                         */
                        function (el) { return el === data[_this_1.instance.idField]; }));
                        if (index >= 0) {
                            return FavoriteIcon.delete;
                        }
                    }
                    return '';
                });
            }
            return rtn;
        }));
        this.instance.initColumnWidth(columns, 'fav');
        this.instance.favoriteColumns = columns;
        ftt.columns = columns;
        if (this.instance.gridOptions.treeInfo) {
            ftt.onlySelectLeaf = this.instance.gridOptions.treeInfo.onlySelectLeaf;
        }
        if (!ftt.singleSelect) {
            ftt.checkOnSelect = true;
            ftt.selectOnCheck = true;
            ftt.showCheckbox = true;
            // 启用多选后，同时启用级联选择
            if (this.instance.enableCascade) {
                this.instance.ttEventMgr.cascadeValueChanged(this.instance.cascadeStatus);
            }
            else {
                ftt.cascadeCheck = false;
                ftt.cascadeDown = false;
                ftt.cascadeUp = false;
            }
        }
    };
    /**
     * @private
     * @param {?} nodes
     * @return {?}
     */
    FavoriteHelper.prototype.checkNodeIsLeaf = /**
     * @private
     * @param {?} nodes
     * @return {?}
     */
    function (nodes) {
        var _this_1 = this;
        if (nodes && nodes.length) {
            return nodes.map((/**
             * @param {?} node
             * @return {?}
             */
            function (node) {
                if (node.hasOwnProperty("addtional")) {
                    node.selectable = !node["addtional"];
                }
                if (node.children && node.children.length) {
                    _this_1.checkNodeIsLeaf(node.children);
                }
                else {
                    node.leaf = true;
                }
                return node;
            }));
        }
        return nodes;
    };
    /**
     * @param {?} items
     * @return {?}
     */
    FavoriteHelper.prototype.initFavoriteTreeData = /**
     * @param {?} items
     * @return {?}
     */
    function (items) {
        /** @type {?} */
        var treeInfo = this.instance.gridOptions.treeInfo;
        if (treeInfo && !treeInfo['treeDataIsInit']) {
            if (treeInfo.layerType.toLowerCase() === 'pathcode') {
                items = this.instance.lookupUtils.makeTree(items, treeInfo);
            }
            else {
                items = this.instance.lookupUtils.makeTreeWithParentID(items, '', treeInfo.dataField ? treeInfo.dataField + "." + treeInfo.parentField : treeInfo.parentField, this.instance.idField);
            }
        }
        // return this.instance.checkNodeCanBeSelect(items, true);
        return this.checkNodeIsLeaf(items);
    };
    /**
     * @param {?} items
     * @param {?} ftt
     * @return {?}
     */
    FavoriteHelper.prototype.loadFavoriteForTreeTable = /**
     * @param {?} items
     * @param {?} ftt
     * @return {?}
     */
    function (items, ftt) {
        items = this.initFavoriteTreeData(items);
        this.instance.favoriteItems = items;
        ftt.loadData(items);
        ftt.expandAll();
        this.instance.selectionMgr.selectCurrentValue();
        return items;
    };
    // 更新列表中的收藏数据标识
    // 更新列表中的收藏数据标识
    /**
     * @param {?} data
     * @return {?}
     */
    FavoriteHelper.prototype.updateFavoritesStatus = 
    // 更新列表中的收藏数据标识
    /**
     * @param {?} data
     * @return {?}
     */
    function (data) {
        var _this_1 = this;
        if (!data || !this.instance.useFavorite) {
            return;
        }
        /** @type {?} */
        var favIds = this.getFavoritIds();
        if (favIds && favIds.length) {
            // 处理数据列表中的收藏数据标识
            if (this.instance.displayType !== LookupGridDisplayType.TreeList) {
                data.map((/**
                 * @param {?} item
                 * @return {?}
                 */
                function (item) {
                    if (favIds && favIds.length && favIds.find((/**
                     * @param {?} v
                     * @return {?}
                     */
                    function (v) { return v === item[_this_1.instance.idField]; }))) {
                        item[FAVORITE_FIELD_NAME] = true;
                    }
                }));
            }
            else {
                /** @type {?} */
                var _this_3 = this.instance;
                ((/**
                 * @param {?} _data
                 * @return {?}
                 */
                function each(_data) {
                    _data.forEach((/**
                     * @param {?} item
                     * @return {?}
                     */
                    function (item) {
                        if (favIds && favIds.length && favIds.find((/**
                         * @param {?} v
                         * @return {?}
                         */
                        function (v) { return v === item.data[_this_3.idField]; }))) {
                            item.data[FAVORITE_FIELD_NAME] = true;
                        }
                        if (item.children && item.children.length > 0) {
                            each(item.children);
                        }
                    }));
                }))(data);
            }
        }
    };
    /**
     * @private
     * @param {?} value
     * @param {?} action
     * @param {?} data
     * @return {?}
     */
    FavoriteHelper.prototype._updateFavorites = /**
     * @private
     * @param {?} value
     * @param {?} action
     * @param {?} data
     * @return {?}
     */
    function (value, action, data) {
        var _this_1 = this;
        /** @type {?} */
        var localeID = this.instance.localService.localeId;
        this.instance.personalConf.favorite = this.instance.personalConf.favorite || {};
        /** @type {?} */
        var items = value.filter((/**
         * @param {?} n
         * @return {?}
         */
        function (n) { return !n['_addtional_']; }));
        /** @type {?} */
        var newVal = items.map((/**
         * @param {?} n
         * @return {?}
         */
        function (n) { return n[_this_1.instance.idField]; })).filter((/**
         * @param {?} n
         * @return {?}
         */
        function (n) { return n !== null && n !== undefined; }));
        /** @type {?} */
        var favItems = this.instance.personalConf.favorite[localeID] || [];
        this.instance.personalConf.favorite[localeID] = Array.from(new Set(tslib_1.__spread(favItems, newVal)));
        if (action === FavoriteAction.delete && data) {
            this.instance.personalConf.favorite[localeID] = this.instance.personalConf.favorite[localeID].filter((/**
             * @param {?} n
             * @return {?}
             */
            function (n) { return n !== data[_this_1.instance.idField]; }));
        }
        return this.instance.personalConf.favorite[localeID];
    };
    // 收藏数据管理
    // 收藏数据管理
    /**
     * @private
     * @return {?}
     */
    FavoriteHelper.prototype.listenPersonalConfigHandler = 
    // 收藏数据管理
    /**
     * @private
     * @return {?}
     */
    function () {
        var _this_1 = this;
        this.lookupSelectionSer.favoriteItems$.subscribe((/**
         * @param {?} n
         * @return {?}
         */
        function (n) {
            if (!_this_1.instance.favoritesComponentRef) {
                return;
            }
            var items = n.items, action = n.action, data = n.data;
            /** @type {?} */
            var favids = _this_1._updateFavorites(items, action, data);
            _this_1.instance.httpMgr.submitFavoriteData(action);
            if (_this_1.instance.displayType === LookupGridDisplayType.List || _this_1.instance.displayType.includes('NAV')) {
                /** @type {?} */
                var dt = (/** @type {?} */ (_this_1.instance.favoritesComponentRef.instance));
                _this_1.loadFavoriteDatatable(dt, items);
            }
            else if (_this_1.instance.displayType === LookupGridDisplayType.TreeList) {
                /** @type {?} */
                var ftt_2 = (/** @type {?} */ (_this_1.instance.favoritesComponentRef.instance));
                // const favids = items.map(d => d.id);
                _this_1.instance.showLoading();
                _this_1.instance.httpMgr.getData({ favoriteIds: favids }, 'fav').subscribe((/**
                 * @param {?} resData
                 * @return {?}
                 */
                function (resData) {
                    if (resData) {
                        /** @type {?} */
                        var _items = resData.items;
                        _this_1.loadFavoriteForTreeTable(_items, ftt_2);
                    }
                    else {
                        _this_1.instance.favoriteItems = [];
                        ftt_2.loadData([]);
                    }
                    _this_1.instance.closeLoading();
                }));
            }
        }));
    };
    return FavoriteHelper;
}());
export { FavoriteHelper };
if (false) {
    /**
     * @type {?}
     * @private
     */
    FavoriteHelper.prototype.lookupSelectionSer;
    /** @type {?} */
    FavoriteHelper.prototype.favoriteColumnFormatter;
    /**
     * @type {?}
     * @private
     */
    FavoriteHelper.prototype.instance;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmF2b3JpdGUtaGVscGVyLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy91aS1sb29rdXAvIiwic291cmNlcyI6WyJsaWIvc2VydmljZXMvZmF2b3JpdGUtaGVscGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBRUEsT0FBTyxFQUFZLGtCQUFrQixFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFFcEUsT0FBTyxFQUFFLGNBQWMsRUFBRSxZQUFZLEVBQUUsbUJBQW1CLEVBQUUscUJBQXFCLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQUtqSDtJQUlJLHdCQUFvQixRQUE2QjtRQUFqRCxtQkFFQztRQUZtQixhQUFRLEdBQVIsUUFBUSxDQUFxQjtRQWlCakQsNEJBQXVCOzs7OztRQUFHLFVBQUMsQ0FBTSxFQUFFLElBQVM7O2dCQUNsQyxDQUFDLEdBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxZQUFZLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxZQUFZLENBQUMsRUFBRTtZQUNqRCxJQUFJLE9BQUksQ0FBQyxRQUFRLENBQUMsTUFBTSxFQUFFLEVBQUU7O29CQUNsQixFQUFFLEdBQUcsSUFBSSxDQUFDLE9BQUksQ0FBQyxRQUFRLENBQUMsT0FBTyxDQUFDO2dCQUN0QyxJQUFJLEVBQUUsRUFBRTs7d0JBQ0UsRUFBRSxHQUFHLG1CQUFBLE9BQUksQ0FBQyxRQUFRLENBQUMsWUFBWSxDQUFDLFFBQVEsRUFBc0I7O3dCQUM5RCxFQUFFLEdBQUcsRUFBRSxDQUFDLFdBQVcsQ0FBQyxFQUFFLENBQUM7b0JBQzdCLElBQUksRUFBRSxFQUFFO3dCQUNKLElBQUksRUFBRSxDQUFDLElBQUksQ0FBQyxVQUFVLEVBQUU7NEJBQ3BCLE9BQU8sQ0FBQyxDQUFDO3lCQUNaOzZCQUFNOzRCQUNILE9BQU8sRUFBRSxDQUFDO3lCQUNiO3FCQUNKO2lCQUNKO2FBQ0o7WUFDRCxPQUFPLENBQUMsQ0FBQztRQUNiLENBQUMsRUFBQTtRQWpDRyxJQUFJLENBQUMsa0JBQWtC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LHFCQUFxQixDQUFDLFFBQVEsRUFBc0I7Z0JBQzdFLE9BQUksQ0FBQyxxQkFBcUIsQ0FBQyxFQUFFLEVBQUUsS0FBSyxDQUFDLENBQUM7YUFDekM7aUJBQU0sSUFBSSxPQUFJLENBQUMsUUFBUSxDQUFDLFdBQVcsS0FBSyxxQkFBcUIsQ0FBQyxRQUFRLEVBQUU7O29CQUMvRCxLQUFHLEdBQUcsbUJBQUEsT0FBSSxDQUFDLFFBQVEsQ0FBQyxxQkFBcUIsQ0FBQyxRQUFRLEVBQXNCO2dCQUM5RSx1Q0FBdUM7Z0JBQ3ZDLE9BQUksQ0FBQyxRQUFRLENBQUMsV0FBVyxFQUFFLENBQUM7Z0JBQzVCLE9BQUksQ0FBQyxRQUFRLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxFQUFFLFdBQVcsRUFBRSxNQUFNLEVBQUUsRUFBRSxLQUFLLENBQUMsQ0FBQyxTQUFTOzs7O2dCQUFDLFVBQUEsT0FBTztvQkFDM0UsSUFBSSxPQUFPLEVBQUU7OzRCQUNILE1BQU0sR0FBRyxPQUFPLENBQUMsS0FBSzt3QkFDNUIsT0FBSSxDQUFDLHdCQUF3QixDQUFDLE1BQU0sRUFBRSxLQUFHLENBQUMsQ0FBQztxQkFDOUM7eUJBQU07d0JBQ0gsT0FBSSxDQUFDLFFBQVEsQ0FBQyxhQUFhLEdBQUcsRUFBRSxDQUFDO3dCQUNqQyxLQUFHLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQyxDQUFDO3FCQUNwQjtvQkFDRCxPQUFJLENBQUMsUUFBUSxDQUFDLFlBQVksRUFBRSxDQUFDO2dCQUNqQyxDQUFDLEVBQUMsQ0FBQzthQUNOO1FBQ0wsQ0FBQyxFQUFDLENBQUM7SUFDUCxDQUFDO0lBRUwscUJBQUM7QUFBRCxDQUFDLEFBNWVELElBNGVDOzs7Ozs7O0lBMWVHLDRDQUFtRDs7SUFtQm5ELGlEQWlCQzs7Ozs7SUFsQ1csa0NBQXFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50UmVmIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IERhdGFUYWJsZUNvbXBvbmVudCB9IGZyb20gJ0BmYXJyaXMvdWktZGF0YXRhYmxlJztcclxuaW1wb3J0IHsgVHJlZU5vZGUsIFRyZWVUYWJsZUNvbXBvbmVudCB9IGZyb20gJ0BmYXJyaXMvdWktdHJlZXRhYmxlJztcclxuaW1wb3J0IHsgVXNlckZhdm9yaXRlRGF0YSB9IGZyb20gJy4uL2h0dHAvUmVtb3RlUGFyYW1zJztcclxuaW1wb3J0IHsgRmF2b3JpdGVBY3Rpb24sIEZhdm9yaXRlSWNvbiwgRkFWT1JJVEVfRklFTERfTkFNRSwgTG9va3VwR3JpZERpc3BsYXlUeXBlIH0gZnJvbSAnLi4vbG9va3VwLWRpc3BsYXl0eXBlJztcclxuaW1wb3J0IHsgTG9va3VwR3JpZFJlc3VsdCB9IGZyb20gJy4uL2xvb2t1cC1ncmlkLW9wdGlvbnMnO1xyXG5pbXBvcnQgeyBMb29rdXBHcmlkQ29tcG9uZW50IH0gZnJvbSAnLi4vbG9va3VwLWdyaWQuY29tcG9uZW50JztcclxuaW1wb3J0IHsgTG9va3VwU2VsZWN0aW9uU2VydmljZSB9IGZyb20gJy4vbG9va3VwLXNlbGVjdGlvbi5zZXJ2aWNlJztcclxuXHJcbmV4cG9ydCBjbGFzcyBGYXZvcml0ZUhlbHBlciB7XHJcblxyXG4gICAgcHJpdmF0ZSBsb29rdXBTZWxlY3Rpb25TZXI6IExvb2t1cFNlbGVjdGlvblNlcnZpY2U7XHJcblxyXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBpbnN0YW5jZTogTG9va3VwR3JpZENvbXBvbmVudCkge1xyXG4gICAgICAgIHRoaXMubG9va3VwU2VsZWN0aW9uU2VyID0gdGhpcy5pbnN0YW5jZS5sb29rdXBTZWxlY3Rpb25TZXI7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0RmF2b3JpdGVDb2x1bW5zKCk6IGFueVtdIHtcclxuICAgICAgICBjb25zdCBjb2x1bW5zID0gdGhpcy5pbnN0YW5jZS5ncmlkT3B0aW9ucy5jb2x1bW5zLm1hcChpdGVtID0+IHtcclxuICAgICAgICAgICAgY29uc3QgcnRuID0gT2JqZWN0LmFzc2lnbih7fSwgaXRlbSk7XHJcbiAgICAgICAgICAgIGlmIChpdGVtLmZpZWxkID09PSBGQVZPUklURV9GSUVMRF9OQU1FKSB7XHJcbiAgICAgICAgICAgICAgICBydG4uZm9ybWF0dGVyID0gKCkgPT4gRmF2b3JpdGVJY29uLmRlbGV0ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gcnRuO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICB0aGlzLmluc3RhbmNlLmluaXRDb2x1bW5XaWR0aChjb2x1bW5zLCAnZmF2Jyk7XHJcbiAgICAgICAgcmV0dXJuIGNvbHVtbnM7XHJcbiAgICB9XHJcblxyXG4gICAgZmF2b3JpdGVDb2x1bW5Gb3JtYXR0ZXIgPSAodjogYW55LCBkYXRhOiBhbnkgICkgPT4ge1xyXG4gICAgICAgIGNvbnN0IGYgPSAgdiA/IEZhdm9yaXRlSWNvbi55ZXMgOiBGYXZvcml0ZUljb24ubm87XHJcbiAgICAgICAgaWYgKHRoaXMuaW5zdGFuY2UuaXNUcmVlKCkpIHtcclxuICAgICAgICAgICAgY29uc3QgaWQgPSBkYXRhW3RoaXMuaW5zdGFuY2UuaWRGaWVsZF07XHJcbiAgICAgICAgICAgIGlmIChpZCkge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgdHQgPSB0aGlzLmluc3RhbmNlLmNvbXBvbmVudFJlZi5pbnN0YW5jZSBhcyBUcmVlVGFibGVDb21wb25lbnQ7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBybiA9IHR0LmZpbmRSb3dOb2RlKGlkKTtcclxuICAgICAgICAgICAgICAgIGlmIChybikge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChybi5ub2RlLnNlbGVjdGFibGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGY7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICcnO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gZjtcclxuICAgIH1cclxuXHJcbiAgICBpbml0UGVyc29uYWxJbmZvKCkge1xyXG4gICAgICAgIGlmICh0aGlzLmluc3RhbmNlLnBlcnNvbmFsQ29uZmlnU2VydmljZSkge1xyXG4gICAgICAgICAgICBjb25zdCBjb250cm9sSUQgPSB0aGlzLmluc3RhbmNlLmVsLm5hdGl2ZUVsZW1lbnQuaWQgfHwgdGhpcy5pbnN0YW5jZS5jb250cm9sSWQ7XHJcbiAgICAgICAgICAgIGlmICghY29udHJvbElEKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmluc3RhbmNlLndyaXRlQ29uc29sZSgnTG9va3VwR3JpZCAtIOacquiuvue9rue7hOS7tmlkLCDmlLbol4/lip/og73lsIbkuI3og73mraPluLjvvIzor7forr7nva7nu4Tku7ZpZC4nKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjb25zdCBwY3N0ciA9IHRoaXMuaW5zdGFuY2UuZ2V0TG9va3VwQmluZGluZ0ZpZWxkcygpO1xyXG4gICAgICAgICAgICB0aGlzLmluc3RhbmNlLnBlcnNvbmFsQ29uZmlnU2VydmljZS5jb250cm9sSUQgPSBjb250cm9sSUQ7XHJcbiAgICAgICAgICAgIHRoaXMuaW5zdGFuY2UucGVyc29uYWxDb25maWdTZXJ2aWNlLnBlcnNvbmFsQ29uZmlnS2V5ID0gcGNzdHI7XHJcblxyXG4gICAgICAgICAgICBjb25zdCBjb25mID0ge1xyXG4gICAgICAgICAgICAgICAgZGlzcGxheVR5cGU6IHRoaXMuaW5zdGFuY2UuZGlzcGxheVR5cGUsXHJcbiAgICAgICAgICAgICAgICBzaW5nbGVTZWxlY3Q6IHRoaXMuaW5zdGFuY2Uuc2luZ2xlU2VsZWN0LFxyXG4gICAgICAgICAgICAgICAgaWRGaWVsZDogdGhpcy5pbnN0YW5jZS5pZEZpZWxkLFxyXG4gICAgICAgICAgICAgICAgdGV4dEZpZWxkOiB0aGlzLmluc3RhbmNlLnRleHRGaWVsZCxcclxuICAgICAgICAgICAgICAgIG1hcEZpZWxkczogT2JqZWN0LmFzc2lnbih7fSwgdGhpcy5pbnN0YW5jZS5tYXBGaWVsZHMgfHwge30pXHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICB0aGlzLmluc3RhbmNlLnBlcnNvbmFsQ29uZmlnU2VydmljZS5pbml0UGVyc29uYWxDb25mKGNvbmYpO1xyXG5cclxuICAgICAgICAgICAgLy8g5Liq5oCn5YyW6YWN572u55qE6K6i6ZiF5LqL5Lu25aSE55CGXHJcbiAgICAgICAgICAgIHRoaXMubGlzdGVuUGVyc29uYWxDb25maWdIYW5kbGVyKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog55uR5ZCs5pS26JePVEFC6aG15Lit55u45YWz5LqL5Lu277ybXHJcbiAgICAgKiDmlbDmja7pgInkuK3vvIzlj5bmtojpgInkuK3vvIznp7vpmaTmlLbol4/vvIzlj4zlh7vkuovku7ZcclxuICAgICAqL1xyXG4gICAgaW5pdEZhdm9yaXRlQ29tcG9uZW50RXZlbnQoY21wUmVmOiBDb21wb25lbnRSZWY8YW55Pikge1xyXG4gICAgICAgIHN3aXRjaCAodGhpcy5pbnN0YW5jZS5kaXNwbGF5VHlwZSkge1xyXG4gICAgICAgICAgICBjYXNlIExvb2t1cEdyaWREaXNwbGF5VHlwZS5OYXZMaXN0OlxyXG4gICAgICAgICAgICBjYXNlIExvb2t1cEdyaWREaXNwbGF5VHlwZS5OYXZUcmVlTGlzdDpcclxuICAgICAgICAgICAgY2FzZSBMb29rdXBHcmlkRGlzcGxheVR5cGUuTGlzdDoge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgZmR0ID0gY21wUmVmLmluc3RhbmNlIGFzIERhdGFUYWJsZUNvbXBvbmVudDtcclxuICAgICAgICAgICAgICAgIGZkdC5yZW1vdGVTb3J0ID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICBmZHQuc2VsZWN0ZWRSb3cuc3Vic2NyaWJlKGUgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmluc3RhbmNlLnNpbmdsZVNlbGVjdCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxvb2t1cFNlbGVjdGlvblNlci5jbGVhclNlbGVjdGlvbnMoKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5sb29rdXBTZWxlY3Rpb25TZXIudXBkYXRlU2VsZWN0aW9ucyhlLmRhdGEpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICBmZHQudW5TZWxlY3RSb3cuc3Vic2NyaWJlKGUgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMubG9va3VwU2VsZWN0aW9uU2VyLnVuU2VsZWN0KGUuZGF0YVt0aGlzLmluc3RhbmNlLmlkRmllbGRdKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmICghZmR0LnNpbmdsZVNlbGVjdCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGZkdC5jaGVja0FsbC5zdWJzY3JpYmUoZSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubG9va3VwU2VsZWN0aW9uU2VyLnVwZGF0ZVNlbGVjdGlvbnMoZmR0LmRhdGEsIGUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGZkdC5jZWxsQ2xpY2suc3Vic2NyaWJlKChlOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZS5jb2wuZmllbGQgPT09IEZBVk9SSVRFX0ZJRUxEX05BTUUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZS5ldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOiBuby1zdHJpbmctbGl0ZXJhbFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjbGFzc0xpc3QgPSBlLmV2ZW50LnRhcmdldFsnY2xhc3NMaXN0J107XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjbGFzc0xpc3QuY29udGFpbnMoJ2YtbG9va3VwLXVuZmF2b3JpdGUnKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuaW5zdGFuY2UuaXRlbXMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmluc3RhbmNlLml0ZW1zLmZvckVhY2goaXRlbSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpdGVtW3RoaXMuaW5zdGFuY2UuaWRGaWVsZF0gPT09IGUucm93W3RoaXMuaW5zdGFuY2UuaWRGaWVsZF0pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1bRkFWT1JJVEVfRklFTERfTkFNRV0gPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBkdCA9IHRoaXMuaW5zdGFuY2UuY29tcG9uZW50UmVmLmluc3RhbmNlIGFzIERhdGFUYWJsZUNvbXBvbmVudDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZHQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZHQubG9hZERhdGEoe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFnZVNpemU6IHRoaXMuaW5zdGFuY2UuZ3JpZE9wdGlvbnMucGFnZVNpemUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYWdlSW5kZXg6IHRoaXMuaW5zdGFuY2UuZ3JpZE9wdGlvbnMucGFnZUluZGV4LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG90YWw6IHRoaXMuaW5zdGFuY2UuZ3JpZE9wdGlvbnMudG90YWwsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhOiB0aGlzLmluc3RhbmNlLmdyaWRPcHRpb25zLml0ZW1zXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmluc3RhbmNlLmZhdm9yaXRlSXRlbXMgPVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaW5zdGFuY2UuZmF2b3JpdGVJdGVtcy5maWx0ZXIobiA9PiBuW3RoaXMuaW5zdGFuY2UuaWRGaWVsZF0gIT09IGUucm93W3RoaXMuaW5zdGFuY2UuaWRGaWVsZF0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubG9va3VwU2VsZWN0aW9uU2VyLnVwZGF0ZUZhdm9yaXRlRGF0YShlLnJvdywgRmF2b3JpdGVBY3Rpb24uZGVsZXRlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIOWPjOWHu+S6i+S7tlxyXG4gICAgICAgICAgICAgICAgZmR0LnJvd0RibENsaWNrLnN1YnNjcmliZSgocm93RGF0YTogYW55KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuaW5zdGFuY2UuZ3JpZE9wdGlvbnMuc2luZ2xlU2VsZWN0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaW5zdGFuY2Uuc2VsZWN0SXRlbShyb3dEYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNhc2UgTG9va3VwR3JpZERpc3BsYXlUeXBlLlRyZWVMaXN0OiB7XHJcbiAgICAgICAgICAgICAgICBpZiAoY21wUmVmKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZnR0ID0gY21wUmVmLmluc3RhbmNlIGFzIFRyZWVUYWJsZUNvbXBvbmVudDtcclxuICAgICAgICAgICAgICAgICAgICBmdHQucmVtb3RlU29ydCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIGZ0dC5ub2RlU2VsZWN0ZWQuc3Vic2NyaWJlKGUgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5pbnN0YW5jZS5zaW5nbGVTZWxlY3QpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubG9va3VwU2VsZWN0aW9uU2VyLmNsZWFyU2VsZWN0aW9ucygpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubG9va3VwU2VsZWN0aW9uU2VyLnVwZGF0ZVNlbGVjdGlvbnMoZS5ub2RlLmRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIGZ0dC5ub2RlVW5DaGVja2VkLnN1YnNjcmliZShlID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGUubm9kZXMgJiYgZS5ub2Rlcy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaW5zdGFuY2UubXVsdGlTZWxNZ3IucmVtb3ZlKGUubm9kZXMubWFwKG4gPT4gbi5pZCkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGUgJiYgZS5ub2RlICYmIGUubm9kZS5kYXRhICYmIGUubm9kZS5kYXRhLmlkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBjb25zdCB0dCA9IHRoaXMuaW5zdGFuY2UuY29tcG9uZW50UmVmLmluc3RhbmNlIGFzIFRyZWVUYWJsZUNvbXBvbmVudDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHR0LnVuU2VsZWN0Tm9kZShlLm5vZGUuZGF0YS5pZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxvb2t1cFNlbGVjdGlvblNlci51blNlbGVjdChlLm5vZGUuZGF0YS5pZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgZnR0Lm5vZGVDaGVja2VkLnN1YnNjcmliZSggZSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5pbnN0YW5jZS5zaW5nbGVTZWxlY3QpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlLm5vZGVzICYmIGUubm9kZXMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnN0YW5jZS5tdWx0aVNlbE1nci51cGRhdGVTZWxlY3Rpb25zKGUubm9kZXMubWFwKG4gPT4gbi5kYXRhKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KGUubm9kZSkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnN0YW5jZS5tdWx0aVNlbE1nci51cGRhdGVTZWxlY3Rpb25zKGUubm9kZS5tYXAobiA9PiBuLmRhdGEpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmluc3RhbmNlLm11bHRpU2VsTWdyLnVwZGF0ZVNlbGVjdGlvbnMoW2Uubm9kZS5kYXRhXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGZ0dC5jZWxsQ2xpY2suc3Vic2NyaWJlKHJvdyA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyb3cuY29sLmZpZWxkID09PSBGQVZPUklURV9GSUVMRF9OQU1FKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByb3cuZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjbGFzc0xpc3QgPSByb3cuZXZlbnQudGFyZ2V0WydjbGFzc0xpc3QnXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjbGFzc0xpc3QuY29udGFpbnMoJ2YtbG9va3VwLXVuZmF2b3JpdGUnKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IF90aGlzID0gdGhpcy5pbnN0YW5jZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoZnVuY3Rpb24gZXZlcnkoaXRlbXMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFpdGVtcykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBoYXNGaW5pc2ggPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbXMuZm9yRWFjaChpdGVtID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChoYXNGaW5pc2gpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbS5kYXRhW190aGlzLmlkRmllbGRdID09PSByb3cubm9kZVtfdGhpcy5pZEZpZWxkXSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0uZGF0YVtGQVZPUklURV9GSUVMRF9OQU1FXSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhhc0ZpbmlzaCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGl0ZW0uY2hpbGRyZW4gJiYgaXRlbS5jaGlsZHJlbi5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXZlcnkoaXRlbS5jaGlsZHJlbik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pKHRoaXMuaW5zdGFuY2UuaXRlbXMpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHR0ID0gdGhpcy5pbnN0YW5jZS5jb21wb25lbnRSZWYuaW5zdGFuY2UgYXMgVHJlZVRhYmxlQ29tcG9uZW50O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR0LmxvYWREYXRhKHRoaXMuaW5zdGFuY2UuaXRlbXMpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxvb2t1cFNlbGVjdGlvblNlci51cGRhdGVGYXZvcml0ZURhdGEocm93Lm5vZGUuZGF0YSwgRmF2b3JpdGVBY3Rpb24uZGVsZXRlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIGZ0dC5kYmxDbGljay5zdWJzY3JpYmUoKHRyZWVOb2RlOiBUcmVlTm9kZSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5pbnN0YW5jZS5ncmlkT3B0aW9ucy5zaW5nbGVTZWxlY3QgJiYgdHJlZU5vZGUuc2VsZWN0YWJsZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuaW5zdGFuY2Uub2tCdXR0b24pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmluc3RhbmNlLm9rQnV0dG9uLm5hdGl2ZUVsZW1lbnQuY2xpY2soKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBmdHQuY2hlY2tBbGwuc3Vic2NyaWJlKCBlID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZGF0YSA9IGUuaW5zdGFuY2UuY2hlY2tlZHMubWFwKG4gPT4gbi5kYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnN0YW5jZS5tdWx0aVNlbE1nci51cGRhdGVTZWxlY3Rpb25zKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmluc3RhbmNlLmNoZWNrZWRDaGFuZ2UuZW1pdCh7IGRhdGEsIGlzQ2hlY2s6IHRydWUgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIGZ0dC51bkNoZWNrQWxsLnN1YnNjcmliZSgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRoaXMuaW5zdGFuY2UubXVsdGlTZWxNZ3IuY2xlYXIoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgbm9kZUl0ZW1zID0gZnR0LnN0YXRlLnJvd05vZGVzLm1hcChuID0+IG4ubm9kZS5kYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sb29rdXBTZWxlY3Rpb25TZXIudXBkYXRlU2VsZWN0aW9ucyhub2RlSXRlbXMsIGZhbHNlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnN0YW5jZS5jaGVja2VkQ2hhbmdlLmVtaXQoeyBkYXRhOiBbXSwgaXNDaGVjazogZmFsc2UgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuXHJcbiAgICBwcml2YXRlIGdldEZhdm9yaXREYXRhKCkge1xyXG4gICAgICAgIGlmICh0aGlzLmluc3RhbmNlLnBlcnNvbmFsQ29uZikge1xyXG4gICAgICAgICAgICBjb25zdCBmYXZEYXRhID0gdGhpcy5pbnN0YW5jZS5wZXJzb25hbENvbmYuZmF2b3JpdGU7XHJcbiAgICAgICAgICAgIGNvbnN0IF9kYXRhID0gKGZhdkRhdGEgJiYgZmF2RGF0YVt0aGlzLmluc3RhbmNlLmxvY2FsU2VydmljZS5sb2NhbGVJZF0pID8gZmF2RGF0YVt0aGlzLmluc3RhbmNlLmxvY2FsU2VydmljZS5sb2NhbGVJZF0gOiBbXTtcclxuICAgICAgICAgICAgcmV0dXJuIF9kYXRhO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gW107XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0RmF2b3JpdElkcygpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5nZXRGYXZvcml0RGF0YSgpO1xyXG4gICAgfVxyXG5cclxuICAgIF9sb2FkRmF2b3JpdGVEYXRhKGRhdGEgPSBudWxsKSB7XHJcbiAgICAgICAgY29uc3QgZmR0ID0gdGhpcy5pbnN0YW5jZS5mYXZvcml0ZXNDb21wb25lbnRSZWYuaW5zdGFuY2UgYXMgRGF0YVRhYmxlQ29tcG9uZW50O1xyXG4gICAgICAgIHRoaXMubG9hZEZhdm9yaXRlRGF0YXRhYmxlKGZkdCwgZGF0YSk7XHJcbiAgICAgICAgZmR0LmNkLm1hcmtGb3JDaGVjaygpO1xyXG4gICAgICAgIHRoaXMuaW5zdGFuY2UuY2xvc2VMb2FkaW5nKCk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8g5Yqg6L295pS26JePZ3JpZOaVsOaNrlxyXG4gICAgbG9hZEZhdm9yaXRlc0RhdGEocmVzID0gbnVsbCkge1xyXG4gICAgICAgIGNvbnN0IGZhdklkcyA9IHRoaXMuZ2V0RmF2b3JpdElkcygpO1xyXG4gICAgICAgIHN3aXRjaCAodGhpcy5pbnN0YW5jZS5kaXNwbGF5VHlwZSkge1xyXG4gICAgICAgICAgICBjYXNlIExvb2t1cEdyaWREaXNwbGF5VHlwZS5OYXZMaXN0OlxyXG4gICAgICAgICAgICBjYXNlIExvb2t1cEdyaWREaXNwbGF5VHlwZS5OYXZUcmVlTGlzdDpcclxuICAgICAgICAgICAgY2FzZSBMb29rdXBHcmlkRGlzcGxheVR5cGUuTGlzdDoge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgZmR0ID0gdGhpcy5pbnN0YW5jZS5mYXZvcml0ZXNDb21wb25lbnRSZWYuaW5zdGFuY2UgYXMgRGF0YVRhYmxlQ29tcG9uZW50O1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuaW5zdGFuY2UuZmF2b3JpdGVEYXRhRnJvbSA9PT0gJ2xvY2FsZScpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAocmVzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2xvYWRGYXZvcml0ZURhdGEocmVzLml0ZW1zKTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyB0aGlzLmluc3RhbmNlLmh0dHBNZ3IuZ2V0RmF2b3JpdGVEYXRhKGZhdklkcykuc3Vic2NyaWJlKHJlc0RhdGEgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyAgICAgaWYgKHJlc0RhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgICAgICB0aGlzLl9sb2FkRmF2b3JpdGVEYXRhKHJlc0RhdGEuaXRlbXMpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyAgICAgdGhpcy5pbnN0YW5jZS5jbG9zZUxvYWRpbmcoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBmYXZEYXRhID0gdGhpcy5nZXRGYXZvcml0RGF0YSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMubG9hZEZhdm9yaXRlRGF0YXRhYmxlKGZkdCwgcmVzID8gcmVzLml0ZW1zIDogZmF2RGF0YSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjYXNlIExvb2t1cEdyaWREaXNwbGF5VHlwZS5UcmVlTGlzdDoge1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuaW5zdGFuY2UuZmF2b3JpdGVzQ29tcG9uZW50UmVmICYmIHRoaXMuaW5zdGFuY2UuZmF2b3JpdGVzQ29tcG9uZW50UmVmLmluc3RhbmNlIGluc3RhbmNlb2YgVHJlZVRhYmxlQ29tcG9uZW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZnR0ID0gdGhpcy5pbnN0YW5jZS5mYXZvcml0ZXNDb21wb25lbnRSZWYuaW5zdGFuY2UgYXMgVHJlZVRhYmxlQ29tcG9uZW50O1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYmluZEZhdlRyZWV0YWJsZShmdHQpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5pbnN0YW5jZS5mYXZvcml0ZURhdGFGcm9tID09PSAnbG9jYWxlJykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxvYWRGYXZvcml0ZUZvclRyZWVUYWJsZShyZXMuaXRlbXMgfHwgW10sIGZ0dCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyB0aGlzLmluc3RhbmNlLmh0dHBNZ3IuZ2V0RmF2b3JpdGVEYXRhKGZhdklkcykuc3Vic2NyaWJlKHJlc0RhdGEgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgIGlmIChyZXNEYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgICAgICAgIGNvbnN0IGl0ZW1zID0gcmVzRGF0YS5pdGVtcztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgICAgICAgdGhpcy5sb2FkRmF2b3JpdGVGb3JUcmVlVGFibGUoaXRlbXMsIGZ0dCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgIHRoaXMuaW5zdGFuY2UuY2xvc2VMb2FkaW5nKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubG9hZEZhdm9yaXRlRm9yVHJlZVRhYmxlKHJlcy5pdGVtcywgZnR0KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGxvYWRGYXZvcml0ZURhdGF0YWJsZShmZHQ6IERhdGFUYWJsZUNvbXBvbmVudCwgZGF0YT86IGFueSkge1xyXG4gICAgICAgIGlmIChkYXRhICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgdGhpcy5pbnN0YW5jZS5mYXZvcml0ZUl0ZW1zID0gZGF0YTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChmZHQuY29sdW1ucyAmJiAhZmR0LmNvbHVtbnMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIGZkdC5jb2x1bW5zID0gdGhpcy5pbnN0YW5jZS5mYXZvcml0ZUNvbHVtbnM7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmZHQubG9hZERhdGEoe1xyXG4gICAgICAgICAgICB0b3RhbDogMCxcclxuICAgICAgICAgICAgcGFnZVNpemU6IDIwLFxyXG4gICAgICAgICAgICBwYWdlSW5kZXg6IDEsXHJcbiAgICAgICAgICAgIGRhdGE6IHRoaXMuaW5zdGFuY2UuZmF2b3JpdGVJdGVtc1xyXG4gICAgICAgIH0pO1xyXG5cclxuXHJcbiAgICAgICAgdGhpcy5pbnN0YW5jZS5zZWxlY3Rpb25NZ3Iuc2VsZWN0Q3VycmVudFZhbHVlKCk7XHJcbiAgICAgICAgZmR0LmNkLmRldGVjdENoYW5nZXMoKTtcclxuICAgIH1cclxuXHJcblxyXG4gICAgcHJpdmF0ZSBiaW5kRmF2VHJlZXRhYmxlKGZ0dDogVHJlZVRhYmxlQ29tcG9uZW50KSB7XHJcbiAgICAgICAgZnR0LmFsbENvbHVtbnNUaXRsZSA9IHRoaXMuaW5zdGFuY2UuYWxsQ29sdW1uc1RpdGxlO1xyXG4gICAgICAgIGZ0dC5pZEZpZWxkID0gdGhpcy5pbnN0YW5jZS5pZEZpZWxkO1xyXG5cclxuICAgICAgICBjb25zdCBjb2x1bW5zID0gdGhpcy5pbnN0YW5jZS5ncmlkT3B0aW9ucy5jb2x1bW5zLm1hcChpdGVtID0+IHtcclxuICAgICAgICAgICAgY29uc3QgcnRuOiBhbnkgPSB7IC4uLml0ZW0gfTtcclxuICAgICAgICAgICAgaWYgKGl0ZW0uZmllbGQgPT09IEZBVk9SSVRFX0ZJRUxEX05BTUUpIHtcclxuICAgICAgICAgICAgICAgIHJ0bi5mb3JtYXR0ZXIgPSAodjogYW55LCBkYXRhOiBhbnkpOiBhbnkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGZhdmlkcyA9IHRoaXMuZ2V0RmF2b3JpdElkcygpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChmYXZpZHMgJiYgZmF2aWRzLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBpbmRleCA9IGZhdmlkcy5maW5kSW5kZXgoZWwgPT4gZWwgPT09IGRhdGFbdGhpcy5pbnN0YW5jZS5pZEZpZWxkXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpbmRleCA+PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gRmF2b3JpdGVJY29uLmRlbGV0ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gJyc7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBydG47XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgdGhpcy5pbnN0YW5jZS5pbml0Q29sdW1uV2lkdGgoY29sdW1ucywgJ2ZhdicpO1xyXG4gICAgICAgIHRoaXMuaW5zdGFuY2UuZmF2b3JpdGVDb2x1bW5zID0gY29sdW1ucztcclxuICAgICAgICBmdHQuY29sdW1ucyA9IGNvbHVtbnM7XHJcblxyXG5cclxuICAgICAgICBpZiAodGhpcy5pbnN0YW5jZS5ncmlkT3B0aW9ucy50cmVlSW5mbykge1xyXG4gICAgICAgICAgICBmdHQub25seVNlbGVjdExlYWYgPSB0aGlzLmluc3RhbmNlLmdyaWRPcHRpb25zLnRyZWVJbmZvLm9ubHlTZWxlY3RMZWFmO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKCFmdHQuc2luZ2xlU2VsZWN0KSB7XHJcbiAgICAgICAgICAgIGZ0dC5jaGVja09uU2VsZWN0ID0gdHJ1ZTtcclxuICAgICAgICAgICAgZnR0LnNlbGVjdE9uQ2hlY2sgPSB0cnVlO1xyXG4gICAgICAgICAgICBmdHQuc2hvd0NoZWNrYm94ID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgICAgIC8vIOWQr+eUqOWkmumAieWQju+8jOWQjOaXtuWQr+eUqOe6p+iBlOmAieaLqVxyXG4gICAgICAgICAgICBpZiAodGhpcy5pbnN0YW5jZS5lbmFibGVDYXNjYWRlKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmluc3RhbmNlLnR0RXZlbnRNZ3IuY2FzY2FkZVZhbHVlQ2hhbmdlZCh0aGlzLmluc3RhbmNlLmNhc2NhZGVTdGF0dXMpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgZnR0LmNhc2NhZGVDaGVjayA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgZnR0LmNhc2NhZGVEb3duID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICBmdHQuY2FzY2FkZVVwID0gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBjaGVja05vZGVJc0xlYWYobm9kZXM6IGFueSApIHtcclxuICAgICAgICBpZiAobm9kZXMgJiYgbm9kZXMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBub2Rlcy5tYXAoKG5vZGU6IFRyZWVOb2RlKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAobm9kZS5oYXNPd25Qcm9wZXJ0eShcImFkZHRpb25hbFwiKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIG5vZGUuc2VsZWN0YWJsZSA9ICFub2RlW1wiYWRkdGlvbmFsXCJdO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgXHJcbiAgICAgICAgICAgICAgICBpZiAobm9kZS5jaGlsZHJlbiAmJiBub2RlLmNoaWxkcmVuLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2hlY2tOb2RlSXNMZWFmKG5vZGUuY2hpbGRyZW4pO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBub2RlLmxlYWYgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbm9kZTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBub2RlcztcclxuICAgIH1cclxuXHJcbiAgICBpbml0RmF2b3JpdGVUcmVlRGF0YShpdGVtcykge1xyXG4gICAgICAgIGNvbnN0IHRyZWVJbmZvID0gdGhpcy5pbnN0YW5jZS5ncmlkT3B0aW9ucy50cmVlSW5mbztcclxuXHJcbiAgICAgICAgaWYgKHRyZWVJbmZvICYmICF0cmVlSW5mb1sndHJlZURhdGFJc0luaXQnXSkge1xyXG4gICAgICAgICAgICBpZiAodHJlZUluZm8ubGF5ZXJUeXBlLnRvTG93ZXJDYXNlKCkgPT09ICdwYXRoY29kZScpIHtcclxuICAgICAgICAgICAgICAgIGl0ZW1zID0gdGhpcy5pbnN0YW5jZS5sb29rdXBVdGlscy5tYWtlVHJlZShpdGVtcywgdHJlZUluZm8pO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgaXRlbXMgPSB0aGlzLmluc3RhbmNlLmxvb2t1cFV0aWxzLm1ha2VUcmVlV2l0aFBhcmVudElEKFxyXG4gICAgICAgICAgICAgICAgICAgIGl0ZW1zLFxyXG4gICAgICAgICAgICAgICAgICAgICcnLFxyXG4gICAgICAgICAgICAgICAgICAgIHRyZWVJbmZvLmRhdGFGaWVsZCA/IGAke3RyZWVJbmZvLmRhdGFGaWVsZH0uJHt0cmVlSW5mby5wYXJlbnRGaWVsZH1gOiB0cmVlSW5mby5wYXJlbnRGaWVsZCxcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmluc3RhbmNlLmlkRmllbGRcclxuICAgICAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIHJldHVybiB0aGlzLmluc3RhbmNlLmNoZWNrTm9kZUNhbkJlU2VsZWN0KGl0ZW1zLCB0cnVlKTtcclxuICAgICAgICByZXR1cm4gdGhpcy5jaGVja05vZGVJc0xlYWYoaXRlbXMpO1xyXG4gICAgfVxyXG5cclxuICAgIGxvYWRGYXZvcml0ZUZvclRyZWVUYWJsZShpdGVtcywgZnR0OiBhbnkpIHtcclxuICAgICAgICBpdGVtcyA9IHRoaXMuaW5pdEZhdm9yaXRlVHJlZURhdGEoaXRlbXMpO1xyXG4gICAgICAgIHRoaXMuaW5zdGFuY2UuZmF2b3JpdGVJdGVtcyA9IGl0ZW1zO1xyXG4gICAgICAgIGZ0dC5sb2FkRGF0YShpdGVtcyk7XHJcbiAgICAgICAgZnR0LmV4cGFuZEFsbCgpO1xyXG4gICAgICAgIHRoaXMuaW5zdGFuY2Uuc2VsZWN0aW9uTWdyLnNlbGVjdEN1cnJlbnRWYWx1ZSgpO1xyXG5cclxuICAgICAgICByZXR1cm4gaXRlbXM7XHJcbiAgICB9XHJcblxyXG4gICAgLy8g5pu05paw5YiX6KGo5Lit55qE5pS26JeP5pWw5o2u5qCH6K+GXHJcbiAgICB1cGRhdGVGYXZvcml0ZXNTdGF0dXMoZGF0YTogYW55W10pIHtcclxuXHJcbiAgICAgICAgaWYgKCFkYXRhIHx8ICF0aGlzLmluc3RhbmNlLnVzZUZhdm9yaXRlKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IGZhdklkcyA9IHRoaXMuZ2V0RmF2b3JpdElkcygpO1xyXG5cclxuICAgICAgICBpZiAoZmF2SWRzICYmIGZhdklkcy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgLy8g5aSE55CG5pWw5o2u5YiX6KGo5Lit55qE5pS26JeP5pWw5o2u5qCH6K+GXHJcbiAgICAgICAgICAgIGlmICh0aGlzLmluc3RhbmNlLmRpc3BsYXlUeXBlICE9PSBMb29rdXBHcmlkRGlzcGxheVR5cGUuVHJlZUxpc3QpIHtcclxuICAgICAgICAgICAgICAgIGRhdGEubWFwKGl0ZW0gPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChmYXZJZHMgJiYgZmF2SWRzLmxlbmd0aCAmJiBmYXZJZHMuZmluZCh2ID0+IHYgPT09IGl0ZW1bdGhpcy5pbnN0YW5jZS5pZEZpZWxkXSkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaXRlbVtGQVZPUklURV9GSUVMRF9OQU1FXSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBfdGhpcyA9IHRoaXMuaW5zdGFuY2U7XHJcbiAgICAgICAgICAgICAgICAoZnVuY3Rpb24gZWFjaChfZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgIF9kYXRhLmZvckVhY2goaXRlbSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmYXZJZHMgJiYgZmF2SWRzLmxlbmd0aCAmJiBmYXZJZHMuZmluZCh2ID0+IHYgPT09IGl0ZW0uZGF0YVtfdGhpcy5pZEZpZWxkXSkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0uZGF0YVtGQVZPUklURV9GSUVMRF9OQU1FXSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW0uY2hpbGRyZW4gJiYgaXRlbS5jaGlsZHJlbi5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlYWNoKGl0ZW0uY2hpbGRyZW4pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9KShkYXRhKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcblxyXG4gICAgcHJpdmF0ZSBfdXBkYXRlRmF2b3JpdGVzKHZhbHVlOiBhbnksIGFjdGlvbiwgZGF0YSkge1xyXG4gICAgICAgIGNvbnN0IGxvY2FsZUlEID0gdGhpcy5pbnN0YW5jZS5sb2NhbFNlcnZpY2UubG9jYWxlSWQ7XHJcbiAgICAgICAgdGhpcy5pbnN0YW5jZS5wZXJzb25hbENvbmYuZmF2b3JpdGUgPSB0aGlzLmluc3RhbmNlLnBlcnNvbmFsQ29uZi5mYXZvcml0ZSB8fCB7fTtcclxuICAgICAgICBjb25zdCBpdGVtcyA9IHZhbHVlLmZpbHRlcihuID0+ICFuWydfYWRkdGlvbmFsXyddKTtcclxuICAgICAgICBjb25zdCBuZXdWYWwgPSBpdGVtcy5tYXAobiA9PiBuW3RoaXMuaW5zdGFuY2UuaWRGaWVsZF0pLmZpbHRlcihuID0+IG4gIT09IG51bGwgJiYgbiAhPT0gdW5kZWZpbmVkKTtcclxuXHJcbiAgICAgICAgY29uc3QgZmF2SXRlbXMgPSB0aGlzLmluc3RhbmNlLnBlcnNvbmFsQ29uZi5mYXZvcml0ZVtsb2NhbGVJRF0gfHwgW107XHJcbiAgICAgICAgdGhpcy5pbnN0YW5jZS5wZXJzb25hbENvbmYuZmF2b3JpdGVbbG9jYWxlSURdID0gQXJyYXkuZnJvbShuZXcgU2V0KFsuLi5mYXZJdGVtcyAsIC4uLm5ld1ZhbF0pKTtcclxuXHJcbiAgICAgICAgaWYgKGFjdGlvbiA9PT0gRmF2b3JpdGVBY3Rpb24uZGVsZXRlICYmIGRhdGEpIHtcclxuICAgICAgICAgICAgdGhpcy5pbnN0YW5jZS5wZXJzb25hbENvbmYuZmF2b3JpdGVbbG9jYWxlSURdID0gdGhpcy5pbnN0YW5jZS5wZXJzb25hbENvbmYuZmF2b3JpdGVbbG9jYWxlSURdLmZpbHRlcihuID0+IG4gIT09IGRhdGFbdGhpcy5pbnN0YW5jZS5pZEZpZWxkXSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gdGhpcy5pbnN0YW5jZS5wZXJzb25hbENvbmYuZmF2b3JpdGVbbG9jYWxlSURdO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIOaUtuiXj+aVsOaNrueuoeeQhlxyXG4gICAgcHJpdmF0ZSBsaXN0ZW5QZXJzb25hbENvbmZpZ0hhbmRsZXIoKSB7XHJcbiAgICAgICAgdGhpcy5sb29rdXBTZWxlY3Rpb25TZXIuZmF2b3JpdGVJdGVtcyQuc3Vic2NyaWJlKG4gPT4ge1xyXG4gICAgICAgICAgICBpZiAoIXRoaXMuaW5zdGFuY2UuZmF2b3JpdGVzQ29tcG9uZW50UmVmKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGNvbnN0IHsgaXRlbXMsIGFjdGlvbiwgZGF0YSB9ID0gbjtcclxuICAgICAgICAgICAgY29uc3QgZmF2aWRzID0gdGhpcy5fdXBkYXRlRmF2b3JpdGVzKGl0ZW1zLCBhY3Rpb24sIGRhdGEpO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5pbnN0YW5jZS5odHRwTWdyLnN1Ym1pdEZhdm9yaXRlRGF0YShhY3Rpb24pO1xyXG5cclxuICAgICAgICAgICAgaWYgKHRoaXMuaW5zdGFuY2UuZGlzcGxheVR5cGUgPT09IExvb2t1cEdyaWREaXNwbGF5VHlwZS5MaXN0IHx8IHRoaXMuaW5zdGFuY2UuZGlzcGxheVR5cGUuaW5jbHVkZXMoJ05BVicpKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBkdCA9IHRoaXMuaW5zdGFuY2UuZmF2b3JpdGVzQ29tcG9uZW50UmVmLmluc3RhbmNlIGFzIERhdGFUYWJsZUNvbXBvbmVudDtcclxuICAgICAgICAgICAgICAgIHRoaXMubG9hZEZhdm9yaXRlRGF0YXRhYmxlKGR0LCBpdGVtcyk7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5pbnN0YW5jZS5kaXNwbGF5VHlwZSA9PT0gTG9va3VwR3JpZERpc3BsYXlUeXBlLlRyZWVMaXN0KSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBmdHQgPSB0aGlzLmluc3RhbmNlLmZhdm9yaXRlc0NvbXBvbmVudFJlZi5pbnN0YW5jZSBhcyBUcmVlVGFibGVDb21wb25lbnQ7XHJcbiAgICAgICAgICAgICAgICAvLyBjb25zdCBmYXZpZHMgPSBpdGVtcy5tYXAoZCA9PiBkLmlkKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuaW5zdGFuY2Uuc2hvd0xvYWRpbmcoKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuaW5zdGFuY2UuaHR0cE1nci5nZXREYXRhKHsgZmF2b3JpdGVJZHM6IGZhdmlkcyB9LCAnZmF2Jykuc3Vic2NyaWJlKHJlc0RhdGEgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXNEYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IF9pdGVtcyA9IHJlc0RhdGEuaXRlbXM7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubG9hZEZhdm9yaXRlRm9yVHJlZVRhYmxlKF9pdGVtcywgZnR0KTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmluc3RhbmNlLmZhdm9yaXRlSXRlbXMgPSBbXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZnR0LmxvYWREYXRhKFtdKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnN0YW5jZS5jbG9zZUxvYWRpbmcoKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG59XHJcbiJdfQ==
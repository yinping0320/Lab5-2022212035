/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { of } from 'rxjs';
import { debounceTime, switchMap } from 'rxjs/operators';
import { LookupGridDisplayType } from '../lookup-displaytype';
import { LookupLeftComponent } from '../lookup-left.component';
var LookupComponentManager = /** @class */ (function () {
    function LookupComponentManager(ins) {
        this.ins = ins;
    }
    /**
     * @param {?=} type
     * @return {?}
     */
    LookupComponentManager.prototype.getComponentInstance = /**
     * @param {?=} type
     * @return {?}
     */
    function (type) {
        if (type === void 0) { type = 'datatable'; }
        if (!this.ins.componentRef || !this.ins.componentRef.instance) {
            return null;
        }
        if (type === 'selected') {
            return this.ins.selectedDtRef;
        }
        /** @type {?} */
        var ins = this.ins.componentRef.instance;
        if (type === 'leftDataTable' || type === 'leftTree') {
            /** @type {?} */
            var leftRef = this.ins.leftComponentRef;
            if (!leftRef || !leftRef.instance || !leftRef.instance.cmpRef || !leftRef.instance.cmpRef.instance) {
                return null;
            }
            ins = this.ins.leftComponentRef.instance.cmpRef.instance;
        }
        if (type === 'fav') {
            ins = this.ins.favoritesComponentRef.instance;
        }
        switch (type) {
            case 'leftDataTable':
            case 'fav':
            case 'datatable':
                return (/** @type {?} */ (ins));
            case 'leftTree':
            case 'treetable':
                return (/** @type {?} */ (ins));
            default:
                if (this.ins.isTree()) {
                    return (/** @type {?} */ (ins));
                }
                return (/** @type {?} */ (ins));
        }
    };
    /**
     * @param {?} data
     * @return {?}
     */
    LookupComponentManager.prototype.createComponentWithServerData = /**
     * @param {?} data
     * @return {?}
     */
    function (data) {
        if (this.ins.componentRef) {
            return;
        }
        this.ins.idField = data.idField || this.ins.idField;
        this.ins.textField = data.textField || this.ins.textField;
        this.ins.valueField = data.valueField || this.ins.valueField;
        this.ins.displayType = (data && data.displayType) || this.ins.displayType || 'LIST';
        /** @type {?} */
        var dtyp = this.ins.displayType.toUpperCase();
        if (this.ins.isDoublleList()) {
            if (this.ins.navTreeToList && dtyp === LookupGridDisplayType.NavTreeList) {
                this.ins.displayType = LookupGridDisplayType.NavList;
            }
            if (this.ins.treeToList) {
                if (dtyp === LookupGridDisplayType.NavListTree) {
                    this.ins.displayType = LookupGridDisplayType.NavList;
                }
            }
        }
        else {
            if (this.ins.treeToList) {
                if (dtyp === LookupGridDisplayType.TreeList) {
                    this.ins.displayType = 'LIST';
                }
                else {
                    if (dtyp === LookupGridDisplayType.NavListTree) {
                        this.ins.displayType = LookupGridDisplayType.NavList;
                    }
                }
            }
        }
        if (this.ins.isDoublleList() && this.ins.navTreeToList) {
            if (dtyp === LookupGridDisplayType.NavTreeList) {
                this.ins.displayType = LookupGridDisplayType.NavList;
            }
        }
        this.ins.changeDetector.detectChanges();
        this.ins.componentRef = this.createContent(this.ins.gridOptions);
        this.createFavoriteComponent();
        this.resizeComponent();
    };
    /**
     * @return {?}
     */
    LookupComponentManager.prototype.createFavoriteComponent = /**
     * @return {?}
     */
    function () {
        if (this.ins.useFavorite && !this.ins.favoritesComponentRef) {
            this.ins.favoriteColumns = this.ins.favHelper.getFavoriteColumns();
            /** @type {?} */
            var favoritesOptions = Object.assign({}, this.ins.gridOptions, {
                showFilterBar: false,
                pagination: false,
                columns: this.ins.favoriteColumns || []
            });
            this.ins.favoritesComponentRef = this.createFavoritesContent(favoritesOptions);
            this.resizeComponent('fav');
        }
    };
    /**
     * @private
     * @param {?} expandLevel
     * @return {?}
     */
    LookupComponentManager.prototype.reloadTreeDataForExpand = /**
     * @private
     * @param {?} expandLevel
     * @return {?}
     */
    function (expandLevel) {
        var _this = this;
        /** @type {?} */
        var uri = this.ins.gridOptions.uri;
        /** @type {?} */
        var tt = (/** @type {?} */ (this.ins.componentRef.instance));
        var _a = tslib_1.__assign({}, tt.searchData), _b = _a.field, field = _b === void 0 ? '*' : _b, _c = _a.value, value = _c === void 0 ? '' : _c;
        /** @type {?} */
        var search = { category: 'all', searchValue: value, searchField: field, layerNum: expandLevel };
        /** @type {?} */
        var param = {
            searchValue: JSON.stringify(search),
            customData: this.ins.customData,
            enableFullTree: this.ins.enableFullTree,
            loadTreeDataType: this.ins.loadTreeDataType
        };
        if (this.ins.helpId) {
            param['helpId'] = this.ins.helpId;
        }
        if (tt && tt.sortName) {
            Object.assign(param, {
                sortName: tt.sortName,
                sortOrder: tt.sortOrder
            });
        }
        this.ins.showLoading();
        return this.ins.http.getData(uri, param).subscribe((/**
         * @param {?} data
         * @return {?}
         */
        function (data) {
            _this.ins.closeLoading();
            /** @type {?} */
            var nodes = _this.ins.checkNodeCanBeSelect(data.items, expandLevel === -1);
            _this.ins.items = nodes;
            tt.loadData(nodes);
            tt.psRef.directiveRef.scrollToTop(0);
        }));
    };
    /**
     * @private
     * @param {?} nodes
     * @param {?} level
     * @return {?}
     */
    LookupComponentManager.prototype.setTreeNodeExpandBy = /**
     * @private
     * @param {?} nodes
     * @param {?} level
     * @return {?}
     */
    function (nodes, level) {
        var _this = this;
        if (!nodes || !nodes.length) {
            return;
        }
        nodes.forEach((/**
         * @param {?} n
         * @return {?}
         */
        function (n) {
            /** @type {?} */
            var layer = n.data[_this.ins.treeInfo.dataField].layer;
            /** @type {?} */
            var expandLayer = layer + level - 1;
            n.expanded = layer <= expandLayer ? true : n.expanded;
            if (n.children && n.children.length && layer + 1 <= expandLayer) {
                _this.setTreeNodeExpandBy(n.children, level);
            }
        }));
    };
    // 启用树帮助右键菜单功能
    // 启用树帮助右键菜单功能
    /**
     * @private
     * @param {?} cmpRef
     * @return {?}
     */
    LookupComponentManager.prototype.useContextMenuForTree = 
    // 启用树帮助右键菜单功能
    /**
     * @private
     * @param {?} cmpRef
     * @return {?}
     */
    function (cmpRef) {
        var _this = this;
        var _a = this.ins.treeTableOptions, maxLevel = _a.maxLevel, enableContextMenu = _a.enableContextMenu, language = _a.language;
        if (enableContextMenu && maxLevel) {
            /** @type {?} */
            var levelMenus = [];
            for (var i = 1; i <= maxLevel; i++) {
                /** @type {?} */
                var title = language['expand' + i];
                levelMenus.push({ id: 30 + 1, code: i, title: title, handle: (/**
                     * @param {?} t
                     * @return {?}
                     */
                    function (t) {
                        // 发送请求获取数据
                        /** @type {?} */
                        var level = t.menu.code;
                        if (isLoadAllTreeData_1()) {
                            _this.setTreeNodeExpandBy(_this.ins.items, level);
                            cmpRef.instance.updateSerializedValue();
                        }
                        else {
                            var _a = _this.ins.treeInfo, dataField = _a.dataField, layerField = _a.layerField;
                            /** @type {?} */
                            var firstNodeData = (_this.ins.items || [])[0];
                            if (firstNodeData && firstNodeData.data) {
                                /** @type {?} */
                                var minLayer = _this.ins.utils.getValue(dataField + "." + layerField, firstNodeData.data);
                                /** @type {?} */
                                var _level = minLayer + level - 1;
                                _this.reloadTreeDataForExpand(_level);
                            }
                        }
                    }) });
            }
            /** @type {?} */
            var isLoadAllTreeData_1 = (/**
             * @return {?}
             */
            function () {
                if (_this.ins.loadTreeDataType === 'default') {
                    return cmpRef.instance.loadDataType === 'all';
                }
                else {
                    return _this.ins.loadTreeDataType === 'loadall';
                }
            });
            /** @type {?} */
            var contextMenus = [
                {
                    id: 6, code: 'checkchildnodes', title: '勾选下级数据',
                    visible: (/**
                     * @param {?} e
                     * @return {?}
                     */
                    function (e) {
                        // console.log(e);
                        return !e.data.node.selectable && !_this.ins.singleSelect && e.data.node.children && e.data.node.children.length;
                    }),
                    handle: (/**
                     * @param {?} t
                     * @return {?}
                     */
                    function (t) {
                        if (cmpRef) {
                            /** @type {?} */
                            var nodeIds = cmpRef.instance.getChildNodes(t.data.id).filter((/**
                             * @param {?} n
                             * @return {?}
                             */
                            function (n) { return n.selectable; })).map((/**
                             * @param {?} n
                             * @return {?}
                             */
                            function (n) { return n[_this.ins.idField]; }));
                            // const nodeIds = t.data.node.children.map(n => n[this.ins.idField]);
                            cmpRef.instance.checkedNodes(nodeIds);
                            cmpRef.instance.selectNodes(nodeIds);
                        }
                    })
                },
                {
                    id: 5, code: 'uncheckchildnodes', title: '取消勾选下级数据',
                    visible: (/**
                     * @param {?} e
                     * @return {?}
                     */
                    function (e) {
                        // console.log(e);
                        return !e.data.node.selectable && !_this.ins.singleSelect && e.data.node.children && e.data.node.children.length;
                    }),
                    handle: (/**
                     * @param {?} t
                     * @return {?}
                     */
                    function (t) {
                        if (cmpRef) {
                            // const nodeIds = t.data.node.children.map(n => n[this.ins.idField]);
                            /** @type {?} */
                            var nodeIds = cmpRef.instance.getChildNodes(t.data.id).filter((/**
                             * @param {?} n
                             * @return {?}
                             */
                            function (n) { return n.selectable; })).map((/**
                             * @param {?} n
                             * @return {?}
                             */
                            function (n) { return n[_this.ins.idField]; }));
                            cmpRef.instance.unCheckedNodes(nodeIds);
                            cmpRef.instance.unSelectNodes(nodeIds);
                        }
                    })
                },
                '-',
                {
                    id: 1, code: 'expandall', title: language.expandall, handle: (/**
                     * @param {?} t
                     * @return {?}
                     */
                    function (t) {
                        if (cmpRef && isLoadAllTreeData_1()) {
                            cmpRef.instance.expandAll();
                        }
                        else {
                            // 发送请求获取数据
                            _this.reloadTreeDataForExpand(-1);
                        }
                    })
                },
                { id: 2, code: 'collapseall', title: language.collapseall, handle: (/**
                     * @param {?} t
                     * @return {?}
                     */
                    function (t) {
                        if (cmpRef) {
                            cmpRef.instance.collapseAll();
                        }
                    }) },
                '-',
                {
                    id: 3, title: language.expandByLayer,
                    children: levelMenus
                }
            ];
            this.ins.treeTableOptions.contextMenuItems = contextMenus;
            cmpRef.instance.beforeShowContextMenu = (/**
             * @return {?}
             */
            function () {
                return of({ show: !cmpRef.instance.state.searched });
            });
        }
    };
    /**
     * @param {?=} isFav
     * @return {?}
     */
    LookupComponentManager.prototype.getCmpHeight = /**
     * @param {?=} isFav
     * @return {?}
     */
    function (isFav) {
        if (isFav === void 0) { isFav = false; }
        return this.ins.dialogMgr.getHeight() - (isFav ? 10 : this.ins.getFilterBarHeight());
    };
    /**
     * @param {?} opts
     * @return {?}
     */
    LookupComponentManager.prototype.createContent = /**
     * @param {?} opts
     * @return {?}
     */
    function (opts) {
        if (this.ins.componentRef) {
            return;
        }
        /** @type {?} */
        var type = this.ins.getComponentType();
        /** @type {?} */
        var cmpFac = this.ins.cfr.resolveComponentFactory(type);
        /** @type {?} */
        var cmpRef = null;
        if (this.ins.isDoublleList()) {
            cmpRef = this.ins.centerContainer.createComponent(cmpFac);
        }
        else {
            cmpRef = this.ins.contentContainer.createComponent(cmpFac);
        }
        if (this.ins.isTree()) {
            opts.fit = true;
            opts.pagination = false;
            opts.fast = true;
            opts.fitColumns = false;
            this.useContextMenuForTree(cmpRef);
        }
        else {
            opts.fill = true;
        }
        opts.autoFitColumns = true;
        /** @type {?} */
        var ttOpts = this.ins.treeTableOptions || {};
        Object.assign(cmpRef.instance, opts, tslib_1.__assign({ allColumnsTitle: this.ins.allColumnsTitle }, ttOpts));
        this.ins.componentRef = cmpRef;
        this.resizeComponent();
        return cmpRef;
    };
    // 创建收藏CMP
    // 创建收藏CMP
    /**
     * @param {?} opts
     * @return {?}
     */
    LookupComponentManager.prototype.createFavoritesContent = 
    // 创建收藏CMP
    /**
     * @param {?} opts
     * @return {?}
     */
    function (opts) {
        /** @type {?} */
        var type = this.ins.getComponentType();
        /** @type {?} */
        var cmpFac = this.ins.cfr.resolveComponentFactory(type);
        /** @type {?} */
        var cmpRef = null;
        cmpRef = this.ins.favoritesContainer.createComponent(cmpFac);
        if (this.ins.isTree()) {
            opts.fit = true;
            opts.pagination = false;
        }
        else {
            opts.fill = true;
        }
        opts.autoFitColumns = true;
        Object.assign(cmpRef.instance, opts, {
            width: this.ins.dialog.size.width - this.ins.getSpaceWidth(),
            height: this.ins.dialogMgr.getHeight()
        });
        // 订阅收藏夹列表中组件的相关事件
        this.ins.favHelper.initFavoriteComponentEvent(cmpRef);
        return cmpRef;
    };
    /**
     * @param {?=} type
     * @return {?}
     */
    LookupComponentManager.prototype.resizeComponent = /**
     * @param {?=} type
     * @return {?}
     */
    function (type) {
        if (type === void 0) { type = 'datatable'; }
        /** @type {?} */
        var size = {
            width: this.ins.dialog.size.width - this.ins.getSpaceWidth(),
            height: this.getCmpHeight(type == 'fav')
        };
        if (this.ins.isDoublleList() && (type === 'datatable' || type === 'treetable')) {
            size.width = this.ins.dialog.size.width - this.ins.leftPanelWidth - this.ins.getSpaceWidth(true);
        }
        this.getComponentInstance(type).resize(size);
    };
    /**
     * @private
     * @param {?} node
     * @return {?}
     */
    LookupComponentManager.prototype.getChildNodes = /**
     * @private
     * @param {?} node
     * @return {?}
     */
    function (node) {
        var _this = this;
        /** @type {?} */
        var nodes = [];
        if (node.selectable || node.selectable === undefined) {
            nodes.push(node);
        }
        if (node.children && node.children.length) {
            node.children.forEach((/**
             * @param {?} n
             * @return {?}
             */
            function (n) {
                nodes.push.apply(nodes, tslib_1.__spread(_this.getChildNodes(n)));
            }));
        }
        return nodes;
    };
    /** 创建左侧组件 */
    /**
     * 创建左侧组件
     * @param {?} ops
     * @return {?}
     */
    LookupComponentManager.prototype.createLeftComponent = /**
     * 创建左侧组件
     * @param {?} ops
     * @return {?}
     */
    function (ops) {
        var _this = this;
        /** @type {?} */
        var dtFac = null;
        if (this.ins.isDoublleList()) {
            dtFac = this.ins.cfr.resolveComponentFactory(LookupLeftComponent);
        }
        this.ins.leftComponentRef = this.ins.leftContainer.createComponent(dtFac);
        ops.height = this.ins.dialogMgr.getHeight();
        if (this.ins.dialogWidth < this.ins.navLookupDialogMinWidth) {
            this.ins.dialogWidth = this.ins.navLookupDialogMinWidth;
            this.ins.dialog.reSize({ width: this.ins.dialogWidth });
            this.ins.resizeCmp({ width: this.ins.dialog.size.width });
        }
        if (ops.width !== this.ins.leftPanel.width) {
            // 默认 1 : 2
            this.ins.leftPanel.resize({
                width: this.ins.leftPanel.width,
                height: ops.height
            });
            this.ins.resizeCmp({ width: this.ins.dialog.size.width });
        }
        // this.resizeComponent();
        this.ins.leftComponentRef.instance.lookupCmp = this.ins;
        this.ins.leftComponentRef.instance.navOptions = ops;
        this.ins.leftComponentRef.instance.selected
            .pipe(debounceTime(100), switchMap((/**
         * @param {?} d
         * @return {?}
         */
        function (d) {
            if (d && d.data) {
                _this.ins.navigationFilter = {
                    selected: d.data,
                    idValue: _this.getNavigationFilter(d.data),
                    searchField: '',
                    searchValue: ''
                };
            }
            else {
                _this.ins.navigationFilter = undefined;
            }
            // 加载右侧数据
            /** @type {?} */
            var p = {
                pageInfo: {
                    pageIndex: 1,
                    // tfs 638840
                    pageSize: _this.ins.gridOptions.pageSize
                }
            };
            if (_this.ins.includeSubordinates && d && d.node && ops.treeInfo) {
                var _a = ops.treeInfo, layerType = _a.layerType, pathField = _a.pathField, loadDataType = _a.loadDataType, dataField = _a.dataField;
                if (loadDataType === 'all') {
                    /** @type {?} */
                    var rowDatas = _this.getChildNodes(d.node).map((/**
                     * @param {?} n
                     * @return {?}
                     */
                    function (n) { return n.data; }));
                    _this.ins.navigationFilter.idValue = _this.getNavigationFilter(rowDatas);
                }
                else {
                    if (layerType == 'pathcode') {
                        // p['navNodePathCode'] = d.data[dataField][pathField];
                        p['navNodePathCode'] = _this.ins.getPathCode(d.data, ops.treeInfo);
                        _this.ins['navNodePathCode'] = p['navNodePathCode'];
                    }
                }
            }
            else {
                _this.ins['navNodePathCode'] = '';
            }
            /** @type {?} */
            var dataCmpRef = _this.getComponentInstance();
            var sortName = dataCmpRef.sortName, sortOrder = dataCmpRef.sortOrder;
            Object.assign(p, { search: _this.ins._searchState, sortName: sortName, sortOrder: sortOrder });
            return _this.ins.httpMgr.getData(p, 'list');
        })))
            .subscribe((/**
         * @param {?} res
         * @return {?}
         */
        function (res) {
            _this.ins.closeLoading();
            _this.ins.loadDataWhenOpen = true;
            // if (this.ins.useFavorite && !this.ins.isTree()) {
            //     this.ins.favHelper.updateFavoritesStatus(res.items);
            // }
            // this.ins.loadDataTableData(res);
            _this.ins.loadData(res, false);
            setTimeout((/**
             * @return {?}
             */
            function () {
                // 选中数据
                _this.ins.selectionMgr.selectCurrentValue();
                _this.ins.changeDetector.detectChanges();
            }));
        }));
        return this.ins.leftComponentRef.instance.createComponent();
    };
    // 获取关联数据, 右侧数据中 关联各字段的值
    // 获取关联数据, 右侧数据中 关联各字段的值
    /**
     * @private
     * @param {?} navRow
     * @return {?}
     */
    LookupComponentManager.prototype.getNavigationFilter = 
    // 获取关联数据, 右侧数据中 关联各字段的值
    /**
     * @private
     * @param {?} navRow
     * @return {?}
     */
    function (navRow) {
        if (this.ins.navigationOptions.relations && this.ins.navigationOptions.relations.length) {
            /** @type {?} */
            var result_1 = [];
            this.ins.navigationOptions.relations.forEach((/**
             * @param {?} r
             * @return {?}
             */
            function (r) {
                /** @type {?} */
                var k = r.groupField;
                /** @type {?} */
                var dField = r.helpField;
                /** @type {?} */
                var rf = { fieldName: dField, fieldValue: '' };
                if (Array.isArray(navRow)) {
                    /** @type {?} */
                    var vals = navRow.map((/**
                     * @param {?} n
                     * @return {?}
                     */
                    function (n) {
                        return k.split('.').reduce((/**
                         * @param {?} o
                         * @param {?} c
                         * @return {?}
                         */
                        function (o, c) {
                            return o[c];
                        }), n);
                    }));
                    rf.fieldValue = vals.join(',');
                }
                else {
                    rf.fieldValue = k.split('.').reduce((/**
                     * @param {?} o
                     * @param {?} c
                     * @return {?}
                     */
                    function (o, c) {
                        return o[c];
                    }), navRow);
                }
                result_1.push(rf);
            }));
            return result_1;
        }
        return '';
    };
    return LookupComponentManager;
}());
export { LookupComponentManager };
if (false) {
    /**
     * @type {?}
     * @private
     */
    LookupComponentManager.prototype.ins;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibG9va3VwLWNvbXBvbmVudC5tYW5hZ2VyLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy91aS1sb29rdXAvIiwic291cmNlcyI6WyJsaWIvc2VydmljZXMvbG9va3VwLWNvbXBvbmVudC5tYW5hZ2VyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBR0EsT0FBTyxFQUFFLEVBQUUsRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUMxQixPQUFPLEVBQUUsWUFBWSxFQUFFLFNBQVMsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ3pELE9BQU8sRUFBeUIscUJBQXFCLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQUVyRixPQUFPLEVBQUUsbUJBQW1CLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQztBQUcvRDtJQUNJLGdDQUFvQixHQUF3QjtRQUF4QixRQUFHLEdBQUgsR0FBRyxDQUFxQjtJQUFHLENBQUM7Ozs7O0lBRWhELHFEQUFvQjs7OztJQUFwQixVQUFxQixJQUF5QztRQUF6QyxxQkFBQSxFQUFBLGtCQUF5QztRQUMxRCxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxZQUFZLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLFlBQVksQ0FBQyxRQUFRLEVBQUU7WUFDM0QsT0FBTyxJQUFJLENBQUM7U0FDZjtRQUVELElBQUksSUFBSSxLQUFLLFVBQVUsRUFBRTtZQUNyQixPQUFPLElBQUksQ0FBQyxHQUFHLENBQUMsYUFBYSxDQUFDO1NBQ2pDOztZQUVHLEdBQUcsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLFlBQVksQ0FBQyxRQUFRO1FBRXhDLElBQUksSUFBSSxLQUFLLGVBQWUsSUFBSSxJQUFJLEtBQUssVUFBVSxFQUFFOztnQkFDM0MsT0FBTyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsZ0JBQWdCO1lBQ3pDLElBQUksQ0FBQyxPQUFPLElBQUksQ0FBQyxPQUFPLENBQUMsUUFBUSxJQUFJLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxNQUFN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QUFBRCxDQUFDLEFBOWRELElBOGRDOzs7Ozs7O0lBN2RlLHFDQUFnQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudFJlZiB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBEYXRhVGFibGVDb21wb25lbnQgfSBmcm9tICdAZmFycmlzL3VpLWRhdGF0YWJsZSc7XHJcbmltcG9ydCB7IFRyZWVOb2RlLCBUcmVlVGFibGVDb21wb25lbnQgfSBmcm9tICdAZmFycmlzL3VpLXRyZWV0YWJsZSc7XHJcbmltcG9ydCB7IG9mIH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7IGRlYm91bmNlVGltZSwgc3dpdGNoTWFwIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xyXG5pbXBvcnQgeyBDb21wb25lbnRJbnN0YW5jZVR5cGUsIExvb2t1cEdyaWREaXNwbGF5VHlwZSB9IGZyb20gJy4uL2xvb2t1cC1kaXNwbGF5dHlwZSc7XHJcbmltcG9ydCB7IExvb2t1cEdyaWRDb21wb25lbnQgfSBmcm9tICcuLi9sb29rdXAtZ3JpZC5jb21wb25lbnQnO1xyXG5pbXBvcnQgeyBMb29rdXBMZWZ0Q29tcG9uZW50IH0gZnJvbSAnLi4vbG9va3VwLWxlZnQuY29tcG9uZW50JztcclxuXHJcblxyXG5leHBvcnQgY2xhc3MgTG9va3VwQ29tcG9uZW50TWFuYWdlciB7XHJcbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIGluczogTG9va3VwR3JpZENvbXBvbmVudCkge31cclxuXHJcbiAgICBnZXRDb21wb25lbnRJbnN0YW5jZSh0eXBlOiBDb21wb25lbnRJbnN0YW5jZVR5cGUgPSAnZGF0YXRhYmxlJykge1xyXG4gICAgICAgIGlmICghdGhpcy5pbnMuY29tcG9uZW50UmVmIHx8ICF0aGlzLmlucy5jb21wb25lbnRSZWYuaW5zdGFuY2UpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodHlwZSA9PT0gJ3NlbGVjdGVkJykge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5pbnMuc2VsZWN0ZWREdFJlZjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGxldCBpbnMgPSB0aGlzLmlucy5jb21wb25lbnRSZWYuaW5zdGFuY2U7XHJcblxyXG4gICAgICAgIGlmICh0eXBlID09PSAnbGVmdERhdGFUYWJsZScgfHwgdHlwZSA9PT0gJ2xlZnRUcmVlJykge1xyXG4gICAgICAgICAgICBjb25zdCBsZWZ0UmVmID0gdGhpcy5pbnMubGVmdENvbXBvbmVudFJlZjtcclxuICAgICAgICAgICAgaWYgKCFsZWZ0UmVmIHx8ICFsZWZ0UmVmLmluc3RhbmNlIHx8ICFsZWZ0UmVmLmluc3RhbmNlLmNtcFJlZiB8fCAhbGVmdFJlZi5pbnN0YW5jZS5jbXBSZWYuaW5zdGFuY2UpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlucyA9IHRoaXMuaW5zLmxlZnRDb21wb25lbnRSZWYuaW5zdGFuY2UuY21wUmVmLmluc3RhbmNlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHR5cGUgPT09ICdmYXYnKSB7XHJcbiAgICAgICAgICAgIGlucyA9IHRoaXMuaW5zLmZhdm9yaXRlc0NvbXBvbmVudFJlZi5pbnN0YW5jZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHN3aXRjaCAodHlwZSkge1xyXG4gICAgICAgICAgICBjYXNlICdsZWZ0RGF0YVRhYmxlJzpcclxuICAgICAgICAgICAgY2FzZSAnZmF2JzpcclxuICAgICAgICAgICAgY2FzZSAnZGF0YXRhYmxlJzpcclxuICAgICAgICAgICAgICAgIHJldHVybiBpbnMgYXMgRGF0YVRhYmxlQ29tcG9uZW50O1xyXG4gICAgICAgICAgICBjYXNlICdsZWZ0VHJlZSc6XHJcbiAgICAgICAgICAgIGNhc2UgJ3RyZWV0YWJsZSc6XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gaW5zIGFzIFRyZWVUYWJsZUNvbXBvbmVudDtcclxuICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmlucy5pc1RyZWUoKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBpbnMgYXMgVHJlZVRhYmxlQ29tcG9uZW50O1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGlucyBhcyBEYXRhVGFibGVDb21wb25lbnQ7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGNyZWF0ZUNvbXBvbmVudFdpdGhTZXJ2ZXJEYXRhKGRhdGE6IGFueSkge1xyXG4gICAgICAgIGlmICh0aGlzLmlucy5jb21wb25lbnRSZWYpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmlucy5pZEZpZWxkID0gZGF0YS5pZEZpZWxkIHx8IHRoaXMuaW5zLmlkRmllbGQ7XHJcbiAgICAgICAgdGhpcy5pbnMudGV4dEZpZWxkID0gZGF0YS50ZXh0RmllbGQgfHwgdGhpcy5pbnMudGV4dEZpZWxkO1xyXG4gICAgICAgIHRoaXMuaW5zLnZhbHVlRmllbGQgPSBkYXRhLnZhbHVlRmllbGQgfHwgdGhpcy5pbnMudmFsdWVGaWVsZDtcclxuXHJcbiAgICAgICAgdGhpcy5pbnMuZGlzcGxheVR5cGUgPSAoZGF0YSAmJiBkYXRhLmRpc3BsYXlUeXBlKSB8fCB0aGlzLmlucy5kaXNwbGF5VHlwZSB8fCAnTElTVCc7XHJcblxyXG4gICAgICAgIGNvbnN0IGR0eXAgPSB0aGlzLmlucy5kaXNwbGF5VHlwZS50b1VwcGVyQ2FzZSgpO1xyXG5cclxuICAgICAgICBpZiAodGhpcy5pbnMuaXNEb3VibGxlTGlzdCgpKSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmlucy5uYXZUcmVlVG9MaXN0ICYmIGR0eXAgPT09IExvb2t1cEdyaWREaXNwbGF5VHlwZS5OYXZUcmVlTGlzdCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5pbnMuZGlzcGxheVR5cGUgPSBMb29rdXBHcmlkRGlzcGxheVR5cGUuTmF2TGlzdDtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKHRoaXMuaW5zLnRyZWVUb0xpc3QpIHtcclxuICAgICAgICAgICAgICAgIGlmIChkdHlwID09PSAgTG9va3VwR3JpZERpc3BsYXlUeXBlLk5hdkxpc3RUcmVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnMuZGlzcGxheVR5cGUgPSBMb29rdXBHcmlkRGlzcGxheVR5cGUuTmF2TGlzdDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5pbnMudHJlZVRvTGlzdCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKGR0eXAgPT09IExvb2t1cEdyaWREaXNwbGF5VHlwZS5UcmVlTGlzdCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaW5zLmRpc3BsYXlUeXBlID0gJ0xJU1QnO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZHR5cCA9PT0gIExvb2t1cEdyaWREaXNwbGF5VHlwZS5OYXZMaXN0VHJlZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmlucy5kaXNwbGF5VHlwZSA9IExvb2t1cEdyaWREaXNwbGF5VHlwZS5OYXZMaXN0O1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuIFxyXG5cclxuICAgICAgICBcclxuXHJcbiAgICAgICAgaWYgKHRoaXMuaW5zLmlzRG91YmxsZUxpc3QoKSAmJiB0aGlzLmlucy5uYXZUcmVlVG9MaXN0KSB7XHJcbiAgICAgICAgICAgIGlmIChkdHlwID09PSBMb29rdXBHcmlkRGlzcGxheVR5cGUuTmF2VHJlZUxpc3QpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuaW5zLmRpc3BsYXlUeXBlID0gTG9va3VwR3JpZERpc3BsYXlUeXBlLk5hdkxpc3Q7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuaW5zLmNoYW5nZURldGVjdG9yLmRldGVjdENoYW5nZXMoKTtcclxuXHJcbiAgICAgICAgdGhpcy5pbnMuY29tcG9uZW50UmVmID0gdGhpcy5jcmVhdGVDb250ZW50KHRoaXMuaW5zLmdyaWRPcHRpb25zKTtcclxuICAgICAgICB0aGlzLmNyZWF0ZUZhdm9yaXRlQ29tcG9uZW50KCk7XHJcblxyXG4gICAgICAgIHRoaXMucmVzaXplQ29tcG9uZW50KCk7XHJcbiAgICB9XHJcblxyXG5cclxuICAgIGNyZWF0ZUZhdm9yaXRlQ29tcG9uZW50KCkge1xyXG4gICAgICAgIGlmICh0aGlzLmlucy51c2VGYXZvcml0ZSAmJiAhdGhpcy5pbnMuZmF2b3JpdGVzQ29tcG9uZW50UmVmKSB7XHJcbiAgICAgICAgICAgIHRoaXMuaW5zLmZhdm9yaXRlQ29sdW1ucyA9IHRoaXMuaW5zLmZhdkhlbHBlci5nZXRGYXZvcml0ZUNvbHVtbnMoKTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IGZhdm9yaXRlc09wdGlvbnMgPSBPYmplY3QuYXNzaWduKHt9LCB0aGlzLmlucy5ncmlkT3B0aW9ucywge1xyXG4gICAgICAgICAgICAgICAgc2hvd0ZpbHRlckJhcjogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICBwYWdpbmF0aW9uOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgIGNvbHVtbnM6IHRoaXMuaW5zLmZhdm9yaXRlQ29sdW1ucyB8fCBbXVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgdGhpcy5pbnMuZmF2b3JpdGVzQ29tcG9uZW50UmVmID0gdGhpcy5jcmVhdGVGYXZvcml0ZXNDb250ZW50KGZhdm9yaXRlc09wdGlvbnMpO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5yZXNpemVDb21wb25lbnQoJ2ZhdicpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcblxyXG4gICAgcHJpdmF0ZSByZWxvYWRUcmVlRGF0YUZvckV4cGFuZChleHBhbmRMZXZlbCkge1xyXG4gICAgICAgIGNvbnN0IHVyaSA9IHRoaXMuaW5zLmdyaWRPcHRpb25zLnVyaTtcclxuICAgICAgICBjb25zdCB0dCA9IHRoaXMuaW5zLmNvbXBvbmVudFJlZi5pbnN0YW5jZSBhcyBUcmVlVGFibGVDb21wb25lbnQ7XHJcbiAgICAgICAgY29uc3QgeyBmaWVsZCA9ICcqJywgdmFsdWUgPSAnJyB9ID0ge1xyXG4gICAgICAgICAgICAuLi50dC5zZWFyY2hEYXRhXHJcbiAgICAgICAgfTtcclxuICAgICAgICBjb25zdCBzZWFyY2ggPSB7IGNhdGVnb3J5OiAnYWxsJywgc2VhcmNoVmFsdWU6IHZhbHVlLCBzZWFyY2hGaWVsZDogZmllbGQsIGxheWVyTnVtOiBleHBhbmRMZXZlbCB9O1xyXG5cclxuXHJcbiAgICAgICAgY29uc3QgcGFyYW0gPSB7XHJcbiAgICAgICAgICAgIHNlYXJjaFZhbHVlOiBKU09OLnN0cmluZ2lmeShzZWFyY2gpLFxyXG4gICAgICAgICAgICBjdXN0b21EYXRhOiB0aGlzLmlucy5jdXN0b21EYXRhLFxyXG4gICAgICAgICAgICBlbmFibGVGdWxsVHJlZTogdGhpcy5pbnMuZW5hYmxlRnVsbFRyZWUsXHJcbiAgICAgICAgICAgIGxvYWRUcmVlRGF0YVR5cGU6IHRoaXMuaW5zLmxvYWRUcmVlRGF0YVR5cGVcclxuICAgICAgICB9O1xyXG5cclxuXHJcbiAgICAgICAgaWYgKHRoaXMuaW5zLmhlbHBJZCkge1xyXG4gICAgICAgICAgICBwYXJhbVsnaGVscElkJ10gPSB0aGlzLmlucy5oZWxwSWQ7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodHQgJiYgdHQuc29ydE5hbWUpIHtcclxuICAgICAgICAgICAgT2JqZWN0LmFzc2lnbihwYXJhbSwge1xyXG4gICAgICAgICAgICAgICAgc29ydE5hbWU6IHR0LnNvcnROYW1lLFxyXG4gICAgICAgICAgICAgICAgc29ydE9yZGVyOiB0dC5zb3J0T3JkZXJcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuaW5zLnNob3dMb2FkaW5nKCk7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuaW5zLmh0dHAuZ2V0RGF0YSh1cmksIHBhcmFtKS5zdWJzY3JpYmUoKGRhdGE6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLmlucy5jbG9zZUxvYWRpbmcoKTtcclxuICAgICAgICAgICAgY29uc3Qgbm9kZXMgPSB0aGlzLmlucy5jaGVja05vZGVDYW5CZVNlbGVjdChkYXRhLml0ZW1zLCBleHBhbmRMZXZlbCA9PT0gLTEpO1xyXG4gICAgICAgICAgICB0aGlzLmlucy5pdGVtcyA9IG5vZGVzO1xyXG4gICAgICAgICAgICB0dC5sb2FkRGF0YShub2Rlcyk7XHJcbiAgICAgICAgICAgIHR0LnBzUmVmLmRpcmVjdGl2ZVJlZi5zY3JvbGxUb1RvcCgwKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHNldFRyZWVOb2RlRXhwYW5kQnkobm9kZXM6IFRyZWVOb2RlW10sIGxldmVsKSB7XHJcbiAgICAgICAgaWYgKCFub2RlcyB8fCAhbm9kZXMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgbm9kZXMuZm9yRWFjaCgobjogVHJlZU5vZGUpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgbGF5ZXIgPSBuLmRhdGFbdGhpcy5pbnMudHJlZUluZm8uZGF0YUZpZWxkXS5sYXllcjtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IGV4cGFuZExheWVyID0gbGF5ZXIgKyBsZXZlbCAtIDE7XHJcblxyXG4gICAgICAgICAgICBuLmV4cGFuZGVkID0gbGF5ZXIgPD0gZXhwYW5kTGF5ZXIgPyB0cnVlIDogbi5leHBhbmRlZDtcclxuICAgICAgICAgICAgaWYgKG4uY2hpbGRyZW4gJiYgbi5jaGlsZHJlbi5sZW5ndGggJiYgbGF5ZXIgKyAxIDw9IGV4cGFuZExheWVyKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNldFRyZWVOb2RlRXhwYW5kQnkobi5jaGlsZHJlbiwgbGV2ZWwpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8g5ZCv55So5qCR5biu5Yqp5Y+z6ZSu6I+c5Y2V5Yqf6IO9XHJcbiAgICBwcml2YXRlIHVzZUNvbnRleHRNZW51Rm9yVHJlZShjbXBSZWY6IENvbXBvbmVudFJlZjxhbnk+KSB7XHJcbiAgICAgICAgY29uc3QgeyBtYXhMZXZlbCwgZW5hYmxlQ29udGV4dE1lbnUsIGxhbmd1YWdlIH0gPSB0aGlzLmlucy50cmVlVGFibGVPcHRpb25zO1xyXG4gICAgICAgIGlmIChlbmFibGVDb250ZXh0TWVudSAmJiBtYXhMZXZlbCkge1xyXG4gICAgICAgICAgICBjb25zdCBsZXZlbE1lbnVzID0gW107XHJcbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAxOyBpIDw9IG1heExldmVsOyBpKyspIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHRpdGxlID0gbGFuZ3VhZ2VbJ2V4cGFuZCcgKyBpXTtcclxuICAgICAgICAgICAgICAgIGxldmVsTWVudXMucHVzaCh7IGlkOiAzMCArIDEsIGNvZGU6IGksIHRpdGxlLCBoYW5kbGU6ICh0KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8g5Y+R6YCB6K+35rGC6I635Y+W5pWw5o2uXHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgbGV2ZWwgPSB0Lm1lbnUuY29kZTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoaXNMb2FkQWxsVHJlZURhdGEoKSApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRUcmVlTm9kZUV4cGFuZEJ5KHRoaXMuaW5zLml0ZW1zLCBsZXZlbCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNtcFJlZi5pbnN0YW5jZS51cGRhdGVTZXJpYWxpemVkVmFsdWUoKTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB7IGRhdGFGaWVsZCwgbGF5ZXJGaWVsZCB9ID0gdGhpcy5pbnMudHJlZUluZm87XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGZpcnN0Tm9kZURhdGEgPSAodGhpcy5pbnMuaXRlbXMgfHwgW10pWzBdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZmlyc3ROb2RlRGF0YSAmJiBmaXJzdE5vZGVEYXRhLmRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG1pbkxheWVyID0gdGhpcy5pbnMudXRpbHMuZ2V0VmFsdWUoYCR7ZGF0YUZpZWxkfS4ke2xheWVyRmllbGR9YCwgZmlyc3ROb2RlRGF0YS5kYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBfbGV2ZWwgPSBtaW5MYXllciArIGxldmVsIC0gMTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucmVsb2FkVHJlZURhdGFGb3JFeHBhbmQoX2xldmVsKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0gfSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGNvbnN0IGlzTG9hZEFsbFRyZWVEYXRhID0gKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuaW5zLmxvYWRUcmVlRGF0YVR5cGUgPT09ICdkZWZhdWx0Jykge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBjbXBSZWYuaW5zdGFuY2UubG9hZERhdGFUeXBlID09PSAnYWxsJztcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuaW5zLmxvYWRUcmVlRGF0YVR5cGUgPT09ICdsb2FkYWxsJztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IGNvbnRleHRNZW51cyA9IFtcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBpZDo2LCBjb2RlOiAnY2hlY2tjaGlsZG5vZGVzJywgdGl0bGU6ICfli77pgInkuIvnuqfmlbDmja4nLFxyXG4gICAgICAgICAgICAgICAgICAgIHZpc2libGU6IChlKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKGUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gIWUuZGF0YS5ub2RlLnNlbGVjdGFibGUgJiYgIXRoaXMuaW5zLnNpbmdsZVNlbGVjdCAmJiBlLmRhdGEubm9kZS5jaGlsZHJlbiAmJiBlLmRhdGEubm9kZS5jaGlsZHJlbi5sZW5ndGhcclxuICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgIGhhbmRsZTogKHQpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNtcFJlZikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgbm9kZUlkcyA9IGNtcFJlZi5pbnN0YW5jZS5nZXRDaGlsZE5vZGVzKHQuZGF0YS5pZCkuZmlsdGVyKG4gPT4gbi5zZWxlY3RhYmxlKS5tYXAobiA9PiBuW3RoaXMuaW5zLmlkRmllbGRdKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGNvbnN0IG5vZGVJZHMgPSB0LmRhdGEubm9kZS5jaGlsZHJlbi5tYXAobiA9PiBuW3RoaXMuaW5zLmlkRmllbGRdKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNtcFJlZi5pbnN0YW5jZS5jaGVja2VkTm9kZXMobm9kZUlkcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbXBSZWYuaW5zdGFuY2Uuc2VsZWN0Tm9kZXMobm9kZUlkcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIGlkOjUsIGNvZGU6ICd1bmNoZWNrY2hpbGRub2RlcycsIHRpdGxlOiAn5Y+W5raI5Yu+6YCJ5LiL57qn5pWw5o2uJyxcclxuICAgICAgICAgICAgICAgICAgICB2aXNpYmxlOiAoZSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICFlLmRhdGEubm9kZS5zZWxlY3RhYmxlICYmICF0aGlzLmlucy5zaW5nbGVTZWxlY3QgJiYgZS5kYXRhLm5vZGUuY2hpbGRyZW4gJiYgZS5kYXRhLm5vZGUuY2hpbGRyZW4ubGVuZ3RoXHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICBoYW5kbGU6ICh0KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjbXBSZWYpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGNvbnN0IG5vZGVJZHMgPSB0LmRhdGEubm9kZS5jaGlsZHJlbi5tYXAobiA9PiBuW3RoaXMuaW5zLmlkRmllbGRdKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG5vZGVJZHMgPSBjbXBSZWYuaW5zdGFuY2UuZ2V0Q2hpbGROb2Rlcyh0LmRhdGEuaWQpLmZpbHRlcihuID0+IG4uc2VsZWN0YWJsZSkubWFwKG4gPT4gblt0aGlzLmlucy5pZEZpZWxkXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbXBSZWYuaW5zdGFuY2UudW5DaGVja2VkTm9kZXMobm9kZUlkcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbXBSZWYuaW5zdGFuY2UudW5TZWxlY3ROb2Rlcyhub2RlSWRzKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAnLScsXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWQ6IDEsIGNvZGU6ICdleHBhbmRhbGwnLCB0aXRsZTogbGFuZ3VhZ2UuZXhwYW5kYWxsLCBoYW5kbGU6ICh0KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjbXBSZWYgJiYgaXNMb2FkQWxsVHJlZURhdGEoKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY21wUmVmLmluc3RhbmNlLmV4cGFuZEFsbCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8g5Y+R6YCB6K+35rGC6I635Y+W5pWw5o2uXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJlbG9hZFRyZWVEYXRhRm9yRXhwYW5kKC0xKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICB7IGlkOiAyLCBjb2RlOiAnY29sbGFwc2VhbGwnLCB0aXRsZTogbGFuZ3VhZ2UuY29sbGFwc2VhbGwsIGhhbmRsZTogKHQpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoY21wUmVmKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNtcFJlZi5pbnN0YW5jZS5jb2xsYXBzZUFsbCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0gfSxcclxuICAgICAgICAgICAgICAgICctJyxcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBpZDogMywgdGl0bGU6IGxhbmd1YWdlLmV4cGFuZEJ5TGF5ZXIsXHJcbiAgICAgICAgICAgICAgICAgICAgY2hpbGRyZW46IGxldmVsTWVudXNcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgXTtcclxuICAgICAgICAgICAgdGhpcy5pbnMudHJlZVRhYmxlT3B0aW9ucy5jb250ZXh0TWVudUl0ZW1zID0gY29udGV4dE1lbnVzO1xyXG5cclxuICAgICAgICAgICAgY21wUmVmLmluc3RhbmNlLmJlZm9yZVNob3dDb250ZXh0TWVudSA9ICgpID0+IHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBvZih7c2hvdzogIWNtcFJlZi5pbnN0YW5jZS5zdGF0ZS5zZWFyY2hlZH0pO1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBnZXRDbXBIZWlnaHQoaXNGYXYgPSBmYWxzZSkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmlucy5kaWFsb2dNZ3IuZ2V0SGVpZ2h0KCkgLSAoaXNGYXYgPyAxMCA6dGhpcy5pbnMuZ2V0RmlsdGVyQmFySGVpZ2h0KCkpO1xyXG4gICAgfVxyXG5cclxuICAgIGNyZWF0ZUNvbnRlbnQob3B0czogYW55KTogQ29tcG9uZW50UmVmPGFueT4ge1xyXG5cclxuICAgICAgICBpZiAodGhpcy5pbnMuY29tcG9uZW50UmVmKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IHR5cGUgPSB0aGlzLmlucy5nZXRDb21wb25lbnRUeXBlKCk7XHJcblxyXG4gICAgICAgIGNvbnN0IGNtcEZhYyA9IHRoaXMuaW5zLmNmci5yZXNvbHZlQ29tcG9uZW50RmFjdG9yeSh0eXBlKTtcclxuICAgICAgICBsZXQgY21wUmVmOiBDb21wb25lbnRSZWY8YW55PiA9IG51bGw7XHJcbiAgICAgICAgaWYgKHRoaXMuaW5zLmlzRG91YmxsZUxpc3QoKSkge1xyXG4gICAgICAgICAgICBjbXBSZWYgPSB0aGlzLmlucy5jZW50ZXJDb250YWluZXIuY3JlYXRlQ29tcG9uZW50KGNtcEZhYyk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgY21wUmVmID0gdGhpcy5pbnMuY29udGVudENvbnRhaW5lci5jcmVhdGVDb21wb25lbnQoY21wRmFjKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh0aGlzLmlucy5pc1RyZWUoKSkge1xyXG4gICAgICAgICAgICBvcHRzLmZpdCA9IHRydWU7XHJcbiAgICAgICAgICAgIG9wdHMucGFnaW5hdGlvbiA9IGZhbHNlO1xyXG5cclxuICAgICAgICAgICAgb3B0cy5mYXN0ID0gdHJ1ZTtcclxuICAgICAgICAgICAgb3B0cy5maXRDb2x1bW5zID0gZmFsc2U7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICB0aGlzLnVzZUNvbnRleHRNZW51Rm9yVHJlZShjbXBSZWYpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIG9wdHMuZmlsbCA9IHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIG9wdHMuYXV0b0ZpdENvbHVtbnMgPSB0cnVlO1xyXG5cclxuICAgICAgICBjb25zdCB0dE9wdHMgPSB0aGlzLmlucy50cmVlVGFibGVPcHRpb25zIHx8IHt9O1xyXG4gICAgICAgIE9iamVjdC5hc3NpZ24oY21wUmVmLmluc3RhbmNlLCBvcHRzLCB7IGFsbENvbHVtbnNUaXRsZTogdGhpcy5pbnMuYWxsQ29sdW1uc1RpdGxlLCAuLi50dE9wdHMgfSk7XHJcblxyXG4gICAgICAgIHRoaXMuaW5zLmNvbXBvbmVudFJlZiA9IGNtcFJlZjtcclxuICAgICAgICB0aGlzLnJlc2l6ZUNvbXBvbmVudCgpO1xyXG4gICAgICAgIHJldHVybiBjbXBSZWY7XHJcbiAgICB9XHJcblxyXG4gICAgLy8g5Yib5bu65pS26JePQ01QXHJcbiAgICBjcmVhdGVGYXZvcml0ZXNDb250ZW50KG9wdHM6IGFueSk6IENvbXBvbmVudFJlZjxhbnk+IHtcclxuICAgICAgICBjb25zdCB0eXBlID0gdGhpcy5pbnMuZ2V0Q29tcG9uZW50VHlwZSgpO1xyXG4gICAgICAgIFxyXG4gICAgICAgIGNvbnN0IGNtcEZhYyA9IHRoaXMuaW5zLmNmci5yZXNvbHZlQ29tcG9uZW50RmFjdG9yeSh0eXBlKTtcclxuICAgICAgICBsZXQgY21wUmVmID0gbnVsbDtcclxuICAgICAgICBjbXBSZWYgPSB0aGlzLmlucy5mYXZvcml0ZXNDb250YWluZXIuY3JlYXRlQ29tcG9uZW50KGNtcEZhYyk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgaWYgKHRoaXMuaW5zLmlzVHJlZSgpKSB7XHJcbiAgICAgICAgICAgIG9wdHMuZml0ID0gdHJ1ZTtcclxuICAgICAgICAgICAgb3B0cy5wYWdpbmF0aW9uID0gZmFsc2U7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgb3B0cy5maWxsID0gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgb3B0cy5hdXRvRml0Q29sdW1ucyA9IHRydWU7XHJcblxyXG4gICAgICAgIE9iamVjdC5hc3NpZ24oY21wUmVmLmluc3RhbmNlLCBvcHRzLCB7XHJcbiAgICAgICAgICAgIHdpZHRoOiB0aGlzLmlucy5kaWFsb2cuc2l6ZS53aWR0aCAtIHRoaXMuaW5zLmdldFNwYWNlV2lkdGgoKSxcclxuICAgICAgICAgICAgaGVpZ2h0OiB0aGlzLmlucy5kaWFsb2dNZ3IuZ2V0SGVpZ2h0KClcclxuICAgICAgICB9KTtcclxuXHJcblxyXG4gICAgICAgIC8vIOiuoumYheaUtuiXj+WkueWIl+ihqOS4ree7hOS7tueahOebuOWFs+S6i+S7tlxyXG4gICAgICAgIHRoaXMuaW5zLmZhdkhlbHBlci5pbml0RmF2b3JpdGVDb21wb25lbnRFdmVudChjbXBSZWYpO1xyXG5cclxuICAgICAgICByZXR1cm4gY21wUmVmO1xyXG4gICAgfVxyXG5cclxuICAgIHJlc2l6ZUNvbXBvbmVudCh0eXBlOiBDb21wb25lbnRJbnN0YW5jZVR5cGUgPSAnZGF0YXRhYmxlJykge1xyXG4gICAgICAgIGNvbnN0IHNpemUgPSB7XHJcbiAgICAgICAgICAgIHdpZHRoOiB0aGlzLmlucy5kaWFsb2cuc2l6ZS53aWR0aCAtIHRoaXMuaW5zLmdldFNwYWNlV2lkdGgoKSxcclxuICAgICAgICAgICAgaGVpZ2h0OiB0aGlzLmdldENtcEhlaWdodCh0eXBlID09ICdmYXYnKSBcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBpZiAodGhpcy5pbnMuaXNEb3VibGxlTGlzdCgpICYmICh0eXBlID09PSAnZGF0YXRhYmxlJyB8fCB0eXBlID09PSAndHJlZXRhYmxlJykpIHtcclxuICAgICAgICAgICAgc2l6ZS53aWR0aCA9IHRoaXMuaW5zLmRpYWxvZy5zaXplLndpZHRoIC0gdGhpcy5pbnMubGVmdFBhbmVsV2lkdGggLSB0aGlzLmlucy5nZXRTcGFjZVdpZHRoKHRydWUpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5nZXRDb21wb25lbnRJbnN0YW5jZSh0eXBlKS5yZXNpemUoc2l6ZSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBnZXRDaGlsZE5vZGVzKG5vZGU6IFRyZWVOb2RlKSB7XHJcbiAgICAgICAgY29uc3Qgbm9kZXM6IGFueSA9IFtdO1xyXG4gICAgICAgIGlmIChub2RlLnNlbGVjdGFibGUgfHwgbm9kZS5zZWxlY3RhYmxlID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgbm9kZXMucHVzaChub2RlKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKG5vZGUuY2hpbGRyZW4gJiYgbm9kZS5jaGlsZHJlbi5sZW5ndGgpIHtcclxuICAgICAgICAgICAgbm9kZS5jaGlsZHJlbi5mb3JFYWNoKG4gPT4ge1xyXG4gICAgICAgICAgICAgICAgbm9kZXMucHVzaCguLi50aGlzLmdldENoaWxkTm9kZXMobikpO1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIG5vZGVzO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKiDliJvlu7rlt6bkvqfnu4Tku7YgKi9cclxuICAgIGNyZWF0ZUxlZnRDb21wb25lbnQob3BzOiBhbnkpIHtcclxuICAgICAgICBsZXQgZHRGYWMgPSBudWxsO1xyXG4gICAgICAgIGlmICh0aGlzLmlucy5pc0RvdWJsbGVMaXN0KCkpIHtcclxuICAgICAgICAgICAgZHRGYWMgPSB0aGlzLmlucy5jZnIucmVzb2x2ZUNvbXBvbmVudEZhY3RvcnkoTG9va3VwTGVmdENvbXBvbmVudCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuaW5zLmxlZnRDb21wb25lbnRSZWYgPSB0aGlzLmlucy5sZWZ0Q29udGFpbmVyLmNyZWF0ZUNvbXBvbmVudChkdEZhYyk7XHJcbiAgICAgICAgb3BzLmhlaWdodCA9IHRoaXMuaW5zLmRpYWxvZ01nci5nZXRIZWlnaHQoKTtcclxuXHJcbiAgICAgICAgaWYgKHRoaXMuaW5zLmRpYWxvZ1dpZHRoIDwgdGhpcy5pbnMubmF2TG9va3VwRGlhbG9nTWluV2lkdGgpIHtcclxuICAgICAgICAgICAgdGhpcy5pbnMuZGlhbG9nV2lkdGggPSB0aGlzLmlucy5uYXZMb29rdXBEaWFsb2dNaW5XaWR0aDtcclxuICAgICAgICAgICAgdGhpcy5pbnMuZGlhbG9nLnJlU2l6ZSh7IHdpZHRoOiB0aGlzLmlucy5kaWFsb2dXaWR0aCB9KTtcclxuICAgICAgICAgICAgdGhpcy5pbnMucmVzaXplQ21wKHsgd2lkdGg6IHRoaXMuaW5zLmRpYWxvZy5zaXplLndpZHRoIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKG9wcy53aWR0aCAhPT0gdGhpcy5pbnMubGVmdFBhbmVsLndpZHRoKSB7XHJcbiAgICAgICAgICAgIC8vIOm7mOiupCAxIDogMlxyXG4gICAgICAgICAgICB0aGlzLmlucy5sZWZ0UGFuZWwucmVzaXplKHtcclxuICAgICAgICAgICAgICAgIHdpZHRoOiB0aGlzLmlucy5sZWZ0UGFuZWwud2lkdGgsXHJcbiAgICAgICAgICAgICAgICBoZWlnaHQ6IG9wcy5oZWlnaHRcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIHRoaXMuaW5zLnJlc2l6ZUNtcCh7IHdpZHRoOiB0aGlzLmlucy5kaWFsb2cuc2l6ZS53aWR0aCB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIHRoaXMucmVzaXplQ29tcG9uZW50KCk7XHJcblxyXG4gICAgICAgIHRoaXMuaW5zLmxlZnRDb21wb25lbnRSZWYuaW5zdGFuY2UubG9va3VwQ21wID0gdGhpcy5pbnM7XHJcbiAgICAgICAgdGhpcy5pbnMubGVmdENvbXBvbmVudFJlZi5pbnN0YW5jZS5uYXZPcHRpb25zID0gb3BzO1xyXG5cclxuXHJcbiAgICAgICAgdGhpcy5pbnMubGVmdENvbXBvbmVudFJlZi5pbnN0YW5jZS5zZWxlY3RlZFxyXG4gICAgICAgICAgICAucGlwZShcclxuICAgICAgICAgICAgICAgIGRlYm91bmNlVGltZSgxMDApLFxyXG4gICAgICAgICAgICAgICAgc3dpdGNoTWFwKChkOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZCAmJiBkLmRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnMubmF2aWdhdGlvbkZpbHRlciA9IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdGVkOiBkLmRhdGEsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZFZhbHVlOiB0aGlzLmdldE5hdmlnYXRpb25GaWx0ZXIoZC5kYXRhKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlYXJjaEZpZWxkOiAnJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlYXJjaFZhbHVlOiAnJ1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaW5zLm5hdmlnYXRpb25GaWx0ZXIgPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIC8vIOWKoOi9veWPs+S+p+aVsOaNrlxyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHAgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhZ2VJbmZvOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYWdlSW5kZXg6IDEsIC8vIHRmcyA2Mzg4NDBcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhZ2VTaXplOiB0aGlzLmlucy5ncmlkT3B0aW9ucy5wYWdlU2l6ZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuaW5zLmluY2x1ZGVTdWJvcmRpbmF0ZXMgJiYgZCAmJiBkLm5vZGUgJiYgb3BzLnRyZWVJbmZvKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHtsYXllclR5cGUsIHBhdGhGaWVsZCwgbG9hZERhdGFUeXBlLCBkYXRhRmllbGR9ID0gb3BzLnRyZWVJbmZvXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChsb2FkRGF0YVR5cGUgPT09ICdhbGwnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCByb3dEYXRhcyA9IHRoaXMuZ2V0Q2hpbGROb2RlcyhkLm5vZGUpLm1hcChuID0+IG4uZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmlucy5uYXZpZ2F0aW9uRmlsdGVyLmlkVmFsdWUgPSB0aGlzLmdldE5hdmlnYXRpb25GaWx0ZXIocm93RGF0YXMpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGxheWVyVHlwZSA9PSAncGF0aGNvZGUnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gcFsnbmF2Tm9kZVBhdGhDb2RlJ10gPSBkLmRhdGFbZGF0YUZpZWxkXVtwYXRoRmllbGRdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBbJ25hdk5vZGVQYXRoQ29kZSddID0gdGhpcy5pbnMuZ2V0UGF0aENvZGUoZC5kYXRhLCBvcHMudHJlZUluZm8pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaW5zWyduYXZOb2RlUGF0aENvZGUnXSA9IHBbJ25hdk5vZGVQYXRoQ29kZSddO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaW5zWyduYXZOb2RlUGF0aENvZGUnXSA9ICcnO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZGF0YUNtcFJlZiA9IHRoaXMuZ2V0Q29tcG9uZW50SW5zdGFuY2UoKTtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCB7IHNvcnROYW1lLCBzb3J0T3JkZXIgfSA9IGRhdGFDbXBSZWY7XHJcbiAgICAgICAgICAgICAgICAgICAgT2JqZWN0LmFzc2lnbihwLCB7IHNlYXJjaDogdGhpcy5pbnMuX3NlYXJjaFN0YXRlLCBzb3J0TmFtZSwgc29ydE9yZGVyIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmlucy5odHRwTWdyLmdldERhdGEocCwgJ2xpc3QnKTtcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIClcclxuICAgICAgICAgICAgLnN1YnNjcmliZShyZXMgPT4ge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5pbnMuY2xvc2VMb2FkaW5nKCk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmlucy5sb2FkRGF0YVdoZW5PcGVuID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBpZiAodGhpcy5pbnMudXNlRmF2b3JpdGUgJiYgIXRoaXMuaW5zLmlzVHJlZSgpKSB7XHJcbiAgICAgICAgICAgICAgICAvLyAgICAgdGhpcy5pbnMuZmF2SGVscGVyLnVwZGF0ZUZhdm9yaXRlc1N0YXR1cyhyZXMuaXRlbXMpO1xyXG4gICAgICAgICAgICAgICAgLy8gfVxyXG4gICAgICAgICAgICAgICAgLy8gdGhpcy5pbnMubG9hZERhdGFUYWJsZURhdGEocmVzKTtcclxuICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgdGhpcy5pbnMubG9hZERhdGEocmVzLCBmYWxzZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8g6YCJ5Lit5pWw5o2uXHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnMuc2VsZWN0aW9uTWdyLnNlbGVjdEN1cnJlbnRWYWx1ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaW5zLmNoYW5nZURldGVjdG9yLmRldGVjdENoYW5nZXMoKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHRoaXMuaW5zLmxlZnRDb21wb25lbnRSZWYuaW5zdGFuY2UuY3JlYXRlQ29tcG9uZW50KCk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8g6I635Y+W5YWz6IGU5pWw5o2uLCDlj7PkvqfmlbDmja7kuK0g5YWz6IGU5ZCE5a2X5q6155qE5YC8XHJcbiAgICBwcml2YXRlIGdldE5hdmlnYXRpb25GaWx0ZXIobmF2Um93OiBhbnkpIHtcclxuICAgICAgICBpZiAodGhpcy5pbnMubmF2aWdhdGlvbk9wdGlvbnMucmVsYXRpb25zICYmIHRoaXMuaW5zLm5hdmlnYXRpb25PcHRpb25zLnJlbGF0aW9ucy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gW107XHJcbiAgICAgICAgICAgIHRoaXMuaW5zLm5hdmlnYXRpb25PcHRpb25zLnJlbGF0aW9ucy5mb3JFYWNoKHIgPT4ge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgayA9IHIuZ3JvdXBGaWVsZDtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGRGaWVsZCA9IHIuaGVscEZpZWxkO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgcmY6IGFueSA9IHsgZmllbGROYW1lOiBkRmllbGQsIGZpZWxkVmFsdWU6ICcnIH07XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkobmF2Um93KSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHZhbHMgPSBuYXZSb3cubWFwKG4gPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gay5zcGxpdCgnLicpLnJlZHVjZSgobywgYykgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9bY107XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sIG4pO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIHJmLmZpZWxkVmFsdWUgPSB2YWxzLmpvaW4oJywnKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmYuZmllbGRWYWx1ZSA9IGsuc3BsaXQoJy4nKS5yZWR1Y2UoKG8sIGMpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9bY107XHJcbiAgICAgICAgICAgICAgICAgICAgfSwgbmF2Um93KTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICByZXN1bHQucHVzaChyZik7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuICcnO1xyXG4gICAgfVxyXG59XHJcbiJdfQ==
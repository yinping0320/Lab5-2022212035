/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Directive, ElementRef, Injector, Input, NgZone, Renderer2 } from '@angular/core';
import { CommonUtils, OverLayHiddenService } from '@farris/ui-common';
import { DataTableComponent } from '@farris/ui-datatable';
import { NotifyService } from '@farris/ui-notify';
var LookupSelectedDirective = /** @class */ (function () {
    function LookupSelectedDirective(injector, elRef, render, ngZone) {
        this.injector = injector;
        this.elRef = elRef;
        this.render = render;
        this.ngZone = ngZone;
        this.count = 0;
        this.panelMouseEvent = null;
        this.notifySer = null;
        this.commonUtils = null;
        this.panelEscHandler = null;
        this.overlaySer = new OverLayHiddenService();
        this.notifySer = this.injector.get(NotifyService, null);
        this.commonUtils = this.injector.get(CommonUtils, new CommonUtils());
    }
    /**
     * @return {?}
     */
    LookupSelectedDirective.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
    };
    /**
     * @return {?}
     */
    LookupSelectedDirective.prototype.ngAfterViewInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        setTimeout((/**
         * @return {?}
         */
        function () {
            _this.bindingEvents();
        }));
        this.panelMouseEvent = this.overlaySer.registerMouseEvent(this.elRef.nativeElement, (/**
         * @param {?} e
         * @return {?}
         */
        function (e) {
            if (_this.selectedPanel.nativeElement.contains(e.target) || _this.elRef.nativeElement.contains(e.target) ||
                e.target.classList.contains('lookup-clear-selected-items') || e.target.closest('.farris-messager')) {
                return;
            }
            _this.showPanel(false);
        }));
    };
    /**
     * @return {?}
     */
    LookupSelectedDirective.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        if (this.panelMouseEvent) {
            this.panelMouseEvent();
            this.panelMouseEvent = null;
        }
    };
    /**
     * @private
     * @param {?=} show
     * @return {?}
     */
    LookupSelectedDirective.prototype.showPanel = /**
     * @private
     * @param {?=} show
     * @return {?}
     */
    function (show) {
        var _this = this;
        if (show === void 0) { show = true; }
        /** @type {?} */
        var panel = this.selectedPanel.nativeElement;
        if (!show) {
            this.render.removeClass(panel, 'show');
            this.render.addClass(panel, 'd-none');
            if (this.panelEscHandler) {
                this.panelEscHandler();
                this.panelEscHandler = null;
            }
        }
        else {
            this.render.addClass(panel, 'show');
            this.render.removeClass(panel, 'd-none');
            // 注册ESC
            if (this.commonUtils) {
                this.panelEscHandler = this.commonUtils.regBodyKeydownEvent(null, (/**
                 * @return {?}
                 */
                function () { return _this.showPanel(false); }));
            }
        }
    };
    /**
     * @private
     * @return {?}
     */
    LookupSelectedDirective.prototype.bindingEvents = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        if (!this.selectedPanel) {
            return;
        }
        this.ngZone.runOutsideAngular((/**
         * @return {?}
         */
        function () {
            /** @type {?} */
            var panel = _this.selectedPanel.nativeElement;
            _this.render.listen(_this.elRef.nativeElement, 'click', (/**
             * @return {?}
             */
            function () {
                if (_this.selectedPanel && _this.count) {
                    if (panel.classList.contains('show')) {
                        _this.showPanel(false);
                    }
                    else {
                        _this.showPanel();
                        /** @type {?} */
                        var selectedTableContainer = panel.querySelector('.farris-datatable-container');
                        /** @type {?} */
                        var selectedTableBody = panel.querySelector('.farris-table-scorllable-body');
                        _this.render.removeStyle(selectedTableContainer, 'height');
                        _this.render.removeStyle(selectedTableBody, 'height');
                        _this.dataTableRef.resize({ height: panel.offsetHeight - 28, width: panel.offsetWidth - 28 });
                        _this.render.setStyle(selectedTableBody, 'height', _this.dataTableRef.tableHeight + 'px');
                        _this.render.setStyle(selectedTableBody, 'height', _this.dataTableRef.scorllableBodyHeight + 'px');
                        _this.dataTableRef.dtBody.checkBodyHeightWhenEmptyData();
                    }
                }
                else {
                    if (_this.notifySer) {
                        _this.notifySer.warning('当前还没有选择数据。');
                    }
                }
            }));
        }));
    };
    LookupSelectedDirective.decorators = [
        { type: Directive, args: [{ selector: '[lookup-selected]' },] }
    ];
    /** @nocollapse */
    LookupSelectedDirective.ctorParameters = function () { return [
        { type: Injector },
        { type: ElementRef },
        { type: Renderer2 },
        { type: NgZone }
    ]; };
    LookupSelectedDirective.propDecorators = {
        selectedPanel: [{ type: Input }],
        dataTableRef: [{ type: Input }],
        count: [{ type: Input }]
    };
    return LookupSelectedDirective;
}());
export { LookupSelectedDirective };
if (false) {
    /** @type {?} */
    LookupSelectedDirective.prototype.selectedPanel;
    /** @type {?} */
    LookupSelectedDirective.prototype.dataTableRef;
    /** @type {?} */
    LookupSelectedDirective.prototype.count;
    /**
     * @type {?}
     * @private
     */
    LookupSelectedDirective.prototype.overlaySer;
    /**
     * @type {?}
     * @private
     */
    LookupSelectedDirective.prototype.panelMouseEvent;
    /**
     * @type {?}
     * @private
     */
    LookupSelectedDirective.prototype.notifySer;
    /**
     * @type {?}
     * @private
     */
    LookupSelectedDirective.prototype.commonUtils;
    /**
     * @type {?}
     * @private
     */
    LookupSelectedDirective.prototype.panelEscHandler;
    /**
     * @type {?}
     * @private
     */
    LookupSelectedDirective.prototype.injector;
    /**
     * @type {?}
     * @private
     */
    LookupSelectedDirective.prototype.elRef;
    /**
     * @type {?}
     * @private
     */
    LookupSelectedDirective.prototype.render;
    /**
     * @type {?}
     * @private
     */
    LookupSelectedDirective.prototype.ngZone;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibG9va3VwLXNlbGVjdGVkLmRpcmVjdGl2ZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvdWktbG9va3VwLyIsInNvdXJjZXMiOlsibGliL3NlbGVjdGVkLWxpc3QvbG9va3VwLXNlbGVjdGVkLmRpcmVjdGl2ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFpQixTQUFTLEVBQUUsVUFBVSxFQUFFLFFBQVEsRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFxQixTQUFTLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDNUgsT0FBTyxFQUFFLFdBQVcsRUFBRSxvQkFBb0IsRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBQ3RFLE9BQU8sRUFBRSxrQkFBa0IsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBQzFELE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUVsRDtJQWFJLGlDQUFvQixRQUFrQixFQUFVLEtBQWlCLEVBQVUsTUFBaUIsRUFBVSxNQUFjO1FBQWhHLGFBQVEsR0FBUixRQUFRLENBQVU7UUFBVSxVQUFLLEdBQUwsS0FBSyxDQUFZO1FBQVUsV0FBTSxHQUFOLE1BQU0sQ0FBVztRQUFVLFdBQU0sR0FBTixNQUFNLENBQVE7UUFSM0csVUFBSyxHQUFHLENBQUMsQ0FBQztRQUdYLG9CQUFlLEdBQUcsSUFBSSxDQUFDO1FBQ3ZCLGNBQVMsR0FBa0IsSUFBSSxDQUFDO1FBQ2hDLGdCQUFXLEdBQUcsSUFBSSxDQUFDO1FBQ25CLG9CQUFlLEdBQUcsSUFBSSxDQUFDO1FBRzNCLElBQUksQ0FBQyxVQUFVLEdBQUcsSUFBSSxvQkFBb0IsRUFBRSxDQUFDO1FBQzdDLElBQUksQ0FBQyxTQUFTLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsYUFBYSxFQUFFLElBQUksQ0FBQyxDQUFDO1FBQ3hELElBQUksQ0FBQyxXQUFXLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsV0FBVyxFQUFFLElB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QW1CLEVBQUU7Ozs7Z0JBTEcsUUFBUTtnQkFBcEIsVUFBVTtnQkFBOEMsU0FBUztnQkFBcEMsTUFBTTs7O2dDQVFqRSxLQUFLOytCQUNMLEtBQUs7d0JBQ0wsS0FBSzs7SUErRlYsOEJBQUM7Q0FBQSxBQXBHRCxJQW9HQztTQW5HWSx1QkFBdUI7OztJQUVoQyxnREFBbUM7O0lBQ25DLCtDQUEwQzs7SUFDMUMsd0NBQW1COzs7OztJQUVuQiw2Q0FBeUM7Ozs7O0lBQ3pDLGtEQUErQjs7Ozs7SUFDL0IsNENBQXdDOzs7OztJQUN4Qyw4Q0FBMkI7Ozs7O0lBQzNCLGtEQUErQjs7Ozs7SUFFbkIsMkNBQTBCOzs7OztJQUFFLHdDQUF5Qjs7Ozs7SUFBRSx5Q0FBeUI7Ozs7O0lBQUUseUNBQXNCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQWZ0ZXJWaWV3SW5pdCwgRGlyZWN0aXZlLCBFbGVtZW50UmVmLCBJbmplY3RvciwgSW5wdXQsIE5nWm9uZSwgT25EZXN0cm95LCBPbkluaXQsIFJlbmRlcmVyMiB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBDb21tb25VdGlscywgT3ZlckxheUhpZGRlblNlcnZpY2UgfSBmcm9tICdAZmFycmlzL3VpLWNvbW1vbic7XHJcbmltcG9ydCB7IERhdGFUYWJsZUNvbXBvbmVudCB9IGZyb20gJ0BmYXJyaXMvdWktZGF0YXRhYmxlJztcclxuaW1wb3J0IHsgTm90aWZ5U2VydmljZSB9IGZyb20gJ0BmYXJyaXMvdWktbm90aWZ5JztcclxuXHJcbkBEaXJlY3RpdmUoeyBzZWxlY3RvcjogJ1tsb29rdXAtc2VsZWN0ZWRdJyB9KVxyXG5leHBvcnQgY2xhc3MgTG9va3VwU2VsZWN0ZWREaXJlY3RpdmUgaW1wbGVtZW50cyBPbkluaXQsIEFmdGVyVmlld0luaXQsIE9uRGVzdHJveXtcclxuXHJcbiAgICBASW5wdXQoKSBzZWxlY3RlZFBhbmVsOiBFbGVtZW50UmVmO1xyXG4gICAgQElucHV0KCkgZGF0YVRhYmxlUmVmOiBEYXRhVGFibGVDb21wb25lbnQ7XHJcbiAgICBASW5wdXQoKSBjb3VudCA9IDA7XHJcblxyXG4gICAgcHJpdmF0ZSBvdmVybGF5U2VyOiBPdmVyTGF5SGlkZGVuU2VydmljZTtcclxuICAgIHByaXZhdGUgcGFuZWxNb3VzZUV2ZW50ID0gbnVsbDtcclxuICAgIHByaXZhdGUgbm90aWZ5U2VyOiBOb3RpZnlTZXJ2aWNlID0gbnVsbDtcclxuICAgIHByaXZhdGUgY29tbW9uVXRpbHMgPSBudWxsO1xyXG4gICAgcHJpdmF0ZSBwYW5lbEVzY0hhbmRsZXIgPSBudWxsO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgaW5qZWN0b3I6IEluamVjdG9yLCBwcml2YXRlIGVsUmVmOiBFbGVtZW50UmVmLCBwcml2YXRlIHJlbmRlcjogUmVuZGVyZXIyLCBwcml2YXRlIG5nWm9uZTogTmdab25lKSB7XHJcbiAgICAgICAgdGhpcy5vdmVybGF5U2VyID0gbmV3IE92ZXJMYXlIaWRkZW5TZXJ2aWNlKCk7XHJcbiAgICAgICAgdGhpcy5ub3RpZnlTZXIgPSB0aGlzLmluamVjdG9yLmdldChOb3RpZnlTZXJ2aWNlLCBudWxsKTtcclxuICAgICAgICB0aGlzLmNvbW1vblV0aWxzID0gdGhpcy5pbmplY3Rvci5nZXQoQ29tbW9uVXRpbHMsIG5ldyBDb21tb25VdGlscygpKVxyXG4gICAgfVxyXG5cclxuICAgIG5nT25Jbml0KCk6IHZvaWQge1xyXG4gICAgICAgIFxyXG4gICAgfVxyXG5cclxuICAgIG5nQWZ0ZXJWaWV3SW5pdCgpOiB2b2lkIHtcclxuICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgICAgdGhpcy5iaW5kaW5nRXZlbnRzKCk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHRoaXMucGFuZWxNb3VzZUV2ZW50ID0gIHRoaXMub3ZlcmxheVNlci5yZWdpc3Rlck1vdXNlRXZlbnQodGhpcy5lbFJlZi5uYXRpdmVFbGVtZW50LCAoZTogYW55KSA9PiB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLnNlbGVjdGVkUGFuZWwubmF0aXZlRWxlbWVudC5jb250YWlucyhlLnRhcmdldCkgIHx8IHRoaXMuZWxSZWYubmF0aXZlRWxlbWVudC5jb250YWlucyhlLnRhcmdldCkgfHwgXHJcbiAgICAgICAgICAgIGUudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnbG9va3VwLWNsZWFyLXNlbGVjdGVkLWl0ZW1zJykgfHwgZS50YXJnZXQuY2xvc2VzdCgnLmZhcnJpcy1tZXNzYWdlcicpKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHRoaXMuc2hvd1BhbmVsKGZhbHNlKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBuZ09uRGVzdHJveSgpOiB2b2lkIHtcclxuICAgICAgICBpZiAodGhpcy5wYW5lbE1vdXNlRXZlbnQpIHtcclxuICAgICAgICAgICAgdGhpcy5wYW5lbE1vdXNlRXZlbnQoKTtcclxuICAgICAgICAgICAgdGhpcy5wYW5lbE1vdXNlRXZlbnQgPSBudWxsO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHNob3dQYW5lbChzaG93ID0gdHJ1ZSkge1xyXG4gICAgICAgIGNvbnN0IHBhbmVsID0gdGhpcy5zZWxlY3RlZFBhbmVsLm5hdGl2ZUVsZW1lbnQ7XHJcbiAgICAgICAgaWYgKCFzaG93KSB7XHJcbiAgICAgICAgICAgIHRoaXMucmVuZGVyLnJlbW92ZUNsYXNzKHBhbmVsLCAnc2hvdycpO1xyXG4gICAgICAgICAgICB0aGlzLnJlbmRlci5hZGRDbGFzcyhwYW5lbCwgJ2Qtbm9uZScpO1xyXG4gICAgICAgICAgICBpZiAodGhpcy5wYW5lbEVzY0hhbmRsZXIpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMucGFuZWxFc2NIYW5kbGVyKCk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnBhbmVsRXNjSGFuZGxlciA9IG51bGw7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5yZW5kZXIuYWRkQ2xhc3MocGFuZWwsICdzaG93Jyk7XHJcbiAgICAgICAgICAgIHRoaXMucmVuZGVyLnJlbW92ZUNsYXNzKHBhbmVsLCAnZC1ub25lJyk7XHJcbiAgICAgICAgICAgIC8vIOazqOWGjEVTQ1xyXG4gICAgICAgICAgICBpZiAodGhpcy5jb21tb25VdGlscykge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5wYW5lbEVzY0hhbmRsZXIgPSB0aGlzLmNvbW1vblV0aWxzLnJlZ0JvZHlLZXlkb3duRXZlbnQobnVsbCwgKCkgPT4gdGhpcy5zaG93UGFuZWwoZmFsc2UpKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGJpbmRpbmdFdmVudHMoKSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLnNlbGVjdGVkUGFuZWwpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLm5nWm9uZS5ydW5PdXRzaWRlQW5ndWxhcigoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IHBhbmVsID0gdGhpcy5zZWxlY3RlZFBhbmVsLm5hdGl2ZUVsZW1lbnQ7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICB0aGlzLnJlbmRlci5saXN0ZW4odGhpcy5lbFJlZi5uYXRpdmVFbGVtZW50LCAnY2xpY2snLCAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5zZWxlY3RlZFBhbmVsICYmIHRoaXMuY291bnQpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAocGFuZWwuY2xhc3NMaXN0LmNvbnRhaW5zKCdzaG93JykpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93UGFuZWwoZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd1BhbmVsKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHNlbGVjdGVkVGFibGVDb250YWluZXIgPSBwYW5lbC5xdWVyeVNlbGVjdG9yKCcuZmFycmlzLWRhdGF0YWJsZS1jb250YWluZXInKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc2VsZWN0ZWRUYWJsZUJvZHkgPSBwYW5lbC5xdWVyeVNlbGVjdG9yKCcuZmFycmlzLXRhYmxlLXNjb3JsbGFibGUtYm9keScpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJlbmRlci5yZW1vdmVTdHlsZShzZWxlY3RlZFRhYmxlQ29udGFpbmVyLCAnaGVpZ2h0Jyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyLnJlbW92ZVN0eWxlKHNlbGVjdGVkVGFibGVCb2R5LCAnaGVpZ2h0Jyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kYXRhVGFibGVSZWYucmVzaXplKHtoZWlnaHQ6IHBhbmVsLm9mZnNldEhlaWdodCAtIDI4LCB3aWR0aDogcGFuZWwub2Zmc2V0V2lkdGggLSAyOH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW5kZXIuc2V0U3R5bGUoc2VsZWN0ZWRUYWJsZUJvZHksICdoZWlnaHQnLCB0aGlzLmRhdGFUYWJsZVJlZi50YWJsZUhlaWdodCArICdweCcpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJlbmRlci5zZXRTdHlsZShzZWxlY3RlZFRhYmxlQm9keSwgJ2hlaWdodCcsIHRoaXMuZGF0YVRhYmxlUmVmLnNjb3JsbGFibGVCb2R5SGVpZ2h0ICsgJ3B4Jyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRhdGFUYWJsZVJlZi5kdEJvZHkuY2hlY2tCb2R5SGVpZ2h0V2hlbkVtcHR5RGF0YSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMubm90aWZ5U2VyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubm90aWZ5U2VyLndhcm5pbmcoJ+W9k+WJjei/mOayoeaciemAieaLqeaVsOaNruOAgicpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG5cclxufSJdfQ==
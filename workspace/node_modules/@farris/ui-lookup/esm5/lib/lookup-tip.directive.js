/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Directive, Renderer2, Injector, Input } from '@angular/core';
import { InputGroupComponent } from '@farris/ui-input-group';
import { PersonalConfigService } from './lookup-presonalConfig.service';
import { delay } from 'rxjs/operators';
import { LocaleService } from '@farris/ui-locale';
var LookupTipDirective = /** @class */ (function () {
    function LookupTipDirective(inputRef, renderer, injector) {
        this.inputRef = inputRef;
        this.renderer = renderer;
        this.injector = injector;
        this.enableTip = false;
        this.isInTipPanel = false;
        this.tipText = '您要找的是不是这些？';
        this.personalConfigService = this.injector.get(PersonalConfigService, null);
        this.localService = this.injector.get(LocaleService);
    }
    /**
     * @return {?}
     */
    LookupTipDirective.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.tipText = this.localService.getValue('lookup.tipText');
        this.enableTip = false; // 因数据权限问题，此功能暂屏蔽 tfs: 403924
        if (this.enableTip) {
            this.inputRef.iconMouseEnter.subscribe((/**
             * @param {?} e
             * @return {?}
             */
            function (e) {
                _this.creatPanel();
            }));
            this.inputRef.iconMouseLeave.pipe(delay(200)).subscribe((/**
             * @param {?} e
             * @return {?}
             */
            function (e) {
                if (!_this.isInTipPanel) {
                    _this.removePanel();
                }
            }));
            this.inputRef.clickHandle.subscribe((/**
             * @param {?} e
             * @return {?}
             */
            function (e) {
                _this.removePanel();
            }));
        }
    };
    /**
     * @return {?}
     */
    LookupTipDirective.prototype.ngAfterViewInit = /**
     * @return {?}
     */
    function () { };
    // 获取快捷输入数据
    // 获取快捷输入数据
    /**
     * @private
     * @return {?}
     */
    LookupTipDirective.prototype.getQuickSelectedByLocaleId = 
    // 获取快捷输入数据
    /**
     * @private
     * @return {?}
     */
    function () {
        /** @type {?} */
        var localeid = this.localService.localeId;
        /** @type {?} */
        var personalConf = this.personalConfigService.getPersonalData();
        if (personalConf && personalConf.quickSelected) {
            /** @type {?} */
            var items = personalConf.quickSelected[localeid];
            if (items && items.length) {
                return items;
            }
        }
        return null;
    };
    /**
     * @return {?}
     */
    LookupTipDirective.prototype.creatPanel = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.selected = this.getQuickSelectedByLocaleId();
        if (this.tipPanel || !this.selected || (this.selected && this.selected.length === 0)) {
            return;
        }
        /** @type {?} */
        var pos = this.setPosition();
        /** @type {?} */
        var ul = this.renderer.createElement('ul');
        /** @type {?} */
        var path = this.personalConfigService.textField.split('.');
        this.selected.forEach((/**
         * @param {?} item
         * @param {?} index
         * @return {?}
         */
        function (item, index) {
            /** @type {?} */
            var li = _this.renderer.createElement('li');
            li.innerHTML = _this.find(item, _this.personalConfigService.textField);
            _this.renderer.setProperty(li, 'id', index);
            _this.renderer.appendChild(ul, li);
        }));
        /** @type {?} */
        var header = this.renderer.createElement('div');
        this.renderer.addClass(header, 'lookup-tip-header');
        header.innerHTML = this.tipText;
        this.tipPanel = this.renderer.createElement('div');
        this.renderer.appendChild(this.tipPanel, header);
        this.renderer.appendChild(this.tipPanel, ul);
        this.renderer.addClass(this.tipPanel, 'lookup-tip');
        this.renderer.setStyle(this.tipPanel, 'top', pos.top);
        this.renderer.setStyle(this.tipPanel, 'left', pos.left);
        this.renderer.setStyle(this.tipPanel, 'width', pos.width);
        this.renderer.appendChild(document.body, this.tipPanel);
        this.leaveEvent = this.renderer.listen(this.tipPanel, 'mouseleave', (/**
         * @return {?}
         */
        function () {
            _this.removePanel();
        }));
        this.enterEvent = this.renderer.listen(this.tipPanel, 'mouseenter', (/**
         * @return {?}
         */
        function () {
            _this.isInTipPanel = true;
        }));
        this.clickEvent = this.renderer.listen(this.tipPanel, 'click', (/**
         * @param {?} e
         * @return {?}
         */
        function (e) {
            if (e.target.nodeName === 'LI') {
                _this.selectItem(e.target.id);
            }
        }));
    };
    /**
     * @return {?}
     */
    LookupTipDirective.prototype.removePanel = /**
     * @return {?}
     */
    function () {
        if (document.body.contains(this.tipPanel)) {
            this.renderer.removeChild(document.body, this.tipPanel);
            this.tipPanel = null;
            this.isInTipPanel = false;
            this.leaveEvent();
            this.enterEvent();
            this.clickEvent();
        }
    };
    /**
     * @return {?}
     */
    LookupTipDirective.prototype.setPosition = /**
     * @return {?}
     */
    function () {
        var _a = this.inputRef.inputGroup.nativeElement.getBoundingClientRect(), left = _a.left, top = _a.top, width = _a.width, height = _a.height;
        return {
            left: left + 'px',
            top: top + height + 'px',
            width: width + 'px'
        };
    };
    /**
     * @param {?} val
     * @return {?}
     */
    LookupTipDirective.prototype.selectItem = /**
     * @param {?} val
     * @return {?}
     */
    function (val) {
        /** @type {?} */
        var item = this.selected.find((/**
         * @param {?} el
         * @param {?} index
         * @return {?}
         */
        function (el, index) { return Number(val) === index; }));
        this.removePanel();
        if (this.personalConfigService.singleSelect) {
            this.personalConfigService.selectItemObser$.next(item);
        }
        else {
            this.personalConfigService.selectItemObser$.next([item]);
        }
    };
    /**
     * @param {?} obj
     * @param {?} keys
     * @return {?}
     */
    LookupTipDirective.prototype.find = /**
     * @param {?} obj
     * @param {?} keys
     * @return {?}
     */
    function (obj, keys) {
        /** @type {?} */
        var keyArr = keys.split('.');
        /** @type {?} */
        var key = keyArr[0];
        /** @type {?} */
        var target = obj[key];
        if (target instanceof Object) {
            keyArr.shift();
            return this.find(target, keyArr.join('.'));
        }
        else {
            return target;
        }
    };
    LookupTipDirective.decorators = [
        { type: Directive, args: [{
                    selector: '[lookup-tip]'
                },] }
    ];
    /** @nocollapse */
    LookupTipDirective.ctorParameters = function () { return [
        { type: InputGroupComponent },
        { type: Renderer2 },
        { type: Injector }
    ]; };
    LookupTipDirective.propDecorators = {
        enableTip: [{ type: Input, args: ['lookup-tip',] }]
    };
    return LookupTipDirective;
}());
export { LookupTipDirective };
if (false) {
    /** @type {?} */
    LookupTipDirective.prototype.enableTip;
    /**
     * @type {?}
     * @private
     */
    LookupTipDirective.prototype.tipPanel;
    /**
     * @type {?}
     * @private
     */
    LookupTipDirective.prototype.leaveEvent;
    /**
     * @type {?}
     * @private
     */
    LookupTipDirective.prototype.enterEvent;
    /**
     * @type {?}
     * @private
     */
    LookupTipDirective.prototype.clickEvent;
    /**
     * @type {?}
     * @private
     */
    LookupTipDirective.prototype.isInTipPanel;
    /**
     * @type {?}
     * @private
     */
    LookupTipDirective.prototype.selected;
    /**
     * @type {?}
     * @private
     */
    LookupTipDirective.prototype.personalConfigService;
    /** @type {?} */
    LookupTipDirective.prototype.localService;
    /**
     * @type {?}
     * @private
     */
    LookupTipDirective.prototype.tipText;
    /**
     * @type {?}
     * @private
     */
    LookupTipDirective.prototype.inputRef;
    /**
     * @type {?}
     * @private
     */
    LookupTipDirective.prototype.renderer;
    /** @type {?} */
    LookupTipDirective.prototype.injector;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibG9va3VwLXRpcC5kaXJlY3RpdmUuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL3VpLWxvb2t1cC8iLCJzb3VyY2VzIjpbImxpYi9sb29rdXAtdGlwLmRpcmVjdGl2ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFFLFNBQVMsRUFBeUIsU0FBUyxFQUFFLFFBQVEsRUFBRSxLQUFLLEVBQUMsTUFBTSxlQUFlLENBQUM7QUFDNUYsT0FBTyxFQUFFLG1CQUFtQixFQUFFLE1BQU0sd0JBQXdCLENBQUM7QUFDN0QsT0FBTyxFQUFFLHFCQUFxQixFQUFFLE1BQU0saUNBQWlDLENBQUM7QUFDeEUsT0FBTyxFQUFFLEtBQUssRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ3ZDLE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUNsRDtJQWNJLDRCQUNZLFFBQTZCLEVBQzdCLFFBQW1CLEVBQ3BCLFFBQWtCO1FBRmpCLGFBQVEsR0FBUixRQUFRLENBQXFCO1FBQzdCLGFBQVEsR0FBUixRQUFRLENBQVc7UUFDcEIsYUFBUSxHQUFSLFFBQVEsQ0FBVTtRQWJSLGNBQVMsR0FBRyxLQUFLLENBQUM7UUFLL0IsaUJBQVksR0FBRyxLQUFLLENBQUM7UUFJckIsWUFBTyxHQUFHLFlBQVksQ0FBQztRQU0zQixJQUFJLENBQUMscUJBQXFCLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMscUJBQXFCLEVBQUUsSUFBSSxDQUFDLENBQUM7UUFDNUUsSUFBSSxDQUFDLFlBQVksR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxhQUFhLENBQUMsQ0FBQztJQUN6RCxDQUFDOzs7O0lBRUQscUNBQVE7OztJQUFSO1FBQUEsaUJBZ0JDO1FBZkcsSUFBSSxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUMsWUFBWSxDQUFDLFFBQVEsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO1FBQzVELElBQUksQ0FBQyxTQUFTLEdBQUcsS0FBSyxDQUFDLENBQUMsNkJBQTZCO1FBQ3JELElBQUksSUFBSSxDQUFDLFNBQVMsRUFBRTtZQUNoQixJQUFJLENBQUMsUUFBUSxDQUFDLGNBQWMsQ0FBQyxTQUFTOzs7O1lBQUMsVUFBQSxDQUFDO2dCQUNwQyxLQUFJLENBQUMsVUFBVSxFQUFFLENBQUM7WUFDdEIsQ0FBQyxFQUFDLENBQUM7WUFDSCxJQUFJLENBQUMsUUFBUSxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsU0FBUzs7OztZQUFDLFVBQUEsQ0FBQztnQkFDckQsSUFBSSxDQUFDLEtBQUksQ0FBQyxZQUFZLEVBQUU7b0JBQ3BCLEtBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQztpQkFDdEI7WUFDTCxDQUFDLEVBQUMsQ0FBQztZQUNILElBQUksQ0FBQyxRQUFRLENBQUMsV0FBVyxDQUFDLFNBQVM7Ozs7WUFBQyxVQUFBLENBQUM7Z0JBQ2pDLEtBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQztZQUN2QixDQUFDLEVBQUMsQ0FBQztTQUNOO0lBQ0wsQ0FBQzs7OztJQUVELDRDQUFlOzs7SUFBZixjQUEwQixDQUFDO0lBRTNCLFdBQVc7Ozs7OztJQUNILHVEQUEwQjs7Ozs7O0lBQWxDOztZQUNVLFFBQVEsR0FBRyxJQUFJLENBQUMsWUFBWSxDQUFDLFFBQVE7O1lBQ3JDLFlBQVksR0FBRyxJQUFJLENBQUMscUJBQXFCLENBQUMsZUFBZSxFQUFFO1FBQ2pFLElBQUksWUFBWSxJQUFJLFlBQVksQ0FBQyxhQUFhLEVBQUU7O2dCQUN0QyxLQUFLLEdBQUcsWUFBWSxDQUFDLGFBQWEsQ0FBQyxRQUFRLENBQUM7WUFDbEQsSUFBSSxLQUFLLElBQUksS0FBSyxDQUFDLE1BQU0sRUFBRTtnQkFDdkIsT0FBTyxLQUFLLENBQUM7YUFDaEI7U0FDSjtRQUVELE9BQU8sSUFBSSxDQUFDO0lBQ2hCLENBQUM7Ozs7SUFFRCx1Q0FBVTs7O0lBQVY7UUFBQSxpQkFvQ0M7UUFuQ0csSUFBSSxDQUFDLFFBQVEsR0FBRyxJQUFJLENBQUMsMEJBQTBCLEVBQUUsQ0FBQztRQUNsRCxJQUFJLElBQUksQ0FBQyxRQUFRLElBQUksQ0FBQyxJQUFJLENBQUMsUUFBUSxJQUFJLENBQUMsSUFBSSxDQUFDLFFBQVEsSUFBSSxJQUFJLENBQUMsUUFBUSxDQUFDLE1BQU0sS0FBSyxDQUFDLENBQUMsRUFBRTtZQUNsRixPQUFPO1NBQ1Y7O1lBQ0ssR0FBRyxHQUFHLElBQUksQ0FBQyxXQUFXLEVBQUU7O1lBQ3hCLEVBQUUsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUM7O1lBQ3RDLElBQUksR0FBRyxJQUFJLENBQUMscUJBQXFCLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUM7UUFDNUQsSUFBSSxDQUFDLFFBQVEsQ0FBQyxPQUFPOzs7OztRQUFDLFVBQUMsSUFBSSxFQUFFLEtBQUs7O2dCQUN4QixFQUFFLEdBQUcsS0FBSSxDQUFDLFFBQVEsQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDO1lBQzVDLEVBQUUsQ0FBQyxTQUFTLEdBQUcsS0FBSSxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsS0FBSSxDQUFDLHFCQUFxQixDQUFDLFNBQVMsQ0FBQyxDQUFDO1lBQ3JFLEtBQUksQ0FBQyxRQUFRLENBQUMsV0FBVyxDQUFDLEVBQUUsRUFBRSxJQUFJLEVBQUUsS0FBSyxDQUFDLENBQUM7WUFDM0MsS0FBSSxDQUFDLFFBQVEsQ0FBQyxXQUFXLENBQUMsRUFBRSxFQUFFLEVBQUUsQ0FBQyxDQUFDO1FBQ3RDLENBQUMsRUFBQyxDQUFDOztZQUNHLE1BQU0sR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLGFBQWEsQ0FBQyxLQUFLLENBQUM7UUFDakQsSUFBSSxDQUFDLFFBQVEsQ0FBQyxRQUFRLENBQUMsTUFBTSxFQUFFLG1CQUFtQixDQUFDLENBQUM7UUFDcEQsTUFBTSxDQUFDLFNBQVMsR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDO1FBQ2hDLElBQUksQ0FBQyxRQUFRLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxhQUFhLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDbkQsSUFBSSxDQUFDLFFBQVEsQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFBRSxNQUFNLENBQUMsQ0FBQztRQUNqRCxJQUFJLENBQUMsUUFBUSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsUUFBUSxFQUFFLEVBQUUsQ0FBQyxDQUFDO1FBQzdDLElBQUksQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxRQUFRLEVBQUUsWUFBWSxDQUFDLENBQUM7UUFDcEQsSUFBSSxDQUFDLFFBQVEsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFBRSxLQUFLLEVBQUUsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ3RELElBQUksQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxRQUFRLEVBQUUsTUFBTSxFQUFFLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUN4RCxJQUFJLENBQUMsUUFBUSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsUUFBUSxFQUFFLE9BQU8sRUFBRSxHQUFHLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDMUQsSUFBSSxDQUFDLFFBQVEsQ0FBQyxXQUFXLENBQUMsUUFBUSxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDeEQsSUFBSSxDQUFDLFVBQVUsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsUUFBUSxFQUFFLFlBQVk7OztRQUFFO1lBQ2hFLEtBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUN2QixDQUFDLEVBQUMsQ0FBQztRQUNILElBQUksQ0FBQyxVQUFVLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFBRSxZQUFZOzs7UUFBRTtZQUNoRSxLQUFJLENBQUMsWUFBWSxHQUFHLElBQUksQ0FBQztRQUM3QixDQUFDLEVBQUMsQ0FBQztRQUNILElBQUksQ0FBQyxVQUFVLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFBRSxPQUFPOzs7O1FBQUUsVUFBQyxDQUFDO1lBQzdELElBQUksQ0FBQyxDQUFDLE1BQU0sQ0FBQyxRQUFRLEtBQUssSUFBSSxFQUFFO2dCQUM1QixLQUFJLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDLENBQUM7YUFDaEM7UUFDTCxDQUFDLEVBQUMsQ0FBQztJQUNQLENBQUM7Ozs7SUFFRCx3Q0FBVzs7O0lBQVg7UUFDSSxJQUFJLFFBQVEsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsRUFBRTtZQUN2QyxJQUFJLENBQUMsUUFBUSxDQUFDLFdBQVcsQ0FBQyxRQUFRLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQztZQUN4RCxJQUFJLENBQUMsUUFBUSxHQUFHLElBQUksQ0FBQztZQUNyQixJQUFJLENBQUMsWUFBWSxHQUFHLEtBQUssQ0FBQztZQUMxQixJQUFJLENBQUMsVUFBVSxFQUFFLENBQUM7WUFDbEIsSUFBSSxDQUFDLFVBQVUsRUFBRSxDQUFDO1lBQ2xCLElBQUksQ0FBQyxVQUFVLEVBQUUsQ0FBQztTQUNyQjtJQUNMLENBQUM7Ozs7SUFFRCx3Q0FBVzs7O0lBQVg7UUFDVSxJQUFBLG1FQUE2RixFQUEzRixjQUFJLEVBQUUsWUFBRyxFQUFFLGdCQUFLLEVBQUUsa0JBQXlFO1FBQ25HLE9BQU87WUFDSCxJQUFJLEVBQUUsSUFBSSxHQUFHLElBQUk7WUFDakIsR0FBRyxFQUFFLEdBQUcsR0FBRyxNQUFNLEdBQUcsSUFBSTtZQUN4QixLQUFLLEVBQUUsS0FBSyxHQUFHLElBQUk7U0FDdEIsQ0FBQztJQUNOLENBQUM7Ozs7O0lBRUQsdUNBQVU7Ozs7SUFBVixVQUFXLEdBQUc7O1lBQ0osSUFBSSxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSTs7Ozs7UUFBQyxVQUFDLEVBQUUsRUFBRSxLQUFLLElBQUssT0FBQSxNQUFNLENBQUMsR0FBRyxDQUFDLEtBQUssS0FBSyxFQUFyQixDQUFxQixFQUFDO1FBQ3JFLElBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUNuQixJQUFJLElBQUksQ0FBQyxxQkFBcUIsQ0FBQyxZQUFZLEVBQUU7WUFDekMsSUFBSSxDQUFDLHFCQUFxQixDQUFDLGdCQUFnQixDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztTQUMxRDthQUFNO1lBQ0gsSUFBSSxDQUFDLHFCQUFxQixDQUFDLGdCQUFnQixDQUFDLElBQUksQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7U0FDNUQ7SUFDTCxDQUFDOzs7Ozs7SUFFRCxpQ0FBSTs7Ozs7SUFBSixVQUFLLEdBQUcsRUFBRSxJQUFJOztZQUNKLE1BQU0sR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQzs7WUFDeEIsR0FBRyxHQUFHLE1BQU0sQ0FBQyxDQUFDLENBQUM7O1lBQ2YsTUFBTSxHQUFHLEdBQUcsQ0FBQyxHQUFHLENBQUM7UUFDdkIsSUFBSSxNQUFNLFlBQVksTUFBTSxFQUFFO1lBQzFCLE1BQU0sQ0FBQyxLQUFLLEVBQUUsQ0FBQztZQUNmLE9BQU8sSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsTUFBTSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO1NBQzlDO2FBQU07WUFDSCxPQUFPLE1BQU0sQ0FBQztTQUNqQjtJQUNMLENBQUM7O2dCQXZJSixTQUFTLFNBQUM7b0JBQ1AsUUFBUSxFQUFFLGNBQWM7aUJBQzNCOzs7O2dCQU5RLG1CQUFtQjtnQkFEZSxTQUFTO2dCQUFFLFFBQVE7Ozs0QkFTekQsS0FBSyxTQUFDLFlBQVk7O0lBb0l2Qix5QkFBQztDQUFBLEFBeElELElBd0lDO1NBcklZLGtCQUFrQjs7O0lBQzNCLHVDQUF1Qzs7Ozs7SUFDdkMsc0NBQTBCOzs7OztJQUMxQix3Q0FBd0I7Ozs7O0lBQ3hCLHdDQUF3Qjs7Ozs7SUFDeEIsd0NBQXdCOzs7OztJQUN4QiwwQ0FBNkI7Ozs7O0lBQzdCLHNDQUF3Qjs7Ozs7SUFDeEIsbURBQXFEOztJQUNyRCwwQ0FBbUM7Ozs7O0lBQ25DLHFDQUErQjs7Ozs7SUFFM0Isc0NBQXFDOzs7OztJQUNyQyxzQ0FBMkI7O0lBQzNCLHNDQUF5QiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IERpcmVjdGl2ZSwgT25Jbml0LCBBZnRlclZpZXdJbml0LCBSZW5kZXJlcjIsIEluamVjdG9yLCBJbnB1dH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IElucHV0R3JvdXBDb21wb25lbnQgfSBmcm9tICdAZmFycmlzL3VpLWlucHV0LWdyb3VwJztcclxuaW1wb3J0IHsgUGVyc29uYWxDb25maWdTZXJ2aWNlIH0gZnJvbSAnLi9sb29rdXAtcHJlc29uYWxDb25maWcuc2VydmljZSc7XHJcbmltcG9ydCB7IGRlbGF5IH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xyXG5pbXBvcnQgeyBMb2NhbGVTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy91aS1sb2NhbGUnO1xyXG5ARGlyZWN0aXZlKHtcclxuICAgIHNlbGVjdG9yOiAnW2xvb2t1cC10aXBdJ1xyXG59KVxyXG5leHBvcnQgY2xhc3MgTG9va3VwVGlwRGlyZWN0aXZlIGltcGxlbWVudHMgT25Jbml0LCBBZnRlclZpZXdJbml0IHtcclxuICAgIEBJbnB1dCgnbG9va3VwLXRpcCcpIGVuYWJsZVRpcCA9IGZhbHNlO1xyXG4gICAgcHJpdmF0ZSB0aXBQYW5lbDogRWxlbWVudDtcclxuICAgIHByaXZhdGUgbGVhdmVFdmVudDogYW55O1xyXG4gICAgcHJpdmF0ZSBlbnRlckV2ZW50OiBhbnk7XHJcbiAgICBwcml2YXRlIGNsaWNrRXZlbnQ6IGFueTtcclxuICAgIHByaXZhdGUgaXNJblRpcFBhbmVsID0gZmFsc2U7XHJcbiAgICBwcml2YXRlIHNlbGVjdGVkOiBhbnlbXTtcclxuICAgIHByaXZhdGUgcGVyc29uYWxDb25maWdTZXJ2aWNlOiBQZXJzb25hbENvbmZpZ1NlcnZpY2U7XHJcbiAgICBwdWJsaWMgbG9jYWxTZXJ2aWNlOiBMb2NhbGVTZXJ2aWNlO1xyXG4gICAgcHJpdmF0ZSB0aXBUZXh0ID0gJ+aCqOimgeaJvueahOaYr+S4jeaYr+i/meS6m++8nyc7XHJcbiAgICBjb25zdHJ1Y3RvcihcclxuICAgICAgICBwcml2YXRlIGlucHV0UmVmOiBJbnB1dEdyb3VwQ29tcG9uZW50LFxyXG4gICAgICAgIHByaXZhdGUgcmVuZGVyZXI6IFJlbmRlcmVyMixcclxuICAgICAgICBwdWJsaWMgaW5qZWN0b3I6IEluamVjdG9yXHJcbiAgICApIHtcclxuICAgICAgICB0aGlzLnBlcnNvbmFsQ29uZmlnU2VydmljZSA9IHRoaXMuaW5qZWN0b3IuZ2V0KFBlcnNvbmFsQ29uZmlnU2VydmljZSwgbnVsbCk7XHJcbiAgICAgICAgdGhpcy5sb2NhbFNlcnZpY2UgPSB0aGlzLmluamVjdG9yLmdldChMb2NhbGVTZXJ2aWNlKTtcclxuICAgIH1cclxuXHJcbiAgICBuZ09uSW5pdCgpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLnRpcFRleHQgPSB0aGlzLmxvY2FsU2VydmljZS5nZXRWYWx1ZSgnbG9va3VwLnRpcFRleHQnKTtcclxuICAgICAgICB0aGlzLmVuYWJsZVRpcCA9IGZhbHNlOyAvLyDlm6DmlbDmja7mnYPpmZDpl67popjvvIzmraTlip/og73mmoLlsY/olL0gdGZzOiA0MDM5MjRcclxuICAgICAgICBpZiAodGhpcy5lbmFibGVUaXApIHtcclxuICAgICAgICAgICAgdGhpcy5pbnB1dFJlZi5pY29uTW91c2VFbnRlci5zdWJzY3JpYmUoZSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNyZWF0UGFuZWwoKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIHRoaXMuaW5wdXRSZWYuaWNvbk1vdXNlTGVhdmUucGlwZShkZWxheSgyMDApKS5zdWJzY3JpYmUoZSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuaXNJblRpcFBhbmVsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW1vdmVQYW5lbCgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgdGhpcy5pbnB1dFJlZi5jbGlja0hhbmRsZS5zdWJzY3JpYmUoZSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnJlbW92ZVBhbmVsKCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBuZ0FmdGVyVmlld0luaXQoKTogdm9pZCB7IH1cclxuXHJcbiAgICAvLyDojrflj5blv6vmjbfovpPlhaXmlbDmja5cclxuICAgIHByaXZhdGUgZ2V0UXVpY2tTZWxlY3RlZEJ5TG9jYWxlSWQoKSB7XHJcbiAgICAgICAgY29uc3QgbG9jYWxlaWQgPSB0aGlzLmxvY2FsU2VydmljZS5sb2NhbGVJZDtcclxuICAgICAgICBjb25zdCBwZXJzb25hbENvbmYgPSB0aGlzLnBlcnNvbmFsQ29uZmlnU2VydmljZS5nZXRQZXJzb25hbERhdGEoKTtcclxuICAgICAgICBpZiAocGVyc29uYWxDb25mICYmIHBlcnNvbmFsQ29uZi5xdWlja1NlbGVjdGVkKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGl0ZW1zID0gcGVyc29uYWxDb25mLnF1aWNrU2VsZWN0ZWRbbG9jYWxlaWRdO1xyXG4gICAgICAgICAgICBpZiAoaXRlbXMgJiYgaXRlbXMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gaXRlbXM7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfVxyXG5cclxuICAgIGNyZWF0UGFuZWwoKSB7XHJcbiAgICAgICAgdGhpcy5zZWxlY3RlZCA9IHRoaXMuZ2V0UXVpY2tTZWxlY3RlZEJ5TG9jYWxlSWQoKTtcclxuICAgICAgICBpZiAodGhpcy50aXBQYW5lbCB8fCAhdGhpcy5zZWxlY3RlZCB8fCAodGhpcy5zZWxlY3RlZCAmJiB0aGlzLnNlbGVjdGVkLmxlbmd0aCA9PT0gMCkpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCBwb3MgPSB0aGlzLnNldFBvc2l0aW9uKCk7XHJcbiAgICAgICAgY29uc3QgdWwgPSB0aGlzLnJlbmRlcmVyLmNyZWF0ZUVsZW1lbnQoJ3VsJyk7XHJcbiAgICAgICAgY29uc3QgcGF0aCA9IHRoaXMucGVyc29uYWxDb25maWdTZXJ2aWNlLnRleHRGaWVsZC5zcGxpdCgnLicpO1xyXG4gICAgICAgIHRoaXMuc2VsZWN0ZWQuZm9yRWFjaCgoaXRlbSwgaW5kZXgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgbGkgPSB0aGlzLnJlbmRlcmVyLmNyZWF0ZUVsZW1lbnQoJ2xpJyk7XHJcbiAgICAgICAgICAgIGxpLmlubmVySFRNTCA9IHRoaXMuZmluZChpdGVtLCB0aGlzLnBlcnNvbmFsQ29uZmlnU2VydmljZS50ZXh0RmllbGQpO1xyXG4gICAgICAgICAgICB0aGlzLnJlbmRlcmVyLnNldFByb3BlcnR5KGxpLCAnaWQnLCBpbmRleCk7XHJcbiAgICAgICAgICAgIHRoaXMucmVuZGVyZXIuYXBwZW5kQ2hpbGQodWwsIGxpKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICBjb25zdCBoZWFkZXIgPSB0aGlzLnJlbmRlcmVyLmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICAgICAgIHRoaXMucmVuZGVyZXIuYWRkQ2xhc3MoaGVhZGVyLCAnbG9va3VwLXRpcC1oZWFkZXInKTtcclxuICAgICAgICBoZWFkZXIuaW5uZXJIVE1MID0gdGhpcy50aXBUZXh0O1xyXG4gICAgICAgIHRoaXMudGlwUGFuZWwgPSB0aGlzLnJlbmRlcmVyLmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICAgICAgIHRoaXMucmVuZGVyZXIuYXBwZW5kQ2hpbGQodGhpcy50aXBQYW5lbCwgaGVhZGVyKTtcclxuICAgICAgICB0aGlzLnJlbmRlcmVyLmFwcGVuZENoaWxkKHRoaXMudGlwUGFuZWwsIHVsKTtcclxuICAgICAgICB0aGlzLnJlbmRlcmVyLmFkZENsYXNzKHRoaXMudGlwUGFuZWwsICdsb29rdXAtdGlwJyk7XHJcbiAgICAgICAgdGhpcy5yZW5kZXJlci5zZXRTdHlsZSh0aGlzLnRpcFBhbmVsLCAndG9wJywgcG9zLnRvcCk7XHJcbiAgICAgICAgdGhpcy5yZW5kZXJlci5zZXRTdHlsZSh0aGlzLnRpcFBhbmVsLCAnbGVmdCcsIHBvcy5sZWZ0KTtcclxuICAgICAgICB0aGlzLnJlbmRlcmVyLnNldFN0eWxlKHRoaXMudGlwUGFuZWwsICd3aWR0aCcsIHBvcy53aWR0aCk7XHJcbiAgICAgICAgdGhpcy5yZW5kZXJlci5hcHBlbmRDaGlsZChkb2N1bWVudC5ib2R5LCB0aGlzLnRpcFBhbmVsKTtcclxuICAgICAgICB0aGlzLmxlYXZlRXZlbnQgPSB0aGlzLnJlbmRlcmVyLmxpc3Rlbih0aGlzLnRpcFBhbmVsLCAnbW91c2VsZWF2ZScsICgpID0+IHtcclxuICAgICAgICAgICAgdGhpcy5yZW1vdmVQYW5lbCgpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHRoaXMuZW50ZXJFdmVudCA9IHRoaXMucmVuZGVyZXIubGlzdGVuKHRoaXMudGlwUGFuZWwsICdtb3VzZWVudGVyJywgKCkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLmlzSW5UaXBQYW5lbCA9IHRydWU7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgdGhpcy5jbGlja0V2ZW50ID0gdGhpcy5yZW5kZXJlci5saXN0ZW4odGhpcy50aXBQYW5lbCwgJ2NsaWNrJywgKGUpID0+IHtcclxuICAgICAgICAgICAgaWYgKGUudGFyZ2V0Lm5vZGVOYW1lID09PSAnTEknKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdEl0ZW0oZS50YXJnZXQuaWQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgcmVtb3ZlUGFuZWwoKSB7XHJcbiAgICAgICAgaWYgKGRvY3VtZW50LmJvZHkuY29udGFpbnModGhpcy50aXBQYW5lbCkpIHtcclxuICAgICAgICAgICAgdGhpcy5yZW5kZXJlci5yZW1vdmVDaGlsZChkb2N1bWVudC5ib2R5LCB0aGlzLnRpcFBhbmVsKTtcclxuICAgICAgICAgICAgdGhpcy50aXBQYW5lbCA9IG51bGw7XHJcbiAgICAgICAgICAgIHRoaXMuaXNJblRpcFBhbmVsID0gZmFsc2U7XHJcbiAgICAgICAgICAgIHRoaXMubGVhdmVFdmVudCgpO1xyXG4gICAgICAgICAgICB0aGlzLmVudGVyRXZlbnQoKTtcclxuICAgICAgICAgICAgdGhpcy5jbGlja0V2ZW50KCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHNldFBvc2l0aW9uKCkge1xyXG4gICAgICAgIGNvbnN0IHsgbGVmdCwgdG9wLCB3aWR0aCwgaGVpZ2h0IH0gPSB0aGlzLmlucHV0UmVmLmlucHV0R3JvdXAubmF0aXZlRWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBsZWZ0OiBsZWZ0ICsgJ3B4JyxcclxuICAgICAgICAgICAgdG9wOiB0b3AgKyBoZWlnaHQgKyAncHgnLFxyXG4gICAgICAgICAgICB3aWR0aDogd2lkdGggKyAncHgnXHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICBzZWxlY3RJdGVtKHZhbCkge1xyXG4gICAgICAgIGNvbnN0IGl0ZW0gPSB0aGlzLnNlbGVjdGVkLmZpbmQoKGVsLCBpbmRleCkgPT4gTnVtYmVyKHZhbCkgPT09IGluZGV4KTtcclxuICAgICAgICB0aGlzLnJlbW92ZVBhbmVsKCk7XHJcbiAgICAgICAgaWYgKHRoaXMucGVyc29uYWxDb25maWdTZXJ2aWNlLnNpbmdsZVNlbGVjdCkge1xyXG4gICAgICAgICAgICB0aGlzLnBlcnNvbmFsQ29uZmlnU2VydmljZS5zZWxlY3RJdGVtT2JzZXIkLm5leHQoaXRlbSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5wZXJzb25hbENvbmZpZ1NlcnZpY2Uuc2VsZWN0SXRlbU9ic2VyJC5uZXh0KFtpdGVtXSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGZpbmQob2JqLCBrZXlzKSB7XHJcbiAgICAgICAgY29uc3Qga2V5QXJyID0ga2V5cy5zcGxpdCgnLicpO1xyXG4gICAgICAgIGNvbnN0IGtleSA9IGtleUFyclswXTtcclxuICAgICAgICBjb25zdCB0YXJnZXQgPSBvYmpba2V5XTtcclxuICAgICAgICBpZiAodGFyZ2V0IGluc3RhbmNlb2YgT2JqZWN0KSB7XHJcbiAgICAgICAgICAgIGtleUFyci5zaGlmdCgpO1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5maW5kKHRhcmdldCwga2V5QXJyLmpvaW4oJy4nKSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRhcmdldDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuIl19
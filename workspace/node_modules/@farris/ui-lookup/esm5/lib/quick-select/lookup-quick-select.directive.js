/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { ComponentFactoryResolver, Directive, HostListener, Injector, Input, NgZone, Renderer2 } from '@angular/core';
import { reqAnimFrame } from '@farris/ui-common';
import { InputGroupComponent } from '@farris/ui-input-group';
import { debounceTime, filter, map } from 'rxjs/operators';
import { LookupGridDisplayType } from '../lookup-displaytype';
import { LookupGridComponent } from '../lookup-grid.component';
import { LookupQuickSelectPanelComponent } from './quick-select-panel.component';
var LookupQuickSelectDirective = /** @class */ (function () {
    function LookupQuickSelectDirective(injector, ngzone, render, inputRef, lookupRef, cfr) {
        this.injector = injector;
        this.ngzone = ngzone;
        this.render = render;
        this.inputRef = inputRef;
        this.lookupRef = lookupRef;
        this.cfr = cfr;
        this.data = [];
    }
    /**
     * @return {?}
     */
    LookupQuickSelectDirective.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
    };
    /**
     * @return {?}
     */
    LookupQuickSelectDirective.prototype.ngAfterViewInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        if (this.options && this.options.enable) {
            this.inputRef.inputClick.subscribe((/**
             * @param {?} e
             * @return {?}
             */
            function (e) {
                e.stopPropagation();
                if (!_this.panelElement) {
                    // 执行帮助前
                    _this.lookupRef.dictPicking({
                        instance: _this,
                    }).subscribe((/**
                     * @param {?} pr
                     * @return {?}
                     */
                    function (pr) {
                        if (_this.lookupRef.displayType === LookupGridDisplayType.TreeList || (!_this.lookupRef.singleSelect && _this.lookupRef.viewType === 'text')) {
                            return;
                        }
                        var _a = _this.lookupRef.dialogMgr.checkDictPickingResult(pr), show = _a.show, customData = _a.customData, message = _a.message;
                        _this.lookupRef.customData = customData;
                        if (show) {
                            _this.createDataPanel();
                        }
                        else {
                            if (message) {
                                _this.lookupRef.notifyService.warning(message);
                            }
                        }
                    }));
                }
            }));
            this.inputRef.valueChange.pipe(debounceTime(200)).subscribe((/**
             * @param {?} val
             * @return {?}
             */
            function (val) {
                _this.lookupRef.dictPicking({ instance: _this }).subscribe((/**
                 * @param {?} pr
                 * @return {?}
                 */
                function (pr) {
                    if (_this.lookupRef.displayType === LookupGridDisplayType.TreeList || (!_this.lookupRef.singleSelect && _this.lookupRef.viewType === 'text')) {
                        return;
                    }
                    var _a = _this.lookupRef.dialogMgr.checkDictPickingResult(pr), show = _a.show, customData = _a.customData, message = _a.message;
                    _this.lookupRef.customData = customData;
                    if (!_this.panelElement) {
                        _this.createDataPanel();
                    }
                    else {
                        _this.panelElement.style.overflow = 'hidden';
                        _this.setPanelPosition(false);
                        _this.loadData();
                    }
                }));
            }));
            this.inputRef.keydownHandle.pipe(filter((/**
             * @param {?} event
             * @return {?}
             */
            function (event) {
                return event.key === 'Escape' || event.key === 'Tab' || event.key === 'F2';
            }))).subscribe((/**
             * @param {?} e
             * @return {?}
             */
            function (e) {
                _this.hide(e);
            }));
        }
    };
    /**
     * @return {?}
     */
    LookupQuickSelectDirective.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        this.lookupRef.overLayService.destory(this.lookupRef.el.nativeElement);
    };
    /**
     * @private
     * @return {?}
     */
    LookupQuickSelectDirective.prototype.removePanelElement = /**
     * @private
     * @return {?}
     */
    function () {
        document.body.removeChild(this.panelElement);
        this.panelElement = null;
    };
    /**
     * @private
     * @return {?}
     */
    LookupQuickSelectDirective.prototype.clearSearchValue = /**
     * @private
     * @return {?}
     */
    function () {
        this.lookupRef._searchState = {
            field: '*',
            //"*",
            value: ''
        };
    };
    /**
     * @param {?=} e
     * @param {?=} isMoreClick
     * @return {?}
     */
    LookupQuickSelectDirective.prototype.hide = /**
     * @param {?=} e
     * @param {?=} isMoreClick
     * @return {?}
     */
    function (e, isMoreClick) {
        var _this = this;
        if (isMoreClick === void 0) { isMoreClick = false; }
        reqAnimFrame((/**
         * @return {?}
         */
        function () {
            if (_this.panelElement) {
                if (e && (e.type === 'mousewheel' || e.type === 'wheel')) {
                    _this.removePanelElement();
                }
                else {
                    _this.panelElement.classList.remove('f-area-show');
                    setTimeout((/**
                     * @return {?}
                     */
                    function () {
                        _this.removePanelElement();
                    }), 120);
                }
                if (!_this.lookupRef) {
                    return;
                }
                // tfs 579056
                if (_this.lookupRef.overLayService) {
                    _this.lookupRef.overLayService.destory(_this.lookupRef.el.nativeElement);
                }
                if (isMoreClick) {
                    return;
                }
                if (_this.lookupRef.tagInput) {
                    // this.lookupRef.tagInput.value = '';
                    _this.inputRef.value = '';
                    _this.clearSearchValue();
                }
                if (e && (e.key === 'F2' || _this.lookupRef.el.nativeElement.contains(e.target))) {
                    if (_this.data && _this.data.length) {
                        return;
                    }
                    else {
                        _this.clearSearchValue();
                    }
                }
                if (!_this.lookupRef.nosearch && _this.lookupRef.displayText !== _this.lookupRef.originalText) {
                    _this.lookupRef.onChanges(_this.lookupRef.originalText);
                }
            }
        }));
    };
    /**
     * @private
     * @param {?=} updateTopPosition
     * @return {?}
     */
    LookupQuickSelectDirective.prototype.setPanelPosition = /**
     * @private
     * @param {?=} updateTopPosition
     * @return {?}
     */
    function (updateTopPosition) {
        if (updateTopPosition === void 0) { updateTopPosition = true; }
        if (this.panelElement) {
            var _a = this.getPanelSize(), width = _a.width, left = _a.left, top_1 = _a.top, height = _a.height;
            this.panelElement.style.width = width + "px";
            this.panelElement.style.maxHeight = height + "px";
            if (updateTopPosition) {
                this.panelElement.style.top = top_1 + "px";
            }
            this.panelElement.style.left = left + "px";
            this.panelElement.style.zIndex = '10001';
        }
    };
    /**
     * @private
     * @return {?}
     */
    LookupQuickSelectDirective.prototype.createDataPanel = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        if (this.lookupRef.changeDetector['destroyed']) {
            this.panelElement && this.removePanelElement();
            return;
        }
        this.panelElement = document.createElement('div');
        this.panelElement.classList.add('overlay-pane', 'f-lookup_quick-panel', 'f-area-hide');
        document.body.appendChild(this.panelElement);
        this.setPanelPosition();
        this.panelElement.style.overflow = 'hidden';
        // this.panelElement.style.height = 'auto';
        // 创建数据展示组件
        /** @type {?} */
        var cmpFact = this.cfr.resolveComponentFactory(LookupQuickSelectPanelComponent);
        this.cmpRef = cmpFact.create(this.injector);
        this.cmpRef.instance.showMore = this.options.showMore;
        this.cmpRef.instance.textField = this.lookupRef.textField;
        this.cmpRef.instance.formatter = this.options.formatter;
        this.cmpRef.instance.maxItems = this.options.showItemsCount;
        // cmpRef.location.nativeElement.classList.add('farris-main-area');
        this.panelElement.appendChild(this.cmpRef.location.nativeElement);
        this.lookupRef.selectionMgr.initDisplayValue();
        this.cmpRef.changeDetectorRef.detectChanges();
        // more clicked 打开帮助窗口
        this.cmpRef.instance.moreClcik.subscribe((/**
         * @param {?} e
         * @return {?}
         */
        function (e) {
            _this.hide(e, true);
            _this.lookupRef.showDialog();
        }));
        this.cmpRef.instance.itemClick.subscribe((/**
         * @param {?} e
         * @return {?}
         */
        function (e) {
            var data = e.data;
            _this.selectItem(data);
        }));
        // 注册鼠标滚轮，点击事件，用于隐藏Panel
        this.lookupRef.overLayService.registerMouseEvent(this.lookupRef.el.nativeElement, (/**
         * @param {?} e
         * @return {?}
         */
        function (e) {
            if (!_this.panelElement || e.target['closest']('.f-lookup_quick-panel')) {
                return;
            }
            if (_this.lookupRef.inputGroup && _this.lookupRef.inputGroup.textbox.nativeElement === e.target) {
                return false;
            }
            if (_this.lookupRef.tagInput && _this.lookupRef.tagInput.textbox.nativeElement === e.target) {
                return false;
            }
            if (_this.cmpRef) {
                _this.cmpRef.destroy();
                _this.cmpRef = null;
            }
            _this.clearSearchValue();
            _this.hide(e);
        }));
        this.panelElement.classList.add('f-area-show');
        this.loadData();
    };
    /**
     * @private
     * @param {?} data
     * @return {?}
     */
    LookupQuickSelectDirective.prototype.selectItem = /**
     * @private
     * @param {?} data
     * @return {?}
     */
    function (data) {
        var _this = this;
        if (!data) {
            return;
        }
        if (this.lookupRef.viewType === 'tag') {
            /** @type {?} */
            var isSelect = this.lookupRef.selections.find((/**
             * @param {?} n
             * @return {?}
             */
            function (n) { return n[_this.lookupRef.idField] === data[_this.lookupRef.idField]; }));
            if (!isSelect) {
                /** @type {?} */
                var selectItems = tslib_1.__spread(this.lookupRef.selections, [data]);
                this.lookupRef.selectItem(selectItems);
                this.lookupRef.lookupSelectionSer.loadSelections(selectItems);
            }
        }
        else {
            this.lookupRef.selectItem(data);
        }
        this.hide();
    };
    /**
     * @private
     * @return {?}
     */
    LookupQuickSelectDirective.prototype.calculationPanelHeight = /**
     * @private
     * @return {?}
     */
    function () {
        return this.options.showItemsCount * 30 + (this.options.showMore ? 50 : 0) + (this.options.footerHeight || 0) + 5;
    };
    /**
     * @private
     * @return {?}
     */
    LookupQuickSelectDirective.prototype.getInputSizeInfo = /**
     * @private
     * @return {?}
     */
    function () {
        /** @type {?} */
        var el = this.lookupRef.viewType === 'text' ? this.inputRef.inputGroup : this.lookupRef.tagbox;
        return el.nativeElement.getBoundingClientRect();
    };
    /**
     * @private
     * @return {?}
     */
    LookupQuickSelectDirective.prototype.getPanelSize = /**
     * @private
     * @return {?}
     */
    function () {
        var _a = this.getInputSizeInfo(), width = _a.width, height = _a.height, top = _a.top, left = _a.left;
        /** @type {?} */
        var bottom = window.innerHeight - height - top;
        /** @type {?} */
        var panelHeight = this.calculationPanelHeight();
        /** @type {?} */
        var h = top > bottom ? top : bottom;
        if (bottom > panelHeight) {
            top = top + height;
            // 面板由上向下展开
            this.panelElement.style.transformOrigin = '100% top';
        }
        else {
            if (top > bottom) {
                if (h < panelHeight) {
                    panelHeight = h - 10;
                    top = 10;
                }
                else {
                    top = top - parseInt('' + panelHeight, 10) - 5;
                }
                // 面板由下向上展开
                this.panelElement.style.transformOrigin = '100% bottom';
            }
            else {
                if (h < panelHeight) {
                    panelHeight = h - 10;
                }
                top = top + height;
            }
        }
        /** @type {?} */
        var minWidth = this.options.minWidth || 200;
        /** @type {?} */
        var _width = width < minWidth ? minWidth : width;
        if (window.innerWidth - left < _width) {
            left = left + width - _width;
        }
        return { width: _width, top: top, height: panelHeight, left: left };
    };
    /**
     * @private
     * @return {?}
     */
    LookupQuickSelectDirective.prototype.getData = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        /** @type {?} */
        var p = {
            pageInfo: {
                pageSize: this.options.showItemsCount,
                pageIndex: 1,
            },
        };
        /** @type {?} */
        var t = "all";
        if (this.lookupRef.isTextChange) {
            this.lookupRef._searchState = {
                field: this.lookupRef.textField,
                //"*",
                value: this.lookupRef.displayText
            };
            p['search'] = this.lookupRef._searchState;
            t = 'search';
        }
        else {
            this.lookupRef._searchState = null;
        }
        if (this.lookupRef.viewType === 'tag') {
            if (this.lookupRef.tagInput.value !== '') {
                this.lookupRef._searchState = {
                    field: this.lookupRef.textField,
                    //"*",
                    value: this.lookupRef.tagInput.value
                };
                p['search'] = this.lookupRef._searchState;
                t = 'search';
            }
            else {
                this.lookupRef._searchState = null;
            }
            /** @type {?} */
            var vals = this.lookupRef.selectionMgr.getSelectedIds();
            if (vals && vals.length) {
                p["selectedInfo"] = {
                    selected: true,
                    selectedIds: vals,
                };
            }
        }
        return this.lookupRef.httpMgr.lookupRequest(p, t, true).pipe(map((/**
         * @param {?} restData
         * @return {?}
         */
        function (restData) {
            /** @type {?} */
            var _items = _this.lookupRef.items || [];
            if (restData) {
                if (_this.lookupRef.viewType === 'tag') {
                    _this.lookupRef.lookupSelectionSer.loadSelections(restData["selectedData"] || []);
                }
                _items = restData.items || [];
                if (restData.displayType.toLowerCase().indexOf('treelist') > -1 && _items.length && _items[0].data) {
                    _items = _items.map((/**
                     * @param {?} n
                     * @return {?}
                     */
                    function (n) { return n.data; }));
                }
                // return _items.slice(0, this.options.showItemsCount);
            }
            else {
                if (_this.lookupRef.displayText && _this.lookupRef.isTextChange) {
                    if (restData.displayType.toLowerCase().indexOf('treelist') > -1 && _items.length && _items[0].data) {
                        _items = _items.map((/**
                         * @param {?} n
                         * @return {?}
                         */
                        function (n) { return n.data; }));
                    }
                    /** @type {?} */
                    var items = _items.filter((/**
                     * @param {?} n
                     * @return {?}
                     */
                    function (n) {
                        return n[_this.lookupRef.textField].indexOf(_this.lookupRef.displayText) > -1;
                    })).slice(0, _this.options.showItemsCount);
                    _items = items;
                    // return _items.slice(0, this.options.showItemsCount);
                }
            }
            return _items.slice(0, _this.options.showItemsCount);
        })));
    };
    /**
     * @private
     * @return {?}
     */
    LookupQuickSelectDirective.prototype.loadData = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        /** @type {?} */
        var loadingRef = this.lookupRef.loadingService.show({ container: this.panelElement });
        this.getData().subscribe((/**
         * @param {?} data
         * @return {?}
         */
        function (data) {
            loadingRef.close();
            if (_this.cmpRef && _this.cmpRef.instance) {
                _this.cmpRef.instance.loadData(data);
                if (data.length < _this.options.showItemsCount) {
                    // let newHeight = data.length * 30 + (this.options.showMore ? 50: 0) + (this.options.footerHeight||0) + 5;
                    _this.data = data;
                    /** @type {?} */
                    var newHeight = _this.cmpRef.instance.itemsContainer.nativeElement.querySelector('ul').offsetHeight + 10;
                    if (!data || !data.length) {
                        newHeight = 55;
                    }
                    _this.cmpRef.instance.itemsContainer.nativeElement.style.height = newHeight + "px";
                    if (_this.panelElement) {
                        if (_this.panelElement.style.transformOrigin.indexOf('bottom') > -1) {
                            _this.panelElement.style.top = _this.getInputSizeInfo().top - newHeight - 5 + "px";
                        }
                        _this.panelElement.style.height = 'auto';
                    }
                }
                else {
                    _this.setPanelPosition();
                    _this.cmpRef.instance.itemsContainer.nativeElement.style.height = '100%';
                    if (_this.panelElement) {
                        _this.render.removeStyle(_this.panelElement, 'height');
                    }
                }
                if ((_this.lookupRef.isTextChange || (_this.lookupRef.tagInput && _this.lookupRef.tagInput.value !== '') ||
                    (_this.lookupRef.inputGroup && _this.lookupRef.inputGroup.value !== '' && _this.lookupRef.isTextChange)) && data && data.length) {
                    _this.cmpRef.instance.setActiveItem(0);
                }
                _this.panelElement.style.overflow = 'auto';
            }
        }));
    };
    /**
     * @param {?} $event
     * @return {?}
     */
    LookupQuickSelectDirective.prototype.registerKeyboardEvent = /**
     * @param {?} $event
     * @return {?}
     */
    function ($event) {
        var _this = this;
        if (!this.lookupRef.singleSelect && this.lookupRef.viewType !== 'tag') {
            return;
        }
        /** @type {?} */
        var rows = [];
        if (this.cmpRef) {
            rows = this.cmpRef.instance.data;
        }
        if (!rows || !rows.length) {
            return;
        }
        if ($event.code === 'ArrowUp' || $event.code === 'ArrowDown') {
            $event.preventDefault();
            $event.stopPropagation();
        }
        if ($event.code === 'Backspace' && this.lookupRef.viewType === 'tag' &&
            this.lookupRef.selections && this.lookupRef.selections.length &&
            this.lookupRef.tagInput && !this.lookupRef.tagInput.value && this.lookupRef.quickSelect.enableBackspace) {
            $event.preventDefault();
            $event.stopPropagation();
            /** @type {?} */
            var newdata = this.lookupRef.selections.slice(0, this.lookupRef.selections.length - 1);
            if (!newdata || !newdata.length) {
                this.lookupRef.clearValue(true);
            }
            else {
                this.lookupRef.selectItem(newdata);
            }
            this.lookupRef.lookupSelectionSer.loadSelections(newdata);
            this.setPanelPosition();
            return;
        }
        /** @type {?} */
        var idx = this.cmpRef.instance.activeIndex;
        /** @type {?} */
        var activeIndex = idx;
        /** @type {?} */
        var setActiveItem = (/**
         * @param {?} index
         * @return {?}
         */
        function (index) {
            activeIndex = index;
            _this.cmpRef.instance.setActiveItem(index);
        });
        if ($event.code === 'ArrowUp') { // up
            if (idx > -1) {
                /** @type {?} */
                var prevIdx = idx - 1;
                if (prevIdx < 0) {
                    prevIdx = rows.length - 1;
                }
                setActiveItem(prevIdx);
            }
            else {
                setActiveItem(rows.length - 1);
            }
        }
        if ($event.code === 'ArrowDown') { // down
            // down
            /** @type {?} */
            var nextIdx = idx + 1;
            if (nextIdx >= rows.length) {
                nextIdx = 0;
            }
            setActiveItem(nextIdx);
        }
        if ($event.key === 'Enter') {
            if (rows && rows.length && this.panelElement) {
                /** @type {?} */
                var data = rows[idx];
                this.selectItem(data);
            }
            else {
                this.inputRef.inputClick.emit($event);
            }
        }
    };
    LookupQuickSelectDirective.decorators = [
        { type: Directive, args: [{ selector: '[quick-select]' },] }
    ];
    /** @nocollapse */
    LookupQuickSelectDirective.ctorParameters = function () { return [
        { type: Injector },
        { type: NgZone },
        { type: Renderer2 },
        { type: InputGroupComponent },
        { type: LookupGridComponent },
        { type: ComponentFactoryResolver }
    ]; };
    LookupQuickSelectDirective.propDecorators = {
        options: [{ type: Input, args: ['quick-select',] }],
        registerKeyboardEvent: [{ type: HostListener, args: ['keydown', ['$event'],] }]
    };
    return LookupQuickSelectDirective;
}());
export { LookupQuickSelectDirective };
if (false) {
    /** @type {?} */
    LookupQuickSelectDirective.prototype.options;
    /**
     * @type {?}
     * @private
     */
    LookupQuickSelectDirective.prototype.panelElement;
    /**
     * @type {?}
     * @private
     */
    LookupQuickSelectDirective.prototype.cmpRef;
    /**
     * @type {?}
     * @private
     */
    LookupQuickSelectDirective.prototype.data;
    /**
     * @type {?}
     * @private
     */
    LookupQuickSelectDirective.prototype.injector;
    /**
     * @type {?}
     * @private
     */
    LookupQuickSelectDirective.prototype.ngzone;
    /**
     * @type {?}
     * @private
     */
    LookupQuickSelectDirective.prototype.render;
    /**
     * @type {?}
     * @private
     */
    LookupQuickSelectDirective.prototype.inputRef;
    /**
     * @type {?}
     * @private
     */
    LookupQuickSelectDirective.prototype.lookupRef;
    /**
     * @type {?}
     * @private
     */
    LookupQuickSelectDirective.prototype.cfr;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibG9va3VwLXF1aWNrLXNlbGVjdC5kaXJlY3RpdmUuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL3VpLWxvb2t1cC8iLCJzb3VyY2VzIjpbImxpYi9xdWljay1zZWxlY3QvbG9va3VwLXF1aWNrLXNlbGVjdC5kaXJlY3RpdmUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQWlCLHdCQUF3QixFQUFnQixTQUFTLEVBQWMsWUFBWSxFQUFFLFFBQVEsRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUErQixTQUFTLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDNUwsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBQ2pELE9BQU8sRUFBRSxtQkFBbUIsRUFBRSxNQUFNLHdCQUF3QixDQUFDO0FBRTdELE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxFQUFFLEdBQUcsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBRTNELE9BQU8sRUFBRSxxQkFBcUIsRUFBcUIsTUFBTSx1QkFBdUIsQ0FBQztBQUVqRixPQUFPLEVBQUUsbUJBQW1CLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQztBQUMvRCxPQUFPLEVBQUUsK0JBQStCLEVBQUUsTUFBTSxnQ0FBZ0MsQ0FBQztBQUVqRjtJQVFJLG9DQUFvQixRQUFrQixFQUFVLE1BQWMsRUFBVSxNQUFpQixFQUFVLFFBQTZCLEVBQVUsU0FBOEIsRUFDNUosR0FBNkI7UUFEckIsYUFBUSxHQUFSLFFBQVEsQ0FBVTtRQUFVLFdBQU0sR0FBTixNQUFNLENBQVE7UUFBVSxXQUFNLEdBQU4sTUFBTSxDQUFXO1FBQVUsYUFBUSxHQUFSLFFBQVEsQ0FBcUI7UUFBVSxjQUFTLEdBQVQsU0FBUyxDQUFxQjtRQUM1SixRQUFHLEdBQUgsR0FBRyxDQUEwQjtRQUhqQyxTQUFJLEdBQUcsRUFBRSxDQUFDO0lBSWxCLENBQUM7Ozs7SUFFRCw2Q0FBUTs7O0lBQVI7SUFFQSxDQUFDOzs7O0lBRUQsb0RBQWU7OztJQUFm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QUFFLE9BQU87OztnQkFDbEMsT0FBTyxHQUFHLEdBQUcsR0FBRyxDQUFDO1lBQ3JCLElBQUksT0FBTyxJQUFJLElBQUksQ0FBQyxNQUFNLEVBQUU7Z0JBQ3hCLE9BQU8sR0FBRyxDQUFDLENBQUM7YUFDZjtZQUVELGFBQWEsQ0FBQyxPQUFPLENBQUMsQ0FBQztTQUMxQjtRQUVELElBQUcsTUFBTSxDQUFDLEdBQUcsS0FBSyxPQUFPLEVBQUU7WUFDdkIsSUFBSSxJQUFJLElBQUksSUFBSSxDQUFDLE1BQU0sSUFBSSxJQUFJLENBQUMsWUFBWSxFQUFFOztvQkFDcEMsSUFBSSxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUM7Z0JBQ3RCLElBQUksQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLENBQUM7YUFDekI7aUJBQU07Z0JBQ0gsSUFBSSxDQUFDLFFBQVEsQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO2FBQ3pDO1NBQ0o7SUFDTCxDQUFDOztnQkFqZUosU0FBUyxTQUFDLEVBQUUsUUFBUSxFQUFFLGdCQUFnQixFQUFDOzs7O2dCQVg2RCxRQUFRO2dCQUFTLE1BQU07Z0JBQStCLFNBQVM7Z0JBRTNKLG1CQUFtQjtnQkFNbkIsbUJBQW1CO2dCQVJKLHdCQUF3Qjs7OzBCQWEzQyxLQUFLLFNBQUMsY0FBYzt3Q0FvWnBCLFlBQVksU0FBQyxTQUFTLEVBQUUsQ0FBQyxRQUFRLENBQUM7O0lBNEV2QyxpQ0FBQztDQUFBLEFBbGVELElBa2VDO1NBamVZLDBCQUEwQjs7O0lBQ25DLDZDQUFrRDs7Ozs7SUFDbEQsa0RBQWtDOzs7OztJQUNsQyw0Q0FBOEQ7Ozs7O0lBRTlELDBDQUFrQjs7Ozs7SUFFTiw4Q0FBMEI7Ozs7O0lBQUUsNENBQXNCOzs7OztJQUFFLDRDQUF5Qjs7Ozs7SUFBRSw4Q0FBcUM7Ozs7O0lBQUUsK0NBQXNDOzs7OztJQUNwSyx5Q0FBcUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBZnRlclZpZXdJbml0LCBDb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIsIENvbXBvbmVudFJlZiwgRGlyZWN0aXZlLCBFbGVtZW50UmVmLCBIb3N0TGlzdGVuZXIsIEluamVjdG9yLCBJbnB1dCwgTmdab25lLCBPbkRlc3Ryb3ksIE9uSW5pdCwgT3B0aW9uYWwsIFJlbmRlcmVyMiB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyByZXFBbmltRnJhbWUgfSBmcm9tICdAZmFycmlzL3VpLWNvbW1vbic7XHJcbmltcG9ydCB7IElucHV0R3JvdXBDb21wb25lbnQgfSBmcm9tICdAZmFycmlzL3VpLWlucHV0LWdyb3VwJztcclxuaW1wb3J0IHsgZnJvbSwgZnJvbUV2ZW50LCBPYnNlcnZhYmxlIH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7IGRlYm91bmNlVGltZSwgZmlsdGVyLCBtYXAgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XHJcblxyXG5pbXBvcnQgeyBMb29rdXBHcmlkRGlzcGxheVR5cGUsIFF1aWNrU2VsZWN0T3B0aW9uIH0gZnJvbSAnLi4vbG9va3VwLWRpc3BsYXl0eXBlJztcclxuaW1wb3J0IHsgRGlzcGxheUluZm8sIExPQURfREFUQV9UWVBFLCBMb29rdXBHcmlkUmVzdWx0LCBQaWNraW5nUmVzdWx0IH0gZnJvbSAnLi4vbG9va3VwLWdyaWQtb3B0aW9ucyc7XHJcbmltcG9ydCB7IExvb2t1cEdyaWRDb21wb25lbnQgfSBmcm9tICcuLi9sb29rdXAtZ3JpZC5jb21wb25lbnQnO1xyXG5pbXBvcnQgeyBMb29rdXBRdWlja1NlbGVjdFBhbmVsQ29tcG9uZW50IH0gZnJvbSAnLi9xdWljay1zZWxlY3QtcGFuZWwuY29tcG9uZW50JztcclxuXHJcbkBEaXJlY3RpdmUoeyBzZWxlY3RvcjogJ1txdWljay1zZWxlY3RdJ30pXHJcbmV4cG9ydCBjbGFzcyBMb29rdXBRdWlja1NlbGVjdERpcmVjdGl2ZSBpbXBsZW1lbnRzIE9uSW5pdCwgQWZ0ZXJWaWV3SW5pdCwgT25EZXN0cm95IHtcclxuICAgIEBJbnB1dCgncXVpY2stc2VsZWN0Jykgb3B0aW9uczogUXVpY2tTZWxlY3RPcHRpb247XHJcbiAgICBwcml2YXRlIHBhbmVsRWxlbWVudDogSFRNTEVsZW1lbnQ7XHJcbiAgICBwcml2YXRlIGNtcFJlZjogQ29tcG9uZW50UmVmPExvb2t1cFF1aWNrU2VsZWN0UGFuZWxDb21wb25lbnQ+O1xyXG5cclxuICAgIHByaXZhdGUgZGF0YSA9IFtdO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgaW5qZWN0b3I6IEluamVjdG9yLCBwcml2YXRlIG5nem9uZTogTmdab25lLCBwcml2YXRlIHJlbmRlcjogUmVuZGVyZXIyLCBwcml2YXRlIGlucHV0UmVmOiBJbnB1dEdyb3VwQ29tcG9uZW50LCBwcml2YXRlIGxvb2t1cFJlZjogTG9va3VwR3JpZENvbXBvbmVudCxcclxuICAgICAgICBwcml2YXRlIGNmcjogQ29tcG9uZW50RmFjdG9yeVJlc29sdmVyKSB7XHJcbiAgICB9XHJcblxyXG4gICAgbmdPbkluaXQoKTogdm9pZCB7XHJcbiAgICAgICAgXHJcbiAgICB9XHJcblxyXG4gICAgbmdBZnRlclZpZXdJbml0KCk6IHZvaWQge1xyXG4gICAgICAgIGlmICh0aGlzLm9wdGlvbnMgJiYgdGhpcy5vcHRpb25zLmVuYWJsZSkge1xyXG4gICAgICAgICAgICB0aGlzLmlucHV0UmVmLmlucHV0Q2xpY2suc3Vic2NyaWJlKChlOiBNb3VzZUV2ZW50KSA9PiB7XHJcbiAgICAgICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLnBhbmVsRWxlbWVudCkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIOaJp+ihjOW4ruWKqeWJjVxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMubG9va3VwUmVmLmRpY3RQaWNraW5nKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaW5zdGFuY2U6IHRoaXMsXHJcbiAgICAgICAgICAgICAgICAgICAgfSkuc3Vic2NyaWJlKChwcjogUGlja2luZ1Jlc3VsdCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5sb29rdXBSZWYuZGlzcGxheVR5cGUgPT09IExvb2t1cEdyaWREaXNwbGF5VHlwZS5UcmVlTGlzdCB8fCAoIXRoaXMubG9va3VwUmVmLnNpbmdsZVNlbGVjdCAmJiB0aGlzLmxvb2t1cFJlZi52aWV3VHlwZSA9PT0gJ3RleHQnKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHsgc2hvdywgY3VzdG9tRGF0YSwgbWVzc2FnZSB9ID0gdGhpcy5sb29rdXBSZWYuZGlhbG9nTWdyLmNoZWNrRGljdFBpY2tpbmdSZXN1bHQocHIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxvb2t1cFJlZi5jdXN0b21EYXRhID0gY3VzdG9tRGF0YTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNob3cpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY3JlYXRlRGF0YVBhbmVsKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobWVzc2FnZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubG9va3VwUmVmLm5vdGlmeVNlcnZpY2Uud2FybmluZyhtZXNzYWdlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5pbnB1dFJlZi52YWx1ZUNoYW5nZS5waXBlKFxyXG4gICAgICAgICAgICAgICAgZGVib3VuY2VUaW1lKDIwMClcclxuICAgICAgICAgICAgKS5zdWJzY3JpYmUoKHZhbDogc3RyaW5nKSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmxvb2t1cFJlZi5kaWN0UGlja2luZyh7aW5zdGFuY2U6IHRoaXN9KS5zdWJzY3JpYmUoKHByOiBQaWNraW5nUmVzdWx0KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMubG9va3VwUmVmLmRpc3BsYXlUeXBlID09PSBMb29rdXBHcmlkRGlzcGxheVR5cGUuVHJlZUxpc3QgfHwgKCF0aGlzLmxvb2t1cFJlZi5zaW5nbGVTZWxlY3QgJiYgdGhpcy5sb29rdXBSZWYudmlld1R5cGUgPT09ICd0ZXh0JykpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBjb25zdCB7IHNob3csIGN1c3RvbURhdGEsIG1lc3NhZ2UgfSA9IHRoaXMubG9va3VwUmVmLmRpYWxvZ01nci5jaGVja0RpY3RQaWNraW5nUmVzdWx0KHByKTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmxvb2t1cFJlZi5jdXN0b21EYXRhID0gY3VzdG9tRGF0YTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMucGFuZWxFbGVtZW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY3JlYXRlRGF0YVBhbmVsKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wYW5lbEVsZW1lbnQuc3R5bGUub3ZlcmZsb3cgPSAnaGlkZGVuJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRQYW5lbFBvc2l0aW9uKGZhbHNlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2FkRGF0YSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5pbnB1dFJlZi5rZXlkb3duSGFuZGxlLnBpcGUoXHJcbiAgICAgICAgICAgICAgICBmaWx0ZXIoKGV2ZW50OiBLZXlib2FyZEV2ZW50KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGV2ZW50LmtleSA9PT0gJ0VzY2FwZScgfHwgZXZlbnQua2V5ID09PSAnVGFiJyB8fCAgZXZlbnQua2V5ID09PSAnRjInO1xyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgKS5zdWJzY3JpYmUoKGUpID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMuaGlkZShlKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIG5nT25EZXN0cm95KCk6IHZvaWQge1xyXG4gICAgICAgIHRoaXMubG9va3VwUmVmLm92ZXJMYXlTZXJ2aWNlLmRlc3RvcnkodGhpcy5sb29rdXBSZWYuZWwubmF0aXZlRWxlbWVudCk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSByZW1vdmVQYW5lbEVsZW1lbnQoKSB7XHJcbiAgICAgICAgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZCh0aGlzLnBhbmVsRWxlbWVudCk7XHJcbiAgICAgICAgdGhpcy5wYW5lbEVsZW1lbnQgPSBudWxsO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgY2xlYXJTZWFyY2hWYWx1ZSgpIHtcclxuICAgICAgICB0aGlzLmxvb2t1cFJlZi5fc2VhcmNoU3RhdGUgPSB7IFxyXG4gICAgICAgICAgICBmaWVsZDogJyonLCAvL1wiKlwiLFxyXG4gICAgICAgICAgICB2YWx1ZTogJydcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgaGlkZShlPzogYW55LCBpc01vcmVDbGljayA9IGZhbHNlKSB7XHJcbiAgICAgICAgcmVxQW5pbUZyYW1lKCgpID0+IHtcclxuICAgICAgICAgICAgaWYgKHRoaXMucGFuZWxFbGVtZW50KSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoZSAmJiAoIGUudHlwZSA9PT0gJ21vdXNld2hlZWwnIHx8IGUudHlwZSA9PT0gJ3doZWVsJykpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnJlbW92ZVBhbmVsRWxlbWVudCgpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnBhbmVsRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKCdmLWFyZWEtc2hvdycpO1xyXG4gICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJlbW92ZVBhbmVsRWxlbWVudCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0sMTIwKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMubG9va3VwUmVmKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgLy8gdGZzIDU3OTA1NlxyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMubG9va3VwUmVmLm92ZXJMYXlTZXJ2aWNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5sb29rdXBSZWYub3ZlckxheVNlcnZpY2UuZGVzdG9yeSh0aGlzLmxvb2t1cFJlZi5lbC5uYXRpdmVFbGVtZW50KTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoaXNNb3JlQ2xpY2spIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm47ICAgICAgIFxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmxvb2t1cFJlZi50YWdJbnB1dCkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIHRoaXMubG9va3VwUmVmLnRhZ0lucHV0LnZhbHVlID0gJyc7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnB1dFJlZi52YWx1ZSA9ICcnO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2xlYXJTZWFyY2hWYWx1ZSgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGlmIChlICYmIChlLmtleSA9PT0gJ0YyJyB8fCB0aGlzLmxvb2t1cFJlZi5lbC5uYXRpdmVFbGVtZW50LmNvbnRhaW5zKGUudGFyZ2V0KSkpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5kYXRhICYmIHRoaXMuZGF0YS5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY2xlYXJTZWFyY2hWYWx1ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMubG9va3VwUmVmLm5vc2VhcmNoICYmIHRoaXMubG9va3VwUmVmLmRpc3BsYXlUZXh0ICE9PSB0aGlzLmxvb2t1cFJlZi5vcmlnaW5hbFRleHQpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmxvb2t1cFJlZi5vbkNoYW5nZXModGhpcy5sb29rdXBSZWYub3JpZ2luYWxUZXh0KVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBzZXRQYW5lbFBvc2l0aW9uKHVwZGF0ZVRvcFBvc2l0aW9uID0gdHJ1ZSkge1xyXG4gICAgICAgIGlmICh0aGlzLnBhbmVsRWxlbWVudCkge1xyXG4gICAgICAgICAgICBjb25zdCB7IHdpZHRoLCBsZWZ0LCB0b3AsIGhlaWdodCB9ID0gdGhpcy5nZXRQYW5lbFNpemUoKTtcclxuICAgICAgICAgICAgdGhpcy5wYW5lbEVsZW1lbnQuc3R5bGUud2lkdGggPSBgJHt3aWR0aH1weGA7XHJcbiAgICAgICAgICAgIHRoaXMucGFuZWxFbGVtZW50LnN0eWxlLm1heEhlaWdodCA9IGAke2hlaWdodH1weGA7XHJcbiAgICAgICAgICAgIGlmICh1cGRhdGVUb3BQb3NpdGlvbikge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5wYW5lbEVsZW1lbnQuc3R5bGUudG9wID0gYCR7dG9wfXB4YDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLnBhbmVsRWxlbWVudC5zdHlsZS5sZWZ0ID0gYCR7bGVmdH1weGA7XHJcbiAgICAgICAgICAgIHRoaXMucGFuZWxFbGVtZW50LnN0eWxlLnpJbmRleCA9ICcxMDAwMSc7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgY3JlYXRlRGF0YVBhbmVsKCkge1xyXG4gICAgICAgIFxyXG4gICAgICAgIGlmICh0aGlzLmxvb2t1cFJlZi5jaGFuZ2VEZXRlY3RvclsnZGVzdHJveWVkJ10pIHtcclxuICAgICAgICAgICAgdGhpcy5wYW5lbEVsZW1lbnQgJiYgdGhpcy5yZW1vdmVQYW5lbEVsZW1lbnQoKTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5wYW5lbEVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICAgICAgICB0aGlzLnBhbmVsRWxlbWVudC5jbGFzc0xpc3QuYWRkKCdvdmVybGF5LXBhbmUnLCAnZi1sb29rdXBfcXVpY2stcGFuZWwnLCAnZi1hcmVhLWhpZGUnKTtcclxuXHJcbiAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZCh0aGlzLnBhbmVsRWxlbWVudCk7XHJcbiAgICAgICAgdGhpcy5zZXRQYW5lbFBvc2l0aW9uKCk7XHJcblxyXG4gICAgICAgIHRoaXMucGFuZWxFbGVtZW50LnN0eWxlLm92ZXJmbG93ID0gJ2hpZGRlbic7XHJcbiAgICAgICAgLy8gdGhpcy5wYW5lbEVsZW1lbnQuc3R5bGUuaGVpZ2h0ID0gJ2F1dG8nO1xyXG4gICAgICAgIFxyXG4gICAgICAgIC8vIOWIm+W7uuaVsOaNruWxleekuue7hOS7tlxyXG4gICAgICAgIGNvbnN0IGNtcEZhY3QgPSB0aGlzLmNmci5yZXNvbHZlQ29tcG9uZW50RmFjdG9yeShMb29rdXBRdWlja1NlbGVjdFBhbmVsQ29tcG9uZW50KTtcclxuICAgICAgICB0aGlzLmNtcFJlZiA9IGNtcEZhY3QuY3JlYXRlKHRoaXMuaW5qZWN0b3IpO1xyXG4gICAgICAgIFxyXG4gICAgICAgIHRoaXMuY21wUmVmLmluc3RhbmNlLnNob3dNb3JlID0gdGhpcy5vcHRpb25zLnNob3dNb3JlO1xyXG4gICAgICAgIHRoaXMuY21wUmVmLmluc3RhbmNlLnRleHRGaWVsZCA9IHRoaXMubG9va3VwUmVmLnRleHRGaWVsZDtcclxuICAgICAgICB0aGlzLmNtcFJlZi5pbnN0YW5jZS5mb3JtYXR0ZXIgPSB0aGlzLm9wdGlvbnMuZm9ybWF0dGVyO1xyXG4gICAgICAgIHRoaXMuY21wUmVmLmluc3RhbmNlLm1heEl0ZW1zID0gdGhpcy5vcHRpb25zLnNob3dJdGVtc0NvdW50O1xyXG5cclxuICAgICAgICAvLyBjbXBSZWYubG9jYXRpb24ubmF0aXZlRWxlbWVudC5jbGFzc0xpc3QuYWRkKCdmYXJyaXMtbWFpbi1hcmVhJyk7XHJcbiAgICAgICAgdGhpcy5wYW5lbEVsZW1lbnQuYXBwZW5kQ2hpbGQodGhpcy5jbXBSZWYubG9jYXRpb24ubmF0aXZlRWxlbWVudCk7XHJcblxyXG4gICAgICAgIHRoaXMubG9va3VwUmVmLnNlbGVjdGlvbk1nci5pbml0RGlzcGxheVZhbHVlKCk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgdGhpcy5jbXBSZWYuY2hhbmdlRGV0ZWN0b3JSZWYuZGV0ZWN0Q2hhbmdlcygpO1xyXG5cclxuICAgICAgICAvLyBtb3JlIGNsaWNrZWQg5omT5byA5biu5Yqp56qX5Y+jXHJcbiAgICAgICAgdGhpcy5jbXBSZWYuaW5zdGFuY2UubW9yZUNsY2lrLnN1YnNjcmliZSgoZSkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLmhpZGUoZSwgdHJ1ZSk7XHJcbiAgICAgICAgICAgIHRoaXMubG9va3VwUmVmLnNob3dEaWFsb2coKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgdGhpcy5jbXBSZWYuaW5zdGFuY2UuaXRlbUNsaWNrLnN1YnNjcmliZSgoZTogYW55KSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IHsgZGF0YSB9ID0gZTtcclxuICAgICAgICAgICAgdGhpcy5zZWxlY3RJdGVtKGRhdGEpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuXHJcbiAgICAgICAgLy8g5rOo5YaM6byg5qCH5rua6L2u77yM54K55Ye75LqL5Lu277yM55So5LqO6ZqQ6JePUGFuZWxcclxuICAgICAgICB0aGlzLmxvb2t1cFJlZi5vdmVyTGF5U2VydmljZS5yZWdpc3Rlck1vdXNlRXZlbnQodGhpcy5sb29rdXBSZWYuZWwubmF0aXZlRWxlbWVudCwgKGU6IE1vdXNlRXZlbnQpID0+IHtcclxuICAgICAgICAgICAgaWYgKCF0aGlzLnBhbmVsRWxlbWVudCB8fCBlLnRhcmdldFsnY2xvc2VzdCddKCcuZi1sb29rdXBfcXVpY2stcGFuZWwnKSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBpZih0aGlzLmxvb2t1cFJlZi5pbnB1dEdyb3VwICYmIHRoaXMubG9va3VwUmVmLmlucHV0R3JvdXAudGV4dGJveC5uYXRpdmVFbGVtZW50ID09PSBlLnRhcmdldCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZih0aGlzLmxvb2t1cFJlZi50YWdJbnB1dCAmJiB0aGlzLmxvb2t1cFJlZi50YWdJbnB1dC50ZXh0Ym94Lm5hdGl2ZUVsZW1lbnQgPT09IGUudGFyZ2V0KSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmICh0aGlzLmNtcFJlZikge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jbXBSZWYuZGVzdHJveSgpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jbXBSZWYgPSBudWxsO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB0aGlzLmNsZWFyU2VhcmNoVmFsdWUoKTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuaGlkZShlKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgdGhpcy5wYW5lbEVsZW1lbnQuY2xhc3NMaXN0LmFkZCgnZi1hcmVhLXNob3cnKTtcclxuXHJcbiAgICAgICAgdGhpcy5sb2FkRGF0YSgpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgc2VsZWN0SXRlbShkYXRhOiBhbnkpIHtcclxuICAgICAgICBpZiAoIWRhdGEpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHRoaXMubG9va3VwUmVmLnZpZXdUeXBlID09PSAndGFnJykge1xyXG4gICAgICAgICAgICBjb25zdCBpc1NlbGVjdCA9IHRoaXMubG9va3VwUmVmLnNlbGVjdGlvbnMuZmluZChuID0+IG5bdGhpcy5sb29rdXBSZWYuaWRGaWVsZF0gPT09IGRhdGFbdGhpcy5sb29rdXBSZWYuaWRGaWVsZF0pO1xyXG4gICAgICAgICAgICBpZiAoIWlzU2VsZWN0KSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBzZWxlY3RJdGVtczogYW55ID0gWy4uLnRoaXMubG9va3VwUmVmLnNlbGVjdGlvbnMsIGRhdGFdO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5sb29rdXBSZWYuc2VsZWN0SXRlbShzZWxlY3RJdGVtcyk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmxvb2t1cFJlZi5sb29rdXBTZWxlY3Rpb25TZXIubG9hZFNlbGVjdGlvbnMoc2VsZWN0SXRlbXMpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5sb29rdXBSZWYuc2VsZWN0SXRlbShkYXRhKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5oaWRlKCk7XHJcbiAgICB9XHJcblxyXG5cclxuICAgIHByaXZhdGUgY2FsY3VsYXRpb25QYW5lbEhlaWdodCgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5vcHRpb25zLnNob3dJdGVtc0NvdW50ICogMzAgKyAodGhpcy5vcHRpb25zLnNob3dNb3JlID8gNTA6IDApICsgKHRoaXMub3B0aW9ucy5mb290ZXJIZWlnaHR8fDApICsgNTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGdldElucHV0U2l6ZUluZm8oKSB7XHJcbiAgICAgICAgY29uc3QgZWw6IGFueSA9IHRoaXMubG9va3VwUmVmLnZpZXdUeXBlID09PSAndGV4dCcgPyB0aGlzLmlucHV0UmVmLmlucHV0R3JvdXAgOiB0aGlzLmxvb2t1cFJlZi50YWdib3g7XHJcbiAgICAgICAgcmV0dXJuIGVsLm5hdGl2ZUVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBnZXRQYW5lbFNpemUoKSB7XHJcbiAgICAgICAgbGV0IHsgd2lkdGgsIGhlaWdodCwgdG9wLCBsZWZ0IH0gPSB0aGlzLmdldElucHV0U2l6ZUluZm8oKTtcclxuICAgICAgICBjb25zdCBib3R0b20gPSB3aW5kb3cuaW5uZXJIZWlnaHQgLSBoZWlnaHQgLSB0b3A7XHJcbiAgICAgICAgbGV0IHBhbmVsSGVpZ2h0ID0gdGhpcy5jYWxjdWxhdGlvblBhbmVsSGVpZ2h0KCk7XHJcblxyXG4gICAgICAgIGNvbnN0IGggPSB0b3AgPiBib3R0b20gPyB0b3AgOiBib3R0b207XHJcbiAgICAgICAgaWYgKGJvdHRvbSA+IHBhbmVsSGVpZ2h0KSB7XHJcbiAgICAgICAgICAgIHRvcCA9IHRvcCArIGhlaWdodDtcclxuICAgICAgICAgICAgLy8g6Z2i5p2/55Sx5LiK5ZCR5LiL5bGV5byAXHJcbiAgICAgICAgICAgIHRoaXMucGFuZWxFbGVtZW50LnN0eWxlLnRyYW5zZm9ybU9yaWdpbiA9ICcxMDAlIHRvcCc7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgaWYgKHRvcCA+IGJvdHRvbSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKGggPCBwYW5lbEhlaWdodCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHBhbmVsSGVpZ2h0ID0gaCAtIDEwO1xyXG4gICAgICAgICAgICAgICAgICAgIHRvcCA9IDEwO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICB0b3AgPSB0b3AgLSBwYXJzZUludCgnJyArIHBhbmVsSGVpZ2h0LCAxMCkgLSA1O1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIC8vIOmdouadv+eUseS4i+WQkeS4iuWxleW8gFxyXG4gICAgICAgICAgICAgICAgdGhpcy5wYW5lbEVsZW1lbnQuc3R5bGUudHJhbnNmb3JtT3JpZ2luID0gJzEwMCUgYm90dG9tJztcclxuXHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoaCA8IHBhbmVsSGVpZ2h0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcGFuZWxIZWlnaHQgPSBoIC0gMTA7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB0b3AgPSB0b3AgKyBoZWlnaHQ7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IG1pbldpZHRoID0gdGhpcy5vcHRpb25zLm1pbldpZHRoIHx8IDIwMDtcclxuICAgICAgICBsZXQgX3dpZHRoID0gIHdpZHRoIDwgbWluV2lkdGg/IG1pbldpZHRoOiB3aWR0aDtcclxuICAgICAgICBpZiAod2luZG93LmlubmVyV2lkdGggLSBsZWZ0IDwgX3dpZHRoKSB7XHJcbiAgICAgICAgICAgIGxlZnQgPSBsZWZ0ICsgd2lkdGggLSBfd2lkdGg7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4geyB3aWR0aDogX3dpZHRoLCB0b3AsIGhlaWdodDogcGFuZWxIZWlnaHQsIGxlZnQgfTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGdldERhdGEoKTogT2JzZXJ2YWJsZTxBcnJheTxhbnk+PiB7XHJcbiAgICAgICAgbGV0IHA6IGFueSA9IHtcclxuICAgICAgICAgICAgcGFnZUluZm86IHtcclxuICAgICAgICAgICAgICAgIHBhZ2VTaXplOiB0aGlzLm9wdGlvbnMuc2hvd0l0ZW1zQ291bnQsXHJcbiAgICAgICAgICAgICAgICBwYWdlSW5kZXg6IDEsXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgfTtcclxuICAgICAgICBsZXQgdDogTE9BRF9EQVRBX1RZUEUgPSBcImFsbFwiO1xyXG4gICAgICAgIGlmICh0aGlzLmxvb2t1cFJlZi5pc1RleHRDaGFuZ2UpIHtcclxuICAgICAgICAgICAgdGhpcy5sb29rdXBSZWYuX3NlYXJjaFN0YXRlID0geyBcclxuICAgICAgICAgICAgICAgIGZpZWxkOiB0aGlzLmxvb2t1cFJlZi50ZXh0RmllbGQsIC8vXCIqXCIsXHJcbiAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy5sb29rdXBSZWYuZGlzcGxheVRleHRcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBwWydzZWFyY2gnXSA9IHRoaXMubG9va3VwUmVmLl9zZWFyY2hTdGF0ZTtcclxuICAgICAgICAgICAgdCA9ICdzZWFyY2gnO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMubG9va3VwUmVmLl9zZWFyY2hTdGF0ZSA9IG51bGw7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodGhpcy5sb29rdXBSZWYudmlld1R5cGUgPT09ICd0YWcnKSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmxvb2t1cFJlZi50YWdJbnB1dC52YWx1ZSAhPT0gJycpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMubG9va3VwUmVmLl9zZWFyY2hTdGF0ZSA9IHsgXHJcbiAgICAgICAgICAgICAgICAgICAgZmllbGQ6IHRoaXMubG9va3VwUmVmLnRleHRGaWVsZCwgLy9cIipcIixcclxuICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy5sb29rdXBSZWYudGFnSW5wdXQudmFsdWVcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHBbJ3NlYXJjaCddID0gdGhpcy5sb29rdXBSZWYuX3NlYXJjaFN0YXRlO1xyXG4gICAgICAgICAgICAgICAgdCA9ICdzZWFyY2gnO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5sb29rdXBSZWYuX3NlYXJjaFN0YXRlID0gbnVsbDtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgY29uc3QgdmFscyA9IHRoaXMubG9va3VwUmVmLnNlbGVjdGlvbk1nci5nZXRTZWxlY3RlZElkcygpO1xyXG4gICAgICAgICAgICBpZiAodmFscyAmJiB2YWxzLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgcFtcInNlbGVjdGVkSW5mb1wiXSA9IHtcclxuICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZDogdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZElkczogdmFscyxcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICByZXR1cm4gdGhpcy5sb29rdXBSZWYuaHR0cE1nci5sb29rdXBSZXF1ZXN0KHAsIHQsIHRydWUpLnBpcGUoXHJcbiAgICAgICAgICAgIG1hcCgocmVzdERhdGE6IExvb2t1cEdyaWRSZXN1bHQpID0+IHtcclxuICAgICAgICAgICAgICAgIGxldCBfaXRlbXMgPSB0aGlzLmxvb2t1cFJlZi5pdGVtcyB8fCBbXTtcclxuICAgICAgICAgICAgICAgIGlmIChyZXN0RGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmxvb2t1cFJlZi52aWV3VHlwZSA9PT0gJ3RhZycpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sb29rdXBSZWYubG9va3VwU2VsZWN0aW9uU2VyLmxvYWRTZWxlY3Rpb25zKFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdERhdGFbXCJzZWxlY3RlZERhdGFcIl0gfHwgW11cclxuICAgICAgICAgICAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgX2l0ZW1zID0gcmVzdERhdGEuaXRlbXMgfHwgW107XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXN0RGF0YS5kaXNwbGF5VHlwZS50b0xvd2VyQ2FzZSgpLmluZGV4T2YoJ3RyZWVsaXN0JykgPiAtMSAmJiBfaXRlbXMubGVuZ3RoICYmIF9pdGVtc1swXS5kYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIF9pdGVtcyA9IF9pdGVtcy5tYXAobiA9PiBuLmRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIC8vIHJldHVybiBfaXRlbXMuc2xpY2UoMCwgdGhpcy5vcHRpb25zLnNob3dJdGVtc0NvdW50KTtcclxuXHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmxvb2t1cFJlZi5kaXNwbGF5VGV4dCAmJiB0aGlzLmxvb2t1cFJlZi5pc1RleHRDaGFuZ2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3REYXRhLmRpc3BsYXlUeXBlLnRvTG93ZXJDYXNlKCkuaW5kZXhPZigndHJlZWxpc3QnKSA+IC0xICYmIF9pdGVtcy5sZW5ndGggJiYgX2l0ZW1zWzBdLmRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9pdGVtcyA9IF9pdGVtcy5tYXAobiA9PiBuLmRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBpdGVtcyA9IF9pdGVtcy5maWx0ZXIobiA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gblt0aGlzLmxvb2t1cFJlZi50ZXh0RmllbGRdLmluZGV4T2YodGhpcy5sb29rdXBSZWYuZGlzcGxheVRleHQpID4gLTE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pLnNsaWNlKDAsIHRoaXMub3B0aW9ucy5zaG93SXRlbXNDb3VudCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIF9pdGVtcyA9IGl0ZW1zO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gcmV0dXJuIF9pdGVtcy5zbGljZSgwLCB0aGlzLm9wdGlvbnMuc2hvd0l0ZW1zQ291bnQpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gX2l0ZW1zLnNsaWNlKDAsIHRoaXMub3B0aW9ucy5zaG93SXRlbXNDb3VudCk7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGxvYWREYXRhKCkge1xyXG4gICAgICAgIGNvbnN0IGxvYWRpbmdSZWYgPSB0aGlzLmxvb2t1cFJlZi5sb2FkaW5nU2VydmljZS5zaG93KHtjb250YWluZXI6IHRoaXMucGFuZWxFbGVtZW50fSk7XHJcbiAgICAgICAgdGhpcy5nZXREYXRhKCkuc3Vic2NyaWJlKChkYXRhOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgbG9hZGluZ1JlZi5jbG9zZSgpO1xyXG4gICAgICAgICAgICBpZiAodGhpcy5jbXBSZWYgJiYgdGhpcy5jbXBSZWYuaW5zdGFuY2UpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuY21wUmVmLmluc3RhbmNlLmxvYWREYXRhKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGRhdGEubGVuZ3RoIDwgdGhpcy5vcHRpb25zLnNob3dJdGVtc0NvdW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gbGV0IG5ld0hlaWdodCA9IGRhdGEubGVuZ3RoICogMzAgKyAodGhpcy5vcHRpb25zLnNob3dNb3JlID8gNTA6IDApICsgKHRoaXMub3B0aW9ucy5mb290ZXJIZWlnaHR8fDApICsgNTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmRhdGEgPSBkYXRhO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBsZXQgbmV3SGVpZ2h0ID0gdGhpcy5jbXBSZWYuaW5zdGFuY2UuaXRlbXNDb250YWluZXIubmF0aXZlRWxlbWVudC5xdWVyeVNlbGVjdG9yKCd1bCcpLm9mZnNldEhlaWdodCArIDEwO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAoIWRhdGEgfHwgIWRhdGEubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG5ld0hlaWdodCA9IDU1O1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jbXBSZWYuaW5zdGFuY2UuaXRlbXNDb250YWluZXIubmF0aXZlRWxlbWVudC5zdHlsZS5oZWlnaHQgPSBgJHtuZXdIZWlnaHR9cHhgO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnBhbmVsRWxlbWVudCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5wYW5lbEVsZW1lbnQuc3R5bGUudHJhbnNmb3JtT3JpZ2luLmluZGV4T2YoJ2JvdHRvbScpID4gLTEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucGFuZWxFbGVtZW50LnN0eWxlLnRvcCA9IGAke3RoaXMuZ2V0SW5wdXRTaXplSW5mbygpLnRvcCAtIG5ld0hlaWdodCAtIDV9cHhgIDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBhbmVsRWxlbWVudC5zdHlsZS5oZWlnaHQgPSAnYXV0byc7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNldFBhbmVsUG9zaXRpb24oKTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmNtcFJlZi5pbnN0YW5jZS5pdGVtc0NvbnRhaW5lci5uYXRpdmVFbGVtZW50LnN0eWxlLmhlaWdodCA9ICcxMDAlJztcclxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5wYW5lbEVsZW1lbnQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW5kZXIucmVtb3ZlU3R5bGUodGhpcy5wYW5lbEVsZW1lbnQsICdoZWlnaHQnKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKCh0aGlzLmxvb2t1cFJlZi5pc1RleHRDaGFuZ2UgfHwgKHRoaXMubG9va3VwUmVmLnRhZ0lucHV0ICYmIHRoaXMubG9va3VwUmVmLnRhZ0lucHV0LnZhbHVlICE9PSAnJykgfHwgIFxyXG4gICAgICAgICAgICAgICAgICAgICh0aGlzLmxvb2t1cFJlZi5pbnB1dEdyb3VwICYmIHRoaXMubG9va3VwUmVmLmlucHV0R3JvdXAudmFsdWUgIT09ICcnICYmIHRoaXMubG9va3VwUmVmLmlzVGV4dENoYW5nZSkpICYmIGRhdGEgJiYgZGF0YS5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmNtcFJlZi5pbnN0YW5jZS5zZXRBY3RpdmVJdGVtKDApO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHRoaXMucGFuZWxFbGVtZW50LnN0eWxlLm92ZXJmbG93ID0gJ2F1dG8nO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG5cclxuICAgIEBIb3N0TGlzdGVuZXIoJ2tleWRvd24nLCBbJyRldmVudCddKVxyXG4gICAgcmVnaXN0ZXJLZXlib2FyZEV2ZW50KCRldmVudDogS2V5Ym9hcmRFdmVudCkge1xyXG5cclxuICAgICAgICBpZiAoIXRoaXMubG9va3VwUmVmLnNpbmdsZVNlbGVjdCAmJiB0aGlzLmxvb2t1cFJlZi52aWV3VHlwZSAhPT0gJ3RhZycpICB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGxldCByb3dzPSBbXTtcclxuICAgICAgICBpZiAodGhpcy5jbXBSZWYpIHtcclxuICAgICAgICAgICAgcm93cyA9IHRoaXMuY21wUmVmLmluc3RhbmNlLmRhdGE7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoIXJvd3MgfHwgIXJvd3MubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICgkZXZlbnQuY29kZSA9PT0gJ0Fycm93VXAnIHx8ICRldmVudC5jb2RlID09PSAnQXJyb3dEb3duJykge1xyXG4gICAgICAgICAgICAkZXZlbnQucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAgICAgJGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIGlmICgkZXZlbnQuY29kZSA9PT0gJ0JhY2tzcGFjZScgJiYgdGhpcy5sb29rdXBSZWYudmlld1R5cGUgPT09ICd0YWcnICYmXHJcbiAgICAgICAgICAgIHRoaXMubG9va3VwUmVmLnNlbGVjdGlvbnMgJiYgdGhpcy5sb29rdXBSZWYuc2VsZWN0aW9ucy5sZW5ndGggJiZcclxuICAgICAgICAgICAgdGhpcy5sb29rdXBSZWYudGFnSW5wdXQgJiYgIXRoaXMubG9va3VwUmVmLnRhZ0lucHV0LnZhbHVlICYmIHRoaXMubG9va3VwUmVmLnF1aWNrU2VsZWN0LmVuYWJsZUJhY2tzcGFjZSkge1xyXG4gICAgICAgICAgICAkZXZlbnQucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAgICAgJGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gICAgICAgICAgICBjb25zdCBuZXdkYXRhID0gdGhpcy5sb29rdXBSZWYuc2VsZWN0aW9ucy5zbGljZSgwLCB0aGlzLmxvb2t1cFJlZi5zZWxlY3Rpb25zLmxlbmd0aCAtIDEpO1xyXG4gICAgICAgICAgICBpZiAoIW5ld2RhdGEgfHwgIW5ld2RhdGEubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmxvb2t1cFJlZi5jbGVhclZhbHVlKHRydWUpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5sb29rdXBSZWYuc2VsZWN0SXRlbShuZXdkYXRhKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLmxvb2t1cFJlZi5sb29rdXBTZWxlY3Rpb25TZXIubG9hZFNlbGVjdGlvbnMobmV3ZGF0YSk7XHJcbiAgICAgICAgICAgIHRoaXMuc2V0UGFuZWxQb3NpdGlvbigpO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgY29uc3QgaWR4ID0gdGhpcy5jbXBSZWYuaW5zdGFuY2UuYWN0aXZlSW5kZXg7XHJcbiAgICAgICAgbGV0IGFjdGl2ZUluZGV4ID0gaWR4O1xyXG5cclxuICAgICAgICBjb25zdCBzZXRBY3RpdmVJdGVtID0gKGluZGV4KSA9PiB7XHJcbiAgICAgICAgICAgIGFjdGl2ZUluZGV4ID0gaW5kZXg7XHJcbiAgICAgICAgICAgIHRoaXMuY21wUmVmLmluc3RhbmNlLnNldEFjdGl2ZUl0ZW0oaW5kZXgpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGlmICgkZXZlbnQuY29kZSA9PT0gJ0Fycm93VXAnKSB7ICAvLyB1cFxyXG4gICAgICAgICAgICBpZiAoaWR4ID4gLTEpIHtcclxuICAgICAgICAgICAgICAgIGxldCBwcmV2SWR4ID0gaWR4IC0gMTtcclxuICAgICAgICAgICAgICAgIGlmIChwcmV2SWR4IDwgMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHByZXZJZHggPSByb3dzLmxlbmd0aCAtIDE7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBzZXRBY3RpdmVJdGVtKHByZXZJZHgpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgc2V0QWN0aXZlSXRlbShyb3dzLmxlbmd0aCAtIDEpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICgkZXZlbnQuY29kZSA9PT0gJ0Fycm93RG93bicpIHsgLy8gZG93blxyXG4gICAgICAgICAgICBsZXQgbmV4dElkeCA9IGlkeCArIDE7XHJcbiAgICAgICAgICAgIGlmIChuZXh0SWR4ID49IHJvd3MubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICBuZXh0SWR4ID0gMDtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgc2V0QWN0aXZlSXRlbShuZXh0SWR4KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmKCRldmVudC5rZXkgPT09ICdFbnRlcicpIHtcclxuICAgICAgICAgICAgaWYgKHJvd3MgJiYgcm93cy5sZW5ndGggJiYgdGhpcy5wYW5lbEVsZW1lbnQpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGRhdGEgPSByb3dzW2lkeF07XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdEl0ZW0oZGF0YSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmlucHV0UmVmLmlucHV0Q2xpY2suZW1pdCgkZXZlbnQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59Il19
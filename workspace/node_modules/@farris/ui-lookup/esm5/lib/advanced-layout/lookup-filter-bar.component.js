/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { ChangeDetectorRef, Component, ElementRef, EventEmitter, Injector, Input, Output, ViewChild } from '@angular/core';
import { DialogComponent } from '@farris/ui-dialog';
import { SearchBoxComponent, SearchFieldsComponent } from '@farris/ui-search-box';
import { LookupGridComponent } from '../lookup-grid.component';
import { SearchBarMode } from '../lookup-displaytype';
var LookupFilterBarComponent = /** @class */ (function () {
    function LookupFilterBarComponent(injector, cd, lookIns) {
        this.injector = injector;
        this.cd = cd;
        this.lookIns = lookIns;
        this.fields = [];
        this.filterFields = [];
        this.searchAnyField = true;
        this.columns = [];
        this.viewType = SearchBarMode.both;
        this.isNav = false;
        this.searchFields = [];
        this.conditionsChange = new EventEmitter();
        this.textConditions = [];
        this.fieldConditons = [];
        this.dialogRef = this.injector.get(DialogComponent, null);
        this.el = this.injector.get(ElementRef);
    }
    /**
     * @return {?}
     */
    LookupFilterBarComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.searchFields = this.searchFields || [];
        this.convertColumnsToSearchFields();
        if (this.dialogRef && this.searchboxRef) {
            this.dialogRef.moving.subscribe((/**
             * @return {?}
             */
            function () {
                _this.searchboxRef.updateShadowBoxPosition();
            }));
        }
    };
    /**
     * @param {?} changes
     * @return {?}
     */
    LookupFilterBarComponent.prototype.ngOnChanges = /**
     * @param {?} changes
     * @return {?}
     */
    function (changes) {
        var _this = this;
        if (changes.columns && !changes.columns.isFirstChange()) {
            this.convertColumnsToSearchFields();
            setTimeout((/**
             * @return {?}
             */
            function () {
                _this.initSearchValue();
            }), 100);
        }
    };
    /**
     * @return {?}
     */
    LookupFilterBarComponent.prototype.ngAfterViewInit = /**
     * @return {?}
     */
    function () {
    };
    /**
     * @private
     * @return {?}
     */
    LookupFilterBarComponent.prototype.initSearchValue = /**
     * @private
     * @return {?}
     */
    function () {
        if (this.lookIns._searchState && !this.isNav && this.searchboxRef) {
            var _a = this.lookIns._searchState, field = _a.field, value = _a.value;
            if (field === '*' && value != '' && value !== null && value !== undefined) {
                /** @type {?} */
                var alltitle = this.lookIns.localService.getValue('lookup.anyFields');
                /** @type {?} */
                var _conditions = [{ code: '*', name: alltitle, value: value }];
                this.searchboxRef.setValue(_conditions, false);
                this.textConditions = this.searchboxRef.expandStarFieldToAllFields();
            }
        }
    };
    /**
     * @private
     * @param {?} n
     * @return {?}
     */
    LookupFilterBarComponent.prototype.converColumnToFilterField = /**
     * @private
     * @param {?} n
     * @return {?}
     */
    function (n) {
        /** @type {?} */
        var t = {};
        t.id = n.field;
        t.labelCode = n.field;
        t.code = n.fieldPath;
        t.name = n.title;
        /** @type {?} */
        var options = n.formatter ? n.formatter.options : null;
        // 数字
        if (n.fieldType === 'NumericType') {
            /** @type {?} */
            var _options = tslib_1.__assign({}, (options || {}));
            n.precision = n.precision || 0;
            _options.precision = _options.precision || 0;
            if (n.precision != _options.precision) {
                _options.precision = n.precision;
            }
            t.control = Object.assign({
                "controltype": "number",
                "bigNumber": false,
                "placeHolder": '请输入数字',
                single: true
            }, _options);
            t.beginPlaceHolder = "开始数值";
            t.endPlaceHolder = "结束数值";
        }
        // 枚举
        if (n.fieldType === 'EnumType') {
            t.control = {
                "controltype": "enum",
                "enumValues": n.formatter.options.data,
                single: true
            };
        }
        // 布尔
        if (n.fieldType === 'BooleanType') {
            /** @type {?} */
            var trueText = options ? options.trueText || 'True' : 'True';
            /** @type {?} */
            var falseText = options ? options.falseText || 'False' : 'False';
            t.control = {
                controltype: 'dropdown',
                enumValues: [
                    { value: 1, name: trueText },
                    { value: 0, name: falseText },
                ],
                single: true
            };
        }
        // 日期
        if (n.fieldType === "DateType" || n.fieldType === 'DateTimeType') {
            /** @type {?} */
            var dateFormat = 'yyyy-MM-dd';
            /** @type {?} */
            var showTime = false;
            /** @type {?} */
            var showType = '1';
            if (options) {
                if (options.format) {
                    dateFormat = options.format;
                }
            }
            if (n.fieldType === 'DateTimeType') {
                showTime = true;
            }
            if (dateFormat === 'yyyy') {
                showType = '2';
            }
            if (dateFormat === 'yyyy-MM') {
                showType = '3';
            }
            t.control = {
                "controltype": "datetime",
                "placeholder": "请选择日期",
                single: true,
                dateFormat: dateFormat,
                showTime: showTime,
                showType: showType
            };
        }
        return t;
    };
    /**
     * @private
     * @return {?}
     */
    LookupFilterBarComponent.prototype.convertColumnsToSearchFields = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        if (this.columns && this.columns.length) {
            this.fields = this.columns.filter((/**
             * @param {?} n
             * @return {?}
             */
            function (n) { return n.fieldType && (n.fieldType === 'StringType' || n.fieldType === 'TextType'); })).map((/**
             * @param {?} n
             * @return {?}
             */
            function (n) {
                return {
                    code: n.fieldPath,
                    name: n.title
                };
            }));
            if (!this.fields.length && this.searchFields.length) {
                this.fields = this.searchFields.map((/**
                 * @param {?} n
                 * @return {?}
                 */
                function (n) {
                    return {
                        code: n.value,
                        name: n.label
                    };
                }));
            }
            if (this.viewType === 'both' || this.viewType === 'onlyfield') {
                this.filterFields = this.columns.filter((/**
                 * @param {?} n
                 * @return {?}
                 */
                function (n) { return n.fieldType && n.fieldType !== 'StringType' && n.fieldType !== 'TextType' && n.field; })).map((/**
                 * @param {?} n
                 * @return {?}
                 */
                function (n) {
                    return _this.converColumnToFilterField(n);
                }));
            }
            if (this.lookIns && this.lookIns.allowQueryFields) {
                var _a = this.lookIns.allowQueryFields, nav = _a.nav, main = _a.main;
                /** @type {?} */
                var queryFields = main;
                if (this.isNav) {
                    queryFields = nav;
                }
                if (queryFields) {
                    /** @type {?} */
                    var _queryFields_1 = queryFields.split(',');
                    this.fields = this.fields.filter((/**
                     * @param {?} n
                     * @return {?}
                     */
                    function (n) { return _queryFields_1.findIndex((/**
                     * @param {?} f
                     * @return {?}
                     */
                    function (f) { return f === n.code; })) > -1; }));
                    this.filterFields = this.filterFields.filter((/**
                     * @param {?} n
                     * @return {?}
                     */
                    function (n) { return _queryFields_1.findIndex((/**
                     * @param {?} f
                     * @return {?}
                     */
                    function (f) { return f === n.code; })) > -1; }));
                }
            }
            this.cd.markForCheck();
        }
    };
    /**
     * @param {?} $event
     * @param {?=} isString
     * @return {?}
     */
    LookupFilterBarComponent.prototype.onConditionChange = /**
     * @param {?} $event
     * @param {?=} isString
     * @return {?}
     */
    function ($event, isString) {
        if (isString === void 0) { isString = true; }
        if (isString) {
            this.textConditions = $event;
        }
        else {
            this.fieldConditons = $event;
        }
        this.textConditions = this.textConditions || [];
        /** @type {?} */
        var _conditions$ = this.fieldConditons.concat([]);
        if (this.fieldConditons && this.fieldConditons.length && this.textConditions.length) {
            _conditions$[0].lbracket = this.fieldConditons[0].lbracket + '(';
            _conditions$[_conditions$.length - 1].relation = 1;
            _conditions$[_conditions$.length - 1].rbracket = _conditions$[_conditions$.length - 1].rbracket + ')';
        }
        /** @type {?} */
        var _conditions = _conditions$.concat(this.textConditions);
        this.conditionsChange.emit(_conditions);
    };
    /**
     * @param {?} $event
     * @return {?}
     */
    LookupFilterBarComponent.prototype.onClearConditions = /**
     * @param {?} $event
     * @return {?}
     */
    function ($event) {
        $event.stopPropagation();
        this.textConditions = [];
        this.fieldConditons = [];
        if (this.searchboxRef) {
            this.searchboxRef.clearConditions(false);
        }
        if (this.searchfieldsRef) {
            this.filterFields.forEach((/**
             * @param {?} n
             * @return {?}
             */
            function (n) {
                n.value = null;
            }));
            this.searchfieldsRef.clearConditions(false);
        }
        this.cd.detectChanges();
        this.conditionsChange.emit([]);
    };
    /**
     * @param {?} $event
     * @return {?}
     */
    LookupFilterBarComponent.prototype.onEsc = /**
     * @param {?} $event
     * @return {?}
     */
    function ($event) {
        this.lookIns.closeLoading();
        this.lookIns.closeDialog();
    };
    LookupFilterBarComponent.decorators = [
        { type: Component, args: [{
                    selector: '[lookup-filter-bar]',
                    template: "\n    <div class=\"d-flex flex-row\">\n        <farris-search-fields #searchfields [fields]=\"filterFields\" class=\"mr-2 f-utils-fill\"  \n        *ngIf=\"filterFields && filterFields.length && (viewType == 'both' || viewType=== 'onlyfield')\" \n        (conditionChange)=\"onConditionChange($event, false)\"></farris-search-fields>\n\n        <div style=\"min-width:40%;\" class=\"d-flex flex-row\" [class.w-100]=\"!filterFields || !filterFields.length\" [style.maxWidth]=\"filterFields && filterFields.length?'70%': '100%'\">\n            <farris-search-box #searchbox [fields]=\"fields\" [useAnyField]=\"searchAnyField\"\n            (conditionChange)=\"onConditionChange($event, true)\" class=\"f-cmp-inputgroup f-utils-fill\" \n            *ngIf=\"(viewType == 'both' || viewType=== 'onlyinput')\" (escHandler)=\"onEsc($event)\"></farris-search-box>\n            <span class=\"f-icon f-icon-remove clear-search-fields\" \n                [ngStyle]=\"((textConditions && textConditions.length) || (fieldConditons && fieldConditons.length)) ? { }: {opacity: '0.3',pointerEvents: 'none'}\"\n                (click)=\"onClearConditions($event)\" title=\"{{ 'lookup.clearAllConditions' | locale }}\" style=\"min-width:28px;border: 0;\"></span>\n        </div>\n    </div>\n    "
                }] }
    ];
    /** @nocollapse */
    LookupFilterBarComponent.ctorParameters = function () { return [
        { type: Injector },
        { type: ChangeDetectorRef },
        { type: LookupGridComponent }
    ]; };
    LookupFilterBarComponent.propDecorators = {
        searchAnyField: [{ type: Input }],
        columns: [{ type: Input }],
        viewType: [{ type: Input }],
        isNav: [{ type: Input }],
        searchFields: [{ type: Input }],
        conditionsChange: [{ type: Output }],
        searchboxRef: [{ type: ViewChild, args: ['searchbox',] }],
        searchfieldsRef: [{ type: ViewChild, args: ['searchfields',] }]
    };
    return LookupFilterBarComponent;
}());
export { LookupFilterBarComponent };
if (false) {
    /** @type {?} */
    LookupFilterBarComponent.prototype.fields;
    /** @type {?} */
    LookupFilterBarComponent.prototype.filterFields;
    /** @type {?} */
    LookupFilterBarComponent.prototype.searchAnyField;
    /** @type {?} */
    LookupFilterBarComponent.prototype.columns;
    /** @type {?} */
    LookupFilterBarComponent.prototype.viewType;
    /** @type {?} */
    LookupFilterBarComponent.prototype.isNav;
    /** @type {?} */
    LookupFilterBarComponent.prototype.searchFields;
    /** @type {?} */
    LookupFilterBarComponent.prototype.conditionsChange;
    /** @type {?} */
    LookupFilterBarComponent.prototype.searchboxRef;
    /** @type {?} */
    LookupFilterBarComponent.prototype.searchfieldsRef;
    /** @type {?} */
    LookupFilterBarComponent.prototype.textConditions;
    /** @type {?} */
    LookupFilterBarComponent.prototype.fieldConditons;
    /** @type {?} */
    LookupFilterBarComponent.prototype.dialogRef;
    /**
     * @type {?}
     * @private
     */
    LookupFilterBarComponent.prototype.el;
    /**
     * @type {?}
     * @private
     */
    LookupFilterBarComponent.prototype.injector;
    /**
     * @type {?}
     * @private
     */
    LookupFilterBarComponent.prototype.cd;
    /**
     * @type {?}
     * @private
     */
    LookupFilterBarComponent.prototype.lookIns;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibG9va3VwLWZpbHRlci1iYXIuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy91aS1sb29rdXAvIiwic291cmNlcyI6WyJsaWIvYWR2YW5jZWQtbGF5b3V0L2xvb2t1cC1maWx0ZXItYmFyLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFBaUIsaUJBQWlCLEVBQUUsU0FBUyxFQUFFLFVBQVUsRUFBRSxZQUFZLEVBQUUsUUFBUSxFQUFFLEtBQUssRUFBcUIsTUFBTSxFQUFpQixTQUFTLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDNUssT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBQ3BELE9BQU8sRUFBRSxrQkFBa0IsRUFBRSxxQkFBcUIsRUFBRSxNQUFNLHVCQUF1QixDQUFDO0FBQ2xGLE9BQU8sRUFBRSxtQkFBbUIsRUFBRSxNQUFNLDBCQUEwQixDQUFDO0FBQy9ELE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQUV0RDtJQTBDSSxrQ0FBb0IsUUFBa0IsRUFBVSxFQUFxQixFQUFVLE9BQTRCO1FBQXZGLGFBQVEsR0FBUixRQUFRLENBQVU7UUFBVSxPQUFFLEdBQUYsRUFBRSxDQUFtQjtRQUFVLFlBQU8sR0FBUCxPQUFPLENBQXFCO1FBcEIzRyxXQUFNLEdBQUcsRUFBRSxDQUFDO1FBQ1osaUJBQVksR0FBRyxFQUFFLENBQUM7UUFDVCxtQkFBYyxHQUFHLElBQUksQ0FBQztRQUN0QixZQUFPLEdBQUcsRUFBRSxDQUFDO1FBQ2IsYUFBUSxHQUFrQixhQUFhLENBQUMsSUFBSSxDQUFDO1FBQzdDLFVBQUssR0FBRyxLQUFLLENBQUM7UUFFZCxpQkFBWSxHQUFHLEVBQUUsQ0FBQztRQUVqQixxQkFBZ0IsR0FBRyxJQUFJLFlBQVksRUFBRSxDQUFDO1FBS2hELG1CQUFjLEdBQUcsRUFBRSxDQUFDO1FBQ3BCLG1CQUFjLEdBQUcsRUFBRSxDQUFDO1FB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ZURldGVjdG9yUmVmLCBDb21wb25lbnQsIEVsZW1lbnRSZWYsIEV2ZW50RW1pdHRlciwgSW5qZWN0b3IsIElucHV0LCBPbkNoYW5nZXMsIE9uSW5pdCwgT3V0cHV0LCBTaW1wbGVDaGFuZ2VzLCBWaWV3Q2hpbGQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgRGlhbG9nQ29tcG9uZW50IH0gZnJvbSAnQGZhcnJpcy91aS1kaWFsb2cnO1xyXG5pbXBvcnQgeyBTZWFyY2hCb3hDb21wb25lbnQsIFNlYXJjaEZpZWxkc0NvbXBvbmVudCB9IGZyb20gJ0BmYXJyaXMvdWktc2VhcmNoLWJveCc7XHJcbmltcG9ydCB7IExvb2t1cEdyaWRDb21wb25lbnQgfSBmcm9tICcuLi9sb29rdXAtZ3JpZC5jb21wb25lbnQnO1xyXG5pbXBvcnQgeyBTZWFyY2hCYXJNb2RlIH0gZnJvbSAnLi4vbG9va3VwLWRpc3BsYXl0eXBlJztcclxuXHJcbkBDb21wb25lbnQoe1xyXG4gICAgc2VsZWN0b3I6ICdbbG9va3VwLWZpbHRlci1iYXJdJyxcclxuICAgIHRlbXBsYXRlOiBgXHJcbiAgICA8ZGl2IGNsYXNzPVwiZC1mbGV4IGZsZXgtcm93XCI+XHJcbiAgICAgICAgPGZhcnJpcy1zZWFyY2gtZmllbGRzICNzZWFyY2hmaWVsZHMgW2ZpZWxkc109XCJmaWx0ZXJGaWVsZHNcIiBjbGFzcz1cIm1yLTIgZi11dGlscy1maWxsXCIgIFxyXG4gICAgICAgICpuZ0lmPVwiZmlsdGVyRmllbGRzICYmIGZpbHRlckZpZWxkcy5sZW5ndGggJiYgKHZpZXdUeXBlID09ICdib3RoJyB8fCB2aWV3VHlwZT09PSAnb25seWZpZWxkJylcIiBcclxuICAgICAgICAoY29uZGl0aW9uQ2hhbmdlKT1cIm9uQ29uZGl0aW9uQ2hhbmdlKCRldmVudCwgZmFsc2UpXCI+PC9mYXJyaXMtc2VhcmNoLWZpZWxkcz5cclxuXHJcbiAgICAgICAgPGRpdiBzdHlsZT1cIm1pbi13aWR0aDo0MCU7XCIgY2xhc3M9XCJkLWZsZXggZmxleC1yb3dcIiBbY2xhc3Mudy0xMDBdPVwiIWZpbHRlckZpZWxkcyB8fCAhZmlsdGVyRmllbGRzLmxlbmd0aFwiIFtzdHlsZS5tYXhXaWR0aF09XCJmaWx0ZXJGaWVsZHMgJiYgZmlsdGVyRmllbGRzLmxlbmd0aD8nNzAlJzogJzEwMCUnXCI+XHJcbiAgICAgICAgICAgIDxmYXJyaXMtc2VhcmNoLWJveCAjc2VhcmNoYm94IFtmaWVsZHNdPVwiZmllbGRzXCIgW3VzZUFueUZpZWxkXT1cInNlYXJjaEFueUZpZWxkXCJcclxuICAgICAgICAgICAgKGNvbmRpdGlvbkNoYW5nZSk9XCJvbkNvbmRpdGlvbkNoYW5nZSgkZXZlbnQsIHRydWUpXCIgY2xhc3M9XCJmLWNtcC1pbnB1dGdyb3VwIGYtdXRpbHMtZmlsbFwiIFxyXG4gICAgICAgICAgICAqbmdJZj1cIih2aWV3VHlwZSA9PSAnYm90aCcgfHwgdmlld1R5cGU9PT0gJ29ubHlpbnB1dCcpXCIgKGVzY0hhbmRsZXIpPVwib25Fc2MoJGV2ZW50KVwiPjwvZmFycmlzLXNlYXJjaC1ib3g+XHJcbiAgICAgICAgICAgIDxzcGFuIGNsYXNzPVwiZi1pY29uIGYtaWNvbi1yZW1vdmUgY2xlYXItc2VhcmNoLWZpZWxkc1wiIFxyXG4gICAgICAgICAgICAgICAgW25nU3R5bGVdPVwiKCh0ZXh0Q29uZGl0aW9ucyAmJiB0ZXh0Q29uZGl0aW9ucy5sZW5ndGgpIHx8IChmaWVsZENvbmRpdG9ucyAmJiBmaWVsZENvbmRpdG9ucy5sZW5ndGgpKSA/IHsgfToge29wYWNpdHk6ICcwLjMnLHBvaW50ZXJFdmVudHM6ICdub25lJ31cIlxyXG4gICAgICAgICAgICAgICAgKGNsaWNrKT1cIm9uQ2xlYXJDb25kaXRpb25zKCRldmVudClcIiB0aXRsZT1cInt7ICdsb29rdXAuY2xlYXJBbGxDb25kaXRpb25zJyB8IGxvY2FsZSB9fVwiIHN0eWxlPVwibWluLXdpZHRoOjI4cHg7Ym9yZGVyOiAwO1wiPjwvc3Bhbj5cclxuICAgICAgICA8L2Rpdj5cclxuICAgIDwvZGl2PlxyXG4gICAgYFxyXG59KVxyXG5cclxuZXhwb3J0IGNsYXNzIExvb2t1cEZpbHRlckJhckNvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgT25DaGFuZ2VzLCBBZnRlclZpZXdJbml0IHtcclxuXHJcbiAgICBmaWVsZHMgPSBbXTtcclxuICAgIGZpbHRlckZpZWxkcyA9IFtdO1xyXG4gICAgQElucHV0KCkgc2VhcmNoQW55RmllbGQgPSB0cnVlO1xyXG4gICAgQElucHV0KCkgY29sdW1ucyA9IFtdO1xyXG4gICAgQElucHV0KCkgdmlld1R5cGU6IFNlYXJjaEJhck1vZGUgPSBTZWFyY2hCYXJNb2RlLmJvdGg7XHJcbiAgICBASW5wdXQoKSBpc05hdiA9IGZhbHNlO1xyXG5cclxuICAgIEBJbnB1dCgpIHNlYXJjaEZpZWxkcyA9IFtdO1xyXG5cclxuICAgIEBPdXRwdXQoKSBjb25kaXRpb25zQ2hhbmdlID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG5cclxuICAgIEBWaWV3Q2hpbGQoJ3NlYXJjaGJveCcpIHNlYXJjaGJveFJlZjogU2VhcmNoQm94Q29tcG9uZW50O1xyXG4gICAgQFZpZXdDaGlsZCgnc2VhcmNoZmllbGRzJykgc2VhcmNoZmllbGRzUmVmOiBTZWFyY2hGaWVsZHNDb21wb25lbnQ7XHJcblxyXG4gICAgdGV4dENvbmRpdGlvbnMgPSBbXTtcclxuICAgIGZpZWxkQ29uZGl0b25zID0gW107XHJcbiAgICBcclxuXHJcbiAgICBkaWFsb2dSZWY6IERpYWxvZ0NvbXBvbmVudDtcclxuICAgIHByaXZhdGUgZWw6IEVsZW1lbnRSZWY7XHJcbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIGluamVjdG9yOiBJbmplY3RvciwgcHJpdmF0ZSBjZDogQ2hhbmdlRGV0ZWN0b3JSZWYsIHByaXZhdGUgbG9va0luczogTG9va3VwR3JpZENvbXBvbmVudCkge1xyXG4gICAgICAgIHRoaXMuZGlhbG9nUmVmID0gdGhpcy5pbmplY3Rvci5nZXQoRGlhbG9nQ29tcG9uZW50LCBudWxsKTtcclxuICAgICAgICB0aGlzLmVsID0gdGhpcy5pbmplY3Rvci5nZXQoRWxlbWVudFJlZik7XHJcbiAgICB9XHJcblxyXG4gICAgbmdPbkluaXQoKSB7XHJcbiAgICAgICAgdGhpcy5zZWFyY2hGaWVsZHMgPSB0aGlzLnNlYXJjaEZpZWxkcyB8fCBbXTtcclxuICAgICAgICB0aGlzLmNvbnZlcnRDb2x1bW5zVG9TZWFyY2hGaWVsZHMoKTtcclxuXHJcbiAgICAgICAgaWYodGhpcy5kaWFsb2dSZWYgJiYgdGhpcy5zZWFyY2hib3hSZWYpIHtcclxuICAgICAgICAgICAgdGhpcy5kaWFsb2dSZWYubW92aW5nLnN1YnNjcmliZSgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNlYXJjaGJveFJlZi51cGRhdGVTaGFkb3dCb3hQb3NpdGlvbigpO1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBuZ09uQ2hhbmdlcyhjaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKTogdm9pZCB7XHJcbiAgICAgICAgaWYgKGNoYW5nZXMuY29sdW1ucyAmJiAhY2hhbmdlcy5jb2x1bW5zLmlzRmlyc3RDaGFuZ2UoKSkge1xyXG4gICAgICAgICAgICB0aGlzLmNvbnZlcnRDb2x1bW5zVG9TZWFyY2hGaWVsZHMoKTtcclxuICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmluaXRTZWFyY2hWYWx1ZSgpO1xyXG4gICAgICAgICAgICB9LCAxMDApXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIG5nQWZ0ZXJWaWV3SW5pdCgpIHtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGluaXRTZWFyY2hWYWx1ZSgpIHtcclxuICAgICAgICBpZiAodGhpcy5sb29rSW5zLl9zZWFyY2hTdGF0ZSAmJiAhdGhpcy5pc05hdiAmJiB0aGlzLnNlYXJjaGJveFJlZikge1xyXG4gICAgICAgICAgICBjb25zdCB7IGZpZWxkLCB2YWx1ZX0gPSB0aGlzLmxvb2tJbnMuX3NlYXJjaFN0YXRlO1xyXG4gICAgICAgICAgICBpZiAoZmllbGQgPT09ICcqJyAmJiB2YWx1ZSAhPSAnJyAmJiB2YWx1ZSAhPT0gbnVsbCAmJiB2YWx1ZSE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGFsbHRpdGxlID0gdGhpcy5sb29rSW5zLmxvY2FsU2VydmljZS5nZXRWYWx1ZSgnbG9va3VwLmFueUZpZWxkcycpXHJcbiAgICAgICAgICAgICAgICBjb25zdCBfY29uZGl0aW9ucyA9IFt7IGNvZGU6ICcqJywgbmFtZTogYWxsdGl0bGUsIHZhbHVlIH1dO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zZWFyY2hib3hSZWYuc2V0VmFsdWUoX2NvbmRpdGlvbnMsIGZhbHNlKTtcclxuICAgICAgICAgICAgICAgIHRoaXMudGV4dENvbmRpdGlvbnMgPSB0aGlzLnNlYXJjaGJveFJlZi5leHBhbmRTdGFyRmllbGRUb0FsbEZpZWxkcygpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgY29udmVyQ29sdW1uVG9GaWx0ZXJGaWVsZChuOiBhbnkpIHtcclxuICAgICAgICBjb25zdCB0OiBhbnkgPSB7fTtcclxuICAgICAgICB0LmlkID0gbi5maWVsZDtcclxuICAgICAgICB0LmxhYmVsQ29kZSA9IG4uZmllbGQ7XHJcbiAgICAgICAgdC5jb2RlID0gbi5maWVsZFBhdGg7XHJcbiAgICAgICAgdC5uYW1lID0gbi50aXRsZTtcclxuICAgICAgICBjb25zdCBvcHRpb25zID0gbi5mb3JtYXR0ZXIgPyBuLmZvcm1hdHRlci5vcHRpb25zIDogbnVsbDtcclxuICAgICAgICAvLyDmlbDlrZdcclxuICAgICAgICBpZiAobi5maWVsZFR5cGUgPT09ICdOdW1lcmljVHlwZScpIHtcclxuICAgICAgICAgICAgY29uc3QgX29wdGlvbnMgPSB7Li4uKG9wdGlvbnMgfHwge30pfTtcclxuICAgICAgICAgICAgbi5wcmVjaXNpb24gPSBuLnByZWNpc2lvbiB8fCAwO1xyXG4gICAgICAgICAgICBfb3B0aW9ucy5wcmVjaXNpb24gPSBfb3B0aW9ucy5wcmVjaXNpb24gfHwgMDtcclxuICAgICAgICAgICAgaWYgKG4ucHJlY2lzaW9uICE9IF9vcHRpb25zLnByZWNpc2lvbikge1xyXG4gICAgICAgICAgICAgICAgX29wdGlvbnMucHJlY2lzaW9uID0gbi5wcmVjaXNpb247XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHQuY29udHJvbCA9IE9iamVjdC5hc3NpZ24oeyBcclxuICAgICAgICAgICAgICAgIFwiY29udHJvbHR5cGVcIjogXCJudW1iZXJcIiwgXHJcbiAgICAgICAgICAgICAgICBcImJpZ051bWJlclwiOiBmYWxzZSwgXHJcbiAgICAgICAgICAgICAgICBcInBsYWNlSG9sZGVyXCI6ICfor7fovpPlhaXmlbDlrZcnLCBcclxuICAgICAgICAgICAgICAgIHNpbmdsZTogdHJ1ZSBcclxuICAgICAgICAgICAgfSwgX29wdGlvbnMpO1xyXG4gICAgICAgICAgICB0LmJlZ2luUGxhY2VIb2xkZXIgPSBcIuW8gOWni+aVsOWAvFwiO1xyXG4gICAgICAgICAgICB0LmVuZFBsYWNlSG9sZGVyID0gXCLnu5PmnZ/mlbDlgLxcIjtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8g5p6a5Li+XHJcbiAgICAgICAgaWYgKG4uZmllbGRUeXBlID09PSAnRW51bVR5cGUnKSB7XHJcbiAgICAgICAgICAgIHQuY29udHJvbCA9IHtcclxuICAgICAgICAgICAgICAgIFwiY29udHJvbHR5cGVcIjogXCJlbnVtXCIsXHJcbiAgICAgICAgICAgICAgICBcImVudW1WYWx1ZXNcIjogbi5mb3JtYXR0ZXIub3B0aW9ucy5kYXRhLFxyXG4gICAgICAgICAgICAgICAgc2luZ2xlOiB0cnVlXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyDluIPlsJRcclxuICAgICAgICBpZiAobi5maWVsZFR5cGUgPT09ICdCb29sZWFuVHlwZScpIHtcclxuICAgICAgICAgICAgbGV0IHRydWVUZXh0ID0gb3B0aW9ucyA/IG9wdGlvbnMudHJ1ZVRleHQgfHwgJ1RydWUnIDogJ1RydWUnO1xyXG5cclxuICAgICAgICAgICAgbGV0IGZhbHNlVGV4dCA9IG9wdGlvbnMgPyBvcHRpb25zLmZhbHNlVGV4dCB8fCAnRmFsc2UnIDogJ0ZhbHNlJztcclxuICAgICAgICAgICAgdC5jb250cm9sID0ge1xyXG4gICAgICAgICAgICAgICAgY29udHJvbHR5cGU6ICdkcm9wZG93bicsXHJcbiAgICAgICAgICAgICAgICBlbnVtVmFsdWVzOiBbXHJcbiAgICAgICAgICAgICAgICAgICAgeyB2YWx1ZTogMSwgbmFtZTogdHJ1ZVRleHQgfSxcclxuICAgICAgICAgICAgICAgICAgICB7IHZhbHVlOiAwLCBuYW1lOiBmYWxzZVRleHQgfSxcclxuICAgICAgICAgICAgICAgIF0sXHJcbiAgICAgICAgICAgICAgICBzaW5nbGU6IHRydWVcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIOaXpeacn1xyXG4gICAgICAgIGlmIChuLmZpZWxkVHlwZSA9PT0gXCJEYXRlVHlwZVwiIHx8IG4uZmllbGRUeXBlID09PSAnRGF0ZVRpbWVUeXBlJykge1xyXG5cclxuICAgICAgICAgICAgbGV0IGRhdGVGb3JtYXQgPSAneXl5eS1NTS1kZCc7XHJcbiAgICAgICAgICAgIGxldCBzaG93VGltZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICBsZXQgc2hvd1R5cGUgPSAnMSc7XHJcbiAgICAgICAgICAgIGlmIChvcHRpb25zKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAob3B0aW9ucy5mb3JtYXQpIHtcclxuICAgICAgICAgICAgICAgICAgICBkYXRlRm9ybWF0ID0gb3B0aW9ucy5mb3JtYXQ7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKG4uZmllbGRUeXBlID09PSAnRGF0ZVRpbWVUeXBlJykge1xyXG4gICAgICAgICAgICAgICAgc2hvd1RpbWUgPSB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChkYXRlRm9ybWF0ID09PSAneXl5eScpIHtcclxuICAgICAgICAgICAgICAgIHNob3dUeXBlID0gJzInO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChkYXRlRm9ybWF0ID09PSAneXl5eS1NTScpIHtcclxuICAgICAgICAgICAgICAgIHNob3dUeXBlID0gJzMnO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHQuY29udHJvbCA9IHtcclxuICAgICAgICAgICAgICAgIFwiY29udHJvbHR5cGVcIjogXCJkYXRldGltZVwiLFxyXG4gICAgICAgICAgICAgICAgXCJwbGFjZWhvbGRlclwiOiBcIuivt+mAieaLqeaXpeacn1wiLFxyXG4gICAgICAgICAgICAgICAgc2luZ2xlOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgZGF0ZUZvcm1hdCxcclxuICAgICAgICAgICAgICAgIHNob3dUaW1lLFxyXG4gICAgICAgICAgICAgICAgc2hvd1R5cGVcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHQ7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBjb252ZXJ0Q29sdW1uc1RvU2VhcmNoRmllbGRzKCkge1xyXG4gICAgICAgIGlmICh0aGlzLmNvbHVtbnMgJiYgdGhpcy5jb2x1bW5zLmxlbmd0aCkge1xyXG4gICAgICAgICAgICB0aGlzLmZpZWxkcyA9IHRoaXMuY29sdW1ucy5maWx0ZXIobiA9PiBuLmZpZWxkVHlwZSAmJiAobi5maWVsZFR5cGUgPT09ICdTdHJpbmdUeXBlJyB8fCBuLmZpZWxkVHlwZSA9PT0gJ1RleHRUeXBlJykpLm1hcChuID0+IHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29kZTogbi5maWVsZFBhdGgsXHJcbiAgICAgICAgICAgICAgICAgICAgbmFtZTogbi50aXRsZVxyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBpZiAoIXRoaXMuZmllbGRzLmxlbmd0aCAmJiB0aGlzLnNlYXJjaEZpZWxkcy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZmllbGRzID0gdGhpcy5zZWFyY2hGaWVsZHMubWFwKG4gPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvZGU6IG4udmFsdWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IG4ubGFiZWxcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKHRoaXMudmlld1R5cGUgPT09ICdib3RoJyB8fCB0aGlzLnZpZXdUeXBlID09PSAnb25seWZpZWxkJykge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5maWx0ZXJGaWVsZHMgPSB0aGlzLmNvbHVtbnMuZmlsdGVyKG4gPT4gbi5maWVsZFR5cGUgJiYgbi5maWVsZFR5cGUgIT09ICdTdHJpbmdUeXBlJyAmJiBuLmZpZWxkVHlwZSAhPT0gJ1RleHRUeXBlJyAmJiBuLmZpZWxkKS5tYXAobiA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuY29udmVyQ29sdW1uVG9GaWx0ZXJGaWVsZChuKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAodGhpcy5sb29rSW5zICYmIHRoaXMubG9va0lucy5hbGxvd1F1ZXJ5RmllbGRzKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCB7IG5hdiwgbWFpbiB9ID0gdGhpcy5sb29rSW5zLmFsbG93UXVlcnlGaWVsZHM7XHJcbiAgICAgICAgICAgICAgICBsZXQgcXVlcnlGaWVsZHMgPSBtYWluO1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuaXNOYXYpIHtcclxuICAgICAgICAgICAgICAgICAgICBxdWVyeUZpZWxkcyA9IG5hdjtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBpZiAocXVlcnlGaWVsZHMpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBfcXVlcnlGaWVsZHMgPSBxdWVyeUZpZWxkcy5zcGxpdCgnLCcpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZmllbGRzID0gdGhpcy5maWVsZHMuZmlsdGVyKG4gPT4gX3F1ZXJ5RmllbGRzLmZpbmRJbmRleChmID0+IGYgPT09IG4uY29kZSkgPiAtMSk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5maWx0ZXJGaWVsZHMgPSB0aGlzLmZpbHRlckZpZWxkcy5maWx0ZXIobiA9PiBfcXVlcnlGaWVsZHMuZmluZEluZGV4KChmOiBhbnkpID0+IGYgPT09IG4uY29kZSkgPiAtMSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHRoaXMuY2QubWFya0ZvckNoZWNrKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIG9uQ29uZGl0aW9uQ2hhbmdlKCRldmVudCwgaXNTdHJpbmcgPSB0cnVlKSB7XHJcbiAgICAgICAgaWYgKGlzU3RyaW5nKSB7XHJcbiAgICAgICAgICAgIHRoaXMudGV4dENvbmRpdGlvbnMgPSAkZXZlbnQ7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5maWVsZENvbmRpdG9ucyA9ICRldmVudDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMudGV4dENvbmRpdGlvbnMgPSB0aGlzLnRleHRDb25kaXRpb25zIHx8IFtdO1xyXG4gICAgICAgIGNvbnN0IF9jb25kaXRpb25zJCA9ICB0aGlzLmZpZWxkQ29uZGl0b25zLmNvbmNhdChbXSk7XHJcbiAgICAgICAgaWYgKHRoaXMuZmllbGRDb25kaXRvbnMgJiYgdGhpcy5maWVsZENvbmRpdG9ucy5sZW5ndGggJiYgdGhpcy50ZXh0Q29uZGl0aW9ucy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgX2NvbmRpdGlvbnMkWzBdLmxicmFja2V0ID0gIHRoaXMuZmllbGRDb25kaXRvbnNbMF0ubGJyYWNrZXQgKyAnKCc7XHJcbiAgICAgICAgICAgIF9jb25kaXRpb25zJFtfY29uZGl0aW9ucyQubGVuZ3RoIC0gMV0ucmVsYXRpb24gPSAxO1xyXG4gICAgICAgICAgICBfY29uZGl0aW9ucyRbX2NvbmRpdGlvbnMkLmxlbmd0aCAtIDFdLnJicmFja2V0ID0gIF9jb25kaXRpb25zJFtfY29uZGl0aW9ucyQubGVuZ3RoIC0gMV0ucmJyYWNrZXQgKyAnKSc7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIGNvbnN0IF9jb25kaXRpb25zID0gX2NvbmRpdGlvbnMkLmNvbmNhdCh0aGlzLnRleHRDb25kaXRpb25zKTtcclxuICAgICAgICB0aGlzLmNvbmRpdGlvbnNDaGFuZ2UuZW1pdChfY29uZGl0aW9ucyk7XHJcbiAgICB9XHJcblxyXG4gICAgb25DbGVhckNvbmRpdGlvbnMoJGV2ZW50OiBNb3VzZUV2ZW50KSB7XHJcbiAgICAgICAgJGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gICAgICAgIHRoaXMudGV4dENvbmRpdGlvbnMgPSBbXTtcclxuICAgICAgICB0aGlzLmZpZWxkQ29uZGl0b25zID0gW107XHJcblxyXG5cclxuICAgICAgICBpZiAodGhpcy5zZWFyY2hib3hSZWYpIHtcclxuICAgICAgICAgICAgdGhpcy5zZWFyY2hib3hSZWYuY2xlYXJDb25kaXRpb25zKGZhbHNlKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh0aGlzLnNlYXJjaGZpZWxkc1JlZikge1xyXG4gICAgICAgICAgICB0aGlzLmZpbHRlckZpZWxkcy5mb3JFYWNoKG4gPT4ge1xyXG4gICAgICAgICAgICAgICAgbi52YWx1ZSA9IG51bGw7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB0aGlzLnNlYXJjaGZpZWxkc1JlZi5jbGVhckNvbmRpdGlvbnMoZmFsc2UpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5jZC5kZXRlY3RDaGFuZ2VzKCk7XHJcbiAgICAgICAgdGhpcy5jb25kaXRpb25zQ2hhbmdlLmVtaXQoW10pO1xyXG4gICAgfVxyXG5cclxuICAgIG9uRXNjKCRldmVudCkge1xyXG4gICAgICAgIHRoaXMubG9va0lucy5jbG9zZUxvYWRpbmcoKTtcclxuICAgICAgICB0aGlzLmxvb2tJbnMuY2xvc2VEaWFsb2coKTtcclxuICAgIH1cclxufSJdfQ==
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@farris/ui-shortcuts"),require("@farris/ui-common/types"),require("rxjs"),require("@angular/platform-browser"),require("lodash-es"),require("@angular/common"),require("@angular/forms"),require("@farris/ui-layout"),require("@farris/ui-messager"),require("@farris/ui-datatable"),require("@farris/ui-treetable"),require("@farris/ui-loading"),require("@farris/ui-context-menu"),require("@farris/ui-forms"),require("@angular/animations"),require("@farris/ui-locale"),require("@farris/ui-input-group"),require("rxjs/operators"),require("@farris/ui-search-box"),require("@farris/ui-dialog"),require("@angular/core"),require("@farris/ui-common"),require("@farris/ui-notify")):"function"==typeof define&&define.amd?define("@farris/ui-lookup",["exports","@farris/ui-shortcuts","@farris/ui-common/types","rxjs","@angular/platform-browser","lodash-es","@angular/common","@angular/forms","@farris/ui-layout","@farris/ui-messager","@farris/ui-datatable","@farris/ui-treetable","@farris/ui-loading","@farris/ui-context-menu","@farris/ui-forms","@angular/animations","@farris/ui-locale","@farris/ui-input-group","rxjs/operators","@farris/ui-search-box","@farris/ui-dialog","@angular/core","@farris/ui-common","@farris/ui-notify"],t):t((e.farris=e.farris||{},e.farris["ui-lookup"]={}),e.uiShortcuts,e.types,e.rxjs,e.ng.platformBrowser,e.lodashEs,e.ng.common,e.ng.forms,e.uiLayout,e.uiMessager,e.uiDatatable,e.uiTreetable,e.uiLoading,e.uiContextMenu,e.uiForms,e.ng.animations,e.uiLocale,e.uiInputGroup,e.rxjs.operators,e.uiSearchBox,e.uiDialog,e.ng.core,e.uiCommon,e.uiNotify)}(this,function(e,t,p,u,h,f,i,n,s,a,o,r,l,c,d,g,v,m,y,b,C,S,k,I){"use strict";var T=function(e,t){return(T=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)};var x=function(){return(x=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++)for(var s in t=arguments[i])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e}).apply(this,arguments)};function w(e,t){var i="function"==typeof Symbol&&e[Symbol.iterator];if(!i)return e;var n,s,a=i.call(e),o=[];try{for(;(void 0===t||0<t--)&&!(n=a.next()).done;)o.push(n.value)}catch(r){s={error:r}}finally{try{n&&!n.done&&(i=a["return"])&&i.call(a)}finally{if(s)throw s.error}}return o}function D(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(w(arguments[t]));return e}var F="__favorite__",R={List:"LIST",TreeList:"TREELIST",NavList:"NAVLIST",NavTreeList:"NAVTREELIST",NavListTree:"NAVLISTTREE"},O='<span class="f-icon f-icon-star f-lookup-favorite" style="font-size:12px" ></span>',E='<span class="f-icon f-icon-star-outline f-lookup-favorite" style="font-size:12px"></span>',L='<span class="f-icon f-icon-star f-lookup-unfavorite" style="font-size:12px"></span>',M='<span class="f-icon f-icon-minus-circle" style="font-size:12px; color: #dd2438;cursor: pointer"></span>',P="append item to favorite.",N="remove favorite.",_={enable:!1,showMore:!0,showItemsCount:10,footerHeight:0,minWidth:200,enableBackspace:!1},z="both",V={provide:n.NG_VALUE_ACCESSOR,useExisting:S.forwardRef(function(){return A}),multi:!0},A=(Object.defineProperty(H.prototype,"content",{set:function(e){this.dialog!==e&&(this.dialog=e)&&this.dialogCreated.next(this.dialog)},enumerable:!0,configurable:!0}),Object.defineProperty(H.prototype,"isShow",{get:function(){return this._isShow},set:function(e){this._isShow=e,this.changeDetector.destroyed||this.changeDetector.detectChanges()},enumerable:!0,configurable:!0}),Object.defineProperty(H.prototype,"invalid",{get:function(){return this.ngControl.valid},enumerable:!0,configurable:!0}),H.prototype.ngOnInit=function(){this.initEvents(),this.ngControl=this.injector.get(n.NgControl,null)},H.prototype.ngOnDestroy=function(){this.lookupUnsubscribe()},H.prototype.ngAfterViewChecked=function(){var e=this;this.dialog&&this.dialog.closed.subscribe(function(){e.isShow=!1,e.dialog=null})},H.prototype.initEvents=function(){this.dictPicking||(this.dictPicking=function(){return u.of({showDialog:!0})}),this.dictPicked||(this.dictPicked=function(){return u.of({closeDialog:!0})}),this.beforeOpen||(this.beforeOpen=function(){return u.of(!0)}),this.beforeClose||(this.beforeClose=function(){return u.of(!0)}),this.dialogHeight||(this.dialogHeight=this.defaultDialogSize.height),this.dialogWidth||(this.dialogWidth=this.defaultDialogSize.width)},H.prototype.showDialog=function(){var t=this;return this.disabled||this.readonly||this.dictPicking().subscribe(function(e){!1!==e.showDialog&&(t.isShow=!0,t.ngZone.runOutsideAngular(function(){setTimeout(function(){return t.dialog.show()})}))}),!1},H.prototype.closeDialog=function(){this.isShow=!1,this.dialog&&this.dialog.close()},H.prototype.lookupUnsubscribe=function(){this.dictPickedSubscription&&this.dictPickedSubscription.unsubscribe(),this.dictPickingSubscription&&this.dictPickingSubscription.unsubscribe(),this.dialogCreatedSubscription&&this.dialogCreatedSubscription.unsubscribe()},H.prototype.onResizing=function(e){this.resizing.emit(e.size)},H.prototype.onResized=function(e){this.resized.emit(e.size)},H.prototype.onMaxDialog=function(e){this.dialogMaxed.emit(e.size)},H.prototype.writeValue=function(e){e?(this.displayText=e,this.displayValue=e,this.originalText=this.displayText):(this.displayText="",this.displayValue="",this.originalText="")},H.prototype.registerOnChange=function(e){this.onModelChange=e},H.prototype.registerOnTouched=function(e){this.onModelTouched=e},H.prototype.setDisabledState=function(e){this.disabled=e},H.decorators=[{type:S.Component,args:[{selector:"farris-lookup",template:'\n        <div\n            class="lookupbox input-group"\n            [ngClass]="{\n                \'f-state-disabled\': disabled,\n                \'f-state-readonly\': readonly,\n                \'f-state-editable\': !editable\n            }"\n        >\n            <input\n                class="form-control"\n                [value]="displayText"\n                [disabled]="disabled"\n                [readonly]="!editable || readonly"\n            />\n            <div class="input-group-append">\n                <span class="f-select input-group-text" (click)="showDialog()">\n                    <i class="f-icon f-icon-lookup"></i>\n                </span>\n            </div>\n        </div>\n        <farris-dialog\n            #dialog\n            *ngIf="isShow"\n            [title]="title"\n            [beforeOpen]="beforeOpen"\n            [beforeClose]="beforeClose"\n            [width]="dialogWidth"\n            [height]="dialogHeight"\n            [showButtons]="showButtons"\n            [showMaxButton]="showMaxButton"\n            [buttons]="buttonsRef || defaultButtonRef"\n            [buttonAlign]="buttonAlign"\n            (maxed)="onMaxDialog($event)"\n            (resized)="onResized($event)"\n            (resizing)="onResizing($event)"\n        >\n            <ng-content></ng-content>\n\n            <ng-template #defaultButtonRef>\n                <div style="width: 100%;">\n                    <button\n                        class="btn btn-secondary btn-lg"\n                        (click)="closeDialog()"\n                    >\n                        Cancel\n                    </button>\n                    <button class="btn btn-primary btn-lg">Ok</button>\n                </div>\n            </ng-template>\n        </farris-dialog>\n    ',providers:[V],styles:["\n            .input-group {\n                flex-wrap: nowrap;\n            }\n            :host-context(.ng-invalid) .form-control {\n                border-color: #ff0303;\n            }\n        "]}]}],H.ctorParameters=function(){return[{type:S.Injector},{type:S.ElementRef},{type:S.ChangeDetectorRef}]},H.propDecorators={hostCls:[{type:S.HostBinding,args:["class"]}],dialogWidth:[{type:S.Input}],dialogHeight:[{type:S.Input}],title:[{type:S.Input}],buttonAlign:[{type:S.Input}],buttonsRef:[{type:S.Input}],showButtons:[{type:S.Input}],showCloseButton:[{type:S.Input}],showMaxButton:[{type:S.Input}],resizable:[{type:S.Input}],draggable:[{type:S.Input}],disabled:[{type:S.Input}],editable:[{type:S.Input}],readonly:[{type:S.Input}],mapFields:[{type:S.Input}],valueField:[{type:S.Input}],textField:[{type:S.Input}],displayText:[{type:S.Input}],context:[{type:S.Input}],beforeOpen:[{type:S.Input}],beforeClose:[{type:S.Input}],dictPicking:[{type:S.Input}],dictPicked:[{type:S.Input}],dialogOpened:[{type:S.Output}],dialogClosed:[{type:S.Output}],dialogMaxed:[{type:S.Output}],resizing:[{type:S.Output}],resized:[{type:S.Output}],content:[{type:S.ViewChild,args:["dialog"]}]},H);function H(e,t,i){this.injector=e,this.el=t,this.changeDetector=i,this.hostCls="f-cmp-inputgroup",this.title="",this.buttonAlign="right",this.showButtons=!0,this.showCloseButton=!0,this.showMaxButton=!0,this.resizable=!0,this.draggable=!0,this.disabled=!1,this.editable=!0,this.readonly=!1,this.displayText="",this.dialogOpened=new S.EventEmitter,this.dialogClosed=new S.EventEmitter,this.dialogMaxed=new S.EventEmitter,this.resizing=new S.EventEmitter,this.resized=new S.EventEmitter,this.defaultDialogSize={width:550,height:570},this.dialogCreated=new u.Subject,this._isShow=!1,this.displayValue="",this.originalText="",this.onModelChange=function(e){},this.onModelTouched=function(e){},this.ngZone=this.injector.get(S.NgZone)}var j=function qe(){},B={singleSelect:!0,showFilterBar:!0,pagination:!0,pageIndex:1,pageSize:10,pageList:[10,20,30,50,100]},q={title:"此处显示标题",favorites:"收藏夹",okText:"确定",cancelText:"取消",allColumns:"所有列"},W=new S.InjectionToken("Lookup Grid HTTP service"),$=(U.decorators=[{type:S.Injectable}],U.ctorParameters=function(){return[{type:k.CommonUtils}]},U);function U(e){var a=this;this.utils=e,this.lookupFieldMap=function(e,n,s){n&&Object.keys(n).forEach(function(t){var i="";e&&(i=e instanceof Array?e.map(function(e){return a.utils.getValue(t,e)}).join(","):a.utils.getValue(t,e)),n[t].split(",").forEach(function(e){var t=f.trim(e);a.utils.setValue(s,t,i)})})}}var G=(K.prototype.setActiveLookupInstance=function(e){this.rts&&this.rts.setLookupInstance(e)},K.prototype.destroy=function(){this.rts.destroy()},K.prototype.pendingStart=function(){this.rts&&(this.rts.updateFormState({lookup:{pending:!0}}),document.body.style["pointer-events"]="none")},K.prototype.pendingEnd=function(){this.rts&&(this.rts.updateFormState({lookup:{pending:!1}}),document.body.style["pointer-events"]="")},K.prototype.getPathCode=function(e,t){void 0===t&&(t=null);var i=t.dataField,n=t.pathField;return i?e[i][n]:this.utils.getValue(n,e)},K.prototype.getLayerData=function(e,t){void 0===t&&(t=null);var i=t.dataField,n=t.layerField;return i?e[i][n]:this.utils.getValue(n,e)},K.prototype.createFilterCondition=function(e,t){return{filterField:e,value:t,lbracket:"",rbracket:"",relation:p.FilterRelation.Or,compare:p.Compare.Like}},K.prototype.mergeCondition=function(e,t,i){var n=this;e=e?f.cloneDeep(e):{pagination:{pageIndex:1,pageSize:20},filterConditions:[],sortConditions:[]};var s=x({},i),a=s.field,o=void 0===a?"*":a,r=s.value,l=void 0===r?"":r;if(l)if("*"===o){if(t&&t.length){var c=t.map(function(e){return n.createFilterCondition(e,l)});if(c.length){c[0].lbracket="(";var d=c[c.length-1];d.rbracket=")",d.relation=p.FilterRelation.Empty}e.filterConditions&&e.filterConditions.length?(e.filterConditions[e.filterConditions.length-1].relation=p.FilterRelation.And,e.filterConditions=e.filterConditions.concat(c)):e.filterConditions=c}}else{var h=this.createFilterCondition(o,l);h.relation=p.FilterRelation.Empty,e.filterConditions&&e.filterConditions.length?(e.filterConditions[e.filterConditions.length-1].relation=p.FilterRelation.And,e.filterConditions.push(h)):e.filterConditions=[h]}return e},K.prototype.canSelectable=function(e){return!e.hasOwnProperty("farris_selectable")||!!e.farris_selectable},K.prototype.makeTreeWithParentID=function(e,a,o,r){var l=this;void 0===o&&(o="parentId"),void 0===r&&(r="id");var c=new Map,d=[],h=[];return e.forEach(function(e){var t={data:e,children:[],selectable:l.canSelectable(e),parent:null,parents:[]},i=e[r];c.set(i,t);var n=l.utils.getValue(o,e);if(n===a)d.push(t);else{var s=c.get(n);s?(t.parent=n,t.parents=D(s.parents,[n]),s.children.push(t)):h.push(t)}}),h.forEach(function(e){var t=l.utils.getValue(o,e.data),i=c.get(t);i&&(e.parent=t,e.parents=D(i.parents,[t]),i.children.push(e))}),d},K.prototype.makeTree=function(e,a){var o=this,r=new Map,l=[],c=[];return e.forEach(function(e){var t={data:e,children:[],selectable:o.canSelectable(e)},i=o.getPathCode(e,a);if(r.set(i,t),1===o.getLayerData(e,a))l.push(t);else{var n=i.substr(0,i.length-4),s=r.get(n);s?s.children.push(t):c.push(t)}}),c.forEach(function(e){var t=o.getPathCode(e.data,a),i=r.get(t.substr(0,t.length-4));i&&i.children.push(e)}),l},K.decorators=[{type:S.Injectable}],K.ctorParameters=function(){return[{type:k.CommonUtils},{type:k.RuntimeStateService},{type:S.NgZone}]},K);function K(e,t,i){this.utils=e,this.rts=t,this.ngZone=i}var Q=(Object.defineProperty(J.prototype,"personalConfigKey",{get:function(){return this._key},set:function(e){e?(this._key=this.buildKey(e),this.controlID?this._newKey=this.buildKey(this.controlID+"_"+e):this._newKey=this._key):this._newKey=this.buildKey(this.controlID)},enumerable:!0,configurable:!0}),J.prototype.buildKey=function(e){var t,i="";return i=location.hash?(t=location.hash.split("?"))?t[0]:"":(t=location.pathname.split("/"))?t[t.length-1]:"",this.idService.encrypt(i+e)},J.prototype.initPersonalConf=function(e){Object.assign(this,e)},J.prototype.getPersonalData=function(e){if(e&&(this._key=e),this.personalConfigKey){var t=localStorage.getItem(this.personalConfigKey);return t&&"undefined"!==t&&"null"!==t?(this.personalConf=t?JSON.parse(t):{},this._updatePersonalConfig(this.personalConf),this.controlID&&(this._key!==this._newKey&&localStorage.removeItem(this._key),this.savePersonalConfig(this.personalConf)),this.personalConf):null}return null},J.prototype.getQuickSelected=function(e){var t=this.getPersonalData(),i=t?t.quickSelected:null;if(e){if(i){var n=i[e];if(n&&n.length)return n}return null}return i},J.prototype.getDialogSize=function(){var e=this.getPersonalData();return e?e.size:null},J.prototype.updatePersonalConfig=function(e){var t=Object.assign(this.personalConf||{},e);this.savePersonalConfig(t)},J.prototype.savePersonalConfig=function(i){if(this._newKey){var n=localStorage.getItem(this._newKey);return n&&(n=JSON.parse(n)).favorite&&(i.favorite?Object.keys(n.favorite).forEach(function(e){if(i.favorite[e]=i.favorite[e]||[],n.favorite[e]){var t=Array.from(new Set(D(i.favorite[e],n.favorite[e])));i.favorite[e]=t}}):i.favorite=n.favorite),localStorage.setItem(this._newKey,JSON.stringify(i)),this.personalConf=i,!0}return!1},J.prototype.getActiveTabIndex=function(e){var t=this.getPersonalData();return e||(t&&t.tabIndex?t.tabIndex:"datalist")},J.prototype.updateQueckSelected=function(e,t){var i,n,s=this,a=this.getQuickSelected(t);if(a&&a.length){var o=[];a.forEach(function(t,i){s.singleSelect?t&&e&&t[s.idField]===e[s.idField]&&o.push(i):e&&e.forEach(function(e){t&&t[s.idField]===e[s.idField]&&o.push(i)})}),o.forEach(function(e){a[e]=null}),this.personalConf.quickSelected[t]=this.personalConf.quickSelected[t].filter(function(e){return null!==e}),this.singleSelect?this.personalConf.quickSelected[t].unshift(e):e&&e.forEach(function(e){s.personalConf.quickSelected[t].unshift(e)}),this.personalConf.quickSelected[t].length=5<this.personalConf.quickSelected[t].length?5:this.personalConf.quickSelected[t].length}else{var r=this.personalConf.quickSelected||{},l=void 0;l=this.singleSelect?Object.assign(r,((i={})[t]=[e],i)):(e.length=5<e.length?5:e.length,Object.assign(r,((n={})[t]=e,n))),this.personalConf.quickSelected=l}this.savePersonalConfig(this.personalConf)},J.prototype._updatePersonalConfig=function(e){if(e){var t=!1;e.favorite&&Array.isArray(e.favorite)&&(e.favorite={"zh-CHS":D(e.favorite)},delete e.favorite,t=!0),e.selected&&(Array.isArray(e.selected)&&(e.quickSelected={"zh-CHS":D(e.selected)}),delete e.selected,t=!0),t&&this.savePersonalConfig(e)}},J.decorators=[{type:S.Injectable}],J.ctorParameters=function(){return[{type:k.IdService}]},J);function J(e){this.idService=e,this.selectItemObser$=new u.Subject,this.displayType="LIST",this.singleSelect=!0,this._key="",this._newKey="",this.controlID=""}var Z=function We(e){this.instance=e},Y=(X.prototype.getTreeInfo=function(e){if(e.data[this.treeInfo.dataField])return e.data[this.treeInfo.dataField];var t=e.data;if(t&&this.treeInfo.dataField){var i=this.treeInfo.dataField.toLowerCase(),n=Object.keys(e.data).find(function(e){return e.toLowerCase()===i});if(n)return t[n];this.instance.writeConsole("未找到树形信息数据字段【"+this.treeInfo.dataField+"】","error")}else this.instance.writeConsole("未找到树形信息数据字段【"+this.treeInfo.dataField+"】","error")},X.prototype.getTreeNodeLayer=function(e){return this.getTreeInfo(e)[this.treeInfo.layerField]},X.prototype.updateTreeNodeExpanded=function(e,t){var i=this;void 0===t&&(t=null),this.treeInfo=t||this.instance.treeInfo;var n=this.instance.expandLevel;-1!==n&&(this.flatAllNodes.length||(this.flatAllNodes=this.treeData2Flat(null,e,0,[])),e.forEach(function(e){e.expanded=i.shoudExpand(n,i.getTreeNodeLayer(e)),i.isSelectNodeParent(e)&&(e.expanded=!0),e.children&&e.children.length?i.updateTreeNodeExpanded(e.children,t):e.leaf=!0}))},X.prototype.treeData2Flat=function(o,e,r,l){var c=this,d=this.instance.idField,h=[];return e&&e.length&&e.forEach(function(e,t){var i=[];if(o){var n=o.data[d],s=l||[];(i=i.concat(s.map(function(e){return e}))).push(n)}var a={id:e.data[d],node:e,level:r,parents:i};h.push(a),h=h.concat(c.treeData2Flat(e,e.children,r+1,i))}),h},X.prototype.shoudExpand=function(e,t){return-1!==e&&(0===e||t<=e)},X.prototype.isSelectNodeParent=function(e){var t=this;if(this.instance.navSelectedIds){var i=this.flatAllNodes.find(function(e){return e.id===t.instance.navSelectedIds}).parents;return!(!i||!i.length)&&i.includes(e.id)}return!1},X.prototype.getLeafNode=function(e){return!e||e.children&&e.children.length?1===e.children.length?this.getLeafNode(e.children[0]):e.children:e},X.prototype.flatTreeNodes=function(e,t){var i=this;return void 0===t&&(t=[]),(e=e||[]).reduce(function(e,t){return e.push(t),t.children&&t.children.length&&i.flatTreeNodes(t.children,e),e},t)},X);function X(e){this.instance=e,this.flatAllNodes=[]}var ee=(te.prototype.getFavoriteColumns=function(){var e=this.instance.gridOptions.columns.map(function(e){var t=Object.assign({},e);return e.field===F&&(t.formatter=function(){return L}),t});return this.instance.initColumnWidth(e,"fav"),e},te.prototype.initPersonalInfo=function(){if(this.instance.personalConfigService){var e=this.instance.el.nativeElement.id||this.instance.controlId;e||this.instance.writeConsole("LookupGrid - 未设置组件id, 收藏功能将不能正常，请设置组件id.");var t=this.instance.getLookupBindingFields();this.instance.personalConfigService.controlID=e,this.instance.personalConfigService.personalConfigKey=t;var i={displayType:this.instance.displayType,singleSelect:this.instance.singleSelect,idField:this.instance.idField,textField:this.instance.textField,mapFields:Object.assign({},this.instance.mapFields||{})};this.instance.personalConfigService.initPersonalConf(i),this.listenPersonalConfigHandler()}},te.prototype.initFavoriteComponentEvent=function(e){var a=this;switch(this.instance.displayType){case R.NavList:case R.NavTreeList:case R.List:var t=e.instance;t.remoteSort=!1,t.selectedRow.subscribe(function(e){a.instance.singleSelect&&a.lookupSelectionSer.clearSelections(),a.lookupSelectionSer.updateSelections(e.data)}),t.unSelectRow.subscribe(function(e){a.lookupSelectionSer.unSelect(e.data[a.instance.idField])}),t.singleSelect||t.checkAll.subscribe(function(e){a.lookupSelectionSer.updateSelections(t.data,e)}),t.cellClick.subscribe(function(t){if(t.col.field===F&&(t.event.stopPropagation(),t.event.target.classList.contains("f-lookup-unfavorite"))){if(a.instance.items){a.instance.items.forEach(function(e){e[a.instance.idField]===t.row[a.instance.idField]&&(e[F]=!1)});var e=a.instance.componentRef.instance;e&&e.loadData({pageSize:a.instance.gridOptions.pageSize,pageIndex:a.instance.gridOptions.pageIndex,total:a.instance.gridOptions.total,data:a.instance.gridOptions.items})}a.instance.favoriteItems=a.instance.favoriteItems.filter(function(e){return e[a.instance.idField]!==t.row[a.instance.idField]}),a.lookupSelectionSer.updateFavoriteData(t.row,N)}}),t.rowDblClick.subscribe(function(e){a.instance.gridOptions.singleSelect&&a.instance.selectItem(e)});break;case R.TreeList:if(e){var i=e.instance;i.remoteSort=!1,i.nodeSelected.subscribe(function(e){a.instance.singleSelect&&a.lookupSelectionSer.clearSelections(),a.lookupSelectionSer.updateSelections(e.node.data)}),i.nodeUnChecked.subscribe(function(e){e.nodes&&e.nodes.length?a.instance.multiSelMgr.remove(e.nodes.map(function(e){return e.id})):e&&e.node&&e.node.data&&e.node.data.id&&a.lookupSelectionSer.unSelect(e.node.data.id)}),i.nodeChecked.subscribe(function(e){a.instance.singleSelect||(e.nodes&&e.nodes.length?a.instance.multiSelMgr.updateSelections(e.nodes.map(function(e){return e.data})):Array.isArray(e.node)?a.instance.multiSelMgr.updateSelections(e.node.map(function(e){return e.data})):a.instance.multiSelMgr.updateSelections([e.node.data]))}),i.cellClick.subscribe(function(i){if(i.col.field===F&&(i.event.stopPropagation(),i.event.target.classList.contains("f-lookup-unfavorite"))){var n=a.instance;!function s(e){if(e){var t=!1;e.forEach(function(e){t||(e.data[n.idField]===i.node[n.idField]?(e.data[F]=!1,t=!0):e.children&&0<e.children.length&&s(e.children))})}}(a.instance.items),a.instance.componentRef.instance.loadData(a.instance.items),a.lookupSelectionSer.updateFavoriteData(i.node.data,N)}}),i.dblClick.subscribe(function(e){a.instance.gridOptions.singleSelect&&e.selectable&&a.instance.okButton&&a.instance.okButton.nativeElement.click()}),i.checkAll.subscribe(function(e){var t=e.instance.checkeds.map(function(e){return e.data});a.instance.multiSelMgr.updateSelections(t),a.instance.checkedChange.emit({data:t,isCheck:!0})}),i.unCheckAll.subscribe(function(){var e=i.state.rowNodes.map(function(e){return e.node.data});a.lookupSelectionSer.updateSelections(e,!1),a.instance.checkedChange.emit({data:[],isCheck:!1})})}}},te.prototype.getFavoritData=function(){if(this.instance.personalConf){var e=this.instance.personalConf.favorite;return e&&e[this.instance.localService.localeId]?e[this.instance.localService.localeId]:[]}return[]},te.prototype.getFavoritIds=function(){return this.getFavoritData()},te.prototype._loadFavoriteData=function(e){void 0===e&&(e=null);var t=this.instance.favoritesComponentRef.instance;this.loadFavoriteDatatable(t,e),t.cd.markForCheck(),this.instance.closeLoading()},te.prototype.loadFavoritesData=function(e){switch(void 0===e&&(e=null),this.getFavoritIds(),this.instance.displayType){case R.NavList:case R.NavTreeList:case R.List:var t=this.instance.favoritesComponentRef.instance;if("locale"===this.instance.favoriteDataFrom)e&&this._loadFavoriteData(e.items);else{var i=this.getFavoritData();this.loadFavoriteDatatable(t,e?e.items:i)}break;case R.TreeList:if(this.instance.favoritesComponentRef&&this.instance.favoritesComponentRef.instance instanceof r.TreeTableComponent){var n=this.instance.favoritesComponentRef.instance;this.bindFavTreetable(n),"locale"===this.instance.favoriteDataFrom?e&&this.loadFavoriteForTreeTable(e.items||[],n):e&&this.loadFavoriteForTreeTable(e.items,n)}}},te.prototype.loadFavoriteDatatable=function(e,t){t!==undefined&&(this.instance.favoriteItems=t),e.columns&&!e.columns.length&&(e.columns=this.instance.favoriteColumns),e.loadData({total:0,pageSize:20,pageIndex:1,data:this.instance.favoriteItems}),this.instance.selectionMgr.selectCurrentValue(),e.cd.detectChanges()},te.prototype.bindFavTreetable=function(e){var n=this;e.allColumnsTitle=this.instance.allColumnsTitle,e.idField=this.instance.idField;var t=this.instance.gridOptions.columns.map(function(e){var t=x({},e);return e.field===F&&(t.formatter=function(e,t){var i=n.getFavoritIds();return i&&i.length&&0<=i.findIndex(function(e){return e===t[n.instance.idField]})?L:""}),t});this.instance.initColumnWidth(t,"fav"),this.instance.favoriteColumns=t,e.columns=t,this.instance.gridOptions.treeInfo&&(e.onlySelectLeaf=this.instance.gridOptions.treeInfo.onlySelectLeaf),e.singleSelect||(e.checkOnSelect=!0,e.selectOnCheck=!0,e.showCheckbox=!0,this.instance.enableCascade?this.instance.ttEventMgr.cascadeValueChanged(this.instance.cascadeStatus):(e.cascadeCheck=!1,e.cascadeDown=!1,e.cascadeUp=!1))},te.prototype.checkNodeIsLeaf=function(e){var t=this;return e&&e.length?e.map(function(e){return e.hasOwnProperty("addtional")&&(e.selectable=!e.addtional),e.children&&e.children.length?t.checkNodeIsLeaf(e.children):e.leaf=!0,e}):e},te.prototype.initFavoriteTreeData=function(e){var t=this.instance.gridOptions.treeInfo;return t&&!t.treeDataIsInit&&(e="pathcode"===t.layerType.toLowerCase()?this.instance.lookupUtils.makeTree(e,t):this.instance.lookupUtils.makeTreeWithParentID(e,"",t.dataField?t.dataField+"."+t.parentField:t.parentField,this.instance.idField)),this.checkNodeIsLeaf(e)},te.prototype.loadFavoriteForTreeTable=function(e,t){return e=this.initFavoriteTreeData(e),this.instance.favoriteItems=e,t.loadData(e),t.expandAll(),this.instance.selectionMgr.selectCurrentValue(),e},te.prototype.updateFavoritesStatus=function(e){var i=this;if(e&&this.instance.useFavorite){var n=this.getFavoritIds();if(n&&n.length)if(this.instance.displayType!==R.TreeList)e.map(function(t){n&&n.length&&n.find(function(e){return e===t[i.instance.idField]})&&(t[F]=!0)});else{var s=this.instance;!function a(e){e.forEach(function(t){n&&n.length&&n.find(function(e){return e===t.data[s.idField]})&&(t.data[F]=!0),t.children&&0<t.children.length&&a(t.children)})}(e)}}},te.prototype._updateFavorites=function(e,t,i){var n=this,s=this.instance.localService.localeId;this.instance.personalConf.favorite=this.instance.personalConf.favorite||{};var a=e.filter(function(e){return!e._addtional_}).map(function(e){return e[n.instance.idField]}).filter(function(e){return null!==e&&e!==undefined}),o=this.instance.personalConf.favorite[s]||[];return this.instance.personalConf.favorite[s]=Array.from(new Set(D(o,a))),t===N&&i&&(this.instance.personalConf.favorite[s]=this.instance.personalConf.favorite[s].filter(function(e){return e!==i[n.instance.idField]})),this.instance.personalConf.favorite[s]},te.prototype.listenPersonalConfigHandler=function(){var r=this;this.lookupSelectionSer.favoriteItems$.subscribe(function(e){if(r.instance.favoritesComponentRef){var t=e.items,i=e.action,n=e.data,s=r._updateFavorites(t,i,n);if(r.instance.httpMgr.submitFavoriteData(i),r.instance.displayType===R.List||r.instance.displayType.includes("NAV")){var a=r.instance.favoritesComponentRef.instance;r.loadFavoriteDatatable(a,t)}else if(r.instance.displayType===R.TreeList){var o=r.instance.favoritesComponentRef.instance;r.instance.showLoading(),r.instance.httpMgr.getData({favoriteIds:s},"fav").subscribe(function(e){if(e){var t=e.items;r.loadFavoriteForTreeTable(t,o)}else r.instance.favoriteItems=[],o.loadData([]);r.instance.closeLoading()})}}})},te);function te(e){var a=this;this.instance=e,this.favoriteColumnFormatter=function(e,t){var i=e?O:E;if(a.instance.isTree()){var n=t[a.instance.idField];if(n){var s=a.instance.componentRef.instance.findRowNode(n);if(s)return s.node.selectable?i:""}}return i},this.lookupSelectionSer=this.instance.lookupSelectionSer}var ie=(ne.prototype.destroy=function(){},ne.prototype.getBindingData=function(){var e=this.ins.bindingData;if(this.ins.ngControl&&this.ins.ngControl.formDirective&&this.ins.ngControl.formDirective.form&&this.ins.ngControl.formDirective.form.bindingData){var t=this.ins.ngControl.formDirective.form.bindingData;(e=t).getObject&&(e=t.getObject().toJSON())}return e},ne.prototype.initDisplayValue=function(){var e=this.getBindingData();if(e&&this.ins.mapFields){var t=this.ins.idField,i=this.ins.mapFields[t];if(i){-1<i.indexOf(",")&&(i=i.split(",")[0]);var n=this.ins.utils.getValue(i,e);n&&(this.ins.displayValue=n)}}},ne.prototype._clearSelections=function(){var e=this.getDataCmpInstance().cmpRefInstance;e&&(this.ins.isTree()?(e.clearAll(!1),e.cdRef.destroyed||e.cdRef.detectChanges()):(e.dtBody.selectedRowIndex=-1,e.dtBody.selections=undefined,e.cd.destroyed||e.cd.detectChanges()))},ne.prototype.selectCurrentValue=function(e){var t=this;if(void 0===e&&(e=[]),this.ins.enableToSelect){var i=this.getDataCmpInstance(),n=i.cmpRefInstance,s=i.items;if(n&&s&&s.length){if(this._clearSelections(),!e||!e.length){var a=this.ins.lookupSelectionSer.getSelections();a.length&&(e=a.map(function(e){return e[t.ins.idField]}))}e&&e.length&&(this.ins.isTree()?(this.selected4Treetable(n,e),n.cdRef.destroyed||n.cdRef.detectChanges()):(this.selected4Datatable(n,s,e),n.cd.destroyed||n.cd.detectChanges()))}}},ne.prototype.getDataCmpInstance=function(){var e=null,t=null;return"datalist"===this.ins.activeTab?this.ins.isTree()?t=(e=this.ins.lookupCmpMgr.getComponentInstance("treetable")).serializedValue:(t=this.ins.items,e=this.ins.lookupCmpMgr.getComponentInstance()):"favorite"===this.ins.activeTab&&(e=this.ins.lookupCmpMgr.getComponentInstance("fav"),t=this.ins.favoriteItems),{cmpRefInstance:e,items:t}},ne.prototype.selected4Datatable=function(i,e,n){var s=this;this.ins.singleSelect?e.forEach(function(e,t){e[s.ins.idField]===n[0]&&(i.dtBody.isSelected(e)||(i.dtBody.selectedRowIndex=-1,i.dtBody.selectedRow("",t,e)))}):n.forEach(function(t){e.find(function(e){return e[s.ins.idField]==t})&&i.checkRow(t)})},ne.prototype.selected4Treetable=function(e,t){this.ins.singleSelect?e.selectNode(t[0],!1,!1):(e.checkedNodes(t,!1,!1,!0),e.selectNodes(t))},ne.prototype.getSelectedIds=function(){var e=[],t=this.ins.multipleChoiceSeparator;return!this.ins.singleSelect&&this.ins.displayValue&&-1<(""+this.ins.displayValue).indexOf(t)?e=this.ins.displayValue.split(t):null!==this.ins.displayValue&&""!==this.ins.displayValue&&this.ins.displayValue!==undefined&&(e=[this.ins.displayValue]),e},ne);function ne(e){this.ins=e}var se=(ae.prototype.conditionsChange=function(e){(this.ins.conditions=e)&&1===e.length&&"*"==e[0].code?(this.ins.conditions=[],this.onSearch({field:"*",value:e[0].value})):this.onSearch()},ae.prototype.onSearch=function(e){var t=this;if(void 0===e&&(e={field:"*",value:""}),!e||"*"===e.field||e.value){var i={pageInfo:{pageIndex:1,pageSize:this.ins.gridOptions.pageSize},search:e};if(this._sortState){var n=this._sortState,s=n.sortName,a=n.sortOrder;s&&(i.sortName=s,i.sortOrder=a)}this.ins.uri?this.ins.searching||(this.ins.searching=!0,this.ins.navNodePathCode&&(i.navNodePathCode=this.ins.navNodePathCode),this.ins.httpMgr.getData(i,"list").pipe(y.catchError(function(e){return t.ins.searching=!1,u.of({_ERROR_:e})}),y.tap(function(){t.ins.searching=!1})).subscribe(function(e){if(t.ins.searching=!1,t.ins.closeLoading(),e._ERROR_)throw new Error(e._ERROR_);t._loadData(e)})):this.ins.enableMultiFieldSearch?this.ins.query.emit({conditions:this.ins.conditions,instance:this.ins}):this.ins.search.emit(i)}else this.ins.messagerService.warning(this.ins.mustWriteSomething)},ae.prototype._loadData=function(e){var t=this.ins;t.closeLoading(),t.favHelper.updateFavoritesStatus(e.items),t.loadDataTableData(e),this.ins.selectionMgr.selectCurrentValue()},ae.prototype.bindDataTableEvent=function(){var o=this,r=this.ins,i=r.componentRef.instance;i.selectedRow.subscribe(function(e){o.ins.singleSelect&&o.lookupSelectionSer.clearSelections(),o.ins.checkedChange.emit({data:[e.data],isCheck:!0}),o.lookupSelectionSer.updateSelections([e.data]),i.cd.detectChanges()}),i.unSelectRow.subscribe(function(e){o.lookupSelectionSer.unSelect(e.data[r.idField]),o.ins.checkedChange.emit({data:[e.data],isCheck:!1})}),i.checkAll.subscribe(function(e){o.lookupSelectionSer.updateSelections(i.data,e),o.ins.checkedChange.emit({data:i.data,isCheck:e})}),i.pageChanged.subscribe(function(e){r.uri?r.httpMgr.getData(e,"list").subscribe(function(e){o._loadData(e)}):r.pagerChanged.emit(r.httpMgr.buildQueryParams(e,"list"))}),i.pageSizeChanged.subscribe(function(e){r.uri?r.httpMgr.getData(e,"list").subscribe(function(e){o._loadData(e)},function(e){r.closeLoading()}):r.pagerChanged.emit(r.httpMgr.buildQueryParams(e,"list"))}),i.search.subscribe(function(e){r._searchState=x({},e||{}),o.onSearch(e)}),i.searchValueChange.subscribe(function(e){e&&e.value?r._searchState=x({},e):r._searchState=null}),i.rowDblClick.subscribe(function(e){r.gridOptions.singleSelect&&r.selectItem(e)}),i.cellClick.observers.length||i.cellClick.subscribe(function(t){if(t.col.field===F&&t.event.target.classList.contains("f-lookup-favorite")){t.event.stopPropagation(),r.items.forEach(function(e){r.utils.getValue(r.idField,e)===r.utils.getValue(r.idField,t.row)&&(e[F]=!e[F])}),i.loadData({pageSize:r.gridOptions.pageSize,pageIndex:r.gridOptions.pageIndex,total:r.gridOptions.total,data:r.gridOptions.items});var e=t.row[F]?P:N;o.ins.favoriteItems=e===P?D(o.ins.favoriteItems,[t.row]):o.ins.favoriteItems.filter(function(e){return r.utils.getValue(r.idField,e)!==r.utils.getValue(r.idField,t.row)}),o.lookupSelectionSer.updateFavoriteData(t.row,e)}}),i.columnSorted.subscribe(function(e){if(o._sortState=e,o.ins.remoteSort){var t=x({},e),i=t.sortName,n=t.sortOrder,s=o.ins.columns.find(function(e){return e.field===i}),a={sortName:s?s.fieldPath?s.fieldPath:s.field:i,sortOrder:n,search:r._searchState,pageInfo:{pageSize:r.pageSize,pageIndex:1}};r.httpMgr.getData(a,"search").subscribe(function(e){r.loadDataTableData(e),r.closeLoading(),o.ins.selectionMgr.selectCurrentValue()})}}),i.clearSearchValue.subscribe(function(){r._searchState=null,o.onSearch()}),i.cellStyler=function(e){return e.field===F?{"text-overflow":"unset"}:null}},ae);function ae(e){this.ins=e,this._sortState=null,this.lookupSelectionSer=this.ins.lookupSelectionSer}function oe(e){void 0===e&&(e=null),this.searchOnServer?this.isShow=!0:!1===e?this.cancelSelect():(this.setModelValue(this.displayText),this.runDictPickedEvent(null))}function re(){var s=this,a=this,e=function(e){s.isShow||!s.isTextChange||!s.displayText||s.nosearch&&!e.originalEvent||s.lookupUtils.rts.getFormState("lookup.pending")||(s.lookupUtils.pendingStart(),s.dictPickingSubscription=s.dictPicking({instance:s}).pipe(y.switchMap(function(e){var t=!0;return e!==undefined&&null!==e||(t=!0),"boolean"==typeof e&&(t=e),"object"==typeof e&&(t=e.showDialog===undefined||e.showDialog,e.data&&(s.customData=e.data)),t?s.httpMgr.getData({search:{field:"*",value:s.displayText,type:"equal"}},"search"):u.of({SHOWDIALOG:t,MESSAGE:e.message||""})})).subscribe(function(e){if(s.closeLoading(),s.lookupUtils.pendingEnd(),e.hasOwnProperty("SHOWDIALOG"))e.SHOWDIALOG&&e.MESSAGE&&s.notifyService.warning(e.MESSAGE);else if(!e.items||1!==e.items.length||e.items[0].children&&e.items[0].children.length)oe.bind(a,e)();else{var t=e.items[0];if(s.isTree()){var i=s.treeNodeHelper.getLeafNode(t),n=!1;if(s.treeInfo||s.setTreeInfo(e),"boolean"==typeof s.treeInfo.onlySelectLeaf?n=s.treeInfo.onlySelectLeaf:"string"==typeof s.treeInfo.onlySelectLeaf&&("yes"===s.treeInfo.onlySelectLeaf?n=!0:"no"===s.treeInfo.onlySelectLeaf?n=!1:"default"===s.treeInfo.onlySelectLeaf&&(n=e.treeInfo.onlySelectLeaf)),n&&!i.leaf)return void oe.bind(a,e)();if(Array.isArray(i))return void oe.bind(a,e)();t=i.data}s.singleSelect||(t=[t]),s.selectItem(t),s.dialogClosed.emit()}},function(e){s.closeLoading(),s.lookupUtils.pendingEnd(),s.messagerService.error(e?e.Message:e)}))},t=null;return this.inputGroup&&this.inputGroup.textbox&&!this.nosearch&&(this.lookupUtils.setActiveLookupInstance(this),t=this.render2.listen(this.inputGroup.textbox.nativeElement,"blur",e)),this.inputGroup&&(this.inputGroup.enterHandle.subscribe(e),this.inputGroup.keydownHandle.subscribe(function(e){var t=!1;if("ArrowRight"===e.code){if(s.quickSelect&&!s.quickSelect.enable)return void s.writeConsole("启用快捷选择后，右方向键禁用打开帮助","warn");t=!s.editable||(!e.target.value||e.target.selectionStart===e.target.value.length)}else t=e.code===s.shortcutKey.open;t&&(e.stopPropagation(),e.preventDefault(),s.showDialog())})),t}var le=(ce.prototype.conditionsChange=function(e){if(this.ins.conditions=e,this.ins.uri)return e&&1===e.length&&"*"==e[0].code?(this.ins.conditions=[],this.searchTreeData({field:"*",value:e[0].value})):this.searchTreeData({field:"*",value:""});this.ins.query.emit({conditions:e,instance:this.ins})},ce.prototype.searchTreeData=function(s){var a=this,o=this.ins.componentRef.instance;if(!this.ins.searching)return this.ins.searching=!0,this.ins.showLoading(),o&&o.psRef&&o.psRef.directiveRef&&o.psRef.directiveRef.scrollToTop(0),this.ins.httpMgr.getData({search:s,sortName:o.sortName,sortOrder:o.sortOrder},"search").pipe(y.tap(function(){a.ins.searching=!1}),y.catchError(function(e){return a.ins.searching=!1,u.of(e)})).subscribe(function(e){if(a.ins.closeLoading(),e){o.clearAll();var t=a.ins.gridOptions.treeInfo;t.treeDataIsInit||("pathcode"===t.layerType.toLowerCase()?a.ins.items=a.ins.lookupUtils.makeTree(a.ins.items,t):a.ins.items=a.ins.lookupUtils.makeTreeWithParentID(a.ins.items,"",t.dataField?t.dataField+"."+t.parentField:t.parentField,a.ins.idField));var i=function(e){return e&&e.length?e.map(function(e){return e.hasOwnProperty("addtional")&&(e.selectable=!e.addtional),e.children&&e.children.length?i(e.children):!a._isLoadAllTreeData(o)||s&&""!==s.value&&s.value!==undefined||(e.leaf=!0),e}):e},n=i(e.items);n&&n.length&&n[0].children&&n[0].children.length&&(n[0].expanded=!0,n[0].children=a.ins.expandFirstNode(n[0].children)),a.ins.items=n,a.ins.useFavorite&&a.ins.favHelper.updateFavoritesStatus(a.ins.items),o.loadData(a.ins.items),o.resize(),a.IS_SEARCH_RESULT=!0,a.ins.selectionMgr.selectCurrentValue()}a.ins.search.emit(s)})},ce.prototype.getChildren=function(e,t,i){var n=this.ins.gridOptions.uri,s=x({parentLayer:t,category:"children"},i);"parentId"===this.ins.treeInfo.layerType?s.parentId=e:s.parentPath=e;var a={searchValue:"",customData:this.ins.customData,enableFullTree:this.ins.enableFullTree,loadTreeDataType:this.ins.loadTreeDataType},o=this.ins.componentRef.instance;return o&&o.sortName&&Object.assign(s,{sortName:o.sortName,sortOrder:o.sortOrder}),this.IS_SEARCH_RESULT&&(a.enableFullTree=!1,a.loadTreeDataType="layerload","parentId"===this.ins.treeInfo.layerType&&(s.searchValue="",s.searchField="*")),a.searchValue=JSON.stringify(s),this.ins.helpId&&(a.helpId=this.ins.helpId),this.ins.conditions&&this.ins.conditions.length&&(a.searchConditions=f.cloneDeep(this.ins.conditions)),this.ins.http.getData(n,a)},ce.prototype.bindTreetableEvent=function(){var h=this,p=this.ins.componentRef.instance,t=function(e){h.ins.remoteSearch?(h.ins._searchState=e,h.searchTreeData(e)):h.ins.useInsideSearchHandler?p.searchHandle.search(e.field,e.value,"client"):h.ins.search.emit(e)},l=function(){return h._isLoadAllTreeData(p)};p.dblClickExpand=!this.ins.singleSelect,p.allColumnsTitle=this.ins.allColumnsTitle,p.idField=this.ins.idField,p.columns=this.ins.columns,p.searchFields=this.ins.gridOptions.searchFields,this.ins.treeInfo&&(p.loadDataType=this.ins.treeInfo.loadDataType,p.virtualized=!0,this.ins.isTextChange?this.ins.allData=[]:this.ins.allData=f.cloneDeep(this.ins.items)),this.ins.gridOptions.treeInfo&&(p.onlySelectLeaf=this.ins.gridOptions.treeInfo.onlySelectLeaf,p.loadDataType=this.ins.gridOptions.treeInfo.loadDataType),p.singleSelect||(p.checkOnSelect=!0,p.selectOnCheck=!0,p.showCheckbox=!0,p.showCheckAll=this.ins.showCheckAll,this.ins.enableCascade?this.cascadeValueChanged(this.ins.cascadeStatus):(p.cascadeCheck=!1,p.cascadeDown=!1,p.cascadeUp=!1)),p.enableFindText=this.ins.enableFindText,p.nodeSelected.subscribe(function(e){h.ins.singleSelect&&h.lookupSelectionSer.clearSelections(),h.lookupSelectionSer.updateSelections([e.node.data]),h.ins.checkedChange.emit({data:[e.node.data],isCheck:!0})}),p.nodeChecked.subscribe(function(e){if(!h.ins.singleSelect){var t=null;t=e.nodes&&e.nodes.length?e.nodes.map(function(e){return e.data}):Array.isArray(e.node)?e.node.map(function(e){return e.data}):[e.node.data],h.ins.multiSelMgr.updateSelections(t),h.ins.checkedChange.emit({data:t,isCheck:!0})}}),p.nodeUnChecked.subscribe(function(e){if(e&&e.node){var t=null;if(e.node.data?t=e.node.data:e.node.node&&e.node.node.data&&(t=e.node.node.data),!t)return;if(h.ins.singleSelect){var i=h.ins.favoritesComponentRef&&h.ins.favoritesComponentRef.instance;i&&i.findRowNode(e.node.id)&&i.unSelectNode(e.node.id),h.ins.checkedChange.emit({data:[t],isCheck:!1})}else{if(h.ins.multiSelMgr.remove(e.node.id),"all"!==p.loadDataType&&"pathcode"===h.ins.treeInfo.layerType&&h.ins.enableCascade&&("enable"===h.ins.cascadeStatus||"down"===h.ins.cascadeStatus))if(e.node.children&&e.node.children.length){var n=e.node.children.map(function(e){return e.data});h.ins.lookupSelectionSer.updateSelections(n,!1)}else{var s=h.ins.getPathCode(t,h.ins.treeInfo);h.ins.lookupSelectionSer.unselectByPathcode(s)}e.nodes&&e.nodes.length?(h.ins.multiSelMgr.remove(e.nodes.map(function(e){return e.id})),h.ins.checkedChange.emit({data:e.nodes.map(function(e){return e.data}),isCheck:!1})):h.ins.checkedChange.emit({data:[t],isCheck:!1})}}}),p.checkAll.subscribe(function(e){var t=e.instance.checkeds.map(function(e){return e.data});h.ins.multiSelMgr.updateSelections(t),h.ins.checkedChange.emit({data:t,isCheck:!0})}),p.unCheckAll.subscribe(function(){h.ins.multiSelMgr.clear(),h.ins.checkedChange.emit({data:[],isCheck:!1})}),p.search.subscribe(function(e){"*"===e.field||e.value?(e.value=e.value.trim(),t(e)):h.ins.messagerService.warning(h.ins.mustWriteSomething)}),p.cellClick.observers.length||p.cellClick.subscribe(function(t){if(t.col.field===F&&(t.event.stopPropagation(),t.event.target.classList.contains("f-lookup-favorite"))){var i=h.ins;!function n(e){e&&e.forEach(function(e){return i.utils.getValue(i.idField,e.data)===t.node.id?(e.data[F]=!e.data[F],!0):!!(e.children&&0<e.children.length)&&n(e.children)})}(h.ins.items),p.loadData(h.ins.items),h.lookupSelectionSer.updateFavoriteData(t.node.data,t.node.data[F]?P:N)}}),p.dblClick.subscribe(function(e){h.ins.gridOptions.singleSelect&&e.selectable&&h.ins.okButton&&h.ins.selectItem(e.data)});var i=l();return p.columnSorted.subscribe(function(e){if(h._sortState=e,l())p.clientSort();else{var t=x({},e),i=t.sortName,n=t.sortOrder,s=h.ins.columns.find(function(e){return e.field===i}),a=s?s.fieldPath?s.fieldPath:s.field:i,o=Object.assign({sortName:a,sortOrder:n},{search:h.ins._searchState}),r="all";h.ins._searchState&&h.ins._searchState.value&&(r="search"),h.ins.httpMgr.getData(o,r).subscribe(function(e){h.ins.closeLoading(),p.clearAll();var t=h.ins.checkNodeCanBeSelect(e.items,!1);h.ins.useFavorite&&h.ins.favHelper.updateFavoritesStatus(t),h.ins.items=t,p.loadData(t),p.resize(),h.ins.selectionMgr.selectCurrentValue()})}}),p.clearSearchValue.subscribe(function(){p&&p.psRef&&p.psRef.directiveRef&&p.psRef.directiveRef.scrollToTop(0),h.ins._searchState=null,h.IS_SEARCH_RESULT=!1;var e=[];h.ins.allData&&h.ins.allData.length&&(e=h.ins.checkNodeCanBeSelect(h.ins.allData,i)),e&&e.length?(h.ins.items=e,h.ins.favHelper.updateFavoritesStatus(h.ins.items),p.loadData(e),h.ins.selectionMgr.selectCurrentValue()):t({field:"*",value:""})}),p.expand.subscribe(function(s){if(!s.leaf&&!s.showLoading)if(s.children&&s.children.length){if(!h.ins.singleSelect&&h.ins.enableCascade&&("enable"===h.ins.cascadeStatus||"down"===h.ins.cascadeStatus)&&h.ins.isGetAllChidlNodes){var e=p.findRowNode(s.id);p.propagateSelectionDown(e,e.isChecked);var t=s.children.filter(function(e){return e.selectable}).map(function(e){return e.data});h.ins.lookupSelectionSer.updateSelections(t,e.isChecked)}}else{var i=h.ins.gridOptions.treeInfo;if(h._isAsyncLoadTreeData(p)||h.IS_SEARCH_RESULT){var n="",a=-1,o=x({},p.searchData),r=o.field,l=void 0===r?"*":r,c=o.value,d=void 0===c?"":c;if(s.showLoading=!0,p.detectChanges(),"parentId"===i.layerType?n=s.id:i.dataField?(n=h.ins.getPathCode(s.data,i),a=h.ins.getLayerData(s.data,i)):h.ins.writeConsole("未找到分级信息。"),!h.ins.uri)return s.showLoading=!1,void h.ins.expandTreeNode.emit({instance:p,node:s,parentIdOrPath:n,parentLayer:a,search:{value:d,field:l}});h.ins.showLoading(),h.getChildren(n,a,{searchField:"*"===l?"*":l,searchValue:d}).subscribe(function(e){if(h.ins.closeLoading(),p){if(s&&e.items&&e.items.length){h.ins.useFavorite&&h.ins.favHelper.updateFavoritesStatus(e.items);var t=h.ins.checkNodeCanBeSelect(e.items,!1);if(p.appendChildren(t,s),"all"!==p.loadDataType&&!h.ins.singleSelect&&h.ins.isGetAllChidlNodes&&("enable"===h.ins.cascadeStatus||"down"===h.ins.cascadeStatus)){var i=p.findRowNode(s.id);p.propagateSelectionDown(i,i.isChecked);var n=e.items.filter(function(e){return!e.addtional});n&&n.length&&h.ins.lookupSelectionSer.updateSelections(n.map(function(e){return e.data}),i.isChecked)}}s.showLoading=!1,p.detectChanges(),p.psRef.directiveRef.update(),h.ins.selectionMgr.selectCurrentValue()}})}}}),i&&this.ins.items&&this.ins.treeNodeHelper.updateTreeNodeExpanded(this.ins.items),i},ce.prototype.cascadeValueChanged=function(e){var t=e,i="datalist"===this.ins.activeTab?"treetable":"fav",n=this.ins.lookupCmpMgr.getComponentInstance(i);if(n){switch(t){case"enable":n.cascadeCheck=!0,n.cascadeDown=!0,n.cascadeUp=!0;break;case"disable":n.cascadeCheck=!1,n.cascadeDown=!1,n.cascadeUp=!1;break;case"up":n.cascadeCheck=!0,n.cascadeUp=!0,n.cascadeDown=!1;break;case"down":n.cascadeCheck=!0,n.cascadeDown=!0,n.cascadeUp=!1;break;default:n.cascadeCheck=!0,n.cascadeDown=!0,n.cascadeUp=!0}this.ins.cascadeStatus=t||"enable",this.ins.personalConf.cascadeStatus=t||"enable"}},ce);function ce(e){var t=this;this.ins=e,this._sortState=null,this.IS_SEARCH_RESULT=!1,this._isLoadAllTreeData=function(e){return"default"===t.ins.loadTreeDataType?"all"===e.loadDataType:"loadall"===t.ins.loadTreeDataType},this._isAsyncLoadTreeData=function(e){return"default"===t.ins.loadTreeDataType?"async"===e.loadDataType:"layerload"===t.ins.loadTreeDataType},this.lookupSelectionSer=this.ins.lookupSelectionSer}var de=(he.prototype.onSelectedTableCellClick=function(e){if(e.col.field===F){e.event.stopPropagation();var t=e.event.target.classList;if(t.contains("f-lookup-unfavorite")||t.contains("f-icon-minus-circle")){var i=e.row[this.ins.idField];if(this.ins.lookupSelectionSer.unSelect(i),this.ins.isTree()){var n=this.ins.lookupCmpMgr.getComponentInstance("treetable");if(n.unCheckedNode(i),n.unSelectNode(i),this.ins.useFavorite){var s=this.ins.lookupCmpMgr.getComponentInstance("fav");s&&s.data&&s.data.length&&s.findRowNode(i)&&(s.unCheckedNode(i),s.unSelectNode(i))}}else if(this.ins.lookupCmpMgr.getComponentInstance().unCheckRow(i),this.ins.useFavorite){var a=this.ins.lookupCmpMgr.getComponentInstance("fav");a&&a.data&&a.data.length&&a.unCheckRow(i)}}}},he.prototype.initSelectedColumns=function(){var e=[];if(this.ins.showSelected&&!this.ins.singleSelect){var t=(e=f.cloneDeep(this.ins.gridOptions.columns)).find(function(e){return e.field===F});t?t.formatter=function(){return M}:e=e.concat([{field:F,width:80,formatter:function(){return M}}]),this.ins.initColumnWidth(e,"sel")}return e},he.prototype.updateSelections=function(e){Array.isArray(e)?this.ins.lookupSelectionSer.updateSelections(e,!0):this.ins.lookupSelectionSer.select(e)},he.prototype.remove=function(e){e&&this.ins.lookupSelectionSer.unSelect(e)},he.prototype.deleteSelectedItems=function(e){var t=this;if(e&&e.length&&(this.ins.lookupSelectionSer.updateSelections(e,!1),this.ins.isShow)){var i=e.map(function(e){return e[t.ins.idField]});if(this.ins.isTree()){var n=this.ins.lookupCmpMgr.getComponentInstance("treetable");if(n&&n.unCheckedAndSelected(i),this.ins.useFavorite){var s=this.ins.lookupCmpMgr.getComponentInstance("fav");s&&s.unCheckedNodes(i,!0,!1)}}else{var a=this.ins.lookupCmpMgr.getComponentInstance();if(a&&a.unCheckRows(i),this.ins.useFavorite){var o=this.ins.lookupCmpMgr.getComponentInstance("fav");o&&o.unCheckRows(i)}}}},he.prototype.clear=function(){if(this.ins.lookupSelectionSer.clearSelections(),this.ins.isShow)if(this.ins.isTree()){var e=this.ins.lookupCmpMgr.getComponentInstance("treetable");if(e&&e.clearAll(),this.ins.useFavorite){var t=this.ins.lookupCmpMgr.getComponentInstance("fav");t&&t.clearAll()}}else{var i=this.ins.lookupCmpMgr.getComponentInstance();if(i&&i.clearSelections(),this.ins.useFavorite){var n=this.ins.lookupCmpMgr.getComponentInstance("fav");n&&n.clearSelections()}}},he.prototype.save=function(e){this.ins.showSelected&&(this.ins.personalConf.selections=e,this.ins.personalConfigService.savePersonalConfig(this.ins.personalConf))},he.prototype.loadData=function(){var e=this.ins.personalConf&&this.ins.personalConf.selections||[];e.length||(e=this.ins.lookupSelectionSer.getSelections()),this.ins.lookupSelectionSer.loadSelections(e)},he);function he(e){this.ins=e}var pe={tabIndex:"datalist",favorite:null,size:null},ue=(fe.prototype.disablePagination=function(){return{pageIndex:1,pageSize:500}},fe.prototype.buildQueryParams=function(e,t){void 0===t&&(t="all");var i={};e.navConditions&&e.navConditions.length&&(e.navConditions&&1===e.navConditions.length&&"*"==e.navConditions[0].code?e.search={field:"*",value:e.navConditions[0].value}:i.navSearchConditions=e.navConditions),this.ins.conditions&&this.ins.conditions.length&&"fav"!==t&&(i.searchConditions=f.cloneDeep(this.ins.conditions));var n={category:t};if("fav"!==t&&this.ins.isDoublleList()&&this.ins.navigationFilter&&"all"!==t&&this.ins.navigationFilter.idValue&&"textchange"!==t&&(i.relationFilter=D(this.ins.navigationFilter.idValue)),e){if("fav"!==t&&"selected"!==t||(e.pageInfo=this.disablePagination()),e.pageInfo&&(i.pageIndex=e.pageInfo.pageIndex,i.pageSize=e.pageInfo.pageSize),e.search){var s=e.search.field;s&&"*"===s&&(s="*"),e.search.value&&(e.search.value=e.search.value.trim()),n.searchField=s,n.searchValue=e.search.value,n.searchType=e.search.type||"like",""!==e.search.value||"search"!==n.category||i.searchConditions||i.navSearchConditions||(n.category="all")}e.sortName&&(n.sortName=e.sortName),e.sortOrder&&(n.sortOrder=e.sortOrder),!isNaN(Number(e.expandLevel))&&this.ins.isTree()&&(e.expandLevel?-1===e.expandLevel&&(e.expandLevel=0):e.expandLevel=-1,n.layerNum=e.expandLevel)}return"fav"===t&&e.favoriteIds&&(n.favoriteIds=e.favoriteIds),!this.ins.isTree()&&this.ins.displayType!==R.NavTreeList||(i.enableFullTree=this.ins.enableFullTree),i.treeToList=this.ins.treeToList,i.navTreeToList=this.ins.navTreeToList,"textchange"===t&&(i.enableFullTree=!1),"selected"===t&&(n.category="fav",i.enableFullTree=!1,n.favoriteIds=e.favoriteIds),i.searchValue=JSON.stringify(n),i.loadTreeDataType=this.ins.loadTreeDataType,i.customData=this.ins.customData,this.ins.helpId&&(i.helpId=this.ins.helpId),e.selectedInfo&&(i.selectedInfo=e.selectedInfo),e.navNodePathCode!==undefined?i.navPathCode=e.navNodePathCode:"navAllChildren"===t&&this.ins.includeSubordinates&&this.ins.navNodePathCode&&(i.navPathCode=this.ins.navNodePathCode),i},fe.prototype.getData=function(e,t){void 0===t&&(t="all");var i=this.ins.gridOptions.uri;this.ins.isDoublleList()&&this.ins.navigationFilter&&this.ins.navigationFilter.idValue&&"fav"!==t&&(t=this.ins.includeSubordinates&&"async"===this.ins.navigationOptions.treeInfo.loadDataType?"navAllChildren":"list");var n=this.buildQueryParams(e,t);if(i||this.ins.beUri){if(this.ins.beUri&&this.ins.columns&&this.ins.columns.length){var s=this.ins.columns.map(function(e){return e.searchField}).filter(function(e){return e});if(n.condition||(n.condition={}),!this.ins.isTree()&&this.ins.pagination){var a=x({},n),o=a.pageSize,r=void 0===o?this.ins.pageSize||20:o,l=a.pageIndex;n.condition.pagination={pageSize:r,pageIndex:l}}else n.condition.pagination={isUsePagination:!1};var c=JSON.parse(n.searchValue);c.searchValue&&(n.condition=this.ins.lookupUtils.mergeCondition(n.condition,s,{field:c.searchField,value:c.searchValue}))}var d=this.ins.beUri||i;if(this.ins.http&&(this.ins.http.context=this.ins.context),this.ins._searchResult)return u.of(this.ins._searchResult);if("allChildren"!==t)return this.ins.http.getData(d,n);var h={searchValue:JSON.stringify({category:t}),parentsIds:e.parentsIds,customData:n.customData,helpId:n.helpId};return this.ins.http.getData(d,h)}return u.of(!1)},fe.prototype.getSelecedItems=function(e){return this.getData({favoriteIds:e},"selected")},fe.prototype.getPersonalConfig=function(){var t=f.cloneDeep(pe),i=this.ins.personalConfigService._newKey,e=this.ins.personalConfigService.getPersonalData(i);e&&Object.keys(e).length||(e=t);var n=u.of(e);return"locale"===this.ins.favoriteDataFrom||this.ins.isTabChanged?n:this.ins.http&&this.ins.http.getUserSettings?this.ins.http.getUserSettings(i).pipe(y.tap(function(e){e&&e.textValue?localStorage.setItem(i,e.textValue):localStorage.setItem(i,JSON.stringify(t))}),y.map(function(e){return e&&e.textValue?JSON.parse(e.textValue):t})):n},fe.prototype.lookupRequest=function(l,c,e){var d=this;return void 0===c&&(c="all"),void 0===e&&(e=!1),!this.ins.usePersionalConf||e?this.getData(l,c):this.getPersonalConfig().pipe(y.tap(function(e){d.ins.personalConf=e,d.ins.personalConfigService.savePersonalConfig(e),d.ins.isTabChanged||(d._originalPersonalConfig=f.cloneDeep(e))}),y.switchMap(function(e){var t=e.tabIndex,i=e.favorite,n=e.size,s=e.cascadeStatus;if(d.ins.isTabChanged||(d.ins.activeTab=t||"datalist"),n&&(d.ins.dialogWidth=n.width,d.ins.dialogHeight=n.height,d.ins.isTabChanged||d.ins.dialog.reSize({width:n.width,height:n.height})),d.ins.cascadeStatus&&(s&&d.ins.enableCascade&&d.ins.showCascadeControl&&(d.ins.cascadeStatus=s),d.ins.cascadeItems)&&(["enable","up","down","disable"].forEach(function(e){d.ins.cascadeItems[e]===undefined&&(d.ins.cascadeItems[e]=!0)}),!d.ins.cascadeItems[d.ins.cascadeStatus])){var a=Object.keys(d.ins.cascadeItems).map(function(e){return d.ins.cascadeItems[e]?e:""}).filter(function(e){return e});d.ins.cascadeStatus=a[0]}if("datalist"===d.ins.activeTab)return d.getData(l,c);if("favorite"===d.ins.activeTab){var o=i?i[d.ins.localService.localeId]:[];return o&&o.length||d.ins.isTabChanged?(l.favoriteIds=o,l.search=null,d.getData(l,"fav").pipe(y.switchMap(function(e){return(e&&e.items||[]).length||d.ins.isTabChanged?u.of(e):d.getData(l,"all").pipe(y.map(function(e){return e&&!e.items&&(e.items=[]),e.activeTab="datalist",e}))}))):d.getData(l,"all").pipe(y.map(function(e){return e&&!e.items&&(e.items=[]),e.activeTab="datalist",e}))}if("selected"===d.ins.activeTab){var r=(d.ins.displayValue?d.ins.displayValue.split(","):[]).filter(function(e){return e});return d.getSelecedItems(r)}}))},fe.prototype.submitFavoriteData=function(e){var t=this;if(this.ins.personalConf.colSizeInfo=this.getColumnSizeInfo(),JSON.stringify(this.ins.personalConf)!==JSON.stringify(this._originalPersonalConfig)){var i="";if(e===P?i=this.ins.addFavoriteSuccess:e===N&&(i=this.ins.delFavoriteSuccess),localStorage.setItem(this.ins.personalConfigService._newKey,JSON.stringify(this.ins.personalConf)),this.ins.personalConfigService.savePersonalConfig(this.ins.personalConf||{}),"locale"!==this.ins.favoriteDataFrom){this._originalPersonalConfig=f.cloneDeep(this.ins.personalConf);var n={configkey1:this.ins.personalConfigService.personalConfigKey,configkey2:"",configkey3:"",textvalue:JSON.stringify(this.ins.personalConf)};if(this.ins.http&&this.ins.http.saveUserSettings)return this.ins.savingFaoriteData=!0,this.ins.showLoading(),this.ins.http.saveUserSettings(n).subscribe(function(e){t.ins.savingFaoriteData=!1,t.ins.closeLoading(),i&&t.ins.notifyService.success(i)});i&&this.ins.notifyService.success(i)}else i&&this.ins.notifyService.success(i)}},fe.prototype.getColumnSizeInfo=function(){var e={data:{},nav:{},fav:{},sel:{}};return e.data=this.ins.columns.filter(function(e){return e.field!==F}).reduce(function(e,t){return e[t.field]=t.width,e},{}),this.ins.favoriteColumns&&this.ins.favoriteColumns.length&&(e.fav=this.ins.favoriteColumns.filter(function(e){return e.field!==F}).reduce(function(e,t){return e[t.field]=t.width,e},{})),this.ins.navigationOptions&&this.ins.navigationOptions.columns&&this.ins.navigationOptions.columns.length&&(e.nav=this.ins.navigationOptions.columns.filter(function(e){return e.field!==F}).reduce(function(e,t){return e[t.field]=t.width,e},{})),this.ins.selectedColumns&&this.ins.selectedColumns.length&&this.ins.showSelected&&(e.sel=this.ins.selectedColumns.filter(function(e){return e.field!==F}).reduce(function(e,t){return e[t.field]=t.width,e},{})),e},fe);function fe(e){this.ins=e,this._originalPersonalConfig=pe}var ge=(ve.prototype.ngOnInit=function(){var i=this;this.lookupCmp&&this.isTreeList()&&(this.lookupCmp.includeSubordinates$$=this.lookupCmp.includeSubordinates$.subscribe(function(e){if(i.cmpRef){var t=i.cmpRef.instance;t.selectedRow&&i.selected.emit({data:t.selectedRow.data,node:t.selectedRow})}}))},ve.prototype.ngOnDestroy=function(){this._searchState=null,this._sortState=null},ve.prototype.updateScrollPosition=function(){if(this.isTreeList()){var e=this.cmpRef.instance;e&&e.state.scrollY!=e.psRef.directiveRef.elementRef.nativeElement.scrolltop&&e.psRef.directiveRef.scrollToY(e.state.scrollY)}},ve.prototype.createComponent=function(){var e=null;return e=this.isTreeList()?(this.navOptions.fitColumns=!1,this.navOptions.autoFitColumns=!0,this.cfr.resolveComponentFactory(r.TreeTableComponent)):this.cfr.resolveComponentFactory(o.DataTableComponent),this.navOptions.keepSelect=!1,this.navOptions.showFilterBar=!this.lookupCmp.enableMultiFieldSearch&&this.lookupCmp.showFilterBar,this.navOptions.width=this.lookupCmp.leftPanelWidth,this.cmpRef=this.cmpContainer.createComponent(e),this.isTreeList()?this.navOptions.fit=!0:(this.navOptions.width-=2,this.navOptions.fill=!0,this.cmpRef.instance.maxSize=5,this.cmpRef.instance.fill=!0,this.cmpRef.instance.autoFitColumns=!0),this.navOptions.pageInfo?(this.navOptions.pageInfo.pageList&&(this.navOptions.pageList=this.navOptions.pageInfo.pageList),this.navOptions.pagination=this.navOptions.pageInfo.enablePager,this.navOptions.pageIndex=this.navOptions.pageInfo.pageIndex,this.navOptions.pageSize=this.navOptions.pageInfo.pageSize):this.navOptions.pagination=!1,Object.assign(this.cmpRef.instance,this.navOptions),this.loadData(),u.of(this.cmpRef)},ve.prototype.update=function(){this.cd.detectChanges()},ve.prototype.resize=function(e){if(e){var t=e.width,i=e.height,n=t-2;this.navOptions.width=n;var s=(this.navOptions.height=i)-this.lookupCmp.getFilterBarHeight();this.cmpRef.instance.resize({width:n,height:s})}},ve.prototype.isTreeList=function(){return"treelist"===this.navOptions.displayType.toLowerCase()&&!this.lookupCmp.navTreeToList},ve.prototype.selectLeftDataTableRow=function(e,t){var i=this;if(e&&e.length){var n=null;this.lookupCmp.navSelectedIds?n=e.find(function(e){return e[t.idField]==i.lookupCmp.navSelectedIds}):this.lookupCmp.selectFirstInNav&&(n=e[0]),n&&(t.dtBody.selectedRowIndex=-1,t.dtBody.selectedRow("",0,n))}},ve.prototype.closeLoading=function(){this.lookupCmp.closeLoading()},ve.prototype.initDataTable=function(a){var o=this;a.loadData({pageSize:this.navOptions.pageSize,pageIndex:this.navOptions.pageIndex,total:this.navOptions.total,data:this.navOptions.items});var e=this.navOptions,t=e.width,i=e.height;a.resize({width:t,height:i-this.lookupCmp.getFilterBarHeight()}),a.selectedRow.subscribe(function(e){o.selected.emit({data:e.data})}),a.unSelectRow.subscribe(function(e){o.selected.emit(null)});var r={next:function(e){o.closeLoading(),s(e);var t=o.navOptions,i=t.width,n=t.height;o.cmpRef.instance.resize({width:i,height:n-o.lookupCmp.getFilterBarHeight()})},error:function(e){o.closeLoading()}};a.search.subscribe(function(e){var t={pageInfo:{pageIndex:1,pageSize:o.navOptions.pageSize},search:"",navConditions:o.navConditions};o._searchState=e,o.search.emit(e),t.search=e,t.pageInfo.pageSize=a.pageSize,o.lookupCmp.navigationFilter=null,o._sortState&&o._sortState.sortName?(t.sortName=o._sortState.sortName,t.sortOrder=o._sortState.sortOrder):(delete t.sortName,delete t.sortOrder),o.lookupCmp.httpMgr.getData(t,"navsearch").pipe(y.filter(function(e){return e})).subscribe(r)});var s=function(e){a.loadData({pageSize:e.pageInfo.pageSize,pageIndex:e.pageInfo.pageIndex,total:e.total,data:e.items}),o.selectLeftDataTableRow(e.items,a),a.cd.markForCheck()};a.pageChanged.subscribe(function(e){o.pageChanged.emit(e),o.lookupCmp.navigationFilter=null,e.navConditions=o.navConditions||[],o.lookupCmp.httpMgr.getData(e,"navsearch").subscribe(r)}),a.pageSizeChanged.subscribe(function(e){o.lookupCmp.navigationFilter=null,e.navConditions=o.navConditions||[],o.lookupCmp.httpMgr.getData(e,"navsearch").subscribe(r)}),a.columnSorted.subscribe(function(e){var t=x({},e),i=t.sortName,n=t.sortOrder;o._sortState=e,o.lookupCmp.navigationFilter=null;var s={sortName:i,sortOrder:n,search:o._searchState,pageInfo:{pageSize:a.pageSize,pageIndex:1},navConditions:o.navConditions||[]};o.lookupCmp.httpMgr.getData(s,"navsearch").subscribe(r)}),a.clearSearchValue.subscribe(function(){o._searchState=null,a.search.emit(null)}),this.selectLeftDataTableRow(this.navOptions.items,a)},ve.prototype.buildParams=function(e){return x({},e,{treeToList:this.lookupCmp.treeToList,navTreeToList:this.lookupCmp.navTreeToList,navConditions:this.navConditions||[]})},ve.prototype.initTreeTable=function(r){var l=this;r.virtualized=!0,r.fast=!0,r.nodeSelected.subscribe(function(e){l.selected.emit({data:e.node.data,node:e.node})}),r.nodeUnSelect.subscribe(function(e){l.selected.emit(null)}),r.fixedHeader=!0,"all"===this.navOptions.treeInfo.loadDataType&&this.lookupCmp.treeNodeHelper.updateTreeNodeExpanded(this.navOptions.items,this.navOptions.treeInfo),r.loadDataType=this.navOptions.treeInfo.loadDataType,this.navOptions.items=this.lookupCmp.checkNodeCanBeSelect(this.navOptions.items,"all"===this.navOptions.treeInfo.loadDataType),r.loadData(this.navOptions.items),this.lookupCmp.navSelectedIds?r.selectNode(this.lookupCmp.navSelectedIds):this.lookupCmp.selectFirstInNav&&r.selectFirstNode(),this.allData=this.navOptions.items;var c={next:function(e){l.closeLoading(),r.psRef.directiveRef.scrollToTop(0),r.clearAll();var t=l.lookupCmp.checkNodeCanBeSelect(e.items,!("all"!==l.navOptions.treeInfo.loadDataType||l._searchState&&l._searchState.value));t&&t.length&&t[0].children&&t[0].children.length&&(t[0].expanded=!0,t[0].children=l.lookupCmp.expandFirstNode(t[0].children)),r.loadData(t),r.resize(),l.selected.emit(null)},error:function(e){l.closeLoading()}};r.search.subscribe(function(e){l._searchState=e,l.lookupCmp.navigationFilter=null;var t=l.buildParams({search:e});l._sortState&&l._sortState.sortName&&(t.sortName=l._sortState.sortName,t.sortOrder=l._sortState.sortOrder),l.lookupCmp.httpMgr.getData(t,"navsearch").subscribe(c)}),r.columnSorted.subscribe(function(e){if(l.lookupCmp.navigationFilter=null,"all"===r.loadDataType)r.clientSort();else{var t=x({},e),i=t.sortName,n=t.sortOrder,s=l.navOptions.columns.find(function(e){return e.field===i});s&&(i=s.fieldPath),l._sortState={sortName:i,sortOrder:n};var a=l.buildParams({sortName:i,sortOrder:n,search:l._searchState}),o="nav";(l._searchState&&l._searchState.value||a&&a.navConditions&&a.navConditions.length)&&(o="navsearch"),l.lookupCmp.httpMgr.getData(a,o).subscribe(c)}}),r.clearSearchValue.subscribe(function(){if(l._searchState=null,l._sortState&&l._sortState.sortName){var e=l.buildParams({});l.lookupCmp.navigationFilter=null,l._sortState&&l._sortState.sortName&&(e.sortName=l._sortState.sortName,e.sortOrder=l._sortState.sortOrder),l.lookupCmp.httpMgr.getData(e,"nav").subscribe(c)}else r.loadData(l.allData),r.selectedRow||l.selected.emit(null)}),r.expand.subscribe(function(e){l.onNodeExpanded(e,r)})},ve.prototype.onNodeExpanded=function(t,i){var n=this;if(!(t.leaf||t.children&&t.children.length)){var e=this.navOptions.treeInfo;if("async"===this.navOptions.treeInfo.loadDataType){var s="",a=-1,o=x({},i.searchData),r=o.field,l=void 0===r?"*":r,c=o.value,d=void 0===c?"":c;if(t.showLoading=!0,i.detectChanges(),"parentId"===e.layerType?s=t.id:e.dataField?(s=this.lookupCmp.getPathCode(t.data,e),a=this.lookupCmp.getLayerData(t.data,e)):console.log("未找到分级信息。"),!this.lookupCmp.uri)return void this.lookupCmp.expandTreeNode.emit({instance:i,node:t,parentIdOrPath:s,parentLayer:a,search:{value:d,field:l}});this.getChildren(s,a,{searchField:"*"===l?"*":l,searchValue:d},i).pipe(y.switchMap(function(e){return e&&e.items&&e.items.length?u.of(e):n.getChildren(s,a,{searchField:"*",searchValue:""},i,!0)})).subscribe(function(e){i&&(t&&e.items&&e.items.length&&i.appendChildren(e.items,t),t.showLoading=!1,i.detectChanges())})}}},ve.prototype.getChildren=function(e,t,i,n,s){void 0===s&&(s=!1);var a=this.lookupCmp.gridOptions.uri,o=x({parentLayer:t,category:"navchildren"},i);"parentId"===this.navOptions.treeInfo.layerType?o.parentId=e:o.parentPath=e;var r=this.buildParams({searchValue:JSON.stringify(o),customData:this.lookupCmp.customData,enableFullTree:!1,loadTreeDataType:"layerload"});if(this.lookupCmp.helpId&&(r.helpId=this.lookupCmp.helpId),n&&n.sortName){var l=n.sortName,c=this.navOptions.columns.find(function(e){return e.field===n.sortName});c&&(l=c.fieldPath),o.sortName=l,o.sortOrder=n.sortOrder,r.searchValue=JSON.stringify(o)}return this.navConditions&&this.navConditions.length&&!s&&(r.navSearchConditions=this.navConditions),delete r.navConditions,this.lookupCmp.http.getData(a,r)},ve.prototype.loadData=function(){if(this.cmpRef.instance.allColumnsTitle=this.lookupCmp.allColumnsTitle,this.isTreeList()){var e=this.cmpRef.instance;this.initTreeTable(e)}else{var t=this.cmpRef.instance;this.initDataTable(t)}},ve.prototype.onConditionsChange=function(e){this.navConditions=e,this.isTreeList(),this.cmpRef.instance.search.emit()},ve.decorators=[{type:S.Component,args:[{selector:"lookup-left",template:'<div style="height: 100%;position: relative;width: calc(100% - 2px)" class="d-flex flex-column">\r\n    <div class="lookup-filter-bar" [viewType]="\'onlyinput\'"\r\n    lookup-filter-bar *ngIf="lookupCmp?.enableMultiFieldSearch && lookupCmp?.showFilterBar"\r\n    [columns]="navOptions?.columns" [searchFields]="navOptions?.searchFields" [isNav]="true"\r\n    (conditionsChange)="onConditionsChange($event)"></div>\r\n    <div class="h-100 w-100 f-utils-fill" style="position: relative;">\r\n        <ng-container #container></ng-container>\r\n    </div>\r\n</div>'}]}],ve.ctorParameters=function(){return[{type:S.ComponentFactoryResolver},{type:S.ChangeDetectorRef}]},ve.propDecorators={cmpContainer:[{type:S.ViewChild,args:["container",{read:S.ViewContainerRef}]}],selected:[{type:S.Output}],unselected:[{type:S.Output}],search:[{type:S.Output}],pageChanged:[{type:S.Output}]},ve);function ve(e,t){this.cfr=e,this.cd=t,this.navConditions=[],this.selected=new S.EventEmitter,this.unselected=new S.EventEmitter,this.search=new S.EventEmitter,this.pageChanged=new S.EventEmitter,this._searchState=null,this._sortState=null,this.allData=null}var me=(ye.prototype.getComponentInstance=function(e){if(void 0===e&&(e="datatable"),!this.ins.componentRef||!this.ins.componentRef.instance)return null;if("selected"===e)return this.ins.selectedDtRef;var t=this.ins.componentRef.instance;if("leftDataTable"===e||"leftTree"===e){var i=this.ins.leftComponentRef;if(!(i&&i.instance&&i.instance.cmpRef&&i.instance.cmpRef.instance))return null;t=this.ins.leftComponentRef.instance.cmpRef.instance}switch("fav"===e&&(t=this.ins.favoritesComponentRef.instance),e){case"leftDataTable":case"fav":case"datatable":return t;case"leftTree":case"treetable":return t;default:return this.ins.isTree(),t}},ye.prototype.createComponentWithServerData=function(e){if(!this.ins.componentRef){this.ins.idField=e.idField||this.ins.idField,this.ins.textField=e.textField||this.ins.textField,this.ins.valueField=e.valueField||this.ins.valueField,this.ins.displayType=e&&e.displayType||this.ins.displayType||"LIST";var t=this.ins.displayType.toUpperCase();this.ins.isDoublleList()?(this.ins.navTreeToList&&t===R.NavTreeList&&(this.ins.displayType=R.NavList),this.ins.treeToList&&t===R.NavListTree&&(this.ins.displayType=R.NavList)):this.ins.treeToList&&(t===R.TreeList?this.ins.displayType="LIST":t===R.NavListTree&&(this.ins.displayType=R.NavList)),this.ins.isDoublleList()&&this.ins.navTreeToList&&t===R.NavTreeList&&(this.ins.displayType=R.NavList),this.ins.changeDetector.detectChanges(),this.ins.componentRef=this.createContent(this.ins.gridOptions),this.createFavoriteComponent(),this.resizeComponent()}},ye.prototype.createFavoriteComponent=function(){if(this.ins.useFavorite&&!this.ins.favoritesComponentRef){this.ins.favoriteColumns=this.ins.favHelper.getFavoriteColumns();var e=Object.assign({},this.ins.gridOptions,{showFilterBar:!1,pagination:!1,columns:this.ins.favoriteColumns||[]});this.ins.favoritesComponentRef=this.createFavoritesContent(e),this.resizeComponent("fav")}},ye.prototype.reloadTreeDataForExpand=function(i){var n=this,e=this.ins.gridOptions.uri,s=this.ins.componentRef.instance,t=x({},s.searchData),a=t.field,o=void 0===a?"*":a,r=t.value,l={category:"all",searchValue:void 0===r?"":r,searchField:o,layerNum:i},c={searchValue:JSON.stringify(l),customData:this.ins.customData,enableFullTree:this.ins.enableFullTree,loadTreeDataType:this.ins.loadTreeDataType};return this.ins.helpId&&(c.helpId=this.ins.helpId),s&&s.sortName&&Object.assign(c,{sortName:s.sortName,sortOrder:s.sortOrder}),this.ins.showLoading(),this.ins.http.getData(e,c).subscribe(function(e){n.ins.closeLoading();var t=n.ins.checkNodeCanBeSelect(e.items,-1===i);n.ins.items=t,s.loadData(t),s.psRef.directiveRef.scrollToTop(0)})},ye.prototype.setTreeNodeExpandBy=function(e,n){var s=this;e&&e.length&&e.forEach(function(e){var t=e.data[s.ins.treeInfo.dataField].layer,i=t+n-1;e.expanded=t<=i||e.expanded,e.children&&e.children.length&&t+1<=i&&s.setTreeNodeExpandBy(e.children,n)})},ye.prototype.useContextMenuForTree=function(r){var l=this,e=this.ins.treeTableOptions,t=e.maxLevel,i=e.enableContextMenu,n=e.language;if(i&&t){for(var s=[],a=1;a<=t;a++){var o=n["expand"+a];s.push({id:31,code:a,title:o,handle:function(e){var t=e.menu.code;if(c())l.setTreeNodeExpandBy(l.ins.items,t),r.instance.updateSerializedValue();else{var i=l.ins.treeInfo,n=i.dataField,s=i.layerField,a=(l.ins.items||[])[0];if(a&&a.data){var o=l.ins.utils.getValue(n+"."+s,a.data)+t-1;l.reloadTreeDataForExpand(o)}}}})}var c=function(){return"default"===l.ins.loadTreeDataType?"all"===r.instance.loadDataType:"loadall"===l.ins.loadTreeDataType},d=[{id:6,code:"checkchildnodes",title:"勾选下级数据",visible:function(e){return!e.data.node.selectable&&!l.ins.singleSelect&&e.data.node.children&&e.data.node.children.length},handle:function(e){if(r){var t=r.instance.getChildNodes(e.data.id).filter(function(e){return e.selectable}).map(function(e){return e[l.ins.idField]});r.instance.checkedNodes(t),r.instance.selectNodes(t)}}},{id:5,code:"uncheckchildnodes",title:"取消勾选下级数据",visible:function(e){return!e.data.node.selectable&&!l.ins.singleSelect&&e.data.node.children&&e.data.node.children.length},handle:function(e){if(r){var t=r.instance.getChildNodes(e.data.id).filter(function(e){return e.selectable}).map(function(e){return e[l.ins.idField]});r.instance.unCheckedNodes(t),r.instance.unSelectNodes(t)}}},"-",{id:1,code:"expandall",title:n.expandall,handle:function(e){r&&c()?r.instance.expandAll():l.reloadTreeDataForExpand(-1)}},{id:2,code:"collapseall",title:n.collapseall,handle:function(e){r&&r.instance.collapseAll()}},"-",{id:3,title:n.expandByLayer,children:s}];this.ins.treeTableOptions.contextMenuItems=d,r.instance.beforeShowContextMenu=function(){return u.of({show:!r.instance.state.searched})}}},ye.prototype.getCmpHeight=function(e){return void 0===e&&(e=!1),this.ins.dialogMgr.getHeight()-(e?10:this.ins.getFilterBarHeight())},ye.prototype.createContent=function(e){if(!this.ins.componentRef){var t=this.ins.getComponentType(),i=this.ins.cfr.resolveComponentFactory(t),n=null;n=this.ins.isDoublleList()?this.ins.centerContainer.createComponent(i):this.ins.contentContainer.createComponent(i),this.ins.isTree()?(e.fit=!0,e.pagination=!1,e.fast=!0,e.fitColumns=!1,this.useContextMenuForTree(n)):e.fill=!0,e.autoFitColumns=!0;var s=this.ins.treeTableOptions||{};return Object.assign(n.instance,e,x({allColumnsTitle:this.ins.allColumnsTitle},s)),this.ins.componentRef=n,this.resizeComponent(),n}},ye.prototype.createFavoritesContent=function(e){var t,i=this.ins.getComponentType(),n=this.ins.cfr.resolveComponentFactory(i);return t=this.ins.favoritesContainer.createComponent(n),this.ins.isTree()?(e.fit=!0,e.pagination=!1):e.fill=!0,e.autoFitColumns=!0,Object.assign(t.instance,e,{width:this.ins.dialog.size.width-this.ins.getSpaceWidth(),height:this.ins.dialogMgr.getHeight()}),this.ins.favHelper.initFavoriteComponentEvent(t),t},ye.prototype.resizeComponent=function(e){void 0===e&&(e="datatable");var t={width:this.ins.dialog.size.width-this.ins.getSpaceWidth(),height:this.getCmpHeight("fav"==e)};!this.ins.isDoublleList()||"datatable"!==e&&"treetable"!==e||(t.width=this.ins.dialog.size.width-this.ins.leftPanelWidth-this.ins.getSpaceWidth(!0)),this.getComponentInstance(e).resize(t)},ye.prototype.getChildNodes=function(e){var t=this,i=[];return!e.selectable&&e.selectable!==undefined||i.push(e),e.children&&e.children.length&&e.children.forEach(function(e){i.push.apply(i,D(t.getChildNodes(e)))}),i},ye.prototype.createLeftComponent=function(c){var d=this,e=null;return this.ins.isDoublleList()&&(e=this.ins.cfr.resolveComponentFactory(ge)),this.ins.leftComponentRef=this.ins.leftContainer.createComponent(e),c.height=this.ins.dialogMgr.getHeight(),this.ins.dialogWidth<this.ins.navLookupDialogMinWidth&&(this.ins.dialogWidth=this.ins.navLookupDialogMinWidth,this.ins.dialog.reSize({width:this.ins.dialogWidth}),this.ins.resizeCmp({width:this.ins.dialog.size.width})),c.width!==this.ins.leftPanel.width&&(this.ins.leftPanel.resize({width:this.ins.leftPanel.width,height:c.height}),this.ins.resizeCmp({width:this.ins.dialog.size.width})),this.ins.leftComponentRef.instance.lookupCmp=this.ins,this.ins.leftComponentRef.instance.navOptions=c,this.ins.leftComponentRef.instance.selected.pipe(y.debounceTime(100),y.switchMap(function(e){e&&e.data?d.ins.navigationFilter={selected:e.data,idValue:d.getNavigationFilter(e.data),searchField:"",searchValue:""}:d.ins.navigationFilter=undefined;var t={pageInfo:{pageIndex:1,pageSize:d.ins.gridOptions.pageSize}};if(d.ins.includeSubordinates&&e&&e.node&&c.treeInfo){var i=c.treeInfo,n=i.layerType,s=(i.pathField,i.loadDataType);if(i.dataField,"all"===s){var a=d.getChildNodes(e.node).map(function(e){return e.data});d.ins.navigationFilter.idValue=d.getNavigationFilter(a)}else"pathcode"==n&&(t.navNodePathCode=d.ins.getPathCode(e.data,c.treeInfo),d.ins.navNodePathCode=t.navNodePathCode)}else d.ins.navNodePathCode="";var o=d.getComponentInstance(),r=o.sortName,l=o.sortOrder;return Object.assign(t,{search:d.ins._searchState,sortName:r,sortOrder:l}),d.ins.httpMgr.getData(t,"list")})).subscribe(function(e){d.ins.closeLoading(),d.ins.loadDataWhenOpen=!0,d.ins.loadData(e,!1),setTimeout(function(){d.ins.selectionMgr.selectCurrentValue(),d.ins.changeDetector.detectChanges()})}),this.ins.leftComponentRef.instance.createComponent()},ye.prototype.getNavigationFilter=function(s){if(this.ins.navigationOptions.relations&&this.ins.navigationOptions.relations.length){var a=[];return this.ins.navigationOptions.relations.forEach(function(e){var t=e.groupField,i={fieldName:e.helpField,fieldValue:""};if(Array.isArray(s)){var n=s.map(function(e){return t.split(".").reduce(function(e,t){return e[t]},e)});i.fieldValue=n.join(",")}else i.fieldValue=t.split(".").reduce(function(e,t){return e[t]},s);a.push(i)}),a}return""},ye);function ye(e){this.ins=e}var be=(Ce.prototype.unsubscribes=function(){this.lookupInit&&(this.lookupInit.unsubscribe(),this.lookupInit=null),this.dialogClosedSubscription&&(this.dialogClosedSubscription.unsubscribe(),this.dialogClosedSubscription=null),this.dialogOpenedSubscription&&(this.dialogOpenedSubscription.unsubscribe(),this.dialogOpenedSubscription=null)},Ce.prototype.dialogClosed=function(){this.ins.displayText===this.ins.originalText||this.ins.nosearch||(this.ins.displayText=this.ins.originalText,this.ins.setModelValue(this.ins.displayText)),this.ins.componentRef&&(this.ins.componentRef.destroy(),this.ins.componentRef=null),this.ins.favoritesComponentRef&&(this.ins.favoritesComponentRef.destroy(),this.ins.favoritesComponentRef=null),this.ins.contentContainer&&this.ins.contentContainer.clear(),this.ins.centerContainer&&this.ins.centerContainer.clear(),this.ins.leftComponentRef&&(this.ins.leftComponentRef.destroy(),this.ins.leftComponentRef=null),this.ins.leftContainer&&this.ins.leftContainer.clear(),this.ins.isShow=!1,this.ins.isTextChange=!1,this.ins.dialog&&(this.ins.content=null),this.ins.navigationFilter=null,this.ins.lookupUtils.pendingEnd(),this.ins.helpId&&(this.ins.displayType=""),this.unsubscribes(),this.ins.favoriteItems=[],this.ins.lookupSelectionSer.initFavoriteItems([]),this.ins.isTabChanged=!1,this.ins.uri&&(this.ins.items=[]),this.ins._searchState=null,this.ins.pageIndex=1,this.ins.loadDataWhenOpen=this._loadDataWhenOpen,this.ins.navSelectedIds=this._navSelectedId,this.ins.selectFirstInNav=this._selectFirstInNav,this.ins.isGetAllChidlNodes=!1,this.ins.enableGetAllChildNodes=!0,this.ins.usePersionalConf&&"locale"!==this.ins.favoriteDataFrom&&this.ins.httpMgr.submitFavoriteData("dialog closed event."),this.keyDownHandler&&(this.keyDownHandler(),this.keyDownHandler=null),this.ins.inputGroup&&this.ins.inputGroup.focus(),this.ins.userInitialConfig.reset(),this.ins.treeInfo=this.ins._treeInfo_,this.ins.lookupUtils.destroy(),this.ins.dialogClosed.emit(),this.ins.includeSubordinates$$&&(this.ins.includeSubordinates$$.unsubscribe(),this.ins.includeSubordinates$$=null),this.ins.conditions=[],this.ins.searching=!1,this.ins.dtEventMgr&&(this.ins.dtEventMgr._sortState=null),this.ins.ttEventMgr&&(this.ins.ttEventMgr._sortState=null),this._okbtnclick$&&(this._okbtnclick$.unsubscribe(),this._okbtnclick$=null)},Ce.prototype.onDialogCreated=function(){var s=this;this._loadDataWhenOpen=this.ins.loadDataWhenOpen,this._navSelectedId=this.ins.navSelectedIds,this._selectFirstInNav=this.ins.selectFirstInNav,this.ins.dialogCreatedSubscription=this.ins.dialogCreated.subscribe(function(e){if(e){if(s.ins.setContainerMargin(),s.ins.dialogOpenedSubscription&&s.ins.dialogOpenedSubscription.unsubscribe(),s.ins.dialogClosedSubscription&&s.ins.dialogClosedSubscription.unsubscribe(),s.registerDialogEvent(),s.ins.isRecordSize){var t=s.ins.personalConfigService.getDialogSize();if(t){var i=t.width,n=t.height;s.ins.dialogWidth=i||s.ins.dialogWidth,s.ins.dialogHeight=n||s.ins.dialogHeight,e.width=s.ins.dialogWidth,e.height=s.ins.dialogHeight}}e.show()}}),this.ins.subscriptions.push(this.ins.dialogCreatedSubscription)},Ce.prototype.checkDictPickingResult=function(e){var t,i,n,s=!0;return e!==undefined&&null!==e&&""!==e||(s=!0),"boolean"==typeof e&&(s=e),t=this.ins.customData,i=this.ins.selectedIds,"object"==typeof e&&(s=e.showDialog===undefined||e.showDialog,e.hasOwnProperty("data")&&(t=e.data),i=e.selectedIds||null,e.message&&(n=e.message)),{show:s,customData:t,selectedIds:i,message:n}},Ce.prototype.canOpenDialog=function(e){var t=this.checkDictPickingResult(e),i=t.show,n=t.customData,s=t.selectedIds,a=t.message;this.ins.customData=n,this.ins.selectedIds=s||null,a&&this.ins.notifyService.warning(a),this.ins.isReady=!1,this.ins.isShow=i},Ce.prototype.getHeight=function(){return this.ins.dialog.size.contentHeight-this.ins.containerMargin.bottom-this.ins.containerMargin.top-(this.ins.useNewLayout?56:this.ins.useFavorite?40:0)},Ce.prototype.getMainGridSize=function(){return this.ins.isDoublleList()?{width:this.ins.dialog.size.width-this.ins.leftPanel.width-27,height:this.getHeight()}:{width:this.ins.dialog.size.width-this.ins.containerMargin.left-this.ins.containerMargin.right,height:this.getHeight()}},Ce.prototype.resetDialogContentHeight=function(){var e=this.ins.dialog.size,t=e.header,i=e.footer;return this.ins.dialogHeight-t-i-this.ins.containerMargin.bottom-this.ins.containerMargin.top},Ce.prototype.registerOkBtnEvent=function(){var t=this;if(this.ins.okButton){var e=u.fromEvent(this.ins.okButton.nativeElement,"click").pipe(y.filter(function(e){return 0===e.button})),i=e.pipe(y.debounceTime(250)),n=e.pipe(y.bufferCount(2)),s=u.race(i,n).pipe(y.first(),y.repeat());this._okbtnclick$=e.pipe(y.buffer(s),y.map(function(e){return e.length})).subscribe(function(e){t.ins.selectItem()})}},Ce.prototype.registerDialogEvent=function(){var s=this;this.dialogOpenedSubscription=this.ins.dialog.opened.subscribe(function(){s.ins.dialogContentHeight=s.resetDialogContentHeight(),s.ins.gridOptions=Object.assign(s.ins.gridOptions,s.getMainGridSize()),s.ins.dialog.el.nativeElement.querySelector(".ps-content").style.height="100%",s.ins.displayType&&s.ins.customDisplayType&&(s.ins.componentRef=s.ins.lookupCmpMgr.createContent(s.ins.gridOptions),s.ins.lookupCmpMgr.createFavoriteComponent()),s.ins.initData(),s.ins.lookupUtils.pendingEnd(),s.ins.dialogOpened.emit(),s.registerOkBtnEvent()}),this.lookupInit=this.ins.lookupinitializationSubject.subscribe(function(){if(s.ins.loadDataWhenOpen=!0,s.registerShortcutKey(),s.ins.leftPanel){if(!s.ins.leftPanel.resizing.observers.length){var e=s.ins.leftPanel.resizing.pipe(y.debounceTime(50)).subscribe(function(e){var t={width:s.ins.dialog.size.width-e.size.width-s.ins.getSpaceWidth(!0),height:s.getHeight()-s.ins.getFilterBarHeight()};s.ins.componentRef.instance.resize(t),s.ins.leftComponentRef.instance.resize(e.size)});s.ins.subscriptions.push(e)}s.ins.isDoublleList()&&s.ins.leftComponentRef&&s.ins.leftComponentRef.instance.updateScrollPosition()}if(s.ins.cascadeSelect){var t=s.ins.cascadeSelect,i=t.selectEl,n=t.panelRef;s.ins.cascadeSelect.beforeShow=function(){if(i&&n)return n.style.left=i.offsetLeft+"px","en"==s.ins.localService.localeId.toLocaleLowerCase()&&(n.style.width="auto",n.style.maxWidth="200px"),u.of(!0)}}}),this.dialogClosedSubscription=this.ins.dialog.closed.subscribe(function(){s.ins.dialogMgr.dialogClosed()})},Ce.prototype.registerShortcutKey=function(){var c=this,e=this.ins.dialog.el.nativeElement.querySelector(".farris-modal");e&&this.ins.shortcutKey&&!this.keyDownHandler&&(this.keyDownHandler=this.ins.eventManager.addEventListener(e,"keydown",function(e){e.stopPropagation();var t=c.ins.shortcutKey,i=t.moveUp,n=t.moveDown,s=t.searchFocus,a=t.confirm,o=t.nextPager,r=t.prevPager;if([i,n,t.expand,t.collapse].includes(e.code))c.ins.componentRef.instance.onKeydownEvent(e);else if(e.key===a){if("INPUT"===e.target.nodeName&&!e.ctrlKey)return;c.ins.okButton.nativeElement.click()}else if(e.code===s)e.preventDefault(),c.ins.componentRef.instance.inputGroup.focus();else if(!c.ins.isTree()&&(e.code===o||e.code===r)){var l=e.code===o;c.paginationKeyDownHandler(l)}}))},Ce.prototype.paginationKeyDownHandler=function(e){void 0===e&&(e=!0);var t=this.ins.componentRef.instance,i=t.pageIndex,n=t.pageSize,s=t.total,a=i;e?a+=1:a-=1,(Math.ceil(s/n)<a||a<1)&&(a=i),this.ins.componentRef.instance.onPageChange({pageSize:n,pageIndex:a})},Ce);function Ce(e){this.ins=e,this.lookupInit=null,this._loadDataWhenOpen=!0,this._navSelectedId="",this._selectFirstInNav=!1,this.dialogClosedSubscription=null,this.dialogOpenedSubscription=null,this.keyDownHandler=null,this._okbtnclick$=null}var Se=(Object.defineProperty(ke.prototype,"idField",{get:function(){return this.ins.idField},enumerable:!0,configurable:!0}),ke.prototype.initFavoriteItems=function(e){this.state.favoriteItems=e||[]},ke.prototype.updateFavoriteData=function(t,e){var i=this;this.ins.savingFaoriteData||(this.state.favoriteItems=e===P?this.state.favoriteItems.concat([t]):this.state.favoriteItems.filter(function(e){return e[i.idField]!==t[i.idField]}),this.favoriteItems$.next({items:this.state.favoriteItems,action:e,data:t}))},ke.prototype.loadSelections=function(e){this.state.selecteditems=D(e),this.state$.next(this.state)},ke.prototype.getSelections=function(){return D(this.state.selecteditems)},ke.prototype.select=function(e){e&&(this.state.selecteditems=D(this.state.selecteditems,[e]),this.state$.next(this.state),this.selectionChanged$.next({data:[e[this.idField]],selected:!0}))},ke.prototype.unselectByPathcode=function(n){var s=this,a=[];this.state.selecteditems=this.state.selecteditems.filter(function(e){var t=s.ins.getPathCode(e,s.ins.treeInfo),i=t&&0!==t.indexOf(n);return i||a.push(e[s.idField]),i}),this.selectionChanged$.next({data:a,selected:!1})},ke.prototype.updateSelections=function(e,t){var i=this;void 0===t&&(t=!0),Array.isArray(e)||(e=[e]);var n=D(e),s=this.idField,a=n.map(function(e){return e[s]});t?this.state.selecteditems&&!this.state.selecteditems.length?this.state.selecteditems=n:a.forEach(function(t,e){i.state.selecteditems.find(function(e){return e[s]==t})||i.state.selecteditems.push(n[e])}):e&&(this.state.selecteditems=this.state.selecteditems.filter(function(e){return-1===a.indexOf(e[s])})),this.state$.next(this.state),this.selectionChanged$.next({data:a,selected:t})},ke.prototype.unSelect=function(t){var i=this;t&&(Array.isArray(t)?(this.state.selecteditems=this.state.selecteditems.filter(function(e){return-1===t.indexOf(e[i.idField])}),this.selectionChanged$.next({data:t,selected:!1})):(this.state.selecteditems=this.state.selecteditems.filter(function(e){return e[i.idField]!=t}),this.selectionChanged$.next({data:[t],selected:!1})),this.state$.next(this.state))},ke.prototype.clearSelections=function(){this.state.selecteditems=[],this.state$.next(this.state)},ke);function ke(e){this.ins=e,this.state={selecteditems:[],favoriteItems:[],quickItems:[]},this.state$=new u.BehaviorSubject(this.state),this.selected$=this.state$.pipe(y.switchMap(function(e){return u.of(e.selecteditems)})),this.favoriteItems$=new u.BehaviorSubject({items:this.state.favoriteItems,action:null}),this.quickItems$=this.state$.pipe(y.switchMap(function(e){return u.of(e.quickItems)})),this.selectionChanged$=new u.Subject}var Ie,Te={provide:n.NG_VALUE_ACCESSOR,useExisting:S.forwardRef(function(){return xe}),multi:!0},xe=(function $e(e,t){function i(){this.constructor=e}T(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}(we,Ie=A),Object.defineProperty(we.prototype,"displayType",{get:function(){return this._displayType},set:function(t){if(t){var e=Object.values(R).findIndex(function(e){return e===t.toUpperCase()});if(-1<e){var i=Object.keys(R);this._displayType=R[i[e]]}}else this._displayType=t},enumerable:!0,configurable:!0}),Object.defineProperty(we.prototype,"gridOptions",{get:function(){return this.useFavorite&&this.columns&&0<this.columns.length&&!this.columns.find(function(e){return e.field===F})&&this.columns.push({field:F,title:"",width:40,align:"center",fixed:"right",formatter:this.favHelper.favoriteColumnFormatter}),this._gridOptions=Object.assign(this._gridOptions,{singleSelect:this.singleSelect,idField:this.idField,uri:this.uri,showFilterBar:!this.enableMultiFieldSearch&&this.showFilterBar,pagination:this.pagination,pageIndex:this.pageIndex,pageSize:this.pageSize,pageList:this.pageList,total:this.total,items:this.items,columns:this.columns,resizableColumns:!0,fixedHeader:!0,hover:!0,treeInfo:this.treeInfo,searchAnyField:this.searchAnyField}),this._gridOptions},set:function(e){this._gridOptions=Object.assign({},this._gridOptions,e)},enumerable:!0,configurable:!0}),Object.defineProperty(we.prototype,"selections",{get:function(){var e=this.lookupSelectionSer.getSelections();return this.singleSelect?e[0]:e},enumerable:!0,configurable:!0}),Object.defineProperty(we.prototype,"usePersionalConf",{get:function(){return this.useFavorite||this.useTip||this.isRecordSize},enumerable:!0,configurable:!0}),Object.defineProperty(we.prototype,"displayTextList",{get:function(){return this.displayText?this.displayText.split(this.multipleChoiceSeparator):[]},enumerable:!0,configurable:!0}),Object.defineProperty(we.prototype,"userInitialConfig",{get:function(){return this._userSettings},enumerable:!0,configurable:!0}),we.prototype.initLabels=function(){this.labels||(this.labels={dataTab:"",favTab:"",clearAllSelected:"",delSelected:""}),this.labels.clearAllSelected||(this.labels.clearAllSelected=this.localService.getValue("lookup.selectedInfo.clear")),this.labels.favTab||(this.labels.favTab=this.localService.getValue("lookup.favorites")),this.labels.dataTab||(this.labels.dataTab=this.localService.getValue("lookup.datalist"))},we.prototype.writeConsole=function(e,t){void 0===t&&(t="warn"),this.debugSer&&this.debugSer[t](e)},we.prototype.getFilterBarHeight=function(){return this.showFilterBar&&this.enableMultiFieldSearch?42:0},we.prototype.getSpaceWidth=function(e){return void 0===e&&(e=!1),(this.enableMultiFieldSearch?48:28)+(e?this.enableMultiFieldSearch?5:7:0)},we.prototype.cacheUserConfig=function(){var e=this;this._userSettings._title=this.title,this.displayInfo.title=this.title,this._userSettings._columns=this.deepClone(this.columns||[]),this._userSettings.getColumns=function(){return e._userSettings._columns},this._userSettings.reset=function(){e.title=e._userSettings._title,e.displayInfo.title=e.title,e.columns=e._userSettings.getColumns()}},we.prototype.deepClone=function(t){var i=this;if(null===t)return null;var n=Object.assign({},t);return Object.keys(n).forEach(function(e){return n[e]="object"==typeof t[e]?i.deepClone(t[e]):t[e]}),Array.isArray(t)?(n.length=t.length,Array.from(n)):n},we.prototype.ngOnInit=function(){Ie.prototype.ngOnInit.call(this),this.cacheUserConfig(),this.loadTreeDataType||(this.loadTreeDataType="default"),this.checkGridOptions(),this.displayInfo.title=this.title,this.http&&(this.http.context=this.context),this.allColumnsTitle=this.localService.getValue("lookup.allColumns"),this.mustWriteSomething=this.localService.getValue("lookup.mustWriteSomething"),this.mustChoosAdatarow=this.localService.getValue("lookup.mustChoosAdatarow"),this.addFavoriteSuccess=this.localService.getValue("lookup.favoriteInfo.addFav")||this.addFavoriteSuccess,this.delFavoriteSuccess=this.localService.getValue("lookup.favoriteInfo.cancelFav")||this.delFavoriteSuccess,this.dialogMgr.onDialogCreated(),this._treeInfo_=this.treeInfo?f.cloneDeep(this.treeInfo):null,this.quickSelect&&(this.quickSelect=Object.assign({},_,this.quickSelect||{})),this.setContainerMargin()},we.prototype.setContainerMargin=function(){var e=this.enableMultiFieldSearch?24:14,t=this.enableMultiFieldSearch?0:5;this.containerMargin={top:0,bottom:t,left:e,right:e},this.enableMultiFieldSearch&&(this.useNewLayout=!0),this.containerStyle={marginLeft:this.containerMargin.left+"px",marginRight:this.containerMargin.right+"px",marginTop:this.containerMargin.top+"px",marginBottom:this.containerMargin.bottom+"px"}},we.prototype.ngOnDestroy=function(){Ie.prototype.ngOnDestroy.call(this),this.subscriptions.forEach(function(e){e&&(e.unsubscribe(),e=null)}),this.selectionMgr&&this.selectionMgr.destroy(),this.subscriptions=[],this.farrisInstances&&this.farrisInstances.destroy(this.el.nativeElement),this.lookupSearchInputEvent&&this.lookupSearchInputEvent(),this.lookupUtils.destroy(),this.overLayService.destory(this.el.nativeElement),this.overLayService=null},we.prototype.ngOnChanges=function(e){e.columns&&!e.columns.isFirstChange()&&this.cacheUserConfig(),e.enableMultiFieldSearch&&!e.enableMultiFieldSearch.isFirstChange()&&this.setContainerMargin()},we.prototype.ngAfterViewInit=function(){if(this.quickSelect&&this.quickSelect.enable||(this.lookupSearchInputEvent=re.bind(this)()),this.usePersionalConf&&this.favHelper.initPersonalInfo(),this.useExtendInfo){var e=this.selectionMgr.getBindingData();this.updateExtendInfo(e,!1)}if("text"===this.viewType)this.render2.listen(this.inputGroup.textbox.nativeElement,"keydown.F2",this.showDialog.bind(this));else if(this.registerMouseEventForTagView(),this.tagboxHeight){var t=this.tagbox.nativeElement.querySelector(".multi-more"),i=this.tagboxHeight;"auto"!==i&&(i+="px",this.maxTagboxHeight&&this.render2.setStyle(t,"maxHeight",this.maxTagboxHeight+"px")),this.render2.setStyle(t,"height",i)}this.el&&this.farrisInstances&&this.farrisInstances.add(this.el.nativeElement,this)},we.prototype.createInstance=function(){this.http=this.injector.get(W,null),this.messagerService=this.injector.get(a.MessagerService),this.loadingService=this.injector.get(l.LoadingService),this.notifyService=this.injector.get(I.NotifyService,null),this.personalConfigService=this.injector.get(Q,null),this.lookupSelectionSer=new Se(this),this.utilService=new Z(this),this.localService=this.injector.get(v.LocaleService),this.treeNodeHelper=new Y(this),this.favHelper=new ee(this),this.ttEventMgr=new le(this),this.multiSelMgr=new de(this),this.httpMgr=new ue(this),this.lookupCmpMgr=new me(this),this.dialogMgr=new be(this),this.selectionMgr=new ie(this),this.dtEventMgr=new se(this)},we.prototype.showDialog=function(){var t=this;return this.disabled||this.readonly||(this.selectionMgr.initDisplayValue(),this.dictPickingSubscription=this.dictPicking({instance:this}).subscribe(function(e){t.dialogMgr.canOpenDialog(e)})),!1},we.prototype.isDoublleList=function(){return(this.displayType===R.NavList||this.displayType===R.NavTreeList||this.displayType===R.NavListTree)&&this.showNavigation},we.prototype.isTree=function(){var e=this.displayType.toUpperCase();return e===R.TreeList||e===R.NavListTree},we.prototype.onResized=function(e){this.resizeCmp(e.size),this.resized.emit(e.size)},we.prototype.onResizing=function(e){this.resizing.emit(e.size),this.resizeCmp(e.size),this.isDoublleList()&&this.leftComponentRef&&this.leftComponentRef.instance.resize({width:this.leftPanel.width,height:this.dialogMgr.getHeight()})},we.prototype.onMaxDialog=function(e){this.resizeCmp(e.size),this.leftPanel&&this.leftComponentRef.instance.resize({width:this.leftPanel.width,height:this.dialogMgr.getHeight()}),this.dialogContentHeight=this.dialogMgr.resetDialogContentHeight(),this.dialogMaxed.emit(e.size)},we.prototype.resizeCmp=function(e){if(this.componentRef&&this.componentRef.instance){var t={width:(e=e||this.dialog.size).width-this.containerMargin.left-this.containerMargin.right,height:0};this.useFavorite&&this.favoritesComponentRef&&"favorite"==this.activeTab?(t.height=this.lookupCmpMgr.getCmpHeight(!0),this.favoritesComponentRef.instance.resize(t)):(t.height=this.lookupCmpMgr.getCmpHeight(),this.isDoublleList()&&(t.width=e.width-this.leftPanel.width-this.getSpaceWidth(!0)),this.componentRef.instance.resize(t)),this.isRecordSize&&(this.personalConf.size=this.dialog.size,this.personalConfigService.updatePersonalConfig({size:this.dialog.size})),this.isDoublleList()&&this.layoutRef&&this.layoutRef.setPanelMaxSize()}},we.prototype.checkGridOptions=function(){this.gridOptions.idField||this.writeConsole("未设置主键字段 idField"),this.beforeSelectData||(this.beforeSelectData=function(){return u.of(!0)});var e=this.localService.getValue("lookup.contextMenu");this.treeTableOptions=Object.assign({language:e},this.defaultTreeTableOptions,this.treeTableOptions||{})},we.prototype.getComponentType=function(){switch(this.displayType||(this.displayType="LIST"),this.displayType){case R.List:case R.NavList:case R.NavTreeList:return o.DataTableComponent;case R.TreeList:case R.NavListTree:return r.TreeTableComponent}},we.prototype.showLoading=function(e){if(void 0===e&&(e=""),this.dialog&&this.dialog.modalContent&&!this.loading){var t={container:this.dialog.modalContent,delay:200};e&&(t.message=e),this.loading=this.loadingService.show(t)}else this.loading=this.loadingService.show()},we.prototype.closeLoading=function(){this.loading&&(this.loading.close(),this.loading=null),this.loadingService.clearAll()},we.prototype.getSearchColumns=function(e){var i=e.columns||this.columns;return e.searchFields?e.searchFields.map(function(t){var e=i.find(function(e){return e.field.toLowerCase()===t.value.toLowerCase()});return e&&(t.label=e.title),t}):i?i.filter(function(e){return e.searchField}).map(function(e){return{label:e.title,value:e.field}}):[]},we.prototype.initOptions=function(e){var n=this,t=u.of(!0);if(this.gridOptions.searchFields=this.getSearchColumns(e),e){if(this.columns&&this.columns.length||!e.columns||!e.columns.length||(this.columns=e.columns),this.initColumnWidth(this.columns),this.setLookupTitleText(e),this.isDoublleList()&&this.dialogWidth<this.navLookupDialogMinWidth&&!this.isRecordSize&&(this.dialogWidth=this.navLookupDialogMinWidth,this.dialog.reSize({width:this.dialogWidth})),this.customDisplayType||(this.changeDetector.detectChanges(),this.lookupCmpMgr.createComponentWithServerData(e)),this.isDoublleList()&&e.navigation&&!this.leftComponentRef){if(this.navigationOptions=e.navigation,this.navigationOptions.hover=!0,this.navigationOptions.searchFields=this.getSearchColumns(this.navigationOptions),this.initColumnWidth(this.navigationOptions.columns,"nav"),this.customNavFormatter&&(this.navigationOptions.columns.forEach(function(e){n.customNavFormatter[e.field]&&(e.formatter=n.customNavFormatter[e.field])}),this.navigationOptions.rowStyler=this.customNavFormatter.rowStyler,this.navigationOptions.cellStyler=this.customNavFormatter.cellStyler),this.displayType===R.NavTreeList){var i=this.navigationOptions.treeInfo.loadDataType;"default"!==this.loadTreeDataType&&(i="loadall"===this.loadTreeDataType?"all":"async"),this.navigationOptions.treeInfo.loadDataType=i}t=this.lookupCmpMgr.createLeftComponent(this.navigationOptions)}}else this.lookupCmpMgr.createContent(this.gridOptions),this.lookupCmpMgr.createFavoriteComponent();if(this.isTextChange?this.componentRef.instance.searchData.value=this.displayText:this._searchState&&this._searchState.value&&(this.componentRef.instance.searchData.value=this._searchState.value),this.customFormatter)this.columns.forEach(function(e){n.customFormatter[e.field]&&(e.formatter=n.customFormatter[e.field])}),this.customFormatter.rowStyler&&(this.componentRef.instance.rowStyler=this.customFormatter.rowStyler),this.customFormatter.cellStyler&&(this.componentRef.instance.cellStyler=this.customFormatter.cellStyler);else if(e.customStyles){var s=e.customStyles,a=s.row,o=s.cell,r=function(e,t){var i=n.utils.getValue(e.field,t);return"boolean"==typeof i?"0"==e.value||"1"==e.value||"true"==e.value||"false"==e.value?i!==("0"==e.value||"false"==e.value):i===!!e.value:i===e.value};a&&(this.componentRef.instance.rowStyler=function(e){var t=e.data,i=a.find(function(e){return r(e,t)});return i?i.styles:null}),o&&(this.componentRef.instance.cellStyler=function(e,t){var i=e.data,n=o.filter(function(e){return e.field===t}).find(function(e){return r(e,i)});return n?n.styles:null})}return t},we.prototype.setLookupTitleText=function(e){e.displayInfo&&(this.displayInfo=e.displayInfo),this.title&&"此处显示帮助标题"!==this.title&&(this.displayInfo.title=this.title),this.displayInfo&&e.title&&(this.displayInfo.title||(this.displayInfo.title=e.title))},we.prototype.showGetAllChildrenCheckbox=function(){this.isTree()&&this.treeInfo?this.enableGetAllChildNodes="all"!==this.treeInfo.loadDataType&&"pathcode"===this.treeInfo.layerType:this.enableGetAllChildNodes=!1},we.prototype.initData=function(){var i=this,e={next:function(t){return!1!==t||i.columns&&i.columns.length?null===t?(i.isShow=!1,void(i.dialog&&i.dialog.close())):void i.initOptions(t).subscribe(function(){if(i.selectedColumns=i.multiSelMgr.initSelectedColumns(),i.usePersionalConf&&(i.personalConfigService.getPersonalData()||i.personalConfigService.savePersonalConfig(i.personalConf)),i.isTabChanged||i.lookupSelectionSer.loadSelections(t.selectedItems||[]),i.isDoublleList()&&(i.navSelectedIds||i.selectFirstInNav)&&(i.loadDataWhenOpen=!1),t.activeTab&&!i.isTabChanged&&(i.activeTab="datalist",i.personalConf&&i.personalConf.tabIndex!==i.activeTab&&(i.personalConf.tabIndex=i.activeTab)),i.loadData(t),i.isTree()){if("datalist"===i.activeTab){var e=i.componentRef.instance;e.searchData.value&&i.items&&i.items.length&&i.items[0].children&&i.items[0].children.length&&e.toggleExpand(i.items[0],!0,!1)}i.showGetAllChildrenCheckbox()}i.isTextChange=!1,i._searchResult=null,i.closeLoading(),i.isReady=!0,i.changeDetector.detectChanges(),i.lookupinitializationSubject.next(),i.layoutRef&&i.layoutRef.setPanelMaxSize()}):(i.closeLoading(),i.closeDialog(),void(i.messagerService.modals&&i.messagerService.modals.length||i.notifyService.error({msg:i.localService.getValue("lookup.configError"),timeout:3e3})))},error:function(e){i.closeLoading(),i._searchResult=null,i.isTextChange=!1,i.hasError=!0,i.changeDetector.detectChanges(),"string"==typeof e?i.messagerService.error(e):e&&(e.Message?i.messagerService.error(e.Message):e.error?i.messagerService.exception(e.error):i.messagerService.error("应用服务器错误,请联系系统管理员！"))}},t={pageInfo:{pageSize:this.pageSize||20,pageIndex:1}},n="all";if(this.isTextChange&&(this._searchState={field:"*",value:this.displayText}),(this.isTree()||this.displayType===R.NavTreeList)&&-1<this.expandLevel&&(t.expandLevel=this.expandLevel),this._searchState&&this._searchState.value&&(t.search=this._searchState,n="search"),!this.isTabChanged&&this.enableToSelect){var s=this.selectionMgr.getSelectedIds();s&&s.length?t.selectedInfo={selected:!0,selectedIds:s}:this.selectedIds&&(t.selectedInfo={selected:!0,selectedIds:this.selectedIds})}this.showLoading(),this.hasError=!1,this.httpMgr.lookupRequest(t,n).pipe(y.map(function(e){return e?e.selectedItems=e.selectedData||[]:e&&"object"==typeof e&&(e.selectedItems=[]),null!==e&&e}),y.switchMap(function(e){return i.beforeLoadData?i.beforeLoadData({instance:i,res:e}):u.of(e)})).subscribe(e)},we.prototype.loadData=function(e,t){if(void 0===t&&(t=!0),"datalist"===this.activeTab)switch(this.useFavorite&&!this.isTree()&&this.favHelper.updateFavoritesStatus(e.items),this.displayType){case R.NavList:case R.NavTreeList:case R.List:this.loadDataTableData(e),t&&this.dtEventMgr.bindDataTableEvent();break;case R.TreeList:case R.NavListTree:this.loadTreeTableData(e,t)}else"favorite"===this.activeTab&&this.loadFavData(e);this.selectionMgr.selectCurrentValue()},we.prototype.loadFavData=function(e){var t=this;if(this.useFavorite){if(this.isTree()){this.setTreeInfo(e);var i=this.favHelper.initFavoriteTreeData(e.items),n=this.treeNodeHelper.flatTreeNodes(i).map(function(e){return e.data._addtional_=e.addtional,e.data});this.lookupSelectionSer.initFavoriteItems(n),setTimeout(function(){t.favoritesComponentRef.instance.scrollToY(1)})}else this.lookupSelectionSer.initFavoriteItems(e.items);this.favHelper.loadFavoritesData(e)}},we.prototype.loadDataTableData=function(e){e&&(this.useFavorite&&!this.isTree()&&this.favHelper.updateFavoritesStatus(e.items),this.gridOptions?(e&&e.columns&&e.columns.length&&(this.gridOptions.columns&&this.gridOptions.columns.length||(this.columns=e.columns)),this.items=e.items,this.total=e.total||e.items.length,e.searchFields&&(this.gridOptions.searchFields=this.getSearchColumns(e)),e.pageInfo?(!e.pageInfo.pageList||this.pageList&&this.pageList.length||(this.pageList=e.pageInfo.pageList),this.pagination=e.pageInfo.enablePager,this.pageIndex=e.pageInfo.pageIndex,this.pageSize=e.pageInfo.pageSize):this.pagination=!1):this.gridOptions=e),this.updateDataTable(this.gridOptions)},we.prototype.updateDataTable=function(e){if(e){var t=this.componentRef.instance;t.columns&&0!==t.columns.length||(t.columns=this.gridOptions.columns),t.allColumnsTitle=this.allColumnsTitle,t.searchFields=e.searchFields,t.pagination=e.pagination,t.pageList=this.pageList,t.remoteSort=this.remoteSort,t.striped=this.enableMultiFieldSearch,this.loadDataWhenOpen&&(t.loadData({pageSize:e.pageSize,pageIndex:this.gridOptions.pageIndex,total:this.gridOptions.total,data:this.gridOptions.items}),t.cd.markForCheck()),this.loadSuccess.emit()}},we.prototype.setTreeInfo=function(e){if(e){var t=null;if(e.treeInfo){var i=e.treeInfo.onlySelectLeaf,n="no";i!==undefined&&(n=i?"yes":"no"),t=x({},e.treeInfo,{onlySelectLeaf:n})}var s=this.gridOptions.treeInfo;s?(s.onlySelectLeaf!==undefined&&null!==s.onlySelectLeaf||(s.onlySelectLeaf="no"),"boolean"==typeof s.onlySelectLeaf&&(s.onlySelectLeaf=s.onlySelectLeaf?"yes":"no"),"default"===this.loadTreeDataType?s.loadDataType=t.loadDataType:(s.loadDataType="loadall"===this.loadTreeDataType?"all":"async",t.loadDataType=s.loadDataType),"default"!==s.onlySelectLeaf&&(t=Object.assign(t,s))):"default"!==this.loadTreeDataType&&(t.loadDataType="loadall"===this.loadTreeDataType?"all":"async"),this.treeInfo=t}},we.prototype.loadTreeTableData=function(e,t){var i=this;void 0===t&&(t=!0);var n=e?e.items:this.gridOptions.items;if(this.items=n,e){this.setTreeInfo(e);var s=this.gridOptions.treeInfo;s.treeDataIsInit||("pathcode"===s.layerType.toLowerCase()?this.items=this.lookupUtils.makeTree(this.items,s):this.items=this.lookupUtils.makeTreeWithParentID(this.items,"",s.dataField?s.dataField+"."+s.parentField:s.parentField,this.idField))}if(this.componentRef.instance instanceof r.TreeTableComponent){var a=this.componentRef.instance;this.treeInfo&&(a.loadDataType=this.treeInfo.loadDataType),this.columns&&this.columns.length||(a.columns=e.columns||[],this.gridOptions.columns=a.columns),t&&this.ttEventMgr.bindTreetableEvent();var o="default"===i.loadTreeDataType?"all"===a.loadDataType:"loadall"===i.loadTreeDataType;this.items=this.checkNodeCanBeSelect(this.items,o),a.keepSelect=!0,this.useFavorite&&this.favHelper.updateFavoritesStatus(this.items),this.loadDataWhenOpen&&a.loadData(this.items),a.resize()}},we.prototype.checkNodeCanBeSelect=function(e,t){var i=this;return void 0===t&&(t=!1),e&&e.length?e.map(function(e){return e.hasOwnProperty("addtional")&&(e.selectable=!e.addtional),e.children&&e.children.length?i.checkNodeCanBeSelect(e.children,t):!t||i._searchState&&i._searchState.value||(e.leaf=!0),e}):e},we.prototype.onChanges=function(e){e?(this.displayText=e,this.isTextChange=this.originalText!==this.displayText,this.nosearch&&(this.setModelValue(e),this.clearMappings.emit({instance:this,value:e})),this.onModelTouched(e),this.valueChanged.emit(e),this.textChanged.emit(e)):this.onClear()},we.prototype.onClear=function(e){if(void 0===e&&(e=!0),this.isTextChange=!1,this.displayText="",this.displayValue="",this.originalText="",this.extendInfo="",this.setModelValue(""),this.mappingFn)this.mappingFn(null,this.mapFields);else if(this.mapFields){var t=this.selectionMgr.getBindingData();t&&this.defaultMapping.lookupFieldMap(null,this.mapFields,t)}this.multiSelMgr.clear(),e&&this.clear.emit()},we.prototype.clearValue=function(e){void 0===e&&(e=!0),this.onClear(e)},we.prototype.selectItem=function(e){var t=this,i=null;if(e?i=e:(i=this.selections)?Array.isArray(i)&&!i.length&&(i=null):i=null,this._searchState={field:"*",value:""},this.okHandler)this.okHandler({data:i,instance:this});else if(this.beforeSelectData){var n=this.beforeSelectData({instance:this,data:i});n&&n.subscribe?n.subscribe(function(e){t._beforeSelectDataCallBack(e,i)}):this.writeConsole("帮助数据选中前事件未返回值或返回类型非Observable, 请检查","error")}else this._beforeSelectDataCallBack(!0,i)},we.prototype.getPathCode=function(e,t){return void 0===t&&(t=null),this.lookupUtils.getPathCode(e,t||this.treeInfo)},we.prototype.getLayerData=function(e,t){return void 0===t&&(t=null),this.lookupUtils.getLayerData(e,t||this.treeInfo)},we.prototype.getParentPathCode=function(n){for(var e,t,s=this,i=(e=n,t=function(e){return s.getLayerData(e)},Math.max.apply(Math,D(e.map("function"==typeof t?t:function(e){return e[t]})))),a=function(t){var e=n.filter(function(e){return s.getLayerData(e)===t});e&&e.length&&e.length<n.length&&e.forEach(function(e){var i=s.getPathCode(e),t=n.filter(function(e){var t=s.getPathCode(e);return t!==i&&0===t.indexOf(i)});t&&t.length&&(n=n.filter(function(e){return s.getPathCode(e)!==i}))})},o=1;o<=i;o++)a(o);return n},we.prototype._beforeSelectDataCallBack=function(e,s){var a=this,t=e,i="";if("boolean"==typeof e?t=e:"object"==typeof e?(t=e.canSelect,i=e.message):t=!1,s||(i=this.mustChoosAdatarow,t=!1),t){var n=u.of(s);if(!this.singleSelect&&this.enableCascade&&this.isTree()&&"all"!==this.treeInfo.loadDataType&&"pathcode"===this.treeInfo.layerType&&this.isGetAllChidlNodes){var o=this.getParentPathCode(s);o&&o.length&&(o=o.map(function(e){return a.getPathCode(e)}),this.showLoading(),n=this.httpMgr.getData({parentsIds:o},"allChildren").pipe(y.map(function(e){var t=e.items?e.items.map(function(e){return e.data}):[],i=D(s,t),n=i.map(function(e){return e[a.idField]});return(n=Array.from(new Set(n))).map(function(t){return i.find(function(e){return e[a.idField]===t})})})))}n.subscribe(function(e){a.closeLoading(),a.isGetAllChidlNodes&&a.lookupSelectionSer.loadSelections(e),a.updateControlValue(e),a.useTip&&e&&a.useTip&&a.personalConfigService.updateQueckSelected(e,a.localService.localeId)})}else i&&(this.notifyService?this.notifyService.warning(i):this.messagerService.warning(i,"",!0,function(){a.dialog.el.nativeElement.click()}))},we.prototype.updateControlValue=function(e){if(e){if(this.setDisplayText(e),this.mappingFn?this.mappingFn(e,this.mapFields,this.bindingData):this.mapFields&&this.bindingData&&this.defaultMapping.lookupFieldMap(e,this.mapFields,this.bindingData),this.setModelValue(this.displayText),this.inDatagrid&&e){var t=Array.isArray(e)?e:[e];this.updateBindData(t)}this.selectedData.emit(e),this.runDictPickedEvent(e),this.isTextChange=!1}else document.activeElement&&document.activeElement.blur(),this.messagerService.warning(this.mustChoosAdatarow)},we.prototype.updateBindData=function(n){var s=this;if(this.mapFields){var e=Object.keys(this.mapFields);if(this.ngControl&&this.ngControl.formDirective&&this.ngControl.formDirective.form&&this.ngControl.formDirective.form.bindingData){var a=this.ngControl.formDirective.form.bindingData;a&&e.forEach(function(i){s.mapFields[i].split(",").forEach(function(e){var t=n.map(function(e){return s.utils.getValue(i,e)}).join(s.multipleChoiceSeparator);s.utils.setValue(a,e,t)})})}}},we.prototype.getExtendInfoFields=function(e){var i=this;if(void 0===e&&(e=!0),!this.extInfoFields)return this.writeConsole("未设置扩展字段。"),[];var t=this.extInfoFields.split(",");return e?t.map(function(t){var e=Object.keys(i.mapFields).find(function(e){return i.mapFields[e]===t});return e||(i.writeConsole("在帮助映射字段中未找到"+t),"")}):t},we.prototype.onUpdateExtendInfo=function(){var e=this.selectionMgr.getBindingData();this.updateExtendInfo(e,!1)},we.prototype.updateExtendInfo=function(e,t){var i=this;if(void 0===t&&(t=!0),e)if(this.extInfoFormatter)if(Array.isArray(e)){var n=e.map(function(e){return i.getExtendInfoText(e)});this.extendInfo=n.join("，")}else this.extendInfo=this.getExtendInfoText(e);else{var s=this.getExtendInfoFields(t);s&&s.length&&(Array.isArray(e)?(n=e.map(function(e){return i.getExtendInfoText(e,s)}),this.extendInfo=n.join("，")):this.extendInfo=this.getExtendInfoText(e,s))}},we.prototype.getExtendInfoText=function(n,e){var s=this;if(void 0===e&&(e=null),"function"==typeof this.extInfoFormatter)return this.extInfoFormatter({bindingData:n,instance:this});var a=[];return e.map(function(e){var t,i=s.utils.getValue(e,n);return a.push(i),(t={})[e]=i,t}),a.join(" ")},we.prototype.getDisplayText=function(e){var n=this,s=this.displayFields?this.displayFields.split(","):[this.textField],t=e.map(function(t){var i=[];return s.forEach(function(e){i.push(n.utils.getValue(e,t))}),i.join(n.displayTextSeparator)});return this.gridOptions.singleSelect?t.join(""):this.displayFields?t.map(function(e){return"["+e+"]"}).join(this.multipleChoiceSeparator):t.join(this.multipleChoiceSeparator)},we.prototype.setDisplayText=function(e){var t=this;if(this.originalText=this.displayText,this.gridOptions.singleSelect){if(this.displayFormatter)if(this.displayText=this.utils.getValue(this.textField,e),this.isTree()){var i=this.componentRef.instance;this.displayText=this.displayFormatter(this.displayText,[e],{lookup:this,tree:i})}else this.displayText=this.displayFormatter(this.displayText,[e],{lookup:this,datatable:this.componentRef.instance});else this.displayText=this.getDisplayText([e]);this.displayValue=e[this.valueField||this.idField]}else e.length&&(this.displayFormatter?(this.displayText=e.map(function(e){return t.utils.getValue(t.textField,e)}).join(this.multipleChoiceSeparator),this.isTree()?(i=this.componentRef.instance,this.displayText=this.displayFormatter(this.displayText,e,{lookup:this,tree:i})):this.displayText=this.displayFormatter(this.displayText,e,{lookup:this,datatable:this.componentRef.instance})):this.displayText=this.getDisplayText(e),this.displayValue=e.map(function(e){return t.utils.getValue(t.valueField||t.idField,e)}).join(this.multipleChoiceSeparator));this.originalText=this.displayText},we.prototype.runDictPickedEvent=function(t){var i=this;this.dictPicked?(this.okButton&&(this.okButton.nativeElement.disabled=!0),this.dictPickedSubscription=this.dictPicked(t).subscribe(function(e){i.okButton&&(i.okButton.nativeElement.disabled=!1),"boolean"==typeof e?e&&i.closeDialog(t):"object"!=typeof e||e.closeDialog===undefined||e.closeDialog?i.closeDialog(t):e.message?i.messagerService.warning(e.message):i.closeDialog(t)})):this.closeDialog(t)},we.prototype.focusToInput=function(){var e=this;this.zone.runOutsideAngular(function(){setTimeout(function(){e.inputGroup&&e.inputGroup.textbox&&e.inputGroup.textbox.nativeElement.focus()})})},we.prototype.closeDialog=function(e){void 0===e&&(e=null),this.dialog&&this.dialog.close(),e&&this.multiSelMgr.save(e),this.focusToInput()},we.prototype.cancelSelect=function(){this.closeDialog(),this.isTextChange=!1,this.nosearch||(this.displayText=this.originalText,this.setModelValue(this.displayText)),this.cancelHandler&&this.cancelHandler(this)},we.prototype.setModelValue=function(e){this.onModelChange&&(this.onModelChange(e),this.valueChanged.emit(e))},we.prototype.onTabChange=function(e){var t=this;this.activeTab=e.tabIndex,this.personalConf.tabIndex=this.activeTab;var i=this.isTabChanged;if(this.isTabChanged=!0,this.personalConfigService.updatePersonalConfig({tabIndex:e.tabIndex}),"datalist"===this.activeTab){if(this.isDoublleList()&&!this.leftComponentRef){if(!this.navigationOptions)return void this.initData();this.lookupCmpMgr.createLeftComponent(this.navigationOptions)}this.items&&this.items.length?i||(this.isTree()?this.loadTreeTableData():(this.loadDataTableData(),this.dtEventMgr.bindDataTableEvent())):this.initData(),this.showGetAllChildrenCheckbox()}else"favorite"===this.activeTab&&(this.isTree()?this.initData():this.favoriteItems&&this.favoriteItems.length&&this.favoriteItems.length===this.favHelper.getFavoritIds().length?i||this.favHelper._loadFavoriteData(this.favoriteItems):this.initData());this.changeDetector.detectChanges(),setTimeout(function(){if(t.resizeCmp(),t.isTree()){var e=t.componentRef.instance.state.scrollY;t.componentRef.instance.scrollToY(e,0),t.enableCascade&&t.ttEventMgr.cascadeValueChanged(t.cascadeStatus)}t.isDoublleList()&&t.displayType===R.NavTreeList&&!t.navTreeToList&&t.leftComponentRef.instance.updateScrollPosition(),t.selectionMgr.selectCurrentValue()})},we.prototype.registerMouseEventForTagView=function(){this.enableClear&&(this.tagbox.nativeElement.addEventListener("mouseenter",this.onTagboxMouseEnter.bind(this)),this.tagbox.nativeElement.addEventListener("mouseleave",this.onTagboxMouseLeave.bind(this)))},we.prototype.toggleClearIcon=function(e,t){void 0===t&&(t=!1);var i=t?"":"none",n=e.target.querySelector(".input-group-clear");n&&(n.style.display=i)},we.prototype.onTagboxMouseEnter=function(e){this.displayText&&this.enableClear&&(this.readonly||this.disabled||(this.showTagboxClearButton=!0)),this.showTagboxClearButton&&this.toggleClearIcon(e,!0)},we.prototype.onTagboxMouseLeave=function(e){this.toggleClearIcon(e)},we.prototype.onRemoveSelectItem=function(e,t){e.stopPropagation();var i=Array.from(this.displayTextList),n=this.displayTextList.indexOf(t);if(i.splice(n,1),this.displayText=i.join(this.multipleChoiceSeparator),this.originalText=this.displayText,this.setModelValue(this.displayText),this.displayValue){var s=this.displayValue.split(this.multipleChoiceSeparator);s.splice(n,1),this.displayValue=s.join(this.multipleChoiceSeparator)}this.mapFields&&this.updateOtherFieldDataWhenTagremoved(n),this.tagRemoved.emit({removedIndex:n,instance:this})},we.prototype.updateOtherFieldDataWhenTagremoved=function(s){var a=this,e=Object.keys(this.mapFields),t=e.indexOf(this.textField);if(this.ngControl&&this.ngControl.formDirective&&this.ngControl.formDirective.form&&this.ngControl.formDirective.form.bindingData){var o=this.ngControl.formDirective.form.bindingData;if(o.setValue){var i=this.ngControl.formDirective.form.bindingPath,r=[];i&&(r=i.split("/").filter(function(e){return""!==e})),e.forEach(function(e){a.mapFields[e].split(",").forEach(function(e){var t=r.concat(e.split(".")),i=o.getValue(t).split(a.multipleChoiceSeparator);i.splice(s,1);var n=i.join(a.multipleChoiceSeparator);o.setValue(r.concat(t),n,!0,!0)})})}}else this.bindingData&&(-1<t&&e.splice(t,1),e.forEach(function(e){a.mapFields[e].split(",").forEach(function(e){var t=a.utils.getValue(e,a.bindingData).split(a.multipleChoiceSeparator);t.splice(s,1);var i=t.join(a.multipleChoiceSeparator);a.utils.setValue(a.bindingData,e,i)})}))},we.prototype.onAllChildNodesClick=function(e){this.isGetAllChidlNodes=!this.isGetAllChidlNodes},we.prototype.onIncludeSubordinatesChange=function(e){this.includeSubordinates=e,this.includeSubordinates$.next(e)},we.prototype.onTagContainerClick=function(e){e.stopPropagation(),this.tagInput&&(this.tagInput.focus(),this.tagInput.textbox.nativeElement.click())},we.prototype.expandFirstNode=function(e){var t=this;return e&&e.length?e.map(function(e){return e.children&&e.children.length&&(e.expanded=!0,t.expandFirstNode(e.children)),e}):e},we.prototype.getLookupBindingFields=function(){var t=this;return this.ngControl?this.ngControl.name?this.ngControl.name:this.mapFields&&this.mapFields.length?Object.keys(this.mapFields).map(function(e){return t.mapFields[e]}).join("_"):this.textField:""},we.prototype.onConditionsChange=function(e){this.isTree()?this.ttEventMgr.conditionsChange(e):this.dtEventMgr.conditionsChange(e)},we.prototype.clearSelected=function(e){var t=this;e&&e.stopPropagation();var i=this.localService.getValue("lookup.selectedInfo.confirm");this.messagerService.confirm(i||"您确认要取消所有已选中的记录吗？").subscribe(function(e){e&&(t.multiSelMgr.clear(),t.selectedDtRef&&t.selectedDtRef.clearSelections())})},we.prototype.onDeleteSelectedItem=function(e){var t=this;if(e&&e.stopPropagation(),this.selectedDtRef.selections&&this.selectedDtRef.selections.length){var i=this.selectedDtRef.selections.map(function(e){return e[t.idField]});this.multiSelMgr.deleteSelectedItems(this.selectedDtRef.selections),this.selectedDtRef.unCheckRows(i)}else this.notifyService.warning("请勾选要删除的记录！")},we.prototype.initColumnWidth=function(e,t){if(void 0===t&&(t="data"),this.personalConf&&this.personalConf.colSizeInfo&&this.personalConf.colSizeInfo.data){var i=this.personalConf.colSizeInfo[t];if(i){var n=Object.keys(i);n&&n.length&&e.forEach(function(e){i[e.field]&&(e.width=i[e.field])})}}},we.decorators=[{type:S.Component,args:[{selector:"farris-lookup-grid",template:'\x3c!--\r\n * @Author: 疯狂秀才(Lucas Huang)\r\n * @Date: 2019-06-16 13:44:59\r\n * @LastEditors: 疯狂秀才(Lucas Huang)\r\n * @LastEditTime: 2019-11-18 08:47:32\r\n * @QQ: 1055818239\r\n * @Version: v0.0.1\r\n --\x3e\r\n\r\n <input-group #inputgroup\r\n    *ngIf="viewType === \'text\'"\r\n    [groupText]="groupIcon"\r\n    [lookup-tip]= "useTip"\r\n    [(ngModel)]="displayText"\r\n    [disabled]="disabled"\r\n    [readonly]="readonly"\r\n    [editable]="editable"\r\n    [customCls]="\'lookupbox\'"\r\n    [placeholder]="\'lookup.placeholder\' | locale: \'请选择\': placeholder"\r\n    [enableClear]="enableClear"\r\n    [useExtendInfo]="useExtendInfo"\r\n    [extendInfo]="extendInfo"\r\n    [maxLength]="maxLength"\r\n    (updateExtendInfo)="onUpdateExtendInfo()"\r\n    [textAlign]="textAlign"\r\n    [value]="displayText"\r\n    (valueChange)="onChanges($event)"\r\n    (clickHandle)="showDialog()"\r\n    (clear)="onClear()"\r\n    [quick-select]="quickSelect"\r\n></input-group>\r\n\r\n\x3c!--Tag style--\x3e\r\n<div #tagbox class="input-group" [class.f-state-disabled]="disabled" [class.f-state-readonly]="readonly" *ngIf="viewType === \'tag\'" [attr.title]="displayText">\r\n    <div class="form-control f-cmp-inputgroup--multi-wrapper multi-more" style="height: auto; min-height: 24px;">\r\n        <div class="multi--content d-flex flex-row" style="width: 100%;flex-wrap: wrap;" #tagContainer (click)="onTagContainerClick($event)">\r\n            <span class="multi--item" *ngFor="let txt of displayTextList; let index" title="" style="cursor: default;padding: 0 5px;\r\n            background: #ebf7fe;\r\n            border: 1px solid #cfedff;\r\n            position: relative;\r\n            padding-right: 20px;\r\n            margin-right: 3px;margin-top: 1px;height:18px; float: left;">\r\n                {{txt}}\r\n                <i class="f-icon f-icon-close" *ngIf="!readonly && !disabled" style="cursor: pointer;position:absolute; right: 2px" (click)="onRemoveSelectItem($event, txt)"></i>\r\n            </span>\r\n\r\n            <span *ngIf="quickSelect && quickSelect.enable && !readonly && !disabled" style="flex: 1;position: relative;min-width: 100px;height: 18px;margin: 0;padding: 0;float: left;overflow: hidden;">\r\n                \x3c!-- <input type="text" style="border: 0;outline: none;width: 100px;" #tagInput> --\x3e\r\n                <input-group #tagInput style="position: absolute; top: 0px; height: 20px;align-items: center;display: flex;left: -8px; width: 100%"\r\n                    [placeholder]="\'lookup.placeholder\' | locale: \'请选择\': placeholder"\r\n                    [quick-select]="quickSelect"  [enableClear]="false" [noborder]="true"\r\n                ></input-group>\r\n            </span>\r\n        </div>\r\n        \x3c!-- <div class="multi--more" *ngIf="selections && selections.length">\r\n            <i class="f-icon multi--more-icon"></i><span class="multi--more-text">{{selections.length}}</span>\r\n        </div> --\x3e\r\n    </div>\r\n    <div class="input-group-append" style="position: relative;" title="" >\r\n        <span class="input-group-text input-group-clear" style="display: none; padding: 0px 4px;position: absolute;right: 22px;height: 100%;" (click)="onClear()">\r\n            <i class="f-icon modal_close"></i>\r\n        </span>\r\n        <span class="input-group-text" (click)="showDialog()">\r\n            <span class="f-icon f-icon-lookup"></span>\r\n        </span>\r\n    </div>\r\n</div>\r\n\r\n\r\n<farris-dialog\r\n    #dialog\r\n    *ngIf="isShow"\r\n    [draggable]="draggable"\r\n    [resizable]="resizable"\r\n    [title]="displayInfo.title"\r\n    [beforeOpen]="beforeOpen"\r\n    [beforeClose]="beforeClose"\r\n    [(width)]="dialogWidth"\r\n    [(height)]="dialogHeight"\r\n    [showButtons]="showButtons"\r\n    [showMaxButton]="showMaxButton"\r\n    [showCloseButton]="true"\r\n    [buttons]="buttonsRef || defaultButtonRef"\r\n    [buttonAlign]="buttonAlign"\r\n    [enableScroll]="false"\r\n    [dialogHeaderHeight]="50"\r\n    (maxed)="onMaxDialog($event)"\r\n    (resized)="onResized($event)"\r\n    (resizing)="onResizing($event)"\r\n    [showHeader] = "!useNewLayout"\r\n    class="farris-lookup-dialog"\r\n    [class.lookup-advanced]="useNewLayout"\r\n    [minWidth]="550"\r\n    [minHeight]="480"\r\n>\r\n\r\n    <div [ngStyle]="containerStyle" style="height: 100%;" >\r\n        <lookup-tabs (tabChange)="onTabChange($event)" [enableFav]="useFavorite" [activeTab]="activeTab" \r\n            [visible]="isReady" [dialogTitle]="displayInfo.title" [layout]="useNewLayout ? \'advanced\': \'default\'"\r\n           >\r\n            <div datalist class="d-flex f-utils-absolute-all flex-column">   \r\n                <layout [direction]="\'h\'" [fill]="true" *ngIf="isDoublleList()" #layout>\r\n                    <layout-panel #leftPanel [width]="leftPanelWidth" region="west" [minWidth]="200" [showBorder]="false" [overflow]="\'hidden\'">\r\n                        <ng-container #leftContainer></ng-container>\r\n                    </layout-panel>\r\n                    <layout-panel region="center" [showBorder]="false" [overflow]="\'hidden\'" [minWidth]="200">\r\n                        <div class="lookup-filter-bar" lookup-filter-bar *ngIf="enableMultiFieldSearch && showFilterBar" [viewType]="searchBarMode"\r\n                            (conditionsChange)="onConditionsChange($event)" [searchAnyField]="searchAnyField" [columns]="columns" [searchFields]="gridOptions?.searchFields"></div>\r\n                        <ng-container #centerContainer></ng-container>\r\n                    </layout-panel>\r\n                </layout>\r\n                <div class="lookup-filter-bar" lookup-filter-bar *ngIf="!isDoublleList() && enableMultiFieldSearch && showFilterBar" [viewType]="searchBarMode"\r\n                    [columns]="columns" (conditionsChange)="onConditionsChange($event)" [searchAnyField]="searchAnyField"  [searchFields]="gridOptions?.searchFields"></div>\r\n                <ng-container *ngIf="!isDoublleList()" #contentContainer></ng-container>\r\n            </div>\r\n            <div favorites  class="d-flex f-utils-all h-100" *ngIf="useFavorite"> \r\n                <ng-container #favoritesContainer></ng-container>\r\n            </div>\r\n        </lookup-tabs>\r\n\r\n    </div>\r\n</farris-dialog>\r\n\r\n<ng-template #selectedPagerExtendTemplate let-dtref>\r\n    <button class="btn btn-link btn-sm p-0 pl-1 mr-3" \r\n        *ngIf="dtref?.selections && dtref?.selections.length" (click)="onDeleteSelectedItem($event)">\r\n        {{ \'lookup.selectedInfo.remove\' | locale | replaceX: dtref?.selections.length}}\r\n    </button>\r\n</ng-template>\r\n\r\n\r\n<ng-template #defaultButtonRef>\r\n    \x3c!-- 已选记录浮层 --\x3e\r\n    <div class="lookup-selected-panel fade hide d-none" #selectedpanel  *ngIf="showSelected">\r\n        <div class="arrow" [style.left.px]="displayType===\'NAVTREELIST\' && activeTab === \'datalist\' && showNavigation ? 123: 38"></div>\r\n        <div class="overlay" style="top: 0px;"></div>\r\n        <div class="content lookup-datalist" #panelContent>\r\n\r\n            <farris-datatable #multiSelectDT \r\n                [idField]="idField"\r\n                [bordered]="false"\r\n                [width]="panelContent.offsetWidth - 28"\r\n                [columns]="selectedColumns"\r\n                [data]="currentSelectedItems | async"\r\n                (cellClick)="multiSelMgr?.onSelectedTableCellClick($event)"\r\n                [singleSelect]="false"\r\n                [striped]="true"\r\n                [pagination]="true"\r\n                [pageSize]="20"\r\n                [pagerOnServer]="false"\r\n                [pagerViewMode]="\'simple\'"\r\n                [showPageInfo]="false" \r\n                [showPageNumber]="false" \r\n                [showPageList]="false"\r\n                [remoteSort]="false"\r\n                [total]="(currentSelectedItems | async)?.length"\r\n                [pagerExtendTemplate]="selectedPagerExtendTemplate"\r\n                [autoFitColumns]="true"\r\n            >\r\n        </farris-datatable>\r\n\r\n        </div>\r\n        <div class="overlay" style="bottom: 0px;"></div>\r\n    </div>\r\n\r\n\r\n   \r\n\x3c!--以下为按钮区域--\x3e\r\n\r\n    <div class="f-utils-fill d-flex flex-row m-0" style="text-align: left; align-items: center;height: 30px" *ngIf="isReady">\r\n        \x3c!--左侧导航树 包含下级--\x3e\r\n        <div class="d-flex mr-2" *ngIf="displayType===\'NAVTREELIST\' && activeTab === \'datalist\' && showNavigation">\r\n            <div class="custom-control custom-checkbox custom-control-inline m-0 p-0">\r\n                <input class="custom-control-input" type="checkbox" id="farris-lookup-nav_get-all-child-nodes" [ngModel]="includeSubordinates" (ngModelChange)="onIncludeSubordinatesChange($event)">\r\n                <label class="custom-control-label btn-link lookup-checkbox-label" for="farris-lookup-nav_get-all-child-nodes" style="padding-left: 18px;">{{ \'lookup.cascade.down\' | locale: \'包含下级\' }}</label>\r\n            </div>\r\n        </div>\r\n\r\n        <ng-container *ngIf=" !singleSelect">\r\n\r\n            \x3c!--已选记录--\x3e\r\n            <div class="lookup-selected-bar d-flex" *ngIf="showSelected" \r\n                [style.pointerEvents]="(currentSelectedItems | async)?.length ? \'auto\': \'none\'" \r\n                [style.opacity]="(currentSelectedItems | async)?.length ? 1: 0.4"\r\n                lookup-selected [count]=" (currentSelectedItems | async)?.length"\r\n                [selectedPanel]="selectedpanel" [dataTableRef]="selectedDtRef"\r\n                [class.mr-2]="!((currentSelectedItems | async)?.length)"\r\n                [innerHTML]="\'lookup.selectedInfo.total\' | locale | replaceX: (currentSelectedItems | async)?.length">\r\n            </div>\r\n            <button class="btn btn-link btn-sm p-0 pl-1 mr-3 lookup-clear-selected-items" \r\n                *ngIf="showSelected && (currentSelectedItems | async)?.length" (click)="clearSelected($event)">\r\n                {{labels.clearAllSelected}}\r\n            </button>\r\n\r\n            \x3c!--树表帮助级联控制--\x3e\r\n            <select *ngIf="showCascadeControl && enableCascade && displayType===\'TREELIST\'" class="form-control" style="width: auto; display: inline-block" (ngModelChange)="ttEventMgr?.cascadeValueChanged($event)" \r\n            [ngModel]="cascadeStatus" name="cascadeStatus" single-select #cascadeSelect="singleSelect" [panelRef]="selectpanel" [width]="110" [position]="\'above\'">\r\n                \x3c!-- <option value="enable" *ngIf="cascadeItems ? cascadeItems.enable : true">{{ \'lookup.cascade.enable\' | locale: \'同步选择\' }}</option>\r\n                <option value="up" *ngIf="cascadeItems ? cascadeItems.up : true">{{ \'lookup.cascade.up\' | locale: \'包含上级\' }}</option>\r\n                <option value="down" *ngIf="cascadeItems ? cascadeItems.down : true">{{ \'lookup.cascade.down\' | locale: \'包含下级\' }}</option>\r\n                <option value="disable" *ngIf="cascadeItems ? cascadeItems.disable : true">{{ \'lookup.cascade.disable\' | locale: \'仅选择自身\' }}</option> --\x3e\r\n            </select>\r\n            <div #selectpanel class="single-select-panel f-area-hide" [style.left]="showSelected ? (currentSelectedItems | async)?.length ? \'164px\': \'92px\': \'auto\'">\r\n                <ul class="dropdown-menu show">\r\n                    <li class="dropdown-item" [class.active]="cascadeStatus === \'enable\'" value="enable" *ngIf="cascadeItems ? cascadeItems.enable : true">{{ \'lookup.cascade.enable\' | locale: \'同步选择\' }}</li>\r\n                    <li class="dropdown-item" [class.active]="cascadeStatus === \'up\'" value="up" *ngIf="cascadeItems ? cascadeItems.up : true">{{ \'lookup.cascade.up\' | locale: \'包含上级\' }}</li>\r\n                    <li class="dropdown-item" [class.active]="cascadeStatus === \'down\'" value="down" *ngIf="cascadeItems ? cascadeItems.down : true">{{ \'lookup.cascade.down\' | locale: \'包含下级\' }}</li>\r\n                    <li class="dropdown-item" [class.active]="cascadeStatus === \'disable\'" value="disable" *ngIf="cascadeItems ? cascadeItems.disable : true">{{ \'lookup.cascade.disable\' | locale: \'仅选择自身\' }}</li>\r\n                </ul>\r\n            </div>\r\n\r\n            \x3c!--获取所有子级数据--\x3e\r\n            <div class="f-utils-fill custom-control custom-checkbox custom-control-inline m-0 p-0 ml-2" *ngIf="enableGetAllChildNodes && enableCascade && displayType===\'TREELIST\'">\r\n                <input class="custom-control-input" type="checkbox" id="farris-lookup_get-all-child-nodes">\r\n                <label class="custom-control-label btn-link lookup-checkbox-label" for="farris-lookup_get-all-child-nodes" \r\n                    style="padding-left: 18px;overflow: hidden;white-space: nowrap;text-overflow: ellipsis;" title="{{\'lookup.getAllChilds\'|locale: \'获取所有子级数据\'}}"\r\n                    (click)="onAllChildNodesClick($event)">{{\'lookup.getAllChilds\'|locale: \'获取所有子级数据\'}}</label>\r\n            </div>\r\n        </ng-container>\r\n    </div>\r\n\r\n    <button type="button" class="btn btn-secondary btn-lg" (click)="cancelSelect()" [disabled]="!(isReady || hasError)" >\r\n        {{ \'lookup.cancelText\' | locale: \'取消\' }}\r\n    </button>\r\n    <button #okbtn type="button" [disabled]="!isReady" class="btn btn-primary btn-lg" >\r\n        {{ \'lookup.okText\' | locale: \'确定\' }}\r\n    </button>\r\n   \r\n    \r\n</ng-template>\r\n',providers:[Te,t.ShortcutsService,$,G,Q],encapsulation:S.ViewEncapsulation.None,exportAs:"lookup",styles:[".input-group{flex-wrap:nowrap}.ng-dirty.ng-invalid>input-group>.lookupbox{border-color:#ff0303}.lookup-clear{cursor:pointer;background:#fff!important}.lookup-clear:hover{background:#e9ecef!important}.f-lookup-favorite{cursor:pointer;color:#ff9800}.f-lookup-unfavorite{cursor:pointer;color:#dd2438}.lookup-tip{position:absolute;min-width:200px;max-height:400px;padding:.25rem 0;z-index:7777;background:#fff;box-shadow:0 2px 8px 0 rgba(0,0,0,.15);border-radius:2px}.lookup-tip .lookup-tip-header{font-weight:700;padding:.25rem .475rem;border-radius:0}.lookup-tip ul{display:-webkit-box;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;flex-direction:column;padding-left:0;margin-bottom:0}.lookup-tip ul li{position:relative;display:block;width:100%;margin-bottom:-1px;padding:.25rem .875rem;color:rgba(0,0,0,.85);background-color:#fff;cursor:pointer}.lookup-tip ul li:hover{background-color:#e6f7ff}.f-lookup_quick-panel{height:100%;z-index:10001;position:absolute;overflow:auto;background:#fff;margin-top:.25rem;box-shadow:0 2px 8px 0 #dedede;border-radius:3px}.f-lookup_quick-panel .list{margin:0 6px}.f-lookup_quick-panel .list-group-item{padding:0 8px;border:0;margin-bottom:0;word-break:break-all;min-height:30px}.f-lookup_quick-panel .more{height:50px;text-align:center;line-height:50px}.f-lookup_quick-panel .norecord{height:100%;-webkit-box-pack:center;justify-content:center;-webkit-box-align:center;align-items:center;display:-webkit-box;display:flex;font-size:16px;color:#bec6db}"]}]}],we.ctorParameters=function(){return[{type:S.Injector},{type:S.ComponentFactoryResolver},{type:S.ElementRef},{type:k.CommonUtils},{type:$},{type:S.ChangeDetectorRef},{type:t.ShortcutsService},{type:G},{type:S.NgZone},{type:S.Renderer2}]},we.propDecorators={customDisplayType:[{type:S.Input}],viewType:[{type:S.Input}],displayType:[{type:S.Input}],enableClear:[{type:S.Input}],remoteSort:[{type:S.Input}],condition:[{type:S.Input}],conditions:[{type:S.Input}],showCheckAll:[{type:S.Input}],singleSelect:[{type:S.Input}],multipleChoiceSeparator:[{type:S.Input}],idField:[{type:S.Input}],uri:[{type:S.Input}],beUri:[{type:S.Input}],showFilterBar:[{type:S.Input}],pagination:[{type:S.Input}],pageIndex:[{type:S.Input}],pageSize:[{type:S.Input}],pageList:[{type:S.Input}],total:[{type:S.Input}],columns:[{type:S.Input}],remoteSearch:[{type:S.Input}],searchOnServer:[{type:S.Input}],nosearch:[{type:S.Input}],clearMappings:[{type:S.Output}],maxLength:[{type:S.Input}],mappingFn:[{type:S.Input}],items:[{type:S.Input}],favoriteItems:[{type:S.Input}],customData:[{type:S.Input}],bindingData:[{type:S.Input}],treeInfo:[{type:S.Input}],enableCascade:[{type:S.Input}],cascadeStatus:[{type:S.Input}],cascadeItems:[{type:S.Input}],showCascadeControl:[{type:S.Input}],placeholder:[{type:S.Input}],showSelected:[{type:S.Input}],useFavorite:[{type:S.Input}],favoriteDataFrom:[{type:S.Input}],useTip:[{type:S.Input}],isRecordSize:[{type:S.Input}],userId:[{type:S.Input}],enableToSelect:[{type:S.Input}],enableFindText:[{type:S.Input}],expandLevel:[{type:S.Input}],navTreeTableOptions:[{type:S.Input}],treeTableOptions:[{type:S.Input}],dataTableOptions:[{type:S.Input}],loadTreeDataType:[{type:S.Input}],loadDataWhenOpen:[{type:S.Input}],navSelectedIds:[{type:S.Input}],selectFirstInNav:[{type:S.Input}],enableFullTree:[{type:S.Input}],displayFormatter:[{type:S.Input}],displayFields:[{type:S.Input}],displayTextSeparator:[{type:S.Input}],helpId:[{type:S.Input}],textAlign:[{type:S.Input}],enableTitle:[{type:S.Input}],useExtendInfo:[{type:S.Input}],extInfoFields:[{type:S.Input}],extInfoFormatter:[{type:S.Input}],extendInfo:[{type:S.Input}],customFormatter:[{type:S.Input}],customNavFormatter:[{type:S.Input}],okHandler:[{type:S.Input}],cancelHandler:[{type:S.Input}],tagboxHeight:[{type:S.Input}],maxTagboxHeight:[{type:S.Input}],enableGetAllChildNodes:[{type:S.Input}],shortcutKey:[{type:S.Input}],quickSelect:[{type:S.Input}],treeToList:[{type:S.Input}],navTreeToList:[{type:S.Input}],showNavigation:[{type:S.Input}],beforeSelectData:[{type:S.Input}],beforeLoadData:[{type:S.Input}],useNewLayout:[{type:S.Input}],enableMultiFieldSearch:[{type:S.Input}],searchBarMode:[{type:S.Input}],allowQueryFields:[{type:S.Input}],labels:[{type:S.Input}],searchAnyField:[{type:S.Input}],selectedData:[{type:S.Output}],clear:[{type:S.Output}],search:[{type:S.Output}],query:[{type:S.Output}],valueChanged:[{type:S.Output}],loadSuccess:[{type:S.Output}],pagerChanged:[{type:S.Output}],expandTreeNode:[{type:S.Output}],textChanged:[{type:S.Output}],checkedChange:[{type:S.Output}],tagRemoved:[{type:S.Output}],gridOptions:[{type:S.Input}],contentContainer:[{type:S.ViewChild,args:["contentContainer",{read:S.ViewContainerRef}]}],favoritesContainer:[{type:S.ViewChild,args:["favoritesContainer",{read:S.ViewContainerRef}]}],leftContainer:[{type:S.ViewChild,args:["leftContainer",{read:S.ViewContainerRef}]}],centerContainer:[{type:S.ViewChild,args:["centerContainer",{read:S.ViewContainerRef}]}],selectedDtRef:[{type:S.ViewChild,args:["multiSelectDT"]}],inputGroup:[{type:S.ViewChild,args:["inputgroup"]}],leftPanel:[{type:S.ViewChild,args:["leftPanel"]}],tagbox:[{type:S.ViewChild,args:["tagbox"]}],okButton:[{type:S.ViewChild,args:["okbtn"]}],tagInput:[{type:S.ViewChild,args:["tagInput"]}],selectedpanel:[{type:S.ViewChild,args:["selectedpanel"]}],cascadeSelect:[{type:S.ViewChild,args:["cascadeSelect"]}],layoutRef:[{type:S.ViewChild,args:["layout"]}]},we);function we(e,t,i,n,s,a,o,r,l,c){var d=Ie.call(this,e,i,a)||this;return d.injector=e,d.cfr=t,d.el=i,d.utils=n,d.defaultMapping=s,d.changeDetector=a,d.shortcuts=o,d.lookupUtils=r,d.zone=l,d.render2=c,d.groupIcon='<i class="f-icon f-icon-lookup"></i>',d._displayType="",d.customDisplayType=!1,d.viewType="text",d.enableClear=!0,d.remoteSort=!0,d.showCheckAll=!1,d.singleSelect=!0,d.multipleChoiceSeparator=",",d.uri="",d.beUri="",d.showFilterBar=!0,d.pagination=!0,d.pageIndex=1,d.pageSize=20,d.pageList=[10,20,30,50,100],d.total=0,d.columns=[],d.remoteSearch=!0,d.searchOnServer=!0,d.nosearch=!1,d.clearMappings=new S.EventEmitter,d.favoriteItems=[],d.enableCascade=!1,d.cascadeStatus="enable",d.cascadeItems={enable:!0,up:!0,down:!0,disable:!0},d.showCascadeControl=!0,d.placeholder="",d.showSelected=!1,d.useFavorite=!1,d.favoriteDataFrom="remote",d.useTip=!1,d.isRecordSize=!1,d.enableToSelect=!0,d.enableFindText=!1,d.expandLevel=-1,d.navTreeTableOptions={},d.treeTableOptions={},d.dataTableOptions={},d.defaultTreeTableOptions={maxLevel:9,enableContextMenu:!1,contextMenuItems:[]},d.loadTreeDataType="default",d.loadDataWhenOpen=!0,d.navSelectedIds="",d.selectFirstInNav=!1,d.enableFullTree=!0,d.displayFormatter=undefined,d.displayFields="",d.displayTextSeparator="_",d.helpId="",d.textAlign="left",d.enableTitle=!0,d.useExtendInfo=!1,d.extInfoFields="",d.extendInfo="",d.customFormatter=null,d.customNavFormatter=null,d.okHandler=null,d.cancelHandler=null,d.tagboxHeight="auto",d.enableGetAllChildNodes=!0,d.shortcutKey={open:"ArrowRight",confirm:"Enter",searchFocus:"F3",moveUp:"ArrowUp",moveDown:"ArrowDown",expand:"ArrowRight",collapse:"ArrowLeft",nextPager:"PageDown",prevPager:"PageUp"},d.quickSelect=null,d.treeToList=!1,d.navTreeToList=!1,d.showNavigation=!0,d.useNewLayout=!1,d.enableMultiFieldSearch=!1,d.searchBarMode=z,d.allowQueryFields=null,d.labels={dataTab:"",favTab:"",clearAllSelected:"",delSelected:""},d.searchAnyField=!0,d.selectedData=new S.EventEmitter,d.clear=new S.EventEmitter,d.search=new S.EventEmitter,d.query=new S.EventEmitter,d.valueChanged=new S.EventEmitter,d.loadSuccess=new S.EventEmitter,d.pagerChanged=new S.EventEmitter,d.expandTreeNode=new S.EventEmitter,d.textChanged=new S.EventEmitter,d.checkedChange=new S.EventEmitter,d.tagRemoved=new S.EventEmitter,d.containerMargin={top:0,bottom:5,left:14,right:14},d.containerStyle={},d._gridOptions=B,d.leftPanelWidth=320,d.navLookupDialogMinWidth=960,d.navigationFilter=null,d.subscriptions=[],d.isTextChange=!1,d.isTabChanged=!1,d.displayInfo=Object.assign({},q),d.tabChangeSubscription=null,d.personalConf={},d.favoriteColumns=[],d._searchState=null,d.allData=[],d.allColumnsTitle="所有列",d.mustWriteSomething="请输入关键字后查询。",d.mustChoosAdatarow="请选择一条记录！",d.addFavoriteSuccess="收藏成功。",d.delFavoriteSuccess="移除收藏成功。",d.useInsideSearchHandler=!1,d.searching=!1,d._searchResult=null,d.lookupinitializationSubject=new u.Subject,d.currentSelectedItems=u.of([]),d.selectedColumns=[],d.activeTab="datalist",d.favHelper=null,d.ttEventMgr=null,d.multiSelMgr=null,d.httpMgr=null,d.lookupCmpMgr=null,d.dialogMgr=null,d.selectionMgr=null,d.dtEventMgr=null,d.lookupSelectionSer=null,d.controlId="",d.savingFaoriteData=!1,d.isReady=!1,d.showTagboxClearButton=!1,d.hasError=!1,d.cascadeStatusItems=[{valeu:"enable",label:""},{valeu:"up",label:""},{valeu:"down",label:""},{valeu:"disable",label:""}],d.isGetAllChidlNodes=!1,d.selectedIds=[],d.lookupSearchInputEvent=null,d.farrisInstances=null,d._userSettings={},d._treeInfo_=null,d.dialogContentHeight=0,d.includeSubordinates=!1,d.includeSubordinates$=new u.Subject,d.includeSubordinates$$=null,d.debugSer=null,d.createInstance(),d.currentSelectedItems=d.lookupSelectionSer.selected$,d.eventManager=d.injector.get(h.EventManager),d.farrisInstances=d.injector.get(k.FarrisComponentInstanceService,null),d.overLayService=new k.OverLayHiddenService,d.debugSer=d.injector.get(k.DebugService,null),d.debugSer&&d.debugSer.useDebugMode(),d.lookupSelectionSer.selectionChanged$.subscribe(function(e){d.selectedDtRef&&(e.selected||d.selectedDtRef.unCheckRows(e.data))}),d.initLabels(),d}var De=(Fe.prototype.ngOnChanges=function(e){e.activeTab&&!e.activeTab.isFirstChange()&&this.initInkBarPos(e.activeTab.currentValue)},Fe.prototype.ngAfterViewInit=function(){var e=this;setTimeout(function(){e.initInkBarPos(e.activeTab)},300)},Fe.prototype.navClickHandle=function(e,t){e.stopPropagation(),this.activeTab!==t&&(this.activeTab=t,this.tabChange.emit({event:e,tabIndex:t}),this.initInkBarPos(t))},Fe.prototype.initInkBarPos=function(e){if("default"===this.layout&&this.enableFav){var t=this.dataListNavRef.nativeElement.offsetWidth,i=0;"datalist"!==e&&(i=this.dataListNavRef.nativeElement.offsetWidth),"favorite"===e?t=this.favoriteNavRef.nativeElement.offsetWidth:"selected"===e&&(this.favoriteNavRef&&(i+=this.favoriteNavRef.nativeElement.offsetWidth),this.selectedNavRef?t=this.selectedNavRef.nativeElement.offsetWidth:this.activeTab="datalist"),this.inkBarRef.nativeElement.style="width: "+t+"px; transform: translate3d("+i+"px, 0px, 0px);"}},Fe.prototype.ngOnInit=function(){},Fe.decorators=[{type:S.Component,args:[{selector:"lookup-tabs",template:'<div class="lookup-tabs-nav" *ngIf="enableFav && layout === \'default\'">\r\n    <div class="nav-item" [class.nav-item-selected]="activeTab === \'datalist\'" (click)="navClickHandle($event, \'datalist\')" #dataListNav>{{ \'lookup.datalist\' | locale: \'数据列表\' }}</div>\r\n    <div class="nav-item" [class.nav-item-selected]="activeTab === \'favorite\'" *ngIf="enableFav" (click)="navClickHandle($event, \'favorite\')" #favoriteNav>{{ \'lookup.favorites\' | locale: \'收藏夹\' }}</div>\r\n    <div class="tabs-ink-bar tabs-ink-bar-animated" #inkBar></div>\r\n</div>\r\n\r\n<lookup-advanced-layout *ngIf="layout !== \'default\'" \r\n#advanceLayout class="lookup-advanced-layout"\r\n[title]="dialogTitle"\r\n[enableFav]="enableFav"\r\n[activeTab]="activeTab"\r\n[dataTab]="lookupIns?.labels.dataTab"\r\n[favTab]="lookupIns?.labels.favTab"\r\n(tabChanged)="navClickHandle($event.$event, $event.tab)"></lookup-advanced-layout>\r\n\r\n<div class="lookup-tabs-content" style="transition: all 0.1s ease-in;" [style.opacity]="visible ? 1: 0">\r\n    <div class="lookup-datalist" style="height:100%"  @flyInOut *ngIf="activeTab === \'datalist\'">\r\n        <div style="height: 100%">\r\n            <ng-content select="[datalist]"></ng-content>\r\n        </div>\r\n    </div>\r\n    <div class="lookup-datalist lookup-favorites" style="height:100%; padding-top: 10px;" @flyInOut *ngIf="activeTab === \'favorite\'" >\r\n        <div style="height: 100%">\r\n            <ng-content select="[favorites]"></ng-content>\r\n        </div>\r\n    </div>\r\n</div>',animations:[g.trigger("flyInOut",[g.transition(":enter",[g.style({opacity:0}),g.animate(".3s",g.style({opacity:1}))]),g.transition(":leave",[g.animate(".3s",g.style({opacity:0}))])])],styles:[":host{display:-webkit-box;display:flex;height:100%;-webkit-box-orient:vertical;-webkit-box-direction:normal;flex-direction:column}:host .lookup-tabs-nav{position:relative;display:inline-block;box-sizing:border-box;margin:0;padding-left:0;list-style:none;-webkit-transition:-webkit-transform .3s cubic-bezier(.645,.045,.355,1);transition:transform .3s cubic-bezier(.645,.045,.355,1);transition:transform .3s cubic-bezier(.645,.045,.355,1),-webkit-transform .3s cubic-bezier(.645,.045,.355,1)}:host .lookup-tabs-nav .nav-item{position:relative;display:inline-block;text-decoration:none;box-sizing:border-box;padding:.625rem .8125rem;color:inherit;cursor:pointer}:host .lookup-tabs-nav .nav-item-selected{color:#1890ff}:host .lookup-tabs-nav .tabs-ink-bar{position:absolute;bottom:1px;left:0;z-index:1;box-sizing:border-box;height:2px;background-color:#1890ff;-webkit-transform-origin:0 0;transform-origin:0 0}:host .lookup-tabs-nav .tabs-ink-bar-animated{-webkit-transition:width .3s cubic-bezier(.645,.045,.355,1),left .3s cubic-bezier(.71,.03,.35,1),-webkit-transform .3s cubic-bezier(.645,.045,.355,1);transition:transform .3s cubic-bezier(.645,.045,.355,1),width .3s cubic-bezier(.645,.045,.355,1),left .3s cubic-bezier(.71,.03,.35,1),-webkit-transform .3s cubic-bezier(.645,.045,.355,1)}:host .lookup-tabs-content{-webkit-box-flex:1;flex:1;border-top:1px solid #cecece;position:relative;top:-2px}"]}]}],Fe.ctorParameters=function(){return[{type:S.Injector}]},Fe.propDecorators={enableFav:[{type:S.Input}],activeTab:[{type:S.Input}],visible:[{type:S.Input}],layout:[{type:S.Input}],dialogTitle:[{type:S.Input}],tabChange:[{type:S.Output}],inkBarRef:[{type:S.ViewChild,args:["inkBar"]}],dataListNavRef:[{type:S.ViewChild,args:["dataListNav"]}],favoriteNavRef:[{type:S.ViewChild,args:["favoriteNav"]}],selectedNavRef:[{type:S.ViewChild,args:["selectedNav"]}],advanceLayoutRef:[{type:S.ViewChild,args:["advanceLayout"]}]},Fe);function Fe(e){this.injector=e,this.enableFav=!1,this.activeTab="datalist",this.visible=!1,this.layout="default",this.dialogTitle="",this.tabChange=new S.EventEmitter,this.render=null,this.el=null,this.lookupIns=null,this.personalConfigService=this.injector.get(Q,null),this.render=this.injector.get(S.Renderer2),this.el=this.injector.get(S.ElementRef),this.lookupIns=this.injector.get(xe,null),this.lookupIns.labels||this.lookupIns.initLabels()}var Re=(Oe.prototype.ngOnInit=function(){var t=this;this.tipText=this.localService.getValue("lookup.tipText"),this.enableTip=!1,this.enableTip&&(this.inputRef.iconMouseEnter.subscribe(function(e){t.creatPanel()}),this.inputRef.iconMouseLeave.pipe(y.delay(200)).subscribe(function(e){t.isInTipPanel||t.removePanel()}),this.inputRef.clickHandle.subscribe(function(e){t.removePanel()}))},Oe.prototype.ngAfterViewInit=function(){},Oe.prototype.getQuickSelectedByLocaleId=function(){var e=this.localService.localeId,t=this.personalConfigService.getPersonalData();if(t&&t.quickSelected){var i=t.quickSelected[e];if(i&&i.length)return i}return null},Oe.prototype.creatPanel=function(){var n=this;if(this.selected=this.getQuickSelectedByLocaleId(),!(this.tipPanel||!this.selected||this.selected&&0===this.selected.length)){var e=this.setPosition(),s=this.renderer.createElement("ul");this.personalConfigService.textField.split("."),this.selected.forEach(function(e,t){var i=n.renderer.createElement("li");i.innerHTML=n.find(e,n.personalConfigService.textField),n.renderer.setProperty(i,"id",t),n.renderer.appendChild(s,i)});var t=this.renderer.createElement("div");this.renderer.addClass(t,"lookup-tip-header"),t.innerHTML=this.tipText,this.tipPanel=this.renderer.createElement("div"),this.renderer.appendChild(this.tipPanel,t),this.renderer.appendChild(this.tipPanel,s),this.renderer.addClass(this.tipPanel,"lookup-tip"),this.renderer.setStyle(this.tipPanel,"top",e.top),this.renderer.setStyle(this.tipPanel,"left",e.left),this.renderer.setStyle(this.tipPanel,"width",e.width),this.renderer.appendChild(document.body,this.tipPanel),this.leaveEvent=this.renderer.listen(this.tipPanel,"mouseleave",function(){n.removePanel()}),this.enterEvent=this.renderer.listen(this.tipPanel,"mouseenter",function(){n.isInTipPanel=!0}),this.clickEvent=this.renderer.listen(this.tipPanel,"click",function(e){"LI"===e.target.nodeName&&n.selectItem(e.target.id)})}},Oe.prototype.removePanel=function(){document.body.contains(this.tipPanel)&&(this.renderer.removeChild(document.body,this.tipPanel),this.tipPanel=null,this.isInTipPanel=!1,this.leaveEvent(),this.enterEvent(),this.clickEvent())},Oe.prototype.setPosition=function(){var e=this.inputRef.inputGroup.nativeElement.getBoundingClientRect(),t=e.left,i=e.top,n=e.width;return{left:t+"px",top:i+e.height+"px",width:n+"px"}},Oe.prototype.selectItem=function(i){var e=this.selected.find(function(e,t){return Number(i)===t});this.removePanel(),this.personalConfigService.singleSelect?this.personalConfigService.selectItemObser$.next(e):this.personalConfigService.selectItemObser$.next([e])},Oe.prototype.find=function(e,t){var i=t.split("."),n=e[i[0]];return n instanceof Object?(i.shift(),this.find(n,i.join("."))):n},Oe.decorators=[{type:S.Directive,args:[{selector:"[lookup-tip]"}]}],Oe.ctorParameters=function(){return[{type:m.InputGroupComponent},{type:S.Renderer2},{type:S.Injector}]},Oe.propDecorators={enableTip:[{type:S.Input,args:["lookup-tip"]}]},Oe);function Oe(e,t,i){this.inputRef=e,this.renderer=t,this.injector=i,this.enableTip=!1,this.isInTipPanel=!1,this.tipText="您要找的是不是这些？",this.personalConfigService=this.injector.get(Q,null),this.localService=this.injector.get(v.LocaleService)}var Ee=(Le.prototype.onClick=function(e){e.stopPropagation()},Le.prototype.ngOnInit=function(){},Le.prototype.loadData=function(e){this.data=e,this.cdr.destroyed||this.cdr.detectChanges()},Le.prototype.onMoreClick=function(e){e.stopPropagation(),this.moreClcik.emit(e)},Le.prototype.formatData=function(e){return this.formatter(e)},Le.prototype.onItemClick=function(e,t){this.itemClick.emit({data:t,evnet:e})},Le.prototype.setActiveItem=function(e){this.activeIndex=e,this.cdr.destroyed||this.cdr.detectChanges()},Le.decorators=[{type:S.Component,args:[{selector:"lookup-quick-select-panel",template:'<div class="d-flex flex-column" style="width: 100%;height:100%;padding-top: 5px" #itemsContainer>\r\n    \x3c!-- <div class="header"></div> --\x3e\r\n    <div class="list f-utils-fill f-datalist" style="overflow: auto;">\r\n        <ul class="list-group list-group-flush p-0"  [class.h-100]="!data || !data.length">\r\n            <li class="list-group-item list-group-item-action" [class.active]="activeIndex === i" *ngFor="let item of data; index as i" (click)="onItemClick($event, item)">\r\n                <span *ngIf="!formatter">{{ textField | getvalue: item }}</span> \r\n                <span *ngIf="formatter" [innerHTML]="formatData(item) | safe:\'html\'"></span>\r\n            </li>\r\n\r\n            <li class="norecord" *ngIf="!data || !data.length">\r\n                {{ \'lookup.quick.notfind\'|locale }}\r\n            </li>\r\n        </ul>\r\n    </div>\r\n    <div class="more" *ngIf="showMore && data && data.length && data.length >= maxItems">\r\n        <button class="btn btn-link" (click)="onMoreClick($event)"> {{ \'lookup.quick.more\'|locale }}</button>\r\n    </div>\r\n     \x3c!-- <div class="footer"></div> --\x3e\r\n</div>'}]}],Le.ctorParameters=function(){return[{type:S.Injector},{type:S.ChangeDetectorRef}]},Le.propDecorators={showMore:[{type:S.Input}],data:[{type:S.Input}],textField:[{type:S.Input}],formatter:[{type:S.Input}],maxItems:[{type:S.Input}],moreClcik:[{type:S.Output}],itemClick:[{type:S.Output}],itemsContainer:[{type:S.ViewChild,args:["itemsContainer"]}],onClick:[{type:S.HostListener,args:["mousedown",["$event"]]}]},Le);function Le(e,t){this.injector=e,this.cdr=t,this.showMore=!0,this.data=[],this.textField="",this.maxItems=10,this.moreClcik=new S.EventEmitter,this.itemClick=new S.EventEmitter,this.activeIndex=-1}var Me=(Pe.prototype.ngOnInit=function(){},Pe.prototype.ngAfterViewInit=function(){var a=this;this.options&&this.options.enable&&(this.inputRef.inputClick.subscribe(function(e){e.stopPropagation(),a.panelElement||a.lookupRef.dictPicking({instance:a}).subscribe(function(e){if(a.lookupRef.displayType!==R.TreeList&&(a.lookupRef.singleSelect||"text"!==a.lookupRef.viewType)){var t=a.lookupRef.dialogMgr.checkDictPickingResult(e),i=t.show,n=t.customData,s=t.message;a.lookupRef.customData=n,i?a.createDataPanel():s&&a.lookupRef.notifyService.warning(s)}})}),this.inputRef.valueChange.pipe(y.debounceTime(200)).subscribe(function(e){a.lookupRef.dictPicking({instance:a}).subscribe(function(e){if(a.lookupRef.displayType!==R.TreeList&&(a.lookupRef.singleSelect||"text"!==a.lookupRef.viewType)){var t=a.lookupRef.dialogMgr.checkDictPickingResult(e),i=(t.show,t.customData);t.message,a.lookupRef.customData=i,a.panelElement?(a.panelElement.style.overflow="hidden",a.setPanelPosition(!1),a.loadData()):a.createDataPanel()}})}),this.inputRef.keydownHandle.pipe(y.filter(function(e){return"Escape"===e.key||"Tab"===e.key||"F2"===e.key})).subscribe(function(e){a.hide(e)}))},Pe.prototype.ngOnDestroy=function(){this.lookupRef.overLayService.destory(this.lookupRef.el.nativeElement)},Pe.prototype.removePanelElement=function(){document.body.removeChild(this.panelElement),this.panelElement=null},Pe.prototype.clearSearchValue=function(){this.lookupRef._searchState={field:"*",value:""}},Pe.prototype.hide=function(e,t){var i=this;void 0===t&&(t=!1),k.reqAnimFrame(function(){if(i.panelElement){if(!e||"mousewheel"!==e.type&&"wheel"!==e.type?(i.panelElement.classList.remove("f-area-show"),setTimeout(function(){i.removePanelElement()},120)):i.removePanelElement(),!i.lookupRef)return;if(i.lookupRef.overLayService&&i.lookupRef.overLayService.destory(i.lookupRef.el.nativeElement),t)return;if(i.lookupRef.tagInput&&(i.inputRef.value="",i.clearSearchValue()),e&&("F2"===e.key||i.lookupRef.el.nativeElement.contains(e.target))){if(i.data&&i.data.length)return;i.clearSearchValue()}i.lookupRef.nosearch||i.lookupRef.displayText===i.lookupRef.originalText||i.lookupRef.onChanges(i.lookupRef.originalText)}})},Pe.prototype.setPanelPosition=function(e){if(void 0===e&&(e=!0),this.panelElement){var t=this.getPanelSize(),i=t.width,n=t.left,s=t.top,a=t.height;this.panelElement.style.width=i+"px",this.panelElement.style.maxHeight=a+"px",e&&(this.panelElement.style.top=s+"px"),this.panelElement.style.left=n+"px",this.panelElement.style.zIndex="10001"}},Pe.prototype.createDataPanel=function(){var i=this;if(this.lookupRef.changeDetector.destroyed)this.panelElement&&this.removePanelElement();else{this.panelElement=document.createElement("div"),this.panelElement.classList.add("overlay-pane","f-lookup_quick-panel","f-area-hide"),document.body.appendChild(this.panelElement),this.setPanelPosition(),this.panelElement.style.overflow="hidden";var e=this.cfr.resolveComponentFactory(Ee);this.cmpRef=e.create(this.injector),this.cmpRef.instance.showMore=this.options.showMore,this.cmpRef.instance.textField=this.lookupRef.textField,this.cmpRef.instance.formatter=this.options.formatter,this.cmpRef.instance.maxItems=this.options.showItemsCount,this.panelElement.appendChild(this.cmpRef.location.nativeElement),this.lookupRef.selectionMgr.initDisplayValue(),this.cmpRef.changeDetectorRef.detectChanges(),this.cmpRef.instance.moreClcik.subscribe(function(e){i.hide(e,!0),i.lookupRef.showDialog()}),this.cmpRef.instance.itemClick.subscribe(function(e){var t=e.data;i.selectItem(t)}),this.lookupRef.overLayService.registerMouseEvent(this.lookupRef.el.nativeElement,function(e){if(i.panelElement&&!e.target.closest(".f-lookup_quick-panel")){if(i.lookupRef.inputGroup&&i.lookupRef.inputGroup.textbox.nativeElement===e.target)return!1;if(i.lookupRef.tagInput&&i.lookupRef.tagInput.textbox.nativeElement===e.target)return!1;i.cmpRef&&(i.cmpRef.destroy(),i.cmpRef=null),i.clearSearchValue(),i.hide(e)}}),this.panelElement.classList.add("f-area-show"),this.loadData()}},Pe.prototype.selectItem=function(t){var i=this;if(t){if("tag"===this.lookupRef.viewType){if(!this.lookupRef.selections.find(function(e){return e[i.lookupRef.idField]===t[i.lookupRef.idField]})){var e=D(this.lookupRef.selections,[t]);this.lookupRef.selectItem(e),this.lookupRef.lookupSelectionSer.loadSelections(e)}}else this.lookupRef.selectItem(t);this.hide()}},Pe.prototype.calculationPanelHeight=function(){return 30*this.options.showItemsCount+(this.options.showMore?50:0)+(this.options.footerHeight||0)+5},Pe.prototype.getInputSizeInfo=function(){return("text"===this.lookupRef.viewType?this.inputRef.inputGroup:this.lookupRef.tagbox).nativeElement.getBoundingClientRect()},Pe.prototype.getPanelSize=function(){var e=this.getInputSizeInfo(),t=e.width,i=e.height,n=e.top,s=e.left,a=window.innerHeight-i-n,o=this.calculationPanelHeight(),r=a<n?n:a;o<a?(n+=i,this.panelElement.style.transformOrigin="100% top"):a<n?(n=r<o?(o=r-10,10):n-parseInt(""+o,10)-5,this.panelElement.style.transformOrigin="100% bottom"):(r<o&&(o=r-10),n+=i);var l=this.options.minWidth||200,c=t<l?l:t;return window.innerWidth-s<c&&(s=s+t-c),{width:c,top:n,height:o,left:s}},Pe.prototype.getData=function(){var i=this,e={pageInfo:{pageSize:this.options.showItemsCount,pageIndex:1}},t="all";if(this.lookupRef.isTextChange?(this.lookupRef._searchState={field:this.lookupRef.textField,value:this.lookupRef.displayText},e.search=this.lookupRef._searchState,t="search"):this.lookupRef._searchState=null,"tag"===this.lookupRef.viewType){""!==this.lookupRef.tagInput.value?(this.lookupRef._searchState={field:this.lookupRef.textField,value:this.lookupRef.tagInput.value},e.search=this.lookupRef._searchState,t="search"):this.lookupRef._searchState=null;var n=this.lookupRef.selectionMgr.getSelectedIds();n&&n.length&&(e.selectedInfo={selected:!0,selectedIds:n})}return this.lookupRef.httpMgr.lookupRequest(e,t,!0).pipe(y.map(function(e){var t=i.lookupRef.items||[];return e?("tag"===i.lookupRef.viewType&&i.lookupRef.lookupSelectionSer.loadSelections(e.selectedData||[]),t=e.items||[],-1<e.displayType.toLowerCase().indexOf("treelist")&&t.length&&t[0].data&&(t=t.map(function(e){return e.data}))):i.lookupRef.displayText&&i.lookupRef.isTextChange&&(-1<e.displayType.toLowerCase().indexOf("treelist")&&t.length&&t[0].data&&(t=t.map(function(e){return e.data})),t=t.filter(function(e){return-1<e[i.lookupRef.textField].indexOf(i.lookupRef.displayText)}).slice(0,i.options.showItemsCount)),t.slice(0,i.options.showItemsCount)}))},Pe.prototype.loadData=function(){var i=this,n=this.lookupRef.loadingService.show({container:this.panelElement});this.getData().subscribe(function(e){if(n.close(),i.cmpRef&&i.cmpRef.instance){if(i.cmpRef.instance.loadData(e),e.length<i.options.showItemsCount){i.data=e;var t=i.cmpRef.instance.itemsContainer.nativeElement.querySelector("ul").offsetHeight+10;e&&e.length||(t=55),i.cmpRef.instance.itemsContainer.nativeElement.style.height=t+"px",i.panelElement&&(-1<i.panelElement.style.transformOrigin.indexOf("bottom")&&(i.panelElement.style.top=i.getInputSizeInfo().top-t-5+"px"),i.panelElement.style.height="auto")}else i.setPanelPosition(),i.cmpRef.instance.itemsContainer.nativeElement.style.height="100%",i.panelElement&&i.render.removeStyle(i.panelElement,"height");(i.lookupRef.isTextChange||i.lookupRef.tagInput&&""!==i.lookupRef.tagInput.value||i.lookupRef.inputGroup&&""!==i.lookupRef.inputGroup.value&&i.lookupRef.isTextChange)&&e&&e.length&&i.cmpRef.instance.setActiveItem(0),i.panelElement.style.overflow="auto"}})},Pe.prototype.registerKeyboardEvent=function(e){var t=this;if(this.lookupRef.singleSelect||"tag"===this.lookupRef.viewType){var i=[];if(this.cmpRef&&(i=this.cmpRef.instance.data),i&&i.length){if("ArrowUp"!==e.code&&"ArrowDown"!==e.code||(e.preventDefault(),e.stopPropagation()),"Backspace"===e.code&&"tag"===this.lookupRef.viewType&&this.lookupRef.selections&&this.lookupRef.selections.length&&this.lookupRef.tagInput&&!this.lookupRef.tagInput.value&&this.lookupRef.quickSelect.enableBackspace){e.preventDefault(),e.stopPropagation();var n=this.lookupRef.selections.slice(0,this.lookupRef.selections.length-1);return n&&n.length?this.lookupRef.selectItem(n):this.lookupRef.clearValue(!0),this.lookupRef.lookupSelectionSer.loadSelections(n),void this.setPanelPosition()}var s=this.cmpRef.instance.activeIndex,a=function(e){t.cmpRef.instance.setActiveItem(e)};if("ArrowUp"===e.code)if(-1<s){var o=s-1;o<0&&(o=i.length-1),a(o)}else a(i.length-1);if("ArrowDown"===e.code){var r=s+1;r>=i.length&&(r=0),a(r)}if("Enter"===e.key)if(i&&i.length&&this.panelElement){var l=i[s];this.selectItem(l)}else this.inputRef.inputClick.emit(e)}}},Pe.decorators=[{type:S.Directive,args:[{selector:"[quick-select]"}]}],Pe.ctorParameters=function(){return[{type:S.Injector},{type:S.NgZone},{type:S.Renderer2},{type:m.InputGroupComponent},{type:xe},{type:S.ComponentFactoryResolver}]},Pe.propDecorators={options:[{type:S.Input,args:["quick-select"]}],registerKeyboardEvent:[{type:S.HostListener,args:["keydown",["$event"]]}]},Pe);function Pe(e,t,i,n,s,a){this.injector=e,this.ngzone=t,this.render=i,this.inputRef=n,this.lookupRef=s,this.cfr=a,this.data=[]}var Ne=(_e.prototype.ngOnInit=function(){},_e.prototype.ngOnDestroy=function(){},_e.prototype.ngOnChanges=function(e){e.activeTab&&!e.activeTab.isFirstChange()&&this.setCurrentTab()},_e.prototype.ngAfterViewInit=function(){this.dialogRef&&(this.dialogRef.dragHandle=this.headerRel.nativeElement),this.setCurrentTab()},_e.prototype.setCurrentTab=function(){this.activetabRef&&this.render2.setStyle(this.activetabRef.nativeElement,"transform","translate3d("+("datalist"==this.activeTab?0:84)+"px, 0px, 0px)")},_e.prototype.changeTabs=function(e,t){this.activeTab=t,this.setCurrentTab(),this.tabChanged.emit({tab:t,$event:e})},_e.prototype.closeDialog=function(e){this.dialogRef&&(e.stopPropagation(),this.dialogRef.close())},_e.prototype.changeDialogSize=function(e){this.dialogRef&&(e.stopPropagation(),this.dialogRef.changeDialogSize())},_e.decorators=[{type:S.Component,args:[{selector:"lookup-advanced-layout",template:'<div class="d-flex justify-content-between header" #header [style.cursor]="dialogRef.isMax ? \'default\': \'move\'">\r\n    <div class="title" style="max-width: calc(50% - 100px);text-overflow: ellipsis;overflow: hidden;z-index: 3;cursor: default;" title="{{title}}">{{title}}</div>\r\n\r\n    <div style="width: 100%;" class="tabs">\r\n        <div class="d-flex justify-content-center">\r\n            <div class="d-flex tabs-labels" *ngIf="enableFav"  (mousedown)="$event.stopPropagation()">\r\n                <div class="active-tab" #activetab></div>\r\n                <div class="tab-title d-flex" [class.active]="activeTab === \'datalist\'" (click)="changeTabs($event, \'datalist\')" >\r\n                    {{dataTab }}\r\n                </div>\r\n                <div class="tab-title d-flex" [class.active]="activeTab === \'favorite\'" (click)="changeTabs($event, \'favorite\')">\r\n                    {{favTab}}\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n\r\n    <div class="close d-flex flex-row h-100">\r\n        <span class="f-icon modal_maximize" [class.modalrevert]="dialogRef.isMax" (click)="changeDialogSize($event)"></span>\r\n        <span class="f-icon modal_close" (click)="closeDialog($event)"></span>\r\n    </div>\r\n</div>',encapsulation:S.ViewEncapsulation.None}]}],_e.ctorParameters=function(){return[{type:S.ElementRef},{type:S.Injector},{type:S.NgZone},{type:S.Renderer2}]},_e.propDecorators={title:[{type:S.Input}],activeTab:[{type:S.Input}],enableFav:[{type:S.Input}],dataTab:[{type:S.Input}],favTab:[{type:S.Input}],tabChanged:[{type:S.Output}],close:[{type:S.Output}],headerRel:[{type:S.ViewChild,args:["header"]}],activetabRef:[{type:S.ViewChild,args:["activetab"]}]},_e);function _e(e,t,i,n){this.elRef=e,this.injector=t,this.zone=i,this.render2=n,this.title="帮助选择器",this.activeTab="datalist",this.dataTab="数据列表",this.favTab="收藏夹",this.tabChanged=new S.EventEmitter,this.close=new S.EventEmitter,this.dialogRef=this.injector.get(C.DialogComponent,null)}var ze=(Ve.prototype.ngOnInit=function(){var e=this;this.searchFields=this.searchFields||[],this.convertColumnsToSearchFields(),this.dialogRef&&this.searchboxRef&&this.dialogRef.moving.subscribe(function(){e.searchboxRef.updateShadowBoxPosition()})},Ve.prototype.ngOnChanges=function(e){var t=this;e.columns&&!e.columns.isFirstChange()&&(this.convertColumnsToSearchFields(),setTimeout(function(){t.initSearchValue()},100))},Ve.prototype.ngAfterViewInit=function(){},Ve.prototype.initSearchValue=function(){if(this.lookIns._searchState&&!this.isNav&&this.searchboxRef){var e=this.lookIns._searchState,t=e.field,i=e.value;if("*"===t&&""!=i&&null!==i&&i!==undefined){var n=[{code:"*",name:this.lookIns.localService.getValue("lookup.anyFields"),value:i}];this.searchboxRef.setValue(n,!1),this.textConditions=this.searchboxRef.expandStarFieldToAllFields()}}},Ve.prototype.converColumnToFilterField=function(e){var t={};t.id=e.field,t.labelCode=e.field,t.code=e.fieldPath,t.name=e.title;var i=e.formatter?e.formatter.options:null;if("NumericType"===e.fieldType){var n=x({},i||{});e.precision=e.precision||0,n.precision=n.precision||0,e.precision!=n.precision&&(n.precision=e.precision),t.control=Object.assign({controltype:"number",bigNumber:!1,placeHolder:"请输入数字",single:!0},n),t.beginPlaceHolder="开始数值",t.endPlaceHolder="结束数值"}if("EnumType"===e.fieldType&&(t.control={controltype:"enum",enumValues:e.formatter.options.data,single:!0}),"BooleanType"===e.fieldType){var s=i&&i.trueText||"True",a=i&&i.falseText||"False";t.control={controltype:"dropdown",enumValues:[{value:1,name:s},{value:0,name:a}],single:!0}}if("DateType"===e.fieldType||"DateTimeType"===e.fieldType){var o="yyyy-MM-dd",r=!1,l="1";i&&i.format&&(o=i.format),"DateTimeType"===e.fieldType&&(r=!0),"yyyy"===o&&(l="2"),"yyyy-MM"===o&&(l="3"),t.control={controltype:"datetime",placeholder:"请选择日期",single:!0,dateFormat:o,showTime:r,showType:l}}return t},Ve.prototype.convertColumnsToSearchFields=function(){var t=this;if(this.columns&&this.columns.length){if(this.fields=this.columns.filter(function(e){return e.fieldType&&("StringType"===e.fieldType||"TextType"===e.fieldType)}).map(function(e){return{code:e.fieldPath,name:e.title}}),!this.fields.length&&this.searchFields.length&&(this.fields=this.searchFields.map(function(e){return{code:e.value,name:e.label}})),"both"!==this.viewType&&"onlyfield"!==this.viewType||(this.filterFields=this.columns.filter(function(e){return e.fieldType&&"StringType"!==e.fieldType&&"TextType"!==e.fieldType&&e.field}).map(function(e){return t.converColumnToFilterField(e)})),this.lookIns&&this.lookIns.allowQueryFields){var e=this.lookIns.allowQueryFields,i=e.nav,n=e.main;if(this.isNav&&(n=i),n){var s=n.split(",");this.fields=this.fields.filter(function(t){return-1<s.findIndex(function(e){return e===t.code})}),this.filterFields=this.filterFields.filter(function(t){return-1<s.findIndex(function(e){return e===t.code})})}}this.cd.markForCheck()}},Ve.prototype.onConditionChange=function(e,t){void 0===t&&(t=!0),t?this.textConditions=e:this.fieldConditons=e,this.textConditions=this.textConditions||[];var i=this.fieldConditons.concat([]);this.fieldConditons&&this.fieldConditons.length&&this.textConditions.length&&(i[0].lbracket=this.fieldConditons[0].lbracket+"(",i[i.length-1].relation=1,i[i.length-1].rbracket=i[i.length-1].rbracket+")");var n=i.concat(this.textConditions);this.conditionsChange.emit(n)},Ve.prototype.onClearConditions=function(e){e.stopPropagation(),this.textConditions=[],this.fieldConditons=[],this.searchboxRef&&this.searchboxRef.clearConditions(!1),this.searchfieldsRef&&(this.filterFields.forEach(function(e){e.value=null}),this.searchfieldsRef.clearConditions(!1)),this.cd.detectChanges(),this.conditionsChange.emit([])},Ve.prototype.onEsc=function(e){this.lookIns.closeLoading(),this.lookIns.closeDialog()},Ve.decorators=[{type:S.Component,args:[{selector:"[lookup-filter-bar]",template:'\n    <div class="d-flex flex-row">\n        <farris-search-fields #searchfields [fields]="filterFields" class="mr-2 f-utils-fill"  \n        *ngIf="filterFields && filterFields.length && (viewType == \'both\' || viewType=== \'onlyfield\')" \n        (conditionChange)="onConditionChange($event, false)"></farris-search-fields>\n\n        <div style="min-width:40%;" class="d-flex flex-row" [class.w-100]="!filterFields || !filterFields.length" [style.maxWidth]="filterFields && filterFields.length?\'70%\': \'100%\'">\n            <farris-search-box #searchbox [fields]="fields" [useAnyField]="searchAnyField"\n            (conditionChange)="onConditionChange($event, true)" class="f-cmp-inputgroup f-utils-fill" \n            *ngIf="(viewType == \'both\' || viewType=== \'onlyinput\')" (escHandler)="onEsc($event)"></farris-search-box>\n            <span class="f-icon f-icon-remove clear-search-fields" \n                [ngStyle]="((textConditions && textConditions.length) || (fieldConditons && fieldConditons.length)) ? { }: {opacity: \'0.3\',pointerEvents: \'none\'}"\n                (click)="onClearConditions($event)" title="{{ \'lookup.clearAllConditions\' | locale }}" style="min-width:28px;border: 0;"></span>\n        </div>\n    </div>\n    '}]}],Ve.ctorParameters=function(){return[{type:S.Injector},{type:S.ChangeDetectorRef},{type:xe}]},Ve.propDecorators={searchAnyField:[{type:S.Input}],columns:[{type:S.Input}],viewType:[{type:S.Input}],isNav:[{type:S.Input}],searchFields:[{type:S.Input}],conditionsChange:[{type:S.Output}],searchboxRef:[{type:S.ViewChild,args:["searchbox"]}],searchfieldsRef:[{type:S.ViewChild,args:["searchfields"]}]},Ve);function Ve(e,t,i){this.injector=e,this.cd=t,this.lookIns=i,this.fields=[],this.filterFields=[],this.searchAnyField=!0,this.columns=[],this.viewType=z,this.isNav=!1,this.searchFields=[],this.conditionsChange=new S.EventEmitter,this.textConditions=[],this.fieldConditons=[],this.dialogRef=this.injector.get(C.DialogComponent,null),this.el=this.injector.get(S.ElementRef)}var Ae=(He.prototype.ngOnInit=function(){},He.prototype.ngAfterViewInit=function(){var t=this;setTimeout(function(){t.bindingEvents()}),this.panelMouseEvent=this.overlaySer.registerMouseEvent(this.elRef.nativeElement,function(e){t.selectedPanel.nativeElement.contains(e.target)||t.elRef.nativeElement.contains(e.target)||e.target.classList.contains("lookup-clear-selected-items")||e.target.closest(".farris-messager")||t.showPanel(!1)})},He.prototype.ngOnDestroy=function(){this.panelMouseEvent&&(this.panelMouseEvent(),this.panelMouseEvent=null)},He.prototype.showPanel=function(e){var t=this;void 0===e&&(e=!0);var i=this.selectedPanel.nativeElement;e?(this.render.addClass(i,"show"),this.render.removeClass(i,"d-none"),this.commonUtils&&(this.panelEscHandler=this.commonUtils.regBodyKeydownEvent(null,function(){return t.showPanel(!1)}))):(this.render.removeClass(i,"show"),this.render.addClass(i,"d-none"),this.panelEscHandler&&(this.panelEscHandler(),this.panelEscHandler=null))},He.prototype.bindingEvents=function(){var n=this;this.selectedPanel&&this.ngZone.runOutsideAngular(function(){var i=n.selectedPanel.nativeElement;n.render.listen(n.elRef.nativeElement,"click",function(){if(n.selectedPanel&&n.count)if(i.classList.contains("show"))n.showPanel(!1);else{n.showPanel();var e=i.querySelector(".farris-datatable-container"),t=i.querySelector(".farris-table-scorllable-body");n.render.removeStyle(e,"height"),n.render.removeStyle(t,"height"),n.dataTableRef.resize({height:i.offsetHeight-28,width:i.offsetWidth-28}),n.render.setStyle(t,"height",n.dataTableRef.tableHeight+"px"),n.render.setStyle(t,"height",n.dataTableRef.scorllableBodyHeight+"px"),n.dataTableRef.dtBody.checkBodyHeightWhenEmptyData()}else n.notifySer&&n.notifySer.warning("当前还没有选择数据。")})})},He.decorators=[{type:S.Directive,args:[{selector:"[lookup-selected]"}]}],He.ctorParameters=function(){return[{type:S.Injector},{type:S.ElementRef},{type:S.Renderer2},{type:S.NgZone}]},He.propDecorators={selectedPanel:[{type:S.Input}],dataTableRef:[{type:S.Input}],count:[{type:S.Input}]},He);function He(e,t,i,n){this.injector=e,this.elRef=t,this.render=i,this.ngZone=n,this.count=0,this.panelMouseEvent=null,this.notifySer=null,this.commonUtils=null,this.panelEscHandler=null,this.overlaySer=new k.OverLayHiddenService,this.notifySer=this.injector.get(I.NotifyService,null),this.commonUtils=this.injector.get(k.CommonUtils,new k.CommonUtils)}var je=(Be.decorators=[{type:S.NgModule,args:[{imports:[i.CommonModule,n.FormsModule,k.FarrisCommonModule.forRoot(),C.FarrisDialogModule.forRoot(),a.MessagerModule.forRoot(),I.NotifyModule.forRoot(),l.LoadingModule.forRoot({delay:1e3}),m.InputGroupModule,s.LayoutModule,o.DataTableModule,r.TreeTableModule,c.FarrisContextMenuModule,v.LocaleModule.forRoot(),b.SearchBoxModule,d.FarrisFormsModule],exports:[xe,A,Ne],declarations:[xe,A,ge,De,Re,Ee,Me,Ne,ze,Ae],providers:[],entryComponents:[o.DataTableComponent,r.TreeTableComponent,ge,De,Ee,Ne,ze]}]}],Be);function Be(){}e.LookupUtils=G,e.LookupDefaultMapping=$,e.LookupLeftComponent=ge,e.LookupAdvancedLayoutComponent=Ne,e.LookupFilterBarComponent=ze,e.LookupSelectedDirective=Ae,e.LOOKUPGRID_VALUE_ACCESSOR=Te,e.LookupGridComponent=xe,e.DisplayInfo=j,e.lookupGridDefaults=B,e.displayInfoDefault=q,e.LOOKUPINPUT_VALUE_ACCESSOR=V,e.LookupComponent=A,e.ServerSideToken=W,e.LookupModule=je,e.PersonalConfigService=Q,e.LookupTabsComponent=De,e.LookupTipDirective=Re,e.LookupQuickSelectDirective=Me,e.LookupQuickSelectPanelComponent=Ee,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=farris-ui-lookup.umd.min.js.map
/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { BaseModule } from './BaseModule';
import Quill from 'quill';
/** @type {?} */
const Parchment = Quill.imports.parchment;
/** @type {?} */
const FloatStyle = new Parchment.Attributor.Style('float', 'float');
/** @type {?} */
const MarginStyle = new Parchment.Attributor.Style('margin', 'margin');
/** @type {?} */
const DisplayStyle = new Parchment.Attributor.Style('display', 'display');
export class Toolbar extends BaseModule {
    constructor() {
        super(...arguments);
        this.onCreate = (/**
         * @return {?}
         */
        () => {
            // Setup Toolbar
            this.toolbar = document.createElement('div');
            Object.assign(this.toolbar.style, this.options.toolbarStyles);
            this.overlay.appendChild(this.toolbar);
            // Setup Buttons
            this._defineAlignments();
            this._addToolbarButtons();
        });
        // The toolbar and its children will be destroyed when the overlay is removed
        this.onDestroy = (/**
         * @return {?}
         */
        () => { });
        // Nothing to update on drag because we are are positioned relative to the overlay
        this.onUpdate = (/**
         * @return {?}
         */
        () => { });
        this._defineAlignments = (/**
         * @return {?}
         */
        () => {
            this.alignments = [
                {
                    icon: `<svg viewbox="0 0 18 18">
                <line class="ql-stroke" x1="3" x2="15" y1="9" y2="9"></line>
                <line class="ql-stroke" x1="3" x2="13" y1="14" y2="14"></line>
                <line class="ql-stroke" x1="3" x2="9" y1="4" y2="4"></line>
              </svg>`,
                    apply: (/**
                     * @return {?}
                     */
                    () => {
                        DisplayStyle.add(this.img, 'inline');
                        FloatStyle.add(this.img, 'left');
                        MarginStyle.add(this.img, '0 1em 1em 0');
                    }),
                    isApplied: (/**
                     * @return {?}
                     */
                    () => FloatStyle.value(this.img) == 'left')
                },
                {
                    icon: `<svg viewbox="0 0 18 18">
                <line class="ql-stroke" x1="15" x2="3" y1="9" y2="9"></line>
                <line class="ql-stroke" x1="14" x2="4" y1="14" y2="14"></line>
                <line class="ql-stroke" x1="12" x2="6" y1="4" y2="4"></line>
              </svg>`,
                    apply: (/**
                     * @return {?}
                     */
                    () => {
                        DisplayStyle.add(this.img, 'block');
                        FloatStyle.remove(this.img);
                        MarginStyle.add(this.img, 'auto');
                    }),
                    isApplied: (/**
                     * @return {?}
                     */
                    () => MarginStyle.value(this.img) == 'auto')
                },
                {
                    icon: `<svg viewbox="0 0 18 18">
                <line class="ql-stroke" x1="15" x2="3" y1="9" y2="9"></line>
                <line class="ql-stroke" x1="15" x2="5" y1="14" y2="14"></line>
                <line class="ql-stroke" x1="15" x2="9" y1="4" y2="4"></line>
              </svg>`,
                    apply: (/**
                     * @return {?}
                     */
                    () => {
                        DisplayStyle.add(this.img, 'inline');
                        FloatStyle.add(this.img, 'right');
                        MarginStyle.add(this.img, '0 0 1em 1em');
                    }),
                    isApplied: (/**
                     * @return {?}
                     */
                    () => FloatStyle.value(this.img) == 'right')
                }
            ];
        });
        this._addToolbarButtons = (/**
         * @return {?}
         */
        () => {
            /** @type {?} */
            const buttons = [];
            this.alignments.forEach((/**
             * @param {?} alignment
             * @param {?} idx
             * @return {?}
             */
            (alignment, idx) => {
                /** @type {?} */
                const button = document.createElement('span');
                buttons.push(button);
                button.innerHTML = alignment.icon;
                button.addEventListener('click', (/**
                 * @return {?}
                 */
                () => {
                    // deselect all buttons
                    buttons.forEach((/**
                     * @param {?} button
                     * @return {?}
                     */
                    button => (button.style.filter = '')));
                    if (alignment.isApplied()) {
                        // If applied, unapply
                        FloatStyle.remove(this.img);
                        MarginStyle.remove(this.img);
                        DisplayStyle.remove(this.img);
                    }
                    else {
                        // otherwise, select button and apply
                        this._selectButton(button);
                        alignment.apply();
                    }
                    // image may change position; redraw drag handles
                    this.requestUpdate();
                }));
                Object.assign(button.style, this.options.toolbarButtonStyles);
                if (idx > 0) {
                    button.style.borderLeftWidth = '0';
                }
                Object.assign(
                // tslint:disable-next-line:object-literal-key-quotes
                button.children[0]['style'], this.options.toolbarButtonSvgStyles);
                if (alignment.isApplied()) {
                    // select button if previously applied
                    this._selectButton(button);
                }
                this.toolbar.appendChild(button);
            }));
        });
        this._selectButton = (/**
         * @param {?} button
         * @return {?}
         */
        button => {
            button.style.filter = 'invert(20%)';
        });
    }
}
if (false) {
    /** @type {?} */
    Toolbar.prototype.toolbar;
    /** @type {?} */
    Toolbar.prototype.alignments;
    /** @type {?} */
    Toolbar.prototype.onCreate;
    /** @type {?} */
    Toolbar.prototype.onDestroy;
    /** @type {?} */
    Toolbar.prototype.onUpdate;
    /** @type {?} */
    Toolbar.prototype._defineAlignments;
    /** @type {?} */
    Toolbar.prototype._addToolbarButtons;
    /** @type {?} */
    Toolbar.prototype._selectButton;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVG9vbGJhci5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvdWktaHRtbC1lZGl0b3IvIiwic291cmNlcyI6WyJsaWIvaW1hZ2UtcmVzaXplLW1vZHVsZS9tb2R1bGVzL1Rvb2xiYXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxjQUFjLENBQUM7QUFDMUMsT0FBTyxLQUFLLE1BQU0sT0FBTyxDQUFDOztNQUNwQixTQUFTLEdBQUcsS0FBSyxDQUFDLE9BQU8sQ0FBQyxTQUFTOztNQUNuQyxVQUFVLEdBQUcsSUFBSSxTQUFTLENBQUMsVUFBVSxDQUFDLEtBQUssQ0FBQyxPQUFPLEVBQUUsT0FBTyxDQUFDOztNQUM3RCxXQUFXLEdBQUcsSUFBSSxTQUFTLENBQUMsVUFBVSxDQUFDLEtBQUssQ0FBQyxRQUFRLEVBQUUsUUFBUSxDQUFDOztNQUNoRSxZQUFZLEdBQUcsSUFBSSxTQUFTLENBQUMsVUFBVSxDQUFDLEtBQUssQ0FBQyxTQUFTLEVBQUUsU0FBUyxDQUFDO0FBRXpFLE1BQU0sT0FBTyxPQUFRLFNBQVEsVUFBVTtJQUF2Qzs7UUFHSSxhQUFROzs7UUFBRyxHQUFHLEVBQUU7WUFDWixnQkFBZ0I7WUFDaEIsSUFBSSxDQUFDLE9BQU8sR0FBRyxRQUFRLENBQUMsYUFBYSxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBQzdDLE1BQU0sQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxLQUFLLEVBQUUsSUFBSSxDQUFDLE9BQU8sQ0FBQyxhQUFhLENBQUMsQ0FBQztZQUM5RCxJQUFJLENBQUMsT0FBTyxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUM7WUFFdkMsZ0JBQWdCO1lBQ2hCLElBQUksQ0FBQyxpQkFBaUIsRUFBRSxDQUFDO1lBQ3pCLElBQUksQ0FBQyxrQkFBa0IsRUFBRSxDQUFDO1FBQzlCLENBQUMsRUFBQzs7UUFHRixjQUFTOzs7UUFBRyxHQUFHLEVB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Q0FxQ0U7O0lBRUYsZ0NBRUUiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBCYXNlTW9kdWxlIH0gZnJvbSAnLi9CYXNlTW9kdWxlJztcclxuaW1wb3J0IFF1aWxsIGZyb20gJ3F1aWxsJztcclxuY29uc3QgUGFyY2htZW50ID0gUXVpbGwuaW1wb3J0cy5wYXJjaG1lbnQ7XHJcbmNvbnN0IEZsb2F0U3R5bGUgPSBuZXcgUGFyY2htZW50LkF0dHJpYnV0b3IuU3R5bGUoJ2Zsb2F0JywgJ2Zsb2F0Jyk7XHJcbmNvbnN0IE1hcmdpblN0eWxlID0gbmV3IFBhcmNobWVudC5BdHRyaWJ1dG9yLlN0eWxlKCdtYXJnaW4nLCAnbWFyZ2luJyk7XHJcbmNvbnN0IERpc3BsYXlTdHlsZSA9IG5ldyBQYXJjaG1lbnQuQXR0cmlidXRvci5TdHlsZSgnZGlzcGxheScsICdkaXNwbGF5Jyk7XHJcblxyXG5leHBvcnQgY2xhc3MgVG9vbGJhciBleHRlbmRzIEJhc2VNb2R1bGUge1xyXG4gICAgdG9vbGJhcjtcclxuICAgIGFsaWdubWVudHM7XHJcbiAgICBvbkNyZWF0ZSA9ICgpID0+IHtcclxuICAgICAgICAvLyBTZXR1cCBUb29sYmFyXHJcbiAgICAgICAgdGhpcy50b29sYmFyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgICAgICAgT2JqZWN0LmFzc2lnbih0aGlzLnRvb2xiYXIuc3R5bGUsIHRoaXMub3B0aW9ucy50b29sYmFyU3R5bGVzKTtcclxuICAgICAgICB0aGlzLm92ZXJsYXkuYXBwZW5kQ2hpbGQodGhpcy50b29sYmFyKTtcclxuXHJcbiAgICAgICAgLy8gU2V0dXAgQnV0dG9uc1xyXG4gICAgICAgIHRoaXMuX2RlZmluZUFsaWdubWVudHMoKTtcclxuICAgICAgICB0aGlzLl9hZGRUb29sYmFyQnV0dG9ucygpO1xyXG4gICAgfTtcclxuXHJcbiAgICAvLyBUaGUgdG9vbGJhciBhbmQgaXRzIGNoaWxkcmVuIHdpbGwgYmUgZGVzdHJveWVkIHdoZW4gdGhlIG92ZXJsYXkgaXMgcmVtb3ZlZFxyXG4gICAgb25EZXN0cm95ID0gKCkgPT4ge307XHJcblxyXG4gICAgLy8gTm90aGluZyB0byB1cGRhdGUgb24gZHJhZyBiZWNhdXNlIHdlIGFyZSBhcmUgcG9zaXRpb25lZCByZWxhdGl2ZSB0byB0aGUgb3ZlcmxheVxyXG4gICAgb25VcGRhdGUgPSAoKSA9PiB7fTtcclxuXHJcbiAgICBfZGVmaW5lQWxpZ25tZW50cyA9ICgpID0+IHtcclxuICAgICAgICB0aGlzLmFsaWdubWVudHMgPSBbXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGljb246IGA8c3ZnIHZpZXdib3g9XCIwIDAgMTggMThcIj5cclxuICAgICAgICAgICAgICAgIDxsaW5lIGNsYXNzPVwicWwtc3Ryb2tlXCIgeDE9XCIzXCIgeDI9XCIxNVwiIHkxPVwiOVwiIHkyPVwiOVwiPjwvbGluZT5cclxuICAgICAgICAgICAgICAgIDxsaW5lIGNsYXNzPVwicWwtc3Ryb2tlXCIgeDE9XCIzXCIgeDI9XCIxM1wiIHkxPVwiMTRcIiB5Mj1cIjE0XCI+PC9saW5lPlxyXG4gICAgICAgICAgICAgICAgPGxpbmUgY2xhc3M9XCJxbC1zdHJva2VcIiB4MT1cIjNcIiB4Mj1cIjlcIiB5MT1cIjRcIiB5Mj1cIjRcIj48L2xpbmU+XHJcbiAgICAgICAgICAgICAgPC9zdmc+YCxcclxuICAgICAgICAgICAgICAgIGFwcGx5OiAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgRGlzcGxheVN0eWxlLmFkZCh0aGlzLmltZywgJ2lubGluZScpO1xyXG4gICAgICAgICAgICAgICAgICAgIEZsb2F0U3R5bGUuYWRkKHRoaXMuaW1nLCAnbGVmdCcpO1xyXG4gICAgICAgICAgICAgICAgICAgIE1hcmdpblN0eWxlLmFkZCh0aGlzLmltZywgJzAgMWVtIDFlbSAwJyk7XHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgaXNBcHBsaWVkOiAoKSA9PiBGbG9hdFN0eWxlLnZhbHVlKHRoaXMuaW1nKSA9PSAnbGVmdCdcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaWNvbjogYDxzdmcgdmlld2JveD1cIjAgMCAxOCAxOFwiPlxyXG4gICAgICAgICAgICAgICAgPGxpbmUgY2xhc3M9XCJxbC1zdHJva2VcIiB4MT1cIjE1XCIgeDI9XCIzXCIgeTE9XCI5XCIgeTI9XCI5XCI+PC9saW5lPlxyXG4gICAgICAgICAgICAgICAgPGxpbmUgY2xhc3M9XCJxbC1zdHJva2VcIiB4MT1cIjE0XCIgeDI9XCI0XCIgeTE9XCIxNFwiIHkyPVwiMTRcIj48L2xpbmU+XHJcbiAgICAgICAgICAgICAgICA8bGluZSBjbGFzcz1cInFsLXN0cm9rZVwiIHgxPVwiMTJcIiB4Mj1cIjZcIiB5MT1cIjRcIiB5Mj1cIjRcIj48L2xpbmU+XHJcbiAgICAgICAgICAgICAgPC9zdmc+YCxcclxuICAgICAgICAgICAgICAgIGFwcGx5OiAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgRGlzcGxheVN0eWxlLmFkZCh0aGlzLmltZywgJ2Jsb2NrJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgRmxvYXRTdHlsZS5yZW1vdmUodGhpcy5pbWcpO1xyXG4gICAgICAgICAgICAgICAgICAgIE1hcmdpblN0eWxlLmFkZCh0aGlzLmltZywgJ2F1dG8nKTtcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBpc0FwcGxpZWQ6ICgpID0+IE1hcmdpblN0eWxlLnZhbHVlKHRoaXMuaW1nKSA9PSAnYXV0bydcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaWNvbjogYDxzdmcgdmlld2JveD1cIjAgMCAxOCAxOFwiPlxyXG4gICAgICAgICAgICAgICAgPGxpbmUgY2xhc3M9XCJxbC1zdHJva2VcIiB4MT1cIjE1XCIgeDI9XCIzXCIgeTE9XCI5XCIgeTI9XCI5XCI+PC9saW5lPlxyXG4gICAgICAgICAgICAgICAgPGxpbmUgY2xhc3M9XCJxbC1zdHJva2VcIiB4MT1cIjE1XCIgeDI9XCI1XCIgeTE9XCIxNFwiIHkyPVwiMTRcIj48L2xpbmU+XHJcbiAgICAgICAgICAgICAgICA8bGluZSBjbGFzcz1cInFsLXN0cm9rZVwiIHgxPVwiMTVcIiB4Mj1cIjlcIiB5MT1cIjRcIiB5Mj1cIjRcIj48L2xpbmU+XHJcbiAgICAgICAgICAgICAgPC9zdmc+YCxcclxuICAgICAgICAgICAgICAgIGFwcGx5OiAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgRGlzcGxheVN0eWxlLmFkZCh0aGlzLmltZywgJ2lubGluZScpO1xyXG4gICAgICAgICAgICAgICAgICAgIEZsb2F0U3R5bGUuYWRkKHRoaXMuaW1nLCAncmlnaHQnKTtcclxuICAgICAgICAgICAgICAgICAgICBNYXJnaW5TdHlsZS5hZGQodGhpcy5pbWcsICcwIDAgMWVtIDFlbScpO1xyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIGlzQXBwbGllZDogKCkgPT4gRmxvYXRTdHlsZS52YWx1ZSh0aGlzLmltZykgPT0gJ3JpZ2h0J1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgXTtcclxuICAgIH07XHJcblxyXG4gICAgX2FkZFRvb2xiYXJCdXR0b25zID0gKCkgPT4ge1xyXG4gICAgICAgIGNvbnN0IGJ1dHRvbnMgPSBbXTtcclxuICAgICAgICB0aGlzLmFsaWdubWVudHMuZm9yRWFjaCgoYWxpZ25tZW50LCBpZHgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgYnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpO1xyXG4gICAgICAgICAgICBidXR0b25zLnB1c2goYnV0dG9uKTtcclxuICAgICAgICAgICAgYnV0dG9uLmlubmVySFRNTCA9IGFsaWdubWVudC5pY29uO1xyXG4gICAgICAgICAgICBidXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAvLyBkZXNlbGVjdCBhbGwgYnV0dG9uc1xyXG4gICAgICAgICAgICAgICAgYnV0dG9ucy5mb3JFYWNoKGJ1dHRvbiA9PiAoYnV0dG9uLnN0eWxlLmZpbHRlciA9ICcnKSk7XHJcbiAgICAgICAgICAgICAgICBpZiAoYWxpZ25tZW50LmlzQXBwbGllZCgpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gSWYgYXBwbGllZCwgdW5hcHBseVxyXG4gICAgICAgICAgICAgICAgICAgIEZsb2F0U3R5bGUucmVtb3ZlKHRoaXMuaW1nKTtcclxuICAgICAgICAgICAgICAgICAgICBNYXJnaW5TdHlsZS5yZW1vdmUodGhpcy5pbWcpO1xyXG4gICAgICAgICAgICAgICAgICAgIERpc3BsYXlTdHlsZS5yZW1vdmUodGhpcy5pbWcpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBvdGhlcndpc2UsIHNlbGVjdCBidXR0b24gYW5kIGFwcGx5XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fc2VsZWN0QnV0dG9uKGJ1dHRvbik7XHJcbiAgICAgICAgICAgICAgICAgICAgYWxpZ25tZW50LmFwcGx5KCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAvLyBpbWFnZSBtYXkgY2hhbmdlIHBvc2l0aW9uOyByZWRyYXcgZHJhZyBoYW5kbGVzXHJcbiAgICAgICAgICAgICAgICB0aGlzLnJlcXVlc3RVcGRhdGUoKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIE9iamVjdC5hc3NpZ24oYnV0dG9uLnN0eWxlLCB0aGlzLm9wdGlvbnMudG9vbGJhckJ1dHRvblN0eWxlcyk7XHJcbiAgICAgICAgICAgIGlmIChpZHggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICBidXR0b24uc3R5bGUuYm9yZGVyTGVmdFdpZHRoID0gJzAnO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIE9iamVjdC5hc3NpZ24oXHJcbiAgICAgICAgICAgICAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6b2JqZWN0LWxpdGVyYWwta2V5LXF1b3Rlc1xyXG4gICAgICAgICAgICAgICAgYnV0dG9uLmNoaWxkcmVuWzBdWydzdHlsZSddLFxyXG4gICAgICAgICAgICAgICAgdGhpcy5vcHRpb25zLnRvb2xiYXJCdXR0b25TdmdTdHlsZXNcclxuICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgaWYgKGFsaWdubWVudC5pc0FwcGxpZWQoKSkge1xyXG4gICAgICAgICAgICAgICAgLy8gc2VsZWN0IGJ1dHRvbiBpZiBwcmV2aW91c2x5IGFwcGxpZWRcclxuICAgICAgICAgICAgICAgIHRoaXMuX3NlbGVjdEJ1dHRvbihidXR0b24pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMudG9vbGJhci5hcHBlbmRDaGlsZChidXR0b24pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuXHJcbiAgICBfc2VsZWN0QnV0dG9uID0gYnV0dG9uID0+IHtcclxuICAgICAgICBidXR0b24uc3R5bGUuZmlsdGVyID0gJ2ludmVydCgyMCUpJztcclxuICAgIH07XHJcbn1cclxuIl19
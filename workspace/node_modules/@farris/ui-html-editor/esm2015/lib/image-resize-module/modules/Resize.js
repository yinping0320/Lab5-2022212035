/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { BaseModule } from './BaseModule';
export class Resize extends BaseModule {
    constructor() {
        super(...arguments);
        this.onCreate = (/**
         * @return {?}
         */
        () => {
            // track resize handles
            this.boxes = [];
            // add 4 resize handles
            this.addBox('nwse-resize'); // top left
            this.addBox('nesw-resize'); // top right
            this.addBox('nwse-resize'); // bottom right
            this.addBox('nesw-resize'); // bottom left
            this.positionBoxes();
        });
        this.onDestroy = (/**
         * @return {?}
         */
        () => {
            // reset drag handle cursors
            this.setCursor('');
        });
        this.positionBoxes = (/**
         * @return {?}
         */
        () => {
            /** @type {?} */
            const handleXOffset = `${-parseFloat(this.options.handleStyles.width) /
                2}px`;
            /** @type {?} */
            const handleYOffset = `${-parseFloat(this.options.handleStyles.height) /
                2}px`;
            // set the top and left for each drag handle
            [
                { left: handleXOffset, top: handleYOffset },
                { right: handleXOffset, top: handleYOffset },
                { right: handleXOffset, bottom: handleYOffset },
                { left: handleXOffset, bottom: handleYOffset } // bottom left
            ].forEach((/**
             * @param {?} pos
             * @param {?} idx
             * @return {?}
             */
            (pos, idx) => {
                Object.assign(this.boxes[idx].style, pos);
            }));
        });
        this.addBox = (/**
         * @param {?} cursor
         * @return {?}
         */
        cursor => {
            // create div element for resize handle
            /** @type {?} */
            const box = document.createElement('div');
            // Star with the specified styles
            Object.assign(box.style, this.options.handleStyles);
            box.style.cursor = cursor;
            // Set the width/height to use 'px'
            box.style.width = `${this.options.handleStyles.width}px`;
            box.style.height = `${this.options.handleStyles.height}px`;
            // listen for mousedown on each box
            box.addEventListener('mousedown', this.handleMousedown, false);
            // add drag handle to document
            this.overlay.appendChild(box);
            // keep track of drag handle
            this.boxes.push(box);
        });
        this.handleMousedown = (/**
         * @param {?} evt
         * @return {?}
         */
        evt => {
            // note which box
            this.dragBox = evt.target;
            // note starting mousedown position
            this.dragStartX = evt.clientX;
            // store the width before the drag
            this.preDragWidth = this.img.width || this.img.naturalWidth;
            // set the proper cursor everywhere
            this.setCursor(this.dragBox.style.cursor);
            // listen for movement and mouseup
            document.addEventListener('mousemove', this.handleDrag, false);
            document.addEventListener('mouseup', this.handleMouseup, false);
        });
        this.handleMouseup = (/**
         * @return {?}
         */
        () => {
            // reset cursor everywhere
            this.setCursor('');
            // stop listening for movement and mouseup
            document.removeEventListener('mousemove', this.handleDrag);
            document.removeEventListener('mouseup', this.handleMouseup);
        });
        this.handleDrag = (/**
         * @param {?} evt
         * @return {?}
         */
        evt => {
            if (!this.img) {
                // image not set yet
                return;
            }
            // update image size
            /** @type {?} */
            const deltaX = evt.clientX - this.dragStartX;
            if (this.dragBox === this.boxes[0] || this.dragBox === this.boxes[3]) {
                // left-side resize handler; dragging right shrinks image
                this.img.width = Math.round(this.preDragWidth - deltaX);
            }
            else {
                // right-side resize handler; dragging right enlarges image
                this.img.width = Math.round(this.preDragWidth + deltaX);
            }
            this.requestUpdate();
        });
        this.setCursor = (/**
         * @param {?} value
         * @return {?}
         */
        value => {
            [document.body, this.img].forEach((/**
             * @param {?} el
             * @return {?}
             */
            el => {
                el.style.cursor = value; // eslint-disable-line no-param-reassign
            }));
        });
    }
}
if (false) {
    /** @type {?} */
    Resize.prototype.boxes;
    /** @type {?} */
    Resize.prototype.dragBox;
    /** @type {?} */
    Resize.prototype.dragStartX;
    /** @type {?} */
    Resize.prototype.preDragWidth;
    /** @type {?} */
    Resize.prototype.onCreate;
    /** @type {?} */
    Resize.prototype.onDestroy;
    /** @type {?} */
    Resize.prototype.positionBoxes;
    /** @type {?} */
    Resize.prototype.addBox;
    /** @type {?} */
    Resize.prototype.handleMousedown;
    /** @type {?} */
    Resize.prototype.handleMouseup;
    /** @type {?} */
    Resize.prototype.handleDrag;
    /** @type {?} */
    Resize.prototype.setCursor;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiUmVzaXplLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy91aS1odG1sLWVkaXRvci8iLCJzb3VyY2VzIjpbImxpYi9pbWFnZS1yZXNpemUtbW9kdWxlL21vZHVsZXMvUmVzaXplLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sY0FBYyxDQUFDO0FBRTFDLE1BQU0sT0FBTyxNQUFPLFNBQVEsVUFBVTtJQUF0Qzs7UUFLSSxhQUFROzs7UUFBRyxHQUFHLEVBQUU7WUFDWix1QkFBdUI7WUFDdkIsSUFBSSxDQUFDLEtBQUssR0FBRyxFQUFFLENBQUM7WUFFaEIsdUJBQXVCO1lBQ3ZCLElBQUksQ0FBQyxNQUFNLENBQUMsYUFBYSxDQUFDLENBQUMsQ0FBQyxXQUFXO1lBQ3ZDLElBQUksQ0FBQyxNQUFNLENBQUMsYUFBYSxDQUFDLENBQUMsQ0FBQyxZQUFZO1lBQ3hDLElBQUksQ0FBQyxNQUFNLENBQUMsYUFBYSxDQUFDLENBQUMsQ0FBQyxlQUFlO1lBQzNDLElBQUksQ0FBQyxNQUFNLENBQUMsYUFBYSxDQUFDLENBQUMsQ0FBQyxjQUFjO1lBRTFDLElBQUksQ0FBQyxhQUFhLEVBQUUsQ0FBQztRQUN6QixDQUFDLEVBQUM7UUFFRixjQUFTOzs7UUFBRyxHQUFHLEVBQUU7WUFDYiw0QkFBNEI7WUFDNUIsSUFBSSxDQUFDLFNBQVMsQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUN2QixDQUFDLEVBQUM7UUFFRixrQkFBYTs7O1FBQUcsR0FBRyxFQUFFOztrQkFDWCxhQUFhLEdBQUcsR0FBRyxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLFlBQVksQ0FBQyxLQUFLLENBQUM7Z0JBQ2pFLENBQUMsSUFBSTs7a0JBQ0gsYUFBYSxHQUFHLEdBQUcsQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxZQUFZLENBQUMsTUFBTSxDQUFDO2dCQUM5RCxDQUFDLElBQUk7WUFFVCw0Q0FBNEM7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QkFJRSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEJhc2VNb2R1bGUgfSBmcm9tICcuL0Jhc2VNb2R1bGUnO1xyXG5cclxuZXhwb3J0IGNsYXNzIFJlc2l6ZSBleHRlbmRzIEJhc2VNb2R1bGUge1xyXG4gICAgYm94ZXM7XHJcbiAgICBkcmFnQm94O1xyXG4gICAgZHJhZ1N0YXJ0WDtcclxuICAgIHByZURyYWdXaWR0aDtcclxuICAgIG9uQ3JlYXRlID0gKCkgPT4ge1xyXG4gICAgICAgIC8vIHRyYWNrIHJlc2l6ZSBoYW5kbGVzXHJcbiAgICAgICAgdGhpcy5ib3hlcyA9IFtdO1xyXG5cclxuICAgICAgICAvLyBhZGQgNCByZXNpemUgaGFuZGxlc1xyXG4gICAgICAgIHRoaXMuYWRkQm94KCdud3NlLXJlc2l6ZScpOyAvLyB0b3AgbGVmdFxyXG4gICAgICAgIHRoaXMuYWRkQm94KCduZXN3LXJlc2l6ZScpOyAvLyB0b3AgcmlnaHRcclxuICAgICAgICB0aGlzLmFkZEJveCgnbndzZS1yZXNpemUnKTsgLy8gYm90dG9tIHJpZ2h0XHJcbiAgICAgICAgdGhpcy5hZGRCb3goJ25lc3ctcmVzaXplJyk7IC8vIGJvdHRvbSBsZWZ0XHJcblxyXG4gICAgICAgIHRoaXMucG9zaXRpb25Cb3hlcygpO1xyXG4gICAgfTtcclxuXHJcbiAgICBvbkRlc3Ryb3kgPSAoKSA9PiB7XHJcbiAgICAgICAgLy8gcmVzZXQgZHJhZyBoYW5kbGUgY3Vyc29yc1xyXG4gICAgICAgIHRoaXMuc2V0Q3Vyc29yKCcnKTtcclxuICAgIH07XHJcblxyXG4gICAgcG9zaXRpb25Cb3hlcyA9ICgpID0+IHtcclxuICAgICAgICBjb25zdCBoYW5kbGVYT2Zmc2V0ID0gYCR7LXBhcnNlRmxvYXQodGhpcy5vcHRpb25zLmhhbmRsZVN0eWxlcy53aWR0aCkgL1xyXG4gICAgICAgICAgICAyfXB4YDtcclxuICAgICAgICBjb25zdCBoYW5kbGVZT2Zmc2V0ID0gYCR7LXBhcnNlRmxvYXQodGhpcy5vcHRpb25zLmhhbmRsZVN0eWxlcy5oZWlnaHQpIC9cclxuICAgICAgICAgICAgICAgIDJ9cHhgO1xyXG5cclxuICAgICAgICAgICAgLy8gc2V0IHRoZSB0b3AgYW5kIGxlZnQgZm9yIGVhY2ggZHJhZyBoYW5kbGVcclxuICAgICAgICBbXHJcbiAgICAgICAgICAgIHsgbGVmdDogaGFuZGxlWE9mZnNldCwgdG9wOiBoYW5kbGVZT2Zmc2V0IH0sIC8vIHRvcCBsZWZ0XHJcbiAgICAgICAgICAgIHsgcmlnaHQ6IGhhbmRsZVhPZmZzZXQsIHRvcDogaGFuZGxlWU9mZnNldCB9LCAvLyB0b3AgcmlnaHRcclxuICAgICAgICAgICAgeyByaWdodDogaGFuZGxlWE9mZnNldCwgYm90dG9tOiBoYW5kbGVZT2Zmc2V0IH0sIC8vIGJvdHRvbSByaWdodFxyXG4gICAgICAgICAgICB7IGxlZnQ6IGhhbmRsZVhPZmZzZXQsIGJvdHRvbTogaGFuZGxlWU9mZnNldCB9IC8vIGJvdHRvbSBsZWZ0XHJcbiAgICAgICAgXS5mb3JFYWNoKChwb3MsIGlkeCkgPT4ge1xyXG4gICAgICAgICAgICBPYmplY3QuYXNzaWduKHRoaXMuYm94ZXNbaWR4XS5zdHlsZSwgcG9zKTtcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcblxyXG4gICAgYWRkQm94ID0gY3Vyc29yID0+IHtcclxuICAgICAgICAvLyBjcmVhdGUgZGl2IGVsZW1lbnQgZm9yIHJlc2l6ZSBoYW5kbGVcclxuICAgICAgICBjb25zdCBib3ggPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuXHJcbiAgICAgICAgLy8gU3RhciB3aXRoIHRoZSBzcGVjaWZpZWQgc3R5bGVzXHJcbiAgICAgICAgT2JqZWN0LmFzc2lnbihib3guc3R5bGUsIHRoaXMub3B0aW9ucy5oYW5kbGVTdHlsZXMpO1xyXG4gICAgICAgIGJveC5zdHlsZS5jdXJzb3IgPSBjdXJzb3I7XHJcblxyXG4gICAgICAgIC8vIFNldCB0aGUgd2lkdGgvaGVpZ2h0IHRvIHVzZSAncHgnXHJcbiAgICAgICAgYm94LnN0eWxlLndpZHRoID0gYCR7dGhpcy5vcHRpb25zLmhhbmRsZVN0eWxlcy53aWR0aH1weGA7XHJcbiAgICAgICAgYm94LnN0eWxlLmhlaWdodCA9IGAke3RoaXMub3B0aW9ucy5oYW5kbGVTdHlsZXMuaGVpZ2h0fXB4YDtcclxuXHJcbiAgICAgICAgLy8gbGlzdGVuIGZvciBtb3VzZWRvd24gb24gZWFjaCBib3hcclxuICAgICAgICBib3guYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vkb3duJywgdGhpcy5oYW5kbGVNb3VzZWRvd24sIGZhbHNlKTtcclxuICAgICAgICAvLyBhZGQgZHJhZyBoYW5kbGUgdG8gZG9jdW1lbnRcclxuICAgICAgICB0aGlzLm92ZXJsYXkuYXBwZW5kQ2hpbGQoYm94KTtcclxuICAgICAgICAvLyBrZWVwIHRyYWNrIG9mIGRyYWcgaGFuZGxlXHJcbiAgICAgICAgdGhpcy5ib3hlcy5wdXNoKGJveCk7XHJcbiAgICB9O1xyXG5cclxuICAgIGhhbmRsZU1vdXNlZG93biA9IGV2dCA9PiB7XHJcbiAgICAgICAgLy8gbm90ZSB3aGljaCBib3hcclxuICAgICAgICB0aGlzLmRyYWdCb3ggPSBldnQudGFyZ2V0O1xyXG4gICAgICAgIC8vIG5vdGUgc3RhcnRpbmcgbW91c2Vkb3duIHBvc2l0aW9uXHJcbiAgICAgICAgdGhpcy5kcmFnU3RhcnRYID0gZXZ0LmNsaWVudFg7XHJcbiAgICAgICAgLy8gc3RvcmUgdGhlIHdpZHRoIGJlZm9yZSB0aGUgZHJhZ1xyXG4gICAgICAgIHRoaXMucHJlRHJhZ1dpZHRoID0gdGhpcy5pbWcud2lkdGggfHwgdGhpcy5pbWcubmF0dXJhbFdpZHRoO1xyXG4gICAgICAgIC8vIHNldCB0aGUgcHJvcGVyIGN1cnNvciBldmVyeXdoZXJlXHJcbiAgICAgICAgdGhpcy5zZXRDdXJzb3IodGhpcy5kcmFnQm94LnN0eWxlLmN1cnNvcik7XHJcbiAgICAgICAgLy8gbGlzdGVuIGZvciBtb3ZlbWVudCBhbmQgbW91c2V1cFxyXG4gICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlbW92ZScsIHRoaXMuaGFuZGxlRHJhZywgZmFsc2UpO1xyXG4gICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNldXAnLCB0aGlzLmhhbmRsZU1vdXNldXAsIGZhbHNlKTtcclxuICAgIH07XHJcblxyXG4gICAgaGFuZGxlTW91c2V1cCA9ICgpID0+IHtcclxuICAgICAgICAvLyByZXNldCBjdXJzb3IgZXZlcnl3aGVyZVxyXG4gICAgICAgIHRoaXMuc2V0Q3Vyc29yKCcnKTtcclxuICAgICAgICAvLyBzdG9wIGxpc3RlbmluZyBmb3IgbW92ZW1lbnQgYW5kIG1vdXNldXBcclxuICAgICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdtb3VzZW1vdmUnLCB0aGlzLmhhbmRsZURyYWcpO1xyXG4gICAgICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ21vdXNldXAnLCB0aGlzLmhhbmRsZU1vdXNldXApO1xyXG4gICAgfTtcclxuXHJcbiAgICBoYW5kbGVEcmFnID0gZXZ0ID0+IHtcclxuICAgICAgICBpZiAoIXRoaXMuaW1nKSB7XHJcbiAgICAgICAgICAgIC8vIGltYWdlIG5vdCBzZXQgeWV0XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gdXBkYXRlIGltYWdlIHNpemVcclxuICAgICAgICBjb25zdCBkZWx0YVggPSBldnQuY2xpZW50WCAtIHRoaXMuZHJhZ1N0YXJ0WDtcclxuICAgICAgICBpZiAodGhpcy5kcmFnQm94ID09PSB0aGlzLmJveGVzWzBdIHx8IHRoaXMuZHJhZ0JveCA9PT0gdGhpcy5ib3hlc1szXSkge1xyXG4gICAgICAgICAgICAvLyBsZWZ0LXNpZGUgcmVzaXplIGhhbmRsZXI7IGRyYWdnaW5nIHJpZ2h0IHNocmlua3MgaW1hZ2VcclxuICAgICAgICAgICAgdGhpcy5pbWcud2lkdGggPSBNYXRoLnJvdW5kKHRoaXMucHJlRHJhZ1dpZHRoIC0gZGVsdGFYKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAvLyByaWdodC1zaWRlIHJlc2l6ZSBoYW5kbGVyOyBkcmFnZ2luZyByaWdodCBlbmxhcmdlcyBpbWFnZVxyXG4gICAgICAgICAgICB0aGlzLmltZy53aWR0aCA9IE1hdGgucm91bmQodGhpcy5wcmVEcmFnV2lkdGggKyBkZWx0YVgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLnJlcXVlc3RVcGRhdGUoKTtcclxuICAgIH07XHJcblxyXG4gICAgc2V0Q3Vyc29yID0gdmFsdWUgPT4ge1xyXG4gICAgICAgIFtkb2N1bWVudC5ib2R5LCB0aGlzLmltZ10uZm9yRWFjaChlbCA9PiB7XHJcbiAgICAgICAgICAgIGVsLnN0eWxlLmN1cnNvciA9IHZhbHVlOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLXBhcmFtLXJlYXNzaWduXHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG59XHJcbiJdfQ==
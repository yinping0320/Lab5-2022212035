/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { tooltips } from './tooltip-list';
import { getScrollParent } from './utils/scrollInfo';
/** @type {?} */
var tooltipStyles = {
    minWidth: '70px',
    position: 'absolute',
    padding: '4px 8px',
    textAlign: 'center',
    backgroundColor: 'rgba(0,0,0,0.7)',
    color: '#fff',
    cursor: 'default',
    borderRadius: '4px',
    fontSize: '12px',
    top: '-9999px',
    visibility: 'hidden',
    'z-index': '9999'
};
var Tooltip = /** @class */ (function () {
    function Tooltip(quill, ngZone) {
        var e_1, _a, e_2, _b;
        this.ngZone = ngZone;
        this.quill = quill;
        this.toolbar = quill.getModule('toolbar');
        this.buttons = null;
        this.selectors = null;
        this.tip = null;
        this.timeout = null;
        this.mouseenterHandler = null;
        this.mouseleaveHandler = null;
        /** @type {?} */
        var toolbarElement = this.toolbar.container;
        if (toolbarElement) {
            // 添加处理事件
            this.buttons = toolbarElement.querySelectorAll('button');
            this.selectors = toolbarElement.querySelectorAll('.ql-picker');
            try {
                for (var _c = tslib_1.__values(this.buttons), _d = _c.next(); !_d.done; _d = _c.next()) {
                    var el = _d.value;
                    this.addHandler(el);
                }
            }
            catch (e_1_1) { e_1 = { error: e_1_1 }; }
            finally {
                try {
                    if (_d && !_d.done && (_a = _c.return)) _a.call(_c);
                }
                finally { if (e_1) throw e_1.error; }
            }
            try {
                for (var _e = tslib_1.__values(this.selectors), _f = _e.next(); !_f.done; _f = _e.next()) {
                    var el = _f.value;
                    this.addHandler(el);
                }
            }
            catch (e_2_1) { e_2 = { error: e_2_1 }; }
            finally {
                try {
                    if (_f && !_f.done && (_b = _e.return)) _b.call(_e);
                }
                finally { if (e_2) throw e_2.error; }
            }
            // 创建tooltip
            this.createTooltip();
            // 滚动元素增加handler
            this.scrollElm = getScrollParent(toolbarElement);
            this.scrollElm.addEventListener('scroll', this.mouseleaveHandler);
        }
    }
    /**
     * @return {?}
     */
    Tooltip.prototype.createTooltip = /**
     * @return {?}
     */
    function () {
        this.tip = document.createElement('div');
        this.tip.classList.add('quill-tooltip');
        Object.assign(this.tip.style, tooltipStyles);
        document.body.appendChild(this.tip);
    };
    /**
     * @param {?} el
     * @return {?}
     */
    Tooltip.prototype.addHandler = /**
     * @param {?} el
     * @return {?}
     */
    function (el) {
        var _this = this;
        this.mouseenterHandler = (/**
         * @return {?}
         */
        function () {
            // this.ngZone.runOutsideAngular(() => {
            //     this.timeout = setTimeout(() => {
            //         this.showTooltip(el);
            //     }, 100);
            // });
            _this.timeout = setTimeout((/**
             * @return {?}
             */
            function () {
                _this.showTooltip(el);
            }), 100);
        });
        this.mouseleaveHandler = (/**
         * @return {?}
         */
        function () {
            if (_this.timeout) {
                // this.ngZone.runOutsideAngular(() => {
                //     clearTimeout(this.timeout);
                // });
                clearTimeout(_this.timeout);
            }
            _this.hideTooltip();
        });
        // if (this.ngZone && this.ngZone.runOutsideAngular) {
        //     this.ngZone.runOutsideAngular(() => {
        //         el.addEventListener('mouseenter', this.mouseenterHandler);
        //         el.addEventListener('mouseleave', this.mouseleaveHandler);
        //     });
        // }
        el.addEventListener('mouseenter', this.mouseenterHandler);
        el.addEventListener('mouseleave', this.mouseleaveHandler);
    };
    /**
     * @param {?} el
     * @return {?}
     */
    Tooltip.prototype.showTooltip = /**
     * @param {?} el
     * @return {?}
     */
    function (el) {
        // let format = el.className.replace('ql-', '')
        // let format = el.className.replace('ql-', '')
        /** @type {?} */
        var LOCALE_ID = this.quill.options.localeId || 'zh-CHS';
        /** @type {?} */
        var format = [].find
            .call(el.classList, (/**
         * @param {?} className
         * @return {?}
         */
        function (className) {
            return className.indexOf('ql-') === 0;
        }))
            .replace('ql-', '');
        /** @type {?} */
        var tool = tooltips[LOCALE_ID][format];
        if (tool) {
            if (typeof tool === 'string') {
                this.tip.textContent = tool;
            }
            else {
                /** @type {?} */
                var value = el.value || '';
                if (value != null && tool[value]) {
                    this.tip.textContent = tool[value];
                }
            }
            /** @type {?} */
            var elRect = el.getBoundingClientRect();
            /** @type {?} */
            var tipRect = this.tip.getBoundingClientRect();
            /** @type {?} */
            var body = document.documentElement || document.body;
            /** @type {?} */
            var bodyRect = {
                width: body.scrollWidth,
                height: body.scrollHeight,
                scrollTop: body.scrollTop,
                scrollLeft: body.scrollLeft
            };
            /** @type {?} */
            var offset = 3;
            Object.assign(this.tip.style, {
                top: elRect.top - elRect.height - offset + bodyRect.scrollTop + 'px',
                left: elRect.left - (tipRect.width - elRect.width) / 2 + bodyRect.scrollLeft + 'px',
                visibility: 'visible'
            });
        }
    };
    /**
     * @return {?}
     */
    Tooltip.prototype.hideTooltip = /**
     * @return {?}
     */
    function () {
        Object.assign(this.tip.style, {
            top: '-9999px',
            visibility: 'hidden'
        });
    };
    /**
     * @return {?}
     */
    Tooltip.prototype.onDestroy = /**
     * @return {?}
     */
    function () {
        var e_3, _a, e_4, _b;
        // console.warn('ondestroy');
        this.destroyTooltip();
        if (this.buttons) {
            try {
                for (var _c = tslib_1.__values(this.buttons), _d = _c.next(); !_d.done; _d = _c.next()) {
                    var el = _d.value;
                    this.removeHandler(el);
                }
            }
            catch (e_3_1) { e_3 = { error: e_3_1 }; }
            finally {
                try {
                    if (_d && !_d.done && (_a = _c.return)) _a.call(_c);
                }
                finally { if (e_3) throw e_3.error; }
            }
        }
        if (this.selectors) {
            try {
                for (var _e = tslib_1.__values(this.selectors), _f = _e.next(); !_f.done; _f = _e.next()) {
                    var el = _f.value;
                    this.removeHandler(el);
                }
            }
            catch (e_4_1) { e_4 = { error: e_4_1 }; }
            finally {
                try {
                    if (_f && !_f.done && (_b = _e.return)) _b.call(_e);
                }
                finally { if (e_4) throw e_4.error; }
            }
        }
        if (this.scrollElm) {
            this.scrollElm.removeEventListener('scroll', this.mouseleaveHandler);
        }
    };
    /**
     * @return {?}
     */
    Tooltip.prototype.destroyTooltip = /**
     * @return {?}
     */
    function () {
        if (this.tip.parentNode) {
            this.tip.parentNode.removeChild(this.tip);
        }
    };
    /**
     * @param {?} el
     * @return {?}
     */
    Tooltip.prototype.removeHandler = /**
     * @param {?} el
     * @return {?}
     */
    function (el) {
        el.removeEventListener('mouseenter', this.mouseenterHandler);
        el.removeEventListener('mouseleave', this.mouseleaveHandler);
    };
    return Tooltip;
}());
export { Tooltip };
if (false) {
    /** @type {?} */
    Tooltip.prototype.quill;
    /** @type {?} */
    Tooltip.prototype.toolbar;
    /** @type {?} */
    Tooltip.prototype.buttons;
    /** @type {?} */
    Tooltip.prototype.tip;
    /** @type {?} */
    Tooltip.prototype.selectors;
    /** @type {?} */
    Tooltip.prototype.mouseenterHandler;
    /** @type {?} */
    Tooltip.prototype.mouseleaveHandler;
    /** @type {?} */
    Tooltip.prototype.timeout;
    /** @type {?} */
    Tooltip.prototype.scrollElm;
    /**
     * @type {?}
     * @private
     */
    Tooltip.prototype.ngZone;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL3VpLWh0bWwtZWRpdG9yLyIsInNvdXJjZXMiOlsibGliL3Rvb2wtdGlwLW1vZHVsZS9pbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUNBLE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUMxQyxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sb0JBQW9CLENBQUM7O0lBQy9DLGFBQWEsR0FBRztJQUNsQixRQUFRLEVBQUUsTUFBTTtJQUNoQixRQUFRLEVBQUUsVUFBVTtJQUNwQixPQUFPLEVBQUUsU0FBUztJQUNsQixTQUFTLEVBQUUsUUFBUTtJQUNuQixlQUFlLEVBQUUsaUJBQWlCO0lBQ2xDLEtBQUssRUFBRSxNQUFNO0lBQ2IsTUFBTSxFQUFFLFNBQVM7SUFDakIsWUFBWSxFQUFFLEtBQUs7SUFDbkIsUUFBUSxFQUFFLE1BQU07SUFDaEIsR0FBRyxFQUFFLFNBQVM7SUFDZCxVQUFVLEVBQUUsUUFBUTtJQUNwQixTQUFTLEVBQUUsTUFBTTtDQUNwQjtBQUNEO0lBVUksaUJBQVksS0FBSyxFQUFVLE1BQWM7O1FBQWQsV0FBTSxHQUFOLE1BQU0sQ0FBUTtRQUNyQyxJQUFJLENBQUMsS0FBSyxHQUFHLEtBQUssQ0FBQztRQUNuQixJQUFJLENBQUMsT0FBTyxHQUFHLEtBQUssQ0FBQyxTQUFTLENBQUMsU0FBUyxDQUFDLENBQUM7UUFDMUMsSUFBSSxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUM7UUFDcEIsSUFBSSxDQUFDLFNBQVMsR0FBRyxJQUFJLENBQUM7UUFDdEIsSUFBSSxDQUFDLEdBQUcsR0FBRyxJQUFJLENBQUM7UUFDaEIsSUFBSSxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUM7UUFDcEIsSUFBSSxDQUFDLGlCQUFpQixHQUFHLElBQUksQ0FBQztRQUM5QixJQUFJLENBQUMsaUJBQWlCLEdBQUcsSUFBSSxDQUFDOztZQUN4QixjQUFjLEdBQUcsSUFB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QyxHQUFHLENBQUMsVUFBVSxFQUFFO1lBQ3JCLElBQUksQ0FBQyxHQUFHLENBQUMsVUFBVSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7U0FDN0M7SUFDTCxDQUFDOzs7OztJQUVELCtCQUFhOzs7O0lBQWIsVUFBYyxFQUFFO1FBQ1osRUFBRSxDQUFDLG1CQUFtQixDQUFDLFlBQVksRUFBRSxJQUFJLENBQUMsaUJBQWlCLENBQUMsQ0FBQztRQUM3RCxFQUFFLENBQUMsbUJBQW1CLENBQUMsWUFBWSxFQUFFLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDO0lBQ2pFLENBQUM7SUFDTCxjQUFDO0FBQUQsQ0FBQyxBQXBKRCxJQW9KQzs7OztJQW5KRyx3QkFBVzs7SUFDWCwwQkFBYTs7SUFDYiwwQkFBYTs7SUFDYixzQkFBUzs7SUFDVCw0QkFBZTs7SUFDZixvQ0FBdUI7O0lBQ3ZCLG9DQUF1Qjs7SUFDdkIsMEJBQWE7O0lBQ2IsNEJBQWU7Ozs7O0lBQ0kseUJBQXNCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTmdab25lIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IHRvb2x0aXBzIH0gZnJvbSAnLi90b29sdGlwLWxpc3QnO1xyXG5pbXBvcnQgeyBnZXRTY3JvbGxQYXJlbnQgfSBmcm9tICcuL3V0aWxzL3Njcm9sbEluZm8nO1xyXG5jb25zdCB0b29sdGlwU3R5bGVzID0ge1xyXG4gICAgbWluV2lkdGg6ICc3MHB4JyxcclxuICAgIHBvc2l0aW9uOiAnYWJzb2x1dGUnLFxyXG4gICAgcGFkZGluZzogJzRweCA4cHgnLFxyXG4gICAgdGV4dEFsaWduOiAnY2VudGVyJyxcclxuICAgIGJhY2tncm91bmRDb2xvcjogJ3JnYmEoMCwwLDAsMC43KScsXHJcbiAgICBjb2xvcjogJyNmZmYnLFxyXG4gICAgY3Vyc29yOiAnZGVmYXVsdCcsXHJcbiAgICBib3JkZXJSYWRpdXM6ICc0cHgnLFxyXG4gICAgZm9udFNpemU6ICcxMnB4JyxcclxuICAgIHRvcDogJy05OTk5cHgnLFxyXG4gICAgdmlzaWJpbGl0eTogJ2hpZGRlbicsXHJcbiAgICAnei1pbmRleCc6ICc5OTk5J1xyXG59O1xyXG5leHBvcnQgY2xhc3MgVG9vbHRpcCB7XHJcbiAgICBxdWlsbDogYW55O1xyXG4gICAgdG9vbGJhcjogYW55O1xyXG4gICAgYnV0dG9uczogYW55O1xyXG4gICAgdGlwOiBhbnk7XHJcbiAgICBzZWxlY3RvcnM6IGFueTtcclxuICAgIG1vdXNlZW50ZXJIYW5kbGVyOiBhbnk7XHJcbiAgICBtb3VzZWxlYXZlSGFuZGxlcjogYW55O1xyXG4gICAgdGltZW91dDogYW55O1xyXG4gICAgc2Nyb2xsRWxtOiBhbnk7XHJcbiAgICBjb25zdHJ1Y3RvcihxdWlsbCwgcHJpdmF0ZSBuZ1pvbmU6IE5nWm9uZSkge1xyXG4gICAgICAgIHRoaXMucXVpbGwgPSBxdWlsbDtcclxuICAgICAgICB0aGlzLnRvb2xiYXIgPSBxdWlsbC5nZXRNb2R1bGUoJ3Rvb2xiYXInKTtcclxuICAgICAgICB0aGlzLmJ1dHRvbnMgPSBudWxsO1xyXG4gICAgICAgIHRoaXMuc2VsZWN0b3JzID0gbnVsbDtcclxuICAgICAgICB0aGlzLnRpcCA9IG51bGw7XHJcbiAgICAgICAgdGhpcy50aW1lb3V0ID0gbnVsbDtcclxuICAgICAgICB0aGlzLm1vdXNlZW50ZXJIYW5kbGVyID0gbnVsbDtcclxuICAgICAgICB0aGlzLm1vdXNlbGVhdmVIYW5kbGVyID0gbnVsbDtcclxuICAgICAgICBjb25zdCB0b29sYmFyRWxlbWVudCA9IHRoaXMudG9vbGJhci5jb250YWluZXI7XHJcbiAgICAgICAgaWYgKHRvb2xiYXJFbGVtZW50KSB7XHJcbiAgICAgICAgICAgIC8vIOa3u+WKoOWkhOeQhuS6i+S7tlxyXG4gICAgICAgICAgICB0aGlzLmJ1dHRvbnMgPSB0b29sYmFyRWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKCdidXR0b24nKTtcclxuICAgICAgICAgICAgdGhpcy5zZWxlY3RvcnMgPSB0b29sYmFyRWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKCcucWwtcGlja2VyJyk7XHJcbiAgICAgICAgICAgIGZvciAobGV0IGVsIG9mIHRoaXMuYnV0dG9ucykge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5hZGRIYW5kbGVyKGVsKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBmb3IgKGxldCBlbCBvZiB0aGlzLnNlbGVjdG9ycykge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5hZGRIYW5kbGVyKGVsKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvLyDliJvlu7p0b29sdGlwXHJcbiAgICAgICAgICAgIHRoaXMuY3JlYXRlVG9vbHRpcCgpO1xyXG4gICAgICAgICAgICAvLyDmu5rliqjlhYPntKDlop7liqBoYW5kbGVyXHJcbiAgICAgICAgICAgIHRoaXMuc2Nyb2xsRWxtID0gZ2V0U2Nyb2xsUGFyZW50KHRvb2xiYXJFbGVtZW50KTtcclxuICAgICAgICAgICAgdGhpcy5zY3JvbGxFbG0uYWRkRXZlbnRMaXN0ZW5lcignc2Nyb2xsJywgdGhpcy5tb3VzZWxlYXZlSGFuZGxlcik7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGNyZWF0ZVRvb2x0aXAoKSB7XHJcbiAgICAgICAgdGhpcy50aXAgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICAgICAgICB0aGlzLnRpcC5jbGFzc0xpc3QuYWRkKCdxdWlsbC10b29sdGlwJyk7XHJcbiAgICAgICAgT2JqZWN0LmFzc2lnbih0aGlzLnRpcC5zdHlsZSwgdG9vbHRpcFN0eWxlcyk7XHJcbiAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZCh0aGlzLnRpcCk7XHJcbiAgICB9XHJcblxyXG4gICAgYWRkSGFuZGxlcihlbCkge1xyXG4gICAgICAgIHRoaXMubW91c2VlbnRlckhhbmRsZXIgPSAoKSA9PiB7XHJcbiAgICAgICAgICAgIC8vIHRoaXMubmdab25lLnJ1bk91dHNpZGVBbmd1bGFyKCgpID0+IHtcclxuICAgICAgICAgICAgLy8gICAgIHRoaXMudGltZW91dCA9IHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgICAvLyAgICAgICAgIHRoaXMuc2hvd1Rvb2x0aXAoZWwpO1xyXG4gICAgICAgICAgICAvLyAgICAgfSwgMTAwKTtcclxuICAgICAgICAgICAgLy8gfSk7XHJcbiAgICAgICAgICAgIHRoaXMudGltZW91dCA9IHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zaG93VG9vbHRpcChlbCk7XHJcbiAgICAgICAgICAgIH0sIDEwMCk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICB0aGlzLm1vdXNlbGVhdmVIYW5kbGVyID0gKCkgPT4ge1xyXG4gICAgICAgICAgICBpZiAodGhpcy50aW1lb3V0KSB7XHJcbiAgICAgICAgICAgICAgICAvLyB0aGlzLm5nWm9uZS5ydW5PdXRzaWRlQW5ndWxhcigoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAvLyAgICAgY2xlYXJUaW1lb3V0KHRoaXMudGltZW91dCk7XHJcbiAgICAgICAgICAgICAgICAvLyB9KTtcclxuICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aGlzLnRpbWVvdXQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMuaGlkZVRvb2x0aXAoKTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIC8vIGlmICh0aGlzLm5nWm9uZSAmJiB0aGlzLm5nWm9uZS5ydW5PdXRzaWRlQW5ndWxhcikge1xyXG4gICAgICAgIC8vICAgICB0aGlzLm5nWm9uZS5ydW5PdXRzaWRlQW5ndWxhcigoKSA9PiB7XHJcbiAgICAgICAgLy8gICAgICAgICBlbC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWVudGVyJywgdGhpcy5tb3VzZWVudGVySGFuZGxlcik7XHJcbiAgICAgICAgLy8gICAgICAgICBlbC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWxlYXZlJywgdGhpcy5tb3VzZWxlYXZlSGFuZGxlcik7XHJcbiAgICAgICAgLy8gICAgIH0pO1xyXG4gICAgICAgIC8vIH1cclxuICAgICAgICBlbC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWVudGVyJywgdGhpcy5tb3VzZWVudGVySGFuZGxlcik7XHJcbiAgICAgICAgZWwuYWRkRXZlbnRMaXN0ZW5lcignbW91c2VsZWF2ZScsIHRoaXMubW91c2VsZWF2ZUhhbmRsZXIpO1xyXG4gICAgfVxyXG5cclxuICAgIHNob3dUb29sdGlwKGVsKSB7XHJcbiAgICAgICAgLy8gbGV0IGZvcm1hdCA9IGVsLmNsYXNzTmFtZS5yZXBsYWNlKCdxbC0nLCAnJylcclxuXHJcbiAgICAgICAgY29uc3QgTE9DQUxFX0lEID0gdGhpcy5xdWlsbC5vcHRpb25zLmxvY2FsZUlkIHx8ICd6aC1DSFMnO1xyXG5cclxuICAgICAgICBjb25zdCBmb3JtYXQgPSBbXS5maW5kXHJcbiAgICAgICAgICAgIC5jYWxsKGVsLmNsYXNzTGlzdCwgY2xhc3NOYW1lID0+IHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBjbGFzc05hbWUuaW5kZXhPZigncWwtJykgPT09IDA7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC5yZXBsYWNlKCdxbC0nLCAnJyk7XHJcbiAgICAgICAgY29uc3QgdG9vbCA9IHRvb2x0aXBzW0xPQ0FMRV9JRF1bZm9ybWF0XTtcclxuICAgICAgICBpZiAodG9vbCkge1xyXG4gICAgICAgICAgICBpZiAodHlwZW9mIHRvb2wgPT09ICdzdHJpbmcnKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnRpcC50ZXh0Q29udGVudCA9IHRvb2w7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCB2YWx1ZSA9IGVsLnZhbHVlIHx8ICcnO1xyXG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlICE9IG51bGwgJiYgdG9vbFt2YWx1ZV0pIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnRpcC50ZXh0Q29udGVudCA9IHRvb2xbdmFsdWVdO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNvbnN0IGVsUmVjdCA9IGVsLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xyXG4gICAgICAgICAgICBjb25zdCB0aXBSZWN0ID0gdGhpcy50aXAuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XHJcbiAgICAgICAgICAgIGNvbnN0IGJvZHkgPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQgfHwgZG9jdW1lbnQuYm9keTtcclxuICAgICAgICAgICAgY29uc3QgYm9keVJlY3QgPSB7XHJcbiAgICAgICAgICAgICAgICB3aWR0aDogYm9keS5zY3JvbGxXaWR0aCxcclxuICAgICAgICAgICAgICAgIGhlaWdodDogYm9keS5zY3JvbGxIZWlnaHQsXHJcbiAgICAgICAgICAgICAgICBzY3JvbGxUb3A6IGJvZHkuc2Nyb2xsVG9wLFxyXG4gICAgICAgICAgICAgICAgc2Nyb2xsTGVmdDogYm9keS5zY3JvbGxMZWZ0XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIGNvbnN0IG9mZnNldCA9IDM7XHJcbiAgICAgICAgICAgIE9iamVjdC5hc3NpZ24odGhpcy50aXAuc3R5bGUsIHtcclxuICAgICAgICAgICAgICAgIHRvcDogZWxSZWN0LnRvcCAtIGVsUmVjdC5oZWlnaHQgLSBvZmZzZXQgKyBib2R5UmVjdC5zY3JvbGxUb3AgKyAncHgnLFxyXG4gICAgICAgICAgICAgICAgbGVmdDogZWxSZWN0LmxlZnQgLSAodGlwUmVjdC53aWR0aCAtIGVsUmVjdC53aWR0aCkgLyAyICsgYm9keVJlY3Quc2Nyb2xsTGVmdCArICdweCcsXHJcbiAgICAgICAgICAgICAgICB2aXNpYmlsaXR5OiAndmlzaWJsZSdcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGhpZGVUb29sdGlwKCkge1xyXG4gICAgICAgIE9iamVjdC5hc3NpZ24odGhpcy50aXAuc3R5bGUsIHtcclxuICAgICAgICAgICAgdG9wOiAnLTk5OTlweCcsXHJcbiAgICAgICAgICAgIHZpc2liaWxpdHk6ICdoaWRkZW4nXHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgb25EZXN0cm95KCkge1xyXG4gICAgICAgIC8vIGNvbnNvbGUud2Fybignb25kZXN0cm95Jyk7XHJcbiAgICAgICAgdGhpcy5kZXN0cm95VG9vbHRpcCgpO1xyXG4gICAgICAgIGlmICh0aGlzLmJ1dHRvbnMpIHtcclxuICAgICAgICAgICAgZm9yIChsZXQgZWwgb2YgdGhpcy5idXR0b25zKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnJlbW92ZUhhbmRsZXIoZWwpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0aGlzLnNlbGVjdG9ycykge1xyXG4gICAgICAgICAgICBmb3IgKGxldCBlbCBvZiB0aGlzLnNlbGVjdG9ycykge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5yZW1vdmVIYW5kbGVyKGVsKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGhpcy5zY3JvbGxFbG0pIHtcclxuICAgICAgICAgICAgdGhpcy5zY3JvbGxFbG0ucmVtb3ZlRXZlbnRMaXN0ZW5lcignc2Nyb2xsJywgdGhpcy5tb3VzZWxlYXZlSGFuZGxlcik7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGRlc3Ryb3lUb29sdGlwKCkge1xyXG4gICAgICAgIGlmICh0aGlzLnRpcC5wYXJlbnROb2RlKSB7XHJcbiAgICAgICAgICAgIHRoaXMudGlwLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQodGhpcy50aXApO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICByZW1vdmVIYW5kbGVyKGVsKSB7XHJcbiAgICAgICAgZWwucmVtb3ZlRXZlbnRMaXN0ZW5lcignbW91c2VlbnRlcicsIHRoaXMubW91c2VlbnRlckhhbmRsZXIpO1xyXG4gICAgICAgIGVsLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ21vdXNlbGVhdmUnLCB0aGlzLm1vdXNlbGVhdmVIYW5kbGVyKTtcclxuICAgIH1cclxufVxyXG4iXX0=
/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { BaseModule } from './BaseModule';
var Resize = /** @class */ (function (_super) {
    tslib_1.__extends(Resize, _super);
    function Resize() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.onCreate = (/**
         * @return {?}
         */
        function () {
            // track resize handles
            _this.boxes = [];
            // add 4 resize handles
            _this.addBox('nwse-resize'); // top left
            _this.addBox('nesw-resize'); // top right
            _this.addBox('nwse-resize'); // bottom right
            _this.addBox('nesw-resize'); // bottom left
            _this.positionBoxes();
        });
        _this.onDestroy = (/**
         * @return {?}
         */
        function () {
            // reset drag handle cursors
            _this.setCursor('');
        });
        _this.positionBoxes = (/**
         * @return {?}
         */
        function () {
            /** @type {?} */
            var handleXOffset = -parseFloat(_this.options.handleStyles.width) /
                2 + "px";
            /** @type {?} */
            var handleYOffset = -parseFloat(_this.options.handleStyles.height) /
                2 + "px";
            // set the top and left for each drag handle
            [
                { left: handleXOffset, top: handleYOffset },
                { right: handleXOffset, top: handleYOffset },
                { right: handleXOffset, bottom: handleYOffset },
                { left: handleXOffset, bottom: handleYOffset } // bottom left
            ].forEach((/**
             * @param {?} pos
             * @param {?} idx
             * @return {?}
             */
            function (pos, idx) {
                Object.assign(_this.boxes[idx].style, pos);
            }));
        });
        _this.addBox = (/**
         * @param {?} cursor
         * @return {?}
         */
        function (cursor) {
            // create div element for resize handle
            /** @type {?} */
            var box = document.createElement('div');
            // Star with the specified styles
            Object.assign(box.style, _this.options.handleStyles);
            box.style.cursor = cursor;
            // Set the width/height to use 'px'
            box.style.width = _this.options.handleStyles.width + "px";
            box.style.height = _this.options.handleStyles.height + "px";
            // listen for mousedown on each box
            box.addEventListener('mousedown', _this.handleMousedown, false);
            // add drag handle to document
            _this.overlay.appendChild(box);
            // keep track of drag handle
            _this.boxes.push(box);
        });
        _this.handleMousedown = (/**
         * @param {?} evt
         * @return {?}
         */
        function (evt) {
            // note which box
            _this.dragBox = evt.target;
            // note starting mousedown position
            _this.dragStartX = evt.clientX;
            // store the width before the drag
            _this.preDragWidth = _this.img.width || _this.img.naturalWidth;
            // set the proper cursor everywhere
            _this.setCursor(_this.dragBox.style.cursor);
            // listen for movement and mouseup
            document.addEventListener('mousemove', _this.handleDrag, false);
            document.addEventListener('mouseup', _this.handleMouseup, false);
        });
        _this.handleMouseup = (/**
         * @return {?}
         */
        function () {
            // reset cursor everywhere
            _this.setCursor('');
            // stop listening for movement and mouseup
            document.removeEventListener('mousemove', _this.handleDrag);
            document.removeEventListener('mouseup', _this.handleMouseup);
        });
        _this.handleDrag = (/**
         * @param {?} evt
         * @return {?}
         */
        function (evt) {
            if (!_this.img) {
                // image not set yet
                return;
            }
            // update image size
            /** @type {?} */
            var deltaX = evt.clientX - _this.dragStartX;
            if (_this.dragBox === _this.boxes[0] || _this.dragBox === _this.boxes[3]) {
                // left-side resize handler; dragging right shrinks image
                _this.img.width = Math.round(_this.preDragWidth - deltaX);
            }
            else {
                // right-side resize handler; dragging right enlarges image
                _this.img.width = Math.round(_this.preDragWidth + deltaX);
            }
            _this.requestUpdate();
        });
        _this.setCursor = (/**
         * @param {?} value
         * @return {?}
         */
        function (value) {
            [document.body, _this.img].forEach((/**
             * @param {?} el
             * @return {?}
             */
            function (el) {
                el.style.cursor = value; // eslint-disable-line no-param-reassign
            }));
        });
        return _this;
    }
    return Resize;
}(BaseModule));
export { Resize };
if (false) {
    /** @type {?} */
    Resize.prototype.boxes;
    /** @type {?} */
    Resize.prototype.dragBox;
    /** @type {?} */
    Resize.prototype.dragStartX;
    /** @type {?} */
    Resize.prototype.preDragWidth;
    /** @type {?} */
    Resize.prototype.onCreate;
    /** @type {?} */
    Resize.prototype.onDestroy;
    /** @type {?} */
    Resize.prototype.positionBoxes;
    /** @type {?} */
    Resize.prototype.addBox;
    /** @type {?} */
    Resize.prototype.handleMousedown;
    /** @type {?} */
    Resize.prototype.handleMouseup;
    /** @type {?} */
    Resize.prototype.handleDrag;
    /** @type {?} */
    Resize.prototype.setCursor;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiUmVzaXplLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy91aS1odG1sLWVkaXRvci8iLCJzb3VyY2VzIjpbImxpYi9pbWFnZS1yZXNpemUtbW9kdWxlL21vZHVsZXMvUmVzaXplLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGNBQWMsQ0FBQztBQUUxQztJQUE0QixrQ0FBVTtJQUF0QztRQUFBLHFFQXdHQztRQW5HRyxjQUFROzs7UUFBRztZQUNQLHVCQUF1QjtZQUN2QixLQUFJLENBQUMsS0FBSyxHQUFHLEVBQUUsQ0FBQztZQUVoQix1QkFBdUI7WUFDdkIsS0FBSSxDQUFDLE1BQU0sQ0FBQyxhQUFhLENBQUMsQ0FBQyxDQUFDLFdBQVc7WUFDdkMsS0FBSSxDQUFDLE1BQU0sQ0FBQyxhQUFhLENBQUMsQ0FBQyxDQUFDLFlBQVk7WUFDeEMsS0FBSSxDQUFDLE1BQU0sQ0FBQyxhQUFhLENBQUMsQ0FBQyxDQUFDLGVBQWU7WUFDM0MsS0FBSSxDQUFDLE1BQU0sQ0FBQyxhQUFhLENBQUMsQ0FBQyxDQUFDLGNBQWM7WUFFMUMsS0FBSSxDQUFDLGFBQWEsRUFBRSxDQUFDO1FBQ3pCLENBQUMsRUFBQztRQUVGLGVBQVM7OztRQUFHO1lBQ1IsNEJBQTRCO1lBQzVCLEtBQUksQ0FBQyxTQUFTLENBQUMsRUFBRSxDQUFDLENBQUM7UUFDdkIsQ0FBQyxFQUFDO1FBRUYsbUJBQWE7OztRQUFHOztnQkFDTixhQUFhLEdBQU0sQ0FBQyxVQUFVLENBQUMsS0FBSSxDQUFDLE9BQU8sQ0FBQyxZQUFZLENBQUMsS0FBSyxDQUFDO2dCQUNqRSxDQUFDLE9BQUk7O2dCQUNILGFBQWEsR0FBTSxDQUFDLFVBQVUsQ0FBQyxLQUFJLENBQUMsT0FBTyxDQUFDLFlBQVksQ0FBQyxNQUFNLENBQUM7Z0JBQzlELENBQUMsT0FBSTtZQUVULDRDQUE0QztZQUNoRDtnQkFDSSxFQUFFLElBQUksRUFBRSxhQUFhLEVBQUUsR0FB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YXNlTW9kdWxlJztcclxuXHJcbmV4cG9ydCBjbGFzcyBSZXNpemUgZXh0ZW5kcyBCYXNlTW9kdWxlIHtcclxuICAgIGJveGVzO1xyXG4gICAgZHJhZ0JveDtcclxuICAgIGRyYWdTdGFydFg7XHJcbiAgICBwcmVEcmFnV2lkdGg7XHJcbiAgICBvbkNyZWF0ZSA9ICgpID0+IHtcclxuICAgICAgICAvLyB0cmFjayByZXNpemUgaGFuZGxlc1xyXG4gICAgICAgIHRoaXMuYm94ZXMgPSBbXTtcclxuXHJcbiAgICAgICAgLy8gYWRkIDQgcmVzaXplIGhhbmRsZXNcclxuICAgICAgICB0aGlzLmFkZEJveCgnbndzZS1yZXNpemUnKTsgLy8gdG9wIGxlZnRcclxuICAgICAgICB0aGlzLmFkZEJveCgnbmVzdy1yZXNpemUnKTsgLy8gdG9wIHJpZ2h0XHJcbiAgICAgICAgdGhpcy5hZGRCb3goJ253c2UtcmVzaXplJyk7IC8vIGJvdHRvbSByaWdodFxyXG4gICAgICAgIHRoaXMuYWRkQm94KCduZXN3LXJlc2l6ZScpOyAvLyBib3R0b20gbGVmdFxyXG5cclxuICAgICAgICB0aGlzLnBvc2l0aW9uQm94ZXMoKTtcclxuICAgIH07XHJcblxyXG4gICAgb25EZXN0cm95ID0gKCkgPT4ge1xyXG4gICAgICAgIC8vIHJlc2V0IGRyYWcgaGFuZGxlIGN1cnNvcnNcclxuICAgICAgICB0aGlzLnNldEN1cnNvcignJyk7XHJcbiAgICB9O1xyXG5cclxuICAgIHBvc2l0aW9uQm94ZXMgPSAoKSA9PiB7XHJcbiAgICAgICAgY29uc3QgaGFuZGxlWE9mZnNldCA9IGAkey1wYXJzZUZsb2F0KHRoaXMub3B0aW9ucy5oYW5kbGVTdHlsZXMud2lkdGgpIC9cclxuICAgICAgICAgICAgMn1weGA7XHJcbiAgICAgICAgY29uc3QgaGFuZGxlWU9mZnNldCA9IGAkey1wYXJzZUZsb2F0KHRoaXMub3B0aW9ucy5oYW5kbGVTdHlsZXMuaGVpZ2h0KSAvXHJcbiAgICAgICAgICAgICAgICAyfXB4YDtcclxuXHJcbiAgICAgICAgICAgIC8vIHNldCB0aGUgdG9wIGFuZCBsZWZ0IGZvciBlYWNoIGRyYWcgaGFuZGxlXHJcbiAgICAgICAgW1xyXG4gICAgICAgICAgICB7IGxlZnQ6IGhhbmRsZVhPZmZzZXQsIHRvcDogaGFuZGxlWU9mZnNldCB9LCAvLyB0b3AgbGVmdFxyXG4gICAgICAgICAgICB7IHJpZ2h0OiBoYW5kbGVYT2Zmc2V0LCB0b3A6IGhhbmRsZVlPZmZzZXQgfSwgLy8gdG9wIHJpZ2h0XHJcbiAgICAgICAgICAgIHsgcmlnaHQ6IGhhbmRsZVhPZmZzZXQsIGJvdHRvbTogaGFuZGxlWU9mZnNldCB9LCAvLyBib3R0b20gcmlnaHRcclxuICAgICAgICAgICAgeyBsZWZ0OiBoYW5kbGVYT2Zmc2V0LCBib3R0b206IGhhbmRsZVlPZmZzZXQgfSAvLyBib3R0b20gbGVmdFxyXG4gICAgICAgIF0uZm9yRWFjaCgocG9zLCBpZHgpID0+IHtcclxuICAgICAgICAgICAgT2JqZWN0LmFzc2lnbih0aGlzLmJveGVzW2lkeF0uc3R5bGUsIHBvcyk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG5cclxuICAgIGFkZEJveCA9IGN1cnNvciA9PiB7XHJcbiAgICAgICAgLy8gY3JlYXRlIGRpdiBlbGVtZW50IGZvciByZXNpemUgaGFuZGxlXHJcbiAgICAgICAgY29uc3QgYm94ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcblxyXG4gICAgICAgIC8vIFN0YXIgd2l0aCB0aGUgc3BlY2lmaWVkIHN0eWxlc1xyXG4gICAgICAgIE9iamVjdC5hc3NpZ24oYm94LnN0eWxlLCB0aGlzLm9wdGlvbnMuaGFuZGxlU3R5bGVzKTtcclxuICAgICAgICBib3guc3R5bGUuY3Vyc29yID0gY3Vyc29yO1xyXG5cclxuICAgICAgICAvLyBTZXQgdGhlIHdpZHRoL2hlaWdodCB0byB1c2UgJ3B4J1xyXG4gICAgICAgIGJveC5zdHlsZS53aWR0aCA9IGAke3RoaXMub3B0aW9ucy5oYW5kbGVTdHlsZXMud2lkdGh9cHhgO1xyXG4gICAgICAgIGJveC5zdHlsZS5oZWlnaHQgPSBgJHt0aGlzLm9wdGlvbnMuaGFuZGxlU3R5bGVzLmhlaWdodH1weGA7XHJcblxyXG4gICAgICAgIC8vIGxpc3RlbiBmb3IgbW91c2Vkb3duIG9uIGVhY2ggYm94XHJcbiAgICAgICAgYm94LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlZG93bicsIHRoaXMuaGFuZGxlTW91c2Vkb3duLCBmYWxzZSk7XHJcbiAgICAgICAgLy8gYWRkIGRyYWcgaGFuZGxlIHRvIGRvY3VtZW50XHJcbiAgICAgICAgdGhpcy5vdmVybGF5LmFwcGVuZENoaWxkKGJveCk7XHJcbiAgICAgICAgLy8ga2VlcCB0cmFjayBvZiBkcmFnIGhhbmRsZVxyXG4gICAgICAgIHRoaXMuYm94ZXMucHVzaChib3gpO1xyXG4gICAgfTtcclxuXHJcbiAgICBoYW5kbGVNb3VzZWRvd24gPSBldnQgPT4ge1xyXG4gICAgICAgIC8vIG5vdGUgd2hpY2ggYm94XHJcbiAgICAgICAgdGhpcy5kcmFnQm94ID0gZXZ0LnRhcmdldDtcclxuICAgICAgICAvLyBub3RlIHN0YXJ0aW5nIG1vdXNlZG93biBwb3NpdGlvblxyXG4gICAgICAgIHRoaXMuZHJhZ1N0YXJ0WCA9IGV2dC5jbGllbnRYO1xyXG4gICAgICAgIC8vIHN0b3JlIHRoZSB3aWR0aCBiZWZvcmUgdGhlIGRyYWdcclxuICAgICAgICB0aGlzLnByZURyYWdXaWR0aCA9IHRoaXMuaW1nLndpZHRoIHx8IHRoaXMuaW1nLm5hdHVyYWxXaWR0aDtcclxuICAgICAgICAvLyBzZXQgdGhlIHByb3BlciBjdXJzb3IgZXZlcnl3aGVyZVxyXG4gICAgICAgIHRoaXMuc2V0Q3Vyc29yKHRoaXMuZHJhZ0JveC5zdHlsZS5jdXJzb3IpO1xyXG4gICAgICAgIC8vIGxpc3RlbiBmb3IgbW92ZW1lbnQgYW5kIG1vdXNldXBcclxuICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZW1vdmUnLCB0aGlzLmhhbmRsZURyYWcsIGZhbHNlKTtcclxuICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZXVwJywgdGhpcy5oYW5kbGVNb3VzZXVwLCBmYWxzZSk7XHJcbiAgICB9O1xyXG5cclxuICAgIGhhbmRsZU1vdXNldXAgPSAoKSA9PiB7XHJcbiAgICAgICAgLy8gcmVzZXQgY3Vyc29yIGV2ZXJ5d2hlcmVcclxuICAgICAgICB0aGlzLnNldEN1cnNvcignJyk7XHJcbiAgICAgICAgLy8gc3RvcCBsaXN0ZW5pbmcgZm9yIG1vdmVtZW50IGFuZCBtb3VzZXVwXHJcbiAgICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignbW91c2Vtb3ZlJywgdGhpcy5oYW5kbGVEcmFnKTtcclxuICAgICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdtb3VzZXVwJywgdGhpcy5oYW5kbGVNb3VzZXVwKTtcclxuICAgIH07XHJcblxyXG4gICAgaGFuZGxlRHJhZyA9IGV2dCA9PiB7XHJcbiAgICAgICAgaWYgKCF0aGlzLmltZykge1xyXG4gICAgICAgICAgICAvLyBpbWFnZSBub3Qgc2V0IHlldFxyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIHVwZGF0ZSBpbWFnZSBzaXplXHJcbiAgICAgICAgY29uc3QgZGVsdGFYID0gZXZ0LmNsaWVudFggLSB0aGlzLmRyYWdTdGFydFg7XHJcbiAgICAgICAgaWYgKHRoaXMuZHJhZ0JveCA9PT0gdGhpcy5ib3hlc1swXSB8fCB0aGlzLmRyYWdCb3ggPT09IHRoaXMuYm94ZXNbM10pIHtcclxuICAgICAgICAgICAgLy8gbGVmdC1zaWRlIHJlc2l6ZSBoYW5kbGVyOyBkcmFnZ2luZyByaWdodCBzaHJpbmtzIGltYWdlXHJcbiAgICAgICAgICAgIHRoaXMuaW1nLndpZHRoID0gTWF0aC5yb3VuZCh0aGlzLnByZURyYWdXaWR0aCAtIGRlbHRhWCk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgLy8gcmlnaHQtc2lkZSByZXNpemUgaGFuZGxlcjsgZHJhZ2dpbmcgcmlnaHQgZW5sYXJnZXMgaW1hZ2VcclxuICAgICAgICAgICAgdGhpcy5pbWcud2lkdGggPSBNYXRoLnJvdW5kKHRoaXMucHJlRHJhZ1dpZHRoICsgZGVsdGFYKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5yZXF1ZXN0VXBkYXRlKCk7XHJcbiAgICB9O1xyXG5cclxuICAgIHNldEN1cnNvciA9IHZhbHVlID0+IHtcclxuICAgICAgICBbZG9jdW1lbnQuYm9keSwgdGhpcy5pbWddLmZvckVhY2goZWwgPT4ge1xyXG4gICAgICAgICAgICBlbC5zdHlsZS5jdXJzb3IgPSB2YWx1ZTsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby1wYXJhbS1yZWFzc2lnblxyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxufVxyXG4iXX0=
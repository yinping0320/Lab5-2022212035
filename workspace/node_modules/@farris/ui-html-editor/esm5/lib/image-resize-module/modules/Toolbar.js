/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { BaseModule } from './BaseModule';
import Quill from 'quill';
/** @type {?} */
var Parchment = Quill.imports.parchment;
/** @type {?} */
var FloatStyle = new Parchment.Attributor.Style('float', 'float');
/** @type {?} */
var MarginStyle = new Parchment.Attributor.Style('margin', 'margin');
/** @type {?} */
var DisplayStyle = new Parchment.Attributor.Style('display', 'display');
var Toolbar = /** @class */ (function (_super) {
    tslib_1.__extends(Toolbar, _super);
    function Toolbar() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.onCreate = (/**
         * @return {?}
         */
        function () {
            // Setup Toolbar
            _this.toolbar = document.createElement('div');
            Object.assign(_this.toolbar.style, _this.options.toolbarStyles);
            _this.overlay.appendChild(_this.toolbar);
            // Setup Buttons
            _this._defineAlignments();
            _this._addToolbarButtons();
        });
        // The toolbar and its children will be destroyed when the overlay is removed
        _this.onDestroy = (/**
         * @return {?}
         */
        function () { });
        // Nothing to update on drag because we are are positioned relative to the overlay
        _this.onUpdate = (/**
         * @return {?}
         */
        function () { });
        _this._defineAlignments = (/**
         * @return {?}
         */
        function () {
            _this.alignments = [
                {
                    icon: "<svg viewbox=\"0 0 18 18\">\n                <line class=\"ql-stroke\" x1=\"3\" x2=\"15\" y1=\"9\" y2=\"9\"></line>\n                <line class=\"ql-stroke\" x1=\"3\" x2=\"13\" y1=\"14\" y2=\"14\"></line>\n                <line class=\"ql-stroke\" x1=\"3\" x2=\"9\" y1=\"4\" y2=\"4\"></line>\n              </svg>",
                    apply: (/**
                     * @return {?}
                     */
                    function () {
                        DisplayStyle.add(_this.img, 'inline');
                        FloatStyle.add(_this.img, 'left');
                        MarginStyle.add(_this.img, '0 1em 1em 0');
                    }),
                    isApplied: (/**
                     * @return {?}
                     */
                    function () { return FloatStyle.value(_this.img) == 'left'; })
                },
                {
                    icon: "<svg viewbox=\"0 0 18 18\">\n                <line class=\"ql-stroke\" x1=\"15\" x2=\"3\" y1=\"9\" y2=\"9\"></line>\n                <line class=\"ql-stroke\" x1=\"14\" x2=\"4\" y1=\"14\" y2=\"14\"></line>\n                <line class=\"ql-stroke\" x1=\"12\" x2=\"6\" y1=\"4\" y2=\"4\"></line>\n              </svg>",
                    apply: (/**
                     * @return {?}
                     */
                    function () {
                        DisplayStyle.add(_this.img, 'block');
                        FloatStyle.remove(_this.img);
                        MarginStyle.add(_this.img, 'auto');
                    }),
                    isApplied: (/**
                     * @return {?}
                     */
                    function () { return MarginStyle.value(_this.img) == 'auto'; })
                },
                {
                    icon: "<svg viewbox=\"0 0 18 18\">\n                <line class=\"ql-stroke\" x1=\"15\" x2=\"3\" y1=\"9\" y2=\"9\"></line>\n                <line class=\"ql-stroke\" x1=\"15\" x2=\"5\" y1=\"14\" y2=\"14\"></line>\n                <line class=\"ql-stroke\" x1=\"15\" x2=\"9\" y1=\"4\" y2=\"4\"></line>\n              </svg>",
                    apply: (/**
                     * @return {?}
                     */
                    function () {
                        DisplayStyle.add(_this.img, 'inline');
                        FloatStyle.add(_this.img, 'right');
                        MarginStyle.add(_this.img, '0 0 1em 1em');
                    }),
                    isApplied: (/**
                     * @return {?}
                     */
                    function () { return FloatStyle.value(_this.img) == 'right'; })
                }
            ];
        });
        _this._addToolbarButtons = (/**
         * @return {?}
         */
        function () {
            /** @type {?} */
            var buttons = [];
            _this.alignments.forEach((/**
             * @param {?} alignment
             * @param {?} idx
             * @return {?}
             */
            function (alignment, idx) {
                /** @type {?} */
                var button = document.createElement('span');
                buttons.push(button);
                button.innerHTML = alignment.icon;
                button.addEventListener('click', (/**
                 * @return {?}
                 */
                function () {
                    // deselect all buttons
                    buttons.forEach((/**
                     * @param {?} button
                     * @return {?}
                     */
                    function (button) { return (button.style.filter = ''); }));
                    if (alignment.isApplied()) {
                        // If applied, unapply
                        FloatStyle.remove(_this.img);
                        MarginStyle.remove(_this.img);
                        DisplayStyle.remove(_this.img);
                    }
                    else {
                        // otherwise, select button and apply
                        _this._selectButton(button);
                        alignment.apply();
                    }
                    // image may change position; redraw drag handles
                    _this.requestUpdate();
                }));
                Object.assign(button.style, _this.options.toolbarButtonStyles);
                if (idx > 0) {
                    button.style.borderLeftWidth = '0';
                }
                Object.assign(
                // tslint:disable-next-line:object-literal-key-quotes
                button.children[0]['style'], _this.options.toolbarButtonSvgStyles);
                if (alignment.isApplied()) {
                    // select button if previously applied
                    _this._selectButton(button);
                }
                _this.toolbar.appendChild(button);
            }));
        });
        _this._selectButton = (/**
         * @param {?} button
         * @return {?}
         */
        function (button) {
            button.style.filter = 'invert(20%)';
        });
        return _this;
    }
    return Toolbar;
}(BaseModule));
export { Toolbar };
if (false) {
    /** @type {?} */
    Toolbar.prototype.toolbar;
    /** @type {?} */
    Toolbar.prototype.alignments;
    /** @type {?} */
    Toolbar.prototype.onCreate;
    /** @type {?} */
    Toolbar.prototype.onDestroy;
    /** @type {?} */
    Toolbar.prototype.onUpdate;
    /** @type {?} */
    Toolbar.prototype._defineAlignments;
    /** @type {?} */
    Toolbar.prototype._addToolbarButtons;
    /** @type {?} */
    Toolbar.prototype._selectButton;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVG9vbGJhci5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvdWktaHRtbC1lZGl0b3IvIiwic291cmNlcyI6WyJsaWIvaW1hZ2UtcmVzaXplLW1vZHVsZS9tb2R1bGVzL1Rvb2xiYXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sY0FBYyxDQUFDO0FBQzFDLE9BQU8sS0FBSyxNQUFNLE9BQU8sQ0FBQzs7SUFDcEIsU0FBUyxHQUFHLEtBQUssQ0FBQyxPQUFPLENBQUMsU0FBUzs7SUFDbkMsVUFBVSxHQUFHLElBQUksU0FBUyxDQUFDLFVBQVUsQ0FBQyxLQUFLLENBQUMsT0FBTyxFQUFFLE9BQU8sQ0FBQzs7SUFDN0QsV0FBVyxHQUFHLElBQUksU0FBUyxDQUFDLFVBQVUsQ0FBQyxLQUFLLENBQUMsUUFBUSxFQUFFLFFBQVEsQ0FBQzs7SUFDaEUsWUFBWSxHQUFHLElBQUksU0FBUyxDQUFDLFVBQVUsQ0FBQyxLQUFLLENBQUMsU0FBUyxFQUFFLFNBQVMsQ0FBQztBQUV6RTtJQUE2QixtQ0FBVTtJQUF2QztRQUFBLHFFQTBHQztRQXZHRyxjQUFROzs7UUFBRztZQUNQLGdCQUFnQjtZQUNoQixLQUFJLENBQUMsT0FBTyxHQUFHLFFBQVEsQ0FBQyxhQUFhLENBQUMsS0FBSyxDQUFDLENBQUM7WUFDN0MsTUFBTSxDQUFDLE1BQU0sQ0FBQyxLQUFJLENBQUMsT0FBTyxDQUFDLEtBQUssRUFBRSxLQUFJLENBQUMsT0FBTyxDQUFDLGFBQWEsQ0FBQyxDQUFDO1lBQzlELEtBQUksQ0FBQyxPQUFPLENBQUMsV0FBVyxDQUFDLEtBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztZQUV2QyxnQkFBZ0I7WUFDaEIsS0FBSSxDQUFDLGlCQUFpQixFQUFFLENBQUM7WUFDekIsS0FBSSxDQUFDLGtCQUFrQixFQUFFLENBQUM7UUFDOUIsQ0FBQyxFQUFDOztRQUdGLGVBQVM7OztRQUFHLGNBQU8sQ0FBQyxFQUFDOztR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b3J0IHsgQmFzZU1vZHVsZSB9IGZyb20gJy4vQmFzZU1vZHVsZSc7XHJcbmltcG9ydCBRdWlsbCBmcm9tICdxdWlsbCc7XHJcbmNvbnN0IFBhcmNobWVudCA9IFF1aWxsLmltcG9ydHMucGFyY2htZW50O1xyXG5jb25zdCBGbG9hdFN0eWxlID0gbmV3IFBhcmNobWVudC5BdHRyaWJ1dG9yLlN0eWxlKCdmbG9hdCcsICdmbG9hdCcpO1xyXG5jb25zdCBNYXJnaW5TdHlsZSA9IG5ldyBQYXJjaG1lbnQuQXR0cmlidXRvci5TdHlsZSgnbWFyZ2luJywgJ21hcmdpbicpO1xyXG5jb25zdCBEaXNwbGF5U3R5bGUgPSBuZXcgUGFyY2htZW50LkF0dHJpYnV0b3IuU3R5bGUoJ2Rpc3BsYXknLCAnZGlzcGxheScpO1xyXG5cclxuZXhwb3J0IGNsYXNzIFRvb2xiYXIgZXh0ZW5kcyBCYXNlTW9kdWxlIHtcclxuICAgIHRvb2xiYXI7XHJcbiAgICBhbGlnbm1lbnRzO1xyXG4gICAgb25DcmVhdGUgPSAoKSA9PiB7XHJcbiAgICAgICAgLy8gU2V0dXAgVG9vbGJhclxyXG4gICAgICAgIHRoaXMudG9vbGJhciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICAgICAgIE9iamVjdC5hc3NpZ24odGhpcy50b29sYmFyLnN0eWxlLCB0aGlzLm9wdGlvbnMudG9vbGJhclN0eWxlcyk7XHJcbiAgICAgICAgdGhpcy5vdmVybGF5LmFwcGVuZENoaWxkKHRoaXMudG9vbGJhcik7XHJcblxyXG4gICAgICAgIC8vIFNldHVwIEJ1dHRvbnNcclxuICAgICAgICB0aGlzLl9kZWZpbmVBbGlnbm1lbnRzKCk7XHJcbiAgICAgICAgdGhpcy5fYWRkVG9vbGJhckJ1dHRvbnMoKTtcclxuICAgIH07XHJcblxyXG4gICAgLy8gVGhlIHRvb2xiYXIgYW5kIGl0cyBjaGlsZHJlbiB3aWxsIGJlIGRlc3Ryb3llZCB3aGVuIHRoZSBvdmVybGF5IGlzIHJlbW92ZWRcclxuICAgIG9uRGVzdHJveSA9ICgpID0+IHt9O1xyXG5cclxuICAgIC8vIE5vdGhpbmcgdG8gdXBkYXRlIG9uIGRyYWcgYmVjYXVzZSB3ZSBhcmUgYXJlIHBvc2l0aW9uZWQgcmVsYXRpdmUgdG8gdGhlIG92ZXJsYXlcclxuICAgIG9uVXBkYXRlID0gKCkgPT4ge307XHJcblxyXG4gICAgX2RlZmluZUFsaWdubWVudHMgPSAoKSA9PiB7XHJcbiAgICAgICAgdGhpcy5hbGlnbm1lbnRzID0gW1xyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpY29uOiBgPHN2ZyB2aWV3Ym94PVwiMCAwIDE4IDE4XCI+XHJcbiAgICAgICAgICAgICAgICA8bGluZSBjbGFzcz1cInFsLXN0cm9rZVwiIHgxPVwiM1wiIHgyPVwiMTVcIiB5MT1cIjlcIiB5Mj1cIjlcIj48L2xpbmU+XHJcbiAgICAgICAgICAgICAgICA8bGluZSBjbGFzcz1cInFsLXN0cm9rZVwiIHgxPVwiM1wiIHgyPVwiMTNcIiB5MT1cIjE0XCIgeTI9XCIxNFwiPjwvbGluZT5cclxuICAgICAgICAgICAgICAgIDxsaW5lIGNsYXNzPVwicWwtc3Ryb2tlXCIgeDE9XCIzXCIgeDI9XCI5XCIgeTE9XCI0XCIgeTI9XCI0XCI+PC9saW5lPlxyXG4gICAgICAgICAgICAgIDwvc3ZnPmAsXHJcbiAgICAgICAgICAgICAgICBhcHBseTogKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIERpc3BsYXlTdHlsZS5hZGQodGhpcy5pbWcsICdpbmxpbmUnKTtcclxuICAgICAgICAgICAgICAgICAgICBGbG9hdFN0eWxlLmFkZCh0aGlzLmltZywgJ2xlZnQnKTtcclxuICAgICAgICAgICAgICAgICAgICBNYXJnaW5TdHlsZS5hZGQodGhpcy5pbWcsICcwIDFlbSAxZW0gMCcpO1xyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIGlzQXBwbGllZDogKCkgPT4gRmxvYXRTdHlsZS52YWx1ZSh0aGlzLmltZykgPT0gJ2xlZnQnXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGljb246IGA8c3ZnIHZpZXdib3g9XCIwIDAgMTggMThcIj5cclxuICAgICAgICAgICAgICAgIDxsaW5lIGNsYXNzPVwicWwtc3Ryb2tlXCIgeDE9XCIxNVwiIHgyPVwiM1wiIHkxPVwiOVwiIHkyPVwiOVwiPjwvbGluZT5cclxuICAgICAgICAgICAgICAgIDxsaW5lIGNsYXNzPVwicWwtc3Ryb2tlXCIgeDE9XCIxNFwiIHgyPVwiNFwiIHkxPVwiMTRcIiB5Mj1cIjE0XCI+PC9saW5lPlxyXG4gICAgICAgICAgICAgICAgPGxpbmUgY2xhc3M9XCJxbC1zdHJva2VcIiB4MT1cIjEyXCIgeDI9XCI2XCIgeTE9XCI0XCIgeTI9XCI0XCI+PC9saW5lPlxyXG4gICAgICAgICAgICAgIDwvc3ZnPmAsXHJcbiAgICAgICAgICAgICAgICBhcHBseTogKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIERpc3BsYXlTdHlsZS5hZGQodGhpcy5pbWcsICdibG9jaycpO1xyXG4gICAgICAgICAgICAgICAgICAgIEZsb2F0U3R5bGUucmVtb3ZlKHRoaXMuaW1nKTtcclxuICAgICAgICAgICAgICAgICAgICBNYXJnaW5TdHlsZS5hZGQodGhpcy5pbWcsICdhdXRvJyk7XHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgaXNBcHBsaWVkOiAoKSA9PiBNYXJnaW5TdHlsZS52YWx1ZSh0aGlzLmltZykgPT0gJ2F1dG8nXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGljb246IGA8c3ZnIHZpZXdib3g9XCIwIDAgMTggMThcIj5cclxuICAgICAgICAgICAgICAgIDxsaW5lIGNsYXNzPVwicWwtc3Ryb2tlXCIgeDE9XCIxNVwiIHgyPVwiM1wiIHkxPVwiOVwiIHkyPVwiOVwiPjwvbGluZT5cclxuICAgICAgICAgICAgICAgIDxsaW5lIGNsYXNzPVwicWwtc3Ryb2tlXCIgeDE9XCIxNVwiIHgyPVwiNVwiIHkxPVwiMTRcIiB5Mj1cIjE0XCI+PC9saW5lPlxyXG4gICAgICAgICAgICAgICAgPGxpbmUgY2xhc3M9XCJxbC1zdHJva2VcIiB4MT1cIjE1XCIgeDI9XCI5XCIgeTE9XCI0XCIgeTI9XCI0XCI+PC9saW5lPlxyXG4gICAgICAgICAgICAgIDwvc3ZnPmAsXHJcbiAgICAgICAgICAgICAgICBhcHBseTogKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIERpc3BsYXlTdHlsZS5hZGQodGhpcy5pbWcsICdpbmxpbmUnKTtcclxuICAgICAgICAgICAgICAgICAgICBGbG9hdFN0eWxlLmFkZCh0aGlzLmltZywgJ3JpZ2h0Jyk7XHJcbiAgICAgICAgICAgICAgICAgICAgTWFyZ2luU3R5bGUuYWRkKHRoaXMuaW1nLCAnMCAwIDFlbSAxZW0nKTtcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBpc0FwcGxpZWQ6ICgpID0+IEZsb2F0U3R5bGUudmFsdWUodGhpcy5pbWcpID09ICdyaWdodCdcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIF07XHJcbiAgICB9O1xyXG5cclxuICAgIF9hZGRUb29sYmFyQnV0dG9ucyA9ICgpID0+IHtcclxuICAgICAgICBjb25zdCBidXR0b25zID0gW107XHJcbiAgICAgICAgdGhpcy5hbGlnbm1lbnRzLmZvckVhY2goKGFsaWdubWVudCwgaWR4KSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGJ1dHRvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKTtcclxuICAgICAgICAgICAgYnV0dG9ucy5wdXNoKGJ1dHRvbik7XHJcbiAgICAgICAgICAgIGJ1dHRvbi5pbm5lckhUTUwgPSBhbGlnbm1lbnQuaWNvbjtcclxuICAgICAgICAgICAgYnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgLy8gZGVzZWxlY3QgYWxsIGJ1dHRvbnNcclxuICAgICAgICAgICAgICAgIGJ1dHRvbnMuZm9yRWFjaChidXR0b24gPT4gKGJ1dHRvbi5zdHlsZS5maWx0ZXIgPSAnJykpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGFsaWdubWVudC5pc0FwcGxpZWQoKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIElmIGFwcGxpZWQsIHVuYXBwbHlcclxuICAgICAgICAgICAgICAgICAgICBGbG9hdFN0eWxlLnJlbW92ZSh0aGlzLmltZyk7XHJcbiAgICAgICAgICAgICAgICAgICAgTWFyZ2luU3R5bGUucmVtb3ZlKHRoaXMuaW1nKTtcclxuICAgICAgICAgICAgICAgICAgICBEaXNwbGF5U3R5bGUucmVtb3ZlKHRoaXMuaW1nKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gb3RoZXJ3aXNlLCBzZWxlY3QgYnV0dG9uIGFuZCBhcHBseVxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3NlbGVjdEJ1dHRvbihidXR0b24pO1xyXG4gICAgICAgICAgICAgICAgICAgIGFsaWdubWVudC5hcHBseSgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgLy8gaW1hZ2UgbWF5IGNoYW5nZSBwb3NpdGlvbjsgcmVkcmF3IGRyYWcgaGFuZGxlc1xyXG4gICAgICAgICAgICAgICAgdGhpcy5yZXF1ZXN0VXBkYXRlKCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBPYmplY3QuYXNzaWduKGJ1dHRvbi5zdHlsZSwgdGhpcy5vcHRpb25zLnRvb2xiYXJCdXR0b25TdHlsZXMpO1xyXG4gICAgICAgICAgICBpZiAoaWR4ID4gMCkge1xyXG4gICAgICAgICAgICAgICAgYnV0dG9uLnN0eWxlLmJvcmRlckxlZnRXaWR0aCA9ICcwJztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBPYmplY3QuYXNzaWduKFxyXG4gICAgICAgICAgICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm9iamVjdC1saXRlcmFsLWtleS1xdW90ZXNcclxuICAgICAgICAgICAgICAgIGJ1dHRvbi5jaGlsZHJlblswXVsnc3R5bGUnXSxcclxuICAgICAgICAgICAgICAgIHRoaXMub3B0aW9ucy50b29sYmFyQnV0dG9uU3ZnU3R5bGVzXHJcbiAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgIGlmIChhbGlnbm1lbnQuaXNBcHBsaWVkKCkpIHtcclxuICAgICAgICAgICAgICAgIC8vIHNlbGVjdCBidXR0b24gaWYgcHJldmlvdXNseSBhcHBsaWVkXHJcbiAgICAgICAgICAgICAgICB0aGlzLl9zZWxlY3RCdXR0b24oYnV0dG9uKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLnRvb2xiYXIuYXBwZW5kQ2hpbGQoYnV0dG9uKTtcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcblxyXG4gICAgX3NlbGVjdEJ1dHRvbiA9IGJ1dHRvbiA9PiB7XHJcbiAgICAgICAgYnV0dG9uLnN0eWxlLmZpbHRlciA9ICdpbnZlcnQoMjAlKSc7XHJcbiAgICB9O1xyXG59XHJcbiJdfQ==
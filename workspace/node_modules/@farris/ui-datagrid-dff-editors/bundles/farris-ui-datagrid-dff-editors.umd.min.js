!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/common"),require("@angular/forms"),require("@farris/ui-forms"),require("@farris/ui-employee-selector"),require("@farris/ui-adminorganization-selector"),require("@angular/core"),require("@farris/ui-common"),require("@farris/ui-datagrid"),require("@farris/ui-datagrid-editors"),require("lodash-es")):"function"==typeof define&&define.amd?define("@farris/ui-datagrid-dff-editors",["exports","@angular/common","@angular/forms","@farris/ui-forms","@farris/ui-employee-selector","@farris/ui-adminorganization-selector","@angular/core","@farris/ui-common","@farris/ui-datagrid","@farris/ui-datagrid-editors","lodash-es"],t):t((e.farris=e.farris||{},e.farris["ui-datagrid-dff-editors"]={}),e.ng.common,e.ng.forms,e.uiForms,e.uiEmployeeSelector,e.uiAdminorganizationSelector,e.ng.core,e.uiCommon,e.uiDatagrid,e.uiDatagridEditors,e._)}(this,function(e,t,i,n,o,r,a,s,l,c,d){"use strict";var p=(u.decorators=[{type:a.Injectable,args:[{providedIn:"root"}]}],u.ctorParameters=function(){return[]},u.ngInjectableDef=a.defineInjectable({factory:function(){return new u},token:u,providedIn:"root"}),u);function u(){}var m=(f.prototype.ngOnInit=function(){},f.decorators=[{type:a.Component,args:[{selector:"farris-datagrid-dff-editors",template:"\n    <p>\n      datagrid-dff-editors works!\n    </p>\n  "}]}],f.ctorParameters=function(){return[]},f);function f(){}var g=function(e,t){return(g=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)};function h(e,t){function i(){this.constructor=e}g(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}var y,v={absOrgType:"System_organization",readonly:!1,placeholder:"请选择",viewType:"tag",busNum:"common",idField:"userId"},D=(h(b,y=c.DatagridBaseEditorDirective),b.prototype.ngOnInit=function(){y.prototype.ngOnInit.call(this),this.options=Object.assign({},v,d.omitBy(this.options,function(e){return d.isUndefined(e)||d.isNull(e)})),this.instance.selectedData=new a.EventEmitter,this.instance.clear=new a.EventEmitter},b.prototype.ngAfterViewInit=function(){var t=this;this.inputElement=this.el.nativeElement,y.prototype.ngAfterViewInit.call(this),this.instance.ngControl&&this.instance.ngControl.formDirective&&this.instance.ngControl.formDirective.form&&this.instance.ngControl.formDirective.form.bindingData&&(this.bindingData=this.instance.ngControl.formDirective.form.bindingData,this.bindingData.setValue=function(e){return t.utils.setValue(e.join("."),t.bindingData,!0)},this.bindingData.getValue=function(e){return t.utils.getValue(e.join("."),t.bindingData,!0)})},b.prototype.inputClear=function(){this.updateControlValue(null),this.instance.clear.emit(),this.options.inputClear&&this.options.inputClear()},b.prototype.tagRemoved=function(n){var o=this,r=this.instance.mapFields,e=Object.keys(r),a=d.cloneDeep(this.bindingData),s=[];e.forEach(function(i){var e=o.utils.getValue(r[i],a),t=e.split(",");t.splice(n.deleteIndex,1),t.forEach(function(e,t){s[t]||s.push({index:t}),s[t][i]=e}),e=t.join(","),o.utils.setValue(o.bindingData,r[i],e)}),s.length?this.instance.selectedData.emit(s):this.instance.clear.emit(),this.options.tagRemoved&&this.options.tagRemoved(this.eventPrams(n))},b.prototype.selectionsChange=function(e){var t=this.formSelectedRowData();this.updateControlValue(t),this.instance.selectedData.emit(t),this.options.selectionsChange&&this.options.selectionsChange(this.eventPrams(e))},b.prototype.updateControlValue=function(e){this.instance.mapFields&&this.bindingData&&this.lookupFieldMap(e,this.instance.mapFields,this.bindingData)},b.prototype.formSelectedRowData=function(){var n=this,o=[];return this.instance.selections.forEach(function(e){var t=n.instance.displayField?e[n.instance.displayField]:"["+e.code+"]"+e.name,i=n.instance.formatFn?n.instance.formatFn(e):t;o.push(Object.assign({},e,{displayName:i}))}),o.length?o:null},b.prototype.eventPrams=function(e){var t=this.eventParams(e);return t.instance=this.instance,t.editor=this,t},b.decorators=[{type:a.Component,args:[{selector:"farris-grid-employee-selector",template:'<div [formGroup]="group" class="f-datagrid-cell-formgroup farris-group-auto">\r\n    <farris-employee-selector #selection style="width: 100%"\r\n      [placeholder]="options.placeholder" [enableQuick]="false" [readonly]="options.readonly" [absOrgType]="options.absOrgType"\r\n      [viewType]="options.viewType" [multiSelect]="options.multiSelect" [busNum]="options.busNum" [mapFields]="options.mapFields"\r\n      [formatFn]="options.formatter" [formControlName]="column.field" [idField]="options.idField" [displayField]="options.textField"\r\n      [showTabIds]="options.showTabIds" [enableHierarchicalLoading]="options.enableHierarchicalLoading" [filterId]="options.filterId"\r\n      (inputClear)="inputClear()" (selectionsChange)="selectionsChange($event)" (tagRemoved)="tagRemoved($event)">\r\n    </farris-employee-selector>\r\n</div>'}]}],b.ctorParameters=function(){return[{type:a.Renderer2},{type:a.ElementRef},{type:s.RuntimeStateService},{type:s.CommonUtils},{type:a.Injector}]},b.propDecorators={instance:[{type:a.ViewChild,args:["selection"]}]},b);function b(e,t,i,n,o){var r=y.call(this,e,t,o)||this;return r.rts=i,r.utils=n,r.lookupFieldMap=function(e,n,o){n&&Object.keys(n).forEach(function(t){var i="";e&&(i=e instanceof Array?e.map(function(e){return r.utils.getValue(t,e)}).join(","):r.utils.getValue(t,e)),n[t].split(",").forEach(function(e){var t=d.trim(e);r.utils.setValue(o,t,i)})})},r}var C,E={provide:l.GRID_EDITORS,useValue:{name:"EmployeeSelector",value:D},multi:!0},F={absOrgType:"System_organization",readonly:!1,placeholder:"请选择",busNum:"common",primaryField:"orgId",displayField:"name"},I=(h(V,C=c.DatagridBaseEditorDirective),V.prototype.ngOnInit=function(){C.prototype.ngOnInit.call(this),this.options=Object.assign({},F,d.omitBy(this.options,function(e){return d.isUndefined(e)||d.isNull(e)})),this.instance.selectedData=new a.EventEmitter,this.instance.clear=new a.EventEmitter},V.prototype.ngAfterViewInit=function(){var t=this;this.inputElement=this.el.nativeElement,C.prototype.ngAfterViewInit.call(this),this.instance.ngControl&&this.instance.ngControl.formDirective&&this.instance.ngControl.formDirective.form&&this.instance.ngControl.formDirective.form.bindingData&&(this.bindingData=this.instance.ngControl.formDirective.form.bindingData,this.bindingData.setValue=function(e){return t.utils.setValue(e.join("."),t.bindingData,!0)},this.bindingData.getValue=function(e){return t.utils.getValue(e.join("."),t.bindingData,!0)})},V.prototype.updateControlValue=function(e){this.instance.mapFields&&this.bindingData&&this.lookupFieldMap(e,this.instance.mapFields,this.bindingData)},V.prototype.inputClear=function(){this.updateControlValue(null),this.instance.clear.emit(),this.options.inputClear&&this.options.inputClear()},V.prototype.tagRemoved=function(n){var o=this,r=this.instance.mapFields,e=Object.keys(r),a=d.cloneDeep(this.bindingData),s=[];e.forEach(function(i){var e=o.utils.getValue(r[i],a),t=e.split(",");t.splice(n.deleteIndex,1),t.forEach(function(e,t){s[t]||s.push({index:t}),s[t][i]=e}),e=t.join(","),o.utils.setValue(o.bindingData,r[i],e)}),s.length?this.instance.selectedData.emit(s):this.instance.clear.emit(),this.options.tagRemoved&&this.options.tagRemoved(this.eventPrams(n))},V.prototype.selectionsChange=function(e){var t=this.formSelectedRowData();this.updateControlValue(t),this.instance.selectedData.emit(t),this.options.selectionsChange&&this.options.selectionsChange(this.eventPrams(e))},V.prototype.formSelectedRowData=function(){var n=this,o=[];return this.instance.selections.forEach(function(e){var t=n.instance.displayField?e[n.instance.displayField]:""+e.name,i=n.instance.formatFn?n.instance.formatFn(e):t;o.push(Object.assign({},e,{displayName:i}))}),o.length?o:null},V.prototype.eventPrams=function(e){var t=this.eventParams(e);return t.instance=this.instance,t.editor=this,t},V.decorators=[{type:a.Component,args:[{selector:"farris-grid-adminorganization-selector",template:'<div [formGroup]="group" class="f-datagrid-cell-formgroup farris-group-auto">\r\n    <farris-adminorganization-selector #orgSelection style="width: 100%"\r\n      [placeholder]="options.placeholder" [readonly]="options.readonly" [absOrgType]="options.absOrgType" [multiSelect]="options.multiSelect"\r\n      [mapFields]="options.mapFields" [formControlName]="column.field" [primaryField]="options.primaryField" [displayField]="options.displayField"\r\n      [formatFn]="options.formatter" [layer]="options.expandLevel" [enableHierarchicalLoading]="options.enableHierarchicalLoading"\r\n      [cascadeCheck]="options.cascadeCheck" [cascadeDown]="options.cascadeDown" [cascadeUp]="options.cascadeUp"\r\n      [showTabIds]="options.showTabIds" [activeTabId]="options.activeTabId" [busNum]="options.busNum"\r\n      (inputClear)="inputClear()" (selectionsChange)="selectionsChange($event)" (tagRemoved)="tagRemoved($event)">\r\n    </farris-adminorganization-selector>\r\n</div>'}]}],V.ctorParameters=function(){return[{type:a.Renderer2},{type:a.ElementRef},{type:s.RuntimeStateService},{type:s.CommonUtils},{type:a.Injector}]},V.propDecorators={instance:[{type:a.ViewChild,args:["orgSelection"]}]},V);function V(e,t,i,n,o){var r=C.call(this,e,t,o)||this;return r.rts=i,r.utils=n,r.lookupFieldMap=function(e,n,o){n&&Object.keys(n).forEach(function(t){var i="";e&&(i=e instanceof Array?e.map(function(e){return r.utils.getValue(t,e)}).join(","):r.utils.getValue(t,e)),n[t].split(",").forEach(function(e){var t=d.trim(e);r.utils.setValue(o,t,i)})})},r}var O={provide:l.GRID_EDITORS,useValue:{name:"AdminOrganizationSelector",value:I},multi:!0},w=(S.decorators=[{type:a.NgModule,args:[{declarations:[m,D,I],imports:[t.CommonModule,i.FormsModule,i.ReactiveFormsModule,l.DatagridModule,c.DatagridEditorsModule,n.FarrisFormsModule,o.EmployeeSelectorModule,r.AdminOrganizationSelectorModule],providers:[],entryComponents:[D,I],exports:[m,D,I]}]}],S);function S(){}e.DatagridDffEditorsService=p,e.DatagridDffEditorsComponent=m,e.DatagridDffEditorsModule=w,e.DatagridEmployeeSelectorComponent=D,e.EmployeeSelectorDataGridEditorProvider=E,e.DataGridAdminOrganizationSelectorComponent=I,e.AdminOrganizationSelectorDataGridEditorProvider=O,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=farris-ui-datagrid-dff-editors.umd.min.js.map
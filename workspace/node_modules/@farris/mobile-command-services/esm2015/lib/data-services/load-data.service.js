/**
 * @fileoverview added by tsickle
 * Generated from: lib/data-services/load-data.service.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { tap } from 'rxjs/operators';
import { BaseDataService } from './base-data.service';
import { DataUtil } from './data-util';
export class LoadDataService extends BaseDataService {
    /**
     * @param {?} viewModelContext
     */
    constructor(viewModelContext) {
        super(viewModelContext);
    }
    /**
     * 加载列表数据
     * @param {?} filters
     * @param {?} sorts
     * @param {?=} size
     * @param {?=} index
     * @return {?}
     */
    loadForList(filters, sorts, size, index) {
        if (typeof filters === 'string') {
            filters = DataUtil.stringTransformArray(filters);
        }
        if (typeof sorts === 'string') {
            sorts = DataUtil.stringTransformArray(sorts);
        }
        let { pageSize, pageIndex } = this.viewModelContext.repository.paginationInfo || { pageSize: null, pageIndex: null };
        this.loadingService.show();
        if (!size && !pageSize) {
            pageSize = 20;
        }
        else if (size) {
            pageSize = size;
        }
        if (!index && !pageIndex) {
            pageIndex = 1;
        }
        else if (index) {
            pageIndex = index;
        }
        if (pageIndex === 1) {
            this.befRepository.entityCollection.clear();
        }
        /** @type {?} */
        const query$ = this.befRepository.getEntities(filters, sorts, pageSize, pageIndex);
        return query$.pipe(tap((/**
         * @return {?}
         */
        () => {
            let { pageIndex, pageCount, totalCount } = this.viewModelContext.repository.paginationInfo;
            if (pageIndex === pageCount || totalCount === 0) {
                this.viewModelContext.appContext.eventBus.triggerEvent({ type: 'listviewFinished' });
            }
            else {
                this.viewModelContext.appContext.eventBus.triggerEvent({ type: 'listviewUnFinished' });
            }
            this.viewModelContext.appContext.eventBus.triggerEvent({ type: 'loadDataFinished' });
            this.loadingService.hide();
        }), (/**
         * @param {?} exception
         * @return {?}
         */
        (exception) => {
            this.loadingService.hide();
        })));
    }
    /**
     * 加载卡片数据
     * @param {?} id
     * @return {?}
     */
    loadForCard(id) {
        DataUtil.clearFromValidateType(this.viewModelContext);
        this.loadingService.show();
        /** @type {?} */
        const get$ = this.befRepository.getEntityById(id);
        return get$.pipe(tap((/**
         * @return {?}
         */
        () => {
            this.loadingService.hide();
        }), (/**
         * @param {?} exception
         * @return {?}
         */
        (exception) => {
            this.loadingService.hide();
        })));
    }
    /**
     * 加载进入子表后，未作任何操作之前的数据
     * @param {?} path 子表路径
     * @return {?}
     */
    loadDataForChildCard(path) {
        /** @type {?} */
        const childID = this.viewModelContext.bindingData[path]['id'];
        /** @type {?} */
        const id = this.viewModelContext.bindingData[path]['parentID'];
        /** @type {?} */
        const entity = this.viewModelContext.repository.entityCollection.getEntityById(id);
        /** @type {?} */
        const childEntityAll = entity[path];
        /** @type {?} */
        const childEntityData = childEntityAll.get(childID).data;
        this.viewModelContext.uiState.setPropertyValue('$childEntity', Object.assign({}, childEntityData));
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibG9hZC1kYXRhLnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL21vYmlsZS1jb21tYW5kLXNlcnZpY2VzLyIsInNvdXJjZXMiOlsibGliL2RhdGEtc2VydmljZXMvbG9hZC1kYXRhLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFDQSxPQUFPLEVBQWEsR0FBRyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFHaEQsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQ3RELE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSxhQUFhLENBQUM7QUFFdkMsTUFBTSxPQUFPLGVBQWdCLFNBQVEsZUFBZTs7OztJQUVsRCxZQUFZLGdCQUFrQztRQUM1QyxLQUFLLENBQUMsZ0JBQWdCLENBQUMsQ0FBQztJQUMxQixDQUFDOzs7Ozs7Ozs7SUFLTSxXQUFXLENBQUMsT0FBYyxFQUFFLEtBQVksRUFBRSxJQUFhLEVBQUUsS0FBYztRQUM1RSxJQUFJLE9BQU8sT0FBTyxLQUFLLFFBQVEsRUFBRTtZQUMvQixPQUFPLEdBQUcsUUFBUSxDQUFDLG9CQUFvQixDQUFDLE9BQU8sQ0FBQyxDQUFDO1NBQ2xEO1FBQ0QsSUFBSSxPQUFPLEtBQUssS0FBSyxRQUFRLEVBQUU7WUFDN0IsS0FBSyxHQUFHLFFBQVEsQ0FBQyxvQkFBb0IsQ0FBQyxLQUFLLENBQUMsQ0FBQztTQUM5QztZQUNHLEVBQUUsUUFBUSxFQUFFLFNBQVMsRUFBRSxHQUFHLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxVQUFVLENBQUMsY0FBYyxJQUFJLEVBQUUsUUFBUSxFQUFFLElBQUksRUFBRSxTQUFTLEVBQUUsSUFBSSxFQUFFO1FBQ3BILElBQUksQ0FBQyxjQUFjLENBQUMsSUFBSSxFQUFFLENBQUM7UUFFM0IsSUFBSSxDQUFDLElBQUksSUFBSSxDQUFDLFFBQVEsRUFBRTtZQUN0QixRQUFRLEdBQUcsRUFBRSxDQUFDO1NBQ2Y7YUFBTSxJQUFJLElBQUksRUFB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QUM7Q0FDRiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE9ic2VydmFibGUsIG9mLCBFTVBUWSB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQgeyBzd2l0Y2hNYXAsIHRhcCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcclxuaW1wb3J0IHsgRW50aXR5LCBWaWV3TW9kZWxDb250ZXh0IH0gZnJvbSAnQGZhcnJpcy9tb2JpbGUtZGV2a2l0JztcclxuaW1wb3J0IHsgQmVmUmVwb3NpdG9yeSB9IGZyb20gJ0BmYXJyaXMvbW9iaWxlLWJlZic7XHJcbmltcG9ydCB7IEJhc2VEYXRhU2VydmljZSB9IGZyb20gJy4vYmFzZS1kYXRhLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBEYXRhVXRpbCB9IGZyb20gJy4vZGF0YS11dGlsJztcclxuXHJcbmV4cG9ydCBjbGFzcyBMb2FkRGF0YVNlcnZpY2UgZXh0ZW5kcyBCYXNlRGF0YVNlcnZpY2Uge1xyXG5cclxuICBjb25zdHJ1Y3Rvcih2aWV3TW9kZWxDb250ZXh0OiBWaWV3TW9kZWxDb250ZXh0KSB7XHJcbiAgICBzdXBlcih2aWV3TW9kZWxDb250ZXh0KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOWKoOi9veWIl+ihqOaVsOaNrlxyXG4gICAqL1xyXG4gIHB1YmxpYyBsb2FkRm9yTGlzdChmaWx0ZXJzOiBhbnlbXSwgc29ydHM6IGFueVtdLCBzaXplPzogbnVtYmVyLCBpbmRleD86IG51bWJlcik6IE9ic2VydmFibGU8RW50aXR5W10+IHtcclxuICAgIGlmICh0eXBlb2YgZmlsdGVycyA9PT0gJ3N0cmluZycpIHtcclxuICAgICAgZmlsdGVycyA9IERhdGFVdGlsLnN0cmluZ1RyYW5zZm9ybUFycmF5KGZpbHRlcnMpO1xyXG4gICAgfVxyXG4gICAgaWYgKHR5cGVvZiBzb3J0cyA9PT0gJ3N0cmluZycpIHtcclxuICAgICAgc29ydHMgPSBEYXRhVXRpbC5zdHJpbmdUcmFuc2Zvcm1BcnJheShzb3J0cyk7XHJcbiAgICB9XHJcbiAgICBsZXQgeyBwYWdlU2l6ZSwgcGFnZUluZGV4IH0gPSB0aGlzLnZpZXdNb2RlbENvbnRleHQucmVwb3NpdG9yeS5wYWdpbmF0aW9uSW5mbyB8fCB7IHBhZ2VTaXplOiBudWxsLCBwYWdlSW5kZXg6IG51bGwgfTtcclxuICAgIHRoaXMubG9hZGluZ1NlcnZpY2Uuc2hvdygpO1xyXG5cclxuICAgIGlmICghc2l6ZSAmJiAhcGFnZVNpemUpIHtcclxuICAgICAgcGFnZVNpemUgPSAyMDtcclxuICAgIH0gZWxzZSBpZiAoc2l6ZSkge1xyXG4gICAgICBwYWdlU2l6ZSA9IHNpemU7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKCFpbmRleCAmJiAhcGFnZUluZGV4KSB7XHJcbiAgICAgIHBhZ2VJbmRleCA9IDE7XHJcbiAgICB9IGVsc2UgaWYgKGluZGV4KSB7XHJcbiAgICAgIHBhZ2VJbmRleCA9IGluZGV4O1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChwYWdlSW5kZXggPT09IDEpIHtcclxuICAgICAgdGhpcy5iZWZSZXBvc2l0b3J5LmVudGl0eUNvbGxlY3Rpb24uY2xlYXIoKTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBxdWVyeSQgPSB0aGlzLmJlZlJlcG9zaXRvcnkuZ2V0RW50aXRpZXMoZmlsdGVycywgc29ydHMsIHBhZ2VTaXplLCBwYWdlSW5kZXgpO1xyXG4gICAgcmV0dXJuIHF1ZXJ5JC5waXBlKFxyXG4gICAgICB0YXAoXHJcbiAgICAgICAgKCkgPT4ge1xyXG4gICAgICAgICAgbGV0IHsgcGFnZUluZGV4LCBwYWdlQ291bnQsIHRvdGFsQ291bnQgfSA9IHRoaXMudmlld01vZGVsQ29udGV4dC5yZXBvc2l0b3J5LnBhZ2luYXRpb25JbmZvO1xyXG4gICAgICAgICAgaWYgKHBhZ2VJbmRleCA9PT0gcGFnZUNvdW50IHx8IHRvdGFsQ291bnQgPT09IDApIHtcclxuICAgICAgICAgICAgdGhpcy52aWV3TW9kZWxDb250ZXh0LmFwcENvbnRleHQuZXZlbnRCdXMudHJpZ2dlckV2ZW50KHsgdHlwZTogJ2xpc3R2aWV3RmluaXNoZWQnIH0pXHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLnZpZXdNb2RlbENvbnRleHQuYXBwQ29udGV4dC5ldmVudEJ1cy50cmlnZ2VyRXZlbnQoeyB0eXBlOiAnbGlzdHZpZXdVbkZpbmlzaGVkJyB9KVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgdGhpcy52aWV3TW9kZWxDb250ZXh0LmFwcENvbnRleHQuZXZlbnRCdXMudHJpZ2dlckV2ZW50KHsgdHlwZTogJ2xvYWREYXRhRmluaXNoZWQnIH0pXHJcbiAgICAgICAgICB0aGlzLmxvYWRpbmdTZXJ2aWNlLmhpZGUoKTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIChleGNlcHRpb246IGFueSkgPT4ge1xyXG4gICAgICAgICAgdGhpcy5sb2FkaW5nU2VydmljZS5oaWRlKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICApXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5Yqg6L295Y2h54mH5pWw5o2uXHJcbiAgICovXHJcbiAgcHVibGljIGxvYWRGb3JDYXJkKGlkOiBzdHJpbmcpOiBPYnNlcnZhYmxlPEVudGl0eT4ge1xyXG4gICAgRGF0YVV0aWwuY2xlYXJGcm9tVmFsaWRhdGVUeXBlKHRoaXMudmlld01vZGVsQ29udGV4dCk7XHJcbiAgICB0aGlzLmxvYWRpbmdTZXJ2aWNlLnNob3coKTtcclxuICAgIGNvbnN0IGdldCQgPSB0aGlzLmJlZlJlcG9zaXRvcnkuZ2V0RW50aXR5QnlJZChpZCk7XHJcbiAgICByZXR1cm4gZ2V0JC5waXBlKFxyXG4gICAgICB0YXAoXHJcbiAgICAgICAgKCkgPT4ge1xyXG4gICAgICAgICAgdGhpcy5sb2FkaW5nU2VydmljZS5oaWRlKCk7XHJcbiAgICAgICAgfSxcclxuICAgICAgICAoZXhjZXB0aW9uOiBhbnkpID0+IHtcclxuICAgICAgICAgIHRoaXMubG9hZGluZ1NlcnZpY2UuaGlkZSgpO1xyXG4gICAgICAgIH1cclxuICAgICAgKVxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gKiDliqDovb3ov5vlhaXlrZDooajlkI7vvIzmnKrkvZzku7vkvZXmk43kvZzkuYvliY3nmoTmlbDmja5cclxuICogQHBhcmFtIHBhdGgg5a2Q6KGo6Lev5b6EXHJcbiAqL1xyXG4gIHB1YmxpYyBsb2FkRGF0YUZvckNoaWxkQ2FyZChwYXRoOiBzdHJpbmcpIHtcclxuICAgIGNvbnN0IGNoaWxkSUQgPSB0aGlzLnZpZXdNb2RlbENvbnRleHQuYmluZGluZ0RhdGFbcGF0aF1bJ2lkJ107XHJcbiAgICBjb25zdCBpZCA9IHRoaXMudmlld01vZGVsQ29udGV4dC5iaW5kaW5nRGF0YVtwYXRoXVsncGFyZW50SUQnXTtcclxuICAgIGNvbnN0IGVudGl0eSA9IHRoaXMudmlld01vZGVsQ29udGV4dC5yZXBvc2l0b3J5LmVudGl0eUNvbGxlY3Rpb24uZ2V0RW50aXR5QnlJZChpZClcclxuICAgIGNvbnN0IGNoaWxkRW50aXR5QWxsID0gZW50aXR5W3BhdGhdO1xyXG4gICAgY29uc3QgY2hpbGRFbnRpdHlEYXRhID0gY2hpbGRFbnRpdHlBbGwuZ2V0KGNoaWxkSUQpLmRhdGE7XHJcbiAgICB0aGlzLnZpZXdNb2RlbENvbnRleHQudWlTdGF0ZS5zZXRQcm9wZXJ0eVZhbHVlKCckY2hpbGRFbnRpdHknLCB7IC4uLmNoaWxkRW50aXR5RGF0YSB9KTtcclxuICB9XHJcbn1cclxuIl19
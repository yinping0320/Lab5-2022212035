/**
 * @fileoverview added by tsickle
 * Generated from: lib/js-bridge-service/js-bridge-stratege.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { JsBridgeStrategyFactory } from './js-bridge-strategy-factory';
import { Subject } from 'rxjs';
class JsBridgeService {
    constructor() {
        this.jsBridgeStrategyFactory = new JsBridgeStrategyFactory();
        this.init();
    }
    /**
     * @return {?}
     */
    getSysInfo() {
        return this.getJsBridgeService(this.strategy.getSysInfo);
    }
    /**
     * @private
     * @return {?}
     */
    init() {
        this.strategy = this.jsBridgeStrategyFactory.create();
        window['JsBridgeService'] = this;
    }
    /**
     * @param {?} options
     * @return {?}
     */
    takePhoto(options) {
        return this.getJsBridgeService(this.strategy.takePhoto, options);
    }
    /**
     * @return {?}
     */
    scanQRCode() {
        return this.getJsBridgeService(this.strategy.scanQRCode);
    }
    /**
     * @return {?}
     */
    getLocation() {
        return this.getJsBridgeService(this.strategy.getLocation);
    }
    /**
     * @param {?} number
     * @param {?} content
     * @return {?}
     */
    sendSMS(number, content) {
        return this.getJsBridgeService(this.strategy.sendSMS, number, content);
    }
    /**
     * @param {?} number
     * @param {?} content
     * @return {?}
     */
    openSendSMS(number, content) {
        return this.getJsBridgeService(this.strategy.openSendSMS, number, content);
    }
    /**
     * @param {?} number
     * @return {?}
     */
    tel(number) {
        return this.getJsBridgeService(this.strategy.tel, number);
    }
    /**
     * @param {?} options
     * @return {?}
     */
    selectPictureFromAlbum(options) {
        return this.getJsBridgeService(this.strategy.selectPictureFromAlbum, options);
    }
    /**
     * @param {?} options
     * @return {?}
     */
    takeVideo(options) {
        return this.getJsBridgeService(this.strategy.takeVideo, options);
    }
    /**
     * @return {?}
     */
    closeWindow() {
        return this.getJsBridgeService(this.strategy.closeWindow);
    }
    /**
     * @param {?} title
     * @return {?}
     */
    setTitles(title) {
        return this.getJsBridgeService(this.strategy.setTitles, title);
    }
    /**
     * @param {?=} options
     * @return {?}
     */
    selectFile(options) {
        return this.getJsBridgeService(this.strategy.selectFile, options);
    }
    /**
     * @param {?} options
     * @return {?}
     */
    downloadFile(options) {
        return this.getJsBridgeService(this.strategy.downloadFile, options);
    }
    /**
     * @param {?=} fn
     * @return {?}
     */
    setOriginGoback(fn) {
        return this.getJsBridgeService(this.strategy.setOriginGoback, fn);
    }
    /**
     * @param {?=} fn
     * @return {?}
     */
    pushOriginGoback(fn) {
        return this.getJsBridgeService(this.strategy.pushOriginGoback, fn);
    }
    /**
     * @param {?=} fn
     * @return {?}
     */
    popOriginGoback(fn) {
        return this.getJsBridgeService(this.strategy.popOriginGoback, fn);
    }
    /**
     * @param {?=} fn
     * @return {?}
     */
    playShortVideo(fn) {
        return this.getJsBridgeService(this.strategy.playShortVideo, fn);
    }
    /**
     * @private
     * @param {?} method
     * @param {...?} values
     * @return {?}
     */
    getJsBridgeService(method, ...values) {
        /** @type {?} */
        const subject = new Subject();
        // 已经存在方法实例即结束返回
        if (window.top['FARRIS_JSBridge'] === '已加载') {
            return method(...values);
        }
        // 判断是否为云上协同环境
        if (window.top['FARRIS_JSBridge'] === '云上协同') {
            if (window.top['iCityBridge']) {
                return method(...values);
            }
            else {
                /** @type {?} */
                var ccwork = window.top.document.createElement("script");
                ccwork.src = 'https://ccwork.oss.cn-north-3.inspurcloudoss.com/h5/ccworkJsbridge.js';
                ccwork.onload = (/**
                 * @return {?}
                 */
                function () {
                    window.top['iCityBridge'].init((/**
                     * @return {?}
                     */
                    () => {
                        method(...values).subscribe((/**
                         * @param {?} e
                         * @return {?}
                         */
                        (e) => { subject.next(e); }));
                    }));
                });
                window.top.document.head.appendChild(ccwork);
            }
        }
        // 当前没有针对云+的判断，前置环境不满足即默认云+环境
        if (window.top['FARRIS_JSBridge'] === '云加') {
            System
                .import('/platform/common/web/imp.js')
                .then((/**
             * @param {?} e
             * @return {?}
             */
            (e) => {
                window.top['FARRIS_JSBridge'] = '已加载';
                method(...values).subscribe((/**
                 * @param {?} e
                 * @return {?}
                 */
                (e) => { subject.next(e); }));
            }));
        }
        return subject;
    }
}
if (false) {
    /**
     * @type {?}
     * @private
     */
    JsBridgeService.prototype.strategy;
    /**
     * @type {?}
     * @private
     */
    JsBridgeService.prototype.jsBridgeStrategyFactory;
}
export { JsBridgeService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoianMtYnJpZGdlLXN0cmF0ZWdlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy9tb2JpbGUtY29tbWFuZC1zZXJ2aWNlcy8iLCJzb3VyY2VzIjpbImxpYi9qcy1icmlkZ2Utc2VydmljZS9qcy1icmlkZ2Utc3RyYXRlZ2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQUUsdUJBQXVCLEVBQUUsTUFBTSw4QkFBOEIsQ0FBQTtBQUV0RSxPQUFPLEVBQWMsT0FBTyxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBSTNDLE1BQU0sZUFBZTtJQUVqQjtRQUNJLElBQUksQ0FBQyx1QkFBdUIsR0FBRyxJQUFJLHVCQUF1QixFQUFFLENBQUM7UUFDN0QsSUFBSSxDQUFDLElBQUksRUFBRSxDQUFDO0lBQ2hCLENBQUM7Ozs7SUFFRCxVQUFVO1FBQ04sT0FBTyxJQUFJLENBQUMsa0JBQWtCLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxVQUFVLENBQUMsQ0FBQztJQUM3RCxDQUFDOzs7OztJQU9PLElBQUk7UUFDUixJQUFJLENBQUMsUUFBUSxHQUFHLElBQUksQ0FBQyx1QkFBdUIsQ0FBQyxNQUFNLEVBQUUsQ0FBQztRQUN0RCxNQUFNLENBQUMsaUJBQWlCLENBQUMsR0FBRyxJQUFJLENBQUE7SUFDcEMsQ0FBQzs7Ozs7SUFFRCxTQUFTLENBQUMsT0FBcUI7UUFDM0IsT0FBTyxJQUFJLENBQUMsa0JBQWtCLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxTQUFTLEVBQUUsT0FBTyxDQUFDLENBQUM7SUFDckUsQ0FBQzs7OztJQUNELFVBQVU7UUFDTixPQUFPLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLFVBQVUsQ0FBQyxDQUFDO0lBQzdELENBQUM7Ozs7SUFDRCxXQUFXO1FBQ1AsT0FBTyxJQUFJLENBQUMsa0JBQWtCLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxXQUFXLENBQUMsQ0FBQztJQUM5RCxDQUFDOzs7Ozs7SUFDRCxPQUFPLENBQUMsTUFBYyxFQUFFLE9BQWU7UUFDbkMsT0FBTyxJQUFJLENBQUMsa0JBQWtCLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxPQUFPLEVBQUUsTUFBTSxFQUFFLE9BQU8sQ0FBQyxDQUFDO0lBQzNFLENBQUM7Ozs7OztJQUNELFdBQVcsQ0FBQyxNQUFjLEVBQUUsT0FBZTtRQUN2QyxPQUFPLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLFdBQVcsRUFBRSxNQUFNLEVBQUUsT0FBTyxDQUFDLENBQUM7SUFDL0UsQ0FBQzs7Ozs7SUFDRCxHQUFHLENBQUMsTUFBYztRQUNkLE9BQU8sSUFBSSxDQUFDLGtCQUFrQixDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsR0FBRyxFQUFFLE1BQU0sQ0FBQyxDQUFDO0lBQzlELENBQUM7Ozs7O0lBQ0Qsc0JBQXNCLENBQUMsT0FBdUI7UUFDMUMsT0FBTyxJQUFJLENBQUMsa0JBQWtCLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxzQkFBc0IsRUFBRSxPQUFPLENBQUMsQ0FBQztJQUNsRixDQUFDOzs7OztJQUNELFNBQVMsQ0FBQyxPQUFxQjtRQUMzQixPQUFPLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLFNBQVMsRUFBRSxPQUFPLENBQUMsQ0FBQztJQUNyRSxDQUFDOzs7O0lBQ0QsV0FBVztRQUNQLE9BQU8sSUFBSSxDQUFDLGtCQUFrQixDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsV0FBVyxDQUFDLENBQUM7SUFDOUQsQ0FBQzs7Ozs7SUFDRCxTQUFTLENBQUMsS0FBYTtRQUNuQixPQUFPLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLFNBQVMsRUFBRSxLQUFLLENBQUMsQ0FBQztJQUNuRSxDQUFDOzs7OztJQUVELFVBQVUsQ0FBQyxPQUFhO1FBQ3BCLE9BQU8sSUFBSSxDQUFDLGtCQUFrQixDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsVUFBVSxFQUFFLE9BQU8sQ0FBQyxDQUFDO0lBQ3RFLENBQUM7Ozs7O0lBRUQsWUFBWSxDQUFDLE9BQVk7UUFDckIsT0FBTyxJQUFJLENBQUMsa0JBQWtCLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxZQUFZLEVBQUUsT0FBTyxDQUFDLENBQUM7SUFDeEUsQ0FBQzs7Ozs7SUFFRCxlQUFlLENBQUMsRUFBUTtRQUNwQixPQUFPLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLGVBQWUsRUFBRSxFQUFFLENBQUMsQ0FBQztJQUN0RSxDQUFDOzs7OztJQUVELGdCQUFnQixDQUFDLEVBQVE7UUFDckIsT0FBTyxJQUFJLENBQUMsa0JBQWtCLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxnQkFBZ0IsRUFBRSxFQUFFLENBQUMsQ0FBQztJQUN2RSxDQUFDOzs7OztJQUNELGVBQWUsQ0FBQyxFQUFRO1FBQ3BCLE9BQU8sSUFBSSxDQUFDLGtCQUFrQixDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsZUFBZSxFQUFFLEVBQUUsQ0FBQyxDQUFDO0lBQ3RFLENBQUM7Ozs7O0lBQ0QsY0FBYyxDQUFDLEVBQVE7UUFDbkIsT0FBTyxJQUFJLENBQUMsa0JBQWtCLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxjQUFjLEVBQUUsRUFBRSxDQUFDLENBQUM7SUFDckUsQ0FBQzs7Ozs7OztJQUdPLGtCQUFrQixDQUFDLE1BQU0sRUFBRSxHQUFHLE1BQU07O2NBQ2xDLE9BQU8sR0FBRyxJQUFJLE9BQU8sRUFBTztRQUVsQyxnQkFBZ0I7UUFDaEIsSUFBSSxNQUFNLENBQUMsR0FBRyxDQUFDLGlCQUFpQixDQUFDLEtBQUssS0FBSyxFQUFFO1lBQ3pDLE9BQU8sTUFBTSxDQUFDLEdBQUcsTUFBTSxDQUFDLENBQUE7U0FDM0I7UUFFRCxjQUFjO1FBQ2QsSUFBSSxNQUFNLENBQUMsR0FBRyxDQUFDLGlCQUFpQixDQUFDLEtBQUssTUFBTSxFQUFFO1lBQzFDLElBQUksTUFBTSxDQUFDLEdBQUcsQ0FBQyxhQUFhLENBQUMsRUFBRTtnQkFDM0IsT0FBTyxNQUFNLENBQUMsR0FBRyxNQUFNLENBQUMsQ0FBQTthQUMzQjtpQkFBTTs7b0JBQ0MsTUFBTSxHQUFHLE1BQU0sQ0FBQyxHQUFHLENBQUMsUUFBUSxDQUFDLGFBQWEsQ0FBQyxRQUFRLENBQUM7Z0JBQ3hELE1BQU0sQ0FBQyxHQUFHLEdBQUcsdUVBQXVFLENBQUE7Z0JBQ3BGLE1BQU0sQ0FBQyxNQUFNOzs7Z0JBQUc7b0JBQ1osTUFBTSxDQUFDLEdBQUcsQ0FBQyxhQUFhLENBQUMsQ0FBQyxJQUFJOzs7b0JBQUMsR0FBRyxFQUFFO3dCQUNoQyxNQUFNLENBQUMsR0FBRyxNQUFNLENBQUMsQ0FBQyxTQUFTOzs7O3dCQUN2QixDQUFDLENBQUMsRUFBRSxFQUFFLEdBQUcsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQSxDQUFDLENBQUMsRUFDN0IsQ0FBQTtvQkFDTCxDQUFDLEVBQUMsQ0FBQTtnQkFDTixDQUFDLENBQUEsQ0FBQztnQkFDRixNQUFNLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLE1BQU0sQ0FBQyxDQUFDO2FBQ2hEO1NBQ0o7UUFFRCw2QkFBNkI7UUFDN0IsSUFBSSxNQUFNLENBQUMsR0FBRyxDQUFDLGlCQUFpQixDQUFDLEtBQUssSUFBSSxFQUFFO1lBQ3hDLE1BQU07aUJBQ0QsTUFBTSxDQUFDLDZCQUE2QixDQUFDO2lCQUNyQyxJQUFJOzs7O1lBQ0QsQ0FBQyxDQUFDLEVBQUUsRUFBRTtnQkFDRixNQUFNLENBQUMsR0FBRyxDQUFDLGlCQUFpQixDQUFDLEdBQUcsS0FBSyxDQUFDO2dCQUN0QyxNQUFNLENBQUMsR0FBRyxNQUFNLENBQUMsQ0FBQyxTQUFTOzs7O2dCQUN2QixDQUFDLENBQUMsRUFBRSxFQUFFLEdBQUcsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQSxDQUFDLENBQUMsRUFDN0IsQ0FBQTtZQUNMLENBQUMsRUFDSixDQUFBO1NBQ1I7UUFDRCxPQUFPLE9BQU8sQ0FBQztJQUNuQixDQUFDO0NBRUo7Ozs7OztJQXpHRyxtQ0FBb0M7Ozs7O0lBRXBDLGtEQUF5RDs7QUF5RzdELE9BQU8sRUFBRSxlQUFlLEVBQUUsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEpzQnJpZGdlU3RyYXRlZ3lGYWN0b3J5IH0gZnJvbSAnLi9qcy1icmlkZ2Utc3RyYXRlZ3ktZmFjdG9yeSdcclxuaW1wb3J0IHsgSUpzQnJpZGdlU3RyYXRlZ3ksIFBpY3R1cmVPcHRpb25zLCBQaG90b09wdGlvbnMsIFZpZGVwT3B0aW9ucyB9IGZyb20gJy4vZGVjb3JhdG9ycyc7XHJcbmltcG9ydCB7IE9ic2VydmFibGUsIFN1YmplY3QgfSBmcm9tICdyeGpzJztcclxuXHJcbmRlY2xhcmUgY29uc3QgU3lzdGVtOiBhbnk7XHJcblxyXG5jbGFzcyBKc0JyaWRnZVNlcnZpY2UgaW1wbGVtZW50cyBJSnNCcmlkZ2VTdHJhdGVneSB7XHJcblxyXG4gICAgY29uc3RydWN0b3IoKSB7XHJcbiAgICAgICAgdGhpcy5qc0JyaWRnZVN0cmF0ZWd5RmFjdG9yeSA9IG5ldyBKc0JyaWRnZVN0cmF0ZWd5RmFjdG9yeSgpO1xyXG4gICAgICAgIHRoaXMuaW5pdCgpO1xyXG4gICAgfVxyXG5cclxuICAgIGdldFN5c0luZm8oKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0SnNCcmlkZ2VTZXJ2aWNlKHRoaXMuc3RyYXRlZ3kuZ2V0U3lzSW5mbyk7XHJcbiAgICB9XHJcblxyXG5cclxuICAgIHByaXZhdGUgc3RyYXRlZ3k6IElKc0JyaWRnZVN0cmF0ZWd5O1xyXG5cclxuICAgIHByaXZhdGUganNCcmlkZ2VTdHJhdGVneUZhY3Rvcnk6IEpzQnJpZGdlU3RyYXRlZ3lGYWN0b3J5O1xyXG5cclxuICAgIHByaXZhdGUgaW5pdCgpIHtcclxuICAgICAgICB0aGlzLnN0cmF0ZWd5ID0gdGhpcy5qc0JyaWRnZVN0cmF0ZWd5RmFjdG9yeS5jcmVhdGUoKTtcclxuICAgICAgICB3aW5kb3dbJ0pzQnJpZGdlU2VydmljZSddID0gdGhpc1xyXG4gICAgfVxyXG5cclxuICAgIHRha2VQaG90byhvcHRpb25zOiBQaG90b09wdGlvbnMpOiBPYnNlcnZhYmxlPFtdPiB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0SnNCcmlkZ2VTZXJ2aWNlKHRoaXMuc3RyYXRlZ3kudGFrZVBob3RvLCBvcHRpb25zKTtcclxuICAgIH1cclxuICAgIHNjYW5RUkNvZGUoKTogT2JzZXJ2YWJsZTxzdHJpbmc+IHtcclxuICAgICAgICByZXR1cm4gdGhpcy5nZXRKc0JyaWRnZVNlcnZpY2UodGhpcy5zdHJhdGVneS5zY2FuUVJDb2RlKTtcclxuICAgIH1cclxuICAgIGdldExvY2F0aW9uKCk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0SnNCcmlkZ2VTZXJ2aWNlKHRoaXMuc3RyYXRlZ3kuZ2V0TG9jYXRpb24pO1xyXG4gICAgfVxyXG4gICAgc2VuZFNNUyhudW1iZXI6IHN0cmluZywgY29udGVudDogc3RyaW5nKTogdm9pZCB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0SnNCcmlkZ2VTZXJ2aWNlKHRoaXMuc3RyYXRlZ3kuc2VuZFNNUywgbnVtYmVyLCBjb250ZW50KTtcclxuICAgIH1cclxuICAgIG9wZW5TZW5kU01TKG51bWJlcjogc3RyaW5nLCBjb250ZW50OiBzdHJpbmcpOiB2b2lkIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5nZXRKc0JyaWRnZVNlcnZpY2UodGhpcy5zdHJhdGVneS5vcGVuU2VuZFNNUywgbnVtYmVyLCBjb250ZW50KTtcclxuICAgIH1cclxuICAgIHRlbChudW1iZXI6IHN0cmluZyk6IHZvaWQge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmdldEpzQnJpZGdlU2VydmljZSh0aGlzLnN0cmF0ZWd5LnRlbCwgbnVtYmVyKTtcclxuICAgIH1cclxuICAgIHNlbGVjdFBpY3R1cmVGcm9tQWxidW0ob3B0aW9uczogUGljdHVyZU9wdGlvbnMpOiBPYnNlcnZhYmxlPFtdPiB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0SnNCcmlkZ2VTZXJ2aWNlKHRoaXMuc3RyYXRlZ3kuc2VsZWN0UGljdHVyZUZyb21BbGJ1bSwgb3B0aW9ucyk7XHJcbiAgICB9XHJcbiAgICB0YWtlVmlkZW8ob3B0aW9uczogVmlkZXBPcHRpb25zKTogT2JzZXJ2YWJsZTxzdHJpbmc+IHtcclxuICAgICAgICByZXR1cm4gdGhpcy5nZXRKc0JyaWRnZVNlcnZpY2UodGhpcy5zdHJhdGVneS50YWtlVmlkZW8sIG9wdGlvbnMpO1xyXG4gICAgfVxyXG4gICAgY2xvc2VXaW5kb3coKTogdm9pZCB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0SnNCcmlkZ2VTZXJ2aWNlKHRoaXMuc3RyYXRlZ3kuY2xvc2VXaW5kb3cpO1xyXG4gICAgfVxyXG4gICAgc2V0VGl0bGVzKHRpdGxlOiBzdHJpbmcpOiB2b2lkIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5nZXRKc0JyaWRnZVNlcnZpY2UodGhpcy5zdHJhdGVneS5zZXRUaXRsZXMsIHRpdGxlKTtcclxuICAgIH1cclxuXHJcbiAgICBzZWxlY3RGaWxlKG9wdGlvbnM/OiBhbnkpOiBhbnkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmdldEpzQnJpZGdlU2VydmljZSh0aGlzLnN0cmF0ZWd5LnNlbGVjdEZpbGUsIG9wdGlvbnMpO1xyXG4gICAgfVxyXG5cclxuICAgIGRvd25sb2FkRmlsZShvcHRpb25zOiBhbnkpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5nZXRKc0JyaWRnZVNlcnZpY2UodGhpcy5zdHJhdGVneS5kb3dubG9hZEZpbGUsIG9wdGlvbnMpO1xyXG4gICAgfVxyXG5cclxuICAgIHNldE9yaWdpbkdvYmFjayhmbj86IGFueSkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmdldEpzQnJpZGdlU2VydmljZSh0aGlzLnN0cmF0ZWd5LnNldE9yaWdpbkdvYmFjaywgZm4pO1xyXG4gICAgfVxyXG5cclxuICAgIHB1c2hPcmlnaW5Hb2JhY2soZm4/OiBhbnkpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5nZXRKc0JyaWRnZVNlcnZpY2UodGhpcy5zdHJhdGVneS5wdXNoT3JpZ2luR29iYWNrLCBmbik7XHJcbiAgICB9XHJcbiAgICBwb3BPcmlnaW5Hb2JhY2soZm4/OiBhbnkpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5nZXRKc0JyaWRnZVNlcnZpY2UodGhpcy5zdHJhdGVneS5wb3BPcmlnaW5Hb2JhY2ssIGZuKTtcclxuICAgIH1cclxuICAgIHBsYXlTaG9ydFZpZGVvKGZuPzogYW55KSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0SnNCcmlkZ2VTZXJ2aWNlKHRoaXMuc3RyYXRlZ3kucGxheVNob3J0VmlkZW8sIGZuKTtcclxuICAgIH1cclxuXHJcblxyXG4gICAgcHJpdmF0ZSBnZXRKc0JyaWRnZVNlcnZpY2UobWV0aG9kLCAuLi52YWx1ZXMpIHtcclxuICAgICAgICBjb25zdCBzdWJqZWN0ID0gbmV3IFN1YmplY3Q8YW55PigpO1xyXG5cclxuICAgICAgICAvLyDlt7Lnu4/lrZjlnKjmlrnms5Xlrp7kvovljbPnu5PmnZ/ov5Tlm55cclxuICAgICAgICBpZiAod2luZG93LnRvcFsnRkFSUklTX0pTQnJpZGdlJ10gPT09ICflt7LliqDovb0nKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBtZXRob2QoLi4udmFsdWVzKVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8g5Yik5pat5piv5ZCm5Li65LqR5LiK5Y2P5ZCM546v5aKDXHJcbiAgICAgICAgaWYgKHdpbmRvdy50b3BbJ0ZBUlJJU19KU0JyaWRnZSddID09PSAn5LqR5LiK5Y2P5ZCMJykge1xyXG4gICAgICAgICAgICBpZiAod2luZG93LnRvcFsnaUNpdHlCcmlkZ2UnXSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG1ldGhvZCguLi52YWx1ZXMpXHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgY2N3b3JrID0gd2luZG93LnRvcC5kb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic2NyaXB0XCIpXHJcbiAgICAgICAgICAgICAgICBjY3dvcmsuc3JjID0gJ2h0dHBzOi8vY2N3b3JrLm9zcy5jbi1ub3J0aC0zLmluc3B1cmNsb3Vkb3NzLmNvbS9oNS9jY3dvcmtKc2JyaWRnZS5qcydcclxuICAgICAgICAgICAgICAgIGNjd29yay5vbmxvYWQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgd2luZG93LnRvcFsnaUNpdHlCcmlkZ2UnXS5pbml0KCgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kKC4uLnZhbHVlcykuc3Vic2NyaWJlKFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKGUpID0+IHsgc3ViamVjdC5uZXh0KGUpIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgKVxyXG4gICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgd2luZG93LnRvcC5kb2N1bWVudC5oZWFkLmFwcGVuZENoaWxkKGNjd29yayk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIOW9k+WJjeayoeaciemSiOWvueS6kSvnmoTliKTmlq3vvIzliY3nva7njq/looPkuI3mu6HotrPljbPpu5jorqTkupEr546v5aKDXHJcbiAgICAgICAgaWYgKHdpbmRvdy50b3BbJ0ZBUlJJU19KU0JyaWRnZSddID09PSAn5LqR5YqgJykge1xyXG4gICAgICAgICAgICBTeXN0ZW1cclxuICAgICAgICAgICAgICAgIC5pbXBvcnQoJy9wbGF0Zm9ybS9jb21tb24vd2ViL2ltcC5qcycpXHJcbiAgICAgICAgICAgICAgICAudGhlbihcclxuICAgICAgICAgICAgICAgICAgICAoZSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cudG9wWydGQVJSSVNfSlNCcmlkZ2UnXSA9ICflt7LliqDovb0nO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBtZXRob2QoLi4udmFsdWVzKS5zdWJzY3JpYmUoXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAoZSkgPT4geyBzdWJqZWN0Lm5leHQoZSkgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICApXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgKVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gc3ViamVjdDtcclxuICAgIH1cclxuXHJcbn1cclxuXHJcbmV4cG9ydCB7IEpzQnJpZGdlU2VydmljZSB9Il19
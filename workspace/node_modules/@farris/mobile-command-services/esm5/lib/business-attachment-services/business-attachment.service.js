/**
 * @fileoverview added by tsickle
 * Generated from: lib/business-attachment-services/business-attachment.service.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { EMPTY, forkJoin, of } from 'rxjs';
import { tap, switchMap, map, filter, take } from 'rxjs/operators';
// import { cloneDeep } from 'lodash-es';
import { BindingPathConverter, HttpMethods, DataChangeType } from '@farris/mobile-devkit';
import { AttachmentUtil } from './business-attachment.util';
/**
 * 附件服务
 */
var /**
 * 附件服务
 */
BusinessAttachmentService = /** @class */ (function () {
    /**
     * 构造函数
     */
    function BusinessAttachmentService(viewModelContext, entityService, removeDataService, attachDataService) {
        /**
         * 默认根目录
         */
        this.defaultRootDirId = 'default-root';
        this.viewModelContext = viewModelContext;
        this.attachDataService = attachDataService;
        this.entityService = entityService;
        this.removeDataService = removeDataService;
    }
    Object.defineProperty(BusinessAttachmentService.prototype, "defaultParentDirName", {
        /**
         * 默认子目录
         */
        get: /**
         * 默认子目录
         * @private
         * @return {?}
         */
        function () {
            return this.viewModelContext.bindingData.list.currentId;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * 获取列表数据
     */
    /**
     * 获取列表数据
     * @param {?} url
     * @param {?} filters
     * @param {?} sorts
     * @return {?}
     */
    BusinessAttachmentService.prototype.loadAttachmentRows = /**
     * 获取列表数据
     * @param {?} url
     * @param {?} filters
     * @param {?} sorts
     * @return {?}
     */
    function (url, filters, sorts) {
        /** @type {?} */
        var attachContext = this.getAttachContext();
        /** @type {?} */
        var befRepository = ((/** @type {?} */ (this.viewModelContext.repository)));
        /** @type {?} */
        var sessionService = befRepository.sessionService;
        /** @type {?} */
        var apiProxy = befRepository.apiProxy;
        // 组织params
        /** @type {?} */
        var params = {};
        if (typeof filters === 'string') {
            filters = JSON.parse(filters);
        }
        if (typeof sorts === 'string') {
            sorts = JSON.parse(sorts);
        }
        /** @type {?} */
        var entityFilter = {
            FilterConditions: filters || null,
            SortConditions: sorts || null,
            IsUsePagination: false,
            Pagination: {
                PageIndex: 1,
                PageSize: 0,
                PageCount: 0,
                TotalCount: 0
            }
        };
        /** @type {?} */
        var entityFilterString = JSON.stringify(entityFilter);
        params.entityFilter = entityFilterString;
        // 组织body
        /** @type {?} */
        var body = {
            dataChange: [],
            variableChange: null
        }
        // 赋值be的url
        ;
        // 赋值be的url
        befRepository.apiProxy.setAssociatedUrl(url);
        return this.waitForBeSession().pipe(switchMap((/**
         * @return {?}
         */
        function () {
            url = url + "/extension/query";
            /** @type {?} */
            var requestConfig = {
                headers: sessionService.extendRequestHeaders({}),
                params: params,
                body: body
            };
            /** @type {?} */
            var query$ = apiProxy.httpClient.request(HttpMethods.PUT, url, requestConfig).pipe(map((/**
             * @param {?} result
             * @return {?}
             */
            function (result) {
                /** @type {?} */
                var attachListData = result.returnValue.result;
                // 赋值当前所有数据
                attachContext.setData(JSON.parse(JSON.stringify(attachListData)));
                // 赋值缓存起来
                attachContext.updateData(JSON.parse(JSON.stringify(attachListData)));
                return attachListData;
            })));
            return query$;
        })));
    };
    /**
     * @private
     * @return {?}
     */
    BusinessAttachmentService.prototype.waitForBeSession = /**
     * @private
     * @return {?}
     */
    function () {
        /** @type {?} */
        var befRepository = (/** @type {?} */ (this.viewModelContext.repository));
        /** @type {?} */
        var sessionService = befRepository.sessionService;
        return sessionService.getBeSessionExisted().pipe(filter((/**
         * @param {?} beSessionExisted
         * @return {?}
         */
        function (beSessionExisted) {
            return beSessionExisted === true;
        })), take(1));
    };
    /**
     * 同步变更
     */
    /**
     * 同步变更
     * @param {?} url
     * @return {?}
     */
    BusinessAttachmentService.prototype.syncAttachmentRowChanges = /**
     * 同步变更
     * @param {?} url
     * @return {?}
     */
    function (url) {
        /** @type {?} */
        var attachContext = this.getAttachContext() || {};
        /** @type {?} */
        var changeDetails = AttachmentUtil.getChangeDetails(attachContext.oldListData, attachContext.listData);
        if (!changeDetails || changeDetails.length === 0) {
            return of(false);
        }
        /** @type {?} */
        var changedRowId = changeDetails[0].ChangeInfo.DataId;
        /** @type {?} */
        var requestInfo = {
            dataChange: changeDetails,
            variableChange: null
        };
        /** @type {?} */
        var requestConfig = {
            body: requestInfo
        };
        /** @type {?} */
        var apiProxy = ((/** @type {?} */ (this.viewModelContext.repository))).apiProxy;
        url = url + "/extension/retrieve/" + changedRowId;
        return apiProxy.request(HttpMethods.PUT, url, requestConfig, true).pipe(map((/**
         * @param {?} e
         * @return {?}
         */
        function (e) {
            /** @type {?} */
            var context = attachContext.context;
            /** @type {?} */
            var data = context.getData();
            // goBack之后  更新缓存后的值
            context.updateData(JSON.parse(JSON.stringify(data)));
            return e;
        })));
    };
    /**
     * 上传单个文件
     * @param attachmentIdPath 附件内码字段的路径，形如/attachInfo/attachmentId；
     * @param attachmentNamePath 附件名称字段的路径
     */
    /**
     * 上传单个文件
     * @param {?} attachmentInfoFieldPath
     * @param {?=} rootDirId
     * @param {?=} parentDirName
     * @return {?}
     */
    BusinessAttachmentService.prototype.uploadAndUpdateRow = /**
     * 上传单个文件
     * @param {?} attachmentInfoFieldPath
     * @param {?=} rootDirId
     * @param {?=} parentDirName
     * @return {?}
     */
    function (attachmentInfoFieldPath, rootDirId, parentDirName) {
        /** @type {?} */
        var rootId = rootDirId ? rootDirId : this.defaultRootDirId;
        /** @type {?} */
        var formId = parentDirName ? parentDirName : this.defaultParentDirName;
        if (!rootId || !formId) {
            throw new Error('rootDirId和parentDirName不能为空，请填写');
        }
        /** @type {?} */
        var fileInfos = this.getUploadFileInfosFromContext();
        /** @type {?} */
        var attachmentInfos = AttachmentUtil.convertToAttachmentInfos(fileInfos);
        if (!attachmentInfos || attachmentInfos.length === 0) {
            alert('请先上传附件');
            return EMPTY;
        }
        // 更新服务器端
        console.log('show loading ...');
        /** @type {?} */
        var firstAttachmentInfo = AttachmentUtil.getFirstAttachmentInfo(attachmentInfos);
        /** @type {?} */
        var result$ = this.attachDataService.updateRow(attachmentInfoFieldPath, firstAttachmentInfo).pipe(tap((/**
         * @return {?}
         */
        function () {
            console.log('hide loading ...');
        })));
        return result$;
    };
    /**
     * 上传多个文件
     */
    /**
     * 上传多个文件
     * @param {?} url
     * @param {?} attachmentInfoFieldPath
     * @return {?}
     */
    BusinessAttachmentService.prototype.uploadAndBatchAddRows = /**
     * 上传多个文件
     * @param {?} url
     * @param {?} attachmentInfoFieldPath
     * @return {?}
     */
    function (url, attachmentInfoFieldPath) {
        var _this = this;
        /** @type {?} */
        var commandContext = (/** @type {?} */ (this['context']));
        // 附件相关信息
        /** @type {?} */
        var rootDirId = commandContext.eventParams.rootId;
        /** @type {?} */
        var parentDirName = commandContext.eventParams.parentDirName;
        /** @type {?} */
        var rootId = rootDirId ? rootDirId : this.defaultRootDirId;
        /** @type {?} */
        var formId = parentDirName ? parentDirName : this.defaultParentDirName;
        if (!rootId || !formId) {
            throw new Error('rootDirId和parentDirName不能为空，请填写');
        }
        /** @type {?} */
        var context = commandContext.eventParams.context;
        /** @type {?} */
        var fileInfos = this.getUploadFileInfosFromContext();
        /** @type {?} */
        var attachmentInfos = AttachmentUtil.convertToAttachmentInfos(fileInfos);
        if (!attachmentInfos || attachmentInfos.length === 0) {
            alert('请先上传附件');
            return EMPTY;
        }
        // 更新服务器端
        /** @type {?} */
        var uploadUrl = url + "/service/batchuploadattachment";
        return this.attachDataService.updateRows(uploadUrl, attachmentInfoFieldPath, attachmentInfos).pipe(map((/**
         * @param {?} e
         * @return {?}
         */
        function (e) {
            // 追加数据
            context.appendData(e);
            /** @type {?} */
            var dataIds = _this.getDataIdsToRemove(context, attachmentInfoFieldPath);
            dataIds.forEach((/**
             * @param {?} dataId
             * @return {?}
             */
            function (dataId) {
                // 添加标记
                _this.viewModelContext.repository.dataChangeHistory.addChange({ fPath: '', dataId: dataId, changeType: DataChangeType.Add });
            }));
            return e;
        })));
    };
    /**
     * 批量删除附件所在的行
     */
    /**
     * 批量删除附件所在的行
     * @param {?} url
     * @param {?} attachmentInfoFieldPath
     * @return {?}
     */
    BusinessAttachmentService.prototype.removeAttachmentRows = /**
     * 批量删除附件所在的行
     * @param {?} url
     * @param {?} attachmentInfoFieldPath
     * @return {?}
     */
    function (url, attachmentInfoFieldPath) {
        var _this = this;
        /** @type {?} */
        var context = this['context'].eventParams.context;
        if (!attachmentInfoFieldPath) {
            return EMPTY;
        }
        /** @type {?} */
        var dataIds = this.getDataIdsToRemove(context, attachmentInfoFieldPath);
        // 如果是主表
        if (attachmentInfoFieldPath.split('/').length <= 2) {
            /** @type {?} */
            var removeUrl = url + "/extension/batchdelete";
            return this.removeDataService.removeByBusinessIds(removeUrl, dataIds).pipe(map((/**
             * @param {?} e
             * @return {?}
             */
            function (e) {
                dataIds.forEach((/**
                 * @param {?} dataId
                 * @return {?}
                 */
                function (dataId) {
                    context.removeDataById(dataId);
                    // 添加标记
                    _this.viewModelContext.repository.dataChangeHistory.addChange({ fPath: '', dataId: dataId, changeType: DataChangeType.Delete });
                }));
            })));
        }
        else {
            // 如果是子表
            /** @type {?} */
            var removeObservables_1 = [];
            if (dataIds.length === 0) {
                alert('请选择要删除的文件');
            }
            /** @type {?} */
            var bindingListPath_1 = this.getBindingListPathWithAttachments(attachmentInfoFieldPath);
            dataIds.forEach((/**
             * @param {?} dataId
             * @return {?}
             */
            function (dataId) {
                /** @type {?} */
                var removeObservable = _this.removeDataService.removeByBusinessPathAndId(url, bindingListPath_1, dataId);
                removeObservables_1.push(removeObservable);
            }));
            return forkJoin(removeObservables_1).pipe(map((/**
             * @param {?} e
             * @return {?}
             */
            function (e) {
                console.log(e);
                return e;
            })));
        }
    };
    // #region 工具方法
    /**
     * 从上下文中中获取控件传递的附件信息
     */
    // #region 工具方法
    /**
     * 从上下文中中获取控件传递的附件信息
     * @private
     * @return {?}
     */
    BusinessAttachmentService.prototype.getUploadFileInfosFromContext = 
    // #region 工具方法
    /**
     * 从上下文中中获取控件传递的附件信息
     * @private
     * @return {?}
     */
    function () {
        /** @type {?} */
        var commandContext = (/** @type {?} */ (this['context']));
        /** @type {?} */
        var uploadFileInfos = (/** @type {?} */ (commandContext.eventParams.data));
        if (!uploadFileInfos) {
            return [];
        }
        return uploadFileInfos;
    };
    /**
     * 获取要删除的附件对应的数据id数组
     */
    /**
     * 获取要删除的附件对应的数据id数组
     * @param {?} context
     * @param {?} attachmentInfoFieldPath
     * @return {?}
     */
    BusinessAttachmentService.prototype.getDataIdsToRemove = /**
     * 获取要删除的附件对应的数据id数组
     * @param {?} context
     * @param {?} attachmentInfoFieldPath
     * @return {?}
     */
    function (context, attachmentInfoFieldPath) {
        var _this = this;
        /** @type {?} */
        var attachIds = this.getAttachmentIdsToRemoveFromContext();
        /** @type {?} */
        var dataIds = [];
        attachIds.forEach((/**
         * @param {?} attachId
         * @return {?}
         */
        function (attachId) {
            // 上传删除和预览删除传递过来的fileId的key可能不一致，要做兼容
            /** @type {?} */
            var dataId = _this.convertAttachmentIdToDataId(context, attachId, attachmentInfoFieldPath);
            dataIds.push(dataId);
        }));
        return dataIds;
    };
    /**
     * 从命令上下文中获取要删除附件ids
     */
    /**
     * 从命令上下文中获取要删除附件ids
     * @return {?}
     */
    BusinessAttachmentService.prototype.getAttachmentIdsToRemoveFromContext = /**
     * 从命令上下文中获取要删除附件ids
     * @return {?}
     */
    function () {
        /** @type {?} */
        var commandContext = (/** @type {?} */ (this['context']));
        return commandContext.eventParams.data.map((/**
         * @param {?} dataItem
         * @return {?}
         */
        function (dataItem) {
            return Object.prototype.toString.call(dataItem) === '[object Object]' ? dataItem.metadataId : dataItem;
        }));
        // return commandContext.eventParams.data as string[];
    };
    /**
     * 根据路径获取附件字段值数组
     * @param fieldPath 字段路径
     */
    /**
     * 根据路径获取附件字段值数组
     * @private
     * @param {?} context
     * @param {?} fileId
     * @param {?} attachmentInfoFieldPath
     * @return {?}
     */
    BusinessAttachmentService.prototype.convertAttachmentIdToDataId = /**
     * 根据路径获取附件字段值数组
     * @private
     * @param {?} context
     * @param {?} fileId
     * @param {?} attachmentInfoFieldPath
     * @return {?}
     */
    function (context, fileId, attachmentInfoFieldPath) {
        // 解析路径
        /** @type {?} */
        var attachInfoBindingPath = BindingPathConverter.toBindingPathArray(attachmentInfoFieldPath);
        /** @type {?} */
        var attachFieldName = attachInfoBindingPath.pop();
        /** @type {?} */
        var attachListBindingPath = attachInfoBindingPath;
        // 获取附件id数组
        // const entityListData = this.entityService.getEntityListData(attachListBindingPath);
        /** @type {?} */
        var entityListData = context.data;
        /** @type {?} */
        var targetEntityData = entityListData.find((/**
         * @param {?} entityData
         * @return {?}
         */
        function (entityData) {
            if (entityData[attachFieldName]) {
                /** @type {?} */
                var attachmentId = entityData[attachFieldName]['attachmentId'];
                if (attachmentId === fileId) {
                    return true;
                }
            }
        }));
        return targetEntityData.id;
    };
    /**
     * 获取带附件的BindingList的Path
     */
    /**
     * 获取带附件的BindingList的Path
     * @private
     * @param {?} attachmentInfoFieldPath
     * @return {?}
     */
    BusinessAttachmentService.prototype.getBindingListPathWithAttachments = /**
     * 获取带附件的BindingList的Path
     * @private
     * @param {?} attachmentInfoFieldPath
     * @return {?}
     */
    function (attachmentInfoFieldPath) {
        /** @type {?} */
        var attachInfoBindingPath = BindingPathConverter.toBindingPathArray(attachmentInfoFieldPath);
        attachInfoBindingPath.pop();
        /** @type {?} */
        var bindingListPath = attachInfoBindingPath;
        return '/' + bindingListPath.join('/');
    };
    /**
     * 获取附件组件上下文
     */
    /**
     * 获取附件组件上下文
     * @private
     * @return {?}
     */
    BusinessAttachmentService.prototype.getAttachContext = /**
     * 获取附件组件上下文
     * @private
     * @return {?}
     */
    function () {
        /** @type {?} */
        var commandContext = (/** @type {?} */ (this['context']));
        /** @type {?} */
        var attachContext = commandContext && commandContext.eventParams ? commandContext.eventParams : {};
        return attachContext;
    };
    return BusinessAttachmentService;
}());
if (false) {
    /**
     * 默认根目录
     * @type {?}
     * @private
     */
    BusinessAttachmentService.prototype.defaultRootDirId;
    /**
     * 视图模型
     * @type {?}
     * @private
     */
    BusinessAttachmentService.prototype.viewModelContext;
    /**
     * 附件数据服务
     * @type {?}
     * @private
     */
    BusinessAttachmentService.prototype.attachDataService;
    /**
     * 实体服务
     * @type {?}
     * @private
     */
    BusinessAttachmentService.prototype.entityService;
    /**
     * 实体服务
     * @type {?}
     * @private
     */
    BusinessAttachmentService.prototype.removeDataService;
}
export { BusinessAttachmentService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYnVzaW5lc3MtYXR0YWNobWVudC5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy9tb2JpbGUtY29tbWFuZC1zZXJ2aWNlcy8iLCJzb3VyY2VzIjpbImxpYi9idXNpbmVzcy1hdHRhY2htZW50LXNlcnZpY2VzL2J1c2luZXNzLWF0dGFjaG1lbnQuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFBYyxLQUFLLEVBQUUsUUFBUSxFQUFFLEVBQUUsRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUN2RCxPQUFPLEVBQUUsR0FBRyxFQUFFLFNBQVMsRUFBRSxHQUFHLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRSxNQUFNLGdCQUFnQixDQUFDOztBQUVuRSxPQUFPLEVBQzZCLG9CQUFvQixFQUNWLFdBQVcsRUFDdkQsY0FBYyxFQUNmLE1BQU0sdUJBQXVCLENBQUM7QUFHL0IsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLDRCQUE0QixDQUFDOzs7O0FBUzVEOzs7O0lBa0NFOztPQUVHO0lBQ0gsbUNBQ0UsZ0JBQWtDLEVBQUUsYUFBNEIsRUFDaEUsaUJBQW9DLEVBQUUsaUJBQWdEOzs7O1FBbENoRixxQkFBZ0IsR0FBRyxjQUFjLENBQUM7UUFxQ3hDLElBQUksQ0FBQyxnQkFBZ0IsR0FBRyxnQkFBZ0IsQ0FBQztRQUN6QyxJQUFJLENBQUMsaUJBQWlCLEdBQUcsaUJBQWlCLENBQUM7UUFDM0MsSUFBSSxDQUFDLGFBQWEsR0FBRyxhQUFhLENBQUM7UUFDbkMsSUFBSSxDQUFDLGlCQUFpQixHQUFHLGlCQUFpQixDQUFDO0lBQzdDLENBQUM7SUFwQ0Qsc0JBQVksMkRBQW9CO1FBSGhDOztXQUVHOzs7Ozs7UUFDSDtZQUNFLE9BQU8sSUFBSSxDQUFDLGdCQUFnQixDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDO1FBQzFELENBQUM7OztPQUFBO0lBcUNEOztPQUVHOzs7Ozs7OztJQUNJLHNEQUFrQjs7Ozs7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O1lBQzNELElBQUksVUFBVSxDQUFDLGVBQWUsQ0FBQyxFQUFFOztvQkFDekIsWUFBWSxHQUFHLFVBQVUsQ0FBQyxlQUFlLENBQUMsQ0FBQyxjQUFjLENBQUM7Z0JBQ2hFLElBQUksWUFBWSxLQUFLLE1BQU0sRUFBRTtvQkFDM0IsT0FBTyxJQUFJLENBQUM7aUJBQ2I7YUFDRjtRQUNILENBQUMsRUFBQztRQUVGLE9BQU8sZ0JBQWdCLENBQUMsRUFBRSxDQUFDO0lBQzdCLENBQUM7SUFFRDs7T0FFRzs7Ozs7OztJQUNLLHFFQUFpQzs7Ozs7O0lBQXpDLFVBQTBDLHVCQUErQjs7WUFDakUscUJBQXFCLEdBQUcsb0JBQW9CLENBQUMsa0JBQWtCLENBQUMsdUJBQXVCLENBQUM7UUFDOUYscUJBQXFCLENBQUMsR0FBRyxFQUFFLENBQUM7O1lBQ3RCLGVBQWUsR0FBRyxxQkFBcUI7UUFDN0MsT0FBTyxHQUFHLEdBQUcsZUFBZSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUN6QyxDQUFDO0lBRUQ7O09BRUc7Ozs7OztJQUNLLG9EQUFnQjs7Ozs7SUFBeEI7O1lBQ1EsY0FBYyxHQUFHLG1CQUFBLElBQUksQ0FBQyxTQUFTLENBQUMsRUFBa0I7O1lBQ2xELGFBQWEsR0FBRyxjQUFjLElBQUksY0FBYyxDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUMsY0FBYyxDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUMsRUFBRTtRQUNwRyxPQUFPLGFBQWEsQ0FBQztJQUN2QixDQUFDO0lBSUgsZ0NBQUM7QUFBRCxDQUFDLEFBM1ZELElBMlZDOzs7Ozs7O0lBdFZDLHFEQUEwQzs7Ozs7O0lBWTFDLHFEQUEyQzs7Ozs7O0lBSzNDLHNEQUF5RDs7Ozs7O0lBS3pELGtEQUFxQzs7Ozs7O0lBS3JDLHNEQUE2Qzs7QUE2VC9DLE9BQU8sRUFBRSx5QkFBeUIsRUFBRSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgT2JzZXJ2YWJsZSwgRU1QVFksIGZvcmtKb2luLCBvZiB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQgeyB0YXAsIHN3aXRjaE1hcCwgbWFwLCBmaWx0ZXIsIHRha2UgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XHJcbi8vIGltcG9ydCB7IGNsb25lRGVlcCB9IGZyb20gJ2xvZGFzaC1lcyc7XHJcbmltcG9ydCB7XHJcbiAgVmlld01vZGVsQ29udGV4dCwgQ29tbWFuZENvbnRleHQsIEJpbmRpbmdQYXRoQ29udmVydGVyLFxyXG4gIEh0dHBSZXF1ZXN0Q29uZmlnLCBIdHRwUGFyYW1zLCBIdHRwSGVhZGVycywgSHR0cE1ldGhvZHMsXHJcbiAgRGF0YUNoYW5nZVR5cGVcclxufSBmcm9tICdAZmFycmlzL21vYmlsZS1kZXZraXQnO1xyXG5pbXBvcnQgeyBCZWZSZXBvc2l0b3J5LCBSZXF1ZXN0SW5mbyB9IGZyb20gJ0BmYXJyaXMvbW9iaWxlLWJlZic7XHJcbmltcG9ydCB7IEJ1c2luZXNzVXBsb2FkRmlsZUluZm8gfSBmcm9tICcuL3R5cGVzJztcclxuaW1wb3J0IHsgQXR0YWNobWVudFV0aWwgfSBmcm9tICcuL2J1c2luZXNzLWF0dGFjaG1lbnQudXRpbCc7XHJcbmltcG9ydCB7IEJ1c2luZXNzQXR0YWNobWVudERhdGFTZXJ2aWNlIH0gZnJvbSAnLi9idXNpbmVzcy1hdHRhY2htZW50LWRhdGEuc2VydmljZSc7XHJcbmltcG9ydCB7IEVudGl0eVNlcnZpY2UgfSBmcm9tICcuLi9lbnRpdHktc2VydmljZXMvaW5kZXgnO1xyXG5pbXBvcnQgeyBSZW1vdmVEYXRhU2VydmljZSB9IGZyb20gJy4uL2RhdGEtc2VydmljZXMvcmVtb3ZlLWRhdGEuc2VydmljZSc7XHJcblxyXG5cclxuLyoqXHJcbiAqIOmZhOS7tuacjeWKoVxyXG4gKi9cclxuY2xhc3MgQnVzaW5lc3NBdHRhY2htZW50U2VydmljZSB7XHJcblxyXG4gIC8qKlxyXG4gICAqIOm7mOiupOagueebruW9lVxyXG4gICAqL1xyXG4gIHByaXZhdGUgZGVmYXVsdFJvb3REaXJJZCA9ICdkZWZhdWx0LXJvb3QnO1xyXG5cclxuICAvKipcclxuICAgKiDpu5jorqTlrZDnm67lvZVcclxuICAgKi9cclxuICBwcml2YXRlIGdldCBkZWZhdWx0UGFyZW50RGlyTmFtZSgpOiBzdHJpbmcge1xyXG4gICAgcmV0dXJuIHRoaXMudmlld01vZGVsQ29udGV4dC5iaW5kaW5nRGF0YS5saXN0LmN1cnJlbnRJZDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOinhuWbvuaooeWei1xyXG4gICAqL1xyXG4gIHByaXZhdGUgdmlld01vZGVsQ29udGV4dDogVmlld01vZGVsQ29udGV4dDtcclxuXHJcbiAgLyoqXHJcbiAgICog6ZmE5Lu25pWw5o2u5pyN5YqhXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBhdHRhY2hEYXRhU2VydmljZTogQnVzaW5lc3NBdHRhY2htZW50RGF0YVNlcnZpY2U7XHJcblxyXG4gIC8qKlxyXG4gICAqIOWunuS9k+acjeWKoVxyXG4gICAqL1xyXG4gIHByaXZhdGUgZW50aXR5U2VydmljZTogRW50aXR5U2VydmljZTtcclxuXHJcbiAgLyoqXHJcbiAgICog5a6e5L2T5pyN5YqhXHJcbiAgICovXHJcbiAgcHJpdmF0ZSByZW1vdmVEYXRhU2VydmljZTogUmVtb3ZlRGF0YVNlcnZpY2U7XHJcblxyXG4gIC8qKlxyXG4gICAqIOaehOmAoOWHveaVsFxyXG4gICAqL1xyXG4gIGNvbnN0cnVjdG9yKFxyXG4gICAgdmlld01vZGVsQ29udGV4dDogVmlld01vZGVsQ29udGV4dCwgZW50aXR5U2VydmljZTogRW50aXR5U2VydmljZSxcclxuICAgIHJlbW92ZURhdGFTZXJ2aWNlOiBSZW1vdmVEYXRhU2VydmljZSwgYXR0YWNoRGF0YVNlcnZpY2U6IEJ1c2luZXNzQXR0YWNobWVudERhdGFTZXJ2aWNlLFxyXG4gICkge1xyXG5cclxuICAgIHRoaXMudmlld01vZGVsQ29udGV4dCA9IHZpZXdNb2RlbENvbnRleHQ7XHJcbiAgICB0aGlzLmF0dGFjaERhdGFTZXJ2aWNlID0gYXR0YWNoRGF0YVNlcnZpY2U7XHJcbiAgICB0aGlzLmVudGl0eVNlcnZpY2UgPSBlbnRpdHlTZXJ2aWNlO1xyXG4gICAgdGhpcy5yZW1vdmVEYXRhU2VydmljZSA9IHJlbW92ZURhdGFTZXJ2aWNlO1xyXG4gIH1cclxuXHJcblxyXG4gIC8qKlxyXG4gICAqIOiOt+WPluWIl+ihqOaVsOaNrlxyXG4gICAqL1xyXG4gIHB1YmxpYyBsb2FkQXR0YWNobWVudFJvd3ModXJsOiBzdHJpbmcsIGZpbHRlcnM6IGFueVtdLCBzb3J0czogYW55W10pOiBPYnNlcnZhYmxlPGFueT4ge1xyXG5cclxuICAgIGNvbnN0IGF0dGFjaENvbnRleHQgPSB0aGlzLmdldEF0dGFjaENvbnRleHQoKTtcclxuICAgIGNvbnN0IGJlZlJlcG9zaXRvcnkgPSAodGhpcy52aWV3TW9kZWxDb250ZXh0LnJlcG9zaXRvcnkgYXMgQmVmUmVwb3NpdG9yeTxhbnk+KTtcclxuICAgIGNvbnN0IHNlc3Npb25TZXJ2aWNlID0gYmVmUmVwb3NpdG9yeS5zZXNzaW9uU2VydmljZTtcclxuICAgIGNvbnN0IGFwaVByb3h5ID0gYmVmUmVwb3NpdG9yeS5hcGlQcm94eTtcclxuXHJcbiAgICAvLyDnu4Tnu4dwYXJhbXNcclxuICAgIGNvbnN0IHBhcmFtczogSHR0cFBhcmFtcyA9IHt9O1xyXG4gICAgaWYgKHR5cGVvZiBmaWx0ZXJzID09PSAnc3RyaW5nJykge1xyXG4gICAgICBmaWx0ZXJzID0gSlNPTi5wYXJzZShmaWx0ZXJzKTtcclxuICAgIH1cclxuICAgIGlmICh0eXBlb2Ygc29ydHMgPT09ICdzdHJpbmcnKSB7XHJcbiAgICAgIHNvcnRzID0gSlNPTi5wYXJzZShzb3J0cyk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgZW50aXR5RmlsdGVyID0ge1xyXG4gICAgICBGaWx0ZXJDb25kaXRpb25zOiBmaWx0ZXJzIHx8IG51bGwsXHJcbiAgICAgIFNvcnRDb25kaXRpb25zOiBzb3J0cyB8fCBudWxsLFxyXG4gICAgICBJc1VzZVBhZ2luYXRpb246IGZhbHNlLFxyXG4gICAgICBQYWdpbmF0aW9uOiB7XHJcbiAgICAgICAgUGFnZUluZGV4OiAxLFxyXG4gICAgICAgIFBhZ2VTaXplOiAwLFxyXG4gICAgICAgIFBhZ2VDb3VudDogMCxcclxuICAgICAgICBUb3RhbENvdW50OiAwXHJcbiAgICAgIH1cclxuICAgIH07XHJcbiAgICBjb25zdCBlbnRpdHlGaWx0ZXJTdHJpbmcgPSBKU09OLnN0cmluZ2lmeShlbnRpdHlGaWx0ZXIpO1xyXG4gICAgcGFyYW1zLmVudGl0eUZpbHRlciA9IGVudGl0eUZpbHRlclN0cmluZztcclxuXHJcbiAgICAvLyDnu4Tnu4dib2R5XHJcbiAgICBjb25zdCBib2R5ID0ge1xyXG4gICAgICBkYXRhQ2hhbmdlOiBbXSxcclxuICAgICAgdmFyaWFibGVDaGFuZ2U6IG51bGxcclxuICAgIH1cclxuXHJcbiAgICAvLyDotYvlgLxiZeeahHVybFxyXG4gICAgYmVmUmVwb3NpdG9yeS5hcGlQcm94eS5zZXRBc3NvY2lhdGVkVXJsKHVybCk7XHJcbiAgICByZXR1cm4gdGhpcy53YWl0Rm9yQmVTZXNzaW9uKCkucGlwZShzd2l0Y2hNYXAoKCkgPT4ge1xyXG4gICAgICB1cmwgPSBgJHt1cmx9L2V4dGVuc2lvbi9xdWVyeWA7XHJcbiAgICAgIGNvbnN0IHJlcXVlc3RDb25maWc6IEh0dHBSZXF1ZXN0Q29uZmlnID0ge1xyXG4gICAgICAgIGhlYWRlcnM6IHNlc3Npb25TZXJ2aWNlLmV4dGVuZFJlcXVlc3RIZWFkZXJzKHt9KSxcclxuICAgICAgICBwYXJhbXM6IHBhcmFtcyxcclxuICAgICAgICBib2R5XHJcbiAgICAgIH07XHJcblxyXG4gICAgICBjb25zdCBxdWVyeSQgPSBhcGlQcm94eS5odHRwQ2xpZW50LnJlcXVlc3QoSHR0cE1ldGhvZHMuUFVULCB1cmwsIHJlcXVlc3RDb25maWcpLnBpcGUoXHJcbiAgICAgICAgbWFwKChyZXN1bHQpID0+IHtcclxuICAgICAgICAgIGNvbnN0IGF0dGFjaExpc3REYXRhID0gcmVzdWx0LnJldHVyblZhbHVlLnJlc3VsdDtcclxuICAgICAgICAgIC8vIOi1i+WAvOW9k+WJjeaJgOacieaVsOaNrlxyXG4gICAgICAgICAgYXR0YWNoQ29udGV4dC5zZXREYXRhKEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoYXR0YWNoTGlzdERhdGEpKSk7XHJcbiAgICAgICAgICAvLyDotYvlgLznvJPlrZjotbfmnaVcclxuICAgICAgICAgIGF0dGFjaENvbnRleHQudXBkYXRlRGF0YShKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KGF0dGFjaExpc3REYXRhKSkpO1xyXG4gICAgICAgICAgcmV0dXJuIGF0dGFjaExpc3REYXRhO1xyXG4gICAgICAgIH0pXHJcbiAgICAgICk7XHJcblxyXG4gICAgICByZXR1cm4gcXVlcnkkO1xyXG4gICAgfSkpO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSB3YWl0Rm9yQmVTZXNzaW9uKCk6IE9ic2VydmFibGU8Ym9vbGVhbj4ge1xyXG4gICAgY29uc3QgYmVmUmVwb3NpdG9yeSA9IHRoaXMudmlld01vZGVsQ29udGV4dC5yZXBvc2l0b3J5IGFzIEJlZlJlcG9zaXRvcnk8YW55PjtcclxuICAgIGNvbnN0IHNlc3Npb25TZXJ2aWNlID0gYmVmUmVwb3NpdG9yeS5zZXNzaW9uU2VydmljZTtcclxuICAgIHJldHVybiBzZXNzaW9uU2VydmljZS5nZXRCZVNlc3Npb25FeGlzdGVkKCkucGlwZShcclxuICAgICAgZmlsdGVyKChiZVNlc3Npb25FeGlzdGVkOiBib29sZWFuKSA9PiB7XHJcbiAgICAgICAgcmV0dXJuIGJlU2Vzc2lvbkV4aXN0ZWQgPT09IHRydWU7XHJcbiAgICAgIH0pLFxyXG4gICAgICB0YWtlKDEpXHJcbiAgICApO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDlkIzmraXlj5jmm7RcclxuICAgKi9cclxuICBwdWJsaWMgc3luY0F0dGFjaG1lbnRSb3dDaGFuZ2VzKHVybDogc3RyaW5nKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgIGNvbnN0IGF0dGFjaENvbnRleHQgPSB0aGlzLmdldEF0dGFjaENvbnRleHQoKSB8fCB7fTtcclxuXHJcbiAgICBjb25zdCBjaGFuZ2VEZXRhaWxzID0gQXR0YWNobWVudFV0aWwuZ2V0Q2hhbmdlRGV0YWlscyhhdHRhY2hDb250ZXh0Lm9sZExpc3REYXRhLCBhdHRhY2hDb250ZXh0Lmxpc3REYXRhKTtcclxuICAgIGlmICghY2hhbmdlRGV0YWlscyB8fCBjaGFuZ2VEZXRhaWxzLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICByZXR1cm4gb2YoZmFsc2UpO1xyXG4gICAgfVxyXG4gICAgY29uc3QgY2hhbmdlZFJvd0lkID0gY2hhbmdlRGV0YWlsc1swXS5DaGFuZ2VJbmZvLkRhdGFJZDtcclxuICAgIGNvbnN0IHJlcXVlc3RJbmZvOiBSZXF1ZXN0SW5mbyA9IHtcclxuICAgICAgZGF0YUNoYW5nZTogY2hhbmdlRGV0YWlscyxcclxuICAgICAgdmFyaWFibGVDaGFuZ2U6IG51bGxcclxuICAgIH1cclxuICAgIGNvbnN0IHJlcXVlc3RDb25maWc6IEh0dHBSZXF1ZXN0Q29uZmlnID0ge1xyXG4gICAgICBib2R5OiByZXF1ZXN0SW5mb1xyXG4gICAgfTtcclxuXHJcbiAgICBjb25zdCBhcGlQcm94eSA9ICh0aGlzLnZpZXdNb2RlbENvbnRleHQucmVwb3NpdG9yeSBhcyBCZWZSZXBvc2l0b3J5PGFueT4pLmFwaVByb3h5O1xyXG4gICAgdXJsID0gYCR7dXJsfS9leHRlbnNpb24vcmV0cmlldmUvJHtjaGFuZ2VkUm93SWR9YDtcclxuICAgIHJldHVybiBhcGlQcm94eS5yZXF1ZXN0KEh0dHBNZXRob2RzLlBVVCwgdXJsLCByZXF1ZXN0Q29uZmlnLCB0cnVlKS5waXBlKFxyXG4gICAgICBtYXAoKGUpID0+IHtcclxuICAgICAgICBjb25zdCBjb250ZXh0ID0gYXR0YWNoQ29udGV4dC5jb250ZXh0O1xyXG4gICAgICAgIGNvbnN0IGRhdGEgPSBjb250ZXh0LmdldERhdGEoKTtcclxuICAgICAgICAvLyBnb0JhY2vkuYvlkI4gIOabtOaWsOe8k+WtmOWQjueahOWAvFxyXG4gICAgICAgIGNvbnRleHQudXBkYXRlRGF0YShKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KGRhdGEpKSk7XHJcbiAgICAgICAgcmV0dXJuIGU7XHJcbiAgICAgIH0pXHJcbiAgICApO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDkuIrkvKDljZXkuKrmlofku7ZcclxuICAgKiBAcGFyYW0gYXR0YWNobWVudElkUGF0aCDpmYTku7blhoXnoIHlrZfmrrXnmoTot6/lvoTvvIzlvaLlpoIvYXR0YWNoSW5mby9hdHRhY2htZW50SWTvvJtcclxuICAgKiBAcGFyYW0gYXR0YWNobWVudE5hbWVQYXRoIOmZhOS7tuWQjeensOWtl+auteeahOi3r+W+hFxyXG4gICAqL1xyXG4gIHB1YmxpYyB1cGxvYWRBbmRVcGRhdGVSb3coYXR0YWNobWVudEluZm9GaWVsZFBhdGg6IHN0cmluZywgcm9vdERpcklkPzogc3RyaW5nLCBwYXJlbnREaXJOYW1lPzogc3RyaW5nKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgIGNvbnN0IHJvb3RJZCA9IHJvb3REaXJJZCA/IHJvb3REaXJJZCA6IHRoaXMuZGVmYXVsdFJvb3REaXJJZDtcclxuICAgIGNvbnN0IGZvcm1JZCA9IHBhcmVudERpck5hbWUgPyBwYXJlbnREaXJOYW1lIDogdGhpcy5kZWZhdWx0UGFyZW50RGlyTmFtZTtcclxuICAgIGlmICghcm9vdElkIHx8ICFmb3JtSWQpIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKCdyb290RGlySWTlkoxwYXJlbnREaXJOYW1l5LiN6IO95Li656m677yM6K+35aGr5YaZJyk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgZmlsZUluZm9zID0gdGhpcy5nZXRVcGxvYWRGaWxlSW5mb3NGcm9tQ29udGV4dCgpO1xyXG4gICAgY29uc3QgYXR0YWNobWVudEluZm9zID0gQXR0YWNobWVudFV0aWwuY29udmVydFRvQXR0YWNobWVudEluZm9zKGZpbGVJbmZvcyk7XHJcbiAgICBpZiAoIWF0dGFjaG1lbnRJbmZvcyB8fCBhdHRhY2htZW50SW5mb3MubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgIGFsZXJ0KCfor7flhYjkuIrkvKDpmYTku7YnKTtcclxuICAgICAgcmV0dXJuIEVNUFRZO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIOabtOaWsOacjeWKoeWZqOerr1xyXG4gICAgY29uc29sZS5sb2coJ3Nob3cgbG9hZGluZyAuLi4nKTtcclxuICAgIGNvbnN0IGZpcnN0QXR0YWNobWVudEluZm8gPSBBdHRhY2htZW50VXRpbC5nZXRGaXJzdEF0dGFjaG1lbnRJbmZvKGF0dGFjaG1lbnRJbmZvcyk7XHJcbiAgICBjb25zdCByZXN1bHQkID0gdGhpcy5hdHRhY2hEYXRhU2VydmljZS51cGRhdGVSb3coYXR0YWNobWVudEluZm9GaWVsZFBhdGgsIGZpcnN0QXR0YWNobWVudEluZm8pLnBpcGUoXHJcbiAgICAgIHRhcCgoKSA9PiB7XHJcbiAgICAgICAgY29uc29sZS5sb2coJ2hpZGUgbG9hZGluZyAuLi4nKTtcclxuICAgICAgfSlcclxuICAgICk7XHJcbiAgICByZXR1cm4gcmVzdWx0JDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOS4iuS8oOWkmuS4quaWh+S7tlxyXG4gICAqL1xyXG4gIHB1YmxpYyB1cGxvYWRBbmRCYXRjaEFkZFJvd3ModXJsOiBzdHJpbmcsIGF0dGFjaG1lbnRJbmZvRmllbGRQYXRoOiBzdHJpbmcpOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgY29uc3QgY29tbWFuZENvbnRleHQgPSB0aGlzWydjb250ZXh0J10gYXMgQ29tbWFuZENvbnRleHQ7XHJcbiAgICAvLyDpmYTku7bnm7jlhbPkv6Hmga9cclxuICAgIGNvbnN0IHJvb3REaXJJZCA9IGNvbW1hbmRDb250ZXh0LmV2ZW50UGFyYW1zLnJvb3RJZDtcclxuICAgIGNvbnN0IHBhcmVudERpck5hbWUgPSBjb21tYW5kQ29udGV4dC5ldmVudFBhcmFtcy5wYXJlbnREaXJOYW1lO1xyXG4gICAgY29uc3Qgcm9vdElkID0gcm9vdERpcklkID8gcm9vdERpcklkIDogdGhpcy5kZWZhdWx0Um9vdERpcklkO1xyXG4gICAgY29uc3QgZm9ybUlkID0gcGFyZW50RGlyTmFtZSA/IHBhcmVudERpck5hbWUgOiB0aGlzLmRlZmF1bHRQYXJlbnREaXJOYW1lO1xyXG4gICAgaWYgKCFyb290SWQgfHwgIWZvcm1JZCkge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ3Jvb3REaXJJZOWSjHBhcmVudERpck5hbWXkuI3og73kuLrnqbrvvIzor7floavlhpknKTtcclxuICAgIH1cclxuICAgIGNvbnN0IGNvbnRleHQgPSBjb21tYW5kQ29udGV4dC5ldmVudFBhcmFtcy5jb250ZXh0O1xyXG4gICAgY29uc3QgZmlsZUluZm9zID0gdGhpcy5nZXRVcGxvYWRGaWxlSW5mb3NGcm9tQ29udGV4dCgpO1xyXG4gICAgY29uc3QgYXR0YWNobWVudEluZm9zID0gQXR0YWNobWVudFV0aWwuY29udmVydFRvQXR0YWNobWVudEluZm9zKGZpbGVJbmZvcyk7XHJcbiAgICBpZiAoIWF0dGFjaG1lbnRJbmZvcyB8fCBhdHRhY2htZW50SW5mb3MubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgIGFsZXJ0KCfor7flhYjkuIrkvKDpmYTku7YnKTtcclxuICAgICAgcmV0dXJuIEVNUFRZO1xyXG4gICAgfVxyXG4gICAgLy8g5pu05paw5pyN5Yqh5Zmo56uvXHJcbiAgICBjb25zdCB1cGxvYWRVcmwgPSBgJHt1cmx9L3NlcnZpY2UvYmF0Y2h1cGxvYWRhdHRhY2htZW50YDtcclxuICAgIHJldHVybiB0aGlzLmF0dGFjaERhdGFTZXJ2aWNlLnVwZGF0ZVJvd3ModXBsb2FkVXJsLCBhdHRhY2htZW50SW5mb0ZpZWxkUGF0aCwgYXR0YWNobWVudEluZm9zKS5waXBlKFxyXG4gICAgICBtYXAoZSA9PiB7XHJcbiAgICAgICAgLy8g6L+95Yqg5pWw5o2uXHJcbiAgICAgICAgY29udGV4dC5hcHBlbmREYXRhKGUpO1xyXG4gICAgICAgIGNvbnN0IGRhdGFJZHMgPSB0aGlzLmdldERhdGFJZHNUb1JlbW92ZShjb250ZXh0LCBhdHRhY2htZW50SW5mb0ZpZWxkUGF0aCk7XHJcblxyXG4gICAgICAgIGRhdGFJZHMuZm9yRWFjaChkYXRhSWQgPT4ge1xyXG4gICAgICAgICAgLy8g5re75Yqg5qCH6K6wXHJcbiAgICAgICAgICB0aGlzLnZpZXdNb2RlbENvbnRleHQucmVwb3NpdG9yeS5kYXRhQ2hhbmdlSGlzdG9yeS5hZGRDaGFuZ2UoeyBmUGF0aDogJycsIGRhdGFJZDogZGF0YUlkLCBjaGFuZ2VUeXBlOiBEYXRhQ2hhbmdlVHlwZS5BZGQgfSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgcmV0dXJuIGU7XHJcbiAgICAgIH0pXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5om56YeP5Yig6Zmk6ZmE5Lu25omA5Zyo55qE6KGMXHJcbiAgICovXHJcbiAgcHVibGljIHJlbW92ZUF0dGFjaG1lbnRSb3dzKHVybDogc3RyaW5nLCBhdHRhY2htZW50SW5mb0ZpZWxkUGF0aDogc3RyaW5nKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgIGNvbnN0IGNvbnRleHQgPSB0aGlzWydjb250ZXh0J10uZXZlbnRQYXJhbXMuY29udGV4dDtcclxuICAgIGlmICghYXR0YWNobWVudEluZm9GaWVsZFBhdGgpIHtcclxuICAgICAgcmV0dXJuIEVNUFRZO1xyXG4gICAgfVxyXG4gICAgY29uc3QgZGF0YUlkcyA9IHRoaXMuZ2V0RGF0YUlkc1RvUmVtb3ZlKGNvbnRleHQsIGF0dGFjaG1lbnRJbmZvRmllbGRQYXRoKTtcclxuICAgIC8vIOWmguaenOaYr+S4u+ihqFxyXG4gICAgaWYgKGF0dGFjaG1lbnRJbmZvRmllbGRQYXRoLnNwbGl0KCcvJykubGVuZ3RoIDw9IDIpIHtcclxuICAgICAgY29uc3QgcmVtb3ZlVXJsID0gYCR7dXJsfS9leHRlbnNpb24vYmF0Y2hkZWxldGVgO1xyXG4gICAgICByZXR1cm4gdGhpcy5yZW1vdmVEYXRhU2VydmljZS5yZW1vdmVCeUJ1c2luZXNzSWRzKHJlbW92ZVVybCwgZGF0YUlkcykucGlwZShcclxuICAgICAgICBtYXAoKGUpID0+IHtcclxuICAgICAgICAgIGRhdGFJZHMuZm9yRWFjaChkYXRhSWQgPT4ge1xyXG4gICAgICAgICAgICBjb250ZXh0LnJlbW92ZURhdGFCeUlkKGRhdGFJZCk7XHJcbiAgICAgICAgICAgIC8vIOa3u+WKoOagh+iusFxyXG4gICAgICAgICAgICB0aGlzLnZpZXdNb2RlbENvbnRleHQucmVwb3NpdG9yeS5kYXRhQ2hhbmdlSGlzdG9yeS5hZGRDaGFuZ2UoeyBmUGF0aDogJycsIGRhdGFJZDogZGF0YUlkLCBjaGFuZ2VUeXBlOiBEYXRhQ2hhbmdlVHlwZS5EZWxldGUgfSk7XHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICB9KVxyXG4gICAgICApO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgLy8g5aaC5p6c5piv5a2Q6KGoXHJcbiAgICAgIGNvbnN0IHJlbW92ZU9ic2VydmFibGVzOiBPYnNlcnZhYmxlPGFueT5bXSA9IFtdO1xyXG4gICAgICBpZiAoZGF0YUlkcy5sZW5ndGggPT09IDApIHtcclxuICAgICAgICBhbGVydCgn6K+36YCJ5oup6KaB5Yig6Zmk55qE5paH5Lu2Jyk7XHJcbiAgICAgIH1cclxuICAgICAgY29uc3QgYmluZGluZ0xpc3RQYXRoID0gdGhpcy5nZXRCaW5kaW5nTGlzdFBhdGhXaXRoQXR0YWNobWVudHMoYXR0YWNobWVudEluZm9GaWVsZFBhdGgpO1xyXG4gICAgICBkYXRhSWRzLmZvckVhY2goKGRhdGFJZDogc3RyaW5nKSA9PiB7XHJcbiAgICAgICAgY29uc3QgcmVtb3ZlT2JzZXJ2YWJsZSA9IHRoaXMucmVtb3ZlRGF0YVNlcnZpY2UucmVtb3ZlQnlCdXNpbmVzc1BhdGhBbmRJZCh1cmwsIGJpbmRpbmdMaXN0UGF0aCwgZGF0YUlkKTtcclxuICAgICAgICByZW1vdmVPYnNlcnZhYmxlcy5wdXNoKHJlbW92ZU9ic2VydmFibGUpO1xyXG4gICAgICB9KTtcclxuICAgICAgcmV0dXJuIGZvcmtKb2luKHJlbW92ZU9ic2VydmFibGVzKS5waXBlKFxyXG4gICAgICAgIG1hcCgoZSkgPT4ge1xyXG4gICAgICAgICAgY29uc29sZS5sb2coZSk7XHJcbiAgICAgICAgICByZXR1cm4gZTtcclxuICAgICAgICB9KSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvLyAjcmVnaW9uIOW3peWFt+aWueazlVxyXG4gIC8qKlxyXG4gICAqIOS7juS4iuS4i+aWh+S4reS4reiOt+WPluaOp+S7tuS8oOmAkueahOmZhOS7tuS/oeaBr1xyXG4gICAqL1xyXG4gIHByaXZhdGUgZ2V0VXBsb2FkRmlsZUluZm9zRnJvbUNvbnRleHQoKTogQnVzaW5lc3NVcGxvYWRGaWxlSW5mb1tdIHtcclxuICAgIGNvbnN0IGNvbW1hbmRDb250ZXh0ID0gdGhpc1snY29udGV4dCddIGFzIENvbW1hbmRDb250ZXh0O1xyXG4gICAgY29uc3QgdXBsb2FkRmlsZUluZm9zID0gY29tbWFuZENvbnRleHQuZXZlbnRQYXJhbXMuZGF0YSBhcyBCdXNpbmVzc1VwbG9hZEZpbGVJbmZvW107XHJcbiAgICBpZiAoIXVwbG9hZEZpbGVJbmZvcykge1xyXG4gICAgICByZXR1cm4gW107XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdXBsb2FkRmlsZUluZm9zO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog6I635Y+W6KaB5Yig6Zmk55qE6ZmE5Lu25a+55bqU55qE5pWw5o2uaWTmlbDnu4RcclxuICAgKi9cclxuICBwdWJsaWMgZ2V0RGF0YUlkc1RvUmVtb3ZlKGNvbnRleHQ6IGFueSwgYXR0YWNobWVudEluZm9GaWVsZFBhdGg6IHN0cmluZykge1xyXG4gICAgY29uc3QgYXR0YWNoSWRzID0gdGhpcy5nZXRBdHRhY2htZW50SWRzVG9SZW1vdmVGcm9tQ29udGV4dCgpO1xyXG4gICAgY29uc3QgZGF0YUlkczogc3RyaW5nW10gPSBbXTtcclxuICAgIGF0dGFjaElkcy5mb3JFYWNoKChhdHRhY2hJZDogc3RyaW5nKSA9PiB7XHJcblxyXG4gICAgICAvLyDkuIrkvKDliKDpmaTlkozpooTop4jliKDpmaTkvKDpgJLov4fmnaXnmoRmaWxlSWTnmoRrZXnlj6/og73kuI3kuIDoh7TvvIzopoHlgZrlhbzlrrlcclxuICAgICAgY29uc3QgZGF0YUlkID0gdGhpcy5jb252ZXJ0QXR0YWNobWVudElkVG9EYXRhSWQoY29udGV4dCwgYXR0YWNoSWQsIGF0dGFjaG1lbnRJbmZvRmllbGRQYXRoKTtcclxuICAgICAgZGF0YUlkcy5wdXNoKGRhdGFJZCk7XHJcbiAgICB9KTtcclxuICAgIHJldHVybiBkYXRhSWRzO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5LuO5ZG95Luk5LiK5LiL5paH5Lit6I635Y+W6KaB5Yig6Zmk6ZmE5Lu2aWRzXHJcbiAgICovXHJcbiAgcHVibGljIGdldEF0dGFjaG1lbnRJZHNUb1JlbW92ZUZyb21Db250ZXh0KCkge1xyXG4gICAgY29uc3QgY29tbWFuZENvbnRleHQgPSB0aGlzWydjb250ZXh0J10gYXMgQ29tbWFuZENvbnRleHQ7XHJcbiAgICByZXR1cm4gY29tbWFuZENvbnRleHQuZXZlbnRQYXJhbXMuZGF0YS5tYXAoZGF0YUl0ZW0gPT4ge1xyXG4gICAgICByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKGRhdGFJdGVtKSA9PT0gJ1tvYmplY3QgT2JqZWN0XScgPyBkYXRhSXRlbS5tZXRhZGF0YUlkIDogZGF0YUl0ZW07XHJcbiAgICB9KTtcclxuICAgIC8vIHJldHVybiBjb21tYW5kQ29udGV4dC5ldmVudFBhcmFtcy5kYXRhIGFzIHN0cmluZ1tdO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5qC55o2u6Lev5b6E6I635Y+W6ZmE5Lu25a2X5q615YC85pWw57uEXHJcbiAgICogQHBhcmFtIGZpZWxkUGF0aCDlrZfmrrXot6/lvoRcclxuICAgKi9cclxuICBwcml2YXRlIGNvbnZlcnRBdHRhY2htZW50SWRUb0RhdGFJZChjb250ZXh0OiBhbnksIGZpbGVJZDogc3RyaW5nLCBhdHRhY2htZW50SW5mb0ZpZWxkUGF0aDogc3RyaW5nKTogc3RyaW5nIHtcclxuXHJcbiAgICAvLyDop6PmnpDot6/lvoRcclxuICAgIGNvbnN0IGF0dGFjaEluZm9CaW5kaW5nUGF0aCA9IEJpbmRpbmdQYXRoQ29udmVydGVyLnRvQmluZGluZ1BhdGhBcnJheShhdHRhY2htZW50SW5mb0ZpZWxkUGF0aCk7XHJcbiAgICBjb25zdCBhdHRhY2hGaWVsZE5hbWUgPSBhdHRhY2hJbmZvQmluZGluZ1BhdGgucG9wKCk7XHJcbiAgICBjb25zdCBhdHRhY2hMaXN0QmluZGluZ1BhdGggPSBhdHRhY2hJbmZvQmluZGluZ1BhdGg7XHJcblxyXG4gICAgLy8g6I635Y+W6ZmE5Lu2aWTmlbDnu4RcclxuICAgIC8vIGNvbnN0IGVudGl0eUxpc3REYXRhID0gdGhpcy5lbnRpdHlTZXJ2aWNlLmdldEVudGl0eUxpc3REYXRhKGF0dGFjaExpc3RCaW5kaW5nUGF0aCk7XHJcbiAgICBjb25zdCBlbnRpdHlMaXN0RGF0YSA9IGNvbnRleHQuZGF0YTtcclxuICAgIGNvbnN0IHRhcmdldEVudGl0eURhdGEgPSBlbnRpdHlMaXN0RGF0YS5maW5kKChlbnRpdHlEYXRhOiBhbnkpID0+IHtcclxuICAgICAgaWYgKGVudGl0eURhdGFbYXR0YWNoRmllbGROYW1lXSkge1xyXG4gICAgICAgIGNvbnN0IGF0dGFjaG1lbnRJZCA9IGVudGl0eURhdGFbYXR0YWNoRmllbGROYW1lXVsnYXR0YWNobWVudElkJ107XHJcbiAgICAgICAgaWYgKGF0dGFjaG1lbnRJZCA9PT0gZmlsZUlkKSB7XHJcbiAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG5cclxuICAgIHJldHVybiB0YXJnZXRFbnRpdHlEYXRhLmlkO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog6I635Y+W5bim6ZmE5Lu255qEQmluZGluZ0xpc3TnmoRQYXRoXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBnZXRCaW5kaW5nTGlzdFBhdGhXaXRoQXR0YWNobWVudHMoYXR0YWNobWVudEluZm9GaWVsZFBhdGg6IHN0cmluZykge1xyXG4gICAgY29uc3QgYXR0YWNoSW5mb0JpbmRpbmdQYXRoID0gQmluZGluZ1BhdGhDb252ZXJ0ZXIudG9CaW5kaW5nUGF0aEFycmF5KGF0dGFjaG1lbnRJbmZvRmllbGRQYXRoKTtcclxuICAgIGF0dGFjaEluZm9CaW5kaW5nUGF0aC5wb3AoKTtcclxuICAgIGNvbnN0IGJpbmRpbmdMaXN0UGF0aCA9IGF0dGFjaEluZm9CaW5kaW5nUGF0aDtcclxuICAgIHJldHVybiAnLycgKyBiaW5kaW5nTGlzdFBhdGguam9pbignLycpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog6I635Y+W6ZmE5Lu257uE5Lu25LiK5LiL5paHXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBnZXRBdHRhY2hDb250ZXh0KCk6IGFueSB7XHJcbiAgICBjb25zdCBjb21tYW5kQ29udGV4dCA9IHRoaXNbJ2NvbnRleHQnXSBhcyBDb21tYW5kQ29udGV4dDtcclxuICAgIGNvbnN0IGF0dGFjaENvbnRleHQgPSBjb21tYW5kQ29udGV4dCAmJiBjb21tYW5kQ29udGV4dC5ldmVudFBhcmFtcyA/IGNvbW1hbmRDb250ZXh0LmV2ZW50UGFyYW1zIDoge307XHJcbiAgICByZXR1cm4gYXR0YWNoQ29udGV4dDtcclxuICB9XHJcblxyXG4gIC8vICNlbmRyZWdpb25cclxuXHJcbn1cclxuXHJcbmV4cG9ydCB7IEJ1c2luZXNzQXR0YWNobWVudFNlcnZpY2UgfTtcclxuIl19
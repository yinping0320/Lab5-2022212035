/**
 * @fileoverview added by tsickle
 * Generated from: lib/entity-services/entity-aggregation.service.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { BindingList } from '@farris/mobile-devkit';
import { EntityTraversingService } from './entity-traversing.service';
/**
 * @record
 */
function SplitedPath() { }
if (false) {
    /** @type {?} */
    SplitedPath.prototype.listPath;
    /** @type {?} */
    SplitedPath.prototype.propPath;
}
/**
 * 实体聚合服务
 */
var /**
 * 实体聚合服务
 */
EntityAggregationService = /** @class */ (function () {
    function EntityAggregationService(viewModelContext) {
        this.viewModelContext = viewModelContext;
        this.traversingService = this.viewModelContext.injector.get(EntityTraversingService);
    }
    Object.defineProperty(EntityAggregationService.prototype, "bindingData", {
        get: /**
         * @private
         * @return {?}
         */
        function () {
            return this.viewModelContext.bindingData;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * 获取path对应列表记录的条数
     */
    /**
     * 获取path对应列表记录的条数
     * @param {?} path
     * @return {?}
     */
    EntityAggregationService.prototype.count = /**
     * 获取path对应列表记录的条数
     * @param {?} path
     * @return {?}
     */
    function (path) {
        /** @type {?} */
        var splitedPath = this.splitPath(path);
        /** @type {?} */
        var entityListData = this.traversingService.getEntityListData(splitedPath.listPath);
        return entityListData.length;
    };
    /**
     * 获取path对应字段的和
     */
    /**
     * 获取path对应字段的和
     * @param {?} path
     * @return {?}
     */
    EntityAggregationService.prototype.sum = /**
     * 获取path对应字段的和
     * @param {?} path
     * @return {?}
     */
    function (path) {
        var _this = this;
        /** @type {?} */
        var splitedPath = this.splitPath(path);
        /** @type {?} */
        var entityListData = this.traversingService.getEntityListData(splitedPath.listPath);
        /** @type {?} */
        var total = entityListData.reduce((/**
         * @param {?} accTotal
         * @param {?} entityData
         * @return {?}
         */
        function (accTotal, entityData) {
            /** @type {?} */
            var propValue = parseFloat(_this.getPropValue(entityData, splitedPath.propPath));
            propValue = isNaN(propValue) ? 0 : propValue;
            accTotal += propValue;
            return accTotal;
        }), 0);
        return total;
    };
    /**
     * 获取path对应字段的平均值
     */
    /**
     * 获取path对应字段的平均值
     * @param {?} path
     * @return {?}
     */
    EntityAggregationService.prototype.avg = /**
     * 获取path对应字段的平均值
     * @param {?} path
     * @return {?}
     */
    function (path) {
        /** @type {?} */
        var count = this.count(path);
        /** @type {?} */
        var total = this.sum(path);
        return count !== 0 ? total / count : 0;
    };
    /**
     * 获取path对应字段的最大值
     */
    /**
     * 获取path对应字段的最大值
     * @param {?} path
     * @return {?}
     */
    EntityAggregationService.prototype.max = /**
     * 获取path对应字段的最大值
     * @param {?} path
     * @return {?}
     */
    function (path) {
        var _this = this;
        /** @type {?} */
        var splitedPath = this.splitPath(path);
        /** @type {?} */
        var entityListData = this.traversingService.getEntityListData(splitedPath.listPath);
        /** @type {?} */
        var max = entityListData.reduce((/**
         * @param {?} accMax
         * @param {?} entityData
         * @return {?}
         */
        function (accMax, entityData) {
            /** @type {?} */
            var propValue = parseFloat(_this.getPropValue(entityData, splitedPath.propPath));
            if (isNaN(propValue) === false && (!accMax || propValue > accMax)) {
                accMax = propValue;
            }
            return accMax;
        }), null);
        return max ? max : 0;
    };
    /**
     * 获取path对应字段的最小值
     */
    /**
     * 获取path对应字段的最小值
     * @param {?} path
     * @return {?}
     */
    EntityAggregationService.prototype.min = /**
     * 获取path对应字段的最小值
     * @param {?} path
     * @return {?}
     */
    function (path) {
        var _this = this;
        /** @type {?} */
        var splitedPath = this.splitPath(path);
        /** @type {?} */
        var entityListData = this.traversingService.getEntityListData(splitedPath.listPath);
        /** @type {?} */
        var min = entityListData.reduce((/**
         * @param {?} accMin
         * @param {?} entityData
         * @return {?}
         */
        function (accMin, entityData) {
            /** @type {?} */
            var propValue = parseFloat(_this.getPropValue(entityData, splitedPath.propPath));
            if (isNaN(propValue) === false && (!accMin || propValue < accMin)) {
                accMin = propValue;
            }
            return accMin;
        }), null);
        return min ? min : 0;
    };
    /**
     * 获取属性值
     */
    /**
     * 获取属性值
     * @private
     * @param {?} entityData
     * @param {?} path
     * @return {?}
     */
    EntityAggregationService.prototype.getPropValue = /**
     * 获取属性值
     * @private
     * @param {?} entityData
     * @param {?} path
     * @return {?}
     */
    function (entityData, path) {
        /** @type {?} */
        var currentData = entityData;
        path.forEach((/**
         * @param {?} pathItem
         * @return {?}
         */
        function (pathItem) {
            // 提前退出的都重置为null，主要针对关联对象未赋值场景
            if (!currentData) {
                currentData = null;
                return;
            }
            currentData = currentData[pathItem];
        }));
        return currentData;
    };
    /**
     * 分隔路径，分隔符列表路径和属性路径
     * @return 形如 {parentListPath: [], propertyPath: []}
     */
    /**
     * 分隔路径，分隔符列表路径和属性路径
     * @private
     * @param {?} path
     * @return {?} 形如 {parentListPath: [], propertyPath: []}
     */
    EntityAggregationService.prototype.splitPath = /**
     * 分隔路径，分隔符列表路径和属性路径
     * @private
     * @param {?} path
     * @return {?} 形如 {parentListPath: [], propertyPath: []}
     */
    function (path) {
        /** @type {?} */
        var listPath = path.concat([]);
        /** @type {?} */
        var propPath = [];
        /** @type {?} */
        var currentNode = this.bindingData.getValue(listPath);
        while (currentNode instanceof BindingList !== true) {
            /** @type {?} */
            var propPathItem = listPath.pop();
            if (!propPathItem) {
                return;
            }
            propPath.unshift(propPathItem);
            currentNode = this.bindingData.getValue(listPath);
        }
        return {
            listPath: listPath,
            propPath: propPath
        };
    };
    return EntityAggregationService;
}());
if (false) {
    /**
     * @type {?}
     * @private
     */
    EntityAggregationService.prototype.traversingService;
    /**
     * @type {?}
     * @private
     */
    EntityAggregationService.prototype.viewModelContext;
}
export { EntityAggregationService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZW50aXR5LWFnZ3JlZ2F0aW9uLnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL21vYmlsZS1jb21tYW5kLXNlcnZpY2VzLyIsInNvdXJjZXMiOlsibGliL2VudGl0eS1zZXJ2aWNlcy9lbnRpdHktYWdncmVnYXRpb24uc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFBaUMsV0FBVyxFQUFFLE1BQU0sdUJBQXVCLENBQUM7QUFDbkYsT0FBTyxFQUFFLHVCQUF1QixFQUFFLE1BQU0sNkJBQTZCLENBQUM7Ozs7QUFFdEUsMEJBR0M7OztJQUZDLCtCQUFtQjs7SUFDbkIsK0JBQW1COzs7OztBQU1yQjs7OztJQVFFLGtDQUFvQixnQkFBa0M7UUFBbEMscUJBQWdCLEdBQWhCLGdCQUFnQixDQUFrQjtRQUNwRCxJQUFJLENBQUMsaUJBQWlCLEdBQUssSUFBSSxDQUFDLGdCQUFnQixDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQTBCLHVCQUF1QixDQUFDLENBQUM7SUFDbEgsQ0FBQztJQVJELHNCQUFZLGlEQUFXOzs7OztRQUF2QjtZQUNFLE9BQU8sSUFBSSxDQUFDLGdCQUFnQixDQUFDLFdBQVcsQ0FBQztRQUMzQyxDQUFDOzs7T0FBQTtJQVFEOztPQUVHOzs7Ozs7SUFDSSx3Q0FBSzs7Ozs7SUFBWixVQUFhLElBQWM7O1lBQ25CLFdBQVcsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQzs7WUFDbEMsY0FBYyxHQUFHLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxpQkFBaUIsQ0FBQyxXQUFXLENBQUMsUUFBUSxDQUFDO1FBQ3JGLE9BQU8sY0FBYyxDQUFDLE1BQU0sQ0FBQztJQUMvQixDQUFDO0lBRUQ7O09BRUc7Ozs7OztJQUNJLHNDQUFHOzs7OztJQUFWLFVBQVcsSUFBYztRQUF6QixpQkFXQzs7WUFWTyxXQUFXLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUM7O1lBQ2xDLGNBQWMs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Yzs7WUFDOUMsV0FBVyxHQUFHLFVBQVU7UUFDNUIsSUFBSSxDQUFDLE9BQU87Ozs7UUFBQyxVQUFDLFFBQWdCO1lBRTVCLDhCQUE4QjtZQUM5QixJQUFJLENBQUMsV0FBVyxFQUFFO2dCQUNoQixXQUFXLEdBQUcsSUFBSSxDQUFDO2dCQUNuQixPQUFPO2FBQ1I7WUFDRCxXQUFXLEdBQUcsV0FBVyxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBQ3RDLENBQUMsRUFBQyxDQUFDO1FBRUgsT0FBTyxXQUFXLENBQUM7SUFDckIsQ0FBQztJQUVEOzs7T0FHRzs7Ozs7OztJQUNLLDRDQUFTOzs7Ozs7SUFBakIsVUFBa0IsSUFBYzs7WUFDeEIsUUFBUSxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDOztZQUMxQixRQUFRLEdBQUcsRUFBRTs7WUFDZixXQUFXLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDO1FBQ3JELE9BQU8sV0FBVyxZQUFZLFdBQVcsS0FBSyxJQUFJLEVBQUU7O2dCQUM1QyxZQUFZLEdBQUcsUUFBUSxDQUFDLEdBQUcsRUFBRTtZQUNuQyxJQUFJLENBQUMsWUFBWSxFQUFFO2dCQUNqQixPQUFPO2FBQ1I7WUFDRCxRQUFRLENBQUMsT0FBTyxDQUFDLFlBQVksQ0FBQyxDQUFDO1lBQy9CLFdBQVcsR0FBRyxJQUFJLENBQUMsV0FBVyxDQUFDLFFBQVEsQ0FBQyxRQUFRLENBQUMsQ0FBQztTQUNuRDtRQUVELE9BQU87WUFDTCxRQUFRLEVBQUUsUUFBUTtZQUNsQixRQUFRLEVBQUUsUUFBUTtTQUNuQixDQUFDO0lBQ0osQ0FBQztJQUVILCtCQUFDO0FBQUQsQ0FBQyxBQXpIRCxJQXlIQzs7Ozs7O0lBbkhDLHFEQUFtRDs7Ozs7SUFFdkMsb0RBQTBDOztBQW1IeEQsT0FBTyxFQUFFLHdCQUF3QixFQUFFLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBWaWV3TW9kZWxDb250ZXh0LCBCaW5kaW5nRGF0YSwgQmluZGluZ0xpc3QgfSBmcm9tICdAZmFycmlzL21vYmlsZS1kZXZraXQnO1xyXG5pbXBvcnQgeyBFbnRpdHlUcmF2ZXJzaW5nU2VydmljZSB9IGZyb20gJy4vZW50aXR5LXRyYXZlcnNpbmcuc2VydmljZSc7XHJcblxyXG5pbnRlcmZhY2UgU3BsaXRlZFBhdGgge1xyXG4gIGxpc3RQYXRoOiBzdHJpbmdbXTtcclxuICBwcm9wUGF0aDogc3RyaW5nW107XHJcbn1cclxuXHJcbi8qKlxyXG4gKiDlrp7kvZPogZrlkIjmnI3liqFcclxuICovXHJcbmNsYXNzIEVudGl0eUFnZ3JlZ2F0aW9uU2VydmljZSB7XHJcblxyXG4gIHByaXZhdGUgZ2V0IGJpbmRpbmdEYXRhKCk6IEJpbmRpbmdEYXRhIHtcclxuICAgIHJldHVybiB0aGlzLnZpZXdNb2RlbENvbnRleHQuYmluZGluZ0RhdGE7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHRyYXZlcnNpbmdTZXJ2aWNlOiBFbnRpdHlUcmF2ZXJzaW5nU2VydmljZTtcclxuXHJcbiAgY29uc3RydWN0b3IocHJpdmF0ZSB2aWV3TW9kZWxDb250ZXh0OiBWaWV3TW9kZWxDb250ZXh0KSB7XHJcbiAgICB0aGlzLnRyYXZlcnNpbmdTZXJ2aWNlICAgPSB0aGlzLnZpZXdNb2RlbENvbnRleHQuaW5qZWN0b3IuZ2V0PEVudGl0eVRyYXZlcnNpbmdTZXJ2aWNlPihFbnRpdHlUcmF2ZXJzaW5nU2VydmljZSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDojrflj5ZwYXRo5a+55bqU5YiX6KGo6K6w5b2V55qE5p2h5pWwXHJcbiAgICovXHJcbiAgcHVibGljIGNvdW50KHBhdGg6IHN0cmluZ1tdKTogbnVtYmVyIHtcclxuICAgIGNvbnN0IHNwbGl0ZWRQYXRoID0gdGhpcy5zcGxpdFBhdGgocGF0aCk7XHJcbiAgICBjb25zdCBlbnRpdHlMaXN0RGF0YSA9IHRoaXMudHJhdmVyc2luZ1NlcnZpY2UuZ2V0RW50aXR5TGlzdERhdGEoc3BsaXRlZFBhdGgubGlzdFBhdGgpO1xyXG4gICAgcmV0dXJuIGVudGl0eUxpc3REYXRhLmxlbmd0aDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOiOt+WPlnBhdGjlr7nlupTlrZfmrrXnmoTlkoxcclxuICAgKi9cclxuICBwdWJsaWMgc3VtKHBhdGg6IHN0cmluZ1tdKSB7XHJcbiAgICBjb25zdCBzcGxpdGVkUGF0aCA9IHRoaXMuc3BsaXRQYXRoKHBhdGgpO1xyXG4gICAgY29uc3QgZW50aXR5TGlzdERhdGEgPSB0aGlzLnRyYXZlcnNpbmdTZXJ2aWNlLmdldEVudGl0eUxpc3REYXRhKHNwbGl0ZWRQYXRoLmxpc3RQYXRoKTtcclxuXHJcbiAgICBjb25zdCB0b3RhbCA9IGVudGl0eUxpc3REYXRhLnJlZHVjZSgoYWNjVG90YWw6IG51bWJlciwgZW50aXR5RGF0YTogYW55KSA9PiB7XHJcbiAgICAgIGxldCBwcm9wVmFsdWUgPSBwYXJzZUZsb2F0KHRoaXMuZ2V0UHJvcFZhbHVlKGVudGl0eURhdGEsIHNwbGl0ZWRQYXRoLnByb3BQYXRoKSk7XHJcbiAgICAgIHByb3BWYWx1ZSA9IGlzTmFOKHByb3BWYWx1ZSkgPyAwIDogcHJvcFZhbHVlO1xyXG4gICAgICBhY2NUb3RhbCArPSBwcm9wVmFsdWU7XHJcbiAgICAgIHJldHVybiBhY2NUb3RhbDtcclxuICAgIH0sIDApO1xyXG4gICAgcmV0dXJuIHRvdGFsO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog6I635Y+WcGF0aOWvueW6lOWtl+auteeahOW5s+Wdh+WAvFxyXG4gICAqL1xyXG4gIHB1YmxpYyBhdmcocGF0aDogc3RyaW5nW10pIHtcclxuICAgIGNvbnN0IGNvdW50ID0gdGhpcy5jb3VudChwYXRoKTtcclxuICAgIGNvbnN0IHRvdGFsID0gdGhpcy5zdW0ocGF0aCk7XHJcbiAgICByZXR1cm4gY291bnQgIT09IDAgPyB0b3RhbCAvIGNvdW50IDogMDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOiOt+WPlnBhdGjlr7nlupTlrZfmrrXnmoTmnIDlpKflgLxcclxuICAgKi9cclxuICBwdWJsaWMgbWF4KHBhdGg6IHN0cmluZ1tdKTogbnVtYmVyIHtcclxuICAgIGNvbnN0IHNwbGl0ZWRQYXRoID0gdGhpcy5zcGxpdFBhdGgocGF0aCk7XHJcbiAgICBjb25zdCBlbnRpdHlMaXN0RGF0YSA9IHRoaXMudHJhdmVyc2luZ1NlcnZpY2UuZ2V0RW50aXR5TGlzdERhdGEoc3BsaXRlZFBhdGgubGlzdFBhdGgpO1xyXG5cclxuICAgIGNvbnN0IG1heCA9ICBlbnRpdHlMaXN0RGF0YS5yZWR1Y2UoKGFjY01heDogbnVtYmVyLCBlbnRpdHlEYXRhOiBhbnkpID0+IHtcclxuICAgICAgY29uc3QgcHJvcFZhbHVlID0gcGFyc2VGbG9hdCh0aGlzLmdldFByb3BWYWx1ZShlbnRpdHlEYXRhLCBzcGxpdGVkUGF0aC5wcm9wUGF0aCkpO1xyXG4gICAgICBpZiAoaXNOYU4ocHJvcFZhbHVlKSA9PT0gZmFsc2UgJiYgKCAhYWNjTWF4IHx8IHByb3BWYWx1ZSA+IGFjY01heCkpIHtcclxuICAgICAgICBhY2NNYXggPSBwcm9wVmFsdWU7XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIGFjY01heDtcclxuICAgIH0sIG51bGwpO1xyXG4gICAgcmV0dXJuIG1heCA/IG1heCA6IDA7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDojrflj5ZwYXRo5a+55bqU5a2X5q6155qE5pyA5bCP5YC8XHJcbiAgICovXHJcbiAgcHVibGljIG1pbihwYXRoOiBzdHJpbmdbXSk6IG51bWJlciB7XHJcbiAgICBjb25zdCBzcGxpdGVkUGF0aCA9IHRoaXMuc3BsaXRQYXRoKHBhdGgpO1xyXG4gICAgY29uc3QgZW50aXR5TGlzdERhdGEgPSB0aGlzLnRyYXZlcnNpbmdTZXJ2aWNlLmdldEVudGl0eUxpc3REYXRhKHNwbGl0ZWRQYXRoLmxpc3RQYXRoKTtcclxuXHJcbiAgICBjb25zdCBtaW4gPSBlbnRpdHlMaXN0RGF0YS5yZWR1Y2UoKGFjY01pbjogbnVtYmVyLCBlbnRpdHlEYXRhOiBhbnkpID0+IHtcclxuICAgICAgY29uc3QgcHJvcFZhbHVlID0gcGFyc2VGbG9hdCh0aGlzLmdldFByb3BWYWx1ZShlbnRpdHlEYXRhLCBzcGxpdGVkUGF0aC5wcm9wUGF0aCkpO1xyXG4gICAgICBpZiAoaXNOYU4ocHJvcFZhbHVlKSA9PT0gZmFsc2UgJiYgKCAhYWNjTWluIHx8IHByb3BWYWx1ZSA8IGFjY01pbikpIHtcclxuICAgICAgICBhY2NNaW4gPSBwcm9wVmFsdWU7XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIGFjY01pbjtcclxuICAgIH0sIG51bGwpO1xyXG4gICAgcmV0dXJuIG1pbiA/IG1pbiA6IDA7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDojrflj5blsZ7mgKflgLxcclxuICAgKi9cclxuICBwcml2YXRlIGdldFByb3BWYWx1ZShlbnRpdHlEYXRhOiBhbnksIHBhdGg6IHN0cmluZ1tdKSB7XHJcbiAgICBsZXQgY3VycmVudERhdGEgPSBlbnRpdHlEYXRhO1xyXG4gICAgcGF0aC5mb3JFYWNoKChwYXRoSXRlbTogc3RyaW5nKSA9PiB7XHJcblxyXG4gICAgICAvLyDmj5DliY3pgIDlh7rnmoTpg73ph43nva7kuLpudWxs77yM5Li76KaB6ZKI5a+55YWz6IGU5a+56LGh5pyq6LWL5YC85Zy65pmvXHJcbiAgICAgIGlmICghY3VycmVudERhdGEpIHtcclxuICAgICAgICBjdXJyZW50RGF0YSA9IG51bGw7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgICB9XHJcbiAgICAgIGN1cnJlbnREYXRhID0gY3VycmVudERhdGFbcGF0aEl0ZW1dO1xyXG4gICAgfSk7XHJcblxyXG4gICAgcmV0dXJuIGN1cnJlbnREYXRhO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5YiG6ZqU6Lev5b6E77yM5YiG6ZqU56ym5YiX6KGo6Lev5b6E5ZKM5bGe5oCn6Lev5b6EXHJcbiAgICogQHJldHVybiDlvaLlpoIge3BhcmVudExpc3RQYXRoOiBbXSwgcHJvcGVydHlQYXRoOiBbXX1cclxuICAgKi9cclxuICBwcml2YXRlIHNwbGl0UGF0aChwYXRoOiBzdHJpbmdbXSk6IFNwbGl0ZWRQYXRoIHtcclxuICAgIGNvbnN0IGxpc3RQYXRoID0gcGF0aC5jb25jYXQoW10pO1xyXG4gICAgY29uc3QgcHJvcFBhdGggPSBbXTtcclxuICAgIGxldCBjdXJyZW50Tm9kZSA9IHRoaXMuYmluZGluZ0RhdGEuZ2V0VmFsdWUobGlzdFBhdGgpO1xyXG4gICAgd2hpbGUgKGN1cnJlbnROb2RlIGluc3RhbmNlb2YgQmluZGluZ0xpc3QgIT09IHRydWUpIHtcclxuICAgICAgY29uc3QgcHJvcFBhdGhJdGVtID0gbGlzdFBhdGgucG9wKCk7XHJcbiAgICAgIGlmICghcHJvcFBhdGhJdGVtKSB7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgICB9XHJcbiAgICAgIHByb3BQYXRoLnVuc2hpZnQocHJvcFBhdGhJdGVtKTtcclxuICAgICAgY3VycmVudE5vZGUgPSB0aGlzLmJpbmRpbmdEYXRhLmdldFZhbHVlKGxpc3RQYXRoKTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBsaXN0UGF0aDogbGlzdFBhdGgsXHJcbiAgICAgIHByb3BQYXRoOiBwcm9wUGF0aFxyXG4gICAgfTtcclxuICB9XHJcblxyXG59XHJcblxyXG5leHBvcnQgeyBFbnRpdHlBZ2dyZWdhdGlvblNlcnZpY2UgfTtcclxuIl19
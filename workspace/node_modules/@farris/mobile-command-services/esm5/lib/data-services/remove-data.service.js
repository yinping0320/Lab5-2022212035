/**
 * @fileoverview added by tsickle
 * Generated from: lib/data-services/remove-data.service.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { of, EMPTY } from 'rxjs';
import { tap, switchMap } from 'rxjs/operators';
import { HttpMethods } from '@farris/mobile-devkit';
import { DataUtil } from './data-util';
import { BaseDataService } from './base-data.service';
/**
 * 删除数据服务类
 */
var /**
 * 删除数据服务类
 */
RemoveDataService = /** @class */ (function (_super) {
    tslib_1.__extends(RemoveDataService, _super);
    function RemoveDataService(viewModelContext) {
        return _super.call(this, viewModelContext) || this;
    }
    /**
     * 删除数据
     */
    /**
     * 删除数据
     * @param {?} id
     * @return {?}
     */
    RemoveDataService.prototype.removeById = /**
     * 删除数据
     * @param {?} id
     * @return {?}
     */
    function (id) {
        var _this = this;
        /** @type {?} */
        var result$ = this.dialogService.confirm('是否删除').pipe(switchMap((/**
         * @param {?} val
         * @return {?}
         */
        function (val) {
            if (val === false) {
                return EMPTY;
            }
            if (_this['context'] && _this['context'].eventParams && _this['context'].eventParams.swipecellClose) {
                _this['context'].eventParams.swipecellClose();
            }
            return _this.cancelChanges(id);
        })));
        return result$;
    };
    /**
     * 确认删除
     * @param id
     */
    /**
     * 确认删除
     * @private
     * @param {?} id
     * @return {?}
     */
    RemoveDataService.prototype.cancelChanges = /**
     * 确认删除
     * @private
     * @param {?} id
     * @return {?}
     */
    function (id) {
        var _this = this;
        this.loadingService.show();
        /** @type {?} */
        var remove$ = this.befRepository.removeEntityAndSaveById(id);
        return remove$.pipe(tap((/**
         * @return {?}
         */
        function () {
            _this.notifyService.success('删除成功');
            _this.loadingService.hide();
        }), (/**
         * @return {?}
         */
        function () {
            _this.loadingService.hide();
            _this.notifyService.error('删除失败');
        })));
    };
    /**
     * 批量删除数据
     */
    /**
     * 批量删除数据
     * @param {?} ids
     * @return {?}
     */
    RemoveDataService.prototype.removeByIds = /**
     * 批量删除数据
     * @param {?} ids
     * @return {?}
     */
    function (ids) {
        var _this = this;
        // 由于ListView尚未和UIState集成，无法直接获取ids，临时从事件参数中获取
        if (!ids) {
            /** @type {?} */
            var selectedItems = this['context'].eventParams;
            ids = selectedItems.map((/**
             * @param {?} selectedItem
             * @return {?}
             */
            function (selectedItem) {
                return selectedItem.id;
            }));
        }
        /** @type {?} */
        var multiRemove$ = this.dialogService.confirm('是否删除').pipe(switchMap((/**
         * @param {?} val
         * @return {?}
         */
        function (val) {
            if (val === false) {
                return EMPTY;
            }
            _this.loadingService.show();
            return _this.befRepository.removeEntitiesByIds(ids);
        })));
        return multiRemove$.pipe(tap((/**
         * @return {?}
         */
        function () {
            _this.loadingService.hide();
            _this.notifyService.success('删除成功');
        }), (/**
         * @param {?} exception
         * @return {?}
         */
        function (exception) {
            _this.loadingService.hide();
            // this.exceptionService.show('删除失败', exception);
        })));
    };
    /**
     * 删除后代节点数据
     */
    /**
     * 删除后代节点数据
     * @param {?} path
     * @param {?} id
     * @return {?}
     */
    RemoveDataService.prototype.removeByPathAndId = /**
     * 删除后代节点数据
     * @param {?} path
     * @param {?} id
     * @return {?}
     */
    function (path, id) {
        var _this = this;
        /** @type {?} */
        var result$ = this.dialogService.confirm('是否删除').pipe(switchMap((/**
         * @param {?} val
         * @return {?}
         */
        function (val) {
            if (val === false) {
                return EMPTY;
            }
            if (_this['context'] && _this['context'].eventParams && _this['context'].eventParams.swipecellClose) {
                _this['context'].eventParams.swipecellClose();
            }
            return _this.removeByPathAndIdChanges(path, id);
        })));
        return result$;
    };
    /**
     * @param {?} path
     * @param {?} id
     * @return {?}
     */
    RemoveDataService.prototype.removeByPathAndIdChanges = /**
     * @param {?} path
     * @param {?} id
     * @return {?}
     */
    function (path, id) {
        var _this = this;
        this.loadingService.show();
        /** @type {?} */
        var entityPath = DataUtil.convertBindingPathToEntityPath(path, this.viewModelContext);
        /** @type {?} */
        var remove$ = this.befRepository.removeEntityByPath(entityPath, id);
        return remove$.pipe(tap((/**
         * @return {?}
         */
        function () {
            _this.loadingService.hide();
            _this.notifyService.success('删除成功');
        }), (/**
         * @param {?} error
         * @return {?}
         */
        function (error) {
            _this.loadingService.hide();
            console.error(error);
        })));
    };
    /**
     * 批量删除后代节点数据
     */
    /**
     * 批量删除后代节点数据
     * @param {?} path
     * @param {?} ids
     * @return {?}
     */
    RemoveDataService.prototype.removeByPathAndIds = /**
     * 批量删除后代节点数据
     * @param {?} path
     * @param {?} ids
     * @return {?}
     */
    function (path, ids) {
        throw new Error('Not Implemented');
    };
    /**
     * 业务附件批量删除数据
     */
    /**
     * 业务附件批量删除数据
     * @param {?} url
     * @param {?} ids
     * @return {?}
     */
    RemoveDataService.prototype.removeByBusinessIds = /**
     * 业务附件批量删除数据
     * @param {?} url
     * @param {?} ids
     * @return {?}
     */
    function (url, ids) {
        // 由于ListView尚未和UIState集成，无法直接获取ids，临时从事件参数中获取
        if (!ids) {
            /** @type {?} */
            var selectedItems = this['context'].eventParams;
            ids = selectedItems.map((/**
             * @param {?} selectedItem
             * @return {?}
             */
            function (selectedItem) {
                return selectedItem.id;
            }));
        }
        /** @type {?} */
        var params = {
            ids: ids.join(',')
        };
        /** @type {?} */
        var requestConfig = {
            params: params,
            body: {
                dataChange: [],
                variableChange: null
            }
        };
        return this.befRepository.apiProxy.request(HttpMethods.PUT, url, requestConfig, true);
        // this.loadingService.show();
        // const multiRemove$ = this.dialogService.confirm('是否删除').pipe(
        //   switchMap(val => {
        //     if (val === false) {
        //       return EMPTY;
        //     }
        //   }));
        // return multiRemove$.pipe(
        //   tap(
        //     () => {
        //       this.loadingService.hide();
        //     },
        //     (exception: any) => {
        //       this.loadingService.hide();
        //     }
        //   )
        // );
    };
    /**
     * 业务附件删除后代节点数据
     */
    /**
     * 业务附件删除后代节点数据
     * @param {?} url
     * @param {?} path
     * @param {?} id
     * @return {?}
     */
    RemoveDataService.prototype.removeByBusinessPathAndId = /**
     * 业务附件删除后代节点数据
     * @param {?} url
     * @param {?} path
     * @param {?} id
     * @return {?}
     */
    function (url, path, id) {
        var _this = this;
        /** @type {?} */
        var result$ = this.dialogService.confirm('是否删除').pipe(switchMap((/**
         * @param {?} val
         * @return {?}
         */
        function (val) {
            if (val === false) {
                return EMPTY;
            }
            return _this.befRepository.apiProxy.request(HttpMethods.PUT, url);
        })));
        return result$;
    };
    /**
     * 子表清除编辑与新增标记
     * @returns
     */
    /**
     * 子表清除编辑与新增标记
     * @return {?}
     */
    RemoveDataService.prototype.ClearStatusAfterchildCardSave = /**
     * 子表清除编辑与新增标记
     * @return {?}
     */
    function () {
        this.viewModelContext.uiState.setPropertyValue('$isAdd', null);
        this.viewModelContext.uiState.setPropertyValue('$childEntity', null);
        return of(true);
    };
    return RemoveDataService;
}(BaseDataService));
/**
 * 删除数据服务类
 */
export { RemoveDataService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmVtb3ZlLWRhdGEuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvbW9iaWxlLWNvbW1hbmQtc2VydmljZXMvIiwic291cmNlcyI6WyJsaWIvZGF0YS1zZXJ2aWNlcy9yZW1vdmUtZGF0YS5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBLE9BQU8sRUFBYyxFQUFFLEVBQUUsS0FBSyxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQzdDLE9BQU8sRUFBRSxHQUFHLEVBQUUsU0FBUyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDaEQsT0FBTyxFQUFVLFdBQVcsRUFBdUMsTUFBTSx1QkFBdUIsQ0FBQztBQUVqRyxPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0sYUFBYSxDQUFDO0FBQ3ZDLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQzs7OztBQU10RDs7OztJQUF1Qyw2Q0FBZTtJQUVwRCwyQkFBWSxnQkFBa0M7ZUFDNUMsa0JBQU0sZ0JBQWdCLENBQUM7SUFDekIsQ0FBQztJQUdEOztPQUVHOzs7Ozs7SUFDSSxzQ0FBVTs7Ozs7SUFBakIsVUFBa0IsRUFBVTtRQUE1QixpQkFjQzs7WUFaTyxPQUFPLEdBQUcsSUFBSSxDQUFDLGFBQWEsQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUNyRCxTQUFTOzs7O1FBQUMsVUFBQSxHQUFHO1lBQ1gsSUFBSSxHQUFHLEtBQUssS0FBSyxFQUFFO2dCQUNqQixPQUFPLEtBQUssQ0FBQzthQUNkO1lBQ0QsSUFBSSxLQUFJLENBQUMsU0FBUyxDQUFDLElBQUksS0FBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDLFdBQVcsSUFBSSxLQUFJLENBQUMsU0FBUyxDQUFDLENBQUMsV0FBVyxDQUFDLGNBQWMsRUFBRTtnQkFDaEcsS0FBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDLFdBQVcsQ0FBQyxjQUFjLEVBQUUsQ0FBQzthQUM5QztZQUNELE9BQU8sS0FBSSxDQUFD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RSxJQUFJLENBQUMsZ0JBQWdCLENBQUMsT0FBTyxDQUFDLGdCQUFnQixDQUFDLFFBQVEsRUFBRSxJQUFJLENBQUMsQ0FBQztRQUMvRCxJQUFJLENBQUMsZ0JBQWdCLENBQUMsT0FBTyxDQUFDLGdCQUFnQixDQUFDLGNBQWMsRUFBRSxJQUFJLENBQUMsQ0FBQztRQUNyRSxPQUFPLEVBQUUsQ0FBQyxJQUFJLENBQUMsQ0FBQTtJQUNqQixDQUFDO0lBRUgsd0JBQUM7QUFBRCxDQUFDLEFBcE1ELENBQXVDLGVBQWUsR0FvTXJEIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgT2JzZXJ2YWJsZSwgb2YsIEVNUFRZIH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7IHRhcCwgc3dpdGNoTWFwIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xyXG5pbXBvcnQgeyBFbnRpdHksIEh0dHBNZXRob2RzLCBIdHRwUmVxdWVzdENvbmZpZywgVmlld01vZGVsQ29udGV4dCB9IGZyb20gJ0BmYXJyaXMvbW9iaWxlLWRldmtpdCc7XHJcblxyXG5pbXBvcnQgeyBEYXRhVXRpbCB9IGZyb20gJy4vZGF0YS11dGlsJztcclxuaW1wb3J0IHsgQmFzZURhdGFTZXJ2aWNlIH0gZnJvbSAnLi9iYXNlLWRhdGEuc2VydmljZSc7XHJcblxyXG5cclxuLyoqXHJcbiAqIOWIoOmZpOaVsOaNruacjeWKoeexu1xyXG4gKi9cclxuZXhwb3J0IGNsYXNzIFJlbW92ZURhdGFTZXJ2aWNlIGV4dGVuZHMgQmFzZURhdGFTZXJ2aWNlIHtcclxuXHJcbiAgY29uc3RydWN0b3Iodmlld01vZGVsQ29udGV4dDogVmlld01vZGVsQ29udGV4dCkge1xyXG4gICAgc3VwZXIodmlld01vZGVsQ29udGV4dCk7XHJcbiAgfVxyXG5cclxuXHJcbiAgLyoqXHJcbiAgICog5Yig6Zmk5pWw5o2uXHJcbiAgICovXHJcbiAgcHVibGljIHJlbW92ZUJ5SWQoaWQ6IHN0cmluZyk6IE9ic2VydmFibGU8YW55PiB7XHJcblxyXG4gICAgY29uc3QgcmVzdWx0JCA9IHRoaXMuZGlhbG9nU2VydmljZS5jb25maXJtKCfmmK/lkKbliKDpmaQnKS5waXBlKFxyXG4gICAgICBzd2l0Y2hNYXAodmFsID0+IHtcclxuICAgICAgICBpZiAodmFsID09PSBmYWxzZSkge1xyXG4gICAgICAgICAgcmV0dXJuIEVNUFRZO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGhpc1snY29udGV4dCddICYmIHRoaXNbJ2NvbnRleHQnXS5ldmVudFBhcmFtcyAmJiB0aGlzWydjb250ZXh0J10uZXZlbnRQYXJhbXMuc3dpcGVjZWxsQ2xvc2UpIHtcclxuICAgICAgICAgIHRoaXNbJ2NvbnRleHQnXS5ldmVudFBhcmFtcy5zd2lwZWNlbGxDbG9zZSgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdGhpcy5jYW5jZWxDaGFuZ2VzKGlkKTtcclxuICAgICAgfVxyXG4gICAgICApKVxyXG4gICAgcmV0dXJuIHJlc3VsdCRcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOehruiupOWIoOmZpFxyXG4gICAqIEBwYXJhbSBpZCBcclxuICAgKi9cclxuXHJcbiAgcHJpdmF0ZSBjYW5jZWxDaGFuZ2VzKGlkOiBzdHJpbmcpOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgdGhpcy5sb2FkaW5nU2VydmljZS5zaG93KCk7XHJcbiAgICBjb25zdCByZW1vdmUkID0gdGhpcy5iZWZSZXBvc2l0b3J5LnJlbW92ZUVudGl0eUFuZFNhdmVCeUlkKGlkKTtcclxuICAgIHJldHVybiByZW1vdmUkLnBpcGUoXHJcbiAgICAgIHRhcChcclxuICAgICAgICAoKSA9PiB7XHJcbiAgICAgICAgICB0aGlzLm5vdGlmeVNlcnZpY2Uuc3VjY2Vzcygn5Yig6Zmk5oiQ5YqfJyk7XHJcbiAgICAgICAgICB0aGlzLmxvYWRpbmdTZXJ2aWNlLmhpZGUoKTtcclxuICAgICAgICB9LFxyXG4gICAgICAgICgpID0+IHtcclxuICAgICAgICAgIHRoaXMubG9hZGluZ1NlcnZpY2UuaGlkZSgpO1xyXG4gICAgICAgICAgdGhpcy5ub3RpZnlTZXJ2aWNlLmVycm9yKCfliKDpmaTlpLHotKUnKTtcclxuICAgICAgICB9XHJcbiAgICAgIClcclxuICAgICk7XHJcbiAgfVxyXG5cclxuXHJcbiAgLyoqXHJcbiAgICog5om56YeP5Yig6Zmk5pWw5o2uXHJcbiAgICovXHJcbiAgcHVibGljIHJlbW92ZUJ5SWRzKGlkczogc3RyaW5nW10pOiBPYnNlcnZhYmxlPGJvb2xlYW4+IHtcclxuICAgIC8vIOeUseS6jkxpc3RWaWV35bCa5pyq5ZKMVUlTdGF0ZembhuaIkO+8jOaXoOazleebtOaOpeiOt+WPlmlkc++8jOS4tOaXtuS7juS6i+S7tuWPguaVsOS4reiOt+WPllxyXG4gICAgaWYgKCFpZHMpIHtcclxuICAgICAgY29uc3Qgc2VsZWN0ZWRJdGVtcyA9IHRoaXNbJ2NvbnRleHQnXS5ldmVudFBhcmFtcztcclxuICAgICAgaWRzID0gc2VsZWN0ZWRJdGVtcy5tYXAoKHNlbGVjdGVkSXRlbSkgPT4ge1xyXG4gICAgICAgIHJldHVybiBzZWxlY3RlZEl0ZW0uaWQ7XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IG11bHRpUmVtb3ZlJCA9IHRoaXMuZGlhbG9nU2VydmljZS5jb25maXJtKCfmmK/lkKbliKDpmaQnKS5waXBlKFxyXG4gICAgICBzd2l0Y2hNYXAodmFsID0+IHtcclxuICAgICAgICBpZiAodmFsID09PSBmYWxzZSkge1xyXG4gICAgICAgICAgcmV0dXJuIEVNUFRZO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmxvYWRpbmdTZXJ2aWNlLnNob3coKTtcclxuICAgICAgICByZXR1cm4gdGhpcy5iZWZSZXBvc2l0b3J5LnJlbW92ZUVudGl0aWVzQnlJZHMoaWRzKTtcclxuICAgICAgfSkpO1xyXG4gICAgcmV0dXJuIG11bHRpUmVtb3ZlJC5waXBlKFxyXG4gICAgICB0YXAoXHJcbiAgICAgICAgKCkgPT4ge1xyXG4gICAgICAgICAgdGhpcy5sb2FkaW5nU2VydmljZS5oaWRlKCk7XHJcbiAgICAgICAgICB0aGlzLm5vdGlmeVNlcnZpY2Uuc3VjY2Vzcygn5Yig6Zmk5oiQ5YqfJyk7XHJcbiAgICAgICAgfSxcclxuICAgICAgICAoZXhjZXB0aW9uOiBhbnkpID0+IHtcclxuICAgICAgICAgIHRoaXMubG9hZGluZ1NlcnZpY2UuaGlkZSgpO1xyXG5cclxuICAgICAgICAgIC8vIHRoaXMuZXhjZXB0aW9uU2VydmljZS5zaG93KCfliKDpmaTlpLHotKUnLCBleGNlcHRpb24pO1xyXG4gICAgICAgIH1cclxuICAgICAgKVxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOWIoOmZpOWQjuS7o+iKgueCueaVsOaNrlxyXG4gICAqL1xyXG4gIHB1YmxpYyByZW1vdmVCeVBhdGhBbmRJZChwYXRoOiBzdHJpbmcsIGlkOiBzdHJpbmcpOiBPYnNlcnZhYmxlPGJvb2xlYW4+IHtcclxuICAgIGNvbnN0IHJlc3VsdCQgPSB0aGlzLmRpYWxvZ1NlcnZpY2UuY29uZmlybSgn5piv5ZCm5Yig6ZmkJykucGlwZShcclxuICAgICAgc3dpdGNoTWFwKHZhbCA9PiB7XHJcbiAgICAgICAgaWYgKHZhbCA9PT0gZmFsc2UpIHtcclxuICAgICAgICAgIHJldHVybiBFTVBUWTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHRoaXNbJ2NvbnRleHQnXSAmJiB0aGlzWydjb250ZXh0J10uZXZlbnRQYXJhbXMgJiYgdGhpc1snY29udGV4dCddLmV2ZW50UGFyYW1zLnN3aXBlY2VsbENsb3NlKSB7XHJcbiAgICAgICAgICB0aGlzWydjb250ZXh0J10uZXZlbnRQYXJhbXMuc3dpcGVjZWxsQ2xvc2UoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHRoaXMucmVtb3ZlQnlQYXRoQW5kSWRDaGFuZ2VzKHBhdGgsIGlkKTtcclxuICAgICAgfVxyXG4gICAgICApKTtcclxuICAgIHJldHVybiByZXN1bHQkO1xyXG4gIH1cclxuXHJcblxyXG4gIHB1YmxpYyByZW1vdmVCeVBhdGhBbmRJZENoYW5nZXMocGF0aDogc3RyaW5nLCBpZDogc3RyaW5nKTogT2JzZXJ2YWJsZTxib29sZWFuPiB7XHJcbiAgICB0aGlzLmxvYWRpbmdTZXJ2aWNlLnNob3coKTtcclxuICAgIGNvbnN0IGVudGl0eVBhdGggPSBEYXRhVXRpbC5jb252ZXJ0QmluZGluZ1BhdGhUb0VudGl0eVBhdGgocGF0aCwgdGhpcy52aWV3TW9kZWxDb250ZXh0KTtcclxuICAgIGNvbnN0IHJlbW92ZSQgPSB0aGlzLmJlZlJlcG9zaXRvcnkucmVtb3ZlRW50aXR5QnlQYXRoKGVudGl0eVBhdGgsIGlkKTtcclxuICAgIHJldHVybiByZW1vdmUkLnBpcGUoXHJcbiAgICAgIHRhcChcclxuICAgICAgICAoKSA9PiB7XHJcbiAgICAgICAgICB0aGlzLmxvYWRpbmdTZXJ2aWNlLmhpZGUoKTtcclxuICAgICAgICAgIHRoaXMubm90aWZ5U2VydmljZS5zdWNjZXNzKCfliKDpmaTmiJDlip8nKTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIChlcnJvcjogYW55KSA9PiB7XHJcbiAgICAgICAgICB0aGlzLmxvYWRpbmdTZXJ2aWNlLmhpZGUoKTtcclxuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xyXG4gICAgICAgIH1cclxuICAgICAgKVxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOaJuemHj+WIoOmZpOWQjuS7o+iKgueCueaVsOaNrlxyXG4gICAqL1xyXG4gIHB1YmxpYyByZW1vdmVCeVBhdGhBbmRJZHMocGF0aDogc3RyaW5nLCBpZHM6IHN0cmluZ1tdKTogT2JzZXJ2YWJsZTxib29sZWFuPiB7XHJcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ05vdCBJbXBsZW1lbnRlZCcpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5Lia5Yqh6ZmE5Lu25om56YeP5Yig6Zmk5pWw5o2uXHJcbiAgICovXHJcbiAgcHVibGljIHJlbW92ZUJ5QnVzaW5lc3NJZHModXJsOiBzdHJpbmcsIGlkczogc3RyaW5nW10pOiBPYnNlcnZhYmxlPGJvb2xlYW4+IHtcclxuICAgIC8vIOeUseS6jkxpc3RWaWV35bCa5pyq5ZKMVUlTdGF0ZembhuaIkO+8jOaXoOazleebtOaOpeiOt+WPlmlkc++8jOS4tOaXtuS7juS6i+S7tuWPguaVsOS4reiOt+WPllxyXG4gICAgaWYgKCFpZHMpIHtcclxuICAgICAgY29uc3Qgc2VsZWN0ZWRJdGVtcyA9IHRoaXNbJ2NvbnRleHQnXS5ldmVudFBhcmFtcztcclxuICAgICAgaWRzID0gc2VsZWN0ZWRJdGVtcy5tYXAoKHNlbGVjdGVkSXRlbSkgPT4ge1xyXG4gICAgICAgIHJldHVybiBzZWxlY3RlZEl0ZW0uaWQ7XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgY29uc3QgcGFyYW1zID0ge1xyXG4gICAgICBpZHM6IGlkcy5qb2luKCcsJylcclxuICAgIH07XHJcbiAgICBjb25zdCByZXF1ZXN0Q29uZmlnOiBIdHRwUmVxdWVzdENvbmZpZyA9IHtcclxuICAgICAgcGFyYW1zOiBwYXJhbXMsXHJcbiAgICAgIGJvZHk6IHtcclxuICAgICAgICBkYXRhQ2hhbmdlOiBbXSxcclxuICAgICAgICB2YXJpYWJsZUNoYW5nZTogbnVsbFxyXG4gICAgICB9XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIHRoaXMuYmVmUmVwb3NpdG9yeS5hcGlQcm94eS5yZXF1ZXN0KEh0dHBNZXRob2RzLlBVVCwgdXJsLCByZXF1ZXN0Q29uZmlnLCB0cnVlKTtcclxuICAgIC8vIHRoaXMubG9hZGluZ1NlcnZpY2Uuc2hvdygpO1xyXG4gICAgLy8gY29uc3QgbXVsdGlSZW1vdmUkID0gdGhpcy5kaWFsb2dTZXJ2aWNlLmNvbmZpcm0oJ+aYr+WQpuWIoOmZpCcpLnBpcGUoXHJcbiAgICAvLyAgIHN3aXRjaE1hcCh2YWwgPT4ge1xyXG4gICAgLy8gICAgIGlmICh2YWwgPT09IGZhbHNlKSB7XHJcbiAgICAvLyAgICAgICByZXR1cm4gRU1QVFk7XHJcbiAgICAvLyAgICAgfVxyXG4gICAgLy8gICB9KSk7XHJcbiAgICAvLyByZXR1cm4gbXVsdGlSZW1vdmUkLnBpcGUoXHJcbiAgICAvLyAgIHRhcChcclxuICAgIC8vICAgICAoKSA9PiB7XHJcbiAgICAvLyAgICAgICB0aGlzLmxvYWRpbmdTZXJ2aWNlLmhpZGUoKTtcclxuICAgIC8vICAgICB9LFxyXG4gICAgLy8gICAgIChleGNlcHRpb246IGFueSkgPT4ge1xyXG4gICAgLy8gICAgICAgdGhpcy5sb2FkaW5nU2VydmljZS5oaWRlKCk7XHJcbiAgICAvLyAgICAgfVxyXG4gICAgLy8gICApXHJcbiAgICAvLyApO1xyXG4gIH1cclxuXHJcblxyXG4gIC8qKlxyXG4gICAqIOS4muWKoemZhOS7tuWIoOmZpOWQjuS7o+iKgueCueaVsOaNrlxyXG4gICAqL1xyXG4gIHB1YmxpYyByZW1vdmVCeUJ1c2luZXNzUGF0aEFuZElkKHVybDogc3RyaW5nLCBwYXRoOiBzdHJpbmcsIGlkOiBzdHJpbmcpOiBPYnNlcnZhYmxlPGJvb2xlYW4+IHtcclxuICAgIGNvbnN0IHJlc3VsdCQgPSB0aGlzLmRpYWxvZ1NlcnZpY2UuY29uZmlybSgn5piv5ZCm5Yig6ZmkJykucGlwZShcclxuICAgICAgc3dpdGNoTWFwKHZhbCA9PiB7XHJcbiAgICAgICAgaWYgKHZhbCA9PT0gZmFsc2UpIHtcclxuICAgICAgICAgIHJldHVybiBFTVBUWTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuYmVmUmVwb3NpdG9yeS5hcGlQcm94eS5yZXF1ZXN0KEh0dHBNZXRob2RzLlBVVCwgdXJsKTtcclxuICAgICAgfVxyXG4gICAgICApKTtcclxuICAgIHJldHVybiByZXN1bHQkO1xyXG4gIH1cclxuXHJcblxyXG4gIC8qKlxyXG4gICAqIOWtkOihqOa4hemZpOe8lui+keS4juaWsOWinuagh+iusFxyXG4gICAqIEByZXR1cm5zIFxyXG4gICAqL1xyXG4gIHB1YmxpYyBDbGVhclN0YXR1c0FmdGVyY2hpbGRDYXJkU2F2ZSgpOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgdGhpcy52aWV3TW9kZWxDb250ZXh0LnVpU3RhdGUuc2V0UHJvcGVydHlWYWx1ZSgnJGlzQWRkJywgbnVsbCk7XHJcbiAgICB0aGlzLnZpZXdNb2RlbENvbnRleHQudWlTdGF0ZS5zZXRQcm9wZXJ0eVZhbHVlKCckY2hpbGRFbnRpdHknLCBudWxsKTtcclxuICAgIHJldHVybiBvZih0cnVlKVxyXG4gIH1cclxuXHJcbn1cclxuIl19
/**
 * @fileoverview added by tsickle
 * Generated from: lib/js-bridge-service/cloud-plus-service.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Subject } from 'rxjs';
var CloudPlusService = /** @class */ (function () {
    function CloudPlusService() {
    }
    /**
     * @param {?=} options
     * @return {?}
     */
    CloudPlusService.prototype.playShortVideo = /**
     * @param {?=} options
     * @return {?}
     */
    function (options) {
        throw new Error('Method not implemented.');
    };
    // 目前拍完返回报错
    // 目前拍完返回报错
    /**
     * @param {?=} options
     * @return {?}
     */
    CloudPlusService.prototype.takePhoto = 
    // 目前拍完返回报错
    /**
     * @param {?=} options
     * @return {?}
     */
    function (options) {
        if (options === void 0) { options = {
            quality: 75,
            encodingType: 0,
            targetWidth: 600,
            targetHeight: 600
        }; }
        /** @type {?} */
        var subject = new Subject();
        /** @type {?} */
        var callback = (/**
         * @param {?} data
         * @return {?}
         */
        function (data) {
            if (data && data['originalData']) {
                subject.next(data['originalData']);
            }
        });
        /** @type {?} */
        var errorCallback = (/**
         * @param {?} data
         * @return {?}
         */
        function (data) {
            if (data) {
                console.log('takePhoto', data);
                subject.next([]);
                return;
            }
        });
        window['imp'].iCamera.open(options, callback, errorCallback);
        return subject;
    };
    /**
     * @return {?}
     */
    CloudPlusService.prototype.scanQRCode = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var subject = new Subject();
        /** @type {?} */
        var callback = (/**
         * @param {?} data
         * @return {?}
         */
        function (data) {
            if (data) {
                console.log('二维码回调');
                subject.next(data);
            }
        });
        console.log('调用二维码');
        window['imp'].iBarCode.scan(callback);
        return subject;
    };
    /**
     * @return {?}
     */
    CloudPlusService.prototype.getLocation = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var subject = new Subject();
        /** @type {?} */
        var callback = (/**
         * @param {?} data
         * @return {?}
         */
        function (data) {
            if (data) {
                var latitude = data.latitude, longitude = data.longitude, addr = data.addr, city = data.city, country = data.country, district = data.district, province = data.province, street = data.street, streetNum = data.streetNum;
                subject.next({
                    addr: addr,
                    city: city,
                    country: country,
                    district: district,
                    province: province,
                    street: street,
                    streetNum: streetNum,
                    lat: latitude,
                    lng: longitude,
                });
            }
        });
        window['imp'].iGps.getInfo(callback);
        return subject;
        // iphone 打印输出信息
        /**
         * {latitude:"36.662413",longitude:"117.129769"}
         */
        // 安卓
        /**
         *  回调函数
         *  输出结构 object
         *  errormessage:""
         *  result:Object {
         *  addr:'山东省济南市历下区经十路靠近浪潮'
         *  city:"济南"
         *  country:"中国"
         *  course:-1
         *  district:"历下区"
         *  lat:36.66254123263889
         *  lng:117.12974745008681
         *  province:"山东省"
         *  street:"经十路"
         *  streetNum:"1单元"
         * }
         *  status:true
         */
    };
    /**
     * @return {?}
     */
    CloudPlusService.prototype.getSysInfo = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var subject = new Subject();
        /** @type {?} */
        var callback = (/**
         * @param {?} data
         * @return {?}
         */
        function (data) {
            if (data) {
                subject.next(data);
            }
        });
        window['imp'].iDevice.sysInfo(callback);
        return subject;
    };
    /**
     * @param {?} number
     * @param {?} content
     * @return {?}
     */
    CloudPlusService.prototype.sendSMS = /**
     * @param {?} number
     * @param {?} content
     * @return {?}
     */
    function (number, content) {
        window['imp'].iSms.send(number, content);
    };
    /**
     * @param {?} number
     * @param {?} content
     * @return {?}
     */
    CloudPlusService.prototype.openSendSMS = /**
     * @param {?} number
     * @param {?} content
     * @return {?}
     */
    function (number, content) {
        window['imp'].iSms.open(number, content);
    };
    /**
     * @param {?} number
     * @return {?}
     */
    CloudPlusService.prototype.tel = /**
     * @param {?} number
     * @return {?}
     */
    function (number) {
        window['imp'].iTel.dial(number);
    };
    /**
     * @param {?=} options
     * @return {?}
     */
    CloudPlusService.prototype.selectPictureFromAlbum = /**
     * @param {?=} options
     * @return {?}
     */
    function (options) {
        if (options === void 0) { options = { maxNum: 9, mType: 0 }; }
        /** @type {?} */
        var defaults = {
            num: 9,
            quality: 75,
            destinationType: 0,
            encodingType: 1,
            targetWidth: 600,
            targetHeight: 600
        };
        defaults.num = options.maxNum;
        /** @type {?} */
        var subject = new Subject();
        /** @type {?} */
        var callback = (/**
         * @param {?} data
         * @return {?}
         */
        function (data) {
            if (data) {
                subject.next(data.map((/**
                 * @param {?} item
                 * @return {?}
                 */
                function (item) {
                    return item.originalData;
                })));
            }
        });
        /** @type {?} */
        var errorCallback = (/**
         * @param {?} data
         * @return {?}
         */
        function (data) {
            if (data) {
                console.log('selectPictureFromAlbum', data);
                subject.next([]);
            }
        });
        window['imp'].iCamera.select(tslib_1.__assign({}, defaults, options), callback, errorCallback);
        return subject;
    };
    /**
     * @private
     * @param {?=} options
     * @return {?}
     */
    CloudPlusService.prototype.selectFileFromMobile = /**
     * @private
     * @param {?=} options
     * @return {?}
     */
    function (options) {
        if (options === void 0) { options = { maximum: 6, fileType: '.jpg|.png' }; }
    };
    /**
     * @private
     * @param {?} path
     * @return {?}
     */
    CloudPlusService.prototype.getBase64 = /**
     * @private
     * @param {?} path
     * @return {?}
     */
    function (path) {
        /** @type {?} */
        var subject = new Subject();
        /** @type {?} */
        var callback = (/**
         * @param {?} data
         * @return {?}
         */
        function (data) {
            if (data) {
                subject.next(data);
            }
        });
        /** @type {?} */
        var errorCallback = (/**
         * @param {?} data
         * @return {?}
         */
        function (data) {
            if (data) {
                console.log('getBase64', data);
                subject.next([]);
            }
        });
        window['imp'].iFile.getBase64(path, callback, errorCallback);
        return subject;
    };
    /**
     * @param {?=} options
     * @return {?}
     */
    CloudPlusService.prototype.selectFile = /**
     * @param {?=} options
     * @return {?}
     */
    function (options) {
        if (options === void 0) { options = { maximum: 6 }; }
        /** @type {?} */
        var subject = new Subject();
        /** @type {?} */
        var callback = (/**
         * @param {?} data
         * @return {?}
         */
        function (data) {
            if (data && data.length > 0) {
                /** @type {?} */
                var paths_1 = [];
                /** @type {?} */
                var count_1 = 0;
                data.forEach((/**
                 * @param {?} dataItem
                 * @return {?}
                 */
                function (dataItem) {
                    window['imp'].iFile.getBase64(dataItem.path, (/**
                     * @param {?} bs64
                     * @return {?}
                     */
                    function (bs64) {
                        paths_1.push({
                            name: data[count_1].name,
                            size: data[count_1].size,
                            base64: bs64
                        });
                        count_1++;
                        if (data.length === paths_1.length) {
                            // 防止触发多次next  一次性把所有数据抛出去
                            subject.next(paths_1);
                        }
                    }), (/**
                     * @param {?} errorMsg
                     * @return {?}
                     */
                    function (errorMsg) {
                        if (errorMsg) {
                            console.log('getBase64', errorMsg);
                            subject.next([]);
                        }
                    }));
                }));
            }
        });
        /** @type {?} */
        var errorCallback = (/**
         * @param {?} data
         * @return {?}
         */
        function (data) {
            if (data) {
                console.log('selectFile', data);
                subject.next([]);
            }
        });
        window['imp'].iFile.select(tslib_1.__assign({}, options), callback, errorCallback);
        return subject;
    };
    /**
     * @param {?} options
     * @return {?}
     */
    CloudPlusService.prototype.takeVideo = /**
     * @param {?} options
     * @return {?}
     */
    function (options) {
        /** @type {?} */
        var option = { id: options.id };
        if (options.quality) {
            if (options.quality <= 0.5) {
                option['fps'] = 30;
            }
            else if (options.quality <= 1) {
                option['fps'] = 60;
            }
        }
        else {
            option['fps'] = 30;
        }
        /** @type {?} */
        var subject = new Subject();
        /** @type {?} */
        var callback = (/**
         * @param {?} data
         * @return {?}
         */
        function (data) {
            if (data) {
                subject.next(data);
            }
        });
        /** @type {?} */
        var errorCallback = (/**
         * @param {?} data
         * @return {?}
         */
        function (data) {
            if (data) {
                console.log('takeVideo', data);
                subject.next([]);
            }
        });
        window['imp'].iVideo.record(option, callback, errorCallback);
        return subject;
    };
    /**
     * @return {?}
     */
    CloudPlusService.prototype.closeWindow = /**
     * @return {?}
     */
    function () {
        window['imp'].iWindow.close();
    };
    /**
     * @param {?} title
     * @return {?}
     */
    CloudPlusService.prototype.setTitles = /**
     * @param {?} title
     * @return {?}
     */
    function (title) {
        document.title = title;
    };
    /**
     * @param {?} options
     * @return {?}
     */
    CloudPlusService.prototype.downloadFile = /**
     * @param {?} options
     * @return {?}
     */
    function (options) {
        /** @type {?} */
        var subject = new Subject();
        /** @type {?} */
        var callback = (/**
         * @param {?} data
         * @return {?}
         */
        function (data) {
            if (data.status !== 1) {
                console.log(data);
            }
            subject.next(true);
        });
        window['imp'].iFile.download(options, callback);
        return subject;
    };
    /**
     * @param {?=} fn
     * @return {?}
     */
    CloudPlusService.prototype.setOriginGoback = /**
     * @param {?=} fn
     * @return {?}
     */
    function (fn) {
        /** @type {?} */
        var isAGreaterThanB = (/**
         * @param {?} parameA
         * @param {?} parameB
         * @return {?}
         */
        function (parameA, parameB) {
            /** @type {?} */
            var length = parameA.length > parameB.length ? parameB.length : parameA.length;
            for (var i = 0; i < length; i++) {
                if (parseInt(parameB[i]) > parseInt(parameA[i])) {
                    return false;
                }
            }
            return true;
        });
        /** @type {?} */
        var setFunction = (/**
         * @return {?}
         */
        function () {
            if (fn) {
                window['imp'].iWindow.onBackKeyDown2(fn);
                isAGreaterThanB(currentVersion.split('.'), minVersion.split('.')) && window['imp'].iWindow.onTitleBackKeyDown2(fn);
            }
            else {
                window['imp'].iWindow.cancelBackKeyDown();
                isAGreaterThanB(currentVersion.split('.'), minVersion.split('.')) && window['imp'].iWindow.cancelTitleBackKeyDown();
            }
        });
        /** @type {?} */
        var minVersion = '4.8.21';
        /** @type {?} */
        var currentVersion = window['CURRENT_VERSION'];
        if (currentVersion) {
            setFunction();
        }
        else {
            window['imp'].iDevice.sysInfo((/**
             * @param {?} info
             * @return {?}
             */
            function (info) {
                /** @type {?} */
                var newVersion = info.appVersion.split('-');
                window['CURRENT_VERSION'] = newVersion[0];
                currentVersion = window['CURRENT_VERSION'];
                setFunction();
            }));
        }
    };
    /**
     * @param {?=} fn
     * @return {?}
     */
    CloudPlusService.prototype.pushOriginGoback = /**
     * @param {?=} fn
     * @return {?}
     */
    function (fn) {
        window['OriginGoback'] = window['OriginGoback'] || [];
        /** @type {?} */
        var OriginGoback = (/**
         * @return {?}
         */
        function () {
            /** @type {?} */
            var gobackFn = window['OriginGoback'].pop();
            if (gobackFn) {
                gobackFn();
            }
            else {
                window['imp'].iWindow.cancelBackKeyDown();
                window['imp'].iWindow.cancelTitleBackKeyDown();
                history.back();
            }
        });
        if (fn) {
            window['OriginGoback'].push(fn);
            window['imp'].iWindow.onBackKeyDown2(OriginGoback);
            window['imp'].iWindow.onTitleBackKeyDown2(OriginGoback);
        }
    };
    /**
     * @return {?}
     */
    CloudPlusService.prototype.popOriginGoback = /**
     * @return {?}
     */
    function () {
        window['OriginGoback'].pop();
    };
    return CloudPlusService;
}());
export { CloudPlusService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2xvdWQtcGx1cy1zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy9tb2JpbGUtY29tbWFuZC1zZXJ2aWNlcy8iLCJzb3VyY2VzIjpbImxpYi9qcy1icmlkZ2Utc2VydmljZS9jbG91ZC1wbHVzLXNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQ0EsT0FBTyxFQUF3QixPQUFPLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFHckQ7SUFBQTtJQWtXQSxDQUFDOzs7OztJQWpXRyx5Q0FBYzs7OztJQUFkLFVBQWUsT0FBYTtRQUN4QixNQUFNLElBQUksS0FBSyxDQUFDLHlCQUF5QixDQUFDLENBQUM7SUFDL0MsQ0FBQztJQUVELFdBQVc7Ozs7OztJQUNYLG9DQUFTOzs7Ozs7SUFBVCxVQUFVLE9BS1Q7UUFMUyx3QkFBQSxFQUFBO1lBQ04sT0FBTyxFQUFFLEVBQUU7WUFDWCxZQUFZLEVBQUUsQ0FBQztZQUNmLFdBQVcsRUFBRSxHQUFHO1lBQ2hCLFlBQVksRUFBRSxHQUFHO1NBQ3BCOztZQUNTLE9BQU8sR0FBRyxJQUFJLE9BQU8sRUFBTzs7WUFDNUIsUUFBUTs7OztRQUFHLFVBQUMsSUFBSTtZQUNsQixJQUFJLElBQUksSUFBSSxJQUFJLENBQUMsY0FBYyxDQUFDLEVBQUU7Z0JBQzlCLE9BQU8sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxDQUFDLENBQUM7YUFDdEM7UUFDTCxDQUFDLENBQUE7O1lBQ0ssYUFBYTs7OztRQUFHLFVBQUMsSUFBSTtZQUN2QixJQUFJLElBQUksRUFBRTtnQkFDTixPQUFPLENBQUMsR0FBRyxDQUFDLFdBQVcsRUFBRSxJQUFJLENBQUMsQ0FBQztnQkFDL0IsT0FBTyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQztnQkFDakIsT0FBTzthQUNWO1FBQ0wsQ0FBQyxDQUFBO1FBRUQsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQ3RCLE9BQU8s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QUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQTtZQUMvQixNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsT0FBTyxDQUFDLGNBQWMsQ0FBQyxZQUFZLENBQUMsQ0FBQztZQUNuRCxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsT0FBTyxDQUFDLG1CQUFtQixDQUFDLFlBQVksQ0FBQyxDQUFDO1NBQzNEO0lBQ0wsQ0FBQzs7OztJQUVELDBDQUFlOzs7SUFBZjtRQUNJLE1BQU0sQ0FBQyxjQUFjLENBQUMsQ0FBQyxHQUFHLEVBQUUsQ0FBQTtJQUNoQyxDQUFDO0lBQ0wsdUJBQUM7QUFBRCxDQUFDLEFBbFdELElBa1dDO0FBRUQsT0FBTyxFQUFFLGdCQUFnQixFQUFFLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBzd2l0Y2hNYXAgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XHJcbmltcG9ydCB7IGZvcmtKb2luLCBPYnNlcnZhYmxlLCBTdWJqZWN0IH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7IElKc0JyaWRnZVN0cmF0ZWd5LCBQaG90b09wdGlvbnMsIFBpY3R1cmVPcHRpb25zLCBWaWRlcE9wdGlvbnMsIExvY2F0aW9uSW5mbyB9IGZyb20gJy4vZGVjb3JhdG9ycyc7XHJcblxyXG5jbGFzcyBDbG91ZFBsdXNTZXJ2aWNlIGltcGxlbWVudHMgSUpzQnJpZGdlU3RyYXRlZ3kge1xyXG4gICAgcGxheVNob3J0VmlkZW8ob3B0aW9ucz86IGFueSkge1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcignTWV0aG9kIG5vdCBpbXBsZW1lbnRlZC4nKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyDnm67liY3mi43lrozov5Tlm57miqXplJlcclxuICAgIHRha2VQaG90byhvcHRpb25zOiBQaG90b09wdGlvbnMgPSB7XHJcbiAgICAgICAgcXVhbGl0eTogNzUsXHJcbiAgICAgICAgZW5jb2RpbmdUeXBlOiAwLFxyXG4gICAgICAgIHRhcmdldFdpZHRoOiA2MDAsXHJcbiAgICAgICAgdGFyZ2V0SGVpZ2h0OiA2MDBcclxuICAgIH0pOiBPYnNlcnZhYmxlPFtdPiB7XHJcbiAgICAgICAgY29uc3Qgc3ViamVjdCA9IG5ldyBTdWJqZWN0PGFueT4oKTtcclxuICAgICAgICBjb25zdCBjYWxsYmFjayA9IChkYXRhKSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChkYXRhICYmIGRhdGFbJ29yaWdpbmFsRGF0YSddKSB7XHJcbiAgICAgICAgICAgICAgICBzdWJqZWN0Lm5leHQoZGF0YVsnb3JpZ2luYWxEYXRhJ10pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IGVycm9yQ2FsbGJhY2sgPSAoZGF0YSkgPT4ge1xyXG4gICAgICAgICAgICBpZiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ3Rha2VQaG90bycsIGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgc3ViamVjdC5uZXh0KFtdKTtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgd2luZG93WydpbXAnXS5pQ2FtZXJhLm9wZW4oXHJcbiAgICAgICAgICAgIG9wdGlvbnMsXHJcbiAgICAgICAgICAgIGNhbGxiYWNrLFxyXG4gICAgICAgICAgICBlcnJvckNhbGxiYWNrLFxyXG4gICAgICAgICk7XHJcbiAgICAgICAgcmV0dXJuIHN1YmplY3Q7XHJcbiAgICB9XHJcblxyXG4gICAgc2NhblFSQ29kZSgpOiBPYnNlcnZhYmxlPHN0cmluZz4ge1xyXG4gICAgICAgIGNvbnN0IHN1YmplY3QgPSBuZXcgU3ViamVjdDxhbnk+KCk7XHJcblxyXG4gICAgICAgIGNvbnN0IGNhbGxiYWNrID0gKGRhdGEpID0+IHtcclxuICAgICAgICAgICAgaWYgKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCfkuoznu7TnoIHlm57osIMnKVxyXG5cclxuICAgICAgICAgICAgICAgIHN1YmplY3QubmV4dChkYXRhKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zb2xlLmxvZygn6LCD55So5LqM57u056CBJylcclxuXHJcbiAgICAgICAgd2luZG93WydpbXAnXS5pQmFyQ29kZS5zY2FuKFxyXG4gICAgICAgICAgICBjYWxsYmFja1xyXG4gICAgICAgICk7XHJcbiAgICAgICAgcmV0dXJuIHN1YmplY3Q7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0TG9jYXRpb24oKTogT2JzZXJ2YWJsZTxMb2NhdGlvbkluZm8+IHtcclxuICAgICAgICBjb25zdCBzdWJqZWN0ID0gbmV3IFN1YmplY3Q8YW55PigpO1xyXG5cclxuICAgICAgICBjb25zdCBjYWxsYmFjayA9IChkYXRhKSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCB7XHJcbiAgICAgICAgICAgICAgICAgICAgbGF0aXR1ZGUsXHJcbiAgICAgICAgICAgICAgICAgICAgbG9uZ2l0dWRlLFxyXG4gICAgICAgICAgICAgICAgICAgIGFkZHIsXHJcbiAgICAgICAgICAgICAgICAgICAgY2l0eSxcclxuICAgICAgICAgICAgICAgICAgICBjb3VudHJ5LFxyXG4gICAgICAgICAgICAgICAgICAgIGRpc3RyaWN0LFxyXG4gICAgICAgICAgICAgICAgICAgIHByb3ZpbmNlLFxyXG4gICAgICAgICAgICAgICAgICAgIHN0cmVldCxcclxuICAgICAgICAgICAgICAgICAgICBzdHJlZXROdW1cclxuICAgICAgICAgICAgICAgIH0gPSBkYXRhXHJcbiAgICAgICAgICAgICAgICBzdWJqZWN0Lm5leHQoe1xyXG4gICAgICAgICAgICAgICAgICAgIGFkZHIsXHJcbiAgICAgICAgICAgICAgICAgICAgY2l0eSxcclxuICAgICAgICAgICAgICAgICAgICBjb3VudHJ5LFxyXG4gICAgICAgICAgICAgICAgICAgIGRpc3RyaWN0LFxyXG4gICAgICAgICAgICAgICAgICAgIHByb3ZpbmNlLFxyXG4gICAgICAgICAgICAgICAgICAgIHN0cmVldCxcclxuICAgICAgICAgICAgICAgICAgICBzdHJlZXROdW0sXHJcbiAgICAgICAgICAgICAgICAgICAgbGF0OiBsYXRpdHVkZSxcclxuICAgICAgICAgICAgICAgICAgICBsbmc6IGxvbmdpdHVkZSxcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHdpbmRvd1snaW1wJ10uaUdwcy5nZXRJbmZvKFxyXG4gICAgICAgICAgICBjYWxsYmFja1xyXG4gICAgICAgICk7XHJcbiAgICAgICAgcmV0dXJuIHN1YmplY3Q7XHJcbiAgICAgICAgLy8gaXBob25lIOaJk+WNsOi+k+WHuuS/oeaBr1xyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIHtsYXRpdHVkZTpcIjM2LjY2MjQxM1wiLGxvbmdpdHVkZTpcIjExNy4xMjk3NjlcIn1cclxuICAgICAgICAgKi9cclxuICAgICAgICAvLyDlronljZNcclxuICAgICAgICAvKipcclxuICAgICAgICAgKiAg5Zue6LCD5Ye95pWwXHJcbiAgICAgICAgICogIOi+k+WHuue7k+aehCBvYmplY3RcclxuICAgICAgICAgKiAgZXJyb3JtZXNzYWdlOlwiXCJcclxuICAgICAgICAgKiAgcmVzdWx0Ok9iamVjdCB7XHJcbiAgICAgICAgICogIGFkZHI6J+WxseS4nOecgea1juWNl+W4guWOhuS4i+WMuue7j+WNgei3r+mdoOi/kea1qua9ridcclxuICAgICAgICAgKiAgY2l0eTpcIua1juWNl1wiXHJcbiAgICAgICAgICogIGNvdW50cnk6XCLkuK3lm71cIlxyXG4gICAgICAgICAqICBjb3Vyc2U6LTFcclxuICAgICAgICAgKiAgZGlzdHJpY3Q6XCLljobkuIvljLpcIlxyXG4gICAgICAgICAqICBsYXQ6MzYuNjYyNTQxMjMyNjM4ODlcclxuICAgICAgICAgKiAgbG5nOjExNy4xMjk3NDc0NTAwODY4MVxyXG4gICAgICAgICAqICBwcm92aW5jZTpcIuWxseS4nOecgVwiXHJcbiAgICAgICAgICogIHN0cmVldDpcIue7j+WNgei3r1wiXHJcbiAgICAgICAgICogIHN0cmVldE51bTpcIjHljZXlhYNcIlxyXG4gICAgICAgICAqIH1cclxuICAgICAgICAgKiAgc3RhdHVzOnRydWVcclxuICAgICAgICAgKi9cclxuICAgIH1cclxuXHJcbiAgICBnZXRTeXNJbmZvKCkge1xyXG4gICAgICAgIGNvbnN0IHN1YmplY3QgPSBuZXcgU3ViamVjdDxhbnk+KCk7XHJcblxyXG4gICAgICAgIGNvbnN0IGNhbGxiYWNrID0gKGRhdGEpID0+IHtcclxuICAgICAgICAgICAgaWYgKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgIHN1YmplY3QubmV4dChkYXRhKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICB3aW5kb3dbJ2ltcCddLmlEZXZpY2Uuc3lzSW5mbyhjYWxsYmFjayk7XHJcbiAgICAgICAgcmV0dXJuIHN1YmplY3Q7XHJcbiAgICB9XHJcblxyXG4gICAgc2VuZFNNUyhudW1iZXI6IHN0cmluZywgY29udGVudDogc3RyaW5nKTogdm9pZCB7XHJcbiAgICAgICAgd2luZG93WydpbXAnXS5pU21zLnNlbmQobnVtYmVyLCBjb250ZW50KVxyXG4gICAgfVxyXG5cclxuICAgIG9wZW5TZW5kU01TKG51bWJlcjogc3RyaW5nLCBjb250ZW50OiBzdHJpbmcpOiB2b2lkIHtcclxuICAgICAgICB3aW5kb3dbJ2ltcCddLmlTbXMub3BlbihudW1iZXIsIGNvbnRlbnQpXHJcbiAgICB9XHJcblxyXG4gICAgdGVsKG51bWJlcjogc3RyaW5nKTogdm9pZCB7XHJcbiAgICAgICAgd2luZG93WydpbXAnXS5pVGVsLmRpYWwobnVtYmVyKVxyXG4gICAgfVxyXG5cclxuICAgIHNlbGVjdFBpY3R1cmVGcm9tQWxidW0ob3B0aW9uczogUGljdHVyZU9wdGlvbnMgPSB7IG1heE51bTogOSwgbVR5cGU6IDAgfSk6IE9ic2VydmFibGU8W10+IHtcclxuICAgICAgICBjb25zdCBkZWZhdWx0cyA9IHtcclxuICAgICAgICAgICAgbnVtOiA5LFxyXG4gICAgICAgICAgICBxdWFsaXR5OiA3NSxcclxuICAgICAgICAgICAgZGVzdGluYXRpb25UeXBlOiAwLFxyXG4gICAgICAgICAgICBlbmNvZGluZ1R5cGU6IDEsXHJcbiAgICAgICAgICAgIHRhcmdldFdpZHRoOiA2MDAsXHJcbiAgICAgICAgICAgIHRhcmdldEhlaWdodDogNjAwXHJcbiAgICAgICAgfTtcclxuICAgICAgICBkZWZhdWx0cy5udW0gPSBvcHRpb25zLm1heE51bTtcclxuICAgICAgICBjb25zdCBzdWJqZWN0ID0gbmV3IFN1YmplY3Q8YW55PigpO1xyXG5cclxuICAgICAgICBjb25zdCBjYWxsYmFjayA9IChkYXRhKSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICBzdWJqZWN0Lm5leHQoZGF0YS5tYXAoaXRlbSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGl0ZW0ub3JpZ2luYWxEYXRhXHJcbiAgICAgICAgICAgICAgICB9KSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IGVycm9yQ2FsbGJhY2sgPSAoZGF0YSkgPT4ge1xyXG4gICAgICAgICAgICBpZiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ3NlbGVjdFBpY3R1cmVGcm9tQWxidW0nLCBkYXRhKTtcclxuICAgICAgICAgICAgICAgIHN1YmplY3QubmV4dChbXSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHdpbmRvd1snaW1wJ10uaUNhbWVyYS5zZWxlY3QoXHJcbiAgICAgICAgICAgIHsgLi4uZGVmYXVsdHMsIC4uLm9wdGlvbnMgfSxcclxuICAgICAgICAgICAgY2FsbGJhY2ssXHJcbiAgICAgICAgICAgIGVycm9yQ2FsbGJhY2ssXHJcbiAgICAgICAgKTtcclxuICAgICAgICByZXR1cm4gc3ViamVjdDtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHNlbGVjdEZpbGVGcm9tTW9iaWxlKG9wdGlvbnM6IGFueSA9IHsgbWF4aW11bTogNiwgZmlsZVR5cGU6ICcuanBnfC5wbmcnIH0pIHtcclxuXHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBnZXRCYXNlNjQocGF0aDogc3RyaW5nKSB7XHJcbiAgICAgICAgY29uc3Qgc3ViamVjdCA9IG5ldyBTdWJqZWN0PGFueT4oKTtcclxuXHJcbiAgICAgICAgY29uc3QgY2FsbGJhY2sgPSAoZGF0YSkgPT4ge1xyXG4gICAgICAgICAgICBpZiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgc3ViamVjdC5uZXh0KGRhdGEpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgY29uc3QgZXJyb3JDYWxsYmFjayA9IChkYXRhKSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnZ2V0QmFzZTY0JywgZGF0YSk7XHJcbiAgICAgICAgICAgICAgICBzdWJqZWN0Lm5leHQoW10pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgd2luZG93WydpbXAnXS5pRmlsZS5nZXRCYXNlNjQoXHJcbiAgICAgICAgICAgIHBhdGgsXHJcbiAgICAgICAgICAgIGNhbGxiYWNrLFxyXG4gICAgICAgICAgICBlcnJvckNhbGxiYWNrLFxyXG4gICAgICAgICk7XHJcbiAgICAgICAgcmV0dXJuIHN1YmplY3Q7XHJcbiAgICB9XHJcblxyXG4gICAgc2VsZWN0RmlsZShvcHRpb25zOiBhbnkgPSB7IG1heGltdW06IDYgfSkge1xyXG4gICAgICAgIGNvbnN0IHN1YmplY3QgPSBuZXcgU3ViamVjdDxhbnk+KCk7XHJcbiAgICAgICAgY29uc3QgY2FsbGJhY2sgPSAoZGF0YSkgPT4ge1xyXG4gICAgICAgICAgICBpZiAoZGF0YSAmJiBkYXRhLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHBhdGhzID0gW107XHJcbiAgICAgICAgICAgICAgICBsZXQgY291bnQgPSAwO1xyXG4gICAgICAgICAgICAgICAgZGF0YS5mb3JFYWNoKGRhdGFJdGVtID0+IHtcclxuICAgICAgICAgICAgICAgICAgICB3aW5kb3dbJ2ltcCddLmlGaWxlLmdldEJhc2U2NChcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YUl0ZW0ucGF0aCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gKGJzNjQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhdGhzLnB1c2goe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IGRhdGFbY291bnRdLm5hbWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2l6ZTogZGF0YVtjb3VudF0uc2l6ZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiYXNlNjQ6IGJzNjRcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY291bnQrKztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkYXRhLmxlbmd0aCA9PT0gcGF0aHMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8g6Ziy5q2i6Kem5Y+R5aSa5qyhbmV4dCAg5LiA5qyh5oCn5oqK5omA5pyJ5pWw5o2u5oqb5Ye65Y67XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3ViamVjdC5uZXh0KHBhdGhzKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gKGVycm9yTXNnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZXJyb3JNc2cpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnZ2V0QmFzZTY0JywgZXJyb3JNc2cpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1YmplY3QubmV4dChbXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICApO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBjb25zdCBlcnJvckNhbGxiYWNrID0gKGRhdGEpID0+IHtcclxuICAgICAgICAgICAgaWYgKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdzZWxlY3RGaWxlJywgZGF0YSk7XHJcbiAgICAgICAgICAgICAgICBzdWJqZWN0Lm5leHQoW10pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgICAgICB3aW5kb3dbJ2ltcCddLmlGaWxlLnNlbGVjdChcclxuICAgICAgICAgICAgeyAuLi5vcHRpb25zIH0sXHJcbiAgICAgICAgICAgIGNhbGxiYWNrLFxyXG4gICAgICAgICAgICBlcnJvckNhbGxiYWNrLFxyXG4gICAgICAgICk7XHJcbiAgICAgICAgcmV0dXJuIHN1YmplY3Q7XHJcbiAgICB9XHJcblxyXG4gICAgdGFrZVZpZGVvKG9wdGlvbnM6IFZpZGVwT3B0aW9ucyk6IE9ic2VydmFibGU8c3RyaW5nPiB7XHJcbiAgICAgICAgbGV0IG9wdGlvbiA9IHsgaWQ6IG9wdGlvbnMuaWQgfVxyXG4gICAgICAgIGlmIChvcHRpb25zLnF1YWxpdHkpIHtcclxuICAgICAgICAgICAgaWYgKG9wdGlvbnMucXVhbGl0eSA8PSAwLjUpIHtcclxuICAgICAgICAgICAgICAgIG9wdGlvblsnZnBzJ10gPSAzMDtcclxuICAgICAgICAgICAgfSBlbHNlIGlmIChvcHRpb25zLnF1YWxpdHkgPD0gMSkge1xyXG4gICAgICAgICAgICAgICAgb3B0aW9uWydmcHMnXSA9IDYwO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgb3B0aW9uWydmcHMnXSA9IDMwO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCBzdWJqZWN0ID0gbmV3IFN1YmplY3Q8YW55PigpO1xyXG5cclxuICAgICAgICBjb25zdCBjYWxsYmFjayA9IChkYXRhKSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICBzdWJqZWN0Lm5leHQoZGF0YSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IGVycm9yQ2FsbGJhY2sgPSAoZGF0YSkgPT4ge1xyXG4gICAgICAgICAgICBpZiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ3Rha2VWaWRlbycsIGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgc3ViamVjdC5uZXh0KFtdKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICB3aW5kb3dbJ2ltcCddLmlWaWRlby5yZWNvcmQoXHJcbiAgICAgICAgICAgIG9wdGlvbixcclxuICAgICAgICAgICAgY2FsbGJhY2ssXHJcbiAgICAgICAgICAgIGVycm9yQ2FsbGJhY2ssXHJcbiAgICAgICAgKTtcclxuICAgICAgICByZXR1cm4gc3ViamVjdDtcclxuICAgIH1cclxuXHJcbiAgICBjbG9zZVdpbmRvdygpOiB2b2lkIHtcclxuICAgICAgICB3aW5kb3dbJ2ltcCddLmlXaW5kb3cuY2xvc2UoKTtcclxuICAgIH1cclxuXHJcbiAgICBzZXRUaXRsZXModGl0bGU6IHN0cmluZyk6IHZvaWQge1xyXG4gICAgICAgIGRvY3VtZW50LnRpdGxlID0gdGl0bGU7XHJcbiAgICB9XHJcblxyXG4gICAgZG93bmxvYWRGaWxlKG9wdGlvbnMpIHtcclxuICAgICAgICBjb25zdCBzdWJqZWN0ID0gbmV3IFN1YmplY3Q8YW55PigpO1xyXG4gICAgICAgIGNvbnN0IGNhbGxiYWNrID0gKGRhdGEpID0+IHtcclxuICAgICAgICAgICAgaWYgKGRhdGEuc3RhdHVzICE9PSAxKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhkYXRhKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBzdWJqZWN0Lm5leHQodHJ1ZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHdpbmRvd1snaW1wJ10uaUZpbGUuZG93bmxvYWQob3B0aW9ucywgY2FsbGJhY2spO1xyXG4gICAgICAgIHJldHVybiBzdWJqZWN0O1xyXG4gICAgfVxyXG5cclxuXHJcblxyXG4gICAgc2V0T3JpZ2luR29iYWNrKGZuPzogYW55KSB7XHJcbiAgICAgICAgY29uc3QgaXNBR3JlYXRlclRoYW5CID0gKHBhcmFtZUE6IHN0cmluZ1tdLCBwYXJhbWVCOiBzdHJpbmdbXSkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBsZW5ndGggPSBwYXJhbWVBLmxlbmd0aCA+IHBhcmFtZUIubGVuZ3RoID8gcGFyYW1lQi5sZW5ndGggOiBwYXJhbWVBLmxlbmd0aDtcclxuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgaWYgKHBhcnNlSW50KHBhcmFtZUJbaV0pID4gcGFyc2VJbnQocGFyYW1lQVtpXSkpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2VcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc3Qgc2V0RnVuY3Rpb24gPSAoKSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChmbikge1xyXG4gICAgICAgICAgICAgICAgd2luZG93WydpbXAnXS5pV2luZG93Lm9uQmFja0tleURvd24yKGZuKTtcclxuICAgICAgICAgICAgICAgIGlzQUdyZWF0ZXJUaGFuQihjdXJyZW50VmVyc2lvbi5zcGxpdCgnLicpLCBtaW5WZXJzaW9uLnNwbGl0KCcuJykpICYmIHdpbmRvd1snaW1wJ10uaVdpbmRvdy5vblRpdGxlQmFja0tleURvd24yKGZuKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHdpbmRvd1snaW1wJ10uaVdpbmRvdy5jYW5jZWxCYWNrS2V5RG93bigpO1xyXG4gICAgICAgICAgICAgICAgaXNBR3JlYXRlclRoYW5CKGN1cnJlbnRWZXJzaW9uLnNwbGl0KCcuJyksIG1pblZlcnNpb24uc3BsaXQoJy4nKSkgJiYgd2luZG93WydpbXAnXS5pV2luZG93LmNhbmNlbFRpdGxlQmFja0tleURvd24oKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBsZXQgbWluVmVyc2lvbiA9ICc0LjguMjEnO1xyXG4gICAgICAgIGxldCBjdXJyZW50VmVyc2lvbiA9IHdpbmRvd1snQ1VSUkVOVF9WRVJTSU9OJ107XHJcbiAgICAgICAgaWYoY3VycmVudFZlcnNpb24pe1xyXG4gICAgICAgICAgICBzZXRGdW5jdGlvbigpO1xyXG4gICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICB3aW5kb3dbJ2ltcCddLmlEZXZpY2Uuc3lzSW5mbygoaW5mbykgPT4ge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgbmV3VmVyc2lvbiA9IGluZm8uYXBwVmVyc2lvbi5zcGxpdCgnLScpO1xyXG4gICAgICAgICAgICAgICAgd2luZG93WydDVVJSRU5UX1ZFUlNJT04nXSA9IG5ld1ZlcnNpb25bMF07XHJcbiAgICAgICAgICAgICAgICBjdXJyZW50VmVyc2lvbiA9IHdpbmRvd1snQ1VSUkVOVF9WRVJTSU9OJ107XHJcbiAgICAgICAgICAgICAgICBzZXRGdW5jdGlvbigpO1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwdXNoT3JpZ2luR29iYWNrKGZuPzogYW55KSB7XHJcbiAgICAgICAgd2luZG93WydPcmlnaW5Hb2JhY2snXSA9IHdpbmRvd1snT3JpZ2luR29iYWNrJ10gfHwgW107XHJcbiAgICAgICAgY29uc3QgT3JpZ2luR29iYWNrID0gKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBnb2JhY2tGbiA9IHdpbmRvd1snT3JpZ2luR29iYWNrJ10ucG9wKClcclxuICAgICAgICAgICAgaWYgKGdvYmFja0ZuKSB7XHJcbiAgICAgICAgICAgICAgICBnb2JhY2tGbigpXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB3aW5kb3dbJ2ltcCddLmlXaW5kb3cuY2FuY2VsQmFja0tleURvd24oKTtcclxuICAgICAgICAgICAgICAgIHdpbmRvd1snaW1wJ10uaVdpbmRvdy5jYW5jZWxUaXRsZUJhY2tLZXlEb3duKCk7XHJcbiAgICAgICAgICAgICAgICBoaXN0b3J5LmJhY2soKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoZm4pIHtcclxuICAgICAgICAgICAgd2luZG93WydPcmlnaW5Hb2JhY2snXS5wdXNoKGZuKVxyXG4gICAgICAgICAgICB3aW5kb3dbJ2ltcCddLmlXaW5kb3cub25CYWNrS2V5RG93bjIoT3JpZ2luR29iYWNrKTtcclxuICAgICAgICAgICAgd2luZG93WydpbXAnXS5pV2luZG93Lm9uVGl0bGVCYWNrS2V5RG93bjIoT3JpZ2luR29iYWNrKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcG9wT3JpZ2luR29iYWNrKCkge1xyXG4gICAgICAgIHdpbmRvd1snT3JpZ2luR29iYWNrJ10ucG9wKClcclxuICAgIH1cclxufVxyXG5cclxuZXhwb3J0IHsgQ2xvdWRQbHVzU2VydmljZSB9Il19
/**
 * @fileoverview added by tsickle
 * Generated from: lib/js-bridge-service/js-bridge-stratege.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { JsBridgeStrategyFactory } from './js-bridge-strategy-factory';
import { Subject } from 'rxjs';
var JsBridgeService = /** @class */ (function () {
    function JsBridgeService() {
        this.jsBridgeStrategyFactory = new JsBridgeStrategyFactory();
        this.init();
    }
    /**
     * @return {?}
     */
    JsBridgeService.prototype.getSysInfo = /**
     * @return {?}
     */
    function () {
        return this.getJsBridgeService(this.strategy.getSysInfo);
    };
    /**
     * @private
     * @return {?}
     */
    JsBridgeService.prototype.init = /**
     * @private
     * @return {?}
     */
    function () {
        this.strategy = this.jsBridgeStrategyFactory.create();
        window['JsBridgeService'] = this;
    };
    /**
     * @param {?} options
     * @return {?}
     */
    JsBridgeService.prototype.takePhoto = /**
     * @param {?} options
     * @return {?}
     */
    function (options) {
        return this.getJsBridgeService(this.strategy.takePhoto, options);
    };
    /**
     * @return {?}
     */
    JsBridgeService.prototype.scanQRCode = /**
     * @return {?}
     */
    function () {
        return this.getJsBridgeService(this.strategy.scanQRCode);
    };
    /**
     * @return {?}
     */
    JsBridgeService.prototype.getLocation = /**
     * @return {?}
     */
    function () {
        return this.getJsBridgeService(this.strategy.getLocation);
    };
    /**
     * @param {?} number
     * @param {?} content
     * @return {?}
     */
    JsBridgeService.prototype.sendSMS = /**
     * @param {?} number
     * @param {?} content
     * @return {?}
     */
    function (number, content) {
        return this.getJsBridgeService(this.strategy.sendSMS, number, content);
    };
    /**
     * @param {?} number
     * @param {?} content
     * @return {?}
     */
    JsBridgeService.prototype.openSendSMS = /**
     * @param {?} number
     * @param {?} content
     * @return {?}
     */
    function (number, content) {
        return this.getJsBridgeService(this.strategy.openSendSMS, number, content);
    };
    /**
     * @param {?} number
     * @return {?}
     */
    JsBridgeService.prototype.tel = /**
     * @param {?} number
     * @return {?}
     */
    function (number) {
        return this.getJsBridgeService(this.strategy.tel, number);
    };
    /**
     * @param {?} options
     * @return {?}
     */
    JsBridgeService.prototype.selectPictureFromAlbum = /**
     * @param {?} options
     * @return {?}
     */
    function (options) {
        return this.getJsBridgeService(this.strategy.selectPictureFromAlbum, options);
    };
    /**
     * @param {?} options
     * @return {?}
     */
    JsBridgeService.prototype.takeVideo = /**
     * @param {?} options
     * @return {?}
     */
    function (options) {
        return this.getJsBridgeService(this.strategy.takeVideo, options);
    };
    /**
     * @return {?}
     */
    JsBridgeService.prototype.closeWindow = /**
     * @return {?}
     */
    function () {
        return this.getJsBridgeService(this.strategy.closeWindow);
    };
    /**
     * @param {?} title
     * @return {?}
     */
    JsBridgeService.prototype.setTitles = /**
     * @param {?} title
     * @return {?}
     */
    function (title) {
        return this.getJsBridgeService(this.strategy.setTitles, title);
    };
    /**
     * @param {?=} options
     * @return {?}
     */
    JsBridgeService.prototype.selectFile = /**
     * @param {?=} options
     * @return {?}
     */
    function (options) {
        return this.getJsBridgeService(this.strategy.selectFile, options);
    };
    /**
     * @param {?} options
     * @return {?}
     */
    JsBridgeService.prototype.downloadFile = /**
     * @param {?} options
     * @return {?}
     */
    function (options) {
        return this.getJsBridgeService(this.strategy.downloadFile, options);
    };
    /**
     * @param {?=} fn
     * @return {?}
     */
    JsBridgeService.prototype.setOriginGoback = /**
     * @param {?=} fn
     * @return {?}
     */
    function (fn) {
        return this.getJsBridgeService(this.strategy.setOriginGoback, fn);
    };
    /**
     * @param {?=} fn
     * @return {?}
     */
    JsBridgeService.prototype.pushOriginGoback = /**
     * @param {?=} fn
     * @return {?}
     */
    function (fn) {
        return this.getJsBridgeService(this.strategy.pushOriginGoback, fn);
    };
    /**
     * @param {?=} fn
     * @return {?}
     */
    JsBridgeService.prototype.popOriginGoback = /**
     * @param {?=} fn
     * @return {?}
     */
    function (fn) {
        return this.getJsBridgeService(this.strategy.popOriginGoback, fn);
    };
    /**
     * @param {?=} fn
     * @return {?}
     */
    JsBridgeService.prototype.playShortVideo = /**
     * @param {?=} fn
     * @return {?}
     */
    function (fn) {
        return this.getJsBridgeService(this.strategy.playShortVideo, fn);
    };
    /**
     * @private
     * @param {?} method
     * @param {...?} values
     * @return {?}
     */
    JsBridgeService.prototype.getJsBridgeService = /**
     * @private
     * @param {?} method
     * @param {...?} values
     * @return {?}
     */
    function (method) {
        var values = [];
        for (var _i = 1; _i < arguments.length; _i++) {
            values[_i - 1] = arguments[_i];
        }
        /** @type {?} */
        var subject = new Subject();
        // 已经存在方法实例即结束返回
        if (window.top['FARRIS_JSBridge'] === '已加载') {
            return method.apply(void 0, tslib_1.__spread(values));
        }
        // 判断是否为云上协同环境
        if (window.top['FARRIS_JSBridge'] === '云上协同') {
            if (window.top['iCityBridge']) {
                return method.apply(void 0, tslib_1.__spread(values));
            }
            else {
                /** @type {?} */
                var ccwork = window.top.document.createElement("script");
                ccwork.src = 'https://ccwork.oss.cn-north-3.inspurcloudoss.com/h5/ccworkJsbridge.js';
                ccwork.onload = (/**
                 * @return {?}
                 */
                function () {
                    window.top['iCityBridge'].init((/**
                     * @return {?}
                     */
                    function () {
                        method.apply(void 0, tslib_1.__spread(values)).subscribe((/**
                         * @param {?} e
                         * @return {?}
                         */
                        function (e) { subject.next(e); }));
                    }));
                });
                window.top.document.head.appendChild(ccwork);
            }
        }
        // 当前没有针对云+的判断，前置环境不满足即默认云+环境
        if (window.top['FARRIS_JSBridge'] === '云加') {
            System
                .import('/platform/common/web/imp.js')
                .then((/**
             * @param {?} e
             * @return {?}
             */
            function (e) {
                window.top['FARRIS_JSBridge'] = '已加载';
                method.apply(void 0, tslib_1.__spread(values)).subscribe((/**
                 * @param {?} e
                 * @return {?}
                 */
                function (e) { subject.next(e); }));
            }));
        }
        return subject;
    };
    return JsBridgeService;
}());
if (false) {
    /**
     * @type {?}
     * @private
     */
    JsBridgeService.prototype.strategy;
    /**
     * @type {?}
     * @private
     */
    JsBridgeService.prototype.jsBridgeStrategyFactory;
}
export { JsBridgeService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoianMtYnJpZGdlLXN0cmF0ZWdlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy9tb2JpbGUtY29tbWFuZC1zZXJ2aWNlcy8iLCJzb3VyY2VzIjpbImxpYi9qcy1icmlkZ2Utc2VydmljZS9qcy1icmlkZ2Utc3RyYXRlZ2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUEsT0FBTyxFQUFFLHVCQUF1QixFQUFFLE1BQU0sOEJBQThCLENBQUE7QUFFdEUsT0FBTyxFQUFjLE9BQU8sRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUkzQztJQUVJO1FBQ0ksSUFBSSxDQUFDLHVCQUF1QixHQUFHLElBQUksdUJBQXVCLEVBQUUsQ0FBQztRQUM3RCxJQUFJLENBQUMsSUFBSSxFQUFFLENBQUM7SUFDaEIsQ0FBQzs7OztJQUVELG9DQUFVOzs7SUFBVjtRQUNJLE9BQU8sSUFBSSxDQUFDLGtCQUFrQixDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsVUFBVSxDQUFDLENBQUM7SUFDN0QsQ0FBQzs7Ozs7SUFPTyw4QkFBSTs7OztJQUFaO1FBQ0ksSUFBSSxDQUFDLFFBQVEsR0FBRyxJQUFJLENBQUMsdUJBQXVCLENBQUMsTUFBTSxFQUFFLENBQUM7UUFDdEQsTUFBTSxDQUFDLGlCQUFpQixDQUFDLEdBQUcsSUFBSSxDQUFBO0lBQ3BDLENBQUM7Ozs7O0lBRUQsbUNBQVM7Ozs7SUFBVCxVQUFVLE9BQXFCO1FBQzNCLE9BQU8sSUFBSSxDQUFDLGtCQUFrQixDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsU0FBUyxFQUFFLE9BQU8sQ0FBQyxDQUFDO0lBQ3JFLENBQUM7Ozs7SUFDRCxvQ0FBVTs7O0lBQVY7UUFDSSxPQUFPLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLFVBQVUsQ0FBQyxDQUFDO0lBQzdELENBQUM7Ozs7SUFDRCxxQ0FBVzs7O0lBQVg7UUFDSSxPQUFPLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxJQUFJLENBQUMsUUFBUSxD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QkFDdkIsVUFBQyxDQUFDLElBQU8sT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQSxDQUFDLENBQUMsRUFDN0IsQ0FBQTtZQUNMLENBQUMsRUFDSixDQUFBO1NBQ1I7UUFDRCxPQUFPLE9BQU8sQ0FBQztJQUNuQixDQUFDO0lBRUwsc0JBQUM7QUFBRCxDQUFDLEFBckhELElBcUhDOzs7Ozs7SUF6R0csbUNBQW9DOzs7OztJQUVwQyxrREFBeUQ7O0FBeUc3RCxPQUFPLEVBQUUsZUFBZSxFQUFFLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBKc0JyaWRnZVN0cmF0ZWd5RmFjdG9yeSB9IGZyb20gJy4vanMtYnJpZGdlLXN0cmF0ZWd5LWZhY3RvcnknXHJcbmltcG9ydCB7IElKc0JyaWRnZVN0cmF0ZWd5LCBQaWN0dXJlT3B0aW9ucywgUGhvdG9PcHRpb25zLCBWaWRlcE9wdGlvbnMgfSBmcm9tICcuL2RlY29yYXRvcnMnO1xyXG5pbXBvcnQgeyBPYnNlcnZhYmxlLCBTdWJqZWN0IH0gZnJvbSAncnhqcyc7XHJcblxyXG5kZWNsYXJlIGNvbnN0IFN5c3RlbTogYW55O1xyXG5cclxuY2xhc3MgSnNCcmlkZ2VTZXJ2aWNlIGltcGxlbWVudHMgSUpzQnJpZGdlU3RyYXRlZ3kge1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgICAgIHRoaXMuanNCcmlkZ2VTdHJhdGVneUZhY3RvcnkgPSBuZXcgSnNCcmlkZ2VTdHJhdGVneUZhY3RvcnkoKTtcclxuICAgICAgICB0aGlzLmluaXQoKTtcclxuICAgIH1cclxuXHJcbiAgICBnZXRTeXNJbmZvKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmdldEpzQnJpZGdlU2VydmljZSh0aGlzLnN0cmF0ZWd5LmdldFN5c0luZm8pO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICBwcml2YXRlIHN0cmF0ZWd5OiBJSnNCcmlkZ2VTdHJhdGVneTtcclxuXHJcbiAgICBwcml2YXRlIGpzQnJpZGdlU3RyYXRlZ3lGYWN0b3J5OiBKc0JyaWRnZVN0cmF0ZWd5RmFjdG9yeTtcclxuXHJcbiAgICBwcml2YXRlIGluaXQoKSB7XHJcbiAgICAgICAgdGhpcy5zdHJhdGVneSA9IHRoaXMuanNCcmlkZ2VTdHJhdGVneUZhY3RvcnkuY3JlYXRlKCk7XHJcbiAgICAgICAgd2luZG93WydKc0JyaWRnZVNlcnZpY2UnXSA9IHRoaXNcclxuICAgIH1cclxuXHJcbiAgICB0YWtlUGhvdG8ob3B0aW9uczogUGhvdG9PcHRpb25zKTogT2JzZXJ2YWJsZTxbXT4ge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmdldEpzQnJpZGdlU2VydmljZSh0aGlzLnN0cmF0ZWd5LnRha2VQaG90bywgb3B0aW9ucyk7XHJcbiAgICB9XHJcbiAgICBzY2FuUVJDb2RlKCk6IE9ic2VydmFibGU8c3RyaW5nPiB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0SnNCcmlkZ2VTZXJ2aWNlKHRoaXMuc3RyYXRlZ3kuc2NhblFSQ29kZSk7XHJcbiAgICB9XHJcbiAgICBnZXRMb2NhdGlvbigpOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmdldEpzQnJpZGdlU2VydmljZSh0aGlzLnN0cmF0ZWd5LmdldExvY2F0aW9uKTtcclxuICAgIH1cclxuICAgIHNlbmRTTVMobnVtYmVyOiBzdHJpbmcsIGNvbnRlbnQ6IHN0cmluZyk6IHZvaWQge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmdldEpzQnJpZGdlU2VydmljZSh0aGlzLnN0cmF0ZWd5LnNlbmRTTVMsIG51bWJlciwgY29udGVudCk7XHJcbiAgICB9XHJcbiAgICBvcGVuU2VuZFNNUyhudW1iZXI6IHN0cmluZywgY29udGVudDogc3RyaW5nKTogdm9pZCB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0SnNCcmlkZ2VTZXJ2aWNlKHRoaXMuc3RyYXRlZ3kub3BlblNlbmRTTVMsIG51bWJlciwgY29udGVudCk7XHJcbiAgICB9XHJcbiAgICB0ZWwobnVtYmVyOiBzdHJpbmcpOiB2b2lkIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5nZXRKc0JyaWRnZVNlcnZpY2UodGhpcy5zdHJhdGVneS50ZWwsIG51bWJlcik7XHJcbiAgICB9XHJcbiAgICBzZWxlY3RQaWN0dXJlRnJvbUFsYnVtKG9wdGlvbnM6IFBpY3R1cmVPcHRpb25zKTogT2JzZXJ2YWJsZTxbXT4ge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmdldEpzQnJpZGdlU2VydmljZSh0aGlzLnN0cmF0ZWd5LnNlbGVjdFBpY3R1cmVGcm9tQWxidW0sIG9wdGlvbnMpO1xyXG4gICAgfVxyXG4gICAgdGFrZVZpZGVvKG9wdGlvbnM6IFZpZGVwT3B0aW9ucyk6IE9ic2VydmFibGU8c3RyaW5nPiB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0SnNCcmlkZ2VTZXJ2aWNlKHRoaXMuc3RyYXRlZ3kudGFrZVZpZGVvLCBvcHRpb25zKTtcclxuICAgIH1cclxuICAgIGNsb3NlV2luZG93KCk6IHZvaWQge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmdldEpzQnJpZGdlU2VydmljZSh0aGlzLnN0cmF0ZWd5LmNsb3NlV2luZG93KTtcclxuICAgIH1cclxuICAgIHNldFRpdGxlcyh0aXRsZTogc3RyaW5nKTogdm9pZCB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0SnNCcmlkZ2VTZXJ2aWNlKHRoaXMuc3RyYXRlZ3kuc2V0VGl0bGVzLCB0aXRsZSk7XHJcbiAgICB9XHJcblxyXG4gICAgc2VsZWN0RmlsZShvcHRpb25zPzogYW55KTogYW55IHtcclxuICAgICAgICByZXR1cm4gdGhpcy5nZXRKc0JyaWRnZVNlcnZpY2UodGhpcy5zdHJhdGVneS5zZWxlY3RGaWxlLCBvcHRpb25zKTtcclxuICAgIH1cclxuXHJcbiAgICBkb3dubG9hZEZpbGUob3B0aW9uczogYW55KSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0SnNCcmlkZ2VTZXJ2aWNlKHRoaXMuc3RyYXRlZ3kuZG93bmxvYWRGaWxlLCBvcHRpb25zKTtcclxuICAgIH1cclxuXHJcbiAgICBzZXRPcmlnaW5Hb2JhY2soZm4/OiBhbnkpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5nZXRKc0JyaWRnZVNlcnZpY2UodGhpcy5zdHJhdGVneS5zZXRPcmlnaW5Hb2JhY2ssIGZuKTtcclxuICAgIH1cclxuXHJcbiAgICBwdXNoT3JpZ2luR29iYWNrKGZuPzogYW55KSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0SnNCcmlkZ2VTZXJ2aWNlKHRoaXMuc3RyYXRlZ3kucHVzaE9yaWdpbkdvYmFjaywgZm4pO1xyXG4gICAgfVxyXG4gICAgcG9wT3JpZ2luR29iYWNrKGZuPzogYW55KSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0SnNCcmlkZ2VTZXJ2aWNlKHRoaXMuc3RyYXRlZ3kucG9wT3JpZ2luR29iYWNrLCBmbik7XHJcbiAgICB9XHJcbiAgICBwbGF5U2hvcnRWaWRlbyhmbj86IGFueSkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmdldEpzQnJpZGdlU2VydmljZSh0aGlzLnN0cmF0ZWd5LnBsYXlTaG9ydFZpZGVvLCBmbik7XHJcbiAgICB9XHJcblxyXG5cclxuICAgIHByaXZhdGUgZ2V0SnNCcmlkZ2VTZXJ2aWNlKG1ldGhvZCwgLi4udmFsdWVzKSB7XHJcbiAgICAgICAgY29uc3Qgc3ViamVjdCA9IG5ldyBTdWJqZWN0PGFueT4oKTtcclxuXHJcbiAgICAgICAgLy8g5bey57uP5a2Y5Zyo5pa55rOV5a6e5L6L5Y2z57uT5p2f6L+U5ZueXHJcbiAgICAgICAgaWYgKHdpbmRvdy50b3BbJ0ZBUlJJU19KU0JyaWRnZSddID09PSAn5bey5Yqg6L29Jykge1xyXG4gICAgICAgICAgICByZXR1cm4gbWV0aG9kKC4uLnZhbHVlcylcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIOWIpOaWreaYr+WQpuS4uuS6keS4iuWNj+WQjOeOr+Wig1xyXG4gICAgICAgIGlmICh3aW5kb3cudG9wWydGQVJSSVNfSlNCcmlkZ2UnXSA9PT0gJ+S6keS4iuWNj+WQjCcpIHtcclxuICAgICAgICAgICAgaWYgKHdpbmRvdy50b3BbJ2lDaXR5QnJpZGdlJ10pIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBtZXRob2QoLi4udmFsdWVzKVxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdmFyIGNjd29yayA9IHdpbmRvdy50b3AuZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInNjcmlwdFwiKVxyXG4gICAgICAgICAgICAgICAgY2N3b3JrLnNyYyA9ICdodHRwczovL2Njd29yay5vc3MuY24tbm9ydGgtMy5pbnNwdXJjbG91ZG9zcy5jb20vaDUvY2N3b3JrSnNicmlkZ2UuanMnXHJcbiAgICAgICAgICAgICAgICBjY3dvcmsub25sb2FkID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHdpbmRvdy50b3BbJ2lDaXR5QnJpZGdlJ10uaW5pdCgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1ldGhvZCguLi52YWx1ZXMpLnN1YnNjcmliZShcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIChlKSA9PiB7IHN1YmplY3QubmV4dChlKSB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIClcclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgIHdpbmRvdy50b3AuZG9jdW1lbnQuaGVhZC5hcHBlbmRDaGlsZChjY3dvcmspO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyDlvZPliY3msqHmnInpkojlr7nkupEr55qE5Yik5pat77yM5YmN572u546v5aKD5LiN5ruh6Laz5Y2z6buY6K6k5LqRK+eOr+Wig1xyXG4gICAgICAgIGlmICh3aW5kb3cudG9wWydGQVJSSVNfSlNCcmlkZ2UnXSA9PT0gJ+S6keWKoCcpIHtcclxuICAgICAgICAgICAgU3lzdGVtXHJcbiAgICAgICAgICAgICAgICAuaW1wb3J0KCcvcGxhdGZvcm0vY29tbW9uL3dlYi9pbXAuanMnKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oXHJcbiAgICAgICAgICAgICAgICAgICAgKGUpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LnRvcFsnRkFSUklTX0pTQnJpZGdlJ10gPSAn5bey5Yqg6L29JztcclxuICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kKC4uLnZhbHVlcykuc3Vic2NyaWJlKFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKGUpID0+IHsgc3ViamVjdC5uZXh0KGUpIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgKVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIClcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHN1YmplY3Q7XHJcbiAgICB9XHJcblxyXG59XHJcblxyXG5leHBvcnQgeyBKc0JyaWRnZVNlcnZpY2UgfSJdfQ==
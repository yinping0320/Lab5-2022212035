{"version":3,"file":"farris-mobile-command-services.js","sources":["ng://@farris/mobile-command-services/lib/types/rtc-type.ts","ng://@farris/mobile-command-services/lib/base.service.ts","ng://@farris/mobile-command-services/lib/ui-services/loading.service.ts","ng://@farris/mobile-command-services/lib/ui-services/toast.service.ts","ng://@farris/mobile-command-services/lib/ui-services/notify.service.ts","ng://@farris/mobile-command-services/lib/ui-services/dialog.service.ts","ng://@farris/mobile-command-services/lib/ui-services/attachment-preview.service.ts","ng://@farris/mobile-command-services/lib/entity-services/entity-traversing.service.ts","ng://@farris/mobile-command-services/lib/entity-services/entity-manipulation.service.ts","ng://@farris/mobile-command-services/lib/entity-services/entity-aggregation.service.ts","ng://@farris/mobile-command-services/lib/entity-services/entity-list.service.ts","ng://@farris/mobile-command-services/lib/entity-services/entity.service.ts","ng://@farris/mobile-command-services/lib/exception-services/http.ts","ng://@farris/mobile-command-services/lib/exception-services/exception.servcie.ts","ng://@farris/mobile-command-services/lib/data-services/base-data.service.ts","ng://@farris/mobile-command-services/lib/data-services/data-util.ts","ng://@farris/mobile-command-services/lib/data-services/load-data.service.ts","ng://@farris/mobile-command-services/lib/data-services/create-data.service.ts","ng://@farris/mobile-command-services/lib/data-services/edit-data.service.ts","ng://@farris/mobile-command-services/lib/data-services/update-data.service.ts","ng://@farris/mobile-command-services/lib/data-services/remove-data.service.ts","ng://@farris/mobile-command-services/lib/data-services/save-data.service.ts","ng://@farris/mobile-command-services/lib/data-services/cancel-data.service.ts","ng://@farris/mobile-command-services/lib/data-services/be-action.service.ts","ng://@farris/mobile-command-services/lib/data-services/approve.service.ts","ng://@farris/mobile-command-services/lib/data-services/check-data.service.ts","ng://@farris/mobile-command-services/lib/router.servcie.ts","ng://@farris/mobile-command-services/lib/validator-services/validator.service.ts","ng://@farris/mobile-command-services/lib/js-bridge-service/ccwork-service.ts","ng://@farris/mobile-command-services/lib/js-bridge-service/cloud-plus-service.ts","ng://@farris/mobile-command-services/lib/js-bridge-service/js-bridge-strategy-factory.ts","ng://@farris/mobile-command-services/lib/js-bridge-service/js-bridge-stratege.ts","ng://@farris/mobile-command-services/lib/js-bridge-service/decorators.ts","ng://@farris/mobile-command-services/lib/history-back.service.ts","ng://@farris/mobile-command-services/lib/command.service.ts","ng://@farris/mobile-command-services/lib/state-machine.service.ts","ng://@farris/mobile-command-services/lib/ui-state.service.ts","ng://@farris/mobile-command-services/lib/vo-variable.service.ts","ng://@farris/mobile-command-services/lib/attachment-services/types.ts","ng://@farris/mobile-command-services/lib/attachment-services/attachment.util.ts","ng://@farris/mobile-command-services/lib/attachment-services/attachment-data.service.ts","ng://@farris/mobile-command-services/lib/attachment-services/attachment.service.ts","ng://@farris/mobile-command-services/lib/ccwork-service/ccwork.service.ts","ng://@farris/mobile-command-services/lib/map-services/map.service.ts","ng://@farris/mobile-command-services/lib/business-attachment-services/types.ts","ng://@farris/mobile-command-services/lib/business-attachment-services/business-attachment.util.ts","ng://@farris/mobile-command-services/lib/business-attachment-services/business-attachment-data.service.ts","ng://@farris/mobile-command-services/lib/business-attachment-services/business-attachment.service.ts","ng://@farris/mobile-command-services/lib/discussion-group-service/discussion-group.service.ts","ng://@farris/mobile-command-services/lib/work-flow-service/service/task.service.ts","ng://@farris/mobile-command-services/lib/work-flow-service/entity/start-process-payload.ts","ng://@farris/mobile-command-services/lib/work-flow-service/submit/process-selector-vue/process-selector.service.ts","ng://@farris/mobile-command-services/lib/work-flow-service/wf-task-handler.service.ts","ng://@farris/mobile-command-services/lib/providers.ts"],"sourcesContent":["/**\r\n * BeforeNavigate接口请求参数\r\n */\r\nexport interface BeforeNavigateRequestBody {\r\n\r\n  /**\r\n   * 是否是根元数据\r\n   * @summary\r\n   * 1、 根元数据：metadataId传递基础表单id；\r\n   * 2、非根元数据：metadataId传递扩展表单id；\r\n   */\r\n  isRootMetadata: boolean;\r\n\r\n  /**\r\n   * 元数据id\r\n   */\r\n   metadataId: string;\r\n\r\n   /**\r\n    * 维度1\r\n    */\r\n   dim1: string;\r\n \r\n   /**\r\n    * 维度2\r\n    */\r\n   dim2: string;\r\n}\r\n\r\n\r\n/**\r\n * BeforeNavigate接口返回结果\r\n */\r\nexport interface BeforeNavigateReponseBody {\r\n  \r\n  /**\r\n   * 元数据id\r\n   */\r\n   metadataId: string;\r\n\r\n   /**\r\n    * 是否有维度信息\r\n    * @summary\r\n    * 有维度：返回1；\r\n    * 没有维度：返回0；\r\n    */\r\n   withDims: number;\r\n\r\n   /**\r\n    * 维度1\r\n    */\r\n   dim1: string;\r\n \r\n   /**\r\n    * 维度2\r\n    */\r\n   dim2: string;\r\n\r\n}\r\n\r\n/**\r\n * 运行时定制参数\r\n */\r\nexport interface RtcOptions {\r\n\r\n  /**\r\n   * 表单元数据id\r\n   */\r\n  metadataId: string;\r\n\r\n  /**\r\n   * 是否存在维度信息\r\n   */\r\n  withDims: boolean;\r\n\r\n  /**\r\n   * 维度1\r\n   */\r\n  dim1: string;\r\n\r\n  /**\r\n   * 维度2\r\n   */\r\n  dim2: string;\r\n\r\n}\r\n","import { ViewModelContext } from '@farris/mobile-devkit';\r\n\r\n/**\r\n * 数据服务基类\r\n */\r\nclass BaseService {\r\n\r\n  /**\r\n   * 构造函数\r\n   */\r\n  constructor(protected viewModelContext: ViewModelContext) {\r\n  }\r\n\r\n  /**\r\n   * 获取服务实例\r\n   */\r\n  getService<T>(token: any): T {\r\n    const injector = this.viewModelContext.injector;\r\n    return injector.get<T>(token);\r\n  }\r\n\r\n}\r\n\r\nexport { BaseService };\r\n","import { Loading } from '@farris/mobile-ui';\r\n\r\nexport class LoadingService {\r\n\r\n    constructor() {\r\n        this.registerService();\r\n    }\r\n\r\n    /**\r\n     * 显示Loading\r\n     */\r\n    show(message?: string, options?: any): void {\r\n        (Loading as any).show(message, options);\r\n    }\r\n\r\n    /**\r\n     * 隐藏Loading\r\n     */\r\n    hide(): void {\r\n        (Loading as any).hide();\r\n    }\r\n    \r\n    /**\r\n     * 注册所有的LoadingService实例\r\n     */\r\n    private registerService() {\r\n        const services: any[] = window['DEVKIT_LOADING_SERVICE'] || [];\r\n        services.push(this);\r\n        window['DEVKIT_LOADING_SERVICE'] = services;\r\n    }\r\n\r\n\r\n}\r\n","import { Toast } from '@farris/mobile-ui';\r\n\r\n/**\r\n * 轻提示服务\r\n */\r\nclass ToastService {\r\n  /**\r\n   * 消息提示\r\n   */\r\n  info(message: string, options?: any): void {\r\n    (Toast as any).info(message, options);\r\n  }\r\n\r\n  /**\r\n   * 成功提示\r\n   */\r\n  success(message: string, options?: any): void {\r\n    (Toast as any).success(message, options);\r\n  }\r\n\r\n  /**\r\n   * 警告提示\r\n   */\r\n  warning(message: string, options?: any): void {\r\n    (Toast as any).warning(message, options);\r\n  }\r\n\r\n  /**\r\n   * 失败提示\r\n   */\r\n  error(message: string, options?: any): void {\r\n    (Toast as any).error(message, options);\r\n  }\r\n  /**\r\n   * 自定义提示\r\n   */\r\n  show(options?: any) {\r\n    (Toast as any)(options);\r\n  }\r\n}\r\nexport { ToastService };\r\n","import { Notify } from '@farris/mobile-ui';\r\nimport { Observable, of, EMPTY } from 'rxjs';\r\n\r\n/**\r\n * 消息提示服务\r\n * @summary\r\n * 页面边缘滑出，自动消失，语气略强于Toast\r\n */\r\nexport class NotifyService {\r\n\r\n    /**\r\n     * 消息提示\r\n     */\r\n    info(message: string, options?: any): void {\r\n        (Notify as any).info(message, { duration : 1500, ...options });\r\n    }\r\n\r\n    /**\r\n     * 成功提示\r\n     */\r\n    success(message: string, options?: any): void {\r\n      (Notify as any).success(message, { duration : 1000, ...options });\r\n    }\r\n\r\n    /**\r\n     * 警告提示\r\n     */\r\n    warning(message: string, options?: any): void {\r\n      (Notify as any).warning(message, { duration : 1500, ...options });\r\n    }\r\n\r\n    /**\r\n     * 失败提示\r\n     */\r\n    error(message: string, options?: any): void {\r\n      (Notify as any).error(message, { duration : 1500, ...options });\r\n    }\r\n\r\n    /**\r\n     * 自定义提醒\r\n     */\r\n    show(options: any) {\r\n      (Notify as any).show(options);\r\n    }\r\n}\r\n","import { Observable, from, EMPTY } from 'rxjs';\r\nimport { Dialog } from '@farris/mobile-ui';\r\n\r\nclass DialogService {\r\n\r\n  /**\r\n   * 提示对话框\r\n   * @summary\r\n   * type=info|success|warning|error\r\n   */\r\n  alert(message: string, options?: any): Observable<boolean> {\r\n    const promise$: Promise<boolean> = new Promise((resolve, reject) => {\r\n      Dialog.alert({\r\n        title: '提醒',\r\n        message: message,\r\n        cancelText: '取消',\r\n        confirmText: '确定',\r\n        onConfirm: () => { resolve(true) },\r\n        onCancel: () => { resolve(false) },\r\n        ...options\r\n      });\r\n    });\r\n    return from(promise$);\r\n  }\r\n\r\n  /**\r\n   * 确认框对话框\r\n   */\r\n  confirm(message: string): Observable<boolean> {\r\n    const confirmResult$: Promise<boolean> = this.confirmPromise(message);\r\n    return from(confirmResult$);\r\n  }\r\n\r\n  /**\r\n   * 自定义弹窗\r\n   */\r\n  show(options: any): void {\r\n    this.confirmPromise(options);\r\n  }\r\n\r\n  /**\r\n   * 输入对话框\r\n   * @param title 标题\r\n   * @param options 配置信息\r\n   */\r\n  prompt(title: string, options?: any): Observable<string> {\r\n    const promise$: Promise<string> = new Promise((resolve, reject) => {\r\n      const vm = Dialog.prompt({\r\n        title: title,\r\n        confirmText: '确定',\r\n        onConfirm: () => {\r\n          resolve(vm.$data.promptText);\r\n        },\r\n        onCancel: () => { resolve('取消'); },\r\n        onShow: () => {\r\n          console.log('显示弹窗');\r\n        },\r\n        ...options\r\n      });\r\n    });\r\n    return from(promise$);\r\n  }\r\n\r\n  /**\r\n   * 使用Promise实例包装回调方法，以同步回调方法执行后结果\r\n   */\r\n  private confirmPromise(message?: string): Promise<boolean> {\r\n    return new Promise((resolve, reject) => {\r\n      Dialog.confirm({\r\n        message: message,\r\n        onConfirm: () => { resolve(true); },\r\n        onCancel: () => { resolve(false); },\r\n      })\r\n    });\r\n  }\r\n}\r\n\r\nexport { DialogService };\r\n","import { AttachmentPreview } from '@farris/mobile-business-ui';\r\nclass AttachmentPreviewService {\r\n    /**\r\n     * 自定义弹窗\r\n     */\r\n    show(options: IPreview): void {\r\n        AttachmentPreview.show(options);\r\n    }\r\n}\r\n\r\ninterface IPreview {\r\n    title: string;\r\n    attachmentId?: string;\r\n    rootId?: string;\r\n    path?: string;\r\n}\r\n\r\nexport { AttachmentPreviewService };\r\n","import { ViewModelContext, BindingData, BindingList, BindingObject } from '@farris/mobile-devkit';\r\n\r\n/**\r\n * 实体遍历服务\r\n */\r\nclass EntityTraversingService {\r\n\r\n  private get bindingData(): BindingData {\r\n    return this.viewModelContext.bindingData;\r\n  }\r\n\r\n  constructor(private viewModelContext: ViewModelContext) {\r\n  }\r\n\r\n  /**\r\n   * 获取值\r\n   */\r\n  public getPropValue(path: string[]): any {\r\n    return this.bindingData.getValue(path);\r\n  }\r\n\r\n  /**\r\n   * 获取实体数据\r\n   */\r\n  public getEntityData(path: string[]): any {\r\n    let bindingObj: BindingObject;\r\n    const bindingListOrObject = this.bindingData.getValue(path);\r\n    if (bindingListOrObject instanceof BindingList === true) {\r\n      bindingObj = bindingListOrObject.currentItem;\r\n    } else {\r\n      bindingObj = bindingListOrObject;\r\n    }\r\n    return bindingObj.toJSON();\r\n  }\r\n\r\n  /**\r\n   * 获取实体列表数据\r\n   */\r\n  public getEntityListData(path: string[]): any[] {\r\n    const bindingList = this.bindingData.getValue(path) as BindingList;\r\n    return bindingList.toJSON();\r\n  }\r\n\r\n}\r\n\r\nexport { EntityTraversingService };\r\n","import { ViewModelContext, BindingData } from '@farris/mobile-devkit';\r\n\r\nclass EntityManipulationService {\r\n\r\n  private get bindingData(): BindingData {\r\n    return this.viewModelContext.bindingData;\r\n  }\r\n\r\n  constructor(private viewModelContext: ViewModelContext) {\r\n  }\r\n\r\n  /**\r\n   * 设置path对应的字段值\r\n   */\r\n  public setPropValue(path: string[], value: any): any {\r\n\r\n    // 实体层还没有封装，临时用BindingData相关方法代替\r\n    this.bindingData.setValue(path, value, true, true);\r\n  }\r\n\r\n}\r\n\r\nexport { EntityManipulationService };\r\n","import { ViewModelContext, BindingData, BindingList } from '@farris/mobile-devkit';\r\nimport { EntityTraversingService } from './entity-traversing.service';\r\n\r\ninterface SplitedPath {\r\n  listPath: string[];\r\n  propPath: string[];\r\n}\r\n\r\n/**\r\n * 实体聚合服务\r\n */\r\nclass EntityAggregationService {\r\n\r\n  private get bindingData(): BindingData {\r\n    return this.viewModelContext.bindingData;\r\n  }\r\n\r\n  private traversingService: EntityTraversingService;\r\n\r\n  constructor(private viewModelContext: ViewModelContext) {\r\n    this.traversingService   = this.viewModelContext.injector.get<EntityTraversingService>(EntityTraversingService);\r\n  }\r\n\r\n  /**\r\n   * 获取path对应列表记录的条数\r\n   */\r\n  public count(path: string[]): number {\r\n    const splitedPath = this.splitPath(path);\r\n    const entityListData = this.traversingService.getEntityListData(splitedPath.listPath);\r\n    return entityListData.length;\r\n  }\r\n\r\n  /**\r\n   * 获取path对应字段的和\r\n   */\r\n  public sum(path: string[]) {\r\n    const splitedPath = this.splitPath(path);\r\n    const entityListData = this.traversingService.getEntityListData(splitedPath.listPath);\r\n\r\n    const total = entityListData.reduce((accTotal: number, entityData: any) => {\r\n      let propValue = parseFloat(this.getPropValue(entityData, splitedPath.propPath));\r\n      propValue = isNaN(propValue) ? 0 : propValue;\r\n      accTotal += propValue;\r\n      return accTotal;\r\n    }, 0);\r\n    return total;\r\n  }\r\n\r\n  /**\r\n   * 获取path对应字段的平均值\r\n   */\r\n  public avg(path: string[]) {\r\n    const count = this.count(path);\r\n    const total = this.sum(path);\r\n    return count !== 0 ? total / count : 0;\r\n  }\r\n\r\n  /**\r\n   * 获取path对应字段的最大值\r\n   */\r\n  public max(path: string[]): number {\r\n    const splitedPath = this.splitPath(path);\r\n    const entityListData = this.traversingService.getEntityListData(splitedPath.listPath);\r\n\r\n    const max =  entityListData.reduce((accMax: number, entityData: any) => {\r\n      const propValue = parseFloat(this.getPropValue(entityData, splitedPath.propPath));\r\n      if (isNaN(propValue) === false && ( !accMax || propValue > accMax)) {\r\n        accMax = propValue;\r\n      }\r\n      return accMax;\r\n    }, null);\r\n    return max ? max : 0;\r\n  }\r\n\r\n  /**\r\n   * 获取path对应字段的最小值\r\n   */\r\n  public min(path: string[]): number {\r\n    const splitedPath = this.splitPath(path);\r\n    const entityListData = this.traversingService.getEntityListData(splitedPath.listPath);\r\n\r\n    const min = entityListData.reduce((accMin: number, entityData: any) => {\r\n      const propValue = parseFloat(this.getPropValue(entityData, splitedPath.propPath));\r\n      if (isNaN(propValue) === false && ( !accMin || propValue < accMin)) {\r\n        accMin = propValue;\r\n      }\r\n      return accMin;\r\n    }, null);\r\n    return min ? min : 0;\r\n  }\r\n\r\n  /**\r\n   * 获取属性值\r\n   */\r\n  private getPropValue(entityData: any, path: string[]) {\r\n    let currentData = entityData;\r\n    path.forEach((pathItem: string) => {\r\n\r\n      // 提前退出的都重置为null，主要针对关联对象未赋值场景\r\n      if (!currentData) {\r\n        currentData = null;\r\n        return;\r\n      }\r\n      currentData = currentData[pathItem];\r\n    });\r\n\r\n    return currentData;\r\n  }\r\n\r\n  /**\r\n   * 分隔路径，分隔符列表路径和属性路径\r\n   * @return 形如 {parentListPath: [], propertyPath: []}\r\n   */\r\n  private splitPath(path: string[]): SplitedPath {\r\n    const listPath = path.concat([]);\r\n    const propPath = [];\r\n    let currentNode = this.bindingData.getValue(listPath);\r\n    while (currentNode instanceof BindingList !== true) {\r\n      const propPathItem = listPath.pop();\r\n      if (!propPathItem) {\r\n        return;\r\n      }\r\n      propPath.unshift(propPathItem);\r\n      currentNode = this.bindingData.getValue(listPath);\r\n    }\r\n\r\n    return {\r\n      listPath: listPath,\r\n      propPath: propPath\r\n    };\r\n  }\r\n\r\n}\r\n\r\nexport { EntityAggregationService };\r\n","import { ViewModelContext } from '@farris/mobile-devkit';\r\n\r\n/**\r\n * EntityList服务\r\n * @scope FrameComponent\r\n */\r\nclass EntityListService {\r\n\r\n  constructor(private viewModelContext: ViewModelContext) {}\r\n\r\n}\r\n\r\nexport { EntityListService };\r\n","import { ViewModelContext } from '@farris/mobile-devkit';\r\nimport { EntityTraversingService } from './entity-traversing.service';\r\nimport { EntityManipulationService } from './entity-manipulation.service';\r\nimport { EntityAggregationService} from './entity-aggregation.service';\r\n\r\n/**\r\n * 实体服务\r\n * @scope FrameComponent\r\n */\r\nclass EntityService {\r\n\r\n  private traversingService: EntityTraversingService;\r\n\r\n  private manipulationService: EntityManipulationService;\r\n\r\n  private aggregationService: EntityAggregationService;\r\n\r\n  private viewModelContext: ViewModelContext;\r\n\r\n  constructor(viewModelContext: ViewModelContext) {\r\n    this.viewModelContext    = viewModelContext;\r\n    this.traversingService   = new EntityTraversingService(viewModelContext);\r\n    this.manipulationService = new EntityManipulationService(viewModelContext);\r\n    this.aggregationService  = new EntityAggregationService(viewModelContext);\r\n  }\r\n\r\n  /**\r\n   * 获取path对应的属性值\r\n   */\r\n  public getPropValue(path: string[]): any {\r\n    return this.traversingService.getPropValue(path);\r\n  }\r\n\r\n  /**\r\n   * 设置path对应的属性值\r\n   */\r\n  public setPropValue(path: string[], value: any): void {\r\n    return this.manipulationService.setPropValue(path, value);\r\n  }\r\n\r\n  /**\r\n   * 设置path对应的Entity数据\r\n   */\r\n  public getEntityData(path: string[]): any {\r\n    return this.traversingService.getEntityData(path);\r\n  }\r\n\r\n  /**\r\n   * 设置path对应的EntityList数据\r\n   */\r\n  public getEntityListData(path: string[]): any {\r\n    return this.traversingService.getEntityListData(path);\r\n  }\r\n\r\n  /**\r\n   * 获取path对应EntityList记录数\r\n   */\r\n  public count(path: string[]): number {\r\n    return this.aggregationService.count(path);\r\n  }\r\n\r\n  /**\r\n   * 获取path对应属性的合计值\r\n   */\r\n  public sum(path: string[]): number {\r\n    return this.aggregationService.sum(path);\r\n  }\r\n\r\n  /**\r\n   * 获取path对应属性的平均值\r\n   */\r\n  public avg(path: string[]): number {\r\n    return this.aggregationService.avg(path);\r\n  }\r\n\r\n  /**\r\n   * 获取path对应属性的最大值\r\n   */\r\n  public max(path: string[]): number {\r\n    return this.aggregationService.max(path);\r\n  }\r\n\r\n  /**\r\n   * 获取path对应属性的最小值\r\n   */\r\n  public min(path: string[]): number {\r\n    return this.aggregationService.min(path);\r\n  }\r\n}\r\n\r\nexport { EntityService };\r\n","// https://github.com/typeslick/status-code-enum\r\nenum HttpStatusType {\r\n    Info = 1,\r\n    Success,\r\n    Redirect,\r\n    ClientError,\r\n    ServerError\r\n}\r\n\r\n/**\r\n * http通用类\r\n */\r\nclass HttpUtil {\r\n\r\n    /**\r\n     * 基于http状态码返回状态类型\r\n     * @param httpResponseSatus http请求返回状态码\r\n     * @returns null | HttpStatusType\r\n     */\r\n    public static getHttpStatusType(httpResponseSatus: number): any {\r\n        if (!httpResponseSatus) {\r\n            return null;\r\n        }\r\n        \r\n        let statusType = null; // 默认值为空\r\n        \r\n        if (httpResponseSatus < 100 || httpResponseSatus > 600) {\r\n            statusType = null; // 不合理状态码\r\n        } else if (httpResponseSatus >= 100 && httpResponseSatus < 200) {\r\n            statusType = HttpStatusType.Info;\r\n        } else if (httpResponseSatus >= 200 && httpResponseSatus < 300) {\r\n            statusType = HttpStatusType.Success;\r\n        } else if (httpResponseSatus >= 300 && httpResponseSatus < 400) {\r\n            statusType = HttpStatusType.Redirect;\r\n        } else if (httpResponseSatus >= 400 && httpResponseSatus < 500) {\r\n            statusType = HttpStatusType.ClientError;\r\n        } else if (httpResponseSatus >= 500 && httpResponseSatus < 600) {\r\n            statusType = HttpStatusType.ServerError;\r\n        }\r\n\r\n        return statusType;\r\n    }\r\n}\r\n\r\nexport { HttpUtil, HttpStatusType };","import { IErrorServe } from '@farris/mobile-bef';\r\nimport { NotifyService } from '../ui-services';\r\nimport { HttpUtil, HttpStatusType } from './http';\r\nimport { ExceptionLevel } from './types';\r\nimport { JsBridgeService } from '../js-bridge-service/index';\r\n/**\r\n * 实体操作服务\r\n */\r\nclass ExceptionService implements IErrorServe {\r\n\r\n  /**\r\n   * 构造函数\r\n   */\r\n  constructor(private notifyService: NotifyService, private jsBridgeService: JsBridgeService) {\r\n  }\r\n\r\n  /**\r\n   * 显示异常信息\r\n   */\r\n  show(error) {\r\n    this.exception(error);\r\n  }\r\n\r\n  /**\r\n * 异常处理路由方法\r\n */\r\n  private exception(error: any) {\r\n    // 针对session失效做特殊处理\r\n    if (error.message && error.message.indexOf('401') !== -1) {\r\n      this.notifyService.error('登录信息已失效请重新打开');\r\n      setTimeout(() => { this.jsBridgeService.closeWindow() }, 2000)\r\n      return;\r\n    }\r\n    if (error && error.response) {\r\n      this.httpErrorHandler(error.response);\r\n    }\r\n  }\r\n\r\n  /**\r\n * http请求异常处理器\r\n */\r\n  private httpErrorHandler(httpError): void {\r\n    if (!httpError) {\r\n      return;\r\n    }\r\n\r\n    const statusType = HttpUtil.getHttpStatusType(httpError.status);\r\n\r\n    switch (statusType) {\r\n      case HttpStatusType.ClientError:\r\n        this.httpErrorInClient(httpError);\r\n        break;\r\n      case HttpStatusType.ServerError:\r\n        this.httpErrorInServer(httpError);\r\n        break;\r\n      default:\r\n        throw new Error('Get invalid status code when using httpErrorHandler method.');\r\n    }\r\n  }\r\n\r\n\r\n  /**\r\n * 服务器端异常提示弹框\r\n */\r\n  private httpErrorInServer(httpError): void {\r\n    let error = httpError.data;\r\n    if (typeof (error) === 'string') {\r\n      try {\r\n        error = JSON.parse(error);\r\n      } catch (e) { }\r\n    }\r\n    if (!error || error.Level == null || error.Level == undefined) { // 未封装error或未设置异常等级\r\n      this.notifyService.error(httpError.message);\r\n      return;\r\n    }\r\n\r\n    const getNotifyServiceMethodName: String = this.getNotifyServiceMethodName(error.Level);\r\n\r\n    this.notifyService[`${getNotifyServiceMethodName}`](error.Message);\r\n  }\r\n\r\n  /**\r\n   * 客户端异常提示弹框\r\n   */\r\n  private httpErrorInClient(httpError): void {\r\n    if (!httpError) {\r\n      return;\r\n    }\r\n    const url = httpError.config && httpError.config.url && httpError.config.url;\r\n    const status = httpError.status && httpError.status;\r\n    this.notifyService.error(`${url} ${status}`);\r\n  }\r\n\r\n\r\n  /**\r\n * 获取异常处理策略\r\n * @param exceptionLevel 异常等级\r\n */\r\n  public getNotifyServiceMethodName(exceptionLevel): String {\r\n    let exception;\r\n    switch (exceptionLevel) {\r\n      case ExceptionLevel.Info:\r\n        exception = 'info';\r\n        break;\r\n      case ExceptionLevel.Warning:\r\n        exception = 'warning';\r\n        break;\r\n      case ExceptionLevel.Error:\r\n        exception = 'error';\r\n        break;\r\n      case ExceptionLevel.Fatal:\r\n        exception = 'fatal';\r\n        break;\r\n      default:\r\n        // 默认异常等级是错误\r\n        exception = 'error';\r\n        break;\r\n    }\r\n\r\n    return exception;\r\n  }\r\n}\r\n\r\nexport { ExceptionService };\r\n","import { Entity, ViewModelContext } from '@farris/mobile-devkit';\r\nimport { BefRepository } from '@farris/mobile-bef';\r\nimport { EntityService } from '../entity-services/index';\r\nimport { LoadingService, ToastService, NotifyService, DialogService } from '../ui-services/index';\r\nimport { ExceptionService } from '../exception-services/index';\r\nimport { CommandService } from '../command.service';\r\n\r\n/**\r\n * 数据服务基类\r\n */\r\nclass BaseDataService {\r\n\r\n  protected loadingService: LoadingService;\r\n\r\n  protected toastService: ToastService;\r\n\r\n  protected notifyService: NotifyService;\r\n\r\n  protected dialogService: DialogService;\r\n\r\n  protected exceptionService: ExceptionService;\r\n\r\n  protected befRepository: BefRepository<Entity>;\r\n\r\n  protected entityService: EntityService;\r\n\r\n  constructor(protected viewModelContext: ViewModelContext) {\r\n    this.init();\r\n  }\r\n\r\n  private init() {\r\n    this.initServices();\r\n  }\r\n\r\n  private initServices() {\r\n    this.loadingService = this.getService<LoadingService>(LoadingService);\r\n    this.toastService = this.getService<ToastService>(ToastService);\r\n    this.notifyService = this.getService<NotifyService>(NotifyService);\r\n    this.dialogService = this.getService<DialogService>(DialogService);\r\n    this.exceptionService = this.getService<ExceptionService>(ExceptionService);\r\n    this.entityService = this.getService<EntityService>(EntityService);\r\n    this.befRepository = this.viewModelContext.repository as BefRepository<Entity>;\r\n  }\r\n\r\n  /**\r\n   * 获取服务实例\r\n   */\r\n  getService<T>(token: any): T {\r\n    const injector = this.viewModelContext.injector;\r\n    return injector.get<T>(token);\r\n  }\r\n\r\n}\r\n\r\nexport { BaseDataService };\r\n","import { ViewModelContext } from '@farris/mobile-devkit';\r\n\r\n/**\r\n * 数据工具类\r\n * @summary\r\n * 数据相关的工具方法临时放在这里\r\n */\r\nclass DataUtil {\r\n\r\n  /**\r\n   * 将BindingPath转换为EntityPath\r\n   */\r\n  public static convertBindingPathToEntityPath(bindingPath: string, viewModelContext: ViewModelContext): string {\r\n    const rid = viewModelContext.bindingData.list.currentId; // root表数据id\r\n    let path = '/' + rid;\r\n\r\n    const subPaths = bindingPath.split('/');\r\n    if (subPaths.length > 0) {\r\n      for (let index = 1; index < subPaths.length - 1; index++) {\r\n        const subPath = subPaths[index];\r\n        const subData = viewModelContext.bindingData[subPath];\r\n        if (!subData || !subData.currentId) {\r\n          throw Error(`获取子表完整路径出错，找不到${subData}对应的子表，或对应子表没有当前行。`);\r\n        }\r\n        path += `/${subPath}/${subData.currentId}`;\r\n      }\r\n    }\r\n    path += '/' + subPaths[subPaths.length - 1];\r\n\r\n    return path;\r\n  }\r\n\r\n  public static clearFromValidateType(viewModelContext: ViewModelContext): void {\r\n    const contexts = viewModelContext.appContext.viewModelContextManager.getContexts();\r\n    const contextsChild = contexts.filter(item => { return (item.parent && viewModelContext.id === item.parent.id) })\r\n    if (contextsChild.length >= 1) {\r\n      contextsChild.forEach(item => {\r\n        item.form.resetFieldsValidate()\r\n      })\r\n    }\r\n  }\r\n\r\n  public static stringTransformArray(parame): any[] {\r\n    if (this.parameIsThreeBoss(parame)) {\r\n      return []\r\n    } else {\r\n      return JSON.parse(parame);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 检测参数是否属于三大幻神 ''  undefined  null\r\n   */\r\n  public static parameIsThreeBoss(parame) {\r\n    if (parame === '' || parame === undefined || parame === null) {\r\n      return true\r\n    } else {\r\n      return false\r\n    }\r\n  }\r\n}\r\n\r\nexport { DataUtil };\r\n\r\n","import { Observable, of, EMPTY } from 'rxjs';\r\nimport { switchMap, tap } from 'rxjs/operators';\r\nimport { Entity, ViewModelContext } from '@farris/mobile-devkit';\r\nimport { BefRepository } from '@farris/mobile-bef';\r\nimport { BaseDataService } from './base-data.service';\r\nimport { DataUtil } from './data-util';\r\n\r\nexport class LoadDataService extends BaseDataService {\r\n\r\n  constructor(viewModelContext: ViewModelContext) {\r\n    super(viewModelContext);\r\n  }\r\n\r\n  /**\r\n   * 加载列表数据\r\n   */\r\n  public loadForList(filters: any[], sorts: any[], size?: number, index?: number): Observable<Entity[]> {\r\n    if (typeof filters === 'string') {\r\n      filters = DataUtil.stringTransformArray(filters);\r\n    }\r\n    if (typeof sorts === 'string') {\r\n      sorts = DataUtil.stringTransformArray(sorts);\r\n    }\r\n    let { pageSize, pageIndex } = this.viewModelContext.repository.paginationInfo || { pageSize: null, pageIndex: null };\r\n    this.loadingService.show();\r\n\r\n    if (!size && !pageSize) {\r\n      pageSize = 20;\r\n    } else if (size) {\r\n      pageSize = size;\r\n    }\r\n\r\n    if (!index && !pageIndex) {\r\n      pageIndex = 1;\r\n    } else if (index) {\r\n      pageIndex = index;\r\n    }\r\n\r\n    if (pageIndex === 1) {\r\n      this.befRepository.entityCollection.clear();\r\n    }\r\n\r\n    const query$ = this.befRepository.getEntities(filters, sorts, pageSize, pageIndex);\r\n    return query$.pipe(\r\n      tap(\r\n        () => {\r\n          let { pageIndex, pageCount, totalCount } = this.viewModelContext.repository.paginationInfo;\r\n          if (pageIndex === pageCount || totalCount === 0) {\r\n            this.viewModelContext.appContext.eventBus.triggerEvent({ type: 'listviewFinished' })\r\n          } else {\r\n            this.viewModelContext.appContext.eventBus.triggerEvent({ type: 'listviewUnFinished' })\r\n          }\r\n          this.viewModelContext.appContext.eventBus.triggerEvent({ type: 'loadDataFinished' })\r\n          this.loadingService.hide();\r\n        },\r\n        (exception: any) => {\r\n          this.loadingService.hide();\r\n        }\r\n      )\r\n    );\r\n  }\r\n\r\n  /**\r\n   * 加载卡片数据\r\n   */\r\n  public loadForCard(id: string): Observable<Entity> {\r\n    DataUtil.clearFromValidateType(this.viewModelContext);\r\n    this.loadingService.show();\r\n    const get$ = this.befRepository.getEntityById(id);\r\n    return get$.pipe(\r\n      tap(\r\n        () => {\r\n          this.loadingService.hide();\r\n        },\r\n        (exception: any) => {\r\n          this.loadingService.hide();\r\n        }\r\n      )\r\n    );\r\n  }\r\n\r\n  /**\r\n * 加载进入子表后，未作任何操作之前的数据\r\n * @param path 子表路径\r\n */\r\n  public loadDataForChildCard(path: string) {\r\n    const childID = this.viewModelContext.bindingData[path]['id'];\r\n    const id = this.viewModelContext.bindingData[path]['parentID'];\r\n    const entity = this.viewModelContext.repository.entityCollection.getEntityById(id)\r\n    const childEntityAll = entity[path];\r\n    const childEntityData = childEntityAll.get(childID).data;\r\n    this.viewModelContext.uiState.setPropertyValue('$childEntity', { ...childEntityData });\r\n  }\r\n}\r\n","import { Observable } from 'rxjs';\r\nimport { tap } from 'rxjs/operators';\r\nimport { Entity, ViewModelContext } from '@farris/mobile-devkit';\r\n\r\nimport { BaseDataService } from './base-data.service';\r\nimport { DataUtil } from './data-util';\r\n\r\n/**\r\n * 新增数据服务类\r\n */\r\nexport class CreateDataService extends BaseDataService {\r\n\r\n  constructor(viewModelContext: ViewModelContext) {\r\n    super(viewModelContext);\r\n  }\r\n\r\n  /**\r\n   * 新增数据\r\n   */\r\n  public create(): Observable<Entity> {\r\n    this.befRepository.entityCollection.clear();\r\n    DataUtil.clearFromValidateType(this.viewModelContext);\r\n    this.loadingService.show();\r\n    const create$ = this.befRepository.createEntity();\r\n    return create$.pipe(\r\n      tap(\r\n        () => {\r\n          this.loadingService.hide();\r\n        },\r\n        (exception: any) => {\r\n          this.loadingService.hide();\r\n        }\r\n      )\r\n    );\r\n  }\r\n\r\n  /**\r\n   * 新增后代节点\r\n   */\r\n  public createByPath(path: string): Observable<Entity> {\r\n    this.loadingService.show();\r\n    // 当前为新增\r\n    const entityPath = DataUtil.convertBindingPathToEntityPath(path, this.viewModelContext);\r\n    const append$ = this.befRepository.appendEntityByPath(entityPath);\r\n    const result$ = append$.pipe(\r\n      tap(\r\n        (e) => {\r\n          this.viewModelContext.uiState.setPropertyValue('$isAdd', { status: true, id: e['id'], path, child: { ...e.data } });\r\n          this.loadingService.hide();\r\n        },\r\n        (exception: any) => {\r\n          this.loadingService.hide();\r\n        }\r\n      )\r\n    );\r\n\r\n    return result$;\r\n  }\r\n\r\n}\r\n","import { Observable } from 'rxjs';\r\nimport { tap } from 'rxjs/operators';\r\nimport { Entity, ViewModelContext } from '@farris/mobile-devkit';\r\nimport { BaseDataService } from './base-data.service';\r\n\r\nexport class EditDataService extends BaseDataService {\r\n\r\n  constructor(viewModelContext: ViewModelContext) {\r\n    super(viewModelContext);\r\n  }\r\n\r\n  /**\r\n   * 编辑数据\r\n   */\r\n  public edit(id: string): Observable<Entity> {\r\n    this.loadingService.show();\r\n    const edit$ = this.befRepository.editEntityById(id);\r\n    return edit$.pipe(\r\n      tap(\r\n        () => {\r\n          this.loadingService.hide();\r\n        },\r\n        (exception: any) => {\r\n          this.loadingService.hide();\r\n        }\r\n      )\r\n    );\r\n  }\r\n\r\n}\r\n","import { Observable, of, EMPTY } from 'rxjs';\r\nimport { switchMap, tap } from 'rxjs/operators';\r\nimport { Entity, ViewModelContext } from '@farris/mobile-devkit';\r\nimport { BefRepository } from '@farris/mobile-bef';\r\nimport { BaseDataService } from './base-data.service';\r\n\r\n/**\r\n * 数据更新服务\r\n */\r\nexport class UpdateDataService extends BaseDataService {\r\n\r\n  constructor(viewModelContext: ViewModelContext) {\r\n    super(viewModelContext);\r\n  }\r\n\r\n  /**\r\n   * 编辑数据\r\n   */\r\n  public update(id): Observable<Entity> {\r\n    this.loadingService.show();\r\n    const update$ = this.befRepository.updateEntityById(id);\r\n    const result$ =  update$.pipe(\r\n      tap(\r\n        () => {\r\n          this.loadingService.hide();\r\n        },\r\n        (exception: any) => {\r\n          this.loadingService.hide();\r\n          // this.exceptionService.show('更新失败', exception);\r\n        }\r\n      )\r\n    );\r\n\r\n    return result$;\r\n  }\r\n\r\n}\r\n","import { Observable, of, EMPTY } from 'rxjs';\r\nimport { tap, switchMap } from 'rxjs/operators';\r\nimport { Entity, HttpMethods, HttpRequestConfig, ViewModelContext } from '@farris/mobile-devkit';\r\n\r\nimport { DataUtil } from './data-util';\r\nimport { BaseDataService } from './base-data.service';\r\n\r\n\r\n/**\r\n * 删除数据服务类\r\n */\r\nexport class RemoveDataService extends BaseDataService {\r\n\r\n  constructor(viewModelContext: ViewModelContext) {\r\n    super(viewModelContext);\r\n  }\r\n\r\n\r\n  /**\r\n   * 删除数据\r\n   */\r\n  public removeById(id: string): Observable<any> {\r\n\r\n    const result$ = this.dialogService.confirm('是否删除').pipe(\r\n      switchMap(val => {\r\n        if (val === false) {\r\n          return EMPTY;\r\n        }\r\n        if (this['context'] && this['context'].eventParams && this['context'].eventParams.swipecellClose) {\r\n          this['context'].eventParams.swipecellClose();\r\n        }\r\n        return this.cancelChanges(id);\r\n      }\r\n      ))\r\n    return result$\r\n  }\r\n\r\n  /**\r\n   * 确认删除\r\n   * @param id \r\n   */\r\n\r\n  private cancelChanges(id: string): Observable<any> {\r\n    this.loadingService.show();\r\n    const remove$ = this.befRepository.removeEntityAndSaveById(id);\r\n    return remove$.pipe(\r\n      tap(\r\n        () => {\r\n          this.notifyService.success('删除成功');\r\n          this.loadingService.hide();\r\n        },\r\n        () => {\r\n          this.loadingService.hide();\r\n          this.notifyService.error('删除失败');\r\n        }\r\n      )\r\n    );\r\n  }\r\n\r\n\r\n  /**\r\n   * 批量删除数据\r\n   */\r\n  public removeByIds(ids: string[]): Observable<boolean> {\r\n    // 由于ListView尚未和UIState集成，无法直接获取ids，临时从事件参数中获取\r\n    if (!ids) {\r\n      const selectedItems = this['context'].eventParams;\r\n      ids = selectedItems.map((selectedItem) => {\r\n        return selectedItem.id;\r\n      });\r\n    }\r\n\r\n    const multiRemove$ = this.dialogService.confirm('是否删除').pipe(\r\n      switchMap(val => {\r\n        if (val === false) {\r\n          return EMPTY;\r\n        }\r\n        this.loadingService.show();\r\n        return this.befRepository.removeEntitiesByIds(ids);\r\n      }));\r\n    return multiRemove$.pipe(\r\n      tap(\r\n        () => {\r\n          this.loadingService.hide();\r\n          this.notifyService.success('删除成功');\r\n        },\r\n        (exception: any) => {\r\n          this.loadingService.hide();\r\n\r\n          // this.exceptionService.show('删除失败', exception);\r\n        }\r\n      )\r\n    );\r\n  }\r\n\r\n  /**\r\n   * 删除后代节点数据\r\n   */\r\n  public removeByPathAndId(path: string, id: string): Observable<boolean> {\r\n    const result$ = this.dialogService.confirm('是否删除').pipe(\r\n      switchMap(val => {\r\n        if (val === false) {\r\n          return EMPTY;\r\n        }\r\n        if (this['context'] && this['context'].eventParams && this['context'].eventParams.swipecellClose) {\r\n          this['context'].eventParams.swipecellClose();\r\n        }\r\n        return this.removeByPathAndIdChanges(path, id);\r\n      }\r\n      ));\r\n    return result$;\r\n  }\r\n\r\n\r\n  public removeByPathAndIdChanges(path: string, id: string): Observable<boolean> {\r\n    this.loadingService.show();\r\n    const entityPath = DataUtil.convertBindingPathToEntityPath(path, this.viewModelContext);\r\n    const remove$ = this.befRepository.removeEntityByPath(entityPath, id);\r\n    return remove$.pipe(\r\n      tap(\r\n        () => {\r\n          this.loadingService.hide();\r\n          this.notifyService.success('删除成功');\r\n        },\r\n        (error: any) => {\r\n          this.loadingService.hide();\r\n          console.error(error);\r\n        }\r\n      )\r\n    );\r\n  }\r\n\r\n  /**\r\n   * 批量删除后代节点数据\r\n   */\r\n  public removeByPathAndIds(path: string, ids: string[]): Observable<boolean> {\r\n    throw new Error('Not Implemented');\r\n  }\r\n\r\n  /**\r\n   * 业务附件批量删除数据\r\n   */\r\n  public removeByBusinessIds(url: string, ids: string[]): Observable<boolean> {\r\n    // 由于ListView尚未和UIState集成，无法直接获取ids，临时从事件参数中获取\r\n    if (!ids) {\r\n      const selectedItems = this['context'].eventParams;\r\n      ids = selectedItems.map((selectedItem) => {\r\n        return selectedItem.id;\r\n      });\r\n    }\r\n    const params = {\r\n      ids: ids.join(',')\r\n    };\r\n    const requestConfig: HttpRequestConfig = {\r\n      params: params,\r\n      body: {\r\n        dataChange: [],\r\n        variableChange: null\r\n      }\r\n    };\r\n    return this.befRepository.apiProxy.request(HttpMethods.PUT, url, requestConfig, true);\r\n    // this.loadingService.show();\r\n    // const multiRemove$ = this.dialogService.confirm('是否删除').pipe(\r\n    //   switchMap(val => {\r\n    //     if (val === false) {\r\n    //       return EMPTY;\r\n    //     }\r\n    //   }));\r\n    // return multiRemove$.pipe(\r\n    //   tap(\r\n    //     () => {\r\n    //       this.loadingService.hide();\r\n    //     },\r\n    //     (exception: any) => {\r\n    //       this.loadingService.hide();\r\n    //     }\r\n    //   )\r\n    // );\r\n  }\r\n\r\n\r\n  /**\r\n   * 业务附件删除后代节点数据\r\n   */\r\n  public removeByBusinessPathAndId(url: string, path: string, id: string): Observable<boolean> {\r\n    const result$ = this.dialogService.confirm('是否删除').pipe(\r\n      switchMap(val => {\r\n        if (val === false) {\r\n          return EMPTY;\r\n        }\r\n        return this.befRepository.apiProxy.request(HttpMethods.PUT, url);\r\n      }\r\n      ));\r\n    return result$;\r\n  }\r\n\r\n\r\n  /**\r\n   * 子表清除编辑与新增标记\r\n   * @returns \r\n   */\r\n  public ClearStatusAfterchildCardSave(): Observable<any> {\r\n    this.viewModelContext.uiState.setPropertyValue('$isAdd', null);\r\n    this.viewModelContext.uiState.setPropertyValue('$childEntity', null);\r\n    return of(true)\r\n  }\r\n\r\n}\r\n","import { Observable, of, EMPTY } from 'rxjs';\r\nimport { switchMap, map, tap } from 'rxjs/operators';\r\nimport { Entity, ViewModelContext } from '@farris/mobile-devkit';\r\nimport { BaseDataService } from './base-data.service';\r\n\r\nexport class SaveDataService extends BaseDataService {\r\n\r\n  constructor(viewModelContext: ViewModelContext) {\r\n    super(viewModelContext);\r\n  }\r\n\r\n  /**\r\n   * 保存数据\r\n   */\r\n  public save(): Observable<boolean> {\r\n    this.loadingService.show();\r\n    const save$ = this.befRepository.saveEntities();\r\n    return save$.pipe(\r\n      tap(\r\n        () => {\r\n          this.loadingService.hide();\r\n          this.notifyService.success('保存成功');\r\n        },\r\n        (exception: any) => {\r\n          this.loadingService.hide();\r\n        }\r\n      )\r\n    );\r\n  }\r\n\r\n  /**\r\n   * 子表保存\r\n   */\r\n  public saveByPath(): Observable<boolean> {\r\n    this.loadingService.show();\r\n    const currentRootId = this.viewModelContext.bindingData.list.currentId;\r\n    const update$ = this.befRepository.updateEntityById(currentRootId);\r\n    const result$ = update$.pipe(\r\n      map(() => {\r\n        return true;\r\n      }),\r\n      tap(\r\n        () => {\r\n          this.viewModelContext.uiState.setPropertyValue('$isAdd', null);\r\n          this.viewModelContext.uiState.setPropertyValue('$childEntity', null);\r\n          this.loadingService.hide();\r\n          this.notifyService.success('保存成功');\r\n        },\r\n        (exception: any) => {\r\n          this.loadingService.hide();\r\n        }\r\n      )\r\n    );\r\n    return result$;\r\n  }\r\n}\r\n","import { Observable, of, EMPTY } from 'rxjs';\r\nimport { switchMap, tap } from 'rxjs/operators';\r\nimport { Entity, ViewModelContext } from '@farris/mobile-devkit';\r\nimport { BefRepository } from '@farris/mobile-bef';\r\nimport { BaseDataService } from './base-data.service';\r\n\r\nexport class CancelDataService extends BaseDataService {\r\n\r\n  constructor(viewModelContext: ViewModelContext) {\r\n    super(viewModelContext);\r\n  }\r\n\r\n  /**\r\n   * 新增数据\r\n   */\r\n  public cancel(): Observable<boolean> {\r\n    this.loadingService.show();\r\n    const cancel$ = this.befRepository.cancelEntityChanges();\r\n    return cancel$.pipe(\r\n      tap(\r\n        () => {\r\n          this.loadingService.hide();\r\n        },\r\n        (exception: any) => {\r\n          this.loadingService.hide();\r\n          // this.exceptionService.show('取消失败', exception);\r\n        }\r\n      )\r\n    );\r\n  }\r\n\r\n}\r\n","import { Observable } from 'rxjs';\r\nimport { tap } from 'rxjs/operators';\r\nimport { ViewModelContext, HttpMethod, HttpHeaders, HttpParams, HttpRequestConfig } from '@farris/mobile-devkit';\r\nimport { ResponseInfo } from '@farris/mobile-bef';\r\nimport { BaseDataService } from './base-data.service';\r\n\r\n\r\n/**\r\n * BE动作调用服务\r\n */\r\nclass BeActionService extends BaseDataService {\r\n\r\n  /**\r\n   * 构造函数\r\n   */\r\n  constructor(protected viewModelContext: ViewModelContext) {\r\n    super(viewModelContext);\r\n  }\r\n\r\n  /**\r\n   * 执行自定义动作\r\n   */\r\n  public invokeAction(\r\n    actionUrl: string, httpMethod: HttpMethod, httpHeaders?: HttpHeaders, params?: HttpParams, body?: any\r\n  ): Observable<ResponseInfo> {\r\n    return this.innerInvokeAction(actionUrl, httpMethod, httpHeaders, params, body);\r\n  }\r\n\r\n  /**\r\n   * 调用自定义动作\r\n   */\r\n  private innerInvokeAction(\r\n    actionUrl: string, method: HttpMethod, headers?: HttpHeaders, params?: HttpParams, body?: any\r\n  ): Observable<any>  {\r\n    const apiProxy = this.befRepository.apiProxy;\r\n    const baseUrl = apiProxy.baseUrl;\r\n\r\n    // 构造url\r\n    const fullActionUrl = `${baseUrl}/service/${actionUrl}`;\r\n    const requestConfig: HttpRequestConfig = {\r\n    };\r\n\r\n    // headers构造\r\n    if (headers ) {\r\n      requestConfig.headers = headers;\r\n    }\r\n\r\n    // 查询参数\r\n    if (params) {\r\n      requestConfig.params = params;\r\n    }\r\n\r\n    // body构造\r\n    if (body) {\r\n      requestConfig.body = body;\r\n    }\r\n\r\n    this.loadingService.show();\r\n    const result$ = apiProxy.request(method, fullActionUrl, requestConfig);\r\n    return result$.pipe(\r\n      tap(\r\n        () => {\r\n          this.loadingService.hide();\r\n        },\r\n        (error: any) => {\r\n          this.loadingService.hide();\r\n          console.log(error);\r\n        }\r\n      )\r\n    );\r\n  }\r\n}\r\n\r\n\r\nexport { BeActionService };\r\n\r\n\r\n","import { Observable, of, EMPTY } from 'rxjs';\r\nimport { switchMap, tap } from 'rxjs/operators';\r\nimport { ViewModelContext } from '@farris/mobile-devkit';\r\nimport { LoadingService, NotifyService } from '../ui-services/index';\r\nimport { WfTaskHandlerService } from '../work-flow-service/wf-task-handler.service'\r\nclass ApproveService {\r\n\r\n    private wfTaskHandlerService: WfTaskHandlerService;\r\n\r\n    private notifyService: NotifyService;\r\n\r\n    constructor(wfTaskHandlerService: WfTaskHandlerService, protected viewModelContext: ViewModelContext) {\r\n        this.wfTaskHandlerService = wfTaskHandlerService;\r\n        this.notifyService = this.getService<NotifyService>(NotifyService);\r\n    }\r\n\r\n    /**\r\n     * 获取服务实例\r\n     */\r\n    getService<T>(token: any): T {\r\n        const injector = this.viewModelContext.injector;\r\n        return injector.get<T>(token);\r\n    }\r\n\r\n    /**\r\n     * 提交审批(带入口单据使用wf控件)\r\n     * @param bizBillID 业务单据Id\r\n     * @param bizDefKey 入口单据Id\r\n     * @param options 上下文参数\r\n     * @param variables 可选参数\r\n     */\r\n    public submitApproveWithBizDefKeyUseControl(bizBillID: string, bizDefKey: string, options: any = {}, variables?: any) {\r\n        if (!bizBillID) {\r\n            this.notifyService.error('业务单据Id不能为空');\r\n            return EMPTY;\r\n        }\r\n        if (!bizDefKey) {\r\n            this.notifyService.error('入口单据Id不能为空');\r\n            return EMPTY;\r\n        }\r\n        if (!options || typeof options !== 'object') {\r\n            options = {};\r\n        }\r\n        const payload: any = {\r\n            dataId: bizBillID,\r\n            bizDefKey,\r\n            ...options\r\n        };\r\n        // 处理variables参数\r\n        if (variables) {\r\n            if (variables.startsWith('{') && variables.endsWith('}')) {\r\n                try {\r\n                    variables = JSON.parse(variables);\r\n                } catch {\r\n                    console.log('variables parse failed!');\r\n                    variables = {};\r\n                }\r\n            }\r\n            payload.variables = variables;\r\n        }\r\n        return this.wfTaskHandlerService && this.wfTaskHandlerService.startProcess(payload);\r\n    }\r\n\r\n    /**\r\n     * 取消审批(支持主表、子表)\r\n     * 迁移web端（已废弃）请调用新的取消提交方法\r\n     * @param procInstId 流程实例Id\r\n     */\r\n    public cancelSubmit(procInstId: string): Observable<any> {\r\n        if (!procInstId) {\r\n            this.notifyService.error('流程实例Id不能为空');\r\n            return EMPTY;\r\n        }\r\n        return this.wfTaskHandlerService && this.wfTaskHandlerService.cancelSubmit({ dataId: null, bizDefKey: null, procInstId });\r\n    }\r\n\r\n    /**\r\n     * 提交审批\r\n     * @param dataId 表单id\r\n     * @param bizDefKey 入口单据id\r\n     */\r\n    public submitWithBizDefKey(dataId: string, bizDefKey: string): Observable<any> {\r\n        return this.wfTaskHandlerService && this.wfTaskHandlerService.submitWithBizDefKey(dataId, bizDefKey);\r\n    }\r\n\r\n    /**\r\n     * 取消提交审批\r\n     * @param dataId 表单id\r\n     * @param bizDefKey 入口单据id\r\n     */\r\n    public cancelSubmitWithDataId(dataId: string, bizDefKey: string): Observable<any> {\r\n        return this.wfTaskHandlerService && this.wfTaskHandlerService.cancelSubmitWithDataId(dataId, bizDefKey);\r\n    }\r\n\r\n    /**\r\n     * 批量提交审批\r\n     * @param dataIds 表单ID集合\r\n     * @param bizDefKey 入口单据id\r\n     */\r\n    public batchSubmitWithBizDefKey(dataIds: string[], bizDefKey: string): Observable<any> {\r\n        return this.wfTaskHandlerService && this.wfTaskHandlerService.batchSubmitWithBizDefKey(dataIds, bizDefKey);\r\n    }\r\n\r\n    /**\r\n     * 批量取消提交审批\r\n     * @param dataIds 表单ID集合\r\n     * @param bizDefKey 入口单据id\r\n     */\r\n    batchCancelSubmitWithDataId(dataIds: string[], bizDefKey: string): Observable<any> {\r\n        return this.wfTaskHandlerService && this.wfTaskHandlerService.batchCancelSubmitWithDataId(dataIds, bizDefKey);\r\n    }\r\n\r\n    /**\r\n    * 子表提交审批\r\n    * @param parentDataId 主表id\r\n    * @param childDataId 子表id\r\n    * @param bizDefKey 入口单据id\r\n    */\r\n    childSubmit(parentDataId: string, childDataId: string, bizDefKey: string): Observable<any> {\r\n        return this.wfTaskHandlerService && this.wfTaskHandlerService.childSubmit(parentDataId, childDataId, bizDefKey);\r\n    }\r\n\r\n    /**\r\n     * 子表取消提交审批\r\n     * @param parentDataId 主表id\r\n     * @param childDataId 子表id\r\n     * @param bizDefKey 入口单据id\r\n     */\r\n    childCancelSubmit(parentDataId: string, childDataId: string, bizDefKey: string): Observable<any> {\r\n        return this.wfTaskHandlerService && this.wfTaskHandlerService.childCancelSubmit(parentDataId, childDataId, bizDefKey);\r\n    }\r\n\r\n    /**\r\n     * 子表批量提交审批\r\n     * @param parentDataId 主表id\r\n     * @param childDataIds 子表id集合\r\n     * @param bizDefKey 入口单据id\r\n     */\r\n    childBatchSubmit(parentDataId: string, childDataIds: string[], bizDefKey: string): Observable<any> {\r\n        return this.wfTaskHandlerService && this.wfTaskHandlerService.childBatchSubmit(parentDataId, childDataIds, bizDefKey);\r\n    }\r\n\r\n    /**\r\n     * 子表批量取消提交审批\r\n     * @param parentDataId 主表id\r\n     * @param childDataIds 子表id集合\r\n     * @param bizDefKey 入口单据id\r\n     */\r\n    childBatchCancelSubmit(parentDataId: string, childDataIds: string[], bizDefKey: string): Observable<any> {\r\n        return this.wfTaskHandlerService && this.wfTaskHandlerService.childBatchCancelSubmit(parentDataId, childDataIds, bizDefKey);\r\n    }\r\n\r\n}\r\n\r\nexport { ApproveService }","import { of, EMPTY } from 'rxjs';\r\nimport { switchMap, tap } from 'rxjs/operators';\r\nimport { BaseDataService } from './base-data.service';\r\nimport { DataUtil } from './data-util';\r\nimport { BefRepositoryUtil } from '@farris/mobile-bef'\r\nimport { HttpMethods, ViewModelContext } from '@farris/mobile-devkit';\r\n\r\n\r\n/**\r\n * 数据检查服务\r\n */\r\nclass CheckDataService extends BaseDataService {\r\n\r\n  constructor(viewModelContext: ViewModelContext) {\r\n    super(viewModelContext)\r\n  }\r\n\r\n  /**\r\n   * 离开页面前检查数据变更\r\n   */\r\n  public checkChangesBeforeLeave() {\r\n\r\n    //const isEntitiesChanged = this.befRepository.entityManager.checkAllEntityChanges();\r\n\r\n    // 实体数据没有变化，继续执行\r\n    if (!BefRepositoryUtil.isExistUnsaveData(this.befRepository)) {\r\n      return of(true);\r\n    }\r\n\r\n    return this.dialogService.confirm('存在未保存的变更，确认离开当前页面？').pipe(\r\n      switchMap((ifLeave: any) => {\r\n        if (ifLeave === false) {\r\n          return EMPTY;\r\n        } else {\r\n          this.loadingService.show();\r\n          const cancel$ = this.befRepository.cancelEntityChanges();\r\n          return cancel$.pipe(\r\n            switchMap(() => {\r\n              if (this.befRepository.apiProxy.associatedUrlMap.size >= 1) {\r\n                const urls = [...this.befRepository.apiProxy.associatedUrlMap.keys()];\r\n                return this.befRepository.apiProxy.request(HttpMethods.POST, `${urls[0]}/service/cancel`)\r\n              } else {\r\n                return of(true)\r\n              }\r\n            }),\r\n            tap(() => {\r\n              this.loadingService.hide();\r\n            })\r\n          );\r\n        }\r\n      }\r\n      ));\r\n  }\r\n\r\n  /**\r\n   * 子表离开页面前检查数据变更\r\n   */\r\n  public checkChangesBeforeLeaveChild() {\r\n    // 新增状态\r\n    if (this.viewModelContext.uiState['$isAdd'] && this.viewModelContext.uiState['$isAdd'].status === true) {\r\n      // 继续判断\r\n      const childId = this.viewModelContext.uiState['$isAdd'].id;\r\n      const childPath = this.viewModelContext.uiState['$isAdd'].path;\r\n      const child = this.viewModelContext.uiState['$isAdd'].child;\r\n      const subPaths = childPath.split('/');\r\n      let currentChild;\r\n      if (subPaths[0] && subPaths.length === 1) {\r\n        currentChild = this.viewModelContext.bindingData[subPaths[0]]\r\n      }\r\n      if (!subPaths[0] && subPaths.length === 2) {\r\n        currentChild = this.viewModelContext.bindingData[subPaths[1]]\r\n      }\r\n      if (subPaths.length > 2) {\r\n        // 暂不处理从从表\r\n        let childPath = ''\r\n        if (subPaths[0]) {\r\n          childPath = subPaths[0];\r\n        }\r\n        for (let index = 1; index < subPaths.length; index++) {\r\n          childPath = childPath + subPaths[index]\r\n        }\r\n        currentChild = this.viewModelContext.bindingData[childPath]\r\n      }\r\n      const isChanged = this.checkForVariationBetweenTheTwo(currentChild, child);\r\n      if (isChanged) {\r\n        return of(true)\r\n      }\r\n      const entityPath = DataUtil.convertBindingPathToEntityPath(childPath, this.viewModelContext);\r\n      return this.befRepository.removeEntityByPath(entityPath, childId);\r\n    }\r\n    return of(true)\r\n  }\r\n\r\n  private checkForVariationBetweenTheTwo(newData, oldData) {\r\n    const childKeys = Object.keys(oldData);\r\n    let isChanged = false;\r\n    for (let i = 0; i < childKeys.length; i++) {\r\n      if (Object.prototype.toString.call(oldData[childKeys[i]]) === '[object Object]' || Object.prototype.toString.call(oldData[childKeys[i]]) === '[object Array]') {\r\n        if (JSON.stringify(oldData[childKeys[i]]) !== JSON.stringify(newData[childKeys[i]])) {\r\n          return isChanged = true\r\n        }\r\n      } else {\r\n        if (oldData[childKeys[i]] !== newData[childKeys[i]]) {\r\n          return isChanged = true\r\n        }\r\n      }\r\n    }\r\n    return isChanged;\r\n  }\r\n\r\n  /**\r\n   * 进入子表编辑或者新增点击返回都会复原进入子表前的数据\r\n   * @param path 子表路径\r\n   */\r\n  public checkChangesBeforeLeaveAddOrEditChild(path: string) {\r\n    // 新增状态\r\n    if (this.viewModelContext.uiState['$isAdd'] && this.viewModelContext.uiState['$isAdd'].status === true) {\r\n      // 新增直接干掉\r\n      const childId = this.viewModelContext.uiState['$isAdd'].id;\r\n      const childPath = this.viewModelContext.uiState['$isAdd'].path;\r\n      const entityPath = DataUtil.convertBindingPathToEntityPath(childPath, this.viewModelContext);\r\n      return this.befRepository.removeEntityByPath(entityPath, childId).pipe(\r\n        tap(() => {\r\n          this.viewModelContext.uiState.setPropertyValue('$isAdd', null);\r\n        }));\r\n    } else {\r\n      // 编辑还原\r\n      const childID = this.viewModelContext.bindingData[path]['id'];\r\n      const id = this.viewModelContext.bindingData[path]['parentID'];\r\n      const childEntityData = this.viewModelContext.uiState['$childEntity'];\r\n      if (!childEntityData) {\r\n        return of(true)\r\n      }\r\n      this.viewModelContext.repository.entityCollection.getEntityById(id)[path].get(childID).load(childEntityData);\r\n      return of(true)\r\n    }\r\n  }\r\n}\r\n\r\nexport { CheckDataService };\r\n","// import { Router } from 'vue-router';\r\nimport { Observable } from 'rxjs';\r\nimport { tap, map } from 'rxjs/operators';\r\nimport { ViewModelContext, HttpClient } from '@farris/mobile-devkit';\r\nimport { RtcOptions, BeforeNavigateReponseBody, BeforeNavigateRequestBody } from './types/index';\r\nimport { JsBridgeService } from './js-bridge-service/index';\r\n\r\n\r\n\r\n\r\n/**\r\n * 路由服务\r\n */\r\nclass RouterService {\r\n\r\n  /**\r\n   * ViewModel上下文\r\n   */\r\n  private viewModelContext: ViewModelContext;\r\n\r\n  /**\r\n   * VueRouter实例\r\n   */\r\n  private router: any;\r\n\r\n  /**\r\n   * 构造函数\r\n   */\r\n  constructor(viewModelContext: ViewModelContext, router: any, private jsBridgeService: JsBridgeService) {\r\n    this.viewModelContext = viewModelContext;\r\n    this.router = router;\r\n  }\r\n\r\n  /**\r\n   * 路由跳转\r\n   * @param path   路由路径\r\n   * @param params 路由参数\r\n   */\r\n  navigate(path: string, queryParams: any = {}, backParams: any = {}, backPath?: string) {\r\n    if (!path) return\r\n\r\n    queryParams = this.ParamsFromStringToObject(queryParams);\r\n    backParams = this.ParamsFromStringToObject(backParams);\r\n\r\n    const pathIndex = this.sessionStorageSaveHistory(path, backPath, backParams)\r\n\r\n    // 跨工程跳转\r\n    if (path && pathIndex >= 0) {\r\n      let urlPath = this.splicePath(path, queryParams);\r\n      window.location.href = urlPath;\r\n      return false;\r\n    }\r\n\r\n    window['MOBILE_ORIGIN_BACK'] && window['MOBILE_ORIGIN_BACK'].reflushOriginGoback();\r\n\r\n    this.router.push({\r\n      path: path,\r\n      query: queryParams\r\n    });\r\n  }\r\n\r\n  private removeParams(pathIndex, path) {\r\n    let end = path.search('\\\\?');\r\n    if (end = -1) {\r\n      end = path.length;\r\n    }\r\n    return path.slice(pathIndex, end);\r\n  }\r\n\r\n  private getsessionStorageSaveHistoryKey(path) {\r\n    const pathIndex = path.search('/apps');\r\n    // 跨页面跳转离开\r\n    if (path && pathIndex >= 0) {\r\n      return this.removeParams(pathIndex, path);\r\n    }\r\n    return this.router.options.history.base + path;\r\n  }\r\n\r\n  private sessionStorageSaveHistory(path, backPath, backParams) {\r\n    const pathIndex = path.search('/apps');\r\n\r\n    const key = this.getsessionStorageSaveHistoryKey(path);\r\n    let historyObject = {}\r\n    //判断是否制定了目标页面得返回地址\r\n    if (backPath) {\r\n      const backPathIndex = path.search('/apps');\r\n      //指定返回路由为跨工程跳转\r\n      if (backPathIndex >= 0) {\r\n        historyObject = {\r\n          routerWay: 'href',\r\n          path: backPath,\r\n          query: backParams\r\n        }\r\n      } else {\r\n        historyObject = {\r\n          routerWay: 'Router',\r\n          path: backPath,\r\n          query: backParams\r\n        }\r\n      }\r\n      sessionStorage.setItem(key, JSON.stringify(historyObject))\r\n      return pathIndex;\r\n    } else {\r\n      let currentPath = this.router.currentRoute.value.path;\r\n      // 跨页面跳转离开\r\n      if (path && pathIndex >= 0) {\r\n        //拼接当前路由\r\n        currentPath =  this.router.options.history.base + this.router.options.history.location;\r\n        //记录当前路由\r\n        historyObject = {\r\n          routerWay: 'href',\r\n          path: currentPath,\r\n          query: backParams\r\n        }\r\n      } else {\r\n        // 路由方式跳转记录\r\n        historyObject = {\r\n          routerWay: 'Router',\r\n          path: currentPath,\r\n          query: backParams\r\n        }\r\n      }\r\n      sessionStorage.setItem(key, JSON.stringify(historyObject))\r\n      return pathIndex;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 带维度的路由跳转\r\n   */\r\n  navigateForRtc(path: string, queryParams: any = {}, backParams: any = {}, backPath?: string) {\r\n\r\n    if (!queryParams || !queryParams.metadataId) {\r\n      this.navigate(path, queryParams, backParams, backPath);\r\n    }\r\n\r\n    const rtcOptions: RtcOptions = {\r\n      metadataId: queryParams.metadataId,\r\n      withDims: false,\r\n      dim1: queryParams.dim1,\r\n      dim2: queryParams.dim2\r\n    };\r\n    delete queryParams['metadataId'];\r\n    delete queryParams['dim1'];\r\n    delete queryParams['dim2'];\r\n\r\n    const correctRtcOptions$ = this.correctRtcOptions(rtcOptions);\r\n    const extendedPath$ = correctRtcOptions$.pipe(\r\n      map((correctedRtcOptions: RtcOptions) => {\r\n        return this.getExtendPath(path, correctedRtcOptions);\r\n      })\r\n    );\r\n\r\n    const result$ = extendedPath$.pipe(\r\n      tap((extendedPath: string) => {\r\n        this.navigate(extendedPath, queryParams, backParams);\r\n      })\r\n    );\r\n\r\n    result$.subscribe();\r\n  }\r\n\r\n  /**\r\n   * 纠正维度信息\r\n   * @summary\r\n   * 1、非运行时定制表单，widthDims=false, 维度为空；\r\n   * 2、运行时定制表单：维度值不存在时，则纠正为public；\r\n   */\r\n  private correctRtcOptions(rtcOptions: RtcOptions): Observable<RtcOptions> {\r\n    const dim1 = rtcOptions.dim1 || 'public';\r\n    const dim2 = rtcOptions.dim2 || 'public';\r\n    const metadataId = rtcOptions.metadataId;\r\n    const httpClient = this.viewModelContext.injector.get<HttpClient>(HttpClient);\r\n\r\n    const url = '/api/runtime/bcc/v1.0/template/beforeNavigate';\r\n    const body: BeforeNavigateRequestBody = {\r\n        isRootMetadata: true,\r\n        metadataId: metadataId,\r\n        dim1: dim1,\r\n        dim2: dim2,\r\n    };\r\n    const beforeNavigate$ = httpClient.post(url, body, null).pipe(\r\n      map((result: BeforeNavigateReponseBody) => {\r\n        const correctedRtcOptions: RtcOptions = {\r\n          metadataId: result.metadataId,\r\n          withDims: result.withDims === 1 ? true : false,\r\n          dim1: result.dim1,\r\n          dim2: result.dim2\r\n        };\r\n\r\n        return correctedRtcOptions;\r\n      })\r\n    );\r\n    return beforeNavigate$;\r\n  }\r\n\r\n  /**\r\n   * 获取运行时定制表单地址\r\n   */\r\n  private getExtendPath(path: string, rtcOptions: RtcOptions): string {\r\n\r\n    if (rtcOptions.withDims === false) {\r\n      return path;\r\n    }\r\n\r\n    const arrPath = path.split('index.html');\r\n    const append = `${rtcOptions.dim1}/${rtcOptions.dim2}/index.html`.toLowerCase();\r\n    const extendPath = arrPath.join(append);\r\n    return extendPath;\r\n  }\r\n\r\n  /**\r\n   * 拼接url路径\r\n   * @param path 路径\r\n   * @param params 参数\r\n   * @returns \r\n   */\r\n  private splicePath(path: string, params: any) {\r\n    let urlPath = path\r\n    const end = urlPath.search('\\\\?');\r\n    if (end > -1) {\r\n      urlPath = urlPath.slice(0, end)\r\n    }\r\n    const keys = Object.keys(params);\r\n    if (keys.length > 0) {\r\n      urlPath = urlPath + '?';\r\n      keys.forEach(element => {\r\n        urlPath = urlPath + element + '=' + params[`${element}`] + '&'\r\n      });\r\n      urlPath = urlPath.slice(0, urlPath.length - 1)\r\n    }\r\n    return urlPath;\r\n  }\r\n\r\n  private ParamsFromStringToObject(params: any): object {\r\n\r\n    if (Object.prototype.toString.call(params) === '[object Object]') {\r\n      return params;\r\n    }\r\n\r\n    try {\r\n      params = JSON.parse(params);\r\n    } catch (error) {\r\n      if (!params) {\r\n        params = {}\r\n      } else {\r\n        params = {}\r\n        console.error('路由传参params不是JSON串格式')\r\n      }\r\n    }\r\n\r\n    if (Object.prototype.toString.call(params) !== '[object Object]') {\r\n      return {};\r\n    }\r\n\r\n    return params;\r\n  }\r\n\r\n  /**\r\n * 路由跳转\r\n * @param path   路由路径\r\n * @param params 路由参数\r\n */\r\n  navigateReplace(path: string, queryParams: any = {}) {\r\n    if (typeof queryParams === 'string') {\r\n      queryParams = JSON.parse(queryParams);\r\n    }\r\n    this.router.replace({\r\n      path: path,\r\n      query: queryParams\r\n    });\r\n  }\r\n\r\n  /**\r\n   * 后退\r\n   */\r\n  goBack(params) {\r\n    params = this.ParamsFromStringToObject(params);\r\n    const currentPath = this.router.options.history.base + this.router.currentRoute.value.path;\r\n    let need_go_back = sessionStorage.getItem(currentPath);\r\n    if (!need_go_back) {\r\n      if (window.top.location.pathname.indexOf('mobiletaskcenter') > -1) {\r\n        return;\r\n      }\r\n      this.jsBridgeService.closeWindow()\r\n      return\r\n    }\r\n    const keys = Object.keys(params);\r\n\r\n    need_go_back = JSON.parse(need_go_back);\r\n    if (need_go_back && need_go_back['routerWay'] === 'Router') {\r\n      let query = need_go_back['query'];\r\n      if (keys.length > 0) {\r\n        query = { ...query, ...params }\r\n      }\r\n      this.router.push({\r\n        query,\r\n        path: need_go_back['path'],\r\n      });\r\n    }\r\n    if (need_go_back && need_go_back['routerWay'] === 'href') {\r\n      let query = need_go_back['query'];\r\n      if (keys.length > 0) {\r\n        query = { ...query, ...params }\r\n      }\r\n      let path = need_go_back['path'];\r\n\r\n      path = this.splicePath(path, query);\r\n\r\n      window.location.href = path;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 映射路由状态\r\n   */\r\n  mappingToUIState() {\r\n    const routerState = {\r\n      params: this.router.currentRoute['value'].params,\r\n      queryParams: this.router.currentRoute['value'].query\r\n    };\r\n    this.viewModelContext.uiState['routerState'] = routerState;\r\n  }\r\n}\r\n\r\n/**\r\n * Token\r\n * @todo：临时方案，直接注入VueRouter实例。\r\n */\r\nconst ROUTER_INSTANCE_TOKEN = '@farris/mobile-command-services/ROUTER_INSTANCE_TOKEN';\r\n\r\nexport { RouterService, ROUTER_INSTANCE_TOKEN };\r\n","import { ViewModelContext } from '@farris/mobile-devkit';\r\nimport { EMPTY, Observable, of, zip } from 'rxjs';\r\nimport { switchMap } from 'rxjs/operators';\r\n\r\n/**\r\n * 数据服务基类\r\n */\r\nclass ValidatorServices {\r\n\r\n    constructor(private viewModelContext: ViewModelContext) { }\r\n\r\n    /**\r\n     * 获取某个视图模型上得所有验证结果\r\n     * @param viewModelId 视图模型id\r\n     */\r\n    validateFields(viewModelId?: string) {\r\n        if (viewModelId) {\r\n            return this.viewModelContext.appContext.viewModelContextManager.getContextById(viewModelId).form.validateFields();\r\n        } else {\r\n            return this.viewModelContext.form.validateFields();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 处理某个视图模型上得所有验证结果\r\n     * @param viewModelId 视图模型id\r\n     */\r\n    handleValidateFields(viewModelId?: string): Observable<any> {\r\n        let validateFieldsResults = [];\r\n        if (viewModelId) {\r\n            validateFieldsResults = this.viewModelContext.appContext.viewModelContextManager.getContextById(viewModelId).form.validateFields();\r\n        } else {\r\n            this.viewModelContext.appContext.viewModelContextManager.getRootContextAndPosterityById(this.viewModelContext.id).forEach((context: ViewModelContext) => {\r\n                validateFieldsResults = validateFieldsResults.concat(context.form.validateFields())\r\n            });\r\n        }\r\n        if(validateFieldsResults.length === 0){\r\n            return of(true);\r\n        }\r\n        return zip(...validateFieldsResults).pipe(\r\n            switchMap((value)=>{\r\n                const index = value.findIndex(item=>item['passing'] === false)\r\n                if(index > -1){\r\n                    return EMPTY\r\n                }else{\r\n                    return of(true);\r\n                }\r\n            })\r\n        )\r\n    }\r\n\r\n    /**\r\n     * 获取某个字段的验证结果\r\n     * @param name 字段名称\r\n     * @param viewModelId 视图模型id\r\n     */\r\n    getFieldError(name: string, viewModelId?: string) {\r\n        if (viewModelId) {\r\n            return this.viewModelContext.appContext.viewModelContextManager.getContextById(viewModelId).form.getFieldError(name);\r\n        } else {\r\n            return this.viewModelContext.form.getFieldError(name);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 重置一组校验状态 不传参数清除所有\r\n     * @param fields name的数组\r\n     * @param viewModelId 视图模型id\r\n     */\r\n    resetFieldsValidate(fields?: string[], viewModelId?: string) {\r\n        if (fields && typeof fields === 'string') {\r\n            fields = JSON.parse(fields);\r\n        }\r\n        if (viewModelId) {\r\n            return this.viewModelContext.appContext.viewModelContextManager.getContextById(viewModelId).form.resetFieldsValidate(fields);\r\n        } else {\r\n            this.viewModelContext.appContext.viewModelContextManager.getRootContextAndPosterityById(this.viewModelContext.id).forEach((context: ViewModelContext) => {\r\n                context.form.resetFieldsValidate(fields);\r\n            });\r\n        }\r\n    }\r\n\r\n}\r\n\r\nexport { ValidatorServices };\r\n","import { Observable, Subject } from 'rxjs';\r\nimport { IJsBridgeStrategy, PhotoOptions, PictureOptions, VidepOptions, LocationInfo } from './decorators';\r\n\r\nclass CCworkService implements IJsBridgeStrategy {\r\n\r\n    init(callback) {\r\n        window.top['iCityBridge'].init(callback)\r\n    }\r\n\r\n    /**\r\n     * {\r\n     * quality:图片质量，可选值high、mid、low, high为1920*1080；mid为720*540；low: 480*360，默认为mid\r\n     * mode:唤起模式，可选值both（仅支持iOS）、camera、album, 默认为camera;\r\n     * mark文字水印，字数最大值50\r\n     * }\r\n     * @param options Object\r\n     *\r\n     */\r\n    takePhoto(options: PhotoOptions = { quality: 'mid' }): Observable<[]> {\r\n        // callback return object {errormessage:\"\"，result:\"base64格式\"}\r\n        const subject = new Subject<any>();\r\n\r\n        const callback = (data) => {\r\n            if (data) {\r\n                subject.next(data['result']);\r\n            }\r\n        }\r\n\r\n        window.top['iCityBridge'].ccworkGetPicsFromCameraAndAlbum(\r\n            { ...options },\r\n            callback\r\n        );\r\n        return subject;\r\n    }\r\n\r\n    /**\r\n     * path 如果不为空则从指定图片文件识别二维码,空就吊起相机\r\n     * filters 条码类型过滤列表，如QR、EAN13、EAN8\r\n     * \r\n     * @param options Object\r\n     * \r\n     */\r\n    scanQRCode(): Observable<string> {\r\n        const subject = new Subject<any>();\r\n\r\n        const callback = (data) => {\r\n            if (data) {\r\n                subject.next(data['result']);\r\n            }\r\n        }\r\n\r\n        window.top['iCityBridge'].ccworkScanCode({}, callback);\r\n        return subject;\r\n    }\r\n\r\n    getSysInfo() {\r\n\r\n    }\r\n\r\n    getLocation(): Observable<LocationInfo> {\r\n        /**\r\n         *  回调函数\r\n         *  输出结构 object\r\n         *  errormessage:\"\"\r\n         *  result:Object {\r\n         *  addr:'山东省济南市历下区经十路靠近浪潮'\r\n         *  city:\"济南\"\r\n         *  country:\"中国\"\r\n         *  course:-1\r\n         *  district:\"历下区\"\r\n         *  lat:36.66254123263889\r\n         *  lng:117.12974745008681\r\n         *  province:\"山东省\"\r\n         *  street:\"经十路\"\r\n         *  streetNum:\"1单元\"\r\n         * }\r\n         *  status:true\r\n         */\r\n        const subject = new Subject<any>();\r\n\r\n        const callback = (data) => {\r\n            if (data) {\r\n                subject.next(data['result']);\r\n            }\r\n        }\r\n\r\n        window.top['iCityBridge'].ccworkGetLocation(\r\n            callback\r\n        );\r\n        return subject;\r\n    }\r\n\r\n    // TODO:云上协同选择文件\r\n    selectFile(): Observable<[]> {\r\n        const subject = new Subject<any>();\r\n        subject.next([]);\r\n        return subject;\r\n    }\r\n\r\n\r\n    /**\r\n     * \r\n     * @param number string\r\n     * @param content string\r\n     */\r\n    sendSMS(number: string, content: string): void {\r\n        const options = {\r\n            numbers: [number],\r\n            content\r\n        }\r\n        window.top['iCityBridge'].ccworkSendSms(options)\r\n    }\r\n\r\n    openSendSMS(number: string, content: string): void {\r\n        window.top['iCityBridge'].sendSMS({ tel: number, msg: content })\r\n\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param number string\r\n     */\r\n    tel(number: string): void {\r\n        window.top['iCityBridge'].ringUp(number)\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param options \r\n     */\r\n    selectPictureFromAlbum(options: PictureOptions = { maxNum: 9, mType: 0 }): Observable<[]> {\r\n        /**\r\n         * params object \r\n         *  { maxNum : number 9 最大可选数 默认9\r\n         *    mType: number 0 \t选择模式，可选值0/1, 0:图片，1：视频;\r\n         * }\r\n         */\r\n        const subject = new Subject<any>();\r\n\r\n        const callback = (data) => {\r\n            if (data) {\r\n                subject.next(data['result']);\r\n            }\r\n        }\r\n\r\n        window.top['iCityBridge'].ccworkGetPicsFromAlbum(\r\n            options,\r\n            callback\r\n        );\r\n        return subject;\r\n        /**\r\n         *  object\r\n         *  errormessage:\"\"\r\n         *  result:Array [\r\n         * base64\r\n         * ]\r\n         *  status:true\r\n         */\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param options  \r\n     */\r\n    takeVideo(options: VidepOptions): Observable<string> {\r\n        /**\r\n         * params object \r\n         *  { \r\n         *  time : number 短视频时间（秒） 最大60s\r\n         *  quality: number 0 \t视频质量 取值范围0~1\r\n         *  id :string \t视频id（视频名字）\r\n         * }\r\n         */\r\n        const subject = new Subject<any>();\r\n\r\n        const callback = (data) => {\r\n            if (data) {\r\n                subject.next(data['result']);\r\n            }\r\n        }\r\n\r\n        window.top['iCityBridge'].ccworkTakeShortVideo(\r\n            {\r\n                time: 15,\r\n                ...options\r\n            }\r\n            ,\r\n            callback\r\n        );\r\n        return subject;\r\n        /**\r\n         *  object\r\n         *  errormessage:\"\"\r\n         *  result:Object {\r\n         *  value:'path'\r\n         * }\r\n         *  status:true\r\n         */\r\n    }\r\n\r\n    closeWindow(): void {\r\n        window.top['iCityBridge'].closeWebView()\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param title string\r\n     */\r\n    setTitles(title: string): void {\r\n        window.top['iCityBridge'].setTitle(title)\r\n    }\r\n\r\n    downloadFile(options) {\r\n        alert('暂不支持附件下载');\r\n    }\r\n\r\n    setOriginGoback(fn?) {\r\n        window.top['iCityBridge'].ccworkInterceptOriginGoback(!!fn, fn, () => { })\r\n    }\r\n\r\n    pushOriginGoback(fn?: any) {\r\n        window['OriginGoback'] = window['OriginGoback'] || [];\r\n        const OriginGoback = () => {\r\n            const gobackFn = window['OriginGoback'].pop()\r\n            if (gobackFn) {\r\n                gobackFn()\r\n            }\r\n            else {\r\n                window.top['iCityBridge'].ccworkInterceptOriginGoback(false, () => { }, () => { })\r\n                history.back();\r\n            }\r\n        }\r\n        if (fn) {\r\n            window['OriginGoback'].push(fn)\r\n            window.top['iCityBridge'].ccworkInterceptOriginGoback(true, OriginGoback, () => { })\r\n        }\r\n    }\r\n    popOriginGoback(fn?: any) {\r\n        window['OriginGoback'].pop()\r\n    }\r\n\r\n    playShortVideo(opt: any) {\r\n        window.top['iCityBridge'].ccworkPlayShortVideo(opt);\r\n    }\r\n\r\n\r\n}\r\n\r\nexport { CCworkService }","import { switchMap } from 'rxjs/operators';\r\nimport { forkJoin, Observable, Subject } from 'rxjs';\r\nimport { IJsBridgeStrategy, PhotoOptions, PictureOptions, VidepOptions, LocationInfo } from './decorators';\r\n\r\nclass CloudPlusService implements IJsBridgeStrategy {\r\n    playShortVideo(options?: any) {\r\n        throw new Error('Method not implemented.');\r\n    }\r\n\r\n    // 目前拍完返回报错\r\n    takePhoto(options: PhotoOptions = {\r\n        quality: 75,\r\n        encodingType: 0,\r\n        targetWidth: 600,\r\n        targetHeight: 600\r\n    }): Observable<[]> {\r\n        const subject = new Subject<any>();\r\n        const callback = (data) => {\r\n            if (data && data['originalData']) {\r\n                subject.next(data['originalData']);\r\n            }\r\n        }\r\n        const errorCallback = (data) => {\r\n            if (data) {\r\n                console.log('takePhoto', data);\r\n                subject.next([]);\r\n                return;\r\n            }\r\n        }\r\n\r\n        window['imp'].iCamera.open(\r\n            options,\r\n            callback,\r\n            errorCallback,\r\n        );\r\n        return subject;\r\n    }\r\n\r\n    scanQRCode(): Observable<string> {\r\n        const subject = new Subject<any>();\r\n\r\n        const callback = (data) => {\r\n            if (data) {\r\n                console.log('二维码回调')\r\n\r\n                subject.next(data);\r\n            }\r\n        }\r\n        console.log('调用二维码')\r\n\r\n        window['imp'].iBarCode.scan(\r\n            callback\r\n        );\r\n        return subject;\r\n    }\r\n\r\n    getLocation(): Observable<LocationInfo> {\r\n        const subject = new Subject<any>();\r\n\r\n        const callback = (data) => {\r\n            if (data) {\r\n                const {\r\n                    latitude,\r\n                    longitude,\r\n                    addr,\r\n                    city,\r\n                    country,\r\n                    district,\r\n                    province,\r\n                    street,\r\n                    streetNum\r\n                } = data\r\n                subject.next({\r\n                    addr,\r\n                    city,\r\n                    country,\r\n                    district,\r\n                    province,\r\n                    street,\r\n                    streetNum,\r\n                    lat: latitude,\r\n                    lng: longitude,\r\n                });\r\n            }\r\n        }\r\n        window['imp'].iGps.getInfo(\r\n            callback\r\n        );\r\n        return subject;\r\n        // iphone 打印输出信息\r\n        /**\r\n         * {latitude:\"36.662413\",longitude:\"117.129769\"}\r\n         */\r\n        // 安卓\r\n        /**\r\n         *  回调函数\r\n         *  输出结构 object\r\n         *  errormessage:\"\"\r\n         *  result:Object {\r\n         *  addr:'山东省济南市历下区经十路靠近浪潮'\r\n         *  city:\"济南\"\r\n         *  country:\"中国\"\r\n         *  course:-1\r\n         *  district:\"历下区\"\r\n         *  lat:36.66254123263889\r\n         *  lng:117.12974745008681\r\n         *  province:\"山东省\"\r\n         *  street:\"经十路\"\r\n         *  streetNum:\"1单元\"\r\n         * }\r\n         *  status:true\r\n         */\r\n    }\r\n\r\n    getSysInfo() {\r\n        const subject = new Subject<any>();\r\n\r\n        const callback = (data) => {\r\n            if (data) {\r\n                subject.next(data);\r\n            }\r\n        }\r\n        window['imp'].iDevice.sysInfo(callback);\r\n        return subject;\r\n    }\r\n\r\n    sendSMS(number: string, content: string): void {\r\n        window['imp'].iSms.send(number, content)\r\n    }\r\n\r\n    openSendSMS(number: string, content: string): void {\r\n        window['imp'].iSms.open(number, content)\r\n    }\r\n\r\n    tel(number: string): void {\r\n        window['imp'].iTel.dial(number)\r\n    }\r\n\r\n    selectPictureFromAlbum(options: PictureOptions = { maxNum: 9, mType: 0 }): Observable<[]> {\r\n        const defaults = {\r\n            num: 9,\r\n            quality: 75,\r\n            destinationType: 0,\r\n            encodingType: 1,\r\n            targetWidth: 600,\r\n            targetHeight: 600\r\n        };\r\n        defaults.num = options.maxNum;\r\n        const subject = new Subject<any>();\r\n\r\n        const callback = (data) => {\r\n            if (data) {\r\n                subject.next(data.map(item => {\r\n                    return item.originalData\r\n                }));\r\n            }\r\n        }\r\n\r\n        const errorCallback = (data) => {\r\n            if (data) {\r\n                console.log('selectPictureFromAlbum', data);\r\n                subject.next([]);\r\n            }\r\n        }\r\n\r\n        window['imp'].iCamera.select(\r\n            { ...defaults, ...options },\r\n            callback,\r\n            errorCallback,\r\n        );\r\n        return subject;\r\n    }\r\n\r\n    private selectFileFromMobile(options: any = { maximum: 6, fileType: '.jpg|.png' }) {\r\n\r\n    }\r\n\r\n    private getBase64(path: string) {\r\n        const subject = new Subject<any>();\r\n\r\n        const callback = (data) => {\r\n            if (data) {\r\n                subject.next(data);\r\n            }\r\n        };\r\n\r\n        const errorCallback = (data) => {\r\n            if (data) {\r\n                console.log('getBase64', data);\r\n                subject.next([]);\r\n            }\r\n        };\r\n\r\n        window['imp'].iFile.getBase64(\r\n            path,\r\n            callback,\r\n            errorCallback,\r\n        );\r\n        return subject;\r\n    }\r\n\r\n    selectFile(options: any = { maximum: 6 }) {\r\n        const subject = new Subject<any>();\r\n        const callback = (data) => {\r\n            if (data && data.length > 0) {\r\n                const paths = [];\r\n                let count = 0;\r\n                data.forEach(dataItem => {\r\n                    window['imp'].iFile.getBase64(\r\n                        dataItem.path,\r\n                        function (bs64) {\r\n                            paths.push({\r\n                                name: data[count].name,\r\n                                size: data[count].size,\r\n                                base64: bs64\r\n                            });\r\n                            count++;\r\n                            if (data.length === paths.length) {\r\n                                // 防止触发多次next  一次性把所有数据抛出去\r\n                                subject.next(paths);\r\n                            }\r\n                        },\r\n                        function (errorMsg) {\r\n                            if (errorMsg) {\r\n                                console.log('getBase64', errorMsg);\r\n                                subject.next([]);\r\n                            }\r\n                        }\r\n                    );\r\n                });\r\n            }\r\n        };\r\n\r\n        const errorCallback = (data) => {\r\n            if (data) {\r\n                console.log('selectFile', data);\r\n                subject.next([]);\r\n            }\r\n        };\r\n        window['imp'].iFile.select(\r\n            { ...options },\r\n            callback,\r\n            errorCallback,\r\n        );\r\n        return subject;\r\n    }\r\n\r\n    takeVideo(options: VidepOptions): Observable<string> {\r\n        let option = { id: options.id }\r\n        if (options.quality) {\r\n            if (options.quality <= 0.5) {\r\n                option['fps'] = 30;\r\n            } else if (options.quality <= 1) {\r\n                option['fps'] = 60;\r\n            }\r\n        } else {\r\n            option['fps'] = 30;\r\n        }\r\n        const subject = new Subject<any>();\r\n\r\n        const callback = (data) => {\r\n            if (data) {\r\n                subject.next(data);\r\n            }\r\n        }\r\n\r\n        const errorCallback = (data) => {\r\n            if (data) {\r\n                console.log('takeVideo', data);\r\n                subject.next([]);\r\n            }\r\n        }\r\n        window['imp'].iVideo.record(\r\n            option,\r\n            callback,\r\n            errorCallback,\r\n        );\r\n        return subject;\r\n    }\r\n\r\n    closeWindow(): void {\r\n        window['imp'].iWindow.close();\r\n    }\r\n\r\n    setTitles(title: string): void {\r\n        document.title = title;\r\n    }\r\n\r\n    downloadFile(options) {\r\n        const subject = new Subject<any>();\r\n        const callback = (data) => {\r\n            if (data.status !== 1) {\r\n                console.log(data);\r\n            }\r\n            subject.next(true);\r\n        }\r\n        window['imp'].iFile.download(options, callback);\r\n        return subject;\r\n    }\r\n\r\n\r\n\r\n    setOriginGoback(fn?: any) {\r\n        const isAGreaterThanB = (parameA: string[], parameB: string[]) => {\r\n            const length = parameA.length > parameB.length ? parameB.length : parameA.length;\r\n            for (let i = 0; i < length; i++) {\r\n                if (parseInt(parameB[i]) > parseInt(parameA[i])) {\r\n                    return false\r\n                }\r\n            }\r\n            return true;\r\n        }\r\n        const setFunction = () => {\r\n            if (fn) {\r\n                window['imp'].iWindow.onBackKeyDown2(fn);\r\n                isAGreaterThanB(currentVersion.split('.'), minVersion.split('.')) && window['imp'].iWindow.onTitleBackKeyDown2(fn);\r\n            } else {\r\n                window['imp'].iWindow.cancelBackKeyDown();\r\n                isAGreaterThanB(currentVersion.split('.'), minVersion.split('.')) && window['imp'].iWindow.cancelTitleBackKeyDown();\r\n            }\r\n        }\r\n        let minVersion = '4.8.21';\r\n        let currentVersion = window['CURRENT_VERSION'];\r\n        if(currentVersion){\r\n            setFunction();\r\n        }else{\r\n            window['imp'].iDevice.sysInfo((info) => {\r\n                const newVersion = info.appVersion.split('-');\r\n                window['CURRENT_VERSION'] = newVersion[0];\r\n                currentVersion = window['CURRENT_VERSION'];\r\n                setFunction();\r\n            })\r\n        }\r\n    }\r\n\r\n    pushOriginGoback(fn?: any) {\r\n        window['OriginGoback'] = window['OriginGoback'] || [];\r\n        const OriginGoback = () => {\r\n            const gobackFn = window['OriginGoback'].pop()\r\n            if (gobackFn) {\r\n                gobackFn()\r\n            }\r\n            else {\r\n                window['imp'].iWindow.cancelBackKeyDown();\r\n                window['imp'].iWindow.cancelTitleBackKeyDown();\r\n                history.back();\r\n            }\r\n        }\r\n        if (fn) {\r\n            window['OriginGoback'].push(fn)\r\n            window['imp'].iWindow.onBackKeyDown2(OriginGoback);\r\n            window['imp'].iWindow.onTitleBackKeyDown2(OriginGoback);\r\n        }\r\n    }\r\n\r\n    popOriginGoback() {\r\n        window['OriginGoback'].pop()\r\n    }\r\n}\r\n\r\nexport { CloudPlusService }","import { IJsBridgeStrategy } from './decorators';\r\nimport { CCworkService } from './ccwork-service';\r\nimport { CloudPlusService } from './cloud-plus-service';\r\nclass JsBridgeStrategyFactory {\r\n\r\n    create(): IJsBridgeStrategy {\r\n        if (navigator.userAgent.toLowerCase().search('ccwork') !== -1) {\r\n            window.top['FARRIS_JSBridge'] = '云上协同'\r\n            return new CCworkService()\r\n        } else if( navigator.userAgent.toLowerCase().search('emmcloud') !== -1) {\r\n            window.top['FARRIS_JSBridge'] = '云加'\r\n            return new CloudPlusService()\r\n        } else {\r\n            window.top['FARRIS_JSBridge'] = '浏览器'\r\n            return new CloudPlusService()\r\n        }\r\n    }\r\n}\r\n\r\nexport { JsBridgeStrategyFactory }","import { JsBridgeStrategyFactory } from './js-bridge-strategy-factory'\r\nimport { IJsBridgeStrategy, PictureOptions, PhotoOptions, VidepOptions } from './decorators';\r\nimport { Observable, Subject } from 'rxjs';\r\n\r\ndeclare const System: any;\r\n\r\nclass JsBridgeService implements IJsBridgeStrategy {\r\n\r\n    constructor() {\r\n        this.jsBridgeStrategyFactory = new JsBridgeStrategyFactory();\r\n        this.init();\r\n    }\r\n\r\n    getSysInfo() {\r\n        return this.getJsBridgeService(this.strategy.getSysInfo);\r\n    }\r\n\r\n\r\n    private strategy: IJsBridgeStrategy;\r\n\r\n    private jsBridgeStrategyFactory: JsBridgeStrategyFactory;\r\n\r\n    private init() {\r\n        this.strategy = this.jsBridgeStrategyFactory.create();\r\n        window['JsBridgeService'] = this\r\n    }\r\n\r\n    takePhoto(options: PhotoOptions): Observable<[]> {\r\n        return this.getJsBridgeService(this.strategy.takePhoto, options);\r\n    }\r\n    scanQRCode(): Observable<string> {\r\n        return this.getJsBridgeService(this.strategy.scanQRCode);\r\n    }\r\n    getLocation(): Observable<any> {\r\n        return this.getJsBridgeService(this.strategy.getLocation);\r\n    }\r\n    sendSMS(number: string, content: string): void {\r\n        return this.getJsBridgeService(this.strategy.sendSMS, number, content);\r\n    }\r\n    openSendSMS(number: string, content: string): void {\r\n        return this.getJsBridgeService(this.strategy.openSendSMS, number, content);\r\n    }\r\n    tel(number: string): void {\r\n        return this.getJsBridgeService(this.strategy.tel, number);\r\n    }\r\n    selectPictureFromAlbum(options: PictureOptions): Observable<[]> {\r\n        return this.getJsBridgeService(this.strategy.selectPictureFromAlbum, options);\r\n    }\r\n    takeVideo(options: VidepOptions): Observable<string> {\r\n        return this.getJsBridgeService(this.strategy.takeVideo, options);\r\n    }\r\n    closeWindow(): void {\r\n        return this.getJsBridgeService(this.strategy.closeWindow);\r\n    }\r\n    setTitles(title: string): void {\r\n        return this.getJsBridgeService(this.strategy.setTitles, title);\r\n    }\r\n\r\n    selectFile(options?: any): any {\r\n        return this.getJsBridgeService(this.strategy.selectFile, options);\r\n    }\r\n\r\n    downloadFile(options: any) {\r\n        return this.getJsBridgeService(this.strategy.downloadFile, options);\r\n    }\r\n\r\n    setOriginGoback(fn?: any) {\r\n        return this.getJsBridgeService(this.strategy.setOriginGoback, fn);\r\n    }\r\n\r\n    pushOriginGoback(fn?: any) {\r\n        return this.getJsBridgeService(this.strategy.pushOriginGoback, fn);\r\n    }\r\n    popOriginGoback(fn?: any) {\r\n        return this.getJsBridgeService(this.strategy.popOriginGoback, fn);\r\n    }\r\n    playShortVideo(fn?: any) {\r\n        return this.getJsBridgeService(this.strategy.playShortVideo, fn);\r\n    }\r\n\r\n\r\n    private getJsBridgeService(method, ...values) {\r\n        const subject = new Subject<any>();\r\n\r\n        // 已经存在方法实例即结束返回\r\n        if (window.top['FARRIS_JSBridge'] === '已加载') {\r\n            return method(...values)\r\n        }\r\n\r\n        // 判断是否为云上协同环境\r\n        if (window.top['FARRIS_JSBridge'] === '云上协同') {\r\n            if (window.top['iCityBridge']) {\r\n                return method(...values)\r\n            } else {\r\n                var ccwork = window.top.document.createElement(\"script\")\r\n                ccwork.src = 'https://ccwork.oss.cn-north-3.inspurcloudoss.com/h5/ccworkJsbridge.js'\r\n                ccwork.onload = function () {\r\n                    window.top['iCityBridge'].init(() => {\r\n                        method(...values).subscribe(\r\n                            (e) => { subject.next(e) }\r\n                        )\r\n                    })\r\n                };\r\n                window.top.document.head.appendChild(ccwork);\r\n            }\r\n        }\r\n\r\n        // 当前没有针对云+的判断，前置环境不满足即默认云+环境\r\n        if (window.top['FARRIS_JSBridge'] === '云加') {\r\n            System\r\n                .import('/platform/common/web/imp.js')\r\n                .then(\r\n                    (e) => {\r\n                        window.top['FARRIS_JSBridge'] = '已加载';\r\n                        method(...values).subscribe(\r\n                            (e) => { subject.next(e) }\r\n                        )\r\n                    }\r\n                )\r\n        }\r\n        return subject;\r\n    }\r\n\r\n}\r\n\r\nexport { JsBridgeService }","import { Observable } from \"rxjs\";\r\n\r\ninterface IJsBridgeStrategy {\r\n\r\n\r\n    // 拍照\r\n    takePhoto(options: PhotoOptions): Observable<[]>\r\n\r\n    // 二维码扫描\r\n    scanQRCode(): Observable<string>\r\n\r\n    // 获取定位信息\r\n    getLocation(): Observable<LocationInfo>\r\n\r\n    // 发送短信\r\n    sendSMS(number: string, content: string): void\r\n\r\n    // 打开发送短信页面\r\n    openSendSMS(number: string, content: string): void\r\n\r\n    // 打开拨打电话界面\r\n    tel(number: string): void\r\n\r\n    // 获取图片\r\n    selectPictureFromAlbum(options: PictureOptions): Observable<[]>\r\n\r\n    // 拍摄视频\r\n    takeVideo(options: VidepOptions): Observable<string>\r\n\r\n    // 关闭窗口\r\n    closeWindow(): void\r\n\r\n    // 更改标题\r\n    setTitles(title: string): void\r\n\r\n    // 选择文件\r\n    selectFile(options?: any): any\r\n\r\n    // 下载文件\r\n    downloadFile(options: any): any;\r\n\r\n    // 获取设备信息\r\n    getSysInfo(): any;\r\n\r\n    // 监听返回\r\n    setOriginGoback(fn?: any): any\r\n\r\n    // 添加全面屏手势返回方法\r\n    pushOriginGoback(fn?: any): any\r\n\r\n    // 删除全面屏手势返回方法\r\n    popOriginGoback(fn?: any): any;\r\n\r\n    // 播放短视频\r\n    playShortVideo(options?: any): any;\r\n}\r\n\r\n// 拍照参数\r\ninterface PhotoOptions {\r\n    // 照片质量 云加 1-100 云上协同 high、mid、low 默认为mid\r\n    quality: string | number,\r\n    encodingType?: any,\r\n    targetWidth?: number,\r\n    targetHeight?: number,\r\n    waterMark?: WaterMark\r\n}\r\n\r\n// 水印\r\ninterface WaterMark {\r\n    content: string,\r\n    color: string,\r\n    background: string,\r\n    algin: string,\r\n    valign: string\r\n}\r\n\r\n// 选择图片参数\r\ninterface PictureOptions {\r\n    maxNum: number,  // 最大可选数 默认9\r\n    mType: number, // 选择模式，可选值0/1, 0:图片，1：视频;\r\n    quality?: string | number  // 照片质量 云加 1-100 云上协同 high、mid、low 默认为mid\r\n}\r\n\r\ninterface VidepOptions {\r\n    id: string; //视频id（视频名字\r\n    quality?: number; // 视频质量 取值范围0~1\r\n}\r\n\r\ninterface LocationInfo {\r\n    addr: string,\r\n    city: string\r\n    country: string\r\n    course?: number\r\n    district: string\r\n    lat: number\r\n    lng: number\r\n    province: string\r\n    street: string\r\n    streetNum: string\r\n}\r\n\r\nexport { IJsBridgeStrategy, PhotoOptions, PictureOptions, VidepOptions, LocationInfo }","import { JsBridgeService } from './js-bridge-service/index';\r\n\r\n/**\r\n * 帮助映射服务\r\n */\r\nexport class HistoryBackService {\r\n\r\n  constructor() {\r\n  }\r\n\r\n  init() {\r\n    window['MOBILE_ORIGIN_BACK_ARRAY'] = window['MOBILE_ORIGIN_BACK_ARRAY'] || []\r\n    window['MOBILE_ORIGIN_BACK'] = {\r\n      pushOriginGoback(fn) {\r\n        window['MOBILE_ORIGIN_BACK_ARRAY'].push(fn);\r\n      },\r\n      popOriginGoback() {\r\n        window['MOBILE_ORIGIN_BACK_ARRAY'].pop();\r\n      },\r\n      reflushOriginGoback() {\r\n        window['MOBILE_ORIGIN_BACK_ARRAY'] = []\r\n      }\r\n    }\r\n  }\r\n\r\n  pushOriginGoback(fn) {\r\n    window['MOBILE_ORIGIN_BACK_ARRAY'].push(fn);\r\n  }\r\n\r\n  popOriginGoback() {\r\n    window['MOBILE_ORIGIN_BACK_ARRAY'].pop();\r\n  }\r\n\r\n  reflushOriginGoback() {\r\n    window['MOBILE_ORIGIN_BACK_ARRAY'] = []\r\n  }\r\n\r\n  proxyBack() {\r\n    if (!( navigator.userAgent.toLowerCase().search('emmcloud') !== -1)){\r\n      return ;\r\n    }\r\n    if (window.top.location.pathname.indexOf('mobiletaskcenter') > -1) {\r\n      setTimeout(()=> {\r\n        window.top['detailBackBtnClickHandler'] = (back) => {\r\n          const gobackFn = window['MOBILE_ORIGIN_BACK_ARRAY'].pop()\r\n          if (gobackFn) {\r\n            gobackFn();\r\n            return false;\r\n          } else {\r\n            const key = location.pathname + location.hash.slice(0, location.hash.indexOf('?'));\r\n            let need_go_back = sessionStorage.getItem(key);\r\n            if (!need_go_back) {\r\n              return true;\r\n            }\r\n            history.back()\r\n            return false;\r\n          }\r\n        }\r\n      }, 0)\r\n\r\n    } else {\r\n      const _close = () => {\r\n        const gobackFn = window['MOBILE_ORIGIN_BACK_ARRAY'].pop()\r\n        if (gobackFn) {\r\n          gobackFn()\r\n        } else {\r\n          history.back()\r\n        }\r\n      }\r\n      const jsBridgeService = new JsBridgeService();\r\n      jsBridgeService.setOriginGoback(_close)\r\n    }\r\n  }\r\n\r\n\r\n\r\n}","import { Observable, EMPTY } from 'rxjs';\r\nimport { ViewModelContext } from '@farris/mobile-devkit';\r\n\r\nconst NOOP = 'noop';\r\n\r\n/**\r\n * 命令服务\r\n */\r\nclass CommandService {\r\n\r\n  /**\r\n   * 构造函数\r\n   */\r\n  constructor(private viewModelContext: ViewModelContext) {}\r\n\r\n  /**\r\n   * 执行命令\r\n   * @param commandName 命令名称\r\n   * @param viewModelId 视图模型id\r\n   */\r\n  public execute(commandName: string, viewModelId?: string): Observable<any> {\r\n    if (!commandName || commandName === '' || commandName === 'undefined') {\r\n      return EMPTY;\r\n    }\r\n\r\n    // 空操作\r\n    if (commandName.toLocaleLowerCase() === NOOP) {\r\n      return EMPTY;\r\n    }\r\n\r\n    let viewModel = this.viewModelContext.viewModel;\r\n    if (viewModelId) {\r\n      const appContext = this.viewModelContext.appContext;\r\n      const targetViewModelContext = appContext.viewModelContextManager.getContextById(viewModelId);\r\n      viewModel = targetViewModelContext.viewModel;\r\n    }\r\n    return viewModel[commandName]();\r\n  }\r\n\r\n}\r\n\r\nexport { CommandService };\r\n","import { ViewModelContext, StateMachine } from '@farris/mobile-devkit';\r\nimport {  EMPTY } from 'rxjs';\r\n/**\r\n * 状态机服务\r\n */\r\nclass StateMachineService {\r\n\r\n    constructor(private viewModelContext: ViewModelContext) {\r\n    }\r\n\r\n    /**\r\n     * 执行状态迁移动作\r\n     */\r\n    executeAction(action: string) {\r\n      if (!action) {\r\n        return EMPTY;\r\n      }\r\n\r\n      if (typeof this.viewModelContext.stateMachine[action] !== 'function') {\r\n        return EMPTY;\r\n      }\r\n      \r\n      this.viewModelContext.stateMachine[action]();\r\n    }\r\n}\r\n\r\nexport { StateMachineService };\r\n","/**\r\n * UI状态机服务\r\n */\r\nclass UIStateService {\r\n\r\n  /**\r\n   * 构造函数\r\n   */\r\n  constructor() {\r\n  }\r\n\r\n}\r\n\r\nexport { UIStateService };\r\n","import { ViewModelContext, Entity } from '@farris/mobile-devkit';\r\nimport { BefRepository } from '@farris/mobile-bef';\r\n\r\n/**\r\n * VO变量访问服务\r\n */\r\nclass VoVariableService {\r\n\r\n  /**\r\n   * 视图对象上下文\r\n   */\r\n  private viewModelContext: ViewModelContext;\r\n\r\n\r\n  /**\r\n   * 构造函数\r\n   */\r\n  constructor(viewModelContext: ViewModelContext) {\r\n    this.viewModelContext = viewModelContext;\r\n  }\r\n\r\n  /**\r\n   * 设置变量值\r\n   */\r\n  public setValue(name: string, value: any): void {\r\n    const befRepository = this.viewModelContext.repository as BefRepository<Entity>;\r\n    befRepository.variableManager.setValue(name, value);\r\n  }\r\n\r\n  /**\r\n   * 获取变量值\r\n   */\r\n  public getValue(name: string): void {\r\n    const befRepository = this.viewModelContext.repository as BefRepository<Entity>;\r\n    befRepository.variableManager.getValue(name);\r\n  }\r\n\r\n}\r\n\r\nexport { VoVariableService };\r\n","\r\n/**\r\n * 上传控件的返回结果（该结构应该放在UI层，临时放在这里）\r\n */\r\ninterface UploadFileInfo {\r\n  metadataId: string;\r\n  fileName: string;\r\n}\r\n\r\n\r\n/**\r\n * 附件信息定义\r\n */\r\ninterface AttachmentInfo {\r\n\r\n  /**\r\n   * 附件id\r\n   */\r\n  attachmentId: string;\r\n\r\n  /**\r\n   * 附件名称\r\n   */\r\n  fileName: string;\r\n}\r\n\r\n\r\n/**\r\n * 服务器端所需的附件信息定义\r\n */\r\ninterface ServerAttachmentInfo {\r\n\r\n  /**\r\n   * 表名路径\r\n   */\r\n  NodeCodes: string[];\r\n\r\n  /**\r\n   * 主键路径\r\n   */\r\n  HiretryIds: string[];\r\n\r\n  /**\r\n   * 附件id数组（批量新增时使用）\r\n   */\r\n  AttachmentIds?: string[];\r\n\r\n  /**\r\n   * 附件id（更新时使用）\r\n   */\r\n  AttachmentId?: string;\r\n}\r\n\r\nexport { UploadFileInfo, AttachmentInfo, ServerAttachmentInfo };\r\n","import { UploadFileInfo, AttachmentInfo } from './types';\r\n\r\n/**\r\n * 附件信息处理工具类\r\n */\r\nclass AttachmentUtil {\r\n\r\n  /**\r\n   * 转换为附件信息数组\r\n   */\r\n  public static convertToAttachmentInfos(fileInfos: UploadFileInfo[]): AttachmentInfo[] {\r\n    if (!fileInfos) {\r\n      return [];\r\n    }\r\n    const attachmentInfos: AttachmentInfo[] = fileInfos.map((fileInfo: UploadFileInfo) => {\r\n      return this.convertToAttachmentInfo(fileInfo);\r\n    });\r\n    return attachmentInfos;\r\n  }\r\n\r\n  /**\r\n   * 转换为附件信息\r\n   */\r\n  public static convertToAttachmentInfo(fileInfo: UploadFileInfo): AttachmentInfo {\r\n    const attachmentInfo: AttachmentInfo = {\r\n      attachmentId: fileInfo.metadataId,\r\n      fileName: fileInfo.fileName\r\n    };\r\n    return attachmentInfo;\r\n  }\r\n\r\n  /**\r\n   * 获取附件列表中的第一个附件\r\n   */\r\n  public static getFirstAttachmentInfo(attachmentInfos: AttachmentInfo[]) {\r\n    if (!attachmentInfos || attachmentInfos.length === 0) {\r\n      return;\r\n    }\r\n    const firstAttachmentInfo = attachmentInfos[0];\r\n    return firstAttachmentInfo;\r\n  }\r\n\r\n  /**\r\n   * 提取附件id数组\r\n   */\r\n  public static peekAttachmentIds(attachmentInfos: AttachmentInfo[]) {\r\n    if (!attachmentInfos) {\r\n      attachmentInfos = [];\r\n    }\r\n    const attachmentIds = attachmentInfos.map((attachmentInfo: AttachmentInfo) => {\r\n      return attachmentInfo.attachmentId;\r\n    });\r\n\r\n    return attachmentIds;\r\n  }\r\n\r\n}\r\n\r\nexport { AttachmentUtil };\r\n","import { Observable, of } from 'rxjs';\r\nimport { tap, switchMap, map } from 'rxjs/operators';\r\nimport { HttpRequestConfig, HttpMethods, Entity, ViewModelContext, BindingData, BindingPathConverter, DataChangeType } from '@farris/mobile-devkit';\r\nimport { BefRepository, BefDataPathUtil } from '@farris/mobile-bef';\r\nimport { AttachmentInfo, ServerAttachmentInfo } from './types';\r\nimport { AttachmentUtil } from './attachment.util';\r\n\r\n/**\r\n * 附件数据服务\r\n */\r\nclass AttachmentDataService {\r\n\r\n  /**\r\n   * ViewModel上下文\r\n   */\r\n  private viewModelContext: ViewModelContext\r\n\r\n  /**\r\n   * 实体仓库\r\n   */\r\n  private get befRepository(): BefRepository<Entity> {\r\n    return this.viewModelContext.repository as BefRepository<Entity>;\r\n  }\r\n\r\n  /**\r\n   * 绑定数据\r\n   */\r\n  private get bindingData(): BindingData {\r\n    return this.viewModelContext.bindingData;\r\n  }\r\n\r\n  /**\r\n   * 构造函数\r\n   */\r\n  constructor(viewModelContext: ViewModelContext) {\r\n    this.viewModelContext = viewModelContext;\r\n  }\r\n\r\n  /**\r\n   * 更新附件信息\r\n   */\r\n  public updateRow(attachmentInfoFieldPath: string, attachmentInfo: AttachmentInfo): Observable<any> {\r\n    const apiProxy = this.befRepository.apiProxy;\r\n    const updateUrl = `${apiProxy.baseUrl}/service/updateattachment`;\r\n    const serverAttachInfo = this.createUpdateAttachInfo(attachmentInfoFieldPath, attachmentInfo);\r\n    const body = {\r\n      updateAttachInfo: serverAttachInfo\r\n    };\r\n    const requestConfig: HttpRequestConfig = {\r\n      body: body\r\n    };\r\n\r\n    console.log('loading show ...');\r\n    return apiProxy.request(HttpMethods.PUT, updateUrl, requestConfig).pipe(\r\n      switchMap((result: any) => {\r\n        return this.syncAttachmentInfosToClient();\r\n      }),\r\n      tap(() => {\r\n        console.log('loading hide ...');\r\n      })\r\n    );\r\n  }\r\n\r\n  /**\r\n   * 批量创建附件行数据\r\n   */\r\n  public updateRows(attachmentInfoFieldPath: string, attachmentInfos: AttachmentInfo[]): Observable<any> {\r\n    const apiProxy = this.befRepository.apiProxy;\r\n    const updateUrl = `${apiProxy.baseUrl}/service/batchuploadattachment`;\r\n    const serverAttachInfo = this.createBatchCreateAttachInfo(attachmentInfoFieldPath, attachmentInfos);\r\n    const isRootEntity = serverAttachInfo.NodeCodes.length === 0;\r\n\r\n    const body = {\r\n      batchUploadInfo: serverAttachInfo\r\n    };\r\n    const requestConfig: HttpRequestConfig = {\r\n      body: body\r\n    };\r\n\r\n    console.log('loading show ...');\r\n    return apiProxy.request(HttpMethods.PUT, updateUrl, requestConfig).pipe(\r\n      switchMap((result: any) => {\r\n        return this.appendAttachmentInfosToClient(result, isRootEntity);\r\n      }),\r\n      tap(() => {\r\n        console.log('hide loading ...');\r\n      })\r\n    );\r\n  }\r\n\r\n  /**\r\n   * 创建服务器端需要的更新信息\r\n   */\r\n  private createUpdateAttachInfo(attachmentInfoFieldPath: string, attachmentInfo: AttachmentInfo): ServerAttachmentInfo {\r\n\r\n    const attachmentId = attachmentInfo.attachmentId;\r\n    const parentBindingPathArray = BindingPathConverter.toBindingPathArray(attachmentInfoFieldPath);\r\n    parentBindingPathArray.pop();\r\n    const nodeCodes = BefDataPathUtil.convertToObjectCodes(parentBindingPathArray, this.bindingData);\r\n    const hiretryIds = BefDataPathUtil.convertToDataIdsForUpdate(parentBindingPathArray, this.bindingData);\r\n\r\n    const serverAttachInfo: ServerAttachmentInfo = {\r\n      NodeCodes: nodeCodes,\r\n      HiretryIds: hiretryIds,\r\n      AttachmentIds: [attachmentId],\r\n      AttachmentId: attachmentId\r\n    };\r\n\r\n    return serverAttachInfo;\r\n  }\r\n\r\n  /**\r\n   * 创建服务器端需要的批量新增附件信息\r\n   */\r\n  private createBatchCreateAttachInfo(attachmentInfoFieldPath: string, attachmentInfo: AttachmentInfo[]): ServerAttachmentInfo {\r\n    const attachmentIds = AttachmentUtil.peekAttachmentIds(attachmentInfo);\r\n\r\n    const parentBindingPathArray = BindingPathConverter.toBindingPathArray(attachmentInfoFieldPath);\r\n    parentBindingPathArray.pop();\r\n    const nodeCodes = BefDataPathUtil.convertToObjectCodes(parentBindingPathArray, this.bindingData);\r\n    const hiretryIds = BefDataPathUtil.convertToDataIdsForAdd(parentBindingPathArray, this.bindingData);\r\n\r\n    const serverAttachInfo = {\r\n      NodeCodes: nodeCodes,\r\n      HiretryIds: hiretryIds,\r\n      AttachmentIds: attachmentIds,\r\n      AttachmentId: null\r\n    };\r\n\r\n    return serverAttachInfo;\r\n  }\r\n\r\n  /**\r\n   * 同步服务器端最新信息到客户端\r\n   * @todo:\r\n   * 1、主对象批量新增时不支持\r\n   */\r\n  public syncAttachmentInfosToClient() {\r\n    const rootDataId = this.bindingData.list.currentId;\r\n    return this.befRepository.updateEntityById(rootDataId);\r\n  }\r\n\r\n  /**\r\n   * 追击主表数据到客户端\r\n   */\r\n  public appendAttachmentInfosToClient(listData: any[], isRootEntity: boolean): Observable<any[]> {\r\n    if (isRootEntity === true) {\r\n      const entities = this.befRepository.buildEntities(listData);\r\n      this.befRepository.entityCollection.addEntities(entities);\r\n      return of(listData);\r\n    } else {\r\n      return this.syncAttachmentInfosToClient().pipe(\r\n        map(() => {\r\n          this.befRepository.dataChangeHistory.addChange({ dataId: listData[0].id, changeType: DataChangeType.Add });\r\n          return listData;\r\n        })\r\n      );\r\n    }\r\n  }\r\n\r\n}\r\n\r\nexport { AttachmentDataService };\r\n","import { Observable, EMPTY, forkJoin } from 'rxjs';\r\nimport { tap } from 'rxjs/operators';\r\n\r\nimport { ViewModelContext, CommandContext, BindingPathConverter } from '@farris/mobile-devkit';\r\nimport { UploadFileInfo } from './types';\r\nimport { AttachmentUtil } from './attachment.util';\r\nimport { AttachmentDataService } from './attachment-data.service';\r\nimport { EntityService } from '../entity-services/index';\r\nimport { RemoveDataService } from '../data-services/remove-data.service';\r\n\r\n\r\n/**\r\n * 附件服务\r\n */\r\nclass AttachmentService {\r\n\r\n  /**\r\n   * 默认根目录\r\n   */\r\n  private defaultRootDirId = 'default-root';\r\n\r\n  /**\r\n   * 默认子目录\r\n   */\r\n  private get defaultParentDirName(): string {\r\n    return this.viewModelContext.bindingData.list.currentId;\r\n  }\r\n\r\n  /**\r\n   * 视图模型\r\n   */\r\n  private viewModelContext: ViewModelContext;\r\n\r\n  /**\r\n   * 附件数据服务\r\n   */\r\n  private attachDataService: AttachmentDataService;\r\n\r\n  /**\r\n   * 实体服务\r\n   */\r\n  private entityService: EntityService;\r\n\r\n  /**\r\n   * 实体服务\r\n   */\r\n  private removeDataService: RemoveDataService;\r\n\r\n  /**\r\n   * 构造函数\r\n   */\r\n  constructor(\r\n    viewModelContext: ViewModelContext, entityService: EntityService,\r\n    removeDataService: RemoveDataService, attachDataService: AttachmentDataService\r\n  ) {\r\n\r\n    this.viewModelContext = viewModelContext;\r\n    this.attachDataService = attachDataService;\r\n    this.entityService = entityService;\r\n    this.removeDataService = removeDataService;\r\n  }\r\n\r\n  /**\r\n   * 上传单个文件\r\n   * @param attachmentIdPath 附件内码字段的路径，形如/attachInfo/attachmentId；\r\n   * @param attachmentNamePath 附件名称字段的路径\r\n   */\r\n  public uploadAndUpdateRow(attachmentInfoFieldPath: string, rootDirId?: string, parentDirName?: string): Observable<any> {\r\n    const rootId = rootDirId ? rootDirId : this.defaultRootDirId;\r\n    const formId = parentDirName ? parentDirName : this.defaultParentDirName;\r\n    if (!rootId || !formId) {\r\n      throw new Error('rootDirId和parentDirName不能为空，请填写');\r\n    }\r\n\r\n    const fileInfos = this.getUploadFileInfosFromContext();\r\n    const attachmentInfos = AttachmentUtil.convertToAttachmentInfos(fileInfos);\r\n    if (!attachmentInfos || attachmentInfos.length === 0) {\r\n      alert('请先上传附件');\r\n      return EMPTY;\r\n    }\r\n\r\n    // 更新服务器端\r\n    console.log('show loading ...');\r\n    const firstAttachmentInfo = AttachmentUtil.getFirstAttachmentInfo(attachmentInfos);\r\n    const result$ = this.attachDataService.updateRow(attachmentInfoFieldPath, firstAttachmentInfo).pipe(\r\n      tap(() => {\r\n        console.log('hide loading ...');\r\n      })\r\n    );\r\n    return result$;\r\n  }\r\n\r\n  /**\r\n   * 上传多个文件\r\n   */\r\n  public uploadAndBatchAddRows(attachmentInfoFieldPath: string, rootDirId?: string, parentDirName?: string): Observable<any> {\r\n    const rootId = rootDirId ? rootDirId : this.defaultRootDirId;\r\n    const formId = parentDirName ? parentDirName : this.defaultParentDirName;\r\n    if (!rootId || !formId) {\r\n      throw new Error('rootDirId和parentDirName不能为空，请填写');\r\n    }\r\n\r\n    const fileInfos = this.getUploadFileInfosFromContext();\r\n    const attachmentInfos = AttachmentUtil.convertToAttachmentInfos(fileInfos);\r\n    if (!attachmentInfos || attachmentInfos.length === 0) {\r\n      alert('请先上传附件');\r\n      return EMPTY;\r\n    }\r\n\r\n    // 更新服务器端\r\n    console.log('show loading ...');\r\n    const result$ = this.attachDataService.updateRows(attachmentInfoFieldPath, attachmentInfos).pipe(\r\n      tap(() => {\r\n        console.log('hide loading ...');\r\n      })\r\n    );\r\n\r\n    return result$;\r\n  }\r\n\r\n  /**\r\n   * 批量删除附件所在的行\r\n   */\r\n  public removeAttachmentRows(attachmentInfoFieldPath: string): Observable<any> {\r\n    if (!attachmentInfoFieldPath) {\r\n      return EMPTY;\r\n    }\r\n    const dataIds = this.getDataIdsToRemove(attachmentInfoFieldPath);\r\n    //如果是主表\r\n    if (attachmentInfoFieldPath.split('/').length <= 2) {\r\n      return this.removeDataService.removeByIds(dataIds);\r\n    }\r\n    // 如果是子表\r\n    else {\r\n      const removeObservables: Observable<any>[] = [];\r\n      if (dataIds.length === 0) {\r\n        alert('请选择要删除的文件');\r\n      }\r\n      const bindingListPath = this.getBindingListPathWithAttachments(attachmentInfoFieldPath);\r\n      dataIds.forEach((dataId: string) => {\r\n        const removeObservable = this.removeDataService.removeByPathAndId(bindingListPath, dataId);\r\n        removeObservables.push(removeObservable);\r\n      });\r\n      return forkJoin(removeObservables);\r\n    }\r\n  }\r\n\r\n  // #region 工具方法\r\n  /**\r\n   * 从上下文中中获取控件传递的附件信息\r\n   */\r\n  private getUploadFileInfosFromContext(): UploadFileInfo[] {\r\n    const commandContext = this['context'] as CommandContext;\r\n    const uploadFileInfos = commandContext.eventParams as UploadFileInfo[];\r\n    if (!uploadFileInfos) {\r\n      return [];\r\n    }\r\n    return uploadFileInfos;\r\n  }\r\n\r\n  /**\r\n   * 获取要删除的附件对应的数据id数组\r\n   */\r\n  public getDataIdsToRemove(attachmentInfoFieldPath: string) {\r\n    const attachIds = this.getAttachmentIdsToRemoveFromContext();\r\n    const dataIds: string[] = [];\r\n    attachIds.forEach((attachId: string) => {\r\n\r\n      // 上传删除和预览删除传递过来的fileId的key可能不一致，要做兼容\r\n      const dataId = this.convertAttachmentIdToDataId(attachId, attachmentInfoFieldPath);\r\n      dataIds.push(dataId);\r\n    });\r\n    return dataIds;\r\n  }\r\n\r\n  /**\r\n   * 从命令上下文中获取要删除附件ids\r\n   */\r\n  public getAttachmentIdsToRemoveFromContext() {\r\n    const commandContext = this['context'] as CommandContext;\r\n    return commandContext.eventParams as string[];\r\n  }\r\n\r\n  /**\r\n   * 根据路径获取附件字段值数组\r\n   * @param fieldPath 字段路径\r\n   */\r\n  private convertAttachmentIdToDataId(fileId: string, attachmentInfoFieldPath: string): string {\r\n\r\n    // 解析路径\r\n    const attachInfoBindingPath = BindingPathConverter.toBindingPathArray(attachmentInfoFieldPath);\r\n    const attachFieldName = attachInfoBindingPath.pop();\r\n    const attachListBindingPath = attachInfoBindingPath;\r\n\r\n    // 获取附件id数组\r\n    const entityListData = this.entityService.getEntityListData(attachListBindingPath);\r\n    const targetEntityData = entityListData.find((entityData: any) => {\r\n      if (entityData[attachFieldName]) {\r\n        const attachmentId = entityData[attachFieldName]['attachmentId'];\r\n        if (attachmentId === fileId) {\r\n          return true;\r\n        }\r\n      }\r\n    });\r\n\r\n    return targetEntityData.id;\r\n  }\r\n\r\n  /**\r\n   * 获取带附件的BindingList的Path\r\n   */\r\n  private getBindingListPathWithAttachments(attachmentInfoFieldPath: string) {\r\n    const attachInfoBindingPath = BindingPathConverter.toBindingPathArray(attachmentInfoFieldPath);\r\n    attachInfoBindingPath.pop();\r\n    const bindingListPath = attachInfoBindingPath;\r\n    return '/' + bindingListPath.join('/');\r\n  }\r\n\r\n  // #endregion\r\n\r\n}\r\n\r\nexport { AttachmentService };\r\n","import { ViewModelContext } from '@farris/mobile-devkit';\r\nimport { Subject } from 'rxjs';\r\nexport class CcWorkService {\r\n    // public location$ = new Subject();\r\n    constructor() {\r\n\r\n    }\r\n\r\n    /**\r\n     * 云上协同关闭页面\r\n     */\r\n    closeCcWorkWebView() {\r\n        window['iCityBridge'].closeWebView();\r\n    }\r\n\r\n    /**\r\n     * 云上协同隐藏标题栏\r\n     */\r\n    hideCcWorkNaviBar() {\r\n        window['iCityBridge'].hideTitleBar();\r\n    }\r\n\r\n    /**\r\n     *  云上协同更改标题栏\r\n     */\r\n    setTitle(title: string) {\r\n        window['iCityBridge'].setTitle(title);\r\n    }\r\n\r\n    /**\r\n     * 获取当前位置\r\n     * @param callBack(data) 回调函数 \r\n     */\r\n    getLocation(callBack) {\r\n        if (window['iCityBridge']) {\r\n            window['iCityBridge'].ccworkGetLocation(callBack);\r\n        }\r\n    }\r\n\r\n\r\n    /**\r\n     * 获取二维码\r\n     * @param callBack(data) 回调函数 \r\n     * @param params 配置项 \r\n     */\r\n    scanCode(callBack, params = {}) {\r\n        if (window['iCityBridge']) {\r\n            const paramsObj = {\r\n                filters: [\r\n                    'QR', 'EAN13', 'EAN8'\r\n                ],\r\n                path: '',\r\n                ...params\r\n            };\r\n            window['iCityBridge'].ccworkScanCode(paramsObj, callBack);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 云上协同调用拨号\r\n     * @param phoneNumber 手机号\r\n     * @param callBack(data) 回调函数 \r\n     */\r\n    callPhone(phoneNumber: string, callback) {\r\n        if (window['iCityBridge']) {\r\n            const params = {\r\n                number: phoneNumber\r\n            };\r\n            window['iCityBridge'].ccworkCallPhone(params, callback);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 从相机和相册中获取照片\r\n     * @param params \r\n     * @param callback \r\n     */\r\n    getPicsFromCameraAndAlbum(params, callback) {\r\n        if (window['iCityBridge']) {\r\n            window['iCityBridge'].ccworkGetPicsFromCameraAndAlbum(params, callback);\r\n        }\r\n    }\r\n\r\n}\r\n","import { StaticMap } from \"./static-map\";\r\n\r\nexport class MapService {\r\n    constructor() {\r\n\r\n    }\r\n    getStaticMap(options: StaticMap) {\r\n        if (!options) {\r\n            return;\r\n        }\r\n        // location是必填的\r\n        if (!options.location) {\r\n            return;\r\n        }\r\n        if (!options.key) {\r\n            // 默认key\r\n            options.key = 'e01c849062d312e0cbeb2beb1f28ef71';\r\n        }\r\n        if (!options.zoom) {\r\n            options.zoom = 10;\r\n        }\r\n        if (!options.size) {\r\n            options.size = {\r\n                width: 400,\r\n                height: 400\r\n            };\r\n        }\r\n        const markers = options.markers;\r\n        let markersStr = '';\r\n        if (markers && markers.length) {\r\n            // 地图标记\r\n            markersStr = markers.reduce((total, next, index) => {\r\n                total += (next.longtitude + ',' + next.latitude + ';');\r\n                return total;\r\n            }, '');\r\n            if (!options.markerSize) {\r\n                options.markerSize = 'mid';\r\n            }\r\n            if (!options.markerColor) {\r\n                /* 默认红色 */\r\n                options.markerColor = '';\r\n            }\r\n            if (markersStr) {\r\n                markersStr = `&markers=${options.markerSize},${options.markerColor},A:${markersStr.substring(0, markersStr.length - 1)}`;\r\n            }\r\n        }\r\n        let longitude: string | number = options.location.longtitude;\r\n        let latitude: string | number = options.location.latitude;\r\n        // 处理location的小数点后几位  最长保留6位\r\n        const longitudeStr = longitude.toString();\r\n        const latitudeStr = latitude.toString();\r\n        if (longitudeStr.substring(longitudeStr.indexOf('.') + 1).length > 6) {\r\n            longitude = longitude.toFixed(6);\r\n        }\r\n        if (latitudeStr.substring(latitudeStr.indexOf('.') + 1).length > 6) {\r\n            latitude = latitude.toFixed(6);\r\n        }\r\n        return 'https://restapi.amap.com/v3/staticmap' +\r\n            '?location=' + longitude + ',' + latitude +\r\n            '&zoom=' + options.zoom +\r\n            '&size=' + options.size.width + '*' + options.size.height +\r\n            markersStr +\r\n            '&key=' + options.key;\r\n    }\r\n}\r\n","\r\n/**\r\n * 上传控件的返回结果（该结构应该放在UI层，临时放在这里）\r\n */\r\ninterface BusinessUploadFileInfo {\r\n  metadataId: string;\r\n  fileName: string;\r\n}\r\n\r\n\r\n/**\r\n * 附件信息定义\r\n */\r\ninterface BusinessAttachmentInfo {\r\n\r\n  /**\r\n   * 附件id\r\n   */\r\n  attachmentId: string;\r\n\r\n  /**\r\n   * 附件名称\r\n   */\r\n  fileName: string;\r\n}\r\n\r\n\r\n/**\r\n * 服务器端所需的附件信息定义\r\n */\r\ninterface BusinessServerAttachmentInfo {\r\n\r\n  /**\r\n   * 表名路径\r\n   */\r\n  NodeCodes: string[];\r\n\r\n  /**\r\n   * 主键路径\r\n   */\r\n  HiretryIds: string[];\r\n\r\n  /**\r\n   * 附件id数组（批量新增时使用）\r\n   */\r\n  AttachmentIds?: string[];\r\n\r\n  /**\r\n   * 附件id（更新时使用）\r\n   */\r\n  AttachmentId?: string;\r\n}\r\n\r\nexport { BusinessUploadFileInfo, BusinessAttachmentInfo, BusinessServerAttachmentInfo };\r\n","import { ChangeDetail, ChangeDetailType } from '@farris/mobile-bef';\r\nimport { BusinessUploadFileInfo, BusinessAttachmentInfo } from './types';\r\n\r\n\r\n/**\r\n * 附件信息处理工具类\r\n */\r\nclass AttachmentUtil {\r\n\r\n  /**\r\n   * 转换为附件信息数组\r\n   */\r\n  public static convertToAttachmentInfos(fileInfos: BusinessUploadFileInfo[]): BusinessAttachmentInfo[] {\r\n    if (!fileInfos) {\r\n      return [];\r\n    }\r\n    const attachmentInfos: BusinessAttachmentInfo[] = fileInfos.map((fileInfo: BusinessUploadFileInfo) => {\r\n      return this.convertToAttachmentInfo(fileInfo);\r\n    });\r\n    return attachmentInfos;\r\n  }\r\n\r\n  /**\r\n   * 转换为附件信息\r\n   */\r\n  public static convertToAttachmentInfo(fileInfo: BusinessUploadFileInfo): BusinessAttachmentInfo {\r\n    const attachmentInfo: BusinessAttachmentInfo = {\r\n      attachmentId: fileInfo.metadataId,\r\n      fileName: fileInfo.fileName\r\n    };\r\n    return attachmentInfo;\r\n  }\r\n\r\n  /**\r\n   * 获取附件列表中的第一个附件\r\n   */\r\n  public static getFirstAttachmentInfo(attachmentInfos: BusinessAttachmentInfo[]) {\r\n    if (!attachmentInfos || attachmentInfos.length === 0) {\r\n      return;\r\n    }\r\n    const firstBusinessAttachmentInfo = attachmentInfos[0];\r\n    return firstBusinessAttachmentInfo;\r\n  }\r\n\r\n  /**\r\n   * 提取附件id数组\r\n   */\r\n  public static peekAttachmentIds(attachmentInfos: BusinessAttachmentInfo[]) {\r\n    if (!attachmentInfos) {\r\n      attachmentInfos = [];\r\n    }\r\n    const attachmentIds = attachmentInfos.map((attachmentInfo: BusinessAttachmentInfo) => {\r\n      return attachmentInfo.attachmentId;\r\n    });\r\n\r\n    return attachmentIds;\r\n  }\r\n\r\n  /**\r\n   * 批量获取变更\r\n   */\r\n  public static getChangeDetails(oldListData, newListData): ChangeDetail[] {\r\n    const changeDetails = [];\r\n    newListData.forEach((newData: any) => {\r\n      let oldData = oldListData.find((oldData: any) => {\r\n        return oldData['id'] === newData['id'];\r\n      });\r\n\r\n      if (!oldData) {\r\n        oldData = {};\r\n      }\r\n\r\n      const changeDetail = this.getChangeDetail(oldData, newData);\r\n      if (changeDetail) {\r\n        changeDetails.push(changeDetail);\r\n      }\r\n    });\r\n\r\n    return changeDetails;\r\n  }\r\n\r\n  /**\r\n   * 获取变更集\r\n   */\r\n  public static getChangeDetail(oldData, newData): ChangeDetail {\r\n    const changeDetail: ChangeDetail = {\r\n      ChangeType: ChangeDetailType.Modify,\r\n      ChangeInfo: {\r\n        DataId: newData['id']\r\n      }\r\n    };\r\n    let isChanged = false;\r\n\r\n    Object.keys(newData).forEach((propName) => {\r\n\r\n      // 移除不必要的属性的比较\r\n      if (propName === 'id' || propName === 'nodeCode' || propName === 'childs') {\r\n        return;\r\n      }\r\n      \r\n      const oldValue = oldData[propName];\r\n      const newValue = newData[propName];\r\n\r\n      if (oldValue === undefined && typeof newValue === 'object') {\r\n        return;\r\n      }\r\n\r\n      if (JSON.stringify(oldValue) !== JSON.stringify(newValue)) {\r\n        changeDetail.ChangeInfo[propName] = newValue;\r\n        isChanged = true;\r\n      }\r\n    });\r\n\r\n    return isChanged ? changeDetail : null;\r\n\r\n  }\r\n\r\n}\r\n\r\nexport { AttachmentUtil };\r\n","import { Observable, of, EMPTY } from 'rxjs';\r\nimport { tap, switchMap, map } from 'rxjs/operators';\r\nimport { HttpRequestConfig, HttpMethods, Entity, ViewModelContext, BindingData, BindingPathConverter, HttpUtil } from '@farris/mobile-devkit';\r\nimport { BefRepository, BefDataPathUtil } from '@farris/mobile-bef';\r\nimport { BusinessAttachmentInfo, BusinessServerAttachmentInfo } from './types';\r\nimport { AttachmentUtil } from './business-attachment.util';\r\nimport { BaseDataService } from '../data-services';\r\n\r\n/**\r\n * 附件数据服务\r\n */\r\nclass BusinessAttachmentDataService {\r\n\r\n  /**\r\n   * ViewModel上下文\r\n   */\r\n  public viewModelContext: ViewModelContext;\r\n\r\n  /**\r\n   * 实体仓库\r\n   */\r\n  public get befReposi(): BefRepository<Entity> {\r\n    return this.viewModelContext.repository as BefRepository<Entity>;\r\n  }\r\n\r\n  /**\r\n   * 绑定数据\r\n   */\r\n  private get bindingData(): BindingData {\r\n    return this.viewModelContext.bindingData;\r\n  }\r\n\r\n  /**\r\n   * 构造函数\r\n   */\r\n  constructor(viewModelContext: ViewModelContext) {\r\n    this.viewModelContext = viewModelContext;\r\n  }\r\n\r\n  getAllBeSessions() {\r\n    const beSessionsJson = window.sessionStorage.getItem(\"BE_SESSION_ID\");\r\n    if (!beSessionsJson) {\r\n      return {};\r\n    }\r\n    const frmSessionId = this.getUserSessionId();\r\n    const beSessions = JSON.parse(beSessionsJson);\r\n    const beSessionKey = `${frmSessionId}_/api/gsp/common/v1.0/testForm_mfrm`;\r\n    return beSessions[beSessionKey];\r\n  }\r\n  /**\r\n   * 获取用户SessionId\r\n   */\r\n  getUserSessionId() {\r\n    const userSessionId = window.localStorage.getItem(\"sessionId\");\r\n    return userSessionId;\r\n  }\r\n\r\n  /**\r\n   * 扩展BeSessionId相关头信息\r\n   */\r\n  handleRequestHeaders(headers) {\r\n    const frmSessionId = this.getUserSessionId();\r\n    const beSessionId = this.getAllBeSessions();\r\n    if (frmSessionId) {\r\n      headers = HttpUtil.appendHeader(\r\n        headers,\r\n        \"X-CAF-Runtime-CommonVariable\",\r\n        frmSessionId\r\n      );\r\n    }\r\n    if (beSessionId) {\r\n      headers = HttpUtil.appendHeader(\r\n        headers,\r\n        \"X-CAF-Runtime-Context\",\r\n        beSessionId\r\n      );\r\n      headers = HttpUtil.appendHeader(headers, \"SessionId\", beSessionId);\r\n    }\r\n    headers = HttpUtil.appendHeader(headers, 'Content-Type', 'application/json');\r\n    return headers;\r\n  }\r\n  public extendQueryData(url: string): Observable<any> {\r\n    const entityFilter = {\r\n      FilterConditions: [],\r\n      SortConditions: [],\r\n      IsUsePagination: false,\r\n      Pagination: {\r\n        PageIndex: 1,\r\n        PageSize: 5,\r\n        PageCount: 0,\r\n        TotalCount: 0\r\n      }\r\n    };\r\n    const entityFilterString = JSON.stringify(entityFilter);\r\n    const params = {\r\n      entityFilter: entityFilterString\r\n    };\r\n    // const url = `/api/gsp/common/v1.0/attachmentform_mfrm/extension/query`;\r\n    // 拓展header\r\n    // const headers = this.handleRequestHeaders({});\r\n    // 拓展body\r\n    const requestConfig = { params };\r\n    return this.befReposi.apiProxy.request(HttpMethods.PUT, url, requestConfig);\r\n  }\r\n\r\n  /**\r\n   * 更新附件信息\r\n   */\r\n  public updateRow(attachmentInfoFieldPath: string, attachmentInfo: BusinessAttachmentInfo): Observable<any> {\r\n    const apiProxy = this.befReposi.apiProxy;\r\n    const updateUrl = `${apiProxy.baseUrl}/service/updateattachment`;\r\n    const serverAttachInfo = this.createUpdateAttachInfo(attachmentInfoFieldPath, attachmentInfo);\r\n    const body = {\r\n      updateAttachInfo: serverAttachInfo\r\n    };\r\n    const requestConfig: HttpRequestConfig = {\r\n      body: body\r\n    };\r\n    return apiProxy.request(HttpMethods.PUT, updateUrl, requestConfig);\r\n  }\r\n\r\n  /**\r\n   * 批量创建附件行数据\r\n   */\r\n  public updateRows(updateUrl: string, attachmentInfoFieldPath: string, attachmentInfos: BusinessAttachmentInfo[]): Observable<any> {\r\n    const apiProxy = this.befReposi.apiProxy;\r\n    // const updateUrl = `${apiProxy.baseUrl}/service/batchuploadattachment`;\r\n    const serverAttachInfo = this.createBatchCreateAttachInfo(attachmentInfoFieldPath, attachmentInfos);\r\n    const isRootEntity = serverAttachInfo.NodeCodes.length === 0;\r\n\r\n    const body = {\r\n      batchUploadInfo: serverAttachInfo\r\n    };\r\n    const requestConfig: HttpRequestConfig = {\r\n      body: body\r\n    };\r\n\r\n    return apiProxy.request(HttpMethods.PUT, updateUrl, requestConfig, true);\r\n  }\r\n\r\n\r\n\r\n\r\n\r\n  /**\r\n   * 创建服务器端需要的更新信息\r\n   */\r\n  private createUpdateAttachInfo(attachmentInfoFieldPath: string, attachmentInfo: BusinessAttachmentInfo): BusinessServerAttachmentInfo {\r\n\r\n    const attachmentId = attachmentInfo.attachmentId;\r\n    const parentBindingPathArray = BindingPathConverter.toBindingPathArray(attachmentInfoFieldPath);\r\n    parentBindingPathArray.pop();\r\n    const nodeCodes = BefDataPathUtil.convertToObjectCodes(parentBindingPathArray, this.bindingData);\r\n    const hiretryIds = BefDataPathUtil.convertToDataIdsForUpdate(parentBindingPathArray, this.bindingData);\r\n\r\n    const serverAttachInfo: BusinessServerAttachmentInfo = {\r\n      NodeCodes: nodeCodes,\r\n      HiretryIds: hiretryIds,\r\n      AttachmentIds: [attachmentId],\r\n      AttachmentId: attachmentId\r\n    };\r\n\r\n    return serverAttachInfo;\r\n  }\r\n\r\n  /**\r\n   * 创建服务器端需要的批量新增附件信息\r\n   */\r\n  private createBatchCreateAttachInfo(attachmentInfoFieldPath: string, attachmentInfo: BusinessAttachmentInfo[]):\r\n    BusinessServerAttachmentInfo {\r\n    const attachmentIds = AttachmentUtil.peekAttachmentIds(attachmentInfo);\r\n\r\n    const parentBindingPathArray = BindingPathConverter.toBindingPathArray(attachmentInfoFieldPath);\r\n    parentBindingPathArray.pop();\r\n    const nodeCodes = BefDataPathUtil.convertToObjectCodes(parentBindingPathArray, this.bindingData);\r\n    const hiretryIds = BefDataPathUtil.convertToDataIdsForAdd(parentBindingPathArray, this.bindingData);\r\n\r\n    const serverAttachInfo = {\r\n      NodeCodes: nodeCodes,\r\n      HiretryIds: hiretryIds,\r\n      AttachmentIds: attachmentIds,\r\n      AttachmentId: null\r\n    };\r\n\r\n    return serverAttachInfo;\r\n  }\r\n\r\n  /**\r\n   * 同步服务器端最新信息到客户端\r\n   * @todo:\r\n   * 1、主对象批量新增时不支持\r\n   */\r\n  public syncAttachmentInfosToClient() {\r\n    const rootDataId = this.bindingData.list.currentId;\r\n    return this.befReposi.updateEntityById(rootDataId);\r\n  }\r\n\r\n  /**\r\n   * 追击主表数据到客户端\r\n   */\r\n  public appendAttachmentInfosToClient(listData: any[], isRootEntity: boolean): Observable<any[]> {\r\n    if (isRootEntity === true) {\r\n      const entities = this.befReposi.buildEntities(listData);\r\n      this.befReposi.entityCollection.addEntities(entities);\r\n      return of(listData);\r\n    } else {\r\n      return this.syncAttachmentInfosToClient().pipe(\r\n        map(() => {\r\n          return listData;\r\n        })\r\n      );\r\n    }\r\n  }\r\n\r\n}\r\n\r\nexport { BusinessAttachmentDataService };\r\n","import { Observable, EMPTY, forkJoin, of } from 'rxjs';\r\nimport { tap, switchMap, map, filter, take } from 'rxjs/operators';\r\n// import { cloneDeep } from 'lodash-es';\r\nimport {\r\n  ViewModelContext, CommandContext, BindingPathConverter,\r\n  HttpRequestConfig, HttpParams, HttpHeaders, HttpMethods,\r\n  DataChangeType\r\n} from '@farris/mobile-devkit';\r\nimport { BefRepository, RequestInfo } from '@farris/mobile-bef';\r\nimport { BusinessUploadFileInfo } from './types';\r\nimport { AttachmentUtil } from './business-attachment.util';\r\nimport { BusinessAttachmentDataService } from './business-attachment-data.service';\r\nimport { EntityService } from '../entity-services/index';\r\nimport { RemoveDataService } from '../data-services/remove-data.service';\r\n\r\n\r\n/**\r\n * 附件服务\r\n */\r\nclass BusinessAttachmentService {\r\n\r\n  /**\r\n   * 默认根目录\r\n   */\r\n  private defaultRootDirId = 'default-root';\r\n\r\n  /**\r\n   * 默认子目录\r\n   */\r\n  private get defaultParentDirName(): string {\r\n    return this.viewModelContext.bindingData.list.currentId;\r\n  }\r\n\r\n  /**\r\n   * 视图模型\r\n   */\r\n  private viewModelContext: ViewModelContext;\r\n\r\n  /**\r\n   * 附件数据服务\r\n   */\r\n  private attachDataService: BusinessAttachmentDataService;\r\n\r\n  /**\r\n   * 实体服务\r\n   */\r\n  private entityService: EntityService;\r\n\r\n  /**\r\n   * 实体服务\r\n   */\r\n  private removeDataService: RemoveDataService;\r\n\r\n  /**\r\n   * 构造函数\r\n   */\r\n  constructor(\r\n    viewModelContext: ViewModelContext, entityService: EntityService,\r\n    removeDataService: RemoveDataService, attachDataService: BusinessAttachmentDataService,\r\n  ) {\r\n\r\n    this.viewModelContext = viewModelContext;\r\n    this.attachDataService = attachDataService;\r\n    this.entityService = entityService;\r\n    this.removeDataService = removeDataService;\r\n  }\r\n\r\n\r\n  /**\r\n   * 获取列表数据\r\n   */\r\n  public loadAttachmentRows(url: string, filters: any[], sorts: any[]): Observable<any> {\r\n\r\n    const attachContext = this.getAttachContext();\r\n    const befRepository = (this.viewModelContext.repository as BefRepository<any>);\r\n    const sessionService = befRepository.sessionService;\r\n    const apiProxy = befRepository.apiProxy;\r\n\r\n    // 组织params\r\n    const params: HttpParams = {};\r\n    if (typeof filters === 'string') {\r\n      filters = JSON.parse(filters);\r\n    }\r\n    if (typeof sorts === 'string') {\r\n      sorts = JSON.parse(sorts);\r\n    }\r\n\r\n    const entityFilter = {\r\n      FilterConditions: filters || null,\r\n      SortConditions: sorts || null,\r\n      IsUsePagination: false,\r\n      Pagination: {\r\n        PageIndex: 1,\r\n        PageSize: 0,\r\n        PageCount: 0,\r\n        TotalCount: 0\r\n      }\r\n    };\r\n    const entityFilterString = JSON.stringify(entityFilter);\r\n    params.entityFilter = entityFilterString;\r\n\r\n    // 组织body\r\n    const body = {\r\n      dataChange: [],\r\n      variableChange: null\r\n    }\r\n\r\n    // 赋值be的url\r\n    befRepository.apiProxy.setAssociatedUrl(url);\r\n    return this.waitForBeSession().pipe(switchMap(() => {\r\n      url = `${url}/extension/query`;\r\n      const requestConfig: HttpRequestConfig = {\r\n        headers: sessionService.extendRequestHeaders({}),\r\n        params: params,\r\n        body\r\n      };\r\n\r\n      const query$ = apiProxy.httpClient.request(HttpMethods.PUT, url, requestConfig).pipe(\r\n        map((result) => {\r\n          const attachListData = result.returnValue.result;\r\n          // 赋值当前所有数据\r\n          attachContext.setData(JSON.parse(JSON.stringify(attachListData)));\r\n          // 赋值缓存起来\r\n          attachContext.updateData(JSON.parse(JSON.stringify(attachListData)));\r\n          return attachListData;\r\n        })\r\n      );\r\n\r\n      return query$;\r\n    }));\r\n  }\r\n\r\n  private waitForBeSession(): Observable<boolean> {\r\n    const befRepository = this.viewModelContext.repository as BefRepository<any>;\r\n    const sessionService = befRepository.sessionService;\r\n    return sessionService.getBeSessionExisted().pipe(\r\n      filter((beSessionExisted: boolean) => {\r\n        return beSessionExisted === true;\r\n      }),\r\n      take(1)\r\n    );\r\n  }\r\n  /**\r\n   * 同步变更\r\n   */\r\n  public syncAttachmentRowChanges(url: string): Observable<any> {\r\n    const attachContext = this.getAttachContext() || {};\r\n\r\n    const changeDetails = AttachmentUtil.getChangeDetails(attachContext.oldListData, attachContext.listData);\r\n    if (!changeDetails || changeDetails.length === 0) {\r\n      return of(false);\r\n    }\r\n    const changedRowId = changeDetails[0].ChangeInfo.DataId;\r\n    const requestInfo: RequestInfo = {\r\n      dataChange: changeDetails,\r\n      variableChange: null\r\n    }\r\n    const requestConfig: HttpRequestConfig = {\r\n      body: requestInfo\r\n    };\r\n\r\n    const apiProxy = (this.viewModelContext.repository as BefRepository<any>).apiProxy;\r\n    url = `${url}/extension/retrieve/${changedRowId}`;\r\n    return apiProxy.request(HttpMethods.PUT, url, requestConfig, true).pipe(\r\n      map((e) => {\r\n        const context = attachContext.context;\r\n        const data = context.getData();\r\n        // goBack之后  更新缓存后的值\r\n        context.updateData(JSON.parse(JSON.stringify(data)));\r\n        return e;\r\n      })\r\n    );\r\n  }\r\n  /**\r\n   * 上传单个文件\r\n   * @param attachmentIdPath 附件内码字段的路径，形如/attachInfo/attachmentId；\r\n   * @param attachmentNamePath 附件名称字段的路径\r\n   */\r\n  public uploadAndUpdateRow(attachmentInfoFieldPath: string, rootDirId?: string, parentDirName?: string): Observable<any> {\r\n    const rootId = rootDirId ? rootDirId : this.defaultRootDirId;\r\n    const formId = parentDirName ? parentDirName : this.defaultParentDirName;\r\n    if (!rootId || !formId) {\r\n      throw new Error('rootDirId和parentDirName不能为空，请填写');\r\n    }\r\n\r\n    const fileInfos = this.getUploadFileInfosFromContext();\r\n    const attachmentInfos = AttachmentUtil.convertToAttachmentInfos(fileInfos);\r\n    if (!attachmentInfos || attachmentInfos.length === 0) {\r\n      alert('请先上传附件');\r\n      return EMPTY;\r\n    }\r\n\r\n    // 更新服务器端\r\n    console.log('show loading ...');\r\n    const firstAttachmentInfo = AttachmentUtil.getFirstAttachmentInfo(attachmentInfos);\r\n    const result$ = this.attachDataService.updateRow(attachmentInfoFieldPath, firstAttachmentInfo).pipe(\r\n      tap(() => {\r\n        console.log('hide loading ...');\r\n      })\r\n    );\r\n    return result$;\r\n  }\r\n\r\n  /**\r\n   * 上传多个文件\r\n   */\r\n  public uploadAndBatchAddRows(url: string, attachmentInfoFieldPath: string): Observable<any> {\r\n    const commandContext = this['context'] as CommandContext;\r\n    // 附件相关信息\r\n    const rootDirId = commandContext.eventParams.rootId;\r\n    const parentDirName = commandContext.eventParams.parentDirName;\r\n    const rootId = rootDirId ? rootDirId : this.defaultRootDirId;\r\n    const formId = parentDirName ? parentDirName : this.defaultParentDirName;\r\n    if (!rootId || !formId) {\r\n      throw new Error('rootDirId和parentDirName不能为空，请填写');\r\n    }\r\n    const context = commandContext.eventParams.context;\r\n    const fileInfos = this.getUploadFileInfosFromContext();\r\n    const attachmentInfos = AttachmentUtil.convertToAttachmentInfos(fileInfos);\r\n    if (!attachmentInfos || attachmentInfos.length === 0) {\r\n      alert('请先上传附件');\r\n      return EMPTY;\r\n    }\r\n    // 更新服务器端\r\n    const uploadUrl = `${url}/service/batchuploadattachment`;\r\n    return this.attachDataService.updateRows(uploadUrl, attachmentInfoFieldPath, attachmentInfos).pipe(\r\n      map(e => {\r\n        // 追加数据\r\n        context.appendData(e);\r\n        const dataIds = this.getDataIdsToRemove(context, attachmentInfoFieldPath);\r\n\r\n        dataIds.forEach(dataId => {\r\n          // 添加标记\r\n          this.viewModelContext.repository.dataChangeHistory.addChange({ fPath: '', dataId: dataId, changeType: DataChangeType.Add });\r\n        });\r\n        return e;\r\n      })\r\n    );\r\n  }\r\n\r\n  /**\r\n   * 批量删除附件所在的行\r\n   */\r\n  public removeAttachmentRows(url: string, attachmentInfoFieldPath: string): Observable<any> {\r\n    const context = this['context'].eventParams.context;\r\n    if (!attachmentInfoFieldPath) {\r\n      return EMPTY;\r\n    }\r\n    const dataIds = this.getDataIdsToRemove(context, attachmentInfoFieldPath);\r\n    // 如果是主表\r\n    if (attachmentInfoFieldPath.split('/').length <= 2) {\r\n      const removeUrl = `${url}/extension/batchdelete`;\r\n      return this.removeDataService.removeByBusinessIds(removeUrl, dataIds).pipe(\r\n        map((e) => {\r\n          dataIds.forEach(dataId => {\r\n            context.removeDataById(dataId);\r\n            // 添加标记\r\n            this.viewModelContext.repository.dataChangeHistory.addChange({ fPath: '', dataId: dataId, changeType: DataChangeType.Delete });\r\n          });\r\n        })\r\n      );\r\n    } else {\r\n      // 如果是子表\r\n      const removeObservables: Observable<any>[] = [];\r\n      if (dataIds.length === 0) {\r\n        alert('请选择要删除的文件');\r\n      }\r\n      const bindingListPath = this.getBindingListPathWithAttachments(attachmentInfoFieldPath);\r\n      dataIds.forEach((dataId: string) => {\r\n        const removeObservable = this.removeDataService.removeByBusinessPathAndId(url, bindingListPath, dataId);\r\n        removeObservables.push(removeObservable);\r\n      });\r\n      return forkJoin(removeObservables).pipe(\r\n        map((e) => {\r\n          console.log(e);\r\n          return e;\r\n        }));\r\n    }\r\n  }\r\n\r\n  // #region 工具方法\r\n  /**\r\n   * 从上下文中中获取控件传递的附件信息\r\n   */\r\n  private getUploadFileInfosFromContext(): BusinessUploadFileInfo[] {\r\n    const commandContext = this['context'] as CommandContext;\r\n    const uploadFileInfos = commandContext.eventParams.data as BusinessUploadFileInfo[];\r\n    if (!uploadFileInfos) {\r\n      return [];\r\n    }\r\n    return uploadFileInfos;\r\n  }\r\n\r\n  /**\r\n   * 获取要删除的附件对应的数据id数组\r\n   */\r\n  public getDataIdsToRemove(context: any, attachmentInfoFieldPath: string) {\r\n    const attachIds = this.getAttachmentIdsToRemoveFromContext();\r\n    const dataIds: string[] = [];\r\n    attachIds.forEach((attachId: string) => {\r\n\r\n      // 上传删除和预览删除传递过来的fileId的key可能不一致，要做兼容\r\n      const dataId = this.convertAttachmentIdToDataId(context, attachId, attachmentInfoFieldPath);\r\n      dataIds.push(dataId);\r\n    });\r\n    return dataIds;\r\n  }\r\n\r\n  /**\r\n   * 从命令上下文中获取要删除附件ids\r\n   */\r\n  public getAttachmentIdsToRemoveFromContext() {\r\n    const commandContext = this['context'] as CommandContext;\r\n    return commandContext.eventParams.data.map(dataItem => {\r\n      return Object.prototype.toString.call(dataItem) === '[object Object]' ? dataItem.metadataId : dataItem;\r\n    });\r\n    // return commandContext.eventParams.data as string[];\r\n  }\r\n\r\n  /**\r\n   * 根据路径获取附件字段值数组\r\n   * @param fieldPath 字段路径\r\n   */\r\n  private convertAttachmentIdToDataId(context: any, fileId: string, attachmentInfoFieldPath: string): string {\r\n\r\n    // 解析路径\r\n    const attachInfoBindingPath = BindingPathConverter.toBindingPathArray(attachmentInfoFieldPath);\r\n    const attachFieldName = attachInfoBindingPath.pop();\r\n    const attachListBindingPath = attachInfoBindingPath;\r\n\r\n    // 获取附件id数组\r\n    // const entityListData = this.entityService.getEntityListData(attachListBindingPath);\r\n    const entityListData = context.data;\r\n    const targetEntityData = entityListData.find((entityData: any) => {\r\n      if (entityData[attachFieldName]) {\r\n        const attachmentId = entityData[attachFieldName]['attachmentId'];\r\n        if (attachmentId === fileId) {\r\n          return true;\r\n        }\r\n      }\r\n    });\r\n\r\n    return targetEntityData.id;\r\n  }\r\n\r\n  /**\r\n   * 获取带附件的BindingList的Path\r\n   */\r\n  private getBindingListPathWithAttachments(attachmentInfoFieldPath: string) {\r\n    const attachInfoBindingPath = BindingPathConverter.toBindingPathArray(attachmentInfoFieldPath);\r\n    attachInfoBindingPath.pop();\r\n    const bindingListPath = attachInfoBindingPath;\r\n    return '/' + bindingListPath.join('/');\r\n  }\r\n\r\n  /**\r\n   * 获取附件组件上下文\r\n   */\r\n  private getAttachContext(): any {\r\n    const commandContext = this['context'] as CommandContext;\r\n    const attachContext = commandContext && commandContext.eventParams ? commandContext.eventParams : {};\r\n    return attachContext;\r\n  }\r\n\r\n  // #endregion\r\n\r\n}\r\n\r\nexport { BusinessAttachmentService };\r\n","import { Observable, of, EMPTY } from 'rxjs';\r\nimport { tap } from 'rxjs/operators';\r\nimport { HttpClient, ViewModelContext } from '@farris/mobile-devkit';\r\nimport { LoadingService } from '../ui-services/index';\r\n\r\n\r\nexport class DiscussionGroupService {\r\n    constructor(\r\n        private httpSvc: HttpClient,\r\n        private viewModelContext: ViewModelContext,\r\n        private loadingService: LoadingService,\r\n    ) {\r\n    }\r\n\r\n    private get params() {\r\n        return this['context'] && this['context']['eventParams'] || {};\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param id 表单id\r\n     * @param summary 消息描述\r\n     * @param configId 消息配置id\r\n     * @param text 评论内容\r\n     * @param visibility 是否所有人可见(移动暂未支持)\r\n     * @param parentId 是否是回复信息\r\n     * @returns \r\n     */\r\n    public addComment(id?: string, summary?: string, configId?: string, text?: string, visibility?: string, parentId?: string): Observable<any> {\r\n        id = id || this.viewModelContext && this.viewModelContext.bindingData.list.currentId || null;\r\n        if (!id) {\r\n            return EMPTY;\r\n        }\r\n\r\n        const url = '/api/runtime/comment/v1.0/bill-comment/comment';\r\n        const body = this.buildAddCommentParam(id, text, parentId, summary, visibility, configId);\r\n        this.loadingService.show()\r\n        return this.httpSvc.post(url, body, {}).pipe(\r\n            tap(() => {\r\n                this.loadingService.hide()\r\n            })\r\n        )\r\n    }\r\n\r\n    private buildAddCommentParam(id: string, text: string, parentId: string, summary: string, visibility: string, configId: string) {\r\n        if (typeof text === 'undefined') {\r\n            text = this.params.text;\r\n        }\r\n        if (typeof parentId === 'undefined') {\r\n            parentId = this.params.replyUser && this.params.replyUser.id;\r\n        }\r\n        if (typeof visibility === 'undefined') {\r\n            visibility = this.params.visibility || 'ALL';\r\n        }\r\n        return {\r\n            'bill': {\r\n                'billId': id,\r\n                'configId': configId,\r\n                'summary': summary\r\n            },\r\n            'comment': {\r\n                'billId': id,\r\n                'configId': configId,\r\n                'parentId': parentId || null,\r\n                'text': text,\r\n                'visibility': visibility\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param id 表单id\r\n     * @param configId 消息配置id\r\n     * @param pageIndex \r\n     * @param pageSize \r\n     * @returns \r\n     */\r\n    public queryComments(id: string, configId: string, pageIndex?: number | null, pageSize?: number | null): Observable<any> {\r\n        id = id || this.viewModelContext && this.viewModelContext.bindingData.list.currentId || null;\r\n        if (!id) {\r\n            return EMPTY;\r\n        }\r\n\r\n        const url = this.buildQueryCommentsUrl(id, pageIndex, pageSize, configId);\r\n        this.loadingService.show()\r\n        return this.httpSvc.get(url, {}).pipe(\r\n            tap((e) => {\r\n                this.loadingService.hide()\r\n                this.viewModelContext.uiState.setPropertyValue('discussionListData', e);\r\n            })\r\n        )\r\n    }\r\n\r\n    private buildQueryCommentsUrl(id: string, pageIndex: number | null, pageSize: number | null, configId: string) {\r\n        if (typeof pageIndex === 'undefined' || pageIndex === null) {\r\n            pageIndex = this.params.pageIndex || 0;\r\n        }\r\n        if (typeof pageSize === 'undefined' || pageSize === null) {\r\n            pageSize = this.params.pageSize || 999;\r\n        }\r\n        return `/api/runtime/comment/v1.0/bill-comment/comment/byBill?configId=${configId}&billId=${id}&pageSize=${pageSize}&pageIndex=${pageIndex}`;\r\n    }\r\n\r\n\r\n    /**\r\n     * 回复赋值\r\n     */\r\n    public setReplyUser() {\r\n        this.viewModelContext.uiState.setPropertyValue('replyUser', this.params);\r\n    }\r\n\r\n    public queryFrequentAtUsers(pageIndex?: number | null, pageSize?: number | null) {\r\n        const params: string[] = [];\r\n        params.push(`pageSize=${pageSize || 20}`);\r\n        params.push(`pageIndex=${pageIndex || 0}`);\r\n        const url = `/api/runtime/comment/v1.0/bill-comment/frequentAtUsers?${params.join('&')}`;\r\n        this.loadingService.show()\r\n        return this.httpSvc.get(url, {}).pipe(\r\n            tap((e) => {\r\n                this.loadingService.hide()\r\n                const personnelsData = {\r\n                    pageInfo: {\r\n                        pageSize: e.pageSize,\r\n                        pageIndex: e.pageIndex\r\n                    },\r\n                    total: e.totalCount,\r\n                    items: e.users\r\n                }\r\n                this.viewModelContext.uiState.setPropertyValue('personnelsData', personnelsData);\r\n            })\r\n        )\r\n    }\r\n\r\n    public queryAtUsers(user?: string, pageIndex?: number | null, pageSize?: number | null) {\r\n        const params: string[] = [];\r\n        if (user) {\r\n            params.push(`param=${user}`);\r\n        }\r\n        params.push(`pageSize=${pageSize || 100}`);\r\n        params.push(`pageIndex=${pageIndex || 0}`);\r\n        const url = `/api/runtime/comment/v1.0/bill-comment/atUser?${params.join('&')}`;\r\n        this.loadingService.show()\r\n        return this.httpSvc.get(url, {}).pipe(\r\n            tap((e) => {\r\n                this.loadingService.hide()\r\n                const personnelsData = {\r\n                    pageInfo: {\r\n                        pageSize: e.pageSize,\r\n                        pageIndex: e.pageIndex\r\n                    },\r\n                    total: e.totalCount,\r\n                    items: e.users\r\n                }\r\n                this.viewModelContext.uiState.setPropertyValue('personnelsData', personnelsData);\r\n            })\r\n        )\r\n    }\r\n}\r\n","import { Observable } from 'rxjs';\r\nimport { HttpClient } from '@farris/mobile-devkit';\r\nimport { CancelSubmitPayload } from '../entity/start-process-payload';\r\n\r\n\r\n\r\nexport class TaskService {\r\n\r\n    constructor(\r\n        private httpSvc: HttpClient,\r\n    ) { }\r\n\r\n    error(error: any, actionCode?: string) {\r\n        if (error && error.error && error.error.Message) {\r\n            var message = error.error.Message;\r\n            if (actionCode) {\r\n                message = actionCode + \"操作失败:\" + message;\r\n            }\r\n            return message;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 启动流程预解析\r\n     * @param payload API所需的上下文参数\r\n     */\r\n    startProcessSimulate(payload: any): Observable<any> {\r\n        const url = `/api/runtime/wf/v1.0/processInstances/startProcess-simulation`;\r\n        return this.httpSvc.post(url, payload, {});\r\n    }\r\n\r\n    /**\r\n     * 启动流程接口\r\n     * @param payload API所需的上下文参数\r\n     */\r\n    startProcess(payload: any): Observable<any> {\r\n        const url = `/api/runtime/wf/v1.0/processInstances/startProcess`;\r\n        return this.httpSvc.post(url, payload, {});\r\n    }\r\n\r\n    /**\r\n     * 取消提交\r\n     * @param param 参数\r\n     */\r\n    cancelSubmit(param: CancelSubmitPayload): Observable<any> {\r\n        const url = `/api/runtime/wf/v1.0/processInstances/cancelSubmit`;\r\n        return this.httpSvc.post(url, param, {});\r\n    }\r\n\r\n}\r\n","import { AssigneeInfo } from './complete-response';\r\nimport { User } from './user';\r\n\r\n/**\r\n * 提交审批上下文参数\r\n */\r\nexport class StartProcessPayload {\r\n\r\n    /**\r\n     * 随机生成的ID 无意义\r\n     */\r\n    id: string;\r\n\r\n    /**\r\n     * 流程定义ID\r\n     */\r\n    processDefinitionId: string;\r\n\r\n    /**\r\n     * 流程定义Key\r\n     */\r\n    processDefinitionKey: string;\r\n\r\n    /**\r\n     * 入口单据ID\r\n     */\r\n    bizDefKey: string;\r\n\r\n    /**\r\n     * 数据模型ID（BE上的节点ID）\r\n     */\r\n    dataModelId: string;\r\n\r\n    /**\r\n     * 单据内码\r\n     */\r\n    dataId: string;\r\n\r\n    /**\r\n     * 流程实例名称，可空\r\n     */\r\n    name: string;\r\n\r\n    /**\r\n     * 流程发起人\r\n     */\r\n    startUserId: string;\r\n\r\n    /**\r\n     * 下一环节\r\n     */\r\n    nextFlowNodes: FlowNodeInfo[];\r\n\r\n    /**\r\n     * 参数\r\n     */\r\n    variables: any;\r\n\r\n}\r\n\r\nexport class FlowNodeInfo {\r\n\r\n    activityDefinitionId: string;\r\n\r\n    activityDefinitionName: string;\r\n\r\n    dependency: string;//前置依赖，执行提交时传给后端\r\n\r\n    selectedAssignees: User[];\r\n\r\n    assigneeInfo: AssigneeInfo;\r\n\r\n    resolved: boolean;//参与者是否解析\r\n\r\n    anonymous: boolean;\r\n\r\n    anonymousText: string;\r\n\r\n}\r\n\r\nexport class Assignee {\r\n\r\n    id: string;\r\n\r\n    name: string;\r\n    \r\n}\r\n\r\nexport class CancelSubmitPayload {\r\n\r\n    procInstId: string;//可以单独根据流程实例ID取消\r\n\r\n    dataId: string;//也可以根据dataId+bizDefKey取消\r\n\r\n    bizDefKey: string;\r\n    \r\n}","\r\nimport { Subject } from 'rxjs';\r\n\r\nimport { StartProcessPayload, FlowNodeInfo } from '../../entity/start-process-payload';\r\nimport { SimulateResponse, SimulationPath } from '../../entity/simulate-response';\r\n\r\nimport { TaskService } from '../../service/task.service';\r\nimport { SubmitApprove } from '@farris/mobile-business-ui';\r\n\r\n\r\nexport class ProcessSelectorService {\r\n\r\n  constructor(\r\n    private taskService: TaskService\r\n  ) { }\r\n\r\n  destProcesses: { id: string, name: string }[];//候选流程\r\n  destNodes: { id: string, name: string }[];//候选下一环节\r\n\r\n  processPlaceholder: string = '选择流程';//选择流程placeholder\r\n  nodePlaceholder: string;//选择下一环节placeholder\r\n  response: SimulateResponse;//保存模拟流程后返回的内容，选择节点时使用\r\n\r\n  assignInfos = [];\r\n\r\n  selectedProcessId: string;//选择的流程定义ID\r\n  selectedNodeId: string; //选择的下一环节ID，后续环节id的拼接\r\n\r\n  selectedValues = ['clear'];\r\n\r\n  payload = new StartProcessPayload;//保存表单上传来的payload\r\n  subject = new Subject();\r\n  processReadOnly: boolean = false;//选择流程框是否只读\r\n  nodeReadOnly: boolean = true;//选择节点下拉框是否只读\r\n\r\n  vm: any;//弹框实例\r\n\r\n  setParam(param: StartProcessPayload) {\r\n    this.payload.id = param.id;\r\n    this.payload.processDefinitionId = param.processDefinitionId;\r\n    this.payload.processDefinitionKey = param.processDefinitionKey;\r\n    this.payload.bizDefKey = param.bizDefKey;\r\n    this.payload.dataModelId = param.dataModelId;\r\n    this.payload.dataId = param.dataId;\r\n    this.payload.name = param.name;\r\n    this.payload.startUserId = param.startUserId;\r\n    this.payload.nextFlowNodes = [];\r\n    this.startProcessSimulate(this.payload);\r\n  }\r\n\r\n  startProcessSimulate(payload: StartProcessPayload) {\r\n    this.taskService.startProcessSimulate(payload).subscribe((response: SimulateResponse) => {\r\n      this.destProcesses = response.procDefs.map(process => ({ id: process.procDefId, name: process.procDefName }));\r\n      if (this.destProcesses.length === 1) {\r\n        this.processReadOnly = true;\r\n        this.selectedProcessId = response.procDefs[0].procDefId;\r\n        this.vm = (SubmitApprove as any).confirm(\r\n          {\r\n            process: this.selectedProcessId,\r\n            processData: this.destProcesses,\r\n            processOc: this.selectProcessChange.bind(this),\r\n            processReadFlag: this.processReadOnly,\r\n            processHolder: this.processPlaceholder,\r\n            nextNodeReadFlag: this.nodeReadOnly,\r\n            submit: this.submit.bind(this),\r\n            cancel: this.back.bind(this)\r\n          }\r\n        )\r\n        this.response = response;\r\n        this.setNextNode(response);\r\n      } else {\r\n        this.vm = (SubmitApprove as any).confirm(\r\n          {\r\n            processData: this.destProcesses,\r\n            processOc: this.selectProcessChange.bind(this),\r\n            processReadFlag: this.processReadOnly,\r\n            processHolder: this.processPlaceholder,\r\n            nextNodeReadFlag: this.nodeReadOnly,\r\n            submit: this.submit.bind(this),\r\n            cancel: this.back.bind(this)\r\n          }\r\n        )\r\n      }\r\n    }, error => {\r\n      this.subject.next({ type: 'error', message: error && error.response && error.response.data && error.response.data.Message || '提交失败' });\r\n    })\r\n  }\r\n\r\n  /**\r\n * 选择某个流程后\r\n * @param data\r\n */\r\n  selectProcessChange(data: any) {\r\n    this.clearHelp();\r\n    this.clearNode();\r\n    this.selectedProcessId = data;\r\n\r\n    var payload = new StartProcessPayload();\r\n    payload.processDefinitionId = this.selectedProcessId;\r\n    payload.dataId = this.payload.dataId;\r\n\r\n    // const load = this.loadingService.show();\r\n    this.taskService.startProcessSimulate(payload).subscribe((response: SimulateResponse) => {\r\n      // load.close();\r\n      this.response = response;\r\n      this.setNextNode(response);\r\n    }, error => {\r\n      //load.close();\r\n      this.subject.next({ type: 'error', message: error && error.response && error.response.data && error.response.data.Message || '该流程存在问题' });\r\n    })\r\n  }\r\n\r\n\r\n  getsimulationPathsIndexData(data) {\r\n    return this.destNodes.findIndex(item => item.id === data)\r\n  }\r\n\r\n  /**\r\n * 选择节点后事件\r\n */\r\n  selectNodeChange(data: any) {\r\n    this.clearHelp();\r\n    this.clearAssignInfos();\r\n    this.selectedNodeId = data;\r\n    this.vm.open({\r\n      nextNode: this.selectedNodeId,\r\n    })\r\n    //const nodeNames = data.data.name.split('，');\r\n    const index = this.getsimulationPathsIndexData(data);\r\n    if (this.response.simulationPaths[index].nodeInfoList.every(node => node.resolved === true)) {//已预解析参与者\r\n      this.setAssignInfo(this.response.simulationPaths[index]);\r\n    } else {//未预解析参与者\r\n      let payload = new StartProcessPayload();\r\n      payload.processDefinitionId = this.selectedProcessId;\r\n      payload.dataId = this.payload.dataId;\r\n      payload.nextFlowNodes = [];\r\n\r\n      this.selectedNodeId.split('，').forEach((nodeId, index) => {\r\n        let nextFlowNode = new FlowNodeInfo();\r\n        nextFlowNode.activityDefinitionId = nodeId;\r\n        //nextFlowNode.activityDefinitionName = nodeNames[index];\r\n        payload.nextFlowNodes.push(nextFlowNode);\r\n      });\r\n\r\n      //const load = this.loadingService.show();\r\n      this.taskService.startProcessSimulate(payload).subscribe((response: SimulateResponse) => {\r\n        //load.close();\r\n        this.setAssignInfo(response.simulationPaths[0]);//选择的下一环节应该在同一条路径上，故取simulationPaths[0]\r\n      }, error => {\r\n        //load.close();\r\n        this.subject.next({ type: 'error', message: error && error.response && error.response.data && error.response.data.Message || '该节点存在问题' });\r\n      })\r\n    }\r\n  }\r\n\r\n  /**\r\n * 设置下一环节\r\n */\r\n  private setNextNode(response: SimulateResponse) {\r\n    this.destNodes = response.simulationPaths && response.simulationPaths.map(path => ({\r\n      id: path.nodeInfoList.map(node => node.activityDefinitionId).join('，'),\r\n      name: path.nodeInfoList.map(node => node.activityDefinitionName).join('，')\r\n    }));\r\n    //处理默认分支，无默认分支返回-1\r\n    const defaultIndex = response.simulationPaths.findIndex(a => a.default);\r\n    if (defaultIndex > -1) {\r\n      this.destNodes.length === 1 ? (this.nodeReadOnly = true) : (this.nodeReadOnly = false);\r\n      this.selectedNodeId = this.destNodes[defaultIndex].id;\r\n      this.setAssignInfo(response.simulationPaths[defaultIndex]);\r\n    } else {\r\n      this.selectedNodeId = '';\r\n      this.nodeReadOnly = false;\r\n      this.nodePlaceholder = '请选择';\r\n    }\r\n    this.vm.open({\r\n      nextNodeOc: this.selectNodeChange.bind(this),\r\n      nextNode: this.selectedNodeId,\r\n      nextNodeData: this.destNodes,\r\n      nextNodeReadFlag: this.nodeReadOnly,\r\n      nextNodeHolder: this.nodePlaceholder\r\n    })\r\n  }\r\n\r\n  /**\r\n   * 设置当前指派信息帮助参数\r\n   */\r\n  private setAssignInfo(simulationPaths: SimulationPath) {\r\n    this.assignInfos = [];\r\n    this.selectedNodeId.split('，').forEach(nodeId => {\r\n      const node = simulationPaths.nodeInfoList.find(node => node.activityDefinitionId === nodeId);\r\n      if (node) {\r\n        const selectedAssignees = node.selectedAssignees;\r\n        let assigneeReadFlag = false;\r\n        let assignee = '';\r\n        let assigneeHolder = '请选择人员';\r\n        if (selectedAssignees && selectedAssignees.length >= 1) {\r\n          assigneeReadFlag = true;\r\n          assigneeHolder = \"\";\r\n          selectedAssignees.forEach(user => {\r\n            assignee = assignee + user.name + ', ';\r\n          })\r\n          assignee = assignee.slice(0, assignee.length - 2)\r\n        }\r\n        if (node.anonymous) {\r\n          assignee = node.anonymousText === '' ? '' : node.anonymousText && node.anonymousText\r\n        }\r\n        this.assignInfos.push({\r\n          label: `${this.selectedNodeId && this.selectedNodeId.split('，').length > 1 ? node.activityDefinitionName : ''}办理人员`,\r\n          selectedAssignees,\r\n          assigneeReadFlag,\r\n          assignee,\r\n          assigneeHolder,\r\n          assigneeInfo: { ...node.assigneeInfo, assigneeUsers: { items: (node.assigneeInfo && node.assigneeInfo.assigneeUsers) || [] } },\r\n          assignees: node.selectedAssignees.map(user => { return { id: user.id, name: user.name } }),\r\n          activityName: node.activityDefinitionName,\r\n          dependency: node.dependency,\r\n          anonymous: node.anonymous,\r\n          anonymousText: node.anonymousText\r\n        })\r\n      } else {\r\n        this.assignInfos.push({\r\n          selectedAssignees: [],\r\n          assigneeInfo: null,\r\n          assignees: [],\r\n          activityName: '',\r\n          dependency: '',\r\n          anonymous: node.anonymous,\r\n          anonymousText: node.anonymousText\r\n        })\r\n      }\r\n    })\r\n    this.vm.open({\r\n      assigneeOc: this.assigneeOc.bind(this),\r\n      assignInfos: this.assignInfos\r\n    })\r\n  }\r\n\r\n  // 办理人员选择事件\r\n  assigneeOc(data: any, index: number) {\r\n    this.assignInfos[index].assignees = data.items;\r\n    this.selectedValues[index] = data.value;\r\n    this.vm.open({\r\n      selectedValues: this.selectedValues\r\n    })\r\n  }\r\n\r\n  clearHelp() {\r\n    this.vm.open({\r\n      selectedValues: ['clear']\r\n    })\r\n  }\r\n\r\n  // 清空节点\r\n  clearNode() {\r\n    this.selectedNodeId = '',\r\n      this.destNodes = [],\r\n      this.nodeReadOnly = true,\r\n      this.nodePlaceholder = '',\r\n      this.assignInfos = [];\r\n    this.vm.open({\r\n      nextNode: this.selectedNodeId,\r\n      nextNodeData: this.destNodes,\r\n      nextNodeReadFlag: this.nodeReadOnly,\r\n      nodePlaceholder: this.nodePlaceholder,\r\n      assignInfos: this.assignInfos\r\n    })\r\n  }\r\n\r\n  // 清空办理人员\r\n  clearAssignInfos() {\r\n    this.assignInfos = [];\r\n    this.vm.open({\r\n      assignInfos: this.assignInfos\r\n    })\r\n  }\r\n\r\n  /**\r\n   * 取消页面弹框\r\n   */\r\n  back() {\r\n    this.clearProcess();\r\n    this.subject.next({ type: 'success', message: '' });\r\n  }\r\n\r\n  submit() {\r\n    if (!this.selectedProcessId) {\r\n      this.subject.next({ type: 'error', message: '请选流程' });\r\n      return;\r\n    }\r\n    if (!this.selectedNodeId) {\r\n      this.subject.next({ type: 'error', message: '请选节点' });\r\n      return;\r\n    }\r\n    if (this.assignInfos.filter(info => ((info.assigneeInfo && info.assigneeInfo.assigneeUsers.items.length) || info.selectedAssignees.length) && !info.assignees.length).length) {\r\n      this.subject.next({ type: 'error', message: '请选办理人员' });\r\n      return;\r\n    }\r\n    const nodes: string[] = this.selectedNodeId.split('，');\r\n    for (let i = 0; i < nodes.length; i++) {\r\n      let nextFlowNode: FlowNodeInfo = {\r\n        activityDefinitionId: nodes[i],\r\n        activityDefinitionName: this.assignInfos[i].activityName,\r\n        dependency: this.assignInfos[i].dependency,\r\n        selectedAssignees: this.assignInfos[i].assigneeInfo ? this.assignInfos[i].assignees : [],\r\n        assigneeInfo: null,\r\n        resolved: false,\r\n        anonymous: false,\r\n        anonymousText: ''\r\n      }\r\n      this.payload.nextFlowNodes.push(nextFlowNode);\r\n    }\r\n    this.payload.processDefinitionId = this.selectedProcessId;\r\n    this.taskService.startProcess(this.payload).subscribe(() => {\r\n      this.clearProcess();\r\n      this.subject.next({ type: 'success', message: '提交成功' });\r\n    }, (error) => {\r\n      this.subject.next({ type: 'error', message: error && error.response && error.response.data && error.response.data.Message || '提交失败' });\r\n    })\r\n  }\r\n\r\n  getSubject() {\r\n    return this.subject.asObservable();\r\n  }\r\n\r\n  clearProcess() {\r\n    this.vm.close();\r\n    this.vm = null;\r\n    this.selectedProcessId = ''\r\n    this.selectedNodeId = ''\r\n    this.processReadOnly = false;\r\n    this.nodeReadOnly= true;\r\n  }\r\n}\r\n","import { Observable, Subject, of } from 'rxjs';\r\nimport { TaskService } from './service/task.service';\r\nimport { StartProcessPayload, CancelSubmitPayload } from './entity/start-process-payload';\r\nimport { ProcessSelectorService } from './submit/process-selector-vue/process-selector.service'\r\n\r\nimport { LoadingService, NotifyService } from '../ui-services/index';\r\ninterface Response { type: string, message: string };\r\n\r\nexport class WfTaskHandlerService {\r\n\r\n  subject = new Subject<any>();\r\n\r\n  constructor(\r\n    private processSelectorService: ProcessSelectorService,\r\n    private taskService: TaskService,\r\n    private loadingService: LoadingService,\r\n    private notifyService: NotifyService\r\n  ) { }\r\n\r\n  /**\r\n   * 提交审批\r\n   * @param payload 上下文参数\r\n   */\r\n  startProcess(payload: StartProcessPayload): Observable<any> {\r\n    const subject = new Subject();\r\n    this.processSelectorService.setParam(payload);\r\n    this.processSelectorService.getSubject().subscribe(\r\n      (response: Response) => {\r\n        if (response.type === 'success') {\r\n          if (response.message) {\r\n            this.notifyService.success(response.message);\r\n            subject.next(true)\r\n          }\r\n        } else if (response.type === 'error') {\r\n          subject.next(false)\r\n          this.notifyService.error(response.message);\r\n        }\r\n      },\r\n      () => {\r\n        this.loadingService.hide();\r\n      })\r\n    return subject.asObservable();\r\n  }\r\n\r\n  /**\r\n   * 取消提交\r\n   * @payload payload 参数\r\n   */\r\n  cancelSubmit(payload: CancelSubmitPayload): Observable<any> {\r\n    const subject = new Subject();\r\n    this.loadingService.show();\r\n    this.taskService.cancelSubmit(payload).subscribe(re => {\r\n      subject.next(true);\r\n      this.loadingService.hide();\r\n      this.notifyService.success('取消提交成功');\r\n    }, error => {\r\n      subject.next(false);\r\n      this.loadingService.hide();\r\n      this.notifyService.error(error && error.response && error.response.data && error.response.data.Message || '取消提交失败');\r\n    })\r\n    return subject.asObservable();\r\n  }\r\n\r\n  /**\r\n * 提交审批\r\n * @param dataId 表单id\r\n * @param bizDefKey 入口单据id\r\n */\r\n  submitWithBizDefKey(dataId: string, bizDefKey: string): Observable<any> {\r\n    if (!dataId) {\r\n      this.notifyService.error('表单id不能为空');\r\n      return;\r\n    }\r\n    if (!bizDefKey) {\r\n      this.notifyService.error('入口单据Id不能为空');\r\n      return;\r\n    }\r\n    var startProcessPayload = new StartProcessPayload();\r\n    startProcessPayload.dataId = dataId;\r\n    startProcessPayload.bizDefKey = bizDefKey;\r\n    return this.startProcess(startProcessPayload);\r\n  }\r\n\r\n  /**\r\n   * 取消提交审批\r\n   * @param dataId 表单id\r\n   * @param bizDefKey 入口单据id\r\n   */\r\n  cancelSubmitWithDataId(dataId: string, bizDefKey: string): Observable<any> {\r\n    if (!dataId) {\r\n      this.notifyService.error('表单id不能为空');\r\n      return;\r\n    }\r\n    if (!bizDefKey) {\r\n      this.notifyService.error('入口单据Id不能为空');\r\n      return;\r\n    }\r\n    var cancelSubmitPayload = new CancelSubmitPayload();\r\n    cancelSubmitPayload.dataId = dataId;\r\n    cancelSubmitPayload.bizDefKey = bizDefKey;\r\n    return this.cancelSubmit(cancelSubmitPayload);\r\n  }\r\n\r\n  /**\r\n   * 批量提交审批\r\n   * @param dataIds 表单ID集合\r\n   * @param bizDefKey 入口单据id\r\n   */\r\n  batchSubmitWithBizDefKey(dataIds: string[], bizDefKey: string): Observable<any> {\r\n    if (!dataIds) {\r\n      this.notifyService.error('dataId不能为空');\r\n      return;\r\n    }\r\n    if (!dataIds.length) {\r\n      this.notifyService.error('请选择数据');\r\n      return;\r\n    }\r\n    if (!bizDefKey) {\r\n      this.notifyService.error('入口单据ID不能为空');\r\n      return;\r\n    }\r\n    if (dataIds.length === 1) {\r\n      var startPayload = new StartProcessPayload()\r\n      startPayload.bizDefKey = bizDefKey;\r\n      startPayload.dataId = dataIds[0];\r\n      return this.startProcess(startPayload);\r\n    }\r\n\r\n    var successNum: number = 0;\r\n    var failedNum: number = 0;\r\n    const subject = new Subject();\r\n    this.loadingService.show();\r\n    for (var i = 0; i < dataIds.length; i++) {\r\n      var startPayload = new StartProcessPayload()\r\n      startPayload.bizDefKey = bizDefKey;\r\n      startPayload.dataId = dataIds[i];\r\n      startPayload.variables = { simulate: false };\r\n      this.taskService.startProcess(startPayload).subscribe((response: any) => {\r\n        if (response.procDefs.length > 1 || response.nextFlowNodes.length > 1) { //存在多个流程，单独提交//多个节点，单独提交\r\n          failedNum++;\r\n        } else {\r\n          successNum++;\r\n        }\r\n        if (successNum + failedNum === dataIds.length) {\r\n          this.loadingService.hide();\r\n          subject.next(true);//全部执行完再返回\r\n          this.showBatchSubmitInfo(\"submit\", successNum, failedNum);\r\n        }\r\n      }, () => {\r\n        failedNum++;\r\n        if (successNum + failedNum === dataIds.length) {\r\n          this.loadingService.hide();\r\n          subject.next(false);//全部执行完再返回\r\n          this.showBatchSubmitInfo(\"submit\", successNum, failedNum);\r\n        }\r\n      })\r\n    }\r\n    return subject.asObservable();\r\n  }\r\n\r\n\r\n  /**\r\n   * 批量取消提交审批\r\n   * @param dataIds 表单ID集合\r\n   * @param bizDefKey 入口单据id\r\n   */\r\n  batchCancelSubmitWithDataId(dataIds: string[], bizDefKey: string): Observable<any> {\r\n    if (!dataIds) {\r\n      this.notifyService.error('dataId不能为空');\r\n      return;\r\n    }\r\n    if (!dataIds.length) {\r\n      this.notifyService.error('请选择数据');\r\n      return;\r\n    }\r\n    if (!bizDefKey) {\r\n      this.notifyService.error('入口单据ID不能为空');\r\n      return;\r\n    }\r\n    const subject = new Subject();\r\n    var successNum: number = 0;\r\n    var failedNum: number = 0;\r\n    this.loadingService.show();\r\n\r\n    for (var i = 0; i < dataIds.length; i++) {\r\n      var cancelSubmitPayload = new CancelSubmitPayload();\r\n      cancelSubmitPayload.dataId = dataIds[i];\r\n      cancelSubmitPayload.bizDefKey = bizDefKey;\r\n      this.taskService.cancelSubmit(cancelSubmitPayload).subscribe(re => {\r\n        successNum++;\r\n        if (successNum + failedNum === dataIds.length) {\r\n          this.loadingService.hide();\r\n          subject.next(true);\r\n          this.showBatchSubmitInfo(\"cancel\", successNum, failedNum);\r\n        }\r\n      }, () => {\r\n        failedNum++;\r\n        if (successNum + failedNum === dataIds.length) {\r\n          this.loadingService.hide();\r\n          subject.next(false);\r\n          this.showBatchSubmitInfo(\"cancel\", successNum, failedNum);\r\n        }\r\n      })\r\n    }\r\n    return subject.asObservable();\r\n  }\r\n\r\n  /**\r\n * 子表提交审批\r\n * @param parentDataId 主表id\r\n * @param childDataId 子表id\r\n * @param bizDefKey 入口单据id\r\n */\r\n  childSubmit(parentDataId: string, childDataId: string, bizDefKey: string): Observable<any> {\r\n    if (!parentDataId || !childDataId) {\r\n      this.notifyService.error('dataId不能为空');\r\n      return;\r\n    }\r\n    if (!bizDefKey) {\r\n      this.notifyService.error('入口单据ID不能为空');\r\n      return;\r\n    }\r\n    var startProcessPayload = new StartProcessPayload();\r\n    startProcessPayload.dataId = `${parentDataId},${childDataId}`;\r\n    startProcessPayload.bizDefKey = bizDefKey;\r\n    return this.startProcess(startProcessPayload);\r\n  }\r\n\r\n  /**\r\n * 子表取消提交审批\r\n * @param parentDataId 主表id\r\n * @param childDataId 子表id\r\n * @param bizDefKey 入口单据id\r\n */\r\n  childCancelSubmit(parentDataId: string, childDataId: string, bizDefKey: string): Observable<any> {\r\n    if (!parentDataId || !childDataId) {\r\n      this.notifyService.error('dataId不能为空');\r\n      return;\r\n    }\r\n    if (!bizDefKey) {\r\n      this.notifyService.error('入口单据ID不能为空');\r\n      return;\r\n    }\r\n    var cancelSubmitPayload = new CancelSubmitPayload();\r\n    cancelSubmitPayload.dataId = `${parentDataId},${childDataId}`;\r\n    cancelSubmitPayload.bizDefKey = bizDefKey;\r\n    return this.cancelSubmit(cancelSubmitPayload);\r\n  }\r\n\r\n  /**\r\n * 子表批量提交审批\r\n * @param parentDataId 主表id\r\n * @param childDataIds 子表id集合\r\n * @param bizDefKey 入口单据id\r\n */\r\n  childBatchSubmit(parentDataId: string, childDataIds: string[], bizDefKey: string): Observable<any> {\r\n    if (!parentDataId || !childDataIds) {\r\n      this.notifyService.error('dataId不能为空');\r\n      return;\r\n    }\r\n    if (!bizDefKey) {\r\n      this.notifyService.error('入口单据ID不能为空');\r\n      return;\r\n    }\r\n    const dataIds = childDataIds.map(childDataId => `${parentDataId},${childDataId}`);\r\n    return this.batchSubmitWithBizDefKey(dataIds, bizDefKey);\r\n  }\r\n\r\n  /**\r\n * 子表批量取消提交审批\r\n * @param parentDataId 主表id\r\n * @param childDataIds 子表id集合\r\n * @param bizDefKey 入口单据id\r\n */\r\n  childBatchCancelSubmit(parentDataId: string, childDataIds: string[], bizDefKey: string): Observable<any> {\r\n    if (!parentDataId || !childDataIds) {\r\n      this.notifyService.error('dataId不能为空');\r\n      return;\r\n    }\r\n    if (!bizDefKey) {\r\n      this.notifyService.error('入口单据ID不能为空');\r\n      return;\r\n    }\r\n    const dataIds = childDataIds.map(childDataId => `${parentDataId},${childDataId}`);\r\n    return this.batchCancelSubmitWithDataId(dataIds, bizDefKey);\r\n  }\r\n\r\n  /**\r\n * 批量提交、取消提交提示信息\r\n */\r\n  private showBatchSubmitInfo(actionCode: string, successNum: number, failedNum: number) {\r\n    if (successNum && !failedNum) {//批量全部成功\r\n      actionCode === \"submit\" && this.notifyService.success('提交审批成功！');\r\n      actionCode === \"cancel\" && this.notifyService.success('取消提交成功！');\r\n    }\r\n    if (successNum && failedNum) {//批量有成功有失败\r\n      this.notifyService.warning(`操作成功${successNum}条，失败${failedNum}条!`);\r\n    }\r\n    if (!successNum && failedNum) {//批量全部失败\r\n      actionCode === \"submit\" && this.notifyService.error('提交审批失败！');\r\n      actionCode === \"cancel\" && this.notifyService.error('取消提交失败！');\r\n    }\r\n  }\r\n\r\n}\r\n","\r\nimport { ViewModelContext, HttpClient } from '@farris/mobile-devkit';\r\nimport { BE_ERROR_HANDLER__TOKEN } from '@farris/mobile-bef';\r\nimport { LoadingService, ToastService, NotifyService, DialogService,AttachmentPreviewService } from './ui-services/index';\r\nimport { ExceptionService } from './exception-services/index';\r\nimport { RouterService, ROUTER_INSTANCE_TOKEN } from './router.servcie';\r\n\r\nimport { CommandService } from './command.service';\r\nimport { StateMachineService } from './state-machine.service';\r\nimport { UIStateService } from './ui-state.service';\r\nimport { VoVariableService } from './vo-variable.service';\r\nimport { MapService } from './map-services/map.service';\r\n\r\nimport {\r\n  EntityTraversingService, EntityManipulationService, EntityAggregationService,\r\n  EntityService, EntityListService\r\n} from './entity-services/index';\r\n\r\nimport {\r\n  LoadDataService, CreateDataService, EditDataService, UpdateDataService, CheckDataService,\r\n  RemoveDataService, SaveDataService, CancelDataService, BeActionService, ApproveService\r\n} from './data-services/index';\r\n\r\nimport { AttachmentDataService, AttachmentService } from './attachment-services/index';\r\nimport { BusinessAttachmentDataService, BusinessAttachmentService } from './business-attachment-services/index';\r\n\r\nimport { TaskService } from './work-flow-service/service/task.service';\r\nimport { ProcessSelectorService } from './work-flow-service/submit/process-selector-vue/process-selector.service'\r\nimport { WfTaskHandlerService } from './work-flow-service/wf-task-handler.service'\r\nimport { CcWorkService } from './ccwork-service/ccwork.service';\r\n\r\nimport { ValidatorServices } from './validator-services';\r\nimport { JsBridgeService } from './js-bridge-service/index';\r\nimport { DiscussionGroupService } from './discussion-group-service/index';\r\n\r\n/**\r\n * 应用级Providers\r\n */\r\nconst COMMAND_SERVICES_APP_PROVIDERS = [\r\n  { provide: LoadingService, useClass: LoadingService, deps: [] },\r\n  { provide: ToastService, useClass: ToastService, deps: [] },\r\n  { provide: NotifyService, useClass: NotifyService, deps: [] },\r\n  { provide: DialogService, useClass: DialogService, deps: [] },\r\n  \r\n  { provide: ExceptionService, useClass: ExceptionService, deps: [] },\r\n  { provide: JsBridgeService, useClass: JsBridgeService, deps: [] },\r\n  { provide: BE_ERROR_HANDLER__TOKEN, useClass: ExceptionService, deps: [NotifyService, JsBridgeService] },\r\n];\r\n\r\n/**\r\n * 视图模型级Providers\r\n */\r\nconst COMMAND_SERVICES_VIEWMODEL_PROVIDERS = [\r\n  { provide: RouterService, useClass: RouterService, deps: [ViewModelContext, ROUTER_INSTANCE_TOKEN,JsBridgeService] },\r\n  { provide: CommandService, useClass: CommandService, deps: [ViewModelContext] },\r\n  { provide: EntityService, useClass: EntityService, deps: [ViewModelContext] },\r\n  { provide: StateMachineService, useClass: StateMachineService, deps: [ViewModelContext] },\r\n  { provide: UIStateService, useClass: UIStateService, deps: [ViewModelContext] },\r\n  { provide: VoVariableService, useClass: VoVariableService, deps: [ViewModelContext] },\r\n\r\n  { provide: EntityTraversingService, useClass: EntityTraversingService, deps: [ViewModelContext] },\r\n  { provide: EntityManipulationService, useClass: EntityManipulationService, deps: [ViewModelContext] },\r\n  { provide: EntityAggregationService, useClass: EntityAggregationService, deps: [ViewModelContext] },\r\n  { provide: EntityService, useClass: EntityService, deps: [ViewModelContext] },\r\n  { provide: EntityListService, useClass: EntityListService, deps: [ViewModelContext] },\r\n\r\n  { provide: LoadDataService, useClass: LoadDataService, deps: [ViewModelContext] },\r\n  { provide: CreateDataService, useClass: CreateDataService, deps: [ViewModelContext] },\r\n  { provide: EditDataService, useClass: EditDataService, deps: [ViewModelContext] },\r\n  { provide: UpdateDataService, useClass: UpdateDataService, deps: [ViewModelContext] },\r\n  { provide: RemoveDataService, useClass: RemoveDataService, deps: [ViewModelContext] },\r\n  { provide: SaveDataService, useClass: SaveDataService, deps: [ViewModelContext] },\r\n  { provide: CancelDataService, useClass: CancelDataService, deps: [ViewModelContext] },\r\n  { provide: BeActionService, useClass: BeActionService, deps: [ViewModelContext] },\r\n  { provide: CheckDataService, useClass: CheckDataService, deps: [ViewModelContext] },\r\n\r\n  { provide: ValidatorServices, useClass: ValidatorServices, deps: [ViewModelContext] },\r\n\r\n  { provide: TaskService, useClass: TaskService, deps: [HttpClient] },\r\n  { provide: ProcessSelectorService, useClass: ProcessSelectorService, deps: [TaskService] },\r\n  {\r\n    provide: WfTaskHandlerService, useClass: WfTaskHandlerService,\r\n    deps: [ProcessSelectorService, TaskService, LoadingService, NotifyService]\r\n  },\r\n  { provide: ApproveService, useClass: ApproveService, deps: [WfTaskHandlerService, ViewModelContext] },\r\n  { provide: AttachmentDataService, useClass: AttachmentDataService, deps: [ViewModelContext] },\r\n  { provide: BusinessAttachmentDataService, useClass: BusinessAttachmentDataService, deps: [ViewModelContext] },\r\n  {\r\n    provide: AttachmentService, useClass: AttachmentService,\r\n    deps: [ViewModelContext, EntityService, RemoveDataService, AttachmentDataService]\r\n  },\r\n  {\r\n    provide: BusinessAttachmentService, useClass: BusinessAttachmentService,\r\n    deps: [ViewModelContext, EntityService, RemoveDataService, BusinessAttachmentDataService]\r\n  },\r\n  { provide: CcWorkService, useClass: CcWorkService, deps: [ViewModelContext] },\r\n  { provide: MapService, useClass: MapService, deps: [ViewModelContext] },\r\n  { provide: AttachmentPreviewService, useClass: AttachmentPreviewService, deps: [ViewModelContext] },\r\n  { provide: DiscussionGroupService, useClass: DiscussionGroupService, deps: [HttpClient,ViewModelContext,LoadingService] }\r\n\r\n];\r\n\r\nexport { COMMAND_SERVICES_APP_PROVIDERS, COMMAND_SERVICES_VIEWMODEL_PROVIDERS };\r\n"],"names":["AttachmentUtil","HttpUtil"],"mappings":"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"}
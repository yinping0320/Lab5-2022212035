System.register(["@farris/mobile-ui","rxjs","@farris/mobile-business-ui","@farris/mobile-devkit","rxjs/operators","@farris/mobile-bef"],(function(t){"use strict";var e,i,n,o,r,s,a,c,d,u,p,l,h,f,v,g,y,m,w,S,I,b,C,x,P,D,B,A;return{setters:[function(t){e=t.Loading,i=t.Toast,n=t.Notify,o=t.Dialog},function(t){r=t.from,s=t.EMPTY,a=t.of,c=t.zip,d=t.Subject,u=t.forkJoin},function(t){p=t.AttachmentPreview,l=t.SubmitApprove},function(t){h=t.BindingList,f=t.HttpMethods,v=t.HttpClient,g=t.BindingPathConverter,y=t.DataChangeType,m=t.HttpUtil,w=t.ViewModelContext},function(t){S=t.tap,I=t.switchMap,b=t.map,C=t.filter,x=t.take},function(t){P=t.BefRepositoryUtil,D=t.BefDataPathUtil,B=t.BE_ERROR_HANDLER__TOKEN,A=t.ChangeDetailType}],execute:function(){var R=function(t,e){return(R=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};function M(t,e){function i(){this.constructor=t}R(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}var O=function(){return(O=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var o in e=arguments[i])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};function N(t,e){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var n,o,r=i.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(n=r.next()).done;)s.push(n.value)}catch(t){o={error:t}}finally{try{n&&!n.done&&(i=r.return)&&i.call(r)}finally{if(o)throw o.error}}return s}function k(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(N(arguments[e]));return t}t("BaseService",function(){function t(t){this.viewModelContext=t}return t.prototype.getService=function(t){return this.viewModelContext.injector.get(t)},t}());var E,T=t("LoadingService",function(){function t(){this.registerService()}return t.prototype.show=function(t,i){e.show(t,i)},t.prototype.hide=function(){e.hide()},t.prototype.registerService=function(){var t=window.DEVKIT_LOADING_SERVICE||[];t.push(this),window.DEVKIT_LOADING_SERVICE=t},t}()),F=t("ToastService",function(){function t(){}return t.prototype.info=function(t,e){i.info(t,e)},t.prototype.success=function(t,e){i.success(t,e)},t.prototype.warning=function(t,e){i.warning(t,e)},t.prototype.error=function(t,e){i.error(t,e)},t.prototype.show=function(t){i(t)},t}()),j=(E=function(){function t(){}return t.prototype.info=function(t,e){n.info(t,O({duration:1500},e))},t.prototype.success=function(t,e){n.success(t,O({duration:1e3},e))},t.prototype.warning=function(t,e){n.warning(t,O({duration:1500},e))},t.prototype.error=function(t,e){n.error(t,O({duration:1500},e))},t.prototype.show=function(t){n.show(t)},t}(),t({NotifyService:E,"ɵd":E}),E),V=t("DialogService",function(){function t(){}return t.prototype.alert=function(t,e){var i=new Promise((function(i,n){o.alert(O({title:"提醒",message:t,cancelText:"取消",confirmText:"确定",onConfirm:function(){i(!0)},onCancel:function(){i(!1)}},e))}));return r(i)},t.prototype.confirm=function(t){var e=this.confirmPromise(t);return r(e)},t.prototype.show=function(t){this.confirmPromise(t)},t.prototype.prompt=function(t,e){var i=new Promise((function(i,n){var r=o.prompt(O({title:t,confirmText:"确定",onConfirm:function(){i(r.$data.promptText)},onCancel:function(){i("取消")},onShow:function(){console.log("显示弹窗")}},e))}));return r(i)},t.prototype.confirmPromise=function(t){return new Promise((function(e,i){o.confirm({message:t,onConfirm:function(){e(!0)},onCancel:function(){e(!1)}})}))},t}()),_=t("AttachmentPreviewService",function(){function t(){}return t.prototype.show=function(t){p.show(t)},t}()),U=t("EntityTraversingService",function(){function t(t){this.viewModelContext=t}return Object.defineProperty(t.prototype,"bindingData",{get:function(){return this.viewModelContext.bindingData},enumerable:!0,configurable:!0}),t.prototype.getPropValue=function(t){return this.bindingData.getValue(t)},t.prototype.getEntityData=function(t){var e=this.bindingData.getValue(t);return(e instanceof h==!0?e.currentItem:e).toJSON()},t.prototype.getEntityListData=function(t){return this.bindingData.getValue(t).toJSON()},t}()),L=t("EntityManipulationService",function(){function t(t){this.viewModelContext=t}return Object.defineProperty(t.prototype,"bindingData",{get:function(){return this.viewModelContext.bindingData},enumerable:!0,configurable:!0}),t.prototype.setPropValue=function(t,e){this.bindingData.setValue(t,e,!0,!0)},t}()),H=t("EntityAggregationService",function(){function t(t){this.viewModelContext=t,this.traversingService=this.viewModelContext.injector.get(U)}return Object.defineProperty(t.prototype,"bindingData",{get:function(){return this.viewModelContext.bindingData},enumerable:!0,configurable:!0}),t.prototype.count=function(t){var e=this.splitPath(t);return this.traversingService.getEntityListData(e.listPath).length},t.prototype.sum=function(t){var e=this,i=this.splitPath(t);return this.traversingService.getEntityListData(i.listPath).reduce((function(t,n){var o=parseFloat(e.getPropValue(n,i.propPath));return t+=o=isNaN(o)?0:o}),0)},t.prototype.avg=function(t){var e=this.count(t),i=this.sum(t);return 0!==e?i/e:0},t.prototype.max=function(t){var e=this,i=this.splitPath(t),n=this.traversingService.getEntityListData(i.listPath).reduce((function(t,n){var o=parseFloat(e.getPropValue(n,i.propPath));return!1===isNaN(o)&&(!t||o>t)&&(t=o),t}),null);return n||0},t.prototype.min=function(t){var e=this,i=this.splitPath(t),n=this.traversingService.getEntityListData(i.listPath).reduce((function(t,n){var o=parseFloat(e.getPropValue(n,i.propPath));return!1===isNaN(o)&&(!t||o<t)&&(t=o),t}),null);return n||0},t.prototype.getPropValue=function(t,e){var i=t;return e.forEach((function(t){i=i?i[t]:null})),i},t.prototype.splitPath=function(t){for(var e=t.concat([]),i=[],n=this.bindingData.getValue(e);n instanceof h!=!0;){var o=e.pop();if(!o)return;i.unshift(o),n=this.bindingData.getValue(e)}return{listPath:e,propPath:i}},t}()),G=t("EntityListService",(function(t){this.viewModelContext=t})),J=t("EntityService",function(){function t(t){this.viewModelContext=t,this.traversingService=new U(t),this.manipulationService=new L(t),this.aggregationService=new H(t)}return t.prototype.getPropValue=function(t){return this.traversingService.getPropValue(t)},t.prototype.setPropValue=function(t,e){return this.manipulationService.setPropValue(t,e)},t.prototype.getEntityData=function(t){return this.traversingService.getEntityData(t)},t.prototype.getEntityListData=function(t){return this.traversingService.getEntityListData(t)},t.prototype.count=function(t){return this.aggregationService.count(t)},t.prototype.sum=function(t){return this.aggregationService.sum(t)},t.prototype.avg=function(t){return this.aggregationService.avg(t)},t.prototype.max=function(t){return this.aggregationService.max(t)},t.prototype.min=function(t){return this.aggregationService.min(t)},t}()),W={Info:1,Success:2,Redirect:3,ClientError:4,ServerError:5};W[W.Info]="Info",W[W.Success]="Success",W[W.Redirect]="Redirect",W[W.ClientError]="ClientError",W[W.ServerError]="ServerError";var K=function(){function t(){}return t.getHttpStatusType=function(t){if(!t)return null;var e=null;return t<100||t>600?e=null:t>=100&&t<200?e=W.Info:t>=200&&t<300?e=W.Success:t>=300&&t<400?e=W.Redirect:t>=400&&t<500?e=W.ClientError:t>=500&&t<600&&(e=W.ServerError),e},t}(),z=t("ExceptionService",function(){function t(t,e){this.notifyService=t,this.jsBridgeService=e}return t.prototype.show=function(t){this.exception(t)},t.prototype.exception=function(t){var e=this;if(t.message&&-1!==t.message.indexOf("401"))return this.notifyService.error("登录信息已失效请重新打开"),void setTimeout((function(){e.jsBridgeService.closeWindow()}),2e3);t&&t.response&&this.httpErrorHandler(t.response)},t.prototype.httpErrorHandler=function(t){if(t)switch(K.getHttpStatusType(t.status)){case W.ClientError:this.httpErrorInClient(t);break;case W.ServerError:this.httpErrorInServer(t);break;default:throw new Error("Get invalid status code when using httpErrorHandler method.")}},t.prototype.httpErrorInServer=function(t){var e=t.data;if("string"==typeof e)try{e=JSON.parse(e)}catch(t){}if(e&&null!=e.Level&&null!=e.Level){var i=this.getNotifyServiceMethodName(e.Level);this.notifyService[""+i](e.Message)}else this.notifyService.error(t.message)},t.prototype.httpErrorInClient=function(t){if(t){var e=t.config&&t.config.url&&t.config.url,i=t.status&&t.status;this.notifyService.error(e+" "+i)}},t.prototype.getNotifyServiceMethodName=function(t){var e;switch(t){case 0:e="info";break;case 1:e="warning";break;case 2:e="error";break;case 3:e="fatal";break;default:e="error"}return e},t}()),q=t("BaseDataService",function(){function t(t){this.viewModelContext=t,this.init()}return t.prototype.init=function(){this.initServices()},t.prototype.initServices=function(){this.loadingService=this.getService(T),this.toastService=this.getService(F),this.notifyService=this.getService(j),this.dialogService=this.getService(V),this.exceptionService=this.getService(z),this.entityService=this.getService(J),this.befRepository=this.viewModelContext.repository},t.prototype.getService=function(t){return this.viewModelContext.injector.get(t)},t}()),$=function(){function t(){}return t.convertBindingPathToEntityPath=function(t,e){var i="/"+e.bindingData.list.currentId,n=t.split("/");if(n.length>0)for(var o=1;o<n.length-1;o++){var r=n[o],s=e.bindingData[r];if(!s||!s.currentId)throw Error("获取子表完整路径出错，找不到"+s+"对应的子表，或对应子表没有当前行。");i+="/"+r+"/"+s.currentId}return i+="/"+n[n.length-1]},t.clearFromValidateType=function(t){var e=t.appContext.viewModelContextManager.getContexts().filter((function(e){return e.parent&&t.id===e.parent.id}));e.length>=1&&e.forEach((function(t){t.form.resetFieldsValidate()}))},t.stringTransformArray=function(t){return this.parameIsThreeBoss(t)?[]:JSON.parse(t)},t.parameIsThreeBoss=function(t){return""===t||null==t},t}(),Y=t("LoadDataService",function(t){function e(e){return t.call(this,e)||this}return M(e,t),e.prototype.loadForList=function(t,e,i,n){var o=this;"string"==typeof t&&(t=$.stringTransformArray(t)),"string"==typeof e&&(e=$.stringTransformArray(e));var r=this.viewModelContext.repository.paginationInfo||{pageSize:null,pageIndex:null},s=r.pageSize,a=r.pageIndex;return this.loadingService.show(),i||s?i&&(s=i):s=20,n||a?n&&(a=n):a=1,1===a&&this.befRepository.entityCollection.clear(),this.befRepository.getEntities(t,e,s,a).pipe(S((function(){var t=o.viewModelContext.repository.paginationInfo,e=t.pageIndex,i=t.pageCount,n=t.totalCount;e===i||0===n?o.viewModelContext.appContext.eventBus.triggerEvent({type:"listviewFinished"}):o.viewModelContext.appContext.eventBus.triggerEvent({type:"listviewUnFinished"}),o.viewModelContext.appContext.eventBus.triggerEvent({type:"loadDataFinished"}),o.loadingService.hide()}),(function(t){o.loadingService.hide()})))},e.prototype.loadForCard=function(t){var e=this;return $.clearFromValidateType(this.viewModelContext),this.loadingService.show(),this.befRepository.getEntityById(t).pipe(S((function(){e.loadingService.hide()}),(function(t){e.loadingService.hide()})))},e.prototype.loadDataForChildCard=function(t){var e=this.viewModelContext.bindingData[t].id,i=this.viewModelContext.bindingData[t].parentID,n=this.viewModelContext.repository.entityCollection.getEntityById(i)[t].get(e).data;this.viewModelContext.uiState.setPropertyValue("$childEntity",O({},n))},e}(q)),Q=t("CreateDataService",function(t){function e(e){return t.call(this,e)||this}return M(e,t),e.prototype.create=function(){var t=this;return this.befRepository.entityCollection.clear(),$.clearFromValidateType(this.viewModelContext),this.loadingService.show(),this.befRepository.createEntity().pipe(S((function(){t.loadingService.hide()}),(function(e){t.loadingService.hide()})))},e.prototype.createByPath=function(t){var e=this;this.loadingService.show();var i=$.convertBindingPathToEntityPath(t,this.viewModelContext);return this.befRepository.appendEntityByPath(i).pipe(S((function(i){e.viewModelContext.uiState.setPropertyValue("$isAdd",{status:!0,id:i.id,path:t,child:O({},i.data)}),e.loadingService.hide()}),(function(t){e.loadingService.hide()})))},e}(q)),X=t("EditDataService",function(t){function e(e){return t.call(this,e)||this}return M(e,t),e.prototype.edit=function(t){var e=this;return this.loadingService.show(),this.befRepository.editEntityById(t).pipe(S((function(){e.loadingService.hide()}),(function(t){e.loadingService.hide()})))},e}(q)),Z=t("UpdateDataService",function(t){function e(e){return t.call(this,e)||this}return M(e,t),e.prototype.update=function(t){var e=this;return this.loadingService.show(),this.befRepository.updateEntityById(t).pipe(S((function(){e.loadingService.hide()}),(function(t){e.loadingService.hide()})))},e}(q)),tt=t("RemoveDataService",function(t){function e(e){return t.call(this,e)||this}return M(e,t),e.prototype.removeById=function(t){var e=this;return this.dialogService.confirm("是否删除").pipe(I((function(i){return!1===i?s:(e.context&&e.context.eventParams&&e.context.eventParams.swipecellClose&&e.context.eventParams.swipecellClose(),e.cancelChanges(t))})))},e.prototype.cancelChanges=function(t){var e=this;return this.loadingService.show(),this.befRepository.removeEntityAndSaveById(t).pipe(S((function(){e.notifyService.success("删除成功"),e.loadingService.hide()}),(function(){e.loadingService.hide(),e.notifyService.error("删除失败")})))},e.prototype.removeByIds=function(t){var e=this;if(!t){var i=this.context.eventParams;t=i.map((function(t){return t.id}))}return this.dialogService.confirm("是否删除").pipe(I((function(i){return!1===i?s:(e.loadingService.show(),e.befRepository.removeEntitiesByIds(t))}))).pipe(S((function(){e.loadingService.hide(),e.notifyService.success("删除成功")}),(function(t){e.loadingService.hide()})))},e.prototype.removeByPathAndId=function(t,e){var i=this;return this.dialogService.confirm("是否删除").pipe(I((function(n){return!1===n?s:(i.context&&i.context.eventParams&&i.context.eventParams.swipecellClose&&i.context.eventParams.swipecellClose(),i.removeByPathAndIdChanges(t,e))})))},e.prototype.removeByPathAndIdChanges=function(t,e){var i=this;this.loadingService.show();var n=$.convertBindingPathToEntityPath(t,this.viewModelContext);return this.befRepository.removeEntityByPath(n,e).pipe(S((function(){i.loadingService.hide(),i.notifyService.success("删除成功")}),(function(t){i.loadingService.hide(),console.error(t)})))},e.prototype.removeByPathAndIds=function(t,e){throw new Error("Not Implemented")},e.prototype.removeByBusinessIds=function(t,e){e||(e=this.context.eventParams.map((function(t){return t.id})));var i={params:{ids:e.join(",")},body:{dataChange:[],variableChange:null}};return this.befRepository.apiProxy.request(f.PUT,t,i,!0)},e.prototype.removeByBusinessPathAndId=function(t,e,i){var n=this;return this.dialogService.confirm("是否删除").pipe(I((function(e){return!1===e?s:n.befRepository.apiProxy.request(f.PUT,t)})))},e.prototype.ClearStatusAfterchildCardSave=function(){return this.viewModelContext.uiState.setPropertyValue("$isAdd",null),this.viewModelContext.uiState.setPropertyValue("$childEntity",null),a(!0)},e}(q)),et=t("SaveDataService",function(t){function e(e){return t.call(this,e)||this}return M(e,t),e.prototype.save=function(){var t=this;return this.loadingService.show(),this.befRepository.saveEntities().pipe(S((function(){t.loadingService.hide(),t.notifyService.success("保存成功")}),(function(e){t.loadingService.hide()})))},e.prototype.saveByPath=function(){var t=this;this.loadingService.show();var e=this.viewModelContext.bindingData.list.currentId;return this.befRepository.updateEntityById(e).pipe(b((function(){return!0})),S((function(){t.viewModelContext.uiState.setPropertyValue("$isAdd",null),t.viewModelContext.uiState.setPropertyValue("$childEntity",null),t.loadingService.hide(),t.notifyService.success("保存成功")}),(function(e){t.loadingService.hide()})))},e}(q)),it=t("CancelDataService",function(t){function e(e){return t.call(this,e)||this}return M(e,t),e.prototype.cancel=function(){var t=this;return this.loadingService.show(),this.befRepository.cancelEntityChanges().pipe(S((function(){t.loadingService.hide()}),(function(e){t.loadingService.hide()})))},e}(q)),nt=t("BeActionService",function(t){function e(e){var i=t.call(this,e)||this;return i.viewModelContext=e,i}return M(e,t),e.prototype.invokeAction=function(t,e,i,n,o){return this.innerInvokeAction(t,e,i,n,o)},e.prototype.innerInvokeAction=function(t,e,i,n,o){var r=this,s=this.befRepository.apiProxy,a=s.baseUrl+"/service/"+t,c={};return i&&(c.headers=i),n&&(c.params=n),o&&(c.body=o),this.loadingService.show(),s.request(e,a,c).pipe(S((function(){r.loadingService.hide()}),(function(t){r.loadingService.hide(),console.log(t)})))},e}(q)),ot=t("ApproveService",function(){function t(t,e){this.viewModelContext=e,this.wfTaskHandlerService=t,this.notifyService=this.getService(j)}return t.prototype.getService=function(t){return this.viewModelContext.injector.get(t)},t.prototype.submitApproveWithBizDefKeyUseControl=function(t,e,i,n){if(void 0===i&&(i={}),!t)return this.notifyService.error("业务单据Id不能为空"),s;if(!e)return this.notifyService.error("入口单据Id不能为空"),s;i&&"object"==typeof i||(i={});var o=O({dataId:t,bizDefKey:e},i);if(n){if(n.startsWith("{")&&n.endsWith("}"))try{n=JSON.parse(n)}catch(t){console.log("variables parse failed!"),n={}}o.variables=n}return this.wfTaskHandlerService&&this.wfTaskHandlerService.startProcess(o)},t.prototype.cancelSubmit=function(t){return t?this.wfTaskHandlerService&&this.wfTaskHandlerService.cancelSubmit({dataId:null,bizDefKey:null,procInstId:t}):(this.notifyService.error("流程实例Id不能为空"),s)},t.prototype.submitWithBizDefKey=function(t,e){return this.wfTaskHandlerService&&this.wfTaskHandlerService.submitWithBizDefKey(t,e)},t.prototype.cancelSubmitWithDataId=function(t,e){return this.wfTaskHandlerService&&this.wfTaskHandlerService.cancelSubmitWithDataId(t,e)},t.prototype.batchSubmitWithBizDefKey=function(t,e){return this.wfTaskHandlerService&&this.wfTaskHandlerService.batchSubmitWithBizDefKey(t,e)},t.prototype.batchCancelSubmitWithDataId=function(t,e){return this.wfTaskHandlerService&&this.wfTaskHandlerService.batchCancelSubmitWithDataId(t,e)},t.prototype.childSubmit=function(t,e,i){return this.wfTaskHandlerService&&this.wfTaskHandlerService.childSubmit(t,e,i)},t.prototype.childCancelSubmit=function(t,e,i){return this.wfTaskHandlerService&&this.wfTaskHandlerService.childCancelSubmit(t,e,i)},t.prototype.childBatchSubmit=function(t,e,i){return this.wfTaskHandlerService&&this.wfTaskHandlerService.childBatchSubmit(t,e,i)},t.prototype.childBatchCancelSubmit=function(t,e,i){return this.wfTaskHandlerService&&this.wfTaskHandlerService.childBatchCancelSubmit(t,e,i)},t}()),rt=t("CheckDataService",function(t){function e(e){return t.call(this,e)||this}return M(e,t),e.prototype.checkChangesBeforeLeave=function(){var t=this;return P.isExistUnsaveData(this.befRepository)?this.dialogService.confirm("存在未保存的变更，确认离开当前页面？").pipe(I((function(e){return!1===e?s:(t.loadingService.show(),t.befRepository.cancelEntityChanges().pipe(I((function(){if(t.befRepository.apiProxy.associatedUrlMap.size>=1){var e=k(t.befRepository.apiProxy.associatedUrlMap.keys());return t.befRepository.apiProxy.request(f.POST,e[0]+"/service/cancel")}return a(!0)})),S((function(){t.loadingService.hide()}))))}))):a(!0)},e.prototype.checkChangesBeforeLeaveChild=function(){if(this.viewModelContext.uiState.$isAdd&&!0===this.viewModelContext.uiState.$isAdd.status){var t=this.viewModelContext.uiState.$isAdd.id,e=this.viewModelContext.uiState.$isAdd.path,i=this.viewModelContext.uiState.$isAdd.child,n=e.split("/"),o=void 0;if(n[0]&&1===n.length&&(o=this.viewModelContext.bindingData[n[0]]),n[0]||2!==n.length||(o=this.viewModelContext.bindingData[n[1]]),n.length>2){var r="";n[0]&&(r=n[0]);for(var s=1;s<n.length;s++)r+=n[s];o=this.viewModelContext.bindingData[r]}if(this.checkForVariationBetweenTheTwo(o,i))return a(!0);var c=$.convertBindingPathToEntityPath(e,this.viewModelContext);return this.befRepository.removeEntityByPath(c,t)}return a(!0)},e.prototype.checkForVariationBetweenTheTwo=function(t,e){for(var i=Object.keys(e),n=!1,o=0;o<i.length;o++)if("[object Object]"===Object.prototype.toString.call(e[i[o]])||"[object Array]"===Object.prototype.toString.call(e[i[o]])){if(JSON.stringify(e[i[o]])!==JSON.stringify(t[i[o]]))return!0}else if(e[i[o]]!==t[i[o]])return!0;return n},e.prototype.checkChangesBeforeLeaveAddOrEditChild=function(t){var e=this;if(this.viewModelContext.uiState.$isAdd&&!0===this.viewModelContext.uiState.$isAdd.status){var i=this.viewModelContext.uiState.$isAdd.id,n=this.viewModelContext.uiState.$isAdd.path,o=$.convertBindingPathToEntityPath(n,this.viewModelContext);return this.befRepository.removeEntityByPath(o,i).pipe(S((function(){e.viewModelContext.uiState.setPropertyValue("$isAdd",null)})))}var r=this.viewModelContext.bindingData[t].id,s=this.viewModelContext.bindingData[t].parentID,c=this.viewModelContext.uiState.$childEntity;return c?(this.viewModelContext.repository.entityCollection.getEntityById(s)[t].get(r).load(c),a(!0)):a(!0)},e}(q)),st=t("RouterService",function(){function t(t,e,i){this.jsBridgeService=i,this.viewModelContext=t,this.router=e}return t.prototype.navigate=function(t,e,i,n){if(void 0===e&&(e={}),void 0===i&&(i={}),t){e=this.ParamsFromStringToObject(e),i=this.ParamsFromStringToObject(i);var o=this.sessionStorageSaveHistory(t,n,i);if(t&&o>=0){var r=this.splicePath(t,e);return window.location.href=r,!1}window.MOBILE_ORIGIN_BACK&&window.MOBILE_ORIGIN_BACK.reflushOriginGoback(),this.router.push({path:t,query:e})}},t.prototype.removeParams=function(t,e){var i=e.search("\\?");return(i=-1)&&(i=e.length),e.slice(t,i)},t.prototype.getsessionStorageSaveHistoryKey=function(t){var e=t.search("/apps");return t&&e>=0?this.removeParams(e,t):this.router.options.history.base+t},t.prototype.sessionStorageSaveHistory=function(t,e,i){var n=t.search("/apps"),o=this.getsessionStorageSaveHistoryKey(t),r={};if(e)return r=t.search("/apps")>=0?{routerWay:"href",path:e,query:i}:{routerWay:"Router",path:e,query:i},sessionStorage.setItem(o,JSON.stringify(r)),n;var s=this.router.currentRoute.value.path;return r=t&&n>=0?{routerWay:"href",path:s=this.router.options.history.base+this.router.options.history.location,query:i}:{routerWay:"Router",path:s,query:i},sessionStorage.setItem(o,JSON.stringify(r)),n},t.prototype.navigateForRtc=function(t,e,i,n){var o=this;void 0===e&&(e={}),void 0===i&&(i={}),e&&e.metadataId||this.navigate(t,e,i,n);var r={metadataId:e.metadataId,withDims:!1,dim1:e.dim1,dim2:e.dim2};delete e.metadataId,delete e.dim1,delete e.dim2,this.correctRtcOptions(r).pipe(b((function(e){return o.getExtendPath(t,e)}))).pipe(S((function(t){o.navigate(t,e,i)}))).subscribe()},t.prototype.correctRtcOptions=function(t){var e=t.dim1||"public",i=t.dim2||"public",n={isRootMetadata:!0,metadataId:t.metadataId,dim1:e,dim2:i};return this.viewModelContext.injector.get(v).post("/api/runtime/bcc/v1.0/template/beforeNavigate",n,null).pipe(b((function(t){return{metadataId:t.metadataId,withDims:1===t.withDims,dim1:t.dim1,dim2:t.dim2}})))},t.prototype.getExtendPath=function(t,e){if(!1===e.withDims)return t;var i=t.split("index.html"),n=(e.dim1+"/"+e.dim2+"/index.html").toLowerCase();return i.join(n)},t.prototype.splicePath=function(t,e){var i=t,n=i.search("\\?");n>-1&&(i=i.slice(0,n));var o=Object.keys(e);return o.length>0&&(i+="?",o.forEach((function(t){i=i+t+"="+e[""+t]+"&"})),i=i.slice(0,i.length-1)),i},t.prototype.ParamsFromStringToObject=function(t){if("[object Object]"===Object.prototype.toString.call(t))return t;try{t=JSON.parse(t)}catch(e){t?(t={},console.error("路由传参params不是JSON串格式")):t={}}return"[object Object]"!==Object.prototype.toString.call(t)?{}:t},t.prototype.navigateReplace=function(t,e){void 0===e&&(e={}),"string"==typeof e&&(e=JSON.parse(e)),this.router.replace({path:t,query:e})},t.prototype.goBack=function(t){t=this.ParamsFromStringToObject(t);var e=this.router.options.history.base+this.router.currentRoute.value.path,i=sessionStorage.getItem(e);if(i){var n=Object.keys(t);if((i=JSON.parse(i))&&"Router"===i.routerWay){var o=i.query;n.length>0&&(o=O({},o,t)),this.router.push({query:o,path:i.path})}if(i&&"href"===i.routerWay){o=i.query;n.length>0&&(o=O({},o,t));var r=i.path;r=this.splicePath(r,o),window.location.href=r}}else{if(window.top.location.pathname.indexOf("mobiletaskcenter")>-1)return;this.jsBridgeService.closeWindow()}},t.prototype.mappingToUIState=function(){var t={params:this.router.currentRoute.value.params,queryParams:this.router.currentRoute.value.query};this.viewModelContext.uiState.routerState=t},t}()),at=t("ROUTER_INSTANCE_TOKEN","@farris/mobile-command-services/ROUTER_INSTANCE_TOKEN"),ct=function(e){return t({ValidatorServices:e,"ɵe":e}),e}(function(){function t(t){this.viewModelContext=t}return t.prototype.validateFields=function(t){return t?this.viewModelContext.appContext.viewModelContextManager.getContextById(t).form.validateFields():this.viewModelContext.form.validateFields()},t.prototype.handleValidateFields=function(t){var e=[];return t?e=this.viewModelContext.appContext.viewModelContextManager.getContextById(t).form.validateFields():this.viewModelContext.appContext.viewModelContextManager.getRootContextAndPosterityById(this.viewModelContext.id).forEach((function(t){e=e.concat(t.form.validateFields())})),0===e.length?a(!0):c.apply(void 0,k(e)).pipe(I((function(t){return t.findIndex((function(t){return!1===t.passing}))>-1?s:a(!0)})))},t.prototype.getFieldError=function(t,e){return e?this.viewModelContext.appContext.viewModelContextManager.getContextById(e).form.getFieldError(t):this.viewModelContext.form.getFieldError(t)},t.prototype.resetFieldsValidate=function(t,e){if(t&&"string"==typeof t&&(t=JSON.parse(t)),e)return this.viewModelContext.appContext.viewModelContextManager.getContextById(e).form.resetFieldsValidate(t);this.viewModelContext.appContext.viewModelContextManager.getRootContextAndPosterityById(this.viewModelContext.id).forEach((function(e){e.form.resetFieldsValidate(t)}))},t}()),dt=function(){function t(){}return t.prototype.init=function(t){window.top.iCityBridge.init(t)},t.prototype.takePhoto=function(t){void 0===t&&(t={quality:"mid"});var e=new d;return window.top.iCityBridge.ccworkGetPicsFromCameraAndAlbum(O({},t),(function(t){t&&e.next(t.result)})),e},t.prototype.scanQRCode=function(){var t=new d;return window.top.iCityBridge.ccworkScanCode({},(function(e){e&&t.next(e.result)})),t},t.prototype.getSysInfo=function(){},t.prototype.getLocation=function(){var t=new d;return window.top.iCityBridge.ccworkGetLocation((function(e){e&&t.next(e.result)})),t},t.prototype.selectFile=function(){var t=new d;return t.next([]),t},t.prototype.sendSMS=function(t,e){var i={numbers:[t],content:e};window.top.iCityBridge.ccworkSendSms(i)},t.prototype.openSendSMS=function(t,e){window.top.iCityBridge.sendSMS({tel:t,msg:e})},t.prototype.tel=function(t){window.top.iCityBridge.ringUp(t)},t.prototype.selectPictureFromAlbum=function(t){void 0===t&&(t={maxNum:9,mType:0});var e=new d;return window.top.iCityBridge.ccworkGetPicsFromAlbum(t,(function(t){t&&e.next(t.result)})),e},t.prototype.takeVideo=function(t){var e=new d;return window.top.iCityBridge.ccworkTakeShortVideo(O({time:15},t),(function(t){t&&e.next(t.result)})),e},t.prototype.closeWindow=function(){window.top.iCityBridge.closeWebView()},t.prototype.setTitles=function(t){window.top.iCityBridge.setTitle(t)},t.prototype.downloadFile=function(t){alert("暂不支持附件下载")},t.prototype.setOriginGoback=function(t){window.top.iCityBridge.ccworkInterceptOriginGoback(!!t,t,(function(){}))},t.prototype.pushOriginGoback=function(t){window.OriginGoback=window.OriginGoback||[];t&&(window.OriginGoback.push(t),window.top.iCityBridge.ccworkInterceptOriginGoback(!0,(function(){var t=window.OriginGoback.pop();t?t():(window.top.iCityBridge.ccworkInterceptOriginGoback(!1,(function(){}),(function(){})),history.back())}),(function(){})))},t.prototype.popOriginGoback=function(t){window.OriginGoback.pop()},t.prototype.playShortVideo=function(t){window.top.iCityBridge.ccworkPlayShortVideo(t)},t}(),ut=function(){function t(){}return t.prototype.playShortVideo=function(t){throw new Error("Method not implemented.")},t.prototype.takePhoto=function(t){void 0===t&&(t={quality:75,encodingType:0,targetWidth:600,targetHeight:600});var e=new d;return window.imp.iCamera.open(t,(function(t){t&&t.originalData&&e.next(t.originalData)}),(function(t){if(t)return console.log("takePhoto",t),void e.next([])})),e},t.prototype.scanQRCode=function(){var t=new d;return console.log("调用二维码"),window.imp.iBarCode.scan((function(e){e&&(console.log("二维码回调"),t.next(e))})),t},t.prototype.getLocation=function(){var t=new d;return window.imp.iGps.getInfo((function(e){if(e){var i=e.latitude,n=e.longitude,o=e.addr,r=e.city,s=e.country,a=e.district,c=e.province,d=e.street,u=e.streetNum;t.next({addr:o,city:r,country:s,district:a,province:c,street:d,streetNum:u,lat:i,lng:n})}})),t},t.prototype.getSysInfo=function(){var t=new d;return window.imp.iDevice.sysInfo((function(e){e&&t.next(e)})),t},t.prototype.sendSMS=function(t,e){window.imp.iSms.send(t,e)},t.prototype.openSendSMS=function(t,e){window.imp.iSms.open(t,e)},t.prototype.tel=function(t){window.imp.iTel.dial(t)},t.prototype.selectPictureFromAlbum=function(t){void 0===t&&(t={maxNum:9,mType:0});var e={num:9,quality:75,destinationType:0,encodingType:1,targetWidth:600,targetHeight:600};e.num=t.maxNum;var i=new d;return window.imp.iCamera.select(O({},e,t),(function(t){t&&i.next(t.map((function(t){return t.originalData})))}),(function(t){t&&(console.log("selectPictureFromAlbum",t),i.next([]))})),i},t.prototype.selectFileFromMobile=function(t){},t.prototype.getBase64=function(t){var e=new d;return window.imp.iFile.getBase64(t,(function(t){t&&e.next(t)}),(function(t){t&&(console.log("getBase64",t),e.next([]))})),e},t.prototype.selectFile=function(t){void 0===t&&(t={maximum:6});var e=new d;return window.imp.iFile.select(O({},t),(function(t){if(t&&t.length>0){var i=[],n=0;t.forEach((function(o){window.imp.iFile.getBase64(o.path,(function(o){i.push({name:t[n].name,size:t[n].size,base64:o}),n++,t.length===i.length&&e.next(i)}),(function(t){t&&(console.log("getBase64",t),e.next([]))}))}))}}),(function(t){t&&(console.log("selectFile",t),e.next([]))})),e},t.prototype.takeVideo=function(t){var e={id:t.id};t.quality?t.quality<=.5?e.fps=30:t.quality<=1&&(e.fps=60):e.fps=30;var i=new d;return window.imp.iVideo.record(e,(function(t){t&&i.next(t)}),(function(t){t&&(console.log("takeVideo",t),i.next([]))})),i},t.prototype.closeWindow=function(){window.imp.iWindow.close()},t.prototype.setTitles=function(t){document.title=t},t.prototype.downloadFile=function(t){var e=new d;return window.imp.iFile.download(t,(function(t){1!==t.status&&console.log(t),e.next(!0)})),e},t.prototype.setOriginGoback=function(t){var e=function(t,e){for(var i=t.length>e.length?e.length:t.length,n=0;n<i;n++)if(parseInt(e[n])>parseInt(t[n]))return!1;return!0},i=function(){t?(window.imp.iWindow.onBackKeyDown2(t),e(o.split("."),n.split("."))&&window.imp.iWindow.onTitleBackKeyDown2(t)):(window.imp.iWindow.cancelBackKeyDown(),e(o.split("."),n.split("."))&&window.imp.iWindow.cancelTitleBackKeyDown())},n="4.8.21",o=window.CURRENT_VERSION;o?i():window.imp.iDevice.sysInfo((function(t){var e=t.appVersion.split("-");window.CURRENT_VERSION=e[0],o=window.CURRENT_VERSION,i()}))},t.prototype.pushOriginGoback=function(t){window.OriginGoback=window.OriginGoback||[];var e=function(){var t=window.OriginGoback.pop();t?t():(window.imp.iWindow.cancelBackKeyDown(),window.imp.iWindow.cancelTitleBackKeyDown(),history.back())};t&&(window.OriginGoback.push(t),window.imp.iWindow.onBackKeyDown2(e),window.imp.iWindow.onTitleBackKeyDown2(e))},t.prototype.popOriginGoback=function(){window.OriginGoback.pop()},t}(),pt=function(){function t(){}return t.prototype.create=function(){return-1!==navigator.userAgent.toLowerCase().search("ccwork")?(window.top.FARRIS_JSBridge="云上协同",new dt):-1!==navigator.userAgent.toLowerCase().search("emmcloud")?(window.top.FARRIS_JSBridge="云加",new ut):(window.top.FARRIS_JSBridge="浏览器",new ut)},t}(),lt=t("JsBridgeService",function(){function t(){this.jsBridgeStrategyFactory=new pt,this.init()}return t.prototype.getSysInfo=function(){return this.getJsBridgeService(this.strategy.getSysInfo)},t.prototype.init=function(){this.strategy=this.jsBridgeStrategyFactory.create(),window.JsBridgeService=this},t.prototype.takePhoto=function(t){return this.getJsBridgeService(this.strategy.takePhoto,t)},t.prototype.scanQRCode=function(){return this.getJsBridgeService(this.strategy.scanQRCode)},t.prototype.getLocation=function(){return this.getJsBridgeService(this.strategy.getLocation)},t.prototype.sendSMS=function(t,e){return this.getJsBridgeService(this.strategy.sendSMS,t,e)},t.prototype.openSendSMS=function(t,e){return this.getJsBridgeService(this.strategy.openSendSMS,t,e)},t.prototype.tel=function(t){return this.getJsBridgeService(this.strategy.tel,t)},t.prototype.selectPictureFromAlbum=function(t){return this.getJsBridgeService(this.strategy.selectPictureFromAlbum,t)},t.prototype.takeVideo=function(t){return this.getJsBridgeService(this.strategy.takeVideo,t)},t.prototype.closeWindow=function(){return this.getJsBridgeService(this.strategy.closeWindow)},t.prototype.setTitles=function(t){return this.getJsBridgeService(this.strategy.setTitles,t)},t.prototype.selectFile=function(t){return this.getJsBridgeService(this.strategy.selectFile,t)},t.prototype.downloadFile=function(t){return this.getJsBridgeService(this.strategy.downloadFile,t)},t.prototype.setOriginGoback=function(t){return this.getJsBridgeService(this.strategy.setOriginGoback,t)},t.prototype.pushOriginGoback=function(t){return this.getJsBridgeService(this.strategy.pushOriginGoback,t)},t.prototype.popOriginGoback=function(t){return this.getJsBridgeService(this.strategy.popOriginGoback,t)},t.prototype.playShortVideo=function(t){return this.getJsBridgeService(this.strategy.playShortVideo,t)},t.prototype.getJsBridgeService=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];var n=new d;if("已加载"===window.top.FARRIS_JSBridge)return t.apply(void 0,k(e));if("云上协同"===window.top.FARRIS_JSBridge){if(window.top.iCityBridge)return t.apply(void 0,k(e));var o=window.top.document.createElement("script");o.src="https://ccwork.oss.cn-north-3.inspurcloudoss.com/h5/ccworkJsbridge.js",o.onload=function(){window.top.iCityBridge.init((function(){t.apply(void 0,k(e)).subscribe((function(t){n.next(t)}))}))},window.top.document.head.appendChild(o)}return"云加"===window.top.FARRIS_JSBridge&&System.import("/platform/common/web/imp.js").then((function(i){window.top.FARRIS_JSBridge="已加载",t.apply(void 0,k(e)).subscribe((function(t){n.next(t)}))})),n},t}()),ht=(t("HistoryBackService",function(){function t(){}return t.prototype.init=function(){window.MOBILE_ORIGIN_BACK_ARRAY=window.MOBILE_ORIGIN_BACK_ARRAY||[],window.MOBILE_ORIGIN_BACK={pushOriginGoback:function(t){window.MOBILE_ORIGIN_BACK_ARRAY.push(t)},popOriginGoback:function(){window.MOBILE_ORIGIN_BACK_ARRAY.pop()},reflushOriginGoback:function(){window.MOBILE_ORIGIN_BACK_ARRAY=[]}}},t.prototype.pushOriginGoback=function(t){window.MOBILE_ORIGIN_BACK_ARRAY.push(t)},t.prototype.popOriginGoback=function(){window.MOBILE_ORIGIN_BACK_ARRAY.pop()},t.prototype.reflushOriginGoback=function(){window.MOBILE_ORIGIN_BACK_ARRAY=[]},t.prototype.proxyBack=function(){if(-1!==navigator.userAgent.toLowerCase().search("emmcloud"))if(window.top.location.pathname.indexOf("mobiletaskcenter")>-1)setTimeout((function(){window.top.detailBackBtnClickHandler=function(t){var e=window.MOBILE_ORIGIN_BACK_ARRAY.pop();if(e)return e(),!1;var i=location.pathname+location.hash.slice(0,location.hash.indexOf("?"));return!sessionStorage.getItem(i)||(history.back(),!1)}}),0);else{(new lt).setOriginGoback((function(){var t=window.MOBILE_ORIGIN_BACK_ARRAY.pop();t?t():history.back()}))}},t}()),t("CommandService",function(){function t(t){this.viewModelContext=t}return t.prototype.execute=function(t,e){if(!t||""===t||"undefined"===t)return s;if("noop"===t.toLocaleLowerCase())return s;var i=this.viewModelContext.viewModel;e&&(i=this.viewModelContext.appContext.viewModelContextManager.getContextById(e).viewModel);return i[t]()},t}())),ft=t("StateMachineService",function(){function t(t){this.viewModelContext=t}return t.prototype.executeAction=function(t){return t?"function"!=typeof this.viewModelContext.stateMachine[t]?s:void this.viewModelContext.stateMachine[t]():s},t}()),vt=t("UIStateService",(function(){})),gt=t("VoVariableService",function(){function t(t){this.viewModelContext=t}return t.prototype.setValue=function(t,e){this.viewModelContext.repository.variableManager.setValue(t,e)},t.prototype.getValue=function(t){this.viewModelContext.repository.variableManager.getValue(t)},t}()),yt=function(){function t(){}return t.convertToAttachmentInfos=function(t){var e=this;return t?t.map((function(t){return e.convertToAttachmentInfo(t)})):[]},t.convertToAttachmentInfo=function(t){return{attachmentId:t.metadataId,fileName:t.fileName}},t.getFirstAttachmentInfo=function(t){if(t&&0!==t.length)return t[0]},t.peekAttachmentIds=function(t){return t||(t=[]),t.map((function(t){return t.attachmentId}))},t}(),mt=t("AttachmentDataService",function(){function t(t){this.viewModelContext=t}return Object.defineProperty(t.prototype,"befRepository",{get:function(){return this.viewModelContext.repository},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bindingData",{get:function(){return this.viewModelContext.bindingData},enumerable:!0,configurable:!0}),t.prototype.updateRow=function(t,e){var i=this,n=this.befRepository.apiProxy,o=n.baseUrl+"/service/updateattachment",r={body:{updateAttachInfo:this.createUpdateAttachInfo(t,e)}};return console.log("loading show ..."),n.request(f.PUT,o,r).pipe(I((function(t){return i.syncAttachmentInfosToClient()})),S((function(){console.log("loading hide ...")})))},t.prototype.updateRows=function(t,e){var i=this,n=this.befRepository.apiProxy,o=n.baseUrl+"/service/batchuploadattachment",r=this.createBatchCreateAttachInfo(t,e),s=0===r.NodeCodes.length,a={body:{batchUploadInfo:r}};return console.log("loading show ..."),n.request(f.PUT,o,a).pipe(I((function(t){return i.appendAttachmentInfosToClient(t,s)})),S((function(){console.log("hide loading ...")})))},t.prototype.createUpdateAttachInfo=function(t,e){var i=e.attachmentId,n=g.toBindingPathArray(t);return n.pop(),{NodeCodes:D.convertToObjectCodes(n,this.bindingData),HiretryIds:D.convertToDataIdsForUpdate(n,this.bindingData),AttachmentIds:[i],AttachmentId:i}},t.prototype.createBatchCreateAttachInfo=function(t,e){var i=yt.peekAttachmentIds(e),n=g.toBindingPathArray(t);return n.pop(),{NodeCodes:D.convertToObjectCodes(n,this.bindingData),HiretryIds:D.convertToDataIdsForAdd(n,this.bindingData),AttachmentIds:i,AttachmentId:null}},t.prototype.syncAttachmentInfosToClient=function(){var t=this.bindingData.list.currentId;return this.befRepository.updateEntityById(t)},t.prototype.appendAttachmentInfosToClient=function(t,e){var i=this;if(!0===e){var n=this.befRepository.buildEntities(t);return this.befRepository.entityCollection.addEntities(n),a(t)}return this.syncAttachmentInfosToClient().pipe(b((function(){return i.befRepository.dataChangeHistory.addChange({dataId:t[0].id,changeType:y.Add}),t})))},t}()),wt=t("AttachmentService",function(){function t(t,e,i,n){this.defaultRootDirId="default-root",this.viewModelContext=t,this.attachDataService=n,this.entityService=e,this.removeDataService=i}return Object.defineProperty(t.prototype,"defaultParentDirName",{get:function(){return this.viewModelContext.bindingData.list.currentId},enumerable:!0,configurable:!0}),t.prototype.uploadAndUpdateRow=function(t,e,i){var n=e||this.defaultRootDirId,o=i||this.defaultParentDirName;if(!n||!o)throw new Error("rootDirId和parentDirName不能为空，请填写");var r=this.getUploadFileInfosFromContext(),a=yt.convertToAttachmentInfos(r);if(!a||0===a.length)return alert("请先上传附件"),s;console.log("show loading ...");var c=yt.getFirstAttachmentInfo(a);return this.attachDataService.updateRow(t,c).pipe(S((function(){console.log("hide loading ...")})))},t.prototype.uploadAndBatchAddRows=function(t,e,i){var n=e||this.defaultRootDirId,o=i||this.defaultParentDirName;if(!n||!o)throw new Error("rootDirId和parentDirName不能为空，请填写");var r=this.getUploadFileInfosFromContext(),a=yt.convertToAttachmentInfos(r);return a&&0!==a.length?(console.log("show loading ..."),this.attachDataService.updateRows(t,a).pipe(S((function(){console.log("hide loading ...")})))):(alert("请先上传附件"),s)},t.prototype.removeAttachmentRows=function(t){var e=this;if(!t)return s;var i=this.getDataIdsToRemove(t);if(t.split("/").length<=2)return this.removeDataService.removeByIds(i);var n=[];0===i.length&&alert("请选择要删除的文件");var o=this.getBindingListPathWithAttachments(t);return i.forEach((function(t){var i=e.removeDataService.removeByPathAndId(o,t);n.push(i)})),u(n)},t.prototype.getUploadFileInfosFromContext=function(){var t=this.context.eventParams;return t||[]},t.prototype.getDataIdsToRemove=function(t){var e=this,i=this.getAttachmentIdsToRemoveFromContext(),n=[];return i.forEach((function(i){var o=e.convertAttachmentIdToDataId(i,t);n.push(o)})),n},t.prototype.getAttachmentIdsToRemoveFromContext=function(){return this.context.eventParams},t.prototype.convertAttachmentIdToDataId=function(t,e){var i=g.toBindingPathArray(e),n=i.pop(),o=i;return this.entityService.getEntityListData(o).find((function(e){if(e[n]&&e[n].attachmentId===t)return!0})).id},t.prototype.getBindingListPathWithAttachments=function(t){var e=g.toBindingPathArray(t);return e.pop(),"/"+e.join("/")},t}()),St=t("CcWorkService",function(){function t(){}return t.prototype.closeCcWorkWebView=function(){window.iCityBridge.closeWebView()},t.prototype.hideCcWorkNaviBar=function(){window.iCityBridge.hideTitleBar()},t.prototype.setTitle=function(t){window.iCityBridge.setTitle(t)},t.prototype.getLocation=function(t){window.iCityBridge&&window.iCityBridge.ccworkGetLocation(t)},t.prototype.scanCode=function(t,e){if(void 0===e&&(e={}),window.iCityBridge){var i=O({filters:["QR","EAN13","EAN8"],path:""},e);window.iCityBridge.ccworkScanCode(i,t)}},t.prototype.callPhone=function(t,e){if(window.iCityBridge){var i={number:t};window.iCityBridge.ccworkCallPhone(i,e)}},t.prototype.getPicsFromCameraAndAlbum=function(t,e){window.iCityBridge&&window.iCityBridge.ccworkGetPicsFromCameraAndAlbum(t,e)},t}()),It=function(e){return t({MapService:e,"ɵf":e}),e}(function(){function t(){}return t.prototype.getStaticMap=function(t){if(t&&t.location){t.key||(t.key="e01c849062d312e0cbeb2beb1f28ef71"),t.zoom||(t.zoom=10),t.size||(t.size={width:400,height:400});var e=t.markers,i="";e&&e.length&&(i=e.reduce((function(t,e,i){return t+=e.longtitude+","+e.latitude+";"}),""),t.markerSize||(t.markerSize="mid"),t.markerColor||(t.markerColor=""),i&&(i="&markers="+t.markerSize+","+t.markerColor+",A:"+i.substring(0,i.length-1)));var n=t.location.longtitude,o=t.location.latitude,r=n.toString(),s=o.toString();return r.substring(r.indexOf(".")+1).length>6&&(n=n.toFixed(6)),s.substring(s.indexOf(".")+1).length>6&&(o=o.toFixed(6)),"https://restapi.amap.com/v3/staticmap?location="+n+","+o+"&zoom="+t.zoom+"&size="+t.size.width+"*"+t.size.height+i+"&key="+t.key}},t}()),bt=function(){function t(){}return t.convertToAttachmentInfos=function(t){var e=this;return t?t.map((function(t){return e.convertToAttachmentInfo(t)})):[]},t.convertToAttachmentInfo=function(t){return{attachmentId:t.metadataId,fileName:t.fileName}},t.getFirstAttachmentInfo=function(t){if(t&&0!==t.length)return t[0]},t.peekAttachmentIds=function(t){return t||(t=[]),t.map((function(t){return t.attachmentId}))},t.getChangeDetails=function(t,e){var i=this,n=[];return e.forEach((function(e){var o=t.find((function(t){return t.id===e.id}));o||(o={});var r=i.getChangeDetail(o,e);r&&n.push(r)})),n},t.getChangeDetail=function(t,e){var i={ChangeType:A.Modify,ChangeInfo:{DataId:e.id}},n=!1;return Object.keys(e).forEach((function(o){if("id"!==o&&"nodeCode"!==o&&"childs"!==o){var r=t[o],s=e[o];void 0===r&&"object"==typeof s||JSON.stringify(r)!==JSON.stringify(s)&&(i.ChangeInfo[o]=s,n=!0)}})),n?i:null},t}(),Ct=t("BusinessAttachmentDataService",function(){function t(t){this.viewModelContext=t}return Object.defineProperty(t.prototype,"befReposi",{get:function(){return this.viewModelContext.repository},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bindingData",{get:function(){return this.viewModelContext.bindingData},enumerable:!0,configurable:!0}),t.prototype.getAllBeSessions=function(){var t=window.sessionStorage.getItem("BE_SESSION_ID");if(!t)return{};var e=this.getUserSessionId();return JSON.parse(t)[e+"_/api/gsp/common/v1.0/testForm_mfrm"]},t.prototype.getUserSessionId=function(){return window.localStorage.getItem("sessionId")},t.prototype.handleRequestHeaders=function(t){var e=this.getUserSessionId(),i=this.getAllBeSessions();return e&&(t=m.appendHeader(t,"X-CAF-Runtime-CommonVariable",e)),i&&(t=m.appendHeader(t,"X-CAF-Runtime-Context",i),t=m.appendHeader(t,"SessionId",i)),t=m.appendHeader(t,"Content-Type","application/json")},t.prototype.extendQueryData=function(t){var e={params:{entityFilter:JSON.stringify({FilterConditions:[],SortConditions:[],IsUsePagination:!1,Pagination:{PageIndex:1,PageSize:5,PageCount:0,TotalCount:0}})}};return this.befReposi.apiProxy.request(f.PUT,t,e)},t.prototype.updateRow=function(t,e){var i=this.befReposi.apiProxy,n=i.baseUrl+"/service/updateattachment",o={body:{updateAttachInfo:this.createUpdateAttachInfo(t,e)}};return i.request(f.PUT,n,o)},t.prototype.updateRows=function(t,e,i){var n=this.befReposi.apiProxy,o=this.createBatchCreateAttachInfo(e,i);o.NodeCodes.length;var r={body:{batchUploadInfo:o}};return n.request(f.PUT,t,r,!0)},t.prototype.createUpdateAttachInfo=function(t,e){var i=e.attachmentId,n=g.toBindingPathArray(t);return n.pop(),{NodeCodes:D.convertToObjectCodes(n,this.bindingData),HiretryIds:D.convertToDataIdsForUpdate(n,this.bindingData),AttachmentIds:[i],AttachmentId:i}},t.prototype.createBatchCreateAttachInfo=function(t,e){var i=bt.peekAttachmentIds(e),n=g.toBindingPathArray(t);return n.pop(),{NodeCodes:D.convertToObjectCodes(n,this.bindingData),HiretryIds:D.convertToDataIdsForAdd(n,this.bindingData),AttachmentIds:i,AttachmentId:null}},t.prototype.syncAttachmentInfosToClient=function(){var t=this.bindingData.list.currentId;return this.befReposi.updateEntityById(t)},t.prototype.appendAttachmentInfosToClient=function(t,e){if(!0===e){var i=this.befReposi.buildEntities(t);return this.befReposi.entityCollection.addEntities(i),a(t)}return this.syncAttachmentInfosToClient().pipe(b((function(){return t})))},t}()),xt=t("BusinessAttachmentService",function(){function t(t,e,i,n){this.defaultRootDirId="default-root",this.viewModelContext=t,this.attachDataService=n,this.entityService=e,this.removeDataService=i}return Object.defineProperty(t.prototype,"defaultParentDirName",{get:function(){return this.viewModelContext.bindingData.list.currentId},enumerable:!0,configurable:!0}),t.prototype.loadAttachmentRows=function(t,e,i){var n=this.getAttachContext(),o=this.viewModelContext.repository,r=o.sessionService,s=o.apiProxy,a={};"string"==typeof e&&(e=JSON.parse(e)),"string"==typeof i&&(i=JSON.parse(i));var c={FilterConditions:e||null,SortConditions:i||null,IsUsePagination:!1,Pagination:{PageIndex:1,PageSize:0,PageCount:0,TotalCount:0}},d=JSON.stringify(c);a.entityFilter=d;var u={dataChange:[],variableChange:null};return o.apiProxy.setAssociatedUrl(t),this.waitForBeSession().pipe(I((function(){t+="/extension/query";var e={headers:r.extendRequestHeaders({}),params:a,body:u};return s.httpClient.request(f.PUT,t,e).pipe(b((function(t){var e=t.returnValue.result;return n.setData(JSON.parse(JSON.stringify(e))),n.updateData(JSON.parse(JSON.stringify(e))),e})))})))},t.prototype.waitForBeSession=function(){return this.viewModelContext.repository.sessionService.getBeSessionExisted().pipe(C((function(t){return!0===t})),x(1))},t.prototype.syncAttachmentRowChanges=function(t){var e=this.getAttachContext()||{},i=bt.getChangeDetails(e.oldListData,e.listData);if(!i||0===i.length)return a(!1);var n={body:{dataChange:i,variableChange:null}};return t=t+"/extension/retrieve/"+i[0].ChangeInfo.DataId,this.viewModelContext.repository.apiProxy.request(f.PUT,t,n,!0).pipe(b((function(t){var i=e.context,n=i.getData();return i.updateData(JSON.parse(JSON.stringify(n))),t})))},t.prototype.uploadAndUpdateRow=function(t,e,i){var n=e||this.defaultRootDirId,o=i||this.defaultParentDirName;if(!n||!o)throw new Error("rootDirId和parentDirName不能为空，请填写");var r=this.getUploadFileInfosFromContext(),a=bt.convertToAttachmentInfos(r);if(!a||0===a.length)return alert("请先上传附件"),s;console.log("show loading ...");var c=bt.getFirstAttachmentInfo(a);return this.attachDataService.updateRow(t,c).pipe(S((function(){console.log("hide loading ...")})))},t.prototype.uploadAndBatchAddRows=function(t,e){var i=this,n=this.context,o=n.eventParams.rootId,r=n.eventParams.parentDirName,a=o||this.defaultRootDirId,c=r||this.defaultParentDirName;if(!a||!c)throw new Error("rootDirId和parentDirName不能为空，请填写");var d=n.eventParams.context,u=this.getUploadFileInfosFromContext(),p=bt.convertToAttachmentInfos(u);if(!p||0===p.length)return alert("请先上传附件"),s;var l=t+"/service/batchuploadattachment";return this.attachDataService.updateRows(l,e,p).pipe(b((function(t){return d.appendData(t),i.getDataIdsToRemove(d,e).forEach((function(t){i.viewModelContext.repository.dataChangeHistory.addChange({fPath:"",dataId:t,changeType:y.Add})})),t})))},t.prototype.removeAttachmentRows=function(t,e){var i=this,n=this.context.eventParams.context;if(!e)return s;var o=this.getDataIdsToRemove(n,e);if(e.split("/").length<=2){var r=t+"/extension/batchdelete";return this.removeDataService.removeByBusinessIds(r,o).pipe(b((function(t){o.forEach((function(t){n.removeDataById(t),i.viewModelContext.repository.dataChangeHistory.addChange({fPath:"",dataId:t,changeType:y.Delete})}))})))}var a=[];0===o.length&&alert("请选择要删除的文件");var c=this.getBindingListPathWithAttachments(e);return o.forEach((function(e){var n=i.removeDataService.removeByBusinessPathAndId(t,c,e);a.push(n)})),u(a).pipe(b((function(t){return console.log(t),t})))},t.prototype.getUploadFileInfosFromContext=function(){var t=this.context.eventParams.data;return t||[]},t.prototype.getDataIdsToRemove=function(t,e){var i=this,n=this.getAttachmentIdsToRemoveFromContext(),o=[];return n.forEach((function(n){var r=i.convertAttachmentIdToDataId(t,n,e);o.push(r)})),o},t.prototype.getAttachmentIdsToRemoveFromContext=function(){return this.context.eventParams.data.map((function(t){return"[object Object]"===Object.prototype.toString.call(t)?t.metadataId:t}))},t.prototype.convertAttachmentIdToDataId=function(t,e,i){var n=g.toBindingPathArray(i).pop();return t.data.find((function(t){if(t[n]&&t[n].attachmentId===e)return!0})).id},t.prototype.getBindingListPathWithAttachments=function(t){var e=g.toBindingPathArray(t);return e.pop(),"/"+e.join("/")},t.prototype.getAttachContext=function(){var t=this.context;return t&&t.eventParams?t.eventParams:{}},t}()),Pt=t("DiscussionGroupService",function(){function t(t,e,i){this.httpSvc=t,this.viewModelContext=e,this.loadingService=i}return Object.defineProperty(t.prototype,"params",{get:function(){return this.context&&this.context.eventParams||{}},enumerable:!0,configurable:!0}),t.prototype.addComment=function(t,e,i,n,o,r){var a=this;if(!(t=t||this.viewModelContext&&this.viewModelContext.bindingData.list.currentId||null))return s;var c=this.buildAddCommentParam(t,n,r,e,o,i);return this.loadingService.show(),this.httpSvc.post("/api/runtime/comment/v1.0/bill-comment/comment",c,{}).pipe(S((function(){a.loadingService.hide()})))},t.prototype.buildAddCommentParam=function(t,e,i,n,o,r){return void 0===e&&(e=this.params.text),void 0===i&&(i=this.params.replyUser&&this.params.replyUser.id),void 0===o&&(o=this.params.visibility||"ALL"),{bill:{billId:t,configId:r,summary:n},comment:{billId:t,configId:r,parentId:i||null,text:e,visibility:o}}},t.prototype.queryComments=function(t,e,i,n){var o=this;if(!(t=t||this.viewModelContext&&this.viewModelContext.bindingData.list.currentId||null))return s;var r=this.buildQueryCommentsUrl(t,i,n,e);return this.loadingService.show(),this.httpSvc.get(r,{}).pipe(S((function(t){o.loadingService.hide(),o.viewModelContext.uiState.setPropertyValue("discussionListData",t)})))},t.prototype.buildQueryCommentsUrl=function(t,e,i,n){return null==e&&(e=this.params.pageIndex||0),null==i&&(i=this.params.pageSize||999),"/api/runtime/comment/v1.0/bill-comment/comment/byBill?configId="+n+"&billId="+t+"&pageSize="+i+"&pageIndex="+e},t.prototype.setReplyUser=function(){this.viewModelContext.uiState.setPropertyValue("replyUser",this.params)},t.prototype.queryFrequentAtUsers=function(t,e){var i=this,n=[];n.push("pageSize="+(e||20)),n.push("pageIndex="+(t||0));var o="/api/runtime/comment/v1.0/bill-comment/frequentAtUsers?"+n.join("&");return this.loadingService.show(),this.httpSvc.get(o,{}).pipe(S((function(t){i.loadingService.hide();var e={pageInfo:{pageSize:t.pageSize,pageIndex:t.pageIndex},total:t.totalCount,items:t.users};i.viewModelContext.uiState.setPropertyValue("personnelsData",e)})))},t.prototype.queryAtUsers=function(t,e,i){var n=this,o=[];t&&o.push("param="+t),o.push("pageSize="+(i||100)),o.push("pageIndex="+(e||0));var r="/api/runtime/comment/v1.0/bill-comment/atUser?"+o.join("&");return this.loadingService.show(),this.httpSvc.get(r,{}).pipe(S((function(t){n.loadingService.hide();var e={pageInfo:{pageSize:t.pageSize,pageIndex:t.pageIndex},total:t.totalCount,items:t.users};n.viewModelContext.uiState.setPropertyValue("personnelsData",e)})))},t}()),Dt=t("ɵc",function(){function t(t){this.httpSvc=t}return t.prototype.error=function(t,e){if(t&&t.error&&t.error.Message){var i=t.error.Message;return e&&(i=e+"操作失败:"+i),i}},t.prototype.startProcessSimulate=function(t){return this.httpSvc.post("/api/runtime/wf/v1.0/processInstances/startProcess-simulation",t,{})},t.prototype.startProcess=function(t){return this.httpSvc.post("/api/runtime/wf/v1.0/processInstances/startProcess",t,{})},t.prototype.cancelSubmit=function(t){return this.httpSvc.post("/api/runtime/wf/v1.0/processInstances/cancelSubmit",t,{})},t}()),Bt=function(){},At=function(){},Rt=function(){},Mt=t("ɵb",function(){function t(t){this.taskService=t,this.processPlaceholder="选择流程",this.assignInfos=[],this.selectedValues=["clear"],this.payload=new Bt,this.subject=new d,this.processReadOnly=!1,this.nodeReadOnly=!0}return t.prototype.setParam=function(t){this.payload.id=t.id,this.payload.processDefinitionId=t.processDefinitionId,this.payload.processDefinitionKey=t.processDefinitionKey,this.payload.bizDefKey=t.bizDefKey,this.payload.dataModelId=t.dataModelId,this.payload.dataId=t.dataId,this.payload.name=t.name,this.payload.startUserId=t.startUserId,this.payload.nextFlowNodes=[],this.startProcessSimulate(this.payload)},t.prototype.startProcessSimulate=function(t){var e=this;this.taskService.startProcessSimulate(t).subscribe((function(t){e.destProcesses=t.procDefs.map((function(t){return{id:t.procDefId,name:t.procDefName}})),1===e.destProcesses.length?(e.processReadOnly=!0,e.selectedProcessId=t.procDefs[0].procDefId,e.vm=l.confirm({process:e.selectedProcessId,processData:e.destProcesses,processOc:e.selectProcessChange.bind(e),processReadFlag:e.processReadOnly,processHolder:e.processPlaceholder,nextNodeReadFlag:e.nodeReadOnly,submit:e.submit.bind(e),cancel:e.back.bind(e)}),e.response=t,e.setNextNode(t)):e.vm=l.confirm({processData:e.destProcesses,processOc:e.selectProcessChange.bind(e),processReadFlag:e.processReadOnly,processHolder:e.processPlaceholder,nextNodeReadFlag:e.nodeReadOnly,submit:e.submit.bind(e),cancel:e.back.bind(e)})}),(function(t){e.subject.next({type:"error",message:t&&t.response&&t.response.data&&t.response.data.Message||"提交失败"})}))},t.prototype.selectProcessChange=function(t){var e=this;this.clearHelp(),this.clearNode(),this.selectedProcessId=t;var i=new Bt;i.processDefinitionId=this.selectedProcessId,i.dataId=this.payload.dataId,this.taskService.startProcessSimulate(i).subscribe((function(t){e.response=t,e.setNextNode(t)}),(function(t){e.subject.next({type:"error",message:t&&t.response&&t.response.data&&t.response.data.Message||"该流程存在问题"})}))},t.prototype.getsimulationPathsIndexData=function(t){return this.destNodes.findIndex((function(e){return e.id===t}))},t.prototype.selectNodeChange=function(t){var e=this;this.clearHelp(),this.clearAssignInfos(),this.selectedNodeId=t,this.vm.open({nextNode:this.selectedNodeId});var i=this.getsimulationPathsIndexData(t);if(this.response.simulationPaths[i].nodeInfoList.every((function(t){return!0===t.resolved})))this.setAssignInfo(this.response.simulationPaths[i]);else{var n=new Bt;n.processDefinitionId=this.selectedProcessId,n.dataId=this.payload.dataId,n.nextFlowNodes=[],this.selectedNodeId.split("，").forEach((function(t,e){var i=new At;i.activityDefinitionId=t,n.nextFlowNodes.push(i)})),this.taskService.startProcessSimulate(n).subscribe((function(t){e.setAssignInfo(t.simulationPaths[0])}),(function(t){e.subject.next({type:"error",message:t&&t.response&&t.response.data&&t.response.data.Message||"该节点存在问题"})}))}},t.prototype.setNextNode=function(t){this.destNodes=t.simulationPaths&&t.simulationPaths.map((function(t){return{id:t.nodeInfoList.map((function(t){return t.activityDefinitionId})).join("，"),name:t.nodeInfoList.map((function(t){return t.activityDefinitionName})).join("，")}}));var e=t.simulationPaths.findIndex((function(t){return t.default}));e>-1?(1===this.destNodes.length?this.nodeReadOnly=!0:this.nodeReadOnly=!1,this.selectedNodeId=this.destNodes[e].id,this.setAssignInfo(t.simulationPaths[e])):(this.selectedNodeId="",this.nodeReadOnly=!1,this.nodePlaceholder="请选择"),this.vm.open({nextNodeOc:this.selectNodeChange.bind(this),nextNode:this.selectedNodeId,nextNodeData:this.destNodes,nextNodeReadFlag:this.nodeReadOnly,nextNodeHolder:this.nodePlaceholder})},t.prototype.setAssignInfo=function(t){var e=this;this.assignInfos=[],this.selectedNodeId.split("，").forEach((function(i){var n=t.nodeInfoList.find((function(t){return t.activityDefinitionId===i}));if(n){var o=n.selectedAssignees,r=!1,s="",a="请选择人员";o&&o.length>=1&&(r=!0,a="",o.forEach((function(t){s=s+t.name+", "})),s=s.slice(0,s.length-2)),n.anonymous&&(s=""===n.anonymousText?"":n.anonymousText&&n.anonymousText),e.assignInfos.push({label:(e.selectedNodeId&&e.selectedNodeId.split("，").length>1?n.activityDefinitionName:"")+"办理人员",selectedAssignees:o,assigneeReadFlag:r,assignee:s,assigneeHolder:a,assigneeInfo:O({},n.assigneeInfo,{assigneeUsers:{items:n.assigneeInfo&&n.assigneeInfo.assigneeUsers||[]}}),assignees:n.selectedAssignees.map((function(t){return{id:t.id,name:t.name}})),activityName:n.activityDefinitionName,dependency:n.dependency,anonymous:n.anonymous,anonymousText:n.anonymousText})}else e.assignInfos.push({selectedAssignees:[],assigneeInfo:null,assignees:[],activityName:"",dependency:"",anonymous:n.anonymous,anonymousText:n.anonymousText})})),this.vm.open({assigneeOc:this.assigneeOc.bind(this),assignInfos:this.assignInfos})},t.prototype.assigneeOc=function(t,e){this.assignInfos[e].assignees=t.items,this.selectedValues[e]=t.value,this.vm.open({selectedValues:this.selectedValues})},t.prototype.clearHelp=function(){this.vm.open({selectedValues:["clear"]})},t.prototype.clearNode=function(){this.selectedNodeId="",this.destNodes=[],this.nodeReadOnly=!0,this.nodePlaceholder="",this.assignInfos=[],this.vm.open({nextNode:this.selectedNodeId,nextNodeData:this.destNodes,nextNodeReadFlag:this.nodeReadOnly,nodePlaceholder:this.nodePlaceholder,assignInfos:this.assignInfos})},t.prototype.clearAssignInfos=function(){this.assignInfos=[],this.vm.open({assignInfos:this.assignInfos})},t.prototype.back=function(){this.clearProcess(),this.subject.next({type:"success",message:""})},t.prototype.submit=function(){var t=this;if(this.selectedProcessId)if(this.selectedNodeId)if(this.assignInfos.filter((function(t){return(t.assigneeInfo&&t.assigneeInfo.assigneeUsers.items.length||t.selectedAssignees.length)&&!t.assignees.length})).length)this.subject.next({type:"error",message:"请选办理人员"});else{for(var e=this.selectedNodeId.split("，"),i=0;i<e.length;i++){var n={activityDefinitionId:e[i],activityDefinitionName:this.assignInfos[i].activityName,dependency:this.assignInfos[i].dependency,selectedAssignees:this.assignInfos[i].assigneeInfo?this.assignInfos[i].assignees:[],assigneeInfo:null,resolved:!1,anonymous:!1,anonymousText:""};this.payload.nextFlowNodes.push(n)}this.payload.processDefinitionId=this.selectedProcessId,this.taskService.startProcess(this.payload).subscribe((function(){t.clearProcess(),t.subject.next({type:"success",message:"提交成功"})}),(function(e){t.subject.next({type:"error",message:e&&e.response&&e.response.data&&e.response.data.Message||"提交失败"})}))}else this.subject.next({type:"error",message:"请选节点"});else this.subject.next({type:"error",message:"请选流程"})},t.prototype.getSubject=function(){return this.subject.asObservable()},t.prototype.clearProcess=function(){this.vm.close(),this.vm=null,this.selectedProcessId="",this.selectedNodeId="",this.processReadOnly=!1,this.nodeReadOnly=!0},t}()),Ot=t("ɵa",function(){function t(t,e,i,n){this.processSelectorService=t,this.taskService=e,this.loadingService=i,this.notifyService=n,this.subject=new d}return t.prototype.startProcess=function(t){var e=this,i=new d;return this.processSelectorService.setParam(t),this.processSelectorService.getSubject().subscribe((function(t){"success"===t.type?t.message&&(e.notifyService.success(t.message),i.next(!0)):"error"===t.type&&(i.next(!1),e.notifyService.error(t.message))}),(function(){e.loadingService.hide()})),i.asObservable()},t.prototype.cancelSubmit=function(t){var e=this,i=new d;return this.loadingService.show(),this.taskService.cancelSubmit(t).subscribe((function(t){i.next(!0),e.loadingService.hide(),e.notifyService.success("取消提交成功")}),(function(t){i.next(!1),e.loadingService.hide(),e.notifyService.error(t&&t.response&&t.response.data&&t.response.data.Message||"取消提交失败")})),i.asObservable()},t.prototype.submitWithBizDefKey=function(t,e){if(t){if(e){var i=new Bt;return i.dataId=t,i.bizDefKey=e,this.startProcess(i)}this.notifyService.error("入口单据Id不能为空")}else this.notifyService.error("表单id不能为空")},t.prototype.cancelSubmitWithDataId=function(t,e){if(t){if(e){var i=new Rt;return i.dataId=t,i.bizDefKey=e,this.cancelSubmit(i)}this.notifyService.error("入口单据Id不能为空")}else this.notifyService.error("表单id不能为空")},t.prototype.batchSubmitWithBizDefKey=function(t,e){var i=this;if(t)if(t.length){if(e){if(1===t.length)return(a=new Bt).bizDefKey=e,a.dataId=t[0],this.startProcess(a);var n=0,o=0,r=new d;this.loadingService.show();for(var s=0;s<t.length;s++){var a;(a=new Bt).bizDefKey=e,a.dataId=t[s],a.variables={simulate:!1},this.taskService.startProcess(a).subscribe((function(e){e.procDefs.length>1||e.nextFlowNodes.length>1?o++:n++,n+o===t.length&&(i.loadingService.hide(),r.next(!0),i.showBatchSubmitInfo("submit",n,o))}),(function(){o++,n+o===t.length&&(i.loadingService.hide(),r.next(!1),i.showBatchSubmitInfo("submit",n,o))}))}return r.asObservable()}this.notifyService.error("入口单据ID不能为空")}else this.notifyService.error("请选择数据");else this.notifyService.error("dataId不能为空")},t.prototype.batchCancelSubmitWithDataId=function(t,e){var i=this;if(t)if(t.length){if(e){var n=new d,o=0,r=0;this.loadingService.show();for(var s=0;s<t.length;s++){var a=new Rt;a.dataId=t[s],a.bizDefKey=e,this.taskService.cancelSubmit(a).subscribe((function(e){++o+r===t.length&&(i.loadingService.hide(),n.next(!0),i.showBatchSubmitInfo("cancel",o,r))}),(function(){r++,o+r===t.length&&(i.loadingService.hide(),n.next(!1),i.showBatchSubmitInfo("cancel",o,r))}))}return n.asObservable()}this.notifyService.error("入口单据ID不能为空")}else this.notifyService.error("请选择数据");else this.notifyService.error("dataId不能为空")},t.prototype.childSubmit=function(t,e,i){if(t&&e){if(i){var n=new Bt;return n.dataId=t+","+e,n.bizDefKey=i,this.startProcess(n)}this.notifyService.error("入口单据ID不能为空")}else this.notifyService.error("dataId不能为空")},t.prototype.childCancelSubmit=function(t,e,i){if(t&&e){if(i){var n=new Rt;return n.dataId=t+","+e,n.bizDefKey=i,this.cancelSubmit(n)}this.notifyService.error("入口单据ID不能为空")}else this.notifyService.error("dataId不能为空")},t.prototype.childBatchSubmit=function(t,e,i){if(t&&e){if(i){var n=e.map((function(e){return t+","+e}));return this.batchSubmitWithBizDefKey(n,i)}this.notifyService.error("入口单据ID不能为空")}else this.notifyService.error("dataId不能为空")},t.prototype.childBatchCancelSubmit=function(t,e,i){if(t&&e){if(i){var n=e.map((function(e){return t+","+e}));return this.batchCancelSubmitWithDataId(n,i)}this.notifyService.error("入口单据ID不能为空")}else this.notifyService.error("dataId不能为空")},t.prototype.showBatchSubmitInfo=function(t,e,i){e&&!i&&("submit"===t&&this.notifyService.success("提交审批成功！"),"cancel"===t&&this.notifyService.success("取消提交成功！")),e&&i&&this.notifyService.warning("操作成功"+e+"条，失败"+i+"条!"),!e&&i&&("submit"===t&&this.notifyService.error("提交审批失败！"),"cancel"===t&&this.notifyService.error("取消提交失败！"))},t}());t("COMMAND_SERVICES_APP_PROVIDERS",[{provide:T,useClass:T,deps:[]},{provide:F,useClass:F,deps:[]},{provide:j,useClass:j,deps:[]},{provide:V,useClass:V,deps:[]},{provide:z,useClass:z,deps:[]},{provide:lt,useClass:lt,deps:[]},{provide:B,useClass:z,deps:[j,lt]}]),t("COMMAND_SERVICES_VIEWMODEL_PROVIDERS",[{provide:st,useClass:st,deps:[w,at,lt]},{provide:ht,useClass:ht,deps:[w]},{provide:J,useClass:J,deps:[w]},{provide:ft,useClass:ft,deps:[w]},{provide:vt,useClass:vt,deps:[w]},{provide:gt,useClass:gt,deps:[w]},{provide:U,useClass:U,deps:[w]},{provide:L,useClass:L,deps:[w]},{provide:H,useClass:H,deps:[w]},{provide:J,useClass:J,deps:[w]},{provide:G,useClass:G,deps:[w]},{provide:Y,useClass:Y,deps:[w]},{provide:Q,useClass:Q,deps:[w]},{provide:X,useClass:X,deps:[w]},{provide:Z,useClass:Z,deps:[w]},{provide:tt,useClass:tt,deps:[w]},{provide:et,useClass:et,deps:[w]},{provide:it,useClass:it,deps:[w]},{provide:nt,useClass:nt,deps:[w]},{provide:rt,useClass:rt,deps:[w]},{provide:ct,useClass:ct,deps:[w]},{provide:Dt,useClass:Dt,deps:[v]},{provide:Mt,useClass:Mt,deps:[Dt]},{provide:Ot,useClass:Ot,deps:[Mt,Dt,T,j]},{provide:ot,useClass:ot,deps:[Ot,w]},{provide:mt,useClass:mt,deps:[w]},{provide:Ct,useClass:Ct,deps:[w]},{provide:wt,useClass:wt,deps:[w,J,tt,mt]},{provide:xt,useClass:xt,deps:[w,J,tt,Ct]},{provide:St,useClass:St,deps:[w]},{provide:It,useClass:It,deps:[w]},{provide:_,useClass:_,deps:[w]},{provide:Pt,useClass:Pt,deps:[v,w,T]}])}}}));

!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@farris/ui-common/number"),require("@progress/kendo-angular-dropdowns"),require("@farris/extend-file-upload"),require("primeng/treetable"),require("@farris/ui-common/date"),require("@farris/ui-editor"),require("@gsp-cmp/querysolution"),require("@farris/ui-text"),require("@farris/ui-list-nav"),require("@farris/ui-list-view"),require("@farris/ui-view-change"),require("@farris/ui-html-editor"),require("@farris/ui-section"),require("@farris/ui-input-group"),require("@farris/ui-datepicker"),require("@farris/ui-time-picker"),require("@farris/ui-number-spinner"),require("@farris/ui-combo-list"),require("@farris/ui-lookup"),require("@farris/ui-treetable"),require("@farris/ui-wizard"),require("@farris/discussion-group"),require("@farris/ui-nav"),require("@farris/ui-multi-select"),require("@farris/ui-scrollspy"),require("@farris/ui-combo-lookup"),require("@farris/appointment-calendar"),require("lodash-es"),require("@farris/ui-datagrid"),require("@farris/ui-filter"),require("@farris/ui-list-filter"),require("rxjs"),require("rxjs/operators"),require("@gsp-svc/formdoc-upload"),require("@farris/rtf"),require("@farris/ui-locale"),require("@farris/ui-common/column"),require("@farris/devkit"),require("bignumber.js"),require("moment"),require("@farris/ui-dialog"),require("@angular/core"),require("@angular/common"),require("@progress/kendo-angular-grid"),require("@farris/ui-common")):"function"==typeof define&&define.amd?define("@farris/kendo-binding",["exports","@farris/ui-common/number","@progress/kendo-angular-dropdowns","@farris/extend-file-upload","primeng/treetable","@farris/ui-common/date","@farris/ui-editor","@gsp-cmp/querysolution","@farris/ui-text","@farris/ui-list-nav","@farris/ui-list-view","@farris/ui-view-change","@farris/ui-html-editor","@farris/ui-section","@farris/ui-input-group","@farris/ui-datepicker","@farris/ui-time-picker","@farris/ui-number-spinner","@farris/ui-combo-list","@farris/ui-lookup","@farris/ui-treetable","@farris/ui-wizard","@farris/discussion-group","@farris/ui-nav","@farris/ui-multi-select","@farris/ui-scrollspy","@farris/ui-combo-lookup","@farris/appointment-calendar","lodash-es","@farris/ui-datagrid","@farris/ui-filter","@farris/ui-list-filter","rxjs","rxjs/operators","@gsp-svc/formdoc-upload","@farris/rtf","@farris/ui-locale","@farris/ui-common/column","@farris/devkit","bignumber.js","moment","@farris/ui-dialog","@angular/core","@angular/common","@progress/kendo-angular-grid","@farris/ui-common"],t):t((e.farris=e.farris||{},e.farris["kendo-binding"]={}),e.number,e.kendoAngularDropdowns,e.extendFileUpload,e.treetable,e.date,e.uiEditor,e.querysolution,e.uiText,e.uiListNav,e.uiListView,e.uiViewChange,e.uiHtmlEditor,e.uiSection,e.uiInputGroup,e.uiDatepicker,e.uiTimePicker,e.uiNumberSpinner,e.uiComboList,e.uiLookup,e.uiTreetable,e.uiWizard,e.discussionGroup,e.uiNav,e.uiMultiSelect,e.uiScrollspy,e.uiComboLookup,e.appointmentCalendar,e.lodashEs,e.uiDatagrid,e.uiFilter,e.uiListFilter,e.rxjs,e.rxjs.operators,e.formdocUpload,e.rtf,e.uiLocale,e.column,e.devkit,e.bignumber_js,e.moment,e.uiDialog,e.ng.core,e.ng.common,e.kendoAngularGrid,e.uiCommon)}(this,function(e,t,i,n,r,o,a,s,p,d,l,u,c,h,f,g,y,m,v,C,b,D,I,S,x,w,E,P,O,L,T,R,F,M,k,N,j,A,V,B,H,_,K,z,G,q){"use strict";H=H&&H.hasOwnProperty("default")?H["default"]:H;var U=($.prototype.convertFrom=function(e){return e.split(this.separator)},$.prototype.convertTo=function(e){return e.join(this.separator)},$);function $(e){void 0===e&&(e=","),this.separator=e}var W=(J.prototype.convertFrom=function(e){return!0===V.DateUtil.isEmptyDateString(e)?null:V.DateUtil.parse(e)},J.prototype.convertTo=function(e){if(!e)return null;if("[object Date]"!==Object.prototype.toString.call(e))return e;var t=e.getFullYear().toString();t=t.length<4?"0".repeat(4-t.length)+t:t;var i=(e.getMonth()+1).toString();i=1===i.length?"0"+i:i;var n=e.getDate().toString();n=1===n.length?"0"+n:n;var r=e.getHours().toString();r=1===r.length?"0"+r:r;var o=e.getMinutes().toString();o=1===o.length?"0"+o:o;var a=e.getSeconds().toString();return t+"-"+i+"-"+n+" "+r+":"+o+":"+(a=1===a.length?"0"+a:a)},J);function J(e){this.format=e}var Y=(Q.prototype.convertFrom=function(e){return Object.assign({},e)},Q.prototype.convertTo=function(e){return e},Q);function Q(){}var X=(Z.prototype.convertFrom=function(e){return e?JSON.parse(e):[]},Z.prototype.convertTo=function(e){return JSON.stringify(e)},Z);function Z(){}var ee=function(e,t){return(ee=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)};function te(e,t){function i(){this.constructor=e}ee(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}var ie=function(){return(ie=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++)for(var r in t=arguments[i])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};function ne(e){var t="function"==typeof Symbol&&e[Symbol.iterator],i=0;return t?t.call(e):{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}}}function re(e,t){var i="function"==typeof Symbol&&e[Symbol.iterator];if(!i)return e;var n,r,o=i.call(e),a=[];try{for(;(void 0===t||0<t--)&&!(n=o.next()).done;)a.push(n.value)}catch(s){r={error:s}}finally{try{n&&!n.done&&(i=o["return"])&&i.call(o)}finally{if(r)throw r.error}}return a}function oe(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(re(arguments[t]));return e}var ae=(se.prototype.getColumnFormat=function(e,t){var i=this.getValue(e,t.dataField),n=t.dataType;return"enum"===n?this.getEnumText(i,t):"boolean"===n?i?"是":"否":"date"===n?this.getFormatDate(i,t):"number"===n?this.getFormatNumber(i,t):this.getMultiText(i,t)},se.prototype.getValue=function(e,t){return t.indexOf(".")<0?e[t]:t.split(".").reduce(function(e,t){return e[t]},e)},se.prototype.getEnumText=function(t,e){var i,n=e.enumData;if(n)return n.forEach(function(e){e.value===t&&(i=e.name)}),i},se.prototype.getFormatDate=function(e,t){if(!0===V.DateUtil.isEmptyDateString(e))return"";var i=t.format;return i?this.dateService.formatTo(e,i):e},se.prototype.getFormatNumber=function(e,t){var i;if(t&&t.format?i=parseInt(t.format.substr(1),10):t&&t.editor&&(i=t.editor.precision),isNaN(i)&&(i=2),!e&&0!==e)return"";var n={prefix:t.prefix?t.prefix:"",suffix:t.suffix?t.suffix:"",precision:i,thousand:",",stripZeros:!1};return this.numberService.formatMoney(e,n)},se.prototype.getMultiText=function(e,t){var i=e;if(""===i||i||(i=""),"string"!=typeof i)throw new Error(typeof i+"类型值不合法，无法进行格式化");return i=i.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\"/g,"&quot;").replace(/\'/g,"&#39;").replace(/\//g,"&#x2F;"),t.editor&&"MultiTextBox"===t.editor.type&&-1<i.indexOf("\n")?i.replace(/\n/g,"<br>"):i},se.decorators=[{type:K.Injectable}],se.ctorParameters=function(){return[{type:o.DateTimeHelperService},{type:t.NumberHelperService}]},se);function se(e,t){this.dateService=e,this.numberService=t}var pe=(de.prototype.setFormat=function(e){e.columns.forEach(function(e){var t=e.dataType;e.formatter||("date"===t?e.formatter={type:"datetime",options:{format:e.format}}:"number"===t?e.formatter={type:"number",options:{prefix:e.prefix?e.prefix:"",suffix:e.suffix?e.suffix:"",precision:e.precision,thousand:",",stripZeros:!1}}:"enum"===t?e.formatter={type:"enum",options:{data:e.enumData,valueField:"value",textField:"name"}}:"boolean"===t&&(e.formatter={type:"enum",options:{data:[{name:"是",value:!0},{name:"否",value:!1}],valueField:"value",textField:"name"}}))})},de.decorators=[{type:K.Injectable}],de.ctorParameters=function(){return[]},de);function de(){}var le=(ue.prototype.transform=function(e,t){if(!0===V.DateUtil.isEmptyDateString(e))return null;if(e.includes("年")){var i=e.replace("年","-").replace("月","-").replace("日","");return new Date(i)}return new Date(e)},ue.decorators=[{type:K.Pipe,args:[{name:"parseStrToDate"}]}],ue);function ue(){}var ce,he=(te(fe,ce=G.BaseFilterCellComponent),Object.defineProperty(fe.prototype,"selectedValue",{get:function(){var e=this.filterByField(this.column.dataField);return e?e.value:null},enumerable:!0,configurable:!0}),Object.defineProperty(fe.prototype,"defaultItem",{get:function(){return{value:null,name:"全部"}},enumerable:!0,configurable:!0}),fe.prototype.ngOnInit=function(){this.dropdownList.valueField="value",this.dropdownList.textField="name",this.dropdownList.valuePrimitive=!0,this.dropdownList.defaultItem=this.defaultItem,this.dropdownList.value=this.selectedValue,"enum"===this.column.dataType?this.dropdownList.data=this.column.enumData:"boolean"===this.column.dataType&&(this.dropdownList.data=[{value:!0,name:"是"},{value:!1,name:"否"}])},fe.prototype.onChange=function(e){this.applyFilter(null===e?this.removeFilter(this.column.dataField):this.updateFilter({field:this.column.dataField,operator:"eq",value:e}))},fe.prototype.getValue=function(e,t){return t.indexOf(".")<0?e[t]:t.split(".").reduce(function(e,t){return e[t]},e)},fe.decorators=[{type:K.Directive,args:[{selector:"[kendogridFilter]"}]}],fe.ctorParameters=function(){return[{type:i.DropDownListComponent},{type:G.FilterService}]},fe.propDecorators={filter:[{type:K.Input}],column:[{type:K.Input}],onChange:[{type:K.HostListener,args:["valueChange",["$event"]]}]},fe);function fe(e,t){var i=ce.call(this,t)||this;return i.dropdownList=e,i.filterService=t,i}var ge=(ye.prototype.transform=function(e,t){if(!this.viewModel.form||!this.viewModel.form.get(t))return{year:"年",month:"月",day:"日"};var i=this.viewModel.form.get(t).value,n=i;return n=n&&i.toISOString(),!0===V.DateUtil.isEmptyDateString(n)&&"yyyy年MM月dd日"===e?{year:" ",month:" ",day:" "}:{year:"年",month:"月",day:"日"}},ye.decorators=[{type:K.Pipe,args:[{name:"dateFormatPlaceholder"}]}],ye.ctorParameters=function(){return[{type:V.ViewModel}]},ye);function ye(e){this.viewModel=e}var me=(ve.prototype.transform=function(e,t){if(!e&&0!==e)return"";if("number"!==t.dataType)return e;var i=t.format;return e.toFixed(Number(i.substring(1)))},ve.decorators=[{type:K.Pipe,args:[{name:"formatTotal"}]}],ve);function ve(){}var Ce=(Object.defineProperty(be.prototype,"field",{get:function(){return this.column.field},enumerable:!0,configurable:!0}),Object.defineProperty(be.prototype,"aggrType",{get:function(){var e="none";return"boolean"==typeof this.aggregate?this.aggregate&&(e="sum"):"string"==typeof this.aggregate&&(e=this.aggregate),e},enumerable:!0,configurable:!0}),be.prototype.recalculateSummary=function(e){var t=this,i=null;if("sum"===this.aggrType){var n=e.toJSON().map(function(e){return t.field.split(".").reduce(function(e,t){return e[t]},e)});n&&n.length&&(i=n.reduce(function(e,t){return e+t}))}else"count"===this.aggrType&&(i=e.length);this.updateFooter(i)},be.prototype.updateFooter=function(e){this.aggregate&&(this.column.summary=e)},be.decorators=[{type:K.Directive,args:[{selector:"[aggregate]"}]}],be.ctorParameters=function(){return[{type:G.ColumnComponent},{type:K.NgZone}]},be.propDecorators={aggregate:[{type:K.Input}]},be);function be(e,t){this.column=e,this.ngZone=t}var De=(Ie.decorators=[{type:K.Directive,args:[{selector:"[farrisSummary]"}]}],Ie.ctorParameters=function(){return[{type:V.BindingData}]},Ie.propDecorators={summary:[{type:K.Input,args:["farrisSummary"]}]},Ie);function Ie(e){this.bindingData=e}var Se=(xe.renderClickChangedRow=function(e,t){if(e){var i=t.currentRowIndex;this.addRowSelectedStyle(e,i);var n=t.lastRowIndex;this.checIfIsSameRelativeIndex(e,i,n)||this.removeRowSelectedStyle(e,n)}},xe.checIfIsSameRelativeIndex=function(e,t,i){var n=!1;return t===i?n=!0:Math.abs(t-i)%e.pageSize==0?n=!0:n},xe.checkIfEnablePaging=function(e){var t=!1;return e&&("boolean"==typeof e.pageable?t=e.pageable:"object"==typeof e.pageable&&(t=!0)),t},xe.renderSelectedChangeCheckbox=function(e,t){var i=t.index,n=this.getTrCollection(e);if(!(null==n||n.length<=0||n.length<i)){var r=n[i];r&&(t.selected?this.appendAtrributeValue(r,"class",this.CHECKBOXED_ROW_STYLE_NAME):this.removeAttributeSpecificValue(r,"class",this.CHECKBOXED_ROW_STYLE_NAME))}},xe.addRowSelectedStyle=function(e,t){if(e&&!(t<0)){var i=this.getRelativeRowInCurrentPage(e,t);i&&this.appendAtrributeValue(i,"class",this.CURRENT_ROW_STYLE_NAME)}},xe.removeRowSelectedStyle=function(e,t){if(e&&!(t<0)){var i=this.getRelativeRowInCurrentPage(e,t);i&&this.removeAttributeSpecificValue(i,"class",this.CURRENT_ROW_STYLE_NAME)}},xe.getRelativeRowInCurrentPage=function(e,t){var i=null;if(!e||t<0)return i;var n=e.wrapper;this.checkIfEnablePaging(e)&&(t%=e.pageSize);var r=this.getTrCollection(n);return null==r||r.length<=0?i:i=r[t]},xe.getTrCollection=function(e){if(!e||!e.nativeElement)return null;var t=e.nativeElement.getElementsByTagName("tbody");return!t||t.length<=0?null:t[0].getElementsByTagName("tr")},xe.appendAtrributeValue=function(e,t,i){var n=e.getAttribute(t);null===n||""===n||n.length<=0?n=i:n.indexOf(i)<0&&(n+=" "+i),e.setAttribute(t,n)},xe.removeAttributeSpecificValue=function(e,t,i){var n=e.getAttribute(t);if(n){var r=n.lastIndexOf(i);r<0||(n=n.substring(0,r-1)+" "+n.substring(r+i.length),e.setAttribute(t,n))}},xe.CURRENT_ROW_STYLE_NAME="f-state-selected",xe.CHECKBOXED_ROW_STYLE_NAME="f-state-checked",xe);function xe(){}var we,Ee=function zn(){},Pe=(te(Oe,we=G.DataBindingDirective),Object.defineProperty(Oe.prototype,"gridOption",{get:function(){return this.grid.gridOption},enumerable:!0,configurable:!0}),Object.defineProperty(Oe.prototype,"len",{get:function(){return this.grid.columns.length},enumerable:!0,configurable:!0}),Object.defineProperty(Oe.prototype,"IsMultipleSelectionMode",{get:function(){return this.grid&&(this.grid.selectable?"multiple"===this.grid.selectable.mode?this.isMultipleSelectionMode=!0:this.isMultipleSelectionMode=!1:this.grid.selectableSettings&&"multiple"===this.grid.selectableSettings.mode&&(this.isMultipleSelectionMode=!0)),this.isMultipleSelectionMode},enumerable:!0,configurable:!0}),Object.defineProperty(Oe.prototype,"bindingList",{get:function(){if("/"===this.viewModel.bindingPath||!this.viewModel.bindingPath)return this.bindingData.list;var e=this.viewModel.bindingPath.substr(1),t=(e=e[0].toLowerCase()+e.substring(1,e.length)).split("/").filter(function(e){return""!==e});return this.bindingData.getValue(t)},enumerable:!0,configurable:!0}),Oe.prototype.getPagingInfo=function(){var e=this.viewModel.bindingPath,t=this.viewModel.bindingData.pagingInfo;return"/"===e||e.substr(1).split("/").filter(function(e){return!!e&&0<e.length}).map(function(e){return e.substring(0,e.length-1)}).forEach(function(e){t=t&&t[e]||{}}),t},Oe.prototype.ngOnInit=function(){var i=this;if(we.prototype.ngOnInit.call(this),this.initDataState(),this.refreshView(),this.viewModel&&this.viewModel.frameContext&&this.viewModel.frameContext.frameComponent&&(this.viewModel.frameContext.frameComponent.componentType=V.ComponentType.kendoGridComponent),this.bindingChangeSubscription=this.bindingData.changes.subscribe(function(e){i.refreshView(e),e.type!==V.ChangeType.Load||i.isMultipleSelectionMode&&i.checkIfChangeMatchBindingPath(e)&&(i.selectionDir.selectedKeys=[],i.viewModel.uiState.setPropertyValue("ids",i.selectionDir.selectedKeys),i.ngZone.runOutsideAngular(function(){setTimeout(function(){var e=new Ee,t=Se.checkIfEnablePaging(i.grid);i.rowIndex=t?i.grid.skip:0,e.currentRowIndex=i.rowIndex,e.lastRowIndex=i.lastRowIndex,i.handleSelectedRowChange(e)},300)})),e.type===V.ChangeType.Remove&&i.syncDeletedKeys(e.value);var t=i.checkIfChangeMatchBindingPath(e);t&&i.handleSelectedKeyChange(i.bindingList.currentId),t&&i.checkCurrentRowIdExists()&&e.type===V.ChangeType.SelectionChanged&&!i.dataId&&i.renderCurrentRow(i.bindingList.currentId),e.type!==V.ChangeType.Load&&e.type!==V.ChangeType.SelectionChanged&&e.type!==V.ChangeType.Append&&e.type!==V.ChangeType.Remove||i.grid&&i.grid.changeDetectorRef&&i.grid.changeDetectorRef.detectChanges&&i.grid.changeDetectorRef.detectChanges()}),!0===this.editable&&null===this.form)throw Error("启用编辑时，必须指定form");if(this.grid&&this.farrisBindingGridOption&&this.farrisBindingGridOption.fields){var e=this.farrisBindingGridOption.fields;if(this.farrisBindingGridOption.lockable=function(e){return e.some(function(e){return e.frozen})},this.rowClass.emit(this.grid),e.forEach(function(e){e.linkedLabelEnabled&&!e.linkEvent&&(e.linkEvent=function(){}),e.getColumnFormat||(e.getColumnFormat=function(e,t){return i.kendogridFormatSer.getColumnFormat(e,t)}),e.getClassName||(e.getClassName=function(e,t){return""}),e.editor&&"LookupEdit"===e.editor.type&&(e.dictPicking||(e.dictPicking=function(e){return F.of(!0)}),e.dictPicked||(e.dictPicked=function(e){return i.cellClickHandler(i.cellClickParam),F.of(!0)}))}),this.bindingGridOption(),this.IsMultipleSelectionMode){var t=this;this.ngZone.runOutsideAngular(function(){setTimeout(function(){var e=new Ee;e.currentRowIndex=t.rowIndex,e.lastRowIndex=t.lastRowIndex,t.handleSelectedRowChange(e)},300)})}}},Oe.prototype.ngAfterViewInit=function(){},Oe.prototype.checkIfChangeMatchBindingPath=function(e){var t=!1;if(!e||!e.path)return t;var i=e.path;if(!i)return t;if(!this.bindingData&&!this.bindingData.bindingPath)return t;var n=this.bindingData.bindingPath.split("/");return n.length<=0||(0===i.length?"/"===this.bindingData.bindingPath&&(t=!0):1===e.path.length?2===n.length&&n[1]===e.path[0]&&(t=!0):2===e.path.length&&3===n.length&&n[1]===e.path[0]&&n[2]===e.path[1]&&(t=!0)),t},Oe.prototype.handleSelectedKeyChange=function(e){var t=this.selectionDir.selectedKeys;if(e){if((this.IsMultipleSelectionMode?this.currentRowId:0===this.selectionDir.selectedKeys.length?null:this.selectionDir.selectedKeys[0])!==e){var i={};i.currentRowId=e,this.currentRowId=e,this.emitSelectedRowChange(i)}}else 0<t.length&&-1===t.splice(0,t.length).indexOf(null)&&this.emitSelectedRowChange({currentRowId:null})},Oe.prototype.emitSelectedRowChange=function(e){if(!this.IsMultipleSelectionMode){var t=e.currentRowId;this.selectionDir.selectedKeys=[t],this.selectionDir.selectedKeysChange.emit(this.selectionDir.selectedKeys)}this.selectedRowChange.emit(e)},Oe.prototype.checkCurrentRowIdExists=function(){var e=!1;return this.bindingList&&this.bindingList.currentId&&0<this.bindingList.currentId.length&&(e=!0),e},Oe.prototype.syncDeletedKeys=function(e){var i=this;e&&e.forEach(function(e){var t=i.selectionDir.selectedKeys.indexOf(e);-1<t&&(i.selectionDir.selectedKeys.splice(t,1),0===i.selectionDir.selectedKeys.length&&i.emitSelectedRowChange({currentRowId:null}))})},Oe.prototype.renderCurrentRow=function(e){e&&""!==e&&(this.IsMultipleSelectionMode||this.renderSelectionRow(this.bindingList.currentId,this.selectionDir.selectedKeys))},Oe.prototype.ngOnChanges=function(e){we.prototype.ngOnChanges.call(this,e),this.refreshView()},Oe.prototype.ngOnDestroy=function(){this.bindingChangeSubscription&&this.bindingChangeSubscription.unsubscribe()},Oe.prototype.refreshView=function(e){this.refreshData(e),this.refreshSummary()},Oe.prototype.bindData=function(){},Oe.prototype.refreshData=function(e){var t=0,i=this.getPagingInfo()||{},n=i.pageIndex,r=void 0===n?1:n,o=i.pageSize,a=void 0===o?0:o;0<r&&(t=(r-1)*a),this.updatePager(a,t),this.endCellEdit(e),this.data=this.bindingList.toJSON({ignoreMultiLangInput:!0})},Oe.prototype.endCellEdit=function(e){var t=this.grid.isEditing;e&&e.type===V.ChangeType.Load&&t&&this.grid.cancelCell()},Oe.prototype.refreshSummary=function(){var t=this;this.aggrColumns&&this.aggrColumns.forEach(function(e){e.aggregate&&e.recalculateSummary(t.bindingList)})},Oe.prototype.onPageChange=function(e){var t=e||{},i=t.skip,n=void 0===i?0:i,r=t.take,o=void 0===r?0:r;this.bindingData.setPagingInfo(n,o,this.viewModel.bindingPath),Se.removeRowSelectedStyle(this.grid,this.rowIndex)},Oe.prototype.resetPageInfo=function(){var e=(this.getPagingInfo()||{}).pageSize,t=void 0===e?0:e;this.bindingData.setPagingInfo(0,t,this.viewModel.bindingPath)},Oe.prototype.initDataState=function(){var e,t,i=[];if(this.groupAggrFields)try{for(var n=ne(this.groupAggrFields),r=n.next();!r.done;r=n.next()){var o=r.value;i.push({field:o,aggregate:"sum"})}}catch(s){e={error:s}}finally{try{r&&!r.done&&(t=n["return"])&&t.call(n)}finally{if(e)throw e.error}}var a=[];this.groupField&&a.push({field:this.groupField,aggregates:i}),this.group=a},Oe.prototype.onStateChange=function(e){e.skip!==this.currentSkip&&(e.skip=this.currentSkip),this.applyState(e),this.rebind()},Oe.prototype.process=function(e){e.skip=0;var t=this.getPagingInfo()||{},i=t.pageSize,n=void 0===i?0:i,r=t.total,o=void 0===r?0:r;0===e.take?e.take=this.bindingList.length:e.take=n;var a=e.take<this.bindingList.length;a&&(e.take=this.bindingList.length);var s=we.prototype.process.call(this,e);return s.total=Math.max(o,this.bindingList.length),a&&(s.total=o||1),s},Oe.prototype.selectedKeysChangeHandler=function(e){this.IsMultipleSelectionMode||this.setSelectionIdToBindingData(e[e.length-1]),this.viewModel.uiState.setPropertyValue("ids",this.selectionDir.selectedKeys)},Oe.prototype.selectionChangeHandler=function(e){this.IsMultipleSelectionMode&&this.handleSelectedCheckboxChange(this.grid.wrapper,e)},Oe.prototype.handleSelectedCheckboxChange=function(e,t){Se.renderSelectedChangeCheckbox(e,t),this.selectedCheckboxChange.emit(t)},Oe.prototype.cellClickHandler=function(t){if(this.cellClickParam=t,this.cellClickEvent=t,this.rowIndex=t.rowIndex,this.columnIndex=t.columnIndex,this.sender=t.sender,this.IsMultipleSelectionMode&&!this.gridOption.groupable){var e=t.rowIndex;if(e!==this.lastRowIndex){var i=new Ee;i.currentRowIndex=e,i.lastRowIndex=this.lastRowIndex,this.handleSelectedRowChange(i)}}if(this.dataId=this.getSelectedIdFromGrid(t.dataItem),this.setSelectionIdToBindingData(this.dataId),this.isEditable()&&t.column.editTemplate&&"click"===t.type&&!t.isEdited){var n=this.getColumns(this.gridOption.fields),r=this.getColumns(n),o=r.findIndex(function(e){return e.dataField===t.column.field}),a=r.slice(0,o+1).filter(function(e){return!e.visible}).length;this.rowIndex=t.rowIndex,this.columnIndex=t.columnIndex+a,this.hiddenColLen=a,this.sender=t.sender,this.setEditable(this.rowIndex,this.columnIndex)}},Oe.prototype.handleSelectedRowChange=function(e){Se.renderClickChangedRow(this.grid,e),this.rowIndex=e.currentRowIndex,this.lastRowIndex=e.currentRowIndex;var t=this.getPrimary(this.rowIndex);this.setSelectionIdToBindingData(t)},Oe.prototype.getPrimary=function(e){var t=this.grid.data;t&&!Array.isArray(t)&&t.hasOwnProperty("data")&&(t=t.data);var i=this.getPagingInfo()||{},n=i.pageIndex,r=void 0===n?1:n,o=i.pageSize,a=void 0===o?0:o,s=this.bindingList.skip,p=0===a||1===r?e:e-s;return t.length>p?t[p][this.bindingList.primaryKey]:null},Oe.prototype.cellCloseHandler=function(e){if(this.dialogSer.hasDialogOpened())e.preventDefault();else{if(this.rts){if(this.rts.getFormState("lookup.pending"))return void e.preventDefault();if(e.originalEvent&&this.rts.eventPath(e.originalEvent).find(function(e){return"FARRIS-DIALOG"===e.tagName}))return void e.preventDefault()}var t=e.formGroup,i=e.column,n=e.dataItem,r=(e.rowIndex,this.getColumns(this.gridOption.fields).find(function(e){return e.dataField===i.field})),o=t[r.editor.binding.path].value;r.getDynamicData&&(r=r.getDynamicData(n,r)),this.setValue(o,r)}},Oe.prototype.enterCell=function(e){var t=this;if(!e.shiftKey&&13===e.keyCode){if(e.preventDefault(),!this.sender)return;e.target.blur(),this.ngZone.runOutsideAngular(function(){setTimeout(function(){t.rts&&t.rts.getFormState("lookup.pending")?e.preventDefault():t.enterNextCell()},201)})}},Oe.prototype.bindingGridOption=function(){this.farrisBindingGridOption&&Object.defineProperty(this.grid,"gridOption",{value:this.farrisBindingGridOption})},Oe.prototype.updatePager=function(e,t){0===e?(this.currentSkip=0,this.pageSize=0,this.skip=0,this.grid.pageable=!1):(this.currentSkip=t,this.skip=t,this.pageSize=e,this.grid.pageable={buttonCount:10,info:!0,type:"numeric",pageSizes:!1,previousNext:!0})},Oe.prototype.setEditable=function(e,t){var i=this.grid.data.data,n=this.getPagingInfo()||{},r=n.pageIndex,o=void 0===r?1:r,a=n.pageSize,s=void 0===a?0:a,p=this.bindingList.skip,d=0===s||1===o?e:e-p,l=i[d];this.gridOption.groupable&&(l=this.getGroupItem(i,d));var u=this.getColumns(this.gridOption.fields),c=this.getColumns(u),h=t;this.grid.gridOption.showLineNumber&&(h-=1),this.grid.selectable&&"multiple"===this.grid.selectable.mode&&(h-=1);var f=c[h],g={dataItem:l,column:f,rowIndex:e,columnIndex:h};f&&!f.editable&&(f.editable=function(e){return!0}),f&&this.notReadOnly(f,g)&&(this.dataId=this.getSelectedIdFromGrid(l),this.setSelectionIdToBindingData(this.dataId),this.sender.editCell(e,t-this.hiddenColLen,this.viewModel.form))},Oe.prototype.updateIndex=function(e,t){var i=(t+1)%this.len;return i?{rowIndex:e,columnIndex:i}:{rowIndex:(e+1)%this.bindingList.toJSON().length,columnIndex:i}},Oe.prototype.notReadOnly=function(e,t){return!!e&&e.editable(t)&&!e.editor.readonly},Oe.prototype.setValue=function(e,t){var i=t.dataType,n=this.viewModel.bindingData,r=this.getFieldPaths(n.bindingPath,t.dataField);if("date"===i){var o=this.dateService.formatTo(e,"yyyy-MM-dd HH:mm:ss");o=o||"",this.viewModel.bindingData.setValue(r,o,!0,!0)}else this.viewModel.bindingData.setValue(r,e,!0,!0)},Oe.prototype.getGroupItem=function(e,t){var i=t;for(var n in e){if(i<e[n].items.length)return e[n].items[i];i-=e[n].items.length}},Oe.prototype.getValue=function(e,t){return t.indexOf(".")<0?e[t]:t.split(".").reduce(function(e,t){return e[t]},e)},Oe.prototype.getFieldPaths=function(e,t){return(1<e.length?e.substr(1).replace(/\//g,".")+"."+t:t).split(".")},Oe.prototype.enterNextCell=function(){var e=this,t=this.updateIndex(this.rowIndex,this.columnIndex);if(!t.columnIndex&&!t.rowIndex){var i=this.bindingList.toJSON().length;if(this.appendRow.emit(),this.appendRow.observers&&this.appendRow.observers.length)return void(this.interVal=setInterval(function(){e.bindingList.toJSON().length-1===i&&(e.setEditable(e.bindingList.toJSON().length-1,0),e.rowIndex=e.bindingList.toJSON().length-1,e.columnIndex=0,clearInterval(e.interVal))},0))}this.setEditable(t.rowIndex,t.columnIndex),this.rowIndex=t.rowIndex,this.columnIndex=t.columnIndex},Oe.prototype.getColumns=function(e){return e.some(function(e){return e.frozen})?oe(e.filter(function(e){return e.frozen}),e.filter(function(e){return!e.frozen})):e},Oe.prototype.renderSelectionRow=function(e,t){if(e&&""!==e){if(this.IsMultipleSelectionMode){if(0<=t.indexOf(e))return;t.push(e)}else{if(1===t.length&&t[0]===e)return;t.splice(0,t.length),t.push(e)}this.selectionDir.selectedKeysChange.emit(t)}},Oe.prototype.getSelectedIdFromGrid=function(e){return e[this.bindingList.primaryKey]},Oe.prototype.setSelectionIdToBindingData=function(e){this.bindingList.setCurrentId(e,!0)},Oe.prototype.isEditable=function(){return this.editable===undefined?!!this.viewModel.stateMachine&&this.viewModel.stateMachine.editable:this.editable},Oe.prototype.isDataChanged=function(){var e,t,i=!1,n=this.viewModel.frameContext.repository.entityCollection.toArray();try{for(var r=ne(n),o=r.next();!o.done;o=r.next())if(0<o.value.changes.length){i=!0;break}}catch(a){e={error:a}}finally{try{o&&!o.done&&(t=r["return"])&&t.call(r)}finally{if(e)throw e.error}}return i},Oe.decorators=[{type:K.Directive,args:[{selector:"[farrisBindingPath]"}]}],Oe.ctorParameters=function(){return[{type:V.BindingData},{type:V.UIState,decorators:[{type:K.Optional}]},{type:V.FrameEventBus,decorators:[{type:K.Optional}]},{type:V.ViewModel,decorators:[{type:K.Optional}]},{type:G.GridComponent},{type:G.SelectionDirective},{type:_.DialogService},{type:o.DateTimeHelperService},{type:ae},{type:q.RuntimeStateService},{type:K.NgZone}]},Oe.propDecorators={editable:[{type:K.Input,args:["farrisEditable"]}],form:[{type:K.Input,args:["farrisForm"]}],groupField:[{type:K.Input,args:["groupField"]}],groupAggrFields:[{type:K.Input,args:["groupAggrFields"]}],farrisBindingGridOption:[{type:K.Input}],rowClassName:[{type:K.Input}],appendRow:[{type:K.Output,args:["append-row"]}],sortChangeEvent:[{type:K.Output}],rowClass:[{type:K.Output}],selectedRowChange:[{type:K.Output}],selectedCheckboxChange:[{type:K.Output}],aggrColumns:[{type:K.ContentChildren,args:[Ce]}],onPageChange:[{type:K.HostListener,args:["pageChange",["$event"]]}],selectedKeysChangeHandler:[{type:K.HostListener,args:["selectedKeysChange",["$event"]]}],selectionChangeHandler:[{type:K.HostListener,args:["selectionChange",["$event"]]}],cellClickHandler:[{type:K.HostListener,args:["cellClick",["$event"]]}],cellCloseHandler:[{type:K.HostListener,args:["cellClose",["$event"]]}],enterCell:[{type:K.HostListener,args:["keydown",["$event"]]}]},Oe);function Oe(e,t,i,n,r,o,a,s,p,d,l){var u=we.call(this,r)||this;u.bindingData=e,u.uiState=t,u.eventBus=i,u.viewModel=n,u.grid=r,u.selectionDir=o,u.dialogSer=a,u.dateService=s,u.kendogridFormatSer=p,u.rts=d,u.ngZone=l,u.appendRow=new K.EventEmitter,u.sortChangeEvent=new K.EventEmitter,u.rowClass=new K.EventEmitter,u.hiddenColLen=0,u.rowIndex=0,u.columnIndex=0,u.currentSkip=0,u.isMultipleSelectionMode=!1,u.lastRowIndex=-1,u.selectedRowChange=new K.EventEmitter,u.selectedCheckboxChange=new K.EventEmitter,u.selectionDir.selectedKeys=[],u.viewModel.uiState.setPropertyValue("ids",u.selectionDir.selectedKeys);var c=u.viewModel.frameContext.getFormAppContext();return c&&c.hasOwnProperty("messagePipe")&&c.messagePipe.subscribe(function(e){u.grid.closeCell()}),u}var Le=(Object.defineProperty(Te.prototype,"expandLevel",{get:function(){return this.context&&this.context.hasOwnProperty("expandLevel")?this.context.expandLevel:-1},enumerable:!0,configurable:!0}),Object.defineProperty(Te.prototype,"component",{get:function(){return this.context&&this.context.component},enumerable:!0,configurable:!0}),Object.defineProperty(Te.prototype,"addTreeLoadCompleteListener",{get:function(){return this.context&&this.context.addTreeLoadCompleteListener||function(e){}},enumerable:!0,configurable:!0}),Te.prototype.updateTreeNode=function(e,t){this.allNodesData=e,this.initLevelGroup(),this.buildNodesDataMap(t)},Te.prototype.build=function(){var r=this,o=[],a={},s={};return this.allNodesData.forEach(function(e){var t=e.id,i=r.getParentId(e);!0===r.isNewNode(e)&&r.expandParentNode(e);var n=r.buildNode(e);s[t]=n,a[t]=a[t]||[],n.children=a[t],r.allNodesMap.set(e[r.primaryKey],n),i?(s[i]&&!0===s[i].unstableState&&(s[i].expanded=!0,s[i].unstableState=!1),a[i]=a[i]||[],a[i].push(n)):((!n.children||n.children.length<1)&&!0===n.expanded&&(n.unstableState=!0,n.expanded=!1),o.push(n))}),o},Te.prototype.build1=function(){var n,r=this;this.allNodesData.forEach(function(e){var t=r.getHierarchyInfo(e);if(t){var i=t.layer;isNaN(i)||(n===undefined?n=i:i<n&&(n=i))}});var e=n-1;return this.buildNodes("",e,this.allNodesData,this.allNodes),this.allNodes},Te.prototype.buildNodes=function(e,t,o,a){var s=this;this.getChildNodesData(e,t).forEach(function(e){!0===s.isNewNode(e)&&s.expandParentNode(e);var t=s.buildNode(e);a.push(t),s.allNodesMap.set(e[s.primaryKey],t);var i=s.getHierarchyInfo(e),n=i.layer,r=i.path;s.buildNodes(r,n,o,t.children)})},Te.prototype.buildNode=function(e){var t=this.isLeaf(e),i=this.shouldExpand(e);!this.isExpanded(e)&&i&&this.expandNode(e);var n=this.buildPaginationInfo(e),r={data:Object.assign({},e),children:[],expanded:i,leaf:t};return n&&(r.pagination=n),r},Te.prototype.buildPaginationInfo=function(e){var t=null;if(this.frameContext){var i="_NODE_"+this.getPrimary(e)+"_PAGINATION_INFO_",n=this.frameContext.params.get(i)||null;n&&1<n.pageCount&&(t={pageIndex:n.pageIndex,pageSize:n.pageSize,total:n.totalCount})}return t},Te.prototype.shouldExpand=function(e){var t=re([this.getNodeLayer(e),this.isLeaf(e)],2),i=t[0];if(t[1])return!1;var n=this.isExpanded(e);if(!n){var r=this.getPrimary(e);if(-1<this.nodesWaitExpand.findIndex(function(e){return e&&e.id===r}))return!1;if(-1<this.nodesShouldExpand.findIndex(function(e){return e===r}))return!0;if(-1===this.expandLevel)n=!1;else if(0===this.expandLevel)n=!0;else{n=i<=this.expandLevel;var o=this.getOldNode(e);o&&!o.expanded&&(n=!1)}}return n},Te.prototype.expandNode=function(e){var t=re([this.getNodePath(e),this.getNodeLayer(e)],2),i=t[0],n=t[1],r=this.getChildNodesData(i,n);if(!r||r.length<1){var o=this.getPrimary(e);this.nodesWaitExpand.findIndex(function(e){return e&&e.id===o})<0&&this.nodesWaitExpand.push({id:o,expanded:!1})}},Te.prototype.onTreeLoadComplete=function(){var e=this.nodesWaitExpand.findIndex(function(e){return!e.expanded}),t=this.nodesWaitExpand[e]||{},i=t.id;i&&this.component.findRowNode(i)&&(t.expanded=!0,this.component.expandNode(i))},Te.prototype.getPrimary=function(e){return e[this.primaryKey]},Te.prototype.getChildNodesData=function(r,o){var a=this,s=[];return this.allNodesData.forEach(function(e){var t=a.getHierarchyInfo(e);if(t){var i=t.layer,n=t.path;i===o+1&&n&&n.startsWith(r)&&s.push(e)}}),s},Te.prototype.getHierarchyInfo=function(e){return this.getValue(e,this.hierarchyInfoKey)},Te.prototype.initLevelGroup=function(){var i=this;this.levelGroup={},this.allNodesData.forEach(function(e){var t="level"+i.getHierarchyInfo(e).layer;i.levelGroup[t]?i.levelGroup[t].push(e):i.levelGroup[t]=[e]})},Te.prototype.getParentId=function(e){var i=this,n=this.getHierarchyInfo(e),t=(this.levelGroup[this.getLevelGroupKey(n.layer-1)]||[]).find(function(e){var t=i.getHierarchyInfo(e);return!0!==t.isDetail&&n.path.startsWith(t.path)});return t?t.id:null},Te.prototype.getLevelGroupKey=function(e){return"level"+e},Te.prototype.getValue=function(e,t){if(-1===t.indexOf("/"))return e[t];var i=t.split("/").filter(function(e){return e});return i.length<1?e:i.reduce(function(e,t){return e&&e[t]},e)},Te.prototype.getNodeLayer=function(e){return this.getHierarchyInfo(e).layer},Te.prototype.getNodePath=function(e){return this.getHierarchyInfo(e).path},Te.prototype.isExpanded=function(e){var t=this.getOldNode(e);return t?t.expanded:undefined},Te.prototype.isLeaf=function(e){return this.getHierarchyInfo(e).isDetail},Te.prototype.isNewNode=function(e){return 0!==this.allOldNodesMap.size&&!this.getOldNode(e)},Te.prototype.expandParentNode=function(e){var t=this.getParentNode(e);t&&(t.leaf=!1,t.expanded=!0)},Te.prototype.getParentNode=function(e){var n=this,t=this.getHierarchyInfo(e),r=t.layer,o=t.path;return Array.from(this.allNodesMap.values()).find(function(e){var t=n.getValue(e.data,n.hierarchyInfoKey).layer,i=n.getValue(e.data,n.hierarchyInfoKey).path;return r===t+1&&!0===o.startsWith(i)})},Te.prototype.getOldNode=function(e){var t=e[this.primaryKey];return this.allOldNodesMap.get(t)},Te.prototype.buildNodesDataMap=function(e){var t=this;e.forEach(function(e){t.allOldNodesMap.set(e.data[t.primaryKey],e),e.children&&t.buildNodesDataMap(e.children)})},Te);function Te(e,t,i,n,r){this.levelGroup={},this.nodesWaitExpand=[],this.primaryKey=i,this.hierarchyInfoKey=n,this.allNodes=[],this.allNodesData=e,this.context=r||{},this.nodesWaitExpand=[],this.nodesShouldExpand=r&&r.nodesShouldExpand||[],this.frameContext=r&&r.frameContext||null,this.addTreeLoadCompleteListener(this.onTreeLoadComplete.bind(this)),this.initLevelGroup(),this.allNodesMap=new Map,this.allOldNodesMap=new Map,this.buildNodesDataMap(t)}var Re=(Object.defineProperty(Fe.prototype,"expandLevel",{get:function(){return this.context&&this.context.hasOwnProperty("expandLevel")?this.context.expandLevel:-1},enumerable:!0,configurable:!0}),Object.defineProperty(Fe.prototype,"component",{get:function(){return this.context&&this.context.component},enumerable:!0,configurable:!0}),Object.defineProperty(Fe.prototype,"addTreeLoadCompleteListener",{get:function(){return this.context&&this.context.addTreeLoadCompleteListener||function(e){}},enumerable:!0,configurable:!0}),Fe.prototype.updateTreeNode=function(e,t){this.allNodesData=e,this.buildNodesDataMap(t)},Fe.prototype.build=function(){var r=this,o=[],a={},s={},p={};return this.allNodesData.forEach(function(e){var t=e.id,i=r.getHierarchyInfo(e).parentElement;!0===r.isNewNode(e)&&r.expandParentNode(e);var n=r.buildNode(e);p[t]=n,a[t]=a[t]||[],n.children=a[t],s[i]=s[i]||[],s[i].push(n),r.allNodesMap.set(e[r.primaryKey],n),i?(p[i]&&!0===p[i].unstableState&&(p[i].expanded=!0,p[i].unstableState=!1),a[i]=a[i]||[],a[i].push(n)):((!n.children||n.children.length<1)&&!0===n.expanded&&(n.unstableState=!0,n.expanded=!1),o.push(n))}),(!o||o.length<1)&&this.allNodesData&&0<this.allNodesData.length&&Object.keys(s).forEach(function(t){r.allNodesData.find(function(e){return e.id===t})||(o=o.concat(s[t]))}),o},Fe.prototype.build1=function(){var n,r=this;this.allNodesData.forEach(function(e){var t=r.getHierarchyInfo(e);if(t){var i=t.layer;isNaN(i)||(n===undefined?n=i:i<n&&(n=i))}});var e=n-1;return this.buildNodes("",e,this.allNodesData,this.allNodes),this.allNodes},Fe.prototype.buildNodes=function(e,t,r,o){var a=this;this.getChildNodesData(e,t).forEach(function(e){!0===a.isNewNode(e)&&a.expandParentNode(e);var t=a.buildNode(e);o.push(t),a.allNodesMap.set(e[a.primaryKey],t);var i=a.getHierarchyInfo(e).layer,n=e[a.primaryKey];a.buildNodes(n,i,r,t.children)})},Fe.prototype.buildNode=function(e){var t=this.isLeaf(e),i=this.shouldExpand(e);!this.isExpanded(e)&&i&&this.expandNode(e);var n=this.buildPaginationInfo(e),r={data:Object.assign({},e),children:[],expanded:i,leaf:t};return n&&(r.pagination=n),r},Fe.prototype.buildPaginationInfo=function(e){var t=null;if(this.frameContext){var i="_NODE_"+this.getPrimary(e)+"_PAGINATION_INFO_",n=this.frameContext.params.get(i)||null;n&&1<n.pageCount&&(t={pageIndex:n.pageIndex,pageSize:n.pageSize,total:n.totalCount})}return t},Fe.prototype.shouldExpand=function(e){var t=re([this.isLeaf(e),this.getNodeLayer(e)],2),i=t[0],n=t[1];if(i)return!1;var r=this.isExpanded(e);if(!r){var o=this.getPrimary(e);if(-1<this.nodesWaitExpand.findIndex(function(e){return e&&e.id===o}))return!1;if(-1<this.nodesShouldExpand.findIndex(function(e){return e===o}))return!0;if(-1===this.expandLevel)r=!1;else if(0===this.expandLevel)r=!0;else{r=n<=this.expandLevel;var a=this.getOldNode(e);a&&!a.expanded&&(r=!1)}}return r},Fe.prototype.expandNode=function(e){var t=re([e[this.primaryKey],this.getNodeLayer(e)],2),i=t[0],n=t[1],r=this.getChildNodesData(i,n);if(!r||r.length<1){var o=this.getPrimary(e);this.nodesWaitExpand.findIndex(function(e){return e&&e.id===o})<0&&this.nodesWaitExpand.push({id:o,expanded:!1})}},Fe.prototype.onTreeLoadComplete=function(){var e=this.nodesWaitExpand.findIndex(function(e){return!e.expanded}),t=this.nodesWaitExpand[e]||{},i=t.id;i&&this.component.findRowNode(i)&&(t.expanded=!0,this.component.expandNode(i))},Fe.prototype.getPrimary=function(e){return e[this.primaryKey]},Fe.prototype.getChildNodesData=function(r,o){var a=this,s=[];return this.allNodesData.forEach(function(e){var t=a.getHierarchyInfo(e);if(t){var i=t.layer,n=t.parentElement;i!==o+1||n!==r&&(n||""!==r)||s.push(e)}}),s},Fe.prototype.getHierarchyInfo=function(e){return this.getValue(e,this.hierarchyInfoKey)},Fe.prototype.getValue=function(e,t){return-1===t.indexOf("/")?e[t]:t.split("/").filter(function(e){return e}).reduce(function(e,t){return e&&e[t]},e)},Fe.prototype.getNodeLayer=function(e){return this.getHierarchyInfo(e).layer},Fe.prototype.getNodeParentElement=function(e){return this.getHierarchyInfo(e).parentElement},Fe.prototype.isExpanded=function(e){var t=this.getOldNode(e);return t?t.expanded:undefined},Fe.prototype.isLeaf=function(e){return this.getHierarchyInfo(e).isDetail},Fe.prototype.isNewNode=function(e){return 0!==this.allOldNodesMap.size&&!this.getOldNode(e)},Fe.prototype.expandParentNode=function(e){var t=this.getParentNode(e);t&&(t.leaf=!1,t.expanded=!0)},Fe.prototype.getParentNode=function(e){var i=this,t=this.getHierarchyInfo(e),n=t.layer,r=t.parentElement;return Array.from(this.allNodesMap.values()).find(function(e){var t=i.getValue(e.data,i.hierarchyInfoKey).layer;return e.data[i.primaryKey]===r&&n===t+1})},Fe.prototype.getOldNode=function(e){var t=e[this.primaryKey];return this.allOldNodesMap.get(t)},Fe.prototype.buildNodesDataMap=function(e){var t=this;e.forEach(function(e){t.allOldNodesMap.set(e.data[t.primaryKey],e),e.children&&t.buildNodesDataMap(e.children)})},Fe);function Fe(e,t,i,n,r){this.nodesWaitExpand=[],this.primaryKey=i,this.hierarchyInfoKey=n,this.allNodes=[],this.allNodesData=e,this.context=r||{},this.nodesWaitExpand=[],this.nodesShouldExpand=r&&r.nodesShouldExpand||[],this.frameContext=r&&r.frameContext||null,this.addTreeLoadCompleteListener(this.onTreeLoadComplete.bind(this)),this.allNodesMap=new Map,this.allOldNodesMap=new Map,this.buildNodesDataMap(t)}var Me=(ke.getBuilder=function(e){var t=Le;return e.hasOwnProperty("path")?t=Le:e.hasOwnProperty("parentElement")&&(t=Re),t},ke);function ke(){}var Ne=(Object.defineProperty(je.prototype,"bindingData",{get:function(){return this.frameContext.bindingData},enumerable:!0,configurable:!0}),Object.defineProperty(je.prototype,"bindingList",{get:function(){return this.bindingData.list},enumerable:!0,configurable:!0}),Object.defineProperty(je.prototype,"prop",{get:function(){return this._PROP},set:function(e){this._PROP=e},enumerable:!0,configurable:!0}),Object.defineProperty(je.prototype,"viewModel",{get:function(){return this.frameContext.viewModel},enumerable:!0,configurable:!0}),je.prototype.ngOnInit=function(){var i=this;this.frameContext.getVirtualRootFrameContext().setParam("hierarchyInfoKey",this.hierarchyInfoKey),this.bindData(),this.bindingData.changes.subscribe(function(e){!e||e.type!==V.ChangeType.ValueChanged&&e.type!==V.ChangeType.PaginationInfoChange?i.bindData():i.renderSubject.next(e);var t=i.bindingList.currentId;!i.frameContext.bindingData.rowSelectedEventSuspend&&t&&i.setSelectedIdToTree(i.bindingList.currentId),i.updateCheckedRows(e)}),this.treetableFormatSer.setFormat(this.treeTable),this.rowClass.emit(this.treeTable),this.cellClass.emit(this.treeTable),this.setComponentRef(),this.setNodePaginationInfo(),this.registerEvent(),this.frameContext&&this.frameContext.frameComponent&&(this.frameContext.frameComponent.componentType=V.ComponentType.farrisTreeTalbeComponent)},je.prototype.ngOnChanges=function(e){},je.prototype.registerEvent=function(){var o=this;this.treeTable.columnSorted.subscribe(function(e){var t=e.sortName,i=void 0===t?null:t,n=e.sortOrder,r=void 0===n?null:n;!1===o.treeTable.remoteSort&&i&&r&&o.bindingList.sortBy(i,r),o.bindData()})},je.prototype.setComponentRef=function(){var e=this.viewModel&&this.viewModel.frameContext&&this.viewModel.frameContext.getFormAppContext(),t=this.viewModel&&this.viewModel.frameContext&&this.viewModel.frameContext.frameId,i=this.treeTable&&this.treeTable.el.nativeElement.id||null;if(t&&i){var n=e&&e.componentRefs&&e.componentRefs.get(t)||new Map;e&&e.componentRefs&&e.componentRefs.set(t,n.set(i,this.treeTable))}},je.prototype.setNodePaginationInfo=function(){if(this.frameContext){var e=this.treeTable.paginationForChildren||!1;this.frameContext.params.set("enableNodePagination",e);var t=this.nodePageSize||0;this.frameContext.params.set("nodePageSize",t)}},je.prototype.bindData=function(){var e=this.treeTable.data,t=this.bindingList.toJSON({ignoreMultiLangInput:!0}),i=[];if((this.prop=t)&&0<t.length){var n=t[0][this.hierarchyInfoKey],r=this.builder;if(r||(this.builder=Me.getBuilder(n),r=this.builder),null==r)throw new Error("TreeTable builder is null!");var o=-1,a=this.treeTable.expandLevel;void 0!==a&&(o=a);var s=(this.frameContext.getVirtualRootFrameContext().params.get("_DEVKIT_expandRowIds")||"").split(",")||[],p={expandLevel:o,addTreeLoadCompleteListener:this.addTreeLoadCompleteListener.bind(this),component:this.treeTable,storage:this.storage,nodesShouldExpand:s,frameContext:this.frameContext};this.treeNodesBuilder=new r(t,e,this.bindingList.primaryKey,this.hierarchyInfoKey,p),i=this.treeNodesBuilder.build()}this.treeTable.data=i,this.updatePageInfo(this.treeTable),this.onTreeLoadComplete()},je.prototype.onTreeLoadComplete=function(){this.listeners&&0<this.listeners.length&&this.listeners.forEach(function(e){e()})},je.prototype.addTreeLoadCompleteListener=function(e){this.listeners.push(e)},je.prototype.shouldComponentUpdate=function(e){return JSON.stringify(this.prop)!==JSON.stringify(e)},je.prototype.getSelectedIdFromTree=function(){var e=this.treeTable.selectedRow;return e?e.data.id:null},je.prototype.setSelectedIdToTree=function(e){if(e){var t=this.getSelectedIdFromTree(),i=this.frameContext.params.get("_NODE_PAGE_CHANGED_")||!1;t||!i?t!==e&&(this.treeTable.clearSelections(),this.treeTable.selectNode(e)):this.frameContext.params["delete"]("_NODE_PAGE_CHANGED_")}},je.prototype.setCurrentIdToBindingList=function(e){var t=this.bindingData.list.currentId;this.treeTable.multiSelect||(this.setChecks(e),this.setCheckedRows([e])),t!==e&&this.bindingData.list.setCurrentId(e,!0)},je.prototype.updateCheckedRows=function(e){if(e.type===V.ChangeType.Load)this.setCheckedRows();else if(e.type===V.ChangeType.ValueChanged||e.type===V.ChangeType.Remove){var t=this.getChecks();e.id&&t.includes(e.id)&&this.setCheckedRows()}},je.prototype.setCheckedRows=function(e){var n=this;if(void 0===e&&(e=this.viewModel.uiState.ids||[]),Array.isArray(e)){var r=this.bindingList.toJSON(),o=this.viewModel.uiState.rows||new Map,a=new Map;e.forEach(function(t){var e=r.find(function(e){return e[n.bindingList.primaryKey]===t}),i=o.get(t);e?a.set(t,e):i&&a.set(t,i)}),this.viewModel.uiState.setPropertyValue("rows",a)}},je.prototype.setChecks=function(e){"string"==typeof e&&(e=e.split(",").filter(function(e){return e})),this.viewModel.uiState.setPropertyValue("ids",e)},je.prototype.getChecks=function(){return this.viewModel.uiState.ids||[]},je.prototype.getPagingInfo=function(){var e=this.viewModel.bindingPath,t=this.viewModel.bindingData.pagingInfo;return"/"===e||e.substr(1).split("/").filter(function(e){return!!e&&0<e.length}).map(function(e){return e.substring(0,e.length-1)}).forEach(function(e){t=t&&t[e]}),t},je.prototype.updatePageInfo=function(e){var t=this.getPagingInfo(),i=t.pageIndex,n=t.pageSize,r=t.total;0!==n?(e.pagination=!0,e.updatePageInfo({pageIndex:i,pageSize:n,total:r})):e.pagination=!1},je.prototype.selectionChangeHandler=function(e){if(e&&e.node&&e.node.hasOwnProperty("data")){var t=this.treeTable.idField,i=e.node.data[t];this.setCurrentIdToBindingList(i)}},je.prototype.checkValuesChange=function(e){this.setChecks(this.treeTable.checkValues),this.setCheckedRows()},je.prototype.expandHandler=function(e){var t=e.data.id,i=this.frameContext.getVirtualRootFrameContext(),n=i.getParam("TREE_LATEST_EXPANDED_ID")||[];n.push(t),i.setParam("TREE_LATEST_EXPANDED_ID",n)},je.prototype.onPageChanged=function(e){var t=e||{},i=t.pageSize,n=void 0===i?20:i,r=t.pageIndex,o=void 0===r?1:r;o<1&&(o=1);var a=(o-1)*n;this.bindingData.setPagingInfo(a,n,this.bindingData.bindingPath)},je.prototype.onPageSizeChanged=function(e){var t=e||20;this.bindingData.setPagingInfo(0,t,this.bindingData.bindingPath)},je.prototype.onNodePageChanged=function(e){var t=e.pageIndex,i=void 0===t?1:t,n=e.pageSize,r=(void 0===n&&this.nodePageSize,e.node),o=void 0===r?{}:r,a=o&&o.id||null;if(a){var s=this.frameContext.getVirtualRootFrameContext(),p=s.getParam("TREE_LATEST_EXPANDED_ID")||[];p.push(a),s.setParam("TREE_LATEST_EXPANDED_ID",p),this.frameContext.params.set("_NODE_"+a+"_PAGE_INDEX_",i),this.frameContext.params.set("_RELOAD_CHILDREN_",!0),this.frameContext.params.set("_NODE_PAGE_CHANGED_",!0)}},je.decorators=[{type:K.Directive,args:[{selector:"[farrisTreeTableBinding]"}]}],je.ctorParameters=function(){return[{type:b.TreeTableComponent},{type:pe},{type:V.FrameContext}]},je.propDecorators={hierarchyInfoKey:[{type:K.Input,args:["farrisHierarchyInfoKey"]}],rowClassName:[{type:K.Input}],cellClassName:[{type:K.Input}],nodePageSize:[{type:K.Input,args:["nodePageSize"]}],rowClass:[{type:K.Output}],cellClass:[{type:K.Output}],selectionChangeHandler:[{type:K.HostListener,args:["nodeSelected",["$event"]]}],checkValuesChange:[{type:K.HostListener,args:["checkValuesChange",["$event"]]}],expandHandler:[{type:K.HostListener,args:["expand",["$event"]]}],onPageChanged:[{type:K.HostListener,args:["pageChanged",["$event"]]}],onPageSizeChanged:[{type:K.HostListener,args:["pageSizeChanged",["$event"]]}],onNodePageChanged:[{type:K.HostListener,args:["childsPageChanged",["$event"]]}]},je);function je(e,t,i){var n=this;this.treeTable=e,this.treetableFormatSer=t,this.frameContext=i,this.renderSubject=new F.Subject,this.nodePageSize=100,this.rowClass=new K.EventEmitter,this.cellClass=new K.EventEmitter,this._PROP=null,this.listeners=[],this.storage=[],this.viewModel.uiState.setPropertyValue("ids",this.treeTable.checkValues),this.renderSubject.pipe(M.debounceTime(500)).subscribe(function(){n.bindData()})}var Ae=(Ve.prototype.mappingData=function(e,t,i,n){if(void 0===i&&(i=!1),void 0===n&&(n=","),t){var r=this.vm.frameContext.appContext;r.changeDetectionController.detach();var o=Object.keys(t),a=this.getBindingPathArray(),s=this.getMapFieldsPrimaryKey(t,a),p=s&&s.map(function(e){return e.primaryKey})||[],d=s&&s.map(function(e){return e.primaryField})||[];o=this.sortMapFieldKeys(o,p),e&&!i||o.reverse(),this.mapping(o,t,e,d,a,i,n),r.changeDetectionController.reattach()}},Ve.prototype.mapping=function(e,o,a,s,p,d,l){var u=this;void 0===d&&(d=!1),void 0===l&&(l=","),e.forEach(function(e){var t=u.getHelpValue(e,a,l),i=o[e].split(","),n=i.filter(function(e){return s.includes(e)}),r=i.filter(function(e){return!s.includes(e)});i=!a||d?[].concat(r).concat(n):[].concat(n).concat(r),u.updateTarget(i,p,a,t)})},Ve.prototype.updateTarget=function(e,t,i,n){var r=this;e.forEach(function(e){r.updateTargetValue(t,e,n,i)})},Ve.prototype.updateTargetValue=function(e,t,i,n){if(this.target){var r=t.split(".");this.setValue(this.target,r,i)}else r=e.concat(t.split(".")),n?this.vm.bindingData.setValue(r,i,!0,!0,null,{frameContext:this.vm.frameContext}):this.vm.bindingData.clearValue(r,!0,!0,{frameContext:this.vm.frameContext})},Ve.prototype.getHelpValue=function(t,e,i){var n=this;void 0===i&&(i=",");var r="";return e&&(r=e instanceof Array?e.map(function(e){return n.getValue(t,e)}).join(i):this.getValue(t,e)),r},Ve.prototype.getValue=function(e,t){return-1===e.indexOf(".")?t[e]:e.split(".").reduce(function(e,t){return e[t]},t)},Ve.prototype.setValue=function(e,t,i){e&&(t.length<=1?e[t[0]]=i:t.slice(0,-1).reduce(function(e,t){return e.hasOwnProperty(t)||e.__proto__.hasOwnProperty(t)||(e[t]={}),e[t]},e)[t[t.length-1]]=i)},Ve.prototype.getBindingPathArray=function(){var e=this.vm.bindingPath;return e?e.split("/").filter(function(e){return""!==e}):[]},Ve.prototype.isNumberValue=function(e,t){var i=this.getValue(e,t);return O.isNumber(i)},Ve.prototype.getMapFieldsPrimaryKey=function(t,r){if(!t||Object.keys(t).length<1)return null;var o=[];try{var a=this.vm.frameContext.repository.entityTypeInfo;Object.keys(t).forEach(function(n){var e=t[n];e&&"string"==typeof e&&e.split(",").filter(function(e){return e}).forEach(function(e){var t=e.split(".");r&&0<r.length&&(t=r.concat(t));var i=a.getPropInfoByPath(t);i&&i.metadataInfo&&!0===i.metadataInfo.primary&&o.push({primaryKey:n,primaryField:e})})})}catch(e){console.error(e)}return o},Ve.prototype.sortMapFieldKeys=function(e,t){return!t||t.length<1||!e||e.length<1?e:(t=oe(new Set(t)),e=e.filter(function(e){return!t.includes(e)}),[].concat(t).concat(e))},Ve);function Ve(){this.defaultSpliter=","}var Be,He=(te(_e,Be=Ae),_e.prototype.ngOnInit=function(){var p=this;this.lookup.selectedData.subscribe(function(e){var t=p.mapfields||p.lookup.mapFields,i=p.lookup.multipleChoiceSeparator||p.defaultSpliter;p.mappingData(e,t,!1,i)}),this.lookup.clearMappings.subscribe(function(e){var t=Object.assign({},p.mapfields||p.lookup.mapFields||{}),i=p.lookup.textField,n={},r=p.lookup.ngControl&&p.lookup.ngControl.name;if(r&&p.vm){var o=t[i],a=p.vm&&p.vm.form&&p.vm.form.ngFormControls&&p.vm.form.ngFormControls[r],s=a&&a.binding;o&&s&&(t[i]=o.split(",").filter(function(e){return e!==s}).join(","))}Object.keys(t).forEach(function(e){p.setValue(n,e.split("."),"")}),p.mappingData(n,t,!0)}),this.lookup.clear.subscribe(function(){var e=p.mapfields||p.lookup.mapFields;p.mappingData(null,e)})},_e.decorators=[{type:K.Directive,args:[{selector:"[data-mapping]"}]}],_e.ctorParameters=function(){return[{type:V.ViewModel,decorators:[{type:K.Optional}]},{type:C.LookupGridComponent,decorators:[{type:K.Optional},{type:K.Self}]}]},_e.propDecorators={mapfields:[{type:K.Input,args:["data-mapping"]}],target:[{type:K.Input,args:["target"]}]},_e);function _e(e,t){var i=Be.call(this)||this;return i.vm=e,i.lookup=t,i.target=null,i}var Ke=(ze.prototype.ngOnInit=function(){if(this.frameContext&&this.lookup&&!0===this.enableExtendLoadMethod){var e=this.frameContext.repository.apiUri,t=this.lookup.uri+"@"+e;this.frameContext.setParam(t,!0)}},ze.decorators=[{type:K.Directive,args:[{selector:"[enableExtendLoadMethod]"}]}],ze.ctorParameters=function(){return[{type:V.FrameContext,decorators:[{type:K.Optional}]},{type:C.LookupGridComponent,decorators:[{type:K.Optional},{type:K.Self}]}]},ze.propDecorators={enableExtendLoadMethod:[{type:K.Input}]},ze);function ze(e,t){this.frameContext=e,this.lookup=t}var Ge=(Object.defineProperty(qe.prototype,"bindingObject",{get:function(){return this._bindingObject},set:function(e){this._bindingObject=e,!this.differ&&e&&this.differs&&"object"==typeof e&&(this.differ=this.differs.find(e).create())},enumerable:!0,configurable:!0}),qe.prototype.onValueChange=function(e){this.hostComboComponent&&this.bindingObject&&(e?(this.bindingObject.key=e.value,this.bindingObject.value=e.name):(this.bindingObject.key=null,this.bindingObject.value=null))},qe.prototype.ngOnInit=function(){this.hostComboComponent?this.hostComboComponent.valuePrimitive=!1:this.hostHelpComponent?this.bindObjectToHostLookup():this.hostComboListComponent?this.bindObjectToHostComboList():this.hostComboLookupComponent&&this.bindObjectToHostComboLookup()},qe.prototype.ngDoCheck=function(){this.differ&&"object"==typeof this.bindingObject?this.differ&&this.differ.diff(this.bindingObject)&&this.bindingChanges():this.bindingChanges()},qe.prototype.bindingChanges=function(){var e=this.bindingObject?this.bindingObject.value:null,t=this.bindingObject?this.bindingObject.key:null;if(this.hostComboComponent){this.hostComboComponent.text=e;var i=this.hostComboComponent.valueField,n=this.hostComboComponent.data.find(function(e){return e[i]===t});this.hostComboComponent.writeValue(n)}else this.hostHelpComponent?(this.hostHelpComponent.writeValue(e),this.hostHelpComponent.displayValue=t):this.hostComboListComponent?this.hostComboListComponent.writeValue(t):this.hostComboLookupComponent&&(this.hostComboLookupComponent.selectedValues=t,this.hostComboLookupComponent.writeValue(e))},qe.prototype.ngOnChanges=function(e){e.bindingObject&&!this.differ&&this.bindingChanges()},qe.prototype.bindObjectToHostLookup=function(){var o=this;this.hostHelpComponent&&(this.hostHelpComponent.selectedData.subscribe(function(e){return o.updateHelpBindingObject(e)}),this.hostHelpComponent.clear.subscribe(function(){o.updateHelpBindingObject(null)}),this.hostHelpComponent.tagRemoved&&this.hostHelpComponent.tagRemoved.subscribe(function(e){var t=e.removedIndex,i=void 0===t?-1:t,n=e.instance,r=void 0===n?null:n;-1!==i&&(r.singleSelect||!r.displayValue?o.updateHelpBindingObject(null):o.UIStateBindingChange.emit({key:r.displayValue,value:r.displayText}))}),this.hostHelpComponent.nosearch&&this.hostHelpComponent.valueChanged.subscribe(function(e){var t,i=o.hostHelpComponent.idField,n=o.hostHelpComponent.textField;o.updateHelpBindingObject(((t={})[i]=e,t[n]=e,t))}))},qe.prototype.bindObjectToHostComboList=function(){var t=this;this.hostComboListComponent&&(this.hostComboListComponent.valueChange.subscribe(function(e){return t.updateHelpBindingObject(e.selections)}),this.hostComboListComponent.clear.subscribe(function(){t.updateHelpBindingObject(null)}))},qe.prototype.bindObjectToHostComboLookup=function(){var i=this;this.hostComboLookupComponent&&(this.hostComboLookupComponent.multiSelect?this.hostComboLookupComponent.valueChange.subscribe(function(e){return i.updateHelpBindingObject(e.selections)}):this.hostComboLookupComponent.selectChange.subscribe(function(e){var t=e;e.data&&(t=e.data),i.updateHelpBindingObject(t)}),this.hostComboLookupComponent.clear.subscribe(function(){i.updateHelpBindingObject(null)}))},qe.prototype.updateHelpBindingObject=function(e){var t,i,n=this.defaultSpliter;this.hostHelpComponent&&(t=this.hostHelpComponent.idField,i=this.hostHelpComponent.textField,n=this.hostHelpComponent.multipleChoiceSeparator||this.defaultSpliter),this.hostComboListComponent&&(t=this.hostComboListComponent.idField,i=this.hostComboListComponent.textField),this.hostComboLookupComponent&&(t=this.hostComboLookupComponent.idField,i=this.hostComboLookupComponent.textField,n=this.hostComboLookupComponent.separator||this.defaultSpliter),this.emitUiStateBinding(e,t,i,n)},qe.prototype.emitUiStateBinding=function(e,t,i,n){void 0===n&&(n=",");var r={key:null,value:null};e&&(Array.isArray(e)?(r.key=e.map(function(e){return e[t]}).join(n),r.value=e.map(function(e){return-1<i.indexOf(".")?i.split(".").reduce(function(e,t){return e[t]},e):e[i]}).join(n)):(t&&(r.key=e[t]),i&&(-1<i.indexOf(".")?r.value=i.split(".").reduce(function(e,t){return e[t]},e):r.value=e[i]))),this.UIStateBindingChange.emit(r)},qe.decorators=[{type:K.Directive,args:[{selector:"[UIStateBinding]"}]}],qe.ctorParameters=function(){return[{type:i.ComboBoxComponent,decorators:[{type:K.Host},{type:K.Self},{type:K.Optional}]},{type:C.LookupGridComponent,decorators:[{type:K.Host},{type:K.Self},{type:K.Optional}]},{type:K.KeyValueDiffers,decorators:[{type:K.Optional}]},{type:v.ComboListComponent,decorators:[{type:K.Host},{type:K.Self},{type:K.Optional}]},{type:E.ComboLookupComponent,decorators:[{type:K.Host},{type:K.Self},{type:K.Optional}]}]},qe.propDecorators={bindingObject:[{type:K.Input,args:["UIStateBinding"]}],UIStateBindingChange:[{type:K.Output}],onValueChange:[{type:K.HostListener,args:["valueChange",["$event"]]}]},qe);function qe(e,t,i,n,r){this.hostComboComponent=e,this.hostHelpComponent=t,this.differs=i,this.hostComboListComponent=n,this.hostComboLookupComponent=r,this.defaultSpliter=",",this.differ=null,this.UIStateBindingChange=new K.EventEmitter}var Ue=($e.prototype.ngOnInit=function(){},$e.prototype.ngOnChanges=function(e){this.maskElement||this.createMaskElement(),e.kendoGridDisabled&&this.maskElement&&(this.kendoGridDisabled?this.renderer.removeStyle(this.maskElement,"display"):this.renderer.setStyle(this.maskElement,"display","none"))},$e.prototype.createMaskElement=function(){this.maskElement=this.renderer.createElement("div"),this.renderer.setStyle(this.maskElement,"width","100%"),this.renderer.setStyle(this.maskElement,"height","100%"),this.renderer.setStyle(this.maskElement,"position","absolute"),this.renderer.setStyle(this.maskElement,"background-color","rgba(255,255,255,0.5)"),this.renderer.setStyle(this.maskElement,"z-index","3"),this.renderer.setStyle(this.maskElement,"display","none"),this.renderer.appendChild(this.el.nativeElement,this.maskElement)},$e.decorators=[{type:K.Directive,args:[{selector:"[farrisDisabled]"}]}],$e.ctorParameters=function(){return[{type:G.GridComponent},{type:K.ElementRef},{type:K.Renderer2}]},$e.propDecorators={kendoGridDisabled:[{type:K.Input,args:["farrisDisabled"]}]},$e);function $e(e,t,i){this.grid=e,this.el=t,this.renderer=i}var We=(Je.decorators=[{type:K.Directive,args:[{selector:"[farrisSort]"}]}],Je);function Je(){}var Ye=(Qe.decorators=[{type:K.Directive,args:[{selector:"[farris-textarea-edit]"}]}],Qe);function Qe(){}var Xe=(Ze.decorators=[{type:K.Directive,args:[{selector:"[farrisDynamicColumnFormat]"}]}],Ze);function Ze(){}var et=(tt.decorators=[{type:K.Directive,args:[{selector:"[farris-enter-edit]"}]}],tt.propDecorators={farrisForm:[{type:K.Input,args:["form-group"]}]},tt);function tt(){}var it=(nt.decorators=[{type:K.Directive,args:[{selector:"[farrisTreeTableFormat]"}]}],nt);function nt(){}var rt=(Object.defineProperty(ot.prototype,"props",{get:function(){return this._PROPS},set:function(e){this._PROPS=e},enumerable:!0,configurable:!0}),ot.prototype.ngOnInit=function(){var t=this,e=(this.getPagingInfo()||{}).pageSize,i=void 0===e?0:e;0!==i&&(!this.grid.pageList||this.grid.pageList.length<1)&&"function"==typeof this.grid.setPageList&&this.grid.setPageList([i,2*i,3*i,4*i]),this.setComponentRef(),this.bindData(),window.setTimeout(function(){t.updateSelectedRow()},0),this.registerBindingDataChangeEvent(),this.renderGridSubject.pipe(M.debounceTime(500)).subscribe(function(e){t.viewModel&&t.viewModel.frameContext&&!t.viewModel.frameContext.isDisposed&&t.bindData(e)}),this.viewModel&&this.viewModel.frameContext&&this.viewModel.frameContext.frameComponent&&(this.viewModel.frameContext.frameComponent.componentType=V.ComponentType.farrisDataGridComponent)},ot.prototype.ngOnChanges=function(e){this.bindData()},Object.defineProperty(ot.prototype,"primaryKey",{get:function(){return this.bindingList.primaryKey},enumerable:!0,configurable:!0}),Object.defineProperty(ot.prototype,"bindingList",{get:function(){if("/"===this.viewModel.bindingPath||!this.viewModel.bindingPath)return this.bindingData.list;var e=this.viewModel.bindingPath.substr(1),t=(e=e[0].toLowerCase()+e.substring(1,e.length)).split("/").filter(function(e){return""!==e});return this.bindingData.getValue(t)},enumerable:!0,configurable:!0}),ot.prototype.setComponentRef=function(){var e=this.viewModel&&this.viewModel.frameContext&&this.viewModel.frameContext.getFormAppContext(),t=this.viewModel&&this.viewModel.frameContext&&this.viewModel.frameContext.frameId,i=this.grid&&this.grid.id;if(t&&i){var n=e&&e.componentRefs&&e.componentRefs.get(t)||new Map;e&&e.componentRefs&&e.componentRefs.set(t,n.set(i,this.grid))}},ot.prototype.getPagingInfo=function(){var e=this.viewModel.bindingPath,t=this.viewModel.bindingData,i=t&&t.pagingInfo||{};if("/"===e)return i;var n=e.substr(1).split("/").filter(function(e){return!!e&&0<e.length}),r=n[n.length-1];r=r.substr(0,r.length-1);var o=n.slice(0,n.length-1),a=t.getValue(o),s=(i[""+r]||{}).pageSize,p=void 0===s?0:s;if(a&&a.currentId){var d=i[r+"_"+a.currentId]||{};return d.hasOwnProperty("totalCount")&&(d.total=d.totalCount),Object.keys(d).length<1&&(d.pageIndex=1,d.pageSize=p),d}return{pageIndex:1,pageSize:p}},ot.prototype.shouldComponentUpdate=function(e,t){var i=this.buildProps(t);if(this.viewModel&&this.viewModel.frameContext&&this.viewModel.frameContext.appContext&&this.viewModel.frameContext.appContext.runMode===V.RunMode.highSpeed&&e&&(e.type===V.ChangeType.Load||e.type===V.ChangeType.Remove||e.type===V.ChangeType.PaginationInfoChange))return{result:!0,props:i};var n=this.buildGridProps();return JSON.stringify(i)===JSON.stringify(n)?{result:!1}:{result:!0,props:i}},ot.prototype.registerEvent=function(){var d=this;this.grid&&this.grid.columnSorted&&this.grid.columnSorted.subscribe(function(e){if(d.grid.remoteSort){var t=d.grid&&d.grid.groupField||null,i=d.grid.sortName&&d.grid.sortName.split(",")||[],n=d.grid.sortOrder&&d.grid.sortOrder.split(",")||[];t&&(i.includes(t)||(i.splice(0,0,t),n.splice(0,0,"asc")));var r=d.viewModel&&d.viewModel.frameContext.repository.entityType||null;if(0<i.length&&r){var o=new V.DataTypeInfo(r);i=i.map(function(e){var t=e.split("."),i=o.getPropInfoByPath(t);return i&&i.metadataInfo.path||null})}var a=i.join(","),s=n.join(",")||"asc",p=d.viewModel&&d.viewModel.frameContext||null;p&&p.repository.sortConditionManager.setConditions(d.viewModel.bindingPath,a,s)}else d.sortFields=d.grid.sortName,d.sortDirections=d.grid.sortOrder,d.sortBindingList()}),this.grid&&this.grid.filterChanged&&this.grid.filterChanged.subscribe(function(e){if(d.filters=e,!d.grid.remoteFilter){if(0<d.bindingList.length&&!d.bindingList.currentId){var t=d.bindingList.getIdByIndex(0);d.bindingList.setCurrentId(t)}d.bindingList.filter(d.filters),d.bindData()}}),this.viewModel.frameContext.appContext.messagePipe.subscribe(function(e){e&&"CLEAR_GRID_CONDITION"===e&&d.filters&&0<Object.keys(d.filters).length&&(d.filters={},d.bindData())})},ot.prototype.sortBindingList=function(e){var i=this,t=this.grid&&this.grid.groupField||null;if(t){var n=this.sortFields&&this.sortFields.split(",")||[];t.split(",").reverse().forEach(function(e){if(!n.includes(e)){n.splice(0,0,e);var t=i.sortDirections&&i.sortDirections.split(",")||[];t.splice(0,0,"asc"),i.sortFields=n.join(","),i.sortDirections=t.join(",")||"asc"}})}this.bindingList.sortBy(this.sortFields,this.sortDirections),this.bindData(e)},ot.prototype.bindData=function(e){var t=this,i=this.grid&&this.grid.remoteFilter||!1;if(this.shouldSort(e))return this.hasSorted=!0,void this.sortBindingList(e);(!(this.hasSorted=!1)===this.grid.editable||e&&e.type===V.ChangeType.Append)&&this.filters&&0<Object.keys(this.filters).length&&!i&&(this.viewModel.frameContext.appContext.enableGridHeaderWhenEditing||this.enableFilterSorting||(this.filters={},this.grid.clearCondition())),this.shouldFiltering(e)&&this.bindingList.filter(this.filters);var n=this.bindingList.toJSON();if(this.filters&&0<Object.keys(this.filters).length&&!i&&(!e||e&&e.type!==V.ChangeType.SelectionChanged&&e.type!==V.ChangeType.GlobalSelectionChanged))if(n&&0<n.length){if(!n.find(function(e){return e[t.bindingList.primaryKey]===t.bindingList.currentId})){var r=n[0][this.bindingList.primaryKey];this.bindingList.setCurrentId(r,!0,!0)}}else this.bindingList.currentId&&this.bindingList.setCurrentId(null,!0,!0,!0),this.grid.multiSelect||this.setChecks([]);var o=this.shouldComponentUpdate(e,n);o.result&&(this.renderGrid(o.props),this.props=JSON.parse(JSON.stringify(o.props)))},ot.prototype.shouldFiltering=function(e){return!(!0===(this.grid&&this.grid.remoteFilter||!1)||!this.filters||Object.keys(this.filters).length<1||(e?e.type!==V.ChangeType.Load:this.grid.editable))},ot.prototype.shouldSort=function(e){return!(!this.sortFields||Object.keys(this.sortFields).length<1)&&!this.hasSorted&&(e?"Load"===e.type||"SelectionChanged"===e.type:this.grid.editable)},ot.prototype.renderGrid=function(e){var t=e.pageIndex,i=e.pageSize,n=e.total,r=e.pagination,o=e.data,a=this.grid.virtualizedAsyncLoad||!1;this.grid.total=n,this.grid.pageSize=i,this.grid.pageIndex=t,this.grid.pagination=r,this.grid.controlPaginationState=!1,0===i&&(this.grid.pagination=!1,this.grid.pageIndex=1),a?this.grid.loadVirtualData({items:o,pageIndex:t,pageSize:i,total:n}):this.grid.loadData(o)},ot.prototype.buildProps=function(e){var t;t=void 0!==e?e:this.bindingList.toJSON();var i=this.getPagingInfo()||{},n=i.pageIndex,r=void 0===n?1:n,o=i.pageSize,a=void 0===o?0:o,s=(this.getPagingInfo()||{}).total,p=void 0===s?0:s;return 0===a&&0===p&&(p=t.length),{data:t,pageIndex:r,pageSize:a,total:p,pagination:0!==a}},ot.prototype.buildGridProps=function(){var e=this.grid.data||[],t={pageIndex:this.grid.pageIndex,pageSize:this.grid.pageSize},i=t.pageIndex,n=void 0===i?1:i,r=t.pageSize,o=void 0===r?0:r,a=this.grid.total||0;return 0===o&&0===a&&(a=e.length),{data:e,pageIndex:n,pageSize:o,total:a,pagination:this.grid.pagination}},ot.prototype.onBindingDataChange=function(e){this.updateDataSource(e),this.updateSelectedRow(e),this.endCellEdit(e),this.updateCheckedRows(e),this.updateData(e)},ot.prototype.updateDataSource=function(e){var t;if(e&&e.type===V.ChangeType.ValueChanged){var i=e.path;try{var n=V.ExpressionUtil.getAvailableChildrenPathsFromEntityPaths(i,this.viewModel.frameContext.repository.entityTypeInfo);if(this.viewModel.bindingPath==="/"+n.join("/")){var r=i.slice(n.length);e.id&&this.grid&&e.path&&this.viewModel.frameContext.appContext.runMode!==V.RunMode.highSpeed&&r&&0<r.length&&this.grid.updateRow(e.id,((t={})[r.join(".")]=e.value,t))}}catch(o){console.warn(o)}this.renderGridSubject.next(e)}else!e||e.type!==V.ChangeType.SelectionChanged&&e.type!==V.ChangeType.GlobalSelectionChanged?this.bindData(e):this.bindingList.currentId===(this.grid.selectedRow&&this.grid.selectedRow.id)&&0<this.grid.total||this.bindData(e)},ot.prototype.endCellEdit=function(e){var t=this.grid.isEditing();e.type===V.ChangeType.Load&&t&&this.grid.endCellEdit()},ot.prototype.updateSelectedRow=function(e){if(this.bindingList&&this.bindingList.currentId&&!(e&&e.type===V.ChangeType.PaginationInfoChange||this.viewModel&&!0===this.viewModel.frameContext.bindingData.rowSelectedEventSuspend)){var t=(this.grid.selectedRow||{}).id,i=void 0===t?null:t,n=this.bindingList.currentId;if(i!==n)this.selectGridRow(this.bindingList.currentId);else{var r=e&&e.path.toString()===this.viewModel.bindingPath.split("/").filter(function(e){return e}).toString();e&&e.type===V.ChangeType.Load&&r&&(this.grid.clearSelections(),this.grid.selectRow(n,!0,!0))}}},ot.prototype.registerBindingDataChangeEvent=function(){var t=this;this.bindingDataChangeEvent=this.bindingData.changes.subscribe(function(e){t.onBindingDataChange(e)}),this.viewModel.frameContext.appContext.messagePipe.subscribe(function(e){"bindData"===e&&t.bindData()})},ot.prototype.unRegisterBindingDataChangeEvent=function(){this.bindingDataChangeEvent&&"function"==typeof this.bindingDataChangeEvent.unsubscribe&&this.bindingDataChangeEvent.unsubscribe()},ot.prototype.updateData=function(e){var t=this;if(e&&(e.type===V.ChangeType.SelectionChanged||e.type===V.ChangeType.Load)){var i=this.viewModel.bindingPath,n="/"+e.path.join("/"),r=this.viewModel.frameContext.appContext.params.get("retrieveing")||!1;if(!(e.path.length<1||"/"===i||i===n)&&i.startsWith(n)&&!r){var o=V.EntityPathConverter.toEntityPathArray(this.viewModel.bindingPath,this.bindingData),a=o.slice(0,o.length-1),s=this.bindingList.parent;if(s&&s[s.primaryKey]){var p=this.viewModel.bindingPath.split("/").filter(function(e){return e}),d=p[p.length-1],l="/"+(d=d.substr(0,d.length-1)),u=(this.viewModel.frameContext.repository.entityCollection.getPaginationConfigByPath(l)||{}).pageIndex,c=void 0===u?1:u,h=(this.viewModel.frameContext.repository.entityCollection.getPaginationConfigByPath(l)||{}).pageSize,f=void 0===h?0:h,g=e.path[e.path.length-1],y="/"+g.substring(0,g.length-1),m=(this.viewModel.frameContext.repository.entityCollection.getPaginationConfigByPath(y)||{}).pageSize,v=void 0===m?0:m;this.viewModel.frameContext.appContext.params.get("queryChild")&&(c=1),v+f!==0&&(this.viewModel.frameContext.appContext.params.set("forceQueryChild",!0),this.viewModel.frameContext.repository.queryChild(a,c,f).pipe(M.finalize(function(){return t.viewModel.frameContext.appContext.params["delete"]("forceQueryChild")})).subscribe())}}}},ot.prototype.ngOnDestroy=function(){this.unRegisterBindingDataChangeEvent()},ot.prototype.fireSelectedRowChange=function(e){this.selectedRowChange.emit(e)},ot.prototype.clearCheckedRows=function(e){e.type===V.ChangeType.Load&&this.grid.multiSelect&&this.checkIfChangeMatchBindingPath(e)&&(this.setChecks([]),"function"==typeof this.grid.clearCheckeds&&this.grid.clearCheckeds())},ot.prototype.setSelectionIdToBindingData=function(e){if(!e)return this.bindingList.currentId=e,void(this.grid.multiSelect||this.setChecks([]));this.bindingList.currentId!==e&&this.bindingList.setCurrentId(e,!0),this.grid.multiSelect||this.setChecks([e])},ot.prototype.updateCheckedRows=function(e){if(e.type===V.ChangeType.Load)this.setCheckedRows();else if(e.type===V.ChangeType.ValueChanged){var t=this.getChecks();e.id&&t.includes(e.id)&&this.setCheckedRows()}},ot.prototype.setChecks=function(e){this.viewModel.uiState.setPropertyValue("ids",e),this.setCheckedRows(e)},ot.prototype.getChecks=function(){return this.viewModel.uiState.ids||[]},ot.prototype.setCheckedRows=function(e){var n=this;if(void 0===e&&(e=this.viewModel.uiState.ids||[]),!Array.isArray(e)||e.length<1)this.viewModel.uiState.setPropertyValue("rows",null);else{var r=[];r=this.viewModel.frameContext.appContext.runMode===V.RunMode.highSpeed?this.grid.data||[]:this.bindingList.toJSON({ignoreMultiLangInput:!0});var o=this.viewModel.uiState.rows||new Map,a=new Map;e.forEach(function(t){var e=r.find(function(e){return e[n.primaryKey]===t}),i=o.get(t);e?a.set(t,e):i&&a.set(t,i)}),this.viewModel.uiState.setPropertyValue("rows",a)}},ot.prototype.selectGridRow=function(e){this.grid.selectRow(e),this.grid.scrollToCurrentRow()},ot.prototype.pageChangedHandler=function(e){var t=e.pageIndex,i=e.pageSize;t<1&&(t=1);var n=(t-1)*i;this.bindingData.setPagingInfo(n,i,this.bindingData.bindingPath)},ot.prototype.selectedRowChanged=function(e){e.index;var t=e.data[this.primaryKey];this.setSelectionIdToBindingData(t),this.fireSelectedRowChange(e)},ot.prototype.unSelected=function(e){if(e){var t=e.data;(void 0===t?{}:t)[this.primaryKey]===this.bindingList.currentId&&this.setSelectionIdToBindingData(null)}},ot.prototype.checkedChanged=function(e){var t=(e=e||[]).map(function(e){return e.id});this.setChecks(t)},ot.prototype.pageSizeChanged=function(e){e.pageIndex;var t=e.pageSize;this.bindingData.setPagingInfo(0,t,this.bindingData.bindingPath)},ot.prototype.scrollY=function(e){var t=e.pager,i=e.pageSize,n=(t-1)*i;this.bindingData.setPagingInfo(n,i,this.bindingData.bindingPath)},ot.prototype.filterChanged=function(e){this.filters=e},ot.prototype.checkIfChangeMatchBindingPath=function(e){var t=!1;if(!e||!e.path)return t;var i=e.path;if(!i)return t;if(!this.bindingData&&!this.bindingData.bindingPath)return t;var n=this.bindingData.bindingPath.split("/");return n.length<=0||(0===i.length?"/"===this.bindingData.bindingPath&&(t=!0):1===e.path.length?2===n.length&&n[1]===e.path[0]&&(t=!0):2===e.path.length&&3===n.length&&n[1]===e.path[0]&&n[2]===e.path[1]&&(t=!0)),t},ot.prototype.debounce=function(i,n){var r=null;return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];window.clearTimeout(r),r=window.setTimeout(function(){i.apply(null,e)},n)}},ot.decorators=[{type:K.Directive,args:[{selector:"[farris-use-binding-data]"}]}],ot.ctorParameters=function(){return[{type:V.BindingData},{type:V.ViewModel},{type:L.DatagridComponent}]},ot.propDecorators={selectedRowChange:[{type:K.Output}],pageChangedHandler:[{type:K.HostListener,args:["pageChanged",["$event"]]}],selectedRowChanged:[{type:K.HostListener,args:["selectChanged",["$event"]]}],unSelected:[{type:K.HostListener,args:["unSelect",["$event"]]}],checkedChanged:[{type:K.HostListener,args:["checkedChange",["$event"]]}],pageSizeChanged:[{type:K.HostListener,args:["pageSizeChanged",["$event"]]}],scrollY:[{type:K.HostListener,args:["scrollYLoad",["$event"]]}],filterChanged:[{type:K.HostListener,args:["filterChanged",["$event"]]}]},ot);function ot(e,t,i){this.bindingData=e,this.viewModel=t,this.grid=i,this.sortFields=null,this.sortDirections=null,this.hasSorted=!1,this.filters=null,this.renderGridSubject=new F.Subject,this.enableFilterSorting=!1,this.selectedRowChange=new K.EventEmitter,this.setChecks([]),this.enableFilterSorting=this.viewModel&&this.viewModel.frameContext&&this.viewModel.frameContext.injector.get(V.ENABLE_EDIT_STATE_FILTER_SORTING,!1)||!1,this.registerEvent()}var at=(st.prototype.ngOnInit=function(){var t=this;this.multiSelectComponent.dataSource=[],Array.isArray(this.dataSource)?(this.multiSelectComponent.dataSource=this.dataSource,this.originalDataSource=this.dataSource):this.dataSource&&this.dataSource.changes&&this.dataSource.changes.subscribe(function(e){"Load"===e.type&&(t.originalDataSource=e.value,t.multiSelectComponent.isTree()?(t.fjmField?t.multiSelectComponent.dataSource=t.plainToTree(e.value,t.fjmField,1):t.fjdField&&(t.multiSelectComponent.dataSource=t.buildTreeNodesByFjd(e.value,t.fjdField)),t.multiSelectComponent.selections=t.getTreeSelectionsById(t.selectedId,t.originalDataSource)):(t.multiSelectComponent.dataSource=e.value,t.multiSelectComponent.selections=t.getListSelectionsById(t.selectedId,t.multiSelectComponent.dataSource)))}),this.selectIdBindingToUIStateField()},st.prototype.selectIdBindingToUIStateField=function(){var t=this;this.multiSelectComponent&&this.multiSelectComponent.selectedIdChange&&this.multiSelectComponent.selectedIdChange.subscribe(function(e){t.selectedIdChanged.emit(e)})},st.prototype.formatDataSource=function(e,n){var r=this;return e&&e.length?e.map(function(e){var t,i=e.toJSON?e.toJSON():e;return{data:Object.assign(ie({},i),(t={},t[""+r.idField]=e[r.idField],t[""+r.textField]=e[r.textField],t[""+r.valueField]=e[r.valueField],t[""+n]=e[n],t)),children:[]}}):[]},st.prototype.plainToTree=function(e,t,i){var n=this.formatDataSource(e,t);if(!n.length)return[];if(!n[0].data[t])return[];var r=n.filter(function(e){return e.data[t].layer===i});return this.recursive(r,n,t,1),r},st.prototype.recursive=function(e,s,p,d){var l=this;e.forEach(function(r){var o=r.data[p].path,a=r.data[p].layer;!1===r.data[p].isDetail&&s.forEach(function(e){if(e&&e.data&&e.data[p]&&e.data[p].path){var t=e.data[p].path,i=e.data[p].layer,n=void 0;t&&t.length>o.length&&(n=t.substr(0,4*Number(d))),o===n&&a===i-1&&r.children.push(e),!1===e.data[p].isDetail&&o===n&&l.recursive([e],s,p,Number(d)+1)}})})},st.prototype.getListSelectionsById=function(t,i){var n=[],r=this;if("string"==typeof t&&t||"number"==typeof t){var e=i.find(function(e){return e&&e[r.idField]===t});e&&n.push(e)}else Array.isArray(t)&&i?t.forEach(function(t){var e=i.find(function(e){return e&&e[r.idField]===t});e&&n.push(e)}):n=[];return n},st.prototype.getTreeSelectionsById=function(t,i){var n=[],r=this;if("string"==typeof t&&t||"number"==typeof t){var e=i.find(function(e){return e&&e[r.idField]===t});e&&n.push(e)}else Array.isArray(t)&&i?t.forEach(function(t){var e=i.find(function(e){return e&&e[r.idField]===t});e&&n.push(e)}):n=[];return n},st.prototype.buildTreeNodesByFjd=function(e,i){var n=this,r=this.formatDataSource(e,i);return r.forEach(function(t){var e=r.find(function(e){return t.data[i].parentElement===e.data[n.idField]});e&&e.children.push(t)}),r.filter(function(e){return!e.data[i].parentElement})},st.decorators=[{type:K.Directive,args:[{selector:"[multiSelectDataMapping]"}]}],st.ctorParameters=function(){return[{type:V.ViewModel,decorators:[{type:K.Optional}]},{type:x.MultiSelectComponent,decorators:[{type:K.Host},{type:K.Self},{type:K.Optional}]}]},st.propDecorators={dataSource:[{type:K.Input}],idField:[{type:K.Input}],textField:[{type:K.Input}],valueField:[{type:K.Input}],fjmField:[{type:K.Input}],fjdField:[{type:K.Input}],uiStateField:[{type:K.Input}],selectedId:[{type:K.Input}],selectedIdChanged:[{type:K.Output}]},st);function st(e,t){var i=this;this.vm=e,this.multiSelectComponent=t,this.selectedIdChanged=new K.EventEmitter,this.vm.uiState.changes.subscribe(function(e){i.selectedId=e.value})}var pt=(Object.defineProperty(dt.prototype,"primaryKey",{get:function(){return this.bindingList.primaryKey},enumerable:!0,configurable:!0}),dt.prototype.ngOnInit=function(){this.bindData(),this.registerBindingDataChangeEvent()},dt.prototype.ngOnChanges=function(){this.bindData()},dt.prototype.ngOnDestroy=function(){this.unRegisterBindingDataChangeEvent()},dt.prototype.getPagingInfo=function(){var e=this.viewModel.bindingPath,t=this.viewModel.bindingData.pagingInfo;return"/"===e||e.substr(1).split("/").filter(function(e){return!!e&&0<e.length}).map(function(e){return e.substring(0,e.length-1)}).forEach(function(e){t=t&&t[e]}),t},dt.prototype.setListViewPageProps=function(){var e=this.bindingList.toJSON(),t=this.getPagingInfo()||{},i=t.pageIndex,n=void 0===i?1:i,r=t.pageSize,o=void 0===r?0:r,a=(this.getPagingInfo()||{}).total,s=void 0===a?0:a;0===o&&0===s&&(s=e.length),this.listview.supportPaging=this.supportPaged;var p=this.listview.pageIndex=n,d=this.listview.pageSize=o,l=this.listview.total=s;0===o&&(this.listview.pageIndex=n,p=1,l=this.listview.total=s),this.listview.paginationOptions&&(this.listview.paginationOptions.itemsPerPage=d,this.listview.paginationOptions.currentPage=p,this.listview.paginationOptions.pageList=this.listview.pageList,this.listview.paginationOptions.totalItems=l);var u=this.listview.cdr;u&&u.detectChanges();var c=this.listview.pager&&this.listview.pager.paginationDirective;if(c&&c.service)try{c.service.instances[this.listview.pager.id]=ie({},this.listview.paginationOptions),c.service.setTotalItems(this.listview.pager.id,l),c.changeDetectorRef.detectChanges()}catch(h){}},Object.defineProperty(dt.prototype,"bindingList",{get:function(){if("/"===this.viewModel.bindingPath||!this.viewModel.bindingPath)return this.bindingData.list;var e=this.viewModel.bindingPath.substr(1),t=(e=e[0].toLowerCase()+e.substring(1,e.length)).split("/").filter(function(e){return""!==e});return this.bindingData.getValue(t)},enumerable:!0,configurable:!0}),dt.prototype.bindData=function(){this.setListViewPageProps();var e=this.bindingList.toArray();this.listview.setData(e)},dt.prototype.fireSelectedRowChange=function(e){this.selectedRowChange.emit(e)},dt.prototype.setSelectionIdToBindingData=function(e){this.bindingList.setCurrentId(e,!0)},dt.prototype.onBindingDataChange=function(e){this.bindData(),this.updateSelectedRow(e)},dt.prototype.updateSelectedRow=function(e){if(this.bindingList&&this.bindingList.currentId&&(!this.viewModel||!0!==this.viewModel.frameContext.bindingData.rowSelectedEventSuspend)){var t=(this.listview.clickItem||{}).id;(void 0===t?null:t)!==this.bindingList.currentId&&this.selectRow(this.bindingList.currentId)}},dt.prototype.selectRow=function(e){this.listview&&"function"==typeof this.listview.selectRow&&this.listview.selectRow(e)},dt.prototype.registerBindingDataChangeEvent=function(){var t=this;this.bindingDataChangeEvent=this.bindingData.changes.subscribe(function(e){t.onBindingDataChange(e)})},dt.prototype.unRegisterBindingDataChangeEvent=function(){this.bindingDataChangeEvent.unsubscribe()},dt.prototype.setChecks=function(e){this.viewModel.uiState.setPropertyValue("ids",e)},dt.prototype.changeRow=function(e){var t=e.index,i=e.data;if(!1===e.checkChangeEvent||!e.hasOwnProperty("checkChangeEvent")){if(i&&Array.isArray(i)&&0<i.length){var n=i[0]&&i[0][this.primaryKey]||null;n&&this.setSelectionIdToBindingData(n)}this.listview.activeIndex=t,this.fireSelectedRowChange(e)}},dt.prototype.pageChangedHandler=function(e){var t=e.pageInfo.pageIndex,i=e.pageInfo.pageSize;t<1&&(t=1);var n=(t-1)*i;this.bindingData.setPagingInfo(n,i,this.bindingData.bindingPath)},dt.prototype.pageSizeChangedHandler=function(e){var t=e.pageInfo,i=t.pageIndex,n=t.pageSize,r=(i-1)*+n;this.bindingData.setPagingInfo(r,n,this.bindingData.bindingPath)},dt.prototype.checkValuesChange=function(e){var t=e;this.setChecks(t)},dt.decorators=[{type:K.Directive,args:[{selector:"[farrisListviewBinding]"}]}],dt.ctorParameters=function(){return[{type:V.BindingData},{type:V.ViewModel},{type:l.ListViewComponent}]},dt.propDecorators={supportPaged:[{type:K.Input}],selectedRowChange:[{type:K.Output}],changeRow:[{type:K.HostListener,args:["listClick",["$event"]]}],pageChangedHandler:[{type:K.HostListener,args:["pageChanged",["$event"]]}],pageSizeChangedHandler:[{type:K.HostListener,args:["pageSizeChanged",["$event"]]}],checkValuesChange:[{type:K.HostListener,args:["checkValuesChange",["$event"]]}]},dt);function dt(e,t,i){this.bindingData=e,this.viewModel=t,this.listview=i,this.supportPaged=!0,this.selectedRowChange=new K.EventEmitter}var lt=(Object.defineProperty(ut.prototype,"bindingList",{get:function(){if("/"===this.viewModel.bindingPath||!this.viewModel.bindingPath)return this.bindingData.list;var e=this.viewModel.bindingPath.substr(1),t=(e=e[0].toLowerCase()+e.substring(1,e.length)).split("/").filter(function(e){return""!==e});return this.bindingData.getValue(t)},enumerable:!0,configurable:!0}),ut.prototype.ngOnInit=function(){this.apply()},ut.prototype.ngOnChanges=function(e){this.apply()},ut.prototype.ngOnDestroy=function(){this.detach()},ut.prototype.apply=function(){if(this.grid)if(this.handleGroupStatus(),this.gridEditable){var e=this.injector&&this.injector.get(V.ENABLE_EDIT_STATE_FILTER_SORTING,!1)||!1;this.grid.remoteFilter||e||(this.grid.clearCondition(),this.viewModel.frameContext.appContext.messagePipe.next("CLEAR_GRID_CONDITION")),this.grid.editable=!0,this.viewModel.frameContext.appContext.enableGridHeaderWhenEditing||e||this.grid.disableHeader(!0),this.handleBeginEditEvent(),this.handleAfterEditEvent(),this.handleEndEditEvent()}else this.grid.editable=!1,this.grid.disableHeader(!1),this.grid&&"function"==typeof this.grid.sort&&this.grid.sortName&&this.grid.sort(),this.detach()},ut.prototype.handleGroupStatus=function(){if(!1!==this.disableGroupOnEditing){var e=this.grid&&this.grid.groupField||null;if(e)this.gridEditable&&(this.groupFields=[e],this.grid.setGroupFields(""));else if(this.groupFields&&0<this.groupFields.length){var t=this.groupFields.pop();0<this.groupFields.length&&(this.groupFields=[]),this.grid.setGroupFields(t)}}},ut.prototype.handleBeginEditEvent=function(){var l=this;this.beginEditSubscription=this.grid.beginEdit.subscribe(function(e){if(e){var t=e.column;if(t&&t.editor){var d=e.editor.componentRef.instance;if(!d||!d.instance)return;var r=d.instance.mapFields;if("lookup"===t.editor.type||"PersonnelSelector"===t.editor.type||"OrganizationSelector"===t.editor.type||"external-integration"===t.editor.type||"EmployeeSelector"===t.editor.type||"EmployeeOrgSelector"===t.editor.type){var i=d.instance,n=d.instance.selectedData;n&&n.subscribe(function(e){r=d.instance.mapFields;var t=i.multipleChoiceSeparator||l.defaultSpliter;l.lookupMapping(e,r,!1,t)});var o=d.instance.clearMappings;o&&o.subscribe(function(e){var t=Object.assign({},d.instance.mapFields),i=e&&e.value||null,n=d.column&&d.column.field,r=d.instance.textField,o={};if(n){var a=t[r];if(a){var s=a.split(",").filter(function(e){return e!==n}).join(",");s?t[r]=s:delete t[r]}var p=l.getBindingPathArray();l.bindingData.setValue(p.concat(n.split(".")),i,!0,!0)}t&&0<Object.keys(t).length&&(Object.keys(t).forEach(function(e){l.setValue(o,e.split("."),"")}),l.lookupMapping(o,t,!0))})}"combo-lookup"===t.editor.type&&d.instance.valueChange.subscribe(function(e){var t=e&&e.selections&&0===e.selections.length,i=d.instance;r=d.instance.mapFields;var n=i.separator||l.defaultSpliter;l.lookupMapping(e.selections||[],r,t,n)}),["combo-lookup","combolist","lookup","PersonnelSelector","OrganizationSelector","external-integration","EmployeeSelector","EmployeeOrgSelector"].includes(t.editor.type)&&d.instance.clear&&d.instance.clear.subscribe&&d.instance.clear.subscribe(function(){l.lookupMapping(null,r)}),"combolist"===t.editor.type&&r&&d.instance.valueChange.subscribe(function(e){var t=l.getBindingPathArray();l.viewModel.bindingData.setValue(t.concat(r.split(".")),d.instance.selectedValues,!0,!0)})}}})},ut.prototype.handleAfterEditEvent=function(){var r=this;this.grid.afterEdit=function(e,t,i,n){return r.dialogSer.hasDialogOpened()?F.of(!1):r.rts&&r.rts.getFormState("lookup.pending")?F.of(!1):n&&n.formControl?F.of(!0):F.of(!1)}},ut.prototype.handleEndEditEvent=function(){var d=this;this.endEditSubscription=this.grid&&this.grid.endEdit&&this.grid.endEdit.subscribe(function(e){var t=e||{},i=t.value,n=void 0===i?undefined:i,r=t.column,o=void 0===r?undefined:r,a=t.rowData,s=void 0===a?{}:a,p=s&&s[d.grid.idField]||null;d.updateBindingData(n,o,p)})},ut.prototype.updateBindingData=function(e,t,i){if(t){var n=t.dataType,r=t.field.split("."),o=t&&t.editor&&t.editor.options&&t.editor.options.bigNumber;if("date"===n){var a=void 0;a=e?this.dateService.formatTo(e,"yyyy-MM-dd"):e,this.updateBindingList(i,r.join("."),a)}else"datetime"===n?this.updateBindingList(i,r.join("."),e):"number"!==n||o?this.updateBindingList(i,r.join("."),e):null===e||e===undefined?this.updateBindingList(i,r.join("."),null):this.updateBindingList(i,r.join("."),Number(e))}},ut.prototype.updateBindingList=function(e,t,i){if(this.viewModel&&t){var n=t.split(".").filter(function(e){return e}),r=this.getBindingPathArray(),o=this.bindingData.getValue(r);if(o&&e===o.currentItem.primaryKeyValue){var a=r.concat(n);this.bindingData.setValue(a,i,!0,!0)}else{var s=this.bindingList.findById(e);if(s)if(n.length<2)s.setValue(t,i,!0,!0);else{var p=null,d=n.slice(0,n.length-1),l=n[n.length-1];d.forEach(function(e){p=p&&p[e]||s[e]}),p.setValue(l,i,!0,!0)}}}},ut.prototype.detach=function(){this.beginEditSubscription&&"function"==typeof this.beginEditSubscription.unsubscribe&&this.beginEditSubscription.unsubscribe(),this.endEditSubscription&&"function"==typeof this.endEditSubscription.unsubscribe&&this.endEditSubscription.unsubscribe()},ut.prototype.lookupMapping=function(o,a,e,s){var p=this;if(void 0===e&&(e=!1),void 0===s&&(s=","),a){var t=this.viewModel.frameContext.appContext;t.changeDetectionController.detach();var d=this.getBindingPathArray(),i=Object.keys(a),n=this.getMapFieldsPrimaryKey(a,d),r=n&&n.map(function(e){return e.primaryKey})||[],l=n&&n.map(function(e){return e.primaryField})||[];r&&0<r.length&&(r=oe(new Set(r)),i=this.sortMapFieldKeys(i,r)),o&&!e||i.reverse(),i.forEach(function(t){var i="";o&&(i=o instanceof Array?o.map(function(e){return p.getValue(t,e)}).join(s):p.getValue(t,o));var e=a[t].split(","),n=e.filter(function(e){return l.includes(e)}),r=e.filter(function(e){return!l.includes(e)});(e=o?[].concat(n).concat(r):[].concat(r).concat(n)).forEach(function(e){o?p.viewModel.bindingData.setValue(d.concat(e.split(".")),i,!0,!0):p.viewModel.bindingData.clearValue(d.concat(e.split(".")),!0,!0)})}),t.changeDetectionController.reattach()}},ut.prototype.getValue=function(e,t){return-1===e.indexOf(".")?t[e]:e.split(".").reduce(function(e,t){return e[t]},t)},ut.prototype.getBindingPathArray=function(){var e=this.viewModel.bindingPath;return e?e.split("/").filter(function(e){return""!==e}):[]},ut.prototype.isNumberValue=function(e,t){var i=this.getValue(e,t);return O.isNumber(i)},ut.prototype.getMapFieldsPrimaryKey=function(t,r){if(!t||Object.keys(t).length<1)return null;var o=[];try{var a=this.viewModel.frameContext.repository.entityTypeInfo;Object.keys(t).forEach(function(n){var e=t[n];e&&"string"==typeof e&&e.split(",").filter(function(e){return e}).forEach(function(e){var t=e.split(".");r&&0<r.length&&(t=r.concat(t));var i=a.getPropInfoByPath(t);i&&i.metadataInfo&&!0===i.metadataInfo.primary&&o.push({primaryKey:n,primaryField:e})})})}catch(e){console.error(e)}return o},ut.prototype.setValue=function(e,t,i){e&&(t.length<=1?e[t[0]]=i:t.slice(0,-1).reduce(function(e,t){return e.hasOwnProperty(t)||e.__proto__.hasOwnProperty(t)||(e[t]={}),e[t]},e)[t[t.length-1]]=i)},ut.prototype.sortMapFieldKeys=function(e,t){return!t||t.length<1||!e||e.length<1?e:(e=e.filter(function(e){return!t.includes(e)}),[].concat(t).concat(e))},ut.decorators=[{type:K.Directive,args:[{selector:"[farris-datagrid-editable]"}]}],ut.ctorParameters=function(){return[{type:V.BindingData},{type:V.ViewModel},{type:L.DatagridComponent},{type:o.DateTimeHelperService},{type:K.Injector},{type:q.RuntimeStateService},{type:_.DialogService},{type:K.NgZone}]},ut.propDecorators={gridEditable:[{type:K.Input,args:["farris-datagrid-editable"]}],disableGroupOnEditing:[{type:K.Input,args:["disableGroupOnEditing"]}]},ut);function ut(e,t,i,n,r,o,a,s){this.bindingData=e,this.viewModel=t,this.grid=i,this.dateService=n,this.injector=r,this.rts=o,this.dialogSer=a,this.ngZone=s,this.disableGroupOnEditing=!0,this.defaultSpliter=",",this.groupFields=[]}var ct=(ht.prototype.ngOnDestroy=function(){},ht);function ht(e){var t=this;this.appContext=e,this.messagePipe=this.appContext&&this.appContext.messagePipe,this.messagePipe&&this.messagePipe.subscribe(function(e){e&&"endEdit"===e.type&&t.endEdit(e)})}var ft,gt=(te(yt,ft=ct),yt.prototype.ngOnInit=function(){this.elementRef&&(this.nativeElement=this.elementRef.nativeElement)},yt.prototype.endEdit=function(e){if(this.nativeElement){var t=this.nativeElement.parentNode||this.nativeElement.parentElement,i=t&&Array.from(t.getElementsByTagName("input"))||[];i&&0<i.length&&i.forEach(function(e){e&&"function"==typeof e.blur&&e.blur()})}},yt.decorators=[{type:K.Directive,args:[{selector:"[input-end-edit]"}]}],yt.ctorParameters=function(){return[{type:V.AppContext},{type:K.ElementRef}]},yt);function yt(e,t){var i=ft.call(this,e)||this;return i.appContext=e,i.elementRef=t,i}var mt,vt=(te(Ct,mt=ct),Ct.prototype.endEdit=function(e){this.datagrid&&"function"==typeof this.datagrid.endCellEdit&&this.datagrid.endCellEdit()},Ct.decorators=[{type:K.Directive,args:[{selector:"[farris-grid-end-edit]"}]}],Ct.ctorParameters=function(){return[{type:V.AppContext},{type:L.DatagridComponent}]},Ct);function Ct(e,t){var i=mt.call(this,e)||this;return i.appContext=e,i.datagrid=t,i}var bt,Dt=(te(It,bt=ct),It.prototype.endEdit=function(e){this.editor&&"function"==typeof this.editor.endEdit&&this.editor.endEdit()},It.decorators=[{type:K.Directive,args:[{selector:"[html-editor-end-edit]"}]}],It.ctorParameters=function(){return[{type:V.AppContext},{type:c.HtmlEditorComponent}]},It);function It(e,t){var i=bt.call(this,e)||this;return i.appContext=e,i.editor=t,i}var St,xt=(te(wt,St=ct),wt.prototype.endEdit=function(e){this.grid&&"function"==typeof this.grid.closeCell&&this.grid.closeCell()},wt.decorators=[{type:K.Directive,args:[{selector:"[kendo-grid-end-edit]"}]}],wt.ctorParameters=function(){return[{type:V.AppContext},{type:G.GridComponent}]},wt);function wt(e,t){var i=St.call(this,e)||this;return i.appContext=e,i.grid=t,i}var Et=(Pt.prototype.execute=function(e,t){if(e&&""!==e&&"undefined"!==e){var i=this.viewModel;return t&&(i=i.frameContext.appContext.frameContextManager.getFrameContextById(t).viewModel),i[e]()}},Pt.decorators=[{type:K.Directive,args:[{selector:"[farris-remote-summary-command]"}]}],Pt.ctorParameters=function(){return[{type:V.ViewModel},{type:L.DatagridComponent}]},Pt.propDecorators={remoteSummaryCommand:[{type:K.Input,args:["farris-remote-summary-command"]}]},Pt);function Pt(e,t){var n=this;this.viewModel=e,this.grid=t;var i=this.viewModel.frameContext.getFormAppContext();i&&i.hasOwnProperty("messagePipe")&&i.messagePipe.subscribe(function(e){if("query"===(e&&e.type||null)&&n.remoteSummaryCommand&&"server"===n.grid.footerDataFrom){var t=n.remoteSummaryCommand.split("."),i=null;t.forEach(function(e){i=i&&i[e]||n[e]}),"function"==typeof i&&i().subscribe(function(e){n.grid.footerData=e})}})}var Ot=(Object.defineProperty(Lt.prototype,"focusState",{set:function(e){this._state.next(e)},enumerable:!0,configurable:!0}),Lt.prototype.ngOnInit=function(){var t=this;this.selfEl=this.el.nativeElement,this._state.subscribe(function(e){!1===e&&t.selfEl&&("farris-html-editor"===t.selfEl.nodeName.toLowerCase()?t.setHtmlEditorFocus():t.setFocus())})},Lt.prototype.setFocus=function(){var e=this.selfEl.querySelectorAll("input");e.length?e[0].focus():this.selfEl.focus()},Lt.prototype.setHtmlEditorFocus=function(){var e=this.selfEl.querySelector('div[contenteditable="true"]'),t=window.getSelection();t.selectAllChildren(e),t.collapseToEnd()},Lt.decorators=[{type:K.Directive,args:[{selector:"[farris-set-focus]"}]}],Lt.ctorParameters=function(){return[{type:K.Renderer2},{type:K.Injector},{type:K.ElementRef}]},Lt.propDecorators={focusState:[{type:K.Input}]},Lt);function Lt(e,t,i){this.rd=e,this.injector=t,this.el=i,this._state=new F.BehaviorSubject({})}var Tt=(Object.defineProperty(Rt.prototype,"bindingData",{get:function(){return this.frameContext.bindingData},enumerable:!0,configurable:!0}),Object.defineProperty(Rt.prototype,"bindingList",{get:function(){return this.bindingData.getList()},enumerable:!0,configurable:!0}),Object.defineProperty(Rt.prototype,"orderField",{get:function(){return this.uploadAndPreviewComponent&&this.uploadAndPreviewComponent.enableOrder&&this.uploadAndPreviewComponent.orderField||this.fileSortOrderKey&&this.SORT_FIELD_ON_SORTING||this.DEFAULT_SORT_FIELD},enumerable:!0,configurable:!0}),Object.defineProperty(Rt.prototype,"orderType",{get:function(){return this.farrisOrderType?this.farrisOrderType:this.orderField===this.DEFAULT_SORT_FIELD?"desc":"asc"},enumerable:!0,configurable:!0}),Rt.prototype.ngOnInit=function(){var n=this;this.bindData(),this.uploadAndPreviewComponent&&(this.uploadAndPreviewComponent.enableOrder&&(this.uploadAndPreviewComponent.orderField=this.SORT_FIELD_ON_SORTING),this.uploadAndPreviewComponent.enableSorting=!1,this.uploadAndPreviewComponent.fSelectedEvent.subscribe(function(e){var t=n.bindingList.primaryKey,i=e&&e.originalData&&e.originalData[t];i&&i!==n.bindingList.currentId&&n.bindingList.setCurrentId(i,!0)})),this.bindingData.changes.subscribe(function(e){e.type!==V.ChangeType.Load&&e.type!==V.ChangeType.Append&&e.type!==V.ChangeType.Remove&&e.type!==V.ChangeType.ValueChanged&&e.type!==V.ChangeType.SelectionChanged||(n.bindData(e),n.updateCurrentRow(e),n.updateChecks(e))}),this.setChecks([])},Rt.prototype.ngOnChanges=function(e){},Rt.prototype.shouldComponentUpdate=function(e){return!(JSON.stringify(this.__DATA__)===JSON.stringify(e))},Rt.prototype.bindData=function(e){var t=this.frameContext.viewModel.bindingPath.split("/").filter(function(e){return e}).join("/"),i=e&&e.path&&e.path.filter(function(e){return e}).join("/");if(e&&[V.ChangeType.SelectionChanged,V.ChangeType.Remove,V.ChangeType.Load,V.ChangeType.Append].includes(e.type)){if(!t.startsWith(i))return;if(e.type===V.ChangeType.SelectionChanged&&t===i)return}if(!e||e.type!==V.ChangeType.ValueChanged||i.startsWith(t)){var n=this.getFileInfos();if(this.shouldComponentUpdate(n)&&this.componentRef){if(this.__DATA__=n,this.componentRef.fileInfos=n,this.uploadAndPreviewComponent&&n&&0<n.length){var r=n.map(function(e){return e.originalData});this.uploadAndPreviewComponent.extendInfos=r}this.changeCurrentRow(n,e)}}},Rt.prototype.updateChecks=function(e){if(this.uploadAndPreviewComponent){var t=this.frameContext.viewModel.bindingPath.split("/").filter(function(e){return e}).join("/"),i=e&&e.path&&e.path.filter(function(e){return e}).join("/");if(e&&e.type===V.ChangeType.Remove&&i===t){var n=e.value||[],r=this.frameContext.uiState.ids||[];0<n.length&&0<r.length&&n.forEach(function(e){var t=r.indexOf(e);-1!==t&&r.splice(t,1)})}else e.type!==V.ChangeType.Remove&&e.type!==V.ChangeType.SelectionChanged||!t.startsWith(i)||t===i?e&&e.type===V.ChangeType.Load&&(t===i||t.startsWith(i)&&t!==i)&&(this.setChecks([]),this.clearComponentChecks()):(this.setChecks([]),this.clearComponentChecks())}},Rt.prototype.changeCurrentRow=function(e,t){var i=this;if(this.uploadAndPreviewComponent){var n=t&&t.path.join("/"),r=this.frameContext.viewModel.bindingPath.split("/").filter(function(e){return e}).join("/"),o=r.startsWith(n)&&t.type===V.ChangeType.SelectionChanged&&r!==n,a=t&&t.type===V.ChangeType.Remove&&r===n;if(e&&0<e.length&&t&&(t.type===V.ChangeType.Load||o||a)){var s=this.bindingList.primaryKey,p=e[0].originalData&&e[0].originalData[s];this.bindingList.currentId!==p&&setTimeout(function(){i.bindingList.setCurrentId(p,!0,!0)},100)}}},Rt.prototype.updateCurrentRow=function(e){if(this.bindingList&&this.bindingList.currentId&&this.uploadAndPreviewComponent&&(!e||e.type===V.ChangeType.SelectionChanged||e.type===V.ChangeType.Load||e.type===V.ChangeType.Remove)){var t=this.uploadAndPreviewComponent.previewCurrent,i=this.getValueByPath(this.bindingList.currentItem,this.fileIdKey);i!==t&&this.selectComponentRow(i)}},Rt.prototype.getFileInfos=function(){var i=this,e=this.bindingList.toJSON(),n=[];return e.forEach(function(e){var t=i.convertToFileInfo(e);n.push(t)}),this.orderField&&this.sort(n,this.orderField,this.orderType),n},Rt.prototype.convertToFileInfo=function(t){var i=this,e=this.getValueByPath(t,this.fileIdKey),n={id:e,name:this.getValueByPath(t,this.fileNameKey),size:this.getValueByPath(t,this.fileSizeKey),createTime:this.getValueByPath(t,this.fileCreateTimeKey),originalData:t,extend:{metadataId:e}};if(this.extendFileInfo&&Array.isArray(this.extendFileInfo)&&0<this.extendFileInfo.length&&this.extendFileInfo.forEach(function(e){n[e.key]=i.getValueByPath(t,e.path)}),this.fileSortOrderKey){var r=this.getValueByPath(t,this.fileSortOrderKey);n[this.SORT_FIELD_ON_SORTING]=r}return n},Rt.prototype.selectComponentRow=function(e){this.uploadAndPreviewComponent&&(this.uploadAndPreviewComponent.previewCurrent=e)},Rt.prototype.getValueByPath=function(e,t){var i=t.split("."),n=e;return i.forEach(function(e){n=n&&n[e]}),n},Rt.prototype.getUdtPaths=function(){var e=this.fileIdKey.split(".");return e.pop(),e},Object.defineProperty(Rt.prototype,"fileSizeKey",{get:function(){return this.getUdtPaths().concat(["fileSize"]).join(".")},enumerable:!0,configurable:!0}),Object.defineProperty(Rt.prototype,"fileCreateTimeKey",{get:function(){return this.getUdtPaths().concat(["fileCreateTime"]).join(".")},enumerable:!0,configurable:!0}),Object.defineProperty(Rt.prototype,"componentRef",{get:function(){return this.previewComponent||this.uploadAndPreviewComponent||null},enumerable:!0,configurable:!0}),Rt.prototype.setChecks=function(e){this.frameContext.uiState.setPropertyValue("ids",e)},Rt.prototype.clearComponentChecks=function(){this.uploadAndPreviewComponent&&this.uploadAndPreviewComponent.previewUpdateRefresh()},Rt.prototype.sort=function(e,t,i){var s=this;if(!t||t.length<1||!i||i.length<1)throw new Error("sortBy:argument error");var p,d,n="string"==typeof t?t.split(","):t||[],r="string"==typeof i?i.split(","):i||[];if(n.length!==r.length||n.length<1)throw new Error("sortBy:fields and directions not match");e.sort((p=n,d=r,function(o,a){return p.reduce(function(e,t){if(0===e){var i=["asc"].includes(d[p.indexOf(t)])?1:-1,n=s.getValue(o,t),r=s.getValue(a,t);if(null===n||n===undefined)return 1;if(null===r||r===undefined)return-1;typeof n!=typeof r?e=String(n).localeCompare(String(r))*i:"string"==typeof n&&"string"==typeof r?e=n.localeCompare(r)*i:(r<n&&(e=1*i),n<r&&(e=-1*i))}return e},0)}))},Rt.prototype.getValue=function(e,t){var i,n;e instanceof V.BindingList?e=e.currentItem:e instanceof V.BindingData&&(e=e.list.currentItem);var r=null;if(-1===t.indexOf("."))r=e[t];else{var o=t.split(".");try{for(var a=ne(o),s=a.next();!s.done;s=a.next()){var p=s.value;e=r=this.getValue(e,p)}}catch(d){i={error:d}}finally{try{s&&!s.done&&(n=a["return"])&&n.call(a)}finally{if(i)throw i.error}}}return r},Rt.prototype.checkedChanged=function(e){var t=this.bindingList.primaryKey,i=e&&e.map(function(e){return e&&e.originalData&&e.originalData[t]||""}).filter(function(e){return e})||[];this.setChecks(i)},Rt.prototype.selectChanged=function(e){},Rt.decorators=[{type:K.Directive,args:[{selector:"[farrisFilePreviewBinding]"}]}],Rt.ctorParameters=function(){return[{type:n.FFilePreviewComponent,decorators:[{type:K.Optional}]},{type:V.FrameContext},{type:n.UploadAndPreviewComponent,decorators:[{type:K.Optional}]},{type:K.Injector,decorators:[{type:K.Optional}]}]},Rt.propDecorators={extendFileInfo:[{type:K.Input,args:["extendFileInfo"]}],farrisOrderType:[{type:K.Input,args:["farrisOrderType"]}],fileIdKey:[{type:K.Input,args:["farrisFileIdKey"]}],fileSortOrderKey:[{type:K.Input,args:["farrisFileSortOrderKey"]}],fileNameKey:[{type:K.Input,args:["farrisFileNameKey"]}],checkedChanged:[{type:K.HostListener,args:["fPreviewMultiSelectedEvent",["$event"]]}],selectChanged:[{type:K.HostListener,args:["fSelectedEvent",["$event"]]}]},Rt);function Rt(e,t,i,n){this.previewComponent=e,this.frameContext=t,this.uploadAndPreviewComponent=i,this.injector=n,this.DEFAULT_SORT_FIELD="createTime",this.SORT_FIELD_ON_SORTING="fileSortOrder"}var Ft="DISCUSSION_REPLY_MESSAGE_INFO",Mt=(kt.prototype.ngOnInit=function(){var t=this;this.discussionEditorComponent.replyUser=this.viewModel.frameContext.root.viewModel.uiState[Ft]||{},this.viewModel.frameContext.root.viewModel.uiState.changes.subscribe(function(e){e.field===Ft&&(t.discussionEditorComponent.replyUser=t.viewModel.frameContext.root.viewModel.uiState[Ft]||{})}),this.queryFrequentAtUsersCommand?this.queryFrequentAtUsers():this.queryAtUsers(),this.queryAllOrgs()},kt.prototype.queryAllOrgs=function(){var t=this;this.execute(this.queryAllOrgsCommand).subscribe(function(e){e&&(t.discussionEditorComponent.sectionData=e)})},kt.prototype.queryAtUsers=function(){var n=this;this.execute(this.userQueryCommand).subscribe(function(e){if(e){var t=e.users,i=void 0===t?[]:t;n.discussionEditorComponent.personnels=i}})},kt.prototype.queryFrequentAtUsers=function(){var t=this;this.execute(this.queryFrequentAtUsersCommand).subscribe(function(e){e&&(t.discussionEditorComponent.personnels=e&&e.users||[])})},kt.prototype.pageChangedHandler=function(e){var t=this,i=e||{},n=i.msgInfo,r=void 0===n?0:n,o=i.text,a=void 0===o?"":o,s=i.visibility,p=void 0===s?"ALL":s,d=i.parentId,l=void 0===d?null:d;1===r?this.execute(this.addCommentCommand,{text:a,parentId:l,visibility:p}).pipe(M.tap(function(){t.viewModel.frameContext.appContext.messagePipe.next("onCommentAdd")}),M.catchError(function(e){return F.EMPTY})).subscribe():(this.viewModel.frameContext.root.viewModel.uiState[Ft]={},this.discussionEditorComponent.replyUser={})},kt.prototype.execute=function(e,t){var i=this;if(!e||""===e||"undefined"===e)return F.of(null);void 0===t&&(t={});var n=e.split("."),r=null;return n.forEach(function(e){r=r&&r[e]||i[e]}),"function"==typeof r?r(t):F.of(null)},kt.decorators=[{type:K.Directive,args:[{selector:"[farris-discussion-editor-binding]"}]}],kt.ctorParameters=function(){return[{type:K.Injector},{type:I.DiscussionEditorComponent},{type:V.ViewModel}]},kt.propDecorators={userQueryCommand:[{type:K.Input,args:["userQueryCommand"]}],addCommentCommand:[{type:K.Input,args:["addCommentCommand"]}],queryAllOrgsCommand:[{type:K.Input,args:["queryAllOrgsCommand"]}],queryFrequentAtUsersCommand:[{type:K.Input,args:["queryFrequentAtUsersCommand"]}],pageChangedHandler:[{type:K.HostListener,args:["valueChange",["$event"]]}]},kt);function kt(e,t,i){this.injector=e,this.discussionEditorComponent=t,this.viewModel=i}var Nt=(jt.prototype.ngOnInit=function(){var t=this;this.viewModel.frameContext.appContext.messagePipe.subscribe(function(e){"onCommentAdd"===e&&t.queryComments()}),this.viewModel.bindingData.changes.subscribe(function(e){e.type!==V.ChangeType.Load&&e.type!==V.ChangeType.SelectionChanged||t.queryComments()})},jt.prototype.queryComments=function(e,t){var s=this;void 0===e&&(e=this.discussionListComponent.pageIndex-1||0),void 0===t&&(t=this.discussionListComponent.supportPaging?this.discussionListComponent.pageSize:1e4),this.execute(this.commentsQueryCommand,{pageIndex:e,pageSize:t}).pipe(M.catchError(function(e){return F.EMPTY})).subscribe(function(e){if(e){e.comments;var t=e.pageIndex,i=void 0===t?0:t,n=e.pageSize,r=void 0===n?10:n,o=e.totalCount,a=void 0===o?0:o;s.discussionListComponent.pageIndex=parseInt(i)+1,s.discussionListComponent.supportPaging&&(s.discussionListComponent.pageSize=r),s.discussionListComponent.total=a,s.discussionListDirective.discussionListData=e}})},jt.prototype.replyMessagedHandler=function(e){this.viewModel.frameContext.root.viewModel.uiState.setPropertyValue("DISCUSSION_REPLY_MESSAGE_INFO",e)},jt.prototype.pageChangedHandler=function(e){var t=e.pageInfo||{},i=t.pageIndex,n=void 0===i?1:i,r=t.pageSize,o=void 0===r?10:r;this.queryComments(n-1,o)},jt.prototype.execute=function(e,t){var i=this;if(!e||""===e||"undefined"===e)return F.of(null);var n=e.split("."),r=null;return n.forEach(function(e){r=r&&r[e]||i[e]}),"function"==typeof r?r(t):F.of(null)},jt.decorators=[{type:K.Directive,args:[{selector:"[farris-discussion-list-binding]"}]}],jt.ctorParameters=function(){return[{type:K.Injector},{type:I.DiscussionListComponent},{type:V.ViewModel},{type:I.DiscussionListDirective}]},jt.propDecorators={commentsQueryCommand:[{type:K.Input,args:["commentsQueryCommand"]}],replyMessagedHandler:[{type:K.HostListener,args:["replyMessage",["$event"]]}],pageChangedHandler:[{type:K.HostListener,args:["pageChanged",["$event"]]}]},jt);function jt(e,t,i,n){this.injector=e,this.discussionListComponent=t,this.viewModel=i,this.discussionListDirective=n}var At=(Object.defineProperty(Vt.prototype,"bindingData",{get:function(){return this.frameContext.bindingData},enumerable:!0,configurable:!0}),Object.defineProperty(Vt.prototype,"bindingList",{get:function(){return this.bindingData.getList()},enumerable:!0,configurable:!0}),Vt.prototype.getHierarchyInfoField=function(){var e=this.hierarchyInfoKey.split("/");return e[e.length-1]},Vt.prototype.ngOnChanges=function(e){},Vt.prototype.ngOnInit=function(){var t=this;this.hierarchyInfoField=this.getHierarchyInfoField(),this.frameContext.getVirtualRootFrameContext().setParam("hierarchyInfoKey",this.hierarchyInfoKey),this.bindingData.changes.subscribe(function(e){t.bindData(e),t.updateSelectedRow(e)}),this.frameContext.viewModel.uiState.setPropertyValue("ids",[]),this.frameContext&&this.frameContext.frameComponent&&(this.frameContext.frameComponent.componentType=V.ComponentType.primengTreeComponent)},Vt.prototype.getEntityArr=function(){var e=this.frameContext.repository.entityCollection,t=this.frameContext.bindingData.bindingPath;if(!t||"/"===t)return e.toArray();var i=this.frameContext.bindingData.list,n=t.split("/").filter(function(e){return e}),r=[];return n.forEach(function(e){r.push(i.primaryKey+":"+i.currentId),r.push(e),i=i.currentItem[e]}),e.getEntitiesByPath(r).toArray()},Vt.prototype.setActualIndex=function(t,e){var i=this;if(!(t.length<1)){var n={index:0},r=t[0].primaryKey;e.forEach(function(e){i.traverseTree(e,n,t,r)})}},Vt.prototype.traverseTree=function(t,i,n,r){var o=this,e=n.find(function(e){return e[r]===t.data[r]});e&&(Object.defineProperty(e,"__ACTUAL_INDEX__",{value:i.index}),i.index++),t.children.forEach(function(e){o.traverseTree(e,i,n,r)})},Vt.prototype.handleChange=function(e){if(!e)return!1;switch(e.type){case V.ChangeType.SelectionChanged:case V.ChangeType.GlobalSelectionChanged:return this.handleSelectionChanged(e);case V.ChangeType.ValueChanged:return this.handleValueChanged(e);default:return!1}},Vt.prototype.handleSelectionChanged=function(e){if(e.type===V.ChangeType.SelectionChanged||e.type===V.ChangeType.GlobalSelectionChanged){var t=e.path,i=this.bindingData.bindingPath.split("/").filter(function(e){return e});if(t.length===i.length){for(var n=!0,r=0;r<t.length;r++)t[r]!==i[r]&&(n=!1);if(n)return!0}}return!1},Vt.prototype.handleValueChanged=function(e){var t,i,n,r;if(e.type!==V.ChangeType.ValueChanged)return!1;var o=e.path,a=this.bindingData.bindingPath.split("/").filter(function(e){return e});try{for(var s=ne(a),p=s.next();!p.done;p=s.next()){var d=p.value;if(0<o.length){if(d!==o[0])return!1;o.shift()}}}catch(C){t={error:C}}finally{try{p&&!p.done&&(i=s["return"])&&i.call(s)}finally{if(t)throw t.error}}var l=e.id;if(l){var u=this.bindingList.primaryKey,c=this.treeTable.value,h=null;try{for(var f=ne(c),g=f.next();!g.done;g=f.next()){var y=g.value,m=this.findTreeNodeById(y,u,l);if(m){h=m;break}}}catch(b){n={error:b}}finally{try{g&&!g.done&&(r=f["return"])&&r.call(f)}finally{if(n)throw n.error}}if(h&&1===o.length){var v=o.shift();if(h.data.hasOwnProperty(v)&&e.hasOwnProperty("value"))return h.data[v]=e.value,!0}}return!1},Vt.prototype.findTreeNodeById=function(e,t,i){var n,r;if(!e)return null;if(e.data.hasOwnProperty(t)&&e.data[t]===i)return e;if(e.children)try{for(var o=ne(e.children),a=o.next();!a.done;a=o.next()){var s=a.value,p=this.findTreeNodeById(s,t,i);if(p)return p}}catch(d){n={error:d}}finally{try{a&&!a.done&&(r=o["return"])&&r.call(o)}finally{if(n)throw n.error}}return null},Vt.prototype.bindData=function(e){if(!this.handleChange(e)){var t=this.treeTable.value,i=this.bindingList.toJSON({ignoreMultiLangInput:!0}),n=[];if(i&&0<i.length){var r=i[0][this.hierarchyInfoField],o=Me.getBuilder(r);if(null==o)throw new Error("TreeTable builder is null!");var a=-1,s=this.treeTable.expandLevel;void 0!==s&&(a=s);var p={expandLevel:a,component:this.treeTable};n=new o(i,t,this.bindingList.primaryKey,this.hierarchyInfoField,p).build();var d=this.getEntityArr();this.setActualIndex(d,n)}this.treeTable.lazy||(this.treeTable.totalRecords=this.treeTable._value?this.treeTable._value.length:0,"single"==this.treeTable.sortMode&&this.treeTable.sortField?this.treeTable.sortSingle():"multiple"==this.treeTable.sortMode&&this.treeTable.multiSortMeta?this.treeTable.sortMultiple():this.treeTable.hasFilter()&&this.treeTable._filter()),this.treeTable.tableService.onUIUpdate(n),this.treeTable.value=n,this.treeTable.updateSerializedValue()}},Vt.prototype.updateSelectedRow=function(e){var t=this.bindingList.currentId;if(this.treeTableSelectedEvent)return this.treeTableSelectedEvent=!1,void(this.selectedRowId=t);var i=this.treeTable.serializedValue,n=i&&i.find(function(e){return e&&e.node&&e.node.data&&e.node.data.id===t})||null;if(n){if(this.treeTable.isSelected(n.node)||t===this.selectedRowId)return;this.selectedRowId=t,this.treeTable.handleRowClick({rowNode:n,originalEvent:{target:{nodeName:""}}})}},Vt.prototype.onEditInitHandler=function(e){this.nodeSelectChange.emit(e.data);var t=e.data[this.idField];this.setCurrentIdToBindingList(t)},Vt.prototype.onEditCompleteHandler=function(e){var t=e.field,i=this.columns.find(function(e){return e.field===t});if(!(t&&i&&i.editor&&i.editor.options&&"EditorTypes.LOOKUP"===i.editor.options.type)&&e&&e.hasOwnProperty("data")){var n=e.data[this.frameContext.repository.primaryKey],r=this.getValue(t,e.data),o=(this.frameContext.viewModel.bindingPath||"/").split("/").filter(function(e){return e}),a=this.bindingData.getValue(o).findById(n),s=this.getValue(t,a),p=this.treeTable.columns.find(function(e){return e.field===t}),d=p&&p.dataType||null;if("date"===d||"datetime"===d){if(this.dateService){var l=p&&p.formatter&&p.formatter.options&&p.formatter.options.format||"yyyy-MM-dd";r=(r=this.dateService.formatTo(r,l))||null}}else"number"===d&&(r=Number(r));r!==s&&this.updateBindingList(n,t,r)}},Vt.prototype.onNodeExpandHandler=function(e){var t=e&&e.node&&e.node.id||null;if(t){var i=this.frameContext.getVirtualRootFrameContext(),n=i.getParam("TREE_LATEST_EXPANDED_ID")||[];n.push(t),i.setParam("TREE_LATEST_EXPANDED_ID",n)}},Vt.prototype.onNodeCollapseHandler=function(e){},Vt.prototype.onNodeSelectHandler=function(e){var t=e&&e.node&&e.node.data&&e.node.data[this.frameContext.repository.primaryKey]||null;t!==this.bindingList.currentId&&(this.treeTableSelectedEvent=!0,this.setCurrentIdToBindingList(t))},Vt.prototype.onNodeUnselectHandler=function(e){this.setCurrentIdToBindingList(null)},Vt.prototype.setNodeExpandedValue=function(e){if(e&&this.oldTreeNodeMap&&!(Object.keys(this.oldTreeNodeMap).length<=0))try{var t=e.node.data.id;this.oldTreeNodeMap[t].expanded=e.expanded}catch(i){console.warn("setNodeExpandedValue error:"+i.message)}},Vt.prototype.setCurrentIdToBindingList=function(e){this.bindingList.currentId!==e&&this.bindingList.setCurrentId(e,!0)},Vt.prototype.getPaths=function(){var e=[];if(this.frameContext.viewModel&&this.frameContext.viewModel.bindingPath&&"/"!==this.frameContext.viewModel.bindingPath){var t=this.frameContext.viewModel.bindingPath;return e=t.substring(1,t.length).split("/")}return e},Vt.prototype.updateBindingList=function(e,t,i){if(t){var n=t.split(".").filter(function(e){return e}),r=this.getBindingPathArray(),o=this.bindingData.getValue(r),a=r.concat(n);if(o&&e===o.currentItem.primaryKeyValue)this.bindingData.setValue(a,i,!0,!0);else{var s=this.bindingList.findById(e);if(s)if(n.length<2)s.setValue(t,i,!0,!0,undefined,this.bindingData.getValudChangeInvokerFactory()(a));else{var p=null,d=n.slice(0,n.length-1),l=n[n.length-1];d.forEach(function(e){p=p&&p[e]||s[e]}),p.setValue(l,i,!0,!0,undefined,this.bindingData.getValudChangeInvokerFactory()(a))}}}},Vt.prototype.getBindingPathArray=function(){var e=this.frameContext.viewModel.bindingPath;return e?e.split("/").filter(function(e){return""!==e}):[]},Vt.prototype.getValue=function(e,t){return-1===e.indexOf(".")?t[e]:e.split(".").reduce(function(e,t){return e[t]},t)},Vt.prototype.setChecks=function(e){this.frameContext.viewModel.uiState.setPropertyValue("ids",e)},Vt.decorators=[{type:K.Directive,args:[{selector:"[farrisPrimengTreeTableBinding]"}]}],Vt.ctorParameters=function(){return[{type:r.TreeTable},{type:V.FrameContext},{type:o.DateTimeHelperService}]},Vt.propDecorators={hierarchyInfoKey:[{type:K.Input,args:["farrisHierarchyInfoKey"]}],columns:[{type:K.Input,args:["columns"]}],idField:[{type:K.Input,args:["farrisPrimengTreeTableIdField"]}],nodeSelectChange:[{type:K.Output}],onEditInitHandler:[{type:K.HostListener,args:["onEditInit",["$event"]]}],onEditCompleteHandler:[{type:K.HostListener,args:["onEditComplete",["$event"]]}],onNodeExpandHandler:[{type:K.HostListener,args:["onNodeExpand",["$event"]]}],onNodeCollapseHandler:[{type:K.HostListener,args:["onNodeCollapse",["$event"]]}],onNodeSelectHandler:[{type:K.HostListener,args:["onNodeSelect",["$event"]]}],onNodeUnselectHandler:[{type:K.HostListener,args:["onNodeUnselect",["$event"]]}]},Vt);function Vt(e,t,i){this.treeTable=e,this.frameContext=t,this.dateService=i,this.selectedRowId=null,this.treeTableSelectedEvent=null,this.nodeSelectChange=new K.EventEmitter,this.oldTreeNodeMap={}}var Bt=(Ht.prototype.ngOnDestroy=function(){this.updateValidateRule(!1)},Ht.prototype.ngOnChanges=function(e){this.updateValidateRule(this.requiredOn)},Ht.prototype.updateValidateRule=function(e){this.field&&this.frameContext.form.updateFieldValidateRule(this.field,e)},Ht.decorators=[{type:K.Directive,args:[{selector:"[farris-dynamic-required]"}]}],Ht.ctorParameters=function(){return[{type:V.FrameContext},{type:K.Injector}]},Ht.propDecorators={field:[{type:K.Input,args:["farris-dynamic-required"]}],requiredOn:[{type:K.Input,args:["requiredOn"]}]},Ht);function Ht(e,t){this.frameContext=e,this.injector=t,this.requiredOn=!1}var _t=(Kt.prototype.ngOnInit=function(){this.setComponentRef()},Kt.prototype.setComponentRef=function(){var e=this.viewModel&&this.viewModel.frameContext&&this.viewModel.frameContext.getFormAppContext(),t=this.viewModel&&this.viewModel.frameContext&&this.viewModel.frameContext.frameId,i=this.editor,n=i&&i.injector&&i.injector.get(K.ElementRef,null),r=n&&n.nativeElement&&n.nativeElement.id||null;if(t&&r){var o=e&&e.componentRefs&&e.componentRefs.get(t)||new Map;e&&e.componentRefs&&e.componentRefs.set(t,o.set(r,this.editor))}},Kt.decorators=[{type:K.Directive,args:[{selector:"[farris-editor],[farris-editor-bind]"}]}],Kt.ctorParameters=function(){return[{type:V.ViewModel},{type:a.EditorComponent}]},Kt);function Kt(e,t){this.viewModel=e,this.editor=t}var zt=(Gt.prototype.onQuery=function(e){this.frameContext&&(this.frameContext.repository.entityCollection.pageIndex=1)},Gt.decorators=[{type:K.Directive,args:[{selector:"[farris-querysolution-event-bind]"}]}],Gt.ctorParameters=function(){return[{type:K.Injector},{type:s.QuerySolutionComponent},{type:V.FrameContext}]},Gt.propDecorators={onQuery:[{type:K.HostListener,args:["queryEmitter"]}]},Gt);function Gt(e,t,i){this.injector=e,this.component=t,this.frameContext=i}var qt=(Ut.prototype.ngOnInit=function(){this.localize()},Ut.prototype.localize=function(){if(this.userSettings&&this.componentRef){var e=this.userSettings,t=e.dateFormat,i=void 0===t?null:t,n=e.timeFormat,r=void 0===n?null:n;if(null===i&&null===r)return;r&&r&&!0===this.componentRef.showTime?(this.componentRef.dateFormat=i+" "+r,this.componentRef.dateOpts.dateFormat=i+" "+r,this.componentRef.updateValue(this.componentRef.value)):i&&(this.componentRef.dateFormat=""+i,this.componentRef.dateOpts.dateFormat=""+i,this.componentRef.updateValue(this.componentRef.value))}},Ut.decorators=[{type:K.Directive,args:[{selector:"[farris-date-localization]"}]}],Ut.ctorParameters=function(){return[{type:K.Injector},{type:undefined,decorators:[{type:K.Inject,args:[V.UserSettingsToken]}]},{type:g.FarrisDatepickerComponent}]},Ut);function Ut(e,t,i){this.injector=e,this.userSettings=t,this.componentRef=i}var $t=(Wt.prototype.ngOnInit=function(){this.localize()},Wt.prototype.localize=function(){},Wt.decorators=[{type:K.Directive,args:[{selector:"[farris-number-localization]"}]}],Wt.ctorParameters=function(){return[{type:K.Injector},{type:undefined,decorators:[{type:K.Inject,args:[V.UserSettingsToken]}]},{type:m.NumberSpinnerComponent}]},Wt);function Wt(e,t,i){this.injector=e,this.userSettings=t,this.componentRef=i}var Jt=(Yt.prototype.ngOnInit=function(){this.localize()},Yt.prototype.localize=function(){if(this.userSettings&&this.componentRef){var e=this.userSettings.timeFormat,t=void 0===e?null:e;t&&(this.componentRef.format=t)}},Yt.decorators=[{type:K.Directive,args:[{selector:"[farris-time-localization]"}]}],Yt.ctorParameters=function(){return[{type:K.Injector},{type:undefined,decorators:[{type:K.Inject,args:[V.UserSettingsToken]}]},{type:y.TimePickerComponent}]},Yt);function Yt(e,t,i){this.injector=e,this.userSettings=t,this.componentRef=i}var Qt=(Xt.prototype.ngOnInit=function(){},Xt.prototype.transform=function(){var r=this;this.componentRef&&(this.componentRef.beforeWriteValue=function(e,t){var i=t.localizationType,n=void 0===i?null:i;return t.showTime,e?n&&e?(n=n.toLowerCase(),e=r.transformValue(e,n)):undefined:""})},Xt.prototype.transformValue=function(e,t){return"date"===t?this.transformDate(e):"datetime"===t?this.transformDateTime(e):e},Xt.prototype.transformDate=function(e){var t=this.userSettings&&this.userSettings.dateFormat||"YYYY-MM-DD";if(!t||!e)return e;var i=H(e);return i.isValid()?(t=this.parseDateFormat(t),i.format(t)):e},Xt.prototype.transformDateTime=function(e){var t=this.userSettings&&this.userSettings.dateFormat||"YYYY-MM-DD",i=this.userSettings&&this.userSettings.timeFormat||"HH:mm:ss";if(!t||!i)return e;var n=H(e);if(!n.isValid())return e;var r=(t=t&&this.parseDateFormat(t))+" "+(i=i&&this.parseTimeFormat(i));return n.format(r)},Xt.prototype.transformNumber=function(e){if(null===e||e===undefined||""===e)return"";var t=new B.BigNumber(e);if(!B.BigNumber.isBigNumber(t))return e;var i=t.isNegative(),n=this.buildNumberFormat(),r=this.numberFormat||{},o=r.negativeSign,a=void 0===o?null:o,s=r.numberDecimalDigits,p=void 0===s?null:s;return i&&null!==a?(n.prefix=a,t.absoluteValue().toFormat(p,null,n)):t.toFormat(p,null,n)},Xt.prototype.parseDateFormat=function(e){return e.replace(/y/g,"Y").replace(/d/g,"D")},Xt.prototype.parseTimeFormat=function(e){return e.replace(/M/g,"m")},Xt.prototype.buildNumberFormat=function(){if(this.numberFormat){var e=this.numberFormat,t=e.numberDecimalSeparator,i=void 0===t?null:t,n=e.numberGroupSeparator,r=void 0===n?null:n,o={groupSize:3};return null!==i&&(o.decimalSeparator=i),null!==r&&(o.groupSeparator=r),o}},Object.defineProperty(Xt.prototype,"numberFormat",{get:function(){return this.userSettings&&this.userSettings.numberFormat||null},enumerable:!0,configurable:!0}),Xt.decorators=[{type:K.Directive,args:[{selector:"[farris-text-localization]"}]}],Xt.ctorParameters=function(){return[{type:K.Injector},{type:undefined,decorators:[{type:K.Inject,args:[V.UserSettingsToken]}]},{type:p.TextComponent}]},Xt.propDecorators={localization:[{type:K.Input,args:["localization"]}]},Xt);function Xt(e,t,i){this.injector=e,this.userSettings=t,this.componentRef=i,this.transform()}var Zt=(ei.prototype.ngOnInit=function(){if("number"==typeof this.index&&this.elementRef){var e=this.elementRef.nativeElement;if(e){var t=e.getAttribute("id");if(t){var i=t+"_"+this.index;this.elementRef.nativeElement.setAttribute("id",i),this.elementRef.nativeElement.setAttribute("name",i),this.elementRef.nativeElement.setAttribute("original_id",t)}}}},ei.decorators=[{type:K.Directive,args:[{selector:"[farris-checkbox-modification]"}]}],ei.ctorParameters=function(){return[{type:K.Injector},{type:K.ElementRef}]},ei.propDecorators={index:[{type:K.Input}]},ei);function ei(e,t){this.injector=e,this.elementRef=t}var ti=(ii.prototype.ngOnInit=function(){if("number"==typeof this.index&&this.elementRef){var e=this.elementRef.nativeElement;if(e){var t=e.getAttribute("for");t&&this.elementRef.nativeElement.setAttribute("for",t+"_"+this.index)}}},ii.decorators=[{type:K.Directive,args:[{selector:"[farris-label-modification]"}]}],ii.ctorParameters=function(){return[{type:K.Injector},{type:K.ElementRef}]},ii.propDecorators={index:[{type:K.Input}]},ii);function ii(e,t){this.injector=e,this.elementRef=t}var ni=(Object.defineProperty(ri.prototype,"lookupValue",{set:function(e){"lookup"===this.lookupType&&this.lookup?this.lookup.writeValue(e):"comboLookup"===this.lookupType&&this.comboLookup&&this.comboLookup.writeValue(e)},enumerable:!0,configurable:!0}),ri.decorators=[{type:K.Directive,args:[{selector:"[farris-lookup-binding]"}]}],ri.ctorParameters=function(){return[{type:C.LookupGridComponent,decorators:[{type:K.Optional}]},{type:E.ComboLookupComponent,decorators:[{type:K.Optional}]}]},ri.propDecorators={lookupType:[{type:K.Input}],lookupValue:[{type:K.Input,args:["farris-lookup-binding"]}]},ri);function ri(e,t){this.lookup=e,this.comboLookup=t}var oi=(ai.prototype.addComponent=function(e){var t=this.elementRef&&this.elementRef.nativeElement&&this.elementRef.nativeElement.id;this.frameContext&&t&&e&&this.frameContext.componentRefManager.add(t,e)},ai.prototype.tryAddComponent=function(e,t){void 0===t&&(t=null);var i=t||this.elementRef&&this.elementRef.nativeElement&&this.elementRef.nativeElement.id;this.frameContext&&i&&e&&!this.frameContext.componentRefManager.has(i)&&this.frameContext.componentRefManager.add(i,e)},ai);function ai(e,t){this.frameContext=e,this.elementRef=t}var si,pi=(te(di,si=oi),di.prototype.ngAfterViewInit=function(){this.tryAddComponent(this.component)},di.prototype.ngOnInit=function(){this.addComponent(this.component)},di.prototype.ngOnDestroy=function(){},di.decorators=[{type:K.Directive,args:[{selector:"[listNavRef]"}]}],di.ctorParameters=function(){return[{type:K.Injector},{type:d.ListNavComponent},{type:K.ElementRef},{type:V.FrameContext}]},di);function di(e,t,i,n){var r=si.call(this,n,i)||this;return r.injector=e,r.component=t,r.elementRef=i,r.frameContext=n,r}var li,ui=(te(ci,li=oi),ci.prototype.ngAfterViewInit=function(){this.tryAddComponent(this.component)},ci.prototype.ngOnInit=function(){this.addComponent(this.component)},ci.prototype.ngOnDestroy=function(){},ci.decorators=[{type:K.Directive,args:[{selector:"[listViewRef]"}]}],ci.ctorParameters=function(){return[{type:K.Injector},{type:l.ListViewComponent},{type:K.ElementRef},{type:V.FrameContext}]},ci);function ci(e,t,i,n){var r=li.call(this,n,i)||this;return r.injector=e,r.component=t,r.elementRef=i,r.frameContext=n,r}var hi,fi=(te(gi,hi=oi),gi.prototype.ngAfterViewInit=function(){this.tryAddComponent(this.component)},gi.prototype.ngOnInit=function(){this.addComponent(this.component)},gi.prototype.ngOnDestroy=function(){},gi.decorators=[{type:K.Directive,args:[{selector:"[listFilterRef]"}]}],gi.ctorParameters=function(){return[{type:K.Injector},{type:R.ListFilterComponent},{type:K.ElementRef},{type:V.FrameContext}]},gi);function gi(e,t,i,n){var r=hi.call(this,n,i)||this;return r.injector=e,r.component=t,r.elementRef=i,r.frameContext=n,r}var yi,mi=(te(vi,yi=oi),vi.prototype.ngAfterViewInit=function(){this.tryAddComponent(this.component)},vi.prototype.ngOnInit=function(){this.addComponent(this.component)},vi.prototype.ngOnDestroy=function(){},vi.decorators=[{type:K.Directive,args:[{selector:"[filterRef]"}]}],vi.ctorParameters=function(){return[{type:K.Injector},{type:T.FilterComponent},{type:K.ElementRef},{type:V.FrameContext}]},vi);function vi(e,t,i,n){var r=yi.call(this,n,i)||this;return r.injector=e,r.component=t,r.elementRef=i,r.frameContext=n,r}var Ci,bi=(te(Di,Ci=oi),Di.prototype.ngAfterViewInit=function(){this.tryAddComponent(this.component)},Di.prototype.ngOnInit=function(){this.addComponent(this.component)},Di.prototype.ngOnDestroy=function(){},Di.decorators=[{type:K.Directive,args:[{selector:"[viewChangeRef]"}]}],Di.ctorParameters=function(){return[{type:K.Injector},{type:u.ViewChangeComponent},{type:K.ElementRef},{type:V.FrameContext}]},Di);function Di(e,t,i,n){var r=Ci.call(this,n,i)||this;return r.injector=e,r.component=t,r.elementRef=i,r.frameContext=n,r}var Ii,Si=(te(xi,Ii=oi),xi.prototype.ngAfterViewInit=function(){this.tryAddComponent(this.component)},xi.prototype.ngOnInit=function(){this.addComponent(this.component)},xi.prototype.ngOnDestroy=function(){},xi.decorators=[{type:K.Directive,args:[{selector:"[htmlEditorRef]"}]}],xi.ctorParameters=function(){return[{type:K.Injector},{type:c.HtmlEditorComponent},{type:K.ElementRef},{type:V.FrameContext}]},xi);function xi(e,t,i,n){var r=Ii.call(this,n,i)||this;return r.injector=e,r.component=t,r.elementRef=i,r.frameContext=n,r}var wi,Ei=(te(Pi,wi=oi),Pi.prototype.ngAfterViewInit=function(){this.tryAddComponent(this.component)},Pi.prototype.ngOnInit=function(){this.addComponent(this.component)},Pi.prototype.ngOnDestroy=function(){},Pi.decorators=[{type:K.Directive,args:[{selector:"[sectionRef]"}]}],Pi.ctorParameters=function(){return[{type:K.Injector},{type:h.FarrisSectionComponent},{type:K.ElementRef},{type:V.FrameContext}]},Pi);function Pi(e,t,i,n){var r=wi.call(this,n,i)||this;return r.injector=e,r.component=t,r.elementRef=i,r.frameContext=n,r}var Oi,Li=(te(Ti,Oi=oi),Ti.prototype.ngAfterViewInit=function(){this.tryAddComponent(this.component)},Ti.prototype.ngOnInit=function(){this.addComponent(this.component)},Ti.prototype.ngOnDestroy=function(){},Ti.decorators=[{type:K.Directive,args:[{selector:"[inputGroupRef]"}]}],Ti.ctorParameters=function(){return[{type:K.Injector},{type:f.InputGroupComponent},{type:K.ElementRef},{type:V.FrameContext}]},Ti);function Ti(e,t,i,n){var r=Oi.call(this,n,i)||this;return r.injector=e,r.component=t,r.elementRef=i,r.frameContext=n,r}var Ri,Fi=(te(Mi,Ri=oi),Mi.prototype.ngAfterViewInit=function(){this.tryAddComponent(this.component)},Mi.prototype.ngOnInit=function(){this.addComponent(this.component)},Mi.prototype.ngOnDestroy=function(){},Mi.decorators=[{type:K.Directive,args:[{selector:"[datepickerRef]"}]}],Mi.ctorParameters=function(){return[{type:K.Injector},{type:g.FarrisDatepickerComponent},{type:K.ElementRef},{type:V.FrameContext}]},Mi);function Mi(e,t,i,n){var r=Ri.call(this,n,i)||this;return r.injector=e,r.component=t,r.elementRef=i,r.frameContext=n,r}var ki,Ni=(te(ji,ki=oi),ji.prototype.ngAfterViewInit=function(){this.tryAddComponent(this.component)},ji.prototype.ngOnInit=function(){this.addComponent(this.component)},ji.prototype.ngOnDestroy=function(){},ji.decorators=[{type:K.Directive,args:[{selector:"[timePickerRef]"}]}],ji.ctorParameters=function(){return[{type:K.Injector},{type:y.TimePickerComponent},{type:K.ElementRef},{type:V.FrameContext}]},ji);function ji(e,t,i,n){var r=ki.call(this,n,i)||this;return r.injector=e,r.component=t,r.elementRef=i,r.frameContext=n,r}var Ai,Vi=(te(Bi,Ai=oi),Bi.prototype.ngAfterViewInit=function(){this.tryAddComponent(this.component)},Bi.prototype.ngOnInit=function(){this.addComponent(this.component)},Bi.prototype.ngOnDestroy=function(){},Bi.decorators=[{type:K.Directive,args:[{selector:"[numberSpinnerRef]"}]}],Bi.ctorParameters=function(){return[{type:K.Injector},{type:m.NumberSpinnerComponent},{type:K.ElementRef},{type:V.FrameContext}]},Bi);function Bi(e,t,i,n){var r=Ai.call(this,n,i)||this;return r.injector=e,r.component=t,r.elementRef=i,r.frameContext=n,r}var Hi,_i=(te(Ki,Hi=oi),Ki.prototype.ngAfterViewInit=function(){this.tryAddComponent(this.component)},Ki.prototype.ngOnInit=function(){this.addComponent(this.component)},Ki.prototype.ngOnDestroy=function(){},Ki.decorators=[{type:K.Directive,args:[{selector:"[comboListRef]"}]}],Ki.ctorParameters=function(){return[{type:K.Injector},{type:v.ComboListComponent},{type:K.ElementRef},{type:V.FrameContext}]},Ki);function Ki(e,t,i,n){var r=Hi.call(this,n,i)||this;return r.injector=e,r.component=t,r.elementRef=i,r.frameContext=n,r}var zi,Gi=(te(qi,zi=oi),qi.prototype.ngAfterViewInit=function(){this.tryAddComponent(this.component)},qi.prototype.ngOnInit=function(){this.addComponent(this.component)},qi.prototype.ngOnDestroy=function(){},qi.decorators=[{type:K.Directive,args:[{selector:"[comboLookupRef]"}]}],qi.ctorParameters=function(){return[{type:K.Injector},{type:E.ComboLookupComponent},{type:K.ElementRef},{type:V.FrameContext}]},qi);function qi(e,t,i,n){var r=zi.call(this,n,i)||this;return r.injector=e,r.component=t,r.elementRef=i,r.frameContext=n,r}var Ui,$i=(te(Wi,Ui=oi),Wi.prototype.ngAfterViewInit=function(){this.tryAddComponent(this.component)},Wi.prototype.ngOnInit=function(){this.addComponent(this.component)},Wi.prototype.ngOnDestroy=function(){},Wi.decorators=[{type:K.Directive,args:[{selector:"[lookupGridRef]"}]}],Wi.ctorParameters=function(){return[{type:K.Injector},{type:C.LookupGridComponent},{type:K.ElementRef},{type:V.FrameContext}]},Wi);function Wi(e,t,i,n){var r=Ui.call(this,n,i)||this;return r.injector=e,r.component=t,r.elementRef=i,r.frameContext=n,r}var Ji,Yi=(te(Qi,Ji=oi),Qi.prototype.ngAfterViewInit=function(){this.tryAddComponent(this.component,this.component.id)},Qi.prototype.ngOnInit=function(){this.addComponent(this.component)},Qi.prototype.ngOnDestroy=function(){},Qi.decorators=[{type:K.Directive,args:[{selector:"[datagridRef]"}]}],Qi.ctorParameters=function(){return[{type:K.Injector},{type:L.DatagridComponent},{type:K.ElementRef},{type:V.FrameContext}]},Qi);function Qi(e,t,i,n){var r=Ji.call(this,n,i)||this;return r.injector=e,r.component=t,r.elementRef=i,r.frameContext=n,r}var Xi,Zi=(te(en,Xi=oi),en.prototype.ngAfterViewInit=function(){this.tryAddComponent(this.component)},en.prototype.ngOnInit=function(){this.addComponent(this.component)},en.prototype.ngOnDestroy=function(){},en.decorators=[{type:K.Directive,args:[{selector:"[treetableRef]"}]}],en.ctorParameters=function(){return[{type:K.Injector},{type:b.TreeTableComponent},{type:K.ElementRef},{type:V.FrameContext}]},en);function en(e,t,i,n){var r=Xi.call(this,n,i)||this;return r.injector=e,r.component=t,r.elementRef=i,r.frameContext=n,r}var tn,nn=(te(rn,tn=oi),rn.prototype.ngAfterViewInit=function(){this.tryAddComponent(this.component)},rn.prototype.ngOnInit=function(){this.addComponent(this.component)},rn.prototype.ngOnDestroy=function(){},rn.decorators=[{type:K.Directive,args:[{selector:"[wizardRef]"}]}],rn.ctorParameters=function(){return[{type:K.Injector},{type:D.WizardComponent},{type:K.ElementRef},{type:V.FrameContext}]},rn);function rn(e,t,i,n){var r=tn.call(this,n,i)||this;return r.injector=e,r.component=t,r.elementRef=i,r.frameContext=n,r}var on,an=(te(sn,on=oi),sn.prototype.ngAfterViewInit=function(){this.tryAddComponent(this.component)},sn.prototype.ngOnInit=function(){this.addComponent(this.component)},sn.prototype.ngOnDestroy=function(){},sn.decorators=[{type:K.Directive,args:[{selector:"[discussionEditorRef]"}]}],sn.ctorParameters=function(){return[{type:K.Injector},{type:I.DiscussionEditorComponent},{type:K.ElementRef},{type:V.FrameContext}]},sn);function sn(e,t,i,n){var r=on.call(this,n,i)||this;return r.injector=e,r.component=t,r.elementRef=i,r.frameContext=n,r}var pn,dn=(te(ln,pn=oi),ln.prototype.ngAfterViewInit=function(){this.tryAddComponent(this.component)},ln.prototype.ngOnInit=function(){this.addComponent(this.component)},ln.prototype.ngOnDestroy=function(){},ln.decorators=[{type:K.Directive,args:[{selector:"[discussionListRef]"}]}],ln.ctorParameters=function(){return[{type:K.Injector},{type:I.DiscussionListComponent},{type:K.ElementRef},{type:V.FrameContext}]},ln);function ln(e,t,i,n){var r=pn.call(this,n,i)||this;return r.injector=e,r.component=t,r.elementRef=i,r.frameContext=n,r}var un,cn=(te(hn,un=oi),hn.prototype.ngAfterViewInit=function(){this.tryAddComponent(this.component)},hn.prototype.ngOnInit=function(){this.addComponent(this.component)},hn.prototype.ngOnDestroy=function(){},hn.decorators=[{type:K.Directive,args:[{selector:"[navRef]"}]}],hn.ctorParameters=function(){return[{type:K.Injector},{type:S.NavComponent},{type:K.ElementRef},{type:V.FrameContext}]},hn);function hn(e,t,i,n){var r=un.call(this,n,i)||this;return r.injector=e,r.component=t,r.elementRef=i,r.frameContext=n,r}var fn,gn=(te(yn,fn=oi),yn.prototype.ngAfterViewInit=function(){this.tryAddComponent(this.component)},yn.prototype.ngOnInit=function(){this.addComponent(this.component)},yn.prototype.ngOnDestroy=function(){},yn.decorators=[{type:K.Directive,args:[{selector:"[multiSelectRef]"}]}],yn.ctorParameters=function(){return[{type:K.Injector},{type:x.MultiSelectComponent},{type:K.ElementRef},{type:V.FrameContext}]},yn);function yn(e,t,i,n){var r=fn.call(this,n,i)||this;return r.injector=e,r.component=t,r.elementRef=i,r.frameContext=n,r}var mn,vn=(te(Cn,mn=oi),Cn.prototype.ngAfterViewInit=function(){this.tryAddComponent(this.component)},Cn.prototype.ngOnInit=function(){this.addComponent(this.component)},Cn.prototype.ngOnDestroy=function(){},Cn.decorators=[{type:K.Directive,args:[{selector:"[scrollspyRef]"}]}],Cn.ctorParameters=function(){return[{type:K.Injector},{type:w.ScrollspyComponent},{type:K.ElementRef},{type:V.FrameContext}]},Cn);function Cn(e,t,i,n){var r=mn.call(this,n,i)||this;return r.injector=e,r.component=t,r.elementRef=i,r.frameContext=n,r}var bn,Dn=(te(In,bn=Ae),In.prototype.ngOnInit=function(){var i=this;this.lookup.valueChange.subscribe(function(e){if(e.nosearch)i.onClearMapping();else{var t=e.selections&&0<e.selections.length?e.selections:null;i.onValueChange(t)}}),this.lookup.clear.subscribe(function(){var e=i.mapfields||i.lookup.mapFields;i.mappingData(null,e)})},In.prototype.onClearMapping=function(){var t=this,e=Object.assign({},this.mapfields||this.lookup.mapFields||{}),i=this.lookup.textField,n={},r=this.lookup.ngControl&&this.lookup.ngControl.name;if(r&&this.vm){var o=e[i],a=this.vm&&this.vm.form&&this.vm.form.ngFormControls&&this.vm.form.ngFormControls[r],s=a&&a.binding;if(o&&s){var p=o.split(",").filter(function(e){return e!==s}).join(",");p?e[i]=p:delete e[i]}}e&&0<Object.keys(e).length&&(Object.keys(e).forEach(function(e){t.setValue(n,e.split("."),"")}),this.mappingData(n,e,!0))},In.prototype.onValueChange=function(e){var t=this.mapfields||this.lookup.mapFields,i=this.lookup.separator||this.defaultSpliter;this.mappingData(e,t,!1,i)},In.decorators=[{type:K.Directive,args:[{selector:"[combo-lookup-data-mapping]"}]}],In.ctorParameters=function(){return[{type:V.ViewModel,decorators:[{type:K.Optional}]},{type:E.ComboLookupComponent,decorators:[{type:K.Optional},{type:K.Self}]}]},In.propDecorators={mapfields:[{type:K.Input,args:["combo-lookup-data-mapping"]}],target:[{type:K.Input,args:["target"]}]},In);function In(e,t){var i=bn.call(this)||this;return i.vm=e,i.lookup=t,i.target=null,i.lookup&&(i.lookup.useFormDataMapping=!0),i}var Sn,xn,wn;te(En,Sn=V.Repository);function En(){return null!==Sn&&Sn.apply(this,arguments)||this}(wn=xn=xn||{}).day="day",wn.week="week";var Pn=(Object.defineProperty(On.prototype,"bindingData",{get:function(){return this.frameContext.bindingData},enumerable:!0,configurable:!0}),Object.defineProperty(On.prototype,"viewModel",{get:function(){return this.frameContext.viewModel},enumerable:!0,configurable:!0}),On.prototype.restService=function(){return this.frameContext.repository.restService},Object.defineProperty(On.prototype,"bindingList",{get:function(){if("/"===this.viewModel.bindingPath||!this.viewModel.bindingPath)return this.bindingData.list;var e=this.viewModel.bindingPath.substr(1),t=(e=e[0].toLowerCase()+e.substring(1,e.length)).split("/").filter(function(e){return""!==e});return this.bindingData.getValue(t)},enumerable:!0,configurable:!0}),On.prototype.ngOnInit=function(){this.loadPlacements(),this.registerBindingDataChangeEvent()},On.prototype.ngOnChanges=function(e){},On.prototype.ngOnDestroy=function(){this.unRegisterBindingDataChangeEvent()},On.prototype.bindData=function(e){var t=this.bindingList.toJSON();this.__DATA__&&O.isEqual(this.__DATA__,t)||(this.__DATA__=t,this.calendarComponent.loadReserveData(t))},On.prototype.onBindingDataChange=function(e){this.bindData(e),this.updateSelectedRow(e)},On.prototype.registerBindingDataChangeEvent=function(){var t=this;this.bindingDataChangeEvent=this.bindingData.changes.subscribe(function(e){t.onBindingDataChange(e)})},On.prototype.unRegisterBindingDataChangeEvent=function(){this.bindingDataChangeEvent&&"function"==typeof this.bindingDataChangeEvent.unsubscribe&&this.bindingDataChangeEvent.unsubscribe()},On.prototype.loadPlacements=function(){var t=this;if(this.url){var e={body:{requestInfo:this.restService().buildRequestInfo()}},i=N.BasePathService.convertPath(this.url);this.restService().request(i,this.method,null,e).subscribe(function(e){t.bindPlacements(e)})}else console.log("无法加载房间信息，请配置房间列表api地址")},On.prototype.bindPlacements=function(e){this.calendarComponent.loadPlaceData(e)},On.prototype.updateState=function(e,t,i){this.viewModel.uiState.setPropertyValue(this.startDateVariable,e),this.viewModel.uiState.setPropertyValue(this.endDateVariable,t),this.viewModel.uiState.setPropertyValue(this.viewTypeVariable,i)},On.prototype.updateSelectedRow=function(e){this.bindingList&&this.bindingList.currentId&&(e&&e.type===V.ChangeType.PaginationInfoChange||this.viewModel&&!0===this.viewModel.frameContext.bindingData.rowSelectedEventSuspend||this.calendarComponent.selectedId!==this.bindingList.currentId&&this.selectCalendarRow(this.bindingList.currentId))},On.prototype.selectCalendarRow=function(e){this.calendarComponent.selectItem(e)},On.prototype.filterChanged=function(e){var t=e||{},i=t.dateValue,n=void 0===i?null:i,r=(t.place,t.viewType),o=void 0===r?null:r,a=null,s=null;if(n){if(o===xn.day)a=n+" 00:00:00",s=n+" 23:59:59";else if(o===xn.week&&-1!==n.indexOf("~")){var p=n.split("~");a=p[0]+" 00:00:00",s=p[1]+" 23:59:59"}this.updateState(a,s,o)}},On.prototype.setSelectionIdToBindingData=function(e){this.bindingList.currentId!==e&&this.bindingList.setCurrentId(e,!0)},On.prototype.selectChange=function(e){var t=e.item.id,i=void 0===t?null:t;this.setSelectionIdToBindingData(i)},On.decorators=[{type:K.Directive,args:[{selector:"[farris-appointment-calendar-binding]"}]}],On.ctorParameters=function(){return[{type:K.Injector},{type:V.FrameContext},{type:P.AppointmentCalendarComponent}]},On.propDecorators={url:[{type:K.Input}],method:[{type:K.Input}],startDateVariable:[{type:K.Input}],endDateVariable:[{type:K.Input}],viewTypeVariable:[{type:K.Input}],filterChanged:[{type:K.HostListener,args:["filterChange",["$event"]]}],selectChange:[{type:K.HostListener,args:["selectChange",["$event"]]}]},On);function On(e,t,i){this.injector=e,this.frameContext=t,this.calendarComponent=i,this.url=null,this.method="PUT",this.startDateVariable="startDate",this.endDateVariable="endDate",this.viewTypeVariable="viewType"}var Ln=(Tn.prototype.restService=function(){return this.frameContext.repository.restService},Tn.prototype.ngOnInit=function(){},Tn.prototype.ngOnChanges=function(e){e.sizeApiUri&&!e.sizeApiUri.isFirstChange()&&this.applyNewSize()},Tn.prototype.ngAfterViewInit=function(){this.applyNewSize()},Tn.prototype.applyNewSize=function(){var t=this;this.useCustomSize&&this.sizeApiUri&&this.getSizeConfig().subscribe(function(e){t.dg&&"function"==typeof t.dg.applyNewSize&&t.dg.applyNewSize(e)})},Tn.prototype.getSizeConfig=function(){return this.restService().request(this.sizeApiUri,"get")},Tn.decorators=[{type:K.Directive,args:[{selector:"[custom-size]"}]}],Tn.ctorParameters=function(){return[{type:L.DatagridComponent},{type:K.Injector},{type:K.ChangeDetectorRef},{type:K.ElementRef},{type:V.FrameContext}]},Tn.propDecorators={useCustomSize:[{type:K.Input,args:["custom-size"]}],sizeApiUri:[{type:K.Input}]},Tn);function Tn(e,t,i,n,r){this.dg=e,this.injector=t,this.cd=i,this.el=n,this.frameContext=r,this.useCustomSize=!1,this.sizeApiUri=""}var Rn=(Fn.prototype.ngOnDestroy=function(){this.$destroy&&(this.$destroy.next(),this.$destroy.complete())},Fn.prototype.ngOnInit=function(){var n=this;this.filterComponent&&this.filterComponent.conditionsChange.pipe(M.takeUntil(this.$destroy)).subscribe(function(e){var t=(e||{}).data,i=void 0===t?"[]":t;n.setConditions(i)})},Fn.prototype.setConditions=function(e){this.frameContext.uiState.setPropertyValue(this.variableCode,e)},Fn.decorators=[{type:K.Directive,args:[{selector:"[farris-filter-binding]"}]}],Fn.ctorParameters=function(){return[{type:K.Injector},{type:V.FrameContext},{type:T.FilterComponent,decorators:[{type:K.Optional}]}]},Fn.propDecorators={variableCode:[{type:K.Input,args:["variableCode"]}]},Fn);function Fn(e,t,i){this.injector=e,this.frameContext=t,this.filterComponent=i,this.variableCode="filterConditionList",this.$destroy=new F.Subject}var Mn=(kn.prototype.ngOnDestroy=function(){this.$destroy&&(this.$destroy.next(),this.$destroy.complete())},kn.prototype.ngOnInit=function(){var n=this;this.listFilterComponent&&this.listFilterComponent.conditionsChange.pipe(M.takeUntil(this.$destroy)).subscribe(function(e){var t=(e||{}).data,i=void 0===t?"[]":t;n.setConditions(i)})},kn.prototype.setConditions=function(e){this.frameContext.uiState.setPropertyValue(this.variableCode,e)},kn.decorators=[{type:K.Directive,args:[{selector:"[farris-list-filter-binding]"}]}],kn.ctorParameters=function(){return[{type:K.Injector},{type:V.FrameContext},{type:R.ListFilterComponent,decorators:[{type:K.Optional}]}]},kn.propDecorators={variableCode:[{type:K.Input,args:["variableCode"]}]},kn);function kn(e,t,i){this.injector=e,this.frameContext=t,this.listFilterComponent=i,this.variableCode="filterConditionList",this.$destroy=new F.Subject}var Nn=(jn.prototype.transform=function(e,t){return void 0===t&&(t="default-root"),e?this.downloadService?this.downloadService.getDownloadUrl(e,t):(console.warn("因安全问题，附件下载提供安全校验机制，附件下载功能需重新编译。"),N.BasePathService.convertPath("/api/runtime/dfs/v1.0/formdoc/download/"+e)):this.defaultPic},jn.decorators=[{type:K.Pipe,args:[{name:"imageIdToUrl"}]}],jn.ctorParameters=function(){return[{type:K.Injector,decorators:[{type:K.Optional}]}]},jn);function jn(e){this.injector=e,this.defaultPic=N.BasePathService.convertPath("/platform/common/web/assets/imgs/no-pic.png"),this.downloadService=this.injector&&this.injector.get(k.DownloadService,null)||null}var An=(Vn.prototype.transform=function(e,t){var i="";if(t&&e&&e.field){i=this.getValue(e.field,t);var n=e.formatter;return n?this.cfs.format(i,t,n):e.isMultilingualField?this.getMultiLanguageValue(i):i}return""},Vn.prototype.getMultiLanguageValue=function(e){if(e&&"object"==typeof e&&0<Object.keys(e).length){var t=e[this.localeService&&this.localeService.localeId||"zh-CHS"];return t===undefined?"":t}return""},Vn.prototype.getValue=function(e,t){return t?-1===e.indexOf(".")?t[e]:e.split(".").reduce(function(e,t){return e&&e[t]||null},t):""},Vn.prototype.isHelpColumn=function(e){return e&&e.editor&&e.editor.options&&"EditorTypes.LOOKUP"===e.editor.options.type||!1},Vn.prototype.getHelpColumnValue=function(e,t){var i=this.getHelpControlTextField(e),n=this.getHelpControlMapFields(e);if(i&&n&&0<Object.keys(n).length){var r=n[i];return this.getValue(r,t)}return""},Vn.prototype.getHelpControlTextField=function(e){return e&&e.editor&&e.editor.options&&e.editor.options.textField||""},Vn.prototype.getHelpControlMapFields=function(e){return e&&e.editor&&e.editor.options&&e.editor.options.mapFields||{}},Vn.decorators=[{type:K.Pipe,args:[{name:"formatPrimeNgTreeTableCellData",pure:!1}]}],Vn.ctorParameters=function(){return[{type:A.ColumnFormatService},{type:K.Injector,decorators:[{type:K.Optional}]}]},Vn);function Vn(e,t){this.cfs=e,this.injector=t,this.injector&&(this.localeService=this.injector.get(j.LocaleService))}var Bn=(Hn.prototype.transform=function(e,t){if(t)return"date"===(t=t.toLowerCase())?this.transformDate(e):"datetime"===t?this.transformDateTime(e):"number"===t?this.transformNumber(e):e},Hn.prototype.transformDate=function(e){var t=this.userSettings&&this.userSettings.dateFormat||null;if(!t||!e)return e;var i=H(e);return i.isValid()?(t=this.parseDateFormat(t),i.format(t)):e},Hn.prototype.transformDateTime=function(e){var t=this.userSettings&&this.userSettings.dateFormat||"",i=this.userSettings&&this.userSettings.timeFormat||"",n=H(e);if(!n.isValid())return e;var r=(t=t&&this.parseDateFormat(t))+" "+(i=i&&this.parseTimeFormat(i));return n.format(r)},Hn.prototype.transformNumber=function(e){if(null===e||e===undefined||""===e)return"";var t=new B.BigNumber(e);if(!B.BigNumber.isBigNumber(t))return e;var i=t.isNegative(),n=this.buildNumberFormat(),r=this.numberFormat,o=r.negativeSign,a=void 0===o?null:o,s=r.numberDecimalDigits,p=void 0===s?null:s;return i&&null!==a?(n.prefix=a,t.absoluteValue().toFormat(p,null,n)):t.toFormat(p,null,n)},Hn.prototype.parseDateFormat=function(e){return e.replace(/y/g,"Y").replace(/d/g,"D")},Hn.prototype.parseTimeFormat=function(e){return e.replace(/M/g,"m")},Hn.prototype.buildNumberFormat=function(){if(this.numberFormat){var e=this.numberFormat,t=e.numberDecimalSeparator,i=void 0===t?null:t,n=e.numberGroupSeparator,r=void 0===n?null:n,o={groupSize:3};return null!==i&&(o.decimalSeparator=i),null!==r&&(o.groupSeparator=r),o}},Object.defineProperty(Hn.prototype,"numberFormat",{get:function(){return this.userSettings&&this.userSettings.numberFormat||null},enumerable:!0,configurable:!0}),Hn.decorators=[{type:K.Pipe,args:[{name:"localization"}]}],Hn.ctorParameters=function(){return[{type:K.Injector,decorators:[{type:K.Optional}]},{type:undefined,decorators:[{type:K.Inject,args:[V.UserSettingsToken]}]}]},Hn);function Hn(e,t){this.injector=e,this.userSettings=t}var _n=(Kn.decorators=[{type:K.NgModule,args:[{imports:[z.CommonModule,q.FarrisCommonModule.forRoot()],declarations:[Pe,Ne,He,Ke,Ge,Ue,We,Xe,et,Ye,it,le,Ce,De,ge,Nn,An,rt,at,pt,lt,he,me,gt,vt,Dt,xt,Et,Tt,Ot,Mt,Nt,At,Bt,_t,zt,qt,$t,Jt,Qt,Bn,Zt,ti,ni,pi,ui,fi,bi,mi,Ei,Si,Li,Fi,Ni,Vi,_i,Gi,$i,Yi,Zi,nn,an,dn,cn,gn,vn,Dn,Pn,Ln,Rn,Mn],providers:[_.DialogService,G.GridComponent,ae,pe],exports:[Pe,Ne,He,Ke,Ge,Ue,We,Xe,et,Ye,it,le,Ce,ge,Nn,An,rt,at,pt,lt,he,me,gt,vt,Dt,xt,Et,Tt,Ot,Mt,Nt,At,Bt,_t,zt,qt,$t,Jt,Qt,Bn,Zt,ti,ni,pi,ui,fi,bi,mi,Ei,Si,Li,Fi,Ni,Vi,_i,Gi,$i,Yi,Zi,nn,an,dn,cn,gn,vn,Dn,Pn,Ln,Rn,Mn]}]}],Kn);function Kn(){}e.ɵc=oi,e.ɵa=Ae,e.ɵb=ct,e.ArrayConverter=U,e.DateConverter=W,e.MultiLangConverter=Y,e.FilterConditionsConverter=X,e.KendoGridBindingDirective=Pe,e.FarrisTreeTableBindingDirective=Ne,e.LookupDataMappingDirective=He,e.LookupEnableExtendLoadMethodDirective=Ke,e.UIStateBindingDirective=Ge,e.FarrisDisabledDirective=Ue,e.FarrisSortDirective=We,e.FarrisTextareaEditDirective=Ye,e.FarrisDynamicColumnFormatDirective=Xe,e.FarrisEditEnterDirective=et,e.FarrisTreeTableFormatDirective=it,e.GridColumnAggregateDirective=Ce,e.GridSummaryDirective=De,e.FarrisDatagridUseBindingDataDirective=rt,e.MultiSelectDataMappingDirective=at,e.FarrisListViewBindingDirective=pt,e.EditableDirective=lt,e.InputEndEditDirective=gt,e.FarrisDataGridEndEditDirective=vt,e.HtmlEditorEndEditDirective=Dt,e.KendoGridEndEditDirective=xt,e.FarrisDataGridRemoteSummaryDirective=Et,e.FarrisSetFocusDirective=Ot,e.FarrisFilePreviewBindingDirective=Tt,e.FarrisDiscussionEditorBindingDirective=Mt,e.FarrisDiscussionListBindingDirective=Nt,e.FarrisPrimengTreeTableBindingDirective=At,e.FarrisDynamicRequiredDirective=Bt,e.FarrisEditorDirective=_t,e.FarrisQuerySolutionEventBindDirective=zt,e.FarrisDateLocalizationDirective=qt,e.FarrisNumberLocalizationDirective=$t,e.FarrisTimeLocalizationDirective=Jt,e.FarrisTextLocalizationDirective=Qt,e.FarrisCheckboxModificationDirective=Zt,e.FarrisLabelModificationDirective=ti,e.FarrisLookupBindingDirective=ni,e.ListNavComponentRefDirective=pi,e.ListViewComponentRefDirective=ui,e.ListFilterComponentRefDirective=fi,e.FilterComponentRefDirective=mi,e.ViewChangeComponentRefDirective=bi,e.HtmlEditorComponentRefDirective=Si,e.SectionComponentRefDirective=Ei,e.InputGroupComponentRefDirective=Li,e.DatepickerComponentRefDirective=Fi,e.TimePickerComponentRefDirective=Ni,e.NumberSpinnerComponentRefDirective=Vi,e.ComboListComponentRefDirective=_i,e.ComboLookupComponentRefDirective=Gi,e.LookupGridComponentRefDirective=$i,e.DatagridComponentRefDirective=Yi,e.TreetableComponentRefDirective=Zi,e.WizardComponentRefDirective=nn,e.DiscussionEditorComponentRefDirective=an,e.DiscussionListComponentRefDirective=dn,e.NavComponentRefDirective=cn,e.MultiSelectComponentRefDirective=gn,e.ScrollspyComponentRefDirective=vn,e.ComboLookupDataMappingDirective=Dn,e.AppointmentCalendarBindingDirective=Pn,e.CustomDatagridSizeDirective=Ln,e.FarrisFilterBindingDirective=Rn,e.FarrisListFilterBindingDirective=Mn,e.ImageIdToUrlPipe=Nn,e.FormatPrimeNgTreeTableCellData=An,e.Localization=Bn,e.FarrisKendoGridFormatService=ae,e.FarrisTreetableFormatService=pe,e.StringToDatePipe=le,e.KendoGridFilterDirective=he,e.DateFormatPlaceholderPipe=ge,e.FormatTotalPipe=me,e.KendoBindingModule=_n,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=farris-kendo-binding.umd.min.js.map
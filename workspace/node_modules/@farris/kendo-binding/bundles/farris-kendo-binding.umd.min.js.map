{"version":3,"sources":["ng://@farris/kendo-binding/lib/converters/array_converter.ts","ng://@farris/kendo-binding/lib/converters/date_converter.ts","ng://@farris/kendo-binding/lib/converters/multi_lang_converter.ts","ng://@farris/kendo-binding/lib/converters/filter_conditions_converter.ts","node_modules/tslib/tslib.es6.js","ng://@farris/kendo-binding/lib/format/datatable-kendogrid-format.ts","ng://@farris/kendo-binding/lib/format/treetable-format.ts","ng://@farris/kendo-binding/lib/format/string-to-date.pipe.ts","ng://@farris/kendo-binding/lib/format/kendogrid-filter.ts","ng://@farris/kendo-binding/lib/format/dateformat-placeholder.pipe.ts","ng://@farris/kendo-binding/lib/format/kendogrid-group.pipe.ts","ng://@farris/kendo-binding/lib/directives/grid-summary.directive.ts","ng://@farris/kendo-binding/lib/util/multi_select_grid_utility.ts","ng://@farris/kendo-binding/lib/entity/selected_row_context.ts","ng://@farris/kendo-binding/lib/directives/kendo_grid_binding.directive.ts","ng://@farris/kendo-binding/lib/directives/tree_table_node_builder/path_tree_node_builder.ts","ng://@farris/kendo-binding/lib/directives/tree_table_node_builder/parent_tree_node_builder.ts","ng://@farris/kendo-binding/lib/directives/tree_table_node_builder/tree_node_builder_factory.ts","ng://@farris/kendo-binding/lib/directives/farris_tree_table_binding.directive.ts","ng://@farris/kendo-binding/lib/directives/data-mapping.ts","ng://@farris/kendo-binding/lib/directives/lookup-data-mapping.directive.ts","ng://@farris/kendo-binding/lib/directives/lookup-enable-extend-load-method.directive.ts","ng://@farris/kendo-binding/lib/directives/uistate-binding.directive.ts","ng://@farris/kendo-binding/lib/directives/farris-kendogrid-disabled.directive.ts","ng://@farris/kendo-binding/lib/directives/farris-sort.directive.ts","ng://@farris/kendo-binding/lib/directives/farris-datagrid/farris-datagrid-use-binding-data.directive.ts","ng://@farris/kendo-binding/lib/directives/multi-select-data-mapping.directive.ts","ng://@farris/kendo-binding/lib/directives/list-view/farris_listview_binding.directive.ts","ng://@farris/kendo-binding/lib/directives/farris-datagrid/editable.directive.ts","ng://@farris/kendo-binding/lib/directives/end-edit/abstract_end_edit.ts","ng://@farris/kendo-binding/lib/directives/end-edit/input_end_edit.directive.ts","ng://@farris/kendo-binding/lib/directives/end-edit/farris_data_grid_end_edit.directive.ts","ng://@farris/kendo-binding/lib/directives/end-edit/html_editor_end_edit.directive.ts","ng://@farris/kendo-binding/lib/directives/end-edit/kendo_grid_end_edit.directive.ts","ng://@farris/kendo-binding/lib/directives/farris-datagrid/remote-summary.directive.ts","ng://@farris/kendo-binding/lib/directives/farris-set-focus.directive.ts","ng://@farris/kendo-binding/lib/directives/file-preview/farris-file-preview-binding.directive.ts","ng://@farris/kendo-binding/lib/directives/discussion-group/farris_discussion_editor_binding.directive.ts","ng://@farris/kendo-binding/lib/directives/discussion-group/farris_discussion_list_binding.directive.ts","ng://@farris/kendo-binding/lib/directives/primeng-tree-grid/FarrisPrimengTreeTableBindingDirective.ts","ng://@farris/kendo-binding/lib/directives/dynamic_validate/farris_dynamic_validate.directive.ts","ng://@farris/kendo-binding/lib/directives/farris_editor.directive.ts","ng://@farris/kendo-binding/lib/directives/farris_querysolution_event_bind.directive.ts","ng://@farris/kendo-binding/lib/directives/localization/farris_date_localization.directive.ts","ng://@farris/kendo-binding/lib/directives/localization/farris_number_localization.directive.ts","ng://@farris/kendo-binding/lib/directives/localization/farris_time_localization.directive.ts","ng://@farris/kendo-binding/lib/directives/localization/farris_text_localization.directive.ts","ng://@farris/kendo-binding/lib/directives/farris_checkbox_modification.directive.ts","ng://@farris/kendo-binding/lib/directives/farris_label_modification.directive.ts","ng://@farris/kendo-binding/lib/directives/farris_lookup_binding.directive.ts","ng://@farris/kendo-binding/lib/directives/component-ref/component-ref.ts","ng://@farris/kendo-binding/lib/directives/component-ref/list-nav-component-ref.directive.ts","ng://@farris/kendo-binding/lib/directives/component-ref/list-view-component-ref.directive.ts","ng://@farris/kendo-binding/lib/directives/component-ref/list-filter-component-ref.directive.ts","ng://@farris/kendo-binding/lib/directives/component-ref/filter-component-ref.directive.ts","ng://@farris/kendo-binding/lib/directives/component-ref/view-change-component-ref.directive.ts","ng://@farris/kendo-binding/lib/directives/component-ref/html-editor-component-ref.directive.ts","ng://@farris/kendo-binding/lib/directives/component-ref/section-component-ref.directive.ts","ng://@farris/kendo-binding/lib/directives/component-ref/input-group-component-ref.directive.ts","ng://@farris/kendo-binding/lib/directives/component-ref/datepicker-component-ref.directive.ts","ng://@farris/kendo-binding/lib/directives/component-ref/time-picker-component-ref.directive.ts","ng://@farris/kendo-binding/lib/directives/component-ref/number-spinner-component-ref.directive.ts","ng://@farris/kendo-binding/lib/directives/component-ref/combo-list-component-ref.directive.ts","ng://@farris/kendo-binding/lib/directives/component-ref/combo-lookup-component-ref.directive.ts","ng://@farris/kendo-binding/lib/directives/component-ref/lookup-grid-component-ref.directive.ts","ng://@farris/kendo-binding/lib/directives/component-ref/datagrid-component-ref.directive.ts","ng://@farris/kendo-binding/lib/directives/component-ref/treetable-component-ref.directive.ts","ng://@farris/kendo-binding/lib/directives/component-ref/wizard-component-ref.directive.ts","ng://@farris/kendo-binding/lib/directives/component-ref/discussion-editor-component-ref.directive.ts","ng://@farris/kendo-binding/lib/directives/component-ref/discussion-list-component-ref.directive.ts","ng://@farris/kendo-binding/lib/directives/component-ref/nav-component-ref.directive.ts","ng://@farris/kendo-binding/lib/directives/component-ref/multi-select-component-ref.directive.ts","ng://@farris/kendo-binding/lib/directives/component-ref/scrollspy-component-ref.directive.ts","ng://@farris/kendo-binding/lib/directives/combo-lookup-data-mapping.directive.ts","ng://@farris/kendo-binding/lib/directives/appointment-calendar/types.ts","ng://@farris/kendo-binding/lib/directives/appointment-calendar/appointment-calendar-binding.directive.ts","ng://@farris/kendo-binding/lib/directives/farris-datagrid/custom-size.directive.ts","ng://@farris/kendo-binding/lib/directives/farris-filter/farris_filter_binding.directive.ts","ng://@farris/kendo-binding/lib/directives/farris-list-filter/farris_list_filter_binding.directive.ts","ng://@farris/kendo-binding/lib/pipes/image-id-to-url.pipe.ts","ng://@farris/kendo-binding/lib/pipes/formatPrimeNgTreeTableCellData.ts","ng://@farris/kendo-binding/lib/pipes/localization.pipe.ts","ng://@farris/kendo-binding/lib/kendo_binding_module.ts"],"names":["ArrayConverter","prototype","convertFrom","value","split","this","separator","convertTo","join","DateConverter","DateUtil","isEmptyDateString","parse","Object","toString","call","year","getFullYear","length","repeat","month","getMonth","day","getDate","hours","getHours","minutes","getMinutes","seconds","getSeconds","format","MultiLangConverter","assign","multiLangControlValue","FilterConditionsConverter","conditionsString","JSON","conditions","stringify","extendStatics","d","b","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__extends","__","constructor","create","__assign","t","s","i","n","arguments","apply","__values","o","m","Symbol","iterator","next","done","__read","r","e","ar","push","error","__spread","concat","FarrisKendoGridFormatService","getColumnFormat","dataItem","column","getValue","type","getEnumText","getFormatDate","getFormatNumber","getMultiText","field","indexOf","reduce","result","tempColumnText","enumData","forEach","ele","name","dateFormat","dateService","formatTo","precision","parseInt","substr","editor","isNaN","opts","prefix","suffix","thousand","stripZeros","numberService","formatMoney","strValue","Error","replace","Injectable","DateTimeHelperService","NumberHelperService","FarrisTreetableFormatService","setFormat","treeTable","columns","dataType","formatter","options","data","valueField","textField","StringToDatePipe","transform","exponent","includes","strDate","Date","Pipe","args","tslib_1.__extends","BaseFilterCellComponent","defineProperty","KendoGridFilterDirective","filter","filterByField","dataField","ngOnInit","dropdownList","valuePrimitive","defaultItem","selectedValue","onChange","applyFilter","removeFilter","updateFilter","operator","Directive","selector","DropDownListComponent","FilterService","Input","HostListener","filterService","_this","_super","DateFormatPlaceholderPipe","controlName","viewModel","form","get","dateStr","toISOString","ViewModel","FormatTotalPipe","dataFormat","toFixed","Number","substring","GridColumnAggregateDirective","aggregate","recalculateSummary","bindingList","summary","aggrType","plainData","toJSON","map","item","prevPath","currPath","prev","curr","updateFooter","content","ColumnComponent","NgZone","ngZone","BindingData","GridSummaryDirective","bindingData","MultiSelectGridUtility","renderClickChangedRow","gridComponent","selectedRowContext","currentRowIndex","addRowSelectedStyle","lastRowIndex","checIfIsSameRelativeIndex","removeRowSelectedStyle","isSameRelativeIndex","Math","abs","checkIfEnablePaging","isPageable","pageable","renderSelectedChangeCheckbox","elementRef","$event","index","trCollection","getTrCollection","currentTableRowElement","selected","appendAtrributeValue","CHECKBOXED_ROW_STYLE_NAME","removeAttributeSpecificValue","rowIndex","currentRowElement","getRelativeRowInCurrentPage","CURRENT_ROW_STYLE_NAME","rowElementInCurrentPage","gridElement","wrapper","nativeElement","kendoGridTbodyElements","getElementsByTagName","currentElement","attributeName","attributeValue","newAttributeValue","getAttribute","setAttribute","needRemoveAttributeValue","lastClassAttributeValue","lastIndexOf","SelectedRowContext","KendoGridBindingDirective","DataBindingDirective","grid","selectable","isMultipleSelectionMode","selectableSettings","mode","bindingPath","list","filteredPaths","toLowerCase","part","getPagingInfo","pagingInfo","path","initDataState","refreshView","frameContext","frameComponent","componentType","ComponentType","kendoGridComponent","bindingChangeSubscription","changes","subscribe","change","ChangeType","Load","checkIfChangeMatchBindingPath","selectionDir","selectedKeys","uiState","setPropertyValue","runOutsideAngular","setTimeout","rowSelectedContext","skip","handleSelectedRowChange","Remove","syncDeletedKeys","isMatch","handleSelectedKeyChange","currentId","checkCurrentRowIdExists","SelectionChanged","dataId","renderCurrentRow","Append","editable","farrisBindingGridOption","gridColumns","lockable","some","frozen","rowClass","emit","element","linkedLabelEnabled","linkEvent","kendogridFormatSer","getClassName","dictPicking","param","of","dictPicked","cellClickHandler","cellClickParam","bindingGridOption","IsMultipleSelectionMode","self_1","ngAfterViewInit","changePathArray","bingdingPathArray","currentRowId","emitSelectedRowChange","splice","selectedKeysChange","selectedRowChange","isExist","deletedValueCollection","id","renderSelectionRow","ngOnChanges","ngOnDestroy","unsubscribe","refreshData","refreshSummary","bindData","_a","_b","pageIndex","_c","pageSize","updatePager","endCellEdit","ignoreMultiLangInput","isEditing","cancelCell","aggrColumns","aggrCol","onPageChange","event","take","setPagingInfo","resetPageInfo","aggregatesDes","groupAggrFields","tslib_1.__values","groupAggrField","group","groupField","aggregates","onStateChange","state","currentSkip","applyState","rebind","process","total","totalCount","isEditMode","processed","max","selectedKeysChangeHandler","setSelectionIdToBindingData","selectionChangeHandler","handleSelectedCheckboxChange","selectedCheckboxChange","cellClickEvent","columnIndex","sender","gridOption","groupable","getSelectedIdFromGrid","isEditable","editTemplate","isEdited","originColums","getColumns","fields","currentColumnIndex","findIndex","col","hiddenColLen","slice","visible","setEditable","getPrimary","row","isArray","rowNumber","primaryKey","cellCloseHandler","dialogSer","hasDialogOpened","preventDefault","rts","getFormState","originalEvent","eventPath","find","tagName","formGroup","currentCol","formControlValue","binding","getDynamicData","setValue","enterCell","shiftKey","keyCode","target","blur","enterNextCell","buttonCount","info","pageSizes","previousNext","columnNumber","dataRowNumber","getGroupItem","tempIndex","showLineNumber","params","notReadOnly","editCell","updateIndex","newColumnIndex","len","readonly","currentColumnType","fieldPaths","getFieldPaths","items","len_1","appendRow","observers","interVal","setInterval","clearInterval","key","setCurrentId","undefined","stateMachine","isDataChanged","hasUnsavedData","entityArray","repository","entityCollection","toArray","entityArray_1","entityArray_1_1","UIState","decorators","Optional","FrameEventBus","GridComponent","SelectionDirective","DialogService","RuntimeStateService","Output","ContentChildren","eventBus","EventEmitter","sortChangeEvent","appContext","getFormAppContext","messagePipe","message","closeCell","PathTreeNodeBuilder","context","updateTreeNode","allNodesData","initLevelGroup","buildNodesDataMap","build","tree","childrenOf","nodes","parentId","getParentId","isNewNode","expandParentNode","node","buildNode","children","allNodesMap","set","unstableState","expanded","build1","minLayer","hierarchyInfo","getHierarchyInfo","layer","topLayer","buildNodes","allNodes","fPath","fLayer","treeNodes","getChildNodesData","nodeData","currentLayer","currentPath","isLeaf","shouldExpand","isExpanded","expandNode","paginationInfo","buildPaginationInfo","treeNode","leaf","pagination","pageCount","getNodeLayer","id_1","nodesWaitExpand","nodesShouldExpand","nodeId","expandLevel","oldTreeNode","getOldNode","getNodePath","childs","id_2","onTreeLoadComplete","component","findRowNode","childNodesData","startsWith","hierarchyInfoKey","levelGroup","parent","getLevelGroupKey","currentHierarchyInfo","isDetail","level","paths","newData","allOldNodesMap","size","parentTreeNode","getParentNode","from","values","currentNode","oldTreeNodes","addTreeLoadCompleteListener","bind","Map","ParentTreeNodeBuilder","parents","parentElement","keys","fParentElement","currentParentElement","getNodeParentElement","TreeNodeBuilderFactory","getBuilder","builder","FarrisTreeTableBindingDirective","_PROP","getVirtualRootFrameContext","setParam","ValueChanged","PaginationInfoChange","renderSubject","rowSelectedEventSuspend","setSelectedIdToTree","updateCheckedRows","treetableFormatSer","cellClass","setComponentRef","setNodePaginationInfo","registerEvent","farrisTreeTalbeComponent","columnSorted","sortName","sortOrder","remoteSort","sortBy","frameId","el","componentRefs","enableNodePagination","paginationForChildren","nodePageSize","treeNodesData","prop","treeExpandLevel","storage","treeNodesBuilder","updatePageInfo","listeners","listener","shouldComponentUpdate","newProp","getSelectedIdFromTree","selectedRow","selectedId","oldSelectedId","nodePageChanged","clearSelections","selectNode","delete","setCurrentIdToBindingList","oldCurrentId","multiSelect","setChecks","setCheckedRows","ids","getChecks","rows","otherPageItem","idOrIds","idField","checkValuesChange","checkValues","expandHandler","virtualRootFrameContext","expandNodes","getParam","onPageChanged","onPageSizeChanged","onNodePageChanged","TreeTableComponent","FrameContext","Subject","pipe","debounceTime","DataMapping","mappingData","helpData","mapFields","asClear","spliter","vm","changeDetectionController","detach","helpFields","basePaths","getBindingPathArray","primaryInfo","getMapFieldsPrimaryKey","primaryKeys","primaryFields","primaryField","sortMapFieldKeys","reverse","mapping","reattach","sortedKeyFields","targetPrimaryFields","val","getHelpValue","mappings","headMappings","leftMappings","updateTarget","targetFieldPath","updateTargetValue","clearValue","f","a","isNumberValue","currentVal","isNumber","bindingPaths","results","entityTypeInfo_1","entityTypeInfo","mapField","propInfo","getPropInfoByPath","metadataInfo","primary","console","Set","defaultSpliter","LookupDataMappingDirective","lookup","selectedData","_mapfields","mapfields","multipleChoiceSeparator","clearMappings","lookupTextField","ngControl","textFieldMapping","ngFormControl","ngFormControls","binding_1","clear","LookupGridComponent","Self","LookupEnableExtendLoadMethodDirective","enableExtendLoadMethod","befApiUrl","apiUri","enableKey","uri","UIStateBindingDirective","_bindingObject","differ","differs","onValueChange","hostComboComponent","bindingObject","hostHelpComponent","bindObjectToHostLookup","hostComboListComponent","bindObjectToHostComboList","hostComboLookupComponent","bindObjectToHostComboLookup","ngDoCheck","diff","bindingChanges","text","vField_1","writeValue","displayValue","selectedValues","updateHelpBindingObject","tagRemoved","removedIndex","instance","componentRef","singleSelect","UIStateBindingChange","displayText","nosearch","valueChanged","txt","valueChange","selections","selectChange","emitUiStateBinding","newObject","c","ComboBoxComponent","Host","KeyValueDiffers","ComboListComponent","ComboLookupComponent","FarrisDisabledDirective","maskElement","createMaskElement","kendoGridDisabled","renderer","removeStyle","setStyle","createElement","appendChild","ElementRef","Renderer2","FarrisSortDirective","FarrisTextareaEditDirective","FarrisDynamicColumnFormatDirective","FarrisEditEnterDirective","FarrisTreeTableFormatDirective","FarrisDatagridUseBindingDataDirective","_PROPS","pageList","window","updateSelectedRow","registerBindingDataChangeEvent","renderGridSubject","isDisposed","farrisDataGridComponent","nodeCode","props","buildProps","runMode","RunMode","highSpeed","gridProps","buildGridProps","sortFields","sortDirection","entityType","dataTypeInfo_1","DataTypeInfo","directions","sortConditionManager","setConditions","sortDirections","sortBindingList","filterChanged","filters","remoteFilter","getIdByIndex","arrSortFields_1","arrSortDirection","isRemoteFilter","shouldSort","hasSorted","enableGridHeaderWhenEditing","enableFilterSorting","clearCondition","shouldFiltering","GlobalSelectionChanged","firstRowId","renderGrid","virtualizedLoad","virtualizedAsyncLoad","controlPaginationState","loadVirtualData","loadData","datas","_d","onBindingDataChange","updateDataSource","updateData","entityPath","ExpressionUtil","getAvailableChildrenPathsFromEntityPaths","propertyNames","updateRow","warn","gridSelectedRowId","selectGridRow","selectRow","bindingDataChangeEvent","unRegisterBindingDataChangeEvent","eventBindingPath","isRetrieve","fullPaths","EntityPathConverter","toEntityPathArray","configPath","getPaginationConfigByPath","parentNodeCode","parentConfigPath","parentPageSize","queryChild","finalize","fireSelectedRowChange","clearCheckedRows","clearCheckeds","scrollToCurrentRow","pageChangedHandler","selectedRowChanged","unSelected","checkedChanged","pageSizeChanged","scrollY","pager","debounce","callback","wait","timeoutId","_i","clearTimeout","DatagridComponent","injector","ENABLE_EDIT_STATE_FILTER_SORTING","MultiSelectDataMappingDirective","_this_1","multiSelectComponent","dataSource","originalDataSource","isTree","fjmField","plainToTree","fjdField","buildTreeNodesByFjd","getTreeSelectionsById","getListSelectionsById","selectIdBindingToUIStateField","selectedIdChange","selectedIdChanged","formatDataSource","plainSource","treeSource","recursive","parentPath","parentLayer","itemPath","itemLayer","targetPath","reusltObj","bindingObjects","treeData","MultiSelectComponent","FarrisListViewBindingDirective","setListViewPageProps","listview","supportPaging","supportPaged","currentPage","itemsPerPage","totalItems","paginationOptions","listViewChangeDetectRef","detectChanges","paginationDirective","instances","setTotalItems","changeDetectorRef","_e","setData","clickItem","changeRow","checkChangeEvent","activeIndex","pageInfo","pageSizeChangedHandler","ListViewComponent","EditableDirective","handleGroupStatus","gridEditable","disableHeader","handleBeginEditEvent","handleAfterEditEvent","handleEndEditEvent","sort","disableGroupOnEditing","groupFields","setGroupFields","groupField_1","pop","beginEditSubscription","beginEdit","editorInstance_1","mapFields_1","lookupGrid_1","subject","lookupMapping","otherField","parentPaths","comboLookup","pathArr","afterEdit","rowData","formControl","endEditSubscription","endEdit","primaryValue","updateBindingData","isBigNumber","bigNumber","updateBindingList","propertyName","currentItem","primaryKeyValue","findById","targetBindingObject_1","fpaths","targetPropertyName","h","ff","Injector","AbstractEndEdit","InputEndEditDirective","parent_1","parentNode","inputs","input","AppContext","FarrisDataGridEndEditDirective","datagrid","HtmlEditorEndEditDirective","HtmlEditorComponent","KendoGridEndEditDirective","FarrisDataGridRemoteSummaryDirective","execute","commandName","frameContextManager","getFrameContextById","remoteSummaryCommand","footerDataFrom","func_1","footerData","FarrisSetFocusDirective","_state","selfEl","nodeName","setHtmlEditorFocus","setFocus","querySelectorAll","focus","ediotrArea","querySelector","range","getSelection","selectAllChildren","collapseToEnd","rd","BehaviorSubject","FarrisFilePreviewBindingDirective","getList","uploadAndPreviewComponent","enableOrder","orderField","fileSortOrderKey","SORT_FIELD_ON_SORTING","DEFAULT_SORT_FIELD","farrisOrderType","enableSorting","fSelectedEvent","originalData","updateCurrentRow","updateChecks","__DATA__","fileInfos","getFileInfos","extendInfos","changeCurrentRow","ids_1","clearComponentChecks","changePath","isParentSelectChange","isSelfRowDelete","previewCurrent","getValueByPath","fileIdKey","selectComponentRow","listData","itemData","fileInfo","convertToFileInfo","orderType","fileId","fileNameKey","fileSizeKey","createTime","fileCreateTimeKey","extend","metadataId","extendFileInfo","fileSortOrder","currentValue","getUdtPaths","previewComponent","previewUpdateRefresh","orders","arrFields","arrDirections","item1","item2","order","item1Value","item2Value","String","localeCompare","propName","BindingList","props_1","props_1_1","selectChanged","FFilePreviewComponent","UploadAndPreviewComponent","KEY_UISTATE_REPLY_MESSAGE","FarrisDiscussionEditorBindingDirective","discussionEditorComponent","replyUser","root","queryFrequentAtUsersCommand","queryFrequentAtUsers","queryAtUsers","queryAllOrgs","queryAllOrgsCommand","sectionData","userQueryCommand","users","personnels","msgInfo","visibility","addCommentCommand","tap","catchError","EMPTY","func","DiscussionEditorComponent","FarrisDiscussionListBindingDirective","queryComments","discussionListComponent","commentsQueryCommand","comments","discussionListDirective","discussionListData","replyMessagedHandler","DiscussionListComponent","DiscussionListDirective","FarrisPrimengTreeTableBindingDirective","getHierarchyInfoField","infos","hierarchyInfoField","primengTreeComponent","getEntityArr","bindingPathArr","str","pathArray","getEntitiesByPath","setActualIndex","entityArr","counter","rootNode","traverseTree","entity","handleChange","handleSelectionChanged","handleValueChanged","frmPath","same","bindingPathArr_1","bindingPathArr_1_1","shift","targetNode","nodes_1","nodes_1_1","findTreeNodeById","keyValue","lazy","totalRecords","_value","sortMode","sortField","sortSingle","multiSortMeta","sortMultiple","hasFilter","_filter","tableService","onUIUpdate","updateSerializedValue","treeTableSelectedEvent","selectedRowId","serializedValue","isSelected","handleRowClick","rowNode","onEditInitHandler","nodeSelectChange","onEditCompleteHandler","fieldName","oldValue","column_1","onNodeExpandHandler","onNodeCollapseHandler","onNodeSelectHandler","onNodeUnselectHandler","setNodeExpandedValue","oldTreeNodeMap","getPaths","getValudChangeInvokerFactory","TreeTable","FarrisDynamicRequiredDirective","updateValidateRule","requiredOn","isRequired","updateFieldValidateRule","FarrisEditorDirective","EditorComponent","FarrisQuerySolutionEventBindDirective","onQuery","QuerySolutionComponent","FarrisDateLocalizationDirective","localize","userSettings","timeFormat","showTime","dateOpts","updateValue","Inject","UserSettingsToken","FarrisDatepickerComponent","FarrisNumberLocalizationDirective","NumberSpinnerComponent","FarrisTimeLocalizationDirective","TimePickerComponent","FarrisTextLocalizationDirective","beforeWriteValue","localizationType","transformValue","transformDate","transformDateTime","date","moment","isValid","parseDateFormat","dateTime","dateTimeFormat","parseTimeFormat","transformNumber","BigNumber","isNegative","buildNumberFormat","numberFormat","negativeSign","numberDecimalDigits","absoluteValue","toFormat","numberDecimalSeparator","numberGroupSeparator","groupSize","decimalSeparator","groupSeparator","TextComponent","FarrisCheckboxModificationDirective","token","FarrisLabelModificationDirective","labelFor","FarrisLookupBindingDirective","lookupType","ComponentRef","addComponent","componentRefManager","add","tryAddComponent","componentId","has","ListNavComponentRefDirective","ListNavComponent","ListViewComponentRefDirective","ListFilterComponentRefDirective","ListFilterComponent","FilterComponentRefDirective","FilterComponent","ViewChangeComponentRefDirective","ViewChangeComponent","HtmlEditorComponentRefDirective","SectionComponentRefDirective","FarrisSectionComponent","InputGroupComponentRefDirective","InputGroupComponent","DatepickerComponentRefDirective","TimePickerComponentRefDirective","NumberSpinnerComponentRefDirective","ComboListComponentRefDirective","ComboLookupComponentRefDirective","LookupGridComponentRefDirective","DatagridComponentRefDirective","TreetableComponentRefDirective","WizardComponentRefDirective","WizardComponent","DiscussionEditorComponentRefDirective","DiscussionListComponentRefDirective","NavComponentRefDirective","NavComponent","MultiSelectComponentRefDirective","ScrollspyComponentRefDirective","ScrollspyComponent","ComboLookupDataMappingDirective","onClearMapping","targetField","useFormDataMapping","ViewType","Repository","BefRepository","AppointmentCalendarBindingDirective","restService","loadPlacements","isEqual","calendarComponent","loadReserveData","url","body","requestInfo","buildRequestInfo","BasePathService","convertPath","request","method","returnValue","bindPlacements","log","placments","loadPlaceData","updateState","startDate","endDate","viewType","startDateVariable","endDateVariable","viewTypeVariable","selectCalendarRow","selectItem","dateValue","place","week","sections","AppointmentCalendarComponent","CustomDatagridSizeDirective","sizeApiUri","isFirstChange","applyNewSize","useCustomSize","getSizeConfig","cfg","dg","ChangeDetectorRef","cd","FarrisFilterBindingDirective","$destroy","complete","filterComponent","conditionsChange","takeUntil","variableCode","FarrisListFilterBindingDirective","listFilterComponent","ImageIdToUrlPipe","rootId","downloadService","getDownloadUrl","defaultPic","DownloadService","FormatPrimeNgTreeTableCellData","formatterFn","cfs","isMultilingualField","getMultiLanguageValue","valObj","localeService","localeId","obj","isHelpColumn","getHelpColumnValue","getHelpControlTextField","getHelpControlMapFields","pure","ColumnFormatService","LocaleService","Localization","NgModule","imports","CommonModule","FarrisCommonModule","forRoot","declarations","providers","exports","KendoBindingModule"],"mappings":"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BloC,KAAKkoC,aAAa6B,cAAgB,2DAlHjEniC,EAAAA,KAAIC,KAAA,CAAC,CAAEvC,KAAM,6DALG41B,EAAAA,SAAQpf,WAAA,CAAA,CAAArX,KAOVsX,EAAAA,8CAAwCwsB,EAAAA,OAAM1gC,KAAA,CAAC2gC,EAAAA,wBAkH9D+J,IAlHE,SAAAA,GAAgCtd,EAAuDiT,GAAvDloC,KAAAi1B,SAAAA,EAAuDj1B,KAAAkoC,aAAAA,+BCsExFsK,EAAAA,SAAQ3qC,KAAA,CAAC,CACR4qC,QAAS,CACPC,EAAAA,aACAC,EAAAA,mBAAmBC,WAErBC,aAAc,CACZpkC,GACAkU,GACAuH,GACAgB,GACAM,GACA2C,GACAW,GACAE,GACAC,GACAF,GACAG,GACA5nB,GACA+C,GACAoB,GACAjC,GACAynC,GACAM,GACApiB,GACAgG,GACA4B,GACAwB,GACAtwB,GACA+B,GACAoxB,GACAM,GACAE,GACAE,GACAC,GACAyB,GACAhB,GACAgF,GACAqB,GACAU,GACA+D,GACAK,GACAE,GACAG,GACAU,GACAE,GACAE,GACAyJ,GACA7H,GACAE,GACAE,GACAS,GACAE,GACAC,GACAI,GACAF,GACAK,GACAD,GACAG,GACAE,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAE,GACAC,GACAC,GACAE,GACAC,GACAE,GACAO,GACAiC,GACAU,GACAO,IAEF+B,UAAW,CACT32B,EAAAA,cAAeF,EAAAA,cAAe7X,GAA8BwC,IAC9DmsC,QAAS,CACPtkC,GACAkU,GACAuH,GACAgB,GACAM,GACA2C,GACAW,GACAE,GACAC,GACAF,GACAG,GACA5nB,GACA+C,GACAb,GACAynC,GACAM,GACApiB,GACAgG,GACA4B,GACAwB,GACAtwB,GACA+B,GACAoxB,GACAM,GACAE,GACAE,GACAC,GACAyB,GACAhB,GACAgF,GACAqB,GACAU,GACA+D,GACAK,GACAE,GACAG,GACAU,GACAE,GACAE,GACAyJ,GACA7H,GACAE,GACAE,GACAS,GACAE,GACAC,GACAI,GACAF,GACAK,GACAD,GACAG,GACAE,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAE,GACAC,GACAC,GACAE,GACAC,GACAE,GACAO,GACAiC,GACAU,GACAO,QAIJiC,IA1JA,SAAAA","sourcesContent":["import { ControlValueConverter } from '@farris/devkit';\r\n\r\nclass ArrayConverter implements ControlValueConverter {\r\n\r\n  constructor(private separator: string = ',') {\r\n  }\r\n\r\n  convertFrom(value: string): string[] {\r\n    return value.split(this.separator);\r\n  }\r\n\r\n  convertTo(value: string[]): string {\r\n    return value.join(this.separator);\r\n  }\r\n}\r\n\r\nexport { ArrayConverter };\r\n","/*\r\n * @Author: Witt\r\n * @Date: 2018-10-29 10:26:58\r\n * @Last Modified by: Witt\r\n * @Last Modified time: 2018-10-29 15:49:12\r\n */\r\nimport { ControlValueConverter, DateUtil } from '@farris/devkit';\r\n\r\n/**\r\n * \r\n */\r\nclass DateConverter implements ControlValueConverter {\r\n\r\n  /**\r\n   * \r\n   * @param format \r\n   */\r\n  constructor(private format: string) {\r\n  }\r\n\r\n  /**\r\n   * => \r\n   * @param value \r\n   */\r\n  convertFrom(value: string): Date {\r\n    if (DateUtil.isEmptyDateString(value) === true) {\r\n      return null;\r\n    }\r\n\r\n    return DateUtil.parse(value);\r\n  }\r\n\r\n  /**\r\n   * =>\r\n   * @param value\r\n   */\r\n  convertTo(value: Date): string | any {\r\n    if (!value) {\r\n      return null;\r\n    }\r\n    // valuevalue\r\n    if (Object.prototype.toString.call(value) !== '[object Date]') {\r\n      return value;\r\n    }\r\n    // \r\n    let year = value.getFullYear().toString();\r\n    year = year.length < 4 ? '0'.repeat(4 - year.length) + year : year;\r\n    // \r\n    let month = (value.getMonth() + 1).toString();\r\n    month = month.length === 1 ? ('0' + month) : month;\r\n\r\n    // \r\n    let day = value.getDate().toString();\r\n    day = day.length === 1 ? ('0' + day) : day;\r\n\r\n    // \r\n    let hours = value.getHours().toString();\r\n    hours = hours.length === 1 ? ('0' + hours) : hours;\r\n\r\n    let minutes = value.getMinutes().toString();\r\n    minutes = minutes.length === 1 ? ('0' + minutes) : minutes;\r\n\r\n    let seconds = value.getSeconds().toString();\r\n    seconds = seconds.length === 1 ? ('0' + seconds) : seconds;\r\n    return `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;\r\n  }\r\n}\r\nexport { DateConverter };\r\n","/*\r\n * @Author: Witt\r\n * @Date: 2018-10-29 10:26:58\r\n * @Last Modified by: Witt\r\n * @Last Modified time: 2018-10-29 15:49:12\r\n */\r\nimport { ControlValueConverter } from '@farris/devkit';\r\n\r\n/**\r\n * \r\n */\r\nclass MultiLangConverter implements ControlValueConverter {\r\n\r\n  /**\r\n   * \r\n   */\r\n  constructor() {\r\n  }\r\n\r\n  /**\r\n   * =>\r\n   */\r\n  public convertFrom(value: string): any {\r\n    const multiLangControlValue = Object.assign({}, value);\r\n    return multiLangControlValue;\r\n  }\r\n\r\n  /**\r\n   * =>\r\n   */\r\n  public convertTo(multiLangControlValue: any): any {\r\n    const value = multiLangControlValue;\r\n    return value;\r\n  }\r\n\r\n}\r\nexport { MultiLangConverter };\r\n","import { ControlValueConverter } from '@farris/devkit';\r\n\r\nclass FilterConditionsConverter implements ControlValueConverter {\r\n\r\n  constructor() {\r\n  }\r\n\r\n  convertFrom(conditionsString: string): any[] {\r\n    if (!conditionsString) {\r\n      return [];\r\n    }\r\n    return JSON.parse(conditionsString);\r\n  }\r\n\r\n  convertTo(conditions: any[]): string {\r\n    return JSON.stringify(conditions);\r\n  }\r\n}\r\n\r\nexport { FilterConditionsConverter };\r\n","/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\nthis file except in compliance with the License. You may obtain a copy of the\r\nLicense at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\nMERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\nSee the Apache Version 2.0 License for specific language governing permissions\r\nand limitations under the License.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport function __exportStar(m, exports) {\r\n    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];\r\n}\r\n\r\nexport function __values(o) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator], i = 0;\r\n    if (m) return m.call(o);\r\n    return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\r\n    result.default = mod;\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { DateTimeHelperService } from '@farris/ui-common/date';\r\nimport { NumberHelperService } from '@farris/ui-common/number';\r\nimport { DateUtil } from '@farris/devkit';\r\n\r\n@Injectable()\r\nclass FarrisKendoGridFormatService {\r\n    constructor(private dateService: DateTimeHelperService, private numberService: NumberHelperService) {\r\n    }\r\n\r\n    /**\r\n     *  \r\n     * @param dataItem  \r\n     * @param column \r\n     */\r\n    getColumnFormat(dataItem: any, column: any) {\r\n        const value = this.getValue(dataItem, column['dataField']);\r\n        // \r\n        const type = column['dataType'];\r\n        if (type === 'enum') {\r\n            return this.getEnumText(value, column);\r\n        } else if (type === 'boolean') {\r\n            return value ? '' : '';\r\n        } else if (type === 'date') {\r\n            return this.getFormatDate(value, column);\r\n        } else if (type === 'number') {\r\n            return this.getFormatNumber(value, column);\r\n        } else {\r\n            //   string\r\n            return this.getMultiText(value, column);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * idvalue\r\n     * @param dataItem  \r\n     * @param field id,name.Name(idudt)\r\n     */\r\n    private getValue(dataItem: any, field: string) {\r\n        const index = field.indexOf('.');\r\n        if (index < 0) {\r\n            return dataItem[field];\r\n        }\r\n        const fields = field.split('.');\r\n        // field\r\n        const a = fields.reduce((result: any, next: any) => {\r\n            return result[next];\r\n        }, dataItem);\r\n        return a;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    private getEnumText(value: any, column: any) {\r\n        const enumData = (column as any).enumData;\r\n        if (!enumData) {\r\n            return;\r\n        }\r\n        let tempColumnText: any;\r\n        enumData.forEach((ele: any) => {\r\n            if (ele.value === value) {\r\n                tempColumnText = ele.name;\r\n            }\r\n        });\r\n        return tempColumnText;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param value  \r\n     * @param column \r\n     */\r\n    public getFormatDate(value: string, column: any): string {\r\n\r\n        if (DateUtil.isEmptyDateString(value) === true) {\r\n          return '';\r\n        }\r\n\r\n        const dateFormat = (column as any).format;\r\n        if (!dateFormat) {\r\n            return value;\r\n        }\r\n        return this.dateService.formatTo(value, dateFormat);\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param value  \r\n     * @param column \r\n     * @todo   ;   value===null,'' \r\n     */\r\n    private getFormatNumber(value: any, column: any) {\r\n        let precision;\r\n        if (column && column.format) {\r\n            precision = parseInt(column.format.substr(1), 10);\r\n        } else if (column && column.editor) {\r\n            precision = column.editor.precision;\r\n        }\r\n        if (isNaN(precision)) {\r\n            precision = 2;\r\n        }\r\n        if (!value && value !== 0) {\r\n            return '';\r\n        }\r\n\r\n        const opts = {\r\n            prefix: column.prefix ? column.prefix : '',\r\n            suffix: column.suffix ? column.suffix : '',\r\n            precision: precision,\r\n            thousand: ',',\r\n            stripZeros: false,\r\n        };\r\n        return this.numberService.formatMoney(value, opts);\r\n    }\r\n\r\n    /**\r\n     *  shift+enter  \r\n     * @param value  \r\n     * @param column \r\n     */\r\n    private getMultiText(value: any, column: any) {\r\n        let strValue = value;\r\n        if (strValue !== '' && !strValue) {\r\n            strValue = '';\r\n        }\r\n        if (typeof strValue !== 'string') {\r\n            const valueType = typeof strValue;\r\n            throw new Error(`${valueType}`);\r\n        }\r\n        // xss\r\n        strValue = strValue.replace(/&/g, '&amp;')\r\n            .replace(/</g, '&lt;')\r\n            .replace(/>/g, '&gt;')\r\n            .replace(/\\\"/g, '&quot;')\r\n            .replace(/\\'/g, '&#39;')\r\n            .replace(/\\//g, '&#x2F;');\r\n        //   \r\n        if (column.editor && column.editor.type === 'MultiTextBox') {\r\n            const INDEX = strValue.indexOf('\\n');\r\n            if (INDEX > -1) {\r\n                return strValue.replace(/\\n/g, '<br>');\r\n            }\r\n            return strValue;\r\n        }\r\n        // string\r\n        return strValue;\r\n    }\r\n}\r\nexport { FarrisKendoGridFormatService };\r\n","import { Injectable } from '@angular/core';\r\nimport { TreeTableComponent } from '@farris/ui-treetable';\r\n@Injectable()\r\nexport class FarrisTreetableFormatService {\r\n    constructor() {\r\n    }\r\n    setFormat(treeTable: TreeTableComponent) {\r\n        const columns = treeTable.columns;\r\n        columns.forEach((column: any) => {\r\n            const dataType = column.dataType;\r\n            if (!column.formatter) {\r\n                if (dataType === 'date') {\r\n                    column.formatter = {\r\n                        type: 'datetime',\r\n                        options: {\r\n                            format: column.format\r\n                        }\r\n                    };\r\n                } else if (dataType === 'number') {\r\n                    column.formatter = {\r\n                        type: 'number',\r\n                        options: {\r\n                            prefix: column.prefix ? column.prefix : '',\r\n                            suffix: column.suffix ? column.suffix : '',\r\n                            precision: column.precision,\r\n                            thousand: ',',\r\n                            stripZeros: false,\r\n                        }\r\n                    };\r\n                } else if (dataType === 'enum') {\r\n                    column.formatter = {\r\n                        type: 'enum',\r\n                        options: {\r\n                            data: column.enumData,\r\n                            valueField: 'value',\r\n                            textField: 'name'\r\n                        }\r\n                    };\r\n                } else if (dataType === 'boolean') {\r\n                    column.formatter = {\r\n                        type: 'enum',\r\n                        options: {\r\n                            data: [{ name: '', value: true }, { name: '', value: false }],\r\n                            valueField: 'value',\r\n                            textField: 'name'\r\n                        }\r\n                    };\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n}\r\n","import { Pipe, PipeTransform } from '@angular/core';\r\nimport { DateUtil } from '@farris/devkit';\r\n\r\n@Pipe({ name: 'parseStrToDate' })\r\nexport class StringToDatePipe implements PipeTransform {\r\n    transform(value: string, exponent: string): any {\r\n        if (DateUtil.isEmptyDateString(value) === true) {\r\n          return null;\r\n        }\r\n\r\n        if (value.includes('')) {\r\n            const strDate = value.replace('', '-').replace('', '-').replace('', '');\r\n            return new Date(strDate);\r\n        }\r\n        return new Date(value);\r\n    }\r\n}\r\n","import { Directive, Input, OnInit, HostListener } from '@angular/core';\r\nimport { CompositeFilterDescriptor } from '@progress/kendo-data-query';\r\nimport { DropDownListComponent } from '@progress/kendo-angular-dropdowns';\r\nimport { FilterService, BaseFilterCellComponent } from '@progress/kendo-angular-grid';\r\n@Directive({\r\n    selector: '[kendogridFilter]'\r\n})\r\nexport class KendoGridFilterDirective extends BaseFilterCellComponent implements OnInit {\r\n\r\n    @Input() filter: CompositeFilterDescriptor;\r\n    @Input() column: any;\r\n\r\n    public get selectedValue(): any {\r\n        const filter = this.filterByField(this.column.dataField);\r\n        return filter ? filter.value : null;\r\n    }\r\n    public get defaultItem(): any {\r\n        return {\r\n            value: null,\r\n            name: ''\r\n        };\r\n    }\r\n\r\n    constructor(\r\n        private dropdownList: DropDownListComponent,\r\n        public filterService: FilterService,\r\n    ) {\r\n        super(filterService);\r\n    }\r\n\r\n    ngOnInit() {\r\n        this.dropdownList.valueField = 'value';\r\n        this.dropdownList.textField = 'name';\r\n        this.dropdownList.valuePrimitive = true;\r\n        this.dropdownList.defaultItem = this.defaultItem;\r\n        this.dropdownList.value = this.selectedValue;\r\n        if (this.column.dataType === 'enum') {\r\n            this.dropdownList.data = this.column.enumData;\r\n        } else if (this.column.dataType === 'boolean') {\r\n            this.dropdownList.data = [{ value: true, name: '' }, { value: false, name: '' }];\r\n        }\r\n    }\r\n\r\n\r\n    @HostListener('valueChange', ['$event'])\r\n    onChange(value: any) {\r\n        this.applyFilter(\r\n            value === null ?\r\n                this.removeFilter(this.column.dataField) :\r\n                this.updateFilter({\r\n                    field: this.column.dataField,\r\n                    operator: 'eq',\r\n                    value: value\r\n                })\r\n        );\r\n    }\r\n\r\n\r\n    /*\r\n   *    \r\n   * @param dataItem \r\n   * @param field \r\n   */\r\n    getValue(dataItem: any, field: string) {\r\n        const index = field.indexOf('.');\r\n        if (index < 0) {\r\n            return dataItem[field];\r\n        }\r\n        const fields = field.split('.');\r\n        // field\r\n        return fields.reduce((result: any, next: any) => {\r\n            return result[next];\r\n        }, dataItem);\r\n    }\r\n\r\n}\r\n","import { Pipe, PipeTransform } from '@angular/core';\r\nimport { ViewModel, DateUtil } from '@farris/devkit';\r\n@Pipe({ name: 'dateFormatPlaceholder' })\r\nexport class DateFormatPlaceholderPipe implements PipeTransform {\r\n    constructor(private viewModel: ViewModel) {\r\n\r\n    }\r\n    transform(format: string, controlName: string): any {\r\n        if (!this.viewModel.form || !this.viewModel.form.get(controlName)) {\r\n            return {\r\n                year: '',\r\n                month: '',\r\n                day: ''\r\n            };\r\n        }\r\n        const value = this.viewModel.form.get(controlName).value;\r\n        let dateStr = value;\r\n        if (dateStr) {\r\n            dateStr = value.toISOString();\r\n        }\r\n        if ((DateUtil.isEmptyDateString(dateStr) === true) && format === 'yyyyMMdd') {\r\n            return {\r\n                year: ' ',\r\n                month: ' ',\r\n                day: ' '\r\n            };\r\n        }\r\n        return {\r\n            year: '',\r\n            month: '',\r\n            day: ''\r\n        };\r\n    }\r\n}\r\n","import { Pipe, PipeTransform } from '@angular/core';\r\n@Pipe({ name: 'formatTotal' })\r\nexport class FormatTotalPipe implements PipeTransform {\r\n    transform(value: any, exponent: any): any {\r\n        // \r\n        if (!value && value !== 0) {\r\n            return '';\r\n        }\r\n        if (exponent.dataType === 'number') {\r\n            // \r\n            const dataFormat = exponent.format;\r\n            return value.toFixed(Number(dataFormat.substring(1)));\r\n        }\r\n        return value;\r\n    }\r\n}\r\n","import { Directive, ContentChildren, QueryList, Input, NgZone } from '@angular/core';\r\nimport { BindingData, BindingList } from '@farris/devkit';\r\nimport { ColumnComponent } from '@progress/kendo-angular-grid';\r\n\r\n@Directive({\r\n  selector: '[aggregate]',\r\n})\r\nexport class GridColumnAggregateDirective {\r\n\r\n  @Input() aggregate: string | boolean;\r\n\r\n  public get field(): string {\r\n    return this.column.field;\r\n  }\r\n\r\n  private get aggrType(): string {\r\n    let type = 'none';\r\n    if (typeof (this.aggregate) === 'boolean') {\r\n      // suminputsum\r\n      if (this.aggregate) {\r\n        type = 'sum';\r\n      }\r\n    } else if (typeof (this.aggregate) === 'string') {\r\n      type = this.aggregate;\r\n    }\r\n    return type;\r\n  }\r\n\r\n  constructor(private column: ColumnComponent, private ngZone: NgZone) {\r\n  }\r\n\r\n  public recalculateSummary(bindingList: BindingList) {\r\n    let summary = null;\r\n    if (this.aggrType === 'sum') {\r\n      const plainData = bindingList.toJSON().map(item => {\r\n        // udtfielda.b\r\n        return this.field.split('.').reduce((prevPath, currPath) => {\r\n          return prevPath[currPath];\r\n        }, item);\r\n      });\r\n      if (plainData && plainData.length) {\r\n        summary = plainData.reduce((prev, curr) => {\r\n          return prev + curr;\r\n        });\r\n      }\r\n    } else if (this.aggrType === 'count') {\r\n      // lengthtotal\r\n      summary = bindingList.length;\r\n    }\r\n    this.updateFooter(summary);\r\n  }\r\n\r\n  public updateFooter(content: any) {\r\n    if (this.aggregate) {\r\n        // setTimeout\r\n        // \r\n        // todo: settimeoutangulargridbinding\r\n        // setTimeout(() => {\r\n          this.column['summary'] = content;\r\n        // });\r\n    }\r\n  }\r\n}\r\n\r\n\r\n@Directive({\r\n  selector: '[farrisSummary]'\r\n})\r\nexport class GridSummaryDirective/* implements OnInit, AfterViewInit*/ {\r\n  @Input('farrisSummary') summary: string;\r\n  constructor(private bindingData: BindingData) { }\r\n\r\n}\r\n","import { ElementRef } from '@angular/core';\r\nimport { SelectedRowContext } from '../entity/index';\r\nimport { GridComponent } from '@progress/kendo-angular-grid';\r\n\r\n/**\r\n * \r\n */\r\nexport class MultiSelectGridUtility {\r\n  static CURRENT_ROW_STYLE_NAME = 'f-state-selected';\r\n  static CHECKBOXED_ROW_STYLE_NAME = 'f-state-checked';\r\n\r\n  /**\r\n   * \r\n   */\r\n  public static renderClickChangedRow(gridComponent: GridComponent, selectedRowContext: SelectedRowContext) {\r\n    if (!gridComponent) {\r\n      return;\r\n    }\r\n\r\n    const currentRowIndex = selectedRowContext.currentRowIndex;\r\n    // \r\n    this.addRowSelectedStyle(gridComponent, currentRowIndex);\r\n\r\n    // \r\n    const lastRowIndex = selectedRowContext.lastRowIndex;\r\n    if (!this.checIfIsSameRelativeIndex(gridComponent, currentRowIndex, lastRowIndex)) {\r\n      this.removeRowSelectedStyle(gridComponent, lastRowIndex);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  private static checIfIsSameRelativeIndex(gridComponent: GridComponent, currentRowIndex: number, lastRowIndex: number): boolean {\r\n    let isSameRelativeIndex = false;\r\n    if (currentRowIndex === lastRowIndex) {\r\n      isSameRelativeIndex = true;\r\n      return isSameRelativeIndex;\r\n    }\r\n\r\n    if ((Math.abs(currentRowIndex - lastRowIndex)) % (gridComponent.pageSize) === 0) {\r\n      isSameRelativeIndex = true;\r\n      return isSameRelativeIndex;\r\n    }\r\n\r\n    return isSameRelativeIndex;\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  public static checkIfEnablePaging(gridComponent: GridComponent): boolean {\r\n    let isPageable = false; // \r\n    if (!gridComponent) {\r\n      return isPageable;\r\n    }\r\n\r\n    if (typeof gridComponent.pageable === 'boolean') {\r\n      isPageable = gridComponent.pageable;\r\n    } else if (typeof gridComponent.pageable === 'object') {\r\n      isPageable = true;\r\n    }\r\n\r\n    return isPageable;\r\n  }\r\n\r\n  /**\r\n   * checkbox\r\n   */\r\n  public static renderSelectedChangeCheckbox(elementRef: ElementRef, $event: any) {\r\n\r\n    const currentRowIndex = $event.index;\r\n\r\n    const trCollection = this.getTrCollection(elementRef);\r\n    if (trCollection == null || trCollection.length <= 0 || trCollection.length < currentRowIndex) {\r\n      return;\r\n    }\r\n\r\n    // checked\r\n    const currentTableRowElement = trCollection[currentRowIndex];\r\n    if (!currentTableRowElement) {\r\n      return;\r\n    }\r\n\r\n    if ($event.selected) { // checked\r\n      this.appendAtrributeValue(currentTableRowElement, 'class', this.CHECKBOXED_ROW_STYLE_NAME);\r\n    } else { // unchecked\r\n      this.removeAttributeSpecificValue(currentTableRowElement, 'class', this.CHECKBOXED_ROW_STYLE_NAME);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * \r\n   * \r\n   */\r\n  private static addRowSelectedStyle(gridComponent: GridComponent, rowIndex: number) {\r\n    if (!gridComponent || rowIndex < 0) {\r\n      return;\r\n    }\r\n\r\n    const currentRowElement = this.getRelativeRowInCurrentPage(gridComponent, rowIndex);\r\n    if (!currentRowElement) {\r\n      return;\r\n    }\r\n\r\n    this.appendAtrributeValue(currentRowElement, 'class', this.CURRENT_ROW_STYLE_NAME);\r\n  }\r\n\r\n  /**\r\n   * \r\n   * kendo-grid\r\n   */\r\n  public static removeRowSelectedStyle(gridComponent: GridComponent, rowIndex: number) {\r\n    if (!gridComponent || rowIndex < 0) {\r\n      return;\r\n    }\r\n\r\n    const currentRowElement = this.getRelativeRowInCurrentPage(gridComponent, rowIndex);\r\n    if (!currentRowElement) {\r\n      return;\r\n    }\r\n    this.removeAttributeSpecificValue(currentRowElement, 'class', this.CURRENT_ROW_STYLE_NAME);\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  private static getRelativeRowInCurrentPage(gridComponent: GridComponent, rowIndex: number): any {\r\n    let rowElementInCurrentPage: any = null;\r\n    if (!gridComponent || rowIndex < 0) {\r\n      return rowElementInCurrentPage;\r\n    }\r\n\r\n    const gridElement = gridComponent.wrapper;\r\n    // \r\n    const isPaging = this.checkIfEnablePaging(gridComponent);\r\n    if (isPaging) {\r\n      rowIndex = rowIndex % (gridComponent.pageSize); // pageSize\r\n    }\r\n\r\n    const trCollection = this.getTrCollection(gridElement);\r\n    if (trCollection == null || trCollection.length <= 0) {\r\n      return rowElementInCurrentPage;\r\n    }\r\n\r\n    rowElementInCurrentPage = trCollection[rowIndex];\r\n\r\n    return rowElementInCurrentPage;\r\n  }\r\n\r\n  /**\r\n   * gridtr\r\n   */\r\n  private static getTrCollection(elementRef: ElementRef): any[] {\r\n    if (!elementRef || !elementRef.nativeElement) {\r\n      return null;\r\n    }\r\n\r\n    const kendoGridTbodyElements: any[] = elementRef.nativeElement.getElementsByTagName('tbody');\r\n    if (!kendoGridTbodyElements || kendoGridTbodyElements.length <= 0) {\r\n      return null;\r\n    }\r\n\r\n    const trCollection = kendoGridTbodyElements[0].getElementsByTagName('tr');\r\n    return trCollection;\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  private static appendAtrributeValue(currentElement: Element, attributeName: string, attributeValue: string) {\r\n    let newAttributeValue: string = currentElement.getAttribute(attributeName);\r\n    if (newAttributeValue === null || newAttributeValue === '' || newAttributeValue.length <= 0) {\r\n      newAttributeValue = attributeValue;\r\n    } else {\r\n      if (newAttributeValue.indexOf(attributeValue) < 0) { // \r\n        newAttributeValue += ' ' + attributeValue;\r\n      }\r\n    }\r\n\r\n    currentElement.setAttribute(attributeName, newAttributeValue);\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  private static removeAttributeSpecificValue(currentElement: Element, attributeName: string, needRemoveAttributeValue: string) {\r\n    let lastClassAttributeValue = currentElement.getAttribute(attributeName);\r\n    if (!lastClassAttributeValue) {\r\n      return;\r\n    }\r\n\r\n    const index = lastClassAttributeValue.lastIndexOf(needRemoveAttributeValue);\r\n    if (index < 0) {\r\n      return;\r\n    }\r\n\r\n    const tempLastClassAttributeValue = lastClassAttributeValue.substring(0, index - 1);\r\n    lastClassAttributeValue = tempLastClassAttributeValue + ' '\r\n      + lastClassAttributeValue.substring(index + needRemoveAttributeValue.length);\r\n\r\n    currentElement.setAttribute(attributeName, lastClassAttributeValue);\r\n  }\r\n}\r\n","/**\r\n * \r\n */\r\nexport class SelectedRowContext {\r\n    /**\r\n     * Index\r\n     */\r\n    currentRowIndex: number;\r\n\r\n    /**\r\n     * Index\r\n     */\r\n    lastRowIndex: number;\r\n}\r\n","import {\r\n  Directive, OnInit, OnChanges, OnDestroy, SimpleChanges, Input, HostListener, Optional,\r\n  EventEmitter, Output, ElementRef, ContentChildren, QueryList, NgZone, AfterViewInit\r\n} from '@angular/core';\r\nimport { of, Subscription } from 'rxjs';\r\nimport {\r\n  GridComponent, DataBindingDirective,\r\n  SelectionDirective,\r\n  CellClickEvent,\r\n  DataStateChangeEvent, GridDataResult, PageChangeEvent, SortSettings,\r\n} from '@progress/kendo-angular-grid';\r\nimport { process, GroupDescriptor, AggregateDescriptor, State, FilterDescriptor, SortDescriptor } from '@progress/kendo-data-query';\r\nimport {\r\n  BindingData, BindingList, Change, ChangeType,\r\n  FrameEventBus, UIState, Form, ViewModel, ComponentType\r\n} from '@farris/devkit';\r\nimport { DialogService } from '@farris/ui-dialog';\r\nimport { RuntimeStateService } from '@farris/ui-common';\r\nimport { DateTimeHelperService } from '@farris/ui-common/date';\r\nimport { FarrisKendoGridFormatService } from '../format/index';\r\nimport { GridColumnAggregateDirective } from './grid-summary.directive';\r\nimport { MultiSelectGridUtility } from '../util/multi_select_grid_utility';\r\nimport { SelectedRowContext } from '../entity/index';\r\n\r\n/*\r\n * Kendo Grid \r\n *\r\n * TODO:\r\n * 1\r\n * 2\r\n */\r\n\r\n@Directive({\r\n  selector: '[farrisBindingPath]'\r\n})\r\nexport class KendoGridBindingDirective extends DataBindingDirective implements OnInit, AfterViewInit, OnChanges, OnDestroy {\r\n\r\n  /**\r\n   * \r\n   *   \r\n   */\r\n  @Input('farrisEditable')\r\n  public editable: boolean;\r\n\r\n  /**\r\n   * \r\n   */\r\n  @Input('farrisForm')\r\n  public form: Form;\r\n\r\n  /**\r\n   * \r\n   */\r\n  @Input('groupField')\r\n  public groupField: string;\r\n\r\n  @Input('groupAggrFields')\r\n  public groupAggrFields: string[];\r\n\r\n  /* grid option */\r\n  @Input()\r\n  public farrisBindingGridOption: any;\r\n\r\n  /* rowClass  */\r\n  @Input()\r\n  rowClassName: any;\r\n  /*  */\r\n  // @Input()\r\n  // rowClassName: (context: any) => any;\r\n\r\n  // tslint:disable-next-line:no-output-rename\r\n  @Output('append-row') appendRow = new EventEmitter<any>();\r\n\r\n  /*  */\r\n  @Output() sortChangeEvent: EventEmitter<any> = new EventEmitter<any>();\r\n\r\n  /*  */\r\n  @Output()\r\n  rowClass: EventEmitter<any> = new EventEmitter<any>();\r\n\r\n\r\n  get gridOption() {\r\n    return this.grid['gridOption'];\r\n  }\r\n  get len() {\r\n    return this.grid.columns.length;\r\n  }\r\n\r\n  dataItem: any;\r\n\r\n  /* keydown */\r\n  gridElement: any;\r\n  gridKeydownEvent: any;\r\n\r\n  /* cellclick */\r\n  gridCellClickEvent: any;\r\n\r\n  /* cellClose */\r\n  gridCellCloseEvent: any;\r\n\r\n\r\n  cellClickEvent: CellClickEvent;\r\n\r\n  hiddenColLen = 0;\r\n  /**\r\n   * TODO: \r\n   * \r\n   */\r\n  rowIndex = 0;\r\n  columnIndex = 0;\r\n  sender: any;\r\n  interVal: any;\r\n  dataId: any;\r\n  currentSkip = 0;\r\n  private currentRowId: string;\r\n\r\n  cellClickParam: CellClickEvent;\r\n  /**\r\n   * \r\n   */\r\n  private isMultipleSelectionMode = false;\r\n  public get IsMultipleSelectionMode() {\r\n    if (!this.grid) {\r\n      return this.isMultipleSelectionMode;\r\n    }\r\n\r\n    if (this.grid.selectable) { // this.grid.selectable\r\n      // tslint:disable-next-line: no-string-literal\r\n      if (this.grid.selectable['mode'] === 'multiple') {\r\n        this.isMultipleSelectionMode = true;\r\n      } else {\r\n        this.isMultipleSelectionMode = false;\r\n      }\r\n    } else {\r\n      if (this.grid.selectableSettings && this.grid.selectableSettings.mode === 'multiple') {\r\n        this.isMultipleSelectionMode = true;\r\n      }\r\n    }\r\n\r\n    return this.isMultipleSelectionMode;\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  public lastRowIndex = -1;\r\n\r\n  /**\r\n   * \r\n   */\r\n  @Output() selectedRowChange: EventEmitter<any> = new EventEmitter<any>();\r\n\r\n  /**\r\n   * checkbox\r\n   */\r\n  @Output() selectedCheckboxChange: EventEmitter<any> = new EventEmitter<any>();\r\n\r\n  /**\r\n   * (Grid)\r\n   */\r\n  private get bindingList(): BindingList {\r\n    // \r\n    if (this.viewModel.bindingPath === '/' || !this.viewModel.bindingPath) {\r\n      return this.bindingData.list;\r\n    }\r\n    // \r\n    let bindingPath = this.viewModel.bindingPath.substr(1);\r\n    bindingPath = bindingPath[0].toLowerCase() + bindingPath.substring(1, bindingPath.length);\r\n    const paths = bindingPath.split('/');\r\n\r\n    const filteredPaths = paths.filter((part: string) => {\r\n      return part !== '';\r\n    });\r\n    return this.bindingData.getValue(filteredPaths);\r\n  }\r\n  /**\r\n   * \r\n   */\r\n  private getPagingInfo() {\r\n    const bindingPath = this.viewModel.bindingPath;\r\n    const bindingData = this.viewModel.bindingData;\r\n    let pagingInfo = bindingData.pagingInfo;\r\n    if (bindingPath === '/') {\r\n      return pagingInfo;\r\n    } else {\r\n      const bindingPaths = bindingPath.substr(1).split('/').filter(item => !!item && item.length > 0).map(item => {\r\n        return item.substring(0, item.length - 1);\r\n      });\r\n      bindingPaths.forEach(path => {\r\n        pagingInfo = pagingInfo && pagingInfo[path] || {};\r\n      });\r\n      return pagingInfo;\r\n    }\r\n  }\r\n\r\n  @ContentChildren(GridColumnAggregateDirective) private aggrColumns: QueryList<GridColumnAggregateDirective>;\r\n  private bindingChangeSubscription: Subscription;\r\n\r\n  /**\r\n   * \r\n   * @param  grid Grid\r\n   */\r\n  constructor(\r\n    public bindingData: BindingData,\r\n    @Optional() public uiState: UIState,\r\n    @Optional() public eventBus: FrameEventBus,\r\n    @Optional() public viewModel: ViewModel,\r\n    public grid: GridComponent,\r\n    public selectionDir: SelectionDirective,\r\n    public dialogSer: DialogService,\r\n    private dateService: DateTimeHelperService,\r\n    private kendogridFormatSer: FarrisKendoGridFormatService,\r\n    private rts: RuntimeStateService,\r\n    public ngZone: NgZone\r\n  ) {\r\n    super(grid);\r\n\r\n    this.selectionDir.selectedKeys = [];\r\n    this.viewModel.uiState.setPropertyValue('ids', this.selectionDir.selectedKeys);\r\n    const appContext = this.viewModel.frameContext.getFormAppContext();\r\n    if (appContext && appContext.hasOwnProperty('messagePipe')) {\r\n      appContext.messagePipe.subscribe((message: any) => {\r\n        this.grid.closeCell();\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  ngOnInit() {\r\n    super.ngOnInit();\r\n\r\n    // state\r\n    this.initDataState();\r\n\r\n    this.refreshView();\r\n    if (this.viewModel && this.viewModel.frameContext && this.viewModel.frameContext.frameComponent) {\r\n      this.viewModel.frameContext.frameComponent.componentType = ComponentType.kendoGridComponent;\r\n    }\r\n    // \r\n    this.bindingChangeSubscription = this.bindingData.changes.subscribe((change: Change) => {\r\n      this.refreshView(change);\r\n\r\n      if (change.type === ChangeType.Load) {\r\n        // load\r\n        if (this.isMultipleSelectionMode) {\r\n          const isMatch = this.checkIfChangeMatchBindingPath(change);\r\n          if (isMatch) {\r\n            // \r\n            this.selectionDir.selectedKeys = [];\r\n            this.viewModel.uiState.setPropertyValue('ids', this.selectionDir.selectedKeys);\r\n            this.ngZone.runOutsideAngular(() => {\r\n              // \r\n              setTimeout(() => {\r\n                const rowSelectedContext: SelectedRowContext = new SelectedRowContext();\r\n                const isPageable = MultiSelectGridUtility.checkIfEnablePaging(this.grid);\r\n                if (isPageable) {\r\n                  this.rowIndex = this.grid.skip;\r\n                } else {\r\n                  this.rowIndex = 0;\r\n                }\r\n                rowSelectedContext.currentRowIndex = this.rowIndex;\r\n                rowSelectedContext.lastRowIndex = this.lastRowIndex;\r\n                this.handleSelectedRowChange(rowSelectedContext);\r\n              }, 300);\r\n            });\r\n          }\r\n        }\r\n      }\r\n\r\n      // TODO: \r\n      // bindingData  SelectedKeys\r\n      if (change.type === ChangeType.Remove) {\r\n        this.syncDeletedKeys(change.value);\r\n      }\r\n      const isMatch = this.checkIfChangeMatchBindingPath(change);\r\n      if (isMatch) {\r\n        this.handleSelectedKeyChange(this.bindingList.currentId);\r\n      }\r\n      // \r\n      if (isMatch && this.checkCurrentRowIdExists() && change.type === ChangeType.SelectionChanged && !this.dataId) {\r\n        this.renderCurrentRow(this.bindingList.currentId);\r\n      }\r\n      // tslint:disable-next-line: max-line-length\r\n      // FIXME:\r\n      /*if ((change.type === ChangeType.SelectionChanged || change.type === ChangeType.GlobalSelectionChanged) && this.currentRowId !== this.bindingList.currentId) {\r\n          this.resetPageInfo();\r\n      }*/\r\n      // \r\n      if (change.type === ChangeType.Load || change.type === ChangeType.SelectionChanged\r\n        || change.type === ChangeType.Append || change.type === ChangeType.Remove) {\r\n\r\n        // \r\n        if (this.grid && this.grid['changeDetectorRef'] && this.grid['changeDetectorRef']['detectChanges']) {\r\n          this.grid['changeDetectorRef']['detectChanges']();\r\n        }\r\n      }\r\n\r\n    });\r\n\r\n    if (this.editable === true && this.form === null) {\r\n      throw Error('form');\r\n    }\r\n    if (!this.grid || !this.farrisBindingGridOption || !this.farrisBindingGridOption['fields']) {\r\n      return;\r\n    }\r\n\r\n    const gridColumns = this.farrisBindingGridOption['fields'];\r\n    const gridOption = this.farrisBindingGridOption;\r\n\r\n    // \r\n    gridOption.lockable = (columns: any[]) => {\r\n      return columns.some(ele => {\r\n        return ele.frozen;\r\n      });\r\n    };\r\n\r\n    this.rowClass.emit(this.grid);\r\n    // \r\n    gridColumns.forEach((element: any) => {\r\n      // \r\n      if (element.linkedLabelEnabled && !element.linkEvent) {\r\n        element.linkEvent = () => {\r\n          return;\r\n        };\r\n      }\r\n\r\n      //   \r\n      if (!element.getColumnFormat) {\r\n        element.getColumnFormat = (dataItem: any, column: any) => {\r\n          return this.kendogridFormatSer.getColumnFormat(dataItem, column);\r\n        };\r\n      }\r\n\r\n      //   \r\n      if (!element.getClassName) {\r\n        element.getClassName = (dataItem: any, column: any) => '';\r\n      }\r\n\r\n      // \r\n      if (element.editor && element.editor.type === 'LookupEdit') {\r\n\r\n        // \r\n        if (!element.dictPicking) {\r\n          element.dictPicking = (param: any) => {\r\n            return of(true);\r\n          };\r\n        }\r\n        // \r\n        if (!element.dictPicked) {\r\n          element.dictPicked = (param: any) => {\r\n            // \r\n            this.cellClickHandler(this.cellClickParam);\r\n            return of(true);\r\n          };\r\n        }\r\n      }\r\n    });\r\n    // gridOption\r\n    this.bindingGridOption();\r\n\r\n    // \r\n    if (this.IsMultipleSelectionMode) {\r\n      // TODO:  setTimeout\r\n      const self = this;\r\n      this.ngZone.runOutsideAngular(() => {\r\n        setTimeout(() => {\r\n          const rowSelectedContext: SelectedRowContext = new SelectedRowContext();\r\n          rowSelectedContext.currentRowIndex = self.rowIndex;\r\n          rowSelectedContext.lastRowIndex = self.lastRowIndex;\r\n          self.handleSelectedRowChange(rowSelectedContext);\r\n        }, 300);\r\n      });\r\n    }\r\n  }\r\n\r\n\r\n  ngAfterViewInit() {\r\n    // this.gridElement = document.querySelector('.k-grid');\r\n    // // grid keydown\r\n    // this.ngZone.runOutsideAngular(() => {\r\n    //   this.gridKeydownEvent = this.enterCell.bind(this);\r\n    //   this.gridCellClickEvent = this.cellClickHandler.bind(this);\r\n    //   this.gridCellCloseEvent = this.cellCloseHandler.bind(this);\r\n    //   this.gridElement.addEventListener('keydown', this.gridKeydownEvent);\r\n    //   this.gridElement.addEventListener('cellClick', this.gridCellClickEvent);\r\n    //   this.gridElement.addEventListener('cellClose', this.gridCellCloseEvent);\r\n    // });\r\n  }\r\n  /**\r\n   * changeBindingPath\r\n   */\r\n  private checkIfChangeMatchBindingPath(change: Change): boolean {\r\n    let isMatch = false;\r\n    if (!change || !change.path) {\r\n      return isMatch;\r\n    }\r\n\r\n    const changePathArray = change.path;\r\n    if (!changePathArray) {\r\n      return isMatch;\r\n    }\r\n\r\n    if (!(this.bindingData) && !(this.bindingData.bindingPath)) {\r\n      return isMatch;\r\n    }\r\n    const bingdingPathArray = this.bindingData.bindingPath.split('/');\r\n    if (bingdingPathArray.length <= 0) {\r\n      return isMatch;\r\n    }\r\n\r\n    if (changePathArray.length === 0) { // \r\n      if (this.bindingData.bindingPath === '/') {\r\n        isMatch = true;\r\n      }\r\n    } else if (change.path.length === 1) {// \r\n      if (bingdingPathArray.length === 2 && bingdingPathArray[1] === change.path[0]) {\r\n        isMatch = true;\r\n      }\r\n    } else if (change.path.length === 2) { // \r\n      if (bingdingPathArray.length === 3 && bingdingPathArray[1] === change.path[0] && bingdingPathArray[2] === change.path[1]) {\r\n        isMatch = true;\r\n      }\r\n    }\r\n\r\n    return isMatch;\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  private handleSelectedKeyChange(currentId: any) {\r\n    const selectedKeys = this.selectionDir.selectedKeys;\r\n    if (!currentId) {\r\n\r\n      // nullselectedKeys\r\n      if (selectedKeys.length > 0) {\r\n        const removedSelectedKeys = selectedKeys.splice(0, selectedKeys.length);\r\n        if (removedSelectedKeys.indexOf(null) === -1) {\r\n          this.emitSelectedRowChange({ currentRowId: null });\r\n        }\r\n      }\r\n      return;\r\n    }\r\n    let oldCurrentRowId = null;\r\n    if (this.IsMultipleSelectionMode) {\r\n      oldCurrentRowId = this.currentRowId;\r\n    } else {\r\n      oldCurrentRowId = this.selectionDir.selectedKeys.length === 0\r\n        ? null : this.selectionDir.selectedKeys[0];\r\n    }\r\n\r\n    // TODO:if (this.currentRowId !== currentId) {\r\n    if (oldCurrentRowId !== currentId) {\r\n      const selectedRowContext: any = {};\r\n      selectedRowContext.currentRowId = currentId;\r\n      this.currentRowId = currentId;\r\n      this.emitSelectedRowChange(selectedRowContext);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @description \r\n   */\r\n  private emitSelectedRowChange(selectedRowContext: any) {\r\n    if (!this.IsMultipleSelectionMode) { // \r\n      const currentId = selectedRowContext.currentRowId;\r\n      this.selectionDir.selectedKeys = [currentId];\r\n      this.selectionDir.selectedKeysChange.emit(this.selectionDir.selectedKeys);\r\n    }\r\n\r\n    this.selectedRowChange.emit(selectedRowContext);\r\n  }\r\n\r\n  private checkCurrentRowIdExists(): boolean {\r\n    let isExist = false;\r\n\r\n    if (this.bindingList && this.bindingList.currentId && this.bindingList.currentId.length > 0) {\r\n      isExist = true;\r\n    }\r\n\r\n    return isExist;\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  private syncDeletedKeys(deletedValueCollection: any[]) {\r\n    if (!deletedValueCollection) {\r\n      return;\r\n    }\r\n\r\n    deletedValueCollection.forEach((id: string) => {\r\n      const index = this.selectionDir.selectedKeys.indexOf(id);\r\n      if (index > -1) {\r\n        this.selectionDir.selectedKeys.splice(index, 1);\r\n\r\n        // selectedKeys\r\n        if (this.selectionDir.selectedKeys.length === 0) {\r\n          this.emitSelectedRowChange({ currentRowId: null });\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  private renderCurrentRow(currentId: string) {\r\n    if (!currentId || currentId === '') {// \r\n      return;\r\n    }\r\n\r\n    // TODO:\r\n    if (this.IsMultipleSelectionMode) {\r\n      return;\r\n    }\r\n\r\n    this.renderSelectionRow(this.bindingList.currentId, this.selectionDir.selectedKeys);\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  ngOnChanges(changes: SimpleChanges) {\r\n    super.ngOnChanges(changes);\r\n    this.refreshView();\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  ngOnDestroy() {\r\n    if (this.bindingChangeSubscription) {\r\n      this.bindingChangeSubscription.unsubscribe();\r\n    }\r\n  }\r\n\r\n  private refreshView(change?: Change) {\r\n    // this.bindData();\r\n    this.refreshData(change);\r\n\r\n    // by justin\r\n    this.refreshSummary();\r\n  }\r\n\r\n  /**\r\n   * datagrid\r\n   * @deprecated\r\n   */\r\n  private bindData() {\r\n    /*const data = this.bindingList.toJSON();\r\n    let skip = 0;\r\n    if (this.bindingList.pageIndex > 0) {\r\n      skip = (this.bindingList.pageIndex - 1) * this.bindingList.pageSize;\r\n    }\r\n    this.updatePager(this.bindingList.pageSize, skip);\r\n    const processed = process(data, Object.assign({}, this.state, { skip: 0 }));\r\n    processed.total = this.bindingList.total;\r\n    this.grid.data = processed;*/\r\n  }\r\n\r\n  private refreshData(change?: Change) {\r\n    let skip = 0;\r\n    const { pageIndex = 1, pageSize = 0 } = this.getPagingInfo() || {};\r\n    if (pageIndex > 0) {\r\n      skip = (pageIndex - 1) * pageSize;\r\n    }\r\n    this.updatePager(pageSize, skip);\r\n    this.endCellEdit(change);\r\n    this.data = this.bindingList.toJSON({ ignoreMultiLangInput: true });\r\n  }\r\n  /**\r\n   * \r\n   * @param change \r\n   */\r\n  private endCellEdit(change?: Change) {\r\n    const isEditing = this.grid.isEditing;\r\n    if (change && change.type === ChangeType.Load && isEditing) {\r\n      this.grid.cancelCell();\r\n    }\r\n  }\r\n  private refreshSummary() {\r\n    if (this.aggrColumns) {\r\n      this.aggrColumns.forEach(aggrCol => {\r\n        if (aggrCol.aggregate) {\r\n          aggrCol.recalculateSummary(this.bindingList);\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  @HostListener('pageChange', ['$event'])\r\n  public onPageChange(event: PageChangeEvent) {\r\n    const { skip = 0, take = 0 } = event || {};\r\n    // this.bindingList.setPaginationInfo(skip, take);\r\n    this.bindingData.setPagingInfo(skip, take, this.viewModel.bindingPath);\r\n    // \r\n    MultiSelectGridUtility.removeRowSelectedStyle(this.grid, this.rowIndex);\r\n  }\r\n  /**\r\n   * grid\r\n   */\r\n  private resetPageInfo() {\r\n    const { pageSize = 0 } = this.getPagingInfo() || {};\r\n    this.bindingData.setPagingInfo(0, pageSize, this.viewModel.bindingPath);\r\n  }\r\n  private initDataState() {\r\n    // const groups: GroupDescriptor[] = [];\r\n    // if (this.groupField) {\r\n    //   groups.push({field: this.groupField, aggregates: this.aggregates||[]});\r\n    //   this.grid.group = groups;\r\n    // }\r\n    // this.state = Object.assign(this.state, {group: groups});\r\n\r\n    const aggregatesDes: AggregateDescriptor[] = [];\r\n    if (this.groupAggrFields) {\r\n      for (const groupAggrField of this.groupAggrFields) {\r\n        aggregatesDes.push({ field: groupAggrField, aggregate: 'sum' });\r\n      }\r\n    }\r\n\r\n    const group: GroupDescriptor[] = [];\r\n    if (this.groupField) {\r\n      group.push({ field: this.groupField, aggregates: aggregatesDes });\r\n    }\r\n    this.group = group;\r\n\r\n  }\r\n\r\n  /*\r\n   * @override\r\n   * @param state State\r\n   */\r\n  onStateChange(state: DataStateChangeEvent) {\r\n    // pagerskipkendo gridfilter stateskip0\r\n    // onStateChangeskip\r\n    if (state.skip !== this.currentSkip) {\r\n      state.skip = this.currentSkip;\r\n    }\r\n    // kendostate\r\n    this.applyState(state);\r\n\r\n    this.rebind();\r\n  }\r\n\r\n  // protected applyState({skip, take, sort, group, filter}: State): void {\r\n  //   this.skip = skip;\r\n  //   this.pageSize = take;\r\n  //   this.sort = sort;\r\n  //   this.group = group;\r\n  //   this.filter = filter;\r\n  // }\r\n\r\n  /*\r\n   * @override processstateskip0\r\n   * @param state State\r\n   */\r\n  protected process(state: State): GridDataResult {\r\n    // if (this.editing) {\r\n    //   state.sort = null;\r\n    // } else {\r\n    //   state.sort = this.originalSort;\r\n    // }\r\n    state.skip = 0;\r\n    const { pageSize = 0, total: totalCount = 0 } = this.getPagingInfo() || {};\r\n    // fixtake=0process\r\n    if (state.take === 0) {\r\n      state.take = this.bindingList.length;\r\n    } else {\r\n      state.take = pageSize;\r\n    }\r\n    // pageSize\r\n    const isEditMode = state.take < this.bindingList.length;\r\n    if (isEditMode) {\r\n      state.take = this.bindingList.length;\r\n    }\r\n    const processed = super.process(state);\r\n    // fix:\r\n    processed.total = Math.max(totalCount, this.bindingList.length);\r\n    // \r\n    if (isEditMode) {\r\n      processed.total = totalCount || 1;\r\n    }\r\n\r\n    return processed;\r\n  }\r\n\r\n  /*\r\n   * \r\n   * @param event { SelectionEvent} \r\n   */\r\n  @HostListener('selectedKeysChange', ['$event'])\r\n  public selectedKeysChangeHandler(selectedKeys: string[]) {\r\n    if (!(this.IsMultipleSelectionMode)) {// \r\n      // BindingData\r\n      this.setSelectionIdToBindingData(selectedKeys[selectedKeys.length - 1]);\r\n    }\r\n\r\n    this.viewModel.uiState.setPropertyValue('ids', this.selectionDir.selectedKeys); // \r\n  }\r\n\r\n  /*\r\n   * Grid\r\n   * @param event { SelectionEvent} \r\n   */\r\n  @HostListener('selectionChange', ['$event'])\r\n  public selectionChangeHandler(event: any) {\r\n    if (this.IsMultipleSelectionMode) {\r\n      this.handleSelectedCheckboxChange(this.grid.wrapper, event);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * checkbox\r\n   */\r\n  private handleSelectedCheckboxChange(elementRef: ElementRef, event: any) {\r\n    MultiSelectGridUtility.renderSelectedChangeCheckbox(elementRef, event);\r\n    this.selectedCheckboxChange.emit(event);\r\n  }\r\n\r\n  /*\r\n   * \r\n   * @param event { CellClickEvent } \r\n   */\r\n  @HostListener('cellClick', ['$event'])\r\n  public cellClickHandler(event: CellClickEvent) {\r\n    this.cellClickParam = event;\r\n    this.cellClickEvent = event;\r\n    this.rowIndex = event.rowIndex;\r\n    this.columnIndex = event.columnIndex;\r\n    this.sender = event.sender;\r\n\r\n    // \r\n    if (this.IsMultipleSelectionMode && !this.gridOption.groupable) {\r\n      const currentRowIndex = event.rowIndex;\r\n      if (currentRowIndex !== this.lastRowIndex) {\r\n        const rowSelectedContext: SelectedRowContext = new SelectedRowContext();\r\n        rowSelectedContext.currentRowIndex = currentRowIndex;\r\n        rowSelectedContext.lastRowIndex = this.lastRowIndex;\r\n\r\n        this.handleSelectedRowChange(rowSelectedContext);\r\n      }\r\n    }\r\n\r\n    // \r\n    this.dataId = this.getSelectedIdFromGrid(event.dataItem);\r\n    this.setSelectionIdToBindingData(this.dataId);\r\n\r\n    //  \r\n    if (!this.isEditable()) {\r\n      return;\r\n    }\r\n\r\n\r\n\r\n    //   \r\n    if (!event.column.editTemplate) {\r\n      return;\r\n    }\r\n    if (event.type === 'click' && !event.isEdited) {\r\n\r\n\r\n      //   columnIndex\r\n      const originColums = this.getColumns(this.gridOption.fields);\r\n      const columns: any[] = this.getColumns(originColums);\r\n      const currentColumnIndex = columns.findIndex((col: any) => col.dataField === event.column.field);\r\n      const hiddenColLen = columns.slice(0, currentColumnIndex + 1).filter(col => !col.visible).length;\r\n\r\n      //   \r\n      this.rowIndex = event.rowIndex;\r\n      this.columnIndex = event.columnIndex + hiddenColLen;\r\n      this.hiddenColLen = hiddenColLen;\r\n      this.sender = event.sender;\r\n\r\n      this.setEditable(this.rowIndex, this.columnIndex);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  private handleSelectedRowChange(rowSelectedContext: SelectedRowContext) {\r\n    MultiSelectGridUtility.renderClickChangedRow(this.grid, rowSelectedContext);\r\n\r\n    this.rowIndex = rowSelectedContext.currentRowIndex;\r\n    this.lastRowIndex = rowSelectedContext.currentRowIndex;\r\n    // \r\n    const id = this.getPrimary(this.rowIndex);\r\n    this.setSelectionIdToBindingData(id);\r\n  }\r\n  /**\r\n   * \r\n   * @param row \r\n   */\r\n  private getPrimary(row: number) {\r\n    let data: any = this.grid.data;\r\n    if (data && !Array.isArray(data) && data.hasOwnProperty('data')) {\r\n      data = data.data;\r\n    }\r\n    const { pageIndex = 1, pageSize = 0 } = this.getPagingInfo() || {};\r\n    const skip = this.bindingList.skip;\r\n    // \r\n    const rowNumber = pageSize === 0 || pageIndex === 1 ? row : row - skip;\r\n    if (data.length > rowNumber) {\r\n      return data[rowNumber][this.bindingList.primaryKey];\r\n    }\r\n    return null;\r\n  }\r\n\r\n  /*\r\n   * \r\n   * @param event \r\n   */\r\n  @HostListener('cellClose', ['$event'])\r\n  public cellCloseHandler(event: any): any {\r\n\r\n    if (this.dialogSer.hasDialogOpened()) {\r\n      event.preventDefault();\r\n      return;\r\n    }\r\n\r\n    if (this.rts) {\r\n      // \r\n      if (this.rts.getFormState('lookup.pending')) {\r\n        event.preventDefault();\r\n        return;\r\n      }\r\n\r\n      // \r\n      if (event.originalEvent) {\r\n        if (this.rts.eventPath(event.originalEvent).find(n => n.tagName === 'FARRIS-DIALOG')) {\r\n          event.preventDefault();\r\n          return;\r\n        }\r\n      }\r\n    }\r\n\r\n\r\n    const { formGroup, column, dataItem, rowIndex } = event;\r\n    const columns = this.getColumns(this.gridOption.fields);\r\n    let currentCol = columns.find((element: any) => {\r\n      return element.dataField === column.field;\r\n    });\r\n    const formControlValue = formGroup[currentCol.editor.binding.path].value;\r\n    if (currentCol.getDynamicData) {\r\n      // \r\n      currentCol = currentCol.getDynamicData(dataItem, currentCol);\r\n    }\r\n    this.setValue(formControlValue, currentCol);\r\n  }\r\n\r\n  /*\r\n     *   \r\n     * @param event \r\n     */\r\n  @HostListener('keydown', ['$event'])\r\n  enterCell(e: any) {\r\n    // \r\n    if (!e.shiftKey && e.keyCode === 13) {\r\n      // textarea enter \r\n      e.preventDefault();\r\n      if (!this.sender) {\r\n        return;\r\n      }\r\n      // keydown blur \r\n      e.target.blur();\r\n      this.ngZone.runOutsideAngular(() => {\r\n        setTimeout(() => {\r\n          if (this.rts && this.rts.getFormState('lookup.pending')) {\r\n            e.preventDefault();\r\n            return;\r\n          }\r\n          this.enterNextCell();\r\n        }, 201);\r\n      });\r\n    }\r\n  }\r\n\r\n  /*\r\n     * grid option\r\n     * @param dataItem \r\n     */\r\n  private bindingGridOption() {\r\n    if (!this.farrisBindingGridOption) {\r\n      return;\r\n    }\r\n    Object.defineProperty(this.grid, 'gridOption', { value: this.farrisBindingGridOption });\r\n  }\r\n\r\n  /*\r\n   * Grid\r\n   * @param take\r\n   * @param skip\r\n   */\r\n  private updatePager(take: number, skip: number) {\r\n    if (take === 0) {\r\n      this.currentSkip = 0;\r\n      this.pageSize = 0;\r\n      this.skip = 0;\r\n      this.grid.pageable = false;\r\n    } else {\r\n      this.currentSkip = skip;\r\n      this.skip = skip;\r\n      this.pageSize = take;\r\n      this.grid.pageable = {\r\n        buttonCount: 10,\r\n        info: true,\r\n        type: 'numeric',\r\n        pageSizes: false,\r\n        previousNext: true\r\n      };\r\n    }\r\n  }\r\n\r\n  /*\r\n   * \r\n   * @param dataItem \r\n   * @param column \r\n   * @param rowIndex \r\n   * @param columnIndex \r\n   * @param sender grid\r\n   */\r\n  setEditable(rowNumber: number, columnNumber: number) {\r\n    const data = this.grid.data['data'];\r\n    const { pageIndex = 1, pageSize = 0 } = this.getPagingInfo() || {};\r\n    const skip = this.bindingList.skip;\r\n    // \r\n    const dataRowNumber = pageSize === 0 || pageIndex === 1 ? rowNumber : rowNumber - skip;\r\n    let item = data[dataRowNumber];\r\n    if (this.gridOption.groupable) {\r\n      item = this.getGroupItem(data, dataRowNumber);\r\n    }\r\n    const originColums = this.getColumns(this.gridOption.fields);\r\n    const columns = this.getColumns(originColums);\r\n    /*     */\r\n    // let col = columns[columnNumber];\r\n\r\n    let tempIndex = columnNumber;\r\n    // 0\r\n    if (this.grid['gridOption'].showLineNumber) {\r\n      tempIndex = tempIndex - 1;\r\n    }\r\n    if (this.grid.selectable && this.grid.selectable['mode'] === 'multiple') {\r\n      tempIndex = tempIndex - 1;\r\n    }\r\n    const col = columns[tempIndex];\r\n\r\n    const params = {\r\n      dataItem: item,\r\n      column: col,\r\n      rowIndex: rowNumber,\r\n      columnIndex: tempIndex,\r\n    };\r\n\r\n    // \r\n    if (col && !col.editable) {\r\n      col.editable = (param: object) => true;\r\n    }\r\n    if (col && this.notReadOnly(col, params)) {\r\n      // \r\n      this.dataId = this.getSelectedIdFromGrid(item);\r\n      this.setSelectionIdToBindingData(this.dataId);\r\n      // const value = this.getValue(item, col.dataField);\r\n      // this.setValue(value, col);\r\n      this.sender.editCell(rowNumber, columnNumber - this.hiddenColLen, this.viewModel.form);\r\n    }\r\n\r\n  }\r\n  /*\r\n   rowIndex columnIndex\r\n   */\r\n  updateIndex(rowNumber: number, columnIndex: number) {\r\n    const newColumnIndex = (columnIndex + 1) % this.len;\r\n    if (!newColumnIndex) {\r\n      const dataLen = this.bindingList.toJSON().length;\r\n      const newRowIndex = (rowNumber + 1) % dataLen;\r\n      return { rowIndex: newRowIndex, columnIndex: newColumnIndex };\r\n    }\r\n    return {\r\n      rowIndex: rowNumber,\r\n      columnIndex: newColumnIndex\r\n    };\r\n  }\r\n\r\n  /*  */\r\n  notReadOnly(column: any, param: any) {\r\n    if (!column) {\r\n      return false;\r\n    }\r\n    return column.editable(param) && !column.editor.readonly;\r\n  }\r\n\r\n  /*\r\n     *  formcontrol\r\n      */\r\n  setValue(value: any, column: any) {\r\n    const currentColumnType = column.dataType;\r\n    // gridOption\r\n    const bindingData = this.viewModel.bindingData;\r\n    const fieldPaths = this.getFieldPaths(bindingData.bindingPath, column.dataField);\r\n    // \r\n    if (currentColumnType === 'date') {\r\n      let dateStr = this.dateService.formatTo(value, 'yyyy-MM-dd HH:mm:ss');\r\n      if (!dateStr) {\r\n        dateStr = '';\r\n      }\r\n      this.viewModel.bindingData.setValue(fieldPaths, dateStr, true, true);\r\n    } else {\r\n      this.viewModel.bindingData.setValue(fieldPaths, value, true, true);\r\n    }\r\n  }\r\n\r\n  /*   */\r\n  getGroupItem(data: any[], rowNumber: number) {\r\n    let index = rowNumber;\r\n    for (const i in data) {\r\n      if (index < data[i].items.length) {\r\n        return data[i].items[index];\r\n      } else {\r\n        index = index - data[i].items.length;\r\n      }\r\n    }\r\n  }\r\n\r\n  /*\r\n   *    \r\n   * @param dataItem \r\n   * @param field \r\n   */\r\n  getValue(dataItem: any, field: string) {\r\n    const index = field.indexOf('.');\r\n    if (index < 0) {\r\n      return dataItem[field];\r\n    }\r\n    const fields = field.split('.');\r\n    // field\r\n    return fields.reduce((result: any, next: any) => {\r\n      return result[next];\r\n    }, dataItem);\r\n  }\r\n\r\n  /*\r\n  *  bindingData \r\n  * @param bindingPath \r\n  * @param fieldName \r\n  */\r\n  private getFieldPaths(bindingPath: string, field: string): string[] {\r\n    let fieldPath = '';\r\n    if (bindingPath.length > 1) {\r\n      fieldPath = bindingPath.substr(1).replace(/\\//g, '.') + '.' + field;\r\n    } else {\r\n      fieldPath = field;\r\n    }\r\n    return fieldPath.split('.');\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  enterNextCell() {\r\n    const index = this.updateIndex(this.rowIndex, this.columnIndex);\r\n    if (!index.columnIndex && !index.rowIndex) {\r\n      const len = this.bindingList.toJSON().length;\r\n      // API\r\n      this.appendRow.emit();\r\n      if (this.appendRow.observers && this.appendRow.observers.length) {\r\n        this.interVal = setInterval(() => {\r\n          if (this.bindingList.toJSON().length - 1 === len) {\r\n            this.setEditable(this.bindingList.toJSON().length - 1, 0);\r\n            this.rowIndex = this.bindingList.toJSON().length - 1;\r\n            this.columnIndex = 0;\r\n            clearInterval(this.interVal);\r\n          }\r\n        }, 0);\r\n        return;\r\n      }\r\n    }\r\n\r\n    this.setEditable(index.rowIndex, index.columnIndex);\r\n    this.rowIndex = index.rowIndex;\r\n    this.columnIndex = index.columnIndex;\r\n  }\r\n\r\n  /*  */\r\n  getColumns(columns: any) {\r\n    // \r\n    const hasLocked = columns.some((ele: any) => {\r\n      return ele.frozen;\r\n    });\r\n    if (hasLocked) {\r\n      const lockedColumns = columns.filter((ele: any) => {\r\n        return ele.frozen;\r\n      });\r\n      const notLockedColumns = columns.filter((ele: any) => {\r\n        return !ele.frozen;\r\n      });\r\n      return [...lockedColumns, ...notLockedColumns];\r\n    }\r\n    return columns;\r\n  }\r\n\r\n  /*\r\n   * key\r\n   */\r\n  private renderSelectionRow(key: string, selectedKeys: any[]) {\r\n    if (!key || key === '') {\r\n      return;\r\n    }\r\n\r\n    // TODO:\r\n    if (this.IsMultipleSelectionMode) {\r\n      const index = selectedKeys.indexOf(key);\r\n      if (index >= 0) {\r\n        return;\r\n      }\r\n\r\n      selectedKeys.push(key);\r\n    } else {\r\n      if (selectedKeys.length === 1 && selectedKeys[0] === key) {\r\n        return;\r\n      }\r\n\r\n      selectedKeys.splice(0, selectedKeys.length);\r\n      selectedKeys.push(key);\r\n    }\r\n\r\n    this.selectionDir.selectedKeysChange.emit(selectedKeys); // selectedKeysChange\r\n  }\r\n\r\n  /*\r\n   * Grid\r\n   * @param dataItem \r\n   */\r\n  private getSelectedIdFromGrid(dataItem: any) {\r\n    const primaryKey = this.bindingList.primaryKey;\r\n    return dataItem[primaryKey];\r\n  }\r\n\r\n  /*\r\n   * BindingList\r\n   * @param id \r\n   */\r\n  private setSelectionIdToBindingData(id: string): void {\r\n    this.bindingList.setCurrentId(id, true);\r\n  }\r\n\r\n  /*\r\n  *\r\n   */\r\n  isEditable() {\r\n    if (this.editable === undefined) {\r\n      if (!this.viewModel.stateMachine) {\r\n        // \r\n        return false;\r\n      }\r\n      // \r\n      return this.viewModel.stateMachine['editable'];\r\n    }\r\n    // \r\n    return this.editable;\r\n  }\r\n  /*  */\r\n  isDataChanged() {\r\n    let hasUnsavedData = false;\r\n    const entityArray = this.viewModel.frameContext.repository.entityCollection.toArray();\r\n    for (const entity of entityArray) {\r\n      if (entity.changes.length > 0) {\r\n        hasUnsavedData = true;\r\n        break;\r\n      }\r\n    }\r\n    return hasUnsavedData;\r\n  }\r\n}\r\n","\r\n/*\r\n * @Author: Witt\r\n * @Date: 2019-04-01 17:26:50\r\n * @Last Modified by: aalizzwell\r\n * @Last Modified time: 2019-12-12 16:17:06\r\n */\r\nimport { FrameContext } from '@farris/devkit';\r\nimport { TreeNode, TreeTableComponent } from '@farris/ui-treetable';\r\nimport { PathHierarchyInfo } from './types';\r\n// tslint:disable: no-string-literal\r\n/**\r\n * \r\n * @summary\r\n * BindingDataTreeTable\r\n */\r\nclass PathTreeNodeBuilder {\r\n  private levelGroup: { [level: string]: any[] } = {};\r\n  private frameContext: FrameContext;\r\n  /**\r\n   * \r\n   */\r\n  constructor(allNodesData: any[], oldTreeNodes: TreeNode[], primaryKey: string, hierarchyInfoKey: string, context?: any) {\r\n    this.primaryKey = primaryKey;\r\n    this.hierarchyInfoKey = hierarchyInfoKey;\r\n    this.allNodes = [];\r\n    this.allNodesData = allNodesData;\r\n    this.context = context || {};\r\n    this.nodesWaitExpand = [];\r\n    this.nodesShouldExpand = context && context.nodesShouldExpand || [];\r\n    this.frameContext = context && context.frameContext || null;\r\n    this.addTreeLoadCompleteListener(this.onTreeLoadComplete.bind(this));\r\n\r\n    this.initLevelGroup();\r\n    this.allNodesMap = new Map<string, TreeNode>();\r\n    this.allOldNodesMap = new Map<string, TreeNode>();\r\n    this.buildNodesDataMap(oldTreeNodes);\r\n  }\r\n  /**\r\n   * \r\n   * @description -1\r\n   */\r\n  private get expandLevel() {\r\n    return this.context && this.context.hasOwnProperty('expandLevel') ? this.context['expandLevel'] : -1;\r\n  }\r\n  private get component(): TreeTableComponent {\r\n    return this.context && this.context['component'];\r\n  }\r\n  private get addTreeLoadCompleteListener() {\r\n    return this.context && this.context['addTreeLoadCompleteListener'] || function (args: any) { };\r\n  }\r\n  /**\r\n   * \r\n   */\r\n  private nodesShouldExpand: string[];\r\n  /**\r\n   * \r\n   * @description \r\n   * ```\r\n   * {id:'xxx',expanded:false}\r\n   * ```\r\n   */\r\n  private nodesWaitExpand: any[] = [];\r\n\r\n  /**\r\n   * \r\n   */\r\n  private primaryKey: string;\r\n\r\n  /**\r\n   * \r\n   */\r\n  private hierarchyInfoKey: string;\r\n\r\n  /**\r\n   * \r\n   */\r\n  private allNodesData: any[];\r\n\r\n  /**\r\n   * \r\n   */\r\n  private allNodes: TreeNode[];\r\n\r\n  /**\r\n   * Map\r\n   */\r\n  private allNodesMap: Map<string, TreeNode>;\r\n\r\n  /**\r\n   * Map\r\n   */\r\n  private allOldNodesMap: Map<string, TreeNode>;\r\n  /**\r\n   * \r\n   */\r\n  private context: any;\r\n  public updateTreeNode(allNodesData: any, data: any) {\r\n    this.allNodesData = allNodesData;\r\n    this.initLevelGroup();\r\n    this.buildNodesDataMap(data);\r\n  }\r\n  public build(): TreeNode[] {\r\n    const tree: TreeNode[] = [];\r\n    const childrenOf = {};\r\n    const nodes = {};\r\n    this.allNodesData.forEach(item => {\r\n      const id = item.id;\r\n      const parentId = this.getParentId(item);\r\n\r\n      // item.parentId = parentId;\r\n      // \r\n      const isNewNode = this.isNewNode(item);\r\n      if (isNewNode === true) {\r\n        this.expandParentNode(item);\r\n      }\r\n      // \r\n      const node = this.buildNode(item);\r\n      nodes[id] = node;\r\n      childrenOf[id] = childrenOf[id] || [];\r\n      node.children = childrenOf[id];\r\n\r\n      this.allNodesMap.set(item[this.primaryKey], node);\r\n      if (parentId) {\r\n        if (nodes[parentId] && nodes[parentId].unstableState === true) {\r\n          nodes[parentId].expanded = true;\r\n          nodes[parentId].unstableState = false;\r\n        }\r\n        childrenOf[parentId] = childrenOf[parentId] || [];\r\n        childrenOf[parentId].push(node);\r\n      } else {\r\n        if ((!node.children || node.children.length < 1) && node.expanded === true) {\r\n          node.unstableState = true;\r\n          node.expanded = false;\r\n        }\r\n        tree.push(node);\r\n      }\r\n    });\r\n    return tree;\r\n  }\r\n  /**\r\n   * \r\n   */\r\n  public build1(): TreeNode[] {\r\n    let minLayer;\r\n    // layer\r\n    this.allNodesData.forEach(node => {\r\n      const hierarchyInfo = this.getHierarchyInfo(node);\r\n      if (hierarchyInfo) {\r\n        const layer = hierarchyInfo['layer'];\r\n        if (!isNaN(layer)) {\r\n          if (minLayer === undefined) {\r\n            minLayer = layer;\r\n          } else if (layer < minLayer) {\r\n            minLayer = layer;\r\n          }\r\n        }\r\n      }\r\n    });\r\n    const topLayer = minLayer - 1;\r\n    this.buildNodes('', topLayer, this.allNodesData, this.allNodes);\r\n    return this.allNodes;\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  private buildNodes(fPath: string, fLayer: number, allNodesData: any[], treeNodes: TreeNode[]): void {\r\n    const childNodesData = this.getChildNodesData(fPath, fLayer);\r\n    childNodesData.forEach((nodeData: any) => {\r\n      // \r\n      const isNewNode = this.isNewNode(nodeData);\r\n      if (isNewNode === true) {\r\n        this.expandParentNode(nodeData);\r\n      }\r\n\r\n      // \r\n      const node = this.buildNode(nodeData);\r\n      treeNodes.push(node);\r\n      this.allNodesMap.set(nodeData[this.primaryKey], node);\r\n\r\n      // \r\n      const hierarchyInfo = this.getHierarchyInfo(nodeData);//nodeData[this.hierarchyInfoKey];\r\n      const currentLayer = hierarchyInfo['layer'];\r\n      const currentPath = hierarchyInfo['path'];\r\n      this.buildNodes(currentPath, currentLayer, allNodesData, node.children as TreeNode[]);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  private buildNode(nodeData: any): TreeNode & { unstableState?: boolean } {\r\n    const isLeaf = this.isLeaf(nodeData);\r\n    // \r\n    const shouldExpand = this.shouldExpand(nodeData);\r\n    // \r\n    const originExpandStatus = this.isExpanded(nodeData);\r\n    // \r\n    if (!originExpandStatus && shouldExpand) {\r\n      this.expandNode(nodeData);\r\n    }\r\n    const paginationInfo = this.buildPaginationInfo(nodeData);\r\n    const treeNode: TreeNode = {\r\n      data: Object.assign({}, nodeData),\r\n      children: [],\r\n      expanded: shouldExpand,\r\n      leaf: isLeaf\r\n    };\r\n    if (paginationInfo) {\r\n      treeNode.pagination = paginationInfo;\r\n    }\r\n    return treeNode;\r\n  }\r\n  /**\r\n   * \r\n   * @param nodeData nodeData\r\n   * @returns \r\n   */\r\n  private buildPaginationInfo(nodeData: any): { pageIndex: number, pageSize: number, total: number } | null {\r\n    let result = null;\r\n    if (this.frameContext) {\r\n      const id = this.getPrimary(nodeData);\r\n      // \r\n      const key = `_NODE_${id}_PAGINATION_INFO_`;\r\n      const pagination = this.frameContext.params.get(key) || null;\r\n      if (pagination && pagination.pageCount > 1) {\r\n        result = {\r\n          pageIndex: pagination.pageIndex,\r\n          pageSize: pagination.pageSize,\r\n          total: pagination.totalCount\r\n        };\r\n      }\r\n    }\r\n    return result;\r\n  }\r\n  /**\r\n   * \r\n   * @param nodeData nodeData\r\n   */\r\n  private shouldExpand(nodeData: any): boolean {\r\n    const [layer, isLeaf] = [this.getNodeLayer(nodeData), this.isLeaf(nodeData)];\r\n    // \r\n    if (isLeaf) {\r\n      return false;\r\n    }\r\n    let expanded = this.isExpanded(nodeData);\r\n    if (!expanded) {\r\n      const id = this.getPrimary(nodeData);\r\n      if (this.nodesWaitExpand.findIndex(node => node && node.id === id) > -1) {\r\n        return false;\r\n      }\r\n      if (this.nodesShouldExpand.findIndex(nodeId => nodeId === id) > -1) {\r\n        return true;\r\n      }\r\n      if (this.expandLevel === -1) {\r\n        // -1 \r\n        expanded = false;\r\n      } else if (this.expandLevel === 0) {\r\n        // 0 \r\n        expanded = true;\r\n      } else {\r\n        // \r\n        expanded = layer <= this.expandLevel;\r\n        // \r\n        const oldTreeNode = this.getOldNode(nodeData);\r\n        if (oldTreeNode && !oldTreeNode.expanded) {\r\n          expanded = false;\r\n        }\r\n      }\r\n    }\r\n    return expanded;\r\n  }\r\n  /**\r\n   * \r\n   * @description buildNode\r\n   * @param nodeData nodeData\r\n   */\r\n  private expandNode(nodeData: any) {\r\n    const [path, layer] = [this.getNodePath(nodeData), this.getNodeLayer(nodeData)];\r\n    const childs = this.getChildNodesData(path, layer);\r\n\r\n    // \r\n    if (!childs || childs.length < 1) {\r\n      // \r\n      const id = this.getPrimary(nodeData);\r\n      if (this.nodesWaitExpand.findIndex(node => node && node.id === id) < 0) {\r\n        this.nodesWaitExpand.push({ id, expanded: false });\r\n      }\r\n    }\r\n  }\r\n  /**\r\n   * \r\n   */\r\n  private onTreeLoadComplete() {\r\n    const index = this.nodesWaitExpand.findIndex(node => !node.expanded);\r\n    const nodeData = this.nodesWaitExpand[index] || {};\r\n    const { id } = nodeData;\r\n    if (id) {\r\n      const rowNode = this.component.findRowNode(id);\r\n      if (rowNode) {\r\n        nodeData.expanded = true;\r\n        // if (nodeData && nodeData.node && !nodeData.node.expanded) {\r\n        //   return;\r\n        // }\r\n        this.component.expandNode(id);\r\n      }\r\n    }\r\n  }\r\n  /**\r\n   * \r\n   * @param nodeData nodeData\r\n   */\r\n  private getPrimary(nodeData: any) {\r\n    return nodeData[this.primaryKey];\r\n  }\r\n  // #region \r\n\r\n  /**\r\n   * \r\n   */\r\n  private getChildNodesData(fPath: string, fLayer: number): any[] {\r\n    const childNodesData = [];\r\n    this.allNodesData.forEach((nodeData: any) => {\r\n\r\n      // @todohierarchyInfo\r\n      const hierarchyInfo = this.getHierarchyInfo(nodeData);//this.getValue(nodeData, this.hierarchyInfoKey); /// nodeData[this.hierarchyInfoKey];\r\n      if (!hierarchyInfo) {\r\n        return;\r\n      }\r\n\r\n      // \r\n      const currentLayer = hierarchyInfo['layer'];\r\n      const currentPath = hierarchyInfo['path'];\r\n      if ((currentLayer === fLayer + 1) && currentPath && currentPath.startsWith(fPath)) {\r\n        childNodesData.push(nodeData);\r\n      }\r\n    });\r\n    return childNodesData;\r\n  }\r\n\r\n  private getHierarchyInfo(nodeData: any): PathHierarchyInfo {\r\n    return this.getValue(nodeData, this.hierarchyInfoKey);//nodeData[this.hierarchyInfoKey];\r\n  }\r\n\r\n  private initLevelGroup() {\r\n    this.levelGroup = {};\r\n    this.allNodesData.forEach((nodeData) => {\r\n      const hierarchyInfo = this.getHierarchyInfo(nodeData);\r\n      const key = `level${hierarchyInfo.layer}`;\r\n      if (this.levelGroup[key]) {\r\n        this.levelGroup[key].push(nodeData);\r\n      } else {\r\n        this.levelGroup[key] = [nodeData];\r\n      }\r\n    });\r\n  }\r\n  private getParentId(node: any) {\r\n    const hierarchyInfo = this.getHierarchyInfo(node);\r\n    const parentLevelGroup = this.levelGroup[this.getLevelGroupKey(hierarchyInfo.layer - 1)] || [];\r\n    const parent = parentLevelGroup.find(nodeData => {\r\n      const currentHierarchyInfo = this.getHierarchyInfo(nodeData);\r\n      if (currentHierarchyInfo.isDetail === true) {\r\n        return false;\r\n      }\r\n      return hierarchyInfo.path.startsWith(currentHierarchyInfo.path);\r\n    });\r\n    if (parent) {\r\n      return parent.id;\r\n    } else {\r\n      return null;\r\n    }\r\n  }\r\n  private getLevelGroupKey(level: any) {\r\n    return `level${level}`;\r\n  }\r\n  /**\r\n   * \r\n   * @param target target\r\n   * @param path \r\n   */\r\n  private getValue(target: any, path: string) {\r\n    if (path.indexOf('/') === -1) {\r\n      return target[path];\r\n    }\r\n    const paths: any = path.split('/').filter(p => p);\r\n    if (paths.length < 1) {\r\n      return target;\r\n    }\r\n    return paths.reduce((result, path) => {\r\n      return result && result[path];\r\n    }, target);\r\n  }\r\n  /**\r\n   * \r\n   * @param nodeData nodeData\r\n   */\r\n  private getNodeLayer(nodeData: any) {\r\n    const hierarchyInfo = this.getHierarchyInfo(nodeData);\r\n    return hierarchyInfo['layer'];\r\n  }\r\n  /**\r\n   * \r\n   * @param nodeData nodeData\r\n   */\r\n  private getNodePath(nodeData: any) {\r\n    const hierarchyInfo = this.getHierarchyInfo(nodeData);\r\n    return hierarchyInfo['path'];\r\n  }\r\n  /**\r\n   * \r\n   */\r\n  private isExpanded(newData: any): boolean {\r\n    const oldTreeNode = this.getOldNode(newData);\r\n    return oldTreeNode ? oldTreeNode.expanded : undefined;\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @todoisDetailisDetail\r\n   */\r\n  private isLeaf(nodeData: any): boolean {\r\n    const hierarchyInfo = this.getHierarchyInfo(nodeData);// nodeData[this.hierarchyInfoKey];\r\n    const isDetail = hierarchyInfo['isDetail'];\r\n    return isDetail;\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @todo\r\n   * @summary\r\n   * 1\r\n   * 2oldNode\r\n   */\r\n  private isNewNode(nodeData: any): boolean {\r\n    if (this.allOldNodesMap.size === 0) {\r\n      return false;\r\n    }\r\n    const oldTreeNode = this.getOldNode(nodeData);\r\n    return oldTreeNode ? false : true;\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  private expandParentNode(nodeData: any): void {\r\n    const parentTreeNode = this.getParentNode(nodeData);\r\n    if (!parentTreeNode) {\r\n      return;\r\n    }\r\n    parentTreeNode.leaf = false;\r\n    parentTreeNode.expanded = true;\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  private getParentNode(nodeData: any): TreeNode {\r\n    const hierarchyInfo = this.getHierarchyInfo(nodeData);//nodeData[this.hierarchyInfoKey];\r\n    const layer = hierarchyInfo['layer'];\r\n    const path = hierarchyInfo['path'];\r\n\r\n    const allNodes = Array.from(this.allNodesMap.values());\r\n    const parentNode = allNodes.find((currentNode: TreeNode) => {\r\n      const currentLayer = this.getValue(currentNode.data, this.hierarchyInfoKey)['layer'];//currentNode.data[this.hierarchyInfoKey]['layer'];\r\n      const currentPath = this.getValue(currentNode.data, this.hierarchyInfoKey)['path'];//  currentNode.data[this.hierarchyInfoKey]['path'];\r\n      if ((layer === currentLayer + 1) && path.startsWith(currentPath) === true) {\r\n        return true;\r\n      }\r\n      return false;\r\n    });\r\n    return parentNode;\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  private getOldNode(nodeData: any): TreeNode {\r\n    const id = nodeData[this.primaryKey];\r\n    return this.allOldNodesMap.get(id);\r\n  }\r\n\r\n  /**\r\n   * TreeNodesMap\r\n   */\r\n  private buildNodesDataMap(treeNodes: TreeNode[]): void {\r\n    treeNodes.forEach((treeNode: TreeNode) => {\r\n      this.allOldNodesMap.set(treeNode.data[this.primaryKey], treeNode);\r\n      if (treeNode.children) {\r\n        this.buildNodesDataMap(treeNode.children);\r\n      }\r\n    });\r\n  }\r\n\r\n  // #endregion\r\n}\r\n\r\nexport { PathTreeNodeBuilder };\r\n","/*\r\n * @Author: aalizzwell \r\n * @Date: 2019-05-31 09:48:10 \r\n * @Last Modified by: aalizzwell\r\n * @Last Modified time: 2019-06-24 17:00:58\r\n */\r\n\r\nimport { FrameContext } from '@farris/devkit';\r\nimport { TreeNode, TreeTableComponent } from '@farris/ui-treetable';\r\nimport { ParentHierarchyInfo } from './types';\r\n// tslint:disable: no-string-literal max-line-length\r\n/**\r\n * \r\n * @summary\r\n * BindingDataTreeTable\r\n */\r\nclass ParentTreeNodeBuilder {\r\n  private frameContext: FrameContext;\r\n  /**\r\n   * \r\n   */\r\n  constructor(allNodesData: any[], oldTreeNodes: TreeNode[], primaryKey: string, hierarchyInfoKey: string, context?: any) {\r\n    this.primaryKey = primaryKey;\r\n    this.hierarchyInfoKey = hierarchyInfoKey;\r\n    this.allNodes = [];\r\n    this.allNodesData = allNodesData;\r\n    this.context = context || {};\r\n    this.nodesWaitExpand = [];\r\n    this.nodesShouldExpand = context && context.nodesShouldExpand || [];\r\n    this.frameContext = context && context.frameContext || null;\r\n    this.addTreeLoadCompleteListener(this.onTreeLoadComplete.bind(this));\r\n\r\n    this.allNodesMap = new Map<string, TreeNode>();\r\n    this.allOldNodesMap = new Map<string, TreeNode>();\r\n    this.buildNodesDataMap(oldTreeNodes);\r\n  }\r\n  /**\r\n   * \r\n   * @description -1\r\n   */\r\n  private get expandLevel() {\r\n    return this.context && this.context.hasOwnProperty('expandLevel') ? this.context['expandLevel'] : -1;\r\n  }\r\n  private get component(): TreeTableComponent {\r\n    return this.context && this.context['component'];\r\n  }\r\n  private get addTreeLoadCompleteListener() {\r\n    return this.context && this.context['addTreeLoadCompleteListener'] || function (args: any) { };\r\n  }\r\n  /**\r\n   * \r\n   */\r\n  private nodesShouldExpand: string[];\r\n\r\n  /**\r\n   * \r\n   * @description \r\n   * ```\r\n   * {id:'xxx',expanded:false}\r\n   * ```\r\n   */\r\n  private nodesWaitExpand: any[] = [];\r\n\r\n  /**\r\n   * \r\n   */\r\n  private primaryKey: string;\r\n\r\n  /**\r\n   * \r\n   */\r\n  private hierarchyInfoKey: string;\r\n\r\n  /**\r\n   * \r\n   */\r\n  private allNodesData: any[];\r\n\r\n  /**\r\n   * \r\n   */\r\n  private allNodes: TreeNode[];\r\n\r\n  /**\r\n   * Map\r\n   */\r\n  private allNodesMap: Map<string, TreeNode>;\r\n\r\n  /**\r\n   * Map\r\n   */\r\n  private allOldNodesMap: Map<string, TreeNode>;\r\n\r\n  /**\r\n   * \r\n   */\r\n  private context: any;\r\n\r\n  public updateTreeNode(allNodesData: any, data: any) {\r\n    this.allNodesData = allNodesData;\r\n    this.buildNodesDataMap(data);\r\n  }\r\n  public build(): TreeNode[] {\r\n    let tree: TreeNode[] = [];\r\n    const childrenOf = {};\r\n    const parents = {};\r\n    const nodes = {};\r\n    this.allNodesData.forEach(item => {\r\n      const id = item.id;\r\n      const parentId = this.getHierarchyInfo(item).parentElement;\r\n\r\n      // item.parentId = parentId;\r\n      // \r\n      const isNewNode = this.isNewNode(item);\r\n      if (isNewNode === true) {\r\n        this.expandParentNode(item);\r\n      }\r\n      // \r\n      const node = this.buildNode(item);\r\n      nodes[id] = node;\r\n      childrenOf[id] = childrenOf[id] || [];\r\n      node.children = childrenOf[id];\r\n\r\n      parents[parentId] = parents[parentId] || [];\r\n      parents[parentId].push(node);\r\n      this.allNodesMap.set(item[this.primaryKey], node);\r\n      if (parentId) {\r\n        if (nodes[parentId] && nodes[parentId].unstableState === true) {\r\n          nodes[parentId].expanded = true;\r\n          nodes[parentId].unstableState = false;\r\n        }\r\n        childrenOf[parentId] = childrenOf[parentId] || [];\r\n        childrenOf[parentId].push(node);\r\n      } else {\r\n        if ((!node.children || node.children.length < 1) && node.expanded === true) {\r\n          node.unstableState = true;\r\n          node.expanded = false;\r\n        }\r\n        tree.push(node);\r\n      }\r\n    });\r\n    // parentId\r\n    if ((!tree || tree.length < 1) && this.allNodesData && this.allNodesData.length > 0) {\r\n      const parentIds = Object.keys(parents);\r\n      parentIds.forEach(parentId => {\r\n        if (!this.allNodesData.find(item => item.id === parentId)) {\r\n          tree = tree.concat(parents[parentId]);\r\n        }\r\n      });\r\n    }\r\n    return tree;\r\n  }\r\n  /**\r\n   * \r\n   */\r\n  public build1(): TreeNode[] {\r\n    let minLayer;\r\n    // layer\r\n    this.allNodesData.forEach(node => {\r\n      const hierarchyInfo = this.getHierarchyInfo(node);\r\n      if (hierarchyInfo) {\r\n        const layer = hierarchyInfo['layer'];\r\n        if (!isNaN(layer)) {\r\n          if (minLayer === undefined) {\r\n            minLayer = layer;\r\n          } else if (layer < minLayer) {\r\n            minLayer = layer;\r\n          }\r\n        }\r\n      }\r\n    });\r\n    const topLayer = minLayer - 1;\r\n    this.buildNodes('', topLayer, this.allNodesData, this.allNodes);\r\n    return this.allNodes;\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  private buildNodes(fParentElement: string, fLayer: number, allNodesData: any[], treeNodes: TreeNode[]): void {\r\n    const childNodesData = this.getChildNodesData(fParentElement, fLayer);\r\n    childNodesData.forEach((nodeData: any) => {\r\n\r\n      // \r\n      const isNewNode = this.isNewNode(nodeData);\r\n      if (isNewNode === true) {\r\n        this.expandParentNode(nodeData);\r\n      }\r\n\r\n      // \r\n      const node = this.buildNode(nodeData);\r\n      treeNodes.push(node);\r\n      this.allNodesMap.set(nodeData[this.primaryKey], node);\r\n\r\n      // \r\n      const hierarchyInfo = this.getHierarchyInfo(nodeData); //nodeData[this.hierarchyInfoKey];\r\n      const currentLayer = hierarchyInfo['layer'];\r\n      const currentId = nodeData[this.primaryKey];\r\n      this.buildNodes(currentId, currentLayer, allNodesData, node.children as TreeNode[]);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  private buildNode(nodeData: any): TreeNode & { unstableState?: boolean } {\r\n    const isLeaf = this.isLeaf(nodeData);\r\n    // \r\n    const shouldExpand = this.shouldExpand(nodeData);\r\n    // \r\n    const originExpandStatus = this.isExpanded(nodeData);\r\n    // \r\n    if (!originExpandStatus && shouldExpand) {\r\n      this.expandNode(nodeData);\r\n    }\r\n    const paginationInfo = this.buildPaginationInfo(nodeData);\r\n    const treeNode: TreeNode = {\r\n      data: Object.assign({}, nodeData),\r\n      children: [],\r\n      expanded: shouldExpand,\r\n      leaf: isLeaf\r\n    };\r\n    if (paginationInfo) {\r\n      treeNode.pagination = paginationInfo;\r\n    }\r\n    return treeNode;\r\n  }\r\n  /**\r\n   * \r\n   * @param nodeData nodeData\r\n   * @returns \r\n   */\r\n  private buildPaginationInfo(nodeData: any): { pageIndex: number, pageSize: number, total: number } | null {\r\n    let result = null;\r\n    if (this.frameContext) {\r\n      const id = this.getPrimary(nodeData);\r\n      // \r\n      const key = `_NODE_${id}_PAGINATION_INFO_`;\r\n      const pagination = this.frameContext.params.get(key) || null;\r\n      if (pagination && pagination.pageCount > 1) {\r\n        result = {\r\n          pageIndex: pagination.pageIndex,\r\n          pageSize: pagination.pageSize,\r\n          total: pagination.totalCount\r\n        };\r\n      }\r\n    }\r\n    return result;\r\n  }\r\n  /**\r\n   * \r\n   * @param nodeData nodeData\r\n   */\r\n  private shouldExpand(nodeData: any) {\r\n    const [isLeaf, layer] = [this.isLeaf(nodeData), this.getNodeLayer(nodeData)];\r\n    // \r\n    if (isLeaf) {\r\n      return false;\r\n    }\r\n    let expanded = this.isExpanded(nodeData);\r\n    if (!expanded) {\r\n      const id = this.getPrimary(nodeData);\r\n      if (this.nodesWaitExpand.findIndex(node => node && node.id === id) > -1) {\r\n        return false;\r\n      }\r\n      if (this.nodesShouldExpand.findIndex(nodeId => nodeId === id) > -1) {\r\n        return true;\r\n      }\r\n      if (this.expandLevel === -1) {\r\n        // -1 \r\n        expanded = false;\r\n      } else if (this.expandLevel === 0) {\r\n        // 0 \r\n        expanded = true;\r\n      } else {\r\n        // \r\n        expanded = layer <= this.expandLevel;\r\n        // \r\n        const oldTreeNode = this.getOldNode(nodeData);\r\n        if (oldTreeNode && !oldTreeNode.expanded) {\r\n          expanded = false;\r\n        }\r\n      }\r\n    }\r\n    return expanded;\r\n  }\r\n  /**\r\n   * \r\n   * @description buildNode\r\n   * @param nodeData nodeData\r\n   */\r\n  private expandNode(nodeData: any) {\r\n    const [element, layer] = [nodeData[this.primaryKey], this.getNodeLayer(nodeData)];\r\n    const childs = this.getChildNodesData(element, layer);\r\n\r\n    // \r\n    if (!childs || childs.length < 1) {\r\n      // ,\r\n      const id = this.getPrimary(nodeData);\r\n      if (this.nodesWaitExpand.findIndex(node => node && node.id === id) < 0) {\r\n        this.nodesWaitExpand.push({ id, expanded: false });\r\n      }\r\n    }\r\n  }\r\n  /**\r\n   * \r\n   */\r\n  private onTreeLoadComplete() {\r\n    const index = this.nodesWaitExpand.findIndex(node => !node.expanded);\r\n    const nodeData = this.nodesWaitExpand[index] || {};\r\n    const { id } = nodeData;\r\n    if (id) {\r\n      const rowNode = this.component.findRowNode(id);\r\n      if (rowNode) {\r\n        nodeData.expanded = true;\r\n        // if (nodeData && nodeData.node && !nodeData.node.expanded) {\r\n        //   return;\r\n        // }\r\n        this.component.expandNode(id);\r\n      }\r\n    }\r\n  }\r\n  /**\r\n   * \r\n   * @param nodeData nodeData\r\n   */\r\n  private getPrimary(nodeData: any) {\r\n    return nodeData[this.primaryKey];\r\n  }\r\n  // #region \r\n\r\n  /**\r\n   * \r\n   */\r\n  private getChildNodesData(fParentElement: string, fLayer: number): any[] {\r\n    const childNodesData = [];\r\n    this.allNodesData.forEach((nodeData: any) => {\r\n\r\n      // @todohierarchyInfo \r\n      const hierarchyInfo = this.getHierarchyInfo(nodeData); //nodeData[this.hierarchyInfoKey];\r\n      if (!hierarchyInfo) {\r\n        return;\r\n      }\r\n\r\n      // \r\n      const currentLayer = hierarchyInfo['layer'];\r\n      const currentParentElement = hierarchyInfo['parentElement'];\r\n      if ((currentLayer === fLayer + 1) && (currentParentElement === fParentElement || (!currentParentElement && fParentElement === ''))) {\r\n        childNodesData.push(nodeData);\r\n      }\r\n    });\r\n    return childNodesData;\r\n  }\r\n  private getHierarchyInfo(nodeData: any): ParentHierarchyInfo {\r\n    return this.getValue(nodeData, this.hierarchyInfoKey);//nodeData[this.hierarchyInfoKey];\r\n  }\r\n  private getValue(target: any, path: string) {\r\n    if (path.indexOf('/') === -1) {\r\n      return target[path];\r\n    }\r\n    const paths: any = path.split('/').filter(p => p);\r\n    return paths.reduce((result, path) => {\r\n      return result && result[path];\r\n    }, target);\r\n  }\r\n  /**\r\n   * \r\n   * @param nodeData nodeData\r\n   */\r\n  private getNodeLayer(nodeData: any) {\r\n    const hierarchyInfo = this.getHierarchyInfo(nodeData);\r\n    return hierarchyInfo['layer'];\r\n  }\r\n  /**\r\n   * \r\n   * @param nodeData nodeData\r\n   */\r\n  private getNodeParentElement(nodeData: any) {\r\n    const hierarchyInfo = this.getHierarchyInfo(nodeData);\r\n    return hierarchyInfo['parentElement'];\r\n  }\r\n  /**\r\n   * \r\n   */\r\n  private isExpanded(newData: any): boolean {\r\n    const oldTreeNode = this.getOldNode(newData);\r\n    return oldTreeNode ? oldTreeNode.expanded : undefined;\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @todoisDetail\r\n   */\r\n  private isLeaf(nodeData: any): boolean {\r\n    const hierarchyInfo = this.getHierarchyInfo(nodeData);//nodeData[this.hierarchyInfoKey];\r\n    const isDetail = hierarchyInfo['isDetail'];\r\n    return isDetail;\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @todo\r\n   * @summary\r\n   * 1\r\n   * 2oldNode\r\n   */\r\n  private isNewNode(nodeData: any): boolean {\r\n    if (this.allOldNodesMap.size === 0) {\r\n      return false;\r\n    }\r\n    const oldTreeNode = this.getOldNode(nodeData);\r\n    return oldTreeNode ? false : true;\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  private expandParentNode(nodeData: any): void {\r\n    const parentTreeNode = this.getParentNode(nodeData);\r\n    if (!parentTreeNode) {\r\n      return;\r\n    }\r\n    parentTreeNode.leaf = false;\r\n    parentTreeNode.expanded = true;\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  private getParentNode(nodeData: any): TreeNode {\r\n    const hierarchyInfo = this.getHierarchyInfo(nodeData);//nodeData[this.hierarchyInfoKey];\r\n    const layer = hierarchyInfo['layer'];\r\n    const parentElement = hierarchyInfo['parentElement'];\r\n\r\n    const allNodes = Array.from(this.allNodesMap.values());\r\n    const parentNode = allNodes.find((node: TreeNode) => {\r\n      const currentLayer = this.getValue(node.data, this.hierarchyInfoKey)['layer']; //node.data[this.hierarchyInfoKey]['layer'];\r\n      const currentId = node.data[this.primaryKey];\r\n      return currentId === parentElement && layer === (currentLayer + 1);\r\n    });\r\n\r\n    return parentNode;\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  private getOldNode(nodeData: any): TreeNode {\r\n    const id = nodeData[this.primaryKey];\r\n    return this.allOldNodesMap.get(id);\r\n  }\r\n\r\n  /**\r\n   * TreeNodesMap\r\n   */\r\n  private buildNodesDataMap(treeNodes: TreeNode[]): void {\r\n    treeNodes.forEach((treeNode: TreeNode) => {\r\n      this.allOldNodesMap.set(treeNode.data[this.primaryKey], treeNode);\r\n      if (treeNode.children) {\r\n        this.buildNodesDataMap(treeNode.children);\r\n      }\r\n    });\r\n  }\r\n\r\n  // #endregion\r\n}\r\n\r\nexport { ParentTreeNodeBuilder };\r\n\r\n","/*\r\n * @Author: aalizzwell \r\n * @Date: 2019-05-30 18:57:34 \r\n * @Last Modified by:   aalizzwell \r\n * @Last Modified time: 2019-05-30 18:57:34 \r\n */\r\nimport { PathTreeNodeBuilder } from './path_tree_node_builder';\r\nimport { ParentTreeNodeBuilder } from './parent_tree_node_builder';\r\nimport { Type } from '@angular/core';\r\n\r\nexport class TreeNodeBuilderFactory {\r\n    static getBuilder(hierarchyInfo: { [propName: string]: any }): Type<PathTreeNodeBuilder | ParentTreeNodeBuilder> {\r\n        let builder: Type<PathTreeNodeBuilder | ParentTreeNodeBuilder> = PathTreeNodeBuilder;\r\n        if (hierarchyInfo.hasOwnProperty(\"path\")) {\r\n            builder = PathTreeNodeBuilder;\r\n        } else if (hierarchyInfo.hasOwnProperty(\"parentElement\")) {\r\n            builder = ParentTreeNodeBuilder;\r\n        }\r\n\r\n        return builder;\r\n    }\r\n}","/*\r\n * @Author: aalizzwell \r\n * @Date: 2020-02-27 11:33:41 \r\n * @Last Modified by: aalizzwell\r\n * @Last Modified time: 2020-02-27 11:34:16\r\n */\r\n// tslint:disable: no-string-literal\r\n\r\nimport { Directive, OnInit, OnChanges, SimpleChanges, Input, HostListener, Type, Output, EventEmitter } from '@angular/core';\r\nimport { BindingData, BindingList, FrameContext, Change, ChangeType, ComponentType } from '@farris/devkit';\r\nimport { TreeTableComponent, TreeNode } from '@farris/ui-treetable';\r\nimport { Subject } from 'rxjs';\r\nimport { debounceTime } from 'rxjs/operators';\r\nimport { FarrisTreetableFormatService } from '../format/index';\r\nimport { TreeNodeBuilderFactory } from './tree_table_node_builder/tree_node_builder_factory';\r\n\r\n/**\r\n * \r\n */\r\n@Directive({\r\n  selector: '[farrisTreeTableBinding]'\r\n})\r\nclass FarrisTreeTableBindingDirective implements OnInit, OnChanges {\r\n  /**\r\n   * \r\n   */\r\n  private storage: any;\r\n  private renderSubject: Subject<any> = new Subject<any>();\r\n  private builder: Type<any>;\r\n  private treeNodesBuilder: any;\r\n  /**\r\n   * key\r\n   */\r\n  // tslint:disable-next-line: no-input-rename\r\n  @Input('farrisHierarchyInfoKey')\r\n  public hierarchyInfoKey: string;\r\n\r\n  /*  */\r\n  @Input()\r\n  rowClassName: (context: any) => any;\r\n\r\n  /*  */\r\n  @Input()\r\n  cellClassName: (data: any, field: any) => any;\r\n  /**\r\n   * \r\n   */\r\n  // @Input('enableNodePagination')\r\n  // public enableNodePagination: boolean;\r\n  /**\r\n   * \r\n   */\r\n  @Input('nodePageSize')\r\n  public nodePageSize: number = 100;\r\n  /**\r\n   * \r\n   */\r\n  private get bindingData(): BindingData {\r\n    return this.frameContext.bindingData;\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  private get bindingList(): BindingList {\r\n\r\n    // @todobindingPath\r\n    return this.bindingData.list;\r\n  }\r\n\r\n\r\n  /*  */\r\n  @Output()\r\n  rowClass: EventEmitter<any> = new EventEmitter<any>();\r\n\r\n  /*  */\r\n  @Output()\r\n  cellClass: EventEmitter<any> = new EventEmitter<any>();\r\n\r\n  private _PROP: any = null;\r\n  private listeners: any[];\r\n  private get prop() {\r\n    return this._PROP;\r\n  }\r\n  private set prop(value) {\r\n    this._PROP = value;\r\n  }\r\n  /**\r\n   * vm\r\n   */\r\n  private get viewModel() {\r\n    return this.frameContext.viewModel;\r\n  }\r\n  /**\r\n   * \r\n   */\r\n  constructor(\r\n    private treeTable: TreeTableComponent,\r\n    private treetableFormatSer: FarrisTreetableFormatService,\r\n    private frameContext: FrameContext\r\n  ) {\r\n    this.listeners = [];\r\n    this.storage = [];\r\n    this.viewModel.uiState.setPropertyValue('ids', this.treeTable.checkValues);\r\n    this.renderSubject.pipe(\r\n      debounceTime(500)\r\n    ).subscribe(() => {\r\n      this.bindData();\r\n    });\r\n\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  ngOnInit() {\r\n    // root-componentapp-context\r\n    const virtualRootFrameContext = this.frameContext.getVirtualRootFrameContext();\r\n    virtualRootFrameContext.setParam('hierarchyInfoKey', this.hierarchyInfoKey);\r\n    this.bindData();\r\n    this.bindingData.changes.subscribe((change: Change) => {\r\n      if (change && (change.type === ChangeType.ValueChanged || change.type === ChangeType.PaginationInfoChange)) {\r\n        this.renderSubject.next(change);\r\n      } else {\r\n        this.bindData();\r\n      }\r\n      // \r\n      const currentId = this.bindingList.currentId;\r\n      if (!this.frameContext.bindingData.rowSelectedEventSuspend && currentId) {\r\n        this.setSelectedIdToTree(this.bindingList.currentId);\r\n      }\r\n      this.updateCheckedRows(change);\r\n    });\r\n\r\n    //   \r\n    this.treetableFormatSer.setFormat(this.treeTable);\r\n\r\n    /*  */\r\n    this.rowClass.emit(this.treeTable);\r\n\r\n    /*    */\r\n    this.cellClass.emit(this.treeTable);\r\n    this.setComponentRef();\r\n    this.setNodePaginationInfo();\r\n    this.registerEvent();\r\n    if (this.frameContext && this.frameContext.frameComponent) {\r\n      this.frameContext.frameComponent.componentType = ComponentType.farrisTreeTalbeComponent;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  ngOnChanges(changes: SimpleChanges) {\r\n  }\r\n  private registerEvent() {\r\n    this.treeTable.columnSorted.subscribe((event: { sortName: string, sortOrder: string }) => {\r\n      const { sortName = null, sortOrder = null } = event;\r\n      const remoteSort = this.treeTable.remoteSort;\r\n      if (remoteSort === false) {\r\n        if (sortName && sortOrder) {\r\n          this.bindingList.sortBy(sortName, sortOrder);\r\n        }\r\n      }\r\n      this.bindData();\r\n    });\r\n  }\r\n  /**\r\n   * \r\n   */\r\n  private setComponentRef() {\r\n    const appContext = this.viewModel && this.viewModel.frameContext && this.viewModel.frameContext.getFormAppContext();\r\n    const frameId = this.viewModel && this.viewModel.frameContext && this.viewModel.frameContext.frameId;\r\n    const id = this.treeTable && this.treeTable.el.nativeElement.id || null;\r\n    // frameIdtreetableid\r\n    if (!frameId || !id) {\r\n      return;\r\n    }\r\n    const map = appContext && appContext.componentRefs && appContext.componentRefs.get(frameId) || new Map<string, any>();\r\n    appContext && appContext.componentRefs && appContext.componentRefs.set(frameId, map.set(id, this.treeTable));\r\n  }\r\n\r\n  private setNodePaginationInfo() {\r\n    if (this.frameContext) {\r\n      const enableNodePagination = this.treeTable.paginationForChildren || false;//this.enableNodePagination || false;\r\n      this.frameContext.params.set('enableNodePagination', enableNodePagination);\r\n      const nodePageSize = this.nodePageSize || 0;\r\n      this.frameContext.params.set('nodePageSize', nodePageSize);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  private bindData() {\r\n    const oldTreeNodes = this.treeTable.data;\r\n    const treeNodesData = this.bindingList.toJSON({ ignoreMultiLangInput: true });\r\n    // if (!this.shouldComponentUpdate(treeNodesData)) {\r\n    //   return;\r\n    // }\r\n    this.prop = treeNodesData;\r\n\r\n    let treeNodes: TreeNode[] = [];\r\n    if (!!treeNodesData && treeNodesData.length > 0) {\r\n      const hierarchyInfo = treeNodesData[0][this.hierarchyInfoKey];\r\n      let builder: Type<any> = this.builder;\r\n      if (!builder) {\r\n        this.builder = TreeNodeBuilderFactory.getBuilder(hierarchyInfo);\r\n        builder = this.builder;\r\n      }\r\n      // builder\r\n      if (builder == null) {\r\n        throw new Error('TreeTable builder is null!');\r\n      }\r\n      let expandLevel = -1;\r\n      const treeExpandLevel = this.treeTable['expandLevel'];\r\n      if (typeof treeExpandLevel !== 'undefined') {\r\n        expandLevel = treeExpandLevel;\r\n      }\r\n      const virtualRootFrameContext = this.frameContext.getVirtualRootFrameContext();\r\n      const nodesShouldExpand = (virtualRootFrameContext.params.get('_DEVKIT_expandRowIds') || '').split(',') || [];\r\n      const context = {\r\n        expandLevel,\r\n        addTreeLoadCompleteListener: this.addTreeLoadCompleteListener.bind(this),\r\n        component: this.treeTable,\r\n        storage: this.storage,\r\n        nodesShouldExpand: nodesShouldExpand,\r\n        frameContext: this.frameContext,\r\n      };\r\n      //if (!this.treeNodesBuilder) {\r\n      this.treeNodesBuilder = new builder(\r\n        treeNodesData, oldTreeNodes,\r\n        this.bindingList.primaryKey, this.hierarchyInfoKey, context\r\n      );\r\n      //}\r\n      // this.treeNodesBuilder.updateTreeNode(treeNodesData, oldTreeNodes);\r\n      treeNodes = this.treeNodesBuilder.build();\r\n    }\r\n    this.treeTable.data = treeNodes;\r\n    // \r\n    this.updatePageInfo(this.treeTable);\r\n    this.onTreeLoadComplete();\r\n  }\r\n  private onTreeLoadComplete() {\r\n    if (this.listeners && this.listeners.length > 0) {\r\n      this.listeners.forEach(listener => {\r\n        listener();\r\n      });\r\n    }\r\n  }\r\n  private addTreeLoadCompleteListener(listener: any) {\r\n    this.listeners.push(listener);\r\n  }\r\n  private shouldComponentUpdate(newProp: any) {\r\n    if (JSON.stringify(this.prop) === JSON.stringify(newProp)) {\r\n      return false;\r\n    }\r\n    return true;\r\n  }\r\n  /**\r\n   * id\r\n   */\r\n  private getSelectedIdFromTree(): string {\r\n    const selectedRow = this.treeTable.selectedRow;\r\n    return selectedRow ? selectedRow.data['id'] : null;\r\n  }\r\n\r\n  /**\r\n   * TreeTable\r\n   */\r\n  private setSelectedIdToTree(selectedId: string): void {\r\n    if (!selectedId) {\r\n      return;\r\n    }\r\n    // currentIdselectedId\r\n    const oldSelectedId = this.getSelectedIdFromTree();\r\n    const nodePageChanged = this.frameContext.params.get('_NODE_PAGE_CHANGED_') || false;\r\n    if (!oldSelectedId && nodePageChanged) {\r\n      this.frameContext.params.delete('_NODE_PAGE_CHANGED_');\r\n      return;\r\n    }\r\n    if (oldSelectedId !== selectedId) {\r\n      this.treeTable.clearSelections();\r\n      this.treeTable.selectNode(selectedId);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * BindingListCurrentId\r\n   */\r\n  private setCurrentIdToBindingList(selectedId: string): void {\r\n    const oldCurrentId = this.bindingData.list.currentId;\r\n    // ids\r\n    if (!this.treeTable.multiSelect) {\r\n      this.setChecks(selectedId);\r\n      this.setCheckedRows([selectedId]);\r\n    }\r\n    if (oldCurrentId === selectedId) {\r\n      return;\r\n    }\r\n    this.bindingData.list.setCurrentId(selectedId, true);\r\n  }\r\n  private updateCheckedRows(changes: Change) {\r\n    if (changes.type === ChangeType.Load) {\r\n      this.setCheckedRows();\r\n    } else if (changes.type === ChangeType.ValueChanged || changes.type === ChangeType.Remove) {\r\n      const ids = this.getChecks();\r\n      if (changes.id && ids.includes(changes.id)) {\r\n        this.setCheckedRows();\r\n      }\r\n    }\r\n  }\r\n  /**\r\n   * \r\n   */\r\n  protected setCheckedRows(ids?: string[]) {\r\n    if (typeof ids === 'undefined') {\r\n      ids = this.viewModel.uiState['ids'] || [];\r\n    }\r\n    if (!Array.isArray(ids)) {\r\n      return;\r\n    }\r\n    const list = this.bindingList.toJSON();\r\n    const rows: Map<string, any> = this.viewModel.uiState['rows'] || new Map<string, any>();\r\n\r\n    const result = new Map<string, any>();\r\n    ids.forEach((id: any) => {\r\n      const item = list.find(item => item[this.bindingList.primaryKey] === id);\r\n      const otherPageItem = rows.get(id);\r\n      if (item) {\r\n        result.set(id, item);\r\n      } else if (otherPageItem) {\r\n        result.set(id, otherPageItem);\r\n      }\r\n    });\r\n    this.viewModel.uiState.setPropertyValue('rows', result);\r\n  }\r\n  /**\r\n   * ids\r\n   * @param idOrIds id or ids\r\n   */\r\n  protected setChecks(idOrIds: string | string[]) {\r\n    if (typeof idOrIds === 'string') {\r\n      idOrIds = idOrIds.split(',').filter(p => p);\r\n    }\r\n    this.viewModel.uiState.setPropertyValue('ids', idOrIds);\r\n  }\r\n  /**\r\n   * id\r\n   * @returns \r\n   */\r\n  protected getChecks(): string[] {\r\n    return this.viewModel.uiState['ids'] || [];\r\n  }\r\n  /**\r\n   * \r\n   */\r\n  private getPagingInfo() {\r\n    const bindingPath = this.viewModel.bindingPath;\r\n    const bindingData = this.viewModel.bindingData;\r\n    let pagingInfo = bindingData.pagingInfo;\r\n    if (bindingPath === '/') {\r\n      return pagingInfo;\r\n    } else {\r\n      const bindingPaths = bindingPath.substr(1).split('/').filter(item => !!item && item.length > 0).map(item => {\r\n        return item.substring(0, item.length - 1);\r\n      });\r\n      bindingPaths.forEach(path => {\r\n        pagingInfo = pagingInfo && pagingInfo[path];\r\n      });\r\n      return pagingInfo;\r\n    }\r\n  }\r\n  private updatePageInfo(treeTable: TreeTableComponent) {\r\n    const { pageIndex, pageSize, total } = this.getPagingInfo();\r\n    if (pageSize === 0) {\r\n      treeTable.pagination = false;\r\n      return;\r\n    }\r\n    treeTable.pagination = true;\r\n    treeTable.updatePageInfo({ pageIndex, pageSize, total });\r\n  }\r\n  //#region \r\n  /**\r\n   * \r\n   */\r\n  @HostListener('nodeSelected', ['$event'])\r\n  public selectionChangeHandler(event: any) {\r\n    if (event && event.node && event.node.hasOwnProperty('data')) {\r\n      const idField = this.treeTable.idField;\r\n      const id = event.node.data[idField];\r\n      this.setCurrentIdToBindingList(id);\r\n    }\r\n  }\r\n  /**\r\n   * \r\n   * @param event event\r\n   */\r\n  @HostListener('checkValuesChange', ['$event'])\r\n  public checkValuesChange(event: any) {\r\n    // this.viewModel.uiState.setPropertyValue('ids', this.treeTable.checkValues);\r\n    this.setChecks(this.treeTable.checkValues);\r\n    this.setCheckedRows();\r\n  }\r\n  /**\r\n   * \r\n   */\r\n  @HostListener('expand', ['$event'])\r\n  public expandHandler(event: any) {\r\n    const selectedId = event.data['id'];\r\n    const virtualRootFrameContext = this.frameContext.getVirtualRootFrameContext();\r\n    // \r\n    // this.setSelectedIdToTree(selectedId);\r\n    const expandNodes = virtualRootFrameContext.getParam('TREE_LATEST_EXPANDED_ID') || [];\r\n    expandNodes.push(selectedId);\r\n    virtualRootFrameContext.setParam('TREE_LATEST_EXPANDED_ID', expandNodes);\r\n  }\r\n  @HostListener('pageChanged', ['$event'])\r\n  public onPageChanged(event: any) {\r\n    let { pageSize = 20, pageIndex = 1 } = event || {};\r\n    if (pageIndex < 1) {\r\n      pageIndex = 1;\r\n    }\r\n    const skip = (pageIndex - 1) * pageSize;\r\n    this.bindingData.setPagingInfo(skip, pageSize, this.bindingData.bindingPath);\r\n  }\r\n  @HostListener('pageSizeChanged', ['$event'])\r\n  public onPageSizeChanged(event: any) {\r\n    const pageSize = event ? event : 20;\r\n    const skip = 0;\r\n    this.bindingData.setPagingInfo(skip, pageSize, this.bindingData.bindingPath);\r\n  }\r\n  /**\r\n   * \r\n   * @param event event\r\n   */\r\n  @HostListener('childsPageChanged', ['$event'])\r\n  public onNodePageChanged(event: any) {\r\n    const { pageIndex = 1, pageSize = this.nodePageSize, node = {} } = event;\r\n    const id = node && node.id || null;\r\n    if (id) {\r\n      const virtualRootFrameContext = this.frameContext.getVirtualRootFrameContext();\r\n      const expandNodes = virtualRootFrameContext.getParam('TREE_LATEST_EXPANDED_ID') || [];\r\n      expandNodes.push(id);\r\n      virtualRootFrameContext.setParam('TREE_LATEST_EXPANDED_ID', expandNodes);\r\n      this.frameContext.params.set(`_NODE_${id}_PAGE_INDEX_`, pageIndex);\r\n      this.frameContext.params.set(`_RELOAD_CHILDREN_`, true);\r\n      this.frameContext.params.set('_NODE_PAGE_CHANGED_', true);\r\n    }\r\n  }\r\n  //#endregion\r\n}\r\n\r\nexport { FarrisTreeTableBindingDirective };\r\n","import { BindingObject, DataPropInfo, DataTypeInfo, ViewModel } from '@farris/devkit';\r\nimport { isNumber } from 'lodash-es';\r\n/**\r\n * \r\n */\r\nexport class DataMapping {\r\n  public vm: ViewModel;\r\n  public target: BindingObject;\r\n  /**\r\n   * \r\n   */\r\n  protected readonly defaultSpliter = ',';\r\n  /**\r\n   * \r\n   * @param helpData null\r\n   * @param mapFields {id: \"assoField.assoField\", code: \"assoField.assoField_Code\", name: \"assoField.assoField_Name\"}\r\n   * @param asClear \r\n   * @param [spliter=','] \r\n   */\r\n  mappingData(helpData: any, mapFields: any, asClear: boolean = false, spliter: string = ',') {\r\n    if (!mapFields) {\r\n      return;\r\n    }\r\n    // \r\n    const appContext = this.vm.frameContext.appContext;\r\n    appContext.changeDetectionController.detach();\r\n    let helpFields = Object.keys(mapFields);\r\n    const basePaths = this.getBindingPathArray();\r\n    const primaryInfo = this.getMapFieldsPrimaryKey(mapFields, basePaths);\r\n    // \r\n    const primaryKeys: string[] = primaryInfo && primaryInfo.map((item) => item.primaryKey) || [];\r\n    // \r\n    const primaryFields: string[] = primaryInfo && primaryInfo.map((item) => item.primaryField) || [];\r\n    // keykey\r\n    helpFields = this.sortMapFieldKeys(helpFields, primaryKeys);\r\n    if (!helpData || asClear) {\r\n      helpFields.reverse();\r\n    }\r\n    this.mapping(helpFields, mapFields, helpData, primaryFields, basePaths, asClear, spliter);\r\n    // \r\n    appContext.changeDetectionController.reattach();\r\n  }\r\n  private mapping(sortedKeyFields: string[], mapFields: any, helpData: any, targetPrimaryFields: string[], basePaths: string[], asClear: boolean = false, spliter = ',') {\r\n    sortedKeyFields.forEach((field: any) => {\r\n      const val = this.getHelpValue(field, helpData, spliter);\r\n      let mappings: any[] = mapFields[field].split(',');\r\n      const headMappings = mappings.filter((p) => targetPrimaryFields.includes(p));\r\n      const leftMappings = mappings.filter((p) => !targetPrimaryFields.includes(p));\r\n      if (!helpData || asClear) {\r\n        mappings = [].concat(leftMappings).concat(headMappings);\r\n      } else {\r\n        mappings = [].concat(headMappings).concat(leftMappings);\r\n      }\r\n      this.updateTarget(mappings, basePaths, helpData, val);\r\n    });\r\n  }\r\n  private updateTarget(mappings: string[], basePaths: string[], helpData: any, value: any) {\r\n    mappings.forEach((targetFieldPath: any) => {\r\n      this.updateTargetValue(basePaths, targetFieldPath, value, helpData);\r\n    });\r\n  }\r\n  private updateTargetValue(basePaths: string[], targetFieldPath, value: any, helpData: any) {\r\n    if (this.target) {\r\n      const paths = targetFieldPath.split('.');\r\n      this.setValue(this.target, paths, value);\r\n    } else {\r\n      const paths = basePaths.concat(targetFieldPath.split('.'));\r\n      if (!helpData) {\r\n        this.vm.bindingData.clearValue(paths, true, true, { frameContext: this.vm.frameContext });\r\n      } else {\r\n        this.vm.bindingData.setValue(paths, value, true, true, null, { frameContext: this.vm.frameContext });\r\n      }\r\n    }\r\n  }\r\n  /**\r\n   * \r\n   * @param field \r\n   * @param helpData \r\n   * @param [spliter=','] \r\n   * @returns\r\n   */\r\n  private getHelpValue(field: string, helpData: any, spliter = ',') {\r\n    let value: any = '';\r\n    if (helpData) {\r\n      if (helpData instanceof Array) {\r\n        value = helpData.map((item: any) => {\r\n          return this.getValue(field, item);\r\n        }).join(spliter);\r\n      } else {\r\n        value = this.getValue(field, helpData);\r\n      }\r\n    }\r\n    return value;\r\n  }\r\n  protected getValue(f: string, data: any) {\r\n    let val = '';\r\n    if (f.indexOf('.') === -1) {\r\n      val = data[f];\r\n    } else {\r\n      val = f.split('.').reduce((a, b) => {\r\n        return a[b];\r\n      }, data);\r\n    }\r\n\r\n    return val;\r\n  }\r\n  protected setValue(target: object, paths: string[], value: any) {\r\n    if (target) {\r\n      if (paths.length <= 1) {\r\n        target[paths[0]] = value;\r\n      } else {\r\n        paths.slice(0, -1).reduce((prev, path) => {\r\n          if (!(prev.hasOwnProperty(path) || prev['__proto__'].hasOwnProperty(path))) {\r\n            prev[path] = {};\r\n          }\r\n          return prev[path];\r\n        }, target)[paths[paths.length - 1]] = value;\r\n      }\r\n    }\r\n  }\r\n  private getBindingPathArray(): any[] {\r\n    const path = this.vm.bindingPath;\r\n    if (path) {\r\n      return path.split('/').filter((n) => n !== '');\r\n    }\r\n    return [];\r\n  }\r\n\r\n  private isNumberValue(field, data) {\r\n    const currentVal = this.getValue(field, data);\r\n    return isNumber(currentVal);\r\n  }\r\n  /**\r\n   *\r\n   * @param mapFields  {id: \"assoField.assoField\", code: \"assoField.assoField_Code\", name: \"assoField.assoField_Name\"}  {id:'vid',code:'code',name:'name'}\r\n   */\r\n  private getMapFieldsPrimaryKey(mapFields: any, bindingPaths: string[]): Array<{ primaryKey: string, primaryField: string }> {\r\n    if (!mapFields || Object.keys(mapFields).length < 1) {\r\n      return null;\r\n    }\r\n    const results = [];\r\n    // let primaryField = null;\r\n    try {\r\n      const entityTypeInfo: DataTypeInfo = this.vm.frameContext.repository.entityTypeInfo;\r\n      Object.keys(mapFields).forEach((key: string) => {\r\n        const mapField = mapFields[key];\r\n        if (mapField && typeof mapField === 'string') {\r\n          const mappings = mapField.split(',').filter((p) => p);\r\n          mappings.forEach((item: string) => {\r\n            let paths = item.split('.');\r\n            if (bindingPaths && bindingPaths.length > 0) {\r\n              paths = bindingPaths.concat(paths);\r\n            }\r\n            const propInfo: DataPropInfo = entityTypeInfo.getPropInfoByPath(paths);\r\n            if (propInfo && propInfo.metadataInfo && propInfo.metadataInfo.primary === true) {\r\n              results.push({\r\n                primaryKey: key,\r\n                primaryField: item\r\n              });\r\n            }\r\n          });\r\n        }\r\n      });\r\n    } catch (e) {\r\n      console.error(e);\r\n    }\r\n    return results;\r\n  }\r\n  private sortMapFieldKeys(keys: string[], primaryKeys: string[]): string[] {\r\n    if (!primaryKeys || primaryKeys.length < 1 || !keys || keys.length < 1) {\r\n      return keys;\r\n    }\r\n    primaryKeys = [...new Set(primaryKeys)];\r\n    // \r\n    keys = keys.filter((p) => !primaryKeys.includes(p));\r\n    return [].concat(primaryKeys).concat(keys);\r\n  }\r\n}\r\n","/*\r\n * @Author: (lucas huang)\r\n * @Date: 2018-11-07 16:31:57\r\n * @LastEditors: (Lucas Huang)\r\n * @LastEditTime: 2019-09-27 14:57:22\r\n * @Company: Inspur\r\n * @Version: v0.0.1\r\n */\r\n\r\n/**\r\n * \r\n * [data-mapping]=\"{ id: 'user.userId', name: 'user.userName' }\"\r\n * key  value  \r\n * { ... id: 'user.userid, user.addusid'}\r\n * \r\n *\r\n */\r\n\r\nimport { Directive, OnInit, Optional, Self, Input } from '@angular/core';\r\nimport { BindingObject, NgFormControl, ViewModel } from '@farris/devkit';\r\nimport { LookupGridComponent } from '@farris/ui-lookup';\r\nimport { DataMapping } from './data-mapping';\r\n\r\n\r\n@Directive({ selector: '[data-mapping]' })\r\nexport class LookupDataMappingDirective extends DataMapping implements OnInit {\r\n  @Input('data-mapping') mapfields: any;\r\n  @Input('target') target: BindingObject = null;\r\n\r\n  constructor(@Optional() public vm: ViewModel, @Optional() @Self() private lookup: LookupGridComponent) {\r\n    super();\r\n  }\r\n\r\n  ngOnInit() {\r\n    this.lookup.selectedData.subscribe((data: any) => {\r\n      const _mapfields = this.mapfields || this.lookup.mapFields;\r\n      const spliter = this.lookup.multipleChoiceSeparator || this.defaultSpliter;\r\n      this.mappingData(data, _mapfields, false, spliter);\r\n    });\r\n    this.lookup.clearMappings.subscribe((result: any) => {\r\n      // const value = result && result.value || null;\r\n      const mapfields = Object.assign({}, (this.mapfields || this.lookup.mapFields || {}));\r\n      const lookupTextField = this.lookup.textField;\r\n      const data = {};\r\n      const controlName = this.lookup.ngControl && this.lookup.ngControl.name;\r\n      if (controlName && this.vm) {\r\n        const textFieldMapping = mapfields[lookupTextField];\r\n        const ngFormControl = this.vm && this.vm.form && this.vm.form.ngFormControls && this.vm.form.ngFormControls[controlName] as NgFormControl;\r\n        const binding = ngFormControl && ngFormControl.binding;\r\n        if (textFieldMapping && binding) {\r\n          mapfields[lookupTextField] = textFieldMapping.split(',').filter((item) => item !== binding).join(',');\r\n        }\r\n      }\r\n      // this.setValue(data, lookupTextField.split('.'), value);\r\n      Object.keys(mapfields).forEach((field) => {\r\n        this.setValue(data, field.split('.'), '');\r\n      });\r\n      this.mappingData(data, mapfields, true);\r\n    });\r\n    this.lookup.clear.subscribe(() => {\r\n      const _mapfields = this.mapfields || this.lookup.mapFields;\r\n      this.mappingData(null, _mapfields);\r\n    });\r\n  }\r\n}\r\n","\r\nimport { Directive, OnInit, Optional, Self, Input } from '@angular/core';\r\nimport { FrameContext } from '@farris/devkit';\r\nimport { LookupGridComponent } from '@farris/ui-lookup';\r\n\r\n// tslint:disable-next-line: directive-selector\r\n@Directive({\r\n  selector: '[enableExtendLoadMethod]'\r\n})\r\nexport class LookupEnableExtendLoadMethodDirective implements OnInit {\r\n  @Input()\r\n  public enableExtendLoadMethod: any;\r\n\r\n  constructor(\r\n    @Optional() private frameContext: FrameContext,\r\n    @Optional() @Self() private lookup: LookupGridComponent\r\n  ) { }\r\n\r\n  ngOnInit() {\r\n    if (!this.frameContext || !this.lookup || this.enableExtendLoadMethod !== true) {\r\n      return;\r\n    }\r\n    const befApiUrl = this.frameContext.repository.apiUri;\r\n    const helpMetadataId = this.lookup.uri;\r\n    const enableKey = `${helpMetadataId}@${befApiUrl}`;\r\n    this.frameContext.setParam(enableKey, true);\r\n  }\r\n}\r\n","import { Directive, Input, OnInit, HostListener, Self, Host, Optional, Output, EventEmitter, OnChanges, SimpleChanges, DoCheck, KeyValueDiffer, KeyValueDiffers } from '@angular/core';\r\nimport { ComboBoxComponent } from '@progress/kendo-angular-dropdowns';\r\nimport { LookupGridComponent } from '@farris/ui-lookup';\r\nimport { ComboListComponent } from '@farris/ui-combo-list';\r\nimport { ComboLookupComponent } from '@farris/ui-combo-lookup';\r\n\r\n@Directive({\r\n  selector: '[UIStateBinding]'\r\n})\r\nexport class UIStateBindingDirective implements OnInit, OnChanges, DoCheck {\r\n  private _bindingObject: any;\r\n  private readonly defaultSpliter = ',';\r\n  private differ: KeyValueDiffer<any, any> = null;\r\n\r\n  @Input('UIStateBinding')\r\n  set bindingObject(value: any) {\r\n    this._bindingObject = value;\r\n    if (!this.differ && value && this.differs && typeof (value) === 'object') {\r\n      this.differ = this.differs.find(value).create();\r\n    }\r\n  }\r\n  get bindingObject() {\r\n    return this._bindingObject;\r\n  }\r\n  @Output() UIStateBindingChange: EventEmitter<any> = new EventEmitter<any>();\r\n\r\n  @HostListener('valueChange', ['$event'])\r\n  onValueChange(val: any) {\r\n    // host is combobox\r\n    if (this.hostComboComponent && this.bindingObject) {\r\n      if (val) {\r\n        this.bindingObject.key = val.value;\r\n        this.bindingObject.value = val.name;\r\n      } else {\r\n        this.bindingObject.key = null;\r\n        this.bindingObject.value = null;\r\n      }\r\n    }\r\n  }\r\n\r\n  constructor(\r\n    @Host() @Self() @Optional() private hostComboComponent: ComboBoxComponent,\r\n    @Host() @Self() @Optional() private hostHelpComponent: LookupGridComponent,\r\n    @Optional() private differs: KeyValueDiffers,\r\n    @Host() @Self() @Optional() private hostComboListComponent: ComboListComponent,\r\n    @Host() @Self() @Optional() private hostComboLookupComponent: ComboLookupComponent\r\n  ) { }\r\n\r\n  ngOnInit() {\r\n    if (this.hostComboComponent) {\r\n      this.hostComboComponent.valuePrimitive = false;\r\n    } else if (this.hostHelpComponent) {\r\n      this.bindObjectToHostLookup();\r\n    } else if (this.hostComboListComponent) {\r\n      this.bindObjectToHostComboList();\r\n    } else if (this.hostComboLookupComponent) {\r\n      this.bindObjectToHostComboLookup();\r\n    }\r\n  }\r\n  ngDoCheck() {\r\n    if (this.differ && typeof (this.bindingObject) === 'object') {\r\n      const changes = this.differ && this.differ.diff(this.bindingObject);\r\n      if (changes) {\r\n        this.bindingChanges();\r\n      }\r\n    } else { // differ\r\n      this.bindingChanges();\r\n    }\r\n  }\r\n\r\n  private bindingChanges() {\r\n    const text = this.bindingObject ? this.bindingObject.value : null;\r\n    const key = this.bindingObject ? this.bindingObject.key : null;\r\n    if (this.hostComboComponent) {\r\n      this.hostComboComponent.text = text;\r\n      const vField = this.hostComboComponent.valueField;\r\n      const item = this.hostComboComponent.data.find((n) => n[vField] === key);\r\n      this.hostComboComponent.writeValue(item);\r\n    } else if (this.hostHelpComponent) {\r\n      this.hostHelpComponent.writeValue(text);\r\n      this.hostHelpComponent.displayValue = key;\r\n    } else if (this.hostComboListComponent) {\r\n      this.hostComboListComponent.writeValue(key);\r\n    } else if (this.hostComboLookupComponent) {\r\n      this.hostComboLookupComponent.selectedValues = key;\r\n      this.hostComboLookupComponent.writeValue(text);\r\n    }\r\n  }\r\n  ngOnChanges(changes: SimpleChanges) {\r\n    if (changes.bindingObject && !this.differ) {\r\n      this.bindingChanges();\r\n    }\r\n  }\r\n\r\n  // \r\n  private bindObjectToHostLookup() {\r\n    if (!this.hostHelpComponent) {\r\n      return;\r\n    }\r\n\r\n    this.hostHelpComponent.selectedData.subscribe((data: any) => this.updateHelpBindingObject(data));\r\n\r\n    this.hostHelpComponent.clear.subscribe(() => {\r\n      // this.bindingObject = {key: null, value: null};\r\n      this.updateHelpBindingObject(null);\r\n    });\r\n    if (this.hostHelpComponent.tagRemoved) {\r\n      this.hostHelpComponent.tagRemoved.subscribe((event: { removedIndex: number, instance: LookupGridComponent }) => {\r\n        const { removedIndex: index = -1, instance: componentRef = null } = event;\r\n        if (index === -1) {\r\n          return;\r\n        }\r\n        const isSigleSelect = componentRef.singleSelect;\r\n        if (isSigleSelect || !componentRef.displayValue) {\r\n          this.updateHelpBindingObject(null);\r\n        } else {\r\n          this.UIStateBindingChange.emit({ key: componentRef.displayValue, value: componentRef.displayText });\r\n        }\r\n      });\r\n    }\r\n    if (this.hostHelpComponent.nosearch) {\r\n      this.hostHelpComponent.valueChanged.subscribe((txt: any) => {\r\n        const idField = this.hostHelpComponent.idField;\r\n        const textField = this.hostHelpComponent.textField;\r\n        this.updateHelpBindingObject({\r\n          [idField]: txt,\r\n          [textField]: txt\r\n        });\r\n      });\r\n    }\r\n  }\r\n\r\n  // \r\n  private bindObjectToHostComboList() {\r\n    if (!this.hostComboListComponent) {\r\n      return;\r\n    }\r\n\r\n    this.hostComboListComponent.valueChange.subscribe((data: any) => this.updateHelpBindingObject(data.selections));\r\n\r\n    this.hostComboListComponent.clear.subscribe(() => {\r\n      this.updateHelpBindingObject(null);\r\n    });\r\n  }\r\n\r\n  // \r\n  private bindObjectToHostComboLookup() {\r\n    if (!this.hostComboLookupComponent) {\r\n      return;\r\n    }\r\n\r\n    if (this.hostComboLookupComponent.multiSelect) {\r\n      this.hostComboLookupComponent.valueChange.subscribe((data: any) => this.updateHelpBindingObject(data.selections));\r\n    } else {\r\n      // this.hostComboLookupComponent.selectChange.subscribe((data: any) => this.updateHelpBindingObject(data));\r\n      this.hostComboLookupComponent.selectChange.subscribe((e: any) => {\r\n        let data = e;\r\n        if (e.data) {\r\n          data = e.data;\r\n        }\r\n        this.updateHelpBindingObject(data);\r\n      });\r\n    }\r\n\r\n    this.hostComboLookupComponent.clear.subscribe(() => {\r\n      this.updateHelpBindingObject(null);\r\n    });\r\n  }\r\n\r\n  // UISTATE\r\n  private updateHelpBindingObject(data: any) {\r\n    let idField;\r\n    let textField;\r\n    let spliter: string = this.defaultSpliter;\r\n    if (this.hostHelpComponent) {\r\n      idField = this.hostHelpComponent.idField;\r\n      textField = this.hostHelpComponent.textField;\r\n      spliter = this.hostHelpComponent.multipleChoiceSeparator || this.defaultSpliter;\r\n    }\r\n\r\n    if (this.hostComboListComponent) {\r\n      idField = this.hostComboListComponent.idField;\r\n      textField = this.hostComboListComponent.textField;\r\n    }\r\n\r\n    if (this.hostComboLookupComponent) {\r\n      idField = this.hostComboLookupComponent.idField;\r\n      textField = this.hostComboLookupComponent.textField;\r\n      spliter = this.hostComboLookupComponent.separator || this.defaultSpliter;\r\n    }\r\n\r\n    this.emitUiStateBinding(data, idField, textField, spliter);\r\n  }\r\n\r\n  private emitUiStateBinding(data, idField, textField, spliter: string = ',') {\r\n    const newObject = { key: null, value: null };\r\n    if (data) {\r\n      // const idField = this.hostHelpComponent.idField;\r\n      // const textField = this.hostHelpComponent.textField;\r\n      if (Array.isArray(data)) {\r\n        newObject.key = data.map((d) => d[idField]).join(spliter);\r\n        newObject.value = data.map((d) => {\r\n          if (textField.indexOf('.') > -1) {\r\n            return textField.split('.').reduce((r, c) => {\r\n              return r[c];\r\n            }, d);\r\n          } else {\r\n            return d[textField];\r\n          }\r\n        }).join(spliter);\r\n      } else {\r\n        if (idField) {\r\n          newObject.key = data[idField];\r\n        }\r\n\r\n        if (textField) {\r\n          if (textField.indexOf('.') > -1) {\r\n            newObject.value = textField.split('.').reduce((r, c) => {\r\n              return r[c];\r\n            }, data);\r\n          } else {\r\n            newObject.value = data[textField];\r\n          }\r\n        }\r\n      }\r\n    }\r\n    this.UIStateBindingChange.emit(newObject);\r\n  }\r\n}\r\n","import { Directive, ElementRef, Input, Renderer2, OnInit, OnChanges, SimpleChanges } from '@angular/core';\r\nimport { GridComponent } from '@progress/kendo-angular-grid';\r\n@Directive({\r\n    selector: '[farrisDisabled]'\r\n})\r\nexport class FarrisDisabledDirective implements OnInit, OnChanges {\r\n    @Input('farrisDisabled') kendoGridDisabled: boolean;\r\n    maskElement: any;\r\n    constructor(private grid: GridComponent, private el: ElementRef, private renderer: Renderer2) {\r\n\r\n    }\r\n    ngOnInit() {\r\n\r\n    }\r\n    ngOnChanges(changes: SimpleChanges) {\r\n        if (!this.maskElement) {\r\n            this.createMaskElement();\r\n        }\r\n        if (changes['kendoGridDisabled'] && this.maskElement) {\r\n            if (this.kendoGridDisabled) {\r\n                this.renderer.removeStyle(this.maskElement, 'display');\r\n            } else {\r\n                this.renderer.setStyle(this.maskElement, 'display', 'none');\r\n            }\r\n        }\r\n    }\r\n    private createMaskElement() {\r\n        this.maskElement = this.renderer.createElement(\"div\");\r\n        this.renderer.setStyle(this.maskElement, 'width', '100%');\r\n        this.renderer.setStyle(this.maskElement, 'height', '100%');\r\n        this.renderer.setStyle(this.maskElement, 'position', 'absolute');\r\n        this.renderer.setStyle(this.maskElement, 'background-color', 'rgba(255,255,255,0.5)');\r\n        this.renderer.setStyle(this.maskElement, 'z-index', '3');\r\n        this.renderer.setStyle(this.maskElement, 'display', 'none');\r\n        this.renderer.appendChild(this.el.nativeElement, this.maskElement);\r\n    }\r\n}\r\n\r\n","import { Directive, Input, Injector } from '@angular/core';\r\nimport { FrameContext, BindingData, ViewModel } from '@farris/devkit';\r\n@Directive({\r\n    selector: '[farrisSort]'\r\n})\r\nexport class FarrisSortDirective {\r\n\r\n}\r\n\r\n@Directive({\r\n    selector: '[farris-textarea-edit]'\r\n})\r\nexport class FarrisTextareaEditDirective {\r\n\r\n}\r\n\r\n@Directive({\r\n    selector: '[farrisDynamicColumnFormat]'\r\n})\r\nexport class FarrisDynamicColumnFormatDirective {\r\n\r\n}\r\n\r\n@Directive({\r\n    selector: '[farris-enter-edit]'\r\n})\r\nexport class FarrisEditEnterDirective {\r\n    @Input('form-group') farrisForm: any;\r\n}\r\n\r\n@Directive({\r\n    selector: '[farrisTreeTableFormat]'\r\n})\r\nexport class FarrisTreeTableFormatDirective {\r\n\r\n}\r\n\r\n","import {\r\n  Directive, OnInit, OnChanges, OnDestroy, SimpleChanges, HostListener,\r\n  EventEmitter, Output\r\n} from '@angular/core';\r\nimport { Subject, Subscription } from 'rxjs';\r\nimport { BindingData, BindingList, Change, ChangeType, ViewModel, FrameContext, DataTypeInfo, EntityPathConverter, RunMode, ComponentType, ExpressionUtil, ENABLE_EDIT_STATE_FILTER_SORTING } from '@farris/devkit';\r\nimport { DatagridComponent } from '@farris/ui-datagrid';\r\nimport { debounceTime, finalize } from 'rxjs/operators';\r\n// tslint:disable: max-line-length\r\n\r\n/*\r\n * \r\n */\r\n@Directive({\r\n  selector: '[farris-use-binding-data]'\r\n})\r\nexport class FarrisDatagridUseBindingDataDirective implements OnInit, OnChanges, OnDestroy {\r\n  private _PROPS: { [propName: string]: any };\r\n  // \r\n  private sortFields: string = null;\r\n  // \r\n  private sortDirections: string = null;\r\n  /**\r\n   * \r\n   */\r\n  private hasSorted = false;\r\n  /**\r\n   * \r\n   */\r\n  private filters: any = null;\r\n  protected get props() {\r\n    return this._PROPS;\r\n  }\r\n  protected set props(value) {\r\n    this._PROPS = value;\r\n  }\r\n  protected bindingDataChangeEvent: Subscription;\r\n  /**\r\n   * grid\r\n   */\r\n  private renderGridSubject: Subject<any> = new Subject<any>();\r\n  private enableFilterSorting = false;\r\n  /**\r\n   * \r\n   */\r\n  @Output() selectedRowChange: EventEmitter<any> = new EventEmitter<any>();\r\n  // private renderGridDebounce;\r\n  constructor(public bindingData: BindingData, public viewModel: ViewModel, public grid: DatagridComponent) {\r\n    this.setChecks([]);\r\n    this.enableFilterSorting = this.viewModel && this.viewModel.frameContext && this.viewModel.frameContext.injector.get<boolean>(ENABLE_EDIT_STATE_FILTER_SORTING, false) || false;\r\n    this.registerEvent();\r\n  }\r\n\r\n  // #region Ng Event\r\n\r\n  ngOnInit() {\r\n    const { pageSize = 0 } = this.getPagingInfo() || {};\r\n    if (pageSize !== 0) {\r\n      // \r\n      if ((!this.grid.pageList || this.grid.pageList.length < 1) && typeof this.grid['setPageList'] === 'function') {\r\n        this.grid['setPageList']([pageSize, pageSize * 2, pageSize * 3, pageSize * 4]);\r\n      }\r\n    }\r\n    this.setComponentRef();\r\n    this.bindData();\r\n    window.setTimeout(() => {\r\n      this.updateSelectedRow();\r\n    }, 0);\r\n    this.registerBindingDataChangeEvent();\r\n    this.renderGridSubject.pipe(debounceTime(500)).subscribe((change: Change) => {\r\n      if (!this.viewModel || !this.viewModel.frameContext || this.viewModel.frameContext.isDisposed) {\r\n        return;\r\n      }\r\n      this.bindData(change);\r\n      /*if (!this.renderGridDebounce) {\r\n        this.renderGridDebounce = this.debounce((change) => {\r\n          this.bindData(change);\r\n        }, 500);\r\n      }\r\n      this.renderGridDebounce(change);*/\r\n    });\r\n    if (this.viewModel && this.viewModel.frameContext && this.viewModel.frameContext.frameComponent) {\r\n      this.viewModel.frameContext.frameComponent.componentType = ComponentType.farrisDataGridComponent;\r\n    }\r\n  }\r\n\r\n  ngOnChanges(changes: SimpleChanges) {\r\n    this.bindData();\r\n  }\r\n\r\n  // #endregion\r\n\r\n\r\n  /**\r\n   * \r\n   */\r\n  protected get primaryKey() {\r\n    return this.bindingList.primaryKey;\r\n  }\r\n  /**\r\n   * \r\n   */\r\n  protected get bindingList(): BindingList {\r\n    // \r\n    if (this.viewModel.bindingPath === '/' || !this.viewModel.bindingPath) {\r\n      return this.bindingData.list;\r\n    }\r\n    // \r\n    let bindingPath = this.viewModel.bindingPath.substr(1);\r\n    bindingPath = bindingPath[0].toLowerCase() + bindingPath.substring(1, bindingPath.length);\r\n    const paths = bindingPath.split('/');\r\n\r\n    const filteredPaths = paths.filter((part: string) => {\r\n      return part !== '';\r\n    });\r\n    return this.bindingData.getValue(filteredPaths);\r\n  }\r\n  /**\r\n   * \r\n   */\r\n  private setComponentRef() {\r\n    const appContext = this.viewModel && this.viewModel.frameContext && this.viewModel.frameContext.getFormAppContext();\r\n    const frameId = this.viewModel && this.viewModel.frameContext && this.viewModel.frameContext.frameId;\r\n    const id = this.grid && this.grid.id;\r\n    // frameIdfarris gridid\r\n    if (!frameId || !id) {\r\n      return;\r\n    }\r\n    const map = appContext && appContext.componentRefs && appContext.componentRefs.get(frameId) || new Map<string, any>();\r\n    appContext && appContext.componentRefs && appContext.componentRefs.set(frameId, map.set(id, this.grid));\r\n  }\r\n  /**\r\n   * \r\n   */\r\n  protected getPagingInfo() {\r\n    const bindingPath = this.viewModel.bindingPath;\r\n    const bindingData = this.viewModel.bindingData;\r\n    const pagingInfo = bindingData && bindingData.pagingInfo || {};\r\n    if (bindingPath === '/') {\r\n      return pagingInfo;\r\n    } else {\r\n      const bindingPaths = bindingPath.substr(1).split('/').filter((item) => !!item && item.length > 0);\r\n      // nodeCode_parentId:{}\r\n      // {pagination:{a_pid:{pageSize:2,pageIndex:1},b_pid:{pageSize:2,pageIndex:1}}}\r\n      // nodeCode\r\n      let nodeCode = bindingPaths[bindingPaths.length - 1];\r\n      nodeCode = nodeCode.substr(0, nodeCode.length - 1);\r\n      // \r\n      // const result = pagingInfo[nodeCode] || {};\r\n      // if (result.hasOwnProperty('totalCount')) {\r\n      //   result.total = result.totalCount;\r\n      // }\r\n      // return result;\r\n\r\n      const paths = bindingPaths.slice(0, bindingPaths.length - 1);\r\n      const bindingList = bindingData.getValue(paths) as BindingList;\r\n      const { pageSize = 0 } = pagingInfo[`${nodeCode}`] || {};\r\n      // \r\n      if (bindingList && bindingList.currentId) {\r\n        const key = `${nodeCode}_${bindingList.currentId}`;\r\n        // const key = nodeCode;\r\n        const result = pagingInfo[key] || {};\r\n        if (result.hasOwnProperty('totalCount')) {\r\n          result.total = result.totalCount;\r\n        }\r\n        // \r\n        if (Object.keys(result).length < 1) {\r\n          result.pageIndex = 1;\r\n          result.pageSize = pageSize;\r\n        }\r\n        return result;\r\n      } else {\r\n        // 1\r\n        return { pageIndex: 1, pageSize };\r\n      }\r\n    }\r\n  }\r\n\r\n  // #region Input\r\n  /**\r\n   * \r\n   * @param props \r\n   * @param nextProps \r\n   * @param change \r\n   */\r\n  protected shouldComponentUpdate(change: Change, data: any,): { result: boolean, props?: any } {\r\n    const props = this.buildProps(data);\r\n    if (this.viewModel && this.viewModel.frameContext && this.viewModel.frameContext.appContext && this.viewModel.frameContext.appContext.runMode === RunMode.highSpeed && change) {\r\n      if (change.type === ChangeType.Load || change.type === ChangeType.Remove || change.type === ChangeType.PaginationInfoChange) {\r\n        return { result: true, props };\r\n      }\r\n    }\r\n    const gridProps = this.buildGridProps();\r\n    if (JSON.stringify(props) === JSON.stringify(gridProps)) {\r\n      return { result: false };\r\n    }\r\n    return { result: true, props };\r\n  }\r\n  protected registerEvent() {\r\n    // \r\n    this.grid && this.grid.columnSorted && this.grid.columnSorted.subscribe((event: any) => {\r\n      const isRemoteSort = this.grid.remoteSort;\r\n      // \r\n      if (!isRemoteSort) {\r\n        this.sortFields = this.grid.sortName;\r\n        this.sortDirections = this.grid.sortOrder;\r\n        this.sortBindingList();\r\n        // this.props = this.buildProps();\r\n      } else {\r\n        // \r\n        const groupField = this.grid && this.grid.groupField || null;\r\n        let sortFields = this.grid.sortName && this.grid.sortName.split(',') || [];\r\n        const sortDirection = this.grid.sortOrder && this.grid.sortOrder.split(',') || [];\r\n        if (groupField) {\r\n          if (!sortFields.includes(groupField)) {\r\n            sortFields.splice(0, 0, groupField);\r\n            sortDirection.splice(0, 0, 'asc');\r\n          }\r\n        }\r\n        // entityobject\r\n        const entityType = this.viewModel && this.viewModel.frameContext.repository.entityType || null;\r\n\r\n        if (sortFields.length > 0) {\r\n          if (entityType) {\r\n            const dataTypeInfo = new DataTypeInfo(entityType);\r\n            sortFields = sortFields.map(field => {\r\n              //if (field && field.indexOf('.') !== -1) {\r\n              const paths = field.split('.');\r\n              const propInfo = dataTypeInfo.getPropInfoByPath(paths);\r\n              const originalField = propInfo && propInfo.metadataInfo['path'] || null;\r\n              return originalField;\r\n              //}\r\n              //return field;\r\n            });\r\n          }\r\n        }\r\n        // datafieldoriginalDataField\r\n        const fields = sortFields.join(',');\r\n        const directions = sortDirection.join(',') || 'asc';\r\n        const frameContext: FrameContext = this.viewModel && this.viewModel.frameContext || null;\r\n        if (frameContext) {\r\n          frameContext.repository.sortConditionManager.setConditions(this.viewModel.bindingPath, fields, directions);\r\n        }\r\n      }\r\n    });\r\n    // \r\n    this.grid && this.grid.filterChanged && this.grid.filterChanged.subscribe((event: any) => {\r\n      this.filters = event;\r\n      if (!this.grid.remoteFilter) {\r\n        if (this.bindingList.length > 0 && !this.bindingList.currentId) {\r\n          const id = this.bindingList.getIdByIndex(0);\r\n          this.bindingList.setCurrentId(id);\r\n        }\r\n        this.bindingList.filter(this.filters);\r\n        this.bindData();\r\n      }\r\n    });\r\n    this.viewModel.frameContext.appContext.messagePipe.subscribe((message) => {\r\n      if (message && message === 'CLEAR_GRID_CONDITION' && this.filters && Object.keys(this.filters).length > 0) {\r\n        this.filters = {};\r\n        this.bindData();\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * bindingList\r\n   * @param change change\r\n   */\r\n  private sortBindingList(change?: Change) {\r\n    // groupField\r\n    const groupField = this.grid && this.grid.groupField || null;\r\n    if (groupField) {\r\n      const arrSortFields = this.sortFields && this.sortFields.split(',') || [];\r\n      const groupFields = groupField.split(',').reverse();\r\n      groupFields.forEach((field: string) => {\r\n        if (!arrSortFields.includes(field)) {\r\n          arrSortFields.splice(0, 0, field);\r\n          const arrSortDirection = this.sortDirections && this.sortDirections.split(',') || [];\r\n          arrSortDirection.splice(0, 0, 'asc');\r\n          this.sortFields = arrSortFields.join(',');\r\n          this.sortDirections = arrSortDirection.join(',') || 'asc';\r\n        }\r\n      });\r\n    }\r\n    this.bindingList.sortBy(this.sortFields, this.sortDirections);\r\n    this.bindData(change);\r\n  }\r\n  // #endregion\r\n\r\n  // #region \r\n  /**\r\n   * \r\n   * @param change? \r\n   */\r\n  bindData(change?: Change) {\r\n    const isRemoteFilter = this.grid && this.grid.remoteFilter || false;\r\n    // \r\n    const shouldSort = this.shouldSort(change);\r\n    if (shouldSort) {\r\n      this.hasSorted = true;\r\n      this.sortBindingList(change);\r\n      return;\r\n    }\r\n    this.hasSorted = false;\r\n    // \r\n    if ((this.grid.editable === true || change && change.type === ChangeType.Append) && this.filters && Object.keys(this.filters).length > 0 && !isRemoteFilter) {\r\n      if (!this.viewModel.frameContext.appContext.enableGridHeaderWhenEditing && !this.enableFilterSorting) {\r\n        this.filters = {};\r\n        this.grid.clearCondition();\r\n      }\r\n    }\r\n    const shouldFiltering = this.shouldFiltering(change);\r\n    if (shouldFiltering) {\r\n      this.bindingList.filter(this.filters);\r\n    }\r\n    // toJSON\r\n    const data: any = this.bindingList.toJSON();\r\n    // if (this.filters && Object.keys(this.filters).length > 0 && !isRemoteFilter) {\r\n    //   // data = this.grid.clientFilterService.executeFilter(data, this.filters);\r\n    // }\r\n\r\n    if (this.filters && Object.keys(this.filters).length > 0 && !isRemoteFilter && (!change || change && change.type !== ChangeType.SelectionChanged && change.type !== ChangeType.GlobalSelectionChanged)) {\r\n      if (data && data.length > 0) {\r\n        // \r\n        const row = (data as []).find((item) => item[this.bindingList.primaryKey] === this.bindingList.currentId);\r\n        if (!row) {\r\n          const firstRowId = data[0][this.bindingList.primaryKey];\r\n          this.bindingList.setCurrentId(firstRowId, true, true);\r\n        }\r\n      } else {\r\n        // \r\n        // this.bindingList.currentId = null;\r\n        if (this.bindingList.currentId) {\r\n          this.bindingList.setCurrentId(null, true, true, true);\r\n        }\r\n        // ids\r\n        if (!this.grid.multiSelect) {\r\n          this.setChecks([]);\r\n        }\r\n      }\r\n    }\r\n    const result = this.shouldComponentUpdate(change, data);\r\n    if (!result.result) {\r\n      return;\r\n    }\r\n    // const nextProps = this.buildProps(result);\r\n    this.renderGrid(result.props);\r\n    this.props = JSON.parse(JSON.stringify(result.props));\r\n  }\r\n  /**\r\n   * \r\n   * @param change - change\r\n   * @returns {boolean}\r\n   */\r\n  private shouldFiltering(change?: Change) {\r\n    const isRemoteFilter = this.grid && this.grid.remoteFilter || false;\r\n    // \r\n    if (isRemoteFilter === true) {\r\n      return false;\r\n    }\r\n    // \r\n    if (!this.filters || Object.keys(this.filters).length < 1) {\r\n      return false;\r\n    }\r\n    if (change) {\r\n      return change.type === ChangeType.Load;\r\n    }\r\n    return !this.grid.editable;\r\n  }\r\n  private shouldSort(change?: Change) {\r\n    // this.sortFields && !this.grid.editable && change && (change.type === 'Load' || change.type === 'SelectionChanged')\r\n    if (!this.sortFields || Object.keys(this.sortFields).length < 1) {\r\n      return false;\r\n    }\r\n    if (this.hasSorted) {\r\n      return false;\r\n    }\r\n    if (change) {\r\n      return change.type === 'Load' || change.type === 'SelectionChanged';\r\n    }\r\n    return this.grid.editable;\r\n  }\r\n  /**\r\n   * grid\r\n   * @param props \r\n   */\r\n  private renderGrid(props: any) {\r\n    const { pageIndex, pageSize, total, pagination, data } = props;\r\n    const virtualizedLoad = this.grid.virtualizedAsyncLoad || false;\r\n    this.grid.total = total;\r\n    this.grid.pageSize = pageSize;\r\n    this.grid.pageIndex = pageIndex;\r\n    this.grid.pagination = pagination;\r\n    this.grid.controlPaginationState = false;\r\n    // this.endCellEdit();\r\n    if (pageSize === 0) {\r\n      this.grid.pagination = false;\r\n      this.grid.pageIndex = 1;\r\n      // grid\r\n      // this.grid.pageSize = total;\r\n    }\r\n    if (virtualizedLoad) {\r\n      this.grid.loadVirtualData({\r\n        items: data,\r\n        pageIndex,\r\n        pageSize,\r\n        total\r\n      });\r\n    } else {\r\n      this.grid.loadData(data);\r\n    }\r\n  }\r\n  /**\r\n   * \r\n   */\r\n  protected buildProps(datas?: Array<any>) {\r\n    let data;\r\n    if (typeof (datas) !== 'undefined') {\r\n      data = datas;\r\n    } else {\r\n      data = this.bindingList.toJSON();\r\n    }\r\n    // let skip = 0;\r\n    let { pageIndex = 1, pageSize = 0 } = this.getPagingInfo() || {};\r\n    let { total = 0 } = this.getPagingInfo() || {};\r\n    // if (pageIndex > 0) {\r\n    //   skip = (pageIndex - 1) * pageSize;\r\n    // }\r\n    if (pageSize === 0 && total === 0) {\r\n      total = data.length;\r\n    }\r\n    return { data, pageIndex, pageSize, total, pagination: pageSize !== 0 };\r\n  }\r\n  /**\r\n   * grid\r\n   */\r\n  private buildGridProps() {\r\n    const data = this.grid.data || [];\r\n    let skip = 0;\r\n    const { pageIndex = 1, pageSize = 0 } = { pageIndex: this.grid.pageIndex, pageSize: this.grid.pageSize };\r\n    let total = this.grid.total || 0;\r\n    if (pageIndex > 0) {\r\n      skip = (pageIndex - 1) * pageSize;\r\n    }\r\n    if (pageSize === 0 && total === 0) {\r\n      total = data.length;\r\n    }\r\n    return { data, pageIndex, pageSize, total, pagination: this.grid.pagination };\r\n  }\r\n  /**\r\n   * \r\n   * @param change \r\n   */\r\n  protected onBindingDataChange(change: Change) {\r\n    this.updateDataSource(change);\r\n    this.updateSelectedRow(change);\r\n    // this.updateGrid(change);\r\n    // \r\n    // this.clearCheckedRows(change);\r\n    this.endCellEdit(change);\r\n    // \r\n    this.updateCheckedRows(change);\r\n    this.updateData(change);\r\n  }\r\n  /**\r\n   * \r\n   */\r\n  private updateDataSource(change: Change) {\r\n    if (change && change.type === ChangeType.ValueChanged) {\r\n      // \r\n      const paths = change.path;\r\n      try {\r\n        const entityPath = ExpressionUtil.getAvailableChildrenPathsFromEntityPaths(paths, this.viewModel.frameContext.repository.entityTypeInfo);\r\n        if (this.viewModel.bindingPath === '/' + entityPath.join('/')) {\r\n          const propertyNames = paths.slice(entityPath.length);\r\n          if (change.id && this.grid && change.path && this.viewModel.frameContext.appContext.runMode !== RunMode.highSpeed && propertyNames && propertyNames.length > 0) {\r\n            this.grid.updateRow(change.id, { [propertyNames.join('.')]: change.value });\r\n          }\r\n        }\r\n      } catch (error) {\r\n        console.warn(error);\r\n      }\r\n      this.renderGridSubject.next(change);\r\n    } else if (change && (change.type === ChangeType.SelectionChanged || change.type === ChangeType.GlobalSelectionChanged)) {\r\n      if (this.bindingList.currentId === (this.grid.selectedRow && this.grid.selectedRow.id) && this.grid.total > 0) {\r\n      } else {\r\n        this.bindData(change);\r\n      }\r\n    } else {\r\n      this.bindData(change);\r\n    }\r\n  }\r\n  // private endCellEdit() {\r\n  //   const isEditing = this.grid.isEditing();\r\n  //   if (isEditing) {\r\n  //     this.grid.endCellEdit();\r\n  //   }\r\n  // }\r\n  private endCellEdit(change: Change) {\r\n    const isEditing = this.grid.isEditing();\r\n    if (change.type === ChangeType.Load && isEditing) {\r\n      this.grid.endCellEdit();\r\n    }\r\n  }\r\n  /**\r\n   * grid\r\n   * @param change \r\n   */\r\n  private updateSelectedRow(change?: Change) {\r\n    if (!this.bindingList || !this.bindingList.currentId) {\r\n      return;\r\n    }\r\n    // \r\n    if (change && change.type === ChangeType.PaginationInfoChange) {\r\n      return;\r\n    }\r\n    if (this.viewModel && this.viewModel.frameContext.bindingData.rowSelectedEventSuspend === true) {\r\n      return;\r\n    }\r\n    const { id: gridSelectedRowId = null } = this.grid.selectedRow || {};\r\n    const currentId = this.bindingList.currentId;\r\n    // gridbingingList\r\n    if (gridSelectedRowId === currentId) {\r\n      const isMatch = change && (change.path.toString() === this.viewModel.bindingPath.split('/').filter(p => p).toString());\r\n      if (change && change.type === ChangeType.Load && isMatch) {\r\n        this.grid.clearSelections();\r\n        this.grid.selectRow(currentId, true, true);\r\n      }\r\n      return;\r\n    }\r\n    this.selectGridRow(this.bindingList.currentId);\r\n  }\r\n  /**\r\n   * bindingdata\r\n   */\r\n  private registerBindingDataChangeEvent() {\r\n    this.bindingDataChangeEvent = this.bindingData.changes.subscribe((change: Change) => {\r\n      this.onBindingDataChange(change);\r\n    });\r\n    this.viewModel.frameContext.appContext.messagePipe.subscribe(message => {\r\n      if (message === 'bindData') {\r\n        this.bindData();\r\n      }\r\n    });\r\n  }\r\n  /**\r\n   * bindingdata\r\n   */\r\n  private unRegisterBindingDataChangeEvent() {\r\n    if (this.bindingDataChangeEvent && typeof (this.bindingDataChangeEvent.unsubscribe) === 'function') {\r\n      this.bindingDataChangeEvent.unsubscribe();\r\n    }\r\n  }\r\n  /**\r\n   * \r\n   * @description gridloadgrid\r\n   * @TODO: LoadChildren\r\n   */\r\n  private updateData(change?: Change) {\r\n    if (!(change && (change.type === ChangeType.SelectionChanged || change.type === ChangeType.Load))) {\r\n      return;\r\n    }\r\n    const bindingPath = this.viewModel.bindingPath;\r\n    const eventBindingPath = '/' + change.path.join('/');\r\n    const isRetrieve = this.viewModel.frameContext.appContext.params.get('retrieveing') || false;\r\n    if (change.path.length < 1 || bindingPath === '/' || bindingPath === eventBindingPath || !bindingPath.startsWith(eventBindingPath)) {\r\n      return;\r\n    }\r\n    // retrieve\r\n    if (isRetrieve) {\r\n      return;\r\n    }\r\n    const fullPaths = EntityPathConverter.toEntityPathArray(this.viewModel.bindingPath, this.bindingData);\r\n    const paths = fullPaths.slice(0, fullPaths.length - 1);\r\n    const parent = this.bindingList.parent;\r\n    const parentId = parent && parent[parent.primaryKey];\r\n    // \r\n    if (!parentId) {\r\n      return;\r\n    }\r\n    // nodecode\r\n    const bindingPaths = this.viewModel.bindingPath.split('/').filter(item => item);\r\n    let nodeCode = bindingPaths[bindingPaths.length - 1];\r\n    nodeCode = nodeCode.substr(0, nodeCode.length - 1);\r\n    // const configPath = `/${nodeCode}_${parentId}`;\r\n    const configPath = `/${nodeCode}`;\r\n    let { pageIndex = 1 } = this.viewModel.frameContext.repository.entityCollection.getPaginationConfigByPath(configPath) || {};\r\n    const { pageSize = 0 } = this.viewModel.frameContext.repository.entityCollection.getPaginationConfigByPath(configPath) || {};\r\n\r\n    const parentNodeCode = change.path[change.path.length - 1];\r\n    const parentConfigPath = '/' + parentNodeCode.substring(0, parentNodeCode.length - 1);\r\n    const { pageSize: parentPageSize = 0 } = this.viewModel.frameContext.repository.entityCollection.getPaginationConfigByPath(parentConfigPath) || {};\r\n    const isQueryChild = this.viewModel.frameContext.appContext.params.get('queryChild') || false;\r\n    if (isQueryChild) {\r\n      // this.viewModel.frameContext.appContext.params.delete('queryChild');\r\n      pageIndex = 1;\r\n    }\r\n    // \r\n    if (parentPageSize + pageSize !== 0) {\r\n      this.viewModel.frameContext.appContext.params.set('forceQueryChild', true);\r\n      this.viewModel.frameContext.repository.queryChild(paths, pageIndex, pageSize).pipe(\r\n        finalize(() => this.viewModel.frameContext.appContext.params.delete('forceQueryChild'))\r\n      ).subscribe();\r\n    }\r\n  }\r\n  ngOnDestroy() {\r\n    this.unRegisterBindingDataChangeEvent();\r\n  }\r\n  // #endregion\r\n\r\n  // #region \r\n\r\n  /**\r\n   * \r\n   * @description \r\n   */\r\n  protected fireSelectedRowChange(selectedRowContext: any) {\r\n    this.selectedRowChange.emit(selectedRowContext);\r\n  }\r\n  /**\r\n   * \r\n   * @param change \r\n   */\r\n  private clearCheckedRows(change: Change) {\r\n    if (change.type === ChangeType.Load && this.grid.multiSelect) {\r\n      const isMatch = this.checkIfChangeMatchBindingPath(change);\r\n      if (isMatch) {\r\n        this.setChecks([]);\r\n        if (typeof (this.grid.clearCheckeds) === 'function') {\r\n          this.grid.clearCheckeds();\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  // #endregion\r\n\r\n\r\n\r\n  // #region \r\n\r\n  /**\r\n   * BindingList\r\n   * @param id \r\n   */\r\n  protected setSelectionIdToBindingData(id: string): void {\r\n    // \r\n    if (!id) {\r\n      this.bindingList.currentId = id;\r\n      if (!this.grid.multiSelect) {\r\n        this.setChecks([]);\r\n      }\r\n      return;\r\n    }\r\n    if (this.bindingList.currentId !== id) {\r\n      this.bindingList.setCurrentId(id, true);\r\n    }\r\n    // ids\r\n    if (!this.grid.multiSelect) {\r\n      this.setChecks([id]);\r\n    }\r\n  }\r\n  private updateCheckedRows(changes: Change) {\r\n    if (changes.type === ChangeType.Load) {\r\n      this.setCheckedRows();\r\n    } else if (changes.type === ChangeType.ValueChanged) {\r\n      const ids = this.getChecks();\r\n      if (changes.id && ids.includes(changes.id)) {\r\n        this.setCheckedRows();\r\n      }\r\n    }\r\n  }\r\n  /**\r\n   * \r\n   */\r\n  protected setChecks(ids: string[]) {\r\n    this.viewModel.uiState.setPropertyValue('ids', ids);\r\n    this.setCheckedRows(ids);\r\n  }\r\n  /**\r\n   * id\r\n   * @returns\r\n   */\r\n  protected getChecks(): string[] {\r\n    return this.viewModel.uiState['ids'] || [];\r\n  }\r\n  /**\r\n   * \r\n   */\r\n  protected setCheckedRows(ids?: string[]) {\r\n    // rows\r\n    // if (this.viewModel.frameContext.appContext.runMode === RunMode.highSpeed) {\r\n    //   return;\r\n    // }\r\n    if (typeof ids === 'undefined') {\r\n      ids = this.viewModel.uiState['ids'] || [];\r\n    }\r\n    if (!Array.isArray(ids) || ids.length < 1) {\r\n      // idsrows\r\n      this.viewModel.uiState.setPropertyValue('rows', null);\r\n      return;\r\n    }\r\n    let list = [];\r\n    // TODOrows\r\n    if (this.viewModel.frameContext.appContext.runMode === RunMode.highSpeed) {\r\n      list = this.grid.data || [];\r\n    } else {\r\n      list = this.bindingList.toJSON({ ignoreMultiLangInput: true });\r\n    }\r\n    const rows: Map<string, any> = this.viewModel.uiState['rows'] || new Map<string, any>();\r\n\r\n    const result = new Map<string, any>();\r\n    ids.forEach((id: any) => {\r\n      const item = list.find(item => item[this.primaryKey] === id);\r\n      const otherPageItem = rows.get(id);\r\n      if (item) {\r\n        result.set(id, item);\r\n      } else if (otherPageItem) {\r\n        result.set(id, otherPageItem);\r\n      }\r\n    });\r\n    this.viewModel.uiState.setPropertyValue('rows', result);\r\n  }\r\n  /**\r\n   * grid\r\n   * @param id id\r\n   */\r\n  protected selectGridRow(id: any) {\r\n    this.grid.selectRow(id);\r\n    this.grid.scrollToCurrentRow();\r\n  }\r\n  // #endregion\r\n  // #region \r\n\r\n  /**\r\n   * \r\n   * @param event event\r\n   */\r\n  @HostListener('pageChanged', ['$event'])\r\n  public pageChangedHandler(event: any) {\r\n    let { pageIndex, pageSize } = event;\r\n    if (pageIndex < 1) {\r\n      pageIndex = 1;\r\n    }\r\n    const skip = (pageIndex - 1) * pageSize;\r\n    this.bindingData.setPagingInfo(skip, pageSize, this.bindingData.bindingPath);\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param event event\r\n   */\r\n  @HostListener('selectChanged', ['$event'])\r\n  public selectedRowChanged(event: any) {\r\n    const { index, data } = event;\r\n    const id = data[this.primaryKey];\r\n    this.setSelectionIdToBindingData(id);\r\n    this.fireSelectedRowChange(event);\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param event event\r\n   */\r\n  @HostListener('unSelect', ['$event'])\r\n  public unSelected(event: any) {\r\n    if (!event) {\r\n      return;\r\n    }\r\n    const { data = {} } = event;\r\n    const id = data[this.primaryKey];\r\n    const currentId = this.bindingList.currentId;\r\n    if (id === currentId) {\r\n      this.setSelectionIdToBindingData(null);\r\n    }\r\n    // this.fireSelectedRowChange(event);\r\n  }\r\n  /**\r\n   * \r\n   * @param event event\r\n   */\r\n  @HostListener('checkedChange', ['$event'])\r\n  public checkedChanged(event: any) {\r\n    event = event || [];\r\n    const ids = event.map(item => item.id);\r\n    this.setChecks(ids);\r\n  }\r\n  /**\r\n   * \r\n   * @param event event\r\n   */\r\n  @HostListener('pageSizeChanged', ['$event'])\r\n  public pageSizeChanged(event: any) {\r\n    const { pageIndex, pageSize } = event;\r\n    const skip = 0;//(pageIndex - 1) * pageSize;\r\n    // this.bindingList.setPaginationInfo(skip, pageSize);\r\n    this.bindingData.setPagingInfo(skip, pageSize, this.bindingData.bindingPath);\r\n  }\r\n\r\n  /**\r\n   * grid\r\n   * @param event event\r\n   */\r\n  @HostListener('scrollYLoad', ['$event'])\r\n  public scrollY(event: any) {\r\n    const { pager: pageIndex, pageSize } = event;\r\n    const skip = (pageIndex - 1) * pageSize;\r\n    this.bindingData.setPagingInfo(skip, pageSize, this.bindingData.bindingPath);\r\n  }\r\n  @HostListener('filterChanged', ['$event'])\r\n  public filterChanged(event: any) {\r\n    this.filters = event;\r\n  }\r\n  // #endregion\r\n  private checkIfChangeMatchBindingPath(change: Change): boolean {\r\n    let isMatch = false;\r\n    if (!change || !change.path) {\r\n      return isMatch;\r\n    }\r\n\r\n    const changePathArray = change.path;\r\n    if (!changePathArray) {\r\n      return isMatch;\r\n    }\r\n\r\n    if (!(this.bindingData) && !(this.bindingData.bindingPath)) {\r\n      return isMatch;\r\n    }\r\n    const bingdingPathArray = this.bindingData.bindingPath.split('/');\r\n    if (bingdingPathArray.length <= 0) {\r\n      return isMatch;\r\n    }\r\n\r\n    if (changePathArray.length === 0) { // \r\n      if (this.bindingData.bindingPath === '/') {\r\n        isMatch = true;\r\n      }\r\n    } else if (change.path.length === 1) {// \r\n      if (bingdingPathArray.length === 2 && bingdingPathArray[1] === change.path[0]) {\r\n        isMatch = true;\r\n      }\r\n    } else if (change.path.length === 2) { // \r\n      if (bingdingPathArray.length === 3 && bingdingPathArray[1] === change.path[0] && bingdingPathArray[2] === change.path[1]) {\r\n        isMatch = true;\r\n      }\r\n    }\r\n\r\n    return isMatch;\r\n  }\r\n  private debounce(callback: (...args) => any, wait) {\r\n    let timeoutId = null;\r\n    return (...args) => {\r\n      window.clearTimeout(timeoutId);\r\n      timeoutId = window.setTimeout(() => {\r\n        callback.apply(null, args);\r\n      }, wait);\r\n    };\r\n  }\r\n}\r\n","import { Directive, Input, Self, Host, Optional, OnInit, Output, EventEmitter } from '@angular/core';\r\nimport { MultiSelectComponent } from '@farris/ui-multi-select'\r\nimport { ViewModel, BindingObject } from '@farris/devkit';\r\n\r\n@Directive({\r\n  selector: '[multiSelectDataMapping]'\r\n})\r\nexport class MultiSelectDataMappingDirective implements OnInit {\r\n\r\n  @Input() dataSource: any;\r\n  @Input() idField: string;\r\n  @Input() textField: string;\r\n  @Input() valueField: string;\r\n  @Input() fjmField: string;\r\n  @Input() fjdField: string;\r\n  @Input() uiStateField: any;\r\n  @Input() selectedId: string;\r\n  @Output() selectedIdChanged = new EventEmitter<string>();\r\n  private originalDataSource: any;\r\n\r\n  constructor(\r\n    @Optional() private vm: ViewModel,\r\n    @Host() @Self() @Optional() private multiSelectComponent: MultiSelectComponent\r\n  ) {\r\n    this.vm.uiState.changes.subscribe(data => {\r\n      this.selectedId = data.value;\r\n    })\r\n  }\r\n  ngOnInit() {\r\n    this.multiSelectComponent.dataSource = [];\r\n    if (Array.isArray(this.dataSource)) {\r\n      this.multiSelectComponent.dataSource = this.dataSource;\r\n      this.originalDataSource = this.dataSource;\r\n    } else if (this.dataSource && this.dataSource.changes) {\r\n      this.dataSource.changes.subscribe((data: any) => {\r\n        if (data.type === 'Load') {\r\n          this.originalDataSource = data.value;\r\n          if (this.multiSelectComponent.isTree()) {\r\n            if (this.fjmField) {\r\n              // \r\n              this.multiSelectComponent.dataSource = this.plainToTree(data.value, this.fjmField, 1);\r\n            } else if (this.fjdField) {\r\n              // \r\n              this.multiSelectComponent.dataSource = this.buildTreeNodesByFjd(data.value, this.fjdField);\r\n            }\r\n            this.multiSelectComponent.selections = this.getTreeSelectionsById(this.selectedId, this.originalDataSource);\r\n          } else {\r\n            this.multiSelectComponent.dataSource = data.value;\r\n            this.multiSelectComponent.selections = this.getListSelectionsById(this.selectedId, this.multiSelectComponent.dataSource);\r\n          }\r\n        }\r\n      })\r\n    }\r\n    this.selectIdBindingToUIStateField();\r\n  }\r\n\r\n  private selectIdBindingToUIStateField() {\r\n    if (this.multiSelectComponent && this.multiSelectComponent.selectedIdChange) {\r\n      this.multiSelectComponent.selectedIdChange.subscribe(data => {\r\n        this.selectedIdChanged.emit(data);\r\n      })\r\n    }\r\n  }\r\n  /**\r\n   * \r\n   * @param data \r\n   */\r\n  private formatDataSource(data: any[], field: string) {\r\n    if (!data || !data.length) {\r\n      return [];\r\n    }\r\n    return data.map(item => {\r\n      const n = item['toJSON'] ? item.toJSON() : item;\r\n      return {\r\n        data: Object.assign({ ...n }, {\r\n          [`${this.idField}`]: item[this.idField],\r\n          [`${this.textField}`]: item[this.textField],\r\n          [`${this.valueField}`]: item[this.valueField],\r\n          [`${field}`]: item[field]\r\n        }),\r\n        children: []\r\n      }\r\n    });\r\n  }\r\n  /**\r\n   * \r\n   * @param plainSource \r\n   * @param field \r\n   * @param layer \r\n   */\r\n  private plainToTree(plainSource: any[], field: string, layer: number) {\r\n    const treeSource = this.formatDataSource(plainSource, field);\r\n    if (!treeSource.length) {\r\n      return [];\r\n    }\r\n    if (!treeSource[0]['data'][field]) {\r\n      return [];\r\n    }\r\n    const parents = treeSource.filter(item => {\r\n      return item['data'][field]['layer'] === layer;\r\n    })\r\n    this.recursive(parents, treeSource, field, 1);\r\n    return parents;\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param parents \r\n   * @param treeSource \r\n   * @param field \r\n   * @param layer \r\n   */\r\n  private recursive(parents: any[], treeSource: any[], field: string, layer: number) {\r\n    parents.forEach(parent => {\r\n      const parentPath = parent['data'][field]['path'];\r\n      const parentLayer = parent['data'][field]['layer'];\r\n      if (parent['data'][field]['isDetail'] === false) {\r\n        treeSource.forEach(item => {\r\n          if (item && item['data'] && item['data'][field] && item['data'][field]['path']) {\r\n            const itemPath = item['data'][field]['path'];\r\n            const itemLayer = item['data'][field]['layer'];\r\n            let targetPath: string;\r\n            if (itemPath && itemPath.length > parentPath.length) {\r\n              targetPath = itemPath.substr(0, Number(layer) * 4);\r\n            }\r\n            if (parentPath === targetPath && parentLayer === itemLayer - 1) {\r\n              parent['children'].push(item);\r\n            }\r\n            if (item['data'][field]['isDetail'] === false && parentPath === targetPath) {\r\n              this.recursive([item], treeSource, field, Number(layer) + 1);\r\n            }\r\n          }\r\n        });\r\n      }\r\n    })\r\n  }\r\n  /**\r\n     * \r\n     * @param ids id\r\n     * @param dataSource \r\n     */\r\n  private getListSelectionsById(ids: any, dataSource: any) {\r\n    let result = [];\r\n    const _this = this;\r\n    if ((typeof ids === 'string' && !!ids) || typeof ids === 'number') {\r\n      const reusltObj = dataSource.find(item => {\r\n        return item && item[_this.idField] === ids;\r\n      });\r\n      if (reusltObj) {\r\n        result.push(reusltObj);\r\n      }\r\n    } else if (Array.isArray(ids)) {\r\n      if (dataSource) {\r\n        ids.forEach(id => {\r\n          const item = dataSource.find(item => item && item[_this.idField] === id);\r\n          if (item) {\r\n            result.push(item);\r\n          }\r\n        });\r\n        // dataSource.forEach(item => {\r\n        //   ids.forEach(id => {\r\n        //     if (item[_this.idField] === id) {\r\n        //       result.push(item);\r\n        //     }\r\n        //   })\r\n        // })\r\n      } else {\r\n        result = [];\r\n      }\r\n    } else {\r\n      result = [];\r\n    }\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param ids id\r\n   * @param dataSource \r\n   */\r\n  private getTreeSelectionsById(ids: any, dataSource: any) {\r\n    let result = [];\r\n    const _this = this;\r\n    if ((typeof ids === 'string' && !!ids) || typeof ids === 'number') {\r\n      const reusltObj = dataSource.find(item => {\r\n        return item && item[_this.idField] === ids;\r\n      });\r\n      if (reusltObj) {\r\n        result.push(reusltObj);\r\n      }\r\n    } else if (Array.isArray(ids)) {\r\n      if (dataSource) {\r\n        ids.forEach(id => {\r\n          const item = dataSource.find(item => item && item[_this.idField] === id);\r\n          if (item) {\r\n            result.push(item);\r\n          }\r\n        });\r\n        // dataSource.forEach(item => {\r\n        //   ids.forEach(id => {\r\n        //     if (item.data[_this.idField] === id) {\r\n        //       result.push(item.data);\r\n        //     }\r\n        //   })\r\n        // })\r\n      } else {\r\n        result = [];\r\n      }\r\n    } else {\r\n      result = [];\r\n    }\r\n    return result;\r\n  }\r\n\r\n\r\n\r\n  /**\r\n   * \r\n   * @param bindingObjects \r\n   */\r\n  private buildTreeNodesByFjd(bindingObjects: BindingObject[], field: string) {\r\n    const treeData = this.formatDataSource(bindingObjects, field);\r\n    treeData.forEach((item: any) => {\r\n      const parent = treeData.find((ele: any) => item.data[field].parentElement === ele.data[this.idField]);\r\n      if (parent) {\r\n        parent.children.push(item);\r\n      }\r\n    });\r\n    return treeData.filter((ele: any) => !ele.data[field].parentElement);\r\n  }\r\n}\r\n","import { Subscription } from 'rxjs';\r\nimport { Directive, OnInit, HostListener, Output, EventEmitter, OnDestroy, OnChanges, Input, ChangeDetectorRef } from '@angular/core';\r\nimport { BindingData, BindingList, ViewModel, Change } from '@farris/devkit';\r\nimport { ListViewComponent } from '@farris/ui-list-view';\r\n@Directive({\r\n  selector: '[farrisListviewBinding]'\r\n})\r\n\r\nexport class FarrisListViewBindingDirective implements OnInit, OnDestroy, OnChanges {\r\n  bindingDataChangeEvent: Subscription;\r\n\r\n  /**\r\n   * \r\n   */\r\n  protected get primaryKey() {\r\n    return this.bindingList.primaryKey;\r\n  }\r\n\r\n  @Input() supportPaged: boolean = true;\r\n  /**\r\n   * \r\n   */\r\n  @Output() selectedRowChange: EventEmitter<any> = new EventEmitter<any>();\r\n\r\n  constructor(\r\n    private bindingData: BindingData,\r\n    private viewModel: ViewModel,\r\n    private listview: ListViewComponent) {\r\n\r\n  }\r\n\r\n  ngOnInit() {\r\n    // \r\n    this.bindData();\r\n    this.registerBindingDataChangeEvent();\r\n\r\n  }\r\n\r\n  ngOnChanges() {\r\n    this.bindData();\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.unRegisterBindingDataChangeEvent();\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  protected getPagingInfo() {\r\n    const bindingPath = this.viewModel.bindingPath;\r\n    const bindingData = this.viewModel.bindingData;\r\n    let pagingInfo = bindingData.pagingInfo;\r\n    if (bindingPath === '/') {\r\n      return pagingInfo;\r\n    } else {\r\n      const bindingPaths = bindingPath.substr(1).split('/').filter(item => !!item && item.length > 0).map(item => {\r\n        return item.substring(0, item.length - 1);\r\n      });\r\n      bindingPaths.forEach(path => {\r\n        pagingInfo = pagingInfo && pagingInfo[path];\r\n      });\r\n      return pagingInfo;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * listview\r\n   */\r\n  private setListViewPageProps() {\r\n    const data = this.bindingList.toJSON();\r\n    let skip = 0;\r\n    const { pageIndex = 1, pageSize = 0 } = this.getPagingInfo() || {};\r\n    let { total = 0 } = this.getPagingInfo() || {};\r\n    if (pageIndex > 0) {\r\n      skip = (pageIndex - 1) * pageSize;\r\n    }\r\n    if (pageSize === 0 && total === 0) {\r\n      total = data.length;\r\n    }\r\n    this.listview.supportPaging = this.supportPaged;\r\n    this.listview.pageIndex = pageIndex;\r\n    this.listview.pageSize = pageSize;\r\n    this.listview.total = total;\r\n    let currentPage = pageIndex;\r\n    const itemsPerPage = pageSize;\r\n    let totalItems = total;\r\n    if (pageSize === 0) {\r\n      // this.listview.supportPaging = false;\r\n      this.listview.pageIndex = pageIndex;\r\n      this.listview.total = total;\r\n      currentPage = 1;\r\n      totalItems = total;\r\n    }\r\n    if (this.listview.paginationOptions) {\r\n      this.listview.paginationOptions.itemsPerPage = itemsPerPage;\r\n      this.listview.paginationOptions.currentPage = currentPage;\r\n      this.listview.paginationOptions.pageList = this.listview.pageList;\r\n      this.listview.paginationOptions.totalItems = totalItems;\r\n    }\r\n    const listViewChangeDetectRef: ChangeDetectorRef = this.listview['cdr'] as ChangeDetectorRef;\r\n    if (listViewChangeDetectRef) {\r\n      listViewChangeDetectRef.detectChanges();\r\n    }\r\n    const paginationDirective = this.listview.pager && this.listview.pager['paginationDirective'];\r\n    if (paginationDirective && paginationDirective['service']) {\r\n      try {\r\n        paginationDirective['service'].instances[this.listview.pager.id] = { ...this.listview.paginationOptions };\r\n        paginationDirective['service'].setTotalItems(this.listview.pager.id, totalItems);\r\n        paginationDirective.changeDetectorRef.detectChanges();\r\n      } catch { }\r\n    }\r\n  }\r\n\r\n  /*\r\n   * \r\n   */\r\n  protected get bindingList(): BindingList {\r\n    // \r\n    if (this.viewModel.bindingPath === '/' || !this.viewModel.bindingPath) {\r\n      return this.bindingData.list;\r\n    }\r\n    // \r\n    let bindingPath = this.viewModel.bindingPath.substr(1);\r\n    bindingPath = bindingPath[0].toLowerCase() + bindingPath.substring(1, bindingPath.length);\r\n    const paths = bindingPath.split('/');\r\n\r\n    const filteredPaths = paths.filter((part: string) => {\r\n      return part !== '';\r\n    });\r\n    return this.bindingData.getValue(filteredPaths);\r\n  }\r\n\r\n  /*  */\r\n  private bindData() {\r\n    this.setListViewPageProps();\r\n    const data = this.bindingList.toArray();\r\n    this.listview.setData(data);\r\n  }\r\n\r\n  /*\r\n       * \r\n       * @description \r\n       */\r\n  protected fireSelectedRowChange(selectedRowContext: any) {\r\n    this.selectedRowChange.emit(selectedRowContext);\r\n  }\r\n\r\n  /**\r\n   * BindingList\r\n   * @param id \r\n   */\r\n  protected setSelectionIdToBindingData(id: string): void {\r\n    this.bindingList.setCurrentId(id, true);\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param change \r\n   */\r\n  protected onBindingDataChange(change: Change) {\r\n    this.bindData();\r\n    this.updateSelectedRow(change);\r\n  }\r\n  /**\r\n   * \r\n   * @param change \r\n   */\r\n  private updateSelectedRow(change?: Change) {\r\n    if (!this.bindingList || !this.bindingList.currentId) {\r\n      return;\r\n    }\r\n    if (this.viewModel && this.viewModel.frameContext.bindingData.rowSelectedEventSuspend === true) {\r\n      return;\r\n    }\r\n    const { id = null } = this.listview.clickItem || {};\r\n    const currentId = this.bindingList.currentId;\r\n    // gridbingingList\r\n    if (id === currentId) {\r\n      return;\r\n    }\r\n    this.selectRow(this.bindingList.currentId);\r\n  }\r\n  protected selectRow(id: any) {\r\n    if (this.listview && typeof this.listview.selectRow === 'function') {\r\n      this.listview.selectRow(id);\r\n    }\r\n  }\r\n  /**\r\n   * bindingdata\r\n   */\r\n  private registerBindingDataChangeEvent() {\r\n    this.bindingDataChangeEvent = this.bindingData.changes.subscribe((change: Change) => {\r\n      this.onBindingDataChange(change);\r\n    });\r\n  }\r\n  /**\r\n   * bindingdata\r\n   */\r\n  private unRegisterBindingDataChangeEvent() {\r\n    this.bindingDataChangeEvent.unsubscribe();\r\n  }\r\n  private setChecks(ids: string[]) {\r\n    this.viewModel.uiState.setPropertyValue('ids', ids);\r\n  }\r\n  /*  */\r\n  @HostListener('listClick', ['$event'])\r\n  changeRow(event: any) {\r\n    const { index, data, checkChangeEvent } = event;\r\n    if (checkChangeEvent === false || !event.hasOwnProperty('checkChangeEvent')) {\r\n      if (data && Array.isArray(data) && data.length > 0) {\r\n        const id = data[0] && data[0][this.primaryKey] || null;\r\n        if (id) {\r\n          this.setSelectionIdToBindingData(id);\r\n        }\r\n      }\r\n      this.listview.activeIndex = index;\r\n      this.fireSelectedRowChange(event);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param event \r\n   */\r\n  @HostListener('pageChanged', ['$event'])\r\n  public pageChangedHandler(event: any) {\r\n    let pageIndex = event.pageInfo.pageIndex;\r\n    const pageSize = event.pageInfo.pageSize;\r\n    if (pageIndex < 1) {\r\n      pageIndex = 1;\r\n    }\r\n    const skip = (pageIndex - 1) * pageSize;\r\n    this.bindingData.setPagingInfo(skip, pageSize, this.bindingData.bindingPath);\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param event \r\n   */\r\n  @HostListener('pageSizeChanged', ['$event'])\r\n  public pageSizeChangedHandler(event: any) {\r\n    const { pageIndex, pageSize } = event.pageInfo;\r\n    const skip = (pageIndex - 1) * (+pageSize);\r\n    this.bindingData.setPagingInfo(skip, pageSize, this.bindingData.bindingPath);\r\n  }\r\n  @HostListener('checkValuesChange', ['$event'])\r\n  public checkValuesChange(event: any) {\r\n    const ids = event;\r\n    this.setChecks(ids);\r\n  }\r\n}\r\n","import {\r\n  Directive, OnInit, OnChanges, OnDestroy, SimpleChanges, Input, Injector, NgZone,\r\n} from '@angular/core';\r\nimport { of, Subscription } from 'rxjs';\r\nimport {\r\n  BindingData, BindingList, ViewModel, DataTypeInfo, DataPropInfo, ENABLE_EDIT_STATE_FILTER_SORTING\r\n} from '@farris/devkit';\r\nimport { DatagridComponent } from '@farris/ui-datagrid';\r\nimport { isNumber } from 'lodash-es';\r\nimport { DateTimeHelperService } from '@farris/ui-common/date';\r\nimport { RuntimeStateService } from '@farris/ui-common';\r\nimport { DialogService } from '@farris/ui-dialog';\r\nimport { LookupGridComponent } from '@farris/ui-lookup';\r\nimport { ComboLookupComponent } from '@farris/ui-combo-lookup';\r\n\r\n@Directive({\r\n  selector: '[farris-datagrid-editable]'\r\n})\r\nexport class EditableDirective implements OnInit, OnChanges, OnDestroy {\r\n  /**\r\n   * grid\r\n   */\r\n  @Input('farris-datagrid-editable') gridEditable: boolean;\r\n  /**\r\n   * \r\n   */\r\n  @Input('disableGroupOnEditing') disableGroupOnEditing: boolean = true;\r\n  /**\r\n   * \r\n   */\r\n  private defaultSpliter: string = ',';\r\n  private beginEditSubscription: Subscription;\r\n  private endEditSubscription: Subscription;\r\n  /**\r\n   * grid\r\n   */\r\n  private groupFields: any[] = [];\r\n  protected get bindingList(): BindingList {\r\n    // \r\n    if (this.viewModel.bindingPath === '/' || !this.viewModel.bindingPath) {\r\n      return this.bindingData.list;\r\n    }\r\n    // \r\n    let bindingPath = this.viewModel.bindingPath.substr(1);\r\n    bindingPath = bindingPath[0].toLowerCase() + bindingPath.substring(1, bindingPath.length);\r\n    const paths = bindingPath.split('/');\r\n\r\n    const filteredPaths = paths.filter((part: string) => {\r\n      return part !== '';\r\n    });\r\n    return this.bindingData.getValue(filteredPaths);\r\n  }\r\n  constructor(\r\n    public bindingData: BindingData,\r\n    public viewModel: ViewModel,\r\n    public grid: DatagridComponent,\r\n    private dateService: DateTimeHelperService,\r\n    public injector: Injector,\r\n    private rts: RuntimeStateService,\r\n    public dialogSer: DialogService,\r\n    public ngZone: NgZone\r\n  ) { }\r\n\r\n  ngOnInit() {\r\n    this.apply();\r\n  }\r\n  ngOnChanges(changes: SimpleChanges) {\r\n    this.apply();\r\n  }\r\n  ngOnDestroy() {\r\n    this.detach();\r\n  }\r\n  /**\r\n   * \r\n   */\r\n  private apply() {\r\n    if (!this.grid) {\r\n      return;\r\n    }\r\n    this.handleGroupStatus();\r\n    // \r\n    if (this.gridEditable) {\r\n      const enableFilterSorting = this.injector && this.injector.get<boolean>(ENABLE_EDIT_STATE_FILTER_SORTING, false) || false;\r\n      if (!this.grid.remoteFilter && !enableFilterSorting) {\r\n        this.grid.clearCondition();\r\n        // \r\n        this.viewModel.frameContext.appContext.messagePipe.next('CLEAR_GRID_CONDITION');\r\n      }\r\n\r\n      this.grid.editable = true;\r\n      if (!this.viewModel.frameContext.appContext.enableGridHeaderWhenEditing && !enableFilterSorting) {\r\n        this.grid.disableHeader(true);\r\n      }\r\n      this.handleBeginEditEvent();\r\n      this.handleAfterEditEvent();\r\n      this.handleEndEditEvent();\r\n    } else {\r\n      this.grid.editable = false;\r\n      this.grid.disableHeader(false);\r\n      // TODO:\r\n      // 2023-12-25 \r\n      // this.grid.columns = this.grid.columns.map((cols) => {\r\n      //   return cols.map((col) => Object.assign({}, col));\r\n      // });\r\n      // this.grid.columnsChanged(false);\r\n      if (this.grid && typeof this.grid.sort === 'function' && this.grid.sortName) {\r\n        this.grid.sort();\r\n      }\r\n      this.detach();\r\n    }\r\n  }\r\n  /**\r\n   * \r\n   */\r\n  private handleGroupStatus() {\r\n    if (this.disableGroupOnEditing === false) {\r\n      return;\r\n    }\r\n    const groupField = this.grid && this.grid.groupField || null;\r\n    if (groupField) {\r\n      if (this.gridEditable) {\r\n        this.groupFields = [groupField];\r\n        this.grid.setGroupFields('');\r\n      }\r\n    } else {\r\n      if (this.groupFields && this.groupFields.length > 0) {\r\n        const groupField = this.groupFields.pop();\r\n        if (this.groupFields.length > 0) {\r\n          this.groupFields = [];\r\n        }\r\n        this.grid.setGroupFields(groupField);\r\n      }\r\n    }\r\n  }\r\n  /**\r\n   * \r\n   */\r\n  private handleBeginEditEvent() {\r\n    this.beginEditSubscription = this.grid.beginEdit.subscribe((e: any) => {\r\n      if (!e) {\r\n        return;\r\n      }\r\n      const column = e.column;\r\n      if (column && column.editor) {\r\n        const editorInstance = e.editor.componentRef.instance;\r\n        if (!editorInstance || !editorInstance.instance) {\r\n          return;\r\n        }\r\n        let mapFields = editorInstance.instance.mapFields;\r\n        if (column.editor.type === 'lookup' || column.editor.type === 'PersonnelSelector' || column.editor.type === 'OrganizationSelector' || column.editor.type === 'external-integration' || 'EmployeeSelector' === column.editor.type || 'EmployeeOrgSelector' === column.editor.type) {\r\n          const lookupGrid: LookupGridComponent = editorInstance.instance;\r\n          const subject = editorInstance.instance.selectedData;\r\n          if (subject) {\r\n            subject.subscribe((data: any) => {\r\n              mapFields = editorInstance.instance.mapFields;\r\n              const spliter = lookupGrid.multipleChoiceSeparator || this.defaultSpliter;\r\n              this.lookupMapping(data, mapFields, false, spliter);\r\n            });\r\n          }\r\n          const clearMappings = editorInstance.instance.clearMappings;\r\n          if (clearMappings) {\r\n            clearMappings.subscribe((result: any) => {\r\n              const mapFields = Object.assign({}, editorInstance.instance.mapFields);\r\n              const value = result && result.value || null;\r\n              const binding = editorInstance.column && editorInstance.column.field;\r\n              const lookupTextField = editorInstance.instance.textField;\r\n              const data = {};\r\n              if (binding) {\r\n                const textFieldMapping = mapFields[lookupTextField];\r\n                if (textFieldMapping) {\r\n                  const otherField: string = textFieldMapping.split(',').filter((item) => item !== binding).join(',');\r\n                  if (otherField) {\r\n                    mapFields[lookupTextField] = otherField;\r\n                  } else {\r\n                    delete mapFields[lookupTextField];\r\n                  }\r\n                }\r\n                const parentPaths = this.getBindingPathArray();\r\n                this.bindingData.setValue(parentPaths.concat(binding.split('.')), value, true, true);\r\n              }\r\n              // this.setValue(data, lookupTextField.split('.'), value);\r\n              if (mapFields && Object.keys(mapFields).length > 0) {\r\n                Object.keys(mapFields).forEach((field) => {\r\n                  this.setValue(data, field.split('.'), '');\r\n                });\r\n                this.lookupMapping(data, mapFields, true);\r\n              }\r\n            });\r\n          }\r\n        }\r\n\r\n        if (column.editor.type === 'combo-lookup') {\r\n          editorInstance.instance.valueChange.subscribe((e: any) => {\r\n            const asClear = e && e.selections && e.selections.length === 0;\r\n            const comboLookup: ComboLookupComponent = editorInstance.instance;\r\n            mapFields = editorInstance.instance.mapFields;\r\n            const spliter = comboLookup.separator || this.defaultSpliter;\r\n            this.lookupMapping(e.selections || [], mapFields, asClear, spliter);\r\n          });\r\n        }\r\n        if (['combo-lookup', 'combolist', 'lookup', 'PersonnelSelector', 'OrganizationSelector', 'external-integration', 'EmployeeSelector', 'EmployeeOrgSelector'].includes(column.editor.type)) {\r\n          if (editorInstance.instance.clear && editorInstance.instance.clear.subscribe) {\r\n            editorInstance.instance.clear.subscribe(() => {\r\n              this.lookupMapping(null, mapFields);\r\n            });\r\n          }\r\n        }\r\n\r\n        if (column.editor.type === 'combolist') {\r\n          if (mapFields) {\r\n            editorInstance.instance.valueChange.subscribe((e) => {\r\n              const pathArr = this.getBindingPathArray();\r\n              this.viewModel.bindingData.setValue(pathArr.concat(mapFields.split('.')), editorInstance.instance.selectedValues, true, true);\r\n            });\r\n          }\r\n        }\r\n      }\r\n    });\r\n  }\r\n  /**\r\n   * \r\n   */\r\n  private handleAfterEditEvent() {\r\n    this.grid.afterEdit = (rowIndex, rowData, column, editor) => {\r\n      if (this.dialogSer.hasDialogOpened()) {\r\n        return of(false);\r\n      }\r\n      if (this.rts) {\r\n        // \r\n        if (this.rts.getFormState('lookup.pending')) {\r\n          return of(false);\r\n        }\r\n      }\r\n      // \r\n      if (!editor || !editor.formControl) {\r\n        return of(false);\r\n      }\r\n      return of(true);\r\n    };\r\n  }\r\n  /**\r\n   * \r\n   */\r\n  private handleEndEditEvent() {\r\n    this.endEditSubscription = this.grid && this.grid.endEdit && this.grid.endEdit.subscribe((event: any) => {\r\n      const { value = undefined, column = undefined, rowData = {} } = event || {};\r\n      const primaryValue = rowData && rowData[this.grid.idField] || null;\r\n      this.updateBindingData(value, column, primaryValue);\r\n    });\r\n  }\r\n  /*\r\n   *  formcontrol\r\n   */\r\n  private updateBindingData(value: any, column: any, primaryValue?: any) {\r\n    if (!column) {\r\n      return;\r\n    }\r\n    const currentColumnType = column.dataType;\r\n    // gridOption\r\n\r\n    const fieldPaths = column.field.split('.');\r\n    // \r\n    const isBigNumber = column && column.editor && column.editor.options && column.editor.options.bigNumber;\r\n    // \r\n    if (currentColumnType === 'date') {\r\n      let result;\r\n      if (value) {\r\n        result = this.dateService.formatTo(value, 'yyyy-MM-dd');\r\n      } else {\r\n        result = value;\r\n      }\r\n      this.updateBindingList(primaryValue, fieldPaths.join('.'), result);\r\n    } else if (currentColumnType === 'datetime') {\r\n      // if (!value) {\r\n      //   value = '0001-01-01T00:00:00';\r\n      // }\r\n      this.updateBindingList(primaryValue, fieldPaths.join('.'), value);\r\n    } else if (currentColumnType === 'number' && !isBigNumber) {\r\n      if (value === null || value === undefined) {\r\n        this.updateBindingList(primaryValue, fieldPaths.join('.'), null);\r\n      } else {\r\n        this.updateBindingList(primaryValue, fieldPaths.join('.'), Number(value));\r\n      }\r\n    } else {\r\n      this.updateBindingList(primaryValue, fieldPaths.join('.'), value);\r\n    }\r\n  }\r\n  private updateBindingList(primaryValue: any, propertyName: string, value: any) {\r\n    const viewModel = this.viewModel || null;\r\n    if (!viewModel || !propertyName) {\r\n      return;\r\n    }\r\n    // \r\n    const propertyNames = propertyName.split('.').filter((item) => item);\r\n    const bindingPath = this.getBindingPathArray();\r\n    // bindingList\r\n    const list = this.bindingData.getValue(bindingPath) as BindingList;\r\n    // \r\n    if (list && primaryValue === list.currentItem.primaryKeyValue) {\r\n      const paths = bindingPath.concat(propertyNames);\r\n      this.bindingData.setValue(paths, value, true, true);\r\n      return;\r\n    }\r\n    const bindingObject = this.bindingList.findById(primaryValue);\r\n    if (!bindingObject) {\r\n      return;\r\n    }\r\n    if (propertyNames.length < 2) {\r\n      bindingObject.setValue(propertyName, value, true, true);\r\n    } else {\r\n      let targetBindingObject = null;\r\n      const fpaths = propertyNames.slice(0, propertyNames.length - 1);\r\n      const targetPropertyName = propertyNames[propertyNames.length - 1];\r\n      fpaths.forEach((prop) => {\r\n        targetBindingObject = targetBindingObject && targetBindingObject[prop] || bindingObject[prop];\r\n      });\r\n      // todo:\r\n      targetBindingObject.setValue(targetPropertyName, value, true, true);\r\n    }\r\n  }\r\n  private detach() {\r\n    if (this.beginEditSubscription && typeof this.beginEditSubscription.unsubscribe === 'function') {\r\n      this.beginEditSubscription.unsubscribe();\r\n    }\r\n    if (this.endEditSubscription && typeof this.endEditSubscription.unsubscribe === 'function') {\r\n      this.endEditSubscription.unsubscribe();\r\n    }\r\n  }\r\n\r\n  //#region \r\n\r\n  private lookupMapping(helpData: any, mapFields: any, asClear: boolean = false, spliter: string = ',') {\r\n    if (!mapFields) {\r\n      return;\r\n    }\r\n    // \r\n    const appContext = this.viewModel.frameContext.appContext;\r\n    appContext.changeDetectionController.detach();\r\n\r\n    const pathArr = this.getBindingPathArray();\r\n    let helpFields = Object.keys(mapFields);\r\n    const primaryInfo = this.getMapFieldsPrimaryKey(mapFields, pathArr);\r\n\r\n    let primaryKeys = primaryInfo && primaryInfo.map((item) => item.primaryKey) || [];\r\n    const primaryFields = primaryInfo && primaryInfo.map((item) => item.primaryField) || [];\r\n    // \r\n    if (primaryKeys && primaryKeys.length > 0) {\r\n      primaryKeys = [...new Set(primaryKeys)];\r\n      helpFields = this.sortMapFieldKeys(helpFields, primaryKeys);\r\n    }\r\n\r\n    if (!helpData || asClear) {\r\n      helpFields.reverse();\r\n    }\r\n    helpFields.forEach((f: any) => {\r\n      let val: any = '';\r\n      if (helpData) {\r\n        if (helpData instanceof Array) {\r\n          val = helpData.map((h: any) => {\r\n            return this.getValue(f, h);\r\n          }).join(spliter);\r\n        } else {\r\n          val = this.getValue(f, helpData);\r\n        }\r\n      }\r\n\r\n      let mappings: any[] = mapFields[f].split(',');\r\n      const headMappings = mappings.filter((p) => primaryFields.includes(p));\r\n      const leftMappings = mappings.filter((p) => !primaryFields.includes(p));\r\n      if (!helpData) {\r\n        mappings = [].concat(leftMappings).concat(headMappings);\r\n      } else {\r\n        mappings = [].concat(headMappings).concat(leftMappings);\r\n      }\r\n      mappings.forEach((ff: any) => {\r\n        if (!helpData) {\r\n          this.viewModel.bindingData.clearValue(pathArr.concat(ff.split('.')), true, true);\r\n        } else {\r\n          this.viewModel.bindingData.setValue(pathArr.concat(ff.split('.')), val, true, true);\r\n        }\r\n      });\r\n    });\r\n\r\n    // \r\n    appContext.changeDetectionController.reattach();\r\n  }\r\n\r\n  private getValue(f: string, data: any) {\r\n    let val = '';\r\n    if (f.indexOf('.') === -1) {\r\n      val = data[f];\r\n    } else {\r\n      val = f.split('.').reduce((a, b) => {\r\n        return a[b];\r\n      }, data);\r\n    }\r\n\r\n    return val;\r\n  }\r\n\r\n  private getBindingPathArray(): any[] {\r\n    const path = this.viewModel.bindingPath;\r\n    if (path) {\r\n      return path.split('/').filter((n) => n !== '');\r\n    }\r\n    return [];\r\n  }\r\n\r\n  private isNumberValue(field, data) {\r\n    const currentVal = this.getValue(field, data);\r\n    return isNumber(currentVal);\r\n  }\r\n\r\n  //#endregion\r\n  /**\r\n   *\r\n   * @param mapFields  {id: \"assoField.assoField\", code: \"assoField.assoField_Code\", name: \"assoField.assoField_Name\"}  {id:'vid',code:'code',name:'name'}\r\n   */\r\n  private getMapFieldsPrimaryKey(mapFields: any, bindingPaths: string[]): Array<{ primaryKey: string, primaryField: string }> {\r\n    if (!mapFields || Object.keys(mapFields).length < 1) {\r\n      return null;\r\n    }\r\n    const results = [];\r\n    // let primaryField = null;\r\n    try {\r\n      const entityTypeInfo: DataTypeInfo = this.viewModel.frameContext.repository.entityTypeInfo;\r\n      Object.keys(mapFields).forEach((key: string) => {\r\n        const mapField = mapFields[key];\r\n        if (mapField && typeof mapField === 'string') {\r\n          const mappings = mapField.split(',').filter((p) => p);\r\n          mappings.forEach((item: string) => {\r\n            let paths = item.split('.');\r\n            if (bindingPaths && bindingPaths.length > 0) {\r\n              paths = bindingPaths.concat(paths);\r\n            }\r\n            const propInfo: DataPropInfo = entityTypeInfo.getPropInfoByPath(paths);\r\n            if (propInfo && propInfo.metadataInfo && propInfo.metadataInfo.primary === true) {\r\n              results.push({\r\n                primaryKey: key,\r\n                primaryField: item\r\n              });\r\n            }\r\n          });\r\n        }\r\n      });\r\n    } catch (e) {\r\n      console.error(e);\r\n    }\r\n    return results;\r\n  }\r\n  private setValue(target: object, paths: string[], value: any) {\r\n    if (target) {\r\n      if (paths.length <= 1) {\r\n        target[paths[0]] = value;\r\n      } else {\r\n        paths.slice(0, -1).reduce((prev, path) => {\r\n          if (!(prev.hasOwnProperty(path) || prev['__proto__'].hasOwnProperty(path))) {\r\n            prev[path] = {};\r\n          }\r\n          return prev[path];\r\n        }, target)[paths[paths.length - 1]] = value;\r\n      }\r\n    }\r\n  }\r\n  private sortMapFieldKeys(keys: string[], primaryKeys: string[]): string[] {\r\n    if (!primaryKeys || primaryKeys.length < 1 || !keys || keys.length < 1) {\r\n      return keys;\r\n    }\r\n    // \r\n    keys = keys.filter((p) => !primaryKeys.includes(p));\r\n    return [].concat(primaryKeys).concat(keys);\r\n  }\r\n}\r\n","import { AppContext } from '@farris/devkit';\r\nimport { Subject } from 'rxjs';\r\nimport { OnDestroy } from '@angular/core';\r\n\r\nabstract class AbstractEndEdit implements OnDestroy {\r\n  private messagePipe: Subject<any>;\r\n  constructor(protected appContext: AppContext) {\r\n    this.messagePipe = this.appContext && this.appContext.messagePipe;\r\n    if (this.messagePipe) {\r\n      this.messagePipe.subscribe((message: any) => {\r\n        if (message && message.type === 'endEdit') {\r\n          this.endEdit(message);\r\n        }\r\n      });\r\n    }\r\n  }\r\n  ngOnDestroy(): void {\r\n    // if (this.messagePipe) {\r\n    //   this.messagePipe.unsubscribe();\r\n    // }\r\n  }\r\n  public abstract endEdit(message: any);\r\n}\r\nexport { AbstractEndEdit };\r\n","import { Directive, ElementRef, OnInit, OnChanges, SimpleChanges } from '@angular/core';\r\nimport { AppContext } from '@farris/devkit';\r\nimport { AbstractEndEdit } from './abstract_end_edit';\r\n\r\n@Directive({\r\n  selector: '[input-end-edit]'\r\n})\r\nclass InputEndEditDirective extends AbstractEndEdit implements OnInit {\r\n  private nativeElement: any;\r\n  constructor(protected appContext: AppContext, private elementRef: ElementRef) {\r\n    super(appContext);\r\n  }\r\n  ngOnInit(): void {\r\n    if (this.elementRef) {\r\n      this.nativeElement = this.elementRef.nativeElement;\r\n    }\r\n  }\r\n  /**\r\n   * \r\n   * @param message \r\n   */\r\n  public endEdit(message: any) {\r\n    if (this.nativeElement) {\r\n      const parent: any = this.nativeElement.parentNode || this.nativeElement.parentElement;\r\n      const inputs: Array<any> = parent && Array.from(parent.getElementsByTagName('input')) || [];\r\n      if (inputs && inputs.length > 0) {\r\n        inputs.forEach(input => {\r\n          if (input && typeof (input.blur) === 'function') {\r\n            input.blur();\r\n          }\r\n        });\r\n      }\r\n    }\r\n  }\r\n}\r\nexport { InputEndEditDirective };\r\n","import { Directive } from '@angular/core';\r\nimport { AppContext } from '@farris/devkit';\r\nimport { DatagridComponent } from '@farris/ui-datagrid';\r\nimport { AbstractEndEdit } from './abstract_end_edit';\r\n\r\n@Directive({\r\n  selector: '[farris-grid-end-edit]'\r\n})\r\nclass FarrisDataGridEndEditDirective extends AbstractEndEdit {\r\n  constructor(protected appContext: AppContext, private datagrid: DatagridComponent) {\r\n    super(appContext);\r\n  }\r\n  /**\r\n   * \r\n   * @param message message\r\n   */\r\n  public endEdit(message: any) {\r\n    if (this.datagrid && typeof this.datagrid.endCellEdit === 'function') {\r\n      this.datagrid.endCellEdit();\r\n    }\r\n  }\r\n}\r\nexport { FarrisDataGridEndEditDirective };\r\n","import { AppContext } from '@farris/devkit';\r\nimport { HtmlEditorComponent } from '@farris/ui-html-editor';\r\nimport { AbstractEndEdit } from './abstract_end_edit';\r\nimport { Directive } from '@angular/core';\r\n@Directive({\r\n  selector: '[html-editor-end-edit]'\r\n})\r\nclass HtmlEditorEndEditDirective extends AbstractEndEdit {\r\n  constructor(protected appContext: AppContext, private editor: HtmlEditorComponent) {\r\n    super(appContext);\r\n  }\r\n  public endEdit(message: any) {\r\n    if (this.editor && typeof this.editor.endEdit === 'function') {\r\n      this.editor.endEdit();\r\n    }\r\n  }\r\n\r\n}\r\nexport { HtmlEditorEndEditDirective };\r\n","import { Directive } from '@angular/core';\r\nimport { AppContext } from '@farris/devkit';\r\nimport { GridComponent } from '@progress/kendo-angular-grid';\r\nimport { AbstractEndEdit } from './abstract_end_edit';\r\n\r\n@Directive({\r\n  selector: '[kendo-grid-end-edit]'\r\n})\r\nclass KendoGridEndEditDirective extends AbstractEndEdit {\r\n  constructor(protected appContext: AppContext, private grid: GridComponent) {\r\n    super(appContext);\r\n  }\r\n  public endEdit(message: any) {\r\n    if (this.grid && typeof this.grid.closeCell === 'function') {\r\n      this.grid.closeCell();\r\n    }\r\n  }\r\n}\r\nexport { KendoGridEndEditDirective };\r\n","import { Directive, Input } from '@angular/core';\r\nimport { Observable } from 'rxjs';\r\nimport { ViewModel } from '@farris/devkit';\r\nimport { DatagridComponent } from '@farris/ui-datagrid';\r\n\r\n\r\n@Directive({\r\n  selector: \"[farris-remote-summary-command]\"\r\n})\r\nexport class FarrisDataGridRemoteSummaryDirective {\r\n  /**\r\n   * \r\n   */\r\n  @Input('farris-remote-summary-command') remoteSummaryCommand: string;\r\n\r\n  constructor(public viewModel: ViewModel, public grid: DatagridComponent) {\r\n    const appContext = this.viewModel.frameContext.getFormAppContext();\r\n    if (appContext && appContext.hasOwnProperty('messagePipe')) {\r\n      appContext.messagePipe.subscribe((message: any) => {\r\n        const messageType = message && message.type || null;\r\n        // \r\n        if (messageType === 'query') {\r\n          if (this.remoteSummaryCommand && this.grid.footerDataFrom === 'server') {\r\n            const paths = this.remoteSummaryCommand.split('.');\r\n            let func = null;\r\n            paths.forEach(path => {\r\n              func = func && func[path] || this[path];\r\n            });\r\n            if (typeof func === 'function') {\r\n              func().subscribe(result => {\r\n                this.grid.footerData = result;\r\n              });\r\n            }\r\n          }\r\n        }\r\n      });\r\n    }\r\n  }\r\n  /**\r\n   * \r\n   * @param commandName \r\n   * @param frameId frameId\r\n   */\r\n  private execute(commandName: string, frameId?: string): Observable<any> {\r\n    if (!commandName || commandName === '' || commandName === 'undefined') {\r\n      return;\r\n    }\r\n    let viewModel = this.viewModel;\r\n    if (frameId) {\r\n      const targetContext = viewModel.frameContext.appContext.frameContextManager.getFrameContextById(frameId);\r\n      viewModel = targetContext.viewModel;\r\n    }\r\n    return viewModel[commandName]();\r\n  }\r\n\r\n}\r\n","import { Directive, Input, Renderer2, Injector, OnInit, ElementRef } from '@angular/core';\r\nimport { BehaviorSubject } from 'rxjs';\r\n\r\n@Directive({\r\n    selector: '[farris-set-focus]'\r\n})\r\nexport class FarrisSetFocusDirective implements OnInit {\r\n\r\n    @Input() set focusState(value: boolean) {\r\n        this._state.next(value);\r\n    }\r\n    private selfEl: HTMLElement\r\n    private _state: BehaviorSubject<any> = new BehaviorSubject({});\r\n\r\n    constructor(\r\n        private rd: Renderer2,\r\n        private injector: Injector,\r\n        private el: ElementRef\r\n    ) {\r\n\r\n    }\r\n\r\n    ngOnInit(): void {\r\n        this.selfEl = this.el.nativeElement;\r\n        this._state.subscribe(data => {\r\n            if (data === false && this.selfEl) {\r\n                if (this.selfEl.nodeName.toLowerCase() === 'farris-html-editor') {\r\n                    this.setHtmlEditorFocus();\r\n                } else {\r\n                    this.setFocus();\r\n                }\r\n            }\r\n        })\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    setFocus() {\r\n        const input = this.selfEl.querySelectorAll('input');\r\n        if (input.length) {\r\n            input[0].focus()\r\n        } else {\r\n            this.selfEl.focus();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * html  \r\n     */\r\n    setHtmlEditorFocus() {\r\n        // input\r\n        const ediotrArea = this.selfEl.querySelector('div[contenteditable=\"true\"]');\r\n        //range  \r\n        const range = window.getSelection();\r\n        //range obj\r\n        range.selectAllChildren(ediotrArea);\r\n        //\r\n        range.collapseToEnd();\r\n    }\r\n}","import { Directive, OnInit, OnChanges, SimpleChanges, Input, Injector, Optional, HostListener } from '@angular/core';\r\nimport { BindingData, BindingList, FrameContext, Change, ChangeType } from '@farris/devkit';\r\nimport { UploadFile, FFilePreviewComponent, UploadAndPreviewComponent } from '@farris/extend-file-upload';\r\n\r\n/**\r\n * \r\n */\r\n@Directive({\r\n  selector: '[farrisFilePreviewBinding]'\r\n})\r\nclass FarrisFilePreviewBindingDirective implements OnInit, OnChanges {\r\n  private __DATA__: any;\r\n  /**\r\n   * \r\n   */\r\n  private readonly DEFAULT_SORT_FIELD = 'createTime';\r\n  /**\r\n   * fileSortOrder\r\n   */\r\n  private readonly SORT_FIELD_ON_SORTING = 'fileSortOrder';\r\n  @Input('extendFileInfo')\r\n  public extendFileInfo: { key: string, path: any }[];\r\n  /**\r\n   * \r\n   */\r\n  @Input('farrisOrderType')\r\n  public farrisOrderType: string;\r\n  /**\r\n   * id\r\n   */\r\n  @Input('farrisFileIdKey')\r\n  public fileIdKey: string;\r\n  /**\r\n   * \r\n   */\r\n  @Input('farrisFileSortOrderKey')\r\n  public fileSortOrderKey: string;\r\n  /**\r\n   * name\r\n   */\r\n  @Input('farrisFileNameKey')\r\n  public fileNameKey: string;\r\n\r\n  /**\r\n   * \r\n   */\r\n  private get bindingData(): BindingData {\r\n    return this.frameContext.bindingData;\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  private get bindingList(): BindingList {\r\n    return this.bindingData.getList();\r\n  }\r\n  /**\r\n   * \r\n   * @description\r\n   * \r\n   * fileSortOrdercreateTime\r\n   */\r\n  private get orderField() {\r\n    return this.uploadAndPreviewComponent && this.uploadAndPreviewComponent.enableOrder && this.uploadAndPreviewComponent.orderField || this.fileSortOrderKey && this.SORT_FIELD_ON_SORTING || this.DEFAULT_SORT_FIELD;\r\n  }\r\n  /**\r\n   * \r\n   */\r\n  private get orderType() {\r\n    return this.farrisOrderType ? this.farrisOrderType : this.orderField === this.DEFAULT_SORT_FIELD ? 'desc' : 'asc';\r\n  }\r\n  /**\r\n   * \r\n   * @param previewComponent - \r\n   * @param frameContext - \r\n   * @param uploadAndPreviewComponent - \r\n   * @param injector - injector\r\n   * @TODO: uploadAndPreviewComponentnull\r\n   */\r\n  constructor(\r\n    @Optional() private previewComponent: FFilePreviewComponent,\r\n    private frameContext: FrameContext,\r\n    @Optional() private uploadAndPreviewComponent: UploadAndPreviewComponent,\r\n    @Optional() private injector: Injector\r\n  ) {\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  ngOnInit() {\r\n    this.bindData();\r\n    if (this.uploadAndPreviewComponent) {\r\n      if (this.uploadAndPreviewComponent.enableOrder) {\r\n        this.uploadAndPreviewComponent.orderField = this.SORT_FIELD_ON_SORTING;\r\n      }\r\n      // \r\n      this.uploadAndPreviewComponent.enableSorting = false;\r\n      this.uploadAndPreviewComponent.fSelectedEvent.subscribe((event: any) => {\r\n        const primaryKey = this.bindingList.primaryKey;\r\n        const id = event && event.originalData && event.originalData[primaryKey];\r\n        if (id && id !== this.bindingList.currentId) {\r\n          this.bindingList.setCurrentId(id, true);\r\n        }\r\n      });\r\n    }\r\n    this.bindingData.changes.subscribe((change: Change) => {\r\n      // \r\n      if (change.type === ChangeType.Load || change.type === ChangeType.Append || change.type === ChangeType.Remove || change.type === ChangeType.ValueChanged || change.type === ChangeType.SelectionChanged) {\r\n        this.bindData(change);\r\n        this.updateCurrentRow(change);\r\n        this.updateChecks(change);\r\n      }\r\n    });\r\n    this.setChecks([]);\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param changes -\r\n   */\r\n  ngOnChanges(changes: SimpleChanges) {\r\n  }\r\n  private shouldComponentUpdate(data: any) {\r\n    return !(JSON.stringify(this.__DATA__) === JSON.stringify(data));\r\n    // return !(this.__DATA__ && isEqual(this.__DATA__, data));\r\n  }\r\n  /**\r\n   * \r\n   * @param change -\r\n   */\r\n  private bindData(change?: Change) {\r\n    const bindingPath = this.frameContext.viewModel.bindingPath.split('/').filter(p => p).join('/');\r\n    const eventPath = change && change.path && change.path.filter(p => p).join('/');\r\n    //  \r\n    if (change && [ChangeType.SelectionChanged, ChangeType.Remove, ChangeType.Load, ChangeType.Append].includes(change.type)) {\r\n      // \r\n      if (!bindingPath.startsWith(eventPath)) {\r\n        return;\r\n      }\r\n      // \r\n      if (change.type === ChangeType.SelectionChanged && bindingPath === eventPath) {\r\n        return;\r\n      }\r\n    }\r\n    // \r\n    if (change && change.type === ChangeType.ValueChanged && !eventPath.startsWith(bindingPath)) {\r\n      return;\r\n    }\r\n    const fileInfos = this.getFileInfos();\r\n    if (!this.shouldComponentUpdate(fileInfos)) {\r\n      return;\r\n    }\r\n    if (this.componentRef) {\r\n      this.__DATA__ = fileInfos;\r\n      this.componentRef.fileInfos = fileInfos;\r\n      if (this.uploadAndPreviewComponent && fileInfos && fileInfos.length > 0) {\r\n        const extendInfos = fileInfos.map((item: any) => item.originalData);\r\n        this.uploadAndPreviewComponent.extendInfos = extendInfos;\r\n      }\r\n      this.changeCurrentRow(fileInfos, change);\r\n    }\r\n  }\r\n  private updateChecks(change?: Change) {\r\n    if (!this.uploadAndPreviewComponent) {\r\n      return;\r\n    }\r\n    const bindingPath = this.frameContext.viewModel.bindingPath.split('/').filter(p => p).join('/');\r\n    const eventPath = change && change.path && change.path.filter(p => p).join('/');\r\n    // \r\n    if (change && change.type === ChangeType.Remove && eventPath === bindingPath) {\r\n      const values = change.value || [];\r\n      const ids: any[] = this.frameContext.uiState['ids'] || [];\r\n      if (values.length > 0 && ids.length > 0) {\r\n        values.forEach((id: string) => {\r\n          const index = ids.indexOf(id);\r\n          if (index !== -1) {\r\n            ids.splice(index, 1);\r\n          }\r\n        });\r\n      }\r\n    } else if ((change.type === ChangeType.Remove || change.type === ChangeType.SelectionChanged) && bindingPath.startsWith(eventPath) && bindingPath !== eventPath) {\r\n      //\r\n      this.setChecks([]);\r\n      // \r\n      this.clearComponentChecks();\r\n    } else if (change && change.type === ChangeType.Load && (bindingPath === eventPath || bindingPath.startsWith(eventPath) && bindingPath !== eventPath)) {\r\n      //  or \r\n      this.setChecks([]);\r\n      // \r\n      this.clearComponentChecks();\r\n    }\r\n  }\r\n  /**\r\n   * \r\n   * @param data - \r\n   * @param change - \r\n   */\r\n  private changeCurrentRow(data: any, change?: Change) {\r\n    if (!this.uploadAndPreviewComponent) {\r\n      return;\r\n    }\r\n    const changePath = change && change.path.join('/');\r\n    const paths = this.frameContext.viewModel.bindingPath.split('/').filter(p => p);\r\n    const path = paths.join('/');\r\n    const isParentSelectChange = path.startsWith(changePath) && change.type === ChangeType.SelectionChanged && path !== changePath;\r\n    const isSelfRowDelete = change && change.type === ChangeType.Remove && path === changePath;\r\n    if (data && data.length > 0 && change && (change.type === ChangeType.Load || isParentSelectChange || isSelfRowDelete)) {\r\n      const primaryKey = this.bindingList.primaryKey;\r\n      const id = data[0]['originalData'] && data[0]['originalData'][primaryKey];\r\n      if (this.bindingList.currentId !== id) {\r\n        setTimeout(() => {\r\n          this.bindingList.setCurrentId(id, true, true);\r\n        }, 100);\r\n      }\r\n    }\r\n  }\r\n  /**\r\n   * \r\n   * @param change - \r\n   * @returns\r\n   */\r\n  private updateCurrentRow(change?: Change) {\r\n    if (!this.bindingList || !this.bindingList.currentId || !this.uploadAndPreviewComponent) {\r\n      return;\r\n    }\r\n    if (change && change.type !== ChangeType.SelectionChanged && change.type !== ChangeType.Load && change.type !== ChangeType.Remove) {\r\n      return;\r\n    }\r\n    const currentId = this.uploadAndPreviewComponent.previewCurrent;\r\n    // idid\r\n    const id = this.getValueByPath(this.bindingList.currentItem, this.fileIdKey);\r\n    if (id === currentId) {\r\n      return;\r\n    }\r\n    this.selectComponentRow(id);\r\n  }\r\n  /**\r\n   * \r\n   */\r\n  private getFileInfos(): UploadFile[] {\r\n    const listData = this.bindingList.toJSON();\r\n    const fileInfos: UploadFile[] = [];\r\n    listData.forEach((itemData: any) => {\r\n      const fileInfo = this.convertToFileInfo(itemData);\r\n      fileInfos.push(fileInfo);\r\n    });\r\n    // \r\n    if (this.orderField) {\r\n      this.sort(fileInfos, this.orderField, this.orderType);\r\n    }\r\n    return fileInfos;\r\n  }\r\n  /**\r\n   * \r\n   * @param itemData - \r\n   * @returns\r\n   */\r\n  private convertToFileInfo(itemData: any) {\r\n    // const idKey = this.bindingList.primaryKey;\r\n    // const id = this.getValueByPath(itemData, idKey);\r\n    const fileId = this.getValueByPath(itemData, this.fileIdKey);\r\n    const fileName = this.getValueByPath(itemData, this.fileNameKey);\r\n    const fileSize = this.getValueByPath(itemData, this.fileSizeKey);\r\n    const fileCreateTime = this.getValueByPath(itemData, this.fileCreateTimeKey);\r\n\r\n    const fileInfo: any = {\r\n      id: fileId,\r\n      name: fileName,\r\n      size: fileSize,\r\n      createTime: fileCreateTime,\r\n      originalData: itemData,\r\n      extend: {\r\n        metadataId: fileId\r\n      }\r\n    };\r\n    if (this.extendFileInfo && Array.isArray(this.extendFileInfo) && this.extendFileInfo.length > 0) {\r\n      this.extendFileInfo.forEach((item) => {\r\n        fileInfo[item.key] = this.getValueByPath(itemData, item.path);\r\n      });\r\n    }\r\n    if (this.fileSortOrderKey) {\r\n      const fileSortOrder = this.getValueByPath(itemData, this.fileSortOrderKey);\r\n      fileInfo[this.SORT_FIELD_ON_SORTING] = fileSortOrder;\r\n    }\r\n    return fileInfo;\r\n  }\r\n  /**\r\n   * \r\n   * @param id \r\n   */\r\n  private selectComponentRow(id) {\r\n    if (this.uploadAndPreviewComponent) {\r\n      this.uploadAndPreviewComponent.previewCurrent = id;\r\n    }\r\n  }\r\n  /**\r\n   * \r\n   * @param data - \r\n   * @param path - \r\n   */\r\n  private getValueByPath(data: any, path: string): any {\r\n    const keys = path.split('.');\r\n    let currentValue = data;\r\n    keys.forEach((key: string) => {\r\n      currentValue = currentValue && currentValue[key];\r\n    });\r\n    return currentValue;\r\n  }\r\n  private getUdtPaths(): string[] {\r\n    const paths = this.fileIdKey.split('.');\r\n    paths.pop();\r\n    return paths;\r\n  }\r\n  private get fileSizeKey() {\r\n    const basePaths = this.getUdtPaths();\r\n    return basePaths.concat(['fileSize']).join('.');\r\n  }\r\n  private get fileCreateTimeKey() {\r\n    const basePaths = this.getUdtPaths();\r\n    return basePaths.concat(['fileCreateTime']).join('.');\r\n  }\r\n  private get componentRef() {\r\n    return this.previewComponent || this.uploadAndPreviewComponent || null;\r\n  }\r\n  private setChecks(ids: any) {\r\n    this.frameContext.uiState.setPropertyValue('ids', ids);\r\n  }\r\n  /**\r\n   * \r\n   */\r\n  private clearComponentChecks() {\r\n    if (this.uploadAndPreviewComponent) {\r\n      this.uploadAndPreviewComponent.previewUpdateRefresh();\r\n    }\r\n  }\r\n  public sort(data: any[], fields: string | Array<string>, directions: string | Array<string>) {\r\n    if (!fields || fields.length < 1 || !directions || directions.length < 1) {\r\n      throw new Error('sortBy:argument error');\r\n    }\r\n    // \r\n    const arrFields: Array<string> = typeof fields === 'string' ? fields.split(',') : fields || [];\r\n    const arrDirections: Array<string> = typeof directions === 'string' ? directions.split(',') : directions || [];\r\n    // \r\n    if (arrFields.length !== arrDirections.length || arrFields.length < 1) {\r\n      throw new Error('sortBy:fields and directions not match');\r\n    }\r\n    // nage,age,total\r\n    const comparator = (props: Array<string>, orders: Array<string>) => (item1: any, item2: any) => {\r\n      return props.reduce((result, prop) => {\r\n        if (result === 0) {\r\n          const order = ['asc'].includes(orders[props.indexOf(prop)]) ? 1 : -1;\r\n          const item1Value = this.getValue(item1, prop);\r\n          const item2Value = this.getValue(item2, prop);\r\n          if (item1Value === null || item1Value === undefined) {\r\n            return 1;\r\n          }\r\n          if (item2Value === null || item2Value === undefined) {\r\n            return -1;\r\n          }\r\n\r\n          if (typeof item1Value !== typeof item2Value) {\r\n            const localeCompareResult = String(item1Value).localeCompare(String(item2Value));\r\n            result = localeCompareResult * order;\r\n          } else if (typeof item1Value === 'string' && typeof item2Value === 'string') {\r\n            const localeCompareResult = item1Value.localeCompare(item2Value);\r\n            result = localeCompareResult * order;\r\n          } else {\r\n            if (item1Value > item2Value) {\r\n              result = order * 1;\r\n            }\r\n            if (item1Value < item2Value) {\r\n              result = order * -1;\r\n            }\r\n          }\r\n        }\r\n        return result;\r\n      }, 0);\r\n    };\r\n    data.sort(comparator(arrFields, arrDirections));\r\n  }\r\n  private getValue(target: any, propName: string) {\r\n    if (target instanceof BindingList) {\r\n      target = target.currentItem;\r\n    } else if (target instanceof BindingData) {\r\n      target = target.list.currentItem;\r\n    }\r\n    let result = null;\r\n    if (propName.indexOf('.') === -1) {\r\n      result = target[propName];\r\n    } else {\r\n      const props = propName.split('.');\r\n      for (const prop of props) {\r\n        target = result = this.getValue(target, prop);\r\n      }\r\n    }\r\n    return result;\r\n  }\r\n  /**\r\n   * \r\n   * @param event\r\n   */\r\n  @HostListener('fPreviewMultiSelectedEvent', ['$event'])\r\n  private checkedChanged(event: any[]) {\r\n    const primaryKey = this.bindingList.primaryKey;\r\n    const ids = event && event.map((item) => item && item.originalData && item.originalData[primaryKey] || '').filter(p => p) || [];\r\n    this.setChecks(ids);\r\n  }\r\n  /**\r\n   * \r\n   * @param event\r\n   */\r\n  @HostListener('fSelectedEvent', ['$event'])\r\n  private selectChanged(event: any) {\r\n\r\n  }\r\n}\r\n\r\nexport { FarrisFilePreviewBindingDirective };\r\n","import { Directive, Injector, Input, OnInit, HostListener } from '@angular/core';\r\nimport { DiscussionEditorComponent } from '@farris/discussion-group';\r\nimport { ViewModel, UIStateObservableParam } from '@farris/devkit';\r\nimport { of, Observable, EMPTY } from 'rxjs';\r\nimport { tap, catchError } from 'rxjs/operators';\r\nconst KEY_UISTATE_REPLY_MESSAGE = 'DISCUSSION_REPLY_MESSAGE_INFO';\r\nconst KEY_MESSAGE_ON_COMMENT_ADD = 'onCommentAdd';\r\n\r\n@Directive({\r\n  selector: '[farris-discussion-editor-binding]'\r\n})\r\nexport class FarrisDiscussionEditorBindingDirective implements OnInit {\r\n\r\n  /**\r\n   * \r\n   */\r\n  @Input(\"userQueryCommand\") userQueryCommand: string;\r\n  /**\r\n   * \r\n   */\r\n  @Input(\"addCommentCommand\") addCommentCommand: string;\r\n  /**\r\n   * \r\n   */\r\n  @Input(\"queryAllOrgsCommand\") queryAllOrgsCommand: string;\r\n  /**\r\n   * @\r\n   */\r\n  @Input(\"queryFrequentAtUsersCommand\") queryFrequentAtUsersCommand: string;\r\n\r\n  constructor(public injector: Injector, public discussionEditorComponent: DiscussionEditorComponent, public viewModel: ViewModel) {\r\n  }\r\n\r\n  ngOnInit(): void {\r\n    this.discussionEditorComponent.replyUser = this.viewModel.frameContext.root.viewModel.uiState[KEY_UISTATE_REPLY_MESSAGE] || {};\r\n    this.viewModel.frameContext.root.viewModel.uiState.changes.subscribe((change: UIStateObservableParam) => {\r\n      if (change.field === KEY_UISTATE_REPLY_MESSAGE) {\r\n        this.discussionEditorComponent.replyUser = this.viewModel.frameContext.root.viewModel.uiState[KEY_UISTATE_REPLY_MESSAGE] || {};\r\n      }\r\n    });\r\n    if (this.queryFrequentAtUsersCommand) {\r\n      this.queryFrequentAtUsers();\r\n    } else {\r\n      this.queryAtUsers();\r\n    }\r\n\r\n    this.queryAllOrgs();\r\n  }\r\n  /**\r\n   * \r\n   */\r\n  private queryAllOrgs() {\r\n    this.execute(this.queryAllOrgsCommand).subscribe(result => {\r\n      if (!result) {\r\n        return;\r\n      }\r\n      this.discussionEditorComponent.sectionData = result;\r\n    });\r\n  }\r\n  /**\r\n   * @\r\n   */\r\n  private queryAtUsers() {\r\n    this.execute(this.userQueryCommand).subscribe(result => {\r\n      if (!result) {\r\n        return;\r\n      }\r\n      const { users = [] } = result;\r\n      this.discussionEditorComponent.personnels = users;\r\n    });\r\n  }\r\n  /**\r\n   * @\r\n   */\r\n  private queryFrequentAtUsers() {\r\n    this.execute(this.queryFrequentAtUsersCommand).subscribe(result => {\r\n      if (!result) {\r\n        return;\r\n      }\r\n      this.discussionEditorComponent.personnels = result && result.users || [];\r\n    });\r\n  }\r\n  /**\r\n   * \r\n   * @param event event\r\n   */\r\n  @HostListener('valueChange', ['$event'])\r\n  public pageChangedHandler(event: any) {\r\n    const { msgInfo = 0, text = '', visibility = 'ALL', parentId = null } = event || {};\r\n    if (msgInfo === 1) {\r\n      this.execute(this.addCommentCommand, { text, parentId, visibility }).pipe(\r\n        tap(() => {\r\n          this.viewModel.frameContext.appContext.messagePipe.next(KEY_MESSAGE_ON_COMMENT_ADD);\r\n        }),\r\n        catchError(e => EMPTY)\r\n      ).subscribe();\r\n    } else {\r\n      // \r\n      this.viewModel.frameContext.root.viewModel.uiState[KEY_UISTATE_REPLY_MESSAGE] = {};\r\n      this.discussionEditorComponent.replyUser = {};\r\n    }\r\n  }\r\n  /**\r\n   * \r\n   * @param commandName \r\n   */\r\n  private execute(commandName: string, params?: any): Observable<any> {\r\n    if (!commandName || commandName === '' || commandName === 'undefined') {\r\n      return of(null);\r\n    }\r\n    if (typeof params === 'undefined') {\r\n      params = {};\r\n    }\r\n    const paths = commandName.split('.');\r\n    let func = null;\r\n    paths.forEach(path => {\r\n      func = func && func[path] || this[path];\r\n    });\r\n    if (typeof func === 'function') {\r\n      return func(params);\r\n    }\r\n    return of(null);\r\n  }\r\n}\r\n","import { Observable, of, EMPTY } from 'rxjs';\r\nimport { Directive, Input, Injector, OnInit, HostListener } from '@angular/core';\r\nimport { DiscussionListComponent, DiscussionListDirective } from '@farris/discussion-group';\r\nimport { ViewModel, Change, ChangeType } from '@farris/devkit';\r\nimport { tap, catchError } from 'rxjs/operators';\r\nconst KEY_UISTATE_REPLY_MESSAGE = 'DISCUSSION_REPLY_MESSAGE_INFO';\r\nconst KEY_MESSAGE_ON_COMMENT_ADD = 'onCommentAdd';\r\n@Directive({\r\n  selector: '[farris-discussion-list-binding]'\r\n})\r\nexport class FarrisDiscussionListBindingDirective implements OnInit {\r\n  /**\r\n   * \r\n  */\r\n  @Input(\"commentsQueryCommand\") commentsQueryCommand: string;\r\n  constructor(public injector: Injector, public discussionListComponent: DiscussionListComponent, public viewModel: ViewModel, public discussionListDirective: DiscussionListDirective) {\r\n\r\n  }\r\n  ngOnInit(): void {\r\n    this.viewModel.frameContext.appContext.messagePipe.subscribe((message: any) => {\r\n      if (message === KEY_MESSAGE_ON_COMMENT_ADD) {\r\n        this.queryComments();\r\n      }\r\n    });\r\n    this.viewModel.bindingData.changes.subscribe((change: Change) => {\r\n      if (change.type === ChangeType.Load || change.type === ChangeType.SelectionChanged) {\r\n        this.queryComments();\r\n      }\r\n    });\r\n  }\r\n  /**\r\n   * \r\n   */\r\n  private queryComments(pageIndex?: number, pageSize?: number) {\r\n    if (typeof pageIndex === 'undefined') {\r\n      pageIndex = (this.discussionListComponent.pageIndex - 1) || 0;\r\n    }\r\n    if (typeof pageSize === 'undefined') {\r\n      if (this.discussionListComponent.supportPaging) {\r\n        pageSize = this.discussionListComponent.pageSize;\r\n      } else {\r\n        // pageSize\r\n        pageSize = 10000;\r\n      }\r\n    }\r\n    this.execute(this.commentsQueryCommand, { pageIndex, pageSize }).pipe(\r\n      catchError(e => EMPTY)\r\n    ).subscribe(result => {\r\n      if (!result) {\r\n        return;\r\n      }\r\n      const { comments = [], pageIndex = 0, pageSize = 10, totalCount = 0 } = result;\r\n      this.discussionListComponent.pageIndex = parseInt(pageIndex) + 1;\r\n      if (this.discussionListComponent.supportPaging) {\r\n        this.discussionListComponent.pageSize = pageSize;\r\n      }\r\n      this.discussionListComponent.total = totalCount;\r\n      this.discussionListDirective.discussionListData = result;\r\n    });\r\n  }\r\n  /**\r\n   * \r\n   * @param event event\r\n   */\r\n  @HostListener('replyMessage', ['$event'])\r\n  public replyMessagedHandler(event: any) {\r\n    this.viewModel.frameContext.root.viewModel.uiState.setPropertyValue(KEY_UISTATE_REPLY_MESSAGE, event);\r\n  }\r\n  /**\r\n   * \r\n   * @param event event\r\n   */\r\n  @HostListener('pageChanged', ['$event'])\r\n  public pageChangedHandler(event: any) {\r\n    const { pageIndex = 1, pageSize = 10 } = event.pageInfo || {};\r\n    this.queryComments(pageIndex - 1, pageSize);\r\n  }\r\n  /**\r\n   * \r\n   * @param commandName \r\n   */\r\n  private execute(commandName: string, params?: any): Observable<any> {\r\n    if (!commandName || commandName === '' || commandName === 'undefined') {\r\n      return of(null);\r\n    }\r\n    const paths = commandName.split('.');\r\n    let func = null;\r\n    paths.forEach(path => {\r\n      func = func && func[path] || this[path];\r\n    });\r\n    if (typeof func === 'function') {\r\n      return func(params);\r\n    }\r\n    return of(null);\r\n  }\r\n}\r\n","/*******************************************************************************************************************\r\n *                                     FarrisPrimengTreeTableBindingDirective                               *\r\n * *****************************************************************************************************************\r\n * \r\n * 1. primeng: primeng:^9.0.0,primeicons:^4.0.0\r\n * \r\n * 2. onEditCompletepriemengnode_modules\\primeng\\fesm5\\primeng-treetable.js \r\n *    +:\r\n * \r\n *  TreeTable.prototype.updateEditingCell = function (cell, data, field) { //+ datafield\r\n *      this.editingCell = cell;\r\n *      this.editingCellData = data; //+\r\n *      this.editingCellField = field; //+\r\n *      this.bindDocumentEditListener();\r\n *  };\r\n * \r\n *  TreeTable.prototype.bindDocumentEditListener = function () {\r\n *       var _this = this;\r\n *       if (!this.documentEditListener) {\r\n *           this.documentEditListener = function (event) {\r\n *               if (_this.editingCell && !_this.editingCellClick && _this.isEditingCellValid()) {\r\n *                   domhandler_1.DomHandler.removeClass(_this.editingCell, 'ui-editing-cell');\r\n *                   _this.editingCell = null;\r\n *                   _this.onEditComplete.emit({ field: _this.editingCellField, data: _this.editingCellData });//+\r\n *                   _this.unbindDocumentEditListener();\r\n *               }\r\n *               _this.editingCellClick = false;\r\n *           };\r\n *           document.addEventListener('click', this.documentEditListener);\r\n *       }\r\n *   };\r\n * \r\n *  TreeTable.prototype.bindDocumentEditListener = function () {\r\n *       var _this = this;\r\n *       if (!this.documentEditListener) {\r\n *           this.documentEditListener = function (event) {\r\n *               if (_this.editingCell && !_this.editingCellClick && _this.isEditingCellValid()) {\r\n *                   domhandler_1.DomHandler.removeClass(_this.editingCell, 'ui-editing-cell');\r\n *                   _this.editingCell = null;\r\n *                   _this.onEditComplete.emit({ field: _this.editingCellField, data: _this.editingCellData });//+\r\n *                   _this.unbindDocumentEditListener();\r\n *               }\r\n *               _this.editingCellClick = false;\r\n *           };\r\n *           document.addEventListener('click', this.documentEditListener);\r\n *       }\r\n *   };\r\n * \r\n *  TTEditableColumn.prototype.openCell = function () {\r\n *       var _this = this;\r\n *        this.tt.updateEditingCell(this.el.nativeElement,this.data, this.field);//+\r\n *        domhandler_1.DomHandler.addClass(this.el.nativeElement, 'ui-editing-cell');\r\n *        this.tt.onEditInit.emit({ field: this.field, data: this.data });\r\n *        this.zone.runOutsideAngular(function () {\r\n *            setTimeout(function () {\r\n *                var focusable = domhandler_1.DomHandler.findSingle(_this.el.nativeElement, 'input, textarea');\r\n *                if (focusable) {\r\n *                     focusable.focus();\r\n *                 }\r\n *             }, 50);\r\n *        });\r\n *   };\r\n * \r\n *  TTEditableColumn.prototype.onClick = function (event) {\r\n *        if (this.isEnabled()) {\r\n *            this.tt.editingCellClick = true;\r\n *            if (this.tt.editingCell) {\r\n *                if (this.tt.editingCell !== this.el.nativeElement) {\r\n *                    if (!this.tt.isEditingCellValid()) {\r\n *                        return;\r\n *                    }\r\n *                    this.tt.onEditComplete.emit({ field: this.tt.oldField, data: this.tt.oldDdata });//+\r\n *                    DomHandler.removeClass(this.tt.editingCell, 'ui-editing-cell');\r\n *                    this.openCell();\r\n *                }\r\n *            }\r\n *            else {\r\n *                this.openCell();\r\n *            }\r\n *        }\r\n *  };\r\n * \r\n *  TTEditableColumn.prototype.openCell = function () {\r\n *         var _this = this;\r\n *         this.tt.updateEditingCell(this.el.nativeElement,this.data, this.field);\r\n *         DomHandler.addClass(this.el.nativeElement, 'ui-editing-cell');\r\n *         this.tt.onEditInit.emit({ field: this.field, data: this.data });\r\n *         this.tt.oldField= this.field; //+\r\n *         this.tt.oldDdata=this.data;  //+\r\n *         this.zone.runOutsideAngular(function () {\r\n *             setTimeout(function () {\r\n *                 var focusable = DomHandler.findSingle(_this.el.nativeElement, 'input, textarea');\r\n *                if (focusable) {\r\n *                     focusable.focus();\r\n *                 }\r\n *           }, 50);\r\n *       });\r\n *   };\r\n * \r\n * 3. HTML\r\n * (1) \r\n *      <p-treeTable [columns]=\"treeGridColumns\" farrisPrimengTreeTableBinding farrisHierarchyInfoKey=\"layerField\" [resizableColumns]=\"true\" farrisPrimengTreeTableIdField=\"id\">\r\n *             <ng-template pTemplate=\"header\" let-columns>\r\n *                 <tr>\r\n *                     <th *ngFor=\"let col of columns\" ttResizableColumn>\r\n *                         {{col.header}}\r\n *                     </th>\r\n *                 </tr>\r\n *             </ng-template>\r\n *             <ng-template pTemplate=\"body\" let-rowNode let-rowData=\"rowData\" let-columns=\"columns\">\r\n *                 <tr>\r\n *                     <td *ngFor=\"let col of columns; let i = index\" ttEditableColumn [ttEditableColumn]=\"rowData\"\r\n *                         [ttEditableColumnField]=\"col.field\">\r\n *                         <p-treeTableToggler [rowNode]=\"rowNode\" *ngIf=\"i === 0\"></p-treeTableToggler>\r\n *                         <p-treeTableCellEditor>\r\n *                             <ng-template pTemplate=\"input\">\r\n *                                  <!-- \r\n *                                            1. \r\n *                                            2. \r\n *                                            3. \r\n *                                            4. \r\n *                                            5. \r\n *                                            6. -->\r\n *                             </ng-template>\r\n *                             <ng-template pTemplate=\"output\">{{ col | formatCellData : rowData }}</ng-template>\r\n *                         </p-treeTableCellEditor>\r\n *                     </td>\r\n *                 </tr>\r\n *             </ng-template>\r\n *     </p-treeTable>\r\n * \r\n * (2) \r\n * \r\n *  <p-treeTable [columns]=\"treeGridColumns\" farrisPrimengTreeTableBinding farrisHierarchyInfoKey=\"layerField\" [resizableColumns]=\"true\" farrisPrimengTreeTableIdField=\"id\">\r\n *             <ng-template pTemplate=\"header\" let-columns>\r\n *                  <tr *ngFor=\"let columnHeader of treeGridColumnHeaders\">\r\n *                      <th *ngFor=\"let col of columnHeader\" ttResizableColumn [attr.rowspan]=\"col.rowspan\" [attr.colspan]=\"col.colspan\">\r\n *                          {{col.header}}\r\n *                      </th>\r\n *                  </tr>\r\n *             </ng-template>\r\n *             <ng-template pTemplate=\"body\" let-rowNode let-rowData=\"rowData\" let-columns=\"columns\">\r\n *                 <tr>\r\n *                     <td *ngFor=\"let col of columns; let i = index\" ttEditableColumn [ttEditableColumn]=\"rowData\"\r\n *                         [ttEditableColumnField]=\"col.field\">\r\n *                         <p-treeTableToggler [rowNode]=\"rowNode\" *ngIf=\"i === 0\"></p-treeTableToggler>\r\n *                         <p-treeTableCellEditor>\r\n *                             <ng-template pTemplate=\"input\">\r\n *                                  <!-- \r\n *                                            1. \r\n *                                            2. \r\n *                                            3. \r\n *                                            4. \r\n *                                            5. \r\n *                                            6. -->\r\n *                             </ng-template>\r\n *                             <ng-template pTemplate=\"output\">{{ col | formatCellData : rowData }}</ng-template>\r\n *                         </p-treeTableCellEditor>\r\n *                     </td>\r\n *                 </tr>\r\n *             </ng-template>\r\n *  </p-treeTable>\r\n * \r\n * \r\n *  this.treeGridColumnHeaders=[\r\n *     [{ header: 'Brand',rowspan:3, colspan:1},{ header: 'Sale Rate',rowspan:1, colspan:4}],\r\n *     [{ header: 'Sales',rowspan:1, colspan:2},{ header: 'Profits',rowspan:1, colspan:2}],\r\n *     [{ header: 'Last Year',rowspan:1, colspan:1},{ header: 'This Year',rowspan:1, colspan:1},{ header: 'Last Year',rowspan:1, colspan:1},{ header: 'This Year',rowspan:1, colspan:1}],\r\n *  ]\r\n\r\n **********************************************************************************************************************/\r\n\r\nimport { Directive, OnInit, OnChanges, SimpleChanges, Input, HostListener, Output, EventEmitter, Type } from '@angular/core';\r\nimport { BindingData, BindingList, FrameContext, Change, ChangeType, EntityCollection, EntityList, Entity, ComponentType } from '@farris/devkit';\r\nimport { TreeTable } from 'primeng/treetable';\r\nimport { TreeNode } from 'primeng/api';\r\nimport { TreeNodeBuilderFactory } from '../tree_table_node_builder/tree_node_builder_factory';\r\nimport { DateTimeHelperService } from '@farris/ui-common/date';\r\nconst PARENT_ELEMENT: string = \"parentElement\";\r\nconst PATH: string = \"path\";\r\nconst IS_DETAIL: string = 'isDetail';\r\n\r\nexport interface FarrisPrimengTreeNode extends TreeNode {\r\n  id?: string;\r\n}\r\n\r\n@Directive({\r\n  selector: '[farrisPrimengTreeTableBinding]'\r\n})\r\nexport class FarrisPrimengTreeTableBindingDirective implements OnInit, OnChanges {\r\n  private selectedRowId = null;\r\n  private treeTableSelectedEvent = null;\r\n  /**\r\n   * codes/\r\n   */\r\n  @Input('farrisHierarchyInfoKey')\r\n  public hierarchyInfoKey: string;\r\n  @Input('columns')\r\n  public columns: any;\r\n  /**\r\n   * \r\n   */\r\n  @Input('farrisPrimengTreeTableIdField')\r\n  public idField: string;\r\n\r\n  /**\r\n   * \r\n   */\r\n  @Output() nodeSelectChange: EventEmitter<any> = new EventEmitter<any>();\r\n\r\n  private oldTreeNodeMap: { [key: string]: FarrisPrimengTreeNode } = {};\r\n\r\n\r\n  /**\r\n   * hierarchyInfoKey\r\n   */\r\n  private hierarchyInfoField: string;\r\n\r\n  /**\r\n   * \r\n   */\r\n  private get bindingData(): BindingData {\r\n    return this.frameContext.bindingData;\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  private get bindingList(): BindingList {\r\n    return this.bindingData.getList();\r\n  }\r\n\r\n  private getHierarchyInfoField(): string {\r\n    let infos = this.hierarchyInfoKey.split('/');\r\n    return infos[infos.length - 1];\r\n  }\r\n\r\n  constructor(\r\n    private treeTable: TreeTable,\r\n    private frameContext: FrameContext,\r\n    private dateService: DateTimeHelperService\r\n  ) { }\r\n\r\n  ngOnChanges(changes: SimpleChanges): void {\r\n  }\r\n\r\n  ngOnInit(): void {\r\n    //\r\n    this.hierarchyInfoField = this.getHierarchyInfoField();\r\n    // root-component\r\n    const virtualRootFrameContext = this.frameContext.getVirtualRootFrameContext();\r\n    virtualRootFrameContext.setParam('hierarchyInfoKey', this.hierarchyInfoKey);\r\n    this.bindingData.changes.subscribe((change: Change) => {\r\n      this.bindData(change);\r\n      this.updateSelectedRow(change);\r\n    });\r\n    this.frameContext.viewModel.uiState.setPropertyValue('ids', []);\r\n    if (this.frameContext && this.frameContext.frameComponent) {\r\n      this.frameContext.frameComponent.componentType = ComponentType.primengTreeComponent;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @returns \r\n   */\r\n  private getEntityArr(): Entity[] {\r\n    const entityCollection = this.frameContext.repository.entityCollection;\r\n    const bindingPath: string = this.frameContext.bindingData.bindingPath;\r\n    if (!bindingPath || bindingPath === '/') {\r\n      return entityCollection.toArray();\r\n    }\r\n    let bindingList: BindingList = this.frameContext.bindingData.list;\r\n    let bindingPathArr: string[] = bindingPath.split('/').filter(str => str);\r\n    let pathArray = [];\r\n    bindingPathArr.forEach((path: string) => {\r\n      pathArray.push(`${bindingList.primaryKey}:${bindingList.currentId}`);\r\n      pathArray.push(path);\r\n      bindingList = bindingList.currentItem[path];\r\n    });\r\n    return (entityCollection.getEntitiesByPath(pathArray) as EntityList<any>).toArray();\r\n  }\r\n  /**\r\n   * \r\n   * @param entityArr \r\n   * @param treeNodes \r\n   */\r\n  private setActualIndex(entityArr: Entity[], treeNodes: TreeNode[]) {\r\n    if (entityArr.length < 1)\r\n      return;\r\n    // \r\n    let counter = { index: 0 };\r\n    const primaryKey: string = entityArr[0].primaryKey;\r\n    treeNodes.forEach((rootNode) => {\r\n      this.traverseTree(rootNode, counter, entityArr, primaryKey);\r\n    });\r\n  }\r\n  /**\r\n   * \r\n   * @param treeNode \r\n   * @param counter \r\n   * @param entityArr \r\n   * @description\r\n   * Entity\r\n   * Entity\r\n   * __ACTUAL_INDEX__Entity\r\n   * Entityvalidate\r\n   */\r\n  private traverseTree(treeNode: TreeNode, counter: { index: number }, entityArr: Entity[], primaryKey: string) {\r\n    const INDEX_LABEL = \"__ACTUAL_INDEX__\";\r\n    // \r\n    const entity = entityArr.find(e => e[primaryKey] === treeNode.data[primaryKey]);\r\n    if (entity) {\r\n      Object.defineProperty(entity, INDEX_LABEL, {\r\n        value: counter.index\r\n      });\r\n      counter.index++;\r\n    }\r\n    // \r\n    treeNode.children.forEach((rootNode) => {\r\n      this.traverseTree(rootNode, counter, entityArr, primaryKey);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param change \r\n   * @returns \r\n   * @description\r\n   * \r\n   * Tab\r\n   */\r\n  private handleChange(change?: Change): boolean {\r\n    // \r\n    if (!change)\r\n      return false;\r\n    // \r\n    switch (change.type) {\r\n      case ChangeType.SelectionChanged:\r\n        return this.handleSelectionChanged(change);\r\n      case ChangeType.GlobalSelectionChanged:\r\n        return this.handleSelectionChanged(change);\r\n      case ChangeType.ValueChanged:\r\n        return this.handleValueChanged(change);\r\n      default:\r\n        return false;\r\n    }\r\n  }\r\n  /**\r\n   * \r\n   * @param change \r\n   * @returns \r\n   */\r\n  private handleSelectionChanged(change: Change): boolean {\r\n    // Tab\r\n    if (change.type === ChangeType.SelectionChanged || change.type === ChangeType.GlobalSelectionChanged) {\r\n      let path = change.path;\r\n      let frmPath = this.bindingData.bindingPath.split(\"/\").filter(str => str);\r\n      if (path.length === frmPath.length) {\r\n        let same = true;\r\n        for (let i = 0; i < path.length; i++) {\r\n          if (path[i] !== frmPath[i])\r\n            same = false;\r\n        }\r\n        if (same)\r\n          return true;\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n  /**\r\n   * \r\n   * @param change \r\n   * @returns \r\n   */\r\n  private handleValueChanged(change: Change): boolean {\r\n    if (change.type !== ChangeType.ValueChanged) {\r\n      return false;\r\n    }\r\n    // Tab\r\n    let path = change.path;\r\n    let bindingPathArr = this.bindingData.bindingPath.split(\"/\").filter(str => str);\r\n    // \r\n    for (let item of bindingPathArr) {\r\n      if (path.length > 0) {\r\n        if (item === path[0]) {\r\n          path.shift();\r\n        } else {\r\n          return false;\r\n        }\r\n      }\r\n    }\r\n    // id\r\n    let id = change.id;\r\n    if (id) {\r\n      const primaryKey = this.bindingList.primaryKey;\r\n      let nodes = this.treeTable.value;\r\n      let targetNode = null;\r\n      for (let node of nodes) {\r\n        let result = this.findTreeNodeById(node, primaryKey, id);\r\n        if (result) {\r\n          targetNode = result;\r\n          break;\r\n        }\r\n      }\r\n      if (targetNode && path.length === 1) {\r\n        const propertyName = path.shift();\r\n        if (targetNode.data.hasOwnProperty(propertyName) && change.hasOwnProperty(\"value\")) {\r\n          targetNode.data[propertyName] = change.value;\r\n          return true;\r\n        }\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n  /**\r\n   * \r\n   * @param treeNode \r\n   * @param primaryKey \r\n   * @param keyValue \r\n   * @returns \r\n   * @todo oldTreeNodeMap\r\n   */\r\n  private findTreeNodeById(treeNode: TreeNode, primaryKey: string, keyValue: any): TreeNode | null {\r\n    if (!treeNode)\r\n      return null;\r\n    if (treeNode.data.hasOwnProperty(primaryKey) && treeNode.data[primaryKey] === keyValue)\r\n      return treeNode;\r\n    if (treeNode.children) {\r\n      for (let node of treeNode.children) {\r\n        let result = this.findTreeNodeById(node, primaryKey, keyValue);\r\n        if (result)\r\n          return result;\r\n      }\r\n    }\r\n    return null;\r\n  }\r\n\r\n  /**\r\n  * \r\n  */\r\n  private bindData(change?: Change) {\r\n    let skipRefresh: boolean = this.handleChange(change);\r\n    if (skipRefresh) {\r\n      return;\r\n    }\r\n    // this.sourceData = this.bindingList.toJSON({ ignoreMultiLangInput: true });\r\n    const oldTreeNodes = this.treeTable.value;\r\n    const treeNodesData = this.bindingList.toJSON({ ignoreMultiLangInput: true });\r\n    let treeNodes: TreeNode[] = [];\r\n\r\n    if (treeNodesData && treeNodesData.length > 0) {\r\n      let hierarchyInfo = treeNodesData[0][this.hierarchyInfoField];\r\n      const builder: Type<any> = TreeNodeBuilderFactory.getBuilder(hierarchyInfo);\r\n      // builder\r\n      if (builder == null) {\r\n        throw new Error('TreeTable builder is null!');\r\n      }\r\n      let expandLevel = -1;\r\n      const treeExpandLevel = this.treeTable['expandLevel'];\r\n      if (typeof treeExpandLevel !== 'undefined') {\r\n        expandLevel = treeExpandLevel;\r\n      }\r\n      const context = {\r\n        expandLevel,\r\n        component: this.treeTable,\r\n      };\r\n      const treeNodesBuilder = new builder(\r\n        treeNodesData, oldTreeNodes,\r\n        this.bindingList.primaryKey, this.hierarchyInfoField, context\r\n      );\r\n      treeNodes = treeNodesBuilder.build();\r\n      // \r\n      let entityArr: Entity[] = this.getEntityArr();\r\n      // treeNodes__ACTUAL_INDEX__\r\n      this.setActualIndex(entityArr, treeNodes);\r\n    }\r\n\r\n    if (!this.treeTable.lazy) {\r\n      this.treeTable.totalRecords = (this.treeTable._value ? this.treeTable._value.length : 0);\r\n      if (this.treeTable.sortMode == 'single' && this.treeTable.sortField)\r\n        this.treeTable.sortSingle();\r\n      else if (this.treeTable.sortMode == 'multiple' && this.treeTable.multiSortMeta)\r\n        this.treeTable.sortMultiple();\r\n      else if (this.treeTable.hasFilter()) //sort already filters\r\n        this.treeTable._filter();\r\n    }\r\n    this.treeTable.tableService.onUIUpdate(treeNodes);\r\n    this.treeTable.value = treeNodes;\r\n    this.treeTable.updateSerializedValue();\r\n\r\n    // this.treeNodeMap = {};\r\n    // this.sourceDataClone = this.sourceData;\r\n    // this.treeTable.value = [...this.treeNodesBuilder()];\r\n    // this.treeTableValueHandler();\r\n  }\r\n  private updateSelectedRow(change: Change) {\r\n    const currentId = this.bindingList.currentId;\r\n    if (this.treeTableSelectedEvent) {\r\n      this.treeTableSelectedEvent = false;\r\n      this.selectedRowId = currentId;\r\n      return;\r\n    }\r\n    const serializedValue = this.treeTable.serializedValue;\r\n\r\n    const treeNode = serializedValue && serializedValue.find(item => item && item.node && item.node.data && item.node.data.id === currentId) || null;\r\n    if (treeNode) {\r\n      if (this.treeTable.isSelected(treeNode.node) || currentId === this.selectedRowId) {\r\n        return;\r\n      }\r\n      this.selectedRowId = currentId;\r\n      this.treeTable.handleRowClick({ rowNode: treeNode, originalEvent: { target: { nodeName: '' } } });\r\n    }\r\n  }\r\n  @HostListener('onEditInit', ['$event'])\r\n  public onEditInitHandler(event: any) {\r\n    this.nodeSelectChange.emit(event['data']);\r\n    const id = event.data[this.idField];\r\n    this.setCurrentIdToBindingList(id);\r\n  }\r\n\r\n\r\n  @HostListener('onEditComplete', ['$event'])\r\n  public onEditCompleteHandler(event: any) {\r\n    let fieldName = event.field;\r\n    const column = this.columns.find(item => item.field === fieldName);\r\n    if (fieldName && column && column.editor && column.editor.options && column.editor.options.type === 'EditorTypes.LOOKUP') {\r\n      return;\r\n    }\r\n    if (event && event.hasOwnProperty('data')) {\r\n      const primaryKeyValue = event.data[this.frameContext.repository.primaryKey];\r\n\r\n      let value: any = this.getValue(fieldName, event.data);\r\n      const bindingPath = this.frameContext.viewModel.bindingPath || '/';\r\n      const bindingPaths = bindingPath.split('/').filter(p => p);\r\n      const bindingList: BindingList = this.bindingData.getValue(bindingPaths);\r\n      const bindingObject = bindingList.findById(primaryKeyValue);\r\n      const oldValue = this.getValue(fieldName, bindingObject);\r\n      const column = this.treeTable.columns.find(item => item.field === fieldName);\r\n      const dataType = column && column.dataType || null;\r\n      if (dataType === 'date' || dataType === 'datetime') {\r\n        if (this.dateService) {\r\n          const format = column && column.formatter && column.formatter.options && column.formatter.options.format || 'yyyy-MM-dd';\r\n          value = this.dateService.formatTo(value, format);\r\n          if (!value) {\r\n            value = null;\r\n          }\r\n        }\r\n      } else if (dataType === 'number') {\r\n        value = Number(value);\r\n      }\r\n      if (value !== oldValue) {\r\n        this.updateBindingList(primaryKeyValue, fieldName, value);\r\n      }\r\n    }\r\n  }\r\n\r\n  @HostListener('onNodeExpand', ['$event'])\r\n  public onNodeExpandHandler(event: any) {\r\n    // this.setNodeExpandedValue(event);\r\n    const selectedId = event && event.node && event.node.id || null;\r\n    if (!selectedId) {\r\n      return;\r\n    }\r\n    const virtualRootFrameContext = this.frameContext.getVirtualRootFrameContext();\r\n    const expandNodes = virtualRootFrameContext.getParam('TREE_LATEST_EXPANDED_ID') || [];\r\n    expandNodes.push(selectedId);\r\n    virtualRootFrameContext.setParam('TREE_LATEST_EXPANDED_ID', expandNodes);\r\n  }\r\n\r\n  @HostListener('onNodeCollapse', ['$event'])\r\n  public onNodeCollapseHandler(event: any) {\r\n    // this.setNodeExpandedValue(event);\r\n  }\r\n  @HostListener('onNodeSelect', ['$event'])\r\n  public onNodeSelectHandler(event: any) {\r\n    const id = event && event.node && event.node.data && event.node.data[this.frameContext.repository.primaryKey] || null;\r\n    if (id === this.bindingList.currentId) {\r\n      return;\r\n    }\r\n    this.treeTableSelectedEvent = true;\r\n    this.setCurrentIdToBindingList(id);\r\n  }\r\n  @HostListener('onNodeUnselect', ['$event'])\r\n  public onNodeUnselectHandler(event: any) {\r\n    this.setCurrentIdToBindingList(null);\r\n  }\r\n  private setNodeExpandedValue(event: any) {\r\n    if (!event || !this.oldTreeNodeMap || Object.keys(this.oldTreeNodeMap).length <= 0) {\r\n      return;\r\n    }\r\n    try {\r\n      let currentId = event.node.data.id;\r\n      this.oldTreeNodeMap[currentId].expanded = event.expanded;\r\n    } catch (e) {\r\n      console.warn(`setNodeExpandedValue error:${e.message}`);\r\n    }\r\n  }\r\n  private setCurrentIdToBindingList(selectedId: string): void {\r\n    const oldCurrentId = this.bindingList.currentId;\r\n    if (oldCurrentId === selectedId) {\r\n      return;\r\n    }\r\n    this.bindingList.setCurrentId(selectedId, true);\r\n  }\r\n\r\n  private getPaths(): string[] {\r\n    let paths = [];\r\n    if (!this.frameContext.viewModel || !this.frameContext.viewModel.bindingPath || this.frameContext.viewModel.bindingPath === '/') {\r\n      return paths;\r\n    }\r\n    else {\r\n      let bindingPath = this.frameContext.viewModel.bindingPath;\r\n      paths = bindingPath.substring(1, bindingPath.length).split('/');\r\n      return paths;\r\n    }\r\n  }\r\n  private updateBindingList(primaryValue: any, propertyName: string, value: any) {\r\n    if (!propertyName) {\r\n      return;\r\n    }\r\n    // \r\n    const propertyNames = propertyName.split('.').filter(item => item);\r\n    const bindingPath = this.getBindingPathArray();\r\n    // bindingList\r\n    const list = this.bindingData.getValue(bindingPath) as BindingList;\r\n    // \r\n    const paths = bindingPath.concat(propertyNames);\r\n    if (list && primaryValue === list.currentItem.primaryKeyValue) {\r\n      this.bindingData.setValue(paths, value, true, true);\r\n      return;\r\n    }\r\n    const bindingObject = this.bindingList.findById(primaryValue);\r\n    if (!bindingObject) {\r\n      return;\r\n    }\r\n    if (propertyNames.length < 2) {\r\n      bindingObject.setValue(propertyName, value, true, true, undefined, this.bindingData.getValudChangeInvokerFactory()(paths));\r\n    } else {\r\n      let targetBindingObject = null;\r\n      const fpaths = propertyNames.slice(0, propertyNames.length - 1);\r\n      const targetPropertyName = propertyNames[propertyNames.length - 1];\r\n      fpaths.forEach(prop => {\r\n        targetBindingObject = targetBindingObject && targetBindingObject[prop] || bindingObject[prop];\r\n      });\r\n      // todo:\r\n      targetBindingObject.setValue(targetPropertyName, value, true, true, undefined, this.bindingData.getValudChangeInvokerFactory()(paths));\r\n    }\r\n  }\r\n  private getBindingPathArray(): any[] {\r\n    const path = this.frameContext.viewModel.bindingPath;\r\n    if (path) {\r\n      return path.split('/').filter(n => n !== '');\r\n    }\r\n    return [];\r\n  }\r\n  private getValue(path: string, data: any) {\r\n    let value = '';\r\n    if (path.indexOf('.') === -1) {\r\n      value = data[path];\r\n    } else {\r\n      value = path.split('.').reduce((result, prop) => {\r\n        return result[prop];\r\n      }, data);\r\n    }\r\n    return value;\r\n  }\r\n  protected setChecks(ids: string[]) {\r\n    this.frameContext.viewModel.uiState.setPropertyValue('ids', ids);\r\n  }\r\n}","import { Directive, Injector, Input, OnChanges, OnDestroy, SimpleChanges } from \"@angular/core\";\r\nimport { FrameContext } from \"@farris/devkit\";\r\nconst EXCLUDE_VALIDATE_FIELDS = 'excludeValidateRules';\r\nconst RULETYPE = 'required';\r\n@Directive({\r\n  selector: '[farris-dynamic-required]'\r\n})\r\nexport class FarrisDynamicRequiredDirective implements OnChanges, OnDestroy {\r\n  /**\r\n   * like {field:'',type:'require'}\r\n   */\r\n  @Input('farris-dynamic-required') field: string;\r\n  /**\r\n   * \r\n   */\r\n  @Input('requiredOn') requiredOn: boolean = false;\r\n  constructor(protected frameContext: FrameContext, private injector: Injector) {\r\n\r\n  }\r\n  ngOnDestroy(): void {\r\n    this.updateValidateRule(false);\r\n  }\r\n  ngOnChanges(changes: SimpleChanges): void {\r\n    // \r\n    this.updateValidateRule(this.requiredOn);\r\n  }\r\n  /**\r\n   * \r\n   * @param isRequired \r\n   */\r\n  private updateValidateRule(isRequired: boolean) {\r\n    if (!this.field) {\r\n      return;\r\n    }\r\n    this.frameContext.form.updateFieldValidateRule(this.field, isRequired);\r\n    // if (isRequired) {\r\n    //   const rules = this.frameContext.params.get(EXCLUDE_VALIDATE_FIELDS) || {};\r\n    //   const fieldExcludeRules: string[] = rules[this.field] || [];\r\n    //   if (fieldExcludeRules.includes(RULETYPE)) {\r\n    //     const index = fieldExcludeRules.indexOf(RULETYPE);\r\n    //     fieldExcludeRules.splice(index, 1);\r\n    //   }\r\n    //   this.frameContext.params.set(EXCLUDE_VALIDATE_FIELDS, rules);\r\n    //   this.frameContext.form.updateFieldValidateRule(this.field, fieldExcludeRules);\r\n    // } else {\r\n    //   // \r\n    //   // {int1:[required,maxValue]}\r\n    //   const rules = this.frameContext.params.get(EXCLUDE_VALIDATE_FIELDS) || {};\r\n    //   const fieldExcludeRules = rules[this.field] || [];\r\n    //   if (fieldExcludeRules && !fieldExcludeRules.includes(RULETYPE)) {\r\n    //     fieldExcludeRules.push(RULETYPE);\r\n    //   }\r\n    //   rules[this.field] = fieldExcludeRules;\r\n    //   this.frameContext.params.set(EXCLUDE_VALIDATE_FIELDS, rules);\r\n    //   this.frameContext.form.updateFieldValidateRule(this.field, fieldExcludeRules);\r\n    // }\r\n  }\r\n\r\n}\r\n","import { Directive, ElementRef, OnInit } from '@angular/core';\r\nimport { ViewModel } from '@farris/devkit';\r\nimport { EditorComponent } from '@farris/ui-editor';\r\n\r\n@Directive({\r\n  selector: '[farris-editor],[farris-editor-bind]'\r\n})\r\nexport class FarrisEditorDirective implements OnInit {\r\n  constructor(private viewModel: ViewModel, private editor: EditorComponent) { }\r\n\r\n  ngOnInit(): void {\r\n    this.setComponentRef();\r\n  }\r\n\r\n  private setComponentRef() {\r\n    const appContext = this.viewModel && this.viewModel.frameContext && this.viewModel.frameContext.getFormAppContext();\r\n    const frameId = this.viewModel && this.viewModel.frameContext && this.viewModel.frameContext.frameId;\r\n    const editor: any = this.editor;\r\n    const elementRef: ElementRef = editor && editor.injector && editor.injector.get(ElementRef, null);\r\n    const id = elementRef && elementRef.nativeElement && elementRef.nativeElement.id || null;\r\n    // frameIdtreetableid\r\n    if (!frameId || !id) {\r\n      return;\r\n    }\r\n    const map = appContext && appContext.componentRefs && appContext.componentRefs.get(frameId) || new Map<string, any>();\r\n    appContext && appContext.componentRefs && appContext.componentRefs.set(frameId, map.set(id, this.editor));\r\n  }\r\n}","import { Directive, HostListener, Injector } from \"@angular/core\";\r\nimport { FrameContext } from \"@farris/devkit\";\r\nimport { QuerySolutionComponent } from \"@gsp-cmp/querysolution\";\r\n@Directive({\r\n  selector: \"[farris-querysolution-event-bind]\"\r\n})\r\nexport class FarrisQuerySolutionEventBindDirective {\r\n  constructor(private injector: Injector, private component: QuerySolutionComponent, private frameContext: FrameContext) { }\r\n  /**\r\n   * \r\n   * @param event event\r\n   */\r\n  @HostListener(\"queryEmitter\")\r\n  private onQuery(event: any) {\r\n    if (this.frameContext) {\r\n      this.frameContext.repository.entityCollection.pageIndex = 1;\r\n    }\r\n  }\r\n}","import { Directive, Inject, Injector, OnInit } from \"@angular/core\";\r\nimport { UserSettings, UserSettingsToken } from \"@farris/devkit\";\r\nimport { FarrisDatepickerComponent } from '@farris/ui-datepicker';\r\n@Directive({\r\n  selector: '[farris-date-localization]'\r\n})\r\nexport class FarrisDateLocalizationDirective implements OnInit {\r\n  constructor(private injector: Injector, @Inject(UserSettingsToken) private userSettings: UserSettings, private componentRef: FarrisDatepickerComponent) {\r\n\r\n  }\r\n  ngOnInit(): void {\r\n    this.localize();\r\n  }\r\n  private localize() {\r\n    if (this.userSettings && this.componentRef) {\r\n      const { dateFormat = null, timeFormat = null } = this.userSettings;\r\n      if (dateFormat === null && timeFormat === null) {\r\n        return;\r\n      }\r\n      if (timeFormat && timeFormat && this.componentRef.showTime === true) {\r\n        this.componentRef.dateFormat = `${dateFormat} ${timeFormat}`;\r\n        this.componentRef.dateOpts.dateFormat = `${dateFormat} ${timeFormat}`;\r\n        this.componentRef.updateValue(this.componentRef.value);\r\n      } else if (dateFormat) {\r\n        this.componentRef.dateFormat = `${dateFormat}`;\r\n        this.componentRef.dateOpts.dateFormat = `${dateFormat}`;\r\n        this.componentRef.updateValue(this.componentRef.value);\r\n      }\r\n    }\r\n  }\r\n}","import { Directive, Inject, Injector, OnInit } from \"@angular/core\";\r\nimport { UserSettings, UserSettingsToken } from \"@farris/devkit\";\r\nimport { NumberSpinnerComponent } from '@farris/ui-number-spinner';\r\n@Directive({\r\n  selector: '[farris-number-localization]'\r\n})\r\nexport class FarrisNumberLocalizationDirective implements OnInit {\r\n  constructor(private injector: Injector, @Inject(UserSettingsToken) private userSettings: UserSettings, private componentRef: NumberSpinnerComponent) {\r\n\r\n  }\r\n  ngOnInit(): void {\r\n    this.localize();\r\n  }\r\n  private localize() {\r\n    return;\r\n    // \r\n    if (this.userSettings && this.userSettings.numberFormat && this.componentRef) {\r\n      const { negativeSign = null, numberDecimalDigits = null, numberDecimalSeparator = null, numberGroupSeparator = null } = this.userSettings.numberFormat || {};\r\n      // \r\n      if (negativeSign) {\r\n        // this.componentRef.prefix = negativeSign;\r\n      }\r\n      // \r\n      if (numberDecimalDigits !== null) {\r\n        this.componentRef.precision = numberDecimalDigits;\r\n        this.componentRef.formatOptions['precision'] = numberDecimalDigits;\r\n      }\r\n      // \r\n      if (numberDecimalSeparator !== null) {\r\n        this.componentRef.decimalSeparator = numberDecimalSeparator;\r\n        this.componentRef.formatOptions['decimalSeparator'] = numberDecimalSeparator;\r\n      }\r\n      // \r\n      if (numberGroupSeparator !== null) {\r\n        this.componentRef.groupSeparator = numberGroupSeparator;\r\n        this.componentRef.formatOptions['groupSeparator'] = numberGroupSeparator;\r\n      }\r\n      this.componentRef.updateValue(this.componentRef.value);\r\n    }\r\n  }\r\n}","import { Directive, Inject, Injector, OnInit } from \"@angular/core\";\r\nimport { UserSettings, UserSettingsToken } from \"@farris/devkit\";\r\nimport { TimePickerComponent } from '@farris/ui-time-picker';\r\n\r\n@Directive({\r\n  selector: '[farris-time-localization]'\r\n})\r\nexport class FarrisTimeLocalizationDirective implements OnInit {\r\n  constructor(private injector: Injector, @Inject(UserSettingsToken) private userSettings: UserSettings, private componentRef: TimePickerComponent) {\r\n\r\n  }\r\n  ngOnInit(): void {\r\n    this.localize();\r\n  }\r\n  private localize() {\r\n    if (this.userSettings && this.componentRef) {\r\n      const { timeFormat = null } = this.userSettings;\r\n      if (timeFormat) {\r\n        this.componentRef.format = timeFormat;\r\n      }\r\n    }\r\n  }\r\n}","import { Directive, Inject, Injector, Input, OnInit } from \"@angular/core\";\r\nimport { NumberFormat, UserSettings, UserSettingsToken } from \"@farris/devkit\";\r\nimport { BigNumber } from 'bignumber.js';\r\nimport moment from 'moment';\r\nimport { TextComponent } from '@farris/ui-text';\r\n\r\n@Directive({\r\n  selector: '[farris-text-localization]'\r\n})\r\nexport class FarrisTextLocalizationDirective implements OnInit {\r\n  @Input('localization') localization: boolean;\r\n  constructor(private injector: Injector, @Inject(UserSettingsToken) private userSettings: UserSettings, private componentRef: TextComponent) {\r\n    this.transform();\r\n  }\r\n  public ngOnInit() {\r\n  }\r\n  private transform() {\r\n    if (this.componentRef) {\r\n      this.componentRef.beforeWriteValue = (value: any, options: any) => {\r\n        let { localizationType = null, showTime = false } = options;\r\n        if (!value) {\r\n          return '';\r\n        }\r\n        if (localizationType && value) {\r\n          localizationType = localizationType.toLowerCase();\r\n          value = this.transformValue(value, localizationType);\r\n          return value;\r\n        } else {\r\n          return undefined;\r\n        }\r\n      };\r\n    }\r\n  }\r\n  private transformValue(value: any, dataType: string) {\r\n    if (dataType === 'date') {\r\n      return this.transformDate(value);\r\n    } else if (dataType === 'datetime') {\r\n      return this.transformDateTime(value);\r\n    }\r\n    // \r\n    //  else if (dataType === 'number') {\r\n    //   return this.transformNumber(value);\r\n    // } \r\n    else {\r\n      return value;\r\n    }\r\n  }\r\n  /**\r\n   * \r\n   * @param value value\r\n   */\r\n  private transformDate(value: any) {\r\n    let dateFormat = this.userSettings && this.userSettings.dateFormat || 'YYYY-MM-DD';\r\n    if (!dateFormat || !value) {\r\n      return value;\r\n    }\r\n    const date = moment(value);\r\n    const isValid = date.isValid();\r\n    if (!isValid) {\r\n      return value;\r\n    }\r\n    dateFormat = this.parseDateFormat(dateFormat);\r\n    return date.format(dateFormat);\r\n  }\r\n  /**\r\n   * \r\n   * @param value value\r\n   * todo: \r\n   */\r\n  private transformDateTime(value: any) {\r\n    let dateFormat = this.userSettings && this.userSettings.dateFormat || 'YYYY-MM-DD';\r\n    let timeFormat = this.userSettings && this.userSettings.timeFormat || 'HH:mm:ss';\r\n    if (!dateFormat || !timeFormat) {\r\n      return value;\r\n    }\r\n    const dateTime = moment(value);\r\n    const isValid = dateTime.isValid();\r\n    if (!isValid) {\r\n      return value;\r\n    }\r\n    if (dateFormat) {\r\n      dateFormat = this.parseDateFormat(dateFormat);\r\n    }\r\n    if (timeFormat) {\r\n      timeFormat = this.parseTimeFormat(timeFormat);\r\n    }\r\n    const dateTimeFormat = dateFormat + ' ' + timeFormat;\r\n    return dateTime.format(dateTimeFormat);\r\n  }\r\n  /**\r\n   * \r\n   * @param value value\r\n   */\r\n  private transformNumber(value): string {\r\n    if (value === null || value === undefined || value === '') {\r\n      return '';\r\n    }\r\n    const bigNumber = new BigNumber(value);\r\n    // \r\n    if (!BigNumber.isBigNumber(bigNumber)) {\r\n      return value;\r\n    }\r\n    const isNegative = bigNumber.isNegative();\r\n    const format = this.buildNumberFormat();\r\n    const { negativeSign = null, numberDecimalDigits = null } = this.numberFormat || {};\r\n    if (isNegative) {\r\n      if (negativeSign !== null) {\r\n        format.prefix = negativeSign;\r\n        return bigNumber.absoluteValue().toFormat(numberDecimalDigits, null, format);\r\n      }\r\n    }\r\n    return bigNumber.toFormat(numberDecimalDigits, null, format);\r\n  }\r\n  /**\r\n   * momentformat\r\n   * @param format format\r\n   */\r\n  private parseDateFormat(format: string) {\r\n    return format.replace(/y/g, 'Y').replace(/d/g, 'D');\r\n  }\r\n  /**\r\n   * momentformat\r\n   * @param format format\r\n   */\r\n  private parseTimeFormat(format: string) {\r\n    return format.replace(/M/g, 'm');\r\n  }\r\n  /**\r\n   * bignumber\r\n   */\r\n  private buildNumberFormat() {\r\n    if (this.numberFormat) {\r\n      const { numberDecimalSeparator = null, numberGroupSeparator = null } = this.numberFormat;\r\n      const format: any = {\r\n        groupSize: 3,\r\n      };\r\n      if (numberDecimalSeparator !== null) {\r\n        format.decimalSeparator = numberDecimalSeparator;\r\n      }\r\n      if (numberGroupSeparator !== null) {\r\n        format.groupSeparator = numberGroupSeparator;\r\n      }\r\n      return format;\r\n    }\r\n  }\r\n  private get numberFormat(): NumberFormat {\r\n    return this.userSettings && this.userSettings.numberFormat || null;\r\n  }\r\n}","import { Directive, ElementRef, Injector, Input, OnInit } from '@angular/core';\r\n@Directive({\r\n  selector: '[farris-checkbox-modification]'\r\n})\r\nexport class FarrisCheckboxModificationDirective implements OnInit {\r\n  @Input() index: number;\r\n  constructor(private injector: Injector, private elementRef: ElementRef) { }\r\n  ngOnInit(): void {\r\n    if (typeof this.index !== 'number' || !this.elementRef) {\r\n      return;\r\n    }\r\n    const nativeElement = this.elementRef.nativeElement;\r\n    if (nativeElement) {\r\n      const id = nativeElement.getAttribute('id');\r\n      if (id) {\r\n        const token = `${id}_${this.index}`;\r\n        this.elementRef.nativeElement.setAttribute('id', token);\r\n        this.elementRef.nativeElement.setAttribute('name', token);\r\n        this.elementRef.nativeElement.setAttribute('original_id', id);\r\n      }\r\n    }\r\n  }\r\n\r\n}\r\n","import { Directive, ElementRef, Injector, Input, OnInit } from '@angular/core';\r\n@Directive({\r\n  selector: '[farris-label-modification]'\r\n})\r\nexport class FarrisLabelModificationDirective implements OnInit {\r\n  @Input() index: number;\r\n  constructor(private injector: Injector, private elementRef: ElementRef) { }\r\n  ngOnInit(): void {\r\n    if (typeof this.index !== 'number' || !this.elementRef) {\r\n      return;\r\n    }\r\n    const nativeElement = this.elementRef.nativeElement;\r\n    if (nativeElement) {\r\n      const labelFor = nativeElement.getAttribute('for');\r\n      if (labelFor) {\r\n        this.elementRef.nativeElement.setAttribute('for', `${labelFor}_${this.index}`);\r\n      }\r\n    }\r\n  }\r\n\r\n}\r\n","import { Directive, Input, Optional } from '@angular/core';\r\nimport { ComboLookupComponent } from '@farris/ui-combo-lookup';\r\nimport { LookupGridComponent } from '@farris/ui-lookup';\r\n\r\n@Directive({\r\n  selector: '[farris-lookup-binding]'\r\n})\r\nexport class FarrisLookupBindingDirective {\r\n  @Input() lookupType: string;\r\n  @Input('farris-lookup-binding')\r\n  public set lookupValue(value: any) {\r\n    if (this.lookupType === 'lookup' && this.lookup) {\r\n      this.lookup.writeValue(value);\r\n    } else if (this.lookupType === 'comboLookup' && this.comboLookup) {\r\n      this.comboLookup.writeValue(value);\r\n    }\r\n  }\r\n  constructor(@Optional() private lookup: LookupGridComponent, @Optional() private comboLookup: ComboLookupComponent) { }\r\n}","import { ElementRef } from \"@angular/core\";\r\nimport { FrameContext } from \"@farris/devkit\";\r\n\r\nexport class ComponentRef {\r\n  constructor(protected frameContext: FrameContext, protected elementRef: ElementRef) { }\r\n  public addComponent(componentRef: any) {\r\n    const id = this.elementRef && this.elementRef.nativeElement && this.elementRef.nativeElement.id;\r\n    if (this.frameContext && id && componentRef) {\r\n      this.frameContext.componentRefManager.add(id, componentRef);\r\n    }\r\n  }\r\n  public tryAddComponent(componentRef: any, componentId: string = null) {\r\n    const id = componentId || this.elementRef && this.elementRef.nativeElement && this.elementRef.nativeElement.id;\r\n    if (this.frameContext && id && componentRef && !this.frameContext.componentRefManager.has(id)) {\r\n      this.frameContext.componentRefManager.add(id, componentRef);\r\n    }\r\n  }\r\n}","import { AfterViewInit, Directive, ElementRef, Injector, OnDestroy, OnInit } from \"@angular/core\";\r\nimport { FrameContext } from \"@farris/devkit\";\r\nimport { ListNavComponent } from '@farris/ui-list-nav';\r\nimport { ComponentRef } from \"./component-ref\";\r\n\r\n@Directive({\r\n  selector: '[listNavRef]'\r\n})\r\nexport class ListNavComponentRefDirective extends ComponentRef implements OnInit, OnDestroy, AfterViewInit {\r\n  constructor(private injector: Injector, private component: ListNavComponent, public elementRef: ElementRef, public frameContext: FrameContext) {\r\n    super(frameContext, elementRef);\r\n  }\r\n  //#region angular lifecycle\r\n  ngAfterViewInit(): void {\r\n    this.tryAddComponent(this.component);\r\n  }\r\n  ngOnInit(): void {\r\n    this.addComponent(this.component);\r\n  }\r\n  ngOnDestroy(): void {\r\n  }\r\n  //#endregion\r\n}","import { AfterViewInit, Directive, ElementRef, Injector, OnDestroy, OnInit } from \"@angular/core\";\r\nimport { FrameContext } from \"@farris/devkit\";\r\nimport { ListViewComponent } from \"@farris/ui-list-view\";\r\nimport { ComponentRef } from \"./component-ref\";\r\n\r\n@Directive({\r\n  selector: '[listViewRef]'\r\n})\r\nexport class ListViewComponentRefDirective extends ComponentRef implements OnInit, OnDestroy, AfterViewInit {\r\n  constructor(private injector: Injector, private component: ListViewComponent, public elementRef: ElementRef, public frameContext: FrameContext) {\r\n    super(frameContext, elementRef);\r\n  }\r\n  ngAfterViewInit(): void {\r\n    this.tryAddComponent(this.component);\r\n  }\r\n  ngOnInit(): void {\r\n    this.addComponent(this.component);\r\n  }\r\n  ngOnDestroy(): void {\r\n  }\r\n}","import { AfterViewInit, Directive, ElementRef, Injector, OnDestroy, OnInit } from \"@angular/core\";\r\nimport { FrameContext } from \"@farris/devkit\";\r\nimport { ListFilterComponent } from '@farris/ui-list-filter';\r\nimport { ComponentRef } from \"./component-ref\";\r\n@Directive({\r\n  selector: '[listFilterRef]'\r\n})\r\nexport class ListFilterComponentRefDirective extends ComponentRef implements OnInit, OnDestroy, AfterViewInit {\r\n  constructor(private injector: Injector, private component: ListFilterComponent, public elementRef: ElementRef, public frameContext: FrameContext) { \r\n    super(frameContext, elementRef);\r\n  }\r\n  ngAfterViewInit(): void {\r\n    this.tryAddComponent(this.component);\r\n  }\r\n  ngOnInit(): void {\r\n    this.addComponent(this.component);\r\n  }\r\n  ngOnDestroy(): void {\r\n  }\r\n}","import { AfterViewInit, Directive, ElementRef, Injector, OnDestroy, OnInit } from \"@angular/core\";\r\nimport { FrameContext } from \"@farris/devkit\";\r\nimport { FilterComponent } from '@farris/ui-filter';\r\nimport { ComponentRef } from \"./component-ref\";\r\n\r\n@Directive({\r\n  selector: '[filterRef]'\r\n})\r\nexport class FilterComponentRefDirective extends ComponentRef implements OnInit, OnDestroy, AfterViewInit {\r\n  constructor(private injector: Injector, private component: FilterComponent, public elementRef: ElementRef, public frameContext: FrameContext) {\r\n    super(frameContext, elementRef);\r\n  }\r\n  ngAfterViewInit(): void {\r\n    this.tryAddComponent(this.component);\r\n  }\r\n  ngOnInit(): void {\r\n    this.addComponent(this.component);\r\n  }\r\n  ngOnDestroy(): void {\r\n  }\r\n\r\n}","import { AfterViewInit, Directive, ElementRef, Injector, OnDestroy, OnInit } from \"@angular/core\";\r\nimport { FrameContext } from \"@farris/devkit\";\r\nimport { ViewChangeComponent } from '@farris/ui-view-change';\r\nimport { ComponentRef } from \"./component-ref\";\r\n\r\n@Directive({\r\n  selector: '[viewChangeRef]'\r\n})\r\nexport class ViewChangeComponentRefDirective extends ComponentRef implements OnInit, OnDestroy, AfterViewInit {\r\n  constructor(private injector: Injector, private component: ViewChangeComponent, public elementRef: ElementRef, public frameContext: FrameContext) {\r\n    super(frameContext, elementRef);\r\n  }\r\n  ngAfterViewInit(): void {\r\n    this.tryAddComponent(this.component);\r\n  }\r\n  ngOnInit(): void {\r\n    this.addComponent(this.component);\r\n  }\r\n  ngOnDestroy(): void {\r\n  }\r\n\r\n}","import { AfterViewInit, Directive, ElementRef, Injector, OnDestroy, OnInit } from \"@angular/core\";\r\nimport { FrameContext } from \"@farris/devkit\";\r\nimport { HtmlEditorComponent } from '@farris/ui-html-editor';\r\nimport { ComponentRef } from \"./component-ref\";\r\n\r\n@Directive({\r\n  selector: '[htmlEditorRef]'\r\n})\r\nexport class HtmlEditorComponentRefDirective extends ComponentRef implements OnInit, OnDestroy, AfterViewInit {\r\n  constructor(private injector: Injector, private component: HtmlEditorComponent, public elementRef: ElementRef, public frameContext: FrameContext) {\r\n    super(frameContext, elementRef);\r\n  }\r\n  ngAfterViewInit(): void {\r\n    this.tryAddComponent(this.component);\r\n  }\r\n  ngOnInit(): void {\r\n    this.addComponent(this.component);\r\n  }\r\n  ngOnDestroy(): void {\r\n  }\r\n\r\n}","import { AfterViewInit, Directive, ElementRef, Injector, OnDestroy, OnInit } from \"@angular/core\";\r\nimport { FrameContext } from \"@farris/devkit\";\r\nimport { FarrisSectionComponent } from '@farris/ui-section';\r\nimport { ComponentRef } from \"./component-ref\";\r\n\r\n@Directive({\r\n  selector: '[sectionRef]'\r\n})\r\nexport class SectionComponentRefDirective extends ComponentRef implements OnInit, OnDestroy, AfterViewInit {\r\n  constructor(private injector: Injector, private component: FarrisSectionComponent, public elementRef: ElementRef, public frameContext: FrameContext) {\r\n    super(frameContext, elementRef);\r\n  }\r\n  ngAfterViewInit(): void {\r\n    this.tryAddComponent(this.component);\r\n  }\r\n  ngOnInit(): void {\r\n    this.addComponent(this.component);\r\n  }\r\n  ngOnDestroy(): void {\r\n  }\r\n\r\n}","import { AfterViewInit, Directive, ElementRef, Injector, OnDestroy, OnInit } from \"@angular/core\";\r\nimport { FrameContext } from \"@farris/devkit\";\r\nimport { InputGroupComponent } from '@farris/ui-input-group';\r\nimport { ComponentRef } from \"./component-ref\";\r\n\r\n@Directive({\r\n  selector: '[inputGroupRef]'\r\n})\r\nexport class InputGroupComponentRefDirective extends ComponentRef implements OnInit, OnDestroy, AfterViewInit {\r\n  constructor(private injector: Injector, private component: InputGroupComponent, public elementRef: ElementRef, public frameContext: FrameContext) {\r\n    super(frameContext, elementRef);\r\n  }\r\n  ngAfterViewInit(): void {\r\n    this.tryAddComponent(this.component);\r\n  }\r\n  ngOnInit(): void {\r\n    this.addComponent(this.component);\r\n  }\r\n  ngOnDestroy(): void {\r\n  }\r\n\r\n}","import { AfterViewInit, Directive, ElementRef, Injector, OnDestroy, OnInit } from \"@angular/core\";\r\nimport { FrameContext } from \"@farris/devkit\";\r\nimport { FarrisDatepickerComponent } from '@farris/ui-datepicker';\r\nimport { ComponentRef } from \"./component-ref\";\r\n\r\n@Directive({\r\n  selector: '[datepickerRef]'\r\n})\r\nexport class DatepickerComponentRefDirective extends ComponentRef implements OnInit, OnDestroy, AfterViewInit {\r\n  constructor(private injector: Injector, private component: FarrisDatepickerComponent, public elementRef: ElementRef, public frameContext: FrameContext) {\r\n    super(frameContext, elementRef);\r\n  }\r\n  ngAfterViewInit(): void {\r\n    this.tryAddComponent(this.component);\r\n  }\r\n  ngOnInit(): void {\r\n    this.addComponent(this.component);\r\n  }\r\n  ngOnDestroy(): void {\r\n  }\r\n\r\n}","import { AfterViewInit, Directive, ElementRef, Injector, OnDestroy, OnInit } from \"@angular/core\";\r\nimport { FrameContext } from \"@farris/devkit\";\r\nimport { TimePickerComponent } from '@farris/ui-time-picker';\r\nimport { ComponentRef } from \"./component-ref\";\r\n\r\n@Directive({\r\n  selector: '[timePickerRef]'\r\n})\r\nexport class TimePickerComponentRefDirective extends ComponentRef implements OnInit, OnDestroy, AfterViewInit {\r\n  constructor(private injector: Injector, private component: TimePickerComponent, public elementRef: ElementRef, public frameContext: FrameContext) {\r\n    super(frameContext, elementRef);\r\n  }\r\n  ngAfterViewInit(): void {\r\n    this.tryAddComponent(this.component);\r\n  }\r\n  ngOnInit(): void {\r\n    this.addComponent(this.component);\r\n  }\r\n  ngOnDestroy(): void {\r\n  }\r\n\r\n}","import { AfterViewInit, Directive, ElementRef, Injector, OnDestroy, OnInit } from \"@angular/core\";\r\nimport { FrameContext } from \"@farris/devkit\";\r\nimport { NumberSpinnerComponent } from \"@farris/ui-number-spinner\";\r\nimport { ComponentRef } from \"./component-ref\";\r\n\r\n@Directive({\r\n  selector: '[numberSpinnerRef]'\r\n})\r\nexport class NumberSpinnerComponentRefDirective extends ComponentRef implements OnInit, OnDestroy, AfterViewInit {\r\n  constructor(private injector: Injector, private component: NumberSpinnerComponent, public elementRef: ElementRef, public frameContext: FrameContext) {\r\n    super(frameContext, elementRef);\r\n  }\r\n  ngAfterViewInit(): void {\r\n    this.tryAddComponent(this.component);\r\n  }\r\n  ngOnInit(): void {\r\n    this.addComponent(this.component);\r\n  }\r\n  ngOnDestroy(): void {\r\n  }\r\n}","import { AfterViewInit, Directive, ElementRef, Injector, OnDestroy, OnInit } from \"@angular/core\";\r\nimport { FrameContext } from \"@farris/devkit\";\r\nimport { ComboListComponent } from '@farris/ui-combo-list';\r\nimport { ComponentRef } from \"./component-ref\";\r\n\r\n@Directive({\r\n  selector: '[comboListRef]'\r\n})\r\nexport class ComboListComponentRefDirective extends ComponentRef implements OnInit, OnDestroy, AfterViewInit {\r\n  constructor(private injector: Injector, private component: ComboListComponent, public elementRef: ElementRef, public frameContext: FrameContext) {\r\n    super(frameContext, elementRef);\r\n  }\r\n  ngAfterViewInit(): void {\r\n    this.tryAddComponent(this.component);\r\n  }\r\n  ngOnInit(): void {\r\n    this.addComponent(this.component);\r\n  }\r\n  ngOnDestroy(): void {\r\n  }\r\n}","import { AfterViewInit, Directive, ElementRef, Injector, OnDestroy, OnInit } from \"@angular/core\";\r\nimport { FrameContext } from \"@farris/devkit\";\r\nimport { ComboLookupComponent } from '@farris/ui-combo-lookup';\r\nimport { ComponentRef } from \"./component-ref\";\r\n\r\n@Directive({\r\n  selector: '[comboLookupRef]'\r\n})\r\nexport class ComboLookupComponentRefDirective extends ComponentRef implements OnInit, OnDestroy, AfterViewInit {\r\n  constructor(private injector: Injector, private component: ComboLookupComponent, public elementRef: ElementRef, public frameContext: FrameContext) { \r\n    super(frameContext, elementRef);\r\n  }\r\n  ngAfterViewInit(): void {\r\n    this.tryAddComponent(this.component);\r\n  }\r\n  ngOnInit(): void {\r\n    this.addComponent(this.component);\r\n  }\r\n  ngOnDestroy(): void {\r\n  }\r\n\r\n}","import { AfterViewInit, Directive, ElementRef, Injector, OnDestroy, OnInit } from \"@angular/core\";\r\nimport { FrameContext } from \"@farris/devkit\";\r\nimport { LookupGridComponent } from '@farris/ui-lookup';\r\nimport { ComponentRef } from \"./component-ref\";\r\n\r\n@Directive({\r\n  selector: '[lookupGridRef]'\r\n})\r\nexport class LookupGridComponentRefDirective extends ComponentRef implements OnInit, OnDestroy, AfterViewInit {\r\n  constructor(private injector: Injector, private component: LookupGridComponent, public elementRef: ElementRef, public frameContext: FrameContext) {\r\n    super(frameContext, elementRef);\r\n  }\r\n  ngAfterViewInit(): void {\r\n    this.tryAddComponent(this.component);\r\n  }\r\n  ngOnInit(): void {\r\n    this.addComponent(this.component);\r\n  }\r\n  ngOnDestroy(): void {\r\n  }\r\n\r\n}","import { AfterViewInit, Directive, ElementRef, Injector, OnDestroy, OnInit } from \"@angular/core\";\r\nimport { FrameContext } from \"@farris/devkit\";\r\nimport { DatagridComponent } from '@farris/ui-datagrid';\r\nimport { ComponentRef } from \"./component-ref\";\r\n\r\n@Directive({\r\n  selector: '[datagridRef]'\r\n})\r\nexport class DatagridComponentRefDirective extends ComponentRef implements OnInit, OnDestroy, AfterViewInit {\r\n  constructor(private injector: Injector, private component: DatagridComponent, public elementRef: ElementRef, public frameContext: FrameContext) {\r\n    super(frameContext, elementRef);\r\n  }\r\n  ngAfterViewInit(): void {\r\n    this.tryAddComponent(this.component, this.component.id);\r\n  }\r\n  ngOnInit(): void {\r\n    this.addComponent(this.component);\r\n  }\r\n  ngOnDestroy(): void {\r\n  }\r\n\r\n}","import { AfterViewInit, Directive, ElementRef, Injector, OnDestroy, OnInit } from \"@angular/core\";\r\nimport { FrameContext } from \"@farris/devkit\";\r\nimport { TreeTableComponent } from '@farris/ui-treetable';\r\nimport { ComponentRef } from \"./component-ref\";\r\n\r\n@Directive({\r\n  selector: '[treetableRef]'\r\n})\r\nexport class TreetableComponentRefDirective extends ComponentRef implements OnInit, OnDestroy, AfterViewInit {\r\n  constructor(private injector: Injector, private component: TreeTableComponent, public elementRef: ElementRef, public frameContext: FrameContext) {\r\n    super(frameContext, elementRef);\r\n  }\r\n  ngAfterViewInit(): void {\r\n    this.tryAddComponent(this.component);\r\n  }\r\n  ngOnInit(): void {\r\n    this.addComponent(this.component);\r\n  }\r\n  ngOnDestroy(): void {\r\n  }\r\n\r\n}","import { AfterViewInit, Directive, ElementRef, Injector, OnDestroy, OnInit } from \"@angular/core\";\r\nimport { FrameContext } from \"@farris/devkit\";\r\nimport { WizardComponent } from '@farris/ui-wizard';\r\nimport { ComponentRef } from \"./component-ref\";\r\n\r\n@Directive({\r\n  selector: '[wizardRef]'\r\n})\r\nexport class WizardComponentRefDirective extends ComponentRef implements OnInit, OnDestroy, AfterViewInit {\r\n  constructor(private injector: Injector, private component: WizardComponent, public elementRef: ElementRef, public frameContext: FrameContext) {\r\n    super(frameContext, elementRef);\r\n  }\r\n  ngAfterViewInit(): void {\r\n    this.tryAddComponent(this.component);\r\n  }\r\n  ngOnInit(): void {\r\n    this.addComponent(this.component);\r\n  }\r\n  ngOnDestroy(): void {\r\n  }\r\n\r\n}","import { AfterViewInit, Directive, ElementRef, Injector, OnDestroy, OnInit } from \"@angular/core\";\r\nimport { FrameContext } from \"@farris/devkit\";\r\nimport { DiscussionEditorComponent } from '@farris/discussion-group';\r\nimport { ComponentRef } from \"./component-ref\";\r\n\r\n@Directive({\r\n  selector: '[discussionEditorRef]'\r\n})\r\nexport class DiscussionEditorComponentRefDirective extends ComponentRef implements OnInit, OnDestroy, AfterViewInit {\r\n  constructor(private injector: Injector, private component: DiscussionEditorComponent, public elementRef: ElementRef, public frameContext: FrameContext) { \r\n    super(frameContext, elementRef);\r\n  }\r\n  ngAfterViewInit(): void {\r\n    this.tryAddComponent(this.component);\r\n  }\r\n  ngOnInit(): void {\r\n    this.addComponent(this.component);\r\n  }\r\n  ngOnDestroy(): void {\r\n  }\r\n\r\n}","import { AfterViewInit, Directive, ElementRef, Injector, OnDestroy, OnInit } from \"@angular/core\";\r\nimport { FrameContext } from \"@farris/devkit\";\r\nimport { DiscussionListComponent } from '@farris/discussion-group';\r\nimport { ComponentRef } from \"./component-ref\";\r\n\r\n@Directive({\r\n  selector: '[discussionListRef]'\r\n})\r\nexport class DiscussionListComponentRefDirective extends ComponentRef implements OnInit, OnDestroy, AfterViewInit {\r\n  constructor(private injector: Injector, private component: DiscussionListComponent, public elementRef: ElementRef, public frameContext: FrameContext) {\r\n    super(frameContext, elementRef);\r\n  }\r\n  ngAfterViewInit(): void {\r\n    this.tryAddComponent(this.component);\r\n  }\r\n  ngOnInit(): void {\r\n    this.addComponent(this.component);\r\n  }\r\n  ngOnDestroy(): void {\r\n  }\r\n\r\n}","import { AfterViewInit, Directive, ElementRef, Injector, OnDestroy, OnInit } from \"@angular/core\";\r\nimport { FrameContext } from \"@farris/devkit\";\r\nimport { NavComponent } from '@farris/ui-nav';\r\nimport { ComponentRef } from \"./component-ref\";\r\n\r\n@Directive({\r\n  selector: '[navRef]'\r\n})\r\nexport class NavComponentRefDirective extends ComponentRef implements OnInit, OnDestroy, AfterViewInit {\r\n  constructor(private injector: Injector, private component: NavComponent, public elementRef: ElementRef, public frameContext: FrameContext) {\r\n    super(frameContext, elementRef);\r\n  }\r\n  ngAfterViewInit(): void {\r\n    this.tryAddComponent(this.component);\r\n  }\r\n  ngOnInit(): void {\r\n    this.addComponent(this.component);\r\n  }\r\n  ngOnDestroy(): void {\r\n  }\r\n\r\n}","import { AfterViewInit, Directive, ElementRef, Injector, OnDestroy, OnInit } from \"@angular/core\";\r\nimport { FrameContext } from \"@farris/devkit\";\r\nimport { MultiSelectComponent } from '@farris/ui-multi-select';\r\nimport { ComponentRef } from \"./component-ref\";\r\n\r\n@Directive({\r\n  selector: '[multiSelectRef]'\r\n})\r\nexport class MultiSelectComponentRefDirective extends ComponentRef implements OnInit, OnDestroy, AfterViewInit {\r\n  constructor(private injector: Injector, private component: MultiSelectComponent, public elementRef: ElementRef, public frameContext: FrameContext) { \r\n    super(frameContext, elementRef);\r\n  }\r\n  ngAfterViewInit(): void {\r\n    this.tryAddComponent(this.component);\r\n  }\r\n  ngOnInit(): void {\r\n    this.addComponent(this.component);\r\n  }\r\n  ngOnDestroy(): void {\r\n  }\r\n\r\n}","import { AfterViewInit, Directive, ElementRef, Injector, OnDestroy, OnInit } from \"@angular/core\";\r\nimport { FrameContext } from \"@farris/devkit\";\r\nimport { ScrollspyComponent } from '@farris/ui-scrollspy';\r\nimport { ComponentRef } from \"./component-ref\";\r\n\r\n@Directive({\r\n  selector: '[scrollspyRef]'\r\n})\r\nexport class ScrollspyComponentRefDirective extends ComponentRef implements OnInit, OnDestroy, AfterViewInit {\r\n  constructor(private injector: Injector, private component: ScrollspyComponent, public elementRef: ElementRef, public frameContext: FrameContext) {\r\n    super(frameContext, elementRef);\r\n  }\r\n  ngAfterViewInit(): void {\r\n    this.tryAddComponent(this.component);\r\n  }\r\n  ngOnInit(): void {\r\n    this.addComponent(this.component);\r\n  }\r\n  ngOnDestroy(): void {\r\n  }\r\n\r\n}","\r\n/**\r\n * \r\n * [comob-lookup-data-mapping]=\"{ id: 'user.userId', name: 'user.userName' }\"\r\n * key  value  \r\n * { ... id: 'user.userid, user.addusid'}\r\n * \r\n *\r\n */\r\n\r\nimport { Directive, OnInit, Optional, Self, Input } from '@angular/core';\r\nimport { BindingObject, NgFormControl, ViewModel } from '@farris/devkit';\r\nimport { ComboChanges } from '@farris/ui-combo-list';\r\nimport { ComboLookupComponent } from '@farris/ui-combo-lookup';\r\nimport { DataMapping } from './data-mapping';\r\n\r\n\r\n@Directive({ selector: '[combo-lookup-data-mapping]' })\r\nexport class ComboLookupDataMappingDirective extends DataMapping implements OnInit {\r\n  @Input('combo-lookup-data-mapping') mapfields: any;\r\n  @Input('target') target: BindingObject = null;\r\n\r\n  constructor(@Optional() public vm: ViewModel, @Optional() @Self() private lookup: ComboLookupComponent) {\r\n    super();\r\n    if (this.lookup) {\r\n      this.lookup.useFormDataMapping = true;\r\n    }\r\n  }\r\n\r\n  ngOnInit() {\r\n    // \r\n    this.lookup.valueChange.subscribe((result: ComboChanges) => {\r\n      if (!result['nosearch']) {\r\n        // \r\n        const data = result.selections && result.selections.length > 0 ? result.selections : null;\r\n        this.onValueChange(data);\r\n      } else {\r\n        // \r\n        this.onClearMapping();\r\n      }\r\n    });\r\n    // \r\n    this.lookup.clear.subscribe(() => {\r\n      const _mapfields = this.mapfields || this.lookup.mapFields;\r\n      this.mappingData(null, _mapfields);\r\n    });\r\n  }\r\n  private onClearMapping() {\r\n    const mapfields = Object.assign({}, (this.mapfields || this.lookup.mapFields || {}));\r\n    const lookupTextField = this.lookup.textField;\r\n    const data = {};\r\n    const controlName = this.lookup.ngControl && this.lookup.ngControl.name;\r\n    if (controlName && this.vm) {\r\n      const textFieldMapping = mapfields[lookupTextField];\r\n      const ngFormControl = this.vm && this.vm.form && this.vm.form.ngFormControls && this.vm.form.ngFormControls[controlName] as NgFormControl;\r\n      const binding = ngFormControl && ngFormControl.binding;\r\n      if (textFieldMapping && binding) {\r\n        const targetField = textFieldMapping.split(',').filter((item) => item !== binding).join(',');\r\n        if (targetField) {\r\n          mapfields[lookupTextField] = targetField;\r\n        } else {\r\n          delete mapfields[lookupTextField];\r\n        }\r\n      }\r\n    }\r\n    if (mapfields && Object.keys(mapfields).length > 0) {\r\n      Object.keys(mapfields).forEach((field) => {\r\n        this.setValue(data, field.split('.'), '');\r\n      });\r\n      this.mappingData(data, mapfields, true);\r\n    }\r\n  }\r\n  private onValueChange(data) {\r\n    const _mapfields = this.mapfields || this.lookup.mapFields;\r\n    const spliter = this.lookup.separator || this.defaultSpliter;\r\n    this.mappingData(data, _mapfields, false, spliter);\r\n  }\r\n}\r\n","import { Repository } from \"@farris/devkit\";\r\n\r\nexport abstract class BefRepository extends Repository<any>{\r\n  restService: BefRestService;\r\n}\r\nexport interface BefRestService {\r\n  request(url: string, method: string, params?: any, options?: any, selfHandError?: boolean, ignoreError?: boolean, ignoreChanges?: boolean);\r\n  buildRequestInfo();\r\n}\r\nexport enum ViewType {\r\n  day = 'day',\r\n  week = 'week'\r\n}","import {\r\n  Directive, OnInit, OnChanges, OnDestroy, SimpleChanges, HostListener, Injector, Input\r\n} from '@angular/core';\r\nimport { Subscription } from 'rxjs';\r\nimport { BindingData, BindingList, Change, ChangeType, ViewModel, FrameContext } from '@farris/devkit';\r\nimport { AppointmentCalendarComponent } from '@farris/appointment-calendar';\r\nimport { BefRestService, BefRepository, ViewType } from './types';\r\nimport { isEqual } from 'lodash-es';\r\nimport { BasePathService } from '@farris/rtf';\r\n\r\n@Directive({\r\n  selector: '[farris-appointment-calendar-binding]'\r\n})\r\nexport class AppointmentCalendarBindingDirective implements OnInit, OnChanges, OnDestroy {\r\n  private __DATA__: any;\r\n  private bindingDataChangeEvent: Subscription;\r\n  private get bindingData(): BindingData {\r\n    return this.frameContext.bindingData;\r\n  }\r\n  private get viewModel(): ViewModel {\r\n    return this.frameContext.viewModel;\r\n  }\r\n  private restService(): BefRestService {\r\n    return (this.frameContext.repository as BefRepository).restService;\r\n  }\r\n  /**\r\n   * \r\n   */\r\n  protected get bindingList(): BindingList {\r\n    // \r\n    if (this.viewModel.bindingPath === '/' || !this.viewModel.bindingPath) {\r\n      return this.bindingData.list;\r\n    }\r\n    // \r\n    let bindingPath = this.viewModel.bindingPath.substr(1);\r\n    bindingPath = bindingPath[0].toLowerCase() + bindingPath.substring(1, bindingPath.length);\r\n    const paths = bindingPath.split('/');\r\n\r\n    const filteredPaths = paths.filter((part: string) => {\r\n      return part !== '';\r\n    });\r\n    return this.bindingData.getValue(filteredPaths);\r\n  }\r\n  /**\r\n   * api url\r\n   */\r\n  @Input() url: string = null;\r\n  /**\r\n   * http method, default PUT\r\n   */\r\n  @Input() method: string = 'PUT';\r\n  @Input() startDateVariable: string = 'startDate';\r\n  @Input() endDateVariable: string = 'endDate';\r\n  @Input() viewTypeVariable: string = 'viewType';\r\n\r\n  constructor(private injector: Injector, private frameContext: FrameContext, private calendarComponent: AppointmentCalendarComponent) { }\r\n\r\n  ngOnInit(): void {\r\n    this.loadPlacements();\r\n    this.registerBindingDataChangeEvent();\r\n  }\r\n  ngOnChanges(changes: SimpleChanges): void {\r\n\r\n  }\r\n  ngOnDestroy(): void {\r\n    this.unRegisterBindingDataChangeEvent();\r\n  }\r\n  private bindData(change: Change) {\r\n    // toJSON\r\n    let data: any = this.bindingList.toJSON();\r\n    if (this.__DATA__ && isEqual(this.__DATA__, data)) {\r\n      return;\r\n    }\r\n    this.__DATA__ = data;\r\n    this.calendarComponent.loadReserveData(data);\r\n  }\r\n  private onBindingDataChange(change: Change) {\r\n    this.bindData(change);\r\n    this.updateSelectedRow(change);\r\n  }\r\n  private registerBindingDataChangeEvent() {\r\n    this.bindingDataChangeEvent = this.bindingData.changes.subscribe((change: Change) => {\r\n      this.onBindingDataChange(change);\r\n    });\r\n  }\r\n  /**\r\n   * bindingdata\r\n   */\r\n  private unRegisterBindingDataChangeEvent() {\r\n    if (this.bindingDataChangeEvent && typeof (this.bindingDataChangeEvent.unsubscribe) === 'function') {\r\n      this.bindingDataChangeEvent.unsubscribe();\r\n    }\r\n  }\r\n  private loadPlacements() {\r\n    if (!this.url) {\r\n      console.log('api');\r\n      return;\r\n    }\r\n    const requestInfo = this.restService().buildRequestInfo();\r\n    const options = {\r\n      body: {\r\n        requestInfo\r\n      }\r\n    };\r\n    const url = BasePathService.convertPath(this.url);\r\n    this.restService().request(url, this.method, null, options).subscribe((returnValue: any) => {\r\n      this.bindPlacements(returnValue);\r\n    });\r\n  }\r\n  private bindPlacements(placments: any) {\r\n    this.calendarComponent.loadPlaceData(placments);\r\n  }\r\n  private updateState(startDate: string, endDate: string, viewType: string) {\r\n    this.viewModel.uiState.setPropertyValue(this.startDateVariable, startDate);\r\n    this.viewModel.uiState.setPropertyValue(this.endDateVariable, endDate);\r\n    this.viewModel.uiState.setPropertyValue(this.viewTypeVariable, viewType);\r\n  }\r\n  private updateSelectedRow(change?: Change) {\r\n    if (!this.bindingList || !this.bindingList.currentId) {\r\n      return;\r\n    }\r\n    // \r\n    if (change && change.type === ChangeType.PaginationInfoChange) {\r\n      return;\r\n    }\r\n    if (this.viewModel && this.viewModel.frameContext.bindingData.rowSelectedEventSuspend === true) {\r\n      return;\r\n    }\r\n    const id = this.calendarComponent.selectedId;\r\n    const currentId = this.bindingList.currentId;\r\n    // gridbingingList\r\n    if (id === currentId) {\r\n      return;\r\n    }\r\n    this.selectCalendarRow(this.bindingList.currentId);\r\n  }\r\n  private selectCalendarRow(id: string) {\r\n    this.calendarComponent.selectItem(id);\r\n  }\r\n  @HostListener('filterChange', ['$event'])\r\n  public filterChanged(event: any) {\r\n    const { dateValue = null, place = null, viewType = null } = event || {};\r\n    let startDate = null;\r\n    let endDate = null;\r\n    if (!dateValue) {\r\n      return;\r\n    }\r\n    if (viewType === ViewType.day) {\r\n      startDate = `${dateValue} 00:00:00`;\r\n      endDate = `${dateValue} 23:59:59`;\r\n    } else if (viewType === ViewType.week && dateValue.indexOf('~') !== -1) {\r\n      const sections = dateValue.split('~');\r\n      startDate = `${sections[0]} 00:00:00`;\r\n      endDate = `${sections[1]} 23:59:59`;\r\n    }\r\n    this.updateState(startDate, endDate, viewType);\r\n  }\r\n  protected setSelectionIdToBindingData(id: string): void {\r\n    // \r\n    if (this.bindingList.currentId !== id) {\r\n      this.bindingList.setCurrentId(id, true);\r\n    }\r\n  }\r\n  @HostListener('selectChange', ['$event'])\r\n  public selectChange(event) {\r\n    const { item: { id = null } } = event;\r\n    this.setSelectionIdToBindingData(id);\r\n  }\r\n}\r\n","import { AfterViewInit, ChangeDetectorRef, Directive, ElementRef, Injector, Input, OnInit, OnChanges, SimpleChanges } from '@angular/core';\r\nimport { DatagridComponent } from '@farris/ui-datagrid';\r\nimport { FrameContext } from '@farris/devkit';\r\nimport { BefRepository, BefRestService } from '../appointment-calendar/types';\r\n\r\ntype SizeConfig = {\r\n  'headerHeight'?: number,\r\n  'footerHeight'?: number,\r\n  'rowHeight'?: number,\r\n  'checkboxColumnWidth'?: number,\r\n  'lineNumberWidth'?: number,\r\n  'filterRowHeight'?: number\r\n};\r\n\r\n\r\n@Directive({ selector: '[custom-size]' })\r\nexport class CustomDatagridSizeDirective implements OnInit, AfterViewInit, OnChanges {\r\n  @Input('custom-size') useCustomSize = false;\r\n  @Input() sizeApiUri = '';\r\n\r\n  private restService(): BefRestService {\r\n    return (this.frameContext.repository as BefRepository).restService;\r\n  }\r\n\r\n  constructor(private dg: DatagridComponent, private injector: Injector, private cd: ChangeDetectorRef, private el: ElementRef,\r\n    private frameContext: FrameContext) { }\r\n\r\n  ngOnInit(): void {\r\n\r\n  }\r\n\r\n  ngOnChanges(changes: SimpleChanges) {\r\n    if (changes.sizeApiUri && !changes.sizeApiUri.isFirstChange()) {\r\n      this.applyNewSize();\r\n    }\r\n  }\r\n\r\n  ngAfterViewInit(): void {\r\n    this.applyNewSize();\r\n  }\r\n\r\n  private applyNewSize() {\r\n    if (this.useCustomSize && this.sizeApiUri) {\r\n      this.getSizeConfig().subscribe((cfg: SizeConfig) => {\r\n        if (this.dg && typeof this.dg.applyNewSize === 'function') {\r\n          this.dg.applyNewSize(cfg);\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n\r\n  private getSizeConfig() {\r\n    return this.restService().request(this.sizeApiUri, 'get');\r\n  }\r\n}\r\n","import { Directive, Injector, Input, OnDestroy, OnInit, Optional } from '@angular/core';\r\nimport { FrameContext } from '@farris/devkit';\r\nimport { FilterComponent } from '@farris/ui-filter';\r\nimport { Subject } from 'rxjs';\r\nimport { takeUntil } from 'rxjs/operators';\r\n\r\n@Directive({\r\n  selector: '[farris-filter-binding]'\r\n})\r\nexport class FarrisFilterBindingDirective implements OnInit, OnDestroy {\r\n  private $destroy: Subject<any>;\r\n  /**\r\n   * filterConditionList\r\n   */\r\n  @Input('variableCode') variableCode = 'filterConditionList';\r\n  constructor(\r\n    private injector: Injector,\r\n    private frameContext: FrameContext,\r\n    @Optional() private filterComponent: FilterComponent\r\n  ) {\r\n    this.$destroy = new Subject<any>();\r\n  }\r\n  ngOnDestroy(): void {\r\n    if (this.$destroy) {\r\n      this.$destroy.next();\r\n      this.$destroy.complete();\r\n    }\r\n  }\r\n  ngOnInit(): void {\r\n    if (this.filterComponent) {\r\n      this.filterComponent.conditionsChange.pipe(takeUntil(this.$destroy)).subscribe((event: any) => {\r\n        const { data = '[]' } = event || {};\r\n        this.setConditions(data);\r\n      });\r\n    }\r\n  }\r\n  private setConditions(conditions: string) {\r\n    this.frameContext.uiState.setPropertyValue(this.variableCode, conditions);\r\n  }\r\n}\r\n","import { Directive, Injector, Input, OnDestroy, OnInit, Optional } from '@angular/core';\r\nimport { FrameContext } from '@farris/devkit';\r\nimport { ListFilterComponent } from '@farris/ui-list-filter';\r\nimport { Subject } from 'rxjs';\r\nimport { takeUntil } from 'rxjs/operators';\r\n\r\n@Directive({\r\n  selector: '[farris-list-filter-binding]'\r\n})\r\nexport class FarrisListFilterBindingDirective implements OnInit, OnDestroy {\r\n  private $destroy: Subject<any>;\r\n  /**\r\n   * filterConditionList\r\n   */\r\n  @Input('variableCode') variableCode = 'filterConditionList';\r\n  constructor(\r\n    private injector: Injector,\r\n    private frameContext: FrameContext,\r\n    @Optional() private listFilterComponent: ListFilterComponent\r\n  ) {\r\n    this.$destroy = new Subject<any>();\r\n  }\r\n  ngOnDestroy(): void {\r\n    if (this.$destroy) {\r\n      this.$destroy.next();\r\n      this.$destroy.complete();\r\n    }\r\n  }\r\n  ngOnInit(): void {\r\n    if (this.listFilterComponent) {\r\n      this.listFilterComponent.conditionsChange.pipe(takeUntil(this.$destroy)).subscribe((event: any) => {\r\n        const { data = '[]' } = event || {};\r\n        this.setConditions(data);\r\n      });\r\n    }\r\n  }\r\n  private setConditions(conditions: string) {\r\n    this.frameContext.uiState.setPropertyValue(this.variableCode, conditions);\r\n  }\r\n}\r\n","import { Injector, Optional, Pipe, PipeTransform } from '@angular/core';\r\nimport { DownloadService } from '@gsp-svc/formdoc-upload';\r\nimport { BasePathService } from '@farris/rtf';\r\n@Pipe({ name: 'imageIdToUrl' })\r\nclass ImageIdToUrlPipe implements PipeTransform {\r\n  private defaultPic = BasePathService.convertPath('/platform/common/web/assets/imgs/no-pic.png');\r\n  private downloadService: DownloadService;\r\n  constructor(@Optional() private injector: Injector) {\r\n    this.downloadService = this.injector && this.injector.get<DownloadService>(DownloadService, null) || null;\r\n  }\r\n\r\n  transform(value: string, rootId: string = 'default-root'): string {\r\n    if (!value) {\r\n      return this.defaultPic;\r\n    }\r\n    //const rootId = 'default-root';\r\n    if (this.downloadService) {\r\n      return this.downloadService.getDownloadUrl(value, rootId);\r\n    } else {\r\n      console.warn('');\r\n      return BasePathService.convertPath(`/api/runtime/dfs/v1.0/formdoc/download/${value}`);\r\n    }\r\n  }\r\n}\r\n\r\nexport { ImageIdToUrlPipe };\r\n","import { LocaleService } from '@farris/ui-locale';\r\nimport { Pipe, PipeTransform, Injector, Optional } from '@angular/core';\r\nimport { ColumnFormatService } from '@farris/ui-common/column';\r\n\r\n@Pipe({ name: 'formatPrimeNgTreeTableCellData', pure: false })\r\nexport class FormatPrimeNgTreeTableCellData implements PipeTransform {\r\n\r\n  private localeService: LocaleService;\r\n  constructor(private cfs: ColumnFormatService, @Optional() private injector?: Injector) {\r\n    if (this.injector) {\r\n      this.localeService = this.injector.get(LocaleService);\r\n    }\r\n  }\r\n\r\n  transform(col: any, rowData: any): any {\r\n    let value = '';\r\n    if (rowData && col && col.field) {\r\n      value = this.getValue(col.field, rowData);\r\n      let formatterFn = col.formatter;\r\n      if (!formatterFn) {\r\n        if (col.isMultilingualField) {\r\n          return this.getMultiLanguageValue(value);\r\n        } else {\r\n          return value;\r\n        }\r\n      } else {\r\n        return this.cfs.format(value, rowData, formatterFn);\r\n      }\r\n    }\r\n    return '';\r\n  }\r\n\r\n  // \r\n  private getMultiLanguageValue(valObj) {\r\n    if (valObj && typeof valObj === 'object' && Object.keys(valObj).length > 0) {\r\n      const localeId = this.localeService && this.localeService.localeId || 'zh-CHS';\r\n      const value = valObj[localeId];\r\n      return value === undefined ? '' : value;\r\n    } else {\r\n      return '';\r\n    }\r\n  }\r\n  private getValue(path: string, target: any) {\r\n    if (!target) {\r\n      return '';\r\n    }\r\n    var resultVal = '';\r\n    if (path.indexOf('.') === -1) {\r\n      resultVal = target[path];\r\n    }\r\n    else {\r\n      resultVal = path.split('.').reduce(((obj, key) => {\r\n        return obj && obj[key] || null;\r\n      }), target);\r\n    }\r\n    return resultVal;\r\n  };\r\n  /**\r\n   * \r\n   * @param col col\r\n   */\r\n  private isHelpColumn(col: any) {\r\n    return col && col.editor && col.editor.options && col.editor.options.type === 'EditorTypes.LOOKUP' || false;\r\n  }\r\n  private getHelpColumnValue(col: any, data: any) {\r\n    const textField = this.getHelpControlTextField(col);\r\n    const mapFields = this.getHelpControlMapFields(col);\r\n    if (textField && mapFields && Object.keys(mapFields).length > 0) {\r\n      const path = mapFields[textField];\r\n      return this.getValue(path, data);\r\n    }\r\n    return '';\r\n  }\r\n  private getHelpControlTextField(col: any) {\r\n    return col && col.editor && col.editor.options && col.editor.options.textField || '';\r\n  }\r\n  private getHelpControlMapFields(col: any) {\r\n    return col && col.editor && col.editor.options && col.editor.options.mapFields || {};\r\n  }\r\n}\r\n","import { Inject, Injector, Optional, Pipe, PipeTransform } from \"@angular/core\";\r\nimport { NumberFormat, UserSettings, UserSettingsToken } from \"@farris/devkit\";\r\nimport { BigNumber } from 'bignumber.js';\r\nimport moment from 'moment';\r\n\r\n@Pipe({ name: 'localization' })\r\nexport class Localization implements PipeTransform {\r\n  constructor(@Optional() private injector: Injector, @Inject(UserSettingsToken) private userSettings: UserSettings) {\r\n  }\r\n  public transform(value: any, dataType: string) {\r\n    if (dataType) {\r\n      dataType = dataType.toLowerCase();\r\n      if (dataType === 'date') {\r\n        return this.transformDate(value);\r\n      } else if (dataType === 'datetime') {\r\n        return this.transformDateTime(value);\r\n      } else if (dataType === 'number') {\r\n        return this.transformNumber(value);\r\n      } else {\r\n        return value;\r\n      }\r\n    }\r\n  }\r\n  /**\r\n   * \r\n   * @param value value\r\n   */\r\n  private transformDate(value: any) {\r\n    let dateFormat = this.userSettings && this.userSettings.dateFormat || null;\r\n    if (!dateFormat || !value) {\r\n      return value;\r\n    }\r\n    const date = moment(value);\r\n    const isValid = date.isValid();\r\n    if (!isValid) {\r\n      return value;\r\n    }\r\n    dateFormat = this.parseDateFormat(dateFormat);\r\n    return date.format(dateFormat);\r\n  }\r\n  /**\r\n   * \r\n   * @param value value\r\n   * todo: \r\n   */\r\n  private transformDateTime(value: any) {\r\n    let dateFormat = this.userSettings && this.userSettings.dateFormat || '';\r\n    let timeFormat = this.userSettings && this.userSettings.timeFormat || '';\r\n    const dateTime = moment(value);\r\n    const isValid = dateTime.isValid();\r\n    if (!isValid) {\r\n      return value;\r\n    }\r\n    if (dateFormat) {\r\n      dateFormat = this.parseDateFormat(dateFormat);\r\n    }\r\n    if (timeFormat) {\r\n      timeFormat = this.parseTimeFormat(timeFormat);\r\n    }\r\n    const dateTimeFormat = dateFormat + ' ' + timeFormat;\r\n    return dateTime.format(dateTimeFormat);\r\n  }\r\n  /**\r\n   * \r\n   * @param value value\r\n   */\r\n  private transformNumber(value): string {\r\n    if (value === null || value === undefined || value === '') {\r\n      return '';\r\n    }\r\n    const bigNumber = new BigNumber(value);\r\n    // \r\n    if (!BigNumber.isBigNumber(bigNumber)) {\r\n      return value;\r\n    }\r\n    const isNegative = bigNumber.isNegative();\r\n    const format = this.buildNumberFormat();\r\n    const { negativeSign = null, numberDecimalDigits = null } = this.numberFormat;\r\n    if (isNegative) {\r\n      if (negativeSign !== null) {\r\n        format.prefix = negativeSign;\r\n        return bigNumber.absoluteValue().toFormat(numberDecimalDigits, null, format);\r\n      }\r\n    }\r\n    return bigNumber.toFormat(numberDecimalDigits, null, format);\r\n  }\r\n  /**\r\n   * momentformat\r\n   * @param format format\r\n   */\r\n  private parseDateFormat(format: string) {\r\n    return format.replace(/y/g, 'Y').replace(/d/g, 'D');\r\n  }\r\n  /**\r\n   * momentformat\r\n   * @param format format\r\n   */\r\n  private parseTimeFormat(format: string) {\r\n    return format.replace(/M/g, 'm');\r\n  }\r\n  /**\r\n   * bignumber\r\n   */\r\n  private buildNumberFormat() {\r\n    if (this.numberFormat) {\r\n      const { numberDecimalSeparator = null, numberGroupSeparator = null } = this.numberFormat;\r\n      const format: any = {\r\n        groupSize: 3,\r\n      };\r\n      if (numberDecimalSeparator !== null) {\r\n        format.decimalSeparator = numberDecimalSeparator;\r\n      }\r\n      if (numberGroupSeparator !== null) {\r\n        format.groupSeparator = numberGroupSeparator;\r\n      }\r\n      return format;\r\n    }\r\n  }\r\n  private get numberFormat(): NumberFormat {\r\n    return this.userSettings && this.userSettings.numberFormat || null;\r\n  }\r\n}","import { DialogService } from '@farris/ui-dialog';\r\nimport { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { GridComponent } from '@progress/kendo-angular-grid';\r\nimport { FarrisCommonModule } from '@farris/ui-common';\r\nimport {\r\n  KendoGridBindingDirective,\r\n  FarrisTreeTableBindingDirective,\r\n  LookupDataMappingDirective,\r\n  LookupEnableExtendLoadMethodDirective,\r\n  UIStateBindingDirective,\r\n  FarrisDisabledDirective,\r\n  FarrisDynamicColumnFormatDirective,\r\n  FarrisEditEnterDirective,\r\n  FarrisTextareaEditDirective,\r\n  FarrisSortDirective,\r\n  FarrisTreeTableFormatDirective,\r\n  GridColumnAggregateDirective,\r\n  GridSummaryDirective,\r\n  FarrisDatagridUseBindingDataDirective,\r\n  MultiSelectDataMappingDirective,\r\n  FarrisListViewBindingDirective,\r\n  EditableDirective,\r\n  InputEndEditDirective,\r\n  FarrisDataGridEndEditDirective,\r\n  HtmlEditorEndEditDirective,\r\n  KendoGridEndEditDirective,\r\n  FarrisDataGridRemoteSummaryDirective,\r\n  FarrisFilePreviewBindingDirective,\r\n  FarrisSetFocusDirective,\r\n  FarrisDiscussionEditorBindingDirective,\r\n  FarrisDiscussionListBindingDirective,\r\n  FarrisPrimengTreeTableBindingDirective,\r\n  FarrisDynamicRequiredDirective,\r\n  FarrisEditorDirective,\r\n  FarrisQuerySolutionEventBindDirective,\r\n  FarrisDateLocalizationDirective,\r\n  FarrisNumberLocalizationDirective,\r\n  FarrisTimeLocalizationDirective,\r\n  FarrisTextLocalizationDirective,\r\n  FarrisCheckboxModificationDirective,\r\n  FarrisLabelModificationDirective,\r\n  FarrisLookupBindingDirective,\r\n  ListNavComponentRefDirective,\r\n  ListViewComponentRefDirective,\r\n  ListFilterComponentRefDirective,\r\n  ViewChangeComponentRefDirective,\r\n  FilterComponentRefDirective,\r\n  SectionComponentRefDirective,\r\n  HtmlEditorComponentRefDirective,\r\n  InputGroupComponentRefDirective,\r\n  DatepickerComponentRefDirective,\r\n  TimePickerComponentRefDirective,\r\n  NumberSpinnerComponentRefDirective,\r\n  ComboListComponentRefDirective,\r\n  ComboLookupComponentRefDirective,\r\n  LookupGridComponentRefDirective,\r\n  DatagridComponentRefDirective,\r\n  TreetableComponentRefDirective,\r\n  WizardComponentRefDirective,\r\n  DiscussionEditorComponentRefDirective,\r\n  DiscussionListComponentRefDirective,\r\n  NavComponentRefDirective,\r\n  MultiSelectComponentRefDirective,\r\n  ScrollspyComponentRefDirective,\r\n  ComboLookupDataMappingDirective,\r\n  AppointmentCalendarBindingDirective,\r\n  CustomDatagridSizeDirective,\r\n  FarrisFilterBindingDirective,\r\n  FarrisListFilterBindingDirective\r\n} from './directives/index';\r\nimport {\r\n  FarrisKendoGridFormatService, FarrisTreetableFormatService, StringToDatePipe,\r\n  DateFormatPlaceholderPipe, KendoGridFilterDirective, FormatTotalPipe\r\n} from './format/index';\r\nimport { ImageIdToUrlPipe, FormatPrimeNgTreeTableCellData, Localization } from './pipes/index';\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    FarrisCommonModule.forRoot()\r\n  ],\r\n  declarations: [\r\n    KendoGridBindingDirective,\r\n    FarrisTreeTableBindingDirective,\r\n    LookupDataMappingDirective,\r\n    LookupEnableExtendLoadMethodDirective,\r\n    UIStateBindingDirective,\r\n    FarrisDisabledDirective,\r\n    FarrisSortDirective,\r\n    FarrisDynamicColumnFormatDirective,\r\n    FarrisEditEnterDirective,\r\n    FarrisTextareaEditDirective,\r\n    FarrisTreeTableFormatDirective,\r\n    StringToDatePipe,\r\n    GridColumnAggregateDirective,\r\n    GridSummaryDirective,\r\n    DateFormatPlaceholderPipe,\r\n    ImageIdToUrlPipe,\r\n    FormatPrimeNgTreeTableCellData,\r\n    FarrisDatagridUseBindingDataDirective,\r\n    MultiSelectDataMappingDirective,\r\n    FarrisListViewBindingDirective,\r\n    EditableDirective,\r\n    KendoGridFilterDirective,\r\n    FormatTotalPipe,\r\n    InputEndEditDirective,\r\n    FarrisDataGridEndEditDirective,\r\n    HtmlEditorEndEditDirective,\r\n    KendoGridEndEditDirective,\r\n    FarrisDataGridRemoteSummaryDirective,\r\n    FarrisFilePreviewBindingDirective,\r\n    FarrisSetFocusDirective,\r\n    FarrisDiscussionEditorBindingDirective,\r\n    FarrisDiscussionListBindingDirective,\r\n    FarrisPrimengTreeTableBindingDirective,\r\n    FarrisDynamicRequiredDirective,\r\n    FarrisEditorDirective,\r\n    FarrisQuerySolutionEventBindDirective,\r\n    FarrisDateLocalizationDirective,\r\n    FarrisNumberLocalizationDirective,\r\n    FarrisTimeLocalizationDirective,\r\n    FarrisTextLocalizationDirective,\r\n    Localization,\r\n    FarrisCheckboxModificationDirective,\r\n    FarrisLabelModificationDirective,\r\n    FarrisLookupBindingDirective,\r\n    ListNavComponentRefDirective,\r\n    ListViewComponentRefDirective,\r\n    ListFilterComponentRefDirective,\r\n    ViewChangeComponentRefDirective,\r\n    FilterComponentRefDirective,\r\n    SectionComponentRefDirective,\r\n    HtmlEditorComponentRefDirective,\r\n    InputGroupComponentRefDirective,\r\n    DatepickerComponentRefDirective,\r\n    TimePickerComponentRefDirective,\r\n    NumberSpinnerComponentRefDirective,\r\n    ComboListComponentRefDirective,\r\n    ComboLookupComponentRefDirective,\r\n    LookupGridComponentRefDirective,\r\n    DatagridComponentRefDirective,\r\n    TreetableComponentRefDirective,\r\n    WizardComponentRefDirective,\r\n    DiscussionEditorComponentRefDirective,\r\n    DiscussionListComponentRefDirective,\r\n    NavComponentRefDirective,\r\n    MultiSelectComponentRefDirective,\r\n    ScrollspyComponentRefDirective,\r\n    ComboLookupDataMappingDirective,\r\n    AppointmentCalendarBindingDirective,\r\n    CustomDatagridSizeDirective,\r\n    FarrisFilterBindingDirective,\r\n    FarrisListFilterBindingDirective\r\n  ],\r\n  providers: [\r\n    DialogService, GridComponent, FarrisKendoGridFormatService, FarrisTreetableFormatService],\r\n  exports: [\r\n    KendoGridBindingDirective,\r\n    FarrisTreeTableBindingDirective,\r\n    LookupDataMappingDirective,\r\n    LookupEnableExtendLoadMethodDirective,\r\n    UIStateBindingDirective,\r\n    FarrisDisabledDirective,\r\n    FarrisSortDirective,\r\n    FarrisDynamicColumnFormatDirective,\r\n    FarrisEditEnterDirective,\r\n    FarrisTextareaEditDirective,\r\n    FarrisTreeTableFormatDirective,\r\n    StringToDatePipe,\r\n    GridColumnAggregateDirective,\r\n    DateFormatPlaceholderPipe,\r\n    ImageIdToUrlPipe,\r\n    FormatPrimeNgTreeTableCellData,\r\n    FarrisDatagridUseBindingDataDirective,\r\n    MultiSelectDataMappingDirective,\r\n    FarrisListViewBindingDirective,\r\n    EditableDirective,\r\n    KendoGridFilterDirective,\r\n    FormatTotalPipe,\r\n    InputEndEditDirective,\r\n    FarrisDataGridEndEditDirective,\r\n    HtmlEditorEndEditDirective,\r\n    KendoGridEndEditDirective,\r\n    FarrisDataGridRemoteSummaryDirective,\r\n    FarrisFilePreviewBindingDirective,\r\n    FarrisSetFocusDirective,\r\n    FarrisDiscussionEditorBindingDirective,\r\n    FarrisDiscussionListBindingDirective,\r\n    FarrisPrimengTreeTableBindingDirective,\r\n    FarrisDynamicRequiredDirective,\r\n    FarrisEditorDirective,\r\n    FarrisQuerySolutionEventBindDirective,\r\n    FarrisDateLocalizationDirective,\r\n    FarrisNumberLocalizationDirective,\r\n    FarrisTimeLocalizationDirective,\r\n    FarrisTextLocalizationDirective,\r\n    Localization,\r\n    FarrisCheckboxModificationDirective,\r\n    FarrisLabelModificationDirective,\r\n    FarrisLookupBindingDirective,\r\n    ListNavComponentRefDirective,\r\n    ListViewComponentRefDirective,\r\n    ListFilterComponentRefDirective,\r\n    ViewChangeComponentRefDirective,\r\n    FilterComponentRefDirective,\r\n    SectionComponentRefDirective,\r\n    HtmlEditorComponentRefDirective,\r\n    InputGroupComponentRefDirective,\r\n    DatepickerComponentRefDirective,\r\n    TimePickerComponentRefDirective,\r\n    NumberSpinnerComponentRefDirective,\r\n    ComboListComponentRefDirective,\r\n    ComboLookupComponentRefDirective,\r\n    LookupGridComponentRefDirective,\r\n    DatagridComponentRefDirective,\r\n    TreetableComponentRefDirective,\r\n    WizardComponentRefDirective,\r\n    DiscussionEditorComponentRefDirective,\r\n    DiscussionListComponentRefDirective,\r\n    NavComponentRefDirective,\r\n    MultiSelectComponentRefDirective,\r\n    ScrollspyComponentRefDirective,\r\n    ComboLookupDataMappingDirective,\r\n    AppointmentCalendarBindingDirective,\r\n    CustomDatagridSizeDirective,\r\n    FarrisFilterBindingDirective,\r\n    FarrisListFilterBindingDirective\r\n  ]\r\n})\r\nclass KendoBindingModule {\r\n}\r\n\r\nexport { KendoBindingModule };\r\n"]}
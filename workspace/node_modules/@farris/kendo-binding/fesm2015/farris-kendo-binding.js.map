{"version":3,"file":"farris-kendo-binding.js.map","sources":["ng://@farris/kendo-binding/lib/converters/array_converter.ts","ng://@farris/kendo-binding/lib/converters/date_converter.ts","ng://@farris/kendo-binding/lib/converters/multi_lang_converter.ts","ng://@farris/kendo-binding/lib/converters/filter_conditions_converter.ts","ng://@farris/kendo-binding/lib/format/datatable-kendogrid-format.ts","ng://@farris/kendo-binding/lib/format/treetable-format.ts","ng://@farris/kendo-binding/lib/format/string-to-date.pipe.ts","ng://@farris/kendo-binding/lib/format/kendogrid-filter.ts","ng://@farris/kendo-binding/lib/format/dateformat-placeholder.pipe.ts","ng://@farris/kendo-binding/lib/format/kendogrid-group.pipe.ts","ng://@farris/kendo-binding/lib/directives/grid-summary.directive.ts","ng://@farris/kendo-binding/lib/util/multi_select_grid_utility.ts","ng://@farris/kendo-binding/lib/entity/selected_row_context.ts","ng://@farris/kendo-binding/lib/directives/kendo_grid_binding.directive.ts","ng://@farris/kendo-binding/lib/directives/tree_table_node_builder/path_tree_node_builder.ts","ng://@farris/kendo-binding/lib/directives/tree_table_node_builder/parent_tree_node_builder.ts","ng://@farris/kendo-binding/lib/directives/tree_table_node_builder/tree_node_builder_factory.ts","ng://@farris/kendo-binding/lib/directives/farris_tree_table_binding.directive.ts","ng://@farris/kendo-binding/lib/directives/data-mapping.ts","ng://@farris/kendo-binding/lib/directives/lookup-data-mapping.directive.ts","ng://@farris/kendo-binding/lib/directives/lookup-enable-extend-load-method.directive.ts","ng://@farris/kendo-binding/lib/directives/uistate-binding.directive.ts","ng://@farris/kendo-binding/lib/directives/farris-kendogrid-disabled.directive.ts","ng://@farris/kendo-binding/lib/directives/farris-sort.directive.ts","ng://@farris/kendo-binding/lib/directives/farris-datagrid/farris-datagrid-use-binding-data.directive.ts","ng://@farris/kendo-binding/lib/directives/multi-select-data-mapping.directive.ts","ng://@farris/kendo-binding/lib/directives/list-view/farris_listview_binding.directive.ts","ng://@farris/kendo-binding/lib/directives/farris-datagrid/editable.directive.ts","ng://@farris/kendo-binding/lib/directives/end-edit/abstract_end_edit.ts","ng://@farris/kendo-binding/lib/directives/end-edit/input_end_edit.directive.ts","ng://@farris/kendo-binding/lib/directives/end-edit/farris_data_grid_end_edit.directive.ts","ng://@farris/kendo-binding/lib/directives/end-edit/html_editor_end_edit.directive.ts","ng://@farris/kendo-binding/lib/directives/end-edit/kendo_grid_end_edit.directive.ts","ng://@farris/kendo-binding/lib/directives/farris-datagrid/remote-summary.directive.ts","ng://@farris/kendo-binding/lib/directives/farris-set-focus.directive.ts","ng://@farris/kendo-binding/lib/directives/file-preview/farris-file-preview-binding.directive.ts","ng://@farris/kendo-binding/lib/directives/discussion-group/farris_discussion_editor_binding.directive.ts","ng://@farris/kendo-binding/lib/directives/discussion-group/farris_discussion_list_binding.directive.ts","ng://@farris/kendo-binding/lib/directives/primeng-tree-grid/FarrisPrimengTreeTableBindingDirective.ts","ng://@farris/kendo-binding/lib/directives/dynamic_validate/farris_dynamic_validate.directive.ts","ng://@farris/kendo-binding/lib/directives/farris_editor.directive.ts","ng://@farris/kendo-binding/lib/directives/farris_querysolution_event_bind.directive.ts","ng://@farris/kendo-binding/lib/directives/localization/farris_date_localization.directive.ts","ng://@farris/kendo-binding/lib/directives/localization/farris_number_localization.directive.ts","ng://@farris/kendo-binding/lib/directives/localization/farris_time_localization.directive.ts","ng://@farris/kendo-binding/lib/directives/localization/farris_text_localization.directive.ts","ng://@farris/kendo-binding/lib/directives/farris_checkbox_modification.directive.ts","ng://@farris/kendo-binding/lib/directives/farris_label_modification.directive.ts","ng://@farris/kendo-binding/lib/directives/farris_lookup_binding.directive.ts","ng://@farris/kendo-binding/lib/directives/component-ref/component-ref.ts","ng://@farris/kendo-binding/lib/directives/component-ref/list-nav-component-ref.directive.ts","ng://@farris/kendo-binding/lib/directives/component-ref/list-view-component-ref.directive.ts","ng://@farris/kendo-binding/lib/directives/component-ref/list-filter-component-ref.directive.ts","ng://@farris/kendo-binding/lib/directives/component-ref/filter-component-ref.directive.ts","ng://@farris/kendo-binding/lib/directives/component-ref/view-change-component-ref.directive.ts","ng://@farris/kendo-binding/lib/directives/component-ref/html-editor-component-ref.directive.ts","ng://@farris/kendo-binding/lib/directives/component-ref/section-component-ref.directive.ts","ng://@farris/kendo-binding/lib/directives/component-ref/input-group-component-ref.directive.ts","ng://@farris/kendo-binding/lib/directives/component-ref/datepicker-component-ref.directive.ts","ng://@farris/kendo-binding/lib/directives/component-ref/time-picker-component-ref.directive.ts","ng://@farris/kendo-binding/lib/directives/component-ref/number-spinner-component-ref.directive.ts","ng://@farris/kendo-binding/lib/directives/component-ref/combo-list-component-ref.directive.ts","ng://@farris/kendo-binding/lib/directives/component-ref/combo-lookup-component-ref.directive.ts","ng://@farris/kendo-binding/lib/directives/component-ref/lookup-grid-component-ref.directive.ts","ng://@farris/kendo-binding/lib/directives/component-ref/datagrid-component-ref.directive.ts","ng://@farris/kendo-binding/lib/directives/component-ref/treetable-component-ref.directive.ts","ng://@farris/kendo-binding/lib/directives/component-ref/wizard-component-ref.directive.ts","ng://@farris/kendo-binding/lib/directives/component-ref/discussion-editor-component-ref.directive.ts","ng://@farris/kendo-binding/lib/directives/component-ref/discussion-list-component-ref.directive.ts","ng://@farris/kendo-binding/lib/directives/component-ref/nav-component-ref.directive.ts","ng://@farris/kendo-binding/lib/directives/component-ref/multi-select-component-ref.directive.ts","ng://@farris/kendo-binding/lib/directives/component-ref/scrollspy-component-ref.directive.ts","ng://@farris/kendo-binding/lib/directives/combo-lookup-data-mapping.directive.ts","ng://@farris/kendo-binding/lib/directives/appointment-calendar/types.ts","ng://@farris/kendo-binding/lib/directives/appointment-calendar/appointment-calendar-binding.directive.ts","ng://@farris/kendo-binding/lib/directives/farris-datagrid/custom-size.directive.ts","ng://@farris/kendo-binding/lib/directives/farris-filter/farris_filter_binding.directive.ts","ng://@farris/kendo-binding/lib/directives/farris-list-filter/farris_list_filter_binding.directive.ts","ng://@farris/kendo-binding/lib/pipes/image-id-to-url.pipe.ts","ng://@farris/kendo-binding/lib/pipes/formatPrimeNgTreeTableCellData.ts","ng://@farris/kendo-binding/lib/pipes/localization.pipe.ts","ng://@farris/kendo-binding/lib/kendo_binding_module.ts","ng://@farris/kendo-binding/farris-kendo-binding.ts"],"sourcesContent":["import { ControlValueConverter } from '@farris/devkit';\r\n\r\nclass ArrayConverter implements ControlValueConverter {\r\n\r\n  constructor(private separator: string = ',') {\r\n  }\r\n\r\n  convertFrom(value: string): string[] {\r\n    return value.split(this.separator);\r\n  }\r\n\r\n  convertTo(value: string[]): string {\r\n    return value.join(this.separator);\r\n  }\r\n}\r\n\r\nexport { ArrayConverter };\r\n","/*\r\n * @Author: Witt\r\n * @Date: 2018-10-29 10:26:58\r\n * @Last Modified by: Witt\r\n * @Last Modified time: 2018-10-29 15:49:12\r\n */\r\nimport { ControlValueConverter, DateUtil } from '@farris/devkit';\r\n\r\n/**\r\n * æ¥æè½¬æ¢å¨\r\n */\r\nclass DateConverter implements ControlValueConverter {\r\n\r\n  /**\r\n   * æé å½æ°\r\n   * @param format æ¥ææ ¼å¼\r\n   */\r\n  constructor(private format: string) {\r\n  }\r\n\r\n  /**\r\n   * å­ç¬¦ä¸²=> æ¥æ\r\n   * @param value å¾è½¬æ¢çå¼\r\n   */\r\n  convertFrom(value: string): Date {\r\n    if (DateUtil.isEmptyDateString(value) === true) {\r\n      return null;\r\n    }\r\n\r\n    return DateUtil.parse(value);\r\n  }\r\n\r\n  /**\r\n   * æ¥æ=>å­ç¬¦ä¸²\r\n   * @param value\r\n   */\r\n  convertTo(value: Date): string | any {\r\n    if (!value) {\r\n      return null;\r\n    }\r\n    // å¦ævalueä¸æ¯æ¥æç±»åï¼åä¸åå¤çï¼è¿ååå§value\r\n    if (Object.prototype.toString.call(value) !== '[object Date]') {\r\n      return value;\r\n    }\r\n    // å¹´\r\n    let year = value.getFullYear().toString();\r\n    year = year.length < 4 ? '0'.repeat(4 - year.length) + year : year;\r\n    // æ\r\n    let month = (value.getMonth() + 1).toString();\r\n    month = month.length === 1 ? ('0' + month) : month;\r\n\r\n    // æ¥\r\n    let day = value.getDate().toString();\r\n    day = day.length === 1 ? ('0' + day) : day;\r\n\r\n    // æ¶åç§\r\n    let hours = value.getHours().toString();\r\n    hours = hours.length === 1 ? ('0' + hours) : hours;\r\n\r\n    let minutes = value.getMinutes().toString();\r\n    minutes = minutes.length === 1 ? ('0' + minutes) : minutes;\r\n\r\n    let seconds = value.getSeconds().toString();\r\n    seconds = seconds.length === 1 ? ('0' + seconds) : seconds;\r\n    return `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;\r\n  }\r\n}\r\nexport { DateConverter };\r\n","/*\r\n * @Author: Witt\r\n * @Date: 2018-10-29 10:26:58\r\n * @Last Modified by: Witt\r\n * @Last Modified time: 2018-10-29 15:49:12\r\n */\r\nimport { ControlValueConverter } from '@farris/devkit';\r\n\r\n/**\r\n * å¤è¯­è¨è½¬æ¢å¨\r\n */\r\nclass MultiLangConverter implements ControlValueConverter {\r\n\r\n  /**\r\n   * æé å½æ°\r\n   */\r\n  constructor() {\r\n  }\r\n\r\n  /**\r\n   * å°æ°æ®æºä¸­çåå§å¼=>å¤è¯­æ§ä»¶è¯å«çå¯¹è±¡å¼\r\n   */\r\n  public convertFrom(value: string): any {\r\n    const multiLangControlValue = Object.assign({}, value);\r\n    return multiLangControlValue;\r\n  }\r\n\r\n  /**\r\n   * å¤è¯­æ§ä»¶è¯å«çå¯¹è±¡å¼=>å°æ°æ®æºä¸­çåå§å¼\r\n   */\r\n  public convertTo(multiLangControlValue: any): any {\r\n    const value = multiLangControlValue;\r\n    return value;\r\n  }\r\n\r\n}\r\nexport { MultiLangConverter };\r\n","import { ControlValueConverter } from '@farris/devkit';\r\n\r\nclass FilterConditionsConverter implements ControlValueConverter {\r\n\r\n  constructor() {\r\n  }\r\n\r\n  convertFrom(conditionsString: string): any[] {\r\n    if (!conditionsString) {\r\n      return [];\r\n    }\r\n    return JSON.parse(conditionsString);\r\n  }\r\n\r\n  convertTo(conditions: any[]): string {\r\n    return JSON.stringify(conditions);\r\n  }\r\n}\r\n\r\nexport { FilterConditionsConverter };\r\n","import { Injectable } from '@angular/core';\r\nimport { DateTimeHelperService } from '@farris/ui-common/date';\r\nimport { NumberHelperService } from '@farris/ui-common/number';\r\nimport { DateUtil } from '@farris/devkit';\r\n\r\n@Injectable()\r\nclass FarrisKendoGridFormatService {\r\n    constructor(private dateService: DateTimeHelperService, private numberService: NumberHelperService) {\r\n    }\r\n\r\n    /**\r\n     * åæ ¼å¼å æ¹æ³\r\n     * @param dataItem  è¡æ°æ®\r\n     * @param column åå¯¹è±¡\r\n     */\r\n    getColumnFormat(dataItem: any, column: any) {\r\n        const value = this.getValue(dataItem, column['dataField']);\r\n        // æ²¡æè®¾ç½®è¡ç¼è¾å¨\r\n        const type = column['dataType'];\r\n        if (type === 'enum') {\r\n            return this.getEnumText(value, column);\r\n        } else if (type === 'boolean') {\r\n            return value ? 'æ¯' : 'å¦';\r\n        } else if (type === 'date') {\r\n            return this.getFormatDate(value, column);\r\n        } else if (type === 'number') {\r\n            return this.getFormatNumber(value, column);\r\n        } else {\r\n            // æ ¼å¼åå¤è¡ææ¬  åstring\r\n            return this.getMultiText(value, column);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * æ ¹æ®idè·åvalue\r\n     * @param dataItem  è¡æ°æ®\r\n     * @param field id,ä¹å¯è½æ¯name.Nameè¿ç§å½¢å¼(å³èå¯¹è±¡idæèudt)\r\n     */\r\n    private getValue(dataItem: any, field: string) {\r\n        const index = field.indexOf('.');\r\n        if (index < 0) {\r\n            return dataItem[field];\r\n        }\r\n        const fields = field.split('.');\r\n        // fieldå­ç¬¦ä¸²ç»å\r\n        const a = fields.reduce((result: any, next: any) => {\r\n            return result[next];\r\n        }, dataItem);\r\n        return a;\r\n    }\r\n\r\n    /**\r\n     * æä¸¾å¼æ ¼å¼å\r\n     */\r\n    private getEnumText(value: any, column: any) {\r\n        const enumData = (column as any).enumData;\r\n        if (!enumData) {\r\n            return;\r\n        }\r\n        let tempColumnText: any;\r\n        enumData.forEach((ele: any) => {\r\n            if (ele.value === value) {\r\n                tempColumnText = ele.name;\r\n            }\r\n        });\r\n        return tempColumnText;\r\n    }\r\n\r\n    /**\r\n     * æ¥ææ ¼å¼å\r\n     * @param value  ååæ ¼å¼\r\n     * @param column åå¯¹è±¡\r\n     */\r\n    public getFormatDate(value: string, column: any): string {\r\n\r\n        if (DateUtil.isEmptyDateString(value) === true) {\r\n          return '';\r\n        }\r\n\r\n        const dateFormat = (column as any).format;\r\n        if (!dateFormat) {\r\n            return value;\r\n        }\r\n        return this.dateService.formatTo(value, dateFormat);\r\n    }\r\n\r\n    /**\r\n     * æ°å­æ ¼å¼å\r\n     * @param value  ååæ ¼å¼\r\n     * @param column åå¯¹è±¡\r\n     * @todo æ°å­æ ¼å¼åè¿ä¸å®å  è¿ä¸ªåªæ¯éé¢å½¢å¼çæ ¼å¼å;   åå§åvalue===nullæ¶,åºè¯¥æ¾ç¤ºä¸º'' è¿ä¸ªè¿æ²¡æ\r\n     */\r\n    private getFormatNumber(value: any, column: any) {\r\n        let precision;\r\n        if (column && column.format) {\r\n            precision = parseInt(column.format.substr(1), 10);\r\n        } else if (column && column.editor) {\r\n            precision = column.editor.precision;\r\n        }\r\n        if (isNaN(precision)) {\r\n            precision = 2;\r\n        }\r\n        if (!value && value !== 0) {\r\n            return '';\r\n        }\r\n\r\n        const opts = {\r\n            prefix: column.prefix ? column.prefix : '',\r\n            suffix: column.suffix ? column.suffix : '',\r\n            precision: precision,\r\n            thousand: ',',\r\n            stripZeros: false,\r\n        };\r\n        return this.numberService.formatMoney(value, opts);\r\n    }\r\n\r\n    /**\r\n     * å¤è¡ææ¬æ ¼å¼å shift+enteræ¢è¡  å¤±å»ç¦ç¹ä¿çåæ ¼å¼\r\n     * @param value  ååæ ¼å¼\r\n     * @param column åå¯¹è±¡\r\n     */\r\n    private getMultiText(value: any, column: any) {\r\n        let strValue = value;\r\n        if (strValue !== '' && !strValue) {\r\n            strValue = '';\r\n        }\r\n        if (typeof strValue !== 'string') {\r\n            const valueType = typeof strValue;\r\n            throw new Error(`${valueType}ç±»åå¼ä¸åæ³ï¼æ æ³è¿è¡æ ¼å¼å`);\r\n        }\r\n        // é²æ­¢xss\r\n        strValue = strValue.replace(/&/g, '&amp;')\r\n            .replace(/</g, '&lt;')\r\n            .replace(/>/g, '&gt;')\r\n            .replace(/\\\"/g, '&quot;')\r\n            .replace(/\\'/g, '&#39;')\r\n            .replace(/\\//g, '&#x2F;');\r\n        // å¦ææ¯å¤è¡ææ¬æ¡  ä¿çæ ¼å¼\r\n        if (column.editor && column.editor.type === 'MultiTextBox') {\r\n            const INDEX = strValue.indexOf('\\n');\r\n            if (INDEX > -1) {\r\n                return strValue.replace(/\\n/g, '<br>');\r\n            }\r\n            return strValue;\r\n        }\r\n        // è¥ä¸ºstring\r\n        return strValue;\r\n    }\r\n}\r\nexport { FarrisKendoGridFormatService };\r\n","import { Injectable } from '@angular/core';\r\nimport { TreeTableComponent } from '@farris/ui-treetable';\r\n@Injectable()\r\nexport class FarrisTreetableFormatService {\r\n    constructor() {\r\n    }\r\n    setFormat(treeTable: TreeTableComponent) {\r\n        const columns = treeTable.columns;\r\n        columns.forEach((column: any) => {\r\n            const dataType = column.dataType;\r\n            if (!column.formatter) {\r\n                if (dataType === 'date') {\r\n                    column.formatter = {\r\n                        type: 'datetime',\r\n                        options: {\r\n                            format: column.format\r\n                        }\r\n                    };\r\n                } else if (dataType === 'number') {\r\n                    column.formatter = {\r\n                        type: 'number',\r\n                        options: {\r\n                            prefix: column.prefix ? column.prefix : '',\r\n                            suffix: column.suffix ? column.suffix : '',\r\n                            precision: column.precision,\r\n                            thousand: ',',\r\n                            stripZeros: false,\r\n                        }\r\n                    };\r\n                } else if (dataType === 'enum') {\r\n                    column.formatter = {\r\n                        type: 'enum',\r\n                        options: {\r\n                            data: column.enumData,\r\n                            valueField: 'value',\r\n                            textField: 'name'\r\n                        }\r\n                    };\r\n                } else if (dataType === 'boolean') {\r\n                    column.formatter = {\r\n                        type: 'enum',\r\n                        options: {\r\n                            data: [{ name: 'æ¯', value: true }, { name: 'å¦', value: false }],\r\n                            valueField: 'value',\r\n                            textField: 'name'\r\n                        }\r\n                    };\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n}\r\n","import { Pipe, PipeTransform } from '@angular/core';\r\nimport { DateUtil } from '@farris/devkit';\r\n\r\n@Pipe({ name: 'parseStrToDate' })\r\nexport class StringToDatePipe implements PipeTransform {\r\n    transform(value: string, exponent: string): any {\r\n        if (DateUtil.isEmptyDateString(value) === true) {\r\n          return null;\r\n        }\r\n\r\n        if (value.includes('å¹´')) {\r\n            const strDate = value.replace('å¹´', '-').replace('æ', '-').replace('æ¥', '');\r\n            return new Date(strDate);\r\n        }\r\n        return new Date(value);\r\n    }\r\n}\r\n","import { Directive, Input, OnInit, HostListener } from '@angular/core';\r\nimport { CompositeFilterDescriptor } from '@progress/kendo-data-query';\r\nimport { DropDownListComponent } from '@progress/kendo-angular-dropdowns';\r\nimport { FilterService, BaseFilterCellComponent } from '@progress/kendo-angular-grid';\r\n@Directive({\r\n    selector: '[kendogridFilter]'\r\n})\r\nexport class KendoGridFilterDirective extends BaseFilterCellComponent implements OnInit {\r\n\r\n    @Input() filter: CompositeFilterDescriptor;\r\n    @Input() column: any;\r\n\r\n    public get selectedValue(): any {\r\n        const filter = this.filterByField(this.column.dataField);\r\n        return filter ? filter.value : null;\r\n    }\r\n    public get defaultItem(): any {\r\n        return {\r\n            value: null,\r\n            name: 'å¨é¨'\r\n        };\r\n    }\r\n\r\n    constructor(\r\n        private dropdownList: DropDownListComponent,\r\n        public filterService: FilterService,\r\n    ) {\r\n        super(filterService);\r\n    }\r\n\r\n    ngOnInit() {\r\n        this.dropdownList.valueField = 'value';\r\n        this.dropdownList.textField = 'name';\r\n        this.dropdownList.valuePrimitive = true;\r\n        this.dropdownList.defaultItem = this.defaultItem;\r\n        this.dropdownList.value = this.selectedValue;\r\n        if (this.column.dataType === 'enum') {\r\n            this.dropdownList.data = this.column.enumData;\r\n        } else if (this.column.dataType === 'boolean') {\r\n            this.dropdownList.data = [{ value: true, name: 'æ¯' }, { value: false, name: 'å¦' }];\r\n        }\r\n    }\r\n\r\n\r\n    @HostListener('valueChange', ['$event'])\r\n    onChange(value: any) {\r\n        this.applyFilter(\r\n            value === null ?\r\n                this.removeFilter(this.column.dataField) :\r\n                this.updateFilter({\r\n                    field: this.column.dataField,\r\n                    operator: 'eq',\r\n                    value: value\r\n                })\r\n        );\r\n    }\r\n\r\n\r\n    /*\r\n   * è·å ååæ ¼å¼  ä¸»ä»è¡¨æ¯æ\r\n   * @param dataItem è¡æ°æ®\r\n   * @param field å­æ®µ\r\n   */\r\n    getValue(dataItem: any, field: string) {\r\n        const index = field.indexOf('.');\r\n        if (index < 0) {\r\n            return dataItem[field];\r\n        }\r\n        const fields = field.split('.');\r\n        // fieldå­ç¬¦ä¸²ç»å\r\n        return fields.reduce((result: any, next: any) => {\r\n            return result[next];\r\n        }, dataItem);\r\n    }\r\n\r\n}\r\n","import { Pipe, PipeTransform } from '@angular/core';\r\nimport { ViewModel, DateUtil } from '@farris/devkit';\r\n@Pipe({ name: 'dateFormatPlaceholder' })\r\nexport class DateFormatPlaceholderPipe implements PipeTransform {\r\n    constructor(private viewModel: ViewModel) {\r\n\r\n    }\r\n    transform(format: string, controlName: string): any {\r\n        if (!this.viewModel.form || !this.viewModel.form.get(controlName)) {\r\n            return {\r\n                year: 'å¹´',\r\n                month: 'æ',\r\n                day: 'æ¥'\r\n            };\r\n        }\r\n        const value = this.viewModel.form.get(controlName).value;\r\n        let dateStr = value;\r\n        if (dateStr) {\r\n            dateStr = value.toISOString();\r\n        }\r\n        if ((DateUtil.isEmptyDateString(dateStr) === true) && format === 'yyyyå¹´MMæddæ¥') {\r\n            return {\r\n                year: ' ',\r\n                month: ' ',\r\n                day: ' '\r\n            };\r\n        }\r\n        return {\r\n            year: 'å¹´',\r\n            month: 'æ',\r\n            day: 'æ¥'\r\n        };\r\n    }\r\n}\r\n","import { Pipe, PipeTransform } from '@angular/core';\r\n@Pipe({ name: 'formatTotal' })\r\nexport class FormatTotalPipe implements PipeTransform {\r\n    transform(value: any, exponent: any): any {\r\n        // å¤æ­å¼æ¯å¦åæ³\r\n        if (!value && value !== 0) {\r\n            return '';\r\n        }\r\n        if (exponent.dataType === 'number') {\r\n            // ä¿çå°æ°ç¹åå ä½\r\n            const dataFormat = exponent.format;\r\n            return value.toFixed(Number(dataFormat.substring(1)));\r\n        }\r\n        return value;\r\n    }\r\n}\r\n","import { Directive, ContentChildren, QueryList, Input, NgZone } from '@angular/core';\r\nimport { BindingData, BindingList } from '@farris/devkit';\r\nimport { ColumnComponent } from '@progress/kendo-angular-grid';\r\n\r\n@Directive({\r\n  selector: '[aggregate]',\r\n})\r\nexport class GridColumnAggregateDirective {\r\n\r\n  @Input() aggregate: string | boolean;\r\n\r\n  public get field(): string {\r\n    return this.column.field;\r\n  }\r\n\r\n  private get aggrType(): string {\r\n    let type = 'none';\r\n    if (typeof (this.aggregate) === 'boolean') {\r\n      // é»è®¤ä¸ºsumï¼å¦æä½¿ç¨æä»¤æ¶ä¼ å¥çinputä¸ºå¸å°ç±»åï¼ä½¿ç¨sumã\r\n      if (this.aggregate) {\r\n        type = 'sum';\r\n      }\r\n    } else if (typeof (this.aggregate) === 'string') {\r\n      type = this.aggregate;\r\n    }\r\n    return type;\r\n  }\r\n\r\n  constructor(private column: ColumnComponent, private ngZone: NgZone) {\r\n  }\r\n\r\n  public recalculateSummary(bindingList: BindingList) {\r\n    let summary = null;\r\n    if (this.aggrType === 'sum') {\r\n      const plainData = bindingList.toJSON().map(item => {\r\n        // èèå¸®å©åudtçæåµï¼fieldæ¯a.bçæ ¼å¼ã\r\n        return this.field.split('.').reduce((prevPath, currPath) => {\r\n          return prevPath[currPath];\r\n        }, item);\r\n      });\r\n      if (plainData && plainData.length) {\r\n        summary = plainData.reduce((prev, curr) => {\r\n          return prev + curr;\r\n        });\r\n      }\r\n    } else if (this.aggrType === 'count') {\r\n      // è®¡æ°ï¼å¦æå¯ç¨åé¡µï¼åªè®¡ç®å½åé¡µï¼å æ­¤ä½¿ç¨lengthèétotalã\r\n      summary = bindingList.length;\r\n    }\r\n    this.updateFooter(summary);\r\n  }\r\n\r\n  public updateFooter(content: any) {\r\n    if (this.aggregate) {\r\n        // å­å¨æ§è½é®é¢ï¼å»æsetTimeoutã\r\n        // åè¡¨çåè¶å¤ï¼æ­¤å¤é®é¢è¶ä¸¥éï¼éè¦æ­£åè§£å³ä»¥ä¸éè¯¯ã\r\n        // todo: settimeoutæ¯ä¸ºäºè§£å³æ°æ®ååæ¶angularæ¥éï¼å¦ææ´æ°é¡µèçé»è¾ä¸å¨gridbindingåèµ·ï¼æ¯å¦è¿å­å¨é®é¢ï¼\r\n        // setTimeout(() => {\r\n          this.column['summary'] = content;\r\n        // });\r\n    }\r\n  }\r\n}\r\n\r\n\r\n@Directive({\r\n  selector: '[farrisSummary]'\r\n})\r\nexport class GridSummaryDirective/* implements OnInit, AfterViewInit*/ {\r\n  @Input('farrisSummary') summary: string;\r\n  constructor(private bindingData: BindingData) { }\r\n\r\n}\r\n","import { ElementRef } from '@angular/core';\r\nimport { SelectedRowContext } from '../entity/index';\r\nimport { GridComponent } from '@progress/kendo-angular-grid';\r\n\r\n/**\r\n * å¤éåè¡¨å·¥å·ç±»\r\n */\r\nexport class MultiSelectGridUtility {\r\n  static CURRENT_ROW_STYLE_NAME = 'f-state-selected';\r\n  static CHECKBOXED_ROW_STYLE_NAME = 'f-state-checked';\r\n\r\n  /**\r\n   * æ¸²æåæ¢è¡\r\n   */\r\n  public static renderClickChangedRow(gridComponent: GridComponent, selectedRowContext: SelectedRowContext) {\r\n    if (!gridComponent) {\r\n      return;\r\n    }\r\n\r\n    const currentRowIndex = selectedRowContext.currentRowIndex;\r\n    // æ¸²æå½åè¡\r\n    this.addRowSelectedStyle(gridComponent, currentRowIndex);\r\n\r\n    // æ¸²æä¸ä¸è¡\r\n    const lastRowIndex = selectedRowContext.lastRowIndex;\r\n    if (!this.checIfIsSameRelativeIndex(gridComponent, currentRowIndex, lastRowIndex)) {\r\n      this.removeRowSelectedStyle(gridComponent, lastRowIndex);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * æ£æ¥å½åè¡ç´¢å¼å¼åä¸ä¸ä¸ªéä¸­è¡ç´¢å¼å¼çç¸å¯¹å½åé¡µé¢çç´¢å¼å¼æ¯å¦ç¸å\r\n   */\r\n  private static checIfIsSameRelativeIndex(gridComponent: GridComponent, currentRowIndex: number, lastRowIndex: number): boolean {\r\n    let isSameRelativeIndex = false;\r\n    if (currentRowIndex === lastRowIndex) {\r\n      isSameRelativeIndex = true;\r\n      return isSameRelativeIndex;\r\n    }\r\n\r\n    if ((Math.abs(currentRowIndex - lastRowIndex)) % (gridComponent.pageSize) === 0) {\r\n      isSameRelativeIndex = true;\r\n      return isSameRelativeIndex;\r\n    }\r\n\r\n    return isSameRelativeIndex;\r\n  }\r\n\r\n  /**\r\n   * æ£æµæ¯å¦å¯ç¨åé¡µåè½\r\n   */\r\n  public static checkIfEnablePaging(gridComponent: GridComponent): boolean {\r\n    let isPageable = false; // é»è®¤æªå¯ç¨åé¡µ\r\n    if (!gridComponent) {\r\n      return isPageable;\r\n    }\r\n\r\n    if (typeof gridComponent.pageable === 'boolean') {\r\n      isPageable = gridComponent.pageable;\r\n    } else if (typeof gridComponent.pageable === 'object') {\r\n      isPageable = true;\r\n    }\r\n\r\n    return isPageable;\r\n  }\r\n\r\n  /**\r\n   * æ¸²æcheckboxéæ©\r\n   */\r\n  public static renderSelectedChangeCheckbox(elementRef: ElementRef, $event: any) {\r\n\r\n    const currentRowIndex = $event.index;\r\n\r\n    const trCollection = this.getTrCollection(elementRef);\r\n    if (trCollection == null || trCollection.length <= 0 || trCollection.length < currentRowIndex) {\r\n      return;\r\n    }\r\n\r\n    // æ¸²æcheckedè¡\r\n    const currentTableRowElement = trCollection[currentRowIndex];\r\n    if (!currentTableRowElement) {\r\n      return;\r\n    }\r\n\r\n    if ($event.selected) { // checked\r\n      this.appendAtrributeValue(currentTableRowElement, 'class', this.CHECKBOXED_ROW_STYLE_NAME);\r\n    } else { // unchecked\r\n      this.removeAttributeSpecificValue(currentTableRowElement, 'class', this.CHECKBOXED_ROW_STYLE_NAME);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * æ·»å è¡çâå·²éä¸­æ ·å¼â\r\n   * ææ éæ±ï¼ä¸å¯¹å¤æ´é²\r\n   */\r\n  private static addRowSelectedStyle(gridComponent: GridComponent, rowIndex: number) {\r\n    if (!gridComponent || rowIndex < 0) {\r\n      return;\r\n    }\r\n\r\n    const currentRowElement = this.getRelativeRowInCurrentPage(gridComponent, rowIndex);\r\n    if (!currentRowElement) {\r\n      return;\r\n    }\r\n\r\n    this.appendAtrributeValue(currentRowElement, 'class', this.CURRENT_ROW_STYLE_NAME);\r\n  }\r\n\r\n  /**\r\n   * ç§»é¤è¡çâå·²éä¸­æ ·å¼â\r\n   * éæ±ï¼kendo-gridå¨åé¡µæ¶ï¼ä¸ä¼ç§»é¤å·²éä¸­æ ·å¼\r\n   */\r\n  public static removeRowSelectedStyle(gridComponent: GridComponent, rowIndex: number) {\r\n    if (!gridComponent || rowIndex < 0) {\r\n      return;\r\n    }\r\n\r\n    const currentRowElement = this.getRelativeRowInCurrentPage(gridComponent, rowIndex);\r\n    if (!currentRowElement) {\r\n      return;\r\n    }\r\n    this.removeAttributeSpecificValue(currentRowElement, 'class', this.CURRENT_ROW_STYLE_NAME);\r\n  }\r\n\r\n  /**\r\n   * è·åæå®è¡å¨å½åé¡µé¢å¯¹åºçè¡åç´ \r\n   */\r\n  private static getRelativeRowInCurrentPage(gridComponent: GridComponent, rowIndex: number): any {\r\n    let rowElementInCurrentPage: any = null;\r\n    if (!gridComponent || rowIndex < 0) {\r\n      return rowElementInCurrentPage;\r\n    }\r\n\r\n    const gridElement = gridComponent.wrapper;\r\n    // å¯ç¨åé¡µåï¼éè¦æ´æ°å½åè¡\r\n    const isPaging = this.checkIfEnablePaging(gridComponent);\r\n    if (isPaging) {\r\n      rowIndex = rowIndex % (gridComponent.pageSize); // å¯¹pageSizeåæ¨¡\r\n    }\r\n\r\n    const trCollection = this.getTrCollection(gridElement);\r\n    if (trCollection == null || trCollection.length <= 0) {\r\n      return rowElementInCurrentPage;\r\n    }\r\n\r\n    rowElementInCurrentPage = trCollection[rowIndex];\r\n\r\n    return rowElementInCurrentPage;\r\n  }\r\n\r\n  /**\r\n   * è·åå½ågridçtréå\r\n   */\r\n  private static getTrCollection(elementRef: ElementRef): any[] {\r\n    if (!elementRef || !elementRef.nativeElement) {\r\n      return null;\r\n    }\r\n\r\n    const kendoGridTbodyElements: any[] = elementRef.nativeElement.getElementsByTagName('tbody');\r\n    if (!kendoGridTbodyElements || kendoGridTbodyElements.length <= 0) {\r\n      return null;\r\n    }\r\n\r\n    const trCollection = kendoGridTbodyElements[0].getElementsByTagName('tr');\r\n    return trCollection;\r\n  }\r\n\r\n  /**\r\n   * ååç´ çæå®å±æ§è¿½å å¼\r\n   */\r\n  private static appendAtrributeValue(currentElement: Element, attributeName: string, attributeValue: string) {\r\n    let newAttributeValue: string = currentElement.getAttribute(attributeName);\r\n    if (newAttributeValue === null || newAttributeValue === '' || newAttributeValue.length <= 0) {\r\n      newAttributeValue = attributeValue;\r\n    } else {\r\n      if (newAttributeValue.indexOf(attributeValue) < 0) { // å­å¨æ£æµï¼é¿åéå¤æ·»å \r\n        newAttributeValue += ' ' + attributeValue;\r\n      }\r\n    }\r\n\r\n    currentElement.setAttribute(attributeName, newAttributeValue);\r\n  }\r\n\r\n  /**\r\n   * ç§»é¤åæ°æ®æå®å±æ§çç¹æ§å±æ§å¼\r\n   */\r\n  private static removeAttributeSpecificValue(currentElement: Element, attributeName: string, needRemoveAttributeValue: string) {\r\n    let lastClassAttributeValue = currentElement.getAttribute(attributeName);\r\n    if (!lastClassAttributeValue) {\r\n      return;\r\n    }\r\n\r\n    const index = lastClassAttributeValue.lastIndexOf(needRemoveAttributeValue);\r\n    if (index < 0) {\r\n      return;\r\n    }\r\n\r\n    const tempLastClassAttributeValue = lastClassAttributeValue.substring(0, index - 1);\r\n    lastClassAttributeValue = tempLastClassAttributeValue + ' '\r\n      + lastClassAttributeValue.substring(index + needRemoveAttributeValue.length);\r\n\r\n    currentElement.setAttribute(attributeName, lastClassAttributeValue);\r\n  }\r\n}\r\n","/**\r\n * éä¸­è¡ä¸ä¸æ\r\n */\r\nexport class SelectedRowContext {\r\n    /**\r\n     * å½åéä¸­è¡Index\r\n     */\r\n    currentRowIndex: number;\r\n\r\n    /**\r\n     * ä¸ä¸ä¸ªéä¸­è¡Index\r\n     */\r\n    lastRowIndex: number;\r\n}\r\n","import {\r\n  Directive, OnInit, OnChanges, OnDestroy, SimpleChanges, Input, HostListener, Optional,\r\n  EventEmitter, Output, ElementRef, ContentChildren, QueryList, NgZone, AfterViewInit\r\n} from '@angular/core';\r\nimport { of, Subscription } from 'rxjs';\r\nimport {\r\n  GridComponent, DataBindingDirective,\r\n  SelectionDirective,\r\n  CellClickEvent,\r\n  DataStateChangeEvent, GridDataResult, PageChangeEvent, SortSettings,\r\n} from '@progress/kendo-angular-grid';\r\nimport { process, GroupDescriptor, AggregateDescriptor, State, FilterDescriptor, SortDescriptor } from '@progress/kendo-data-query';\r\nimport {\r\n  BindingData, BindingList, Change, ChangeType,\r\n  FrameEventBus, UIState, Form, ViewModel, ComponentType\r\n} from '@farris/devkit';\r\nimport { DialogService } from '@farris/ui-dialog';\r\nimport { RuntimeStateService } from '@farris/ui-common';\r\nimport { DateTimeHelperService } from '@farris/ui-common/date';\r\nimport { FarrisKendoGridFormatService } from '../format/index';\r\nimport { GridColumnAggregateDirective } from './grid-summary.directive';\r\nimport { MultiSelectGridUtility } from '../util/multi_select_grid_utility';\r\nimport { SelectedRowContext } from '../entity/index';\r\n\r\n/*\r\n * Kendo Grid æ°æ®ç»å®æä»¤\r\n *\r\n * TODO:\r\n * 1ãæ´ä½å·å­å¨æ§è½é®é¢ï¼\r\n * 2ãéä¸­åå½åè¡æ²¡æåºåå¼ï¼\r\n */\r\n\r\n@Directive({\r\n  selector: '[farrisBindingPath]'\r\n})\r\nexport class KendoGridBindingDirective extends DataBindingDirective implements OnInit, AfterViewInit, OnChanges, OnDestroy {\r\n\r\n  /**\r\n   * æ¯å¦åè®¸ç¼è¾\r\n   * é»è®¤å¯ç¼è¾  å ä¸ºææ¹éç¼è¾åè¡¨\r\n   */\r\n  @Input('farrisEditable')\r\n  public editable: boolean;\r\n\r\n  /**\r\n   * ç¼è¾æ¶ç»å®çè¡¨å\r\n   */\r\n  @Input('farrisForm')\r\n  public form: Form;\r\n\r\n  /**\r\n   * åç»å\r\n   */\r\n  @Input('groupField')\r\n  public groupField: string;\r\n\r\n  @Input('groupAggrFields')\r\n  public groupAggrFields: string[];\r\n\r\n  /* ç»å®grid option */\r\n  @Input()\r\n  public farrisBindingGridOption: any;\r\n\r\n  /* å¼å®¹rowClass è¿æ²¡å é¤ */\r\n  @Input()\r\n  rowClassName: any;\r\n  /* è¡æ ·å¼äºä»¶ */\r\n  // @Input()\r\n  // rowClassName: (context: any) => any;\r\n\r\n  // tslint:disable-next-line:no-output-rename\r\n  @Output('append-row') appendRow = new EventEmitter<any>();\r\n\r\n  /* ç»å®æåºäºä»¶ */\r\n  @Output() sortChangeEvent: EventEmitter<any> = new EventEmitter<any>();\r\n\r\n  /* è¡æ ·å¼äºä»¶ */\r\n  @Output()\r\n  rowClass: EventEmitter<any> = new EventEmitter<any>();\r\n\r\n\r\n  get gridOption() {\r\n    return this.grid['gridOption'];\r\n  }\r\n  get len() {\r\n    return this.grid.columns.length;\r\n  }\r\n\r\n  dataItem: any;\r\n\r\n  /* keydownç»å®äºä»¶å¯¹è±¡ */\r\n  gridElement: any;\r\n  gridKeydownEvent: any;\r\n\r\n  /* cellclickäºä»¶å¯¹è±¡ */\r\n  gridCellClickEvent: any;\r\n\r\n  /* cellCloseäºä»¶å¯¹è±¡ */\r\n  gridCellCloseEvent: any;\r\n\r\n\r\n  cellClickEvent: CellClickEvent;\r\n\r\n  hiddenColLen = 0;\r\n  /**\r\n   * TODO: ä»å®ä½è·åå¶é»è®¤å¼\r\n   * å½åè¡ç´¢å¼å¼ï¼é»è®¤ç¬¬ä¸ä¸ª\r\n   */\r\n  rowIndex = 0;\r\n  columnIndex = 0;\r\n  sender: any;\r\n  interVal: any;\r\n  dataId: any;\r\n  currentSkip = 0;\r\n  private currentRowId: string;\r\n\r\n  cellClickParam: CellClickEvent;\r\n  /**\r\n   * æ¯å¦å¯ç¨å¤éï¼é»è®¤æªå¯ç¨\r\n   */\r\n  private isMultipleSelectionMode = false;\r\n  public get IsMultipleSelectionMode() {\r\n    if (!this.grid) {\r\n      return this.isMultipleSelectionMode;\r\n    }\r\n\r\n    if (this.grid.selectable) { // ä¼åå°è¯ä»this.grid.selectableè·å\r\n      // tslint:disable-next-line: no-string-literal\r\n      if (this.grid.selectable['mode'] === 'multiple') {\r\n        this.isMultipleSelectionMode = true;\r\n      } else {\r\n        this.isMultipleSelectionMode = false;\r\n      }\r\n    } else {\r\n      if (this.grid.selectableSettings && this.grid.selectableSettings.mode === 'multiple') {\r\n        this.isMultipleSelectionMode = true;\r\n      }\r\n    }\r\n\r\n    return this.isMultipleSelectionMode;\r\n  }\r\n\r\n  /**\r\n   * ä¸ä¸ä¸ªéä¸­è¡ï¼é»è®¤ä¸å­å¨\r\n   */\r\n  public lastRowIndex = -1;\r\n\r\n  /**\r\n   * éä¸­è¡åæ¢äºä»¶\r\n   */\r\n  @Output() selectedRowChange: EventEmitter<any> = new EventEmitter<any>();\r\n\r\n  /**\r\n   * checkboxéæ©äºä»¶\r\n   */\r\n  @Output() selectedCheckboxChange: EventEmitter<any> = new EventEmitter<any>();\r\n\r\n  /**\r\n   * ç»å®åè¡¨(Gridå¯¹åºæ°æ®æº)\r\n   */\r\n  private get bindingList(): BindingList {\r\n    // æ ¹å®ä½\r\n    if (this.viewModel.bindingPath === '/' || !this.viewModel.bindingPath) {\r\n      return this.bindingData.list;\r\n    }\r\n    // å­å®ä½\r\n    let bindingPath = this.viewModel.bindingPath.substr(1);\r\n    bindingPath = bindingPath[0].toLowerCase() + bindingPath.substring(1, bindingPath.length);\r\n    const paths = bindingPath.split('/');\r\n\r\n    const filteredPaths = paths.filter((part: string) => {\r\n      return part !== '';\r\n    });\r\n    return this.bindingData.getValue(filteredPaths);\r\n  }\r\n  /**\r\n   * è·ååé¡µä¿¡æ¯\r\n   */\r\n  private getPagingInfo() {\r\n    const bindingPath = this.viewModel.bindingPath;\r\n    const bindingData = this.viewModel.bindingData;\r\n    let pagingInfo = bindingData.pagingInfo;\r\n    if (bindingPath === '/') {\r\n      return pagingInfo;\r\n    } else {\r\n      const bindingPaths = bindingPath.substr(1).split('/').filter(item => !!item && item.length > 0).map(item => {\r\n        return item.substring(0, item.length - 1);\r\n      });\r\n      bindingPaths.forEach(path => {\r\n        pagingInfo = pagingInfo && pagingInfo[path] || {};\r\n      });\r\n      return pagingInfo;\r\n    }\r\n  }\r\n\r\n  @ContentChildren(GridColumnAggregateDirective) private aggrColumns: QueryList<GridColumnAggregateDirective>;\r\n  private bindingChangeSubscription: Subscription;\r\n\r\n  /**\r\n   * æé å½æ°\r\n   * @param  grid å®¿ä¸»Grid\r\n   */\r\n  constructor(\r\n    public bindingData: BindingData,\r\n    @Optional() public uiState: UIState,\r\n    @Optional() public eventBus: FrameEventBus,\r\n    @Optional() public viewModel: ViewModel,\r\n    public grid: GridComponent,\r\n    public selectionDir: SelectionDirective,\r\n    public dialogSer: DialogService,\r\n    private dateService: DateTimeHelperService,\r\n    private kendogridFormatSer: FarrisKendoGridFormatService,\r\n    private rts: RuntimeStateService,\r\n    public ngZone: NgZone\r\n  ) {\r\n    super(grid);\r\n\r\n    this.selectionDir.selectedKeys = [];\r\n    this.viewModel.uiState.setPropertyValue('ids', this.selectionDir.selectedKeys);\r\n    const appContext = this.viewModel.frameContext.getFormAppContext();\r\n    if (appContext && appContext.hasOwnProperty('messagePipe')) {\r\n      appContext.messagePipe.subscribe((message: any) => {\r\n        this.grid.closeCell();\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * æä»¤åå§åå\r\n   */\r\n  ngOnInit() {\r\n    super.ngOnInit();\r\n\r\n    // åå§åstateï¼åç»ä½¿ç¨ã\r\n    this.initDataState();\r\n\r\n    this.refreshView();\r\n    if (this.viewModel && this.viewModel.frameContext && this.viewModel.frameContext.frameComponent) {\r\n      this.viewModel.frameContext.frameComponent.componentType = ComponentType.kendoGridComponent;\r\n    }\r\n    // æ°æ®åå\r\n    this.bindingChangeSubscription = this.bindingData.changes.subscribe((change: Change) => {\r\n      this.refreshView(change);\r\n\r\n      if (change.type === ChangeType.Load) {\r\n        // loadæ¶ï¼å¨å¤éæ¨¡å¼ä¸ï¼éæ¸ç©ºéä¸­éå\r\n        if (this.isMultipleSelectionMode) {\r\n          const isMatch = this.checkIfChangeMatchBindingPath(change);\r\n          if (isMatch) {\r\n            // æ¸ç©ºå¤ééå\r\n            this.selectionDir.selectedKeys = [];\r\n            this.viewModel.uiState.setPropertyValue('ids', this.selectionDir.selectedKeys);\r\n            this.ngZone.runOutsideAngular(() => {\r\n              // æ¸²æåå§éä¸­è¡\r\n              setTimeout(() => {\r\n                const rowSelectedContext: SelectedRowContext = new SelectedRowContext();\r\n                const isPageable = MultiSelectGridUtility.checkIfEnablePaging(this.grid);\r\n                if (isPageable) {\r\n                  this.rowIndex = this.grid.skip;\r\n                } else {\r\n                  this.rowIndex = 0;\r\n                }\r\n                rowSelectedContext.currentRowIndex = this.rowIndex;\r\n                rowSelectedContext.lastRowIndex = this.lastRowIndex;\r\n                this.handleSelectedRowChange(rowSelectedContext);\r\n              }, 300);\r\n            });\r\n          }\r\n        }\r\n      }\r\n\r\n      // TODO: ä½¿ç¨ç­ç¥æ¨¡å¼éæ\r\n      // bindingData åæ­¥ SelectedKeys\r\n      if (change.type === ChangeType.Remove) {\r\n        this.syncDeletedKeys(change.value);\r\n      }\r\n      const isMatch = this.checkIfChangeMatchBindingPath(change);\r\n      if (isMatch) {\r\n        this.handleSelectedKeyChange(this.bindingList.currentId);\r\n      }\r\n      // æ¸²æå½åè¡\r\n      if (isMatch && this.checkCurrentRowIdExists() && change.type === ChangeType.SelectionChanged && !this.dataId) {\r\n        this.renderCurrentRow(this.bindingList.currentId);\r\n      }\r\n      // tslint:disable-next-line: max-line-length\r\n      // FIXME:éè¦æéç½®é¡µç çæ¶æº\r\n      /*if ((change.type === ChangeType.SelectionChanged || change.type === ChangeType.GlobalSelectionChanged) && this.currentRowId !== this.bindingList.currentId) {\r\n          this.resetPageInfo();\r\n      }*/\r\n      // è§¦ååæ´æ£æµ\r\n      if (change.type === ChangeType.Load || change.type === ChangeType.SelectionChanged\r\n        || change.type === ChangeType.Append || change.type === ChangeType.Remove) {\r\n\r\n        // è§¦ååæ´æ£æµ\r\n        if (this.grid && this.grid['changeDetectorRef'] && this.grid['changeDetectorRef']['detectChanges']) {\r\n          this.grid['changeDetectorRef']['detectChanges']();\r\n        }\r\n      }\r\n\r\n    });\r\n\r\n    if (this.editable === true && this.form === null) {\r\n      throw Error('å¯ç¨ç¼è¾æ¶ï¼å¿é¡»æå®form');\r\n    }\r\n    if (!this.grid || !this.farrisBindingGridOption || !this.farrisBindingGridOption['fields']) {\r\n      return;\r\n    }\r\n\r\n    const gridColumns = this.farrisBindingGridOption['fields'];\r\n    const gridOption = this.farrisBindingGridOption;\r\n\r\n    // å¤æ­åä¸­æ¯å¦å­å¨åºå®å\r\n    gridOption.lockable = (columns: any[]) => {\r\n      return columns.some(ele => {\r\n        return ele.frozen;\r\n      });\r\n    };\r\n\r\n    this.rowClass.emit(this.grid);\r\n    // æ·»å åå±æ§æèæ¹æ³\r\n    gridColumns.forEach((element: any) => {\r\n      // èªå®ä¹è¶é¾\r\n      if (element.linkedLabelEnabled && !element.linkEvent) {\r\n        element.linkEvent = () => {\r\n          return;\r\n        };\r\n      }\r\n\r\n      // è¥æ²¡æèªå®ä¹æ ¼å¼åæ¹æ³  æ¯ä¸ªåå¯¹è±¡ç»å®æ ¼å¼åæ¹æ³\r\n      if (!element.getColumnFormat) {\r\n        element.getColumnFormat = (dataItem: any, column: any) => {\r\n          return this.kendogridFormatSer.getColumnFormat(dataItem, column);\r\n        };\r\n      }\r\n\r\n      // å¦ææ²¡æèªå®ä¹ç±»æ ·å¼ æ¯ä¸ªåç»å® æ ¼å¼åæ¹æ³\r\n      if (!element.getClassName) {\r\n        element.getClassName = (dataItem: any, column: any) => '';\r\n      }\r\n\r\n      // èªå®ä¹å¸®å©ååäºä»¶\r\n      if (element.editor && element.editor.type === 'LookupEdit') {\r\n\r\n        // å¸®å©åäºä»¶\r\n        if (!element.dictPicking) {\r\n          element.dictPicking = (param: any) => {\r\n            return of(true);\r\n          };\r\n        }\r\n        // å¸®å©åäºä»¶\r\n        if (!element.dictPicked) {\r\n          element.dictPicked = (param: any) => {\r\n            // éæ°è¿å¥ç¼è¾\r\n            this.cellClickHandler(this.cellClickParam);\r\n            return of(true);\r\n          };\r\n        }\r\n      }\r\n    });\r\n    // ç»å®gridOption\r\n    this.bindingGridOption();\r\n\r\n    // å¤éæ¨¡å¼ä¸ï¼è®¾ç½®åå§éä¸­è¡\r\n    if (this.IsMultipleSelectionMode) {\r\n      // TODO: ç§»é¤ setTimeout\r\n      const self = this;\r\n      this.ngZone.runOutsideAngular(() => {\r\n        setTimeout(() => {\r\n          const rowSelectedContext: SelectedRowContext = new SelectedRowContext();\r\n          rowSelectedContext.currentRowIndex = self.rowIndex;\r\n          rowSelectedContext.lastRowIndex = self.lastRowIndex;\r\n          self.handleSelectedRowChange(rowSelectedContext);\r\n        }, 300);\r\n      });\r\n    }\r\n  }\r\n\r\n\r\n  ngAfterViewInit() {\r\n    // this.gridElement = document.querySelector('.k-grid');\r\n    // // ç»å®grid keydownå¯¹è±¡çæ¹æ³\r\n    // this.ngZone.runOutsideAngular(() => {\r\n    //   this.gridKeydownEvent = this.enterCell.bind(this);\r\n    //   this.gridCellClickEvent = this.cellClickHandler.bind(this);\r\n    //   this.gridCellCloseEvent = this.cellCloseHandler.bind(this);\r\n    //   this.gridElement.addEventListener('keydown', this.gridKeydownEvent);\r\n    //   this.gridElement.addEventListener('cellClick', this.gridCellClickEvent);\r\n    //   this.gridElement.addEventListener('cellClose', this.gridCellCloseEvent);\r\n    // });\r\n  }\r\n  /**\r\n   * æ£æµchangeçè·¯å¾åBindingPathæ¯å¦å¹é\r\n   */\r\n  private checkIfChangeMatchBindingPath(change: Change): boolean {\r\n    let isMatch = false;\r\n    if (!change || !change.path) {\r\n      return isMatch;\r\n    }\r\n\r\n    const changePathArray = change.path;\r\n    if (!changePathArray) {\r\n      return isMatch;\r\n    }\r\n\r\n    if (!(this.bindingData) && !(this.bindingData.bindingPath)) {\r\n      return isMatch;\r\n    }\r\n    const bingdingPathArray = this.bindingData.bindingPath.split('/');\r\n    if (bingdingPathArray.length <= 0) {\r\n      return isMatch;\r\n    }\r\n\r\n    if (changePathArray.length === 0) { // ä¸»è¡¨\r\n      if (this.bindingData.bindingPath === '/') {\r\n        isMatch = true;\r\n      }\r\n    } else if (change.path.length === 1) {// ä¸»ä»è¡¨\r\n      if (bingdingPathArray.length === 2 && bingdingPathArray[1] === change.path[0]) {\r\n        isMatch = true;\r\n      }\r\n    } else if (change.path.length === 2) { // ä¸»ä»ä»è¡¨\r\n      if (bingdingPathArray.length === 3 && bingdingPathArray[1] === change.path[0] && bingdingPathArray[2] === change.path[1]) {\r\n        isMatch = true;\r\n      }\r\n    }\r\n\r\n    return isMatch;\r\n  }\r\n\r\n  /**\r\n   * å¤çéä¸­ä¸»é®åæ´\r\n   */\r\n  private handleSelectedKeyChange(currentId: any) {\r\n    const selectedKeys = this.selectionDir.selectedKeys;\r\n    if (!currentId) {\r\n\r\n      // å¦æå½åè¡æ¶nullï¼ä½selectedKeyséæå¼ï¼æ¸ç©ºå¹¶åéä¸æ¬¡è¡åæ¢\r\n      if (selectedKeys.length > 0) {\r\n        const removedSelectedKeys = selectedKeys.splice(0, selectedKeys.length);\r\n        if (removedSelectedKeys.indexOf(null) === -1) {\r\n          this.emitSelectedRowChange({ currentRowId: null });\r\n        }\r\n      }\r\n      return;\r\n    }\r\n    let oldCurrentRowId = null;\r\n    if (this.IsMultipleSelectionMode) {\r\n      oldCurrentRowId = this.currentRowId;\r\n    } else {\r\n      oldCurrentRowId = this.selectionDir.selectedKeys.length === 0\r\n        ? null : this.selectionDir.selectedKeys[0];\r\n    }\r\n\r\n    // TODO:if (this.currentRowId !== currentId) {\r\n    if (oldCurrentRowId !== currentId) {\r\n      const selectedRowContext: any = {};\r\n      selectedRowContext.currentRowId = currentId;\r\n      this.currentRowId = currentId;\r\n      this.emitSelectedRowChange(selectedRowContext);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * åå°éä¸­è¡åæ¢äºä»¶\r\n   * @description ç»ä¸åéæ¨¡å¼åå¤éæ¨¡å¼ä¸çè¡åæ¢äºä»¶\r\n   */\r\n  private emitSelectedRowChange(selectedRowContext: any) {\r\n    if (!this.IsMultipleSelectionMode) { // ååå¼å®¹\r\n      const currentId = selectedRowContext.currentRowId;\r\n      this.selectionDir.selectedKeys = [currentId];\r\n      this.selectionDir.selectedKeysChange.emit(this.selectionDir.selectedKeys);\r\n    }\r\n\r\n    this.selectedRowChange.emit(selectedRowContext);\r\n  }\r\n\r\n  private checkCurrentRowIdExists(): boolean {\r\n    let isExist = false;\r\n\r\n    if (this.bindingList && this.bindingList.currentId && this.bindingList.currentId.length > 0) {\r\n      isExist = true;\r\n    }\r\n\r\n    return isExist;\r\n  }\r\n\r\n  /**\r\n   * åæ­¥å·²å é¤é®å°éä¸­éå\r\n   */\r\n  private syncDeletedKeys(deletedValueCollection: any[]) {\r\n    if (!deletedValueCollection) {\r\n      return;\r\n    }\r\n\r\n    deletedValueCollection.forEach((id: string) => {\r\n      const index = this.selectionDir.selectedKeys.indexOf(id);\r\n      if (index > -1) {\r\n        this.selectionDir.selectedKeys.splice(index, 1);\r\n\r\n        // selectedKeysè¢«æ¸ç©ºçæ¶åï¼è§¦åä¸æ¬¡è¡åæ´\r\n        if (this.selectionDir.selectedKeys.length === 0) {\r\n          this.emitSelectedRowChange({ currentRowId: null });\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  private renderCurrentRow(currentId: string) {\r\n    if (!currentId || currentId === '') {// ä¸å­å¨å½åè¡\r\n      return;\r\n    }\r\n\r\n    // TODO:ä½¿ç¨ç­ç¥æ¨¡å¼éæ\r\n    if (this.IsMultipleSelectionMode) {\r\n      return;\r\n    }\r\n\r\n    this.renderSelectionRow(this.bindingList.currentId, this.selectionDir.selectedKeys);\r\n  }\r\n\r\n  /**\r\n   * æä»¤è¾å¥åæ´å¤ç\r\n   */\r\n  ngOnChanges(changes: SimpleChanges) {\r\n    super.ngOnChanges(changes);\r\n    this.refreshView();\r\n  }\r\n\r\n  /**\r\n   * æä»¤éæ¯ï¼æ³¨éè®¢é\r\n   */\r\n  ngOnDestroy() {\r\n    if (this.bindingChangeSubscription) {\r\n      this.bindingChangeSubscription.unsubscribe();\r\n    }\r\n  }\r\n\r\n  private refreshView(change?: Change) {\r\n    // this.bindData();\r\n    this.refreshData(change);\r\n\r\n    // å·æ°é¡µèåè®¡ä¿¡æ¯ãå®¢æ·ç«¯åè®¡ï¼ææ¶æ¾è¿éï¼æå¡ç«¯åè®¡æ¶æå¥½ä»è¿éç§»èµ°ãby justin\r\n    this.refreshSummary();\r\n  }\r\n\r\n  /**\r\n   * ç»å®dataå°å®¿ä¸»gridä¸\r\n   * @deprecated\r\n   */\r\n  private bindData() {\r\n    /*const data = this.bindingList.toJSON();\r\n    let skip = 0;\r\n    if (this.bindingList.pageIndex > 0) {\r\n      skip = (this.bindingList.pageIndex - 1) * this.bindingList.pageSize;\r\n    }\r\n    this.updatePager(this.bindingList.pageSize, skip);\r\n    const processed = process(data, Object.assign({}, this.state, { skip: 0 }));\r\n    processed.total = this.bindingList.total;\r\n    this.grid.data = processed;*/\r\n  }\r\n\r\n  private refreshData(change?: Change) {\r\n    let skip = 0;\r\n    const { pageIndex = 1, pageSize = 0 } = this.getPagingInfo() || {};\r\n    if (pageIndex > 0) {\r\n      skip = (pageIndex - 1) * pageSize;\r\n    }\r\n    this.updatePager(pageSize, skip);\r\n    this.endCellEdit(change);\r\n    this.data = this.bindingList.toJSON({ ignoreMultiLangInput: true });\r\n  }\r\n  /**\r\n   * éåºç¼è¾ç¶æ\r\n   * @param change åæ´\r\n   */\r\n  private endCellEdit(change?: Change) {\r\n    const isEditing = this.grid.isEditing;\r\n    if (change && change.type === ChangeType.Load && isEditing) {\r\n      this.grid.cancelCell();\r\n    }\r\n  }\r\n  private refreshSummary() {\r\n    if (this.aggrColumns) {\r\n      this.aggrColumns.forEach(aggrCol => {\r\n        if (aggrCol.aggregate) {\r\n          aggrCol.recalculateSummary(this.bindingList);\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  @HostListener('pageChange', ['$event'])\r\n  public onPageChange(event: PageChangeEvent) {\r\n    const { skip = 0, take = 0 } = event || {};\r\n    // this.bindingList.setPaginationInfo(skip, take);\r\n    this.bindingData.setPagingInfo(skip, take, this.viewModel.bindingPath);\r\n    // ç§»é¤éä¸­è¡æ ·å¼\r\n    MultiSelectGridUtility.removeRowSelectedStyle(this.grid, this.rowIndex);\r\n  }\r\n  /**\r\n   * éç½®gridåé¡µä¿¡æ¯\r\n   */\r\n  private resetPageInfo() {\r\n    const { pageSize = 0 } = this.getPagingInfo() || {};\r\n    this.bindingData.setPagingInfo(0, pageSize, this.viewModel.bindingPath);\r\n  }\r\n  private initDataState() {\r\n    // const groups: GroupDescriptor[] = [];\r\n    // if (this.groupField) {\r\n    //   groups.push({field: this.groupField, aggregates: this.aggregates||[]});\r\n    //   this.grid.group = groups;\r\n    // }\r\n    // this.state = Object.assign(this.state, {group: groups});\r\n\r\n    const aggregatesDes: AggregateDescriptor[] = [];\r\n    if (this.groupAggrFields) {\r\n      for (const groupAggrField of this.groupAggrFields) {\r\n        aggregatesDes.push({ field: groupAggrField, aggregate: 'sum' });\r\n      }\r\n    }\r\n\r\n    const group: GroupDescriptor[] = [];\r\n    if (this.groupField) {\r\n      group.push({ field: this.groupField, aggregates: aggregatesDes });\r\n    }\r\n    this.group = group;\r\n\r\n  }\r\n\r\n  /*\r\n   * @override\r\n   * @param state State\r\n   */\r\n  onStateChange(state: DataStateChangeEvent) {\r\n    // è¯´æï¼pageræ ¹æ®skipè®¡ç®å½åé¡µç ãkendo gridåé¨ä¼å¨filter stateååæ¶æskipåä¸º0ï¼éç½®å°ç¬¬ä¸é¡µï¼ã\r\n    // å æ­¤éè¦éåonStateChangeæ¹æ³ï¼ä¿®æ­£skip\r\n    if (state.skip !== this.currentSkip) {\r\n      state.skip = this.currentSkip;\r\n    }\r\n    // ä½¿ç¨kendoé»è®¤çå¤çstateçé»è¾\r\n    this.applyState(state);\r\n\r\n    this.rebind();\r\n  }\r\n\r\n  // protected applyState({skip, take, sort, group, filter}: State): void {\r\n  //   this.skip = skip;\r\n  //   this.pageSize = take;\r\n  //   this.sort = sort;\r\n  //   this.group = group;\r\n  //   this.filter = filter;\r\n  // }\r\n\r\n  /*\r\n   * @override æå¡å¨ç«¯åé¡µåæ°ãprocessä½¿ç¨çstateä¸­skipåºä¸º0ï¼å¦åä¸æ¾ç¤ºæ°æ®\r\n   * @param state State\r\n   */\r\n  protected process(state: State): GridDataResult {\r\n    // if (this.editing) {\r\n    //   state.sort = null;\r\n    // } else {\r\n    //   state.sort = this.originalSort;\r\n    // }\r\n    state.skip = 0;\r\n    const { pageSize = 0, total: totalCount = 0 } = this.getPagingInfo() || {};\r\n    // fixï¼ä¸å¯ç¨åé¡µæ¶ï¼take=0å¯¼è´processä¸è¿åæ°æ®\r\n    if (state.take === 0) {\r\n      state.take = this.bindingList.length;\r\n    } else {\r\n      state.take = pageSize;\r\n    }\r\n    // ç¼è¾æ¨¡å¼çå¤æ­ä¾æ®ä¸ºpageSizeå°äºç»å®æ°æ®çæ°éä¸å¯ç¨åé¡µ\r\n    const isEditMode = state.take < this.bindingList.length;\r\n    if (isEditMode) {\r\n      state.take = this.bindingList.length;\r\n    }\r\n    const processed = super.process(state);\r\n    // fix:æ°æ®ä»æ å°ææ¶åé¡µä¸å¯ç¨\r\n    processed.total = Math.max(totalCount, this.bindingList.length);\r\n    // åé¡µç¼è¾æ¨¡å¼ä¸æ°æ®æ»è®°å½æ°ä¸è½ç­äºçå®çæ°æ®æ°æ®ï¼å¦ååé¡µå·¥å·æ¡å°±ä¼èªå¨å¢å åé¡µé¡µç­¾\r\n    if (isEditMode) {\r\n      processed.total = totalCount || 1;\r\n    }\r\n\r\n    return processed;\r\n  }\r\n\r\n  /*\r\n   * éä¸­è¡ä¸»é®ååå¤ç\r\n   * @param event { SelectionEvent} éä¸­è¡ååå¤ç\r\n   */\r\n  @HostListener('selectedKeysChange', ['$event'])\r\n  public selectedKeysChangeHandler(selectedKeys: string[]) {\r\n    if (!(this.IsMultipleSelectionMode)) {// åéæ¨¡å¼ä¸\r\n      // è®¾ç½®BindingDataä¸­çå½åè¡\r\n      this.setSelectionIdToBindingData(selectedKeys[selectedKeys.length - 1]);\r\n    }\r\n\r\n    this.viewModel.uiState.setPropertyValue('ids', this.selectionDir.selectedKeys); // æ´æ°éå\r\n  }\r\n\r\n  /*\r\n   * å¤çGridè¡åæ¢äºä»¶\r\n   * @param event { SelectionEvent} è¡åæ¢äºä»¶å¯¹è±¡\r\n   */\r\n  @HostListener('selectionChange', ['$event'])\r\n  public selectionChangeHandler(event: any) {\r\n    if (this.IsMultipleSelectionMode) {\r\n      this.handleSelectedCheckboxChange(this.grid.wrapper, event);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * å¤çcheckboxéä¸­äºä»¶\r\n   */\r\n  private handleSelectedCheckboxChange(elementRef: ElementRef, event: any) {\r\n    MultiSelectGridUtility.renderSelectedChangeCheckbox(elementRef, event);\r\n    this.selectedCheckboxChange.emit(event);\r\n  }\r\n\r\n  /*\r\n   * ååæ ¼ç¹å»å¤ç\r\n   * @param event { CellClickEvent } ååæ ¼åå»äºä»¶å¯¹è±¡\r\n   */\r\n  @HostListener('cellClick', ['$event'])\r\n  public cellClickHandler(event: CellClickEvent) {\r\n    this.cellClickParam = event;\r\n    this.cellClickEvent = event;\r\n    this.rowIndex = event.rowIndex;\r\n    this.columnIndex = event.columnIndex;\r\n    this.sender = event.sender;\r\n\r\n    // å¤éæ¨¡å¼ä¸ï¼ä¸ä¸åç»çæåµä¸ï¼æ£æµè¡åæ¢\r\n    if (this.IsMultipleSelectionMode && !this.gridOption.groupable) {\r\n      const currentRowIndex = event.rowIndex;\r\n      if (currentRowIndex !== this.lastRowIndex) {\r\n        const rowSelectedContext: SelectedRowContext = new SelectedRowContext();\r\n        rowSelectedContext.currentRowIndex = currentRowIndex;\r\n        rowSelectedContext.lastRowIndex = this.lastRowIndex;\r\n\r\n        this.handleSelectedRowChange(rowSelectedContext);\r\n      }\r\n    }\r\n\r\n    // è®¾ç½®å®ä½çå½åè¡\r\n    this.dataId = this.getSelectedIdFromGrid(event.dataItem);\r\n    this.setSelectionIdToBindingData(this.dataId);\r\n\r\n    // è¥ç¶ææºä¸æ¯å¯ç¼è¾ç¶æ ä¸å¯ç¼è¾\r\n    if (!this.isEditable()) {\r\n      return;\r\n    }\r\n\r\n\r\n\r\n    // åæ¨¡æ¿ä¸å­å¨  ä¸å¯ç¼è¾\r\n    if (!event.column.editTemplate) {\r\n      return;\r\n    }\r\n    if (event.type === 'click' && !event.isEdited) {\r\n\r\n\r\n      // å¦æå­å¨æ¾éç¶åµ  ç¡®å®æ­£ç¡®çcolumnIndex\r\n      const originColums = this.getColumns(this.gridOption.fields);\r\n      const columns: any[] = this.getColumns(originColums);\r\n      const currentColumnIndex = columns.findIndex((col: any) => col.dataField === event.column.field);\r\n      const hiddenColLen = columns.slice(0, currentColumnIndex + 1).filter(col => !col.visible).length;\r\n\r\n      // èµå¼å¨å±è¡ç´¢å¼  åç´¢å¼\r\n      this.rowIndex = event.rowIndex;\r\n      this.columnIndex = event.columnIndex + hiddenColLen;\r\n      this.hiddenColLen = hiddenColLen;\r\n      this.sender = event.sender;\r\n\r\n      this.setEditable(this.rowIndex, this.columnIndex);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * å¤çéä¸­è¡åæ¢äºä»¶\r\n   */\r\n  private handleSelectedRowChange(rowSelectedContext: SelectedRowContext) {\r\n    MultiSelectGridUtility.renderClickChangedRow(this.grid, rowSelectedContext);\r\n\r\n    this.rowIndex = rowSelectedContext.currentRowIndex;\r\n    this.lastRowIndex = rowSelectedContext.currentRowIndex;\r\n    // æ´æ°å½åè¡\r\n    const id = this.getPrimary(this.rowIndex);\r\n    this.setSelectionIdToBindingData(id);\r\n  }\r\n  /**\r\n   * è·åæå®è¡çä¸»é®\r\n   * @param row è¡å·\r\n   */\r\n  private getPrimary(row: number) {\r\n    let data: any = this.grid.data;\r\n    if (data && !Array.isArray(data) && data.hasOwnProperty('data')) {\r\n      data = data.data;\r\n    }\r\n    const { pageIndex = 1, pageSize = 0 } = this.getPagingInfo() || {};\r\n    const skip = this.bindingList.skip;\r\n    // ä¸åé¡µæèç¬¬ä¸é¡µæ¶åä¸éè¦ä¿®æ¹è¡å·\r\n    const rowNumber = pageSize === 0 || pageIndex === 1 ? row : row - skip;\r\n    if (data.length > rowNumber) {\r\n      return data[rowNumber][this.bindingList.primaryKey];\r\n    }\r\n    return null;\r\n  }\r\n\r\n  /*\r\n   * ååæ ¼ç»æç¼è¾å¤ç\r\n   * @param event ååæ ¼ç»æç¼è¾äºä»¶å¯¹è±¡\r\n   */\r\n  @HostListener('cellClose', ['$event'])\r\n  public cellCloseHandler(event: any): any {\r\n\r\n    if (this.dialogSer.hasDialogOpened()) {\r\n      event.preventDefault();\r\n      return;\r\n    }\r\n\r\n    if (this.rts) {\r\n      // å¸®å©ç»ä»¶ææ¬åååå»æ¥è¯¢\r\n      if (this.rts.getFormState('lookup.pending')) {\r\n        event.preventDefault();\r\n        return;\r\n      }\r\n\r\n      // ç¹å»å¸®å©ç¡®å®å¯åæ¶æé®åä¸ç»æå½åååæ ¼ç¼è¾\r\n      if (event.originalEvent) {\r\n        if (this.rts.eventPath(event.originalEvent).find(n => n.tagName === 'FARRIS-DIALOG')) {\r\n          event.preventDefault();\r\n          return;\r\n        }\r\n      }\r\n    }\r\n\r\n\r\n    const { formGroup, column, dataItem, rowIndex } = event;\r\n    const columns = this.getColumns(this.gridOption.fields);\r\n    let currentCol = columns.find((element: any) => {\r\n      return element.dataField === column.field;\r\n    });\r\n    const formControlValue = formGroup[currentCol.editor.binding.path].value;\r\n    if (currentCol.getDynamicData) {\r\n      // è¥æ­¤åæ¯å¨æååæ ¼å\r\n      currentCol = currentCol.getDynamicData(dataItem, currentCol);\r\n    }\r\n    this.setValue(formControlValue, currentCol);\r\n  }\r\n\r\n  /*\r\n     * åè½¦  åæ¢ååæ ¼\r\n     * @param event é®çæä¸äºä»¶\r\n     */\r\n  @HostListener('keydown', ['$event'])\r\n  enterCell(e: any) {\r\n    // åè½¦é®\r\n    if (!e.shiftKey && e.keyCode === 13) {\r\n      // textarea enter å±è½æ¢è¡æä½\r\n      e.preventDefault();\r\n      if (!this.sender) {\r\n        return;\r\n      }\r\n      // ç±äºkeydown äºä»¶ä¼åæ§è¡ï¼æä»¥è¿éåè¦æ§è¡blur äºä»¶ï¼\r\n      e.target.blur();\r\n      this.ngZone.runOutsideAngular(() => {\r\n        setTimeout(() => {\r\n          if (this.rts && this.rts.getFormState('lookup.pending')) {\r\n            e.preventDefault();\r\n            return;\r\n          }\r\n          this.enterNextCell();\r\n        }, 201);\r\n      });\r\n    }\r\n  }\r\n\r\n  /*\r\n     * ç»å®grid option\r\n     * @param dataItem è¡æ°æ®\r\n     */\r\n  private bindingGridOption() {\r\n    if (!this.farrisBindingGridOption) {\r\n      return;\r\n    }\r\n    Object.defineProperty(this.grid, 'gridOption', { value: this.farrisBindingGridOption });\r\n  }\r\n\r\n  /*\r\n   * æ´æ°Gridåé¡µç¶æ\r\n   * @param take\r\n   * @param skip\r\n   */\r\n  private updatePager(take: number, skip: number) {\r\n    if (take === 0) {\r\n      this.currentSkip = 0;\r\n      this.pageSize = 0;\r\n      this.skip = 0;\r\n      this.grid.pageable = false;\r\n    } else {\r\n      this.currentSkip = skip;\r\n      this.skip = skip;\r\n      this.pageSize = take;\r\n      this.grid.pageable = {\r\n        buttonCount: 10,\r\n        info: true,\r\n        type: 'numeric',\r\n        pageSizes: false,\r\n        previousNext: true\r\n      };\r\n    }\r\n  }\r\n\r\n  /*\r\n   * è®¾ç½®ååæ ¼å¯ç¼è¾æ§\r\n   * @param dataItem è¡æ°æ®\r\n   * @param column åå¯¹è±¡\r\n   * @param rowIndex è¡ç´¢å¼\r\n   * @param columnIndex åç´¢å¼\r\n   * @param sender gridå®ä¾\r\n   */\r\n  setEditable(rowNumber: number, columnNumber: number) {\r\n    const data = this.grid.data['data'];\r\n    const { pageIndex = 1, pageSize = 0 } = this.getPagingInfo() || {};\r\n    const skip = this.bindingList.skip;\r\n    // ä¸åé¡µæèç¬¬ä¸é¡µæ¶åä¸éè¦ä¿®æ¹è¡å·\r\n    const dataRowNumber = pageSize === 0 || pageIndex === 1 ? rowNumber : rowNumber - skip;\r\n    let item = data[dataRowNumber];\r\n    if (this.gridOption.groupable) {\r\n      item = this.getGroupItem(data, dataRowNumber);\r\n    }\r\n    const originColums = this.getColumns(this.gridOption.fields);\r\n    const columns = this.getColumns(originColums);\r\n    /* åå¦åçé¡ºåºæ¹å æ¯å¦å­å¨åºå®å  é£ä¹åºè¯¥è·åçæ­£çåå¯¹è±¡ */\r\n    // let col = columns[columnNumber];\r\n\r\n    let tempIndex = columnNumber;\r\n    // å½ååç´¢å¼ä¸ä¸º0\r\n    if (this.grid['gridOption'].showLineNumber) {\r\n      tempIndex = tempIndex - 1;\r\n    }\r\n    if (this.grid.selectable && this.grid.selectable['mode'] === 'multiple') {\r\n      tempIndex = tempIndex - 1;\r\n    }\r\n    const col = columns[tempIndex];\r\n\r\n    const params = {\r\n      dataItem: item,\r\n      column: col,\r\n      rowIndex: rowNumber,\r\n      columnIndex: tempIndex,\r\n    };\r\n\r\n    // æ§å¶ååæ ¼çå¯ç¼è¾æ§\r\n    if (col && !col.editable) {\r\n      col.editable = (param: object) => true;\r\n    }\r\n    if (col && this.notReadOnly(col, params)) {\r\n      // è®¾ç½®å½åè¡\r\n      this.dataId = this.getSelectedIdFromGrid(item);\r\n      this.setSelectionIdToBindingData(this.dataId);\r\n      // const value = this.getValue(item, col.dataField);\r\n      // this.setValue(value, col);\r\n      this.sender.editCell(rowNumber, columnNumber - this.hiddenColLen, this.viewModel.form);\r\n    }\r\n\r\n  }\r\n  /*\r\n  è·åæ´æ° rowIndex columnIndex\r\n   */\r\n  updateIndex(rowNumber: number, columnIndex: number) {\r\n    const newColumnIndex = (columnIndex + 1) % this.len;\r\n    if (!newColumnIndex) {\r\n      const dataLen = this.bindingList.toJSON().length;\r\n      const newRowIndex = (rowNumber + 1) % dataLen;\r\n      return { rowIndex: newRowIndex, columnIndex: newColumnIndex };\r\n    }\r\n    return {\r\n      rowIndex: rowNumber,\r\n      columnIndex: newColumnIndex\r\n    };\r\n  }\r\n\r\n  /* æ¯å¦åªè¯» */\r\n  notReadOnly(column: any, param: any) {\r\n    if (!column) {\r\n      return false;\r\n    }\r\n    return column.editable(param) && !column.editor.readonly;\r\n  }\r\n\r\n  /*\r\n     * ç»åè¡¨èµå¼ æç»formcontrolèµå¼\r\n      */\r\n  setValue(value: any, column: any) {\r\n    const currentColumnType = column.dataType;\r\n    // åæ¶å¤æ­gridOptionçåå¯¹è±¡\r\n    const bindingData = this.viewModel.bindingData;\r\n    const fieldPaths = this.getFieldPaths(bindingData.bindingPath, column.dataField);\r\n    // å­å¨è¡ç¼è¾å¨\r\n    if (currentColumnType === 'date') {\r\n      let dateStr = this.dateService.formatTo(value, 'yyyy-MM-dd HH:mm:ss');\r\n      if (!dateStr) {\r\n        dateStr = '';\r\n      }\r\n      this.viewModel.bindingData.setValue(fieldPaths, dateStr, true, true);\r\n    } else {\r\n      this.viewModel.bindingData.setValue(fieldPaths, value, true, true);\r\n    }\r\n  }\r\n\r\n  /* åç»æ¶ è·åç¹å»è¡æ°æ® */\r\n  getGroupItem(data: any[], rowNumber: number) {\r\n    let index = rowNumber;\r\n    for (const i in data) {\r\n      if (index < data[i].items.length) {\r\n        return data[i].items[index];\r\n      } else {\r\n        index = index - data[i].items.length;\r\n      }\r\n    }\r\n  }\r\n\r\n  /*\r\n   * è·å ååæ ¼å¼  ä¸»ä»è¡¨æ¯æ\r\n   * @param dataItem è¡æ°æ®\r\n   * @param field å­æ®µ\r\n   */\r\n  getValue(dataItem: any, field: string) {\r\n    const index = field.indexOf('.');\r\n    if (index < 0) {\r\n      return dataItem[field];\r\n    }\r\n    const fields = field.split('.');\r\n    // fieldå­ç¬¦ä¸²ç»å\r\n    return fields.reduce((result: any, next: any) => {\r\n      return result[next];\r\n    }, dataItem);\r\n  }\r\n\r\n  /*\r\n  * è·å bindingData è·¯å¾\r\n  * @param bindingPath å½åç»å®çå­æ®µè·¯å¾\r\n  * @param fieldName å­æ®µ\r\n  */\r\n  private getFieldPaths(bindingPath: string, field: string): string[] {\r\n    let fieldPath = '';\r\n    if (bindingPath.length > 1) {\r\n      fieldPath = bindingPath.substr(1).replace(/\\//g, '.') + '.' + field;\r\n    } else {\r\n      fieldPath = field;\r\n    }\r\n    return fieldPath.split('.');\r\n  }\r\n\r\n  /**\r\n   * åè½¦è¿å¥ä¸ä¸ä¸ªååæ ¼\r\n   */\r\n  enterNextCell() {\r\n    const index = this.updateIndex(this.rowIndex, this.columnIndex);\r\n    if (!index.columnIndex && !index.rowIndex) {\r\n      const len = this.bindingList.toJSON().length;\r\n      // å¦æå­å¨æ·»å æ°æ®çAPI\r\n      this.appendRow.emit();\r\n      if (this.appendRow.observers && this.appendRow.observers.length) {\r\n        this.interVal = setInterval(() => {\r\n          if (this.bindingList.toJSON().length - 1 === len) {\r\n            this.setEditable(this.bindingList.toJSON().length - 1, 0);\r\n            this.rowIndex = this.bindingList.toJSON().length - 1;\r\n            this.columnIndex = 0;\r\n            clearInterval(this.interVal);\r\n          }\r\n        }, 0);\r\n        return;\r\n      }\r\n    }\r\n\r\n    this.setEditable(index.rowIndex, index.columnIndex);\r\n    this.rowIndex = index.rowIndex;\r\n    this.columnIndex = index.columnIndex;\r\n  }\r\n\r\n  /* è·åçæ­£çåå¯¹è±¡ */\r\n  getColumns(columns: any) {\r\n    // å¤æ­æ¯å¦å­å¨åºå®å\r\n    const hasLocked = columns.some((ele: any) => {\r\n      return ele.frozen;\r\n    });\r\n    if (hasLocked) {\r\n      const lockedColumns = columns.filter((ele: any) => {\r\n        return ele.frozen;\r\n      });\r\n      const notLockedColumns = columns.filter((ele: any) => {\r\n        return !ele.frozen;\r\n      });\r\n      return [...lockedColumns, ...notLockedColumns];\r\n    }\r\n    return columns;\r\n  }\r\n\r\n  /*\r\n   * æ¸²ææå®è¡ä¸ºéä¸­è¡ï¼å°æå®è¡çkeyæ·»å å°éä¸­è¡éåä¸­\r\n   */\r\n  private renderSelectionRow(key: string, selectedKeys: any[]) {\r\n    if (!key || key === '') {\r\n      return;\r\n    }\r\n\r\n    // TODO:ä½¿ç¨ç­ç¥æ¨¡å¼éæ\r\n    if (this.IsMultipleSelectionMode) {\r\n      const index = selectedKeys.indexOf(key);\r\n      if (index >= 0) {\r\n        return;\r\n      }\r\n\r\n      selectedKeys.push(key);\r\n    } else {\r\n      if (selectedKeys.length === 1 && selectedKeys[0] === key) {\r\n        return;\r\n      }\r\n\r\n      selectedKeys.splice(0, selectedKeys.length);\r\n      selectedKeys.push(key);\r\n    }\r\n\r\n    this.selectionDir.selectedKeysChange.emit(selectedKeys); // æå¨è§¦åselectedKeysChangeäºä»¶\r\n  }\r\n\r\n  /*\r\n   * è·åGridä¸çå½åè¡åç \r\n   * @param dataItem è¡æ°æ®\r\n   */\r\n  private getSelectedIdFromGrid(dataItem: any) {\r\n    const primaryKey = this.bindingList.primaryKey;\r\n    return dataItem[primaryKey];\r\n  }\r\n\r\n  /*\r\n   * è®¾ç½®BindingListçå½åè¡\r\n   * @param id å½åè¡åç \r\n   */\r\n  private setSelectionIdToBindingData(id: string): void {\r\n    this.bindingList.setCurrentId(id, true);\r\n  }\r\n\r\n  /*\r\n  *åè¡¨æ´ä½æ¯å¦å¯ç¼è¾\r\n   */\r\n  isEditable() {\r\n    if (this.editable === undefined) {\r\n      if (!this.viewModel.stateMachine) {\r\n        // ç¶ææºä¸å­å¨çæ¶å\r\n        return false;\r\n      }\r\n      // ç¶ææºå­å¨çæ¶å\r\n      return this.viewModel.stateMachine['editable'];\r\n    }\r\n    // èªå®ä¹èµå¼\r\n    return this.editable;\r\n  }\r\n  /*  */\r\n  isDataChanged() {\r\n    let hasUnsavedData = false;\r\n    const entityArray = this.viewModel.frameContext.repository.entityCollection.toArray();\r\n    for (const entity of entityArray) {\r\n      if (entity.changes.length > 0) {\r\n        hasUnsavedData = true;\r\n        break;\r\n      }\r\n    }\r\n    return hasUnsavedData;\r\n  }\r\n}\r\n","\r\n/*\r\n * @Author: Witt\r\n * @Date: 2019-04-01 17:26:50\r\n * @Last Modified by: aalizzwell\r\n * @Last Modified time: 2019-12-12 16:17:06\r\n */\r\nimport { FrameContext } from '@farris/devkit';\r\nimport { TreeNode, TreeTableComponent } from '@farris/ui-treetable';\r\nimport { PathHierarchyInfo } from './types';\r\n// tslint:disable: no-string-literal\r\n/**\r\n * æ èç¹æé å¨\r\n * @summary\r\n * å°BindingDataä¸­çæ°æ®éåè½¬æ¢æTreeTableèç¹éå\r\n */\r\nclass PathTreeNodeBuilder {\r\n  private levelGroup: { [level: string]: any[] } = {};\r\n  private frameContext: FrameContext;\r\n  /**\r\n   * æé å½æ°\r\n   */\r\n  constructor(allNodesData: any[], oldTreeNodes: TreeNode[], primaryKey: string, hierarchyInfoKey: string, context?: any) {\r\n    this.primaryKey = primaryKey;\r\n    this.hierarchyInfoKey = hierarchyInfoKey;\r\n    this.allNodes = [];\r\n    this.allNodesData = allNodesData;\r\n    this.context = context || {};\r\n    this.nodesWaitExpand = [];\r\n    this.nodesShouldExpand = context && context.nodesShouldExpand || [];\r\n    this.frameContext = context && context.frameContext || null;\r\n    this.addTreeLoadCompleteListener(this.onTreeLoadComplete.bind(this));\r\n\r\n    this.initLevelGroup();\r\n    this.allNodesMap = new Map<string, TreeNode>();\r\n    this.allOldNodesMap = new Map<string, TreeNode>();\r\n    this.buildNodesDataMap(oldTreeNodes);\r\n  }\r\n  /**\r\n   * å±å¼è³å±çº§\r\n   * @description -1ä¸ºä¸å±å¼\r\n   */\r\n  private get expandLevel() {\r\n    return this.context && this.context.hasOwnProperty('expandLevel') ? this.context['expandLevel'] : -1;\r\n  }\r\n  private get component(): TreeTableComponent {\r\n    return this.context && this.context['component'];\r\n  }\r\n  private get addTreeLoadCompleteListener() {\r\n    return this.context && this.context['addTreeLoadCompleteListener'] || function (args: any) { };\r\n  }\r\n  /**\r\n   * éè¦å±å¼çèç¹\r\n   */\r\n  private nodesShouldExpand: string[];\r\n  /**\r\n   * ç­å¾å±å¼çèç¹\r\n   * @description èç¹ç»æ\r\n   * ```\r\n   * {id:'xxx',expanded:false}\r\n   * ```\r\n   */\r\n  private nodesWaitExpand: any[] = [];\r\n\r\n  /**\r\n   * ä¸»é®å­æ®µå\r\n   */\r\n  private primaryKey: string;\r\n\r\n  /**\r\n   * åçº§ç å­æ®µå\r\n   */\r\n  private hierarchyInfoKey: string;\r\n\r\n  /**\r\n   * èç¹çæ°æ®éå\r\n   */\r\n  private allNodesData: any[];\r\n\r\n  /**\r\n   * èç¹éå\r\n   */\r\n  private allNodes: TreeNode[];\r\n\r\n  /**\r\n   * ä¸ä¸æ¬¡ç»å®çæ èç¹éåMap\r\n   */\r\n  private allNodesMap: Map<string, TreeNode>;\r\n\r\n  /**\r\n   * ä¸ä¸æ¬¡ç»å®çæ èç¹éåMap\r\n   */\r\n  private allOldNodesMap: Map<string, TreeNode>;\r\n  /**\r\n   * ä¸ä¸æ\r\n   */\r\n  private context: any;\r\n  public updateTreeNode(allNodesData: any, data: any) {\r\n    this.allNodesData = allNodesData;\r\n    this.initLevelGroup();\r\n    this.buildNodesDataMap(data);\r\n  }\r\n  public build(): TreeNode[] {\r\n    const tree: TreeNode[] = [];\r\n    const childrenOf = {};\r\n    const nodes = {};\r\n    this.allNodesData.forEach(item => {\r\n      const id = item.id;\r\n      const parentId = this.getParentId(item);\r\n\r\n      // item.parentId = parentId;\r\n      // å±å¼æ°å¢èç¹çç¶èç¹\r\n      const isNewNode = this.isNewNode(item);\r\n      if (isNewNode === true) {\r\n        this.expandParentNode(item);\r\n      }\r\n      // æé æ èç¹\r\n      const node = this.buildNode(item);\r\n      nodes[id] = node;\r\n      childrenOf[id] = childrenOf[id] || [];\r\n      node.children = childrenOf[id];\r\n\r\n      this.allNodesMap.set(item[this.primaryKey], node);\r\n      if (parentId) {\r\n        if (nodes[parentId] && nodes[parentId].unstableState === true) {\r\n          nodes[parentId].expanded = true;\r\n          nodes[parentId].unstableState = false;\r\n        }\r\n        childrenOf[parentId] = childrenOf[parentId] || [];\r\n        childrenOf[parentId].push(node);\r\n      } else {\r\n        if ((!node.children || node.children.length < 1) && node.expanded === true) {\r\n          node.unstableState = true;\r\n          node.expanded = false;\r\n        }\r\n        tree.push(node);\r\n      }\r\n    });\r\n    return tree;\r\n  }\r\n  /**\r\n   * æé æ èç¹\r\n   */\r\n  public build1(): TreeNode[] {\r\n    let minLayer;\r\n    // è·åæé¡¶çº§èç¹çlayer\r\n    this.allNodesData.forEach(node => {\r\n      const hierarchyInfo = this.getHierarchyInfo(node);\r\n      if (hierarchyInfo) {\r\n        const layer = hierarchyInfo['layer'];\r\n        if (!isNaN(layer)) {\r\n          if (minLayer === undefined) {\r\n            minLayer = layer;\r\n          } else if (layer < minLayer) {\r\n            minLayer = layer;\r\n          }\r\n        }\r\n      }\r\n    });\r\n    const topLayer = minLayer - 1;\r\n    this.buildNodes('', topLayer, this.allNodesData, this.allNodes);\r\n    return this.allNodes;\r\n  }\r\n\r\n  /**\r\n   * æé æ èç¹éå\r\n   */\r\n  private buildNodes(fPath: string, fLayer: number, allNodesData: any[], treeNodes: TreeNode[]): void {\r\n    const childNodesData = this.getChildNodesData(fPath, fLayer);\r\n    childNodesData.forEach((nodeData: any) => {\r\n      // å±å¼æ°å¢èç¹çç¶èç¹\r\n      const isNewNode = this.isNewNode(nodeData);\r\n      if (isNewNode === true) {\r\n        this.expandParentNode(nodeData);\r\n      }\r\n\r\n      // æé æ èç¹\r\n      const node = this.buildNode(nodeData);\r\n      treeNodes.push(node);\r\n      this.allNodesMap.set(nodeData[this.primaryKey], node);\r\n\r\n      // éå½éåä¸çº§èç¹\r\n      const hierarchyInfo = this.getHierarchyInfo(nodeData);//nodeData[this.hierarchyInfoKey];\r\n      const currentLayer = hierarchyInfo['layer'];\r\n      const currentPath = hierarchyInfo['path'];\r\n      this.buildNodes(currentPath, currentLayer, allNodesData, node.children as TreeNode[]);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * åå»ºæ èç¹\r\n   */\r\n  private buildNode(nodeData: any): TreeNode & { unstableState?: boolean } {\r\n    const isLeaf = this.isLeaf(nodeData);\r\n    // è·åèç¹çå±å¼ç¶æ\r\n    const shouldExpand = this.shouldExpand(nodeData);\r\n    // èç¹è½ç¶åºè¯¥å±å¼ï¼ä½å¯è½æ¯å ä¸ºä¹åå°±æ¯å±å¼ç¶æï¼æä»¥åºè¯¥æ£æ¥èç¹ä¹åçç¶æ\r\n    const originExpandStatus = this.isExpanded(nodeData);\r\n    // å¦æåºè¯¥å±å¼è¯¥èç¹ï¼ä½æ¯è¯¥èç¹ä¹åæç¶æï¼é£ä¹è¯¥èç¹ä¸åºè¯¥åç±ç¨åºå±å¼ã\r\n    if (!originExpandStatus && shouldExpand) {\r\n      this.expandNode(nodeData);\r\n    }\r\n    const paginationInfo = this.buildPaginationInfo(nodeData);\r\n    const treeNode: TreeNode = {\r\n      data: Object.assign({}, nodeData),\r\n      children: [],\r\n      expanded: shouldExpand,\r\n      leaf: isLeaf\r\n    };\r\n    if (paginationInfo) {\r\n      treeNode.pagination = paginationInfo;\r\n    }\r\n    return treeNode;\r\n  }\r\n  /**\r\n   * æé åé¡µä¿¡æ¯\r\n   * @param nodeData nodeData\r\n   * @returns \r\n   */\r\n  private buildPaginationInfo(nodeData: any): { pageIndex: number, pageSize: number, total: number } | null {\r\n    let result = null;\r\n    if (this.frameContext) {\r\n      const id = this.getPrimary(nodeData);\r\n      // è·ååé¡µä¿¡æ¯\r\n      const key = `_NODE_${id}_PAGINATION_INFO_`;\r\n      const pagination = this.frameContext.params.get(key) || null;\r\n      if (pagination && pagination.pageCount > 1) {\r\n        result = {\r\n          pageIndex: pagination.pageIndex,\r\n          pageSize: pagination.pageSize,\r\n          total: pagination.totalCount\r\n        };\r\n      }\r\n    }\r\n    return result;\r\n  }\r\n  /**\r\n   * è®¡ç®èç¹æ¯å¦éè¦å±å¼\r\n   * @param nodeData nodeData\r\n   */\r\n  private shouldExpand(nodeData: any): boolean {\r\n    const [layer, isLeaf] = [this.getNodeLayer(nodeData), this.isLeaf(nodeData)];\r\n    // æ°¸è¿ä¸å±å¼å¶å­èç¹\r\n    if (isLeaf) {\r\n      return false;\r\n    }\r\n    let expanded = this.isExpanded(nodeData);\r\n    if (!expanded) {\r\n      const id = this.getPrimary(nodeData);\r\n      if (this.nodesWaitExpand.findIndex(node => node && node.id === id) > -1) {\r\n        return false;\r\n      }\r\n      if (this.nodesShouldExpand.findIndex(nodeId => nodeId === id) > -1) {\r\n        return true;\r\n      }\r\n      if (this.expandLevel === -1) {\r\n        // -1 ä¸ºä¸å±å¼\r\n        expanded = false;\r\n      } else if (this.expandLevel === 0) {\r\n        // 0 ä¸ºå¨é¨å±å¼\r\n        expanded = true;\r\n      } else {\r\n        // æ²¡æå¯ç¨åå±å è½½ï¼éè¿å±å¼å±çº§ç¡®å®æ¯å¦å±å¼è¯¥èç¹\r\n        expanded = layer <= this.expandLevel;\r\n        // å¦æèç¹åæ¬å­å¨ä¸èç¹æ²¡æå±å¼åä¸å±å¼\r\n        const oldTreeNode = this.getOldNode(nodeData);\r\n        if (oldTreeNode && !oldTreeNode.expanded) {\r\n          expanded = false;\r\n        }\r\n      }\r\n    }\r\n    return expanded;\r\n  }\r\n  /**\r\n   * å±å¼æ èç¹\r\n   * @description å®å¨å è½½æ ä½¿ç¨å±å¼å±æ§å¨buildNodeæ¶å·²ç»å±å¼ï¼æ­¤å½æ°çä¸»è¦ç¨äºå±å¼åçº§å è½½æ \r\n   * @param nodeData nodeData\r\n   */\r\n  private expandNode(nodeData: any) {\r\n    const [path, layer] = [this.getNodePath(nodeData), this.getNodeLayer(nodeData)];\r\n    const childs = this.getChildNodesData(path, layer);\r\n\r\n    // å½åèç¹ä¸æ¯å¶å­èç¹ï¼ä½å¨èç¹æ°æ®ä¸­åæ¾ä¸å°è¯¥èç¹çå­èç¹ï¼åè®¤ä¸ºæ å¯ç¨äºåå±å è½½\r\n    if (!childs || childs.length < 1) {\r\n      // åå±å è½½æ éè¦éè¿è§¦åèç¹å±å¼äºä»¶æå è½½ä¸å±ï¼ç®åæ ä¸è¿ä¸å­å¨è¯¥èç¹ï¼æ æ³ç´æ¥å±å¼ï¼éè¦ç­æ å è½½å®ä¹ååå±å¼\r\n      const id = this.getPrimary(nodeData);\r\n      if (this.nodesWaitExpand.findIndex(node => node && node.id === id) < 0) {\r\n        this.nodesWaitExpand.push({ id, expanded: false });\r\n      }\r\n    }\r\n  }\r\n  /**\r\n   * æ å è½½å®æäºä»¶\r\n   */\r\n  private onTreeLoadComplete() {\r\n    const index = this.nodesWaitExpand.findIndex(node => !node.expanded);\r\n    const nodeData = this.nodesWaitExpand[index] || {};\r\n    const { id } = nodeData;\r\n    if (id) {\r\n      const rowNode = this.component.findRowNode(id);\r\n      if (rowNode) {\r\n        nodeData.expanded = true;\r\n        // if (nodeData && nodeData.node && !nodeData.node.expanded) {\r\n        //   return;\r\n        // }\r\n        this.component.expandNode(id);\r\n      }\r\n    }\r\n  }\r\n  /**\r\n   * è·åä¸»é®\r\n   * @param nodeData nodeData\r\n   */\r\n  private getPrimary(nodeData: any) {\r\n    return nodeData[this.primaryKey];\r\n  }\r\n  // #region å·¥å·æ¹æ³ï¼å¾åç¬å°è£\r\n\r\n  /**\r\n   * è·åå­çº§èç¹çæ°æ®éå\r\n   */\r\n  private getChildNodesData(fPath: string, fLayer: number): any[] {\r\n    const childNodesData = [];\r\n    this.allNodesData.forEach((nodeData: any) => {\r\n\r\n      // @todoï¼å¾å é¤ï¼å¼å®¹æ²¡æhierarchyInfoçæ°æ®\r\n      const hierarchyInfo = this.getHierarchyInfo(nodeData);//this.getValue(nodeData, this.hierarchyInfoKey); /// nodeData[this.hierarchyInfoKey];\r\n      if (!hierarchyInfo) {\r\n        return;\r\n      }\r\n\r\n      // å¹éèç¹\r\n      const currentLayer = hierarchyInfo['layer'];\r\n      const currentPath = hierarchyInfo['path'];\r\n      if ((currentLayer === fLayer + 1) && currentPath && currentPath.startsWith(fPath)) {\r\n        childNodesData.push(nodeData);\r\n      }\r\n    });\r\n    return childNodesData;\r\n  }\r\n\r\n  private getHierarchyInfo(nodeData: any): PathHierarchyInfo {\r\n    return this.getValue(nodeData, this.hierarchyInfoKey);//nodeData[this.hierarchyInfoKey];\r\n  }\r\n\r\n  private initLevelGroup() {\r\n    this.levelGroup = {};\r\n    this.allNodesData.forEach((nodeData) => {\r\n      const hierarchyInfo = this.getHierarchyInfo(nodeData);\r\n      const key = `level${hierarchyInfo.layer}`;\r\n      if (this.levelGroup[key]) {\r\n        this.levelGroup[key].push(nodeData);\r\n      } else {\r\n        this.levelGroup[key] = [nodeData];\r\n      }\r\n    });\r\n  }\r\n  private getParentId(node: any) {\r\n    const hierarchyInfo = this.getHierarchyInfo(node);\r\n    const parentLevelGroup = this.levelGroup[this.getLevelGroupKey(hierarchyInfo.layer - 1)] || [];\r\n    const parent = parentLevelGroup.find(nodeData => {\r\n      const currentHierarchyInfo = this.getHierarchyInfo(nodeData);\r\n      if (currentHierarchyInfo.isDetail === true) {\r\n        return false;\r\n      }\r\n      return hierarchyInfo.path.startsWith(currentHierarchyInfo.path);\r\n    });\r\n    if (parent) {\r\n      return parent.id;\r\n    } else {\r\n      return null;\r\n    }\r\n  }\r\n  private getLevelGroupKey(level: any) {\r\n    return `level${level}`;\r\n  }\r\n  /**\r\n   * æ ¹æ®è·¯å¾è·åæ°æ®\r\n   * @param target target\r\n   * @param path è·¯å¾\r\n   */\r\n  private getValue(target: any, path: string) {\r\n    if (path.indexOf('/') === -1) {\r\n      return target[path];\r\n    }\r\n    const paths: any = path.split('/').filter(p => p);\r\n    if (paths.length < 1) {\r\n      return target;\r\n    }\r\n    return paths.reduce((result, path) => {\r\n      return result && result[path];\r\n    }, target);\r\n  }\r\n  /**\r\n   * è·ååçº§ä¿¡æ¯ä¸­çå±çº§\r\n   * @param nodeData nodeData\r\n   */\r\n  private getNodeLayer(nodeData: any) {\r\n    const hierarchyInfo = this.getHierarchyInfo(nodeData);\r\n    return hierarchyInfo['layer'];\r\n  }\r\n  /**\r\n   * è·ååçº§ä¿¡æ¯ä¸­çè·¯å¾\r\n   * @param nodeData nodeData\r\n   */\r\n  private getNodePath(nodeData: any) {\r\n    const hierarchyInfo = this.getHierarchyInfo(nodeData);\r\n    return hierarchyInfo['path'];\r\n  }\r\n  /**\r\n   * è·åå±å¼ç¶æ\r\n   */\r\n  private isExpanded(newData: any): boolean {\r\n    const oldTreeNode = this.getOldNode(newData);\r\n    return oldTreeNode ? oldTreeNode.expanded : undefined;\r\n  }\r\n\r\n  /**\r\n   * æ¯å¦æ¯å¶å­èç¹\r\n   * @todoï¼æå¡å¨ç«¯å¯¹isDetailçç®åæ²¡æä¸åç«¯åæ­¥ï¼isDetailä¸åç¡®ã\r\n   */\r\n  private isLeaf(nodeData: any): boolean {\r\n    const hierarchyInfo = this.getHierarchyInfo(nodeData);// nodeData[this.hierarchyInfoKey];\r\n    const isDetail = hierarchyInfo['isDetail'];\r\n    return isDetail;\r\n  }\r\n\r\n  /**\r\n   * å¤æ­èç¹æ¯å¦æ¯æ°å¢\r\n   * @todoï¼ä¸åºè¯¥è¿æ ·å¤æ­ï¼å¾ä¼åã\r\n   * @summary\r\n   * 1ãéç©ºæ ï¼ç©ºæ è§ä¸ºåæ¬¡å è½½æ°æ®ï¼ï¼\r\n   * 2ãæ¾ä¸å°oldNodeã\r\n   */\r\n  private isNewNode(nodeData: any): boolean {\r\n    if (this.allOldNodesMap.size === 0) {\r\n      return false;\r\n    }\r\n    const oldTreeNode = this.getOldNode(nodeData);\r\n    return oldTreeNode ? false : true;\r\n  }\r\n\r\n  /**\r\n   * å±å¼ç¶èç¹\r\n   */\r\n  private expandParentNode(nodeData: any): void {\r\n    const parentTreeNode = this.getParentNode(nodeData);\r\n    if (!parentTreeNode) {\r\n      return;\r\n    }\r\n    parentTreeNode.leaf = false;\r\n    parentTreeNode.expanded = true;\r\n  }\r\n\r\n  /**\r\n   * æ¥æ¾ç¶èç¹\r\n   */\r\n  private getParentNode(nodeData: any): TreeNode {\r\n    const hierarchyInfo = this.getHierarchyInfo(nodeData);//nodeData[this.hierarchyInfoKey];\r\n    const layer = hierarchyInfo['layer'];\r\n    const path = hierarchyInfo['path'];\r\n\r\n    const allNodes = Array.from(this.allNodesMap.values());\r\n    const parentNode = allNodes.find((currentNode: TreeNode) => {\r\n      const currentLayer = this.getValue(currentNode.data, this.hierarchyInfoKey)['layer'];//currentNode.data[this.hierarchyInfoKey]['layer'];\r\n      const currentPath = this.getValue(currentNode.data, this.hierarchyInfoKey)['path'];//  currentNode.data[this.hierarchyInfoKey]['path'];\r\n      if ((layer === currentLayer + 1) && path.startsWith(currentPath) === true) {\r\n        return true;\r\n      }\r\n      return false;\r\n    });\r\n    return parentNode;\r\n  }\r\n\r\n  /**\r\n   * è·åèçæ èç¹\r\n   */\r\n  private getOldNode(nodeData: any): TreeNode {\r\n    const id = nodeData[this.primaryKey];\r\n    return this.allOldNodesMap.get(id);\r\n  }\r\n\r\n  /**\r\n   * æå¹³TreeNodesï¼å¹¶æ¾å¥ä¸ä¸ªMapä¸­\r\n   */\r\n  private buildNodesDataMap(treeNodes: TreeNode[]): void {\r\n    treeNodes.forEach((treeNode: TreeNode) => {\r\n      this.allOldNodesMap.set(treeNode.data[this.primaryKey], treeNode);\r\n      if (treeNode.children) {\r\n        this.buildNodesDataMap(treeNode.children);\r\n      }\r\n    });\r\n  }\r\n\r\n  // #endregion\r\n}\r\n\r\nexport { PathTreeNodeBuilder };\r\n","/*\r\n * @Author: aalizzwell \r\n * @Date: 2019-05-31 09:48:10 \r\n * @Last Modified by: aalizzwell\r\n * @Last Modified time: 2019-06-24 17:00:58\r\n */\r\n\r\nimport { FrameContext } from '@farris/devkit';\r\nimport { TreeNode, TreeTableComponent } from '@farris/ui-treetable';\r\nimport { ParentHierarchyInfo } from './types';\r\n// tslint:disable: no-string-literal max-line-length\r\n/**\r\n * æ èç¹æé å¨\r\n * @summary\r\n * å°BindingDataä¸­çæ°æ®éåè½¬æ¢æTreeTableèç¹éå\r\n */\r\nclass ParentTreeNodeBuilder {\r\n  private frameContext: FrameContext;\r\n  /**\r\n   * æé å½æ°\r\n   */\r\n  constructor(allNodesData: any[], oldTreeNodes: TreeNode[], primaryKey: string, hierarchyInfoKey: string, context?: any) {\r\n    this.primaryKey = primaryKey;\r\n    this.hierarchyInfoKey = hierarchyInfoKey;\r\n    this.allNodes = [];\r\n    this.allNodesData = allNodesData;\r\n    this.context = context || {};\r\n    this.nodesWaitExpand = [];\r\n    this.nodesShouldExpand = context && context.nodesShouldExpand || [];\r\n    this.frameContext = context && context.frameContext || null;\r\n    this.addTreeLoadCompleteListener(this.onTreeLoadComplete.bind(this));\r\n\r\n    this.allNodesMap = new Map<string, TreeNode>();\r\n    this.allOldNodesMap = new Map<string, TreeNode>();\r\n    this.buildNodesDataMap(oldTreeNodes);\r\n  }\r\n  /**\r\n   * å±å¼è³å±çº§\r\n   * @description -1ä¸ºä¸å±å¼\r\n   */\r\n  private get expandLevel() {\r\n    return this.context && this.context.hasOwnProperty('expandLevel') ? this.context['expandLevel'] : -1;\r\n  }\r\n  private get component(): TreeTableComponent {\r\n    return this.context && this.context['component'];\r\n  }\r\n  private get addTreeLoadCompleteListener() {\r\n    return this.context && this.context['addTreeLoadCompleteListener'] || function (args: any) { };\r\n  }\r\n  /**\r\n   * éè¦å±å¼çèç¹\r\n   */\r\n  private nodesShouldExpand: string[];\r\n\r\n  /**\r\n   * ç­å¾å±å¼çèç¹\r\n   * @description èç¹ç»æ\r\n   * ```\r\n   * {id:'xxx',expanded:false}\r\n   * ```\r\n   */\r\n  private nodesWaitExpand: any[] = [];\r\n\r\n  /**\r\n   * ä¸»é®å­æ®µå\r\n   */\r\n  private primaryKey: string;\r\n\r\n  /**\r\n   * åçº§ç å­æ®µå\r\n   */\r\n  private hierarchyInfoKey: string;\r\n\r\n  /**\r\n   * èç¹çæ°æ®éå\r\n   */\r\n  private allNodesData: any[];\r\n\r\n  /**\r\n   * èç¹éå\r\n   */\r\n  private allNodes: TreeNode[];\r\n\r\n  /**\r\n   * ä¸ä¸æ¬¡ç»å®çæ èç¹éåMap\r\n   */\r\n  private allNodesMap: Map<string, TreeNode>;\r\n\r\n  /**\r\n   * ä¸ä¸æ¬¡ç»å®çæ èç¹éåMap\r\n   */\r\n  private allOldNodesMap: Map<string, TreeNode>;\r\n\r\n  /**\r\n   * ä¸ä¸æ\r\n   */\r\n  private context: any;\r\n\r\n  public updateTreeNode(allNodesData: any, data: any) {\r\n    this.allNodesData = allNodesData;\r\n    this.buildNodesDataMap(data);\r\n  }\r\n  public build(): TreeNode[] {\r\n    let tree: TreeNode[] = [];\r\n    const childrenOf = {};\r\n    const parents = {};\r\n    const nodes = {};\r\n    this.allNodesData.forEach(item => {\r\n      const id = item.id;\r\n      const parentId = this.getHierarchyInfo(item).parentElement;\r\n\r\n      // item.parentId = parentId;\r\n      // å±å¼æ°å¢èç¹çç¶èç¹\r\n      const isNewNode = this.isNewNode(item);\r\n      if (isNewNode === true) {\r\n        this.expandParentNode(item);\r\n      }\r\n      // æé æ èç¹\r\n      const node = this.buildNode(item);\r\n      nodes[id] = node;\r\n      childrenOf[id] = childrenOf[id] || [];\r\n      node.children = childrenOf[id];\r\n\r\n      parents[parentId] = parents[parentId] || [];\r\n      parents[parentId].push(node);\r\n      this.allNodesMap.set(item[this.primaryKey], node);\r\n      if (parentId) {\r\n        if (nodes[parentId] && nodes[parentId].unstableState === true) {\r\n          nodes[parentId].expanded = true;\r\n          nodes[parentId].unstableState = false;\r\n        }\r\n        childrenOf[parentId] = childrenOf[parentId] || [];\r\n        childrenOf[parentId].push(node);\r\n      } else {\r\n        if ((!node.children || node.children.length < 1) && node.expanded === true) {\r\n          node.unstableState = true;\r\n          node.expanded = false;\r\n        }\r\n        tree.push(node);\r\n      }\r\n    });\r\n    // ææèç¹é½æ¯parentIdï¼æ²¡æè¿åæ ¹èç¹\r\n    if ((!tree || tree.length < 1) && this.allNodesData && this.allNodesData.length > 0) {\r\n      const parentIds = Object.keys(parents);\r\n      parentIds.forEach(parentId => {\r\n        if (!this.allNodesData.find(item => item.id === parentId)) {\r\n          tree = tree.concat(parents[parentId]);\r\n        }\r\n      });\r\n    }\r\n    return tree;\r\n  }\r\n  /**\r\n   * æé æ èç¹\r\n   */\r\n  public build1(): TreeNode[] {\r\n    let minLayer;\r\n    // è·åæé¡¶çº§èç¹çlayer\r\n    this.allNodesData.forEach(node => {\r\n      const hierarchyInfo = this.getHierarchyInfo(node);\r\n      if (hierarchyInfo) {\r\n        const layer = hierarchyInfo['layer'];\r\n        if (!isNaN(layer)) {\r\n          if (minLayer === undefined) {\r\n            minLayer = layer;\r\n          } else if (layer < minLayer) {\r\n            minLayer = layer;\r\n          }\r\n        }\r\n      }\r\n    });\r\n    const topLayer = minLayer - 1;\r\n    this.buildNodes('', topLayer, this.allNodesData, this.allNodes);\r\n    return this.allNodes;\r\n  }\r\n\r\n  /**\r\n   * æé æ èç¹éå\r\n   */\r\n  private buildNodes(fParentElement: string, fLayer: number, allNodesData: any[], treeNodes: TreeNode[]): void {\r\n    const childNodesData = this.getChildNodesData(fParentElement, fLayer);\r\n    childNodesData.forEach((nodeData: any) => {\r\n\r\n      // å±å¼æ°å¢èç¹çç¶èç¹\r\n      const isNewNode = this.isNewNode(nodeData);\r\n      if (isNewNode === true) {\r\n        this.expandParentNode(nodeData);\r\n      }\r\n\r\n      // æé æ èç¹\r\n      const node = this.buildNode(nodeData);\r\n      treeNodes.push(node);\r\n      this.allNodesMap.set(nodeData[this.primaryKey], node);\r\n\r\n      // éå½éåä¸çº§èç¹\r\n      const hierarchyInfo = this.getHierarchyInfo(nodeData); //nodeData[this.hierarchyInfoKey];\r\n      const currentLayer = hierarchyInfo['layer'];\r\n      const currentId = nodeData[this.primaryKey];\r\n      this.buildNodes(currentId, currentLayer, allNodesData, node.children as TreeNode[]);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * åå»ºæ èç¹\r\n   */\r\n  private buildNode(nodeData: any): TreeNode & { unstableState?: boolean } {\r\n    const isLeaf = this.isLeaf(nodeData);\r\n    // è·åèç¹çå±å¼ç¶æ\r\n    const shouldExpand = this.shouldExpand(nodeData);\r\n    // èç¹è½ç¶åºè¯¥å±å¼ï¼ä½å¯è½æ¯å ä¸ºä¹åå°±æ¯å±å¼ç¶æï¼æä»¥åºè¯¥æ£æ¥èç¹ä¹åçç¶æ\r\n    const originExpandStatus = this.isExpanded(nodeData);\r\n    // å¦æåºè¯¥å±å¼è¯¥èç¹ï¼ä½æ¯è¯¥èç¹ä¹åæç¶æï¼é£ä¹è¯¥èç¹ä¸åºè¯¥åç±ç¨åºå±å¼ã\r\n    if (!originExpandStatus && shouldExpand) {\r\n      this.expandNode(nodeData);\r\n    }\r\n    const paginationInfo = this.buildPaginationInfo(nodeData);\r\n    const treeNode: TreeNode = {\r\n      data: Object.assign({}, nodeData),\r\n      children: [],\r\n      expanded: shouldExpand,\r\n      leaf: isLeaf\r\n    };\r\n    if (paginationInfo) {\r\n      treeNode.pagination = paginationInfo;\r\n    }\r\n    return treeNode;\r\n  }\r\n  /**\r\n   * æé åé¡µä¿¡æ¯\r\n   * @param nodeData nodeData\r\n   * @returns \r\n   */\r\n  private buildPaginationInfo(nodeData: any): { pageIndex: number, pageSize: number, total: number } | null {\r\n    let result = null;\r\n    if (this.frameContext) {\r\n      const id = this.getPrimary(nodeData);\r\n      // è·ååé¡µä¿¡æ¯\r\n      const key = `_NODE_${id}_PAGINATION_INFO_`;\r\n      const pagination = this.frameContext.params.get(key) || null;\r\n      if (pagination && pagination.pageCount > 1) {\r\n        result = {\r\n          pageIndex: pagination.pageIndex,\r\n          pageSize: pagination.pageSize,\r\n          total: pagination.totalCount\r\n        };\r\n      }\r\n    }\r\n    return result;\r\n  }\r\n  /**\r\n   * è®¡ç®èç¹æ¯å¦è¦å±å¼\r\n   * @param nodeData nodeData\r\n   */\r\n  private shouldExpand(nodeData: any) {\r\n    const [isLeaf, layer] = [this.isLeaf(nodeData), this.getNodeLayer(nodeData)];\r\n    // æ°¸è¿ä¸å±å¼å¶å­èç¹\r\n    if (isLeaf) {\r\n      return false;\r\n    }\r\n    let expanded = this.isExpanded(nodeData);\r\n    if (!expanded) {\r\n      const id = this.getPrimary(nodeData);\r\n      if (this.nodesWaitExpand.findIndex(node => node && node.id === id) > -1) {\r\n        return false;\r\n      }\r\n      if (this.nodesShouldExpand.findIndex(nodeId => nodeId === id) > -1) {\r\n        return true;\r\n      }\r\n      if (this.expandLevel === -1) {\r\n        // -1 ä¸ºä¸å±å¼\r\n        expanded = false;\r\n      } else if (this.expandLevel === 0) {\r\n        // 0 ä¸ºå¨é¨å±å¼\r\n        expanded = true;\r\n      } else {\r\n        // æ²¡æå¯ç¨åå±å è½½ï¼éè¿å±å¼å±çº§ç¡®å®æ¯å¦å±å¼è¯¥èç¹\r\n        expanded = layer <= this.expandLevel;\r\n        // å¦æèç¹åæ¬å­å¨ä¸èç¹æ²¡æå±å¼åä¸å±å¼\r\n        const oldTreeNode = this.getOldNode(nodeData);\r\n        if (oldTreeNode && !oldTreeNode.expanded) {\r\n          expanded = false;\r\n        }\r\n      }\r\n    }\r\n    return expanded;\r\n  }\r\n  /**\r\n   * å±å¼æ èç¹\r\n   * @description å®å¨å è½½æ ä½¿ç¨å±å¼å±æ§å¨buildNodeæ¶å·²ç»å±å¼ï¼æ­¤å½æ°çä¸»è¦ç¨äºå±å¼åçº§å è½½æ \r\n   * @param nodeData nodeData\r\n   */\r\n  private expandNode(nodeData: any) {\r\n    const [element, layer] = [nodeData[this.primaryKey], this.getNodeLayer(nodeData)];\r\n    const childs = this.getChildNodesData(element, layer);\r\n\r\n    // å½åèç¹ä¸æ¯å¶å­èç¹ï¼ä½å¨èç¹æ°æ®ä¸­åæ¾ä¸å°è¯¥èç¹çå­èç¹ï¼åè®¤ä¸ºæ å¯ç¨äºåå±å è½½\r\n    if (!childs || childs.length < 1) {\r\n      // åå±å è½½æ éè¦éè¿è§¦åèç¹å±å¼äºä»¶æå è½½ä¸å±,ç®åæ ä¸è¿ä¸å­å¨è¯¥èç¹ï¼æ æ³ç´æ¥å±å¼ï¼éè¦ç­æ å è½½å®ä¹ååå±å¼\r\n      const id = this.getPrimary(nodeData);\r\n      if (this.nodesWaitExpand.findIndex(node => node && node.id === id) < 0) {\r\n        this.nodesWaitExpand.push({ id, expanded: false });\r\n      }\r\n    }\r\n  }\r\n  /**\r\n   * æ å è½½å®æäºä»¶\r\n   */\r\n  private onTreeLoadComplete() {\r\n    const index = this.nodesWaitExpand.findIndex(node => !node.expanded);\r\n    const nodeData = this.nodesWaitExpand[index] || {};\r\n    const { id } = nodeData;\r\n    if (id) {\r\n      const rowNode = this.component.findRowNode(id);\r\n      if (rowNode) {\r\n        nodeData.expanded = true;\r\n        // if (nodeData && nodeData.node && !nodeData.node.expanded) {\r\n        //   return;\r\n        // }\r\n        this.component.expandNode(id);\r\n      }\r\n    }\r\n  }\r\n  /**\r\n   * è·åä¸»é®\r\n   * @param nodeData nodeData\r\n   */\r\n  private getPrimary(nodeData: any) {\r\n    return nodeData[this.primaryKey];\r\n  }\r\n  // #region å·¥å·æ¹æ³ï¼å¾åç¬å°è£\r\n\r\n  /**\r\n   * è·åå­çº§èç¹çæ°æ®éå\r\n   */\r\n  private getChildNodesData(fParentElement: string, fLayer: number): any[] {\r\n    const childNodesData = [];\r\n    this.allNodesData.forEach((nodeData: any) => {\r\n\r\n      // @todoï¼å¾å é¤ï¼å¼å®¹æ²¡æhierarchyInfoçæ°æ® \r\n      const hierarchyInfo = this.getHierarchyInfo(nodeData); //nodeData[this.hierarchyInfoKey];\r\n      if (!hierarchyInfo) {\r\n        return;\r\n      }\r\n\r\n      // å¹éèç¹\r\n      const currentLayer = hierarchyInfo['layer'];\r\n      const currentParentElement = hierarchyInfo['parentElement'];\r\n      if ((currentLayer === fLayer + 1) && (currentParentElement === fParentElement || (!currentParentElement && fParentElement === ''))) {\r\n        childNodesData.push(nodeData);\r\n      }\r\n    });\r\n    return childNodesData;\r\n  }\r\n  private getHierarchyInfo(nodeData: any): ParentHierarchyInfo {\r\n    return this.getValue(nodeData, this.hierarchyInfoKey);//nodeData[this.hierarchyInfoKey];\r\n  }\r\n  private getValue(target: any, path: string) {\r\n    if (path.indexOf('/') === -1) {\r\n      return target[path];\r\n    }\r\n    const paths: any = path.split('/').filter(p => p);\r\n    return paths.reduce((result, path) => {\r\n      return result && result[path];\r\n    }, target);\r\n  }\r\n  /**\r\n   * è·ååçº§ä¿¡æ¯ä¸­çå±çº§\r\n   * @param nodeData nodeData\r\n   */\r\n  private getNodeLayer(nodeData: any) {\r\n    const hierarchyInfo = this.getHierarchyInfo(nodeData);\r\n    return hierarchyInfo['layer'];\r\n  }\r\n  /**\r\n   * è·ååçº§ä¿¡æ¯ä¸­çç¶èç¹\r\n   * @param nodeData nodeData\r\n   */\r\n  private getNodeParentElement(nodeData: any) {\r\n    const hierarchyInfo = this.getHierarchyInfo(nodeData);\r\n    return hierarchyInfo['parentElement'];\r\n  }\r\n  /**\r\n   * è·åå±å¼ç¶æ\r\n   */\r\n  private isExpanded(newData: any): boolean {\r\n    const oldTreeNode = this.getOldNode(newData);\r\n    return oldTreeNode ? oldTreeNode.expanded : undefined;\r\n  }\r\n\r\n  /**\r\n   * æ¯å¦æ¯å¶å­èç¹\r\n   * @todoï¼åºè¯¥ç¨æ°æ®æ¬èº«çisDetailæ¥ä¿è¯ï¼ä½ç®åä¸åç¡®ï¼å¼ºå¶åç«¯è®¡ç®\r\n   */\r\n  private isLeaf(nodeData: any): boolean {\r\n    const hierarchyInfo = this.getHierarchyInfo(nodeData);//nodeData[this.hierarchyInfoKey];\r\n    const isDetail = hierarchyInfo['isDetail'];\r\n    return isDetail;\r\n  }\r\n\r\n  /**\r\n   * å¤æ­èç¹æ¯å¦æ¯æ°å¢\r\n   * @todoï¼ä¸åºè¯¥è¿æ ·å¤æ­ï¼å¾ä¼åã\r\n   * @summary\r\n   * 1ãéç©ºæ ï¼ç©ºæ è§ä¸ºåæ¬¡å è½½æ°æ®ï¼ï¼\r\n   * 2ãæ¾ä¸å°oldNodeã\r\n   */\r\n  private isNewNode(nodeData: any): boolean {\r\n    if (this.allOldNodesMap.size === 0) {\r\n      return false;\r\n    }\r\n    const oldTreeNode = this.getOldNode(nodeData);\r\n    return oldTreeNode ? false : true;\r\n  }\r\n\r\n  /**\r\n   * å±å¼ç¶èç¹\r\n   */\r\n  private expandParentNode(nodeData: any): void {\r\n    const parentTreeNode = this.getParentNode(nodeData);\r\n    if (!parentTreeNode) {\r\n      return;\r\n    }\r\n    parentTreeNode.leaf = false;\r\n    parentTreeNode.expanded = true;\r\n  }\r\n\r\n  /**\r\n   * æ¥æ¾ç¶èç¹\r\n   */\r\n  private getParentNode(nodeData: any): TreeNode {\r\n    const hierarchyInfo = this.getHierarchyInfo(nodeData);//nodeData[this.hierarchyInfoKey];\r\n    const layer = hierarchyInfo['layer'];\r\n    const parentElement = hierarchyInfo['parentElement'];\r\n\r\n    const allNodes = Array.from(this.allNodesMap.values());\r\n    const parentNode = allNodes.find((node: TreeNode) => {\r\n      const currentLayer = this.getValue(node.data, this.hierarchyInfoKey)['layer']; //node.data[this.hierarchyInfoKey]['layer'];\r\n      const currentId = node.data[this.primaryKey];\r\n      return currentId === parentElement && layer === (currentLayer + 1);\r\n    });\r\n\r\n    return parentNode;\r\n  }\r\n\r\n  /**\r\n   * è·åèçæ èç¹\r\n   */\r\n  private getOldNode(nodeData: any): TreeNode {\r\n    const id = nodeData[this.primaryKey];\r\n    return this.allOldNodesMap.get(id);\r\n  }\r\n\r\n  /**\r\n   * æå¹³TreeNodesï¼å¹¶æ¾å¥ä¸ä¸ªMapä¸­\r\n   */\r\n  private buildNodesDataMap(treeNodes: TreeNode[]): void {\r\n    treeNodes.forEach((treeNode: TreeNode) => {\r\n      this.allOldNodesMap.set(treeNode.data[this.primaryKey], treeNode);\r\n      if (treeNode.children) {\r\n        this.buildNodesDataMap(treeNode.children);\r\n      }\r\n    });\r\n  }\r\n\r\n  // #endregion\r\n}\r\n\r\nexport { ParentTreeNodeBuilder };\r\n\r\n","/*\r\n * @Author: aalizzwell \r\n * @Date: 2019-05-30 18:57:34 \r\n * @Last Modified by:   aalizzwell \r\n * @Last Modified time: 2019-05-30 18:57:34 \r\n */\r\nimport { PathTreeNodeBuilder } from './path_tree_node_builder';\r\nimport { ParentTreeNodeBuilder } from './parent_tree_node_builder';\r\nimport { Type } from '@angular/core';\r\n\r\nexport class TreeNodeBuilderFactory {\r\n    static getBuilder(hierarchyInfo: { [propName: string]: any }): Type<PathTreeNodeBuilder | ParentTreeNodeBuilder> {\r\n        let builder: Type<PathTreeNodeBuilder | ParentTreeNodeBuilder> = PathTreeNodeBuilder;\r\n        if (hierarchyInfo.hasOwnProperty(\"path\")) {\r\n            builder = PathTreeNodeBuilder;\r\n        } else if (hierarchyInfo.hasOwnProperty(\"parentElement\")) {\r\n            builder = ParentTreeNodeBuilder;\r\n        }\r\n\r\n        return builder;\r\n    }\r\n}","/*\r\n * @Author: aalizzwell \r\n * @Date: 2020-02-27 11:33:41 \r\n * @Last Modified by: aalizzwell\r\n * @Last Modified time: 2020-02-27 11:34:16\r\n */\r\n// tslint:disable: no-string-literal\r\n\r\nimport { Directive, OnInit, OnChanges, SimpleChanges, Input, HostListener, Type, Output, EventEmitter } from '@angular/core';\r\nimport { BindingData, BindingList, FrameContext, Change, ChangeType, ComponentType } from '@farris/devkit';\r\nimport { TreeTableComponent, TreeNode } from '@farris/ui-treetable';\r\nimport { Subject } from 'rxjs';\r\nimport { debounceTime } from 'rxjs/operators';\r\nimport { FarrisTreetableFormatService } from '../format/index';\r\nimport { TreeNodeBuilderFactory } from './tree_table_node_builder/tree_node_builder_factory';\r\n\r\n/**\r\n * æ è¡¨æ ¼ç»å®æä»¤\r\n */\r\n@Directive({\r\n  selector: '[farrisTreeTableBinding]'\r\n})\r\nclass FarrisTreeTableBindingDirective implements OnInit, OnChanges {\r\n  /**\r\n   * æ å­å¨ç©ºé´\r\n   */\r\n  private storage: any;\r\n  private renderSubject: Subject<any> = new Subject<any>();\r\n  private builder: Type<any>;\r\n  private treeNodesBuilder: any;\r\n  /**\r\n   * åçº§ç ä¿¡æ¯çkey\r\n   */\r\n  // tslint:disable-next-line: no-input-rename\r\n  @Input('farrisHierarchyInfoKey')\r\n  public hierarchyInfoKey: string;\r\n\r\n  /* è¡æ ·å¼ */\r\n  @Input()\r\n  rowClassName: (context: any) => any;\r\n\r\n  /* ååååæ ¼æ ·å¼ */\r\n  @Input()\r\n  cellClassName: (data: any, field: any) => any;\r\n  /**\r\n   * å¯ç¨èç¹åé¡µ\r\n   */\r\n  // @Input('enableNodePagination')\r\n  // public enableNodePagination: boolean;\r\n  /**\r\n   * èç¹åé¡µå¤§å°\r\n   */\r\n  @Input('nodePageSize')\r\n  public nodePageSize: number = 100;\r\n  /**\r\n   * ç»å®æ°æ®\r\n   */\r\n  private get bindingData(): BindingData {\r\n    return this.frameContext.bindingData;\r\n  }\r\n\r\n  /**\r\n   * ç»å®æ°æ®åè¡¨\r\n   */\r\n  private get bindingList(): BindingList {\r\n\r\n    // @todoï¼åªæ¯æä¸»è¡¨ï¼æ²¡æå¤çbindingPath\r\n    return this.bindingData.list;\r\n  }\r\n\r\n\r\n  /* è®¾ç½®è¡æ ·å¼ */\r\n  @Output()\r\n  rowClass: EventEmitter<any> = new EventEmitter<any>();\r\n\r\n  /* è®¾ç½®åæ ·å¼ */\r\n  @Output()\r\n  cellClass: EventEmitter<any> = new EventEmitter<any>();\r\n\r\n  private _PROP: any = null;\r\n  private listeners: any[];\r\n  private get prop() {\r\n    return this._PROP;\r\n  }\r\n  private set prop(value) {\r\n    this._PROP = value;\r\n  }\r\n  /**\r\n   * è·åå½åvm\r\n   */\r\n  private get viewModel() {\r\n    return this.frameContext.viewModel;\r\n  }\r\n  /**\r\n   * æé å½æ°\r\n   */\r\n  constructor(\r\n    private treeTable: TreeTableComponent,\r\n    private treetableFormatSer: FarrisTreetableFormatService,\r\n    private frameContext: FrameContext\r\n  ) {\r\n    this.listeners = [];\r\n    this.storage = [];\r\n    this.viewModel.uiState.setPropertyValue('ids', this.treeTable.checkValues);\r\n    this.renderSubject.pipe(\r\n      debounceTime(500)\r\n    ).subscribe(() => {\r\n      this.bindData();\r\n    });\r\n\r\n  }\r\n\r\n  /**\r\n   * æä»¤åå§å\r\n   */\r\n  ngOnInit() {\r\n    // å°åçº§ç ä¿¡æ¯ä¿å­å°root-componentï¼èéæ´ä¸ªè¡¨åçapp-context\r\n    const virtualRootFrameContext = this.frameContext.getVirtualRootFrameContext();\r\n    virtualRootFrameContext.setParam('hierarchyInfoKey', this.hierarchyInfoKey);\r\n    this.bindData();\r\n    this.bindingData.changes.subscribe((change: Change) => {\r\n      if (change && (change.type === ChangeType.ValueChanged || change.type === ChangeType.PaginationInfoChange)) {\r\n        this.renderSubject.next(change);\r\n      } else {\r\n        this.bindData();\r\n      }\r\n      // è®¾ç½®å½åè¡\r\n      const currentId = this.bindingList.currentId;\r\n      if (!this.frameContext.bindingData.rowSelectedEventSuspend && currentId) {\r\n        this.setSelectedIdToTree(this.bindingList.currentId);\r\n      }\r\n      this.updateCheckedRows(change);\r\n    });\r\n\r\n    // è®¾ç½® æ è¡¨ æ ¼å¼å\r\n    this.treetableFormatSer.setFormat(this.treeTable);\r\n\r\n    /* è¡æ ·å¼ */\r\n    this.rowClass.emit(this.treeTable);\r\n\r\n    /* åæ ·å¼  ååæ ¼æ ·å¼ */\r\n    this.cellClass.emit(this.treeTable);\r\n    this.setComponentRef();\r\n    this.setNodePaginationInfo();\r\n    this.registerEvent();\r\n    if (this.frameContext && this.frameContext.frameComponent) {\r\n      this.frameContext.frameComponent.componentType = ComponentType.farrisTreeTalbeComponent;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * æä»¤è¾å¥åæ´\r\n   */\r\n  ngOnChanges(changes: SimpleChanges) {\r\n  }\r\n  private registerEvent() {\r\n    this.treeTable.columnSorted.subscribe((event: { sortName: string, sortOrder: string }) => {\r\n      const { sortName = null, sortOrder = null } = event;\r\n      const remoteSort = this.treeTable.remoteSort;\r\n      if (remoteSort === false) {\r\n        if (sortName && sortOrder) {\r\n          this.bindingList.sortBy(sortName, sortOrder);\r\n        }\r\n      }\r\n      this.bindData();\r\n    });\r\n  }\r\n  /**\r\n   * æ¶éæ ç»ä»¶å®ä¾\r\n   */\r\n  private setComponentRef() {\r\n    const appContext = this.viewModel && this.viewModel.frameContext && this.viewModel.frameContext.getFormAppContext();\r\n    const frameId = this.viewModel && this.viewModel.frameContext && this.viewModel.frameContext.frameId;\r\n    const id = this.treeTable && this.treeTable.el.nativeElement.id || null;\r\n    // å¦æframeIdä¸å­å¨ætreetableæ²¡æidå±æ§ï¼è¯´æä¸ç¬¦åä½¿ç¨åºæ¯\r\n    if (!frameId || !id) {\r\n      return;\r\n    }\r\n    const map = appContext && appContext.componentRefs && appContext.componentRefs.get(frameId) || new Map<string, any>();\r\n    appContext && appContext.componentRefs && appContext.componentRefs.set(frameId, map.set(id, this.treeTable));\r\n  }\r\n\r\n  private setNodePaginationInfo() {\r\n    if (this.frameContext) {\r\n      const enableNodePagination = this.treeTable.paginationForChildren || false;//this.enableNodePagination || false;\r\n      this.frameContext.params.set('enableNodePagination', enableNodePagination);\r\n      const nodePageSize = this.nodePageSize || 0;\r\n      this.frameContext.params.set('nodePageSize', nodePageSize);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * ç»å®æ°æ®\r\n   */\r\n  private bindData() {\r\n    const oldTreeNodes = this.treeTable.data;\r\n    const treeNodesData = this.bindingList.toJSON({ ignoreMultiLangInput: true });\r\n    // if (!this.shouldComponentUpdate(treeNodesData)) {\r\n    //   return;\r\n    // }\r\n    this.prop = treeNodesData;\r\n\r\n    let treeNodes: TreeNode[] = [];\r\n    if (!!treeNodesData && treeNodesData.length > 0) {\r\n      const hierarchyInfo = treeNodesData[0][this.hierarchyInfoKey];\r\n      let builder: Type<any> = this.builder;\r\n      if (!builder) {\r\n        this.builder = TreeNodeBuilderFactory.getBuilder(hierarchyInfo);\r\n        builder = this.builder;\r\n      }\r\n      // æå¡å¨è¿åçåçº§èç¹ä¿¡æ¯å¹éä¸å°ç°æå·¥åéé¢çä»»ä½ä¸ç§æåµãç¡®è®¤æ°å çbuilderå·²ç»å¨å·¥åä¸­æ³¨å\r\n      if (builder == null) {\r\n        throw new Error('TreeTable builder is null!');\r\n      }\r\n      let expandLevel = -1;\r\n      const treeExpandLevel = this.treeTable['expandLevel'];\r\n      if (typeof treeExpandLevel !== 'undefined') {\r\n        expandLevel = treeExpandLevel;\r\n      }\r\n      const virtualRootFrameContext = this.frameContext.getVirtualRootFrameContext();\r\n      const nodesShouldExpand = (virtualRootFrameContext.params.get('_DEVKIT_expandRowIds') || '').split(',') || [];\r\n      const context = {\r\n        expandLevel,\r\n        addTreeLoadCompleteListener: this.addTreeLoadCompleteListener.bind(this),\r\n        component: this.treeTable,\r\n        storage: this.storage,\r\n        nodesShouldExpand: nodesShouldExpand,\r\n        frameContext: this.frameContext,\r\n      };\r\n      //if (!this.treeNodesBuilder) {\r\n      this.treeNodesBuilder = new builder(\r\n        treeNodesData, oldTreeNodes,\r\n        this.bindingList.primaryKey, this.hierarchyInfoKey, context\r\n      );\r\n      //}\r\n      // this.treeNodesBuilder.updateTreeNode(treeNodesData, oldTreeNodes);\r\n      treeNodes = this.treeNodesBuilder.build();\r\n    }\r\n    this.treeTable.data = treeNodes;\r\n    // è®¾ç½®åé¡µä¿¡æ¯\r\n    this.updatePageInfo(this.treeTable);\r\n    this.onTreeLoadComplete();\r\n  }\r\n  private onTreeLoadComplete() {\r\n    if (this.listeners && this.listeners.length > 0) {\r\n      this.listeners.forEach(listener => {\r\n        listener();\r\n      });\r\n    }\r\n  }\r\n  private addTreeLoadCompleteListener(listener: any) {\r\n    this.listeners.push(listener);\r\n  }\r\n  private shouldComponentUpdate(newProp: any) {\r\n    if (JSON.stringify(this.prop) === JSON.stringify(newProp)) {\r\n      return false;\r\n    }\r\n    return true;\r\n  }\r\n  /**\r\n   * ä»æ ç»ä»¶ä¸è·åéä¸­è¡çid\r\n   */\r\n  private getSelectedIdFromTree(): string {\r\n    const selectedRow = this.treeTable.selectedRow;\r\n    return selectedRow ? selectedRow.data['id'] : null;\r\n  }\r\n\r\n  /**\r\n   * è®¾ç½®TreeTableçå½åè¡\r\n   */\r\n  private setSelectedIdToTree(selectedId: string): void {\r\n    if (!selectedId) {\r\n      return;\r\n    }\r\n    // å¦ææ°çcurrentIdåæ ä¸çselectedIdä¸ä¸è´ï¼éç½®æ çå½åè¡\r\n    const oldSelectedId = this.getSelectedIdFromTree();\r\n    const nodePageChanged = this.frameContext.params.get('_NODE_PAGE_CHANGED_') || false;\r\n    if (!oldSelectedId && nodePageChanged) {\r\n      this.frameContext.params.delete('_NODE_PAGE_CHANGED_');\r\n      return;\r\n    }\r\n    if (oldSelectedId !== selectedId) {\r\n      this.treeTable.clearSelections();\r\n      this.treeTable.selectNode(selectedId);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * è®¾ç½®BindingListçCurrentId\r\n   */\r\n  private setCurrentIdToBindingList(selectedId: string): void {\r\n    const oldCurrentId = this.bindingData.list.currentId;\r\n    // åéæ¨¡å¼ä¸å°å½åè¡è®¾ç½®å°ids\r\n    if (!this.treeTable.multiSelect) {\r\n      this.setChecks(selectedId);\r\n      this.setCheckedRows([selectedId]);\r\n    }\r\n    if (oldCurrentId === selectedId) {\r\n      return;\r\n    }\r\n    this.bindingData.list.setCurrentId(selectedId, true);\r\n  }\r\n  private updateCheckedRows(changes: Change) {\r\n    if (changes.type === ChangeType.Load) {\r\n      this.setCheckedRows();\r\n    } else if (changes.type === ChangeType.ValueChanged || changes.type === ChangeType.Remove) {\r\n      const ids = this.getChecks();\r\n      if (changes.id && ids.includes(changes.id)) {\r\n        this.setCheckedRows();\r\n      }\r\n    }\r\n  }\r\n  /**\r\n   * æ´æ°å¾éè¡æ°æ®\r\n   */\r\n  protected setCheckedRows(ids?: string[]) {\r\n    if (typeof ids === 'undefined') {\r\n      ids = this.viewModel.uiState['ids'] || [];\r\n    }\r\n    if (!Array.isArray(ids)) {\r\n      return;\r\n    }\r\n    const list = this.bindingList.toJSON();\r\n    const rows: Map<string, any> = this.viewModel.uiState['rows'] || new Map<string, any>();\r\n\r\n    const result = new Map<string, any>();\r\n    ids.forEach((id: any) => {\r\n      const item = list.find(item => item[this.bindingList.primaryKey] === id);\r\n      const otherPageItem = rows.get(id);\r\n      if (item) {\r\n        result.set(id, item);\r\n      } else if (otherPageItem) {\r\n        result.set(id, otherPageItem);\r\n      }\r\n    });\r\n    this.viewModel.uiState.setPropertyValue('rows', result);\r\n  }\r\n  /**\r\n   * è®¾ç½®idsåé\r\n   * @param idOrIds id or ids\r\n   */\r\n  protected setChecks(idOrIds: string | string[]) {\r\n    if (typeof idOrIds === 'string') {\r\n      idOrIds = idOrIds.split(',').filter(p => p);\r\n    }\r\n    this.viewModel.uiState.setPropertyValue('ids', idOrIds);\r\n  }\r\n  /**\r\n   * è·åå¾éè¡idæ°ç»\r\n   * @returns \r\n   */\r\n  protected getChecks(): string[] {\r\n    return this.viewModel.uiState['ids'] || [];\r\n  }\r\n  /**\r\n   * è·ååé¡µä¿¡æ¯\r\n   */\r\n  private getPagingInfo() {\r\n    const bindingPath = this.viewModel.bindingPath;\r\n    const bindingData = this.viewModel.bindingData;\r\n    let pagingInfo = bindingData.pagingInfo;\r\n    if (bindingPath === '/') {\r\n      return pagingInfo;\r\n    } else {\r\n      const bindingPaths = bindingPath.substr(1).split('/').filter(item => !!item && item.length > 0).map(item => {\r\n        return item.substring(0, item.length - 1);\r\n      });\r\n      bindingPaths.forEach(path => {\r\n        pagingInfo = pagingInfo && pagingInfo[path];\r\n      });\r\n      return pagingInfo;\r\n    }\r\n  }\r\n  private updatePageInfo(treeTable: TreeTableComponent) {\r\n    const { pageIndex, pageSize, total } = this.getPagingInfo();\r\n    if (pageSize === 0) {\r\n      treeTable.pagination = false;\r\n      return;\r\n    }\r\n    treeTable.pagination = true;\r\n    treeTable.updatePageInfo({ pageIndex, pageSize, total });\r\n  }\r\n  //#region ç»ä»¶äºä»¶\r\n  /**\r\n   * è¡åæ¢\r\n   */\r\n  @HostListener('nodeSelected', ['$event'])\r\n  public selectionChangeHandler(event: any) {\r\n    if (event && event.node && event.node.hasOwnProperty('data')) {\r\n      const idField = this.treeTable.idField;\r\n      const id = event.node.data[idField];\r\n      this.setCurrentIdToBindingList(id);\r\n    }\r\n  }\r\n  /**\r\n   * å¾éèç¹åçåå\r\n   * @param event event\r\n   */\r\n  @HostListener('checkValuesChange', ['$event'])\r\n  public checkValuesChange(event: any) {\r\n    // this.viewModel.uiState.setPropertyValue('ids', this.treeTable.checkValues);\r\n    this.setChecks(this.treeTable.checkValues);\r\n    this.setCheckedRows();\r\n  }\r\n  /**\r\n   * å°è¢«å±å¼çèç¹è®¾ç½®ä¸ºå½åè¡\r\n   */\r\n  @HostListener('expand', ['$event'])\r\n  public expandHandler(event: any) {\r\n    const selectedId = event.data['id'];\r\n    const virtualRootFrameContext = this.frameContext.getVirtualRootFrameContext();\r\n    // å±å¼æ¶ä¸åéä¸­\r\n    // this.setSelectedIdToTree(selectedId);\r\n    const expandNodes = virtualRootFrameContext.getParam('TREE_LATEST_EXPANDED_ID') || [];\r\n    expandNodes.push(selectedId);\r\n    virtualRootFrameContext.setParam('TREE_LATEST_EXPANDED_ID', expandNodes);\r\n  }\r\n  @HostListener('pageChanged', ['$event'])\r\n  public onPageChanged(event: any) {\r\n    let { pageSize = 20, pageIndex = 1 } = event || {};\r\n    if (pageIndex < 1) {\r\n      pageIndex = 1;\r\n    }\r\n    const skip = (pageIndex - 1) * pageSize;\r\n    this.bindingData.setPagingInfo(skip, pageSize, this.bindingData.bindingPath);\r\n  }\r\n  @HostListener('pageSizeChanged', ['$event'])\r\n  public onPageSizeChanged(event: any) {\r\n    const pageSize = event ? event : 20;\r\n    const skip = 0;\r\n    this.bindingData.setPagingInfo(skip, pageSize, this.bindingData.bindingPath);\r\n  }\r\n  /**\r\n   * èç¹é¡µç åæ¢äºä»¶\r\n   * @param event event\r\n   */\r\n  @HostListener('childsPageChanged', ['$event'])\r\n  public onNodePageChanged(event: any) {\r\n    const { pageIndex = 1, pageSize = this.nodePageSize, node = {} } = event;\r\n    const id = node && node.id || null;\r\n    if (id) {\r\n      const virtualRootFrameContext = this.frameContext.getVirtualRootFrameContext();\r\n      const expandNodes = virtualRootFrameContext.getParam('TREE_LATEST_EXPANDED_ID') || [];\r\n      expandNodes.push(id);\r\n      virtualRootFrameContext.setParam('TREE_LATEST_EXPANDED_ID', expandNodes);\r\n      this.frameContext.params.set(`_NODE_${id}_PAGE_INDEX_`, pageIndex);\r\n      this.frameContext.params.set(`_RELOAD_CHILDREN_`, true);\r\n      this.frameContext.params.set('_NODE_PAGE_CHANGED_', true);\r\n    }\r\n  }\r\n  //#endregion\r\n}\r\n\r\nexport { FarrisTreeTableBindingDirective };\r\n","import { BindingObject, DataPropInfo, DataTypeInfo, ViewModel } from '@farris/devkit';\r\nimport { isNumber } from 'lodash-es';\r\n/**\r\n * å¸®å©æ å°åºç±»\r\n */\r\nexport class DataMapping {\r\n  public vm: ViewModel;\r\n  public target: BindingObject;\r\n  /**\r\n   * å¤éå¸®å©é»è®¤åéç¬¦\r\n   */\r\n  protected readonly defaultSpliter = ',';\r\n  /**\r\n   * æ å°æ°æ®\r\n   * @param helpData æ¸ç©ºæ¶ï¼å¼ä¸ºnull\r\n   * @param mapFields æ ¼å¼å½¢å¦ï¼{id: \"assoField.assoField\", code: \"assoField.assoField_Code\", name: \"assoField.assoField_Name\"}\r\n   * @param asClear ç±»ä¼¼æ¸ç©º\r\n   * @param [spliter=','] å¤éåéç¬¦\r\n   */\r\n  mappingData(helpData: any, mapFields: any, asClear: boolean = false, spliter: string = ',') {\r\n    if (!mapFields) {\r\n      return;\r\n    }\r\n    // å³é­åæ´æ£æµ\r\n    const appContext = this.vm.frameContext.appContext;\r\n    appContext.changeDetectionController.detach();\r\n    let helpFields = Object.keys(mapFields);\r\n    const basePaths = this.getBindingPathArray();\r\n    const primaryInfo = this.getMapFieldsPrimaryKey(mapFields, basePaths);\r\n    // æ å°å°ç®æ ä¸»é®çæºå­æ®µæ°ç»\r\n    const primaryKeys: string[] = primaryInfo && primaryInfo.map((item) => item.primaryKey) || [];\r\n    // ç®æ ä¸»é®å­æ®µæ°ç»\r\n    const primaryFields: string[] = primaryInfo && primaryInfo.map((item) => item.primaryField) || [];\r\n    // å¯¹æ å°ä¸­çkeyè¿è¡æåºï¼ä½¿æ å°å°ç®æ ä¸»é®çkeyæå°åé¢\r\n    helpFields = this.sortMapFieldKeys(helpFields, primaryKeys);\r\n    if (!helpData || asClear) {\r\n      helpFields.reverse();\r\n    }\r\n    this.mapping(helpFields, mapFields, helpData, primaryFields, basePaths, asClear, spliter);\r\n    // éæ°æå¼åæ´æ£æµ\r\n    appContext.changeDetectionController.reattach();\r\n  }\r\n  private mapping(sortedKeyFields: string[], mapFields: any, helpData: any, targetPrimaryFields: string[], basePaths: string[], asClear: boolean = false, spliter = ',') {\r\n    sortedKeyFields.forEach((field: any) => {\r\n      const val = this.getHelpValue(field, helpData, spliter);\r\n      let mappings: any[] = mapFields[field].split(',');\r\n      const headMappings = mappings.filter((p) => targetPrimaryFields.includes(p));\r\n      const leftMappings = mappings.filter((p) => !targetPrimaryFields.includes(p));\r\n      if (!helpData || asClear) {\r\n        mappings = [].concat(leftMappings).concat(headMappings);\r\n      } else {\r\n        mappings = [].concat(headMappings).concat(leftMappings);\r\n      }\r\n      this.updateTarget(mappings, basePaths, helpData, val);\r\n    });\r\n  }\r\n  private updateTarget(mappings: string[], basePaths: string[], helpData: any, value: any) {\r\n    mappings.forEach((targetFieldPath: any) => {\r\n      this.updateTargetValue(basePaths, targetFieldPath, value, helpData);\r\n    });\r\n  }\r\n  private updateTargetValue(basePaths: string[], targetFieldPath, value: any, helpData: any) {\r\n    if (this.target) {\r\n      const paths = targetFieldPath.split('.');\r\n      this.setValue(this.target, paths, value);\r\n    } else {\r\n      const paths = basePaths.concat(targetFieldPath.split('.'));\r\n      if (!helpData) {\r\n        this.vm.bindingData.clearValue(paths, true, true, { frameContext: this.vm.frameContext });\r\n      } else {\r\n        this.vm.bindingData.setValue(paths, value, true, true, null, { frameContext: this.vm.frameContext });\r\n      }\r\n    }\r\n  }\r\n  /**\r\n   * è·åå¸®å©å­æ®µå¯¹åºçå¼\r\n   * @param field å¸®å©å­æ®µ\r\n   * @param helpData å¸®å©æ°æ®\r\n   * @param [spliter=','] å¤éå¸®å©åéç¬¦\r\n   * @returns\r\n   */\r\n  private getHelpValue(field: string, helpData: any, spliter = ',') {\r\n    let value: any = '';\r\n    if (helpData) {\r\n      if (helpData instanceof Array) {\r\n        value = helpData.map((item: any) => {\r\n          return this.getValue(field, item);\r\n        }).join(spliter);\r\n      } else {\r\n        value = this.getValue(field, helpData);\r\n      }\r\n    }\r\n    return value;\r\n  }\r\n  protected getValue(f: string, data: any) {\r\n    let val = '';\r\n    if (f.indexOf('.') === -1) {\r\n      val = data[f];\r\n    } else {\r\n      val = f.split('.').reduce((a, b) => {\r\n        return a[b];\r\n      }, data);\r\n    }\r\n\r\n    return val;\r\n  }\r\n  protected setValue(target: object, paths: string[], value: any) {\r\n    if (target) {\r\n      if (paths.length <= 1) {\r\n        target[paths[0]] = value;\r\n      } else {\r\n        paths.slice(0, -1).reduce((prev, path) => {\r\n          if (!(prev.hasOwnProperty(path) || prev['__proto__'].hasOwnProperty(path))) {\r\n            prev[path] = {};\r\n          }\r\n          return prev[path];\r\n        }, target)[paths[paths.length - 1]] = value;\r\n      }\r\n    }\r\n  }\r\n  private getBindingPathArray(): any[] {\r\n    const path = this.vm.bindingPath;\r\n    if (path) {\r\n      return path.split('/').filter((n) => n !== '');\r\n    }\r\n    return [];\r\n  }\r\n\r\n  private isNumberValue(field, data) {\r\n    const currentVal = this.getValue(field, data);\r\n    return isNumber(currentVal);\r\n  }\r\n  /**\r\n   *\r\n   * @param mapFields  æ ¼å¼å½¢å¦ï¼{id: \"assoField.assoField\", code: \"assoField.assoField_Code\", name: \"assoField.assoField_Name\"} æè {id:'vid',code:'code',name:'name'}\r\n   */\r\n  private getMapFieldsPrimaryKey(mapFields: any, bindingPaths: string[]): Array<{ primaryKey: string, primaryField: string }> {\r\n    if (!mapFields || Object.keys(mapFields).length < 1) {\r\n      return null;\r\n    }\r\n    const results = [];\r\n    // let primaryField = null;\r\n    try {\r\n      const entityTypeInfo: DataTypeInfo = this.vm.frameContext.repository.entityTypeInfo;\r\n      Object.keys(mapFields).forEach((key: string) => {\r\n        const mapField = mapFields[key];\r\n        if (mapField && typeof mapField === 'string') {\r\n          const mappings = mapField.split(',').filter((p) => p);\r\n          mappings.forEach((item: string) => {\r\n            let paths = item.split('.');\r\n            if (bindingPaths && bindingPaths.length > 0) {\r\n              paths = bindingPaths.concat(paths);\r\n            }\r\n            const propInfo: DataPropInfo = entityTypeInfo.getPropInfoByPath(paths);\r\n            if (propInfo && propInfo.metadataInfo && propInfo.metadataInfo.primary === true) {\r\n              results.push({\r\n                primaryKey: key,\r\n                primaryField: item\r\n              });\r\n            }\r\n          });\r\n        }\r\n      });\r\n    } catch (e) {\r\n      console.error(e);\r\n    }\r\n    return results;\r\n  }\r\n  private sortMapFieldKeys(keys: string[], primaryKeys: string[]): string[] {\r\n    if (!primaryKeys || primaryKeys.length < 1 || !keys || keys.length < 1) {\r\n      return keys;\r\n    }\r\n    primaryKeys = [...new Set(primaryKeys)];\r\n    // è¿æ»¤åºéä¸»é®æ å°å­æ®µ\r\n    keys = keys.filter((p) => !primaryKeys.includes(p));\r\n    return [].concat(primaryKeys).concat(keys);\r\n  }\r\n}\r\n","/*\r\n * @Author: ç¯çç§æ(lucas huang)\r\n * @Date: 2018-11-07 16:31:57\r\n * @LastEditors: ç¯çç§æ(Lucas Huang)\r\n * @LastEditTime: 2019-09-27 14:57:22\r\n * @Company: Inspur\r\n * @Version: v0.0.1\r\n */\r\n\r\n/**\r\n * ä½¿ç¨æ¹æ³ï¼\r\n * [data-mapping]=\"{ id: 'user.userId', name: 'user.userName' }\"\r\n * key ä¸ºå¸®å©ä¸çå­æ®µï¼ value ä¸º è¡¨åä¸­çå­æ®µå\r\n * å¸®å©ä¸çåä¸ä¸ªå­æ®µå¯ä»¥æ å°å°è¡¨åä¸­çå¤ä¸ªå­æ®µä¸­ï¼{ ... id: 'user.userid, user.addusid'}\r\n * å¤å­æ®µä»¥éå·éå¼\r\n *\r\n */\r\n\r\nimport { Directive, OnInit, Optional, Self, Input } from '@angular/core';\r\nimport { BindingObject, NgFormControl, ViewModel } from '@farris/devkit';\r\nimport { LookupGridComponent } from '@farris/ui-lookup';\r\nimport { DataMapping } from './data-mapping';\r\n\r\n\r\n@Directive({ selector: '[data-mapping]' })\r\nexport class LookupDataMappingDirective extends DataMapping implements OnInit {\r\n  @Input('data-mapping') mapfields: any;\r\n  @Input('target') target: BindingObject = null;\r\n\r\n  constructor(@Optional() public vm: ViewModel, @Optional() @Self() private lookup: LookupGridComponent) {\r\n    super();\r\n  }\r\n\r\n  ngOnInit() {\r\n    this.lookup.selectedData.subscribe((data: any) => {\r\n      const _mapfields = this.mapfields || this.lookup.mapFields;\r\n      const spliter = this.lookup.multipleChoiceSeparator || this.defaultSpliter;\r\n      this.mappingData(data, _mapfields, false, spliter);\r\n    });\r\n    this.lookup.clearMappings.subscribe((result: any) => {\r\n      // const value = result && result.value || null;\r\n      const mapfields = Object.assign({}, (this.mapfields || this.lookup.mapFields || {}));\r\n      const lookupTextField = this.lookup.textField;\r\n      const data = {};\r\n      const controlName = this.lookup.ngControl && this.lookup.ngControl.name;\r\n      if (controlName && this.vm) {\r\n        const textFieldMapping = mapfields[lookupTextField];\r\n        const ngFormControl = this.vm && this.vm.form && this.vm.form.ngFormControls && this.vm.form.ngFormControls[controlName] as NgFormControl;\r\n        const binding = ngFormControl && ngFormControl.binding;\r\n        if (textFieldMapping && binding) {\r\n          mapfields[lookupTextField] = textFieldMapping.split(',').filter((item) => item !== binding).join(',');\r\n        }\r\n      }\r\n      // this.setValue(data, lookupTextField.split('.'), value);\r\n      Object.keys(mapfields).forEach((field) => {\r\n        this.setValue(data, field.split('.'), '');\r\n      });\r\n      this.mappingData(data, mapfields, true);\r\n    });\r\n    this.lookup.clear.subscribe(() => {\r\n      const _mapfields = this.mapfields || this.lookup.mapFields;\r\n      this.mappingData(null, _mapfields);\r\n    });\r\n  }\r\n}\r\n","\r\nimport { Directive, OnInit, Optional, Self, Input } from '@angular/core';\r\nimport { FrameContext } from '@farris/devkit';\r\nimport { LookupGridComponent } from '@farris/ui-lookup';\r\n\r\n// tslint:disable-next-line: directive-selector\r\n@Directive({\r\n  selector: '[enableExtendLoadMethod]'\r\n})\r\nexport class LookupEnableExtendLoadMethodDirective implements OnInit {\r\n  @Input()\r\n  public enableExtendLoadMethod: any;\r\n\r\n  constructor(\r\n    @Optional() private frameContext: FrameContext,\r\n    @Optional() @Self() private lookup: LookupGridComponent\r\n  ) { }\r\n\r\n  ngOnInit() {\r\n    if (!this.frameContext || !this.lookup || this.enableExtendLoadMethod !== true) {\r\n      return;\r\n    }\r\n    const befApiUrl = this.frameContext.repository.apiUri;\r\n    const helpMetadataId = this.lookup.uri;\r\n    const enableKey = `${helpMetadataId}@${befApiUrl}`;\r\n    this.frameContext.setParam(enableKey, true);\r\n  }\r\n}\r\n","import { Directive, Input, OnInit, HostListener, Self, Host, Optional, Output, EventEmitter, OnChanges, SimpleChanges, DoCheck, KeyValueDiffer, KeyValueDiffers } from '@angular/core';\r\nimport { ComboBoxComponent } from '@progress/kendo-angular-dropdowns';\r\nimport { LookupGridComponent } from '@farris/ui-lookup';\r\nimport { ComboListComponent } from '@farris/ui-combo-list';\r\nimport { ComboLookupComponent } from '@farris/ui-combo-lookup';\r\n\r\n@Directive({\r\n  selector: '[UIStateBinding]'\r\n})\r\nexport class UIStateBindingDirective implements OnInit, OnChanges, DoCheck {\r\n  private _bindingObject: any;\r\n  private readonly defaultSpliter = ',';\r\n  private differ: KeyValueDiffer<any, any> = null;\r\n\r\n  @Input('UIStateBinding')\r\n  set bindingObject(value: any) {\r\n    this._bindingObject = value;\r\n    if (!this.differ && value && this.differs && typeof (value) === 'object') {\r\n      this.differ = this.differs.find(value).create();\r\n    }\r\n  }\r\n  get bindingObject() {\r\n    return this._bindingObject;\r\n  }\r\n  @Output() UIStateBindingChange: EventEmitter<any> = new EventEmitter<any>();\r\n\r\n  @HostListener('valueChange', ['$event'])\r\n  onValueChange(val: any) {\r\n    // host is combobox\r\n    if (this.hostComboComponent && this.bindingObject) {\r\n      if (val) {\r\n        this.bindingObject.key = val.value;\r\n        this.bindingObject.value = val.name;\r\n      } else {\r\n        this.bindingObject.key = null;\r\n        this.bindingObject.value = null;\r\n      }\r\n    }\r\n  }\r\n\r\n  constructor(\r\n    @Host() @Self() @Optional() private hostComboComponent: ComboBoxComponent,\r\n    @Host() @Self() @Optional() private hostHelpComponent: LookupGridComponent,\r\n    @Optional() private differs: KeyValueDiffers,\r\n    @Host() @Self() @Optional() private hostComboListComponent: ComboListComponent,\r\n    @Host() @Self() @Optional() private hostComboLookupComponent: ComboLookupComponent\r\n  ) { }\r\n\r\n  ngOnInit() {\r\n    if (this.hostComboComponent) {\r\n      this.hostComboComponent.valuePrimitive = false;\r\n    } else if (this.hostHelpComponent) {\r\n      this.bindObjectToHostLookup();\r\n    } else if (this.hostComboListComponent) {\r\n      this.bindObjectToHostComboList();\r\n    } else if (this.hostComboLookupComponent) {\r\n      this.bindObjectToHostComboLookup();\r\n    }\r\n  }\r\n  ngDoCheck() {\r\n    if (this.differ && typeof (this.bindingObject) === 'object') {\r\n      const changes = this.differ && this.differ.diff(this.bindingObject);\r\n      if (changes) {\r\n        this.bindingChanges();\r\n      }\r\n    } else { // å¼å®¹æªéæ°ç¼è¯å·¥ç¨ï¼differä¸å­å¨ä»æåµ\r\n      this.bindingChanges();\r\n    }\r\n  }\r\n\r\n  private bindingChanges() {\r\n    const text = this.bindingObject ? this.bindingObject.value : null;\r\n    const key = this.bindingObject ? this.bindingObject.key : null;\r\n    if (this.hostComboComponent) {\r\n      this.hostComboComponent.text = text;\r\n      const vField = this.hostComboComponent.valueField;\r\n      const item = this.hostComboComponent.data.find((n) => n[vField] === key);\r\n      this.hostComboComponent.writeValue(item);\r\n    } else if (this.hostHelpComponent) {\r\n      this.hostHelpComponent.writeValue(text);\r\n      this.hostHelpComponent.displayValue = key;\r\n    } else if (this.hostComboListComponent) {\r\n      this.hostComboListComponent.writeValue(key);\r\n    } else if (this.hostComboLookupComponent) {\r\n      this.hostComboLookupComponent.selectedValues = key;\r\n      this.hostComboLookupComponent.writeValue(text);\r\n    }\r\n  }\r\n  ngOnChanges(changes: SimpleChanges) {\r\n    if (changes.bindingObject && !this.differ) {\r\n      this.bindingChanges();\r\n    }\r\n  }\r\n\r\n  // å¼¹åºå¸®å©\r\n  private bindObjectToHostLookup() {\r\n    if (!this.hostHelpComponent) {\r\n      return;\r\n    }\r\n\r\n    this.hostHelpComponent.selectedData.subscribe((data: any) => this.updateHelpBindingObject(data));\r\n\r\n    this.hostHelpComponent.clear.subscribe(() => {\r\n      // this.bindingObject = {key: null, value: null};\r\n      this.updateHelpBindingObject(null);\r\n    });\r\n    if (this.hostHelpComponent.tagRemoved) {\r\n      this.hostHelpComponent.tagRemoved.subscribe((event: { removedIndex: number, instance: LookupGridComponent }) => {\r\n        const { removedIndex: index = -1, instance: componentRef = null } = event;\r\n        if (index === -1) {\r\n          return;\r\n        }\r\n        const isSigleSelect = componentRef.singleSelect;\r\n        if (isSigleSelect || !componentRef.displayValue) {\r\n          this.updateHelpBindingObject(null);\r\n        } else {\r\n          this.UIStateBindingChange.emit({ key: componentRef.displayValue, value: componentRef.displayText });\r\n        }\r\n      });\r\n    }\r\n    if (this.hostHelpComponent.nosearch) {\r\n      this.hostHelpComponent.valueChanged.subscribe((txt: any) => {\r\n        const idField = this.hostHelpComponent.idField;\r\n        const textField = this.hostHelpComponent.textField;\r\n        this.updateHelpBindingObject({\r\n          [idField]: txt,\r\n          [textField]: txt\r\n        });\r\n      });\r\n    }\r\n  }\r\n\r\n  // ä¸æåè¡¨\r\n  private bindObjectToHostComboList() {\r\n    if (!this.hostComboListComponent) {\r\n      return;\r\n    }\r\n\r\n    this.hostComboListComponent.valueChange.subscribe((data: any) => this.updateHelpBindingObject(data.selections));\r\n\r\n    this.hostComboListComponent.clear.subscribe(() => {\r\n      this.updateHelpBindingObject(null);\r\n    });\r\n  }\r\n\r\n  // ä¸æå¸®å©\r\n  private bindObjectToHostComboLookup() {\r\n    if (!this.hostComboLookupComponent) {\r\n      return;\r\n    }\r\n\r\n    if (this.hostComboLookupComponent.multiSelect) {\r\n      this.hostComboLookupComponent.valueChange.subscribe((data: any) => this.updateHelpBindingObject(data.selections));\r\n    } else {\r\n      // this.hostComboLookupComponent.selectChange.subscribe((data: any) => this.updateHelpBindingObject(data));\r\n      this.hostComboLookupComponent.selectChange.subscribe((e: any) => {\r\n        let data = e;\r\n        if (e.data) {\r\n          data = e.data;\r\n        }\r\n        this.updateHelpBindingObject(data);\r\n      });\r\n    }\r\n\r\n    this.hostComboLookupComponent.clear.subscribe(() => {\r\n      this.updateHelpBindingObject(null);\r\n    });\r\n  }\r\n\r\n  // æ´æ°UISTATE\r\n  private updateHelpBindingObject(data: any) {\r\n    let idField;\r\n    let textField;\r\n    let spliter: string = this.defaultSpliter;\r\n    if (this.hostHelpComponent) {\r\n      idField = this.hostHelpComponent.idField;\r\n      textField = this.hostHelpComponent.textField;\r\n      spliter = this.hostHelpComponent.multipleChoiceSeparator || this.defaultSpliter;\r\n    }\r\n\r\n    if (this.hostComboListComponent) {\r\n      idField = this.hostComboListComponent.idField;\r\n      textField = this.hostComboListComponent.textField;\r\n    }\r\n\r\n    if (this.hostComboLookupComponent) {\r\n      idField = this.hostComboLookupComponent.idField;\r\n      textField = this.hostComboLookupComponent.textField;\r\n      spliter = this.hostComboLookupComponent.separator || this.defaultSpliter;\r\n    }\r\n\r\n    this.emitUiStateBinding(data, idField, textField, spliter);\r\n  }\r\n\r\n  private emitUiStateBinding(data, idField, textField, spliter: string = ',') {\r\n    const newObject = { key: null, value: null };\r\n    if (data) {\r\n      // const idField = this.hostHelpComponent.idField;\r\n      // const textField = this.hostHelpComponent.textField;\r\n      if (Array.isArray(data)) {\r\n        newObject.key = data.map((d) => d[idField]).join(spliter);\r\n        newObject.value = data.map((d) => {\r\n          if (textField.indexOf('.') > -1) {\r\n            return textField.split('.').reduce((r, c) => {\r\n              return r[c];\r\n            }, d);\r\n          } else {\r\n            return d[textField];\r\n          }\r\n        }).join(spliter);\r\n      } else {\r\n        if (idField) {\r\n          newObject.key = data[idField];\r\n        }\r\n\r\n        if (textField) {\r\n          if (textField.indexOf('.') > -1) {\r\n            newObject.value = textField.split('.').reduce((r, c) => {\r\n              return r[c];\r\n            }, data);\r\n          } else {\r\n            newObject.value = data[textField];\r\n          }\r\n        }\r\n      }\r\n    }\r\n    this.UIStateBindingChange.emit(newObject);\r\n  }\r\n}\r\n","import { Directive, ElementRef, Input, Renderer2, OnInit, OnChanges, SimpleChanges } from '@angular/core';\r\nimport { GridComponent } from '@progress/kendo-angular-grid';\r\n@Directive({\r\n    selector: '[farrisDisabled]'\r\n})\r\nexport class FarrisDisabledDirective implements OnInit, OnChanges {\r\n    @Input('farrisDisabled') kendoGridDisabled: boolean;\r\n    maskElement: any;\r\n    constructor(private grid: GridComponent, private el: ElementRef, private renderer: Renderer2) {\r\n\r\n    }\r\n    ngOnInit() {\r\n\r\n    }\r\n    ngOnChanges(changes: SimpleChanges) {\r\n        if (!this.maskElement) {\r\n            this.createMaskElement();\r\n        }\r\n        if (changes['kendoGridDisabled'] && this.maskElement) {\r\n            if (this.kendoGridDisabled) {\r\n                this.renderer.removeStyle(this.maskElement, 'display');\r\n            } else {\r\n                this.renderer.setStyle(this.maskElement, 'display', 'none');\r\n            }\r\n        }\r\n    }\r\n    private createMaskElement() {\r\n        this.maskElement = this.renderer.createElement(\"div\");\r\n        this.renderer.setStyle(this.maskElement, 'width', '100%');\r\n        this.renderer.setStyle(this.maskElement, 'height', '100%');\r\n        this.renderer.setStyle(this.maskElement, 'position', 'absolute');\r\n        this.renderer.setStyle(this.maskElement, 'background-color', 'rgba(255,255,255,0.5)');\r\n        this.renderer.setStyle(this.maskElement, 'z-index', '3');\r\n        this.renderer.setStyle(this.maskElement, 'display', 'none');\r\n        this.renderer.appendChild(this.el.nativeElement, this.maskElement);\r\n    }\r\n}\r\n\r\n","import { Directive, Input, Injector } from '@angular/core';\r\nimport { FrameContext, BindingData, ViewModel } from '@farris/devkit';\r\n@Directive({\r\n    selector: '[farrisSort]'\r\n})\r\nexport class FarrisSortDirective {\r\n\r\n}\r\n\r\n@Directive({\r\n    selector: '[farris-textarea-edit]'\r\n})\r\nexport class FarrisTextareaEditDirective {\r\n\r\n}\r\n\r\n@Directive({\r\n    selector: '[farrisDynamicColumnFormat]'\r\n})\r\nexport class FarrisDynamicColumnFormatDirective {\r\n\r\n}\r\n\r\n@Directive({\r\n    selector: '[farris-enter-edit]'\r\n})\r\nexport class FarrisEditEnterDirective {\r\n    @Input('form-group') farrisForm: any;\r\n}\r\n\r\n@Directive({\r\n    selector: '[farrisTreeTableFormat]'\r\n})\r\nexport class FarrisTreeTableFormatDirective {\r\n\r\n}\r\n\r\n","import {\r\n  Directive, OnInit, OnChanges, OnDestroy, SimpleChanges, HostListener,\r\n  EventEmitter, Output\r\n} from '@angular/core';\r\nimport { Subject, Subscription } from 'rxjs';\r\nimport { BindingData, BindingList, Change, ChangeType, ViewModel, FrameContext, DataTypeInfo, EntityPathConverter, RunMode, ComponentType, ExpressionUtil, ENABLE_EDIT_STATE_FILTER_SORTING } from '@farris/devkit';\r\nimport { DatagridComponent } from '@farris/ui-datagrid';\r\nimport { debounceTime, finalize } from 'rxjs/operators';\r\n// tslint:disable: max-line-length\r\n\r\n/*\r\n * ä½¿ç¨ç»å®æ°æ®æä»¤\r\n */\r\n@Directive({\r\n  selector: '[farris-use-binding-data]'\r\n})\r\nexport class FarrisDatagridUseBindingDataDirective implements OnInit, OnChanges, OnDestroy {\r\n  private _PROPS: { [propName: string]: any };\r\n  // æåºå­æ®µ\r\n  private sortFields: string = null;\r\n  // æåºæ¹å\r\n  private sortDirections: string = null;\r\n  /**\r\n   * æ¯å¦å·²æåº\r\n   */\r\n  private hasSorted = false;\r\n  /**\r\n   * è¿æ»¤æ¡ä»¶\r\n   */\r\n  private filters: any = null;\r\n  protected get props() {\r\n    return this._PROPS;\r\n  }\r\n  protected set props(value) {\r\n    this._PROPS = value;\r\n  }\r\n  protected bindingDataChangeEvent: Subscription;\r\n  /**\r\n   * æ¸²ægrid\r\n   */\r\n  private renderGridSubject: Subject<any> = new Subject<any>();\r\n  private enableFilterSorting = false;\r\n  /**\r\n   * éä¸­è¡åæ¢äºä»¶\r\n   */\r\n  @Output() selectedRowChange: EventEmitter<any> = new EventEmitter<any>();\r\n  // private renderGridDebounce;\r\n  constructor(public bindingData: BindingData, public viewModel: ViewModel, public grid: DatagridComponent) {\r\n    this.setChecks([]);\r\n    this.enableFilterSorting = this.viewModel && this.viewModel.frameContext && this.viewModel.frameContext.injector.get<boolean>(ENABLE_EDIT_STATE_FILTER_SORTING, false) || false;\r\n    this.registerEvent();\r\n  }\r\n\r\n  // #region Ng Event\r\n\r\n  ngOnInit() {\r\n    const { pageSize = 0 } = this.getPagingInfo() || {};\r\n    if (pageSize !== 0) {\r\n      // å¯ç¨åé¡µ\r\n      if ((!this.grid.pageList || this.grid.pageList.length < 1) && typeof this.grid['setPageList'] === 'function') {\r\n        this.grid['setPageList']([pageSize, pageSize * 2, pageSize * 3, pageSize * 4]);\r\n      }\r\n    }\r\n    this.setComponentRef();\r\n    this.bindData();\r\n    window.setTimeout(() => {\r\n      this.updateSelectedRow();\r\n    }, 0);\r\n    this.registerBindingDataChangeEvent();\r\n    this.renderGridSubject.pipe(debounceTime(500)).subscribe((change: Change) => {\r\n      if (!this.viewModel || !this.viewModel.frameContext || this.viewModel.frameContext.isDisposed) {\r\n        return;\r\n      }\r\n      this.bindData(change);\r\n      /*if (!this.renderGridDebounce) {\r\n        this.renderGridDebounce = this.debounce((change) => {\r\n          this.bindData(change);\r\n        }, 500);\r\n      }\r\n      this.renderGridDebounce(change);*/\r\n    });\r\n    if (this.viewModel && this.viewModel.frameContext && this.viewModel.frameContext.frameComponent) {\r\n      this.viewModel.frameContext.frameComponent.componentType = ComponentType.farrisDataGridComponent;\r\n    }\r\n  }\r\n\r\n  ngOnChanges(changes: SimpleChanges) {\r\n    this.bindData();\r\n  }\r\n\r\n  // #endregion\r\n\r\n\r\n  /**\r\n   * ä¸»é®\r\n   */\r\n  protected get primaryKey() {\r\n    return this.bindingList.primaryKey;\r\n  }\r\n  /**\r\n   * è·åç»å®æ°æ®\r\n   */\r\n  protected get bindingList(): BindingList {\r\n    // æ ¹å®ä½\r\n    if (this.viewModel.bindingPath === '/' || !this.viewModel.bindingPath) {\r\n      return this.bindingData.list;\r\n    }\r\n    // å­å®ä½\r\n    let bindingPath = this.viewModel.bindingPath.substr(1);\r\n    bindingPath = bindingPath[0].toLowerCase() + bindingPath.substring(1, bindingPath.length);\r\n    const paths = bindingPath.split('/');\r\n\r\n    const filteredPaths = paths.filter((part: string) => {\r\n      return part !== '';\r\n    });\r\n    return this.bindingData.getValue(filteredPaths);\r\n  }\r\n  /**\r\n   * è®¾ç½®ç»ä»¶å¼ç¨\r\n   */\r\n  private setComponentRef() {\r\n    const appContext = this.viewModel && this.viewModel.frameContext && this.viewModel.frameContext.getFormAppContext();\r\n    const frameId = this.viewModel && this.viewModel.frameContext && this.viewModel.frameContext.frameId;\r\n    const id = this.grid && this.grid.id;\r\n    // å¦æframeIdä¸å­å¨æfarris gridæ²¡æidå±æ§ï¼è¯´æä¸ç¬¦åä½¿ç¨åºæ¯\r\n    if (!frameId || !id) {\r\n      return;\r\n    }\r\n    const map = appContext && appContext.componentRefs && appContext.componentRefs.get(frameId) || new Map<string, any>();\r\n    appContext && appContext.componentRefs && appContext.componentRefs.set(frameId, map.set(id, this.grid));\r\n  }\r\n  /**\r\n   * è·ååé¡µä¿¡æ¯\r\n   */\r\n  protected getPagingInfo() {\r\n    const bindingPath = this.viewModel.bindingPath;\r\n    const bindingData = this.viewModel.bindingData;\r\n    const pagingInfo = bindingData && bindingData.pagingInfo || {};\r\n    if (bindingPath === '/') {\r\n      return pagingInfo;\r\n    } else {\r\n      const bindingPaths = bindingPath.substr(1).split('/').filter((item) => !!item && item.length > 0);\r\n      // ä»è¡¨åä»ä»è¡¨åé¡µåæ°æ®æ¯å³èçï¼å ä¸ºä¸åçä»è¡¨è¡æä¸åçä»ä»è¡¨æ°æ®ï¼åé¡µä¿¡æ¯çç»æä¸ºnodeCode_parentId:{åé¡µä¿¡æ¯}ä¸åé¡µä¿¡æ¯æ¯å¹³çº§ç\r\n      // {pagination:{a_pid:{pageSize:2,pageIndex:1},b_pid:{pageSize:2,pageIndex:1}}}\r\n      // ååºå½åè·¯å¾ä¸å®ä½çnodeCode\r\n      let nodeCode = bindingPaths[bindingPaths.length - 1];\r\n      nodeCode = nodeCode.substr(0, nodeCode.length - 1);\r\n      // è·åå½åå®ä½ä¸çº§çä¸»é®\r\n      // const result = pagingInfo[nodeCode] || {};\r\n      // if (result.hasOwnProperty('totalCount')) {\r\n      //   result.total = result.totalCount;\r\n      // }\r\n      // return result;\r\n\r\n      const paths = bindingPaths.slice(0, bindingPaths.length - 1);\r\n      const bindingList = bindingData.getValue(paths) as BindingList;\r\n      const { pageSize = 0 } = pagingInfo[`${nodeCode}`] || {};\r\n      // ä¸çº§è¡¨ææ°æ®\r\n      if (bindingList && bindingList.currentId) {\r\n        const key = `${nodeCode}_${bindingList.currentId}`;\r\n        // const key = nodeCode;\r\n        const result = pagingInfo[key] || {};\r\n        if (result.hasOwnProperty('totalCount')) {\r\n          result.total = result.totalCount;\r\n        }\r\n        // ä¸çº§è¡¨è½ç¶ææ°æ®ï¼ä½ä¸çº§è¡¨å½åè¡çä¸çº§è¡¨å¯è½æ²¡ææ°æ®ï¼è¿å°±å¯¼è´è·åä¸å°åé¡µä¿¡æ¯ï¼æä»¥éè¦å¨è¿ååå¯¹ç»æè¿è¡å¤çï¼å¦ææ²¡æåé¡µä¿¡æ¯çè¯èµ·ç åºè¯¥è¿ååé¡µå¤§å°åå½åé¡µç \r\n        if (Object.keys(result).length < 1) {\r\n          result.pageIndex = 1;\r\n          result.pageSize = pageSize;\r\n        }\r\n        return result;\r\n      } else {\r\n        // ä¸çº§è¡¨æ²¡ææ°æ®ï¼æ­¤æ¶éè¦è·åå½åè¡¨çåé¡µä¿¡æ¯ï¼å¦åé¡µå¤§å°ãå½åé¡µé»è®¤ä¸º1å³å¯ã\r\n        return { pageIndex: 1, pageSize };\r\n      }\r\n    }\r\n  }\r\n\r\n  // #region Input\r\n  /**\r\n   * ç»ä»¶æ¯å¦éè¦æ´æ°\r\n   * @param props å½åå±æ§\r\n   * @param nextProps æ°å±æ§\r\n   * @param change åæ´\r\n   */\r\n  protected shouldComponentUpdate(change: Change, data: any,): { result: boolean, props?: any } {\r\n    const props = this.buildProps(data);\r\n    if (this.viewModel && this.viewModel.frameContext && this.viewModel.frameContext.appContext && this.viewModel.frameContext.appContext.runMode === RunMode.highSpeed && change) {\r\n      if (change.type === ChangeType.Load || change.type === ChangeType.Remove || change.type === ChangeType.PaginationInfoChange) {\r\n        return { result: true, props };\r\n      }\r\n    }\r\n    const gridProps = this.buildGridProps();\r\n    if (JSON.stringify(props) === JSON.stringify(gridProps)) {\r\n      return { result: false };\r\n    }\r\n    return { result: true, props };\r\n  }\r\n  protected registerEvent() {\r\n    // æåºäºä»¶\r\n    this.grid && this.grid.columnSorted && this.grid.columnSorted.subscribe((event: any) => {\r\n      const isRemoteSort = this.grid.remoteSort;\r\n      // æ¬å°æåº\r\n      if (!isRemoteSort) {\r\n        this.sortFields = this.grid.sortName;\r\n        this.sortDirections = this.grid.sortOrder;\r\n        this.sortBindingList();\r\n        // this.props = this.buildProps();\r\n      } else {\r\n        // æå¡å¨ç«¯æåº\r\n        const groupField = this.grid && this.grid.groupField || null;\r\n        let sortFields = this.grid.sortName && this.grid.sortName.split(',') || [];\r\n        const sortDirection = this.grid.sortOrder && this.grid.sortOrder.split(',') || [];\r\n        if (groupField) {\r\n          if (!sortFields.includes(groupField)) {\r\n            sortFields.splice(0, 0, groupField);\r\n            sortDirection.splice(0, 0, 'asc');\r\n          }\r\n        }\r\n        // è·åå½åentityä¸ææobjectå±æ§\r\n        const entityType = this.viewModel && this.viewModel.frameContext.repository.entityType || null;\r\n\r\n        if (sortFields.length > 0) {\r\n          if (entityType) {\r\n            const dataTypeInfo = new DataTypeInfo(entityType);\r\n            sortFields = sortFields.map(field => {\r\n              //if (field && field.indexOf('.') !== -1) {\r\n              const paths = field.split('.');\r\n              const propInfo = dataTypeInfo.getPropInfoByPath(paths);\r\n              const originalField = propInfo && propInfo.metadataInfo['path'] || null;\r\n              return originalField;\r\n              //}\r\n              //return field;\r\n            });\r\n          }\r\n        }\r\n        // éåå±æ§ï¼æ ¹æ®datafieldè½¬æ¢ä¸ºoriginalDataField\r\n        const fields = sortFields.join(',');\r\n        const directions = sortDirection.join(',') || 'asc';\r\n        const frameContext: FrameContext = this.viewModel && this.viewModel.frameContext || null;\r\n        if (frameContext) {\r\n          frameContext.repository.sortConditionManager.setConditions(this.viewModel.bindingPath, fields, directions);\r\n        }\r\n      }\r\n    });\r\n    // è¿æ»¤äºä»¶\r\n    this.grid && this.grid.filterChanged && this.grid.filterChanged.subscribe((event: any) => {\r\n      this.filters = event;\r\n      if (!this.grid.remoteFilter) {\r\n        if (this.bindingList.length > 0 && !this.bindingList.currentId) {\r\n          const id = this.bindingList.getIdByIndex(0);\r\n          this.bindingList.setCurrentId(id);\r\n        }\r\n        this.bindingList.filter(this.filters);\r\n        this.bindData();\r\n      }\r\n    });\r\n    this.viewModel.frameContext.appContext.messagePipe.subscribe((message) => {\r\n      if (message && message === 'CLEAR_GRID_CONDITION' && this.filters && Object.keys(this.filters).length > 0) {\r\n        this.filters = {};\r\n        this.bindData();\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * å¯¹bindingListæåº\r\n   * @param change change\r\n   */\r\n  private sortBindingList(change?: Change) {\r\n    // groupFieldå¯è½æå¤ä¸ªï¼ä»¥éå·åéçå­ç¬¦ä¸²\r\n    const groupField = this.grid && this.grid.groupField || null;\r\n    if (groupField) {\r\n      const arrSortFields = this.sortFields && this.sortFields.split(',') || [];\r\n      const groupFields = groupField.split(',').reverse();\r\n      groupFields.forEach((field: string) => {\r\n        if (!arrSortFields.includes(field)) {\r\n          arrSortFields.splice(0, 0, field);\r\n          const arrSortDirection = this.sortDirections && this.sortDirections.split(',') || [];\r\n          arrSortDirection.splice(0, 0, 'asc');\r\n          this.sortFields = arrSortFields.join(',');\r\n          this.sortDirections = arrSortDirection.join(',') || 'asc';\r\n        }\r\n      });\r\n    }\r\n    this.bindingList.sortBy(this.sortFields, this.sortDirections);\r\n    this.bindData(change);\r\n  }\r\n  // #endregion\r\n\r\n  // #region æ°æ®ç»å®é¨å\r\n  /**\r\n   * æ´æ°æ°æ®\r\n   * @param change? åæ´\r\n   */\r\n  bindData(change?: Change) {\r\n    const isRemoteFilter = this.grid && this.grid.remoteFilter || false;\r\n    // åæ§è¡æåº\r\n    const shouldSort = this.shouldSort(change);\r\n    if (shouldSort) {\r\n      this.hasSorted = true;\r\n      this.sortBindingList(change);\r\n      return;\r\n    }\r\n    this.hasSorted = false;\r\n    // æ°å¢æ°æ®æ¶æ¸ç©ºè¡¨æ ¼ç­éæ¡ä»¶\r\n    if ((this.grid.editable === true || change && change.type === ChangeType.Append) && this.filters && Object.keys(this.filters).length > 0 && !isRemoteFilter) {\r\n      if (!this.viewModel.frameContext.appContext.enableGridHeaderWhenEditing && !this.enableFilterSorting) {\r\n        this.filters = {};\r\n        this.grid.clearCondition();\r\n      }\r\n    }\r\n    const shouldFiltering = this.shouldFiltering(change);\r\n    if (shouldFiltering) {\r\n      this.bindingList.filter(this.filters);\r\n    }\r\n    // åtoJSON\r\n    const data: any = this.bindingList.toJSON();\r\n    // if (this.filters && Object.keys(this.filters).length > 0 && !isRemoteFilter) {\r\n    //   // data = this.grid.clientFilterService.executeFilter(data, this.filters);\r\n    // }\r\n\r\n    if (this.filters && Object.keys(this.filters).length > 0 && !isRemoteFilter && (!change || change && change.type !== ChangeType.SelectionChanged && change.type !== ChangeType.GlobalSelectionChanged)) {\r\n      if (data && data.length > 0) {\r\n        // å¤æ­å½åè¡æ¯å¦å¨è¿æ»¤åçæ°æ®ä¸­\r\n        const row = (data as []).find((item) => item[this.bindingList.primaryKey] === this.bindingList.currentId);\r\n        if (!row) {\r\n          const firstRowId = data[0][this.bindingList.primaryKey];\r\n          this.bindingList.setCurrentId(firstRowId, true, true);\r\n        }\r\n      } else {\r\n        // æ¬å°è¿æ»¤å®ä¹åæ²¡ææ°æ®äº\r\n        // this.bindingList.currentId = null;\r\n        if (this.bindingList.currentId) {\r\n          this.bindingList.setCurrentId(null, true, true, true);\r\n        }\r\n        // åéæ¶æ¸ç©ºids\r\n        if (!this.grid.multiSelect) {\r\n          this.setChecks([]);\r\n        }\r\n      }\r\n    }\r\n    const result = this.shouldComponentUpdate(change, data);\r\n    if (!result.result) {\r\n      return;\r\n    }\r\n    // const nextProps = this.buildProps(result);\r\n    this.renderGrid(result.props);\r\n    this.props = JSON.parse(JSON.stringify(result.props));\r\n  }\r\n  /**\r\n   * æ¯å¦åºè¯¥è¿æ»¤\r\n   * @param change - change\r\n   * @returns {boolean}\r\n   */\r\n  private shouldFiltering(change?: Change) {\r\n    const isRemoteFilter = this.grid && this.grid.remoteFilter || false;\r\n    // å¯ç¨è¿ç«¯è¿æ»¤æ¶ä¸éè¦æ¬å°è¿æ»¤\r\n    if (isRemoteFilter === true) {\r\n      return false;\r\n    }\r\n    // æ²¡æè¿æ»¤æ¡ä»¶æ¶ä¸éè¦æ§è¡è¿æ»¤\r\n    if (!this.filters || Object.keys(this.filters).length < 1) {\r\n      return false;\r\n    }\r\n    if (change) {\r\n      return change.type === ChangeType.Load;\r\n    }\r\n    return !this.grid.editable;\r\n  }\r\n  private shouldSort(change?: Change) {\r\n    // this.sortFields && !this.grid.editable && change && (change.type === 'Load' || change.type === 'SelectionChanged')\r\n    if (!this.sortFields || Object.keys(this.sortFields).length < 1) {\r\n      return false;\r\n    }\r\n    if (this.hasSorted) {\r\n      return false;\r\n    }\r\n    if (change) {\r\n      return change.type === 'Load' || change.type === 'SelectionChanged';\r\n    }\r\n    return this.grid.editable;\r\n  }\r\n  /**\r\n   * æ¸²ægrid\r\n   * @param props å±æ§\r\n   */\r\n  private renderGrid(props: any) {\r\n    const { pageIndex, pageSize, total, pagination, data } = props;\r\n    const virtualizedLoad = this.grid.virtualizedAsyncLoad || false;\r\n    this.grid.total = total;\r\n    this.grid.pageSize = pageSize;\r\n    this.grid.pageIndex = pageIndex;\r\n    this.grid.pagination = pagination;\r\n    this.grid.controlPaginationState = false;\r\n    // this.endCellEdit();\r\n    if (pageSize === 0) {\r\n      this.grid.pagination = false;\r\n      this.grid.pageIndex = 1;\r\n      // ä¿®å¤ä¸åé¡µæ¶gridå¯ç¨åç»ä»ä¼éæ°é¦æ°çé®é¢\r\n      // this.grid.pageSize = total;\r\n    }\r\n    if (virtualizedLoad) {\r\n      this.grid.loadVirtualData({\r\n        items: data,\r\n        pageIndex,\r\n        pageSize,\r\n        total\r\n      });\r\n    } else {\r\n      this.grid.loadData(data);\r\n    }\r\n  }\r\n  /**\r\n   * æé è¡¨æ ¼æ°æ®å±æ§\r\n   */\r\n  protected buildProps(datas?: Array<any>) {\r\n    let data;\r\n    if (typeof (datas) !== 'undefined') {\r\n      data = datas;\r\n    } else {\r\n      data = this.bindingList.toJSON();\r\n    }\r\n    // let skip = 0;\r\n    let { pageIndex = 1, pageSize = 0 } = this.getPagingInfo() || {};\r\n    let { total = 0 } = this.getPagingInfo() || {};\r\n    // if (pageIndex > 0) {\r\n    //   skip = (pageIndex - 1) * pageSize;\r\n    // }\r\n    if (pageSize === 0 && total === 0) {\r\n      total = data.length;\r\n    }\r\n    return { data, pageIndex, pageSize, total, pagination: pageSize !== 0 };\r\n  }\r\n  /**\r\n   * è®¡ç®gridç¶æ\r\n   */\r\n  private buildGridProps() {\r\n    const data = this.grid.data || [];\r\n    let skip = 0;\r\n    const { pageIndex = 1, pageSize = 0 } = { pageIndex: this.grid.pageIndex, pageSize: this.grid.pageSize };\r\n    let total = this.grid.total || 0;\r\n    if (pageIndex > 0) {\r\n      skip = (pageIndex - 1) * pageSize;\r\n    }\r\n    if (pageSize === 0 && total === 0) {\r\n      total = data.length;\r\n    }\r\n    return { data, pageIndex, pageSize, total, pagination: this.grid.pagination };\r\n  }\r\n  /**\r\n   * æ°æ®æºåçåæ´\r\n   * @param change åæ´\r\n   */\r\n  protected onBindingDataChange(change: Change) {\r\n    this.updateDataSource(change);\r\n    this.updateSelectedRow(change);\r\n    // this.updateGrid(change);\r\n    // ä¸æ¸é¤å¾éè¡ï¼éè¦ä¿çå¾éç¶æ\r\n    // this.clearCheckedRows(change);\r\n    this.endCellEdit(change);\r\n    // æ´æ°å¾éè¡æ°æ®\r\n    this.updateCheckedRows(change);\r\n    this.updateData(change);\r\n  }\r\n  /**\r\n   * æ´æ°æ°æ®\r\n   */\r\n  private updateDataSource(change: Change) {\r\n    if (change && change.type === ChangeType.ValueChanged) {\r\n      // è®¡ç®åæ´è·¯å¾ä¸­è¡¨ååå­æ®µå\r\n      const paths = change.path;\r\n      try {\r\n        const entityPath = ExpressionUtil.getAvailableChildrenPathsFromEntityPaths(paths, this.viewModel.frameContext.repository.entityTypeInfo);\r\n        if (this.viewModel.bindingPath === '/' + entityPath.join('/')) {\r\n          const propertyNames = paths.slice(entityPath.length);\r\n          if (change.id && this.grid && change.path && this.viewModel.frameContext.appContext.runMode !== RunMode.highSpeed && propertyNames && propertyNames.length > 0) {\r\n            this.grid.updateRow(change.id, { [propertyNames.join('.')]: change.value });\r\n          }\r\n        }\r\n      } catch (error) {\r\n        console.warn(error);\r\n      }\r\n      this.renderGridSubject.next(change);\r\n    } else if (change && (change.type === ChangeType.SelectionChanged || change.type === ChangeType.GlobalSelectionChanged)) {\r\n      if (this.bindingList.currentId === (this.grid.selectedRow && this.grid.selectedRow.id) && this.grid.total > 0) {\r\n      } else {\r\n        this.bindData(change);\r\n      }\r\n    } else {\r\n      this.bindData(change);\r\n    }\r\n  }\r\n  // private endCellEdit() {\r\n  //   const isEditing = this.grid.isEditing();\r\n  //   if (isEditing) {\r\n  //     this.grid.endCellEdit();\r\n  //   }\r\n  // }\r\n  private endCellEdit(change: Change) {\r\n    const isEditing = this.grid.isEditing();\r\n    if (change.type === ChangeType.Load && isEditing) {\r\n      this.grid.endCellEdit();\r\n    }\r\n  }\r\n  /**\r\n   * è®¾ç½®gridå½åéæ©è¡\r\n   * @param change åæ´\r\n   */\r\n  private updateSelectedRow(change?: Change) {\r\n    if (!this.bindingList || !this.bindingList.currentId) {\r\n      return;\r\n    }\r\n    // é¡µç åæ¢æ¶ä¸æ§è¡å½åè¡åæ¢\r\n    if (change && change.type === ChangeType.PaginationInfoChange) {\r\n      return;\r\n    }\r\n    if (this.viewModel && this.viewModel.frameContext.bindingData.rowSelectedEventSuspend === true) {\r\n      return;\r\n    }\r\n    const { id: gridSelectedRowId = null } = this.grid.selectedRow || {};\r\n    const currentId = this.bindingList.currentId;\r\n    // gridå½åè¡ä¸bingingListå½åè¡ä¸è´ï¼æ é¡»åæ¢\r\n    if (gridSelectedRowId === currentId) {\r\n      const isMatch = change && (change.path.toString() === this.viewModel.bindingPath.split('/').filter(p => p).toString());\r\n      if (change && change.type === ChangeType.Load && isMatch) {\r\n        this.grid.clearSelections();\r\n        this.grid.selectRow(currentId, true, true);\r\n      }\r\n      return;\r\n    }\r\n    this.selectGridRow(this.bindingList.currentId);\r\n  }\r\n  /**\r\n   * æ³¨åbindingdataååäºä»¶\r\n   */\r\n  private registerBindingDataChangeEvent() {\r\n    this.bindingDataChangeEvent = this.bindingData.changes.subscribe((change: Change) => {\r\n      this.onBindingDataChange(change);\r\n    });\r\n    this.viewModel.frameContext.appContext.messagePipe.subscribe(message => {\r\n      if (message === 'bindData') {\r\n        this.bindData();\r\n      }\r\n    });\r\n  }\r\n  /**\r\n   * åæ¶bindingdataååè®¢é\r\n   */\r\n  private unRegisterBindingDataChangeEvent() {\r\n    if (this.bindingDataChangeEvent && typeof (this.bindingDataChangeEvent.unsubscribe) === 'function') {\r\n      this.bindingDataChangeEvent.unsubscribe();\r\n    }\r\n  }\r\n  /**\r\n   * è§¦åé¡µç åæ¢äºä»¶\r\n   * @description æ¬æ¹æ³éç¨åºæ¯ä»ä¸ºç¶çº§gridæ°æ®éæ°loadï¼éè¦è§¦åè¯¥gridéæ°åæ°ä½¿ç¨ãå¶ä»åºæ¯è¯·å¿ä½¿ç¨\r\n   * @TODO: å¾éæï¼æ§å¶ä¸çº§æ°æ®å è½½åºè¯¥ä¾èµè¡¨æ ¼çè¡åæ¢äºä»¶ï¼ä¸´æ¶è¿æ ·å¤çï¼åç»­æä¾LoadChildrenäºä»¶\r\n   */\r\n  private updateData(change?: Change) {\r\n    if (!(change && (change.type === ChangeType.SelectionChanged || change.type === ChangeType.Load))) {\r\n      return;\r\n    }\r\n    const bindingPath = this.viewModel.bindingPath;\r\n    const eventBindingPath = '/' + change.path.join('/');\r\n    const isRetrieve = this.viewModel.frameContext.appContext.params.get('retrieveing') || false;\r\n    if (change.path.length < 1 || bindingPath === '/' || bindingPath === eventBindingPath || !bindingPath.startsWith(eventBindingPath)) {\r\n      return;\r\n    }\r\n    // retrieveæ¶ä¼èªå¨å¸¦åä»è¡¨ç¬¬ä¸é¡µåä»è¡¨ç¬¬ä¸è¡çä»ä»è¡¨æ°æ®ï¼æä»¥ä¸éè¦åå»åç¬è¯·æ±\r\n    if (isRetrieve) {\r\n      return;\r\n    }\r\n    const fullPaths = EntityPathConverter.toEntityPathArray(this.viewModel.bindingPath, this.bindingData);\r\n    const paths = fullPaths.slice(0, fullPaths.length - 1);\r\n    const parent = this.bindingList.parent;\r\n    const parentId = parent && parent[parent.primaryKey];\r\n    // ä¸çº§è¡¨æ²¡ææ°æ®\r\n    if (!parentId) {\r\n      return;\r\n    }\r\n    // è·ånodecode\r\n    const bindingPaths = this.viewModel.bindingPath.split('/').filter(item => item);\r\n    let nodeCode = bindingPaths[bindingPaths.length - 1];\r\n    nodeCode = nodeCode.substr(0, nodeCode.length - 1);\r\n    // const configPath = `/${nodeCode}_${parentId}`;\r\n    const configPath = `/${nodeCode}`;\r\n    let { pageIndex = 1 } = this.viewModel.frameContext.repository.entityCollection.getPaginationConfigByPath(configPath) || {};\r\n    const { pageSize = 0 } = this.viewModel.frameContext.repository.entityCollection.getPaginationConfigByPath(configPath) || {};\r\n\r\n    const parentNodeCode = change.path[change.path.length - 1];\r\n    const parentConfigPath = '/' + parentNodeCode.substring(0, parentNodeCode.length - 1);\r\n    const { pageSize: parentPageSize = 0 } = this.viewModel.frameContext.repository.entityCollection.getPaginationConfigByPath(parentConfigPath) || {};\r\n    const isQueryChild = this.viewModel.frameContext.appContext.params.get('queryChild') || false;\r\n    if (isQueryChild) {\r\n      // this.viewModel.frameContext.appContext.params.delete('queryChild');\r\n      pageIndex = 1;\r\n    }\r\n    // å½ä¸çº§è¡¨åæ¢è¡æ¶\r\n    if (parentPageSize + pageSize !== 0) {\r\n      this.viewModel.frameContext.appContext.params.set('forceQueryChild', true);\r\n      this.viewModel.frameContext.repository.queryChild(paths, pageIndex, pageSize).pipe(\r\n        finalize(() => this.viewModel.frameContext.appContext.params.delete('forceQueryChild'))\r\n      ).subscribe();\r\n    }\r\n  }\r\n  ngOnDestroy() {\r\n    this.unRegisterBindingDataChangeEvent();\r\n  }\r\n  // #endregion\r\n\r\n  // #region äºä»¶åå°å¨\r\n\r\n  /**\r\n   * åå°éä¸­è¡åæ¢äºä»¶\r\n   * @description ç»ä¸åéæ¨¡å¼åå¤éæ¨¡å¼ä¸çè¡åæ¢äºä»¶\r\n   */\r\n  protected fireSelectedRowChange(selectedRowContext: any) {\r\n    this.selectedRowChange.emit(selectedRowContext);\r\n  }\r\n  /**\r\n   * æ¸ç©ºéå®è¡\r\n   * @param change åæ´\r\n   */\r\n  private clearCheckedRows(change: Change) {\r\n    if (change.type === ChangeType.Load && this.grid.multiSelect) {\r\n      const isMatch = this.checkIfChangeMatchBindingPath(change);\r\n      if (isMatch) {\r\n        this.setChecks([]);\r\n        if (typeof (this.grid.clearCheckeds) === 'function') {\r\n          this.grid.clearCheckeds();\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  // #endregion\r\n\r\n\r\n\r\n  // #region éä¿¡\r\n\r\n  /**\r\n   * è®¾ç½®BindingListçå½åè¡\r\n   * @param id å½åè¡åç \r\n   */\r\n  protected setSelectionIdToBindingData(id: string): void {\r\n    // å¦æå½åè¡ä¸å­å¨ï¼åå¼ºå¶è®¾ç½®\r\n    if (!id) {\r\n      this.bindingList.currentId = id;\r\n      if (!this.grid.multiSelect) {\r\n        this.setChecks([]);\r\n      }\r\n      return;\r\n    }\r\n    if (this.bindingList.currentId !== id) {\r\n      this.bindingList.setCurrentId(id, true);\r\n    }\r\n    // åéæ¨¡å¼ä¸å°å½åè¡è®¾ç½®å°ids\r\n    if (!this.grid.multiSelect) {\r\n      this.setChecks([id]);\r\n    }\r\n  }\r\n  private updateCheckedRows(changes: Change) {\r\n    if (changes.type === ChangeType.Load) {\r\n      this.setCheckedRows();\r\n    } else if (changes.type === ChangeType.ValueChanged) {\r\n      const ids = this.getChecks();\r\n      if (changes.id && ids.includes(changes.id)) {\r\n        this.setCheckedRows();\r\n      }\r\n    }\r\n  }\r\n  /**\r\n   * è®¾ç½®éæ©è¡\r\n   */\r\n  protected setChecks(ids: string[]) {\r\n    this.viewModel.uiState.setPropertyValue('ids', ids);\r\n    this.setCheckedRows(ids);\r\n  }\r\n  /**\r\n   * è·åå¾éè¡idæ°ç»\r\n   * @returns\r\n   */\r\n  protected getChecks(): string[] {\r\n    return this.viewModel.uiState['ids'] || [];\r\n  }\r\n  /**\r\n   * æ´æ°å¾éè¡æ°æ®\r\n   */\r\n  protected setCheckedRows(ids?: string[]) {\r\n    // é«éæ¨¡å¼æ¶ä¸åè®¾ç½®rows\r\n    // if (this.viewModel.frameContext.appContext.runMode === RunMode.highSpeed) {\r\n    //   return;\r\n    // }\r\n    if (typeof ids === 'undefined') {\r\n      ids = this.viewModel.uiState['ids'] || [];\r\n    }\r\n    if (!Array.isArray(ids) || ids.length < 1) {\r\n      // æ­¤æ¶idsæ²¡æå¼ï¼rowsä¸­ä¹ä¸åºè¯¥æ\r\n      this.viewModel.uiState.setPropertyValue('rows', null);\r\n      return;\r\n    }\r\n    let list = [];\r\n    // TODOï¼rowsä¸­æ°æ®å¨é«éæ¨¡å¼åæ®éæ¨¡å¼ä¸å¤è¯­å­æ®µçå¼è¡¨ç°ä¸ä¸è´ï¼é«éæ¨¡å¼ä¸å¤è¯­å­æ®µå¼ä¸ºå¯¹è±¡ï¼æ®éæ¨¡å¼ä¸ºå½åè¯­è¨ãæä¸å¤çé«éæ¨¡å¼åºæ¯\r\n    if (this.viewModel.frameContext.appContext.runMode === RunMode.highSpeed) {\r\n      list = this.grid.data || [];\r\n    } else {\r\n      list = this.bindingList.toJSON({ ignoreMultiLangInput: true });\r\n    }\r\n    const rows: Map<string, any> = this.viewModel.uiState['rows'] || new Map<string, any>();\r\n\r\n    const result = new Map<string, any>();\r\n    ids.forEach((id: any) => {\r\n      const item = list.find(item => item[this.primaryKey] === id);\r\n      const otherPageItem = rows.get(id);\r\n      if (item) {\r\n        result.set(id, item);\r\n      } else if (otherPageItem) {\r\n        result.set(id, otherPageItem);\r\n      }\r\n    });\r\n    this.viewModel.uiState.setPropertyValue('rows', result);\r\n  }\r\n  /**\r\n   * éä¸­gridè¡\r\n   * @param id id\r\n   */\r\n  protected selectGridRow(id: any) {\r\n    this.grid.selectRow(id);\r\n    this.grid.scrollToCurrentRow();\r\n  }\r\n  // #endregion\r\n  // #region äºä»¶å¤çå¨\r\n\r\n  /**\r\n   * é¡µç åæ¢äºä»¶\r\n   * @param event event\r\n   */\r\n  @HostListener('pageChanged', ['$event'])\r\n  public pageChangedHandler(event: any) {\r\n    let { pageIndex, pageSize } = event;\r\n    if (pageIndex < 1) {\r\n      pageIndex = 1;\r\n    }\r\n    const skip = (pageIndex - 1) * pageSize;\r\n    this.bindingData.setPagingInfo(skip, pageSize, this.bindingData.bindingPath);\r\n  }\r\n\r\n  /**\r\n   * è¡åæ¢äºä»¶\r\n   * @param event event\r\n   */\r\n  @HostListener('selectChanged', ['$event'])\r\n  public selectedRowChanged(event: any) {\r\n    const { index, data } = event;\r\n    const id = data[this.primaryKey];\r\n    this.setSelectionIdToBindingData(id);\r\n    this.fireSelectedRowChange(event);\r\n  }\r\n\r\n  /**\r\n   * åæ¶è¡éæ©äºä»¶\r\n   * @param event event\r\n   */\r\n  @HostListener('unSelect', ['$event'])\r\n  public unSelected(event: any) {\r\n    if (!event) {\r\n      return;\r\n    }\r\n    const { data = {} } = event;\r\n    const id = data[this.primaryKey];\r\n    const currentId = this.bindingList.currentId;\r\n    if (id === currentId) {\r\n      this.setSelectionIdToBindingData(null);\r\n    }\r\n    // this.fireSelectedRowChange(event);\r\n  }\r\n  /**\r\n   * å¾éè¡åçåå\r\n   * @param event event\r\n   */\r\n  @HostListener('checkedChange', ['$event'])\r\n  public checkedChanged(event: any) {\r\n    event = event || [];\r\n    const ids = event.map(item => item.id);\r\n    this.setChecks(ids);\r\n  }\r\n  /**\r\n   * åé¡µå¤§å°åæ´äºä»¶\r\n   * @param event event\r\n   */\r\n  @HostListener('pageSizeChanged', ['$event'])\r\n  public pageSizeChanged(event: any) {\r\n    const { pageIndex, pageSize } = event;\r\n    const skip = 0;//(pageIndex - 1) * pageSize;\r\n    // this.bindingList.setPaginationInfo(skip, pageSize);\r\n    this.bindingData.setPagingInfo(skip, pageSize, this.bindingData.bindingPath);\r\n  }\r\n\r\n  /**\r\n   * gridæ»å¨å è½½æ°æ®\r\n   * @param event event\r\n   */\r\n  @HostListener('scrollYLoad', ['$event'])\r\n  public scrollY(event: any) {\r\n    const { pager: pageIndex, pageSize } = event;\r\n    const skip = (pageIndex - 1) * pageSize;\r\n    this.bindingData.setPagingInfo(skip, pageSize, this.bindingData.bindingPath);\r\n  }\r\n  @HostListener('filterChanged', ['$event'])\r\n  public filterChanged(event: any) {\r\n    this.filters = event;\r\n  }\r\n  // #endregion\r\n  private checkIfChangeMatchBindingPath(change: Change): boolean {\r\n    let isMatch = false;\r\n    if (!change || !change.path) {\r\n      return isMatch;\r\n    }\r\n\r\n    const changePathArray = change.path;\r\n    if (!changePathArray) {\r\n      return isMatch;\r\n    }\r\n\r\n    if (!(this.bindingData) && !(this.bindingData.bindingPath)) {\r\n      return isMatch;\r\n    }\r\n    const bingdingPathArray = this.bindingData.bindingPath.split('/');\r\n    if (bingdingPathArray.length <= 0) {\r\n      return isMatch;\r\n    }\r\n\r\n    if (changePathArray.length === 0) { // ä¸»è¡¨\r\n      if (this.bindingData.bindingPath === '/') {\r\n        isMatch = true;\r\n      }\r\n    } else if (change.path.length === 1) {// ä¸»ä»è¡¨\r\n      if (bingdingPathArray.length === 2 && bingdingPathArray[1] === change.path[0]) {\r\n        isMatch = true;\r\n      }\r\n    } else if (change.path.length === 2) { // ä¸»ä»ä»è¡¨\r\n      if (bingdingPathArray.length === 3 && bingdingPathArray[1] === change.path[0] && bingdingPathArray[2] === change.path[1]) {\r\n        isMatch = true;\r\n      }\r\n    }\r\n\r\n    return isMatch;\r\n  }\r\n  private debounce(callback: (...args) => any, wait) {\r\n    let timeoutId = null;\r\n    return (...args) => {\r\n      window.clearTimeout(timeoutId);\r\n      timeoutId = window.setTimeout(() => {\r\n        callback.apply(null, args);\r\n      }, wait);\r\n    };\r\n  }\r\n}\r\n","import { Directive, Input, Self, Host, Optional, OnInit, Output, EventEmitter } from '@angular/core';\r\nimport { MultiSelectComponent } from '@farris/ui-multi-select'\r\nimport { ViewModel, BindingObject } from '@farris/devkit';\r\n\r\n@Directive({\r\n  selector: '[multiSelectDataMapping]'\r\n})\r\nexport class MultiSelectDataMappingDirective implements OnInit {\r\n\r\n  @Input() dataSource: any;\r\n  @Input() idField: string;\r\n  @Input() textField: string;\r\n  @Input() valueField: string;\r\n  @Input() fjmField: string;\r\n  @Input() fjdField: string;\r\n  @Input() uiStateField: any;\r\n  @Input() selectedId: string;\r\n  @Output() selectedIdChanged = new EventEmitter<string>();\r\n  private originalDataSource: any;\r\n\r\n  constructor(\r\n    @Optional() private vm: ViewModel,\r\n    @Host() @Self() @Optional() private multiSelectComponent: MultiSelectComponent\r\n  ) {\r\n    this.vm.uiState.changes.subscribe(data => {\r\n      this.selectedId = data.value;\r\n    })\r\n  }\r\n  ngOnInit() {\r\n    this.multiSelectComponent.dataSource = [];\r\n    if (Array.isArray(this.dataSource)) {\r\n      this.multiSelectComponent.dataSource = this.dataSource;\r\n      this.originalDataSource = this.dataSource;\r\n    } else if (this.dataSource && this.dataSource.changes) {\r\n      this.dataSource.changes.subscribe((data: any) => {\r\n        if (data.type === 'Load') {\r\n          this.originalDataSource = data.value;\r\n          if (this.multiSelectComponent.isTree()) {\r\n            if (this.fjmField) {\r\n              // åçº§ç å è½½æ ç»æ\r\n              this.multiSelectComponent.dataSource = this.plainToTree(data.value, this.fjmField, 1);\r\n            } else if (this.fjdField) {\r\n              // ç¶èç¹å è½½æ ç»æ\r\n              this.multiSelectComponent.dataSource = this.buildTreeNodesByFjd(data.value, this.fjdField);\r\n            }\r\n            this.multiSelectComponent.selections = this.getTreeSelectionsById(this.selectedId, this.originalDataSource);\r\n          } else {\r\n            this.multiSelectComponent.dataSource = data.value;\r\n            this.multiSelectComponent.selections = this.getListSelectionsById(this.selectedId, this.multiSelectComponent.dataSource);\r\n          }\r\n        }\r\n      })\r\n    }\r\n    this.selectIdBindingToUIStateField();\r\n  }\r\n\r\n  private selectIdBindingToUIStateField() {\r\n    if (this.multiSelectComponent && this.multiSelectComponent.selectedIdChange) {\r\n      this.multiSelectComponent.selectedIdChange.subscribe(data => {\r\n        this.selectedIdChanged.emit(data);\r\n      })\r\n    }\r\n  }\r\n  /**\r\n   * \r\n   * @param data éè¦æ ¼å¼åçæ°æ®\r\n   */\r\n  private formatDataSource(data: any[], field: string) {\r\n    if (!data || !data.length) {\r\n      return [];\r\n    }\r\n    return data.map(item => {\r\n      const n = item['toJSON'] ? item.toJSON() : item;\r\n      return {\r\n        data: Object.assign({ ...n }, {\r\n          [`${this.idField}`]: item[this.idField],\r\n          [`${this.textField}`]: item[this.textField],\r\n          [`${this.valueField}`]: item[this.valueField],\r\n          [`${field}`]: item[field]\r\n        }),\r\n        children: []\r\n      }\r\n    });\r\n  }\r\n  /**\r\n   * æå¹³è¡ç»æçæ°æ®è½¬æ¢ææ å½¢ç»æ\r\n   * @param plainSource \r\n   * @param field \r\n   * @param layer \r\n   */\r\n  private plainToTree(plainSource: any[], field: string, layer: number) {\r\n    const treeSource = this.formatDataSource(plainSource, field);\r\n    if (!treeSource.length) {\r\n      return [];\r\n    }\r\n    if (!treeSource[0]['data'][field]) {\r\n      return [];\r\n    }\r\n    const parents = treeSource.filter(item => {\r\n      return item['data'][field]['layer'] === layer;\r\n    })\r\n    this.recursive(parents, treeSource, field, 1);\r\n    return parents;\r\n  }\r\n\r\n  /**\r\n   * éå½éåæ å½¢ç»æ\r\n   * @param parents \r\n   * @param treeSource \r\n   * @param field \r\n   * @param layer \r\n   */\r\n  private recursive(parents: any[], treeSource: any[], field: string, layer: number) {\r\n    parents.forEach(parent => {\r\n      const parentPath = parent['data'][field]['path'];\r\n      const parentLayer = parent['data'][field]['layer'];\r\n      if (parent['data'][field]['isDetail'] === false) {\r\n        treeSource.forEach(item => {\r\n          if (item && item['data'] && item['data'][field] && item['data'][field]['path']) {\r\n            const itemPath = item['data'][field]['path'];\r\n            const itemLayer = item['data'][field]['layer'];\r\n            let targetPath: string;\r\n            if (itemPath && itemPath.length > parentPath.length) {\r\n              targetPath = itemPath.substr(0, Number(layer) * 4);\r\n            }\r\n            if (parentPath === targetPath && parentLayer === itemLayer - 1) {\r\n              parent['children'].push(item);\r\n            }\r\n            if (item['data'][field]['isDetail'] === false && parentPath === targetPath) {\r\n              this.recursive([item], treeSource, field, Number(layer) + 1);\r\n            }\r\n          }\r\n        });\r\n      }\r\n    })\r\n  }\r\n  /**\r\n     * \r\n     * @param ids éä¸­æ°æ®çid\r\n     * @param dataSource åå§æ°æ®\r\n     */\r\n  private getListSelectionsById(ids: any, dataSource: any) {\r\n    let result = [];\r\n    const _this = this;\r\n    if ((typeof ids === 'string' && !!ids) || typeof ids === 'number') {\r\n      const reusltObj = dataSource.find(item => {\r\n        return item && item[_this.idField] === ids;\r\n      });\r\n      if (reusltObj) {\r\n        result.push(reusltObj);\r\n      }\r\n    } else if (Array.isArray(ids)) {\r\n      if (dataSource) {\r\n        ids.forEach(id => {\r\n          const item = dataSource.find(item => item && item[_this.idField] === id);\r\n          if (item) {\r\n            result.push(item);\r\n          }\r\n        });\r\n        // dataSource.forEach(item => {\r\n        //   ids.forEach(id => {\r\n        //     if (item[_this.idField] === id) {\r\n        //       result.push(item);\r\n        //     }\r\n        //   })\r\n        // })\r\n      } else {\r\n        result = [];\r\n      }\r\n    } else {\r\n      result = [];\r\n    }\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param ids éä¸­æ°æ®çid\r\n   * @param dataSource åå§æ°æ®\r\n   */\r\n  private getTreeSelectionsById(ids: any, dataSource: any) {\r\n    let result = [];\r\n    const _this = this;\r\n    if ((typeof ids === 'string' && !!ids) || typeof ids === 'number') {\r\n      const reusltObj = dataSource.find(item => {\r\n        return item && item[_this.idField] === ids;\r\n      });\r\n      if (reusltObj) {\r\n        result.push(reusltObj);\r\n      }\r\n    } else if (Array.isArray(ids)) {\r\n      if (dataSource) {\r\n        ids.forEach(id => {\r\n          const item = dataSource.find(item => item && item[_this.idField] === id);\r\n          if (item) {\r\n            result.push(item);\r\n          }\r\n        });\r\n        // dataSource.forEach(item => {\r\n        //   ids.forEach(id => {\r\n        //     if (item.data[_this.idField] === id) {\r\n        //       result.push(item.data);\r\n        //     }\r\n        //   })\r\n        // })\r\n      } else {\r\n        result = [];\r\n      }\r\n    } else {\r\n      result = [];\r\n    }\r\n    return result;\r\n  }\r\n\r\n\r\n\r\n  /**\r\n   * æ ¹æ®ç¶èç¹åå§åæ ç»æ\r\n   * @param bindingObjects \r\n   */\r\n  private buildTreeNodesByFjd(bindingObjects: BindingObject[], field: string) {\r\n    const treeData = this.formatDataSource(bindingObjects, field);\r\n    treeData.forEach((item: any) => {\r\n      const parent = treeData.find((ele: any) => item.data[field].parentElement === ele.data[this.idField]);\r\n      if (parent) {\r\n        parent.children.push(item);\r\n      }\r\n    });\r\n    return treeData.filter((ele: any) => !ele.data[field].parentElement);\r\n  }\r\n}\r\n","import { Subscription } from 'rxjs';\r\nimport { Directive, OnInit, HostListener, Output, EventEmitter, OnDestroy, OnChanges, Input, ChangeDetectorRef } from '@angular/core';\r\nimport { BindingData, BindingList, ViewModel, Change } from '@farris/devkit';\r\nimport { ListViewComponent } from '@farris/ui-list-view';\r\n@Directive({\r\n  selector: '[farrisListviewBinding]'\r\n})\r\n\r\nexport class FarrisListViewBindingDirective implements OnInit, OnDestroy, OnChanges {\r\n  bindingDataChangeEvent: Subscription;\r\n\r\n  /**\r\n   * ä¸»é®\r\n   */\r\n  protected get primaryKey() {\r\n    return this.bindingList.primaryKey;\r\n  }\r\n\r\n  @Input() supportPaged: boolean = true;\r\n  /**\r\n   * éä¸­è¡åæ¢äºä»¶\r\n   */\r\n  @Output() selectedRowChange: EventEmitter<any> = new EventEmitter<any>();\r\n\r\n  constructor(\r\n    private bindingData: BindingData,\r\n    private viewModel: ViewModel,\r\n    private listview: ListViewComponent) {\r\n\r\n  }\r\n\r\n  ngOnInit() {\r\n    // ç»å®æ°æ®\r\n    this.bindData();\r\n    this.registerBindingDataChangeEvent();\r\n\r\n  }\r\n\r\n  ngOnChanges() {\r\n    this.bindData();\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.unRegisterBindingDataChangeEvent();\r\n  }\r\n\r\n  /**\r\n   * è·ååé¡µä¿¡æ¯\r\n   */\r\n  protected getPagingInfo() {\r\n    const bindingPath = this.viewModel.bindingPath;\r\n    const bindingData = this.viewModel.bindingData;\r\n    let pagingInfo = bindingData.pagingInfo;\r\n    if (bindingPath === '/') {\r\n      return pagingInfo;\r\n    } else {\r\n      const bindingPaths = bindingPath.substr(1).split('/').filter(item => !!item && item.length > 0).map(item => {\r\n        return item.substring(0, item.length - 1);\r\n      });\r\n      bindingPaths.forEach(path => {\r\n        pagingInfo = pagingInfo && pagingInfo[path];\r\n      });\r\n      return pagingInfo;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * è®¾ç½®listviewå±æ§\r\n   */\r\n  private setListViewPageProps() {\r\n    const data = this.bindingList.toJSON();\r\n    let skip = 0;\r\n    const { pageIndex = 1, pageSize = 0 } = this.getPagingInfo() || {};\r\n    let { total = 0 } = this.getPagingInfo() || {};\r\n    if (pageIndex > 0) {\r\n      skip = (pageIndex - 1) * pageSize;\r\n    }\r\n    if (pageSize === 0 && total === 0) {\r\n      total = data.length;\r\n    }\r\n    this.listview.supportPaging = this.supportPaged;\r\n    this.listview.pageIndex = pageIndex;\r\n    this.listview.pageSize = pageSize;\r\n    this.listview.total = total;\r\n    let currentPage = pageIndex;\r\n    const itemsPerPage = pageSize;\r\n    let totalItems = total;\r\n    if (pageSize === 0) {\r\n      // this.listview.supportPaging = false;\r\n      this.listview.pageIndex = pageIndex;\r\n      this.listview.total = total;\r\n      currentPage = 1;\r\n      totalItems = total;\r\n    }\r\n    if (this.listview.paginationOptions) {\r\n      this.listview.paginationOptions.itemsPerPage = itemsPerPage;\r\n      this.listview.paginationOptions.currentPage = currentPage;\r\n      this.listview.paginationOptions.pageList = this.listview.pageList;\r\n      this.listview.paginationOptions.totalItems = totalItems;\r\n    }\r\n    const listViewChangeDetectRef: ChangeDetectorRef = this.listview['cdr'] as ChangeDetectorRef;\r\n    if (listViewChangeDetectRef) {\r\n      listViewChangeDetectRef.detectChanges();\r\n    }\r\n    const paginationDirective = this.listview.pager && this.listview.pager['paginationDirective'];\r\n    if (paginationDirective && paginationDirective['service']) {\r\n      try {\r\n        paginationDirective['service'].instances[this.listview.pager.id] = { ...this.listview.paginationOptions };\r\n        paginationDirective['service'].setTotalItems(this.listview.pager.id, totalItems);\r\n        paginationDirective.changeDetectorRef.detectChanges();\r\n      } catch { }\r\n    }\r\n  }\r\n\r\n  /*\r\n   * è·åç»å®æ°æ®\r\n   */\r\n  protected get bindingList(): BindingList {\r\n    // æ ¹å®ä½\r\n    if (this.viewModel.bindingPath === '/' || !this.viewModel.bindingPath) {\r\n      return this.bindingData.list;\r\n    }\r\n    // å­å®ä½\r\n    let bindingPath = this.viewModel.bindingPath.substr(1);\r\n    bindingPath = bindingPath[0].toLowerCase() + bindingPath.substring(1, bindingPath.length);\r\n    const paths = bindingPath.split('/');\r\n\r\n    const filteredPaths = paths.filter((part: string) => {\r\n      return part !== '';\r\n    });\r\n    return this.bindingData.getValue(filteredPaths);\r\n  }\r\n\r\n  /* ç»å®æ°æ® */\r\n  private bindData() {\r\n    this.setListViewPageProps();\r\n    const data = this.bindingList.toArray();\r\n    this.listview.setData(data);\r\n  }\r\n\r\n  /*\r\n       * åå°éä¸­è¡åæ¢äºä»¶\r\n       * @description ç»ä¸åéæ¨¡å¼åå¤éæ¨¡å¼ä¸çè¡åæ¢äºä»¶\r\n       */\r\n  protected fireSelectedRowChange(selectedRowContext: any) {\r\n    this.selectedRowChange.emit(selectedRowContext);\r\n  }\r\n\r\n  /**\r\n   * è®¾ç½®BindingListçå½åè¡\r\n   * @param id å½åè¡åç \r\n   */\r\n  protected setSelectionIdToBindingData(id: string): void {\r\n    this.bindingList.setCurrentId(id, true);\r\n  }\r\n\r\n  /**\r\n   * æ°æ®æºåçåæ´\r\n   * @param change åæ´\r\n   */\r\n  protected onBindingDataChange(change: Change) {\r\n    this.bindData();\r\n    this.updateSelectedRow(change);\r\n  }\r\n  /**\r\n   * è®¾ç½®å½åè¡\r\n   * @param change åæ´\r\n   */\r\n  private updateSelectedRow(change?: Change) {\r\n    if (!this.bindingList || !this.bindingList.currentId) {\r\n      return;\r\n    }\r\n    if (this.viewModel && this.viewModel.frameContext.bindingData.rowSelectedEventSuspend === true) {\r\n      return;\r\n    }\r\n    const { id = null } = this.listview.clickItem || {};\r\n    const currentId = this.bindingList.currentId;\r\n    // gridå½åè¡ä¸bingingListå½åè¡ä¸è´ï¼æ é¡»åæ¢\r\n    if (id === currentId) {\r\n      return;\r\n    }\r\n    this.selectRow(this.bindingList.currentId);\r\n  }\r\n  protected selectRow(id: any) {\r\n    if (this.listview && typeof this.listview.selectRow === 'function') {\r\n      this.listview.selectRow(id);\r\n    }\r\n  }\r\n  /**\r\n   * æ³¨åbindingdataååäºä»¶\r\n   */\r\n  private registerBindingDataChangeEvent() {\r\n    this.bindingDataChangeEvent = this.bindingData.changes.subscribe((change: Change) => {\r\n      this.onBindingDataChange(change);\r\n    });\r\n  }\r\n  /**\r\n   * åæ¶bindingdataååè®¢é\r\n   */\r\n  private unRegisterBindingDataChangeEvent() {\r\n    this.bindingDataChangeEvent.unsubscribe();\r\n  }\r\n  private setChecks(ids: string[]) {\r\n    this.viewModel.uiState.setPropertyValue('ids', ids);\r\n  }\r\n  /* åæ¢è¡äºä»¶ */\r\n  @HostListener('listClick', ['$event'])\r\n  changeRow(event: any) {\r\n    const { index, data, checkChangeEvent } = event;\r\n    if (checkChangeEvent === false || !event.hasOwnProperty('checkChangeEvent')) {\r\n      if (data && Array.isArray(data) && data.length > 0) {\r\n        const id = data[0] && data[0][this.primaryKey] || null;\r\n        if (id) {\r\n          this.setSelectionIdToBindingData(id);\r\n        }\r\n      }\r\n      this.listview.activeIndex = index;\r\n      this.fireSelectedRowChange(event);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * åæ¢é¡µç è§¦åäºä»¶\r\n   * @param event åæ¢é¡µç åæ°\r\n   */\r\n  @HostListener('pageChanged', ['$event'])\r\n  public pageChangedHandler(event: any) {\r\n    let pageIndex = event.pageInfo.pageIndex;\r\n    const pageSize = event.pageInfo.pageSize;\r\n    if (pageIndex < 1) {\r\n      pageIndex = 1;\r\n    }\r\n    const skip = (pageIndex - 1) * pageSize;\r\n    this.bindingData.setPagingInfo(skip, pageSize, this.bindingData.bindingPath);\r\n  }\r\n\r\n  /**\r\n   * è®¾ç½®æ¯é¡µæ°æ®æ¡æ°è§¦åäºä»¶\r\n   * @param event åæ¢é¡µç åæ°\r\n   */\r\n  @HostListener('pageSizeChanged', ['$event'])\r\n  public pageSizeChangedHandler(event: any) {\r\n    const { pageIndex, pageSize } = event.pageInfo;\r\n    const skip = (pageIndex - 1) * (+pageSize);\r\n    this.bindingData.setPagingInfo(skip, pageSize, this.bindingData.bindingPath);\r\n  }\r\n  @HostListener('checkValuesChange', ['$event'])\r\n  public checkValuesChange(event: any) {\r\n    const ids = event;\r\n    this.setChecks(ids);\r\n  }\r\n}\r\n","import {\r\n  Directive, OnInit, OnChanges, OnDestroy, SimpleChanges, Input, Injector, NgZone,\r\n} from '@angular/core';\r\nimport { of, Subscription } from 'rxjs';\r\nimport {\r\n  BindingData, BindingList, ViewModel, DataTypeInfo, DataPropInfo, ENABLE_EDIT_STATE_FILTER_SORTING\r\n} from '@farris/devkit';\r\nimport { DatagridComponent } from '@farris/ui-datagrid';\r\nimport { isNumber } from 'lodash-es';\r\nimport { DateTimeHelperService } from '@farris/ui-common/date';\r\nimport { RuntimeStateService } from '@farris/ui-common';\r\nimport { DialogService } from '@farris/ui-dialog';\r\nimport { LookupGridComponent } from '@farris/ui-lookup';\r\nimport { ComboLookupComponent } from '@farris/ui-combo-lookup';\r\n\r\n@Directive({\r\n  selector: '[farris-datagrid-editable]'\r\n})\r\nexport class EditableDirective implements OnInit, OnChanges, OnDestroy {\r\n  /**\r\n   * gridæ¯å¦å¯ä»¥ç¼è¾\r\n   */\r\n  @Input('farris-datagrid-editable') gridEditable: boolean;\r\n  /**\r\n   * ç¼è¾æ¶åæ¶åç»\r\n   */\r\n  @Input('disableGroupOnEditing') disableGroupOnEditing: boolean = true;\r\n  /**\r\n   * å¤éå¸®å©é»è®¤åéç¬¦\r\n   */\r\n  private defaultSpliter: string = ',';\r\n  private beginEditSubscription: Subscription;\r\n  private endEditSubscription: Subscription;\r\n  /**\r\n   * ä¸´æ¶è®°å½gridåç»å­æ®µ\r\n   */\r\n  private groupFields: any[] = [];\r\n  protected get bindingList(): BindingList {\r\n    // æ ¹å®ä½\r\n    if (this.viewModel.bindingPath === '/' || !this.viewModel.bindingPath) {\r\n      return this.bindingData.list;\r\n    }\r\n    // å­å®ä½\r\n    let bindingPath = this.viewModel.bindingPath.substr(1);\r\n    bindingPath = bindingPath[0].toLowerCase() + bindingPath.substring(1, bindingPath.length);\r\n    const paths = bindingPath.split('/');\r\n\r\n    const filteredPaths = paths.filter((part: string) => {\r\n      return part !== '';\r\n    });\r\n    return this.bindingData.getValue(filteredPaths);\r\n  }\r\n  constructor(\r\n    public bindingData: BindingData,\r\n    public viewModel: ViewModel,\r\n    public grid: DatagridComponent,\r\n    private dateService: DateTimeHelperService,\r\n    public injector: Injector,\r\n    private rts: RuntimeStateService,\r\n    public dialogSer: DialogService,\r\n    public ngZone: NgZone\r\n  ) { }\r\n\r\n  ngOnInit() {\r\n    this.apply();\r\n  }\r\n  ngOnChanges(changes: SimpleChanges) {\r\n    this.apply();\r\n  }\r\n  ngOnDestroy() {\r\n    this.detach();\r\n  }\r\n  /**\r\n   * åºç¨å±æ§\r\n   */\r\n  private apply() {\r\n    if (!this.grid) {\r\n      return;\r\n    }\r\n    this.handleGroupStatus();\r\n    // æ¯å¦å¯ç¨äºç¼è¾æè¿æ»¤æåº\r\n    if (this.gridEditable) {\r\n      const enableFilterSorting = this.injector && this.injector.get<boolean>(ENABLE_EDIT_STATE_FILTER_SORTING, false) || false;\r\n      if (!this.grid.remoteFilter && !enableFilterSorting) {\r\n        this.grid.clearCondition();\r\n        // åéæ¸ç©ºè¿æ»¤æ¡ä»¶äºä»¶\r\n        this.viewModel.frameContext.appContext.messagePipe.next('CLEAR_GRID_CONDITION');\r\n      }\r\n\r\n      this.grid.editable = true;\r\n      if (!this.viewModel.frameContext.appContext.enableGridHeaderWhenEditing && !enableFilterSorting) {\r\n        this.grid.disableHeader(true);\r\n      }\r\n      this.handleBeginEditEvent();\r\n      this.handleAfterEditEvent();\r\n      this.handleEndEditEvent();\r\n    } else {\r\n      this.grid.editable = false;\r\n      this.grid.disableHeader(false);\r\n      // TODO:åºç±è¡¨æ ¼å¼å®¹ï¼ä½ç®åè¡¥ä¸ä¸è½ç»§ç»­ä¾èµè¡¨æ ¼ç»ä»¶ï¼ä¸´æ¶ä½¿ç¨è¯¥æ¹æ¡å¤ç\r\n      // 2023-12-25 è¡¨æ ¼åé¨å·²è§£å³åè®¾ç½®åè¡¨å¤´æ æ³æå¨é®é¢ï¼ä¸å¼å®¹ä»£ç å­å¨è¦çå¼åèè®¾ç½®çèªå®ä¹ååç§°çé®é¢\r\n      // this.grid.columns = this.grid.columns.map((cols) => {\r\n      //   return cols.map((col) => Object.assign({}, col));\r\n      // });\r\n      // this.grid.columnsChanged(false);\r\n      if (this.grid && typeof this.grid.sort === 'function' && this.grid.sortName) {\r\n        this.grid.sort();\r\n      }\r\n      this.detach();\r\n    }\r\n  }\r\n  /**\r\n   * ç¼è¾æ¶åæ¶åç»\r\n   */\r\n  private handleGroupStatus() {\r\n    if (this.disableGroupOnEditing === false) {\r\n      return;\r\n    }\r\n    const groupField = this.grid && this.grid.groupField || null;\r\n    if (groupField) {\r\n      if (this.gridEditable) {\r\n        this.groupFields = [groupField];\r\n        this.grid.setGroupFields('');\r\n      }\r\n    } else {\r\n      if (this.groupFields && this.groupFields.length > 0) {\r\n        const groupField = this.groupFields.pop();\r\n        if (this.groupFields.length > 0) {\r\n          this.groupFields = [];\r\n        }\r\n        this.grid.setGroupFields(groupField);\r\n      }\r\n    }\r\n  }\r\n  /**\r\n   * å¤çå¼å§ç¼è¾äºä»¶\r\n   */\r\n  private handleBeginEditEvent() {\r\n    this.beginEditSubscription = this.grid.beginEdit.subscribe((e: any) => {\r\n      if (!e) {\r\n        return;\r\n      }\r\n      const column = e.column;\r\n      if (column && column.editor) {\r\n        const editorInstance = e.editor.componentRef.instance;\r\n        if (!editorInstance || !editorInstance.instance) {\r\n          return;\r\n        }\r\n        let mapFields = editorInstance.instance.mapFields;\r\n        if (column.editor.type === 'lookup' || column.editor.type === 'PersonnelSelector' || column.editor.type === 'OrganizationSelector' || column.editor.type === 'external-integration' || 'EmployeeSelector' === column.editor.type || 'EmployeeOrgSelector' === column.editor.type) {\r\n          const lookupGrid: LookupGridComponent = editorInstance.instance;\r\n          const subject = editorInstance.instance.selectedData;\r\n          if (subject) {\r\n            subject.subscribe((data: any) => {\r\n              mapFields = editorInstance.instance.mapFields;\r\n              const spliter = lookupGrid.multipleChoiceSeparator || this.defaultSpliter;\r\n              this.lookupMapping(data, mapFields, false, spliter);\r\n            });\r\n          }\r\n          const clearMappings = editorInstance.instance.clearMappings;\r\n          if (clearMappings) {\r\n            clearMappings.subscribe((result: any) => {\r\n              const mapFields = Object.assign({}, editorInstance.instance.mapFields);\r\n              const value = result && result.value || null;\r\n              const binding = editorInstance.column && editorInstance.column.field;\r\n              const lookupTextField = editorInstance.instance.textField;\r\n              const data = {};\r\n              if (binding) {\r\n                const textFieldMapping = mapFields[lookupTextField];\r\n                if (textFieldMapping) {\r\n                  const otherField: string = textFieldMapping.split(',').filter((item) => item !== binding).join(',');\r\n                  if (otherField) {\r\n                    mapFields[lookupTextField] = otherField;\r\n                  } else {\r\n                    delete mapFields[lookupTextField];\r\n                  }\r\n                }\r\n                const parentPaths = this.getBindingPathArray();\r\n                this.bindingData.setValue(parentPaths.concat(binding.split('.')), value, true, true);\r\n              }\r\n              // this.setValue(data, lookupTextField.split('.'), value);\r\n              if (mapFields && Object.keys(mapFields).length > 0) {\r\n                Object.keys(mapFields).forEach((field) => {\r\n                  this.setValue(data, field.split('.'), '');\r\n                });\r\n                this.lookupMapping(data, mapFields, true);\r\n              }\r\n            });\r\n          }\r\n        }\r\n\r\n        if (column.editor.type === 'combo-lookup') {\r\n          editorInstance.instance.valueChange.subscribe((e: any) => {\r\n            const asClear = e && e.selections && e.selections.length === 0;\r\n            const comboLookup: ComboLookupComponent = editorInstance.instance;\r\n            mapFields = editorInstance.instance.mapFields;\r\n            const spliter = comboLookup.separator || this.defaultSpliter;\r\n            this.lookupMapping(e.selections || [], mapFields, asClear, spliter);\r\n          });\r\n        }\r\n        if (['combo-lookup', 'combolist', 'lookup', 'PersonnelSelector', 'OrganizationSelector', 'external-integration', 'EmployeeSelector', 'EmployeeOrgSelector'].includes(column.editor.type)) {\r\n          if (editorInstance.instance.clear && editorInstance.instance.clear.subscribe) {\r\n            editorInstance.instance.clear.subscribe(() => {\r\n              this.lookupMapping(null, mapFields);\r\n            });\r\n          }\r\n        }\r\n\r\n        if (column.editor.type === 'combolist') {\r\n          if (mapFields) {\r\n            editorInstance.instance.valueChange.subscribe((e) => {\r\n              const pathArr = this.getBindingPathArray();\r\n              this.viewModel.bindingData.setValue(pathArr.concat(mapFields.split('.')), editorInstance.instance.selectedValues, true, true);\r\n            });\r\n          }\r\n        }\r\n      }\r\n    });\r\n  }\r\n  /**\r\n   * å¤çç¼è¾äºä»¶\r\n   */\r\n  private handleAfterEditEvent() {\r\n    this.grid.afterEdit = (rowIndex, rowData, column, editor) => {\r\n      if (this.dialogSer.hasDialogOpened()) {\r\n        return of(false);\r\n      }\r\n      if (this.rts) {\r\n        // å¸®å©ç»ä»¶ææ¬åååå»æ¥è¯¢\r\n        if (this.rts.getFormState('lookup.pending')) {\r\n          return of(false);\r\n        }\r\n      }\r\n      // æ´æ°æ°æ®æº\r\n      if (!editor || !editor.formControl) {\r\n        return of(false);\r\n      }\r\n      return of(true);\r\n    };\r\n  }\r\n  /**\r\n   * å¤çç»æç¼è¾äºä»¶\r\n   */\r\n  private handleEndEditEvent() {\r\n    this.endEditSubscription = this.grid && this.grid.endEdit && this.grid.endEdit.subscribe((event: any) => {\r\n      const { value = undefined, column = undefined, rowData = {} } = event || {};\r\n      const primaryValue = rowData && rowData[this.grid.idField] || null;\r\n      this.updateBindingData(value, column, primaryValue);\r\n    });\r\n  }\r\n  /*\r\n   * ç»åè¡¨èµå¼ æç»formcontrolèµå¼\r\n   */\r\n  private updateBindingData(value: any, column: any, primaryValue?: any) {\r\n    if (!column) {\r\n      return;\r\n    }\r\n    const currentColumnType = column.dataType;\r\n    // åæ¶å¤æ­gridOptionçåå¯¹è±¡\r\n\r\n    const fieldPaths = column.field.split('.');\r\n    // æ¯å¦ä¸ºå¤§æ°\r\n    const isBigNumber = column && column.editor && column.editor.options && column.editor.options.bigNumber;\r\n    // å­å¨è¡ç¼è¾å¨\r\n    if (currentColumnType === 'date') {\r\n      let result;\r\n      if (value) {\r\n        result = this.dateService.formatTo(value, 'yyyy-MM-dd');\r\n      } else {\r\n        result = value;\r\n      }\r\n      this.updateBindingList(primaryValue, fieldPaths.join('.'), result);\r\n    } else if (currentColumnType === 'datetime') {\r\n      // if (!value) {\r\n      //   value = '0001-01-01T00:00:00';\r\n      // }\r\n      this.updateBindingList(primaryValue, fieldPaths.join('.'), value);\r\n    } else if (currentColumnType === 'number' && !isBigNumber) {\r\n      if (value === null || value === undefined) {\r\n        this.updateBindingList(primaryValue, fieldPaths.join('.'), null);\r\n      } else {\r\n        this.updateBindingList(primaryValue, fieldPaths.join('.'), Number(value));\r\n      }\r\n    } else {\r\n      this.updateBindingList(primaryValue, fieldPaths.join('.'), value);\r\n    }\r\n  }\r\n  private updateBindingList(primaryValue: any, propertyName: string, value: any) {\r\n    const viewModel = this.viewModel || null;\r\n    if (!viewModel || !propertyName) {\r\n      return;\r\n    }\r\n    // æ´æ°ä¸»è¡¨é¨åè¡çå­æ®µ\r\n    const propertyNames = propertyName.split('.').filter((item) => item);\r\n    const bindingPath = this.getBindingPathArray();\r\n    // ååºæ¥çä¸å®æ¯bindingList\r\n    const list = this.bindingData.getValue(bindingPath) as BindingList;\r\n    // ä¿®æ¹çæ¯å½åè¡\r\n    if (list && primaryValue === list.currentItem.primaryKeyValue) {\r\n      const paths = bindingPath.concat(propertyNames);\r\n      this.bindingData.setValue(paths, value, true, true);\r\n      return;\r\n    }\r\n    const bindingObject = this.bindingList.findById(primaryValue);\r\n    if (!bindingObject) {\r\n      return;\r\n    }\r\n    if (propertyNames.length < 2) {\r\n      bindingObject.setValue(propertyName, value, true, true);\r\n    } else {\r\n      let targetBindingObject = null;\r\n      const fpaths = propertyNames.slice(0, propertyNames.length - 1);\r\n      const targetPropertyName = propertyNames[propertyNames.length - 1];\r\n      fpaths.forEach((prop) => {\r\n        targetBindingObject = targetBindingObject && targetBindingObject[prop] || bindingObject[prop];\r\n      });\r\n      // todo:éè¦æ·»å å¼ååäºä»¶\r\n      targetBindingObject.setValue(targetPropertyName, value, true, true);\r\n    }\r\n  }\r\n  private detach() {\r\n    if (this.beginEditSubscription && typeof this.beginEditSubscription.unsubscribe === 'function') {\r\n      this.beginEditSubscription.unsubscribe();\r\n    }\r\n    if (this.endEditSubscription && typeof this.endEditSubscription.unsubscribe === 'function') {\r\n      this.endEditSubscription.unsubscribe();\r\n    }\r\n  }\r\n\r\n  //#region å¸®å©å­æ®µæ å°\r\n\r\n  private lookupMapping(helpData: any, mapFields: any, asClear: boolean = false, spliter: string = ',') {\r\n    if (!mapFields) {\r\n      return;\r\n    }\r\n    // å³é­åæ´æ£æµ\r\n    const appContext = this.viewModel.frameContext.appContext;\r\n    appContext.changeDetectionController.detach();\r\n\r\n    const pathArr = this.getBindingPathArray();\r\n    let helpFields = Object.keys(mapFields);\r\n    const primaryInfo = this.getMapFieldsPrimaryKey(mapFields, pathArr);\r\n\r\n    let primaryKeys = primaryInfo && primaryInfo.map((item) => item.primaryKey) || [];\r\n    const primaryFields = primaryInfo && primaryInfo.map((item) => item.primaryField) || [];\r\n    // å»é\r\n    if (primaryKeys && primaryKeys.length > 0) {\r\n      primaryKeys = [...new Set(primaryKeys)];\r\n      helpFields = this.sortMapFieldKeys(helpFields, primaryKeys);\r\n    }\r\n\r\n    if (!helpData || asClear) {\r\n      helpFields.reverse();\r\n    }\r\n    helpFields.forEach((f: any) => {\r\n      let val: any = '';\r\n      if (helpData) {\r\n        if (helpData instanceof Array) {\r\n          val = helpData.map((h: any) => {\r\n            return this.getValue(f, h);\r\n          }).join(spliter);\r\n        } else {\r\n          val = this.getValue(f, helpData);\r\n        }\r\n      }\r\n\r\n      let mappings: any[] = mapFields[f].split(',');\r\n      const headMappings = mappings.filter((p) => primaryFields.includes(p));\r\n      const leftMappings = mappings.filter((p) => !primaryFields.includes(p));\r\n      if (!helpData) {\r\n        mappings = [].concat(leftMappings).concat(headMappings);\r\n      } else {\r\n        mappings = [].concat(headMappings).concat(leftMappings);\r\n      }\r\n      mappings.forEach((ff: any) => {\r\n        if (!helpData) {\r\n          this.viewModel.bindingData.clearValue(pathArr.concat(ff.split('.')), true, true);\r\n        } else {\r\n          this.viewModel.bindingData.setValue(pathArr.concat(ff.split('.')), val, true, true);\r\n        }\r\n      });\r\n    });\r\n\r\n    // éæ°æå¼åæ´æ£æµ\r\n    appContext.changeDetectionController.reattach();\r\n  }\r\n\r\n  private getValue(f: string, data: any) {\r\n    let val = '';\r\n    if (f.indexOf('.') === -1) {\r\n      val = data[f];\r\n    } else {\r\n      val = f.split('.').reduce((a, b) => {\r\n        return a[b];\r\n      }, data);\r\n    }\r\n\r\n    return val;\r\n  }\r\n\r\n  private getBindingPathArray(): any[] {\r\n    const path = this.viewModel.bindingPath;\r\n    if (path) {\r\n      return path.split('/').filter((n) => n !== '');\r\n    }\r\n    return [];\r\n  }\r\n\r\n  private isNumberValue(field, data) {\r\n    const currentVal = this.getValue(field, data);\r\n    return isNumber(currentVal);\r\n  }\r\n\r\n  //#endregion\r\n  /**\r\n   *\r\n   * @param mapFields  æ ¼å¼å½¢å¦ï¼{id: \"assoField.assoField\", code: \"assoField.assoField_Code\", name: \"assoField.assoField_Name\"} æè {id:'vid',code:'code',name:'name'}\r\n   */\r\n  private getMapFieldsPrimaryKey(mapFields: any, bindingPaths: string[]): Array<{ primaryKey: string, primaryField: string }> {\r\n    if (!mapFields || Object.keys(mapFields).length < 1) {\r\n      return null;\r\n    }\r\n    const results = [];\r\n    // let primaryField = null;\r\n    try {\r\n      const entityTypeInfo: DataTypeInfo = this.viewModel.frameContext.repository.entityTypeInfo;\r\n      Object.keys(mapFields).forEach((key: string) => {\r\n        const mapField = mapFields[key];\r\n        if (mapField && typeof mapField === 'string') {\r\n          const mappings = mapField.split(',').filter((p) => p);\r\n          mappings.forEach((item: string) => {\r\n            let paths = item.split('.');\r\n            if (bindingPaths && bindingPaths.length > 0) {\r\n              paths = bindingPaths.concat(paths);\r\n            }\r\n            const propInfo: DataPropInfo = entityTypeInfo.getPropInfoByPath(paths);\r\n            if (propInfo && propInfo.metadataInfo && propInfo.metadataInfo.primary === true) {\r\n              results.push({\r\n                primaryKey: key,\r\n                primaryField: item\r\n              });\r\n            }\r\n          });\r\n        }\r\n      });\r\n    } catch (e) {\r\n      console.error(e);\r\n    }\r\n    return results;\r\n  }\r\n  private setValue(target: object, paths: string[], value: any) {\r\n    if (target) {\r\n      if (paths.length <= 1) {\r\n        target[paths[0]] = value;\r\n      } else {\r\n        paths.slice(0, -1).reduce((prev, path) => {\r\n          if (!(prev.hasOwnProperty(path) || prev['__proto__'].hasOwnProperty(path))) {\r\n            prev[path] = {};\r\n          }\r\n          return prev[path];\r\n        }, target)[paths[paths.length - 1]] = value;\r\n      }\r\n    }\r\n  }\r\n  private sortMapFieldKeys(keys: string[], primaryKeys: string[]): string[] {\r\n    if (!primaryKeys || primaryKeys.length < 1 || !keys || keys.length < 1) {\r\n      return keys;\r\n    }\r\n    // è¿æ»¤åºéä¸»é®æ å°å­æ®µ\r\n    keys = keys.filter((p) => !primaryKeys.includes(p));\r\n    return [].concat(primaryKeys).concat(keys);\r\n  }\r\n}\r\n","import { AppContext } from '@farris/devkit';\r\nimport { Subject } from 'rxjs';\r\nimport { OnDestroy } from '@angular/core';\r\n\r\nabstract class AbstractEndEdit implements OnDestroy {\r\n  private messagePipe: Subject<any>;\r\n  constructor(protected appContext: AppContext) {\r\n    this.messagePipe = this.appContext && this.appContext.messagePipe;\r\n    if (this.messagePipe) {\r\n      this.messagePipe.subscribe((message: any) => {\r\n        if (message && message.type === 'endEdit') {\r\n          this.endEdit(message);\r\n        }\r\n      });\r\n    }\r\n  }\r\n  ngOnDestroy(): void {\r\n    // if (this.messagePipe) {\r\n    //   this.messagePipe.unsubscribe();\r\n    // }\r\n  }\r\n  public abstract endEdit(message: any);\r\n}\r\nexport { AbstractEndEdit };\r\n","import { Directive, ElementRef, OnInit, OnChanges, SimpleChanges } from '@angular/core';\r\nimport { AppContext } from '@farris/devkit';\r\nimport { AbstractEndEdit } from './abstract_end_edit';\r\n\r\n@Directive({\r\n  selector: '[input-end-edit]'\r\n})\r\nclass InputEndEditDirective extends AbstractEndEdit implements OnInit {\r\n  private nativeElement: any;\r\n  constructor(protected appContext: AppContext, private elementRef: ElementRef) {\r\n    super(appContext);\r\n  }\r\n  ngOnInit(): void {\r\n    if (this.elementRef) {\r\n      this.nativeElement = this.elementRef.nativeElement;\r\n    }\r\n  }\r\n  /**\r\n   * ç»æç¼è¾\r\n   * @param message æ¶æ¯\r\n   */\r\n  public endEdit(message: any) {\r\n    if (this.nativeElement) {\r\n      const parent: any = this.nativeElement.parentNode || this.nativeElement.parentElement;\r\n      const inputs: Array<any> = parent && Array.from(parent.getElementsByTagName('input')) || [];\r\n      if (inputs && inputs.length > 0) {\r\n        inputs.forEach(input => {\r\n          if (input && typeof (input.blur) === 'function') {\r\n            input.blur();\r\n          }\r\n        });\r\n      }\r\n    }\r\n  }\r\n}\r\nexport { InputEndEditDirective };\r\n","import { Directive } from '@angular/core';\r\nimport { AppContext } from '@farris/devkit';\r\nimport { DatagridComponent } from '@farris/ui-datagrid';\r\nimport { AbstractEndEdit } from './abstract_end_edit';\r\n\r\n@Directive({\r\n  selector: '[farris-grid-end-edit]'\r\n})\r\nclass FarrisDataGridEndEditDirective extends AbstractEndEdit {\r\n  constructor(protected appContext: AppContext, private datagrid: DatagridComponent) {\r\n    super(appContext);\r\n  }\r\n  /**\r\n   * ç»æç¼è¾\r\n   * @param message message\r\n   */\r\n  public endEdit(message: any) {\r\n    if (this.datagrid && typeof this.datagrid.endCellEdit === 'function') {\r\n      this.datagrid.endCellEdit();\r\n    }\r\n  }\r\n}\r\nexport { FarrisDataGridEndEditDirective };\r\n","import { AppContext } from '@farris/devkit';\r\nimport { HtmlEditorComponent } from '@farris/ui-html-editor';\r\nimport { AbstractEndEdit } from './abstract_end_edit';\r\nimport { Directive } from '@angular/core';\r\n@Directive({\r\n  selector: '[html-editor-end-edit]'\r\n})\r\nclass HtmlEditorEndEditDirective extends AbstractEndEdit {\r\n  constructor(protected appContext: AppContext, private editor: HtmlEditorComponent) {\r\n    super(appContext);\r\n  }\r\n  public endEdit(message: any) {\r\n    if (this.editor && typeof this.editor.endEdit === 'function') {\r\n      this.editor.endEdit();\r\n    }\r\n  }\r\n\r\n}\r\nexport { HtmlEditorEndEditDirective };\r\n","import { Directive } from '@angular/core';\r\nimport { AppContext } from '@farris/devkit';\r\nimport { GridComponent } from '@progress/kendo-angular-grid';\r\nimport { AbstractEndEdit } from './abstract_end_edit';\r\n\r\n@Directive({\r\n  selector: '[kendo-grid-end-edit]'\r\n})\r\nclass KendoGridEndEditDirective extends AbstractEndEdit {\r\n  constructor(protected appContext: AppContext, private grid: GridComponent) {\r\n    super(appContext);\r\n  }\r\n  public endEdit(message: any) {\r\n    if (this.grid && typeof this.grid.closeCell === 'function') {\r\n      this.grid.closeCell();\r\n    }\r\n  }\r\n}\r\nexport { KendoGridEndEditDirective };\r\n","import { Directive, Input } from '@angular/core';\r\nimport { Observable } from 'rxjs';\r\nimport { ViewModel } from '@farris/devkit';\r\nimport { DatagridComponent } from '@farris/ui-datagrid';\r\n\r\n\r\n@Directive({\r\n  selector: \"[farris-remote-summary-command]\"\r\n})\r\nexport class FarrisDataGridRemoteSummaryDirective {\r\n  /**\r\n   * æå¡å¨ç«¯åè®¡å½ä»¤åç§°\r\n   */\r\n  @Input('farris-remote-summary-command') remoteSummaryCommand: string;\r\n\r\n  constructor(public viewModel: ViewModel, public grid: DatagridComponent) {\r\n    const appContext = this.viewModel.frameContext.getFormAppContext();\r\n    if (appContext && appContext.hasOwnProperty('messagePipe')) {\r\n      appContext.messagePipe.subscribe((message: any) => {\r\n        const messageType = message && message.type || null;\r\n        // æ¥è¯¢äºä»¶\r\n        if (messageType === 'query') {\r\n          if (this.remoteSummaryCommand && this.grid.footerDataFrom === 'server') {\r\n            const paths = this.remoteSummaryCommand.split('.');\r\n            let func = null;\r\n            paths.forEach(path => {\r\n              func = func && func[path] || this[path];\r\n            });\r\n            if (typeof func === 'function') {\r\n              func().subscribe(result => {\r\n                this.grid.footerData = result;\r\n              });\r\n            }\r\n          }\r\n        }\r\n      });\r\n    }\r\n  }\r\n  /**\r\n   * æ§è¡å½ä»¤\r\n   * @param commandName å½ä»¤åç§°\r\n   * @param frameId frameId\r\n   */\r\n  private execute(commandName: string, frameId?: string): Observable<any> {\r\n    if (!commandName || commandName === '' || commandName === 'undefined') {\r\n      return;\r\n    }\r\n    let viewModel = this.viewModel;\r\n    if (frameId) {\r\n      const targetContext = viewModel.frameContext.appContext.frameContextManager.getFrameContextById(frameId);\r\n      viewModel = targetContext.viewModel;\r\n    }\r\n    return viewModel[commandName]();\r\n  }\r\n\r\n}\r\n","import { Directive, Input, Renderer2, Injector, OnInit, ElementRef } from '@angular/core';\r\nimport { BehaviorSubject } from 'rxjs';\r\n\r\n@Directive({\r\n    selector: '[farris-set-focus]'\r\n})\r\nexport class FarrisSetFocusDirective implements OnInit {\r\n\r\n    @Input() set focusState(value: boolean) {\r\n        this._state.next(value);\r\n    }\r\n    private selfEl: HTMLElement\r\n    private _state: BehaviorSubject<any> = new BehaviorSubject({});\r\n\r\n    constructor(\r\n        private rd: Renderer2,\r\n        private injector: Injector,\r\n        private el: ElementRef\r\n    ) {\r\n\r\n    }\r\n\r\n    ngOnInit(): void {\r\n        this.selfEl = this.el.nativeElement;\r\n        this._state.subscribe(data => {\r\n            if (data === false && this.selfEl) {\r\n                if (this.selfEl.nodeName.toLowerCase() === 'farris-html-editor') {\r\n                    this.setHtmlEditorFocus();\r\n                } else {\r\n                    this.setFocus();\r\n                }\r\n            }\r\n        })\r\n    }\r\n\r\n    /**\r\n     * è®¾ç½®ä¸è¬è¾å¥æ¡çé»è®¤ç¦ç¹\r\n     */\r\n    setFocus() {\r\n        const input = this.selfEl.querySelectorAll('input');\r\n        if (input.length) {\r\n            input[0].focus()\r\n        } else {\r\n            this.selfEl.focus();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * è®¾ç½®htmlç¼è¾å¨çé»è®¤ç¦ç¹  æ»æ¯å¨ææ¬æå\r\n     */\r\n    setHtmlEditorFocus() {\r\n        // å¯ææ¬ç¼è¾å¨ä¸æ¯input\r\n        const ediotrArea = this.selfEl.querySelector('div[contenteditable=\"true\"]');\r\n        //åå»ºrange  å­å¨æµè§å¨å¼å®¹æ§é®é¢\r\n        const range = window.getSelection();\r\n        //range éæ©objä¸ææå­åå®¹\r\n        range.selectAllChildren(ediotrArea);\r\n        //åæ ç§»è³æå\r\n        range.collapseToEnd();\r\n    }\r\n}","import { Directive, OnInit, OnChanges, SimpleChanges, Input, Injector, Optional, HostListener } from '@angular/core';\r\nimport { BindingData, BindingList, FrameContext, Change, ChangeType } from '@farris/devkit';\r\nimport { UploadFile, FFilePreviewComponent, UploadAndPreviewComponent } from '@farris/extend-file-upload';\r\n\r\n/**\r\n * æ è¡¨æ ¼ç»å®æä»¤\r\n */\r\n@Directive({\r\n  selector: '[farrisFilePreviewBinding]'\r\n})\r\nclass FarrisFilePreviewBindingDirective implements OnInit, OnChanges {\r\n  private __DATA__: any;\r\n  /**\r\n   * æªå¯ç¨æåºæ¶é»è®¤æä¸ä¼ æ¶é´å­æ®µæåº\r\n   */\r\n  private readonly DEFAULT_SORT_FIELD = 'createTime';\r\n  /**\r\n   * å¯ç¨æåºæ¶ä½¿ç¨fileSortOrderåæåºå­æ®µï¼ä¸é¶ä»£ç çææ½æåºç»ä¸\r\n   */\r\n  private readonly SORT_FIELD_ON_SORTING = 'fileSortOrder';\r\n  @Input('extendFileInfo')\r\n  public extendFileInfo: { key: string, path: any }[];\r\n  /**\r\n   * æåºæ¹å¼\r\n   */\r\n  @Input('farrisOrderType')\r\n  public farrisOrderType: string;\r\n  /**\r\n   * æä»¶idå­æ®µè·¯å¾\r\n   */\r\n  @Input('farrisFileIdKey')\r\n  public fileIdKey: string;\r\n  /**\r\n   * æåºå­æ®µï¼ææ½æåºç¸å³\r\n   */\r\n  @Input('farrisFileSortOrderKey')\r\n  public fileSortOrderKey: string;\r\n  /**\r\n   * æä»¶nameå­æ®µè·¯å¾\r\n   */\r\n  @Input('farrisFileNameKey')\r\n  public fileNameKey: string;\r\n\r\n  /**\r\n   * ç»å®æ°æ®\r\n   */\r\n  private get bindingData(): BindingData {\r\n    return this.frameContext.bindingData;\r\n  }\r\n\r\n  /**\r\n   * ç»å®æ°æ®åè¡¨\r\n   */\r\n  private get bindingList(): BindingList {\r\n    return this.bindingData.getList();\r\n  }\r\n  /**\r\n   * æåºå­æ®µ\r\n   * @description\r\n   * ç»ä»¶æåºå­æ®µåªæä¸ä¸ªï¼ä¸æ¯æå¤ä¸ªã\r\n   * å¦æå¯ç¨äºææ½æåºï¼åä¸ºfileSortOrderï¼å¦åä½¿ç¨é»è®¤çcreateTime\r\n   */\r\n  private get orderField() {\r\n    return this.uploadAndPreviewComponent && this.uploadAndPreviewComponent.enableOrder && this.uploadAndPreviewComponent.orderField || this.fileSortOrderKey && this.SORT_FIELD_ON_SORTING || this.DEFAULT_SORT_FIELD;\r\n  }\r\n  /**\r\n   * é»è®¤éåº\r\n   */\r\n  private get orderType() {\r\n    return this.farrisOrderType ? this.farrisOrderType : this.orderField === this.DEFAULT_SORT_FIELD ? 'desc' : 'asc';\r\n  }\r\n  /**\r\n   * æé å½æ°\r\n   * @param previewComponent - éä»¶ç»ä»¶\r\n   * @param frameContext - æ§å¶å¨ä¸ä¸æ\r\n   * @param uploadAndPreviewComponent - éä»¶ä¸ä¼ é¢è§ç»ä»¶\r\n   * @param injector - injector\r\n   * @TODO: è¯¥æä»¤è¢«ç¨äºä¸åçç»ä»¶ä¸­ï¼å æ­¤uploadAndPreviewComponentå¯è½ä¸ºnull\r\n   */\r\n  constructor(\r\n    @Optional() private previewComponent: FFilePreviewComponent,\r\n    private frameContext: FrameContext,\r\n    @Optional() private uploadAndPreviewComponent: UploadAndPreviewComponent,\r\n    @Optional() private injector: Injector\r\n  ) {\r\n  }\r\n\r\n  /**\r\n   * æä»¤åå§å\r\n   */\r\n  ngOnInit() {\r\n    this.bindData();\r\n    if (this.uploadAndPreviewComponent) {\r\n      if (this.uploadAndPreviewComponent.enableOrder) {\r\n        this.uploadAndPreviewComponent.orderField = this.SORT_FIELD_ON_SORTING;\r\n      }\r\n      // ç¦ç¨ç»ä»¶åç½®æåºï¼æ§å¶å¨è´è´£æåºå¹¶å°æåºåçæ°æ®ç»å®å°éä»¶ä¸ä¼ é¢è§ç»ä»¶\r\n      this.uploadAndPreviewComponent.enableSorting = false;\r\n      this.uploadAndPreviewComponent.fSelectedEvent.subscribe((event: any) => {\r\n        const primaryKey = this.bindingList.primaryKey;\r\n        const id = event && event.originalData && event.originalData[primaryKey];\r\n        if (id && id !== this.bindingList.currentId) {\r\n          this.bindingList.setCurrentId(id, true);\r\n        }\r\n      });\r\n    }\r\n    this.bindingData.changes.subscribe((change: Change) => {\r\n      // å æåºéè¦ï¼å¼ååæ¶ä¹åºè¿è¡æ°æ®ç»å®\r\n      if (change.type === ChangeType.Load || change.type === ChangeType.Append || change.type === ChangeType.Remove || change.type === ChangeType.ValueChanged || change.type === ChangeType.SelectionChanged) {\r\n        this.bindData(change);\r\n        this.updateCurrentRow(change);\r\n        this.updateChecks(change);\r\n      }\r\n    });\r\n    this.setChecks([]);\r\n  }\r\n\r\n  /**\r\n   * æä»¤è¾å¥åæ´\r\n   * @param changes -åæ´\r\n   */\r\n  ngOnChanges(changes: SimpleChanges) {\r\n  }\r\n  private shouldComponentUpdate(data: any) {\r\n    return !(JSON.stringify(this.__DATA__) === JSON.stringify(data));\r\n    // return !(this.__DATA__ && isEqual(this.__DATA__, data));\r\n  }\r\n  /**\r\n   * ç»å®æ°æ®\r\n   * @param change -åæ´\r\n   */\r\n  private bindData(change?: Change) {\r\n    const bindingPath = this.frameContext.viewModel.bindingPath.split('/').filter(p => p).join('/');\r\n    const eventPath = change && change.path && change.path.filter(p => p).join('/');\r\n    // è¡åæ¢ãå é¤ãå è½½ãæ°å¢æ°æ®ãé¡µç åæ¢ åºæ¯\r\n    if (change && [ChangeType.SelectionChanged, ChangeType.Remove, ChangeType.Load, ChangeType.Append].includes(change.type)) {\r\n      // éä¸çº§å®ä½ä¸éæ°ç»å®æ°æ®\r\n      if (!bindingPath.startsWith(eventPath)) {\r\n        return;\r\n      }\r\n      // å½åéä»¶ç»ä»¶åæ¢å½åè¡ä¸éè¦éæ°æ¸²æ\r\n      if (change.type === ChangeType.SelectionChanged && bindingPath === eventPath) {\r\n        return;\r\n      }\r\n    }\r\n    // éå½åå®ä½åçäºå¼åå\r\n    if (change && change.type === ChangeType.ValueChanged && !eventPath.startsWith(bindingPath)) {\r\n      return;\r\n    }\r\n    const fileInfos = this.getFileInfos();\r\n    if (!this.shouldComponentUpdate(fileInfos)) {\r\n      return;\r\n    }\r\n    if (this.componentRef) {\r\n      this.__DATA__ = fileInfos;\r\n      this.componentRef.fileInfos = fileInfos;\r\n      if (this.uploadAndPreviewComponent && fileInfos && fileInfos.length > 0) {\r\n        const extendInfos = fileInfos.map((item: any) => item.originalData);\r\n        this.uploadAndPreviewComponent.extendInfos = extendInfos;\r\n      }\r\n      this.changeCurrentRow(fileInfos, change);\r\n    }\r\n  }\r\n  private updateChecks(change?: Change) {\r\n    if (!this.uploadAndPreviewComponent) {\r\n      return;\r\n    }\r\n    const bindingPath = this.frameContext.viewModel.bindingPath.split('/').filter(p => p).join('/');\r\n    const eventPath = change && change.path && change.path.filter(p => p).join('/');\r\n    // å é¤èªèº«è¡¨æ¶æ´æ°å¾éè®°å½\r\n    if (change && change.type === ChangeType.Remove && eventPath === bindingPath) {\r\n      const values = change.value || [];\r\n      const ids: any[] = this.frameContext.uiState['ids'] || [];\r\n      if (values.length > 0 && ids.length > 0) {\r\n        values.forEach((id: string) => {\r\n          const index = ids.indexOf(id);\r\n          if (index !== -1) {\r\n            ids.splice(index, 1);\r\n          }\r\n        });\r\n      }\r\n    } else if ((change.type === ChangeType.Remove || change.type === ChangeType.SelectionChanged) && bindingPath.startsWith(eventPath) && bindingPath !== eventPath) {\r\n      //ä¸çº§ï¼ä¸ä¸çº§ï¼è¡¨å é¤ãä¸çº§ï¼ä¸ä¸çº§ï¼è¡¨åæ¢å½åè¡æ¶æ´æ°å¾éè®°å½\r\n      this.setChecks([]);\r\n      // æ¸ç©ºç»ä»¶å¾é\r\n      this.clearComponentChecks();\r\n    } else if (change && change.type === ChangeType.Load && (bindingPath === eventPath || bindingPath.startsWith(eventPath) && bindingPath !== eventPath)) {\r\n      // å½åéä»¶ç»ä»¶æ°æ®éæ°å è½½ or ä¸çº§æä¸ä¸çº§éæ°å è½½\r\n      this.setChecks([]);\r\n      // æ¸ç©ºç»ä»¶å¾é\r\n      this.clearComponentChecks();\r\n    }\r\n  }\r\n  /**\r\n   * ä¸»å¨æ´æ°å½åè¡\r\n   * @param data - æ°æ®\r\n   * @param change - åæ´\r\n   */\r\n  private changeCurrentRow(data: any, change?: Change) {\r\n    if (!this.uploadAndPreviewComponent) {\r\n      return;\r\n    }\r\n    const changePath = change && change.path.join('/');\r\n    const paths = this.frameContext.viewModel.bindingPath.split('/').filter(p => p);\r\n    const path = paths.join('/');\r\n    const isParentSelectChange = path.startsWith(changePath) && change.type === ChangeType.SelectionChanged && path !== changePath;\r\n    const isSelfRowDelete = change && change.type === ChangeType.Remove && path === changePath;\r\n    if (data && data.length > 0 && change && (change.type === ChangeType.Load || isParentSelectChange || isSelfRowDelete)) {\r\n      const primaryKey = this.bindingList.primaryKey;\r\n      const id = data[0]['originalData'] && data[0]['originalData'][primaryKey];\r\n      if (this.bindingList.currentId !== id) {\r\n        setTimeout(() => {\r\n          this.bindingList.setCurrentId(id, true, true);\r\n        }, 100);\r\n      }\r\n    }\r\n  }\r\n  /**\r\n   * ä¸ºæ§ä»¶è®¾ç½®å½åè¡\r\n   * @param change - æ§å¶å¨åæ´\r\n   * @returns\r\n   */\r\n  private updateCurrentRow(change?: Change) {\r\n    if (!this.bindingList || !this.bindingList.currentId || !this.uploadAndPreviewComponent) {\r\n      return;\r\n    }\r\n    if (change && change.type !== ChangeType.SelectionChanged && change.type !== ChangeType.Load && change.type !== ChangeType.Remove) {\r\n      return;\r\n    }\r\n    const currentId = this.uploadAndPreviewComponent.previewCurrent;\r\n    // ç»ä»¶idåæ°æ®idè¿è¡è½¬æ¢\r\n    const id = this.getValueByPath(this.bindingList.currentItem, this.fileIdKey);\r\n    if (id === currentId) {\r\n      return;\r\n    }\r\n    this.selectComponentRow(id);\r\n  }\r\n  /**\r\n   * è·åéä»¶ä¿¡æ¯åè¡¨\r\n   */\r\n  private getFileInfos(): UploadFile[] {\r\n    const listData = this.bindingList.toJSON();\r\n    const fileInfos: UploadFile[] = [];\r\n    listData.forEach((itemData: any) => {\r\n      const fileInfo = this.convertToFileInfo(itemData);\r\n      fileInfos.push(fileInfo);\r\n    });\r\n    // æåº\r\n    if (this.orderField) {\r\n      this.sort(fileInfos, this.orderField, this.orderType);\r\n    }\r\n    return fileInfos;\r\n  }\r\n  /**\r\n   * è¡æ°æ®è½¬æ¢ä¸ºæä»¶ä¿¡æ¯\r\n   * @param itemData - è¡æ°æ®\r\n   * @returns\r\n   */\r\n  private convertToFileInfo(itemData: any) {\r\n    // const idKey = this.bindingList.primaryKey;\r\n    // const id = this.getValueByPath(itemData, idKey);\r\n    const fileId = this.getValueByPath(itemData, this.fileIdKey);\r\n    const fileName = this.getValueByPath(itemData, this.fileNameKey);\r\n    const fileSize = this.getValueByPath(itemData, this.fileSizeKey);\r\n    const fileCreateTime = this.getValueByPath(itemData, this.fileCreateTimeKey);\r\n\r\n    const fileInfo: any = {\r\n      id: fileId,\r\n      name: fileName,\r\n      size: fileSize,\r\n      createTime: fileCreateTime,\r\n      originalData: itemData,\r\n      extend: {\r\n        metadataId: fileId\r\n      }\r\n    };\r\n    if (this.extendFileInfo && Array.isArray(this.extendFileInfo) && this.extendFileInfo.length > 0) {\r\n      this.extendFileInfo.forEach((item) => {\r\n        fileInfo[item.key] = this.getValueByPath(itemData, item.path);\r\n      });\r\n    }\r\n    if (this.fileSortOrderKey) {\r\n      const fileSortOrder = this.getValueByPath(itemData, this.fileSortOrderKey);\r\n      fileInfo[this.SORT_FIELD_ON_SORTING] = fileSortOrder;\r\n    }\r\n    return fileInfo;\r\n  }\r\n  /**\r\n   * è®¾ç½®æ§ä»¶çå½åè¡\r\n   * @param id ä¸»é®\r\n   */\r\n  private selectComponentRow(id) {\r\n    if (this.uploadAndPreviewComponent) {\r\n      this.uploadAndPreviewComponent.previewCurrent = id;\r\n    }\r\n  }\r\n  /**\r\n   * æ ¹æ®å­æ®µè·¯å¾è·åå¼\r\n   * @param data - æ°æ®æº\r\n   * @param path - å­æ®µè·¯å¾\r\n   */\r\n  private getValueByPath(data: any, path: string): any {\r\n    const keys = path.split('.');\r\n    let currentValue = data;\r\n    keys.forEach((key: string) => {\r\n      currentValue = currentValue && currentValue[key];\r\n    });\r\n    return currentValue;\r\n  }\r\n  private getUdtPaths(): string[] {\r\n    const paths = this.fileIdKey.split('.');\r\n    paths.pop();\r\n    return paths;\r\n  }\r\n  private get fileSizeKey() {\r\n    const basePaths = this.getUdtPaths();\r\n    return basePaths.concat(['fileSize']).join('.');\r\n  }\r\n  private get fileCreateTimeKey() {\r\n    const basePaths = this.getUdtPaths();\r\n    return basePaths.concat(['fileCreateTime']).join('.');\r\n  }\r\n  private get componentRef() {\r\n    return this.previewComponent || this.uploadAndPreviewComponent || null;\r\n  }\r\n  private setChecks(ids: any) {\r\n    this.frameContext.uiState.setPropertyValue('ids', ids);\r\n  }\r\n  /**\r\n   * æ¸ç©ºç»ä»¶å¾é\r\n   */\r\n  private clearComponentChecks() {\r\n    if (this.uploadAndPreviewComponent) {\r\n      this.uploadAndPreviewComponent.previewUpdateRefresh();\r\n    }\r\n  }\r\n  public sort(data: any[], fields: string | Array<string>, directions: string | Array<string>) {\r\n    if (!fields || fields.length < 1 || !directions || directions.length < 1) {\r\n      throw new Error('sortBy:argument error');\r\n    }\r\n    // é»è®¤ååº\r\n    const arrFields: Array<string> = typeof fields === 'string' ? fields.split(',') : fields || [];\r\n    const arrDirections: Array<string> = typeof directions === 'string' ? directions.split(',') : directions || [];\r\n    // æåºå­æ®µåæåºæ¹å¼åºä¸è´\r\n    if (arrFields.length !== arrDirections.length || arrFields.length < 1) {\r\n      throw new Error('sortBy:fields and directions not match');\r\n    }\r\n    // nage,age,total\r\n    const comparator = (props: Array<string>, orders: Array<string>) => (item1: any, item2: any) => {\r\n      return props.reduce((result, prop) => {\r\n        if (result === 0) {\r\n          const order = ['asc'].includes(orders[props.indexOf(prop)]) ? 1 : -1;\r\n          const item1Value = this.getValue(item1, prop);\r\n          const item2Value = this.getValue(item2, prop);\r\n          if (item1Value === null || item1Value === undefined) {\r\n            return 1;\r\n          }\r\n          if (item2Value === null || item2Value === undefined) {\r\n            return -1;\r\n          }\r\n\r\n          if (typeof item1Value !== typeof item2Value) {\r\n            const localeCompareResult = String(item1Value).localeCompare(String(item2Value));\r\n            result = localeCompareResult * order;\r\n          } else if (typeof item1Value === 'string' && typeof item2Value === 'string') {\r\n            const localeCompareResult = item1Value.localeCompare(item2Value);\r\n            result = localeCompareResult * order;\r\n          } else {\r\n            if (item1Value > item2Value) {\r\n              result = order * 1;\r\n            }\r\n            if (item1Value < item2Value) {\r\n              result = order * -1;\r\n            }\r\n          }\r\n        }\r\n        return result;\r\n      }, 0);\r\n    };\r\n    data.sort(comparator(arrFields, arrDirections));\r\n  }\r\n  private getValue(target: any, propName: string) {\r\n    if (target instanceof BindingList) {\r\n      target = target.currentItem;\r\n    } else if (target instanceof BindingData) {\r\n      target = target.list.currentItem;\r\n    }\r\n    let result = null;\r\n    if (propName.indexOf('.') === -1) {\r\n      result = target[propName];\r\n    } else {\r\n      const props = propName.split('.');\r\n      for (const prop of props) {\r\n        target = result = this.getValue(target, prop);\r\n      }\r\n    }\r\n    return result;\r\n  }\r\n  /**\r\n   * å¾éååäºä»¶\r\n   * @param event\r\n   */\r\n  @HostListener('fPreviewMultiSelectedEvent', ['$event'])\r\n  private checkedChanged(event: any[]) {\r\n    const primaryKey = this.bindingList.primaryKey;\r\n    const ids = event && event.map((item) => item && item.originalData && item.originalData[primaryKey] || '').filter(p => p) || [];\r\n    this.setChecks(ids);\r\n  }\r\n  /**\r\n   * è¡åæ¢äºä»¶\r\n   * @param event\r\n   */\r\n  @HostListener('fSelectedEvent', ['$event'])\r\n  private selectChanged(event: any) {\r\n\r\n  }\r\n}\r\n\r\nexport { FarrisFilePreviewBindingDirective };\r\n","import { Directive, Injector, Input, OnInit, HostListener } from '@angular/core';\r\nimport { DiscussionEditorComponent } from '@farris/discussion-group';\r\nimport { ViewModel, UIStateObservableParam } from '@farris/devkit';\r\nimport { of, Observable, EMPTY } from 'rxjs';\r\nimport { tap, catchError } from 'rxjs/operators';\r\nconst KEY_UISTATE_REPLY_MESSAGE = 'DISCUSSION_REPLY_MESSAGE_INFO';\r\nconst KEY_MESSAGE_ON_COMMENT_ADD = 'onCommentAdd';\r\n\r\n@Directive({\r\n  selector: '[farris-discussion-editor-binding]'\r\n})\r\nexport class FarrisDiscussionEditorBindingDirective implements OnInit {\r\n\r\n  /**\r\n   * è·åç¨æ·å½ä»¤\r\n   */\r\n  @Input(\"userQueryCommand\") userQueryCommand: string;\r\n  /**\r\n   * æ·»å è¯è®ºå½ä»¤\r\n   */\r\n  @Input(\"addCommentCommand\") addCommentCommand: string;\r\n  /**\r\n   * æ¥è¯¢ææé¨é¨å½ä»¤\r\n   */\r\n  @Input(\"queryAllOrgsCommand\") queryAllOrgsCommand: string;\r\n  /**\r\n   * æ¥è¯¢å¸¸ç¨@ç¨æ·\r\n   */\r\n  @Input(\"queryFrequentAtUsersCommand\") queryFrequentAtUsersCommand: string;\r\n\r\n  constructor(public injector: Injector, public discussionEditorComponent: DiscussionEditorComponent, public viewModel: ViewModel) {\r\n  }\r\n\r\n  ngOnInit(): void {\r\n    this.discussionEditorComponent.replyUser = this.viewModel.frameContext.root.viewModel.uiState[KEY_UISTATE_REPLY_MESSAGE] || {};\r\n    this.viewModel.frameContext.root.viewModel.uiState.changes.subscribe((change: UIStateObservableParam) => {\r\n      if (change.field === KEY_UISTATE_REPLY_MESSAGE) {\r\n        this.discussionEditorComponent.replyUser = this.viewModel.frameContext.root.viewModel.uiState[KEY_UISTATE_REPLY_MESSAGE] || {};\r\n      }\r\n    });\r\n    if (this.queryFrequentAtUsersCommand) {\r\n      this.queryFrequentAtUsers();\r\n    } else {\r\n      this.queryAtUsers();\r\n    }\r\n\r\n    this.queryAllOrgs();\r\n  }\r\n  /**\r\n   * æ¥è¯¢ææé¨é¨æ°æ®\r\n   */\r\n  private queryAllOrgs() {\r\n    this.execute(this.queryAllOrgsCommand).subscribe(result => {\r\n      if (!result) {\r\n        return;\r\n      }\r\n      this.discussionEditorComponent.sectionData = result;\r\n    });\r\n  }\r\n  /**\r\n   * è·å@ç¨æ·\r\n   */\r\n  private queryAtUsers() {\r\n    this.execute(this.userQueryCommand).subscribe(result => {\r\n      if (!result) {\r\n        return;\r\n      }\r\n      const { users = [] } = result;\r\n      this.discussionEditorComponent.personnels = users;\r\n    });\r\n  }\r\n  /**\r\n   * è·åå¸¸ç¨@ç¨æ·\r\n   */\r\n  private queryFrequentAtUsers() {\r\n    this.execute(this.queryFrequentAtUsersCommand).subscribe(result => {\r\n      if (!result) {\r\n        return;\r\n      }\r\n      this.discussionEditorComponent.personnels = result && result.users || [];\r\n    });\r\n  }\r\n  /**\r\n   * æäº¤æåæ¶è¯è®º\r\n   * @param event event\r\n   */\r\n  @HostListener('valueChange', ['$event'])\r\n  public pageChangedHandler(event: any) {\r\n    const { msgInfo = 0, text = '', visibility = 'ALL', parentId = null } = event || {};\r\n    if (msgInfo === 1) {\r\n      this.execute(this.addCommentCommand, { text, parentId, visibility }).pipe(\r\n        tap(() => {\r\n          this.viewModel.frameContext.appContext.messagePipe.next(KEY_MESSAGE_ON_COMMENT_ADD);\r\n        }),\r\n        catchError(e => EMPTY)\r\n      ).subscribe();\r\n    } else {\r\n      // åæ¶çæ¶ååæ¶ä¼å°åå¤ç¨æ·æ¸ç©º\r\n      this.viewModel.frameContext.root.viewModel.uiState[KEY_UISTATE_REPLY_MESSAGE] = {};\r\n      this.discussionEditorComponent.replyUser = {};\r\n    }\r\n  }\r\n  /**\r\n   * æ§è¡å½ä»¤\r\n   * @param commandName å½ä»¤åç§°\r\n   */\r\n  private execute(commandName: string, params?: any): Observable<any> {\r\n    if (!commandName || commandName === '' || commandName === 'undefined') {\r\n      return of(null);\r\n    }\r\n    if (typeof params === 'undefined') {\r\n      params = {};\r\n    }\r\n    const paths = commandName.split('.');\r\n    let func = null;\r\n    paths.forEach(path => {\r\n      func = func && func[path] || this[path];\r\n    });\r\n    if (typeof func === 'function') {\r\n      return func(params);\r\n    }\r\n    return of(null);\r\n  }\r\n}\r\n","import { Observable, of, EMPTY } from 'rxjs';\r\nimport { Directive, Input, Injector, OnInit, HostListener } from '@angular/core';\r\nimport { DiscussionListComponent, DiscussionListDirective } from '@farris/discussion-group';\r\nimport { ViewModel, Change, ChangeType } from '@farris/devkit';\r\nimport { tap, catchError } from 'rxjs/operators';\r\nconst KEY_UISTATE_REPLY_MESSAGE = 'DISCUSSION_REPLY_MESSAGE_INFO';\r\nconst KEY_MESSAGE_ON_COMMENT_ADD = 'onCommentAdd';\r\n@Directive({\r\n  selector: '[farris-discussion-list-binding]'\r\n})\r\nexport class FarrisDiscussionListBindingDirective implements OnInit {\r\n  /**\r\n   * è·åç¨æ·å½ä»¤\r\n  */\r\n  @Input(\"commentsQueryCommand\") commentsQueryCommand: string;\r\n  constructor(public injector: Injector, public discussionListComponent: DiscussionListComponent, public viewModel: ViewModel, public discussionListDirective: DiscussionListDirective) {\r\n\r\n  }\r\n  ngOnInit(): void {\r\n    this.viewModel.frameContext.appContext.messagePipe.subscribe((message: any) => {\r\n      if (message === KEY_MESSAGE_ON_COMMENT_ADD) {\r\n        this.queryComments();\r\n      }\r\n    });\r\n    this.viewModel.bindingData.changes.subscribe((change: Change) => {\r\n      if (change.type === ChangeType.Load || change.type === ChangeType.SelectionChanged) {\r\n        this.queryComments();\r\n      }\r\n    });\r\n  }\r\n  /**\r\n   * æ¥è¯¢è¯è®º\r\n   */\r\n  private queryComments(pageIndex?: number, pageSize?: number) {\r\n    if (typeof pageIndex === 'undefined') {\r\n      pageIndex = (this.discussionListComponent.pageIndex - 1) || 0;\r\n    }\r\n    if (typeof pageSize === 'undefined') {\r\n      if (this.discussionListComponent.supportPaging) {\r\n        pageSize = this.discussionListComponent.pageSize;\r\n      } else {\r\n        // ä¸åé¡µï¼pageSizeååç«¯çº¦å®ä¼ æå¤§æ°\r\n        pageSize = 10000;\r\n      }\r\n    }\r\n    this.execute(this.commentsQueryCommand, { pageIndex, pageSize }).pipe(\r\n      catchError(e => EMPTY)\r\n    ).subscribe(result => {\r\n      if (!result) {\r\n        return;\r\n      }\r\n      const { comments = [], pageIndex = 0, pageSize = 10, totalCount = 0 } = result;\r\n      this.discussionListComponent.pageIndex = parseInt(pageIndex) + 1;\r\n      if (this.discussionListComponent.supportPaging) {\r\n        this.discussionListComponent.pageSize = pageSize;\r\n      }\r\n      this.discussionListComponent.total = totalCount;\r\n      this.discussionListDirective.discussionListData = result;\r\n    });\r\n  }\r\n  /**\r\n   * åå¤æ¶æ¯\r\n   * @param event event\r\n   */\r\n  @HostListener('replyMessage', ['$event'])\r\n  public replyMessagedHandler(event: any) {\r\n    this.viewModel.frameContext.root.viewModel.uiState.setPropertyValue(KEY_UISTATE_REPLY_MESSAGE, event);\r\n  }\r\n  /**\r\n   * åæ¢é¡µç \r\n   * @param event event\r\n   */\r\n  @HostListener('pageChanged', ['$event'])\r\n  public pageChangedHandler(event: any) {\r\n    const { pageIndex = 1, pageSize = 10 } = event.pageInfo || {};\r\n    this.queryComments(pageIndex - 1, pageSize);\r\n  }\r\n  /**\r\n   * æ§è¡å½ä»¤\r\n   * @param commandName å½ä»¤åç§°\r\n   */\r\n  private execute(commandName: string, params?: any): Observable<any> {\r\n    if (!commandName || commandName === '' || commandName === 'undefined') {\r\n      return of(null);\r\n    }\r\n    const paths = commandName.split('.');\r\n    let func = null;\r\n    paths.forEach(path => {\r\n      func = func && func[path] || this[path];\r\n    });\r\n    if (typeof func === 'function') {\r\n      return func(params);\r\n    }\r\n    return of(null);\r\n  }\r\n}\r\n","/*******************************************************************************************************************\r\n *                                     FarrisPrimengTreeTableBindingDirectiveæä»¤è¯´æ                               *\r\n * *****************************************************************************************************************\r\n * \r\n * 1. ä¾èµprimengçæ¬: primeng:^9.0.0,primeicons:^4.0.0\r\n * \r\n * 2. ç±äºå¯ç¼è¾æ è¡¨æ æ³è§¦åç¼è¾ååæ ¼çå³é­äºä»¶onEditCompleteï¼å æ­¤å¯¹priemengçnode_modules\\primeng\\fesm5\\primeng-treetable.jsèæ¬ä½åºä¿®æ¹ï¼ \r\n *    æºç ä¿®æ¹å¦ä¸ï¼+è¡¨ç¤ºæ°å¢å çèæ¬è¯­å¥:\r\n * \r\n *  TreeTable.prototype.updateEditingCell = function (cell, data, field) { //+ åæ°å¢å dataåfield\r\n *      this.editingCell = cell;\r\n *      this.editingCellData = data; //+\r\n *      this.editingCellField = field; //+\r\n *      this.bindDocumentEditListener();\r\n *  };\r\n * \r\n *  TreeTable.prototype.bindDocumentEditListener = function () {\r\n *       var _this = this;\r\n *       if (!this.documentEditListener) {\r\n *           this.documentEditListener = function (event) {\r\n *               if (_this.editingCell && !_this.editingCellClick && _this.isEditingCellValid()) {\r\n *                   domhandler_1.DomHandler.removeClass(_this.editingCell, 'ui-editing-cell');\r\n *                   _this.editingCell = null;\r\n *                   _this.onEditComplete.emit({ field: _this.editingCellField, data: _this.editingCellData });//+\r\n *                   _this.unbindDocumentEditListener();\r\n *               }\r\n *               _this.editingCellClick = false;\r\n *           };\r\n *           document.addEventListener('click', this.documentEditListener);\r\n *       }\r\n *   };\r\n * \r\n *  TreeTable.prototype.bindDocumentEditListener = function () {\r\n *       var _this = this;\r\n *       if (!this.documentEditListener) {\r\n *           this.documentEditListener = function (event) {\r\n *               if (_this.editingCell && !_this.editingCellClick && _this.isEditingCellValid()) {\r\n *                   domhandler_1.DomHandler.removeClass(_this.editingCell, 'ui-editing-cell');\r\n *                   _this.editingCell = null;\r\n *                   _this.onEditComplete.emit({ field: _this.editingCellField, data: _this.editingCellData });//+\r\n *                   _this.unbindDocumentEditListener();\r\n *               }\r\n *               _this.editingCellClick = false;\r\n *           };\r\n *           document.addEventListener('click', this.documentEditListener);\r\n *       }\r\n *   };\r\n * \r\n *  TTEditableColumn.prototype.openCell = function () {\r\n *       var _this = this;\r\n *        this.tt.updateEditingCell(this.el.nativeElement,this.data, this.field);//+\r\n *        domhandler_1.DomHandler.addClass(this.el.nativeElement, 'ui-editing-cell');\r\n *        this.tt.onEditInit.emit({ field: this.field, data: this.data });\r\n *        this.zone.runOutsideAngular(function () {\r\n *            setTimeout(function () {\r\n *                var focusable = domhandler_1.DomHandler.findSingle(_this.el.nativeElement, 'input, textarea');\r\n *                if (focusable) {\r\n *                     focusable.focus();\r\n *                 }\r\n *             }, 50);\r\n *        });\r\n *   };\r\n * \r\n *  TTEditableColumn.prototype.onClick = function (event) {\r\n *        if (this.isEnabled()) {\r\n *            this.tt.editingCellClick = true;\r\n *            if (this.tt.editingCell) {\r\n *                if (this.tt.editingCell !== this.el.nativeElement) {\r\n *                    if (!this.tt.isEditingCellValid()) {\r\n *                        return;\r\n *                    }\r\n *                    this.tt.onEditComplete.emit({ field: this.tt.oldField, data: this.tt.oldDdata });//+\r\n *                    DomHandler.removeClass(this.tt.editingCell, 'ui-editing-cell');\r\n *                    this.openCell();\r\n *                }\r\n *            }\r\n *            else {\r\n *                this.openCell();\r\n *            }\r\n *        }\r\n *  };\r\n * \r\n *  TTEditableColumn.prototype.openCell = function () {\r\n *         var _this = this;\r\n *         this.tt.updateEditingCell(this.el.nativeElement,this.data, this.field);\r\n *         DomHandler.addClass(this.el.nativeElement, 'ui-editing-cell');\r\n *         this.tt.onEditInit.emit({ field: this.field, data: this.data });\r\n *         this.tt.oldField= this.field; //+\r\n *         this.tt.oldDdata=this.data;  //+\r\n *         this.zone.runOutsideAngular(function () {\r\n *             setTimeout(function () {\r\n *                 var focusable = DomHandler.findSingle(_this.el.nativeElement, 'input, textarea');\r\n *                if (focusable) {\r\n *                     focusable.focus();\r\n *                 }\r\n *           }, 50);\r\n *       });\r\n *   };\r\n * \r\n * 3. HTMLæ¨¡æ¿\r\n * (1) ä¸å¯ç¨å¤è¡¨å¤´\r\n *      <p-treeTable [columns]=\"treeGridColumns\" farrisPrimengTreeTableBinding farrisHierarchyInfoKey=\"layerField\" [resizableColumns]=\"true\" farrisPrimengTreeTableIdField=\"id\">\r\n *             <ng-template pTemplate=\"header\" let-columns>\r\n *                 <tr>\r\n *                     <th *ngFor=\"let col of columns\" ttResizableColumn>\r\n *                         {{col.header}}\r\n *                     </th>\r\n *                 </tr>\r\n *             </ng-template>\r\n *             <ng-template pTemplate=\"body\" let-rowNode let-rowData=\"rowData\" let-columns=\"columns\">\r\n *                 <tr>\r\n *                     <td *ngFor=\"let col of columns; let i = index\" ttEditableColumn [ttEditableColumn]=\"rowData\"\r\n *                         [ttEditableColumnField]=\"col.field\">\r\n *                         <p-treeTableToggler [rowNode]=\"rowNode\" *ngIf=\"i === 0\"></p-treeTableToggler>\r\n *                         <p-treeTableCellEditor>\r\n *                             <ng-template pTemplate=\"input\">\r\n *                                  <!-- æ§ä»¶å¨æçæåºåï¼æ­¤å¤å¯æ¾ç½®æ§ä»¶å¨æçæç»ä»¶ï¼çæè§åå¦ä¸ï¼\r\n *                                            1. å­ç¬¦ä¸²ç±»åï¼ææ¬æ§ä»¶\r\n *                                            2. æ°å­ç±»åï¼æ°å­æ§ä»¶\r\n *                                            3. å¸å°ç±»åï¼å¤éæ¡æ§ä»¶\r\n *                                            4. æ¥ææ¶é´ç±»åï¼æ¥ææ¶é´æ§ä»¶\r\n *                                            5. æä¸¾ç±»åï¼ä¸ææ¡æ§ä»¶\r\n *                                            6. å¸®å©ç±»åï¼å¸®å©æ§ä»¶-->\r\n *                             </ng-template>\r\n *                             <ng-template pTemplate=\"output\">{{ col | formatCellData : rowData }}</ng-template>\r\n *                         </p-treeTableCellEditor>\r\n *                     </td>\r\n *                 </tr>\r\n *             </ng-template>\r\n *     </p-treeTable>\r\n * \r\n * (2) å¯ç¨å¤è¡¨å¤´\r\n * \r\n *  <p-treeTable [columns]=\"treeGridColumns\" farrisPrimengTreeTableBinding farrisHierarchyInfoKey=\"layerField\" [resizableColumns]=\"true\" farrisPrimengTreeTableIdField=\"id\">\r\n *             <ng-template pTemplate=\"header\" let-columns>\r\n *                  <tr *ngFor=\"let columnHeader of treeGridColumnHeaders\">\r\n *                      <th *ngFor=\"let col of columnHeader\" ttResizableColumn [attr.rowspan]=\"col.rowspan\" [attr.colspan]=\"col.colspan\">\r\n *                          {{col.header}}\r\n *                      </th>\r\n *                  </tr>\r\n *             </ng-template>\r\n *             <ng-template pTemplate=\"body\" let-rowNode let-rowData=\"rowData\" let-columns=\"columns\">\r\n *                 <tr>\r\n *                     <td *ngFor=\"let col of columns; let i = index\" ttEditableColumn [ttEditableColumn]=\"rowData\"\r\n *                         [ttEditableColumnField]=\"col.field\">\r\n *                         <p-treeTableToggler [rowNode]=\"rowNode\" *ngIf=\"i === 0\"></p-treeTableToggler>\r\n *                         <p-treeTableCellEditor>\r\n *                             <ng-template pTemplate=\"input\">\r\n *                                  <!-- æ§ä»¶å¨æçæåºåï¼æ­¤å¤å¯æ¾ç½®æ§ä»¶å¨æçæç»ä»¶ï¼çæè§åå¦ä¸ï¼\r\n *                                            1. å­ç¬¦ä¸²ç±»åï¼ææ¬æ§ä»¶\r\n *                                            2. æ°å­ç±»åï¼æ°å­æ§ä»¶\r\n *                                            3. å¸å°ç±»åï¼å¤éæ¡æ§ä»¶\r\n *                                            4. æ¥ææ¶é´ç±»åï¼æ¥ææ¶é´æ§ä»¶\r\n *                                            5. æä¸¾ç±»åï¼ä¸ææ¡æ§ä»¶\r\n *                                            6. å¸®å©ç±»åï¼å¸®å©æ§ä»¶-->\r\n *                             </ng-template>\r\n *                             <ng-template pTemplate=\"output\">{{ col | formatCellData : rowData }}</ng-template>\r\n *                         </p-treeTableCellEditor>\r\n *                     </td>\r\n *                 </tr>\r\n *             </ng-template>\r\n *  </p-treeTable>\r\n * \r\n * å¤è¡¨å¤´æ°æ®æ ¼å¼ï¼\r\n *  this.treeGridColumnHeaders=[\r\n *     [{ header: 'Brand',rowspan:3, colspan:1},{ header: 'Sale Rate',rowspan:1, colspan:4}],\r\n *     [{ header: 'Sales',rowspan:1, colspan:2},{ header: 'Profits',rowspan:1, colspan:2}],\r\n *     [{ header: 'Last Year',rowspan:1, colspan:1},{ header: 'This Year',rowspan:1, colspan:1},{ header: 'Last Year',rowspan:1, colspan:1},{ header: 'This Year',rowspan:1, colspan:1}],\r\n *  ]\r\n\r\n **********************************************************************************************************************/\r\n\r\nimport { Directive, OnInit, OnChanges, SimpleChanges, Input, HostListener, Output, EventEmitter, Type } from '@angular/core';\r\nimport { BindingData, BindingList, FrameContext, Change, ChangeType, EntityCollection, EntityList, Entity, ComponentType } from '@farris/devkit';\r\nimport { TreeTable } from 'primeng/treetable';\r\nimport { TreeNode } from 'primeng/api';\r\nimport { TreeNodeBuilderFactory } from '../tree_table_node_builder/tree_node_builder_factory';\r\nimport { DateTimeHelperService } from '@farris/ui-common/date';\r\nconst PARENT_ELEMENT: string = \"parentElement\";\r\nconst PATH: string = \"path\";\r\nconst IS_DETAIL: string = 'isDetail';\r\n\r\nexport interface FarrisPrimengTreeNode extends TreeNode {\r\n  id?: string;\r\n}\r\n\r\n@Directive({\r\n  selector: '[farrisPrimengTreeTableBinding]'\r\n})\r\nexport class FarrisPrimengTreeTableBindingDirective implements OnInit, OnChanges {\r\n  private selectedRowId = null;\r\n  private treeTableSelectedEvent = null;\r\n  /**\r\n   * åçº§ç ä¿¡æ¯å­æ®µï¼å±æ§å¯è½æä¸¤ç§æ ¼å¼çå¼ï¼åçº§ç å­æ®µï¼ä¸»è¡¨ï¼æä»è¡¨åç«¯codes/åçº§ç å­æ®µï¼å­è¡¨ï¼\r\n   */\r\n  @Input('farrisHierarchyInfoKey')\r\n  public hierarchyInfoKey: string;\r\n  @Input('columns')\r\n  public columns: any;\r\n  /**\r\n   * åç ï¼æ°æ®çå¯ä¸æ è¯\r\n   */\r\n  @Input('farrisPrimengTreeTableIdField')\r\n  public idField: string;\r\n\r\n  /**\r\n   * èç¹éæ©åæ´äºä»¶\r\n   */\r\n  @Output() nodeSelectChange: EventEmitter<any> = new EventEmitter<any>();\r\n\r\n  private oldTreeNodeMap: { [key: string]: FarrisPrimengTreeNode } = {};\r\n\r\n\r\n  /**\r\n   * åçº§ç çå­æ®µç¼å·ï¼ä»hierarchyInfoKeyå±æ§ä¸­è§£æè·å\r\n   */\r\n  private hierarchyInfoField: string;\r\n\r\n  /**\r\n   * ç»å®æ°æ®\r\n   */\r\n  private get bindingData(): BindingData {\r\n    return this.frameContext.bindingData;\r\n  }\r\n\r\n  /**\r\n   * ç»å®æ°æ®åè¡¨\r\n   */\r\n  private get bindingList(): BindingList {\r\n    return this.bindingData.getList();\r\n  }\r\n\r\n  private getHierarchyInfoField(): string {\r\n    let infos = this.hierarchyInfoKey.split('/');\r\n    return infos[infos.length - 1];\r\n  }\r\n\r\n  constructor(\r\n    private treeTable: TreeTable,\r\n    private frameContext: FrameContext,\r\n    private dateService: DateTimeHelperService\r\n  ) { }\r\n\r\n  ngOnChanges(changes: SimpleChanges): void {\r\n  }\r\n\r\n  ngOnInit(): void {\r\n    //è§£æè·ååçº§ç å­æ®µç¼å·\r\n    this.hierarchyInfoField = this.getHierarchyInfoField();\r\n    // å°åçº§ç ä¿¡æ¯ä¿å­å°root-component\r\n    const virtualRootFrameContext = this.frameContext.getVirtualRootFrameContext();\r\n    virtualRootFrameContext.setParam('hierarchyInfoKey', this.hierarchyInfoKey);\r\n    this.bindingData.changes.subscribe((change: Change) => {\r\n      this.bindData(change);\r\n      this.updateSelectedRow(change);\r\n    });\r\n    this.frameContext.viewModel.uiState.setPropertyValue('ids', []);\r\n    if (this.frameContext && this.frameContext.frameComponent) {\r\n      this.frameContext.frameComponent.componentType = ComponentType.primengTreeComponent;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * è·åæ åè¡¨ç»å®æ°æ®å¯¹åºçå®ä½æ°ç»\r\n   * @returns å®ä½æ°ç»\r\n   */\r\n  private getEntityArr(): Entity[] {\r\n    const entityCollection = this.frameContext.repository.entityCollection;\r\n    const bindingPath: string = this.frameContext.bindingData.bindingPath;\r\n    if (!bindingPath || bindingPath === '/') {\r\n      return entityCollection.toArray();\r\n    }\r\n    let bindingList: BindingList = this.frameContext.bindingData.list;\r\n    let bindingPathArr: string[] = bindingPath.split('/').filter(str => str);\r\n    let pathArray = [];\r\n    bindingPathArr.forEach((path: string) => {\r\n      pathArray.push(`${bindingList.primaryKey}:${bindingList.currentId}`);\r\n      pathArray.push(path);\r\n      bindingList = bindingList.currentItem[path];\r\n    });\r\n    return (entityCollection.getEntitiesByPath(pathArray) as EntityList<any>).toArray();\r\n  }\r\n  /**\r\n   * å°çå®é¡ºåºæ è®°å°å¯¹åºçå®ä½ä¸\r\n   * @param entityArr å®ä½æ°ç»\r\n   * @param treeNodes æ èç¹\r\n   */\r\n  private setActualIndex(entityArr: Entity[], treeNodes: TreeNode[]) {\r\n    if (entityArr.length < 1)\r\n      return;\r\n    // åå§ååºå·å¨å¹¶ä¾æ¬¡éåæ¯ä¸æ£µæ \r\n    let counter = { index: 0 };\r\n    const primaryKey: string = entityArr[0].primaryKey;\r\n    treeNodes.forEach((rootNode) => {\r\n      this.traverseTree(rootNode, counter, entityArr, primaryKey);\r\n    });\r\n  }\r\n  /**\r\n   * ååºéå½éåæ èç¹å¹¶å¨å¯¹åºå®ä½ä¸æ è®°åºå·\r\n   * @param treeNode æ èç¹\r\n   * @param counter åºå·å¨\r\n   * @param entityArr å®ä½æ°ç»\r\n   * @description\r\n   * å¨è¿è¡åç«¯æ ¡éªæ¶ï¼æç§Entityå¨æ°ç»ä¸­çä¸æ çæï¼éè¯¯æç¤ºçï¼è¡å·çæ¹å¼ä¸éç¨äºæ åè¡¨ï¼\r\n   * å ä¸ºæ åè¡¨å¯ä»¥å¨å·²ç»æ·»å çèç¹ä¸å å¥å­èç¹ï¼èEntityæ»æ¯å¨æåè¿½å æ°å¯¹è±¡ï¼å¯¼è´äºèçé¡ºåºä¸ä¸å®ç¸åï¼\r\n   * æä»¥å¨ç»å®æ°æ®çæ¶åå°æ èç¹å¨åè¡¨ä¸­ççå®é¡ºåºéè¿ä¸ä¸ªéå çå±æ§ï¼__ACTUAL_INDEX__ï¼èµç»Entityç¤ºä¾ï¼\r\n   * å½Entityè°ç¨validateæ¹æ³æ¶ï¼æ£æ¥æ¯å¦å­å¨è¯¥å±æ§ï¼å¦æå­å¨ååºç¨è¯¥å±æ§çå¼ä½ä¸ºè¡å·ã\r\n   */\r\n  private traverseTree(treeNode: TreeNode, counter: { index: number }, entityArr: Entity[], primaryKey: string) {\r\n    const INDEX_LABEL = \"__ACTUAL_INDEX__\";\r\n    // å¤çå½åèç¹\r\n    const entity = entityArr.find(e => e[primaryKey] === treeNode.data[primaryKey]);\r\n    if (entity) {\r\n      Object.defineProperty(entity, INDEX_LABEL, {\r\n        value: counter.index\r\n      });\r\n      counter.index++;\r\n    }\r\n    // éå½éååæ¯\r\n    treeNode.children.forEach((rootNode) => {\r\n      this.traverseTree(rootNode, counter, entityArr, primaryKey);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * å¤çæ°æ®åæ´\r\n   * @param change åæ´\r\n   * @returns æ¯å¦è·³è¿ç»å®æ°æ®çæ´ä½å·æ°\r\n   * @description\r\n   * ç®çæ¯å°½éå°çéæ°æé æ´ä¸ªæ åè¡¨ï¼æ¯å¦å¨åçå¼ååäºä»¶æ¶å°½éåªæ´æ¹ååçå¼å°±ç»æï¼\r\n   * å¦æä»»ä½ååé½éæ°æé æ ï¼ä¼å¯¼è´Tabé®åæ¢åè½é¾ä»¥å®ç°ç­é®é¢ã\r\n   */\r\n  private handleChange(change?: Change): boolean {\r\n    // æ²¡æåæ´æ¶ï¼ç»§ç»­ç»å®æ°æ®å·æ°\r\n    if (!change)\r\n      return false;\r\n    // åç±»å¤çå·ä½çåæ´\r\n    switch (change.type) {\r\n      case ChangeType.SelectionChanged:\r\n        return this.handleSelectionChanged(change);\r\n      case ChangeType.GlobalSelectionChanged:\r\n        return this.handleSelectionChanged(change);\r\n      case ChangeType.ValueChanged:\r\n        return this.handleValueChanged(change);\r\n      default:\r\n        return false;\r\n    }\r\n  }\r\n  /**\r\n   * å¤çè¡åæ¢åæ´\r\n   * @param change åæ´\r\n   * @returns æ¯å¦è·³è¿ç»å®æ°æ®çæ´ä½å·æ°\r\n   */\r\n  private handleSelectionChanged(change: Change): boolean {\r\n    // å½åç»å®è·¯å¾ä¸åçè¡åæ¢äºä»¶ï¼ä¸è¿è¡æ°æ®å·æ°ï¼ä¸ºäºæ¯æTabé®åæ¢ååæ ¼ï¼\r\n    if (change.type === ChangeType.SelectionChanged || change.type === ChangeType.GlobalSelectionChanged) {\r\n      let path = change.path;\r\n      let frmPath = this.bindingData.bindingPath.split(\"/\").filter(str => str);\r\n      if (path.length === frmPath.length) {\r\n        let same = true;\r\n        for (let i = 0; i < path.length; i++) {\r\n          if (path[i] !== frmPath[i])\r\n            same = false;\r\n        }\r\n        if (same)\r\n          return true;\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n  /**\r\n   * å¤çè¡åæ¢åæ´\r\n   * @param change åæ´\r\n   * @returns æ¯å¦è·³è¿ç»å®æ°æ®çæ´ä½å·æ°\r\n   */\r\n  private handleValueChanged(change: Change): boolean {\r\n    if (change.type !== ChangeType.ValueChanged) {\r\n      return false;\r\n    }\r\n    // æ¥æ¶å°å¼ååäºä»¶ï¼å°è¯ä»è¿è¡å±é¨æ°æ®çæ´æ°ï¼ä¸ºäºæ¯æTabé®åæ¢ååæ ¼ï¼\r\n    let path = change.path;\r\n    let bindingPathArr = this.bindingData.bindingPath.split(\"/\").filter(str => str);\r\n    // å¤æ­ç»å®è·¯å¾æ¯å¦ç¸åï¼å¦æä¸ç¸ååæ´ä½å·æ°\r\n    for (let item of bindingPathArr) {\r\n      if (path.length > 0) {\r\n        if (item === path[0]) {\r\n          path.shift();\r\n        } else {\r\n          return false;\r\n        }\r\n      }\r\n    }\r\n    // éè¿idæ¾å°å¾æ´æ°çæ èç¹\r\n    let id = change.id;\r\n    if (id) {\r\n      const primaryKey = this.bindingList.primaryKey;\r\n      let nodes = this.treeTable.value;\r\n      let targetNode = null;\r\n      for (let node of nodes) {\r\n        let result = this.findTreeNodeById(node, primaryKey, id);\r\n        if (result) {\r\n          targetNode = result;\r\n          break;\r\n        }\r\n      }\r\n      if (targetNode && path.length === 1) {\r\n        const propertyName = path.shift();\r\n        if (targetNode.data.hasOwnProperty(propertyName) && change.hasOwnProperty(\"value\")) {\r\n          targetNode.data[propertyName] = change.value;\r\n          return true;\r\n        }\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n  /**\r\n   * éè¿ä¸»é®å¼æ¥æ¾æ èç¹\r\n   * @param treeNode æ æ ¹èç¹\r\n   * @param primaryKey ä¸»é®å\r\n   * @param keyValue ä¸»é®å¼\r\n   * @returns æ èç¹\r\n   * @todo éå½éåå®ç°æ¯è¾ä½æï¼èèéè¿oldTreeNodeMapæ¥æ¾æ èç¹\r\n   */\r\n  private findTreeNodeById(treeNode: TreeNode, primaryKey: string, keyValue: any): TreeNode | null {\r\n    if (!treeNode)\r\n      return null;\r\n    if (treeNode.data.hasOwnProperty(primaryKey) && treeNode.data[primaryKey] === keyValue)\r\n      return treeNode;\r\n    if (treeNode.children) {\r\n      for (let node of treeNode.children) {\r\n        let result = this.findTreeNodeById(node, primaryKey, keyValue);\r\n        if (result)\r\n          return result;\r\n      }\r\n    }\r\n    return null;\r\n  }\r\n\r\n  /**\r\n  * ç»å®æ°æ®\r\n  */\r\n  private bindData(change?: Change) {\r\n    let skipRefresh: boolean = this.handleChange(change);\r\n    if (skipRefresh) {\r\n      return;\r\n    }\r\n    // this.sourceData = this.bindingList.toJSON({ ignoreMultiLangInput: true });\r\n    const oldTreeNodes = this.treeTable.value;\r\n    const treeNodesData = this.bindingList.toJSON({ ignoreMultiLangInput: true });\r\n    let treeNodes: TreeNode[] = [];\r\n\r\n    if (treeNodesData && treeNodesData.length > 0) {\r\n      let hierarchyInfo = treeNodesData[0][this.hierarchyInfoField];\r\n      const builder: Type<any> = TreeNodeBuilderFactory.getBuilder(hierarchyInfo);\r\n      // æå¡å¨è¿åçåçº§èç¹ä¿¡æ¯å¹éä¸å°ç°æå·¥åéé¢çä»»ä½ä¸ç§æåµãç¡®è®¤æ°å çbuilderå·²ç»å¨å·¥åä¸­æ³¨å\r\n      if (builder == null) {\r\n        throw new Error('TreeTable builder is null!');\r\n      }\r\n      let expandLevel = -1;\r\n      const treeExpandLevel = this.treeTable['expandLevel'];\r\n      if (typeof treeExpandLevel !== 'undefined') {\r\n        expandLevel = treeExpandLevel;\r\n      }\r\n      const context = {\r\n        expandLevel,\r\n        component: this.treeTable,\r\n      };\r\n      const treeNodesBuilder = new builder(\r\n        treeNodesData, oldTreeNodes,\r\n        this.bindingList.primaryKey, this.hierarchyInfoField, context\r\n      );\r\n      treeNodes = treeNodesBuilder.build();\r\n      // è·åç»å®æ°æ®å¯¹åºçå®ä½åè¡¨\r\n      let entityArr: Entity[] = this.getEntityArr();\r\n      // æ ¹æ®treeNodesçé¡ºåºå¨å¯¹åºçå®ä½ä¸æ·»å åºå·å­æ®µ__ACTUAL_INDEX__\r\n      this.setActualIndex(entityArr, treeNodes);\r\n    }\r\n\r\n    if (!this.treeTable.lazy) {\r\n      this.treeTable.totalRecords = (this.treeTable._value ? this.treeTable._value.length : 0);\r\n      if (this.treeTable.sortMode == 'single' && this.treeTable.sortField)\r\n        this.treeTable.sortSingle();\r\n      else if (this.treeTable.sortMode == 'multiple' && this.treeTable.multiSortMeta)\r\n        this.treeTable.sortMultiple();\r\n      else if (this.treeTable.hasFilter()) //sort already filters\r\n        this.treeTable._filter();\r\n    }\r\n    this.treeTable.tableService.onUIUpdate(treeNodes);\r\n    this.treeTable.value = treeNodes;\r\n    this.treeTable.updateSerializedValue();\r\n\r\n    // this.treeNodeMap = {};\r\n    // this.sourceDataClone = this.sourceData;\r\n    // this.treeTable.value = [...this.treeNodesBuilder()];\r\n    // this.treeTableValueHandler();\r\n  }\r\n  private updateSelectedRow(change: Change) {\r\n    const currentId = this.bindingList.currentId;\r\n    if (this.treeTableSelectedEvent) {\r\n      this.treeTableSelectedEvent = false;\r\n      this.selectedRowId = currentId;\r\n      return;\r\n    }\r\n    const serializedValue = this.treeTable.serializedValue;\r\n\r\n    const treeNode = serializedValue && serializedValue.find(item => item && item.node && item.node.data && item.node.data.id === currentId) || null;\r\n    if (treeNode) {\r\n      if (this.treeTable.isSelected(treeNode.node) || currentId === this.selectedRowId) {\r\n        return;\r\n      }\r\n      this.selectedRowId = currentId;\r\n      this.treeTable.handleRowClick({ rowNode: treeNode, originalEvent: { target: { nodeName: '' } } });\r\n    }\r\n  }\r\n  @HostListener('onEditInit', ['$event'])\r\n  public onEditInitHandler(event: any) {\r\n    this.nodeSelectChange.emit(event['data']);\r\n    const id = event.data[this.idField];\r\n    this.setCurrentIdToBindingList(id);\r\n  }\r\n\r\n\r\n  @HostListener('onEditComplete', ['$event'])\r\n  public onEditCompleteHandler(event: any) {\r\n    let fieldName = event.field;\r\n    const column = this.columns.find(item => item.field === fieldName);\r\n    if (fieldName && column && column.editor && column.editor.options && column.editor.options.type === 'EditorTypes.LOOKUP') {\r\n      return;\r\n    }\r\n    if (event && event.hasOwnProperty('data')) {\r\n      const primaryKeyValue = event.data[this.frameContext.repository.primaryKey];\r\n\r\n      let value: any = this.getValue(fieldName, event.data);\r\n      const bindingPath = this.frameContext.viewModel.bindingPath || '/';\r\n      const bindingPaths = bindingPath.split('/').filter(p => p);\r\n      const bindingList: BindingList = this.bindingData.getValue(bindingPaths);\r\n      const bindingObject = bindingList.findById(primaryKeyValue);\r\n      const oldValue = this.getValue(fieldName, bindingObject);\r\n      const column = this.treeTable.columns.find(item => item.field === fieldName);\r\n      const dataType = column && column.dataType || null;\r\n      if (dataType === 'date' || dataType === 'datetime') {\r\n        if (this.dateService) {\r\n          const format = column && column.formatter && column.formatter.options && column.formatter.options.format || 'yyyy-MM-dd';\r\n          value = this.dateService.formatTo(value, format);\r\n          if (!value) {\r\n            value = null;\r\n          }\r\n        }\r\n      } else if (dataType === 'number') {\r\n        value = Number(value);\r\n      }\r\n      if (value !== oldValue) {\r\n        this.updateBindingList(primaryKeyValue, fieldName, value);\r\n      }\r\n    }\r\n  }\r\n\r\n  @HostListener('onNodeExpand', ['$event'])\r\n  public onNodeExpandHandler(event: any) {\r\n    // this.setNodeExpandedValue(event);\r\n    const selectedId = event && event.node && event.node.id || null;\r\n    if (!selectedId) {\r\n      return;\r\n    }\r\n    const virtualRootFrameContext = this.frameContext.getVirtualRootFrameContext();\r\n    const expandNodes = virtualRootFrameContext.getParam('TREE_LATEST_EXPANDED_ID') || [];\r\n    expandNodes.push(selectedId);\r\n    virtualRootFrameContext.setParam('TREE_LATEST_EXPANDED_ID', expandNodes);\r\n  }\r\n\r\n  @HostListener('onNodeCollapse', ['$event'])\r\n  public onNodeCollapseHandler(event: any) {\r\n    // this.setNodeExpandedValue(event);\r\n  }\r\n  @HostListener('onNodeSelect', ['$event'])\r\n  public onNodeSelectHandler(event: any) {\r\n    const id = event && event.node && event.node.data && event.node.data[this.frameContext.repository.primaryKey] || null;\r\n    if (id === this.bindingList.currentId) {\r\n      return;\r\n    }\r\n    this.treeTableSelectedEvent = true;\r\n    this.setCurrentIdToBindingList(id);\r\n  }\r\n  @HostListener('onNodeUnselect', ['$event'])\r\n  public onNodeUnselectHandler(event: any) {\r\n    this.setCurrentIdToBindingList(null);\r\n  }\r\n  private setNodeExpandedValue(event: any) {\r\n    if (!event || !this.oldTreeNodeMap || Object.keys(this.oldTreeNodeMap).length <= 0) {\r\n      return;\r\n    }\r\n    try {\r\n      let currentId = event.node.data.id;\r\n      this.oldTreeNodeMap[currentId].expanded = event.expanded;\r\n    } catch (e) {\r\n      console.warn(`setNodeExpandedValue error:${e.message}`);\r\n    }\r\n  }\r\n  private setCurrentIdToBindingList(selectedId: string): void {\r\n    const oldCurrentId = this.bindingList.currentId;\r\n    if (oldCurrentId === selectedId) {\r\n      return;\r\n    }\r\n    this.bindingList.setCurrentId(selectedId, true);\r\n  }\r\n\r\n  private getPaths(): string[] {\r\n    let paths = [];\r\n    if (!this.frameContext.viewModel || !this.frameContext.viewModel.bindingPath || this.frameContext.viewModel.bindingPath === '/') {\r\n      return paths;\r\n    }\r\n    else {\r\n      let bindingPath = this.frameContext.viewModel.bindingPath;\r\n      paths = bindingPath.substring(1, bindingPath.length).split('/');\r\n      return paths;\r\n    }\r\n  }\r\n  private updateBindingList(primaryValue: any, propertyName: string, value: any) {\r\n    if (!propertyName) {\r\n      return;\r\n    }\r\n    // æ´æ°ä¸»è¡¨é¨åè¡çå­æ®µ\r\n    const propertyNames = propertyName.split('.').filter(item => item);\r\n    const bindingPath = this.getBindingPathArray();\r\n    // ååºæ¥çä¸å®æ¯bindingList\r\n    const list = this.bindingData.getValue(bindingPath) as BindingList;\r\n    // ä¿®æ¹çæ¯å½åè¡\r\n    const paths = bindingPath.concat(propertyNames);\r\n    if (list && primaryValue === list.currentItem.primaryKeyValue) {\r\n      this.bindingData.setValue(paths, value, true, true);\r\n      return;\r\n    }\r\n    const bindingObject = this.bindingList.findById(primaryValue);\r\n    if (!bindingObject) {\r\n      return;\r\n    }\r\n    if (propertyNames.length < 2) {\r\n      bindingObject.setValue(propertyName, value, true, true, undefined, this.bindingData.getValudChangeInvokerFactory()(paths));\r\n    } else {\r\n      let targetBindingObject = null;\r\n      const fpaths = propertyNames.slice(0, propertyNames.length - 1);\r\n      const targetPropertyName = propertyNames[propertyNames.length - 1];\r\n      fpaths.forEach(prop => {\r\n        targetBindingObject = targetBindingObject && targetBindingObject[prop] || bindingObject[prop];\r\n      });\r\n      // todo:éè¦æ·»å å¼ååäºä»¶\r\n      targetBindingObject.setValue(targetPropertyName, value, true, true, undefined, this.bindingData.getValudChangeInvokerFactory()(paths));\r\n    }\r\n  }\r\n  private getBindingPathArray(): any[] {\r\n    const path = this.frameContext.viewModel.bindingPath;\r\n    if (path) {\r\n      return path.split('/').filter(n => n !== '');\r\n    }\r\n    return [];\r\n  }\r\n  private getValue(path: string, data: any) {\r\n    let value = '';\r\n    if (path.indexOf('.') === -1) {\r\n      value = data[path];\r\n    } else {\r\n      value = path.split('.').reduce((result, prop) => {\r\n        return result[prop];\r\n      }, data);\r\n    }\r\n    return value;\r\n  }\r\n  protected setChecks(ids: string[]) {\r\n    this.frameContext.viewModel.uiState.setPropertyValue('ids', ids);\r\n  }\r\n}","import { Directive, Injector, Input, OnChanges, OnDestroy, SimpleChanges } from \"@angular/core\";\r\nimport { FrameContext } from \"@farris/devkit\";\r\nconst EXCLUDE_VALIDATE_FIELDS = 'excludeValidateRules';\r\nconst RULETYPE = 'required';\r\n@Directive({\r\n  selector: '[farris-dynamic-required]'\r\n})\r\nexport class FarrisDynamicRequiredDirective implements OnChanges, OnDestroy {\r\n  /**\r\n   * like {field:'',type:'require'}\r\n   */\r\n  @Input('farris-dynamic-required') field: string;\r\n  /**\r\n   * å¯ç¨æ ¡éªçæ¶æº\r\n   */\r\n  @Input('requiredOn') requiredOn: boolean = false;\r\n  constructor(protected frameContext: FrameContext, private injector: Injector) {\r\n\r\n  }\r\n  ngOnDestroy(): void {\r\n    this.updateValidateRule(false);\r\n  }\r\n  ngOnChanges(changes: SimpleChanges): void {\r\n    // å¯ç¨å¿å¡«æ ¡éª\r\n    this.updateValidateRule(this.requiredOn);\r\n  }\r\n  /**\r\n   * \r\n   * @param isRequired \r\n   */\r\n  private updateValidateRule(isRequired: boolean) {\r\n    if (!this.field) {\r\n      return;\r\n    }\r\n    this.frameContext.form.updateFieldValidateRule(this.field, isRequired);\r\n    // if (isRequired) {\r\n    //   const rules = this.frameContext.params.get(EXCLUDE_VALIDATE_FIELDS) || {};\r\n    //   const fieldExcludeRules: string[] = rules[this.field] || [];\r\n    //   if (fieldExcludeRules.includes(RULETYPE)) {\r\n    //     const index = fieldExcludeRules.indexOf(RULETYPE);\r\n    //     fieldExcludeRules.splice(index, 1);\r\n    //   }\r\n    //   this.frameContext.params.set(EXCLUDE_VALIDATE_FIELDS, rules);\r\n    //   this.frameContext.form.updateFieldValidateRule(this.field, fieldExcludeRules);\r\n    // } else {\r\n    //   // ç¦ç¨æ ¡éª\r\n    //   // {int1:[required,maxValue]}\r\n    //   const rules = this.frameContext.params.get(EXCLUDE_VALIDATE_FIELDS) || {};\r\n    //   const fieldExcludeRules = rules[this.field] || [];\r\n    //   if (fieldExcludeRules && !fieldExcludeRules.includes(RULETYPE)) {\r\n    //     fieldExcludeRules.push(RULETYPE);\r\n    //   }\r\n    //   rules[this.field] = fieldExcludeRules;\r\n    //   this.frameContext.params.set(EXCLUDE_VALIDATE_FIELDS, rules);\r\n    //   this.frameContext.form.updateFieldValidateRule(this.field, fieldExcludeRules);\r\n    // }\r\n  }\r\n\r\n}\r\n","import { Directive, ElementRef, OnInit } from '@angular/core';\r\nimport { ViewModel } from '@farris/devkit';\r\nimport { EditorComponent } from '@farris/ui-editor';\r\n\r\n@Directive({\r\n  selector: '[farris-editor],[farris-editor-bind]'\r\n})\r\nexport class FarrisEditorDirective implements OnInit {\r\n  constructor(private viewModel: ViewModel, private editor: EditorComponent) { }\r\n\r\n  ngOnInit(): void {\r\n    this.setComponentRef();\r\n  }\r\n\r\n  private setComponentRef() {\r\n    const appContext = this.viewModel && this.viewModel.frameContext && this.viewModel.frameContext.getFormAppContext();\r\n    const frameId = this.viewModel && this.viewModel.frameContext && this.viewModel.frameContext.frameId;\r\n    const editor: any = this.editor;\r\n    const elementRef: ElementRef = editor && editor.injector && editor.injector.get(ElementRef, null);\r\n    const id = elementRef && elementRef.nativeElement && elementRef.nativeElement.id || null;\r\n    // å¦æframeIdä¸å­å¨ætreetableæ²¡æidå±æ§ï¼è¯´æä¸ç¬¦åä½¿ç¨åºæ¯\r\n    if (!frameId || !id) {\r\n      return;\r\n    }\r\n    const map = appContext && appContext.componentRefs && appContext.componentRefs.get(frameId) || new Map<string, any>();\r\n    appContext && appContext.componentRefs && appContext.componentRefs.set(frameId, map.set(id, this.editor));\r\n  }\r\n}","import { Directive, HostListener, Injector } from \"@angular/core\";\r\nimport { FrameContext } from \"@farris/devkit\";\r\nimport { QuerySolutionComponent } from \"@gsp-cmp/querysolution\";\r\n@Directive({\r\n  selector: \"[farris-querysolution-event-bind]\"\r\n})\r\nexport class FarrisQuerySolutionEventBindDirective {\r\n  constructor(private injector: Injector, private component: QuerySolutionComponent, private frameContext: FrameContext) { }\r\n  /**\r\n   * æ§è¡ç­é\r\n   * @param event event\r\n   */\r\n  @HostListener(\"queryEmitter\")\r\n  private onQuery(event: any) {\r\n    if (this.frameContext) {\r\n      this.frameContext.repository.entityCollection.pageIndex = 1;\r\n    }\r\n  }\r\n}","import { Directive, Inject, Injector, OnInit } from \"@angular/core\";\r\nimport { UserSettings, UserSettingsToken } from \"@farris/devkit\";\r\nimport { FarrisDatepickerComponent } from '@farris/ui-datepicker';\r\n@Directive({\r\n  selector: '[farris-date-localization]'\r\n})\r\nexport class FarrisDateLocalizationDirective implements OnInit {\r\n  constructor(private injector: Injector, @Inject(UserSettingsToken) private userSettings: UserSettings, private componentRef: FarrisDatepickerComponent) {\r\n\r\n  }\r\n  ngOnInit(): void {\r\n    this.localize();\r\n  }\r\n  private localize() {\r\n    if (this.userSettings && this.componentRef) {\r\n      const { dateFormat = null, timeFormat = null } = this.userSettings;\r\n      if (dateFormat === null && timeFormat === null) {\r\n        return;\r\n      }\r\n      if (timeFormat && timeFormat && this.componentRef.showTime === true) {\r\n        this.componentRef.dateFormat = `${dateFormat} ${timeFormat}`;\r\n        this.componentRef.dateOpts.dateFormat = `${dateFormat} ${timeFormat}`;\r\n        this.componentRef.updateValue(this.componentRef.value);\r\n      } else if (dateFormat) {\r\n        this.componentRef.dateFormat = `${dateFormat}`;\r\n        this.componentRef.dateOpts.dateFormat = `${dateFormat}`;\r\n        this.componentRef.updateValue(this.componentRef.value);\r\n      }\r\n    }\r\n  }\r\n}","import { Directive, Inject, Injector, OnInit } from \"@angular/core\";\r\nimport { UserSettings, UserSettingsToken } from \"@farris/devkit\";\r\nimport { NumberSpinnerComponent } from '@farris/ui-number-spinner';\r\n@Directive({\r\n  selector: '[farris-number-localization]'\r\n})\r\nexport class FarrisNumberLocalizationDirective implements OnInit {\r\n  constructor(private injector: Injector, @Inject(UserSettingsToken) private userSettings: UserSettings, private componentRef: NumberSpinnerComponent) {\r\n\r\n  }\r\n  ngOnInit(): void {\r\n    this.localize();\r\n  }\r\n  private localize() {\r\n    return;\r\n    // æ¶åéé¢ç­é®é¢ï¼æ°å­æ ¼å¼åä¸äºå¤ç\r\n    if (this.userSettings && this.userSettings.numberFormat && this.componentRef) {\r\n      const { negativeSign = null, numberDecimalDigits = null, numberDecimalSeparator = null, numberGroupSeparator = null } = this.userSettings.numberFormat || {};\r\n      // è´å·\r\n      if (negativeSign) {\r\n        // this.componentRef.prefix = negativeSign;\r\n      }\r\n      // å°æ°ä½æ°\r\n      if (numberDecimalDigits !== null) {\r\n        this.componentRef.precision = numberDecimalDigits;\r\n        this.componentRef.formatOptions['precision'] = numberDecimalDigits;\r\n      }\r\n      // å°æ°ç¹ç¬¦å·\r\n      if (numberDecimalSeparator !== null) {\r\n        this.componentRef.decimalSeparator = numberDecimalSeparator;\r\n        this.componentRef.formatOptions['decimalSeparator'] = numberDecimalSeparator;\r\n      }\r\n      // ååä½ç¬¦å·\r\n      if (numberGroupSeparator !== null) {\r\n        this.componentRef.groupSeparator = numberGroupSeparator;\r\n        this.componentRef.formatOptions['groupSeparator'] = numberGroupSeparator;\r\n      }\r\n      this.componentRef.updateValue(this.componentRef.value);\r\n    }\r\n  }\r\n}","import { Directive, Inject, Injector, OnInit } from \"@angular/core\";\r\nimport { UserSettings, UserSettingsToken } from \"@farris/devkit\";\r\nimport { TimePickerComponent } from '@farris/ui-time-picker';\r\n\r\n@Directive({\r\n  selector: '[farris-time-localization]'\r\n})\r\nexport class FarrisTimeLocalizationDirective implements OnInit {\r\n  constructor(private injector: Injector, @Inject(UserSettingsToken) private userSettings: UserSettings, private componentRef: TimePickerComponent) {\r\n\r\n  }\r\n  ngOnInit(): void {\r\n    this.localize();\r\n  }\r\n  private localize() {\r\n    if (this.userSettings && this.componentRef) {\r\n      const { timeFormat = null } = this.userSettings;\r\n      if (timeFormat) {\r\n        this.componentRef.format = timeFormat;\r\n      }\r\n    }\r\n  }\r\n}","import { Directive, Inject, Injector, Input, OnInit } from \"@angular/core\";\r\nimport { NumberFormat, UserSettings, UserSettingsToken } from \"@farris/devkit\";\r\nimport { BigNumber } from 'bignumber.js';\r\nimport moment from 'moment';\r\nimport { TextComponent } from '@farris/ui-text';\r\n\r\n@Directive({\r\n  selector: '[farris-text-localization]'\r\n})\r\nexport class FarrisTextLocalizationDirective implements OnInit {\r\n  @Input('localization') localization: boolean;\r\n  constructor(private injector: Injector, @Inject(UserSettingsToken) private userSettings: UserSettings, private componentRef: TextComponent) {\r\n    this.transform();\r\n  }\r\n  public ngOnInit() {\r\n  }\r\n  private transform() {\r\n    if (this.componentRef) {\r\n      this.componentRef.beforeWriteValue = (value: any, options: any) => {\r\n        let { localizationType = null, showTime = false } = options;\r\n        if (!value) {\r\n          return '';\r\n        }\r\n        if (localizationType && value) {\r\n          localizationType = localizationType.toLowerCase();\r\n          value = this.transformValue(value, localizationType);\r\n          return value;\r\n        } else {\r\n          return undefined;\r\n        }\r\n      };\r\n    }\r\n  }\r\n  private transformValue(value: any, dataType: string) {\r\n    if (dataType === 'date') {\r\n      return this.transformDate(value);\r\n    } else if (dataType === 'datetime') {\r\n      return this.transformDateTime(value);\r\n    }\r\n    // æ¶åéé¢è®¡ç®åæ¾ç¤ºé®é¢ï¼ä¸äºå¤ç\r\n    //  else if (dataType === 'number') {\r\n    //   return this.transformNumber(value);\r\n    // } \r\n    else {\r\n      return value;\r\n    }\r\n  }\r\n  /**\r\n   * è½¬æ¢æ¥æ\r\n   * @param value value\r\n   */\r\n  private transformDate(value: any) {\r\n    let dateFormat = this.userSettings && this.userSettings.dateFormat || 'YYYY-MM-DD';\r\n    if (!dateFormat || !value) {\r\n      return value;\r\n    }\r\n    const date = moment(value);\r\n    const isValid = date.isValid();\r\n    if (!isValid) {\r\n      return value;\r\n    }\r\n    dateFormat = this.parseDateFormat(dateFormat);\r\n    return date.format(dateFormat);\r\n  }\r\n  /**\r\n   * è½¬æ¢æ¥ææ¶é´\r\n   * @param value value\r\n   * todo: ç®åæ æ³å®ä¹æ¥ææ¶é´æ ¼å¼\r\n   */\r\n  private transformDateTime(value: any) {\r\n    let dateFormat = this.userSettings && this.userSettings.dateFormat || 'YYYY-MM-DD';\r\n    let timeFormat = this.userSettings && this.userSettings.timeFormat || 'HH:mm:ss';\r\n    if (!dateFormat || !timeFormat) {\r\n      return value;\r\n    }\r\n    const dateTime = moment(value);\r\n    const isValid = dateTime.isValid();\r\n    if (!isValid) {\r\n      return value;\r\n    }\r\n    if (dateFormat) {\r\n      dateFormat = this.parseDateFormat(dateFormat);\r\n    }\r\n    if (timeFormat) {\r\n      timeFormat = this.parseTimeFormat(timeFormat);\r\n    }\r\n    const dateTimeFormat = dateFormat + ' ' + timeFormat;\r\n    return dateTime.format(dateTimeFormat);\r\n  }\r\n  /**\r\n   * è½¬æ¢æ°å­\r\n   * @param value value\r\n   */\r\n  private transformNumber(value): string {\r\n    if (value === null || value === undefined || value === '') {\r\n      return '';\r\n    }\r\n    const bigNumber = new BigNumber(value);\r\n    // å¦æä¸æ¯æ°å­ï¼ä¸åä»»ä½å¤ç\r\n    if (!BigNumber.isBigNumber(bigNumber)) {\r\n      return value;\r\n    }\r\n    const isNegative = bigNumber.isNegative();\r\n    const format = this.buildNumberFormat();\r\n    const { negativeSign = null, numberDecimalDigits = null } = this.numberFormat || {};\r\n    if (isNegative) {\r\n      if (negativeSign !== null) {\r\n        format.prefix = negativeSign;\r\n        return bigNumber.absoluteValue().toFormat(numberDecimalDigits, null, format);\r\n      }\r\n    }\r\n    return bigNumber.toFormat(numberDecimalDigits, null, format);\r\n  }\r\n  /**\r\n   * è½¬æ¢æ¥ææ ¼å¼è§åä¸ºmomentçformatè§å\r\n   * @param format format\r\n   */\r\n  private parseDateFormat(format: string) {\r\n    return format.replace(/y/g, 'Y').replace(/d/g, 'D');\r\n  }\r\n  /**\r\n   * è½¬æ¢æ¶é´æ ¼å¼è§åä¸ºmomentçformatè§å\r\n   * @param format format\r\n   */\r\n  private parseTimeFormat(format: string) {\r\n    return format.replace(/M/g, 'm');\r\n  }\r\n  /**\r\n   * æé bignumberæ°å­æ ¼å¼åéé¡¹\r\n   */\r\n  private buildNumberFormat() {\r\n    if (this.numberFormat) {\r\n      const { numberDecimalSeparator = null, numberGroupSeparator = null } = this.numberFormat;\r\n      const format: any = {\r\n        groupSize: 3,\r\n      };\r\n      if (numberDecimalSeparator !== null) {\r\n        format.decimalSeparator = numberDecimalSeparator;\r\n      }\r\n      if (numberGroupSeparator !== null) {\r\n        format.groupSeparator = numberGroupSeparator;\r\n      }\r\n      return format;\r\n    }\r\n  }\r\n  private get numberFormat(): NumberFormat {\r\n    return this.userSettings && this.userSettings.numberFormat || null;\r\n  }\r\n}","import { Directive, ElementRef, Injector, Input, OnInit } from '@angular/core';\r\n@Directive({\r\n  selector: '[farris-checkbox-modification]'\r\n})\r\nexport class FarrisCheckboxModificationDirective implements OnInit {\r\n  @Input() index: number;\r\n  constructor(private injector: Injector, private elementRef: ElementRef) { }\r\n  ngOnInit(): void {\r\n    if (typeof this.index !== 'number' || !this.elementRef) {\r\n      return;\r\n    }\r\n    const nativeElement = this.elementRef.nativeElement;\r\n    if (nativeElement) {\r\n      const id = nativeElement.getAttribute('id');\r\n      if (id) {\r\n        const token = `${id}_${this.index}`;\r\n        this.elementRef.nativeElement.setAttribute('id', token);\r\n        this.elementRef.nativeElement.setAttribute('name', token);\r\n        this.elementRef.nativeElement.setAttribute('original_id', id);\r\n      }\r\n    }\r\n  }\r\n\r\n}\r\n","import { Directive, ElementRef, Injector, Input, OnInit } from '@angular/core';\r\n@Directive({\r\n  selector: '[farris-label-modification]'\r\n})\r\nexport class FarrisLabelModificationDirective implements OnInit {\r\n  @Input() index: number;\r\n  constructor(private injector: Injector, private elementRef: ElementRef) { }\r\n  ngOnInit(): void {\r\n    if (typeof this.index !== 'number' || !this.elementRef) {\r\n      return;\r\n    }\r\n    const nativeElement = this.elementRef.nativeElement;\r\n    if (nativeElement) {\r\n      const labelFor = nativeElement.getAttribute('for');\r\n      if (labelFor) {\r\n        this.elementRef.nativeElement.setAttribute('for', `${labelFor}_${this.index}`);\r\n      }\r\n    }\r\n  }\r\n\r\n}\r\n","import { Directive, Input, Optional } from '@angular/core';\r\nimport { ComboLookupComponent } from '@farris/ui-combo-lookup';\r\nimport { LookupGridComponent } from '@farris/ui-lookup';\r\n\r\n@Directive({\r\n  selector: '[farris-lookup-binding]'\r\n})\r\nexport class FarrisLookupBindingDirective {\r\n  @Input() lookupType: string;\r\n  @Input('farris-lookup-binding')\r\n  public set lookupValue(value: any) {\r\n    if (this.lookupType === 'lookup' && this.lookup) {\r\n      this.lookup.writeValue(value);\r\n    } else if (this.lookupType === 'comboLookup' && this.comboLookup) {\r\n      this.comboLookup.writeValue(value);\r\n    }\r\n  }\r\n  constructor(@Optional() private lookup: LookupGridComponent, @Optional() private comboLookup: ComboLookupComponent) { }\r\n}","import { ElementRef } from \"@angular/core\";\r\nimport { FrameContext } from \"@farris/devkit\";\r\n\r\nexport class ComponentRef {\r\n  constructor(protected frameContext: FrameContext, protected elementRef: ElementRef) { }\r\n  public addComponent(componentRef: any) {\r\n    const id = this.elementRef && this.elementRef.nativeElement && this.elementRef.nativeElement.id;\r\n    if (this.frameContext && id && componentRef) {\r\n      this.frameContext.componentRefManager.add(id, componentRef);\r\n    }\r\n  }\r\n  public tryAddComponent(componentRef: any, componentId: string = null) {\r\n    const id = componentId || this.elementRef && this.elementRef.nativeElement && this.elementRef.nativeElement.id;\r\n    if (this.frameContext && id && componentRef && !this.frameContext.componentRefManager.has(id)) {\r\n      this.frameContext.componentRefManager.add(id, componentRef);\r\n    }\r\n  }\r\n}","import { AfterViewInit, Directive, ElementRef, Injector, OnDestroy, OnInit } from \"@angular/core\";\r\nimport { FrameContext } from \"@farris/devkit\";\r\nimport { ListNavComponent } from '@farris/ui-list-nav';\r\nimport { ComponentRef } from \"./component-ref\";\r\n\r\n@Directive({\r\n  selector: '[listNavRef]'\r\n})\r\nexport class ListNavComponentRefDirective extends ComponentRef implements OnInit, OnDestroy, AfterViewInit {\r\n  constructor(private injector: Injector, private component: ListNavComponent, public elementRef: ElementRef, public frameContext: FrameContext) {\r\n    super(frameContext, elementRef);\r\n  }\r\n  //#region angular lifecycle\r\n  ngAfterViewInit(): void {\r\n    this.tryAddComponent(this.component);\r\n  }\r\n  ngOnInit(): void {\r\n    this.addComponent(this.component);\r\n  }\r\n  ngOnDestroy(): void {\r\n  }\r\n  //#endregion\r\n}","import { AfterViewInit, Directive, ElementRef, Injector, OnDestroy, OnInit } from \"@angular/core\";\r\nimport { FrameContext } from \"@farris/devkit\";\r\nimport { ListViewComponent } from \"@farris/ui-list-view\";\r\nimport { ComponentRef } from \"./component-ref\";\r\n\r\n@Directive({\r\n  selector: '[listViewRef]'\r\n})\r\nexport class ListViewComponentRefDirective extends ComponentRef implements OnInit, OnDestroy, AfterViewInit {\r\n  constructor(private injector: Injector, private component: ListViewComponent, public elementRef: ElementRef, public frameContext: FrameContext) {\r\n    super(frameContext, elementRef);\r\n  }\r\n  ngAfterViewInit(): void {\r\n    this.tryAddComponent(this.component);\r\n  }\r\n  ngOnInit(): void {\r\n    this.addComponent(this.component);\r\n  }\r\n  ngOnDestroy(): void {\r\n  }\r\n}","import { AfterViewInit, Directive, ElementRef, Injector, OnDestroy, OnInit } from \"@angular/core\";\r\nimport { FrameContext } from \"@farris/devkit\";\r\nimport { ListFilterComponent } from '@farris/ui-list-filter';\r\nimport { ComponentRef } from \"./component-ref\";\r\n@Directive({\r\n  selector: '[listFilterRef]'\r\n})\r\nexport class ListFilterComponentRefDirective extends ComponentRef implements OnInit, OnDestroy, AfterViewInit {\r\n  constructor(private injector: Injector, private component: ListFilterComponent, public elementRef: ElementRef, public frameContext: FrameContext) { \r\n    super(frameContext, elementRef);\r\n  }\r\n  ngAfterViewInit(): void {\r\n    this.tryAddComponent(this.component);\r\n  }\r\n  ngOnInit(): void {\r\n    this.addComponent(this.component);\r\n  }\r\n  ngOnDestroy(): void {\r\n  }\r\n}","import { AfterViewInit, Directive, ElementRef, Injector, OnDestroy, OnInit } from \"@angular/core\";\r\nimport { FrameContext } from \"@farris/devkit\";\r\nimport { FilterComponent } from '@farris/ui-filter';\r\nimport { ComponentRef } from \"./component-ref\";\r\n\r\n@Directive({\r\n  selector: '[filterRef]'\r\n})\r\nexport class FilterComponentRefDirective extends ComponentRef implements OnInit, OnDestroy, AfterViewInit {\r\n  constructor(private injector: Injector, private component: FilterComponent, public elementRef: ElementRef, public frameContext: FrameContext) {\r\n    super(frameContext, elementRef);\r\n  }\r\n  ngAfterViewInit(): void {\r\n    this.tryAddComponent(this.component);\r\n  }\r\n  ngOnInit(): void {\r\n    this.addComponent(this.component);\r\n  }\r\n  ngOnDestroy(): void {\r\n  }\r\n\r\n}","import { AfterViewInit, Directive, ElementRef, Injector, OnDestroy, OnInit } from \"@angular/core\";\r\nimport { FrameContext } from \"@farris/devkit\";\r\nimport { ViewChangeComponent } from '@farris/ui-view-change';\r\nimport { ComponentRef } from \"./component-ref\";\r\n\r\n@Directive({\r\n  selector: '[viewChangeRef]'\r\n})\r\nexport class ViewChangeComponentRefDirective extends ComponentRef implements OnInit, OnDestroy, AfterViewInit {\r\n  constructor(private injector: Injector, private component: ViewChangeComponent, public elementRef: ElementRef, public frameContext: FrameContext) {\r\n    super(frameContext, elementRef);\r\n  }\r\n  ngAfterViewInit(): void {\r\n    this.tryAddComponent(this.component);\r\n  }\r\n  ngOnInit(): void {\r\n    this.addComponent(this.component);\r\n  }\r\n  ngOnDestroy(): void {\r\n  }\r\n\r\n}","import { AfterViewInit, Directive, ElementRef, Injector, OnDestroy, OnInit } from \"@angular/core\";\r\nimport { FrameContext } from \"@farris/devkit\";\r\nimport { HtmlEditorComponent } from '@farris/ui-html-editor';\r\nimport { ComponentRef } from \"./component-ref\";\r\n\r\n@Directive({\r\n  selector: '[htmlEditorRef]'\r\n})\r\nexport class HtmlEditorComponentRefDirective extends ComponentRef implements OnInit, OnDestroy, AfterViewInit {\r\n  constructor(private injector: Injector, private component: HtmlEditorComponent, public elementRef: ElementRef, public frameContext: FrameContext) {\r\n    super(frameContext, elementRef);\r\n  }\r\n  ngAfterViewInit(): void {\r\n    this.tryAddComponent(this.component);\r\n  }\r\n  ngOnInit(): void {\r\n    this.addComponent(this.component);\r\n  }\r\n  ngOnDestroy(): void {\r\n  }\r\n\r\n}","import { AfterViewInit, Directive, ElementRef, Injector, OnDestroy, OnInit } from \"@angular/core\";\r\nimport { FrameContext } from \"@farris/devkit\";\r\nimport { FarrisSectionComponent } from '@farris/ui-section';\r\nimport { ComponentRef } from \"./component-ref\";\r\n\r\n@Directive({\r\n  selector: '[sectionRef]'\r\n})\r\nexport class SectionComponentRefDirective extends ComponentRef implements OnInit, OnDestroy, AfterViewInit {\r\n  constructor(private injector: Injector, private component: FarrisSectionComponent, public elementRef: ElementRef, public frameContext: FrameContext) {\r\n    super(frameContext, elementRef);\r\n  }\r\n  ngAfterViewInit(): void {\r\n    this.tryAddComponent(this.component);\r\n  }\r\n  ngOnInit(): void {\r\n    this.addComponent(this.component);\r\n  }\r\n  ngOnDestroy(): void {\r\n  }\r\n\r\n}","import { AfterViewInit, Directive, ElementRef, Injector, OnDestroy, OnInit } from \"@angular/core\";\r\nimport { FrameContext } from \"@farris/devkit\";\r\nimport { InputGroupComponent } from '@farris/ui-input-group';\r\nimport { ComponentRef } from \"./component-ref\";\r\n\r\n@Directive({\r\n  selector: '[inputGroupRef]'\r\n})\r\nexport class InputGroupComponentRefDirective extends ComponentRef implements OnInit, OnDestroy, AfterViewInit {\r\n  constructor(private injector: Injector, private component: InputGroupComponent, public elementRef: ElementRef, public frameContext: FrameContext) {\r\n    super(frameContext, elementRef);\r\n  }\r\n  ngAfterViewInit(): void {\r\n    this.tryAddComponent(this.component);\r\n  }\r\n  ngOnInit(): void {\r\n    this.addComponent(this.component);\r\n  }\r\n  ngOnDestroy(): void {\r\n  }\r\n\r\n}","import { AfterViewInit, Directive, ElementRef, Injector, OnDestroy, OnInit } from \"@angular/core\";\r\nimport { FrameContext } from \"@farris/devkit\";\r\nimport { FarrisDatepickerComponent } from '@farris/ui-datepicker';\r\nimport { ComponentRef } from \"./component-ref\";\r\n\r\n@Directive({\r\n  selector: '[datepickerRef]'\r\n})\r\nexport class DatepickerComponentRefDirective extends ComponentRef implements OnInit, OnDestroy, AfterViewInit {\r\n  constructor(private injector: Injector, private component: FarrisDatepickerComponent, public elementRef: ElementRef, public frameContext: FrameContext) {\r\n    super(frameContext, elementRef);\r\n  }\r\n  ngAfterViewInit(): void {\r\n    this.tryAddComponent(this.component);\r\n  }\r\n  ngOnInit(): void {\r\n    this.addComponent(this.component);\r\n  }\r\n  ngOnDestroy(): void {\r\n  }\r\n\r\n}","import { AfterViewInit, Directive, ElementRef, Injector, OnDestroy, OnInit } from \"@angular/core\";\r\nimport { FrameContext } from \"@farris/devkit\";\r\nimport { TimePickerComponent } from '@farris/ui-time-picker';\r\nimport { ComponentRef } from \"./component-ref\";\r\n\r\n@Directive({\r\n  selector: '[timePickerRef]'\r\n})\r\nexport class TimePickerComponentRefDirective extends ComponentRef implements OnInit, OnDestroy, AfterViewInit {\r\n  constructor(private injector: Injector, private component: TimePickerComponent, public elementRef: ElementRef, public frameContext: FrameContext) {\r\n    super(frameContext, elementRef);\r\n  }\r\n  ngAfterViewInit(): void {\r\n    this.tryAddComponent(this.component);\r\n  }\r\n  ngOnInit(): void {\r\n    this.addComponent(this.component);\r\n  }\r\n  ngOnDestroy(): void {\r\n  }\r\n\r\n}","import { AfterViewInit, Directive, ElementRef, Injector, OnDestroy, OnInit } from \"@angular/core\";\r\nimport { FrameContext } from \"@farris/devkit\";\r\nimport { NumberSpinnerComponent } from \"@farris/ui-number-spinner\";\r\nimport { ComponentRef } from \"./component-ref\";\r\n\r\n@Directive({\r\n  selector: '[numberSpinnerRef]'\r\n})\r\nexport class NumberSpinnerComponentRefDirective extends ComponentRef implements OnInit, OnDestroy, AfterViewInit {\r\n  constructor(private injector: Injector, private component: NumberSpinnerComponent, public elementRef: ElementRef, public frameContext: FrameContext) {\r\n    super(frameContext, elementRef);\r\n  }\r\n  ngAfterViewInit(): void {\r\n    this.tryAddComponent(this.component);\r\n  }\r\n  ngOnInit(): void {\r\n    this.addComponent(this.component);\r\n  }\r\n  ngOnDestroy(): void {\r\n  }\r\n}","import { AfterViewInit, Directive, ElementRef, Injector, OnDestroy, OnInit } from \"@angular/core\";\r\nimport { FrameContext } from \"@farris/devkit\";\r\nimport { ComboListComponent } from '@farris/ui-combo-list';\r\nimport { ComponentRef } from \"./component-ref\";\r\n\r\n@Directive({\r\n  selector: '[comboListRef]'\r\n})\r\nexport class ComboListComponentRefDirective extends ComponentRef implements OnInit, OnDestroy, AfterViewInit {\r\n  constructor(private injector: Injector, private component: ComboListComponent, public elementRef: ElementRef, public frameContext: FrameContext) {\r\n    super(frameContext, elementRef);\r\n  }\r\n  ngAfterViewInit(): void {\r\n    this.tryAddComponent(this.component);\r\n  }\r\n  ngOnInit(): void {\r\n    this.addComponent(this.component);\r\n  }\r\n  ngOnDestroy(): void {\r\n  }\r\n}","import { AfterViewInit, Directive, ElementRef, Injector, OnDestroy, OnInit } from \"@angular/core\";\r\nimport { FrameContext } from \"@farris/devkit\";\r\nimport { ComboLookupComponent } from '@farris/ui-combo-lookup';\r\nimport { ComponentRef } from \"./component-ref\";\r\n\r\n@Directive({\r\n  selector: '[comboLookupRef]'\r\n})\r\nexport class ComboLookupComponentRefDirective extends ComponentRef implements OnInit, OnDestroy, AfterViewInit {\r\n  constructor(private injector: Injector, private component: ComboLookupComponent, public elementRef: ElementRef, public frameContext: FrameContext) { \r\n    super(frameContext, elementRef);\r\n  }\r\n  ngAfterViewInit(): void {\r\n    this.tryAddComponent(this.component);\r\n  }\r\n  ngOnInit(): void {\r\n    this.addComponent(this.component);\r\n  }\r\n  ngOnDestroy(): void {\r\n  }\r\n\r\n}","import { AfterViewInit, Directive, ElementRef, Injector, OnDestroy, OnInit } from \"@angular/core\";\r\nimport { FrameContext } from \"@farris/devkit\";\r\nimport { LookupGridComponent } from '@farris/ui-lookup';\r\nimport { ComponentRef } from \"./component-ref\";\r\n\r\n@Directive({\r\n  selector: '[lookupGridRef]'\r\n})\r\nexport class LookupGridComponentRefDirective extends ComponentRef implements OnInit, OnDestroy, AfterViewInit {\r\n  constructor(private injector: Injector, private component: LookupGridComponent, public elementRef: ElementRef, public frameContext: FrameContext) {\r\n    super(frameContext, elementRef);\r\n  }\r\n  ngAfterViewInit(): void {\r\n    this.tryAddComponent(this.component);\r\n  }\r\n  ngOnInit(): void {\r\n    this.addComponent(this.component);\r\n  }\r\n  ngOnDestroy(): void {\r\n  }\r\n\r\n}","import { AfterViewInit, Directive, ElementRef, Injector, OnDestroy, OnInit } from \"@angular/core\";\r\nimport { FrameContext } from \"@farris/devkit\";\r\nimport { DatagridComponent } from '@farris/ui-datagrid';\r\nimport { ComponentRef } from \"./component-ref\";\r\n\r\n@Directive({\r\n  selector: '[datagridRef]'\r\n})\r\nexport class DatagridComponentRefDirective extends ComponentRef implements OnInit, OnDestroy, AfterViewInit {\r\n  constructor(private injector: Injector, private component: DatagridComponent, public elementRef: ElementRef, public frameContext: FrameContext) {\r\n    super(frameContext, elementRef);\r\n  }\r\n  ngAfterViewInit(): void {\r\n    this.tryAddComponent(this.component, this.component.id);\r\n  }\r\n  ngOnInit(): void {\r\n    this.addComponent(this.component);\r\n  }\r\n  ngOnDestroy(): void {\r\n  }\r\n\r\n}","import { AfterViewInit, Directive, ElementRef, Injector, OnDestroy, OnInit } from \"@angular/core\";\r\nimport { FrameContext } from \"@farris/devkit\";\r\nimport { TreeTableComponent } from '@farris/ui-treetable';\r\nimport { ComponentRef } from \"./component-ref\";\r\n\r\n@Directive({\r\n  selector: '[treetableRef]'\r\n})\r\nexport class TreetableComponentRefDirective extends ComponentRef implements OnInit, OnDestroy, AfterViewInit {\r\n  constructor(private injector: Injector, private component: TreeTableComponent, public elementRef: ElementRef, public frameContext: FrameContext) {\r\n    super(frameContext, elementRef);\r\n  }\r\n  ngAfterViewInit(): void {\r\n    this.tryAddComponent(this.component);\r\n  }\r\n  ngOnInit(): void {\r\n    this.addComponent(this.component);\r\n  }\r\n  ngOnDestroy(): void {\r\n  }\r\n\r\n}","import { AfterViewInit, Directive, ElementRef, Injector, OnDestroy, OnInit } from \"@angular/core\";\r\nimport { FrameContext } from \"@farris/devkit\";\r\nimport { WizardComponent } from '@farris/ui-wizard';\r\nimport { ComponentRef } from \"./component-ref\";\r\n\r\n@Directive({\r\n  selector: '[wizardRef]'\r\n})\r\nexport class WizardComponentRefDirective extends ComponentRef implements OnInit, OnDestroy, AfterViewInit {\r\n  constructor(private injector: Injector, private component: WizardComponent, public elementRef: ElementRef, public frameContext: FrameContext) {\r\n    super(frameContext, elementRef);\r\n  }\r\n  ngAfterViewInit(): void {\r\n    this.tryAddComponent(this.component);\r\n  }\r\n  ngOnInit(): void {\r\n    this.addComponent(this.component);\r\n  }\r\n  ngOnDestroy(): void {\r\n  }\r\n\r\n}","import { AfterViewInit, Directive, ElementRef, Injector, OnDestroy, OnInit } from \"@angular/core\";\r\nimport { FrameContext } from \"@farris/devkit\";\r\nimport { DiscussionEditorComponent } from '@farris/discussion-group';\r\nimport { ComponentRef } from \"./component-ref\";\r\n\r\n@Directive({\r\n  selector: '[discussionEditorRef]'\r\n})\r\nexport class DiscussionEditorComponentRefDirective extends ComponentRef implements OnInit, OnDestroy, AfterViewInit {\r\n  constructor(private injector: Injector, private component: DiscussionEditorComponent, public elementRef: ElementRef, public frameContext: FrameContext) { \r\n    super(frameContext, elementRef);\r\n  }\r\n  ngAfterViewInit(): void {\r\n    this.tryAddComponent(this.component);\r\n  }\r\n  ngOnInit(): void {\r\n    this.addComponent(this.component);\r\n  }\r\n  ngOnDestroy(): void {\r\n  }\r\n\r\n}","import { AfterViewInit, Directive, ElementRef, Injector, OnDestroy, OnInit } from \"@angular/core\";\r\nimport { FrameContext } from \"@farris/devkit\";\r\nimport { DiscussionListComponent } from '@farris/discussion-group';\r\nimport { ComponentRef } from \"./component-ref\";\r\n\r\n@Directive({\r\n  selector: '[discussionListRef]'\r\n})\r\nexport class DiscussionListComponentRefDirective extends ComponentRef implements OnInit, OnDestroy, AfterViewInit {\r\n  constructor(private injector: Injector, private component: DiscussionListComponent, public elementRef: ElementRef, public frameContext: FrameContext) {\r\n    super(frameContext, elementRef);\r\n  }\r\n  ngAfterViewInit(): void {\r\n    this.tryAddComponent(this.component);\r\n  }\r\n  ngOnInit(): void {\r\n    this.addComponent(this.component);\r\n  }\r\n  ngOnDestroy(): void {\r\n  }\r\n\r\n}","import { AfterViewInit, Directive, ElementRef, Injector, OnDestroy, OnInit } from \"@angular/core\";\r\nimport { FrameContext } from \"@farris/devkit\";\r\nimport { NavComponent } from '@farris/ui-nav';\r\nimport { ComponentRef } from \"./component-ref\";\r\n\r\n@Directive({\r\n  selector: '[navRef]'\r\n})\r\nexport class NavComponentRefDirective extends ComponentRef implements OnInit, OnDestroy, AfterViewInit {\r\n  constructor(private injector: Injector, private component: NavComponent, public elementRef: ElementRef, public frameContext: FrameContext) {\r\n    super(frameContext, elementRef);\r\n  }\r\n  ngAfterViewInit(): void {\r\n    this.tryAddComponent(this.component);\r\n  }\r\n  ngOnInit(): void {\r\n    this.addComponent(this.component);\r\n  }\r\n  ngOnDestroy(): void {\r\n  }\r\n\r\n}","import { AfterViewInit, Directive, ElementRef, Injector, OnDestroy, OnInit } from \"@angular/core\";\r\nimport { FrameContext } from \"@farris/devkit\";\r\nimport { MultiSelectComponent } from '@farris/ui-multi-select';\r\nimport { ComponentRef } from \"./component-ref\";\r\n\r\n@Directive({\r\n  selector: '[multiSelectRef]'\r\n})\r\nexport class MultiSelectComponentRefDirective extends ComponentRef implements OnInit, OnDestroy, AfterViewInit {\r\n  constructor(private injector: Injector, private component: MultiSelectComponent, public elementRef: ElementRef, public frameContext: FrameContext) { \r\n    super(frameContext, elementRef);\r\n  }\r\n  ngAfterViewInit(): void {\r\n    this.tryAddComponent(this.component);\r\n  }\r\n  ngOnInit(): void {\r\n    this.addComponent(this.component);\r\n  }\r\n  ngOnDestroy(): void {\r\n  }\r\n\r\n}","import { AfterViewInit, Directive, ElementRef, Injector, OnDestroy, OnInit } from \"@angular/core\";\r\nimport { FrameContext } from \"@farris/devkit\";\r\nimport { ScrollspyComponent } from '@farris/ui-scrollspy';\r\nimport { ComponentRef } from \"./component-ref\";\r\n\r\n@Directive({\r\n  selector: '[scrollspyRef]'\r\n})\r\nexport class ScrollspyComponentRefDirective extends ComponentRef implements OnInit, OnDestroy, AfterViewInit {\r\n  constructor(private injector: Injector, private component: ScrollspyComponent, public elementRef: ElementRef, public frameContext: FrameContext) {\r\n    super(frameContext, elementRef);\r\n  }\r\n  ngAfterViewInit(): void {\r\n    this.tryAddComponent(this.component);\r\n  }\r\n  ngOnInit(): void {\r\n    this.addComponent(this.component);\r\n  }\r\n  ngOnDestroy(): void {\r\n  }\r\n\r\n}","\r\n/**\r\n * ä½¿ç¨æ¹æ³ï¼\r\n * [comob-lookup-data-mapping]=\"{ id: 'user.userId', name: 'user.userName' }\"\r\n * key ä¸ºå¸®å©ä¸çå­æ®µï¼ value ä¸º è¡¨åä¸­çå­æ®µå\r\n * å¸®å©ä¸çåä¸ä¸ªå­æ®µå¯ä»¥æ å°å°è¡¨åä¸­çå¤ä¸ªå­æ®µä¸­ï¼{ ... id: 'user.userid, user.addusid'}\r\n * å¤å­æ®µä»¥éå·éå¼\r\n *\r\n */\r\n\r\nimport { Directive, OnInit, Optional, Self, Input } from '@angular/core';\r\nimport { BindingObject, NgFormControl, ViewModel } from '@farris/devkit';\r\nimport { ComboChanges } from '@farris/ui-combo-list';\r\nimport { ComboLookupComponent } from '@farris/ui-combo-lookup';\r\nimport { DataMapping } from './data-mapping';\r\n\r\n\r\n@Directive({ selector: '[combo-lookup-data-mapping]' })\r\nexport class ComboLookupDataMappingDirective extends DataMapping implements OnInit {\r\n  @Input('combo-lookup-data-mapping') mapfields: any;\r\n  @Input('target') target: BindingObject = null;\r\n\r\n  constructor(@Optional() public vm: ViewModel, @Optional() @Self() private lookup: ComboLookupComponent) {\r\n    super();\r\n    if (this.lookup) {\r\n      this.lookup.useFormDataMapping = true;\r\n    }\r\n  }\r\n\r\n  ngOnInit() {\r\n    // å¼ååï¼äº¦éè¿è¯¥äºä»¶è§¦åä»»æè¾å¥æ¸ç©ºäºä»¶\r\n    this.lookup.valueChange.subscribe((result: ComboChanges) => {\r\n      if (!result['nosearch']) {\r\n        // å¼åå\r\n        const data = result.selections && result.selections.length > 0 ? result.selections : null;\r\n        this.onValueChange(data);\r\n      } else {\r\n        // ä»»æè¾å¥æ¸ç©ºæ å°å­æ®µ\r\n        this.onClearMapping();\r\n      }\r\n    });\r\n    // æ¸ç©ºäºä»¶\r\n    this.lookup.clear.subscribe(() => {\r\n      const _mapfields = this.mapfields || this.lookup.mapFields;\r\n      this.mappingData(null, _mapfields);\r\n    });\r\n  }\r\n  private onClearMapping() {\r\n    const mapfields = Object.assign({}, (this.mapfields || this.lookup.mapFields || {}));\r\n    const lookupTextField = this.lookup.textField;\r\n    const data = {};\r\n    const controlName = this.lookup.ngControl && this.lookup.ngControl.name;\r\n    if (controlName && this.vm) {\r\n      const textFieldMapping = mapfields[lookupTextField];\r\n      const ngFormControl = this.vm && this.vm.form && this.vm.form.ngFormControls && this.vm.form.ngFormControls[controlName] as NgFormControl;\r\n      const binding = ngFormControl && ngFormControl.binding;\r\n      if (textFieldMapping && binding) {\r\n        const targetField = textFieldMapping.split(',').filter((item) => item !== binding).join(',');\r\n        if (targetField) {\r\n          mapfields[lookupTextField] = targetField;\r\n        } else {\r\n          delete mapfields[lookupTextField];\r\n        }\r\n      }\r\n    }\r\n    if (mapfields && Object.keys(mapfields).length > 0) {\r\n      Object.keys(mapfields).forEach((field) => {\r\n        this.setValue(data, field.split('.'), '');\r\n      });\r\n      this.mappingData(data, mapfields, true);\r\n    }\r\n  }\r\n  private onValueChange(data) {\r\n    const _mapfields = this.mapfields || this.lookup.mapFields;\r\n    const spliter = this.lookup.separator || this.defaultSpliter;\r\n    this.mappingData(data, _mapfields, false, spliter);\r\n  }\r\n}\r\n","import { Repository } from \"@farris/devkit\";\r\n\r\nexport abstract class BefRepository extends Repository<any>{\r\n  restService: BefRestService;\r\n}\r\nexport interface BefRestService {\r\n  request(url: string, method: string, params?: any, options?: any, selfHandError?: boolean, ignoreError?: boolean, ignoreChanges?: boolean);\r\n  buildRequestInfo();\r\n}\r\nexport enum ViewType {\r\n  day = 'day',\r\n  week = 'week'\r\n}","import {\r\n  Directive, OnInit, OnChanges, OnDestroy, SimpleChanges, HostListener, Injector, Input\r\n} from '@angular/core';\r\nimport { Subscription } from 'rxjs';\r\nimport { BindingData, BindingList, Change, ChangeType, ViewModel, FrameContext } from '@farris/devkit';\r\nimport { AppointmentCalendarComponent } from '@farris/appointment-calendar';\r\nimport { BefRestService, BefRepository, ViewType } from './types';\r\nimport { isEqual } from 'lodash-es';\r\nimport { BasePathService } from '@farris/rtf';\r\n\r\n@Directive({\r\n  selector: '[farris-appointment-calendar-binding]'\r\n})\r\nexport class AppointmentCalendarBindingDirective implements OnInit, OnChanges, OnDestroy {\r\n  private __DATA__: any;\r\n  private bindingDataChangeEvent: Subscription;\r\n  private get bindingData(): BindingData {\r\n    return this.frameContext.bindingData;\r\n  }\r\n  private get viewModel(): ViewModel {\r\n    return this.frameContext.viewModel;\r\n  }\r\n  private restService(): BefRestService {\r\n    return (this.frameContext.repository as BefRepository).restService;\r\n  }\r\n  /**\r\n   * è·åç»å®æ°æ®\r\n   */\r\n  protected get bindingList(): BindingList {\r\n    // æ ¹å®ä½\r\n    if (this.viewModel.bindingPath === '/' || !this.viewModel.bindingPath) {\r\n      return this.bindingData.list;\r\n    }\r\n    // å­å®ä½\r\n    let bindingPath = this.viewModel.bindingPath.substr(1);\r\n    bindingPath = bindingPath[0].toLowerCase() + bindingPath.substring(1, bindingPath.length);\r\n    const paths = bindingPath.split('/');\r\n\r\n    const filteredPaths = paths.filter((part: string) => {\r\n      return part !== '';\r\n    });\r\n    return this.bindingData.getValue(filteredPaths);\r\n  }\r\n  /**\r\n   * æ¿é´åè¡¨api url\r\n   */\r\n  @Input() url: string = null;\r\n  /**\r\n   * http method, default PUT\r\n   */\r\n  @Input() method: string = 'PUT';\r\n  @Input() startDateVariable: string = 'startDate';\r\n  @Input() endDateVariable: string = 'endDate';\r\n  @Input() viewTypeVariable: string = 'viewType';\r\n\r\n  constructor(private injector: Injector, private frameContext: FrameContext, private calendarComponent: AppointmentCalendarComponent) { }\r\n\r\n  ngOnInit(): void {\r\n    this.loadPlacements();\r\n    this.registerBindingDataChangeEvent();\r\n  }\r\n  ngOnChanges(changes: SimpleChanges): void {\r\n\r\n  }\r\n  ngOnDestroy(): void {\r\n    this.unRegisterBindingDataChangeEvent();\r\n  }\r\n  private bindData(change: Change) {\r\n    // åtoJSON\r\n    let data: any = this.bindingList.toJSON();\r\n    if (this.__DATA__ && isEqual(this.__DATA__, data)) {\r\n      return;\r\n    }\r\n    this.__DATA__ = data;\r\n    this.calendarComponent.loadReserveData(data);\r\n  }\r\n  private onBindingDataChange(change: Change) {\r\n    this.bindData(change);\r\n    this.updateSelectedRow(change);\r\n  }\r\n  private registerBindingDataChangeEvent() {\r\n    this.bindingDataChangeEvent = this.bindingData.changes.subscribe((change: Change) => {\r\n      this.onBindingDataChange(change);\r\n    });\r\n  }\r\n  /**\r\n   * åæ¶bindingdataååè®¢é\r\n   */\r\n  private unRegisterBindingDataChangeEvent() {\r\n    if (this.bindingDataChangeEvent && typeof (this.bindingDataChangeEvent.unsubscribe) === 'function') {\r\n      this.bindingDataChangeEvent.unsubscribe();\r\n    }\r\n  }\r\n  private loadPlacements() {\r\n    if (!this.url) {\r\n      console.log('æ æ³å è½½æ¿é´ä¿¡æ¯ï¼è¯·éç½®æ¿é´åè¡¨apiå°å');\r\n      return;\r\n    }\r\n    const requestInfo = this.restService().buildRequestInfo();\r\n    const options = {\r\n      body: {\r\n        requestInfo\r\n      }\r\n    };\r\n    const url = BasePathService.convertPath(this.url);\r\n    this.restService().request(url, this.method, null, options).subscribe((returnValue: any) => {\r\n      this.bindPlacements(returnValue);\r\n    });\r\n  }\r\n  private bindPlacements(placments: any) {\r\n    this.calendarComponent.loadPlaceData(placments);\r\n  }\r\n  private updateState(startDate: string, endDate: string, viewType: string) {\r\n    this.viewModel.uiState.setPropertyValue(this.startDateVariable, startDate);\r\n    this.viewModel.uiState.setPropertyValue(this.endDateVariable, endDate);\r\n    this.viewModel.uiState.setPropertyValue(this.viewTypeVariable, viewType);\r\n  }\r\n  private updateSelectedRow(change?: Change) {\r\n    if (!this.bindingList || !this.bindingList.currentId) {\r\n      return;\r\n    }\r\n    // é¡µç åæ¢æ¶ä¸æ§è¡å½åè¡åæ¢\r\n    if (change && change.type === ChangeType.PaginationInfoChange) {\r\n      return;\r\n    }\r\n    if (this.viewModel && this.viewModel.frameContext.bindingData.rowSelectedEventSuspend === true) {\r\n      return;\r\n    }\r\n    const id = this.calendarComponent.selectedId;\r\n    const currentId = this.bindingList.currentId;\r\n    // gridå½åè¡ä¸bingingListå½åè¡ä¸è´ï¼æ é¡»åæ¢\r\n    if (id === currentId) {\r\n      return;\r\n    }\r\n    this.selectCalendarRow(this.bindingList.currentId);\r\n  }\r\n  private selectCalendarRow(id: string) {\r\n    this.calendarComponent.selectItem(id);\r\n  }\r\n  @HostListener('filterChange', ['$event'])\r\n  public filterChanged(event: any) {\r\n    const { dateValue = null, place = null, viewType = null } = event || {};\r\n    let startDate = null;\r\n    let endDate = null;\r\n    if (!dateValue) {\r\n      return;\r\n    }\r\n    if (viewType === ViewType.day) {\r\n      startDate = `${dateValue} 00:00:00`;\r\n      endDate = `${dateValue} 23:59:59`;\r\n    } else if (viewType === ViewType.week && dateValue.indexOf('~') !== -1) {\r\n      const sections = dateValue.split('~');\r\n      startDate = `${sections[0]} 00:00:00`;\r\n      endDate = `${sections[1]} 23:59:59`;\r\n    }\r\n    this.updateState(startDate, endDate, viewType);\r\n  }\r\n  protected setSelectionIdToBindingData(id: string): void {\r\n    // å¦æå½åè¡ä¸å­å¨ï¼åå¼ºå¶è®¾ç½®\r\n    if (this.bindingList.currentId !== id) {\r\n      this.bindingList.setCurrentId(id, true);\r\n    }\r\n  }\r\n  @HostListener('selectChange', ['$event'])\r\n  public selectChange(event) {\r\n    const { item: { id = null } } = event;\r\n    this.setSelectionIdToBindingData(id);\r\n  }\r\n}\r\n","import { AfterViewInit, ChangeDetectorRef, Directive, ElementRef, Injector, Input, OnInit, OnChanges, SimpleChanges } from '@angular/core';\r\nimport { DatagridComponent } from '@farris/ui-datagrid';\r\nimport { FrameContext } from '@farris/devkit';\r\nimport { BefRepository, BefRestService } from '../appointment-calendar/types';\r\n\r\ntype SizeConfig = {\r\n  'headerHeight'?: number,\r\n  'footerHeight'?: number,\r\n  'rowHeight'?: number,\r\n  'checkboxColumnWidth'?: number,\r\n  'lineNumberWidth'?: number,\r\n  'filterRowHeight'?: number\r\n};\r\n\r\n\r\n@Directive({ selector: '[custom-size]' })\r\nexport class CustomDatagridSizeDirective implements OnInit, AfterViewInit, OnChanges {\r\n  @Input('custom-size') useCustomSize = false;\r\n  @Input() sizeApiUri = '';\r\n\r\n  private restService(): BefRestService {\r\n    return (this.frameContext.repository as BefRepository).restService;\r\n  }\r\n\r\n  constructor(private dg: DatagridComponent, private injector: Injector, private cd: ChangeDetectorRef, private el: ElementRef,\r\n    private frameContext: FrameContext) { }\r\n\r\n  ngOnInit(): void {\r\n\r\n  }\r\n\r\n  ngOnChanges(changes: SimpleChanges) {\r\n    if (changes.sizeApiUri && !changes.sizeApiUri.isFirstChange()) {\r\n      this.applyNewSize();\r\n    }\r\n  }\r\n\r\n  ngAfterViewInit(): void {\r\n    this.applyNewSize();\r\n  }\r\n\r\n  private applyNewSize() {\r\n    if (this.useCustomSize && this.sizeApiUri) {\r\n      this.getSizeConfig().subscribe((cfg: SizeConfig) => {\r\n        if (this.dg && typeof this.dg.applyNewSize === 'function') {\r\n          this.dg.applyNewSize(cfg);\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n\r\n  private getSizeConfig() {\r\n    return this.restService().request(this.sizeApiUri, 'get');\r\n  }\r\n}\r\n","import { Directive, Injector, Input, OnDestroy, OnInit, Optional } from '@angular/core';\r\nimport { FrameContext } from '@farris/devkit';\r\nimport { FilterComponent } from '@farris/ui-filter';\r\nimport { Subject } from 'rxjs';\r\nimport { takeUntil } from 'rxjs/operators';\r\n\r\n@Directive({\r\n  selector: '[farris-filter-binding]'\r\n})\r\nexport class FarrisFilterBindingDirective implements OnInit, OnDestroy {\r\n  private $destroy: Subject<any>;\r\n  /**\r\n   * åéç¼å·ï¼é»è®¤ä¸ºfilterConditionList\r\n   */\r\n  @Input('variableCode') variableCode = 'filterConditionList';\r\n  constructor(\r\n    private injector: Injector,\r\n    private frameContext: FrameContext,\r\n    @Optional() private filterComponent: FilterComponent\r\n  ) {\r\n    this.$destroy = new Subject<any>();\r\n  }\r\n  ngOnDestroy(): void {\r\n    if (this.$destroy) {\r\n      this.$destroy.next();\r\n      this.$destroy.complete();\r\n    }\r\n  }\r\n  ngOnInit(): void {\r\n    if (this.filterComponent) {\r\n      this.filterComponent.conditionsChange.pipe(takeUntil(this.$destroy)).subscribe((event: any) => {\r\n        const { data = '[]' } = event || {};\r\n        this.setConditions(data);\r\n      });\r\n    }\r\n  }\r\n  private setConditions(conditions: string) {\r\n    this.frameContext.uiState.setPropertyValue(this.variableCode, conditions);\r\n  }\r\n}\r\n","import { Directive, Injector, Input, OnDestroy, OnInit, Optional } from '@angular/core';\r\nimport { FrameContext } from '@farris/devkit';\r\nimport { ListFilterComponent } from '@farris/ui-list-filter';\r\nimport { Subject } from 'rxjs';\r\nimport { takeUntil } from 'rxjs/operators';\r\n\r\n@Directive({\r\n  selector: '[farris-list-filter-binding]'\r\n})\r\nexport class FarrisListFilterBindingDirective implements OnInit, OnDestroy {\r\n  private $destroy: Subject<any>;\r\n  /**\r\n   * åéç¼å·ï¼é»è®¤ä¸ºfilterConditionList\r\n   */\r\n  @Input('variableCode') variableCode = 'filterConditionList';\r\n  constructor(\r\n    private injector: Injector,\r\n    private frameContext: FrameContext,\r\n    @Optional() private listFilterComponent: ListFilterComponent\r\n  ) {\r\n    this.$destroy = new Subject<any>();\r\n  }\r\n  ngOnDestroy(): void {\r\n    if (this.$destroy) {\r\n      this.$destroy.next();\r\n      this.$destroy.complete();\r\n    }\r\n  }\r\n  ngOnInit(): void {\r\n    if (this.listFilterComponent) {\r\n      this.listFilterComponent.conditionsChange.pipe(takeUntil(this.$destroy)).subscribe((event: any) => {\r\n        const { data = '[]' } = event || {};\r\n        this.setConditions(data);\r\n      });\r\n    }\r\n  }\r\n  private setConditions(conditions: string) {\r\n    this.frameContext.uiState.setPropertyValue(this.variableCode, conditions);\r\n  }\r\n}\r\n","import { Injector, Optional, Pipe, PipeTransform } from '@angular/core';\r\nimport { DownloadService } from '@gsp-svc/formdoc-upload';\r\nimport { BasePathService } from '@farris/rtf';\r\n@Pipe({ name: 'imageIdToUrl' })\r\nclass ImageIdToUrlPipe implements PipeTransform {\r\n  private defaultPic = BasePathService.convertPath('/platform/common/web/assets/imgs/no-pic.png');\r\n  private downloadService: DownloadService;\r\n  constructor(@Optional() private injector: Injector) {\r\n    this.downloadService = this.injector && this.injector.get<DownloadService>(DownloadService, null) || null;\r\n  }\r\n\r\n  transform(value: string, rootId: string = 'default-root'): string {\r\n    if (!value) {\r\n      return this.defaultPic;\r\n    }\r\n    //const rootId = 'default-root';\r\n    if (this.downloadService) {\r\n      return this.downloadService.getDownloadUrl(value, rootId);\r\n    } else {\r\n      console.warn('å å®å¨é®é¢ï¼éä»¶ä¸è½½æä¾å®å¨æ ¡éªæºå¶ï¼éä»¶ä¸è½½åè½ééæ°ç¼è¯ã');\r\n      return BasePathService.convertPath(`/api/runtime/dfs/v1.0/formdoc/download/${value}`);\r\n    }\r\n  }\r\n}\r\n\r\nexport { ImageIdToUrlPipe };\r\n","import { LocaleService } from '@farris/ui-locale';\r\nimport { Pipe, PipeTransform, Injector, Optional } from '@angular/core';\r\nimport { ColumnFormatService } from '@farris/ui-common/column';\r\n\r\n@Pipe({ name: 'formatPrimeNgTreeTableCellData', pure: false })\r\nexport class FormatPrimeNgTreeTableCellData implements PipeTransform {\r\n\r\n  private localeService: LocaleService;\r\n  constructor(private cfs: ColumnFormatService, @Optional() private injector?: Injector) {\r\n    if (this.injector) {\r\n      this.localeService = this.injector.get(LocaleService);\r\n    }\r\n  }\r\n\r\n  transform(col: any, rowData: any): any {\r\n    let value = '';\r\n    if (rowData && col && col.field) {\r\n      value = this.getValue(col.field, rowData);\r\n      let formatterFn = col.formatter;\r\n      if (!formatterFn) {\r\n        if (col.isMultilingualField) {\r\n          return this.getMultiLanguageValue(value);\r\n        } else {\r\n          return value;\r\n        }\r\n      } else {\r\n        return this.cfs.format(value, rowData, formatterFn);\r\n      }\r\n    }\r\n    return '';\r\n  }\r\n\r\n  // è·åå¤è¯­æ°æ®\r\n  private getMultiLanguageValue(valObj) {\r\n    if (valObj && typeof valObj === 'object' && Object.keys(valObj).length > 0) {\r\n      const localeId = this.localeService && this.localeService.localeId || 'zh-CHS';\r\n      const value = valObj[localeId];\r\n      return value === undefined ? '' : value;\r\n    } else {\r\n      return '';\r\n    }\r\n  }\r\n  private getValue(path: string, target: any) {\r\n    if (!target) {\r\n      return '';\r\n    }\r\n    var resultVal = '';\r\n    if (path.indexOf('.') === -1) {\r\n      resultVal = target[path];\r\n    }\r\n    else {\r\n      resultVal = path.split('.').reduce(((obj, key) => {\r\n        return obj && obj[key] || null;\r\n      }), target);\r\n    }\r\n    return resultVal;\r\n  };\r\n  /**\r\n   * æ¯å¦ä¸ºå¸®å©å\r\n   * @param col col\r\n   */\r\n  private isHelpColumn(col: any) {\r\n    return col && col.editor && col.editor.options && col.editor.options.type === 'EditorTypes.LOOKUP' || false;\r\n  }\r\n  private getHelpColumnValue(col: any, data: any) {\r\n    const textField = this.getHelpControlTextField(col);\r\n    const mapFields = this.getHelpControlMapFields(col);\r\n    if (textField && mapFields && Object.keys(mapFields).length > 0) {\r\n      const path = mapFields[textField];\r\n      return this.getValue(path, data);\r\n    }\r\n    return '';\r\n  }\r\n  private getHelpControlTextField(col: any) {\r\n    return col && col.editor && col.editor.options && col.editor.options.textField || '';\r\n  }\r\n  private getHelpControlMapFields(col: any) {\r\n    return col && col.editor && col.editor.options && col.editor.options.mapFields || {};\r\n  }\r\n}\r\n","import { Inject, Injector, Optional, Pipe, PipeTransform } from \"@angular/core\";\r\nimport { NumberFormat, UserSettings, UserSettingsToken } from \"@farris/devkit\";\r\nimport { BigNumber } from 'bignumber.js';\r\nimport moment from 'moment';\r\n\r\n@Pipe({ name: 'localization' })\r\nexport class Localization implements PipeTransform {\r\n  constructor(@Optional() private injector: Injector, @Inject(UserSettingsToken) private userSettings: UserSettings) {\r\n  }\r\n  public transform(value: any, dataType: string) {\r\n    if (dataType) {\r\n      dataType = dataType.toLowerCase();\r\n      if (dataType === 'date') {\r\n        return this.transformDate(value);\r\n      } else if (dataType === 'datetime') {\r\n        return this.transformDateTime(value);\r\n      } else if (dataType === 'number') {\r\n        return this.transformNumber(value);\r\n      } else {\r\n        return value;\r\n      }\r\n    }\r\n  }\r\n  /**\r\n   * è½¬æ¢æ¥æ\r\n   * @param value value\r\n   */\r\n  private transformDate(value: any) {\r\n    let dateFormat = this.userSettings && this.userSettings.dateFormat || null;\r\n    if (!dateFormat || !value) {\r\n      return value;\r\n    }\r\n    const date = moment(value);\r\n    const isValid = date.isValid();\r\n    if (!isValid) {\r\n      return value;\r\n    }\r\n    dateFormat = this.parseDateFormat(dateFormat);\r\n    return date.format(dateFormat);\r\n  }\r\n  /**\r\n   * è½¬æ¢æ¥ææ¶é´\r\n   * @param value value\r\n   * todo: ç®åæ æ³å®ä¹æ¥ææ¶é´æ ¼å¼\r\n   */\r\n  private transformDateTime(value: any) {\r\n    let dateFormat = this.userSettings && this.userSettings.dateFormat || '';\r\n    let timeFormat = this.userSettings && this.userSettings.timeFormat || '';\r\n    const dateTime = moment(value);\r\n    const isValid = dateTime.isValid();\r\n    if (!isValid) {\r\n      return value;\r\n    }\r\n    if (dateFormat) {\r\n      dateFormat = this.parseDateFormat(dateFormat);\r\n    }\r\n    if (timeFormat) {\r\n      timeFormat = this.parseTimeFormat(timeFormat);\r\n    }\r\n    const dateTimeFormat = dateFormat + ' ' + timeFormat;\r\n    return dateTime.format(dateTimeFormat);\r\n  }\r\n  /**\r\n   * è½¬æ¢æ°å­\r\n   * @param value value\r\n   */\r\n  private transformNumber(value): string {\r\n    if (value === null || value === undefined || value === '') {\r\n      return '';\r\n    }\r\n    const bigNumber = new BigNumber(value);\r\n    // å¦æä¸æ¯æ°å­ï¼ä¸åä»»ä½å¤ç\r\n    if (!BigNumber.isBigNumber(bigNumber)) {\r\n      return value;\r\n    }\r\n    const isNegative = bigNumber.isNegative();\r\n    const format = this.buildNumberFormat();\r\n    const { negativeSign = null, numberDecimalDigits = null } = this.numberFormat;\r\n    if (isNegative) {\r\n      if (negativeSign !== null) {\r\n        format.prefix = negativeSign;\r\n        return bigNumber.absoluteValue().toFormat(numberDecimalDigits, null, format);\r\n      }\r\n    }\r\n    return bigNumber.toFormat(numberDecimalDigits, null, format);\r\n  }\r\n  /**\r\n   * è½¬æ¢æ¥ææ ¼å¼è§åä¸ºmomentçformatè§å\r\n   * @param format format\r\n   */\r\n  private parseDateFormat(format: string) {\r\n    return format.replace(/y/g, 'Y').replace(/d/g, 'D');\r\n  }\r\n  /**\r\n   * è½¬æ¢æ¶é´æ ¼å¼è§åä¸ºmomentçformatè§å\r\n   * @param format format\r\n   */\r\n  private parseTimeFormat(format: string) {\r\n    return format.replace(/M/g, 'm');\r\n  }\r\n  /**\r\n   * æé bignumberæ°å­æ ¼å¼åéé¡¹\r\n   */\r\n  private buildNumberFormat() {\r\n    if (this.numberFormat) {\r\n      const { numberDecimalSeparator = null, numberGroupSeparator = null } = this.numberFormat;\r\n      const format: any = {\r\n        groupSize: 3,\r\n      };\r\n      if (numberDecimalSeparator !== null) {\r\n        format.decimalSeparator = numberDecimalSeparator;\r\n      }\r\n      if (numberGroupSeparator !== null) {\r\n        format.groupSeparator = numberGroupSeparator;\r\n      }\r\n      return format;\r\n    }\r\n  }\r\n  private get numberFormat(): NumberFormat {\r\n    return this.userSettings && this.userSettings.numberFormat || null;\r\n  }\r\n}","import { DialogService } from '@farris/ui-dialog';\r\nimport { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { GridComponent } from '@progress/kendo-angular-grid';\r\nimport { FarrisCommonModule } from '@farris/ui-common';\r\nimport {\r\n  KendoGridBindingDirective,\r\n  FarrisTreeTableBindingDirective,\r\n  LookupDataMappingDirective,\r\n  LookupEnableExtendLoadMethodDirective,\r\n  UIStateBindingDirective,\r\n  FarrisDisabledDirective,\r\n  FarrisDynamicColumnFormatDirective,\r\n  FarrisEditEnterDirective,\r\n  FarrisTextareaEditDirective,\r\n  FarrisSortDirective,\r\n  FarrisTreeTableFormatDirective,\r\n  GridColumnAggregateDirective,\r\n  GridSummaryDirective,\r\n  FarrisDatagridUseBindingDataDirective,\r\n  MultiSelectDataMappingDirective,\r\n  FarrisListViewBindingDirective,\r\n  EditableDirective,\r\n  InputEndEditDirective,\r\n  FarrisDataGridEndEditDirective,\r\n  HtmlEditorEndEditDirective,\r\n  KendoGridEndEditDirective,\r\n  FarrisDataGridRemoteSummaryDirective,\r\n  FarrisFilePreviewBindingDirective,\r\n  FarrisSetFocusDirective,\r\n  FarrisDiscussionEditorBindingDirective,\r\n  FarrisDiscussionListBindingDirective,\r\n  FarrisPrimengTreeTableBindingDirective,\r\n  FarrisDynamicRequiredDirective,\r\n  FarrisEditorDirective,\r\n  FarrisQuerySolutionEventBindDirective,\r\n  FarrisDateLocalizationDirective,\r\n  FarrisNumberLocalizationDirective,\r\n  FarrisTimeLocalizationDirective,\r\n  FarrisTextLocalizationDirective,\r\n  FarrisCheckboxModificationDirective,\r\n  FarrisLabelModificationDirective,\r\n  FarrisLookupBindingDirective,\r\n  ListNavComponentRefDirective,\r\n  ListViewComponentRefDirective,\r\n  ListFilterComponentRefDirective,\r\n  ViewChangeComponentRefDirective,\r\n  FilterComponentRefDirective,\r\n  SectionComponentRefDirective,\r\n  HtmlEditorComponentRefDirective,\r\n  InputGroupComponentRefDirective,\r\n  DatepickerComponentRefDirective,\r\n  TimePickerComponentRefDirective,\r\n  NumberSpinnerComponentRefDirective,\r\n  ComboListComponentRefDirective,\r\n  ComboLookupComponentRefDirective,\r\n  LookupGridComponentRefDirective,\r\n  DatagridComponentRefDirective,\r\n  TreetableComponentRefDirective,\r\n  WizardComponentRefDirective,\r\n  DiscussionEditorComponentRefDirective,\r\n  DiscussionListComponentRefDirective,\r\n  NavComponentRefDirective,\r\n  MultiSelectComponentRefDirective,\r\n  ScrollspyComponentRefDirective,\r\n  ComboLookupDataMappingDirective,\r\n  AppointmentCalendarBindingDirective,\r\n  CustomDatagridSizeDirective,\r\n  FarrisFilterBindingDirective,\r\n  FarrisListFilterBindingDirective\r\n} from './directives/index';\r\nimport {\r\n  FarrisKendoGridFormatService, FarrisTreetableFormatService, StringToDatePipe,\r\n  DateFormatPlaceholderPipe, KendoGridFilterDirective, FormatTotalPipe\r\n} from './format/index';\r\nimport { ImageIdToUrlPipe, FormatPrimeNgTreeTableCellData, Localization } from './pipes/index';\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    FarrisCommonModule.forRoot()\r\n  ],\r\n  declarations: [\r\n    KendoGridBindingDirective,\r\n    FarrisTreeTableBindingDirective,\r\n    LookupDataMappingDirective,\r\n    LookupEnableExtendLoadMethodDirective,\r\n    UIStateBindingDirective,\r\n    FarrisDisabledDirective,\r\n    FarrisSortDirective,\r\n    FarrisDynamicColumnFormatDirective,\r\n    FarrisEditEnterDirective,\r\n    FarrisTextareaEditDirective,\r\n    FarrisTreeTableFormatDirective,\r\n    StringToDatePipe,\r\n    GridColumnAggregateDirective,\r\n    GridSummaryDirective,\r\n    DateFormatPlaceholderPipe,\r\n    ImageIdToUrlPipe,\r\n    FormatPrimeNgTreeTableCellData,\r\n    FarrisDatagridUseBindingDataDirective,\r\n    MultiSelectDataMappingDirective,\r\n    FarrisListViewBindingDirective,\r\n    EditableDirective,\r\n    KendoGridFilterDirective,\r\n    FormatTotalPipe,\r\n    InputEndEditDirective,\r\n    FarrisDataGridEndEditDirective,\r\n    HtmlEditorEndEditDirective,\r\n    KendoGridEndEditDirective,\r\n    FarrisDataGridRemoteSummaryDirective,\r\n    FarrisFilePreviewBindingDirective,\r\n    FarrisSetFocusDirective,\r\n    FarrisDiscussionEditorBindingDirective,\r\n    FarrisDiscussionListBindingDirective,\r\n    FarrisPrimengTreeTableBindingDirective,\r\n    FarrisDynamicRequiredDirective,\r\n    FarrisEditorDirective,\r\n    FarrisQuerySolutionEventBindDirective,\r\n    FarrisDateLocalizationDirective,\r\n    FarrisNumberLocalizationDirective,\r\n    FarrisTimeLocalizationDirective,\r\n    FarrisTextLocalizationDirective,\r\n    Localization,\r\n    FarrisCheckboxModificationDirective,\r\n    FarrisLabelModificationDirective,\r\n    FarrisLookupBindingDirective,\r\n    ListNavComponentRefDirective,\r\n    ListViewComponentRefDirective,\r\n    ListFilterComponentRefDirective,\r\n    ViewChangeComponentRefDirective,\r\n    FilterComponentRefDirective,\r\n    SectionComponentRefDirective,\r\n    HtmlEditorComponentRefDirective,\r\n    InputGroupComponentRefDirective,\r\n    DatepickerComponentRefDirective,\r\n    TimePickerComponentRefDirective,\r\n    NumberSpinnerComponentRefDirective,\r\n    ComboListComponentRefDirective,\r\n    ComboLookupComponentRefDirective,\r\n    LookupGridComponentRefDirective,\r\n    DatagridComponentRefDirective,\r\n    TreetableComponentRefDirective,\r\n    WizardComponentRefDirective,\r\n    DiscussionEditorComponentRefDirective,\r\n    DiscussionListComponentRefDirective,\r\n    NavComponentRefDirective,\r\n    MultiSelectComponentRefDirective,\r\n    ScrollspyComponentRefDirective,\r\n    ComboLookupDataMappingDirective,\r\n    AppointmentCalendarBindingDirective,\r\n    CustomDatagridSizeDirective,\r\n    FarrisFilterBindingDirective,\r\n    FarrisListFilterBindingDirective\r\n  ],\r\n  providers: [\r\n    DialogService, GridComponent, FarrisKendoGridFormatService, FarrisTreetableFormatService],\r\n  exports: [\r\n    KendoGridBindingDirective,\r\n    FarrisTreeTableBindingDirective,\r\n    LookupDataMappingDirective,\r\n    LookupEnableExtendLoadMethodDirective,\r\n    UIStateBindingDirective,\r\n    FarrisDisabledDirective,\r\n    FarrisSortDirective,\r\n    FarrisDynamicColumnFormatDirective,\r\n    FarrisEditEnterDirective,\r\n    FarrisTextareaEditDirective,\r\n    FarrisTreeTableFormatDirective,\r\n    StringToDatePipe,\r\n    GridColumnAggregateDirective,\r\n    DateFormatPlaceholderPipe,\r\n    ImageIdToUrlPipe,\r\n    FormatPrimeNgTreeTableCellData,\r\n    FarrisDatagridUseBindingDataDirective,\r\n    MultiSelectDataMappingDirective,\r\n    FarrisListViewBindingDirective,\r\n    EditableDirective,\r\n    KendoGridFilterDirective,\r\n    FormatTotalPipe,\r\n    InputEndEditDirective,\r\n    FarrisDataGridEndEditDirective,\r\n    HtmlEditorEndEditDirective,\r\n    KendoGridEndEditDirective,\r\n    FarrisDataGridRemoteSummaryDirective,\r\n    FarrisFilePreviewBindingDirective,\r\n    FarrisSetFocusDirective,\r\n    FarrisDiscussionEditorBindingDirective,\r\n    FarrisDiscussionListBindingDirective,\r\n    FarrisPrimengTreeTableBindingDirective,\r\n    FarrisDynamicRequiredDirective,\r\n    FarrisEditorDirective,\r\n    FarrisQuerySolutionEventBindDirective,\r\n    FarrisDateLocalizationDirective,\r\n    FarrisNumberLocalizationDirective,\r\n    FarrisTimeLocalizationDirective,\r\n    FarrisTextLocalizationDirective,\r\n    Localization,\r\n    FarrisCheckboxModificationDirective,\r\n    FarrisLabelModificationDirective,\r\n    FarrisLookupBindingDirective,\r\n    ListNavComponentRefDirective,\r\n    ListViewComponentRefDirective,\r\n    ListFilterComponentRefDirective,\r\n    ViewChangeComponentRefDirective,\r\n    FilterComponentRefDirective,\r\n    SectionComponentRefDirective,\r\n    HtmlEditorComponentRefDirective,\r\n    InputGroupComponentRefDirective,\r\n    DatepickerComponentRefDirective,\r\n    TimePickerComponentRefDirective,\r\n    NumberSpinnerComponentRefDirective,\r\n    ComboListComponentRefDirective,\r\n    ComboLookupComponentRefDirective,\r\n    LookupGridComponentRefDirective,\r\n    DatagridComponentRefDirective,\r\n    TreetableComponentRefDirective,\r\n    WizardComponentRefDirective,\r\n    DiscussionEditorComponentRefDirective,\r\n    DiscussionListComponentRefDirective,\r\n    NavComponentRefDirective,\r\n    MultiSelectComponentRefDirective,\r\n    ScrollspyComponentRefDirective,\r\n    ComboLookupDataMappingDirective,\r\n    AppointmentCalendarBindingDirective,\r\n    CustomDatagridSizeDirective,\r\n    FarrisFilterBindingDirective,\r\n    FarrisListFilterBindingDirective\r\n  ]\r\n})\r\nclass KendoBindingModule {\r\n}\r\n\r\nexport { KendoBindingModule };\r\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public-api';\n\nexport {ComponentRef as Éµc} from './lib/directives/component-ref/component-ref';\nexport {DataMapping as Éµa} from './lib/directives/data-mapping';\nexport {AbstractEndEdit as Éµb} from './lib/directives/end-edit/abstract_end_edit';"],"names":["KEY_UISTATE_REPLY_MESSAGE","KEY_MESSAGE_ON_COMMENT_ADD"],"mappings":"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"}

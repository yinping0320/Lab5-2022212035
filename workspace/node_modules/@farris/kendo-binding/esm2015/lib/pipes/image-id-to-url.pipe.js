import { Injector, Optional, Pipe } from '@angular/core';
import { DownloadService } from '@gsp-svc/formdoc-upload';
import { BasePathService } from '@farris/rtf';
class ImageIdToUrlPipe {
    constructor(injector) {
        this.injector = injector;
        this.defaultPic = BasePathService.convertPath('/platform/common/web/assets/imgs/no-pic.png');
        this.downloadService = this.injector && this.injector.get(DownloadService, null) || null;
    }
    transform(value, rootId = 'default-root') {
        if (!value) {
            return this.defaultPic;
        }
        //const rootId = 'default-root';
        if (this.downloadService) {
            return this.downloadService.getDownloadUrl(value, rootId);
        }
        else {
            console.warn('因安全问题，附件下载提供安全校验机制，附件下载功能需重新编译。');
            return BasePathService.convertPath(`/api/runtime/dfs/v1.0/formdoc/download/${value}`);
        }
    }
}
ImageIdToUrlPipe.decorators = [
    { type: Pipe, args: [{ name: 'imageIdToUrl' },] }
];
/** @nocollapse */
ImageIdToUrlPipe.ctorParameters = () => [
    { type: Injector, decorators: [{ type: Optional }] }
];
export { ImageIdToUrlPipe };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW1hZ2UtaWQtdG8tdXJsLnBpcGUuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL2tlbmRvLWJpbmRpbmcvIiwic291cmNlcyI6WyJsaWIvcGlwZXMvaW1hZ2UtaWQtdG8tdXJsLnBpcGUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFFBQVEsRUFBRSxRQUFRLEVBQUUsSUFBSSxFQUFpQixNQUFNLGVBQWUsQ0FBQztBQUN4RSxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0seUJBQXlCLENBQUM7QUFDMUQsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLGFBQWEsQ0FBQztBQUM5QyxNQUNNLGdCQUFnQjtJQUdwQixZQUFnQyxRQUFrQjtRQUFsQixhQUFRLEdBQVIsUUFBUSxDQUFVO1FBRjFDLGVBQVUsR0FBRyxlQUFlLENBQUMsV0FBVyxDQUFDLDZDQUE2QyxDQUFDLENBQUM7UUFHOUYsSUFBSSxDQUFDLGVBQWUsR0FBRyxJQUFJLENBQUMsUUFBUSxJQUFJLElBQUksQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFrQixlQUFlLEVBQUUsSUFBSSxDQUFDLElBQUksSUFBSSxDQUFDO0lBQzVHLENBQUM7SUFFRCxTQUFTLENBQUMsS0FBYSxFQUFFLFNBQWlCLGNBQWM7UUFDdEQsSUFBSSxDQUFDLEtBQUssRUFBRTtZQUNWLE9BQU8sSUFBSSxDQUFDLFVBQVUsQ0FBQztTQUN4QjtRQUNELGdDQUFnQztRQUNoQyxJQUFJLElBQUksQ0FBQyxlQUFlLEVBQUU7WUFDeEIsT0FBTyxJQUFJLENBQUMsZUFBZSxDQUFDLGNBQWMsQ0FBQyxLQUFLLEVBQUUsTUFBTSxDQUFDLENBQUM7U0FDM0Q7YUFBTTtZQUNMLE9BQU8sQ0FBQyxJQUFJLENBQUMsaUNBQWlDLENBQUMsQ0FBQztZQUNoRCxPQUFPLGVBQWUsQ0FBQyxXQUFXLENBQUMsMENBQTBDLEtBQUssRUFBRSxDQUFDLENBQUM7U0FDdkY7SUFDSCxDQUFDOzs7WUFuQkYsSUFBSSxTQUFDLEVBQUUsSUFBSSxFQUFFLGNBQWMsRUFBRTs7OztZQUhyQixRQUFRLHVCQU9GLFFBQVE7O0FBa0J2QixPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdG9yLCBPcHRpb25hbCwgUGlwZSwgUGlwZVRyYW5zZm9ybSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBEb3dubG9hZFNlcnZpY2UgfSBmcm9tICdAZ3NwLXN2Yy9mb3JtZG9jLXVwbG9hZCc7XHJcbmltcG9ydCB7IEJhc2VQYXRoU2VydmljZSB9IGZyb20gJ0BmYXJyaXMvcnRmJztcclxuQFBpcGUoeyBuYW1lOiAnaW1hZ2VJZFRvVXJsJyB9KVxyXG5jbGFzcyBJbWFnZUlkVG9VcmxQaXBlIGltcGxlbWVudHMgUGlwZVRyYW5zZm9ybSB7XHJcbiAgcHJpdmF0ZSBkZWZhdWx0UGljID0gQmFzZVBhdGhTZXJ2aWNlLmNvbnZlcnRQYXRoKCcvcGxhdGZvcm0vY29tbW9uL3dlYi9hc3NldHMvaW1ncy9uby1waWMucG5nJyk7XHJcbiAgcHJpdmF0ZSBkb3dubG9hZFNlcnZpY2U6IERvd25sb2FkU2VydmljZTtcclxuICBjb25zdHJ1Y3RvcihAT3B0aW9uYWwoKSBwcml2YXRlIGluamVjdG9yOiBJbmplY3Rvcikge1xyXG4gICAgdGhpcy5kb3dubG9hZFNlcnZpY2UgPSB0aGlzLmluamVjdG9yICYmIHRoaXMuaW5qZWN0b3IuZ2V0PERvd25sb2FkU2VydmljZT4oRG93bmxvYWRTZXJ2aWNlLCBudWxsKSB8fCBudWxsO1xyXG4gIH1cclxuXHJcbiAgdHJhbnNmb3JtKHZhbHVlOiBzdHJpbmcsIHJvb3RJZDogc3RyaW5nID0gJ2RlZmF1bHQtcm9vdCcpOiBzdHJpbmcge1xyXG4gICAgaWYgKCF2YWx1ZSkge1xyXG4gICAgICByZXR1cm4gdGhpcy5kZWZhdWx0UGljO1xyXG4gICAgfVxyXG4gICAgLy9jb25zdCByb290SWQgPSAnZGVmYXVsdC1yb290JztcclxuICAgIGlmICh0aGlzLmRvd25sb2FkU2VydmljZSkge1xyXG4gICAgICByZXR1cm4gdGhpcy5kb3dubG9hZFNlcnZpY2UuZ2V0RG93bmxvYWRVcmwodmFsdWUsIHJvb3RJZCk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBjb25zb2xlLndhcm4oJ+WboOWuieWFqOmXrumimO+8jOmZhOS7tuS4i+i9veaPkOS+m+WuieWFqOagoemqjOacuuWItu+8jOmZhOS7tuS4i+i9veWKn+iDvemcgOmHjeaWsOe8luivkeOAgicpO1xyXG4gICAgICByZXR1cm4gQmFzZVBhdGhTZXJ2aWNlLmNvbnZlcnRQYXRoKGAvYXBpL3J1bnRpbWUvZGZzL3YxLjAvZm9ybWRvYy9kb3dubG9hZC8ke3ZhbHVlfWApO1xyXG4gICAgfVxyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IHsgSW1hZ2VJZFRvVXJsUGlwZSB9O1xyXG4iXX0=
import { Inject, Injector, Optional, Pipe } from "@angular/core";
import { UserSettingsToken } from "@farris/devkit";
import { BigNumber } from 'bignumber.js';
import moment from 'moment';
export class Localization {
    constructor(injector, userSettings) {
        this.injector = injector;
        this.userSettings = userSettings;
    }
    transform(value, dataType) {
        if (dataType) {
            dataType = dataType.toLowerCase();
            if (dataType === 'date') {
                return this.transformDate(value);
            }
            else if (dataType === 'datetime') {
                return this.transformDateTime(value);
            }
            else if (dataType === 'number') {
                return this.transformNumber(value);
            }
            else {
                return value;
            }
        }
    }
    /**
     * 转换日期
     * @param value value
     */
    transformDate(value) {
        let dateFormat = this.userSettings && this.userSettings.dateFormat || null;
        if (!dateFormat || !value) {
            return value;
        }
        const date = moment(value);
        const isValid = date.isValid();
        if (!isValid) {
            return value;
        }
        dateFormat = this.parseDateFormat(dateFormat);
        return date.format(dateFormat);
    }
    /**
     * 转换日期时间
     * @param value value
     * todo: 目前无法定义日期时间格式
     */
    transformDateTime(value) {
        let dateFormat = this.userSettings && this.userSettings.dateFormat || '';
        let timeFormat = this.userSettings && this.userSettings.timeFormat || '';
        const dateTime = moment(value);
        const isValid = dateTime.isValid();
        if (!isValid) {
            return value;
        }
        if (dateFormat) {
            dateFormat = this.parseDateFormat(dateFormat);
        }
        if (timeFormat) {
            timeFormat = this.parseTimeFormat(timeFormat);
        }
        const dateTimeFormat = dateFormat + ' ' + timeFormat;
        return dateTime.format(dateTimeFormat);
    }
    /**
     * 转换数字
     * @param value value
     */
    transformNumber(value) {
        if (value === null || value === undefined || value === '') {
            return '';
        }
        const bigNumber = new BigNumber(value);
        // 如果不是数字，不做任何处理
        if (!BigNumber.isBigNumber(bigNumber)) {
            return value;
        }
        const isNegative = bigNumber.isNegative();
        const format = this.buildNumberFormat();
        const { negativeSign = null, numberDecimalDigits = null } = this.numberFormat;
        if (isNegative) {
            if (negativeSign !== null) {
                format.prefix = negativeSign;
                return bigNumber.absoluteValue().toFormat(numberDecimalDigits, null, format);
            }
        }
        return bigNumber.toFormat(numberDecimalDigits, null, format);
    }
    /**
     * 转换日期格式规则为moment的format规则
     * @param format format
     */
    parseDateFormat(format) {
        return format.replace(/y/g, 'Y').replace(/d/g, 'D');
    }
    /**
     * 转换时间格式规则为moment的format规则
     * @param format format
     */
    parseTimeFormat(format) {
        return format.replace(/M/g, 'm');
    }
    /**
     * 构造bignumber数字格式化选项
     */
    buildNumberFormat() {
        if (this.numberFormat) {
            const { numberDecimalSeparator = null, numberGroupSeparator = null } = this.numberFormat;
            const format = {
                groupSize: 3,
            };
            if (numberDecimalSeparator !== null) {
                format.decimalSeparator = numberDecimalSeparator;
            }
            if (numberGroupSeparator !== null) {
                format.groupSeparator = numberGroupSeparator;
            }
            return format;
        }
    }
    get numberFormat() {
        return this.userSettings && this.userSettings.numberFormat || null;
    }
}
Localization.decorators = [
    { type: Pipe, args: [{ name: 'localization' },] }
];
/** @nocollapse */
Localization.ctorParameters = () => [
    { type: Injector, decorators: [{ type: Optional }] },
    { type: undefined, decorators: [{ type: Inject, args: [UserSettingsToken,] }] }
];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibG9jYWxpemF0aW9uLnBpcGUuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL2tlbmRvLWJpbmRpbmcvIiwic291cmNlcyI6WyJsaWIvcGlwZXMvbG9jYWxpemF0aW9uLnBpcGUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLE1BQU0sRUFBRSxRQUFRLEVBQUUsUUFBUSxFQUFFLElBQUksRUFBaUIsTUFBTSxlQUFlLENBQUM7QUFDaEYsT0FBTyxFQUE4QixpQkFBaUIsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQy9FLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxjQUFjLENBQUM7QUFDekMsT0FBTyxNQUFNLE1BQU0sUUFBUSxDQUFDO0FBRzVCLE1BQU0sT0FBTyxZQUFZO0lBQ3ZCLFlBQWdDLFFBQWtCLEVBQXFDLFlBQTBCO1FBQWpGLGFBQVEsR0FBUixRQUFRLENBQVU7UUFBcUMsaUJBQVksR0FBWixZQUFZLENBQWM7SUFDakgsQ0FBQztJQUNNLFNBQVMsQ0FBQyxLQUFVLEVBQUUsUUFBZ0I7UUFDM0MsSUFBSSxRQUFRLEVBQUU7WUFDWixRQUFRLEdBQUcsUUFBUSxDQUFDLFdBQVcsRUFBRSxDQUFDO1lBQ2xDLElBQUksUUFBUSxLQUFLLE1BQU0sRUFBRTtnQkFDdkIsT0FBTyxJQUFJLENBQUMsYUFBYSxDQUFDLEtBQUssQ0FBQyxDQUFDO2FBQ2xDO2lCQUFNLElBQUksUUFBUSxLQUFLLFVBQVUsRUFBRTtnQkFDbEMsT0FBTyxJQUFJLENBQUMsaUJBQWlCLENBQUMsS0FBSyxDQUFDLENBQUM7YUFDdEM7aUJBQU0sSUFBSSxRQUFRLEtBQUssUUFBUSxFQUFFO2dCQUNoQyxPQUFPLElBQUksQ0FBQyxlQUFlLENBQUMsS0FBSyxDQUFDLENBQUM7YUFDcEM7aUJBQU07Z0JBQ0wsT0FBTyxLQUFLLENBQUM7YUFDZDtTQUNGO0lBQ0gsQ0FBQztJQUNEOzs7T0FHRztJQUNLLGFBQWEsQ0FBQyxLQUFVO1FBQzlCLElBQUksVUFBVSxH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QUMsQ0FBQztJQUN0RCxDQUFDO0lBQ0Q7OztPQUdHO0lBQ0ssZUFBZSxDQUFDLE1BQWM7UUFDcEMsT0FBTyxNQUFNLENBQUMsT0FBTyxDQUFDLElBQUksRUFBRSxHQUFHLENBQUMsQ0FBQztJQUNuQyxDQUFDO0lBQ0Q7O09BRUc7SUFDSyxpQkFBaUI7UUFDdkIsSUFBSSxJQUFJLENBQUMsWUFBWSxFQUFFO1lBQ3JCLE1BQU0sRUFBRSxzQkFBc0IsR0FBRyxJQUFJLEVBQUUsb0JBQW9CLEdBQUcsSUFBSSxFQUFFLEdBQUcsSUFBSSxDQUFDLFlBQVksQ0FBQztZQUN6RixNQUFNLE1BQU0sR0FBUTtnQkFDbEIsU0FBUyxFQUFFLENBQUM7YUFDYixDQUFDO1lBQ0YsSUFBSSxzQkFBc0IsS0FBSyxJQUFJLEVBQUU7Z0JBQ25DLE1BQU0sQ0FBQyxnQkFBZ0IsR0FBRyxzQkFBc0IsQ0FBQzthQUNsRDtZQUNELElBQUksb0JBQW9CLEtBQUssSUFBSSxFQUFFO2dCQUNqQyxNQUFNLENBQUMsY0FBYyxHQUFHLG9CQUFvQixDQUFDO2FBQzlDO1lBQ0QsT0FBTyxNQUFNLENBQUM7U0FDZjtJQUNILENBQUM7SUFDRCxJQUFZLFlBQVk7UUFDdEIsT0FBTyxJQUFJLENBQUMsWUFBWSxJQUFJLElBQUksQ0FBQyxZQUFZLENBQUMsWUFBWSxJQUFJLElBQUksQ0FBQztJQUNyRSxDQUFDOzs7WUFuSEYsSUFBSSxTQUFDLEVBQUUsSUFBSSxFQUFFLGNBQWMsRUFBRTs7OztZQUxiLFFBQVEsdUJBT1YsUUFBUTs0Q0FBZ0MsTUFBTSxTQUFDLGlCQUFpQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdCwgSW5qZWN0b3IsIE9wdGlvbmFsLCBQaXBlLCBQaXBlVHJhbnNmb3JtIH0gZnJvbSBcIkBhbmd1bGFyL2NvcmVcIjtcclxuaW1wb3J0IHsgTnVtYmVyRm9ybWF0LCBVc2VyU2V0dGluZ3MsIFVzZXJTZXR0aW5nc1Rva2VuIH0gZnJvbSBcIkBmYXJyaXMvZGV2a2l0XCI7XHJcbmltcG9ydCB7IEJpZ051bWJlciB9IGZyb20gJ2JpZ251bWJlci5qcyc7XHJcbmltcG9ydCBtb21lbnQgZnJvbSAnbW9tZW50JztcclxuXHJcbkBQaXBlKHsgbmFtZTogJ2xvY2FsaXphdGlvbicgfSlcclxuZXhwb3J0IGNsYXNzIExvY2FsaXphdGlvbiBpbXBsZW1lbnRzIFBpcGVUcmFuc2Zvcm0ge1xyXG4gIGNvbnN0cnVjdG9yKEBPcHRpb25hbCgpIHByaXZhdGUgaW5qZWN0b3I6IEluamVjdG9yLCBASW5qZWN0KFVzZXJTZXR0aW5nc1Rva2VuKSBwcml2YXRlIHVzZXJTZXR0aW5nczogVXNlclNldHRpbmdzKSB7XHJcbiAgfVxyXG4gIHB1YmxpYyB0cmFuc2Zvcm0odmFsdWU6IGFueSwgZGF0YVR5cGU6IHN0cmluZykge1xyXG4gICAgaWYgKGRhdGFUeXBlKSB7XHJcbiAgICAgIGRhdGFUeXBlID0gZGF0YVR5cGUudG9Mb3dlckNhc2UoKTtcclxuICAgICAgaWYgKGRhdGFUeXBlID09PSAnZGF0ZScpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy50cmFuc2Zvcm1EYXRlKHZhbHVlKTtcclxuICAgICAgfSBlbHNlIGlmIChkYXRhVHlwZSA9PT0gJ2RhdGV0aW1lJykge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnRyYW5zZm9ybURhdGVUaW1lKHZhbHVlKTtcclxuICAgICAgfSBlbHNlIGlmIChkYXRhVHlwZSA9PT0gJ251bWJlcicpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy50cmFuc2Zvcm1OdW1iZXIodmFsdWUpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHJldHVybiB2YWx1ZTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuICAvKipcclxuICAgKiDovazmjaLml6XmnJ9cclxuICAgKiBAcGFyYW0gdmFsdWUgdmFsdWVcclxuICAgKi9cclxuICBwcml2YXRlIHRyYW5zZm9ybURhdGUodmFsdWU6IGFueSkge1xyXG4gICAgbGV0IGRhdGVGb3JtYXQgPSB0aGlzLnVzZXJTZXR0aW5ncyAmJiB0aGlzLnVzZXJTZXR0aW5ncy5kYXRlRm9ybWF0IHx8IG51bGw7XHJcbiAgICBpZiAoIWRhdGVGb3JtYXQgfHwgIXZhbHVlKSB7XHJcbiAgICAgIHJldHVybiB2YWx1ZTtcclxuICAgIH1cclxuICAgIGNvbnN0IGRhdGUgPSBtb21lbnQodmFsdWUpO1xyXG4gICAgY29uc3QgaXNWYWxpZCA9IGRhdGUuaXNWYWxpZCgpO1xyXG4gICAgaWYgKCFpc1ZhbGlkKSB7XHJcbiAgICAgIHJldHVybiB2YWx1ZTtcclxuICAgIH1cclxuICAgIGRhdGVGb3JtYXQgPSB0aGlzLnBhcnNlRGF0ZUZvcm1hdChkYXRlRm9ybWF0KTtcclxuICAgIHJldHVybiBkYXRlLmZvcm1hdChkYXRlRm9ybWF0KTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog6L2s5o2i5pel5pyf5pe26Ze0XHJcbiAgICogQHBhcmFtIHZhbHVlIHZhbHVlXHJcbiAgICogdG9kbzog55uu5YmN5peg5rOV5a6a5LmJ5pel5pyf5pe26Ze05qC85byPXHJcbiAgICovXHJcbiAgcHJpdmF0ZSB0cmFuc2Zvcm1EYXRlVGltZSh2YWx1ZTogYW55KSB7XHJcbiAgICBsZXQgZGF0ZUZvcm1hdCA9IHRoaXMudXNlclNldHRpbmdzICYmIHRoaXMudXNlclNldHRpbmdzLmRhdGVGb3JtYXQgfHwgJyc7XHJcbiAgICBsZXQgdGltZUZvcm1hdCA9IHRoaXMudXNlclNldHRpbmdzICYmIHRoaXMudXNlclNldHRpbmdzLnRpbWVGb3JtYXQgfHwgJyc7XHJcbiAgICBjb25zdCBkYXRlVGltZSA9IG1vbWVudCh2YWx1ZSk7XHJcbiAgICBjb25zdCBpc1ZhbGlkID0gZGF0ZVRpbWUuaXNWYWxpZCgpO1xyXG4gICAgaWYgKCFpc1ZhbGlkKSB7XHJcbiAgICAgIHJldHVybiB2YWx1ZTtcclxuICAgIH1cclxuICAgIGlmIChkYXRlRm9ybWF0KSB7XHJcbiAgICAgIGRhdGVGb3JtYXQgPSB0aGlzLnBhcnNlRGF0ZUZvcm1hdChkYXRlRm9ybWF0KTtcclxuICAgIH1cclxuICAgIGlmICh0aW1lRm9ybWF0KSB7XHJcbiAgICAgIHRpbWVGb3JtYXQgPSB0aGlzLnBhcnNlVGltZUZvcm1hdCh0aW1lRm9ybWF0KTtcclxuICAgIH1cclxuICAgIGNvbnN0IGRhdGVUaW1lRm9ybWF0ID0gZGF0ZUZvcm1hdCArICcgJyArIHRpbWVGb3JtYXQ7XHJcbiAgICByZXR1cm4gZGF0ZVRpbWUuZm9ybWF0KGRhdGVUaW1lRm9ybWF0KTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog6L2s5o2i5pWw5a2XXHJcbiAgICogQHBhcmFtIHZhbHVlIHZhbHVlXHJcbiAgICovXHJcbiAgcHJpdmF0ZSB0cmFuc2Zvcm1OdW1iZXIodmFsdWUpOiBzdHJpbmcge1xyXG4gICAgaWYgKHZhbHVlID09PSBudWxsIHx8IHZhbHVlID09PSB1bmRlZmluZWQgfHwgdmFsdWUgPT09ICcnKSB7XHJcbiAgICAgIHJldHVybiAnJztcclxuICAgIH1cclxuICAgIGNvbnN0IGJpZ051bWJlciA9IG5ldyBCaWdOdW1iZXIodmFsdWUpO1xyXG4gICAgLy8g5aaC5p6c5LiN5piv5pWw5a2X77yM5LiN5YGa5Lu75L2V5aSE55CGXHJcbiAgICBpZiAoIUJpZ051bWJlci5pc0JpZ051bWJlcihiaWdOdW1iZXIpKSB7XHJcbiAgICAgIHJldHVybiB2YWx1ZTtcclxuICAgIH1cclxuICAgIGNvbnN0IGlzTmVnYXRpdmUgPSBiaWdOdW1iZXIuaXNOZWdhdGl2ZSgpO1xyXG4gICAgY29uc3QgZm9ybWF0ID0gdGhpcy5idWlsZE51bWJlckZvcm1hdCgpO1xyXG4gICAgY29uc3QgeyBuZWdhdGl2ZVNpZ24gPSBudWxsLCBudW1iZXJEZWNpbWFsRGlnaXRzID0gbnVsbCB9ID0gdGhpcy5udW1iZXJGb3JtYXQ7XHJcbiAgICBpZiAoaXNOZWdhdGl2ZSkge1xyXG4gICAgICBpZiAobmVnYXRpdmVTaWduICE9PSBudWxsKSB7XHJcbiAgICAgICAgZm9ybWF0LnByZWZpeCA9IG5lZ2F0aXZlU2lnbjtcclxuICAgICAgICByZXR1cm4gYmlnTnVtYmVyLmFic29sdXRlVmFsdWUoKS50b0Zvcm1hdChudW1iZXJEZWNpbWFsRGlnaXRzLCBudWxsLCBmb3JtYXQpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gYmlnTnVtYmVyLnRvRm9ybWF0KG51bWJlckRlY2ltYWxEaWdpdHMsIG51bGwsIGZvcm1hdCk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOi9rOaNouaXpeacn+agvOW8j+inhOWImeS4um1vbWVudOeahGZvcm1hdOinhOWImVxyXG4gICAqIEBwYXJhbSBmb3JtYXQgZm9ybWF0XHJcbiAgICovXHJcbiAgcHJpdmF0ZSBwYXJzZURhdGVGb3JtYXQoZm9ybWF0OiBzdHJpbmcpIHtcclxuICAgIHJldHVybiBmb3JtYXQucmVwbGFjZSgveS9nLCAnWScpLnJlcGxhY2UoL2QvZywgJ0QnKTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog6L2s5o2i5pe26Ze05qC85byP6KeE5YiZ5Li6bW9tZW5055qEZm9ybWF06KeE5YiZXHJcbiAgICogQHBhcmFtIGZvcm1hdCBmb3JtYXRcclxuICAgKi9cclxuICBwcml2YXRlIHBhcnNlVGltZUZvcm1hdChmb3JtYXQ6IHN0cmluZykge1xyXG4gICAgcmV0dXJuIGZvcm1hdC5yZXBsYWNlKC9NL2csICdtJyk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOaehOmAoGJpZ251bWJlcuaVsOWtl+agvOW8j+WMlumAiemhuVxyXG4gICAqL1xyXG4gIHByaXZhdGUgYnVpbGROdW1iZXJGb3JtYXQoKSB7XHJcbiAgICBpZiAodGhpcy5udW1iZXJGb3JtYXQpIHtcclxuICAgICAgY29uc3QgeyBudW1iZXJEZWNpbWFsU2VwYXJhdG9yID0gbnVsbCwgbnVtYmVyR3JvdXBTZXBhcmF0b3IgPSBudWxsIH0gPSB0aGlzLm51bWJlckZvcm1hdDtcclxuICAgICAgY29uc3QgZm9ybWF0OiBhbnkgPSB7XHJcbiAgICAgICAgZ3JvdXBTaXplOiAzLFxyXG4gICAgICB9O1xyXG4gICAgICBpZiAobnVtYmVyRGVjaW1hbFNlcGFyYXRvciAhPT0gbnVsbCkge1xyXG4gICAgICAgIGZvcm1hdC5kZWNpbWFsU2VwYXJhdG9yID0gbnVtYmVyRGVjaW1hbFNlcGFyYXRvcjtcclxuICAgICAgfVxyXG4gICAgICBpZiAobnVtYmVyR3JvdXBTZXBhcmF0b3IgIT09IG51bGwpIHtcclxuICAgICAgICBmb3JtYXQuZ3JvdXBTZXBhcmF0b3IgPSBudW1iZXJHcm91cFNlcGFyYXRvcjtcclxuICAgICAgfVxyXG4gICAgICByZXR1cm4gZm9ybWF0O1xyXG4gICAgfVxyXG4gIH1cclxuICBwcml2YXRlIGdldCBudW1iZXJGb3JtYXQoKTogTnVtYmVyRm9ybWF0IHtcclxuICAgIHJldHVybiB0aGlzLnVzZXJTZXR0aW5ncyAmJiB0aGlzLnVzZXJTZXR0aW5ncy5udW1iZXJGb3JtYXQgfHwgbnVsbDtcclxuICB9XHJcbn0iXX0=
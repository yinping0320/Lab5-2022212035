import { LocaleService } from '@farris/ui-locale';
import { Pipe, Injector, Optional } from '@angular/core';
import { ColumnFormatService } from '@farris/ui-common/column';
export class FormatPrimeNgTreeTableCellData {
    constructor(cfs, injector) {
        this.cfs = cfs;
        this.injector = injector;
        if (this.injector) {
            this.localeService = this.injector.get(LocaleService);
        }
    }
    transform(col, rowData) {
        let value = '';
        if (rowData && col && col.field) {
            value = this.getValue(col.field, rowData);
            let formatterFn = col.formatter;
            if (!formatterFn) {
                if (col.isMultilingualField) {
                    return this.getMultiLanguageValue(value);
                }
                else {
                    return value;
                }
            }
            else {
                return this.cfs.format(value, rowData, formatterFn);
            }
        }
        return '';
    }
    // 获取多语数据
    getMultiLanguageValue(valObj) {
        if (valObj && typeof valObj === 'object' && Object.keys(valObj).length > 0) {
            const localeId = this.localeService && this.localeService.localeId || 'zh-CHS';
            const value = valObj[localeId];
            return value === undefined ? '' : value;
        }
        else {
            return '';
        }
    }
    getValue(path, target) {
        if (!target) {
            return '';
        }
        var resultVal = '';
        if (path.indexOf('.') === -1) {
            resultVal = target[path];
        }
        else {
            resultVal = path.split('.').reduce(((obj, key) => {
                return obj && obj[key] || null;
            }), target);
        }
        return resultVal;
    }
    ;
    /**
     * 是否为帮助列
     * @param col col
     */
    isHelpColumn(col) {
        return col && col.editor && col.editor.options && col.editor.options.type === 'EditorTypes.LOOKUP' || false;
    }
    getHelpColumnValue(col, data) {
        const textField = this.getHelpControlTextField(col);
        const mapFields = this.getHelpControlMapFields(col);
        if (textField && mapFields && Object.keys(mapFields).length > 0) {
            const path = mapFields[textField];
            return this.getValue(path, data);
        }
        return '';
    }
    getHelpControlTextField(col) {
        return col && col.editor && col.editor.options && col.editor.options.textField || '';
    }
    getHelpControlMapFields(col) {
        return col && col.editor && col.editor.options && col.editor.options.mapFields || {};
    }
}
FormatPrimeNgTreeTableCellData.decorators = [
    { type: Pipe, args: [{ name: 'formatPrimeNgTreeTableCellData', pure: false },] }
];
/** @nocollapse */
FormatPrimeNgTreeTableCellData.ctorParameters = () => [
    { type: ColumnFormatService },
    { type: Injector, decorators: [{ type: Optional }] }
];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZm9ybWF0UHJpbWVOZ1RyZWVUYWJsZUNlbGxEYXRhLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy9rZW5kby1iaW5kaW5nLyIsInNvdXJjZXMiOlsibGliL3BpcGVzL2Zvcm1hdFByaW1lTmdUcmVlVGFibGVDZWxsRGF0YS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFDbEQsT0FBTyxFQUFFLElBQUksRUFBaUIsUUFBUSxFQUFFLFFBQVEsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUN4RSxPQUFPLEVBQUUsbUJBQW1CLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQztBQUcvRCxNQUFNLE9BQU8sOEJBQThCO0lBR3pDLFlBQW9CLEdBQXdCLEVBQXNCLFFBQW1CO1FBQWpFLFFBQUcsR0FBSCxHQUFHLENBQXFCO1FBQXNCLGFBQVEsR0FBUixRQUFRLENBQVc7UUFDbkYsSUFBSSxJQUFJLENBQUMsUUFBUSxFQUFFO1lBQ2pCLElBQUksQ0FBQyxhQUFhLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsYUFBYSxDQUFDLENBQUM7U0FDdkQ7SUFDSCxDQUFDO0lBRUQsU0FBUyxDQUFDLEdBQVEsRUFBRSxPQUFZO1FBQzlCLElBQUksS0FBSyxHQUFHLEVBQUUsQ0FBQztRQUNmLElBQUksT0FBTyxJQUFJLEdBQUcsSUFBSSxHQUFHLENBQUMsS0FBSyxFQUFFO1lBQy9CLEtBQUssR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxLQUFLLEVBQUUsT0FBTyxDQUFDLENBQUM7WUFDMUMsSUFBSSxXQUFXLEdBQUcsR0FBRyxDQUFDLFNBQVMsQ0FBQztZQUNoQyxJQUFJLENBQUMsV0FBVyxFQUFFO2dCQUNoQixJQUFJLEdBQUcsQ0FBQyxtQkFBbUIsRUFBRTtvQkFDM0IsT0FBTyxJQUFJLENBQUMscUJBQXFCLENBQUMsS0FBSyxDQUFDLENBQUM7aUJBQzFDO3FCQUFNO29C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QUMsT0FBTyxDQUFDLFNBQVMsSUFBSSxFQUFFLENBQUM7SUFDdkYsQ0FBQzs7O1lBMUVGLElBQUksU0FBQyxFQUFFLElBQUksRUFBRSxnQ0FBZ0MsRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFOzs7O1lBRnBELG1CQUFtQjtZQURFLFFBQVEsdUJBT1csUUFBUSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IExvY2FsZVNlcnZpY2UgfSBmcm9tICdAZmFycmlzL3VpLWxvY2FsZSc7XHJcbmltcG9ydCB7IFBpcGUsIFBpcGVUcmFuc2Zvcm0sIEluamVjdG9yLCBPcHRpb25hbCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBDb2x1bW5Gb3JtYXRTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy91aS1jb21tb24vY29sdW1uJztcclxuXHJcbkBQaXBlKHsgbmFtZTogJ2Zvcm1hdFByaW1lTmdUcmVlVGFibGVDZWxsRGF0YScsIHB1cmU6IGZhbHNlIH0pXHJcbmV4cG9ydCBjbGFzcyBGb3JtYXRQcmltZU5nVHJlZVRhYmxlQ2VsbERhdGEgaW1wbGVtZW50cyBQaXBlVHJhbnNmb3JtIHtcclxuXHJcbiAgcHJpdmF0ZSBsb2NhbGVTZXJ2aWNlOiBMb2NhbGVTZXJ2aWNlO1xyXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgY2ZzOiBDb2x1bW5Gb3JtYXRTZXJ2aWNlLCBAT3B0aW9uYWwoKSBwcml2YXRlIGluamVjdG9yPzogSW5qZWN0b3IpIHtcclxuICAgIGlmICh0aGlzLmluamVjdG9yKSB7XHJcbiAgICAgIHRoaXMubG9jYWxlU2VydmljZSA9IHRoaXMuaW5qZWN0b3IuZ2V0KExvY2FsZVNlcnZpY2UpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgdHJhbnNmb3JtKGNvbDogYW55LCByb3dEYXRhOiBhbnkpOiBhbnkge1xyXG4gICAgbGV0IHZhbHVlID0gJyc7XHJcbiAgICBpZiAocm93RGF0YSAmJiBjb2wgJiYgY29sLmZpZWxkKSB7XHJcbiAgICAgIHZhbHVlID0gdGhpcy5nZXRWYWx1ZShjb2wuZmllbGQsIHJvd0RhdGEpO1xyXG4gICAgICBsZXQgZm9ybWF0dGVyRm4gPSBjb2wuZm9ybWF0dGVyO1xyXG4gICAgICBpZiAoIWZvcm1hdHRlckZuKSB7XHJcbiAgICAgICAgaWYgKGNvbC5pc011bHRpbGluZ3VhbEZpZWxkKSB7XHJcbiAgICAgICAgICByZXR1cm4gdGhpcy5nZXRNdWx0aUxhbmd1YWdlVmFsdWUodmFsdWUpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICByZXR1cm4gdmFsdWU7XHJcbiAgICAgICAgfVxyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmNmcy5mb3JtYXQodmFsdWUsIHJvd0RhdGEsIGZvcm1hdHRlckZuKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuICcnO1xyXG4gIH1cclxuXHJcbiAgLy8g6I635Y+W5aSa6K+t5pWw5o2uXHJcbiAgcHJpdmF0ZSBnZXRNdWx0aUxhbmd1YWdlVmFsdWUodmFsT2JqKSB7XHJcbiAgICBpZiAodmFsT2JqICYmIHR5cGVvZiB2YWxPYmogPT09ICdvYmplY3QnICYmIE9iamVjdC5rZXlzKHZhbE9iaikubGVuZ3RoID4gMCkge1xyXG4gICAgICBjb25zdCBsb2NhbGVJZCA9IHRoaXMubG9jYWxlU2VydmljZSAmJiB0aGlzLmxvY2FsZVNlcnZpY2UubG9jYWxlSWQgfHwgJ3poLUNIUyc7XHJcbiAgICAgIGNvbnN0IHZhbHVlID0gdmFsT2JqW2xvY2FsZUlkXTtcclxuICAgICAgcmV0dXJuIHZhbHVlID09PSB1bmRlZmluZWQgPyAnJyA6IHZhbHVlO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcmV0dXJuICcnO1xyXG4gICAgfVxyXG4gIH1cclxuICBwcml2YXRlIGdldFZhbHVlKHBhdGg6IHN0cmluZywgdGFyZ2V0OiBhbnkpIHtcclxuICAgIGlmICghdGFyZ2V0KSB7XHJcbiAgICAgIHJldHVybiAnJztcclxuICAgIH1cclxuICAgIHZhciByZXN1bHRWYWwgPSAnJztcclxuICAgIGlmIChwYXRoLmluZGV4T2YoJy4nKSA9PT0gLTEpIHtcclxuICAgICAgcmVzdWx0VmFsID0gdGFyZ2V0W3BhdGhdO1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgIHJlc3VsdFZhbCA9IHBhdGguc3BsaXQoJy4nKS5yZWR1Y2UoKChvYmosIGtleSkgPT4ge1xyXG4gICAgICAgIHJldHVybiBvYmogJiYgb2JqW2tleV0gfHwgbnVsbDtcclxuICAgICAgfSksIHRhcmdldCk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gcmVzdWx0VmFsO1xyXG4gIH07XHJcbiAgLyoqXHJcbiAgICog5piv5ZCm5Li65biu5Yqp5YiXXHJcbiAgICogQHBhcmFtIGNvbCBjb2xcclxuICAgKi9cclxuICBwcml2YXRlIGlzSGVscENvbHVtbihjb2w6IGFueSkge1xyXG4gICAgcmV0dXJuIGNvbCAmJiBjb2wuZWRpdG9yICYmIGNvbC5lZGl0b3Iub3B0aW9ucyAmJiBjb2wuZWRpdG9yLm9wdGlvbnMudHlwZSA9PT0gJ0VkaXRvclR5cGVzLkxPT0tVUCcgfHwgZmFsc2U7XHJcbiAgfVxyXG4gIHByaXZhdGUgZ2V0SGVscENvbHVtblZhbHVlKGNvbDogYW55LCBkYXRhOiBhbnkpIHtcclxuICAgIGNvbnN0IHRleHRGaWVsZCA9IHRoaXMuZ2V0SGVscENvbnRyb2xUZXh0RmllbGQoY29sKTtcclxuICAgIGNvbnN0IG1hcEZpZWxkcyA9IHRoaXMuZ2V0SGVscENvbnRyb2xNYXBGaWVsZHMoY29sKTtcclxuICAgIGlmICh0ZXh0RmllbGQgJiYgbWFwRmllbGRzICYmIE9iamVjdC5rZXlzKG1hcEZpZWxkcykubGVuZ3RoID4gMCkge1xyXG4gICAgICBjb25zdCBwYXRoID0gbWFwRmllbGRzW3RleHRGaWVsZF07XHJcbiAgICAgIHJldHVybiB0aGlzLmdldFZhbHVlKHBhdGgsIGRhdGEpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuICcnO1xyXG4gIH1cclxuICBwcml2YXRlIGdldEhlbHBDb250cm9sVGV4dEZpZWxkKGNvbDogYW55KSB7XHJcbiAgICByZXR1cm4gY29sICYmIGNvbC5lZGl0b3IgJiYgY29sLmVkaXRvci5vcHRpb25zICYmIGNvbC5lZGl0b3Iub3B0aW9ucy50ZXh0RmllbGQgfHwgJyc7XHJcbiAgfVxyXG4gIHByaXZhdGUgZ2V0SGVscENvbnRyb2xNYXBGaWVsZHMoY29sOiBhbnkpIHtcclxuICAgIHJldHVybiBjb2wgJiYgY29sLmVkaXRvciAmJiBjb2wuZWRpdG9yLm9wdGlvbnMgJiYgY29sLmVkaXRvci5vcHRpb25zLm1hcEZpZWxkcyB8fCB7fTtcclxuICB9XHJcbn1cclxuIl19
/**
 * 多选列表工具类
 */
export class MultiSelectGridUtility {
    /**
     * 渲染切换行
     */
    static renderClickChangedRow(gridComponent, selectedRowContext) {
        if (!gridComponent) {
            return;
        }
        const currentRowIndex = selectedRowContext.currentRowIndex;
        // 渲染当前行
        this.addRowSelectedStyle(gridComponent, currentRowIndex);
        // 渲染上一行
        const lastRowIndex = selectedRowContext.lastRowIndex;
        if (!this.checIfIsSameRelativeIndex(gridComponent, currentRowIndex, lastRowIndex)) {
            this.removeRowSelectedStyle(gridComponent, lastRowIndex);
        }
    }
    /**
     * 检查当前行索引值和上一个选中行索引值的相对当前页面的索引值是否相同
     */
    static checIfIsSameRelativeIndex(gridComponent, currentRowIndex, lastRowIndex) {
        let isSameRelativeIndex = false;
        if (currentRowIndex === lastRowIndex) {
            isSameRelativeIndex = true;
            return isSameRelativeIndex;
        }
        if ((Math.abs(currentRowIndex - lastRowIndex)) % (gridComponent.pageSize) === 0) {
            isSameRelativeIndex = true;
            return isSameRelativeIndex;
        }
        return isSameRelativeIndex;
    }
    /**
     * 检测是否启用分页功能
     */
    static checkIfEnablePaging(gridComponent) {
        let isPageable = false; // 默认未启用分页
        if (!gridComponent) {
            return isPageable;
        }
        if (typeof gridComponent.pageable === 'boolean') {
            isPageable = gridComponent.pageable;
        }
        else if (typeof gridComponent.pageable === 'object') {
            isPageable = true;
        }
        return isPageable;
    }
    /**
     * 渲染checkbox选择
     */
    static renderSelectedChangeCheckbox(elementRef, $event) {
        const currentRowIndex = $event.index;
        const trCollection = this.getTrCollection(elementRef);
        if (trCollection == null || trCollection.length <= 0 || trCollection.length < currentRowIndex) {
            return;
        }
        // 渲染checked行
        const currentTableRowElement = trCollection[currentRowIndex];
        if (!currentTableRowElement) {
            return;
        }
        if ($event.selected) { // checked
            this.appendAtrributeValue(currentTableRowElement, 'class', this.CHECKBOXED_ROW_STYLE_NAME);
        }
        else { // unchecked
            this.removeAttributeSpecificValue(currentTableRowElement, 'class', this.CHECKBOXED_ROW_STYLE_NAME);
        }
    }
    /**
     * 添加行的“已选中样式”
     * 暂无需求，不对外暴露
     */
    static addRowSelectedStyle(gridComponent, rowIndex) {
        if (!gridComponent || rowIndex < 0) {
            return;
        }
        const currentRowElement = this.getRelativeRowInCurrentPage(gridComponent, rowIndex);
        if (!currentRowElement) {
            return;
        }
        this.appendAtrributeValue(currentRowElement, 'class', this.CURRENT_ROW_STYLE_NAME);
    }
    /**
     * 移除行的“已选中样式”
     * 需求：kendo-grid在分页时，不会移除已选中样式
     */
    static removeRowSelectedStyle(gridComponent, rowIndex) {
        if (!gridComponent || rowIndex < 0) {
            return;
        }
        const currentRowElement = this.getRelativeRowInCurrentPage(gridComponent, rowIndex);
        if (!currentRowElement) {
            return;
        }
        this.removeAttributeSpecificValue(currentRowElement, 'class', this.CURRENT_ROW_STYLE_NAME);
    }
    /**
     * 获取指定行在当前页面对应的行元素
     */
    static getRelativeRowInCurrentPage(gridComponent, rowIndex) {
        let rowElementInCurrentPage = null;
        if (!gridComponent || rowIndex < 0) {
            return rowElementInCurrentPage;
        }
        const gridElement = gridComponent.wrapper;
        // 启用分页后，需要更新当前行
        const isPaging = this.checkIfEnablePaging(gridComponent);
        if (isPaging) {
            rowIndex = rowIndex % (gridComponent.pageSize); // 对pageSize取模
        }
        const trCollection = this.getTrCollection(gridElement);
        if (trCollection == null || trCollection.length <= 0) {
            return rowElementInCurrentPage;
        }
        rowElementInCurrentPage = trCollection[rowIndex];
        return rowElementInCurrentPage;
    }
    /**
     * 获取当前grid的tr集合
     */
    static getTrCollection(elementRef) {
        if (!elementRef || !elementRef.nativeElement) {
            return null;
        }
        const kendoGridTbodyElements = elementRef.nativeElement.getElementsByTagName('tbody');
        if (!kendoGridTbodyElements || kendoGridTbodyElements.length <= 0) {
            return null;
        }
        const trCollection = kendoGridTbodyElements[0].getElementsByTagName('tr');
        return trCollection;
    }
    /**
     * 向元素的指定属性追加值
     */
    static appendAtrributeValue(currentElement, attributeName, attributeValue) {
        let newAttributeValue = currentElement.getAttribute(attributeName);
        if (newAttributeValue === null || newAttributeValue === '' || newAttributeValue.length <= 0) {
            newAttributeValue = attributeValue;
        }
        else {
            if (newAttributeValue.indexOf(attributeValue) < 0) { // 存在检测，避免重复添加
                newAttributeValue += ' ' + attributeValue;
            }
        }
        currentElement.setAttribute(attributeName, newAttributeValue);
    }
    /**
     * 移除元数据指定属性的特性属性值
     */
    static removeAttributeSpecificValue(currentElement, attributeName, needRemoveAttributeValue) {
        let lastClassAttributeValue = currentElement.getAttribute(attributeName);
        if (!lastClassAttributeValue) {
            return;
        }
        const index = lastClassAttributeValue.lastIndexOf(needRemoveAttributeValue);
        if (index < 0) {
            return;
        }
        const tempLastClassAttributeValue = lastClassAttributeValue.substring(0, index - 1);
        lastClassAttributeValue = tempLastClassAttributeValue + ' '
            + lastClassAttributeValue.substring(index + needRemoveAttributeValue.length);
        currentElement.setAttribute(attributeName, lastClassAttributeValue);
    }
}
MultiSelectGridUtility.CURRENT_ROW_STYLE_NAME = 'f-state-selected';
MultiSelectGridUtility.CHECKBOXED_ROW_STYLE_NAME = 'f-state-checked';
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibXVsdGlfc2VsZWN0X2dyaWRfdXRpbGl0eS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMva2VuZG8tYmluZGluZy8iLCJzb3VyY2VzIjpbImxpYi91dGlsL211bHRpX3NlbGVjdF9ncmlkX3V0aWxpdHkudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBSUE7O0dBRUc7QUFDSCxNQUFNLE9BQU8sc0JBQXNCO0lBSWpDOztPQUVHO0lBQ0ksTUFBTSxDQUFDLHFCQUFxQixDQUFDLGFBQTRCLEVBQUUsa0JBQXNDO1FBQ3RHLElBQUksQ0FBQyxhQUFhLEVBQUU7WUFDbEIsT0FBTztTQUNSO1FBRUQsTUFBTSxlQUFlLEdBQUcsa0JBQWtCLENBQUMsZUFBZSxDQUFDO1FBQzNELFFBQVE7UUFDUixJQUFJLENBQUMsbUJBQW1CLENBQUMsYUFBYSxFQUFFLGVBQWUsQ0FBQyxDQUFDO1FBRXpELFFBQVE7UUFDUixNQUFNLFlBQVksR0FBRyxrQkFBa0IsQ0FBQyxZQUFZLENBQUM7UUFDckQsSUFBSSxDQUFDLElBQUksQ0FBQyx5QkFBeUIsQ0FBQyxhQUFhLEVBQUUsZUFBZSxFQUFFLFlBQVksQ0FBQyxFQUFFO1lBQ2pGLElBQUksQ0FBQyxzQkFBc0IsQ0FBQyxhQUFhLEVBQUUsWUFBWSxDQUFDLENBQUM7U0FDMUQ7SUFDSCxDQUFDO0lBRUQ7O09BRUc7SUFDSyxNQUFNLENBQUMseUJBQXlCLENBQUMsYUFBNEIsRUFBRSxlQUF1QixFQUFFLFlBQW9CO1FBQ2xILElBQUksbUJBQW1CLEdBQUcsS0FBSyxDQUFDO1FBQ2hDLElBQUksZUFBZSxLQUFLLFlBQVksRUFBRTtZQUNwQyxtQkFBbUIsR0FBRyxJQUFJLENBQUM7WUFDM0IsT0FBTyxtQkFBbUIsQ0FBQztTQUM1QjtRQUVELElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLGVBQWUsR0FBRyxZQUFZLENBQUMsQ0FBQyxHQUFHLENBQUMsYUFBYSxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsRUFBRTtZQUMvRSxt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R0FBRyxpQkFBaUIsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEVsZW1lbnRSZWYgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgU2VsZWN0ZWRSb3dDb250ZXh0IH0gZnJvbSAnLi4vZW50aXR5L2luZGV4JztcclxuaW1wb3J0IHsgR3JpZENvbXBvbmVudCB9IGZyb20gJ0Bwcm9ncmVzcy9rZW5kby1hbmd1bGFyLWdyaWQnO1xyXG5cclxuLyoqXHJcbiAqIOWkmumAieWIl+ihqOW3peWFt+exu1xyXG4gKi9cclxuZXhwb3J0IGNsYXNzIE11bHRpU2VsZWN0R3JpZFV0aWxpdHkge1xyXG4gIHN0YXRpYyBDVVJSRU5UX1JPV19TVFlMRV9OQU1FID0gJ2Ytc3RhdGUtc2VsZWN0ZWQnO1xyXG4gIHN0YXRpYyBDSEVDS0JPWEVEX1JPV19TVFlMRV9OQU1FID0gJ2Ytc3RhdGUtY2hlY2tlZCc7XHJcblxyXG4gIC8qKlxyXG4gICAqIOa4suafk+WIh+aNouihjFxyXG4gICAqL1xyXG4gIHB1YmxpYyBzdGF0aWMgcmVuZGVyQ2xpY2tDaGFuZ2VkUm93KGdyaWRDb21wb25lbnQ6IEdyaWRDb21wb25lbnQsIHNlbGVjdGVkUm93Q29udGV4dDogU2VsZWN0ZWRSb3dDb250ZXh0KSB7XHJcbiAgICBpZiAoIWdyaWRDb21wb25lbnQpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IGN1cnJlbnRSb3dJbmRleCA9IHNlbGVjdGVkUm93Q29udGV4dC5jdXJyZW50Um93SW5kZXg7XHJcbiAgICAvLyDmuLLmn5PlvZPliY3ooYxcclxuICAgIHRoaXMuYWRkUm93U2VsZWN0ZWRTdHlsZShncmlkQ29tcG9uZW50LCBjdXJyZW50Um93SW5kZXgpO1xyXG5cclxuICAgIC8vIOa4suafk+S4iuS4gOihjFxyXG4gICAgY29uc3QgbGFzdFJvd0luZGV4ID0gc2VsZWN0ZWRSb3dDb250ZXh0Lmxhc3RSb3dJbmRleDtcclxuICAgIGlmICghdGhpcy5jaGVjSWZJc1NhbWVSZWxhdGl2ZUluZGV4KGdyaWRDb21wb25lbnQsIGN1cnJlbnRSb3dJbmRleCwgbGFzdFJvd0luZGV4KSkge1xyXG4gICAgICB0aGlzLnJlbW92ZVJvd1NlbGVjdGVkU3R5bGUoZ3JpZENvbXBvbmVudCwgbGFzdFJvd0luZGV4KTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOajgOafpeW9k+WJjeihjOe0ouW8leWAvOWSjOS4iuS4gOS4qumAieS4reihjOe0ouW8leWAvOeahOebuOWvueW9k+WJjemhtemdoueahOe0ouW8leWAvOaYr+WQpuebuOWQjFxyXG4gICAqL1xyXG4gIHByaXZhdGUgc3RhdGljIGNoZWNJZklzU2FtZVJlbGF0aXZlSW5kZXgoZ3JpZENvbXBvbmVudDogR3JpZENvbXBvbmVudCwgY3VycmVudFJvd0luZGV4OiBudW1iZXIsIGxhc3RSb3dJbmRleDogbnVtYmVyKTogYm9vbGVhbiB7XHJcbiAgICBsZXQgaXNTYW1lUmVsYXRpdmVJbmRleCA9IGZhbHNlO1xyXG4gICAgaWYgKGN1cnJlbnRSb3dJbmRleCA9PT0gbGFzdFJvd0luZGV4KSB7XHJcbiAgICAgIGlzU2FtZVJlbGF0aXZlSW5kZXggPSB0cnVlO1xyXG4gICAgICByZXR1cm4gaXNTYW1lUmVsYXRpdmVJbmRleDtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoKE1hdGguYWJzKGN1cnJlbnRSb3dJbmRleCAtIGxhc3RSb3dJbmRleCkpICUgKGdyaWRDb21wb25lbnQucGFnZVNpemUpID09PSAwKSB7XHJcbiAgICAgIGlzU2FtZVJlbGF0aXZlSW5kZXggPSB0cnVlO1xyXG4gICAgICByZXR1cm4gaXNTYW1lUmVsYXRpdmVJbmRleDtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gaXNTYW1lUmVsYXRpdmVJbmRleDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOajgOa1i+aYr+WQpuWQr+eUqOWIhumhteWKn+iDvVxyXG4gICAqL1xyXG4gIHB1YmxpYyBzdGF0aWMgY2hlY2tJZkVuYWJsZVBhZ2luZyhncmlkQ29tcG9uZW50OiBHcmlkQ29tcG9uZW50KTogYm9vbGVhbiB7XHJcbiAgICBsZXQgaXNQYWdlYWJsZSA9IGZhbHNlOyAvLyDpu5jorqTmnKrlkK/nlKjliIbpobVcclxuICAgIGlmICghZ3JpZENvbXBvbmVudCkge1xyXG4gICAgICByZXR1cm4gaXNQYWdlYWJsZTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAodHlwZW9mIGdyaWRDb21wb25lbnQucGFnZWFibGUgPT09ICdib29sZWFuJykge1xyXG4gICAgICBpc1BhZ2VhYmxlID0gZ3JpZENvbXBvbmVudC5wYWdlYWJsZTtcclxuICAgIH0gZWxzZSBpZiAodHlwZW9mIGdyaWRDb21wb25lbnQucGFnZWFibGUgPT09ICdvYmplY3QnKSB7XHJcbiAgICAgIGlzUGFnZWFibGUgPSB0cnVlO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBpc1BhZ2VhYmxlO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5riy5p+TY2hlY2tib3jpgInmi6lcclxuICAgKi9cclxuICBwdWJsaWMgc3RhdGljIHJlbmRlclNlbGVjdGVkQ2hhbmdlQ2hlY2tib3goZWxlbWVudFJlZjogRWxlbWVudFJlZiwgJGV2ZW50OiBhbnkpIHtcclxuXHJcbiAgICBjb25zdCBjdXJyZW50Um93SW5kZXggPSAkZXZlbnQuaW5kZXg7XHJcblxyXG4gICAgY29uc3QgdHJDb2xsZWN0aW9uID0gdGhpcy5nZXRUckNvbGxlY3Rpb24oZWxlbWVudFJlZik7XHJcbiAgICBpZiAodHJDb2xsZWN0aW9uID09IG51bGwgfHwgdHJDb2xsZWN0aW9uLmxlbmd0aCA8PSAwIHx8IHRyQ29sbGVjdGlvbi5sZW5ndGggPCBjdXJyZW50Um93SW5kZXgpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIOa4suafk2NoZWNrZWTooYxcclxuICAgIGNvbnN0IGN1cnJlbnRUYWJsZVJvd0VsZW1lbnQgPSB0ckNvbGxlY3Rpb25bY3VycmVudFJvd0luZGV4XTtcclxuICAgIGlmICghY3VycmVudFRhYmxlUm93RWxlbWVudCkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKCRldmVudC5zZWxlY3RlZCkgeyAvLyBjaGVja2VkXHJcbiAgICAgIHRoaXMuYXBwZW5kQXRycmlidXRlVmFsdWUoY3VycmVudFRhYmxlUm93RWxlbWVudCwgJ2NsYXNzJywgdGhpcy5DSEVDS0JPWEVEX1JPV19TVFlMRV9OQU1FKTtcclxuICAgIH0gZWxzZSB7IC8vIHVuY2hlY2tlZFxyXG4gICAgICB0aGlzLnJlbW92ZUF0dHJpYnV0ZVNwZWNpZmljVmFsdWUoY3VycmVudFRhYmxlUm93RWxlbWVudCwgJ2NsYXNzJywgdGhpcy5DSEVDS0JPWEVEX1JPV19TVFlMRV9OQU1FKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOa3u+WKoOihjOeahOKAnOW3sumAieS4reagt+W8j+KAnVxyXG4gICAqIOaaguaXoOmcgOaxgu+8jOS4jeWvueWkluaatOmcslxyXG4gICAqL1xyXG4gIHByaXZhdGUgc3RhdGljIGFkZFJvd1NlbGVjdGVkU3R5bGUoZ3JpZENvbXBvbmVudDogR3JpZENvbXBvbmVudCwgcm93SW5kZXg6IG51bWJlcikge1xyXG4gICAgaWYgKCFncmlkQ29tcG9uZW50IHx8IHJvd0luZGV4IDwgMCkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgY3VycmVudFJvd0VsZW1lbnQgPSB0aGlzLmdldFJlbGF0aXZlUm93SW5DdXJyZW50UGFnZShncmlkQ29tcG9uZW50LCByb3dJbmRleCk7XHJcbiAgICBpZiAoIWN1cnJlbnRSb3dFbGVtZW50KSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLmFwcGVuZEF0cnJpYnV0ZVZhbHVlKGN1cnJlbnRSb3dFbGVtZW50LCAnY2xhc3MnLCB0aGlzLkNVUlJFTlRfUk9XX1NUWUxFX05BTUUpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog56e76Zmk6KGM55qE4oCc5bey6YCJ5Lit5qC35byP4oCdXHJcbiAgICog6ZyA5rGC77yaa2VuZG8tZ3JpZOWcqOWIhumhteaXtu+8jOS4jeS8muenu+mZpOW3sumAieS4reagt+W8j1xyXG4gICAqL1xyXG4gIHB1YmxpYyBzdGF0aWMgcmVtb3ZlUm93U2VsZWN0ZWRTdHlsZShncmlkQ29tcG9uZW50OiBHcmlkQ29tcG9uZW50LCByb3dJbmRleDogbnVtYmVyKSB7XHJcbiAgICBpZiAoIWdyaWRDb21wb25lbnQgfHwgcm93SW5kZXggPCAwKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBjdXJyZW50Um93RWxlbWVudCA9IHRoaXMuZ2V0UmVsYXRpdmVSb3dJbkN1cnJlbnRQYWdlKGdyaWRDb21wb25lbnQsIHJvd0luZGV4KTtcclxuICAgIGlmICghY3VycmVudFJvd0VsZW1lbnQpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgdGhpcy5yZW1vdmVBdHRyaWJ1dGVTcGVjaWZpY1ZhbHVlKGN1cnJlbnRSb3dFbGVtZW50LCAnY2xhc3MnLCB0aGlzLkNVUlJFTlRfUk9XX1NUWUxFX05BTUUpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog6I635Y+W5oyH5a6a6KGM5Zyo5b2T5YmN6aG16Z2i5a+55bqU55qE6KGM5YWD57SgXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBzdGF0aWMgZ2V0UmVsYXRpdmVSb3dJbkN1cnJlbnRQYWdlKGdyaWRDb21wb25lbnQ6IEdyaWRDb21wb25lbnQsIHJvd0luZGV4OiBudW1iZXIpOiBhbnkge1xyXG4gICAgbGV0IHJvd0VsZW1lbnRJbkN1cnJlbnRQYWdlOiBhbnkgPSBudWxsO1xyXG4gICAgaWYgKCFncmlkQ29tcG9uZW50IHx8IHJvd0luZGV4IDwgMCkge1xyXG4gICAgICByZXR1cm4gcm93RWxlbWVudEluQ3VycmVudFBhZ2U7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgZ3JpZEVsZW1lbnQgPSBncmlkQ29tcG9uZW50LndyYXBwZXI7XHJcbiAgICAvLyDlkK/nlKjliIbpobXlkI7vvIzpnIDopoHmm7TmlrDlvZPliY3ooYxcclxuICAgIGNvbnN0IGlzUGFnaW5nID0gdGhpcy5jaGVja0lmRW5hYmxlUGFnaW5nKGdyaWRDb21wb25lbnQpO1xyXG4gICAgaWYgKGlzUGFnaW5nKSB7XHJcbiAgICAgIHJvd0luZGV4ID0gcm93SW5kZXggJSAoZ3JpZENvbXBvbmVudC5wYWdlU2l6ZSk7IC8vIOWvuXBhZ2VTaXpl5Y+W5qihXHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgdHJDb2xsZWN0aW9uID0gdGhpcy5nZXRUckNvbGxlY3Rpb24oZ3JpZEVsZW1lbnQpO1xyXG4gICAgaWYgKHRyQ29sbGVjdGlvbiA9PSBudWxsIHx8IHRyQ29sbGVjdGlvbi5sZW5ndGggPD0gMCkge1xyXG4gICAgICByZXR1cm4gcm93RWxlbWVudEluQ3VycmVudFBhZ2U7XHJcbiAgICB9XHJcblxyXG4gICAgcm93RWxlbWVudEluQ3VycmVudFBhZ2UgPSB0ckNvbGxlY3Rpb25bcm93SW5kZXhdO1xyXG5cclxuICAgIHJldHVybiByb3dFbGVtZW50SW5DdXJyZW50UGFnZTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOiOt+WPluW9k+WJjWdyaWTnmoR0cumbhuWQiFxyXG4gICAqL1xyXG4gIHByaXZhdGUgc3RhdGljIGdldFRyQ29sbGVjdGlvbihlbGVtZW50UmVmOiBFbGVtZW50UmVmKTogYW55W10ge1xyXG4gICAgaWYgKCFlbGVtZW50UmVmIHx8ICFlbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQpIHtcclxuICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3Qga2VuZG9HcmlkVGJvZHlFbGVtZW50czogYW55W10gPSBlbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3Rib2R5Jyk7XHJcbiAgICBpZiAoIWtlbmRvR3JpZFRib2R5RWxlbWVudHMgfHwga2VuZG9HcmlkVGJvZHlFbGVtZW50cy5sZW5ndGggPD0gMCkge1xyXG4gICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCB0ckNvbGxlY3Rpb24gPSBrZW5kb0dyaWRUYm9keUVsZW1lbnRzWzBdLmdldEVsZW1lbnRzQnlUYWdOYW1lKCd0cicpO1xyXG4gICAgcmV0dXJuIHRyQ29sbGVjdGlvbjtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOWQkeWFg+e0oOeahOaMh+WumuWxnuaAp+i/veWKoOWAvFxyXG4gICAqL1xyXG4gIHByaXZhdGUgc3RhdGljIGFwcGVuZEF0cnJpYnV0ZVZhbHVlKGN1cnJlbnRFbGVtZW50OiBFbGVtZW50LCBhdHRyaWJ1dGVOYW1lOiBzdHJpbmcsIGF0dHJpYnV0ZVZhbHVlOiBzdHJpbmcpIHtcclxuICAgIGxldCBuZXdBdHRyaWJ1dGVWYWx1ZTogc3RyaW5nID0gY3VycmVudEVsZW1lbnQuZ2V0QXR0cmlidXRlKGF0dHJpYnV0ZU5hbWUpO1xyXG4gICAgaWYgKG5ld0F0dHJpYnV0ZVZhbHVlID09PSBudWxsIHx8IG5ld0F0dHJpYnV0ZVZhbHVlID09PSAnJyB8fCBuZXdBdHRyaWJ1dGVWYWx1ZS5sZW5ndGggPD0gMCkge1xyXG4gICAgICBuZXdBdHRyaWJ1dGVWYWx1ZSA9IGF0dHJpYnV0ZVZhbHVlO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgaWYgKG5ld0F0dHJpYnV0ZVZhbHVlLmluZGV4T2YoYXR0cmlidXRlVmFsdWUpIDwgMCkgeyAvLyDlrZjlnKjmo4DmtYvvvIzpgb/lhY3ph43lpI3mt7vliqBcclxuICAgICAgICBuZXdBdHRyaWJ1dGVWYWx1ZSArPSAnICcgKyBhdHRyaWJ1dGVWYWx1ZTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGN1cnJlbnRFbGVtZW50LnNldEF0dHJpYnV0ZShhdHRyaWJ1dGVOYW1lLCBuZXdBdHRyaWJ1dGVWYWx1ZSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDnp7vpmaTlhYPmlbDmja7mjIflrprlsZ7mgKfnmoTnibnmgKflsZ7mgKflgLxcclxuICAgKi9cclxuICBwcml2YXRlIHN0YXRpYyByZW1vdmVBdHRyaWJ1dGVTcGVjaWZpY1ZhbHVlKGN1cnJlbnRFbGVtZW50OiBFbGVtZW50LCBhdHRyaWJ1dGVOYW1lOiBzdHJpbmcsIG5lZWRSZW1vdmVBdHRyaWJ1dGVWYWx1ZTogc3RyaW5nKSB7XHJcbiAgICBsZXQgbGFzdENsYXNzQXR0cmlidXRlVmFsdWUgPSBjdXJyZW50RWxlbWVudC5nZXRBdHRyaWJ1dGUoYXR0cmlidXRlTmFtZSk7XHJcbiAgICBpZiAoIWxhc3RDbGFzc0F0dHJpYnV0ZVZhbHVlKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBpbmRleCA9IGxhc3RDbGFzc0F0dHJpYnV0ZVZhbHVlLmxhc3RJbmRleE9mKG5lZWRSZW1vdmVBdHRyaWJ1dGVWYWx1ZSk7XHJcbiAgICBpZiAoaW5kZXggPCAwKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCB0ZW1wTGFzdENsYXNzQXR0cmlidXRlVmFsdWUgPSBsYXN0Q2xhc3NBdHRyaWJ1dGVWYWx1ZS5zdWJzdHJpbmcoMCwgaW5kZXggLSAxKTtcclxuICAgIGxhc3RDbGFzc0F0dHJpYnV0ZVZhbHVlID0gdGVtcExhc3RDbGFzc0F0dHJpYnV0ZVZhbHVlICsgJyAnXHJcbiAgICAgICsgbGFzdENsYXNzQXR0cmlidXRlVmFsdWUuc3Vic3RyaW5nKGluZGV4ICsgbmVlZFJlbW92ZUF0dHJpYnV0ZVZhbHVlLmxlbmd0aCk7XHJcblxyXG4gICAgY3VycmVudEVsZW1lbnQuc2V0QXR0cmlidXRlKGF0dHJpYnV0ZU5hbWUsIGxhc3RDbGFzc0F0dHJpYnV0ZVZhbHVlKTtcclxuICB9XHJcbn1cclxuIl19
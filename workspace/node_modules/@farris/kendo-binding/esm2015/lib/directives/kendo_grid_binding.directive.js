import { Directive, Input, HostListener, Optional, EventEmitter, Output, ContentChildren, QueryList, NgZone } from '@angular/core';
import { of } from 'rxjs';
import { GridComponent, DataBindingDirective, SelectionDirective, } from '@progress/kendo-angular-grid';
import { BindingData, ChangeType, FrameEventBus, UIState, Form, ViewModel, ComponentType } from '@farris/devkit';
import { DialogService } from '@farris/ui-dialog';
import { RuntimeStateService } from '@farris/ui-common';
import { DateTimeHelperService } from '@farris/ui-common/date';
import { FarrisKendoGridFormatService } from '../format/index';
import { GridColumnAggregateDirective } from './grid-summary.directive';
import { MultiSelectGridUtility } from '../util/multi_select_grid_utility';
import { SelectedRowContext } from '../entity/index';
/*
 * Kendo Grid 数据绑定指令
 *
 * TODO:
 * 1、整体刷存在性能问题；
 * 2、选中和当前行没有区分开；
 */
export class KendoGridBindingDirective extends DataBindingDirective {
    /**
     * 构造函数
     * @param  grid 宿主Grid
     */
    constructor(bindingData, uiState, eventBus, viewModel, grid, selectionDir, dialogSer, dateService, kendogridFormatSer, rts, ngZone) {
        super(grid);
        this.bindingData = bindingData;
        this.uiState = uiState;
        this.eventBus = eventBus;
        this.viewModel = viewModel;
        this.grid = grid;
        this.selectionDir = selectionDir;
        this.dialogSer = dialogSer;
        this.dateService = dateService;
        this.kendogridFormatSer = kendogridFormatSer;
        this.rts = rts;
        this.ngZone = ngZone;
        /* 行样式事件 */
        // @Input()
        // rowClassName: (context: any) => any;
        // tslint:disable-next-line:no-output-rename
        this.appendRow = new EventEmitter();
        /* 绑定排序事件 */
        this.sortChangeEvent = new EventEmitter();
        /* 行样式事件 */
        this.rowClass = new EventEmitter();
        this.hiddenColLen = 0;
        /**
         * TODO: 从实体获取其默认值
         * 当前行索引值，默认第一个
         */
        this.rowIndex = 0;
        this.columnIndex = 0;
        this.currentSkip = 0;
        /**
         * 是否启用多选，默认未启用
         */
        this.isMultipleSelectionMode = false;
        /**
         * 上一个选中行，默认不存在
         */
        this.lastRowIndex = -1;
        /**
         * 选中行切换事件
         */
        this.selectedRowChange = new EventEmitter();
        /**
         * checkbox选择事件
         */
        this.selectedCheckboxChange = new EventEmitter();
        this.selectionDir.selectedKeys = [];
        this.viewModel.uiState.setPropertyValue('ids', this.selectionDir.selectedKeys);
        const appContext = this.viewModel.frameContext.getFormAppContext();
        if (appContext && appContext.hasOwnProperty('messagePipe')) {
            appContext.messagePipe.subscribe((message) => {
                this.grid.closeCell();
            });
        }
    }
    get gridOption() {
        return this.grid['gridOption'];
    }
    get len() {
        return this.grid.columns.length;
    }
    get IsMultipleSelectionMode() {
        if (!this.grid) {
            return this.isMultipleSelectionMode;
        }
        if (this.grid.selectable) { // 优先尝试从this.grid.selectable获取
            // tslint:disable-next-line: no-string-literal
            if (this.grid.selectable['mode'] === 'multiple') {
                this.isMultipleSelectionMode = true;
            }
            else {
                this.isMultipleSelectionMode = false;
            }
        }
        else {
            if (this.grid.selectableSettings && this.grid.selectableSettings.mode === 'multiple') {
                this.isMultipleSelectionMode = true;
            }
        }
        return this.isMultipleSelectionMode;
    }
    /**
     * 绑定列表(Grid对应数据源)
     */
    get bindingList() {
        // 根实体
        if (this.viewModel.bindingPath === '/' || !this.viewModel.bindingPath) {
            return this.bindingData.list;
        }
        // 子实体
        let bindingPath = this.viewModel.bindingPath.substr(1);
        bindingPath = bindingPath[0].toLowerCase() + bindingPath.substring(1, bindingPath.length);
        const paths = bindingPath.split('/');
        const filteredPaths = paths.filter((part) => {
            return part !== '';
        });
        return this.bindingData.getValue(filteredPaths);
    }
    /**
     * 获取分页信息
     */
    getPagingInfo() {
        const bindingPath = this.viewModel.bindingPath;
        const bindingData = this.viewModel.bindingData;
        let pagingInfo = bindingData.pagingInfo;
        if (bindingPath === '/') {
            return pagingInfo;
        }
        else {
            const bindingPaths = bindingPath.substr(1).split('/').filter(item => !!item && item.length > 0).map(item => {
                return item.substring(0, item.length - 1);
            });
            bindingPaths.forEach(path => {
                pagingInfo = pagingInfo && pagingInfo[path] || {};
            });
            return pagingInfo;
        }
    }
    /**
     * 指令初始化后
     */
    ngOnInit() {
        super.ngOnInit();
        // 初始化state，分组使用。
        this.initDataState();
        this.refreshView();
        if (this.viewModel && this.viewModel.frameContext && this.viewModel.frameContext.frameComponent) {
            this.viewModel.frameContext.frameComponent.componentType = ComponentType.kendoGridComponent;
        }
        // 数据变化
        this.bindingChangeSubscription = this.bindingData.changes.subscribe((change) => {
            this.refreshView(change);
            if (change.type === ChangeType.Load) {
                // load时，在多选模式下，需清空选中集合
                if (this.isMultipleSelectionMode) {
                    const isMatch = this.checkIfChangeMatchBindingPath(change);
                    if (isMatch) {
                        // 清空多选集合
                        this.selectionDir.selectedKeys = [];
                        this.viewModel.uiState.setPropertyValue('ids', this.selectionDir.selectedKeys);
                        this.ngZone.runOutsideAngular(() => {
                            // 渲染初始选中行
                            setTimeout(() => {
                                const rowSelectedContext = new SelectedRowContext();
                                const isPageable = MultiSelectGridUtility.checkIfEnablePaging(this.grid);
                                if (isPageable) {
                                    this.rowIndex = this.grid.skip;
                                }
                                else {
                                    this.rowIndex = 0;
                                }
                                rowSelectedContext.currentRowIndex = this.rowIndex;
                                rowSelectedContext.lastRowIndex = this.lastRowIndex;
                                this.handleSelectedRowChange(rowSelectedContext);
                            }, 300);
                        });
                    }
                }
            }
            // TODO: 使用策略模式重构
            // bindingData 同步 SelectedKeys
            if (change.type === ChangeType.Remove) {
                this.syncDeletedKeys(change.value);
            }
            const isMatch = this.checkIfChangeMatchBindingPath(change);
            if (isMatch) {
                this.handleSelectedKeyChange(this.bindingList.currentId);
            }
            // 渲染当前行
            if (isMatch && this.checkCurrentRowIdExists() && change.type === ChangeType.SelectionChanged && !this.dataId) {
                this.renderCurrentRow(this.bindingList.currentId);
            }
            // tslint:disable-next-line: max-line-length
            // FIXME:需要有重置页码的时机
            /*if ((change.type === ChangeType.SelectionChanged || change.type === ChangeType.GlobalSelectionChanged) && this.currentRowId !== this.bindingList.currentId) {
                this.resetPageInfo();
            }*/
            // 触发变更检测
            if (change.type === ChangeType.Load || change.type === ChangeType.SelectionChanged
                || change.type === ChangeType.Append || change.type === ChangeType.Remove) {
                // 触发变更检测
                if (this.grid && this.grid['changeDetectorRef'] && this.grid['changeDetectorRef']['detectChanges']) {
                    this.grid['changeDetectorRef']['detectChanges']();
                }
            }
        });
        if (this.editable === true && this.form === null) {
            throw Error('启用编辑时，必须指定form');
        }
        if (!this.grid || !this.farrisBindingGridOption || !this.farrisBindingGridOption['fields']) {
            return;
        }
        const gridColumns = this.farrisBindingGridOption['fields'];
        const gridOption = this.farrisBindingGridOption;
        // 判断列中是否存在固定列
        gridOption.lockable = (columns) => {
            return columns.some(ele => {
                return ele.frozen;
            });
        };
        this.rowClass.emit(this.grid);
        // 添加列属性或者方法
        gridColumns.forEach((element) => {
            // 自定义超链
            if (element.linkedLabelEnabled && !element.linkEvent) {
                element.linkEvent = () => {
                    return;
                };
            }
            // 若没有自定义格式化方法  每个列对象绑定格式化方法
            if (!element.getColumnFormat) {
                element.getColumnFormat = (dataItem, column) => {
                    return this.kendogridFormatSer.getColumnFormat(dataItem, column);
                };
            }
            // 如果没有自定义类样式 每个列绑定 格式化方法
            if (!element.getClassName) {
                element.getClassName = (dataItem, column) => '';
            }
            // 自定义帮助前后事件
            if (element.editor && element.editor.type === 'LookupEdit') {
                // 帮助前事件
                if (!element.dictPicking) {
                    element.dictPicking = (param) => {
                        return of(true);
                    };
                }
                // 帮助后事件
                if (!element.dictPicked) {
                    element.dictPicked = (param) => {
                        // 重新进入编辑
                        this.cellClickHandler(this.cellClickParam);
                        return of(true);
                    };
                }
            }
        });
        // 绑定gridOption
        this.bindingGridOption();
        // 多选模式下，设置初始选中行
        if (this.IsMultipleSelectionMode) {
            // TODO: 移除 setTimeout
            const self = this;
            this.ngZone.runOutsideAngular(() => {
                setTimeout(() => {
                    const rowSelectedContext = new SelectedRowContext();
                    rowSelectedContext.currentRowIndex = self.rowIndex;
                    rowSelectedContext.lastRowIndex = self.lastRowIndex;
                    self.handleSelectedRowChange(rowSelectedContext);
                }, 300);
            });
        }
    }
    ngAfterViewInit() {
        // this.gridElement = document.querySelector('.k-grid');
        // // 绑定grid keydown对象的方法
        // this.ngZone.runOutsideAngular(() => {
        //   this.gridKeydownEvent = this.enterCell.bind(this);
        //   this.gridCellClickEvent = this.cellClickHandler.bind(this);
        //   this.gridCellCloseEvent = this.cellCloseHandler.bind(this);
        //   this.gridElement.addEventListener('keydown', this.gridKeydownEvent);
        //   this.gridElement.addEventListener('cellClick', this.gridCellClickEvent);
        //   this.gridElement.addEventListener('cellClose', this.gridCellCloseEvent);
        // });
    }
    /**
     * 检测change的路径和BindingPath是否匹配
     */
    checkIfChangeMatchBindingPath(change) {
        let isMatch = false;
        if (!change || !change.path) {
            return isMatch;
        }
        const changePathArray = change.path;
        if (!changePathArray) {
            return isMatch;
        }
        if (!(this.bindingData) && !(this.bindingData.bindingPath)) {
            return isMatch;
        }
        const bingdingPathArray = this.bindingData.bindingPath.split('/');
        if (bingdingPathArray.length <= 0) {
            return isMatch;
        }
        if (changePathArray.length === 0) { // 主表
            if (this.bindingData.bindingPath === '/') {
                isMatch = true;
            }
        }
        else if (change.path.length === 1) { // 主从表
            if (bingdingPathArray.length === 2 && bingdingPathArray[1] === change.path[0]) {
                isMatch = true;
            }
        }
        else if (change.path.length === 2) { // 主从从表
            if (bingdingPathArray.length === 3 && bingdingPathArray[1] === change.path[0] && bingdingPathArray[2] === change.path[1]) {
                isMatch = true;
            }
        }
        return isMatch;
    }
    /**
     * 处理选中主键变更
     */
    handleSelectedKeyChange(currentId) {
        const selectedKeys = this.selectionDir.selectedKeys;
        if (!currentId) {
            // 如果当前行时null，但selectedKeys里有值，清空并发送一次行切换
            if (selectedKeys.length > 0) {
                const removedSelectedKeys = selectedKeys.splice(0, selectedKeys.length);
                if (removedSelectedKeys.indexOf(null) === -1) {
                    this.emitSelectedRowChange({ currentRowId: null });
                }
            }
            return;
        }
        let oldCurrentRowId = null;
        if (this.IsMultipleSelectionMode) {
            oldCurrentRowId = this.currentRowId;
        }
        else {
            oldCurrentRowId = this.selectionDir.selectedKeys.length === 0
                ? null : this.selectionDir.selectedKeys[0];
        }
        // TODO:if (this.currentRowId !== currentId) {
        if (oldCurrentRowId !== currentId) {
            const selectedRowContext = {};
            selectedRowContext.currentRowId = currentId;
            this.currentRowId = currentId;
            this.emitSelectedRowChange(selectedRowContext);
        }
    }
    /**
     * 发射选中行切换事件
     * @description 统一单选模式和多选模式下的行切换事件
     */
    emitSelectedRowChange(selectedRowContext) {
        if (!this.IsMultipleSelectionMode) { // 向后兼容
            const currentId = selectedRowContext.currentRowId;
            this.selectionDir.selectedKeys = [currentId];
            this.selectionDir.selectedKeysChange.emit(this.selectionDir.selectedKeys);
        }
        this.selectedRowChange.emit(selectedRowContext);
    }
    checkCurrentRowIdExists() {
        let isExist = false;
        if (this.bindingList && this.bindingList.currentId && this.bindingList.currentId.length > 0) {
            isExist = true;
        }
        return isExist;
    }
    /**
     * 同步已删除键到选中集合
     */
    syncDeletedKeys(deletedValueCollection) {
        if (!deletedValueCollection) {
            return;
        }
        deletedValueCollection.forEach((id) => {
            const index = this.selectionDir.selectedKeys.indexOf(id);
            if (index > -1) {
                this.selectionDir.selectedKeys.splice(index, 1);
                // selectedKeys被清空的时候，触发一次行变更
                if (this.selectionDir.selectedKeys.length === 0) {
                    this.emitSelectedRowChange({ currentRowId: null });
                }
            }
        });
    }
    renderCurrentRow(currentId) {
        if (!currentId || currentId === '') { // 不存在当前行
            return;
        }
        // TODO:使用策略模式重构
        if (this.IsMultipleSelectionMode) {
            return;
        }
        this.renderSelectionRow(this.bindingList.currentId, this.selectionDir.selectedKeys);
    }
    /**
     * 指令输入变更处理
     */
    ngOnChanges(changes) {
        super.ngOnChanges(changes);
        this.refreshView();
    }
    /**
     * 指令销毁，注销订阅
     */
    ngOnDestroy() {
        if (this.bindingChangeSubscription) {
            this.bindingChangeSubscription.unsubscribe();
        }
    }
    refreshView(change) {
        // this.bindData();
        this.refreshData(change);
        // 刷新页脚合计信息。客户端合计，暂时放这里，服务端合计时最好从这里移走。by justin
        this.refreshSummary();
    }
    /**
     * 绑定data到宿主grid上
     * @deprecated
     */
    bindData() {
        /*const data = this.bindingList.toJSON();
        let skip = 0;
        if (this.bindingList.pageIndex > 0) {
          skip = (this.bindingList.pageIndex - 1) * this.bindingList.pageSize;
        }
        this.updatePager(this.bindingList.pageSize, skip);
        const processed = process(data, Object.assign({}, this.state, { skip: 0 }));
        processed.total = this.bindingList.total;
        this.grid.data = processed;*/
    }
    refreshData(change) {
        let skip = 0;
        const { pageIndex = 1, pageSize = 0 } = this.getPagingInfo() || {};
        if (pageIndex > 0) {
            skip = (pageIndex - 1) * pageSize;
        }
        this.updatePager(pageSize, skip);
        this.endCellEdit(change);
        this.data = this.bindingList.toJSON({ ignoreMultiLangInput: true });
    }
    /**
     * 退出编辑状态
     * @param change 变更
     */
    endCellEdit(change) {
        const isEditing = this.grid.isEditing;
        if (change && change.type === ChangeType.Load && isEditing) {
            this.grid.cancelCell();
        }
    }
    refreshSummary() {
        if (this.aggrColumns) {
            this.aggrColumns.forEach(aggrCol => {
                if (aggrCol.aggregate) {
                    aggrCol.recalculateSummary(this.bindingList);
                }
            });
        }
    }
    onPageChange(event) {
        const { skip = 0, take = 0 } = event || {};
        // this.bindingList.setPaginationInfo(skip, take);
        this.bindingData.setPagingInfo(skip, take, this.viewModel.bindingPath);
        // 移除选中行样式
        MultiSelectGridUtility.removeRowSelectedStyle(this.grid, this.rowIndex);
    }
    /**
     * 重置grid分页信息
     */
    resetPageInfo() {
        const { pageSize = 0 } = this.getPagingInfo() || {};
        this.bindingData.setPagingInfo(0, pageSize, this.viewModel.bindingPath);
    }
    initDataState() {
        // const groups: GroupDescriptor[] = [];
        // if (this.groupField) {
        //   groups.push({field: this.groupField, aggregates: this.aggregates||[]});
        //   this.grid.group = groups;
        // }
        // this.state = Object.assign(this.state, {group: groups});
        const aggregatesDes = [];
        if (this.groupAggrFields) {
            for (const groupAggrField of this.groupAggrFields) {
                aggregatesDes.push({ field: groupAggrField, aggregate: 'sum' });
            }
        }
        const group = [];
        if (this.groupField) {
            group.push({ field: this.groupField, aggregates: aggregatesDes });
        }
        this.group = group;
    }
    /*
     * @override
     * @param state State
     */
    onStateChange(state) {
        // 说明：pager根据skip计算当前页码。kendo grid内部会在filter state变化时把skip变为0（重置到第一页）。
        // 因此需要重写onStateChange方法，修正skip
        if (state.skip !== this.currentSkip) {
            state.skip = this.currentSkip;
        }
        // 使用kendo默认的处理state的逻辑
        this.applyState(state);
        this.rebind();
    }
    // protected applyState({skip, take, sort, group, filter}: State): void {
    //   this.skip = skip;
    //   this.pageSize = take;
    //   this.sort = sort;
    //   this.group = group;
    //   this.filter = filter;
    // }
    /*
     * @override 服务器端分页取数。process使用的state中skip应为0，否则不显示数据
     * @param state State
     */
    process(state) {
        // if (this.editing) {
        //   state.sort = null;
        // } else {
        //   state.sort = this.originalSort;
        // }
        state.skip = 0;
        const { pageSize = 0, total: totalCount = 0 } = this.getPagingInfo() || {};
        // fix：不启用分页时，take=0导致process不返回数据
        if (state.take === 0) {
            state.take = this.bindingList.length;
        }
        else {
            state.take = pageSize;
        }
        // 编辑模式的判断依据为pageSize小于绑定数据的数量且启用分页
        const isEditMode = state.take < this.bindingList.length;
        if (isEditMode) {
            state.take = this.bindingList.length;
        }
        const processed = super.process(state);
        // fix:数据从无到有时分页不启用
        processed.total = Math.max(totalCount, this.bindingList.length);
        // 分页编辑模式下数据总记录数不能等于真实的数据数据，否则分页工具条就会自动增加分页页签
        if (isEditMode) {
            processed.total = totalCount || 1;
        }
        return processed;
    }
    /*
     * 选中行主键变化处理
     * @param event { SelectionEvent} 选中行变化处理
     */
    selectedKeysChangeHandler(selectedKeys) {
        if (!(this.IsMultipleSelectionMode)) { // 单选模式下
            // 设置BindingData中的当前行
            this.setSelectionIdToBindingData(selectedKeys[selectedKeys.length - 1]);
        }
        this.viewModel.uiState.setPropertyValue('ids', this.selectionDir.selectedKeys); // 更新集合
    }
    /*
     * 处理Grid行切换事件
     * @param event { SelectionEvent} 行切换事件对象
     */
    selectionChangeHandler(event) {
        if (this.IsMultipleSelectionMode) {
            this.handleSelectedCheckboxChange(this.grid.wrapper, event);
        }
    }
    /**
     * 处理checkbox选中事件
     */
    handleSelectedCheckboxChange(elementRef, event) {
        MultiSelectGridUtility.renderSelectedChangeCheckbox(elementRef, event);
        this.selectedCheckboxChange.emit(event);
    }
    /*
     * 单元格点击处理
     * @param event { CellClickEvent } 单元格单击事件对象
     */
    cellClickHandler(event) {
        this.cellClickParam = event;
        this.cellClickEvent = event;
        this.rowIndex = event.rowIndex;
        this.columnIndex = event.columnIndex;
        this.sender = event.sender;
        // 多选模式下，且不分组的情况下，检测行切换
        if (this.IsMultipleSelectionMode && !this.gridOption.groupable) {
            const currentRowIndex = event.rowIndex;
            if (currentRowIndex !== this.lastRowIndex) {
                const rowSelectedContext = new SelectedRowContext();
                rowSelectedContext.currentRowIndex = currentRowIndex;
                rowSelectedContext.lastRowIndex = this.lastRowIndex;
                this.handleSelectedRowChange(rowSelectedContext);
            }
        }
        // 设置实体的当前行
        this.dataId = this.getSelectedIdFromGrid(event.dataItem);
        this.setSelectionIdToBindingData(this.dataId);
        // 若状态机不是可编辑状态 不可编辑
        if (!this.isEditable()) {
            return;
        }
        // 列模板不存在  不可编辑
        if (!event.column.editTemplate) {
            return;
        }
        if (event.type === 'click' && !event.isEdited) {
            // 如果存在显隐状况  确定正确的columnIndex
            const originColums = this.getColumns(this.gridOption.fields);
            const columns = this.getColumns(originColums);
            const currentColumnIndex = columns.findIndex((col) => col.dataField === event.column.field);
            const hiddenColLen = columns.slice(0, currentColumnIndex + 1).filter(col => !col.visible).length;
            // 赋值全局行索引  列索引
            this.rowIndex = event.rowIndex;
            this.columnIndex = event.columnIndex + hiddenColLen;
            this.hiddenColLen = hiddenColLen;
            this.sender = event.sender;
            this.setEditable(this.rowIndex, this.columnIndex);
        }
    }
    /**
     * 处理选中行切换事件
     */
    handleSelectedRowChange(rowSelectedContext) {
        MultiSelectGridUtility.renderClickChangedRow(this.grid, rowSelectedContext);
        this.rowIndex = rowSelectedContext.currentRowIndex;
        this.lastRowIndex = rowSelectedContext.currentRowIndex;
        // 更新当前行
        const id = this.getPrimary(this.rowIndex);
        this.setSelectionIdToBindingData(id);
    }
    /**
     * 获取指定行的主键
     * @param row 行号
     */
    getPrimary(row) {
        let data = this.grid.data;
        if (data && !Array.isArray(data) && data.hasOwnProperty('data')) {
            data = data.data;
        }
        const { pageIndex = 1, pageSize = 0 } = this.getPagingInfo() || {};
        const skip = this.bindingList.skip;
        // 不分页或者第一页时取不需要修改行号
        const rowNumber = pageSize === 0 || pageIndex === 1 ? row : row - skip;
        if (data.length > rowNumber) {
            return data[rowNumber][this.bindingList.primaryKey];
        }
        return null;
    }
    /*
     * 单元格结束编辑处理
     * @param event 单元格结束编辑事件对象
     */
    cellCloseHandler(event) {
        if (this.dialogSer.hasDialogOpened()) {
            event.preventDefault();
            return;
        }
        if (this.rts) {
            // 帮助组件文本变化后去查询
            if (this.rts.getFormState('lookup.pending')) {
                event.preventDefault();
                return;
            }
            // 点击帮助确定可取消按钮后不结束当前单元格编辑
            if (event.originalEvent) {
                if (this.rts.eventPath(event.originalEvent).find(n => n.tagName === 'FARRIS-DIALOG')) {
                    event.preventDefault();
                    return;
                }
            }
        }
        const { formGroup, column, dataItem, rowIndex } = event;
        const columns = this.getColumns(this.gridOption.fields);
        let currentCol = columns.find((element) => {
            return element.dataField === column.field;
        });
        const formControlValue = formGroup[currentCol.editor.binding.path].value;
        if (currentCol.getDynamicData) {
            // 若此列是动态单元格列
            currentCol = currentCol.getDynamicData(dataItem, currentCol);
        }
        this.setValue(formControlValue, currentCol);
    }
    /*
       * 回车  切换单元格
       * @param event 键盘按下事件
       */
    enterCell(e) {
        // 回车键
        if (!e.shiftKey && e.keyCode === 13) {
            // textarea enter 屏蔽换行操作
            e.preventDefault();
            if (!this.sender) {
                return;
            }
            // 由于keydown 事件会先执行，所以这里先要执行blur 事件；
            e.target.blur();
            this.ngZone.runOutsideAngular(() => {
                setTimeout(() => {
                    if (this.rts && this.rts.getFormState('lookup.pending')) {
                        e.preventDefault();
                        return;
                    }
                    this.enterNextCell();
                }, 201);
            });
        }
    }
    /*
       * 绑定grid option
       * @param dataItem 行数据
       */
    bindingGridOption() {
        if (!this.farrisBindingGridOption) {
            return;
        }
        Object.defineProperty(this.grid, 'gridOption', { value: this.farrisBindingGridOption });
    }
    /*
     * 更新Grid分页状态
     * @param take
     * @param skip
     */
    updatePager(take, skip) {
        if (take === 0) {
            this.currentSkip = 0;
            this.pageSize = 0;
            this.skip = 0;
            this.grid.pageable = false;
        }
        else {
            this.currentSkip = skip;
            this.skip = skip;
            this.pageSize = take;
            this.grid.pageable = {
                buttonCount: 10,
                info: true,
                type: 'numeric',
                pageSizes: false,
                previousNext: true
            };
        }
    }
    /*
     * 设置单元格可编辑性
     * @param dataItem 行数据
     * @param column 列对象
     * @param rowIndex 行索引
     * @param columnIndex 列索引
     * @param sender grid实例
     */
    setEditable(rowNumber, columnNumber) {
        const data = this.grid.data['data'];
        const { pageIndex = 1, pageSize = 0 } = this.getPagingInfo() || {};
        const skip = this.bindingList.skip;
        // 不分页或者第一页时取不需要修改行号
        const dataRowNumber = pageSize === 0 || pageIndex === 1 ? rowNumber : rowNumber - skip;
        let item = data[dataRowNumber];
        if (this.gridOption.groupable) {
            item = this.getGroupItem(data, dataRowNumber);
        }
        const originColums = this.getColumns(this.gridOption.fields);
        const columns = this.getColumns(originColums);
        /* 假如列的顺序改变 比如存在固定列  那么应该获取真正的列对象 */
        // let col = columns[columnNumber];
        let tempIndex = columnNumber;
        // 当前列索引不为0
        if (this.grid['gridOption'].showLineNumber) {
            tempIndex = tempIndex - 1;
        }
        if (this.grid.selectable && this.grid.selectable['mode'] === 'multiple') {
            tempIndex = tempIndex - 1;
        }
        const col = columns[tempIndex];
        const params = {
            dataItem: item,
            column: col,
            rowIndex: rowNumber,
            columnIndex: tempIndex,
        };
        // 控制单元格的可编辑性
        if (col && !col.editable) {
            col.editable = (param) => true;
        }
        if (col && this.notReadOnly(col, params)) {
            // 设置当前行
            this.dataId = this.getSelectedIdFromGrid(item);
            this.setSelectionIdToBindingData(this.dataId);
            // const value = this.getValue(item, col.dataField);
            // this.setValue(value, col);
            this.sender.editCell(rowNumber, columnNumber - this.hiddenColLen, this.viewModel.form);
        }
    }
    /*
    获取更新 rowIndex columnIndex
     */
    updateIndex(rowNumber, columnIndex) {
        const newColumnIndex = (columnIndex + 1) % this.len;
        if (!newColumnIndex) {
            const dataLen = this.bindingList.toJSON().length;
            const newRowIndex = (rowNumber + 1) % dataLen;
            return { rowIndex: newRowIndex, columnIndex: newColumnIndex };
        }
        return {
            rowIndex: rowNumber,
            columnIndex: newColumnIndex
        };
    }
    /* 是否只读 */
    notReadOnly(column, param) {
        if (!column) {
            return false;
        }
        return column.editable(param) && !column.editor.readonly;
    }
    /*
       * 给列表赋值 或给formcontrol赋值
        */
    setValue(value, column) {
        const currentColumnType = column.dataType;
        // 同时判断gridOption的列对象
        const bindingData = this.viewModel.bindingData;
        const fieldPaths = this.getFieldPaths(bindingData.bindingPath, column.dataField);
        // 存在行编辑器
        if (currentColumnType === 'date') {
            let dateStr = this.dateService.formatTo(value, 'yyyy-MM-dd HH:mm:ss');
            if (!dateStr) {
                dateStr = '';
            }
            this.viewModel.bindingData.setValue(fieldPaths, dateStr, true, true);
        }
        else {
            this.viewModel.bindingData.setValue(fieldPaths, value, true, true);
        }
    }
    /* 分组时 获取点击行数据 */
    getGroupItem(data, rowNumber) {
        let index = rowNumber;
        for (const i in data) {
            if (index < data[i].items.length) {
                return data[i].items[index];
            }
            else {
                index = index - data[i].items.length;
            }
        }
    }
    /*
     * 获取 单元格值  主从表支持
     * @param dataItem 行数据
     * @param field 字段
     */
    getValue(dataItem, field) {
        const index = field.indexOf('.');
        if (index < 0) {
            return dataItem[field];
        }
        const fields = field.split('.');
        // field字符串组合
        return fields.reduce((result, next) => {
            return result[next];
        }, dataItem);
    }
    /*
    * 获取 bindingData 路径
    * @param bindingPath 当前绑定的字段路径
    * @param fieldName 字段
    */
    getFieldPaths(bindingPath, field) {
        let fieldPath = '';
        if (bindingPath.length > 1) {
            fieldPath = bindingPath.substr(1).replace(/\//g, '.') + '.' + field;
        }
        else {
            fieldPath = field;
        }
        return fieldPath.split('.');
    }
    /**
     * 回车进入下一个单元格
     */
    enterNextCell() {
        const index = this.updateIndex(this.rowIndex, this.columnIndex);
        if (!index.columnIndex && !index.rowIndex) {
            const len = this.bindingList.toJSON().length;
            // 如果存在添加数据的API
            this.appendRow.emit();
            if (this.appendRow.observers && this.appendRow.observers.length) {
                this.interVal = setInterval(() => {
                    if (this.bindingList.toJSON().length - 1 === len) {
                        this.setEditable(this.bindingList.toJSON().length - 1, 0);
                        this.rowIndex = this.bindingList.toJSON().length - 1;
                        this.columnIndex = 0;
                        clearInterval(this.interVal);
                    }
                }, 0);
                return;
            }
        }
        this.setEditable(index.rowIndex, index.columnIndex);
        this.rowIndex = index.rowIndex;
        this.columnIndex = index.columnIndex;
    }
    /* 获取真正的列对象 */
    getColumns(columns) {
        // 判断是否存在固定列
        const hasLocked = columns.some((ele) => {
            return ele.frozen;
        });
        if (hasLocked) {
            const lockedColumns = columns.filter((ele) => {
                return ele.frozen;
            });
            const notLockedColumns = columns.filter((ele) => {
                return !ele.frozen;
            });
            return [...lockedColumns, ...notLockedColumns];
        }
        return columns;
    }
    /*
     * 渲染指定行为选中行：将指定行的key添加到选中行集合中
     */
    renderSelectionRow(key, selectedKeys) {
        if (!key || key === '') {
            return;
        }
        // TODO:使用策略模式重构
        if (this.IsMultipleSelectionMode) {
            const index = selectedKeys.indexOf(key);
            if (index >= 0) {
                return;
            }
            selectedKeys.push(key);
        }
        else {
            if (selectedKeys.length === 1 && selectedKeys[0] === key) {
                return;
            }
            selectedKeys.splice(0, selectedKeys.length);
            selectedKeys.push(key);
        }
        this.selectionDir.selectedKeysChange.emit(selectedKeys); // 手动触发selectedKeysChange事件
    }
    /*
     * 获取Grid上的当前行内码
     * @param dataItem 行数据
     */
    getSelectedIdFromGrid(dataItem) {
        const primaryKey = this.bindingList.primaryKey;
        return dataItem[primaryKey];
    }
    /*
     * 设置BindingList的当前行
     * @param id 当前行内码
     */
    setSelectionIdToBindingData(id) {
        this.bindingList.setCurrentId(id, true);
    }
    /*
    *列表整体是否可编辑
     */
    isEditable() {
        if (this.editable === undefined) {
            if (!this.viewModel.stateMachine) {
                // 状态机不存在的时候
                return false;
            }
            // 状态机存在的时候
            return this.viewModel.stateMachine['editable'];
        }
        // 自定义赋值
        return this.editable;
    }
    /*  */
    isDataChanged() {
        let hasUnsavedData = false;
        const entityArray = this.viewModel.frameContext.repository.entityCollection.toArray();
        for (const entity of entityArray) {
            if (entity.changes.length > 0) {
                hasUnsavedData = true;
                break;
            }
        }
        return hasUnsavedData;
    }
}
KendoGridBindingDirective.decorators = [
    { type: Directive, args: [{
                selector: '[farrisBindingPath]'
            },] }
];
/** @nocollapse */
KendoGridBindingDirective.ctorParameters = () => [
    { type: BindingData },
    { type: UIState, decorators: [{ type: Optional }] },
    { type: FrameEventBus, decorators: [{ type: Optional }] },
    { type: ViewModel, decorators: [{ type: Optional }] },
    { type: GridComponent },
    { type: SelectionDirective },
    { type: DialogService },
    { type: DateTimeHelperService },
    { type: FarrisKendoGridFormatService },
    { type: RuntimeStateService },
    { type: NgZone }
];
KendoGridBindingDirective.propDecorators = {
    editable: [{ type: Input, args: ['farrisEditable',] }],
    form: [{ type: Input, args: ['farrisForm',] }],
    groupField: [{ type: Input, args: ['groupField',] }],
    groupAggrFields: [{ type: Input, args: ['groupAggrFields',] }],
    farrisBindingGridOption: [{ type: Input }],
    rowClassName: [{ type: Input }],
    appendRow: [{ type: Output, args: ['append-row',] }],
    sortChangeEvent: [{ type: Output }],
    rowClass: [{ type: Output }],
    selectedRowChange: [{ type: Output }],
    selectedCheckboxChange: [{ type: Output }],
    aggrColumns: [{ type: ContentChildren, args: [GridColumnAggregateDirective,] }],
    onPageChange: [{ type: HostListener, args: ['pageChange', ['$event'],] }],
    selectedKeysChangeHandler: [{ type: HostListener, args: ['selectedKeysChange', ['$event'],] }],
    selectionChangeHandler: [{ type: HostListener, args: ['selectionChange', ['$event'],] }],
    cellClickHandler: [{ type: HostListener, args: ['cellClick', ['$event'],] }],
    cellCloseHandler: [{ type: HostListener, args: ['cellClose', ['$event'],] }],
    enterCell: [{ type: HostListener, args: ['keydown', ['$event'],] }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoia2VuZG9fZ3JpZF9iaW5kaW5nLmRpcmVjdGl2ZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMva2VuZG8tYmluZGluZy8iLCJzb3VyY2VzIjpbImxpYi9kaXJlY3RpdmVzL2tlbmRvX2dyaWRfYmluZGluZy5kaXJlY3RpdmUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUNMLFNBQVMsRUFBK0MsS0FBSyxFQUFFLFlBQVksRUFBRSxRQUFRLEVBQ3JGLFlBQVksRUFBRSxNQUFNLEVBQWMsZUFBZSxFQUFFLFNBQVMsRUFBRSxNQUFNLEVBQ3JFLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBRSxFQUFFLEVBQWdCLE1BQU0sTUFBTSxDQUFDO0FBQ3hDLE9BQU8sRUFDTCxhQUFhLEVBQUUsb0JBQW9CLEVBQ25DLGtCQUFrQixHQUduQixNQUFNLDhCQUE4QixDQUFDO0FBRXRDLE9BQU8sRUFDTCxXQUFXLEVBQXVCLFVBQVUsRUFDNUMsYUFBYSxFQUFFLE9BQU8sRUFBRSxJQUFJLEVBQUUsU0FBUyxFQUFFLGFBQWEsRUFDdkQsTUFBTSxnQkFBZ0IsQ0FBQztBQUN4QixPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFDbEQsT0FBTyxFQUFFLG1CQUFtQixFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFDeEQsT0FBTyxFQUFFLHFCQUFxQixFQUFFLE1BQU0sd0JBQXdCLENBQUM7QUFDL0QsT0FBTyxFQUFFLDRCQUE0QixFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFDL0QsT0FBTyxFQUFFLDRCQUE0QixFQUFFLE1BQU0sMEJBQTBCLENBQUM7QUFDeEUsT0FBTyxFQUFFLHNCQUFzQixFQUFFLE1BQU0sbUNBQW1DLENBQUM7QUFDM0UsT0FBTyxFQUFFLGtCQUFrQixFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFFckQ7Ozs7OztHQU1HO0FBS0gsTUFBTSxPQUFPLHlCQUEwQixTQUFRLG9CQUFvQjtJQW1LakU7OztPQUdHO0lB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QyxpQkFBaUI7c0NBSXZCLEtBQUs7MkJBSUwsS0FBSzt3QkFPTCxNQUFNLFNBQUMsWUFBWTs4QkFHbkIsTUFBTTt1QkFHTixNQUFNO2dDQXlFTixNQUFNO3FDQUtOLE1BQU07MEJBd0NOLGVBQWUsU0FBQyw0QkFBNEI7MkJBNFk1QyxZQUFZLFNBQUMsWUFBWSxFQUFFLENBQUMsUUFBUSxDQUFDO3dDQW9HckMsWUFBWSxTQUFDLG9CQUFvQixFQUFFLENBQUMsUUFBUSxDQUFDO3FDQWM3QyxZQUFZLFNBQUMsaUJBQWlCLEVBQUUsQ0FBQyxRQUFRLENBQUM7K0JBbUIxQyxZQUFZLFNBQUMsV0FBVyxFQUFFLENBQUMsUUFBUSxDQUFDOytCQXlGcEMsWUFBWSxTQUFDLFdBQVcsRUFBRSxDQUFDLFFBQVEsQ0FBQzt3QkEwQ3BDLFlBQVksU0FBQyxTQUFTLEVBQUUsQ0FBQyxRQUFRLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xyXG4gIERpcmVjdGl2ZSwgT25Jbml0LCBPbkNoYW5nZXMsIE9uRGVzdHJveSwgU2ltcGxlQ2hhbmdlcywgSW5wdXQsIEhvc3RMaXN0ZW5lciwgT3B0aW9uYWwsXHJcbiAgRXZlbnRFbWl0dGVyLCBPdXRwdXQsIEVsZW1lbnRSZWYsIENvbnRlbnRDaGlsZHJlbiwgUXVlcnlMaXN0LCBOZ1pvbmUsIEFmdGVyVmlld0luaXRcclxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgb2YsIFN1YnNjcmlwdGlvbiB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQge1xyXG4gIEdyaWRDb21wb25lbnQsIERhdGFCaW5kaW5nRGlyZWN0aXZlLFxyXG4gIFNlbGVjdGlvbkRpcmVjdGl2ZSxcclxuICBDZWxsQ2xpY2tFdmVudCxcclxuICBEYXRhU3RhdGVDaGFuZ2VFdmVudCwgR3JpZERhdGFSZXN1bHQsIFBhZ2VDaGFuZ2VFdmVudCwgU29ydFNldHRpbmdzLFxyXG59IGZyb20gJ0Bwcm9ncmVzcy9rZW5kby1hbmd1bGFyLWdyaWQnO1xyXG5pbXBvcnQgeyBwcm9jZXNzLCBHcm91cERlc2NyaXB0b3IsIEFnZ3JlZ2F0ZURlc2NyaXB0b3IsIFN0YXRlLCBGaWx0ZXJEZXNjcmlwdG9yLCBTb3J0RGVzY3JpcHRvciB9IGZyb20gJ0Bwcm9ncmVzcy9rZW5kby1kYXRhLXF1ZXJ5JztcclxuaW1wb3J0IHtcclxuICBCaW5kaW5nRGF0YSwgQmluZGluZ0xpc3QsIENoYW5nZSwgQ2hhbmdlVHlwZSxcclxuICBGcmFtZUV2ZW50QnVzLCBVSVN0YXRlLCBGb3JtLCBWaWV3TW9kZWwsIENvbXBvbmVudFR5cGVcclxufSBmcm9tICdAZmFycmlzL2RldmtpdCc7XHJcbmltcG9ydCB7IERpYWxvZ1NlcnZpY2UgfSBmcm9tICdAZmFycmlzL3VpLWRpYWxvZyc7XHJcbmltcG9ydCB7IFJ1bnRpbWVTdGF0ZVNlcnZpY2UgfSBmcm9tICdAZmFycmlzL3VpLWNvbW1vbic7XHJcbmltcG9ydCB7IERhdGVUaW1lSGVscGVyU2VydmljZSB9IGZyb20gJ0BmYXJyaXMvdWktY29tbW9uL2RhdGUnO1xyXG5pbXBvcnQgeyBGYXJyaXNLZW5kb0dyaWRGb3JtYXRTZXJ2aWNlIH0gZnJvbSAnLi4vZm9ybWF0L2luZGV4JztcclxuaW1wb3J0IHsgR3JpZENvbHVtbkFnZ3JlZ2F0ZURpcmVjdGl2ZSB9IGZyb20gJy4vZ3JpZC1zdW1tYXJ5LmRpcmVjdGl2ZSc7XHJcbmltcG9ydCB7IE11bHRpU2VsZWN0R3JpZFV0aWxpdHkgfSBmcm9tICcuLi91dGlsL211bHRpX3NlbGVjdF9ncmlkX3V0aWxpdHknO1xyXG5pbXBvcnQgeyBTZWxlY3RlZFJvd0NvbnRleHQgfSBmcm9tICcuLi9lbnRpdHkvaW5kZXgnO1xyXG5cclxuLypcclxuICogS2VuZG8gR3JpZCDmlbDmja7nu5HlrprmjIfku6RcclxuICpcclxuICogVE9ETzpcclxuICogMeOAgeaVtOS9k+WIt+WtmOWcqOaAp+iDvemXrumimO+8m1xyXG4gKiAy44CB6YCJ5Lit5ZKM5b2T5YmN6KGM5rKh5pyJ5Yy65YiG5byA77ybXHJcbiAqL1xyXG5cclxuQERpcmVjdGl2ZSh7XHJcbiAgc2VsZWN0b3I6ICdbZmFycmlzQmluZGluZ1BhdGhdJ1xyXG59KVxyXG5leHBvcnQgY2xhc3MgS2VuZG9HcmlkQmluZGluZ0RpcmVjdGl2ZSBleHRlbmRzIERhdGFCaW5kaW5nRGlyZWN0aXZlIGltcGxlbWVudHMgT25Jbml0LCBBZnRlclZpZXdJbml0LCBPbkNoYW5nZXMsIE9uRGVzdHJveSB7XHJcblxyXG4gIC8qKlxyXG4gICAqIOaYr+WQpuWFgeiuuOe8lui+kVxyXG4gICAqIOm7mOiupOWPr+e8lui+kSAg5Zug5Li65pyJ5om56YeP57yW6L6R5YiX6KGoXHJcbiAgICovXHJcbiAgQElucHV0KCdmYXJyaXNFZGl0YWJsZScpXHJcbiAgcHVibGljIGVkaXRhYmxlOiBib29sZWFuO1xyXG5cclxuICAvKipcclxuICAgKiDnvJbovpHml7bnu5HlrprnmoTooajljZVcclxuICAgKi9cclxuICBASW5wdXQoJ2ZhcnJpc0Zvcm0nKVxyXG4gIHB1YmxpYyBmb3JtOiBGb3JtO1xyXG5cclxuICAvKipcclxuICAgKiDliIbnu4TliJdcclxuICAgKi9cclxuICBASW5wdXQoJ2dyb3VwRmllbGQnKVxyXG4gIHB1YmxpYyBncm91cEZpZWxkOiBzdHJpbmc7XHJcblxyXG4gIEBJbnB1dCgnZ3JvdXBBZ2dyRmllbGRzJylcclxuICBwdWJsaWMgZ3JvdXBBZ2dyRmllbGRzOiBzdHJpbmdbXTtcclxuXHJcbiAgLyog57uR5a6aZ3JpZCBvcHRpb24gKi9cclxuICBASW5wdXQoKVxyXG4gIHB1YmxpYyBmYXJyaXNCaW5kaW5nR3JpZE9wdGlvbjogYW55O1xyXG5cclxuICAvKiDlhbzlrrlyb3dDbGFzcyDov5jmsqHliKDpmaQgKi9cclxuICBASW5wdXQoKVxyXG4gIHJvd0NsYXNzTmFtZTogYW55O1xyXG4gIC8qIOihjOagt+W8j+S6i+S7tiAqL1xyXG4gIC8vIEBJbnB1dCgpXHJcbiAgLy8gcm93Q2xhc3NOYW1lOiAoY29udGV4dDogYW55KSA9PiBhbnk7XHJcblxyXG4gIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpuby1vdXRwdXQtcmVuYW1lXHJcbiAgQE91dHB1dCgnYXBwZW5kLXJvdycpIGFwcGVuZFJvdyA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xyXG5cclxuICAvKiDnu5HlrprmjpLluo/kuovku7YgKi9cclxuICBAT3V0cHV0KCkgc29ydENoYW5nZUV2ZW50OiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xyXG5cclxuICAvKiDooYzmoLflvI/kuovku7YgKi9cclxuICBAT3V0cHV0KClcclxuICByb3dDbGFzczogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcclxuXHJcblxyXG4gIGdldCBncmlkT3B0aW9uKCkge1xyXG4gICAgcmV0dXJuIHRoaXMuZ3JpZFsnZ3JpZE9wdGlvbiddO1xyXG4gIH1cclxuICBnZXQgbGVuKCkge1xyXG4gICAgcmV0dXJuIHRoaXMuZ3JpZC5jb2x1bW5zLmxlbmd0aDtcclxuICB9XHJcblxyXG4gIGRhdGFJdGVtOiBhbnk7XHJcblxyXG4gIC8qIGtleWRvd27nu5Hlrprkuovku7blr7nosaEgKi9cclxuICBncmlkRWxlbWVudDogYW55O1xyXG4gIGdyaWRLZXlkb3duRXZlbnQ6IGFueTtcclxuXHJcbiAgLyogY2VsbGNsaWNr5LqL5Lu25a+56LGhICovXHJcbiAgZ3JpZENlbGxDbGlja0V2ZW50OiBhbnk7XHJcblxyXG4gIC8qIGNlbGxDbG9zZeS6i+S7tuWvueixoSAqL1xyXG4gIGdyaWRDZWxsQ2xvc2VFdmVudDogYW55O1xyXG5cclxuXHJcbiAgY2VsbENsaWNrRXZlbnQ6IENlbGxDbGlja0V2ZW50O1xyXG5cclxuICBoaWRkZW5Db2xMZW4gPSAwO1xyXG4gIC8qKlxyXG4gICAqIFRPRE86IOS7juWunuS9k+iOt+WPluWFtum7mOiupOWAvFxyXG4gICAqIOW9k+WJjeihjOe0ouW8leWAvO+8jOm7mOiupOesrOS4gOS4qlxyXG4gICAqL1xyXG4gIHJvd0luZGV4ID0gMDtcclxuICBjb2x1bW5JbmRleCA9IDA7XHJcbiAgc2VuZGVyOiBhbnk7XHJcbiAgaW50ZXJWYWw6IGFueTtcclxuICBkYXRhSWQ6IGFueTtcclxuICBjdXJyZW50U2tpcCA9IDA7XHJcbiAgcHJpdmF0ZSBjdXJyZW50Um93SWQ6IHN0cmluZztcclxuXHJcbiAgY2VsbENsaWNrUGFyYW06IENlbGxDbGlja0V2ZW50O1xyXG4gIC8qKlxyXG4gICAqIOaYr+WQpuWQr+eUqOWkmumAie+8jOm7mOiupOacquWQr+eUqFxyXG4gICAqL1xyXG4gIHByaXZhdGUgaXNNdWx0aXBsZVNlbGVjdGlvbk1vZGUgPSBmYWxzZTtcclxuICBwdWJsaWMgZ2V0IElzTXVsdGlwbGVTZWxlY3Rpb25Nb2RlKCkge1xyXG4gICAgaWYgKCF0aGlzLmdyaWQpIHtcclxuICAgICAgcmV0dXJuIHRoaXMuaXNNdWx0aXBsZVNlbGVjdGlvbk1vZGU7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHRoaXMuZ3JpZC5zZWxlY3RhYmxlKSB7IC8vIOS8mOWFiOWwneivleS7jnRoaXMuZ3JpZC5zZWxlY3RhYmxl6I635Y+WXHJcbiAgICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTogbm8tc3RyaW5nLWxpdGVyYWxcclxuICAgICAgaWYgKHRoaXMuZ3JpZC5zZWxlY3RhYmxlWydtb2RlJ10gPT09ICdtdWx0aXBsZScpIHtcclxuICAgICAgICB0aGlzLmlzTXVsdGlwbGVTZWxlY3Rpb25Nb2RlID0gdHJ1ZTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICB0aGlzLmlzTXVsdGlwbGVTZWxlY3Rpb25Nb2RlID0gZmFsc2U7XHJcbiAgICAgIH1cclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGlmICh0aGlzLmdyaWQuc2VsZWN0YWJsZVNldHRpbmdzICYmIHRoaXMuZ3JpZC5zZWxlY3RhYmxlU2V0dGluZ3MubW9kZSA9PT0gJ211bHRpcGxlJykge1xyXG4gICAgICAgIHRoaXMuaXNNdWx0aXBsZVNlbGVjdGlvbk1vZGUgPSB0cnVlO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHRoaXMuaXNNdWx0aXBsZVNlbGVjdGlvbk1vZGU7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDkuIrkuIDkuKrpgInkuK3ooYzvvIzpu5jorqTkuI3lrZjlnKhcclxuICAgKi9cclxuICBwdWJsaWMgbGFzdFJvd0luZGV4ID0gLTE7XHJcblxyXG4gIC8qKlxyXG4gICAqIOmAieS4reihjOWIh+aNouS6i+S7tlxyXG4gICAqL1xyXG4gIEBPdXRwdXQoKSBzZWxlY3RlZFJvd0NoYW5nZTogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcclxuXHJcbiAgLyoqXHJcbiAgICogY2hlY2tib3jpgInmi6nkuovku7ZcclxuICAgKi9cclxuICBAT3V0cHV0KCkgc2VsZWN0ZWRDaGVja2JveENoYW5nZTogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcclxuXHJcbiAgLyoqXHJcbiAgICog57uR5a6a5YiX6KGoKEdyaWTlr7nlupTmlbDmja7mupApXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBnZXQgYmluZGluZ0xpc3QoKTogQmluZGluZ0xpc3Qge1xyXG4gICAgLy8g5qC55a6e5L2TXHJcbiAgICBpZiAodGhpcy52aWV3TW9kZWwuYmluZGluZ1BhdGggPT09ICcvJyB8fCAhdGhpcy52aWV3TW9kZWwuYmluZGluZ1BhdGgpIHtcclxuICAgICAgcmV0dXJuIHRoaXMuYmluZGluZ0RhdGEubGlzdDtcclxuICAgIH1cclxuICAgIC8vIOWtkOWunuS9k1xyXG4gICAgbGV0IGJpbmRpbmdQYXRoID0gdGhpcy52aWV3TW9kZWwuYmluZGluZ1BhdGguc3Vic3RyKDEpO1xyXG4gICAgYmluZGluZ1BhdGggPSBiaW5kaW5nUGF0aFswXS50b0xvd2VyQ2FzZSgpICsgYmluZGluZ1BhdGguc3Vic3RyaW5nKDEsIGJpbmRpbmdQYXRoLmxlbmd0aCk7XHJcbiAgICBjb25zdCBwYXRocyA9IGJpbmRpbmdQYXRoLnNwbGl0KCcvJyk7XHJcblxyXG4gICAgY29uc3QgZmlsdGVyZWRQYXRocyA9IHBhdGhzLmZpbHRlcigocGFydDogc3RyaW5nKSA9PiB7XHJcbiAgICAgIHJldHVybiBwYXJ0ICE9PSAnJztcclxuICAgIH0pO1xyXG4gICAgcmV0dXJuIHRoaXMuYmluZGluZ0RhdGEuZ2V0VmFsdWUoZmlsdGVyZWRQYXRocyk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOiOt+WPluWIhumhteS/oeaBr1xyXG4gICAqL1xyXG4gIHByaXZhdGUgZ2V0UGFnaW5nSW5mbygpIHtcclxuICAgIGNvbnN0IGJpbmRpbmdQYXRoID0gdGhpcy52aWV3TW9kZWwuYmluZGluZ1BhdGg7XHJcbiAgICBjb25zdCBiaW5kaW5nRGF0YSA9IHRoaXMudmlld01vZGVsLmJpbmRpbmdEYXRhO1xyXG4gICAgbGV0IHBhZ2luZ0luZm8gPSBiaW5kaW5nRGF0YS5wYWdpbmdJbmZvO1xyXG4gICAgaWYgKGJpbmRpbmdQYXRoID09PSAnLycpIHtcclxuICAgICAgcmV0dXJuIHBhZ2luZ0luZm87XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBjb25zdCBiaW5kaW5nUGF0aHMgPSBiaW5kaW5nUGF0aC5zdWJzdHIoMSkuc3BsaXQoJy8nKS5maWx0ZXIoaXRlbSA9PiAhIWl0ZW0gJiYgaXRlbS5sZW5ndGggPiAwKS5tYXAoaXRlbSA9PiB7XHJcbiAgICAgICAgcmV0dXJuIGl0ZW0uc3Vic3RyaW5nKDAsIGl0ZW0ubGVuZ3RoIC0gMSk7XHJcbiAgICAgIH0pO1xyXG4gICAgICBiaW5kaW5nUGF0aHMuZm9yRWFjaChwYXRoID0+IHtcclxuICAgICAgICBwYWdpbmdJbmZvID0gcGFnaW5nSW5mbyAmJiBwYWdpbmdJbmZvW3BhdGhdIHx8IHt9O1xyXG4gICAgICB9KTtcclxuICAgICAgcmV0dXJuIHBhZ2luZ0luZm87XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBAQ29udGVudENoaWxkcmVuKEdyaWRDb2x1bW5BZ2dyZWdhdGVEaXJlY3RpdmUpIHByaXZhdGUgYWdnckNvbHVtbnM6IFF1ZXJ5TGlzdDxHcmlkQ29sdW1uQWdncmVnYXRlRGlyZWN0aXZlPjtcclxuICBwcml2YXRlIGJpbmRpbmdDaGFuZ2VTdWJzY3JpcHRpb246IFN1YnNjcmlwdGlvbjtcclxuXHJcbiAgLyoqXHJcbiAgICog5p6E6YCg5Ye95pWwXHJcbiAgICogQHBhcmFtICBncmlkIOWuv+S4u0dyaWRcclxuICAgKi9cclxuICBjb25zdHJ1Y3RvcihcclxuICAgIHB1YmxpYyBiaW5kaW5nRGF0YTogQmluZGluZ0RhdGEsXHJcbiAgICBAT3B0aW9uYWwoKSBwdWJsaWMgdWlTdGF0ZTogVUlTdGF0ZSxcclxuICAgIEBPcHRpb25hbCgpIHB1YmxpYyBldmVudEJ1czogRnJhbWVFdmVudEJ1cyxcclxuICAgIEBPcHRpb25hbCgpIHB1YmxpYyB2aWV3TW9kZWw6IFZpZXdNb2RlbCxcclxuICAgIHB1YmxpYyBncmlkOiBHcmlkQ29tcG9uZW50LFxyXG4gICAgcHVibGljIHNlbGVjdGlvbkRpcjogU2VsZWN0aW9uRGlyZWN0aXZlLFxyXG4gICAgcHVibGljIGRpYWxvZ1NlcjogRGlhbG9nU2VydmljZSxcclxuICAgIHByaXZhdGUgZGF0ZVNlcnZpY2U6IERhdGVUaW1lSGVscGVyU2VydmljZSxcclxuICAgIHByaXZhdGUga2VuZG9ncmlkRm9ybWF0U2VyOiBGYXJyaXNLZW5kb0dyaWRGb3JtYXRTZXJ2aWNlLFxyXG4gICAgcHJpdmF0ZSBydHM6IFJ1bnRpbWVTdGF0ZVNlcnZpY2UsXHJcbiAgICBwdWJsaWMgbmdab25lOiBOZ1pvbmVcclxuICApIHtcclxuICAgIHN1cGVyKGdyaWQpO1xyXG5cclxuICAgIHRoaXMuc2VsZWN0aW9uRGlyLnNlbGVjdGVkS2V5cyA9IFtdO1xyXG4gICAgdGhpcy52aWV3TW9kZWwudWlTdGF0ZS5zZXRQcm9wZXJ0eVZhbHVlKCdpZHMnLCB0aGlzLnNlbGVjdGlvbkRpci5zZWxlY3RlZEtleXMpO1xyXG4gICAgY29uc3QgYXBwQ29udGV4dCA9IHRoaXMudmlld01vZGVsLmZyYW1lQ29udGV4dC5nZXRGb3JtQXBwQ29udGV4dCgpO1xyXG4gICAgaWYgKGFwcENvbnRleHQgJiYgYXBwQ29udGV4dC5oYXNPd25Qcm9wZXJ0eSgnbWVzc2FnZVBpcGUnKSkge1xyXG4gICAgICBhcHBDb250ZXh0Lm1lc3NhZ2VQaXBlLnN1YnNjcmliZSgobWVzc2FnZTogYW55KSA9PiB7XHJcbiAgICAgICAgdGhpcy5ncmlkLmNsb3NlQ2VsbCgpO1xyXG4gICAgICB9KTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOaMh+S7pOWIneWni+WMluWQjlxyXG4gICAqL1xyXG4gIG5nT25Jbml0KCkge1xyXG4gICAgc3VwZXIubmdPbkluaXQoKTtcclxuXHJcbiAgICAvLyDliJ3lp4vljJZzdGF0Ze+8jOWIhue7hOS9v+eUqOOAglxyXG4gICAgdGhpcy5pbml0RGF0YVN0YXRlKCk7XHJcblxyXG4gICAgdGhpcy5yZWZyZXNoVmlldygpO1xyXG4gICAgaWYgKHRoaXMudmlld01vZGVsICYmIHRoaXMudmlld01vZGVsLmZyYW1lQ29udGV4dCAmJiB0aGlzLnZpZXdNb2RlbC5mcmFtZUNvbnRleHQuZnJhbWVDb21wb25lbnQpIHtcclxuICAgICAgdGhpcy52aWV3TW9kZWwuZnJhbWVDb250ZXh0LmZyYW1lQ29tcG9uZW50LmNvbXBvbmVudFR5cGUgPSBDb21wb25lbnRUeXBlLmtlbmRvR3JpZENvbXBvbmVudDtcclxuICAgIH1cclxuICAgIC8vIOaVsOaNruWPmOWMllxyXG4gICAgdGhpcy5iaW5kaW5nQ2hhbmdlU3Vic2NyaXB0aW9uID0gdGhpcy5iaW5kaW5nRGF0YS5jaGFuZ2VzLnN1YnNjcmliZSgoY2hhbmdlOiBDaGFuZ2UpID0+IHtcclxuICAgICAgdGhpcy5yZWZyZXNoVmlldyhjaGFuZ2UpO1xyXG5cclxuICAgICAgaWYgKGNoYW5nZS50eXBlID09PSBDaGFuZ2VUeXBlLkxvYWQpIHtcclxuICAgICAgICAvLyBsb2Fk5pe277yM5Zyo5aSa6YCJ5qih5byP5LiL77yM6ZyA5riF56m66YCJ5Lit6ZuG5ZCIXHJcbiAgICAgICAgaWYgKHRoaXMuaXNNdWx0aXBsZVNlbGVjdGlvbk1vZGUpIHtcclxuICAgICAgICAgIGNvbnN0IGlzTWF0Y2ggPSB0aGlzLmNoZWNrSWZDaGFuZ2VNYXRjaEJpbmRpbmdQYXRoKGNoYW5nZSk7XHJcbiAgICAgICAgICBpZiAoaXNNYXRjaCkge1xyXG4gICAgICAgICAgICAvLyDmuIXnqbrlpJrpgInpm4blkIhcclxuICAgICAgICAgICAgdGhpcy5zZWxlY3Rpb25EaXIuc2VsZWN0ZWRLZXlzID0gW107XHJcbiAgICAgICAgICAgIHRoaXMudmlld01vZGVsLnVpU3RhdGUuc2V0UHJvcGVydHlWYWx1ZSgnaWRzJywgdGhpcy5zZWxlY3Rpb25EaXIuc2VsZWN0ZWRLZXlzKTtcclxuICAgICAgICAgICAgdGhpcy5uZ1pvbmUucnVuT3V0c2lkZUFuZ3VsYXIoKCkgPT4ge1xyXG4gICAgICAgICAgICAgIC8vIOa4suafk+WIneWni+mAieS4reihjFxyXG4gICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgY29uc3Qgcm93U2VsZWN0ZWRDb250ZXh0OiBTZWxlY3RlZFJvd0NvbnRleHQgPSBuZXcgU2VsZWN0ZWRSb3dDb250ZXh0KCk7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBpc1BhZ2VhYmxlID0gTXVsdGlTZWxlY3RHcmlkVXRpbGl0eS5jaGVja0lmRW5hYmxlUGFnaW5nKHRoaXMuZ3JpZCk7XHJcbiAgICAgICAgICAgICAgICBpZiAoaXNQYWdlYWJsZSkge1xyXG4gICAgICAgICAgICAgICAgICB0aGlzLnJvd0luZGV4ID0gdGhpcy5ncmlkLnNraXA7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICB0aGlzLnJvd0luZGV4ID0gMDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHJvd1NlbGVjdGVkQ29udGV4dC5jdXJyZW50Um93SW5kZXggPSB0aGlzLnJvd0luZGV4O1xyXG4gICAgICAgICAgICAgICAgcm93U2VsZWN0ZWRDb250ZXh0Lmxhc3RSb3dJbmRleCA9IHRoaXMubGFzdFJvd0luZGV4O1xyXG4gICAgICAgICAgICAgICAgdGhpcy5oYW5kbGVTZWxlY3RlZFJvd0NoYW5nZShyb3dTZWxlY3RlZENvbnRleHQpO1xyXG4gICAgICAgICAgICAgIH0sIDMwMCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gVE9ETzog5L2/55So562W55Wl5qih5byP6YeN5p6EXHJcbiAgICAgIC8vIGJpbmRpbmdEYXRhIOWQjOatpSBTZWxlY3RlZEtleXNcclxuICAgICAgaWYgKGNoYW5nZS50eXBlID09PSBDaGFuZ2VUeXBlLlJlbW92ZSkge1xyXG4gICAgICAgIHRoaXMuc3luY0RlbGV0ZWRLZXlzKGNoYW5nZS52YWx1ZSk7XHJcbiAgICAgIH1cclxuICAgICAgY29uc3QgaXNNYXRjaCA9IHRoaXMuY2hlY2tJZkNoYW5nZU1hdGNoQmluZGluZ1BhdGgoY2hhbmdlKTtcclxuICAgICAgaWYgKGlzTWF0Y2gpIHtcclxuICAgICAgICB0aGlzLmhhbmRsZVNlbGVjdGVkS2V5Q2hhbmdlKHRoaXMuYmluZGluZ0xpc3QuY3VycmVudElkKTtcclxuICAgICAgfVxyXG4gICAgICAvLyDmuLLmn5PlvZPliY3ooYxcclxuICAgICAgaWYgKGlzTWF0Y2ggJiYgdGhpcy5jaGVja0N1cnJlbnRSb3dJZEV4aXN0cygpICYmIGNoYW5nZS50eXBlID09PSBDaGFuZ2VUeXBlLlNlbGVjdGlvbkNoYW5nZWQgJiYgIXRoaXMuZGF0YUlkKSB7XHJcbiAgICAgICAgdGhpcy5yZW5kZXJDdXJyZW50Um93KHRoaXMuYmluZGluZ0xpc3QuY3VycmVudElkKTtcclxuICAgICAgfVxyXG4gICAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6IG1heC1saW5lLWxlbmd0aFxyXG4gICAgICAvLyBGSVhNRTrpnIDopoHmnInph43nva7pobXnoIHnmoTml7bmnLpcclxuICAgICAgLyppZiAoKGNoYW5nZS50eXBlID09PSBDaGFuZ2VUeXBlLlNlbGVjdGlvbkNoYW5nZWQgfHwgY2hhbmdlLnR5cGUgPT09IENoYW5nZVR5cGUuR2xvYmFsU2VsZWN0aW9uQ2hhbmdlZCkgJiYgdGhpcy5jdXJyZW50Um93SWQgIT09IHRoaXMuYmluZGluZ0xpc3QuY3VycmVudElkKSB7XHJcbiAgICAgICAgICB0aGlzLnJlc2V0UGFnZUluZm8oKTtcclxuICAgICAgfSovXHJcbiAgICAgIC8vIOinpuWPkeWPmOabtOajgOa1i1xyXG4gICAgICBpZiAoY2hhbmdlLnR5cGUgPT09IENoYW5nZVR5cGUuTG9hZCB8fCBjaGFuZ2UudHlwZSA9PT0gQ2hhbmdlVHlwZS5TZWxlY3Rpb25DaGFuZ2VkXHJcbiAgICAgICAgfHwgY2hhbmdlLnR5cGUgPT09IENoYW5nZVR5cGUuQXBwZW5kIHx8IGNoYW5nZS50eXBlID09PSBDaGFuZ2VUeXBlLlJlbW92ZSkge1xyXG5cclxuICAgICAgICAvLyDop6blj5Hlj5jmm7Tmo4DmtYtcclxuICAgICAgICBpZiAodGhpcy5ncmlkICYmIHRoaXMuZ3JpZFsnY2hhbmdlRGV0ZWN0b3JSZWYnXSAmJiB0aGlzLmdyaWRbJ2NoYW5nZURldGVjdG9yUmVmJ11bJ2RldGVjdENoYW5nZXMnXSkge1xyXG4gICAgICAgICAgdGhpcy5ncmlkWydjaGFuZ2VEZXRlY3RvclJlZiddWydkZXRlY3RDaGFuZ2VzJ10oKTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuXHJcbiAgICB9KTtcclxuXHJcbiAgICBpZiAodGhpcy5lZGl0YWJsZSA9PT0gdHJ1ZSAmJiB0aGlzLmZvcm0gPT09IG51bGwpIHtcclxuICAgICAgdGhyb3cgRXJyb3IoJ+WQr+eUqOe8lui+keaXtu+8jOW/hemhu+aMh+WummZvcm0nKTtcclxuICAgIH1cclxuICAgIGlmICghdGhpcy5ncmlkIHx8ICF0aGlzLmZhcnJpc0JpbmRpbmdHcmlkT3B0aW9uIHx8ICF0aGlzLmZhcnJpc0JpbmRpbmdHcmlkT3B0aW9uWydmaWVsZHMnXSkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgZ3JpZENvbHVtbnMgPSB0aGlzLmZhcnJpc0JpbmRpbmdHcmlkT3B0aW9uWydmaWVsZHMnXTtcclxuICAgIGNvbnN0IGdyaWRPcHRpb24gPSB0aGlzLmZhcnJpc0JpbmRpbmdHcmlkT3B0aW9uO1xyXG5cclxuICAgIC8vIOWIpOaWreWIl+S4reaYr+WQpuWtmOWcqOWbuuWumuWIl1xyXG4gICAgZ3JpZE9wdGlvbi5sb2NrYWJsZSA9IChjb2x1bW5zOiBhbnlbXSkgPT4ge1xyXG4gICAgICByZXR1cm4gY29sdW1ucy5zb21lKGVsZSA9PiB7XHJcbiAgICAgICAgcmV0dXJuIGVsZS5mcm96ZW47XHJcbiAgICAgIH0pO1xyXG4gICAgfTtcclxuXHJcbiAgICB0aGlzLnJvd0NsYXNzLmVtaXQodGhpcy5ncmlkKTtcclxuICAgIC8vIOa3u+WKoOWIl+WxnuaAp+aIluiAheaWueazlVxyXG4gICAgZ3JpZENvbHVtbnMuZm9yRWFjaCgoZWxlbWVudDogYW55KSA9PiB7XHJcbiAgICAgIC8vIOiHquWumuS5iei2hemTvlxyXG4gICAgICBpZiAoZWxlbWVudC5saW5rZWRMYWJlbEVuYWJsZWQgJiYgIWVsZW1lbnQubGlua0V2ZW50KSB7XHJcbiAgICAgICAgZWxlbWVudC5saW5rRXZlbnQgPSAoKSA9PiB7XHJcbiAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfTtcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8g6Iul5rKh5pyJ6Ieq5a6a5LmJ5qC85byP5YyW5pa55rOVICDmr4/kuKrliJflr7nosaHnu5HlrprmoLzlvI/ljJbmlrnms5VcclxuICAgICAgaWYgKCFlbGVtZW50LmdldENvbHVtbkZvcm1hdCkge1xyXG4gICAgICAgIGVsZW1lbnQuZ2V0Q29sdW1uRm9ybWF0ID0gKGRhdGFJdGVtOiBhbnksIGNvbHVtbjogYW55KSA9PiB7XHJcbiAgICAgICAgICByZXR1cm4gdGhpcy5rZW5kb2dyaWRGb3JtYXRTZXIuZ2V0Q29sdW1uRm9ybWF0KGRhdGFJdGVtLCBjb2x1bW4pO1xyXG4gICAgICAgIH07XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIOWmguaenOayoeacieiHquWumuS5ieexu+agt+W8jyDmr4/kuKrliJfnu5Hlrpog5qC85byP5YyW5pa55rOVXHJcbiAgICAgIGlmICghZWxlbWVudC5nZXRDbGFzc05hbWUpIHtcclxuICAgICAgICBlbGVtZW50LmdldENsYXNzTmFtZSA9IChkYXRhSXRlbTogYW55LCBjb2x1bW46IGFueSkgPT4gJyc7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIOiHquWumuS5ieW4ruWKqeWJjeWQjuS6i+S7tlxyXG4gICAgICBpZiAoZWxlbWVudC5lZGl0b3IgJiYgZWxlbWVudC5lZGl0b3IudHlwZSA9PT0gJ0xvb2t1cEVkaXQnKSB7XHJcblxyXG4gICAgICAgIC8vIOW4ruWKqeWJjeS6i+S7tlxyXG4gICAgICAgIGlmICghZWxlbWVudC5kaWN0UGlja2luZykge1xyXG4gICAgICAgICAgZWxlbWVudC5kaWN0UGlja2luZyA9IChwYXJhbTogYW55KSA9PiB7XHJcbiAgICAgICAgICAgIHJldHVybiBvZih0cnVlKTtcclxuICAgICAgICAgIH07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIOW4ruWKqeWQjuS6i+S7tlxyXG4gICAgICAgIGlmICghZWxlbWVudC5kaWN0UGlja2VkKSB7XHJcbiAgICAgICAgICBlbGVtZW50LmRpY3RQaWNrZWQgPSAocGFyYW06IGFueSkgPT4ge1xyXG4gICAgICAgICAgICAvLyDph43mlrDov5vlhaXnvJbovpFcclxuICAgICAgICAgICAgdGhpcy5jZWxsQ2xpY2tIYW5kbGVyKHRoaXMuY2VsbENsaWNrUGFyYW0pO1xyXG4gICAgICAgICAgICByZXR1cm4gb2YodHJ1ZSk7XHJcbiAgICAgICAgICB9O1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICAvLyDnu5HlrppncmlkT3B0aW9uXHJcbiAgICB0aGlzLmJpbmRpbmdHcmlkT3B0aW9uKCk7XHJcblxyXG4gICAgLy8g5aSa6YCJ5qih5byP5LiL77yM6K6+572u5Yid5aeL6YCJ5Lit6KGMXHJcbiAgICBpZiAodGhpcy5Jc011bHRpcGxlU2VsZWN0aW9uTW9kZSkge1xyXG4gICAgICAvLyBUT0RPOiDnp7vpmaQgc2V0VGltZW91dFxyXG4gICAgICBjb25zdCBzZWxmID0gdGhpcztcclxuICAgICAgdGhpcy5uZ1pvbmUucnVuT3V0c2lkZUFuZ3VsYXIoKCkgPT4ge1xyXG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgY29uc3Qgcm93U2VsZWN0ZWRDb250ZXh0OiBTZWxlY3RlZFJvd0NvbnRleHQgPSBuZXcgU2VsZWN0ZWRSb3dDb250ZXh0KCk7XHJcbiAgICAgICAgICByb3dTZWxlY3RlZENvbnRleHQuY3VycmVudFJvd0luZGV4ID0gc2VsZi5yb3dJbmRleDtcclxuICAgICAgICAgIHJvd1NlbGVjdGVkQ29udGV4dC5sYXN0Um93SW5kZXggPSBzZWxmLmxhc3RSb3dJbmRleDtcclxuICAgICAgICAgIHNlbGYuaGFuZGxlU2VsZWN0ZWRSb3dDaGFuZ2Uocm93U2VsZWN0ZWRDb250ZXh0KTtcclxuICAgICAgICB9LCAzMDApO1xyXG4gICAgICB9KTtcclxuICAgIH1cclxuICB9XHJcblxyXG5cclxuICBuZ0FmdGVyVmlld0luaXQoKSB7XHJcbiAgICAvLyB0aGlzLmdyaWRFbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmstZ3JpZCcpO1xyXG4gICAgLy8gLy8g57uR5a6aZ3JpZCBrZXlkb3du5a+56LGh55qE5pa55rOVXHJcbiAgICAvLyB0aGlzLm5nWm9uZS5ydW5PdXRzaWRlQW5ndWxhcigoKSA9PiB7XHJcbiAgICAvLyAgIHRoaXMuZ3JpZEtleWRvd25FdmVudCA9IHRoaXMuZW50ZXJDZWxsLmJpbmQodGhpcyk7XHJcbiAgICAvLyAgIHRoaXMuZ3JpZENlbGxDbGlja0V2ZW50ID0gdGhpcy5jZWxsQ2xpY2tIYW5kbGVyLmJpbmQodGhpcyk7XHJcbiAgICAvLyAgIHRoaXMuZ3JpZENlbGxDbG9zZUV2ZW50ID0gdGhpcy5jZWxsQ2xvc2VIYW5kbGVyLmJpbmQodGhpcyk7XHJcbiAgICAvLyAgIHRoaXMuZ3JpZEVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIHRoaXMuZ3JpZEtleWRvd25FdmVudCk7XHJcbiAgICAvLyAgIHRoaXMuZ3JpZEVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignY2VsbENsaWNrJywgdGhpcy5ncmlkQ2VsbENsaWNrRXZlbnQpO1xyXG4gICAgLy8gICB0aGlzLmdyaWRFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2NlbGxDbG9zZScsIHRoaXMuZ3JpZENlbGxDbG9zZUV2ZW50KTtcclxuICAgIC8vIH0pO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDmo4DmtYtjaGFuZ2XnmoTot6/lvoTlkoxCaW5kaW5nUGF0aOaYr+WQpuWMuemFjVxyXG4gICAqL1xyXG4gIHByaXZhdGUgY2hlY2tJZkNoYW5nZU1hdGNoQmluZGluZ1BhdGgoY2hhbmdlOiBDaGFuZ2UpOiBib29sZWFuIHtcclxuICAgIGxldCBpc01hdGNoID0gZmFsc2U7XHJcbiAgICBpZiAoIWNoYW5nZSB8fCAhY2hhbmdlLnBhdGgpIHtcclxuICAgICAgcmV0dXJuIGlzTWF0Y2g7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgY2hhbmdlUGF0aEFycmF5ID0gY2hhbmdlLnBhdGg7XHJcbiAgICBpZiAoIWNoYW5nZVBhdGhBcnJheSkge1xyXG4gICAgICByZXR1cm4gaXNNYXRjaDtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoISh0aGlzLmJpbmRpbmdEYXRhKSAmJiAhKHRoaXMuYmluZGluZ0RhdGEuYmluZGluZ1BhdGgpKSB7XHJcbiAgICAgIHJldHVybiBpc01hdGNoO1xyXG4gICAgfVxyXG4gICAgY29uc3QgYmluZ2RpbmdQYXRoQXJyYXkgPSB0aGlzLmJpbmRpbmdEYXRhLmJpbmRpbmdQYXRoLnNwbGl0KCcvJyk7XHJcbiAgICBpZiAoYmluZ2RpbmdQYXRoQXJyYXkubGVuZ3RoIDw9IDApIHtcclxuICAgICAgcmV0dXJuIGlzTWF0Y2g7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKGNoYW5nZVBhdGhBcnJheS5sZW5ndGggPT09IDApIHsgLy8g5Li76KGoXHJcbiAgICAgIGlmICh0aGlzLmJpbmRpbmdEYXRhLmJpbmRpbmdQYXRoID09PSAnLycpIHtcclxuICAgICAgICBpc01hdGNoID0gdHJ1ZTtcclxuICAgICAgfVxyXG4gICAgfSBlbHNlIGlmIChjaGFuZ2UucGF0aC5sZW5ndGggPT09IDEpIHsvLyDkuLvku47ooahcclxuICAgICAgaWYgKGJpbmdkaW5nUGF0aEFycmF5Lmxlbmd0aCA9PT0gMiAmJiBiaW5nZGluZ1BhdGhBcnJheVsxXSA9PT0gY2hhbmdlLnBhdGhbMF0pIHtcclxuICAgICAgICBpc01hdGNoID0gdHJ1ZTtcclxuICAgICAgfVxyXG4gICAgfSBlbHNlIGlmIChjaGFuZ2UucGF0aC5sZW5ndGggPT09IDIpIHsgLy8g5Li75LuO5LuO6KGoXHJcbiAgICAgIGlmIChiaW5nZGluZ1BhdGhBcnJheS5sZW5ndGggPT09IDMgJiYgYmluZ2RpbmdQYXRoQXJyYXlbMV0gPT09IGNoYW5nZS5wYXRoWzBdICYmIGJpbmdkaW5nUGF0aEFycmF5WzJdID09PSBjaGFuZ2UucGF0aFsxXSkge1xyXG4gICAgICAgIGlzTWF0Y2ggPSB0cnVlO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIGlzTWF0Y2g7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDlpITnkIbpgInkuK3kuLvplK7lj5jmm7RcclxuICAgKi9cclxuICBwcml2YXRlIGhhbmRsZVNlbGVjdGVkS2V5Q2hhbmdlKGN1cnJlbnRJZDogYW55KSB7XHJcbiAgICBjb25zdCBzZWxlY3RlZEtleXMgPSB0aGlzLnNlbGVjdGlvbkRpci5zZWxlY3RlZEtleXM7XHJcbiAgICBpZiAoIWN1cnJlbnRJZCkge1xyXG5cclxuICAgICAgLy8g5aaC5p6c5b2T5YmN6KGM5pe2bnVsbO+8jOS9hnNlbGVjdGVkS2V5c+mHjOacieWAvO+8jOa4heepuuW5tuWPkemAgeS4gOasoeihjOWIh+aNolxyXG4gICAgICBpZiAoc2VsZWN0ZWRLZXlzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICBjb25zdCByZW1vdmVkU2VsZWN0ZWRLZXlzID0gc2VsZWN0ZWRLZXlzLnNwbGljZSgwLCBzZWxlY3RlZEtleXMubGVuZ3RoKTtcclxuICAgICAgICBpZiAocmVtb3ZlZFNlbGVjdGVkS2V5cy5pbmRleE9mKG51bGwpID09PSAtMSkge1xyXG4gICAgICAgICAgdGhpcy5lbWl0U2VsZWN0ZWRSb3dDaGFuZ2UoeyBjdXJyZW50Um93SWQ6IG51bGwgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGxldCBvbGRDdXJyZW50Um93SWQgPSBudWxsO1xyXG4gICAgaWYgKHRoaXMuSXNNdWx0aXBsZVNlbGVjdGlvbk1vZGUpIHtcclxuICAgICAgb2xkQ3VycmVudFJvd0lkID0gdGhpcy5jdXJyZW50Um93SWQ7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBvbGRDdXJyZW50Um93SWQgPSB0aGlzLnNlbGVjdGlvbkRpci5zZWxlY3RlZEtleXMubGVuZ3RoID09PSAwXHJcbiAgICAgICAgPyBudWxsIDogdGhpcy5zZWxlY3Rpb25EaXIuc2VsZWN0ZWRLZXlzWzBdO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIFRPRE86aWYgKHRoaXMuY3VycmVudFJvd0lkICE9PSBjdXJyZW50SWQpIHtcclxuICAgIGlmIChvbGRDdXJyZW50Um93SWQgIT09IGN1cnJlbnRJZCkge1xyXG4gICAgICBjb25zdCBzZWxlY3RlZFJvd0NvbnRleHQ6IGFueSA9IHt9O1xyXG4gICAgICBzZWxlY3RlZFJvd0NvbnRleHQuY3VycmVudFJvd0lkID0gY3VycmVudElkO1xyXG4gICAgICB0aGlzLmN1cnJlbnRSb3dJZCA9IGN1cnJlbnRJZDtcclxuICAgICAgdGhpcy5lbWl0U2VsZWN0ZWRSb3dDaGFuZ2Uoc2VsZWN0ZWRSb3dDb250ZXh0KTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOWPkeWwhOmAieS4reihjOWIh+aNouS6i+S7tlxyXG4gICAqIEBkZXNjcmlwdGlvbiDnu5/kuIDljZXpgInmqKHlvI/lkozlpJrpgInmqKHlvI/kuIvnmoTooYzliIfmjaLkuovku7ZcclxuICAgKi9cclxuICBwcml2YXRlIGVtaXRTZWxlY3RlZFJvd0NoYW5nZShzZWxlY3RlZFJvd0NvbnRleHQ6IGFueSkge1xyXG4gICAgaWYgKCF0aGlzLklzTXVsdGlwbGVTZWxlY3Rpb25Nb2RlKSB7IC8vIOWQkeWQjuWFvOWuuVxyXG4gICAgICBjb25zdCBjdXJyZW50SWQgPSBzZWxlY3RlZFJvd0NvbnRleHQuY3VycmVudFJvd0lkO1xyXG4gICAgICB0aGlzLnNlbGVjdGlvbkRpci5zZWxlY3RlZEtleXMgPSBbY3VycmVudElkXTtcclxuICAgICAgdGhpcy5zZWxlY3Rpb25EaXIuc2VsZWN0ZWRLZXlzQ2hhbmdlLmVtaXQodGhpcy5zZWxlY3Rpb25EaXIuc2VsZWN0ZWRLZXlzKTtcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLnNlbGVjdGVkUm93Q2hhbmdlLmVtaXQoc2VsZWN0ZWRSb3dDb250ZXh0KTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgY2hlY2tDdXJyZW50Um93SWRFeGlzdHMoKTogYm9vbGVhbiB7XHJcbiAgICBsZXQgaXNFeGlzdCA9IGZhbHNlO1xyXG5cclxuICAgIGlmICh0aGlzLmJpbmRpbmdMaXN0ICYmIHRoaXMuYmluZGluZ0xpc3QuY3VycmVudElkICYmIHRoaXMuYmluZGluZ0xpc3QuY3VycmVudElkLmxlbmd0aCA+IDApIHtcclxuICAgICAgaXNFeGlzdCA9IHRydWU7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIGlzRXhpc3Q7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDlkIzmraXlt7LliKDpmaTplK7liLDpgInkuK3pm4blkIhcclxuICAgKi9cclxuICBwcml2YXRlIHN5bmNEZWxldGVkS2V5cyhkZWxldGVkVmFsdWVDb2xsZWN0aW9uOiBhbnlbXSkge1xyXG4gICAgaWYgKCFkZWxldGVkVmFsdWVDb2xsZWN0aW9uKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICBkZWxldGVkVmFsdWVDb2xsZWN0aW9uLmZvckVhY2goKGlkOiBzdHJpbmcpID0+IHtcclxuICAgICAgY29uc3QgaW5kZXggPSB0aGlzLnNlbGVjdGlvbkRpci5zZWxlY3RlZEtleXMuaW5kZXhPZihpZCk7XHJcbiAgICAgIGlmIChpbmRleCA+IC0xKSB7XHJcbiAgICAgICAgdGhpcy5zZWxlY3Rpb25EaXIuc2VsZWN0ZWRLZXlzLnNwbGljZShpbmRleCwgMSk7XHJcblxyXG4gICAgICAgIC8vIHNlbGVjdGVkS2V5c+iiq+a4heepuueahOaXtuWAme+8jOinpuWPkeS4gOasoeihjOWPmOabtFxyXG4gICAgICAgIGlmICh0aGlzLnNlbGVjdGlvbkRpci5zZWxlY3RlZEtleXMubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgICAgICB0aGlzLmVtaXRTZWxlY3RlZFJvd0NoYW5nZSh7IGN1cnJlbnRSb3dJZDogbnVsbCB9KTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSByZW5kZXJDdXJyZW50Um93KGN1cnJlbnRJZDogc3RyaW5nKSB7XHJcbiAgICBpZiAoIWN1cnJlbnRJZCB8fCBjdXJyZW50SWQgPT09ICcnKSB7Ly8g5LiN5a2Y5Zyo5b2T5YmN6KGMXHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICAvLyBUT0RPOuS9v+eUqOetlueVpeaooeW8j+mHjeaehFxyXG4gICAgaWYgKHRoaXMuSXNNdWx0aXBsZVNlbGVjdGlvbk1vZGUpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMucmVuZGVyU2VsZWN0aW9uUm93KHRoaXMuYmluZGluZ0xpc3QuY3VycmVudElkLCB0aGlzLnNlbGVjdGlvbkRpci5zZWxlY3RlZEtleXMpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5oyH5Luk6L6T5YWl5Y+Y5pu05aSE55CGXHJcbiAgICovXHJcbiAgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcykge1xyXG4gICAgc3VwZXIubmdPbkNoYW5nZXMoY2hhbmdlcyk7XHJcbiAgICB0aGlzLnJlZnJlc2hWaWV3KCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDmjIfku6TplIDmr4HvvIzms6jplIDorqLpmIVcclxuICAgKi9cclxuICBuZ09uRGVzdHJveSgpIHtcclxuICAgIGlmICh0aGlzLmJpbmRpbmdDaGFuZ2VTdWJzY3JpcHRpb24pIHtcclxuICAgICAgdGhpcy5iaW5kaW5nQ2hhbmdlU3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHJlZnJlc2hWaWV3KGNoYW5nZT86IENoYW5nZSkge1xyXG4gICAgLy8gdGhpcy5iaW5kRGF0YSgpO1xyXG4gICAgdGhpcy5yZWZyZXNoRGF0YShjaGFuZ2UpO1xyXG5cclxuICAgIC8vIOWIt+aWsOmhteiEmuWQiOiuoeS/oeaBr+OAguWuouaIt+err+WQiOiuoe+8jOaaguaXtuaUvui/memHjO+8jOacjeWKoeerr+WQiOiuoeaXtuacgOWlveS7jui/memHjOenu+i1sOOAgmJ5IGp1c3RpblxyXG4gICAgdGhpcy5yZWZyZXNoU3VtbWFyeSgpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog57uR5a6aZGF0YeWIsOWuv+S4u2dyaWTkuIpcclxuICAgKiBAZGVwcmVjYXRlZFxyXG4gICAqL1xyXG4gIHByaXZhdGUgYmluZERhdGEoKSB7XHJcbiAgICAvKmNvbnN0IGRhdGEgPSB0aGlzLmJpbmRpbmdMaXN0LnRvSlNPTigpO1xyXG4gICAgbGV0IHNraXAgPSAwO1xyXG4gICAgaWYgKHRoaXMuYmluZGluZ0xpc3QucGFnZUluZGV4ID4gMCkge1xyXG4gICAgICBza2lwID0gKHRoaXMuYmluZGluZ0xpc3QucGFnZUluZGV4IC0gMSkgKiB0aGlzLmJpbmRpbmdMaXN0LnBhZ2VTaXplO1xyXG4gICAgfVxyXG4gICAgdGhpcy51cGRhdGVQYWdlcih0aGlzLmJpbmRpbmdMaXN0LnBhZ2VTaXplLCBza2lwKTtcclxuICAgIGNvbnN0IHByb2Nlc3NlZCA9IHByb2Nlc3MoZGF0YSwgT2JqZWN0LmFzc2lnbih7fSwgdGhpcy5zdGF0ZSwgeyBza2lwOiAwIH0pKTtcclxuICAgIHByb2Nlc3NlZC50b3RhbCA9IHRoaXMuYmluZGluZ0xpc3QudG90YWw7XHJcbiAgICB0aGlzLmdyaWQuZGF0YSA9IHByb2Nlc3NlZDsqL1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSByZWZyZXNoRGF0YShjaGFuZ2U/OiBDaGFuZ2UpIHtcclxuICAgIGxldCBza2lwID0gMDtcclxuICAgIGNvbnN0IHsgcGFnZUluZGV4ID0gMSwgcGFnZVNpemUgPSAwIH0gPSB0aGlzLmdldFBhZ2luZ0luZm8oKSB8fCB7fTtcclxuICAgIGlmIChwYWdlSW5kZXggPiAwKSB7XHJcbiAgICAgIHNraXAgPSAocGFnZUluZGV4IC0gMSkgKiBwYWdlU2l6ZTtcclxuICAgIH1cclxuICAgIHRoaXMudXBkYXRlUGFnZXIocGFnZVNpemUsIHNraXApO1xyXG4gICAgdGhpcy5lbmRDZWxsRWRpdChjaGFuZ2UpO1xyXG4gICAgdGhpcy5kYXRhID0gdGhpcy5iaW5kaW5nTGlzdC50b0pTT04oeyBpZ25vcmVNdWx0aUxhbmdJbnB1dDogdHJ1ZSB9KTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog6YCA5Ye657yW6L6R54q25oCBXHJcbiAgICogQHBhcmFtIGNoYW5nZSDlj5jmm7RcclxuICAgKi9cclxuICBwcml2YXRlIGVuZENlbGxFZGl0KGNoYW5nZT86IENoYW5nZSkge1xyXG4gICAgY29uc3QgaXNFZGl0aW5nID0gdGhpcy5ncmlkLmlzRWRpdGluZztcclxuICAgIGlmIChjaGFuZ2UgJiYgY2hhbmdlLnR5cGUgPT09IENoYW5nZVR5cGUuTG9hZCAmJiBpc0VkaXRpbmcpIHtcclxuICAgICAgdGhpcy5ncmlkLmNhbmNlbENlbGwoKTtcclxuICAgIH1cclxuICB9XHJcbiAgcHJpdmF0ZSByZWZyZXNoU3VtbWFyeSgpIHtcclxuICAgIGlmICh0aGlzLmFnZ3JDb2x1bW5zKSB7XHJcbiAgICAgIHRoaXMuYWdnckNvbHVtbnMuZm9yRWFjaChhZ2dyQ29sID0+IHtcclxuICAgICAgICBpZiAoYWdnckNvbC5hZ2dyZWdhdGUpIHtcclxuICAgICAgICAgIGFnZ3JDb2wucmVjYWxjdWxhdGVTdW1tYXJ5KHRoaXMuYmluZGluZ0xpc3QpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBASG9zdExpc3RlbmVyKCdwYWdlQ2hhbmdlJywgWyckZXZlbnQnXSlcclxuICBwdWJsaWMgb25QYWdlQ2hhbmdlKGV2ZW50OiBQYWdlQ2hhbmdlRXZlbnQpIHtcclxuICAgIGNvbnN0IHsgc2tpcCA9IDAsIHRha2UgPSAwIH0gPSBldmVudCB8fCB7fTtcclxuICAgIC8vIHRoaXMuYmluZGluZ0xpc3Quc2V0UGFnaW5hdGlvbkluZm8oc2tpcCwgdGFrZSk7XHJcbiAgICB0aGlzLmJpbmRpbmdEYXRhLnNldFBhZ2luZ0luZm8oc2tpcCwgdGFrZSwgdGhpcy52aWV3TW9kZWwuYmluZGluZ1BhdGgpO1xyXG4gICAgLy8g56e76Zmk6YCJ5Lit6KGM5qC35byPXHJcbiAgICBNdWx0aVNlbGVjdEdyaWRVdGlsaXR5LnJlbW92ZVJvd1NlbGVjdGVkU3R5bGUodGhpcy5ncmlkLCB0aGlzLnJvd0luZGV4KTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog6YeN572uZ3JpZOWIhumhteS/oeaBr1xyXG4gICAqL1xyXG4gIHByaXZhdGUgcmVzZXRQYWdlSW5mbygpIHtcclxuICAgIGNvbnN0IHsgcGFnZVNpemUgPSAwIH0gPSB0aGlzLmdldFBhZ2luZ0luZm8oKSB8fCB7fTtcclxuICAgIHRoaXMuYmluZGluZ0RhdGEuc2V0UGFnaW5nSW5mbygwLCBwYWdlU2l6ZSwgdGhpcy52aWV3TW9kZWwuYmluZGluZ1BhdGgpO1xyXG4gIH1cclxuICBwcml2YXRlIGluaXREYXRhU3RhdGUoKSB7XHJcbiAgICAvLyBjb25zdCBncm91cHM6IEdyb3VwRGVzY3JpcHRvcltdID0gW107XHJcbiAgICAvLyBpZiAodGhpcy5ncm91cEZpZWxkKSB7XHJcbiAgICAvLyAgIGdyb3Vwcy5wdXNoKHtmaWVsZDogdGhpcy5ncm91cEZpZWxkLCBhZ2dyZWdhdGVzOiB0aGlzLmFnZ3JlZ2F0ZXN8fFtdfSk7XHJcbiAgICAvLyAgIHRoaXMuZ3JpZC5ncm91cCA9IGdyb3VwcztcclxuICAgIC8vIH1cclxuICAgIC8vIHRoaXMuc3RhdGUgPSBPYmplY3QuYXNzaWduKHRoaXMuc3RhdGUsIHtncm91cDogZ3JvdXBzfSk7XHJcblxyXG4gICAgY29uc3QgYWdncmVnYXRlc0RlczogQWdncmVnYXRlRGVzY3JpcHRvcltdID0gW107XHJcbiAgICBpZiAodGhpcy5ncm91cEFnZ3JGaWVsZHMpIHtcclxuICAgICAgZm9yIChjb25zdCBncm91cEFnZ3JGaWVsZCBvZiB0aGlzLmdyb3VwQWdnckZpZWxkcykge1xyXG4gICAgICAgIGFnZ3JlZ2F0ZXNEZXMucHVzaCh7IGZpZWxkOiBncm91cEFnZ3JGaWVsZCwgYWdncmVnYXRlOiAnc3VtJyB9KTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IGdyb3VwOiBHcm91cERlc2NyaXB0b3JbXSA9IFtdO1xyXG4gICAgaWYgKHRoaXMuZ3JvdXBGaWVsZCkge1xyXG4gICAgICBncm91cC5wdXNoKHsgZmllbGQ6IHRoaXMuZ3JvdXBGaWVsZCwgYWdncmVnYXRlczogYWdncmVnYXRlc0RlcyB9KTtcclxuICAgIH1cclxuICAgIHRoaXMuZ3JvdXAgPSBncm91cDtcclxuXHJcbiAgfVxyXG5cclxuICAvKlxyXG4gICAqIEBvdmVycmlkZVxyXG4gICAqIEBwYXJhbSBzdGF0ZSBTdGF0ZVxyXG4gICAqL1xyXG4gIG9uU3RhdGVDaGFuZ2Uoc3RhdGU6IERhdGFTdGF0ZUNoYW5nZUV2ZW50KSB7XHJcbiAgICAvLyDor7TmmI7vvJpwYWdlcuagueaNrnNraXDorqHnrpflvZPliY3pobXnoIHjgIJrZW5kbyBncmlk5YaF6YOo5Lya5ZyoZmlsdGVyIHN0YXRl5Y+Y5YyW5pe25oqKc2tpcOWPmOS4ujDvvIjph43nva7liLDnrKzkuIDpobXvvInjgIJcclxuICAgIC8vIOWboOatpOmcgOimgemHjeWGmW9uU3RhdGVDaGFuZ2Xmlrnms5XvvIzkv67mraNza2lwXHJcbiAgICBpZiAoc3RhdGUuc2tpcCAhPT0gdGhpcy5jdXJyZW50U2tpcCkge1xyXG4gICAgICBzdGF0ZS5za2lwID0gdGhpcy5jdXJyZW50U2tpcDtcclxuICAgIH1cclxuICAgIC8vIOS9v+eUqGtlbmRv6buY6K6k55qE5aSE55CGc3RhdGXnmoTpgLvovpFcclxuICAgIHRoaXMuYXBwbHlTdGF0ZShzdGF0ZSk7XHJcblxyXG4gICAgdGhpcy5yZWJpbmQoKTtcclxuICB9XHJcblxyXG4gIC8vIHByb3RlY3RlZCBhcHBseVN0YXRlKHtza2lwLCB0YWtlLCBzb3J0LCBncm91cCwgZmlsdGVyfTogU3RhdGUpOiB2b2lkIHtcclxuICAvLyAgIHRoaXMuc2tpcCA9IHNraXA7XHJcbiAgLy8gICB0aGlzLnBhZ2VTaXplID0gdGFrZTtcclxuICAvLyAgIHRoaXMuc29ydCA9IHNvcnQ7XHJcbiAgLy8gICB0aGlzLmdyb3VwID0gZ3JvdXA7XHJcbiAgLy8gICB0aGlzLmZpbHRlciA9IGZpbHRlcjtcclxuICAvLyB9XHJcblxyXG4gIC8qXHJcbiAgICogQG92ZXJyaWRlIOacjeWKoeWZqOerr+WIhumhteWPluaVsOOAgnByb2Nlc3Pkvb/nlKjnmoRzdGF0ZeS4rXNraXDlupTkuLow77yM5ZCm5YiZ5LiN5pi+56S65pWw5o2uXHJcbiAgICogQHBhcmFtIHN0YXRlIFN0YXRlXHJcbiAgICovXHJcbiAgcHJvdGVjdGVkIHByb2Nlc3Moc3RhdGU6IFN0YXRlKTogR3JpZERhdGFSZXN1bHQge1xyXG4gICAgLy8gaWYgKHRoaXMuZWRpdGluZykge1xyXG4gICAgLy8gICBzdGF0ZS5zb3J0ID0gbnVsbDtcclxuICAgIC8vIH0gZWxzZSB7XHJcbiAgICAvLyAgIHN0YXRlLnNvcnQgPSB0aGlzLm9yaWdpbmFsU29ydDtcclxuICAgIC8vIH1cclxuICAgIHN0YXRlLnNraXAgPSAwO1xyXG4gICAgY29uc3QgeyBwYWdlU2l6ZSA9IDAsIHRvdGFsOiB0b3RhbENvdW50ID0gMCB9ID0gdGhpcy5nZXRQYWdpbmdJbmZvKCkgfHwge307XHJcbiAgICAvLyBmaXjvvJrkuI3lkK/nlKjliIbpobXml7bvvIx0YWtlPTDlr7zoh7Rwcm9jZXNz5LiN6L+U5Zue5pWw5o2uXHJcbiAgICBpZiAoc3RhdGUudGFrZSA9PT0gMCkge1xyXG4gICAgICBzdGF0ZS50YWtlID0gdGhpcy5iaW5kaW5nTGlzdC5sZW5ndGg7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBzdGF0ZS50YWtlID0gcGFnZVNpemU7XHJcbiAgICB9XHJcbiAgICAvLyDnvJbovpHmqKHlvI/nmoTliKTmlq3kvp3mja7kuLpwYWdlU2l6ZeWwj+S6jue7keWumuaVsOaNrueahOaVsOmHj+S4lOWQr+eUqOWIhumhtVxyXG4gICAgY29uc3QgaXNFZGl0TW9kZSA9IHN0YXRlLnRha2UgPCB0aGlzLmJpbmRpbmdMaXN0Lmxlbmd0aDtcclxuICAgIGlmIChpc0VkaXRNb2RlKSB7XHJcbiAgICAgIHN0YXRlLnRha2UgPSB0aGlzLmJpbmRpbmdMaXN0Lmxlbmd0aDtcclxuICAgIH1cclxuICAgIGNvbnN0IHByb2Nlc3NlZCA9IHN1cGVyLnByb2Nlc3Moc3RhdGUpO1xyXG4gICAgLy8gZml4OuaVsOaNruS7juaXoOWIsOacieaXtuWIhumhteS4jeWQr+eUqFxyXG4gICAgcHJvY2Vzc2VkLnRvdGFsID0gTWF0aC5tYXgodG90YWxDb3VudCwgdGhpcy5iaW5kaW5nTGlzdC5sZW5ndGgpO1xyXG4gICAgLy8g5YiG6aG157yW6L6R5qih5byP5LiL5pWw5o2u5oC76K6w5b2V5pWw5LiN6IO9562J5LqO55yf5a6e55qE5pWw5o2u5pWw5o2u77yM5ZCm5YiZ5YiG6aG15bel5YW35p2h5bCx5Lya6Ieq5Yqo5aKe5Yqg5YiG6aG16aG1562+XHJcbiAgICBpZiAoaXNFZGl0TW9kZSkge1xyXG4gICAgICBwcm9jZXNzZWQudG90YWwgPSB0b3RhbENvdW50IHx8IDE7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHByb2Nlc3NlZDtcclxuICB9XHJcblxyXG4gIC8qXHJcbiAgICog6YCJ5Lit6KGM5Li76ZSu5Y+Y5YyW5aSE55CGXHJcbiAgICogQHBhcmFtIGV2ZW50IHsgU2VsZWN0aW9uRXZlbnR9IOmAieS4reihjOWPmOWMluWkhOeQhlxyXG4gICAqL1xyXG4gIEBIb3N0TGlzdGVuZXIoJ3NlbGVjdGVkS2V5c0NoYW5nZScsIFsnJGV2ZW50J10pXHJcbiAgcHVibGljIHNlbGVjdGVkS2V5c0NoYW5nZUhhbmRsZXIoc2VsZWN0ZWRLZXlzOiBzdHJpbmdbXSkge1xyXG4gICAgaWYgKCEodGhpcy5Jc011bHRpcGxlU2VsZWN0aW9uTW9kZSkpIHsvLyDljZXpgInmqKHlvI/kuItcclxuICAgICAgLy8g6K6+572uQmluZGluZ0RhdGHkuK3nmoTlvZPliY3ooYxcclxuICAgICAgdGhpcy5zZXRTZWxlY3Rpb25JZFRvQmluZGluZ0RhdGEoc2VsZWN0ZWRLZXlzW3NlbGVjdGVkS2V5cy5sZW5ndGggLSAxXSk7XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy52aWV3TW9kZWwudWlTdGF0ZS5zZXRQcm9wZXJ0eVZhbHVlKCdpZHMnLCB0aGlzLnNlbGVjdGlvbkRpci5zZWxlY3RlZEtleXMpOyAvLyDmm7TmlrDpm4blkIhcclxuICB9XHJcblxyXG4gIC8qXHJcbiAgICog5aSE55CGR3JpZOihjOWIh+aNouS6i+S7tlxyXG4gICAqIEBwYXJhbSBldmVudCB7IFNlbGVjdGlvbkV2ZW50fSDooYzliIfmjaLkuovku7blr7nosaFcclxuICAgKi9cclxuICBASG9zdExpc3RlbmVyKCdzZWxlY3Rpb25DaGFuZ2UnLCBbJyRldmVudCddKVxyXG4gIHB1YmxpYyBzZWxlY3Rpb25DaGFuZ2VIYW5kbGVyKGV2ZW50OiBhbnkpIHtcclxuICAgIGlmICh0aGlzLklzTXVsdGlwbGVTZWxlY3Rpb25Nb2RlKSB7XHJcbiAgICAgIHRoaXMuaGFuZGxlU2VsZWN0ZWRDaGVja2JveENoYW5nZSh0aGlzLmdyaWQud3JhcHBlciwgZXZlbnQpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5aSE55CGY2hlY2tib3jpgInkuK3kuovku7ZcclxuICAgKi9cclxuICBwcml2YXRlIGhhbmRsZVNlbGVjdGVkQ2hlY2tib3hDaGFuZ2UoZWxlbWVudFJlZjogRWxlbWVudFJlZiwgZXZlbnQ6IGFueSkge1xyXG4gICAgTXVsdGlTZWxlY3RHcmlkVXRpbGl0eS5yZW5kZXJTZWxlY3RlZENoYW5nZUNoZWNrYm94KGVsZW1lbnRSZWYsIGV2ZW50KTtcclxuICAgIHRoaXMuc2VsZWN0ZWRDaGVja2JveENoYW5nZS5lbWl0KGV2ZW50KTtcclxuICB9XHJcblxyXG4gIC8qXHJcbiAgICog5Y2V5YWD5qC854K55Ye75aSE55CGXHJcbiAgICogQHBhcmFtIGV2ZW50IHsgQ2VsbENsaWNrRXZlbnQgfSDljZXlhYPmoLzljZXlh7vkuovku7blr7nosaFcclxuICAgKi9cclxuICBASG9zdExpc3RlbmVyKCdjZWxsQ2xpY2snLCBbJyRldmVudCddKVxyXG4gIHB1YmxpYyBjZWxsQ2xpY2tIYW5kbGVyKGV2ZW50OiBDZWxsQ2xpY2tFdmVudCkge1xyXG4gICAgdGhpcy5jZWxsQ2xpY2tQYXJhbSA9IGV2ZW50O1xyXG4gICAgdGhpcy5jZWxsQ2xpY2tFdmVudCA9IGV2ZW50O1xyXG4gICAgdGhpcy5yb3dJbmRleCA9IGV2ZW50LnJvd0luZGV4O1xyXG4gICAgdGhpcy5jb2x1bW5JbmRleCA9IGV2ZW50LmNvbHVtbkluZGV4O1xyXG4gICAgdGhpcy5zZW5kZXIgPSBldmVudC5zZW5kZXI7XHJcblxyXG4gICAgLy8g5aSa6YCJ5qih5byP5LiL77yM5LiU5LiN5YiG57uE55qE5oOF5Ya15LiL77yM5qOA5rWL6KGM5YiH5o2iXHJcbiAgICBpZiAodGhpcy5Jc011bHRpcGxlU2VsZWN0aW9uTW9kZSAmJiAhdGhpcy5ncmlkT3B0aW9uLmdyb3VwYWJsZSkge1xyXG4gICAgICBjb25zdCBjdXJyZW50Um93SW5kZXggPSBldmVudC5yb3dJbmRleDtcclxuICAgICAgaWYgKGN1cnJlbnRSb3dJbmRleCAhPT0gdGhpcy5sYXN0Um93SW5kZXgpIHtcclxuICAgICAgICBjb25zdCByb3dTZWxlY3RlZENvbnRleHQ6IFNlbGVjdGVkUm93Q29udGV4dCA9IG5ldyBTZWxlY3RlZFJvd0NvbnRleHQoKTtcclxuICAgICAgICByb3dTZWxlY3RlZENvbnRleHQuY3VycmVudFJvd0luZGV4ID0gY3VycmVudFJvd0luZGV4O1xyXG4gICAgICAgIHJvd1NlbGVjdGVkQ29udGV4dC5sYXN0Um93SW5kZXggPSB0aGlzLmxhc3RSb3dJbmRleDtcclxuXHJcbiAgICAgICAgdGhpcy5oYW5kbGVTZWxlY3RlZFJvd0NoYW5nZShyb3dTZWxlY3RlZENvbnRleHQpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLy8g6K6+572u5a6e5L2T55qE5b2T5YmN6KGMXHJcbiAgICB0aGlzLmRhdGFJZCA9IHRoaXMuZ2V0U2VsZWN0ZWRJZEZyb21HcmlkKGV2ZW50LmRhdGFJdGVtKTtcclxuICAgIHRoaXMuc2V0U2VsZWN0aW9uSWRUb0JpbmRpbmdEYXRhKHRoaXMuZGF0YUlkKTtcclxuXHJcbiAgICAvLyDoi6XnirbmgIHmnLrkuI3mmK/lj6/nvJbovpHnirbmgIEg5LiN5Y+v57yW6L6RXHJcbiAgICBpZiAoIXRoaXMuaXNFZGl0YWJsZSgpKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcblxyXG5cclxuICAgIC8vIOWIl+aooeadv+S4jeWtmOWcqCAg5LiN5Y+v57yW6L6RXHJcbiAgICBpZiAoIWV2ZW50LmNvbHVtbi5lZGl0VGVtcGxhdGUpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgaWYgKGV2ZW50LnR5cGUgPT09ICdjbGljaycgJiYgIWV2ZW50LmlzRWRpdGVkKSB7XHJcblxyXG5cclxuICAgICAgLy8g5aaC5p6c5a2Y5Zyo5pi+6ZqQ54q25Ya1ICDnoa7lrprmraPnoa7nmoRjb2x1bW5JbmRleFxyXG4gICAgICBjb25zdCBvcmlnaW5Db2x1bXMgPSB0aGlzLmdldENvbHVtbnModGhpcy5ncmlkT3B0aW9uLmZpZWxkcyk7XHJcbiAgICAgIGNvbnN0IGNvbHVtbnM6IGFueVtdID0gdGhpcy5nZXRDb2x1bW5zKG9yaWdpbkNvbHVtcyk7XHJcbiAgICAgIGNvbnN0IGN1cnJlbnRDb2x1bW5JbmRleCA9IGNvbHVtbnMuZmluZEluZGV4KChjb2w6IGFueSkgPT4gY29sLmRhdGFGaWVsZCA9PT0gZXZlbnQuY29sdW1uLmZpZWxkKTtcclxuICAgICAgY29uc3QgaGlkZGVuQ29sTGVuID0gY29sdW1ucy5zbGljZSgwLCBjdXJyZW50Q29sdW1uSW5kZXggKyAxKS5maWx0ZXIoY29sID0+ICFjb2wudmlzaWJsZSkubGVuZ3RoO1xyXG5cclxuICAgICAgLy8g6LWL5YC85YWo5bGA6KGM57Si5byVICDliJfntKLlvJVcclxuICAgICAgdGhpcy5yb3dJbmRleCA9IGV2ZW50LnJvd0luZGV4O1xyXG4gICAgICB0aGlzLmNvbHVtbkluZGV4ID0gZXZlbnQuY29sdW1uSW5kZXggKyBoaWRkZW5Db2xMZW47XHJcbiAgICAgIHRoaXMuaGlkZGVuQ29sTGVuID0gaGlkZGVuQ29sTGVuO1xyXG4gICAgICB0aGlzLnNlbmRlciA9IGV2ZW50LnNlbmRlcjtcclxuXHJcbiAgICAgIHRoaXMuc2V0RWRpdGFibGUodGhpcy5yb3dJbmRleCwgdGhpcy5jb2x1bW5JbmRleCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDlpITnkIbpgInkuK3ooYzliIfmjaLkuovku7ZcclxuICAgKi9cclxuICBwcml2YXRlIGhhbmRsZVNlbGVjdGVkUm93Q2hhbmdlKHJvd1NlbGVjdGVkQ29udGV4dDogU2VsZWN0ZWRSb3dDb250ZXh0KSB7XHJcbiAgICBNdWx0aVNlbGVjdEdyaWRVdGlsaXR5LnJlbmRlckNsaWNrQ2hhbmdlZFJvdyh0aGlzLmdyaWQsIHJvd1NlbGVjdGVkQ29udGV4dCk7XHJcblxyXG4gICAgdGhpcy5yb3dJbmRleCA9IHJvd1NlbGVjdGVkQ29udGV4dC5jdXJyZW50Um93SW5kZXg7XHJcbiAgICB0aGlzLmxhc3RSb3dJbmRleCA9IHJvd1NlbGVjdGVkQ29udGV4dC5jdXJyZW50Um93SW5kZXg7XHJcbiAgICAvLyDmm7TmlrDlvZPliY3ooYxcclxuICAgIGNvbnN0IGlkID0gdGhpcy5nZXRQcmltYXJ5KHRoaXMucm93SW5kZXgpO1xyXG4gICAgdGhpcy5zZXRTZWxlY3Rpb25JZFRvQmluZGluZ0RhdGEoaWQpO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDojrflj5bmjIflrprooYznmoTkuLvplK5cclxuICAgKiBAcGFyYW0gcm93IOihjOWPt1xyXG4gICAqL1xyXG4gIHByaXZhdGUgZ2V0UHJpbWFyeShyb3c6IG51bWJlcikge1xyXG4gICAgbGV0IGRhdGE6IGFueSA9IHRoaXMuZ3JpZC5kYXRhO1xyXG4gICAgaWYgKGRhdGEgJiYgIUFycmF5LmlzQXJyYXkoZGF0YSkgJiYgZGF0YS5oYXNPd25Qcm9wZXJ0eSgnZGF0YScpKSB7XHJcbiAgICAgIGRhdGEgPSBkYXRhLmRhdGE7XHJcbiAgICB9XHJcbiAgICBjb25zdCB7IHBhZ2VJbmRleCA9IDEsIHBhZ2VTaXplID0gMCB9ID0gdGhpcy5nZXRQYWdpbmdJbmZvKCkgfHwge307XHJcbiAgICBjb25zdCBza2lwID0gdGhpcy5iaW5kaW5nTGlzdC5za2lwO1xyXG4gICAgLy8g5LiN5YiG6aG15oiW6ICF56ys5LiA6aG15pe25Y+W5LiN6ZyA6KaB5L+u5pS56KGM5Y+3XHJcbiAgICBjb25zdCByb3dOdW1iZXIgPSBwYWdlU2l6ZSA9PT0gMCB8fCBwYWdlSW5kZXggPT09IDEgPyByb3cgOiByb3cgLSBza2lwO1xyXG4gICAgaWYgKGRhdGEubGVuZ3RoID4gcm93TnVtYmVyKSB7XHJcbiAgICAgIHJldHVybiBkYXRhW3Jvd051bWJlcl1bdGhpcy5iaW5kaW5nTGlzdC5wcmltYXJ5S2V5XTtcclxuICAgIH1cclxuICAgIHJldHVybiBudWxsO1xyXG4gIH1cclxuXHJcbiAgLypcclxuICAgKiDljZXlhYPmoLznu5PmnZ/nvJbovpHlpITnkIZcclxuICAgKiBAcGFyYW0gZXZlbnQg5Y2V5YWD5qC857uT5p2f57yW6L6R5LqL5Lu25a+56LGhXHJcbiAgICovXHJcbiAgQEhvc3RMaXN0ZW5lcignY2VsbENsb3NlJywgWyckZXZlbnQnXSlcclxuICBwdWJsaWMgY2VsbENsb3NlSGFuZGxlcihldmVudDogYW55KTogYW55IHtcclxuXHJcbiAgICBpZiAodGhpcy5kaWFsb2dTZXIuaGFzRGlhbG9nT3BlbmVkKCkpIHtcclxuICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIGlmICh0aGlzLnJ0cykge1xyXG4gICAgICAvLyDluK7liqnnu4Tku7bmlofmnKzlj5jljJblkI7ljrvmn6Xor6JcclxuICAgICAgaWYgKHRoaXMucnRzLmdldEZvcm1TdGF0ZSgnbG9va3VwLnBlbmRpbmcnKSkge1xyXG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyDngrnlh7vluK7liqnnoa7lrprlj6/lj5bmtojmjInpkq7lkI7kuI3nu5PmnZ/lvZPliY3ljZXlhYPmoLznvJbovpFcclxuICAgICAgaWYgKGV2ZW50Lm9yaWdpbmFsRXZlbnQpIHtcclxuICAgICAgICBpZiAodGhpcy5ydHMuZXZlbnRQYXRoKGV2ZW50Lm9yaWdpbmFsRXZlbnQpLmZpbmQobiA9PiBuLnRhZ05hbWUgPT09ICdGQVJSSVMtRElBTE9HJykpIHtcclxuICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG5cclxuICAgIGNvbnN0IHsgZm9ybUdyb3VwLCBjb2x1bW4sIGRhdGFJdGVtLCByb3dJbmRleCB9ID0gZXZlbnQ7XHJcbiAgICBjb25zdCBjb2x1bW5zID0gdGhpcy5nZXRDb2x1bW5zKHRoaXMuZ3JpZE9wdGlvbi5maWVsZHMpO1xyXG4gICAgbGV0IGN1cnJlbnRDb2wgPSBjb2x1bW5zLmZpbmQoKGVsZW1lbnQ6IGFueSkgPT4ge1xyXG4gICAgICByZXR1cm4gZWxlbWVudC5kYXRhRmllbGQgPT09IGNvbHVtbi5maWVsZDtcclxuICAgIH0pO1xyXG4gICAgY29uc3QgZm9ybUNvbnRyb2xWYWx1ZSA9IGZvcm1Hcm91cFtjdXJyZW50Q29sLmVkaXRvci5iaW5kaW5nLnBhdGhdLnZhbHVlO1xyXG4gICAgaWYgKGN1cnJlbnRDb2wuZ2V0RHluYW1pY0RhdGEpIHtcclxuICAgICAgLy8g6Iul5q2k5YiX5piv5Yqo5oCB5Y2V5YWD5qC85YiXXHJcbiAgICAgIGN1cnJlbnRDb2wgPSBjdXJyZW50Q29sLmdldER5bmFtaWNEYXRhKGRhdGFJdGVtLCBjdXJyZW50Q29sKTtcclxuICAgIH1cclxuICAgIHRoaXMuc2V0VmFsdWUoZm9ybUNvbnRyb2xWYWx1ZSwgY3VycmVudENvbCk7XHJcbiAgfVxyXG5cclxuICAvKlxyXG4gICAgICog5Zue6L2mICDliIfmjaLljZXlhYPmoLxcclxuICAgICAqIEBwYXJhbSBldmVudCDplK7nm5jmjInkuIvkuovku7ZcclxuICAgICAqL1xyXG4gIEBIb3N0TGlzdGVuZXIoJ2tleWRvd24nLCBbJyRldmVudCddKVxyXG4gIGVudGVyQ2VsbChlOiBhbnkpIHtcclxuICAgIC8vIOWbnui9pumUrlxyXG4gICAgaWYgKCFlLnNoaWZ0S2V5ICYmIGUua2V5Q29kZSA9PT0gMTMpIHtcclxuICAgICAgLy8gdGV4dGFyZWEgZW50ZXIg5bGP6JS95o2i6KGM5pON5L2cXHJcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgaWYgKCF0aGlzLnNlbmRlcikge1xyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfVxyXG4gICAgICAvLyDnlLHkuo5rZXlkb3duIOS6i+S7tuS8muWFiOaJp+ihjO+8jOaJgOS7pei/memHjOWFiOimgeaJp+ihjGJsdXIg5LqL5Lu277ybXHJcbiAgICAgIGUudGFyZ2V0LmJsdXIoKTtcclxuICAgICAgdGhpcy5uZ1pvbmUucnVuT3V0c2lkZUFuZ3VsYXIoKCkgPT4ge1xyXG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgaWYgKHRoaXMucnRzICYmIHRoaXMucnRzLmdldEZvcm1TdGF0ZSgnbG9va3VwLnBlbmRpbmcnKSkge1xyXG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIHRoaXMuZW50ZXJOZXh0Q2VsbCgpO1xyXG4gICAgICAgIH0sIDIwMSk7XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLypcclxuICAgICAqIOe7keWummdyaWQgb3B0aW9uXHJcbiAgICAgKiBAcGFyYW0gZGF0YUl0ZW0g6KGM5pWw5o2uXHJcbiAgICAgKi9cclxuICBwcml2YXRlIGJpbmRpbmdHcmlkT3B0aW9uKCkge1xyXG4gICAgaWYgKCF0aGlzLmZhcnJpc0JpbmRpbmdHcmlkT3B0aW9uKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLmdyaWQsICdncmlkT3B0aW9uJywgeyB2YWx1ZTogdGhpcy5mYXJyaXNCaW5kaW5nR3JpZE9wdGlvbiB9KTtcclxuICB9XHJcblxyXG4gIC8qXHJcbiAgICog5pu05pawR3JpZOWIhumhteeKtuaAgVxyXG4gICAqIEBwYXJhbSB0YWtlXHJcbiAgICogQHBhcmFtIHNraXBcclxuICAgKi9cclxuICBwcml2YXRlIHVwZGF0ZVBhZ2VyKHRha2U6IG51bWJlciwgc2tpcDogbnVtYmVyKSB7XHJcbiAgICBpZiAodGFrZSA9PT0gMCkge1xyXG4gICAgICB0aGlzLmN1cnJlbnRTa2lwID0gMDtcclxuICAgICAgdGhpcy5wYWdlU2l6ZSA9IDA7XHJcbiAgICAgIHRoaXMuc2tpcCA9IDA7XHJcbiAgICAgIHRoaXMuZ3JpZC5wYWdlYWJsZSA9IGZhbHNlO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5jdXJyZW50U2tpcCA9IHNraXA7XHJcbiAgICAgIHRoaXMuc2tpcCA9IHNraXA7XHJcbiAgICAgIHRoaXMucGFnZVNpemUgPSB0YWtlO1xyXG4gICAgICB0aGlzLmdyaWQucGFnZWFibGUgPSB7XHJcbiAgICAgICAgYnV0dG9uQ291bnQ6IDEwLFxyXG4gICAgICAgIGluZm86IHRydWUsXHJcbiAgICAgICAgdHlwZTogJ251bWVyaWMnLFxyXG4gICAgICAgIHBhZ2VTaXplczogZmFsc2UsXHJcbiAgICAgICAgcHJldmlvdXNOZXh0OiB0cnVlXHJcbiAgICAgIH07XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKlxyXG4gICAqIOiuvue9ruWNleWFg+agvOWPr+e8lui+keaAp1xyXG4gICAqIEBwYXJhbSBkYXRhSXRlbSDooYzmlbDmja5cclxuICAgKiBAcGFyYW0gY29sdW1uIOWIl+WvueixoVxyXG4gICAqIEBwYXJhbSByb3dJbmRleCDooYzntKLlvJVcclxuICAgKiBAcGFyYW0gY29sdW1uSW5kZXgg5YiX57Si5byVXHJcbiAgICogQHBhcmFtIHNlbmRlciBncmlk5a6e5L6LXHJcbiAgICovXHJcbiAgc2V0RWRpdGFibGUocm93TnVtYmVyOiBudW1iZXIsIGNvbHVtbk51bWJlcjogbnVtYmVyKSB7XHJcbiAgICBjb25zdCBkYXRhID0gdGhpcy5ncmlkLmRhdGFbJ2RhdGEnXTtcclxuICAgIGNvbnN0IHsgcGFnZUluZGV4ID0gMSwgcGFnZVNpemUgPSAwIH0gPSB0aGlzLmdldFBhZ2luZ0luZm8oKSB8fCB7fTtcclxuICAgIGNvbnN0IHNraXAgPSB0aGlzLmJpbmRpbmdMaXN0LnNraXA7XHJcbiAgICAvLyDkuI3liIbpobXmiJbogIXnrKzkuIDpobXml7blj5bkuI3pnIDopoHkv67mlLnooYzlj7dcclxuICAgIGNvbnN0IGRhdGFSb3dOdW1iZXIgPSBwYWdlU2l6ZSA9PT0gMCB8fCBwYWdlSW5kZXggPT09IDEgPyByb3dOdW1iZXIgOiByb3dOdW1iZXIgLSBza2lwO1xyXG4gICAgbGV0IGl0ZW0gPSBkYXRhW2RhdGFSb3dOdW1iZXJdO1xyXG4gICAgaWYgKHRoaXMuZ3JpZE9wdGlvbi5ncm91cGFibGUpIHtcclxuICAgICAgaXRlbSA9IHRoaXMuZ2V0R3JvdXBJdGVtKGRhdGEsIGRhdGFSb3dOdW1iZXIpO1xyXG4gICAgfVxyXG4gICAgY29uc3Qgb3JpZ2luQ29sdW1zID0gdGhpcy5nZXRDb2x1bW5zKHRoaXMuZ3JpZE9wdGlvbi5maWVsZHMpO1xyXG4gICAgY29uc3QgY29sdW1ucyA9IHRoaXMuZ2V0Q29sdW1ucyhvcmlnaW5Db2x1bXMpO1xyXG4gICAgLyog5YGH5aaC5YiX55qE6aG65bqP5pS55Y+YIOavlOWmguWtmOWcqOWbuuWumuWIlyAg6YKj5LmI5bqU6K+l6I635Y+W55yf5q2j55qE5YiX5a+56LGhICovXHJcbiAgICAvLyBsZXQgY29sID0gY29sdW1uc1tjb2x1bW5OdW1iZXJdO1xyXG5cclxuICAgIGxldCB0ZW1wSW5kZXggPSBjb2x1bW5OdW1iZXI7XHJcbiAgICAvLyDlvZPliY3liJfntKLlvJXkuI3kuLowXHJcbiAgICBpZiAodGhpcy5ncmlkWydncmlkT3B0aW9uJ10uc2hvd0xpbmVOdW1iZXIpIHtcclxuICAgICAgdGVtcEluZGV4ID0gdGVtcEluZGV4IC0gMTtcclxuICAgIH1cclxuICAgIGlmICh0aGlzLmdyaWQuc2VsZWN0YWJsZSAmJiB0aGlzLmdyaWQuc2VsZWN0YWJsZVsnbW9kZSddID09PSAnbXVsdGlwbGUnKSB7XHJcbiAgICAgIHRlbXBJbmRleCA9IHRlbXBJbmRleCAtIDE7XHJcbiAgICB9XHJcbiAgICBjb25zdCBjb2wgPSBjb2x1bW5zW3RlbXBJbmRleF07XHJcblxyXG4gICAgY29uc3QgcGFyYW1zID0ge1xyXG4gICAgICBkYXRhSXRlbTogaXRlbSxcclxuICAgICAgY29sdW1uOiBjb2wsXHJcbiAgICAgIHJvd0luZGV4OiByb3dOdW1iZXIsXHJcbiAgICAgIGNvbHVtbkluZGV4OiB0ZW1wSW5kZXgsXHJcbiAgICB9O1xyXG5cclxuICAgIC8vIOaOp+WItuWNleWFg+agvOeahOWPr+e8lui+keaAp1xyXG4gICAgaWYgKGNvbCAmJiAhY29sLmVkaXRhYmxlKSB7XHJcbiAgICAgIGNvbC5lZGl0YWJsZSA9IChwYXJhbTogb2JqZWN0KSA9PiB0cnVlO1xyXG4gICAgfVxyXG4gICAgaWYgKGNvbCAmJiB0aGlzLm5vdFJlYWRPbmx5KGNvbCwgcGFyYW1zKSkge1xyXG4gICAgICAvLyDorr7nva7lvZPliY3ooYxcclxuICAgICAgdGhpcy5kYXRhSWQgPSB0aGlzLmdldFNlbGVjdGVkSWRGcm9tR3JpZChpdGVtKTtcclxuICAgICAgdGhpcy5zZXRTZWxlY3Rpb25JZFRvQmluZGluZ0RhdGEodGhpcy5kYXRhSWQpO1xyXG4gICAgICAvLyBjb25zdCB2YWx1ZSA9IHRoaXMuZ2V0VmFsdWUoaXRlbSwgY29sLmRhdGFGaWVsZCk7XHJcbiAgICAgIC8vIHRoaXMuc2V0VmFsdWUodmFsdWUsIGNvbCk7XHJcbiAgICAgIHRoaXMuc2VuZGVyLmVkaXRDZWxsKHJvd051bWJlciwgY29sdW1uTnVtYmVyIC0gdGhpcy5oaWRkZW5Db2xMZW4sIHRoaXMudmlld01vZGVsLmZvcm0pO1xyXG4gICAgfVxyXG5cclxuICB9XHJcbiAgLypcclxuICDojrflj5bmm7TmlrAgcm93SW5kZXggY29sdW1uSW5kZXhcclxuICAgKi9cclxuICB1cGRhdGVJbmRleChyb3dOdW1iZXI6IG51bWJlciwgY29sdW1uSW5kZXg6IG51bWJlcikge1xyXG4gICAgY29uc3QgbmV3Q29sdW1uSW5kZXggPSAoY29sdW1uSW5kZXggKyAxKSAlIHRoaXMubGVuO1xyXG4gICAgaWYgKCFuZXdDb2x1bW5JbmRleCkge1xyXG4gICAgICBjb25zdCBkYXRhTGVuID0gdGhpcy5iaW5kaW5nTGlzdC50b0pTT04oKS5sZW5ndGg7XHJcbiAgICAgIGNvbnN0IG5ld1Jvd0luZGV4ID0gKHJvd051bWJlciArIDEpICUgZGF0YUxlbjtcclxuICAgICAgcmV0dXJuIHsgcm93SW5kZXg6IG5ld1Jvd0luZGV4LCBjb2x1bW5JbmRleDogbmV3Q29sdW1uSW5kZXggfTtcclxuICAgIH1cclxuICAgIHJldHVybiB7XHJcbiAgICAgIHJvd0luZGV4OiByb3dOdW1iZXIsXHJcbiAgICAgIGNvbHVtbkluZGV4OiBuZXdDb2x1bW5JbmRleFxyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIC8qIOaYr+WQpuWPquivuyAqL1xyXG4gIG5vdFJlYWRPbmx5KGNvbHVtbjogYW55LCBwYXJhbTogYW55KSB7XHJcbiAgICBpZiAoIWNvbHVtbikge1xyXG4gICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gY29sdW1uLmVkaXRhYmxlKHBhcmFtKSAmJiAhY29sdW1uLmVkaXRvci5yZWFkb25seTtcclxuICB9XHJcblxyXG4gIC8qXHJcbiAgICAgKiDnu5nliJfooajotYvlgLwg5oiW57uZZm9ybWNvbnRyb2zotYvlgLxcclxuICAgICAgKi9cclxuICBzZXRWYWx1ZSh2YWx1ZTogYW55LCBjb2x1bW46IGFueSkge1xyXG4gICAgY29uc3QgY3VycmVudENvbHVtblR5cGUgPSBjb2x1bW4uZGF0YVR5cGU7XHJcbiAgICAvLyDlkIzml7bliKTmlq1ncmlkT3B0aW9u55qE5YiX5a+56LGhXHJcbiAgICBjb25zdCBiaW5kaW5nRGF0YSA9IHRoaXMudmlld01vZGVsLmJpbmRpbmdEYXRhO1xyXG4gICAgY29uc3QgZmllbGRQYXRocyA9IHRoaXMuZ2V0RmllbGRQYXRocyhiaW5kaW5nRGF0YS5iaW5kaW5nUGF0aCwgY29sdW1uLmRhdGFGaWVsZCk7XHJcbiAgICAvLyDlrZjlnKjooYznvJbovpHlmahcclxuICAgIGlmIChjdXJyZW50Q29sdW1uVHlwZSA9PT0gJ2RhdGUnKSB7XHJcbiAgICAgIGxldCBkYXRlU3RyID0gdGhpcy5kYXRlU2VydmljZS5mb3JtYXRUbyh2YWx1ZSwgJ3l5eXktTU0tZGQgSEg6bW06c3MnKTtcclxuICAgICAgaWYgKCFkYXRlU3RyKSB7XHJcbiAgICAgICAgZGF0ZVN0ciA9ICcnO1xyXG4gICAgICB9XHJcbiAgICAgIHRoaXMudmlld01vZGVsLmJpbmRpbmdEYXRhLnNldFZhbHVlKGZpZWxkUGF0aHMsIGRhdGVTdHIsIHRydWUsIHRydWUpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy52aWV3TW9kZWwuYmluZGluZ0RhdGEuc2V0VmFsdWUoZmllbGRQYXRocywgdmFsdWUsIHRydWUsIHRydWUpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyog5YiG57uE5pe2IOiOt+WPlueCueWHu+ihjOaVsOaNriAqL1xyXG4gIGdldEdyb3VwSXRlbShkYXRhOiBhbnlbXSwgcm93TnVtYmVyOiBudW1iZXIpIHtcclxuICAgIGxldCBpbmRleCA9IHJvd051bWJlcjtcclxuICAgIGZvciAoY29uc3QgaSBpbiBkYXRhKSB7XHJcbiAgICAgIGlmIChpbmRleCA8IGRhdGFbaV0uaXRlbXMubGVuZ3RoKSB7XHJcbiAgICAgICAgcmV0dXJuIGRhdGFbaV0uaXRlbXNbaW5kZXhdO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGluZGV4ID0gaW5kZXggLSBkYXRhW2ldLml0ZW1zLmxlbmd0aDtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLypcclxuICAgKiDojrflj5Yg5Y2V5YWD5qC85YC8ICDkuLvku47ooajmlK/mjIFcclxuICAgKiBAcGFyYW0gZGF0YUl0ZW0g6KGM5pWw5o2uXHJcbiAgICogQHBhcmFtIGZpZWxkIOWtl+autVxyXG4gICAqL1xyXG4gIGdldFZhbHVlKGRhdGFJdGVtOiBhbnksIGZpZWxkOiBzdHJpbmcpIHtcclxuICAgIGNvbnN0IGluZGV4ID0gZmllbGQuaW5kZXhPZignLicpO1xyXG4gICAgaWYgKGluZGV4IDwgMCkge1xyXG4gICAgICByZXR1cm4gZGF0YUl0ZW1bZmllbGRdO1xyXG4gICAgfVxyXG4gICAgY29uc3QgZmllbGRzID0gZmllbGQuc3BsaXQoJy4nKTtcclxuICAgIC8vIGZpZWxk5a2X56ym5Liy57uE5ZCIXHJcbiAgICByZXR1cm4gZmllbGRzLnJlZHVjZSgocmVzdWx0OiBhbnksIG5leHQ6IGFueSkgPT4ge1xyXG4gICAgICByZXR1cm4gcmVzdWx0W25leHRdO1xyXG4gICAgfSwgZGF0YUl0ZW0pO1xyXG4gIH1cclxuXHJcbiAgLypcclxuICAqIOiOt+WPliBiaW5kaW5nRGF0YSDot6/lvoRcclxuICAqIEBwYXJhbSBiaW5kaW5nUGF0aCDlvZPliY3nu5HlrprnmoTlrZfmrrXot6/lvoRcclxuICAqIEBwYXJhbSBmaWVsZE5hbWUg5a2X5q61XHJcbiAgKi9cclxuICBwcml2YXRlIGdldEZpZWxkUGF0aHMoYmluZGluZ1BhdGg6IHN0cmluZywgZmllbGQ6IHN0cmluZyk6IHN0cmluZ1tdIHtcclxuICAgIGxldCBmaWVsZFBhdGggPSAnJztcclxuICAgIGlmIChiaW5kaW5nUGF0aC5sZW5ndGggPiAxKSB7XHJcbiAgICAgIGZpZWxkUGF0aCA9IGJpbmRpbmdQYXRoLnN1YnN0cigxKS5yZXBsYWNlKC9cXC8vZywgJy4nKSArICcuJyArIGZpZWxkO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgZmllbGRQYXRoID0gZmllbGQ7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gZmllbGRQYXRoLnNwbGl0KCcuJyk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDlm57ovabov5vlhaXkuIvkuIDkuKrljZXlhYPmoLxcclxuICAgKi9cclxuICBlbnRlck5leHRDZWxsKCkge1xyXG4gICAgY29uc3QgaW5kZXggPSB0aGlzLnVwZGF0ZUluZGV4KHRoaXMucm93SW5kZXgsIHRoaXMuY29sdW1uSW5kZXgpO1xyXG4gICAgaWYgKCFpbmRleC5jb2x1bW5JbmRleCAmJiAhaW5kZXgucm93SW5kZXgpIHtcclxuICAgICAgY29uc3QgbGVuID0gdGhpcy5iaW5kaW5nTGlzdC50b0pTT04oKS5sZW5ndGg7XHJcbiAgICAgIC8vIOWmguaenOWtmOWcqOa3u+WKoOaVsOaNrueahEFQSVxyXG4gICAgICB0aGlzLmFwcGVuZFJvdy5lbWl0KCk7XHJcbiAgICAgIGlmICh0aGlzLmFwcGVuZFJvdy5vYnNlcnZlcnMgJiYgdGhpcy5hcHBlbmRSb3cub2JzZXJ2ZXJzLmxlbmd0aCkge1xyXG4gICAgICAgIHRoaXMuaW50ZXJWYWwgPSBzZXRJbnRlcnZhbCgoKSA9PiB7XHJcbiAgICAgICAgICBpZiAodGhpcy5iaW5kaW5nTGlzdC50b0pTT04oKS5sZW5ndGggLSAxID09PSBsZW4pIHtcclxuICAgICAgICAgICAgdGhpcy5zZXRFZGl0YWJsZSh0aGlzLmJpbmRpbmdMaXN0LnRvSlNPTigpLmxlbmd0aCAtIDEsIDApO1xyXG4gICAgICAgICAgICB0aGlzLnJvd0luZGV4ID0gdGhpcy5iaW5kaW5nTGlzdC50b0pTT04oKS5sZW5ndGggLSAxO1xyXG4gICAgICAgICAgICB0aGlzLmNvbHVtbkluZGV4ID0gMDtcclxuICAgICAgICAgICAgY2xlYXJJbnRlcnZhbCh0aGlzLmludGVyVmFsKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9LCAwKTtcclxuICAgICAgICByZXR1cm47XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICB0aGlzLnNldEVkaXRhYmxlKGluZGV4LnJvd0luZGV4LCBpbmRleC5jb2x1bW5JbmRleCk7XHJcbiAgICB0aGlzLnJvd0luZGV4ID0gaW5kZXgucm93SW5kZXg7XHJcbiAgICB0aGlzLmNvbHVtbkluZGV4ID0gaW5kZXguY29sdW1uSW5kZXg7XHJcbiAgfVxyXG5cclxuICAvKiDojrflj5bnnJ/mraPnmoTliJflr7nosaEgKi9cclxuICBnZXRDb2x1bW5zKGNvbHVtbnM6IGFueSkge1xyXG4gICAgLy8g5Yik5pat5piv5ZCm5a2Y5Zyo5Zu65a6a5YiXXHJcbiAgICBjb25zdCBoYXNMb2NrZWQgPSBjb2x1bW5zLnNvbWUoKGVsZTogYW55KSA9PiB7XHJcbiAgICAgIHJldHVybiBlbGUuZnJvemVuO1xyXG4gICAgfSk7XHJcbiAgICBpZiAoaGFzTG9ja2VkKSB7XHJcbiAgICAgIGNvbnN0IGxvY2tlZENvbHVtbnMgPSBjb2x1bW5zLmZpbHRlcigoZWxlOiBhbnkpID0+IHtcclxuICAgICAgICByZXR1cm4gZWxlLmZyb3plbjtcclxuICAgICAgfSk7XHJcbiAgICAgIGNvbnN0IG5vdExvY2tlZENvbHVtbnMgPSBjb2x1bW5zLmZpbHRlcigoZWxlOiBhbnkpID0+IHtcclxuICAgICAgICByZXR1cm4gIWVsZS5mcm96ZW47XHJcbiAgICAgIH0pO1xyXG4gICAgICByZXR1cm4gWy4uLmxvY2tlZENvbHVtbnMsIC4uLm5vdExvY2tlZENvbHVtbnNdO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGNvbHVtbnM7XHJcbiAgfVxyXG5cclxuICAvKlxyXG4gICAqIOa4suafk+aMh+WumuihjOS4uumAieS4reihjO+8muWwhuaMh+WumuihjOeahGtleea3u+WKoOWIsOmAieS4reihjOmbhuWQiOS4rVxyXG4gICAqL1xyXG4gIHByaXZhdGUgcmVuZGVyU2VsZWN0aW9uUm93KGtleTogc3RyaW5nLCBzZWxlY3RlZEtleXM6IGFueVtdKSB7XHJcbiAgICBpZiAoIWtleSB8fCBrZXkgPT09ICcnKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICAvLyBUT0RPOuS9v+eUqOetlueVpeaooeW8j+mHjeaehFxyXG4gICAgaWYgKHRoaXMuSXNNdWx0aXBsZVNlbGVjdGlvbk1vZGUpIHtcclxuICAgICAgY29uc3QgaW5kZXggPSBzZWxlY3RlZEtleXMuaW5kZXhPZihrZXkpO1xyXG4gICAgICBpZiAoaW5kZXggPj0gMCkge1xyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfVxyXG5cclxuICAgICAgc2VsZWN0ZWRLZXlzLnB1c2goa2V5KTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGlmIChzZWxlY3RlZEtleXMubGVuZ3RoID09PSAxICYmIHNlbGVjdGVkS2V5c1swXSA9PT0ga2V5KSB7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBzZWxlY3RlZEtleXMuc3BsaWNlKDAsIHNlbGVjdGVkS2V5cy5sZW5ndGgpO1xyXG4gICAgICBzZWxlY3RlZEtleXMucHVzaChrZXkpO1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMuc2VsZWN0aW9uRGlyLnNlbGVjdGVkS2V5c0NoYW5nZS5lbWl0KHNlbGVjdGVkS2V5cyk7IC8vIOaJi+WKqOinpuWPkXNlbGVjdGVkS2V5c0NoYW5nZeS6i+S7tlxyXG4gIH1cclxuXHJcbiAgLypcclxuICAgKiDojrflj5ZHcmlk5LiK55qE5b2T5YmN6KGM5YaF56CBXHJcbiAgICogQHBhcmFtIGRhdGFJdGVtIOihjOaVsOaNrlxyXG4gICAqL1xyXG4gIHByaXZhdGUgZ2V0U2VsZWN0ZWRJZEZyb21HcmlkKGRhdGFJdGVtOiBhbnkpIHtcclxuICAgIGNvbnN0IHByaW1hcnlLZXkgPSB0aGlzLmJpbmRpbmdMaXN0LnByaW1hcnlLZXk7XHJcbiAgICByZXR1cm4gZGF0YUl0ZW1bcHJpbWFyeUtleV07XHJcbiAgfVxyXG5cclxuICAvKlxyXG4gICAqIOiuvue9rkJpbmRpbmdMaXN055qE5b2T5YmN6KGMXHJcbiAgICogQHBhcmFtIGlkIOW9k+WJjeihjOWGheeggVxyXG4gICAqL1xyXG4gIHByaXZhdGUgc2V0U2VsZWN0aW9uSWRUb0JpbmRpbmdEYXRhKGlkOiBzdHJpbmcpOiB2b2lkIHtcclxuICAgIHRoaXMuYmluZGluZ0xpc3Quc2V0Q3VycmVudElkKGlkLCB0cnVlKTtcclxuICB9XHJcblxyXG4gIC8qXHJcbiAgKuWIl+ihqOaVtOS9k+aYr+WQpuWPr+e8lui+kVxyXG4gICAqL1xyXG4gIGlzRWRpdGFibGUoKSB7XHJcbiAgICBpZiAodGhpcy5lZGl0YWJsZSA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgIGlmICghdGhpcy52aWV3TW9kZWwuc3RhdGVNYWNoaW5lKSB7XHJcbiAgICAgICAgLy8g54q25oCB5py65LiN5a2Y5Zyo55qE5pe25YCZXHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICB9XHJcbiAgICAgIC8vIOeKtuaAgeacuuWtmOWcqOeahOaXtuWAmVxyXG4gICAgICByZXR1cm4gdGhpcy52aWV3TW9kZWwuc3RhdGVNYWNoaW5lWydlZGl0YWJsZSddO1xyXG4gICAgfVxyXG4gICAgLy8g6Ieq5a6a5LmJ6LWL5YC8XHJcbiAgICByZXR1cm4gdGhpcy5lZGl0YWJsZTtcclxuICB9XHJcbiAgLyogICovXHJcbiAgaXNEYXRhQ2hhbmdlZCgpIHtcclxuICAgIGxldCBoYXNVbnNhdmVkRGF0YSA9IGZhbHNlO1xyXG4gICAgY29uc3QgZW50aXR5QXJyYXkgPSB0aGlzLnZpZXdNb2RlbC5mcmFtZUNvbnRleHQucmVwb3NpdG9yeS5lbnRpdHlDb2xsZWN0aW9uLnRvQXJyYXkoKTtcclxuICAgIGZvciAoY29uc3QgZW50aXR5IG9mIGVudGl0eUFycmF5KSB7XHJcbiAgICAgIGlmIChlbnRpdHkuY2hhbmdlcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgaGFzVW5zYXZlZERhdGEgPSB0cnVlO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gaGFzVW5zYXZlZERhdGE7XHJcbiAgfVxyXG59XHJcbiJdfQ==
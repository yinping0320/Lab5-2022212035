/*
 * @Author: aalizzwell
 * @Date: 2020-02-27 11:33:41
 * @Last Modified by: aalizzwell
 * @Last Modified time: 2020-02-27 11:34:16
 */
// tslint:disable: no-string-literal
import { Directive, Input, HostListener, Output, EventEmitter } from '@angular/core';
import { FrameContext, ChangeType, ComponentType } from '@farris/devkit';
import { TreeTableComponent } from '@farris/ui-treetable';
import { Subject } from 'rxjs';
import { debounceTime } from 'rxjs/operators';
import { FarrisTreetableFormatService } from '../format/index';
import { TreeNodeBuilderFactory } from './tree_table_node_builder/tree_node_builder_factory';
/**
 * 树表格绑定指令
 */
class FarrisTreeTableBindingDirective {
    /**
     * 构造函数
     */
    constructor(treeTable, treetableFormatSer, frameContext) {
        this.treeTable = treeTable;
        this.treetableFormatSer = treetableFormatSer;
        this.frameContext = frameContext;
        this.renderSubject = new Subject();
        /**
         * 启用节点分页
         */
        // @Input('enableNodePagination')
        // public enableNodePagination: boolean;
        /**
         * 节点分页大小
         */
        this.nodePageSize = 100;
        /* 设置行样式 */
        this.rowClass = new EventEmitter();
        /* 设置列样式 */
        this.cellClass = new EventEmitter();
        this._PROP = null;
        this.listeners = [];
        this.storage = [];
        this.viewModel.uiState.setPropertyValue('ids', this.treeTable.checkValues);
        this.renderSubject.pipe(debounceTime(500)).subscribe(() => {
            this.bindData();
        });
    }
    /**
     * 绑定数据
     */
    get bindingData() {
        return this.frameContext.bindingData;
    }
    /**
     * 绑定数据列表
     */
    get bindingList() {
        // @todo：只支持主表，没有处理bindingPath
        return this.bindingData.list;
    }
    get prop() {
        return this._PROP;
    }
    set prop(value) {
        this._PROP = value;
    }
    /**
     * 获取当前vm
     */
    get viewModel() {
        return this.frameContext.viewModel;
    }
    /**
     * 指令初始化
     */
    ngOnInit() {
        // 将分级码信息保存到root-component，而非整个表单的app-context
        const virtualRootFrameContext = this.frameContext.getVirtualRootFrameContext();
        virtualRootFrameContext.setParam('hierarchyInfoKey', this.hierarchyInfoKey);
        this.bindData();
        this.bindingData.changes.subscribe((change) => {
            if (change && (change.type === ChangeType.ValueChanged || change.type === ChangeType.PaginationInfoChange)) {
                this.renderSubject.next(change);
            }
            else {
                this.bindData();
            }
            // 设置当前行
            const currentId = this.bindingList.currentId;
            if (!this.frameContext.bindingData.rowSelectedEventSuspend && currentId) {
                this.setSelectedIdToTree(this.bindingList.currentId);
            }
            this.updateCheckedRows(change);
        });
        // 设置 树表 格式化
        this.treetableFormatSer.setFormat(this.treeTable);
        /* 行样式 */
        this.rowClass.emit(this.treeTable);
        /* 列样式  单元格样式 */
        this.cellClass.emit(this.treeTable);
        this.setComponentRef();
        this.setNodePaginationInfo();
        this.registerEvent();
        if (this.frameContext && this.frameContext.frameComponent) {
            this.frameContext.frameComponent.componentType = ComponentType.farrisTreeTalbeComponent;
        }
    }
    /**
     * 指令输入变更
     */
    ngOnChanges(changes) {
    }
    registerEvent() {
        this.treeTable.columnSorted.subscribe((event) => {
            const { sortName = null, sortOrder = null } = event;
            const remoteSort = this.treeTable.remoteSort;
            if (remoteSort === false) {
                if (sortName && sortOrder) {
                    this.bindingList.sortBy(sortName, sortOrder);
                }
            }
            this.bindData();
        });
    }
    /**
     * 收集树组件实例
     */
    setComponentRef() {
        const appContext = this.viewModel && this.viewModel.frameContext && this.viewModel.frameContext.getFormAppContext();
        const frameId = this.viewModel && this.viewModel.frameContext && this.viewModel.frameContext.frameId;
        const id = this.treeTable && this.treeTable.el.nativeElement.id || null;
        // 如果frameId不存在或treetable没有id属性，说明不符合使用场景
        if (!frameId || !id) {
            return;
        }
        const map = appContext && appContext.componentRefs && appContext.componentRefs.get(frameId) || new Map();
        appContext && appContext.componentRefs && appContext.componentRefs.set(frameId, map.set(id, this.treeTable));
    }
    setNodePaginationInfo() {
        if (this.frameContext) {
            const enableNodePagination = this.treeTable.paginationForChildren || false; //this.enableNodePagination || false;
            this.frameContext.params.set('enableNodePagination', enableNodePagination);
            const nodePageSize = this.nodePageSize || 0;
            this.frameContext.params.set('nodePageSize', nodePageSize);
        }
    }
    /**
     * 绑定数据
     */
    bindData() {
        const oldTreeNodes = this.treeTable.data;
        const treeNodesData = this.bindingList.toJSON({ ignoreMultiLangInput: true });
        // if (!this.shouldComponentUpdate(treeNodesData)) {
        //   return;
        // }
        this.prop = treeNodesData;
        let treeNodes = [];
        if (!!treeNodesData && treeNodesData.length > 0) {
            const hierarchyInfo = treeNodesData[0][this.hierarchyInfoKey];
            let builder = this.builder;
            if (!builder) {
                this.builder = TreeNodeBuilderFactory.getBuilder(hierarchyInfo);
                builder = this.builder;
            }
            // 服务器返回的分级节点信息匹配不到现有工厂里面的任何一种情况。确认新加的builder已经在工厂中注册
            if (builder == null) {
                throw new Error('TreeTable builder is null!');
            }
            let expandLevel = -1;
            const treeExpandLevel = this.treeTable['expandLevel'];
            if (typeof treeExpandLevel !== 'undefined') {
                expandLevel = treeExpandLevel;
            }
            const virtualRootFrameContext = this.frameContext.getVirtualRootFrameContext();
            const nodesShouldExpand = (virtualRootFrameContext.params.get('_DEVKIT_expandRowIds') || '').split(',') || [];
            const context = {
                expandLevel,
                addTreeLoadCompleteListener: this.addTreeLoadCompleteListener.bind(this),
                component: this.treeTable,
                storage: this.storage,
                nodesShouldExpand: nodesShouldExpand,
                frameContext: this.frameContext,
            };
            //if (!this.treeNodesBuilder) {
            this.treeNodesBuilder = new builder(treeNodesData, oldTreeNodes, this.bindingList.primaryKey, this.hierarchyInfoKey, context);
            //}
            // this.treeNodesBuilder.updateTreeNode(treeNodesData, oldTreeNodes);
            treeNodes = this.treeNodesBuilder.build();
        }
        this.treeTable.data = treeNodes;
        // 设置分页信息
        this.updatePageInfo(this.treeTable);
        this.onTreeLoadComplete();
    }
    onTreeLoadComplete() {
        if (this.listeners && this.listeners.length > 0) {
            this.listeners.forEach(listener => {
                listener();
            });
        }
    }
    addTreeLoadCompleteListener(listener) {
        this.listeners.push(listener);
    }
    shouldComponentUpdate(newProp) {
        if (JSON.stringify(this.prop) === JSON.stringify(newProp)) {
            return false;
        }
        return true;
    }
    /**
     * 从树组件上获取选中行的id
     */
    getSelectedIdFromTree() {
        const selectedRow = this.treeTable.selectedRow;
        return selectedRow ? selectedRow.data['id'] : null;
    }
    /**
     * 设置TreeTable的当前行
     */
    setSelectedIdToTree(selectedId) {
        if (!selectedId) {
            return;
        }
        // 如果新的currentId和树上的selectedId不一致，重置树的当前行
        const oldSelectedId = this.getSelectedIdFromTree();
        const nodePageChanged = this.frameContext.params.get('_NODE_PAGE_CHANGED_') || false;
        if (!oldSelectedId && nodePageChanged) {
            this.frameContext.params.delete('_NODE_PAGE_CHANGED_');
            return;
        }
        if (oldSelectedId !== selectedId) {
            this.treeTable.clearSelections();
            this.treeTable.selectNode(selectedId);
        }
    }
    /**
     * 设置BindingList的CurrentId
     */
    setCurrentIdToBindingList(selectedId) {
        const oldCurrentId = this.bindingData.list.currentId;
        // 单选模式下将当前行设置到ids
        if (!this.treeTable.multiSelect) {
            this.setChecks(selectedId);
            this.setCheckedRows([selectedId]);
        }
        if (oldCurrentId === selectedId) {
            return;
        }
        this.bindingData.list.setCurrentId(selectedId, true);
    }
    updateCheckedRows(changes) {
        if (changes.type === ChangeType.Load) {
            this.setCheckedRows();
        }
        else if (changes.type === ChangeType.ValueChanged || changes.type === ChangeType.Remove) {
            const ids = this.getChecks();
            if (changes.id && ids.includes(changes.id)) {
                this.setCheckedRows();
            }
        }
    }
    /**
     * 更新勾选行数据
     */
    setCheckedRows(ids) {
        if (typeof ids === 'undefined') {
            ids = this.viewModel.uiState['ids'] || [];
        }
        if (!Array.isArray(ids)) {
            return;
        }
        const list = this.bindingList.toJSON();
        const rows = this.viewModel.uiState['rows'] || new Map();
        const result = new Map();
        ids.forEach((id) => {
            const item = list.find(item => item[this.bindingList.primaryKey] === id);
            const otherPageItem = rows.get(id);
            if (item) {
                result.set(id, item);
            }
            else if (otherPageItem) {
                result.set(id, otherPageItem);
            }
        });
        this.viewModel.uiState.setPropertyValue('rows', result);
    }
    /**
     * 设置ids变量
     * @param idOrIds id or ids
     */
    setChecks(idOrIds) {
        if (typeof idOrIds === 'string') {
            idOrIds = idOrIds.split(',').filter(p => p);
        }
        this.viewModel.uiState.setPropertyValue('ids', idOrIds);
    }
    /**
     * 获取勾选行id数组
     * @returns
     */
    getChecks() {
        return this.viewModel.uiState['ids'] || [];
    }
    /**
     * 获取分页信息
     */
    getPagingInfo() {
        const bindingPath = this.viewModel.bindingPath;
        const bindingData = this.viewModel.bindingData;
        let pagingInfo = bindingData.pagingInfo;
        if (bindingPath === '/') {
            return pagingInfo;
        }
        else {
            const bindingPaths = bindingPath.substr(1).split('/').filter(item => !!item && item.length > 0).map(item => {
                return item.substring(0, item.length - 1);
            });
            bindingPaths.forEach(path => {
                pagingInfo = pagingInfo && pagingInfo[path];
            });
            return pagingInfo;
        }
    }
    updatePageInfo(treeTable) {
        const { pageIndex, pageSize, total } = this.getPagingInfo();
        if (pageSize === 0) {
            treeTable.pagination = false;
            return;
        }
        treeTable.pagination = true;
        treeTable.updatePageInfo({ pageIndex, pageSize, total });
    }
    //#region 组件事件
    /**
     * 行切换
     */
    selectionChangeHandler(event) {
        if (event && event.node && event.node.hasOwnProperty('data')) {
            const idField = this.treeTable.idField;
            const id = event.node.data[idField];
            this.setCurrentIdToBindingList(id);
        }
    }
    /**
     * 勾选节点发生变化
     * @param event event
     */
    checkValuesChange(event) {
        // this.viewModel.uiState.setPropertyValue('ids', this.treeTable.checkValues);
        this.setChecks(this.treeTable.checkValues);
        this.setCheckedRows();
    }
    /**
     * 将被展开的节点设置为当前行
     */
    expandHandler(event) {
        const selectedId = event.data['id'];
        const virtualRootFrameContext = this.frameContext.getVirtualRootFrameContext();
        // 展开时不再选中
        // this.setSelectedIdToTree(selectedId);
        const expandNodes = virtualRootFrameContext.getParam('TREE_LATEST_EXPANDED_ID') || [];
        expandNodes.push(selectedId);
        virtualRootFrameContext.setParam('TREE_LATEST_EXPANDED_ID', expandNodes);
    }
    onPageChanged(event) {
        let { pageSize = 20, pageIndex = 1 } = event || {};
        if (pageIndex < 1) {
            pageIndex = 1;
        }
        const skip = (pageIndex - 1) * pageSize;
        this.bindingData.setPagingInfo(skip, pageSize, this.bindingData.bindingPath);
    }
    onPageSizeChanged(event) {
        const pageSize = event ? event : 20;
        const skip = 0;
        this.bindingData.setPagingInfo(skip, pageSize, this.bindingData.bindingPath);
    }
    /**
     * 节点页码切换事件
     * @param event event
     */
    onNodePageChanged(event) {
        const { pageIndex = 1, pageSize = this.nodePageSize, node = {} } = event;
        const id = node && node.id || null;
        if (id) {
            const virtualRootFrameContext = this.frameContext.getVirtualRootFrameContext();
            const expandNodes = virtualRootFrameContext.getParam('TREE_LATEST_EXPANDED_ID') || [];
            expandNodes.push(id);
            virtualRootFrameContext.setParam('TREE_LATEST_EXPANDED_ID', expandNodes);
            this.frameContext.params.set(`_NODE_${id}_PAGE_INDEX_`, pageIndex);
            this.frameContext.params.set(`_RELOAD_CHILDREN_`, true);
            this.frameContext.params.set('_NODE_PAGE_CHANGED_', true);
        }
    }
}
FarrisTreeTableBindingDirective.decorators = [
    { type: Directive, args: [{
                selector: '[farrisTreeTableBinding]'
            },] }
];
/** @nocollapse */
FarrisTreeTableBindingDirective.ctorParameters = () => [
    { type: TreeTableComponent },
    { type: FarrisTreetableFormatService },
    { type: FrameContext }
];
FarrisTreeTableBindingDirective.propDecorators = {
    hierarchyInfoKey: [{ type: Input, args: ['farrisHierarchyInfoKey',] }],
    rowClassName: [{ type: Input }],
    cellClassName: [{ type: Input }],
    nodePageSize: [{ type: Input, args: ['nodePageSize',] }],
    rowClass: [{ type: Output }],
    cellClass: [{ type: Output }],
    selectionChangeHandler: [{ type: HostListener, args: ['nodeSelected', ['$event'],] }],
    checkValuesChange: [{ type: HostListener, args: ['checkValuesChange', ['$event'],] }],
    expandHandler: [{ type: HostListener, args: ['expand', ['$event'],] }],
    onPageChanged: [{ type: HostListener, args: ['pageChanged', ['$event'],] }],
    onPageSizeChanged: [{ type: HostListener, args: ['pageSizeChanged', ['$event'],] }],
    onNodePageChanged: [{ type: HostListener, args: ['childsPageChanged', ['$event'],] }]
};
export { FarrisTreeTableBindingDirective };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmFycmlzX3RyZWVfdGFibGVfYmluZGluZy5kaXJlY3RpdmUuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL2tlbmRvLWJpbmRpbmcvIiwic291cmNlcyI6WyJsaWIvZGlyZWN0aXZlcy9mYXJyaXNfdHJlZV90YWJsZV9iaW5kaW5nLmRpcmVjdGl2ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7R0FLRztBQUNILG9DQUFvQztBQUVwQyxPQUFPLEVBQUUsU0FBUyxFQUFvQyxLQUFLLEVBQUUsWUFBWSxFQUFRLE1BQU0sRUFBRSxZQUFZLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDN0gsT0FBTyxFQUE0QixZQUFZLEVBQVUsVUFBVSxFQUFFLGFBQWEsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQzNHLE9BQU8sRUFBRSxrQkFBa0IsRUFBWSxNQUFNLHNCQUFzQixDQUFDO0FBQ3BFLE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDL0IsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQzlDLE9BQU8sRUFBRSw0QkFBNEIsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQy9ELE9BQU8sRUFBRSxzQkFBc0IsRUFBRSxNQUFNLHFEQUFxRCxDQUFDO0FBRTdGOztHQUVHO0FBQ0gsTUFHTSwrQkFBK0I7SUF1RW5DOztPQUVHO0lBQ0gsWUFDVSxTQUE2QixFQUM3QixrQkFBZ0QsRUFDaEQsWUFBMEI7UUFGMUIsY0FBUyxHQUFULFNBQVMsQ0FBb0I7UUFDN0IsdUJBQWtCLEdBQWxCLGtCQUFrQixDQUE4QjtRQUNoRCxpQkFBWSxHQUFaLFlBQVksQ0FBYztRQXhFNUIsa0JBQWEsR0FBaUIsSUFBSSxPQUFPLEVBQU8sQ0FBQztRQWlCekQ7O1dBRUc7UUFDSCxpQ0FBaUM7UUFDakMsd0NBQXdDO1FBQ3hDOztXQUVHO1FBRUksaUJBQVksR0FBVyxHQUFHLENBQUM7UUFrQmxDLFdBQVc7UUFFWCxhQUFRLEdBQXNCLElB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QUMsQ0FBQztZQUNyQix1QkFBdUIsQ0FBQyxRQUFRLENBQUMseUJBQXlCLEVBQUUsV0FBVyxDQUFDLENBQUM7WUFDekUsSUFBSSxDQUFDLFlBQVksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLFNBQVMsRUFBRSxjQUFjLEVBQUUsU0FBUyxDQUFDLENBQUM7WUFDbkUsSUFBSSxDQUFDLFlBQVksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLG1CQUFtQixFQUFFLElBQUksQ0FBQyxDQUFDO1lBQ3hELElBQUksQ0FBQyxZQUFZLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxxQkFBcUIsRUFBRSxJQUFJLENBQUMsQ0FBQztTQUMzRDtJQUNILENBQUM7OztZQTlhRixTQUFTLFNBQUM7Z0JBQ1QsUUFBUSxFQUFFLDBCQUEwQjthQUNyQzs7OztZQVhRLGtCQUFrQjtZQUdsQiw0QkFBNEI7WUFKRixZQUFZOzs7K0JBeUI1QyxLQUFLLFNBQUMsd0JBQXdCOzJCQUk5QixLQUFLOzRCQUlMLEtBQUs7MkJBVUwsS0FBSyxTQUFDLGNBQWM7dUJBb0JwQixNQUFNO3dCQUlOLE1BQU07cUNBc1ROLFlBQVksU0FBQyxjQUFjLEVBQUUsQ0FBQyxRQUFRLENBQUM7Z0NBWXZDLFlBQVksU0FBQyxtQkFBbUIsRUFBRSxDQUFDLFFBQVEsQ0FBQzs0QkFTNUMsWUFBWSxTQUFDLFFBQVEsRUFBRSxDQUFDLFFBQVEsQ0FBQzs0QkFVakMsWUFBWSxTQUFDLGFBQWEsRUFBRSxDQUFDLFFBQVEsQ0FBQztnQ0FTdEMsWUFBWSxTQUFDLGlCQUFpQixFQUFFLENBQUMsUUFBUSxDQUFDO2dDQVUxQyxZQUFZLFNBQUMsbUJBQW1CLEVBQUUsQ0FBQyxRQUFRLENBQUM7O0FBaUIvQyxPQUFPLEVBQUUsK0JBQStCLEVBQUUsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8qXHJcbiAqIEBBdXRob3I6IGFhbGl6endlbGwgXHJcbiAqIEBEYXRlOiAyMDIwLTAyLTI3IDExOjMzOjQxIFxyXG4gKiBATGFzdCBNb2RpZmllZCBieTogYWFsaXp6d2VsbFxyXG4gKiBATGFzdCBNb2RpZmllZCB0aW1lOiAyMDIwLTAyLTI3IDExOjM0OjE2XHJcbiAqL1xyXG4vLyB0c2xpbnQ6ZGlzYWJsZTogbm8tc3RyaW5nLWxpdGVyYWxcclxuXHJcbmltcG9ydCB7IERpcmVjdGl2ZSwgT25Jbml0LCBPbkNoYW5nZXMsIFNpbXBsZUNoYW5nZXMsIElucHV0LCBIb3N0TGlzdGVuZXIsIFR5cGUsIE91dHB1dCwgRXZlbnRFbWl0dGVyIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IEJpbmRpbmdEYXRhLCBCaW5kaW5nTGlzdCwgRnJhbWVDb250ZXh0LCBDaGFuZ2UsIENoYW5nZVR5cGUsIENvbXBvbmVudFR5cGUgfSBmcm9tICdAZmFycmlzL2RldmtpdCc7XHJcbmltcG9ydCB7IFRyZWVUYWJsZUNvbXBvbmVudCwgVHJlZU5vZGUgfSBmcm9tICdAZmFycmlzL3VpLXRyZWV0YWJsZSc7XHJcbmltcG9ydCB7IFN1YmplY3QgfSBmcm9tICdyeGpzJztcclxuaW1wb3J0IHsgZGVib3VuY2VUaW1lIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xyXG5pbXBvcnQgeyBGYXJyaXNUcmVldGFibGVGb3JtYXRTZXJ2aWNlIH0gZnJvbSAnLi4vZm9ybWF0L2luZGV4JztcclxuaW1wb3J0IHsgVHJlZU5vZGVCdWlsZGVyRmFjdG9yeSB9IGZyb20gJy4vdHJlZV90YWJsZV9ub2RlX2J1aWxkZXIvdHJlZV9ub2RlX2J1aWxkZXJfZmFjdG9yeSc7XHJcblxyXG4vKipcclxuICog5qCR6KGo5qC857uR5a6a5oyH5LukXHJcbiAqL1xyXG5ARGlyZWN0aXZlKHtcclxuICBzZWxlY3RvcjogJ1tmYXJyaXNUcmVlVGFibGVCaW5kaW5nXSdcclxufSlcclxuY2xhc3MgRmFycmlzVHJlZVRhYmxlQmluZGluZ0RpcmVjdGl2ZSBpbXBsZW1lbnRzIE9uSW5pdCwgT25DaGFuZ2VzIHtcclxuICAvKipcclxuICAgKiDmoJHlrZjlgqjnqbrpl7RcclxuICAgKi9cclxuICBwcml2YXRlIHN0b3JhZ2U6IGFueTtcclxuICBwcml2YXRlIHJlbmRlclN1YmplY3Q6IFN1YmplY3Q8YW55PiA9IG5ldyBTdWJqZWN0PGFueT4oKTtcclxuICBwcml2YXRlIGJ1aWxkZXI6IFR5cGU8YW55PjtcclxuICBwcml2YXRlIHRyZWVOb2Rlc0J1aWxkZXI6IGFueTtcclxuICAvKipcclxuICAgKiDliIbnuqfnoIHkv6Hmga/nmoRrZXlcclxuICAgKi9cclxuICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6IG5vLWlucHV0LXJlbmFtZVxyXG4gIEBJbnB1dCgnZmFycmlzSGllcmFyY2h5SW5mb0tleScpXHJcbiAgcHVibGljIGhpZXJhcmNoeUluZm9LZXk6IHN0cmluZztcclxuXHJcbiAgLyog6KGM5qC35byPICovXHJcbiAgQElucHV0KClcclxuICByb3dDbGFzc05hbWU6IChjb250ZXh0OiBhbnkpID0+IGFueTtcclxuXHJcbiAgLyog5YiX5ZKM5Y2V5YWD5qC85qC35byPICovXHJcbiAgQElucHV0KClcclxuICBjZWxsQ2xhc3NOYW1lOiAoZGF0YTogYW55LCBmaWVsZDogYW55KSA9PiBhbnk7XHJcbiAgLyoqXHJcbiAgICog5ZCv55So6IqC54K55YiG6aG1XHJcbiAgICovXHJcbiAgLy8gQElucHV0KCdlbmFibGVOb2RlUGFnaW5hdGlvbicpXHJcbiAgLy8gcHVibGljIGVuYWJsZU5vZGVQYWdpbmF0aW9uOiBib29sZWFuO1xyXG4gIC8qKlxyXG4gICAqIOiKgueCueWIhumhteWkp+Wwj1xyXG4gICAqL1xyXG4gIEBJbnB1dCgnbm9kZVBhZ2VTaXplJylcclxuICBwdWJsaWMgbm9kZVBhZ2VTaXplOiBudW1iZXIgPSAxMDA7XHJcbiAgLyoqXHJcbiAgICog57uR5a6a5pWw5o2uXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBnZXQgYmluZGluZ0RhdGEoKTogQmluZGluZ0RhdGEge1xyXG4gICAgcmV0dXJuIHRoaXMuZnJhbWVDb250ZXh0LmJpbmRpbmdEYXRhO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog57uR5a6a5pWw5o2u5YiX6KGoXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBnZXQgYmluZGluZ0xpc3QoKTogQmluZGluZ0xpc3Qge1xyXG5cclxuICAgIC8vIEB0b2Rv77ya5Y+q5pSv5oyB5Li76KGo77yM5rKh5pyJ5aSE55CGYmluZGluZ1BhdGhcclxuICAgIHJldHVybiB0aGlzLmJpbmRpbmdEYXRhLmxpc3Q7XHJcbiAgfVxyXG5cclxuXHJcbiAgLyog6K6+572u6KGM5qC35byPICovXHJcbiAgQE91dHB1dCgpXHJcbiAgcm93Q2xhc3M6IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XHJcblxyXG4gIC8qIOiuvue9ruWIl+agt+W8jyAqL1xyXG4gIEBPdXRwdXQoKVxyXG4gIGNlbGxDbGFzczogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcclxuXHJcbiAgcHJpdmF0ZSBfUFJPUDogYW55ID0gbnVsbDtcclxuICBwcml2YXRlIGxpc3RlbmVyczogYW55W107XHJcbiAgcHJpdmF0ZSBnZXQgcHJvcCgpIHtcclxuICAgIHJldHVybiB0aGlzLl9QUk9QO1xyXG4gIH1cclxuICBwcml2YXRlIHNldCBwcm9wKHZhbHVlKSB7XHJcbiAgICB0aGlzLl9QUk9QID0gdmFsdWU7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOiOt+WPluW9k+WJjXZtXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBnZXQgdmlld01vZGVsKCkge1xyXG4gICAgcmV0dXJuIHRoaXMuZnJhbWVDb250ZXh0LnZpZXdNb2RlbDtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5p6E6YCg5Ye95pWwXHJcbiAgICovXHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICBwcml2YXRlIHRyZWVUYWJsZTogVHJlZVRhYmxlQ29tcG9uZW50LFxyXG4gICAgcHJpdmF0ZSB0cmVldGFibGVGb3JtYXRTZXI6IEZhcnJpc1RyZWV0YWJsZUZvcm1hdFNlcnZpY2UsXHJcbiAgICBwcml2YXRlIGZyYW1lQ29udGV4dDogRnJhbWVDb250ZXh0XHJcbiAgKSB7XHJcbiAgICB0aGlzLmxpc3RlbmVycyA9IFtdO1xyXG4gICAgdGhpcy5zdG9yYWdlID0gW107XHJcbiAgICB0aGlzLnZpZXdNb2RlbC51aVN0YXRlLnNldFByb3BlcnR5VmFsdWUoJ2lkcycsIHRoaXMudHJlZVRhYmxlLmNoZWNrVmFsdWVzKTtcclxuICAgIHRoaXMucmVuZGVyU3ViamVjdC5waXBlKFxyXG4gICAgICBkZWJvdW5jZVRpbWUoNTAwKVxyXG4gICAgKS5zdWJzY3JpYmUoKCkgPT4ge1xyXG4gICAgICB0aGlzLmJpbmREYXRhKCk7XHJcbiAgICB9KTtcclxuXHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDmjIfku6TliJ3lp4vljJZcclxuICAgKi9cclxuICBuZ09uSW5pdCgpIHtcclxuICAgIC8vIOWwhuWIhue6p+eggeS/oeaBr+S/neWtmOWIsHJvb3QtY29tcG9uZW5077yM6ICM6Z2e5pW05Liq6KGo5Y2V55qEYXBwLWNvbnRleHRcclxuICAgIGNvbnN0IHZpcnR1YWxSb290RnJhbWVDb250ZXh0ID0gdGhpcy5mcmFtZUNvbnRleHQuZ2V0VmlydHVhbFJvb3RGcmFtZUNvbnRleHQoKTtcclxuICAgIHZpcnR1YWxSb290RnJhbWVDb250ZXh0LnNldFBhcmFtKCdoaWVyYXJjaHlJbmZvS2V5JywgdGhpcy5oaWVyYXJjaHlJbmZvS2V5KTtcclxuICAgIHRoaXMuYmluZERhdGEoKTtcclxuICAgIHRoaXMuYmluZGluZ0RhdGEuY2hhbmdlcy5zdWJzY3JpYmUoKGNoYW5nZTogQ2hhbmdlKSA9PiB7XHJcbiAgICAgIGlmIChjaGFuZ2UgJiYgKGNoYW5nZS50eXBlID09PSBDaGFuZ2VUeXBlLlZhbHVlQ2hhbmdlZCB8fCBjaGFuZ2UudHlwZSA9PT0gQ2hhbmdlVHlwZS5QYWdpbmF0aW9uSW5mb0NoYW5nZSkpIHtcclxuICAgICAgICB0aGlzLnJlbmRlclN1YmplY3QubmV4dChjaGFuZ2UpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHRoaXMuYmluZERhdGEoKTtcclxuICAgICAgfVxyXG4gICAgICAvLyDorr7nva7lvZPliY3ooYxcclxuICAgICAgY29uc3QgY3VycmVudElkID0gdGhpcy5iaW5kaW5nTGlzdC5jdXJyZW50SWQ7XHJcbiAgICAgIGlmICghdGhpcy5mcmFtZUNvbnRleHQuYmluZGluZ0RhdGEucm93U2VsZWN0ZWRFdmVudFN1c3BlbmQgJiYgY3VycmVudElkKSB7XHJcbiAgICAgICAgdGhpcy5zZXRTZWxlY3RlZElkVG9UcmVlKHRoaXMuYmluZGluZ0xpc3QuY3VycmVudElkKTtcclxuICAgICAgfVxyXG4gICAgICB0aGlzLnVwZGF0ZUNoZWNrZWRSb3dzKGNoYW5nZSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICAvLyDorr7nva4g5qCR6KGoIOagvOW8j+WMllxyXG4gICAgdGhpcy50cmVldGFibGVGb3JtYXRTZXIuc2V0Rm9ybWF0KHRoaXMudHJlZVRhYmxlKTtcclxuXHJcbiAgICAvKiDooYzmoLflvI8gKi9cclxuICAgIHRoaXMucm93Q2xhc3MuZW1pdCh0aGlzLnRyZWVUYWJsZSk7XHJcblxyXG4gICAgLyog5YiX5qC35byPICDljZXlhYPmoLzmoLflvI8gKi9cclxuICAgIHRoaXMuY2VsbENsYXNzLmVtaXQodGhpcy50cmVlVGFibGUpO1xyXG4gICAgdGhpcy5zZXRDb21wb25lbnRSZWYoKTtcclxuICAgIHRoaXMuc2V0Tm9kZVBhZ2luYXRpb25JbmZvKCk7XHJcbiAgICB0aGlzLnJlZ2lzdGVyRXZlbnQoKTtcclxuICAgIGlmICh0aGlzLmZyYW1lQ29udGV4dCAmJiB0aGlzLmZyYW1lQ29udGV4dC5mcmFtZUNvbXBvbmVudCkge1xyXG4gICAgICB0aGlzLmZyYW1lQ29udGV4dC5mcmFtZUNvbXBvbmVudC5jb21wb25lbnRUeXBlID0gQ29tcG9uZW50VHlwZS5mYXJyaXNUcmVlVGFsYmVDb21wb25lbnQ7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDmjIfku6TovpPlhaXlj5jmm7RcclxuICAgKi9cclxuICBuZ09uQ2hhbmdlcyhjaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKSB7XHJcbiAgfVxyXG4gIHByaXZhdGUgcmVnaXN0ZXJFdmVudCgpIHtcclxuICAgIHRoaXMudHJlZVRhYmxlLmNvbHVtblNvcnRlZC5zdWJzY3JpYmUoKGV2ZW50OiB7IHNvcnROYW1lOiBzdHJpbmcsIHNvcnRPcmRlcjogc3RyaW5nIH0pID0+IHtcclxuICAgICAgY29uc3QgeyBzb3J0TmFtZSA9IG51bGwsIHNvcnRPcmRlciA9IG51bGwgfSA9IGV2ZW50O1xyXG4gICAgICBjb25zdCByZW1vdGVTb3J0ID0gdGhpcy50cmVlVGFibGUucmVtb3RlU29ydDtcclxuICAgICAgaWYgKHJlbW90ZVNvcnQgPT09IGZhbHNlKSB7XHJcbiAgICAgICAgaWYgKHNvcnROYW1lICYmIHNvcnRPcmRlcikge1xyXG4gICAgICAgICAgdGhpcy5iaW5kaW5nTGlzdC5zb3J0Qnkoc29ydE5hbWUsIHNvcnRPcmRlcik7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICAgIHRoaXMuYmluZERhdGEoKTtcclxuICAgIH0pO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDmlLbpm4bmoJHnu4Tku7blrp7kvotcclxuICAgKi9cclxuICBwcml2YXRlIHNldENvbXBvbmVudFJlZigpIHtcclxuICAgIGNvbnN0IGFwcENvbnRleHQgPSB0aGlzLnZpZXdNb2RlbCAmJiB0aGlzLnZpZXdNb2RlbC5mcmFtZUNvbnRleHQgJiYgdGhpcy52aWV3TW9kZWwuZnJhbWVDb250ZXh0LmdldEZvcm1BcHBDb250ZXh0KCk7XHJcbiAgICBjb25zdCBmcmFtZUlkID0gdGhpcy52aWV3TW9kZWwgJiYgdGhpcy52aWV3TW9kZWwuZnJhbWVDb250ZXh0ICYmIHRoaXMudmlld01vZGVsLmZyYW1lQ29udGV4dC5mcmFtZUlkO1xyXG4gICAgY29uc3QgaWQgPSB0aGlzLnRyZWVUYWJsZSAmJiB0aGlzLnRyZWVUYWJsZS5lbC5uYXRpdmVFbGVtZW50LmlkIHx8IG51bGw7XHJcbiAgICAvLyDlpoLmnpxmcmFtZUlk5LiN5a2Y5Zyo5oiWdHJlZXRhYmxl5rKh5pyJaWTlsZ7mgKfvvIzor7TmmI7kuI3nrKblkIjkvb/nlKjlnLrmma9cclxuICAgIGlmICghZnJhbWVJZCB8fCAhaWQpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgY29uc3QgbWFwID0gYXBwQ29udGV4dCAmJiBhcHBDb250ZXh0LmNvbXBvbmVudFJlZnMgJiYgYXBwQ29udGV4dC5jb21wb25lbnRSZWZzLmdldChmcmFtZUlkKSB8fCBuZXcgTWFwPHN0cmluZywgYW55PigpO1xyXG4gICAgYXBwQ29udGV4dCAmJiBhcHBDb250ZXh0LmNvbXBvbmVudFJlZnMgJiYgYXBwQ29udGV4dC5jb21wb25lbnRSZWZzLnNldChmcmFtZUlkLCBtYXAuc2V0KGlkLCB0aGlzLnRyZWVUYWJsZSkpO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBzZXROb2RlUGFnaW5hdGlvbkluZm8oKSB7XHJcbiAgICBpZiAodGhpcy5mcmFtZUNvbnRleHQpIHtcclxuICAgICAgY29uc3QgZW5hYmxlTm9kZVBhZ2luYXRpb24gPSB0aGlzLnRyZWVUYWJsZS5wYWdpbmF0aW9uRm9yQ2hpbGRyZW4gfHwgZmFsc2U7Ly90aGlzLmVuYWJsZU5vZGVQYWdpbmF0aW9uIHx8IGZhbHNlO1xyXG4gICAgICB0aGlzLmZyYW1lQ29udGV4dC5wYXJhbXMuc2V0KCdlbmFibGVOb2RlUGFnaW5hdGlvbicsIGVuYWJsZU5vZGVQYWdpbmF0aW9uKTtcclxuICAgICAgY29uc3Qgbm9kZVBhZ2VTaXplID0gdGhpcy5ub2RlUGFnZVNpemUgfHwgMDtcclxuICAgICAgdGhpcy5mcmFtZUNvbnRleHQucGFyYW1zLnNldCgnbm9kZVBhZ2VTaXplJywgbm9kZVBhZ2VTaXplKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOe7keWumuaVsOaNrlxyXG4gICAqL1xyXG4gIHByaXZhdGUgYmluZERhdGEoKSB7XHJcbiAgICBjb25zdCBvbGRUcmVlTm9kZXMgPSB0aGlzLnRyZWVUYWJsZS5kYXRhO1xyXG4gICAgY29uc3QgdHJlZU5vZGVzRGF0YSA9IHRoaXMuYmluZGluZ0xpc3QudG9KU09OKHsgaWdub3JlTXVsdGlMYW5nSW5wdXQ6IHRydWUgfSk7XHJcbiAgICAvLyBpZiAoIXRoaXMuc2hvdWxkQ29tcG9uZW50VXBkYXRlKHRyZWVOb2Rlc0RhdGEpKSB7XHJcbiAgICAvLyAgIHJldHVybjtcclxuICAgIC8vIH1cclxuICAgIHRoaXMucHJvcCA9IHRyZWVOb2Rlc0RhdGE7XHJcblxyXG4gICAgbGV0IHRyZWVOb2RlczogVHJlZU5vZGVbXSA9IFtdO1xyXG4gICAgaWYgKCEhdHJlZU5vZGVzRGF0YSAmJiB0cmVlTm9kZXNEYXRhLmxlbmd0aCA+IDApIHtcclxuICAgICAgY29uc3QgaGllcmFyY2h5SW5mbyA9IHRyZWVOb2Rlc0RhdGFbMF1bdGhpcy5oaWVyYXJjaHlJbmZvS2V5XTtcclxuICAgICAgbGV0IGJ1aWxkZXI6IFR5cGU8YW55PiA9IHRoaXMuYnVpbGRlcjtcclxuICAgICAgaWYgKCFidWlsZGVyKSB7XHJcbiAgICAgICAgdGhpcy5idWlsZGVyID0gVHJlZU5vZGVCdWlsZGVyRmFjdG9yeS5nZXRCdWlsZGVyKGhpZXJhcmNoeUluZm8pO1xyXG4gICAgICAgIGJ1aWxkZXIgPSB0aGlzLmJ1aWxkZXI7XHJcbiAgICAgIH1cclxuICAgICAgLy8g5pyN5Yqh5Zmo6L+U5Zue55qE5YiG57qn6IqC54K55L+h5oGv5Yy56YWN5LiN5Yiw546w5pyJ5bel5Y6C6YeM6Z2i55qE5Lu75L2V5LiA56eN5oOF5Ya144CC56Gu6K6k5paw5Yqg55qEYnVpbGRlcuW3sue7j+WcqOW3peWOguS4reazqOWGjFxyXG4gICAgICBpZiAoYnVpbGRlciA9PSBudWxsKSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdUcmVlVGFibGUgYnVpbGRlciBpcyBudWxsIScpO1xyXG4gICAgICB9XHJcbiAgICAgIGxldCBleHBhbmRMZXZlbCA9IC0xO1xyXG4gICAgICBjb25zdCB0cmVlRXhwYW5kTGV2ZWwgPSB0aGlzLnRyZWVUYWJsZVsnZXhwYW5kTGV2ZWwnXTtcclxuICAgICAgaWYgKHR5cGVvZiB0cmVlRXhwYW5kTGV2ZWwgIT09ICd1bmRlZmluZWQnKSB7XHJcbiAgICAgICAgZXhwYW5kTGV2ZWwgPSB0cmVlRXhwYW5kTGV2ZWw7XHJcbiAgICAgIH1cclxuICAgICAgY29uc3QgdmlydHVhbFJvb3RGcmFtZUNvbnRleHQgPSB0aGlzLmZyYW1lQ29udGV4dC5nZXRWaXJ0dWFsUm9vdEZyYW1lQ29udGV4dCgpO1xyXG4gICAgICBjb25zdCBub2Rlc1Nob3VsZEV4cGFuZCA9ICh2aXJ0dWFsUm9vdEZyYW1lQ29udGV4dC5wYXJhbXMuZ2V0KCdfREVWS0lUX2V4cGFuZFJvd0lkcycpIHx8ICcnKS5zcGxpdCgnLCcpIHx8IFtdO1xyXG4gICAgICBjb25zdCBjb250ZXh0ID0ge1xyXG4gICAgICAgIGV4cGFuZExldmVsLFxyXG4gICAgICAgIGFkZFRyZWVMb2FkQ29tcGxldGVMaXN0ZW5lcjogdGhpcy5hZGRUcmVlTG9hZENvbXBsZXRlTGlzdGVuZXIuYmluZCh0aGlzKSxcclxuICAgICAgICBjb21wb25lbnQ6IHRoaXMudHJlZVRhYmxlLFxyXG4gICAgICAgIHN0b3JhZ2U6IHRoaXMuc3RvcmFnZSxcclxuICAgICAgICBub2Rlc1Nob3VsZEV4cGFuZDogbm9kZXNTaG91bGRFeHBhbmQsXHJcbiAgICAgICAgZnJhbWVDb250ZXh0OiB0aGlzLmZyYW1lQ29udGV4dCxcclxuICAgICAgfTtcclxuICAgICAgLy9pZiAoIXRoaXMudHJlZU5vZGVzQnVpbGRlcikge1xyXG4gICAgICB0aGlzLnRyZWVOb2Rlc0J1aWxkZXIgPSBuZXcgYnVpbGRlcihcclxuICAgICAgICB0cmVlTm9kZXNEYXRhLCBvbGRUcmVlTm9kZXMsXHJcbiAgICAgICAgdGhpcy5iaW5kaW5nTGlzdC5wcmltYXJ5S2V5LCB0aGlzLmhpZXJhcmNoeUluZm9LZXksIGNvbnRleHRcclxuICAgICAgKTtcclxuICAgICAgLy99XHJcbiAgICAgIC8vIHRoaXMudHJlZU5vZGVzQnVpbGRlci51cGRhdGVUcmVlTm9kZSh0cmVlTm9kZXNEYXRhLCBvbGRUcmVlTm9kZXMpO1xyXG4gICAgICB0cmVlTm9kZXMgPSB0aGlzLnRyZWVOb2Rlc0J1aWxkZXIuYnVpbGQoKTtcclxuICAgIH1cclxuICAgIHRoaXMudHJlZVRhYmxlLmRhdGEgPSB0cmVlTm9kZXM7XHJcbiAgICAvLyDorr7nva7liIbpobXkv6Hmga9cclxuICAgIHRoaXMudXBkYXRlUGFnZUluZm8odGhpcy50cmVlVGFibGUpO1xyXG4gICAgdGhpcy5vblRyZWVMb2FkQ29tcGxldGUoKTtcclxuICB9XHJcbiAgcHJpdmF0ZSBvblRyZWVMb2FkQ29tcGxldGUoKSB7XHJcbiAgICBpZiAodGhpcy5saXN0ZW5lcnMgJiYgdGhpcy5saXN0ZW5lcnMubGVuZ3RoID4gMCkge1xyXG4gICAgICB0aGlzLmxpc3RlbmVycy5mb3JFYWNoKGxpc3RlbmVyID0+IHtcclxuICAgICAgICBsaXN0ZW5lcigpO1xyXG4gICAgICB9KTtcclxuICAgIH1cclxuICB9XHJcbiAgcHJpdmF0ZSBhZGRUcmVlTG9hZENvbXBsZXRlTGlzdGVuZXIobGlzdGVuZXI6IGFueSkge1xyXG4gICAgdGhpcy5saXN0ZW5lcnMucHVzaChsaXN0ZW5lcik7XHJcbiAgfVxyXG4gIHByaXZhdGUgc2hvdWxkQ29tcG9uZW50VXBkYXRlKG5ld1Byb3A6IGFueSkge1xyXG4gICAgaWYgKEpTT04uc3RyaW5naWZ5KHRoaXMucHJvcCkgPT09IEpTT04uc3RyaW5naWZ5KG5ld1Byb3ApKSB7XHJcbiAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuICAgIHJldHVybiB0cnVlO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDku47moJHnu4Tku7bkuIrojrflj5bpgInkuK3ooYznmoRpZFxyXG4gICAqL1xyXG4gIHByaXZhdGUgZ2V0U2VsZWN0ZWRJZEZyb21UcmVlKCk6IHN0cmluZyB7XHJcbiAgICBjb25zdCBzZWxlY3RlZFJvdyA9IHRoaXMudHJlZVRhYmxlLnNlbGVjdGVkUm93O1xyXG4gICAgcmV0dXJuIHNlbGVjdGVkUm93ID8gc2VsZWN0ZWRSb3cuZGF0YVsnaWQnXSA6IG51bGw7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDorr7nva5UcmVlVGFibGXnmoTlvZPliY3ooYxcclxuICAgKi9cclxuICBwcml2YXRlIHNldFNlbGVjdGVkSWRUb1RyZWUoc2VsZWN0ZWRJZDogc3RyaW5nKTogdm9pZCB7XHJcbiAgICBpZiAoIXNlbGVjdGVkSWQpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgLy8g5aaC5p6c5paw55qEY3VycmVudElk5ZKM5qCR5LiK55qEc2VsZWN0ZWRJZOS4jeS4gOiHtO+8jOmHjee9ruagkeeahOW9k+WJjeihjFxyXG4gICAgY29uc3Qgb2xkU2VsZWN0ZWRJZCA9IHRoaXMuZ2V0U2VsZWN0ZWRJZEZyb21UcmVlKCk7XHJcbiAgICBjb25zdCBub2RlUGFnZUNoYW5nZWQgPSB0aGlzLmZyYW1lQ29udGV4dC5wYXJhbXMuZ2V0KCdfTk9ERV9QQUdFX0NIQU5HRURfJykgfHwgZmFsc2U7XHJcbiAgICBpZiAoIW9sZFNlbGVjdGVkSWQgJiYgbm9kZVBhZ2VDaGFuZ2VkKSB7XHJcbiAgICAgIHRoaXMuZnJhbWVDb250ZXh0LnBhcmFtcy5kZWxldGUoJ19OT0RFX1BBR0VfQ0hBTkdFRF8nKTtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgaWYgKG9sZFNlbGVjdGVkSWQgIT09IHNlbGVjdGVkSWQpIHtcclxuICAgICAgdGhpcy50cmVlVGFibGUuY2xlYXJTZWxlY3Rpb25zKCk7XHJcbiAgICAgIHRoaXMudHJlZVRhYmxlLnNlbGVjdE5vZGUoc2VsZWN0ZWRJZCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDorr7nva5CaW5kaW5nTGlzdOeahEN1cnJlbnRJZFxyXG4gICAqL1xyXG4gIHByaXZhdGUgc2V0Q3VycmVudElkVG9CaW5kaW5nTGlzdChzZWxlY3RlZElkOiBzdHJpbmcpOiB2b2lkIHtcclxuICAgIGNvbnN0IG9sZEN1cnJlbnRJZCA9IHRoaXMuYmluZGluZ0RhdGEubGlzdC5jdXJyZW50SWQ7XHJcbiAgICAvLyDljZXpgInmqKHlvI/kuIvlsIblvZPliY3ooYzorr7nva7liLBpZHNcclxuICAgIGlmICghdGhpcy50cmVlVGFibGUubXVsdGlTZWxlY3QpIHtcclxuICAgICAgdGhpcy5zZXRDaGVja3Moc2VsZWN0ZWRJZCk7XHJcbiAgICAgIHRoaXMuc2V0Q2hlY2tlZFJvd3MoW3NlbGVjdGVkSWRdKTtcclxuICAgIH1cclxuICAgIGlmIChvbGRDdXJyZW50SWQgPT09IHNlbGVjdGVkSWQpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgdGhpcy5iaW5kaW5nRGF0YS5saXN0LnNldEN1cnJlbnRJZChzZWxlY3RlZElkLCB0cnVlKTtcclxuICB9XHJcbiAgcHJpdmF0ZSB1cGRhdGVDaGVja2VkUm93cyhjaGFuZ2VzOiBDaGFuZ2UpIHtcclxuICAgIGlmIChjaGFuZ2VzLnR5cGUgPT09IENoYW5nZVR5cGUuTG9hZCkge1xyXG4gICAgICB0aGlzLnNldENoZWNrZWRSb3dzKCk7XHJcbiAgICB9IGVsc2UgaWYgKGNoYW5nZXMudHlwZSA9PT0gQ2hhbmdlVHlwZS5WYWx1ZUNoYW5nZWQgfHwgY2hhbmdlcy50eXBlID09PSBDaGFuZ2VUeXBlLlJlbW92ZSkge1xyXG4gICAgICBjb25zdCBpZHMgPSB0aGlzLmdldENoZWNrcygpO1xyXG4gICAgICBpZiAoY2hhbmdlcy5pZCAmJiBpZHMuaW5jbHVkZXMoY2hhbmdlcy5pZCkpIHtcclxuICAgICAgICB0aGlzLnNldENoZWNrZWRSb3dzKCk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcbiAgLyoqXHJcbiAgICog5pu05paw5Yu+6YCJ6KGM5pWw5o2uXHJcbiAgICovXHJcbiAgcHJvdGVjdGVkIHNldENoZWNrZWRSb3dzKGlkcz86IHN0cmluZ1tdKSB7XHJcbiAgICBpZiAodHlwZW9mIGlkcyA9PT0gJ3VuZGVmaW5lZCcpIHtcclxuICAgICAgaWRzID0gdGhpcy52aWV3TW9kZWwudWlTdGF0ZVsnaWRzJ10gfHwgW107XHJcbiAgICB9XHJcbiAgICBpZiAoIUFycmF5LmlzQXJyYXkoaWRzKSkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBjb25zdCBsaXN0ID0gdGhpcy5iaW5kaW5nTGlzdC50b0pTT04oKTtcclxuICAgIGNvbnN0IHJvd3M6IE1hcDxzdHJpbmcsIGFueT4gPSB0aGlzLnZpZXdNb2RlbC51aVN0YXRlWydyb3dzJ10gfHwgbmV3IE1hcDxzdHJpbmcsIGFueT4oKTtcclxuXHJcbiAgICBjb25zdCByZXN1bHQgPSBuZXcgTWFwPHN0cmluZywgYW55PigpO1xyXG4gICAgaWRzLmZvckVhY2goKGlkOiBhbnkpID0+IHtcclxuICAgICAgY29uc3QgaXRlbSA9IGxpc3QuZmluZChpdGVtID0+IGl0ZW1bdGhpcy5iaW5kaW5nTGlzdC5wcmltYXJ5S2V5XSA9PT0gaWQpO1xyXG4gICAgICBjb25zdCBvdGhlclBhZ2VJdGVtID0gcm93cy5nZXQoaWQpO1xyXG4gICAgICBpZiAoaXRlbSkge1xyXG4gICAgICAgIHJlc3VsdC5zZXQoaWQsIGl0ZW0pO1xyXG4gICAgICB9IGVsc2UgaWYgKG90aGVyUGFnZUl0ZW0pIHtcclxuICAgICAgICByZXN1bHQuc2V0KGlkLCBvdGhlclBhZ2VJdGVtKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICB0aGlzLnZpZXdNb2RlbC51aVN0YXRlLnNldFByb3BlcnR5VmFsdWUoJ3Jvd3MnLCByZXN1bHQpO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDorr7nva5pZHPlj5jph49cclxuICAgKiBAcGFyYW0gaWRPcklkcyBpZCBvciBpZHNcclxuICAgKi9cclxuICBwcm90ZWN0ZWQgc2V0Q2hlY2tzKGlkT3JJZHM6IHN0cmluZyB8IHN0cmluZ1tdKSB7XHJcbiAgICBpZiAodHlwZW9mIGlkT3JJZHMgPT09ICdzdHJpbmcnKSB7XHJcbiAgICAgIGlkT3JJZHMgPSBpZE9ySWRzLnNwbGl0KCcsJykuZmlsdGVyKHAgPT4gcCk7XHJcbiAgICB9XHJcbiAgICB0aGlzLnZpZXdNb2RlbC51aVN0YXRlLnNldFByb3BlcnR5VmFsdWUoJ2lkcycsIGlkT3JJZHMpO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDojrflj5bli77pgInooYxpZOaVsOe7hFxyXG4gICAqIEByZXR1cm5zIFxyXG4gICAqL1xyXG4gIHByb3RlY3RlZCBnZXRDaGVja3MoKTogc3RyaW5nW10ge1xyXG4gICAgcmV0dXJuIHRoaXMudmlld01vZGVsLnVpU3RhdGVbJ2lkcyddIHx8IFtdO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDojrflj5bliIbpobXkv6Hmga9cclxuICAgKi9cclxuICBwcml2YXRlIGdldFBhZ2luZ0luZm8oKSB7XHJcbiAgICBjb25zdCBiaW5kaW5nUGF0aCA9IHRoaXMudmlld01vZGVsLmJpbmRpbmdQYXRoO1xyXG4gICAgY29uc3QgYmluZGluZ0RhdGEgPSB0aGlzLnZpZXdNb2RlbC5iaW5kaW5nRGF0YTtcclxuICAgIGxldCBwYWdpbmdJbmZvID0gYmluZGluZ0RhdGEucGFnaW5nSW5mbztcclxuICAgIGlmIChiaW5kaW5nUGF0aCA9PT0gJy8nKSB7XHJcbiAgICAgIHJldHVybiBwYWdpbmdJbmZvO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgY29uc3QgYmluZGluZ1BhdGhzID0gYmluZGluZ1BhdGguc3Vic3RyKDEpLnNwbGl0KCcvJykuZmlsdGVyKGl0ZW0gPT4gISFpdGVtICYmIGl0ZW0ubGVuZ3RoID4gMCkubWFwKGl0ZW0gPT4ge1xyXG4gICAgICAgIHJldHVybiBpdGVtLnN1YnN0cmluZygwLCBpdGVtLmxlbmd0aCAtIDEpO1xyXG4gICAgICB9KTtcclxuICAgICAgYmluZGluZ1BhdGhzLmZvckVhY2gocGF0aCA9PiB7XHJcbiAgICAgICAgcGFnaW5nSW5mbyA9IHBhZ2luZ0luZm8gJiYgcGFnaW5nSW5mb1twYXRoXTtcclxuICAgICAgfSk7XHJcbiAgICAgIHJldHVybiBwYWdpbmdJbmZvO1xyXG4gICAgfVxyXG4gIH1cclxuICBwcml2YXRlIHVwZGF0ZVBhZ2VJbmZvKHRyZWVUYWJsZTogVHJlZVRhYmxlQ29tcG9uZW50KSB7XHJcbiAgICBjb25zdCB7IHBhZ2VJbmRleCwgcGFnZVNpemUsIHRvdGFsIH0gPSB0aGlzLmdldFBhZ2luZ0luZm8oKTtcclxuICAgIGlmIChwYWdlU2l6ZSA9PT0gMCkge1xyXG4gICAgICB0cmVlVGFibGUucGFnaW5hdGlvbiA9IGZhbHNlO1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICB0cmVlVGFibGUucGFnaW5hdGlvbiA9IHRydWU7XHJcbiAgICB0cmVlVGFibGUudXBkYXRlUGFnZUluZm8oeyBwYWdlSW5kZXgsIHBhZ2VTaXplLCB0b3RhbCB9KTtcclxuICB9XHJcbiAgLy8jcmVnaW9uIOe7hOS7tuS6i+S7tlxyXG4gIC8qKlxyXG4gICAqIOihjOWIh+aNolxyXG4gICAqL1xyXG4gIEBIb3N0TGlzdGVuZXIoJ25vZGVTZWxlY3RlZCcsIFsnJGV2ZW50J10pXHJcbiAgcHVibGljIHNlbGVjdGlvbkNoYW5nZUhhbmRsZXIoZXZlbnQ6IGFueSkge1xyXG4gICAgaWYgKGV2ZW50ICYmIGV2ZW50Lm5vZGUgJiYgZXZlbnQubm9kZS5oYXNPd25Qcm9wZXJ0eSgnZGF0YScpKSB7XHJcbiAgICAgIGNvbnN0IGlkRmllbGQgPSB0aGlzLnRyZWVUYWJsZS5pZEZpZWxkO1xyXG4gICAgICBjb25zdCBpZCA9IGV2ZW50Lm5vZGUuZGF0YVtpZEZpZWxkXTtcclxuICAgICAgdGhpcy5zZXRDdXJyZW50SWRUb0JpbmRpbmdMaXN0KGlkKTtcclxuICAgIH1cclxuICB9XHJcbiAgLyoqXHJcbiAgICog5Yu+6YCJ6IqC54K55Y+R55Sf5Y+Y5YyWXHJcbiAgICogQHBhcmFtIGV2ZW50IGV2ZW50XHJcbiAgICovXHJcbiAgQEhvc3RMaXN0ZW5lcignY2hlY2tWYWx1ZXNDaGFuZ2UnLCBbJyRldmVudCddKVxyXG4gIHB1YmxpYyBjaGVja1ZhbHVlc0NoYW5nZShldmVudDogYW55KSB7XHJcbiAgICAvLyB0aGlzLnZpZXdNb2RlbC51aVN0YXRlLnNldFByb3BlcnR5VmFsdWUoJ2lkcycsIHRoaXMudHJlZVRhYmxlLmNoZWNrVmFsdWVzKTtcclxuICAgIHRoaXMuc2V0Q2hlY2tzKHRoaXMudHJlZVRhYmxlLmNoZWNrVmFsdWVzKTtcclxuICAgIHRoaXMuc2V0Q2hlY2tlZFJvd3MoKTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5bCG6KKr5bGV5byA55qE6IqC54K56K6+572u5Li65b2T5YmN6KGMXHJcbiAgICovXHJcbiAgQEhvc3RMaXN0ZW5lcignZXhwYW5kJywgWyckZXZlbnQnXSlcclxuICBwdWJsaWMgZXhwYW5kSGFuZGxlcihldmVudDogYW55KSB7XHJcbiAgICBjb25zdCBzZWxlY3RlZElkID0gZXZlbnQuZGF0YVsnaWQnXTtcclxuICAgIGNvbnN0IHZpcnR1YWxSb290RnJhbWVDb250ZXh0ID0gdGhpcy5mcmFtZUNvbnRleHQuZ2V0VmlydHVhbFJvb3RGcmFtZUNvbnRleHQoKTtcclxuICAgIC8vIOWxleW8gOaXtuS4jeWGjemAieS4rVxyXG4gICAgLy8gdGhpcy5zZXRTZWxlY3RlZElkVG9UcmVlKHNlbGVjdGVkSWQpO1xyXG4gICAgY29uc3QgZXhwYW5kTm9kZXMgPSB2aXJ0dWFsUm9vdEZyYW1lQ29udGV4dC5nZXRQYXJhbSgnVFJFRV9MQVRFU1RfRVhQQU5ERURfSUQnKSB8fCBbXTtcclxuICAgIGV4cGFuZE5vZGVzLnB1c2goc2VsZWN0ZWRJZCk7XHJcbiAgICB2aXJ0dWFsUm9vdEZyYW1lQ29udGV4dC5zZXRQYXJhbSgnVFJFRV9MQVRFU1RfRVhQQU5ERURfSUQnLCBleHBhbmROb2Rlcyk7XHJcbiAgfVxyXG4gIEBIb3N0TGlzdGVuZXIoJ3BhZ2VDaGFuZ2VkJywgWyckZXZlbnQnXSlcclxuICBwdWJsaWMgb25QYWdlQ2hhbmdlZChldmVudDogYW55KSB7XHJcbiAgICBsZXQgeyBwYWdlU2l6ZSA9IDIwLCBwYWdlSW5kZXggPSAxIH0gPSBldmVudCB8fCB7fTtcclxuICAgIGlmIChwYWdlSW5kZXggPCAxKSB7XHJcbiAgICAgIHBhZ2VJbmRleCA9IDE7XHJcbiAgICB9XHJcbiAgICBjb25zdCBza2lwID0gKHBhZ2VJbmRleCAtIDEpICogcGFnZVNpemU7XHJcbiAgICB0aGlzLmJpbmRpbmdEYXRhLnNldFBhZ2luZ0luZm8oc2tpcCwgcGFnZVNpemUsIHRoaXMuYmluZGluZ0RhdGEuYmluZGluZ1BhdGgpO1xyXG4gIH1cclxuICBASG9zdExpc3RlbmVyKCdwYWdlU2l6ZUNoYW5nZWQnLCBbJyRldmVudCddKVxyXG4gIHB1YmxpYyBvblBhZ2VTaXplQ2hhbmdlZChldmVudDogYW55KSB7XHJcbiAgICBjb25zdCBwYWdlU2l6ZSA9IGV2ZW50ID8gZXZlbnQgOiAyMDtcclxuICAgIGNvbnN0IHNraXAgPSAwO1xyXG4gICAgdGhpcy5iaW5kaW5nRGF0YS5zZXRQYWdpbmdJbmZvKHNraXAsIHBhZ2VTaXplLCB0aGlzLmJpbmRpbmdEYXRhLmJpbmRpbmdQYXRoKTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog6IqC54K56aG156CB5YiH5o2i5LqL5Lu2XHJcbiAgICogQHBhcmFtIGV2ZW50IGV2ZW50XHJcbiAgICovXHJcbiAgQEhvc3RMaXN0ZW5lcignY2hpbGRzUGFnZUNoYW5nZWQnLCBbJyRldmVudCddKVxyXG4gIHB1YmxpYyBvbk5vZGVQYWdlQ2hhbmdlZChldmVudDogYW55KSB7XHJcbiAgICBjb25zdCB7IHBhZ2VJbmRleCA9IDEsIHBhZ2VTaXplID0gdGhpcy5ub2RlUGFnZVNpemUsIG5vZGUgPSB7fSB9ID0gZXZlbnQ7XHJcbiAgICBjb25zdCBpZCA9IG5vZGUgJiYgbm9kZS5pZCB8fCBudWxsO1xyXG4gICAgaWYgKGlkKSB7XHJcbiAgICAgIGNvbnN0IHZpcnR1YWxSb290RnJhbWVDb250ZXh0ID0gdGhpcy5mcmFtZUNvbnRleHQuZ2V0VmlydHVhbFJvb3RGcmFtZUNvbnRleHQoKTtcclxuICAgICAgY29uc3QgZXhwYW5kTm9kZXMgPSB2aXJ0dWFsUm9vdEZyYW1lQ29udGV4dC5nZXRQYXJhbSgnVFJFRV9MQVRFU1RfRVhQQU5ERURfSUQnKSB8fCBbXTtcclxuICAgICAgZXhwYW5kTm9kZXMucHVzaChpZCk7XHJcbiAgICAgIHZpcnR1YWxSb290RnJhbWVDb250ZXh0LnNldFBhcmFtKCdUUkVFX0xBVEVTVF9FWFBBTkRFRF9JRCcsIGV4cGFuZE5vZGVzKTtcclxuICAgICAgdGhpcy5mcmFtZUNvbnRleHQucGFyYW1zLnNldChgX05PREVfJHtpZH1fUEFHRV9JTkRFWF9gLCBwYWdlSW5kZXgpO1xyXG4gICAgICB0aGlzLmZyYW1lQ29udGV4dC5wYXJhbXMuc2V0KGBfUkVMT0FEX0NISUxEUkVOX2AsIHRydWUpO1xyXG4gICAgICB0aGlzLmZyYW1lQ29udGV4dC5wYXJhbXMuc2V0KCdfTk9ERV9QQUdFX0NIQU5HRURfJywgdHJ1ZSk7XHJcbiAgICB9XHJcbiAgfVxyXG4gIC8vI2VuZHJlZ2lvblxyXG59XHJcblxyXG5leHBvcnQgeyBGYXJyaXNUcmVlVGFibGVCaW5kaW5nRGlyZWN0aXZlIH07XHJcbiJdfQ==
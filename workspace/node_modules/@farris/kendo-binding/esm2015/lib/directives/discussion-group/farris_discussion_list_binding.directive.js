import { of, EMPTY } from 'rxjs';
import { Directive, Input, Injector, HostListener } from '@angular/core';
import { DiscussionListComponent, DiscussionListDirective } from '@farris/discussion-group';
import { ViewModel, ChangeType } from '@farris/devkit';
import { catchError } from 'rxjs/operators';
const KEY_UISTATE_REPLY_MESSAGE = 'DISCUSSION_REPLY_MESSAGE_INFO';
const KEY_MESSAGE_ON_COMMENT_ADD = 'onCommentAdd';
export class FarrisDiscussionListBindingDirective {
    constructor(injector, discussionListComponent, viewModel, discussionListDirective) {
        this.injector = injector;
        this.discussionListComponent = discussionListComponent;
        this.viewModel = viewModel;
        this.discussionListDirective = discussionListDirective;
    }
    ngOnInit() {
        this.viewModel.frameContext.appContext.messagePipe.subscribe((message) => {
            if (message === KEY_MESSAGE_ON_COMMENT_ADD) {
                this.queryComments();
            }
        });
        this.viewModel.bindingData.changes.subscribe((change) => {
            if (change.type === ChangeType.Load || change.type === ChangeType.SelectionChanged) {
                this.queryComments();
            }
        });
    }
    /**
     * 查询评论
     */
    queryComments(pageIndex, pageSize) {
        if (typeof pageIndex === 'undefined') {
            pageIndex = (this.discussionListComponent.pageIndex - 1) || 0;
        }
        if (typeof pageSize === 'undefined') {
            if (this.discussionListComponent.supportPaging) {
                pageSize = this.discussionListComponent.pageSize;
            }
            else {
                // 不分页，pageSize和后端约定传最大数
                pageSize = 10000;
            }
        }
        this.execute(this.commentsQueryCommand, { pageIndex, pageSize }).pipe(catchError(e => EMPTY)).subscribe(result => {
            if (!result) {
                return;
            }
            const { comments = [], pageIndex = 0, pageSize = 10, totalCount = 0 } = result;
            this.discussionListComponent.pageIndex = parseInt(pageIndex) + 1;
            if (this.discussionListComponent.supportPaging) {
                this.discussionListComponent.pageSize = pageSize;
            }
            this.discussionListComponent.total = totalCount;
            this.discussionListDirective.discussionListData = result;
        });
    }
    /**
     * 回复消息
     * @param event event
     */
    replyMessagedHandler(event) {
        this.viewModel.frameContext.root.viewModel.uiState.setPropertyValue(KEY_UISTATE_REPLY_MESSAGE, event);
    }
    /**
     * 切换页码
     * @param event event
     */
    pageChangedHandler(event) {
        const { pageIndex = 1, pageSize = 10 } = event.pageInfo || {};
        this.queryComments(pageIndex - 1, pageSize);
    }
    /**
     * 执行命令
     * @param commandName 命令名称
     */
    execute(commandName, params) {
        if (!commandName || commandName === '' || commandName === 'undefined') {
            return of(null);
        }
        const paths = commandName.split('.');
        let func = null;
        paths.forEach(path => {
            func = func && func[path] || this[path];
        });
        if (typeof func === 'function') {
            return func(params);
        }
        return of(null);
    }
}
FarrisDiscussionListBindingDirective.decorators = [
    { type: Directive, args: [{
                selector: '[farris-discussion-list-binding]'
            },] }
];
/** @nocollapse */
FarrisDiscussionListBindingDirective.ctorParameters = () => [
    { type: Injector },
    { type: DiscussionListComponent },
    { type: ViewModel },
    { type: DiscussionListDirective }
];
FarrisDiscussionListBindingDirective.propDecorators = {
    commentsQueryCommand: [{ type: Input, args: ["commentsQueryCommand",] }],
    replyMessagedHandler: [{ type: HostListener, args: ['replyMessage', ['$event'],] }],
    pageChangedHandler: [{ type: HostListener, args: ['pageChanged', ['$event'],] }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmFycmlzX2Rpc2N1c3Npb25fbGlzdF9iaW5kaW5nLmRpcmVjdGl2ZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMva2VuZG8tYmluZGluZy8iLCJzb3VyY2VzIjpbImxpYi9kaXJlY3RpdmVzL2Rpc2N1c3Npb24tZ3JvdXAvZmFycmlzX2Rpc2N1c3Npb25fbGlzdF9iaW5kaW5nLmRpcmVjdGl2ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQWMsRUFBRSxFQUFFLEtBQUssRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUM3QyxPQUFPLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBRSxRQUFRLEVBQVUsWUFBWSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ2pGLE9BQU8sRUFBRSx1QkFBdUIsRUFBRSx1QkFBdUIsRUFBRSxNQUFNLDBCQUEwQixDQUFDO0FBQzVGLE9BQU8sRUFBRSxTQUFTLEVBQVUsVUFBVSxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDL0QsT0FBTyxFQUFPLFVBQVUsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ2pELE1BQU0seUJBQXlCLEdBQUcsK0JBQStCLENBQUM7QUFDbEUsTUFBTSwwQkFBMEIsR0FBRyxjQUFjLENBQUM7QUFJbEQsTUFBTSxPQUFPLG9DQUFvQztJQUsvQyxZQUFtQixRQUFrQixFQUFTLHVCQUFnRCxFQUFTLFNBQW9CLEVBQVMsdUJBQWdEO1FBQWpLLGFBQVEsR0FBUixRQUFRLENBQVU7UUFBUyw0QkFBdUIsR0FBdkIsdUJBQXVCLENBQXlCO1FBQVMsY0FBUyxHQUFULFNBQVMsQ0FBVztRQUFTLDRCQUF1QixHQUF2Qix1QkFBdUIsQ0FBeUI7SUFFcEwsQ0FBQztJQUNELFFBQVE7UUFDTixJQUFJLENBQUMsU0FBUyxDQUFDLFlBQVksQ0FBQyxVQUFVLENBQUMsV0FBVyxDQUFDLFNBQVMsQ0FBQyxDQUFDLE9BQVksRUFBRSxFQUFFO1lBQzVFLElBQUksT0FBTyxLQUFLLDBCQUEwQixFQUFFO2dCQUMxQyxJ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RyxDQUFDLENBQUM7UUFDckMsSUFBSSxJQUFJLEdBQUcsSUFBSSxDQUFDO1FBQ2hCLEtBQUssQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLEVBQUU7WUFDbkIsSUFBSSxHQUFHLElBQUksSUFBSSxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQzFDLENBQUMsQ0FBQyxDQUFDO1FBQ0gsSUFBSSxPQUFPLElBQUksS0FBSyxVQUFVLEVBQUU7WUFDOUIsT0FBTyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7U0FDckI7UUFDRCxPQUFPLEVBQUUsQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUNsQixDQUFDOzs7WUF2RkYsU0FBUyxTQUFDO2dCQUNULFFBQVEsRUFBRSxrQ0FBa0M7YUFDN0M7Ozs7WUFSMEIsUUFBUTtZQUMxQix1QkFBdUI7WUFDdkIsU0FBUztZQURnQix1QkFBdUI7OzttQ0FZdEQsS0FBSyxTQUFDLHNCQUFzQjttQ0FrRDVCLFlBQVksU0FBQyxjQUFjLEVBQUUsQ0FBQyxRQUFRLENBQUM7aUNBUXZDLFlBQVksU0FBQyxhQUFhLEVBQUUsQ0FBQyxRQUFRLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBPYnNlcnZhYmxlLCBvZiwgRU1QVFkgfSBmcm9tICdyeGpzJztcclxuaW1wb3J0IHsgRGlyZWN0aXZlLCBJbnB1dCwgSW5qZWN0b3IsIE9uSW5pdCwgSG9zdExpc3RlbmVyIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IERpc2N1c3Npb25MaXN0Q29tcG9uZW50LCBEaXNjdXNzaW9uTGlzdERpcmVjdGl2ZSB9IGZyb20gJ0BmYXJyaXMvZGlzY3Vzc2lvbi1ncm91cCc7XHJcbmltcG9ydCB7IFZpZXdNb2RlbCwgQ2hhbmdlLCBDaGFuZ2VUeXBlIH0gZnJvbSAnQGZhcnJpcy9kZXZraXQnO1xyXG5pbXBvcnQgeyB0YXAsIGNhdGNoRXJyb3IgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XHJcbmNvbnN0IEtFWV9VSVNUQVRFX1JFUExZX01FU1NBR0UgPSAnRElTQ1VTU0lPTl9SRVBMWV9NRVNTQUdFX0lORk8nO1xyXG5jb25zdCBLRVlfTUVTU0FHRV9PTl9DT01NRU5UX0FERCA9ICdvbkNvbW1lbnRBZGQnO1xyXG5ARGlyZWN0aXZlKHtcclxuICBzZWxlY3RvcjogJ1tmYXJyaXMtZGlzY3Vzc2lvbi1saXN0LWJpbmRpbmddJ1xyXG59KVxyXG5leHBvcnQgY2xhc3MgRmFycmlzRGlzY3Vzc2lvbkxpc3RCaW5kaW5nRGlyZWN0aXZlIGltcGxlbWVudHMgT25Jbml0IHtcclxuICAvKipcclxuICAgKiDojrflj5bnlKjmiLflkb3ku6RcclxuICAqL1xyXG4gIEBJbnB1dChcImNvbW1lbnRzUXVlcnlDb21tYW5kXCIpIGNvbW1lbnRzUXVlcnlDb21tYW5kOiBzdHJpbmc7XHJcbiAgY29uc3RydWN0b3IocHVibGljIGluamVjdG9yOiBJbmplY3RvciwgcHVibGljIGRpc2N1c3Npb25MaXN0Q29tcG9uZW50OiBEaXNjdXNzaW9uTGlzdENvbXBvbmVudCwgcHVibGljIHZpZXdNb2RlbDogVmlld01vZGVsLCBwdWJsaWMgZGlzY3Vzc2lvbkxpc3REaXJlY3RpdmU6IERpc2N1c3Npb25MaXN0RGlyZWN0aXZlKSB7XHJcblxyXG4gIH1cclxuICBuZ09uSW5pdCgpOiB2b2lkIHtcclxuICAgIHRoaXMudmlld01vZGVsLmZyYW1lQ29udGV4dC5hcHBDb250ZXh0Lm1lc3NhZ2VQaXBlLnN1YnNjcmliZSgobWVzc2FnZTogYW55KSA9PiB7XHJcbiAgICAgIGlmIChtZXNzYWdlID09PSBLRVlfTUVTU0FHRV9PTl9DT01NRU5UX0FERCkge1xyXG4gICAgICAgIHRoaXMucXVlcnlDb21tZW50cygpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICAgIHRoaXMudmlld01vZGVsLmJpbmRpbmdEYXRhLmNoYW5nZXMuc3Vic2NyaWJlKChjaGFuZ2U6IENoYW5nZSkgPT4ge1xyXG4gICAgICBpZiAoY2hhbmdlLnR5cGUgPT09IENoYW5nZVR5cGUuTG9hZCB8fCBjaGFuZ2UudHlwZSA9PT0gQ2hhbmdlVHlwZS5TZWxlY3Rpb25DaGFuZ2VkKSB7XHJcbiAgICAgICAgdGhpcy5xdWVyeUNvbW1lbnRzKCk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDmn6Xor6Lor4TorrpcclxuICAgKi9cclxuICBwcml2YXRlIHF1ZXJ5Q29tbWVudHMocGFnZUluZGV4PzogbnVtYmVyLCBwYWdlU2l6ZT86IG51bWJlcikge1xyXG4gICAgaWYgKHR5cGVvZiBwYWdlSW5kZXggPT09ICd1bmRlZmluZWQnKSB7XHJcbiAgICAgIHBhZ2VJbmRleCA9ICh0aGlzLmRpc2N1c3Npb25MaXN0Q29tcG9uZW50LnBhZ2VJbmRleCAtIDEpIHx8IDA7XHJcbiAgICB9XHJcbiAgICBpZiAodHlwZW9mIHBhZ2VTaXplID09PSAndW5kZWZpbmVkJykge1xyXG4gICAgICBpZiAodGhpcy5kaXNjdXNzaW9uTGlzdENvbXBvbmVudC5zdXBwb3J0UGFnaW5nKSB7XHJcbiAgICAgICAgcGFnZVNpemUgPSB0aGlzLmRpc2N1c3Npb25MaXN0Q29tcG9uZW50LnBhZ2VTaXplO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIC8vIOS4jeWIhumhte+8jHBhZ2VTaXpl5ZKM5ZCO56uv57qm5a6a5Lyg5pyA5aSn5pWwXHJcbiAgICAgICAgcGFnZVNpemUgPSAxMDAwMDtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgdGhpcy5leGVjdXRlKHRoaXMuY29tbWVudHNRdWVyeUNvbW1hbmQsIHsgcGFnZUluZGV4LCBwYWdlU2l6ZSB9KS5waXBlKFxyXG4gICAgICBjYXRjaEVycm9yKGUgPT4gRU1QVFkpXHJcbiAgICApLnN1YnNjcmliZShyZXN1bHQgPT4ge1xyXG4gICAgICBpZiAoIXJlc3VsdCkge1xyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfVxyXG4gICAgICBjb25zdCB7IGNvbW1lbnRzID0gW10sIHBhZ2VJbmRleCA9IDAsIHBhZ2VTaXplID0gMTAsIHRvdGFsQ291bnQgPSAwIH0gPSByZXN1bHQ7XHJcbiAgICAgIHRoaXMuZGlzY3Vzc2lvbkxpc3RDb21wb25lbnQucGFnZUluZGV4ID0gcGFyc2VJbnQocGFnZUluZGV4KSArIDE7XHJcbiAgICAgIGlmICh0aGlzLmRpc2N1c3Npb25MaXN0Q29tcG9uZW50LnN1cHBvcnRQYWdpbmcpIHtcclxuICAgICAgICB0aGlzLmRpc2N1c3Npb25MaXN0Q29tcG9uZW50LnBhZ2VTaXplID0gcGFnZVNpemU7XHJcbiAgICAgIH1cclxuICAgICAgdGhpcy5kaXNjdXNzaW9uTGlzdENvbXBvbmVudC50b3RhbCA9IHRvdGFsQ291bnQ7XHJcbiAgICAgIHRoaXMuZGlzY3Vzc2lvbkxpc3REaXJlY3RpdmUuZGlzY3Vzc2lvbkxpc3REYXRhID0gcmVzdWx0O1xyXG4gICAgfSk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOWbnuWkjea2iOaBr1xyXG4gICAqIEBwYXJhbSBldmVudCBldmVudFxyXG4gICAqL1xyXG4gIEBIb3N0TGlzdGVuZXIoJ3JlcGx5TWVzc2FnZScsIFsnJGV2ZW50J10pXHJcbiAgcHVibGljIHJlcGx5TWVzc2FnZWRIYW5kbGVyKGV2ZW50OiBhbnkpIHtcclxuICAgIHRoaXMudmlld01vZGVsLmZyYW1lQ29udGV4dC5yb290LnZpZXdNb2RlbC51aVN0YXRlLnNldFByb3BlcnR5VmFsdWUoS0VZX1VJU1RBVEVfUkVQTFlfTUVTU0FHRSwgZXZlbnQpO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDliIfmjaLpobXnoIFcclxuICAgKiBAcGFyYW0gZXZlbnQgZXZlbnRcclxuICAgKi9cclxuICBASG9zdExpc3RlbmVyKCdwYWdlQ2hhbmdlZCcsIFsnJGV2ZW50J10pXHJcbiAgcHVibGljIHBhZ2VDaGFuZ2VkSGFuZGxlcihldmVudDogYW55KSB7XHJcbiAgICBjb25zdCB7IHBhZ2VJbmRleCA9IDEsIHBhZ2VTaXplID0gMTAgfSA9IGV2ZW50LnBhZ2VJbmZvIHx8IHt9O1xyXG4gICAgdGhpcy5xdWVyeUNvbW1lbnRzKHBhZ2VJbmRleCAtIDEsIHBhZ2VTaXplKTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5omn6KGM5ZG95LukXHJcbiAgICogQHBhcmFtIGNvbW1hbmROYW1lIOWRveS7pOWQjeensFxyXG4gICAqL1xyXG4gIHByaXZhdGUgZXhlY3V0ZShjb21tYW5kTmFtZTogc3RyaW5nLCBwYXJhbXM/OiBhbnkpOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgaWYgKCFjb21tYW5kTmFtZSB8fCBjb21tYW5kTmFtZSA9PT0gJycgfHwgY29tbWFuZE5hbWUgPT09ICd1bmRlZmluZWQnKSB7XHJcbiAgICAgIHJldHVybiBvZihudWxsKTtcclxuICAgIH1cclxuICAgIGNvbnN0IHBhdGhzID0gY29tbWFuZE5hbWUuc3BsaXQoJy4nKTtcclxuICAgIGxldCBmdW5jID0gbnVsbDtcclxuICAgIHBhdGhzLmZvckVhY2gocGF0aCA9PiB7XHJcbiAgICAgIGZ1bmMgPSBmdW5jICYmIGZ1bmNbcGF0aF0gfHwgdGhpc1twYXRoXTtcclxuICAgIH0pO1xyXG4gICAgaWYgKHR5cGVvZiBmdW5jID09PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgIHJldHVybiBmdW5jKHBhcmFtcyk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gb2YobnVsbCk7XHJcbiAgfVxyXG59XHJcbiJdfQ==
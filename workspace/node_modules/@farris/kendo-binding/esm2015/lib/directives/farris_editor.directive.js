import { Directive, ElementRef } from '@angular/core';
import { ViewModel } from '@farris/devkit';
import { EditorComponent } from '@farris/ui-editor';
export class FarrisEditorDirective {
    constructor(viewModel, editor) {
        this.viewModel = viewModel;
        this.editor = editor;
    }
    ngOnInit() {
        this.setComponentRef();
    }
    setComponentRef() {
        const appContext = this.viewModel && this.viewModel.frameContext && this.viewModel.frameContext.getFormAppContext();
        const frameId = this.viewModel && this.viewModel.frameContext && this.viewModel.frameContext.frameId;
        const editor = this.editor;
        const elementRef = editor && editor.injector && editor.injector.get(ElementRef, null);
        const id = elementRef && elementRef.nativeElement && elementRef.nativeElement.id || null;
        // 如果frameId不存在或treetable没有id属性，说明不符合使用场景
        if (!frameId || !id) {
            return;
        }
        const map = appContext && appContext.componentRefs && appContext.componentRefs.get(frameId) || new Map();
        appContext && appContext.componentRefs && appContext.componentRefs.set(frameId, map.set(id, this.editor));
    }
}
FarrisEditorDirective.decorators = [
    { type: Directive, args: [{
                selector: '[farris-editor],[farris-editor-bind]'
            },] }
];
/** @nocollapse */
FarrisEditorDirective.ctorParameters = () => [
    { type: ViewModel },
    { type: EditorComponent }
];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmFycmlzX2VkaXRvci5kaXJlY3RpdmUuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL2tlbmRvLWJpbmRpbmcvIiwic291cmNlcyI6WyJsaWIvZGlyZWN0aXZlcy9mYXJyaXNfZWRpdG9yLmRpcmVjdGl2ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFFLFVBQVUsRUFBVSxNQUFNLGVBQWUsQ0FBQztBQUM5RCxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDM0MsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBS3BELE1BQU0sT0FBTyxxQkFBcUI7SUFDaEMsWUFBb0IsU0FBb0IsRUFBVSxNQUF1QjtRQUFyRCxjQUFTLEdBQVQsU0FBUyxDQUFXO1FBQVUsV0FBTSxHQUFOLE1BQU0sQ0FBaUI7SUFBSSxDQUFDO0lBRTlFLFFBQVE7UUFDTixJQUFJLENBQUMsZUFBZSxFQUFFLENBQUM7SUFDekIsQ0FBQztJQUVPLGVBQWU7UUFDckIsTUFBTSxVQUFVLEdBQUcsSUFBSSxDQUFDLFNBQVMsSUFBSSxJQUFJLENBQUMsU0FBUyxDQUFDLFlBQVksSUFBSSxJQUFJLENBQUMsU0FBUyxDQUFDLFlBQVksQ0FBQyxpQkFBaUIsRUFBRSxDQUFDO1FBQ3BILE1BQU0sT0FBTyxHQUFHLElBQUksQ0FBQyxTQUFTLElBQUksSUFBSSxDQUFDLFNBQVMsQ0FBQyxZQUFZLElBQUksSUFBSSxDQUFDLFNBQVMsQ0FBQyxZQUFZLENBQUMsT0FBTyxDQUFDO1FBQ3JHLE1BQU0sTUFBTSxHQUFRLElBQUksQ0FBQyxNQUFNLENBQUM7UUFDaEMsTUFBTSxVQUFVLEdBQWUsTUFBTSxJQUFJLE1BQU0sQ0FBQyxRQUFRLElBQUksTUFBTSxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsVUFBVSxFQUFFLElBQUksQ0FBQyxDQUFDO1FBQ2xHLE1BQU0sRUFBRSxHQUFHLFVBQVUsSUFBSSxVQUFVLENBQUMsYUFBYSxJQUFJLFVBQVUsQ0FBQyxhQUFhLENBQUMsRUFBRSxJQUFJLElBQUksQ0FBQztRQUN6Rix5Q0FBeUM7UUFDekMsSUFBSSxDQUFDLE9BQU8sSUFBSSxDQUFDLEVBQUUsRUFBRTtZQUNuQixPQUFPO1NBQ1I7UUFDRCxNQUFNLEdBQUcsR0FBRyxVQUFVLElBQUksVUFBVSxDQUFDLGFBQWEsSUFBSSxVQUFVLENBQUMsYUFBYSxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsSUFBSSxJQUFJLEdBQUcsRUFBZSxDQUFDO1FBQ3RILFVBQVUsSUFBSSxVQUFVLENBQUMsYUFBYSxJQUFJLFVBQVUsQ0FBQyxhQUFhLENBQUMsR0FBRyxDQUFDLE9BQU8sRUFBRSxHQUFHLENBQUMsR0FBRyxDQUFDLEVBQUUsRUFBRSxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQztJQUM1RyxDQUFDOzs7WUF0QkYsU0FBUyxTQUFDO2dCQUNULFFBQVEsRUFBRSxzQ0FBc0M7YUFDakQ7Ozs7WUFMUSxTQUFTO1lBQ1QsZUFBZSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IERpcmVjdGl2ZSwgRWxlbWVudFJlZiwgT25Jbml0IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IFZpZXdNb2RlbCB9IGZyb20gJ0BmYXJyaXMvZGV2a2l0JztcclxuaW1wb3J0IHsgRWRpdG9yQ29tcG9uZW50IH0gZnJvbSAnQGZhcnJpcy91aS1lZGl0b3InO1xyXG5cclxuQERpcmVjdGl2ZSh7XHJcbiAgc2VsZWN0b3I6ICdbZmFycmlzLWVkaXRvcl0sW2ZhcnJpcy1lZGl0b3ItYmluZF0nXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBGYXJyaXNFZGl0b3JEaXJlY3RpdmUgaW1wbGVtZW50cyBPbkluaXQge1xyXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgdmlld01vZGVsOiBWaWV3TW9kZWwsIHByaXZhdGUgZWRpdG9yOiBFZGl0b3JDb21wb25lbnQpIHsgfVxyXG5cclxuICBuZ09uSW5pdCgpOiB2b2lkIHtcclxuICAgIHRoaXMuc2V0Q29tcG9uZW50UmVmKCk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHNldENvbXBvbmVudFJlZigpIHtcclxuICAgIGNvbnN0IGFwcENvbnRleHQgPSB0aGlzLnZpZXdNb2RlbCAmJiB0aGlzLnZpZXdNb2RlbC5mcmFtZUNvbnRleHQgJiYgdGhpcy52aWV3TW9kZWwuZnJhbWVDb250ZXh0LmdldEZvcm1BcHBDb250ZXh0KCk7XHJcbiAgICBjb25zdCBmcmFtZUlkID0gdGhpcy52aWV3TW9kZWwgJiYgdGhpcy52aWV3TW9kZWwuZnJhbWVDb250ZXh0ICYmIHRoaXMudmlld01vZGVsLmZyYW1lQ29udGV4dC5mcmFtZUlkO1xyXG4gICAgY29uc3QgZWRpdG9yOiBhbnkgPSB0aGlzLmVkaXRvcjtcclxuICAgIGNvbnN0IGVsZW1lbnRSZWY6IEVsZW1lbnRSZWYgPSBlZGl0b3IgJiYgZWRpdG9yLmluamVjdG9yICYmIGVkaXRvci5pbmplY3Rvci5nZXQoRWxlbWVudFJlZiwgbnVsbCk7XHJcbiAgICBjb25zdCBpZCA9IGVsZW1lbnRSZWYgJiYgZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50ICYmIGVsZW1lbnRSZWYubmF0aXZlRWxlbWVudC5pZCB8fCBudWxsO1xyXG4gICAgLy8g5aaC5p6cZnJhbWVJZOS4jeWtmOWcqOaIlnRyZWV0YWJsZeayoeaciWlk5bGe5oCn77yM6K+05piO5LiN56ym5ZCI5L2/55So5Zy65pmvXHJcbiAgICBpZiAoIWZyYW1lSWQgfHwgIWlkKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGNvbnN0IG1hcCA9IGFwcENvbnRleHQgJiYgYXBwQ29udGV4dC5jb21wb25lbnRSZWZzICYmIGFwcENvbnRleHQuY29tcG9uZW50UmVmcy5nZXQoZnJhbWVJZCkgfHwgbmV3IE1hcDxzdHJpbmcsIGFueT4oKTtcclxuICAgIGFwcENvbnRleHQgJiYgYXBwQ29udGV4dC5jb21wb25lbnRSZWZzICYmIGFwcENvbnRleHQuY29tcG9uZW50UmVmcy5zZXQoZnJhbWVJZCwgbWFwLnNldChpZCwgdGhpcy5lZGl0b3IpKTtcclxuICB9XHJcbn0iXX0=
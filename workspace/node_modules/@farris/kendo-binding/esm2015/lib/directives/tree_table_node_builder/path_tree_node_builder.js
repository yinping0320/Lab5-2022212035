// tslint:disable: no-string-literal
/**
 * 树节点构造器
 * @summary
 * 将BindingData中的数据集合转换成TreeTable节点集合
 */
class PathTreeNodeBuilder {
    /**
     * 构造函数
     */
    constructor(allNodesData, oldTreeNodes, primaryKey, hierarchyInfoKey, context) {
        this.levelGroup = {};
        /**
         * 等待展开的节点
         * @description 节点结构
         * ```
         * {id:'xxx',expanded:false}
         * ```
         */
        this.nodesWaitExpand = [];
        this.primaryKey = primaryKey;
        this.hierarchyInfoKey = hierarchyInfoKey;
        this.allNodes = [];
        this.allNodesData = allNodesData;
        this.context = context || {};
        this.nodesWaitExpand = [];
        this.nodesShouldExpand = context && context.nodesShouldExpand || [];
        this.frameContext = context && context.frameContext || null;
        this.addTreeLoadCompleteListener(this.onTreeLoadComplete.bind(this));
        this.initLevelGroup();
        this.allNodesMap = new Map();
        this.allOldNodesMap = new Map();
        this.buildNodesDataMap(oldTreeNodes);
    }
    /**
     * 展开至层级
     * @description -1为不展开
     */
    get expandLevel() {
        return this.context && this.context.hasOwnProperty('expandLevel') ? this.context['expandLevel'] : -1;
    }
    get component() {
        return this.context && this.context['component'];
    }
    get addTreeLoadCompleteListener() {
        return this.context && this.context['addTreeLoadCompleteListener'] || function (args) { };
    }
    updateTreeNode(allNodesData, data) {
        this.allNodesData = allNodesData;
        this.initLevelGroup();
        this.buildNodesDataMap(data);
    }
    build() {
        const tree = [];
        const childrenOf = {};
        const nodes = {};
        this.allNodesData.forEach(item => {
            const id = item.id;
            const parentId = this.getParentId(item);
            // item.parentId = parentId;
            // 展开新增节点的父节点
            const isNewNode = this.isNewNode(item);
            if (isNewNode === true) {
                this.expandParentNode(item);
            }
            // 构造树节点
            const node = this.buildNode(item);
            nodes[id] = node;
            childrenOf[id] = childrenOf[id] || [];
            node.children = childrenOf[id];
            this.allNodesMap.set(item[this.primaryKey], node);
            if (parentId) {
                if (nodes[parentId] && nodes[parentId].unstableState === true) {
                    nodes[parentId].expanded = true;
                    nodes[parentId].unstableState = false;
                }
                childrenOf[parentId] = childrenOf[parentId] || [];
                childrenOf[parentId].push(node);
            }
            else {
                if ((!node.children || node.children.length < 1) && node.expanded === true) {
                    node.unstableState = true;
                    node.expanded = false;
                }
                tree.push(node);
            }
        });
        return tree;
    }
    /**
     * 构造树节点
     */
    build1() {
        let minLayer;
        // 获取最顶级节点的layer
        this.allNodesData.forEach(node => {
            const hierarchyInfo = this.getHierarchyInfo(node);
            if (hierarchyInfo) {
                const layer = hierarchyInfo['layer'];
                if (!isNaN(layer)) {
                    if (minLayer === undefined) {
                        minLayer = layer;
                    }
                    else if (layer < minLayer) {
                        minLayer = layer;
                    }
                }
            }
        });
        const topLayer = minLayer - 1;
        this.buildNodes('', topLayer, this.allNodesData, this.allNodes);
        return this.allNodes;
    }
    /**
     * 构造树节点集合
     */
    buildNodes(fPath, fLayer, allNodesData, treeNodes) {
        const childNodesData = this.getChildNodesData(fPath, fLayer);
        childNodesData.forEach((nodeData) => {
            // 展开新增节点的父节点
            const isNewNode = this.isNewNode(nodeData);
            if (isNewNode === true) {
                this.expandParentNode(nodeData);
            }
            // 构造树节点
            const node = this.buildNode(nodeData);
            treeNodes.push(node);
            this.allNodesMap.set(nodeData[this.primaryKey], node);
            // 递归遍历下级节点
            const hierarchyInfo = this.getHierarchyInfo(nodeData); //nodeData[this.hierarchyInfoKey];
            const currentLayer = hierarchyInfo['layer'];
            const currentPath = hierarchyInfo['path'];
            this.buildNodes(currentPath, currentLayer, allNodesData, node.children);
        });
    }
    /**
     * 创建树节点
     */
    buildNode(nodeData) {
        const isLeaf = this.isLeaf(nodeData);
        // 获取节点的展开状态
        const shouldExpand = this.shouldExpand(nodeData);
        // 节点虽然应该展开，但可能是因为之前就是展开状态，所以应该检查节点之前的状态
        const originExpandStatus = this.isExpanded(nodeData);
        // 如果应该展开该节点，但是该节点之前有状态，那么该节点不应该再由程序展开。
        if (!originExpandStatus && shouldExpand) {
            this.expandNode(nodeData);
        }
        const paginationInfo = this.buildPaginationInfo(nodeData);
        const treeNode = {
            data: Object.assign({}, nodeData),
            children: [],
            expanded: shouldExpand,
            leaf: isLeaf
        };
        if (paginationInfo) {
            treeNode.pagination = paginationInfo;
        }
        return treeNode;
    }
    /**
     * 构造分页信息
     * @param nodeData nodeData
     * @returns
     */
    buildPaginationInfo(nodeData) {
        let result = null;
        if (this.frameContext) {
            const id = this.getPrimary(nodeData);
            // 获取分页信息
            const key = `_NODE_${id}_PAGINATION_INFO_`;
            const pagination = this.frameContext.params.get(key) || null;
            if (pagination && pagination.pageCount > 1) {
                result = {
                    pageIndex: pagination.pageIndex,
                    pageSize: pagination.pageSize,
                    total: pagination.totalCount
                };
            }
        }
        return result;
    }
    /**
     * 计算节点是否需要展开
     * @param nodeData nodeData
     */
    shouldExpand(nodeData) {
        const [layer, isLeaf] = [this.getNodeLayer(nodeData), this.isLeaf(nodeData)];
        // 永远不展开叶子节点
        if (isLeaf) {
            return false;
        }
        let expanded = this.isExpanded(nodeData);
        if (!expanded) {
            const id = this.getPrimary(nodeData);
            if (this.nodesWaitExpand.findIndex(node => node && node.id === id) > -1) {
                return false;
            }
            if (this.nodesShouldExpand.findIndex(nodeId => nodeId === id) > -1) {
                return true;
            }
            if (this.expandLevel === -1) {
                // -1 为不展开
                expanded = false;
            }
            else if (this.expandLevel === 0) {
                // 0 为全部展开
                expanded = true;
            }
            else {
                // 没有启用分层加载，通过展开层级确定是否展开该节点
                expanded = layer <= this.expandLevel;
                // 如果节点原本存在且节点没有展开则不展开
                const oldTreeNode = this.getOldNode(nodeData);
                if (oldTreeNode && !oldTreeNode.expanded) {
                    expanded = false;
                }
            }
        }
        return expanded;
    }
    /**
     * 展开树节点
     * @description 完全加载树使用展开属性在buildNode时已经展开，此函数的主要用于展开分级加载树
     * @param nodeData nodeData
     */
    expandNode(nodeData) {
        const [path, layer] = [this.getNodePath(nodeData), this.getNodeLayer(nodeData)];
        const childs = this.getChildNodesData(path, layer);
        // 当前节点不是叶子节点，但在节点数据中又找不到该节点的子节点，则认为树启用了分层加载
        if (!childs || childs.length < 1) {
            // 分层加载树需要通过触发节点展开事件才加载下层，目前树上还不存在该节点，无法直接展开，需要等树加载完之后再展开
            const id = this.getPrimary(nodeData);
            if (this.nodesWaitExpand.findIndex(node => node && node.id === id) < 0) {
                this.nodesWaitExpand.push({ id, expanded: false });
            }
        }
    }
    /**
     * 树加载完成事件
     */
    onTreeLoadComplete() {
        const index = this.nodesWaitExpand.findIndex(node => !node.expanded);
        const nodeData = this.nodesWaitExpand[index] || {};
        const { id } = nodeData;
        if (id) {
            const rowNode = this.component.findRowNode(id);
            if (rowNode) {
                nodeData.expanded = true;
                // if (nodeData && nodeData.node && !nodeData.node.expanded) {
                //   return;
                // }
                this.component.expandNode(id);
            }
        }
    }
    /**
     * 获取主键
     * @param nodeData nodeData
     */
    getPrimary(nodeData) {
        return nodeData[this.primaryKey];
    }
    // #region 工具方法，待单独封装
    /**
     * 获取子级节点的数据集合
     */
    getChildNodesData(fPath, fLayer) {
        const childNodesData = [];
        this.allNodesData.forEach((nodeData) => {
            // @todo：待删除，兼容没有hierarchyInfo的数据
            const hierarchyInfo = this.getHierarchyInfo(nodeData); //this.getValue(nodeData, this.hierarchyInfoKey); /// nodeData[this.hierarchyInfoKey];
            if (!hierarchyInfo) {
                return;
            }
            // 匹配节点
            const currentLayer = hierarchyInfo['layer'];
            const currentPath = hierarchyInfo['path'];
            if ((currentLayer === fLayer + 1) && currentPath && currentPath.startsWith(fPath)) {
                childNodesData.push(nodeData);
            }
        });
        return childNodesData;
    }
    getHierarchyInfo(nodeData) {
        return this.getValue(nodeData, this.hierarchyInfoKey); //nodeData[this.hierarchyInfoKey];
    }
    initLevelGroup() {
        this.levelGroup = {};
        this.allNodesData.forEach((nodeData) => {
            const hierarchyInfo = this.getHierarchyInfo(nodeData);
            const key = `level${hierarchyInfo.layer}`;
            if (this.levelGroup[key]) {
                this.levelGroup[key].push(nodeData);
            }
            else {
                this.levelGroup[key] = [nodeData];
            }
        });
    }
    getParentId(node) {
        const hierarchyInfo = this.getHierarchyInfo(node);
        const parentLevelGroup = this.levelGroup[this.getLevelGroupKey(hierarchyInfo.layer - 1)] || [];
        const parent = parentLevelGroup.find(nodeData => {
            const currentHierarchyInfo = this.getHierarchyInfo(nodeData);
            if (currentHierarchyInfo.isDetail === true) {
                return false;
            }
            return hierarchyInfo.path.startsWith(currentHierarchyInfo.path);
        });
        if (parent) {
            return parent.id;
        }
        else {
            return null;
        }
    }
    getLevelGroupKey(level) {
        return `level${level}`;
    }
    /**
     * 根据路径获取数据
     * @param target target
     * @param path 路径
     */
    getValue(target, path) {
        if (path.indexOf('/') === -1) {
            return target[path];
        }
        const paths = path.split('/').filter(p => p);
        if (paths.length < 1) {
            return target;
        }
        return paths.reduce((result, path) => {
            return result && result[path];
        }, target);
    }
    /**
     * 获取分级信息中的层级
     * @param nodeData nodeData
     */
    getNodeLayer(nodeData) {
        const hierarchyInfo = this.getHierarchyInfo(nodeData);
        return hierarchyInfo['layer'];
    }
    /**
     * 获取分级信息中的路径
     * @param nodeData nodeData
     */
    getNodePath(nodeData) {
        const hierarchyInfo = this.getHierarchyInfo(nodeData);
        return hierarchyInfo['path'];
    }
    /**
     * 获取展开状态
     */
    isExpanded(newData) {
        const oldTreeNode = this.getOldNode(newData);
        return oldTreeNode ? oldTreeNode.expanded : undefined;
    }
    /**
     * 是否是叶子节点
     * @todo：服务器端对isDetail的目前没有与前端同步，isDetail不准确。
     */
    isLeaf(nodeData) {
        const hierarchyInfo = this.getHierarchyInfo(nodeData); // nodeData[this.hierarchyInfoKey];
        const isDetail = hierarchyInfo['isDetail'];
        return isDetail;
    }
    /**
     * 判断节点是否是新增
     * @todo：不应该这样判断，待优化。
     * @summary
     * 1、非空树（空树视为初次加载数据）；
     * 2、找不到oldNode。
     */
    isNewNode(nodeData) {
        if (this.allOldNodesMap.size === 0) {
            return false;
        }
        const oldTreeNode = this.getOldNode(nodeData);
        return oldTreeNode ? false : true;
    }
    /**
     * 展开父节点
     */
    expandParentNode(nodeData) {
        const parentTreeNode = this.getParentNode(nodeData);
        if (!parentTreeNode) {
            return;
        }
        parentTreeNode.leaf = false;
        parentTreeNode.expanded = true;
    }
    /**
     * 查找父节点
     */
    getParentNode(nodeData) {
        const hierarchyInfo = this.getHierarchyInfo(nodeData); //nodeData[this.hierarchyInfoKey];
        const layer = hierarchyInfo['layer'];
        const path = hierarchyInfo['path'];
        const allNodes = Array.from(this.allNodesMap.values());
        const parentNode = allNodes.find((currentNode) => {
            const currentLayer = this.getValue(currentNode.data, this.hierarchyInfoKey)['layer']; //currentNode.data[this.hierarchyInfoKey]['layer'];
            const currentPath = this.getValue(currentNode.data, this.hierarchyInfoKey)['path']; //  currentNode.data[this.hierarchyInfoKey]['path'];
            if ((layer === currentLayer + 1) && path.startsWith(currentPath) === true) {
                return true;
            }
            return false;
        });
        return parentNode;
    }
    /**
     * 获取老的树节点
     */
    getOldNode(nodeData) {
        const id = nodeData[this.primaryKey];
        return this.allOldNodesMap.get(id);
    }
    /**
     * 打平TreeNodes，并放入一个Map中
     */
    buildNodesDataMap(treeNodes) {
        treeNodes.forEach((treeNode) => {
            this.allOldNodesMap.set(treeNode.data[this.primaryKey], treeNode);
            if (treeNode.children) {
                this.buildNodesDataMap(treeNode.children);
            }
        });
    }
}
export { PathTreeNodeBuilder };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGF0aF90cmVlX25vZGVfYnVpbGRlci5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMva2VuZG8tYmluZGluZy8iLCJzb3VyY2VzIjpbImxpYi9kaXJlY3RpdmVzL3RyZWVfdGFibGVfbm9kZV9idWlsZGVyL3BhdGhfdHJlZV9ub2RlX2J1aWxkZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBVUEsb0NBQW9DO0FBQ3BDOzs7O0dBSUc7QUFDSCxNQUFNLG1CQUFtQjtJQUd2Qjs7T0FFRztJQUNILFlBQVksWUFBbUIsRUFBRSxZQUF3QixFQUFFLFVBQWtCLEVBQUUsZ0JBQXdCLEVBQUUsT0FBYTtRQUw5RyxlQUFVLEdBQStCLEVBQUUsQ0FBQztRQXNDcEQ7Ozs7OztXQU1HO1FBQ0ssb0JBQWUsR0FBVSxFQUFFLENBQUM7UUF2Q2xDLElBQUksQ0FBQyxVQUFVLEdBQUcsVUFBVSxDQUFDO1FBQzdCLElBQUksQ0FBQyxnQkFBZ0IsR0FBRyxnQkFBZ0IsQ0FBQztRQUN6QyxJQUFJLENBQUMsUUFBUSxHQUFHLEVBQUUsQ0FBQztRQUNuQixJQUFJLENBQUMsWUFBWSxHQUFHLFlBQVksQ0FBQztRQUNqQyxJQUFJLENBQUMsT0FBTyxHQUFHLE9BQU8sSUFBSSxFQUFFLENBQUM7UUFDN0IsSUFBSSxDQUFDLGVBQWUsR0FBRyxFQUFFLENBQUM7UUFDMUIsSUFBSSxDQUFDLGlCQUFpQixHQUFHLE9BQU8sSUFBSSxPQUFPLENBQUMsaUJBQWlCLElBQUksRUFBRSxDQUFDO1FBQ3BFLElBQUksQ0FBQyxZQUFZLEdBQUcsT0FBTyxJQUFJLE9BQU8sQ0FBQyxZQUFZLElBQUksSUFBSSxDQUFDO1FBQzVELElBQUksQ0FBQywyQkFBMkIsQ0FBQyxJQUFJLENBQUMsa0JBQWtCLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7UUFFckUsSUFBSSxDQUFDLGNBQWMsRUFBRSxDQUFDO1FBQ3RCLElBQUksQ0FBQyxXQUFXLEdBQUcsSUFBSSxHQUFHLEVBQW9CLENB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QUVHO0lBQ0ssVUFBVSxDQUFDLFFBQWE7UUFDOUIsTUFBTSxFQUFFLEdBQUcsUUFBUSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQztRQUNyQyxPQUFPLElBQUksQ0FBQyxjQUFjLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxDQUFDO0lBQ3JDLENBQUM7SUFFRDs7T0FFRztJQUNLLGlCQUFpQixDQUFDLFNBQXFCO1FBQzdDLFNBQVMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxRQUFrQixFQUFFLEVBQUU7WUFDdkMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxHQUFHLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLEVBQUUsUUFBUSxDQUFDLENBQUM7WUFDbEUsSUFBSSxRQUFRLENBQUMsUUFBUSxFQUFFO2dCQUNyQixJQUFJLENBQUMsaUJBQWlCLENBQUMsUUFBUSxDQUFDLFFBQVEsQ0FBQyxDQUFDO2FBQzNDO1FBQ0gsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDO0NBR0Y7QUFFRCxPQUFPLEVBQUUsbUJBQW1CLEVBQUUsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIlxyXG4vKlxyXG4gKiBAQXV0aG9yOiBXaXR0XHJcbiAqIEBEYXRlOiAyMDE5LTA0LTAxIDE3OjI2OjUwXHJcbiAqIEBMYXN0IE1vZGlmaWVkIGJ5OiBhYWxpenp3ZWxsXHJcbiAqIEBMYXN0IE1vZGlmaWVkIHRpbWU6IDIwMTktMTItMTIgMTY6MTc6MDZcclxuICovXHJcbmltcG9ydCB7IEZyYW1lQ29udGV4dCB9IGZyb20gJ0BmYXJyaXMvZGV2a2l0JztcclxuaW1wb3J0IHsgVHJlZU5vZGUsIFRyZWVUYWJsZUNvbXBvbmVudCB9IGZyb20gJ0BmYXJyaXMvdWktdHJlZXRhYmxlJztcclxuaW1wb3J0IHsgUGF0aEhpZXJhcmNoeUluZm8gfSBmcm9tICcuL3R5cGVzJztcclxuLy8gdHNsaW50OmRpc2FibGU6IG5vLXN0cmluZy1saXRlcmFsXHJcbi8qKlxyXG4gKiDmoJHoioLngrnmnoTpgKDlmahcclxuICogQHN1bW1hcnlcclxuICog5bCGQmluZGluZ0RhdGHkuK3nmoTmlbDmja7pm4blkIjovazmjaLmiJBUcmVlVGFibGXoioLngrnpm4blkIhcclxuICovXHJcbmNsYXNzIFBhdGhUcmVlTm9kZUJ1aWxkZXIge1xyXG4gIHByaXZhdGUgbGV2ZWxHcm91cDogeyBbbGV2ZWw6IHN0cmluZ106IGFueVtdIH0gPSB7fTtcclxuICBwcml2YXRlIGZyYW1lQ29udGV4dDogRnJhbWVDb250ZXh0O1xyXG4gIC8qKlxyXG4gICAqIOaehOmAoOWHveaVsFxyXG4gICAqL1xyXG4gIGNvbnN0cnVjdG9yKGFsbE5vZGVzRGF0YTogYW55W10sIG9sZFRyZWVOb2RlczogVHJlZU5vZGVbXSwgcHJpbWFyeUtleTogc3RyaW5nLCBoaWVyYXJjaHlJbmZvS2V5OiBzdHJpbmcsIGNvbnRleHQ/OiBhbnkpIHtcclxuICAgIHRoaXMucHJpbWFyeUtleSA9IHByaW1hcnlLZXk7XHJcbiAgICB0aGlzLmhpZXJhcmNoeUluZm9LZXkgPSBoaWVyYXJjaHlJbmZvS2V5O1xyXG4gICAgdGhpcy5hbGxOb2RlcyA9IFtdO1xyXG4gICAgdGhpcy5hbGxOb2Rlc0RhdGEgPSBhbGxOb2Rlc0RhdGE7XHJcbiAgICB0aGlzLmNvbnRleHQgPSBjb250ZXh0IHx8IHt9O1xyXG4gICAgdGhpcy5ub2Rlc1dhaXRFeHBhbmQgPSBbXTtcclxuICAgIHRoaXMubm9kZXNTaG91bGRFeHBhbmQgPSBjb250ZXh0ICYmIGNvbnRleHQubm9kZXNTaG91bGRFeHBhbmQgfHwgW107XHJcbiAgICB0aGlzLmZyYW1lQ29udGV4dCA9IGNvbnRleHQgJiYgY29udGV4dC5mcmFtZUNvbnRleHQgfHwgbnVsbDtcclxuICAgIHRoaXMuYWRkVHJlZUxvYWRDb21wbGV0ZUxpc3RlbmVyKHRoaXMub25UcmVlTG9hZENvbXBsZXRlLmJpbmQodGhpcykpO1xyXG5cclxuICAgIHRoaXMuaW5pdExldmVsR3JvdXAoKTtcclxuICAgIHRoaXMuYWxsTm9kZXNNYXAgPSBuZXcgTWFwPHN0cmluZywgVHJlZU5vZGU+KCk7XHJcbiAgICB0aGlzLmFsbE9sZE5vZGVzTWFwID0gbmV3IE1hcDxzdHJpbmcsIFRyZWVOb2RlPigpO1xyXG4gICAgdGhpcy5idWlsZE5vZGVzRGF0YU1hcChvbGRUcmVlTm9kZXMpO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDlsZXlvIDoh7PlsYLnuqdcclxuICAgKiBAZGVzY3JpcHRpb24gLTHkuLrkuI3lsZXlvIBcclxuICAgKi9cclxuICBwcml2YXRlIGdldCBleHBhbmRMZXZlbCgpIHtcclxuICAgIHJldHVybiB0aGlzLmNvbnRleHQgJiYgdGhpcy5jb250ZXh0Lmhhc093blByb3BlcnR5KCdleHBhbmRMZXZlbCcpID8gdGhpcy5jb250ZXh0WydleHBhbmRMZXZlbCddIDogLTE7XHJcbiAgfVxyXG4gIHByaXZhdGUgZ2V0IGNvbXBvbmVudCgpOiBUcmVlVGFibGVDb21wb25lbnQge1xyXG4gICAgcmV0dXJuIHRoaXMuY29udGV4dCAmJiB0aGlzLmNvbnRleHRbJ2NvbXBvbmVudCddO1xyXG4gIH1cclxuICBwcml2YXRlIGdldCBhZGRUcmVlTG9hZENvbXBsZXRlTGlzdGVuZXIoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5jb250ZXh0ICYmIHRoaXMuY29udGV4dFsnYWRkVHJlZUxvYWRDb21wbGV0ZUxpc3RlbmVyJ10gfHwgZnVuY3Rpb24gKGFyZ3M6IGFueSkgeyB9O1xyXG4gIH1cclxuICAvKipcclxuICAgKiDpnIDopoHlsZXlvIDnmoToioLngrlcclxuICAgKi9cclxuICBwcml2YXRlIG5vZGVzU2hvdWxkRXhwYW5kOiBzdHJpbmdbXTtcclxuICAvKipcclxuICAgKiDnrYnlvoXlsZXlvIDnmoToioLngrlcclxuICAgKiBAZGVzY3JpcHRpb24g6IqC54K557uT5p6EXHJcbiAgICogYGBgXHJcbiAgICoge2lkOid4eHgnLGV4cGFuZGVkOmZhbHNlfVxyXG4gICAqIGBgYFxyXG4gICAqL1xyXG4gIHByaXZhdGUgbm9kZXNXYWl0RXhwYW5kOiBhbnlbXSA9IFtdO1xyXG5cclxuICAvKipcclxuICAgKiDkuLvplK7lrZfmrrXlkI1cclxuICAgKi9cclxuICBwcml2YXRlIHByaW1hcnlLZXk6IHN0cmluZztcclxuXHJcbiAgLyoqXHJcbiAgICog5YiG57qn56CB5a2X5q615ZCNXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBoaWVyYXJjaHlJbmZvS2V5OiBzdHJpbmc7XHJcblxyXG4gIC8qKlxyXG4gICAqIOiKgueCueeahOaVsOaNrumbhuWQiFxyXG4gICAqL1xyXG4gIHByaXZhdGUgYWxsTm9kZXNEYXRhOiBhbnlbXTtcclxuXHJcbiAgLyoqXHJcbiAgICog6IqC54K56ZuG5ZCIXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBhbGxOb2RlczogVHJlZU5vZGVbXTtcclxuXHJcbiAgLyoqXHJcbiAgICog5LiK5LiA5qyh57uR5a6a55qE5qCR6IqC54K56ZuG5ZCITWFwXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBhbGxOb2Rlc01hcDogTWFwPHN0cmluZywgVHJlZU5vZGU+O1xyXG5cclxuICAvKipcclxuICAgKiDkuIrkuIDmrKHnu5HlrprnmoTmoJHoioLngrnpm4blkIhNYXBcclxuICAgKi9cclxuICBwcml2YXRlIGFsbE9sZE5vZGVzTWFwOiBNYXA8c3RyaW5nLCBUcmVlTm9kZT47XHJcbiAgLyoqXHJcbiAgICog5LiK5LiL5paHXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBjb250ZXh0OiBhbnk7XHJcbiAgcHVibGljIHVwZGF0ZVRyZWVOb2RlKGFsbE5vZGVzRGF0YTogYW55LCBkYXRhOiBhbnkpIHtcclxuICAgIHRoaXMuYWxsTm9kZXNEYXRhID0gYWxsTm9kZXNEYXRhO1xyXG4gICAgdGhpcy5pbml0TGV2ZWxHcm91cCgpO1xyXG4gICAgdGhpcy5idWlsZE5vZGVzRGF0YU1hcChkYXRhKTtcclxuICB9XHJcbiAgcHVibGljIGJ1aWxkKCk6IFRyZWVOb2RlW10ge1xyXG4gICAgY29uc3QgdHJlZTogVHJlZU5vZGVbXSA9IFtdO1xyXG4gICAgY29uc3QgY2hpbGRyZW5PZiA9IHt9O1xyXG4gICAgY29uc3Qgbm9kZXMgPSB7fTtcclxuICAgIHRoaXMuYWxsTm9kZXNEYXRhLmZvckVhY2goaXRlbSA9PiB7XHJcbiAgICAgIGNvbnN0IGlkID0gaXRlbS5pZDtcclxuICAgICAgY29uc3QgcGFyZW50SWQgPSB0aGlzLmdldFBhcmVudElkKGl0ZW0pO1xyXG5cclxuICAgICAgLy8gaXRlbS5wYXJlbnRJZCA9IHBhcmVudElkO1xyXG4gICAgICAvLyDlsZXlvIDmlrDlop7oioLngrnnmoTniLboioLngrlcclxuICAgICAgY29uc3QgaXNOZXdOb2RlID0gdGhpcy5pc05ld05vZGUoaXRlbSk7XHJcbiAgICAgIGlmIChpc05ld05vZGUgPT09IHRydWUpIHtcclxuICAgICAgICB0aGlzLmV4cGFuZFBhcmVudE5vZGUoaXRlbSk7XHJcbiAgICAgIH1cclxuICAgICAgLy8g5p6E6YCg5qCR6IqC54K5XHJcbiAgICAgIGNvbnN0IG5vZGUgPSB0aGlzLmJ1aWxkTm9kZShpdGVtKTtcclxuICAgICAgbm9kZXNbaWRdID0gbm9kZTtcclxuICAgICAgY2hpbGRyZW5PZltpZF0gPSBjaGlsZHJlbk9mW2lkXSB8fCBbXTtcclxuICAgICAgbm9kZS5jaGlsZHJlbiA9IGNoaWxkcmVuT2ZbaWRdO1xyXG5cclxuICAgICAgdGhpcy5hbGxOb2Rlc01hcC5zZXQoaXRlbVt0aGlzLnByaW1hcnlLZXldLCBub2RlKTtcclxuICAgICAgaWYgKHBhcmVudElkKSB7XHJcbiAgICAgICAgaWYgKG5vZGVzW3BhcmVudElkXSAmJiBub2Rlc1twYXJlbnRJZF0udW5zdGFibGVTdGF0ZSA9PT0gdHJ1ZSkge1xyXG4gICAgICAgICAgbm9kZXNbcGFyZW50SWRdLmV4cGFuZGVkID0gdHJ1ZTtcclxuICAgICAgICAgIG5vZGVzW3BhcmVudElkXS51bnN0YWJsZVN0YXRlID0gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNoaWxkcmVuT2ZbcGFyZW50SWRdID0gY2hpbGRyZW5PZltwYXJlbnRJZF0gfHwgW107XHJcbiAgICAgICAgY2hpbGRyZW5PZltwYXJlbnRJZF0ucHVzaChub2RlKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBpZiAoKCFub2RlLmNoaWxkcmVuIHx8IG5vZGUuY2hpbGRyZW4ubGVuZ3RoIDwgMSkgJiYgbm9kZS5leHBhbmRlZCA9PT0gdHJ1ZSkge1xyXG4gICAgICAgICAgbm9kZS51bnN0YWJsZVN0YXRlID0gdHJ1ZTtcclxuICAgICAgICAgIG5vZGUuZXhwYW5kZWQgPSBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdHJlZS5wdXNoKG5vZGUpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICAgIHJldHVybiB0cmVlO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDmnoTpgKDmoJHoioLngrlcclxuICAgKi9cclxuICBwdWJsaWMgYnVpbGQxKCk6IFRyZWVOb2RlW10ge1xyXG4gICAgbGV0IG1pbkxheWVyO1xyXG4gICAgLy8g6I635Y+W5pyA6aG257qn6IqC54K555qEbGF5ZXJcclxuICAgIHRoaXMuYWxsTm9kZXNEYXRhLmZvckVhY2gobm9kZSA9PiB7XHJcbiAgICAgIGNvbnN0IGhpZXJhcmNoeUluZm8gPSB0aGlzLmdldEhpZXJhcmNoeUluZm8obm9kZSk7XHJcbiAgICAgIGlmIChoaWVyYXJjaHlJbmZvKSB7XHJcbiAgICAgICAgY29uc3QgbGF5ZXIgPSBoaWVyYXJjaHlJbmZvWydsYXllciddO1xyXG4gICAgICAgIGlmICghaXNOYU4obGF5ZXIpKSB7XHJcbiAgICAgICAgICBpZiAobWluTGF5ZXIgPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICBtaW5MYXllciA9IGxheWVyO1xyXG4gICAgICAgICAgfSBlbHNlIGlmIChsYXllciA8IG1pbkxheWVyKSB7XHJcbiAgICAgICAgICAgIG1pbkxheWVyID0gbGF5ZXI7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICAgIGNvbnN0IHRvcExheWVyID0gbWluTGF5ZXIgLSAxO1xyXG4gICAgdGhpcy5idWlsZE5vZGVzKCcnLCB0b3BMYXllciwgdGhpcy5hbGxOb2Rlc0RhdGEsIHRoaXMuYWxsTm9kZXMpO1xyXG4gICAgcmV0dXJuIHRoaXMuYWxsTm9kZXM7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDmnoTpgKDmoJHoioLngrnpm4blkIhcclxuICAgKi9cclxuICBwcml2YXRlIGJ1aWxkTm9kZXMoZlBhdGg6IHN0cmluZywgZkxheWVyOiBudW1iZXIsIGFsbE5vZGVzRGF0YTogYW55W10sIHRyZWVOb2RlczogVHJlZU5vZGVbXSk6IHZvaWQge1xyXG4gICAgY29uc3QgY2hpbGROb2Rlc0RhdGEgPSB0aGlzLmdldENoaWxkTm9kZXNEYXRhKGZQYXRoLCBmTGF5ZXIpO1xyXG4gICAgY2hpbGROb2Rlc0RhdGEuZm9yRWFjaCgobm9kZURhdGE6IGFueSkgPT4ge1xyXG4gICAgICAvLyDlsZXlvIDmlrDlop7oioLngrnnmoTniLboioLngrlcclxuICAgICAgY29uc3QgaXNOZXdOb2RlID0gdGhpcy5pc05ld05vZGUobm9kZURhdGEpO1xyXG4gICAgICBpZiAoaXNOZXdOb2RlID09PSB0cnVlKSB7XHJcbiAgICAgICAgdGhpcy5leHBhbmRQYXJlbnROb2RlKG5vZGVEYXRhKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8g5p6E6YCg5qCR6IqC54K5XHJcbiAgICAgIGNvbnN0IG5vZGUgPSB0aGlzLmJ1aWxkTm9kZShub2RlRGF0YSk7XHJcbiAgICAgIHRyZWVOb2Rlcy5wdXNoKG5vZGUpO1xyXG4gICAgICB0aGlzLmFsbE5vZGVzTWFwLnNldChub2RlRGF0YVt0aGlzLnByaW1hcnlLZXldLCBub2RlKTtcclxuXHJcbiAgICAgIC8vIOmAkuW9kumBjeWOhuS4i+e6p+iKgueCuVxyXG4gICAgICBjb25zdCBoaWVyYXJjaHlJbmZvID0gdGhpcy5nZXRIaWVyYXJjaHlJbmZvKG5vZGVEYXRhKTsvL25vZGVEYXRhW3RoaXMuaGllcmFyY2h5SW5mb0tleV07XHJcbiAgICAgIGNvbnN0IGN1cnJlbnRMYXllciA9IGhpZXJhcmNoeUluZm9bJ2xheWVyJ107XHJcbiAgICAgIGNvbnN0IGN1cnJlbnRQYXRoID0gaGllcmFyY2h5SW5mb1sncGF0aCddO1xyXG4gICAgICB0aGlzLmJ1aWxkTm9kZXMoY3VycmVudFBhdGgsIGN1cnJlbnRMYXllciwgYWxsTm9kZXNEYXRhLCBub2RlLmNoaWxkcmVuIGFzIFRyZWVOb2RlW10pO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDliJvlu7rmoJHoioLngrlcclxuICAgKi9cclxuICBwcml2YXRlIGJ1aWxkTm9kZShub2RlRGF0YTogYW55KTogVHJlZU5vZGUgJiB7IHVuc3RhYmxlU3RhdGU/OiBib29sZWFuIH0ge1xyXG4gICAgY29uc3QgaXNMZWFmID0gdGhpcy5pc0xlYWYobm9kZURhdGEpO1xyXG4gICAgLy8g6I635Y+W6IqC54K555qE5bGV5byA54q25oCBXHJcbiAgICBjb25zdCBzaG91bGRFeHBhbmQgPSB0aGlzLnNob3VsZEV4cGFuZChub2RlRGF0YSk7XHJcbiAgICAvLyDoioLngrnomb3nhLblupTor6XlsZXlvIDvvIzkvYblj6/og73mmK/lm6DkuLrkuYvliY3lsLHmmK/lsZXlvIDnirbmgIHvvIzmiYDku6XlupTor6Xmo4Dmn6XoioLngrnkuYvliY3nmoTnirbmgIFcclxuICAgIGNvbnN0IG9yaWdpbkV4cGFuZFN0YXR1cyA9IHRoaXMuaXNFeHBhbmRlZChub2RlRGF0YSk7XHJcbiAgICAvLyDlpoLmnpzlupTor6XlsZXlvIDor6XoioLngrnvvIzkvYbmmK/or6XoioLngrnkuYvliY3mnInnirbmgIHvvIzpgqPkuYjor6XoioLngrnkuI3lupTor6Xlho3nlLHnqIvluo/lsZXlvIDjgIJcclxuICAgIGlmICghb3JpZ2luRXhwYW5kU3RhdHVzICYmIHNob3VsZEV4cGFuZCkge1xyXG4gICAgICB0aGlzLmV4cGFuZE5vZGUobm9kZURhdGEpO1xyXG4gICAgfVxyXG4gICAgY29uc3QgcGFnaW5hdGlvbkluZm8gPSB0aGlzLmJ1aWxkUGFnaW5hdGlvbkluZm8obm9kZURhdGEpO1xyXG4gICAgY29uc3QgdHJlZU5vZGU6IFRyZWVOb2RlID0ge1xyXG4gICAgICBkYXRhOiBPYmplY3QuYXNzaWduKHt9LCBub2RlRGF0YSksXHJcbiAgICAgIGNoaWxkcmVuOiBbXSxcclxuICAgICAgZXhwYW5kZWQ6IHNob3VsZEV4cGFuZCxcclxuICAgICAgbGVhZjogaXNMZWFmXHJcbiAgICB9O1xyXG4gICAgaWYgKHBhZ2luYXRpb25JbmZvKSB7XHJcbiAgICAgIHRyZWVOb2RlLnBhZ2luYXRpb24gPSBwYWdpbmF0aW9uSW5mbztcclxuICAgIH1cclxuICAgIHJldHVybiB0cmVlTm9kZTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5p6E6YCg5YiG6aG15L+h5oGvXHJcbiAgICogQHBhcmFtIG5vZGVEYXRhIG5vZGVEYXRhXHJcbiAgICogQHJldHVybnMgXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBidWlsZFBhZ2luYXRpb25JbmZvKG5vZGVEYXRhOiBhbnkpOiB7IHBhZ2VJbmRleDogbnVtYmVyLCBwYWdlU2l6ZTogbnVtYmVyLCB0b3RhbDogbnVtYmVyIH0gfCBudWxsIHtcclxuICAgIGxldCByZXN1bHQgPSBudWxsO1xyXG4gICAgaWYgKHRoaXMuZnJhbWVDb250ZXh0KSB7XHJcbiAgICAgIGNvbnN0IGlkID0gdGhpcy5nZXRQcmltYXJ5KG5vZGVEYXRhKTtcclxuICAgICAgLy8g6I635Y+W5YiG6aG15L+h5oGvXHJcbiAgICAgIGNvbnN0IGtleSA9IGBfTk9ERV8ke2lkfV9QQUdJTkFUSU9OX0lORk9fYDtcclxuICAgICAgY29uc3QgcGFnaW5hdGlvbiA9IHRoaXMuZnJhbWVDb250ZXh0LnBhcmFtcy5nZXQoa2V5KSB8fCBudWxsO1xyXG4gICAgICBpZiAocGFnaW5hdGlvbiAmJiBwYWdpbmF0aW9uLnBhZ2VDb3VudCA+IDEpIHtcclxuICAgICAgICByZXN1bHQgPSB7XHJcbiAgICAgICAgICBwYWdlSW5kZXg6IHBhZ2luYXRpb24ucGFnZUluZGV4LFxyXG4gICAgICAgICAgcGFnZVNpemU6IHBhZ2luYXRpb24ucGFnZVNpemUsXHJcbiAgICAgICAgICB0b3RhbDogcGFnaW5hdGlvbi50b3RhbENvdW50XHJcbiAgICAgICAgfTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIHJlc3VsdDtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog6K6h566X6IqC54K55piv5ZCm6ZyA6KaB5bGV5byAXHJcbiAgICogQHBhcmFtIG5vZGVEYXRhIG5vZGVEYXRhXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBzaG91bGRFeHBhbmQobm9kZURhdGE6IGFueSk6IGJvb2xlYW4ge1xyXG4gICAgY29uc3QgW2xheWVyLCBpc0xlYWZdID0gW3RoaXMuZ2V0Tm9kZUxheWVyKG5vZGVEYXRhKSwgdGhpcy5pc0xlYWYobm9kZURhdGEpXTtcclxuICAgIC8vIOawuOi/nOS4jeWxleW8gOWPtuWtkOiKgueCuVxyXG4gICAgaWYgKGlzTGVhZikge1xyXG4gICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcbiAgICBsZXQgZXhwYW5kZWQgPSB0aGlzLmlzRXhwYW5kZWQobm9kZURhdGEpO1xyXG4gICAgaWYgKCFleHBhbmRlZCkge1xyXG4gICAgICBjb25zdCBpZCA9IHRoaXMuZ2V0UHJpbWFyeShub2RlRGF0YSk7XHJcbiAgICAgIGlmICh0aGlzLm5vZGVzV2FpdEV4cGFuZC5maW5kSW5kZXgobm9kZSA9PiBub2RlICYmIG5vZGUuaWQgPT09IGlkKSA+IC0xKSB7XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICB9XHJcbiAgICAgIGlmICh0aGlzLm5vZGVzU2hvdWxkRXhwYW5kLmZpbmRJbmRleChub2RlSWQgPT4gbm9kZUlkID09PSBpZCkgPiAtMSkge1xyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICB9XHJcbiAgICAgIGlmICh0aGlzLmV4cGFuZExldmVsID09PSAtMSkge1xyXG4gICAgICAgIC8vIC0xIOS4uuS4jeWxleW8gFxyXG4gICAgICAgIGV4cGFuZGVkID0gZmFsc2U7XHJcbiAgICAgIH0gZWxzZSBpZiAodGhpcy5leHBhbmRMZXZlbCA9PT0gMCkge1xyXG4gICAgICAgIC8vIDAg5Li65YWo6YOo5bGV5byAXHJcbiAgICAgICAgZXhwYW5kZWQgPSB0cnVlO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIC8vIOayoeacieWQr+eUqOWIhuWxguWKoOi9ve+8jOmAmui/h+WxleW8gOWxgue6p+ehruWumuaYr+WQpuWxleW8gOivpeiKgueCuVxyXG4gICAgICAgIGV4cGFuZGVkID0gbGF5ZXIgPD0gdGhpcy5leHBhbmRMZXZlbDtcclxuICAgICAgICAvLyDlpoLmnpzoioLngrnljp/mnKzlrZjlnKjkuJToioLngrnmsqHmnInlsZXlvIDliJnkuI3lsZXlvIBcclxuICAgICAgICBjb25zdCBvbGRUcmVlTm9kZSA9IHRoaXMuZ2V0T2xkTm9kZShub2RlRGF0YSk7XHJcbiAgICAgICAgaWYgKG9sZFRyZWVOb2RlICYmICFvbGRUcmVlTm9kZS5leHBhbmRlZCkge1xyXG4gICAgICAgICAgZXhwYW5kZWQgPSBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIHJldHVybiBleHBhbmRlZDtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5bGV5byA5qCR6IqC54K5XHJcbiAgICogQGRlc2NyaXB0aW9uIOWujOWFqOWKoOi9veagkeS9v+eUqOWxleW8gOWxnuaAp+WcqGJ1aWxkTm9kZeaXtuW3sue7j+WxleW8gO+8jOatpOWHveaVsOeahOS4u+imgeeUqOS6juWxleW8gOWIhue6p+WKoOi9veagkVxyXG4gICAqIEBwYXJhbSBub2RlRGF0YSBub2RlRGF0YVxyXG4gICAqL1xyXG4gIHByaXZhdGUgZXhwYW5kTm9kZShub2RlRGF0YTogYW55KSB7XHJcbiAgICBjb25zdCBbcGF0aCwgbGF5ZXJdID0gW3RoaXMuZ2V0Tm9kZVBhdGgobm9kZURhdGEpLCB0aGlzLmdldE5vZGVMYXllcihub2RlRGF0YSldO1xyXG4gICAgY29uc3QgY2hpbGRzID0gdGhpcy5nZXRDaGlsZE5vZGVzRGF0YShwYXRoLCBsYXllcik7XHJcblxyXG4gICAgLy8g5b2T5YmN6IqC54K55LiN5piv5Y+25a2Q6IqC54K577yM5L2G5Zyo6IqC54K55pWw5o2u5Lit5Y+I5om+5LiN5Yiw6K+l6IqC54K555qE5a2Q6IqC54K577yM5YiZ6K6k5Li65qCR5ZCv55So5LqG5YiG5bGC5Yqg6L29XHJcbiAgICBpZiAoIWNoaWxkcyB8fCBjaGlsZHMubGVuZ3RoIDwgMSkge1xyXG4gICAgICAvLyDliIblsYLliqDovb3moJHpnIDopoHpgJrov4fop6blj5HoioLngrnlsZXlvIDkuovku7bmiY3liqDovb3kuIvlsYLvvIznm67liY3moJHkuIrov5jkuI3lrZjlnKjor6XoioLngrnvvIzml6Dms5Xnm7TmjqXlsZXlvIDvvIzpnIDopoHnrYnmoJHliqDovb3lrozkuYvlkI7lho3lsZXlvIBcclxuICAgICAgY29uc3QgaWQgPSB0aGlzLmdldFByaW1hcnkobm9kZURhdGEpO1xyXG4gICAgICBpZiAodGhpcy5ub2Rlc1dhaXRFeHBhbmQuZmluZEluZGV4KG5vZGUgPT4gbm9kZSAmJiBub2RlLmlkID09PSBpZCkgPCAwKSB7XHJcbiAgICAgICAgdGhpcy5ub2Rlc1dhaXRFeHBhbmQucHVzaCh7IGlkLCBleHBhbmRlZDogZmFsc2UgfSk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcbiAgLyoqXHJcbiAgICog5qCR5Yqg6L295a6M5oiQ5LqL5Lu2XHJcbiAgICovXHJcbiAgcHJpdmF0ZSBvblRyZWVMb2FkQ29tcGxldGUoKSB7XHJcbiAgICBjb25zdCBpbmRleCA9IHRoaXMubm9kZXNXYWl0RXhwYW5kLmZpbmRJbmRleChub2RlID0+ICFub2RlLmV4cGFuZGVkKTtcclxuICAgIGNvbnN0IG5vZGVEYXRhID0gdGhpcy5ub2Rlc1dhaXRFeHBhbmRbaW5kZXhdIHx8IHt9O1xyXG4gICAgY29uc3QgeyBpZCB9ID0gbm9kZURhdGE7XHJcbiAgICBpZiAoaWQpIHtcclxuICAgICAgY29uc3Qgcm93Tm9kZSA9IHRoaXMuY29tcG9uZW50LmZpbmRSb3dOb2RlKGlkKTtcclxuICAgICAgaWYgKHJvd05vZGUpIHtcclxuICAgICAgICBub2RlRGF0YS5leHBhbmRlZCA9IHRydWU7XHJcbiAgICAgICAgLy8gaWYgKG5vZGVEYXRhICYmIG5vZGVEYXRhLm5vZGUgJiYgIW5vZGVEYXRhLm5vZGUuZXhwYW5kZWQpIHtcclxuICAgICAgICAvLyAgIHJldHVybjtcclxuICAgICAgICAvLyB9XHJcbiAgICAgICAgdGhpcy5jb21wb25lbnQuZXhwYW5kTm9kZShpZCk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcbiAgLyoqXHJcbiAgICog6I635Y+W5Li76ZSuXHJcbiAgICogQHBhcmFtIG5vZGVEYXRhIG5vZGVEYXRhXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBnZXRQcmltYXJ5KG5vZGVEYXRhOiBhbnkpIHtcclxuICAgIHJldHVybiBub2RlRGF0YVt0aGlzLnByaW1hcnlLZXldO1xyXG4gIH1cclxuICAvLyAjcmVnaW9uIOW3peWFt+aWueazle+8jOW+heWNleeLrOWwgeijhVxyXG5cclxuICAvKipcclxuICAgKiDojrflj5blrZDnuqfoioLngrnnmoTmlbDmja7pm4blkIhcclxuICAgKi9cclxuICBwcml2YXRlIGdldENoaWxkTm9kZXNEYXRhKGZQYXRoOiBzdHJpbmcsIGZMYXllcjogbnVtYmVyKTogYW55W10ge1xyXG4gICAgY29uc3QgY2hpbGROb2Rlc0RhdGEgPSBbXTtcclxuICAgIHRoaXMuYWxsTm9kZXNEYXRhLmZvckVhY2goKG5vZGVEYXRhOiBhbnkpID0+IHtcclxuXHJcbiAgICAgIC8vIEB0b2Rv77ya5b6F5Yig6Zmk77yM5YW85a655rKh5pyJaGllcmFyY2h5SW5mb+eahOaVsOaNrlxyXG4gICAgICBjb25zdCBoaWVyYXJjaHlJbmZvID0gdGhpcy5nZXRIaWVyYXJjaHlJbmZvKG5vZGVEYXRhKTsvL3RoaXMuZ2V0VmFsdWUobm9kZURhdGEsIHRoaXMuaGllcmFyY2h5SW5mb0tleSk7IC8vLyBub2RlRGF0YVt0aGlzLmhpZXJhcmNoeUluZm9LZXldO1xyXG4gICAgICBpZiAoIWhpZXJhcmNoeUluZm8pIHtcclxuICAgICAgICByZXR1cm47XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIOWMuemFjeiKgueCuVxyXG4gICAgICBjb25zdCBjdXJyZW50TGF5ZXIgPSBoaWVyYXJjaHlJbmZvWydsYXllciddO1xyXG4gICAgICBjb25zdCBjdXJyZW50UGF0aCA9IGhpZXJhcmNoeUluZm9bJ3BhdGgnXTtcclxuICAgICAgaWYgKChjdXJyZW50TGF5ZXIgPT09IGZMYXllciArIDEpICYmIGN1cnJlbnRQYXRoICYmIGN1cnJlbnRQYXRoLnN0YXJ0c1dpdGgoZlBhdGgpKSB7XHJcbiAgICAgICAgY2hpbGROb2Rlc0RhdGEucHVzaChub2RlRGF0YSk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgcmV0dXJuIGNoaWxkTm9kZXNEYXRhO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBnZXRIaWVyYXJjaHlJbmZvKG5vZGVEYXRhOiBhbnkpOiBQYXRoSGllcmFyY2h5SW5mbyB7XHJcbiAgICByZXR1cm4gdGhpcy5nZXRWYWx1ZShub2RlRGF0YSwgdGhpcy5oaWVyYXJjaHlJbmZvS2V5KTsvL25vZGVEYXRhW3RoaXMuaGllcmFyY2h5SW5mb0tleV07XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGluaXRMZXZlbEdyb3VwKCkge1xyXG4gICAgdGhpcy5sZXZlbEdyb3VwID0ge307XHJcbiAgICB0aGlzLmFsbE5vZGVzRGF0YS5mb3JFYWNoKChub2RlRGF0YSkgPT4ge1xyXG4gICAgICBjb25zdCBoaWVyYXJjaHlJbmZvID0gdGhpcy5nZXRIaWVyYXJjaHlJbmZvKG5vZGVEYXRhKTtcclxuICAgICAgY29uc3Qga2V5ID0gYGxldmVsJHtoaWVyYXJjaHlJbmZvLmxheWVyfWA7XHJcbiAgICAgIGlmICh0aGlzLmxldmVsR3JvdXBba2V5XSkge1xyXG4gICAgICAgIHRoaXMubGV2ZWxHcm91cFtrZXldLnB1c2gobm9kZURhdGEpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHRoaXMubGV2ZWxHcm91cFtrZXldID0gW25vZGVEYXRhXTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG4gIHByaXZhdGUgZ2V0UGFyZW50SWQobm9kZTogYW55KSB7XHJcbiAgICBjb25zdCBoaWVyYXJjaHlJbmZvID0gdGhpcy5nZXRIaWVyYXJjaHlJbmZvKG5vZGUpO1xyXG4gICAgY29uc3QgcGFyZW50TGV2ZWxHcm91cCA9IHRoaXMubGV2ZWxHcm91cFt0aGlzLmdldExldmVsR3JvdXBLZXkoaGllcmFyY2h5SW5mby5sYXllciAtIDEpXSB8fCBbXTtcclxuICAgIGNvbnN0IHBhcmVudCA9IHBhcmVudExldmVsR3JvdXAuZmluZChub2RlRGF0YSA9PiB7XHJcbiAgICAgIGNvbnN0IGN1cnJlbnRIaWVyYXJjaHlJbmZvID0gdGhpcy5nZXRIaWVyYXJjaHlJbmZvKG5vZGVEYXRhKTtcclxuICAgICAgaWYgKGN1cnJlbnRIaWVyYXJjaHlJbmZvLmlzRGV0YWlsID09PSB0cnVlKSB7XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICB9XHJcbiAgICAgIHJldHVybiBoaWVyYXJjaHlJbmZvLnBhdGguc3RhcnRzV2l0aChjdXJyZW50SGllcmFyY2h5SW5mby5wYXRoKTtcclxuICAgIH0pO1xyXG4gICAgaWYgKHBhcmVudCkge1xyXG4gICAgICByZXR1cm4gcGFyZW50LmlkO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9XHJcbiAgfVxyXG4gIHByaXZhdGUgZ2V0TGV2ZWxHcm91cEtleShsZXZlbDogYW55KSB7XHJcbiAgICByZXR1cm4gYGxldmVsJHtsZXZlbH1gO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDmoLnmja7ot6/lvoTojrflj5bmlbDmja5cclxuICAgKiBAcGFyYW0gdGFyZ2V0IHRhcmdldFxyXG4gICAqIEBwYXJhbSBwYXRoIOi3r+W+hFxyXG4gICAqL1xyXG4gIHByaXZhdGUgZ2V0VmFsdWUodGFyZ2V0OiBhbnksIHBhdGg6IHN0cmluZykge1xyXG4gICAgaWYgKHBhdGguaW5kZXhPZignLycpID09PSAtMSkge1xyXG4gICAgICByZXR1cm4gdGFyZ2V0W3BhdGhdO1xyXG4gICAgfVxyXG4gICAgY29uc3QgcGF0aHM6IGFueSA9IHBhdGguc3BsaXQoJy8nKS5maWx0ZXIocCA9PiBwKTtcclxuICAgIGlmIChwYXRocy5sZW5ndGggPCAxKSB7XHJcbiAgICAgIHJldHVybiB0YXJnZXQ7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gcGF0aHMucmVkdWNlKChyZXN1bHQsIHBhdGgpID0+IHtcclxuICAgICAgcmV0dXJuIHJlc3VsdCAmJiByZXN1bHRbcGF0aF07XHJcbiAgICB9LCB0YXJnZXQpO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDojrflj5bliIbnuqfkv6Hmga/kuK3nmoTlsYLnuqdcclxuICAgKiBAcGFyYW0gbm9kZURhdGEgbm9kZURhdGFcclxuICAgKi9cclxuICBwcml2YXRlIGdldE5vZGVMYXllcihub2RlRGF0YTogYW55KSB7XHJcbiAgICBjb25zdCBoaWVyYXJjaHlJbmZvID0gdGhpcy5nZXRIaWVyYXJjaHlJbmZvKG5vZGVEYXRhKTtcclxuICAgIHJldHVybiBoaWVyYXJjaHlJbmZvWydsYXllciddO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDojrflj5bliIbnuqfkv6Hmga/kuK3nmoTot6/lvoRcclxuICAgKiBAcGFyYW0gbm9kZURhdGEgbm9kZURhdGFcclxuICAgKi9cclxuICBwcml2YXRlIGdldE5vZGVQYXRoKG5vZGVEYXRhOiBhbnkpIHtcclxuICAgIGNvbnN0IGhpZXJhcmNoeUluZm8gPSB0aGlzLmdldEhpZXJhcmNoeUluZm8obm9kZURhdGEpO1xyXG4gICAgcmV0dXJuIGhpZXJhcmNoeUluZm9bJ3BhdGgnXTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog6I635Y+W5bGV5byA54q25oCBXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBpc0V4cGFuZGVkKG5ld0RhdGE6IGFueSk6IGJvb2xlYW4ge1xyXG4gICAgY29uc3Qgb2xkVHJlZU5vZGUgPSB0aGlzLmdldE9sZE5vZGUobmV3RGF0YSk7XHJcbiAgICByZXR1cm4gb2xkVHJlZU5vZGUgPyBvbGRUcmVlTm9kZS5leHBhbmRlZCA6IHVuZGVmaW5lZDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOaYr+WQpuaYr+WPtuWtkOiKgueCuVxyXG4gICAqIEB0b2Rv77ya5pyN5Yqh5Zmo56uv5a+5aXNEZXRhaWznmoTnm67liY3msqHmnInkuI7liY3nq6/lkIzmraXvvIxpc0RldGFpbOS4jeWHhuehruOAglxyXG4gICAqL1xyXG4gIHByaXZhdGUgaXNMZWFmKG5vZGVEYXRhOiBhbnkpOiBib29sZWFuIHtcclxuICAgIGNvbnN0IGhpZXJhcmNoeUluZm8gPSB0aGlzLmdldEhpZXJhcmNoeUluZm8obm9kZURhdGEpOy8vIG5vZGVEYXRhW3RoaXMuaGllcmFyY2h5SW5mb0tleV07XHJcbiAgICBjb25zdCBpc0RldGFpbCA9IGhpZXJhcmNoeUluZm9bJ2lzRGV0YWlsJ107XHJcbiAgICByZXR1cm4gaXNEZXRhaWw7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDliKTmlq3oioLngrnmmK/lkKbmmK/mlrDlop5cclxuICAgKiBAdG9kb++8muS4jeW6lOivpei/meagt+WIpOaWre+8jOW+heS8mOWMluOAglxyXG4gICAqIEBzdW1tYXJ5XHJcbiAgICogMeOAgemdnuepuuagke+8iOepuuagkeinhuS4uuWIneasoeWKoOi9veaVsOaNru+8ie+8m1xyXG4gICAqIDLjgIHmib7kuI3liLBvbGROb2Rl44CCXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBpc05ld05vZGUobm9kZURhdGE6IGFueSk6IGJvb2xlYW4ge1xyXG4gICAgaWYgKHRoaXMuYWxsT2xkTm9kZXNNYXAuc2l6ZSA9PT0gMCkge1xyXG4gICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcbiAgICBjb25zdCBvbGRUcmVlTm9kZSA9IHRoaXMuZ2V0T2xkTm9kZShub2RlRGF0YSk7XHJcbiAgICByZXR1cm4gb2xkVHJlZU5vZGUgPyBmYWxzZSA6IHRydWU7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDlsZXlvIDniLboioLngrlcclxuICAgKi9cclxuICBwcml2YXRlIGV4cGFuZFBhcmVudE5vZGUobm9kZURhdGE6IGFueSk6IHZvaWQge1xyXG4gICAgY29uc3QgcGFyZW50VHJlZU5vZGUgPSB0aGlzLmdldFBhcmVudE5vZGUobm9kZURhdGEpO1xyXG4gICAgaWYgKCFwYXJlbnRUcmVlTm9kZSkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBwYXJlbnRUcmVlTm9kZS5sZWFmID0gZmFsc2U7XHJcbiAgICBwYXJlbnRUcmVlTm9kZS5leHBhbmRlZCA9IHRydWU7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDmn6Xmib7niLboioLngrlcclxuICAgKi9cclxuICBwcml2YXRlIGdldFBhcmVudE5vZGUobm9kZURhdGE6IGFueSk6IFRyZWVOb2RlIHtcclxuICAgIGNvbnN0IGhpZXJhcmNoeUluZm8gPSB0aGlzLmdldEhpZXJhcmNoeUluZm8obm9kZURhdGEpOy8vbm9kZURhdGFbdGhpcy5oaWVyYXJjaHlJbmZvS2V5XTtcclxuICAgIGNvbnN0IGxheWVyID0gaGllcmFyY2h5SW5mb1snbGF5ZXInXTtcclxuICAgIGNvbnN0IHBhdGggPSBoaWVyYXJjaHlJbmZvWydwYXRoJ107XHJcblxyXG4gICAgY29uc3QgYWxsTm9kZXMgPSBBcnJheS5mcm9tKHRoaXMuYWxsTm9kZXNNYXAudmFsdWVzKCkpO1xyXG4gICAgY29uc3QgcGFyZW50Tm9kZSA9IGFsbE5vZGVzLmZpbmQoKGN1cnJlbnROb2RlOiBUcmVlTm9kZSkgPT4ge1xyXG4gICAgICBjb25zdCBjdXJyZW50TGF5ZXIgPSB0aGlzLmdldFZhbHVlKGN1cnJlbnROb2RlLmRhdGEsIHRoaXMuaGllcmFyY2h5SW5mb0tleSlbJ2xheWVyJ107Ly9jdXJyZW50Tm9kZS5kYXRhW3RoaXMuaGllcmFyY2h5SW5mb0tleV1bJ2xheWVyJ107XHJcbiAgICAgIGNvbnN0IGN1cnJlbnRQYXRoID0gdGhpcy5nZXRWYWx1ZShjdXJyZW50Tm9kZS5kYXRhLCB0aGlzLmhpZXJhcmNoeUluZm9LZXkpWydwYXRoJ107Ly8gIGN1cnJlbnROb2RlLmRhdGFbdGhpcy5oaWVyYXJjaHlJbmZvS2V5XVsncGF0aCddO1xyXG4gICAgICBpZiAoKGxheWVyID09PSBjdXJyZW50TGF5ZXIgKyAxKSAmJiBwYXRoLnN0YXJ0c1dpdGgoY3VycmVudFBhdGgpID09PSB0cnVlKSB7XHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfSk7XHJcbiAgICByZXR1cm4gcGFyZW50Tm9kZTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOiOt+WPluiAgeeahOagkeiKgueCuVxyXG4gICAqL1xyXG4gIHByaXZhdGUgZ2V0T2xkTm9kZShub2RlRGF0YTogYW55KTogVHJlZU5vZGUge1xyXG4gICAgY29uc3QgaWQgPSBub2RlRGF0YVt0aGlzLnByaW1hcnlLZXldO1xyXG4gICAgcmV0dXJuIHRoaXMuYWxsT2xkTm9kZXNNYXAuZ2V0KGlkKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOaJk+W5s1RyZWVOb2Rlc++8jOW5tuaUvuWFpeS4gOS4qk1hcOS4rVxyXG4gICAqL1xyXG4gIHByaXZhdGUgYnVpbGROb2Rlc0RhdGFNYXAodHJlZU5vZGVzOiBUcmVlTm9kZVtdKTogdm9pZCB7XHJcbiAgICB0cmVlTm9kZXMuZm9yRWFjaCgodHJlZU5vZGU6IFRyZWVOb2RlKSA9PiB7XHJcbiAgICAgIHRoaXMuYWxsT2xkTm9kZXNNYXAuc2V0KHRyZWVOb2RlLmRhdGFbdGhpcy5wcmltYXJ5S2V5XSwgdHJlZU5vZGUpO1xyXG4gICAgICBpZiAodHJlZU5vZGUuY2hpbGRyZW4pIHtcclxuICAgICAgICB0aGlzLmJ1aWxkTm9kZXNEYXRhTWFwKHRyZWVOb2RlLmNoaWxkcmVuKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvLyAjZW5kcmVnaW9uXHJcbn1cclxuXHJcbmV4cG9ydCB7IFBhdGhUcmVlTm9kZUJ1aWxkZXIgfTtcclxuIl19
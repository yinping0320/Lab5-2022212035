import { Injectable } from '@angular/core';
import { DateTimeHelperService } from '@farris/ui-common/date';
import { NumberHelperService } from '@farris/ui-common/number';
import { DateUtil } from '@farris/devkit';
class FarrisKendoGridFormatService {
    constructor(dateService, numberService) {
        this.dateService = dateService;
        this.numberService = numberService;
    }
    /**
     * 列格式化 方法
     * @param dataItem  行数据
     * @param column 列对象
     */
    getColumnFormat(dataItem, column) {
        const value = this.getValue(dataItem, column['dataField']);
        // 没有设置行编辑器
        const type = column['dataType'];
        if (type === 'enum') {
            return this.getEnumText(value, column);
        }
        else if (type === 'boolean') {
            return value ? '是' : '否';
        }
        else if (type === 'date') {
            return this.getFormatDate(value, column);
        }
        else if (type === 'number') {
            return this.getFormatNumber(value, column);
        }
        else {
            // 格式化多行文本  和string
            return this.getMultiText(value, column);
        }
    }
    /**
     * 根据id获取value
     * @param dataItem  行数据
     * @param field id,也可能是name.Name这种形式(关联对象id或者udt)
     */
    getValue(dataItem, field) {
        const index = field.indexOf('.');
        if (index < 0) {
            return dataItem[field];
        }
        const fields = field.split('.');
        // field字符串组合
        const a = fields.reduce((result, next) => {
            return result[next];
        }, dataItem);
        return a;
    }
    /**
     * 枚举值格式化
     */
    getEnumText(value, column) {
        const enumData = column.enumData;
        if (!enumData) {
            return;
        }
        let tempColumnText;
        enumData.forEach((ele) => {
            if (ele.value === value) {
                tempColumnText = ele.name;
            }
        });
        return tempColumnText;
    }
    /**
     * 日期格式化
     * @param value  单元格值
     * @param column 列对象
     */
    getFormatDate(value, column) {
        if (DateUtil.isEmptyDateString(value) === true) {
            return '';
        }
        const dateFormat = column.format;
        if (!dateFormat) {
            return value;
        }
        return this.dateService.formatTo(value, dateFormat);
    }
    /**
     * 数字格式化
     * @param value  单元格值
     * @param column 列对象
     * @todo 数字格式化还不完善  这个只是金额形式的格式化;   初始化value===null时,应该显示为'' 这个还没有
     */
    getFormatNumber(value, column) {
        let precision;
        if (column && column.format) {
            precision = parseInt(column.format.substr(1), 10);
        }
        else if (column && column.editor) {
            precision = column.editor.precision;
        }
        if (isNaN(precision)) {
            precision = 2;
        }
        if (!value && value !== 0) {
            return '';
        }
        const opts = {
            prefix: column.prefix ? column.prefix : '',
            suffix: column.suffix ? column.suffix : '',
            precision: precision,
            thousand: ',',
            stripZeros: false,
        };
        return this.numberService.formatMoney(value, opts);
    }
    /**
     * 多行文本格式化 shift+enter换行  失去焦点保留原格式
     * @param value  单元格值
     * @param column 列对象
     */
    getMultiText(value, column) {
        let strValue = value;
        if (strValue !== '' && !strValue) {
            strValue = '';
        }
        if (typeof strValue !== 'string') {
            const valueType = typeof strValue;
            throw new Error(`${valueType}类型值不合法，无法进行格式化`);
        }
        // 防止xss
        strValue = strValue.replace(/&/g, '&amp;')
            .replace(/</g, '&lt;')
            .replace(/>/g, '&gt;')
            .replace(/\"/g, '&quot;')
            .replace(/\'/g, '&#39;')
            .replace(/\//g, '&#x2F;');
        // 如果是多行文本框  保留格式
        if (column.editor && column.editor.type === 'MultiTextBox') {
            const INDEX = strValue.indexOf('\n');
            if (INDEX > -1) {
                return strValue.replace(/\n/g, '<br>');
            }
            return strValue;
        }
        // 若为string
        return strValue;
    }
}
FarrisKendoGridFormatService.decorators = [
    { type: Injectable }
];
/** @nocollapse */
FarrisKendoGridFormatService.ctorParameters = () => [
    { type: DateTimeHelperService },
    { type: NumberHelperService }
];
export { FarrisKendoGridFormatService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0YXRhYmxlLWtlbmRvZ3JpZC1mb3JtYXQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL2tlbmRvLWJpbmRpbmcvIiwic291cmNlcyI6WyJsaWIvZm9ybWF0L2RhdGF0YWJsZS1rZW5kb2dyaWQtZm9ybWF0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDM0MsT0FBTyxFQUFFLHFCQUFxQixFQUFFLE1BQU0sd0JBQXdCLENBQUM7QUFDL0QsT0FBTyxFQUFFLG1CQUFtQixFQUFFLE1BQU0sMEJBQTBCLENBQUM7QUFDL0QsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBRTFDLE1BQ00sNEJBQTRCO0lBQzlCLFlBQW9CLFdBQWtDLEVBQVUsYUFBa0M7UUFBOUUsZ0JBQVcsR0FBWCxXQUFXLENBQXVCO1FBQVUsa0JBQWEsR0FBYixhQUFhLENBQXFCO0lBQ2xHLENBQUM7SUFFRDs7OztPQUlHO0lBQ0gsZUFBZSxDQUFDLFFBQWEsRUFBRSxNQUFXO1FBQ3RDLE1BQU0sS0FBSyxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsUUFBUSxFQUFFLE1BQU0sQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDO1FBQzNELFdBQVc7UUFDWCxNQUFNLElBQUksR0FBRyxNQUFNLENBQUMsVUFBVSxDQUFDLENBQUM7UUFDaEMsSUFBSSxJQUFJLEtBQUssTUFBTSxFQUFFO1lBQ2pCLE9BQU8sSUFBSSxDQUFDLFdBQVcsQ0FBQyxLQUFLLEVBQUUsTUFBTSxDQUFDLENBQUM7U0FDMUM7YUFBTSxJQUFJLElBQUksS0FBSyxTQUFTLEVBQUU7WUFDM0IsT0FBTyxLQUFLLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDO1NBQzVCO2FBQU0sSUFBSSxJQUFJLEtBQUssTUFBTSxFQUFFO1lBQ3hCLE9BQU8sSUFBSSxDQUFDLGFBQWEsQ0FBQyxLQUFLLEVBQUUs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TyxRQUFRLENBQUMsT0FBTyxDQUFDLEtBQUssRUFBRSxNQUFNLENBQUMsQ0FBQzthQUMxQztZQUNELE9BQU8sUUFBUSxDQUFDO1NBQ25CO1FBQ0QsV0FBVztRQUNYLE9BQU8sUUFBUSxDQUFDO0lBQ3BCLENBQUM7OztZQTlJSixVQUFVOzs7O1lBSkYscUJBQXFCO1lBQ3JCLG1CQUFtQjs7QUFtSjVCLE9BQU8sRUFBRSw0QkFBNEIsRUFBRSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBEYXRlVGltZUhlbHBlclNlcnZpY2UgfSBmcm9tICdAZmFycmlzL3VpLWNvbW1vbi9kYXRlJztcclxuaW1wb3J0IHsgTnVtYmVySGVscGVyU2VydmljZSB9IGZyb20gJ0BmYXJyaXMvdWktY29tbW9uL251bWJlcic7XHJcbmltcG9ydCB7IERhdGVVdGlsIH0gZnJvbSAnQGZhcnJpcy9kZXZraXQnO1xyXG5cclxuQEluamVjdGFibGUoKVxyXG5jbGFzcyBGYXJyaXNLZW5kb0dyaWRGb3JtYXRTZXJ2aWNlIHtcclxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgZGF0ZVNlcnZpY2U6IERhdGVUaW1lSGVscGVyU2VydmljZSwgcHJpdmF0ZSBudW1iZXJTZXJ2aWNlOiBOdW1iZXJIZWxwZXJTZXJ2aWNlKSB7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDliJfmoLzlvI/ljJYg5pa55rOVXHJcbiAgICAgKiBAcGFyYW0gZGF0YUl0ZW0gIOihjOaVsOaNrlxyXG4gICAgICogQHBhcmFtIGNvbHVtbiDliJflr7nosaFcclxuICAgICAqL1xyXG4gICAgZ2V0Q29sdW1uRm9ybWF0KGRhdGFJdGVtOiBhbnksIGNvbHVtbjogYW55KSB7XHJcbiAgICAgICAgY29uc3QgdmFsdWUgPSB0aGlzLmdldFZhbHVlKGRhdGFJdGVtLCBjb2x1bW5bJ2RhdGFGaWVsZCddKTtcclxuICAgICAgICAvLyDmsqHmnInorr7nva7ooYznvJbovpHlmahcclxuICAgICAgICBjb25zdCB0eXBlID0gY29sdW1uWydkYXRhVHlwZSddO1xyXG4gICAgICAgIGlmICh0eXBlID09PSAnZW51bScpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0RW51bVRleHQodmFsdWUsIGNvbHVtbik7XHJcbiAgICAgICAgfSBlbHNlIGlmICh0eXBlID09PSAnYm9vbGVhbicpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHZhbHVlID8gJ+aYrycgOiAn5ZCmJztcclxuICAgICAgICB9IGVsc2UgaWYgKHR5cGUgPT09ICdkYXRlJykge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5nZXRGb3JtYXREYXRlKHZhbHVlLCBjb2x1bW4pO1xyXG4gICAgICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gJ251bWJlcicpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0Rm9ybWF0TnVtYmVyKHZhbHVlLCBjb2x1bW4pO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIC8vIOagvOW8j+WMluWkmuihjOaWh+acrCAg5ZKMc3RyaW5nXHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmdldE11bHRpVGV4dCh2YWx1ZSwgY29sdW1uKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDmoLnmja5pZOiOt+WPlnZhbHVlXHJcbiAgICAgKiBAcGFyYW0gZGF0YUl0ZW0gIOihjOaVsOaNrlxyXG4gICAgICogQHBhcmFtIGZpZWxkIGlkLOS5n+WPr+iDveaYr25hbWUuTmFtZei/meenjeW9ouW8jyjlhbPogZTlr7nosaFpZOaIluiAhXVkdClcclxuICAgICAqL1xyXG4gICAgcHJpdmF0ZSBnZXRWYWx1ZShkYXRhSXRlbTogYW55LCBmaWVsZDogc3RyaW5nKSB7XHJcbiAgICAgICAgY29uc3QgaW5kZXggPSBmaWVsZC5pbmRleE9mKCcuJyk7XHJcbiAgICAgICAgaWYgKGluZGV4IDwgMCkge1xyXG4gICAgICAgICAgICByZXR1cm4gZGF0YUl0ZW1bZmllbGRdO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCBmaWVsZHMgPSBmaWVsZC5zcGxpdCgnLicpO1xyXG4gICAgICAgIC8vIGZpZWxk5a2X56ym5Liy57uE5ZCIXHJcbiAgICAgICAgY29uc3QgYSA9IGZpZWxkcy5yZWR1Y2UoKHJlc3VsdDogYW55LCBuZXh0OiBhbnkpID0+IHtcclxuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdFtuZXh0XTtcclxuICAgICAgICB9LCBkYXRhSXRlbSk7XHJcbiAgICAgICAgcmV0dXJuIGE7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDmnprkuL7lgLzmoLzlvI/ljJZcclxuICAgICAqL1xyXG4gICAgcHJpdmF0ZSBnZXRFbnVtVGV4dCh2YWx1ZTogYW55LCBjb2x1bW46IGFueSkge1xyXG4gICAgICAgIGNvbnN0IGVudW1EYXRhID0gKGNvbHVtbiBhcyBhbnkpLmVudW1EYXRhO1xyXG4gICAgICAgIGlmICghZW51bURhdGEpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBsZXQgdGVtcENvbHVtblRleHQ6IGFueTtcclxuICAgICAgICBlbnVtRGF0YS5mb3JFYWNoKChlbGU6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICBpZiAoZWxlLnZhbHVlID09PSB2YWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgdGVtcENvbHVtblRleHQgPSBlbGUubmFtZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHJldHVybiB0ZW1wQ29sdW1uVGV4dDtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOaXpeacn+agvOW8j+WMllxyXG4gICAgICogQHBhcmFtIHZhbHVlICDljZXlhYPmoLzlgLxcclxuICAgICAqIEBwYXJhbSBjb2x1bW4g5YiX5a+56LGhXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBnZXRGb3JtYXREYXRlKHZhbHVlOiBzdHJpbmcsIGNvbHVtbjogYW55KTogc3RyaW5nIHtcclxuXHJcbiAgICAgICAgaWYgKERhdGVVdGlsLmlzRW1wdHlEYXRlU3RyaW5nKHZhbHVlKSA9PT0gdHJ1ZSkge1xyXG4gICAgICAgICAgcmV0dXJuICcnO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgZGF0ZUZvcm1hdCA9IChjb2x1bW4gYXMgYW55KS5mb3JtYXQ7XHJcbiAgICAgICAgaWYgKCFkYXRlRm9ybWF0KSB7XHJcbiAgICAgICAgICAgIHJldHVybiB2YWx1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZGF0ZVNlcnZpY2UuZm9ybWF0VG8odmFsdWUsIGRhdGVGb3JtYXQpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5pWw5a2X5qC85byP5YyWXHJcbiAgICAgKiBAcGFyYW0gdmFsdWUgIOWNleWFg+agvOWAvFxyXG4gICAgICogQHBhcmFtIGNvbHVtbiDliJflr7nosaFcclxuICAgICAqIEB0b2RvIOaVsOWtl+agvOW8j+WMlui/mOS4jeWujOWWhCAg6L+Z5Liq5Y+q5piv6YeR6aKd5b2i5byP55qE5qC85byP5YyWOyAgIOWIneWni+WMlnZhbHVlPT09bnVsbOaXtizlupTor6XmmL7npLrkuLonJyDov5nkuKrov5jmsqHmnIlcclxuICAgICAqL1xyXG4gICAgcHJpdmF0ZSBnZXRGb3JtYXROdW1iZXIodmFsdWU6IGFueSwgY29sdW1uOiBhbnkpIHtcclxuICAgICAgICBsZXQgcHJlY2lzaW9uO1xyXG4gICAgICAgIGlmIChjb2x1bW4gJiYgY29sdW1uLmZvcm1hdCkge1xyXG4gICAgICAgICAgICBwcmVjaXNpb24gPSBwYXJzZUludChjb2x1bW4uZm9ybWF0LnN1YnN0cigxKSwgMTApO1xyXG4gICAgICAgIH0gZWxzZSBpZiAoY29sdW1uICYmIGNvbHVtbi5lZGl0b3IpIHtcclxuICAgICAgICAgICAgcHJlY2lzaW9uID0gY29sdW1uLmVkaXRvci5wcmVjaXNpb247XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChpc05hTihwcmVjaXNpb24pKSB7XHJcbiAgICAgICAgICAgIHByZWNpc2lvbiA9IDI7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICghdmFsdWUgJiYgdmFsdWUgIT09IDApIHtcclxuICAgICAgICAgICAgcmV0dXJuICcnO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3Qgb3B0cyA9IHtcclxuICAgICAgICAgICAgcHJlZml4OiBjb2x1bW4ucHJlZml4ID8gY29sdW1uLnByZWZpeCA6ICcnLFxyXG4gICAgICAgICAgICBzdWZmaXg6IGNvbHVtbi5zdWZmaXggPyBjb2x1bW4uc3VmZml4IDogJycsXHJcbiAgICAgICAgICAgIHByZWNpc2lvbjogcHJlY2lzaW9uLFxyXG4gICAgICAgICAgICB0aG91c2FuZDogJywnLFxyXG4gICAgICAgICAgICBzdHJpcFplcm9zOiBmYWxzZSxcclxuICAgICAgICB9O1xyXG4gICAgICAgIHJldHVybiB0aGlzLm51bWJlclNlcnZpY2UuZm9ybWF0TW9uZXkodmFsdWUsIG9wdHMpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5aSa6KGM5paH5pys5qC85byP5YyWIHNoaWZ0K2VudGVy5o2i6KGMICDlpLHljrvnhKbngrnkv53nlZnljp/moLzlvI9cclxuICAgICAqIEBwYXJhbSB2YWx1ZSAg5Y2V5YWD5qC85YC8XHJcbiAgICAgKiBAcGFyYW0gY29sdW1uIOWIl+WvueixoVxyXG4gICAgICovXHJcbiAgICBwcml2YXRlIGdldE11bHRpVGV4dCh2YWx1ZTogYW55LCBjb2x1bW46IGFueSkge1xyXG4gICAgICAgIGxldCBzdHJWYWx1ZSA9IHZhbHVlO1xyXG4gICAgICAgIGlmIChzdHJWYWx1ZSAhPT0gJycgJiYgIXN0clZhbHVlKSB7XHJcbiAgICAgICAgICAgIHN0clZhbHVlID0gJyc7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0eXBlb2Ygc3RyVmFsdWUgIT09ICdzdHJpbmcnKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHZhbHVlVHlwZSA9IHR5cGVvZiBzdHJWYWx1ZTtcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGAke3ZhbHVlVHlwZX3nsbvlnovlgLzkuI3lkIjms5XvvIzml6Dms5Xov5vooYzmoLzlvI/ljJZgKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8g6Ziy5q2ieHNzXHJcbiAgICAgICAgc3RyVmFsdWUgPSBzdHJWYWx1ZS5yZXBsYWNlKC8mL2csICcmYW1wOycpXHJcbiAgICAgICAgICAgIC5yZXBsYWNlKC88L2csICcmbHQ7JylcclxuICAgICAgICAgICAgLnJlcGxhY2UoLz4vZywgJyZndDsnKVxyXG4gICAgICAgICAgICAucmVwbGFjZSgvXFxcIi9nLCAnJnF1b3Q7JylcclxuICAgICAgICAgICAgLnJlcGxhY2UoL1xcJy9nLCAnJiMzOTsnKVxyXG4gICAgICAgICAgICAucmVwbGFjZSgvXFwvL2csICcmI3gyRjsnKTtcclxuICAgICAgICAvLyDlpoLmnpzmmK/lpJrooYzmlofmnKzmoYYgIOS/neeVmeagvOW8j1xyXG4gICAgICAgIGlmIChjb2x1bW4uZWRpdG9yICYmIGNvbHVtbi5lZGl0b3IudHlwZSA9PT0gJ011bHRpVGV4dEJveCcpIHtcclxuICAgICAgICAgICAgY29uc3QgSU5ERVggPSBzdHJWYWx1ZS5pbmRleE9mKCdcXG4nKTtcclxuICAgICAgICAgICAgaWYgKElOREVYID4gLTEpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBzdHJWYWx1ZS5yZXBsYWNlKC9cXG4vZywgJzxicj4nKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gc3RyVmFsdWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIOiLpeS4unN0cmluZ1xyXG4gICAgICAgIHJldHVybiBzdHJWYWx1ZTtcclxuICAgIH1cclxufVxyXG5leHBvcnQgeyBGYXJyaXNLZW5kb0dyaWRGb3JtYXRTZXJ2aWNlIH07XHJcbiJdfQ==
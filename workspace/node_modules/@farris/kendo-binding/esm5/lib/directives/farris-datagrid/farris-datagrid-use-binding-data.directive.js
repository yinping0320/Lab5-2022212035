import { Directive, HostListener, EventEmitter, Output } from '@angular/core';
import { Subject } from 'rxjs';
import { BindingData, ChangeType, ViewModel, DataTypeInfo, EntityPathConverter, RunMode, ComponentType, ExpressionUtil, ENABLE_EDIT_STATE_FILTER_SORTING } from '@farris/devkit';
import { DatagridComponent } from '@farris/ui-datagrid';
import { debounceTime, finalize } from 'rxjs/operators';
// tslint:disable: max-line-length
/*
 * 使用绑定数据指令
 */
var FarrisDatagridUseBindingDataDirective = /** @class */ (function () {
    // private renderGridDebounce;
    function FarrisDatagridUseBindingDataDirective(bindingData, viewModel, grid) {
        this.bindingData = bindingData;
        this.viewModel = viewModel;
        this.grid = grid;
        // 排序字段
        this.sortFields = null;
        // 排序方向
        this.sortDirections = null;
        /**
         * 是否已排序
         */
        this.hasSorted = false;
        /**
         * 过滤条件
         */
        this.filters = null;
        /**
         * 渲染grid
         */
        this.renderGridSubject = new Subject();
        this.enableFilterSorting = false;
        /**
         * 选中行切换事件
         */
        this.selectedRowChange = new EventEmitter();
        this.setChecks([]);
        this.enableFilterSorting = this.viewModel && this.viewModel.frameContext && this.viewModel.frameContext.injector.get(ENABLE_EDIT_STATE_FILTER_SORTING, false) || false;
        this.registerEvent();
    }
    Object.defineProperty(FarrisDatagridUseBindingDataDirective.prototype, "props", {
        get: function () {
            return this._PROPS;
        },
        set: function (value) {
            this._PROPS = value;
        },
        enumerable: true,
        configurable: true
    });
    // #region Ng Event
    FarrisDatagridUseBindingDataDirective.prototype.ngOnInit = function () {
        var _this = this;
        var _a = (this.getPagingInfo() || {}).pageSize, pageSize = _a === void 0 ? 0 : _a;
        if (pageSize !== 0) {
            // 启用分页
            if ((!this.grid.pageList || this.grid.pageList.length < 1) && typeof this.grid['setPageList'] === 'function') {
                this.grid['setPageList']([pageSize, pageSize * 2, pageSize * 3, pageSize * 4]);
            }
        }
        this.setComponentRef();
        this.bindData();
        window.setTimeout(function () {
            _this.updateSelectedRow();
        }, 0);
        this.registerBindingDataChangeEvent();
        this.renderGridSubject.pipe(debounceTime(500)).subscribe(function (change) {
            if (!_this.viewModel || !_this.viewModel.frameContext || _this.viewModel.frameContext.isDisposed) {
                return;
            }
            _this.bindData(change);
            /*if (!this.renderGridDebounce) {
              this.renderGridDebounce = this.debounce((change) => {
                this.bindData(change);
              }, 500);
            }
            this.renderGridDebounce(change);*/
        });
        if (this.viewModel && this.viewModel.frameContext && this.viewModel.frameContext.frameComponent) {
            this.viewModel.frameContext.frameComponent.componentType = ComponentType.farrisDataGridComponent;
        }
    };
    FarrisDatagridUseBindingDataDirective.prototype.ngOnChanges = function (changes) {
        this.bindData();
    };
    Object.defineProperty(FarrisDatagridUseBindingDataDirective.prototype, "primaryKey", {
        // #endregion
        /**
         * 主键
         */
        get: function () {
            return this.bindingList.primaryKey;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(FarrisDatagridUseBindingDataDirective.prototype, "bindingList", {
        /**
         * 获取绑定数据
         */
        get: function () {
            // 根实体
            if (this.viewModel.bindingPath === '/' || !this.viewModel.bindingPath) {
                return this.bindingData.list;
            }
            // 子实体
            var bindingPath = this.viewModel.bindingPath.substr(1);
            bindingPath = bindingPath[0].toLowerCase() + bindingPath.substring(1, bindingPath.length);
            var paths = bindingPath.split('/');
            var filteredPaths = paths.filter(function (part) {
                return part !== '';
            });
            return this.bindingData.getValue(filteredPaths);
        },
        enumerable: true,
        configurable: true
    });
    /**
     * 设置组件引用
     */
    FarrisDatagridUseBindingDataDirective.prototype.setComponentRef = function () {
        var appContext = this.viewModel && this.viewModel.frameContext && this.viewModel.frameContext.getFormAppContext();
        var frameId = this.viewModel && this.viewModel.frameContext && this.viewModel.frameContext.frameId;
        var id = this.grid && this.grid.id;
        // 如果frameId不存在或farris grid没有id属性，说明不符合使用场景
        if (!frameId || !id) {
            return;
        }
        var map = appContext && appContext.componentRefs && appContext.componentRefs.get(frameId) || new Map();
        appContext && appContext.componentRefs && appContext.componentRefs.set(frameId, map.set(id, this.grid));
    };
    /**
     * 获取分页信息
     */
    FarrisDatagridUseBindingDataDirective.prototype.getPagingInfo = function () {
        var bindingPath = this.viewModel.bindingPath;
        var bindingData = this.viewModel.bindingData;
        var pagingInfo = bindingData && bindingData.pagingInfo || {};
        if (bindingPath === '/') {
            return pagingInfo;
        }
        else {
            var bindingPaths = bindingPath.substr(1).split('/').filter(function (item) { return !!item && item.length > 0; });
            // 从表及从从表分页和数据是关联的，因为不同的从表行有不同的从从表数据，分页信息的结构为nodeCode_parentId:{分页信息}且分页信息是平级的
            // {pagination:{a_pid:{pageSize:2,pageIndex:1},b_pid:{pageSize:2,pageIndex:1}}}
            // 取出当前路径下实体的nodeCode
            var nodeCode = bindingPaths[bindingPaths.length - 1];
            nodeCode = nodeCode.substr(0, nodeCode.length - 1);
            // 获取当前实体上级的主键
            // const result = pagingInfo[nodeCode] || {};
            // if (result.hasOwnProperty('totalCount')) {
            //   result.total = result.totalCount;
            // }
            // return result;
            var paths = bindingPaths.slice(0, bindingPaths.length - 1);
            var bindingList = bindingData.getValue(paths);
            var _a = (pagingInfo["" + nodeCode] || {}).pageSize, pageSize = _a === void 0 ? 0 : _a;
            // 上级表有数据
            if (bindingList && bindingList.currentId) {
                var key = nodeCode + "_" + bindingList.currentId;
                // const key = nodeCode;
                var result = pagingInfo[key] || {};
                if (result.hasOwnProperty('totalCount')) {
                    result.total = result.totalCount;
                }
                // 上级表虽然有数据，但上级表当前行的下级表可能没有数据，这就导致获取不到分页信息，所以需要在返回前对结果进行处理，如果没有分页信息的话起码应该返回分页大小及当前页码
                if (Object.keys(result).length < 1) {
                    result.pageIndex = 1;
                    result.pageSize = pageSize;
                }
                return result;
            }
            else {
                // 上级表没有数据，此时需要获取当前表的分页信息，如分页大小。当前页默认为1即可。
                return { pageIndex: 1, pageSize: pageSize };
            }
        }
    };
    // #region Input
    /**
     * 组件是否需要更新
     * @param props 当前属性
     * @param nextProps 新属性
     * @param change 变更
     */
    FarrisDatagridUseBindingDataDirective.prototype.shouldComponentUpdate = function (change, data) {
        var props = this.buildProps(data);
        if (this.viewModel && this.viewModel.frameContext && this.viewModel.frameContext.appContext && this.viewModel.frameContext.appContext.runMode === RunMode.highSpeed && change) {
            if (change.type === ChangeType.Load || change.type === ChangeType.Remove || change.type === ChangeType.PaginationInfoChange) {
                return { result: true, props: props };
            }
        }
        var gridProps = this.buildGridProps();
        if (JSON.stringify(props) === JSON.stringify(gridProps)) {
            return { result: false };
        }
        return { result: true, props: props };
    };
    FarrisDatagridUseBindingDataDirective.prototype.registerEvent = function () {
        var _this = this;
        // 排序事件
        this.grid && this.grid.columnSorted && this.grid.columnSorted.subscribe(function (event) {
            var isRemoteSort = _this.grid.remoteSort;
            // 本地排序
            if (!isRemoteSort) {
                _this.sortFields = _this.grid.sortName;
                _this.sortDirections = _this.grid.sortOrder;
                _this.sortBindingList();
                // this.props = this.buildProps();
            }
            else {
                // 服务器端排序
                var groupField = _this.grid && _this.grid.groupField || null;
                var sortFields = _this.grid.sortName && _this.grid.sortName.split(',') || [];
                var sortDirection = _this.grid.sortOrder && _this.grid.sortOrder.split(',') || [];
                if (groupField) {
                    if (!sortFields.includes(groupField)) {
                        sortFields.splice(0, 0, groupField);
                        sortDirection.splice(0, 0, 'asc');
                    }
                }
                // 获取当前entity上所有object属性
                var entityType = _this.viewModel && _this.viewModel.frameContext.repository.entityType || null;
                if (sortFields.length > 0) {
                    if (entityType) {
                        var dataTypeInfo_1 = new DataTypeInfo(entityType);
                        sortFields = sortFields.map(function (field) {
                            //if (field && field.indexOf('.') !== -1) {
                            var paths = field.split('.');
                            var propInfo = dataTypeInfo_1.getPropInfoByPath(paths);
                            var originalField = propInfo && propInfo.metadataInfo['path'] || null;
                            return originalField;
                            //}
                            //return field;
                        });
                    }
                }
                // 遍历属性，根据datafield转换为originalDataField
                var fields = sortFields.join(',');
                var directions = sortDirection.join(',') || 'asc';
                var frameContext = _this.viewModel && _this.viewModel.frameContext || null;
                if (frameContext) {
                    frameContext.repository.sortConditionManager.setConditions(_this.viewModel.bindingPath, fields, directions);
                }
            }
        });
        // 过滤事件
        this.grid && this.grid.filterChanged && this.grid.filterChanged.subscribe(function (event) {
            _this.filters = event;
            if (!_this.grid.remoteFilter) {
                if (_this.bindingList.length > 0 && !_this.bindingList.currentId) {
                    var id = _this.bindingList.getIdByIndex(0);
                    _this.bindingList.setCurrentId(id);
                }
                _this.bindingList.filter(_this.filters);
                _this.bindData();
            }
        });
        this.viewModel.frameContext.appContext.messagePipe.subscribe(function (message) {
            if (message && message === 'CLEAR_GRID_CONDITION' && _this.filters && Object.keys(_this.filters).length > 0) {
                _this.filters = {};
                _this.bindData();
            }
        });
    };
    /**
     * 对bindingList排序
     * @param change change
     */
    FarrisDatagridUseBindingDataDirective.prototype.sortBindingList = function (change) {
        var _this = this;
        // groupField可能有多个，以逗号分隔的字符串
        var groupField = this.grid && this.grid.groupField || null;
        if (groupField) {
            var arrSortFields_1 = this.sortFields && this.sortFields.split(',') || [];
            var groupFields = groupField.split(',').reverse();
            groupFields.forEach(function (field) {
                if (!arrSortFields_1.includes(field)) {
                    arrSortFields_1.splice(0, 0, field);
                    var arrSortDirection = _this.sortDirections && _this.sortDirections.split(',') || [];
                    arrSortDirection.splice(0, 0, 'asc');
                    _this.sortFields = arrSortFields_1.join(',');
                    _this.sortDirections = arrSortDirection.join(',') || 'asc';
                }
            });
        }
        this.bindingList.sortBy(this.sortFields, this.sortDirections);
        this.bindData(change);
    };
    // #endregion
    // #region 数据绑定部分
    /**
     * 更新数据
     * @param change? 变更
     */
    FarrisDatagridUseBindingDataDirective.prototype.bindData = function (change) {
        var _this = this;
        var isRemoteFilter = this.grid && this.grid.remoteFilter || false;
        // 先执行排序
        var shouldSort = this.shouldSort(change);
        if (shouldSort) {
            this.hasSorted = true;
            this.sortBindingList(change);
            return;
        }
        this.hasSorted = false;
        // 新增数据时清空表格筛选条件
        if ((this.grid.editable === true || change && change.type === ChangeType.Append) && this.filters && Object.keys(this.filters).length > 0 && !isRemoteFilter) {
            if (!this.viewModel.frameContext.appContext.enableGridHeaderWhenEditing && !this.enableFilterSorting) {
                this.filters = {};
                this.grid.clearCondition();
            }
        }
        var shouldFiltering = this.shouldFiltering(change);
        if (shouldFiltering) {
            this.bindingList.filter(this.filters);
        }
        // 再toJSON
        var data = this.bindingList.toJSON();
        // if (this.filters && Object.keys(this.filters).length > 0 && !isRemoteFilter) {
        //   // data = this.grid.clientFilterService.executeFilter(data, this.filters);
        // }
        if (this.filters && Object.keys(this.filters).length > 0 && !isRemoteFilter && (!change || change && change.type !== ChangeType.SelectionChanged && change.type !== ChangeType.GlobalSelectionChanged)) {
            if (data && data.length > 0) {
                // 判断当前行是否在过滤后的数据中
                var row = data.find(function (item) { return item[_this.bindingList.primaryKey] === _this.bindingList.currentId; });
                if (!row) {
                    var firstRowId = data[0][this.bindingList.primaryKey];
                    this.bindingList.setCurrentId(firstRowId, true, true);
                }
            }
            else {
                // 本地过滤完之后没有数据了
                // this.bindingList.currentId = null;
                if (this.bindingList.currentId) {
                    this.bindingList.setCurrentId(null, true, true, true);
                }
                // 单选时清空ids
                if (!this.grid.multiSelect) {
                    this.setChecks([]);
                }
            }
        }
        var result = this.shouldComponentUpdate(change, data);
        if (!result.result) {
            return;
        }
        // const nextProps = this.buildProps(result);
        this.renderGrid(result.props);
        this.props = JSON.parse(JSON.stringify(result.props));
    };
    /**
     * 是否应该过滤
     * @param change - change
     * @returns {boolean}
     */
    FarrisDatagridUseBindingDataDirective.prototype.shouldFiltering = function (change) {
        var isRemoteFilter = this.grid && this.grid.remoteFilter || false;
        // 启用远端过滤时不需要本地过滤
        if (isRemoteFilter === true) {
            return false;
        }
        // 没有过滤条件时不需要执行过滤
        if (!this.filters || Object.keys(this.filters).length < 1) {
            return false;
        }
        if (change) {
            return change.type === ChangeType.Load;
        }
        return !this.grid.editable;
    };
    FarrisDatagridUseBindingDataDirective.prototype.shouldSort = function (change) {
        // this.sortFields && !this.grid.editable && change && (change.type === 'Load' || change.type === 'SelectionChanged')
        if (!this.sortFields || Object.keys(this.sortFields).length < 1) {
            return false;
        }
        if (this.hasSorted) {
            return false;
        }
        if (change) {
            return change.type === 'Load' || change.type === 'SelectionChanged';
        }
        return this.grid.editable;
    };
    /**
     * 渲染grid
     * @param props 属性
     */
    FarrisDatagridUseBindingDataDirective.prototype.renderGrid = function (props) {
        var pageIndex = props.pageIndex, pageSize = props.pageSize, total = props.total, pagination = props.pagination, data = props.data;
        var virtualizedLoad = this.grid.virtualizedAsyncLoad || false;
        this.grid.total = total;
        this.grid.pageSize = pageSize;
        this.grid.pageIndex = pageIndex;
        this.grid.pagination = pagination;
        this.grid.controlPaginationState = false;
        // this.endCellEdit();
        if (pageSize === 0) {
            this.grid.pagination = false;
            this.grid.pageIndex = 1;
            // 修复不分页时grid启用分组仍会重新邦数的问题
            // this.grid.pageSize = total;
        }
        if (virtualizedLoad) {
            this.grid.loadVirtualData({
                items: data,
                pageIndex: pageIndex,
                pageSize: pageSize,
                total: total
            });
        }
        else {
            this.grid.loadData(data);
        }
    };
    /**
     * 构造表格数据属性
     */
    FarrisDatagridUseBindingDataDirective.prototype.buildProps = function (datas) {
        var data;
        if (typeof (datas) !== 'undefined') {
            data = datas;
        }
        else {
            data = this.bindingList.toJSON();
        }
        // let skip = 0;
        var _a = this.getPagingInfo() || {}, _b = _a.pageIndex, pageIndex = _b === void 0 ? 1 : _b, _c = _a.pageSize, pageSize = _c === void 0 ? 0 : _c;
        var _d = (this.getPagingInfo() || {}).total, total = _d === void 0 ? 0 : _d;
        // if (pageIndex > 0) {
        //   skip = (pageIndex - 1) * pageSize;
        // }
        if (pageSize === 0 && total === 0) {
            total = data.length;
        }
        return { data: data, pageIndex: pageIndex, pageSize: pageSize, total: total, pagination: pageSize !== 0 };
    };
    /**
     * 计算grid状态
     */
    FarrisDatagridUseBindingDataDirective.prototype.buildGridProps = function () {
        var data = this.grid.data || [];
        var skip = 0;
        var _a = { pageIndex: this.grid.pageIndex, pageSize: this.grid.pageSize }, _b = _a.pageIndex, pageIndex = _b === void 0 ? 1 : _b, _c = _a.pageSize, pageSize = _c === void 0 ? 0 : _c;
        var total = this.grid.total || 0;
        if (pageIndex > 0) {
            skip = (pageIndex - 1) * pageSize;
        }
        if (pageSize === 0 && total === 0) {
            total = data.length;
        }
        return { data: data, pageIndex: pageIndex, pageSize: pageSize, total: total, pagination: this.grid.pagination };
    };
    /**
     * 数据源发生变更
     * @param change 变更
     */
    FarrisDatagridUseBindingDataDirective.prototype.onBindingDataChange = function (change) {
        this.updateDataSource(change);
        this.updateSelectedRow(change);
        // this.updateGrid(change);
        // 不清除勾选行，需要保留勾选状态
        // this.clearCheckedRows(change);
        this.endCellEdit(change);
        // 更新勾选行数据
        this.updateCheckedRows(change);
        this.updateData(change);
    };
    /**
     * 更新数据
     */
    FarrisDatagridUseBindingDataDirective.prototype.updateDataSource = function (change) {
        var _a;
        if (change && change.type === ChangeType.ValueChanged) {
            // 计算变更路径中表名及字段名
            var paths = change.path;
            try {
                var entityPath = ExpressionUtil.getAvailableChildrenPathsFromEntityPaths(paths, this.viewModel.frameContext.repository.entityTypeInfo);
                if (this.viewModel.bindingPath === '/' + entityPath.join('/')) {
                    var propertyNames = paths.slice(entityPath.length);
                    if (change.id && this.grid && change.path && this.viewModel.frameContext.appContext.runMode !== RunMode.highSpeed && propertyNames && propertyNames.length > 0) {
                        this.grid.updateRow(change.id, (_a = {}, _a[propertyNames.join('.')] = change.value, _a));
                    }
                }
            }
            catch (error) {
                console.warn(error);
            }
            this.renderGridSubject.next(change);
        }
        else if (change && (change.type === ChangeType.SelectionChanged || change.type === ChangeType.GlobalSelectionChanged)) {
            if (this.bindingList.currentId === (this.grid.selectedRow && this.grid.selectedRow.id) && this.grid.total > 0) {
            }
            else {
                this.bindData(change);
            }
        }
        else {
            this.bindData(change);
        }
    };
    // private endCellEdit() {
    //   const isEditing = this.grid.isEditing();
    //   if (isEditing) {
    //     this.grid.endCellEdit();
    //   }
    // }
    FarrisDatagridUseBindingDataDirective.prototype.endCellEdit = function (change) {
        var isEditing = this.grid.isEditing();
        if (change.type === ChangeType.Load && isEditing) {
            this.grid.endCellEdit();
        }
    };
    /**
     * 设置grid当前选择行
     * @param change 变更
     */
    FarrisDatagridUseBindingDataDirective.prototype.updateSelectedRow = function (change) {
        if (!this.bindingList || !this.bindingList.currentId) {
            return;
        }
        // 页码切换时不执行当前行切换
        if (change && change.type === ChangeType.PaginationInfoChange) {
            return;
        }
        if (this.viewModel && this.viewModel.frameContext.bindingData.rowSelectedEventSuspend === true) {
            return;
        }
        var _a = (this.grid.selectedRow || {}).id, gridSelectedRowId = _a === void 0 ? null : _a;
        var currentId = this.bindingList.currentId;
        // grid当前行与bingingList当前行一致，无须切换
        if (gridSelectedRowId === currentId) {
            var isMatch = change && (change.path.toString() === this.viewModel.bindingPath.split('/').filter(function (p) { return p; }).toString());
            if (change && change.type === ChangeType.Load && isMatch) {
                this.grid.clearSelections();
                this.grid.selectRow(currentId, true, true);
            }
            return;
        }
        this.selectGridRow(this.bindingList.currentId);
    };
    /**
     * 注册bindingdata变化事件
     */
    FarrisDatagridUseBindingDataDirective.prototype.registerBindingDataChangeEvent = function () {
        var _this = this;
        this.bindingDataChangeEvent = this.bindingData.changes.subscribe(function (change) {
            _this.onBindingDataChange(change);
        });
        this.viewModel.frameContext.appContext.messagePipe.subscribe(function (message) {
            if (message === 'bindData') {
                _this.bindData();
            }
        });
    };
    /**
     * 取消bindingdata变化订阅
     */
    FarrisDatagridUseBindingDataDirective.prototype.unRegisterBindingDataChangeEvent = function () {
        if (this.bindingDataChangeEvent && typeof (this.bindingDataChangeEvent.unsubscribe) === 'function') {
            this.bindingDataChangeEvent.unsubscribe();
        }
    };
    /**
     * 触发页码切换事件
     * @description 本方法适用场景仅为父级grid数据重新load，需要触发该grid重新取数使用。其他场景请勿使用
     * @TODO: 待重构，控制下级数据加载应该依赖表格的行切换事件，临时这样处理，后续提供LoadChildren事件
     */
    FarrisDatagridUseBindingDataDirective.prototype.updateData = function (change) {
        var _this = this;
        if (!(change && (change.type === ChangeType.SelectionChanged || change.type === ChangeType.Load))) {
            return;
        }
        var bindingPath = this.viewModel.bindingPath;
        var eventBindingPath = '/' + change.path.join('/');
        var isRetrieve = this.viewModel.frameContext.appContext.params.get('retrieveing') || false;
        if (change.path.length < 1 || bindingPath === '/' || bindingPath === eventBindingPath || !bindingPath.startsWith(eventBindingPath)) {
            return;
        }
        // retrieve时会自动带回从表第一页及从表第一行的从从表数据，所以不需要再去单独请求
        if (isRetrieve) {
            return;
        }
        var fullPaths = EntityPathConverter.toEntityPathArray(this.viewModel.bindingPath, this.bindingData);
        var paths = fullPaths.slice(0, fullPaths.length - 1);
        var parent = this.bindingList.parent;
        var parentId = parent && parent[parent.primaryKey];
        // 上级表没有数据
        if (!parentId) {
            return;
        }
        // 获取nodecode
        var bindingPaths = this.viewModel.bindingPath.split('/').filter(function (item) { return item; });
        var nodeCode = bindingPaths[bindingPaths.length - 1];
        nodeCode = nodeCode.substr(0, nodeCode.length - 1);
        // const configPath = `/${nodeCode}_${parentId}`;
        var configPath = "/" + nodeCode;
        var _a = (this.viewModel.frameContext.repository.entityCollection.getPaginationConfigByPath(configPath) || {}).pageIndex, pageIndex = _a === void 0 ? 1 : _a;
        var _b = (this.viewModel.frameContext.repository.entityCollection.getPaginationConfigByPath(configPath) || {}).pageSize, pageSize = _b === void 0 ? 0 : _b;
        var parentNodeCode = change.path[change.path.length - 1];
        var parentConfigPath = '/' + parentNodeCode.substring(0, parentNodeCode.length - 1);
        var _c = (this.viewModel.frameContext.repository.entityCollection.getPaginationConfigByPath(parentConfigPath) || {}).pageSize, parentPageSize = _c === void 0 ? 0 : _c;
        var isQueryChild = this.viewModel.frameContext.appContext.params.get('queryChild') || false;
        if (isQueryChild) {
            // this.viewModel.frameContext.appContext.params.delete('queryChild');
            pageIndex = 1;
        }
        // 当上级表切换行时
        if (parentPageSize + pageSize !== 0) {
            this.viewModel.frameContext.appContext.params.set('forceQueryChild', true);
            this.viewModel.frameContext.repository.queryChild(paths, pageIndex, pageSize).pipe(finalize(function () { return _this.viewModel.frameContext.appContext.params.delete('forceQueryChild'); })).subscribe();
        }
    };
    FarrisDatagridUseBindingDataDirective.prototype.ngOnDestroy = function () {
        this.unRegisterBindingDataChangeEvent();
    };
    // #endregion
    // #region 事件发射器
    /**
     * 发射选中行切换事件
     * @description 统一单选模式和多选模式下的行切换事件
     */
    FarrisDatagridUseBindingDataDirective.prototype.fireSelectedRowChange = function (selectedRowContext) {
        this.selectedRowChange.emit(selectedRowContext);
    };
    /**
     * 清空选定行
     * @param change 变更
     */
    FarrisDatagridUseBindingDataDirective.prototype.clearCheckedRows = function (change) {
        if (change.type === ChangeType.Load && this.grid.multiSelect) {
            var isMatch = this.checkIfChangeMatchBindingPath(change);
            if (isMatch) {
                this.setChecks([]);
                if (typeof (this.grid.clearCheckeds) === 'function') {
                    this.grid.clearCheckeds();
                }
            }
        }
    };
    // #endregion
    // #region 通信
    /**
     * 设置BindingList的当前行
     * @param id 当前行内码
     */
    FarrisDatagridUseBindingDataDirective.prototype.setSelectionIdToBindingData = function (id) {
        // 如果当前行不存在，则强制设置
        if (!id) {
            this.bindingList.currentId = id;
            if (!this.grid.multiSelect) {
                this.setChecks([]);
            }
            return;
        }
        if (this.bindingList.currentId !== id) {
            this.bindingList.setCurrentId(id, true);
        }
        // 单选模式下将当前行设置到ids
        if (!this.grid.multiSelect) {
            this.setChecks([id]);
        }
    };
    FarrisDatagridUseBindingDataDirective.prototype.updateCheckedRows = function (changes) {
        if (changes.type === ChangeType.Load) {
            this.setCheckedRows();
        }
        else if (changes.type === ChangeType.ValueChanged) {
            var ids = this.getChecks();
            if (changes.id && ids.includes(changes.id)) {
                this.setCheckedRows();
            }
        }
    };
    /**
     * 设置选择行
     */
    FarrisDatagridUseBindingDataDirective.prototype.setChecks = function (ids) {
        this.viewModel.uiState.setPropertyValue('ids', ids);
        this.setCheckedRows(ids);
    };
    /**
     * 获取勾选行id数组
     * @returns
     */
    FarrisDatagridUseBindingDataDirective.prototype.getChecks = function () {
        return this.viewModel.uiState['ids'] || [];
    };
    /**
     * 更新勾选行数据
     */
    FarrisDatagridUseBindingDataDirective.prototype.setCheckedRows = function (ids) {
        var _this = this;
        // 高速模式时不再设置rows
        // if (this.viewModel.frameContext.appContext.runMode === RunMode.highSpeed) {
        //   return;
        // }
        if (typeof ids === 'undefined') {
            ids = this.viewModel.uiState['ids'] || [];
        }
        if (!Array.isArray(ids) || ids.length < 1) {
            // 此时ids没有值，rows中也不应该有
            this.viewModel.uiState.setPropertyValue('rows', null);
            return;
        }
        var list = [];
        // TODO：rows中数据在高速模式和普通模式下多语字段的值表现不一致，高速模式下多语字段值为对象，普通模式为当前语言。暂不处理高速模式场景
        if (this.viewModel.frameContext.appContext.runMode === RunMode.highSpeed) {
            list = this.grid.data || [];
        }
        else {
            list = this.bindingList.toJSON({ ignoreMultiLangInput: true });
        }
        var rows = this.viewModel.uiState['rows'] || new Map();
        var result = new Map();
        ids.forEach(function (id) {
            var item = list.find(function (item) { return item[_this.primaryKey] === id; });
            var otherPageItem = rows.get(id);
            if (item) {
                result.set(id, item);
            }
            else if (otherPageItem) {
                result.set(id, otherPageItem);
            }
        });
        this.viewModel.uiState.setPropertyValue('rows', result);
    };
    /**
     * 选中grid行
     * @param id id
     */
    FarrisDatagridUseBindingDataDirective.prototype.selectGridRow = function (id) {
        this.grid.selectRow(id);
        this.grid.scrollToCurrentRow();
    };
    // #endregion
    // #region 事件处理器
    /**
     * 页码切换事件
     * @param event event
     */
    FarrisDatagridUseBindingDataDirective.prototype.pageChangedHandler = function (event) {
        var pageIndex = event.pageIndex, pageSize = event.pageSize;
        if (pageIndex < 1) {
            pageIndex = 1;
        }
        var skip = (pageIndex - 1) * pageSize;
        this.bindingData.setPagingInfo(skip, pageSize, this.bindingData.bindingPath);
    };
    /**
     * 行切换事件
     * @param event event
     */
    FarrisDatagridUseBindingDataDirective.prototype.selectedRowChanged = function (event) {
        var index = event.index, data = event.data;
        var id = data[this.primaryKey];
        this.setSelectionIdToBindingData(id);
        this.fireSelectedRowChange(event);
    };
    /**
     * 取消行选择事件
     * @param event event
     */
    FarrisDatagridUseBindingDataDirective.prototype.unSelected = function (event) {
        if (!event) {
            return;
        }
        var _a = event.data, data = _a === void 0 ? {} : _a;
        var id = data[this.primaryKey];
        var currentId = this.bindingList.currentId;
        if (id === currentId) {
            this.setSelectionIdToBindingData(null);
        }
        // this.fireSelectedRowChange(event);
    };
    /**
     * 勾选行发生变化
     * @param event event
     */
    FarrisDatagridUseBindingDataDirective.prototype.checkedChanged = function (event) {
        event = event || [];
        var ids = event.map(function (item) { return item.id; });
        this.setChecks(ids);
    };
    /**
     * 分页大小变更事件
     * @param event event
     */
    FarrisDatagridUseBindingDataDirective.prototype.pageSizeChanged = function (event) {
        var pageIndex = event.pageIndex, pageSize = event.pageSize;
        var skip = 0; //(pageIndex - 1) * pageSize;
        // this.bindingList.setPaginationInfo(skip, pageSize);
        this.bindingData.setPagingInfo(skip, pageSize, this.bindingData.bindingPath);
    };
    /**
     * grid滚动加载数据
     * @param event event
     */
    FarrisDatagridUseBindingDataDirective.prototype.scrollY = function (event) {
        var pageIndex = event.pager, pageSize = event.pageSize;
        var skip = (pageIndex - 1) * pageSize;
        this.bindingData.setPagingInfo(skip, pageSize, this.bindingData.bindingPath);
    };
    FarrisDatagridUseBindingDataDirective.prototype.filterChanged = function (event) {
        this.filters = event;
    };
    // #endregion
    FarrisDatagridUseBindingDataDirective.prototype.checkIfChangeMatchBindingPath = function (change) {
        var isMatch = false;
        if (!change || !change.path) {
            return isMatch;
        }
        var changePathArray = change.path;
        if (!changePathArray) {
            return isMatch;
        }
        if (!(this.bindingData) && !(this.bindingData.bindingPath)) {
            return isMatch;
        }
        var bingdingPathArray = this.bindingData.bindingPath.split('/');
        if (bingdingPathArray.length <= 0) {
            return isMatch;
        }
        if (changePathArray.length === 0) { // 主表
            if (this.bindingData.bindingPath === '/') {
                isMatch = true;
            }
        }
        else if (change.path.length === 1) { // 主从表
            if (bingdingPathArray.length === 2 && bingdingPathArray[1] === change.path[0]) {
                isMatch = true;
            }
        }
        else if (change.path.length === 2) { // 主从从表
            if (bingdingPathArray.length === 3 && bingdingPathArray[1] === change.path[0] && bingdingPathArray[2] === change.path[1]) {
                isMatch = true;
            }
        }
        return isMatch;
    };
    FarrisDatagridUseBindingDataDirective.prototype.debounce = function (callback, wait) {
        var timeoutId = null;
        return function () {
            var args = [];
            for (var _i = 0; _i < arguments.length; _i++) {
                args[_i] = arguments[_i];
            }
            window.clearTimeout(timeoutId);
            timeoutId = window.setTimeout(function () {
                callback.apply(null, args);
            }, wait);
        };
    };
    FarrisDatagridUseBindingDataDirective.decorators = [
        { type: Directive, args: [{
                    selector: '[farris-use-binding-data]'
                },] }
    ];
    /** @nocollapse */
    FarrisDatagridUseBindingDataDirective.ctorParameters = function () { return [
        { type: BindingData },
        { type: ViewModel },
        { type: DatagridComponent }
    ]; };
    FarrisDatagridUseBindingDataDirective.propDecorators = {
        selectedRowChange: [{ type: Output }],
        pageChangedHandler: [{ type: HostListener, args: ['pageChanged', ['$event'],] }],
        selectedRowChanged: [{ type: HostListener, args: ['selectChanged', ['$event'],] }],
        unSelected: [{ type: HostListener, args: ['unSelect', ['$event'],] }],
        checkedChanged: [{ type: HostListener, args: ['checkedChange', ['$event'],] }],
        pageSizeChanged: [{ type: HostListener, args: ['pageSizeChanged', ['$event'],] }],
        scrollY: [{ type: HostListener, args: ['scrollYLoad', ['$event'],] }],
        filterChanged: [{ type: HostListener, args: ['filterChanged', ['$event'],] }]
    };
    return FarrisDatagridUseBindingDataDirective;
}());
export { FarrisDatagridUseBindingDataDirective };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmFycmlzLWRhdGFncmlkLXVzZS1iaW5kaW5nLWRhdGEuZGlyZWN0aXZlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy9rZW5kby1iaW5kaW5nLyIsInNvdXJjZXMiOlsibGliL2RpcmVjdGl2ZXMvZmFycmlzLWRhdGFncmlkL2ZhcnJpcy1kYXRhZ3JpZC11c2UtYmluZGluZy1kYXRhLmRpcmVjdGl2ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQ0wsU0FBUyxFQUErQyxZQUFZLEVBQ3BFLFlBQVksRUFBRSxNQUFNLEVBQ3JCLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBRSxPQUFPLEVBQWdCLE1BQU0sTUFBTSxDQUFDO0FBQzdDLE9BQU8sRUFBRSxXQUFXLEVBQXVCLFVBQVUsRUFBRSxTQUFTLEVBQWdCLFlBQVksRUFBRSxtQkFBbUIsRUFBRSxPQUFPLEVBQUUsYUFBYSxFQUFFLGNBQWMsRUFBRSxnQ0FBZ0MsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ3BOLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQ3hELE9BQU8sRUFBRSxZQUFZLEVBQUUsUUFBUSxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDeEQsa0NBQWtDO0FBRWxDOztHQUVHO0FBQ0g7SUFpQ0UsOEJBQThCO0lBQzlCLCtDQUFtQixXQUF3QixFQUFTLFNBQW9CLEVBQVMsSUFBdUI7UUFBckYsZ0JBQVcsR0FBWCxXQUFXLENBQWE7UUFBUyxjQUFTLEdBQVQsU0FBUyxDQUFXO1FBQVMsU0FBSSxHQUFKLElBQUksQ0FBbUI7UUE3QnhHLE9BQU87UUFDQyxlQUFVLEdBQVcsSUFBSSxDQUFDO1FBQ2xDLE9BQU87UUFDQyxtQkFBYyxHQUFXLElBQUksQ0FBQztRQUN0Qzs7V0FFRztRQUNLLGNBQVMsR0FBRyxLQUFLLENBQUM7UUFDMUI7O1dBRUc7UUFDSyxZQUFPLEdBQVEsSUFBSSxDQUFDO1FBUTVCOztXQUVHO1FBQ0ssc0JBQWlC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QUFRLEdBQWhCLFVBQWlCLFFBQTBCLEVBQUUsSUFBSTtRQUMvQyxJQUFJLFNBQVMsR0FBRyxJQUFJLENBQUM7UUFDckIsT0FBTztZQUFDLGNBQU87aUJBQVAsVUFBTyxFQUFQLHFCQUFPLEVBQVAsSUFBTztnQkFBUCx5QkFBTzs7WUFDYixNQUFNLENBQUMsWUFBWSxDQUFDLFNBQVMsQ0FBQyxDQUFDO1lBQy9CLFNBQVMsR0FBRyxNQUFNLENBQUMsVUFBVSxDQUFDO2dCQUM1QixRQUFRLENBQUMsS0FBSyxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsQ0FBQztZQUM3QixDQUFDLEVBQUUsSUFBSSxDQUFDLENBQUM7UUFDWCxDQUFDLENBQUM7SUFDSixDQUFDOztnQkE3MEJGLFNBQVMsU0FBQztvQkFDVCxRQUFRLEVBQUUsMkJBQTJCO2lCQUN0Qzs7OztnQkFWUSxXQUFXO2dCQUFtQyxTQUFTO2dCQUN2RCxpQkFBaUI7OztvQ0F1Q3ZCLE1BQU07cUNBc3JCTixZQUFZLFNBQUMsYUFBYSxFQUFFLENBQUMsUUFBUSxDQUFDO3FDQWN0QyxZQUFZLFNBQUMsZUFBZSxFQUFFLENBQUMsUUFBUSxDQUFDOzZCQVl4QyxZQUFZLFNBQUMsVUFBVSxFQUFFLENBQUMsUUFBUSxDQUFDO2lDQWlCbkMsWUFBWSxTQUFDLGVBQWUsRUFBRSxDQUFDLFFBQVEsQ0FBQztrQ0FVeEMsWUFBWSxTQUFDLGlCQUFpQixFQUFFLENBQUMsUUFBUSxDQUFDOzBCQVkxQyxZQUFZLFNBQUMsYUFBYSxFQUFFLENBQUMsUUFBUSxDQUFDO2dDQU10QyxZQUFZLFNBQUMsZUFBZSxFQUFFLENBQUMsUUFBUSxDQUFDOztJQWlEM0MsNENBQUM7Q0FBQSxBQTkwQkQsSUE4MEJDO1NBMzBCWSxxQ0FBcUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xyXG4gIERpcmVjdGl2ZSwgT25Jbml0LCBPbkNoYW5nZXMsIE9uRGVzdHJveSwgU2ltcGxlQ2hhbmdlcywgSG9zdExpc3RlbmVyLFxyXG4gIEV2ZW50RW1pdHRlciwgT3V0cHV0XHJcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IFN1YmplY3QsIFN1YnNjcmlwdGlvbiB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQgeyBCaW5kaW5nRGF0YSwgQmluZGluZ0xpc3QsIENoYW5nZSwgQ2hhbmdlVHlwZSwgVmlld01vZGVsLCBGcmFtZUNvbnRleHQsIERhdGFUeXBlSW5mbywgRW50aXR5UGF0aENvbnZlcnRlciwgUnVuTW9kZSwgQ29tcG9uZW50VHlwZSwgRXhwcmVzc2lvblV0aWwsIEVOQUJMRV9FRElUX1NUQVRFX0ZJTFRFUl9TT1JUSU5HIH0gZnJvbSAnQGZhcnJpcy9kZXZraXQnO1xyXG5pbXBvcnQgeyBEYXRhZ3JpZENvbXBvbmVudCB9IGZyb20gJ0BmYXJyaXMvdWktZGF0YWdyaWQnO1xyXG5pbXBvcnQgeyBkZWJvdW5jZVRpbWUsIGZpbmFsaXplIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xyXG4vLyB0c2xpbnQ6ZGlzYWJsZTogbWF4LWxpbmUtbGVuZ3RoXHJcblxyXG4vKlxyXG4gKiDkvb/nlKjnu5HlrprmlbDmja7mjIfku6RcclxuICovXHJcbkBEaXJlY3RpdmUoe1xyXG4gIHNlbGVjdG9yOiAnW2ZhcnJpcy11c2UtYmluZGluZy1kYXRhXSdcclxufSlcclxuZXhwb3J0IGNsYXNzIEZhcnJpc0RhdGFncmlkVXNlQmluZGluZ0RhdGFEaXJlY3RpdmUgaW1wbGVtZW50cyBPbkluaXQsIE9uQ2hhbmdlcywgT25EZXN0cm95IHtcclxuICBwcml2YXRlIF9QUk9QUzogeyBbcHJvcE5hbWU6IHN0cmluZ106IGFueSB9O1xyXG4gIC8vIOaOkuW6j+Wtl+autVxyXG4gIHByaXZhdGUgc29ydEZpZWxkczogc3RyaW5nID0gbnVsbDtcclxuICAvLyDmjpLluo/mlrnlkJFcclxuICBwcml2YXRlIHNvcnREaXJlY3Rpb25zOiBzdHJpbmcgPSBudWxsO1xyXG4gIC8qKlxyXG4gICAqIOaYr+WQpuW3suaOkuW6j1xyXG4gICAqL1xyXG4gIHByaXZhdGUgaGFzU29ydGVkID0gZmFsc2U7XHJcbiAgLyoqXHJcbiAgICog6L+H5ruk5p2h5Lu2XHJcbiAgICovXHJcbiAgcHJpdmF0ZSBmaWx0ZXJzOiBhbnkgPSBudWxsO1xyXG4gIHByb3RlY3RlZCBnZXQgcHJvcHMoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5fUFJPUFM7XHJcbiAgfVxyXG4gIHByb3RlY3RlZCBzZXQgcHJvcHModmFsdWUpIHtcclxuICAgIHRoaXMuX1BST1BTID0gdmFsdWU7XHJcbiAgfVxyXG4gIHByb3RlY3RlZCBiaW5kaW5nRGF0YUNoYW5nZUV2ZW50OiBTdWJzY3JpcHRpb247XHJcbiAgLyoqXHJcbiAgICog5riy5p+TZ3JpZFxyXG4gICAqL1xyXG4gIHByaXZhdGUgcmVuZGVyR3JpZFN1YmplY3Q6IFN1YmplY3Q8YW55PiA9IG5ldyBTdWJqZWN0PGFueT4oKTtcclxuICBwcml2YXRlIGVuYWJsZUZpbHRlclNvcnRpbmcgPSBmYWxzZTtcclxuICAvKipcclxuICAgKiDpgInkuK3ooYzliIfmjaLkuovku7ZcclxuICAgKi9cclxuICBAT3V0cHV0KCkgc2VsZWN0ZWRSb3dDaGFuZ2U6IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XHJcbiAgLy8gcHJpdmF0ZSByZW5kZXJHcmlkRGVib3VuY2U7XHJcbiAgY29uc3RydWN0b3IocHVibGljIGJpbmRpbmdEYXRhOiBCaW5kaW5nRGF0YSwgcHVibGljIHZpZXdNb2RlbDogVmlld01vZGVsLCBwdWJsaWMgZ3JpZDogRGF0YWdyaWRDb21wb25lbnQpIHtcclxuICAgIHRoaXMuc2V0Q2hlY2tzKFtdKTtcclxuICAgIHRoaXMuZW5hYmxlRmlsdGVyU29ydGluZyA9IHRoaXMudmlld01vZGVsICYmIHRoaXMudmlld01vZGVsLmZyYW1lQ29udGV4dCAmJiB0aGlzLnZpZXdNb2RlbC5mcmFtZUNvbnRleHQuaW5qZWN0b3IuZ2V0PGJvb2xlYW4+KEVOQUJMRV9FRElUX1NUQVRFX0ZJTFRFUl9TT1JUSU5HLCBmYWxzZSkgfHwgZmFsc2U7XHJcbiAgICB0aGlzLnJlZ2lzdGVyRXZlbnQoKTtcclxuICB9XHJcblxyXG4gIC8vICNyZWdpb24gTmcgRXZlbnRcclxuXHJcbiAgbmdPbkluaXQoKSB7XHJcbiAgICBjb25zdCB7IHBhZ2VTaXplID0gMCB9ID0gdGhpcy5nZXRQYWdpbmdJbmZvKCkgfHwge307XHJcbiAgICBpZiAocGFnZVNpemUgIT09IDApIHtcclxuICAgICAgLy8g5ZCv55So5YiG6aG1XHJcbiAgICAgIGlmICgoIXRoaXMuZ3JpZC5wYWdlTGlzdCB8fCB0aGlzLmdyaWQucGFnZUxpc3QubGVuZ3RoIDwgMSkgJiYgdHlwZW9mIHRoaXMuZ3JpZFsnc2V0UGFnZUxpc3QnXSA9PT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICAgIHRoaXMuZ3JpZFsnc2V0UGFnZUxpc3QnXShbcGFnZVNpemUsIHBhZ2VTaXplICogMiwgcGFnZVNpemUgKiAzLCBwYWdlU2l6ZSAqIDRdKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgdGhpcy5zZXRDb21wb25lbnRSZWYoKTtcclxuICAgIHRoaXMuYmluZERhdGEoKTtcclxuICAgIHdpbmRvdy5zZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgdGhpcy51cGRhdGVTZWxlY3RlZFJvdygpO1xyXG4gICAgfSwgMCk7XHJcbiAgICB0aGlzLnJlZ2lzdGVyQmluZGluZ0RhdGFDaGFuZ2VFdmVudCgpO1xyXG4gICAgdGhpcy5yZW5kZXJHcmlkU3ViamVjdC5waXBlKGRlYm91bmNlVGltZSg1MDApKS5zdWJzY3JpYmUoKGNoYW5nZTogQ2hhbmdlKSA9PiB7XHJcbiAgICAgIGlmICghdGhpcy52aWV3TW9kZWwgfHwgIXRoaXMudmlld01vZGVsLmZyYW1lQ29udGV4dCB8fCB0aGlzLnZpZXdNb2RlbC5mcmFtZUNvbnRleHQuaXNEaXNwb3NlZCkge1xyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfVxyXG4gICAgICB0aGlzLmJpbmREYXRhKGNoYW5nZSk7XHJcbiAgICAgIC8qaWYgKCF0aGlzLnJlbmRlckdyaWREZWJvdW5jZSkge1xyXG4gICAgICAgIHRoaXMucmVuZGVyR3JpZERlYm91bmNlID0gdGhpcy5kZWJvdW5jZSgoY2hhbmdlKSA9PiB7XHJcbiAgICAgICAgICB0aGlzLmJpbmREYXRhKGNoYW5nZSk7XHJcbiAgICAgICAgfSwgNTAwKTtcclxuICAgICAgfVxyXG4gICAgICB0aGlzLnJlbmRlckdyaWREZWJvdW5jZShjaGFuZ2UpOyovXHJcbiAgICB9KTtcclxuICAgIGlmICh0aGlzLnZpZXdNb2RlbCAmJiB0aGlzLnZpZXdNb2RlbC5mcmFtZUNvbnRleHQgJiYgdGhpcy52aWV3TW9kZWwuZnJhbWVDb250ZXh0LmZyYW1lQ29tcG9uZW50KSB7XHJcbiAgICAgIHRoaXMudmlld01vZGVsLmZyYW1lQ29udGV4dC5mcmFtZUNvbXBvbmVudC5jb21wb25lbnRUeXBlID0gQ29tcG9uZW50VHlwZS5mYXJyaXNEYXRhR3JpZENvbXBvbmVudDtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpIHtcclxuICAgIHRoaXMuYmluZERhdGEoKTtcclxuICB9XHJcblxyXG4gIC8vICNlbmRyZWdpb25cclxuXHJcblxyXG4gIC8qKlxyXG4gICAqIOS4u+mUrlxyXG4gICAqL1xyXG4gIHByb3RlY3RlZCBnZXQgcHJpbWFyeUtleSgpIHtcclxuICAgIHJldHVybiB0aGlzLmJpbmRpbmdMaXN0LnByaW1hcnlLZXk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOiOt+WPlue7keWumuaVsOaNrlxyXG4gICAqL1xyXG4gIHByb3RlY3RlZCBnZXQgYmluZGluZ0xpc3QoKTogQmluZGluZ0xpc3Qge1xyXG4gICAgLy8g5qC55a6e5L2TXHJcbiAgICBpZiAodGhpcy52aWV3TW9kZWwuYmluZGluZ1BhdGggPT09ICcvJyB8fCAhdGhpcy52aWV3TW9kZWwuYmluZGluZ1BhdGgpIHtcclxuICAgICAgcmV0dXJuIHRoaXMuYmluZGluZ0RhdGEubGlzdDtcclxuICAgIH1cclxuICAgIC8vIOWtkOWunuS9k1xyXG4gICAgbGV0IGJpbmRpbmdQYXRoID0gdGhpcy52aWV3TW9kZWwuYmluZGluZ1BhdGguc3Vic3RyKDEpO1xyXG4gICAgYmluZGluZ1BhdGggPSBiaW5kaW5nUGF0aFswXS50b0xvd2VyQ2FzZSgpICsgYmluZGluZ1BhdGguc3Vic3RyaW5nKDEsIGJpbmRpbmdQYXRoLmxlbmd0aCk7XHJcbiAgICBjb25zdCBwYXRocyA9IGJpbmRpbmdQYXRoLnNwbGl0KCcvJyk7XHJcblxyXG4gICAgY29uc3QgZmlsdGVyZWRQYXRocyA9IHBhdGhzLmZpbHRlcigocGFydDogc3RyaW5nKSA9PiB7XHJcbiAgICAgIHJldHVybiBwYXJ0ICE9PSAnJztcclxuICAgIH0pO1xyXG4gICAgcmV0dXJuIHRoaXMuYmluZGluZ0RhdGEuZ2V0VmFsdWUoZmlsdGVyZWRQYXRocyk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOiuvue9rue7hOS7tuW8leeUqFxyXG4gICAqL1xyXG4gIHByaXZhdGUgc2V0Q29tcG9uZW50UmVmKCkge1xyXG4gICAgY29uc3QgYXBwQ29udGV4dCA9IHRoaXMudmlld01vZGVsICYmIHRoaXMudmlld01vZGVsLmZyYW1lQ29udGV4dCAmJiB0aGlzLnZpZXdNb2RlbC5mcmFtZUNvbnRleHQuZ2V0Rm9ybUFwcENvbnRleHQoKTtcclxuICAgIGNvbnN0IGZyYW1lSWQgPSB0aGlzLnZpZXdNb2RlbCAmJiB0aGlzLnZpZXdNb2RlbC5mcmFtZUNvbnRleHQgJiYgdGhpcy52aWV3TW9kZWwuZnJhbWVDb250ZXh0LmZyYW1lSWQ7XHJcbiAgICBjb25zdCBpZCA9IHRoaXMuZ3JpZCAmJiB0aGlzLmdyaWQuaWQ7XHJcbiAgICAvLyDlpoLmnpxmcmFtZUlk5LiN5a2Y5Zyo5oiWZmFycmlzIGdyaWTmsqHmnIlpZOWxnuaAp++8jOivtOaYjuS4jeespuWQiOS9v+eUqOWcuuaZr1xyXG4gICAgaWYgKCFmcmFtZUlkIHx8ICFpZCkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBjb25zdCBtYXAgPSBhcHBDb250ZXh0ICYmIGFwcENvbnRleHQuY29tcG9uZW50UmVmcyAmJiBhcHBDb250ZXh0LmNvbXBvbmVudFJlZnMuZ2V0KGZyYW1lSWQpIHx8IG5ldyBNYXA8c3RyaW5nLCBhbnk+KCk7XHJcbiAgICBhcHBDb250ZXh0ICYmIGFwcENvbnRleHQuY29tcG9uZW50UmVmcyAmJiBhcHBDb250ZXh0LmNvbXBvbmVudFJlZnMuc2V0KGZyYW1lSWQsIG1hcC5zZXQoaWQsIHRoaXMuZ3JpZCkpO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDojrflj5bliIbpobXkv6Hmga9cclxuICAgKi9cclxuICBwcm90ZWN0ZWQgZ2V0UGFnaW5nSW5mbygpIHtcclxuICAgIGNvbnN0IGJpbmRpbmdQYXRoID0gdGhpcy52aWV3TW9kZWwuYmluZGluZ1BhdGg7XHJcbiAgICBjb25zdCBiaW5kaW5nRGF0YSA9IHRoaXMudmlld01vZGVsLmJpbmRpbmdEYXRhO1xyXG4gICAgY29uc3QgcGFnaW5nSW5mbyA9IGJpbmRpbmdEYXRhICYmIGJpbmRpbmdEYXRhLnBhZ2luZ0luZm8gfHwge307XHJcbiAgICBpZiAoYmluZGluZ1BhdGggPT09ICcvJykge1xyXG4gICAgICByZXR1cm4gcGFnaW5nSW5mbztcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGNvbnN0IGJpbmRpbmdQYXRocyA9IGJpbmRpbmdQYXRoLnN1YnN0cigxKS5zcGxpdCgnLycpLmZpbHRlcigoaXRlbSkgPT4gISFpdGVtICYmIGl0ZW0ubGVuZ3RoID4gMCk7XHJcbiAgICAgIC8vIOS7juihqOWPiuS7juS7juihqOWIhumhteWSjOaVsOaNruaYr+WFs+iBlOeahO+8jOWboOS4uuS4jeWQjOeahOS7juihqOihjOacieS4jeWQjOeahOS7juS7juihqOaVsOaNru+8jOWIhumhteS/oeaBr+eahOe7k+aehOS4um5vZGVDb2RlX3BhcmVudElkOnvliIbpobXkv6Hmga995LiU5YiG6aG15L+h5oGv5piv5bmz57qn55qEXHJcbiAgICAgIC8vIHtwYWdpbmF0aW9uOnthX3BpZDp7cGFnZVNpemU6MixwYWdlSW5kZXg6MX0sYl9waWQ6e3BhZ2VTaXplOjIscGFnZUluZGV4OjF9fX1cclxuICAgICAgLy8g5Y+W5Ye65b2T5YmN6Lev5b6E5LiL5a6e5L2T55qEbm9kZUNvZGVcclxuICAgICAgbGV0IG5vZGVDb2RlID0gYmluZGluZ1BhdGhzW2JpbmRpbmdQYXRocy5sZW5ndGggLSAxXTtcclxuICAgICAgbm9kZUNvZGUgPSBub2RlQ29kZS5zdWJzdHIoMCwgbm9kZUNvZGUubGVuZ3RoIC0gMSk7XHJcbiAgICAgIC8vIOiOt+WPluW9k+WJjeWunuS9k+S4iue6p+eahOS4u+mUrlxyXG4gICAgICAvLyBjb25zdCByZXN1bHQgPSBwYWdpbmdJbmZvW25vZGVDb2RlXSB8fCB7fTtcclxuICAgICAgLy8gaWYgKHJlc3VsdC5oYXNPd25Qcm9wZXJ0eSgndG90YWxDb3VudCcpKSB7XHJcbiAgICAgIC8vICAgcmVzdWx0LnRvdGFsID0gcmVzdWx0LnRvdGFsQ291bnQ7XHJcbiAgICAgIC8vIH1cclxuICAgICAgLy8gcmV0dXJuIHJlc3VsdDtcclxuXHJcbiAgICAgIGNvbnN0IHBhdGhzID0gYmluZGluZ1BhdGhzLnNsaWNlKDAsIGJpbmRpbmdQYXRocy5sZW5ndGggLSAxKTtcclxuICAgICAgY29uc3QgYmluZGluZ0xpc3QgPSBiaW5kaW5nRGF0YS5nZXRWYWx1ZShwYXRocykgYXMgQmluZGluZ0xpc3Q7XHJcbiAgICAgIGNvbnN0IHsgcGFnZVNpemUgPSAwIH0gPSBwYWdpbmdJbmZvW2Ake25vZGVDb2RlfWBdIHx8IHt9O1xyXG4gICAgICAvLyDkuIrnuqfooajmnInmlbDmja5cclxuICAgICAgaWYgKGJpbmRpbmdMaXN0ICYmIGJpbmRpbmdMaXN0LmN1cnJlbnRJZCkge1xyXG4gICAgICAgIGNvbnN0IGtleSA9IGAke25vZGVDb2RlfV8ke2JpbmRpbmdMaXN0LmN1cnJlbnRJZH1gO1xyXG4gICAgICAgIC8vIGNvbnN0IGtleSA9IG5vZGVDb2RlO1xyXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IHBhZ2luZ0luZm9ba2V5XSB8fCB7fTtcclxuICAgICAgICBpZiAocmVzdWx0Lmhhc093blByb3BlcnR5KCd0b3RhbENvdW50JykpIHtcclxuICAgICAgICAgIHJlc3VsdC50b3RhbCA9IHJlc3VsdC50b3RhbENvdW50O1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyDkuIrnuqfooajomb3nhLbmnInmlbDmja7vvIzkvYbkuIrnuqfooajlvZPliY3ooYznmoTkuIvnuqfooajlj6/og73msqHmnInmlbDmja7vvIzov5nlsLHlr7zoh7Tojrflj5bkuI3liLDliIbpobXkv6Hmga/vvIzmiYDku6XpnIDopoHlnKjov5Tlm57liY3lr7nnu5Pmnpzov5vooYzlpITnkIbvvIzlpoLmnpzmsqHmnInliIbpobXkv6Hmga/nmoTor53otbfnoIHlupTor6Xov5Tlm57liIbpobXlpKflsI/lj4rlvZPliY3pobXnoIFcclxuICAgICAgICBpZiAoT2JqZWN0LmtleXMocmVzdWx0KS5sZW5ndGggPCAxKSB7XHJcbiAgICAgICAgICByZXN1bHQucGFnZUluZGV4ID0gMTtcclxuICAgICAgICAgIHJlc3VsdC5wYWdlU2l6ZSA9IHBhZ2VTaXplO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIC8vIOS4iue6p+ihqOayoeacieaVsOaNru+8jOatpOaXtumcgOimgeiOt+WPluW9k+WJjeihqOeahOWIhumhteS/oeaBr++8jOWmguWIhumhteWkp+Wwj+OAguW9k+WJjemhtem7mOiupOS4ujHljbPlj6/jgIJcclxuICAgICAgICByZXR1cm4geyBwYWdlSW5kZXg6IDEsIHBhZ2VTaXplIH07XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8vICNyZWdpb24gSW5wdXRcclxuICAvKipcclxuICAgKiDnu4Tku7bmmK/lkKbpnIDopoHmm7TmlrBcclxuICAgKiBAcGFyYW0gcHJvcHMg5b2T5YmN5bGe5oCnXHJcbiAgICogQHBhcmFtIG5leHRQcm9wcyDmlrDlsZ7mgKdcclxuICAgKiBAcGFyYW0gY2hhbmdlIOWPmOabtFxyXG4gICAqL1xyXG4gIHByb3RlY3RlZCBzaG91bGRDb21wb25lbnRVcGRhdGUoY2hhbmdlOiBDaGFuZ2UsIGRhdGE6IGFueSwpOiB7IHJlc3VsdDogYm9vbGVhbiwgcHJvcHM/OiBhbnkgfSB7XHJcbiAgICBjb25zdCBwcm9wcyA9IHRoaXMuYnVpbGRQcm9wcyhkYXRhKTtcclxuICAgIGlmICh0aGlzLnZpZXdNb2RlbCAmJiB0aGlzLnZpZXdNb2RlbC5mcmFtZUNvbnRleHQgJiYgdGhpcy52aWV3TW9kZWwuZnJhbWVDb250ZXh0LmFwcENvbnRleHQgJiYgdGhpcy52aWV3TW9kZWwuZnJhbWVDb250ZXh0LmFwcENvbnRleHQucnVuTW9kZSA9PT0gUnVuTW9kZS5oaWdoU3BlZWQgJiYgY2hhbmdlKSB7XHJcbiAgICAgIGlmIChjaGFuZ2UudHlwZSA9PT0gQ2hhbmdlVHlwZS5Mb2FkIHx8IGNoYW5nZS50eXBlID09PSBDaGFuZ2VUeXBlLlJlbW92ZSB8fCBjaGFuZ2UudHlwZSA9PT0gQ2hhbmdlVHlwZS5QYWdpbmF0aW9uSW5mb0NoYW5nZSkge1xyXG4gICAgICAgIHJldHVybiB7IHJlc3VsdDogdHJ1ZSwgcHJvcHMgfTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgY29uc3QgZ3JpZFByb3BzID0gdGhpcy5idWlsZEdyaWRQcm9wcygpO1xyXG4gICAgaWYgKEpTT04uc3RyaW5naWZ5KHByb3BzKSA9PT0gSlNPTi5zdHJpbmdpZnkoZ3JpZFByb3BzKSkge1xyXG4gICAgICByZXR1cm4geyByZXN1bHQ6IGZhbHNlIH07XHJcbiAgICB9XHJcbiAgICByZXR1cm4geyByZXN1bHQ6IHRydWUsIHByb3BzIH07XHJcbiAgfVxyXG4gIHByb3RlY3RlZCByZWdpc3RlckV2ZW50KCkge1xyXG4gICAgLy8g5o6S5bqP5LqL5Lu2XHJcbiAgICB0aGlzLmdyaWQgJiYgdGhpcy5ncmlkLmNvbHVtblNvcnRlZCAmJiB0aGlzLmdyaWQuY29sdW1uU29ydGVkLnN1YnNjcmliZSgoZXZlbnQ6IGFueSkgPT4ge1xyXG4gICAgICBjb25zdCBpc1JlbW90ZVNvcnQgPSB0aGlzLmdyaWQucmVtb3RlU29ydDtcclxuICAgICAgLy8g5pys5Zyw5o6S5bqPXHJcbiAgICAgIGlmICghaXNSZW1vdGVTb3J0KSB7XHJcbiAgICAgICAgdGhpcy5zb3J0RmllbGRzID0gdGhpcy5ncmlkLnNvcnROYW1lO1xyXG4gICAgICAgIHRoaXMuc29ydERpcmVjdGlvbnMgPSB0aGlzLmdyaWQuc29ydE9yZGVyO1xyXG4gICAgICAgIHRoaXMuc29ydEJpbmRpbmdMaXN0KCk7XHJcbiAgICAgICAgLy8gdGhpcy5wcm9wcyA9IHRoaXMuYnVpbGRQcm9wcygpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIC8vIOacjeWKoeWZqOerr+aOkuW6j1xyXG4gICAgICAgIGNvbnN0IGdyb3VwRmllbGQgPSB0aGlzLmdyaWQgJiYgdGhpcy5ncmlkLmdyb3VwRmllbGQgfHwgbnVsbDtcclxuICAgICAgICBsZXQgc29ydEZpZWxkcyA9IHRoaXMuZ3JpZC5zb3J0TmFtZSAmJiB0aGlzLmdyaWQuc29ydE5hbWUuc3BsaXQoJywnKSB8fCBbXTtcclxuICAgICAgICBjb25zdCBzb3J0RGlyZWN0aW9uID0gdGhpcy5ncmlkLnNvcnRPcmRlciAmJiB0aGlzLmdyaWQuc29ydE9yZGVyLnNwbGl0KCcsJykgfHwgW107XHJcbiAgICAgICAgaWYgKGdyb3VwRmllbGQpIHtcclxuICAgICAgICAgIGlmICghc29ydEZpZWxkcy5pbmNsdWRlcyhncm91cEZpZWxkKSkge1xyXG4gICAgICAgICAgICBzb3J0RmllbGRzLnNwbGljZSgwLCAwLCBncm91cEZpZWxkKTtcclxuICAgICAgICAgICAgc29ydERpcmVjdGlvbi5zcGxpY2UoMCwgMCwgJ2FzYycpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICAvLyDojrflj5blvZPliY1lbnRpdHnkuIrmiYDmnIlvYmplY3TlsZ7mgKdcclxuICAgICAgICBjb25zdCBlbnRpdHlUeXBlID0gdGhpcy52aWV3TW9kZWwgJiYgdGhpcy52aWV3TW9kZWwuZnJhbWVDb250ZXh0LnJlcG9zaXRvcnkuZW50aXR5VHlwZSB8fCBudWxsO1xyXG5cclxuICAgICAgICBpZiAoc29ydEZpZWxkcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICBpZiAoZW50aXR5VHlwZSkge1xyXG4gICAgICAgICAgICBjb25zdCBkYXRhVHlwZUluZm8gPSBuZXcgRGF0YVR5cGVJbmZvKGVudGl0eVR5cGUpO1xyXG4gICAgICAgICAgICBzb3J0RmllbGRzID0gc29ydEZpZWxkcy5tYXAoZmllbGQgPT4ge1xyXG4gICAgICAgICAgICAgIC8vaWYgKGZpZWxkICYmIGZpZWxkLmluZGV4T2YoJy4nKSAhPT0gLTEpIHtcclxuICAgICAgICAgICAgICBjb25zdCBwYXRocyA9IGZpZWxkLnNwbGl0KCcuJyk7XHJcbiAgICAgICAgICAgICAgY29uc3QgcHJvcEluZm8gPSBkYXRhVHlwZUluZm8uZ2V0UHJvcEluZm9CeVBhdGgocGF0aHMpO1xyXG4gICAgICAgICAgICAgIGNvbnN0IG9yaWdpbmFsRmllbGQgPSBwcm9wSW5mbyAmJiBwcm9wSW5mby5tZXRhZGF0YUluZm9bJ3BhdGgnXSB8fCBudWxsO1xyXG4gICAgICAgICAgICAgIHJldHVybiBvcmlnaW5hbEZpZWxkO1xyXG4gICAgICAgICAgICAgIC8vfVxyXG4gICAgICAgICAgICAgIC8vcmV0dXJuIGZpZWxkO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgLy8g6YGN5Y6G5bGe5oCn77yM5qC55o2uZGF0YWZpZWxk6L2s5o2i5Li6b3JpZ2luYWxEYXRhRmllbGRcclxuICAgICAgICBjb25zdCBmaWVsZHMgPSBzb3J0RmllbGRzLmpvaW4oJywnKTtcclxuICAgICAgICBjb25zdCBkaXJlY3Rpb25zID0gc29ydERpcmVjdGlvbi5qb2luKCcsJykgfHwgJ2FzYyc7XHJcbiAgICAgICAgY29uc3QgZnJhbWVDb250ZXh0OiBGcmFtZUNvbnRleHQgPSB0aGlzLnZpZXdNb2RlbCAmJiB0aGlzLnZpZXdNb2RlbC5mcmFtZUNvbnRleHQgfHwgbnVsbDtcclxuICAgICAgICBpZiAoZnJhbWVDb250ZXh0KSB7XHJcbiAgICAgICAgICBmcmFtZUNvbnRleHQucmVwb3NpdG9yeS5zb3J0Q29uZGl0aW9uTWFuYWdlci5zZXRDb25kaXRpb25zKHRoaXMudmlld01vZGVsLmJpbmRpbmdQYXRoLCBmaWVsZHMsIGRpcmVjdGlvbnMpO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICAvLyDov4fmu6Tkuovku7ZcclxuICAgIHRoaXMuZ3JpZCAmJiB0aGlzLmdyaWQuZmlsdGVyQ2hhbmdlZCAmJiB0aGlzLmdyaWQuZmlsdGVyQ2hhbmdlZC5zdWJzY3JpYmUoKGV2ZW50OiBhbnkpID0+IHtcclxuICAgICAgdGhpcy5maWx0ZXJzID0gZXZlbnQ7XHJcbiAgICAgIGlmICghdGhpcy5ncmlkLnJlbW90ZUZpbHRlcikge1xyXG4gICAgICAgIGlmICh0aGlzLmJpbmRpbmdMaXN0Lmxlbmd0aCA+IDAgJiYgIXRoaXMuYmluZGluZ0xpc3QuY3VycmVudElkKSB7XHJcbiAgICAgICAgICBjb25zdCBpZCA9IHRoaXMuYmluZGluZ0xpc3QuZ2V0SWRCeUluZGV4KDApO1xyXG4gICAgICAgICAgdGhpcy5iaW5kaW5nTGlzdC5zZXRDdXJyZW50SWQoaWQpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmJpbmRpbmdMaXN0LmZpbHRlcih0aGlzLmZpbHRlcnMpO1xyXG4gICAgICAgIHRoaXMuYmluZERhdGEoKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICB0aGlzLnZpZXdNb2RlbC5mcmFtZUNvbnRleHQuYXBwQ29udGV4dC5tZXNzYWdlUGlwZS5zdWJzY3JpYmUoKG1lc3NhZ2UpID0+IHtcclxuICAgICAgaWYgKG1lc3NhZ2UgJiYgbWVzc2FnZSA9PT0gJ0NMRUFSX0dSSURfQ09ORElUSU9OJyAmJiB0aGlzLmZpbHRlcnMgJiYgT2JqZWN0LmtleXModGhpcy5maWx0ZXJzKS5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgdGhpcy5maWx0ZXJzID0ge307XHJcbiAgICAgICAgdGhpcy5iaW5kRGF0YSgpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOWvuWJpbmRpbmdMaXN05o6S5bqPXHJcbiAgICogQHBhcmFtIGNoYW5nZSBjaGFuZ2VcclxuICAgKi9cclxuICBwcml2YXRlIHNvcnRCaW5kaW5nTGlzdChjaGFuZ2U/OiBDaGFuZ2UpIHtcclxuICAgIC8vIGdyb3VwRmllbGTlj6/og73mnInlpJrkuKrvvIzku6XpgJflj7fliIbpmpTnmoTlrZfnrKbkuLJcclxuICAgIGNvbnN0IGdyb3VwRmllbGQgPSB0aGlzLmdyaWQgJiYgdGhpcy5ncmlkLmdyb3VwRmllbGQgfHwgbnVsbDtcclxuICAgIGlmIChncm91cEZpZWxkKSB7XHJcbiAgICAgIGNvbnN0IGFyclNvcnRGaWVsZHMgPSB0aGlzLnNvcnRGaWVsZHMgJiYgdGhpcy5zb3J0RmllbGRzLnNwbGl0KCcsJykgfHwgW107XHJcbiAgICAgIGNvbnN0IGdyb3VwRmllbGRzID0gZ3JvdXBGaWVsZC5zcGxpdCgnLCcpLnJldmVyc2UoKTtcclxuICAgICAgZ3JvdXBGaWVsZHMuZm9yRWFjaCgoZmllbGQ6IHN0cmluZykgPT4ge1xyXG4gICAgICAgIGlmICghYXJyU29ydEZpZWxkcy5pbmNsdWRlcyhmaWVsZCkpIHtcclxuICAgICAgICAgIGFyclNvcnRGaWVsZHMuc3BsaWNlKDAsIDAsIGZpZWxkKTtcclxuICAgICAgICAgIGNvbnN0IGFyclNvcnREaXJlY3Rpb24gPSB0aGlzLnNvcnREaXJlY3Rpb25zICYmIHRoaXMuc29ydERpcmVjdGlvbnMuc3BsaXQoJywnKSB8fCBbXTtcclxuICAgICAgICAgIGFyclNvcnREaXJlY3Rpb24uc3BsaWNlKDAsIDAsICdhc2MnKTtcclxuICAgICAgICAgIHRoaXMuc29ydEZpZWxkcyA9IGFyclNvcnRGaWVsZHMuam9pbignLCcpO1xyXG4gICAgICAgICAgdGhpcy5zb3J0RGlyZWN0aW9ucyA9IGFyclNvcnREaXJlY3Rpb24uam9pbignLCcpIHx8ICdhc2MnO1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICB0aGlzLmJpbmRpbmdMaXN0LnNvcnRCeSh0aGlzLnNvcnRGaWVsZHMsIHRoaXMuc29ydERpcmVjdGlvbnMpO1xyXG4gICAgdGhpcy5iaW5kRGF0YShjaGFuZ2UpO1xyXG4gIH1cclxuICAvLyAjZW5kcmVnaW9uXHJcblxyXG4gIC8vICNyZWdpb24g5pWw5o2u57uR5a6a6YOo5YiGXHJcbiAgLyoqXHJcbiAgICog5pu05paw5pWw5o2uXHJcbiAgICogQHBhcmFtIGNoYW5nZT8g5Y+Y5pu0XHJcbiAgICovXHJcbiAgYmluZERhdGEoY2hhbmdlPzogQ2hhbmdlKSB7XHJcbiAgICBjb25zdCBpc1JlbW90ZUZpbHRlciA9IHRoaXMuZ3JpZCAmJiB0aGlzLmdyaWQucmVtb3RlRmlsdGVyIHx8IGZhbHNlO1xyXG4gICAgLy8g5YWI5omn6KGM5o6S5bqPXHJcbiAgICBjb25zdCBzaG91bGRTb3J0ID0gdGhpcy5zaG91bGRTb3J0KGNoYW5nZSk7XHJcbiAgICBpZiAoc2hvdWxkU29ydCkge1xyXG4gICAgICB0aGlzLmhhc1NvcnRlZCA9IHRydWU7XHJcbiAgICAgIHRoaXMuc29ydEJpbmRpbmdMaXN0KGNoYW5nZSk7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIHRoaXMuaGFzU29ydGVkID0gZmFsc2U7XHJcbiAgICAvLyDmlrDlop7mlbDmja7ml7bmuIXnqbrooajmoLznrZvpgInmnaHku7ZcclxuICAgIGlmICgodGhpcy5ncmlkLmVkaXRhYmxlID09PSB0cnVlIHx8IGNoYW5nZSAmJiBjaGFuZ2UudHlwZSA9PT0gQ2hhbmdlVHlwZS5BcHBlbmQpICYmIHRoaXMuZmlsdGVycyAmJiBPYmplY3Qua2V5cyh0aGlzLmZpbHRlcnMpLmxlbmd0aCA+IDAgJiYgIWlzUmVtb3RlRmlsdGVyKSB7XHJcbiAgICAgIGlmICghdGhpcy52aWV3TW9kZWwuZnJhbWVDb250ZXh0LmFwcENvbnRleHQuZW5hYmxlR3JpZEhlYWRlcldoZW5FZGl0aW5nICYmICF0aGlzLmVuYWJsZUZpbHRlclNvcnRpbmcpIHtcclxuICAgICAgICB0aGlzLmZpbHRlcnMgPSB7fTtcclxuICAgICAgICB0aGlzLmdyaWQuY2xlYXJDb25kaXRpb24oKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgY29uc3Qgc2hvdWxkRmlsdGVyaW5nID0gdGhpcy5zaG91bGRGaWx0ZXJpbmcoY2hhbmdlKTtcclxuICAgIGlmIChzaG91bGRGaWx0ZXJpbmcpIHtcclxuICAgICAgdGhpcy5iaW5kaW5nTGlzdC5maWx0ZXIodGhpcy5maWx0ZXJzKTtcclxuICAgIH1cclxuICAgIC8vIOWGjXRvSlNPTlxyXG4gICAgY29uc3QgZGF0YTogYW55ID0gdGhpcy5iaW5kaW5nTGlzdC50b0pTT04oKTtcclxuICAgIC8vIGlmICh0aGlzLmZpbHRlcnMgJiYgT2JqZWN0LmtleXModGhpcy5maWx0ZXJzKS5sZW5ndGggPiAwICYmICFpc1JlbW90ZUZpbHRlcikge1xyXG4gICAgLy8gICAvLyBkYXRhID0gdGhpcy5ncmlkLmNsaWVudEZpbHRlclNlcnZpY2UuZXhlY3V0ZUZpbHRlcihkYXRhLCB0aGlzLmZpbHRlcnMpO1xyXG4gICAgLy8gfVxyXG5cclxuICAgIGlmICh0aGlzLmZpbHRlcnMgJiYgT2JqZWN0LmtleXModGhpcy5maWx0ZXJzKS5sZW5ndGggPiAwICYmICFpc1JlbW90ZUZpbHRlciAmJiAoIWNoYW5nZSB8fCBjaGFuZ2UgJiYgY2hhbmdlLnR5cGUgIT09IENoYW5nZVR5cGUuU2VsZWN0aW9uQ2hhbmdlZCAmJiBjaGFuZ2UudHlwZSAhPT0gQ2hhbmdlVHlwZS5HbG9iYWxTZWxlY3Rpb25DaGFuZ2VkKSkge1xyXG4gICAgICBpZiAoZGF0YSAmJiBkYXRhLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAvLyDliKTmlq3lvZPliY3ooYzmmK/lkKblnKjov4fmu6TlkI7nmoTmlbDmja7kuK1cclxuICAgICAgICBjb25zdCByb3cgPSAoZGF0YSBhcyBbXSkuZmluZCgoaXRlbSkgPT4gaXRlbVt0aGlzLmJpbmRpbmdMaXN0LnByaW1hcnlLZXldID09PSB0aGlzLmJpbmRpbmdMaXN0LmN1cnJlbnRJZCk7XHJcbiAgICAgICAgaWYgKCFyb3cpIHtcclxuICAgICAgICAgIGNvbnN0IGZpcnN0Um93SWQgPSBkYXRhWzBdW3RoaXMuYmluZGluZ0xpc3QucHJpbWFyeUtleV07XHJcbiAgICAgICAgICB0aGlzLmJpbmRpbmdMaXN0LnNldEN1cnJlbnRJZChmaXJzdFJvd0lkLCB0cnVlLCB0cnVlKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgLy8g5pys5Zyw6L+H5ruk5a6M5LmL5ZCO5rKh5pyJ5pWw5o2u5LqGXHJcbiAgICAgICAgLy8gdGhpcy5iaW5kaW5nTGlzdC5jdXJyZW50SWQgPSBudWxsO1xyXG4gICAgICAgIGlmICh0aGlzLmJpbmRpbmdMaXN0LmN1cnJlbnRJZCkge1xyXG4gICAgICAgICAgdGhpcy5iaW5kaW5nTGlzdC5zZXRDdXJyZW50SWQobnVsbCwgdHJ1ZSwgdHJ1ZSwgdHJ1ZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIOWNlemAieaXtua4heepumlkc1xyXG4gICAgICAgIGlmICghdGhpcy5ncmlkLm11bHRpU2VsZWN0KSB7XHJcbiAgICAgICAgICB0aGlzLnNldENoZWNrcyhbXSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICBjb25zdCByZXN1bHQgPSB0aGlzLnNob3VsZENvbXBvbmVudFVwZGF0ZShjaGFuZ2UsIGRhdGEpO1xyXG4gICAgaWYgKCFyZXN1bHQucmVzdWx0KSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIC8vIGNvbnN0IG5leHRQcm9wcyA9IHRoaXMuYnVpbGRQcm9wcyhyZXN1bHQpO1xyXG4gICAgdGhpcy5yZW5kZXJHcmlkKHJlc3VsdC5wcm9wcyk7XHJcbiAgICB0aGlzLnByb3BzID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShyZXN1bHQucHJvcHMpKTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5piv5ZCm5bqU6K+l6L+H5rukXHJcbiAgICogQHBhcmFtIGNoYW5nZSAtIGNoYW5nZVxyXG4gICAqIEByZXR1cm5zIHtib29sZWFufVxyXG4gICAqL1xyXG4gIHByaXZhdGUgc2hvdWxkRmlsdGVyaW5nKGNoYW5nZT86IENoYW5nZSkge1xyXG4gICAgY29uc3QgaXNSZW1vdGVGaWx0ZXIgPSB0aGlzLmdyaWQgJiYgdGhpcy5ncmlkLnJlbW90ZUZpbHRlciB8fCBmYWxzZTtcclxuICAgIC8vIOWQr+eUqOi/nOerr+i/h+a7pOaXtuS4jemcgOimgeacrOWcsOi/h+a7pFxyXG4gICAgaWYgKGlzUmVtb3RlRmlsdGVyID09PSB0cnVlKSB7XHJcbiAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuICAgIC8vIOayoeaciei/h+a7pOadoeS7tuaXtuS4jemcgOimgeaJp+ihjOi/h+a7pFxyXG4gICAgaWYgKCF0aGlzLmZpbHRlcnMgfHwgT2JqZWN0LmtleXModGhpcy5maWx0ZXJzKS5sZW5ndGggPCAxKSB7XHJcbiAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuICAgIGlmIChjaGFuZ2UpIHtcclxuICAgICAgcmV0dXJuIGNoYW5nZS50eXBlID09PSBDaGFuZ2VUeXBlLkxvYWQ7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gIXRoaXMuZ3JpZC5lZGl0YWJsZTtcclxuICB9XHJcbiAgcHJpdmF0ZSBzaG91bGRTb3J0KGNoYW5nZT86IENoYW5nZSkge1xyXG4gICAgLy8gdGhpcy5zb3J0RmllbGRzICYmICF0aGlzLmdyaWQuZWRpdGFibGUgJiYgY2hhbmdlICYmIChjaGFuZ2UudHlwZSA9PT0gJ0xvYWQnIHx8IGNoYW5nZS50eXBlID09PSAnU2VsZWN0aW9uQ2hhbmdlZCcpXHJcbiAgICBpZiAoIXRoaXMuc29ydEZpZWxkcyB8fCBPYmplY3Qua2V5cyh0aGlzLnNvcnRGaWVsZHMpLmxlbmd0aCA8IDEpIHtcclxuICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG4gICAgaWYgKHRoaXMuaGFzU29ydGVkKSB7XHJcbiAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuICAgIGlmIChjaGFuZ2UpIHtcclxuICAgICAgcmV0dXJuIGNoYW5nZS50eXBlID09PSAnTG9hZCcgfHwgY2hhbmdlLnR5cGUgPT09ICdTZWxlY3Rpb25DaGFuZ2VkJztcclxuICAgIH1cclxuICAgIHJldHVybiB0aGlzLmdyaWQuZWRpdGFibGU7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOa4suafk2dyaWRcclxuICAgKiBAcGFyYW0gcHJvcHMg5bGe5oCnXHJcbiAgICovXHJcbiAgcHJpdmF0ZSByZW5kZXJHcmlkKHByb3BzOiBhbnkpIHtcclxuICAgIGNvbnN0IHsgcGFnZUluZGV4LCBwYWdlU2l6ZSwgdG90YWwsIHBhZ2luYXRpb24sIGRhdGEgfSA9IHByb3BzO1xyXG4gICAgY29uc3QgdmlydHVhbGl6ZWRMb2FkID0gdGhpcy5ncmlkLnZpcnR1YWxpemVkQXN5bmNMb2FkIHx8IGZhbHNlO1xyXG4gICAgdGhpcy5ncmlkLnRvdGFsID0gdG90YWw7XHJcbiAgICB0aGlzLmdyaWQucGFnZVNpemUgPSBwYWdlU2l6ZTtcclxuICAgIHRoaXMuZ3JpZC5wYWdlSW5kZXggPSBwYWdlSW5kZXg7XHJcbiAgICB0aGlzLmdyaWQucGFnaW5hdGlvbiA9IHBhZ2luYXRpb247XHJcbiAgICB0aGlzLmdyaWQuY29udHJvbFBhZ2luYXRpb25TdGF0ZSA9IGZhbHNlO1xyXG4gICAgLy8gdGhpcy5lbmRDZWxsRWRpdCgpO1xyXG4gICAgaWYgKHBhZ2VTaXplID09PSAwKSB7XHJcbiAgICAgIHRoaXMuZ3JpZC5wYWdpbmF0aW9uID0gZmFsc2U7XHJcbiAgICAgIHRoaXMuZ3JpZC5wYWdlSW5kZXggPSAxO1xyXG4gICAgICAvLyDkv67lpI3kuI3liIbpobXml7Zncmlk5ZCv55So5YiG57uE5LuN5Lya6YeN5paw6YKm5pWw55qE6Zeu6aKYXHJcbiAgICAgIC8vIHRoaXMuZ3JpZC5wYWdlU2l6ZSA9IHRvdGFsO1xyXG4gICAgfVxyXG4gICAgaWYgKHZpcnR1YWxpemVkTG9hZCkge1xyXG4gICAgICB0aGlzLmdyaWQubG9hZFZpcnR1YWxEYXRhKHtcclxuICAgICAgICBpdGVtczogZGF0YSxcclxuICAgICAgICBwYWdlSW5kZXgsXHJcbiAgICAgICAgcGFnZVNpemUsXHJcbiAgICAgICAgdG90YWxcclxuICAgICAgfSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLmdyaWQubG9hZERhdGEoZGF0YSk7XHJcbiAgICB9XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOaehOmAoOihqOagvOaVsOaNruWxnuaAp1xyXG4gICAqL1xyXG4gIHByb3RlY3RlZCBidWlsZFByb3BzKGRhdGFzPzogQXJyYXk8YW55Pikge1xyXG4gICAgbGV0IGRhdGE7XHJcbiAgICBpZiAodHlwZW9mIChkYXRhcykgIT09ICd1bmRlZmluZWQnKSB7XHJcbiAgICAgIGRhdGEgPSBkYXRhcztcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGRhdGEgPSB0aGlzLmJpbmRpbmdMaXN0LnRvSlNPTigpO1xyXG4gICAgfVxyXG4gICAgLy8gbGV0IHNraXAgPSAwO1xyXG4gICAgbGV0IHsgcGFnZUluZGV4ID0gMSwgcGFnZVNpemUgPSAwIH0gPSB0aGlzLmdldFBhZ2luZ0luZm8oKSB8fCB7fTtcclxuICAgIGxldCB7IHRvdGFsID0gMCB9ID0gdGhpcy5nZXRQYWdpbmdJbmZvKCkgfHwge307XHJcbiAgICAvLyBpZiAocGFnZUluZGV4ID4gMCkge1xyXG4gICAgLy8gICBza2lwID0gKHBhZ2VJbmRleCAtIDEpICogcGFnZVNpemU7XHJcbiAgICAvLyB9XHJcbiAgICBpZiAocGFnZVNpemUgPT09IDAgJiYgdG90YWwgPT09IDApIHtcclxuICAgICAgdG90YWwgPSBkYXRhLmxlbmd0aDtcclxuICAgIH1cclxuICAgIHJldHVybiB7IGRhdGEsIHBhZ2VJbmRleCwgcGFnZVNpemUsIHRvdGFsLCBwYWdpbmF0aW9uOiBwYWdlU2l6ZSAhPT0gMCB9O1xyXG4gIH1cclxuICAvKipcclxuICAgKiDorqHnrpdncmlk54q25oCBXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBidWlsZEdyaWRQcm9wcygpIHtcclxuICAgIGNvbnN0IGRhdGEgPSB0aGlzLmdyaWQuZGF0YSB8fCBbXTtcclxuICAgIGxldCBza2lwID0gMDtcclxuICAgIGNvbnN0IHsgcGFnZUluZGV4ID0gMSwgcGFnZVNpemUgPSAwIH0gPSB7IHBhZ2VJbmRleDogdGhpcy5ncmlkLnBhZ2VJbmRleCwgcGFnZVNpemU6IHRoaXMuZ3JpZC5wYWdlU2l6ZSB9O1xyXG4gICAgbGV0IHRvdGFsID0gdGhpcy5ncmlkLnRvdGFsIHx8IDA7XHJcbiAgICBpZiAocGFnZUluZGV4ID4gMCkge1xyXG4gICAgICBza2lwID0gKHBhZ2VJbmRleCAtIDEpICogcGFnZVNpemU7XHJcbiAgICB9XHJcbiAgICBpZiAocGFnZVNpemUgPT09IDAgJiYgdG90YWwgPT09IDApIHtcclxuICAgICAgdG90YWwgPSBkYXRhLmxlbmd0aDtcclxuICAgIH1cclxuICAgIHJldHVybiB7IGRhdGEsIHBhZ2VJbmRleCwgcGFnZVNpemUsIHRvdGFsLCBwYWdpbmF0aW9uOiB0aGlzLmdyaWQucGFnaW5hdGlvbiB9O1xyXG4gIH1cclxuICAvKipcclxuICAgKiDmlbDmja7mupDlj5HnlJ/lj5jmm7RcclxuICAgKiBAcGFyYW0gY2hhbmdlIOWPmOabtFxyXG4gICAqL1xyXG4gIHByb3RlY3RlZCBvbkJpbmRpbmdEYXRhQ2hhbmdlKGNoYW5nZTogQ2hhbmdlKSB7XHJcbiAgICB0aGlzLnVwZGF0ZURhdGFTb3VyY2UoY2hhbmdlKTtcclxuICAgIHRoaXMudXBkYXRlU2VsZWN0ZWRSb3coY2hhbmdlKTtcclxuICAgIC8vIHRoaXMudXBkYXRlR3JpZChjaGFuZ2UpO1xyXG4gICAgLy8g5LiN5riF6Zmk5Yu+6YCJ6KGM77yM6ZyA6KaB5L+d55WZ5Yu+6YCJ54q25oCBXHJcbiAgICAvLyB0aGlzLmNsZWFyQ2hlY2tlZFJvd3MoY2hhbmdlKTtcclxuICAgIHRoaXMuZW5kQ2VsbEVkaXQoY2hhbmdlKTtcclxuICAgIC8vIOabtOaWsOWLvumAieihjOaVsOaNrlxyXG4gICAgdGhpcy51cGRhdGVDaGVja2VkUm93cyhjaGFuZ2UpO1xyXG4gICAgdGhpcy51cGRhdGVEYXRhKGNoYW5nZSk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOabtOaWsOaVsOaNrlxyXG4gICAqL1xyXG4gIHByaXZhdGUgdXBkYXRlRGF0YVNvdXJjZShjaGFuZ2U6IENoYW5nZSkge1xyXG4gICAgaWYgKGNoYW5nZSAmJiBjaGFuZ2UudHlwZSA9PT0gQ2hhbmdlVHlwZS5WYWx1ZUNoYW5nZWQpIHtcclxuICAgICAgLy8g6K6h566X5Y+Y5pu06Lev5b6E5Lit6KGo5ZCN5Y+K5a2X5q615ZCNXHJcbiAgICAgIGNvbnN0IHBhdGhzID0gY2hhbmdlLnBhdGg7XHJcbiAgICAgIHRyeSB7XHJcbiAgICAgICAgY29uc3QgZW50aXR5UGF0aCA9IEV4cHJlc3Npb25VdGlsLmdldEF2YWlsYWJsZUNoaWxkcmVuUGF0aHNGcm9tRW50aXR5UGF0aHMocGF0aHMsIHRoaXMudmlld01vZGVsLmZyYW1lQ29udGV4dC5yZXBvc2l0b3J5LmVudGl0eVR5cGVJbmZvKTtcclxuICAgICAgICBpZiAodGhpcy52aWV3TW9kZWwuYmluZGluZ1BhdGggPT09ICcvJyArIGVudGl0eVBhdGguam9pbignLycpKSB7XHJcbiAgICAgICAgICBjb25zdCBwcm9wZXJ0eU5hbWVzID0gcGF0aHMuc2xpY2UoZW50aXR5UGF0aC5sZW5ndGgpO1xyXG4gICAgICAgICAgaWYgKGNoYW5nZS5pZCAmJiB0aGlzLmdyaWQgJiYgY2hhbmdlLnBhdGggJiYgdGhpcy52aWV3TW9kZWwuZnJhbWVDb250ZXh0LmFwcENvbnRleHQucnVuTW9kZSAhPT0gUnVuTW9kZS5oaWdoU3BlZWQgJiYgcHJvcGVydHlOYW1lcyAmJiBwcm9wZXJ0eU5hbWVzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgdGhpcy5ncmlkLnVwZGF0ZVJvdyhjaGFuZ2UuaWQsIHsgW3Byb3BlcnR5TmFtZXMuam9pbignLicpXTogY2hhbmdlLnZhbHVlIH0pO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICBjb25zb2xlLndhcm4oZXJyb3IpO1xyXG4gICAgICB9XHJcbiAgICAgIHRoaXMucmVuZGVyR3JpZFN1YmplY3QubmV4dChjaGFuZ2UpO1xyXG4gICAgfSBlbHNlIGlmIChjaGFuZ2UgJiYgKGNoYW5nZS50eXBlID09PSBDaGFuZ2VUeXBlLlNlbGVjdGlvbkNoYW5nZWQgfHwgY2hhbmdlLnR5cGUgPT09IENoYW5nZVR5cGUuR2xvYmFsU2VsZWN0aW9uQ2hhbmdlZCkpIHtcclxuICAgICAgaWYgKHRoaXMuYmluZGluZ0xpc3QuY3VycmVudElkID09PSAodGhpcy5ncmlkLnNlbGVjdGVkUm93ICYmIHRoaXMuZ3JpZC5zZWxlY3RlZFJvdy5pZCkgJiYgdGhpcy5ncmlkLnRvdGFsID4gMCkge1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHRoaXMuYmluZERhdGEoY2hhbmdlKTtcclxuICAgICAgfVxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5iaW5kRGF0YShjaGFuZ2UpO1xyXG4gICAgfVxyXG4gIH1cclxuICAvLyBwcml2YXRlIGVuZENlbGxFZGl0KCkge1xyXG4gIC8vICAgY29uc3QgaXNFZGl0aW5nID0gdGhpcy5ncmlkLmlzRWRpdGluZygpO1xyXG4gIC8vICAgaWYgKGlzRWRpdGluZykge1xyXG4gIC8vICAgICB0aGlzLmdyaWQuZW5kQ2VsbEVkaXQoKTtcclxuICAvLyAgIH1cclxuICAvLyB9XHJcbiAgcHJpdmF0ZSBlbmRDZWxsRWRpdChjaGFuZ2U6IENoYW5nZSkge1xyXG4gICAgY29uc3QgaXNFZGl0aW5nID0gdGhpcy5ncmlkLmlzRWRpdGluZygpO1xyXG4gICAgaWYgKGNoYW5nZS50eXBlID09PSBDaGFuZ2VUeXBlLkxvYWQgJiYgaXNFZGl0aW5nKSB7XHJcbiAgICAgIHRoaXMuZ3JpZC5lbmRDZWxsRWRpdCgpO1xyXG4gICAgfVxyXG4gIH1cclxuICAvKipcclxuICAgKiDorr7nva5ncmlk5b2T5YmN6YCJ5oup6KGMXHJcbiAgICogQHBhcmFtIGNoYW5nZSDlj5jmm7RcclxuICAgKi9cclxuICBwcml2YXRlIHVwZGF0ZVNlbGVjdGVkUm93KGNoYW5nZT86IENoYW5nZSkge1xyXG4gICAgaWYgKCF0aGlzLmJpbmRpbmdMaXN0IHx8ICF0aGlzLmJpbmRpbmdMaXN0LmN1cnJlbnRJZCkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICAvLyDpobXnoIHliIfmjaLml7bkuI3miafooYzlvZPliY3ooYzliIfmjaJcclxuICAgIGlmIChjaGFuZ2UgJiYgY2hhbmdlLnR5cGUgPT09IENoYW5nZVR5cGUuUGFnaW5hdGlvbkluZm9DaGFuZ2UpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgaWYgKHRoaXMudmlld01vZGVsICYmIHRoaXMudmlld01vZGVsLmZyYW1lQ29udGV4dC5iaW5kaW5nRGF0YS5yb3dTZWxlY3RlZEV2ZW50U3VzcGVuZCA9PT0gdHJ1ZSkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBjb25zdCB7IGlkOiBncmlkU2VsZWN0ZWRSb3dJZCA9IG51bGwgfSA9IHRoaXMuZ3JpZC5zZWxlY3RlZFJvdyB8fCB7fTtcclxuICAgIGNvbnN0IGN1cnJlbnRJZCA9IHRoaXMuYmluZGluZ0xpc3QuY3VycmVudElkO1xyXG4gICAgLy8gZ3JpZOW9k+WJjeihjOS4jmJpbmdpbmdMaXN05b2T5YmN6KGM5LiA6Ie077yM5peg6aG75YiH5o2iXHJcbiAgICBpZiAoZ3JpZFNlbGVjdGVkUm93SWQgPT09IGN1cnJlbnRJZCkge1xyXG4gICAgICBjb25zdCBpc01hdGNoID0gY2hhbmdlICYmIChjaGFuZ2UucGF0aC50b1N0cmluZygpID09PSB0aGlzLnZpZXdNb2RlbC5iaW5kaW5nUGF0aC5zcGxpdCgnLycpLmZpbHRlcihwID0+IHApLnRvU3RyaW5nKCkpO1xyXG4gICAgICBpZiAoY2hhbmdlICYmIGNoYW5nZS50eXBlID09PSBDaGFuZ2VUeXBlLkxvYWQgJiYgaXNNYXRjaCkge1xyXG4gICAgICAgIHRoaXMuZ3JpZC5jbGVhclNlbGVjdGlvbnMoKTtcclxuICAgICAgICB0aGlzLmdyaWQuc2VsZWN0Um93KGN1cnJlbnRJZCwgdHJ1ZSwgdHJ1ZSk7XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgdGhpcy5zZWxlY3RHcmlkUm93KHRoaXMuYmluZGluZ0xpc3QuY3VycmVudElkKTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5rOo5YaMYmluZGluZ2RhdGHlj5jljJbkuovku7ZcclxuICAgKi9cclxuICBwcml2YXRlIHJlZ2lzdGVyQmluZGluZ0RhdGFDaGFuZ2VFdmVudCgpIHtcclxuICAgIHRoaXMuYmluZGluZ0RhdGFDaGFuZ2VFdmVudCA9IHRoaXMuYmluZGluZ0RhdGEuY2hhbmdlcy5zdWJzY3JpYmUoKGNoYW5nZTogQ2hhbmdlKSA9PiB7XHJcbiAgICAgIHRoaXMub25CaW5kaW5nRGF0YUNoYW5nZShjaGFuZ2UpO1xyXG4gICAgfSk7XHJcbiAgICB0aGlzLnZpZXdNb2RlbC5mcmFtZUNvbnRleHQuYXBwQ29udGV4dC5tZXNzYWdlUGlwZS5zdWJzY3JpYmUobWVzc2FnZSA9PiB7XHJcbiAgICAgIGlmIChtZXNzYWdlID09PSAnYmluZERhdGEnKSB7XHJcbiAgICAgICAgdGhpcy5iaW5kRGF0YSgpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5Y+W5raIYmluZGluZ2RhdGHlj5jljJborqLpmIVcclxuICAgKi9cclxuICBwcml2YXRlIHVuUmVnaXN0ZXJCaW5kaW5nRGF0YUNoYW5nZUV2ZW50KCkge1xyXG4gICAgaWYgKHRoaXMuYmluZGluZ0RhdGFDaGFuZ2VFdmVudCAmJiB0eXBlb2YgKHRoaXMuYmluZGluZ0RhdGFDaGFuZ2VFdmVudC51bnN1YnNjcmliZSkgPT09ICdmdW5jdGlvbicpIHtcclxuICAgICAgdGhpcy5iaW5kaW5nRGF0YUNoYW5nZUV2ZW50LnVuc3Vic2NyaWJlKCk7XHJcbiAgICB9XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOinpuWPkemhteeggeWIh+aNouS6i+S7tlxyXG4gICAqIEBkZXNjcmlwdGlvbiDmnKzmlrnms5XpgILnlKjlnLrmma/ku4XkuLrniLbnuqdncmlk5pWw5o2u6YeN5pawbG9hZO+8jOmcgOimgeinpuWPkeivpWdyaWTph43mlrDlj5bmlbDkvb/nlKjjgILlhbbku5blnLrmma/or7fli7/kvb/nlKhcclxuICAgKiBAVE9ETzog5b6F6YeN5p6E77yM5o6n5Yi25LiL57qn5pWw5o2u5Yqg6L295bqU6K+l5L6d6LWW6KGo5qC855qE6KGM5YiH5o2i5LqL5Lu277yM5Li05pe26L+Z5qC35aSE55CG77yM5ZCO57ut5o+Q5L6bTG9hZENoaWxkcmVu5LqL5Lu2XHJcbiAgICovXHJcbiAgcHJpdmF0ZSB1cGRhdGVEYXRhKGNoYW5nZT86IENoYW5nZSkge1xyXG4gICAgaWYgKCEoY2hhbmdlICYmIChjaGFuZ2UudHlwZSA9PT0gQ2hhbmdlVHlwZS5TZWxlY3Rpb25DaGFuZ2VkIHx8IGNoYW5nZS50eXBlID09PSBDaGFuZ2VUeXBlLkxvYWQpKSkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBjb25zdCBiaW5kaW5nUGF0aCA9IHRoaXMudmlld01vZGVsLmJpbmRpbmdQYXRoO1xyXG4gICAgY29uc3QgZXZlbnRCaW5kaW5nUGF0aCA9ICcvJyArIGNoYW5nZS5wYXRoLmpvaW4oJy8nKTtcclxuICAgIGNvbnN0IGlzUmV0cmlldmUgPSB0aGlzLnZpZXdNb2RlbC5mcmFtZUNvbnRleHQuYXBwQ29udGV4dC5wYXJhbXMuZ2V0KCdyZXRyaWV2ZWluZycpIHx8IGZhbHNlO1xyXG4gICAgaWYgKGNoYW5nZS5wYXRoLmxlbmd0aCA8IDEgfHwgYmluZGluZ1BhdGggPT09ICcvJyB8fCBiaW5kaW5nUGF0aCA9PT0gZXZlbnRCaW5kaW5nUGF0aCB8fCAhYmluZGluZ1BhdGguc3RhcnRzV2l0aChldmVudEJpbmRpbmdQYXRoKSkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICAvLyByZXRyaWV2ZeaXtuS8muiHquWKqOW4puWbnuS7juihqOesrOS4gOmhteWPiuS7juihqOesrOS4gOihjOeahOS7juS7juihqOaVsOaNru+8jOaJgOS7peS4jemcgOimgeWGjeWOu+WNleeLrOivt+axglxyXG4gICAgaWYgKGlzUmV0cmlldmUpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgY29uc3QgZnVsbFBhdGhzID0gRW50aXR5UGF0aENvbnZlcnRlci50b0VudGl0eVBhdGhBcnJheSh0aGlzLnZpZXdNb2RlbC5iaW5kaW5nUGF0aCwgdGhpcy5iaW5kaW5nRGF0YSk7XHJcbiAgICBjb25zdCBwYXRocyA9IGZ1bGxQYXRocy5zbGljZSgwLCBmdWxsUGF0aHMubGVuZ3RoIC0gMSk7XHJcbiAgICBjb25zdCBwYXJlbnQgPSB0aGlzLmJpbmRpbmdMaXN0LnBhcmVudDtcclxuICAgIGNvbnN0IHBhcmVudElkID0gcGFyZW50ICYmIHBhcmVudFtwYXJlbnQucHJpbWFyeUtleV07XHJcbiAgICAvLyDkuIrnuqfooajmsqHmnInmlbDmja5cclxuICAgIGlmICghcGFyZW50SWQpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgLy8g6I635Y+Wbm9kZWNvZGVcclxuICAgIGNvbnN0IGJpbmRpbmdQYXRocyA9IHRoaXMudmlld01vZGVsLmJpbmRpbmdQYXRoLnNwbGl0KCcvJykuZmlsdGVyKGl0ZW0gPT4gaXRlbSk7XHJcbiAgICBsZXQgbm9kZUNvZGUgPSBiaW5kaW5nUGF0aHNbYmluZGluZ1BhdGhzLmxlbmd0aCAtIDFdO1xyXG4gICAgbm9kZUNvZGUgPSBub2RlQ29kZS5zdWJzdHIoMCwgbm9kZUNvZGUubGVuZ3RoIC0gMSk7XHJcbiAgICAvLyBjb25zdCBjb25maWdQYXRoID0gYC8ke25vZGVDb2RlfV8ke3BhcmVudElkfWA7XHJcbiAgICBjb25zdCBjb25maWdQYXRoID0gYC8ke25vZGVDb2RlfWA7XHJcbiAgICBsZXQgeyBwYWdlSW5kZXggPSAxIH0gPSB0aGlzLnZpZXdNb2RlbC5mcmFtZUNvbnRleHQucmVwb3NpdG9yeS5lbnRpdHlDb2xsZWN0aW9uLmdldFBhZ2luYXRpb25Db25maWdCeVBhdGgoY29uZmlnUGF0aCkgfHwge307XHJcbiAgICBjb25zdCB7IHBhZ2VTaXplID0gMCB9ID0gdGhpcy52aWV3TW9kZWwuZnJhbWVDb250ZXh0LnJlcG9zaXRvcnkuZW50aXR5Q29sbGVjdGlvbi5nZXRQYWdpbmF0aW9uQ29uZmlnQnlQYXRoKGNvbmZpZ1BhdGgpIHx8IHt9O1xyXG5cclxuICAgIGNvbnN0IHBhcmVudE5vZGVDb2RlID0gY2hhbmdlLnBhdGhbY2hhbmdlLnBhdGgubGVuZ3RoIC0gMV07XHJcbiAgICBjb25zdCBwYXJlbnRDb25maWdQYXRoID0gJy8nICsgcGFyZW50Tm9kZUNvZGUuc3Vic3RyaW5nKDAsIHBhcmVudE5vZGVDb2RlLmxlbmd0aCAtIDEpO1xyXG4gICAgY29uc3QgeyBwYWdlU2l6ZTogcGFyZW50UGFnZVNpemUgPSAwIH0gPSB0aGlzLnZpZXdNb2RlbC5mcmFtZUNvbnRleHQucmVwb3NpdG9yeS5lbnRpdHlDb2xsZWN0aW9uLmdldFBhZ2luYXRpb25Db25maWdCeVBhdGgocGFyZW50Q29uZmlnUGF0aCkgfHwge307XHJcbiAgICBjb25zdCBpc1F1ZXJ5Q2hpbGQgPSB0aGlzLnZpZXdNb2RlbC5mcmFtZUNvbnRleHQuYXBwQ29udGV4dC5wYXJhbXMuZ2V0KCdxdWVyeUNoaWxkJykgfHwgZmFsc2U7XHJcbiAgICBpZiAoaXNRdWVyeUNoaWxkKSB7XHJcbiAgICAgIC8vIHRoaXMudmlld01vZGVsLmZyYW1lQ29udGV4dC5hcHBDb250ZXh0LnBhcmFtcy5kZWxldGUoJ3F1ZXJ5Q2hpbGQnKTtcclxuICAgICAgcGFnZUluZGV4ID0gMTtcclxuICAgIH1cclxuICAgIC8vIOW9k+S4iue6p+ihqOWIh+aNouihjOaXtlxyXG4gICAgaWYgKHBhcmVudFBhZ2VTaXplICsgcGFnZVNpemUgIT09IDApIHtcclxuICAgICAgdGhpcy52aWV3TW9kZWwuZnJhbWVDb250ZXh0LmFwcENvbnRleHQucGFyYW1zLnNldCgnZm9yY2VRdWVyeUNoaWxkJywgdHJ1ZSk7XHJcbiAgICAgIHRoaXMudmlld01vZGVsLmZyYW1lQ29udGV4dC5yZXBvc2l0b3J5LnF1ZXJ5Q2hpbGQocGF0aHMsIHBhZ2VJbmRleCwgcGFnZVNpemUpLnBpcGUoXHJcbiAgICAgICAgZmluYWxpemUoKCkgPT4gdGhpcy52aWV3TW9kZWwuZnJhbWVDb250ZXh0LmFwcENvbnRleHQucGFyYW1zLmRlbGV0ZSgnZm9yY2VRdWVyeUNoaWxkJykpXHJcbiAgICAgICkuc3Vic2NyaWJlKCk7XHJcbiAgICB9XHJcbiAgfVxyXG4gIG5nT25EZXN0cm95KCkge1xyXG4gICAgdGhpcy51blJlZ2lzdGVyQmluZGluZ0RhdGFDaGFuZ2VFdmVudCgpO1xyXG4gIH1cclxuICAvLyAjZW5kcmVnaW9uXHJcblxyXG4gIC8vICNyZWdpb24g5LqL5Lu25Y+R5bCE5ZmoXHJcblxyXG4gIC8qKlxyXG4gICAqIOWPkeWwhOmAieS4reihjOWIh+aNouS6i+S7tlxyXG4gICAqIEBkZXNjcmlwdGlvbiDnu5/kuIDljZXpgInmqKHlvI/lkozlpJrpgInmqKHlvI/kuIvnmoTooYzliIfmjaLkuovku7ZcclxuICAgKi9cclxuICBwcm90ZWN0ZWQgZmlyZVNlbGVjdGVkUm93Q2hhbmdlKHNlbGVjdGVkUm93Q29udGV4dDogYW55KSB7XHJcbiAgICB0aGlzLnNlbGVjdGVkUm93Q2hhbmdlLmVtaXQoc2VsZWN0ZWRSb3dDb250ZXh0KTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5riF56m66YCJ5a6a6KGMXHJcbiAgICogQHBhcmFtIGNoYW5nZSDlj5jmm7RcclxuICAgKi9cclxuICBwcml2YXRlIGNsZWFyQ2hlY2tlZFJvd3MoY2hhbmdlOiBDaGFuZ2UpIHtcclxuICAgIGlmIChjaGFuZ2UudHlwZSA9PT0gQ2hhbmdlVHlwZS5Mb2FkICYmIHRoaXMuZ3JpZC5tdWx0aVNlbGVjdCkge1xyXG4gICAgICBjb25zdCBpc01hdGNoID0gdGhpcy5jaGVja0lmQ2hhbmdlTWF0Y2hCaW5kaW5nUGF0aChjaGFuZ2UpO1xyXG4gICAgICBpZiAoaXNNYXRjaCkge1xyXG4gICAgICAgIHRoaXMuc2V0Q2hlY2tzKFtdKTtcclxuICAgICAgICBpZiAodHlwZW9mICh0aGlzLmdyaWQuY2xlYXJDaGVja2VkcykgPT09ICdmdW5jdGlvbicpIHtcclxuICAgICAgICAgIHRoaXMuZ3JpZC5jbGVhckNoZWNrZWRzKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvLyAjZW5kcmVnaW9uXHJcblxyXG5cclxuXHJcbiAgLy8gI3JlZ2lvbiDpgJrkv6FcclxuXHJcbiAgLyoqXHJcbiAgICog6K6+572uQmluZGluZ0xpc3TnmoTlvZPliY3ooYxcclxuICAgKiBAcGFyYW0gaWQg5b2T5YmN6KGM5YaF56CBXHJcbiAgICovXHJcbiAgcHJvdGVjdGVkIHNldFNlbGVjdGlvbklkVG9CaW5kaW5nRGF0YShpZDogc3RyaW5nKTogdm9pZCB7XHJcbiAgICAvLyDlpoLmnpzlvZPliY3ooYzkuI3lrZjlnKjvvIzliJnlvLrliLborr7nva5cclxuICAgIGlmICghaWQpIHtcclxuICAgICAgdGhpcy5iaW5kaW5nTGlzdC5jdXJyZW50SWQgPSBpZDtcclxuICAgICAgaWYgKCF0aGlzLmdyaWQubXVsdGlTZWxlY3QpIHtcclxuICAgICAgICB0aGlzLnNldENoZWNrcyhbXSk7XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgaWYgKHRoaXMuYmluZGluZ0xpc3QuY3VycmVudElkICE9PSBpZCkge1xyXG4gICAgICB0aGlzLmJpbmRpbmdMaXN0LnNldEN1cnJlbnRJZChpZCwgdHJ1ZSk7XHJcbiAgICB9XHJcbiAgICAvLyDljZXpgInmqKHlvI/kuIvlsIblvZPliY3ooYzorr7nva7liLBpZHNcclxuICAgIGlmICghdGhpcy5ncmlkLm11bHRpU2VsZWN0KSB7XHJcbiAgICAgIHRoaXMuc2V0Q2hlY2tzKFtpZF0pO1xyXG4gICAgfVxyXG4gIH1cclxuICBwcml2YXRlIHVwZGF0ZUNoZWNrZWRSb3dzKGNoYW5nZXM6IENoYW5nZSkge1xyXG4gICAgaWYgKGNoYW5nZXMudHlwZSA9PT0gQ2hhbmdlVHlwZS5Mb2FkKSB7XHJcbiAgICAgIHRoaXMuc2V0Q2hlY2tlZFJvd3MoKTtcclxuICAgIH0gZWxzZSBpZiAoY2hhbmdlcy50eXBlID09PSBDaGFuZ2VUeXBlLlZhbHVlQ2hhbmdlZCkge1xyXG4gICAgICBjb25zdCBpZHMgPSB0aGlzLmdldENoZWNrcygpO1xyXG4gICAgICBpZiAoY2hhbmdlcy5pZCAmJiBpZHMuaW5jbHVkZXMoY2hhbmdlcy5pZCkpIHtcclxuICAgICAgICB0aGlzLnNldENoZWNrZWRSb3dzKCk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcbiAgLyoqXHJcbiAgICog6K6+572u6YCJ5oup6KGMXHJcbiAgICovXHJcbiAgcHJvdGVjdGVkIHNldENoZWNrcyhpZHM6IHN0cmluZ1tdKSB7XHJcbiAgICB0aGlzLnZpZXdNb2RlbC51aVN0YXRlLnNldFByb3BlcnR5VmFsdWUoJ2lkcycsIGlkcyk7XHJcbiAgICB0aGlzLnNldENoZWNrZWRSb3dzKGlkcyk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOiOt+WPluWLvumAieihjGlk5pWw57uEXHJcbiAgICogQHJldHVybnNcclxuICAgKi9cclxuICBwcm90ZWN0ZWQgZ2V0Q2hlY2tzKCk6IHN0cmluZ1tdIHtcclxuICAgIHJldHVybiB0aGlzLnZpZXdNb2RlbC51aVN0YXRlWydpZHMnXSB8fCBbXTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5pu05paw5Yu+6YCJ6KGM5pWw5o2uXHJcbiAgICovXHJcbiAgcHJvdGVjdGVkIHNldENoZWNrZWRSb3dzKGlkcz86IHN0cmluZ1tdKSB7XHJcbiAgICAvLyDpq5jpgJ/mqKHlvI/ml7bkuI3lho3orr7nva5yb3dzXHJcbiAgICAvLyBpZiAodGhpcy52aWV3TW9kZWwuZnJhbWVDb250ZXh0LmFwcENvbnRleHQucnVuTW9kZSA9PT0gUnVuTW9kZS5oaWdoU3BlZWQpIHtcclxuICAgIC8vICAgcmV0dXJuO1xyXG4gICAgLy8gfVxyXG4gICAgaWYgKHR5cGVvZiBpZHMgPT09ICd1bmRlZmluZWQnKSB7XHJcbiAgICAgIGlkcyA9IHRoaXMudmlld01vZGVsLnVpU3RhdGVbJ2lkcyddIHx8IFtdO1xyXG4gICAgfVxyXG4gICAgaWYgKCFBcnJheS5pc0FycmF5KGlkcykgfHwgaWRzLmxlbmd0aCA8IDEpIHtcclxuICAgICAgLy8g5q2k5pe2aWRz5rKh5pyJ5YC877yMcm93c+S4reS5n+S4jeW6lOivpeaciVxyXG4gICAgICB0aGlzLnZpZXdNb2RlbC51aVN0YXRlLnNldFByb3BlcnR5VmFsdWUoJ3Jvd3MnLCBudWxsKTtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgbGV0IGxpc3QgPSBbXTtcclxuICAgIC8vIFRPRE/vvJpyb3dz5Lit5pWw5o2u5Zyo6auY6YCf5qih5byP5ZKM5pmu6YCa5qih5byP5LiL5aSa6K+t5a2X5q6155qE5YC86KGo546w5LiN5LiA6Ie077yM6auY6YCf5qih5byP5LiL5aSa6K+t5a2X5q615YC85Li65a+56LGh77yM5pmu6YCa5qih5byP5Li65b2T5YmN6K+t6KiA44CC5pqC5LiN5aSE55CG6auY6YCf5qih5byP5Zy65pmvXHJcbiAgICBpZiAodGhpcy52aWV3TW9kZWwuZnJhbWVDb250ZXh0LmFwcENvbnRleHQucnVuTW9kZSA9PT0gUnVuTW9kZS5oaWdoU3BlZWQpIHtcclxuICAgICAgbGlzdCA9IHRoaXMuZ3JpZC5kYXRhIHx8IFtdO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgbGlzdCA9IHRoaXMuYmluZGluZ0xpc3QudG9KU09OKHsgaWdub3JlTXVsdGlMYW5nSW5wdXQ6IHRydWUgfSk7XHJcbiAgICB9XHJcbiAgICBjb25zdCByb3dzOiBNYXA8c3RyaW5nLCBhbnk+ID0gdGhpcy52aWV3TW9kZWwudWlTdGF0ZVsncm93cyddIHx8IG5ldyBNYXA8c3RyaW5nLCBhbnk+KCk7XHJcblxyXG4gICAgY29uc3QgcmVzdWx0ID0gbmV3IE1hcDxzdHJpbmcsIGFueT4oKTtcclxuICAgIGlkcy5mb3JFYWNoKChpZDogYW55KSA9PiB7XHJcbiAgICAgIGNvbnN0IGl0ZW0gPSBsaXN0LmZpbmQoaXRlbSA9PiBpdGVtW3RoaXMucHJpbWFyeUtleV0gPT09IGlkKTtcclxuICAgICAgY29uc3Qgb3RoZXJQYWdlSXRlbSA9IHJvd3MuZ2V0KGlkKTtcclxuICAgICAgaWYgKGl0ZW0pIHtcclxuICAgICAgICByZXN1bHQuc2V0KGlkLCBpdGVtKTtcclxuICAgICAgfSBlbHNlIGlmIChvdGhlclBhZ2VJdGVtKSB7XHJcbiAgICAgICAgcmVzdWx0LnNldChpZCwgb3RoZXJQYWdlSXRlbSk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgdGhpcy52aWV3TW9kZWwudWlTdGF0ZS5zZXRQcm9wZXJ0eVZhbHVlKCdyb3dzJywgcmVzdWx0KTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog6YCJ5LitZ3JpZOihjFxyXG4gICAqIEBwYXJhbSBpZCBpZFxyXG4gICAqL1xyXG4gIHByb3RlY3RlZCBzZWxlY3RHcmlkUm93KGlkOiBhbnkpIHtcclxuICAgIHRoaXMuZ3JpZC5zZWxlY3RSb3coaWQpO1xyXG4gICAgdGhpcy5ncmlkLnNjcm9sbFRvQ3VycmVudFJvdygpO1xyXG4gIH1cclxuICAvLyAjZW5kcmVnaW9uXHJcbiAgLy8gI3JlZ2lvbiDkuovku7blpITnkIblmahcclxuXHJcbiAgLyoqXHJcbiAgICog6aG156CB5YiH5o2i5LqL5Lu2XHJcbiAgICogQHBhcmFtIGV2ZW50IGV2ZW50XHJcbiAgICovXHJcbiAgQEhvc3RMaXN0ZW5lcigncGFnZUNoYW5nZWQnLCBbJyRldmVudCddKVxyXG4gIHB1YmxpYyBwYWdlQ2hhbmdlZEhhbmRsZXIoZXZlbnQ6IGFueSkge1xyXG4gICAgbGV0IHsgcGFnZUluZGV4LCBwYWdlU2l6ZSB9ID0gZXZlbnQ7XHJcbiAgICBpZiAocGFnZUluZGV4IDwgMSkge1xyXG4gICAgICBwYWdlSW5kZXggPSAxO1xyXG4gICAgfVxyXG4gICAgY29uc3Qgc2tpcCA9IChwYWdlSW5kZXggLSAxKSAqIHBhZ2VTaXplO1xyXG4gICAgdGhpcy5iaW5kaW5nRGF0YS5zZXRQYWdpbmdJbmZvKHNraXAsIHBhZ2VTaXplLCB0aGlzLmJpbmRpbmdEYXRhLmJpbmRpbmdQYXRoKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOihjOWIh+aNouS6i+S7tlxyXG4gICAqIEBwYXJhbSBldmVudCBldmVudFxyXG4gICAqL1xyXG4gIEBIb3N0TGlzdGVuZXIoJ3NlbGVjdENoYW5nZWQnLCBbJyRldmVudCddKVxyXG4gIHB1YmxpYyBzZWxlY3RlZFJvd0NoYW5nZWQoZXZlbnQ6IGFueSkge1xyXG4gICAgY29uc3QgeyBpbmRleCwgZGF0YSB9ID0gZXZlbnQ7XHJcbiAgICBjb25zdCBpZCA9IGRhdGFbdGhpcy5wcmltYXJ5S2V5XTtcclxuICAgIHRoaXMuc2V0U2VsZWN0aW9uSWRUb0JpbmRpbmdEYXRhKGlkKTtcclxuICAgIHRoaXMuZmlyZVNlbGVjdGVkUm93Q2hhbmdlKGV2ZW50KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOWPlua2iOihjOmAieaLqeS6i+S7tlxyXG4gICAqIEBwYXJhbSBldmVudCBldmVudFxyXG4gICAqL1xyXG4gIEBIb3N0TGlzdGVuZXIoJ3VuU2VsZWN0JywgWyckZXZlbnQnXSlcclxuICBwdWJsaWMgdW5TZWxlY3RlZChldmVudDogYW55KSB7XHJcbiAgICBpZiAoIWV2ZW50KSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGNvbnN0IHsgZGF0YSA9IHt9IH0gPSBldmVudDtcclxuICAgIGNvbnN0IGlkID0gZGF0YVt0aGlzLnByaW1hcnlLZXldO1xyXG4gICAgY29uc3QgY3VycmVudElkID0gdGhpcy5iaW5kaW5nTGlzdC5jdXJyZW50SWQ7XHJcbiAgICBpZiAoaWQgPT09IGN1cnJlbnRJZCkge1xyXG4gICAgICB0aGlzLnNldFNlbGVjdGlvbklkVG9CaW5kaW5nRGF0YShudWxsKTtcclxuICAgIH1cclxuICAgIC8vIHRoaXMuZmlyZVNlbGVjdGVkUm93Q2hhbmdlKGV2ZW50KTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5Yu+6YCJ6KGM5Y+R55Sf5Y+Y5YyWXHJcbiAgICogQHBhcmFtIGV2ZW50IGV2ZW50XHJcbiAgICovXHJcbiAgQEhvc3RMaXN0ZW5lcignY2hlY2tlZENoYW5nZScsIFsnJGV2ZW50J10pXHJcbiAgcHVibGljIGNoZWNrZWRDaGFuZ2VkKGV2ZW50OiBhbnkpIHtcclxuICAgIGV2ZW50ID0gZXZlbnQgfHwgW107XHJcbiAgICBjb25zdCBpZHMgPSBldmVudC5tYXAoaXRlbSA9PiBpdGVtLmlkKTtcclxuICAgIHRoaXMuc2V0Q2hlY2tzKGlkcyk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOWIhumhteWkp+Wwj+WPmOabtOS6i+S7tlxyXG4gICAqIEBwYXJhbSBldmVudCBldmVudFxyXG4gICAqL1xyXG4gIEBIb3N0TGlzdGVuZXIoJ3BhZ2VTaXplQ2hhbmdlZCcsIFsnJGV2ZW50J10pXHJcbiAgcHVibGljIHBhZ2VTaXplQ2hhbmdlZChldmVudDogYW55KSB7XHJcbiAgICBjb25zdCB7IHBhZ2VJbmRleCwgcGFnZVNpemUgfSA9IGV2ZW50O1xyXG4gICAgY29uc3Qgc2tpcCA9IDA7Ly8ocGFnZUluZGV4IC0gMSkgKiBwYWdlU2l6ZTtcclxuICAgIC8vIHRoaXMuYmluZGluZ0xpc3Quc2V0UGFnaW5hdGlvbkluZm8oc2tpcCwgcGFnZVNpemUpO1xyXG4gICAgdGhpcy5iaW5kaW5nRGF0YS5zZXRQYWdpbmdJbmZvKHNraXAsIHBhZ2VTaXplLCB0aGlzLmJpbmRpbmdEYXRhLmJpbmRpbmdQYXRoKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIGdyaWTmu5rliqjliqDovb3mlbDmja5cclxuICAgKiBAcGFyYW0gZXZlbnQgZXZlbnRcclxuICAgKi9cclxuICBASG9zdExpc3RlbmVyKCdzY3JvbGxZTG9hZCcsIFsnJGV2ZW50J10pXHJcbiAgcHVibGljIHNjcm9sbFkoZXZlbnQ6IGFueSkge1xyXG4gICAgY29uc3QgeyBwYWdlcjogcGFnZUluZGV4LCBwYWdlU2l6ZSB9ID0gZXZlbnQ7XHJcbiAgICBjb25zdCBza2lwID0gKHBhZ2VJbmRleCAtIDEpICogcGFnZVNpemU7XHJcbiAgICB0aGlzLmJpbmRpbmdEYXRhLnNldFBhZ2luZ0luZm8oc2tpcCwgcGFnZVNpemUsIHRoaXMuYmluZGluZ0RhdGEuYmluZGluZ1BhdGgpO1xyXG4gIH1cclxuICBASG9zdExpc3RlbmVyKCdmaWx0ZXJDaGFuZ2VkJywgWyckZXZlbnQnXSlcclxuICBwdWJsaWMgZmlsdGVyQ2hhbmdlZChldmVudDogYW55KSB7XHJcbiAgICB0aGlzLmZpbHRlcnMgPSBldmVudDtcclxuICB9XHJcbiAgLy8gI2VuZHJlZ2lvblxyXG4gIHByaXZhdGUgY2hlY2tJZkNoYW5nZU1hdGNoQmluZGluZ1BhdGgoY2hhbmdlOiBDaGFuZ2UpOiBib29sZWFuIHtcclxuICAgIGxldCBpc01hdGNoID0gZmFsc2U7XHJcbiAgICBpZiAoIWNoYW5nZSB8fCAhY2hhbmdlLnBhdGgpIHtcclxuICAgICAgcmV0dXJuIGlzTWF0Y2g7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgY2hhbmdlUGF0aEFycmF5ID0gY2hhbmdlLnBhdGg7XHJcbiAgICBpZiAoIWNoYW5nZVBhdGhBcnJheSkge1xyXG4gICAgICByZXR1cm4gaXNNYXRjaDtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoISh0aGlzLmJpbmRpbmdEYXRhKSAmJiAhKHRoaXMuYmluZGluZ0RhdGEuYmluZGluZ1BhdGgpKSB7XHJcbiAgICAgIHJldHVybiBpc01hdGNoO1xyXG4gICAgfVxyXG4gICAgY29uc3QgYmluZ2RpbmdQYXRoQXJyYXkgPSB0aGlzLmJpbmRpbmdEYXRhLmJpbmRpbmdQYXRoLnNwbGl0KCcvJyk7XHJcbiAgICBpZiAoYmluZ2RpbmdQYXRoQXJyYXkubGVuZ3RoIDw9IDApIHtcclxuICAgICAgcmV0dXJuIGlzTWF0Y2g7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKGNoYW5nZVBhdGhBcnJheS5sZW5ndGggPT09IDApIHsgLy8g5Li76KGoXHJcbiAgICAgIGlmICh0aGlzLmJpbmRpbmdEYXRhLmJpbmRpbmdQYXRoID09PSAnLycpIHtcclxuICAgICAgICBpc01hdGNoID0gdHJ1ZTtcclxuICAgICAgfVxyXG4gICAgfSBlbHNlIGlmIChjaGFuZ2UucGF0aC5sZW5ndGggPT09IDEpIHsvLyDkuLvku47ooahcclxuICAgICAgaWYgKGJpbmdkaW5nUGF0aEFycmF5Lmxlbmd0aCA9PT0gMiAmJiBiaW5nZGluZ1BhdGhBcnJheVsxXSA9PT0gY2hhbmdlLnBhdGhbMF0pIHtcclxuICAgICAgICBpc01hdGNoID0gdHJ1ZTtcclxuICAgICAgfVxyXG4gICAgfSBlbHNlIGlmIChjaGFuZ2UucGF0aC5sZW5ndGggPT09IDIpIHsgLy8g5Li75LuO5LuO6KGoXHJcbiAgICAgIGlmIChiaW5nZGluZ1BhdGhBcnJheS5sZW5ndGggPT09IDMgJiYgYmluZ2RpbmdQYXRoQXJyYXlbMV0gPT09IGNoYW5nZS5wYXRoWzBdICYmIGJpbmdkaW5nUGF0aEFycmF5WzJdID09PSBjaGFuZ2UucGF0aFsxXSkge1xyXG4gICAgICAgIGlzTWF0Y2ggPSB0cnVlO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIGlzTWF0Y2g7XHJcbiAgfVxyXG4gIHByaXZhdGUgZGVib3VuY2UoY2FsbGJhY2s6ICguLi5hcmdzKSA9PiBhbnksIHdhaXQpIHtcclxuICAgIGxldCB0aW1lb3V0SWQgPSBudWxsO1xyXG4gICAgcmV0dXJuICguLi5hcmdzKSA9PiB7XHJcbiAgICAgIHdpbmRvdy5jbGVhclRpbWVvdXQodGltZW91dElkKTtcclxuICAgICAgdGltZW91dElkID0gd2luZG93LnNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgIGNhbGxiYWNrLmFwcGx5KG51bGwsIGFyZ3MpO1xyXG4gICAgICB9LCB3YWl0KTtcclxuICAgIH07XHJcbiAgfVxyXG59XHJcbiJdfQ==